Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 40076431F7
	for <lists+intel-gfx@lfdr.de>; Thu, 13 Jun 2019 02:22:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3EB5389268;
	Thu, 13 Jun 2019 00:21:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7798189762
 for <intel-gfx@lists.freedesktop.org>; Wed, 12 Jun 2019 16:29:20 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 12 Jun 2019 09:29:17 -0700
X-ExtLoop1: 1
Received: from ldmartin-desk.jf.intel.com ([10.24.10.187])
 by FMSMGA003.fm.intel.com with ESMTP; 12 Jun 2019 09:29:13 -0700
From: Lucas De Marchi <lucas.demarchi@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 12 Jun 2019 09:29:00 -0700
Message-Id: <20190612162900.13777-1-lucas.demarchi@intel.com>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
X-Mailman-Approved-At: Thu, 13 Jun 2019 00:21:50 +0000
Subject: [Intel-gfx] [PATCH] gpu/drm/i915: globally replace dev_priv with
 i915
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgYXJlIHNsb3dseSBjb252ZXJ0aW5nIGRldl9wcml2IHRvIGk5MTUgZXZlcnl3aGVyZSwgc3By
ZWFkIGludG8Kc21hbGxlciBzZXJpZXMuIFdoaWxlIHRoaXMgaXMgZ29vZCB0byBhdm9pZCB1bnJl
bGF0ZWQgYnJlYWthZ2VzIHRvIG90aGVyCmluZmxpZ2h0IHBhdGNoZXMsIGl0J3MgYmFkIGJlY2F1
c2UgaW5mbGlnaHQgcGF0Y2hlcyBvbiBuZWFyYnkgcGF0aHMga2VlcApicmVha2luZy4gUGFpcmVk
IHdpdGggb3RoZXIgY29kZSBtb3ZlcyBhbmQgcmVmYWN0b3JlcyB0aGlzIGlzIGJlY29taW5nIGEK
bmlnaHRtYXJlLgoKTm93IHRoYXQgSTkxNV97UkVBRCxXUklURX0gYXJlIGdvbmUgYW5kIGltcGxp
Y2l0IGFjY2VzcyB0byBkZXZfcHJpdiBubwpsb25nZXIgZXhpc3RzIHdlIGNhbiBzaW1wbHkgc2Vk
IGFsbCBmaWxlcyBhbmQgYmUgZG9uZSB3aXRoIHRoZQpjb252ZXJzaW9uLiBUaGlzIHdhcyBnZW5l
cmF0ZWQgd2l0aCB0aGUgZm9sbG93aW5nIGNvbW1hbmRzIHdpdGggbm8KYWRkaXRpb25hbCBmaXh1
cHM6CgoJZ2l0IGxzLWZpbGVzIC0tZnVsbC1uYW1lIC16IC0tIGRyaXZlcnMvZ3B1L2RybS9pOTE1
LyB8IFwKCQl4YXJncyAtMCBzZWQgLWkgJ3MvXGJkZXZfcHJpdlxiL2k5MTUvZycKCkFueSBwZW5k
aW5nIHNlcmllcyBjYW4gYXBwbHkgdGhlIHNhbWUgc2VhcmNoIGFuZCByZXBsYWNlIHdoZW4gcmVi
YXNpbmcuCgpTaWduZWQtb2ZmLWJ5OiBMdWNhcyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFyY2hpQGlu
dGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fY2g3MDE3LmMgICAgICAgICAg
ICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fY2g3eHh4LmMgICAgICAgICAg
ICAgfCAgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9faXZjaC5jICAgICAgICAgICAg
ICAgfCAgIDE0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fbnMyNTAxLmMgICAgICAgICAg
ICAgfCAgIDE0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fc2lsMTY0LmMgICAgICAgICAg
ICAgfCAgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fdGZwNDEwLmMgICAgICAgICAg
ICAgfCAgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
ICAgfCAgIDQ4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5o
ICAgfCAgICA2ICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMg
ICAgfCAgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMg
ICAgfCAgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYyAg
ICAgfCAgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMg
ICAgfCAgMTY4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMg
ICAgfCAgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5j
ICAgfCAgIDQwICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5j
ICAgfCAgIDQ4ICstCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0
LmMgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaCAgICAg
ICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyAg
ICAgfCAgIDY2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9oYW5nY2hlY2suYyAg
ICAgfCAgIDM2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMgICAgICAg
ICAgfCAgIDI0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmggICAgICAg
ICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jICAgICAg
ICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMg
ICAgfCAgIDUyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyAgICAg
ICAgfCAgIDYwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY2ZnX3NwYWNlLmMgICAgICAg
ICAgfCAgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jICAgICAg
ICAgfCAgIDM0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZGVidWdmcy5jICAgICAgICAg
ICAgfCAgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZGlzcGxheS5jICAgICAgICAg
ICAgfCAgIDQ4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZG1hYnVmLmMgICAgICAgICAg
ICAgfCAgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZWRpZC5jICAgICAgICAgICAg
ICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZXhlY2xpc3QuYyAgICAgICAg
ICAgfCAgIDE0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZmJfZGVjb2Rlci5jICAgICAg
ICAgfCAgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZmlybXdhcmUuYyAgICAgICAg
ICAgfCAgIDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3R0LmMgICAgICAgICAgICAg
ICAgfCAgIDQ0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmMgICAgICAgICAgICAg
ICAgfCAgIDI2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmggICAgICAgICAgICAg
ICAgfCAgIDIwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaGFuZGxlcnMuYyAgICAgICAg
ICAgfCAgIDkyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaW50ZXJydXB0LmMgICAgICAg
ICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQva3ZtZ3QuYyAgICAgICAgICAg
ICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1pby5jICAgICAgICAgICAg
ICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1pb19jb250ZXh0LmMgICAg
ICAgfCAgIDM4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWRfcG9saWN5LmMgICAg
ICAgfCAgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMgICAgICAg
ICAgfCAgIDcyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvdmdwdS5jICAgICAgICAgICAg
ICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2NtZF9wYXJzZXIuYyAgICAg
ICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAg
ICAgfCAgOTUyICsrKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmggICAg
ICAgICAgIHwgICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAgICAg
ICAgICAgIHwgMTA5MiArKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAg
ICAgICAgICAgICB8ICA1OTAgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAg
ICAgICAgICAgICAgIHwgIDM1NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZp
Y3QuYyAgICAgICAgIHwgICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmMgICAgICAgICAgIHwgIDIxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmggICAgICAgICAgIHwgICAyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJy
b3IuYyAgICAgICAgIHwgICA0NCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJy
b3IuaCAgICAgICAgIHwgICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyAg
ICAgICAgICAgICAgIHwgMTgwOCArKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2lycS5oICAgICAgICAgICAgICAgfCAgIDg2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X21lbWNweS5jICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2Jkdy5jICAgICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2Jkdy5oICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2J4dC5jICAgICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2J4dC5oICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2NmbGd0Mi5jICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2NmbGd0Mi5oICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2NmbGd0My5jICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2NmbGd0My5oICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2Nodi5jICAgICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2Nodi5oICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2NubC5jICAgICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2NubC5oICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2dsay5jICAgICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2dsay5oICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2hzdy5jICAgICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2hzdy5oICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2ljbC5jICAgICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2ljbC5oICAgICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2tibGd0Mi5jICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2tibGd0Mi5oICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2tibGd0My5jICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX2tibGd0My5oICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX3NrbGd0Mi5jICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX3NrbGd0Mi5oICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX3NrbGd0My5jICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX3NrbGd0My5oICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX3NrbGd0NC5jICAgICAgICAgfCAgIDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X29hX3NrbGd0NC5oICAgICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3BlcmYuYyAgICAgICAgICAgICAgfCAgODE0ICsrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BtdS5jICAgICAgICAgICAgICAgfCAgIDQyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3F1ZXJ5LmMgICAgICAgICAgICAgfCAgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlZy5oICAgICAgICAgICAgICAgfCAgNDIwICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zdXNwZW5kLmMgICAgICAgICAgIHwgIDEwNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zeXNmcy5jICAgICAgICAgICAgIHwgIDE3MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV90cmFjZS5oICAgICAgICAgICAgIHwgICA0NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92Z3B1LmMgICAgICAgICAgICAgIHwgICAzMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92Z3B1LmggICAgICAgICAgICAgIHwgICAxNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYyAgICAgICAgICAgICAgIHwgICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aWNsX2RzaS5jICAgICAgICAgICAgICAgIHwgIDEyMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfYXRvbWljLmMgICAgICAgICAgIHwgICAyOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfYXRvbWljLmggICAgICAgICAgIHwgICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfYXVkaW8uYyAgICAgICAgICAgIHwgIDIyMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfYXVkaW8uaCAgICAgICAgICAgIHwgICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfYmlvcy5jICAgICAgICAgICAgIHwgIDU1MiArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9iaW9zLmggICAgICAgICAgICAgfCAgIDE4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9idy5jICAgICAgICAgICAgICAgfCAgIDY4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9idy5oICAgICAgICAgICAgICAgfCAgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9jZGNsay5jICAgICAgICAgICAgfCAgODgyICsrLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jZGNsay5oICAgICAgICAgICAgfCAgIDE0ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jb2xvci5jICAgICAgICAgICAgfCAgMTc2ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jb21ib19waHkuYyAgICAgICAgfCAgIDY0ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jb21ib19waHkuaCAgICAgICAgfCAgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jb25uZWN0b3IuYyAgICAgICAgfCAgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jcnQuYyAgICAgICAgICAgICAgfCAgMTcyICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jcnQuaCAgICAgICAgICAgICAgfCAgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jc3IuYyAgICAgICAgICAgICAgfCAgMTQ0ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9kZGkuYyAgICAgICAgICAgICAgfCAgNTkyICsrLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2RkaS5oICAgICAgICAgICAgICB8ICAgIDYgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmMgICAgICB8ICAxNjQgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmggICAgICB8ICAgIDYgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2Rpc3BsYXkuYyAgICAgICAgICB8IDI5MTYgKysrKysrKystLS0tLS0tLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXkuaCAgICAgICAgICB8ICAgIDYgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXlfcG93ZXIuYyAgICB8IDEwMjAgKysr
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmggICAgfCAgIDYy
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcC5jICAgICAgICAgICAgICAgfCAgODIy
ICsrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcC5oICAgICAgICAgICAgICAgfCAg
IDE4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMgfCAg
ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9tc3QuYyAgICAgICAgICAgfCAg
IDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcGlvX3BoeS5jICAgICAgICAgfCAg
Mjc2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcGlvX3BoeS5oICAgICAgICAgfCAg
IDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcGxsX21nci5jICAgICAgICAgfCAg
MzU2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcGxsX21nci5oICAgICAgICAgfCAg
IDIwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaCAgICAgICAgICAgICAgfCAg
IDcyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kc2kuYyAgICAgICAgICAgICAgfCAg
ICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kc2kuaCAgICAgICAgICAgICAgfCAg
ICA2ICstCiAuLi4vZ3B1L2RybS9pOTE1L2ludGVsX2RzaV9kY3NfYmFja2xpZ2h0LmMgICAgfCAg
ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kc2lfdmJ0LmMgICAgICAgICAgfCAg
IDc2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kdm8uYyAgICAgICAgICAgICAgfCAg
IDMyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kdm8uaCAgICAgICAgICAgICAgfCAg
ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kdm9fZGV2LmggICAgICAgICAgfCAg
ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mYmMuYyAgICAgICAgICAgICAgfCAg
NDEwICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJjLmggICAgICAgICAgICAgIHwg
ICAyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYyAgICAgICAgICAgIHwg
ICA0NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuaCAgICAgICAgICAgIHwg
ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmlmb191bmRlcnJ1bi5jICAgIHwg
IDE2MCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmlmb191bmRlcnJ1bi5oICAgIHwg
ICAxMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuYyAgICAgIHwg
ICA4MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuaCAgICAgIHwg
ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ21idXMuYyAgICAgICAgICAgIHwg
IDIzMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ21idXMuaCAgICAgICAgICAgIHwg
ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmMgICAgICAgICAgICAgIHwg
ICA0OCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX2Fkcy5jICAgICAgICAgIHwg
ICAxMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX2Z3LmMgICAgICAgICAgIHwg
ICAyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX2xvZy5jICAgICAgICAgIHwg
ICAxOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYyAgIHwg
ICA1NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3Z0LmMgICAgICAgICAgICAgIHwg
ICAzNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3Z0LmggICAgICAgICAgICAgIHwg
ICAxNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaGRjcC5jICAgICAgICAgICAgIHwg
IDI4NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaGRjcC5oICAgICAgICAgICAgIHwg
ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaGRtaS5jICAgICAgICAgICAgIHwg
IDMxNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaGRtaS5oICAgICAgICAgICAgIHwg
ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaG90cGx1Zy5jICAgICAgICAgIHwg
IDIxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaG90cGx1Zy5oICAgICAgICAgIHwg
ICAxNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaHVjLmMgICAgICAgICAgICAgIHwg
ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaHVjX2Z3LmMgICAgICAgICAgIHwg
ICAxOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHBlX2F1ZGlvLmMgICAgICAgIHwg
ICA5NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHBlX2F1ZGlvLmggICAgICAgIHwg
ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHNwY29uLmMgICAgICAgICAgIHwg
ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHZkcy5jICAgICAgICAgICAgIHwg
ICA5NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHZkcy5oICAgICAgICAgICAgIHwg
ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ByZWdpb24uYyAgICAgICAgIHwg
IDExNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ByZWdpb24uaCAgICAgICAgIHwg
ICAyOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jICAgICAgICAgIHwg
ICA5OCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5oICAgICAgICAgIHwg
ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcGFuZWwuYyAgICAgICAgICAgIHwg
IDIzOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcGlwZV9jcmMuYyAgICAgICAgIHwg
IDEyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcGlwZV9jcmMuaCAgICAgICAgIHwg
ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyAgICAgICAgICAgICAgIHwg
MjMwMCArKysrKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oICAgICAg
ICAgICAgICAgfCAgIDc0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wc3IuYyAgICAg
ICAgICAgICAgfCAgMzk0ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcHNyLmggICAg
ICAgICAgICAgIHwgICAxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcXVpcmtzLmgg
ICAgICAgICAgIHwgICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcnVudGltZV9w
bS5oICAgICAgIHwgICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc2R2by5jICAg
ICAgICAgICAgIHwgIDEyOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc2R2by5oICAg
ICAgICAgICAgIHwgICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc3ByaXRlLmMg
ICAgICAgICAgIHwgIDIxOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc3ByaXRlLmgg
ICAgICAgICAgIHwgICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdHYuYyAgICAg
ICAgICAgICAgIHwgICA3MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdHYuaCAgICAg
ICAgICAgICAgIHwgICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuYyAgICAg
ICAgICAgICAgIHwgICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuaCAgICAg
ICAgICAgICAgIHwgICAyMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuYyAg
ICAgICAgICAgIHwgICAxMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuaCAg
ICAgICAgICAgIHwgICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMg
ICAgICAgICAgIHwgICAyNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmgg
ICAgICAgICAgIHwgICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdmJ0X2RlZnMu
aCAgICAgICAgIHwgICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdmRzYy5jICAg
ICAgICAgICAgIHwgICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYyAg
ICAgICAgICAgIHwgICAxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2d0dC5jIHwgICAyNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVs
X2d1Yy5jICAgIHwgICA0NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVs
X3VuY29yZS5jIHwgICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvdmx2X2RzaS5jICAgICAg
ICAgICAgICAgIHwgIDIyMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvdmx2X2RzaV9wbGwuYyAg
ICAgICAgICAgIHwgICA4MCArLQogMjAxIGZpbGVzIGNoYW5nZWQsIDEyMDIwIGluc2VydGlvbnMo
KyksIDEyMDIwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2R2b19jaDcwMTcuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2R2b19jaDcwMTcuYwppbmRleCA2
MDIzODBmZTc0ZjMuLmRmNjcwYzhkNWMzMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZHZvX2NoNzAxNy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2R2b19jaDcwMTcuYwpA
QCAtMjEwLDcgKzIxMCw3IEBAIHN0YXRpYyBib29sIGNoNzAxN19pbml0KHN0cnVjdCBpbnRlbF9k
dm9fZGV2aWNlICpkdm8sCiAJCXJldHVybiBmYWxzZTsKIAogCWR2by0+aTJjX2J1cyA9IGFkYXB0
ZXI7Ci0JZHZvLT5kZXZfcHJpdiA9IHByaXY7CisJZHZvLT5pOTE1ID0gcHJpdjsKIAogCWlmICgh
Y2g3MDE3X3JlYWQoZHZvLCBDSDcwMTdfREVWSUNFX0lELCAmdmFsKSkKIAkJZ290byBmYWlsOwpA
QCAtMzk1LDExICszOTUsMTEgQEAgZG8gewkJCQkJCQlcCiAKIHN0YXRpYyB2b2lkIGNoNzAxN19k
ZXN0cm95KHN0cnVjdCBpbnRlbF9kdm9fZGV2aWNlICpkdm8pCiB7Ci0Jc3RydWN0IGNoNzAxN19w
cml2ICpwcml2ID0gZHZvLT5kZXZfcHJpdjsKKwlzdHJ1Y3QgY2g3MDE3X3ByaXYgKnByaXYgPSBk
dm8tPmk5MTU7CiAKIAlpZiAocHJpdikgewogCQlrZnJlZShwcml2KTsKLQkJZHZvLT5kZXZfcHJp
diA9IE5VTEw7CisJCWR2by0+aTkxNSA9IE5VTEw7CiAJfQogfQogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kdm9fY2g3eHh4LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9f
Y2g3eHh4LmMKaW5kZXggZTA3MGJlYmVlN2I1Li5lMDc2ODAxZDAzMmYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2R2b19jaDd4eHguYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kdm9fY2g3eHh4LmMKQEAgLTEzNSw3ICsxMzUsNyBAQCBzdGF0aWMgY2hhciAqY2g3eHh4X2dl
dF9kaWQodTggZGlkKQogLyoqIFJlYWRzIGFuIDggYml0IHJlZ2lzdGVyICovCiBzdGF0aWMgYm9v
bCBjaDd4eHhfcmVhZGIoc3RydWN0IGludGVsX2R2b19kZXZpY2UgKmR2bywgaW50IGFkZHIsIHU4
ICpjaCkKIHsKLQlzdHJ1Y3QgY2g3eHh4X3ByaXYgKmNoN3h4eCA9IGR2by0+ZGV2X3ByaXY7CisJ
c3RydWN0IGNoN3h4eF9wcml2ICpjaDd4eHggPSBkdm8tPmk5MTU7CiAJc3RydWN0IGkyY19hZGFw
dGVyICphZGFwdGVyID0gZHZvLT5pMmNfYnVzOwogCXU4IG91dF9idWZbMl07CiAJdTggaW5fYnVm
WzJdOwpAQCAtMTczLDcgKzE3Myw3IEBAIHN0YXRpYyBib29sIGNoN3h4eF9yZWFkYihzdHJ1Y3Qg
aW50ZWxfZHZvX2RldmljZSAqZHZvLCBpbnQgYWRkciwgdTggKmNoKQogLyoqIFdyaXRlcyBhbiA4
IGJpdCByZWdpc3RlciAqLwogc3RhdGljIGJvb2wgY2g3eHh4X3dyaXRlYihzdHJ1Y3QgaW50ZWxf
ZHZvX2RldmljZSAqZHZvLCBpbnQgYWRkciwgdTggY2gpCiB7Ci0Jc3RydWN0IGNoN3h4eF9wcml2
ICpjaDd4eHggPSBkdm8tPmRldl9wcml2OworCXN0cnVjdCBjaDd4eHhfcHJpdiAqY2g3eHh4ID0g
ZHZvLT5pOTE1OwogCXN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlciA9IGR2by0+aTJjX2J1czsK
IAl1OCBvdXRfYnVmWzJdOwogCXN0cnVjdCBpMmNfbXNnIG1zZyA9IHsKQEAgLTIxMCw3ICsyMTAs
NyBAQCBzdGF0aWMgYm9vbCBjaDd4eHhfaW5pdChzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZv
LAogCQlyZXR1cm4gZmFsc2U7CiAKIAlkdm8tPmkyY19idXMgPSBhZGFwdGVyOwotCWR2by0+ZGV2
X3ByaXYgPSBjaDd4eHg7CisJZHZvLT5pOTE1ID0gY2g3eHh4OwogCWNoN3h4eC0+cXVpZXQgPSB0
cnVlOwogCiAJaWYgKCFjaDd4eHhfcmVhZGIoZHZvLCBDSDd4eHhfUkVHX1ZJRCwgJnZlbmRvcikp
CkBAIC0zNDcsMTEgKzM0NywxMSBAQCBzdGF0aWMgdm9pZCBjaDd4eHhfZHVtcF9yZWdzKHN0cnVj
dCBpbnRlbF9kdm9fZGV2aWNlICpkdm8pCiAKIHN0YXRpYyB2b2lkIGNoN3h4eF9kZXN0cm95KHN0
cnVjdCBpbnRlbF9kdm9fZGV2aWNlICpkdm8pCiB7Ci0Jc3RydWN0IGNoN3h4eF9wcml2ICpjaDd4
eHggPSBkdm8tPmRldl9wcml2OworCXN0cnVjdCBjaDd4eHhfcHJpdiAqY2g3eHh4ID0gZHZvLT5p
OTE1OwogCiAJaWYgKGNoN3h4eCkgewogCQlrZnJlZShjaDd4eHgpOwotCQlkdm8tPmRldl9wcml2
ID0gTlVMTDsKKwkJZHZvLT5pOTE1ID0gTlVMTDsKIAl9CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2R2b19pdmNoLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9faXZj
aC5jCmluZGV4IDA5ZGJhMzVmM2ZmYS4uYzk5YzE2MjExNTY3IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kdm9faXZjaC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2R2b19p
dmNoLmMKQEAgLTE5MSw3ICsxOTEsNyBAQCBzdGF0aWMgdm9pZCBpdmNoX2R1bXBfcmVncyhzdHJ1
Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvKTsKICAqLwogc3RhdGljIGJvb2wgaXZjaF9yZWFkKHN0
cnVjdCBpbnRlbF9kdm9fZGV2aWNlICpkdm8sIGludCBhZGRyLCB1MTYgKmRhdGEpCiB7Ci0Jc3Ry
dWN0IGl2Y2hfcHJpdiAqcHJpdiA9IGR2by0+ZGV2X3ByaXY7CisJc3RydWN0IGl2Y2hfcHJpdiAq
cHJpdiA9IGR2by0+aTkxNTsKIAlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIgPSBkdm8tPmky
Y19idXM7CiAJdTggb3V0X2J1ZlsxXTsKIAl1OCBpbl9idWZbMl07CkBAIC0yMzQsNyArMjM0LDcg
QEAgc3RhdGljIGJvb2wgaXZjaF9yZWFkKHN0cnVjdCBpbnRlbF9kdm9fZGV2aWNlICpkdm8sIGlu
dCBhZGRyLCB1MTYgKmRhdGEpCiAvKiBXcml0ZXMgYSAxNi1iaXQgcmVnaXN0ZXIgb24gdGhlIGl2
Y2ggKi8KIHN0YXRpYyBib29sIGl2Y2hfd3JpdGUoc3RydWN0IGludGVsX2R2b19kZXZpY2UgKmR2
bywgaW50IGFkZHIsIHUxNiBkYXRhKQogewotCXN0cnVjdCBpdmNoX3ByaXYgKnByaXYgPSBkdm8t
PmRldl9wcml2OworCXN0cnVjdCBpdmNoX3ByaXYgKnByaXYgPSBkdm8tPmk5MTU7CiAJc3RydWN0
IGkyY19hZGFwdGVyICphZGFwdGVyID0gZHZvLT5pMmNfYnVzOwogCXU4IG91dF9idWZbM107CiAJ
c3RydWN0IGkyY19tc2cgbXNnID0gewpAQCAtMjcyLDcgKzI3Miw3IEBAIHN0YXRpYyBib29sIGl2
Y2hfaW5pdChzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLAogCQlyZXR1cm4gZmFsc2U7CiAK
IAlkdm8tPmkyY19idXMgPSBhZGFwdGVyOwotCWR2by0+ZGV2X3ByaXYgPSBwcml2OworCWR2by0+
aTkxNSA9IHByaXY7CiAJcHJpdi0+cXVpZXQgPSB0cnVlOwogCiAJaWYgKCFpdmNoX3JlYWQoZHZv
LCBWUjAwLCAmdGVtcCkpCkBAIC0zMjgsNyArMzI4LDcgQEAgc3RhdGljIGVudW0gZHJtX21vZGVf
c3RhdHVzIGl2Y2hfbW9kZV92YWxpZChzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLAogICov
CiBzdGF0aWMgdm9pZCBpdmNoX3Jlc2V0KHN0cnVjdCBpbnRlbF9kdm9fZGV2aWNlICpkdm8pCiB7
Ci0Jc3RydWN0IGl2Y2hfcHJpdiAqcHJpdiA9IGR2by0+ZGV2X3ByaXY7CisJc3RydWN0IGl2Y2hf
cHJpdiAqcHJpdiA9IGR2by0+aTkxNTsKIAlpbnQgaTsKIAogCURSTV9ERUJVR19LTVMoIlJlc2V0
dGluZyB0aGUgSVZDSCByZWdpc3RlcnNcbiIpOwpAQCAtMzk4LDcgKzM5OCw3IEBAIHN0YXRpYyB2
b2lkIGl2Y2hfbW9kZV9zZXQoc3RydWN0IGludGVsX2R2b19kZXZpY2UgKmR2bywKIAkJCSAgY29u
c3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAJCQkgIGNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlKQogewotCXN0cnVjdCBpdmNoX3ByaXYgKnByaXYg
PSBkdm8tPmRldl9wcml2OworCXN0cnVjdCBpdmNoX3ByaXYgKnByaXYgPSBkdm8tPmk5MTU7CiAJ
dTE2IHZyNDAgPSAwOwogCXUxNiB2cjAxID0gMDsKIAl1MTYgdnIxMDsKQEAgLTQ4MywxMSArNDgz
LDExIEBAIHN0YXRpYyB2b2lkIGl2Y2hfZHVtcF9yZWdzKHN0cnVjdCBpbnRlbF9kdm9fZGV2aWNl
ICpkdm8pCiAKIHN0YXRpYyB2b2lkIGl2Y2hfZGVzdHJveShzdHJ1Y3QgaW50ZWxfZHZvX2Rldmlj
ZSAqZHZvKQogewotCXN0cnVjdCBpdmNoX3ByaXYgKnByaXYgPSBkdm8tPmRldl9wcml2OworCXN0
cnVjdCBpdmNoX3ByaXYgKnByaXYgPSBkdm8tPmk5MTU7CiAKIAlpZiAocHJpdikgewogCQlrZnJl
ZShwcml2KTsKLQkJZHZvLT5kZXZfcHJpdiA9IE5VTEw7CisJCWR2by0+aTkxNSA9IE5VTEw7CiAJ
fQogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fbnMyNTAxLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fbnMyNTAxLmMKaW5kZXggYzgzYTVkODhkNjJiLi5hZjA0
ZmNhYTk4YjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2R2b19uczI1MDEuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kdm9fbnMyNTAxLmMKQEAgLTM5Miw3ICszOTIsNyBA
QCBzdHJ1Y3QgbnMyNTAxX3ByaXYgewogKi8KIHN0YXRpYyBib29sIG5zMjUwMV9yZWFkYihzdHJ1
Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLCBpbnQgYWRkciwgdTggKmNoKQogewotCXN0cnVjdCBu
czI1MDFfcHJpdiAqbnMgPSBkdm8tPmRldl9wcml2OworCXN0cnVjdCBuczI1MDFfcHJpdiAqbnMg
PSBkdm8tPmk5MTU7CiAJc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVyID0gZHZvLT5pMmNfYnVz
OwogCXU4IG91dF9idWZbMl07CiAJdTggaW5fYnVmWzJdOwpAQCAtNDM3LDcgKzQzNyw3IEBAIHN0
YXRpYyBib29sIG5zMjUwMV9yZWFkYihzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLCBpbnQg
YWRkciwgdTggKmNoKQogKi8KIHN0YXRpYyBib29sIG5zMjUwMV93cml0ZWIoc3RydWN0IGludGVs
X2R2b19kZXZpY2UgKmR2bywgaW50IGFkZHIsIHU4IGNoKQogewotCXN0cnVjdCBuczI1MDFfcHJp
diAqbnMgPSBkdm8tPmRldl9wcml2OworCXN0cnVjdCBuczI1MDFfcHJpdiAqbnMgPSBkdm8tPmk5
MTU7CiAJc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVyID0gZHZvLT5pMmNfYnVzOwogCXU4IG91
dF9idWZbMl07CiAKQEAgLTQ4MSw3ICs0ODEsNyBAQCBzdGF0aWMgYm9vbCBuczI1MDFfaW5pdChz
dHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLAogCQlyZXR1cm4gZmFsc2U7CiAKIAlkdm8tPmky
Y19idXMgPSBhZGFwdGVyOwotCWR2by0+ZGV2X3ByaXYgPSBuczsKKwlkdm8tPmk5MTUgPSBuczsK
IAlucy0+cXVpZXQgPSB0cnVlOwogCiAJaWYgKCFuczI1MDFfcmVhZGIoZHZvLCBOUzI1MDFfVklE
X0xPLCAmY2gpKQpAQCAtNTUxLDcgKzU1MSw3IEBAIHN0YXRpYyB2b2lkIG5zMjUwMV9tb2RlX3Nl
dChzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLAogCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlKQogewogCWNvbnN0IHN0cnVjdCBuczI1MDFfY29u
ZmlndXJhdGlvbiAqY29uZjsKLQlzdHJ1Y3QgbnMyNTAxX3ByaXYgKm5zID0gKHN0cnVjdCBuczI1
MDFfcHJpdiAqKShkdm8tPmRldl9wcml2KTsKKwlzdHJ1Y3QgbnMyNTAxX3ByaXYgKm5zID0gKHN0
cnVjdCBuczI1MDFfcHJpdiAqKShkdm8tPmk5MTUpOwogCWludCBtb2RlX2lkeCwgaTsKIAogCURS
TV9ERUJVR19LTVMKQEAgLTY1NSw3ICs2NTUsNyBAQCBzdGF0aWMgYm9vbCBuczI1MDFfZ2V0X2h3
X3N0YXRlKHN0cnVjdCBpbnRlbF9kdm9fZGV2aWNlICpkdm8pCiAvKiBzZXQgdGhlIE5TMjUwMSBw
b3dlciBzdGF0ZSAqLwogc3RhdGljIHZvaWQgbnMyNTAxX2RwbXMoc3RydWN0IGludGVsX2R2b19k
ZXZpY2UgKmR2bywgYm9vbCBlbmFibGUpCiB7Ci0Jc3RydWN0IG5zMjUwMV9wcml2ICpucyA9IChz
dHJ1Y3QgbnMyNTAxX3ByaXYgKikoZHZvLT5kZXZfcHJpdik7CisJc3RydWN0IG5zMjUwMV9wcml2
ICpucyA9IChzdHJ1Y3QgbnMyNTAxX3ByaXYgKikoZHZvLT5pOTE1KTsKIAogCURSTV9ERUJVR19L
TVMoIlRyeWluZyBzZXQgdGhlIGRwbXMgb2YgdGhlIERWTyB0byAlaVxuIiwgZW5hYmxlKTsKIApA
QCAtNjkxLDExICs2OTEsMTEgQEAgc3RhdGljIHZvaWQgbnMyNTAxX2RwbXMoc3RydWN0IGludGVs
X2R2b19kZXZpY2UgKmR2bywgYm9vbCBlbmFibGUpCiAKIHN0YXRpYyB2b2lkIG5zMjUwMV9kZXN0
cm95KHN0cnVjdCBpbnRlbF9kdm9fZGV2aWNlICpkdm8pCiB7Ci0Jc3RydWN0IG5zMjUwMV9wcml2
ICpucyA9IGR2by0+ZGV2X3ByaXY7CisJc3RydWN0IG5zMjUwMV9wcml2ICpucyA9IGR2by0+aTkx
NTsKIAogCWlmIChucykgewogCQlrZnJlZShucyk7Ci0JCWR2by0+ZGV2X3ByaXYgPSBOVUxMOwor
CQlkdm8tPmk5MTUgPSBOVUxMOwogCX0KIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZHZvX3NpbDE2NC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZHZvX3NpbDE2NC5jCmlu
ZGV4IDA0Njk4ZWFlYjYzMi4uYTQ1MmRjYmExNzljIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kdm9fc2lsMTY0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZHZvX3NpbDE2
NC5jCkBAIC02OCw3ICs2OCw3IEBAIHN0cnVjdCBzaWwxNjRfcHJpdiB7CiAKIHN0YXRpYyBib29s
IHNpbDE2NF9yZWFkYihzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLCBpbnQgYWRkciwgdTgg
KmNoKQogewotCXN0cnVjdCBzaWwxNjRfcHJpdiAqc2lsID0gZHZvLT5kZXZfcHJpdjsKKwlzdHJ1
Y3Qgc2lsMTY0X3ByaXYgKnNpbCA9IGR2by0+aTkxNTsKIAlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFk
YXB0ZXIgPSBkdm8tPmkyY19idXM7CiAJdTggb3V0X2J1ZlsyXTsKIAl1OCBpbl9idWZbMl07CkBA
IC0xMDUsNyArMTA1LDcgQEAgc3RhdGljIGJvb2wgc2lsMTY0X3JlYWRiKHN0cnVjdCBpbnRlbF9k
dm9fZGV2aWNlICpkdm8sIGludCBhZGRyLCB1OCAqY2gpCiAKIHN0YXRpYyBib29sIHNpbDE2NF93
cml0ZWIoc3RydWN0IGludGVsX2R2b19kZXZpY2UgKmR2bywgaW50IGFkZHIsIHU4IGNoKQogewot
CXN0cnVjdCBzaWwxNjRfcHJpdiAqc2lsID0gZHZvLT5kZXZfcHJpdjsKKwlzdHJ1Y3Qgc2lsMTY0
X3ByaXYgKnNpbCA9IGR2by0+aTkxNTsKIAlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIgPSBk
dm8tPmkyY19idXM7CiAJdTggb3V0X2J1ZlsyXTsKIAlzdHJ1Y3QgaTJjX21zZyBtc2cgPSB7CkBA
IC0xNDIsNyArMTQyLDcgQEAgc3RhdGljIGJvb2wgc2lsMTY0X2luaXQoc3RydWN0IGludGVsX2R2
b19kZXZpY2UgKmR2bywKIAkJcmV0dXJuIGZhbHNlOwogCiAJZHZvLT5pMmNfYnVzID0gYWRhcHRl
cjsKLQlkdm8tPmRldl9wcml2ID0gc2lsOworCWR2by0+aTkxNSA9IHNpbDsKIAlzaWwtPnF1aWV0
ID0gdHJ1ZTsKIAogCWlmICghc2lsMTY0X3JlYWRiKGR2bywgU0lMMTY0X1ZJRF9MTywgJmNoKSkK
QEAgLTI2MCwxMSArMjYwLDExIEBAIHN0YXRpYyB2b2lkIHNpbDE2NF9kdW1wX3JlZ3Moc3RydWN0
IGludGVsX2R2b19kZXZpY2UgKmR2bykKIAogc3RhdGljIHZvaWQgc2lsMTY0X2Rlc3Ryb3koc3Ry
dWN0IGludGVsX2R2b19kZXZpY2UgKmR2bykKIHsKLQlzdHJ1Y3Qgc2lsMTY0X3ByaXYgKnNpbCA9
IGR2by0+ZGV2X3ByaXY7CisJc3RydWN0IHNpbDE2NF9wcml2ICpzaWwgPSBkdm8tPmk5MTU7CiAK
IAlpZiAoc2lsKSB7CiAJCWtmcmVlKHNpbCk7Ci0JCWR2by0+ZGV2X3ByaXYgPSBOVUxMOworCQlk
dm8tPmk5MTUgPSBOVUxMOwogCX0KIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZHZvX3RmcDQxMC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZHZvX3RmcDQxMC5jCmluZGV4
IDYyMzExNGVlNzNjZC4uOGZmZWQ4OTE0YjQ5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kdm9fdGZwNDEwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZHZvX3RmcDQxMC5j
CkBAIC05Myw3ICs5Myw3IEBAIHN0cnVjdCB0ZnA0MTBfcHJpdiB7CiAKIHN0YXRpYyBib29sIHRm
cDQxMF9yZWFkYihzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvLCBpbnQgYWRkciwgdTggKmNo
KQogewotCXN0cnVjdCB0ZnA0MTBfcHJpdiAqdGZwID0gZHZvLT5kZXZfcHJpdjsKKwlzdHJ1Y3Qg
dGZwNDEwX3ByaXYgKnRmcCA9IGR2by0+aTkxNTsKIAlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0
ZXIgPSBkdm8tPmkyY19idXM7CiAJdTggb3V0X2J1ZlsyXTsKIAl1OCBpbl9idWZbMl07CkBAIC0x
MzAsNyArMTMwLDcgQEAgc3RhdGljIGJvb2wgdGZwNDEwX3JlYWRiKHN0cnVjdCBpbnRlbF9kdm9f
ZGV2aWNlICpkdm8sIGludCBhZGRyLCB1OCAqY2gpCiAKIHN0YXRpYyBib29sIHRmcDQxMF93cml0
ZWIoc3RydWN0IGludGVsX2R2b19kZXZpY2UgKmR2bywgaW50IGFkZHIsIHU4IGNoKQogewotCXN0
cnVjdCB0ZnA0MTBfcHJpdiAqdGZwID0gZHZvLT5kZXZfcHJpdjsKKwlzdHJ1Y3QgdGZwNDEwX3By
aXYgKnRmcCA9IGR2by0+aTkxNTsKIAlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIgPSBkdm8t
PmkyY19idXM7CiAJdTggb3V0X2J1ZlsyXTsKIAlzdHJ1Y3QgaTJjX21zZyBtc2cgPSB7CkBAIC0x
NzgsNyArMTc4LDcgQEAgc3RhdGljIGJvb2wgdGZwNDEwX2luaXQoc3RydWN0IGludGVsX2R2b19k
ZXZpY2UgKmR2bywKIAkJcmV0dXJuIGZhbHNlOwogCiAJZHZvLT5pMmNfYnVzID0gYWRhcHRlcjsK
LQlkdm8tPmRldl9wcml2ID0gdGZwOworCWR2by0+aTkxNSA9IHRmcDsKIAl0ZnAtPnF1aWV0ID0g
dHJ1ZTsKIAogCWlmICgoaWQgPSB0ZnA0MTBfZ2V0aWQoZHZvLCBURlA0MTBfVklEX0xPKSkgIT0g
VEZQNDEwX1ZJRCkgewpAQCAtMjk5LDExICsyOTksMTEgQEAgc3RhdGljIHZvaWQgdGZwNDEwX2R1
bXBfcmVncyhzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvKQogCiBzdGF0aWMgdm9pZCB0ZnA0
MTBfZGVzdHJveShzdHJ1Y3QgaW50ZWxfZHZvX2RldmljZSAqZHZvKQogewotCXN0cnVjdCB0ZnA0
MTBfcHJpdiAqdGZwID0gZHZvLT5kZXZfcHJpdjsKKwlzdHJ1Y3QgdGZwNDEwX3ByaXYgKnRmcCA9
IGR2by0+aTkxNTsKIAogCWlmICh0ZnApIHsKIAkJa2ZyZWUodGZwKTsKLQkJZHZvLT5kZXZfcHJp
diA9IE5VTEw7CisJCWR2by0+aTkxNSA9IE5VTEw7CiAJfQogfQogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCBjODZjYTlmMjE1MzIuLjJmYTY3NDdj
N2I2ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBA
IC00OTUsMjcgKzQ5NSwyNyBAQCBzdGF0aWMgdm9pZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LAogfQogCiBzdGF0aWMgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KgotaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCitpOTE1X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQgaW50IGZsYWdzKQogewogCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAKIAlpZiAoZmxhZ3MgJiBJOTE1X0NPTlRFWFRfQ1JFQVRFX0ZMQUdTX1NJTkdM
RV9USU1FTElORSAmJgotCSAgICAhSEFTX0VYRUNMSVNUUyhkZXZfcHJpdikpCisJICAgICFIQVNf
RVhFQ0xJU1RTKGk5MTUpKQogCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIAogCS8qIFJlYXAg
dGhlIG1vc3Qgc3RhbGUgY29udGV4dCAqLwotCWNvbnRleHRzX2ZyZWVfZmlyc3QoZGV2X3ByaXYp
OworCWNvbnRleHRzX2ZyZWVfZmlyc3QoaTkxNSk7CiAKLQljdHggPSBfX2NyZWF0ZV9jb250ZXh0
KGRldl9wcml2KTsKKwljdHggPSBfX2NyZWF0ZV9jb250ZXh0KGk5MTUpOwogCWlmIChJU19FUlIo
Y3R4KSkKIAkJcmV0dXJuIGN0eDsKIAotCWlmIChIQVNfRlVMTF9QUEdUVChkZXZfcHJpdikpIHsK
KwlpZiAoSEFTX0ZVTExfUFBHVFQoaTkxNSkpIHsKIAkJc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0
OwogCi0JCXBwZ3R0ID0gaTkxNV9wcGd0dF9jcmVhdGUoZGV2X3ByaXYpOworCQlwcGd0dCA9IGk5
MTVfcHBndHRfY3JlYXRlKGk5MTUpOwogCQlpZiAoSVNfRVJSKHBwZ3R0KSkgewogCQkJRFJNX0RF
QlVHX0RSSVZFUigiUFBHVFQgc2V0dXAgZmFpbGVkICglbGQpXG4iLAogCQkJCQkgUFRSX0VSUihw
cGd0dCkpOwpAQCAtNTMwLDcgKzUzMCw3IEBAIGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdW5zaWduZWQgaW50IGZsYWdzKQogCWlmIChm
bGFncyAmIEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FKSB7CiAJCXN0
cnVjdCBpOTE1X3RpbWVsaW5lICp0aW1lbGluZTsKIAotCQl0aW1lbGluZSA9IGk5MTVfdGltZWxp
bmVfY3JlYXRlKGRldl9wcml2LCBOVUxMKTsKKwkJdGltZWxpbmUgPSBpOTE1X3RpbWVsaW5lX2Ny
ZWF0ZShpOTE1LCBOVUxMKTsKIAkJaWYgKElTX0VSUih0aW1lbGluZSkpIHsKIAkJCWNvbnRleHRf
Y2xvc2UoY3R4KTsKIAkJCXJldHVybiBFUlJfQ0FTVCh0aW1lbGluZSk7CkBAIC02NDksMTkgKzY0
OSwxOSBAQCBzdGF0aWMgYm9vbCBuZWVkc19wcmVlbXB0X2NvbnRleHQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJcmV0dXJuIEhBU19FWEVDTElTVFMoaTkxNSk7CiB9CiAKLWludCBp
OTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K2ludCBpOTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAKIAkvKiBSZWFzc3VyZSBvdXJz
ZWx2ZXMgd2UgYXJlIG9ubHkgY2FsbGVkIG9uY2UgKi8KLQlHRU1fQlVHX09OKGRldl9wcml2LT5r
ZXJuZWxfY29udGV4dCk7Ci0JR0VNX0JVR19PTihkZXZfcHJpdi0+cHJlZW1wdF9jb250ZXh0KTsK
KwlHRU1fQlVHX09OKGk5MTUtPmtlcm5lbF9jb250ZXh0KTsKKwlHRU1fQlVHX09OKGk5MTUtPnBy
ZWVtcHRfY29udGV4dCk7CiAKLQlpbnRlbF9lbmdpbmVfaW5pdF9jdHhfd2EoZGV2X3ByaXYtPmVu
Z2luZVtSQ1MwXSk7Ci0JaW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CisJaW50ZWxfZW5naW5lX2lu
aXRfY3R4X3dhKGk5MTUtPmVuZ2luZVtSQ1MwXSk7CisJaW5pdF9jb250ZXh0cyhpOTE1KTsKIAog
CS8qIGxvd2VzdCBwcmlvcml0eTsgaWRsZSB0YXNrICovCi0JY3R4ID0gaTkxNV9nZW1fY29udGV4
dF9jcmVhdGVfa2VybmVsKGRldl9wcml2LCBJOTE1X1BSSU9SSVRZX01JTik7CisJY3R4ID0gaTkx
NV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlfTUlOKTsKIAlp
ZiAoSVNfRVJSKGN0eCkpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gY3JlYXRlIGRlZmF1bHQg
Z2xvYmFsIGNvbnRleHRcbiIpOwogCQlyZXR1cm4gUFRSX0VSUihjdHgpOwpAQCAtNjc1LDMxICs2
NzUsMzEgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCSAqLwogCUdFTV9CVUdfT04oY3R4LT5od19pZCk7CiAJR0VNX0JVR19P
TighYXRvbWljX3JlYWQoJmN0eC0+aHdfaWRfcGluX2NvdW50KSk7Ci0JZGV2X3ByaXYtPmtlcm5l
bF9jb250ZXh0ID0gY3R4OworCWk5MTUtPmtlcm5lbF9jb250ZXh0ID0gY3R4OwogCiAJLyogaGln
aGVzdCBwcmlvcml0eTsgcHJlZW1wdGluZyB0YXNrICovCi0JaWYgKG5lZWRzX3ByZWVtcHRfY29u
dGV4dChkZXZfcHJpdikpIHsKLQkJY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVs
KGRldl9wcml2LCBJTlRfTUFYKTsKKwlpZiAobmVlZHNfcHJlZW1wdF9jb250ZXh0KGk5MTUpKSB7
CisJCWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJTlRfTUFYKTsK
IAkJaWYgKCFJU19FUlIoY3R4KSkKLQkJCWRldl9wcml2LT5wcmVlbXB0X2NvbnRleHQgPSBjdHg7
CisJCQlpOTE1LT5wcmVlbXB0X2NvbnRleHQgPSBjdHg7CiAJCWVsc2UKIAkJCURSTV9FUlJPUigi
RmFpbGVkIHRvIGNyZWF0ZSBwcmVlbXB0IGNvbnRleHQ7IGRpc2FibGluZyBwcmVlbXB0aW9uXG4i
KTsKIAl9CiAKIAlEUk1fREVCVUdfRFJJVkVSKCIlcyBjb250ZXh0IHN1cHBvcnQgaW5pdGlhbGl6
ZWRcbiIsCi0JCQkgRFJJVkVSX0NBUFMoZGV2X3ByaXYpLT5oYXNfbG9naWNhbF9jb250ZXh0cyA/
CisJCQkgRFJJVkVSX0NBUFMoaTkxNSktPmhhc19sb2dpY2FsX2NvbnRleHRzID8KIAkJCSAibG9n
aWNhbCIgOiAiZmFrZSIpOwogCXJldHVybiAwOwogfQogCi12b2lkIGk5MTVfZ2VtX2NvbnRleHRz
X2xvc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpOTE1X2dlbV9j
b250ZXh0c19sb3N0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAotCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGRldl9wcml2LCBpZCkKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBp
ZCkKIAkJaW50ZWxfZW5naW5lX2xvc3RfY29udGV4dChlbmdpbmUpOwogfQogCkBAIC0yMzY4LDcg
KzIzNjgsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9zZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogaW50IGk5MTVfZ2VtX2NvbnRleHRfcmVzZXRfc3Rh
dHNfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkgICAgICAgdm9pZCAqZGF0YSwg
c3RydWN0IGRybV9maWxlICpmaWxlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcmVzZXRfc3RhdHMgKmFyZ3MgPSBkYXRhOwog
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJaW50IHJldDsKQEAgLTIzOTAsNyArMjM5
MCw3IEBAIGludCBpOTE1X2dlbV9jb250ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsCiAJICovCiAKIAlpZiAoY2FwYWJsZShDQVBfU1lTX0FETUlOKSkKLQkJYXJn
cy0+cmVzZXRfY291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZkZXZfcHJpdi0+Z3B1X2Vycm9yKTsK
KwkJYXJncy0+cmVzZXRfY291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3Ip
OwogCWVsc2UKIAkJYXJncy0+cmVzZXRfY291bnQgPSAwOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAppbmRleCA2MzAzOTJjNzdlNDguLmY1NWNiOGVhZTg3
YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCkBAIC0x
MzMsOSArMTMzLDkgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX2NvbnRleHRfaXNfa2Vy
bmVsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB9CiAKIC8qIGk5MTVfZ2VtX2NvbnRl
eHQuYyAqLwotaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2xvc3Qo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaTkxNV9nZW1fY29udGV4
dHNfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaW50IF9fbXVzdF9j
aGVjayBpOTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KTsKK3ZvaWQgaTkxNV9nZW1fY29udGV4dHNfbG9zdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSk7Cit2b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwogCiBpbnQgaTkxNV9nZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggNTI4ZWVhNDRkY2Nm
Li44M2Q2NDU4MGEyZjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2V4ZWNidWZmZXIuYwpAQCAtMjA5OSw3ICsyMDk5LDcgQEAgc3RhdGljIGludCBlYl9zdWJtaXQo
c3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAgKiBUaGUgZW5naW5lIGluZGV4IGlzIHJldHVy
bmVkLgogICovCiBzdGF0aWMgdW5zaWduZWQgaW50Ci1nZW44X2Rpc3BhdGNoX2JzZF9lbmdpbmUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorZ2VuOF9kaXNwYXRjaF9ic2RfZW5n
aW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJIHN0cnVjdCBkcm1fZmlsZSAq
ZmlsZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYgPSBmaWxl
LT5kcml2ZXJfcHJpdjsKQEAgLTIxMDcsNyArMjEwNyw3IEBAIGdlbjhfZGlzcGF0Y2hfYnNkX2Vu
Z2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJLyogQ2hlY2sgd2hldGhl
ciB0aGUgZmlsZV9wcml2IGhhcyBhbHJlYWR5IHNlbGVjdGVkIG9uZSByaW5nLiAqLwogCWlmICgo
aW50KWZpbGVfcHJpdi0+YnNkX2VuZ2luZSA8IDApCiAJCWZpbGVfcHJpdi0+YnNkX2VuZ2luZSA9
IGF0b21pY19mZXRjaF94b3IoMSwKLQkJCSAmZGV2X3ByaXYtPm1tLmJzZF9lbmdpbmVfZGlzcGF0
Y2hfaW5kZXgpOworCQkJICZpOTE1LT5tbS5ic2RfZW5naW5lX2Rpc3BhdGNoX2luZGV4KTsKIAog
CXJldHVybiBmaWxlX3ByaXYtPmJzZF9lbmdpbmU7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggMzZiNzZjNmEwYTlkLi5hMzdmMGFkYWMxNmUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKQEAgLTM2Nyw3ICsz
NjcsNyBAQCB2b2lkCiBpOTE1X2dlbV9vYmplY3RfZmx1c2hfd3JpdGVfZG9tYWluKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJICAgdW5zaWduZWQgaW50IGZsdXNoX2RvbWFp
bnMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmot
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2Jq
LT5iYXNlLmRldik7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAKIAlhc3NlcnRfb2JqZWN0X2hl
bGQob2JqKTsKQEAgLTM3Nyw3ICszNzcsNyBAQCBpOTE1X2dlbV9vYmplY3RfZmx1c2hfd3JpdGVf
ZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlzd2l0Y2ggKG9iai0+
d3JpdGVfZG9tYWluKSB7CiAJY2FzZSBJOTE1X0dFTV9ET01BSU5fR1RUOgotCQlpOTE1X2dlbV9m
bHVzaF9nZ3R0X3dyaXRlcyhkZXZfcHJpdik7CisJCWk5MTVfZ2VtX2ZsdXNoX2dndHRfd3JpdGVz
KGk5MTUpOwogCiAJCWludGVsX2ZiX29ial9mbHVzaChvYmosCiAJCQkJICAgZmJfd3JpdGVfb3Jp
Z2luKG9iaiwgSTkxNV9HRU1fRE9NQUlOX0dUVCkpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fc2htZW0uYwppbmRleCAxOWQ5ZWNkYjI4OTQuLmViNGFhZTY1ZjZlNCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMKQEAgLTUyMSw3ICs1MjEsNyBA
QCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCB1NjQgc2l6ZSkKIAogLyogQWxsb2NhdGUgYSBuZXcgR0VNIG9iamVjdCBhbmQgZmlsbCBp
dCB3aXRoIHRoZSBzdXBwbGllZCBkYXRhICovCiBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
Ci1pOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtX2Zyb21fZGF0YShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtX2Zyb21fZGF0
YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICAgY29uc3Qgdm9pZCAq
ZGF0YSwgc2l6ZV90IHNpemUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsK
QEAgLTUyOSw3ICs1MjksNyBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtX2Zyb21fZGF0
YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJc2l6ZV90IG9mZnNldDsKIAlp
bnQgZXJyOwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZfcHJpdiwg
cm91bmRfdXAoc2l6ZSwgUEFHRV9TSVpFKSk7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9zaG1lbShpOTE1LCByb3VuZF91cChzaXplLCBQQUdFX1NJWkUpKTsKIAlpZiAoSVNfRVJSKG9i
aikpCiAJCXJldHVybiBvYmo7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9zdG9sZW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9z
dG9sZW4uYwppbmRleCBkZTFmYWIyMDU4ZWMuLjI0ZTE3NGYwNjlmMyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYwpAQCAtMjQsNDggKzI0LDQ4IEBACiAgKiBm
b3IgaXMgYSBib29uLgogICovCiAKLWludCBpOTE1X2dlbV9zdG9sZW5faW5zZXJ0X25vZGVfaW5f
cmFuZ2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50IGk5MTVfZ2VtX3N0
b2xlbl9pbnNlcnRfbm9kZV9pbl9yYW5nZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkJIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSwgdTY0IHNpemUsCiAJCQkJCSB1bnNpZ25l
ZCBhbGlnbm1lbnQsIHU2NCBzdGFydCwgdTY0IGVuZCkKIHsKIAlpbnQgcmV0OwogCi0JaWYgKCFk
cm1fbW1faW5pdGlhbGl6ZWQoJmRldl9wcml2LT5tbS5zdG9sZW4pKQorCWlmICghZHJtX21tX2lu
aXRpYWxpemVkKCZpOTE1LT5tbS5zdG9sZW4pKQogCQlyZXR1cm4gLUVOT0RFVjsKIAogCS8qIFdh
U2tpcFN0b2xlbk1lbW9yeUZpcnN0UGFnZTpiZHcrICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gOCAmJiBzdGFydCA8IDQwOTYpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4ICYmIHN0
YXJ0IDwgNDA5NikKIAkJc3RhcnQgPSA0MDk2OwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPm1t
LnN0b2xlbl9sb2NrKTsKLQlyZXQgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmRldl9w
cml2LT5tbS5zdG9sZW4sIG5vZGUsCisJbXV0ZXhfbG9jaygmaTkxNS0+bW0uc3RvbGVuX2xvY2sp
OworCXJldCA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5nZSgmaTkxNS0+bW0uc3RvbGVuLCBu
b2RlLAogCQkJCQkgIHNpemUsIGFsaWdubWVudCwgMCwKIAkJCQkJICBzdGFydCwgZW5kLCBEUk1f
TU1fSU5TRVJUX0JFU1QpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPm1tLnN0b2xlbl9sb2Nr
KTsKKwltdXRleF91bmxvY2soJmk5MTUtPm1tLnN0b2xlbl9sb2NrKTsKIAogCXJldHVybiByZXQ7
CiB9CiAKLWludCBpOTE1X2dlbV9zdG9sZW5faW5zZXJ0X25vZGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAoraW50IGk5MTVfZ2VtX3N0b2xlbl9pbnNlcnRfbm9kZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUsIHU2
NCBzaXplLAogCQkJCXVuc2lnbmVkIGFsaWdubWVudCkKIHsKLQlyZXR1cm4gaTkxNV9nZW1fc3Rv
bGVuX2luc2VydF9ub2RlX2luX3JhbmdlKGRldl9wcml2LCBub2RlLCBzaXplLAorCXJldHVybiBp
OTE1X2dlbV9zdG9sZW5faW5zZXJ0X25vZGVfaW5fcmFuZ2UoaTkxNSwgbm9kZSwgc2l6ZSwKIAkJ
CQkJCSAgICBhbGlnbm1lbnQsIDAsIFU2NF9NQVgpOwogfQogCi12b2lkIGk5MTVfZ2VtX3N0b2xl
bl9yZW1vdmVfbm9kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGk5
MTVfZ2VtX3N0b2xlbl9yZW1vdmVfbm9kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgc3RydWN0IGRybV9tbV9ub2RlICpub2RlKQogewotCW11dGV4X2xvY2soJmRldl9wcml2
LT5tbS5zdG9sZW5fbG9jayk7CisJbXV0ZXhfbG9jaygmaTkxNS0+bW0uc3RvbGVuX2xvY2spOwog
CWRybV9tbV9yZW1vdmVfbm9kZShub2RlKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5tbS5z
dG9sZW5fbG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5tbS5zdG9sZW5fbG9jayk7CiB9CiAK
LXN0YXRpYyBpbnQgaTkxNV9hZGp1c3Rfc3RvbGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyBpbnQgaTkxNV9hZGp1c3Rfc3RvbGVuKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICAgICAgc3RydWN0IHJlc291cmNlICpkc20pCiB7Ci0Jc3RydWN0
IGk5MTVfZ2d0dCAqZ2d0dCA9ICZkZXZfcHJpdi0+Z2d0dDsKKwlzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0ID0gJmk5MTUtPmdndHQ7CiAJc3RydWN0IHJlc291cmNlICpyOwogCiAJaWYgKGRzbS0+c3Rh
cnQgPT0gMCB8fCBkc20tPmVuZCA8PSBkc20tPnN0YXJ0KQpAQCAtNzcsMTQgKzc3LDE0IEBAIHN0
YXRpYyBpbnQgaTkxNV9hZGp1c3Rfc3RvbGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkgKi8KIAogCS8qIE1ha2Ugc3VyZSB3ZSBkb24ndCBjbG9iYmVyIHRoZSBHVFQgaWYg
aXQncyB3aXRoaW4gc3RvbGVuIG1lbW9yeSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9
IDQgJiYKLQkgICAgIUlTX0czMyhkZXZfcHJpdikgJiYgIUlTX1BJTkVWSUVXKGRldl9wcml2KSAm
JiAhSVNfRzRYKGRldl9wcml2KSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPD0gNCAmJgorCSAg
ICAhSVNfRzMzKGk5MTUpICYmICFJU19QSU5FVklFVyhpOTE1KSAmJiAhSVNfRzRYKGk5MTUpKSB7
CiAJCXN0cnVjdCByZXNvdXJjZSBzdG9sZW5bMl0gPSB7KmRzbSwgKmRzbX07CiAJCXN0cnVjdCBy
ZXNvdXJjZSBnZ3R0X3JlczsKIAkJcmVzb3VyY2Vfc2l6ZV90IGdndHRfc3RhcnQ7CiAKIAkJZ2d0
dF9zdGFydCA9IEk5MTVfUkVBRChQR1RCTF9DVEwpOwotCQlpZiAoSVNfR0VOKGRldl9wcml2LCA0
KSkKKwkJaWYgKElTX0dFTihpOTE1LCA0KSkKIAkJCWdndHRfc3RhcnQgPSAoZ2d0dF9zdGFydCAm
IFBHVEJMX0FERFJFU1NfTE9fTUFTSykgfAogCQkJCSAgICAgKGdndHRfc3RhcnQgJiBQR1RCTF9B
RERSRVNTX0hJX01BU0spIDw8IDI4OwogCQllbHNlCkBAIC0xMTgsNyArMTE4LDcgQEAgc3RhdGlj
IGludCBpOTE1X2FkanVzdF9zdG9sZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCSAqIGtlcm5lbC4gU28gaWYgdGhlIHJlZ2lvbiBpcyBhbHJlYWR5IG1hcmtlZCBhcyBidXN5
LCBzb21ldGhpbmcKIAkgKiBpcyBzZXJpb3VzbHkgd3JvbmcuCiAJICovCi0JciA9IGRldm1fcmVx
dWVzdF9tZW1fcmVnaW9uKGRldl9wcml2LT5kcm0uZGV2LCBkc20tPnN0YXJ0LAorCXIgPSBkZXZt
X3JlcXVlc3RfbWVtX3JlZ2lvbihpOTE1LT5kcm0uZGV2LCBkc20tPnN0YXJ0LAogCQkJCSAgICBy
ZXNvdXJjZV9zaXplKGRzbSksCiAJCQkJICAgICJHcmFwaGljcyBTdG9sZW4gTWVtb3J5Iik7CiAJ
aWYgKHIgPT0gTlVMTCkgewpAQCAtMTMxLDE0ICsxMzEsMTQgQEAgc3RhdGljIGludCBpOTE1X2Fk
anVzdF9zdG9sZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkgKiByZXNl
cnZhdGlvbiBzdGFydGluZyBmcm9tIDEgaW5zdGVhZCBvZiAwLgogCQkgKiBUaGVyZSdzIGFsc28g
QklPUyB3aXRoIG9mZi1ieS1vbmUgb24gdGhlIG90aGVyIGVuZC4KIAkJICovCi0JCXIgPSBkZXZt
X3JlcXVlc3RfbWVtX3JlZ2lvbihkZXZfcHJpdi0+ZHJtLmRldiwgZHNtLT5zdGFydCArIDEsCisJ
CXIgPSBkZXZtX3JlcXVlc3RfbWVtX3JlZ2lvbihpOTE1LT5kcm0uZGV2LCBkc20tPnN0YXJ0ICsg
MSwKIAkJCQkJICAgIHJlc291cmNlX3NpemUoZHNtKSAtIDIsCiAJCQkJCSAgICAiR3JhcGhpY3Mg
U3RvbGVuIE1lbW9yeSIpOwogCQkvKgogCQkgKiBHRU4zIGZpcm13YXJlIGxpa2VzIHRvIHNtYXNo
IHBjaSBicmlkZ2VzIGludG8gdGhlIHN0b2xlbgogCQkgKiByYW5nZS4gQXBwYXJlbnRseSB0aGlz
IHdvcmtzLgogCQkgKi8KLQkJaWYgKHIgPT0gTlVMTCAmJiAhSVNfR0VOKGRldl9wcml2LCAzKSkg
eworCQlpZiAociA9PSBOVUxMICYmICFJU19HRU4oaTkxNSwgMykpIHsKIAkJCURSTV9FUlJPUigi
Y29uZmxpY3QgZGV0ZWN0ZWQgd2l0aCBzdG9sZW4gcmVnaW9uOiAlcFJcbiIsCiAJCQkJICBkc20p
OwogCkBAIC0xNDksMjUgKzE0OSwyNSBAQCBzdGF0aWMgaW50IGk5MTVfYWRqdXN0X3N0b2xlbihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQg
aTkxNV9nZW1fY2xlYW51cF9zdG9sZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQordm9pZCBpOTE1X2dlbV9jbGVhbnVwX3N0b2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlpZiAoIWRybV9tbV9pbml0aWFsaXplZCgmZGV2X3ByaXYtPm1tLnN0b2xlbikp
CisJaWYgKCFkcm1fbW1faW5pdGlhbGl6ZWQoJmk5MTUtPm1tLnN0b2xlbikpCiAJCXJldHVybjsK
IAotCWRybV9tbV90YWtlZG93bigmZGV2X3ByaXYtPm1tLnN0b2xlbik7CisJZHJtX21tX3Rha2Vk
b3duKCZpOTE1LT5tbS5zdG9sZW4pOwogfQogCi1zdGF0aWMgdm9pZCBnNHhfZ2V0X3N0b2xlbl9y
ZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBn
NHhfZ2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQkgICAgcmVzb3VyY2Vfc2l6ZV90ICpiYXNlLAogCQkJCSAgICByZXNvdXJjZV9zaXplX3QgKnNp
emUpCiB7Ci0JdTMyIHJlZ192YWwgPSBJOTE1X1JFQUQoSVNfR000NShkZXZfcHJpdikgPworCXUz
MiByZWdfdmFsID0gSTkxNV9SRUFEKElTX0dNNDUoaTkxNSkgPwogCQkJCUNUR19TVE9MRU5fUkVT
RVJWRUQgOgogCQkJCUVMS19TVE9MRU5fUkVTRVJWRUQpOwotCXJlc291cmNlX3NpemVfdCBzdG9s
ZW5fdG9wID0gZGV2X3ByaXYtPmRzbS5lbmQgKyAxOworCXJlc291cmNlX3NpemVfdCBzdG9sZW5f
dG9wID0gaTkxNS0+ZHNtLmVuZCArIDE7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCIlc19TVE9MRU5f
UkVTRVJWRUQgPSAlMDh4XG4iLAotCQkJIElTX0dNNDUoZGV2X3ByaXYpID8gIkNURyIgOiAiRUxL
IiwgcmVnX3ZhbCk7CisJCQkgSVNfR000NShpOTE1KSA/ICJDVEciIDogIkVMSyIsIHJlZ192YWwp
OwogCiAJaWYgKChyZWdfdmFsICYgRzRYX1NUT0xFTl9SRVNFUlZFRF9FTkFCTEUpID09IDApCiAJ
CXJldHVybjsKQEAgLTE3Niw3ICsxNzYsNyBAQCBzdGF0aWMgdm9pZCBnNHhfZ2V0X3N0b2xlbl9y
ZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogV2hldGhlciBJ
TEsgcmVhbGx5IHJldXNlcyB0aGUgRUxLIHJlZ2lzdGVyIGZvciB0aGlzIGlzIHVuY2xlYXIuCiAJ
ICogTGV0J3Mgc2VlIGlmIHdlIGNhdGNoIGFueW9uZSB3aXRoIHRoaXMgc3VwcG9zZWRseSBlbmFi
bGVkIG9uIElMSy4KIAkgKi8KLQlXQVJOKElTX0dFTihkZXZfcHJpdiwgNSksICJJTEsgc3RvbGVu
IHJlc2VydmVkIGZvdW5kPyAweCUwOHhcbiIsCisJV0FSTihJU19HRU4oaTkxNSwgNSksICJJTEsg
c3RvbGVuIHJlc2VydmVkIGZvdW5kPyAweCUwOHhcbiIsCiAJICAgICByZWdfdmFsKTsKIAogCWlm
ICghKHJlZ192YWwgJiBHNFhfU1RPTEVOX1JFU0VSVkVEX0FERFIyX01BU0spKQpAQCAtMTg4LDcg
KzE4OCw3IEBAIHN0YXRpYyB2b2lkIGc0eF9nZXRfc3RvbGVuX3Jlc2VydmVkKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkqc2l6ZSA9IHN0b2xlbl90b3AgLSAqYmFzZTsKIH0K
IAotc3RhdGljIHZvaWQgZ2VuNl9nZXRfc3RvbGVuX3Jlc2VydmVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGdlbjZfZ2V0X3N0b2xlbl9yZXNlcnZlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIHJlc291cmNlX3NpemVfdCAq
YmFzZSwKIAkJCQkgICAgIHJlc291cmNlX3NpemVfdCAqc2l6ZSkKIHsKQEAgLTIyMCwxMiArMjIw
LDEyIEBAIHN0YXRpYyB2b2lkIGdlbjZfZ2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0aWMgdm9pZCB2bHZfZ2V0X3N0b2xl
bl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9p
ZCB2bHZfZ2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgICAgcmVzb3VyY2Vfc2l6ZV90ICpiYXNlLAogCQkJCSAgICByZXNvdXJjZV9zaXplX3Qg
KnNpemUpCiB7CiAJdTMyIHJlZ192YWwgPSBJOTE1X1JFQUQoR0VONl9TVE9MRU5fUkVTRVJWRUQp
OwotCXJlc291cmNlX3NpemVfdCBzdG9sZW5fdG9wID0gZGV2X3ByaXYtPmRzbS5lbmQgKyAxOwor
CXJlc291cmNlX3NpemVfdCBzdG9sZW5fdG9wID0gaTkxNS0+ZHNtLmVuZCArIDE7CiAKIAlEUk1f
REVCVUdfRFJJVkVSKCJHRU42X1NUT0xFTl9SRVNFUlZFRCA9ICUwOHhcbiIsIHJlZ192YWwpOwog
CkBAIC0yNDgsNyArMjQ4LDcgQEAgc3RhdGljIHZvaWQgdmx2X2dldF9zdG9sZW5fcmVzZXJ2ZWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSpiYXNlID0gc3RvbGVuX3RvcCAt
ICpzaXplOwogfQogCi1zdGF0aWMgdm9pZCBnZW43X2dldF9zdG9sZW5fcmVzZXJ2ZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgZ2VuN19nZXRfc3RvbGVu
X3Jlc2VydmVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgcmVzb3Vy
Y2Vfc2l6ZV90ICpiYXNlLAogCQkJCSAgICAgcmVzb3VyY2Vfc2l6ZV90ICpzaXplKQogewpAQCAt
Mjc0LDcgKzI3NCw3IEBAIHN0YXRpYyB2b2lkIGdlbjdfZ2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0aWMgdm9pZCBjaHZf
Z2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdm9pZCBjaHZfZ2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkgICAgcmVzb3VyY2Vfc2l6ZV90ICpiYXNlLAogCQkJCSAgICByZXNvdXJj
ZV9zaXplX3QgKnNpemUpCiB7CkBAIC0zMDYsMTIgKzMwNiwxMiBAQCBzdGF0aWMgdm9pZCBjaHZf
Z2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
fQogfQogCi1zdGF0aWMgdm9pZCBiZHdfZ2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBiZHdfZ2V0X3N0b2xlbl9yZXNlcnZl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgcmVzb3VyY2Vfc2l6ZV90
ICpiYXNlLAogCQkJCSAgICByZXNvdXJjZV9zaXplX3QgKnNpemUpCiB7CiAJdTMyIHJlZ192YWwg
PSBJOTE1X1JFQUQoR0VONl9TVE9MRU5fUkVTRVJWRUQpOwotCXJlc291cmNlX3NpemVfdCBzdG9s
ZW5fdG9wID0gZGV2X3ByaXYtPmRzbS5lbmQgKyAxOworCXJlc291cmNlX3NpemVfdCBzdG9sZW5f
dG9wID0gaTkxNS0+ZHNtLmVuZCArIDE7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCJHRU42X1NUT0xF
Tl9SRVNFUlZFRCA9ICUwOHhcbiIsIHJlZ192YWwpOwogCkBAIC0zNTQsMTkgKzM1NCwxOSBAQCBz
dGF0aWMgdm9pZCBpY2xfZ2V0X3N0b2xlbl9yZXNlcnZlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAl9CiB9CiAKLWludCBpOTE1X2dlbV9pbml0X3N0b2xlbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaTkxNV9nZW1faW5pdF9zdG9sZW4oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJcmVzb3VyY2Vfc2l6ZV90IHJlc2VydmVkX2Jhc2Us
IHN0b2xlbl90b3A7CiAJcmVzb3VyY2Vfc2l6ZV90IHJlc2VydmVkX3RvdGFsLCByZXNlcnZlZF9z
aXplOwogCi0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPm1tLnN0b2xlbl9sb2NrKTsKKwltdXRleF9p
bml0KCZpOTE1LT5tbS5zdG9sZW5fbG9jayk7CiAKLQlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoZGV2
X3ByaXYpKSB7CisJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5MTUpKSB7CiAJCURSTV9JTkZPKCJp
R1ZULWcgYWN0aXZlLCBkaXNhYmxpbmcgdXNlIG9mIHN0b2xlbiBtZW1vcnlcbiIpOwogCQlyZXR1
cm4gMDsKIAl9CiAKLQlpZiAoaW50ZWxfdnRkX2FjdGl2ZSgpICYmIElOVEVMX0dFTihkZXZfcHJp
dikgPCA4KSB7CisJaWYgKGludGVsX3Z0ZF9hY3RpdmUoKSAmJiBJTlRFTF9HRU4oaTkxNSkgPCA4
KSB7CiAJCURSTV9JTkZPKCJETUFSIGFjdGl2ZSwgZGlzYWJsaW5nIHVzZSBvZiBzdG9sZW4gbWVt
b3J5XG4iKTsKIAkJcmV0dXJuIDA7CiAJfQpAQCAtMzc0LDU1ICszNzQsNTUgQEAgaW50IGk5MTVf
Z2VtX2luaXRfc3RvbGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpZiAo
cmVzb3VyY2Vfc2l6ZSgmaW50ZWxfZ3JhcGhpY3Nfc3RvbGVuX3JlcykgPT0gMCkKIAkJcmV0dXJu
IDA7CiAKLQlkZXZfcHJpdi0+ZHNtID0gaW50ZWxfZ3JhcGhpY3Nfc3RvbGVuX3JlczsKKwlpOTE1
LT5kc20gPSBpbnRlbF9ncmFwaGljc19zdG9sZW5fcmVzOwogCi0JaWYgKGk5MTVfYWRqdXN0X3N0
b2xlbihkZXZfcHJpdiwgJmRldl9wcml2LT5kc20pKQorCWlmIChpOTE1X2FkanVzdF9zdG9sZW4o
aTkxNSwgJmk5MTUtPmRzbSkpCiAJCXJldHVybiAwOwogCi0JR0VNX0JVR19PTihkZXZfcHJpdi0+
ZHNtLnN0YXJ0ID09IDApOwotCUdFTV9CVUdfT04oZGV2X3ByaXYtPmRzbS5lbmQgPD0gZGV2X3By
aXYtPmRzbS5zdGFydCk7CisJR0VNX0JVR19PTihpOTE1LT5kc20uc3RhcnQgPT0gMCk7CisJR0VN
X0JVR19PTihpOTE1LT5kc20uZW5kIDw9IGk5MTUtPmRzbS5zdGFydCk7CiAKLQlzdG9sZW5fdG9w
ID0gZGV2X3ByaXYtPmRzbS5lbmQgKyAxOworCXN0b2xlbl90b3AgPSBpOTE1LT5kc20uZW5kICsg
MTsKIAlyZXNlcnZlZF9iYXNlID0gc3RvbGVuX3RvcDsKIAlyZXNlcnZlZF9zaXplID0gMDsKIAot
CXN3aXRjaCAoSU5URUxfR0VOKGRldl9wcml2KSkgeworCXN3aXRjaCAoSU5URUxfR0VOKGk5MTUp
KSB7CiAJY2FzZSAyOgogCWNhc2UgMzoKIAkJYnJlYWs7CiAJY2FzZSA0OgotCQlpZiAoIUlTX0c0
WChkZXZfcHJpdikpCisJCWlmICghSVNfRzRYKGk5MTUpKQogCQkJYnJlYWs7CiAJCS8qIGZhbGwg
dGhyb3VnaCAqLwogCWNhc2UgNToKLQkJZzR4X2dldF9zdG9sZW5fcmVzZXJ2ZWQoZGV2X3ByaXYs
CisJCWc0eF9nZXRfc3RvbGVuX3Jlc2VydmVkKGk5MTUsCiAJCQkJCSZyZXNlcnZlZF9iYXNlLCAm
cmVzZXJ2ZWRfc2l6ZSk7CiAJCWJyZWFrOwogCWNhc2UgNjoKLQkJZ2VuNl9nZXRfc3RvbGVuX3Jl
c2VydmVkKGRldl9wcml2LAorCQlnZW42X2dldF9zdG9sZW5fcmVzZXJ2ZWQoaTkxNSwKIAkJCQkJ
ICZyZXNlcnZlZF9iYXNlLCAmcmVzZXJ2ZWRfc2l6ZSk7CiAJCWJyZWFrOwogCWNhc2UgNzoKLQkJ
aWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQotCQkJdmx2X2dldF9zdG9sZW5fcmVzZXJ2ZWQo
ZGV2X3ByaXYsCisJCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpKQorCQkJdmx2X2dldF9zdG9sZW5f
cmVzZXJ2ZWQoaTkxNSwKIAkJCQkJCSZyZXNlcnZlZF9iYXNlLCAmcmVzZXJ2ZWRfc2l6ZSk7CiAJ
CWVsc2UKLQkJCWdlbjdfZ2V0X3N0b2xlbl9yZXNlcnZlZChkZXZfcHJpdiwKKwkJCWdlbjdfZ2V0
X3N0b2xlbl9yZXNlcnZlZChpOTE1LAogCQkJCQkJICZyZXNlcnZlZF9iYXNlLCAmcmVzZXJ2ZWRf
c2l6ZSk7CiAJCWJyZWFrOwogCWNhc2UgODoKIAljYXNlIDk6CiAJY2FzZSAxMDoKLQkJaWYgKElT
X0xQKGRldl9wcml2KSkKLQkJCWNodl9nZXRfc3RvbGVuX3Jlc2VydmVkKGRldl9wcml2LAorCQlp
ZiAoSVNfTFAoaTkxNSkpCisJCQljaHZfZ2V0X3N0b2xlbl9yZXNlcnZlZChpOTE1LAogCQkJCQkJ
JnJlc2VydmVkX2Jhc2UsICZyZXNlcnZlZF9zaXplKTsKIAkJZWxzZQotCQkJYmR3X2dldF9zdG9s
ZW5fcmVzZXJ2ZWQoZGV2X3ByaXYsCisJCQliZHdfZ2V0X3N0b2xlbl9yZXNlcnZlZChpOTE1LAog
CQkJCQkJJnJlc2VydmVkX2Jhc2UsICZyZXNlcnZlZF9zaXplKTsKIAkJYnJlYWs7CiAJY2FzZSAx
MToKIAlkZWZhdWx0OgotCQlpY2xfZ2V0X3N0b2xlbl9yZXNlcnZlZChkZXZfcHJpdiwgJnJlc2Vy
dmVkX2Jhc2UsCisJCWljbF9nZXRfc3RvbGVuX3Jlc2VydmVkKGk5MTUsICZyZXNlcnZlZF9iYXNl
LAogCQkJCQkmcmVzZXJ2ZWRfc2l6ZSk7CiAJCWJyZWFrOwogCX0KQEAgLTQzOSwxMiArNDM5LDEy
IEBAIGludCBpOTE1X2dlbV9pbml0X3N0b2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJCXJlc2VydmVkX3NpemUgPSAwOwogCX0KIAotCWRldl9wcml2LT5kc21fcmVzZXJ2
ZWQgPQorCWk5MTUtPmRzbV9yZXNlcnZlZCA9CiAJCShzdHJ1Y3QgcmVzb3VyY2UpIERFRklORV9S
RVNfTUVNKHJlc2VydmVkX2Jhc2UsIHJlc2VydmVkX3NpemUpOwogCi0JaWYgKCFyZXNvdXJjZV9j
b250YWlucygmZGV2X3ByaXYtPmRzbSwgJmRldl9wcml2LT5kc21fcmVzZXJ2ZWQpKSB7CisJaWYg
KCFyZXNvdXJjZV9jb250YWlucygmaTkxNS0+ZHNtLCAmaTkxNS0+ZHNtX3Jlc2VydmVkKSkgewog
CQlEUk1fRVJST1IoIlN0b2xlbiByZXNlcnZlZCBhcmVhICVwUiBvdXRzaWRlIHN0b2xlbiBtZW1v
cnkgJXBSXG4iLAotCQkJICAmZGV2X3ByaXYtPmRzbV9yZXNlcnZlZCwgJmRldl9wcml2LT5kc20p
OworCQkJICAmaTkxNS0+ZHNtX3Jlc2VydmVkLCAmaTkxNS0+ZHNtKTsKIAkJcmV0dXJuIDA7CiAJ
fQogCkBAIC00NTMsMTQgKzQ1MywxNCBAQCBpbnQgaTkxNV9nZW1faW5pdF9zdG9sZW4oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJlc2VydmVkX3RvdGFsID0gc3RvbGVuX3Rv
cCAtIHJlc2VydmVkX2Jhc2U7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCJNZW1vcnkgcmVzZXJ2ZWQg
Zm9yIGdyYXBoaWNzIGRldmljZTogJWxsdUssIHVzYWJsZTogJWxsdUtcbiIsCi0JCQkgKHU2NCly
ZXNvdXJjZV9zaXplKCZkZXZfcHJpdi0+ZHNtKSA+PiAxMCwKLQkJCSAoKHU2NClyZXNvdXJjZV9z
aXplKCZkZXZfcHJpdi0+ZHNtKSAtIHJlc2VydmVkX3RvdGFsKSA+PiAxMCk7CisJCQkgKHU2NCly
ZXNvdXJjZV9zaXplKCZpOTE1LT5kc20pID4+IDEwLAorCQkJICgodTY0KXJlc291cmNlX3NpemUo
Jmk5MTUtPmRzbSkgLSByZXNlcnZlZF90b3RhbCkgPj4gMTApOwogCi0JZGV2X3ByaXYtPnN0b2xl
bl91c2FibGVfc2l6ZSA9Ci0JCXJlc291cmNlX3NpemUoJmRldl9wcml2LT5kc20pIC0gcmVzZXJ2
ZWRfdG90YWw7CisJaTkxNS0+c3RvbGVuX3VzYWJsZV9zaXplID0KKwkJcmVzb3VyY2Vfc2l6ZSgm
aTkxNS0+ZHNtKSAtIHJlc2VydmVkX3RvdGFsOwogCiAJLyogQmFzaWMgbWVtcmFuZ2UgYWxsb2Nh
dG9yIGZvciBzdG9sZW4gc3BhY2UuICovCi0JZHJtX21tX2luaXQoJmRldl9wcml2LT5tbS5zdG9s
ZW4sIDAsIGRldl9wcml2LT5zdG9sZW5fdXNhYmxlX3NpemUpOworCWRybV9tbV9pbml0KCZpOTE1
LT5tbS5zdG9sZW4sIDAsIGk5MTUtPnN0b2xlbl91c2FibGVfc2l6ZSk7CiAKIAlyZXR1cm4gMDsK
IH0KQEAgLTQ2OSwxMSArNDY5LDExIEBAIHN0YXRpYyBzdHJ1Y3Qgc2dfdGFibGUgKgogaTkxNV9w
YWdlc19jcmVhdGVfZm9yX3N0b2xlbihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJICAgICBy
ZXNvdXJjZV9zaXplX3Qgb2Zmc2V0LCByZXNvdXJjZV9zaXplX3Qgc2l6ZSkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IHNnX3RhYmxlICpzdDsK
IAlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwogCi0JR0VNX0JVR19PTihyYW5nZV9vdmVyZmxvd3Mo
b2Zmc2V0LCBzaXplLCByZXNvdXJjZV9zaXplKCZkZXZfcHJpdi0+ZHNtKSkpOworCUdFTV9CVUdf
T04ocmFuZ2Vfb3ZlcmZsb3dzKG9mZnNldCwgc2l6ZSwgcmVzb3VyY2Vfc2l6ZSgmaTkxNS0+ZHNt
KSkpOwogCiAJLyogV2UgaGlkZSB0aGF0IHdlIGhhdmUgbm8gc3RydWN0IHBhZ2UgYmFja2luZyBv
dXIgc3RvbGVuIG9iamVjdAogCSAqIGJ5IHdyYXBwaW5nIHRoZSBjb250aWd1b3VzIHBoeXNpY2Fs
IGFsbG9jYXRpb24gd2l0aCBhIGZha2UKQEAgLTQ5Myw3ICs0OTMsNyBAQCBpOTE1X3BhZ2VzX2Ny
ZWF0ZV9mb3Jfc3RvbGVuKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJc2ctPm9mZnNldCA9IDA7
CiAJc2ctPmxlbmd0aCA9IHNpemU7CiAKLQlzZ19kbWFfYWRkcmVzcyhzZykgPSAoZG1hX2FkZHJf
dClkZXZfcHJpdi0+ZHNtLnN0YXJ0ICsgb2Zmc2V0OworCXNnX2RtYV9hZGRyZXNzKHNnKSA9IChk
bWFfYWRkcl90KWk5MTUtPmRzbS5zdGFydCArIG9mZnNldDsKIAlzZ19kbWFfbGVuKHNnKSA9IHNp
emU7CiAKIAlyZXR1cm4gc3Q7CkBAIC01MjQsMTQgKzUyNCwxNCBAQCBzdGF0aWMgdm9pZCBpOTE1
X2dlbV9vYmplY3RfcHV0X3BhZ2VzX3N0b2xlbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogc3RhdGljIHZvaWQKIGk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3N0b2xlbihzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fbW1fbm9kZSAq
c3RvbGVuID0gZmV0Y2hfYW5kX3plcm8oJm9iai0+c3RvbGVuKTsKIAogCUdFTV9CVUdfT04oIXN0
b2xlbik7CiAKIAlfX2k5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCi0JaTkxNV9n
ZW1fc3RvbGVuX3JlbW92ZV9ub2RlKGRldl9wcml2LCBzdG9sZW4pOworCWk5MTVfZ2VtX3N0b2xl
bl9yZW1vdmVfbm9kZShpOTE1LCBzdG9sZW4pOwogCWtmcmVlKHN0b2xlbik7CiB9CiAKQEAgLTU0
Miw3ICs1NDIsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3Bz
IGk5MTVfZ2VtX29iamVjdF9zdG9sZW5fb3BzID0gewogfTsKIAogc3RhdGljIHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICoKLV9pOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitfaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9s
ZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgc3RydWN0IGRybV9t
bV9ub2RlICpzdG9sZW4pCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKQEAg
LTU1MiwxMiArNTUyLDEyIEBAIF9pOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKG9iaiA9PSBOVUxMKQogCQlyZXR1cm4g
TlVMTDsKIAotCWRybV9nZW1fcHJpdmF0ZV9vYmplY3RfaW5pdCgmZGV2X3ByaXYtPmRybSwgJm9i
ai0+YmFzZSwgc3RvbGVuLT5zaXplKTsKKwlkcm1fZ2VtX3ByaXZhdGVfb2JqZWN0X2luaXQoJmk5
MTUtPmRybSwgJm9iai0+YmFzZSwgc3RvbGVuLT5zaXplKTsKIAlpOTE1X2dlbV9vYmplY3RfaW5p
dChvYmosICZpOTE1X2dlbV9vYmplY3Rfc3RvbGVuX29wcyk7CiAKIAlvYmotPnN0b2xlbiA9IHN0
b2xlbjsKIAlvYmotPnJlYWRfZG9tYWlucyA9IEk5MTVfR0VNX0RPTUFJTl9DUFUgfCBJOTE1X0dF
TV9ET01BSU5fR1RUOwotCWNhY2hlX2xldmVsID0gSEFTX0xMQyhkZXZfcHJpdikgPyBJOTE1X0NB
Q0hFX0xMQyA6IEk5MTVfQ0FDSEVfTk9ORTsKKwljYWNoZV9sZXZlbCA9IEhBU19MTEMoaTkxNSkg
PyBJOTE1X0NBQ0hFX0xMQyA6IEk5MTVfQ0FDSEVfTk9ORTsKIAlpOTE1X2dlbV9vYmplY3Rfc2V0
X2NhY2hlX2NvaGVyZW5jeShvYmosIGNhY2hlX2xldmVsKTsKIAogCWlmIChpOTE1X2dlbV9vYmpl
Y3RfcGluX3BhZ2VzKG9iaikpCkBAIC01NzEsMTQgKzU3MSwxNCBAQCBfaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9zdG9sZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqCi1pOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xl
bihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX3N0b2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIHJlc291
cmNlX3NpemVfdCBzaXplKQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJ
c3RydWN0IGRybV9tbV9ub2RlICpzdG9sZW47CiAJaW50IHJldDsKIAotCWlmICghZHJtX21tX2lu
aXRpYWxpemVkKCZkZXZfcHJpdi0+bW0uc3RvbGVuKSkKKwlpZiAoIWRybV9tbV9pbml0aWFsaXpl
ZCgmaTkxNS0+bW0uc3RvbGVuKSkKIAkJcmV0dXJuIE5VTEw7CiAKIAlpZiAoc2l6ZSA9PSAwKQpA
QCAtNTg4LDM3ICs1ODgsMzcgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlmICghc3RvbGVuKQogCQlyZXR1cm4gTlVM
TDsKIAotCXJldCA9IGk5MTVfZ2VtX3N0b2xlbl9pbnNlcnRfbm9kZShkZXZfcHJpdiwgc3RvbGVu
LCBzaXplLCA0MDk2KTsKKwlyZXQgPSBpOTE1X2dlbV9zdG9sZW5faW5zZXJ0X25vZGUoaTkxNSwg
c3RvbGVuLCBzaXplLCA0MDk2KTsKIAlpZiAocmV0KSB7CiAJCWtmcmVlKHN0b2xlbik7CiAJCXJl
dHVybiBOVUxMOwogCX0KIAotCW9iaiA9IF9pOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbihk
ZXZfcHJpdiwgc3RvbGVuKTsKKwlvYmogPSBfaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4o
aTkxNSwgc3RvbGVuKTsKIAlpZiAob2JqKQogCQlyZXR1cm4gb2JqOwogCi0JaTkxNV9nZW1fc3Rv
bGVuX3JlbW92ZV9ub2RlKGRldl9wcml2LCBzdG9sZW4pOworCWk5MTVfZ2VtX3N0b2xlbl9yZW1v
dmVfbm9kZShpOTE1LCBzdG9sZW4pOwogCWtmcmVlKHN0b2xlbik7CiAJcmV0dXJuIE5VTEw7CiB9
CiAKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoKLWk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
c3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAoraTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgICAgIHJlc291cmNlX3NpemVfdCBzdG9s
ZW5fb2Zmc2V0LAogCQkJCQkgICAgICAgcmVzb3VyY2Vfc2l6ZV90IGd0dF9vZmZzZXQsCiAJCQkJ
CSAgICAgICByZXNvdXJjZV9zaXplX3Qgc2l6ZSkKIHsKLQlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0
ID0gJmRldl9wcml2LT5nZ3R0OworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0
dDsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBkcm1fbW1fbm9k
ZSAqc3RvbGVuOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCByZXQ7CiAKLQlpZiAoIWRy
bV9tbV9pbml0aWFsaXplZCgmZGV2X3ByaXYtPm1tLnN0b2xlbikpCisJaWYgKCFkcm1fbW1faW5p
dGlhbGl6ZWQoJmk5MTUtPm1tLnN0b2xlbikpCiAJCXJldHVybiBOVUxMOwogCi0JbG9ja2RlcF9h
c3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJRFJNX0RFQlVHX0RSSVZFUigiY3Jl
YXRpbmcgcHJlYWxsb2NhdGVkIHN0b2xlbiBvYmplY3Q6IHN0b2xlbl9vZmZzZXQ9JXBhLCBndHRf
b2Zmc2V0PSVwYSwgc2l6ZT0lcGFcbiIsCiAJCQkgJnN0b2xlbl9vZmZzZXQsICZndHRfb2Zmc2V0
LCAmc2l6ZSk7CkBAIC02MzUsMTkgKzYzNSwxOSBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0
b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgog
CiAJc3RvbGVuLT5zdGFydCA9IHN0b2xlbl9vZmZzZXQ7CiAJc3RvbGVuLT5zaXplID0gc2l6ZTsK
LQltdXRleF9sb2NrKCZkZXZfcHJpdi0+bW0uc3RvbGVuX2xvY2spOwotCXJldCA9IGRybV9tbV9y
ZXNlcnZlX25vZGUoJmRldl9wcml2LT5tbS5zdG9sZW4sIHN0b2xlbik7Ci0JbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+bW0uc3RvbGVuX2xvY2spOworCW11dGV4X2xvY2soJmk5MTUtPm1tLnN0b2xl
bl9sb2NrKTsKKwlyZXQgPSBkcm1fbW1fcmVzZXJ2ZV9ub2RlKCZpOTE1LT5tbS5zdG9sZW4sIHN0
b2xlbik7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5tbS5zdG9sZW5fbG9jayk7CiAJaWYgKHJldCkg
ewogCQlEUk1fREVCVUdfRFJJVkVSKCJmYWlsZWQgdG8gYWxsb2NhdGUgc3RvbGVuIHNwYWNlXG4i
KTsKIAkJa2ZyZWUoc3RvbGVuKTsKIAkJcmV0dXJuIE5VTEw7CiAJfQogCi0Jb2JqID0gX2k5MTVf
Z2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGRldl9wcml2LCBzdG9sZW4pOworCW9iaiA9IF9pOTE1
X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbihpOTE1LCBzdG9sZW4pOwogCWlmIChvYmogPT0gTlVM
TCkgewogCQlEUk1fREVCVUdfRFJJVkVSKCJmYWlsZWQgdG8gYWxsb2NhdGUgc3RvbGVuIG9iamVj
dFxuIik7Ci0JCWk5MTVfZ2VtX3N0b2xlbl9yZW1vdmVfbm9kZShkZXZfcHJpdiwgc3RvbGVuKTsK
KwkJaTkxNV9nZW1fc3RvbGVuX3JlbW92ZV9ub2RlKGk5MTUsIHN0b2xlbik7CiAJCWtmcmVlKHN0
b2xlbik7CiAJCXJldHVybiBOVUxMOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV90aWxpbmcuYwppbmRleCBjYTBjMmY0NTE3NDIuLjQ2YjUyM2Q0ZWQ4NCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYwpAQCAtMzk4LDcgKzM5OCw3IEBA
IGk5MTVfZ2VtX2dldF90aWxpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAq
ZGF0YSwKIAkJCSAgc3RydWN0IGRybV9maWxlICpmaWxlKQogewogCXN0cnVjdCBkcm1faTkxNV9n
ZW1fZ2V0X3RpbGluZyAqYXJncyA9IGRhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJaW50IGVy
ciA9IC1FTk9FTlQ7CiAKQEAgLTQxNSwxMCArNDE1LDEwIEBAIGk5MTVfZ2VtX2dldF90aWxpbmdf
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAogCXN3aXRjaCAoYXJn
cy0+dGlsaW5nX21vZGUpIHsKIAljYXNlIEk5MTVfVElMSU5HX1g6Ci0JCWFyZ3MtPnN3aXp6bGVf
bW9kZSA9IGRldl9wcml2LT5tbS5iaXRfNl9zd2l6emxlX3g7CisJCWFyZ3MtPnN3aXp6bGVfbW9k
ZSA9IGk5MTUtPm1tLmJpdF82X3N3aXp6bGVfeDsKIAkJYnJlYWs7CiAJY2FzZSBJOTE1X1RJTElO
R19ZOgotCQlhcmdzLT5zd2l6emxlX21vZGUgPSBkZXZfcHJpdi0+bW0uYml0XzZfc3dpenpsZV95
OworCQlhcmdzLT5zd2l6emxlX21vZGUgPSBpOTE1LT5tbS5iaXRfNl9zd2l6emxlX3k7CiAJCWJy
ZWFrOwogCWRlZmF1bHQ6CiAJY2FzZSBJOTE1X1RJTElOR19OT05FOgpAQCAtNDI3LDcgKzQyNyw3
IEBAIGk5MTVfZ2VtX2dldF90aWxpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAl9CiAKIAkvKiBIaWRlIGJpdCAxNyBmcm9tIHRoZSB1c2VyIC0tIHNlZSBjb21t
ZW50IGluIGk5MTVfZ2VtX3NldF90aWxpbmcgKi8KLQlpZiAoZGV2X3ByaXYtPnF1aXJrcyAmIFFV
SVJLX1BJTl9TV0laWkxFRF9QQUdFUykKKwlpZiAoaTkxNS0+cXVpcmtzICYgUVVJUktfUElOX1NX
SVpaTEVEX1BBR0VTKQogCQlhcmdzLT5waHlzX3N3aXp6bGVfbW9kZSA9IEk5MTVfQklUXzZfU1dJ
WlpMRV9VTktOT1dOOwogCWVsc2UKIAkJYXJncy0+cGh5c19zd2l6emxlX21vZGUgPSBhcmdzLT5z
d2l6emxlX21vZGU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fdXNlcnB0ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIu
YwppbmRleCA1MjhiNjE2NzgzMzQuLmYyMmUxMGU4ODk1YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCkBAIC0zMjcsMTIgKzMyNywxMiBAQCBpOTE1X21t
dV9ub3RpZmllcl9mcmVlKHN0cnVjdCBpOTE1X21tdV9ub3RpZmllciAqbW4sCiAjZW5kaWYKIAog
c3RhdGljIHN0cnVjdCBpOTE1X21tX3N0cnVjdCAqCi1fX2k5MTVfbW1fc3RydWN0X2ZpbmQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBzdHJ1Y3QgbW1fc3RydWN0ICpyZWFsKQor
X19pOTE1X21tX3N0cnVjdF9maW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1
Y3QgbW1fc3RydWN0ICpyZWFsKQogewogCXN0cnVjdCBpOTE1X21tX3N0cnVjdCAqbW07CiAKLQkv
KiBQcm90ZWN0ZWQgYnkgZGV2X3ByaXYtPm1tX2xvY2sgKi8KLQloYXNoX2Zvcl9lYWNoX3Bvc3Np
YmxlKGRldl9wcml2LT5tbV9zdHJ1Y3RzLCBtbSwgbm9kZSwgKHVuc2lnbmVkIGxvbmcpcmVhbCkK
KwkvKiBQcm90ZWN0ZWQgYnkgaTkxNS0+bW1fbG9jayAqLworCWhhc2hfZm9yX2VhY2hfcG9zc2li
bGUoaTkxNS0+bW1fc3RydWN0cywgbW0sIG5vZGUsICh1bnNpZ25lZCBsb25nKXJlYWwpCiAJCWlm
IChtbS0+bW0gPT0gcmVhbCkKIAkJCXJldHVybiBtbTsKIApAQCAtMzQyLDcgKzM0Miw3IEBAIF9f
aTkxNV9tbV9zdHJ1Y3RfZmluZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0
cnVjdCBtbV9zdHJ1Y3QgKnJlYWwpCiBzdGF0aWMgaW50CiBpOTE1X2dlbV91c2VycHRyX2luaXRf
X21tX3N0cnVjdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwogCXN0
cnVjdCBpOTE1X21tX3N0cnVjdCAqbW07CiAJaW50IHJldCA9IDA7CiAKQEAgLTM1Niw4ICszNTYs
OCBAQCBpOTE1X2dlbV91c2VycHRyX2luaXRfX21tX3N0cnVjdChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCSAqIHN0cnVjdF9tdXRleCwgaS5lLiB3ZSBuZWVkIHRvIHNjaGVkdWxl
IGEgd29ya2VyIHRvIGRvIHRoZSBjbGVhbgogCSAqIHVwLgogCSAqLwotCW11dGV4X2xvY2soJmRl
dl9wcml2LT5tbV9sb2NrKTsKLQltbSA9IF9faTkxNV9tbV9zdHJ1Y3RfZmluZChkZXZfcHJpdiwg
Y3VycmVudC0+bW0pOworCW11dGV4X2xvY2soJmk5MTUtPm1tX2xvY2spOworCW1tID0gX19pOTE1
X21tX3N0cnVjdF9maW5kKGk5MTUsIGN1cnJlbnQtPm1tKTsKIAlpZiAobW0gPT0gTlVMTCkgewog
CQltbSA9IGttYWxsb2Moc2l6ZW9mKCptbSksIEdGUF9LRVJORUwpOwogCQlpZiAobW0gPT0gTlVM
TCkgewpAQCAtMzczLDE1ICszNzMsMTUgQEAgaTkxNV9nZW1fdXNlcnB0cl9pbml0X19tbV9zdHJ1
Y3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAogCQltbS0+bW4gPSBOVUxMOwog
Ci0JCS8qIFByb3RlY3RlZCBieSBkZXZfcHJpdi0+bW1fbG9jayAqLwotCQloYXNoX2FkZChkZXZf
cHJpdi0+bW1fc3RydWN0cywKKwkJLyogUHJvdGVjdGVkIGJ5IGk5MTUtPm1tX2xvY2sgKi8KKwkJ
aGFzaF9hZGQoaTkxNS0+bW1fc3RydWN0cywKIAkJCSAmbW0tPm5vZGUsICh1bnNpZ25lZCBsb25n
KW1tLT5tbSk7CiAJfSBlbHNlCiAJCWtyZWZfZ2V0KCZtbS0+a3JlZik7CiAKIAlvYmotPnVzZXJw
dHIubW0gPSBtbTsKIG91dDoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5tbV9sb2NrKTsKKwlt
dXRleF91bmxvY2soJmk5MTUtPm1tX2xvY2spOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTM5OSw3
ICszOTksNyBAQCBfX2k5MTVfbW1fc3RydWN0X2ZyZWUoc3RydWN0IGtyZWYgKmtyZWYpCiB7CiAJ
c3RydWN0IGk5MTVfbW1fc3RydWN0ICptbSA9IGNvbnRhaW5lcl9vZihrcmVmLCB0eXBlb2YoKm1t
KSwga3JlZik7CiAKLQkvKiBQcm90ZWN0ZWQgYnkgZGV2X3ByaXYtPm1tX2xvY2sgKi8KKwkvKiBQ
cm90ZWN0ZWQgYnkgaTkxNS0+bW1fbG9jayAqLwogCWhhc2hfZGVsKCZtbS0+bm9kZSk7CiAJbXV0
ZXhfdW5sb2NrKCZtbS0+aTkxNS0+bW1fbG9jayk7CiAKQEAgLTc0MSwxMyArNzQxLDEzIEBAIGk5
MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJICAgICAgIHZv
aWQgKmRhdGEsCiAJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fdXNl
cnB0ciAqYXJncyA9IGRhdGE7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlp
bnQgcmV0OwogCXUzMiBoYW5kbGU7CiAKLQlpZiAoIUhBU19MTEMoZGV2X3ByaXYpICYmICFIQVNf
U05PT1AoZGV2X3ByaXYpKSB7CisJaWYgKCFIQVNfTExDKGk5MTUpICYmICFIQVNfU05PT1AoaTkx
NSkpIHsKIAkJLyogV2UgY2Fubm90IHN1cHBvcnQgY29oZXJlbnQgdXNlcnB0ciBvYmplY3RzIG9u
IGh3IHdpdGhvdXQKIAkJICogTExDIGFuZCBicm9rZW4gc25vb3BpbmcuCiAJCSAqLwpAQCAtNzc0
LDcgKzc3NCw3IEBAIGk5MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKIAkJICogT24gYWxtb3N0IGFsbCBvZiB0aGUgb2xkZXIgaHcsIHdlIGNhbm5vdCB0ZWxsIHRo
ZSBHUFUgdGhhdAogCQkgKiBhIHBhZ2UgaXMgcmVhZG9ubHkuCiAJCSAqLwotCQl2bSA9IGRldl9w
cml2LT5rZXJuZWxfY29udGV4dC0+dm07CisJCXZtID0gaTkxNS0+a2VybmVsX2NvbnRleHQtPnZt
OwogCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkKIAkJCXJldHVybiAtRU5PREVWOwog
CX0KQEAgLTgxMiwyMiArODEyLDIyIEBAIGk5MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAlyZXR1cm4gMDsKIH0KIAotaW50IGk5MTVfZ2VtX2luaXRfdXNlcnB0
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaTkxNV9nZW1faW5pdF91
c2VycHRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCW11dGV4X2luaXQoJmRl
dl9wcml2LT5tbV9sb2NrKTsKLQloYXNoX2luaXQoZGV2X3ByaXYtPm1tX3N0cnVjdHMpOworCW11
dGV4X2luaXQoJmk5MTUtPm1tX2xvY2spOworCWhhc2hfaW5pdChpOTE1LT5tbV9zdHJ1Y3RzKTsK
IAotCWRldl9wcml2LT5tbS51c2VycHRyX3dxID0KKwlpOTE1LT5tbS51c2VycHRyX3dxID0KIAkJ
YWxsb2Nfd29ya3F1ZXVlKCJpOTE1LXVzZXJwdHItYWNxdWlyZSIsCiAJCQkJV1FfSElHSFBSSSB8
IFdRX1VOQk9VTkQsCiAJCQkJMCk7Ci0JaWYgKCFkZXZfcHJpdi0+bW0udXNlcnB0cl93cSkKKwlp
ZiAoIWk5MTUtPm1tLnVzZXJwdHJfd3EpCiAJCXJldHVybiAtRU5PTUVNOwogCiAJcmV0dXJuIDA7
CiB9CiAKLXZvaWQgaTkxNV9nZW1fY2xlYW51cF91c2VycHRyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3ZvaWQgaTkxNV9nZW1fY2xlYW51cF91c2VycHRyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewotCWRlc3Ryb3lfd29ya3F1ZXVlKGRldl9wcml2LT5tbS51
c2VycHRyX3dxKTsKKwlkZXN0cm95X3dvcmtxdWV1ZShpOTE1LT5tbS51c2VycHRyX3dxKTsKIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdl
cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5k
ZXggNzNlNjY3YjMxY2M0Li43ODc5NzY5OWZlYjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0xNDE1LDggKzE0MTUsOCBAQCBzdGF0
aWMgaW50IGlndF9wcGd0dF9nZW1mc19odWdlKHZvaWQgKmFyZykKIHN0YXRpYyBpbnQgaWd0X3Bw
Z3R0X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHggPSBhcmc7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY3R4LT5pOTE1
OwotCXVuc2lnbmVkIGxvbmcgc3VwcG9ydGVkID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPnBhZ2Vf
c2l6ZXM7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CisJdW5z
aWduZWQgbG9uZyBzdXBwb3J0ZWQgPSBJTlRFTF9JTkZPKGk5MTUpLT5wYWdlX3NpemVzOwogCXN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bTsKIAlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtMTQ0Myw3ICsxNDQz
LDcgQEAgc3RhdGljIGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2b2lkICphcmcpCiAJZm9yX2Vh
Y2hfc2V0X2JpdF9mcm9tKGZpcnN0LCAmc3VwcG9ydGVkLCBsYXN0ICsgMSkgewogCQl1bnNpZ25l
ZCBpbnQgcGFnZV9zaXplID0gQklUKGZpcnN0KTsKIAotCQlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX2ludGVybmFsKGRldl9wcml2LCBwYWdlX3NpemUpOworCQlvYmogPSBpOTE1X2dlbV9v
YmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIHBhZ2Vfc2l6ZSk7CiAJCWlmIChJU19FUlIob2Jq
KSkKIAkJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKQEAgLTE0OTcsNyArMTQ5Nyw3IEBAIHN0YXRp
YyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCQlpOTE1X2dlbV9vYmplY3Rf
cHV0KG9iaik7CiAJfQogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChk
ZXZfcHJpdiwgUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVy
bmFsKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4gUFRSX0VS
UihvYmopOwogCkBAIC0xNTE4LDcgKzE1MTgsNyBAQCBzdGF0aWMgaW50IGlndF9wcGd0dF9waW5f
dXBkYXRlKHZvaWQgKmFyZykKIAkgKiBsYW5kIGluIHRoZSBub3cgc3RhbGUgMk0gcGFnZS4KIAkg
Ki8KIAotCWVyciA9IGdwdV93cml0ZSh2bWEsIGN0eCwgZGV2X3ByaXYtPmVuZ2luZVtSQ1MwXSwg
MCwgMHhkZWFkYmVhZik7CisJZXJyID0gZ3B1X3dyaXRlKHZtYSwgY3R4LCBpOTE1LT5lbmdpbmVb
UkNTMF0sIDAsIDB4ZGVhZGJlYWYpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3VucGluOwogCkBA
IC0xNjgyLDIwICsxNjgyLDIwIEBAIGludCBpOTE1X2dlbV9odWdlX3BhZ2VfbW9ja19zZWxmdGVz
dHModm9pZCkKIAkJU1VCVEVTVChpZ3RfbW9ja19wcGd0dF9odWdlX2ZpbGwpLAogCQlTVUJURVNU
KGlndF9tb2NrX3BwZ3R0XzY0SyksCiAJfTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTU7CiAJc3RydWN0IGk5MTVfcHBn
dHQgKnBwZ3R0OwogCWludCBlcnI7CiAKLQlkZXZfcHJpdiA9IG1vY2tfZ2VtX2RldmljZSgpOwot
CWlmICghZGV2X3ByaXYpCisJaTkxNSA9IG1vY2tfZ2VtX2RldmljZSgpOworCWlmICghaTkxNSkK
IAkJcmV0dXJuIC1FTk9NRU07CiAKIAkvKiBQcmV0ZW5kIHRvIGJlIGEgZGV2aWNlIHdoaWNoIHN1
cHBvcnRzIHRoZSA0OGIgUFBHVFQgKi8KLQlta3dyaXRlX2RldmljZV9pbmZvKGRldl9wcml2KS0+
cHBndHRfdHlwZSA9IElOVEVMX1BQR1RUX0ZVTEw7Ci0JbWt3cml0ZV9kZXZpY2VfaW5mbyhkZXZf
cHJpdiktPnBwZ3R0X3NpemUgPSA0ODsKKwlta3dyaXRlX2RldmljZV9pbmZvKGk5MTUpLT5wcGd0
dF90eXBlID0gSU5URUxfUFBHVFRfRlVMTDsKKwlta3dyaXRlX2RldmljZV9pbmZvKGk5MTUpLT5w
cGd0dF9zaXplID0gNDg7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0JcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7CisJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShpOTE1
KTsKIAlpZiAoSVNfRVJSKHBwZ3R0KSkgewogCQllcnIgPSBQVFJfRVJSKHBwZ3R0KTsKIAkJZ290
byBvdXRfdW5sb2NrOwpAQCAtMTcyMCwxMyArMTcyMCwxMyBAQCBpbnQgaTkxNV9nZW1faHVnZV9w
YWdlX21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7CiAKIG91
dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
ZHJtX2Rldl9wdXQoJmRldl9wcml2LT5kcm0pOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJZHJtX2Rldl9wdXQoJmk5MTUtPmRybSk7CiAKIAlyZXR1cm4gZXJyOwog
fQogCi1pbnQgaTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK2ludCBpOTE1X2dlbV9odWdlX3BhZ2VfbGl2ZV9zZWxmdGVz
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RhdGljIGNvbnN0IHN0cnVj
dCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKIAkJU1VCVEVTVChpZ3Rfc2hyaW5rX3RocCksCkBA
IC0xNzQxLDIyICsxNzQxLDIyIEBAIGludCBpOTE1X2dlbV9odWdlX3BhZ2VfbGl2ZV9zZWxmdGVz
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWludGVsX3dha2VyZWZfdCB3
YWtlcmVmOwogCWludCBlcnI7CiAKLQlpZiAoIUhBU19QUEdUVChkZXZfcHJpdikpIHsKKwlpZiAo
IUhBU19QUEdUVChpOTE1KSkgewogCQlwcl9pbmZvKCJQUEdUVCBub3Qgc3VwcG9ydGVkLCBza2lw
cGluZyBsaXZlLXNlbGZ0ZXN0c1xuIik7CiAJCXJldHVybiAwOwogCX0KIAotCWlmIChpOTE1X3Rl
cm1pbmFsbHlfd2VkZ2VkKGRldl9wcml2KSkKKwlpZiAoaTkxNV90ZXJtaW5hbGx5X3dlZGdlZChp
OTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlmaWxlID0gbW9ja19maWxlKGRldl9wcml2KTsKKwlmaWxl
ID0gbW9ja19maWxlKGk5MTUpOwogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJS
KGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdh
a2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChkZXZfcHJpdik7CisJbXV0ZXhfbG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5
MTUpOwogCi0JY3R4ID0gbGl2ZV9jb250ZXh0KGRldl9wcml2LCBmaWxlKTsKKwljdHggPSBsaXZl
X2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9F
UlIoY3R4KTsKIAkJZ290byBvdXRfdW5sb2NrOwpAQCAtMTc2OCwxMCArMTc2OCwxMCBAQCBpbnQg
aTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAllcnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBjdHgpOwogCiBvdXRfdW5s
b2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCB3YWtlcmVmKTsKLQltdXRleF91
bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1
dChpOTE1LCB3YWtlcmVmKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCi0JbW9ja19maWxlX2ZyZWUoZGV2X3ByaXYsIGZpbGUpOworCW1vY2tfZmlsZV9mcmVlKGk5
MTUsIGZpbGUpOwogCiAJcmV0dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggNzRiMGU1ODcxYzRi
Li4yZmRjYWExNjY3YmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC0xNzQ4LDcgKzE3NDgsNyBAQCBpbnQgaTkx
NV9nZW1fY29udGV4dF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCXJldHVybiBlcnI7CiB9CiAKLWlu
dCBpOTE1X2dlbV9jb250ZXh0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK2ludCBpOTE1X2dlbV9jb250ZXh0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0
ZXN0IHRlc3RzW10gPSB7CiAJCVNVQlRFU1QobGl2ZV9ub3Bfc3dpdGNoKSwKQEAgLTE3NTksOCAr
MTc1OSw4IEBAIGludCBpOTE1X2dlbV9jb250ZXh0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJU1VCVEVTVChpZ3Rfdm1faXNvbGF0aW9uKSwKIAl9
OwogCi0JaWYgKGk5MTVfdGVybWluYWxseV93ZWRnZWQoZGV2X3ByaXYpKQorCWlmIChpOTE1X3Rl
cm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCXJldHVybiBpOTE1X3N1YnRl
c3RzKHRlc3RzLCBkZXZfcHJpdik7CisJcmV0dXJuIGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUp
OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaAppbmRleCAxNDM5ZmE0MDkz
YWMuLjc0ZjlhZDY2NDhlYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgK
QEAgLTQ2NSw3ICs0NjUsNyBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZW5naW5lX3Jlc2V0
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIH0KIAogYm9vbCBpbnRlbF9lbmdpbmVf
aXNfaWRsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwotYm9vbCBpbnRlbF9lbmdp
bmVzX2FyZV9pZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Citib29sIGlu
dGVsX2VuZ2luZXNfYXJlX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiB2
b2lkIGludGVsX2VuZ2luZV9sb3N0X2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCBj
MGQ5ODZkYjVhNzUuLmEwNDhiODc0M2NlNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX2NzLmMKQEAgLTE2MCw3ICsxNjAsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGVu
Z2luZV9pbmZvIGludGVsX2VuZ2luZXNbXSA9IHsKIAogLyoqCiAgKiBpbnRlbF9lbmdpbmVfY29u
dGV4dF9zaXplKCkgLSByZXR1cm4gdGhlIHNpemUgb2YgdGhlIGNvbnRleHQgZm9yIGFuIGVuZ2lu
ZQotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBwcml2YXRlCisgKiBAaTkxNTogaTkxNSBkZXZp
Y2UgcHJpdmF0ZQogICogQGNsYXNzOiBlbmdpbmUgY2xhc3MKICAqCiAgKiBFYWNoIGVuZ2luZSBj
bGFzcyBtYXkgcmVxdWlyZSBhIGRpZmZlcmVudCBhbW91bnQgb2Ygc3BhY2UgZm9yIGEgY29udGV4
dApAQCAtMTcyLDcgKzE3Miw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZW5naW5lX2luZm8gaW50
ZWxfZW5naW5lc1tdID0gewogICogaW4gTFJDIG1vZGUsIGJ1dCBkb2VzIG5vdCBpbmNsdWRlIHRo
ZSAic2hhcmVkIGRhdGEgcGFnZSIgdXNlZCB3aXRoCiAgKiBHdUMgc3VibWlzc2lvbi4gVGhlIGNh
bGxlciBzaG91bGQgYWNjb3VudCBmb3IgdGhpcyBpZiB1c2luZyB0aGUgR3VDLgogICovCi11MzIg
aW50ZWxfZW5naW5lX2NvbnRleHRfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHU4IGNsYXNzKQordTMyIGludGVsX2VuZ2luZV9jb250ZXh0X3NpemUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIHU4IGNsYXNzKQogewogCXUzMiBjeHRfc2l6ZTsKIApAQCAtMTgw
LDkgKzE4MCw5IEBAIHUzMiBpbnRlbF9lbmdpbmVfY29udGV4dF9zaXplKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgdTggY2xhc3MpCiAKIAlzd2l0Y2ggKGNsYXNzKSB7CiAJY2Fz
ZSBSRU5ERVJfQ0xBU1M6Ci0JCXN3aXRjaCAoSU5URUxfR0VOKGRldl9wcml2KSkgeworCQlzd2l0
Y2ggKElOVEVMX0dFTihpOTE1KSkgewogCQlkZWZhdWx0OgotCQkJTUlTU0lOR19DQVNFKElOVEVM
X0dFTihkZXZfcHJpdikpOworCQkJTUlTU0lOR19DQVNFKElOVEVMX0dFTihpOTE1KSk7CiAJCQly
ZXR1cm4gREVGQVVMVF9MUl9DT05URVhUX1JFTkRFUl9TSVpFOwogCQljYXNlIDExOgogCQkJcmV0
dXJuIEdFTjExX0xSX0NPTlRFWFRfUkVOREVSX1NJWkU7CkBAIC0xOTMsNyArMTkzLDcgQEAgdTMy
IGludGVsX2VuZ2luZV9jb250ZXh0X3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1OCBjbGFzcykKIAkJY2FzZSA4OgogCQkJcmV0dXJuIEdFTjhfTFJfQ09OVEVYVF9SRU5E
RVJfU0laRTsKIAkJY2FzZSA3OgotCQkJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQorCQkJaWYg
KElTX0hBU1dFTEwoaTkxNSkpCiAJCQkJcmV0dXJuIEhTV19DWFRfVE9UQUxfU0laRTsKIAogCQkJ
Y3h0X3NpemUgPSBJOTE1X1JFQUQoR0VON19DWFRfU0laRSk7CkBAIC0yMTcsNyArMjE3LDcgQEAg
dTMyIGludGVsX2VuZ2luZV9jb250ZXh0X3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCB1OCBjbGFzcykKIAkJCSAqLwogCQkJY3h0X3NpemUgPSBJOTE1X1JFQUQoQ1hUX1NJ
WkUpICsgMTsKIAkJCURSTV9ERUJVR19EUklWRVIoImdlbiVkIENYVF9TSVpFID0gJWQgYnl0ZXMg
WzB4JTA4eF1cbiIsCi0JCQkJCSBJTlRFTF9HRU4oZGV2X3ByaXYpLAorCQkJCQkgSU5URUxfR0VO
KGk5MTUpLAogCQkJCQkgY3h0X3NpemUgKiA2NCwKIAkJCQkJIGN4dF9zaXplIC0gMSk7CiAJCQly
ZXR1cm4gcm91bmRfdXAoY3h0X3NpemUgKiA2NCwgUEFHRV9TSVpFKTsKQEAgLTIzNCw3ICsyMzQs
NyBAQCB1MzIgaW50ZWxfZW5naW5lX2NvbnRleHRfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIHU4IGNsYXNzKQogCWNhc2UgVklERU9fREVDT0RFX0NMQVNTOgogCWNhc2Ug
VklERU9fRU5IQU5DRU1FTlRfQ0xBU1M6CiAJY2FzZSBDT1BZX0VOR0lORV9DTEFTUzoKLQkJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPCA4KQorCQlpZiAoSU5URUxfR0VOKGk5MTUpIDwgOCkKIAkJ
CXJldHVybiAwOwogCQlyZXR1cm4gR0VOOF9MUl9DT05URVhUX09USEVSX1NJWkU7CiAJfQpAQCAt
Mjg0LDcgKzI4NCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuZ2luZV9zYW5pdGl6ZV9tbWlvKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIH0KIAogc3RhdGljIGludAotaW50ZWxfZW5n
aW5lX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludGVsX2VuZ2lu
ZV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQpCiB7CiAJY29uc3Qgc3RydWN0IGVuZ2luZV9pbmZvICppbmZvID0gJmludGVs
X2VuZ2luZXNbaWRdOwpAQCAtMzAxLDEwICszMDEsMTAgQEAgaW50ZWxfZW5naW5lX3NldHVwKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAoR0VNX0RFQlVHX1dBUk5fT04o
aW5mby0+aW5zdGFuY2UgPiBNQVhfRU5HSU5FX0lOU1RBTkNFKSkKIAkJcmV0dXJuIC1FSU5WQUw7
CiAKLQlpZiAoR0VNX0RFQlVHX1dBUk5fT04oZGV2X3ByaXYtPmVuZ2luZV9jbGFzc1tpbmZvLT5j
bGFzc11baW5mby0+aW5zdGFuY2VdKSkKKwlpZiAoR0VNX0RFQlVHX1dBUk5fT04oaTkxNS0+ZW5n
aW5lX2NsYXNzW2luZm8tPmNsYXNzXVtpbmZvLT5pbnN0YW5jZV0pKQogCQlyZXR1cm4gLUVJTlZB
TDsKIAotCUdFTV9CVUdfT04oZGV2X3ByaXYtPmVuZ2luZVtpZF0pOworCUdFTV9CVUdfT04oaTkx
NS0+ZW5naW5lW2lkXSk7CiAJZW5naW5lID0ga3phbGxvYyhzaXplb2YoKmVuZ2luZSksIEdGUF9L
RVJORUwpOwogCWlmICghZW5naW5lKQogCQlyZXR1cm4gLUVOT01FTTsKQEAgLTMxMywxMSArMzEz
LDExIEBAIGludGVsX2VuZ2luZV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAKIAllbmdpbmUtPmlkID0gaWQ7CiAJZW5naW5lLT5tYXNrID0gQklUKGlkKTsKLQllbmdp
bmUtPmk5MTUgPSBkZXZfcHJpdjsKLQllbmdpbmUtPnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3Jl
OworCWVuZ2luZS0+aTkxNSA9IGk5MTU7CisJZW5naW5lLT51bmNvcmUgPSAmaTkxNS0+dW5jb3Jl
OwogCV9fc3ByaW50X2VuZ2luZV9uYW1lKGVuZ2luZS0+bmFtZSwgaW5mbyk7CiAJZW5naW5lLT5o
d19pZCA9IGVuZ2luZS0+Z3VjX2lkID0gaW5mby0+aHdfaWQ7Ci0JZW5naW5lLT5tbWlvX2Jhc2Ug
PSBfX2VuZ2luZV9tbWlvX2Jhc2UoZGV2X3ByaXYsIGluZm8tPm1taW9fYmFzZXMpOworCWVuZ2lu
ZS0+bW1pb19iYXNlID0gX19lbmdpbmVfbW1pb19iYXNlKGk5MTUsIGluZm8tPm1taW9fYmFzZXMp
OwogCWVuZ2luZS0+Y2xhc3MgPSBpbmZvLT5jbGFzczsKIAllbmdpbmUtPmluc3RhbmNlID0gaW5m
by0+aW5zdGFuY2U7CiAKQEAgLTMyOSwxMiArMzI5LDEyIEBAIGludGVsX2VuZ2luZV9zZXR1cChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAllbmdpbmUtPnVhYmlfY2xhc3Mg
PSBpbnRlbF9lbmdpbmVfY2xhc3Nlc1tpbmZvLT5jbGFzc10udWFiaV9jbGFzczsKIAotCWVuZ2lu
ZS0+Y29udGV4dF9zaXplID0gaW50ZWxfZW5naW5lX2NvbnRleHRfc2l6ZShkZXZfcHJpdiwKKwll
bmdpbmUtPmNvbnRleHRfc2l6ZSA9IGludGVsX2VuZ2luZV9jb250ZXh0X3NpemUoaTkxNSwKIAkJ
CQkJCQkgZW5naW5lLT5jbGFzcyk7CiAJaWYgKFdBUk5fT04oZW5naW5lLT5jb250ZXh0X3NpemUg
PiBCSVQoMjApKSkKIAkJZW5naW5lLT5jb250ZXh0X3NpemUgPSAwOwogCWlmIChlbmdpbmUtPmNv
bnRleHRfc2l6ZSkKLQkJRFJJVkVSX0NBUFMoZGV2X3ByaXYpLT5oYXNfbG9naWNhbF9jb250ZXh0
cyA9IHRydWU7CisJCURSSVZFUl9DQVBTKGk5MTUpLT5oYXNfbG9naWNhbF9jb250ZXh0cyA9IHRy
dWU7CiAKIAkvKiBOb3RoaW5nIHRvIGRvIGhlcmUsIGV4ZWN1dGUgaW4gb3JkZXIgb2YgZGVwZW5k
ZW5jaWVzICovCiAJZW5naW5lLT5zY2hlZHVsZSA9IE5VTEw7CkBAIC0zNDYsOCArMzQ2LDggQEAg
aW50ZWxfZW5naW5lX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkv
KiBTY3J1YiBtbWlvIHN0YXRlIG9uIHRha2VvdmVyICovCiAJaW50ZWxfZW5naW5lX3Nhbml0aXpl
X21taW8oZW5naW5lKTsKIAotCWRldl9wcml2LT5lbmdpbmVfY2xhc3NbaW5mby0+Y2xhc3NdW2lu
Zm8tPmluc3RhbmNlXSA9IGVuZ2luZTsKLQlkZXZfcHJpdi0+ZW5naW5lW2lkXSA9IGVuZ2luZTsK
KwlpOTE1LT5lbmdpbmVfY2xhc3NbaW5mby0+Y2xhc3NdW2luZm8tPmluc3RhbmNlXSA9IGVuZ2lu
ZTsKKwlpOTE1LT5lbmdpbmVbaWRdID0gZW5naW5lOwogCXJldHVybiAwOwogfQogCkBAIC05NTMs
MTcgKzk1MywxNyBAQCBjb25zdCBjaGFyICppOTE1X2NhY2hlX2xldmVsX3N0cihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHR5cGUpCiAJfQogfQogCi11MzIgaW50ZWxfY2FsY3Vs
YXRlX21jcl9zX3NzX3NlbGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit1
MzIgaW50ZWxfY2FsY3VsYXRlX21jcl9zX3NzX3NlbGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKLQljb25zdCBzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSA9ICZSVU5USU1F
X0lORk8oZGV2X3ByaXYpLT5zc2V1OworCWNvbnN0IHN0cnVjdCBzc2V1X2Rldl9pbmZvICpzc2V1
ID0gJlJVTlRJTUVfSU5GTyhpOTE1KS0+c3NldTsKIAl1MzIgbWNyX3Nfc3Nfc2VsZWN0OwogCXUz
MiBzbGljZSA9IGZscyhzc2V1LT5zbGljZV9tYXNrKTsKIAl1MzIgc3Vic2xpY2UgPSBmbHMoc3Nl
dS0+c3Vic2xpY2VfbWFza1tzbGljZV0pOwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgMTApKQor
CWlmIChJU19HRU4oaTkxNSwgMTApKQogCQltY3Jfc19zc19zZWxlY3QgPSBHRU44X01DUl9TTElD
RShzbGljZSkgfAogCQkJCSAgR0VOOF9NQ1JfU1VCU0xJQ0Uoc3Vic2xpY2UpOwotCWVsc2UgaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49
IDExKQogCQltY3Jfc19zc19zZWxlY3QgPSBHRU4xMV9NQ1JfU0xJQ0Uoc2xpY2UpIHwKIAkJCQkg
IEdFTjExX01DUl9TVUJTTElDRShzdWJzbGljZSk7CiAJZWxzZQpAQCAtMTA5NSw3ICsxMDk1LDcg
QEAgdm9pZCBpbnRlbF9lbmdpbmVfZ2V0X2luc3Rkb25lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKIAogc3RhdGljIGJvb2wgcmluZ19pc19pZGxlKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBlbmdp
bmUtPmk5MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7
CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJYm9vbCBpZGxlID0gdHJ1ZTsKIApAQCAtMTEw
Myw3ICsxMTAzLDcgQEAgc3RhdGljIGJvb2wgcmluZ19pc19pZGxlKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIAkJcmV0dXJuIHRydWU7CiAKIAkvKiBJZiB0aGUgd2hvbGUgZGV2aWNl
IGlzIGFzbGVlcCwgdGhlIGVuZ2luZSBtdXN0IGJlIGlkbGUgKi8KLQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXRfaWZfaW5fdXNlKGRldl9wcml2KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXRfaWZfaW5fdXNlKGk5MTUpOwogCWlmICghd2FrZXJlZikKIAkJcmV0dXJuIHRy
dWU7CiAKQEAgLTExMTMsMTEgKzExMTMsMTEgQEAgc3RhdGljIGJvb2wgcmluZ19pc19pZGxlKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJaWRsZSA9IGZhbHNlOwogCiAJLyogTm8g
Yml0IGZvciBnZW4yLCBzbyBhc3N1bWUgdGhlIENTIHBhcnNlciBpcyBpZGxlICovCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPiAyICYmCisJaWYgKElOVEVMX0dFTihpOTE1KSA+IDIgJiYKIAkg
ICAgIShFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfTUlfTU9ERSkgJiBNT0RFX0lETEUpKQogCQlp
ZGxlID0gZmFsc2U7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7
CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CiAKIAlyZXR1cm4gaWRsZTsK
IH0KQEAgLTEzMjEsMTIgKzEzMjEsMTIgQEAgc3RhdGljIHZvaWQgaGV4ZHVtcChzdHJ1Y3QgZHJt
X3ByaW50ZXIgKm0sIGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKIHN0YXRpYyB2b2lkIGlu
dGVsX2VuZ2luZV9wcmludF9yZWdpc3RlcnMoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLAogCQkJCQkgc3RydWN0IGRybV9wcmludGVyICptKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGVuZ2luZS0+aTkxNTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGVuZ2luZS0+aTkxNTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4
ZWNsaXN0cyAqIGNvbnN0IGV4ZWNsaXN0cyA9CiAJCSZlbmdpbmUtPmV4ZWNsaXN0czsKIAl1NjQg
YWRkcjsKIAotCWlmIChlbmdpbmUtPmlkID09IFJDUzAgJiYgSVNfR0VOX1JBTkdFKGRldl9wcml2
LCA0LCA3KSkKKwlpZiAoZW5naW5lLT5pZCA9PSBSQ1MwICYmIElTX0dFTl9SQU5HRShpOTE1LCA0
LCA3KSkKIAkJZHJtX3ByaW50ZihtLCAiXHRDQ0lEOiAweCUwOHhcbiIsIEVOR0lORV9SRUFEKGVu
Z2luZSwgQ0NJRCkpOwogCWRybV9wcmludGYobSwgIlx0UklOR19TVEFSVDogMHglMDh4XG4iLAog
CQkgICBFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfU1RBUlQpKTsKQEAgLTEzNDMsNyArMTM0Myw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuZ2luZV9wcmludF9yZWdpc3RlcnMoY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJICAgRU5HSU5FX1JFQUQoZW5naW5lLCBSSU5H
X01JX01PREUpICYgKE1PREVfSURMRSkgPyAiIFtpZGxlXSIgOiAiIik7CiAJfQogCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gNikgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikgewog
CQlkcm1fcHJpbnRmKG0sICJcdFJJTkdfSU1SOiAlMDh4XG4iLAogCQkJICAgRU5HSU5FX1JFQUQo
ZW5naW5lLCBSSU5HX0lNUikpOwogCX0KQEAgLTEzNTQsMTUgKzEzNTQsMTUgQEAgc3RhdGljIHZv
aWQgaW50ZWxfZW5naW5lX3ByaW50X3JlZ2lzdGVycyhjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUsCiAJYWRkciA9IGludGVsX2VuZ2luZV9nZXRfbGFzdF9iYXRjaF9oZWFkKGVu
Z2luZSk7CiAJZHJtX3ByaW50ZihtLCAiXHRCQkFERFI6IDB4JTA4eF8lMDh4XG4iLAogCQkgICB1
cHBlcl8zMl9iaXRzKGFkZHIpLCBsb3dlcl8zMl9iaXRzKGFkZHIpKTsKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA4KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCkKIAkJYWRkciA9IEVO
R0lORV9SRUFENjQoZW5naW5lLCBSSU5HX0RNQV9GQURELCBSSU5HX0RNQV9GQUREX1VEVyk7Ci0J
ZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQorCWVsc2UgaWYgKElOVEVMX0dFTihp
OTE1KSA+PSA0KQogCQlhZGRyID0gRU5HSU5FX1JFQUQoZW5naW5lLCBSSU5HX0RNQV9GQUREKTsK
IAllbHNlCiAJCWFkZHIgPSBFTkdJTkVfUkVBRChlbmdpbmUsIERNQV9GQUREX0k4WFgpOwogCWRy
bV9wcmludGYobSwgIlx0RE1BX0ZBRERSOiAweCUwOHhfJTA4eFxuIiwKIAkJICAgdXBwZXJfMzJf
Yml0cyhhZGRyKSwgbG93ZXJfMzJfYml0cyhhZGRyKSk7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gNCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkgewogCQlkcm1fcHJpbnRmKG0s
ICJcdElQRUlSOiAweCUwOHhcbiIsCiAJCQkgICBFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfSVBF
SVIpKTsKIAkJZHJtX3ByaW50ZihtLCAiXHRJUEVIUjogMHglMDh4XG4iLApAQCAtMTM3Miw3ICsx
MzcyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZW5naW5lX3ByaW50X3JlZ2lzdGVycyhjb25zdCBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCWRybV9wcmludGYobSwgIlx0SVBFSFI6
IDB4JTA4eFxuIiwgRU5HSU5FX1JFQUQoZW5naW5lLCBJUEVIUikpOwogCX0KIAotCWlmIChIQVNf
RVhFQ0xJU1RTKGRldl9wcml2KSkgeworCWlmIChIQVNfRVhFQ0xJU1RTKGk5MTUpKSB7CiAJCWNv
bnN0IHUzMiAqaHdzID0KIAkJCSZlbmdpbmUtPnN0YXR1c19wYWdlLmFkZHJbSTkxNV9IV1NfQ1NC
X0JVRjBfSU5ERVhdOwogCQljb25zdCB1OCBudW1fZW50cmllcyA9IGV4ZWNsaXN0cy0+Y3NiX3Np
emU7CkBAIC0xNDI2LDcgKzE0MjYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9lbmdpbmVfcHJpbnRf
cmVnaXN0ZXJzKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJfQogCQlk
cm1fcHJpbnRmKG0sICJcdFx0SFcgYWN0aXZlPyAweCV4XG4iLCBleGVjbGlzdHMtPmFjdGl2ZSk7
CiAJCXJjdV9yZWFkX3VubG9jaygpOwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
IDYpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+IDYpIHsKIAkJZHJtX3ByaW50Ziht
LCAiXHRQUF9ESVJfQkFTRTogMHglMDh4XG4iLAogCQkJICAgRU5HSU5FX1JFQUQoZW5naW5lLCBS
SU5HX1BQX0RJUl9CQVNFKSk7CiAJCWRybV9wcmludGYobSwgIlx0UFBfRElSX0JBU0VfUkVBRDog
MHglMDh4XG4iLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfaGFu
Z2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9oYW5nY2hlY2suYwppbmRl
eCAxNzRiYjBhNjAzMDkuLjk0ODQyM2M1ZjY3ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfaGFuZ2NoZWNrLmMKQEAgLTUwLDcgKzUwLDcgQEAgc3RhdGljIGJvb2wgaW5zdGRvbmVf
dW5jaGFuZ2VkKHUzMiBjdXJyZW50X2luc3Rkb25lLCB1MzIgKm9sZF9pbnN0ZG9uZSkKIAogc3Rh
dGljIGJvb2wgc3VidW5pdHNfc3R1Y2soc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGVuZ2luZS0+aTkxNTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGVuZ2luZS0+aTkxNTsKIAlzdHJ1Y3QgaW50
ZWxfaW5zdGRvbmUgaW5zdGRvbmU7CiAJc3RydWN0IGludGVsX2luc3Rkb25lICphY2N1X2luc3Rk
b25lID0gJmVuZ2luZS0+aGFuZ2NoZWNrLmluc3Rkb25lOwogCWJvb2wgc3R1Y2s7CkBAIC03Miw3
ICs3Miw3IEBAIHN0YXRpYyBib29sIHN1YnVuaXRzX3N0dWNrKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKIAlzdHVjayAmPSBpbnN0ZG9uZV91bmNoYW5nZWQoaW5zdGRvbmUuc2xpY2Vf
Y29tbW9uLAogCQkJCSAgICAmYWNjdV9pbnN0ZG9uZS0+c2xpY2VfY29tbW9uKTsKIAotCWZvcl9l
YWNoX2luc3Rkb25lX3NsaWNlX3N1YnNsaWNlKGRldl9wcml2LCBzbGljZSwgc3Vic2xpY2UpIHsK
Kwlmb3JfZWFjaF9pbnN0ZG9uZV9zbGljZV9zdWJzbGljZShpOTE1LCBzbGljZSwgc3Vic2xpY2Up
IHsKIAkJc3R1Y2sgJj0gaW5zdGRvbmVfdW5jaGFuZ2VkKGluc3Rkb25lLnNhbXBsZXJbc2xpY2Vd
W3N1YnNsaWNlXSwKIAkJCQkJICAgICZhY2N1X2luc3Rkb25lLT5zYW1wbGVyW3NsaWNlXVtzdWJz
bGljZV0pOwogCQlzdHVjayAmPSBpbnN0ZG9uZV91bmNoYW5nZWQoaW5zdGRvbmUucm93W3NsaWNl
XVtzdWJzbGljZV0sCkBAIC0xMDMsNyArMTAzLDcgQEAgaGVhZF9zdHVjayhzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsIHU2NCBhY3RoZCkKIHN0YXRpYyBlbnVtIGludGVsX2VuZ2luZV9o
YW5nY2hlY2tfYWN0aW9uCiBlbmdpbmVfc3R1Y2soc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLCB1NjQgYWN0aGQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZW5naW5lLT5pOTE1OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZW5naW5lLT5p
OTE1OwogCWVudW0gaW50ZWxfZW5naW5lX2hhbmdjaGVja19hY3Rpb24gaGE7CiAJdTMyIHRtcDsK
IApAQCAtMTExLDcgKzExMSw3IEBAIGVuZ2luZV9zdHVjayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsIHU2NCBhY3RoZCkKIAlpZiAoaGEgIT0gRU5HSU5FX0RFQUQpCiAJCXJldHVybiBo
YTsKIAotCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpKQorCWlmIChJU19HRU4oaTkxNSwgMikpCiAJ
CXJldHVybiBFTkdJTkVfREVBRDsKIAogCS8qIElzIHRoZSBjaGlwIGhhbmdpbmcgb24gYSBXQUlU
X0ZPUl9FVkVOVD8KQEAgLTEyMSw3ICsxMjEsNyBAQCBlbmdpbmVfc3R1Y2soc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lLCB1NjQgYWN0aGQpCiAJICovCiAJdG1wID0gRU5HSU5FX1JFQUQo
ZW5naW5lLCBSSU5HX0NUTCk7CiAJaWYgKHRtcCAmIFJJTkdfV0FJVCkgewotCQlpOTE1X2hhbmRs
ZV9lcnJvcihkZXZfcHJpdiwgZW5naW5lLT5tYXNrLCAwLAorCQlpOTE1X2hhbmRsZV9lcnJvcihp
OTE1LCBlbmdpbmUtPm1hc2ssIDAsCiAJCQkJICAic3R1Y2sgd2FpdCBvbiAlcyIsIGVuZ2luZS0+
bmFtZSk7CiAJCUVOR0lORV9XUklURShlbmdpbmUsIFJJTkdfQ1RMLCB0bXApOwogCQlyZXR1cm4g
RU5HSU5FX1dBSVRfS0lDSzsKQEAgLTI1Niw4ICsyNTYsOCBAQCBzdGF0aWMgdm9pZCBoYW5nY2hl
Y2tfZGVjbGFyZV9oYW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogICovCiBzdGF0
aWMgdm9pZCBpOTE1X2hhbmdjaGVja19lbGFwc2VkKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yo
d29yaywgdHlwZW9mKCpkZXZfcHJpdiksCisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PQorCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwKIAkJCSAgICAgZ3B1X2Vycm9y
LmhhbmdjaGVja193b3JrLndvcmspOwogCWludGVsX2VuZ2luZV9tYXNrX3QgaHVuZyA9IDAsIHN0
dWNrID0gMCwgd2VkZ2VkID0gMDsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CkBA
IC0yNjcsMTMgKzI2NywxMyBAQCBzdGF0aWMgdm9pZCBpOTE1X2hhbmdjaGVja19lbGFwc2VkKHN0
cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlpZiAoIWk5MTVfbW9kcGFyYW1zLmVuYWJsZV9oYW5n
Y2hlY2spCiAJCXJldHVybjsKIAotCWlmICghUkVBRF9PTkNFKGRldl9wcml2LT5ndC5hd2FrZSkp
CisJaWYgKCFSRUFEX09OQ0UoaTkxNS0+Z3QuYXdha2UpKQogCQlyZXR1cm47CiAKLQlpZiAoaTkx
NV90ZXJtaW5hbGx5X3dlZGdlZChkZXZfcHJpdikpCisJaWYgKGk5MTVfdGVybWluYWxseV93ZWRn
ZWQoaTkxNSkpCiAJCXJldHVybjsKIAotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9p
Zl9pbl91c2UoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9p
bl91c2UoaTkxNSk7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1cm47CiAKQEAgLTI4MSw5ICsyODEs
OSBAQCBzdGF0aWMgdm9pZCBpOTE1X2hhbmdjaGVja19lbGFwc2VkKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yaykKIAkgKiBwZXJpb2RpY2FsbHkgYXJtIHRoZSBtbWlvIGNoZWNrZXIgdG8gc2VlIGlm
IHdlIGFyZSB0cmlnZ2VyaW5nCiAJICogYW55IGludmFsaWQgYWNjZXNzLgogCSAqLwotCWludGVs
X3VuY29yZV9hcm1fdW5jbGFpbWVkX21taW9fZGV0ZWN0aW9uKCZkZXZfcHJpdi0+dW5jb3JlKTsK
KwlpbnRlbF91bmNvcmVfYXJtX3VuY2xhaW1lZF9tbWlvX2RldGVjdGlvbigmaTkxNS0+dW5jb3Jl
KTsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgeworCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXN0cnVjdCBoYW5nY2hlY2sgaGM7CiAKIAkJ
aW50ZWxfZW5naW5lX3NpZ25hbF9icmVhZGNydW1icyhlbmdpbmUpOwpAQCAtMzA1LDcgKzMwNSw3
IEBAIHN0YXRpYyB2b2lkIGk5MTVfaGFuZ2NoZWNrX2VsYXBzZWQoc3RydWN0IHdvcmtfc3RydWN0
ICp3b3JrKQogCWlmIChHRU1fU0hPV19ERUJVRygpICYmIChodW5nIHwgc3R1Y2spKSB7CiAJCXN0
cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX2RlYnVnX3ByaW50ZXIoImhhbmdjaGVjayIpOwogCi0J
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgeworCQlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQkJaWYgKGludGVsX2VuZ2luZV9pc19pZGxlKGVuZ2lu
ZSkpCiAJCQkJY29udGludWU7CiAKQEAgLTMxNCwyMCArMzE0LDIwIEBAIHN0YXRpYyB2b2lkIGk5
MTVfaGFuZ2NoZWNrX2VsYXBzZWQoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCX0KIAogCWlm
ICh3ZWRnZWQpIHsKLQkJZGV2X2VycihkZXZfcHJpdi0+ZHJtLmRldiwKKwkJZGV2X2VycihpOTE1
LT5kcm0uZGV2LAogCQkJIkdQVSByZWNvdmVyeSB0aW1lZCBvdXQsIgogCQkJIiBjYW5jZWxsaW5n
IGFsbCBpbi1mbGlnaHQgcmVuZGVyaW5nLlxuIik7CiAJCUdFTV9UUkFDRV9EVU1QKCk7Ci0JCWk5
MTVfZ2VtX3NldF93ZWRnZWQoZGV2X3ByaXYpOworCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUp
OwogCX0KIAogCWlmIChodW5nKQotCQloYW5nY2hlY2tfZGVjbGFyZV9oYW5nKGRldl9wcml2LCBo
dW5nLCBzdHVjayk7CisJCWhhbmdjaGVja19kZWNsYXJlX2hhbmcoaTkxNSwgaHVuZywgc3R1Y2sp
OwogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYsIHdha2VyZWYpOworCWludGVsX3J1
bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwogCiAJLyogUmVzZXQgdGltZXIgaW4gY2FzZSBH
UFUgaGFuZ3Mgd2l0aG91dCBhbm90aGVyIHJlcXVlc3QgYmVpbmcgYWRkZWQgKi8KLQlpOTE1X3F1
ZXVlX2hhbmdjaGVjayhkZXZfcHJpdik7CisJaTkxNV9xdWV1ZV9oYW5nY2hlY2soaTkxNSk7CiB9
CiAKIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfaGFuZ2NoZWNrKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21v
Y3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3MuYwppbmRleCA3OWRmNjYw
MjJkM2EuLjlkNmYwODkzZjUyOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbW9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3MuYwpA
QCAtMjM5LDcgKzIzOSw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc19lbnRy
eSBpY2VsYWtlX21vY3NfdGFibGVbXSA9IHsKIAogLyoqCiAgKiBnZXRfbW9jc19zZXR0aW5ncygp
Ci0gKiBAZGV2X3ByaXY6CWk5MTUgZGV2aWNlLgorICogQGk5MTU6CWk5MTUgZGV2aWNlLgogICog
QHRhYmxlOiAgICAgIE91dHB1dCB0YWJsZSB0aGF0IHdpbGwgYmUgbWFkZSB0byBwb2ludCBhdCBh
cHByb3ByaWF0ZQogICoJICAgICAgTU9DUyB2YWx1ZXMgZm9yIHRoZSBkZXZpY2UuCiAgKgpAQCAt
MjQ5LDMzICsyNDksMzMgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9tb2NzX2VudHJ5
IGljZWxha2VfbW9jc190YWJsZVtdID0gewogICoKICAqIFJldHVybjogdHJ1ZSBpZiB0aGVyZSBh
cmUgYXBwbGljYWJsZSBNT0NTIHNldHRpbmdzIGZvciB0aGUgZGV2aWNlLgogICovCi1zdGF0aWMg
Ym9vbCBnZXRfbW9jc19zZXR0aW5ncyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitzdGF0aWMgYm9vbCBnZXRfbW9jc19zZXR0aW5ncyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCSAgICAgIHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSkKIHsKIAli
b29sIHJlc3VsdCA9IGZhbHNlOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsK
KwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKSB7CiAJCXRhYmxlLT5zaXplICA9IEFSUkFZX1NJ
WkUoaWNlbGFrZV9tb2NzX3RhYmxlKTsKIAkJdGFibGUtPnRhYmxlID0gaWNlbGFrZV9tb2NzX3Rh
YmxlOwogCQl0YWJsZS0+bl9lbnRyaWVzID0gR0VOMTFfTlVNX01PQ1NfRU5UUklFUzsKIAkJcmVz
dWx0ID0gdHJ1ZTsKLQl9IGVsc2UgaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpIHx8IElTX0NBTk5P
TkxBS0UoZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19HRU45X0JDKGk5MTUpIHx8IElTX0NB
Tk5PTkxBS0UoaTkxNSkpIHsKIAkJdGFibGUtPnNpemUgID0gQVJSQVlfU0laRShza3lsYWtlX21v
Y3NfdGFibGUpOwogCQl0YWJsZS0+bl9lbnRyaWVzID0gR0VOOV9OVU1fTU9DU19FTlRSSUVTOwog
CQl0YWJsZS0+dGFibGUgPSBza3lsYWtlX21vY3NfdGFibGU7CiAJCXJlc3VsdCA9IHRydWU7Ci0J
fSBlbHNlIGlmIChJU19HRU45X0xQKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfR0VOOV9M
UChpOTE1KSkgewogCQl0YWJsZS0+c2l6ZSAgPSBBUlJBWV9TSVpFKGJyb3h0b25fbW9jc190YWJs
ZSk7CiAJCXRhYmxlLT5uX2VudHJpZXMgPSBHRU45X05VTV9NT0NTX0VOVFJJRVM7CiAJCXRhYmxl
LT50YWJsZSA9IGJyb3h0b25fbW9jc190YWJsZTsKIAkJcmVzdWx0ID0gdHJ1ZTsKIAl9IGVsc2Ug
ewotCQlXQVJOX09OQ0UoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5LAorCQlXQVJOX09OQ0UoSU5U
RUxfR0VOKGk5MTUpID49IDksCiAJCQkgICJQbGF0Zm9ybSB0aGF0IHNob3VsZCBoYXZlIGEgTU9D
UyB0YWJsZSBkb2VzIG5vdC5cbiIpOwogCX0KIAogCS8qIFdhRGlzYWJsZVNraXBDYWNoaW5nOnNr
bCxieHQsa2JsLGdsayAqLwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpKSB7CisJaWYgKElTX0dF
TihpOTE1LCA5KSkgewogCQlpbnQgaTsKIAogCQlmb3IgKGkgPSAwOyBpIDwgdGFibGUtPnNpemU7
IGkrKykKQEAgLTMzMCwxMiArMzMwLDEyIEBAIHN0YXRpYyB1MzIgZ2V0X2VudHJ5X2NvbnRyb2wo
Y29uc3Qgc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUgKnRhYmxlLAogICovCiB2b2lkIGludGVs
X21vY3NfaW5pdF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGVuZ2luZS0+aTkxNTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGVuZ2luZS0+aTkxNTsKIAlzdHJ1Y3QgZHJtX2k5MTVf
bW9jc190YWJsZSB0YWJsZTsKIAl1bnNpZ25lZCBpbnQgaW5kZXg7CiAJdTMyIHVudXNlZF92YWx1
ZTsKIAotCWlmICghZ2V0X21vY3Nfc2V0dGluZ3MoZGV2X3ByaXYsICZ0YWJsZSkpCisJaWYgKCFn
ZXRfbW9jc19zZXR0aW5ncyhpOTE1LCAmdGFibGUpKQogCQlyZXR1cm47CiAKIAkvKiBTZXQgdW51
c2VkIHZhbHVlcyB0byBQVEUgKi8KQEAgLTQ4Miw3ICs0ODIsNyBAQCBzdGF0aWMgaW50IGVtaXRf
bW9jc19sM2NjX3RhYmxlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCiAvKioKICAqIGludGVs
X21vY3NfaW5pdF9sM2NjX3RhYmxlKCkgLSBwcm9ncmFtIHRoZSBtb2NzIGNvbnRyb2wgdGFibGUK
LSAqIEBkZXZfcHJpdjogICAgICBpOTE1IGRldmljZSBwcml2YXRlCisgKiBAaTkxNTogICAgICBp
OTE1IGRldmljZSBwcml2YXRlCiAgKgogICogVGhpcyBmdW5jdGlvbiBzaW1wbHkgcHJvZ3JhbXMg
dGhlIG1vY3MgcmVnaXN0ZXJzIGZvciB0aGUgZ2l2ZW4gdGFibGUKICAqIHN0YXJ0aW5nIGF0IHRo
ZSBnaXZlbiBhZGRyZXNzLiBUaGlzIHJlZ2lzdGVyIHNldCBpcyAgcHJvZ3JhbW1lZCBpbiBwYWly
cy4KQEAgLTQ5NCwxMyArNDk0LDEzIEBAIHN0YXRpYyBpbnQgZW1pdF9tb2NzX2wzY2NfdGFibGUo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAgKgogICogUmV0dXJuOiBOb3RoaW5nLgogICovCi12
b2lkIGludGVsX21vY3NfaW5pdF9sM2NjX3RhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3ZvaWQgaW50ZWxfbW9jc19pbml0X2wzY2NfdGFibGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUgdGFibGU7CiAJ
dW5zaWduZWQgaW50IGk7CiAJdTE2IHVudXNlZF92YWx1ZTsKIAotCWlmICghZ2V0X21vY3Nfc2V0
dGluZ3MoZGV2X3ByaXYsICZ0YWJsZSkpCisJaWYgKCFnZXRfbW9jc19zZXR0aW5ncyhpOTE1LCAm
dGFibGUpKQogCQlyZXR1cm47CiAKIAkvKiBTZXQgdW51c2VkIHZhbHVlcyB0byBQVEUgKi8KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3MuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3MuaAppbmRleCAwOTEzNzA0YTFhZjIuLjZmODk3M2Zi
Y2IzZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3MuaApAQCAtNTQsNyArNTQsNyBA
QCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0Owogc3RydWN0IGludGVsX2VuZ2luZV9jczsKIAogaW50IGlu
dGVsX3Jjc19jb250ZXh0X2luaXRfbW9jcyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7Ci12b2lk
IGludGVsX21vY3NfaW5pdF9sM2NjX3RhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdik7Cit2b2lkIGludGVsX21vY3NfaW5pdF9sM2NjX3RhYmxlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKIHZvaWQgaW50ZWxfbW9jc19pbml0X2VuZ2luZShzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpOwogCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
ZXNldC5jCmluZGV4IDYzNjhiMzdmMjZkMS4uZDVjZDNjY2NiNDA3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTEyMDgsMTMgKzEyMDgsMTMgQEAgc3RhdGljIHZvaWQg
Y2xlYXJfZXJyb3JfcmVnaXN0ZXJzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCX0K
IH0KIAotc3RhdGljIHZvaWQgZ2VuNl9jaGVja19mYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuNl9jaGVja19mYXVsdHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwog
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCXUzMiBmYXVsdDsKIAotCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGRldl9wcml2LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUs
IGlkKSB7CiAJCWZhdWx0ID0gR0VONl9SSU5HX0ZBVUxUX1JFR19SRUFEKGVuZ2luZSk7CiAJCWlm
IChmYXVsdCAmIFJJTkdfRkFVTFRfVkFMSUQpIHsKIAkJCURSTV9ERUJVR19EUklWRVIoIlVuZXhw
ZWN0ZWQgZmF1bHRcbiIKQEAgLTEyMzAsNyArMTIzMCw3IEBAIHN0YXRpYyB2b2lkIGdlbjZfY2hl
Y2tfZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiB9CiAKLXN0
YXRpYyB2b2lkIGdlbjhfY2hlY2tfZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3N0YXRpYyB2b2lkIGdlbjhfY2hlY2tfZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCXUzMiBmYXVsdCA9IEk5MTVfUkVBRChHRU44X1JJTkdfRkFVTFRfUkVH
KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZl
ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCmluZGV4IGIz
YmY0N2U4MTYyZi4uOGVjMmQzMzJlMjA2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmluZ2J1ZmZlci5jCkBAIC00ODksMTEgKzQ4OSwxMSBAQCBzdGF0aWMgdm9pZCBzZXRfaHdz
dGFtKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMyIG1hc2spCiAKIHN0YXRpYyB2
b2lkIHNldF9od3NfcGdhKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgcGh5c19hZGRy
X3QgcGh5cykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBlbmdpbmUt
Pmk5MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CiAJ
dTMyIGFkZHI7CiAKIAlhZGRyID0gbG93ZXJfMzJfYml0cyhwaHlzKTsKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA0KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkKIAkJYWRkciB8PSAo
cGh5cyA+PiAyOCkgJiAweGYwOwogCiAJSTkxNV9XUklURShIV1NfUEdBLCBhZGRyKTsKQEAgLTUx
NSwxNCArNTE1LDE0IEBAIHN0YXRpYyB2b2lkIHJpbmdfc2V0dXBfcGh5c19zdGF0dXNfcGFnZShz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIHN0YXRpYyB2b2lkIHNldF9od3NwKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMyIG9mZnNldCkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBlbmdpbmUtPmk5MTU7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CiAJaTkxNV9yZWdfdCBod3NwOwogCiAJLyoK
IAkgKiBUaGUgcmluZyBzdGF0dXMgcGFnZSBhZGRyZXNzZXMgYXJlIG5vIGxvbmdlciBuZXh0IHRv
IHRoZSByZXN0IG9mCiAJICogdGhlIHJpbmcgcmVnaXN0ZXJzIGFzIG9mIGdlbjcuCiAJICovCi0J
aWYgKElTX0dFTihkZXZfcHJpdiwgNykpIHsKKwlpZiAoSVNfR0VOKGk5MTUsIDcpKSB7CiAJCXN3
aXRjaCAoZW5naW5lLT5pZCkgewogCQkvKgogCQkgKiBObyBtb3JlIHJpbmdzIGV4aXN0IG9uIEdl
bjcuIERlZmF1bHQgY2FzZSBpcyBvbmx5IHRvIHNodXQgdXAKQEAgLTU0NCw3ICs1NDQsNyBAQCBz
dGF0aWMgdm9pZCBzZXRfaHdzcChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiBv
ZmZzZXQpCiAJCQlod3NwID0gVkVCT1hfSFdTX1BHQV9HRU43OwogCQkJYnJlYWs7CiAJCX0KLQl9
IGVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgNikpIHsKKwl9IGVsc2UgaWYgKElTX0dFTihpOTE1
LCA2KSkgewogCQlod3NwID0gUklOR19IV1NfUEdBX0dFTjYoZW5naW5lLT5tbWlvX2Jhc2UpOwog
CX0gZWxzZSB7CiAJCWh3c3AgPSBSSU5HX0hXU19QR0EoZW5naW5lLT5tbWlvX2Jhc2UpOwpAQCAt
NTU2LDkgKzU1Niw5IEBAIHN0YXRpYyB2b2lkIHNldF9od3NwKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSwgdTMyIG9mZnNldCkKIAogc3RhdGljIHZvaWQgZmx1c2hfY3NfdGxiKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBlbmdpbmUtPmk5MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBlbmdpbmUtPmk5MTU7CiAKLQlpZiAoIUlTX0dFTl9SQU5HRShkZXZfcHJpdiwgNiwgNykpCisJ
aWYgKCFJU19HRU5fUkFOR0UoaTkxNSwgNiwgNykpCiAJCXJldHVybjsKIAogCS8qIHJpbmcgc2hv
dWxkIGJlIGlkbGUgYmVmb3JlIGlzc3VpbmcgYSBzeW5jIGZsdXNoKi8KQEAgLTU4NSw5ICs1ODUs
OSBAQCBzdGF0aWMgdm9pZCByaW5nX3NldHVwX3N0YXR1c19wYWdlKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIAogc3RhdGljIGJvb2wgc3RvcF9yaW5nKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBl
bmdpbmUtPmk5MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5
MTU7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+IDIpIHsKKwlpZiAoSU5URUxfR0VOKGk5
MTUpID4gMikgewogCQlFTkdJTkVfV1JJVEUoZW5naW5lLAogCQkJICAgICBSSU5HX01JX01PREUs
IF9NQVNLRURfQklUX0VOQUJMRShTVE9QX1JJTkcpKTsKIAkJaWYgKGludGVsX3dhaXRfZm9yX3Jl
Z2lzdGVyKGVuZ2luZS0+dW5jb3JlLApAQCAtNjIyLDcgKzYyMiw3IEBAIHN0YXRpYyBib29sIHN0
b3BfcmluZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIHN0YXRpYyBpbnQgeGNz
X3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZW5naW5lLT5pOTE1OworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gZW5naW5lLT5pOTE1OwogCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nID0g
ZW5naW5lLT5idWZmZXI7CiAJaW50IHJldCA9IDA7CiAKQEAgLTY1NCw3ICs2NTQsNyBAQCBzdGF0
aWMgaW50IHhjc19yZXN1bWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQl9CiAJ
fQogCi0JaWYgKEhXU19ORUVEU19QSFlTSUNBTChkZXZfcHJpdikpCisJaWYgKEhXU19ORUVEU19Q
SFlTSUNBTChpOTE1KSkKIAkJcmluZ19zZXR1cF9waHlzX3N0YXR1c19wYWdlKGVuZ2luZSk7CiAJ
ZWxzZQogCQlyaW5nX3NldHVwX3N0YXR1c19wYWdlKGVuZ2luZSk7CkBAIC03MDUsNyArNzA1LDcg
QEAgc3RhdGljIGludCB4Y3NfcmVzdW1lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAkJZ290byBvdXQ7CiAJfQogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPiAyKQorCWlmIChJ
TlRFTF9HRU4oaTkxNSkgPiAyKQogCQlFTkdJTkVfV1JJVEUoZW5naW5lLAogCQkJICAgICBSSU5H
X01JX01PREUsIF9NQVNLRURfQklUX0RJU0FCTEUoU1RPUF9SSU5HKSk7CiAKQEAgLTgxNSw3ICs4
MTUsNyBAQCBzdGF0aWMgaW50IGludGVsX3Jjc19jdHhfaW5pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSkKIAogc3RhdGljIGludCByY3NfcmVzdW1lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBlbmdpbmUtPmk5
MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CiAKIAkv
KgogCSAqIERpc2FibGUgQ09OU1RBTlRfQlVGRkVSIGJlZm9yZSBpdCBpcyBsb2FkZWQgZnJvbSB0
aGUgY29udGV4dApAQCAtODI3LDEyICs4MjcsMTIgQEAgc3RhdGljIGludCByY3NfcmVzdW1lKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkgKiB0aGV5IGFyZSBhbHJlYWR5IGFjY3Vz
dG9tZWQgdG8gZnJvbSBiZWZvcmUgY29udGV4dHMgd2VyZQogCSAqIGVuYWJsZWQuCiAJICovCi0J
aWYgKElTX0dFTihkZXZfcHJpdiwgNCkpCisJaWYgKElTX0dFTihpOTE1LCA0KSkKIAkJSTkxNV9X
UklURShFQ09TS1BELAogCQkJICAgX01BU0tFRF9CSVRfRU5BQkxFKEVDT19DT05TVEFOVF9CVUZG
RVJfU1JfRElTQUJMRSkpOwogCiAJLyogV2FUaW1lZFNpbmdsZVZlcnRleERpc3BhdGNoOmNsLGJ3
LGN0ZyxlbGssaWxrLHNuYiAqLwotCWlmIChJU19HRU5fUkFOR0UoZGV2X3ByaXYsIDQsIDYpKQor
CWlmIChJU19HRU5fUkFOR0UoaTkxNSwgNCwgNikpCiAJCUk5MTVfV1JJVEUoTUlfTU9ERSwgX01B
U0tFRF9CSVRfRU5BQkxFKFZTX1RJTUVSX0RJU1BBVENIKSk7CiAKIAkvKiBXZSBuZWVkIHRvIGRp
c2FibGUgdGhlIEFzeW5jRmxpcCBwZXJmb3JtYW5jZSBvcHRpbWlzYXRpb25zIGluIG9yZGVyCkBA
IC04NDEsMjIgKzg0MSwyMiBAQCBzdGF0aWMgaW50IHJjc19yZXN1bWUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogCSAqCiAJICogV2FEaXNhYmxlQXN5bmNGbGlwUGVyZk1vZGU6c25i
LGl2Yixoc3csdmx2CiAJICovCi0JaWYgKElTX0dFTl9SQU5HRShkZXZfcHJpdiwgNiwgNykpCisJ
aWYgKElTX0dFTl9SQU5HRShpOTE1LCA2LCA3KSkKIAkJSTkxNV9XUklURShNSV9NT0RFLCBfTUFT
S0VEX0JJVF9FTkFCTEUoQVNZTkNfRkxJUF9QRVJGX0RJU0FCTEUpKTsKIAogCS8qIFJlcXVpcmVk
IGZvciB0aGUgaGFyZHdhcmUgdG8gcHJvZ3JhbSBzY2FubGluZSB2YWx1ZXMgZm9yIHdhaXRpbmcg
Ki8KIAkvKiBXYUVuYWJsZUZsdXNoVGxiSW52YWxpZGF0aW9uTW9kZTpzbmIgKi8KLQlpZiAoSVNf
R0VOKGRldl9wcml2LCA2KSkKKwlpZiAoSVNfR0VOKGk5MTUsIDYpKQogCQlJOTE1X1dSSVRFKEdG
WF9NT0RFLAogCQkJICAgX01BU0tFRF9CSVRfRU5BQkxFKEdGWF9UTEJfSU5WQUxJREFURV9FWFBM
SUNJVCkpOwogCiAJLyogV2FCQ1NWQ1NUbGJJbnZhbGlkYXRpb25Nb2RlOml2Yix2bHYsaHN3ICov
Ci0JaWYgKElTX0dFTihkZXZfcHJpdiwgNykpCisJaWYgKElTX0dFTihpOTE1LCA3KSkKIAkJSTkx
NV9XUklURShHRlhfTU9ERV9HRU43LAogCQkJICAgX01BU0tFRF9CSVRfRU5BQkxFKEdGWF9UTEJf
SU5WQUxJREFURV9FWFBMSUNJVCkgfAogCQkJICAgX01BU0tFRF9CSVRfRU5BQkxFKEdGWF9SRVBM
QVlfTU9ERSkpOwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgNikpIHsKKwlpZiAoSVNfR0VOKGk5
MTUsIDYpKSB7CiAJCS8qIEZyb20gdGhlIFNhbmR5YnJpZGdlIFBSTSwgdm9sdW1lIDEgcGFydCAz
LCBwYWdlIDI0OgogCQkgKiAiSWYgdGhpcyBiaXQgaXMgc2V0LCBTVEN1bml0IHdpbGwgaGF2ZSBM
UkEgYXMgcmVwbGFjZW1lbnQKIAkJICogIHBvbGljeS4gWy4uLl0gVGhpcyBiaXQgbXVzdCBiZSBy
ZXNldC4gIExSQSByZXBsYWNlbWVudApAQCAtODY2LDcgKzg2Niw3IEBAIHN0YXRpYyBpbnQgcmNz
X3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCQkgICBfTUFTS0VEX0JJ
VF9ESVNBQkxFKENNMF9TVENfRVZJQ1RfRElTQUJMRV9MUkFfU05CKSk7CiAJfQogCi0JaWYgKElT
X0dFTl9SQU5HRShkZXZfcHJpdiwgNiwgNykpCisJaWYgKElTX0dFTl9SQU5HRShpOTE1LCA2LCA3
KSkKIAkJSTkxNV9XUklURShJTlNUUE0sIF9NQVNLRURfQklUX0VOQUJMRShJTlNUUE1fRk9SQ0Vf
T1JERVJJTkcpKTsKIAogCXJldHVybiB4Y3NfcmVzdW1lKGVuZ2luZSk7CkBAIC0xMjI3LDE1ICsx
MjI3LDE1IEBAIHZvaWQgaW50ZWxfcmluZ191bnBpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykK
IH0KIAogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqCi1pbnRlbF9yaW5nX2NyZWF0ZV92bWEoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgc2l6ZSkKK2ludGVsX3JpbmdfY3Jl
YXRlX3ZtYShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHNpemUpCiB7Ci0Jc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSAmZGV2X3ByaXYtPmdndHQudm07CisJc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSAmaTkxNS0+Z2d0dC52bTsKIAlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCi0Jb2JqID0gaTkx
NV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4oZGV2X3ByaXYsIHNpemUpOworCW9iaiA9IGk5MTVf
Z2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGk5MTUsIHNpemUpOwogCWlmICghb2JqKQotCQlvYmog
PSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGRldl9wcml2LCBzaXplKTsKKwkJb2Jq
ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBzaXplKTsKIAlpZiAoSVNf
RVJSKG9iaikpCiAJCXJldHVybiBFUlJfQ0FTVChvYmopOwogCkBAIC0yMTE1LDkgKzIxMTUsOSBA
QCBzdGF0aWMgdm9pZCBnZW42X2JzZF9zZXRfZGVmYXVsdF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogc3RhdGljIHZvaWQgcmluZ19kZXN0cm95KHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBlbmdpbmUtPmk5MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBl
bmdpbmUtPmk5MTU7CiAKLQlXQVJOX09OKElOVEVMX0dFTihkZXZfcHJpdikgPiAyICYmCisJV0FS
Tl9PTihJTlRFTF9HRU4oaTkxNSkgPiAyICYmCiAJCShFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdf
TUlfTU9ERSkgJiBNT0RFX0lETEUpID09IDApOwogCiAJaW50ZWxfcmluZ191bnBpbihlbmdpbmUt
PmJ1ZmZlcik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVf
Z20uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9hcGVydHVyZV9nbS5jCmluZGV4IDFmYTJm
NjVjM2NkMS4uODgwN2RlNTY2MzYxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvYXBlcnR1cmVfZ20uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVf
Z20uYwpAQCAtNDAsNyArNDAsNyBAQAogc3RhdGljIGludCBhbGxvY19nbShzdHJ1Y3QgaW50ZWxf
dmdwdSAqdmdwdSwgYm9vbCBoaWdoX2dtKQogewogCXN0cnVjdCBpbnRlbF9ndnQgKmd2dCA9IHZn
cHUtPmd2dDsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndnQtPmRldl9w
cml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3Z0LT5pOTE1OwogCXVuc2ln
bmVkIGludCBmbGFnczsKIAl1NjQgc3RhcnQsIGVuZCwgc2l6ZTsKIAlzdHJ1Y3QgZHJtX21tX25v
ZGUgKm5vZGU7CkBAIC02MCwxNCArNjAsMTQgQEAgc3RhdGljIGludCBhbGxvY19nbShzdHJ1Y3Qg
aW50ZWxfdmdwdSAqdmdwdSwgYm9vbCBoaWdoX2dtKQogCQlmbGFncyA9IFBJTl9NQVBQQUJMRTsK
IAl9CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JbW1pb19o
d19hY2Nlc3NfcHJlKGRldl9wcml2KTsKLQlyZXQgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZkZXZf
cHJpdi0+Z2d0dC52bSwgbm9kZSwKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKKwltbWlvX2h3X2FjY2Vzc19wcmUoaTkxNSk7CisJcmV0ID0gaTkxNV9nZW1fZ3R0X2luc2Vy
dCgmaTkxNS0+Z2d0dC52bSwgbm9kZSwKIAkJCQkgIHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRSwK
IAkJCQkgIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCiAJCQkJICBzdGFydCwgZW5kLCBmbGFncyk7
Ci0JbW1pb19od19hY2Nlc3NfcG9zdChkZXZfcHJpdik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbW1pb19od19hY2Nlc3NfcG9zdChpOTE1KTsKKwltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChyZXQpCiAJCWd2dF9lcnIo
ImZhaWwgdG8gYWxsb2MgJXMgZ20gc3BhY2UgZnJvbSBob3N0XG4iLAogCQkJaGlnaF9nbSA/ICJo
aWdoIiA6ICJsb3ciKTsKQEAgLTc4LDcgKzc4LDcgQEAgc3RhdGljIGludCBhbGxvY19nbShzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwgYm9vbCBoaWdoX2dtKQogc3RhdGljIGludCBhbGxvY192Z3B1
X2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogewogCXN0cnVjdCBpbnRlbF9ndnQgKmd2dCA9
IHZncHUtPmd2dDsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndnQtPmRl
dl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3Z0LT5pOTE1OwogCWlu
dCByZXQ7CiAKIAlyZXQgPSBhbGxvY19nbSh2Z3B1LCBmYWxzZSk7CkBAIC05NywyMCArOTcsMjAg
QEAgc3RhdGljIGludCBhbGxvY192Z3B1X2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCiAJ
cmV0dXJuIDA7CiBvdXRfZnJlZV9hcGVydHVyZToKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
ZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5sb3dfZ21fbm9kZSk7Ci0JbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCBmcmVlX3ZncHVf
Z20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0u
c3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlk
cm1fbW1fcmVtb3ZlX25vZGUoJnZncHUtPmdtLmxvd19nbV9ub2RlKTsKIAlkcm1fbW1fcmVtb3Zl
X25vZGUoJnZncHUtPmdtLmhpZ2hfZ21fbm9kZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIH0KIAogLyoqCkBAIC0xMjcsMTEgKzEyNywxMSBAQCB2b2lkIGludGVsX3ZncHVfd3JpdGVf
ZmVuY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiAJCXUzMiBmZW5jZSwgdTY0IHZhbHVlKQog
ewogCXN0cnVjdCBpbnRlbF9ndnQgKmd2dCA9IHZncHUtPmd2dDsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gZ3Z0LT5pOTE1OwogCXN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKnJlZzsK
IAlpOTE1X3JlZ190IGZlbmNlX3JlZ19sbywgZmVuY2VfcmVnX2hpOwogCi0JYXNzZXJ0X3JwbV93
YWtlbG9ja19oZWxkKGRldl9wcml2KTsKKwlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoaTkxNSk7
CiAKIAlpZiAoV0FSTl9PTihmZW5jZSA+PSB2Z3B1X2ZlbmNlX3N6KHZncHUpKSkKIAkJcmV0dXJu
OwpAQCAtMTYyLDQxICsxNjIsNDEgQEAgc3RhdGljIHZvaWQgX2NsZWFyX3ZncHVfZmVuY2Uoc3Ry
dWN0IGludGVsX3ZncHUgKnZncHUpCiBzdGF0aWMgdm9pZCBmcmVlX3ZncHVfZmVuY2Uoc3RydWN0
IGludGVsX3ZncHUgKnZncHUpCiB7CiAJc3RydWN0IGludGVsX2d2dCAqZ3Z0ID0gdmdwdS0+Z3Z0
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd2dC0+ZGV2X3ByaXY7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndnQtPmk5MTU7CiAJc3RydWN0IGRybV9p
OTE1X2ZlbmNlX3JlZyAqcmVnOwogCXUzMiBpOwogCiAJaWYgKFdBUk5fT04oIXZncHVfZmVuY2Vf
c3oodmdwdSkpKQogCQlyZXR1cm47CiAKLQlpbnRlbF9ydW50aW1lX3BtX2dldChkZXZfcHJpdik7
CisJaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJX2NsZWFyX3ZncHVfZmVuY2UodmdwdSk7CiAJZm9yIChpID0gMDsgaSA8IHZncHVfZmVuY2Vf
c3oodmdwdSk7IGkrKykgewogCQlyZWcgPSB2Z3B1LT5mZW5jZS5yZWdzW2ldOwogCQlpOTE1X3Vu
cmVzZXJ2ZV9mZW5jZShyZWcpOwogCQl2Z3B1LT5mZW5jZS5yZWdzW2ldID0gTlVMTDsKIAl9Ci0J
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAotCWludGVsX3J1bnRpbWVfcG1fcHV0X3VuY2hl
Y2tlZChkZXZfcHJpdik7CisJaW50ZWxfcnVudGltZV9wbV9wdXRfdW5jaGVja2VkKGk5MTUpOwog
fQogCiBzdGF0aWMgaW50IGFsbG9jX3ZncHVfZmVuY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUp
CiB7CiAJc3RydWN0IGludGVsX2d2dCAqZ3Z0ID0gdmdwdS0+Z3Z0OwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGd2dC0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBndnQtPmk5MTU7CiAJc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqcmVn
OwogCWludCBpOwogCi0JaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOworCWludGVsX3J1
bnRpbWVfcG1fZ2V0KGk5MTUpOwogCiAJLyogUmVxdWVzdCBmZW5jZXMgZnJvbSBob3N0ICovCi0J
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZm9yIChpID0gMDsgaSA8IHZncHVfZmVuY2Vfc3oo
dmdwdSk7IGkrKykgewotCQlyZWcgPSBpOTE1X3Jlc2VydmVfZmVuY2UoZGV2X3ByaXYpOworCQly
ZWcgPSBpOTE1X3Jlc2VydmVfZmVuY2UoaTkxNSk7CiAJCWlmIChJU19FUlIocmVnKSkKIAkJCWdv
dG8gb3V0X2ZyZWVfZmVuY2U7CiAKQEAgLTIwNSw4ICsyMDUsOCBAQCBzdGF0aWMgaW50IGFsbG9j
X3ZncHVfZmVuY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAKIAlfY2xlYXJfdmdwdV9mZW5j
ZSh2Z3B1KTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWludGVsX3J1bnRpbWVfcG1fcHV0X3VuY2hlY2tlZChkZXZfcHJpdik7CisJbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dF91bmNoZWNr
ZWQoaTkxNSk7CiAJcmV0dXJuIDA7CiBvdXRfZnJlZV9mZW5jZToKIAlndnRfdmdwdV9lcnIoIkZh
aWxlZCB0byBhbGxvYyBmZW5jZXNcbiIpOwpAQCAtMjE4LDggKzIxOCw4IEBAIHN0YXRpYyBpbnQg
YWxsb2NfdmdwdV9mZW5jZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAkJaTkxNV91bnJlc2Vy
dmVfZmVuY2UocmVnKTsKIAkJdmdwdS0+ZmVuY2UucmVnc1tpXSA9IE5VTEw7CiAJfQotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWludGVsX3J1bnRpbWVfcG1f
cHV0X3VuY2hlY2tlZChkZXZfcHJpdik7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dF91bmNoZWNrZWQoaTkxNSk7CiAJcmV0dXJu
IC1FTk9TUEM7CiB9CiAKQEAgLTMxMywxMSArMzEzLDExIEBAIHZvaWQgaW50ZWxfdmdwdV9mcmVl
X3Jlc291cmNlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogICovCiB2b2lkIGludGVsX3ZncHVf
cmVzZXRfcmVzb3VyY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKIAotCWludGVsX3J1bnRpbWVf
cG1fZ2V0KGRldl9wcml2KTsKKwlpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAlfY2xlYXJf
dmdwdV9mZW5jZSh2Z3B1KTsKLQlpbnRlbF9ydW50aW1lX3BtX3B1dF91bmNoZWNrZWQoZGV2X3By
aXYpOworCWludGVsX3J1bnRpbWVfcG1fcHV0X3VuY2hlY2tlZChpOTE1KTsKIH0KIAogLyoqCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY2ZnX3NwYWNlLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvY2ZnX3NwYWNlLmMKaW5kZXggMTljZjFiYmUwNTlkLi5kM2E3NDRl
N2M5NTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jZmdfc3BhY2UuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY2ZnX3NwYWNlLmMKQEAgLTM5MSw5ICszOTEs
OSBAQCB2b2lkIGludGVsX3ZncHVfaW5pdF9jZmdfc3BhY2Uoc3RydWN0IGludGVsX3ZncHUgKnZn
cHUsCiAJbWVtc2V0KHZncHVfY2ZnX3NwYWNlKHZncHUpICsgSU5URUxfR1ZUX1BDSV9PUFJFR0lP
TiwgMCwgNCk7CiAKIAl2Z3B1LT5jZmdfc3BhY2UuYmFyW0lOVEVMX0dWVF9QQ0lfQkFSX0dUVE1N
SU9dLnNpemUgPQotCQkJCXBjaV9yZXNvdXJjZV9sZW4oZ3Z0LT5kZXZfcHJpdi0+ZHJtLnBkZXYs
IDApOworCQkJCXBjaV9yZXNvdXJjZV9sZW4oZ3Z0LT5pOTE1LT5kcm0ucGRldiwgMCk7CiAJdmdw
dS0+Y2ZnX3NwYWNlLmJhcltJTlRFTF9HVlRfUENJX0JBUl9BUEVSVFVSRV0uc2l6ZSA9Ci0JCQkJ
cGNpX3Jlc291cmNlX2xlbihndnQtPmRldl9wcml2LT5kcm0ucGRldiwgMik7CisJCQkJcGNpX3Jl
c291cmNlX2xlbihndnQtPmk5MTUtPmRybS5wZGV2LCAyKTsKIAogCW1lbXNldCh2Z3B1X2NmZ19z
cGFjZSh2Z3B1KSArIFBDSV9ST01fQUREUkVTUywgMCwgNCk7CiB9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Z0L2NtZF9wYXJzZXIuYwppbmRleCA2ZWE4ODI3MGM4MTguLjJiMDlhY2MwNTAyZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCkBAIC04MTksNyArODE5LDcgQEAgc3RhdGlj
IGludCBmb3JjZV9ub25wcml2X3JlZ19oYW5kbGVyKHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAq
cywKIAl1bnNpZ25lZCBpbnQgZGF0YTsKIAl1MzIgcmluZ19iYXNlOwogCXUzMiBub3BpZDsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzLT52Z3B1LT5ndnQtPmRldl9wcml2
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gcy0+dmdwdS0+Z3Z0LT5pOTE1Owog
CiAJaWYgKCFzdHJjbXAoY21kLCAibHJpIikpCiAJCWRhdGEgPSBjbWRfdmFsKHMsIGluZGV4ICsg
MSk7CkBAIC04MjksNyArODI5LDcgQEAgc3RhdGljIGludCBmb3JjZV9ub25wcml2X3JlZ19oYW5k
bGVyKHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcywKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQog
Ci0JcmluZ19iYXNlID0gZGV2X3ByaXYtPmVuZ2luZVtzLT5yaW5nX2lkXS0+bW1pb19iYXNlOwor
CXJpbmdfYmFzZSA9IGk5MTUtPmVuZ2luZVtzLT5yaW5nX2lkXS0+bW1pb19iYXNlOwogCW5vcGlk
ID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19OT1BJRChyaW5nX2Jhc2UpKTsKIAogCWlmICgh
aW50ZWxfZ3Z0X2luX2ZvcmNlX25vbnByaXZfd2hpdGVsaXN0KGd2dCwgZGF0YSkgJiYKQEAgLTkw
NSw3ICs5MDUsNyBAQCBzdGF0aWMgaW50IGNtZF9yZWdfaGFuZGxlcihzdHJ1Y3QgcGFyc2VyX2V4
ZWNfc3RhdGUgKnMsCiAJICogdXBkYXRlIHJlZyB2YWx1ZXMgaW4gaXQgaW50byB2cmVncywgc28g
TFJJcyBpbiB3b3JrbG9hZCB3aXRoCiAJICogaW5oaWJpdCBjb250ZXh0IHdpbGwgcmVzdG9yZSB3
aXRoIGNvcnJlY3QgdmFsdWVzCiAJICovCi0JaWYgKElTX0dFTihndnQtPmRldl9wcml2LCA5KSAm
JgorCWlmIChJU19HRU4oZ3Z0LT5pOTE1LCA5KSAmJgogCQkJaW50ZWxfZ3Z0X21taW9faXNfaW5f
Y3R4KGd2dCwgb2Zmc2V0KSAmJgogCQkJIXN0cm5jbXAoY21kLCAibHJpIiwgMykpIHsKIAkJaW50
ZWxfZ3Z0X2h5cGVydmlzb3JfcmVhZF9ncGEocy0+dmdwdSwKQEAgLTk0Niw3ICs5NDYsNyBAQCBz
dGF0aWMgaW50IGNtZF9oYW5kbGVyX2xyaShzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpCiAJ
c3RydWN0IGludGVsX2d2dCAqZ3Z0ID0gcy0+dmdwdS0+Z3Z0OwogCiAJZm9yIChpID0gMTsgaSA8
IGNtZF9sZW47IGkgKz0gMikgewotCQlpZiAoSVNfQlJPQURXRUxMKGd2dC0+ZGV2X3ByaXYpICYm
IHMtPnJpbmdfaWQgIT0gUkNTMCkgeworCQlpZiAoSVNfQlJPQURXRUxMKGd2dC0+aTkxNSkgJiYg
cy0+cmluZ19pZCAhPSBSQ1MwKSB7CiAJCQlpZiAocy0+cmluZ19pZCA9PSBCQ1MwICYmCiAJCQkg
ICAgY21kX3JlZyhzLCBpKSA9PSBpOTE1X21taW9fcmVnX29mZnNldChERVJSTVIpKQogCQkJCXJl
dCB8PSAwOwpAQCAtOTY4LDcgKzk2OCw3IEBAIHN0YXRpYyBpbnQgY21kX2hhbmRsZXJfbHJyKHN0
cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcykKIAlpbnQgY21kX2xlbiA9IGNtZF9sZW5ndGgocyk7
CiAKIAlmb3IgKGkgPSAxOyBpIDwgY21kX2xlbjsgaSArPSAyKSB7Ci0JCWlmIChJU19CUk9BRFdF
TEwocy0+dmdwdS0+Z3Z0LT5kZXZfcHJpdikpCisJCWlmIChJU19CUk9BRFdFTEwocy0+dmdwdS0+
Z3Z0LT5pOTE1KSkKIAkJCXJldCB8PSAoKGNtZF9yZWdfaW5oaWJpdChzLCBpKSB8fAogCQkJCQko
Y21kX3JlZ19pbmhpYml0KHMsIGkgKyAxKSkpKSA/CiAJCQkJLUVCQURSUUMgOiAwOwpAQCAtOTk2
LDcgKzk5Niw3IEBAIHN0YXRpYyBpbnQgY21kX2hhbmRsZXJfbHJtKHN0cnVjdCBwYXJzZXJfZXhl
Y19zdGF0ZSAqcykKIAlpbnQgY21kX2xlbiA9IGNtZF9sZW5ndGgocyk7CiAKIAlmb3IgKGkgPSAx
OyBpIDwgY21kX2xlbjspIHsKLQkJaWYgKElTX0JST0FEV0VMTChndnQtPmRldl9wcml2KSkKKwkJ
aWYgKElTX0JST0FEV0VMTChndnQtPmk5MTUpKQogCQkJcmV0IHw9IChjbWRfcmVnX2luaGliaXQo
cywgaSkpID8gLUVCQURSUUMgOiAwOwogCQlpZiAocmV0KQogCQkJYnJlYWs7CkBAIC0xMTgwLDcg
KzExODAsNyBAQCBzdHJ1Y3QgcGxhbmVfY29kZV9tYXBwaW5nIHsKIHN0YXRpYyBpbnQgZ2VuOF9k
ZWNvZGVfbWlfZGlzcGxheV9mbGlwKHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcywKIAkJc3Ry
dWN0IG1pX2Rpc3BsYXlfZmxpcF9jb21tYW5kX2luZm8gKmluZm8pCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gcy0+dmdwdS0+Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHMtPnZncHUtPmd2dC0+aTkxNTsKIAlzdHJ1Y3QgcGxh
bmVfY29kZV9tYXBwaW5nIGdlbjhfcGxhbmVfY29kZVtdID0gewogCQlbMF0gPSB7UElQRV9BLCBQ
TEFORV9BLCBQUklNQVJZX0FfRkxJUF9ET05FfSwKIAkJWzFdID0ge1BJUEVfQiwgUExBTkVfQSwg
UFJJTUFSWV9CX0ZMSVBfRE9ORX0sCkBAIC0xMjI2LDcgKzEyMjYsNyBAQCBzdGF0aWMgaW50IGdl
bjhfZGVjb2RlX21pX2Rpc3BsYXlfZmxpcChzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMsCiBz
dGF0aWMgaW50IHNrbF9kZWNvZGVfbWlfZGlzcGxheV9mbGlwKHN0cnVjdCBwYXJzZXJfZXhlY19z
dGF0ZSAqcywKIAkJc3RydWN0IG1pX2Rpc3BsYXlfZmxpcF9jb21tYW5kX2luZm8gKmluZm8pCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gcy0+dmdwdS0+Z3Z0LT5kZXZf
cHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHMtPnZncHUtPmd2dC0+aTkx
NTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSA9IHMtPnZncHU7CiAJdTMyIGR3b3JkMCA9IGNt
ZF92YWwocywgMCk7CiAJdTMyIGR3b3JkMSA9IGNtZF92YWwocywgMSk7CkBAIC0xMjg1LDEzICsx
Mjg1LDEzIEBAIHN0YXRpYyBpbnQgc2tsX2RlY29kZV9taV9kaXNwbGF5X2ZsaXAoc3RydWN0IHBh
cnNlcl9leGVjX3N0YXRlICpzLAogc3RhdGljIGludCBnZW44X2NoZWNrX21pX2Rpc3BsYXlfZmxp
cChzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMsCiAJCXN0cnVjdCBtaV9kaXNwbGF5X2ZsaXBf
Y29tbWFuZF9pbmZvICppbmZvKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHMtPnZncHUtPmd2dC0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBzLT52Z3B1LT5ndnQtPmk5MTU7CiAJdTMyIHN0cmlkZSwgdGlsZTsKIAogCWlmICghaW5m
by0+YXN5bmNfZmxpcCkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA5KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KSB7CiAJCXN0cmlkZSA9IHZncHVfdnJl
Z190KHMtPnZncHUsIGluZm8tPnN0cmlkZV9yZWcpICYgR0VOTUFTSyg5LCAwKTsKIAkJdGlsZSA9
ICh2Z3B1X3ZyZWdfdChzLT52Z3B1LCBpbmZvLT5jdHJsX3JlZykgJgogCQkJCUdFTk1BU0soMTIs
IDEwKSkgPj4gMTA7CkBAIC0xMzE0LDEyICsxMzE0LDEyIEBAIHN0YXRpYyBpbnQgZ2VuOF91cGRh
dGVfcGxhbmVfbW1pb19mcm9tX21pX2Rpc3BsYXlfZmxpcCgKIAkJc3RydWN0IHBhcnNlcl9leGVj
X3N0YXRlICpzLAogCQlzdHJ1Y3QgbWlfZGlzcGxheV9mbGlwX2NvbW1hbmRfaW5mbyAqaW5mbykK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzLT52Z3B1LT5ndnQtPmRl
dl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gcy0+dmdwdS0+Z3Z0LT5p
OTE1OwogCXN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1ID0gcy0+dmdwdTsKIAogCXNldF9tYXNrX2Jp
dHMoJnZncHVfdnJlZ190KHZncHUsIGluZm8tPnN1cmZfcmVnKSwgR0VOTUFTSygzMSwgMTIpLAog
CQkgICAgICBpbmZvLT5zdXJmX3ZhbCA8PCAxMik7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gOSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkgewogCQlzZXRfbWFza19iaXRzKCZ2
Z3B1X3ZyZWdfdCh2Z3B1LCBpbmZvLT5zdHJpZGVfcmVnKSwgR0VOTUFTSyg5LCAwKSwKIAkJCSAg
ICAgIGluZm8tPnN0cmlkZV92YWwpOwogCQlzZXRfbWFza19iaXRzKCZ2Z3B1X3ZyZWdfdCh2Z3B1
LCBpbmZvLT5jdHJsX3JlZyksIEdFTk1BU0soMTIsIDEwKSwKQEAgLTEzNDUsMTEgKzEzNDUsMTEg
QEAgc3RhdGljIGludCBnZW44X3VwZGF0ZV9wbGFuZV9tbWlvX2Zyb21fbWlfZGlzcGxheV9mbGlw
KAogc3RhdGljIGludCBkZWNvZGVfbWlfZGlzcGxheV9mbGlwKHN0cnVjdCBwYXJzZXJfZXhlY19z
dGF0ZSAqcywKIAkJc3RydWN0IG1pX2Rpc3BsYXlfZmxpcF9jb21tYW5kX2luZm8gKmluZm8pCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gcy0+dmdwdS0+Z3Z0LT5kZXZf
cHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHMtPnZncHUtPmd2dC0+aTkx
NTsKIAotCWlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCWlmIChJU19CUk9BRFdFTEwoaTkx
NSkpCiAJCXJldHVybiBnZW44X2RlY29kZV9taV9kaXNwbGF5X2ZsaXAocywgaW5mbyk7Ci0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpCiAJ
CXJldHVybiBza2xfZGVjb2RlX21pX2Rpc3BsYXlfZmxpcChzLCBpbmZvKTsKIAogCXJldHVybiAt
RU5PREVWOwpAQCAtMTc1Niw3ICsxNzU2LDcgQEAgc3RhdGljIGludCBwZXJmb3JtX2JiX3NoYWRv
dyhzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpCiAJaWYgKGJiLT5wcGd0dCkKIAkJc3RhcnRf
b2Zmc2V0ID0gZ21hICYgfkk5MTVfR1RUX1BBR0VfTUFTSzsKIAotCWJiLT5vYmogPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlX3NobWVtKHMtPnZncHUtPmd2dC0+ZGV2X3ByaXYsCisJYmItPm9iaiA9
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0ocy0+dmdwdS0+Z3Z0LT5pOTE1LAogCQkJCQkg
ICAgICAgcm91bmRfdXAoYmJfc2l6ZSArIHN0YXJ0X29mZnNldCwKIAkJCQkJCQlQQUdFX1NJWkUp
KTsKIAlpZiAoSVNfRVJSKGJiLT5vYmopKSB7CkBAIC0yODMwLDcgKzI4MzAsNyBAQCBzdGF0aWMg
aW50IHNoYWRvd19pbmRpcmVjdF9jdHgoc3RydWN0IGludGVsX3NoYWRvd193YV9jdHggKndhX2N0
eCkKIAlpbnQgcmV0ID0gMDsKIAl2b2lkICptYXA7CiAKLQlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX3NobWVtKHdvcmtsb2FkLT52Z3B1LT5ndnQtPmRldl9wcml2LAorCW9iaiA9IGk5MTVf
Z2VtX29iamVjdF9jcmVhdGVfc2htZW0od29ya2xvYWQtPnZncHUtPmd2dC0+aTkxNSwKIAkJCQkJ
ICAgcm91bmR1cChjdHhfc2l6ZSArIENBQ0hFTElORV9CWVRFUywKIAkJCQkJCSAgIFBBR0VfU0la
RSkpOwogCWlmIChJU19FUlIob2JqKSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZGVidWdmcy5jCmluZGV4
IDJmYjdiNzNiMjYwZC4uMWZmN2YxMWM4OWEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9kZWJ1Z2Zz
LmMKQEAgLTU4LDcgKzU4LDcgQEAgc3RhdGljIGludCBtbWlvX29mZnNldF9jb21wYXJlKHZvaWQg
KnByaXYsCiBzdGF0aWMgaW5saW5lIGludCBtbWlvX2RpZmZfaGFuZGxlcihzdHJ1Y3QgaW50ZWxf
Z3Z0ICpndnQsCiAJCQkJICAgIHUzMiBvZmZzZXQsIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gZ3Z0LT5pOTE1OwogCXN0cnVjdCBtbWlvX2RpZmZfcGFyYW0gKnBhcmFt
ID0gZGF0YTsKIAlzdHJ1Y3QgZGlmZl9tbWlvICpub2RlOwogCXUzMiBwcmVnLCB2cmVnOwpAQCAt
OTgsMTAgKzk4LDEwIEBAIHN0YXRpYyBpbnQgdmdwdV9tbWlvX2RpZmZfc2hvdyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKnMsIHZvaWQgKnVudXNlZCkKIAltdXRleF9sb2NrKCZndnQtPmxvY2spOwogCXNwaW5f
bG9ja19iaCgmZ3Z0LT5zY2hlZHVsZXIubW1pb19jb250ZXh0X2xvY2spOwogCi0JbW1pb19od19h
Y2Nlc3NfcHJlKGd2dC0+ZGV2X3ByaXYpOworCW1taW9faHdfYWNjZXNzX3ByZShndnQtPmk5MTUp
OwogCS8qIFJlY29nbml6ZSBhbGwgdGhlIGRpZmYgbW1pb3MgdG8gbGlzdC4gKi8KIAlpbnRlbF9n
dnRfZm9yX2VhY2hfdHJhY2tlZF9tbWlvKGd2dCwgbW1pb19kaWZmX2hhbmRsZXIsICZwYXJhbSk7
Ci0JbW1pb19od19hY2Nlc3NfcG9zdChndnQtPmRldl9wcml2KTsKKwltbWlvX2h3X2FjY2Vzc19w
b3N0KGd2dC0+aTkxNSk7CiAKIAlzcGluX3VubG9ja19iaCgmZ3Z0LT5zY2hlZHVsZXIubW1pb19j
b250ZXh0X2xvY2spOwogCW11dGV4X3VubG9jaygmZ3Z0LT5sb2NrKTsKQEAgLTE0Miw3ICsxNDIs
NyBAQCBzdGF0aWMgaW50CiB2Z3B1X3NjYW5fbm9ucHJpdmJiX3NldCh2b2lkICpkYXRhLCB1NjQg
dmFsKQogewogCXN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1ID0gKHN0cnVjdCBpbnRlbF92Z3B1ICop
ZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRl
dl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5pOTE1
OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCWNoYXIgYnVmWzEyOF0sICpzOwogCWludCBs
ZW47CkBAIC0xNjQsNyArMTY0LDcgQEAgdmdwdV9zY2FuX25vbnByaXZiYl9zZXQodm9pZCAqZGF0
YSwgdTY0IHZhbCkKIAlmb3IgKGlkID0gMDsgaWQgPCBJOTE1X05VTV9FTkdJTkVTOyBpZCsrKSB7
CiAJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAotCQllbmdpbmUgPSBkZXZfcHJp
di0+ZW5naW5lW2lkXTsKKwkJZW5naW5lID0gaTkxNS0+ZW5naW5lW2lkXTsKIAkJaWYgKGVuZ2lu
ZSAmJiAodmFsICYgKDEgPDwgaWQpKSkgewogCQkJbGVuID0gc25wcmludGYocywgNCwgIiVkLCAi
LCBlbmdpbmUtPmlkKTsKIAkJCXMgKz0gbGVuOwpAQCAtMjQwLDcgKzI0MCw3IEBAIHZvaWQgaW50
ZWxfZ3Z0X2RlYnVnZnNfcmVtb3ZlX3ZncHUoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAgKi8K
IGludCBpbnRlbF9ndnRfZGVidWdmc19pbml0KHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkKIHsKLQlz
dHJ1Y3QgZHJtX21pbm9yICptaW5vciA9IGd2dC0+ZGV2X3ByaXYtPmRybS5wcmltYXJ5OworCXN0
cnVjdCBkcm1fbWlub3IgKm1pbm9yID0gZ3Z0LT5pOTE1LT5kcm0ucHJpbWFyeTsKIAlzdHJ1Y3Qg
ZGVudHJ5ICplbnQ7CiAKIAlndnQtPmRlYnVnZnNfcm9vdCA9IGRlYnVnZnNfY3JlYXRlX2Rpcigi
Z3Z0IiwgbWlub3ItPmRlYnVnZnNfcm9vdCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2Rpc3BsYXkuYwpp
bmRleCBlMWMzMTNkYTZjMDAuLmIwMzdhZWVkMmY0MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZGlz
cGxheS5jCkBAIC01Nyw3ICs1Nyw3IEBAIHN0YXRpYyBpbnQgZ2V0X2VkcF9waXBlKHN0cnVjdCBp
bnRlbF92Z3B1ICp2Z3B1KQogCiBzdGF0aWMgaW50IGVkcF9waXBlX2lzX2VuYWJsZWQoc3RydWN0
IGludGVsX3ZncHUgKnZncHUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHZncHUtPmd2dC0+aTkxNTsKIAogCWlmICghKHZncHVfdnJlZ190KHZncHUsIFBJUEVDT05GKF9Q
SVBFX0VEUCkpICYgUElQRUNPTkZfRU5BQkxFKSkKIAkJcmV0dXJuIDA7CkBAIC02OSw3ICs2OSw3
IEBAIHN0YXRpYyBpbnQgZWRwX3BpcGVfaXNfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdw
dSkKIAogaW50IHBpcGVfaXNfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHBp
cGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5k
ZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkx
NTsKIAogCWlmIChXQVJOX09OKHBpcGUgPCBQSVBFX0EgfHwgcGlwZSA+PSBJOTE1X01BWF9QSVBF
UykpCiAJCXJldHVybiAtRUlOVkFMOwpAQCAtMTY4LDEwICsxNjgsMTAgQEAgc3RhdGljIHU4IGRw
Y2RfZml4X2RhdGFbRFBDRF9IRUFERVJfU0laRV0gPSB7CiAKIHN0YXRpYyB2b2lkIGVtdWxhdGVf
bW9uaXRvcl9zdGF0dXNfY2hhbmdlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2Z3B1LT5ndnQtPmk5MTU7CiAJaW50IHBpcGU7
CiAKLQlpZiAoSVNfQlJPWFRPTihkZXZfcHJpdikpIHsKKwlpZiAoSVNfQlJPWFRPTihpOTE1KSkg
ewogCQl2Z3B1X3ZyZWdfdCh2Z3B1LCBHRU44X0RFX1BPUlRfSVNSKSAmPSB+KEJYVF9ERV9QT1JU
X0hQX0RESUEgfAogCQkJQlhUX0RFX1BPUlRfSFBfRERJQiB8CiAJCQlCWFRfREVfUE9SVF9IUF9E
RElDKTsKQEAgLTE5OCw4ICsxOTgsOCBAQCBzdGF0aWMgdm9pZCBlbXVsYXRlX21vbml0b3Jfc3Rh
dHVzX2NoYW5nZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAkJCVNERV9QT1JUQ19IT1RQTFVH
X0NQVCB8CiAJCQlTREVfUE9SVERfSE9UUExVR19DUFQpOwogCi0JaWYgKElTX1NLWUxBS0UoZGV2
X3ByaXYpIHx8IElTX0tBQllMQUtFKGRldl9wcml2KSB8fAotCSAgICBJU19DT0ZGRUVMQUtFKGRl
dl9wcml2KSkgeworCWlmIChJU19TS1lMQUtFKGk5MTUpIHx8IElTX0tBQllMQUtFKGk5MTUpIHx8
CisJICAgIElTX0NPRkZFRUxBS0UoaTkxNSkpIHsKIAkJdmdwdV92cmVnX3QodmdwdSwgU0RFSVNS
KSAmPSB+KFNERV9QT1JUQV9IT1RQTFVHX1NQVCB8CiAJCQkJU0RFX1BPUlRFX0hPVFBMVUdfU1BU
KTsKIAkJdmdwdV92cmVnX3QodmdwdSwgU0tMX0ZVU0VfU1RBVFVTKSB8PQpAQCAtMjIzLDcgKzIy
Myw3IEBAIHN0YXRpYyB2b2lkIGVtdWxhdGVfbW9uaXRvcl9zdGF0dXNfY2hhbmdlKHN0cnVjdCBp
bnRlbF92Z3B1ICp2Z3B1KQogCQkJKFRSQU5TX0RESV9CUENfOCB8IFRSQU5TX0RESV9NT0RFX1NF
TEVDVF9EVkkgfAogCQkJKFBPUlRfQiA8PCBUUkFOU19ERElfUE9SVF9TSElGVCkgfAogCQkJVFJB
TlNfRERJX0ZVTkNfRU5BQkxFKTsKLQkJaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKKwkJ
aWYgKElTX0JST0FEV0VMTChpOTE1KSkgewogCQkJdmdwdV92cmVnX3QodmdwdSwgUE9SVF9DTEtf
U0VMKFBPUlRfQikpICY9CiAJCQkJflBPUlRfQ0xLX1NFTF9NQVNLOwogCQkJdmdwdV92cmVnX3Qo
dmdwdSwgUE9SVF9DTEtfU0VMKFBPUlRfQikpIHw9CkBAIC0yNDMsNyArMjQzLDcgQEAgc3RhdGlj
IHZvaWQgZW11bGF0ZV9tb25pdG9yX3N0YXR1c19jaGFuZ2Uoc3RydWN0IGludGVsX3ZncHUgKnZn
cHUpCiAJCQkoVFJBTlNfRERJX0JQQ184IHwgVFJBTlNfRERJX01PREVfU0VMRUNUX0RWSSB8CiAJ
CQkoUE9SVF9DIDw8IFRSQU5TX0RESV9QT1JUX1NISUZUKSB8CiAJCQlUUkFOU19ERElfRlVOQ19F
TkFCTEUpOwotCQlpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSkgeworCQlpZiAoSVNfQlJPQURX
RUxMKGk5MTUpKSB7CiAJCQl2Z3B1X3ZyZWdfdCh2Z3B1LCBQT1JUX0NMS19TRUwoUE9SVF9DKSkg
Jj0KIAkJCQl+UE9SVF9DTEtfU0VMX01BU0s7CiAJCQl2Z3B1X3ZyZWdfdCh2Z3B1LCBQT1JUX0NM
S19TRUwoUE9SVF9DKSkgfD0KQEAgLTI2Myw3ICsyNjMsNyBAQCBzdGF0aWMgdm9pZCBlbXVsYXRl
X21vbml0b3Jfc3RhdHVzX2NoYW5nZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAkJCShUUkFO
U19ERElfQlBDXzggfCBUUkFOU19ERElfTU9ERV9TRUxFQ1RfRFZJIHwKIAkJCShQT1JUX0QgPDwg
VFJBTlNfRERJX1BPUlRfU0hJRlQpIHwKIAkJCVRSQU5TX0RESV9GVU5DX0VOQUJMRSk7Ci0JCWlm
IChJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7CisJCWlmIChJU19CUk9BRFdFTEwoaTkxNSkpIHsK
IAkJCXZncHVfdnJlZ190KHZncHUsIFBPUlRfQ0xLX1NFTChQT1JUX0QpKSAmPQogCQkJCX5QT1JU
X0NMS19TRUxfTUFTSzsKIAkJCXZncHVfdnJlZ190KHZncHUsIFBPUlRfQ0xLX1NFTChQT1JUX0Qp
KSB8PQpAQCAtMjc0LDE0ICsyNzQsMTQgQEAgc3RhdGljIHZvaWQgZW11bGF0ZV9tb25pdG9yX3N0
YXR1c19jaGFuZ2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCXZncHVfdnJlZ190KHZncHUs
IFNGVVNFX1NUUkFQKSB8PSBTRlVTRV9TVFJBUF9ERElEX0RFVEVDVEVEOwogCX0KIAotCWlmICgo
SVNfU0tZTEFLRShkZXZfcHJpdikgfHwgSVNfS0FCWUxBS0UoZGV2X3ByaXYpIHx8Ci0JICAgICBJ
U19DT0ZGRUVMQUtFKGRldl9wcml2KSkgJiYKKwlpZiAoKElTX1NLWUxBS0UoaTkxNSkgfHwgSVNf
S0FCWUxBS0UoaTkxNSkgfHwKKwkgICAgIElTX0NPRkZFRUxBS0UoaTkxNSkpICYmCiAJCQlpbnRl
bF92Z3B1X2hhc19tb25pdG9yX29uX3BvcnQodmdwdSwgUE9SVF9FKSkgewogCQl2Z3B1X3ZyZWdf
dCh2Z3B1LCBTREVJU1IpIHw9IFNERV9QT1JURV9IT1RQTFVHX1NQVDsKIAl9CiAKIAlpZiAoaW50
ZWxfdmdwdV9oYXNfbW9uaXRvcl9vbl9wb3J0KHZncHUsIFBPUlRfQSkpIHsKLQkJaWYgKElTX0JS
T0FEV0VMTChkZXZfcHJpdikpCisJCWlmIChJU19CUk9BRFdFTEwoaTkxNSkpCiAJCQl2Z3B1X3Zy
ZWdfdCh2Z3B1LCBHRU44X0RFX1BPUlRfSVNSKSB8PQogCQkJCUdFTjhfUE9SVF9EUF9BX0hPVFBM
VUc7CiAJCWVsc2UKQEAgLTI5MSwxMSArMjkxLDExIEBAIHN0YXRpYyB2b2lkIGVtdWxhdGVfbW9u
aXRvcl9zdGF0dXNfY2hhbmdlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCX0KIAogCS8qIENs
ZWFyIGhvc3QgQ1JUIHN0YXR1cywgc28gZ3Vlc3QgY291bGRuJ3QgZGV0ZWN0IHRoaXMgaG9zdCBD
UlQuICovCi0JaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJaWYgKElTX0JST0FEV0VMTChp
OTE1KSkKIAkJdmdwdV92cmVnX3QodmdwdSwgUENIX0FEUEEpICY9IH5BRFBBX0NSVF9IT1RQTFVH
X01PTklUT1JfTUFTSzsKIAogCS8qIERpc2FibGUgUHJpbWFyeS9TcHJpdGUvQ3Vyc29yIHBsYW5l
ICovCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCWZvcl9lYWNoX3BpcGUoaTkx
NSwgcGlwZSkgewogCQl2Z3B1X3ZyZWdfdCh2Z3B1LCBEU1BDTlRSKHBpcGUpKSAmPSB+RElTUExB
WV9QTEFORV9FTkFCTEU7CiAJCXZncHVfdnJlZ190KHZncHUsIFNQUkNUTChwaXBlKSkgJj0gflNQ
UklURV9FTkFCTEU7CiAJCXZncHVfdnJlZ190KHZncHUsIENVUkNOVFIocGlwZSkpICY9IH5NQ1VS
U09SX01PREU7CkBAIC0zODksNyArMzg5LDcgQEAgdm9pZCBpbnRlbF9ndnRfY2hlY2tfdmJsYW5r
X2VtdWxhdGlvbihzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiAKIHN0YXRpYyB2b2lkIGVtdWxhdGVf
dmJsYW5rX29uX3BpcGUoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGludCBwaXBlKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2Z3B1LT5ndnQtPmk5MTU7CiAJc3RydWN0
IGludGVsX3ZncHVfaXJxICppcnEgPSAmdmdwdS0+aXJxOwogCWludCB2YmxhbmtfZXZlbnRbXSA9
IHsKIAkJW1BJUEVfQV0gPSBQSVBFX0FfVkJMQU5LLApAQCAtNDIxLDcgKzQyMSw3IEBAIHN0YXRp
YyB2b2lkIGVtdWxhdGVfdmJsYW5rKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCWludCBwaXBl
OwogCiAJbXV0ZXhfbG9jaygmdmdwdS0+dmdwdV9sb2NrKTsKLQlmb3JfZWFjaF9waXBlKHZncHUt
Pmd2dC0+ZGV2X3ByaXYsIHBpcGUpCisJZm9yX2VhY2hfcGlwZSh2Z3B1LT5ndnQtPmk5MTUsIHBp
cGUpCiAJCWVtdWxhdGVfdmJsYW5rX29uX3BpcGUodmdwdSwgcGlwZSk7CiAJbXV0ZXhfdW5sb2Nr
KCZ2Z3B1LT52Z3B1X2xvY2spOwogfQpAQCAtNDU0LDEwICs0NTQsMTAgQEAgdm9pZCBpbnRlbF9n
dnRfZW11bGF0ZV92Ymxhbmsoc3RydWN0IGludGVsX2d2dCAqZ3Z0KQogICovCiB2b2lkIGludGVs
X3ZncHVfZW11bGF0ZV9ob3RwbHVnKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCBib29sIGNvbm5l
Y3RlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQt
PmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5p
OTE1OwogCiAJLyogVE9ETzogYWRkIG1vcmUgcGxhdGZvcm1zIHN1cHBvcnQgKi8KLQlpZiAoSVNf
U0tZTEFLRShkZXZfcHJpdikgfHwgSVNfS0FCWUxBS0UoZGV2X3ByaXYpKSB7CisJaWYgKElTX1NL
WUxBS0UoaTkxNSkgfHwgSVNfS0FCWUxBS0UoaTkxNSkpIHsKIAkJaWYgKGNvbm5lY3RlZCkgewog
CQkJdmdwdV92cmVnX3QodmdwdSwgU0ZVU0VfU1RSQVApIHw9CiAJCQkJU0ZVU0VfU1RSQVBfRERJ
RF9ERVRFQ1RFRDsKQEAgLTQ4MywxMCArNDgzLDEwIEBAIHZvaWQgaW50ZWxfdmdwdV9lbXVsYXRl
X2hvdHBsdWcoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGJvb2wgY29ubmVjdGVkKQogICovCiB2
b2lkIGludGVsX3ZncHVfY2xlYW5fZGlzcGxheShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5pOTE1OwogCi0J
aWYgKElTX1NLWUxBS0UoZGV2X3ByaXYpIHx8IElTX0tBQllMQUtFKGRldl9wcml2KSB8fAotCSAg
ICBJU19DT0ZGRUVMQUtFKGRldl9wcml2KSkKKwlpZiAoSVNfU0tZTEFLRShpOTE1KSB8fCBJU19L
QUJZTEFLRShpOTE1KSB8fAorCSAgICBJU19DT0ZGRUVMQUtFKGk5MTUpKQogCQljbGVhbl92aXJ0
dWFsX2RwX21vbml0b3IodmdwdSwgUE9SVF9EKTsKIAllbHNlCiAJCWNsZWFuX3ZpcnR1YWxfZHBf
bW9uaXRvcih2Z3B1LCBQT1JUX0IpOwpAQCAtNTA1LDEyICs1MDUsMTIgQEAgdm9pZCBpbnRlbF92
Z3B1X2NsZWFuX2Rpc3BsYXkoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAgKi8KIGludCBpbnRl
bF92Z3B1X2luaXRfZGlzcGxheShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdTY0IHJlc29sdXRp
b24pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5k
ZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkx
NTsKIAogCWludGVsX3ZncHVfaW5pdF9pMmNfZWRpZCh2Z3B1KTsKIAotCWlmIChJU19TS1lMQUtF
KGRldl9wcml2KSB8fCBJU19LQUJZTEFLRShkZXZfcHJpdikgfHwKLQkgICAgSVNfQ09GRkVFTEFL
RShkZXZfcHJpdikpCisJaWYgKElTX1NLWUxBS0UoaTkxNSkgfHwgSVNfS0FCWUxBS0UoaTkxNSkg
fHwKKwkgICAgSVNfQ09GRkVFTEFLRShpOTE1KSkKIAkJcmV0dXJuIHNldHVwX3ZpcnR1YWxfZHBf
bW9uaXRvcih2Z3B1LCBQT1JUX0QsIEdWVF9EUF9ELAogCQkJCQkJcmVzb2x1dGlvbik7CiAJZWxz
ZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jCmluZGV4IDQxYzhlYmM2MGM2My4uNTIzMDM4ZDIy
NGExIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZG1hYnVmLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2RtYWJ1Zi5jCkBAIC0zOSw3ICszOSw3IEBACiBzdGF0
aWMgaW50IHZncHVfZ2VtX2dldF9wYWdlcygKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG9i
ai0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShv
YmotPmJhc2UuZGV2KTsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnN0OwogCXN0cnVjdCBzY2F0dGVybGlz
dCAqc2c7CiAJaW50IGksIHJldDsKQEAgLTYxLDcgKzYxLDcgQEAgc3RhdGljIGludCB2Z3B1X2dl
bV9nZXRfcGFnZXMoCiAJCWtmcmVlKHN0KTsKIAkJcmV0dXJuIHJldDsKIAl9Ci0JZ3R0X2VudHJp
ZXMgPSAoZ2VuOF9wdGVfdCBfX2lvbWVtICopZGV2X3ByaXYtPmdndHQuZ3NtICsKKwlndHRfZW50
cmllcyA9IChnZW44X3B0ZV90IF9faW9tZW0gKilpOTE1LT5nZ3R0LmdzbSArCiAJCShmYl9pbmZv
LT5zdGFydCA+PiBQQUdFX1NISUZUKTsKIAlmb3JfZWFjaF9zZyhzdC0+c2dsLCBzZywgcGFnZV9u
dW0sIGkpIHsKIAkJc2ctPm9mZnNldCA9IDA7CkBAIC0xNTIsNyArMTUyLDcgQEAgc3RhdGljIGNv
bnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0X29wcyBpbnRlbF92Z3B1X2dlbV9vcHMgPSB7
CiBzdGF0aWMgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKnZncHVfY3JlYXRlX2dlbShzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LAogCQlzdHJ1Y3QgaW50ZWxfdmdwdV9mYl9pbmZvICppbmZvKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2FsbG9jKCk7
CkBAIC0xNjUsNyArMTY1LDcgQEAgc3RhdGljIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICp2
Z3B1X2NyZWF0ZV9nZW0oc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCW9iai0+cmVhZF9kb21h
aW5zID0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKIAlvYmotPndyaXRlX2RvbWFpbiA9IDA7Ci0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkg
ewogCQl1bnNpZ25lZCBpbnQgdGlsaW5nX21vZGUgPSAwOwogCQl1bnNpZ25lZCBpbnQgc3RyaWRl
ID0gMDsKIApAQCAtMzYwLDcgKzM2MCw3IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9mYl9pbmZvKHN0
cnVjdCB2ZmlvX2RldmljZV9nZnhfcGxhbmVfaW5mbyAqZ3Z0X2RtYWJ1ZiwKIAogaW50IGludGVs
X3ZncHVfcXVlcnlfcGxhbmUoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIHZvaWQgKmFyZ3MpCiB7
Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZ2Z3B1LT5ndnQtPmRldl9wcml2LT5kcm07CisJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZ2Z3B1LT5ndnQtPmk5MTUtPmRybTsKIAlzdHJ1Y3Qg
dmZpb19kZXZpY2VfZ2Z4X3BsYW5lX2luZm8gKmdmeF9wbGFuZV9pbmZvID0gYXJnczsKIAlzdHJ1
Y3QgaW50ZWxfdmdwdV9kbWFidWZfb2JqICpkbWFidWZfb2JqOwogCXN0cnVjdCBpbnRlbF92Z3B1
X2ZiX2luZm8gZmJfaW5mbzsKQEAgLTQ2Niw3ICs0NjYsNyBAQCBpbnQgaW50ZWxfdmdwdV9xdWVy
eV9wbGFuZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdm9pZCAqYXJncykKIC8qIFRvIGFzc29j
aWF0ZSBhbiBleHBvc2VkIGRtYWJ1ZiB3aXRoIHRoZSBkbWFidWZfb2JqICovCiBpbnQgaW50ZWxf
dmdwdV9nZXRfZG1hYnVmKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCB1bnNpZ25lZCBpbnQgZG1h
YnVmX2lkKQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmdmdwdS0+Z3Z0LT5kZXZfcHJp
di0+ZHJtOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmdmdwdS0+Z3Z0LT5pOTE1LT5kcm07
CiAJc3RydWN0IGludGVsX3ZncHVfZG1hYnVmX29iaiAqZG1hYnVmX29iajsKIAlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBkbWFfYnVmICpkbWFidWY7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZWRpZC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2VkaWQuYwppbmRleCAxZmU2MTI0OTE4ZjEuLjllNDVjYmFjNWVlZCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2VkaWQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvZWRpZC5jCkBAIC0xMzUsNyArMTM1LDcgQEAgc3RhdGljIHZvaWQgcmVzZXRfZ21i
dXNfY29udHJvbGxlcihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIHN0YXRpYyBpbnQgZ21idXMw
X21taW9fd3JpdGUoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiAJCQl1bnNpZ25lZCBpbnQgb2Zm
c2V0LCB2b2lkICpwX2RhdGEsIHVuc2lnbmVkIGludCBieXRlcykKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5pOTE1OwogCWludCBwb3J0LCBwaW5fc2Vs
ZWN0OwogCiAJbWVtY3B5KCZ2Z3B1X3ZyZWcodmdwdSwgb2Zmc2V0KSwgcF9kYXRhLCBieXRlcyk7
CkBAIC0xNDcsOSArMTQ3LDkgQEAgc3RhdGljIGludCBnbWJ1czBfbW1pb193cml0ZShzdHJ1Y3Qg
aW50ZWxfdmdwdSAqdmdwdSwKIAlpZiAocGluX3NlbGVjdCA9PSAwKQogCQlyZXR1cm4gMDsKIAot
CWlmIChJU19CUk9YVE9OKGRldl9wcml2KSkKKwlpZiAoSVNfQlJPWFRPTihpOTE1KSkKIAkJcG9y
dCA9IGJ4dF9nZXRfcG9ydF9mcm9tX2dtYnVzMChwaW5fc2VsZWN0KTsKLQllbHNlIGlmIChJU19D
T0ZGRUVMQUtFKGRldl9wcml2KSkKKwllbHNlIGlmIChJU19DT0ZGRUVMQUtFKGk5MTUpKQogCQlw
b3J0ID0gY25wX2dldF9wb3J0X2Zyb21fZ21idXMwKHBpbl9zZWxlY3QpOwogCWVsc2UKIAkJcG9y
dCA9IGdldF9wb3J0X2Zyb21fZ21idXMwKHBpbl9zZWxlY3QpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L2V4ZWNsaXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
ZXhlY2xpc3QuYwppbmRleCBmMjFiOGZiNWIzN2UuLjdhN2E5MjU1NjVhMCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2V4ZWNsaXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L2V4ZWNsaXN0LmMKQEAgLTQwLDcgKzQwLDcgQEAKICNkZWZpbmUgX0VMX09GRlNF
VF9TVEFUVVNfUFRSICAgMHgzQTAKIAogI2RlZmluZSBleGVjbGlzdF9yaW5nX21taW8oZ3Z0LCBy
aW5nX2lkLCBvZmZzZXQpIFwKLQkoZ3Z0LT5kZXZfcHJpdi0+ZW5naW5lW3JpbmdfaWRdLT5tbWlv
X2Jhc2UgKyAob2Zmc2V0KSkKKwkoZ3Z0LT5pOTE1LT5lbmdpbmVbcmluZ19pZF0tPm1taW9fYmFz
ZSArIChvZmZzZXQpKQogCiAjZGVmaW5lIHZhbGlkX2NvbnRleHQoY3R4KSAoKGN0eCktPnZhbGlk
KQogI2RlZmluZSBzYW1lX2NvbnRleHQoYSwgYikgKCgoYSktPmNvbnRleHRfaWQgPT0gKGIpLT5j
b250ZXh0X2lkKSAmJiBcCkBAIC0xMzMsNyArMTMzLDcgQEAgc3RhdGljIHZvaWQgZW11bGF0ZV9j
c2JfdXBkYXRlKHN0cnVjdCBpbnRlbF92Z3B1X2V4ZWNsaXN0ICpleGVjbGlzdCwKIAl1MzIgd3Jp
dGVfcG9pbnRlcjsKIAl1MzIgY3R4X3N0YXR1c19wdHJfcmVnLCBjdHhfc3RhdHVzX2J1Zl9yZWcs
IG9mZnNldDsKIAl1bnNpZ25lZCBsb25nIGh3c3BfZ3BhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB2Z3B1LT5ndnQtPmk5MTU7CiAKIAljdHhfc3RhdHVzX3B0cl9yZWcgPSBl
eGVjbGlzdF9yaW5nX21taW8odmdwdS0+Z3Z0LCByaW5nX2lkLAogCQkJX0VMX09GRlNFVF9TVEFU
VVNfUFRSKTsKQEAgLTE2OSw3ICsxNjksNyBAQCBzdGF0aWMgdm9pZCBlbXVsYXRlX2NzYl91cGRh
dGUoc3RydWN0IGludGVsX3ZncHVfZXhlY2xpc3QgKmV4ZWNsaXN0LAogCQkJc3RhdHVzLCA4KTsK
IAkJaW50ZWxfZ3Z0X2h5cGVydmlzb3Jfd3JpdGVfZ3BhKHZncHUsCiAJCQlod3NwX2dwYSArCi0J
CQlpbnRlbF9od3NfY3NiX3dyaXRlX2luZGV4KGRldl9wcml2KSAqIDQsCisJCQlpbnRlbF9od3Nf
Y3NiX3dyaXRlX2luZGV4KGk5MTUpICogNCwKIAkJCSZ3cml0ZV9wb2ludGVyLCA0KTsKIAl9CiAK
QEAgLTUyOSwxMiArNTI5LDEyIEBAIHN0YXRpYyB2b2lkIGluaXRfdmdwdV9leGVjbGlzdChzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHJpbmdfaWQpCiBzdGF0aWMgdm9pZCBjbGVhbl9leGVj
bGlzdChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKIAkJCSAgIGludGVsX2VuZ2luZV9tYXNrX3Qg
ZW5naW5lX21hc2spCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdw
dS0+Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUt
Pmd2dC0+aTkxNTsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IGlu
dGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJtaXNzaW9uOwogCWludGVsX2VuZ2lu
ZV9tYXNrX3QgdG1wOwogCi0JZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGRldl9wcml2
LCBlbmdpbmVfbWFzaywgdG1wKSB7CisJZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGk5
MTUsIGVuZ2luZV9tYXNrLCB0bXApIHsKIAkJa2ZyZWUocy0+cmluZ19zY2FuX2J1ZmZlcltlbmdp
bmUtPmlkXSk7CiAJCXMtPnJpbmdfc2Nhbl9idWZmZXJbZW5naW5lLT5pZF0gPSBOVUxMOwogCQlz
LT5yaW5nX3NjYW5fYnVmZmVyX3NpemVbZW5naW5lLT5pZF0gPSAwOwpAQCAtNTQ0LDExICs1NDQs
MTEgQEAgc3RhdGljIHZvaWQgY2xlYW5fZXhlY2xpc3Qoc3RydWN0IGludGVsX3ZncHUgKnZncHUs
CiBzdGF0aWMgdm9pZCByZXNldF9leGVjbGlzdChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKIAkJ
CSAgIGludGVsX2VuZ2luZV9tYXNrX3QgZW5naW5lX21hc2spCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmU7CiAJaW50ZWxfZW5naW5lX21hc2tfdCB0bXA7CiAKLQlmb3JfZWFjaF9lbmdp
bmVfbWFza2VkKGVuZ2luZSwgZGV2X3ByaXYsIGVuZ2luZV9tYXNrLCB0bXApCisJZm9yX2VhY2hf
ZW5naW5lX21hc2tlZChlbmdpbmUsIGk5MTUsIGVuZ2luZV9tYXNrLCB0bXApCiAJCWluaXRfdmdw
dV9leGVjbGlzdCh2Z3B1LCBlbmdpbmUtPmlkKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Z0L2ZiX2RlY29kZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9m
Yl9kZWNvZGVyLmMKaW5kZXggNjVlODQ3MzkyYWVhLi43NmMzNDZlZWNkYTMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9mYl9kZWNvZGVyLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L2ZiX2RlY29kZXIuYwpAQCAtMTQ2LDEyICsxNDYsMTIgQEAgc3RhdGljIGlu
dCBza2xfZm9ybWF0X3RvX2RybShpbnQgZm9ybWF0LCBib29sIHJnYl9vcmRlciwgYm9vbCBhbHBo
YSwKIHN0YXRpYyB1MzIgaW50ZWxfdmdwdV9nZXRfc3RyaWRlKHN0cnVjdCBpbnRlbF92Z3B1ICp2
Z3B1LCBpbnQgcGlwZSwKIAl1MzIgdGlsZWQsIGludCBzdHJpZGVfbWFzaywgaW50IGJwcCkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5pOTE1OwogCiAJ
dTMyIHN0cmlkZV9yZWcgPSB2Z3B1X3ZyZWdfdCh2Z3B1LCBEU1BTVFJJREUocGlwZSkpICYgc3Ry
aWRlX21hc2s7CiAJdTMyIHN0cmlkZSA9IHN0cmlkZV9yZWc7CiAKLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSA5KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KSB7CiAJCXN3aXRjaCAo
dGlsZWQpIHsKIAkJY2FzZSBQTEFORV9DVExfVElMRURfTElORUFSOgogCQkJc3RyaWRlID0gc3Ry
aWRlX3JlZyAqIDY0OwpAQCAtMjAzLDcgKzIwMyw3IEBAIGludCBpbnRlbF92Z3B1X2RlY29kZV9w
cmltYXJ5X3BsYW5lKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LAogCXN0cnVjdCBpbnRlbF92Z3B1
X3ByaW1hcnlfcGxhbmVfZm9ybWF0ICpwbGFuZSkKIHsKIAl1MzIgdmFsLCBmbXQ7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKIAlpbnQgcGlwZTsK
IAogCXBpcGUgPSBnZXRfYWN0aXZlX3BpcGUodmdwdSk7CkBAIC0yMTUsNyArMjE1LDcgQEAgaW50
IGludGVsX3ZncHVfZGVjb2RlX3ByaW1hcnlfcGxhbmUoc3RydWN0IGludGVsX3ZncHUgKnZncHUs
CiAJaWYgKCFwbGFuZS0+ZW5hYmxlZCkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA5KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KSB7CiAJCXBs
YW5lLT50aWxlZCA9IHZhbCAmIFBMQU5FX0NUTF9USUxFRF9NQVNLOwogCQlmbXQgPSBza2xfZm9y
bWF0X3RvX2RybSgKIAkJCXZhbCAmIFBMQU5FX0NUTF9GT1JNQVRfTUFTSywKQEAgLTI1Niw3ICsy
NTYsNyBAQCBpbnQgaW50ZWxfdmdwdV9kZWNvZGVfcHJpbWFyeV9wbGFuZShzdHJ1Y3QgaW50ZWxf
dmdwdSAqdmdwdSwKIAl9CiAKIAlwbGFuZS0+c3RyaWRlID0gaW50ZWxfdmdwdV9nZXRfc3RyaWRl
KHZncHUsIHBpcGUsIHBsYW5lLT50aWxlZCwKLQkJKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkg
PworCQkoSU5URUxfR0VOKGk5MTUpID49IDkpID8KIAkJCShfUFJJX1BMQU5FX1NUUklERV9NQVNL
ID4+IDYpIDoKIAkJCQlfUFJJX1BMQU5FX1NUUklERV9NQVNLLCBwbGFuZS0+YnBwKTsKIApAQCAt
MzM0LDcgKzMzNCw3IEBAIGludCBpbnRlbF92Z3B1X2RlY29kZV9jdXJzb3JfcGxhbmUoc3RydWN0
IGludGVsX3ZncHUgKnZncHUsCiB7CiAJdTMyIHZhbCwgbW9kZSwgaW5kZXg7CiAJdTMyIGFscGhh
X3BsYW5lLCBhbHBoYV9mb3JjZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB2Z3B1LT5ndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dmdwdS0+Z3Z0LT5pOTE1OwogCWludCBwaXBlOwogCiAJcGlwZSA9IGdldF9hY3RpdmVfcGlwZSh2
Z3B1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9maXJtd2FyZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2Zpcm13YXJlLmMKaW5kZXggMDQ5Nzc1ZThlMzUwLi5l
ZmRjOWRmNGY3MzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9maXJtd2Fy
ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9maXJtd2FyZS5jCkBAIC02OCw3ICs2
OCw3IEBAIHN0YXRpYyBzdHJ1Y3QgYmluX2F0dHJpYnV0ZSBmaXJtd2FyZV9hdHRyID0gewogCiBz
dGF0aWMgaW50IG1taW9fc25hcHNob3RfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQsIHUz
MiBvZmZzZXQsIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3Z0LT5p
OTE1OwogCiAJKih1MzIgKikoZGF0YSArIG9mZnNldCkgPSBpbnRlbF91bmNvcmVfcmVhZF9ub3Ry
YWNlKCZpOTE1LT51bmNvcmUsCiAJCQkJCQkJICAgIF9NTUlPKG9mZnNldCkpOwpAQCAtNzgsNyAr
NzgsNyBAQCBzdGF0aWMgaW50IG1taW9fc25hcHNob3RfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3Z0
ICpndnQsIHUzMiBvZmZzZXQsIHZvaWQgKmRhdGEpCiBzdGF0aWMgaW50IGV4cG9zZV9maXJtd2Fy
ZV9zeXNmcyhzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiB7CiAJc3RydWN0IGludGVsX2d2dF9kZXZp
Y2VfaW5mbyAqaW5mbyA9ICZndnQtPmRldmljZV9pbmZvOwotCXN0cnVjdCBwY2lfZGV2ICpwZGV2
ID0gZ3Z0LT5kZXZfcHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBndnQt
Pmk5MTUtPmRybS5wZGV2OwogCXN0cnVjdCBndnRfZmlybXdhcmVfaGVhZGVyICpoOwogCXZvaWQg
KmZpcm13YXJlOwogCXZvaWQgKnA7CkBAIC0xMjksNyArMTI5LDcgQEAgc3RhdGljIGludCBleHBv
c2VfZmlybXdhcmVfc3lzZnMoc3RydWN0IGludGVsX2d2dCAqZ3Z0KQogCiBzdGF0aWMgdm9pZCBj
bGVhbl9maXJtd2FyZV9zeXNmcyhzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiB7Ci0Jc3RydWN0IHBj
aV9kZXYgKnBkZXYgPSBndnQtPmRldl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3QgcGNpX2RldiAq
cGRldiA9IGd2dC0+aTkxNS0+ZHJtLnBkZXY7CiAKIAlkZXZpY2VfcmVtb3ZlX2Jpbl9maWxlKCZw
ZGV2LT5kZXYsICZmaXJtd2FyZV9hdHRyKTsKIAl2ZnJlZShmaXJtd2FyZV9hdHRyLnByaXZhdGUp
OwpAQCAtMTUzLDggKzE1Myw4IEBAIHN0YXRpYyBpbnQgdmVyaWZ5X2Zpcm13YXJlKHN0cnVjdCBp
bnRlbF9ndnQgKmd2dCwKIAkJCSAgIGNvbnN0IHN0cnVjdCBmaXJtd2FyZSAqZncpCiB7CiAJc3Ry
dWN0IGludGVsX2d2dF9kZXZpY2VfaW5mbyAqaW5mbyA9ICZndnQtPmRldmljZV9pbmZvOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd2dC0+ZGV2X3ByaXY7Ci0Jc3RydWN0
IHBjaV9kZXYgKnBkZXYgPSBkZXZfcHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBndnQtPmk5MTU7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5k
cm0ucGRldjsKIAlzdHJ1Y3QgZ3Z0X2Zpcm13YXJlX2hlYWRlciAqaDsKIAl1bnNpZ25lZCBsb25n
IGlkLCBjcmMzMl9zdGFydDsKIAljb25zdCB2b2lkICptZW07CkBAIC0yMDgsOCArMjA4LDggQEAg
c3RhdGljIGludCB2ZXJpZnlfZmlybXdhcmUoc3RydWN0IGludGVsX2d2dCAqZ3Z0LAogaW50IGlu
dGVsX2d2dF9sb2FkX2Zpcm13YXJlKHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkKIHsKIAlzdHJ1Y3Qg
aW50ZWxfZ3Z0X2RldmljZV9pbmZvICppbmZvID0gJmd2dC0+ZGV2aWNlX2luZm87Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3Z0LT5kZXZfcHJpdjsKLQlzdHJ1Y3QgcGNp
X2RldiAqcGRldiA9IGRldl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGd2dC0+aTkxNTsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5w
ZGV2OwogCXN0cnVjdCBpbnRlbF9ndnRfZmlybXdhcmUgKmZpcm13YXJlID0gJmd2dC0+ZmlybXdh
cmU7CiAJc3RydWN0IGd2dF9maXJtd2FyZV9oZWFkZXIgKmg7CiAJY29uc3Qgc3RydWN0IGZpcm13
YXJlICpmdzsKQEAgLTI0NCw3ICsyNDQsNyBAQCBpbnQgaW50ZWxfZ3Z0X2xvYWRfZmlybXdhcmUo
c3RydWN0IGludGVsX2d2dCAqZ3Z0KQogCiAJZ3Z0X2RiZ19jb3JlKCJyZXF1ZXN0IGh3IHN0YXRl
IGZpcm13YXJlICVzLi4uXG4iLCBwYXRoKTsKIAotCXJldCA9IHJlcXVlc3RfZmlybXdhcmUoJmZ3
LCBwYXRoLCAmZGV2X3ByaXYtPmRybS5wZGV2LT5kZXYpOworCXJldCA9IHJlcXVlc3RfZmlybXdh
cmUoJmZ3LCBwYXRoLCAmaTkxNS0+ZHJtLnBkZXYtPmRldik7CiAJa2ZyZWUocGF0aCk7CiAKIAlp
ZiAocmV0KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d0dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d0dC5jCmluZGV4IDUzMTE1YmRhZTEyYi4uMzkwNTYyZmUz
MjIzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3R0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d0dC5jCkBAIC0yNzUsMjQgKzI3NSwyNCBAQCBzdGF0aWMg
aW5saW5lIGludCBnZXRfcHNlX3R5cGUoaW50IHR5cGUpCiAJcmV0dXJuIGd0dF90eXBlX3RhYmxl
W3R5cGVdLnBzZV9lbnRyeV90eXBlOwogfQogCi1zdGF0aWMgdTY0IHJlYWRfcHRlNjQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBsb25nIGluZGV4KQorc3RhdGlj
IHU2NCByZWFkX3B0ZTY0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1bnNpZ25lZCBs
b25nIGluZGV4KQogewotCXZvaWQgX19pb21lbSAqYWRkciA9IChnZW44X3B0ZV90IF9faW9tZW0g
KilkZXZfcHJpdi0+Z2d0dC5nc20gKyBpbmRleDsKKwl2b2lkIF9faW9tZW0gKmFkZHIgPSAoZ2Vu
OF9wdGVfdCBfX2lvbWVtICopaTkxNS0+Z2d0dC5nc20gKyBpbmRleDsKIAogCXJldHVybiByZWFk
cShhZGRyKTsKIH0KIAotc3RhdGljIHZvaWQgZ2d0dF9pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdndHRfaW52YWxpZGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQltbWlvX2h3X2FjY2Vzc19wcmUoZGV2X3ByaXYp
OworCW1taW9faHdfYWNjZXNzX3ByZShpOTE1KTsKIAlJOTE1X1dSSVRFKEdGWF9GTFNIX0NOVExf
R0VONiwgR0ZYX0ZMU0hfQ05UTF9FTik7Ci0JbW1pb19od19hY2Nlc3NfcG9zdChkZXZfcHJpdik7
CisJbW1pb19od19hY2Nlc3NfcG9zdChpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgd3JpdGVfcHRl
NjQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgd3JpdGVf
cHRlNjQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCXVuc2lnbmVkIGxvbmcgaW5k
ZXgsIHU2NCBwdGUpCiB7Ci0Jdm9pZCBfX2lvbWVtICphZGRyID0gKGdlbjhfcHRlX3QgX19pb21l
bSAqKWRldl9wcml2LT5nZ3R0LmdzbSArIGluZGV4OworCXZvaWQgX19pb21lbSAqYWRkciA9IChn
ZW44X3B0ZV90IF9faW9tZW0gKilpOTE1LT5nZ3R0LmdzbSArIGluZGV4OwogCiAJd3JpdGVxKHB0
ZSwgYWRkcik7CiB9CkBAIC0zMTUsNyArMzE1LDcgQEAgc3RhdGljIGlubGluZSBpbnQgZ3R0X2dl
dF9lbnRyeTY0KHZvaWQgKnB0LAogCQlpZiAoV0FSTl9PTihyZXQpKQogCQkJcmV0dXJuIHJldDsK
IAl9IGVsc2UgaWYgKCFwdCkgewotCQllLT52YWw2NCA9IHJlYWRfcHRlNjQodmdwdS0+Z3Z0LT5k
ZXZfcHJpdiwgaW5kZXgpOworCQllLT52YWw2NCA9IHJlYWRfcHRlNjQodmdwdS0+Z3Z0LT5pOTE1
LCBpbmRleCk7CiAJfSBlbHNlIHsKIAkJZS0+dmFsNjQgPSAqKCh1NjQgKilwdCArIGluZGV4KTsK
IAl9CkBAIC0zNDAsNyArMzQwLDcgQEAgc3RhdGljIGlubGluZSBpbnQgZ3R0X3NldF9lbnRyeTY0
KHZvaWQgKnB0LAogCQlpZiAoV0FSTl9PTihyZXQpKQogCQkJcmV0dXJuIHJldDsKIAl9IGVsc2Ug
aWYgKCFwdCkgewotCQl3cml0ZV9wdGU2NCh2Z3B1LT5ndnQtPmRldl9wcml2LCBpbmRleCwgZS0+
dmFsNjQpOworCQl3cml0ZV9wdGU2NCh2Z3B1LT5ndnQtPmk5MTUsIGluZGV4LCBlLT52YWw2NCk7
CiAJfSBlbHNlIHsKIAkJKigodTY0ICopcHQgKyBpbmRleCkgPSBlLT52YWw2NDsKIAl9CkBAIC03
MzQsNyArNzM0LDcgQEAgc3RhdGljIGludCBkZXRhY2hfb29zX3BhZ2Uoc3RydWN0IGludGVsX3Zn
cHUgKnZncHUsCiAKIHN0YXRpYyB2b2lkIHBwZ3R0X2ZyZWVfc3B0KHN0cnVjdCBpbnRlbF92Z3B1
X3BwZ3R0X3NwdCAqc3B0KQogewotCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSAmc3B0LT52Z3B1LT5n
dnQtPmRldl9wcml2LT5kcm0ucGRldi0+ZGV2OworCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSAmc3B0
LT52Z3B1LT5ndnQtPmk5MTUtPmRybS5wZGV2LT5kZXY7CiAKIAl0cmFjZV9zcHRfZnJlZShzcHQt
PnZncHUtPmlkLCBzcHQsIHNwdC0+Z3Vlc3RfcGFnZS50eXBlKTsKIApAQCAtODE5LDcgKzgxOSw3
IEBAIHN0YXRpYyBpbnQgcmVjbGFpbV9vbmVfcHBndHRfbW0oc3RydWN0IGludGVsX2d2dCAqZ3Z0
KTsKIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfdmdwdV9wcGd0dF9zcHQgKnBwZ3R0X2FsbG9jX3NwdCgK
IAkJc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGVudW0gaW50ZWxfZ3Z0X2d0dF90eXBlIHR5cGUp
CiB7Ci0Jc3RydWN0IGRldmljZSAqa2RldiA9ICZ2Z3B1LT5ndnQtPmRldl9wcml2LT5kcm0ucGRl
di0+ZGV2OworCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSAmdmdwdS0+Z3Z0LT5pOTE1LT5kcm0ucGRl
di0+ZGV2OwogCXN0cnVjdCBpbnRlbF92Z3B1X3BwZ3R0X3NwdCAqc3B0ID0gTlVMTDsKIAlkbWFf
YWRkcl90IGRhZGRyOwogCWludCByZXQ7CkBAIC0xMDQ0LDE0ICsxMDQ0LDE0IEBAIHN0YXRpYyBp
bnQgcHBndHRfaW52YWxpZGF0ZV9zcHQoc3RydWN0IGludGVsX3ZncHVfcHBndHRfc3B0ICpzcHQp
CiAKIHN0YXRpYyBib29sIHZncHVfaXBzX2VuYWJsZWQoc3RydWN0IGludGVsX3ZncHUgKnZncHUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZf
cHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsK
IAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDkgfHwgSU5URUxfR0VOKGRldl9wcml2KSA9
PSAxMCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPT0gOSB8fCBJTlRFTF9HRU4oaTkxNSkgPT0g
MTApIHsKIAkJdTMyIGlwcyA9IHZncHVfdnJlZ190KHZncHUsIEdFTjhfR0FNV19FQ09fREVWX1JX
X0lBKSAmCiAJCQlHQU1XX0VDT19FTkFCTEVfNjRLX0lQU19GSUVMRDsKIAogCQlyZXR1cm4gaXBz
ID09IEdBTVdfRUNPX0VOQUJMRV82NEtfSVBTX0ZJRUxEOwotCX0gZWxzZSBpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMSkgeworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKSB7
CiAJCS8qIDY0SyBwYWdpbmcgb25seSBjb250cm9sbGVkIGJ5IElQUyBiaXQgaW4gUFRFIG5vdy4g
Ki8KIAkJcmV0dXJuIHRydWU7CiAJfSBlbHNlCkBAIC0xMTUzLDcgKzExNTMsNyBAQCBzdGF0aWMg
aW50IGlzXzJNQl9ndHRfcG9zc2libGUoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiAJc3RydWN0
IGludGVsX2d2dF9ndHRfcHRlX29wcyAqb3BzID0gdmdwdS0+Z3Z0LT5ndHQucHRlX29wczsKIAl1
bnNpZ25lZCBsb25nIHBmbjsKIAotCWlmICghSEFTX1BBR0VfU0laRVModmdwdS0+Z3Z0LT5kZXZf
cHJpdiwgSTkxNV9HVFRfUEFHRV9TSVpFXzJNKSkKKwlpZiAoIUhBU19QQUdFX1NJWkVTKHZncHUt
Pmd2dC0+aTkxNSwgSTkxNV9HVFRfUEFHRV9TSVpFXzJNKSkKIAkJcmV0dXJuIDA7CiAKIAlwZm4g
PSBpbnRlbF9ndnRfaHlwZXJ2aXNvcl9nZm5fdG9fbWZuKHZncHUsIG9wcy0+Z2V0X3BmbihlbnRy
eSkpOwpAQCAtMjMwMSw3ICsyMzAxLDcgQEAgc3RhdGljIGludCBlbXVsYXRlX2dndHRfbW1pb193
cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZiwKIAlnZ3R0X2lu
dmFsaWRhdGVfcHRlKHZncHUsICZlKTsKIAogCWdndHRfc2V0X2hvc3RfZW50cnkoZ2d0dF9tbSwg
Jm0sIGdfZ3R0X2luZGV4KTsKLQlnZ3R0X2ludmFsaWRhdGUoZ3Z0LT5kZXZfcHJpdik7CisJZ2d0
dF9pbnZhbGlkYXRlKGd2dC0+aTkxNSk7CiAJcmV0dXJuIDA7CiB9CiAKQEAgLTIzNDAsNyArMjM0
MCw3IEBAIHN0YXRpYyBpbnQgYWxsb2Nfc2NyYXRjaF9wYWdlcyhzdHJ1Y3QgaW50ZWxfdmdwdSAq
dmdwdSwKIAkJCQl2Z3B1LT5ndnQtPmRldmljZV9pbmZvLmd0dF9lbnRyeV9zaXplX3NoaWZ0Owog
CXZvaWQgKnNjcmF0Y2hfcHQ7CiAJaW50IGk7Ci0Jc3RydWN0IGRldmljZSAqZGV2ID0gJnZncHUt
Pmd2dC0+ZGV2X3ByaXYtPmRybS5wZGV2LT5kZXY7CisJc3RydWN0IGRldmljZSAqZGV2ID0gJnZn
cHUtPmd2dC0+aTkxNS0+ZHJtLnBkZXYtPmRldjsKIAlkbWFfYWRkcl90IGRhZGRyOwogCiAJaWYg
KFdBUk5fT04odHlwZSA8IEdUVF9UWVBFX1BQR1RUX1BURV9QVCB8fCB0eXBlID49IEdUVF9UWVBF
X01BWCkpCkBAIC0yMzk3LDcgKzIzOTcsNyBAQCBzdGF0aWMgaW50IGFsbG9jX3NjcmF0Y2hfcGFn
ZXMoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiBzdGF0aWMgaW50IHJlbGVhc2Vfc2NyYXRjaF9w
YWdlX3RyZWUoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7CiAJaW50IGk7Ci0Jc3RydWN0IGRl
dmljZSAqZGV2ID0gJnZncHUtPmd2dC0+ZGV2X3ByaXYtPmRybS5wZGV2LT5kZXY7CisJc3RydWN0
IGRldmljZSAqZGV2ID0gJnZncHUtPmd2dC0+aTkxNS0+ZHJtLnBkZXYtPmRldjsKIAlkbWFfYWRk
cl90IGRhZGRyOwogCiAJZm9yIChpID0gR1RUX1RZUEVfUFBHVFRfUFRFX1BUOyBpIDwgR1RUX1RZ
UEVfTUFYOyBpKyspIHsKQEAgLTI2NjksNyArMjY2OSw3IEBAIGludCBpbnRlbF9ndnRfaW5pdF9n
dHQoc3RydWN0IGludGVsX2d2dCAqZ3Z0KQogewogCWludCByZXQ7CiAJdm9pZCAqcGFnZTsKLQlz
dHJ1Y3QgZGV2aWNlICpkZXYgPSAmZ3Z0LT5kZXZfcHJpdi0+ZHJtLnBkZXYtPmRldjsKKwlzdHJ1
Y3QgZGV2aWNlICpkZXYgPSAmZ3Z0LT5pOTE1LT5kcm0ucGRldi0+ZGV2OwogCWRtYV9hZGRyX3Qg
ZGFkZHI7CiAKIAlndnRfZGJnX2NvcmUoImluaXQgZ3R0XG4iKTsKQEAgLTI3MTgsNyArMjcxOCw3
IEBAIGludCBpbnRlbF9ndnRfaW5pdF9ndHQoc3RydWN0IGludGVsX2d2dCAqZ3Z0KQogICovCiB2
b2lkIGludGVsX2d2dF9jbGVhbl9ndHQoc3RydWN0IGludGVsX2d2dCAqZ3Z0KQogewotCXN0cnVj
dCBkZXZpY2UgKmRldiA9ICZndnQtPmRldl9wcml2LT5kcm0ucGRldi0+ZGV2OworCXN0cnVjdCBk
ZXZpY2UgKmRldiA9ICZndnQtPmk5MTUtPmRybS5wZGV2LT5kZXY7CiAJZG1hX2FkZHJfdCBkYWRk
ciA9IChkbWFfYWRkcl90KShndnQtPmd0dC5zY3JhdGNoX21mbiA8PAogCQkJCQlJOTE1X0dUVF9Q
QUdFX1NISUZUKTsKIApAQCAtMjc2Niw3ICsyNzY2LDcgQEAgdm9pZCBpbnRlbF92Z3B1X2ludmFs
aWRhdGVfcHBndHQoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB2b2lkIGludGVsX3ZncHVfcmVz
ZXRfZ2d0dChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgYm9vbCBpbnZhbGlkYXRlX29sZCkKIHsK
IAlzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQgPSB2Z3B1LT5ndnQ7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZ3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGd2dC0+aTkxNTsKIAlzdHJ1Y3QgaW50ZWxfZ3Z0X2d0dF9wdGVfb3BzICpwdGVf
b3BzID0gdmdwdS0+Z3Z0LT5ndHQucHRlX29wczsKIAlzdHJ1Y3QgaW50ZWxfZ3Z0X2d0dF9lbnRy
eSBlbnRyeSA9IHsudHlwZSA9IEdUVF9UWVBFX0dHVFRfUFRFfTsKIAlzdHJ1Y3QgaW50ZWxfZ3Z0
X2d0dF9lbnRyeSBvbGRfZW50cnk7CkBAIC0yNzk2LDcgKzI3OTYsNyBAQCB2b2lkIGludGVsX3Zn
cHVfcmVzZXRfZ2d0dChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgYm9vbCBpbnZhbGlkYXRlX29s
ZCkKIAkJZ2d0dF9zZXRfaG9zdF9lbnRyeSh2Z3B1LT5ndHQuZ2d0dF9tbSwgJmVudHJ5LCBpbmRl
eCsrKTsKIAl9CiAKLQlnZ3R0X2ludmFsaWRhdGUoZGV2X3ByaXYpOworCWdndHRfaW52YWxpZGF0
ZShpOTE1KTsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
Z3Z0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmMKaW5kZXggNDNmNDI0MjA2MmRk
Li5iODRjZGQ4ZDhjOTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9ndnQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmMKQEAgLTUyLDcgKzUyLDcgQEAg
c3RhdGljIHN0cnVjdCBpbnRlbF92Z3B1X3R5cGUgKmludGVsX2d2dF9maW5kX3ZncHVfdHlwZShz
dHJ1Y3QgaW50ZWxfZ3Z0ICpndnQsCiAJaW50IGk7CiAJc3RydWN0IGludGVsX3ZncHVfdHlwZSAq
dDsKIAljb25zdCBjaGFyICpkcml2ZXJfbmFtZSA9IGRldl9kcml2ZXJfc3RyaW5nKAotCQkJJmd2
dC0+ZGV2X3ByaXYtPmRybS5wZGV2LT5kZXYpOworCQkJJmd2dC0+aTkxNS0+ZHJtLnBkZXYtPmRl
dik7CiAKIAlmb3IgKGkgPSAwOyBpIDwgZ3Z0LT5udW1fdHlwZXM7IGkrKykgewogCQl0ID0gJmd2
dC0+dHlwZXNbaV07CkBAIC0xOTEsNyArMTkxLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRl
bF9ndnRfb3BzIGludGVsX2d2dF9vcHMgPSB7CiBzdGF0aWMgdm9pZCBpbml0X2RldmljZV9pbmZv
KHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3Z0X2RldmljZV9pbmZv
ICppbmZvID0gJmd2dC0+ZGV2aWNlX2luZm87Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBndnQt
PmRldl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGd2dC0+aTkxNS0+
ZHJtLnBkZXY7CiAKIAlpbmZvLT5tYXhfc3VwcG9ydF92Z3B1cyA9IDg7CiAJaW5mby0+Y2ZnX3Nw
YWNlX3NpemUgPSBQQ0lfQ0ZHX1NQQUNFX0VYUF9TSVpFOwpAQCAtMjU3LDE1ICsyNTcsMTUgQEAg
c3RhdGljIGludCBpbml0X3NlcnZpY2VfdGhyZWFkKHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkKIAog
LyoqCiAgKiBpbnRlbF9ndnRfY2xlYW5fZGV2aWNlIC0gY2xlYW4gYSBHVlQgZGV2aWNlCi0gKiBA
ZGV2X3ByaXY6IGk5MTUgcHJpdmF0ZQorICogQGk5MTU6IGk5MTUgcHJpdmF0ZQogICoKICAqIFRo
aXMgZnVuY3Rpb24gaXMgY2FsbGVkIGF0IHRoZSBkcml2ZXIgdW5sb2FkaW5nIHN0YWdlLCB0byBm
cmVlIHRoZQogICogcmVzb3VyY2VzIG93bmVkIGJ5IGEgR1ZUIGRldmljZS4KICAqCiAgKi8KLXZv
aWQgaW50ZWxfZ3Z0X2NsZWFuX2RldmljZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCit2b2lkIGludGVsX2d2dF9jbGVhbl9kZXZpY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2d2dCAqZ3Z0ID0gdG9fZ3Z0KGRldl9wcml2KTsKKwlz
dHJ1Y3QgaW50ZWxfZ3Z0ICpndnQgPSB0b19ndnQoaTkxNSk7CiAKIAlpZiAoV0FSTl9PTighZ3Z0
KSkKIAkJcmV0dXJuOwpAQCAtMjg1LDEzICsyODUsMTMgQEAgdm9pZCBpbnRlbF9ndnRfY2xlYW5f
ZGV2aWNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpbnRlbF9ndnRfY2xl
YW5fbW1pb19pbmZvKGd2dCk7CiAJaWRyX2Rlc3Ryb3koJmd2dC0+dmdwdV9pZHIpOwogCi0Ja2Zy
ZWUoZGV2X3ByaXYtPmd2dCk7Ci0JZGV2X3ByaXYtPmd2dCA9IE5VTEw7CisJa2ZyZWUoaTkxNS0+
Z3Z0KTsKKwlpOTE1LT5ndnQgPSBOVUxMOwogfQogCiAvKioKICAqIGludGVsX2d2dF9pbml0X2Rl
dmljZSAtIGluaXRpYWxpemUgYSBHVlQgZGV2aWNlCi0gKiBAZGV2X3ByaXY6IGRybSBpOTE1IHBy
aXZhdGUgZGF0YQorICogQGk5MTU6IGRybSBpOTE1IHByaXZhdGUgZGF0YQogICoKICAqIFRoaXMg
ZnVuY3Rpb24gaXMgY2FsbGVkIGF0IHRoZSBpbml0aWFsaXphdGlvbiBzdGFnZSwgdG8gaW5pdGlh
bGl6ZQogICogbmVjZXNzYXJ5IEdWVCBjb21wb25lbnRzLgpAQCAtMzAwLDEzICszMDAsMTMgQEAg
dm9pZCBpbnRlbF9ndnRfY2xlYW5fZGV2aWNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKICAqIFplcm8gb24gc3VjY2VzcywgbmVnYXRpdmUgZXJyb3IgY29kZSBpZiBmYWlsZWQu
CiAgKgogICovCi1pbnQgaW50ZWxfZ3Z0X2luaXRfZGV2aWNlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK2ludCBpbnRlbF9ndnRfaW5pdF9kZXZpY2Uoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGludGVsX2d2dCAqZ3Z0OwogCXN0cnVjdCBpbnRl
bF92Z3B1ICp2Z3B1OwogCWludCByZXQ7CiAKLQlpZiAoV0FSTl9PTihkZXZfcHJpdi0+Z3Z0KSkK
KwlpZiAoV0FSTl9PTihpOTE1LT5ndnQpKQogCQlyZXR1cm4gLUVFWElTVDsKIAogCWd2dCA9IGt6
YWxsb2Moc2l6ZW9mKHN0cnVjdCBpbnRlbF9ndnQpLCBHRlBfS0VSTkVMKTsKQEAgLTMxOSw3ICsz
MTksNyBAQCBpbnQgaW50ZWxfZ3Z0X2luaXRfZGV2aWNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAlzcGluX2xvY2tfaW5pdCgmZ3Z0LT5zY2hlZHVsZXIubW1pb19jb250ZXh0
X2xvY2spOwogCW11dGV4X2luaXQoJmd2dC0+bG9jayk7CiAJbXV0ZXhfaW5pdCgmZ3Z0LT5zY2hl
ZF9sb2NrKTsKLQlndnQtPmRldl9wcml2ID0gZGV2X3ByaXY7CisJZ3Z0LT5pOTE1ID0gaTkxNTsK
IAogCWluaXRfZGV2aWNlX2luZm8oZ3Z0KTsKIApAQCAtMzgwLDggKzM4MCw4IEBAIGludCBpbnRl
bF9ndnRfaW5pdF9kZXZpY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQln
dnRfZXJyKCJkZWJ1Z2ZzIHJlZ2lzdHJhdGlvbiBmYWlsZWQsIGdvIG9uLlxuIik7CiAKIAlndnRf
ZGJnX2NvcmUoImd2dCBkZXZpY2UgaW5pdGlhbGl6YXRpb24gaXMgZG9uZVxuIik7Ci0JZGV2X3By
aXYtPmd2dCA9IGd2dDsKLQlpbnRlbF9ndnRfaG9zdC5kZXYgPSAmZGV2X3ByaXYtPmRybS5wZGV2
LT5kZXY7CisJaTkxNS0+Z3Z0ID0gZ3Z0OworCWludGVsX2d2dF9ob3N0LmRldiA9ICZpOTE1LT5k
cm0ucGRldi0+ZGV2OwogCWludGVsX2d2dF9ob3N0LmluaXRpYWxpemVkID0gdHJ1ZTsKIAlyZXR1
cm4gMDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oCmluZGV4IGI1NGYyYmRjMTNhNC4uZmJlYmUwYWU0
MDk2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZ3Z0LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oCkBAIC0zMDYsNyArMzA2LDcgQEAgc3RydWN0IGlu
dGVsX2d2dCB7CiAJLyogc2NoZWR1bGVyIHNjb3BlIGxvY2ssIHByb3RlY3QgZ3Z0IGFuZCB2Z3B1
IHNjaGVkdWxlIHJlbGF0ZWQgZGF0YSAqLwogCXN0cnVjdCBtdXRleCBzY2hlZF9sb2NrOwogCi0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1OwogCXN0cnVjdCBpZHIgdmdwdV9pZHI7CS8qIHZHUFUgSURSIHBvb2wgKi8KIAog
CXN0cnVjdCBpbnRlbF9ndnRfZGV2aWNlX2luZm8gZGV2aWNlX2luZm87CkBAIC0zNzMsMTIgKzM3
MywxMiBAQCBpbnQgaW50ZWxfZ3Z0X2xvYWRfZmlybXdhcmUoc3RydWN0IGludGVsX2d2dCAqZ3Z0
KTsKICNkZWZpbmUgSE9TVF9GRU5DRSA0CiAKIC8qIEFwZXJ0dXJlL0dNIHNwYWNlIGRlZmluaXRp
b25zIGZvciBHVlQgZGV2aWNlICovCi0jZGVmaW5lIGd2dF9hcGVydHVyZV9zeihndnQpCSAgKGd2
dC0+ZGV2X3ByaXYtPmdndHQubWFwcGFibGVfZW5kKQotI2RlZmluZSBndnRfYXBlcnR1cmVfcGFf
YmFzZShndnQpIChndnQtPmRldl9wcml2LT5nZ3R0LmdtYWRyLnN0YXJ0KQorI2RlZmluZSBndnRf
YXBlcnR1cmVfc3ooZ3Z0KQkgIChndnQtPmk5MTUtPmdndHQubWFwcGFibGVfZW5kKQorI2RlZmlu
ZSBndnRfYXBlcnR1cmVfcGFfYmFzZShndnQpIChndnQtPmk5MTUtPmdndHQuZ21hZHIuc3RhcnQp
CiAKLSNkZWZpbmUgZ3Z0X2dndHRfZ21fc3ooZ3Z0KQkgIChndnQtPmRldl9wcml2LT5nZ3R0LnZt
LnRvdGFsKQorI2RlZmluZSBndnRfZ2d0dF9nbV9zeihndnQpCSAgKGd2dC0+aTkxNS0+Z2d0dC52
bS50b3RhbCkKICNkZWZpbmUgZ3Z0X2dndHRfc3ooZ3Z0KSBcCi0JKChndnQtPmRldl9wcml2LT5n
Z3R0LnZtLnRvdGFsID4+IFBBR0VfU0hJRlQpIDw8IDMpCisJKChndnQtPmk5MTUtPmdndHQudm0u
dG90YWwgPj4gUEFHRV9TSElGVCkgPDwgMykKICNkZWZpbmUgZ3Z0X2hpZGRlbl9zeihndnQpCSAg
KGd2dF9nZ3R0X2dtX3N6KGd2dCkgLSBndnRfYXBlcnR1cmVfc3ooZ3Z0KSkKIAogI2RlZmluZSBn
dnRfYXBlcnR1cmVfZ21hZHJfYmFzZShndnQpICgwKQpAQCAtMzkwLDcgKzM5MCw3IEBAIGludCBp
bnRlbF9ndnRfbG9hZF9maXJtd2FyZShzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpOwogI2RlZmluZSBn
dnRfaGlkZGVuX2dtYWRyX2VuZChndnQpIChndnRfaGlkZGVuX2dtYWRyX2Jhc2UoZ3Z0KSBcCiAJ
CQkJICAgKyBndnRfaGlkZGVuX3N6KGd2dCkgLSAxKQogCi0jZGVmaW5lIGd2dF9mZW5jZV9zeihn
dnQpIChndnQtPmRldl9wcml2LT5udW1fZmVuY2VfcmVncykKKyNkZWZpbmUgZ3Z0X2ZlbmNlX3N6
KGd2dCkgKGd2dC0+aTkxNS0+bnVtX2ZlbmNlX3JlZ3MpCiAKIC8qIEFwZXJ0dXJlL0dNIHNwYWNl
IGRlZmluaXRpb25zIGZvciB2R1BVICovCiAjZGVmaW5lIHZncHVfYXBlcnR1cmVfb2Zmc2V0KHZn
cHUpCSgodmdwdSktPmdtLmxvd19nbV9ub2RlLnN0YXJ0KQpAQCAtNTgyLDE0ICs1ODIsMTQgQEAg
ZW51bSB7CiAJR1ZUX0ZBSUxTQUZFX0dVRVNUX0VSUiwKIH07CiAKLXN0YXRpYyBpbmxpbmUgdm9p
ZCBtbWlvX2h3X2FjY2Vzc19wcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIGlubGluZSB2b2lkIG1taW9faHdfYWNjZXNzX3ByZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKLQlpbnRlbF9ydW50aW1lX3BtX2dldChkZXZfcHJpdik7CisJaW50ZWxf
cnVudGltZV9wbV9nZXQoaTkxNSk7CiB9CiAKLXN0YXRpYyBpbmxpbmUgdm9pZCBtbWlvX2h3X2Fj
Y2Vzc19wb3N0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbmxp
bmUgdm9pZCBtbWlvX2h3X2FjY2Vzc19wb3N0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewotCWludGVsX3J1bnRpbWVfcG1fcHV0X3VuY2hlY2tlZChkZXZfcHJpdik7CisJaW50ZWxf
cnVudGltZV9wbV9wdXRfdW5jaGVja2VkKGk5MTUpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9oYW5kbGVycy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Z0L2hhbmRsZXJzLmMKaW5kZXggYTZhZGU2NjM0OWJkLi45YWNiMDFiMGI3YzcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9oYW5kbGVycy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9oYW5kbGVycy5jCkBAIC00OSwxNSArNDksMTUgQEAKIAogdW5zaWduZWQg
bG9uZyBpbnRlbF9ndnRfZ2V0X2RldmljZV90eXBlKHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkKIHsK
LQlpZiAoSVNfQlJPQURXRUxMKGd2dC0+ZGV2X3ByaXYpKQorCWlmIChJU19CUk9BRFdFTEwoZ3Z0
LT5pOTE1KSkKIAkJcmV0dXJuIERfQkRXOwotCWVsc2UgaWYgKElTX1NLWUxBS0UoZ3Z0LT5kZXZf
cHJpdikpCisJZWxzZSBpZiAoSVNfU0tZTEFLRShndnQtPmk5MTUpKQogCQlyZXR1cm4gRF9TS0w7
Ci0JZWxzZSBpZiAoSVNfS0FCWUxBS0UoZ3Z0LT5kZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfS0FC
WUxBS0UoZ3Z0LT5pOTE1KSkKIAkJcmV0dXJuIERfS0JMOwotCWVsc2UgaWYgKElTX0JST1hUT04o
Z3Z0LT5kZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfQlJPWFRPTihndnQtPmk5MTUpKQogCQlyZXR1
cm4gRF9CWFQ7Ci0JZWxzZSBpZiAoSVNfQ09GRkVFTEFLRShndnQtPmRldl9wcml2KSkKKwllbHNl
IGlmIChJU19DT0ZGRUVMQUtFKGd2dC0+aTkxNSkpCiAJCXJldHVybiBEX0NGTDsKIAogCXJldHVy
biAwOwpAQCAtMTU2LDcgKzE1Niw3IEBAIGludCBpbnRlbF9ndnRfcmVuZGVyX21taW9fdG9fcmlu
Z19pZChzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQsCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOwogCiAJb2Zmc2V0ICY9IH5HRU5NQVNLKDExLCAwKTsKLQlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBndnQtPmRldl9wcml2LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd2dC0+
aTkxNSwgaWQpIHsKIAkJaWYgKGVuZ2luZS0+bW1pb19iYXNlID09IG9mZnNldCkKIAkJCXJldHVy
biBpZDsKIAl9CkBAIC0yMTcsNyArMjE3LDcgQEAgc3RhdGljIGludCBnYW13X2VjaG9fZGV2X3J3
X2lhX3dyaXRlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LAogewogCXUzMiBpcHMgPSAoKih1MzIg
KilwX2RhdGEpICYgR0FNV19FQ09fRU5BQkxFXzY0S19JUFNfRklFTEQ7CiAKLQlpZiAoSU5URUxf
R0VOKHZncHUtPmd2dC0+ZGV2X3ByaXYpIDw9IDEwKSB7CisJaWYgKElOVEVMX0dFTih2Z3B1LT5n
dnQtPmk5MTUpIDw9IDEwKSB7CiAJCWlmIChpcHMgPT0gR0FNV19FQ09fRU5BQkxFXzY0S19JUFNf
RklFTEQpCiAJCQlndnRfZGJnX2NvcmUoInZncHUlZDogaXBzIGVuYWJsZWRcbiIsIHZncHUtPmlk
KTsKIAkJZWxzZSBpZiAoIWlwcykKQEAgLTI1Myw3ICsyNTMsNyBAQCBzdGF0aWMgaW50IGZlbmNl
X21taW9fcmVhZChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZiwKIHN0
YXRpYyBpbnQgZmVuY2VfbW1pb193cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWdu
ZWQgaW50IG9mZiwKIAkJdm9pZCAqcF9kYXRhLCB1bnNpZ25lZCBpbnQgYnl0ZXMpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKIAl1bnNpZ25l
ZCBpbnQgZmVuY2VfbnVtID0gb2Zmc2V0X3RvX2ZlbmNlX251bShvZmYpOwogCWludCByZXQ7CiAK
QEAgLTI2MiwxMCArMjYyLDEwIEBAIHN0YXRpYyBpbnQgZmVuY2VfbW1pb193cml0ZShzdHJ1Y3Qg
aW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZiwKIAkJcmV0dXJuIHJldDsKIAl3cml0
ZV92cmVnKHZncHUsIG9mZiwgcF9kYXRhLCBieXRlcyk7CiAKLQltbWlvX2h3X2FjY2Vzc19wcmUo
ZGV2X3ByaXYpOworCW1taW9faHdfYWNjZXNzX3ByZShpOTE1KTsKIAlpbnRlbF92Z3B1X3dyaXRl
X2ZlbmNlKHZncHUsIGZlbmNlX251bSwKIAkJCXZncHVfdnJlZzY0KHZncHUsIGZlbmNlX251bV90
b19vZmZzZXQoZmVuY2VfbnVtKSkpOwotCW1taW9faHdfYWNjZXNzX3Bvc3QoZGV2X3ByaXYpOwor
CW1taW9faHdfYWNjZXNzX3Bvc3QoaTkxNSk7CiAJcmV0dXJuIDA7CiB9CiAKQEAgLTI4Myw3ICsy
ODMsNyBAQCBzdGF0aWMgaW50IG11bF9mb3JjZV93YWtlX3dyaXRlKHN0cnVjdCBpbnRlbF92Z3B1
ICp2Z3B1LAogCW9sZCA9IHZncHVfdnJlZyh2Z3B1LCBvZmZzZXQpOwogCW5ldyA9IENBTENfTU9E
RV9NQVNLX1JFRyhvbGQsICoodTMyICopcF9kYXRhKTsKIAotCWlmIChJTlRFTF9HRU4odmdwdS0+
Z3Z0LT5kZXZfcHJpdikgID49ICA5KSB7CisJaWYgKElOVEVMX0dFTih2Z3B1LT5ndnQtPmk5MTUp
ICA+PSAgOSkgewogCQlzd2l0Y2ggKG9mZnNldCkgewogCQljYXNlIEZPUkNFV0FLRV9SRU5ERVJf
R0VOOV9SRUc6CiAJCQlhY2tfcmVnX29mZnNldCA9IEZPUkNFV0FLRV9BQ0tfUkVOREVSX0dFTjlf
UkVHOwpAQCAtMzQxLDcgKzM0MSw3IEBAIHN0YXRpYyBpbnQgZ2Ryc3RfbW1pb193cml0ZShzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZnNldCwKIAkJCWd2dF9kYmdfbW1p
bygidmdwdSVkOiByZXF1ZXN0IFZDUzIgUmVzZXRcbiIsIHZncHUtPmlkKTsKIAkJCWVuZ2luZV9t
YXNrIHw9IEJJVChWQ1MxKTsKIAkJfQotCQllbmdpbmVfbWFzayAmPSBJTlRFTF9JTkZPKHZncHUt
Pmd2dC0+ZGV2X3ByaXYpLT5lbmdpbmVfbWFzazsKKwkJZW5naW5lX21hc2sgJj0gSU5URUxfSU5G
Tyh2Z3B1LT5ndnQtPmk5MTUpLT5lbmdpbmVfbWFzazsKIAl9CiAKIAkvKiB2Z3B1X2xvY2sgYWxy
ZWFkeSBob2xkIGJ5IGVtdWxhdGUgbW1pbyByL3cgKi8KQEAgLTUxMSw3ICs1MTEsNyBAQCBzdGF0
aWMgaW50IGZvcmNlX25vbnByaXZfd3JpdGUoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiAJdTMy
IHJlZ19ub25wcml2ID0gKih1MzIgKilwX2RhdGE7CiAJaW50IHJpbmdfaWQgPSBpbnRlbF9ndnRf
cmVuZGVyX21taW9fdG9fcmluZ19pZCh2Z3B1LT5ndnQsIG9mZnNldCk7CiAJdTMyIHJpbmdfYmFz
ZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9w
cml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5pOTE1Owog
CWludCByZXQgPSAtRUlOVkFMOwogCiAJaWYgKChieXRlcyAhPSA0KSB8fCAoKG9mZnNldCAmIChi
eXRlcyAtIDEpKSAhPSAwKSB8fCByaW5nX2lkIDwgMCkgewpAQCAtNTIwLDcgKzUyMCw3IEBAIHN0
YXRpYyBpbnQgZm9yY2Vfbm9ucHJpdl93cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKIAkJ
cmV0dXJuIHJldDsKIAl9CiAKLQlyaW5nX2Jhc2UgPSBkZXZfcHJpdi0+ZW5naW5lW3JpbmdfaWRd
LT5tbWlvX2Jhc2U7CisJcmluZ19iYXNlID0gaTkxNS0+ZW5naW5lW3JpbmdfaWRdLT5tbWlvX2Jh
c2U7CiAKIAlpZiAoaW5fd2hpdGVsaXN0KHJlZ19ub25wcml2KSB8fAogCQlyZWdfbm9ucHJpdiA9
PSBpOTE1X21taW9fcmVnX29mZnNldChSSU5HX05PUElEKHJpbmdfYmFzZSkpKSB7CkBAIC03NTEs
NyArNzUxLDcgQEAgc3RhdGljIGludCBzb3V0aF9jaGlja2VuMl9tbWlvX3dyaXRlKHN0cnVjdCBp
bnRlbF92Z3B1ICp2Z3B1LAogc3RhdGljIGludCBwcmlfc3VyZl9tbWlvX3dyaXRlKHN0cnVjdCBp
bnRlbF92Z3B1ICp2Z3B1LCB1bnNpZ25lZCBpbnQgb2Zmc2V0LAogCQl2b2lkICpwX2RhdGEsIHVu
c2lnbmVkIGludCBieXRlcykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB2Z3B1LT5ndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dmdwdS0+Z3Z0LT5pOTE1OwogCXUzMiBwaXBlID0gRFNQU1VSRl9UT19QSVBFKG9mZnNldCk7CiAJ
aW50IGV2ZW50ID0gU0tMX0ZMSVBfRVZFTlQocGlwZSwgUExBTkVfUFJJTUFSWSk7CiAKQEAgLTc5
Miw3ICs3OTIsNyBAQCBzdGF0aWMgaW50IHJlZzUwMDgwX21taW9fd3JpdGUoc3RydWN0IGludGVs
X3ZncHUgKnZncHUsCiAJCQkgICAgICAgdW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAqcF9kYXRh
LAogCQkJICAgICAgIHVuc2lnbmVkIGludCBieXRlcykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5pOTE1OwogCWVudW0gcGlwZSBwaXBlID0gUkVHXzUw
MDgwX1RPX1BJUEUob2Zmc2V0KTsKIAllbnVtIHBsYW5lX2lkIHBsYW5lID0gUkVHXzUwMDgwX1RP
X1BMQU5FKG9mZnNldCk7CiAJaW50IGV2ZW50ID0gU0tMX0ZMSVBfRVZFTlQocGlwZSwgcGxhbmUp
OwpAQCAtODE2LDcgKzgxNiw3IEBAIHN0YXRpYyBpbnQgcmVnNTAwODBfbW1pb193cml0ZShzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwKIHN0YXRpYyBpbnQgdHJpZ2dlcl9hdXhfY2hhbm5lbF9pbnRl
cnJ1cHQoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiAJCXVuc2lnbmVkIGludCByZWcpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKIAllbnVt
IGludGVsX2d2dF9ldmVudF90eXBlIGV2ZW50OwogCiAJaWYgKHJlZyA9PSBfRFBBX0FVWF9DSF9D
VEwpCkBAIC05MTYsMTEgKzkxNiwxMSBAQCBzdGF0aWMgaW50IGRwX2F1eF9jaF9jdGxfbW1pb193
cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKIAl3cml0ZV92cmVnKHZncHUsIG9mZnNldCwg
cF9kYXRhLCBieXRlcyk7CiAJZGF0YSA9IHZncHVfdnJlZyh2Z3B1LCBvZmZzZXQpOwogCi0JaWYg
KChJTlRFTF9HRU4odmdwdS0+Z3Z0LT5kZXZfcHJpdikgPj0gOSkKKwlpZiAoKElOVEVMX0dFTih2
Z3B1LT5ndnQtPmk5MTUpID49IDkpCiAJCSYmIG9mZnNldCAhPSBfUkVHX1NLTF9EUF9BVVhfQ0hf
Q1RMKHBvcnRfaW5kZXgpKSB7CiAJCS8qIFNLTCBEUEIvQy9EIGF1eCBjdGwgcmVnaXN0ZXIgY2hh
bmdlZCAqLwogCQlyZXR1cm4gMDsKLQl9IGVsc2UgaWYgKElTX0JST0FEV0VMTCh2Z3B1LT5ndnQt
PmRldl9wcml2KSAmJgorCX0gZWxzZSBpZiAoSVNfQlJPQURXRUxMKHZncHUtPmd2dC0+aTkxNSkg
JiYKIAkJICAgb2Zmc2V0ICE9IF9SRUdfSFNXX0RQX0FVWF9DSF9DVEwocG9ydF9pbmRleCkpIHsK
IAkJLyogd3JpdGUgdG8gdGhlIGRhdGEgcmVnaXN0ZXJzICovCiAJCXJldHVybiAwOwpAQCAtMTIz
Niw4ICsxMjM2LDggQEAgc3RhdGljIGludCBoYW5kbGVfZzJ2X25vdGlmaWNhdGlvbihzdHJ1Y3Qg
aW50ZWxfdmdwdSAqdmdwdSwgaW50IG5vdGlmaWNhdGlvbikKIAogc3RhdGljIGludCBzZW5kX2Rp
c3BsYXlfcmVhZHlfdWV2ZW50KHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCBpbnQgcmVhZHkpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJp
djsKLQlzdHJ1Y3Qga29iamVjdCAqa29iaiA9ICZkZXZfcHJpdi0+ZHJtLnByaW1hcnktPmtkZXYt
PmtvYmo7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2Z3B1LT5ndnQtPmk5MTU7
CisJc3RydWN0IGtvYmplY3QgKmtvYmogPSAmaTkxNS0+ZHJtLnByaW1hcnktPmtkZXYtPmtvYmo7
CiAJY2hhciAqZW52WzNdID0ge05VTEwsIE5VTEwsIE5VTEx9OwogCWNoYXIgdm1pZF9zdHJbMjBd
OwogCWNoYXIgZGlzcGxheV9yZWFkeV9zdHJbMjBdOwpAQCAtMTQxNiw5ICsxNDE2LDkgQEAgc3Rh
dGljIGludCBtYWlsYm94X3dyaXRlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCB1bnNpZ25lZCBp
bnQgb2Zmc2V0LAogCiAJc3dpdGNoIChjbWQpIHsKIAljYXNlIEdFTjlfUENPREVfUkVBRF9NRU1f
TEFURU5DWToKLQkJaWYgKElTX1NLWUxBS0UodmdwdS0+Z3Z0LT5kZXZfcHJpdikKLQkJCSB8fCBJ
U19LQUJZTEFLRSh2Z3B1LT5ndnQtPmRldl9wcml2KQotCQkJIHx8IElTX0NPRkZFRUxBS0Uodmdw
dS0+Z3Z0LT5kZXZfcHJpdikpIHsKKwkJaWYgKElTX1NLWUxBS0UodmdwdS0+Z3Z0LT5pOTE1KQor
CQkJIHx8IElTX0tBQllMQUtFKHZncHUtPmd2dC0+aTkxNSkKKwkJCSB8fCBJU19DT0ZGRUVMQUtF
KHZncHUtPmd2dC0+aTkxNSkpIHsKIAkJCS8qKgogCQkJICogIlJlYWQgbWVtb3J5IGxhdGVuY3ki
IGNvbW1hbmQgb24gZ2VuOS4KIAkJCSAqIEJlbG93IG1lbW9yeSBsYXRlbmN5IHZhbHVlcyBhcmUg
cmVhZApAQCAtMTQyOCw3ICsxNDI4LDcgQEAgc3RhdGljIGludCBtYWlsYm94X3dyaXRlKHN0cnVj
dCBpbnRlbF92Z3B1ICp2Z3B1LCB1bnNpZ25lZCBpbnQgb2Zmc2V0LAogCQkJCSpkYXRhMCA9IDB4
MWUxYTExMDA7CiAJCQllbHNlCiAJCQkJKmRhdGEwID0gMHg2MTUxNGIzZDsKLQkJfSBlbHNlIGlm
IChJU19CUk9YVE9OKHZncHUtPmd2dC0+ZGV2X3ByaXYpKSB7CisJCX0gZWxzZSBpZiAoSVNfQlJP
WFRPTih2Z3B1LT5ndnQtPmk5MTUpKSB7CiAJCQkvKioKIAkJCSAqICJSZWFkIG1lbW9yeSBsYXRl
bmN5IiBjb21tYW5kIG9uIGdlbjkuCiAJCQkgKiBCZWxvdyBtZW1vcnkgbGF0ZW5jeSB2YWx1ZXMg
YXJlIHJlYWQKQEAgLTE0NDEsOSArMTQ0MSw5IEBAIHN0YXRpYyBpbnQgbWFpbGJveF93cml0ZShz
dHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZnNldCwKIAkJfQogCQlicmVh
azsKIAljYXNlIFNLTF9QQ09ERV9DRENMS19DT05UUk9MOgotCQlpZiAoSVNfU0tZTEFLRSh2Z3B1
LT5ndnQtPmRldl9wcml2KQotCQkJIHx8IElTX0tBQllMQUtFKHZncHUtPmd2dC0+ZGV2X3ByaXYp
Ci0JCQkgfHwgSVNfQ09GRkVFTEFLRSh2Z3B1LT5ndnQtPmRldl9wcml2KSkKKwkJaWYgKElTX1NL
WUxBS0UodmdwdS0+Z3Z0LT5pOTE1KQorCQkJIHx8IElTX0tBQllMQUtFKHZncHUtPmd2dC0+aTkx
NSkKKwkJCSB8fCBJU19DT0ZGRUVMQUtFKHZncHUtPmd2dC0+aTkxNSkpCiAJCQkqZGF0YTAgPSBT
S0xfQ0RDTEtfUkVBRFlfRk9SX0NIQU5HRTsKIAkJYnJlYWs7CiAJY2FzZSBHRU42X1BDT0RFX1JF
QURfUkM2VklEUzoKQEAgLTE0OTYsNyArMTQ5Niw3IEBAIHN0YXRpYyBpbnQgc2tsX3Bvd2VyX3dl
bGxfY3RsX3dyaXRlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LAogewogCXUzMiB2ID0gKih1MzIg
KilwX2RhdGE7CiAKLQlpZiAoSVNfQlJPWFRPTih2Z3B1LT5ndnQtPmRldl9wcml2KSkKKwlpZiAo
SVNfQlJPWFRPTih2Z3B1LT5ndnQtPmk5MTUpKQogCQl2ICY9ICgxIDw8IDMxKSB8ICgxIDw8IDI5
KTsKIAllbHNlCiAJCXYgJj0gKDEgPDwgMzEpIHwgKDEgPDwgMjkpIHwgKDEgPDwgOSkgfApAQCAt
MTYzMyw3ICsxNjMzLDcgQEAgc3RhdGljIGludCBtbWlvX3JlYWRfZnJvbV9odyhzdHJ1Y3QgaW50
ZWxfdmdwdSAqdmdwdSwKIAkJdW5zaWduZWQgaW50IG9mZnNldCwgdm9pZCAqcF9kYXRhLCB1bnNp
Z25lZCBpbnQgYnl0ZXMpCiB7CiAJc3RydWN0IGludGVsX2d2dCAqZ3Z0ID0gdmdwdS0+Z3Z0Owot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd2dC0+ZGV2X3ByaXY7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndnQtPmk5MTU7CiAJaW50IHJpbmdfaWQ7CiAJ
dTMyIHJpbmdfYmFzZTsKIApAQCAtMTY0NSwxNCArMTY0NSwxNCBAQCBzdGF0aWMgaW50IG1taW9f
cmVhZF9mcm9tX2h3KHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LAogCSAqIGMuIHRoZSBvZmZzZXQg
aXMgcmluZyB0aW1lIHN0YW1wIG1taW8KIAkgKi8KIAlpZiAocmluZ19pZCA+PSAwKQotCQlyaW5n
X2Jhc2UgPSBkZXZfcHJpdi0+ZW5naW5lW3JpbmdfaWRdLT5tbWlvX2Jhc2U7CisJCXJpbmdfYmFz
ZSA9IGk5MTUtPmVuZ2luZVtyaW5nX2lkXS0+bW1pb19iYXNlOwogCiAJaWYgKHJpbmdfaWQgPCAw
IHx8IHZncHUgID09IGd2dC0+c2NoZWR1bGVyLmVuZ2luZV9vd25lcltyaW5nX2lkXSB8fAogCSAg
ICBvZmZzZXQgPT0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19USU1FU1RBTVAocmluZ19iYXNl
KSkgfHwKIAkgICAgb2Zmc2V0ID09IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfVElNRVNUQU1Q
X1VEVyhyaW5nX2Jhc2UpKSkgewotCQltbWlvX2h3X2FjY2Vzc19wcmUoZGV2X3ByaXYpOworCQlt
bWlvX2h3X2FjY2Vzc19wcmUoaTkxNSk7CiAJCXZncHVfdnJlZyh2Z3B1LCBvZmZzZXQpID0gSTkx
NV9SRUFEKF9NTUlPKG9mZnNldCkpOwotCQltbWlvX2h3X2FjY2Vzc19wb3N0KGRldl9wcml2KTsK
KwkJbW1pb19od19hY2Nlc3NfcG9zdChpOTE1KTsKIAl9CiAKIAlyZXR1cm4gaW50ZWxfdmdwdV9k
ZWZhdWx0X21taW9fcmVhZCh2Z3B1LCBvZmZzZXQsIHBfZGF0YSwgYnl0ZXMpOwpAQCAtMTY5Myw3
ICsxNjkzLDcgQEAgc3RhdGljIGludCByaW5nX21vZGVfbW1pb193cml0ZShzdHJ1Y3QgaW50ZWxf
dmdwdSAqdmdwdSwgdW5zaWduZWQgaW50IG9mZnNldCwKIAlpbnQgcmV0OwogCiAJKCoodTMyICop
cF9kYXRhKSAmPSB+X01BU0tFRF9CSVRfRU5BQkxFKDEpOwotCWlmIChJU19DT0ZGRUVMQUtFKHZn
cHUtPmd2dC0+ZGV2X3ByaXYpKQorCWlmIChJU19DT0ZGRUVMQUtFKHZncHUtPmd2dC0+aTkxNSkp
CiAJCSgqKHUzMiAqKXBfZGF0YSkgJj0gfl9NQVNLRURfQklUX0VOQUJMRSgyKTsKIAl3cml0ZV92
cmVnKHZncHUsIG9mZnNldCwgcF9kYXRhLCBieXRlcyk7CiAKQEAgLTE3MDIsNyArMTcwMiw3IEBA
IHN0YXRpYyBpbnQgcmluZ19tb2RlX21taW9fd3JpdGUoc3RydWN0IGludGVsX3ZncHUgKnZncHUs
IHVuc2lnbmVkIGludCBvZmZzZXQsCiAJCXJldHVybiAwOwogCX0KIAotCWlmIChJU19DT0ZGRUVM
QUtFKHZncHUtPmd2dC0+ZGV2X3ByaXYpICYmCisJaWYgKElTX0NPRkZFRUxBS0UodmdwdS0+Z3Z0
LT5pOTE1KSAmJgogCSAgICBkYXRhICYgX01BU0tFRF9CSVRfRU5BQkxFKDIpKSB7CiAJCWVudGVy
X2ZhaWxzYWZlX21vZGUodmdwdSwgR1ZUX0ZBSUxTQUZFX1VOU1VQUE9SVEVEX0dVRVNUKTsKIAkJ
cmV0dXJuIDA7CkBAIC0xODM0LDcgKzE4MzQsNyBAQCBzdGF0aWMgaW50IGNzZmVfY2hpY2tlbjFf
bW1pb193cml0ZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKIAlNTUlPX0YocHJlZml4KEJMVF9S
SU5HX0JBU0UpLCBzLCBmLCBhbSwgcm0sIGQsIHIsIHcpOyBcCiAJTU1JT19GKHByZWZpeChHRU42
X0JTRF9SSU5HX0JBU0UpLCBzLCBmLCBhbSwgcm0sIGQsIHIsIHcpOyBcCiAJTU1JT19GKHByZWZp
eChWRUJPWF9SSU5HX0JBU0UpLCBzLCBmLCBhbSwgcm0sIGQsIHIsIHcpOyBcCi0JaWYgKEhBU19F
TkdJTkUoZGV2X3ByaXYsIFZDUzEpKSBcCisJaWYgKEhBU19FTkdJTkUoaTkxNSwgVkNTMSkpIFwK
IAkJTU1JT19GKHByZWZpeChHRU44X0JTRDJfUklOR19CQVNFKSwgcywgZiwgYW0sIHJtLCBkLCBy
LCB3KTsgXAogfSB3aGlsZSAoMCkKIApAQCAtMTg1NSw3ICsxODU1LDcgQEAgc3RhdGljIGludCBj
c2ZlX2NoaWNrZW4xX21taW9fd3JpdGUoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiAKIHN0YXRp
YyBpbnQgaW5pdF9nZW5lcmljX21taW9faW5mbyhzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3Z0LT5kZXZfcHJpdjsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd2dC0+aTkxNTsKIAlpbnQgcmV0OwogCiAJTU1J
T19SSU5HX0RGSChSSU5HX0lNUiwgRF9BTEwsIEZfQ01EX0FDQ0VTUywgTlVMTCwKQEAgLTI2NzAs
NyArMjY3MCw3IEBAIHN0YXRpYyBpbnQgaW5pdF9nZW5lcmljX21taW9faW5mbyhzdHJ1Y3QgaW50
ZWxfZ3Z0ICpndnQpCiAKIHN0YXRpYyBpbnQgaW5pdF9icm9hZHdlbGxfbW1pb19pbmZvKHN0cnVj
dCBpbnRlbF9ndnQgKmd2dCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3Z0LT5p
OTE1OwogCWludCByZXQ7CiAKIAlNTUlPX0RIKEdFTjhfR1RfSU1SKDApLCBEX0JEV19QTFVTLCBO
VUxMLCBpbnRlbF92Z3B1X3JlZ19pbXJfaGFuZGxlcik7CkBAIC0yODU5LDcgKzI4NTksNyBAQCBz
dGF0aWMgaW50IGluaXRfYnJvYWR3ZWxsX21taW9faW5mbyhzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQp
CiAKIHN0YXRpYyBpbnQgaW5pdF9za2xfbW1pb19pbmZvKHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndnQtPmRldl9wcml2Owor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3Z0LT5pOTE1OwogCWludCByZXQ7CiAK
IAlNTUlPX0RIKEZPUkNFV0FLRV9SRU5ERVJfR0VOOSwgRF9TS0xfUExVUywgTlVMTCwgbXVsX2Zv
cmNlX3dha2Vfd3JpdGUpOwpAQCAtMzEwOCw3ICszMTA4LDcgQEAgc3RhdGljIGludCBpbml0X3Nr
bF9tbWlvX2luZm8oc3RydWN0IGludGVsX2d2dCAqZ3Z0KQogCiBzdGF0aWMgaW50IGluaXRfYnh0
X21taW9faW5mbyhzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZ3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGd2dC0+aTkxNTsKIAlpbnQgcmV0OwogCiAJTU1JT19GKF9NTUlPKDB4ODAwMDAp
LCAweDMwMDAsIDAsIDAsIDAsIERfQlhULCBOVUxMLCBOVUxMKTsKQEAgLTMzNDQsNyArMzM0NCw3
IEBAIHN0YXRpYyBzdHJ1Y3QgZ3Z0X21taW9fYmxvY2sgbW1pb19ibG9ja3NbXSA9IHsKIGludCBp
bnRlbF9ndnRfc2V0dXBfbW1pb19pbmZvKHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkKIHsKIAlzdHJ1
Y3QgaW50ZWxfZ3Z0X2RldmljZV9pbmZvICppbmZvID0gJmd2dC0+ZGV2aWNlX2luZm87Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd2dC0+aTkxNTsKIAlpbnQgc2l6ZSA9IGluZm8tPm1t
aW9fc2l6ZSAvIDQgKiBzaXplb2YoKmd2dC0+bW1pby5tbWlvX2F0dHJpYnV0ZSk7CiAJaW50IHJl
dDsKIApAQCAtMzM1NiwyMCArMzM1NiwyMCBAQCBpbnQgaW50ZWxfZ3Z0X3NldHVwX21taW9faW5m
byhzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiAJaWYgKHJldCkKIAkJZ290byBlcnI7CiAKLQlpZiAo
SVNfQlJPQURXRUxMKGRldl9wcml2KSkgeworCWlmIChJU19CUk9BRFdFTEwoaTkxNSkpIHsKIAkJ
cmV0ID0gaW5pdF9icm9hZHdlbGxfbW1pb19pbmZvKGd2dCk7CiAJCWlmIChyZXQpCiAJCQlnb3Rv
IGVycjsKLQl9IGVsc2UgaWYgKElTX1NLWUxBS0UoZGV2X3ByaXYpCi0JCXx8IElTX0tBQllMQUtF
KGRldl9wcml2KQotCQl8fCBJU19DT0ZGRUVMQUtFKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAo
SVNfU0tZTEFLRShpOTE1KQorCQl8fCBJU19LQUJZTEFLRShpOTE1KQorCQl8fCBJU19DT0ZGRUVM
QUtFKGk5MTUpKSB7CiAJCXJldCA9IGluaXRfYnJvYWR3ZWxsX21taW9faW5mbyhndnQpOwogCQlp
ZiAocmV0KQogCQkJZ290byBlcnI7CiAJCXJldCA9IGluaXRfc2tsX21taW9faW5mbyhndnQpOwog
CQlpZiAocmV0KQogCQkJZ290byBlcnI7Ci0JfSBlbHNlIGlmIChJU19CUk9YVE9OKGRldl9wcml2
KSkgeworCX0gZWxzZSBpZiAoSVNfQlJPWFRPTihpOTE1KSkgewogCQlyZXQgPSBpbml0X2Jyb2Fk
d2VsbF9tbWlvX2luZm8oZ3Z0KTsKIAkJaWYgKHJldCkKIAkJCWdvdG8gZXJyOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2ludGVycnVwdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L2ludGVycnVwdC5jCmluZGV4IDk1MTY4MTgxMzIzMC4uMzdlMmU3MmJmYWNjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaW50ZXJydXB0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2ludGVycnVwdC5jCkBAIC01MzYsNyArNTM2LDcgQEAgc3Rh
dGljIHZvaWQgZ2VuOF9pbml0X2lycSgKIAlTRVRfQklUX0lORk8oaXJxLCA0LCBWQ1NfTUlfRkxV
U0hfRFcsIElOVEVMX0dWVF9JUlFfSU5GT19HVDEpOwogCVNFVF9CSVRfSU5GTyhpcnEsIDgsIFZD
U19BU19DT05URVhUX1NXSVRDSCwgSU5URUxfR1ZUX0lSUV9JTkZPX0dUMSk7CiAKLQlpZiAoSEFT
X0VOR0lORShndnQtPmRldl9wcml2LCBWQ1MxKSkgeworCWlmIChIQVNfRU5HSU5FKGd2dC0+aTkx
NSwgVkNTMSkpIHsKIAkJU0VUX0JJVF9JTkZPKGlycSwgMTYsIFZDUzJfTUlfVVNFUl9JTlRFUlJV
UFQsCiAJCQlJTlRFTF9HVlRfSVJRX0lORk9fR1QxKTsKIAkJU0VUX0JJVF9JTkZPKGlycSwgMjAs
IFZDUzJfTUlfRkxVU0hfRFcsCkBAIC01NjgsNyArNTY4LDcgQEAgc3RhdGljIHZvaWQgZ2VuOF9p
bml0X2lycSgKIAlTRVRfQklUX0lORk8oaXJxLCAyMiwgRFBfQ19IT1RQTFVHLCBJTlRFTF9HVlRf
SVJRX0lORk9fUENIKTsKIAlTRVRfQklUX0lORk8oaXJxLCAyMywgRFBfRF9IT1RQTFVHLCBJTlRF
TF9HVlRfSVJRX0lORk9fUENIKTsKIAotCWlmIChJU19CUk9BRFdFTEwoZ3Z0LT5kZXZfcHJpdikp
IHsKKwlpZiAoSVNfQlJPQURXRUxMKGd2dC0+aTkxNSkpIHsKIAkJU0VUX0JJVF9JTkZPKGlycSwg
MjUsIEFVWF9DSEFOTkVMX0IsIElOVEVMX0dWVF9JUlFfSU5GT19QQ0gpOwogCQlTRVRfQklUX0lO
Rk8oaXJxLCAyNiwgQVVYX0NIQU5ORUxfQywgSU5URUxfR1ZUX0lSUV9JTkZPX1BDSCk7CiAJCVNF
VF9CSVRfSU5GTyhpcnEsIDI3LCBBVVhfQ0hBTk5FTF9ELCBJTlRFTF9HVlRfSVJRX0lORk9fUENI
KTsKQEAgLTU4MSw3ICs1ODEsNyBAQCBzdGF0aWMgdm9pZCBnZW44X2luaXRfaXJxKAogCiAJCVNF
VF9CSVRfSU5GTyhpcnEsIDQsIFBSSU1BUllfQ19GTElQX0RPTkUsIElOVEVMX0dWVF9JUlFfSU5G
T19ERV9QSVBFX0MpOwogCQlTRVRfQklUX0lORk8oaXJxLCA1LCBTUFJJVEVfQ19GTElQX0RPTkUs
IElOVEVMX0dWVF9JUlFfSU5GT19ERV9QSVBFX0MpOwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGd2
dC0+ZGV2X3ByaXYpID49IDkpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihndnQtPmk5MTUpID49
IDkpIHsKIAkJU0VUX0JJVF9JTkZPKGlycSwgMjUsIEFVWF9DSEFOTkVMX0IsIElOVEVMX0dWVF9J
UlFfSU5GT19ERV9QT1JUKTsKIAkJU0VUX0JJVF9JTkZPKGlycSwgMjYsIEFVWF9DSEFOTkVMX0Ms
IElOVEVMX0dWVF9JUlFfSU5GT19ERV9QT1JUKTsKIAkJU0VUX0JJVF9JTkZPKGlycSwgMjcsIEFV
WF9DSEFOTkVMX0QsIElOVEVMX0dWVF9JUlFfSU5GT19ERV9QT1JUKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9rdm1ndC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2t2bWd0LmMKaW5kZXggMTQ0MzAxYjc3OGRmLi42MTVhNzk1OWI3NjIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9rdm1ndC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9rdm1ndC5jCkBAIC0xODcsNyArMTg3LDcgQEAgc3RhdGljIGludCBndnRfcGluX2d1ZXN0
X3BhZ2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIHVuc2lnbmVkIGxvbmcgZ2ZuLAogc3RhdGlj
IGludCBndnRfZG1hX21hcF9wYWdlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCB1bnNpZ25lZCBs
b25nIGdmbiwKIAkJZG1hX2FkZHJfdCAqZG1hX2FkZHIsIHVuc2lnbmVkIGxvbmcgc2l6ZSkKIHsK
LQlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmdmdwdS0+Z3Z0LT5kZXZfcHJpdi0+ZHJtLnBkZXYtPmRl
djsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmdmdwdS0+Z3Z0LT5pOTE1LT5kcm0ucGRldi0+ZGV2
OwogCXN0cnVjdCBwYWdlICpwYWdlID0gTlVMTDsKIAlpbnQgcmV0OwogCkBAIC0yMTAsNyArMjEw
LDcgQEAgc3RhdGljIGludCBndnRfZG1hX21hcF9wYWdlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1
LCB1bnNpZ25lZCBsb25nIGdmbiwKIHN0YXRpYyB2b2lkIGd2dF9kbWFfdW5tYXBfcGFnZShzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdW5zaWduZWQgbG9uZyBnZm4sCiAJCWRtYV9hZGRyX3QgZG1h
X2FkZHIsIHVuc2lnbmVkIGxvbmcgc2l6ZSkKIHsKLQlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAmdmdw
dS0+Z3Z0LT5kZXZfcHJpdi0+ZHJtLnBkZXYtPmRldjsKKwlzdHJ1Y3QgZGV2aWNlICpkZXYgPSAm
dmdwdS0+Z3Z0LT5pOTE1LT5kcm0ucGRldi0+ZGV2OwogCiAJZG1hX3VubWFwX3BhZ2UoZGV2LCBk
bWFfYWRkciwgc2l6ZSwgUENJX0RNQV9CSURJUkVDVElPTkFMKTsKIAlndnRfdW5waW5fZ3Vlc3Rf
cGFnZSh2Z3B1LCBnZm4sIHNpemUpOwpAQCAtOTEzLDcgKzkxMyw3IEBAIHN0YXRpYyBpbnQgaW50
ZWxfdmdwdV9hcGVydHVyZV9ydyhzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgdTY0IG9mZiwKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JYXBlcnR1cmVfdmEgPSBpb19tYXBwaW5nX21hcF93Yygm
dmdwdS0+Z3Z0LT5kZXZfcHJpdi0+Z2d0dC5pb21hcCwKKwlhcGVydHVyZV92YSA9IGlvX21hcHBp
bmdfbWFwX3djKCZ2Z3B1LT5ndnQtPmk5MTUtPmdndHQuaW9tYXAsCiAJCQkJCUFMSUdOX0RPV04o
b2ZmLCBQQUdFX1NJWkUpLAogCQkJCQljb3VudCArIG9mZnNldF9pbl9wYWdlKG9mZikpOwogCWlm
ICghYXBlcnR1cmVfdmEpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1p
by5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L21taW8uYwppbmRleCBhNTUxNzg4ODRkNjcu
LjU3MmI4MzI4YWY2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L21taW8u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvbW1pby5jCkBAIC0yNDUsNyArMjQ1LDcg
QEAgdm9pZCBpbnRlbF92Z3B1X3Jlc2V0X21taW8oc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGJv
b2wgZG1scikKIAkJLyogc2V0IHRoZSBiaXQgMDoyKENvcmUgQy1TdGF0ZSApIHRvIEMwICovCiAJ
CXZncHVfdnJlZ190KHZncHUsIEdFTjZfR1RfQ09SRV9TVEFUVVMpID0gMDsKIAotCQlpZiAoSVNf
QlJPWFRPTih2Z3B1LT5ndnQtPmRldl9wcml2KSkgeworCQlpZiAoSVNfQlJPWFRPTih2Z3B1LT5n
dnQtPmk5MTUpKSB7CiAJCQl2Z3B1X3ZyZWdfdCh2Z3B1LCBCWFRfUF9DUl9HVF9ESVNQX1BXUk9O
KSAmPQogCQkJCSAgICB+KEJJVCgwKSB8IEJJVCgxKSk7CiAJCQl2Z3B1X3ZyZWdfdCh2Z3B1LCBC
WFRfUE9SVF9DTDFDTV9EVzAoRFBJT19QSFkwKSkgJj0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9tbWlvX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9t
bWlvX2NvbnRleHQuYwppbmRleCAyOTk4OTk5ZTg1NjguLjQ0ZmQ2YTBhNjk4YyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L21taW9fY29udGV4dC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d2dC9tbWlvX2NvbnRleHQuYwpAQCAtMTQ4LDcgKzE0OCw3IEBAIHN0YXRp
YyBzdHJ1Y3QgewogCXUzMiBsM2NjX3RhYmxlW0dFTjlfTU9DU19TSVpFIC8gMl07CiB9IGdlbjlf
cmVuZGVyX21vY3M7CiAKLXN0YXRpYyB2b2lkIGxvYWRfcmVuZGVyX21vY3Moc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgbG9hZF9yZW5kZXJfbW9jcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpOTE1X3JlZ190IG9mZnNldDsKIAl1MzIg
cmVnc1tdID0gewpAQCAtMTYxLDcgKzE2MSw3IEBAIHN0YXRpYyB2b2lkIGxvYWRfcmVuZGVyX21v
Y3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWludCByaW5nX2lkLCBpOwog
CiAJZm9yIChyaW5nX2lkID0gMDsgcmluZ19pZCA8IEFSUkFZX1NJWkUocmVncyk7IHJpbmdfaWQr
KykgewotCQlpZiAoIUhBU19FTkdJTkUoZGV2X3ByaXYsIHJpbmdfaWQpKQorCQlpZiAoIUhBU19F
TkdJTkUoaTkxNSwgcmluZ19pZCkpCiAJCQljb250aW51ZTsKIAkJb2Zmc2V0LnJlZyA9IHJlZ3Nb
cmluZ19pZF07CiAJCWZvciAoaSA9IDA7IGkgPCBHRU45X01PQ1NfU0laRTsgaSsrKSB7CkBAIC0z
MjksOCArMzI5LDggQEAgaW50IGludGVsX3ZncHVfcmVzdG9yZV9pbmhpYml0X2NvbnRleHQoc3Ry
dWN0IGludGVsX3ZncHUgKnZncHUsCiAKIHN0YXRpYyB2b2lkIGhhbmRsZV90bGJfcGVuZGluZ19l
dmVudChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHJpbmdfaWQpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKLQlzdHJ1Y3Qg
aW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3Jl
ICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwogCXN0cnVjdCBpbnRlbF92Z3B1X3N1Ym1pc3Npb24g
KnMgPSAmdmdwdS0+c3VibWlzc2lvbjsKIAllbnVtIGZvcmNld2FrZV9kb21haW5zIGZ3OwogCWk5
MTVfcmVnX3QgcmVnOwpAQCAtMzU3LDcgKzM1Nyw3IEBAIHN0YXRpYyB2b2lkIGhhbmRsZV90bGJf
cGVuZGluZ19ldmVudChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwgaW50IHJpbmdfaWQpCiAJICov
CiAJZncgPSBpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2Zvcl9yZWcodW5jb3JlLCByZWcsCiAJCQkJ
CSAgICBGV19SRUdfUkVBRCB8IEZXX1JFR19XUklURSk7Ci0JaWYgKHJpbmdfaWQgPT0gUkNTMCAm
JiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYgKHJpbmdfaWQgPT0gUkNTMCAmJiBJTlRF
TF9HRU4oaTkxNSkgPj0gOSkKIAkJZncgfD0gRk9SQ0VXQUtFX1JFTkRFUjsKIAogCWludGVsX3Vu
Y29yZV9mb3JjZXdha2VfZ2V0KHVuY29yZSwgZncpOwpAQCAtMzc3LDcgKzM3Nyw3IEBAIHN0YXRp
YyB2b2lkIGhhbmRsZV90bGJfcGVuZGluZ19ldmVudChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwg
aW50IHJpbmdfaWQpCiBzdGF0aWMgdm9pZCBzd2l0Y2hfbW9jcyhzdHJ1Y3QgaW50ZWxfdmdwdSAq
cHJlLCBzdHJ1Y3QgaW50ZWxfdmdwdSAqbmV4dCwKIAkJCWludCByaW5nX2lkKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNTsKIAlpOTE1X3JlZ190IG9mZnNldCwgbDNfb2Zmc2V0OwogCXUzMiBvbGRfdiwgbmV3X3Y7
CiAKQEAgLTM5MCwxNSArMzkwLDE1IEBAIHN0YXRpYyB2b2lkIHN3aXRjaF9tb2NzKHN0cnVjdCBp
bnRlbF92Z3B1ICpwcmUsIHN0cnVjdCBpbnRlbF92Z3B1ICpuZXh0LAogCX07CiAJaW50IGk7CiAK
LQlkZXZfcHJpdiA9IHByZSA/IHByZS0+Z3Z0LT5kZXZfcHJpdiA6IG5leHQtPmd2dC0+ZGV2X3By
aXY7CisJaTkxNSA9IHByZSA/IHByZS0+Z3Z0LT5pOTE1IDogbmV4dC0+Z3Z0LT5pOTE1OwogCWlm
IChXQVJOX09OKHJpbmdfaWQgPj0gQVJSQVlfU0laRShyZWdzKSkpCiAJCXJldHVybjsKIAotCWlm
IChyaW5nX2lkID09IFJDUzAgJiYgSVNfR0VOKGRldl9wcml2LCA5KSkKKwlpZiAocmluZ19pZCA9
PSBSQ1MwICYmIElTX0dFTihpOTE1LCA5KSkKIAkJcmV0dXJuOwogCiAJaWYgKCFwcmUgJiYgIWdl
bjlfcmVuZGVyX21vY3MuaW5pdGlhbGl6ZWQpCi0JCWxvYWRfcmVuZGVyX21vY3MoZGV2X3ByaXYp
OworCQlsb2FkX3JlbmRlcl9tb2NzKGk5MTUpOwogCiAJb2Zmc2V0LnJlZyA9IHJlZ3NbcmluZ19p
ZF07CiAJZm9yIChpID0gMDsgaSA8IEdFTjlfTU9DU19TSVpFOyBpKyspIHsKQEAgLTQ1NCwxNiAr
NDU0LDE2IEBAIHN0YXRpYyB2b2lkIHN3aXRjaF9tbWlvKHN0cnVjdCBpbnRlbF92Z3B1ICpwcmUs
CiAJCQlzdHJ1Y3QgaW50ZWxfdmdwdSAqbmV4dCwKIAkJCWludCByaW5nX2lkKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9zdWJtaXNzaW9uICpzOwogCXN0cnVjdCBlbmdpbmVf
bW1pbyAqbW1pbzsKIAl1MzIgb2xkX3YsIG5ld192OwogCi0JZGV2X3ByaXYgPSBwcmUgPyBwcmUt
Pmd2dC0+ZGV2X3ByaXYgOiBuZXh0LT5ndnQtPmRldl9wcml2OwotCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDkpCisJaTkxNSA9IHByZSA/IHByZS0+Z3Z0LT5pOTE1IDogbmV4dC0+Z3Z0LT5p
OTE1OworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJc3dpdGNoX21vY3MocHJlLCBuZXh0
LCByaW5nX2lkKTsKIAotCWZvciAobW1pbyA9IGRldl9wcml2LT5ndnQtPmVuZ2luZV9tbWlvX2xp
c3QubW1pbzsKKwlmb3IgKG1taW8gPSBpOTE1LT5ndnQtPmVuZ2luZV9tbWlvX2xpc3QubW1pbzsK
IAkgICAgIGk5MTVfbW1pb19yZWdfdmFsaWQobW1pby0+cmVnKTsgbW1pbysrKSB7CiAJCWlmICht
bWlvLT5yaW5nX2lkICE9IHJpbmdfaWQpCiAJCQljb250aW51ZTsKQEAgLTQ3Miw3ICs0NzIsNyBA
QCBzdGF0aWMgdm9pZCBzd2l0Y2hfbW1pbyhzdHJ1Y3QgaW50ZWxfdmdwdSAqcHJlLAogCQkgKiBz
dGF0ZSBpbWFnZSBvbiBnZW45LCBpdCdzIGluaXRpYWxpemVkIGJ5IGxyaSBjb21tYW5kIGFuZAog
CQkgKiBzYXZlIG9yIHJlc3RvcmUgd2l0aCBjb250ZXh0IHRvZ2V0aGVyLgogCQkgKi8KLQkJaWYg
KElTX0dFTihkZXZfcHJpdiwgOSkgJiYgbW1pby0+aW5fY29udGV4dCkKKwkJaWYgKElTX0dFTihp
OTE1LCA5KSAmJiBtbWlvLT5pbl9jb250ZXh0KQogCQkJY29udGludWU7CiAKIAkJLy8gc2F2ZQpA
QCAtNTM2LDcgKzUzNiw3IEBAIHN0YXRpYyB2b2lkIHN3aXRjaF9tbWlvKHN0cnVjdCBpbnRlbF92
Z3B1ICpwcmUsCiB2b2lkIGludGVsX2d2dF9zd2l0Y2hfbW1pbyhzdHJ1Y3QgaW50ZWxfdmdwdSAq
cHJlLAogCQkJICAgc3RydWN0IGludGVsX3ZncHUgKm5leHQsIGludCByaW5nX2lkKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNTsKIAogCWlmIChXQVJOX09OKCFwcmUgJiYgIW5leHQpKQogCQlyZXR1cm47CkBAIC01
NDQsMTYgKzU0NCwxNiBAQCB2b2lkIGludGVsX2d2dF9zd2l0Y2hfbW1pbyhzdHJ1Y3QgaW50ZWxf
dmdwdSAqcHJlLAogCWd2dF9kYmdfcmVuZGVyKCJzd2l0Y2ggcmluZyAlZCBmcm9tICVzIHRvICVz
XG4iLCByaW5nX2lkLAogCQkgICAgICAgcHJlID8gInZHUFUiIDogImhvc3QiLCBuZXh0ID8gInZH
UFUiIDogIkhPU1QiKTsKIAotCWRldl9wcml2ID0gcHJlID8gcHJlLT5ndnQtPmRldl9wcml2IDog
bmV4dC0+Z3Z0LT5kZXZfcHJpdjsKKwlpOTE1ID0gcHJlID8gcHJlLT5ndnQtPmk5MTUgOiBuZXh0
LT5ndnQtPmk5MTU7CiAKIAkvKioKIAkgKiBXZSBhcmUgdXNpbmcgcmF3IG1taW8gYWNjZXNzIHdy
YXBwZXIgdG8gaW1wcm92ZSB0aGUKIAkgKiBwZXJmb3JtYWNlIGZvciBiYXRjaCBtbWlvIHJlYWQv
d3JpdGUsIHNvIHdlIG5lZWQKIAkgKiBoYW5kbGUgZm9yY2V3YWtlIG1hbm51YWxseS4KIAkgKi8K
LQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtF
X0FMTCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VX
QUtFX0FMTCk7CiAJc3dpdGNoX21taW8ocHJlLCBuZXh0LCByaW5nX2lkKTsKLQlpbnRlbF91bmNv
cmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJaW50
ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiB9
CiAKIC8qKgpAQCAtNTY1LDcgKzU2NSw3IEBAIHZvaWQgaW50ZWxfZ3Z0X2luaXRfZW5naW5lX21t
aW9fY29udGV4dChzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiB7CiAJc3RydWN0IGVuZ2luZV9tbWlv
ICptbWlvOwogCi0JaWYgKElOVEVMX0dFTihndnQtPmRldl9wcml2KSA+PSA5KQorCWlmIChJTlRF
TF9HRU4oZ3Z0LT5pOTE1KSA+PSA5KQogCQlndnQtPmVuZ2luZV9tbWlvX2xpc3QubW1pbyA9IGdl
bjlfZW5naW5lX21taW9fbGlzdDsKIAllbHNlCiAJCWd2dC0+ZW5naW5lX21taW9fbGlzdC5tbWlv
ID0gZ2VuOF9lbmdpbmVfbW1pb19saXN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L3NjaGVkX3BvbGljeS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkX3Bv
bGljeS5jCmluZGV4IDFjNzYzYTI3YTQxMi4uNjRhNWQ0Njg4Yzg5IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWRfcG9saWN5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L3NjaGVkX3BvbGljeS5jCkBAIC0zOSw3ICszOSw3IEBAIHN0YXRpYyBib29sIHZn
cHVfaGFzX3BlbmRpbmdfd29ya2xvYWQoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaTsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAKLQlm
b3JfZWFjaF9lbmdpbmUoZW5naW5lLCB2Z3B1LT5ndnQtPmRldl9wcml2LCBpKSB7CisJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgdmdwdS0+Z3Z0LT5pOTE1LCBpKSB7CiAJCWlmICghbGlzdF9lbXB0
eSh3b3JrbG9hZF9xX2hlYWQodmdwdSwgaSkpKQogCQkJcmV0dXJuIHRydWU7CiAJfQpAQCAtMTUy
LDcgKzE1Miw3IEBAIHN0YXRpYyB2b2lkIHRyeV90b19zY2hlZHVsZV9uZXh0X3ZncHUoc3RydWN0
IGludGVsX2d2dCAqZ3Z0KQogCXNjaGVkdWxlci0+bmVlZF9yZXNjaGVkdWxlID0gdHJ1ZTsKIAog
CS8qIHN0aWxsIGhhdmUgdW5jb21wbGV0ZWQgd29ya2xvYWQ/ICovCi0JZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgZ3Z0LT5kZXZfcHJpdiwgaSkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd2
dC0+aTkxNSwgaSkgewogCQlpZiAoc2NoZWR1bGVyLT5jdXJyZW50X3dvcmtsb2FkW2ldKQogCQkJ
cmV0dXJuOwogCX0KQEAgLTE2OSw3ICsxNjksNyBAQCBzdGF0aWMgdm9pZCB0cnlfdG9fc2NoZWR1
bGVfbmV4dF92Z3B1KHN0cnVjdCBpbnRlbF9ndnQgKmd2dCkKIAlzY2hlZHVsZXItPm5lZWRfcmVz
Y2hlZHVsZSA9IGZhbHNlOwogCiAJLyogd2FrZSB1cCB3b3JrbG9hZCBkaXNwYXRjaCB0aHJlYWQg
Ki8KLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndnQtPmRldl9wcml2LCBpKQorCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGd2dC0+aTkxNSwgaSkKIAkJd2FrZV91cCgmc2NoZWR1bGVyLT53YWl0
cVtpXSk7CiB9CiAKQEAgLTQ0Niw3ICs0NDYsNyBAQCB2b2lkIGludGVsX3ZncHVfc3RvcF9zY2hl
ZHVsZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAkJJnZncHUtPmd2dC0+c2NoZWR1bGVyOwog
CWludCByaW5nX2lkOwogCXN0cnVjdCB2Z3B1X3NjaGVkX2RhdGEgKnZncHVfZGF0YSA9IHZncHUt
PnNjaGVkX2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+
Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2
dC0+aTkxNTsKIAogCWlmICghdmdwdV9kYXRhLT5hY3RpdmUpCiAJCXJldHVybjsKQEAgLTQ2NSw3
ICs0NjUsNyBAQCB2b2lkIGludGVsX3ZncHVfc3RvcF9zY2hlZHVsZShzdHJ1Y3QgaW50ZWxfdmdw
dSAqdmdwdSkKIAkJc2NoZWR1bGVyLT5jdXJyZW50X3ZncHUgPSBOVUxMOwogCX0KIAotCWludGVs
X3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsKKwlpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsK
IAlzcGluX2xvY2tfYmgoJnNjaGVkdWxlci0+bW1pb19jb250ZXh0X2xvY2spOwogCWZvciAocmlu
Z19pZCA9IDA7IHJpbmdfaWQgPCBJOTE1X05VTV9FTkdJTkVTOyByaW5nX2lkKyspIHsKIAkJaWYg
KHNjaGVkdWxlci0+ZW5naW5lX293bmVyW3JpbmdfaWRdID09IHZncHUpIHsKQEAgLTQ3NCw2ICs0
NzQsNiBAQCB2b2lkIGludGVsX3ZncHVfc3RvcF9zY2hlZHVsZShzdHJ1Y3QgaW50ZWxfdmdwdSAq
dmdwdSkKIAkJfQogCX0KIAlzcGluX3VubG9ja19iaCgmc2NoZWR1bGVyLT5tbWlvX2NvbnRleHRf
bG9jayk7Ci0JaW50ZWxfcnVudGltZV9wbV9wdXRfdW5jaGVja2VkKGRldl9wcml2KTsKKwlpbnRl
bF9ydW50aW1lX3BtX3B1dF91bmNoZWNrZWQoaTkxNSk7CiAJbXV0ZXhfdW5sb2NrKCZ2Z3B1LT5n
dnQtPnNjaGVkX2xvY2spOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCmluZGV4
IGUzMDFlZmIxOGQ0NS4uZWM3Mjk5ZDhhNzM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvc2NoZWR1bGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVk
dWxlci5jCkBAIC04Myw5ICs4Myw5IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9zaGFkb3dfcGRwcyhz
dHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiBzdGF0aWMgdm9pZCBzcl9vYV9y
ZWdzKHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCwKIAkJdTMyICpyZWdfc3Rh
dGUsIGJvb2wgc2F2ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB3
b3JrbG9hZC0+dmdwdS0+Z3Z0LT5kZXZfcHJpdjsKLQl1MzIgY3R4X29hY3R4Y3RybCA9IGRldl9w
cml2LT5wZXJmLm9hLmN0eF9vYWN0eGN0cmxfb2Zmc2V0OwotCXUzMiBjdHhfZmxleGV1MCA9IGRl
dl9wcml2LT5wZXJmLm9hLmN0eF9mbGV4ZXUwX29mZnNldDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHdvcmtsb2FkLT52Z3B1LT5ndnQtPmk5MTU7CisJdTMyIGN0eF9vYWN0eGN0
cmwgPSBpOTE1LT5wZXJmLm9hLmN0eF9vYWN0eGN0cmxfb2Zmc2V0OworCXUzMiBjdHhfZmxleGV1
MCA9IGk5MTUtPnBlcmYub2EuY3R4X2ZsZXhldTBfb2Zmc2V0OwogCWludCBpID0gMDsKIAl1MzIg
ZmxleF9tbWlvW10gPSB7CiAJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KEVVX1BFUkZfQ05UTDApLApA
QCAtMTc3LDExICsxNzcsMTEgQEAgc3RhdGljIGludCBwb3B1bGF0ZV9zaGFkb3dfY29udGV4dChz
dHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiAJZ3Z0X2RiZ19zY2hlZCgicmlu
ZyBpZCAlZCB3b3JrbG9hZCBscmNhICV4IiwgcmluZ19pZCwKIAkJCXdvcmtsb2FkLT5jdHhfZGVz
Yy5scmNhKTsKIAotCWNvbnRleHRfcGFnZV9udW0gPSBndnQtPmRldl9wcml2LT5lbmdpbmVbcmlu
Z19pZF0tPmNvbnRleHRfc2l6ZTsKKwljb250ZXh0X3BhZ2VfbnVtID0gZ3Z0LT5pOTE1LT5lbmdp
bmVbcmluZ19pZF0tPmNvbnRleHRfc2l6ZTsKIAogCWNvbnRleHRfcGFnZV9udW0gPSBjb250ZXh0
X3BhZ2VfbnVtID4+IFBBR0VfU0hJRlQ7CiAKLQlpZiAoSVNfQlJPQURXRUxMKGd2dC0+ZGV2X3By
aXYpICYmIHJpbmdfaWQgPT0gUkNTMCkKKwlpZiAoSVNfQlJPQURXRUxMKGd2dC0+aTkxNSkgJiYg
cmluZ19pZCA9PSBSQ1MwKQogCQljb250ZXh0X3BhZ2VfbnVtID0gMTk7CiAKIAlpID0gMjsKQEAg
LTIxMSw4ICsyMTEsOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaXNfZ3Z0X3JlcXVlc3Qoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcmVxKQogCiBzdGF0aWMgdm9pZCBzYXZlX3JpbmdfaHdfc3RhdGUoc3Ry
dWN0IGludGVsX3ZncHUgKnZncHUsIGludCByaW5nX2lkKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7Ci0JdTMyIHJpbmdfYmFzZSA9
IGRldl9wcml2LT5lbmdpbmVbcmluZ19pZF0tPm1taW9fYmFzZTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+aTkxNTsKKwl1MzIgcmluZ19iYXNlID0gaTkxNS0+
ZW5naW5lW3JpbmdfaWRdLT5tbWlvX2Jhc2U7CiAJaTkxNV9yZWdfdCByZWc7CiAKIAlyZWcgPSBS
SU5HX0lOU1RET05FKHJpbmdfYmFzZSk7CkBAIC0zOTEsMTAgKzM5MSwxMCBAQCBpbnRlbF9ndnRf
d29ya2xvYWRfcmVxX2FsbG9jKHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCkK
IHsKIAlzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSA9IHdvcmtsb2FkLT52Z3B1OwogCXN0cnVjdCBp
bnRlbF92Z3B1X3N1Ym1pc3Npb24gKnMgPSAmdmdwdS0+c3VibWlzc2lvbjsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5pOTE1OwogCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJaWYgKHdvcmtsb2FkLT5yZXEpCiAJCXJldHVybiAwOwpAQCAtNDIxLDEwICs0MjEsMTAgQEAg
aW50IGludGVsX2d2dF9zY2FuX2FuZF9zaGFkb3dfd29ya2xvYWQoc3RydWN0IGludGVsX3ZncHVf
d29ya2xvYWQgKndvcmtsb2FkKQogewogCXN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1ID0gd29ya2xv
YWQtPnZncHU7CiAJc3RydWN0IGludGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJt
aXNzaW9uOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+
ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2Z3B1LT5ndnQtPmk5
MTU7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAogCWlmICh3b3JrbG9hZC0+c2hhZG93KQogCQlyZXR1cm4gMDsKQEAgLTU3Nyw3ICs1Nzcs
NyBAQCBzdGF0aWMgaW50IHByZXBhcmVfc2hhZG93X3dhX2N0eChzdHJ1Y3QgaW50ZWxfc2hhZG93
X3dhX2N0eCAqd2FfY3R4KQogc3RhdGljIHZvaWQgcmVsZWFzZV9zaGFkb3dfYmF0Y2hfYnVmZmVy
KHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCkKIHsKIAlzdHJ1Y3QgaW50ZWxf
dmdwdSAqdmdwdSA9IHdvcmtsb2FkLT52Z3B1OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB2Z3B1LT5ndnQtPmk5MTU7CiAJc3RydWN0IGludGVsX3ZncHVfc2hhZG93X2JiICpi
YiwgKnBvczsKIAogCWlmIChsaXN0X2VtcHR5KCZ3b3JrbG9hZC0+c2hhZG93X2JiKSkKQEAgLTU4
Niw3ICs1ODYsNyBAQCBzdGF0aWMgdm9pZCByZWxlYXNlX3NoYWRvd19iYXRjaF9idWZmZXIoc3Ry
dWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogCWJiID0gbGlzdF9maXJzdF9lbnRy
eSgmd29ya2xvYWQtPnNoYWRvd19iYiwKIAkJCXN0cnVjdCBpbnRlbF92Z3B1X3NoYWRvd19iYiwg
bGlzdCk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5
X3NhZmUoYmIsIHBvcywgJndvcmtsb2FkLT5zaGFkb3dfYmIsIGxpc3QpIHsKIAkJaWYgKGJiLT5v
YmopIHsKQEAgLTYwNiw3ICs2MDYsNyBAQCBzdGF0aWMgdm9pZCByZWxlYXNlX3NoYWRvd19iYXRj
aF9idWZmZXIoc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogCQlrZnJlZShi
Yik7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIH0KIAogc3RhdGljIGludCBw
cmVwYXJlX3dvcmtsb2FkKHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCkKQEAg
LTY3MSw3ICs2NzEsNyBAQCBzdGF0aWMgaW50IHByZXBhcmVfd29ya2xvYWQoc3RydWN0IGludGVs
X3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogc3RhdGljIGludCBkaXNwYXRjaF93b3JrbG9hZChz
dHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiB7CiAJc3RydWN0IGludGVsX3Zn
cHUgKnZncHUgPSB3b3JrbG9hZC0+dmdwdTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdmdwdS0+Z3Z0LT5pOTE1OwogCXN0cnVjdCBpbnRlbF92Z3B1X3N1Ym1pc3Npb24gKnMg
PSAmdmdwdS0+c3VibWlzc2lvbjsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlpbnQgcmlu
Z19pZCA9IHdvcmtsb2FkLT5yaW5nX2lkOwpAQCAtNjgxLDcgKzY4MSw3IEBAIHN0YXRpYyBpbnQg
ZGlzcGF0Y2hfd29ya2xvYWQoc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQog
CQlyaW5nX2lkLCB3b3JrbG9hZCk7CiAKIAltdXRleF9sb2NrKCZ2Z3B1LT52Z3B1X2xvY2spOwot
CW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldCA9IHNldF9jb250ZXh0X3BwZ3R0X2Zyb21f
c2hhZG93KHdvcmtsb2FkLAogCQkJCQkgICAgcy0+c2hhZG93W3JpbmdfaWRdLT5nZW1fY29udGV4
dCk7CkBAIC03MjMsNyArNzIzLDcgQEAgc3RhdGljIGludCBkaXNwYXRjaF93b3JrbG9hZChzdHJ1
Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiBlcnJfcmVxOgogCWlmIChyZXQpCiAJ
CXdvcmtsb2FkLT5zdGF0dXMgPSByZXQ7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlt
dXRleF91bmxvY2soJnZncHUtPnZncHVfbG9jayk7CiAJcmV0dXJuIHJldDsKIH0KQEAgLTc5Niw3
ICs3OTYsNyBAQCBzdGF0aWMgdm9pZCB1cGRhdGVfZ3Vlc3RfY29udGV4dChzdHJ1Y3QgaW50ZWxf
dmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiAJdm9pZCAqc3JjOwogCXVuc2lnbmVkIGxvbmcgY29u
dGV4dF9ncGEsIGNvbnRleHRfcGFnZV9udW07CiAJaW50IGk7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZ3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGd2dC0+aTkxNTsKIAl1MzIgcmluZ19iYXNlOwogCXUzMiBoZWFkLCB0YWlsOwog
CXUxNiB3cmFwX2NvdW50OwpAQCAtODE3LDE0ICs4MTcsMTQgQEAgc3RhdGljIHZvaWQgdXBkYXRl
X2d1ZXN0X2NvbnRleHQoc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogCiAJ
aGVhZCA9ICh3cmFwX2NvdW50IDw8IFJCX0hFQURfV1JBUF9DTlRfT0ZGKSB8IHRhaWw7CiAKLQly
aW5nX2Jhc2UgPSBkZXZfcHJpdi0+ZW5naW5lW3dvcmtsb2FkLT5yaW5nX2lkXS0+bW1pb19iYXNl
OworCXJpbmdfYmFzZSA9IGk5MTUtPmVuZ2luZVt3b3JrbG9hZC0+cmluZ19pZF0tPm1taW9fYmFz
ZTsKIAl2Z3B1X3ZyZWdfdCh2Z3B1LCBSSU5HX1RBSUwocmluZ19iYXNlKSkgPSB0YWlsOwogCXZn
cHVfdnJlZ190KHZncHUsIFJJTkdfSEVBRChyaW5nX2Jhc2UpKSA9IGhlYWQ7CiAKIAljb250ZXh0
X3BhZ2VfbnVtID0gcnEtPmVuZ2luZS0+Y29udGV4dF9zaXplOwogCWNvbnRleHRfcGFnZV9udW0g
PSBjb250ZXh0X3BhZ2VfbnVtID4+IFBBR0VfU0hJRlQ7CiAKLQlpZiAoSVNfQlJPQURXRUxMKGd2
dC0+ZGV2X3ByaXYpICYmIHJxLT5lbmdpbmUtPmlkID09IFJDUzApCisJaWYgKElTX0JST0FEV0VM
TChndnQtPmk5MTUpICYmIHJxLT5lbmdpbmUtPmlkID09IFJDUzApCiAJCWNvbnRleHRfcGFnZV9u
dW0gPSAxOTsKIAogCWkgPSAyOwpAQCAtODc1LDEzICs4NzUsMTMgQEAgdm9pZCBpbnRlbF92Z3B1
X2NsZWFuX3dvcmtsb2FkcyhzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwKIAkJCQlpbnRlbF9lbmdp
bmVfbWFza190IGVuZ2luZV9tYXNrKQogewogCXN0cnVjdCBpbnRlbF92Z3B1X3N1Ym1pc3Npb24g
KnMgPSAmdmdwdS0+c3VibWlzc2lvbjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdmdwdS0+Z3Z0LT5pOTE1OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlz
dHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqcG9zLCAqbjsKIAlpbnRlbF9lbmdpbmVfbWFza190
IHRtcDsKIAogCS8qIGZyZWUgdGhlIHVuc3VibWl0ZWQgd29ya2xvYWRzIGluIHRoZSBxdWV1ZXMu
ICovCi0JZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGRldl9wcml2LCBlbmdpbmVfbWFz
aywgdG1wKSB7CisJZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGk5MTUsIGVuZ2luZV9t
YXNrLCB0bXApIHsKIAkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHBvcywgbiwKIAkJCSZzLT53
b3JrbG9hZF9xX2hlYWRbZW5naW5lLT5pZF0sIGxpc3QpIHsKIAkJCWxpc3RfZGVsX2luaXQoJnBv
cy0+bGlzdCk7CkBAIC05ODYsNyArOTg2LDcgQEAgc3RhdGljIGludCB3b3JrbG9hZF90aHJlYWQo
dm9pZCAqcHJpdikKIAlzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQgPSBOVUxM
OwogCXN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1ID0gTlVMTDsKIAlpbnQgcmV0OwotCWJvb2wgbmVl
ZF9mb3JjZV93YWtlID0gKElOVEVMX0dFTihndnQtPmRldl9wcml2KSA+PSA5KTsKKwlib29sIG5l
ZWRfZm9yY2Vfd2FrZSA9IChJTlRFTF9HRU4oZ3Z0LT5pOTE1KSA+PSA5KTsKIAlERUZJTkVfV0FJ
VF9GVU5DKHdhaXQsIHdva2VuX3dha2VfZnVuY3Rpb24pOwogCiAJa2ZyZWUocCk7CkBAIC0xMDE1
LDcgKzEwMTUsNyBAQCBzdGF0aWMgaW50IHdvcmtsb2FkX3RocmVhZCh2b2lkICpwcml2KQogCQkJ
CXdvcmtsb2FkLT5yaW5nX2lkLCB3b3JrbG9hZCk7CiAKIAkJaWYgKG5lZWRfZm9yY2Vfd2FrZSkK
LQkJCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZndnQtPmRldl9wcml2LT51bmNvcmUsCisJ
CQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmZ3Z0LT5pOTE1LT51bmNvcmUsCiAJCQkJCUZP
UkNFV0FLRV9BTEwpOwogCiAJCXJldCA9IGRpc3BhdGNoX3dvcmtsb2FkKHdvcmtsb2FkKTsKQEAg
LTEwMzcsNyArMTAzNyw3IEBAIHN0YXRpYyBpbnQgd29ya2xvYWRfdGhyZWFkKHZvaWQgKnByaXYp
CiAJCWNvbXBsZXRlX2N1cnJlbnRfd29ya2xvYWQoZ3Z0LCByaW5nX2lkKTsKIAogCQlpZiAobmVl
ZF9mb3JjZV93YWtlKQotCQkJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmd2dC0+ZGV2X3By
aXYtPnVuY29yZSwKKwkJCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZndnQtPmk5MTUtPnVu
Y29yZSwKIAkJCQkJRk9SQ0VXQUtFX0FMTCk7CiAKIAkJaWYgKHJldCAmJiAodmdwdV9pc192bV91
bmhlYWx0aHkocmV0KSkpCkBAIC0xMDY4LDcgKzEwNjgsNyBAQCB2b2lkIGludGVsX2d2dF9jbGVh
bl93b3JrbG9hZF9zY2hlZHVsZXIoc3RydWN0IGludGVsX2d2dCAqZ3Z0KQogCiAJZ3Z0X2RiZ19j
b3JlKCJjbGVhbiB3b3JrbG9hZCBzY2hlZHVsZXJcbiIpOwogCi0JZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgZ3Z0LT5kZXZfcHJpdiwgaSkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd2dC0+
aTkxNSwgaSkgewogCQlhdG9taWNfbm90aWZpZXJfY2hhaW5fdW5yZWdpc3RlcigKIAkJCQkJJmVu
Z2luZS0+Y29udGV4dF9zdGF0dXNfbm90aWZpZXIsCiAJCQkJCSZndnQtPnNoYWRvd19jdHhfbm90
aWZpZXJfYmxvY2tbaV0pOwpAQCAtMTA4OCw3ICsxMDg4LDcgQEAgaW50IGludGVsX2d2dF9pbml0
X3dvcmtsb2FkX3NjaGVkdWxlcihzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiAKIAlpbml0X3dhaXRx
dWV1ZV9oZWFkKCZzY2hlZHVsZXItPndvcmtsb2FkX2NvbXBsZXRlX3dxKTsKIAotCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGd2dC0+ZGV2X3ByaXYsIGkpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBndnQtPmk5MTUsIGkpIHsKIAkJaW5pdF93YWl0cXVldWVfaGVhZCgmc2NoZWR1bGVyLT53
YWl0cVtpXSk7CiAKIAkJcGFyYW0gPSBremFsbG9jKHNpemVvZigqcGFyYW0pLCBHRlBfS0VSTkVM
KTsKQEAgLTExNTIsNyArMTE1Miw3IEBAIHZvaWQgaW50ZWxfdmdwdV9jbGVhbl9zdWJtaXNzaW9u
KHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCWludGVsX3ZncHVfc2VsZWN0X3N1Ym1pc3Npb25f
b3BzKHZncHUsIEFMTF9FTkdJTkVTLCAwKTsKIAogCWk5MTVfY29udGV4dF9wcGd0dF9yb290X3Jl
c3RvcmUocywgaTkxNV92bV90b19wcGd0dChzLT5zaGFkb3dbMF0tPmdlbV9jb250ZXh0LT52bSkp
OwotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIHZncHUtPmd2dC0+ZGV2X3ByaXYsIGlkKQorCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIHZncHUtPmd2dC0+aTkxNSwgaWQpCiAJCWludGVsX2NvbnRl
eHRfdW5waW4ocy0+c2hhZG93W2lkXSk7CiAKIAlrbWVtX2NhY2hlX2Rlc3Ryb3kocy0+d29ya2xv
YWRzKTsKQEAgLTEyMTIsMTMgKzEyMTIsMTMgQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlz
c2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpOwog
CWludCByZXQ7CiAKLQljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9ndnQoJnZncHUtPmd2
dC0+ZGV2X3ByaXYtPmRybSk7CisJY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfZ3Z0KCZ2
Z3B1LT5ndnQtPmk5MTUtPmRybSk7CiAJaWYgKElTX0VSUihjdHgpKQogCQlyZXR1cm4gUFRSX0VS
UihjdHgpOwogCiAJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBpOTE1X3ZtX3RvX3Bw
Z3R0KGN0eC0+dm0pKTsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIHZncHUtPmd2dC0+ZGV2
X3ByaXYsIGkpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCB2Z3B1LT5ndnQtPmk5MTUsIGkp
IHsKIAkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCiAJCUlOSVRfTElTVF9IRUFEKCZzLT53
b3JrbG9hZF9xX2hlYWRbaV0pOwpAQCAtMTI2MCw3ICsxMjYwLDcgQEAgaW50IGludGVsX3ZncHVf
c2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAogb3V0X3NoYWRvd19j
dHg6CiAJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3RfcmVzdG9yZShzLCBpOTE1X3ZtX3RvX3BwZ3R0
KGN0eC0+dm0pKTsKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCB2Z3B1LT5ndnQtPmRldl9wcml2
LCBpKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgdmdwdS0+Z3Z0LT5pOTE1LCBpKSB7CiAJ
CWlmIChJU19FUlIocy0+c2hhZG93W2ldKSkKIAkJCWJyZWFrOwogCkBAIC0xNDM5LDcgKzE0Mzks
NyBAQCBpbnRlbF92Z3B1X2NyZWF0ZV93b3JrbG9hZChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwg
aW50IHJpbmdfaWQsCiAJc3RydWN0IGxpc3RfaGVhZCAqcSA9IHdvcmtsb2FkX3FfaGVhZCh2Z3B1
LCByaW5nX2lkKTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqbGFzdF93b3JrbG9hZCA9
IGdldF9sYXN0X3dvcmtsb2FkKHEpOwogCXN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3Jr
bG9hZCA9IE5VTEw7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+
Z3Z0LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2
dC0+aTkxNTsKIAl1NjQgcmluZ19jb250ZXh0X2dwYTsKIAl1MzIgaGVhZCwgdGFpbCwgc3RhcnQs
IGN0bCwgY3R4X2N0bCwgcGVyX2N0eCwgaW5kaXJlY3RfY3R4OwogCXUzMiBndWVzdF9oZWFkOwpA
QCAtMTUyNiwxMSArMTUyNiwxMSBAQCBpbnRlbF92Z3B1X2NyZWF0ZV93b3JrbG9hZChzdHJ1Y3Qg
aW50ZWxfdmdwdSAqdmdwdSwgaW50IHJpbmdfaWQsCiAJICogYXMgdGhlcmUgaXMgb25seSBvbmUg
cHJlLWFsbG9jYXRlZCBidWYtb2JqIGZvciBzaGFkb3cuCiAJICovCiAJaWYgKGxpc3RfZW1wdHko
d29ya2xvYWRfcV9oZWFkKHZncHUsIHJpbmdfaWQpKSkgewotCQlpbnRlbF9ydW50aW1lX3BtX2dl
dChkZXZfcHJpdik7Ci0JCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsK
KwkJaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CisJCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCQlyZXQgPSBpbnRlbF9ndnRfc2Nhbl9hbmRfc2hhZG93X3dvcmtsb2Fk
KHdvcmtsb2FkKTsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0JCWludGVsX3J1bnRpbWVfcG1fcHV0X3VuY2hlY2tlZChkZXZfcHJpdik7CisJCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWludGVsX3J1bnRpbWVfcG1fcHV0X3Vu
Y2hlY2tlZChpOTE1KTsKIAl9CiAKIAlpZiAocmV0KSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvdmdwdS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3ZncHUuYwpp
bmRleCA0NGNlM2MyYjlhYzEuLmEzMTE3MzdjOTYzMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L3ZncHUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvdmdwdS5j
CkBAIC0xNDgsMTAgKzE0OCwxMCBAQCBpbnQgaW50ZWxfZ3Z0X2luaXRfdmdwdV90eXBlcyhzdHJ1
Y3QgaW50ZWxfZ3Z0ICpndnQpCiAJCWd2dC0+dHlwZXNbaV0uYXZhaWxfaW5zdGFuY2UgPSBtaW4o
bG93X2F2YWlsIC8gdmdwdV90eXBlc1tpXS5sb3dfbW0sCiAJCQkJCQkgICBoaWdoX2F2YWlsIC8g
dmdwdV90eXBlc1tpXS5oaWdoX21tKTsKIAotCQlpZiAoSVNfR0VOKGd2dC0+ZGV2X3ByaXYsIDgp
KQorCQlpZiAoSVNfR0VOKGd2dC0+aTkxNSwgOCkpCiAJCQlzcHJpbnRmKGd2dC0+dHlwZXNbaV0u
bmFtZSwgIkdWVGdfVjRfJXMiLAogCQkJCQkJdmdwdV90eXBlc1tpXS5uYW1lKTsKLQkJZWxzZSBp
ZiAoSVNfR0VOKGd2dC0+ZGV2X3ByaXYsIDkpKQorCQllbHNlIGlmIChJU19HRU4oZ3Z0LT5pOTE1
LCA5KSkKIAkJCXNwcmludGYoZ3Z0LT50eXBlc1tpXS5uYW1lLCAiR1ZUZ19WNV8lcyIsCiAJCQkJ
CQl2Z3B1X3R5cGVzW2ldLm5hbWUpOwogCkBAIC00MjksNyArNDI5LDcgQEAgc3RhdGljIHN0cnVj
dCBpbnRlbF92Z3B1ICpfX2ludGVsX2d2dF9jcmVhdGVfdmdwdShzdHJ1Y3QgaW50ZWxfZ3Z0ICpn
dnQsCiAJCWdvdG8gb3V0X2NsZWFuX3NjaGVkX3BvbGljeTsKIAogCS8qVE9ETzogYWRkIG1vcmUg
cGxhdGZvcm1zIHN1cHBvcnQgKi8KLQlpZiAoSVNfU0tZTEFLRShndnQtPmRldl9wcml2KSB8fCBJ
U19LQUJZTEFLRShndnQtPmRldl9wcml2KSkKKwlpZiAoSVNfU0tZTEFLRShndnQtPmk5MTUpIHx8
IElTX0tBQllMQUtFKGd2dC0+aTkxNSkpCiAJCXJldCA9IGludGVsX2d2dF9oeXBlcnZpc29yX3Nl
dF9lZGlkKHZncHUsIFBPUlRfRCk7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfY2xlYW5fc2NoZWRf
cG9saWN5OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9jbWRfcGFyc2Vy
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2NtZF9wYXJzZXIuYwppbmRleCBhMjhiY2Qy
ZDdjMDkuLmU5ZDA3NjE2N2IyNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9jbWRfcGFyc2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9jbWRfcGFyc2Vy
LmMKQEAgLTEzNDIsMjEgKzEzNDIsMjEgQEAgaW50IGludGVsX2VuZ2luZV9jbWRfcGFyc2VyKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAogLyoqCiAgKiBpOTE1X2NtZF9wYXJzZXJf
Z2V0X3ZlcnNpb24oKSAtIGdldCB0aGUgY21kIHBhcnNlciB2ZXJzaW9uIG51bWJlcgotICogQGRl
dl9wcml2OiBpOTE1IGRldmljZSBwcml2YXRlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgcHJpdmF0
ZQogICoKICAqIFRoZSBjbWQgcGFyc2VyIG1haW50YWlucyBhIHNpbXBsZSBpbmNyZWFzaW5nIGlu
dGVnZXIgdmVyc2lvbiBudW1iZXIgc3VpdGFibGUKICAqIGZvciBwYXNzaW5nIHRvIHVzZXJzcGFj
ZSBjbGllbnRzIHRvIGRldGVybWluZSB3aGF0IG9wZXJhdGlvbnMgYXJlIHBlcm1pdHRlZC4KICAq
CiAgKiBSZXR1cm46IHRoZSBjdXJyZW50IHZlcnNpb24gbnVtYmVyIG9mIHRoZSBjbWQgcGFyc2Vy
CiAgKi8KLWludCBpOTE1X2NtZF9wYXJzZXJfZ2V0X3ZlcnNpb24oc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQoraW50IGk5MTVfY21kX3BhcnNlcl9nZXRfdmVyc2lvbihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJYm9vbCBhY3RpdmUgPSBmYWxzZTsKIAog
CS8qIElmIHRoZSBjb21tYW5kIHBhcnNlciBpcyBub3QgZW5hYmxlZCwgcmVwb3J0IDAgLSB1bnN1
cHBvcnRlZCAqLwotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgeworCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCWlmIChpbnRlbF9lbmdpbmVfbmVl
ZHNfY21kX3BhcnNlcihlbmdpbmUpKSB7CiAJCQlhY3RpdmUgPSB0cnVlOwogCQkJYnJlYWs7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDAyNmZiNDYwMjBmNi4uZmVjMDE4NTg2
ODVkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtNTUsMTcgKzU1LDE3IEBA
IHN0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm5vZGVfdG9faTkxNShzdHJ1
Y3QgZHJtX2luZm9fbm9kZSAqbm9kZSkKIAogc3RhdGljIGludCBpOTE1X2NhcGFiaWxpdGllcyhz
dHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCWNvbnN0IHN0cnVjdCBp
bnRlbF9kZXZpY2VfaW5mbyAqaW5mbyA9IElOVEVMX0lORk8oZGV2X3ByaXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCWNvbnN0
IHN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyAqaW5mbyA9IElOVEVMX0lORk8oaTkxNSk7CiAJc3Ry
dWN0IGRybV9wcmludGVyIHAgPSBkcm1fc2VxX2ZpbGVfcHJpbnRlcihtKTsKIAotCXNlcV9wcmlu
dGYobSwgImdlbjogJWRcbiIsIElOVEVMX0dFTihkZXZfcHJpdikpOworCXNlcV9wcmludGYobSwg
ImdlbjogJWRcbiIsIElOVEVMX0dFTihpOTE1KSk7CiAJc2VxX3ByaW50ZihtLCAicGxhdGZvcm06
ICVzXG4iLCBpbnRlbF9wbGF0Zm9ybV9uYW1lKGluZm8tPnBsYXRmb3JtKSk7Ci0Jc2VxX3ByaW50
ZihtLCAicGNoOiAlZFxuIiwgSU5URUxfUENIX1RZUEUoZGV2X3ByaXYpKTsKKwlzZXFfcHJpbnRm
KG0sICJwY2g6ICVkXG4iLCBJTlRFTF9QQ0hfVFlQRShpOTE1KSk7CiAKIAlpbnRlbF9kZXZpY2Vf
aW5mb19kdW1wX2ZsYWdzKGluZm8sICZwKTsKLQlpbnRlbF9kZXZpY2VfaW5mb19kdW1wX3J1bnRp
bWUoUlVOVElNRV9JTkZPKGRldl9wcml2KSwgJnApOwotCWludGVsX2RyaXZlcl9jYXBzX3ByaW50
KCZkZXZfcHJpdi0+Y2FwcywgJnApOworCWludGVsX2RldmljZV9pbmZvX2R1bXBfcnVudGltZShS
VU5USU1FX0lORk8oaTkxNSksICZwKTsKKwlpbnRlbF9kcml2ZXJfY2Fwc19wcmludCgmaTkxNS0+
Y2FwcywgJnApOwogCiAJa2VybmVsX3BhcmFtX2xvY2soVEhJU19NT0RVTEUpOwogCWk5MTVfcGFy
YW1zX2R1bXAoJmk5MTVfbW9kcGFyYW1zLCAmcCk7CkBAIC0xMzcsNyArMTM3LDcgQEAgc3RyaW5n
aWZ5X3BhZ2Vfc2l6ZXModW5zaWduZWQgaW50IHBhZ2Vfc2l6ZXMsIGNoYXIgKmJ1Ziwgc2l6ZV90
IGxlbikKIHN0YXRpYyB2b2lkCiBkZXNjcmliZV9vYmooc3RydWN0IHNlcV9maWxlICptLCBzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1bnNpZ25lZCBpbnQgZnJv
bnRidWZmZXJfYml0czsKQEAgLTE1NSw3ICsxNTUsNyBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNl
cV9maWxlICptLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCQkgICBvYmotPmJh
c2Uuc2l6ZSAvIDEwMjQsCiAJCSAgIG9iai0+cmVhZF9kb21haW5zLAogCQkgICBvYmotPndyaXRl
X2RvbWFpbiwKLQkJICAgaTkxNV9jYWNoZV9sZXZlbF9zdHIoZGV2X3ByaXYsIG9iai0+Y2FjaGVf
bGV2ZWwpLAorCQkgICBpOTE1X2NhY2hlX2xldmVsX3N0cihpOTE1LCBvYmotPmNhY2hlX2xldmVs
KSwKIAkJICAgb2JqLT5tbS5kaXJ0eSA/ICIgZGlydHkiIDogIiIsCiAJCSAgIG9iai0+bW0ubWFk
diA9PSBJOTE1X01BRFZfRE9OVE5FRUQgPyAiIHB1cmdlYWJsZSIgOiAiIik7CiAJaWYgKG9iai0+
YmFzZS5uYW1lKQpAQCAtMjk2LDcgKzI5Niw3IEBAIHN0YXRpYyBpbnQgcGVyX2ZpbGVfc3RhdHMo
aW50IGlkLCB2b2lkICpwdHIsIHZvaWQgKmRhdGEpCiB9IHdoaWxlICgwKQogCiBzdGF0aWMgdm9p
ZCBwcmludF9iYXRjaF9wb29sX3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKLQkJCQkgICBzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCisJCQkJICAgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CkBAIC0zMDQsNyArMzA0LDcgQEAgc3RhdGljIHZv
aWQgcHJpbnRfYmF0Y2hfcG9vbF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJZW51bSBpbnRl
bF9lbmdpbmVfaWQgaWQ7CiAJaW50IGo7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBkZXZf
cHJpdiwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQlmb3Ig
KGogPSAwOyBqIDwgQVJSQVlfU0laRShlbmdpbmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlzdCk7IGor
KykgewogCQkJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosCiAJCQkJCSAgICAmZW5naW5lLT5iYXRj
aF9wb29sLmNhY2hlX2xpc3Rbal0sCkBAIC0zODIsOCArMzgyLDggQEAgc3RhdGljIGludCBpOTE1
X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIHN0YXRp
YyBpbnQgaTkxNV9nZW1fYmF0Y2hfcG9vbF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAq
ZGF0YSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5
MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJt
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZh
dGUpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwog
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwpAQCAtMzk0LDcgKzM5NCw3IEBAIHN0YXRpYyBpbnQg
aTkxNV9nZW1fYmF0Y2hfcG9vbF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkK
IAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZGV2
X3ByaXYsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJZm9y
IChqID0gMDsgaiA8IEFSUkFZX1NJWkUoZW5naW5lLT5iYXRjaF9wb29sLmNhY2hlX2xpc3QpOyBq
KyspIHsKIAkJCWludCBjb3VudDsKIApAQCAtNDI3LDE1ICs0MjcsMTUgQEAgc3RhdGljIGludCBp
OTE1X2dlbV9iYXRjaF9wb29sX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQog
CiBzdGF0aWMgdm9pZCBnZW44X2Rpc3BsYXlfaW50ZXJydXB0X2luZm8oc3RydWN0IHNlcV9maWxl
ICptKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkx
NShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9f
aTkxNShtLT5wcml2YXRlKTsKIAlpbnQgcGlwZTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYs
IHBpcGUpIHsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJZW51bSBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CiAJCWludGVsX3dha2VyZWZfdCB3YWtlcmVm
OwogCiAJCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9QSVBFKHBpcGUpOwotCQl3YWtlcmVm
ID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZfcHJpdiwKKwkJd2FrZXJl
ZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwKIAkJCQkJCQkgICAg
IHBvd2VyX2RvbWFpbik7CiAJCWlmICghd2FrZXJlZikgewogCQkJc2VxX3ByaW50ZihtLCAiUGlw
ZSAlYyBwb3dlciBkaXNhYmxlZFxuIiwKQEAgLTQ1Miw3ICs0NTIsNyBAQCBzdGF0aWMgdm9pZCBn
ZW44X2Rpc3BsYXlfaW50ZXJydXB0X2luZm8oc3RydWN0IHNlcV9maWxlICptKQogCQkJICAgcGlw
ZV9uYW1lKHBpcGUpLAogCQkJICAgSTkxNV9SRUFEKEdFTjhfREVfUElQRV9JRVIocGlwZSkpKTsK
IAotCQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgcG93ZXJfZG9tYWluLCB3YWtl
cmVmKTsKKwkJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgcG93ZXJfZG9tYWluLCB3YWtl
cmVmKTsKIAl9CiAKIAlzZXFfcHJpbnRmKG0sICJEaXNwbGF5IEVuZ2luZSBwb3J0IGludGVycnVw
dCBtYXNrOlx0JTA4eFxuIiwKQEAgLTQ3OSwxNSArNDc5LDE1IEBAIHN0YXRpYyB2b2lkIGdlbjhf
ZGlzcGxheV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAKIHN0YXRpYyBpbnQg
aTkxNV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZh
dGUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnBy
aXZhdGUpOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2Vu
Z2luZV9pZCBpZDsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlpbnQgaSwgcGlwZTsKIAot
CXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChkZXZfcHJpdik7CisJd2FrZXJlZiA9IGlu
dGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwogCi0JaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYp
KSB7CisJaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJaW50ZWxfd2FrZXJlZl90IHByZWY7
CiAKIAkJc2VxX3ByaW50ZihtLCAiTWFzdGVyIEludGVycnVwdCBDb250cm9sOlx0JTA4eFxuIiwK
QEAgLTUwMSwxMSArNTAxLDExIEBAIHN0YXRpYyBpbnQgaTkxNV9pbnRlcnJ1cHRfaW5mbyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJCQkgICBJOTE1X1JFQUQoVkxWX0lJUl9SVykp
OwogCQlzZXFfcHJpbnRmKG0sICJEaXNwbGF5IElNUjpcdCUwOHhcbiIsCiAJCQkgICBJOTE1X1JF
QUQoVkxWX0lNUikpOwotCQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBwaXBlKSB7CisJCWZvcl9l
YWNoX3BpcGUoaTkxNSwgcGlwZSkgewogCQkJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFp
biBwb3dlcl9kb21haW47CiAKIAkJCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9QSVBFKHBp
cGUpOwotCQkJcHJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3By
aXYsCisJCQlwcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChpOTE1LAog
CQkJCQkJCQkgIHBvd2VyX2RvbWFpbik7CiAJCQlpZiAoIXByZWYpIHsKIAkJCQlzZXFfcHJpbnRm
KG0sICJQaXBlICVjIHBvd2VyIGRpc2FibGVkXG4iLApAQCAtNTE3LDE3ICs1MTcsMTcgQEAgc3Rh
dGljIGludCBpOTE1X2ludGVycnVwdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0
YSkKIAkJCQkgICBwaXBlX25hbWUocGlwZSksCiAJCQkJICAgSTkxNV9SRUFEKFBJUEVTVEFUKHBp
cGUpKSk7CiAKLQkJCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBwb3dlcl9kb21h
aW4sIHByZWYpOworCQkJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgcG93ZXJfZG9tYWlu
LCBwcmVmKTsKIAkJfQogCi0JCXByZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJp
diwgUE9XRVJfRE9NQUlOX0lOSVQpOworCQlwcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQo
aTkxNSwgUE9XRVJfRE9NQUlOX0lOSVQpOwogCQlzZXFfcHJpbnRmKG0sICJQb3J0IGhvdHBsdWc6
XHQlMDh4XG4iLAogCQkJICAgSTkxNV9SRUFEKFBPUlRfSE9UUExVR19FTikpOwogCQlzZXFfcHJp
bnRmKG0sICJEUEZMSVBTVEFUOlx0JTA4eFxuIiwKIAkJCSAgIEk5MTVfUkVBRChWTFZfRFBGTElQ
U1RBVCkpOwogCQlzZXFfcHJpbnRmKG0sICJEUElOVkdUVDpcdCUwOHhcbiIsCiAJCQkgICBJOTE1
X1JFQUQoRFBJTlZHVFQpKTsKLQkJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBP
V0VSX0RPTUFJTl9JTklULCBwcmVmKTsKKwkJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwg
UE9XRVJfRE9NQUlOX0lOSVQsIHByZWYpOwogCiAJCWZvciAoaSA9IDA7IGkgPCA0OyBpKyspIHsK
IAkJCXNlcV9wcmludGYobSwgIkdUIEludGVycnVwdCBJTVIgJWQ6XHQlMDh4XG4iLApAQCAtNTQ0
LDcgKzU0NCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKmRhdGEpCiAJCQkgICBJOTE1X1JFQUQoR0VOOF9QQ1VfSUlSKSk7CiAJCXNl
cV9wcmludGYobSwgIlBDVSBpbnRlcnJ1cHQgZW5hYmxlOlx0JTA4eFxuIiwKIAkJCSAgIEk5MTVf
UkVBRChHRU44X1BDVV9JRVIpKTsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTEpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewogCQlzZXFfcHJpbnRm
KG0sICJNYXN0ZXIgSW50ZXJydXB0IENvbnRyb2w6ICAlMDh4XG4iLAogCQkJICAgSTkxNV9SRUFE
KEdFTjExX0dGWF9NU1RSX0lSUSkpOwogCkBAIC01NjUsNyArNTY1LDcgQEAgc3RhdGljIGludCBp
OTE1X2ludGVycnVwdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAkJCSAg
IEk5MTVfUkVBRChHRU4xMV9ESVNQTEFZX0lOVF9DVEwpKTsKIAogCQlnZW44X2Rpc3BsYXlfaW50
ZXJydXB0X2luZm8obSk7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpIHsK
Kwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KSB7CiAJCXNlcV9wcmludGYobSwgIk1h
c3RlciBJbnRlcnJ1cHQgQ29udHJvbDpcdCUwOHhcbiIsCiAJCQkgICBJOTE1X1JFQUQoR0VOOF9N
QVNURVJfSVJRKSk7CiAKQEAgLTU3OSw3ICs1NzksNyBAQCBzdGF0aWMgaW50IGk5MTVfaW50ZXJy
dXB0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQl9CiAKIAkJZ2VuOF9k
aXNwbGF5X2ludGVycnVwdF9pbmZvKG0pOwotCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZf
cHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkpIHsKIAkJc2VxX3ByaW50
ZihtLCAiRGlzcGxheSBJRVI6XHQlMDh4XG4iLAogCQkJICAgSTkxNV9SRUFEKFZMVl9JRVIpKTsK
IAkJc2VxX3ByaW50ZihtLCAiRGlzcGxheSBJSVI6XHQlMDh4XG4iLApAQCAtNTg4LDEyICs1ODgs
MTIgQEAgc3RhdGljIGludCBpOTE1X2ludGVycnVwdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwg
dm9pZCAqZGF0YSkKIAkJCSAgIEk5MTVfUkVBRChWTFZfSUlSX1JXKSk7CiAJCXNlcV9wcmludGYo
bSwgIkRpc3BsYXkgSU1SOlx0JTA4eFxuIiwKIAkJCSAgIEk5MTVfUkVBRChWTFZfSU1SKSk7Ci0J
CWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpIHsKKwkJZm9yX2VhY2hfcGlwZShpOTE1LCBw
aXBlKSB7CiAJCQllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIHBvd2VyX2RvbWFpbjsK
IAkJCWludGVsX3dha2VyZWZfdCBwcmVmOwogCiAJCQlwb3dlcl9kb21haW4gPSBQT1dFUl9ET01B
SU5fUElQRShwaXBlKTsKLQkJCXByZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFi
bGVkKGRldl9wcml2LAorCQkJcHJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJs
ZWQoaTkxNSwKIAkJCQkJCQkJICBwb3dlcl9kb21haW4pOwogCQkJaWYgKCFwcmVmKSB7CiAJCQkJ
c2VxX3ByaW50ZihtLCAiUGlwZSAlYyBwb3dlciBkaXNhYmxlZFxuIiwKQEAgLTYwNCw3ICs2MDQs
NyBAQCBzdGF0aWMgaW50IGk5MTVfaW50ZXJydXB0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQogCQkJc2VxX3ByaW50ZihtLCAiUGlwZSAlYyBzdGF0Olx0JTA4eFxuIiwKIAkJ
CQkgICBwaXBlX25hbWUocGlwZSksCiAJCQkJICAgSTkxNV9SRUFEKFBJUEVTVEFUKHBpcGUpKSk7
Ci0JCQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgcG93ZXJfZG9tYWluLCBwcmVm
KTsKKwkJCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsIHBvd2VyX2RvbWFpbiwgcHJlZik7
CiAJCX0KIAogCQlzZXFfcHJpbnRmKG0sICJNYXN0ZXIgSUVSOlx0JTA4eFxuIiwKQEAgLTYzMSwx
NCArNjMxLDE0IEBAIHN0YXRpYyBpbnQgaTkxNV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKmRhdGEpCiAJCXNlcV9wcmludGYobSwgIkRQSU5WR1RUOlx0JTA4eFxuIiwK
IAkJCSAgIEk5MTVfUkVBRChEUElOVkdUVCkpOwogCi0JfSBlbHNlIGlmICghSEFTX1BDSF9TUExJ
VChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKCFIQVNfUENIX1NQTElUKGk5MTUpKSB7CiAJCXNl
cV9wcmludGYobSwgIkludGVycnVwdCBlbmFibGU6ICAgICUwOHhcbiIsCiAJCQkgICBJOTE1X1JF
QUQoR0VOMl9JRVIpKTsKIAkJc2VxX3ByaW50ZihtLCAiSW50ZXJydXB0IGlkZW50aXR5OiAgJTA4
eFxuIiwKIAkJCSAgIEk5MTVfUkVBRChHRU4yX0lJUikpOwogCQlzZXFfcHJpbnRmKG0sICJJbnRl
cnJ1cHQgbWFzazogICAgICAlMDh4XG4iLAogCQkJICAgSTkxNV9SRUFEKEdFTjJfSU1SKSk7Ci0J
CWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpCisJCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlw
ZSkKIAkJCXNlcV9wcmludGYobSwgIlBpcGUgJWMgc3RhdDogICAgICAgICAlMDh4XG4iLAogCQkJ
CSAgIHBpcGVfbmFtZShwaXBlKSwKIAkJCQkgICBJOTE1X1JFQUQoUElQRVNUQVQocGlwZSkpKTsK
QEAgLTY2Myw3ICs2NjMsNyBAQCBzdGF0aWMgaW50IGk5MTVfaW50ZXJydXB0X2luZm8oc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQkJICAgSTkxNV9SRUFEKEdUSU1SKSk7CiAJfQog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDExKSB7CiAJCXNlcV9wcmludGYobSwgIlJDUyBJbnRyIE1hc2s6XHQgJTA4eFxuIiwKIAkJ
CSAgIEk5MTVfUkVBRChHRU4xMV9SQ1MwX1JTVkRfSU5UUl9NQVNLKSk7CiAJCXNlcV9wcmludGYo
bSwgIkJDUyBJbnRyIE1hc2s6XHQgJTA4eFxuIiwKQEAgLTY4MywzNSArNjgzLDM1IEBAIHN0YXRp
YyBpbnQgaTkxNV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEp
CiAJCXNlcV9wcmludGYobSwgIkd1bml0L0NTTUUgSW50ciBNYXNrOlx0ICUwOHhcbiIsCiAJCQkg
ICBJOTE1X1JFQUQoR0VOMTFfR1VOSVRfQ1NNRV9JTlRSX01BU0spKTsKIAotCX0gZWxzZSBpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA2KSB7Ci0JCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRl
dl9wcml2LCBpZCkgeworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDYpIHsKKwkJZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJCXNlcV9wcmludGYobSwKIAkJCQkg
ICAiR3JhcGhpY3MgSW50ZXJydXB0IG1hc2sgKCVzKToJJTA4eFxuIiwKIAkJCQkgICBlbmdpbmUt
Pm5hbWUsIEVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19JTVIpKTsKIAkJfQogCX0KIAotCWludGVs
X3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCB3YWtlcmVmKTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1
dChpOTE1LCB3YWtlcmVmKTsKIAogCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IGk5MTVfZ2Vt
X2ZlbmNlX3JlZ3NfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUp
OwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlpbnQgaSwgcmV0OwogCiAJcmV0ID0gbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJaWYgKHJldCkKIAkJ
cmV0dXJuIHJldDsKIAotCXNlcV9wcmludGYobSwgIlRvdGFsIGZlbmNlcyA9ICVkXG4iLCBkZXZf
cHJpdi0+bnVtX2ZlbmNlX3JlZ3MpOwotCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+bnVtX2Zl
bmNlX3JlZ3M7IGkrKykgewotCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGRldl9wcml2LT5mZW5j
ZV9yZWdzW2ldLnZtYTsKKwlzZXFfcHJpbnRmKG0sICJUb3RhbCBmZW5jZXMgPSAlZFxuIiwgaTkx
NS0+bnVtX2ZlbmNlX3JlZ3MpOworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT5udW1fZmVuY2VfcmVn
czsgaSsrKSB7CisJCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gaTkxNS0+ZmVuY2VfcmVnc1tpXS52
bWE7CiAKIAkJc2VxX3ByaW50ZihtLCAiRmVuY2UgJWQsIHBpbiBjb3VudCA9ICVkLCBvYmplY3Qg
PSAiLAotCQkJICAgaSwgZGV2X3ByaXYtPmZlbmNlX3JlZ3NbaV0ucGluX2NvdW50KTsKKwkJCSAg
IGksIGk5MTUtPmZlbmNlX3JlZ3NbaV0ucGluX2NvdW50KTsKIAkJaWYgKCF2bWEpCiAJCQlzZXFf
cHV0cyhtLCAidW51c2VkIik7CiAJCWVsc2UKQEAgLTgyNSwxNSArODI1LDE1IEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVfZXJyb3Jfc3RhdGVfZm9wcyA9IHsKIAog
c3RhdGljIGludCBpOTE1X2ZyZXF1ZW5jeV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAq
dW51c2VkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9f
aTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3By
aXYtPnVuY29yZTsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJw
czsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2
YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOworCXN0
cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZpOTE1LT5ndF9wbS5ycHM7CiAJaW50ZWxfd2FrZXJlZl90
IHdha2VyZWY7CiAJaW50IHJldCA9IDA7CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAot
CWlmIChJU19HRU4oZGV2X3ByaXYsIDUpKSB7CisJaWYgKElTX0dFTihpOTE1LCA1KSkgewogCQl1
MTYgcmd2c3djdGwgPSBpbnRlbF91bmNvcmVfcmVhZDE2KHVuY29yZSwgTUVNU1dDVEwpOwogCQl1
MTYgcmd2c3RhdCA9IGludGVsX3VuY29yZV9yZWFkMTYodW5jb3JlLCBNRU1TVEFUX0lMSyk7CiAK
QEAgLTg0Myw3ICs4NDMsNyBAQCBzdGF0aWMgaW50IGk5MTVfZnJlcXVlbmN5X2luZm8oc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJCQkgICBNRU1TVEFUX1ZJRF9TSElGVCk7CiAJ
CXNlcV9wcmludGYobSwgIkN1cnJlbnQgUC1zdGF0ZTogJWRcbiIsCiAJCQkgICAocmd2c3RhdCAm
IE1FTVNUQVRfUFNUQVRFX01BU0spID4+IE1FTVNUQVRfUFNUQVRFX1NISUZUKTsKLQl9IGVsc2Ug
aWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7
CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkp
IHsKIAkJdTMyIHJwbW9kZWN0bCwgZnJlcV9zdHM7CiAKIAkJcnBtb2RlY3RsID0gSTkxNV9SRUFE
KEdFTjZfUlBfQ09OVFJPTCk7CkBAIC04NTUsMzIgKzg1NSwzMiBAQCBzdGF0aWMgaW50IGk5MTVf
ZnJlcXVlbmN5X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJCQkgICB5
ZXNubygocnBtb2RlY3RsICYgR0VONl9SUF9NRURJQV9NT0RFX01BU0spID09CiAJCQkJICBHRU42
X1JQX01FRElBX1NXX01PREUpKTsKIAotCQl2bHZfcHVuaXRfZ2V0KGRldl9wcml2KTsKLQkJZnJl
cV9zdHMgPSB2bHZfcHVuaXRfcmVhZChkZXZfcHJpdiwgUFVOSVRfUkVHX0dQVV9GUkVRX1NUUyk7
Ci0JCXZsdl9wdW5pdF9wdXQoZGV2X3ByaXYpOworCQl2bHZfcHVuaXRfZ2V0KGk5MTUpOworCQlm
cmVxX3N0cyA9IHZsdl9wdW5pdF9yZWFkKGk5MTUsIFBVTklUX1JFR19HUFVfRlJFUV9TVFMpOwor
CQl2bHZfcHVuaXRfcHV0KGk5MTUpOwogCiAJCXNlcV9wcmludGYobSwgIlBVTklUX1JFR19HUFVf
RlJFUV9TVFM6IDB4JTA4eFxuIiwgZnJlcV9zdHMpOwotCQlzZXFfcHJpbnRmKG0sICJERFIgZnJl
cTogJWQgTUh6XG4iLCBkZXZfcHJpdi0+bWVtX2ZyZXEpOworCQlzZXFfcHJpbnRmKG0sICJERFIg
ZnJlcTogJWQgTUh6XG4iLCBpOTE1LT5tZW1fZnJlcSk7CiAKIAkJc2VxX3ByaW50ZihtLCAiYWN0
dWFsIEdQVSBmcmVxOiAlZCBNSHpcbiIsCi0JCQkgICBpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwg
KGZyZXFfc3RzID4+IDgpICYgMHhmZikpOworCQkJICAgaW50ZWxfZ3B1X2ZyZXEoaTkxNSwgKGZy
ZXFfc3RzID4+IDgpICYgMHhmZikpOwogCiAJCXNlcV9wcmludGYobSwgImN1cnJlbnQgR1BVIGZy
ZXE6ICVkIE1IelxuIiwKLQkJCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBycHMtPmN1cl9m
cmVxKSk7CisJCQkgICBpbnRlbF9ncHVfZnJlcShpOTE1LCBycHMtPmN1cl9mcmVxKSk7CiAKIAkJ
c2VxX3ByaW50ZihtLCAibWF4IEdQVSBmcmVxOiAlZCBNSHpcbiIsCi0JCQkgICBpbnRlbF9ncHVf
ZnJlcShkZXZfcHJpdiwgcnBzLT5tYXhfZnJlcSkpOworCQkJICAgaW50ZWxfZ3B1X2ZyZXEoaTkx
NSwgcnBzLT5tYXhfZnJlcSkpOwogCiAJCXNlcV9wcmludGYobSwgIm1pbiBHUFUgZnJlcTogJWQg
TUh6XG4iLAotCQkJICAgaW50ZWxfZ3B1X2ZyZXEoZGV2X3ByaXYsIHJwcy0+bWluX2ZyZXEpKTsK
KwkJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+bWluX2ZyZXEpKTsKIAogCQlzZXFfcHJp
bnRmKG0sICJpZGxlIEdQVSBmcmVxOiAlZCBNSHpcbiIsCi0JCQkgICBpbnRlbF9ncHVfZnJlcShk
ZXZfcHJpdiwgcnBzLT5pZGxlX2ZyZXEpKTsKKwkJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJw
cy0+aWRsZV9mcmVxKSk7CiAKIAkJc2VxX3ByaW50ZihtLAogCQkJICAgImVmZmljaWVudCAoUlBl
KSBmcmVxdWVuY3k6ICVkIE1IelxuIiwKLQkJCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBy
cHMtPmVmZmljaWVudF9mcmVxKSk7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDYpIHsKKwkJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+ZWZmaWNpZW50X2ZyZXEpKTsK
Kwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KSB7CiAJCXUzMiBycF9zdGF0ZV9saW1p
dHM7CiAJCXUzMiBndF9wZXJmX3N0YXR1czsKIAkJdTMyIHJwX3N0YXRlX2NhcDsKQEAgLTg5Miw3
ICs4OTIsNyBAQCBzdGF0aWMgaW50IGk5MTVfZnJlcXVlbmN5X2luZm8oc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICp1bnVzZWQpCiAJCWludCBtYXhfZnJlcTsKIAogCQlycF9zdGF0ZV9saW1pdHMg
PSBJOTE1X1JFQUQoR0VONl9SUF9TVEFURV9MSU1JVFMpOwotCQlpZiAoSVNfR0VOOV9MUChkZXZf
cHJpdikpIHsKKwkJaWYgKElTX0dFTjlfTFAoaTkxNSkpIHsKIAkJCXJwX3N0YXRlX2NhcCA9IEk5
MTVfUkVBRChCWFRfUlBfU1RBVEVfQ0FQKTsKIAkJCWd0X3BlcmZfc3RhdHVzID0gSTkxNV9SRUFE
KEJYVF9HVF9QRVJGX1NUQVRVUyk7CiAJCX0gZWxzZSB7CkBAIC05MDEsMTkgKzkwMSwxOSBAQCBz
dGF0aWMgaW50IGk5MTVfZnJlcXVlbmN5X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1
bnVzZWQpCiAJCX0KIAogCQkvKiBSUFNUQVQxIGlzIGluIHRoZSBHVCBwb3dlciB3ZWxsICovCi0J
CWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0Vf
QUxMKTsKKwkJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VX
QUtFX0FMTCk7CiAKIAkJcmVxZiA9IEk5MTVfUkVBRChHRU42X1JQTlNXUkVRKTsKLQkJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQkJ
cmVxZiA+Pj0gMjM7CiAJCWVsc2UgewogCQkJcmVxZiAmPSB+R0VONl9UVVJCT19ESVNBQkxFOwot
CQkJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJ
CQlpZiAoSVNfSEFTV0VMTChpOTE1KSB8fCBJU19CUk9BRFdFTEwoaTkxNSkpCiAJCQkJcmVxZiA+
Pj0gMjQ7CiAJCQllbHNlCiAJCQkJcmVxZiA+Pj0gMjU7CiAJCX0KLQkJcmVxZiA9IGludGVsX2dw
dV9mcmVxKGRldl9wcml2LCByZXFmKTsKKwkJcmVxZiA9IGludGVsX2dwdV9mcmVxKGk5MTUsIHJl
cWYpOwogCiAJCXJwbW9kZWN0bCA9IEk5MTVfUkVBRChHRU42X1JQX0NPTlRST0wpOwogCQlycGlu
Y2xpbWl0ID0gSTkxNV9SRUFEKEdFTjZfUlBfVVBfVEhSRVNIT0xEKTsKQEAgLTkyNiwxMiArOTI2
LDEyIEBAIHN0YXRpYyBpbnQgaTkxNV9mcmVxdWVuY3lfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHZvaWQgKnVudXNlZCkKIAkJcnBkb3duZWkgPSBJOTE1X1JFQUQoR0VONl9SUF9DVVJfRE9XTl9F
SSkgJiBHRU42X0NVUklBVkdfTUFTSzsKIAkJcnBjdXJkb3duID0gSTkxNV9SRUFEKEdFTjZfUlBf
Q1VSX0RPV04pICYgR0VONl9DVVJCU1lUQVZHX01BU0s7CiAJCXJwcHJldmRvd24gPSBJOTE1X1JF
QUQoR0VONl9SUF9QUkVWX0RPV04pICYgR0VONl9DVVJCU1lUQVZHX01BU0s7Ci0JCWNhZ2YgPSBp
bnRlbF9ncHVfZnJlcShkZXZfcHJpdiwKLQkJCQkgICAgICBpbnRlbF9nZXRfY2FnZihkZXZfcHJp
diwgcnBzdGF0KSk7CisJCWNhZ2YgPSBpbnRlbF9ncHVfZnJlcShpOTE1LAorCQkJCSAgICAgIGlu
dGVsX2dldF9jYWdmKGk5MTUsIHJwc3RhdCkpOwogCi0JCWludGVsX3VuY29yZV9mb3JjZXdha2Vf
cHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwkJaW50ZWxfdW5jb3JlX2Zv
cmNld2FrZV9wdXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKLQkJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewog
CQkJcG1faWVyID0gSTkxNV9SRUFEKEdFTjExX0dQTV9XR0JPWFBFUkZfSU5UUl9FTkFCTEUpOwog
CQkJcG1faW1yID0gSTkxNV9SRUFEKEdFTjExX0dQTV9XR0JPWFBFUkZfSU5UUl9NQVNLKTsKIAkJ
CS8qCkBAIC05NDAsNyArOTQwLDcgQEAgc3RhdGljIGludCBpOTE1X2ZyZXF1ZW5jeV9pbmZvKHN0
cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCQkJICovCiAJCQlwbV9pc3IgPSAwOwog
CQkJcG1faWlyID0gMDsKLQkJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpIHsK
KwkJfSBlbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCkgewogCQkJcG1faWVyID0gSTkxNV9S
RUFEKEdFTjhfR1RfSUVSKDIpKTsKIAkJCXBtX2ltciA9IEk5MTVfUkVBRChHRU44X0dUX0lNUigy
KSk7CiAJCQlwbV9pc3IgPSBJOTE1X1JFQUQoR0VOOF9HVF9JU1IoMikpOwpAQCAtOTYzLDE0ICs5
NjMsMTQgQEAgc3RhdGljIGludCBpOTE1X2ZyZXF1ZW5jeV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAq
bSwgdm9pZCAqdW51c2VkKQogCiAJCXNlcV9wcmludGYobSwgIlBNIElFUj0weCUwOHggSU1SPTB4
JTA4eCwgTUFTSz0weCUwOHhcbiIsCiAJCQkgICBwbV9pZXIsIHBtX2ltciwgcG1fbWFzayk7Ci0J
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDEwKQorCQlpZiAoSU5URUxfR0VOKGk5MTUpIDw9
IDEwKQogCQkJc2VxX3ByaW50ZihtLCAiUE0gSVNSPTB4JTA4eCBJSVI9MHglMDh4XG4iLAogCQkJ
CSAgIHBtX2lzciwgcG1faWlyKTsKIAkJc2VxX3ByaW50ZihtLCAicG1faW50cm1za19tYno6IDB4
JTA4eFxuIiwKIAkJCSAgIHJwcy0+cG1faW50cm1za19tYnopOwogCQlzZXFfcHJpbnRmKG0sICJH
VF9QRVJGX1NUQVRVUzogMHglMDh4XG4iLCBndF9wZXJmX3N0YXR1cyk7CiAJCXNlcV9wcmludGYo
bSwgIlJlbmRlciBwLXN0YXRlIHJhdGlvOiAlZFxuIiwKLQkJCSAgIChndF9wZXJmX3N0YXR1cyAm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkgPyAweDFmZjAwIDogMHhmZjAwKSkgPj4gOCk7CisJ
CQkgICAoZ3RfcGVyZl9zdGF0dXMgJiAoSU5URUxfR0VOKGk5MTUpID49IDkgPyAweDFmZjAwIDog
MHhmZjAwKSkgPj4gOCk7CiAJCXNlcV9wcmludGYobSwgIlJlbmRlciBwLXN0YXRlIFZJRDogJWRc
biIsCiAJCQkgICBndF9wZXJmX3N0YXR1cyAmIDB4ZmYpOwogCQlzZXFfcHJpbnRmKG0sICJSZW5k
ZXIgcC1zdGF0ZSBsaW1pdDogJWRcbiIsCkBAIC05ODIsNzIgKzk4Miw3MiBAQCBzdGF0aWMgaW50
IGk5MTVfZnJlcXVlbmN5X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJ
CXNlcV9wcmludGYobSwgIlJQTlNXUkVROiAlZE1IelxuIiwgcmVxZik7CiAJCXNlcV9wcmludGYo
bSwgIkNBR0Y6ICVkTUh6XG4iLCBjYWdmKTsKIAkJc2VxX3ByaW50ZihtLCAiUlAgQ1VSIFVQIEVJ
OiAlZCAoJWR1cylcbiIsCi0JCQkgICBycHVwZWksIEdUX1BNX0lOVEVSVkFMX1RPX1VTKGRldl9w
cml2LCBycHVwZWkpKTsKKwkJCSAgIHJwdXBlaSwgR1RfUE1fSU5URVJWQUxfVE9fVVMoaTkxNSwg
cnB1cGVpKSk7CiAJCXNlcV9wcmludGYobSwgIlJQIENVUiBVUDogJWQgKCVkdXMpXG4iLAotCQkJ
ICAgcnBjdXJ1cCwgR1RfUE1fSU5URVJWQUxfVE9fVVMoZGV2X3ByaXYsIHJwY3VydXApKTsKKwkJ
CSAgIHJwY3VydXAsIEdUX1BNX0lOVEVSVkFMX1RPX1VTKGk5MTUsIHJwY3VydXApKTsKIAkJc2Vx
X3ByaW50ZihtLCAiUlAgUFJFViBVUDogJWQgKCVkdXMpXG4iLAotCQkJICAgcnBwcmV2dXAsIEdU
X1BNX0lOVEVSVkFMX1RPX1VTKGRldl9wcml2LCBycHByZXZ1cCkpOworCQkJICAgcnBwcmV2dXAs
IEdUX1BNX0lOVEVSVkFMX1RPX1VTKGk5MTUsIHJwcHJldnVwKSk7CiAJCXNlcV9wcmludGYobSwg
IlVwIHRocmVzaG9sZDogJWQlJVxuIiwKIAkJCSAgIHJwcy0+cG93ZXIudXBfdGhyZXNob2xkKTsK
IAogCQlzZXFfcHJpbnRmKG0sICJSUCBDVVIgRE9XTiBFSTogJWQgKCVkdXMpXG4iLAotCQkJICAg
cnBkb3duZWksIEdUX1BNX0lOVEVSVkFMX1RPX1VTKGRldl9wcml2LCBycGRvd25laSkpOworCQkJ
ICAgcnBkb3duZWksIEdUX1BNX0lOVEVSVkFMX1RPX1VTKGk5MTUsIHJwZG93bmVpKSk7CiAJCXNl
cV9wcmludGYobSwgIlJQIENVUiBET1dOOiAlZCAoJWR1cylcbiIsCi0JCQkgICBycGN1cmRvd24s
IEdUX1BNX0lOVEVSVkFMX1RPX1VTKGRldl9wcml2LCBycGN1cmRvd24pKTsKKwkJCSAgIHJwY3Vy
ZG93biwgR1RfUE1fSU5URVJWQUxfVE9fVVMoaTkxNSwgcnBjdXJkb3duKSk7CiAJCXNlcV9wcmlu
dGYobSwgIlJQIFBSRVYgRE9XTjogJWQgKCVkdXMpXG4iLAotCQkJICAgcnBwcmV2ZG93biwgR1Rf
UE1fSU5URVJWQUxfVE9fVVMoZGV2X3ByaXYsIHJwcHJldmRvd24pKTsKKwkJCSAgIHJwcHJldmRv
d24sIEdUX1BNX0lOVEVSVkFMX1RPX1VTKGk5MTUsIHJwcHJldmRvd24pKTsKIAkJc2VxX3ByaW50
ZihtLCAiRG93biB0aHJlc2hvbGQ6ICVkJSVcbiIsCiAJCQkgICBycHMtPnBvd2VyLmRvd25fdGhy
ZXNob2xkKTsKIAotCQltYXhfZnJlcSA9IChJU19HRU45X0xQKGRldl9wcml2KSA/IHJwX3N0YXRl
X2NhcCA+PiAwIDoKKwkJbWF4X2ZyZXEgPSAoSVNfR0VOOV9MUChpOTE1KSA/IHJwX3N0YXRlX2Nh
cCA+PiAwIDoKIAkJCSAgICBycF9zdGF0ZV9jYXAgPj4gMTYpICYgMHhmZjsKLQkJbWF4X2ZyZXEg
Kj0gKElTX0dFTjlfQkMoZGV2X3ByaXYpIHx8Ci0JCQkgICAgIElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTAgPyBHRU45X0ZSRVFfU0NBTEVSIDogMSk7CisJCW1heF9mcmVxICo9IChJU19HRU45X0JD
KGk5MTUpIHx8CisJCQkgICAgIElOVEVMX0dFTihpOTE1KSA+PSAxMCA/IEdFTjlfRlJFUV9TQ0FM
RVIgOiAxKTsKIAkJc2VxX3ByaW50ZihtLCAiTG93ZXN0IChSUE4pIGZyZXF1ZW5jeTogJWRNSHpc
biIsCi0JCQkgICBpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwgbWF4X2ZyZXEpKTsKKwkJCSAgIGlu
dGVsX2dwdV9mcmVxKGk5MTUsIG1heF9mcmVxKSk7CiAKIAkJbWF4X2ZyZXEgPSAocnBfc3RhdGVf
Y2FwICYgMHhmZjAwKSA+PiA4OwotCQltYXhfZnJlcSAqPSAoSVNfR0VOOV9CQyhkZXZfcHJpdikg
fHwKLQkJCSAgICAgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCA/IEdFTjlfRlJFUV9TQ0FMRVIg
OiAxKTsKKwkJbWF4X2ZyZXEgKj0gKElTX0dFTjlfQkMoaTkxNSkgfHwKKwkJCSAgICAgSU5URUxf
R0VOKGk5MTUpID49IDEwID8gR0VOOV9GUkVRX1NDQUxFUiA6IDEpOwogCQlzZXFfcHJpbnRmKG0s
ICJOb21pbmFsIChSUDEpIGZyZXF1ZW5jeTogJWRNSHpcbiIsCi0JCQkgICBpbnRlbF9ncHVfZnJl
cShkZXZfcHJpdiwgbWF4X2ZyZXEpKTsKKwkJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIG1heF9m
cmVxKSk7CiAKLQkJbWF4X2ZyZXEgPSAoSVNfR0VOOV9MUChkZXZfcHJpdikgPyBycF9zdGF0ZV9j
YXAgPj4gMTYgOgorCQltYXhfZnJlcSA9IChJU19HRU45X0xQKGk5MTUpID8gcnBfc3RhdGVfY2Fw
ID4+IDE2IDoKIAkJCSAgICBycF9zdGF0ZV9jYXAgPj4gMCkgJiAweGZmOwotCQltYXhfZnJlcSAq
PSAoSVNfR0VOOV9CQyhkZXZfcHJpdikgfHwKLQkJCSAgICAgSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCA/IEdFTjlfRlJFUV9TQ0FMRVIgOiAxKTsKKwkJbWF4X2ZyZXEgKj0gKElTX0dFTjlfQkMo
aTkxNSkgfHwKKwkJCSAgICAgSU5URUxfR0VOKGk5MTUpID49IDEwID8gR0VOOV9GUkVRX1NDQUxF
UiA6IDEpOwogCQlzZXFfcHJpbnRmKG0sICJNYXggbm9uLW92ZXJjbG9ja2VkIChSUDApIGZyZXF1
ZW5jeTogJWRNSHpcbiIsCi0JCQkgICBpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwgbWF4X2ZyZXEp
KTsKKwkJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIG1heF9mcmVxKSk7CiAJCXNlcV9wcmludGYo
bSwgIk1heCBvdmVyY2xvY2tlZCBmcmVxdWVuY3k6ICVkTUh6XG4iLAotCQkJICAgaW50ZWxfZ3B1
X2ZyZXEoZGV2X3ByaXYsIHJwcy0+bWF4X2ZyZXEpKTsKKwkJCSAgIGludGVsX2dwdV9mcmVxKGk5
MTUsIHJwcy0+bWF4X2ZyZXEpKTsKIAogCQlzZXFfcHJpbnRmKG0sICJDdXJyZW50IGZyZXE6ICVk
IE1IelxuIiwKLQkJCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBycHMtPmN1cl9mcmVxKSk7
CisJCQkgICBpbnRlbF9ncHVfZnJlcShpOTE1LCBycHMtPmN1cl9mcmVxKSk7CiAJCXNlcV9wcmlu
dGYobSwgIkFjdHVhbCBmcmVxOiAlZCBNSHpcbiIsIGNhZ2YpOwogCQlzZXFfcHJpbnRmKG0sICJJ
ZGxlIGZyZXE6ICVkIE1IelxuIiwKLQkJCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBycHMt
PmlkbGVfZnJlcSkpOworCQkJICAgaW50ZWxfZ3B1X2ZyZXEoaTkxNSwgcnBzLT5pZGxlX2ZyZXEp
KTsKIAkJc2VxX3ByaW50ZihtLCAiTWluIGZyZXE6ICVkIE1IelxuIiwKLQkJCSAgIGludGVsX2dw
dV9mcmVxKGRldl9wcml2LCBycHMtPm1pbl9mcmVxKSk7CisJCQkgICBpbnRlbF9ncHVfZnJlcShp
OTE1LCBycHMtPm1pbl9mcmVxKSk7CiAJCXNlcV9wcmludGYobSwgIkJvb3N0IGZyZXE6ICVkIE1I
elxuIiwKLQkJCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBycHMtPmJvb3N0X2ZyZXEpKTsK
KwkJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+Ym9vc3RfZnJlcSkpOwogCQlzZXFfcHJp
bnRmKG0sICJNYXggZnJlcTogJWQgTUh6XG4iLAotCQkJICAgaW50ZWxfZ3B1X2ZyZXEoZGV2X3By
aXYsIHJwcy0+bWF4X2ZyZXEpKTsKKwkJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+bWF4
X2ZyZXEpKTsKIAkJc2VxX3ByaW50ZihtLAogCQkJICAgImVmZmljaWVudCAoUlBlKSBmcmVxdWVu
Y3k6ICVkIE1IelxuIiwKLQkJCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBycHMtPmVmZmlj
aWVudF9mcmVxKSk7CisJCQkgICBpbnRlbF9ncHVfZnJlcShpOTE1LCBycHMtPmVmZmljaWVudF9m
cmVxKSk7CiAJfSBlbHNlIHsKIAkJc2VxX3B1dHMobSwgIm5vIFAtc3RhdGUgaW5mbyBhdmFpbGFi
bGVcbiIpOwogCX0KIAotCXNlcV9wcmludGYobSwgIkN1cnJlbnQgQ0QgY2xvY2sgZnJlcXVlbmN5
OiAlZCBrSHpcbiIsIGRldl9wcml2LT5jZGNsay5ody5jZGNsayk7Ci0Jc2VxX3ByaW50ZihtLCAi
TWF4IENEIGNsb2NrIGZyZXF1ZW5jeTogJWQga0h6XG4iLCBkZXZfcHJpdi0+bWF4X2NkY2xrX2Zy
ZXEpOwotCXNlcV9wcmludGYobSwgIk1heCBwaXhlbCBjbG9jayBmcmVxdWVuY3k6ICVkIGtIelxu
IiwgZGV2X3ByaXYtPm1heF9kb3RjbGtfZnJlcSk7CisJc2VxX3ByaW50ZihtLCAiQ3VycmVudCBD
RCBjbG9jayBmcmVxdWVuY3k6ICVkIGtIelxuIiwgaTkxNS0+Y2RjbGsuaHcuY2RjbGspOworCXNl
cV9wcmludGYobSwgIk1heCBDRCBjbG9jayBmcmVxdWVuY3k6ICVkIGtIelxuIiwgaTkxNS0+bWF4
X2NkY2xrX2ZyZXEpOworCXNlcV9wcmludGYobSwgIk1heCBwaXhlbCBjbG9jayBmcmVxdWVuY3k6
ICVkIGtIelxuIiwgaTkxNS0+bWF4X2RvdGNsa19mcmVxKTsKIAotCWludGVsX3J1bnRpbWVfcG1f
cHV0KGRldl9wcml2LCB3YWtlcmVmKTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dChpOTE1LCB3YWtl
cmVmKTsKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9pZCBpOTE1X2luc3Rkb25lX2luZm8o
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaTkxNV9pbnN0
ZG9uZV9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgIHN0cnVj
dCBzZXFfZmlsZSAqbSwKIAkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfaW5zdGRvbmUgKmluc3Rkb25l
KQogewpAQCAtMTA1NywzNyArMTA1NywzNyBAQCBzdGF0aWMgdm9pZCBpOTE1X2luc3Rkb25lX2lu
Zm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXNlcV9wcmludGYobSwgIlx0
XHRJTlNURE9ORTogMHglMDh4XG4iLAogCQkgICBpbnN0ZG9uZS0+aW5zdGRvbmUpOwogCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPD0gMykKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDw9IDMpCiAJ
CXJldHVybjsKIAogCXNlcV9wcmludGYobSwgIlx0XHRTQ19JTlNURE9ORTogMHglMDh4XG4iLAog
CQkgICBpbnN0ZG9uZS0+c2xpY2VfY29tbW9uKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
IDw9IDYpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8PSA2KQogCQlyZXR1cm47CiAKLQlmb3JfZWFj
aF9pbnN0ZG9uZV9zbGljZV9zdWJzbGljZShkZXZfcHJpdiwgc2xpY2UsIHN1YnNsaWNlKQorCWZv
cl9lYWNoX2luc3Rkb25lX3NsaWNlX3N1YnNsaWNlKGk5MTUsIHNsaWNlLCBzdWJzbGljZSkKIAkJ
c2VxX3ByaW50ZihtLCAiXHRcdFNBTVBMRVJfSU5TVERPTkVbJWRdWyVkXTogMHglMDh4XG4iLAog
CQkJICAgc2xpY2UsIHN1YnNsaWNlLCBpbnN0ZG9uZS0+c2FtcGxlcltzbGljZV1bc3Vic2xpY2Vd
KTsKIAotCWZvcl9lYWNoX2luc3Rkb25lX3NsaWNlX3N1YnNsaWNlKGRldl9wcml2LCBzbGljZSwg
c3Vic2xpY2UpCisJZm9yX2VhY2hfaW5zdGRvbmVfc2xpY2Vfc3Vic2xpY2UoaTkxNSwgc2xpY2Us
IHN1YnNsaWNlKQogCQlzZXFfcHJpbnRmKG0sICJcdFx0Uk9XX0lOU1RET05FWyVkXVslZF06IDB4
JTA4eFxuIiwKIAkJCSAgIHNsaWNlLCBzdWJzbGljZSwgaW5zdGRvbmUtPnJvd1tzbGljZV1bc3Vi
c2xpY2VdKTsKIH0KIAogc3RhdGljIGludCBpOTE1X2hhbmdjaGVja19pbmZvKHN0cnVjdCBzZXFf
ZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmU7CiAJdTY0IGFjdGhkW0k5MTVfTlVNX0VOR0lORVNdOwogCXN0cnVjdCBpbnRl
bF9pbnN0ZG9uZSBpbnN0ZG9uZTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAllbnVtIGlu
dGVsX2VuZ2luZV9pZCBpZDsKIAotCXNlcV9wcmludGYobSwgIlJlc2V0IGZsYWdzOiAlbHhcbiIs
IGRldl9wcml2LT5ncHVfZXJyb3IuZmxhZ3MpOwotCWlmICh0ZXN0X2JpdChJOTE1X1dFREdFRCwg
JmRldl9wcml2LT5ncHVfZXJyb3IuZmxhZ3MpKQorCXNlcV9wcmludGYobSwgIlJlc2V0IGZsYWdz
OiAlbHhcbiIsIGk5MTUtPmdwdV9lcnJvci5mbGFncyk7CisJaWYgKHRlc3RfYml0KEk5MTVfV0VE
R0VELCAmaTkxNS0+Z3B1X2Vycm9yLmZsYWdzKSkKIAkJc2VxX3B1dHMobSwgIlx0V2VkZ2VkXG4i
KTsKLQlpZiAodGVzdF9iaXQoSTkxNV9SRVNFVF9CQUNLT0ZGLCAmZGV2X3ByaXYtPmdwdV9lcnJv
ci5mbGFncykpCisJaWYgKHRlc3RfYml0KEk5MTVfUkVTRVRfQkFDS09GRiwgJmk5MTUtPmdwdV9l
cnJvci5mbGFncykpCiAJCXNlcV9wdXRzKG0sICJcdERldmljZSAoZ2xvYmFsKSByZXNldCBpbiBw
cm9ncmVzc1xuIik7CiAKIAlpZiAoIWk5MTVfbW9kcGFyYW1zLmVuYWJsZV9oYW5nY2hlY2spIHsK
QEAgLTEwOTUsMjUgKzEwOTUsMjUgQEAgc3RhdGljIGludCBpOTE1X2hhbmdjaGVja19pbmZvKHN0
cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCQlyZXR1cm4gMDsKIAl9CiAKLQl3aXRo
X2ludGVsX3J1bnRpbWVfcG0oZGV2X3ByaXYsIHdha2VyZWYpIHsKLQkJZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgZGV2X3ByaXYsIGlkKQorCXdpdGhfaW50ZWxfcnVudGltZV9wbShpOTE1LCB3YWtl
cmVmKSB7CisJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQkJYWN0aGRbaWRd
ID0gaW50ZWxfZW5naW5lX2dldF9hY3RpdmVfaGVhZChlbmdpbmUpOwogCi0JCWludGVsX2VuZ2lu
ZV9nZXRfaW5zdGRvbmUoZGV2X3ByaXYtPmVuZ2luZVtSQ1MwXSwgJmluc3Rkb25lKTsKKwkJaW50
ZWxfZW5naW5lX2dldF9pbnN0ZG9uZShpOTE1LT5lbmdpbmVbUkNTMF0sICZpbnN0ZG9uZSk7CiAJ
fQogCi0JaWYgKHRpbWVyX3BlbmRpbmcoJmRldl9wcml2LT5ncHVfZXJyb3IuaGFuZ2NoZWNrX3dv
cmsudGltZXIpKQorCWlmICh0aW1lcl9wZW5kaW5nKCZpOTE1LT5ncHVfZXJyb3IuaGFuZ2NoZWNr
X3dvcmsudGltZXIpKQogCQlzZXFfcHJpbnRmKG0sICJIYW5nY2hlY2sgYWN0aXZlLCB0aW1lciBm
aXJlcyBpbiAlZG1zXG4iLAotCQkJICAgamlmZmllc190b19tc2VjcyhkZXZfcHJpdi0+Z3B1X2Vy
cm9yLmhhbmdjaGVja193b3JrLnRpbWVyLmV4cGlyZXMgLQorCQkJICAgamlmZmllc190b19tc2Vj
cyhpOTE1LT5ncHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmsudGltZXIuZXhwaXJlcyAtCiAJCQkJCSAg
ICBqaWZmaWVzKSk7Ci0JZWxzZSBpZiAoZGVsYXllZF93b3JrX3BlbmRpbmcoJmRldl9wcml2LT5n
cHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmspKQorCWVsc2UgaWYgKGRlbGF5ZWRfd29ya19wZW5kaW5n
KCZpOTE1LT5ncHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmspKQogCQlzZXFfcHV0cyhtLCAiSGFuZ2No
ZWNrIGFjdGl2ZSwgd29yayBwZW5kaW5nXG4iKTsKIAllbHNlCiAJCXNlcV9wdXRzKG0sICJIYW5n
Y2hlY2sgaW5hY3RpdmVcbiIpOwogCi0Jc2VxX3ByaW50ZihtLCAiR1QgYWN0aXZlPyAlc1xuIiwg
eWVzbm8oZGV2X3ByaXYtPmd0LmF3YWtlKSk7CisJc2VxX3ByaW50ZihtLCAiR1QgYWN0aXZlPyAl
c1xuIiwgeWVzbm8oaTkxNS0+Z3QuYXdha2UpKTsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGRldl9wcml2LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJ
CXNlcV9wcmludGYobSwgIiVzOiAlZCBtcyBhZ29cbiIsCiAJCQkgICBlbmdpbmUtPm5hbWUsCiAJ
CQkgICBqaWZmaWVzX3RvX21zZWNzKGppZmZpZXMgLQpAQCAtMTEyNiwxMSArMTEyNiwxMSBAQCBz
dGF0aWMgaW50IGk5MTVfaGFuZ2NoZWNrX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1
bnVzZWQpCiAJCWlmIChlbmdpbmUtPmlkID09IFJDUzApIHsKIAkJCXNlcV9wdXRzKG0sICJcdGlu
c3Rkb25lIHJlYWQgPVxuIik7CiAKLQkJCWk5MTVfaW5zdGRvbmVfaW5mbyhkZXZfcHJpdiwgbSwg
Jmluc3Rkb25lKTsKKwkJCWk5MTVfaW5zdGRvbmVfaW5mbyhpOTE1LCBtLCAmaW5zdGRvbmUpOwog
CiAJCQlzZXFfcHV0cyhtLCAiXHRpbnN0ZG9uZSBhY2N1ID1cbiIpOwogCi0JCQlpOTE1X2luc3Rk
b25lX2luZm8oZGV2X3ByaXYsIG0sCisJCQlpOTE1X2luc3Rkb25lX2luZm8oaTkxNSwgbSwKIAkJ
CQkJICAgJmVuZ2luZS0+aGFuZ2NoZWNrLmluc3Rkb25lKTsKIAkJfQogCX0KQEAgLTExNDAsMTQg
KzExNDAsMTQgQEAgc3RhdGljIGludCBpOTE1X2hhbmdjaGVja19pbmZvKHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqdW51c2VkKQogCiBzdGF0aWMgaW50IGk5MTVfcmVzZXRfaW5mbyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGk5MTVfZ3B1X2Vy
cm9yICplcnJvciA9ICZkZXZfcHJpdi0+Z3B1X2Vycm9yOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBpOTE1X2dwdV9l
cnJvciAqZXJyb3IgPSAmaTkxNS0+Z3B1X2Vycm9yOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAogCXNlcV9wcmludGYobSwgImZ1
bGwgZ3B1IHJlc2V0ID0gJXVcbiIsIGk5MTVfcmVzZXRfY291bnQoZXJyb3IpKTsKIAotCWZvcl9l
YWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGk5MTUsIGlkKSB7CiAJCXNlcV9wcmludGYobSwgIiVzID0gJXVcbiIsIGVuZ2luZS0+bmFt
ZSwKIAkJCSAgIGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KGVycm9yLCBlbmdpbmUpKTsKIAl9CkBA
IC0xMjM1LDE2ICsxMjM1LDE2IEBAIHN0YXRpYyB2b2lkIHByaW50X3JjNl9yZXMoc3RydWN0IHNl
cV9maWxlICptLAogCQkJICBjb25zdCBjaGFyICp0aXRsZSwKIAkJCSAgY29uc3QgaTkxNV9yZWdf
dCByZWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19p
OTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90
b19pOTE1KG0tPnByaXZhdGUpOwogCiAJc2VxX3ByaW50ZihtLCAiJXMgJXUgKCVsbHUgdXMpXG4i
LAogCQkgICB0aXRsZSwgSTkxNV9SRUFEKHJlZyksCi0JCSAgIGludGVsX3JjNl9yZXNpZGVuY3lf
dXMoZGV2X3ByaXYsIHJlZykpOworCQkgICBpbnRlbF9yYzZfcmVzaWRlbmN5X3VzKGk5MTUsIHJl
ZykpOwogfQogCiBzdGF0aWMgaW50IHZsdl9kcnBjX2luZm8oc3RydWN0IHNlcV9maWxlICptKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5w
cml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNSht
LT5wcml2YXRlKTsKIAl1MzIgcmNjdGwxLCBwd19zdGF0dXM7CiAKIAlwd19zdGF0dXMgPSBJOTE1
X1JFQUQoVkxWX0dUTENfUFdfU1RBVFVTKTsKQEAgLTEyNjYsNyArMTI2Niw3IEBAIHN0YXRpYyBp
bnQgdmx2X2RycGNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAKIHN0YXRpYyBpbnQgZ2VuNl9k
cnBjX2luZm8oc3RydWN0IHNlcV9maWxlICptKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKIAl1MzIgZ3RfY29yZV9z
dGF0dXMsIHJjY3RsMSwgcmM2dmlkcyA9IDA7CiAJdTMyIGdlbjlfcG93ZXJnYXRlX2VuYWJsZSA9
IDAsIGdlbjlfcG93ZXJnYXRlX3N0YXR1cyA9IDA7CiAKQEAgLTEyNzQsMjAgKzEyNzQsMjAgQEAg
c3RhdGljIGludCBnZW42X2RycGNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJdHJhY2VfaTkx
NV9yZWdfcncoZmFsc2UsIEdFTjZfR1RfQ09SRV9TVEFUVVMsIGd0X2NvcmVfc3RhdHVzLCA0LCB0
cnVlKTsKIAogCXJjY3RsMSA9IEk5MTVfUkVBRChHRU42X1JDX0NPTlRST0wpOwotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDkpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsKIAkJ
Z2VuOV9wb3dlcmdhdGVfZW5hYmxlID0gSTkxNV9SRUFEKEdFTjlfUEdfRU5BQkxFKTsKIAkJZ2Vu
OV9wb3dlcmdhdGVfc3RhdHVzID0gSTkxNV9SRUFEKEdFTjlfUFdSR1RfRE9NQUlOX1NUQVRVUyk7
CiAJfQogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPD0gNykKLQkJc2FuZHlicmlkZ2VfcGNv
ZGVfcmVhZChkZXZfcHJpdiwgR0VONl9QQ09ERV9SRUFEX1JDNlZJRFMsCisJaWYgKElOVEVMX0dF
TihpOTE1KSA8PSA3KQorCQlzYW5keWJyaWRnZV9wY29kZV9yZWFkKGk5MTUsIEdFTjZfUENPREVf
UkVBRF9SQzZWSURTLAogCQkJCSAgICAgICAmcmM2dmlkcywgTlVMTCk7CiAKIAlzZXFfcHJpbnRm
KG0sICJSQzFlIEVuYWJsZWQ6ICVzXG4iLAogCQkgICB5ZXNubyhyY2N0bDEgJiBHRU42X1JDX0NU
TF9SQzFlX0VOQUJMRSkpOwogCXNlcV9wcmludGYobSwgIlJDNiBFbmFibGVkOiAlc1xuIiwKIAkJ
ICAgeWVzbm8ocmNjdGwxICYgR0VONl9SQ19DVExfUkM2X0VOQUJMRSkpOwotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDkpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsKIAkJc2Vx
X3ByaW50ZihtLCAiUmVuZGVyIFdlbGwgR2F0aW5nIEVuYWJsZWQ6ICVzXG4iLAogCQkJeWVzbm8o
Z2VuOV9wb3dlcmdhdGVfZW5hYmxlICYgR0VOOV9SRU5ERVJfUEdfRU5BQkxFKSk7CiAJCXNlcV9w
cmludGYobSwgIk1lZGlhIFdlbGwgR2F0aW5nIEVuYWJsZWQ6ICVzXG4iLApAQCAtMTMyMSw3ICsx
MzIxLDcgQEAgc3RhdGljIGludCBnZW42X2RycGNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAK
IAlzZXFfcHJpbnRmKG0sICJDb3JlIFBvd2VyIERvd246ICVzXG4iLAogCQkgICB5ZXNubyhndF9j
b3JlX3N0YXR1cyAmIEdFTjZfQ09SRV9DUERfU1RBVEVfTUFTSykpOwotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDkpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsKIAkJc2VxX3By
aW50ZihtLCAiUmVuZGVyIFBvd2VyIFdlbGw6ICVzXG4iLAogCQkJKGdlbjlfcG93ZXJnYXRlX3N0
YXR1cyAmCiAJCQkgR0VOOV9QV1JHVF9SRU5ERVJfU1RBVFVTX01BU0spID8gIlVwIiA6ICJEb3du
Iik7CkBAIC0xMzM3LDcgKzEzMzcsNyBAQCBzdGF0aWMgaW50IGdlbjZfZHJwY19pbmZvKHN0cnVj
dCBzZXFfZmlsZSAqbSkKIAlwcmludF9yYzZfcmVzKG0sICJSQzYrIHJlc2lkZW5jeSBzaW5jZSBi
b290OiIsIEdFTjZfR1RfR0ZYX1JDNnApOwogCXByaW50X3JjNl9yZXMobSwgIlJDNisrIHJlc2lk
ZW5jeSBzaW5jZSBib290OiIsIEdFTjZfR1RfR0ZYX1JDNnBwKTsKIAotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpIDw9IDcpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDw9IDcpIHsKIAkJc2VxX3By
aW50ZihtLCAiUkM2ICAgdm9sdGFnZTogJWRtVlxuIiwKIAkJCSAgIEdFTjZfREVDT0RFX1JDNl9W
SUQoKChyYzZ2aWRzID4+IDApICYgMHhmZikpKTsKIAkJc2VxX3ByaW50ZihtLCAiUkM2KyAgdm9s
dGFnZTogJWRtVlxuIiwKQEAgLTEzNTEsMTQgKzEzNTEsMTQgQEAgc3RhdGljIGludCBnZW42X2Ry
cGNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAKIHN0YXRpYyBpbnQgaTkxNV9kcnBjX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwogCWludGVsX3dh
a2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAtRU5PREVWOwogCi0Jd2l0aF9pbnRlbF9ydW50
aW1lX3BtKGRldl9wcml2LCB3YWtlcmVmKSB7Ci0JCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2
KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkKKwl3aXRoX2ludGVsX3J1bnRpbWVfcG0oaTkx
NSwgd2FrZXJlZikgeworCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVX
KGk5MTUpKQogCQkJZXJyID0gdmx2X2RycGNfaW5mbyhtKTsKLQkJZWxzZSBpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA2KQorCQllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikKIAkJCWVy
ciA9IGdlbjZfZHJwY19pbmZvKG0pOwogCQllbHNlCiAJCQllcnIgPSBpcm9ubGFrZV9kcnBjX2lu
Zm8obSk7CkBAIC0xMzY5LDQ0ICsxMzY5LDQ0IEBAIHN0YXRpYyBpbnQgaTkxNV9kcnBjX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAKIHN0YXRpYyBpbnQgaTkxNV9mcm9u
dGJ1ZmZlcl90cmFja2luZyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0
ZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJp
dmF0ZSk7CiAKIAlzZXFfcHJpbnRmKG0sICJGQiB0cmFja2luZyBidXN5IGJpdHM6IDB4JTA4eFxu
IiwKLQkJICAgZGV2X3ByaXYtPmZiX3RyYWNraW5nLmJ1c3lfYml0cyk7CisJCSAgIGk5MTUtPmZi
X3RyYWNraW5nLmJ1c3lfYml0cyk7CiAKIAlzZXFfcHJpbnRmKG0sICJGQiB0cmFja2luZyBmbGlw
IGJpdHM6IDB4JTA4eFxuIiwKLQkJICAgZGV2X3ByaXYtPmZiX3RyYWNraW5nLmZsaXBfYml0cyk7
CisJCSAgIGk5MTUtPmZiX3RyYWNraW5nLmZsaXBfYml0cyk7CiAKIAlyZXR1cm4gMDsKIH0KIAog
c3RhdGljIGludCBpOTE1X2ZiY19zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVz
ZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1
KG0tPnByaXZhdGUpOwotCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJpdi0+ZmJjOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUp
OworCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZpOTE1LT5mYmM7CiAJaW50ZWxfd2FrZXJlZl90
IHdha2VyZWY7CiAKLQlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQorCWlmICghSEFTX0ZCQyhpOTE1
KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQo
ZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAltdXRl
eF9sb2NrKCZmYmMtPmxvY2spOwogCi0JaWYgKGludGVsX2ZiY19pc19hY3RpdmUoZGV2X3ByaXYp
KQorCWlmIChpbnRlbF9mYmNfaXNfYWN0aXZlKGk5MTUpKQogCQlzZXFfcHV0cyhtLCAiRkJDIGVu
YWJsZWRcbiIpOwogCWVsc2UKIAkJc2VxX3ByaW50ZihtLCAiRkJDIGRpc2FibGVkOiAlc1xuIiwg
ZmJjLT5ub19mYmNfcmVhc29uKTsKIAotCWlmIChpbnRlbF9mYmNfaXNfYWN0aXZlKGRldl9wcml2
KSkgeworCWlmIChpbnRlbF9mYmNfaXNfYWN0aXZlKGk5MTUpKSB7CiAJCXUzMiBtYXNrOwogCi0J
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0g
OCkKIAkJCW1hc2sgPSBJOTE1X1JFQUQoSVZCX0ZCQ19TVEFUVVMyKSAmIEJEV19GQkNfQ09NUF9T
RUdfTUFTSzsKLQkJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA3KQorCQllbHNlIGlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gNykKIAkJCW1hc2sgPSBJOTE1X1JFQUQoSVZCX0ZCQ19TVEFU
VVMyKSAmIElWQl9GQkNfQ09NUF9TRUdfTUFTSzsKLQkJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA1KQorCQllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJCW1hc2sgPSBJ
OTE1X1JFQUQoSUxLX0RQRkNfU1RBVFVTKSAmIElMS19EUEZDX0NPTVBfU0VHX01BU0s7Ci0JCWVs
c2UgaWYgKElTX0c0WChkZXZfcHJpdikpCisJCWVsc2UgaWYgKElTX0c0WChpOTE1KSkKIAkJCW1h
c2sgPSBJOTE1X1JFQUQoRFBGQ19TVEFUVVMpICYgRFBGQ19DT01QX1NFR19NQVNLOwogCQllbHNl
CiAJCQltYXNrID0gSTkxNV9SRUFEKEZCQ19TVEFUVVMpICYgKEZCQ19TVEFUX0NPTVBSRVNTSU5H
IHwKQEAgLTE0MTYsNDEgKzE0MTYsNDEgQEAgc3RhdGljIGludCBpOTE1X2ZiY19zdGF0dXMoc3Ry
dWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJfQogCiAJbXV0ZXhfdW5sb2NrKCZmYmMt
PmxvY2spOwotCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCB3YWtlcmVmKTsKKwlpbnRl
bF9ydW50aW1lX3BtX3B1dChpOTE1LCB3YWtlcmVmKTsKIAogCXJldHVybiAwOwogfQogCiBzdGF0
aWMgaW50IGk5MTVfZmJjX2ZhbHNlX2NvbG9yX2dldCh2b2lkICpkYXRhLCB1NjQgKnZhbCkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkYXRhOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwg
NyB8fCAhSEFTX0ZCQyhkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDcgfHwgIUhB
U19GQkMoaTkxNSkpCiAJCXJldHVybiAtRU5PREVWOwogCi0JKnZhbCA9IGRldl9wcml2LT5mYmMu
ZmFsc2VfY29sb3I7CisJKnZhbCA9IGk5MTUtPmZiYy5mYWxzZV9jb2xvcjsKIAogCXJldHVybiAw
OwogfQogCiBzdGF0aWMgaW50IGk5MTVfZmJjX2ZhbHNlX2NvbG9yX3NldCh2b2lkICpkYXRhLCB1
NjQgdmFsKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOwogCXUzMiByZWc7CiAKLQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA8IDcgfHwgIUhBU19GQkMoZGV2X3ByaXYpKQorCWlmIChJTlRF
TF9HRU4oaTkxNSkgPCA3IHx8ICFIQVNfRkJDKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAot
CW11dGV4X2xvY2soJmRldl9wcml2LT5mYmMubG9jayk7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZmJj
LmxvY2spOwogCiAJcmVnID0gSTkxNV9SRUFEKElMS19EUEZDX0NPTlRST0wpOwotCWRldl9wcml2
LT5mYmMuZmFsc2VfY29sb3IgPSB2YWw7CisJaTkxNS0+ZmJjLmZhbHNlX2NvbG9yID0gdmFsOwog
CiAJSTkxNV9XUklURShJTEtfRFBGQ19DT05UUk9MLCB2YWwgPwogCQkgICAocmVnIHwgRkJDX0NU
TF9GQUxTRV9DT0xPUikgOgogCQkgICAocmVnICYgfkZCQ19DVExfRkFMU0VfQ09MT1IpKTsKIAot
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmZiYy5sb2NrKTsKKwltdXRleF91bmxvY2soJmk5MTUt
PmZiYy5sb2NrKTsKIAlyZXR1cm4gMDsKIH0KIApAQCAtMTQ2MCwxOCArMTQ2MCwxOCBAQCBERUZJ
TkVfU0lNUExFX0FUVFJJQlVURShpOTE1X2ZiY19mYWxzZV9jb2xvcl9mb3BzLAogCiBzdGF0aWMg
aW50IGk5MTVfaXBzX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJp
dmF0ZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+
cHJpdmF0ZSk7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAKLQlpZiAoIUhBU19JUFMoZGV2
X3ByaXYpKQorCWlmICghSEFTX0lQUyhpOTE1KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQl3YWtl
cmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldChpOTE1KTsKIAogCXNlcV9wcmludGYobSwgIkVuYWJsZWQgYnkga2VybmVs
IHBhcmFtZXRlcjogJXNcbiIsCiAJCSAgIHllc25vKGk5MTVfbW9kcGFyYW1zLmVuYWJsZV9pcHMp
KTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpIHsKKwlpZiAoSU5URUxfR0VOKGk5
MTUpID49IDgpIHsKIAkJc2VxX3B1dHMobSwgIkN1cnJlbnRseTogdW5rbm93blxuIik7CiAJfSBl
bHNlIHsKIAkJaWYgKEk5MTVfUkVBRChJUFNfQ1RMKSAmIElQU19FTkFCTEUpCkBAIC0xNDgwLDM0
ICsxNDgwLDM0IEBAIHN0YXRpYyBpbnQgaTkxNV9pcHNfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAq
bSwgdm9pZCAqdW51c2VkKQogCQkJc2VxX3B1dHMobSwgIkN1cnJlbnRseTogZGlzYWJsZWRcbiIp
OwogCX0KIAotCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCB3YWtlcmVmKTsKKwlpbnRl
bF9ydW50aW1lX3BtX3B1dChpOTE1LCB3YWtlcmVmKTsKIAogCXJldHVybiAwOwogfQogCiBzdGF0
aWMgaW50IGk5MTVfc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5w
cml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNSht
LT5wcml2YXRlKTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlib29sIHNyX2VuYWJsZWQg
PSBmYWxzZTsKIAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwg
UE9XRVJfRE9NQUlOX0lOSVQpOworCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChp
OTE1LCBQT1dFUl9ET01BSU5fSU5JVCk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5
KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJLyogbm8gZ2xvYmFsIFNSIHN0YXR1czsg
aW5zcGVjdCBwZXItcGxhbmUgV00gKi87Ci0JZWxzZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJp
dikpCisJZWxzZSBpZiAoSEFTX1BDSF9TUExJVChpOTE1KSkKIAkJc3JfZW5hYmxlZCA9IEk5MTVf
UkVBRChXTTFfTFBfSUxLKSAmIFdNMV9MUF9TUl9FTjsKLQllbHNlIGlmIChJU19JOTY1R00oZGV2
X3ByaXYpIHx8IElTX0c0WChkZXZfcHJpdikgfHwKLQkJIElTX0k5NDVHKGRldl9wcml2KSB8fCBJ
U19JOTQ1R00oZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0k5NjVHTShpOTE1KSB8fCBJU19HNFgo
aTkxNSkgfHwKKwkJIElTX0k5NDVHKGk5MTUpIHx8IElTX0k5NDVHTShpOTE1KSkKIAkJc3JfZW5h
YmxlZCA9IEk5MTVfUkVBRChGV19CTENfU0VMRikgJiBGV19CTENfU0VMRl9FTjsKLQllbHNlIGlm
IChJU19JOTE1R00oZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0k5MTVHTShpOTE1KSkKIAkJc3Jf
ZW5hYmxlZCA9IEk5MTVfUkVBRChJTlNUUE0pICYgSU5TVFBNX1NFTEZfRU47Ci0JZWxzZSBpZiAo
SVNfUElORVZJRVcoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX1BJTkVWSUVXKGk5MTUpKQogCQlz
cl9lbmFibGVkID0gSTkxNV9SRUFEKERTUEZXMykgJiBQSU5FVklFV19TRUxGX1JFRlJFU0hfRU47
Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZf
cHJpdikpCisJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5
MTUpKQogCQlzcl9lbmFibGVkID0gSTkxNV9SRUFEKEZXX0JMQ19TRUxGX1ZMVikgJiBGV19DU1BX
UkRXTkVOOwogCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJ
Tl9JTklULCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9E
T01BSU5fSU5JVCwgd2FrZXJlZik7CiAKIAlzZXFfcHJpbnRmKG0sICJzZWxmLXJlZnJlc2g6ICVz
XG4iLCBlbmFibGVkZGlzYWJsZWQoc3JfZW5hYmxlZCkpOwogCkBAIC0xNTQwLDE4ICsxNTQwLDE4
IEBAIHN0YXRpYyBpbnQgaTkxNV9lbW9uX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KnVudXNlZCkKIAogc3RhdGljIGludCBpOTE1X3JpbmdfZnJlcV90YWJsZShzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0g
JmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBu
b2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUt
Pmd0X3BtLnJwczsKIAl1bnNpZ25lZCBpbnQgbWF4X2dwdV9mcmVxLCBtaW5fZ3B1X2ZyZXE7CiAJ
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGdwdV9mcmVxLCBpYV9mcmVxOwogCi0JaWYg
KCFIQVNfTExDKGRldl9wcml2KSkKKwlpZiAoIUhBU19MTEMoaTkxNSkpCiAJCXJldHVybiAtRU5P
REVWOwogCiAJbWluX2dwdV9mcmVxID0gcnBzLT5taW5fZnJlcTsKIAltYXhfZ3B1X2ZyZXEgPSBy
cHMtPm1heF9mcmVxOwotCWlmIChJU19HRU45X0JDKGRldl9wcml2KSB8fCBJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEwKSB7CisJaWYgKElTX0dFTjlfQkMoaTkxNSkgfHwgSU5URUxfR0VOKGk5MTUp
ID49IDEwKSB7CiAJCS8qIENvbnZlcnQgR1QgZnJlcXVlbmN5IHRvIDUwIEhaIHVuaXRzICovCiAJ
CW1pbl9ncHVfZnJlcSAvPSBHRU45X0ZSRVFfU0NBTEVSOwogCQltYXhfZ3B1X2ZyZXEgLz0gR0VO
OV9GUkVRX1NDQUxFUjsKQEAgLTE1NTksMzAgKzE1NTksMzAgQEAgc3RhdGljIGludCBpOTE1X3Jp
bmdfZnJlcV90YWJsZShzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIAogCXNlcV9w
dXRzKG0sICJHUFUgZnJlcSAoTUh6KVx0RWZmZWN0aXZlIENQVSBmcmVxIChNSHopXHRFZmZlY3Rp
dmUgUmluZyBmcmVxIChNSHopXG4iKTsKIAotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dl
dChkZXZfcHJpdik7CisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwogCWZv
ciAoZ3B1X2ZyZXEgPSBtaW5fZ3B1X2ZyZXE7IGdwdV9mcmVxIDw9IG1heF9ncHVfZnJlcTsgZ3B1
X2ZyZXErKykgewogCQlpYV9mcmVxID0gZ3B1X2ZyZXE7Ci0JCXNhbmR5YnJpZGdlX3Bjb2RlX3Jl
YWQoZGV2X3ByaXYsCisJCXNhbmR5YnJpZGdlX3Bjb2RlX3JlYWQoaTkxNSwKIAkJCQkgICAgICAg
R0VONl9QQ09ERV9SRUFEX01JTl9GUkVRX1RBQkxFLAogCQkJCSAgICAgICAmaWFfZnJlcSwgTlVM
TCk7CiAJCXNlcV9wcmludGYobSwgIiVkXHRcdCVkXHRcdFx0XHQlZFxuIiwKLQkJCSAgIGludGVs
X2dwdV9mcmVxKGRldl9wcml2LCAoZ3B1X2ZyZXEgKgotCQkJCQkJICAgICAoSVNfR0VOOV9CQyhk
ZXZfcHJpdikgfHwKLQkJCQkJCSAgICAgIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgPworCQkJ
ICAgaW50ZWxfZ3B1X2ZyZXEoaTkxNSwgKGdwdV9mcmVxICoKKwkJCQkJCSAgICAgKElTX0dFTjlf
QkMoaTkxNSkgfHwKKwkJCQkJCSAgICAgIElOVEVMX0dFTihpOTE1KSA+PSAxMCA/CiAJCQkJCQkg
ICAgICBHRU45X0ZSRVFfU0NBTEVSIDogMSkpKSwKIAkJCSAgICgoaWFfZnJlcSA+PiAwKSAmIDB4
ZmYpICogMTAwLAogCQkJICAgKChpYV9mcmVxID4+IDgpICYgMHhmZikgKiAxMDApOwogCX0KLQlp
bnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7CisJaW50ZWxfcnVudGltZV9w
bV9wdXQoaTkxNSwgd2FrZXJlZik7CiAKIAlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBpOTE1
X29wcmVnaW9uKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGludGVsX29w
cmVnaW9uICpvcHJlZ2lvbiA9ICZkZXZfcHJpdi0+b3ByZWdpb247CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9ICZpOTE1LT5kcm07CisJc3RydWN0IGludGVsX29wcmVnaW9uICpvcHJlZ2lv
biA9ICZpOTE1LT5vcHJlZ2lvbjsKIAlpbnQgcmV0OwogCiAJcmV0ID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7CkBAIC0xNjEwLDggKzE2MTAsOCBAQCBzdGF0
aWMgaW50IGk5MTVfdmJ0KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCiBzdGF0
aWMgaW50IGk5MTVfZ2VtX2ZyYW1lYnVmZmVyX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lk
ICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9f
aTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5k
cm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJp
dmF0ZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZpOTE1LT5kcm07CiAJc3RydWN0IGlu
dGVsX2ZyYW1lYnVmZmVyICpmYmRldl9mYiA9IE5VTEw7CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZHJtX2ZiOwogCWludCByZXQ7CkBAIC0xNjIxLDggKzE2MjEsOCBAQCBzdGF0aWMgaW50IGk5
MTVfZ2VtX2ZyYW1lYnVmZmVyX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQog
CQlyZXR1cm4gcmV0OwogCiAjaWZkZWYgQ09ORklHX0RSTV9GQkRFVl9FTVVMQVRJT04KLQlpZiAo
ZGV2X3ByaXYtPmZiZGV2ICYmIGRldl9wcml2LT5mYmRldi0+aGVscGVyLmZiKSB7Ci0JCWZiZGV2
X2ZiID0gdG9faW50ZWxfZnJhbWVidWZmZXIoZGV2X3ByaXYtPmZiZGV2LT5oZWxwZXIuZmIpOwor
CWlmIChpOTE1LT5mYmRldiAmJiBpOTE1LT5mYmRldi0+aGVscGVyLmZiKSB7CisJCWZiZGV2X2Zi
ID0gdG9faW50ZWxfZnJhbWVidWZmZXIoaTkxNS0+ZmJkZXYtPmhlbHBlci5mYik7CiAKIAkJc2Vx
X3ByaW50ZihtLCAiZmJjb24gc2l6ZTogJWQgeCAlZCwgZGVwdGggJWQsICVkIGJwcCwgbW9kaWZp
ZXIgMHglbGx4LCByZWZjb3VudCAlZCwgb2JqICIsCiAJCQkgICBmYmRldl9mYi0+YmFzZS53aWR0
aCwKQEAgLTE2NjYsOCArMTY2Niw4IEBAIHN0YXRpYyB2b2lkIGRlc2NyaWJlX2N0eF9yaW5nKHN0
cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGludGVsX3JpbmcgKnJpbmcpCiAKIHN0YXRpYyBpbnQg
aTkxNV9jb250ZXh0X3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJp
dmF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHg7CiAJaW50IHJldDsKIApAQCAtMTY3NSw3ICsxNjc1LDcgQEAgc3RhdGljIGludCBp
OTE1X2NvbnRleHRfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCWlm
IChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmRldl9w
cml2LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZp
OTE1LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7CiAJCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0
ZXIgaXQ7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIApAQCAtMTc0NiwxOCArMTc0Niwx
OCBAQCBzdGF0aWMgY29uc3QgY2hhciAqc3dpenpsZV9zdHJpbmcodW5zaWduZWQgc3dpenpsZSkK
IAogc3RhdGljIGludCBpOTE1X3N3aXp6bGVfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19p
OTE1KG0tPnByaXZhdGUpOwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJp
di0+dW5jb3JlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1
KG0tPnByaXZhdGUpOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1LT51bmNv
cmU7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1
KTsKIAogCXNlcV9wcmludGYobSwgImJpdDYgc3dpenpsZSBmb3IgWC10aWxpbmcgPSAlc1xuIiwK
LQkJICAgc3dpenpsZV9zdHJpbmcoZGV2X3ByaXYtPm1tLmJpdF82X3N3aXp6bGVfeCkpOworCQkg
ICBzd2l6emxlX3N0cmluZyhpOTE1LT5tbS5iaXRfNl9zd2l6emxlX3gpKTsKIAlzZXFfcHJpbnRm
KG0sICJiaXQ2IHN3aXp6bGUgZm9yIFktdGlsaW5nID0gJXNcbiIsCi0JCSAgIHN3aXp6bGVfc3Ry
aW5nKGRldl9wcml2LT5tbS5iaXRfNl9zd2l6emxlX3kpKTsKKwkJICAgc3dpenpsZV9zdHJpbmco
aTkxNS0+bW0uYml0XzZfc3dpenpsZV95KSk7CiAKLQlpZiAoSVNfR0VOX1JBTkdFKGRldl9wcml2
LCAzLCA0KSkgeworCWlmIChJU19HRU5fUkFOR0UoaTkxNSwgMywgNCkpIHsKIAkJc2VxX3ByaW50
ZihtLCAiRERDID0gMHglMDh4XG4iLAogCQkJICAgaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBE
Q0MpKTsKIAkJc2VxX3ByaW50ZihtLCAiRERDMiA9IDB4JTA4eFxuIiwKQEAgLTE3NjYsNyArMTc2
Niw3IEBAIHN0YXRpYyBpbnQgaTkxNV9zd2l6emxlX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQogCQkJICAgaW50ZWxfdW5jb3JlX3JlYWQxNih1bmNvcmUsIEMwRFJCMykpOwog
CQlzZXFfcHJpbnRmKG0sICJDMURSQjMgPSAweCUwNHhcbiIsCiAJCQkgICBpbnRlbF91bmNvcmVf
cmVhZDE2KHVuY29yZSwgQzFEUkIzKSk7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDYpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KSB7CiAJCXNlcV9wcmlu
dGYobSwgIk1BRF9ESU1NX0MwID0gMHglMDh4XG4iLAogCQkJICAgaW50ZWxfdW5jb3JlX3JlYWQo
dW5jb3JlLCBNQURfRElNTV9DMCkpOwogCQlzZXFfcHJpbnRmKG0sICJNQURfRElNTV9DMSA9IDB4
JTA4eFxuIiwKQEAgLTE3NzUsNyArMTc3NSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9zd2l6emxlX2lu
Zm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQkJICAgaW50ZWxfdW5jb3JlX3Jl
YWQodW5jb3JlLCBNQURfRElNTV9DMikpOwogCQlzZXFfcHJpbnRmKG0sICJUSUxFQ1RMID0gMHgl
MDh4XG4iLAogCQkJICAgaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBUSUxFQ1RMKSk7Ci0JCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCkK
IAkJCXNlcV9wcmludGYobSwgIkdBTVRBUkJNT0RFID0gMHglMDh4XG4iLAogCQkJCSAgIGludGVs
X3VuY29yZV9yZWFkKHVuY29yZSwgR0FNVEFSQk1PREUpKTsKIAkJZWxzZQpAQCAtMTc4NSwxMCAr
MTc4NSwxMCBAQCBzdGF0aWMgaW50IGk5MTVfc3dpenpsZV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAq
bSwgdm9pZCAqZGF0YSkKIAkJCSAgIGludGVsX3VuY29yZV9yZWFkKHVuY29yZSwgRElTUF9BUkJf
Q1RMKSk7CiAJfQogCi0JaWYgKGRldl9wcml2LT5xdWlya3MgJiBRVUlSS19QSU5fU1dJWlpMRURf
UEFHRVMpCisJaWYgKGk5MTUtPnF1aXJrcyAmIFFVSVJLX1BJTl9TV0laWkxFRF9QQUdFUykKIAkJ
c2VxX3B1dHMobSwgIkwtc2hhcGVkIG1lbW9yeSBkZXRlY3RlZFxuIik7CiAKLQlpbnRlbF9ydW50
aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkx
NSwgd2FrZXJlZik7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE4MDksNTQgKzE4MDksNTQgQEAgc3Rh
dGljIGNvbnN0IGNoYXIgKnJwc19wb3dlcl90b19zdHIodW5zaWduZWQgaW50IHBvd2VyKQogCiBz
dGF0aWMgaW50IGk5MTVfcnBzX2Jvb3N0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpk
YXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkx
NShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3Bt
LnJwczsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5w
cml2YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCXUz
MiBhY3RfZnJlcSA9IHJwcy0+Y3VyX2ZyZXE7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAK
LQl3aXRoX2ludGVsX3J1bnRpbWVfcG1faWZfaW5fdXNlKGRldl9wcml2LCB3YWtlcmVmKSB7Ci0J
CWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkg
ewotCQkJdmx2X3B1bml0X2dldChkZXZfcHJpdik7Ci0JCQlhY3RfZnJlcSA9IHZsdl9wdW5pdF9y
ZWFkKGRldl9wcml2LAorCXdpdGhfaW50ZWxfcnVudGltZV9wbV9pZl9pbl91c2UoaTkxNSwgd2Fr
ZXJlZikgeworCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUp
KSB7CisJCQl2bHZfcHVuaXRfZ2V0KGk5MTUpOworCQkJYWN0X2ZyZXEgPSB2bHZfcHVuaXRfcmVh
ZChpOTE1LAogCQkJCQkJICBQVU5JVF9SRUdfR1BVX0ZSRVFfU1RTKTsKLQkJCXZsdl9wdW5pdF9w
dXQoZGV2X3ByaXYpOworCQkJdmx2X3B1bml0X3B1dChpOTE1KTsKIAkJCWFjdF9mcmVxID0gKGFj
dF9mcmVxID4+IDgpICYgMHhmZjsKIAkJfSBlbHNlIHsKLQkJCWFjdF9mcmVxID0gaW50ZWxfZ2V0
X2NhZ2YoZGV2X3ByaXYsCisJCQlhY3RfZnJlcSA9IGludGVsX2dldF9jYWdmKGk5MTUsCiAJCQkJ
CQkgIEk5MTVfUkVBRChHRU42X1JQU1RBVDEpKTsKIAkJfQogCX0KIAogCXNlcV9wcmludGYobSwg
IlJQUyBlbmFibGVkPyAlZFxuIiwgcnBzLT5lbmFibGVkKTsKLQlzZXFfcHJpbnRmKG0sICJHUFUg
YnVzeT8gJXNcbiIsIHllc25vKGRldl9wcml2LT5ndC5hd2FrZSkpOworCXNlcV9wcmludGYobSwg
IkdQVSBidXN5PyAlc1xuIiwgeWVzbm8oaTkxNS0+Z3QuYXdha2UpKTsKIAlzZXFfcHJpbnRmKG0s
ICJCb29zdHMgb3V0c3RhbmRpbmc/ICVkXG4iLAogCQkgICBhdG9taWNfcmVhZCgmcnBzLT5udW1f
d2FpdGVycykpOwogCXNlcV9wcmludGYobSwgIkludGVyYWN0aXZlPyAlZFxuIiwgUkVBRF9PTkNF
KHJwcy0+cG93ZXIuaW50ZXJhY3RpdmUpKTsKIAlzZXFfcHJpbnRmKG0sICJGcmVxdWVuY3kgcmVx
dWVzdGVkICVkLCBhY3R1YWwgJWRcbiIsCi0JCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBy
cHMtPmN1cl9mcmVxKSwKLQkJICAgaW50ZWxfZ3B1X2ZyZXEoZGV2X3ByaXYsIGFjdF9mcmVxKSk7
CisJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+Y3VyX2ZyZXEpLAorCQkgICBpbnRlbF9n
cHVfZnJlcShpOTE1LCBhY3RfZnJlcSkpOwogCXNlcV9wcmludGYobSwgIiAgbWluIGhhcmQ6JWQs
IHNvZnQ6JWQ7IG1heCBzb2Z0OiVkLCBoYXJkOiVkXG4iLAotCQkgICBpbnRlbF9ncHVfZnJlcShk
ZXZfcHJpdiwgcnBzLT5taW5fZnJlcSksCi0JCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBy
cHMtPm1pbl9mcmVxX3NvZnRsaW1pdCksCi0JCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBy
cHMtPm1heF9mcmVxX3NvZnRsaW1pdCksCi0JCSAgIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBy
cHMtPm1heF9mcmVxKSk7CisJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+bWluX2ZyZXEp
LAorCQkgICBpbnRlbF9ncHVfZnJlcShpOTE1LCBycHMtPm1pbl9mcmVxX3NvZnRsaW1pdCksCisJ
CSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+bWF4X2ZyZXFfc29mdGxpbWl0KSwKKwkJICAg
aW50ZWxfZ3B1X2ZyZXEoaTkxNSwgcnBzLT5tYXhfZnJlcSkpOwogCXNlcV9wcmludGYobSwgIiAg
aWRsZTolZCwgZWZmaWNpZW50OiVkLCBib29zdDolZFxuIiwKLQkJICAgaW50ZWxfZ3B1X2ZyZXEo
ZGV2X3ByaXYsIHJwcy0+aWRsZV9mcmVxKSwKLQkJICAgaW50ZWxfZ3B1X2ZyZXEoZGV2X3ByaXYs
IHJwcy0+ZWZmaWNpZW50X2ZyZXEpLAotCQkgICBpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwgcnBz
LT5ib29zdF9mcmVxKSk7CisJCSAgIGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+aWRsZV9mcmVx
KSwKKwkJICAgaW50ZWxfZ3B1X2ZyZXEoaTkxNSwgcnBzLT5lZmZpY2llbnRfZnJlcSksCisJCSAg
IGludGVsX2dwdV9mcmVxKGk5MTUsIHJwcy0+Ym9vc3RfZnJlcSkpOwogCiAJc2VxX3ByaW50Ziht
LCAiV2FpdCBib29zdHM6ICVkXG4iLCBhdG9taWNfcmVhZCgmcnBzLT5ib29zdHMpKTsKIAotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDYgJiYgcnBzLT5lbmFibGVkICYmIGRldl9wcml2LT5n
dC5hd2FrZSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNiAmJiBycHMtPmVuYWJsZWQgJiYg
aTkxNS0+Z3QuYXdha2UpIHsKIAkJdTMyIHJwdXAsIHJwdXBlaTsKIAkJdTMyIHJwZG93biwgcnBk
b3duZWk7CiAKLQkJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9wcml2LT51bmNvcmUs
IEZPUkNFV0FLRV9BTEwpOworCQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5j
b3JlLCBGT1JDRVdBS0VfQUxMKTsKIAkJcnB1cCA9IEk5MTVfUkVBRF9GVyhHRU42X1JQX0NVUl9V
UCkgJiBHRU42X1JQX0VJX01BU0s7CiAJCXJwdXBlaSA9IEk5MTVfUkVBRF9GVyhHRU42X1JQX0NV
Ul9VUF9FSSkgJiBHRU42X1JQX0VJX01BU0s7CiAJCXJwZG93biA9IEk5MTVfUkVBRF9GVyhHRU42
X1JQX0NVUl9ET1dOKSAmIEdFTjZfUlBfRUlfTUFTSzsKIAkJcnBkb3duZWkgPSBJOTE1X1JFQURf
RlcoR0VONl9SUF9DVVJfRE9XTl9FSSkgJiBHRU42X1JQX0VJX01BU0s7Ci0JCWludGVsX3VuY29y
ZV9mb3JjZXdha2VfcHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwkJaW50
ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAK
IAkJc2VxX3ByaW50ZihtLCAiXG5SUFMgQXV0b3R1bmluZyAoY3VycmVudCBcIiVzXCIgd2luZG93
KTpcbiIsCiAJCQkgICBycHNfcG93ZXJfdG9fc3RyKHJwcy0+cG93ZXIubW9kZSkpOwpAQCAtMTg3
NSwyOSArMTg3NSwyOSBAQCBzdGF0aWMgaW50IGk5MTVfcnBzX2Jvb3N0X2luZm8oc3RydWN0IHNl
cV9maWxlICptLCB2b2lkICpkYXRhKQogCiBzdGF0aWMgaW50IGk5MTVfbGxjKHN0cnVjdCBzZXFf
ZmlsZSAqbSwgdm9pZCAqZGF0YSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0JY29uc3QgYm9vbCBlZHJhbSA9IElOVEVM
X0dFTihkZXZfcHJpdikgPiA4OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9k
ZV90b19pOTE1KG0tPnByaXZhdGUpOworCWNvbnN0IGJvb2wgZWRyYW0gPSBJTlRFTF9HRU4oaTkx
NSkgPiA4OwogCi0Jc2VxX3ByaW50ZihtLCAiTExDOiAlc1xuIiwgeWVzbm8oSEFTX0xMQyhkZXZf
cHJpdikpKTsKKwlzZXFfcHJpbnRmKG0sICJMTEM6ICVzXG4iLCB5ZXNubyhIQVNfTExDKGk5MTUp
KSk7CiAJc2VxX3ByaW50ZihtLCAiJXM6ICV1TUJcbiIsIGVkcmFtID8gImVEUkFNIiA6ICJlTExD
IiwKLQkJICAgZGV2X3ByaXYtPmVkcmFtX3NpemVfbWIpOworCQkgICBpOTE1LT5lZHJhbV9zaXpl
X21iKTsKIAogCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IGk5MTVfaHVjX2xvYWRfc3RhdHVz
X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKIAlpbnRl
bF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1Y3QgZHJtX3ByaW50ZXIgcDsKIAotCWlmICghSEFT
X0hVQyhkZXZfcHJpdikpCisJaWYgKCFIQVNfSFVDKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsK
IAogCXAgPSBkcm1fc2VxX2ZpbGVfcHJpbnRlcihtKTsKLQlpbnRlbF91Y19md19kdW1wKCZkZXZf
cHJpdi0+aHVjLmZ3LCAmcCk7CisJaW50ZWxfdWNfZndfZHVtcCgmaTkxNS0+aHVjLmZ3LCAmcCk7
CiAKLQl3aXRoX2ludGVsX3J1bnRpbWVfcG0oZGV2X3ByaXYsIHdha2VyZWYpCisJd2l0aF9pbnRl
bF9ydW50aW1lX3BtKGk5MTUsIHdha2VyZWYpCiAJCXNlcV9wcmludGYobSwgIlxuSHVDIHN0YXR1
cyAweCUwOHg6XG4iLCBJOTE1X1JFQUQoSFVDX1NUQVRVUzIpKTsKIAogCXJldHVybiAwOwpAQCAt
MTkwNSwxNyArMTkwNSwxNyBAQCBzdGF0aWMgaW50IGk5MTVfaHVjX2xvYWRfc3RhdHVzX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiBzdGF0aWMgaW50IGk5MTVfZ3VjX2xv
YWRfc3RhdHVzX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRl
KTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1Y3QgZHJtX3ByaW50ZXIgcDsKIAot
CWlmICghSEFTX0dVQyhkZXZfcHJpdikpCisJaWYgKCFIQVNfR1VDKGk5MTUpKQogCQlyZXR1cm4g
LUVOT0RFVjsKIAogCXAgPSBkcm1fc2VxX2ZpbGVfcHJpbnRlcihtKTsKLQlpbnRlbF91Y19md19k
dW1wKCZkZXZfcHJpdi0+Z3VjLmZ3LCAmcCk7CisJaW50ZWxfdWNfZndfZHVtcCgmaTkxNS0+Z3Vj
LmZ3LCAmcCk7CiAKLQl3aXRoX2ludGVsX3J1bnRpbWVfcG0oZGV2X3ByaXYsIHdha2VyZWYpIHsK
Kwl3aXRoX2ludGVsX3J1bnRpbWVfcG0oaTkxNSwgd2FrZXJlZikgewogCQl1MzIgdG1wID0gSTkx
NV9SRUFEKEdVQ19TVEFUVVMpOwogCQl1MzIgaTsKIApAQCAtMTk1NCw5ICsxOTU0LDkgQEAgc3Ry
aW5naWZ5X2d1Y19sb2dfdHlwZShlbnVtIGd1Y19sb2dfYnVmZmVyX3R5cGUgdHlwZSkKIH0KIAog
c3RhdGljIHZvaWQgaTkxNV9ndWNfbG9nX2luZm8oc3RydWN0IHNlcV9maWxlICptLAotCQkJICAg
ICAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorCQkJICAgICAgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2d1Y19sb2cgKmxvZyA9ICZk
ZXZfcHJpdi0+Z3VjLmxvZzsKKwlzdHJ1Y3QgaW50ZWxfZ3VjX2xvZyAqbG9nID0gJmk5MTUtPmd1
Yy5sb2c7CiAJZW51bSBndWNfbG9nX2J1ZmZlcl90eXBlIHR5cGU7CiAKIAlpZiAoIWludGVsX2d1
Y19sb2dfcmVsYXlfZW5hYmxlZChsb2cpKSB7CkBAIC0xOTc4LDcgKzE5NzgsNyBAQCBzdGF0aWMg
dm9pZCBpOTE1X2d1Y19sb2dfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiB9CiAKIHN0YXRpYyB2
b2lkIGk5MTVfZ3VjX2NsaWVudF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwKLQkJCQkgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCSBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkgc3RydWN0IGludGVsX2d1Y19jbGllbnQgKmNsaWVudCkKIHsKIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CkBAIC0xOTkwLDcgKzE5OTAsNyBAQCBzdGF0aWMg
dm9pZCBpOTE1X2d1Y19jbGllbnRfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJc2VxX3ByaW50
ZihtLCAiXHREb29yYmVsbCBpZCAlZCwgb2Zmc2V0OiAweCVseFxuIiwKIAkJY2xpZW50LT5kb29y
YmVsbF9pZCwgY2xpZW50LT5kb29yYmVsbF9vZmZzZXQpOwogCi0JZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgZGV2X3ByaXYsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQp
IHsKIAkJdTY0IHN1Ym1pc3Npb25zID0gY2xpZW50LT5zdWJtaXNzaW9uc1tpZF07CiAJCXRvdCAr
PSBzdWJtaXNzaW9uczsKIAkJc2VxX3ByaW50ZihtLCAiXHRTdWJtaXNzaW9uczogJWxsdSAlc1xu
IiwKQEAgLTIwMDEsMTUgKzIwMDEsMTUgQEAgc3RhdGljIHZvaWQgaTkxNV9ndWNfY2xpZW50X2lu
Zm8oc3RydWN0IHNlcV9maWxlICptLAogCiBzdGF0aWMgaW50IGk5MTVfZ3VjX2luZm8oc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQljb25zdCBzdHJ1Y3QgaW50ZWxf
Z3VjICpndWMgPSAmZGV2X3ByaXYtPmd1YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfZ3VjICpn
dWMgPSAmaTkxNS0+Z3VjOwogCi0JaWYgKCFVU0VTX0dVQyhkZXZfcHJpdikpCisJaWYgKCFVU0VT
X0dVQyhpOTE1KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlpOTE1X2d1Y19sb2dfaW5mbyhtLCBk
ZXZfcHJpdik7CisJaTkxNV9ndWNfbG9nX2luZm8obSwgaTkxNSk7CiAKLQlpZiAoIVVTRVNfR1VD
X1NVQk1JU1NJT04oZGV2X3ByaXYpKQorCWlmICghVVNFU19HVUNfU1VCTUlTU0lPTihpOTE1KSkK
IAkJcmV0dXJuIDA7CiAKIAlHRU1fQlVHX09OKCFndWMtPmV4ZWNidWZfY2xpZW50KTsKQEAgLTIw
MTksMTEgKzIwMTksMTEgQEAgc3RhdGljIGludCBpOTE1X2d1Y19pbmZvKHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqZGF0YSkKIAlzZXFfcHJpbnRmKG0sICJEb29yYmVsbCBuZXh0IGNhY2hlbGlu
ZTogMHgleFxuIiwgZ3VjLT5kYl9jYWNoZWxpbmUpOwogCiAJc2VxX3ByaW50ZihtLCAiXG5HdUMg
ZXhlY2J1ZiBjbGllbnQgQCAlcDpcbiIsIGd1Yy0+ZXhlY2J1Zl9jbGllbnQpOwotCWk5MTVfZ3Vj
X2NsaWVudF9pbmZvKG0sIGRldl9wcml2LCBndWMtPmV4ZWNidWZfY2xpZW50KTsKKwlpOTE1X2d1
Y19jbGllbnRfaW5mbyhtLCBpOTE1LCBndWMtPmV4ZWNidWZfY2xpZW50KTsKIAlpZiAoZ3VjLT5w
cmVlbXB0X2NsaWVudCkgewogCQlzZXFfcHJpbnRmKG0sICJcbkd1QyBwcmVlbXB0IGNsaWVudCBA
ICVwOlxuIiwKIAkJCSAgIGd1Yy0+cHJlZW1wdF9jbGllbnQpOwotCQlpOTE1X2d1Y19jbGllbnRf
aW5mbyhtLCBkZXZfcHJpdiwgZ3VjLT5wcmVlbXB0X2NsaWVudCk7CisJCWk5MTVfZ3VjX2NsaWVu
dF9pbmZvKG0sIGk5MTUsIGd1Yy0+cHJlZW1wdF9jbGllbnQpOwogCX0KIAogCS8qIEFkZCBtb3Jl
IGFzIHJlcXVpcmVkIC4uLiAqLwpAQCAtMjAzMywxNCArMjAzMywxNCBAQCBzdGF0aWMgaW50IGk5
MTVfZ3VjX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiBzdGF0aWMgaW50
IGk5MTVfZ3VjX3N0YWdlX3Bvb2woc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2
YXRlKTsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmZGV2X3ByaXYtPmd1YzsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsK
Kwljb25zdCBzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3VjOwogCXN0cnVjdCBndWNf
c3RhZ2VfZGVzYyAqZGVzYyA9IGd1Yy0+c3RhZ2VfZGVzY19wb29sX3ZhZGRyOwogCXN0cnVjdCBp
bnRlbF9ndWNfY2xpZW50ICpjbGllbnQgPSBndWMtPmV4ZWNidWZfY2xpZW50OwogCWludGVsX2Vu
Z2luZV9tYXNrX3QgdG1wOwogCWludCBpbmRleDsKIAotCWlmICghVVNFU19HVUNfU1VCTUlTU0lP
TihkZXZfcHJpdikpCisJaWYgKCFVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQogCQlyZXR1cm4g
LUVOT0RFVjsKIAogCWZvciAoaW5kZXggPSAwOyBpbmRleCA8IEdVQ19NQVhfU1RBR0VfREVTQ1JJ
UFRPUlM7IGluZGV4KyssIGRlc2MrKykgewpAQCAtMjA2Niw3ICsyMDY2LDcgQEAgc3RhdGljIGlu
dCBpOTE1X2d1Y19zdGFnZV9wb29sKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAkJ
CSAgIGRlc2MtPndxX2FkZHIsIGRlc2MtPndxX3NpemUpOwogCQlzZXFfcHV0YyhtLCAnXG4nKTsK
IAotCQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2luZSwgZGV2X3ByaXYsIGNsaWVudC0+ZW5n
aW5lcywgdG1wKSB7CisJCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBpOTE1LCBjbGll
bnQtPmVuZ2luZXMsIHRtcCkgewogCQkJdTMyIGd1Y19lbmdpbmVfaWQgPSBlbmdpbmUtPmd1Y19p
ZDsKIAkJCXN0cnVjdCBndWNfZXhlY2xpc3RfY29udGV4dCAqbHJjID0KIAkJCQkJCSZkZXNjLT5s
cmNbZ3VjX2VuZ2luZV9pZF07CkBAIC0yMDg4LDE5ICsyMDg4LDE5IEBAIHN0YXRpYyBpbnQgaTkx
NV9ndWNfc3RhZ2VfcG9vbChzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiBzdGF0aWMg
aW50IGk5MTVfZ3VjX2xvZ19kdW1wKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIHsK
IAlzdHJ1Y3QgZHJtX2luZm9fbm9kZSAqbm9kZSA9IG0tPnByaXZhdGU7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG5vZGUpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG5vZGUpOwogCWJvb2wgZHVtcF9sb2Fk
X2VyciA9ICEhbm9kZS0+aW5mb19lbnQtPmRhdGE7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiA9IE5VTEw7CiAJdTMyICpsb2c7CiAJaW50IGkgPSAwOwogCi0JaWYgKCFIQVNfR1VD
KGRldl9wcml2KSkKKwlpZiAoIUhBU19HVUMoaTkxNSkpCiAJCXJldHVybiAtRU5PREVWOwogCiAJ
aWYgKGR1bXBfbG9hZF9lcnIpCi0JCW9iaiA9IGRldl9wcml2LT5ndWMubG9hZF9lcnJfbG9nOwot
CWVsc2UgaWYgKGRldl9wcml2LT5ndWMubG9nLnZtYSkKLQkJb2JqID0gZGV2X3ByaXYtPmd1Yy5s
b2cudm1hLT5vYmo7CisJCW9iaiA9IGk5MTUtPmd1Yy5sb2FkX2Vycl9sb2c7CisJZWxzZSBpZiAo
aTkxNS0+Z3VjLmxvZy52bWEpCisJCW9iaiA9IGk5MTUtPmd1Yy5sb2cudm1hLT5vYmo7CiAKIAlp
ZiAoIW9iaikKIAkJcmV0dXJuIDA7CkBAIC0yMTI2LDI0ICsyMTI2LDI0IEBAIHN0YXRpYyBpbnQg
aTkxNV9ndWNfbG9nX2R1bXAoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiBzdGF0
aWMgaW50IGk5MTVfZ3VjX2xvZ19sZXZlbF9nZXQodm9pZCAqZGF0YSwgdTY0ICp2YWwpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGRhdGE7CiAKLQlpZiAoIVVTRVNfR1VDKGRldl9wcml2KSkKKwlp
ZiAoIVVTRVNfR1VDKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCSp2YWwgPSBpbnRlbF9n
dWNfbG9nX2dldF9sZXZlbCgmZGV2X3ByaXYtPmd1Yy5sb2cpOworCSp2YWwgPSBpbnRlbF9ndWNf
bG9nX2dldF9sZXZlbCgmaTkxNS0+Z3VjLmxvZyk7CiAKIAlyZXR1cm4gMDsKIH0KIAogc3RhdGlj
IGludCBpOTE1X2d1Y19sb2dfbGV2ZWxfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGRhdGE7CiAKLQlpZiAoIVVTRVNfR1VDKGRldl9wcml2KSkKKwlpZiAo
IVVTRVNfR1VDKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXJldHVybiBpbnRlbF9ndWNf
bG9nX3NldF9sZXZlbCgmZGV2X3ByaXYtPmd1Yy5sb2csIHZhbCk7CisJcmV0dXJuIGludGVsX2d1
Y19sb2dfc2V0X2xldmVsKCZpOTE1LT5ndWMubG9nLCB2YWwpOwogfQogCiBERUZJTkVfU0lNUExF
X0FUVFJJQlVURShpOTE1X2d1Y19sb2dfbGV2ZWxfZm9wcywKQEAgLTIxNTIsMTQgKzIxNTIsMTQg
QEAgREVGSU5FX1NJTVBMRV9BVFRSSUJVVEUoaTkxNV9ndWNfbG9nX2xldmVsX2ZvcHMsCiAKIHN0
YXRpYyBpbnQgaTkxNV9ndWNfbG9nX3JlbGF5X29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3Ry
dWN0IGZpbGUgKmZpbGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
aW5vZGUtPmlfcHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGlub2Rl
LT5pX3ByaXZhdGU7CiAKLQlpZiAoIVVTRVNfR1VDKGRldl9wcml2KSkKKwlpZiAoIVVTRVNfR1VD
KGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCWZpbGUtPnByaXZhdGVfZGF0YSA9ICZkZXZf
cHJpdi0+Z3VjLmxvZzsKKwlmaWxlLT5wcml2YXRlX2RhdGEgPSAmaTkxNS0+Z3VjLmxvZzsKIAot
CXJldHVybiBpbnRlbF9ndWNfbG9nX3JlbGF5X29wZW4oJmRldl9wcml2LT5ndWMubG9nKTsKKwly
ZXR1cm4gaW50ZWxfZ3VjX2xvZ19yZWxheV9vcGVuKCZpOTE1LT5ndWMubG9nKTsKIH0KIAogc3Rh
dGljIHNzaXplX3QKQEAgLTIxNzcsOSArMjE3Nyw5IEBAIGk5MTVfZ3VjX2xvZ19yZWxheV93cml0
ZShzdHJ1Y3QgZmlsZSAqZmlscCwKIAogc3RhdGljIGludCBpOTE1X2d1Y19sb2dfcmVsYXlfcmVs
ZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBpbm9kZS0+aV9wcml2YXRlOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gaW5vZGUtPmlfcHJpdmF0ZTsKIAotCWludGVsX2d1Y19s
b2dfcmVsYXlfY2xvc2UoJmRldl9wcml2LT5ndWMubG9nKTsKKwlpbnRlbF9ndWNfbG9nX3JlbGF5
X2Nsb3NlKCZpOTE1LT5ndWMubG9nKTsKIAogCXJldHVybiAwOwogfQpAQCAtMjIwNSwxMiArMjIw
NSwxMiBAQCBzdGF0aWMgaW50IGk5MTVfcHNyX3Npbmtfc3RhdHVzX3Nob3coc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpkYXRhKQogCQkic2luayBpbnRlcm5hbCBlcnJvciIsCiAJfTsKIAlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOwogCXN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAgPQogCQllbmNfdG9faW50ZWxfZHAoJmludGVsX2F0dGFjaGVk
X2VuY29kZXIoY29ubmVjdG9yKS0+YmFzZSk7CiAJaW50IHJldDsKIAotCWlmICghQ0FOX1BTUihk
ZXZfcHJpdikpIHsKKwlpZiAoIUNBTl9QU1IoaTkxNSkpIHsKIAkJc2VxX3B1dHMobSwgIlBTUiBV
bnN1cHBvcnRlZFxuIik7CiAJCXJldHVybiAtRU5PREVWOwogCX0KQEAgLTIyMzYsMTIgKzIyMzYs
MTIgQEAgc3RhdGljIGludCBpOTE1X3Bzcl9zaW5rX3N0YXR1c19zaG93KHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqZGF0YSkKIERFRklORV9TSE9XX0FUVFJJQlVURShpOTE1X3Bzcl9zaW5rX3N0
YXR1cyk7CiAKIHN0YXRpYyB2b2lkCi1wc3Jfc291cmNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmlsZSAqbSkKK3Bzcl9zb3VyY2Vfc3RhdHVz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiB7CiAJ
dTMyIHZhbCwgc3RhdHVzX3ZhbDsKIAljb25zdCBjaGFyICpzdGF0dXMgPSAidW5rbm93biI7CiAK
LQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwlpZiAoaTkxNS0+cHNyLnBzcjJf
ZW5hYmxlZCkgewogCQlzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGxpdmVfc3RhdHVzW10gPSB7
CiAJCQkiSURMRSIsCiAJCQkiQ0FQVFVSRSIsCkBAIC0yMjgzLDE0ICsyMjgzLDE0IEBAIHBzcl9z
b3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNl
cV9maWxlICptKQogCiBzdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZk
ZXZfcHJpdi0+cHNyOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19p
OTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmk5MTUtPnBzcjsKIAlp
bnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAljb25zdCBjaGFyICpzdGF0dXM7CiAJYm9vbCBlbmFi
bGVkOwogCXUzMiB2YWw7CiAKLQlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQorCWlmICghSEFTX1BT
UihpOTE1KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlzZXFfcHJpbnRmKG0sICJTaW5rIHN1cHBv
cnQ6ICVzIiwgeWVzbm8ocHNyLT5zaW5rX3N1cHBvcnQpKTsKQEAgLTIzMDEsNyArMjMwMSw3IEBA
IHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KmRhdGEpCiAJaWYgKCFwc3ItPnNpbmtfc3VwcG9ydCkKIAkJcmV0dXJuIDA7CiAKLQl3YWtlcmVm
ID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50
aW1lX3BtX2dldChpOTE1KTsKIAltdXRleF9sb2NrKCZwc3ItPmxvY2spOwogCiAJaWYgKHBzci0+
ZW5hYmxlZCkKQEAgLTIzMjIsMTQgKzIzMjIsMTQgQEAgc3RhdGljIGludCBpOTE1X2VkcF9wc3Jf
c3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAl9CiAJc2VxX3ByaW50Ziht
LCAiU291cmNlIFBTUiBjdGw6ICVzIFsweCUwOHhdXG4iLAogCQkgICBlbmFibGVkZGlzYWJsZWQo
ZW5hYmxlZCksIHZhbCk7Ci0JcHNyX3NvdXJjZV9zdGF0dXMoZGV2X3ByaXYsIG0pOworCXBzcl9z
b3VyY2Vfc3RhdHVzKGk5MTUsIG0pOwogCXNlcV9wcmludGYobSwgIkJ1c3kgZnJvbnRidWZmZXIg
Yml0czogMHglMDh4XG4iLAogCQkgICBwc3ItPmJ1c3lfZnJvbnRidWZmZXJfYml0cyk7CiAKIAkv
KgogCSAqIFNLTCsgUGVyZiBjb3VudGVyIGlzIHJlc2V0IHRvIDAgZXZlcnl0aW1lIERDIHN0YXRl
IGlzIGVudGVyZWQKIAkgKi8KLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURX
RUxMKGRldl9wcml2KSkgeworCWlmIChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FEV0VMTChp
OTE1KSkgewogCQl2YWwgPSBJOTE1X1JFQUQoRURQX1BTUl9QRVJGX0NOVCkgJiBFRFBfUFNSX1BF
UkZfQ05UX01BU0s7CiAJCXNlcV9wcmludGYobSwgIlBlcmZvcm1hbmNlIGNvdW50ZXI6ICV1XG4i
LCB2YWwpOwogCX0KQEAgLTIzNjUsNyArMjM2NSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNy
X3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIHVubG9jazoKIAltdXRl
eF91bmxvY2soJnBzci0+bG9jayk7Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYsIHdh
a2VyZWYpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwogCiAJcmV0dXJu
IDA7CiB9CkBAIC0yMzczLDIwICsyMzczLDIwIEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0
YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiBzdGF0aWMgaW50CiBpOTE1X2Vk
cF9wc3JfZGVidWdfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IGRhdGE7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IHJldDsKIAotCWlmICgh
Q0FOX1BTUihkZXZfcHJpdikpCisJaWYgKCFDQU5fUFNSKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RF
VjsKIAogCURSTV9ERUJVR19LTVMoIlNldHRpbmcgUFNSIGRlYnVnIHRvICVsbHhcbiIsIHZhbCk7
CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOworCXdha2VyZWYg
PSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAotCXJldCA9IGludGVsX3Bzcl9kZWJ1Z19z
ZXQoZGV2X3ByaXYsIHZhbCk7CisJcmV0ID0gaW50ZWxfcHNyX2RlYnVnX3NldChpOTE1LCB2YWwp
OwogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYsIHdha2VyZWYpOworCWludGVsX3J1
bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTIzOTQs
MTIgKzIzOTQsMTIgQEAgaTkxNV9lZHBfcHNyX2RlYnVnX3NldCh2b2lkICpkYXRhLCB1NjQgdmFs
KQogc3RhdGljIGludAogaTkxNV9lZHBfcHNyX2RlYnVnX2dldCh2b2lkICpkYXRhLCB1NjQgKnZh
bCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkYXRhOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJp
dikpCisJaWYgKCFDQU5fUFNSKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCSp2YWwgPSBS
RUFEX09OQ0UoZGV2X3ByaXYtPnBzci5kZWJ1Zyk7CisJKnZhbCA9IFJFQURfT05DRShpOTE1LT5w
c3IuZGVidWcpOwogCXJldHVybiAwOwogfQogCkBAIC0yNDA5LDE5ICsyNDA5LDE5IEBAIERFRklO
RV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfZWRwX3Bzcl9kZWJ1Z19mb3BzLAogCiBzdGF0aWMgaW50
IGk5MTVfZW5lcmd5X3VKKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0
ZSk7CiAJdW5zaWduZWQgbG9uZyBsb25nIHBvd2VyOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVm
OwogCXUzMiB1bml0czsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNikKKwlpZiAoSU5U
RUxfR0VOKGk5MTUpIDwgNikKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlpZiAocmRtc3JsX3NhZmUo
TVNSX1JBUExfUE9XRVJfVU5JVCwgJnBvd2VyKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAl1bml0
cyA9IChwb3dlciAmIDB4MWYwMCkgPj4gODsKLQl3aXRoX2ludGVsX3J1bnRpbWVfcG0oZGV2X3By
aXYsIHdha2VyZWYpCisJd2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5MTUsIHdha2VyZWYpCiAJCXBv
d2VyID0gSTkxNV9SRUFEKE1DSF9TRUNQX05SR19TVFRTKTsKIAogCXBvd2VyID0gKDEwMDAwMDAg
KiBwb3dlcikgPj4gdW5pdHM7IC8qIGNvbnZlcnQgdG8gdUogKi8KQEAgLTI0MzIsMjEgKzI0MzIs
MjEgQEAgc3RhdGljIGludCBpOTE1X2VuZXJneV91SihzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KmRhdGEpCiAKIHN0YXRpYyBpbnQgaTkxNV9ydW50aW1lX3BtX3N0YXR1cyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBk
ZXZfcHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2Rl
X3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0u
cGRldjsKIAotCWlmICghSEFTX1JVTlRJTUVfUE0oZGV2X3ByaXYpKQorCWlmICghSEFTX1JVTlRJ
TUVfUE0oaTkxNSkpCiAJCXNlcV9wdXRzKG0sICJSdW50aW1lIHBvd2VyIG1hbmFnZW1lbnQgbm90
IHN1cHBvcnRlZFxuIik7CiAKIAlzZXFfcHJpbnRmKG0sICJSdW50aW1lIHBvd2VyIHN0YXR1czog
JXNcbiIsCi0JCSAgIGVuYWJsZWRkaXNhYmxlZCghZGV2X3ByaXYtPnBvd2VyX2RvbWFpbnMud2Fr
ZXJlZikpOworCQkgICBlbmFibGVkZGlzYWJsZWQoIWk5MTUtPnBvd2VyX2RvbWFpbnMud2FrZXJl
ZikpOwogCi0Jc2VxX3ByaW50ZihtLCAiR1BVIGlkbGU6ICVzXG4iLCB5ZXNubyghZGV2X3ByaXYt
Pmd0LmF3YWtlKSk7CisJc2VxX3ByaW50ZihtLCAiR1BVIGlkbGU6ICVzXG4iLCB5ZXNubyghaTkx
NS0+Z3QuYXdha2UpKTsKIAlzZXFfcHJpbnRmKG0sICJJUlFzIGRpc2FibGVkOiAlc1xuIiwKLQkJ
ICAgeWVzbm8oIWludGVsX2lycXNfZW5hYmxlZChkZXZfcHJpdikpKTsKKwkJICAgeWVzbm8oIWlu
dGVsX2lycXNfZW5hYmxlZChpOTE1KSkpOwogI2lmZGVmIENPTkZJR19QTQogCXNlcV9wcmludGYo
bSwgIlVzYWdlIGNvdW50OiAlZFxuIiwKLQkJICAgYXRvbWljX3JlYWQoJmRldl9wcml2LT5kcm0u
ZGV2LT5wb3dlci51c2FnZV9jb3VudCkpOworCQkgICBhdG9taWNfcmVhZCgmaTkxNS0+ZHJtLmRl
di0+cG93ZXIudXNhZ2VfY291bnQpKTsKICNlbHNlCiAJc2VxX3ByaW50ZihtLCAiRGV2aWNlIFBv
d2VyIE1hbmFnZW1lbnQgKENPTkZJR19QTSkgZGlzYWJsZWRcbiIpOwogI2VuZGlmCkBAIC0yNDU3
LDcgKzI0NTcsNyBAQCBzdGF0aWMgaW50IGk5MTVfcnVudGltZV9wbV9zdGF0dXMoc3RydWN0IHNl
cV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJaWYgKElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1
X0RFQlVHX1JVTlRJTUVfUE0pKSB7CiAJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX3NlcV9m
aWxlX3ByaW50ZXIobSk7CiAKLQkJcHJpbnRfaW50ZWxfcnVudGltZV9wbV93YWtlcmVmKGRldl9w
cml2LCAmcCk7CisJCXByaW50X2ludGVsX3J1bnRpbWVfcG1fd2FrZXJlZihpOTE1LCAmcCk7CiAJ
fQogCiAJcmV0dXJuIDA7CkBAIC0yNDY1LDggKzI0NjUsOCBAQCBzdGF0aWMgaW50IGk5MTVfcnVu
dGltZV9wbV9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAKIHN0YXRp
YyBpbnQgaTkxNV9wb3dlcl9kb21haW5faW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVu
dXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5
MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlu
cyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21h
aW5zICpwb3dlcl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7CiAJaW50IGk7CiAKIAlt
dXRleF9sb2NrKCZwb3dlcl9kb21haW5zLT5sb2NrKTsKQEAgLTI0OTMsMTYgKzI0OTMsMTYgQEAg
c3RhdGljIGludCBpOTE1X3Bvd2VyX2RvbWFpbl9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9p
ZCAqdW51c2VkKQogCiBzdGF0aWMgaW50IGk5MTVfZG1jX2luZm8oc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICp1bnVzZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
bm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwog
CXN0cnVjdCBpbnRlbF9jc3IgKmNzcjsKIAotCWlmICghSEFTX0NTUihkZXZfcHJpdikpCisJaWYg
KCFIQVNfQ1NSKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCWNzciA9ICZkZXZfcHJpdi0+
Y3NyOworCWNzciA9ICZpOTE1LT5jc3I7CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAog
CXNlcV9wcmludGYobSwgImZ3IGxvYWRlZDogJXNcbiIsIHllc25vKGNzci0+ZG1jX3BheWxvYWQg
IT0gTlVMTCkpOwogCXNlcV9wcmludGYobSwgInBhdGg6ICVzXG4iLCBjc3ItPmZ3X3BhdGgpOwpA
QCAtMjUxMywxMyArMjUxMywxMyBAQCBzdGF0aWMgaW50IGk5MTVfZG1jX2luZm8oc3RydWN0IHNl
cV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJc2VxX3ByaW50ZihtLCAidmVyc2lvbjogJWQuJWRc
biIsIENTUl9WRVJTSU9OX01BSk9SKGNzci0+dmVyc2lvbiksCiAJCSAgIENTUl9WRVJTSU9OX01J
Tk9SKGNzci0+dmVyc2lvbikpOwogCi0JaWYgKFdBUk5fT04oSU5URUxfR0VOKGRldl9wcml2KSA+
IDExKSkKKwlpZiAoV0FSTl9PTihJTlRFTF9HRU4oaTkxNSkgPiAxMSkpCiAJCWdvdG8gb3V0Owog
CiAJc2VxX3ByaW50ZihtLCAiREMzIC0+IERDNSBjb3VudDogJWRcbiIsCi0JCSAgIEk5MTVfUkVB
RChJU19CUk9YVE9OKGRldl9wcml2KSA/IEJYVF9DU1JfREMzX0RDNV9DT1VOVCA6CisJCSAgIEk5
MTVfUkVBRChJU19CUk9YVE9OKGk5MTUpID8gQlhUX0NTUl9EQzNfREM1X0NPVU5UIDoKIAkJCQkJ
CSAgICBTS0xfQ1NSX0RDM19EQzVfQ09VTlQpKTsKLQlpZiAoIUlTX0dFTjlfTFAoZGV2X3ByaXYp
KQorCWlmICghSVNfR0VOOV9MUChpOTE1KSkKIAkJc2VxX3ByaW50ZihtLCAiREM1IC0+IERDNiBj
b3VudDogJWRcbiIsCiAJCQkgICBJOTE1X1JFQUQoU0tMX0NTUl9EQzVfREM2X0NPVU5UKSk7CiAK
QEAgLTI1MjgsNyArMjUyOCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9kbWNfaW5mbyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIAlzZXFfcHJpbnRmKG0sICJzc3AgYmFzZTogMHglMDh4
XG4iLCBJOTE1X1JFQUQoQ1NSX1NTUF9CQVNFKSk7CiAJc2VxX3ByaW50ZihtLCAiaHRwOiAweCUw
OHhcbiIsIEk5MTVfUkVBRChDU1JfSFRQX1NLTCkpOwogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQo
ZGV2X3ByaXYsIHdha2VyZWYpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYp
OwogCiAJcmV0dXJuIDA7CiB9CkBAIC0yNTQ4LDggKzI1NDgsOCBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9lbmNvZGVyX2luZm8oc3RydWN0IHNlcV9maWxlICptLAogCQkJICAgICAgIHN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjLAogCQkJICAgICAgIHN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRl
bF9lbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVf
dG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2
LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+
cHJpdmF0ZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZpOTE1LT5kcm07CiAJc3RydWN0
IGRybV9jcnRjICpjcnRjID0gJmludGVsX2NydGMtPmJhc2U7CiAJc3RydWN0IGludGVsX2Nvbm5l
Y3RvciAqaW50ZWxfY29ubmVjdG9yOwogCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKQEAg
LTI1NzUsOCArMjU3NSw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuY29kZXJfaW5mbyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sCiAKIHN0YXRpYyB2b2lkIGludGVsX2NydGNfaW5mbyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9ICZpOTE1LT5kcm07CiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gJmludGVsX2NydGMt
PmJhc2U7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXI7CiAJc3RydWN0IGRy
bV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPSBjcnRjLT5wcmltYXJ5LT5zdGF0ZTsKQEAgLTI3
MzEsOCArMjczMSw4IEBAIHN0YXRpYyB2b2lkIHBsYW5lX3JvdGF0aW9uKGNoYXIgKmJ1Ziwgc2l6
ZV90IGJ1ZnNpemUsIHVuc2lnbmVkIGludCByb3RhdGlvbikKIAogc3RhdGljIHZvaWQgaW50ZWxf
cGxhbmVfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkx
NShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0
ZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZpOTE1LT5kcm07CiAJc3RydWN0IGludGVs
X3BsYW5lICppbnRlbF9wbGFuZTsKIAogCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoZGV2
LCBpbnRlbF9jcnRjLCBpbnRlbF9wbGFuZSkgewpAQCAtMjgwNSwxNCArMjgwNSwxNCBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9zY2FsZXJfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjKQogCiBzdGF0aWMgaW50IGk5MTVfZGlzcGxheV9pbmZvKHN0cnVj
dCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZp
OTE1LT5kcm07CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvcjsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVy
OwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCi0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KGRldl9wcml2KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7
CiAKIAlzZXFfcHJpbnRmKG0sICJDUlRDIGluZm9cbiIpOwogCXNlcV9wcmludGYobSwgIi0tLS0t
LS0tLVxuIik7CkBAIC0yODYxLDQyICsyODYxLDQyIEBAIHN0YXRpYyBpbnQgaTkxNV9kaXNwbGF5
X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJZHJtX2Nvbm5lY3Rvcl9s
aXN0X2l0ZXJfZW5kKCZjb25uX2l0ZXIpOwogCW11dGV4X3VubG9jaygmZGV2LT5tb2RlX2NvbmZp
Zy5tdXRleCk7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7CisJ
aW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CiAKIAlyZXR1cm4gMDsKIH0KIAog
c3RhdGljIGludCBpOTE1X2VuZ2luZV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51
c2VkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkx
NShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9f
aTkxNShtLT5wcml2YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJaW50
ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJc3RydWN0
IGRybV9wcmludGVyIHA7CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3By
aXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAogCXNlcV9wcmlu
dGYobSwgIkdUIGF3YWtlPyAlcyBbJWRdXG4iLAotCQkgICB5ZXNubyhkZXZfcHJpdi0+Z3QuYXdh
a2UpLAotCQkgICBhdG9taWNfcmVhZCgmZGV2X3ByaXYtPmd0Lndha2VyZWYuY291bnQpKTsKKwkJ
ICAgeWVzbm8oaTkxNS0+Z3QuYXdha2UpLAorCQkgICBhdG9taWNfcmVhZCgmaTkxNS0+Z3Qud2Fr
ZXJlZi5jb3VudCkpOwogCXNlcV9wcmludGYobSwgIkNTIHRpbWVzdGFtcCBmcmVxdWVuY3k6ICV1
IGtIelxuIiwKLQkJICAgUlVOVElNRV9JTkZPKGRldl9wcml2KS0+Y3NfdGltZXN0YW1wX2ZyZXF1
ZW5jeV9raHopOworCQkgICBSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFtcF9mcmVxdWVu
Y3lfa2h6KTsKIAogCXAgPSBkcm1fc2VxX2ZpbGVfcHJpbnRlcihtKTsKLQlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBkZXZfcHJpdiwgaWQpCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwg
aWQpCiAJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsICIlc1xuIiwgZW5naW5lLT5uYW1l
KTsKIAotCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCB3YWtlcmVmKTsKKwlpbnRlbF9y
dW50aW1lX3BtX3B1dChpOTE1LCB3YWtlcmVmKTsKIAogCXJldHVybiAwOwogfQogCiBzdGF0aWMg
aW50IGk5MTVfcmNzX3RvcG9sb2d5KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5w
cml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNSht
LT5wcml2YXRlKTsKIAlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9zZXFfZmlsZV9wcmludGVy
KG0pOwogCi0JaW50ZWxfZGV2aWNlX2luZm9fZHVtcF90b3BvbG9neSgmUlVOVElNRV9JTkZPKGRl
dl9wcml2KS0+c3NldSwgJnApOworCWludGVsX2RldmljZV9pbmZvX2R1bXBfdG9wb2xvZ3koJlJV
TlRJTUVfSU5GTyhpOTE1KS0+c3NldSwgJnApOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0yOTEzLDEz
ICsyOTEzLDEzIEBAIHN0YXRpYyBpbnQgaTkxNV9zaHJpbmtlcl9pbmZvKHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqdW51c2VkKQogCiBzdGF0aWMgaW50IGk5MTVfc2hhcmVkX2RwbGxzX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gJmk5MTUtPmRybTsKIAlpbnQgaTsKIAogCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGRldik7Ci0J
Zm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1fc2hhcmVkX2RwbGw7IGkrKykgewotCQlzdHJ1
Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCA9ICZkZXZfcHJpdi0+c2hhcmVkX2RwbGxzW2ldOwor
CWZvciAoaSA9IDA7IGkgPCBpOTE1LT5udW1fc2hhcmVkX2RwbGw7IGkrKykgeworCQlzdHJ1Y3Qg
aW50ZWxfc2hhcmVkX2RwbGwgKnBsbCA9ICZpOTE1LT5zaGFyZWRfZHBsbHNbaV07CiAKIAkJc2Vx
X3ByaW50ZihtLCAiRFBMTCVpOiAlcywgaWQ6ICVpXG4iLCBpLCBwbGwtPmluZm8tPm5hbWUsCiAJ
CQkgICBwbGwtPmluZm8tPmlkKTsKQEAgLTI5NzcsMjggKzI5NzcsMjggQEAgc3RhdGljIGludCBp
OTE1X3dhX3JlZ2lzdGVycyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIAogc3Rh
dGljIGludCBpOTE1X2lwY19zdGF0dXNfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRh
dGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG0tPnByaXZhdGU7CiAKIAlzZXFfcHJp
bnRmKG0sICJJc29jaHJvbm91cyBQcmlvcml0eSBDb250cm9sOiAlc1xuIiwKLQkJCXllc25vKGRl
dl9wcml2LT5pcGNfZW5hYmxlZCkpOworCQkJeWVzbm8oaTkxNS0+aXBjX2VuYWJsZWQpKTsKIAly
ZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBpOTE1X2lwY19zdGF0dXNfb3BlbihzdHJ1Y3QgaW5v
ZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBpbm9kZS0+aV9wcml2YXRlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gaW5vZGUtPmlfcHJpdmF0ZTsKIAotCWlmICghSEFTX0lQQyhkZXZfcHJpdikpCisJ
aWYgKCFIQVNfSVBDKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXJldHVybiBzaW5nbGVf
b3BlbihmaWxlLCBpOTE1X2lwY19zdGF0dXNfc2hvdywgZGV2X3ByaXYpOworCXJldHVybiBzaW5n
bGVfb3BlbihmaWxlLCBpOTE1X2lwY19zdGF0dXNfc2hvdywgaTkxNSk7CiB9CiAKIHN0YXRpYyBz
c2l6ZV90IGk5MTVfaXBjX3N0YXR1c193cml0ZShzdHJ1Y3QgZmlsZSAqZmlsZSwgY29uc3QgY2hh
ciBfX3VzZXIgKnVidWYsCiAJCQkJICAgICBzaXplX3QgbGVuLCBsb2ZmX3QgKm9mZnApCiB7CiAJ
c3RydWN0IHNlcV9maWxlICptID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBtLT5wcml2YXRlOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWJvb2wg
ZW5hYmxlOwogCWludCByZXQ7CkBAIC0zMDA3LDEyICszMDA3LDEyIEBAIHN0YXRpYyBzc2l6ZV90
IGk5MTVfaXBjX3N0YXR1c193cml0ZShzdHJ1Y3QgZmlsZSAqZmlsZSwgY29uc3QgY2hhciBfX3Vz
ZXIgKnVidWYsCiAJaWYgKHJldCA8IDApCiAJCXJldHVybiByZXQ7CiAKLQl3aXRoX2ludGVsX3J1
bnRpbWVfcG0oZGV2X3ByaXYsIHdha2VyZWYpIHsKLQkJaWYgKCFkZXZfcHJpdi0+aXBjX2VuYWJs
ZWQgJiYgZW5hYmxlKQorCXdpdGhfaW50ZWxfcnVudGltZV9wbShpOTE1LCB3YWtlcmVmKSB7CisJ
CWlmICghaTkxNS0+aXBjX2VuYWJsZWQgJiYgZW5hYmxlKQogCQkJRFJNX0lORk8oIkVuYWJsaW5n
IElQQzogV00gd2lsbCBiZSBwcm9wZXIgb25seSBhZnRlciBuZXh0IGNvbW1pdFxuIik7Ci0JCWRl
dl9wcml2LT53bS5kaXN0cnVzdF9iaW9zX3dtID0gdHJ1ZTsKLQkJZGV2X3ByaXYtPmlwY19lbmFi
bGVkID0gZW5hYmxlOwotCQlpbnRlbF9lbmFibGVfaXBjKGRldl9wcml2KTsKKwkJaTkxNS0+d20u
ZGlzdHJ1c3RfYmlvc193bSA9IHRydWU7CisJCWk5MTUtPmlwY19lbmFibGVkID0gZW5hYmxlOwor
CQlpbnRlbF9lbmFibGVfaXBjKGk5MTUpOwogCX0KIAogCXJldHVybiBsZW47CkBAIC0zMDI5LDE5
ICszMDI5LDE5IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVfaXBj
X3N0YXR1c19mb3BzID0gewogCiBzdGF0aWMgaW50IGk5MTVfZGRiX2luZm8oc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICp1bnVzZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVf
dG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5MTUtPmRy
bTsKIAlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZW50cnk7CiAJc3RydWN0IGludGVsX2NydGMgKmNy
dGM7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkpCisJaWYgKElOVEVMX0dFTihpOTE1
KSA8IDkpCiAJCXJldHVybiAtRU5PREVWOwogCiAJZHJtX21vZGVzZXRfbG9ja19hbGwoZGV2KTsK
IAogCXNlcV9wcmludGYobSwgIiUtMTVzJThzJThzJThzXG4iLCAiIiwgIlN0YXJ0IiwgIkVuZCIs
ICJTaXplIik7CiAKLQlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjKSB7
CisJZm9yX2VhY2hfaW50ZWxfY3J0YygmaTkxNS0+ZHJtLCBjcnRjKSB7CiAJCXN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0KIAkJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+
YmFzZS5zdGF0ZSk7CiAJCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKQEAgLTMwNzAsOCAr
MzA3MCw4IEBAIHN0YXRpYyB2b2lkIGRycnNfc3RhdHVzX3Blcl9jcnRjKHN0cnVjdCBzZXFfZmls
ZSAqbSwKIAkJCQkgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkgc3RydWN0IGludGVsX2Ny
dGMgKmludGVsX2NydGMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOwotCXN0cnVjdCBpOTE1X2RycnMgKmRycnMgPSAmZGV2X3ByaXYtPmRycnM7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGk5MTVfZHJycyAqZHJycyA9ICZpOTE1LT5kcnJzOwogCWludCB2cmVmcmVzaCA9IDA7CiAJc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0
X2l0ZXIgY29ubl9pdGVyOwpAQCAtMzA4NSwxMSArMzA4NSwxMSBAQCBzdGF0aWMgdm9pZCBkcnJz
X3N0YXR1c19wZXJfY3J0YyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJfQogCWRybV9jb25uZWN0b3Jf
bGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKIAotCWlmIChkZXZfcHJpdi0+dmJ0LmRycnNfdHlw
ZSA9PSBTVEFUSUNfRFJSU19TVVBQT1JUKQorCWlmIChpOTE1LT52YnQuZHJyc190eXBlID09IFNU
QVRJQ19EUlJTX1NVUFBPUlQpCiAJCXNlcV9wdXRzKG0sICJcdFZCVDogRFJSU190eXBlOiBTdGF0
aWMiKTsKLQllbHNlIGlmIChkZXZfcHJpdi0+dmJ0LmRycnNfdHlwZSA9PSBTRUFNTEVTU19EUlJT
X1NVUFBPUlQpCisJZWxzZSBpZiAoaTkxNS0+dmJ0LmRycnNfdHlwZSA9PSBTRUFNTEVTU19EUlJT
X1NVUFBPUlQpCiAJCXNlcV9wdXRzKG0sICJcdFZCVDogRFJSU190eXBlOiBTZWFtbGVzcyIpOwot
CWVsc2UgaWYgKGRldl9wcml2LT52YnQuZHJyc190eXBlID09IERSUlNfTk9UX1NVUFBPUlRFRCkK
KwllbHNlIGlmIChpOTE1LT52YnQuZHJyc190eXBlID09IERSUlNfTk9UX1NVUFBPUlRFRCkKIAkJ
c2VxX3B1dHMobSwgIlx0VkJUOiBEUlJTX3R5cGU6IE5vbmUiKTsKIAllbHNlCiAJCXNlcV9wdXRz
KG0sICJcdFZCVDogRFJSU190eXBlOiBGSVhNRTogVW5yZWNvZ25pemVkIFZhbHVlIik7CkBAIC0z
MTA2LDcgKzMxMDYsNyBAQCBzdGF0aWMgdm9pZCBkcnJzX3N0YXR1c19wZXJfY3J0YyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sCiAJCS8qIGRpc2FibGVfZHJycygpIHdpbGwgbWFrZSBkcnJzLT5kcCBOVUxM
ICovCiAJCWlmICghZHJycy0+ZHApIHsKIAkJCXNlcV9wdXRzKG0sICJJZGxlbmVzcyBEUlJTOiBE
aXNhYmxlZFxuIik7Ci0JCQlpZiAoZGV2X3ByaXYtPnBzci5lbmFibGVkKQorCQkJaWYgKGk5MTUt
PnBzci5lbmFibGVkKQogCQkJCXNlcV9wdXRzKG0sCiAJCQkJIlx0QXMgUFNSIGlzIGVuYWJsZWQs
IERSUlMgaXMgbm90IGVuYWJsZWRcbiIpOwogCQkJbXV0ZXhfdW5sb2NrKCZkcnJzLT5tdXRleCk7
CkBAIC0zMTQzLDggKzMxNDMsOCBAQCBzdGF0aWMgdm9pZCBkcnJzX3N0YXR1c19wZXJfY3J0Yyhz
dHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAKIHN0YXRpYyBpbnQgaTkxNV9kcnJzX3N0YXR1cyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
bm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkx
NS0+ZHJtOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjOwogCWludCBhY3RpdmVfY3J0
Y19jbnQgPSAwOwogCkBAIC0zMTY3LDggKzMxNjcsOCBAQCBzdGF0aWMgaW50IGk5MTVfZHJyc19z
dGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAKIHN0YXRpYyBpbnQgaTkx
NV9kcF9tc3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7
Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRl
bF9lbmNvZGVyOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0Owog
CXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CkBAIC0zMjU3LDggKzMyNTcsOCBAQCBz
dGF0aWMgc3NpemVfdCBpOTE1X2Rpc3BsYXlwb3J0X3Rlc3RfYWN0aXZlX3dyaXRlKHN0cnVjdCBm
aWxlICpmaWxlLAogCiBzdGF0aWMgaW50IGk5MTVfZGlzcGxheXBvcnRfdGVzdF9hY3RpdmVfc2hv
dyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
JmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBtLT5wcml2
YXRlOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNv
bm5faXRlcjsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwpAQCAtMzMwNyw4ICszMzA3LDgg
QEAgc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9kaXNwbGF5cG9ydF90
ZXN0X2FjdGl2ZV9mb3BzID0gewogCiBzdGF0aWMgaW50IGk5MTVfZGlzcGxheXBvcnRfdGVzdF9k
YXRhX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7Ci0Jc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
bS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3Rf
aXRlciBjb25uX2l0ZXI7CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcDsKQEAgLTMzNTEsOCAr
MzM1MSw4IEBAIERFRklORV9TSE9XX0FUVFJJQlVURShpOTE1X2Rpc3BsYXlwb3J0X3Rlc3RfZGF0
YSk7CiAKIHN0YXRpYyBpbnQgaTkxNV9kaXNwbGF5cG9ydF90ZXN0X3R5cGVfc2hvdyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2
LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBtLT5wcml2YXRlOworCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNvbm5faXRlcjsK
IAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwpAQCAtMzM4MywxOSArMzM4MywxOSBAQCBERUZJ
TkVfU0hPV19BVFRSSUJVVEUoaTkxNV9kaXNwbGF5cG9ydF90ZXN0X3R5cGUpOwogCiBzdGF0aWMg
dm9pZCB3bV9sYXRlbmN5X3Nob3coc3RydWN0IHNlcV9maWxlICptLCBjb25zdCB1MTYgd21bOF0p
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBtLT5wcml2YXRlOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAm
aTkxNS0+ZHJtOwogCWludCBsZXZlbDsKIAlpbnQgbnVtX2xldmVsczsKIAotCWlmIChJU19DSEVS
UllWSUVXKGRldl9wcml2KSkKKwlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJbnVtX2xldmVs
cyA9IDM7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNf
VkFMTEVZVklFVyhpOTE1KSkKIAkJbnVtX2xldmVscyA9IDE7Ci0JZWxzZSBpZiAoSVNfRzRYKGRl
dl9wcml2KSkKKwllbHNlIGlmIChJU19HNFgoaTkxNSkpCiAJCW51bV9sZXZlbHMgPSAzOwogCWVs
c2UKLQkJbnVtX2xldmVscyA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpICsgMTsKKwkJbnVt
X2xldmVscyA9IGlsa193bV9tYXhfbGV2ZWwoaTkxNSkgKyAxOwogCiAJZHJtX21vZGVzZXRfbG9j
a19hbGwoZGV2KTsKIApAQCAtMzQwNiwxMCArMzQwNiwxMCBAQCBzdGF0aWMgdm9pZCB3bV9sYXRl
bmN5X3Nob3coc3RydWN0IHNlcV9maWxlICptLCBjb25zdCB1MTYgd21bOF0pCiAJCSAqIC0gV00x
KyBsYXRlbmN5IHZhbHVlcyBpbiAwLjV1cyB1bml0cwogCQkgKiAtIGxhdGVuY2llcyBhcmUgaW4g
dXMgb24gZ2VuOS92bHYvY2h2CiAJCSAqLwotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5
IHx8Ci0JCSAgICBJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fAotCQkgICAgSVNfQ0hFUlJZVklF
VyhkZXZfcHJpdikgfHwKLQkJICAgIElTX0c0WChkZXZfcHJpdikpCisJCWlmIChJTlRFTF9HRU4o
aTkxNSkgPj0gOSB8fAorCQkgICAgSVNfVkFMTEVZVklFVyhpOTE1KSB8fAorCQkgICAgSVNfQ0hF
UlJZVklFVyhpOTE1KSB8fAorCQkgICAgSVNfRzRYKGk5MTUpKQogCQkJbGF0ZW5jeSAqPSAxMDsK
IAkJZWxzZSBpZiAobGV2ZWwgPiAwKQogCQkJbGF0ZW5jeSAqPSA1OwpAQCAtMzQyMywxMyArMzQy
MywxMyBAQCBzdGF0aWMgdm9pZCB3bV9sYXRlbmN5X3Nob3coc3RydWN0IHNlcV9maWxlICptLCBj
b25zdCB1MTYgd21bOF0pCiAKIHN0YXRpYyBpbnQgcHJpX3dtX2xhdGVuY3lfc2hvdyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gbS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG0t
PnByaXZhdGU7CiAJY29uc3QgdTE2ICpsYXRlbmNpZXM7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA5KQotCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3k7CisJaWYg
KElOVEVMX0dFTihpOTE1KSA+PSA5KQorCQlsYXRlbmNpZXMgPSBpOTE1LT53bS5za2xfbGF0ZW5j
eTsKIAllbHNlCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeTsKKwkJbGF0
ZW5jaWVzID0gaTkxNS0+d20ucHJpX2xhdGVuY3k7CiAKIAl3bV9sYXRlbmN5X3Nob3cobSwgbGF0
ZW5jaWVzKTsKIApAQCAtMzQzOCwxMyArMzQzOCwxMyBAQCBzdGF0aWMgaW50IHByaV93bV9sYXRl
bmN5X3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiBzdGF0aWMgaW50IHNw
cl93bV9sYXRlbmN5X3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBtLT5wcml2YXRlOwogCWNvbnN0IHUxNiAqbGF0ZW5jaWVz
OwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKLQkJbGF0ZW5jaWVzID0gZGV2X3By
aXYtPndtLnNrbF9sYXRlbmN5OworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKKwkJbGF0ZW5j
aWVzID0gaTkxNS0+d20uc2tsX2xhdGVuY3k7CiAJZWxzZQotCQlsYXRlbmNpZXMgPSBkZXZfcHJp
di0+d20uc3ByX2xhdGVuY3k7CisJCWxhdGVuY2llcyA9IGk5MTUtPndtLnNwcl9sYXRlbmN5Owog
CiAJd21fbGF0ZW5jeV9zaG93KG0sIGxhdGVuY2llcyk7CiAKQEAgLTM0NTMsMTMgKzM0NTMsMTMg
QEAgc3RhdGljIGludCBzcHJfd21fbGF0ZW5jeV9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9p
ZCAqZGF0YSkKIAogc3RhdGljIGludCBjdXJfd21fbGF0ZW5jeV9zaG93KHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqZGF0YSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBtLT5wcml2YXRlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbS0+cHJpdmF0
ZTsKIAljb25zdCB1MTYgKmxhdGVuY2llczsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDkpCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeTsKKwlpZiAoSU5URUxf
R0VOKGk5MTUpID49IDkpCisJCWxhdGVuY2llcyA9IGk5MTUtPndtLnNrbF9sYXRlbmN5OwogCWVs
c2UKLQkJbGF0ZW5jaWVzID0gZGV2X3ByaXYtPndtLmN1cl9sYXRlbmN5OworCQlsYXRlbmNpZXMg
PSBpOTE1LT53bS5jdXJfbGF0ZW5jeTsKIAogCXdtX2xhdGVuY3lfc2hvdyhtLCBsYXRlbmNpZXMp
OwogCkBAIC0zNDY4LDU0ICszNDY4LDU0IEBAIHN0YXRpYyBpbnQgY3VyX3dtX2xhdGVuY3lfc2hv
dyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIHN0YXRpYyBpbnQgcHJpX3dtX2xh
dGVuY3lfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBpbm9kZS0+aV9wcml2YXRlOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gaW5vZGUtPmlfcHJpdmF0ZTsKIAotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpIDwgNSAmJiAhSVNfRzRYKGRldl9wcml2KSkKKwlpZiAoSU5URUxf
R0VOKGk5MTUpIDwgNSAmJiAhSVNfRzRYKGk5MTUpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXJl
dHVybiBzaW5nbGVfb3BlbihmaWxlLCBwcmlfd21fbGF0ZW5jeV9zaG93LCBkZXZfcHJpdik7CisJ
cmV0dXJuIHNpbmdsZV9vcGVuKGZpbGUsIHByaV93bV9sYXRlbmN5X3Nob3csIGk5MTUpOwogfQog
CiBzdGF0aWMgaW50IHNwcl93bV9sYXRlbmN5X29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3Ry
dWN0IGZpbGUgKmZpbGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
aW5vZGUtPmlfcHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGlub2Rl
LT5pX3ByaXZhdGU7CiAKLQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpKQorCWlmIChIQVNfR01DSChp
OTE1KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlyZXR1cm4gc2luZ2xlX29wZW4oZmlsZSwgc3By
X3dtX2xhdGVuY3lfc2hvdywgZGV2X3ByaXYpOworCXJldHVybiBzaW5nbGVfb3BlbihmaWxlLCBz
cHJfd21fbGF0ZW5jeV9zaG93LCBpOTE1KTsKIH0KIAogc3RhdGljIGludCBjdXJfd21fbGF0ZW5j
eV9vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGlub2RlLT5pX3ByaXZhdGU7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBpbm9kZS0+aV9wcml2YXRlOwogCi0JaWYgKEhBU19H
TUNIKGRldl9wcml2KSkKKwlpZiAoSEFTX0dNQ0goaTkxNSkpCiAJCXJldHVybiAtRU5PREVWOwog
Ci0JcmV0dXJuIHNpbmdsZV9vcGVuKGZpbGUsIGN1cl93bV9sYXRlbmN5X3Nob3csIGRldl9wcml2
KTsKKwlyZXR1cm4gc2luZ2xlX29wZW4oZmlsZSwgY3VyX3dtX2xhdGVuY3lfc2hvdywgaTkxNSk7
CiB9CiAKIHN0YXRpYyBzc2l6ZV90IHdtX2xhdGVuY3lfd3JpdGUoc3RydWN0IGZpbGUgKmZpbGUs
IGNvbnN0IGNoYXIgX191c2VyICp1YnVmLAogCQkJCXNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCwg
dTE2IHdtWzhdKQogewogCXN0cnVjdCBzZXFfZmlsZSAqbSA9IGZpbGUtPnByaXZhdGVfZGF0YTsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2YXRlOwotCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IG0tPnByaXZhdGU7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZpOTE1
LT5kcm07CiAJdTE2IG5ld1s4XSA9IHsgMCB9OwogCWludCBudW1fbGV2ZWxzOwogCWludCBsZXZl
bDsKIAlpbnQgcmV0OwogCWNoYXIgdG1wWzMyXTsKIAotCWlmIChJU19DSEVSUllWSUVXKGRldl9w
cml2KSkKKwlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJbnVtX2xldmVscyA9IDM7Ci0JZWxz
ZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhp
OTE1KSkKIAkJbnVtX2xldmVscyA9IDE7Ci0JZWxzZSBpZiAoSVNfRzRYKGRldl9wcml2KSkKKwll
bHNlIGlmIChJU19HNFgoaTkxNSkpCiAJCW51bV9sZXZlbHMgPSAzOwogCWVsc2UKLQkJbnVtX2xl
dmVscyA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpICsgMTsKKwkJbnVtX2xldmVscyA9IGls
a193bV9tYXhfbGV2ZWwoaTkxNSkgKyAxOwogCiAJaWYgKGxlbiA+PSBzaXplb2YodG1wKSkKIAkJ
cmV0dXJuIC1FSU5WQUw7CkBAIC0zNTQ2LDEzICszNTQ2LDEzIEBAIHN0YXRpYyBzc2l6ZV90IHBy
aV93bV9sYXRlbmN5X3dyaXRlKHN0cnVjdCBmaWxlICpmaWxlLCBjb25zdCBjaGFyIF9fdXNlciAq
dWJ1ZiwKIAkJCQkgICAgc2l6ZV90IGxlbiwgbG9mZl90ICpvZmZwKQogewogCXN0cnVjdCBzZXFf
ZmlsZSAqbSA9IGZpbGUtPnByaXZhdGVfZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBtLT5wcml2YXRlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
bS0+cHJpdmF0ZTsKIAl1MTYgKmxhdGVuY2llczsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDkpCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeTsKKwlpZiAoSU5U
RUxfR0VOKGk5MTUpID49IDkpCisJCWxhdGVuY2llcyA9IGk5MTUtPndtLnNrbF9sYXRlbmN5Owog
CWVsc2UKLQkJbGF0ZW5jaWVzID0gZGV2X3ByaXYtPndtLnByaV9sYXRlbmN5OworCQlsYXRlbmNp
ZXMgPSBpOTE1LT53bS5wcmlfbGF0ZW5jeTsKIAogCXJldHVybiB3bV9sYXRlbmN5X3dyaXRlKGZp
bGUsIHVidWYsIGxlbiwgb2ZmcCwgbGF0ZW5jaWVzKTsKIH0KQEAgLTM1NjEsMTMgKzM1NjEsMTMg
QEAgc3RhdGljIHNzaXplX3Qgc3ByX3dtX2xhdGVuY3lfd3JpdGUoc3RydWN0IGZpbGUgKmZpbGUs
IGNvbnN0IGNoYXIgX191c2VyICp1YnVmLAogCQkJCSAgICBzaXplX3QgbGVuLCBsb2ZmX3QgKm9m
ZnApCiB7CiAJc3RydWN0IHNlcV9maWxlICptID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBtLT5wcml2YXRlOwogCXUxNiAqbGF0ZW5jaWVzOwogCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKLQkJbGF0ZW5jaWVzID0gZGV2X3ByaXYtPndtLnNr
bF9sYXRlbmN5OworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKKwkJbGF0ZW5jaWVzID0gaTkx
NS0+d20uc2tsX2xhdGVuY3k7CiAJZWxzZQotCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+d20uc3By
X2xhdGVuY3k7CisJCWxhdGVuY2llcyA9IGk5MTUtPndtLnNwcl9sYXRlbmN5OwogCiAJcmV0dXJu
IHdtX2xhdGVuY3lfd3JpdGUoZmlsZSwgdWJ1ZiwgbGVuLCBvZmZwLCBsYXRlbmNpZXMpOwogfQpA
QCAtMzU3NiwxMyArMzU3NiwxMyBAQCBzdGF0aWMgc3NpemVfdCBjdXJfd21fbGF0ZW5jeV93cml0
ZShzdHJ1Y3QgZmlsZSAqZmlsZSwgY29uc3QgY2hhciBfX3VzZXIgKnVidWYsCiAJCQkJICAgIHNp
emVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkKIHsKIAlzdHJ1Y3Qgc2VxX2ZpbGUgKm0gPSBmaWxlLT5w
cml2YXRlX2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJp
dmF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG0tPnByaXZhdGU7CiAJdTE2
ICpsYXRlbmNpZXM7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQotCQlsYXRlbmNp
ZXMgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3k7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5
KQorCQlsYXRlbmNpZXMgPSBpOTE1LT53bS5za2xfbGF0ZW5jeTsKIAllbHNlCi0JCWxhdGVuY2ll
cyA9IGRldl9wcml2LT53bS5jdXJfbGF0ZW5jeTsKKwkJbGF0ZW5jaWVzID0gaTkxNS0+d20uY3Vy
X2xhdGVuY3k7CiAKIAlyZXR1cm4gd21fbGF0ZW5jeV93cml0ZShmaWxlLCB1YnVmLCBsZW4sIG9m
ZnAsIGxhdGVuY2llcyk7CiB9CkBAIC0zNzUyLDE0ICszNzUyLDE0IEBAIERFRklORV9TSU1QTEVf
QVRUUklCVVRFKGk5MTVfZHJvcF9jYWNoZXNfZm9wcywKIHN0YXRpYyBpbnQKIGk5MTVfY2FjaGVf
c2hhcmluZ19nZXQodm9pZCAqZGF0YSwgdTY0ICp2YWwpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGRhdGE7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJdTMyIHNucGNyID0gMDsKIAotCWlm
ICghKElTX0dFTl9SQU5HRShkZXZfcHJpdiwgNiwgNykpKQorCWlmICghKElTX0dFTl9SQU5HRShp
OTE1LCA2LCA3KSkpCiAJCXJldHVybiAtRU5PREVWOwogCi0Jd2l0aF9pbnRlbF9ydW50aW1lX3Bt
KGRldl9wcml2LCB3YWtlcmVmKQorCXdpdGhfaW50ZWxfcnVudGltZV9wbShpOTE1LCB3YWtlcmVm
KQogCQlzbnBjciA9IEk5MTVfUkVBRChHRU42X01CQ1VOSVRfU05QQ1IpOwogCiAJKnZhbCA9IChz
bnBjciAmIEdFTjZfTUJDX1NOUENSX01BU0spID4+IEdFTjZfTUJDX1NOUENSX1NISUZUOwpAQCAt
Mzc3MCwxNyArMzc3MCwxNyBAQCBpOTE1X2NhY2hlX3NoYXJpbmdfZ2V0KHZvaWQgKmRhdGEsIHU2
NCAqdmFsKQogc3RhdGljIGludAogaTkxNV9jYWNoZV9zaGFyaW5nX3NldCh2b2lkICpkYXRhLCB1
NjQgdmFsKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOwogCWludGVsX3dha2VyZWZfdCB3
YWtlcmVmOwogCi0JaWYgKCEoSVNfR0VOX1JBTkdFKGRldl9wcml2LCA2LCA3KSkpCisJaWYgKCEo
SVNfR0VOX1JBTkdFKGk5MTUsIDYsIDcpKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlpZiAodmFs
ID4gMykKIAkJcmV0dXJuIC1FSU5WQUw7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCJNYW51YWxseSBz
ZXR0aW5nIHVuY29yZSBzaGFyaW5nIHRvICVsbHVcbiIsIHZhbCk7Ci0Jd2l0aF9pbnRlbF9ydW50
aW1lX3BtKGRldl9wcml2LCB3YWtlcmVmKSB7CisJd2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5MTUs
IHdha2VyZWYpIHsKIAkJdTMyIHNucGNyOwogCiAJCS8qIFVwZGF0ZSB0aGUgY2FjaGUgc2hhcmlu
ZyBwb2xpY3kgaGVyZSBhcyB3ZWxsICovCkBAIC0zNzk3LDcgKzM3OTcsNyBAQCBERUZJTkVfU0lN
UExFX0FUVFJJQlVURShpOTE1X2NhY2hlX3NoYXJpbmdfZm9wcywKIAkJCWk5MTVfY2FjaGVfc2hh
cmluZ19nZXQsIGk5MTVfY2FjaGVfc2hhcmluZ19zZXQsCiAJCQkiJWxsdVxuIik7CiAKLXN0YXRp
YyB2b2lkIGNoZXJyeXZpZXdfc3NldV9kZXZpY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGNoZXJyeXZpZXdfc3NldV9kZXZpY2Vfc3RhdHVz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgIHN0cnVjdCBzc2V1X2Rldl9p
bmZvICpzc2V1KQogewogI2RlZmluZSBTU19NQVggMgpAQCAtMzgzMCwxMSArMzgzMCwxMSBAQCBz
dGF0aWMgdm9pZCBjaGVycnl2aWV3X3NzZXVfZGV2aWNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAjdW5kZWYgU1NfTUFYCiB9CiAKLXN0YXRpYyB2b2lkIGdlbjEw
X3NzZXVfZGV2aWNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdm9pZCBnZW4xMF9zc2V1X2RldmljZV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICAgICBzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSkKIHsKICNkZWZp
bmUgU1NfTUFYIDYKLQljb25zdCBzdHJ1Y3QgaW50ZWxfcnVudGltZV9pbmZvICppbmZvID0gUlVO
VElNRV9JTkZPKGRldl9wcml2KTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfcnVudGltZV9pbmZvICpp
bmZvID0gUlVOVElNRV9JTkZPKGk5MTUpOwogCXUzMiBzX3JlZ1tTU19NQVhdLCBldV9yZWdbMiAq
IFNTX01BWF0sIGV1X21hc2tbMl07CiAJaW50IHMsIHNzOwogCkBAIC0zODg2LDExICszODg2LDEx
IEBAIHN0YXRpYyB2b2lkIGdlbjEwX3NzZXVfZGV2aWNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAjdW5kZWYgU1NfTUFYCiB9CiAKLXN0YXRpYyB2b2lkIGdlbjlf
c3NldV9kZXZpY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0
YXRpYyB2b2lkIGdlbjlfc3NldV9kZXZpY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCSAgICBzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSkKIHsKICNkZWZpbmUg
U1NfTUFYIDMKLQljb25zdCBzdHJ1Y3QgaW50ZWxfcnVudGltZV9pbmZvICppbmZvID0gUlVOVElN
RV9JTkZPKGRldl9wcml2KTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfcnVudGltZV9pbmZvICppbmZv
ID0gUlVOVElNRV9JTkZPKGk5MTUpOwogCXUzMiBzX3JlZ1tTU19NQVhdLCBldV9yZWdbMiAqIFNT
X01BWF0sIGV1X21hc2tbMl07CiAJaW50IHMsIHNzOwogCkBAIC0zOTE2LDE0ICszOTE2LDE0IEBA
IHN0YXRpYyB2b2lkIGdlbjlfc3NldV9kZXZpY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAogCQlzc2V1LT5zbGljZV9tYXNrIHw9IEJJVChzKTsKIAotCQlpZiAo
SVNfR0VOOV9CQyhkZXZfcHJpdikpCisJCWlmIChJU19HRU45X0JDKGk5MTUpKQogCQkJc3NldS0+
c3Vic2xpY2VfbWFza1tzXSA9Ci0JCQkJUlVOVElNRV9JTkZPKGRldl9wcml2KS0+c3NldS5zdWJz
bGljZV9tYXNrW3NdOworCQkJCVJVTlRJTUVfSU5GTyhpOTE1KS0+c3NldS5zdWJzbGljZV9tYXNr
W3NdOwogCiAJCWZvciAoc3MgPSAwOyBzcyA8IGluZm8tPnNzZXUubWF4X3N1YnNsaWNlczsgc3Mr
KykgewogCQkJdW5zaWduZWQgaW50IGV1X2NudDsKIAotCQkJaWYgKElTX0dFTjlfTFAoZGV2X3By
aXYpKSB7CisJCQlpZiAoSVNfR0VOOV9MUChpOTE1KSkgewogCQkJCWlmICghKHNfcmVnW3NdICYg
KEdFTjlfUEdDVExfU1NfQUNLKHNzKSkpKQogCQkJCQkvKiBza2lwIGRpc2FibGVkIHN1YnNsaWNl
ICovCiAJCQkJCWNvbnRpbnVlOwpAQCAtMzk0Miw3ICszOTQyLDcgQEAgc3RhdGljIHZvaWQgZ2Vu
OV9zc2V1X2RldmljZV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
I3VuZGVmIFNTX01BWAogfQogCi1zdGF0aWMgdm9pZCBicm9hZHdlbGxfc3NldV9kZXZpY2Vfc3Rh
dHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGJyb2Fk
d2VsbF9zc2V1X2RldmljZV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkJCSBzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSkKIHsKIAl1MzIgc2xpY2VfaW5mbyA9IEk5
MTVfUkVBRChHRU44X0dUX1NMSUNFX0lORk8pOwpAQCAtMzk1MiwxMCArMzk1MiwxMCBAQCBzdGF0
aWMgdm9pZCBicm9hZHdlbGxfc3NldV9kZXZpY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAogCWlmIChzc2V1LT5zbGljZV9tYXNrKSB7CiAJCXNzZXUtPmV1X3Bl
cl9zdWJzbGljZSA9Ci0JCQlSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5zc2V1LmV1X3Blcl9zdWJz
bGljZTsKKwkJCVJVTlRJTUVfSU5GTyhpOTE1KS0+c3NldS5ldV9wZXJfc3Vic2xpY2U7CiAJCWZv
ciAocyA9IDA7IHMgPCBmbHMoc3NldS0+c2xpY2VfbWFzayk7IHMrKykgewogCQkJc3NldS0+c3Vi
c2xpY2VfbWFza1tzXSA9Ci0JCQkJUlVOVElNRV9JTkZPKGRldl9wcml2KS0+c3NldS5zdWJzbGlj
ZV9tYXNrW3NdOworCQkJCVJVTlRJTUVfSU5GTyhpOTE1KS0+c3NldS5zdWJzbGljZV9tYXNrW3Nd
OwogCQl9CiAJCXNzZXUtPmV1X3RvdGFsID0gc3NldS0+ZXVfcGVyX3N1YnNsaWNlICoKIAkJCQkg
aW50ZWxfc3NldV9zdWJzbGljZV90b3RhbChzc2V1KTsKQEAgLTM5NjMsNyArMzk2Myw3IEBAIHN0
YXRpYyB2b2lkIGJyb2Fkd2VsbF9zc2V1X2RldmljZV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCQkvKiBzdWJ0cmFjdCBmdXNlZCBvZmYgRVUocykgZnJvbSBlbmFi
bGVkIHNsaWNlKHMpICovCiAJCWZvciAocyA9IDA7IHMgPCBmbHMoc3NldS0+c2xpY2VfbWFzayk7
IHMrKykgewogCQkJdTggc3Vic2xpY2VfN2V1ID0KLQkJCQlSVU5USU1FX0lORk8oZGV2X3ByaXYp
LT5zc2V1LnN1YnNsaWNlXzdldVtzXTsKKwkJCQlSVU5USU1FX0lORk8oaTkxNSktPnNzZXUuc3Vi
c2xpY2VfN2V1W3NdOwogCiAJCQlzc2V1LT5ldV90b3RhbCAtPSBod2VpZ2h0OChzdWJzbGljZV83
ZXUpOwogCQl9CkBAIC0zOTczLDcgKzM5NzMsNyBAQCBzdGF0aWMgdm9pZCBicm9hZHdlbGxfc3Nl
dV9kZXZpY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIHN0YXRp
YyB2b2lkIGk5MTVfcHJpbnRfc3NldV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgYm9vbCBpc19h
dmFpbGFibGVfaW5mbywKIAkJCQkgY29uc3Qgc3RydWN0IHNzZXVfZGV2X2luZm8gKnNzZXUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnBy
aXZhdGUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0t
PnByaXZhdGUpOwogCWNvbnN0IGNoYXIgKnR5cGUgPSBpc19hdmFpbGFibGVfaW5mbyA/ICJBdmFp
bGFibGUiIDogIkVuYWJsZWQiOwogCWludCBzOwogCkBAIC0zOTk1LDggKzM5OTUsOCBAQCBzdGF0
aWMgdm9pZCBpOTE1X3ByaW50X3NzZXVfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIGJvb2wgaXNf
YXZhaWxhYmxlX2luZm8sCiAJaWYgKCFpc19hdmFpbGFibGVfaW5mbykKIAkJcmV0dXJuOwogCi0J
c2VxX3ByaW50ZihtLCAiICBIYXMgUG9vbGVkIEVVOiAlc1xuIiwgeWVzbm8oSEFTX1BPT0xFRF9F
VShkZXZfcHJpdikpKTsKLQlpZiAoSEFTX1BPT0xFRF9FVShkZXZfcHJpdikpCisJc2VxX3ByaW50
ZihtLCAiICBIYXMgUG9vbGVkIEVVOiAlc1xuIiwgeWVzbm8oSEFTX1BPT0xFRF9FVShpOTE1KSkp
OworCWlmIChIQVNfUE9PTEVEX0VVKGk5MTUpKQogCQlzZXFfcHJpbnRmKG0sICIgIE1pbiBFVSBp
biBwb29sOiAldVxuIiwgc3NldS0+bWluX2V1X2luX3Bvb2wpOwogCiAJc2VxX3ByaW50ZihtLCAi
ICBIYXMgU2xpY2UgUG93ZXIgR2F0aW5nOiAlc1xuIiwKQEAgLTQwMDksMzIgKzQwMDksMzIgQEAg
c3RhdGljIHZvaWQgaTkxNV9wcmludF9zc2V1X2luZm8oc3RydWN0IHNlcV9maWxlICptLCBib29s
IGlzX2F2YWlsYWJsZV9pbmZvLAogCiBzdGF0aWMgaW50IGk5MTVfc3NldV9zdGF0dXMoc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwogCXN0cnVjdCBzc2V1X2Rl
dl9pbmZvIHNzZXU7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA8IDgpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDgpCiAJCXJldHVybiAtRU5P
REVWOwogCiAJc2VxX3B1dHMobSwgIlNTRVUgRGV2aWNlIEluZm9cbiIpOwotCWk5MTVfcHJpbnRf
c3NldV9pbmZvKG0sIHRydWUsICZSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5zc2V1KTsKKwlpOTE1
X3ByaW50X3NzZXVfaW5mbyhtLCB0cnVlLCAmUlVOVElNRV9JTkZPKGk5MTUpLT5zc2V1KTsKIAog
CXNlcV9wdXRzKG0sICJTU0VVIERldmljZSBTdGF0dXNcbiIpOwogCW1lbXNldCgmc3NldSwgMCwg
c2l6ZW9mKHNzZXUpKTsKLQlzc2V1Lm1heF9zbGljZXMgPSBSVU5USU1FX0lORk8oZGV2X3ByaXYp
LT5zc2V1Lm1heF9zbGljZXM7Ci0Jc3NldS5tYXhfc3Vic2xpY2VzID0gUlVOVElNRV9JTkZPKGRl
dl9wcml2KS0+c3NldS5tYXhfc3Vic2xpY2VzOworCXNzZXUubWF4X3NsaWNlcyA9IFJVTlRJTUVf
SU5GTyhpOTE1KS0+c3NldS5tYXhfc2xpY2VzOworCXNzZXUubWF4X3N1YnNsaWNlcyA9IFJVTlRJ
TUVfSU5GTyhpOTE1KS0+c3NldS5tYXhfc3Vic2xpY2VzOwogCXNzZXUubWF4X2V1c19wZXJfc3Vi
c2xpY2UgPQotCQlSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5zc2V1Lm1heF9ldXNfcGVyX3N1YnNs
aWNlOwotCi0Jd2l0aF9pbnRlbF9ydW50aW1lX3BtKGRldl9wcml2LCB3YWtlcmVmKSB7Ci0JCWlm
IChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJCWNoZXJyeXZpZXdfc3NldV9kZXZpY2Vfc3Rh
dHVzKGRldl9wcml2LCAmc3NldSk7Ci0JCWVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikp
Ci0JCQlicm9hZHdlbGxfc3NldV9kZXZpY2Vfc3RhdHVzKGRldl9wcml2LCAmc3NldSk7Ci0JCWVs
c2UgaWYgKElTX0dFTihkZXZfcHJpdiwgOSkpCi0JCQlnZW45X3NzZXVfZGV2aWNlX3N0YXR1cyhk
ZXZfcHJpdiwgJnNzZXUpOwotCQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQot
CQkJZ2VuMTBfc3NldV9kZXZpY2Vfc3RhdHVzKGRldl9wcml2LCAmc3NldSk7CisJCVJVTlRJTUVf
SU5GTyhpOTE1KS0+c3NldS5tYXhfZXVzX3Blcl9zdWJzbGljZTsKKworCXdpdGhfaW50ZWxfcnVu
dGltZV9wbShpOTE1LCB3YWtlcmVmKSB7CisJCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKQorCQkJ
Y2hlcnJ5dmlld19zc2V1X2RldmljZV9zdGF0dXMoaTkxNSwgJnNzZXUpOworCQllbHNlIGlmIChJ
U19CUk9BRFdFTEwoaTkxNSkpCisJCQlicm9hZHdlbGxfc3NldV9kZXZpY2Vfc3RhdHVzKGk5MTUs
ICZzc2V1KTsKKwkJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDkpKQorCQkJZ2VuOV9zc2V1X2Rldmlj
ZV9zdGF0dXMoaTkxNSwgJnNzZXUpOworCQllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTAp
CisJCQlnZW4xMF9zc2V1X2RldmljZV9zdGF0dXMoaTkxNSwgJnNzZXUpOwogCX0KIAogCWk5MTVf
cHJpbnRfc3NldV9pbmZvKG0sIGZhbHNlLCAmc3NldSk7CkBAIC00MDc3LDE1ICs0MDc3LDE1IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVfZm9yY2V3YWtlX2ZvcHMg
PSB7CiAKIHN0YXRpYyBpbnQgaTkxNV9ocGRfc3Rvcm1fY3RsX3Nob3coc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IG0tPnByaXZhdGU7Ci0Jc3RydWN0IGk5MTVfaG90cGx1ZyAqaG90cGx1ZyA9ICZkZXZfcHJpdi0+
aG90cGx1ZzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG0tPnByaXZhdGU7CisJ
c3RydWN0IGk5MTVfaG90cGx1ZyAqaG90cGx1ZyA9ICZpOTE1LT5ob3RwbHVnOwogCiAJLyogU3lu
Y2hyb25pemUgd2l0aCBldmVyeXRoaW5nIGZpcnN0IGluIGNhc2UgdGhlcmUncyBiZWVuIGFuIEhQ
RAogCSAqIHN0b3JtLCBidXQgd2UgaGF2ZW4ndCBmaW5pc2hlZCBoYW5kbGluZyBpdCBpbiB0aGUg
a2VybmVsIHlldAogCSAqLwotCXN5bmNocm9uaXplX2lycShkZXZfcHJpdi0+ZHJtLmlycSk7Ci0J
Zmx1c2hfd29yaygmZGV2X3ByaXYtPmhvdHBsdWcuZGlnX3BvcnRfd29yayk7Ci0JZmx1c2hfd29y
aygmZGV2X3ByaXYtPmhvdHBsdWcuaG90cGx1Z193b3JrKTsKKwlzeW5jaHJvbml6ZV9pcnEoaTkx
NS0+ZHJtLmlycSk7CisJZmx1c2hfd29yaygmaTkxNS0+aG90cGx1Zy5kaWdfcG9ydF93b3JrKTsK
KwlmbHVzaF93b3JrKCZpOTE1LT5ob3RwbHVnLmhvdHBsdWdfd29yayk7CiAKIAlzZXFfcHJpbnRm
KG0sICJUaHJlc2hvbGQ6ICVkXG4iLCBob3RwbHVnLT5ocGRfc3Rvcm1fdGhyZXNob2xkKTsKIAlz
ZXFfcHJpbnRmKG0sICJEZXRlY3RlZDogJXNcbiIsCkBAIC00MDk5LDggKzQwOTksOCBAQCBzdGF0
aWMgc3NpemVfdCBpOTE1X2hwZF9zdG9ybV9jdGxfd3JpdGUoc3RydWN0IGZpbGUgKmZpbGUsCiAJ
CQkJCWxvZmZfdCAqb2ZmcCkKIHsKIAlzdHJ1Y3Qgc2VxX2ZpbGUgKm0gPSBmaWxlLT5wcml2YXRl
X2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsK
LQlzdHJ1Y3QgaTkxNV9ob3RwbHVnICpob3RwbHVnID0gJmRldl9wcml2LT5ob3RwbHVnOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgaTkxNV9o
b3RwbHVnICpob3RwbHVnID0gJmk5MTUtPmhvdHBsdWc7CiAJdW5zaWduZWQgaW50IG5ld190aHJl
c2hvbGQ7CiAJaW50IGk7CiAJY2hhciAqbmV3bGluZTsKQEAgLTQxMzAsMTUgKzQxMzAsMTUgQEAg
c3RhdGljIHNzaXplX3QgaTkxNV9ocGRfc3Rvcm1fY3RsX3dyaXRlKHN0cnVjdCBmaWxlICpmaWxl
LAogCWVsc2UKIAkJRFJNX0RFQlVHX0tNUygiRGlzYWJsaW5nIEhQRCBzdG9ybSBkZXRlY3Rpb25c
biIpOwogCi0Jc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tf
aXJxKCZpOTE1LT5pcnFfbG9jayk7CiAJaG90cGx1Zy0+aHBkX3N0b3JtX3RocmVzaG9sZCA9IG5l
d190aHJlc2hvbGQ7CiAJLyogUmVzZXQgdGhlIEhQRCBzdG9ybSBzdGF0cyBzbyB3ZSBkb24ndCBh
Y2NpZGVudGFsbHkgdHJpZ2dlciBhIHN0b3JtICovCiAJZm9yX2VhY2hfaHBkX3BpbihpKQogCQlo
b3RwbHVnLT5zdGF0c1tpXS5jb3VudCA9IDA7Ci0Jc3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+
aXJxX2xvY2spOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCiAJLyogUmUt
ZW5hYmxlIGhwZCBpbW1lZGlhdGVseSBpZiB3ZSB3ZXJlIGluIGFuIGlycSBzdG9ybSAqLwotCWZs
dXNoX2RlbGF5ZWRfd29yaygmZGV2X3ByaXYtPmhvdHBsdWcucmVlbmFibGVfd29yayk7CisJZmx1
c2hfZGVsYXllZF93b3JrKCZpOTE1LT5ob3RwbHVnLnJlZW5hYmxlX3dvcmspOwogCiAJcmV0dXJu
IGxlbjsKIH0KQEAgLTQxNTksMTAgKzQxNTksMTAgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxl
X29wZXJhdGlvbnMgaTkxNV9ocGRfc3Rvcm1fY3RsX2ZvcHMgPSB7CiAKIHN0YXRpYyBpbnQgaTkx
NV9ocGRfc2hvcnRfc3Rvcm1fY3RsX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRh
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBtLT5wcml2YXRlOwogCiAJc2VxX3ByaW50
ZihtLCAiRW5hYmxlZDogJXNcbiIsCi0JCSAgIHllc25vKGRldl9wcml2LT5ob3RwbHVnLmhwZF9z
aG9ydF9zdG9ybV9lbmFibGVkKSk7CisJCSAgIHllc25vKGk5MTUtPmhvdHBsdWcuaHBkX3Nob3J0
X3N0b3JtX2VuYWJsZWQpKTsKIAogCXJldHVybiAwOwogfQpAQCAtNDE3OSw4ICs0MTc5LDggQEAg
c3RhdGljIHNzaXplX3QgaTkxNV9ocGRfc2hvcnRfc3Rvcm1fY3RsX3dyaXRlKHN0cnVjdCBmaWxl
ICpmaWxlLAogCQkJCQkgICAgICBzaXplX3QgbGVuLCBsb2ZmX3QgKm9mZnApCiB7CiAJc3RydWN0
IHNlcV9maWxlICptID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7Ci0Jc3RydWN0IGk5MTVfaG90cGx1ZyAqaG90cGx1
ZyA9ICZkZXZfcHJpdi0+aG90cGx1ZzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IG0tPnByaXZhdGU7CisJc3RydWN0IGk5MTVfaG90cGx1ZyAqaG90cGx1ZyA9ICZpOTE1LT5ob3Rw
bHVnOwogCWNoYXIgKm5ld2xpbmU7CiAJY2hhciB0bXBbMTZdOwogCWludCBpOwpAQCAtNDIwMSwy
MiArNDIwMSwyMiBAQCBzdGF0aWMgc3NpemVfdCBpOTE1X2hwZF9zaG9ydF9zdG9ybV9jdGxfd3Jp
dGUoc3RydWN0IGZpbGUgKmZpbGUsCiAKIAkvKiBSZXNldCB0byB0aGUgImRlZmF1bHQiIHN0YXRl
IGZvciB0aGlzIHN5c3RlbSAqLwogCWlmIChzdHJjbXAodG1wLCAicmVzZXQiKSA9PSAwKQotCQlu
ZXdfc3RhdGUgPSAhSEFTX0RQX01TVChkZXZfcHJpdik7CisJCW5ld19zdGF0ZSA9ICFIQVNfRFBf
TVNUKGk5MTUpOwogCWVsc2UgaWYgKGtzdHJ0b2Jvb2wodG1wLCAmbmV3X3N0YXRlKSAhPSAwKQog
CQlyZXR1cm4gLUVJTlZBTDsKIAogCURSTV9ERUJVR19LTVMoIiVzYWJsaW5nIEhQRCBzaG9ydCBz
dG9ybSBkZXRlY3Rpb25cbiIsCiAJCSAgICAgIG5ld19zdGF0ZSA/ICJFbiIgOiAiRGlzIik7CiAK
LQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNwaW5fbG9ja19pcnEoJmk5
MTUtPmlycV9sb2NrKTsKIAlob3RwbHVnLT5ocGRfc2hvcnRfc3Rvcm1fZW5hYmxlZCA9IG5ld19z
dGF0ZTsKIAkvKiBSZXNldCB0aGUgSFBEIHN0b3JtIHN0YXRzIHNvIHdlIGRvbid0IGFjY2lkZW50
YWxseSB0cmlnZ2VyIGEgc3Rvcm0gKi8KIAlmb3JfZWFjaF9ocGRfcGluKGkpCiAJCWhvdHBsdWct
PnN0YXRzW2ldLmNvdW50ID0gMDsKLQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9j
ayk7CisJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CiAKIAkvKiBSZS1lbmFibGUg
aHBkIGltbWVkaWF0ZWx5IGlmIHdlIHdlcmUgaW4gYW4gaXJxIHN0b3JtICovCi0JZmx1c2hfZGVs
YXllZF93b3JrKCZkZXZfcHJpdi0+aG90cGx1Zy5yZWVuYWJsZV93b3JrKTsKKwlmbHVzaF9kZWxh
eWVkX3dvcmsoJmk5MTUtPmhvdHBsdWcucmVlbmFibGVfd29yayk7CiAKIAlyZXR1cm4gbGVuOwog
fQpAQCAtNDIzMiwxMSArNDIzMiwxMSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0
aW9ucyBpOTE1X2hwZF9zaG9ydF9zdG9ybV9jdGxfZm9wcyA9IHsKIAogc3RhdGljIGludCBpOTE1
X2RycnNfY3RsX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRhdGE7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZf
cHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKwlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YzsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNykKKwlpZiAoSU5URUxfR0VOKGk5MTUp
IDwgNykKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlmb3JfZWFjaF9pbnRlbF9jcnRjKGRldiwgY3J0
YykgewpAQCAtNDMwNSw5ICs0MzA1LDkgQEAgaTkxNV9maWZvX3VuZGVycnVuX3Jlc2V0X3dyaXRl
KHN0cnVjdCBmaWxlICpmaWxwLAogCQkJICAgICAgIGNvbnN0IGNoYXIgX191c2VyICp1YnVmLAog
CQkJICAgICAgIHNpemVfdCBjbnQsIGxvZmZfdCAqcHBvcykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBmaWxwLT5wcml2YXRlX2RhdGE7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBmaWxwLT5wcml2YXRlX2RhdGE7CiAJc3RydWN0IGludGVsX2NydGMg
KmludGVsX2NydGM7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwor
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCWludCByZXQ7CiAJYm9vbCBy
ZXNldDsKIApAQCAtNDM0Nyw3ICs0MzQ3LDcgQEAgaTkxNV9maWZvX3VuZGVycnVuX3Jlc2V0X3dy
aXRlKHN0cnVjdCBmaWxlICpmaWxwLAogCQkJcmV0dXJuIHJldDsKIAl9CiAKLQlyZXQgPSBpbnRl
bF9mYmNfcmVzZXRfdW5kZXJydW4oZGV2X3ByaXYpOworCXJldCA9IGludGVsX2ZiY19yZXNldF91
bmRlcnJ1bihpOTE1KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCkBAIC00NDM3LDkgKzQ0
MzcsOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfZGVidWdmc19maWxlcyB7CiAJeyJpOTE1
X2VkcF9wc3JfZGVidWciLCAmaTkxNV9lZHBfcHNyX2RlYnVnX2ZvcHN9CiB9OwogCi1pbnQgaTkx
NV9kZWJ1Z2ZzX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2lu
dCBpOTE1X2RlYnVnZnNfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
Ci0Jc3RydWN0IGRybV9taW5vciAqbWlub3IgPSBkZXZfcHJpdi0+ZHJtLnByaW1hcnk7CisJc3Ry
dWN0IGRybV9taW5vciAqbWlub3IgPSBpOTE1LT5kcm0ucHJpbWFyeTsKIAlzdHJ1Y3QgZGVudHJ5
ICplbnQ7CiAJaW50IGk7CiAKQEAgLTQ2OTIsNyArNDY5Miw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVfZHNjX2ZlY19zdXBwb3J0X2ZvcHMgPSB7CiBpbnQgaTkx
NV9kZWJ1Z2ZzX2Nvbm5lY3Rvcl9hZGQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikK
IHsKIAlzdHJ1Y3QgZGVudHJ5ICpyb290ID0gY29ubmVjdG9yLT5kZWJ1Z2ZzX2VudHJ5OwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmRl
dik7CiAKIAkvKiBUaGUgY29ubmVjdG9yIG11c3QgaGF2ZSBiZWVuIHJlZ2lzdGVyZWQgYmVmb3Jl
aGFuZHMuICovCiAJaWYgKCFyb290KQpAQCAtNDcxNyw3ICs0NzE3LDcgQEAgaW50IGk5MTVfZGVi
dWdmc19jb25uZWN0b3JfYWRkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAJCQkJ
ICAgIGNvbm5lY3RvciwgJmk5MTVfaGRjcF9zaW5rX2NhcGFiaWxpdHlfZm9wcyk7CiAJfQogCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgJiYKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDEwICYmCiAJICAgIChjb25uZWN0b3ItPmNvbm5lY3Rvcl90eXBlID09IERSTV9NT0RFX0NPTk5F
Q1RPUl9EaXNwbGF5UG9ydCB8fAogCSAgICAgY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSA9PSBE
Uk1fTU9ERV9DT05ORUNUT1JfZURQKSkKIAkJZGVidWdmc19jcmVhdGVfZmlsZSgiaTkxNV9kc2Nf
ZmVjX3N1cHBvcnQiLCBTX0lSVUdPLCByb290LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
aAppbmRleCBjMGNkMjJlYjkxNmQuLjNlOTllYWY4ZGUwMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kZWJ1Z2ZzLmgKQEAgLTEwLDEwICsxMCwxMCBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsK
IHN0cnVjdCBkcm1fY29ubmVjdG9yOwogCiAjaWZkZWYgQ09ORklHX0RFQlVHX0ZTCi1pbnQgaTkx
NV9kZWJ1Z2ZzX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Citp
bnQgaTkxNV9kZWJ1Z2ZzX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsK
IGludCBpOTE1X2RlYnVnZnNfY29ubmVjdG9yX2FkZChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29u
bmVjdG9yKTsKICNlbHNlCi1zdGF0aWMgaW5saW5lIGludCBpOTE1X2RlYnVnZnNfcmVnaXN0ZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KSB7IHJldHVybiAwOyB9CitzdGF0aWMg
aW5saW5lIGludCBpOTE1X2RlYnVnZnNfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpIHsgcmV0dXJuIDA7IH0KIHN0YXRpYyBpbmxpbmUgaW50IGk5MTVfZGVidWdmc19jb25u
ZWN0b3JfYWRkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpIHsgcmV0dXJuIDA7IH0K
ICNlbmRpZgogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCA4MWZmMmM3OGZkNTUuLmEwOWQw
MjhlYzhkOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC0xMDgsMTEgKzEwOCwxMSBAQCBi
b29sIGk5MTVfZXJyb3JfaW5qZWN0ZWQodm9pZCkKIAkJICAgICJwcm92aWRpbmcgdGhlIGRtZXNn
IGxvZyBieSBib290aW5nIHdpdGggZHJtLmRlYnVnPTB4ZiIKIAogdm9pZAotX19pOTE1X3ByaW50
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGNvbnN0IGNoYXIgKmxldmVsLAor
X19pOTE1X3ByaW50ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgY29uc3QgY2hhciAq
bGV2ZWwsCiAJICAgICAgY29uc3QgY2hhciAqZm10LCAuLi4pCiB7CiAJc3RhdGljIGJvb2wgc2hv
d25fYnVnX29uY2U7Ci0Jc3RydWN0IGRldmljZSAqa2RldiA9IGRldl9wcml2LT5kcm0uZGV2Owor
CXN0cnVjdCBkZXZpY2UgKmtkZXYgPSBpOTE1LT5kcm0uZGV2OwogCWJvb2wgaXNfZXJyb3IgPSBs
ZXZlbFsxXSA8PSBLRVJOX0VSUlsxXTsKIAlib29sIGlzX2RlYnVnID0gbGV2ZWxbMV0gPT0gS0VS
Tl9ERUJVR1sxXTsKIAlzdHJ1Y3QgdmFfZm9ybWF0IHZhZjsKQEAgLTE0OCw3NCArMTQ4LDc0IEBA
IF9faTkxNV9wcmludGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBj
aGFyICpsZXZlbCwKIAogLyogTWFwIFBDSCBkZXZpY2UgaWQgdG8gUENIIHR5cGUsIG9yIFBDSF9O
T05FIGlmIHVua25vd24uICovCiBzdGF0aWMgZW51bSBpbnRlbF9wY2gKLWludGVsX3BjaF90eXBl
KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdW5zaWduZWQgc2hvcnQg
aWQpCitpbnRlbF9wY2hfdHlwZShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
dW5zaWduZWQgc2hvcnQgaWQpCiB7CiAJc3dpdGNoIChpZCkgewogCWNhc2UgSU5URUxfUENIX0lC
WF9ERVZJQ0VfSURfVFlQRToKIAkJRFJNX0RFQlVHX0tNUygiRm91bmQgSWJleCBQZWFrIFBDSFxu
Iik7Ci0JCVdBUk5fT04oIUlTX0dFTihkZXZfcHJpdiwgNSkpOworCQlXQVJOX09OKCFJU19HRU4o
aTkxNSwgNSkpOwogCQlyZXR1cm4gUENIX0lCWDsKIAljYXNlIElOVEVMX1BDSF9DUFRfREVWSUNF
X0lEX1RZUEU6CiAJCURSTV9ERUJVR19LTVMoIkZvdW5kIENvdWdhclBvaW50IFBDSFxuIik7Ci0J
CVdBUk5fT04oIUlTX0dFTihkZXZfcHJpdiwgNikgJiYgIUlTX0lWWUJSSURHRShkZXZfcHJpdikp
OworCQlXQVJOX09OKCFJU19HRU4oaTkxNSwgNikgJiYgIUlTX0lWWUJSSURHRShpOTE1KSk7CiAJ
CXJldHVybiBQQ0hfQ1BUOwogCWNhc2UgSU5URUxfUENIX1BQVF9ERVZJQ0VfSURfVFlQRToKIAkJ
RFJNX0RFQlVHX0tNUygiRm91bmQgUGFudGhlclBvaW50IFBDSFxuIik7Ci0JCVdBUk5fT04oIUlT
X0dFTihkZXZfcHJpdiwgNikgJiYgIUlTX0lWWUJSSURHRShkZXZfcHJpdikpOworCQlXQVJOX09O
KCFJU19HRU4oaTkxNSwgNikgJiYgIUlTX0lWWUJSSURHRShpOTE1KSk7CiAJCS8qIFBhbnRoZXJQ
b2ludCBpcyBDUFQgY29tcGF0aWJsZSAqLwogCQlyZXR1cm4gUENIX0NQVDsKIAljYXNlIElOVEVM
X1BDSF9MUFRfREVWSUNFX0lEX1RZUEU6CiAJCURSTV9ERUJVR19LTVMoIkZvdW5kIEx5bnhQb2lu
dCBQQ0hcbiIpOwotCQlXQVJOX09OKCFJU19IQVNXRUxMKGRldl9wcml2KSAmJiAhSVNfQlJPQURX
RUxMKGRldl9wcml2KSk7Ci0JCVdBUk5fT04oSVNfSFNXX1VMVChkZXZfcHJpdikgfHwgSVNfQkRX
X1VMVChkZXZfcHJpdikpOworCQlXQVJOX09OKCFJU19IQVNXRUxMKGk5MTUpICYmICFJU19CUk9B
RFdFTEwoaTkxNSkpOworCQlXQVJOX09OKElTX0hTV19VTFQoaTkxNSkgfHwgSVNfQkRXX1VMVChp
OTE1KSk7CiAJCXJldHVybiBQQ0hfTFBUOwogCWNhc2UgSU5URUxfUENIX0xQVF9MUF9ERVZJQ0Vf
SURfVFlQRToKIAkJRFJNX0RFQlVHX0tNUygiRm91bmQgTHlueFBvaW50IExQIFBDSFxuIik7Ci0J
CVdBUk5fT04oIUlTX0hBU1dFTEwoZGV2X3ByaXYpICYmICFJU19CUk9BRFdFTEwoZGV2X3ByaXYp
KTsKLQkJV0FSTl9PTighSVNfSFNXX1VMVChkZXZfcHJpdikgJiYgIUlTX0JEV19VTFQoZGV2X3By
aXYpKTsKKwkJV0FSTl9PTighSVNfSEFTV0VMTChpOTE1KSAmJiAhSVNfQlJPQURXRUxMKGk5MTUp
KTsKKwkJV0FSTl9PTighSVNfSFNXX1VMVChpOTE1KSAmJiAhSVNfQkRXX1VMVChpOTE1KSk7CiAJ
CXJldHVybiBQQ0hfTFBUOwogCWNhc2UgSU5URUxfUENIX1dQVF9ERVZJQ0VfSURfVFlQRToKIAkJ
RFJNX0RFQlVHX0tNUygiRm91bmQgV2lsZGNhdFBvaW50IFBDSFxuIik7Ci0JCVdBUk5fT04oIUlT
X0hBU1dFTEwoZGV2X3ByaXYpICYmICFJU19CUk9BRFdFTEwoZGV2X3ByaXYpKTsKLQkJV0FSTl9P
TihJU19IU1dfVUxUKGRldl9wcml2KSB8fCBJU19CRFdfVUxUKGRldl9wcml2KSk7CisJCVdBUk5f
T04oIUlTX0hBU1dFTEwoaTkxNSkgJiYgIUlTX0JST0FEV0VMTChpOTE1KSk7CisJCVdBUk5fT04o
SVNfSFNXX1VMVChpOTE1KSB8fCBJU19CRFdfVUxUKGk5MTUpKTsKIAkJLyogV2lsZGNhdFBvaW50
IGlzIExQVCBjb21wYXRpYmxlICovCiAJCXJldHVybiBQQ0hfTFBUOwogCWNhc2UgSU5URUxfUENI
X1dQVF9MUF9ERVZJQ0VfSURfVFlQRToKIAkJRFJNX0RFQlVHX0tNUygiRm91bmQgV2lsZGNhdFBv
aW50IExQIFBDSFxuIik7Ci0JCVdBUk5fT04oIUlTX0hBU1dFTEwoZGV2X3ByaXYpICYmICFJU19C
Uk9BRFdFTEwoZGV2X3ByaXYpKTsKLQkJV0FSTl9PTighSVNfSFNXX1VMVChkZXZfcHJpdikgJiYg
IUlTX0JEV19VTFQoZGV2X3ByaXYpKTsKKwkJV0FSTl9PTighSVNfSEFTV0VMTChpOTE1KSAmJiAh
SVNfQlJPQURXRUxMKGk5MTUpKTsKKwkJV0FSTl9PTighSVNfSFNXX1VMVChpOTE1KSAmJiAhSVNf
QkRXX1VMVChpOTE1KSk7CiAJCS8qIFdpbGRjYXRQb2ludCBpcyBMUFQgY29tcGF0aWJsZSAqLwog
CQlyZXR1cm4gUENIX0xQVDsKIAljYXNlIElOVEVMX1BDSF9TUFRfREVWSUNFX0lEX1RZUEU6CiAJ
CURSTV9ERUJVR19LTVMoIkZvdW5kIFN1bnJpc2VQb2ludCBQQ0hcbiIpOwotCQlXQVJOX09OKCFJ
U19TS1lMQUtFKGRldl9wcml2KSAmJiAhSVNfS0FCWUxBS0UoZGV2X3ByaXYpKTsKKwkJV0FSTl9P
TighSVNfU0tZTEFLRShpOTE1KSAmJiAhSVNfS0FCWUxBS0UoaTkxNSkpOwogCQlyZXR1cm4gUENI
X1NQVDsKIAljYXNlIElOVEVMX1BDSF9TUFRfTFBfREVWSUNFX0lEX1RZUEU6CiAJCURSTV9ERUJV
R19LTVMoIkZvdW5kIFN1bnJpc2VQb2ludCBMUCBQQ0hcbiIpOwotCQlXQVJOX09OKCFJU19TS1lM
QUtFKGRldl9wcml2KSAmJiAhSVNfS0FCWUxBS0UoZGV2X3ByaXYpKTsKKwkJV0FSTl9PTighSVNf
U0tZTEFLRShpOTE1KSAmJiAhSVNfS0FCWUxBS0UoaTkxNSkpOwogCQlyZXR1cm4gUENIX1NQVDsK
IAljYXNlIElOVEVMX1BDSF9LQlBfREVWSUNFX0lEX1RZUEU6CiAJCURSTV9ERUJVR19LTVMoIkZv
dW5kIEthYnkgTGFrZSBQQ0ggKEtCUClcbiIpOwotCQlXQVJOX09OKCFJU19TS1lMQUtFKGRldl9w
cml2KSAmJiAhSVNfS0FCWUxBS0UoZGV2X3ByaXYpICYmCi0JCQkhSVNfQ09GRkVFTEFLRShkZXZf
cHJpdikpOworCQlXQVJOX09OKCFJU19TS1lMQUtFKGk5MTUpICYmICFJU19LQUJZTEFLRShpOTE1
KSAmJgorCQkJIUlTX0NPRkZFRUxBS0UoaTkxNSkpOwogCQkvKiBLQlAgaXMgU1BUIGNvbXBhdGli
bGUgKi8KIAkJcmV0dXJuIFBDSF9TUFQ7CiAJY2FzZSBJTlRFTF9QQ0hfQ05QX0RFVklDRV9JRF9U
WVBFOgogCQlEUk1fREVCVUdfS01TKCJGb3VuZCBDYW5ub24gTGFrZSBQQ0ggKENOUClcbiIpOwot
CQlXQVJOX09OKCFJU19DQU5OT05MQUtFKGRldl9wcml2KSAmJiAhSVNfQ09GRkVFTEFLRShkZXZf
cHJpdikpOworCQlXQVJOX09OKCFJU19DQU5OT05MQUtFKGk5MTUpICYmICFJU19DT0ZGRUVMQUtF
KGk5MTUpKTsKIAkJcmV0dXJuIFBDSF9DTlA7CiAJY2FzZSBJTlRFTF9QQ0hfQ05QX0xQX0RFVklD
RV9JRF9UWVBFOgogCQlEUk1fREVCVUdfS01TKCJGb3VuZCBDYW5ub24gTGFrZSBMUCBQQ0ggKENO
UC1MUClcbiIpOwotCQlXQVJOX09OKCFJU19DQU5OT05MQUtFKGRldl9wcml2KSAmJiAhSVNfQ09G
RkVFTEFLRShkZXZfcHJpdikpOworCQlXQVJOX09OKCFJU19DQU5OT05MQUtFKGk5MTUpICYmICFJ
U19DT0ZGRUVMQUtFKGk5MTUpKTsKIAkJcmV0dXJuIFBDSF9DTlA7CiAJY2FzZSBJTlRFTF9QQ0hf
Q01QX0RFVklDRV9JRF9UWVBFOgogCQlEUk1fREVCVUdfS01TKCJGb3VuZCBDb21ldCBMYWtlIFBD
SCAoQ01QKVxuIik7Ci0JCVdBUk5fT04oIUlTX0NPRkZFRUxBS0UoZGV2X3ByaXYpKTsKKwkJV0FS
Tl9PTighSVNfQ09GRkVFTEFLRShpOTE1KSk7CiAJCS8qIENvbWV0UG9pbnQgaXMgQ05QIENvbXBh
dGlibGUgKi8KIAkJcmV0dXJuIFBDSF9DTlA7CiAJY2FzZSBJTlRFTF9QQ0hfSUNQX0RFVklDRV9J
RF9UWVBFOgogCQlEUk1fREVCVUdfS01TKCJGb3VuZCBJY2UgTGFrZSBQQ0hcbiIpOwotCQlXQVJO
X09OKCFJU19JQ0VMQUtFKGRldl9wcml2KSk7CisJCVdBUk5fT04oIUlTX0lDRUxBS0UoaTkxNSkp
OwogCQlyZXR1cm4gUENIX0lDUDsKIAlkZWZhdWx0OgogCQlyZXR1cm4gUENIX05PTkU7CkBAIC0y
MzMsNyArMjMzLDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfaXNfdmlydF9wY2godW5zaWduZWQgc2hv
cnQgaWQsCiB9CiAKIHN0YXRpYyB1bnNpZ25lZCBzaG9ydAotaW50ZWxfdmlydF9kZXRlY3RfcGNo
KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludGVsX3ZpcnRfZGV0
ZWN0X3BjaChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1bnNpZ25l
ZCBzaG9ydCBpZCA9IDA7CiAKQEAgLTI0NCwxOSArMjQ0LDE5IEBAIGludGVsX3ZpcnRfZGV0ZWN0
X3BjaChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogbWFrZSBh
biBlZHVjYXRlZCBndWVzcyBhcyB0byB3aGljaCBQQ0ggaXMgcmVhbGx5IHRoZXJlLgogCSAqLwog
Ci0JaWYgKElTX0lDRUxBS0UoZGV2X3ByaXYpKQorCWlmIChJU19JQ0VMQUtFKGk5MTUpKQogCQlp
ZCA9IElOVEVMX1BDSF9JQ1BfREVWSUNFX0lEX1RZUEU7Ci0JZWxzZSBpZiAoSVNfQ0FOTk9OTEFL
RShkZXZfcHJpdikgfHwgSVNfQ09GRkVFTEFLRShkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfQ0FO
Tk9OTEFLRShpOTE1KSB8fCBJU19DT0ZGRUVMQUtFKGk5MTUpKQogCQlpZCA9IElOVEVMX1BDSF9D
TlBfREVWSUNFX0lEX1RZUEU7Ci0JZWxzZSBpZiAoSVNfS0FCWUxBS0UoZGV2X3ByaXYpIHx8IElT
X1NLWUxBS0UoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0tBQllMQUtFKGk5MTUpIHx8IElTX1NL
WUxBS0UoaTkxNSkpCiAJCWlkID0gSU5URUxfUENIX1NQVF9ERVZJQ0VfSURfVFlQRTsKLQllbHNl
IGlmIChJU19IU1dfVUxUKGRldl9wcml2KSB8fCBJU19CRFdfVUxUKGRldl9wcml2KSkKKwllbHNl
IGlmIChJU19IU1dfVUxUKGk5MTUpIHx8IElTX0JEV19VTFQoaTkxNSkpCiAJCWlkID0gSU5URUxf
UENIX0xQVF9MUF9ERVZJQ0VfSURfVFlQRTsKLQllbHNlIGlmIChJU19IQVNXRUxMKGRldl9wcml2
KSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0hBU1dFTEwoaTkxNSkg
fHwgSVNfQlJPQURXRUxMKGk5MTUpKQogCQlpZCA9IElOVEVMX1BDSF9MUFRfREVWSUNFX0lEX1RZ
UEU7Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA2KSB8fCBJU19JVllCUklER0UoZGV2X3By
aXYpKQorCWVsc2UgaWYgKElTX0dFTihpOTE1LCA2KSB8fCBJU19JVllCUklER0UoaTkxNSkpCiAJ
CWlkID0gSU5URUxfUENIX0NQVF9ERVZJQ0VfSURfVFlQRTsKLQllbHNlIGlmIChJU19HRU4oZGV2
X3ByaXYsIDUpKQorCWVsc2UgaWYgKElTX0dFTihpOTE1LCA1KSkKIAkJaWQgPSBJTlRFTF9QQ0hf
SUJYX0RFVklDRV9JRF9UWVBFOwogCiAJaWYgKGlkKQpAQCAtMjY3LDcgKzI2Nyw3IEBAIGludGVs
X3ZpcnRfZGV0ZWN0X3BjaChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJcmV0dXJuIGlkOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9kZXRlY3RfcGNoKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2RldGVjdF9wY2go
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IHBjaV9kZXYgKnBjaCA9
IE5VTEw7CiAKQEAgLTI5MSwyMiArMjkxLDIyIEBAIHN0YXRpYyB2b2lkIGludGVsX2RldGVjdF9w
Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJCWlkID0gcGNoLT5kZXZp
Y2UgJiBJTlRFTF9QQ0hfREVWSUNFX0lEX01BU0s7CiAKLQkJcGNoX3R5cGUgPSBpbnRlbF9wY2hf
dHlwZShkZXZfcHJpdiwgaWQpOworCQlwY2hfdHlwZSA9IGludGVsX3BjaF90eXBlKGk5MTUsIGlk
KTsKIAkJaWYgKHBjaF90eXBlICE9IFBDSF9OT05FKSB7Ci0JCQlkZXZfcHJpdi0+cGNoX3R5cGUg
PSBwY2hfdHlwZTsKLQkJCWRldl9wcml2LT5wY2hfaWQgPSBpZDsKKwkJCWk5MTUtPnBjaF90eXBl
ID0gcGNoX3R5cGU7CisJCQlpOTE1LT5wY2hfaWQgPSBpZDsKIAkJCWJyZWFrOwogCQl9IGVsc2Ug
aWYgKGludGVsX2lzX3ZpcnRfcGNoKGlkLCBwY2gtPnN1YnN5c3RlbV92ZW5kb3IsCiAJCQkJCSBw
Y2gtPnN1YnN5c3RlbV9kZXZpY2UpKSB7Ci0JCQlpZCA9IGludGVsX3ZpcnRfZGV0ZWN0X3BjaChk
ZXZfcHJpdik7Ci0JCQlwY2hfdHlwZSA9IGludGVsX3BjaF90eXBlKGRldl9wcml2LCBpZCk7CisJ
CQlpZCA9IGludGVsX3ZpcnRfZGV0ZWN0X3BjaChpOTE1KTsKKwkJCXBjaF90eXBlID0gaW50ZWxf
cGNoX3R5cGUoaTkxNSwgaWQpOwogCiAJCQkvKiBTYW5pdHkgY2hlY2sgdmlydHVhbCBQQ0ggaWQg
Ki8KIAkJCWlmIChXQVJOX09OKGlkICYmIHBjaF90eXBlID09IFBDSF9OT05FKSkKIAkJCQlpZCA9
IDA7CiAKLQkJCWRldl9wcml2LT5wY2hfdHlwZSA9IHBjaF90eXBlOwotCQkJZGV2X3ByaXYtPnBj
aF9pZCA9IGlkOworCQkJaTkxNS0+cGNoX3R5cGUgPSBwY2hfdHlwZTsKKwkJCWk5MTUtPnBjaF9p
ZCA9IGlkOwogCQkJYnJlYWs7CiAJCX0KIAl9CkBAIC0zMTUsMTAgKzMxNSwxMCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9kZXRlY3RfcGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkgKiBVc2UgUENIX05PUCAoUENIIGJ1dCBubyBTb3V0aCBEaXNwbGF5KSBmb3IgUENIIHBsYXRm
b3JtcyB3aXRob3V0CiAJICogZGlzcGxheS4KIAkgKi8KLQlpZiAocGNoICYmICFIQVNfRElTUExB
WShkZXZfcHJpdikpIHsKKwlpZiAocGNoICYmICFIQVNfRElTUExBWShpOTE1KSkgewogCQlEUk1f
REVCVUdfS01TKCJEaXNwbGF5IGRpc2FibGVkLCByZXZlcnRpbmcgdG8gTk9QIFBDSFxuIik7Ci0J
CWRldl9wcml2LT5wY2hfdHlwZSA9IFBDSF9OT1A7Ci0JCWRldl9wcml2LT5wY2hfaWQgPSAwOwor
CQlpOTE1LT5wY2hfdHlwZSA9IFBDSF9OT1A7CisJCWk5MTUtPnBjaF9pZCA9IDA7CiAJfQogCiAJ
aWYgKCFwY2gpCkBAIC0zMzAsOSArMzMwLDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGV0ZWN0X3Bj
aChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiBzdGF0aWMgaW50IGk5MTVfZ2V0
cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJCSAgICAg
ICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZf
cHJpdi0+ZHJtLnBkZXY7Ci0JY29uc3Qgc3RydWN0IHNzZXVfZGV2X2luZm8gKnNzZXUgPSAmUlVO
VElNRV9JTkZPKGRldl9wcml2KS0+c3NldTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5wZGV2
OworCWNvbnN0IHN0cnVjdCBzc2V1X2Rldl9pbmZvICpzc2V1ID0gJlJVTlRJTUVfSU5GTyhpOTE1
KS0+c3NldTsKIAlkcm1faTkxNV9nZXRwYXJhbV90ICpwYXJhbSA9IGRhdGE7CiAJaW50IHZhbHVl
OwogCkBAIC0zNTAsNDAgKzM1MCw0MCBAQCBzdGF0aWMgaW50IGk5MTVfZ2V0cGFyYW1faW9jdGwo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJdmFsdWUgPSBwZGV2LT5yZXZp
c2lvbjsKIAkJYnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX05VTV9GRU5DRVNfQVZBSUw6Ci0JCXZh
bHVlID0gZGV2X3ByaXYtPm51bV9mZW5jZV9yZWdzOworCQl2YWx1ZSA9IGk5MTUtPm51bV9mZW5j
ZV9yZWdzOwogCQlicmVhazsKIAljYXNlIEk5MTVfUEFSQU1fSEFTX09WRVJMQVk6Ci0JCXZhbHVl
ID0gZGV2X3ByaXYtPm92ZXJsYXkgPyAxIDogMDsKKwkJdmFsdWUgPSBpOTE1LT5vdmVybGF5ID8g
MSA6IDA7CiAJCWJyZWFrOwogCWNhc2UgSTkxNV9QQVJBTV9IQVNfQlNEOgotCQl2YWx1ZSA9ICEh
ZGV2X3ByaXYtPmVuZ2luZVtWQ1MwXTsKKwkJdmFsdWUgPSAhIWk5MTUtPmVuZ2luZVtWQ1MwXTsK
IAkJYnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX0hBU19CTFQ6Ci0JCXZhbHVlID0gISFkZXZfcHJp
di0+ZW5naW5lW0JDUzBdOworCQl2YWx1ZSA9ICEhaTkxNS0+ZW5naW5lW0JDUzBdOwogCQlicmVh
azsKIAljYXNlIEk5MTVfUEFSQU1fSEFTX1ZFQk9YOgotCQl2YWx1ZSA9ICEhZGV2X3ByaXYtPmVu
Z2luZVtWRUNTMF07CisJCXZhbHVlID0gISFpOTE1LT5lbmdpbmVbVkVDUzBdOwogCQlicmVhazsK
IAljYXNlIEk5MTVfUEFSQU1fSEFTX0JTRDI6Ci0JCXZhbHVlID0gISFkZXZfcHJpdi0+ZW5naW5l
W1ZDUzFdOworCQl2YWx1ZSA9ICEhaTkxNS0+ZW5naW5lW1ZDUzFdOwogCQlicmVhazsKIAljYXNl
IEk5MTVfUEFSQU1fSEFTX0xMQzoKLQkJdmFsdWUgPSBIQVNfTExDKGRldl9wcml2KTsKKwkJdmFs
dWUgPSBIQVNfTExDKGk5MTUpOwogCQlicmVhazsKIAljYXNlIEk5MTVfUEFSQU1fSEFTX1dUOgot
CQl2YWx1ZSA9IEhBU19XVChkZXZfcHJpdik7CisJCXZhbHVlID0gSEFTX1dUKGk5MTUpOwogCQli
cmVhazsKIAljYXNlIEk5MTVfUEFSQU1fSEFTX0FMSUFTSU5HX1BQR1RUOgotCQl2YWx1ZSA9IElO
VEVMX1BQR1RUKGRldl9wcml2KTsKKwkJdmFsdWUgPSBJTlRFTF9QUEdUVChpOTE1KTsKIAkJYnJl
YWs7CiAJY2FzZSBJOTE1X1BBUkFNX0hBU19TRU1BUEhPUkVTOgotCQl2YWx1ZSA9ICEhKGRldl9w
cml2LT5jYXBzLnNjaGVkdWxlciAmIEk5MTVfU0NIRURVTEVSX0NBUF9TRU1BUEhPUkVTKTsKKwkJ
dmFsdWUgPSAhIShpOTE1LT5jYXBzLnNjaGVkdWxlciAmIEk5MTVfU0NIRURVTEVSX0NBUF9TRU1B
UEhPUkVTKTsKIAkJYnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX0hBU19TRUNVUkVfQkFUQ0hFUzoK
IAkJdmFsdWUgPSBjYXBhYmxlKENBUF9TWVNfQURNSU4pOwogCQlicmVhazsKIAljYXNlIEk5MTVf
UEFSQU1fQ01EX1BBUlNFUl9WRVJTSU9OOgotCQl2YWx1ZSA9IGk5MTVfY21kX3BhcnNlcl9nZXRf
dmVyc2lvbihkZXZfcHJpdik7CisJCXZhbHVlID0gaTkxNV9jbWRfcGFyc2VyX2dldF92ZXJzaW9u
KGk5MTUpOwogCQlicmVhazsKIAljYXNlIEk5MTVfUEFSQU1fU1VCU0xJQ0VfVE9UQUw6CiAJCXZh
bHVlID0gaW50ZWxfc3NldV9zdWJzbGljZV90b3RhbChzc2V1KTsKQEAgLTM5NywyMSArMzk3LDIx
IEBAIHN0YXRpYyBpbnQgaTkxNV9nZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogCQlicmVhazsKIAljYXNlIEk5MTVfUEFSQU1fSEFTX0dQVV9SRVNFVDoK
IAkJdmFsdWUgPSBpOTE1X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrICYmCi0JCQlpbnRlbF9o
YXNfZ3B1X3Jlc2V0KGRldl9wcml2KTsKLQkJaWYgKHZhbHVlICYmIGludGVsX2hhc19yZXNldF9l
bmdpbmUoZGV2X3ByaXYpKQorCQkJaW50ZWxfaGFzX2dwdV9yZXNldChpOTE1KTsKKwkJaWYgKHZh
bHVlICYmIGludGVsX2hhc19yZXNldF9lbmdpbmUoaTkxNSkpCiAJCQl2YWx1ZSA9IDI7CiAJCWJy
ZWFrOwogCWNhc2UgSTkxNV9QQVJBTV9IQVNfUkVTT1VSQ0VfU1RSRUFNRVI6CiAJCXZhbHVlID0g
MDsKIAkJYnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX0hBU19QT09MRURfRVU6Ci0JCXZhbHVlID0g
SEFTX1BPT0xFRF9FVShkZXZfcHJpdik7CisJCXZhbHVlID0gSEFTX1BPT0xFRF9FVShpOTE1KTsK
IAkJYnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX01JTl9FVV9JTl9QT09MOgogCQl2YWx1ZSA9IHNz
ZXUtPm1pbl9ldV9pbl9wb29sOwogCQlicmVhazsKIAljYXNlIEk5MTVfUEFSQU1fSFVDX1NUQVRV
UzoKLQkJdmFsdWUgPSBpbnRlbF9odWNfY2hlY2tfc3RhdHVzKCZkZXZfcHJpdi0+aHVjKTsKKwkJ
dmFsdWUgPSBpbnRlbF9odWNfY2hlY2tfc3RhdHVzKCZpOTE1LT5odWMpOwogCQlpZiAodmFsdWUg
PCAwKQogCQkJcmV0dXJuIHZhbHVlOwogCQlicmVhazsKQEAgLTQyMyw3ICs0MjMsNyBAQCBzdGF0
aWMgaW50IGk5MTVfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAq
ZGF0YSwKIAkJdmFsdWUgPSBpOTE1X2dlbV9tbWFwX2d0dF92ZXJzaW9uKCk7CiAJCWJyZWFrOwog
CWNhc2UgSTkxNV9QQVJBTV9IQVNfU0NIRURVTEVSOgotCQl2YWx1ZSA9IGRldl9wcml2LT5jYXBz
LnNjaGVkdWxlcjsKKwkJdmFsdWUgPSBpOTE1LT5jYXBzLnNjaGVkdWxlcjsKIAkJYnJlYWs7CiAK
IAljYXNlIEk5MTVfUEFSQU1fTU1BUF9WRVJTSU9OOgpAQCAtNDU2LDcgKzQ1Niw3IEBAIHN0YXRp
YyBpbnQgaTkxNV9nZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLAogCQl2YWx1ZSA9IDE7CiAJCWJyZWFrOwogCWNhc2UgSTkxNV9QQVJBTV9IQVNfQ09OVEVY
VF9JU09MQVRJT046Ci0JCXZhbHVlID0gaW50ZWxfZW5naW5lc19oYXNfY29udGV4dF9pc29sYXRp
b24oZGV2X3ByaXYpOworCQl2YWx1ZSA9IGludGVsX2VuZ2luZXNfaGFzX2NvbnRleHRfaXNvbGF0
aW9uKGk5MTUpOwogCQlicmVhazsKIAljYXNlIEk5MTVfUEFSQU1fU0xJQ0VfTUFTSzoKIAkJdmFs
dWUgPSBzc2V1LT5zbGljZV9tYXNrOwpAQCAtNDY5LDEwICs0NjksMTAgQEAgc3RhdGljIGludCBp
OTE1X2dldHBhcmFtX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJ
CQlyZXR1cm4gLUVOT0RFVjsKIAkJYnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX0NTX1RJTUVTVEFN
UF9GUkVRVUVOQ1k6Ci0JCXZhbHVlID0gMTAwMCAqIFJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPmNz
X3RpbWVzdGFtcF9mcmVxdWVuY3lfa2h6OworCQl2YWx1ZSA9IDEwMDAgKiBSVU5USU1FX0lORk8o
aTkxNSktPmNzX3RpbWVzdGFtcF9mcmVxdWVuY3lfa2h6OwogCQlicmVhazsKIAljYXNlIEk5MTVf
UEFSQU1fTU1BUF9HVFRfQ09IRVJFTlQ6Ci0JCXZhbHVlID0gSU5URUxfSU5GTyhkZXZfcHJpdikt
Pmhhc19jb2hlcmVudF9nZ3R0OworCQl2YWx1ZSA9IElOVEVMX0lORk8oaTkxNSktPmhhc19jb2hl
cmVudF9nZ3R0OwogCQlicmVhazsKIAlkZWZhdWx0OgogCQlEUk1fREVCVUcoIlVua25vd24gcGFy
YW1ldGVyICVkXG4iLCBwYXJhbS0+cGFyYW0pOwpAQCAtNDg1LDEzICs0ODUsMTMgQEAgc3RhdGlj
IGludCBpOTE1X2dldHBhcmFtX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRh
dGEsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgaTkxNV9nZXRfYnJpZGdlX2RldihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW50IGk5MTVfZ2V0X2JyaWRn
ZV9kZXYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaW50IGRvbWFpbiA9IHBj
aV9kb21haW5fbnIoZGV2X3ByaXYtPmRybS5wZGV2LT5idXMpOworCWludCBkb21haW4gPSBwY2lf
ZG9tYWluX25yKGk5MTUtPmRybS5wZGV2LT5idXMpOwogCi0JZGV2X3ByaXYtPmJyaWRnZV9kZXYg
PQorCWk5MTUtPmJyaWRnZV9kZXYgPQogCQlwY2lfZ2V0X2RvbWFpbl9idXNfYW5kX3Nsb3QoZG9t
YWluLCAwLCBQQ0lfREVWRk4oMCwgMCkpOwotCWlmICghZGV2X3ByaXYtPmJyaWRnZV9kZXYpIHsK
KwlpZiAoIWk5MTUtPmJyaWRnZV9kZXYpIHsKIAkJRFJNX0VSUk9SKCJicmlkZ2UgZGV2aWNlIG5v
dCBmb3VuZFxuIik7CiAJCXJldHVybiAtMTsKIAl9CkBAIC01MDAsMTYgKzUwMCwxNiBAQCBzdGF0
aWMgaW50IGk5MTVfZ2V0X2JyaWRnZV9kZXYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCiAvKiBBbGxvY2F0ZSBzcGFjZSBmb3IgdGhlIE1DSCByZWdzIGlmIG5lZWRlZCwgcmV0
dXJuIG5vbnplcm8gb24gZXJyb3IgKi8KIHN0YXRpYyBpbnQKLWludGVsX2FsbG9jX21jaGJhcl9y
ZXNvdXJjZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnRlbF9hbGxvY19t
Y2hiYXJfcmVzb3VyY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaW50IHJl
ZyA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCA/IE1DSEJBUl9JOTY1IDogTUNIQkFSX0k5MTU7
CisJaW50IHJlZyA9IElOVEVMX0dFTihpOTE1KSA+PSA0ID8gTUNIQkFSX0k5NjUgOiBNQ0hCQVJf
STkxNTsKIAl1MzIgdGVtcF9sbywgdGVtcF9oaSA9IDA7CiAJdTY0IG1jaGJhcl9hZGRyOwogCWlu
dCByZXQ7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQotCQlwY2lfcmVhZF9jb25m
aWdfZHdvcmQoZGV2X3ByaXYtPmJyaWRnZV9kZXYsIHJlZyArIDQsICZ0ZW1wX2hpKTsKLQlwY2lf
cmVhZF9jb25maWdfZHdvcmQoZGV2X3ByaXYtPmJyaWRnZV9kZXYsIHJlZywgJnRlbXBfbG8pOwor
CWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkKKwkJcGNpX3JlYWRfY29uZmlnX2R3b3JkKGk5MTUt
PmJyaWRnZV9kZXYsIHJlZyArIDQsICZ0ZW1wX2hpKTsKKwlwY2lfcmVhZF9jb25maWdfZHdvcmQo
aTkxNS0+YnJpZGdlX2RldiwgcmVnLCAmdGVtcF9sbyk7CiAJbWNoYmFyX2FkZHIgPSAoKHU2NCl0
ZW1wX2hpIDw8IDMyKSB8IHRlbXBfbG87CiAKIAkvKiBJZiBBQ1BJIGRvZXNuJ3QgaGF2ZSBpdCwg
YXNzdW1lIHdlIG5lZWQgdG8gYWxsb2NhdGUgaXQgb3Vyc2VsdmVzICovCkBAIC01MjAsNDcgKzUy
MCw0NyBAQCBpbnRlbF9hbGxvY19tY2hiYXJfcmVzb3VyY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogI2VuZGlmCiAKIAkvKiBHZXQgc29tZSBzcGFjZSBmb3IgaXQgKi8KLQlk
ZXZfcHJpdi0+bWNoX3Jlcy5uYW1lID0gImk5MTUgTUNIQkFSIjsKLQlkZXZfcHJpdi0+bWNoX3Jl
cy5mbGFncyA9IElPUkVTT1VSQ0VfTUVNOwotCXJldCA9IHBjaV9idXNfYWxsb2NfcmVzb3VyY2Uo
ZGV2X3ByaXYtPmJyaWRnZV9kZXYtPmJ1cywKLQkJCQkgICAgICZkZXZfcHJpdi0+bWNoX3JlcywK
KwlpOTE1LT5tY2hfcmVzLm5hbWUgPSAiaTkxNSBNQ0hCQVIiOworCWk5MTUtPm1jaF9yZXMuZmxh
Z3MgPSBJT1JFU09VUkNFX01FTTsKKwlyZXQgPSBwY2lfYnVzX2FsbG9jX3Jlc291cmNlKGk5MTUt
PmJyaWRnZV9kZXYtPmJ1cywKKwkJCQkgICAgICZpOTE1LT5tY2hfcmVzLAogCQkJCSAgICAgTUNI
QkFSX1NJWkUsIE1DSEJBUl9TSVpFLAogCQkJCSAgICAgUENJQklPU19NSU5fTUVNLAogCQkJCSAg
ICAgMCwgcGNpYmlvc19hbGlnbl9yZXNvdXJjZSwKLQkJCQkgICAgIGRldl9wcml2LT5icmlkZ2Vf
ZGV2KTsKKwkJCQkgICAgIGk5MTUtPmJyaWRnZV9kZXYpOwogCWlmIChyZXQpIHsKIAkJRFJNX0RF
QlVHX0RSSVZFUigiZmFpbGVkIGJ1cyBhbGxvYzogJWRcbiIsIHJldCk7Ci0JCWRldl9wcml2LT5t
Y2hfcmVzLnN0YXJ0ID0gMDsKKwkJaTkxNS0+bWNoX3Jlcy5zdGFydCA9IDA7CiAJCXJldHVybiBy
ZXQ7CiAJfQogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKLQkJcGNpX3dyaXRlX2Nv
bmZpZ19kd29yZChkZXZfcHJpdi0+YnJpZGdlX2RldiwgcmVnICsgNCwKLQkJCQkgICAgICAgdXBw
ZXJfMzJfYml0cyhkZXZfcHJpdi0+bWNoX3Jlcy5zdGFydCkpOworCWlmIChJTlRFTF9HRU4oaTkx
NSkgPj0gNCkKKwkJcGNpX3dyaXRlX2NvbmZpZ19kd29yZChpOTE1LT5icmlkZ2VfZGV2LCByZWcg
KyA0LAorCQkJCSAgICAgICB1cHBlcl8zMl9iaXRzKGk5MTUtPm1jaF9yZXMuc3RhcnQpKTsKIAot
CXBjaV93cml0ZV9jb25maWdfZHdvcmQoZGV2X3ByaXYtPmJyaWRnZV9kZXYsIHJlZywKLQkJCSAg
ICAgICBsb3dlcl8zMl9iaXRzKGRldl9wcml2LT5tY2hfcmVzLnN0YXJ0KSk7CisJcGNpX3dyaXRl
X2NvbmZpZ19kd29yZChpOTE1LT5icmlkZ2VfZGV2LCByZWcsCisJCQkgICAgICAgbG93ZXJfMzJf
Yml0cyhpOTE1LT5tY2hfcmVzLnN0YXJ0KSk7CiAJcmV0dXJuIDA7CiB9CiAKIC8qIFNldHVwIE1D
SEJBUiBpZiBwb3NzaWJsZSwgcmV0dXJuIHRydWUgaWYgd2Ugc2hvdWxkIGRpc2FibGUgaXQgYWdh
aW4gKi8KIHN0YXRpYyB2b2lkCi1pbnRlbF9zZXR1cF9tY2hiYXIoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQoraW50ZWxfc2V0dXBfbWNoYmFyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewotCWludCBtY2hiYXJfcmVnID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSA0
ID8gTUNIQkFSX0k5NjUgOiBNQ0hCQVJfSTkxNTsKKwlpbnQgbWNoYmFyX3JlZyA9IElOVEVMX0dF
TihpOTE1KSA+PSA0ID8gTUNIQkFSX0k5NjUgOiBNQ0hCQVJfSTkxNTsKIAl1MzIgdGVtcDsKIAli
b29sIGVuYWJsZWQ7CiAKLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZ
VklFVyhkZXZfcHJpdikpCisJaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklF
VyhpOTE1KSkKIAkJcmV0dXJuOwogCi0JZGV2X3ByaXYtPm1jaGJhcl9uZWVkX2Rpc2FibGUgPSBm
YWxzZTsKKwlpOTE1LT5tY2hiYXJfbmVlZF9kaXNhYmxlID0gZmFsc2U7CiAKLQlpZiAoSVNfSTkx
NUcoZGV2X3ByaXYpIHx8IElTX0k5MTVHTShkZXZfcHJpdikpIHsKLQkJcGNpX3JlYWRfY29uZmln
X2R3b3JkKGRldl9wcml2LT5icmlkZ2VfZGV2LCBERVZFTiwgJnRlbXApOworCWlmIChJU19JOTE1
RyhpOTE1KSB8fCBJU19JOTE1R00oaTkxNSkpIHsKKwkJcGNpX3JlYWRfY29uZmlnX2R3b3JkKGk5
MTUtPmJyaWRnZV9kZXYsIERFVkVOLCAmdGVtcCk7CiAJCWVuYWJsZWQgPSAhISh0ZW1wICYgREVW
RU5fTUNIQkFSX0VOKTsKIAl9IGVsc2UgewotCQlwY2lfcmVhZF9jb25maWdfZHdvcmQoZGV2X3By
aXYtPmJyaWRnZV9kZXYsIG1jaGJhcl9yZWcsICZ0ZW1wKTsKKwkJcGNpX3JlYWRfY29uZmlnX2R3
b3JkKGk5MTUtPmJyaWRnZV9kZXYsIG1jaGJhcl9yZWcsICZ0ZW1wKTsKIAkJZW5hYmxlZCA9IHRl
bXAgJiAxOwogCX0KIApAQCAtNTY4LDU2ICs1NjgsNTYgQEAgaW50ZWxfc2V0dXBfbWNoYmFyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpZiAoZW5hYmxlZCkKIAkJcmV0dXJu
OwogCi0JaWYgKGludGVsX2FsbG9jX21jaGJhcl9yZXNvdXJjZShkZXZfcHJpdikpCisJaWYgKGlu
dGVsX2FsbG9jX21jaGJhcl9yZXNvdXJjZShpOTE1KSkKIAkJcmV0dXJuOwogCi0JZGV2X3ByaXYt
Pm1jaGJhcl9uZWVkX2Rpc2FibGUgPSB0cnVlOworCWk5MTUtPm1jaGJhcl9uZWVkX2Rpc2FibGUg
PSB0cnVlOwogCiAJLyogU3BhY2UgaXMgYWxsb2NhdGVkIG9yIHJlc2VydmVkLCBzbyBlbmFibGUg
aXQuICovCi0JaWYgKElTX0k5MTVHKGRldl9wcml2KSB8fCBJU19JOTE1R00oZGV2X3ByaXYpKSB7
Ci0JCXBjaV93cml0ZV9jb25maWdfZHdvcmQoZGV2X3ByaXYtPmJyaWRnZV9kZXYsIERFVkVOLAor
CWlmIChJU19JOTE1RyhpOTE1KSB8fCBJU19JOTE1R00oaTkxNSkpIHsKKwkJcGNpX3dyaXRlX2Nv
bmZpZ19kd29yZChpOTE1LT5icmlkZ2VfZGV2LCBERVZFTiwKIAkJCQkgICAgICAgdGVtcCB8IERF
VkVOX01DSEJBUl9FTik7CiAJfSBlbHNlIHsKLQkJcGNpX3JlYWRfY29uZmlnX2R3b3JkKGRldl9w
cml2LT5icmlkZ2VfZGV2LCBtY2hiYXJfcmVnLCAmdGVtcCk7Ci0JCXBjaV93cml0ZV9jb25maWdf
ZHdvcmQoZGV2X3ByaXYtPmJyaWRnZV9kZXYsIG1jaGJhcl9yZWcsIHRlbXAgfCAxKTsKKwkJcGNp
X3JlYWRfY29uZmlnX2R3b3JkKGk5MTUtPmJyaWRnZV9kZXYsIG1jaGJhcl9yZWcsICZ0ZW1wKTsK
KwkJcGNpX3dyaXRlX2NvbmZpZ19kd29yZChpOTE1LT5icmlkZ2VfZGV2LCBtY2hiYXJfcmVnLCB0
ZW1wIHwgMSk7CiAJfQogfQogCiBzdGF0aWMgdm9pZAotaW50ZWxfdGVhcmRvd25fbWNoYmFyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludGVsX3RlYXJkb3duX21jaGJhcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnQgbWNoYmFyX3JlZyA9IElOVEVM
X0dFTihkZXZfcHJpdikgPj0gNCA/IE1DSEJBUl9JOTY1IDogTUNIQkFSX0k5MTU7CisJaW50IG1j
aGJhcl9yZWcgPSBJTlRFTF9HRU4oaTkxNSkgPj0gNCA/IE1DSEJBUl9JOTY1IDogTUNIQkFSX0k5
MTU7CiAKLQlpZiAoZGV2X3ByaXYtPm1jaGJhcl9uZWVkX2Rpc2FibGUpIHsKLQkJaWYgKElTX0k5
MTVHKGRldl9wcml2KSB8fCBJU19JOTE1R00oZGV2X3ByaXYpKSB7CisJaWYgKGk5MTUtPm1jaGJh
cl9uZWVkX2Rpc2FibGUpIHsKKwkJaWYgKElTX0k5MTVHKGk5MTUpIHx8IElTX0k5MTVHTShpOTE1
KSkgewogCQkJdTMyIGRldmVuX3ZhbDsKIAotCQkJcGNpX3JlYWRfY29uZmlnX2R3b3JkKGRldl9w
cml2LT5icmlkZ2VfZGV2LCBERVZFTiwKKwkJCXBjaV9yZWFkX2NvbmZpZ19kd29yZChpOTE1LT5i
cmlkZ2VfZGV2LCBERVZFTiwKIAkJCQkJICAgICAgJmRldmVuX3ZhbCk7CiAJCQlkZXZlbl92YWwg
Jj0gfkRFVkVOX01DSEJBUl9FTjsKLQkJCXBjaV93cml0ZV9jb25maWdfZHdvcmQoZGV2X3ByaXYt
PmJyaWRnZV9kZXYsIERFVkVOLAorCQkJcGNpX3dyaXRlX2NvbmZpZ19kd29yZChpOTE1LT5icmlk
Z2VfZGV2LCBERVZFTiwKIAkJCQkJICAgICAgIGRldmVuX3ZhbCk7CiAJCX0gZWxzZSB7CiAJCQl1
MzIgbWNoYmFyX3ZhbDsKIAotCQkJcGNpX3JlYWRfY29uZmlnX2R3b3JkKGRldl9wcml2LT5icmlk
Z2VfZGV2LCBtY2hiYXJfcmVnLAorCQkJcGNpX3JlYWRfY29uZmlnX2R3b3JkKGk5MTUtPmJyaWRn
ZV9kZXYsIG1jaGJhcl9yZWcsCiAJCQkJCSAgICAgICZtY2hiYXJfdmFsKTsKIAkJCW1jaGJhcl92
YWwgJj0gfjE7Ci0JCQlwY2lfd3JpdGVfY29uZmlnX2R3b3JkKGRldl9wcml2LT5icmlkZ2VfZGV2
LCBtY2hiYXJfcmVnLAorCQkJcGNpX3dyaXRlX2NvbmZpZ19kd29yZChpOTE1LT5icmlkZ2VfZGV2
LCBtY2hiYXJfcmVnLAogCQkJCQkgICAgICAgbWNoYmFyX3ZhbCk7CiAJCX0KIAl9CiAKLQlpZiAo
ZGV2X3ByaXYtPm1jaF9yZXMuc3RhcnQpCi0JCXJlbGVhc2VfcmVzb3VyY2UoJmRldl9wcml2LT5t
Y2hfcmVzKTsKKwlpZiAoaTkxNS0+bWNoX3Jlcy5zdGFydCkKKwkJcmVsZWFzZV9yZXNvdXJjZSgm
aTkxNS0+bWNoX3Jlcyk7CiB9CiAKIC8qIHRydWUgPSBlbmFibGUgZGVjb2RlLCBmYWxzZSA9IGRp
c2FibGUgZGVjb2RlciAqLwogc3RhdGljIHVuc2lnbmVkIGludCBpOTE1X3ZnYV9zZXRfZGVjb2Rl
KHZvaWQgKmNvb2tpZSwgYm9vbCBzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBjb29raWU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjb29r
aWU7CiAKLQlpbnRlbF9tb2Rlc2V0X3ZnYV9zZXRfc3RhdGUoZGV2X3ByaXYsIHN0YXRlKTsKKwlp
bnRlbF9tb2Rlc2V0X3ZnYV9zZXRfc3RhdGUoaTkxNSwgc3RhdGUpOwogCWlmIChzdGF0ZSkKIAkJ
cmV0dXJuIFZHQV9SU1JDX0xFR0FDWV9JTyB8IFZHQV9SU1JDX0xFR0FDWV9NRU0gfAogCQkgICAg
ICAgVkdBX1JTUkNfTk9STUFMX0lPIHwgVkdBX1JTUkNfTk9STUFMX01FTTsKQEAgLTY2OCwyMSAr
NjY4LDIxIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdmdhX3N3aXRjaGVyb29fY2xpZW50X29wcyBp
OTE1X3N3aXRjaGVyb29fb3BzID0gewogCiBzdGF0aWMgaW50IGk5MTVfbG9hZF9tb2Rlc2V0X2lu
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZfcHJp
di0+ZHJtLnBkZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsKIAlpbnQgcmV0Owog
CiAJaWYgKGk5MTVfaW5qZWN0X2xvYWRfZmFpbHVyZSgpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAot
CWlmIChIQVNfRElTUExBWShkZXZfcHJpdikpIHsKLQkJcmV0ID0gZHJtX3ZibGFua19pbml0KCZk
ZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAgIElOVEVMX0lORk8oZGV2X3ByaXYpLT5udW1fcGlwZXMp
OworCWlmIChIQVNfRElTUExBWShpOTE1KSkgeworCQlyZXQgPSBkcm1fdmJsYW5rX2luaXQoJmk5
MTUtPmRybSwKKwkJCQkgICAgICBJTlRFTF9JTkZPKGk5MTUpLT5udW1fcGlwZXMpOwogCQlpZiAo
cmV0KQogCQkJZ290byBvdXQ7CiAJfQogCi0JaW50ZWxfYmlvc19pbml0KGRldl9wcml2KTsKKwlp
bnRlbF9iaW9zX2luaXQoaTkxNSk7CiAKIAkvKiBJZiB3ZSBoYXZlID4gMSBWR0EgY2FyZHMsIHRo
ZW4gd2UgbmVlZCB0byBhcmJpdHJhdGUgYWNjZXNzCiAJICogdG8gdGhlIGNvbW1vbiBWR0EgcmVz
b3VyY2VzLgpAQCAtNjkxLDcgKzY5MSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9sb2FkX21vZGVzZXRf
aW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCSAqIHRoZW4gd2UgZG8gbm90IHRha2UgcGFy
dCBpbiBWR0EgYXJiaXRyYXRpb24gYW5kIHRoZQogCSAqIHZnYV9jbGllbnRfcmVnaXN0ZXIoKSBm
YWlscyB3aXRoIC1FTk9ERVYuCiAJICovCi0JcmV0ID0gdmdhX2NsaWVudF9yZWdpc3RlcihwZGV2
LCBkZXZfcHJpdiwgTlVMTCwgaTkxNV92Z2Ffc2V0X2RlY29kZSk7CisJcmV0ID0gdmdhX2NsaWVu
dF9yZWdpc3RlcihwZGV2LCBpOTE1LCBOVUxMLCBpOTE1X3ZnYV9zZXRfZGVjb2RlKTsKIAlpZiAo
cmV0ICYmIHJldCAhPSAtRU5PREVWKQogCQlnb3RvIG91dDsKIApAQCAtNzAyLDE3ICs3MDIsMTcg
QEAgc3RhdGljIGludCBpOTE1X2xvYWRfbW9kZXNldF9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpCiAJCWdvdG8gY2xlYW51cF92Z2FfY2xpZW50OwogCiAJLyogbXVzdCBoYXBwZW4gYmVmb3Jl
IGludGVsX3Bvd2VyX2RvbWFpbnNfaW5pdF9odygpIG9uIFZMVi9DSFYgKi8KLQlpbnRlbF91cGRh
dGVfcmF3Y2xrKGRldl9wcml2KTsKKwlpbnRlbF91cGRhdGVfcmF3Y2xrKGk5MTUpOwogCi0JaW50
ZWxfcG93ZXJfZG9tYWluc19pbml0X2h3KGRldl9wcml2LCBmYWxzZSk7CisJaW50ZWxfcG93ZXJf
ZG9tYWluc19pbml0X2h3KGk5MTUsIGZhbHNlKTsKIAotCWludGVsX2Nzcl91Y29kZV9pbml0KGRl
dl9wcml2KTsKKwlpbnRlbF9jc3JfdWNvZGVfaW5pdChpOTE1KTsKIAotCXJldCA9IGludGVsX2ly
cV9pbnN0YWxsKGRldl9wcml2KTsKKwlyZXQgPSBpbnRlbF9pcnFfaW5zdGFsbChpOTE1KTsKIAlp
ZiAocmV0KQogCQlnb3RvIGNsZWFudXBfY3NyOwogCi0JaW50ZWxfZ21idXNfc2V0dXAoZGV2X3By
aXYpOworCWludGVsX2dtYnVzX3NldHVwKGk5MTUpOwogCiAJLyogSW1wb3J0YW50OiBUaGUgb3V0
cHV0IHNldHVwIGZ1bmN0aW9ucyBjYWxsZWQgYnkgbW9kZXNldF9pbml0IG5lZWQKIAkgKiB3b3Jr
aW5nIGlycXMgZm9yIGUuZy4gZ21idXMgYW5kIGRwIGF1eCB0cmFuc2ZlcnMuICovCkBAIC03MjAs
MTMgKzcyMCwxMyBAQCBzdGF0aWMgaW50IGk5MTVfbG9hZF9tb2Rlc2V0X2luaXQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldikKIAlpZiAocmV0KQogCQlnb3RvIGNsZWFudXBfaXJxOwogCi0JcmV0ID0g
aTkxNV9nZW1faW5pdChkZXZfcHJpdik7CisJcmV0ID0gaTkxNV9nZW1faW5pdChpOTE1KTsKIAlp
ZiAocmV0KQogCQlnb3RvIGNsZWFudXBfbW9kZXNldDsKIAotCWludGVsX292ZXJsYXlfc2V0dXAo
ZGV2X3ByaXYpOworCWludGVsX292ZXJsYXlfc2V0dXAoaTkxNSk7CiAKLQlpZiAoIUhBU19ESVNQ
TEFZKGRldl9wcml2KSkKKwlpZiAoIUhBU19ESVNQTEFZKGk5MTUpKQogCQlyZXR1cm4gMDsKIAog
CXJldCA9IGludGVsX2ZiZGV2X2luaXQoZGV2KTsKQEAgLTczNCwyNCArNzM0LDI0IEBAIHN0YXRp
YyBpbnQgaTkxNV9sb2FkX21vZGVzZXRfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQln
b3RvIGNsZWFudXBfZ2VtOwogCiAJLyogT25seSBlbmFibGUgaG90cGx1ZyBoYW5kbGluZyBvbmNl
IHRoZSBmYmRldiBpcyBmdWxseSBzZXQgdXAuICovCi0JaW50ZWxfaHBkX2luaXQoZGV2X3ByaXYp
OworCWludGVsX2hwZF9pbml0KGk5MTUpOwogCi0JaW50ZWxfaW5pdF9pcGMoZGV2X3ByaXYpOwor
CWludGVsX2luaXRfaXBjKGk5MTUpOwogCiAJcmV0dXJuIDA7CiAKIGNsZWFudXBfZ2VtOgotCWk5
MTVfZ2VtX3N1c3BlbmQoZGV2X3ByaXYpOwotCWk5MTVfZ2VtX2ZpbmlfaHcoZGV2X3ByaXYpOwot
CWk5MTVfZ2VtX2ZpbmkoZGV2X3ByaXYpOworCWk5MTVfZ2VtX3N1c3BlbmQoaTkxNSk7CisJaTkx
NV9nZW1fZmluaV9odyhpOTE1KTsKKwlpOTE1X2dlbV9maW5pKGk5MTUpOwogY2xlYW51cF9tb2Rl
c2V0OgogCWludGVsX21vZGVzZXRfY2xlYW51cChkZXYpOwogY2xlYW51cF9pcnE6CiAJZHJtX2ly
cV91bmluc3RhbGwoZGV2KTsKLQlpbnRlbF9nbWJ1c190ZWFyZG93bihkZXZfcHJpdik7CisJaW50
ZWxfZ21idXNfdGVhcmRvd24oaTkxNSk7CiBjbGVhbnVwX2NzcjoKLQlpbnRlbF9jc3JfdWNvZGVf
ZmluaShkZXZfcHJpdik7Ci0JaW50ZWxfcG93ZXJfZG9tYWluc19maW5pX2h3KGRldl9wcml2KTsK
KwlpbnRlbF9jc3JfdWNvZGVfZmluaShpOTE1KTsKKwlpbnRlbF9wb3dlcl9kb21haW5zX2Zpbmlf
aHcoaTkxNSk7CiAJdmdhX3N3aXRjaGVyb29fdW5yZWdpc3Rlcl9jbGllbnQocGRldik7CiBjbGVh
bnVwX3ZnYV9jbGllbnQ6CiAJdmdhX2NsaWVudF9yZWdpc3RlcihwZGV2LCBOVUxMLCBOVUxMLCBO
VUxMKTsKQEAgLTc1OSwxMSArNzU5LDExIEBAIHN0YXRpYyBpbnQgaTkxNV9sb2FkX21vZGVzZXRf
aW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBp
bnQgaTkxNV9raWNrX291dF9maXJtd2FyZV9mYihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitzdGF0aWMgaW50IGk5MTVfa2lja19vdXRfZmlybXdhcmVfZmIoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGFwZXJ0dXJlc19zdHJ1Y3QgKmFwOwotCXN0
cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OwotCXN0cnVjdCBpOTE1X2dn
dHQgKmdndHQgPSAmZGV2X3ByaXYtPmdndHQ7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1
LT5kcm0ucGRldjsKKwlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmk5MTUtPmdndHQ7CiAJYm9v
bCBwcmltYXJ5OwogCWludCByZXQ7CiAKQEAgLTc4NCwyMiArNzg0LDIyIEBAIHN0YXRpYyBpbnQg
aTkxNV9raWNrX291dF9maXJtd2FyZV9mYihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfaW5pdF9kcGlvKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2luaXRfZHBp
byhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAkvKgogCSAqIElPU0ZfUE9SVF9E
UElPIGlzIHVzZWQgZm9yIFZMViB4MiBQSFkgKERQL0hETUkgQiBhbmQgQyksCiAJICogQ0hWIHgx
IFBIWSAoRFAvSERNSSBEKQogCSAqIElPU0ZfUE9SVF9EUElPXzIgaXMgdXNlZCBmb3IgQ0hWIHgy
IFBIWSAoRFAvSERNSSBCIGFuZCBDKQogCSAqLwotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2
KSkgeworCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKSB7CiAJCURQSU9fUEhZX0lPU0ZfUE9SVChE
UElPX1BIWTApID0gSU9TRl9QT1JUX0RQSU9fMjsKIAkJRFBJT19QSFlfSU9TRl9QT1JUKERQSU9f
UEhZMSkgPSBJT1NGX1BPUlRfRFBJTzsKLQl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3By
aXYpKSB7CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpKSB7CiAJCURQSU9fUEhZX0lP
U0ZfUE9SVChEUElPX1BIWTApID0gSU9TRl9QT1JUX0RQSU87CiAJfQogfQogCi1zdGF0aWMgaW50
IGk5MTVfd29ya3F1ZXVlc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3N0YXRpYyBpbnQgaTkxNV93b3JrcXVldWVzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJLyoKIAkgKiBUaGUgaTkxNSB3b3JrcXVldWUgaXMgcHJpbWFyaWx5IHVzZWQg
Zm9yIGJhdGNoZWQgcmV0aXJlbWVudCBvZgpAQCAtODE1LDE4ICs4MTUsMTggQEAgc3RhdGljIGlu
dCBpOTE1X3dvcmtxdWV1ZXNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJICogc28gdGhlcmUgaXMgbm8gcG9pbnQgaW4gcnVubmluZyBtb3JlIHRoYW4gb25lIGluc3Rh
bmNlIG9mIHRoZQogCSAqIHdvcmtxdWV1ZSBhdCBhbnkgdGltZS4gIFVzZSBhbiBvcmRlcmVkIG9u
ZS4KIAkgKi8KLQlkZXZfcHJpdi0+d3EgPSBhbGxvY19vcmRlcmVkX3dvcmtxdWV1ZSgiaTkxNSIs
IDApOwotCWlmIChkZXZfcHJpdi0+d3EgPT0gTlVMTCkKKwlpOTE1LT53cSA9IGFsbG9jX29yZGVy
ZWRfd29ya3F1ZXVlKCJpOTE1IiwgMCk7CisJaWYgKGk5MTUtPndxID09IE5VTEwpCiAJCWdvdG8g
b3V0X2VycjsKIAotCWRldl9wcml2LT5ob3RwbHVnLmRwX3dxID0gYWxsb2Nfb3JkZXJlZF93b3Jr
cXVldWUoImk5MTUtZHAiLCAwKTsKLQlpZiAoZGV2X3ByaXYtPmhvdHBsdWcuZHBfd3EgPT0gTlVM
TCkKKwlpOTE1LT5ob3RwbHVnLmRwX3dxID0gYWxsb2Nfb3JkZXJlZF93b3JrcXVldWUoImk5MTUt
ZHAiLCAwKTsKKwlpZiAoaTkxNS0+aG90cGx1Zy5kcF93cSA9PSBOVUxMKQogCQlnb3RvIG91dF9m
cmVlX3dxOwogCiAJcmV0dXJuIDA7CiAKIG91dF9mcmVlX3dxOgotCWRlc3Ryb3lfd29ya3F1ZXVl
KGRldl9wcml2LT53cSk7CisJZGVzdHJveV93b3JrcXVldWUoaTkxNS0+d3EpOwogb3V0X2VycjoK
IAlEUk1fRVJST1IoIkZhaWxlZCB0byBhbGxvY2F0ZSB3b3JrcXVldWVzLlxuIik7CiAKQEAgLTg0
MiwxMCArODQyLDEwIEBAIHN0YXRpYyB2b2lkIGk5MTVfZW5naW5lc19jbGVhbnVwKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCQlrZnJlZShlbmdpbmUpOwogfQogCi1zdGF0aWMgdm9p
ZCBpOTE1X3dvcmtxdWV1ZXNfY2xlYW51cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdm9pZCBpOTE1X3dvcmtxdWV1ZXNfY2xlYW51cChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKLQlkZXN0cm95X3dvcmtxdWV1ZShkZXZfcHJpdi0+aG90cGx1Zy5k
cF93cSk7Ci0JZGVzdHJveV93b3JrcXVldWUoZGV2X3ByaXYtPndxKTsKKwlkZXN0cm95X3dvcmtx
dWV1ZShpOTE1LT5ob3RwbHVnLmRwX3dxKTsKKwlkZXN0cm95X3dvcmtxdWV1ZShpOTE1LT53cSk7
CiB9CiAKIC8qCkBAIC04NTgsMTQgKzg1OCwxNCBAQCBzdGF0aWMgdm9pZCBpOTE1X3dvcmtxdWV1
ZXNfY2xlYW51cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKiAod29ya2Fy
b3VuZHMgaGF2ZSBhIGhhYml0IG9mIHBlcnNpc3RpbmchKS4gQW55dGhpbmcgb2xkZXIgdGhhbiB0
aGF0CiAgKiBzaG91bGQgYmUgcmVtb3ZlZCBhbG9uZyB3aXRoIHRoZSBjb21wbGljYXRpb25zIHRo
ZXkgaW50cm9kdWNlLgogICovCi1zdGF0aWMgdm9pZCBpbnRlbF9kZXRlY3RfcHJlcHJvZHVjdGlv
bl9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbnRl
bF9kZXRlY3RfcHJlcHJvZHVjdGlvbl9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAlib29sIHByZSA9IGZhbHNlOwogCi0JcHJlIHw9IElTX0hTV19FQVJMWV9TRFYoZGV2X3By
aXYpOwotCXByZSB8PSBJU19TS0xfUkVWSUQoZGV2X3ByaXYsIDAsIFNLTF9SRVZJRF9GMCk7Ci0J
cHJlIHw9IElTX0JYVF9SRVZJRChkZXZfcHJpdiwgMCwgQlhUX1JFVklEX0JfTEFTVCk7Ci0JcHJl
IHw9IElTX0tCTF9SRVZJRChkZXZfcHJpdiwgMCwgS0JMX1JFVklEX0EwKTsKKwlwcmUgfD0gSVNf
SFNXX0VBUkxZX1NEVihpOTE1KTsKKwlwcmUgfD0gSVNfU0tMX1JFVklEKGk5MTUsIDAsIFNLTF9S
RVZJRF9GMCk7CisJcHJlIHw9IElTX0JYVF9SRVZJRChpOTE1LCAwLCBCWFRfUkVWSURfQl9MQVNU
KTsKKwlwcmUgfD0gSVNfS0JMX1JFVklEKGk5MTUsIDAsIEtCTF9SRVZJRF9BMCk7CiAKIAlpZiAo
cHJlKSB7CiAJCURSTV9FUlJPUigiVGhpcyBpcyBhIHByZS1wcm9kdWN0aW9uIHN0ZXBwaW5nLiAi
CkBAIC04NzYsNyArODc2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGV0ZWN0X3ByZXByb2R1Y3Rp
b25faHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAvKioKICAqIGk5MTVf
ZHJpdmVyX2luaXRfZWFybHkgLSBzZXR1cCBzdGF0ZSBub3QgcmVxdWlyaW5nIGRldmljZSBhY2Nl
c3MKLSAqIEBkZXZfcHJpdjogZGV2aWNlIHByaXZhdGUKKyAqIEBpOTE1OiBkZXZpY2UgcHJpdmF0
ZQogICoKICAqIEluaXRpYWxpemUgZXZlcnl0aGluZyB0aGF0IGlzIGEgIlNXLW9ubHkiIHN0YXRl
LCB0aGF0IGlzIHN0YXRlIG5vdAogICogcmVxdWlyaW5nIGFjY2Vzc2luZyB0aGUgZGV2aWNlIG9y
IGV4cG9zaW5nIHRoZSBkcml2ZXIgdmlhIGtlcm5lbCBpbnRlcm5hbApAQCAtODg0LDE1MiArODg0
LDE1MiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZXRlY3RfcHJlcHJvZHVjdGlvbl9odyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKiBzeXN0ZW0gbWVtb3J5IGFsbG9jYXRpb24s
IHNldHRpbmcgdXAgZGV2aWNlIHNwZWNpZmljIGF0dHJpYnV0ZXMgYW5kCiAgKiBmdW5jdGlvbiBo
b29rcyBub3QgcmVxdWlyaW5nIGFjY2Vzc2luZyB0aGUgZGV2aWNlLgogICovCi1zdGF0aWMgaW50
IGk5MTVfZHJpdmVyX2luaXRfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIGludCBpOTE1X2RyaXZlcl9pbml0X2Vhcmx5KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCWludCByZXQgPSAwOwogCiAJaWYgKGk5MTVfaW5qZWN0X2xvYWRfZmFp
bHVyZSgpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCWludGVsX2RldmljZV9pbmZvX3N1YnBsYXRm
b3JtX2luaXQoZGV2X3ByaXYpOworCWludGVsX2RldmljZV9pbmZvX3N1YnBsYXRmb3JtX2luaXQo
aTkxNSk7CiAKLQlpbnRlbF91bmNvcmVfaW5pdF9lYXJseSgmZGV2X3ByaXYtPnVuY29yZSk7CisJ
aW50ZWxfdW5jb3JlX2luaXRfZWFybHkoJmk5MTUtPnVuY29yZSk7CiAKLQlzcGluX2xvY2tfaW5p
dCgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlzcGluX2xvY2tfaW5pdCgmZGV2X3ByaXYtPmdwdV9l
cnJvci5sb2NrKTsKLQltdXRleF9pbml0KCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOworCXNw
aW5fbG9ja19pbml0KCZpOTE1LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2luaXQoJmk5MTUtPmdw
dV9lcnJvci5sb2NrKTsKKwltdXRleF9pbml0KCZpOTE1LT5iYWNrbGlnaHRfbG9jayk7CiAKLQlt
dXRleF9pbml0KCZkZXZfcHJpdi0+c2JfbG9jayk7Ci0JcG1fcW9zX2FkZF9yZXF1ZXN0KCZkZXZf
cHJpdi0+c2JfcW9zLAorCW11dGV4X2luaXQoJmk5MTUtPnNiX2xvY2spOworCXBtX3Fvc19hZGRf
cmVxdWVzdCgmaTkxNS0+c2JfcW9zLAogCQkJICAgUE1fUU9TX0NQVV9ETUFfTEFURU5DWSwgUE1f
UU9TX0RFRkFVTFRfVkFMVUUpOwogCi0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPmF2X211dGV4KTsK
LQltdXRleF9pbml0KCZkZXZfcHJpdi0+d20ud21fbXV0ZXgpOwotCW11dGV4X2luaXQoJmRldl9w
cml2LT5wcHNfbXV0ZXgpOwotCW11dGV4X2luaXQoJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgp
OworCW11dGV4X2luaXQoJmk5MTUtPmF2X211dGV4KTsKKwltdXRleF9pbml0KCZpOTE1LT53bS53
bV9tdXRleCk7CisJbXV0ZXhfaW5pdCgmaTkxNS0+cHBzX211dGV4KTsKKwltdXRleF9pbml0KCZp
OTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCi0JaTkxNV9tZW1jcHlfaW5pdF9lYXJseShkZXZfcHJp
dik7Ci0JaW50ZWxfcnVudGltZV9wbV9pbml0X2Vhcmx5KGRldl9wcml2KTsKKwlpOTE1X21lbWNw
eV9pbml0X2Vhcmx5KGk5MTUpOworCWludGVsX3J1bnRpbWVfcG1faW5pdF9lYXJseShpOTE1KTsK
IAotCXJldCA9IGk5MTVfd29ya3F1ZXVlc19pbml0KGRldl9wcml2KTsKKwlyZXQgPSBpOTE1X3dv
cmtxdWV1ZXNfaW5pdChpOTE1KTsKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfZW5naW5lczsK
IAotCXJldCA9IGk5MTVfZ2VtX2luaXRfZWFybHkoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfZ2Vt
X2luaXRfZWFybHkoaTkxNSk7CiAJaWYgKHJldCA8IDApCiAJCWdvdG8gZXJyX3dvcmtxdWV1ZXM7
CiAKIAkvKiBUaGlzIG11c3QgYmUgY2FsbGVkIGJlZm9yZSBhbnkgY2FsbHMgdG8gSEFTX1BDSF8q
ICovCi0JaW50ZWxfZGV0ZWN0X3BjaChkZXZfcHJpdik7CisJaW50ZWxfZGV0ZWN0X3BjaChpOTE1
KTsKIAotCWludGVsX3dvcGNtX2luaXRfZWFybHkoJmRldl9wcml2LT53b3BjbSk7Ci0JaW50ZWxf
dWNfaW5pdF9lYXJseShkZXZfcHJpdik7Ci0JaW50ZWxfcG1fc2V0dXAoZGV2X3ByaXYpOwotCWlu
dGVsX2luaXRfZHBpbyhkZXZfcHJpdik7Ci0JcmV0ID0gaW50ZWxfcG93ZXJfZG9tYWluc19pbml0
KGRldl9wcml2KTsKKwlpbnRlbF93b3BjbV9pbml0X2Vhcmx5KCZpOTE1LT53b3BjbSk7CisJaW50
ZWxfdWNfaW5pdF9lYXJseShpOTE1KTsKKwlpbnRlbF9wbV9zZXR1cChpOTE1KTsKKwlpbnRlbF9p
bml0X2RwaW8oaTkxNSk7CisJcmV0ID0gaW50ZWxfcG93ZXJfZG9tYWluc19pbml0KGk5MTUpOwog
CWlmIChyZXQgPCAwKQogCQlnb3RvIGVycl91YzsKLQlpbnRlbF9pcnFfaW5pdChkZXZfcHJpdik7
Ci0JaW50ZWxfaGFuZ2NoZWNrX2luaXQoZGV2X3ByaXYpOwotCWludGVsX2luaXRfZGlzcGxheV9o
b29rcyhkZXZfcHJpdik7Ci0JaW50ZWxfaW5pdF9jbG9ja19nYXRpbmdfaG9va3MoZGV2X3ByaXYp
OwotCWludGVsX2luaXRfYXVkaW9faG9va3MoZGV2X3ByaXYpOwotCWludGVsX2Rpc3BsYXlfY3Jj
X2luaXQoZGV2X3ByaXYpOworCWludGVsX2lycV9pbml0KGk5MTUpOworCWludGVsX2hhbmdjaGVj
a19pbml0KGk5MTUpOworCWludGVsX2luaXRfZGlzcGxheV9ob29rcyhpOTE1KTsKKwlpbnRlbF9p
bml0X2Nsb2NrX2dhdGluZ19ob29rcyhpOTE1KTsKKwlpbnRlbF9pbml0X2F1ZGlvX2hvb2tzKGk5
MTUpOworCWludGVsX2Rpc3BsYXlfY3JjX2luaXQoaTkxNSk7CiAKLQlpbnRlbF9kZXRlY3RfcHJl
cHJvZHVjdGlvbl9odyhkZXZfcHJpdik7CisJaW50ZWxfZGV0ZWN0X3ByZXByb2R1Y3Rpb25faHco
aTkxNSk7CiAKIAlyZXR1cm4gMDsKIAogZXJyX3VjOgotCWludGVsX3VjX2NsZWFudXBfZWFybHko
ZGV2X3ByaXYpOwotCWk5MTVfZ2VtX2NsZWFudXBfZWFybHkoZGV2X3ByaXYpOworCWludGVsX3Vj
X2NsZWFudXBfZWFybHkoaTkxNSk7CisJaTkxNV9nZW1fY2xlYW51cF9lYXJseShpOTE1KTsKIGVy
cl93b3JrcXVldWVzOgotCWk5MTVfd29ya3F1ZXVlc19jbGVhbnVwKGRldl9wcml2KTsKKwlpOTE1
X3dvcmtxdWV1ZXNfY2xlYW51cChpOTE1KTsKIGVycl9lbmdpbmVzOgotCWk5MTVfZW5naW5lc19j
bGVhbnVwKGRldl9wcml2KTsKKwlpOTE1X2VuZ2luZXNfY2xlYW51cChpOTE1KTsKIAlyZXR1cm4g
cmV0OwogfQogCiAvKioKICAqIGk5MTVfZHJpdmVyX2NsZWFudXBfZWFybHkgLSBjbGVhbnVwIHRo
ZSBzZXR1cCBkb25lIGluIGk5MTVfZHJpdmVyX2luaXRfZWFybHkoKQotICogQGRldl9wcml2OiBk
ZXZpY2UgcHJpdmF0ZQorICogQGk5MTU6IGRldmljZSBwcml2YXRlCiAgKi8KLXN0YXRpYyB2b2lk
IGk5MTVfZHJpdmVyX2NsZWFudXBfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfY2xlYW51cF9lYXJseShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnRlbF9pcnFfZmluaShkZXZfcHJpdik7Ci0JaW50ZWxf
cG93ZXJfZG9tYWluc19jbGVhbnVwKGRldl9wcml2KTsKLQlpbnRlbF91Y19jbGVhbnVwX2Vhcmx5
KGRldl9wcml2KTsKLQlpOTE1X2dlbV9jbGVhbnVwX2Vhcmx5KGRldl9wcml2KTsKLQlpOTE1X3dv
cmtxdWV1ZXNfY2xlYW51cChkZXZfcHJpdik7Ci0JaTkxNV9lbmdpbmVzX2NsZWFudXAoZGV2X3By
aXYpOworCWludGVsX2lycV9maW5pKGk5MTUpOworCWludGVsX3Bvd2VyX2RvbWFpbnNfY2xlYW51
cChpOTE1KTsKKwlpbnRlbF91Y19jbGVhbnVwX2Vhcmx5KGk5MTUpOworCWk5MTVfZ2VtX2NsZWFu
dXBfZWFybHkoaTkxNSk7CisJaTkxNV93b3JrcXVldWVzX2NsZWFudXAoaTkxNSk7CisJaTkxNV9l
bmdpbmVzX2NsZWFudXAoaTkxNSk7CiAKLQlwbV9xb3NfcmVtb3ZlX3JlcXVlc3QoJmRldl9wcml2
LT5zYl9xb3MpOwotCW11dGV4X2Rlc3Ryb3koJmRldl9wcml2LT5zYl9sb2NrKTsKKwlwbV9xb3Nf
cmVtb3ZlX3JlcXVlc3QoJmk5MTUtPnNiX3Fvcyk7CisJbXV0ZXhfZGVzdHJveSgmaTkxNS0+c2Jf
bG9jayk7CiB9CiAKIC8qKgogICogaTkxNV9kcml2ZXJfaW5pdF9tbWlvIC0gc2V0dXAgZGV2aWNl
IE1NSU8KLSAqIEBkZXZfcHJpdjogZGV2aWNlIHByaXZhdGUKKyAqIEBpOTE1OiBkZXZpY2UgcHJp
dmF0ZQogICoKICAqIFNldHVwIG1pbmltYWwgZGV2aWNlIHN0YXRlIG5lY2Vzc2FyeSBmb3IgTU1J
TyBhY2Nlc3NlcyBsYXRlciBpbiB0aGUKICAqIGluaXRpYWxpemF0aW9uIHNlcXVlbmNlLiBUaGUg
c2V0dXAgaGVyZSBzaG91bGQgYXZvaWQgYW55IG90aGVyIGRldmljZS13aWRlCiAgKiBzaWRlIGVm
ZmVjdHMgb3IgZXhwb3NpbmcgdGhlIGRyaXZlciB2aWEga2VybmVsIGludGVybmFsIG9yIHVzZXIg
c3BhY2UKICAqIGludGVyZmFjZXMuCiAgKi8KLXN0YXRpYyBpbnQgaTkxNV9kcml2ZXJfaW5pdF9t
bWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbnQgaTkxNV9k
cml2ZXJfaW5pdF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWludCBy
ZXQ7CiAKIAlpZiAoaTkxNV9pbmplY3RfbG9hZF9mYWlsdXJlKCkpCiAJCXJldHVybiAtRU5PREVW
OwogCi0JaWYgKGk5MTVfZ2V0X2JyaWRnZV9kZXYoZGV2X3ByaXYpKQorCWlmIChpOTE1X2dldF9i
cmlkZ2VfZGV2KGk5MTUpKQogCQlyZXR1cm4gLUVJTzsKIAotCXJldCA9IGludGVsX3VuY29yZV9p
bml0X21taW8oJmRldl9wcml2LT51bmNvcmUpOworCXJldCA9IGludGVsX3VuY29yZV9pbml0X21t
aW8oJmk5MTUtPnVuY29yZSk7CiAJaWYgKHJldCA8IDApCiAJCWdvdG8gZXJyX2JyaWRnZTsKIAog
CS8qIFRyeSB0byBtYWtlIHN1cmUgTUNIQkFSIGlzIGVuYWJsZWQgYmVmb3JlIHBva2luZyBhdCBp
dCAqLwotCWludGVsX3NldHVwX21jaGJhcihkZXZfcHJpdik7CisJaW50ZWxfc2V0dXBfbWNoYmFy
KGk5MTUpOwogCi0JaW50ZWxfZGV2aWNlX2luZm9faW5pdF9tbWlvKGRldl9wcml2KTsKKwlpbnRl
bF9kZXZpY2VfaW5mb19pbml0X21taW8oaTkxNSk7CiAKLQlpbnRlbF91bmNvcmVfcHJ1bmVfbW1p
b19kb21haW5zKCZkZXZfcHJpdi0+dW5jb3JlKTsKKwlpbnRlbF91bmNvcmVfcHJ1bmVfbW1pb19k
b21haW5zKCZpOTE1LT51bmNvcmUpOwogCi0JaW50ZWxfdWNfaW5pdF9tbWlvKGRldl9wcml2KTsK
KwlpbnRlbF91Y19pbml0X21taW8oaTkxNSk7CiAKLQlyZXQgPSBpbnRlbF9lbmdpbmVzX2luaXRf
bW1pbyhkZXZfcHJpdik7CisJcmV0ID0gaW50ZWxfZW5naW5lc19pbml0X21taW8oaTkxNSk7CiAJ
aWYgKHJldCkKIAkJZ290byBlcnJfdW5jb3JlOwogCi0JaTkxNV9nZW1faW5pdF9tbWlvKGRldl9w
cml2KTsKKwlpOTE1X2dlbV9pbml0X21taW8oaTkxNSk7CiAKIAlyZXR1cm4gMDsKIAogZXJyX3Vu
Y29yZToKLQlpbnRlbF90ZWFyZG93bl9tY2hiYXIoZGV2X3ByaXYpOwotCWludGVsX3VuY29yZV9m
aW5pX21taW8oJmRldl9wcml2LT51bmNvcmUpOworCWludGVsX3RlYXJkb3duX21jaGJhcihpOTE1
KTsKKwlpbnRlbF91bmNvcmVfZmluaV9tbWlvKCZpOTE1LT51bmNvcmUpOwogZXJyX2JyaWRnZToK
LQlwY2lfZGV2X3B1dChkZXZfcHJpdi0+YnJpZGdlX2Rldik7CisJcGNpX2Rldl9wdXQoaTkxNS0+
YnJpZGdlX2Rldik7CiAKIAlyZXR1cm4gcmV0OwogfQogCiAvKioKICAqIGk5MTVfZHJpdmVyX2Ns
ZWFudXBfbW1pbyAtIGNsZWFudXAgdGhlIHNldHVwIGRvbmUgaW4gaTkxNV9kcml2ZXJfaW5pdF9t
bWlvKCkKLSAqIEBkZXZfcHJpdjogZGV2aWNlIHByaXZhdGUKKyAqIEBpOTE1OiBkZXZpY2UgcHJp
dmF0ZQogICovCi1zdGF0aWMgdm9pZCBpOTE1X2RyaXZlcl9jbGVhbnVwX21taW8oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfY2xlYW51
cF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWludGVsX3RlYXJkb3du
X21jaGJhcihkZXZfcHJpdik7Ci0JaW50ZWxfdW5jb3JlX2ZpbmlfbW1pbygmZGV2X3ByaXYtPnVu
Y29yZSk7Ci0JcGNpX2Rldl9wdXQoZGV2X3ByaXYtPmJyaWRnZV9kZXYpOworCWludGVsX3RlYXJk
b3duX21jaGJhcihpOTE1KTsKKwlpbnRlbF91bmNvcmVfZmluaV9tbWlvKCZpOTE1LT51bmNvcmUp
OworCXBjaV9kZXZfcHV0KGk5MTUtPmJyaWRnZV9kZXYpOwogfQogCi1zdGF0aWMgdm9pZCBpbnRl
bF9zYW5pdGl6ZV9vcHRpb25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0
YXRpYyB2b2lkIGludGVsX3Nhbml0aXplX29wdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7Ci0JaW50ZWxfZ3Z0X3Nhbml0aXplX29wdGlvbnMoZGV2X3ByaXYpOworCWludGVs
X2d2dF9zYW5pdGl6ZV9vcHRpb25zKGk5MTUpOwogfQogCiAjZGVmaW5lIERSQU1fVFlQRV9TVFIo
dHlwZSkgW0lOVEVMX0RSQU1fICMjIHR5cGVdID0gI3R5cGUKQEAgLTExMzEsMTEgKzExMzEsMTEg
QEAgc2tsX2lzXzE2Z2JfZGltbShjb25zdCBzdHJ1Y3QgZHJhbV9kaW1tX2luZm8gKmRpbW0pCiB9
CiAKIHN0YXRpYyB2b2lkCi1za2xfZHJhbV9nZXRfZGltbV9pbmZvKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3NrbF9kcmFtX2dldF9kaW1tX2luZm8oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAgICBzdHJ1Y3QgZHJhbV9kaW1tX2luZm8gKmRpbW0sCiAJ
CSAgICAgICBpbnQgY2hhbm5lbCwgY2hhciBkaW1tX25hbWUsIHUxNiB2YWwpCiB7Ci0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTApIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDEwKSB7
CiAJCWRpbW0tPnNpemUgPSBjbmxfZ2V0X2RpbW1fc2l6ZSh2YWwpOwogCQlkaW1tLT53aWR0aCA9
IGNubF9nZXRfZGltbV93aWR0aCh2YWwpOwogCQlkaW1tLT5yYW5rcyA9IGNubF9nZXRfZGltbV9y
YW5rcyh2YWwpOwpAQCAtMTE1MSwxMyArMTE1MSwxMyBAQCBza2xfZHJhbV9nZXRfZGltbV9pbmZv
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogc3RhdGljIGludAotc2ts
X2RyYW1fZ2V0X2NoYW5uZWxfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Citza2xfZHJhbV9nZXRfY2hhbm5lbF9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICBzdHJ1Y3QgZHJhbV9jaGFubmVsX2luZm8gKmNoLAogCQkJICBpbnQgY2hhbm5lbCwg
dTMyIHZhbCkKIHsKLQlza2xfZHJhbV9nZXRfZGltbV9pbmZvKGRldl9wcml2LCAmY2gtPmRpbW1f
bCwKKwlza2xfZHJhbV9nZXRfZGltbV9pbmZvKGk5MTUsICZjaC0+ZGltbV9sLAogCQkJICAgICAg
IGNoYW5uZWwsICdMJywgdmFsICYgMHhmZmZmKTsKLQlza2xfZHJhbV9nZXRfZGltbV9pbmZvKGRl
dl9wcml2LCAmY2gtPmRpbW1fcywKKwlza2xfZHJhbV9nZXRfZGltbV9pbmZvKGk5MTUsICZjaC0+
ZGltbV9zLAogCQkJICAgICAgIGNoYW5uZWwsICdTJywgdmFsID4+IDE2KTsKIAogCWlmIChjaC0+
ZGltbV9sLnNpemUgPT0gMCAmJiBjaC0+ZGltbV9zLnNpemUgPT0gMCkgewpAQCAtMTE5MiwyMCAr
MTE5MiwyMCBAQCBpbnRlbF9pc19kcmFtX3N5bW1ldHJpYyhjb25zdCBzdHJ1Y3QgZHJhbV9jaGFu
bmVsX2luZm8gKmNoMCwKIH0KIAogc3RhdGljIGludAotc2tsX2RyYW1fZ2V0X2NoYW5uZWxzX2lu
Zm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc2tsX2RyYW1fZ2V0X2NoYW5u
ZWxzX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGRyYW1f
aW5mbyAqZHJhbV9pbmZvID0gJmRldl9wcml2LT5kcmFtX2luZm87CisJc3RydWN0IGRyYW1faW5m
byAqZHJhbV9pbmZvID0gJmk5MTUtPmRyYW1faW5mbzsKIAlzdHJ1Y3QgZHJhbV9jaGFubmVsX2lu
Zm8gY2gwID0ge30sIGNoMSA9IHt9OwogCXUzMiB2YWw7CiAJaW50IHJldDsKIAogCXZhbCA9IEk5
MTVfUkVBRChTS0xfTUFEX0RJTU1fQ0gwXzBfMF8wX01DSEJBUl9NQ01BSU4pOwotCXJldCA9IHNr
bF9kcmFtX2dldF9jaGFubmVsX2luZm8oZGV2X3ByaXYsICZjaDAsIDAsIHZhbCk7CisJcmV0ID0g
c2tsX2RyYW1fZ2V0X2NoYW5uZWxfaW5mbyhpOTE1LCAmY2gwLCAwLCB2YWwpOwogCWlmIChyZXQg
PT0gMCkKIAkJZHJhbV9pbmZvLT5udW1fY2hhbm5lbHMrKzsKIAogCXZhbCA9IEk5MTVfUkVBRChT
S0xfTUFEX0RJTU1fQ0gxXzBfMF8wX01DSEJBUl9NQ01BSU4pOwotCXJldCA9IHNrbF9kcmFtX2dl
dF9jaGFubmVsX2luZm8oZGV2X3ByaXYsICZjaDEsIDEsIHZhbCk7CisJcmV0ID0gc2tsX2RyYW1f
Z2V0X2NoYW5uZWxfaW5mbyhpOTE1LCAmY2gxLCAxLCB2YWwpOwogCWlmIChyZXQgPT0gMCkKIAkJ
ZHJhbV9pbmZvLT5udW1fY2hhbm5lbHMrKzsKIApAQCAtMTIzOSw3ICsxMjM5LDcgQEAgc2tsX2Ry
YW1fZ2V0X2NoYW5uZWxzX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
fQogCiBzdGF0aWMgZW51bSBpbnRlbF9kcmFtX3R5cGUKLXNrbF9nZXRfZHJhbV90eXBlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3NrbF9nZXRfZHJhbV90eXBlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiB2YWw7CiAKQEAgLTEyNjEsMTYgKzEyNjEs
MTYgQEAgc2tsX2dldF9kcmFtX3R5cGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogfQogCiBzdGF0aWMgaW50Ci1za2xfZ2V0X2RyYW1faW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitza2xfZ2V0X2RyYW1faW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgZHJhbV9pbmZvICpkcmFtX2luZm8gPSAmZGV2X3ByaXYtPmRy
YW1faW5mbzsKKwlzdHJ1Y3QgZHJhbV9pbmZvICpkcmFtX2luZm8gPSAmaTkxNS0+ZHJhbV9pbmZv
OwogCXUzMiBtZW1fZnJlcV9raHosIHZhbDsKIAlpbnQgcmV0OwogCi0JZHJhbV9pbmZvLT50eXBl
ID0gc2tsX2dldF9kcmFtX3R5cGUoZGV2X3ByaXYpOworCWRyYW1faW5mby0+dHlwZSA9IHNrbF9n
ZXRfZHJhbV90eXBlKGk5MTUpOwogCURSTV9ERUJVR19LTVMoIkRSQU0gdHlwZTogJXNcbiIsIGlu
dGVsX2RyYW1fdHlwZV9zdHIoZHJhbV9pbmZvLT50eXBlKSk7CiAKLQlyZXQgPSBza2xfZHJhbV9n
ZXRfY2hhbm5lbHNfaW5mbyhkZXZfcHJpdik7CisJcmV0ID0gc2tsX2RyYW1fZ2V0X2NoYW5uZWxz
X2luZm8oaTkxNSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMTM3MCw5ICsxMzcw
LDkgQEAgc3RhdGljIHZvaWQgYnh0X2dldF9kaW1tX2luZm8oc3RydWN0IGRyYW1fZGltbV9pbmZv
ICpkaW1tLAogfQogCiBzdGF0aWMgaW50Ci1ieHRfZ2V0X2RyYW1faW5mbyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitieHRfZ2V0X2RyYW1faW5mbyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgZHJhbV9pbmZvICpkcmFtX2luZm8gPSAmZGV2X3By
aXYtPmRyYW1faW5mbzsKKwlzdHJ1Y3QgZHJhbV9pbmZvICpkcmFtX2luZm8gPSAmaTkxNS0+ZHJh
bV9pbmZvOwogCXUzMiBkcmFtX2NoYW5uZWxzOwogCXUzMiBtZW1fZnJlcV9raHosIHZhbDsKIAl1
OCBudW1fYWN0aXZlX2NoYW5uZWxzOwpAQCAtMTQ0Myw5ICsxNDQzLDkgQEAgYnh0X2dldF9kcmFt
X2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogfQogCiBzdGF0aWMgdm9p
ZAotaW50ZWxfZ2V0X2RyYW1faW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitpbnRlbF9nZXRfZHJhbV9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cnVjdCBkcmFtX2luZm8gKmRyYW1faW5mbyA9ICZkZXZfcHJpdi0+ZHJhbV9pbmZvOworCXN0
cnVjdCBkcmFtX2luZm8gKmRyYW1faW5mbyA9ICZpOTE1LT5kcmFtX2luZm87CiAJaW50IHJldDsK
IAogCS8qCkBAIC0xNDUzLDE1ICsxNDUzLDE1IEBAIGludGVsX2dldF9kcmFtX2luZm8oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIFRoaXMgaXMgb25seSB1c2VkIGZvciB0
aGUgbGV2ZWwgMCB3YXRlcm1hcmsgbGF0ZW5jeQogCSAqIHcvYSB3aGljaCBkb2VzIG5vdCBhcHBs
eSB0byBieHQvZ2xrLgogCSAqLwotCWRyYW1faW5mby0+aXNfMTZnYl9kaW1tID0gIUlTX0dFTjlf
TFAoZGV2X3ByaXYpOworCWRyYW1faW5mby0+aXNfMTZnYl9kaW1tID0gIUlTX0dFTjlfTFAoaTkx
NSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkpCisJaWYgKElOVEVMX0dFTihpOTE1
KSA8IDkpCiAJCXJldHVybjsKIAotCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKLQkJcmV0ID0g
Ynh0X2dldF9kcmFtX2luZm8oZGV2X3ByaXYpOworCWlmIChJU19HRU45X0xQKGk5MTUpKQorCQly
ZXQgPSBieHRfZ2V0X2RyYW1faW5mbyhpOTE1KTsKIAllbHNlCi0JCXJldCA9IHNrbF9nZXRfZHJh
bV9pbmZvKGRldl9wcml2KTsKKwkJcmV0ID0gc2tsX2dldF9kcmFtX2luZm8oaTkxNSk7CiAJaWYg
KHJldCkKIAkJcmV0dXJuOwogCkBAIC0xNDczLDcgKzE0NzMsNyBAQCBpbnRlbF9nZXRfZHJhbV9p
bmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICAgICAgZHJhbV9pbmZv
LT5yYW5rcywgeWVzbm8oZHJhbV9pbmZvLT5pc18xNmdiX2RpbW0pKTsKIH0KIAotc3RhdGljIHUz
MiBnZW45X2VkcmFtX3NpemVfbWIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1
MzIgY2FwKQorc3RhdGljIHUzMiBnZW45X2VkcmFtX3NpemVfbWIoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIHUzMiBjYXApCiB7CiAJY29uc3QgdW5zaWduZWQgaW50IHdheXNbOF0gPSB7
IDQsIDgsIDEyLCAxNiwgMTYsIDE2LCAxNiwgMTYgfTsKIAljb25zdCB1bnNpZ25lZCBpbnQgc2V0
c1s0XSA9IHsgMSwgMSwgMiwgMiB9OwpAQCAtMTQ4MywxNiArMTQ4MywxNiBAQCBzdGF0aWMgdTMy
IGdlbjlfZWRyYW1fc2l6ZV9tYihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUz
MiBjYXApCiAJCXNldHNbRURSQU1fU0VUU19JRFgoY2FwKV07CiB9CiAKLXN0YXRpYyB2b2lkIGVk
cmFtX2RldGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCBlZHJhbV9kZXRlY3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGVk
cmFtX2NhcCA9IDA7CiAKLQlpZiAoIShJU19IQVNXRUxMKGRldl9wcml2KSB8fAotCSAgICAgIElT
X0JST0FEV0VMTChkZXZfcHJpdikgfHwKLQkgICAgICBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkp
KQorCWlmICghKElTX0hBU1dFTEwoaTkxNSkgfHwKKwkgICAgICBJU19CUk9BRFdFTEwoaTkxNSkg
fHwKKwkgICAgICBJTlRFTF9HRU4oaTkxNSkgPj0gOSkpCiAJCXJldHVybjsKIAotCWVkcmFtX2Nh
cCA9IF9fcmF3X3VuY29yZV9yZWFkMzIoJmRldl9wcml2LT51bmNvcmUsIEhTV19FRFJBTV9DQVAp
OworCWVkcmFtX2NhcCA9IF9fcmF3X3VuY29yZV9yZWFkMzIoJmk5MTUtPnVuY29yZSwgSFNXX0VE
UkFNX0NBUCk7CiAKIAkvKiBOQjogV2UgY2FuJ3Qgd3JpdGUgSURJQ1IgeWV0IGJlY2F1c2Ugd2Ug
ZG9uJ3QgaGF2ZSBndCBmdW5jcyBzZXQgdXAgKi8KIApAQCAtMTUwMyw2MyArMTUwMyw2MyBAQCBz
dGF0aWMgdm9pZCBlZHJhbV9kZXRlY3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCSAqIFRoZSBuZWVkZWQgY2FwYWJpbGl0eSBiaXRzIGZvciBzaXplIGNhbGN1bGF0aW9uIGFy
ZSBub3QgdGhlcmUgd2l0aAogCSAqIHByZSBnZW45IHNvIHJldHVybiAxMjhNQiBhbHdheXMuCiAJ
ICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA5KQotCQlkZXZfcHJpdi0+ZWRyYW1fc2l6
ZV9tYiA9IDEyODsKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgOSkKKwkJaTkxNS0+ZWRyYW1fc2l6
ZV9tYiA9IDEyODsKIAllbHNlCi0JCWRldl9wcml2LT5lZHJhbV9zaXplX21iID0KLQkJCWdlbjlf
ZWRyYW1fc2l6ZV9tYihkZXZfcHJpdiwgZWRyYW1fY2FwKTsKKwkJaTkxNS0+ZWRyYW1fc2l6ZV9t
YiA9CisJCQlnZW45X2VkcmFtX3NpemVfbWIoaTkxNSwgZWRyYW1fY2FwKTsKIAotCURSTV9JTkZP
KCJGb3VuZCAldU1CIG9mIGVEUkFNXG4iLCBkZXZfcHJpdi0+ZWRyYW1fc2l6ZV9tYik7CisJRFJN
X0lORk8oIkZvdW5kICV1TUIgb2YgZURSQU1cbiIsIGk5MTUtPmVkcmFtX3NpemVfbWIpOwogfQog
CiAvKioKICAqIGk5MTVfZHJpdmVyX2luaXRfaHcgLSBzZXR1cCBzdGF0ZSByZXF1aXJpbmcgZGV2
aWNlIGFjY2VzcwotICogQGRldl9wcml2OiBkZXZpY2UgcHJpdmF0ZQorICogQGk5MTU6IGRldmlj
ZSBwcml2YXRlCiAgKgogICogU2V0dXAgc3RhdGUgdGhhdCByZXF1aXJlcyBhY2Nlc3NpbmcgdGhl
IGRldmljZSwgYnV0IGRvZXNuJ3QgcmVxdWlyZQogICogZXhwb3NpbmcgdGhlIGRyaXZlciB2aWEg
a2VybmVsIGludGVybmFsIG9yIHVzZXJzcGFjZSBpbnRlcmZhY2VzLgogICovCi1zdGF0aWMgaW50
IGk5MTVfZHJpdmVyX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIGludCBpOTE1X2RyaXZlcl9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0
cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CiAJaW50IHJldDsKIAogCWlmIChp
OTE1X2luamVjdF9sb2FkX2ZhaWx1cmUoKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlpbnRlbF9k
ZXZpY2VfaW5mb19ydW50aW1lX2luaXQoZGV2X3ByaXYpOworCWludGVsX2RldmljZV9pbmZvX3J1
bnRpbWVfaW5pdChpOTE1KTsKIAotCWlmIChIQVNfUFBHVFQoZGV2X3ByaXYpKSB7Ci0JCWlmIChp
bnRlbF92Z3B1X2FjdGl2ZShkZXZfcHJpdikgJiYKLQkJICAgICFpbnRlbF92Z3B1X2hhc19mdWxs
X3BwZ3R0KGRldl9wcml2KSkgewotCQkJaTkxNV9yZXBvcnRfZXJyb3IoZGV2X3ByaXYsCisJaWYg
KEhBU19QUEdUVChpOTE1KSkgeworCQlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkgJiYKKwkJ
ICAgICFpbnRlbF92Z3B1X2hhc19mdWxsX3BwZ3R0KGk5MTUpKSB7CisJCQlpOTE1X3JlcG9ydF9l
cnJvcihpOTE1LAogCQkJCQkgICJpbmNvbXBhdGlibGUgdkdQVSBmb3VuZCwgc3VwcG9ydCBmb3Ig
aXNvbGF0ZWQgcHBHVFQgcmVxdWlyZWRcbiIpOwogCQkJcmV0dXJuIC1FTlhJTzsKIAkJfQogCX0K
IAotCWlmIChIQVNfRVhFQ0xJU1RTKGRldl9wcml2KSkgeworCWlmIChIQVNfRVhFQ0xJU1RTKGk5
MTUpKSB7CiAJCS8qCiAJCSAqIE9sZGVyIEdWVCBlbXVsYXRpb24gZGVwZW5kcyB1cG9uIGludGVy
Y2VwdGluZyBDU0IgbW1pbywKIAkJICogd2hpY2ggd2Ugbm8gbG9uZ2VyIHVzZSwgcHJlZmVycmlu
ZyB0byB1c2UgdGhlIEhXU1AgY2FjaGUKIAkJICogaW5zdGVhZC4KIAkJICovCi0JCWlmIChpbnRl
bF92Z3B1X2FjdGl2ZShkZXZfcHJpdikgJiYKLQkJICAgICFpbnRlbF92Z3B1X2hhc19od3NwX2Vt
dWxhdGlvbihkZXZfcHJpdikpIHsKLQkJCWk5MTVfcmVwb3J0X2Vycm9yKGRldl9wcml2LAorCQlp
ZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkgJiYKKwkJICAgICFpbnRlbF92Z3B1X2hhc19od3Nw
X2VtdWxhdGlvbihpOTE1KSkgeworCQkJaTkxNV9yZXBvcnRfZXJyb3IoaTkxNSwKIAkJCQkJICAi
b2xkIHZHUFUgaG9zdCBmb3VuZCwgc3VwcG9ydCBmb3IgSFdTUCBlbXVsYXRpb24gcmVxdWlyZWRc
biIpOwogCQkJcmV0dXJuIC1FTlhJTzsKIAkJfQogCX0KIAotCWludGVsX3Nhbml0aXplX29wdGlv
bnMoZGV2X3ByaXYpOworCWludGVsX3Nhbml0aXplX29wdGlvbnMoaTkxNSk7CiAKIAkvKiBuZWVk
cyB0byBiZSBkb25lIGJlZm9yZSBnZ3R0IHByb2JlICovCi0JZWRyYW1fZGV0ZWN0KGRldl9wcml2
KTsKKwllZHJhbV9kZXRlY3QoaTkxNSk7CiAKLQlpOTE1X3BlcmZfaW5pdChkZXZfcHJpdik7CisJ
aTkxNV9wZXJmX2luaXQoaTkxNSk7CiAKLQlyZXQgPSBpOTE1X2dndHRfcHJvYmVfaHcoZGV2X3By
aXYpOworCXJldCA9IGk5MTVfZ2d0dF9wcm9iZV9odyhpOTE1KTsKIAlpZiAocmV0KQogCQlnb3Rv
IGVycl9wZXJmOwogCkBAIC0xNTY3LDcgKzE1NjcsNyBAQCBzdGF0aWMgaW50IGk5MTVfZHJpdmVy
X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIFdBUk5JTkc6
IEFwcGFyZW50bHkgd2UgbXVzdCBraWNrIGZiZGV2IGRyaXZlcnMgYmVmb3JlIHZnYWNvbiwKIAkg
KiBvdGhlcndpc2UgdGhlIHZnYSBmYmRldiBkcml2ZXIgZmFsbHMgb3Zlci4KIAkgKi8KLQlyZXQg
PSBpOTE1X2tpY2tfb3V0X2Zpcm13YXJlX2ZiKGRldl9wcml2KTsKKwlyZXQgPSBpOTE1X2tpY2tf
b3V0X2Zpcm13YXJlX2ZiKGk5MTUpOwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJmYWlsZWQg
dG8gcmVtb3ZlIGNvbmZsaWN0aW5nIGZyYW1lYnVmZmVyIGRyaXZlcnNcbiIpOwogCQlnb3RvIGVy
cl9nZ3R0OwpAQCAtMTU3OSwxMSArMTU3OSwxMSBAQCBzdGF0aWMgaW50IGk5MTVfZHJpdmVyX2lu
aXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlnb3RvIGVycl9nZ3R0
OwogCX0KIAotCXJldCA9IGk5MTVfZ2d0dF9pbml0X2h3KGRldl9wcml2KTsKKwlyZXQgPSBpOTE1
X2dndHRfaW5pdF9odyhpOTE1KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9nZ3R0OwogCi0JcmV0
ID0gaTkxNV9nZ3R0X2VuYWJsZV9odyhkZXZfcHJpdik7CisJcmV0ID0gaTkxNV9nZ3R0X2VuYWJs
ZV9odyhpOTE1KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiZmFpbGVkIHRvIGVuYWJsZSBH
R1RUXG4iKTsKIAkJZ290byBlcnJfZ2d0dDsKQEAgLTE1OTIsNyArMTU5Miw3IEBAIHN0YXRpYyBp
bnQgaTkxNV9kcml2ZXJfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJcGNpX3NldF9tYXN0ZXIocGRldik7CiAKIAkvKiBvdmVybGF5IG9uIGdlbjIgaXMgYnJva2Vu
IGFuZCBjYW4ndCBhZGRyZXNzIGFib3ZlIDFHICovCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgMikp
IHsKKwlpZiAoSVNfR0VOKGk5MTUsIDIpKSB7CiAJCXJldCA9IGRtYV9zZXRfY29oZXJlbnRfbWFz
aygmcGRldi0+ZGV2LCBETUFfQklUX01BU0soMzApKTsKIAkJaWYgKHJldCkgewogCQkJRFJNX0VS
Uk9SKCJmYWlsZWQgdG8gc2V0IERNQSBtYXNrXG4iKTsKQEAgLTE2MDksNyArMTYwOSw3IEBAIHN0
YXRpYyBpbnQgaTkxNV9kcml2ZXJfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJICogYmVoYXZpb3VyIGlmIGFueSBnZW5lcmFsIHN0YXRlIGlzIGFjY2Vzc2VkIHdp
dGhpbiBhIHBhZ2UgYWJvdmUgNEdCLAogCSAqIHdoaWNoIGFsc28gbmVlZHMgdG8gYmUgaGFuZGxl
ZCBjYXJlZnVsbHkuCiAJICovCi0JaWYgKElTX0k5NjVHKGRldl9wcml2KSB8fCBJU19JOTY1R00o
ZGV2X3ByaXYpKSB7CisJaWYgKElTX0k5NjVHKGk5MTUpIHx8IElTX0k5NjVHTShpOTE1KSkgewog
CQlyZXQgPSBkbWFfc2V0X2NvaGVyZW50X21hc2soJnBkZXYtPmRldiwgRE1BX0JJVF9NQVNLKDMy
KSk7CiAKIAkJaWYgKHJldCkgewpAQCAtMTYxOSwxMyArMTYxOSwxMyBAQCBzdGF0aWMgaW50IGk5
MTVfZHJpdmVyX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQl9
CiAJfQogCi0JcG1fcW9zX2FkZF9yZXF1ZXN0KCZkZXZfcHJpdi0+cG1fcW9zLCBQTV9RT1NfQ1BV
X0RNQV9MQVRFTkNZLAorCXBtX3Fvc19hZGRfcmVxdWVzdCgmaTkxNS0+cG1fcW9zLCBQTV9RT1Nf
Q1BVX0RNQV9MQVRFTkNZLAogCQkJICAgUE1fUU9TX0RFRkFVTFRfVkFMVUUpOwogCi0JaW50ZWxf
dW5jb3JlX3Nhbml0aXplKGRldl9wcml2KTsKKwlpbnRlbF91bmNvcmVfc2FuaXRpemUoaTkxNSk7
CiAKLQlpbnRlbF9ndF9pbml0X3dvcmthcm91bmRzKGRldl9wcml2KTsKLQlpOTE1X2dlbV9sb2Fk
X2luaXRfZmVuY2VzKGRldl9wcml2KTsKKwlpbnRlbF9ndF9pbml0X3dvcmthcm91bmRzKGk5MTUp
OworCWk5MTVfZ2VtX2xvYWRfaW5pdF9mZW5jZXMoaTkxNSk7CiAKIAkvKiBPbiB0aGUgOTQ1Ry9H
TSwgdGhlIGNoaXBzZXQgcmVwb3J0cyB0aGUgTVNJIGNhcGFiaWxpdHkgb24gdGhlCiAJICogaW50
ZWdyYXRlZCBncmFwaGljcyBldmVuIHRob3VnaCB0aGUgc3VwcG9ydCBpc24ndCBhY3R1YWxseSB0
aGVyZQpAQCAtMTY0Niw5NCArMTY0Niw5NCBAQCBzdGF0aWMgaW50IGk5MTVfZHJpdmVyX2luaXRf
aHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIGRldmljZS4gVGhlIGtl
cm5lbCB0aGVuIGRpc2FibGVzIHRoYXQgaW50ZXJydXB0IHNvdXJjZSBhbmQgc28KIAkgKiBwcmV2
ZW50cyB0aGUgb3RoZXIgZGV2aWNlIGZyb20gd29ya2luZyBwcm9wZXJseS4KIAkgKi8KLQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA1KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA1KSB7
CiAJCWlmIChwY2lfZW5hYmxlX21zaShwZGV2KSA8IDApCiAJCQlEUk1fREVCVUdfRFJJVkVSKCJj
YW4ndCBlbmFibGUgTVNJIik7CiAJfQogCi0JcmV0ID0gaW50ZWxfZ3Z0X2luaXQoZGV2X3ByaXYp
OworCXJldCA9IGludGVsX2d2dF9pbml0KGk5MTUpOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyX21z
aTsKIAotCWludGVsX29wcmVnaW9uX3NldHVwKGRldl9wcml2KTsKKwlpbnRlbF9vcHJlZ2lvbl9z
ZXR1cChpOTE1KTsKIAkvKgogCSAqIEZpbGwgdGhlIGRyYW0gc3RydWN0dXJlIHRvIGdldCB0aGUg
c3lzdGVtIHJhdyBiYW5kd2lkdGggYW5kCiAJICogZHJhbSBpbmZvLiBUaGlzIHdpbGwgYmUgdXNl
ZCBmb3IgbWVtb3J5IGxhdGVuY3kgY2FsY3VsYXRpb24uCiAJICovCi0JaW50ZWxfZ2V0X2RyYW1f
aW5mbyhkZXZfcHJpdik7CisJaW50ZWxfZ2V0X2RyYW1faW5mbyhpOTE1KTsKIAotCWludGVsX2J3
X2luaXRfaHcoZGV2X3ByaXYpOworCWludGVsX2J3X2luaXRfaHcoaTkxNSk7CiAKIAlyZXR1cm4g
MDsKIAogZXJyX21zaToKIAlpZiAocGRldi0+bXNpX2VuYWJsZWQpCiAJCXBjaV9kaXNhYmxlX21z
aShwZGV2KTsKLQlwbV9xb3NfcmVtb3ZlX3JlcXVlc3QoJmRldl9wcml2LT5wbV9xb3MpOworCXBt
X3Fvc19yZW1vdmVfcmVxdWVzdCgmaTkxNS0+cG1fcW9zKTsKIGVycl9nZ3R0OgotCWk5MTVfZ2d0
dF9jbGVhbnVwX2h3KGRldl9wcml2KTsKKwlpOTE1X2dndHRfY2xlYW51cF9odyhpOTE1KTsKIGVy
cl9wZXJmOgotCWk5MTVfcGVyZl9maW5pKGRldl9wcml2KTsKKwlpOTE1X3BlcmZfZmluaShpOTE1
KTsKIAlyZXR1cm4gcmV0OwogfQogCiAvKioKICAqIGk5MTVfZHJpdmVyX2NsZWFudXBfaHcgLSBj
bGVhbnVwIHRoZSBzZXR1cCBkb25lIGluIGk5MTVfZHJpdmVyX2luaXRfaHcoKQotICogQGRldl9w
cml2OiBkZXZpY2UgcHJpdmF0ZQorICogQGk5MTU6IGRldmljZSBwcml2YXRlCiAgKi8KLXN0YXRp
YyB2b2lkIGk5MTVfZHJpdmVyX2NsZWFudXBfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfY2xlYW51cF9odyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGRldl9wcml2LT5k
cm0ucGRldjsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5wZGV2OwogCi0JaTkx
NV9wZXJmX2ZpbmkoZGV2X3ByaXYpOworCWk5MTVfcGVyZl9maW5pKGk5MTUpOwogCiAJaWYgKHBk
ZXYtPm1zaV9lbmFibGVkKQogCQlwY2lfZGlzYWJsZV9tc2kocGRldik7CiAKLQlwbV9xb3NfcmVt
b3ZlX3JlcXVlc3QoJmRldl9wcml2LT5wbV9xb3MpOworCXBtX3Fvc19yZW1vdmVfcmVxdWVzdCgm
aTkxNS0+cG1fcW9zKTsKIH0KIAogLyoqCiAgKiBpOTE1X2RyaXZlcl9yZWdpc3RlciAtIHJlZ2lz
dGVyIHRoZSBkcml2ZXIgd2l0aCB0aGUgcmVzdCBvZiB0aGUgc3lzdGVtCi0gKiBAZGV2X3ByaXY6
IGRldmljZSBwcml2YXRlCisgKiBAaTkxNTogZGV2aWNlIHByaXZhdGUKICAqCiAgKiBQZXJmb3Jt
IGFueSBzdGVwcyBuZWNlc3NhcnkgdG8gbWFrZSB0aGUgZHJpdmVyIGF2YWlsYWJsZSB2aWEga2Vy
bmVsCiAgKiBpbnRlcm5hbCBvciB1c2Vyc3BhY2UgaW50ZXJmYWNlcy4KICAqLwotc3RhdGljIHZv
aWQgaTkxNV9kcml2ZXJfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwor
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCi0JaTkxNV9nZW1fc2hyaW5r
ZXJfcmVnaXN0ZXIoZGV2X3ByaXYpOwotCWk5MTVfcG11X3JlZ2lzdGVyKGRldl9wcml2KTsKKwlp
OTE1X2dlbV9zaHJpbmtlcl9yZWdpc3RlcihpOTE1KTsKKwlpOTE1X3BtdV9yZWdpc3RlcihpOTE1
KTsKIAogCS8qCiAJICogTm90aWZ5IGEgdmFsaWQgc3VyZmFjZSBhZnRlciBtb2Rlc2V0dGluZywK
IAkgKiB3aGVuIHJ1bm5pbmcgaW5zaWRlIGEgVk0uCiAJICovCi0JaWYgKGludGVsX3ZncHVfYWN0
aXZlKGRldl9wcml2KSkKKwlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkpCiAJCUk5MTVfV1JJ
VEUodmd0aWZfcmVnKGRpc3BsYXlfcmVhZHkpLCBWR1RfRFJWX0RJU1BMQVlfUkVBRFkpOwogCiAJ
LyogUmV2ZWFsIG91ciBwcmVzZW5jZSB0byB1c2Vyc3BhY2UgKi8KIAlpZiAoZHJtX2Rldl9yZWdp
c3RlcihkZXYsIDApID09IDApIHsKLQkJaTkxNV9kZWJ1Z2ZzX3JlZ2lzdGVyKGRldl9wcml2KTsK
LQkJaTkxNV9zZXR1cF9zeXNmcyhkZXZfcHJpdik7CisJCWk5MTVfZGVidWdmc19yZWdpc3Rlcihp
OTE1KTsKKwkJaTkxNV9zZXR1cF9zeXNmcyhpOTE1KTsKIAogCQkvKiBEZXBlbmRzIG9uIHN5c2Zz
IGhhdmluZyBiZWVuIGluaXRpYWxpemVkICovCi0JCWk5MTVfcGVyZl9yZWdpc3RlcihkZXZfcHJp
dik7CisJCWk5MTVfcGVyZl9yZWdpc3RlcihpOTE1KTsKIAl9IGVsc2UKIAkJRFJNX0VSUk9SKCJG
YWlsZWQgdG8gcmVnaXN0ZXIgZHJpdmVyIGZvciB1c2Vyc3BhY2UgYWNjZXNzIVxuIik7CiAKLQlp
ZiAoSEFTX0RJU1BMQVkoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19ESVNQTEFZKGk5MTUpKSB7CiAJ
CS8qIE11c3QgYmUgZG9uZSBhZnRlciBwcm9iaW5nIG91dHB1dHMgKi8KLQkJaW50ZWxfb3ByZWdp
b25fcmVnaXN0ZXIoZGV2X3ByaXYpOworCQlpbnRlbF9vcHJlZ2lvbl9yZWdpc3RlcihpOTE1KTsK
IAkJYWNwaV92aWRlb19yZWdpc3RlcigpOwogCX0KIAotCWlmIChJU19HRU4oZGV2X3ByaXYsIDUp
KQotCQlpbnRlbF9ncHVfaXBzX2luaXQoZGV2X3ByaXYpOworCWlmIChJU19HRU4oaTkxNSwgNSkp
CisJCWludGVsX2dwdV9pcHNfaW5pdChpOTE1KTsKIAotCWludGVsX2F1ZGlvX2luaXQoZGV2X3By
aXYpOworCWludGVsX2F1ZGlvX2luaXQoaTkxNSk7CiAKIAkvKgogCSAqIFNvbWUgcG9ydHMgcmVx
dWlyZSBjb3JyZWN0bHkgc2V0LXVwIGhwZCByZWdpc3RlcnMgZm9yIGRldGVjdGlvbiB0bwpAQCAt
MTc0OCw2MCArMTc0OCw2MCBAQCBzdGF0aWMgdm9pZCBpOTE1X2RyaXZlcl9yZWdpc3RlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogV2UgbmVlZCB0byBjb29yZGluYXRl
IHRoZSBob3RwbHVncyB3aXRoIHRoZSBhc3luY2hyb25vdXMgZmJkZXYKIAkgKiBjb25maWd1cmF0
aW9uLCBmb3Igd2hpY2ggd2UgdXNlIHRoZSBmYmRldi0+YXN5bmNfY29va2llLgogCSAqLwotCWlm
IChIQVNfRElTUExBWShkZXZfcHJpdikpCisJaWYgKEhBU19ESVNQTEFZKGk5MTUpKQogCQlkcm1f
a21zX2hlbHBlcl9wb2xsX2luaXQoZGV2KTsKIAotCWludGVsX3Bvd2VyX2RvbWFpbnNfZW5hYmxl
KGRldl9wcml2KTsKLQlpbnRlbF9ydW50aW1lX3BtX2VuYWJsZShkZXZfcHJpdik7CisJaW50ZWxf
cG93ZXJfZG9tYWluc19lbmFibGUoaTkxNSk7CisJaW50ZWxfcnVudGltZV9wbV9lbmFibGUoaTkx
NSk7CiB9CiAKIC8qKgogICogaTkxNV9kcml2ZXJfdW5yZWdpc3RlciAtIGNsZWFudXAgdGhlIHJl
Z2lzdHJhdGlvbiBkb25lIGluIGk5MTVfZHJpdmVyX3JlZ2lzZXIoKQotICogQGRldl9wcml2OiBk
ZXZpY2UgcHJpdmF0ZQorICogQGk5MTU6IGRldmljZSBwcml2YXRlCiAgKi8KLXN0YXRpYyB2b2lk
IGk5MTVfZHJpdmVyX3VucmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKLQlpbnRlbF9ydW50aW1lX3BtX2Rpc2FibGUoZGV2X3ByaXYpOwotCWlu
dGVsX3Bvd2VyX2RvbWFpbnNfZGlzYWJsZShkZXZfcHJpdik7CisJaW50ZWxfcnVudGltZV9wbV9k
aXNhYmxlKGk5MTUpOworCWludGVsX3Bvd2VyX2RvbWFpbnNfZGlzYWJsZShpOTE1KTsKIAotCWlu
dGVsX2ZiZGV2X3VucmVnaXN0ZXIoZGV2X3ByaXYpOwotCWludGVsX2F1ZGlvX2RlaW5pdChkZXZf
cHJpdik7CisJaW50ZWxfZmJkZXZfdW5yZWdpc3RlcihpOTE1KTsKKwlpbnRlbF9hdWRpb19kZWlu
aXQoaTkxNSk7CiAKIAkvKgogCSAqIEFmdGVyIGZsdXNoaW5nIHRoZSBmYmRldiAoaW5jbC4gYSBs
YXRlIGFzeW5jIGNvbmZpZyB3aGljaCB3aWxsCiAJICogaGF2ZSBkZWxheWVkIHF1ZXVpbmcgb2Yg
YSBob3RwbHVnIGV2ZW50KSwgdGhlbiBmbHVzaCB0aGUgaG90cGx1ZwogCSAqIGV2ZW50cy4KIAkg
Ki8KLQlkcm1fa21zX2hlbHBlcl9wb2xsX2ZpbmkoJmRldl9wcml2LT5kcm0pOworCWRybV9rbXNf
aGVscGVyX3BvbGxfZmluaSgmaTkxNS0+ZHJtKTsKIAogCWludGVsX2dwdV9pcHNfdGVhcmRvd24o
KTsKIAlhY3BpX3ZpZGVvX3VucmVnaXN0ZXIoKTsKLQlpbnRlbF9vcHJlZ2lvbl91bnJlZ2lzdGVy
KGRldl9wcml2KTsKKwlpbnRlbF9vcHJlZ2lvbl91bnJlZ2lzdGVyKGk5MTUpOwogCi0JaTkxNV9w
ZXJmX3VucmVnaXN0ZXIoZGV2X3ByaXYpOwotCWk5MTVfcG11X3VucmVnaXN0ZXIoZGV2X3ByaXYp
OworCWk5MTVfcGVyZl91bnJlZ2lzdGVyKGk5MTUpOworCWk5MTVfcG11X3VucmVnaXN0ZXIoaTkx
NSk7CiAKLQlpOTE1X3RlYXJkb3duX3N5c2ZzKGRldl9wcml2KTsKLQlkcm1fZGV2X3VucGx1Zygm
ZGV2X3ByaXYtPmRybSk7CisJaTkxNV90ZWFyZG93bl9zeXNmcyhpOTE1KTsKKwlkcm1fZGV2X3Vu
cGx1ZygmaTkxNS0+ZHJtKTsKIAotCWk5MTVfZ2VtX3Nocmlua2VyX3VucmVnaXN0ZXIoZGV2X3By
aXYpOworCWk5MTVfZ2VtX3Nocmlua2VyX3VucmVnaXN0ZXIoaTkxNSk7CiB9CiAKLXN0YXRpYyB2
b2lkIGk5MTVfd2VsY29tZV9tZXNzYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdm9pZCBpOTE1X3dlbGNvbWVfbWVzc2FnZXMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7CiAJaWYgKGRybV9kZWJ1ZyAmIERSTV9VVF9EUklWRVIpIHsKIAkJc3Ry
dWN0IGRybV9wcmludGVyIHAgPSBkcm1fZGVidWdfcHJpbnRlcigiaTkxNSBkZXZpY2UgaW5mbzoi
KTsKIAogCQlkcm1fcHJpbnRmKCZwLCAicGNpaWQ9MHglMDR4IHJldj0weCUwMnggcGxhdGZvcm09
JXMgKHN1YnBsYXRmb3JtPTB4JXgpIGdlbj0laVxuIiwKLQkJCSAgIElOVEVMX0RFVklEKGRldl9w
cml2KSwKLQkJCSAgIElOVEVMX1JFVklEKGRldl9wcml2KSwKLQkJCSAgIGludGVsX3BsYXRmb3Jt
X25hbWUoSU5URUxfSU5GTyhkZXZfcHJpdiktPnBsYXRmb3JtKSwKLQkJCSAgIGludGVsX3N1YnBs
YXRmb3JtKFJVTlRJTUVfSU5GTyhkZXZfcHJpdiksCi0JCQkJCSAgICAgSU5URUxfSU5GTyhkZXZf
cHJpdiktPnBsYXRmb3JtKSwKLQkJCSAgIElOVEVMX0dFTihkZXZfcHJpdikpOwotCi0JCWludGVs
X2RldmljZV9pbmZvX2R1bXBfZmxhZ3MoSU5URUxfSU5GTyhkZXZfcHJpdiksICZwKTsKLQkJaW50
ZWxfZGV2aWNlX2luZm9fZHVtcF9ydW50aW1lKFJVTlRJTUVfSU5GTyhkZXZfcHJpdiksICZwKTsK
KwkJCSAgIElOVEVMX0RFVklEKGk5MTUpLAorCQkJICAgSU5URUxfUkVWSUQoaTkxNSksCisJCQkg
ICBpbnRlbF9wbGF0Zm9ybV9uYW1lKElOVEVMX0lORk8oaTkxNSktPnBsYXRmb3JtKSwKKwkJCSAg
IGludGVsX3N1YnBsYXRmb3JtKFJVTlRJTUVfSU5GTyhpOTE1KSwKKwkJCQkJICAgICBJTlRFTF9J
TkZPKGk5MTUpLT5wbGF0Zm9ybSksCisJCQkgICBJTlRFTF9HRU4oaTkxNSkpOworCisJCWludGVs
X2RldmljZV9pbmZvX2R1bXBfZmxhZ3MoSU5URUxfSU5GTyhpOTE1KSwgJnApOworCQlpbnRlbF9k
ZXZpY2VfaW5mb19kdW1wX3J1bnRpbWUoUlVOVElNRV9JTkZPKGk5MTUpLCAmcCk7CiAJfQogCiAJ
aWYgKElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHKSkKQEAgLTE4NzEsMTI2ICsxODcx
LDEyNiBAQCBpbnQgaTkxNV9kcml2ZXJfbG9hZChzdHJ1Y3QgcGNpX2RldiAqcGRldiwgY29uc3Qg
c3RydWN0IHBjaV9kZXZpY2VfaWQgKmVudCkKIHsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNl
X2luZm8gKm1hdGNoX2luZm8gPQogCQkoc3RydWN0IGludGVsX2RldmljZV9pbmZvICopZW50LT5k
cml2ZXJfZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXY7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTU7CiAJaW50IHJldDsKIAotCWRldl9wcml2ID0gaTkxNV9k
cml2ZXJfY3JlYXRlKHBkZXYsIGVudCk7Ci0JaWYgKElTX0VSUihkZXZfcHJpdikpCi0JCXJldHVy
biBQVFJfRVJSKGRldl9wcml2KTsKKwlpOTE1ID0gaTkxNV9kcml2ZXJfY3JlYXRlKHBkZXYsIGVu
dCk7CisJaWYgKElTX0VSUihpOTE1KSkKKwkJcmV0dXJuIFBUUl9FUlIoaTkxNSk7CiAKIAkvKiBE
aXNhYmxlIG51Y2xlYXIgcGFnZWZsaXAgYnkgZGVmYXVsdCBvbiBwcmUtSUxLICovCiAJaWYgKCFp
OTE1X21vZHBhcmFtcy5udWNsZWFyX3BhZ2VmbGlwICYmIG1hdGNoX2luZm8tPmdlbiA8IDUpCi0J
CWRldl9wcml2LT5kcm0uZHJpdmVyX2ZlYXR1cmVzICY9IH5EUklWRVJfQVRPTUlDOworCQlpOTE1
LT5kcm0uZHJpdmVyX2ZlYXR1cmVzICY9IH5EUklWRVJfQVRPTUlDOwogCiAJcmV0ID0gcGNpX2Vu
YWJsZV9kZXZpY2UocGRldik7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfZmluaTsKIAotCXJldCA9
IGk5MTVfZHJpdmVyX2luaXRfZWFybHkoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfZHJpdmVyX2lu
aXRfZWFybHkoaTkxNSk7CiAJaWYgKHJldCA8IDApCiAJCWdvdG8gb3V0X3BjaV9kaXNhYmxlOwog
Ci0JZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwlkaXNhYmxlX3JwbV93
YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAKLQlyZXQgPSBpOTE1X2RyaXZlcl9pbml0X21taW8oZGV2
X3ByaXYpOworCXJldCA9IGk5MTVfZHJpdmVyX2luaXRfbW1pbyhpOTE1KTsKIAlpZiAocmV0IDwg
MCkKIAkJZ290byBvdXRfcnVudGltZV9wbV9wdXQ7CiAKLQlyZXQgPSBpOTE1X2RyaXZlcl9pbml0
X2h3KGRldl9wcml2KTsKKwlyZXQgPSBpOTE1X2RyaXZlcl9pbml0X2h3KGk5MTUpOwogCWlmIChy
ZXQgPCAwKQogCQlnb3RvIG91dF9jbGVhbnVwX21taW87CiAKLQlyZXQgPSBpOTE1X2xvYWRfbW9k
ZXNldF9pbml0KCZkZXZfcHJpdi0+ZHJtKTsKKwlyZXQgPSBpOTE1X2xvYWRfbW9kZXNldF9pbml0
KCZpOTE1LT5kcm0pOwogCWlmIChyZXQgPCAwKQogCQlnb3RvIG91dF9jbGVhbnVwX2h3OwogCi0J
aTkxNV9kcml2ZXJfcmVnaXN0ZXIoZGV2X3ByaXYpOworCWk5MTVfZHJpdmVyX3JlZ2lzdGVyKGk5
MTUpOwogCi0JZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoZGV2X3ByaXYpOworCWVuYWJsZV9y
cG1fd2FrZXJlZl9hc3NlcnRzKGk5MTUpOwogCi0JaTkxNV93ZWxjb21lX21lc3NhZ2VzKGRldl9w
cml2KTsKKwlpOTE1X3dlbGNvbWVfbWVzc2FnZXMoaTkxNSk7CiAKIAlyZXR1cm4gMDsKIAogb3V0
X2NsZWFudXBfaHc6Ci0JaTkxNV9kcml2ZXJfY2xlYW51cF9odyhkZXZfcHJpdik7Ci0JaTkxNV9n
Z3R0X2NsZWFudXBfaHcoZGV2X3ByaXYpOworCWk5MTVfZHJpdmVyX2NsZWFudXBfaHcoaTkxNSk7
CisJaTkxNV9nZ3R0X2NsZWFudXBfaHcoaTkxNSk7CiBvdXRfY2xlYW51cF9tbWlvOgotCWk5MTVf
ZHJpdmVyX2NsZWFudXBfbW1pbyhkZXZfcHJpdik7CisJaTkxNV9kcml2ZXJfY2xlYW51cF9tbWlv
KGk5MTUpOwogb3V0X3J1bnRpbWVfcG1fcHV0OgotCWVuYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRz
KGRldl9wcml2KTsKLQlpOTE1X2RyaXZlcl9jbGVhbnVwX2Vhcmx5KGRldl9wcml2KTsKKwllbmFi
bGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhpOTE1KTsKKwlpOTE1X2RyaXZlcl9jbGVhbnVwX2Vhcmx5
KGk5MTUpOwogb3V0X3BjaV9kaXNhYmxlOgogCXBjaV9kaXNhYmxlX2RldmljZShwZGV2KTsKIG91
dF9maW5pOgotCWk5MTVfbG9hZF9lcnJvcihkZXZfcHJpdiwgIkRldmljZSBpbml0aWFsaXphdGlv
biBmYWlsZWQgKCVkKVxuIiwgcmV0KTsKLQlpOTE1X2RyaXZlcl9kZXN0cm95KGRldl9wcml2KTsK
KwlpOTE1X2xvYWRfZXJyb3IoaTkxNSwgIkRldmljZSBpbml0aWFsaXphdGlvbiBmYWlsZWQgKCVk
KVxuIiwgcmV0KTsKKwlpOTE1X2RyaXZlcl9kZXN0cm95KGk5MTUpOwogCXJldHVybiByZXQ7CiB9
CiAKIHZvaWQgaTkxNV9kcml2ZXJfdW5sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVj
dCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkx
NS0+ZHJtLnBkZXY7CiAKLQlkaXNhYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoZGV2X3ByaXYpOwor
CWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhpOTE1KTsKIAotCWk5MTVfZHJpdmVyX3VucmVn
aXN0ZXIoZGV2X3ByaXYpOworCWk5MTVfZHJpdmVyX3VucmVnaXN0ZXIoaTkxNSk7CiAKIAkvKgog
CSAqIEFmdGVyIHVucmVnaXN0ZXJpbmcgdGhlIGRldmljZSB0byBwcmV2ZW50IGFueSBuZXcgdXNl
cnMsIGNhbmNlbAogCSAqIGFsbCBpbi1mbGlnaHQgcmVxdWVzdHMgc28gdGhhdCB3ZSBjYW4gcXVp
Y2tseSB1bmJpbmQgdGhlIGFjdGl2ZQogCSAqIHJlc291cmNlcy4KIAkgKi8KLQlpOTE1X2dlbV9z
ZXRfd2VkZ2VkKGRldl9wcml2KTsKKwlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOwogCiAJLyog
Rmx1c2ggYW55IGV4dGVybmFsIGNvZGUgdGhhdCBzdGlsbCBtYXkgYmUgdW5kZXIgdGhlIFJDVSBs
b2NrICovCiAJc3luY2hyb25pemVfcmN1KCk7CiAKLQlpOTE1X2dlbV9zdXNwZW5kKGRldl9wcml2
KTsKKwlpOTE1X2dlbV9zdXNwZW5kKGk5MTUpOwogCiAJZHJtX2F0b21pY19oZWxwZXJfc2h1dGRv
d24oZGV2KTsKIAotCWludGVsX2d2dF9jbGVhbnVwKGRldl9wcml2KTsKKwlpbnRlbF9ndnRfY2xl
YW51cChpOTE1KTsKIAogCWludGVsX21vZGVzZXRfY2xlYW51cChkZXYpOwogCi0JaW50ZWxfYmlv
c19jbGVhbnVwKGRldl9wcml2KTsKKwlpbnRlbF9iaW9zX2NsZWFudXAoaTkxNSk7CiAKIAl2Z2Ff
c3dpdGNoZXJvb191bnJlZ2lzdGVyX2NsaWVudChwZGV2KTsKIAl2Z2FfY2xpZW50X3JlZ2lzdGVy
KHBkZXYsIE5VTEwsIE5VTEwsIE5VTEwpOwogCi0JaW50ZWxfY3NyX3Vjb2RlX2ZpbmkoZGV2X3By
aXYpOworCWludGVsX2Nzcl91Y29kZV9maW5pKGk5MTUpOwogCiAJLyogRnJlZSBlcnJvciBzdGF0
ZSBhZnRlciBpbnRlcnJ1cHRzIGFyZSBmdWxseSBkaXNhYmxlZC4gKi8KLQljYW5jZWxfZGVsYXll
ZF93b3JrX3N5bmMoJmRldl9wcml2LT5ncHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmspOwotCWk5MTVf
cmVzZXRfZXJyb3Jfc3RhdGUoZGV2X3ByaXYpOworCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygm
aTkxNS0+Z3B1X2Vycm9yLmhhbmdjaGVja193b3JrKTsKKwlpOTE1X3Jlc2V0X2Vycm9yX3N0YXRl
KGk5MTUpOwogCi0JaTkxNV9nZW1fZmluaV9odyhkZXZfcHJpdik7CisJaTkxNV9nZW1fZmluaV9o
dyhpOTE1KTsKIAotCWludGVsX3Bvd2VyX2RvbWFpbnNfZmluaV9odyhkZXZfcHJpdik7CisJaW50
ZWxfcG93ZXJfZG9tYWluc19maW5pX2h3KGk5MTUpOwogCi0JaTkxNV9kcml2ZXJfY2xlYW51cF9o
dyhkZXZfcHJpdik7CisJaTkxNV9kcml2ZXJfY2xlYW51cF9odyhpOTE1KTsKIAotCWVuYWJsZV9y
cG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwllbmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0
cyhpOTE1KTsKIH0KIAogc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2
KTsKIAotCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJZGlzYWJsZV9y
cG1fd2FrZXJlZl9hc3NlcnRzKGk5MTUpOwogCi0JaTkxNV9nZW1fZmluaShkZXZfcHJpdik7CisJ
aTkxNV9nZW1fZmluaShpOTE1KTsKIAotCWk5MTVfZ2d0dF9jbGVhbnVwX2h3KGRldl9wcml2KTsK
LQlpOTE1X2RyaXZlcl9jbGVhbnVwX21taW8oZGV2X3ByaXYpOworCWk5MTVfZ2d0dF9jbGVhbnVw
X2h3KGk5MTUpOworCWk5MTVfZHJpdmVyX2NsZWFudXBfbW1pbyhpOTE1KTsKIAotCWVuYWJsZV9y
cG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKLQlpbnRlbF9ydW50aW1lX3BtX2NsZWFudXAo
ZGV2X3ByaXYpOworCWVuYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGk5MTUpOworCWludGVsX3J1
bnRpbWVfcG1fY2xlYW51cChpOTE1KTsKIAotCWk5MTVfZHJpdmVyX2NsZWFudXBfZWFybHkoZGV2
X3ByaXYpOwotCWk5MTVfZHJpdmVyX2Rlc3Ryb3koZGV2X3ByaXYpOworCWk5MTVfZHJpdmVyX2Ns
ZWFudXBfZWFybHkoaTkxNSk7CisJaTkxNV9kcml2ZXJfZGVzdHJveShpOTE1KTsKIH0KIAogc3Rh
dGljIGludCBpOTE1X2RyaXZlcl9vcGVuKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBk
cm1fZmlsZSAqZmlsZSkKQEAgLTIwMzUsOSArMjAzNSw5IEBAIHN0YXRpYyB2b2lkIGk5MTVfZHJp
dmVyX3Bvc3RjbG9zZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bGUpCiAJa2ZyZWUoZmlsZV9wcml2KTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfc3VzcGVuZF9l
bmNvZGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBp
bnRlbF9zdXNwZW5kX2VuY29kZXJzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsK
IAogCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGRldik7CkBAIC0yMDQ3LDExICsyMDQ3LDExIEBAIHN0
YXRpYyB2b2lkIGludGVsX3N1c3BlbmRfZW5jb2RlcnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCWRybV9tb2Rlc2V0X3VubG9ja19hbGwoZGV2KTsKIH0KIAotc3RhdGljIGlu
dCB2bHZfcmVzdW1lX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIGludCB2bHZfcmVzdW1lX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkgICAgICBib29sIHJwbV9yZXN1bWUpOwotc3RhdGljIGludCB2bHZfc3VzcGVuZF9j
b21wbGV0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworc3RhdGljIGludCB2
bHZfc3VzcGVuZF9jb21wbGV0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKLXN0
YXRpYyBib29sIHN1c3BlbmRfdG9faWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgYm9vbCBzdXNwZW5kX3RvX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAjaWYgSVNfRU5BQkxFRChDT05GSUdfQUNQSV9TTEVFUCkKIAlpZiAoYWNwaV90
YXJnZXRfc3lzdGVtX3N0YXRlKCkgPCBBQ1BJX1NUQVRFX1MzKQpAQCAtMjA3NywxNSArMjA3Nywx
NSBAQCBzdGF0aWMgaW50IGk5MTVfZHJtX3ByZXBhcmUoc3RydWN0IGRybV9kZXZpY2UgKmRldikK
IAogc3RhdGljIGludCBpOTE1X2RybV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0
cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0g
aTkxNS0+ZHJtLnBkZXY7CiAJcGNpX3Bvd2VyX3Qgb3ByZWdpb25fdGFyZ2V0X3N0YXRlOwogCi0J
ZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwlkaXNhYmxlX3JwbV93YWtl
cmVmX2Fzc2VydHMoaTkxNSk7CiAKIAkvKiBXZSBkbyBhIGxvdCBvZiBwb2tpbmcgaW4gYSBsb3Qg
b2YgcmVnaXN0ZXJzLCBtYWtlIHN1cmUgdGhleSB3b3JrCiAJICogcHJvcGVybHkuICovCi0JaW50
ZWxfcG93ZXJfZG9tYWluc19kaXNhYmxlKGRldl9wcml2KTsKKwlpbnRlbF9wb3dlcl9kb21haW5z
X2Rpc2FibGUoaTkxNSk7CiAKIAlkcm1fa21zX2hlbHBlcl9wb2xsX2Rpc2FibGUoZGV2KTsKIApA
QCAtMjA5Myw0MCArMjA5Myw0MCBAQCBzdGF0aWMgaW50IGk5MTVfZHJtX3N1c3BlbmQoc3RydWN0
IGRybV9kZXZpY2UgKmRldikKIAogCWludGVsX2Rpc3BsYXlfc3VzcGVuZChkZXYpOwogCi0JaW50
ZWxfZHBfbXN0X3N1c3BlbmQoZGV2X3ByaXYpOworCWludGVsX2RwX21zdF9zdXNwZW5kKGk5MTUp
OwogCi0JaW50ZWxfcnVudGltZV9wbV9kaXNhYmxlX2ludGVycnVwdHMoZGV2X3ByaXYpOwotCWlu
dGVsX2hwZF9jYW5jZWxfd29yayhkZXZfcHJpdik7CisJaW50ZWxfcnVudGltZV9wbV9kaXNhYmxl
X2ludGVycnVwdHMoaTkxNSk7CisJaW50ZWxfaHBkX2NhbmNlbF93b3JrKGk5MTUpOwogCi0JaW50
ZWxfc3VzcGVuZF9lbmNvZGVycyhkZXZfcHJpdik7CisJaW50ZWxfc3VzcGVuZF9lbmNvZGVycyhp
OTE1KTsKIAotCWludGVsX3N1c3BlbmRfaHcoZGV2X3ByaXYpOworCWludGVsX3N1c3BlbmRfaHco
aTkxNSk7CiAKLQlpOTE1X2dlbV9zdXNwZW5kX2d0dF9tYXBwaW5ncyhkZXZfcHJpdik7CisJaTkx
NV9nZW1fc3VzcGVuZF9ndHRfbWFwcGluZ3MoaTkxNSk7CiAKLQlpOTE1X3NhdmVfc3RhdGUoZGV2
X3ByaXYpOworCWk5MTVfc2F2ZV9zdGF0ZShpOTE1KTsKIAotCW9wcmVnaW9uX3RhcmdldF9zdGF0
ZSA9IHN1c3BlbmRfdG9faWRsZShkZXZfcHJpdikgPyBQQ0lfRDEgOiBQQ0lfRDNjb2xkOwotCWlu
dGVsX29wcmVnaW9uX3N1c3BlbmQoZGV2X3ByaXYsIG9wcmVnaW9uX3RhcmdldF9zdGF0ZSk7CisJ
b3ByZWdpb25fdGFyZ2V0X3N0YXRlID0gc3VzcGVuZF90b19pZGxlKGk5MTUpID8gUENJX0QxIDog
UENJX0QzY29sZDsKKwlpbnRlbF9vcHJlZ2lvbl9zdXNwZW5kKGk5MTUsIG9wcmVnaW9uX3Rhcmdl
dF9zdGF0ZSk7CiAKIAlpbnRlbF9mYmRldl9zZXRfc3VzcGVuZChkZXYsIEZCSU5GT19TVEFURV9T
VVNQRU5ERUQsIHRydWUpOwogCi0JZGV2X3ByaXYtPnN1c3BlbmRfY291bnQrKzsKKwlpOTE1LT5z
dXNwZW5kX2NvdW50Kys7CiAKLQlpbnRlbF9jc3JfdWNvZGVfc3VzcGVuZChkZXZfcHJpdik7CisJ
aW50ZWxfY3NyX3Vjb2RlX3N1c3BlbmQoaTkxNSk7CiAKLQllbmFibGVfcnBtX3dha2VyZWZfYXNz
ZXJ0cyhkZXZfcHJpdik7CisJZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAKIAly
ZXR1cm4gMDsKIH0KIAogc3RhdGljIGVudW0gaTkxNV9kcm1fc3VzcGVuZF9tb2RlCi1nZXRfc3Vz
cGVuZF9tb2RlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBoaWJlcm5h
dGUpCitnZXRfc3VzcGVuZF9tb2RlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29s
IGhpYmVybmF0ZSkKIHsKIAlpZiAoaGliZXJuYXRlKQogCQlyZXR1cm4gSTkxNV9EUk1fU1VTUEVO
RF9ISUJFUk5BVEU7CiAKLQlpZiAoc3VzcGVuZF90b19pZGxlKGRldl9wcml2KSkKKwlpZiAoc3Vz
cGVuZF90b19pZGxlKGk5MTUpKQogCQlyZXR1cm4gSTkxNV9EUk1fU1VTUEVORF9JRExFOwogCiAJ
cmV0dXJuIEk5MTVfRFJNX1NVU1BFTkRfTUVNOwpAQCAtMjEzNCwzMCArMjEzNCwzMCBAQCBnZXRf
c3VzcGVuZF9tb2RlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBoaWJl
cm5hdGUpCiAKIHN0YXRpYyBpbnQgaTkxNV9kcm1fc3VzcGVuZF9sYXRlKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIGJvb2wgaGliZXJuYXRpb24pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3By
aXYtPmRybS5wZGV2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShk
ZXYpOworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CiAJaW50IHJldDsK
IAotCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJZGlzYWJsZV9ycG1f
d2FrZXJlZl9hc3NlcnRzKGk5MTUpOwogCi0JaTkxNV9nZW1fc3VzcGVuZF9sYXRlKGRldl9wcml2
KTsKKwlpOTE1X2dlbV9zdXNwZW5kX2xhdGUoaTkxNSk7CiAKLQlpbnRlbF91bmNvcmVfc3VzcGVu
ZCgmZGV2X3ByaXYtPnVuY29yZSk7CisJaW50ZWxfdW5jb3JlX3N1c3BlbmQoJmk5MTUtPnVuY29y
ZSk7CiAKLQlpbnRlbF9wb3dlcl9kb21haW5zX3N1c3BlbmQoZGV2X3ByaXYsCi0JCQkJICAgIGdl
dF9zdXNwZW5kX21vZGUoZGV2X3ByaXYsIGhpYmVybmF0aW9uKSk7CisJaW50ZWxfcG93ZXJfZG9t
YWluc19zdXNwZW5kKGk5MTUsCisJCQkJICAgIGdldF9zdXNwZW5kX21vZGUoaTkxNSwgaGliZXJu
YXRpb24pKTsKIAogCXJldCA9IDA7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgfHwg
SVNfR0VOOV9MUChkZXZfcHJpdikpCi0JCWJ4dF9lbmFibGVfZGM5KGRldl9wcml2KTsKLQllbHNl
IGlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQotCQlo
c3dfZW5hYmxlX3BjOChkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJp
dikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCXJldCA9IHZsdl9zdXNwZW5kX2NvbXBs
ZXRlKGRldl9wcml2KTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExIHx8IElTX0dFTjlfTFAo
aTkxNSkpCisJCWJ4dF9lbmFibGVfZGM5KGk5MTUpOworCWVsc2UgaWYgKElTX0hBU1dFTEwoaTkx
NSkgfHwgSVNfQlJPQURXRUxMKGk5MTUpKQorCQloc3dfZW5hYmxlX3BjOChpOTE1KTsKKwllbHNl
IGlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpCisJCXJldCA9
IHZsdl9zdXNwZW5kX2NvbXBsZXRlKGk5MTUpOwogCiAJaWYgKHJldCkgewogCQlEUk1fRVJST1Io
IlN1c3BlbmQgY29tcGxldGUgZmFpbGVkOiAlZFxuIiwgcmV0KTsKLQkJaW50ZWxfcG93ZXJfZG9t
YWluc19yZXN1bWUoZGV2X3ByaXYpOworCQlpbnRlbF9wb3dlcl9kb21haW5zX3Jlc3VtZShpOTE1
KTsKIAogCQlnb3RvIG91dDsKIAl9CkBAIC0yMTc1LDEzICsyMTc1LDEzIEBAIHN0YXRpYyBpbnQg
aTkxNV9kcm1fc3VzcGVuZF9sYXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGJvb2wgaGliZXJu
YXRpb24pCiAJICogRnVqaXRzdSBGU0MgUzcxMTAKIAkgKiBBY2VyIEFzcGlyZSAxODMwVAogCSAq
LwotCWlmICghKGhpYmVybmF0aW9uICYmIElOVEVMX0dFTihkZXZfcHJpdikgPCA2KSkKKwlpZiAo
IShoaWJlcm5hdGlvbiAmJiBJTlRFTF9HRU4oaTkxNSkgPCA2KSkKIAkJcGNpX3NldF9wb3dlcl9z
dGF0ZShwZGV2LCBQQ0lfRDNob3QpOwogCiBvdXQ6Ci0JZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2Vy
dHMoZGV2X3ByaXYpOwotCWlmICghZGV2X3ByaXYtPnVuY29yZS51c2VyX2ZvcmNld2FrZS5jb3Vu
dCkKLQkJaW50ZWxfcnVudGltZV9wbV9jbGVhbnVwKGRldl9wcml2KTsKKwllbmFibGVfcnBtX3dh
a2VyZWZfYXNzZXJ0cyhpOTE1KTsKKwlpZiAoIWk5MTUtPnVuY29yZS51c2VyX2ZvcmNld2FrZS5j
b3VudCkKKwkJaW50ZWxfcnVudGltZV9wbV9jbGVhbnVwKGk5MTUpOwogCiAJcmV0dXJuIHJldDsK
IH0KQEAgLTIyMTIsMjQgKzIyMTIsMjQgQEAgc3RhdGljIGludCBpOTE1X3N1c3BlbmRfc3dpdGNo
ZXJvbyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUpCiAKIHN0YXRp
YyBpbnQgaTkxNV9kcm1fcmVzdW1lKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWludCByZXQ7CiAKLQlkaXNhYmxl
X3JwbV93YWtlcmVmX2Fzc2VydHMoZGV2X3ByaXYpOwotCWludGVsX3Nhbml0aXplX2d0X3Bvd2Vy
c2F2ZShkZXZfcHJpdik7CisJZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGk5MTUpOworCWlu
dGVsX3Nhbml0aXplX2d0X3Bvd2Vyc2F2ZShpOTE1KTsKIAotCWk5MTVfZ2VtX3Nhbml0aXplKGRl
dl9wcml2KTsKKwlpOTE1X2dlbV9zYW5pdGl6ZShpOTE1KTsKIAotCXJldCA9IGk5MTVfZ2d0dF9l
bmFibGVfaHcoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfZ2d0dF9lbmFibGVfaHcoaTkxNSk7CiAJ
aWYgKHJldCkKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gcmUtZW5hYmxlIEdHVFRcbiIpOwogCi0J
aW50ZWxfY3NyX3Vjb2RlX3Jlc3VtZShkZXZfcHJpdik7CisJaW50ZWxfY3NyX3Vjb2RlX3Jlc3Vt
ZShpOTE1KTsKIAotCWk5MTVfcmVzdG9yZV9zdGF0ZShkZXZfcHJpdik7Ci0JaW50ZWxfcHBzX3Vu
bG9ja19yZWdzX3dhKGRldl9wcml2KTsKKwlpOTE1X3Jlc3RvcmVfc3RhdGUoaTkxNSk7CisJaW50
ZWxfcHBzX3VubG9ja19yZWdzX3dhKGk5MTUpOwogCi0JaW50ZWxfaW5pdF9wY2hfcmVmY2xrKGRl
dl9wcml2KTsKKwlpbnRlbF9pbml0X3BjaF9yZWZjbGsoaTkxNSk7CiAKIAkvKgogCSAqIEludGVy
cnVwdHMgaGF2ZSB0byBiZSBlbmFibGVkIGJlZm9yZSBhbnkgYmF0Y2hlcyBhcmUgcnVuLiBJZiBu
b3QgdGhlCkBAIC0yMjQxLDIxICsyMjQxLDIxIEBAIHN0YXRpYyBpbnQgaTkxNV9kcm1fcmVzdW1l
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJICogTW9kZXNldCBlbmFibGluZyBpbiBpbnRlbF9t
b2Rlc2V0X2luaXRfaHcoKSBhbHNvIG5lZWRzIHdvcmtpbmcKIAkgKiBpbnRlcnJ1cHRzLgogCSAq
LwotCWludGVsX3J1bnRpbWVfcG1fZW5hYmxlX2ludGVycnVwdHMoZGV2X3ByaXYpOworCWludGVs
X3J1bnRpbWVfcG1fZW5hYmxlX2ludGVycnVwdHMoaTkxNSk7CiAKIAlkcm1fbW9kZV9jb25maWdf
cmVzZXQoZGV2KTsKIAotCWk5MTVfZ2VtX3Jlc3VtZShkZXZfcHJpdik7CisJaTkxNV9nZW1fcmVz
dW1lKGk5MTUpOwogCiAJaW50ZWxfbW9kZXNldF9pbml0X2h3KGRldik7Ci0JaW50ZWxfaW5pdF9j
bG9ja19nYXRpbmcoZGV2X3ByaXYpOworCWludGVsX2luaXRfY2xvY2tfZ2F0aW5nKGk5MTUpOwog
Ci0Jc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlpZiAoZGV2X3ByaXYtPmRp
c3BsYXkuaHBkX2lycV9zZXR1cCkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaHBkX2lycV9zZXR1cChk
ZXZfcHJpdik7Ci0Jc3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNwaW5f
bG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKKwlpZiAoaTkxNS0+ZGlzcGxheS5ocGRfaXJxX3Nl
dHVwKQorCQlpOTE1LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXAoaTkxNSk7CisJc3Bpbl91bmxvY2tf
aXJxKCZpOTE1LT5pcnFfbG9jayk7CiAKLQlpbnRlbF9kcF9tc3RfcmVzdW1lKGRldl9wcml2KTsK
KwlpbnRlbF9kcF9tc3RfcmVzdW1lKGk5MTUpOwogCiAJaW50ZWxfZGlzcGxheV9yZXN1bWUoZGV2
KTsKIApAQCAtMjI2NywyMyArMjI2NywyMyBAQCBzdGF0aWMgaW50IGk5MTVfZHJtX3Jlc3VtZShz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCSAqIGJvdGhlciB3aXRoIHRoZSB0aW55IHJhY2UgaGVy
ZSB3aGVyZSB3ZSBtaWdodCBsb3NlIGhvdHBsdWcKIAkgKiBub3RpZmljYXRpb25zLgogCSAqICov
Ci0JaW50ZWxfaHBkX2luaXQoZGV2X3ByaXYpOworCWludGVsX2hwZF9pbml0KGk5MTUpOwogCi0J
aW50ZWxfb3ByZWdpb25fcmVzdW1lKGRldl9wcml2KTsKKwlpbnRlbF9vcHJlZ2lvbl9yZXN1bWUo
aTkxNSk7CiAKIAlpbnRlbF9mYmRldl9zZXRfc3VzcGVuZChkZXYsIEZCSU5GT19TVEFURV9SVU5O
SU5HLCBmYWxzZSk7CiAKLQlpbnRlbF9wb3dlcl9kb21haW5zX2VuYWJsZShkZXZfcHJpdik7CisJ
aW50ZWxfcG93ZXJfZG9tYWluc19lbmFibGUoaTkxNSk7CiAKLQllbmFibGVfcnBtX3dha2VyZWZf
YXNzZXJ0cyhkZXZfcHJpdik7CisJZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAK
IAlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBpOTE1X2RybV9yZXN1bWVfZWFybHkoc3RydWN0
IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZfcHJpdi0+ZHJtLnBk
ZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsKIAlpbnQgcmV0OwogCiAJLyoKQEAg
LTIzMzAsMzIgKzIzMzAsMzIgQEAgc3RhdGljIGludCBpOTE1X2RybV9yZXN1bWVfZWFybHkoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldikKIAogCXBjaV9zZXRfbWFzdGVyKHBkZXYpOwogCi0JZGlzYWJs
ZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwlkaXNhYmxlX3JwbV93YWtlcmVmX2Fz
c2VydHMoaTkxNSk7CiAKLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZ
VklFVyhkZXZfcHJpdikpCi0JCXJldCA9IHZsdl9yZXN1bWVfcHJlcGFyZShkZXZfcHJpdiwgZmFs
c2UpOworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpCisJ
CXJldCA9IHZsdl9yZXN1bWVfcHJlcGFyZShpOTE1LCBmYWxzZSk7CiAJaWYgKHJldCkKIAkJRFJN
X0VSUk9SKCJSZXN1bWUgcHJlcGFyZSBmYWlsZWQ6ICVkLCBjb250aW51aW5nIGFueXdheVxuIiwK
IAkJCSAgcmV0KTsKIAotCWludGVsX3VuY29yZV9yZXN1bWVfZWFybHkoJmRldl9wcml2LT51bmNv
cmUpOworCWludGVsX3VuY29yZV9yZXN1bWVfZWFybHkoJmk5MTUtPnVuY29yZSk7CiAKLQlpOTE1
X2NoZWNrX2FuZF9jbGVhcl9mYXVsdHMoZGV2X3ByaXYpOworCWk5MTVfY2hlY2tfYW5kX2NsZWFy
X2ZhdWx0cyhpOTE1KTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExIHx8IElTX0dF
TjlfTFAoZGV2X3ByaXYpKSB7Ci0JCWdlbjlfc2FuaXRpemVfZGNfc3RhdGUoZGV2X3ByaXYpOwot
CQlieHRfZGlzYWJsZV9kYzkoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSVNfSEFTV0VMTChkZXZf
cHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkgewotCQloc3dfZGlzYWJsZV9wYzgoZGV2
X3ByaXYpOworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEgfHwgSVNfR0VOOV9MUChpOTE1KSkg
eworCQlnZW45X3Nhbml0aXplX2RjX3N0YXRlKGk5MTUpOworCQlieHRfZGlzYWJsZV9kYzkoaTkx
NSk7CisJfSBlbHNlIGlmIChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FEV0VMTChpOTE1KSkg
eworCQloc3dfZGlzYWJsZV9wYzgoaTkxNSk7CiAJfQogCi0JaW50ZWxfdW5jb3JlX3Nhbml0aXpl
KGRldl9wcml2KTsKKwlpbnRlbF91bmNvcmVfc2FuaXRpemUoaTkxNSk7CiAKLQlpbnRlbF9wb3dl
cl9kb21haW5zX3Jlc3VtZShkZXZfcHJpdik7CisJaW50ZWxfcG93ZXJfZG9tYWluc19yZXN1bWUo
aTkxNSk7CiAKLQlpbnRlbF9ndF9zYW5pdGl6ZShkZXZfcHJpdiwgdHJ1ZSk7CisJaW50ZWxfZ3Rf
c2FuaXRpemUoaTkxNSwgdHJ1ZSk7CiAKLQllbmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZf
cHJpdik7CisJZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAKIAlyZXR1cm4gcmV0
OwogfQpAQCAtMjU0MCw5ICsyNTQwLDkgQEAgc3RhdGljIGludCBpOTE1X3BtX3Jlc3RvcmUoc3Ry
dWN0IGRldmljZSAqa2RldikKICAqIGEgYmxhY2stYm94IGZvciB0aGUgZHJpdmVyLiBGdXJ0aGVy
IGludmVzdGlnYXRpb24gaXMgbmVlZGVkIHRvIHJlZHVjZSB0aGUKICAqIHNhdmVkL3Jlc3RvcmVk
IHJlZ2lzdGVycyBldmVuIGZ1cnRoZXIsIGJ5IGZvbGxvd2luZyB0aGUgc2FtZSAzIGNyaXRlcmlh
LgogICovCi1zdGF0aWMgdm9pZCB2bHZfc2F2ZV9ndW5pdF9zMGl4X3N0YXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHZsdl9zYXZlX2d1bml0X3MwaXhf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IHZsdl9zMGl4
X3N0YXRlICpzID0gJmRldl9wcml2LT52bHZfczBpeF9zdGF0ZTsKKwlzdHJ1Y3Qgdmx2X3MwaXhf
c3RhdGUgKnMgPSAmaTkxNS0+dmx2X3MwaXhfc3RhdGU7CiAJaW50IGk7CiAKIAkvKiBHQU0gMHg0
MDAwLTB4NDc3MCAqLwpAQCAtMjYyMSw5ICsyNjIxLDkgQEAgc3RhdGljIHZvaWQgdmx2X3NhdmVf
Z3VuaXRfczBpeF9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICov
CiB9CiAKLXN0YXRpYyB2b2lkIHZsdl9yZXN0b3JlX2d1bml0X3MwaXhfc3RhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmx2X3Jlc3RvcmVfZ3VuaXRf
czBpeF9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qgdmx2
X3MwaXhfc3RhdGUgKnMgPSAmZGV2X3ByaXYtPnZsdl9zMGl4X3N0YXRlOworCXN0cnVjdCB2bHZf
czBpeF9zdGF0ZSAqcyA9ICZpOTE1LT52bHZfczBpeF9zdGF0ZTsKIAl1MzIgdmFsOwogCWludCBp
OwogCkBAIC0yNzMyLDcgKzI3MzIsNyBAQCBzdGF0aWMgaW50IHZsdl93YWl0X2Zvcl9wd19zdGF0
dXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIHJldDsKIH0KIAotaW50
IHZsdl9mb3JjZV9nZnhfY2xvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBi
b29sIGZvcmNlX29uKQoraW50IHZsdl9mb3JjZV9nZnhfY2xvY2soc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIGJvb2wgZm9yY2Vfb24pCiB7CiAJdTMyIHZhbDsKIAlpbnQgZXJyOwpAQCAt
Mjc0Niw3ICsyNzQ2LDcgQEAgaW50IHZsdl9mb3JjZV9nZnhfY2xvY2soc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBib29sIGZvcmNlX29uKQogCWlmICghZm9yY2Vfb24pCiAJCXJl
dHVybiAwOwogCi0JZXJyID0gaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNv
cmUsCisJZXJyID0gaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkg
ICAgICBWTFZfR1RMQ19TVVJWSVZBQklMSVRZX1JFRywKIAkJCQkgICAgICBWTFZfR0ZYX0NMS19T
VEFUVVNfQklULAogCQkJCSAgICAgIFZMVl9HRlhfQ0xLX1NUQVRVU19CSVQsCkBAIC0yNzU4LDcg
KzI3NTgsNyBAQCBpbnQgdmx2X2ZvcmNlX2dmeF9jbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIGJvb2wgZm9yY2Vfb24pCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGlu
dCB2bHZfYWxsb3dfZ3Rfd2FrZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJv
b2wgYWxsb3cpCitzdGF0aWMgaW50IHZsdl9hbGxvd19ndF93YWtlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LCBib29sIGFsbG93KQogewogCXUzMiBtYXNrOwogCXUzMiB2YWw7CkBAIC0y
Nzc0LDE0ICsyNzc0LDE0IEBAIHN0YXRpYyBpbnQgdmx2X2FsbG93X2d0X3dha2Uoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIGFsbG93KQogCW1hc2sgPSBWTFZfR1RMQ19B
TExPV1dBS0VBQ0s7CiAJdmFsID0gYWxsb3cgPyBtYXNrIDogMDsKIAotCWVyciA9IHZsdl93YWl0
X2Zvcl9wd19zdGF0dXMoZGV2X3ByaXYsIG1hc2ssIHZhbCk7CisJZXJyID0gdmx2X3dhaXRfZm9y
X3B3X3N0YXR1cyhpOTE1LCBtYXNrLCB2YWwpOwogCWlmIChlcnIpCiAJCURSTV9FUlJPUigidGlt
ZW91dCBkaXNhYmxpbmcgR1Qgd2FraW5nXG4iKTsKIAogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRp
YyB2b2lkIHZsdl93YWl0X2Zvcl9ndF93ZWxscyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCB2bHZfd2FpdF9mb3JfZ3Rfd2VsbHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJICBib29sIHdhaXRfZm9yX29uKQogewogCXUzMiBtYXNrOwpA
QCAtMjc5NywxMiArMjc5NywxMiBAQCBzdGF0aWMgdm9pZCB2bHZfd2FpdF9mb3JfZ3Rfd2VsbHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIFRoaXMgY2FuIGZhaWwgdG8g
dHVybiBvZmYgdGhlIHJjNiBpZiB0aGUgR1BVIGlzIHN0dWNrIGFmdGVyIGEgZmFpbGVkCiAJICog
cmVzZXQgYW5kIHdlIGFyZSB0cnlpbmcgdG8gZm9yY2UgdGhlIG1hY2hpbmUgdG8gc2xlZXAuCiAJ
ICovCi0JaWYgKHZsdl93YWl0X2Zvcl9wd19zdGF0dXMoZGV2X3ByaXYsIG1hc2ssIHZhbCkpCisJ
aWYgKHZsdl93YWl0X2Zvcl9wd19zdGF0dXMoaTkxNSwgbWFzaywgdmFsKSkKIAkJRFJNX0RFQlVH
X0RSSVZFUigidGltZW91dCB3YWl0aW5nIGZvciBHVCB3ZWxscyB0byBnbyAlc1xuIiwKIAkJCQkg
b25vZmYod2FpdF9mb3Jfb24pKTsKIH0KIAotc3RhdGljIHZvaWQgdmx2X2NoZWNrX25vX2d0X2Fj
Y2VzcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB2bHZf
Y2hlY2tfbm9fZ3RfYWNjZXNzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWlm
ICghKEk5MTVfUkVBRChWTFZfR1RMQ19QV19TVEFUVVMpICYgVkxWX0dUTENfQUxMT1dXQUtFRVJS
KSkKIAkJcmV0dXJuOwpAQCAtMjgxMSw3ICsyODExLDcgQEAgc3RhdGljIHZvaWQgdmx2X2NoZWNr
X25vX2d0X2FjY2VzcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkxNV9X
UklURShWTFZfR1RMQ19QV19TVEFUVVMsIFZMVl9HVExDX0FMTE9XV0FLRUVSUik7CiB9CiAKLXN0
YXRpYyBpbnQgdmx2X3N1c3BlbmRfY29tcGxldGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIGludCB2bHZfc3VzcGVuZF9jb21wbGV0ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgbWFzazsKIAlpbnQgZXJyOwpAQCAtMjgyMCwyNSArMjgy
MCwyNSBAQCBzdGF0aWMgaW50IHZsdl9zdXNwZW5kX2NvbXBsZXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAkgKiBCc3BlYyBkZWZpbmVzIHRoZSBmb2xsb3dpbmcgR1Qgd2Vs
bCBvbiBmbGFncyBhcyBkZWJ1ZyBvbmx5LCBzbwogCSAqIGRvbid0IHRyZWF0IHRoZW0gYXMgaGFy
ZCBmYWlsdXJlcy4KIAkgKi8KLQl2bHZfd2FpdF9mb3JfZ3Rfd2VsbHMoZGV2X3ByaXYsIGZhbHNl
KTsKKwl2bHZfd2FpdF9mb3JfZ3Rfd2VsbHMoaTkxNSwgZmFsc2UpOwogCiAJbWFzayA9IFZMVl9H
VExDX1JFTkRFUl9DVFhfRVhJU1RTIHwgVkxWX0dUTENfTUVESUFfQ1RYX0VYSVNUUzsKIAlXQVJO
X09OKChJOTE1X1JFQUQoVkxWX0dUTENfV0FLRV9DVFJMKSAmIG1hc2spICE9IG1hc2spOwogCi0J
dmx2X2NoZWNrX25vX2d0X2FjY2VzcyhkZXZfcHJpdik7CisJdmx2X2NoZWNrX25vX2d0X2FjY2Vz
cyhpOTE1KTsKIAotCWVyciA9IHZsdl9mb3JjZV9nZnhfY2xvY2soZGV2X3ByaXYsIHRydWUpOwor
CWVyciA9IHZsdl9mb3JjZV9nZnhfY2xvY2soaTkxNSwgdHJ1ZSk7CiAJaWYgKGVycikKIAkJZ290
byBlcnIxOwogCi0JZXJyID0gdmx2X2FsbG93X2d0X3dha2UoZGV2X3ByaXYsIGZhbHNlKTsKKwll
cnIgPSB2bHZfYWxsb3dfZ3Rfd2FrZShpOTE1LCBmYWxzZSk7CiAJaWYgKGVycikKIAkJZ290byBl
cnIyOwogCi0JaWYgKCFJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJdmx2X3NhdmVfZ3VuaXRf
czBpeF9zdGF0ZShkZXZfcHJpdik7CisJaWYgKCFJU19DSEVSUllWSUVXKGk5MTUpKQorCQl2bHZf
c2F2ZV9ndW5pdF9zMGl4X3N0YXRlKGk5MTUpOwogCi0JZXJyID0gdmx2X2ZvcmNlX2dmeF9jbG9j
ayhkZXZfcHJpdiwgZmFsc2UpOworCWVyciA9IHZsdl9mb3JjZV9nZnhfY2xvY2soaTkxNSwgZmFs
c2UpOwogCWlmIChlcnIpCiAJCWdvdG8gZXJyMjsKIApAQCAtMjg0NiwxNCArMjg0NiwxNCBAQCBz
dGF0aWMgaW50IHZsdl9zdXNwZW5kX2NvbXBsZXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAogZXJyMjoKIAkvKiBGb3Igc2FmZXR5IGFsd2F5cyByZS1lbmFibGUgd2FraW5n
IGFuZCBkaXNhYmxlIGdmeCBjbG9jayBmb3JjaW5nICovCi0Jdmx2X2FsbG93X2d0X3dha2UoZGV2
X3ByaXYsIHRydWUpOworCXZsdl9hbGxvd19ndF93YWtlKGk5MTUsIHRydWUpOwogZXJyMToKLQl2
bHZfZm9yY2VfZ2Z4X2Nsb2NrKGRldl9wcml2LCBmYWxzZSk7CisJdmx2X2ZvcmNlX2dmeF9jbG9j
ayhpOTE1LCBmYWxzZSk7CiAKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IHZsdl9yZXN1
bWVfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgaW50
IHZsdl9yZXN1bWVfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQli
b29sIHJwbV9yZXN1bWUpCiB7CiAJaW50IGVycjsKQEAgLTI4NjQsMjMgKzI4NjQsMjMgQEAgc3Rh
dGljIGludCB2bHZfcmVzdW1lX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCSAqIGNhbiBkbyBhdCB0aGlzIHBvaW50LiBSZXR1cm4gdGhlIGZpcnN0IGVycm9yIGNv
ZGUgKHdoaWNoIHdpbGwgYWxzbwogCSAqIGxlYXZlIFJQTSBwZXJtYW5lbnRseSBkaXNhYmxlZCku
CiAJICovCi0JcmV0ID0gdmx2X2ZvcmNlX2dmeF9jbG9jayhkZXZfcHJpdiwgdHJ1ZSk7CisJcmV0
ID0gdmx2X2ZvcmNlX2dmeF9jbG9jayhpOTE1LCB0cnVlKTsKIAotCWlmICghSVNfQ0hFUlJZVklF
VyhkZXZfcHJpdikpCi0JCXZsdl9yZXN0b3JlX2d1bml0X3MwaXhfc3RhdGUoZGV2X3ByaXYpOwor
CWlmICghSVNfQ0hFUlJZVklFVyhpOTE1KSkKKwkJdmx2X3Jlc3RvcmVfZ3VuaXRfczBpeF9zdGF0
ZShpOTE1KTsKIAotCWVyciA9IHZsdl9hbGxvd19ndF93YWtlKGRldl9wcml2LCB0cnVlKTsKKwll
cnIgPSB2bHZfYWxsb3dfZ3Rfd2FrZShpOTE1LCB0cnVlKTsKIAlpZiAoIXJldCkKIAkJcmV0ID0g
ZXJyOwogCi0JZXJyID0gdmx2X2ZvcmNlX2dmeF9jbG9jayhkZXZfcHJpdiwgZmFsc2UpOworCWVy
ciA9IHZsdl9mb3JjZV9nZnhfY2xvY2soaTkxNSwgZmFsc2UpOwogCWlmICghcmV0KQogCQlyZXQg
PSBlcnI7CiAKLQl2bHZfY2hlY2tfbm9fZ3RfYWNjZXNzKGRldl9wcml2KTsKKwl2bHZfY2hlY2tf
bm9fZ3RfYWNjZXNzKGk5MTUpOwogCiAJaWYgKHJwbV9yZXN1bWUpCi0JCWludGVsX2luaXRfY2xv
Y2tfZ2F0aW5nKGRldl9wcml2KTsKKwkJaW50ZWxfaW5pdF9jbG9ja19nYXRpbmcoaTkxNSk7CiAK
IAlyZXR1cm4gcmV0OwogfQpAQCAtMjg4OSw4MCArMjg4OSw4MCBAQCBzdGF0aWMgaW50IGludGVs
X3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICprZGV2KQogewogCXN0cnVjdCBwY2lfZGV2
ICpwZGV2ID0gdG9fcGNpX2RldihrZGV2KTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gcGNp
X2dldF9kcnZkYXRhKHBkZXYpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
ZGV2KTsKIAlpbnQgcmV0OwogCi0JaWYgKFdBUk5fT05fT05DRSghKGRldl9wcml2LT5ndF9wbS5y
YzYuZW5hYmxlZCAmJiBIQVNfUkM2KGRldl9wcml2KSkpKQorCWlmIChXQVJOX09OX09OQ0UoIShp
OTE1LT5ndF9wbS5yYzYuZW5hYmxlZCAmJiBIQVNfUkM2KGk5MTUpKSkpCiAJCXJldHVybiAtRU5P
REVWOwogCi0JaWYgKFdBUk5fT05fT05DRSghSEFTX1JVTlRJTUVfUE0oZGV2X3ByaXYpKSkKKwlp
ZiAoV0FSTl9PTl9PTkNFKCFIQVNfUlVOVElNRV9QTShpOTE1KSkpCiAJCXJldHVybiAtRU5PREVW
OwogCiAJRFJNX0RFQlVHX0tNUygiU3VzcGVuZGluZyBkZXZpY2VcbiIpOwogCi0JZGlzYWJsZV9y
cG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwlkaXNhYmxlX3JwbV93YWtlcmVmX2Fzc2Vy
dHMoaTkxNSk7CiAKIAkvKgogCSAqIFdlIGFyZSBzYWZlIGhlcmUgYWdhaW5zdCByZS1mYXVsdHMs
IHNpbmNlIHRoZSBmYXVsdCBoYW5kbGVyIHRha2VzCiAJICogYW4gUlBNIHJlZmVyZW5jZS4KIAkg
Ki8KLQlpOTE1X2dlbV9ydW50aW1lX3N1c3BlbmQoZGV2X3ByaXYpOworCWk5MTVfZ2VtX3J1bnRp
bWVfc3VzcGVuZChpOTE1KTsKIAotCWludGVsX3VjX3J1bnRpbWVfc3VzcGVuZChkZXZfcHJpdik7
CisJaW50ZWxfdWNfcnVudGltZV9zdXNwZW5kKGk5MTUpOwogCi0JaW50ZWxfcnVudGltZV9wbV9k
aXNhYmxlX2ludGVycnVwdHMoZGV2X3ByaXYpOworCWludGVsX3J1bnRpbWVfcG1fZGlzYWJsZV9p
bnRlcnJ1cHRzKGk5MTUpOwogCi0JaW50ZWxfdW5jb3JlX3N1c3BlbmQoJmRldl9wcml2LT51bmNv
cmUpOworCWludGVsX3VuY29yZV9zdXNwZW5kKCZpOTE1LT51bmNvcmUpOwogCiAJcmV0ID0gMDsK
LQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlpY2xfZGlzcGxheV9jb3JlX3Vu
aW5pdChkZXZfcHJpdik7Ci0JCWJ4dF9lbmFibGVfZGM5KGRldl9wcml2KTsKLQl9IGVsc2UgaWYg
KElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7Ci0JCWJ4dF9kaXNwbGF5X2NvcmVfdW5pbml0KGRldl9w
cml2KTsKLQkJYnh0X2VuYWJsZV9kYzkoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSVNfSEFTV0VM
TChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkgewotCQloc3dfZW5hYmxlX3Bj
OChkZXZfcHJpdik7Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19D
SEVSUllWSUVXKGRldl9wcml2KSkgewotCQlyZXQgPSB2bHZfc3VzcGVuZF9jb21wbGV0ZShkZXZf
cHJpdik7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgeworCQlpY2xfZGlzcGxheV9jb3Jl
X3VuaW5pdChpOTE1KTsKKwkJYnh0X2VuYWJsZV9kYzkoaTkxNSk7CisJfSBlbHNlIGlmIChJU19H
RU45X0xQKGk5MTUpKSB7CisJCWJ4dF9kaXNwbGF5X2NvcmVfdW5pbml0KGk5MTUpOworCQlieHRf
ZW5hYmxlX2RjOShpOTE1KTsKKwl9IGVsc2UgaWYgKElTX0hBU1dFTEwoaTkxNSkgfHwgSVNfQlJP
QURXRUxMKGk5MTUpKSB7CisJCWhzd19lbmFibGVfcGM4KGk5MTUpOworCX0gZWxzZSBpZiAoSVNf
VkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSB7CisJCXJldCA9IHZsdl9z
dXNwZW5kX2NvbXBsZXRlKGk5MTUpOwogCX0KIAogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJS
dW50aW1lIHN1c3BlbmQgZmFpbGVkLCBkaXNhYmxpbmcgaXQgKCVkKVxuIiwgcmV0KTsKLQkJaW50
ZWxfdW5jb3JlX3J1bnRpbWVfcmVzdW1lKCZkZXZfcHJpdi0+dW5jb3JlKTsKKwkJaW50ZWxfdW5j
b3JlX3J1bnRpbWVfcmVzdW1lKCZpOTE1LT51bmNvcmUpOwogCi0JCWludGVsX3J1bnRpbWVfcG1f
ZW5hYmxlX2ludGVycnVwdHMoZGV2X3ByaXYpOworCQlpbnRlbF9ydW50aW1lX3BtX2VuYWJsZV9p
bnRlcnJ1cHRzKGk5MTUpOwogCi0JCWludGVsX3VjX3Jlc3VtZShkZXZfcHJpdik7CisJCWludGVs
X3VjX3Jlc3VtZShpOTE1KTsKIAotCQlpOTE1X2dlbV9pbml0X3N3aXp6bGluZyhkZXZfcHJpdik7
Ci0JCWk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzKGRldl9wcml2KTsKKwkJaTkxNV9nZW1faW5pdF9z
d2l6emxpbmcoaTkxNSk7CisJCWk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzKGk5MTUpOwogCi0JCWVu
YWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwkJZW5hYmxlX3JwbV93YWtlcmVm
X2Fzc2VydHMoaTkxNSk7CiAKIAkJcmV0dXJuIHJldDsKIAl9CiAKLQllbmFibGVfcnBtX3dha2Vy
ZWZfYXNzZXJ0cyhkZXZfcHJpdik7Ci0JaW50ZWxfcnVudGltZV9wbV9jbGVhbnVwKGRldl9wcml2
KTsKKwllbmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhpOTE1KTsKKwlpbnRlbF9ydW50aW1lX3Bt
X2NsZWFudXAoaTkxNSk7CiAKLQlpZiAoaW50ZWxfdW5jb3JlX2FybV91bmNsYWltZWRfbW1pb19k
ZXRlY3Rpb24oJmRldl9wcml2LT51bmNvcmUpKQorCWlmIChpbnRlbF91bmNvcmVfYXJtX3VuY2xh
aW1lZF9tbWlvX2RldGVjdGlvbigmaTkxNS0+dW5jb3JlKSkKIAkJRFJNX0VSUk9SKCJVbmNsYWlt
ZWQgYWNjZXNzIGRldGVjdGVkIHByaW9yIHRvIHN1c3BlbmRpbmdcbiIpOwogCi0JZGV2X3ByaXYt
PnJ1bnRpbWVfcG0uc3VzcGVuZGVkID0gdHJ1ZTsKKwlpOTE1LT5ydW50aW1lX3BtLnN1c3BlbmRl
ZCA9IHRydWU7CiAKIAkvKgogCSAqIEZJWE1FOiBXZSByZWFsbHkgc2hvdWxkIGZpbmQgYSBkb2N1
bWVudCB0aGF0IHJlZmVyZW5jZXMgdGhlIGFyZ3VtZW50cwogCSAqIHVzZWQgYmVsb3chCiAJICov
Ci0JaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKKwlpZiAoSVNfQlJPQURXRUxMKGk5MTUp
KSB7CiAJCS8qCiAJCSAqIE9uIEJyb2Fkd2VsbCwgaWYgd2UgdXNlIFBDSV9EMSB0aGUgUENIIERE
SSBwb3J0cyB3aWxsIHN0b3AKIAkJICogYmVpbmcgZGV0ZWN0ZWQsIGFuZCB0aGUgY2FsbCB3ZSBk
byBhdCBpbnRlbF9ydW50aW1lX3Jlc3VtZSgpCiAJCSAqIHdvbid0IGJlIGFibGUgdG8gcmVzdG9y
ZSB0aGVtLiBTaW5jZSBQQ0lfRDNob3QgbWF0Y2hlcyB0aGUKIAkJICogYWN0dWFsIHNwZWNpZmlj
YXRpb24gYW5kIGFwcGVhcnMgdG8gYmUgd29ya2luZywgdXNlIGl0LgogCQkgKi8KLQkJaW50ZWxf
b3ByZWdpb25fbm90aWZ5X2FkYXB0ZXIoZGV2X3ByaXYsIFBDSV9EM2hvdCk7CisJCWludGVsX29w
cmVnaW9uX25vdGlmeV9hZGFwdGVyKGk5MTUsIFBDSV9EM2hvdCk7CiAJfSBlbHNlIHsKIAkJLyoK
IAkJICogY3VycmVudCB2ZXJzaW9ucyBvZiBmaXJtd2FyZSB3aGljaCBkZXBlbmQgb24gdGhpcyBv
cHJlZ2lvbgpAQCAtMjk3MSwxMyArMjk3MSwxMyBAQCBzdGF0aWMgaW50IGludGVsX3J1bnRpbWVf
c3VzcGVuZChzdHJ1Y3QgZGV2aWNlICprZGV2KQogCQkgKiB0byBkaXN0aW5ndWlzaCBpdCBmcm9t
IG5vdGlmaWNhdGlvbnMgdGhhdCBtaWdodCBiZSBzZW50IHZpYQogCQkgKiB0aGUgc3VzcGVuZCBw
YXRoLgogCQkgKi8KLQkJaW50ZWxfb3ByZWdpb25fbm90aWZ5X2FkYXB0ZXIoZGV2X3ByaXYsIFBD
SV9EMSk7CisJCWludGVsX29wcmVnaW9uX25vdGlmeV9hZGFwdGVyKGk5MTUsIFBDSV9EMSk7CiAJ
fQogCi0JYXNzZXJ0X2ZvcmNld2FrZXNfaW5hY3RpdmUoJmRldl9wcml2LT51bmNvcmUpOworCWFz
c2VydF9mb3JjZXdha2VzX2luYWN0aXZlKCZpOTE1LT51bmNvcmUpOwogCi0JaWYgKCFJU19WQUxM
RVlWSUVXKGRldl9wcml2KSAmJiAhSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCWludGVsX2hw
ZF9wb2xsX2luaXQoZGV2X3ByaXYpOworCWlmICghSVNfVkFMTEVZVklFVyhpOTE1KSAmJiAhSVNf
Q0hFUlJZVklFVyhpOTE1KSkKKwkJaW50ZWxfaHBkX3BvbGxfaW5pdChpOTE1KTsKIAogCURSTV9E
RUJVR19LTVMoIkRldmljZSBzdXNwZW5kZWRcbiIpOwogCXJldHVybiAwOwpAQCAtMjk4Nyw2OSAr
Mjk4Nyw2OSBAQCBzdGF0aWMgaW50IGludGVsX3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2Ug
KmtkZXYpCiB7CiAJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSB0b19wY2lfZGV2KGtkZXYpOwogCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBwY2lfZ2V0X2RydmRhdGEocGRldik7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWludCByZXQgPSAwOwogCi0JaWYgKFdB
Uk5fT05fT05DRSghSEFTX1JVTlRJTUVfUE0oZGV2X3ByaXYpKSkKKwlpZiAoV0FSTl9PTl9PTkNF
KCFIQVNfUlVOVElNRV9QTShpOTE1KSkpCiAJCXJldHVybiAtRU5PREVWOwogCiAJRFJNX0RFQlVH
X0tNUygiUmVzdW1pbmcgZGV2aWNlXG4iKTsKIAotCVdBUk5fT05fT05DRShhdG9taWNfcmVhZCgm
ZGV2X3ByaXYtPnJ1bnRpbWVfcG0ud2FrZXJlZl9jb3VudCkpOwotCWRpc2FibGVfcnBtX3dha2Vy
ZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJV0FSTl9PTl9PTkNFKGF0b21pY19yZWFkKCZpOTE1LT5y
dW50aW1lX3BtLndha2VyZWZfY291bnQpKTsKKwlkaXNhYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMo
aTkxNSk7CiAKLQlpbnRlbF9vcHJlZ2lvbl9ub3RpZnlfYWRhcHRlcihkZXZfcHJpdiwgUENJX0Qw
KTsKLQlkZXZfcHJpdi0+cnVudGltZV9wbS5zdXNwZW5kZWQgPSBmYWxzZTsKLQlpZiAoaW50ZWxf
dW5jb3JlX3VuY2xhaW1lZF9tbWlvKCZkZXZfcHJpdi0+dW5jb3JlKSkKKwlpbnRlbF9vcHJlZ2lv
bl9ub3RpZnlfYWRhcHRlcihpOTE1LCBQQ0lfRDApOworCWk5MTUtPnJ1bnRpbWVfcG0uc3VzcGVu
ZGVkID0gZmFsc2U7CisJaWYgKGludGVsX3VuY29yZV91bmNsYWltZWRfbW1pbygmaTkxNS0+dW5j
b3JlKSkKIAkJRFJNX0RFQlVHX0RSSVZFUigiVW5jbGFpbWVkIGFjY2VzcyBkdXJpbmcgc3VzcGVu
ZCwgYmlvcz9cbiIpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKLQkJYnh0
X2Rpc2FibGVfZGM5KGRldl9wcml2KTsKLQkJaWNsX2Rpc3BsYXlfY29yZV9pbml0KGRldl9wcml2
LCB0cnVlKTsKLQkJaWYgKGRldl9wcml2LT5jc3IuZG1jX3BheWxvYWQpIHsKLQkJCWlmIChkZXZf
cHJpdi0+Y3NyLmFsbG93ZWRfZGNfbWFzayAmCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkg
eworCQlieHRfZGlzYWJsZV9kYzkoaTkxNSk7CisJCWljbF9kaXNwbGF5X2NvcmVfaW5pdChpOTE1
LCB0cnVlKTsKKwkJaWYgKGk5MTUtPmNzci5kbWNfcGF5bG9hZCkgeworCQkJaWYgKGk5MTUtPmNz
ci5hbGxvd2VkX2RjX21hc2sgJgogCQkJICAgIERDX1NUQVRFX0VOX1VQVE9fREM2KQotCQkJCXNr
bF9lbmFibGVfZGM2KGRldl9wcml2KTsKLQkJCWVsc2UgaWYgKGRldl9wcml2LT5jc3IuYWxsb3dl
ZF9kY19tYXNrICYKKwkJCQlza2xfZW5hYmxlX2RjNihpOTE1KTsKKwkJCWVsc2UgaWYgKGk5MTUt
PmNzci5hbGxvd2VkX2RjX21hc2sgJgogCQkJCSBEQ19TVEFURV9FTl9VUFRPX0RDNSkKLQkJCQln
ZW45X2VuYWJsZV9kYzUoZGV2X3ByaXYpOworCQkJCWdlbjlfZW5hYmxlX2RjNShpOTE1KTsKIAkJ
fQotCX0gZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKLQkJYnh0X2Rpc2FibGVfZGM5
KGRldl9wcml2KTsKLQkJYnh0X2Rpc3BsYXlfY29yZV9pbml0KGRldl9wcml2LCB0cnVlKTsKLQkJ
aWYgKGRldl9wcml2LT5jc3IuZG1jX3BheWxvYWQgJiYKLQkJICAgIChkZXZfcHJpdi0+Y3NyLmFs
bG93ZWRfZGNfbWFzayAmIERDX1NUQVRFX0VOX1VQVE9fREM1KSkKLQkJCWdlbjlfZW5hYmxlX2Rj
NShkZXZfcHJpdik7Ci0JfSBlbHNlIGlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9B
RFdFTEwoZGV2X3ByaXYpKSB7Ci0JCWhzd19kaXNhYmxlX3BjOChkZXZfcHJpdik7Ci0JfSBlbHNl
IGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkg
ewotCQlyZXQgPSB2bHZfcmVzdW1lX3ByZXBhcmUoZGV2X3ByaXYsIHRydWUpOworCX0gZWxzZSBp
ZiAoSVNfR0VOOV9MUChpOTE1KSkgeworCQlieHRfZGlzYWJsZV9kYzkoaTkxNSk7CisJCWJ4dF9k
aXNwbGF5X2NvcmVfaW5pdChpOTE1LCB0cnVlKTsKKwkJaWYgKGk5MTUtPmNzci5kbWNfcGF5bG9h
ZCAmJgorCQkgICAgKGk5MTUtPmNzci5hbGxvd2VkX2RjX21hc2sgJiBEQ19TVEFURV9FTl9VUFRP
X0RDNSkpCisJCQlnZW45X2VuYWJsZV9kYzUoaTkxNSk7CisJfSBlbHNlIGlmIChJU19IQVNXRUxM
KGk5MTUpIHx8IElTX0JST0FEV0VMTChpOTE1KSkgeworCQloc3dfZGlzYWJsZV9wYzgoaTkxNSk7
CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkp
IHsKKwkJcmV0ID0gdmx2X3Jlc3VtZV9wcmVwYXJlKGk5MTUsIHRydWUpOwogCX0KIAotCWludGVs
X3VuY29yZV9ydW50aW1lX3Jlc3VtZSgmZGV2X3ByaXYtPnVuY29yZSk7CisJaW50ZWxfdW5jb3Jl
X3J1bnRpbWVfcmVzdW1lKCZpOTE1LT51bmNvcmUpOwogCi0JaW50ZWxfcnVudGltZV9wbV9lbmFi
bGVfaW50ZXJydXB0cyhkZXZfcHJpdik7CisJaW50ZWxfcnVudGltZV9wbV9lbmFibGVfaW50ZXJy
dXB0cyhpOTE1KTsKIAotCWludGVsX3VjX3Jlc3VtZShkZXZfcHJpdik7CisJaW50ZWxfdWNfcmVz
dW1lKGk5MTUpOwogCiAJLyoKIAkgKiBObyBwb2ludCBvZiByb2xsaW5nIGJhY2sgdGhpbmdzIGlu
IGNhc2Ugb2YgYW4gZXJyb3IsIGFzIHRoZSBiZXN0CiAJICogd2UgY2FuIGRvIGlzIHRvIGhvcGUg
dGhhdCB0aGluZ3Mgd2lsbCBzdGlsbCB3b3JrIChhbmQgZGlzYWJsZSBSUE0pLgogCSAqLwotCWk5
MTVfZ2VtX2luaXRfc3dpenpsaW5nKGRldl9wcml2KTsKLQlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNl
cyhkZXZfcHJpdik7CisJaTkxNV9nZW1faW5pdF9zd2l6emxpbmcoaTkxNSk7CisJaTkxNV9nZW1f
cmVzdG9yZV9mZW5jZXMoaTkxNSk7CiAKIAkvKgogCSAqIE9uIFZMVi9DSFYgZGlzcGxheSBpbnRl
cnJ1cHRzIGFyZSBwYXJ0IG9mIHRoZSBkaXNwbGF5CiAJICogcG93ZXIgd2VsbCwgc28gaHBkIGlz
IHJlaW5pdGlhbGl6ZWQgZnJvbSB0aGVyZS4gRm9yCiAJICogZXZlcnlvbmUgZWxzZSBkbyBpdCBo
ZXJlLgogCSAqLwotCWlmICghSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgJiYgIUlTX0NIRVJSWVZJ
RVcoZGV2X3ByaXYpKQotCQlpbnRlbF9ocGRfaW5pdChkZXZfcHJpdik7CisJaWYgKCFJU19WQUxM
RVlWSUVXKGk5MTUpICYmICFJU19DSEVSUllWSUVXKGk5MTUpKQorCQlpbnRlbF9ocGRfaW5pdChp
OTE1KTsKIAotCWludGVsX2VuYWJsZV9pcGMoZGV2X3ByaXYpOworCWludGVsX2VuYWJsZV9pcGMo
aTkxNSk7CiAKLQllbmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJZW5hYmxl
X3JwbV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAKIAlpZiAocmV0KQogCQlEUk1fRVJST1IoIlJ1
bnRpbWUgcmVzdW1lIGZhaWxlZCwgZGlzYWJsaW5nIGl0ICglZClcbiIsIHJldCk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuaAppbmRleCBlYjk4ZDI4NWQyOTAuLmExYWRiNzljYTJjMyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oCkBAIC0yMDgsNyArMjA4LDcgQEAgc3RydWN0IGk5MTVfbW1fc3RydWN0
Owogc3RydWN0IGk5MTVfbW11X29iamVjdDsKIAogc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0
ZSB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2OworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1OwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAogCXN0cnVjdCB7CkBA
IC0yNzgsMTIgKzI3OCwxMiBAQCBzdHJ1Y3QgZHBsbDsKIHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0
ZTsKIAogc3RydWN0IGRybV9pOTE1X2Rpc3BsYXlfZnVuY3MgewotCXZvaWQgKCpnZXRfY2RjbGsp
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwl2b2lkICgqZ2V0X2NkY2xrKShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgc3RydWN0IGludGVsX2NkY2xrX3N0
YXRlICpjZGNsa19zdGF0ZSk7Ci0Jdm9pZCAoKnNldF9jZGNsaykoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorCXZvaWQgKCpzZXRfY2RjbGspKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0
YXRlLAogCQkJICBlbnVtIHBpcGUgcGlwZSk7Ci0JaW50ICgqZ2V0X2ZpZm9fc2l6ZSkoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCWludCAoKmdldF9maWZvX3NpemUpKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICBlbnVtIGk5eHhfcGxhbmVfaWQgaTl4
eF9wbGFuZSk7CiAJaW50ICgqY29tcHV0ZV9waXBlX3dtKShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3N0YXRlKTsKIAlpbnQgKCpjb21wdXRlX2ludGVybWVkaWF0ZV93bSkoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm5ld3N0YXRlKTsKQEAgLTMxNyw4ICszMTcsOCBAQCBzdHJ1Y3QgZHJtX2k5
MTVfZGlzcGxheV9mdW5jcyB7CiAJCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0
YXRlICpvbGRfY29ubl9zdGF0ZSk7CiAJdm9pZCAoKmZkaV9saW5rX3RyYWluKShzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YywKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSk7Ci0Jdm9pZCAoKmluaXRfY2xvY2tfZ2F0aW5nKShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpOwotCXZvaWQgKCpocGRfaXJxX3NldHVwKShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworCXZvaWQgKCppbml0X2Nsb2NrX2dhdGluZykoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworCXZvaWQgKCpocGRfaXJxX3NldHVwKShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAJLyogY2xvY2sgdXBkYXRlcyBmb3IgbW9kZSBzZXQg
Ki8KIAkvKiBjdXJzb3IgdXBkYXRlcyAqLwogCS8qIHJlbmRlciBjbG9jayBpbmNyZWFzZS9kZWNy
ZWFzZSAqLwpAQCAtNTUyLDcgKzU1Miw3IEBAIHN0cnVjdCBpbnRlbF9nbWJ1cyB7CiAJdTMyIHJl
ZzA7CiAJaTkxNV9yZWdfdCBncGlvX3JlZzsKIAlzdHJ1Y3QgaTJjX2FsZ29fYml0X2RhdGEgYml0
X2FsZ287Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2OworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1OwogfTsKIAogc3RydWN0IGk5MTVfc3VzcGVuZF9zYXZlZF9yZWdp
c3RlcnMgewpAQCAtNjQxLDcgKzY0MSw3IEBAIHN0cnVjdCBpbnRlbF9ycHMgewogCiAJLyoKIAkg
KiB3b3JrLCBpbnRlcnJ1cHRzX2VuYWJsZWQgYW5kIHBtX2lpciBhcmUgcHJvdGVjdGVkIGJ5Ci0J
ICogZGV2X3ByaXYtPmlycV9sb2NrCisJICogaTkxNS0+aXJxX2xvY2sKIAkgKi8KIAlzdHJ1Y3Qg
d29ya19zdHJ1Y3Qgd29yazsKIAlib29sIGludGVycnVwdHNfZW5hYmxlZDsKQEAgLTEyNDAsOSAr
MTI0MCw5IEBAIHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtX29wcyB7CiAgKi8KIHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtIHsKIAkvKioKLQkgKiBAZGV2X3ByaXY6IGk5MTUgZHJtIGRldmljZQorCSAq
IEBpOTE1OiBpOTE1IGRybSBkZXZpY2UKIAkgKi8KLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTU7CiAKIAkvKioKIAkgKiBA
bGluazogTGlua3MgdGhlIHN0cmVhbSBpbnRvIGBgJmRybV9pOTE1X3ByaXZhdGUtPnN0cmVhbXNg
YApAQCAtMTMwMiwyMCArMTMwMiwyMCBAQCBzdHJ1Y3QgaTkxNV9vYV9vcHMgewogCSAqIEBpc192
YWxpZF9iX2NvdW50ZXJfcmVnOiBWYWxpZGF0ZXMgcmVnaXN0ZXIncyBhZGRyZXNzIGZvcgogCSAq
IHByb2dyYW1taW5nIGJvb2xlYW4gY291bnRlcnMgZm9yIGEgcGFydGljdWxhciBwbGF0Zm9ybS4K
IAkgKi8KLQlib29sICgqaXNfdmFsaWRfYl9jb3VudGVyX3JlZykoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorCWJvb2wgKCppc192YWxpZF9iX2NvdW50ZXJfcmVnKShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICAgdTMyIGFkZHIpOwogCiAJLyoqCiAJ
ICogQGlzX3ZhbGlkX211eF9yZWc6IFZhbGlkYXRlcyByZWdpc3RlcidzIGFkZHJlc3MgZm9yIHBy
b2dyYW1taW5nIG11eAogCSAqIGZvciBhIHBhcnRpY3VsYXIgcGxhdGZvcm0uCiAJICovCi0JYm9v
bCAoKmlzX3ZhbGlkX211eF9yZWcpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dTMyIGFkZHIpOworCWJvb2wgKCppc192YWxpZF9tdXhfcmVnKShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgdTMyIGFkZHIpOwogCiAJLyoqCiAJICogQGlzX3ZhbGlkX2ZsZXhfcmVnOiBW
YWxpZGF0ZXMgcmVnaXN0ZXIncyBhZGRyZXNzIGZvciBwcm9ncmFtbWluZwogCSAqIGZsZXggRVUg
ZmlsdGVyaW5nIGZvciBhIHBhcnRpY3VsYXIgcGxhdGZvcm0uCiAJICovCi0JYm9vbCAoKmlzX3Zh
bGlkX2ZsZXhfcmVnKShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBhZGRy
KTsKKwlib29sICgqaXNfdmFsaWRfZmxleF9yZWcpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCB1MzIgYWRkcik7CiAKIAkvKioKIAkgKiBAZW5hYmxlX21ldHJpY19zZXQ6IFNlbGVjdHMg
YW5kIGFwcGxpZXMgYW55IE1VWCBjb25maWd1cmF0aW9uIHRvIHNldApAQCAtMTMyOSw3ICsxMzI5
LDcgQEAgc3RydWN0IGk5MTVfb2Ffb3BzIHsKIAkgKiBAZGlzYWJsZV9tZXRyaWNfc2V0OiBSZW1v
dmUgc3lzdGVtIGNvbnN0cmFpbnRzIGFzc29jaWF0ZWQgd2l0aCB1c2luZwogCSAqIHRoZSBPQSB1
bml0LgogCSAqLwotCXZvaWQgKCpkaXNhYmxlX21ldHJpY19zZXQpKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7CisJdm9pZCAoKmRpc2FibGVfbWV0cmljX3NldCkoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiAJLyoqCiAJICogQG9hX2VuYWJsZTogRW5hYmxlIHBl
cmlvZGljIHNhbXBsaW5nCkBAIC0xMzU3LDcgKzEzNTcsNyBAQCBzdHJ1Y3QgaTkxNV9vYV9vcHMg
ewogCSAqIGhhbmRsaW5nIHRoZSBPQSB1bml0IHRhaWwgcG9pbnRlciByYWNlIHRoYXQgYWZmZWN0
cyBtdWx0aXBsZQogCSAqIGdlbmVyYXRpb25zLgogCSAqLwotCXUzMiAoKm9hX2h3X3RhaWxfcmVh
ZCkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKKwl1MzIgKCpvYV9od190YWls
X3JlYWQpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIH07CiAKIHN0cnVjdCBpbnRl
bF9jZGNsa19zdGF0ZSB7CkBAIC0xNzUwLDEzICsxNzUwLDEzIEBAIHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlIHsKIAogCQkvKgogCQkgKiBMb2NrIGFzc29jaWF0ZWQgd2l0aCBhZGRpbmcvbW9kaWZ5
aW5nL3JlbW92aW5nIE9BIGNvbmZpZ3MKLQkJICogaW4gZGV2X3ByaXYtPnBlcmYubWV0cmljc19p
ZHIuCisJCSAqIGluIGk5MTUtPnBlcmYubWV0cmljc19pZHIuCiAJCSAqLwogCQlzdHJ1Y3QgbXV0
ZXggbWV0cmljc19sb2NrOwogCiAJCS8qCiAJCSAqIExpc3Qgb2YgZHluYW1pYyBjb25maWd1cmF0
aW9ucywgeW91IG5lZWQgdG8gaG9sZAotCQkgKiBkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sg
dG8gYWNjZXNzIGl0LgorCQkgKiBpOTE1LT5wZXJmLm1ldHJpY3NfbG9jayB0byBhY2Nlc3MgaXQu
CiAJCSAqLwogCQlzdHJ1Y3QgaWRyIG1ldHJpY3NfaWRyOwogCkBAIC0xNzcyLDcgKzE3NzIsNyBA
QCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAJCQkgKiBUaGUgc3RyZWFtIGN1cnJlbnRseSB1
c2luZyB0aGUgT0EgdW5pdC4gSWYgYWNjZXNzZWQKIAkJCSAqIG91dHNpZGUgYSBzeXNjYWxsIGFz
c29jaWF0ZWQgdG8gaXRzIGZpbGUKIAkJCSAqIGRlc2NyaXB0b3IsIHlvdSBuZWVkIHRvIGhvbGQK
LQkJCSAqIGRldl9wcml2LT5kcm0uc3RydWN0X211dGV4LgorCQkJICogaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleC4KIAkJCSAqLwogCQkJc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKmV4Y2x1c2l2ZV9z
dHJlYW07CiAKQEAgLTIwNjYsMTUgKzIwNjYsMTUgQEAgZW51bSBoZG1pX2ZvcmNlX2F1ZGlvIHsK
IAlHRU5NQVNLKElOVEVMX0ZST05UQlVGRkVSX0JJVFNfUEVSX1BJUEUgKiAoKHBpcGUpICsgMSkg
LSAxLCBcCiAJCUlOVEVMX0ZST05UQlVGRkVSX0JJVFNfUEVSX1BJUEUgKiAocGlwZSkpCiAKLSNk
ZWZpbmUgSU5URUxfSU5GTyhkZXZfcHJpdikJKCYoZGV2X3ByaXYpLT5fX2luZm8pCi0jZGVmaW5l
IFJVTlRJTUVfSU5GTyhkZXZfcHJpdikJKCYoZGV2X3ByaXYpLT5fX3J1bnRpbWUpCi0jZGVmaW5l
IERSSVZFUl9DQVBTKGRldl9wcml2KQkoJihkZXZfcHJpdiktPmNhcHMpCisjZGVmaW5lIElOVEVM
X0lORk8oaTkxNSkJKCYoaTkxNSktPl9faW5mbykKKyNkZWZpbmUgUlVOVElNRV9JTkZPKGk5MTUp
CSgmKGk5MTUpLT5fX3J1bnRpbWUpCisjZGVmaW5lIERSSVZFUl9DQVBTKGk5MTUpCSgmKGk5MTUp
LT5jYXBzKQogCi0jZGVmaW5lIElOVEVMX0dFTihkZXZfcHJpdikJKElOVEVMX0lORk8oZGV2X3By
aXYpLT5nZW4pCi0jZGVmaW5lIElOVEVMX0RFVklEKGRldl9wcml2KQkoUlVOVElNRV9JTkZPKGRl
dl9wcml2KS0+ZGV2aWNlX2lkKQorI2RlZmluZSBJTlRFTF9HRU4oaTkxNSkJKElOVEVMX0lORk8o
aTkxNSktPmdlbikKKyNkZWZpbmUgSU5URUxfREVWSUQoaTkxNSkJKFJVTlRJTUVfSU5GTyhpOTE1
KS0+ZGV2aWNlX2lkKQogCiAjZGVmaW5lIFJFVklEX0ZPUkVWRVIJCTB4ZmYKLSNkZWZpbmUgSU5U
RUxfUkVWSUQoZGV2X3ByaXYpCSgoZGV2X3ByaXYpLT5kcm0ucGRldi0+cmV2aXNpb24pCisjZGVm
aW5lIElOVEVMX1JFVklEKGk5MTUpCSgoaTkxNSktPmRybS5wZGV2LT5yZXZpc2lvbikKIAogI2Rl
ZmluZSBJTlRFTF9HRU5fTUFTSyhzLCBlKSAoIFwKIAlCVUlMRF9CVUdfT05fWkVSTyghX19idWls
dGluX2NvbnN0YW50X3AocykpICsgXApAQCAtMjA4MiwxMiArMjA4MiwxMiBAQCBlbnVtIGhkbWlf
Zm9yY2VfYXVkaW8gewogCUdFTk1BU0soKGUpIC0gMSwgKHMpIC0gMSkpCiAKIC8qIFJldHVybnMg
dHJ1ZSBpZiBHZW4gaXMgaW4gaW5jbHVzaXZlIHJhbmdlIFtTdGFydCwgRW5kXSAqLwotI2RlZmlu
ZSBJU19HRU5fUkFOR0UoZGV2X3ByaXYsIHMsIGUpIFwKLQkoISEoSU5URUxfSU5GTyhkZXZfcHJp
diktPmdlbl9tYXNrICYgSU5URUxfR0VOX01BU0soKHMpLCAoZSkpKSkKKyNkZWZpbmUgSVNfR0VO
X1JBTkdFKGk5MTUsIHMsIGUpIFwKKwkoISEoSU5URUxfSU5GTyhpOTE1KS0+Z2VuX21hc2sgJiBJ
TlRFTF9HRU5fTUFTSygocyksIChlKSkpKQogCi0jZGVmaW5lIElTX0dFTihkZXZfcHJpdiwgbikg
XAorI2RlZmluZSBJU19HRU4oaTkxNSwgbikgXAogCShCVUlMRF9CVUdfT05fWkVSTyghX19idWls
dGluX2NvbnN0YW50X3AobikpICsgXAotCSBJTlRFTF9JTkZPKGRldl9wcml2KS0+Z2VuID09IChu
KSkKKwkgSU5URUxfSU5GTyhpOTE1KS0+Z2VuID09IChuKSkKIAogLyoKICAqIFJldHVybiB0cnVl
IGlmIHJldmlzaW9uIGlzIGluIHJhbmdlIFtzaW5jZSx1bnRpbF0gaW5jbHVzaXZlLgpAQCAtMjE1
OSw4OCArMjE1OSw4OCBAQCBJU19TVUJQTEFURk9STShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAlyZXR1cm4gKChtYXNrIDw8IChtc2IgLSBwYikpICYgKG1hc2sgPDwgKG1z
YiAtIHMpKSkgJiBCSVQobXNiKTsKIH0KIAotI2RlZmluZSBJU19NT0JJTEUoZGV2X3ByaXYpCShJ
TlRFTF9JTkZPKGRldl9wcml2KS0+aXNfbW9iaWxlKQotCi0jZGVmaW5lIElTX0k4MzAoZGV2X3By
aXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9JODMwKQotI2RlZmluZSBJU19JODQ1Ryhk
ZXZfcHJpdikJSVNfUExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0k4NDVHKQotI2RlZmluZSBJU19J
ODVYKGRldl9wcml2KQlJU19QTEFURk9STShkZXZfcHJpdiwgSU5URUxfSTg1WCkKLSNkZWZpbmUg
SVNfSTg2NUcoZGV2X3ByaXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9JODY1RykKLSNk
ZWZpbmUgSVNfSTkxNUcoZGV2X3ByaXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9JOTE1
RykKLSNkZWZpbmUgSVNfSTkxNUdNKGRldl9wcml2KQlJU19QTEFURk9STShkZXZfcHJpdiwgSU5U
RUxfSTkxNUdNKQotI2RlZmluZSBJU19JOTQ1RyhkZXZfcHJpdikJSVNfUExBVEZPUk0oZGV2X3By
aXYsIElOVEVMX0k5NDVHKQotI2RlZmluZSBJU19JOTQ1R00oZGV2X3ByaXYpCUlTX1BMQVRGT1JN
KGRldl9wcml2LCBJTlRFTF9JOTQ1R00pCi0jZGVmaW5lIElTX0k5NjVHKGRldl9wcml2KQlJU19Q
TEFURk9STShkZXZfcHJpdiwgSU5URUxfSTk2NUcpCi0jZGVmaW5lIElTX0k5NjVHTShkZXZfcHJp
dikJSVNfUExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0k5NjVHTSkKLSNkZWZpbmUgSVNfRzQ1KGRl
dl9wcml2KQlJU19QTEFURk9STShkZXZfcHJpdiwgSU5URUxfRzQ1KQotI2RlZmluZSBJU19HTTQ1
KGRldl9wcml2KQlJU19QTEFURk9STShkZXZfcHJpdiwgSU5URUxfR000NSkKLSNkZWZpbmUgSVNf
RzRYKGRldl9wcml2KQkoSVNfRzQ1KGRldl9wcml2KSB8fCBJU19HTTQ1KGRldl9wcml2KSkKLSNk
ZWZpbmUgSVNfUElORVZJRVcoZGV2X3ByaXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9Q
SU5FVklFVykKLSNkZWZpbmUgSVNfRzMzKGRldl9wcml2KQlJU19QTEFURk9STShkZXZfcHJpdiwg
SU5URUxfRzMzKQotI2RlZmluZSBJU19JUk9OTEFLRShkZXZfcHJpdikJSVNfUExBVEZPUk0oZGV2
X3ByaXYsIElOVEVMX0lST05MQUtFKQotI2RlZmluZSBJU19JUk9OTEFLRV9NKGRldl9wcml2KSBc
Ci0JKElTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9JUk9OTEFLRSkgJiYgSVNfTU9CSUxFKGRl
dl9wcml2KSkKLSNkZWZpbmUgSVNfSVZZQlJJREdFKGRldl9wcml2KQlJU19QTEFURk9STShkZXZf
cHJpdiwgSU5URUxfSVZZQlJJREdFKQotI2RlZmluZSBJU19JVkJfR1QxKGRldl9wcml2KQkoSVNf
SVZZQlJJREdFKGRldl9wcml2KSAmJiBcCi0JCQkJIElOVEVMX0lORk8oZGV2X3ByaXYpLT5ndCA9
PSAxKQotI2RlZmluZSBJU19WQUxMRVlWSUVXKGRldl9wcml2KQlJU19QTEFURk9STShkZXZfcHJp
diwgSU5URUxfVkFMTEVZVklFVykKLSNkZWZpbmUgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikJSVNf
UExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0NIRVJSWVZJRVcpCi0jZGVmaW5lIElTX0hBU1dFTEwo
ZGV2X3ByaXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9IQVNXRUxMKQotI2RlZmluZSBJ
U19CUk9BRFdFTEwoZGV2X3ByaXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9CUk9BRFdF
TEwpCi0jZGVmaW5lIElTX1NLWUxBS0UoZGV2X3ByaXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJ
TlRFTF9TS1lMQUtFKQotI2RlZmluZSBJU19CUk9YVE9OKGRldl9wcml2KQlJU19QTEFURk9STShk
ZXZfcHJpdiwgSU5URUxfQlJPWFRPTikKLSNkZWZpbmUgSVNfS0FCWUxBS0UoZGV2X3ByaXYpCUlT
X1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9LQUJZTEFLRSkKLSNkZWZpbmUgSVNfR0VNSU5JTEFL
RShkZXZfcHJpdikJSVNfUExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0dFTUlOSUxBS0UpCi0jZGVm
aW5lIElTX0NPRkZFRUxBS0UoZGV2X3ByaXYpCUlTX1BMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9D
T0ZGRUVMQUtFKQotI2RlZmluZSBJU19DQU5OT05MQUtFKGRldl9wcml2KQlJU19QTEFURk9STShk
ZXZfcHJpdiwgSU5URUxfQ0FOTk9OTEFLRSkKLSNkZWZpbmUgSVNfSUNFTEFLRShkZXZfcHJpdikJ
SVNfUExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0lDRUxBS0UpCi0jZGVmaW5lIElTX0VMS0hBUlRM
QUtFKGRldl9wcml2KQlJU19QTEFURk9STShkZXZfcHJpdiwgSU5URUxfRUxLSEFSVExBS0UpCi0j
ZGVmaW5lIElTX0hTV19FQVJMWV9TRFYoZGV2X3ByaXYpIChJU19IQVNXRUxMKGRldl9wcml2KSAm
JiBcCi0JCQkJICAgIChJTlRFTF9ERVZJRChkZXZfcHJpdikgJiAweEZGMDApID09IDB4MEMwMCkK
LSNkZWZpbmUgSVNfQkRXX1VMVChkZXZfcHJpdikgXAotCUlTX1NVQlBMQVRGT1JNKGRldl9wcml2
LCBJTlRFTF9CUk9BRFdFTEwsIElOVEVMX1NVQlBMQVRGT1JNX1VMVCkKLSNkZWZpbmUgSVNfQkRX
X1VMWChkZXZfcHJpdikgXAotCUlTX1NVQlBMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9CUk9BRFdF
TEwsIElOVEVMX1NVQlBMQVRGT1JNX1VMWCkKLSNkZWZpbmUgSVNfQkRXX0dUMyhkZXZfcHJpdikJ
KElTX0JST0FEV0VMTChkZXZfcHJpdikgJiYgXAotCQkJCSBJTlRFTF9JTkZPKGRldl9wcml2KS0+
Z3QgPT0gMykKLSNkZWZpbmUgSVNfSFNXX1VMVChkZXZfcHJpdikgXAotCUlTX1NVQlBMQVRGT1JN
KGRldl9wcml2LCBJTlRFTF9IQVNXRUxMLCBJTlRFTF9TVUJQTEFURk9STV9VTFQpCi0jZGVmaW5l
IElTX0hTV19HVDMoZGV2X3ByaXYpCShJU19IQVNXRUxMKGRldl9wcml2KSAmJiBcCi0JCQkJIElO
VEVMX0lORk8oZGV2X3ByaXYpLT5ndCA9PSAzKQotI2RlZmluZSBJU19IU1dfR1QxKGRldl9wcml2
KQkoSVNfSEFTV0VMTChkZXZfcHJpdikgJiYgXAotCQkJCSBJTlRFTF9JTkZPKGRldl9wcml2KS0+
Z3QgPT0gMSkKKyNkZWZpbmUgSVNfTU9CSUxFKGk5MTUpCShJTlRFTF9JTkZPKGk5MTUpLT5pc19t
b2JpbGUpCisKKyNkZWZpbmUgSVNfSTgzMChpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9J
ODMwKQorI2RlZmluZSBJU19JODQ1RyhpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9JODQ1
RykKKyNkZWZpbmUgSVNfSTg1WChpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9JODVYKQor
I2RlZmluZSBJU19JODY1RyhpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9JODY1RykKKyNk
ZWZpbmUgSVNfSTkxNUcoaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwgSU5URUxfSTkxNUcpCisjZGVm
aW5lIElTX0k5MTVHTShpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9JOTE1R00pCisjZGVm
aW5lIElTX0k5NDVHKGk5MTUpCUlTX1BMQVRGT1JNKGk5MTUsIElOVEVMX0k5NDVHKQorI2RlZmlu
ZSBJU19JOTQ1R00oaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwgSU5URUxfSTk0NUdNKQorI2RlZmlu
ZSBJU19JOTY1RyhpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9JOTY1RykKKyNkZWZpbmUg
SVNfSTk2NUdNKGk5MTUpCUlTX1BMQVRGT1JNKGk5MTUsIElOVEVMX0k5NjVHTSkKKyNkZWZpbmUg
SVNfRzQ1KGk5MTUpCUlTX1BMQVRGT1JNKGk5MTUsIElOVEVMX0c0NSkKKyNkZWZpbmUgSVNfR000
NShpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9HTTQ1KQorI2RlZmluZSBJU19HNFgoaTkx
NSkJKElTX0c0NShpOTE1KSB8fCBJU19HTTQ1KGk5MTUpKQorI2RlZmluZSBJU19QSU5FVklFVyhp
OTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9QSU5FVklFVykKKyNkZWZpbmUgSVNfRzMzKGk5
MTUpCUlTX1BMQVRGT1JNKGk5MTUsIElOVEVMX0czMykKKyNkZWZpbmUgSVNfSVJPTkxBS0UoaTkx
NSkJSVNfUExBVEZPUk0oaTkxNSwgSU5URUxfSVJPTkxBS0UpCisjZGVmaW5lIElTX0lST05MQUtF
X00oaTkxNSkgXAorCShJU19QTEFURk9STShpOTE1LCBJTlRFTF9JUk9OTEFLRSkgJiYgSVNfTU9C
SUxFKGk5MTUpKQorI2RlZmluZSBJU19JVllCUklER0UoaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwg
SU5URUxfSVZZQlJJREdFKQorI2RlZmluZSBJU19JVkJfR1QxKGk5MTUpCShJU19JVllCUklER0Uo
aTkxNSkgJiYgXAorCQkJCSBJTlRFTF9JTkZPKGk5MTUpLT5ndCA9PSAxKQorI2RlZmluZSBJU19W
QUxMRVlWSUVXKGk5MTUpCUlTX1BMQVRGT1JNKGk5MTUsIElOVEVMX1ZBTExFWVZJRVcpCisjZGVm
aW5lIElTX0NIRVJSWVZJRVcoaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwgSU5URUxfQ0hFUlJZVklF
VykKKyNkZWZpbmUgSVNfSEFTV0VMTChpOTE1KQlJU19QTEFURk9STShpOTE1LCBJTlRFTF9IQVNX
RUxMKQorI2RlZmluZSBJU19CUk9BRFdFTEwoaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwgSU5URUxf
QlJPQURXRUxMKQorI2RlZmluZSBJU19TS1lMQUtFKGk5MTUpCUlTX1BMQVRGT1JNKGk5MTUsIElO
VEVMX1NLWUxBS0UpCisjZGVmaW5lIElTX0JST1hUT04oaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwg
SU5URUxfQlJPWFRPTikKKyNkZWZpbmUgSVNfS0FCWUxBS0UoaTkxNSkJSVNfUExBVEZPUk0oaTkx
NSwgSU5URUxfS0FCWUxBS0UpCisjZGVmaW5lIElTX0dFTUlOSUxBS0UoaTkxNSkJSVNfUExBVEZP
Uk0oaTkxNSwgSU5URUxfR0VNSU5JTEFLRSkKKyNkZWZpbmUgSVNfQ09GRkVFTEFLRShpOTE1KQlJ
U19QTEFURk9STShpOTE1LCBJTlRFTF9DT0ZGRUVMQUtFKQorI2RlZmluZSBJU19DQU5OT05MQUtF
KGk5MTUpCUlTX1BMQVRGT1JNKGk5MTUsIElOVEVMX0NBTk5PTkxBS0UpCisjZGVmaW5lIElTX0lD
RUxBS0UoaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwgSU5URUxfSUNFTEFLRSkKKyNkZWZpbmUgSVNf
RUxLSEFSVExBS0UoaTkxNSkJSVNfUExBVEZPUk0oaTkxNSwgSU5URUxfRUxLSEFSVExBS0UpCisj
ZGVmaW5lIElTX0hTV19FQVJMWV9TRFYoaTkxNSkgKElTX0hBU1dFTEwoaTkxNSkgJiYgXAorCQkJ
CSAgICAoSU5URUxfREVWSUQoaTkxNSkgJiAweEZGMDApID09IDB4MEMwMCkKKyNkZWZpbmUgSVNf
QkRXX1VMVChpOTE1KSBcCisJSVNfU1VCUExBVEZPUk0oaTkxNSwgSU5URUxfQlJPQURXRUxMLCBJ
TlRFTF9TVUJQTEFURk9STV9VTFQpCisjZGVmaW5lIElTX0JEV19VTFgoaTkxNSkgXAorCUlTX1NV
QlBMQVRGT1JNKGk5MTUsIElOVEVMX0JST0FEV0VMTCwgSU5URUxfU1VCUExBVEZPUk1fVUxYKQor
I2RlZmluZSBJU19CRFdfR1QzKGk5MTUpCShJU19CUk9BRFdFTEwoaTkxNSkgJiYgXAorCQkJCSBJ
TlRFTF9JTkZPKGk5MTUpLT5ndCA9PSAzKQorI2RlZmluZSBJU19IU1dfVUxUKGk5MTUpIFwKKwlJ
U19TVUJQTEFURk9STShpOTE1LCBJTlRFTF9IQVNXRUxMLCBJTlRFTF9TVUJQTEFURk9STV9VTFQp
CisjZGVmaW5lIElTX0hTV19HVDMoaTkxNSkJKElTX0hBU1dFTEwoaTkxNSkgJiYgXAorCQkJCSBJ
TlRFTF9JTkZPKGk5MTUpLT5ndCA9PSAzKQorI2RlZmluZSBJU19IU1dfR1QxKGk5MTUpCShJU19I
QVNXRUxMKGk5MTUpICYmIFwKKwkJCQkgSU5URUxfSU5GTyhpOTE1KS0+Z3QgPT0gMSkKIC8qIFVM
WCBtYWNoaW5lcyBhcmUgYWxzbyBjb25zaWRlcmVkIFVMVC4gKi8KLSNkZWZpbmUgSVNfSFNXX1VM
WChkZXZfcHJpdikgXAotCUlTX1NVQlBMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9IQVNXRUxMLCBJ
TlRFTF9TVUJQTEFURk9STV9VTFgpCi0jZGVmaW5lIElTX1NLTF9VTFQoZGV2X3ByaXYpIFwKLQlJ
U19TVUJQTEFURk9STShkZXZfcHJpdiwgSU5URUxfU0tZTEFLRSwgSU5URUxfU1VCUExBVEZPUk1f
VUxUKQotI2RlZmluZSBJU19TS0xfVUxYKGRldl9wcml2KSBcCi0JSVNfU1VCUExBVEZPUk0oZGV2
X3ByaXYsIElOVEVMX1NLWUxBS0UsIElOVEVMX1NVQlBMQVRGT1JNX1VMWCkKLSNkZWZpbmUgSVNf
S0JMX1VMVChkZXZfcHJpdikgXAotCUlTX1NVQlBMQVRGT1JNKGRldl9wcml2LCBJTlRFTF9LQUJZ
TEFLRSwgSU5URUxfU1VCUExBVEZPUk1fVUxUKQotI2RlZmluZSBJU19LQkxfVUxYKGRldl9wcml2
KSBcCi0JSVNfU1VCUExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0tBQllMQUtFLCBJTlRFTF9TVUJQ
TEFURk9STV9VTFgpCi0jZGVmaW5lIElTX1NLTF9HVDIoZGV2X3ByaXYpCShJU19TS1lMQUtFKGRl
dl9wcml2KSAmJiBcCi0JCQkJIElOVEVMX0lORk8oZGV2X3ByaXYpLT5ndCA9PSAyKQotI2RlZmlu
ZSBJU19TS0xfR1QzKGRldl9wcml2KQkoSVNfU0tZTEFLRShkZXZfcHJpdikgJiYgXAotCQkJCSBJ
TlRFTF9JTkZPKGRldl9wcml2KS0+Z3QgPT0gMykKLSNkZWZpbmUgSVNfU0tMX0dUNChkZXZfcHJp
dikJKElTX1NLWUxBS0UoZGV2X3ByaXYpICYmIFwKLQkJCQkgSU5URUxfSU5GTyhkZXZfcHJpdikt
Pmd0ID09IDQpCi0jZGVmaW5lIElTX0tCTF9HVDIoZGV2X3ByaXYpCShJU19LQUJZTEFLRShkZXZf
cHJpdikgJiYgXAotCQkJCSBJTlRFTF9JTkZPKGRldl9wcml2KS0+Z3QgPT0gMikKLSNkZWZpbmUg
SVNfS0JMX0dUMyhkZXZfcHJpdikJKElTX0tBQllMQUtFKGRldl9wcml2KSAmJiBcCi0JCQkJIElO
VEVMX0lORk8oZGV2X3ByaXYpLT5ndCA9PSAzKQotI2RlZmluZSBJU19DRkxfVUxUKGRldl9wcml2
KSBcCi0JSVNfU1VCUExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0NPRkZFRUxBS0UsIElOVEVMX1NV
QlBMQVRGT1JNX1VMVCkKLSNkZWZpbmUgSVNfQ0ZMX1VMWChkZXZfcHJpdikgXAotCUlTX1NVQlBM
QVRGT1JNKGRldl9wcml2LCBJTlRFTF9DT0ZGRUVMQUtFLCBJTlRFTF9TVUJQTEFURk9STV9VTFgp
Ci0jZGVmaW5lIElTX0NGTF9HVDIoZGV2X3ByaXYpCShJU19DT0ZGRUVMQUtFKGRldl9wcml2KSAm
JiBcCi0JCQkJIElOVEVMX0lORk8oZGV2X3ByaXYpLT5ndCA9PSAyKQotI2RlZmluZSBJU19DRkxf
R1QzKGRldl9wcml2KQkoSVNfQ09GRkVFTEFLRShkZXZfcHJpdikgJiYgXAotCQkJCSBJTlRFTF9J
TkZPKGRldl9wcml2KS0+Z3QgPT0gMykKLSNkZWZpbmUgSVNfQ05MX1dJVEhfUE9SVF9GKGRldl9w
cml2KSBcCi0JSVNfU1VCUExBVEZPUk0oZGV2X3ByaXYsIElOVEVMX0NBTk5PTkxBS0UsIElOVEVM
X1NVQlBMQVRGT1JNX1BPUlRGKQotI2RlZmluZSBJU19JQ0xfV0lUSF9QT1JUX0YoZGV2X3ByaXYp
IFwKLQlJU19TVUJQTEFURk9STShkZXZfcHJpdiwgSU5URUxfSUNFTEFLRSwgSU5URUxfU1VCUExB
VEZPUk1fUE9SVEYpCisjZGVmaW5lIElTX0hTV19VTFgoaTkxNSkgXAorCUlTX1NVQlBMQVRGT1JN
KGk5MTUsIElOVEVMX0hBU1dFTEwsIElOVEVMX1NVQlBMQVRGT1JNX1VMWCkKKyNkZWZpbmUgSVNf
U0tMX1VMVChpOTE1KSBcCisJSVNfU1VCUExBVEZPUk0oaTkxNSwgSU5URUxfU0tZTEFLRSwgSU5U
RUxfU1VCUExBVEZPUk1fVUxUKQorI2RlZmluZSBJU19TS0xfVUxYKGk5MTUpIFwKKwlJU19TVUJQ
TEFURk9STShpOTE1LCBJTlRFTF9TS1lMQUtFLCBJTlRFTF9TVUJQTEFURk9STV9VTFgpCisjZGVm
aW5lIElTX0tCTF9VTFQoaTkxNSkgXAorCUlTX1NVQlBMQVRGT1JNKGk5MTUsIElOVEVMX0tBQllM
QUtFLCBJTlRFTF9TVUJQTEFURk9STV9VTFQpCisjZGVmaW5lIElTX0tCTF9VTFgoaTkxNSkgXAor
CUlTX1NVQlBMQVRGT1JNKGk5MTUsIElOVEVMX0tBQllMQUtFLCBJTlRFTF9TVUJQTEFURk9STV9V
TFgpCisjZGVmaW5lIElTX1NLTF9HVDIoaTkxNSkJKElTX1NLWUxBS0UoaTkxNSkgJiYgXAorCQkJ
CSBJTlRFTF9JTkZPKGk5MTUpLT5ndCA9PSAyKQorI2RlZmluZSBJU19TS0xfR1QzKGk5MTUpCShJ
U19TS1lMQUtFKGk5MTUpICYmIFwKKwkJCQkgSU5URUxfSU5GTyhpOTE1KS0+Z3QgPT0gMykKKyNk
ZWZpbmUgSVNfU0tMX0dUNChpOTE1KQkoSVNfU0tZTEFLRShpOTE1KSAmJiBcCisJCQkJIElOVEVM
X0lORk8oaTkxNSktPmd0ID09IDQpCisjZGVmaW5lIElTX0tCTF9HVDIoaTkxNSkJKElTX0tBQllM
QUtFKGk5MTUpICYmIFwKKwkJCQkgSU5URUxfSU5GTyhpOTE1KS0+Z3QgPT0gMikKKyNkZWZpbmUg
SVNfS0JMX0dUMyhpOTE1KQkoSVNfS0FCWUxBS0UoaTkxNSkgJiYgXAorCQkJCSBJTlRFTF9JTkZP
KGk5MTUpLT5ndCA9PSAzKQorI2RlZmluZSBJU19DRkxfVUxUKGk5MTUpIFwKKwlJU19TVUJQTEFU
Rk9STShpOTE1LCBJTlRFTF9DT0ZGRUVMQUtFLCBJTlRFTF9TVUJQTEFURk9STV9VTFQpCisjZGVm
aW5lIElTX0NGTF9VTFgoaTkxNSkgXAorCUlTX1NVQlBMQVRGT1JNKGk5MTUsIElOVEVMX0NPRkZF
RUxBS0UsIElOVEVMX1NVQlBMQVRGT1JNX1VMWCkKKyNkZWZpbmUgSVNfQ0ZMX0dUMihpOTE1KQko
SVNfQ09GRkVFTEFLRShpOTE1KSAmJiBcCisJCQkJIElOVEVMX0lORk8oaTkxNSktPmd0ID09IDIp
CisjZGVmaW5lIElTX0NGTF9HVDMoaTkxNSkJKElTX0NPRkZFRUxBS0UoaTkxNSkgJiYgXAorCQkJ
CSBJTlRFTF9JTkZPKGk5MTUpLT5ndCA9PSAzKQorI2RlZmluZSBJU19DTkxfV0lUSF9QT1JUX0Yo
aTkxNSkgXAorCUlTX1NVQlBMQVRGT1JNKGk5MTUsIElOVEVMX0NBTk5PTkxBS0UsIElOVEVMX1NV
QlBMQVRGT1JNX1BPUlRGKQorI2RlZmluZSBJU19JQ0xfV0lUSF9QT1JUX0YoaTkxNSkgXAorCUlT
X1NVQlBMQVRGT1JNKGk5MTUsIElOVEVMX0lDRUxBS0UsIElOVEVMX1NVQlBMQVRGT1JNX1BPUlRG
KQogCiAjZGVmaW5lIFNLTF9SRVZJRF9BMAkJMHgwCiAjZGVmaW5lIFNLTF9SRVZJRF9CMAkJMHgx
CkBAIC0yMjU5LDggKzIyNTksOCBAQCBJU19TVUJQTEFURk9STShjb25zdCBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKICNkZWZpbmUgQlhUX1JFVklEX0JfTEFTVAkweDgKICNkZWZpbmUg
QlhUX1JFVklEX0MwCQkweDkKIAotI2RlZmluZSBJU19CWFRfUkVWSUQoZGV2X3ByaXYsIHNpbmNl
LCB1bnRpbCkgXAotCShJU19CUk9YVE9OKGRldl9wcml2KSAmJiBJU19SRVZJRChkZXZfcHJpdiwg
c2luY2UsIHVudGlsKSkKKyNkZWZpbmUgSVNfQlhUX1JFVklEKGk5MTUsIHNpbmNlLCB1bnRpbCkg
XAorCShJU19CUk9YVE9OKGk5MTUpICYmIElTX1JFVklEKGk5MTUsIHNpbmNlLCB1bnRpbCkpCiAK
ICNkZWZpbmUgS0JMX1JFVklEX0EwCQkweDAKICNkZWZpbmUgS0JMX1JFVklEX0IwCQkweDEKQEAg
LTIyNjgsMTQgKzIyNjgsMTQgQEAgSVNfU1VCUExBVEZPUk0oY29uc3Qgc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAjZGVmaW5lIEtCTF9SRVZJRF9EMAkJMHgzCiAjZGVmaW5lIEtCTF9S
RVZJRF9FMAkJMHg0CiAKLSNkZWZpbmUgSVNfS0JMX1JFVklEKGRldl9wcml2LCBzaW5jZSwgdW50
aWwpIFwKLQkoSVNfS0FCWUxBS0UoZGV2X3ByaXYpICYmIElTX1JFVklEKGRldl9wcml2LCBzaW5j
ZSwgdW50aWwpKQorI2RlZmluZSBJU19LQkxfUkVWSUQoaTkxNSwgc2luY2UsIHVudGlsKSBcCisJ
KElTX0tBQllMQUtFKGk5MTUpICYmIElTX1JFVklEKGk5MTUsIHNpbmNlLCB1bnRpbCkpCiAKICNk
ZWZpbmUgR0xLX1JFVklEX0EwCQkweDAKICNkZWZpbmUgR0xLX1JFVklEX0ExCQkweDEKIAotI2Rl
ZmluZSBJU19HTEtfUkVWSUQoZGV2X3ByaXYsIHNpbmNlLCB1bnRpbCkgXAotCShJU19HRU1JTklM
QUtFKGRldl9wcml2KSAmJiBJU19SRVZJRChkZXZfcHJpdiwgc2luY2UsIHVudGlsKSkKKyNkZWZp
bmUgSVNfR0xLX1JFVklEKGk5MTUsIHNpbmNlLCB1bnRpbCkgXAorCShJU19HRU1JTklMQUtFKGk5
MTUpICYmIElTX1JFVklEKGk5MTUsIHNpbmNlLCB1bnRpbCkpCiAKICNkZWZpbmUgQ05MX1JFVklE
X0EwCQkweDAKICNkZWZpbmUgQ05MX1JFVklEX0IwCQkweDEKQEAgLTIyOTMsMTIyICsyMjkzLDEy
MiBAQCBJU19TVUJQTEFURk9STShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
ICNkZWZpbmUgSVNfSUNMX1JFVklEKHAsIHNpbmNlLCB1bnRpbCkgXAogCShJU19JQ0VMQUtFKHAp
ICYmIElTX1JFVklEKHAsIHNpbmNlLCB1bnRpbCkpCiAKLSNkZWZpbmUgSVNfTFAoZGV2X3ByaXYp
CShJTlRFTF9JTkZPKGRldl9wcml2KS0+aXNfbHApCi0jZGVmaW5lIElTX0dFTjlfTFAoZGV2X3By
aXYpCShJU19HRU4oZGV2X3ByaXYsIDkpICYmIElTX0xQKGRldl9wcml2KSkKLSNkZWZpbmUgSVNf
R0VOOV9CQyhkZXZfcHJpdikJKElTX0dFTihkZXZfcHJpdiwgOSkgJiYgIUlTX0xQKGRldl9wcml2
KSkKKyNkZWZpbmUgSVNfTFAoaTkxNSkJKElOVEVMX0lORk8oaTkxNSktPmlzX2xwKQorI2RlZmlu
ZSBJU19HRU45X0xQKGk5MTUpCShJU19HRU4oaTkxNSwgOSkgJiYgSVNfTFAoaTkxNSkpCisjZGVm
aW5lIElTX0dFTjlfQkMoaTkxNSkJKElTX0dFTihpOTE1LCA5KSAmJiAhSVNfTFAoaTkxNSkpCiAK
LSNkZWZpbmUgSEFTX0VOR0lORShkZXZfcHJpdiwgaWQpIChJTlRFTF9JTkZPKGRldl9wcml2KS0+
ZW5naW5lX21hc2sgJiBCSVQoaWQpKQorI2RlZmluZSBIQVNfRU5HSU5FKGk5MTUsIGlkKSAoSU5U
RUxfSU5GTyhpOTE1KS0+ZW5naW5lX21hc2sgJiBCSVQoaWQpKQogCi0jZGVmaW5lIEVOR0lORV9J
TlNUQU5DRVNfTUFTSyhkZXZfcHJpdiwgZmlyc3QsIGNvdW50KSAoewkJXAorI2RlZmluZSBFTkdJ
TkVfSU5TVEFOQ0VTX01BU0soaTkxNSwgZmlyc3QsIGNvdW50KSAoewkJXAogCXVuc2lnbmVkIGlu
dCBmaXJzdF9fID0gKGZpcnN0KTsJCQkJCVwKIAl1bnNpZ25lZCBpbnQgY291bnRfXyA9IChjb3Vu
dCk7CQkJCQlcCi0JKElOVEVMX0lORk8oZGV2X3ByaXYpLT5lbmdpbmVfbWFzayAmCQkJCVwKKwko
SU5URUxfSU5GTyhpOTE1KS0+ZW5naW5lX21hc2sgJgkJCQlcCiAJIEdFTk1BU0soZmlyc3RfXyAr
IGNvdW50X18gLSAxLCBmaXJzdF9fKSkgPj4gZmlyc3RfXzsJCVwKIH0pCi0jZGVmaW5lIFZEQk9Y
X01BU0soZGV2X3ByaXYpIFwKLQlFTkdJTkVfSU5TVEFOQ0VTX01BU0soZGV2X3ByaXYsIFZDUzAs
IEk5MTVfTUFYX1ZDUykKLSNkZWZpbmUgVkVCT1hfTUFTSyhkZXZfcHJpdikgXAotCUVOR0lORV9J
TlNUQU5DRVNfTUFTSyhkZXZfcHJpdiwgVkVDUzAsIEk5MTVfTUFYX1ZFQ1MpCi0KLSNkZWZpbmUg
SEFTX0xMQyhkZXZfcHJpdikJKElOVEVMX0lORk8oZGV2X3ByaXYpLT5oYXNfbGxjKQotI2RlZmlu
ZSBIQVNfU05PT1AoZGV2X3ByaXYpCShJTlRFTF9JTkZPKGRldl9wcml2KS0+aGFzX3Nub29wKQot
I2RlZmluZSBIQVNfRURSQU0oZGV2X3ByaXYpCSgoZGV2X3ByaXYpLT5lZHJhbV9zaXplX21iKQot
I2RlZmluZSBIQVNfV1QoZGV2X3ByaXYpCSgoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgXAotCQkJ
CSBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSAmJiBIQVNfRURSQU0oZGV2X3ByaXYpKQotCi0jZGVm
aW5lIEhXU19ORUVEU19QSFlTSUNBTChkZXZfcHJpdikJKElOVEVMX0lORk8oZGV2X3ByaXYpLT5o
d3NfbmVlZHNfcGh5c2ljYWwpCi0KLSNkZWZpbmUgSEFTX0xPR0lDQUxfUklOR19DT05URVhUUyhk
ZXZfcHJpdikgXAotCQkoSU5URUxfSU5GTyhkZXZfcHJpdiktPmhhc19sb2dpY2FsX3JpbmdfY29u
dGV4dHMpCi0jZGVmaW5lIEhBU19MT0dJQ0FMX1JJTkdfRUxTUShkZXZfcHJpdikgXAotCQkoSU5U
RUxfSU5GTyhkZXZfcHJpdiktPmhhc19sb2dpY2FsX3JpbmdfZWxzcSkKLSNkZWZpbmUgSEFTX0xP
R0lDQUxfUklOR19QUkVFTVBUSU9OKGRldl9wcml2KSBcCi0JCShJTlRFTF9JTkZPKGRldl9wcml2
KS0+aGFzX2xvZ2ljYWxfcmluZ19wcmVlbXB0aW9uKQotCi0jZGVmaW5lIEhBU19FWEVDTElTVFMo
ZGV2X3ByaXYpIEhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMoZGV2X3ByaXYpCi0KLSNkZWZpbmUg
SU5URUxfUFBHVFQoZGV2X3ByaXYpIChJTlRFTF9JTkZPKGRldl9wcml2KS0+cHBndHRfdHlwZSkK
LSNkZWZpbmUgSEFTX1BQR1RUKGRldl9wcml2KSBcCi0JKElOVEVMX1BQR1RUKGRldl9wcml2KSAh
PSBJTlRFTF9QUEdUVF9OT05FKQotI2RlZmluZSBIQVNfRlVMTF9QUEdUVChkZXZfcHJpdikgXAot
CShJTlRFTF9QUEdUVChkZXZfcHJpdikgPj0gSU5URUxfUFBHVFRfRlVMTCkKLQotI2RlZmluZSBI
QVNfUEFHRV9TSVpFUyhkZXZfcHJpdiwgc2l6ZXMpICh7IFwKKyNkZWZpbmUgVkRCT1hfTUFTSyhp
OTE1KSBcCisJRU5HSU5FX0lOU1RBTkNFU19NQVNLKGk5MTUsIFZDUzAsIEk5MTVfTUFYX1ZDUykK
KyNkZWZpbmUgVkVCT1hfTUFTSyhpOTE1KSBcCisJRU5HSU5FX0lOU1RBTkNFU19NQVNLKGk5MTUs
IFZFQ1MwLCBJOTE1X01BWF9WRUNTKQorCisjZGVmaW5lIEhBU19MTEMoaTkxNSkJKElOVEVMX0lO
Rk8oaTkxNSktPmhhc19sbGMpCisjZGVmaW5lIEhBU19TTk9PUChpOTE1KQkoSU5URUxfSU5GTyhp
OTE1KS0+aGFzX3Nub29wKQorI2RlZmluZSBIQVNfRURSQU0oaTkxNSkJKChpOTE1KS0+ZWRyYW1f
c2l6ZV9tYikKKyNkZWZpbmUgSEFTX1dUKGk5MTUpCSgoSVNfSEFTV0VMTChpOTE1KSB8fCBcCisJ
CQkJIElTX0JST0FEV0VMTChpOTE1KSkgJiYgSEFTX0VEUkFNKGk5MTUpKQorCisjZGVmaW5lIEhX
U19ORUVEU19QSFlTSUNBTChpOTE1KQkoSU5URUxfSU5GTyhpOTE1KS0+aHdzX25lZWRzX3BoeXNp
Y2FsKQorCisjZGVmaW5lIEhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMoaTkxNSkgXAorCQkoSU5U
RUxfSU5GTyhpOTE1KS0+aGFzX2xvZ2ljYWxfcmluZ19jb250ZXh0cykKKyNkZWZpbmUgSEFTX0xP
R0lDQUxfUklOR19FTFNRKGk5MTUpIFwKKwkJKElOVEVMX0lORk8oaTkxNSktPmhhc19sb2dpY2Fs
X3JpbmdfZWxzcSkKKyNkZWZpbmUgSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGk5MTUpIFwK
KwkJKElOVEVMX0lORk8oaTkxNSktPmhhc19sb2dpY2FsX3JpbmdfcHJlZW1wdGlvbikKKworI2Rl
ZmluZSBIQVNfRVhFQ0xJU1RTKGk5MTUpIEhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMoaTkxNSkK
KworI2RlZmluZSBJTlRFTF9QUEdUVChpOTE1KSAoSU5URUxfSU5GTyhpOTE1KS0+cHBndHRfdHlw
ZSkKKyNkZWZpbmUgSEFTX1BQR1RUKGk5MTUpIFwKKwkoSU5URUxfUFBHVFQoaTkxNSkgIT0gSU5U
RUxfUFBHVFRfTk9ORSkKKyNkZWZpbmUgSEFTX0ZVTExfUFBHVFQoaTkxNSkgXAorCShJTlRFTF9Q
UEdUVChpOTE1KSA+PSBJTlRFTF9QUEdUVF9GVUxMKQorCisjZGVmaW5lIEhBU19QQUdFX1NJWkVT
KGk5MTUsIHNpemVzKSAoeyBcCiAJR0VNX0JVR19PTigoc2l6ZXMpID09IDApOyBcCi0JKChzaXpl
cykgJiB+SU5URUxfSU5GTyhkZXZfcHJpdiktPnBhZ2Vfc2l6ZXMpID09IDA7IFwKKwkoKHNpemVz
KSAmIH5JTlRFTF9JTkZPKGk5MTUpLT5wYWdlX3NpemVzKSA9PSAwOyBcCiB9KQogCi0jZGVmaW5l
IEhBU19PVkVSTEFZKGRldl9wcml2KQkJIChJTlRFTF9JTkZPKGRldl9wcml2KS0+ZGlzcGxheS5o
YXNfb3ZlcmxheSkKLSNkZWZpbmUgT1ZFUkxBWV9ORUVEU19QSFlTSUNBTChkZXZfcHJpdikgXAot
CQkoSU5URUxfSU5GTyhkZXZfcHJpdiktPmRpc3BsYXkub3ZlcmxheV9uZWVkc19waHlzaWNhbCkK
KyNkZWZpbmUgSEFTX09WRVJMQVkoaTkxNSkJCSAoSU5URUxfSU5GTyhpOTE1KS0+ZGlzcGxheS5o
YXNfb3ZlcmxheSkKKyNkZWZpbmUgT1ZFUkxBWV9ORUVEU19QSFlTSUNBTChpOTE1KSBcCisJCShJ
TlRFTF9JTkZPKGk5MTUpLT5kaXNwbGF5Lm92ZXJsYXlfbmVlZHNfcGh5c2ljYWwpCiAKIC8qIEVh
cmx5IGdlbjIgaGF2ZSBhIHRvdGFsbHkgYnVzdGVkIENTIHRsYiBhbmQgcmVxdWlyZSBwaW5uZWQg
YmF0Y2hlcy4gKi8KLSNkZWZpbmUgSEFTX0JST0tFTl9DU19UTEIoZGV2X3ByaXYpCShJU19JODMw
KGRldl9wcml2KSB8fCBJU19JODQ1RyhkZXZfcHJpdikpCisjZGVmaW5lIEhBU19CUk9LRU5fQ1Nf
VExCKGk5MTUpCShJU19JODMwKGk5MTUpIHx8IElTX0k4NDVHKGk5MTUpKQogCiAvKiBXYVJzRGlz
YWJsZUNvYXJzZVBvd2VyR2F0aW5nOnNrbCxjbmwgKi8KLSNkZWZpbmUgTkVFRFNfV2FSc0Rpc2Fi
bGVDb2Fyc2VQb3dlckdhdGluZyhkZXZfcHJpdikgXAotCShJU19DQU5OT05MQUtFKGRldl9wcml2
KSB8fCBcCi0JIElTX1NLTF9HVDMoZGV2X3ByaXYpIHx8IElTX1NLTF9HVDQoZGV2X3ByaXYpKQor
I2RlZmluZSBORUVEU19XYVJzRGlzYWJsZUNvYXJzZVBvd2VyR2F0aW5nKGk5MTUpIFwKKwkoSVNf
Q0FOTk9OTEFLRShpOTE1KSB8fCBcCisJIElTX1NLTF9HVDMoaTkxNSkgfHwgSVNfU0tMX0dUNChp
OTE1KSkKIAotI2RlZmluZSBIQVNfR01CVVNfSVJRKGRldl9wcml2KSAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA0KQotI2RlZmluZSBIQVNfR01CVVNfQlVSU1RfUkVBRChkZXZfcHJpdikgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTAgfHwgXAotCQkJCQlJU19HRU1JTklMQUtFKGRldl9wcml2KSB8
fCBcCi0JCQkJCUlTX0tBQllMQUtFKGRldl9wcml2KSkKKyNkZWZpbmUgSEFTX0dNQlVTX0lSUShp
OTE1KSAoSU5URUxfR0VOKGk5MTUpID49IDQpCisjZGVmaW5lIEhBU19HTUJVU19CVVJTVF9SRUFE
KGk5MTUpIChJTlRFTF9HRU4oaTkxNSkgPj0gMTAgfHwgXAorCQkJCQlJU19HRU1JTklMQUtFKGk5
MTUpIHx8IFwKKwkJCQkJSVNfS0FCWUxBS0UoaTkxNSkpCiAKIC8qIFdpdGggdGhlIDk0NSBhbmQg
bGF0ZXIsIFkgdGlsaW5nIGdvdCBhZGp1c3RlZCBzbyB0aGF0IGl0IHdhcyAzMiAxMjgtYnl0ZQog
ICogcm93cywgd2hpY2ggY2hhbmdlZCB0aGUgYWxpZ25tZW50IHJlcXVpcmVtZW50cyBhbmQgZmVu
Y2UgcHJvZ3JhbW1pbmcuCiAgKi8KLSNkZWZpbmUgSEFTXzEyOF9CWVRFX1lfVElMSU5HKGRldl9w
cml2KSAoIUlTX0dFTihkZXZfcHJpdiwgMikgJiYgXAotCQkJCQkgIShJU19JOTE1RyhkZXZfcHJp
dikgfHwgXAotCQkJCQkgSVNfSTkxNUdNKGRldl9wcml2KSkpCi0jZGVmaW5lIFNVUFBPUlRTX1RW
KGRldl9wcml2KQkJKElOVEVMX0lORk8oZGV2X3ByaXYpLT5kaXNwbGF5LnN1cHBvcnRzX3R2KQot
I2RlZmluZSBJOTE1X0hBU19IT1RQTFVHKGRldl9wcml2KQkoSU5URUxfSU5GTyhkZXZfcHJpdikt
PmRpc3BsYXkuaGFzX2hvdHBsdWcpCisjZGVmaW5lIEhBU18xMjhfQllURV9ZX1RJTElORyhpOTE1
KSAoIUlTX0dFTihpOTE1LCAyKSAmJiBcCisJCQkJCSAhKElTX0k5MTVHKGk5MTUpIHx8IFwKKwkJ
CQkJIElTX0k5MTVHTShpOTE1KSkpCisjZGVmaW5lIFNVUFBPUlRTX1RWKGk5MTUpCQkoSU5URUxf
SU5GTyhpOTE1KS0+ZGlzcGxheS5zdXBwb3J0c190dikKKyNkZWZpbmUgSTkxNV9IQVNfSE9UUExV
RyhpOTE1KQkoSU5URUxfSU5GTyhpOTE1KS0+ZGlzcGxheS5oYXNfaG90cGx1ZykKIAotI2RlZmlu
ZSBIQVNfRldfQkxDKGRldl9wcml2KSAJKElOVEVMX0dFTihkZXZfcHJpdikgPiAyKQotI2RlZmlu
ZSBIQVNfRkJDKGRldl9wcml2KQkoSU5URUxfSU5GTyhkZXZfcHJpdiktPmRpc3BsYXkuaGFzX2Zi
YykKLSNkZWZpbmUgSEFTX0NVUl9GQkMoZGV2X3ByaXYpCSghSEFTX0dNQ0goZGV2X3ByaXYpICYm
IElOVEVMX0dFTihkZXZfcHJpdikgPj0gNykKKyNkZWZpbmUgSEFTX0ZXX0JMQyhpOTE1KSAJKElO
VEVMX0dFTihpOTE1KSA+IDIpCisjZGVmaW5lIEhBU19GQkMoaTkxNSkJKElOVEVMX0lORk8oaTkx
NSktPmRpc3BsYXkuaGFzX2ZiYykKKyNkZWZpbmUgSEFTX0NVUl9GQkMoaTkxNSkJKCFIQVNfR01D
SChpOTE1KSAmJiBJTlRFTF9HRU4oaTkxNSkgPj0gNykKIAotI2RlZmluZSBIQVNfSVBTKGRldl9w
cml2KQkoSVNfSFNXX1VMVChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKKyNk
ZWZpbmUgSEFTX0lQUyhpOTE1KQkoSVNfSFNXX1VMVChpOTE1KSB8fCBJU19CUk9BRFdFTEwoaTkx
NSkpCiAKLSNkZWZpbmUgSEFTX0RQX01TVChkZXZfcHJpdikJKElOVEVMX0lORk8oZGV2X3ByaXYp
LT5kaXNwbGF5Lmhhc19kcF9tc3QpCisjZGVmaW5lIEhBU19EUF9NU1QoaTkxNSkJKElOVEVMX0lO
Rk8oaTkxNSktPmRpc3BsYXkuaGFzX2RwX21zdCkKIAotI2RlZmluZSBIQVNfRERJKGRldl9wcml2
KQkJIChJTlRFTF9JTkZPKGRldl9wcml2KS0+ZGlzcGxheS5oYXNfZGRpKQotI2RlZmluZSBIQVNf
RlBHQV9EQkdfVU5DTEFJTUVEKGRldl9wcml2KSAoSU5URUxfSU5GTyhkZXZfcHJpdiktPmhhc19m
cGdhX2RiZykKLSNkZWZpbmUgSEFTX1BTUihkZXZfcHJpdikJCSAoSU5URUxfSU5GTyhkZXZfcHJp
diktPmRpc3BsYXkuaGFzX3BzcikKLSNkZWZpbmUgSEFTX1RSQU5TQ09ERVJfRURQKGRldl9wcml2
KQkgKElOVEVMX0lORk8oZGV2X3ByaXYpLT50cmFuc19vZmZzZXRzW1RSQU5TQ09ERVJfRURQXSAh
PSAwKQorI2RlZmluZSBIQVNfRERJKGk5MTUpCQkgKElOVEVMX0lORk8oaTkxNSktPmRpc3BsYXku
aGFzX2RkaSkKKyNkZWZpbmUgSEFTX0ZQR0FfREJHX1VOQ0xBSU1FRChpOTE1KSAoSU5URUxfSU5G
TyhpOTE1KS0+aGFzX2ZwZ2FfZGJnKQorI2RlZmluZSBIQVNfUFNSKGk5MTUpCQkgKElOVEVMX0lO
Rk8oaTkxNSktPmRpc3BsYXkuaGFzX3BzcikKKyNkZWZpbmUgSEFTX1RSQU5TQ09ERVJfRURQKGk5
MTUpCSAoSU5URUxfSU5GTyhpOTE1KS0+dHJhbnNfb2Zmc2V0c1tUUkFOU0NPREVSX0VEUF0gIT0g
MCkKIAotI2RlZmluZSBIQVNfUkM2KGRldl9wcml2KQkJIChJTlRFTF9JTkZPKGRldl9wcml2KS0+
aGFzX3JjNikKLSNkZWZpbmUgSEFTX1JDNnAoZGV2X3ByaXYpCQkgKElOVEVMX0lORk8oZGV2X3By
aXYpLT5oYXNfcmM2cCkKLSNkZWZpbmUgSEFTX1JDNnBwKGRldl9wcml2KQkJIChmYWxzZSkgLyog
SFcgd2FzIG5ldmVyIHZhbGlkYXRlZCAqLworI2RlZmluZSBIQVNfUkM2KGk5MTUpCQkgKElOVEVM
X0lORk8oaTkxNSktPmhhc19yYzYpCisjZGVmaW5lIEhBU19SQzZwKGk5MTUpCQkgKElOVEVMX0lO
Rk8oaTkxNSktPmhhc19yYzZwKQorI2RlZmluZSBIQVNfUkM2cHAoaTkxNSkJCSAoZmFsc2UpIC8q
IEhXIHdhcyBuZXZlciB2YWxpZGF0ZWQgKi8KIAotI2RlZmluZSBIQVNfUlBTKGRldl9wcml2KQko
SU5URUxfSU5GTyhkZXZfcHJpdiktPmhhc19ycHMpCisjZGVmaW5lIEhBU19SUFMoaTkxNSkJKElO
VEVMX0lORk8oaTkxNSktPmhhc19ycHMpCiAKLSNkZWZpbmUgSEFTX0NTUihkZXZfcHJpdikJKElO
VEVMX0lORk8oZGV2X3ByaXYpLT5kaXNwbGF5Lmhhc19jc3IpCisjZGVmaW5lIEhBU19DU1IoaTkx
NSkJKElOVEVMX0lORk8oaTkxNSktPmRpc3BsYXkuaGFzX2NzcikKIAotI2RlZmluZSBIQVNfUlVO
VElNRV9QTShkZXZfcHJpdikgKElOVEVMX0lORk8oZGV2X3ByaXYpLT5oYXNfcnVudGltZV9wbSkK
LSNkZWZpbmUgSEFTXzY0QklUX1JFTE9DKGRldl9wcml2KSAoSU5URUxfSU5GTyhkZXZfcHJpdikt
Pmhhc182NGJpdF9yZWxvYykKKyNkZWZpbmUgSEFTX1JVTlRJTUVfUE0oaTkxNSkgKElOVEVMX0lO
Rk8oaTkxNSktPmhhc19ydW50aW1lX3BtKQorI2RlZmluZSBIQVNfNjRCSVRfUkVMT0MoaTkxNSkg
KElOVEVMX0lORk8oaTkxNSktPmhhc182NGJpdF9yZWxvYykKIAotI2RlZmluZSBIQVNfSVBDKGRl
dl9wcml2KQkJIChJTlRFTF9JTkZPKGRldl9wcml2KS0+ZGlzcGxheS5oYXNfaXBjKQorI2RlZmlu
ZSBIQVNfSVBDKGk5MTUpCQkgKElOVEVMX0lORk8oaTkxNSktPmRpc3BsYXkuaGFzX2lwYykKIAog
LyoKICAqIEZvciBub3csIGFueXRoaW5nIHdpdGggYSBHdUMgcmVxdWlyZXMgdUNvZGUgbG9hZGlu
ZywgYW5kIHRoZW4gc3VwcG9ydHMKICAqIGNvbW1hbmQgc3VibWlzc2lvbiBvbmNlIGxvYWRlZC4g
QnV0IHRoZXNlIGFyZSBsb2dpY2FsbHkgaW5kZXBlbmRlbnQKICAqIHByb3BlcnRpZXMsIHNvIHdl
IGhhdmUgc2VwYXJhdGUgbWFjcm9zIHRvIHRlc3QgdGhlbS4KICAqLwotI2RlZmluZSBIQVNfR1VD
KGRldl9wcml2KQkoSU5URUxfSU5GTyhkZXZfcHJpdiktPmhhc19ndWMpCi0jZGVmaW5lIEhBU19H
VUNfVUNPREUoZGV2X3ByaXYpCShIQVNfR1VDKGRldl9wcml2KSkKLSNkZWZpbmUgSEFTX0dVQ19T
Q0hFRChkZXZfcHJpdikJKEhBU19HVUMoZGV2X3ByaXYpKQorI2RlZmluZSBIQVNfR1VDKGk5MTUp
CShJTlRFTF9JTkZPKGk5MTUpLT5oYXNfZ3VjKQorI2RlZmluZSBIQVNfR1VDX1VDT0RFKGk5MTUp
CShIQVNfR1VDKGk5MTUpKQorI2RlZmluZSBIQVNfR1VDX1NDSEVEKGk5MTUpCShIQVNfR1VDKGk5
MTUpKQogCiAvKiBGb3Igbm93LCBhbnl0aGluZyB3aXRoIGEgR3VDIGhhcyBhbHNvIEh1QyAqLwot
I2RlZmluZSBIQVNfSFVDKGRldl9wcml2KQkoSEFTX0dVQyhkZXZfcHJpdikpCi0jZGVmaW5lIEhB
U19IVUNfVUNPREUoZGV2X3ByaXYpCShIQVNfR1VDKGRldl9wcml2KSkKKyNkZWZpbmUgSEFTX0hV
QyhpOTE1KQkoSEFTX0dVQyhpOTE1KSkKKyNkZWZpbmUgSEFTX0hVQ19VQ09ERShpOTE1KQkoSEFT
X0dVQyhpOTE1KSkKIAogLyogSGF2aW5nIGEgR3VDIGlzIG5vdCB0aGUgc2FtZSBhcyB1c2luZyBh
IEd1QyAqLwotI2RlZmluZSBVU0VTX0dVQyhkZXZfcHJpdikJCWludGVsX3VjX2lzX3VzaW5nX2d1
YyhkZXZfcHJpdikKLSNkZWZpbmUgVVNFU19HVUNfU1VCTUlTU0lPTihkZXZfcHJpdikJaW50ZWxf
dWNfaXNfdXNpbmdfZ3VjX3N1Ym1pc3Npb24oZGV2X3ByaXYpCi0jZGVmaW5lIFVTRVNfSFVDKGRl
dl9wcml2KQkJaW50ZWxfdWNfaXNfdXNpbmdfaHVjKGRldl9wcml2KQorI2RlZmluZSBVU0VTX0dV
QyhpOTE1KQkJaW50ZWxfdWNfaXNfdXNpbmdfZ3VjKGk5MTUpCisjZGVmaW5lIFVTRVNfR1VDX1NV
Qk1JU1NJT04oaTkxNSkJaW50ZWxfdWNfaXNfdXNpbmdfZ3VjX3N1Ym1pc3Npb24oaTkxNSkKKyNk
ZWZpbmUgVVNFU19IVUMoaTkxNSkJCWludGVsX3VjX2lzX3VzaW5nX2h1YyhpOTE1KQogCi0jZGVm
aW5lIEhBU19QT09MRURfRVUoZGV2X3ByaXYpCShJTlRFTF9JTkZPKGRldl9wcml2KS0+aGFzX3Bv
b2xlZF9ldSkKKyNkZWZpbmUgSEFTX1BPT0xFRF9FVShpOTE1KQkoSU5URUxfSU5GTyhpOTE1KS0+
aGFzX3Bvb2xlZF9ldSkKIAogI2RlZmluZSBJTlRFTF9QQ0hfREVWSUNFX0lEX01BU0sJCTB4ZmY4
MAogI2RlZmluZSBJTlRFTF9QQ0hfSUJYX0RFVklDRV9JRF9UWVBFCQkweDNiMDAKQEAgLTI0Mjks
MzYgKzI0MjksMzYgQEAgSVNfU1VCUExBVEZPUk0oY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAjZGVmaW5lIElOVEVMX1BDSF9QM1hfREVWSUNFX0lEX1RZUEUJCTB4NzAwMAog
I2RlZmluZSBJTlRFTF9QQ0hfUUVNVV9ERVZJQ0VfSURfVFlQRQkJMHgyOTAwIC8qIHFlbXUgcTM1
IGhhcyAyOTE4ICovCiAKLSNkZWZpbmUgSU5URUxfUENIX1RZUEUoZGV2X3ByaXYpICgoZGV2X3By
aXYpLT5wY2hfdHlwZSkKLSNkZWZpbmUgSU5URUxfUENIX0lEKGRldl9wcml2KSAoKGRldl9wcml2
KS0+cGNoX2lkKQotI2RlZmluZSBIQVNfUENIX0lDUChkZXZfcHJpdikgKElOVEVMX1BDSF9UWVBF
KGRldl9wcml2KSA9PSBQQ0hfSUNQKQotI2RlZmluZSBIQVNfUENIX0NOUChkZXZfcHJpdikgKElO
VEVMX1BDSF9UWVBFKGRldl9wcml2KSA9PSBQQ0hfQ05QKQotI2RlZmluZSBIQVNfUENIX1NQVChk
ZXZfcHJpdikgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA9PSBQQ0hfU1BUKQotI2RlZmluZSBI
QVNfUENIX0xQVChkZXZfcHJpdikgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA9PSBQQ0hfTFBU
KQotI2RlZmluZSBIQVNfUENIX0xQVF9MUChkZXZfcHJpdikgXAotCShJTlRFTF9QQ0hfSUQoZGV2
X3ByaXYpID09IElOVEVMX1BDSF9MUFRfTFBfREVWSUNFX0lEX1RZUEUgfHwgXAotCSBJTlRFTF9Q
Q0hfSUQoZGV2X3ByaXYpID09IElOVEVMX1BDSF9XUFRfTFBfREVWSUNFX0lEX1RZUEUpCi0jZGVm
aW5lIEhBU19QQ0hfTFBUX0goZGV2X3ByaXYpIFwKLQkoSU5URUxfUENIX0lEKGRldl9wcml2KSA9
PSBJTlRFTF9QQ0hfTFBUX0RFVklDRV9JRF9UWVBFIHx8IFwKLQkgSU5URUxfUENIX0lEKGRldl9w
cml2KSA9PSBJTlRFTF9QQ0hfV1BUX0RFVklDRV9JRF9UWVBFKQotI2RlZmluZSBIQVNfUENIX0NQ
VChkZXZfcHJpdikgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA9PSBQQ0hfQ1BUKQotI2RlZmlu
ZSBIQVNfUENIX0lCWChkZXZfcHJpdikgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA9PSBQQ0hf
SUJYKQotI2RlZmluZSBIQVNfUENIX05PUChkZXZfcHJpdikgKElOVEVMX1BDSF9UWVBFKGRldl9w
cml2KSA9PSBQQ0hfTk9QKQotI2RlZmluZSBIQVNfUENIX1NQTElUKGRldl9wcml2KSAoSU5URUxf
UENIX1RZUEUoZGV2X3ByaXYpICE9IFBDSF9OT05FKQotCi0jZGVmaW5lIEhBU19HTUNIKGRldl9w
cml2KSAoSU5URUxfSU5GTyhkZXZfcHJpdiktPmRpc3BsYXkuaGFzX2dtY2gpCi0KLSNkZWZpbmUg
SEFTX0xTUENPTihkZXZfcHJpdikgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKyNkZWZpbmUg
SU5URUxfUENIX1RZUEUoaTkxNSkgKChpOTE1KS0+cGNoX3R5cGUpCisjZGVmaW5lIElOVEVMX1BD
SF9JRChpOTE1KSAoKGk5MTUpLT5wY2hfaWQpCisjZGVmaW5lIEhBU19QQ0hfSUNQKGk5MTUpIChJ
TlRFTF9QQ0hfVFlQRShpOTE1KSA9PSBQQ0hfSUNQKQorI2RlZmluZSBIQVNfUENIX0NOUChpOTE1
KSAoSU5URUxfUENIX1RZUEUoaTkxNSkgPT0gUENIX0NOUCkKKyNkZWZpbmUgSEFTX1BDSF9TUFQo
aTkxNSkgKElOVEVMX1BDSF9UWVBFKGk5MTUpID09IFBDSF9TUFQpCisjZGVmaW5lIEhBU19QQ0hf
TFBUKGk5MTUpIChJTlRFTF9QQ0hfVFlQRShpOTE1KSA9PSBQQ0hfTFBUKQorI2RlZmluZSBIQVNf
UENIX0xQVF9MUChpOTE1KSBcCisJKElOVEVMX1BDSF9JRChpOTE1KSA9PSBJTlRFTF9QQ0hfTFBU
X0xQX0RFVklDRV9JRF9UWVBFIHx8IFwKKwkgSU5URUxfUENIX0lEKGk5MTUpID09IElOVEVMX1BD
SF9XUFRfTFBfREVWSUNFX0lEX1RZUEUpCisjZGVmaW5lIEhBU19QQ0hfTFBUX0goaTkxNSkgXAor
CShJTlRFTF9QQ0hfSUQoaTkxNSkgPT0gSU5URUxfUENIX0xQVF9ERVZJQ0VfSURfVFlQRSB8fCBc
CisJIElOVEVMX1BDSF9JRChpOTE1KSA9PSBJTlRFTF9QQ0hfV1BUX0RFVklDRV9JRF9UWVBFKQor
I2RlZmluZSBIQVNfUENIX0NQVChpOTE1KSAoSU5URUxfUENIX1RZUEUoaTkxNSkgPT0gUENIX0NQ
VCkKKyNkZWZpbmUgSEFTX1BDSF9JQlgoaTkxNSkgKElOVEVMX1BDSF9UWVBFKGk5MTUpID09IFBD
SF9JQlgpCisjZGVmaW5lIEhBU19QQ0hfTk9QKGk5MTUpIChJTlRFTF9QQ0hfVFlQRShpOTE1KSA9
PSBQQ0hfTk9QKQorI2RlZmluZSBIQVNfUENIX1NQTElUKGk5MTUpIChJTlRFTF9QQ0hfVFlQRShp
OTE1KSAhPSBQQ0hfTk9ORSkKKworI2RlZmluZSBIQVNfR01DSChpOTE1KSAoSU5URUxfSU5GTyhp
OTE1KS0+ZGlzcGxheS5oYXNfZ21jaCkKKworI2RlZmluZSBIQVNfTFNQQ09OKGk5MTUpIChJTlRF
TF9HRU4oaTkxNSkgPj0gOSkKIAogLyogRFBGID09IGR5bmFtaWMgcGFyaXR5IGZlYXR1cmUgKi8K
LSNkZWZpbmUgSEFTX0wzX0RQRihkZXZfcHJpdikgKElOVEVMX0lORk8oZGV2X3ByaXYpLT5oYXNf
bDNfZHBmKQotI2RlZmluZSBOVU1fTDNfU0xJQ0VTKGRldl9wcml2KSAoSVNfSFNXX0dUMyhkZXZf
cHJpdikgPyBcCi0JCQkJIDIgOiBIQVNfTDNfRFBGKGRldl9wcml2KSkKKyNkZWZpbmUgSEFTX0wz
X0RQRihpOTE1KSAoSU5URUxfSU5GTyhpOTE1KS0+aGFzX2wzX2RwZikKKyNkZWZpbmUgTlVNX0wz
X1NMSUNFUyhpOTE1KSAoSVNfSFNXX0dUMyhpOTE1KSA/IFwKKwkJCQkgMiA6IEhBU19MM19EUEYo
aTkxNSkpCiAKICNkZWZpbmUgR1RfRlJFUVVFTkNZX01VTFRJUExJRVIgNTAKICNkZWZpbmUgR0VO
OV9GUkVRX1NDQUxFUiAzCiAKLSNkZWZpbmUgSEFTX0RJU1BMQVkoZGV2X3ByaXYpIChJTlRFTF9J
TkZPKGRldl9wcml2KS0+bnVtX3BpcGVzID4gMCkKKyNkZWZpbmUgSEFTX0RJU1BMQVkoaTkxNSkg
KElOVEVMX0lORk8oaTkxNSktPm51bV9waXBlcyA+IDApCiAKICNpbmNsdWRlICJpOTE1X3RyYWNl
LmgiCiAKQEAgLTI0NzEsMjQgKzI0NzEsMjQgQEAgc3RhdGljIGlubGluZSBib29sIGludGVsX3Z0
ZF9hY3RpdmUodm9pZCkKIAlyZXR1cm4gZmFsc2U7CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBp
bnRlbF9zY2Fub3V0X25lZWRzX3Z0ZF93YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfc2Nhbm91dF9uZWVkc192dGRfd2Eoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JcmV0dXJuIElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gNiAmJiBpbnRlbF92dGRfYWN0aXZlKCk7CisJcmV0dXJuIElOVEVMX0dFTihpOTE1KSA+PSA2
ICYmIGludGVsX3Z0ZF9hY3RpdmUoKTsKIH0KIAogc3RhdGljIGlubGluZSBib29sCi1pbnRlbF9n
Z3R0X3VwZGF0ZV9uZWVkc192dGRfd2Eoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQoraW50ZWxfZ2d0dF91cGRhdGVfbmVlZHNfdnRkX3dhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCXJldHVybiBJU19CUk9YVE9OKGRldl9wcml2KSAmJiBpbnRlbF92dGRfYWN0
aXZlKCk7CisJcmV0dXJuIElTX0JST1hUT04oaTkxNSkgJiYgaW50ZWxfdnRkX2FjdGl2ZSgpOwog
fQogCiAvKiBpOTE1X2Rydi5jICovCiB2b2lkIF9fcHJpbnRmKDMsIDQpCi1fX2k5MTVfcHJpbnRr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3QgY2hhciAqbGV2ZWwsCitf
X2k5MTVfcHJpbnRrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBjb25zdCBjaGFyICps
ZXZlbCwKIAkgICAgICBjb25zdCBjaGFyICpmbXQsIC4uLik7CiAKLSNkZWZpbmUgaTkxNV9yZXBv
cnRfZXJyb3IoZGV2X3ByaXYsIGZtdCwgLi4uKQkJCQkgICBcCi0JX19pOTE1X3ByaW50ayhkZXZf
cHJpdiwgS0VSTl9FUlIsIGZtdCwgIyNfX1ZBX0FSR1NfXykKKyNkZWZpbmUgaTkxNV9yZXBvcnRf
ZXJyb3IoaTkxNSwgZm10LCAuLi4pCQkJCSAgIFwKKwlfX2k5MTVfcHJpbnRrKGk5MTUsIEtFUk5f
RVJSLCBmbXQsICMjX19WQV9BUkdTX18pCiAKICNpZmRlZiBDT05GSUdfQ09NUEFUCiBleHRlcm4g
bG9uZyBpOTE1X2NvbXBhdF9pb2N0bChzdHJ1Y3QgZmlsZSAqZmlscCwgdW5zaWduZWQgaW50IGNt
ZCwKQEAgLTI1MDMsMTIgKzI1MDMsMTIgQEAgZXh0ZXJuIGludCBpOTE1X2RyaXZlcl9sb2FkKHN0
cnVjdCBwY2lfZGV2ICpwZGV2LAogZXh0ZXJuIHZvaWQgaTkxNV9kcml2ZXJfdW5sb2FkKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYpOwogCiBleHRlcm4gdm9pZCBpbnRlbF9lbmdpbmVfaW5pdF9oYW5n
Y2hlY2soc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKLWV4dGVybiB2b2lkIGludGVs
X2hhbmdjaGVja19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1pbnQg
dmx2X2ZvcmNlX2dmeF9jbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJv
b2wgb24pOworZXh0ZXJuIHZvaWQgaW50ZWxfaGFuZ2NoZWNrX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOworaW50IHZsdl9mb3JjZV9nZnhfY2xvY2soc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIGJvb2wgb24pOwogCi11MzIgaW50ZWxfY2FsY3VsYXRlX21jcl9zX3Nz
X3NlbGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordTMyIGludGVsX2Nh
bGN1bGF0ZV9tY3Jfc19zc19zZWxlY3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwog
Ci1zdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9xdWV1ZV9oYW5nY2hlY2soc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGlubGluZSB2b2lkIGk5MTVfcXVldWVfaGFuZ2No
ZWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXVuc2lnbmVkIGxvbmcgZGVs
YXk7CiAKQEAgLTI1MjIsMjggKzI1MjIsMjggQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfcXVl
dWVfaGFuZ2NoZWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWRlbGF5
ID0gcm91bmRfamlmZmllc191cF9yZWxhdGl2ZShEUk1fSTkxNV9IQU5HQ0hFQ0tfSklGRklFUyk7
CiAJcXVldWVfZGVsYXllZF93b3JrKHN5c3RlbV9sb25nX3dxLAotCQkJICAgJmRldl9wcml2LT5n
cHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmssIGRlbGF5KTsKKwkJCSAgICZpOTE1LT5ncHVfZXJyb3Iu
aGFuZ2NoZWNrX3dvcmssIGRlbGF5KTsKIH0KIAotc3RhdGljIGlubGluZSBib29sIGludGVsX2d2
dF9hY3RpdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGlubGlu
ZSBib29sIGludGVsX2d2dF9hY3RpdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
Ci0JcmV0dXJuIGRldl9wcml2LT5ndnQ7CisJcmV0dXJuIGk5MTUtPmd2dDsKIH0KIAotc3RhdGlj
IGlubGluZSBib29sIGludGVsX3ZncHVfYWN0aXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyBpbmxpbmUgYm9vbCBpbnRlbF92Z3B1X2FjdGl2ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1cm4gZGV2X3ByaXYtPnZncHUuYWN0aXZlOwor
CXJldHVybiBpOTE1LT52Z3B1LmFjdGl2ZTsKIH0KIAogLyogaTkxNV9nZW0uYyAqLwotaW50IGk5
MTVfZ2VtX2luaXRfdXNlcnB0cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwot
dm9pZCBpOTE1X2dlbV9jbGVhbnVwX3VzZXJwdHIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KTsKK2ludCBpOTE1X2dlbV9pbml0X3VzZXJwdHIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwordm9pZCBpOTE1X2dlbV9jbGVhbnVwX3VzZXJwdHIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBpOTE1X2dlbV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSk7Ci1pbnQgaTkxNV9nZW1faW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X2dlbV9jbGVhbnVwX2Vhcmx5KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGk5MTVfZ2VtX2xvYWRfaW5pdF9mZW5j
ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLWludCBpOTE1X2dlbV9mcmVl
emUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLWludCBpOTE1X2dlbV9mcmVl
emVfbGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaW50IGk5MTVfZ2Vt
X2luaXRfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpOTE1X2dl
bV9jbGVhbnVwX2Vhcmx5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaTkx
NV9nZW1fbG9hZF9pbml0X2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Citp
bnQgaTkxNV9nZW1fZnJlZXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK2ludCBp
OTE1X2dlbV9mcmVlemVfbGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKIHN0
YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewpAQCAtMjU5MSw3ICsyNTkxLDcgQEAgaTkxNV9nZW1fb2Jq
ZWN0X2dndHRfcGluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIGludCBpOTE1
X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOwogCi12
b2lkIGk5MTVfZ2VtX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwordm9pZCBpOTE1X2dlbV9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOwogCiBzdGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKIGk5MTVfbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCkBAIC0yNjMzLDIw
ICsyNjMzLDIwIEBAIHN0YXRpYyBpbmxpbmUgdTMyIGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KHN0
cnVjdCBpOTE1X2dwdV9lcnJvciAqZXJyb3IsCiAJcmV0dXJuIFJFQURfT05DRShlcnJvci0+cmVz
ZXRfZW5naW5lX2NvdW50W2VuZ2luZS0+aWRdKTsKIH0KIAotdm9pZCBpOTE1X2dlbV9zZXRfd2Vk
Z2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1ib29sIGk5MTVfZ2VtX3Vu
c2V0X3dlZGdlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpOTE1
X2dlbV9zZXRfd2VkZ2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK2Jvb2wgaTkx
NV9nZW1fdW5zZXRfd2VkZ2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogdm9p
ZCBpOTE1X2dlbV9pbml0X21taW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwotaW50
IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdik7Ci1pbnQgX19tdXN0X2NoZWNrIGk5MTVfZ2VtX2luaXRfaHcoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaTkxNV9nZW1faW5pdF9zd2l6emxpbmcoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaTkxNV9nZW1fZmluaV9odyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X2dlbV9maW5pKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1pbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnQgX19tdXN0X2NoZWNrIGk5
MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworaW50IF9fbXVzdF9j
aGVjayBpOTE1X2dlbV9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3Zv
aWQgaTkxNV9nZW1faW5pdF9zd2l6emxpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Owordm9pZCBpOTE1X2dlbV9maW5pX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsK
K3ZvaWQgaTkxNV9nZW1fZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitpbnQg
aTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CSAgIHVuc2lnbmVkIGludCBmbGFncywgbG9uZyB0aW1lb3V0KTsKLXZvaWQgaTkxNV9nZW1fc3Vz
cGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X2dlbV9z
dXNwZW5kX2xhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaTkx
NV9nZW1fcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGk5
MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpOTE1
X2dlbV9zdXNwZW5kX2xhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBp
OTE1X2dlbV9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm1fZmF1bHRf
dCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZik7CiAKIGludCBpOTE1X2dlbV9v
cGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUp
OwpAQCAtMjY2MywxMiArMjY2MywxMiBAQCBzdHJ1Y3QgZG1hX2J1ZiAqaTkxNV9nZW1fcHJpbWVf
ZXhwb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAKIC8qIGk5MTVfZ2VtX2ZlbmNlX3JlZy5j
ICovCiBzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICoKLWk5MTVfcmVzZXJ2ZV9mZW5jZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaTkxNV9yZXNlcnZlX2ZlbmNlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHZvaWQgaTkxNV91bnJlc2VydmVfZmVuY2Uoc3Ry
dWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UpOwogCi12b2lkIGk5MTVfZ2VtX3Jlc3RvcmVf
ZmVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGk5MTVfZ2Vt
X3Jlc3RvcmVfZmVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAotdm9pZCBp
OTE1X2dlbV9kZXRlY3RfYml0XzZfc3dpenpsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwordm9pZCBpOTE1X2dlbV9kZXRlY3RfYml0XzZfc3dpenpsZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGk5MTVfZ2VtX29iamVjdF9kb19iaXRfMTdfc3dpenps
ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJCSAgICAgICBzdHJ1Y3Qgc2df
dGFibGUgKnBhZ2VzKTsKIHZvaWQgaTkxNV9nZW1fb2JqZWN0X3NhdmVfYml0XzE3X3N3aXp6bGUo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKQEAgLTI3MTUsNDAgKzI3MTUsNDAgQEAg
aW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZShzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSwKIAkJCQkJIHVuc2lnbmVkIGludCBmbGFncyk7CiBpbnQgaTkxNV9nZW1f
ZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pOwogCi12b2lkIGk5MTVfZ2Vt
X2ZsdXNoX2dndHRfd3JpdGVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2
b2lkIGk5MTVfZ2VtX2ZsdXNoX2dndHRfd3JpdGVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKIAogLyogYmVsb25ncyBpbiBpOTE1X2dlbV9ndHQuaCAqLwotc3RhdGljIGlubGluZSB2
b2lkIGk5MTVfZ2VtX2NoaXBzZXRfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIGlubGluZSB2b2lkIGk5MTVfZ2VtX2NoaXBzZXRfZmx1c2goc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJd21iKCk7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPCA2KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA2KQogCQlpbnRlbF9ndHRfY2hpcHNldF9m
bHVzaCgpOwogfQogCiAvKiBpOTE1X2dlbV9zdG9sZW4uYyAqLwotaW50IGk5MTVfZ2VtX3N0b2xl
bl9pbnNlcnRfbm9kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnQgaTkx
NV9nZW1fc3RvbGVuX2luc2VydF9ub2RlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSwgdTY0IHNpemUsCiAJCQkJdW5zaWduZWQgYWxp
Z25tZW50KTsKLWludCBpOTE1X2dlbV9zdG9sZW5faW5zZXJ0X25vZGVfaW5fcmFuZ2Uoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50IGk5MTVfZ2VtX3N0b2xlbl9pbnNlcnRf
bm9kZV9pbl9yYW5nZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJIHN0cnVj
dCBkcm1fbW1fbm9kZSAqbm9kZSwgdTY0IHNpemUsCiAJCQkJCSB1bnNpZ25lZCBhbGlnbm1lbnQs
IHU2NCBzdGFydCwKIAkJCQkJIHU2NCBlbmQpOwotdm9pZCBpOTE1X2dlbV9zdG9sZW5fcmVtb3Zl
X25vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpOTE1X2dlbV9z
dG9sZW5fcmVtb3ZlX25vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJIHN0
cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSk7Ci1pbnQgaTkxNV9nZW1faW5pdF9zdG9sZW4oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaTkxNV9nZW1fY2xlYW51cF9zdG9s
ZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2ludCBpOTE1X2dlbV9pbml0
X3N0b2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGk5MTVfZ2VtX2Ns
ZWFudXBfc3RvbGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICoKLWk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2k5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVu
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgcmVzb3VyY2Vfc2l6ZV90
IHNpemUpOwogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgotaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgICAgICAgcmVzb3VyY2Vfc2l6ZV90
IHN0b2xlbl9vZmZzZXQsCiAJCQkJCSAgICAgICByZXNvdXJjZV9zaXplX3QgZ3R0X29mZnNldCwK
IAkJCQkJICAgICAgIHJlc291cmNlX3NpemVfdCBzaXplKTsKIAogLyogaTkxNV9nZW1faW50ZXJu
YWwuYyAqLwogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgotaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9pbnRlcm5hbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpOTE1X2dl
bV9vYmplY3RfY3JlYXRlX2ludGVybmFsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCXBoeXNfYWRkcl90IHNpemUpOwogCiAvKiBpOTE1X2dlbV9zaHJpbmtlci5jICovCkBAIC0y
NzcxLDIxICsyNzcxLDIxIEBAIHZvaWQgaTkxNV9nZW1fc2hyaW5rZXJfdGFpbnRzX211dGV4KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogLyogaTkxNV9nZW1fdGlsaW5nLmMgKi8KIHN0
YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9vYmplY3RfbmVlZHNfYml0MTdfc3dpenpsZShzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwogCi0JcmV0dXJuIGRldl9wcml2
LT5tbS5iaXRfNl9zd2l6emxlX3ggPT0gSTkxNV9CSVRfNl9TV0laWkxFXzlfMTBfMTcgJiYKKwly
ZXR1cm4gaTkxNS0+bW0uYml0XzZfc3dpenpsZV94ID09IEk5MTVfQklUXzZfU1dJWlpMRV85XzEw
XzE3ICYmCiAJCWk5MTVfZ2VtX29iamVjdF9pc190aWxlZChvYmopOwogfQogCi11MzIgaTkxNV9n
ZW1fZmVuY2Vfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBzaXpl
LAordTMyIGk5MTVfZ2VtX2ZlbmNlX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IHUzMiBzaXplLAogCQkJdW5zaWduZWQgaW50IHRpbGluZywgdW5zaWduZWQgaW50IHN0cmlkZSk7
Ci11MzIgaTkxNV9nZW1fZmVuY2VfYWxpZ25tZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgdTMyIHNpemUsCit1MzIgaTkxNV9nZW1fZmVuY2VfYWxpZ25tZW50KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgc2l6ZSwKIAkJCSAgICAgdW5zaWduZWQgaW50IHRp
bGluZywgdW5zaWduZWQgaW50IHN0cmlkZSk7CiAKIGNvbnN0IGNoYXIgKmk5MTVfY2FjaGVfbGV2
ZWxfc3RyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgdHlwZSk7CiAKIC8qIGk5
MTVfY21kX3BhcnNlci5jICovCi1pbnQgaTkxNV9jbWRfcGFyc2VyX2dldF92ZXJzaW9uKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CitpbnQgaTkxNV9jbWRfcGFyc2VyX2dldF92
ZXJzaW9uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHZvaWQgaW50ZWxfZW5naW5l
X2luaXRfY21kX3BhcnNlcihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogdm9pZCBp
bnRlbF9lbmdpbmVfY2xlYW51cF9jbWRfcGFyc2VyKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSk7CiBpbnQgaW50ZWxfZW5naW5lX2NtZF9wYXJzZXIoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLApAQCAtMjc5Niw1MiArMjc5Niw1MiBAQCBpbnQgaW50ZWxfZW5naW5lX2NtZF9w
YXJzZXIoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJICAgIGJvb2wgaXNfbWFz
dGVyKTsKIAogLyogaTkxNV9wZXJmLmMgKi8KLWV4dGVybiB2b2lkIGk5MTVfcGVyZl9pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1leHRlcm4gdm9pZCBpOTE1X3BlcmZf
ZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotZXh0ZXJuIHZvaWQgaTkx
NV9wZXJmX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1leHRl
cm4gdm9pZCBpOTE1X3BlcmZfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOworZXh0ZXJuIHZvaWQgaTkxNV9wZXJmX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOworZXh0ZXJuIHZvaWQgaTkxNV9wZXJmX2Zpbmkoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOworZXh0ZXJuIHZvaWQgaTkxNV9wZXJmX3JlZ2lzdGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl91bnJlZ2lzdGVyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogLyogaTkxNV9zdXNwZW5kLmMgKi8KLWV4
dGVybiBpbnQgaTkxNV9zYXZlX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dik7Ci1leHRlcm4gaW50IGk5MTVfcmVzdG9yZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOworZXh0ZXJuIGludCBpOTE1X3NhdmVfc3RhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOworZXh0ZXJuIGludCBpOTE1X3Jlc3RvcmVfc3RhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiAvKiBpOTE1X3N5c2ZzLmMgKi8KLXZvaWQgaTkxNV9z
ZXR1cF9zeXNmcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1
X3RlYXJkb3duX3N5c2ZzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lk
IGk5MTVfc2V0dXBfc3lzZnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBp
OTE1X3RlYXJkb3duX3N5c2ZzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogLyog
aW50ZWxfZGV2aWNlX2luZm8uYyAqLwogc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfZGV2aWNl
X2luZm8gKgotbWt3cml0ZV9kZXZpY2VfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitta3dyaXRlX2RldmljZV9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewotCXJldHVybiAoc3RydWN0IGludGVsX2RldmljZV9pbmZvICopSU5URUxfSU5GTyhkZXZf
cHJpdik7CisJcmV0dXJuIChzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gKilJTlRFTF9JTkZPKGk5
MTUpOwogfQogCiAvKiBtb2Rlc2V0dGluZyAqLwogZXh0ZXJuIHZvaWQgaW50ZWxfbW9kZXNldF9p
bml0X2h3KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogZXh0ZXJuIGludCBpbnRlbF9tb2Rlc2V0
X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiBleHRlcm4gdm9pZCBpbnRlbF9tb2Rlc2V0
X2NsZWFudXAoc3RydWN0IGRybV9kZXZpY2UgKmRldik7Ci1leHRlcm4gaW50IGludGVsX21vZGVz
ZXRfdmdhX3NldF9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitleHRl
cm4gaW50IGludGVsX21vZGVzZXRfdmdhX3NldF9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkgICAgICAgYm9vbCBzdGF0ZSk7CiBleHRlcm4gdm9pZCBpbnRlbF9kaXNw
bGF5X3Jlc3VtZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KTsKLWV4dGVybiB2b2lkIGk5MTVfcmVk
aXNhYmxlX3ZnYShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotZXh0ZXJuIHZv
aWQgaTkxNV9yZWRpc2FibGVfdmdhX3Bvd2VyX29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7Ci1leHRlcm4gdm9pZCBpbnRlbF9pbml0X3BjaF9yZWZjbGsoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcmVkaXNhYmxlX3ZnYShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitleHRlcm4gdm9pZCBpOTE1X3JlZGlzYWJs
ZV92Z2FfcG93ZXJfb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworZXh0ZXJuIHZv
aWQgaW50ZWxfaW5pdF9wY2hfcmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsK
IAogaW50IGk5MTVfcmVnX3JlYWRfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAq
ZGF0YSwKIAkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CiAKIGV4dGVybiBzdHJ1Y3QgaW50ZWxf
ZGlzcGxheV9lcnJvcl9zdGF0ZSAqCi1pbnRlbF9kaXNwbGF5X2NhcHR1cmVfZXJyb3Jfc3RhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2ludGVsX2Rpc3BsYXlfY2FwdHVy
ZV9lcnJvcl9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBleHRlcm4gdm9p
ZCBpbnRlbF9kaXNwbGF5X3ByaW50X2Vycm9yX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9z
dGF0ZV9idWYgKmUsCiAJCQkJCSAgICBzdHJ1Y3QgaW50ZWxfZGlzcGxheV9lcnJvcl9zdGF0ZSAq
ZXJyb3IpOwogCiAjZGVmaW5lIF9fSTkxNV9SRUdfT1Aob3BfXywgZGV2X3ByaXZfXywgLi4uKSBc
CiAJaW50ZWxfdW5jb3JlXyMjb3BfXygmKGRldl9wcml2X18pLT51bmNvcmUsIF9fVkFfQVJHU19f
KQogCi0jZGVmaW5lIEk5MTVfUkVBRChyZWdfXykJIF9fSTkxNV9SRUdfT1AocmVhZCwgZGV2X3By
aXYsIChyZWdfXykpCi0jZGVmaW5lIEk5MTVfV1JJVEUocmVnX18sIHZhbF9fKSBfX0k5MTVfUkVH
X09QKHdyaXRlLCBkZXZfcHJpdiwgKHJlZ19fKSwgKHZhbF9fKSkKKyNkZWZpbmUgSTkxNV9SRUFE
KHJlZ19fKQkgX19JOTE1X1JFR19PUChyZWFkLCBpOTE1LCAocmVnX18pKQorI2RlZmluZSBJOTE1
X1dSSVRFKHJlZ19fLCB2YWxfXykgX19JOTE1X1JFR19PUCh3cml0ZSwgaTkxNSwgKHJlZ19fKSwg
KHZhbF9fKSkKIAotI2RlZmluZSBQT1NUSU5HX1JFQUQocmVnX18pCV9fSTkxNV9SRUdfT1AocG9z
dGluZ19yZWFkLCBkZXZfcHJpdiwgKHJlZ19fKSkKKyNkZWZpbmUgUE9TVElOR19SRUFEKHJlZ19f
KQlfX0k5MTVfUkVHX09QKHBvc3RpbmdfcmVhZCwgaTkxNSwgKHJlZ19fKSkKIAogLyogVGhlc2Ug
YXJlIHVudHJhY2VkIG1taW8tYWNjZXNzb3JzIHRoYXQgYXJlIG9ubHkgdmFsaWQgdG8gYmUgdXNl
ZCBpbnNpZGUKICAqIGNyaXRpY2FsIHNlY3Rpb25zLCBzdWNoIGFzIGluc2lkZSBJUlEgaGFuZGxl
cnMsIHdoZXJlIGZvcmNld2FrZSBpcyBleHBsaWNpdGx5CkBAIC0yODUxLDEzICsyODUxLDEzIEBA
IGV4dGVybiB2b2lkIGludGVsX2Rpc3BsYXlfcHJpbnRfZXJyb3Jfc3RhdGUoc3RydWN0IGRybV9p
OTE1X2Vycm9yX3N0YXRlX2J1ZiAqZSwKICAqCiAgKiBBcyBhbiBleGFtcGxlLCB0aGVzZSBhY2Nl
c3NvcnMgY2FuIHBvc3NpYmx5IGJlIHVzZWQgYmV0d2VlbjoKICAqCi0gKiBzcGluX2xvY2tfaXJx
KCZkZXZfcHJpdi0+dW5jb3JlLmxvY2spOworICogc3Bpbl9sb2NrX2lycSgmaTkxNS0+dW5jb3Jl
LmxvY2spOwogICogaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXRfX2xvY2tlZCgpOwogICoKICAq
IGFuZAogICoKICAqIGludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0X19sb2NrZWQoKTsKLSAqIHNw
aW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrKTsKKyAqIHNwaW5fdW5sb2NrX2ly
cSgmaTkxNS0+dW5jb3JlLmxvY2spOwogICoKICAqCiAgKiBOb3RlOiBzb21lIHJlZ2lzdGVycyBt
YXkgbm90IG5lZWQgZm9yY2V3YWtlIGhlbGQsIHNvCkBAIC0yODY2LDE4ICsyODY2LDE4IEBAIGV4
dGVybiB2b2lkIGludGVsX2Rpc3BsYXlfcHJpbnRfZXJyb3Jfc3RhdGUoc3RydWN0IGRybV9pOTE1
X2Vycm9yX3N0YXRlX2J1ZiAqZSwKICAqCiAgKiBDZXJ0YWluIGFyY2hpdGVjdHVyZXMgd2lsbCBk
aWUgaWYgdGhlIHNhbWUgY2FjaGVsaW5lIGlzIGNvbmN1cnJlbnRseSBhY2Nlc3NlZAogICogYnkg
ZGlmZmVyZW50IGNsaWVudHMgKGUuZy4gb24gSXZ5YnJpZGdlKS4gQWNjZXNzIHRvIHJlZ2lzdGVy
cyBzaG91bGQKLSAqIHRoZXJlZm9yZSBnZW5lcmFsbHkgYmUgc2VyaWFsaXNlZCwgYnkgZWl0aGVy
IHRoZSBkZXZfcHJpdi0+dW5jb3JlLmxvY2sgb3IKKyAqIHRoZXJlZm9yZSBnZW5lcmFsbHkgYmUg
c2VyaWFsaXNlZCwgYnkgZWl0aGVyIHRoZSBpOTE1LT51bmNvcmUubG9jayBvcgogICogYSBtb3Jl
IGxvY2FsaXNlZCBsb2NrIGd1YXJkaW5nIGFsbCBhY2Nlc3MgdG8gdGhhdCBiYW5rIG9mIHJlZ2lz
dGVycy4KICAqLwotI2RlZmluZSBJOTE1X1JFQURfRlcocmVnX18pIF9fSTkxNV9SRUdfT1AocmVh
ZF9mdywgZGV2X3ByaXYsIChyZWdfXykpCi0jZGVmaW5lIEk5MTVfV1JJVEVfRlcocmVnX18sIHZh
bF9fKSBfX0k5MTVfUkVHX09QKHdyaXRlX2Z3LCBkZXZfcHJpdiwgKHJlZ19fKSwgKHZhbF9fKSkK
KyNkZWZpbmUgSTkxNV9SRUFEX0ZXKHJlZ19fKSBfX0k5MTVfUkVHX09QKHJlYWRfZncsIGk5MTUs
IChyZWdfXykpCisjZGVmaW5lIEk5MTVfV1JJVEVfRlcocmVnX18sIHZhbF9fKSBfX0k5MTVfUkVH
X09QKHdyaXRlX2Z3LCBpOTE1LCAocmVnX18pLCAodmFsX18pKQogCiAvKiAiQnJvYWRjYXN0IFJH
QiIgcHJvcGVydHkgKi8KICNkZWZpbmUgSU5URUxfQlJPQURDQVNUX1JHQl9BVVRPIDAKICNkZWZp
bmUgSU5URUxfQlJPQURDQVNUX1JHQl9GVUxMIDEKICNkZWZpbmUgSU5URUxfQlJPQURDQVNUX1JH
Ql9MSU1JVEVEIDIKIAotdm9pZCBpOTE1X21lbWNweV9pbml0X2Vhcmx5KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGk5MTVfbWVtY3B5X2luaXRfZWFybHkoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogYm9vbCBpOTE1X21lbWNweV9mcm9tX3djKHZvaWQg
KmRzdCwgY29uc3Qgdm9pZCAqc3JjLCB1bnNpZ25lZCBsb25nIGxlbik7CiAKIC8qIFRoZSBtb3Zu
dGRxYSBpbnN0cnVjdGlvbnMgdXNlZCBmb3IgbWVtY3B5LWZyb20td2MgcmVxdWlyZSAxNi1ieXRl
IGFsaWdubWVudCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDQwMTdlY2Y1NjFmNi4uMTc3
NGM3NjA0MDc2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTE0OSw3ICsxNDksNyBAQCBp
OTE1X2dlbV9waHlzX3B3cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiBz
dGF0aWMgaW50CiBpOTE1X2dlbV9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlLAotCQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQl1NjQgKnNpemVfcCwKIAkJdTMyICpoYW5kbGVfcCkKIHsKQEAgLTE2Myw3ICsx
NjMsNyBAQCBpOTE1X2dlbV9jcmVhdGUoc3RydWN0IGRybV9maWxlICpmaWxlLAogCQlyZXR1cm4g
LUVJTlZBTDsKIAogCS8qIEFsbG9jYXRlIHRoZSBuZXcgb2JqZWN0ICovCi0Jb2JqID0gaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZfcHJpdiwgc2l6ZSk7CisJb2JqID0gaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBzaXplKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJl
dHVybiBQVFJfRVJSKG9iaik7CiAKQEAgLTIyMywxNiArMjIzLDE2IEBAIGludAogaTkxNV9nZW1f
Y3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCSAgICAg
IHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9jcmVhdGUgKmFyZ3MgPSBkYXRhOwog
Ci0JaTkxNV9nZW1fZmx1c2hfZnJlZV9vYmplY3RzKGRldl9wcml2KTsKKwlpOTE1X2dlbV9mbHVz
aF9mcmVlX29iamVjdHMoaTkxNSk7CiAKLQlyZXR1cm4gaTkxNV9nZW1fY3JlYXRlKGZpbGUsIGRl
dl9wcml2LAorCXJldHVybiBpOTE1X2dlbV9jcmVhdGUoZmlsZSwgaTkxNSwKIAkJCSAgICAgICAm
YXJncy0+c2l6ZSwgJmFyZ3MtPmhhbmRsZSk7CiB9CiAKLXZvaWQgaTkxNV9nZW1fZmx1c2hfZ2d0
dF93cml0ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpOTE1X2dl
bV9mbHVzaF9nZ3R0X3dyaXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlp
bnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIApAQCAtMjU3LDEzICsyNTcsMTMgQEAgdm9pZCBpOTE1
X2dlbV9mbHVzaF9nZ3R0X3dyaXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAKIAl3bWIoKTsKIAotCWlmIChJTlRFTF9JTkZPKGRldl9wcml2KS0+aGFzX2NvaGVyZW50X2dn
dHQpCisJaWYgKElOVEVMX0lORk8oaTkxNSktPmhhc19jb2hlcmVudF9nZ3R0KQogCQlyZXR1cm47
CiAKLQlpOTE1X2dlbV9jaGlwc2V0X2ZsdXNoKGRldl9wcml2KTsKKwlpOTE1X2dlbV9jaGlwc2V0
X2ZsdXNoKGk5MTUpOwogCi0Jd2l0aF9pbnRlbF9ydW50aW1lX3BtKGRldl9wcml2LCB3YWtlcmVm
KSB7Ci0JCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOwor
CXdpdGhfaW50ZWxfcnVudGltZV9wbShpOTE1LCB3YWtlcmVmKSB7CisJCXN0cnVjdCBpbnRlbF91
bmNvcmUgKnVuY29yZSA9ICZpOTE1LT51bmNvcmU7CiAKIAkJc3Bpbl9sb2NrX2lycSgmdW5jb3Jl
LT5sb2NrKTsKIAkJaW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVhZF9mdyh1bmNvcmUsCkBAIC04ODQs
NyArODg0LDcgQEAgaTkxNV9nZW1fc3dfZmluaXNoX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaTkxNV9nZW1fcnVudGltZV9z
dXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaTkxNV9nZW1f
cnVudGltZV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosICpvbjsKIAlpbnQgaTsKQEAgLTg5NywxNSArODk3
LDE1IEBAIHZvaWQgaTkxNV9nZW1fcnVudGltZV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAkgKi8KIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShvYmosIG9u
LAotCQkJCSAmZGV2X3ByaXYtPm1tLnVzZXJmYXVsdF9saXN0LCB1c2VyZmF1bHRfbGluaykKKwkJ
CQkgJmk5MTUtPm1tLnVzZXJmYXVsdF9saXN0LCB1c2VyZmF1bHRfbGluaykKIAkJX19pOTE1X2dl
bV9vYmplY3RfcmVsZWFzZV9tbWFwKG9iaik7CiAKIAkvKiBUaGUgZmVuY2Ugd2lsbCBiZSBsb3N0
IHdoZW4gdGhlIGRldmljZSBwb3dlcnMgZG93bi4gSWYgYW55IHdlcmUKIAkgKiBpbiB1c2UgYnkg
aGFyZHdhcmUgKGkuZS4gdGhleSBhcmUgcGlubmVkKSwgd2Ugc2hvdWxkIG5vdCBiZSBwb3dlcmlu
ZwogCSAqIGRvd24hIEFsbCBvdGhlciBmZW5jZXMgd2lsbCBiZSByZWFjcXVpcmVkIGJ5IHRoZSB1
c2VyIHVwb24gd2FraW5nLgogCSAqLwotCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+bnVtX2Zl
bmNlX3JlZ3M7IGkrKykgewotCQlzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpyZWcgPSAmZGV2
X3ByaXYtPmZlbmNlX3JlZ3NbaV07CisJZm9yIChpID0gMDsgaSA8IGk5MTUtPm51bV9mZW5jZV9y
ZWdzOyBpKyspIHsKKwkJc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqcmVnID0gJmk5MTUtPmZl
bmNlX3JlZ3NbaV07CiAKIAkJLyogSWRlYWxseSB3ZSB3YW50IHRvIGFzc2VydCB0aGF0IHRoZSBm
ZW5jZSByZWdpc3RlciBpcyBub3QKIAkJICogbGl2ZSBhdCB0aGlzIHBvaW50IChpLmUuIHRoYXQg
bm8gcGllY2Ugb2YgY29kZSB3aWxsIGJlCkBAIC0xMDIwLDggKzEwMjAsOCBAQCBpOTE1X2dlbV9v
YmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCSB1NjQg
YWxpZ25tZW50LAogCQkJIHU2NCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtID0gJmRldl9wcml2LT5nZ3R0LnZtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSA9ICZpOTE1LT5nZ3R0LnZtOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBy
ZXQ7CiAKQEAgLTEwMzYsNyArMTAzNiw3IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgKiB0aGUgb2JqZWN0IGluIGFuZCBvdXQg
b2YgdGhlIEdsb2JhbCBHVFQgYW5kCiAJCSAqIHdhc3RlIGEgbG90IG9mIGN5Y2xlcyB1bmRlciB0
aGUgbXV0ZXguCiAJCSAqLwotCQlpZiAob2JqLT5iYXNlLnNpemUgPiBkZXZfcHJpdi0+Z2d0dC5t
YXBwYWJsZV9lbmQpCisJCWlmIChvYmotPmJhc2Uuc2l6ZSA+IGk5MTUtPmdndHQubWFwcGFibGVf
ZW5kKQogCQkJcmV0dXJuIEVSUl9QVFIoLUUyQklHKTsKIAogCQkvKiBJZiBOT05CTE9DSyBpcyBz
ZXQgdGhlIGNhbGxlciBpcyBvcHRpbWlzdGljYWxseQpAQCAtMTA1NSw3ICsxMDU1LDcgQEAgaTkx
NV9nZW1fb2JqZWN0X2dndHRfcGluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CSAqIHdlIGNvdWxkIHRyeSB0byBtaW5pbWlzZSBoYXJtIHRvIG90aGVycy4KIAkJICovCiAJCWlm
IChmbGFncyAmIFBJTl9OT05CTE9DSyAmJgotCQkgICAgb2JqLT5iYXNlLnNpemUgPiBkZXZfcHJp
di0+Z2d0dC5tYXBwYWJsZV9lbmQgLyAyKQorCQkgICAgb2JqLT5iYXNlLnNpemUgPiBpOTE1LT5n
Z3R0Lm1hcHBhYmxlX2VuZCAvIDIpCiAJCQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsKIAl9CiAK
QEAgLTEwNjksNyArMTA2OSw3IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJCXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOwogCiAJ
CQlpZiAoZmxhZ3MgJiBQSU5fTUFQUEFCTEUgJiYKLQkJCSAgICB2bWEtPmZlbmNlX3NpemUgPiBk
ZXZfcHJpdi0+Z2d0dC5tYXBwYWJsZV9lbmQgLyAyKQorCQkJICAgIHZtYS0+ZmVuY2Vfc2l6ZSA+
IGk5MTUtPmdndHQubWFwcGFibGVfZW5kIC8gMikKIAkJCQlyZXR1cm4gRVJSX1BUUigtRU5PU1BD
KTsKIAkJfQogCkBAIC0xMjAyLDMwICsxMjAyLDMwIEBAIHZvaWQgaTkxNV9nZW1fc2FuaXRpemUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIH0KIAotdm9pZCBpOTE1X2dlbV9pbml0X3N3aXp6bGluZyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGk5MTVfZ2VtX2luaXRfc3dpenpsaW5n
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpIDwgNSB8fAotCSAgICBkZXZfcHJpdi0+bW0uYml0XzZfc3dpenpsZV94ID09IEk5MTVfQklU
XzZfU1dJWlpMRV9OT05FKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA1IHx8CisJICAgIGk5MTUt
Pm1tLmJpdF82X3N3aXp6bGVfeCA9PSBJOTE1X0JJVF82X1NXSVpaTEVfTk9ORSkKIAkJcmV0dXJu
OwogCiAJSTkxNV9XUklURShESVNQX0FSQl9DVEwsIEk5MTVfUkVBRChESVNQX0FSQl9DVEwpIHwK
IAkJCQkgRElTUF9USUxFX1NVUkZBQ0VfU1dJWlpMSU5HKTsKIAotCWlmIChJU19HRU4oZGV2X3By
aXYsIDUpKQorCWlmIChJU19HRU4oaTkxNSwgNSkpCiAJCXJldHVybjsKIAogCUk5MTVfV1JJVEUo
VElMRUNUTCwgSTkxNV9SRUFEKFRJTEVDVEwpIHwgVElMRUNUTF9TV1pDVEwpOwotCWlmIChJU19H
RU4oZGV2X3ByaXYsIDYpKQorCWlmIChJU19HRU4oaTkxNSwgNikpCiAJCUk5MTVfV1JJVEUoQVJC
X01PREUsIF9NQVNLRURfQklUX0VOQUJMRShBUkJfTU9ERV9TV0laWkxFX1NOQikpOwotCWVsc2Ug
aWYgKElTX0dFTihkZXZfcHJpdiwgNykpCisJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDcpKQogCQlJ
OTE1X1dSSVRFKEFSQl9NT0RFLCBfTUFTS0VEX0JJVF9FTkFCTEUoQVJCX01PREVfU1dJWlpMRV9J
VkIpKTsKLQllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDgpKQorCWVsc2UgaWYgKElTX0dFTihp
OTE1LCA4KSkKIAkJSTkxNV9XUklURShHQU1UQVJCTU9ERSwgX01BU0tFRF9CSVRfRU5BQkxFKEFS
Ql9NT0RFX1NXSVpaTEVfQkRXKSk7CiAJZWxzZQogCQlCVUcoKTsKIH0KIAotc3RhdGljIHZvaWQg
aW5pdF91bnVzZWRfcmluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBi
YXNlKQorc3RhdGljIHZvaWQgaW5pdF91bnVzZWRfcmluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgdTMyIGJhc2UpCiB7CiAJSTkxNV9XUklURShSSU5HX0NUTChiYXNlKSwgMCk7CiAJ
STkxNV9XUklURShSSU5HX0hFQUQoYmFzZSksIDApOwpAQCAtMTIzMyw0NSArMTIzMyw0NSBAQCBz
dGF0aWMgdm9pZCBpbml0X3VudXNlZF9yaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgdTMyIGJhc2UpCiAJSTkxNV9XUklURShSSU5HX1NUQVJUKGJhc2UpLCAwKTsKIH0KIAot
c3RhdGljIHZvaWQgaW5pdF91bnVzZWRfcmluZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIHZvaWQgaW5pdF91bnVzZWRfcmluZ3Moc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7Ci0JaWYgKElTX0k4MzAoZGV2X3ByaXYpKSB7Ci0JCWluaXRfdW51c2Vk
X3JpbmcoZGV2X3ByaXYsIFBSQjFfQkFTRSk7Ci0JCWluaXRfdW51c2VkX3JpbmcoZGV2X3ByaXYs
IFNSQjBfQkFTRSk7Ci0JCWluaXRfdW51c2VkX3JpbmcoZGV2X3ByaXYsIFNSQjFfQkFTRSk7Ci0J
CWluaXRfdW51c2VkX3JpbmcoZGV2X3ByaXYsIFNSQjJfQkFTRSk7Ci0JCWluaXRfdW51c2VkX3Jp
bmcoZGV2X3ByaXYsIFNSQjNfQkFTRSk7Ci0JfSBlbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDIp
KSB7Ci0JCWluaXRfdW51c2VkX3JpbmcoZGV2X3ByaXYsIFNSQjBfQkFTRSk7Ci0JCWluaXRfdW51
c2VkX3JpbmcoZGV2X3ByaXYsIFNSQjFfQkFTRSk7Ci0JfSBlbHNlIGlmIChJU19HRU4oZGV2X3By
aXYsIDMpKSB7Ci0JCWluaXRfdW51c2VkX3JpbmcoZGV2X3ByaXYsIFBSQjFfQkFTRSk7Ci0JCWlu
aXRfdW51c2VkX3JpbmcoZGV2X3ByaXYsIFBSQjJfQkFTRSk7CisJaWYgKElTX0k4MzAoaTkxNSkp
IHsKKwkJaW5pdF91bnVzZWRfcmluZyhpOTE1LCBQUkIxX0JBU0UpOworCQlpbml0X3VudXNlZF9y
aW5nKGk5MTUsIFNSQjBfQkFTRSk7CisJCWluaXRfdW51c2VkX3JpbmcoaTkxNSwgU1JCMV9CQVNF
KTsKKwkJaW5pdF91bnVzZWRfcmluZyhpOTE1LCBTUkIyX0JBU0UpOworCQlpbml0X3VudXNlZF9y
aW5nKGk5MTUsIFNSQjNfQkFTRSk7CisJfSBlbHNlIGlmIChJU19HRU4oaTkxNSwgMikpIHsKKwkJ
aW5pdF91bnVzZWRfcmluZyhpOTE1LCBTUkIwX0JBU0UpOworCQlpbml0X3VudXNlZF9yaW5nKGk5
MTUsIFNSQjFfQkFTRSk7CisJfSBlbHNlIGlmIChJU19HRU4oaTkxNSwgMykpIHsKKwkJaW5pdF91
bnVzZWRfcmluZyhpOTE1LCBQUkIxX0JBU0UpOworCQlpbml0X3VudXNlZF9yaW5nKGk5MTUsIFBS
QjJfQkFTRSk7CiAJfQogfQogCi1pbnQgaTkxNV9nZW1faW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaTkxNV9nZW1faW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgcmV0OwogCi0JZGV2X3ByaXYtPmd0Lmxhc3RfaW5pdF90
aW1lID0ga3RpbWVfZ2V0KCk7CisJaTkxNS0+Z3QubGFzdF9pbml0X3RpbWUgPSBrdGltZV9nZXQo
KTsKIAogCS8qIERvdWJsZSBsYXllciBzZWN1cml0eSBibGFua2V0LCBzZWUgaTkxNV9nZW1faW5p
dCgpICovCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9wcml2LT51bmNvcmUsIEZP
UkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUs
IEZPUkNFV0FLRV9BTEwpOwogCi0JaWYgKEhBU19FRFJBTShkZXZfcHJpdikgJiYgSU5URUxfR0VO
KGRldl9wcml2KSA8IDkpCisJaWYgKEhBU19FRFJBTShpOTE1KSAmJiBJTlRFTF9HRU4oaTkxNSkg
PCA5KQogCQlJOTE1X1dSSVRFKEhTV19JRElDUiwgSTkxNV9SRUFEKEhTV19JRElDUikgfCBJRElI
QVNITVNLKDB4ZikpOwogCi0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQotCQlJOTE1X1dSSVRF
KE1JX1BSRURJQ0FURV9SRVNVTFRfMiwgSVNfSFNXX0dUMyhkZXZfcHJpdikgPworCWlmIChJU19I
QVNXRUxMKGk5MTUpKQorCQlJOTE1X1dSSVRFKE1JX1BSRURJQ0FURV9SRVNVTFRfMiwgSVNfSFNX
X0dUMyhpOTE1KSA/CiAJCQkgICBMT1dFUl9TTElDRV9FTkFCTEVEIDogTE9XRVJfU0xJQ0VfRElT
QUJMRUQpOwogCiAJLyogQXBwbHkgdGhlIEdUIHdvcmthcm91bmRzLi4uICovCi0JaW50ZWxfZ3Rf
YXBwbHlfd29ya2Fyb3VuZHMoZGV2X3ByaXYpOworCWludGVsX2d0X2FwcGx5X3dvcmthcm91bmRz
KGk5MTUpOwogCS8qIC4uLmFuZCBkZXRlcm1pbmUgd2hldGhlciB0aGV5IGFyZSBzdGlja2luZy4g
Ki8KLQlpbnRlbF9ndF92ZXJpZnlfd29ya2Fyb3VuZHMoZGV2X3ByaXYsICJpbml0Iik7CisJaW50
ZWxfZ3RfdmVyaWZ5X3dvcmthcm91bmRzKGk5MTUsICJpbml0Iik7CiAKLQlpOTE1X2dlbV9pbml0
X3N3aXp6bGluZyhkZXZfcHJpdik7CisJaTkxNV9nZW1faW5pdF9zd2l6emxpbmcoaTkxNSk7CiAK
IAkvKgogCSAqIEF0IGxlYXN0IDgzMCBjYW4gbGVhdmUgc29tZSBvZiB0aGUgdW51c2VkIHJpbmdz
CkBAIC0xMjc5LDQ4ICsxMjc5LDQ4IEBAIGludCBpOTE1X2dlbV9pbml0X2h3KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiB3aWxsIHByZXZlbnQgYzMgZW50cnkuIE1ha2Vz
IHN1cmUgYWxsIHVudXNlZCByaW5ncwogCSAqIGFyZSB0b3RhbGx5IGlkbGUuCiAJICovCi0JaW5p
dF91bnVzZWRfcmluZ3MoZGV2X3ByaXYpOworCWluaXRfdW51c2VkX3JpbmdzKGk5MTUpOwogCi0J
QlVHX09OKCFkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQpOwotCXJldCA9IGk5MTVfdGVybWluYWxs
eV93ZWRnZWQoZGV2X3ByaXYpOworCUJVR19PTighaTkxNS0+a2VybmVsX2NvbnRleHQpOworCXJl
dCA9IGk5MTVfdGVybWluYWxseV93ZWRnZWQoaTkxNSk7CiAJaWYgKHJldCkKIAkJZ290byBvdXQ7
CiAKLQlyZXQgPSBpOTE1X3BwZ3R0X2luaXRfaHcoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfcHBn
dHRfaW5pdF9odyhpOTE1KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiRW5hYmxpbmcgUFBH
VFQgZmFpbGVkICglZClcbiIsIHJldCk7CiAJCWdvdG8gb3V0OwogCX0KIAotCXJldCA9IGludGVs
X3dvcGNtX2luaXRfaHcoJmRldl9wcml2LT53b3BjbSk7CisJcmV0ID0gaW50ZWxfd29wY21faW5p
dF9odygmaTkxNS0+d29wY20pOwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJFbmFibGluZyBX
T1BDTSBmYWlsZWQgKCVkKVxuIiwgcmV0KTsKIAkJZ290byBvdXQ7CiAJfQogCiAJLyogV2UgY2Fu
J3QgZW5hYmxlIGNvbnRleHRzIHVudGlsIGFsbCBmaXJtd2FyZSBpcyBsb2FkZWQgKi8KLQlyZXQg
PSBpbnRlbF91Y19pbml0X2h3KGRldl9wcml2KTsKKwlyZXQgPSBpbnRlbF91Y19pbml0X2h3KGk5
MTUpOwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJFbmFibGluZyB1YyBmYWlsZWQgKCVkKVxu
IiwgcmV0KTsKIAkJZ290byBvdXQ7CiAJfQogCi0JaW50ZWxfbW9jc19pbml0X2wzY2NfdGFibGUo
ZGV2X3ByaXYpOworCWludGVsX21vY3NfaW5pdF9sM2NjX3RhYmxlKGk5MTUpOwogCiAJLyogT25s
eSB3aGVuIHRoZSBIVyBpcyByZS1pbml0aWFsaXNlZCwgY2FuIHdlIHJlcGxheSB0aGUgcmVxdWVz
dHMgKi8KLQlyZXQgPSBpbnRlbF9lbmdpbmVzX3Jlc3VtZShkZXZfcHJpdik7CisJcmV0ID0gaW50
ZWxfZW5naW5lc19yZXN1bWUoaTkxNSk7CiAJaWYgKHJldCkKIAkJZ290byBjbGVhbnVwX3VjOwog
Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FL
RV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNF
V0FLRV9BTEwpOwogCi0JaW50ZWxfZW5naW5lc19zZXRfc2NoZWR1bGVyX2NhcHMoZGV2X3ByaXYp
OworCWludGVsX2VuZ2luZXNfc2V0X3NjaGVkdWxlcl9jYXBzKGk5MTUpOwogCXJldHVybiAwOwog
CiBjbGVhbnVwX3VjOgotCWludGVsX3VjX2ZpbmlfaHcoZGV2X3ByaXYpOworCWludGVsX3VjX2Zp
bmlfaHcoaTkxNSk7CiBvdXQ6Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2
LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZp
OTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTE1MDUs
MjggKzE1MDUsMjggQEAgc3RhdGljIGludCBpbnRlbF9lbmdpbmVzX3ZlcmlmeV93b3JrYXJvdW5k
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlyZXR1cm4gZXJyOwogfQogCi1pbnQg
aTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaTkx
NV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgcmV0Owog
CiAJLyogV2UgbmVlZCB0byBmYWxsYmFjayB0byA0SyBwYWdlcyBpZiBob3N0IGRvZXNuJ3Qgc3Vw
cG9ydCBodWdlIGd0dC4gKi8KLQlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoZGV2X3ByaXYpICYmICFp
bnRlbF92Z3B1X2hhc19odWdlX2d0dChkZXZfcHJpdikpCi0JCW1rd3JpdGVfZGV2aWNlX2luZm8o
ZGV2X3ByaXYpLT5wYWdlX3NpemVzID0KKwlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkgJiYg
IWludGVsX3ZncHVfaGFzX2h1Z2VfZ3R0KGk5MTUpKQorCQlta3dyaXRlX2RldmljZV9pbmZvKGk5
MTUpLT5wYWdlX3NpemVzID0KIAkJCUk5MTVfR1RUX1BBR0VfU0laRV80SzsKIAotCWRldl9wcml2
LT5tbS51bm9yZGVyZWRfdGltZWxpbmUgPSBkbWFfZmVuY2VfY29udGV4dF9hbGxvYygxKTsKKwlp
OTE1LT5tbS51bm9yZGVyZWRfdGltZWxpbmUgPSBkbWFfZmVuY2VfY29udGV4dF9hbGxvYygxKTsK
IAotCWk5MTVfdGltZWxpbmVzX2luaXQoZGV2X3ByaXYpOworCWk5MTVfdGltZWxpbmVzX2luaXQo
aTkxNSk7CiAKLQlyZXQgPSBpOTE1X2dlbV9pbml0X3VzZXJwdHIoZGV2X3ByaXYpOworCXJldCA9
IGk5MTVfZ2VtX2luaXRfdXNlcnB0cihpOTE1KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
Ci0JcmV0ID0gaW50ZWxfdWNfaW5pdF9taXNjKGRldl9wcml2KTsKKwlyZXQgPSBpbnRlbF91Y19p
bml0X21pc2MoaTkxNSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9IGludGVs
X3dvcGNtX2luaXQoJmRldl9wcml2LT53b3BjbSk7CisJcmV0ID0gaW50ZWxfd29wY21faW5pdCgm
aTkxNS0+d29wY20pOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyX3VjX21pc2M7CiAKQEAgLTE1MzYs
NDcgKzE1MzYsNDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCSAqIHdlIGhvbGQgdGhlIGZvcmNld2FrZSBkdXJpbmcgaW5pdGlhbGlzYXRp
b24gdGhlc2UgcHJvYmxlbXMKIAkgKiBqdXN0IG1hZ2ljYWxseSBnbyBhd2F5LgogCSAqLwotCW11
dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlpbnRlbF91bmNvcmVfZm9y
Y2V3YWtlX2dldCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQo
Jmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKLQlyZXQgPSBpOTE1X2dlbV9pbml0X2dn
dHQoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfZ2VtX2luaXRfZ2d0dChpOTE1KTsKIAlpZiAocmV0
KSB7CiAJCUdFTV9CVUdfT04ocmV0ID09IC1FSU8pOwogCQlnb3RvIGVycl91bmxvY2s7CiAJfQog
Ci0JcmV0ID0gaTkxNV9nZW1faW5pdF9zY3JhdGNoKGRldl9wcml2LAotCQkJCSAgICBJU19HRU4o
ZGV2X3ByaXYsIDIpID8gU1pfMjU2SyA6IFBBR0VfU0laRSk7CisJcmV0ID0gaTkxNV9nZW1faW5p
dF9zY3JhdGNoKGk5MTUsCisJCQkJICAgIElTX0dFTihpOTE1LCAyKSA/IFNaXzI1NksgOiBQQUdF
X1NJWkUpOwogCWlmIChyZXQpIHsKIAkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7CiAJCWdvdG8g
ZXJyX2dndHQ7CiAJfQogCi0JcmV0ID0gaW50ZWxfZW5naW5lc19zZXR1cChkZXZfcHJpdik7CisJ
cmV0ID0gaW50ZWxfZW5naW5lc19zZXR1cChpOTE1KTsKIAlpZiAocmV0KSB7CiAJCUdFTV9CVUdf
T04ocmV0ID09IC1FSU8pOwogCQlnb3RvIGVycl91bmxvY2s7CiAJfQogCi0JcmV0ID0gaTkxNV9n
ZW1fY29udGV4dHNfaW5pdChkZXZfcHJpdik7CisJcmV0ID0gaTkxNV9nZW1fY29udGV4dHNfaW5p
dChpOTE1KTsKIAlpZiAocmV0KSB7CiAJCUdFTV9CVUdfT04ocmV0ID09IC1FSU8pOwogCQlnb3Rv
IGVycl9zY3JhdGNoOwogCX0KIAotCXJldCA9IGludGVsX2VuZ2luZXNfaW5pdChkZXZfcHJpdik7
CisJcmV0ID0gaW50ZWxfZW5naW5lc19pbml0KGk5MTUpOwogCWlmIChyZXQpIHsKIAkJR0VNX0JV
R19PTihyZXQgPT0gLUVJTyk7CiAJCWdvdG8gZXJyX2NvbnRleHQ7CiAJfQogCi0JaW50ZWxfaW5p
dF9ndF9wb3dlcnNhdmUoZGV2X3ByaXYpOworCWludGVsX2luaXRfZ3RfcG93ZXJzYXZlKGk5MTUp
OwogCi0JcmV0ID0gaW50ZWxfdWNfaW5pdChkZXZfcHJpdik7CisJcmV0ID0gaW50ZWxfdWNfaW5p
dChpOTE1KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9wbTsKIAotCXJldCA9IGk5MTVfZ2VtX2lu
aXRfaHcoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfZ2VtX2luaXRfaHcoaTkxNSk7CiAJaWYgKHJl
dCkKIAkJZ290byBlcnJfdWNfaW5pdDsKIApAQCAtMTU4OSwxMyArMTU4OSwxMyBAQCBpbnQgaTkx
NV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICoKIAkgKiBG
SVhNRTogYnJlYWsgdXAgdGhlIHdvcmthcm91bmRzIGFuZCBhcHBseSB0aGVtIGF0IHRoZSByaWdo
dCB0aW1lIQogCSAqLwotCWludGVsX2luaXRfY2xvY2tfZ2F0aW5nKGRldl9wcml2KTsKKwlpbnRl
bF9pbml0X2Nsb2NrX2dhdGluZyhpOTE1KTsKIAotCXJldCA9IGludGVsX2VuZ2luZXNfdmVyaWZ5
X3dvcmthcm91bmRzKGRldl9wcml2KTsKKwlyZXQgPSBpbnRlbF9lbmdpbmVzX3ZlcmlmeV93b3Jr
YXJvdW5kcyhpOTE1KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9pbml0X2h3OwogCi0JcmV0ID0g
X19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhkZXZfcHJpdik7CisJcmV0ID0gX19pbnRl
bF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhpOTE1KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9p
bml0X2h3OwogCkBAIC0xNjA5LDggKzE2MDksOCBAQCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gZXJyX2luaXRfaHc7CiAJfQogCi0J
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWludGVs
X3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gMDsKIApAQCAt
MTYyMSwxMDcgKzE2MjEsMTA3IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAkgKiBkcml2ZXIgZG9lc24ndCBleHBsb2RlIGR1cmluZyBydW50
aW1lLgogCSAqLwogZXJyX2luaXRfaHc6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAot
CWk5MTVfZ2VtX3NldF93ZWRnZWQoZGV2X3ByaXYpOwotCWk5MTVfZ2VtX3N1c3BlbmQoZGV2X3By
aXYpOwotCWk5MTVfZ2VtX3N1c3BlbmRfbGF0ZShkZXZfcHJpdik7CisJaTkxNV9nZW1fc2V0X3dl
ZGdlZChpOTE1KTsKKwlpOTE1X2dlbV9zdXNwZW5kKGk5MTUpOworCWk5MTVfZ2VtX3N1c3BlbmRf
bGF0ZShpOTE1KTsKIAotCWk5MTVfZ2VtX2RyYWluX3dvcmtxdWV1ZShkZXZfcHJpdik7CisJaTkx
NV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWludGVsX3VjX2ZpbmlfaHcoZGV2X3ByaXYpOworCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWludGVsX3VjX2ZpbmlfaHcoaTkxNSk7CiBl
cnJfdWNfaW5pdDoKLQlpbnRlbF91Y19maW5pKGRldl9wcml2KTsKKwlpbnRlbF91Y19maW5pKGk5
MTUpOwogZXJyX3BtOgogCWlmIChyZXQgIT0gLUVJTykgewotCQlpbnRlbF9jbGVhbnVwX2d0X3Bv
d2Vyc2F2ZShkZXZfcHJpdik7Ci0JCWludGVsX2VuZ2luZXNfY2xlYW51cChkZXZfcHJpdik7CisJ
CWludGVsX2NsZWFudXBfZ3RfcG93ZXJzYXZlKGk5MTUpOworCQlpbnRlbF9lbmdpbmVzX2NsZWFu
dXAoaTkxNSk7CiAJfQogZXJyX2NvbnRleHQ6CiAJaWYgKHJldCAhPSAtRUlPKQotCQlpOTE1X2dl
bV9jb250ZXh0c19maW5pKGRldl9wcml2KTsKKwkJaTkxNV9nZW1fY29udGV4dHNfZmluaShpOTE1
KTsKIGVycl9zY3JhdGNoOgotCWk5MTVfZ2VtX2Zpbmlfc2NyYXRjaChkZXZfcHJpdik7CisJaTkx
NV9nZW1fZmluaV9zY3JhdGNoKGk5MTUpOwogZXJyX2dndHQ6CiBlcnJfdW5sb2NrOgotCWludGVs
X3VuY29yZV9mb3JjZXdha2VfcHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsK
LQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlpbnRlbF91bmNv
cmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiBlcnJfdWNfbWlzYzoKLQlpbnRlbF91
Y19maW5pX21pc2MoZGV2X3ByaXYpOworCWludGVsX3VjX2ZpbmlfbWlzYyhpOTE1KTsKIAogCWlm
IChyZXQgIT0gLUVJTykgewotCQlpOTE1X2dlbV9jbGVhbnVwX3VzZXJwdHIoZGV2X3ByaXYpOwot
CQlpOTE1X3RpbWVsaW5lc19maW5pKGRldl9wcml2KTsKKwkJaTkxNV9nZW1fY2xlYW51cF91c2Vy
cHRyKGk5MTUpOworCQlpOTE1X3RpbWVsaW5lc19maW5pKGk5MTUpOwogCX0KIAogCWlmIChyZXQg
PT0gLUVJTykgewotCQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJCS8qCiAJCSAqIEFsbG93
IGVuZ2luZSBpbml0aWFsaXNhdGlvbiB0byBmYWlsIGJ5IG1hcmtpbmcgdGhlIEdQVSBhcwogCQkg
KiB3ZWRnZWQuIEJ1dCB3ZSBvbmx5IHdhbnQgdG8gZG8gdGhpcyB3aGVyZSB0aGUgR1BVIGlzIGFu
Z3J5LAogCQkgKiBmb3IgYWxsIG90aGVyIGZhaWx1cmUsIHN1Y2ggYXMgYW4gYWxsb2NhdGlvbiBm
YWlsdXJlLCBiYWlsLgogCQkgKi8KLQkJaWYgKCFpOTE1X3Jlc2V0X2ZhaWxlZChkZXZfcHJpdikp
IHsKLQkJCWk5MTVfbG9hZF9lcnJvcihkZXZfcHJpdiwKKwkJaWYgKCFpOTE1X3Jlc2V0X2ZhaWxl
ZChpOTE1KSkgeworCQkJaTkxNV9sb2FkX2Vycm9yKGk5MTUsCiAJCQkJCSJGYWlsZWQgdG8gaW5p
dGlhbGl6ZSBHUFUsIGRlY2xhcmluZyBpdCB3ZWRnZWQhXG4iKTsKLQkJCWk5MTVfZ2VtX3NldF93
ZWRnZWQoZGV2X3ByaXYpOworCQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKIAkJfQogCiAJ
CS8qIE1pbmltYWwgYmFzaWMgcmVjb3ZlcnkgZm9yIEtNUyAqLwotCQlyZXQgPSBpOTE1X2dndHRf
ZW5hYmxlX2h3KGRldl9wcml2KTsKLQkJaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3MoZGV2
X3ByaXYpOwotCQlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhkZXZfcHJpdik7Ci0JCWludGVsX2lu
aXRfY2xvY2tfZ2F0aW5nKGRldl9wcml2KTsKKwkJcmV0ID0gaTkxNV9nZ3R0X2VuYWJsZV9odyhp
OTE1KTsKKwkJaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3MoaTkxNSk7CisJCWk5MTVfZ2Vt
X3Jlc3RvcmVfZmVuY2VzKGk5MTUpOworCQlpbnRlbF9pbml0X2Nsb2NrX2dhdGluZyhpOTE1KTsK
IAotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwkJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl9CiAKLQlpOTE1X2dlbV9kcmFpbl9m
cmVlZF9vYmplY3RzKGRldl9wcml2KTsKKwlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5
MTUpOwogCXJldHVybiByZXQ7CiB9CiAKLXZvaWQgaTkxNV9nZW1fZmluaV9odyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGk5MTVfZ2VtX2ZpbmlfaHcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JR0VNX0JVR19PTihkZXZfcHJpdi0+Z3QuYXdha2Up
OworCUdFTV9CVUdfT04oaTkxNS0+Z3QuYXdha2UpOwogCi0JaW50ZWxfd2FrZXJlZl9hdXRvX2Zp
bmkoJmRldl9wcml2LT5tbS51c2VyZmF1bHRfd2FrZXJlZik7CisJaW50ZWxfd2FrZXJlZl9hdXRv
X2ZpbmkoJmk5MTUtPm1tLnVzZXJmYXVsdF93YWtlcmVmKTsKIAotCWk5MTVfZ2VtX3N1c3BlbmRf
bGF0ZShkZXZfcHJpdik7Ci0JaW50ZWxfZGlzYWJsZV9ndF9wb3dlcnNhdmUoZGV2X3ByaXYpOwor
CWk5MTVfZ2VtX3N1c3BlbmRfbGF0ZShpOTE1KTsKKwlpbnRlbF9kaXNhYmxlX2d0X3Bvd2Vyc2F2
ZShpOTE1KTsKIAogCS8qIEZsdXNoIGFueSBvdXRzdGFuZGluZyB1bnBpbl93b3JrLiAqLwotCWk5
MTVfZ2VtX2RyYWluX3dvcmtxdWV1ZShkZXZfcHJpdik7CisJaTkxNV9nZW1fZHJhaW5fd29ya3F1
ZXVlKGk5MTUpOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWludGVsX3VjX2ZpbmlfaHcoZGV2X3ByaXYpOwotCWludGVsX3VjX2ZpbmkoZGV2X3ByaXYpOwot
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWludGVsX3VjX2ZpbmlfaHcoaTkxNSk7CisJaW50
ZWxfdWNfZmluaShpOTE1KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCi0JaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhkZXZfcHJpdik7CisJaTkxNV9nZW1f
ZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKIH0KIAotdm9pZCBpOTE1X2dlbV9maW5pKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaTkxNV9nZW1fZmluaShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0JaW50ZWxfZW5naW5lc19jbGVhbnVwKGRldl9wcml2KTsKLQlpOTE1X2dl
bV9jb250ZXh0c19maW5pKGRldl9wcml2KTsKLQlpOTE1X2dlbV9maW5pX3NjcmF0Y2goZGV2X3By
aXYpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWludGVsX2VuZ2luZXNfY2xlYW51cChp
OTE1KTsKKwlpOTE1X2dlbV9jb250ZXh0c19maW5pKGk5MTUpOworCWk5MTVfZ2VtX2Zpbmlfc2Ny
YXRjaChpOTE1KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0J
aW50ZWxfd2FfbGlzdF9mcmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlzdCk7CisJaW50ZWxfd2FfbGlz
dF9mcmVlKCZpOTE1LT5ndF93YV9saXN0KTsKIAotCWludGVsX2NsZWFudXBfZ3RfcG93ZXJzYXZl
KGRldl9wcml2KTsKKwlpbnRlbF9jbGVhbnVwX2d0X3Bvd2Vyc2F2ZShpOTE1KTsKIAotCWludGVs
X3VjX2ZpbmlfbWlzYyhkZXZfcHJpdik7Ci0JaTkxNV9nZW1fY2xlYW51cF91c2VycHRyKGRldl9w
cml2KTsKLQlpOTE1X3RpbWVsaW5lc19maW5pKGRldl9wcml2KTsKKwlpbnRlbF91Y19maW5pX21p
c2MoaTkxNSk7CisJaTkxNV9nZW1fY2xlYW51cF91c2VycHRyKGk5MTUpOworCWk5MTVfdGltZWxp
bmVzX2ZpbmkoaTkxNSk7CiAKLQlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGRldl9wcml2
KTsKKwlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwogCi0JV0FSTl9PTighbGlz
dF9lbXB0eSgmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QpKTsKKwlXQVJOX09OKCFsaXN0X2VtcHR5
KCZpOTE1LT5jb250ZXh0cy5saXN0KSk7CiB9CiAKIHZvaWQgaTkxNV9nZW1faW5pdF9tbWlvKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpAQCAtMTczMCwzNSArMTczMCwzNSBAQCB2b2lk
IGk5MTVfZ2VtX2luaXRfbW1pbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIH0KIAog
dm9pZAotaTkxNV9nZW1fbG9hZF9pbml0X2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitpOTE1X2dlbV9sb2FkX2luaXRfZmVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCWludCBpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNyAm
JiAhSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgJiYKLQkgICAgIUlTX0NIRVJSWVZJRVcoZGV2X3By
aXYpKQotCQlkZXZfcHJpdi0+bnVtX2ZlbmNlX3JlZ3MgPSAzMjsKLQllbHNlIGlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDQgfHwKLQkJIElTX0k5NDVHKGRldl9wcml2KSB8fCBJU19JOTQ1R00o
ZGV2X3ByaXYpIHx8Ci0JCSBJU19HMzMoZGV2X3ByaXYpIHx8IElTX1BJTkVWSUVXKGRldl9wcml2
KSkKLQkJZGV2X3ByaXYtPm51bV9mZW5jZV9yZWdzID0gMTY7CisJaWYgKElOVEVMX0dFTihpOTE1
KSA+PSA3ICYmICFJU19WQUxMRVlWSUVXKGk5MTUpICYmCisJICAgICFJU19DSEVSUllWSUVXKGk5
MTUpKQorCQlpOTE1LT5udW1fZmVuY2VfcmVncyA9IDMyOworCWVsc2UgaWYgKElOVEVMX0dFTihp
OTE1KSA+PSA0IHx8CisJCSBJU19JOTQ1RyhpOTE1KSB8fCBJU19JOTQ1R00oaTkxNSkgfHwKKwkJ
IElTX0czMyhpOTE1KSB8fCBJU19QSU5FVklFVyhpOTE1KSkKKwkJaTkxNS0+bnVtX2ZlbmNlX3Jl
Z3MgPSAxNjsKIAllbHNlCi0JCWRldl9wcml2LT5udW1fZmVuY2VfcmVncyA9IDg7CisJCWk5MTUt
Pm51bV9mZW5jZV9yZWdzID0gODsKIAotCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShkZXZfcHJpdikp
Ci0JCWRldl9wcml2LT5udW1fZmVuY2VfcmVncyA9CisJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5
MTUpKQorCQlpOTE1LT5udW1fZmVuY2VfcmVncyA9CiAJCQkJSTkxNV9SRUFEKHZndGlmX3JlZyhh
dmFpbF9ycy5mZW5jZV9udW0pKTsKIAogCS8qIEluaXRpYWxpemUgZmVuY2UgcmVnaXN0ZXJzIHRv
IHplcm8gKi8KLQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPm51bV9mZW5jZV9yZWdzOyBpKysp
IHsKLQkJc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UgPSAmZGV2X3ByaXYtPmZlbmNl
X3JlZ3NbaV07CisJZm9yIChpID0gMDsgaSA8IGk5MTUtPm51bV9mZW5jZV9yZWdzOyBpKyspIHsK
KwkJc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UgPSAmaTkxNS0+ZmVuY2VfcmVnc1tp
XTsKIAotCQlmZW5jZS0+aTkxNSA9IGRldl9wcml2OworCQlmZW5jZS0+aTkxNSA9IGk5MTU7CiAJ
CWZlbmNlLT5pZCA9IGk7Ci0JCWxpc3RfYWRkX3RhaWwoJmZlbmNlLT5saW5rLCAmZGV2X3ByaXYt
Pm1tLmZlbmNlX2xpc3QpOworCQlsaXN0X2FkZF90YWlsKCZmZW5jZS0+bGluaywgJmk5MTUtPm1t
LmZlbmNlX2xpc3QpOwogCX0KLQlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhkZXZfcHJpdik7CisJ
aTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoaTkxNSk7CiAKLQlpOTE1X2dlbV9kZXRlY3RfYml0XzZf
c3dpenpsZShkZXZfcHJpdik7CisJaTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUoaTkxNSk7
CiB9CiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2luaXRfX21tKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQpAQCAtMTc3OCw1NiArMTc3OCw1NiBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9p
bml0X19tbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpOTE1X2dlbV9pbml0X19v
YmplY3RzKGk5MTUpOwogfQogCi1pbnQgaTkxNV9nZW1faW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaTkxNV9nZW1faW5pdF9lYXJseShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdGF0aWMgc3RydWN0IGxvY2tfY2xhc3Nfa2V5IHJl
c2V0X2tleTsKIAlpbnQgZXJyOwogCi0JaW50ZWxfZ3RfcG1faW5pdChkZXZfcHJpdik7CisJaW50
ZWxfZ3RfcG1faW5pdChpOTE1KTsKIAotCUlOSVRfTElTVF9IRUFEKCZkZXZfcHJpdi0+Z3QuYWN0
aXZlX3JpbmdzKTsKLQlJTklUX0xJU1RfSEVBRCgmZGV2X3ByaXYtPmd0LmNsb3NlZF92bWEpOwot
CXNwaW5fbG9ja19pbml0KCZkZXZfcHJpdi0+Z3QuY2xvc2VkX2xvY2spOwotCWxvY2tkZXBfaW5p
dF9tYXAoJmRldl9wcml2LT5ndC5yZXNldF9sb2NrbWFwLAorCUlOSVRfTElTVF9IRUFEKCZpOTE1
LT5ndC5hY3RpdmVfcmluZ3MpOworCUlOSVRfTElTVF9IRUFEKCZpOTE1LT5ndC5jbG9zZWRfdm1h
KTsKKwlzcGluX2xvY2tfaW5pdCgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOworCWxvY2tkZXBfaW5p
dF9tYXAoJmk5MTUtPmd0LnJlc2V0X2xvY2ttYXAsCiAJCQkgImk5MTUucmVzZXQiLCAmcmVzZXRf
a2V5LCAwKTsKIAotCWk5MTVfZ2VtX2luaXRfX21tKGRldl9wcml2KTsKLQlpOTE1X2dlbV9pbml0
X19wbShkZXZfcHJpdik7CisJaTkxNV9nZW1faW5pdF9fbW0oaTkxNSk7CisJaTkxNV9nZW1faW5p
dF9fcG0oaTkxNSk7CiAKLQlpbml0X3dhaXRxdWV1ZV9oZWFkKCZkZXZfcHJpdi0+Z3B1X2Vycm9y
LndhaXRfcXVldWUpOwotCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmRldl9wcml2LT5ncHVfZXJyb3Iu
cmVzZXRfcXVldWUpOwotCW11dGV4X2luaXQoJmRldl9wcml2LT5ncHVfZXJyb3Iud2VkZ2VfbXV0
ZXgpOwotCWluaXRfc3JjdV9zdHJ1Y3QoJmRldl9wcml2LT5ncHVfZXJyb3IucmVzZXRfYmFja29m
Zl9zcmN1KTsKKwlpbml0X3dhaXRxdWV1ZV9oZWFkKCZpOTE1LT5ncHVfZXJyb3Iud2FpdF9xdWV1
ZSk7CisJaW5pdF93YWl0cXVldWVfaGVhZCgmaTkxNS0+Z3B1X2Vycm9yLnJlc2V0X3F1ZXVlKTsK
KwltdXRleF9pbml0KCZpOTE1LT5ncHVfZXJyb3Iud2VkZ2VfbXV0ZXgpOworCWluaXRfc3JjdV9z
dHJ1Y3QoJmk5MTUtPmdwdV9lcnJvci5yZXNldF9iYWNrb2ZmX3NyY3UpOwogCi0JYXRvbWljX3Nl
dCgmZGV2X3ByaXYtPm1tLmJzZF9lbmdpbmVfZGlzcGF0Y2hfaW5kZXgsIDApOworCWF0b21pY19z
ZXQoJmk5MTUtPm1tLmJzZF9lbmdpbmVfZGlzcGF0Y2hfaW5kZXgsIDApOwogCi0Jc3Bpbl9sb2Nr
X2luaXQoJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKKwlzcGluX2xvY2tfaW5pdCgmaTkx
NS0+ZmJfdHJhY2tpbmcubG9jayk7CiAKLQllcnIgPSBpOTE1X2dlbWZzX2luaXQoZGV2X3ByaXYp
OworCWVyciA9IGk5MTVfZ2VtZnNfaW5pdChpOTE1KTsKIAlpZiAoZXJyKQogCQlEUk1fTk9URSgi
VW5hYmxlIHRvIGNyZWF0ZSBhIHByaXZhdGUgdG1wZnMgbW91bnQsIGh1Z2VwYWdlIHN1cHBvcnQg
d2lsbCBiZSBkaXNhYmxlZCglZCkuXG4iLCBlcnIpOwogCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQg
aTkxNV9nZW1fY2xlYW51cF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
Cit2b2lkIGk5MTVfZ2VtX2NsZWFudXBfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7Ci0JaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhkZXZfcHJpdik7Ci0JR0VNX0JV
R19PTighbGxpc3RfZW1wdHkoJmRldl9wcml2LT5tbS5mcmVlX2xpc3QpKTsKLQlHRU1fQlVHX09O
KGF0b21pY19yZWFkKCZkZXZfcHJpdi0+bW0uZnJlZV9jb3VudCkpOwotCVdBUk5fT04oZGV2X3By
aXYtPm1tLnNocmlua19jb3VudCk7CisJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1
KTsKKwlHRU1fQlVHX09OKCFsbGlzdF9lbXB0eSgmaTkxNS0+bW0uZnJlZV9saXN0KSk7CisJR0VN
X0JVR19PTihhdG9taWNfcmVhZCgmaTkxNS0+bW0uZnJlZV9jb3VudCkpOworCVdBUk5fT04oaTkx
NS0+bW0uc2hyaW5rX2NvdW50KTsKIAotCWNsZWFudXBfc3JjdV9zdHJ1Y3QoJmRldl9wcml2LT5n
cHVfZXJyb3IucmVzZXRfYmFja29mZl9zcmN1KTsKKwljbGVhbnVwX3NyY3Vfc3RydWN0KCZpOTE1
LT5ncHVfZXJyb3IucmVzZXRfYmFja29mZl9zcmN1KTsKIAotCWk5MTVfZ2VtZnNfZmluaShkZXZf
cHJpdik7CisJaTkxNV9nZW1mc19maW5pKGk5MTUpOwogfQogCi1pbnQgaTkxNV9nZW1fZnJlZXpl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludCBpOTE1X2dlbV9mcmVlemUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyogRGlzY2FyZCBhbGwgcHVyZ2Vh
YmxlIG9iamVjdHMsIGxldCB1c2Vyc3BhY2UgcmVjb3ZlciB0aG9zZSBhcwogCSAqIHJlcXVpcmVk
IGFmdGVyIHJlc3VtaW5nLgogCSAqLwotCWk5MTVfZ2VtX3Nocmlua19hbGwoZGV2X3ByaXYpOwor
CWk5MTVfZ2VtX3Nocmlua19hbGwoaTkxNSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE4OTUsNyAr
MTg5NSw3IEBAIGludCBpOTE1X2dlbV9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJCXJldHVybiAtRU5PTUVNOwogCiAJZmlsZS0+ZHJp
dmVyX3ByaXYgPSBmaWxlX3ByaXY7Ci0JZmlsZV9wcml2LT5kZXZfcHJpdiA9IGk5MTU7CisJZmls
ZV9wcml2LT5pOTE1ID0gaTkxNTsKIAlmaWxlX3ByaXYtPmZpbGUgPSBmaWxlOwogCiAJc3Bpbl9s
b2NrX2luaXQoJmZpbGVfcHJpdi0+bW0ubG9jayk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
ZXZpY3QuYwppbmRleCBhNTc4M2M0Y2I5OGIuLjQyNDRkOWM1NGQ2NiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ldmljdC5jCkBAIC05OSw3ICs5OSw3IEBAIGk5MTVfZ2VtX2V2aWN0X3Nv
bWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCSB1NjQgc3RhcnQsIHU2
NCBlbmQsCiAJCQkgdW5zaWduZWQgZmxhZ3MpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdm0tPmk5MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2
bS0+aTkxNTsKIAlzdHJ1Y3QgZHJtX21tX3NjYW4gc2NhbjsKIAlzdHJ1Y3QgbGlzdF9oZWFkIGV2
aWN0aW9uX2xpc3Q7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICpuZXh0OwpAQCAtMTM4LDcgKzEz
OCw3IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSwKIAkgKiByZXRpcmluZy4KIAkgKi8KIAlpZiAoIShmbGFncyAmIFBJTl9OT05CTE9DSykp
Ci0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGRldl9wcml2KTsKKwkJaTkxNV9yZXRpcmVfcmVxdWVz
dHMoaTkxNSk7CiAKIHNlYXJjaF9hZ2FpbjoKIAlhY3RpdmUgPSBOVUxMOwpAQCAtMjExLDcgKzIx
MSw3IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSwKIAlpZiAoSTkxNV9TRUxGVEVTVF9PTkxZKGlndF9ldmljdF9jdGwuZmFpbF9pZl9idXN5
KSkKIAkJcmV0dXJuIC1FQlVTWTsKIAotCXJldCA9IGdndHRfZmx1c2goZGV2X3ByaXYpOworCXJl
dCA9IGdndHRfZmx1c2goaTkxNSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCBlNzA2NzViZmI1MWQuLjQyZDg4ZGFlOWM1ZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTEyOTQsNyArMTI5NCw3IEBAIHN0
YXRpYyBpbnQgZ2VuOF9pbml0X3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0p
CiBzdGF0aWMgaW50IGdlbjhfcHBndHRfbm90aWZ5X3ZndChzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBn
dHQsIGJvb2wgY3JlYXRlKQogewogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gJnBw
Z3R0LT52bTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bS0+aTkxNTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZtLT5pOTE1OwogCWVudW0gdmd0X2cy
dl90eXBlIG1zZzsKIAlpbnQgaTsKIApAQCAtMTY5Miw3ICsxNjkyLDcgQEAgc3RhdGljIGlubGlu
ZSB2b2lkIGdlbjZfd3JpdGVfcGRlKGNvbnN0IHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCwKIAkJ
ICBwcGd0dC0+cGRfYWRkciArIHBkZSk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjdfcHBndHRfZW5h
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdlbjdf
cHBndHRfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAl1MzIgZWNvY2hrLCBlY29iaXRzOwpAQCAtMTcwMiw3
ICsxNzAyLDcgQEAgc3RhdGljIHZvaWQgZ2VuN19wcGd0dF9lbmFibGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJVEUoR0FDX0VDT19CSVRTLCBlY29iaXRzIHwg
RUNPQklUU19QUEdUVF9DQUNIRTY0Qik7CiAKIAllY29jaGsgPSBJOTE1X1JFQUQoR0FNX0VDT0NI
Syk7Ci0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKSB7CisJaWYgKElTX0hBU1dFTEwoaTkxNSkp
IHsKIAkJZWNvY2hrIHw9IEVDT0NIS19QUEdUVF9XQl9IU1c7CiAJfSBlbHNlIHsKIAkJZWNvY2hr
IHw9IEVDT0NIS19QUEdUVF9MTENfSVZCOwpAQCAtMTcxMCw3ICsxNzEwLDcgQEAgc3RhdGljIHZv
aWQgZ2VuN19wcGd0dF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CX0KIAlJOTE1X1dSSVRFKEdBTV9FQ09DSEssIGVjb2Noayk7CiAKLQlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBkZXZfcHJpdiwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBp
ZCkgewogCQkvKiBHRlhfTU9ERSBpcyBwZXItcmluZyBvbiBnZW43KyAqLwogCQlFTkdJTkVfV1JJ
VEUoZW5naW5lLAogCQkJICAgICBSSU5HX01PREVfR0VONywKQEAgLTE3MTgsNyArMTcxOCw3IEBA
IHN0YXRpYyB2b2lkIGdlbjdfcHBndHRfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjZfcHBndHRfZW5hYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdlbjZfcHBndHRfZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiBlY29jaGssIGdhYl9jdGws
IGVjb2JpdHM7CiAKQEAgLTE3MzIsNyArMTczMiw3IEBAIHN0YXRpYyB2b2lkIGdlbjZfcHBndHRf
ZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAllY29jaGsgPSBJOTE1
X1JFQUQoR0FNX0VDT0NISyk7CiAJSTkxNV9XUklURShHQU1fRUNPQ0hLLCBlY29jaGsgfCBFQ09D
SEtfU05CX0JJVCB8IEVDT0NIS19QUEdUVF9DQUNIRTY0Qik7CiAKLQlpZiAoSEFTX1BQR1RUKGRl
dl9wcml2KSkgLyogbWF5IGJlIGRpc2FibGVkIGZvciBWVC1kICovCisJaWYgKEhBU19QUEdUVChp
OTE1KSkgLyogbWF5IGJlIGRpc2FibGVkIGZvciBWVC1kICovCiAJCUk5MTVfV1JJVEUoR0ZYX01P
REUsIF9NQVNLRURfQklUX0VOQUJMRShHRlhfUFBHVFRfRU5BQkxFKSk7CiB9CiAKQEAgLTIxODUs
MjAgKzIxODUsMjAgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3BwZ3R0ICpnZW42X3BwZ3R0X2NyZWF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlyZXR1cm4gRVJSX1BUUihlcnIpOwog
fQogCi1zdGF0aWMgdm9pZCBndHRfd3JpdGVfd29ya2Fyb3VuZHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ3R0X3dyaXRlX3dvcmthcm91bmRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIFRoaXMgZnVuY3Rpb24gaXMgZm9yIGd0
dCByZWxhdGVkIHdvcmthcm91bmRzLiBUaGlzIGZ1bmN0aW9uIGlzCiAJICogY2FsbGVkIG9uIGRy
aXZlciBsb2FkIGFuZCBhZnRlciBhIEdQVSByZXNldCwgc28geW91IGNhbiBwbGFjZQogCSAqIHdv
cmthcm91bmRzIGhlcmUgZXZlbiBpZiB0aGV5IGdldCBvdmVyd3JpdHRlbiBieSBHUFUgcmVzZXQu
CiAJICovCiAJLyogV2FJbmNyZWFzZURlZmF1bHRUTEJFbnRyaWVzOmNodixiZHcsc2tsLGJ4dCxr
YmwsZ2xrLGNmbCxjbmwsaWNsICovCi0JaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJaWYg
KElTX0JST0FEV0VMTChpOTE1KSkKIAkJSTkxNV9XUklURShHRU44X0wzX0xSQV8xX0dQR1BVLCBH
RU44X0wzX0xSQV8xX0dQR1BVX0RFRkFVTFRfVkFMVUVfQkRXKTsKLQllbHNlIGlmIChJU19DSEVS
UllWSUVXKGRldl9wcml2KSkKKwllbHNlIGlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQlJOTE1
X1dSSVRFKEdFTjhfTDNfTFJBXzFfR1BHUFUsIEdFTjhfTDNfTFJBXzFfR1BHUFVfREVGQVVMVF9W
QUxVRV9DSFYpOwotCWVsc2UgaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElT
X0dFTjlfTFAoaTkxNSkpCiAJCUk5MTVfV1JJVEUoR0VOOF9MM19MUkFfMV9HUEdQVSwgR0VOOV9M
M19MUkFfMV9HUEdQVV9ERUZBVUxUX1ZBTFVFX0JYVCk7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSA5KQorCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQlJOTE1X1dS
SVRFKEdFTjhfTDNfTFJBXzFfR1BHUFUsIEdFTjlfTDNfTFJBXzFfR1BHUFVfREVGQVVMVF9WQUxV
RV9TS0wpOwogCiAJLyoKQEAgLTIyMTIsMjEgKzIyMTIsMjEgQEAgc3RhdGljIHZvaWQgZ3R0X3dy
aXRlX3dvcmthcm91bmRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiAz
MksgcGFnZXMsIGJ1dCB3ZSBkb24ndCBjdXJyZW50bHkgaGF2ZSBhbnkgc3VwcG9ydCBmb3IgaXQg
aW4gb3VyCiAJICogZHJpdmVyLgogCSAqLwotCWlmIChIQVNfUEFHRV9TSVpFUyhkZXZfcHJpdiwg
STkxNV9HVFRfUEFHRV9TSVpFXzY0SykgJiYKLQkgICAgSU5URUxfR0VOKGRldl9wcml2KSA8PSAx
MCkKKwlpZiAoSEFTX1BBR0VfU0laRVMoaTkxNSwgSTkxNV9HVFRfUEFHRV9TSVpFXzY0SykgJiYK
KwkgICAgSU5URUxfR0VOKGk5MTUpIDw9IDEwKQogCQlJOTE1X1dSSVRFKEdFTjhfR0FNV19FQ09f
REVWX1JXX0lBLAogCQkJICAgSTkxNV9SRUFEKEdFTjhfR0FNV19FQ09fREVWX1JXX0lBKSB8CiAJ
CQkgICBHQU1XX0VDT19FTkFCTEVfNjRLX0lQU19GSUVMRCk7CiB9CiAKLWludCBpOTE1X3BwZ3R0
X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50IGk5MTVfcHBn
dHRfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlndHRfd3JpdGVf
d29ya2Fyb3VuZHMoZGV2X3ByaXYpOworCWd0dF93cml0ZV93b3JrYXJvdW5kcyhpOTE1KTsKIAot
CWlmIChJU19HRU4oZGV2X3ByaXYsIDYpKQotCQlnZW42X3BwZ3R0X2VuYWJsZShkZXZfcHJpdik7
Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA3KSkKLQkJZ2VuN19wcGd0dF9lbmFibGUoZGV2
X3ByaXYpOworCWlmIChJU19HRU4oaTkxNSwgNikpCisJCWdlbjZfcHBndHRfZW5hYmxlKGk5MTUp
OworCWVsc2UgaWYgKElTX0dFTihpOTE1LCA3KSkKKwkJZ2VuN19wcGd0dF9lbmFibGUoaTkxNSk7
CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTIyOTMsMjkgKzIyOTMsMjkgQEAgdm9pZCBpOTE1X3ZtX3Jl
bGVhc2Uoc3RydWN0IGtyZWYgKmtyZWYpCiAvKiBDZXJ0YWluIEdlbjUgY2hpcHNldHMgcmVxdWly
ZSByZXF1aXJlIGlkbGluZyB0aGUgR1BVIGJlZm9yZQogICogdW5tYXBwaW5nIGFueXRoaW5nIGZy
b20gdGhlIEdUVCB3aGVuIFZULWQgaXMgZW5hYmxlZC4KICAqLwotc3RhdGljIGJvb2wgbmVlZHNf
aWRsZV9tYXBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBib29s
IG5lZWRzX2lkbGVfbWFwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAkvKiBR
dWVyeSBpbnRlbF9pb21tdSB0byBzZWUgaWYgd2UgbmVlZCB0aGUgd29ya2Fyb3VuZC4gUHJlc3Vt
YWJseSB0aGF0CiAJICogd2FzIGxvYWRlZCBmaXJzdC4KIAkgKi8KLQlyZXR1cm4gSVNfR0VOKGRl
dl9wcml2LCA1KSAmJiBJU19NT0JJTEUoZGV2X3ByaXYpICYmIGludGVsX3Z0ZF9hY3RpdmUoKTsK
KwlyZXR1cm4gSVNfR0VOKGk5MTUsIDUpICYmIElTX01PQklMRShpOTE1KSAmJiBpbnRlbF92dGRf
YWN0aXZlKCk7CiB9CiAKLXZvaWQgaTkxNV9nZW1fc3VzcGVuZF9ndHRfbWFwcGluZ3Moc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpOTE1X2dlbV9zdXNwZW5kX2d0dF9t
YXBwaW5ncyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9n
Z3R0ICpnZ3R0ID0gJmRldl9wcml2LT5nZ3R0OworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAm
aTkxNS0+Z2d0dDsKIAogCS8qIERvbid0IGJvdGhlciBtZXNzaW5nIHdpdGggZmF1bHRzIHByZSBH
RU42IGFzIHdlIGhhdmUgbGl0dGxlCiAJICogZG9jdW1lbnRhdGlvbiBzdXBwb3J0aW5nIHRoYXQg
aXQncyBhIGdvb2QgaWRlYS4KIAkgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDYpCisJ
aWYgKElOVEVMX0dFTihpOTE1KSA8IDYpCiAJCXJldHVybjsKIAotCWk5MTVfY2hlY2tfYW5kX2Ns
ZWFyX2ZhdWx0cyhkZXZfcHJpdik7CisJaTkxNV9jaGVja19hbmRfY2xlYXJfZmF1bHRzKGk5MTUp
OwogCiAJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCAwLCBnZ3R0LT52bS50b3RhbCk7
CiAKLQlpOTE1X2dndHRfaW52YWxpZGF0ZShkZXZfcHJpdik7CisJaTkxNV9nZ3R0X2ludmFsaWRh
dGUoaTkxNSk7CiB9CiAKIGludCBpOTE1X2dlbV9ndHRfcHJlcGFyZV9wYWdlcyhzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLApAQCAtMjQxMSw3ICsyNDExLDcgQEAgc3RhdGljIHZvaWQg
Z2VuNl9nZ3R0X2luc2VydF9wYWdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogICog
QmluZHMgYW4gb2JqZWN0IGludG8gdGhlIGdsb2JhbCBndHQgd2l0aCB0aGUgc3BlY2lmaWVkIGNh
Y2hlIGxldmVsLiBUaGUgb2JqZWN0CiAgKiB3aWxsIGJlIGFjY2Vzc2libGUgdG8gdGhlIEdQVSB2
aWEgY29tbWFuZHMgd2hvc2Ugb3BlcmFuZHMgcmVmZXJlbmNlIG9mZnNldHMKICAqIHdpdGhpbiB0
aGUgZ2xvYmFsIEdUVCBhcyB3ZWxsIGFzIGFjY2Vzc2libGUgYnkgdGhlIEdQVSB0aHJvdWdoIHRo
ZSBHTUFEUgotICogbWFwcGVkIEJBUiAoZGV2X3ByaXYtPm1tLmd0dC0+Z3R0KS4KKyAqIG1hcHBl
ZCBCQVIgKGk5MTUtPm1tLmd0dC0+Z3R0KS4KICAqLwogc3RhdGljIHZvaWQgZ2VuNl9nZ3R0X2lu
c2VydF9lbnRyaWVzKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJCSAgICAgc3Ry
dWN0IGk5MTVfdm1hICp2bWEsCkBAIC0yNDYxLDcgKzI0NjEsNyBAQCBzdGF0aWMgdm9pZCBnZW44
X2dndHRfY2xlYXJfcmFuZ2Uoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAKIHN0YXRp
YyB2b2lkIGJ4dF92dGRfZ2d0dF93YShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bS0+aTkxNTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZtLT5pOTE1OwogCiAJLyoKIAkgKiBNYWtlIHN1cmUg
dGhlIGludGVybmFsIEdBTSBmaWZvIGhhcyBiZWVuIGNsZWFyZWQgb2YgYWxsIEdUVApAQCAtMjcw
NSwxMiArMjcwNSwxMiBAQCBzdGF0aWMgdm9pZCBhbGlhc2luZ19ndHRfdW5iaW5kX3ZtYShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSkKIHZvaWQgaTkxNV9nZW1fZ3R0X2ZpbmlzaF9wYWdlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJICAgICAgIHN0cnVjdCBzZ190YWJsZSAqcGFn
ZXMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmot
PmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZGV2aWNlICprZGV2ID0gJmRldl9wcml2LT5kcm0ucGRldi0+
ZGV2OwotCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmZGV2X3ByaXYtPmdndHQ7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVj
dCBkZXZpY2UgKmtkZXYgPSAmaTkxNS0+ZHJtLnBkZXYtPmRldjsKKwlzdHJ1Y3QgaTkxNV9nZ3R0
ICpnZ3R0ID0gJmk5MTUtPmdndHQ7CiAKIAlpZiAodW5saWtlbHkoZ2d0dC0+ZG9faWRsZV9tYXBz
KSkgewotCQlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShkZXZfcHJpdiwgMCwgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpKSB7CisJCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIDAsIE1B
WF9TQ0hFRFVMRV9USU1FT1VUKSkgewogCQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gd2FpdCBmb3Ig
aWRsZTsgVlQnZCBtYXkgaGFuZy5cbiIpOwogCQkJLyogV2FpdCBhIGJpdCwgaW4gaG9wZXMgaXQg
YXZvaWRzIHRoZSBoYW5nICovCiAJCQl1ZGVsYXkoMTApOwpAQCAtMjgzNCw3ICsyODM0LDcgQEAg
c3RhdGljIHZvaWQgZ2d0dF9yZWxlYXNlX2d1Y190b3Aoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkK
IAkJZHJtX21tX3JlbW92ZV9ub2RlKCZnZ3R0LT51Y19mdyk7CiB9CiAKLWludCBpOTE1X2dlbV9p
bml0X2dndHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50IGk5MTVfZ2Vt
X2luaXRfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAkvKiBMZXQgR0VN
IE1hbmFnZSBhbGwgb2YgdGhlIGFwZXJ0dXJlLgogCSAqCkBAIC0yODQ1LDcgKzI4NDUsNyBAQCBp
bnQgaTkxNV9nZW1faW5pdF9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkgKiBhcGVydHVyZS4gIE9uZSBwYWdlIHNob3VsZCBiZSBlbm91Z2ggdG8ga2VlcCBhbnkgcHJl
ZmV0Y2hpbmcgaW5zaWRlCiAJICogb2YgdGhlIGFwZXJ0dXJlLgogCSAqLwotCXN0cnVjdCBpOTE1
X2dndHQgKmdndHQgPSAmZGV2X3ByaXYtPmdndHQ7CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9
ICZpOTE1LT5nZ3R0OwogCXVuc2lnbmVkIGxvbmcgaG9sZV9zdGFydCwgaG9sZV9lbmQ7CiAJc3Ry
dWN0IGRybV9tbV9ub2RlICplbnRyeTsKIAlpbnQgcmV0OwpAQCAtMjg1Nyw5ICsyODU3LDkgQEAg
aW50IGk5MTVfZ2VtX2luaXRfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJICogd2h5LgogCSAqLwogCWdndHQtPnBpbl9iaWFzID0gbWF4X3QodTMyLCBJOTE1X0dUVF9Q
QUdFX1NJWkUsCi0JCQkgICAgICAgaW50ZWxfd29wY21fZ3VjX3NpemUoJmRldl9wcml2LT53b3Bj
bSkpOworCQkJICAgICAgIGludGVsX3dvcGNtX2d1Y19zaXplKCZpOTE1LT53b3BjbSkpOwogCi0J
cmV0ID0gaW50ZWxfdmd0X2JhbGxvb24oZGV2X3ByaXYpOworCXJldCA9IGludGVsX3ZndF9iYWxs
b29uKGk5MTUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTI4OTEsOCArMjg5MSw4
IEBAIGludCBpOTE1X2dlbV9pbml0X2dndHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCS8qIEFuZCBmaW5hbGx5IGNsZWFyIHRoZSByZXNlcnZlZCBndWFyZCBwYWdlICovCiAJ
Z2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBnZ3R0LT52bS50b3RhbCAtIFBBR0VfU0la
RSwgUEFHRV9TSVpFKTsKIAotCWlmIChJTlRFTF9QUEdUVChkZXZfcHJpdikgPT0gSU5URUxfUFBH
VFRfQUxJQVNJTkcpIHsKLQkJcmV0ID0gaW5pdF9hbGlhc2luZ19wcGd0dChkZXZfcHJpdik7CisJ
aWYgKElOVEVMX1BQR1RUKGk5MTUpID09IElOVEVMX1BQR1RUX0FMSUFTSU5HKSB7CisJCXJldCA9
IGluaXRfYWxpYXNpbmdfcHBndHQoaTkxNSk7CiAJCWlmIChyZXQpCiAJCQlnb3RvIGVycl9hcHBn
dHQ7CiAJfQpAQCAtMjkwOCwxOCArMjkwOCwxOCBAQCBpbnQgaTkxNV9nZW1faW5pdF9nZ3R0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogLyoqCiAgKiBpOTE1X2dndHRfY2xl
YW51cF9odyAtIENsZWFuIHVwIEdHVFQgaGFyZHdhcmUgaW5pdGlhbGl6YXRpb24KLSAqIEBkZXZf
cHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICovCi12b2lkIGk5MTVf
Z2d0dF9jbGVhbnVwX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQg
aTkxNV9nZ3R0X2NsZWFudXBfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0J
c3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZkZXZfcHJpdi0+Z2d0dDsKKwlzdHJ1Y3QgaTkxNV9n
Z3R0ICpnZ3R0ID0gJmk5MTUtPmdndHQ7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICp2bjsKIAlz
dHJ1Y3QgcGFnZXZlYyAqcHZlYzsKIAogCWdndHQtPnZtLmNsb3NlZCA9IHRydWU7CiAKLQltdXRl
eF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JZmluaV9hbGlhc2luZ19wcGd0
dChkZXZfcHJpdik7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJZmlu
aV9hbGlhc2luZ19wcGd0dChpOTE1KTsKIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEs
IHZuLCAmZ2d0dC0+dm0uYm91bmRfbGlzdCwgdm1fbGluaykKIAkJV0FSTl9PTihpOTE1X3ZtYV91
bmJpbmQodm1hKSk7CkBAIC0yOTMwLDI0ICsyOTMwLDI0IEBAIHZvaWQgaTkxNV9nZ3R0X2NsZWFu
dXBfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWdndHRfcmVsZWFzZV9n
dWNfdG9wKGdndHQpOwogCiAJaWYgKGRybV9tbV9pbml0aWFsaXplZCgmZ2d0dC0+dm0ubW0pKSB7
Ci0JCWludGVsX3ZndF9kZWJhbGxvb24oZGV2X3ByaXYpOworCQlpbnRlbF92Z3RfZGViYWxsb29u
KGk5MTUpOwogCQlpOTE1X2FkZHJlc3Nfc3BhY2VfZmluaSgmZ2d0dC0+dm0pOwogCX0KIAogCWdn
dHQtPnZtLmNsZWFudXAoJmdndHQtPnZtKTsKIAotCXB2ZWMgPSAmZGV2X3ByaXYtPm1tLndjX3N0
YXNoLnB2ZWM7CisJcHZlYyA9ICZpOTE1LT5tbS53Y19zdGFzaC5wdmVjOwogCWlmIChwdmVjLT5u
cikgewogCQlzZXRfcGFnZXNfYXJyYXlfd2IocHZlYy0+cGFnZXMsIHB2ZWMtPm5yKTsKIAkJX19w
YWdldmVjX3JlbGVhc2UocHZlYyk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAogCWFyY2hfcGh5c193Y19kZWwoZ2d0dC0+bXRycik7CiAJaW9fbWFwcGluZ19maW5pKCZnZ3R0
LT5pb21hcCk7CiAKLQlpOTE1X2dlbV9jbGVhbnVwX3N0b2xlbihkZXZfcHJpdik7CisJaTkxNV9n
ZW1fY2xlYW51cF9zdG9sZW4oaTkxNSk7CiB9CiAKIHN0YXRpYyB1bnNpZ25lZCBpbnQgZ2VuNl9n
ZXRfdG90YWxfZ3R0X3NpemUodTE2IHNuYl9nbWNoX2N0bCkKQEAgLTI5ODYsOCArMjk4Niw4IEBA
IHN0YXRpYyB1bnNpZ25lZCBpbnQgY2h2X2dldF90b3RhbF9ndHRfc2l6ZSh1MTYgZ21jaF9jdHJs
KQogCiBzdGF0aWMgaW50IGdndHRfcHJvYmVfY29tbW9uKHN0cnVjdCBpOTE1X2dndHQgKmdndHQs
IHU2NCBzaXplKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGdndHQt
PnZtLmk5MTU7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZfcHJpdi0+ZHJtLnBkZXY7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1OworCXN0cnVjdCBw
Y2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CiAJcGh5c19hZGRyX3QgcGh5c19hZGRyOwog
CWludCByZXQ7CiAKQEAgLTMwMDEsNyArMzAwMSw3IEBAIHN0YXRpYyBpbnQgZ2d0dF9wcm9iZV9j
b21tb24oc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwgdTY0IHNpemUpCiAJICogcmVzb3J0IHRvIGFu
IHVuY2FjaGVkIG1hcHBpbmcuIFRoZSBXQyBpc3N1ZSBpcyBlYXNpbHkgY2F1Z2h0IGJ5IHRoZQog
CSAqIHJlYWRiYWNrIGNoZWNrIHdoZW4gd3JpdGluZyBHVFQgUFRFIGVudHJpZXMuCiAJICovCi0J
aWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpIHx8IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJ
aWYgKElTX0dFTjlfTFAoaTkxNSkgfHwgSU5URUxfR0VOKGk5MTUpID49IDEwKQogCQlnZ3R0LT5n
c20gPSBpb3JlbWFwX25vY2FjaGUocGh5c19hZGRyLCBzaXplKTsKIAllbHNlCiAJCWdndHQtPmdz
bSA9IGlvcmVtYXBfd2MocGh5c19hZGRyLCBzaXplKTsKQEAgLTMxMzUsOSArMzEzNSw5IEBAIHZv
aWQgaW50ZWxfcHBhdF9wdXQoY29uc3Qgc3RydWN0IGludGVsX3BwYXRfZW50cnkgKmVudHJ5KQog
CWtyZWZfcHV0KCZwcGF0LT5lbnRyaWVzW2luZGV4XS5yZWYsIHJlbGVhc2VfcHBhdCk7CiB9CiAK
LXN0YXRpYyB2b2lkIGNubF9wcml2YXRlX3BhdF91cGRhdGVfaHcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgY25sX3ByaXZhdGVfcGF0X3VwZGF0ZV9odyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcHBhdCAqcHBh
dCA9ICZkZXZfcHJpdi0+cHBhdDsKKwlzdHJ1Y3QgaW50ZWxfcHBhdCAqcHBhdCA9ICZpOTE1LT5w
cGF0OwogCWludCBpOwogCiAJZm9yX2VhY2hfc2V0X2JpdChpLCBwcGF0LT5kaXJ0eSwgcHBhdC0+
bWF4X2VudHJpZXMpIHsKQEAgLTMxNDYsOSArMzE0Niw5IEBAIHN0YXRpYyB2b2lkIGNubF9wcml2
YXRlX3BhdF91cGRhdGVfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0K
IH0KIAotc3RhdGljIHZvaWQgYmR3X3ByaXZhdGVfcGF0X3VwZGF0ZV9odyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBiZHdfcHJpdmF0ZV9wYXRfdXBkYXRl
X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9wcGF0
ICpwcGF0ID0gJmRldl9wcml2LT5wcGF0OworCXN0cnVjdCBpbnRlbF9wcGF0ICpwcGF0ID0gJmk5
MTUtPnBwYXQ7CiAJdTY0IHBhdCA9IDA7CiAJaW50IGk7CiAKQEAgLTMyOTMsMTYgKzMyOTMsMTYg
QEAgc3RhdGljIHZvaWQgZ2VuNl9nbWNoX3JlbW92ZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSkKIAljbGVhbnVwX3NjcmF0Y2hfcGFnZSh2bSk7CiB9CiAKLXN0YXRpYyB2b2lkIHNldHVw
X3ByaXZhdGVfcGF0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIHNldHVwX3ByaXZhdGVfcGF0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cnVjdCBpbnRlbF9wcGF0ICpwcGF0ID0gJmRldl9wcml2LT5wcGF0OworCXN0cnVjdCBpbnRl
bF9wcGF0ICpwcGF0ID0gJmk5MTUtPnBwYXQ7CiAJaW50IGk7CiAKLQlwcGF0LT5pOTE1ID0gZGV2
X3ByaXY7CisJcHBhdC0+aTkxNSA9IGk5MTU7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDEwKQogCQljbmxfc2V0dXBfcHJpdmF0ZV9w
cGF0KHBwYXQpOwotCWVsc2UgaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpIHx8IElTX0dFTjlf
TFAoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkgfHwgSVNfR0VOOV9M
UChpOTE1KSkKIAkJY2h2X3NldHVwX3ByaXZhdGVfcHBhdChwcGF0KTsKIAllbHNlCiAJCWJkd19z
ZXR1cF9wcml2YXRlX3BwYXQocHBhdCk7CkBAIC0zMzE1LDEzICszMzE1LDEzIEBAIHN0YXRpYyB2
b2lkIHNldHVwX3ByaXZhdGVfcGF0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJc2V0X2JpdChpLCBwcGF0LT5kaXJ0eSk7CiAJfQogCi0JcHBhdC0+dXBkYXRlX2h3KGRldl9w
cml2KTsKKwlwcGF0LT51cGRhdGVfaHcoaTkxNSk7CiB9CiAKIHN0YXRpYyBpbnQgZ2VuOF9nbWNo
X3Byb2JlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZ2d0dC0+dm0uaTkxNTsKLQlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGRl
dl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGdndHQt
PnZtLmk5MTU7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsKIAl1bnNp
Z25lZCBpbnQgc2l6ZTsKIAl1MTYgc25iX2dtY2hfY3RsOwogCWludCBlcnI7CkBAIC0zMzM5LDcg
KzMzMzksNyBAQCBzdGF0aWMgaW50IGdlbjhfZ21jaF9wcm9iZShzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KQogCQlEUk1fRVJST1IoIkNhbid0IHNldCBETUEgbWFzay9jb25zaXN0ZW50IG1hc2sgKCVk
KVxuIiwgZXJyKTsKIAogCXBjaV9yZWFkX2NvbmZpZ193b3JkKHBkZXYsIFNOQl9HTUNIX0NUUkws
ICZzbmJfZ21jaF9jdGwpOwotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKKwlpZiAoSVNf
Q0hFUlJZVklFVyhpOTE1KSkKIAkJc2l6ZSA9IGNodl9nZXRfdG90YWxfZ3R0X3NpemUoc25iX2dt
Y2hfY3RsKTsKIAllbHNlCiAJCXNpemUgPSBnZW44X2dldF90b3RhbF9ndHRfc2l6ZShzbmJfZ21j
aF9jdGwpOwpAQCAtMzM0OCwyMyArMzM0OCwyMyBAQCBzdGF0aWMgaW50IGdlbjhfZ21jaF9wcm9i
ZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCWdndHQtPnZtLmNsZWFudXAgPSBnZW42X2dtY2hf
cmVtb3ZlOwogCWdndHQtPnZtLmluc2VydF9wYWdlID0gZ2VuOF9nZ3R0X2luc2VydF9wYWdlOwog
CWdndHQtPnZtLmNsZWFyX3JhbmdlID0gbm9wX2NsZWFyX3JhbmdlOwotCWlmIChpbnRlbF9zY2Fu
b3V0X25lZWRzX3Z0ZF93YShkZXZfcHJpdikpCisJaWYgKGludGVsX3NjYW5vdXRfbmVlZHNfdnRk
X3dhKGk5MTUpKQogCQlnZ3R0LT52bS5jbGVhcl9yYW5nZSA9IGdlbjhfZ2d0dF9jbGVhcl9yYW5n
ZTsKIAogCWdndHQtPnZtLmluc2VydF9lbnRyaWVzID0gZ2VuOF9nZ3R0X2luc2VydF9lbnRyaWVz
OwogCiAJLyogU2VyaWFsaXplIEdUVCB1cGRhdGVzIHdpdGggYXBlcnR1cmUgYWNjZXNzIG9uIEJY
VCBpZiBWVC1kIGlzIG9uLiAqLwotCWlmIChpbnRlbF9nZ3R0X3VwZGF0ZV9uZWVkc192dGRfd2Eo
ZGV2X3ByaXYpIHx8Ci0JICAgIElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpIC8qIGZhaWxzIHdpdGgg
Y29uY3VycmVudCB1c2UvdXBkYXRlICovKSB7CisJaWYgKGludGVsX2dndHRfdXBkYXRlX25lZWRz
X3Z0ZF93YShpOTE1KSB8fAorCSAgICBJU19DSEVSUllWSUVXKGk5MTUpIC8qIGZhaWxzIHdpdGgg
Y29uY3VycmVudCB1c2UvdXBkYXRlICovKSB7CiAJCWdndHQtPnZtLmluc2VydF9lbnRyaWVzID0g
Ynh0X3Z0ZF9nZ3R0X2luc2VydF9lbnRyaWVzX19CS0w7CiAJCWdndHQtPnZtLmluc2VydF9wYWdl
ICAgID0gYnh0X3Z0ZF9nZ3R0X2luc2VydF9wYWdlX19CS0w7CiAJCWlmIChnZ3R0LT52bS5jbGVh
cl9yYW5nZSAhPSBub3BfY2xlYXJfcmFuZ2UpCiAJCQlnZ3R0LT52bS5jbGVhcl9yYW5nZSA9IGJ4
dF92dGRfZ2d0dF9jbGVhcl9yYW5nZV9fQktMOwogCiAJCS8qIFByZXZlbnQgcmVjdXJzaXZlbHkg
Y2FsbGluZyBzdG9wX21hY2hpbmUoKSBhbmQgZGVhZGxvY2tzLiAqLwotCQlkZXZfaW5mbyhkZXZf
cHJpdi0+ZHJtLmRldiwKKwkJZGV2X2luZm8oaTkxNS0+ZHJtLmRldiwKIAkJCSAiRGlzYWJsaW5n
IGVycm9yIGNhcHR1cmUgZm9yIFZULWQgd29ya2Fyb3VuZFxuIik7Ci0JCWk5MTVfZGlzYWJsZV9l
cnJvcl9zdGF0ZShkZXZfcHJpdiwgLUVOT0RFVik7CisJCWk5MTVfZGlzYWJsZV9lcnJvcl9zdGF0
ZShpOTE1LCAtRU5PREVWKTsKIAl9CiAKIAlnZ3R0LT5pbnZhbGlkYXRlID0gZ2VuNl9nZ3R0X2lu
dmFsaWRhdGU7CkBAIC0zMzc2LDE1ICszMzc2LDE1IEBAIHN0YXRpYyBpbnQgZ2VuOF9nbWNoX3By
b2JlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAKIAlnZ3R0LT52bS5wdGVfZW5jb2RlID0gZ2Vu
OF9wdGVfZW5jb2RlOwogCi0Jc2V0dXBfcHJpdmF0ZV9wYXQoZGV2X3ByaXYpOworCXNldHVwX3By
aXZhdGVfcGF0KGk5MTUpOwogCiAJcmV0dXJuIGdndHRfcHJvYmVfY29tbW9uKGdndHQsIHNpemUp
OwogfQogCiBzdGF0aWMgaW50IGdlbjZfZ21jaF9wcm9iZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGdndHQtPnZtLmk5MTU7
Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZfcHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1OworCXN0cnVjdCBwY2lfZGV2ICpw
ZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CiAJdW5zaWduZWQgaW50IHNpemU7CiAJdTE2IHNuYl9nbWNo
X2N0bDsKIAlpbnQgZXJyOwpAQCAtMzQxMyw3ICszNDEzLDcgQEAgc3RhdGljIGludCBnZW42X2dt
Y2hfcHJvYmUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAlnZ3R0LT52bS50b3RhbCA9IChzaXpl
IC8gc2l6ZW9mKGdlbjZfcHRlX3QpKSAqIEk5MTVfR1RUX1BBR0VfU0laRTsKIAogCWdndHQtPnZt
LmNsZWFyX3JhbmdlID0gbm9wX2NsZWFyX3JhbmdlOwotCWlmICghSEFTX0ZVTExfUFBHVFQoZGV2
X3ByaXYpIHx8IGludGVsX3NjYW5vdXRfbmVlZHNfdnRkX3dhKGRldl9wcml2KSkKKwlpZiAoIUhB
U19GVUxMX1BQR1RUKGk5MTUpIHx8IGludGVsX3NjYW5vdXRfbmVlZHNfdnRkX3dhKGk5MTUpKQog
CQlnZ3R0LT52bS5jbGVhcl9yYW5nZSA9IGdlbjZfZ2d0dF9jbGVhcl9yYW5nZTsKIAlnZ3R0LT52
bS5pbnNlcnRfcGFnZSA9IGdlbjZfZ2d0dF9pbnNlcnRfcGFnZTsKIAlnZ3R0LT52bS5pbnNlcnRf
ZW50cmllcyA9IGdlbjZfZ2d0dF9pbnNlcnRfZW50cmllczsKQEAgLTM0MjEsMTMgKzM0MjEsMTMg
QEAgc3RhdGljIGludCBnZW42X2dtY2hfcHJvYmUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAog
CWdndHQtPmludmFsaWRhdGUgPSBnZW42X2dndHRfaW52YWxpZGF0ZTsKIAotCWlmIChIQVNfRURS
QU0oZGV2X3ByaXYpKQorCWlmIChIQVNfRURSQU0oaTkxNSkpCiAJCWdndHQtPnZtLnB0ZV9lbmNv
ZGUgPSBpcmlzX3B0ZV9lbmNvZGU7Ci0JZWxzZSBpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikpCisJ
ZWxzZSBpZiAoSVNfSEFTV0VMTChpOTE1KSkKIAkJZ2d0dC0+dm0ucHRlX2VuY29kZSA9IGhzd19w
dGVfZW5jb2RlOwotCWVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQorCWVsc2UgaWYg
KElTX1ZBTExFWVZJRVcoaTkxNSkpCiAJCWdndHQtPnZtLnB0ZV9lbmNvZGUgPSBieXRfcHRlX2Vu
Y29kZTsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDcpCisJZWxzZSBpZiAoSU5U
RUxfR0VOKGk5MTUpID49IDcpCiAJCWdndHQtPnZtLnB0ZV9lbmNvZGUgPSBpdmJfcHRlX2VuY29k
ZTsKIAllbHNlCiAJCWdndHQtPnZtLnB0ZV9lbmNvZGUgPSBzbmJfcHRlX2VuY29kZTsKQEAgLTM0
NDcsMTEgKzM0NDcsMTEgQEAgc3RhdGljIHZvaWQgaTkxNV9nbWNoX3JlbW92ZShzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSkKIAogc3RhdGljIGludCBpOTE1X2dtY2hfcHJvYmUoc3RydWN0
IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBnZ3R0LT52bS5pOTE1OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ2d0dC0+
dm0uaTkxNTsKIAlwaHlzX2FkZHJfdCBnbWFkcl9iYXNlOwogCWludCByZXQ7CiAKLQlyZXQgPSBp
bnRlbF9nbWNoX3Byb2JlKGRldl9wcml2LT5icmlkZ2VfZGV2LCBkZXZfcHJpdi0+ZHJtLnBkZXYs
IE5VTEwpOworCXJldCA9IGludGVsX2dtY2hfcHJvYmUoaTkxNS0+YnJpZGdlX2RldiwgaTkxNS0+
ZHJtLnBkZXYsIE5VTEwpOwogCWlmICghcmV0KSB7CiAJCURSTV9FUlJPUigiZmFpbGVkIHRvIHNl
dCB1cCBnbWNoXG4iKTsKIAkJcmV0dXJuIC1FSU87CkBAIC0zNDYzLDcgKzM0NjMsNyBAQCBzdGF0
aWMgaW50IGk5MTVfZ21jaF9wcm9iZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCQkoc3RydWN0
IHJlc291cmNlKSBERUZJTkVfUkVTX01FTShnbWFkcl9iYXNlLAogCQkJCQkJIGdndHQtPm1hcHBh
YmxlX2VuZCk7CiAKLQlnZ3R0LT5kb19pZGxlX21hcHMgPSBuZWVkc19pZGxlX21hcHMoZGV2X3By
aXYpOworCWdndHQtPmRvX2lkbGVfbWFwcyA9IG5lZWRzX2lkbGVfbWFwcyhpOTE1KTsKIAlnZ3R0
LT52bS5pbnNlcnRfcGFnZSA9IGk5MTVfZ2d0dF9pbnNlcnRfcGFnZTsKIAlnZ3R0LT52bS5pbnNl
cnRfZW50cmllcyA9IGk5MTVfZ2d0dF9pbnNlcnRfZW50cmllczsKIAlnZ3R0LT52bS5jbGVhcl9y
YW5nZSA9IGk5MTVfZ2d0dF9jbGVhcl9yYW5nZTsKQEAgLTM0ODQsMTkgKzM0ODQsMTkgQEAgc3Rh
dGljIGludCBpOTE1X2dtY2hfcHJvYmUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAogLyoqCiAg
KiBpOTE1X2dndHRfcHJvYmVfaHcgLSBQcm9iZSBHR1RUIGhhcmR3YXJlIGxvY2F0aW9uCi0gKiBA
ZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UKICAqLwotaW50IGk5
MTVfZ2d0dF9wcm9iZV9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQg
aTkxNV9nZ3R0X3Byb2JlX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0
cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmZGV2X3ByaXYtPmdndHQ7CisJc3RydWN0IGk5MTVfZ2d0
dCAqZ2d0dCA9ICZpOTE1LT5nZ3R0OwogCWludCByZXQ7CiAKLQlnZ3R0LT52bS5pOTE1ID0gZGV2
X3ByaXY7Ci0JZ2d0dC0+dm0uZG1hID0gJmRldl9wcml2LT5kcm0ucGRldi0+ZGV2OworCWdndHQt
PnZtLmk5MTUgPSBpOTE1OworCWdndHQtPnZtLmRtYSA9ICZpOTE1LT5kcm0ucGRldi0+ZGV2Owog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPD0gNSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDw9
IDUpCiAJCXJldCA9IGk5MTVfZ21jaF9wcm9iZShnZ3R0KTsKLQllbHNlIGlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpIDwgOCkKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPCA4KQogCQlyZXQgPSBn
ZW42X2dtY2hfcHJvYmUoZ2d0dCk7CiAJZWxzZQogCQlyZXQgPSBnZW44X2dtY2hfcHJvYmUoZ2d0
dCk7CkBAIC0zNTMyLDM1ICszNTMyLDM1IEBAIGludCBpOTE1X2dndHRfcHJvYmVfaHcoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAvKioKICAqIGk5MTVfZ2d0dF9pbml0X2h3
IC0gSW5pdGlhbGl6ZSBHR1RUIGhhcmR3YXJlCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisg
KiBAaTkxNTogaTkxNSBkZXZpY2UKICAqLwotaW50IGk5MTVfZ2d0dF9pbml0X2h3KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludCBpOTE1X2dndHRfaW5pdF9odyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmRl
dl9wcml2LT5nZ3R0OworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKIAlp
bnQgcmV0OwogCi0Jc3Rhc2hfaW5pdCgmZGV2X3ByaXYtPm1tLndjX3N0YXNoKTsKKwlzdGFzaF9p
bml0KCZpOTE1LT5tbS53Y19zdGFzaCk7CiAKIAkvKiBOb3RlIHRoYXQgd2UgdXNlIHBhZ2UgY29s
b3VyaW5nIHRvIGVuZm9yY2UgYSBndWFyZCBwYWdlIGF0IHRoZQogCSAqIGVuZCBvZiB0aGUgYWRk
cmVzcyBzcGFjZS4gVGhpcyBpcyByZXF1aXJlZCBhcyB0aGUgQ1MgbWF5IHByZWZldGNoCiAJICog
YmV5b25kIHRoZSBlbmQgb2YgdGhlIGJhdGNoIGJ1ZmZlciwgYWNyb3NzIHRoZSBwYWdlIGJvdW5k
YXJ5LAogCSAqIGFuZCBiZXlvbmQgdGhlIGVuZCBvZiB0aGUgR1RUIGlmIHdlIGRvIG5vdCBwcm92
aWRlIGEgZ3VhcmQuCiAJICovCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfYWRkcmVz
c19zcGFjZV9pbml0KCZnZ3R0LT52bSwgVk1fQ0xBU1NfR0dUVCk7CiAKIAlnZ3R0LT52bS5pc19n
Z3R0ID0gdHJ1ZTsKIAogCS8qIE9ubHkgVkxWIHN1cHBvcnRzIHJlYWQtb25seSBHR1RUIG1hcHBp
bmdzICovCi0JZ2d0dC0+dm0uaGFzX3JlYWRfb25seSA9IElTX1ZBTExFWVZJRVcoZGV2X3ByaXYp
OworCWdndHQtPnZtLmhhc19yZWFkX29ubHkgPSBJU19WQUxMRVlWSUVXKGk5MTUpOwogCi0JaWYg
KCFIQVNfTExDKGRldl9wcml2KSAmJiAhSEFTX1BQR1RUKGRldl9wcml2KSkKKwlpZiAoIUhBU19M
TEMoaTkxNSkgJiYgIUhBU19QUEdUVChpOTE1KSkKIAkJZ2d0dC0+dm0ubW0uY29sb3JfYWRqdXN0
ID0gaTkxNV9ndHRfY29sb3JfYWRqdXN0OwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAK
LQlpZiAoIWlvX21hcHBpbmdfaW5pdF93YygmZGV2X3ByaXYtPmdndHQuaW9tYXAsCi0JCQkJZGV2
X3ByaXYtPmdndHQuZ21hZHIuc3RhcnQsCi0JCQkJZGV2X3ByaXYtPmdndHQubWFwcGFibGVfZW5k
KSkgeworCWlmICghaW9fbWFwcGluZ19pbml0X3djKCZpOTE1LT5nZ3R0LmlvbWFwLAorCQkJCWk5
MTUtPmdndHQuZ21hZHIuc3RhcnQsCisJCQkJaTkxNS0+Z2d0dC5tYXBwYWJsZV9lbmQpKSB7CiAJ
CXJldCA9IC1FSU87CiAJCWdvdG8gb3V0X2d0dF9jbGVhbnVwOwogCX0KQEAgLTM1NzEsNyArMzU3
MSw3IEBAIGludCBpOTE1X2dndHRfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJICogSW5pdGlhbGlzZSBzdG9sZW4gZWFybHkgc28gdGhhdCB3ZSBtYXkgcmVzZXJ2
ZSBwcmVhbGxvY2F0ZWQKIAkgKiBvYmplY3RzIGZvciB0aGUgQklPUyB0byBLTVMgdHJhbnNpdGlv
bi4KIAkgKi8KLQlyZXQgPSBpOTE1X2dlbV9pbml0X3N0b2xlbihkZXZfcHJpdik7CisJcmV0ID0g
aTkxNV9nZW1faW5pdF9zdG9sZW4oaTkxNSk7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfZ3R0X2Ns
ZWFudXA7CiAKQEAgLTM1ODIsOSArMzU4Miw5IEBAIGludCBpOTE1X2dndHRfaW5pdF9odyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIHJldDsKIH0KIAotaW50IGk5
MTVfZ2d0dF9lbmFibGVfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50
IGk5MTVfZ2d0dF9lbmFibGVfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA2ICYmICFpbnRlbF9lbmFibGVfZ3R0KCkpCisJaWYg
KElOVEVMX0dFTihpOTE1KSA8IDYgJiYgIWludGVsX2VuYWJsZV9ndHQoKSkKIAkJcmV0dXJuIC1F
SU87CiAKIAlyZXR1cm4gMDsKQEAgLTM2MTMsMTIgKzM2MTMsMTIgQEAgdm9pZCBpOTE1X2dndHRf
ZGlzYWJsZV9ndWMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaTkxNV9nZ3R0X2lu
dmFsaWRhdGUoaTkxNSk7CiB9CiAKLXZvaWQgaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3Mo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpOTE1X2dlbV9yZXN0b3Jl
X2d0dF9tYXBwaW5ncyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qg
aTkxNV9nZ3R0ICpnZ3R0ID0gJmRldl9wcml2LT5nZ3R0OworCXN0cnVjdCBpOTE1X2dndHQgKmdn
dHQgPSAmaTkxNS0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCi0JaTkxNV9j
aGVja19hbmRfY2xlYXJfZmF1bHRzKGRldl9wcml2KTsKKwlpOTE1X2NoZWNrX2FuZF9jbGVhcl9m
YXVsdHMoaTkxNSk7CiAKIAltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAKQEAgLTM2NTIs
MTUgKzM2NTIsMTUgQEAgdm9pZCBpOTE1X2dlbV9yZXN0b3JlX2d0dF9tYXBwaW5ncyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogCiAJZ2d0dC0+dm0uY2xvc2VkID0gZmFs
c2U7Ci0JaTkxNV9nZ3R0X2ludmFsaWRhdGUoZGV2X3ByaXYpOworCWk5MTVfZ2d0dF9pbnZhbGlk
YXRlKGk5MTUpOwogCiAJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAKLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA4KSB7Ci0JCXN0cnVjdCBpbnRlbF9wcGF0ICpwcGF0ID0gJmRl
dl9wcml2LT5wcGF0OworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCkgeworCQlzdHJ1Y3QgaW50
ZWxfcHBhdCAqcHBhdCA9ICZpOTE1LT5wcGF0OwogCiAJCWJpdG1hcF9zZXQocHBhdC0+ZGlydHks
IDAsIHBwYXQtPm1heF9lbnRyaWVzKTsKLQkJZGV2X3ByaXYtPnBwYXQudXBkYXRlX2h3KGRldl9w
cml2KTsKKwkJaTkxNS0+cHBhdC51cGRhdGVfaHcoaTkxNSk7CiAJCXJldHVybjsKIAl9CiB9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4IDg5NDM3ZDBhNzIxYy4uYjQ0NDU1MmNj
YzYzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAtNDAwLDcgKzQwMCw3IEBA
IHN0cnVjdCBpOTE1X2dndHQgewogCiAJLyoqICJHcmFwaGljcyBTdG9sZW4gTWVtb3J5IiBob2xk
cyB0aGUgZ2xvYmFsIFBURXMgKi8KIAl2b2lkIF9faW9tZW0gKmdzbTsKLQl2b2lkICgqaW52YWxp
ZGF0ZSkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKKwl2b2lkICgqaW52YWxp
ZGF0ZSkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiAJYm9vbCBkb19pZGxlX21h
cHM7CiAKQEAgLTYyNywxNyArNjI3LDE3IEBAIGNvbnN0IHN0cnVjdCBpbnRlbF9wcGF0X2VudHJ5
ICoKIGludGVsX3BwYXRfZ2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1OCB2YWx1
ZSk7CiB2b2lkIGludGVsX3BwYXRfcHV0KGNvbnN0IHN0cnVjdCBpbnRlbF9wcGF0X2VudHJ5ICpl
bnRyeSk7CiAKLWludCBpOTE1X2dndHRfcHJvYmVfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKLWludCBpOTE1X2dndHRfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOwotaW50IGk5MTVfZ2d0dF9lbmFibGVfaHcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKK2ludCBpOTE1X2dndHRfcHJvYmVfaHcoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOworaW50IGk5MTVfZ2d0dF9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKK2ludCBpOTE1X2dndHRfZW5hYmxlX2h3KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKIHZvaWQgaTkxNV9nZ3R0X2VuYWJsZV9ndWMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBpOTE1X2dndHRfZGlzYWJsZV9ndWMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpOwotaW50IGk5MTVfZ2VtX2luaXRfZ2d0dChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X2dndHRfY2xlYW51cF9odyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaW50IGk5MTVfZ2VtX2luaXRfZ2d0dChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGk5MTVfZ2d0dF9jbGVhbnVwX2h3KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAotaW50IGk5MTVfcHBndHRfaW5pdF9odyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaW50IGk5MTVfcHBndHRfaW5pdF9o
dyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKLXN0cnVjdCBpOTE1X3BwZ3R0ICpp
OTE1X3BwZ3R0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworc3Ry
dWN0IGk5MTVfcHBndHQgKmk5MTVfcHBndHRfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICoKIGk5
MTVfdm1fZ2V0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQpAQCAtNjU3LDggKzY1Nyw4
IEBAIGludCBnZW42X3BwZ3R0X3BpbihzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CiB2b2lkIGdl
bjZfcHBndHRfdW5waW4oc3RydWN0IGk5MTVfcHBndHQgKmJhc2UpOwogdm9pZCBnZW42X3BwZ3R0
X3VucGluX2FsbChzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CiAKLXZvaWQgaTkxNV9nZW1fc3Vz
cGVuZF9ndHRfbWFwcGluZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZv
aWQgaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKK3ZvaWQgaTkxNV9nZW1fc3VzcGVuZF9ndHRfbWFwcGluZ3Moc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpOTE1X2dlbV9yZXN0b3JlX2d0dF9tYXBwaW5n
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKIGludCBfX211c3RfY2hlY2sgaTkx
NV9nZW1fZ3R0X3ByZXBhcmVfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAkJCQkJICAgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z3B1X2Vycm9yLmMKaW5kZXggZDdmMTY0YzlmMmViLi4zMzVkYTU5MDMxYjAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYwpAQCAtMTEyMiwyMiArMTEyMiwyMiBAQCBzdGF0aWMg
dTMyIGk5MTVfZXJyb3JfZ2VuZXJhdGVfY29kZShzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9y
LAogCiBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX2ZlbmNlcyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUg
KmVycm9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGVycm9yLT5p
OTE1OwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZXJyb3ItPmk5MTU7CisJc3RydWN0IGlu
dGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAlpbnQgaTsKIAotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDYpIHsKLQkJZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1f
ZmVuY2VfcmVnczsgaSsrKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikgeworCQlmb3IgKGkg
PSAwOyBpIDwgaTkxNS0+bnVtX2ZlbmNlX3JlZ3M7IGkrKykKIAkJCWVycm9yLT5mZW5jZVtpXSA9
CiAJCQkJaW50ZWxfdW5jb3JlX3JlYWQ2NCh1bmNvcmUsCiAJCQkJCQkgICAgRkVOQ0VfUkVHX0dF
TjZfTE8oaSkpOwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7Ci0JCWZv
ciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+bnVtX2ZlbmNlX3JlZ3M7IGkrKykKKwl9IGVsc2UgaWYg
KElOVEVMX0dFTihpOTE1KSA+PSA0KSB7CisJCWZvciAoaSA9IDA7IGkgPCBpOTE1LT5udW1fZmVu
Y2VfcmVnczsgaSsrKQogCQkJZXJyb3ItPmZlbmNlW2ldID0KIAkJCQlpbnRlbF91bmNvcmVfcmVh
ZDY0KHVuY29yZSwKIAkJCQkJCSAgICBGRU5DRV9SRUdfOTY1X0xPKGkpKTsKIAl9IGVsc2Ugewot
CQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPm51bV9mZW5jZV9yZWdzOyBpKyspCisJCWZvciAo
aSA9IDA7IGkgPCBpOTE1LT5udW1fZmVuY2VfcmVnczsgaSsrKQogCQkJZXJyb3ItPmZlbmNlW2ld
ID0KIAkJCQlpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIEZFTkNFX1JFRyhpKSk7CiAJfQpAQCAt
MTE0OCwyMyArMTE0OCwyMyBAQCBzdGF0aWMgdm9pZCBlcnJvcl9yZWNvcmRfZW5naW5lX3JlZ2lz
dGVycyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLAogCQkJCQkgIHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkJICBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5lICpl
ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBlbmdpbmUtPmk5MTU7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CiAKLQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA2KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KSB7
CiAJCWVlLT5yY19wc21pID0gRU5HSU5FX1JFQUQoZW5naW5lLCBSSU5HX1BTTUlfQ1RMKTsKLQkJ
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4
KQogCQkJZWUtPmZhdWx0X3JlZyA9IEk5MTVfUkVBRChHRU44X1JJTkdfRkFVTFRfUkVHKTsKIAkJ
ZWxzZQogCQkJZWUtPmZhdWx0X3JlZyA9IEdFTjZfUklOR19GQVVMVF9SRUdfUkVBRChlbmdpbmUp
OwogCX0KIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpIHsKKwlpZiAoSU5URUxfR0VO
KGk5MTUpID49IDQpIHsKIAkJZWUtPmZhZGRyID0gRU5HSU5FX1JFQUQoZW5naW5lLCBSSU5HX0RN
QV9GQUREKTsKIAkJZWUtPmlwZWlyID0gRU5HSU5FX1JFQUQoZW5naW5lLCBSSU5HX0lQRUlSKTsK
IAkJZWUtPmlwZWhyID0gRU5HSU5FX1JFQUQoZW5naW5lLCBSSU5HX0lQRUhSKTsKIAkJZWUtPmlu
c3RwcyA9IEVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19JTlNUUFMpOwogCQllZS0+YmJhZGRyID0g
RU5HSU5FX1JFQUQoZW5naW5lLCBSSU5HX0JCQUREUik7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDgpIHsKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KSB7CiAJCQllZS0+ZmFkZHIg
fD0gKHU2NClFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfRE1BX0ZBRERfVURXKSA8PCAzMjsKIAkJ
CWVlLT5iYmFkZHIgfD0gKHU2NClFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfQkJBRERSX1VEVykg
PDwgMzI7CiAJCX0KQEAgLTExODMsMTMgKzExODMsMTMgQEAgc3RhdGljIHZvaWQgZXJyb3JfcmVj
b3JkX2VuZ2luZV9yZWdpc3RlcnMoc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvciwKIAllZS0+
aGVhZCA9IEVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19IRUFEKTsKIAllZS0+dGFpbCA9IEVOR0lO
RV9SRUFEKGVuZ2luZSwgUklOR19UQUlMKTsKIAllZS0+Y3RsID0gRU5HSU5FX1JFQUQoZW5naW5l
LCBSSU5HX0NUTCk7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPiAyKQorCWlmIChJTlRFTF9H
RU4oaTkxNSkgPiAyKQogCQllZS0+bW9kZSA9IEVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19NSV9N
T0RFKTsKIAotCWlmICghSFdTX05FRURTX1BIWVNJQ0FMKGRldl9wcml2KSkgeworCWlmICghSFdT
X05FRURTX1BIWVNJQ0FMKGk5MTUpKSB7CiAJCWk5MTVfcmVnX3QgbW1pbzsKIAotCQlpZiAoSVNf
R0VOKGRldl9wcml2LCA3KSkgeworCQlpZiAoSVNfR0VOKGk5MTUsIDcpKSB7CiAJCQlzd2l0Y2gg
KGVuZ2luZS0+aWQpIHsKIAkJCWRlZmF1bHQ6CiAJCQkJTUlTU0lOR19DQVNFKGVuZ2luZS0+aWQp
OwpAQCAtMTIxOSwyMSArMTIxOSwyMSBAQCBzdGF0aWMgdm9pZCBlcnJvcl9yZWNvcmRfZW5naW5l
X3JlZ2lzdGVycyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLAogCWVlLT5pZGxlID0gaW50
ZWxfZW5naW5lX2lzX2lkbGUoZW5naW5lKTsKIAlpZiAoIWVlLT5pZGxlKQogCQllZS0+aGFuZ2No
ZWNrX3RpbWVzdGFtcCA9IGVuZ2luZS0+aGFuZ2NoZWNrLmFjdGlvbl90aW1lc3RhbXA7Ci0JZWUt
PnJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9lbmdpbmVfY291bnQoJmRldl9wcml2LT5ncHVfZXJy
b3IsCisJZWUtPnJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9lbmdpbmVfY291bnQoJmk5MTUtPmdw
dV9lcnJvciwKIAkJCQkJCSAgZW5naW5lKTsKIAotCWlmIChIQVNfUFBHVFQoZGV2X3ByaXYpKSB7
CisJaWYgKEhBU19QUEdUVChpOTE1KSkgewogCQlpbnQgaTsKIAogCQllZS0+dm1faW5mby5nZnhf
bW9kZSA9IEVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19NT0RFX0dFTjcpOwogCi0JCWlmIChJU19H
RU4oZGV2X3ByaXYsIDYpKSB7CisJCWlmIChJU19HRU4oaTkxNSwgNikpIHsKIAkJCWVlLT52bV9p
bmZvLnBwX2Rpcl9iYXNlID0KIAkJCQlFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfUFBfRElSX0JB
U0VfUkVBRCk7Ci0JCX0gZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA3KSkgeworCQl9IGVsc2Ug
aWYgKElTX0dFTihpOTE1LCA3KSkgewogCQkJZWUtPnZtX2luZm8ucHBfZGlyX2Jhc2UgPQogCQkJ
CUVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19QUF9ESVJfQkFTRSk7Ci0JCX0gZWxzZSBpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA4KSB7CisJCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49
IDgpIHsKIAkJCXUzMiBiYXNlID0gZW5naW5lLT5tbWlvX2Jhc2U7CiAKIAkJCWZvciAoaSA9IDA7
IGkgPCA0OyBpKyspIHsKQEAgLTEzODgsNyArMTM4OCw3IEBAIHN0YXRpYyB2b2lkIHJlcXVlc3Rf
cmVjb3JkX3VzZXJfYm8oc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCwKIH0KIAogc3RhdGlj
IHN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmplY3QgKgotY2FwdHVyZV9vYmplY3Qoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorY2FwdHVyZV9vYmplY3Qoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiB7CiAJaWYgKG9iaiAmJiBpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpIHsKQEAgLTEz
OTksNyArMTM5OSw3IEBAIGNhcHR1cmVfb2JqZWN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJCS5vYmogPSBvYmosCiAJCX07CiAKLQkJcmV0dXJuIGk5MTVfZXJyb3Jfb2Jq
ZWN0X2NyZWF0ZShkZXZfcHJpdiwgJmZha2UpOworCQlyZXR1cm4gaTkxNV9lcnJvcl9vYmplY3Rf
Y3JlYXRlKGk5MTUsICZmYWtlKTsKIAl9IGVsc2UgewogCQlyZXR1cm4gTlVMTDsKIAl9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuaAppbmRleCAyZWNkMGM2YTFjOTQuLjk4MGY5NWZi
NTU3OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oCkBAIC0yMzQsNyArMjM0
LDcgQEAgc3RydWN0IGk5MTVfZ3B1X2Vycm9yIHsKIAogCS8qKgogCSAqIFdhaXRxdWV1ZSB0byBz
aWduYWwgd2hlbiB0aGUgcmVzZXQgaGFzIGNvbXBsZXRlZC4gVXNlZCBieSBjbGllbnRzCi0JICog
dGhhdCB3YWl0IGZvciBkZXZfcHJpdi0+bW0ud2VkZ2VkIHRvIHNldHRsZS4KKwkgKiB0aGF0IHdh
aXQgZm9yIGk5MTUtPm1tLndlZGdlZCB0byBzZXR0bGUuCiAJICovCiAJd2FpdF9xdWV1ZV9oZWFk
X3QgcmVzZXRfcXVldWU7CiAKQEAgLTI1OSw3ICsyNTksNyBAQCBfX3ByaW50ZigyLCAzKQogdm9p
ZCBpOTE1X2Vycm9yX3ByaW50ZihzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICplLCBj
b25zdCBjaGFyICpmLCAuLi4pOwogCiBzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmk5MTVfY2FwdHVy
ZV9ncHVfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwotdm9pZCBpOTE1X2Nh
cHR1cmVfZXJyb3Jfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9p
ZCBpOTE1X2NhcHR1cmVfZXJyb3Jfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkgICAgICBpbnRlbF9lbmdpbmVfbWFza190IGVuZ2luZV9tYXNrLAogCQkJICAgICAgY29u
c3QgY2hhciAqZXJyb3JfbXNnKTsKIApAQCAtMjg2LDcgKzI4Niw3IEBAIHZvaWQgaTkxNV9kaXNh
YmxlX2Vycm9yX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgZXJyKTsK
IAogI2Vsc2UKIAotc3RhdGljIGlubGluZSB2b2lkIGk5MTVfY2FwdHVyZV9lcnJvcl9zdGF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgaW5saW5lIHZvaWQgaTkx
NV9jYXB0dXJlX2Vycm9yX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
CQkgICAgdTMyIGVuZ2luZV9tYXNrLAogCQkJCQkgICAgY29uc3QgY2hhciAqZXJyb3JfbXNnKQog
ewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5kZXggY2Q5ZWRkZGQ2NzE4Li44MWVhNjVkODViOWYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpAQCAtMjU2LDE4ICsyNTYsMTggQEAgc3RhdGljIHZv
aWQgZ2VuMl9pcnFfaW5pdChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCiAjZGVmaW5lIEdF
TjJfSVJRX0lOSVQodW5jb3JlLCBpbXJfdmFsLCBpZXJfdmFsKSBcCiAJZ2VuMl9pcnFfaW5pdCgo
dW5jb3JlKSwgaW1yX3ZhbCwgaWVyX3ZhbCkKIAotc3RhdGljIHZvaWQgZ2VuNl9ycHNfaXJxX2hh
bmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcG1faWlyKTsKLXN0
YXRpYyB2b2lkIGdlbjlfZ3VjX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgdTMyIHBtX2lpcik7CitzdGF0aWMgdm9pZCBnZW42X3Jwc19pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHBtX2lpcik7CitzdGF0aWMgdm9pZCBn
ZW45X2d1Y19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHBt
X2lpcik7CiAKIC8qIEZvciBkaXNwbGF5IGhvdHBsdWcgaW50ZXJydXB0ICovCiBzdGF0aWMgaW5s
aW5lIHZvaWQKLWk5MTVfaG90cGx1Z19pbnRlcnJ1cHRfdXBkYXRlX2xvY2tlZChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3VwZGF0ZV9s
b2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICB1MzIgbWFzaywK
IAkJCQkgICAgIHUzMiBiaXRzKQogewogCXUzMiB2YWw7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZkZXZfcHJpdi0+aXJxX2xvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9s
b2NrKTsKIAlXQVJOX09OKGJpdHMgJiB+bWFzayk7CiAKIAl2YWwgPSBJOTE1X1JFQUQoUE9SVF9I
T1RQTFVHX0VOKTsKQEAgLTI3OCw3ICsyNzgsNyBAQCBpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3Vw
ZGF0ZV9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAvKioKICAq
IGk5MTVfaG90cGx1Z19pbnRlcnJ1cHRfdXBkYXRlIC0gdXBkYXRlIGhvdHBsdWcgaW50ZXJydXB0
IGVuYWJsZQotICogQGRldl9wcml2OiBkcml2ZXIgcHJpdmF0ZQorICogQGk5MTU6IGRyaXZlciBw
cml2YXRlCiAgKiBAbWFzazogYml0cyB0byB1cGRhdGUKICAqIEBiaXRzOiBiaXRzIHRvIGVuYWJs
ZQogICogTk9URTogdGhlIEhQRCBlbmFibGUgYml0cyBhcmUgbW9kaWZpZWQgYm90aCBpbnNpZGUg
YW5kIG91dHNpZGUKQEAgLTI4OCwxMyArMjg4LDEzIEBAIGk5MTVfaG90cGx1Z19pbnRlcnJ1cHRf
dXBkYXRlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBoZWxk
IGFscmVhZHksIHRoaXMgZnVuY3Rpb24gYWNxdWlyZXMgdGhlIGxvY2sgaXRzZWxmLiBBIG5vbi1s
b2NraW5nCiAgKiB2ZXJzaW9uIGlzIGFsc28gYXZhaWxhYmxlLgogICovCi12b2lkIGk5MTVfaG90
cGx1Z19pbnRlcnJ1cHRfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3ZvaWQgaTkxNV9ob3RwbHVnX2ludGVycnVwdF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICAgdTMyIG1hc2ssCiAJCQkJICAgdTMyIGJpdHMpCiB7Ci0Jc3Bpbl9s
b2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3Vw
ZGF0ZV9sb2NrZWQoZGV2X3ByaXYsIG1hc2ssIGJpdHMpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2
X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJaTkx
NV9ob3RwbHVnX2ludGVycnVwdF91cGRhdGVfbG9ja2VkKGk5MTUsIG1hc2ssIGJpdHMpOworCXNw
aW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogfQogCiBzdGF0aWMgdTMyCkBAIC0zMzQs
ODQgKzMzNCw4NCBAQCBzdGF0aWMgYm9vbCBnZW4xMV9yZXNldF9vbmVfaWlyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICogY29uc3QgaTkxNSwKIAogLyoqCiAgKiBpbGtfdXBkYXRlX2Rpc3BsYXlf
aXJxIC0gdXBkYXRlIERFSU1SCi0gKiBAZGV2X3ByaXY6IGRyaXZlciBwcml2YXRlCisgKiBAaTkx
NTogZHJpdmVyIHByaXZhdGUKICAqIEBpbnRlcnJ1cHRfbWFzazogbWFzayBvZiBpbnRlcnJ1cHQg
Yml0cyB0byB1cGRhdGUKICAqIEBlbmFibGVkX2lycV9tYXNrOiBtYXNrIG9mIGludGVycnVwdCBi
aXRzIHRvIGVuYWJsZQogICovCi12b2lkIGlsa191cGRhdGVfZGlzcGxheV9pcnEoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbGtfdXBkYXRlX2Rpc3BsYXlfaXJxKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgIHUzMiBpbnRlcnJ1cHRfbWFzaywK
IAkJCSAgICB1MzIgZW5hYmxlZF9pcnFfbWFzaykKIHsKIAl1MzIgbmV3X3ZhbDsKIAotCWxvY2tk
ZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5pcnFfbG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmaTkxNS0+aXJxX2xvY2spOwogCiAJV0FSTl9PTihlbmFibGVkX2lycV9tYXNrICYgfmludGVy
cnVwdF9tYXNrKTsKIAotCWlmIChXQVJOX09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoZGV2X3ByaXYp
KSkKKwlpZiAoV0FSTl9PTighaW50ZWxfaXJxc19lbmFibGVkKGk5MTUpKSkKIAkJcmV0dXJuOwog
Ci0JbmV3X3ZhbCA9IGRldl9wcml2LT5pcnFfbWFzazsKKwluZXdfdmFsID0gaTkxNS0+aXJxX21h
c2s7CiAJbmV3X3ZhbCAmPSB+aW50ZXJydXB0X21hc2s7CiAJbmV3X3ZhbCB8PSAofmVuYWJsZWRf
aXJxX21hc2sgJiBpbnRlcnJ1cHRfbWFzayk7CiAKLQlpZiAobmV3X3ZhbCAhPSBkZXZfcHJpdi0+
aXJxX21hc2spIHsKLQkJZGV2X3ByaXYtPmlycV9tYXNrID0gbmV3X3ZhbDsKLQkJSTkxNV9XUklU
RShERUlNUiwgZGV2X3ByaXYtPmlycV9tYXNrKTsKKwlpZiAobmV3X3ZhbCAhPSBpOTE1LT5pcnFf
bWFzaykgeworCQlpOTE1LT5pcnFfbWFzayA9IG5ld192YWw7CisJCUk5MTVfV1JJVEUoREVJTVIs
IGk5MTUtPmlycV9tYXNrKTsKIAkJUE9TVElOR19SRUFEKERFSU1SKTsKIAl9CiB9CiAKIC8qKgog
ICogaWxrX3VwZGF0ZV9ndF9pcnEgLSB1cGRhdGUgR1RJTVIKLSAqIEBkZXZfcHJpdjogZHJpdmVy
IHByaXZhdGUKKyAqIEBpOTE1OiBkcml2ZXIgcHJpdmF0ZQogICogQGludGVycnVwdF9tYXNrOiBt
YXNrIG9mIGludGVycnVwdCBiaXRzIHRvIHVwZGF0ZQogICogQGVuYWJsZWRfaXJxX21hc2s6IG1h
c2sgb2YgaW50ZXJydXB0IGJpdHMgdG8gZW5hYmxlCiAgKi8KLXN0YXRpYyB2b2lkIGlsa191cGRh
dGVfZ3RfaXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lk
IGlsa191cGRhdGVfZ3RfaXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAg
ICAgdTMyIGludGVycnVwdF9tYXNrLAogCQkJICAgICAgdTMyIGVuYWJsZWRfaXJxX21hc2spCiB7
Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZpOTE1LT5pcnFfbG9jayk7CiAKIAlXQVJOX09OKGVuYWJsZWRfaXJxX21hc2sg
JiB+aW50ZXJydXB0X21hc2spOwogCi0JaWYgKFdBUk5fT04oIWludGVsX2lycXNfZW5hYmxlZChk
ZXZfcHJpdikpKQorCWlmIChXQVJOX09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoaTkxNSkpKQogCQly
ZXR1cm47CiAKLQlkZXZfcHJpdi0+Z3RfaXJxX21hc2sgJj0gfmludGVycnVwdF9tYXNrOwotCWRl
dl9wcml2LT5ndF9pcnFfbWFzayB8PSAofmVuYWJsZWRfaXJxX21hc2sgJiBpbnRlcnJ1cHRfbWFz
ayk7Ci0JSTkxNV9XUklURShHVElNUiwgZGV2X3ByaXYtPmd0X2lycV9tYXNrKTsKKwlpOTE1LT5n
dF9pcnFfbWFzayAmPSB+aW50ZXJydXB0X21hc2s7CisJaTkxNS0+Z3RfaXJxX21hc2sgfD0gKH5l
bmFibGVkX2lycV9tYXNrICYgaW50ZXJydXB0X21hc2spOworCUk5MTVfV1JJVEUoR1RJTVIsIGk5
MTUtPmd0X2lycV9tYXNrKTsKIH0KIAotdm9pZCBnZW41X2VuYWJsZV9ndF9pcnEoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgbWFzaykKK3ZvaWQgZ2VuNV9lbmFibGVfZ3Rf
aXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgbWFzaykKIHsKLQlpbGtfdXBk
YXRlX2d0X2lycShkZXZfcHJpdiwgbWFzaywgbWFzayk7Ci0JaW50ZWxfdW5jb3JlX3Bvc3Rpbmdf
cmVhZF9mdygmZGV2X3ByaXYtPnVuY29yZSwgR1RJTVIpOworCWlsa191cGRhdGVfZ3RfaXJxKGk5
MTUsIG1hc2ssIG1hc2spOworCWludGVsX3VuY29yZV9wb3N0aW5nX3JlYWRfZncoJmk5MTUtPnVu
Y29yZSwgR1RJTVIpOwogfQogCi12b2lkIGdlbjVfZGlzYWJsZV9ndF9pcnEoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgbWFzaykKK3ZvaWQgZ2VuNV9kaXNhYmxlX2d0X2ly
cShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIG1hc2spCiB7Ci0JaWxrX3VwZGF0
ZV9ndF9pcnEoZGV2X3ByaXYsIG1hc2ssIDApOworCWlsa191cGRhdGVfZ3RfaXJxKGk5MTUsIG1h
c2ssIDApOwogfQogCi1zdGF0aWMgaTkxNV9yZWdfdCBnZW42X3BtX2lpcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaTkxNV9yZWdfdCBnZW42X3BtX2lpcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlXQVJOX09OX09OQ0UoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMSk7CisJV0FSTl9PTl9PTkNFKElOVEVMX0dFTihpOTE1KSA+PSAxMSk7CiAK
LQlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSA4ID8gR0VOOF9HVF9JSVIoMikgOiBHRU42
X1BNSUlSOworCXJldHVybiBJTlRFTF9HRU4oaTkxNSkgPj0gOCA/IEdFTjhfR1RfSUlSKDIpIDog
R0VONl9QTUlJUjsKIH0KIAotc3RhdGljIHZvaWQgd3JpdGVfcG1faW1yKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHdyaXRlX3BtX2ltcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpOTE1X3JlZ190IHJlZzsKLQl1MzIgbWFzayA9IGRl
dl9wcml2LT5wbV9pbXI7CisJdTMyIG1hc2sgPSBpOTE1LT5wbV9pbXI7CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHsKIAkJ
cmVnID0gR0VOMTFfR1BNX1dHQk9YUEVSRl9JTlRSX01BU0s7CiAJCS8qIHBtIGlzIGluIHVwcGVy
IGhhbGYgKi8KIAkJbWFzayA9IG1hc2sgPDwgMTY7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDgpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KSB7CiAJCXJl
ZyA9IEdFTjhfR1RfSU1SKDIpOwogCX0gZWxzZSB7CiAJCXJlZyA9IEdFTjZfUE1JTVI7CkBAIC00
MjEsMTYgKzQyMSwxNiBAQCBzdGF0aWMgdm9pZCB3cml0ZV9wbV9pbXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCVBPU1RJTkdfUkVBRChyZWcpOwogfQogCi1zdGF0aWMgdm9p
ZCB3cml0ZV9wbV9pZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgd3JpdGVfcG1faWVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWk5
MTVfcmVnX3QgcmVnOwotCXUzMiBtYXNrID0gZGV2X3ByaXYtPnBtX2llcjsKKwl1MzIgbWFzayA9
IGk5MTUtPnBtX2llcjsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJaWYg
KElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewogCQlyZWcgPSBHRU4xMV9HUE1fV0dCT1hQRVJGX0lO
VFJfRU5BQkxFOwogCQkvKiBwbSBpcyBpbiB1cHBlciBoYWxmICovCiAJCW1hc2sgPSBtYXNrIDw8
IDE2OwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KSB7CisJfSBlbHNlIGlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gOCkgewogCQlyZWcgPSBHRU44X0dUX0lFUigyKTsKIAl9IGVs
c2UgewogCQlyZWcgPSBHRU42X1BNSUVSOwpAQCAtNDQxLDExICs0NDEsMTEgQEAgc3RhdGljIHZv
aWQgd3JpdGVfcG1faWVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogLyoq
CiAgKiBzbmJfdXBkYXRlX3BtX2lycSAtIHVwZGF0ZSBHRU42X1BNSU1SCi0gKiBAZGV2X3ByaXY6
IGRyaXZlciBwcml2YXRlCisgKiBAaTkxNTogZHJpdmVyIHByaXZhdGUKICAqIEBpbnRlcnJ1cHRf
bWFzazogbWFzayBvZiBpbnRlcnJ1cHQgYml0cyB0byB1cGRhdGUKICAqIEBlbmFibGVkX2lycV9t
YXNrOiBtYXNrIG9mIGludGVycnVwdCBiaXRzIHRvIGVuYWJsZQogICovCi1zdGF0aWMgdm9pZCBz
bmJfdXBkYXRlX3BtX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdm9pZCBzbmJfdXBkYXRlX3BtX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgICAgIHUzMiBpbnRlcnJ1cHRfbWFzaywKIAkJCSAgICAgIHUzMiBlbmFibGVkX2lycV9t
YXNrKQogewpAQCAtNDUzLDEyNyArNDUzLDEyNyBAQCBzdGF0aWMgdm9pZCBzbmJfdXBkYXRlX3Bt
X2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAlXQVJOX09OKGVuYWJs
ZWRfaXJxX21hc2sgJiB+aW50ZXJydXB0X21hc2spOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgm
ZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5pcnFfbG9j
ayk7CiAKLQluZXdfdmFsID0gZGV2X3ByaXYtPnBtX2ltcjsKKwluZXdfdmFsID0gaTkxNS0+cG1f
aW1yOwogCW5ld192YWwgJj0gfmludGVycnVwdF9tYXNrOwogCW5ld192YWwgfD0gKH5lbmFibGVk
X2lycV9tYXNrICYgaW50ZXJydXB0X21hc2spOwogCi0JaWYgKG5ld192YWwgIT0gZGV2X3ByaXYt
PnBtX2ltcikgewotCQlkZXZfcHJpdi0+cG1faW1yID0gbmV3X3ZhbDsKLQkJd3JpdGVfcG1faW1y
KGRldl9wcml2KTsKKwlpZiAobmV3X3ZhbCAhPSBpOTE1LT5wbV9pbXIpIHsKKwkJaTkxNS0+cG1f
aW1yID0gbmV3X3ZhbDsKKwkJd3JpdGVfcG1faW1yKGk5MTUpOwogCX0KIH0KIAotdm9pZCBnZW42
X3VubWFza19wbV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgbWFz
aykKK3ZvaWQgZ2VuNl91bm1hc2tfcG1faXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCB1MzIgbWFzaykKIHsKLQlpZiAoV0FSTl9PTighaW50ZWxfaXJxc19lbmFibGVkKGRldl9wcml2
KSkpCisJaWYgKFdBUk5fT04oIWludGVsX2lycXNfZW5hYmxlZChpOTE1KSkpCiAJCXJldHVybjsK
IAotCXNuYl91cGRhdGVfcG1faXJxKGRldl9wcml2LCBtYXNrLCBtYXNrKTsKKwlzbmJfdXBkYXRl
X3BtX2lycShpOTE1LCBtYXNrLCBtYXNrKTsKIH0KIAotc3RhdGljIHZvaWQgX19nZW42X21hc2tf
cG1faXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIG1hc2spCitzdGF0
aWMgdm9pZCBfX2dlbjZfbWFza19wbV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IHUzMiBtYXNrKQogewotCXNuYl91cGRhdGVfcG1faXJxKGRldl9wcml2LCBtYXNrLCAwKTsKKwlz
bmJfdXBkYXRlX3BtX2lycShpOTE1LCBtYXNrLCAwKTsKIH0KIAotdm9pZCBnZW42X21hc2tfcG1f
aXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIG1hc2spCit2b2lkIGdl
bjZfbWFza19wbV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBtYXNrKQog
ewotCWlmIChXQVJOX09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoZGV2X3ByaXYpKSkKKwlpZiAoV0FS
Tl9PTighaW50ZWxfaXJxc19lbmFibGVkKGk5MTUpKSkKIAkJcmV0dXJuOwogCi0JX19nZW42X21h
c2tfcG1faXJxKGRldl9wcml2LCBtYXNrKTsKKwlfX2dlbjZfbWFza19wbV9pcnEoaTkxNSwgbWFz
ayk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjZfcmVzZXRfcG1faWlyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgdTMyIHJlc2V0X21hc2spCitzdGF0aWMgdm9pZCBnZW42X3Jlc2V0
X3BtX2lpcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHJlc2V0X21hc2spCiB7
Ci0JaTkxNV9yZWdfdCByZWcgPSBnZW42X3BtX2lpcihkZXZfcHJpdik7CisJaTkxNV9yZWdfdCBy
ZWcgPSBnZW42X3BtX2lpcihpOTE1KTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2
LT5pcnFfbG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+aXJxX2xvY2spOwogCiAJ
STkxNV9XUklURShyZWcsIHJlc2V0X21hc2spOwogCUk5MTVfV1JJVEUocmVnLCByZXNldF9tYXNr
KTsKIAlQT1NUSU5HX1JFQUQocmVnKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuNl9lbmFibGVfcG1f
aXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGVuYWJsZV9tYXNrKQor
c3RhdGljIHZvaWQgZ2VuNl9lbmFibGVfcG1faXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCB1MzIgZW5hYmxlX21hc2spCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYt
PmlycV9sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5pcnFfbG9jayk7CiAKLQlk
ZXZfcHJpdi0+cG1faWVyIHw9IGVuYWJsZV9tYXNrOwotCXdyaXRlX3BtX2llcihkZXZfcHJpdik7
Ci0JZ2VuNl91bm1hc2tfcG1faXJxKGRldl9wcml2LCBlbmFibGVfbWFzayk7CisJaTkxNS0+cG1f
aWVyIHw9IGVuYWJsZV9tYXNrOworCXdyaXRlX3BtX2llcihpOTE1KTsKKwlnZW42X3VubWFza19w
bV9pcnEoaTkxNSwgZW5hYmxlX21hc2spOwogCS8qIHVubWFza19wbV9pcnEgcHJvdmlkZXMgYW4g
aW1wbGljaXQgYmFycmllciAoUE9TVElOR19SRUFEKSAqLwogfQogCi1zdGF0aWMgdm9pZCBnZW42
X2Rpc2FibGVfcG1faXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGRp
c2FibGVfbWFzaykKK3N0YXRpYyB2b2lkIGdlbjZfZGlzYWJsZV9wbV9pcnEoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBkaXNhYmxlX21hc2spCiB7Ci0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5p
cnFfbG9jayk7CiAKLQlkZXZfcHJpdi0+cG1faWVyICY9IH5kaXNhYmxlX21hc2s7Ci0JX19nZW42
X21hc2tfcG1faXJxKGRldl9wcml2LCBkaXNhYmxlX21hc2spOwotCXdyaXRlX3BtX2llcihkZXZf
cHJpdik7CisJaTkxNS0+cG1faWVyICY9IH5kaXNhYmxlX21hc2s7CisJX19nZW42X21hc2tfcG1f
aXJxKGk5MTUsIGRpc2FibGVfbWFzayk7CisJd3JpdGVfcG1faWVyKGk5MTUpOwogCS8qIHRob3Vn
aCBhIGJhcnJpZXIgaXMgbWlzc2luZyBoZXJlLCBidXQgZG9uJ3QgcmVhbGx5IG5lZWQgYSBvbmUg
Ki8KIH0KIAotdm9pZCBnZW4xMV9yZXNldF9ycHNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGdlbjExX3Jlc2V0X3Jwc19pbnRlcnJ1cHRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5p
cnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCi0Jd2hpbGUgKGdl
bjExX3Jlc2V0X29uZV9paXIoZGV2X3ByaXYsIDAsIEdFTjExX0dUUE0pKQorCXdoaWxlIChnZW4x
MV9yZXNldF9vbmVfaWlyKGk5MTUsIDAsIEdFTjExX0dUUE0pKQogCQk7CiAKLQlkZXZfcHJpdi0+
Z3RfcG0ucnBzLnBtX2lpciA9IDA7CisJaTkxNS0+Z3RfcG0ucnBzLnBtX2lpciA9IDA7CiAKLQlz
cGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl91bmxvY2tfaXJxKCZp
OTE1LT5pcnFfbG9jayk7CiB9CiAKLXZvaWQgZ2VuNl9yZXNldF9ycHNfaW50ZXJydXB0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGdlbjZfcmVzZXRfcnBzX2ludGVy
cnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3Bpbl9sb2NrX2lycSgm
ZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlnZW42X3Jlc2V0X3BtX2lpcihkZXZfcHJpdiwgR0VONl9Q
TV9SUFNfRVZFTlRTKTsKLQlkZXZfcHJpdi0+Z3RfcG0ucnBzLnBtX2lpciA9IDA7Ci0Jc3Bpbl91
bmxvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmly
cV9sb2NrKTsKKwlnZW42X3Jlc2V0X3BtX2lpcihpOTE1LCBHRU42X1BNX1JQU19FVkVOVFMpOwor
CWk5MTUtPmd0X3BtLnJwcy5wbV9paXIgPSAwOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJx
X2xvY2spOwogfQogCi12b2lkIGdlbjZfZW5hYmxlX3Jwc19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgZ2VuNl9lbmFibGVfcnBzX2ludGVycnVwdHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBz
ID0gJmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUt
Pmd0X3BtLnJwczsKIAogCWlmIChSRUFEX09OQ0UocnBzLT5pbnRlcnJ1cHRzX2VuYWJsZWQpKQog
CQlyZXR1cm47CiAKLQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNwaW5f
bG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAlXQVJOX09OX09OQ0UocnBzLT5wbV9paXIpOwog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCi0JCVdBUk5fT05fT05DRShnZW4xMV9y
ZXNldF9vbmVfaWlyKGRldl9wcml2LCAwLCBHRU4xMV9HVFBNKSk7CisJaWYgKElOVEVMX0dFTihp
OTE1KSA+PSAxMSkKKwkJV0FSTl9PTl9PTkNFKGdlbjExX3Jlc2V0X29uZV9paXIoaTkxNSwgMCwg
R0VOMTFfR1RQTSkpOwogCWVsc2UKLQkJV0FSTl9PTl9PTkNFKEk5MTVfUkVBRChnZW42X3BtX2lp
cihkZXZfcHJpdikpICYgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpOworCQlXQVJOX09OX09OQ0Uo
STkxNV9SRUFEKGdlbjZfcG1faWlyKGk5MTUpKSAmIGk5MTUtPnBtX3Jwc19ldmVudHMpOwogCiAJ
cnBzLT5pbnRlcnJ1cHRzX2VuYWJsZWQgPSB0cnVlOwotCWdlbjZfZW5hYmxlX3BtX2lycShkZXZf
cHJpdiwgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpOworCWdlbjZfZW5hYmxlX3BtX2lycShpOTE1
LCBpOTE1LT5wbV9ycHNfZXZlbnRzKTsKIAotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmly
cV9sb2NrKTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIH0KIAotdm9pZCBn
ZW42X2Rpc2FibGVfcnBzX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQordm9pZCBnZW42X2Rpc2FibGVfcnBzX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5ndF9w
bS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAogCWlm
ICghUkVBRF9PTkNFKHJwcy0+aW50ZXJydXB0c19lbmFibGVkKSkKIAkJcmV0dXJuOwogCi0Jc3Bp
bl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5p
cnFfbG9jayk7CiAJcnBzLT5pbnRlcnJ1cHRzX2VuYWJsZWQgPSBmYWxzZTsKIAotCUk5MTVfV1JJ
VEUoR0VONl9QTUlOVFJNU0ssIGdlbjZfc2FuaXRpemVfcnBzX3BtX21hc2soZGV2X3ByaXYsIH4w
dSkpOworCUk5MTVfV1JJVEUoR0VONl9QTUlOVFJNU0ssIGdlbjZfc2FuaXRpemVfcnBzX3BtX21h
c2soaTkxNSwgfjB1KSk7CiAKLQlnZW42X2Rpc2FibGVfcG1faXJxKGRldl9wcml2LCBHRU42X1BN
X1JQU19FVkVOVFMpOworCWdlbjZfZGlzYWJsZV9wbV9pcnEoaTkxNSwgR0VONl9QTV9SUFNfRVZF
TlRTKTsKIAotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlzeW5jaHJv
bml6ZV9pcnEoZGV2X3ByaXYtPmRybS5pcnEpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJx
X2xvY2spOworCXN5bmNocm9uaXplX2lycShpOTE1LT5kcm0uaXJxKTsKIAogCS8qIE5vdyB0aGF0
IHdlIHdpbGwgbm90IGJlIGdlbmVyYXRpbmcgYW55IG1vcmUgd29yaywgZmx1c2ggYW55CiAJICog
b3V0c3RhbmRpbmcgdGFza3MuIEFzIHdlIGFyZSBjYWxsZWQgb24gdGhlIFJQUyBpZGxlIHBhdGgs
CkBAIC01ODEsNDggKzU4MSw0OCBAQCB2b2lkIGdlbjZfZGlzYWJsZV9ycHNfaW50ZXJydXB0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogc3RhdGUgb2YgdGhlIHdvcmtl
ciBjYW4gYmUgZGlzY2FyZGVkLgogCSAqLwogCWNhbmNlbF93b3JrX3N5bmMoJnJwcy0+d29yayk7
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCi0JCWdlbjExX3Jlc2V0X3Jwc19pbnRl
cnJ1cHRzKGRldl9wcml2KTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQorCQlnZW4xMV9y
ZXNldF9ycHNfaW50ZXJydXB0cyhpOTE1KTsKIAllbHNlCi0JCWdlbjZfcmVzZXRfcnBzX2ludGVy
cnVwdHMoZGV2X3ByaXYpOworCQlnZW42X3Jlc2V0X3Jwc19pbnRlcnJ1cHRzKGk5MTUpOwogfQog
Ci12b2lkIGdlbjlfcmVzZXRfZ3VjX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQordm9pZCBnZW45X3Jlc2V0X2d1Y19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCWFzc2VydF9ycG1fd2FrZWxvY2tfaGVsZChkZXZfcHJpdik7
CisJYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKGk5MTUpOwogCi0Jc3Bpbl9sb2NrX2lycSgmZGV2
X3ByaXYtPmlycV9sb2NrKTsKLQlnZW42X3Jlc2V0X3BtX2lpcihkZXZfcHJpdiwgZGV2X3ByaXYt
PnBtX2d1Y19ldmVudHMpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsK
KwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJZ2VuNl9yZXNldF9wbV9paXIoaTkx
NSwgaTkxNS0+cG1fZ3VjX2V2ZW50cyk7CisJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9j
ayk7CiB9CiAKLXZvaWQgZ2VuOV9lbmFibGVfZ3VjX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBnZW45X2VuYWJsZV9ndWNfaW50ZXJydXB0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQo
ZGV2X3ByaXYpOworCWFzc2VydF9ycG1fd2FrZWxvY2tfaGVsZChpOTE1KTsKIAotCXNwaW5fbG9j
a19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JaWYgKCFkZXZfcHJpdi0+Z3VjLmludGVycnVw
dHMuZW5hYmxlZCkgewotCQlXQVJOX09OX09OQ0UoSTkxNV9SRUFEKGdlbjZfcG1faWlyKGRldl9w
cml2KSkgJgotCQkJCSAgICAgICBkZXZfcHJpdi0+cG1fZ3VjX2V2ZW50cyk7Ci0JCWRldl9wcml2
LT5ndWMuaW50ZXJydXB0cy5lbmFibGVkID0gdHJ1ZTsKLQkJZ2VuNl9lbmFibGVfcG1faXJxKGRl
dl9wcml2LCBkZXZfcHJpdi0+cG1fZ3VjX2V2ZW50cyk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+
aXJxX2xvY2spOworCWlmICghaTkxNS0+Z3VjLmludGVycnVwdHMuZW5hYmxlZCkgeworCQlXQVJO
X09OX09OQ0UoSTkxNV9SRUFEKGdlbjZfcG1faWlyKGk5MTUpKSAmCisJCQkJICAgICAgIGk5MTUt
PnBtX2d1Y19ldmVudHMpOworCQlpOTE1LT5ndWMuaW50ZXJydXB0cy5lbmFibGVkID0gdHJ1ZTsK
KwkJZ2VuNl9lbmFibGVfcG1faXJxKGk5MTUsIGk5MTUtPnBtX2d1Y19ldmVudHMpOwogCX0KLQlz
cGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl91bmxvY2tfaXJxKCZp
OTE1LT5pcnFfbG9jayk7CiB9CiAKLXZvaWQgZ2VuOV9kaXNhYmxlX2d1Y19pbnRlcnJ1cHRzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgZ2VuOV9kaXNhYmxlX2d1Y19p
bnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWFzc2VydF9ycG1f
d2FrZWxvY2tfaGVsZChkZXZfcHJpdik7CisJYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKGk5MTUp
OwogCi0Jc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlkZXZfcHJpdi0+Z3Vj
LmludGVycnVwdHMuZW5hYmxlZCA9IGZhbHNlOworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9s
b2NrKTsKKwlpOTE1LT5ndWMuaW50ZXJydXB0cy5lbmFibGVkID0gZmFsc2U7CiAKLQlnZW42X2Rp
c2FibGVfcG1faXJxKGRldl9wcml2LCBkZXZfcHJpdi0+cG1fZ3VjX2V2ZW50cyk7CisJZ2VuNl9k
aXNhYmxlX3BtX2lycShpOTE1LCBpOTE1LT5wbV9ndWNfZXZlbnRzKTsKIAotCXNwaW5fdW5sb2Nr
X2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlzeW5jaHJvbml6ZV9pcnEoZGV2X3ByaXYtPmRy
bS5pcnEpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCXN5bmNocm9uaXpl
X2lycShpOTE1LT5kcm0uaXJxKTsKIAotCWdlbjlfcmVzZXRfZ3VjX2ludGVycnVwdHMoZGV2X3By
aXYpOworCWdlbjlfcmVzZXRfZ3VjX2ludGVycnVwdHMoaTkxNSk7CiB9CiAKIHZvaWQgZ2VuMTFf
cmVzZXRfZ3VjX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCkBAIC02
MzIsNTMgKzYzMiw1MyBAQCB2b2lkIGdlbjExX3Jlc2V0X2d1Y19pbnRlcnJ1cHRzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2sp
OwogfQogCi12b2lkIGdlbjExX2VuYWJsZV9ndWNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGdlbjExX2VuYWJsZV9ndWNfaW50ZXJydXB0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+
aXJxX2xvY2spOwotCWlmICghZGV2X3ByaXYtPmd1Yy5pbnRlcnJ1cHRzLmVuYWJsZWQpIHsKKwlz
cGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJaWYgKCFpOTE1LT5ndWMuaW50ZXJydXB0
cy5lbmFibGVkKSB7CiAJCXUzMiBldmVudHMgPSBSRUdfRklFTERfUFJFUChFTkdJTkUxX01BU0ss
CiAJCQkJCSAgICBHRU4xMV9HVUNfSU5UUl9HVUMySE9TVCk7CiAKLQkJV0FSTl9PTl9PTkNFKGdl
bjExX3Jlc2V0X29uZV9paXIoZGV2X3ByaXYsIDAsIEdFTjExX0dVQykpOworCQlXQVJOX09OX09O
Q0UoZ2VuMTFfcmVzZXRfb25lX2lpcihpOTE1LCAwLCBHRU4xMV9HVUMpKTsKIAkJSTkxNV9XUklU
RShHRU4xMV9HVUNfU0dfSU5UUl9FTkFCTEUsIGV2ZW50cyk7CiAJCUk5MTVfV1JJVEUoR0VOMTFf
R1VDX1NHX0lOVFJfTUFTSywgfmV2ZW50cyk7Ci0JCWRldl9wcml2LT5ndWMuaW50ZXJydXB0cy5l
bmFibGVkID0gdHJ1ZTsKKwkJaTkxNS0+Z3VjLmludGVycnVwdHMuZW5hYmxlZCA9IHRydWU7CiAJ
fQotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX3VubG9ja19p
cnEoJmk5MTUtPmlycV9sb2NrKTsKIH0KIAotdm9pZCBnZW4xMV9kaXNhYmxlX2d1Y19pbnRlcnJ1
cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgZ2VuMTFfZGlzYWJs
ZV9ndWNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzcGlu
X2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOwotCWRldl9wcml2LT5ndWMuaW50ZXJydXB0
cy5lbmFibGVkID0gZmFsc2U7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCWk5
MTUtPmd1Yy5pbnRlcnJ1cHRzLmVuYWJsZWQgPSBmYWxzZTsKIAogCUk5MTVfV1JJVEUoR0VOMTFf
R1VDX1NHX0lOVFJfTUFTSywgfjApOwogCUk5MTVfV1JJVEUoR0VOMTFfR1VDX1NHX0lOVFJfRU5B
QkxFLCAwKTsKIAotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlzeW5j
aHJvbml6ZV9pcnEoZGV2X3ByaXYtPmRybS5pcnEpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+
aXJxX2xvY2spOworCXN5bmNocm9uaXplX2lycShpOTE1LT5kcm0uaXJxKTsKIAotCWdlbjExX3Jl
c2V0X2d1Y19pbnRlcnJ1cHRzKGRldl9wcml2KTsKKwlnZW4xMV9yZXNldF9ndWNfaW50ZXJydXB0
cyhpOTE1KTsKIH0KIAogLyoqCiAgKiBiZHdfdXBkYXRlX3BvcnRfaXJxIC0gdXBkYXRlIERFIHBv
cnQgaW50ZXJydXB0Ci0gKiBAZGV2X3ByaXY6IGRyaXZlciBwcml2YXRlCisgKiBAaTkxNTogZHJp
dmVyIHByaXZhdGUKICAqIEBpbnRlcnJ1cHRfbWFzazogbWFzayBvZiBpbnRlcnJ1cHQgYml0cyB0
byB1cGRhdGUKICAqIEBlbmFibGVkX2lycV9tYXNrOiBtYXNrIG9mIGludGVycnVwdCBiaXRzIHRv
IGVuYWJsZQogICovCi1zdGF0aWMgdm9pZCBiZHdfdXBkYXRlX3BvcnRfaXJxKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGJkd191cGRhdGVfcG9ydF9pcnEo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJdTMyIGludGVycnVwdF9tYXNrLAog
CQkJCXUzMiBlbmFibGVkX2lycV9tYXNrKQogewogCXUzMiBuZXdfdmFsOwogCXUzMiBvbGRfdmFs
OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZpOTE1LT5pcnFfbG9jayk7CiAKIAlXQVJOX09OKGVuYWJsZWRfaXJxX21h
c2sgJiB+aW50ZXJydXB0X21hc2spOwogCi0JaWYgKFdBUk5fT04oIWludGVsX2lycXNfZW5hYmxl
ZChkZXZfcHJpdikpKQorCWlmIChXQVJOX09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoaTkxNSkpKQog
CQlyZXR1cm47CiAKIAlvbGRfdmFsID0gSTkxNV9SRUFEKEdFTjhfREVfUE9SVF9JTVIpOwpAQCAt
Njk1LDQzICs2OTUsNDMgQEAgc3RhdGljIHZvaWQgYmR3X3VwZGF0ZV9wb3J0X2lycShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIC8qKgogICogYmR3X3VwZGF0ZV9waXBlX2ly
cSAtIHVwZGF0ZSBERSBwaXBlIGludGVycnVwdAotICogQGRldl9wcml2OiBkcml2ZXIgcHJpdmF0
ZQorICogQGk5MTU6IGRyaXZlciBwcml2YXRlCiAgKiBAcGlwZTogcGlwZSB3aG9zZSBpbnRlcnJ1
cHQgdG8gdXBkYXRlCiAgKiBAaW50ZXJydXB0X21hc2s6IG1hc2sgb2YgaW50ZXJydXB0IGJpdHMg
dG8gdXBkYXRlCiAgKiBAZW5hYmxlZF9pcnFfbWFzazogbWFzayBvZiBpbnRlcnJ1cHQgYml0cyB0
byBlbmFibGUKICAqLwotdm9pZCBiZHdfdXBkYXRlX3BpcGVfaXJxKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgYmR3X3VwZGF0ZV9waXBlX2lycShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSBlbnVtIHBpcGUgcGlwZSwKIAkJCSB1MzIgaW50ZXJydXB0
X21hc2ssCiAJCQkgdTMyIGVuYWJsZWRfaXJxX21hc2spCiB7CiAJdTMyIG5ld192YWw7CiAKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsKIAogCVdBUk5fT04oZW5hYmxlZF9pcnFfbWFzayAmIH5p
bnRlcnJ1cHRfbWFzayk7CiAKLQlpZiAoV0FSTl9PTighaW50ZWxfaXJxc19lbmFibGVkKGRldl9w
cml2KSkpCisJaWYgKFdBUk5fT04oIWludGVsX2lycXNfZW5hYmxlZChpOTE1KSkpCiAJCXJldHVy
bjsKIAotCW5ld192YWwgPSBkZXZfcHJpdi0+ZGVfaXJxX21hc2tbcGlwZV07CisJbmV3X3ZhbCA9
IGk5MTUtPmRlX2lycV9tYXNrW3BpcGVdOwogCW5ld192YWwgJj0gfmludGVycnVwdF9tYXNrOwog
CW5ld192YWwgfD0gKH5lbmFibGVkX2lycV9tYXNrICYgaW50ZXJydXB0X21hc2spOwogCi0JaWYg
KG5ld192YWwgIT0gZGV2X3ByaXYtPmRlX2lycV9tYXNrW3BpcGVdKSB7Ci0JCWRldl9wcml2LT5k
ZV9pcnFfbWFza1twaXBlXSA9IG5ld192YWw7Ci0JCUk5MTVfV1JJVEUoR0VOOF9ERV9QSVBFX0lN
UihwaXBlKSwgZGV2X3ByaXYtPmRlX2lycV9tYXNrW3BpcGVdKTsKKwlpZiAobmV3X3ZhbCAhPSBp
OTE1LT5kZV9pcnFfbWFza1twaXBlXSkgeworCQlpOTE1LT5kZV9pcnFfbWFza1twaXBlXSA9IG5l
d192YWw7CisJCUk5MTVfV1JJVEUoR0VOOF9ERV9QSVBFX0lNUihwaXBlKSwgaTkxNS0+ZGVfaXJx
X21hc2tbcGlwZV0pOwogCQlQT1NUSU5HX1JFQUQoR0VOOF9ERV9QSVBFX0lNUihwaXBlKSk7CiAJ
fQogfQogCiAvKioKICAqIGlieF9kaXNwbGF5X2ludGVycnVwdF91cGRhdGUgLSB1cGRhdGUgU0RF
SU1SCi0gKiBAZGV2X3ByaXY6IGRyaXZlciBwcml2YXRlCisgKiBAaTkxNTogZHJpdmVyIHByaXZh
dGUKICAqIEBpbnRlcnJ1cHRfbWFzazogbWFzayBvZiBpbnRlcnJ1cHQgYml0cyB0byB1cGRhdGUK
ICAqIEBlbmFibGVkX2lycV9tYXNrOiBtYXNrIG9mIGludGVycnVwdCBiaXRzIHRvIGVuYWJsZQog
ICovCi12b2lkIGlieF9kaXNwbGF5X2ludGVycnVwdF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAordm9pZCBpYnhfZGlzcGxheV9pbnRlcnJ1cHRfdXBkYXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgdTMyIGludGVycnVwdF9tYXNrLAogCQkJ
CSAgdTMyIGVuYWJsZWRfaXJxX21hc2spCiB7CkBAIC03NDEsMjQgKzc0MSwyNCBAQCB2b2lkIGli
eF9kaXNwbGF5X2ludGVycnVwdF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCiAJV0FSTl9PTihlbmFibGVkX2lycV9tYXNrICYgfmludGVycnVwdF9tYXNrKTsKIAot
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5pcnFfbG9jayk7CisJbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmaTkxNS0+aXJxX2xvY2spOwogCi0JaWYgKFdBUk5fT04oIWludGVsX2lycXNfZW5h
YmxlZChkZXZfcHJpdikpKQorCWlmIChXQVJOX09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoaTkxNSkp
KQogCQlyZXR1cm47CiAKIAlJOTE1X1dSSVRFKFNERUlNUiwgc2RlaW1yKTsKIAlQT1NUSU5HX1JF
QUQoU0RFSU1SKTsKIH0KIAotdTMyIGk5MTVfcGlwZXN0YXRfZW5hYmxlX21hc2soc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordTMyIGk5MTVfcGlwZXN0YXRfZW5hYmxlX21hc2so
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBlbnVtIHBpcGUgcGlwZSkK
IHsKLQl1MzIgc3RhdHVzX21hc2sgPSBkZXZfcHJpdi0+cGlwZXN0YXRfaXJxX21hc2tbcGlwZV07
CisJdTMyIHN0YXR1c19tYXNrID0gaTkxNS0+cGlwZXN0YXRfaXJxX21hc2tbcGlwZV07CiAJdTMy
IGVuYWJsZV9tYXNrID0gc3RhdHVzX21hc2sgPDwgMTY7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZkZXZfcHJpdi0+aXJxX2xvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9s
b2NrKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNSkKKwlpZiAoSU5URUxfR0VOKGk5
MTUpIDwgNSkKIAkJZ290byBvdXQ7CiAKIAkvKgpAQCAtNzkxLDcgKzc5MSw3IEBAIHUzMiBpOTE1
X3BpcGVzdGF0X2VuYWJsZV9tYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAlyZXR1cm4gZW5hYmxlX21hc2s7CiB9CiAKLXZvaWQgaTkxNV9lbmFibGVfcGlwZXN0YXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpOTE1X2VuYWJsZV9waXBlc3Rh
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgZW51bSBwaXBlIHBpcGUsIHUz
MiBzdGF0dXNfbWFzaykKIHsKIAlpOTE1X3JlZ190IHJlZyA9IFBJUEVTVEFUKHBpcGUpOwpAQCAt
ODAxLDIwICs4MDEsMjAgQEAgdm9pZCBpOTE1X2VuYWJsZV9waXBlc3RhdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAgInBpcGUgJWM6IHN0YXR1c19tYXNrPTB4JXhcbiIs
CiAJCSAgcGlwZV9uYW1lKHBpcGUpLCBzdGF0dXNfbWFzayk7CiAKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZkZXZfcHJpdi0+aXJxX2xvY2spOwotCVdBUk5fT04oIWludGVsX2lycXNfZW5hYmxlZChk
ZXZfcHJpdikpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsKKwlXQVJO
X09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoaTkxNSkpOwogCi0JaWYgKChkZXZfcHJpdi0+cGlwZXN0
YXRfaXJxX21hc2tbcGlwZV0gJiBzdGF0dXNfbWFzaykgPT0gc3RhdHVzX21hc2spCisJaWYgKChp
OTE1LT5waXBlc3RhdF9pcnFfbWFza1twaXBlXSAmIHN0YXR1c19tYXNrKSA9PSBzdGF0dXNfbWFz
aykKIAkJcmV0dXJuOwogCi0JZGV2X3ByaXYtPnBpcGVzdGF0X2lycV9tYXNrW3BpcGVdIHw9IHN0
YXR1c19tYXNrOwotCWVuYWJsZV9tYXNrID0gaTkxNV9waXBlc3RhdF9lbmFibGVfbWFzayhkZXZf
cHJpdiwgcGlwZSk7CisJaTkxNS0+cGlwZXN0YXRfaXJxX21hc2tbcGlwZV0gfD0gc3RhdHVzX21h
c2s7CisJZW5hYmxlX21hc2sgPSBpOTE1X3BpcGVzdGF0X2VuYWJsZV9tYXNrKGk5MTUsIHBpcGUp
OwogCiAJSTkxNV9XUklURShyZWcsIGVuYWJsZV9tYXNrIHwgc3RhdHVzX21hc2spOwogCVBPU1RJ
TkdfUkVBRChyZWcpOwogfQogCi12b2lkIGk5MTVfZGlzYWJsZV9waXBlc3RhdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGk5MTVfZGlzYWJsZV9waXBlc3RhdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgIGVudW0gcGlwZSBwaXBlLCB1MzIgc3Rh
dHVzX21hc2spCiB7CiAJaTkxNV9yZWdfdCByZWcgPSBQSVBFU1RBVChwaXBlKTsKQEAgLTgyNCw0
NCArODI0LDQ0IEBAIHZvaWQgaTkxNV9kaXNhYmxlX3BpcGVzdGF0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkJICAicGlwZSAlYzogc3RhdHVzX21hc2s9MHgleFxuIiwKIAkJ
ICBwaXBlX25hbWUocGlwZSksIHN0YXR1c19tYXNrKTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
JmRldl9wcml2LT5pcnFfbG9jayk7Ci0JV0FSTl9PTighaW50ZWxfaXJxc19lbmFibGVkKGRldl9w
cml2KSk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+aXJxX2xvY2spOworCVdBUk5fT04o
IWludGVsX2lycXNfZW5hYmxlZChpOTE1KSk7CiAKLQlpZiAoKGRldl9wcml2LT5waXBlc3RhdF9p
cnFfbWFza1twaXBlXSAmIHN0YXR1c19tYXNrKSA9PSAwKQorCWlmICgoaTkxNS0+cGlwZXN0YXRf
aXJxX21hc2tbcGlwZV0gJiBzdGF0dXNfbWFzaykgPT0gMCkKIAkJcmV0dXJuOwogCi0JZGV2X3By
aXYtPnBpcGVzdGF0X2lycV9tYXNrW3BpcGVdICY9IH5zdGF0dXNfbWFzazsKLQllbmFibGVfbWFz
ayA9IGk5MTVfcGlwZXN0YXRfZW5hYmxlX21hc2soZGV2X3ByaXYsIHBpcGUpOworCWk5MTUtPnBp
cGVzdGF0X2lycV9tYXNrW3BpcGVdICY9IH5zdGF0dXNfbWFzazsKKwllbmFibGVfbWFzayA9IGk5
MTVfcGlwZXN0YXRfZW5hYmxlX21hc2soaTkxNSwgcGlwZSk7CiAKIAlJOTE1X1dSSVRFKHJlZywg
ZW5hYmxlX21hc2sgfCBzdGF0dXNfbWFzayk7CiAJUE9TVElOR19SRUFEKHJlZyk7CiB9CiAKLXN0
YXRpYyBib29sIGk5MTVfaGFzX2FzbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIGJvb2wgaTkxNV9oYXNfYXNsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKLQlpZiAoIWRldl9wcml2LT5vcHJlZ2lvbi5hc2xlKQorCWlmICghaTkxNS0+b3ByZWdp
b24uYXNsZSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JcmV0dXJuIElTX1BJTkVWSUVXKGRldl9wcml2
KSB8fCBJU19NT0JJTEUoZGV2X3ByaXYpOworCXJldHVybiBJU19QSU5FVklFVyhpOTE1KSB8fCBJ
U19NT0JJTEUoaTkxNSk7CiB9CiAKIC8qKgogICogaTkxNV9lbmFibGVfYXNsZV9waXBlc3RhdCAt
IGVuYWJsZSBBU0xFIHBpcGVzdGF0IGZvciBPcFJlZ2lvbgotICogQGRldl9wcml2OiBpOTE1IGRl
dmljZSBwcml2YXRlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgcHJpdmF0ZQogICovCi1zdGF0aWMg
dm9pZCBpOTE1X2VuYWJsZV9hc2xlX3BpcGVzdGF0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyB2b2lkIGk5MTVfZW5hYmxlX2FzbGVfcGlwZXN0YXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKCFpOTE1X2hhc19hc2xlKGRldl9wcml2KSkK
KwlpZiAoIWk5MTVfaGFzX2FzbGUoaTkxNSkpCiAJCXJldHVybjsKIAotCXNwaW5fbG9ja19pcnEo
JmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwog
Ci0JaTkxNV9lbmFibGVfcGlwZXN0YXQoZGV2X3ByaXYsIFBJUEVfQiwgUElQRV9MRUdBQ1lfQkxD
X0VWRU5UX1NUQVRVUyk7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKLQkJaTkxNV9l
bmFibGVfcGlwZXN0YXQoZGV2X3ByaXYsIFBJUEVfQSwKKwlpOTE1X2VuYWJsZV9waXBlc3RhdChp
OTE1LCBQSVBFX0IsIFBJUEVfTEVHQUNZX0JMQ19FVkVOVF9TVEFUVVMpOworCWlmIChJTlRFTF9H
RU4oaTkxNSkgPj0gNCkKKwkJaTkxNV9lbmFibGVfcGlwZXN0YXQoaTkxNSwgUElQRV9BLAogCQkJ
CSAgICAgUElQRV9MRUdBQ1lfQkxDX0VWRU5UX1NUQVRVUyk7CiAKLQlzcGluX3VubG9ja19pcnEo
JmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7
CiB9CiAKIC8qCkBAIC05MTksNyArOTE5LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9lbmFibGVfYXNs
ZV9waXBlc3RhdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKi8KIHN0YXRp
YyB1MzIgaTkxNV9nZXRfdmJsYW5rX2NvdW50ZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5z
aWduZWQgaW50IHBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShk
ZXYpOwogCXN0cnVjdCBkcm1fdmJsYW5rX2NydGMgKnZibGFuayA9ICZkZXYtPnZibGFua1twaXBl
XTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZ2YmxhbmstPmh3bW9k
ZTsKIAlpOTE1X3JlZ190IGhpZ2hfZnJhbWUsIGxvd19mcmFtZTsKQEAgLTk1NSw3ICs5NTUsNyBA
QCBzdGF0aWMgdTMyIGk5MTVfZ2V0X3ZibGFua19jb3VudGVyKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHVuc2lnbmVkIGludCBwaXBlKQogCWhpZ2hfZnJhbWUgPSBQSVBFRlJBTUUocGlwZSk7CiAJ
bG93X2ZyYW1lID0gUElQRUZSQU1FUElYRUwocGlwZSk7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgm
ZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5
MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiAKIAkvKgogCSAqIEhpZ2ggJiBsb3cgcmVnaXN0
ZXIgZmllbGRzIGFyZW4ndCBzeW5jaHJvbml6ZWQsIHNvIG1ha2Ugc3VyZQpAQCAtOTY4LDcgKzk2
OCw3IEBAIHN0YXRpYyB1MzIgaTkxNV9nZXRfdmJsYW5rX2NvdW50ZXIoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpCiAJCWhpZ2gyID0gSTkxNV9SRUFEX0ZXKGhpZ2hf
ZnJhbWUpICYgUElQRV9GUkFNRV9ISUdIX01BU0s7CiAJfSB3aGlsZSAoaGlnaDEgIT0gaGlnaDIp
OwogCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFm
bGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+dW5jb3JlLmxvY2ssIGlycWZs
YWdzKTsKIAogCWhpZ2gxID4+PSBQSVBFX0ZSQU1FX0hJR0hfU0hJRlQ7CiAJcGl4ZWwgPSBsb3cg
JiBQSVBFX1BJWEVMX01BU0s7CkBAIC05ODQsNyArOTg0LDcgQEAgc3RhdGljIHUzMiBpOTE1X2dl
dF92YmxhbmtfY291bnRlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlw
ZSkKIAogc3RhdGljIHUzMiBnNHhfZ2V0X3ZibGFua19jb3VudGVyKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHVuc2lnbmVkIGludCBwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGV2KTsKIAogCXJldHVybiBJOTE1X1JFQUQoUElQRV9GUk1DT1VOVF9HNFgocGlw
ZSkpOwogfQpAQCAtOTk5LDcgKzk5OSw3IEBAIHN0YXRpYyB1MzIgZzR4X2dldF92YmxhbmtfY291
bnRlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSkKICAqLwogc3Rh
dGljIHUzMiBfX2ludGVsX2dldF9jcnRjX3NjYW5saW5lX2Zyb21fdGltZXN0YW1wKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGRybV92YmxhbmtfY3J0YyAqdmJs
YW5rID0KIAkJJmNydGMtPmJhc2UuZGV2LT52YmxhbmtbZHJtX2NydGNfaW5kZXgoJmNydGMtPmJh
c2UpXTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZ2YmxhbmstPmh3
bW9kZTsKQEAgLTEwNDQsNyArMTA0NCw3IEBAIHN0YXRpYyB1MzIgX19pbnRlbF9nZXRfY3J0Y19z
Y2FubGluZV9mcm9tX3RpbWVzdGFtcChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHN0YXRpYyBp
bnQgX19pbnRlbF9nZXRfY3J0Y19zY2FubGluZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsK
IAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICptb2RlOwogCXN0cnVjdCBkcm1fdmJsYW5rX2NydGMgKnZibGFuazsKIAllbnVtIHBpcGUg
cGlwZSA9IGNydGMtPnBpcGU7CkBAIC0xMDYzLDcgKzEwNjMsNyBAQCBzdGF0aWMgaW50IF9faW50
ZWxfZ2V0X2NydGNfc2NhbmxpbmUoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJaWYgKG1vZGUt
PmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpCiAJCXZ0b3RhbCAvPSAyOwogCi0JaWYg
KElTX0dFTihkZXZfcHJpdiwgMikpCisJaWYgKElTX0dFTihpOTE1LCAyKSkKIAkJcG9zaXRpb24g
PSBJOTE1X1JFQURfRlcoUElQRURTTChwaXBlKSkgJiBEU0xfTElORU1BU0tfR0VOMjsKIAllbHNl
CiAJCXBvc2l0aW9uID0gSTkxNV9SRUFEX0ZXKFBJUEVEU0wocGlwZSkpICYgRFNMX0xJTkVNQVNL
X0dFTjM7CkBAIC0xMDgwLDcgKzEwODAsNyBAQCBzdGF0aWMgaW50IF9faW50ZWxfZ2V0X2NydGNf
c2NhbmxpbmUoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJICogcHJvYmxlbS4gIFdlIG1heSBu
ZWVkIHRvIGV4dGVuZCB0aGlzIHRvIGluY2x1ZGUgb3RoZXIgcGxhdGZvcm1zLAogCSAqIGJ1dCBz
byBmYXIgdGVzdGluZyBvbmx5IHNob3dzIHRoZSBwcm9ibGVtIG9uIEhTVy4KIAkgKi8KLQlpZiAo
SEFTX0RESShkZXZfcHJpdikgJiYgIXBvc2l0aW9uKSB7CisJaWYgKEhBU19EREkoaTkxNSkgJiYg
IXBvc2l0aW9uKSB7CiAJCWludCBpLCB0ZW1wOwogCiAJCWZvciAoaSA9IDA7IGkgPCAxMDA7IGkr
KykgewpAQCAtMTEwNSwxNCArMTEwNSwxNCBAQCBzdGF0aWMgYm9vbCBpOTE1X2dldF9jcnRjX3Nj
YW5vdXRwb3Moc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUsCiAJCQkJ
ICAgICBrdGltZV90ICpzdGltZSwga3RpbWVfdCAqZXRpbWUsCiAJCQkJICAgICBjb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMg
PSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0
YyA9IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsCiAJCQkJCQkJCXBpcGUpOwogCWludCBw
b3NpdGlvbjsKIAlpbnQgdmJsX3N0YXJ0LCB2YmxfZW5kLCBoc3luY19zdGFydCwgaHRvdGFsLCB2
dG90YWw7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsKLQlib29sIHVzZV9zY2FubGluZV9jb3Vu
dGVyID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSA1IHx8Ci0JCUlTX0c0WChkZXZfcHJpdikgfHwg
SVNfR0VOKGRldl9wcml2LCAyKSB8fAorCWJvb2wgdXNlX3NjYW5saW5lX2NvdW50ZXIgPSBJTlRF
TF9HRU4oaTkxNSkgPj0gNSB8fAorCQlJU19HNFgoaTkxNSkgfHwgSVNfR0VOKGk5MTUsIDIpIHx8
CiAJCW1vZGUtPnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19VU0VfU0NBTkxJTkVfQ09V
TlRFUjsKIAogCWlmIChXQVJOX09OKCFtb2RlLT5jcnRjX2Nsb2NrKSkgewpAQCAtMTEzOCw3ICsx
MTM4LDcgQEAgc3RhdGljIGJvb2wgaTkxNV9nZXRfY3J0Y19zY2Fub3V0cG9zKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCBwaXBlLAogCSAqIHJlZ2lzdGVyIHJlYWRzLCBwb3Rl
bnRpYWxseSB3aXRoIHByZWVtcHRpb24gZGlzYWJsZWQsIHNvIHRoZQogCSAqIGZvbGxvd2luZyBj
b2RlIG11c3Qgbm90IGJsb2NrIG9uIHVuY29yZS5sb2NrLgogCSAqLwotCXNwaW5fbG9ja19pcnFz
YXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2
ZSgmaTkxNS0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKIAogCS8qIHByZWVtcHRfZGlzYWJsZV9y
dCgpIHNob3VsZCBnbyByaWdodCBoZXJlIGluIFBSRUVNUFRfUlQgcGF0Y2hzZXQuICovCiAKQEAg
LTExOTMsNyArMTE5Myw3IEBAIHN0YXRpYyBib29sIGk5MTVfZ2V0X2NydGNfc2Nhbm91dHBvcyhz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSwKIAogCS8qIHByZWVtcHRf
ZW5hYmxlX3J0KCkgc2hvdWxkIGdvIHJpZ2h0IGhlcmUgaW4gUFJFRU1QVF9SVCBwYXRjaHNldC4g
Ki8KIAotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJx
ZmxhZ3MpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFm
bGFncyk7CiAKIAkvKgogCSAqIFdoaWxlIGluIHZibGFuaywgcG9zaXRpb24gd2lsbCBiZSBuZWdh
dGl2ZQpAQCAtMTIxOSwyMCArMTIxOSwyMCBAQCBzdGF0aWMgYm9vbCBpOTE1X2dldF9jcnRjX3Nj
YW5vdXRwb3Moc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUsCiAKIGlu
dCBpbnRlbF9nZXRfY3J0Y19zY2FubGluZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CiAJaW50IHBvc2l0aW9uOwogCi0Jc3Bpbl9s
b2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCXNwaW5fbG9j
a19pcnFzYXZlKCZpOTE1LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogCXBvc2l0aW9uID0gX19p
bnRlbF9nZXRfY3J0Y19zY2FubGluZShjcnRjKTsKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZk
ZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3Jl
KCZpOTE1LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogCiAJcmV0dXJuIHBvc2l0aW9uOwogfQog
Ci1zdGF0aWMgdm9pZCBpcm9ubGFrZV9ycHNfY2hhbmdlX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGlyb25sYWtlX3Jwc19jaGFuZ2Vf
aXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGlu
dGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAl1MzIgYnVzeV91cCwgYnVzeV9kb3duLCBt
YXhfYXZnLCBtaW5fYXZnOwogCXU4IG5ld19kZWxheTsKIApAQCAtMTI0Miw3ICsxMjQyLDcgQEAg
c3RhdGljIHZvaWQgaXJvbmxha2VfcnBzX2NoYW5nZV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCQkgICAgIE1FTUlOVFJTVFMsCiAJCQkgICAgIGludGVs
X3VuY29yZV9yZWFkKHVuY29yZSwgTUVNSU5UUlNUUykpOwogCi0JbmV3X2RlbGF5ID0gZGV2X3By
aXYtPmlwcy5jdXJfZGVsYXk7CisJbmV3X2RlbGF5ID0gaTkxNS0+aXBzLmN1cl9kZWxheTsKIAog
CWludGVsX3VuY29yZV93cml0ZTE2KHVuY29yZSwgTUVNSU5UUlNUUywgTUVNSU5UX0VWQUxfQ0hH
KTsKIAlidXN5X3VwID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBSQ1BSRVZCU1lUVVBBVkcp
OwpAQCAtMTI1MiwyNiArMTI1MiwyNiBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9ycHNfY2hhbmdl
X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCS8qIEhh
bmRsZSBSQ1MgY2hhbmdlIHJlcXVlc3QgZnJvbSBodyAqLwogCWlmIChidXN5X3VwID4gbWF4X2F2
ZykgewotCQlpZiAoZGV2X3ByaXYtPmlwcy5jdXJfZGVsYXkgIT0gZGV2X3ByaXYtPmlwcy5tYXhf
ZGVsYXkpCi0JCQluZXdfZGVsYXkgPSBkZXZfcHJpdi0+aXBzLmN1cl9kZWxheSAtIDE7Ci0JCWlm
IChuZXdfZGVsYXkgPCBkZXZfcHJpdi0+aXBzLm1heF9kZWxheSkKLQkJCW5ld19kZWxheSA9IGRl
dl9wcml2LT5pcHMubWF4X2RlbGF5OworCQlpZiAoaTkxNS0+aXBzLmN1cl9kZWxheSAhPSBpOTE1
LT5pcHMubWF4X2RlbGF5KQorCQkJbmV3X2RlbGF5ID0gaTkxNS0+aXBzLmN1cl9kZWxheSAtIDE7
CisJCWlmIChuZXdfZGVsYXkgPCBpOTE1LT5pcHMubWF4X2RlbGF5KQorCQkJbmV3X2RlbGF5ID0g
aTkxNS0+aXBzLm1heF9kZWxheTsKIAl9IGVsc2UgaWYgKGJ1c3lfZG93biA8IG1pbl9hdmcpIHsK
LQkJaWYgKGRldl9wcml2LT5pcHMuY3VyX2RlbGF5ICE9IGRldl9wcml2LT5pcHMubWluX2RlbGF5
KQotCQkJbmV3X2RlbGF5ID0gZGV2X3ByaXYtPmlwcy5jdXJfZGVsYXkgKyAxOwotCQlpZiAobmV3
X2RlbGF5ID4gZGV2X3ByaXYtPmlwcy5taW5fZGVsYXkpCi0JCQluZXdfZGVsYXkgPSBkZXZfcHJp
di0+aXBzLm1pbl9kZWxheTsKKwkJaWYgKGk5MTUtPmlwcy5jdXJfZGVsYXkgIT0gaTkxNS0+aXBz
Lm1pbl9kZWxheSkKKwkJCW5ld19kZWxheSA9IGk5MTUtPmlwcy5jdXJfZGVsYXkgKyAxOworCQlp
ZiAobmV3X2RlbGF5ID4gaTkxNS0+aXBzLm1pbl9kZWxheSkKKwkJCW5ld19kZWxheSA9IGk5MTUt
Pmlwcy5taW5fZGVsYXk7CiAJfQogCi0JaWYgKGlyb25sYWtlX3NldF9kcnBzKGRldl9wcml2LCBu
ZXdfZGVsYXkpKQotCQlkZXZfcHJpdi0+aXBzLmN1cl9kZWxheSA9IG5ld19kZWxheTsKKwlpZiAo
aXJvbmxha2Vfc2V0X2RycHMoaTkxNSwgbmV3X2RlbGF5KSkKKwkJaTkxNS0+aXBzLmN1cl9kZWxh
eSA9IG5ld19kZWxheTsKIAogCXNwaW5fdW5sb2NrKCZtY2hkZXZfbG9jayk7CiAKIAlyZXR1cm47
CiB9CiAKLXN0YXRpYyB2b2lkIHZsdl9jMF9yZWFkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHZsdl9jMF9yZWFkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJc3RydWN0IGludGVsX3Jwc19laSAqZWkpCiB7CiAJZWktPmt0aW1lID0ga3Rp
bWVfZ2V0X3JhdygpOwpAQCAtMTI3OSwxNCArMTI3OSwxNCBAQCBzdGF0aWMgdm9pZCB2bHZfYzBf
cmVhZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJZWktPm1lZGlhX2MwID0g
STkxNV9SRUFEKFZMVl9NRURJQV9DMF9DT1VOVCk7CiB9CiAKLXZvaWQgZ2VuNl9ycHNfcmVzZXRf
ZWkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBnZW42X3Jwc19yZXNl
dF9laShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQltZW1zZXQoJmRldl9wcml2
LT5ndF9wbS5ycHMuZWksIDAsIHNpemVvZihkZXZfcHJpdi0+Z3RfcG0ucnBzLmVpKSk7CisJbWVt
c2V0KCZpOTE1LT5ndF9wbS5ycHMuZWksIDAsIHNpemVvZihpOTE1LT5ndF9wbS5ycHMuZWkpKTsK
IH0KIAotc3RhdGljIHUzMiB2bHZfd2FfYzBfZWkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCB1MzIgcG1faWlyKQorc3RhdGljIHUzMiB2bHZfd2FfYzBfZWkoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBwbV9paXIpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBz
ID0gJmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUt
Pmd0X3BtLnJwczsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcnBzX2VpICpwcmV2ID0gJnJwcy0+ZWk7
CiAJc3RydWN0IGludGVsX3Jwc19laSBub3c7CiAJdTMyIGV2ZW50cyA9IDA7CkBAIC0xMjk0LDcg
KzEyOTQsNyBAQCBzdGF0aWMgdTMyIHZsdl93YV9jMF9laShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIHUzMiBwbV9paXIpCiAJaWYgKChwbV9paXIgJiBHRU42X1BNX1JQX1VQX0VJ
X0VYUElSRUQpID09IDApCiAJCXJldHVybiAwOwogCi0Jdmx2X2MwX3JlYWQoZGV2X3ByaXYsICZu
b3cpOworCXZsdl9jMF9yZWFkKGk5MTUsICZub3cpOwogCiAJaWYgKHByZXYtPmt0aW1lKSB7CiAJ
CXU2NCB0aW1lLCBjMDsKQEAgLTEzMDIsNyArMTMwMiw3IEBAIHN0YXRpYyB1MzIgdmx2X3dhX2Mw
X2VpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBtX2lpcikKIAogCQl0
aW1lID0ga3RpbWVfdXNfZGVsdGEobm93Lmt0aW1lLCBwcmV2LT5rdGltZSk7CiAKLQkJdGltZSAq
PSBkZXZfcHJpdi0+Y3pjbGtfZnJlcTsKKwkJdGltZSAqPSBpOTE1LT5jemNsa19mcmVxOwogCiAJ
CS8qIFdvcmtsb2FkIGNhbiBiZSBzcGxpdCBiZXR3ZWVuIHJlbmRlciArIG1lZGlhLAogCQkgKiBl
LmcuIFN3YXBCdWZmZXJzIGJlaW5nIGJsaXR0ZWQgaW4gWCBhZnRlciBiZWluZyByZW5kZXJlZCBp
bgpAQCAtMTMyNiwyOCArMTMyNiwyOCBAQCBzdGF0aWMgdTMyIHZsdl93YV9jMF9laShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwbV9paXIpCiAKIHN0YXRpYyB2b2lkIGdl
bjZfcG1fcnBzX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PQogCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUsIGd0X3BtLnJw
cy53b3JrKTsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsK
KwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCWJvb2wgY2xpZW50
X2Jvb3N0ID0gZmFsc2U7CiAJaW50IG5ld19kZWxheSwgYWRqLCBtaW4sIG1heDsKIAl1MzIgcG1f
aWlyID0gMDsKIAotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl9s
b2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCWlmIChycHMtPmludGVycnVwdHNfZW5hYmxlZCkg
ewogCQlwbV9paXIgPSBmZXRjaF9hbmRfemVybygmcnBzLT5wbV9paXIpOwogCQljbGllbnRfYm9v
c3QgPSBhdG9taWNfcmVhZCgmcnBzLT5udW1fd2FpdGVycyk7CiAJfQotCXNwaW5fdW5sb2NrX2ly
cSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2Nr
KTsKIAogCS8qIE1ha2Ugc3VyZSB3ZSBkaWRuJ3QgcXVldWUgYW55dGhpbmcgd2UncmUgbm90IGdv
aW5nIHRvIHByb2Nlc3MuICovCi0JV0FSTl9PTihwbV9paXIgJiB+ZGV2X3ByaXYtPnBtX3Jwc19l
dmVudHMpOwotCWlmICgocG1faWlyICYgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpID09IDAgJiYg
IWNsaWVudF9ib29zdCkKKwlXQVJOX09OKHBtX2lpciAmIH5pOTE1LT5wbV9ycHNfZXZlbnRzKTsK
KwlpZiAoKHBtX2lpciAmIGk5MTUtPnBtX3Jwc19ldmVudHMpID09IDAgJiYgIWNsaWVudF9ib29z
dCkKIAkJZ290byBvdXQ7CiAKIAltdXRleF9sb2NrKCZycHMtPmxvY2spOwogCi0JcG1faWlyIHw9
IHZsdl93YV9jMF9laShkZXZfcHJpdiwgcG1faWlyKTsKKwlwbV9paXIgfD0gdmx2X3dhX2MwX2Vp
KGk5MTUsIHBtX2lpcik7CiAKIAlhZGogPSBycHMtPmxhc3RfYWRqOwogCW5ld19kZWxheSA9IHJw
cy0+Y3VyX2ZyZXE7CkBAIC0xMzYyLDcgKzEzNjIsNyBAQCBzdGF0aWMgdm9pZCBnZW42X3BtX3Jw
c193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkJaWYgKGFkaiA+IDApCiAJCQlhZGog
Kj0gMjsKIAkJZWxzZSAvKiBDSFYgbmVlZHMgZXZlbiBlbmNvZGUgdmFsdWVzICovCi0JCQlhZGog
PSBJU19DSEVSUllWSUVXKGRldl9wcml2KSA/IDIgOiAxOworCQkJYWRqID0gSVNfQ0hFUlJZVklF
VyhpOTE1KSA/IDIgOiAxOwogCiAJCWlmIChuZXdfZGVsYXkgPj0gcnBzLT5tYXhfZnJlcV9zb2Z0
bGltaXQpCiAJCQlhZGogPSAwOwpAQCAtMTM3OCw3ICsxMzc4LDcgQEAgc3RhdGljIHZvaWQgZ2Vu
Nl9wbV9ycHNfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJCWlmIChhZGogPCAwKQog
CQkJYWRqICo9IDI7CiAJCWVsc2UgLyogQ0hWIG5lZWRzIGV2ZW4gZW5jb2RlIHZhbHVlcyAqLwot
CQkJYWRqID0gSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgPyAtMiA6IC0xOworCQkJYWRqID0gSVNf
Q0hFUlJZVklFVyhpOTE1KSA/IC0yIDogLTE7CiAKIAkJaWYgKG5ld19kZWxheSA8PSBycHMtPm1p
bl9mcmVxX3NvZnRsaW1pdCkKIAkJCWFkaiA9IDA7CkBAIC0xNDA2LDcgKzE0MDYsNyBAQCBzdGF0
aWMgdm9pZCBnZW42X3BtX3Jwc193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAluZXdf
ZGVsYXkgKz0gYWRqOwogCW5ld19kZWxheSA9IGNsYW1wX3QoaW50LCBuZXdfZGVsYXksIG1pbiwg
bWF4KTsKIAotCWlmIChpbnRlbF9zZXRfcnBzKGRldl9wcml2LCBuZXdfZGVsYXkpKSB7CisJaWYg
KGludGVsX3NldF9ycHMoaTkxNSwgbmV3X2RlbGF5KSkgewogCQlEUk1fREVCVUdfRFJJVkVSKCJG
YWlsZWQgdG8gc2V0IG5ldyBHUFUgZnJlcXVlbmN5XG4iKTsKIAkJcnBzLT5sYXN0X2FkaiA9IDA7
CiAJfQpAQCAtMTQxNSwxMCArMTQxNSwxMCBAQCBzdGF0aWMgdm9pZCBnZW42X3BtX3Jwc193b3Jr
KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogb3V0OgogCS8qIE1ha2Ugc3VyZSBub3QgdG8g
Y29ycnVwdCBQTUlNUiBzdGF0ZSB1c2VkIGJ5IHJpbmdidWZmZXIgb24gR0VONiAqLwotCXNwaW5f
bG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJx
X2xvY2spOwogCWlmIChycHMtPmludGVycnVwdHNfZW5hYmxlZCkKLQkJZ2VuNl91bm1hc2tfcG1f
aXJxKGRldl9wcml2LCBkZXZfcHJpdi0+cG1fcnBzX2V2ZW50cyk7Ci0Jc3Bpbl91bmxvY2tfaXJx
KCZkZXZfcHJpdi0+aXJxX2xvY2spOworCQlnZW42X3VubWFza19wbV9pcnEoaTkxNSwgaTkxNS0+
cG1fcnBzX2V2ZW50cyk7CisJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CiB9CiAK
IApAQCAtMTQzMyw4ICsxNDMzLDggQEAgc3RhdGljIHZvaWQgZ2VuNl9wbV9ycHNfd29yayhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAgKi8KIHN0YXRpYyB2b2lkIGl2eWJyaWRnZV9wYXJpdHlf
d29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZGV2X3ByaXYpLCBs
M19wYXJpdHkuZXJyb3Jfd29yayk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQor
CQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwgbDNfcGFyaXR5LmVycm9yX3dvcmsp
OwogCXUzMiBlcnJvcl9zdGF0dXMsIHJvdywgYmFuaywgc3ViYmFuazsKIAljaGFyICpwYXJpdHlf
ZXZlbnRbNl07CiAJdTMyIG1pc2NjcGN0bDsKQEAgLTE0NDQsMjQgKzE0NDQsMjQgQEAgc3RhdGlj
IHZvaWQgaXZ5YnJpZGdlX3Bhcml0eV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkg
KiBJbiBvcmRlciB0byBwcmV2ZW50IGEgZ2V0L3B1dCBzdHlsZSBpbnRlcmZhY2UsIGFjcXVpcmUg
c3RydWN0IG11dGV4CiAJICogYW55IHRpbWUgd2UgYWNjZXNzIHRob3NlIHJlZ2lzdGVycy4KIAkg
Ki8KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkvKiBJZiB3ZSd2ZSBzY3Jld2VkIHVwIHRy
YWNraW5nLCBqdXN0IGxldCB0aGUgaW50ZXJydXB0IGZpcmUgYWdhaW4gKi8KLQlpZiAoV0FSTl9P
TighZGV2X3ByaXYtPmwzX3Bhcml0eS53aGljaF9zbGljZSkpCisJaWYgKFdBUk5fT04oIWk5MTUt
PmwzX3Bhcml0eS53aGljaF9zbGljZSkpCiAJCWdvdG8gb3V0OwogCiAJbWlzY2NwY3RsID0gSTkx
NV9SRUFEKEdFTjdfTUlTQ0NQQ1RMKTsKIAlJOTE1X1dSSVRFKEdFTjdfTUlTQ0NQQ1RMLCBtaXNj
Y3BjdGwgJiB+R0VON19ET1BfQ0xPQ0tfR0FURV9FTkFCTEUpOwogCVBPU1RJTkdfUkVBRChHRU43
X01JU0NDUENUTCk7CiAKLQl3aGlsZSAoKHNsaWNlID0gZmZzKGRldl9wcml2LT5sM19wYXJpdHku
d2hpY2hfc2xpY2UpKSAhPSAwKSB7CisJd2hpbGUgKChzbGljZSA9IGZmcyhpOTE1LT5sM19wYXJp
dHkud2hpY2hfc2xpY2UpKSAhPSAwKSB7CiAJCWk5MTVfcmVnX3QgcmVnOwogCiAJCXNsaWNlLS07
Ci0JCWlmIChXQVJOX09OX09OQ0Uoc2xpY2UgPj0gTlVNX0wzX1NMSUNFUyhkZXZfcHJpdikpKQor
CQlpZiAoV0FSTl9PTl9PTkNFKHNsaWNlID49IE5VTV9MM19TTElDRVMoaTkxNSkpKQogCQkJYnJl
YWs7CiAKLQkJZGV2X3ByaXYtPmwzX3Bhcml0eS53aGljaF9zbGljZSAmPSB+KDE8PHNsaWNlKTsK
KwkJaTkxNS0+bDNfcGFyaXR5LndoaWNoX3NsaWNlICY9IH4oMTw8c2xpY2UpOwogCiAJCXJlZyA9
IEdFTjdfTDNDREVSUlNUMShzbGljZSk7CiAKQEAgLTE0ODAsNyArMTQ4MCw3IEBAIHN0YXRpYyB2
b2lkIGl2eWJyaWRnZV9wYXJpdHlfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJCXBh
cml0eV9ldmVudFs0XSA9IGthc3ByaW50ZihHRlBfS0VSTkVMLCAiU0xJQ0U9JWQiLCBzbGljZSk7
CiAJCXBhcml0eV9ldmVudFs1XSA9IE5VTEw7CiAKLQkJa29iamVjdF91ZXZlbnRfZW52KCZkZXZf
cHJpdi0+ZHJtLnByaW1hcnktPmtkZXYtPmtvYmosCisJCWtvYmplY3RfdWV2ZW50X2VudigmaTkx
NS0+ZHJtLnByaW1hcnktPmtkZXYtPmtvYmosCiAJCQkJICAgS09CSl9DSEFOR0UsIHBhcml0eV9l
dmVudCk7CiAKIAkJRFJNX0RFQlVHKCJQYXJpdHkgZXJyb3I6IFNsaWNlID0gJWQsIFJvdyA9ICVk
LCBCYW5rID0gJWQsIFN1YiBiYW5rID0gJWQuXG4iLApAQCAtMTQ5NSw2MCArMTQ5NSw2MCBAQCBz
dGF0aWMgdm9pZCBpdnlicmlkZ2VfcGFyaXR5X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQogCUk5MTVfV1JJVEUoR0VON19NSVNDQ1BDVEwsIG1pc2NjcGN0bCk7CiAKIG91dDoKLQlXQVJO
X09OKGRldl9wcml2LT5sM19wYXJpdHkud2hpY2hfc2xpY2UpOwotCXNwaW5fbG9ja19pcnEoJmRl
dl9wcml2LT5pcnFfbG9jayk7Ci0JZ2VuNV9lbmFibGVfZ3RfaXJxKGRldl9wcml2LCBHVF9QQVJJ
VFlfRVJST1IoZGV2X3ByaXYpKTsKLQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9j
ayk7CisJV0FSTl9PTihpOTE1LT5sM19wYXJpdHkud2hpY2hfc2xpY2UpOworCXNwaW5fbG9ja19p
cnEoJmk5MTUtPmlycV9sb2NrKTsKKwlnZW41X2VuYWJsZV9ndF9pcnEoaTkxNSwgR1RfUEFSSVRZ
X0VSUk9SKGk5MTUpKTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAotCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAKLXN0YXRpYyB2b2lkIGl2eWJyaWRnZV9wYXJp
dHlfZXJyb3JfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgaXZ5YnJpZGdlX3Bhcml0eV9lcnJvcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgICAgIHUzMiBpaXIpCiB7Ci0JaWYgKCFIQVNf
TDNfRFBGKGRldl9wcml2KSkKKwlpZiAoIUhBU19MM19EUEYoaTkxNSkpCiAJCXJldHVybjsKIAot
CXNwaW5fbG9jaygmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlnZW41X2Rpc2FibGVfZ3RfaXJxKGRl
dl9wcml2LCBHVF9QQVJJVFlfRVJST1IoZGV2X3ByaXYpKTsKLQlzcGluX3VubG9jaygmZGV2X3By
aXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2soJmk5MTUtPmlycV9sb2NrKTsKKwlnZW41X2Rpc2Fi
bGVfZ3RfaXJxKGk5MTUsIEdUX1BBUklUWV9FUlJPUihpOTE1KSk7CisJc3Bpbl91bmxvY2soJmk5
MTUtPmlycV9sb2NrKTsKIAotCWlpciAmPSBHVF9QQVJJVFlfRVJST1IoZGV2X3ByaXYpOworCWlp
ciAmPSBHVF9QQVJJVFlfRVJST1IoaTkxNSk7CiAJaWYgKGlpciAmIEdUX1JFTkRFUl9MM19QQVJJ
VFlfRVJST1JfSU5URVJSVVBUX1MxKQotCQlkZXZfcHJpdi0+bDNfcGFyaXR5LndoaWNoX3NsaWNl
IHw9IDEgPDwgMTsKKwkJaTkxNS0+bDNfcGFyaXR5LndoaWNoX3NsaWNlIHw9IDEgPDwgMTsKIAog
CWlmIChpaXIgJiBHVF9SRU5ERVJfTDNfUEFSSVRZX0VSUk9SX0lOVEVSUlVQVCkKLQkJZGV2X3By
aXYtPmwzX3Bhcml0eS53aGljaF9zbGljZSB8PSAxIDw8IDA7CisJCWk5MTUtPmwzX3Bhcml0eS53
aGljaF9zbGljZSB8PSAxIDw8IDA7CiAKLQlxdWV1ZV93b3JrKGRldl9wcml2LT53cSwgJmRldl9w
cml2LT5sM19wYXJpdHkuZXJyb3Jfd29yayk7CisJcXVldWVfd29yayhpOTE1LT53cSwgJmk5MTUt
PmwzX3Bhcml0eS5lcnJvcl93b3JrKTsKIH0KIAotc3RhdGljIHZvaWQgaWxrX2d0X2lycV9oYW5k
bGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGlsa19n
dF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgICB1
MzIgZ3RfaWlyKQogewogCWlmIChndF9paXIgJiBHVF9SRU5ERVJfVVNFUl9JTlRFUlJVUFQpCi0J
CWludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEoZGV2X3ByaXYtPmVuZ2luZVtSQ1MwXSk7CisJ
CWludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEoaTkxNS0+ZW5naW5lW1JDUzBdKTsKIAlpZiAo
Z3RfaWlyICYgSUxLX0JTRF9VU0VSX0lOVEVSUlVQVCkKLQkJaW50ZWxfZW5naW5lX2JyZWFkY3J1
bWJzX2lycShkZXZfcHJpdi0+ZW5naW5lW1ZDUzBdKTsKKwkJaW50ZWxfZW5naW5lX2JyZWFkY3J1
bWJzX2lycShpOTE1LT5lbmdpbmVbVkNTMF0pOwogfQogCi1zdGF0aWMgdm9pZCBzbmJfZ3RfaXJx
X2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQg
c25iX2d0X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAg
ICAgIHUzMiBndF9paXIpCiB7CiAJaWYgKGd0X2lpciAmIEdUX1JFTkRFUl9VU0VSX0lOVEVSUlVQ
VCkKLQkJaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShkZXZfcHJpdi0+ZW5naW5lW1JDUzBd
KTsKKwkJaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShpOTE1LT5lbmdpbmVbUkNTMF0pOwog
CWlmIChndF9paXIgJiBHVF9CU0RfVVNFUl9JTlRFUlJVUFQpCi0JCWludGVsX2VuZ2luZV9icmVh
ZGNydW1ic19pcnEoZGV2X3ByaXYtPmVuZ2luZVtWQ1MwXSk7CisJCWludGVsX2VuZ2luZV9icmVh
ZGNydW1ic19pcnEoaTkxNS0+ZW5naW5lW1ZDUzBdKTsKIAlpZiAoZ3RfaWlyICYgR1RfQkxUX1VT
RVJfSU5URVJSVVBUKQotCQlpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxKGRldl9wcml2LT5l
bmdpbmVbQkNTMF0pOworCQlpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxKGk5MTUtPmVuZ2lu
ZVtCQ1MwXSk7CiAKIAlpZiAoZ3RfaWlyICYgKEdUX0JMVF9DU19FUlJPUl9JTlRFUlJVUFQgfAog
CQkgICAgICBHVF9CU0RfQ1NfRVJST1JfSU5URVJSVVBUIHwKIAkJICAgICAgR1RfUkVOREVSX0NT
X01BU1RFUl9FUlJPUl9JTlRFUlJVUFQpKQogCQlEUk1fREVCVUcoIkNvbW1hbmQgcGFyc2VyIGVy
cm9yLCBndF9paXIgMHglMDh4XG4iLCBndF9paXIpOwogCi0JaWYgKGd0X2lpciAmIEdUX1BBUklU
WV9FUlJPUihkZXZfcHJpdikpCi0JCWl2eWJyaWRnZV9wYXJpdHlfZXJyb3JfaXJxX2hhbmRsZXIo
ZGV2X3ByaXYsIGd0X2lpcik7CisJaWYgKGd0X2lpciAmIEdUX1BBUklUWV9FUlJPUihpOTE1KSkK
KwkJaXZ5YnJpZGdlX3Bhcml0eV9lcnJvcl9pcnFfaGFuZGxlcihpOTE1LCBndF9paXIpOwogfQog
CiBzdGF0aWMgdm9pZApAQCAtMTc2Myw3ICsxNzYzLDcgQEAgc3RhdGljIGJvb2wgaTl4eF9wb3J0
X2hvdHBsdWdfbG9uZ19kZXRlY3QoZW51bSBocGRfcGluIHBpbiwgdTMyIHZhbCkKICAqCiAgKiBO
b3RlIHRoYXQgdGhlIGNhbGxlciBpcyBleHBlY3RlZCB0byB6ZXJvIG91dCB0aGUgbWFza3MgaW5p
dGlhbGx5LgogICovCi1zdGF0aWMgdm9pZCBpbnRlbF9nZXRfaHBkX3BpbnMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50ZWxfZ2V0X2hwZF9waW5zKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgIHUzMiAqcGluX21hc2ssIHUz
MiAqbG9uZ19tYXNrLAogCQkJICAgICAgIHUzMiBob3RwbHVnX3RyaWdnZXIsIHUzMiBkaWdfaG90
cGx1Z19yZWcsCiAJCQkgICAgICAgY29uc3QgdTMyIGhwZFtIUERfTlVNX1BJTlNdLApAQCAtMTc4
NiwyNSArMTc4NiwyNSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9nZXRfaHBkX3BpbnMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiB9CiAKLXN0YXRpYyB2b2lkIGdtYnVzX2lycV9o
YW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdt
YnVzX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXdha2Vf
dXBfYWxsKCZkZXZfcHJpdi0+Z21idXNfd2FpdF9xdWV1ZSk7CisJd2FrZV91cF9hbGwoJmk5MTUt
PmdtYnVzX3dhaXRfcXVldWUpOwogfQogCi1zdGF0aWMgdm9pZCBkcF9hdXhfaXJxX2hhbmRsZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZHBfYXV4X2ly
cV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXdha2VfdXBfYWxs
KCZkZXZfcHJpdi0+Z21idXNfd2FpdF9xdWV1ZSk7CisJd2FrZV91cF9hbGwoJmk5MTUtPmdtYnVz
X3dhaXRfcXVldWUpOwogfQogCiAjaWYgZGVmaW5lZChDT05GSUdfREVCVUdfRlMpCi1zdGF0aWMg
dm9pZCBkaXNwbGF5X3BpcGVfY3JjX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGRpc3BsYXlfcGlwZV9jcmNfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSBlbnVtIHBpcGUgcGlwZSwKIAkJCQkJ
IHUzMiBjcmMwLCB1MzIgY3JjMSwKIAkJCQkJIHUzMiBjcmMyLCB1MzIgY3JjMywKIAkJCQkJIHUz
MiBjcmM0KQogewotCXN0cnVjdCBpbnRlbF9waXBlX2NyYyAqcGlwZV9jcmMgPSAmZGV2X3ByaXYt
PnBpcGVfY3JjW3BpcGVdOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gaW50ZWxfZ2V0X2Ny
dGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOworCXN0cnVjdCBpbnRlbF9waXBlX2NyYyAqcGlw
ZV9jcmMgPSAmaTkxNS0+cGlwZV9jcmNbcGlwZV07CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShpOTE1LCBwaXBlKTsKIAl1MzIgY3Jjc1s1XSA9IHsg
Y3JjMCwgY3JjMSwgY3JjMiwgY3JjMywgY3JjNCB9OwogCiAJdHJhY2VfaW50ZWxfcGlwZV9jcmMo
Y3J0YywgY3Jjcyk7CkBAIC0xODE5LDcgKzE4MTksNyBAQCBzdGF0aWMgdm9pZCBkaXNwbGF5X3Bp
cGVfY3JjX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkg
KiBkb24ndCB0cnVzdCB0aGF0IG9uZSBlaXRoZXIuCiAJICovCiAJaWYgKHBpcGVfY3JjLT5za2lw
cGVkIDw9IDAgfHwKLQkgICAgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCAmJiBwaXBlX2NyYy0+
c2tpcHBlZCA9PSAxKSkgeworCSAgICAoSU5URUxfR0VOKGk5MTUpID49IDggJiYgcGlwZV9jcmMt
PnNraXBwZWQgPT0gMSkpIHsKIAkJcGlwZV9jcmMtPnNraXBwZWQrKzsKIAkJc3Bpbl91bmxvY2so
JnBpcGVfY3JjLT5sb2NrKTsKIAkJcmV0dXJuOwpAQCAtMTgzMiw3ICsxODMyLDcgQEAgc3RhdGlj
IHZvaWQgZGlzcGxheV9waXBlX2NyY19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiB9CiAjZWxzZQogc3RhdGljIGlubGluZSB2b2lkCi1kaXNwbGF5X3BpcGVf
Y3JjX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2Rpc3Bs
YXlfcGlwZV9jcmNfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkgICAgIGVudW0gcGlwZSBwaXBlLAogCQkJICAgICB1MzIgY3JjMCwgdTMyIGNyYzEsCiAJCQkg
ICAgIHUzMiBjcmMyLCB1MzIgY3JjMywKQEAgLTE4NDAsMTggKzE4NDAsMTggQEAgZGlzcGxheV9w
aXBlX2NyY19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAj
ZW5kaWYKIAogCi1zdGF0aWMgdm9pZCBoc3dfcGlwZV9jcmNfaXJxX2hhbmRsZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaHN3X3BpcGVfY3JjX2lycV9o
YW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgZW51bSBwaXBl
IHBpcGUpCiB7Ci0JZGlzcGxheV9waXBlX2NyY19pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSwK
KwlkaXNwbGF5X3BpcGVfY3JjX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUsCiAJCQkJICAgICBJOTE1
X1JFQUQoUElQRV9DUkNfUkVTXzFfSVZCKHBpcGUpKSwKIAkJCQkgICAgIDAsIDAsIDAsIDApOwog
fQogCi1zdGF0aWMgdm9pZCBpdmJfcGlwZV9jcmNfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaXZiX3BpcGVfY3JjX2lycV9oYW5kbGVy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgZW51bSBwaXBlIHBpcGUp
CiB7Ci0JZGlzcGxheV9waXBlX2NyY19pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSwKKwlkaXNw
bGF5X3BpcGVfY3JjX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUsCiAJCQkJICAgICBJOTE1X1JFQUQo
UElQRV9DUkNfUkVTXzFfSVZCKHBpcGUpKSwKIAkJCQkgICAgIEk5MTVfUkVBRChQSVBFX0NSQ19S
RVNfMl9JVkIocGlwZSkpLAogCQkJCSAgICAgSTkxNV9SRUFEKFBJUEVfQ1JDX1JFU18zX0lWQihw
aXBlKSksCkBAIC0xODU5LDIyICsxODU5LDIyIEBAIHN0YXRpYyB2b2lkIGl2Yl9waXBlX2NyY19p
cnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICAgICBJ
OTE1X1JFQUQoUElQRV9DUkNfUkVTXzVfSVZCKHBpcGUpKSk7CiB9CiAKLXN0YXRpYyB2b2lkIGk5
eHhfcGlwZV9jcmNfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIHZvaWQgaTl4eF9waXBlX2NyY19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICBlbnVtIHBpcGUgcGlwZSkKIHsKIAl1MzIgcmVzMSwg
cmVzMjsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDMpCisJaWYgKElOVEVMX0dFTihp
OTE1KSA+PSAzKQogCQlyZXMxID0gSTkxNV9SRUFEKFBJUEVfQ1JDX1JFU19SRVMxX0k5MTUocGlw
ZSkpOwogCWVsc2UKIAkJcmVzMSA9IDA7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA1
IHx8IElTX0c0WChkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA1IHx8IElTX0c0
WChpOTE1KSkKIAkJcmVzMiA9IEk5MTVfUkVBRChQSVBFX0NSQ19SRVNfUkVTMl9HNFgocGlwZSkp
OwogCWVsc2UKIAkJcmVzMiA9IDA7CiAKLQlkaXNwbGF5X3BpcGVfY3JjX2lycV9oYW5kbGVyKGRl
dl9wcml2LCBwaXBlLAorCWRpc3BsYXlfcGlwZV9jcmNfaXJxX2hhbmRsZXIoaTkxNSwgcGlwZSwK
IAkJCQkgICAgIEk5MTVfUkVBRChQSVBFX0NSQ19SRVNfUkVEKHBpcGUpKSwKIAkJCQkgICAgIEk5
MTVfUkVBRChQSVBFX0NSQ19SRVNfR1JFRU4ocGlwZSkpLAogCQkJCSAgICAgSTkxNV9SRUFEKFBJ
UEVfQ1JDX1JFU19CTFVFKHBpcGUpKSwKQEAgLTE5MDMsMzQgKzE5MDMsMzQgQEAgc3RhdGljIHZv
aWQgZ2VuMTFfcnBzX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1
MzIgcG1faWlyKQogCXNjaGVkdWxlX3dvcmsoJnJwcy0+d29yayk7CiB9CiAKLXN0YXRpYyB2b2lk
IGdlbjZfcnBzX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dTMyIHBtX2lpcikKK3N0YXRpYyB2b2lkIGdlbjZfcnBzX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LCB1MzIgcG1faWlyKQogewotCXN0cnVjdCBpbnRlbF9ycHMgKnJw
cyA9ICZkZXZfcHJpdi0+Z3RfcG0ucnBzOworCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZpOTE1
LT5ndF9wbS5ycHM7CiAKLQlpZiAocG1faWlyICYgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpIHsK
LQkJc3Bpbl9sb2NrKCZkZXZfcHJpdi0+aXJxX2xvY2spOwotCQlnZW42X21hc2tfcG1faXJxKGRl
dl9wcml2LCBwbV9paXIgJiBkZXZfcHJpdi0+cG1fcnBzX2V2ZW50cyk7CisJaWYgKHBtX2lpciAm
IGk5MTUtPnBtX3Jwc19ldmVudHMpIHsKKwkJc3Bpbl9sb2NrKCZpOTE1LT5pcnFfbG9jayk7CisJ
CWdlbjZfbWFza19wbV9pcnEoaTkxNSwgcG1faWlyICYgaTkxNS0+cG1fcnBzX2V2ZW50cyk7CiAJ
CWlmIChycHMtPmludGVycnVwdHNfZW5hYmxlZCkgewotCQkJcnBzLT5wbV9paXIgfD0gcG1faWly
ICYgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHM7CisJCQlycHMtPnBtX2lpciB8PSBwbV9paXIgJiBp
OTE1LT5wbV9ycHNfZXZlbnRzOwogCQkJc2NoZWR1bGVfd29yaygmcnBzLT53b3JrKTsKIAkJfQot
CQlzcGluX3VubG9jaygmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwkJc3Bpbl91bmxvY2soJmk5MTUt
PmlycV9sb2NrKTsKIAl9CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KQorCWlmIChJ
TlRFTF9HRU4oaTkxNSkgPj0gOCkKIAkJcmV0dXJuOwogCiAJaWYgKHBtX2lpciAmIFBNX1ZFQk9Y
X1VTRVJfSU5URVJSVVBUKQotCQlpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxKGRldl9wcml2
LT5lbmdpbmVbVkVDUzBdKTsKKwkJaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShpOTE1LT5l
bmdpbmVbVkVDUzBdKTsKIAogCWlmIChwbV9paXIgJiBQTV9WRUJPWF9DU19FUlJPUl9JTlRFUlJV
UFQpCiAJCURSTV9ERUJVRygiQ29tbWFuZCBwYXJzZXIgZXJyb3IsIHBtX2lpciAweCUwOHhcbiIs
IHBtX2lpcik7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjlfZ3VjX2lycV9oYW5kbGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGd0X2lpcikKK3N0YXRpYyB2b2lkIGdlbjlf
Z3VjX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgZ3RfaWly
KQogewogCWlmIChndF9paXIgJiBHRU45X0dVQ19UT19IT1NUX0lOVF9FVkVOVCkKLQkJaW50ZWxf
Z3VjX3RvX2hvc3RfZXZlbnRfaGFuZGxlcigmZGV2X3ByaXYtPmd1Yyk7CisJCWludGVsX2d1Y190
b19ob3N0X2V2ZW50X2hhbmRsZXIoJmk5MTUtPmd1Yyk7CiB9CiAKIHN0YXRpYyB2b2lkIGdlbjEx
X2d1Y19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTE2IGlpcikK
QEAgLTE5MzksMzIgKzE5MzksMzIgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZ3VjX2lycV9oYW5kbGVy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MTYgaWlyKQogCQlpbnRlbF9ndWNfdG9f
aG9zdF9ldmVudF9oYW5kbGVyKCZpOTE1LT5ndWMpOwogfQogCi1zdGF0aWMgdm9pZCBpOXh4X3Bp
cGVzdGF0X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0
aWMgdm9pZCBpOXh4X3BpcGVzdGF0X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAllbnVtIHBpcGUgcGlwZTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBp
cGUpIHsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJSTkxNV9XUklURShQSVBFU1RB
VChwaXBlKSwKIAkJCSAgIFBJUEVTVEFUX0lOVF9TVEFUVVNfTUFTSyB8CiAJCQkgICBQSVBFX0ZJ
Rk9fVU5ERVJSVU5fU1RBVFVTKTsKIAotCQlkZXZfcHJpdi0+cGlwZXN0YXRfaXJxX21hc2tbcGlw
ZV0gPSAwOworCQlpOTE1LT5waXBlc3RhdF9pcnFfbWFza1twaXBlXSA9IDA7CiAJfQogfQogCi1z
dGF0aWMgdm9pZCBpOXh4X3BpcGVzdGF0X2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIHZvaWQgaTl4eF9waXBlc3RhdF9pcnFfYWNrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgdTMyIGlpciwgdTMyIHBpcGVfc3RhdHNbSTkxNV9N
QVhfUElQRVNdKQogewogCWludCBwaXBlOwogCi0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+aXJxX2xv
Y2spOworCXNwaW5fbG9jaygmaTkxNS0+aXJxX2xvY2spOwogCi0JaWYgKCFkZXZfcHJpdi0+ZGlz
cGxheV9pcnFzX2VuYWJsZWQpIHsKLQkJc3Bpbl91bmxvY2soJmRldl9wcml2LT5pcnFfbG9jayk7
CisJaWYgKCFpOTE1LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkgeworCQlzcGluX3VubG9jaygmaTkx
NS0+aXJxX2xvY2spOwogCQlyZXR1cm47CiAJfQogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwg
cGlwZSkgeworCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkgewogCQlpOTE1X3JlZ190IHJlZzsK
IAkJdTMyIHN0YXR1c19tYXNrLCBlbmFibGVfbWFzaywgaWlyX2JpdCA9IDA7CiAKQEAgLTE5OTEs
MTQgKzE5OTEsMTQgQEAgc3RhdGljIHZvaWQgaTl4eF9waXBlc3RhdF9pcnFfYWNrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCWJyZWFrOwogCQl9CiAJCWlmIChpaXIgJiBp
aXJfYml0KQotCQkJc3RhdHVzX21hc2sgfD0gZGV2X3ByaXYtPnBpcGVzdGF0X2lycV9tYXNrW3Bp
cGVdOworCQkJc3RhdHVzX21hc2sgfD0gaTkxNS0+cGlwZXN0YXRfaXJxX21hc2tbcGlwZV07CiAK
IAkJaWYgKCFzdGF0dXNfbWFzaykKIAkJCWNvbnRpbnVlOwogCiAJCXJlZyA9IFBJUEVTVEFUKHBp
cGUpOwogCQlwaXBlX3N0YXRzW3BpcGVdID0gSTkxNV9SRUFEKHJlZykgJiBzdGF0dXNfbWFzazsK
LQkJZW5hYmxlX21hc2sgPSBpOTE1X3BpcGVzdGF0X2VuYWJsZV9tYXNrKGRldl9wcml2LCBwaXBl
KTsKKwkJZW5hYmxlX21hc2sgPSBpOTE1X3BpcGVzdGF0X2VuYWJsZV9tYXNrKGk5MTUsIHBpcGUp
OwogCiAJCS8qCiAJCSAqIENsZWFyIHRoZSBQSVBFKlNUQVQgcmVncyBiZWZvcmUgdGhlIElJUgpA
QCAtMjAxNCwxMDQgKzIwMTQsMTA0IEBAIHN0YXRpYyB2b2lkIGk5eHhfcGlwZXN0YXRfaXJxX2Fj
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQlJOTE1X1dSSVRFKHJlZywg
ZW5hYmxlX21hc2spOwogCQl9CiAJfQotCXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+aXJxX2xvY2sp
OworCXNwaW5fdW5sb2NrKCZpOTE1LT5pcnFfbG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIGk4eHhf
cGlwZXN0YXRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgaTh4eF9waXBlc3RhdF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCQkgICAgICB1MTYgaWlyLCB1MzIgcGlwZV9zdGF0c1tJOTE1X01BWF9Q
SVBFU10pCiB7CiAJZW51bSBwaXBlIHBpcGU7CiAKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBw
aXBlKSB7CisJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKSB7CiAJCWlmIChwaXBlX3N0YXRzW3Bp
cGVdICYgUElQRV9WQkxBTktfSU5URVJSVVBUX1NUQVRVUykKLQkJCWRybV9oYW5kbGVfdmJsYW5r
KCZkZXZfcHJpdi0+ZHJtLCBwaXBlKTsKKwkJCWRybV9oYW5kbGVfdmJsYW5rKCZpOTE1LT5kcm0s
IHBpcGUpOwogCiAJCWlmIChwaXBlX3N0YXRzW3BpcGVdICYgUElQRV9DUkNfRE9ORV9JTlRFUlJV
UFRfU1RBVFVTKQotCQkJaTl4eF9waXBlX2NyY19pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSk7
CisJCQlpOXh4X3BpcGVfY3JjX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUpOwogCiAJCWlmIChwaXBl
X3N0YXRzW3BpcGVdICYgUElQRV9GSUZPX1VOREVSUlVOX1NUQVRVUykKLQkJCWludGVsX2NwdV9m
aWZvX3VuZGVycnVuX2lycV9oYW5kbGVyKGRldl9wcml2LCBwaXBlKTsKKwkJCWludGVsX2NwdV9m
aWZvX3VuZGVycnVuX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUpOwogCX0KIH0KIAotc3RhdGljIHZv
aWQgaTkxNV9waXBlc3RhdF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBpOTE1X3BpcGVzdGF0X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgIHUzMiBpaXIsIHUzMiBwaXBlX3N0YXRzW0k5
MTVfTUFYX1BJUEVTXSkKIHsKIAlib29sIGJsY19ldmVudCA9IGZhbHNlOwogCWVudW0gcGlwZSBw
aXBlOwogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCWZvcl9lYWNoX3BpcGUo
aTkxNSwgcGlwZSkgewogCQlpZiAocGlwZV9zdGF0c1twaXBlXSAmIFBJUEVfVkJMQU5LX0lOVEVS
UlVQVF9TVEFUVVMpCi0JCQlkcm1faGFuZGxlX3ZibGFuaygmZGV2X3ByaXYtPmRybSwgcGlwZSk7
CisJCQlkcm1faGFuZGxlX3ZibGFuaygmaTkxNS0+ZHJtLCBwaXBlKTsKIAogCQlpZiAocGlwZV9z
dGF0c1twaXBlXSAmIFBJUEVfTEVHQUNZX0JMQ19FVkVOVF9TVEFUVVMpCiAJCQlibGNfZXZlbnQg
PSB0cnVlOwogCiAJCWlmIChwaXBlX3N0YXRzW3BpcGVdICYgUElQRV9DUkNfRE9ORV9JTlRFUlJV
UFRfU1RBVFVTKQotCQkJaTl4eF9waXBlX2NyY19pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSk7
CisJCQlpOXh4X3BpcGVfY3JjX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUpOwogCiAJCWlmIChwaXBl
X3N0YXRzW3BpcGVdICYgUElQRV9GSUZPX1VOREVSUlVOX1NUQVRVUykKLQkJCWludGVsX2NwdV9m
aWZvX3VuZGVycnVuX2lycV9oYW5kbGVyKGRldl9wcml2LCBwaXBlKTsKKwkJCWludGVsX2NwdV9m
aWZvX3VuZGVycnVuX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUpOwogCX0KIAogCWlmIChibGNfZXZl
bnQgfHwgKGlpciAmIEk5MTVfQVNMRV9JTlRFUlJVUFQpKQotCQlpbnRlbF9vcHJlZ2lvbl9hc2xl
X2ludHIoZGV2X3ByaXYpOworCQlpbnRlbF9vcHJlZ2lvbl9hc2xlX2ludHIoaTkxNSk7CiB9CiAK
LXN0YXRpYyB2b2lkIGk5NjVfcGlwZXN0YXRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaTk2NV9waXBlc3RhdF9pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICB1MzIgaWlyLCB1MzIgcGlw
ZV9zdGF0c1tJOTE1X01BWF9QSVBFU10pCiB7CiAJYm9vbCBibGNfZXZlbnQgPSBmYWxzZTsKIAll
bnVtIHBpcGUgcGlwZTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpIHsKKwlmb3Jf
ZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJaWYgKHBpcGVfc3RhdHNbcGlwZV0gJiBQSVBFX1NU
QVJUX1ZCTEFOS19JTlRFUlJVUFRfU1RBVFVTKQotCQkJZHJtX2hhbmRsZV92YmxhbmsoJmRldl9w
cml2LT5kcm0sIHBpcGUpOworCQkJZHJtX2hhbmRsZV92YmxhbmsoJmk5MTUtPmRybSwgcGlwZSk7
CiAKIAkJaWYgKHBpcGVfc3RhdHNbcGlwZV0gJiBQSVBFX0xFR0FDWV9CTENfRVZFTlRfU1RBVFVT
KQogCQkJYmxjX2V2ZW50ID0gdHJ1ZTsKIAogCQlpZiAocGlwZV9zdGF0c1twaXBlXSAmIFBJUEVf
Q1JDX0RPTkVfSU5URVJSVVBUX1NUQVRVUykKLQkJCWk5eHhfcGlwZV9jcmNfaXJxX2hhbmRsZXIo
ZGV2X3ByaXYsIHBpcGUpOworCQkJaTl4eF9waXBlX2NyY19pcnFfaGFuZGxlcihpOTE1LCBwaXBl
KTsKIAogCQlpZiAocGlwZV9zdGF0c1twaXBlXSAmIFBJUEVfRklGT19VTkRFUlJVTl9TVEFUVVMp
Ci0JCQlpbnRlbF9jcHVfZmlmb191bmRlcnJ1bl9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSk7
CisJCQlpbnRlbF9jcHVfZmlmb191bmRlcnJ1bl9pcnFfaGFuZGxlcihpOTE1LCBwaXBlKTsKIAl9
CiAKIAlpZiAoYmxjX2V2ZW50IHx8IChpaXIgJiBJOTE1X0FTTEVfSU5URVJSVVBUKSkKLQkJaW50
ZWxfb3ByZWdpb25fYXNsZV9pbnRyKGRldl9wcml2KTsKKwkJaW50ZWxfb3ByZWdpb25fYXNsZV9p
bnRyKGk5MTUpOwogCiAJaWYgKHBpcGVfc3RhdHNbMF0gJiBQSVBFX0dNQlVTX0lOVEVSUlVQVF9T
VEFUVVMpCi0JCWdtYnVzX2lycV9oYW5kbGVyKGRldl9wcml2KTsKKwkJZ21idXNfaXJxX2hhbmRs
ZXIoaTkxNSk7CiB9CiAKLXN0YXRpYyB2b2lkIHZhbGxleXZpZXdfcGlwZXN0YXRfaXJxX2hhbmRs
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgdmFsbGV5
dmlld19waXBlc3RhdF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkJICAgIHUzMiBwaXBlX3N0YXRzW0k5MTVfTUFYX1BJUEVTXSkKIHsKIAllbnVtIHBpcGUg
cGlwZTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpIHsKKwlmb3JfZWFjaF9waXBl
KGk5MTUsIHBpcGUpIHsKIAkJaWYgKHBpcGVfc3RhdHNbcGlwZV0gJiBQSVBFX1NUQVJUX1ZCTEFO
S19JTlRFUlJVUFRfU1RBVFVTKQotCQkJZHJtX2hhbmRsZV92YmxhbmsoJmRldl9wcml2LT5kcm0s
IHBpcGUpOworCQkJZHJtX2hhbmRsZV92YmxhbmsoJmk5MTUtPmRybSwgcGlwZSk7CiAKIAkJaWYg
KHBpcGVfc3RhdHNbcGlwZV0gJiBQSVBFX0NSQ19ET05FX0lOVEVSUlVQVF9TVEFUVVMpCi0JCQlp
OXh4X3BpcGVfY3JjX2lycV9oYW5kbGVyKGRldl9wcml2LCBwaXBlKTsKKwkJCWk5eHhfcGlwZV9j
cmNfaXJxX2hhbmRsZXIoaTkxNSwgcGlwZSk7CiAKIAkJaWYgKHBpcGVfc3RhdHNbcGlwZV0gJiBQ
SVBFX0ZJRk9fVU5ERVJSVU5fU1RBVFVTKQotCQkJaW50ZWxfY3B1X2ZpZm9fdW5kZXJydW5faXJx
X2hhbmRsZXIoZGV2X3ByaXYsIHBpcGUpOworCQkJaW50ZWxfY3B1X2ZpZm9fdW5kZXJydW5faXJx
X2hhbmRsZXIoaTkxNSwgcGlwZSk7CiAJfQogCiAJaWYgKHBpcGVfc3RhdHNbMF0gJiBQSVBFX0dN
QlVTX0lOVEVSUlVQVF9TVEFUVVMpCi0JCWdtYnVzX2lycV9oYW5kbGVyKGRldl9wcml2KTsKKwkJ
Z21idXNfaXJxX2hhbmRsZXIoaTkxNSk7CiB9CiAKLXN0YXRpYyB1MzIgaTl4eF9ocGRfaXJxX2Fj
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdTMyIGk5eHhfaHBk
X2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGhvdHBsdWdf
c3RhdHVzID0gMCwgaG90cGx1Z19zdGF0dXNfbWFzazsKIAlpbnQgaTsKIAotCWlmIChJU19HNFgo
ZGV2X3ByaXYpIHx8Ci0JICAgIElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJ
RVcoZGV2X3ByaXYpKQorCWlmIChJU19HNFgoaTkxNSkgfHwKKwkgICAgSVNfVkFMTEVZVklFVyhp
OTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQogCQlob3RwbHVnX3N0YXR1c19tYXNrID0gSE9U
UExVR19JTlRfU1RBVFVTX0c0WCB8CiAJCQlEUF9BVVhfQ0hBTk5FTF9NQVNLX0lOVF9TVEFUVVNf
RzRYOwogCWVsc2UKQEAgLTIxNDMsMzUgKzIxNDMsMzUgQEAgc3RhdGljIHUzMiBpOXh4X2hwZF9p
cnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gaG90cGx1
Z19zdGF0dXM7CiB9CiAKLXN0YXRpYyB2b2lkIGk5eHhfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGk5eHhfaHBkX2lycV9oYW5k
bGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSB1MzIgaG90cGx1Z19zdGF0
dXMpCiB7CiAJdTMyIHBpbl9tYXNrID0gMCwgbG9uZ19tYXNrID0gMDsKIAotCWlmIChJU19HNFgo
ZGV2X3ByaXYpIHx8IElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8Ci0JICAgIElTX0NIRVJSWVZJ
RVcoZGV2X3ByaXYpKSB7CisJaWYgKElTX0c0WChpOTE1KSB8fCBJU19WQUxMRVlWSUVXKGk5MTUp
IHx8CisJICAgIElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJdTMyIGhvdHBsdWdfdHJpZ2dlciA9
IGhvdHBsdWdfc3RhdHVzICYgSE9UUExVR19JTlRfU1RBVFVTX0c0WDsKIAogCQlpZiAoaG90cGx1
Z190cmlnZ2VyKSB7Ci0JCQlpbnRlbF9nZXRfaHBkX3BpbnMoZGV2X3ByaXYsICZwaW5fbWFzaywg
JmxvbmdfbWFzaywKKwkJCWludGVsX2dldF9ocGRfcGlucyhpOTE1LCAmcGluX21hc2ssICZsb25n
X21hc2ssCiAJCQkJCSAgIGhvdHBsdWdfdHJpZ2dlciwgaG90cGx1Z190cmlnZ2VyLAogCQkJCQkg
ICBocGRfc3RhdHVzX2c0eCwKIAkJCQkJICAgaTl4eF9wb3J0X2hvdHBsdWdfbG9uZ19kZXRlY3Qp
OwogCi0JCQlpbnRlbF9ocGRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBpbl9tYXNrLCBsb25nX21h
c2spOworCQkJaW50ZWxfaHBkX2lycV9oYW5kbGVyKGk5MTUsIHBpbl9tYXNrLCBsb25nX21hc2sp
OwogCQl9CiAKIAkJaWYgKGhvdHBsdWdfc3RhdHVzICYgRFBfQVVYX0NIQU5ORUxfTUFTS19JTlRf
U1RBVFVTX0c0WCkKLQkJCWRwX2F1eF9pcnFfaGFuZGxlcihkZXZfcHJpdik7CisJCQlkcF9hdXhf
aXJxX2hhbmRsZXIoaTkxNSk7CiAJfSBlbHNlIHsKIAkJdTMyIGhvdHBsdWdfdHJpZ2dlciA9IGhv
dHBsdWdfc3RhdHVzICYgSE9UUExVR19JTlRfU1RBVFVTX0k5MTU7CiAKIAkJaWYgKGhvdHBsdWdf
dHJpZ2dlcikgewotCQkJaW50ZWxfZ2V0X2hwZF9waW5zKGRldl9wcml2LCAmcGluX21hc2ssICZs
b25nX21hc2ssCisJCQlpbnRlbF9nZXRfaHBkX3BpbnMoaTkxNSwgJnBpbl9tYXNrLCAmbG9uZ19t
YXNrLAogCQkJCQkgICBob3RwbHVnX3RyaWdnZXIsIGhvdHBsdWdfdHJpZ2dlciwKIAkJCQkJICAg
aHBkX3N0YXR1c19pOTE1LAogCQkJCQkgICBpOXh4X3BvcnRfaG90cGx1Z19sb25nX2RldGVjdCk7
Ci0JCQlpbnRlbF9ocGRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBpbl9tYXNrLCBsb25nX21hc2sp
OworCQkJaW50ZWxfaHBkX2lycV9oYW5kbGVyKGk5MTUsIHBpbl9tYXNrLCBsb25nX21hc2spOwog
CQl9CiAJfQogfQpAQCAtMjE3OSwxNCArMjE3OSwxNCBAQCBzdGF0aWMgdm9pZCBpOXh4X2hwZF9p
cnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgaXJx
cmV0dXJuX3QgdmFsbGV5dmlld19pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICphcmcpCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGFyZzsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGRldik7CiAJaXJxcmV0dXJuX3QgcmV0ID0gSVJRX05PTkU7CiAKLQlpZiAoIWlu
dGVsX2lycXNfZW5hYmxlZChkZXZfcHJpdikpCisJaWYgKCFpbnRlbF9pcnFzX2VuYWJsZWQoaTkx
NSkpCiAJCXJldHVybiBJUlFfTk9ORTsKIAogCS8qIElSUXMgYXJlIHN5bmNlZCBkdXJpbmcgcnVu
dGltZV9zdXNwZW5kLCB3ZSBkb24ndCByZXF1aXJlIGEgd2FrZXJlZiAqLwotCWRpc2FibGVfcnBt
X3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRz
KGk5MTUpOwogCiAJZG8gewogCQl1MzIgaWlyLCBndF9paXIsIHBtX2lpcjsKQEAgLTIyMjYsMTUg
KzIyMjYsMTUgQEAgc3RhdGljIGlycXJldHVybl90IHZhbGxleXZpZXdfaXJxX2hhbmRsZXIoaW50
IGlycSwgdm9pZCAqYXJnKQogCQkJSTkxNV9XUklURShHRU42X1BNSUlSLCBwbV9paXIpOwogCiAJ
CWlmIChpaXIgJiBJOTE1X0RJU1BMQVlfUE9SVF9JTlRFUlJVUFQpCi0JCQlob3RwbHVnX3N0YXR1
cyA9IGk5eHhfaHBkX2lycV9hY2soZGV2X3ByaXYpOworCQkJaG90cGx1Z19zdGF0dXMgPSBpOXh4
X2hwZF9pcnFfYWNrKGk5MTUpOwogCiAJCS8qIENhbGwgcmVnYXJkbGVzcywgYXMgc29tZSBzdGF0
dXMgYml0cyBtaWdodCBub3QgYmUKIAkJICogc2lnbmFsbGVkIGluIGlpciAqLwotCQlpOXh4X3Bp
cGVzdGF0X2lycV9hY2soZGV2X3ByaXYsIGlpciwgcGlwZV9zdGF0cyk7CisJCWk5eHhfcGlwZXN0
YXRfaXJxX2FjayhpOTE1LCBpaXIsIHBpcGVfc3RhdHMpOwogCiAJCWlmIChpaXIgJiAoSTkxNV9M
UEVfUElQRV9BX0lOVEVSUlVQVCB8CiAJCQkgICBJOTE1X0xQRV9QSVBFX0JfSU5URVJSVVBUKSkK
LQkJCWludGVsX2xwZV9hdWRpb19pcnFfaGFuZGxlcihkZXZfcHJpdik7CisJCQlpbnRlbF9scGVf
YXVkaW9faXJxX2hhbmRsZXIoaTkxNSk7CiAKIAkJLyoKIAkJICogVkxWX0lJUiBpcyBzaW5nbGUg
YnVmZmVyZWQsIGFuZCByZWZsZWN0cyB0aGUgbGV2ZWwKQEAgLTIyNDcsMTcgKzIyNDcsMTcgQEAg
c3RhdGljIGlycXJldHVybl90IHZhbGxleXZpZXdfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAq
YXJnKQogCQlJOTE1X1dSSVRFKFZMVl9NQVNURVJfSUVSLCBNQVNURVJfSU5URVJSVVBUX0VOQUJM
RSk7CiAKIAkJaWYgKGd0X2lpcikKLQkJCXNuYl9ndF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgZ3Rf
aWlyKTsKKwkJCXNuYl9ndF9pcnFfaGFuZGxlcihpOTE1LCBndF9paXIpOwogCQlpZiAocG1faWly
KQotCQkJZ2VuNl9ycHNfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBtX2lpcik7CisJCQlnZW42X3Jw
c19pcnFfaGFuZGxlcihpOTE1LCBwbV9paXIpOwogCiAJCWlmIChob3RwbHVnX3N0YXR1cykKLQkJ
CWk5eHhfaHBkX2lycV9oYW5kbGVyKGRldl9wcml2LCBob3RwbHVnX3N0YXR1cyk7CisJCQlpOXh4
X2hwZF9pcnFfaGFuZGxlcihpOTE1LCBob3RwbHVnX3N0YXR1cyk7CiAKLQkJdmFsbGV5dmlld19w
aXBlc3RhdF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZV9zdGF0cyk7CisJCXZhbGxleXZpZXdf
cGlwZXN0YXRfaXJxX2hhbmRsZXIoaTkxNSwgcGlwZV9zdGF0cyk7CiAJfSB3aGlsZSAoMCk7CiAK
LQllbmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJZW5hYmxlX3JwbV93YWtl
cmVmX2Fzc2VydHMoaTkxNSk7CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtMjI2NSwxNCArMjI2NSwx
NCBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgdmFsbGV5dmlld19pcnFfaGFuZGxlcihpbnQgaXJxLCB2
b2lkICphcmcpCiBzdGF0aWMgaXJxcmV0dXJuX3QgY2hlcnJ5dmlld19pcnFfaGFuZGxlcihpbnQg
aXJxLCB2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGFyZzsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJaXJxcmV0dXJuX3QgcmV0ID0g
SVJRX05PTkU7CiAKLQlpZiAoIWludGVsX2lycXNfZW5hYmxlZChkZXZfcHJpdikpCisJaWYgKCFp
bnRlbF9pcnFzX2VuYWJsZWQoaTkxNSkpCiAJCXJldHVybiBJUlFfTk9ORTsKIAogCS8qIElSUXMg
YXJlIHN5bmNlZCBkdXJpbmcgcnVudGltZV9zdXNwZW5kLCB3ZSBkb24ndCByZXF1aXJlIGEgd2Fr
ZXJlZiAqLwotCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJZGlzYWJs
ZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGk5MTUpOwogCiAJZG8gewogCQl1MzIgbWFzdGVyX2N0bCwg
aWlyOwpAQCAtMjMwNiwxOSArMjMwNiwxOSBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgY2hlcnJ5dmll
d19pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICphcmcpCiAJCWllciA9IEk5MTVfUkVBRChWTFZf
SUVSKTsKIAkJSTkxNV9XUklURShWTFZfSUVSLCAwKTsKIAotCQlnZW44X2d0X2lycV9hY2soZGV2
X3ByaXYsIG1hc3Rlcl9jdGwsIGd0X2lpcik7CisJCWdlbjhfZ3RfaXJxX2FjayhpOTE1LCBtYXN0
ZXJfY3RsLCBndF9paXIpOwogCiAJCWlmIChpaXIgJiBJOTE1X0RJU1BMQVlfUE9SVF9JTlRFUlJV
UFQpCi0JCQlob3RwbHVnX3N0YXR1cyA9IGk5eHhfaHBkX2lycV9hY2soZGV2X3ByaXYpOworCQkJ
aG90cGx1Z19zdGF0dXMgPSBpOXh4X2hwZF9pcnFfYWNrKGk5MTUpOwogCiAJCS8qIENhbGwgcmVn
YXJkbGVzcywgYXMgc29tZSBzdGF0dXMgYml0cyBtaWdodCBub3QgYmUKIAkJICogc2lnbmFsbGVk
IGluIGlpciAqLwotCQlpOXh4X3BpcGVzdGF0X2lycV9hY2soZGV2X3ByaXYsIGlpciwgcGlwZV9z
dGF0cyk7CisJCWk5eHhfcGlwZXN0YXRfaXJxX2FjayhpOTE1LCBpaXIsIHBpcGVfc3RhdHMpOwog
CiAJCWlmIChpaXIgJiAoSTkxNV9MUEVfUElQRV9BX0lOVEVSUlVQVCB8CiAJCQkgICBJOTE1X0xQ
RV9QSVBFX0JfSU5URVJSVVBUIHwKIAkJCSAgIEk5MTVfTFBFX1BJUEVfQ19JTlRFUlJVUFQpKQot
CQkJaW50ZWxfbHBlX2F1ZGlvX2lycV9oYW5kbGVyKGRldl9wcml2KTsKKwkJCWludGVsX2xwZV9h
dWRpb19pcnFfaGFuZGxlcihpOTE1KTsKIAogCQkvKgogCQkgKiBWTFZfSUlSIGlzIHNpbmdsZSBi
dWZmZXJlZCwgYW5kIHJlZmxlY3RzIHRoZSBsZXZlbApAQCAtMjMzMCwyMCArMjMzMCwyMCBAQCBz
dGF0aWMgaXJxcmV0dXJuX3QgY2hlcnJ5dmlld19pcnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICph
cmcpCiAJCUk5MTVfV1JJVEUoVkxWX0lFUiwgaWVyKTsKIAkJSTkxNV9XUklURShHRU44X01BU1RF
Ul9JUlEsIEdFTjhfTUFTVEVSX0lSUV9DT05UUk9MKTsKIAotCQlnZW44X2d0X2lycV9oYW5kbGVy
KGRldl9wcml2LCBtYXN0ZXJfY3RsLCBndF9paXIpOworCQlnZW44X2d0X2lycV9oYW5kbGVyKGk5
MTUsIG1hc3Rlcl9jdGwsIGd0X2lpcik7CiAKIAkJaWYgKGhvdHBsdWdfc3RhdHVzKQotCQkJaTl4
eF9ocGRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIGhvdHBsdWdfc3RhdHVzKTsKKwkJCWk5eHhfaHBk
X2lycV9oYW5kbGVyKGk5MTUsIGhvdHBsdWdfc3RhdHVzKTsKIAotCQl2YWxsZXl2aWV3X3BpcGVz
dGF0X2lycV9oYW5kbGVyKGRldl9wcml2LCBwaXBlX3N0YXRzKTsKKwkJdmFsbGV5dmlld19waXBl
c3RhdF9pcnFfaGFuZGxlcihpOTE1LCBwaXBlX3N0YXRzKTsKIAl9IHdoaWxlICgwKTsKIAotCWVu
YWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwllbmFibGVfcnBtX3dha2VyZWZf
YXNzZXJ0cyhpOTE1KTsKIAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lkIGlieF9ocGRf
aXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZv
aWQgaWJ4X2hwZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQl1MzIgaG90cGx1Z190cmlnZ2VyLAogCQkJCWNvbnN0IHUzMiBocGRbSFBEX05VTV9QSU5TXSkK
IHsKQEAgLTIzNjgsMTkgKzIzNjgsMTkgQEAgc3RhdGljIHZvaWQgaWJ4X2hwZF9pcnFfaGFuZGxl
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKCFob3RwbHVnX3RyaWdn
ZXIpCiAJCXJldHVybjsKIAotCWludGVsX2dldF9ocGRfcGlucyhkZXZfcHJpdiwgJnBpbl9tYXNr
LCAmbG9uZ19tYXNrLCBob3RwbHVnX3RyaWdnZXIsCisJaW50ZWxfZ2V0X2hwZF9waW5zKGk5MTUs
ICZwaW5fbWFzaywgJmxvbmdfbWFzaywgaG90cGx1Z190cmlnZ2VyLAogCQkJICAgZGlnX2hvdHBs
dWdfcmVnLCBocGQsCiAJCQkgICBwY2hfcG9ydF9ob3RwbHVnX2xvbmdfZGV0ZWN0KTsKIAotCWlu
dGVsX2hwZF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGluX21hc2ssIGxvbmdfbWFzayk7CisJaW50
ZWxfaHBkX2lycV9oYW5kbGVyKGk5MTUsIHBpbl9tYXNrLCBsb25nX21hc2spOwogfQogCi1zdGF0
aWMgdm9pZCBpYnhfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCB1MzIgcGNoX2lpcikKK3N0YXRpYyB2b2lkIGlieF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHBjaF9paXIpCiB7CiAJaW50IHBpcGU7CiAJdTMyIGhvdHBs
dWdfdHJpZ2dlciA9IHBjaF9paXIgJiBTREVfSE9UUExVR19NQVNLOwogCi0JaWJ4X2hwZF9pcnFf
aGFuZGxlcihkZXZfcHJpdiwgaG90cGx1Z190cmlnZ2VyLCBocGRfaWJ4KTsKKwlpYnhfaHBkX2ly
cV9oYW5kbGVyKGk5MTUsIGhvdHBsdWdfdHJpZ2dlciwgaHBkX2lieCk7CiAKIAlpZiAocGNoX2lp
ciAmIFNERV9BVURJT19QT1dFUl9NQVNLKSB7CiAJCWludCBwb3J0ID0gZmZzKChwY2hfaWlyICYg
U0RFX0FVRElPX1BPV0VSX01BU0spID4+CkBAIC0yMzkwLDEwICsyMzkwLDEwIEBAIHN0YXRpYyB2
b2lkIGlieF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUz
MiBwY2hfaWlyKQogCX0KIAogCWlmIChwY2hfaWlyICYgU0RFX0FVWF9NQVNLKQotCQlkcF9hdXhf
aXJxX2hhbmRsZXIoZGV2X3ByaXYpOworCQlkcF9hdXhfaXJxX2hhbmRsZXIoaTkxNSk7CiAKIAlp
ZiAocGNoX2lpciAmIFNERV9HTUJVUykKLQkJZ21idXNfaXJxX2hhbmRsZXIoZGV2X3ByaXYpOwor
CQlnbWJ1c19pcnFfaGFuZGxlcihpOTE1KTsKIAogCWlmIChwY2hfaWlyICYgU0RFX0FVRElPX0hE
Q1BfTUFTSykKIAkJRFJNX0RFQlVHX0RSSVZFUigiUENIIEhEQ1AgYXVkaW8gaW50ZXJydXB0XG4i
KTsKQEAgLTI0MDUsNyArMjQwNSw3IEBAIHN0YXRpYyB2b2lkIGlieF9pcnFfaGFuZGxlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwY2hfaWlyKQogCQlEUk1fRVJST1Io
IlBDSCBwb2lzb24gaW50ZXJydXB0XG4iKTsKIAogCWlmIChwY2hfaWlyICYgU0RFX0ZESV9NQVNL
KQotCQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBwaXBlKQorCQlmb3JfZWFjaF9waXBlKGk5MTUs
IHBpcGUpCiAJCQlEUk1fREVCVUdfRFJJVkVSKCIgIHBpcGUgJWMgRkRJIElJUjogMHglMDh4XG4i
LAogCQkJCQkgcGlwZV9uYW1lKHBpcGUpLAogCQkJCQkgSTkxNV9SRUFEKEZESV9SWF9JSVIocGlw
ZSkpKTsKQEAgLTI0MTcsMTMgKzI0MTcsMTMgQEAgc3RhdGljIHZvaWQgaWJ4X2lycV9oYW5kbGVy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBjaF9paXIpCiAJCURSTV9E
RUJVR19EUklWRVIoIlBDSCB0cmFuc2NvZGVyIENSQyBlcnJvciBpbnRlcnJ1cHRcbiIpOwogCiAJ
aWYgKHBjaF9paXIgJiBTREVfVFJBTlNBX0ZJRk9fVU5ERVIpCi0JCWludGVsX3BjaF9maWZvX3Vu
ZGVycnVuX2lycV9oYW5kbGVyKGRldl9wcml2LCBQSVBFX0EpOworCQlpbnRlbF9wY2hfZmlmb191
bmRlcnJ1bl9pcnFfaGFuZGxlcihpOTE1LCBQSVBFX0EpOwogCiAJaWYgKHBjaF9paXIgJiBTREVf
VFJBTlNCX0ZJRk9fVU5ERVIpCi0JCWludGVsX3BjaF9maWZvX3VuZGVycnVuX2lycV9oYW5kbGVy
KGRldl9wcml2LCBQSVBFX0IpOworCQlpbnRlbF9wY2hfZmlmb191bmRlcnJ1bl9pcnFfaGFuZGxl
cihpOTE1LCBQSVBFX0IpOwogfQogCi1zdGF0aWMgdm9pZCBpdmJfZXJyX2ludF9oYW5kbGVyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGl2Yl9lcnJfaW50
X2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGVycl9pbnQg
PSBJOTE1X1JFQUQoR0VON19FUlJfSU5UKTsKIAllbnVtIHBpcGUgcGlwZTsKQEAgLTI0MzEsMjIg
KzI0MzEsMjIgQEAgc3RhdGljIHZvaWQgaXZiX2Vycl9pbnRfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKGVycl9pbnQgJiBFUlJfSU5UX1BPSVNPTikKIAkJ
RFJNX0VSUk9SKCJQb2lzb24gaW50ZXJydXB0XG4iKTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3By
aXYsIHBpcGUpIHsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJaWYgKGVycl9pbnQg
JiBFUlJfSU5UX0ZJRk9fVU5ERVJSVU4ocGlwZSkpCi0JCQlpbnRlbF9jcHVfZmlmb191bmRlcnJ1
bl9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSk7CisJCQlpbnRlbF9jcHVfZmlmb191bmRlcnJ1
bl9pcnFfaGFuZGxlcihpOTE1LCBwaXBlKTsKIAogCQlpZiAoZXJyX2ludCAmIEVSUl9JTlRfUElQ
RV9DUkNfRE9ORShwaXBlKSkgewotCQkJaWYgKElTX0lWWUJSSURHRShkZXZfcHJpdikpCi0JCQkJ
aXZiX3BpcGVfY3JjX2lycV9oYW5kbGVyKGRldl9wcml2LCBwaXBlKTsKKwkJCWlmIChJU19JVllC
UklER0UoaTkxNSkpCisJCQkJaXZiX3BpcGVfY3JjX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUpOwog
CQkJZWxzZQotCQkJCWhzd19waXBlX2NyY19pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSk7CisJ
CQkJaHN3X3BpcGVfY3JjX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUpOwogCQl9CiAJfQogCiAJSTkx
NV9XUklURShHRU43X0VSUl9JTlQsIGVycl9pbnQpOwogfQogCi1zdGF0aWMgdm9pZCBjcHRfc2Vy
cl9pbnRfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
dm9pZCBjcHRfc2Vycl9pbnRfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAl1MzIgc2Vycl9pbnQgPSBJOTE1X1JFQUQoU0VSUl9JTlQpOwogCWVudW0gcGlwZSBwaXBl
OwpAQCAtMjQ1NCwxOSArMjQ1NCwxOSBAQCBzdGF0aWMgdm9pZCBjcHRfc2Vycl9pbnRfaGFuZGxl
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKHNlcnJfaW50ICYgU0VS
Ul9JTlRfUE9JU09OKQogCQlEUk1fRVJST1IoIlBDSCBwb2lzb24gaW50ZXJydXB0XG4iKTsKIAot
CWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpCisJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBl
KQogCQlpZiAoc2Vycl9pbnQgJiBTRVJSX0lOVF9UUkFOU19GSUZPX1VOREVSUlVOKHBpcGUpKQot
CQkJaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW5faXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBpcGUpOwor
CQkJaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW5faXJxX2hhbmRsZXIoaTkxNSwgcGlwZSk7CiAKIAlJ
OTE1X1dSSVRFKFNFUlJfSU5ULCBzZXJyX2ludCk7CiB9CiAKLXN0YXRpYyB2b2lkIGNwdF9pcnFf
aGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwY2hfaWlyKQor
c3RhdGljIHZvaWQgY3B0X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCB1MzIgcGNoX2lpcikKIHsKIAlpbnQgcGlwZTsKIAl1MzIgaG90cGx1Z190cmlnZ2VyID0gcGNo
X2lpciAmIFNERV9IT1RQTFVHX01BU0tfQ1BUOwogCi0JaWJ4X2hwZF9pcnFfaGFuZGxlcihkZXZf
cHJpdiwgaG90cGx1Z190cmlnZ2VyLCBocGRfY3B0KTsKKwlpYnhfaHBkX2lycV9oYW5kbGVyKGk5
MTUsIGhvdHBsdWdfdHJpZ2dlciwgaHBkX2NwdCk7CiAKIAlpZiAocGNoX2lpciAmIFNERV9BVURJ
T19QT1dFUl9NQVNLX0NQVCkgewogCQlpbnQgcG9ydCA9IGZmcygocGNoX2lpciAmIFNERV9BVURJ
T19QT1dFUl9NQVNLX0NQVCkgPj4KQEAgLTI0NzYsMTAgKzI0NzYsMTAgQEAgc3RhdGljIHZvaWQg
Y3B0X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBj
aF9paXIpCiAJfQogCiAJaWYgKHBjaF9paXIgJiBTREVfQVVYX01BU0tfQ1BUKQotCQlkcF9hdXhf
aXJxX2hhbmRsZXIoZGV2X3ByaXYpOworCQlkcF9hdXhfaXJxX2hhbmRsZXIoaTkxNSk7CiAKIAlp
ZiAocGNoX2lpciAmIFNERV9HTUJVU19DUFQpCi0JCWdtYnVzX2lycV9oYW5kbGVyKGRldl9wcml2
KTsKKwkJZ21idXNfaXJxX2hhbmRsZXIoaTkxNSk7CiAKIAlpZiAocGNoX2lpciAmIFNERV9BVURJ
T19DUF9SRVFfQ1BUKQogCQlEUk1fREVCVUdfRFJJVkVSKCJBdWRpbyBDUCByZXF1ZXN0IGludGVy
cnVwdFxuIik7CkBAIC0yNDg4LDE2ICsyNDg4LDE2IEBAIHN0YXRpYyB2b2lkIGNwdF9pcnFfaGFu
ZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwY2hfaWlyKQogCQlE
Uk1fREVCVUdfRFJJVkVSKCJBdWRpbyBDUCBjaGFuZ2UgaW50ZXJydXB0XG4iKTsKIAogCWlmIChw
Y2hfaWlyICYgU0RFX0ZESV9NQVNLX0NQVCkKLQkJZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlw
ZSkKKwkJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKQogCQkJRFJNX0RFQlVHX0RSSVZFUigiICBw
aXBlICVjIEZESSBJSVI6IDB4JTA4eFxuIiwKIAkJCQkJIHBpcGVfbmFtZShwaXBlKSwKIAkJCQkJ
IEk5MTVfUkVBRChGRElfUlhfSUlSKHBpcGUpKSk7CiAKIAlpZiAocGNoX2lpciAmIFNERV9FUlJP
Ul9DUFQpCi0JCWNwdF9zZXJyX2ludF9oYW5kbGVyKGRldl9wcml2KTsKKwkJY3B0X3NlcnJfaW50
X2hhbmRsZXIoaTkxNSk7CiB9CiAKLXN0YXRpYyB2b2lkIGljcF9pcnFfaGFuZGxlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwY2hfaWlyKQorc3RhdGljIHZvaWQgaWNw
X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgcGNoX2lpcikK
IHsKIAl1MzIgZGRpX2hvdHBsdWdfdHJpZ2dlciA9IHBjaF9paXIgJiBTREVfRERJX01BU0tfSUNQ
OwogCXUzMiB0Y19ob3RwbHVnX3RyaWdnZXIgPSBwY2hfaWlyICYgU0RFX1RDX01BU0tfSUNQOwpA
QCAtMjUwOSw3ICsyNTA5LDcgQEAgc3RhdGljIHZvaWQgaWNwX2lycV9oYW5kbGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBjaF9paXIpCiAJCWRpZ19ob3RwbHVnX3Jl
ZyA9IEk5MTVfUkVBRChTSE9UUExVR19DVExfRERJKTsKIAkJSTkxNV9XUklURShTSE9UUExVR19D
VExfRERJLCBkaWdfaG90cGx1Z19yZWcpOwogCi0JCWludGVsX2dldF9ocGRfcGlucyhkZXZfcHJp
diwgJnBpbl9tYXNrLCAmbG9uZ19tYXNrLAorCQlpbnRlbF9nZXRfaHBkX3BpbnMoaTkxNSwgJnBp
bl9tYXNrLCAmbG9uZ19tYXNrLAogCQkJCSAgIGRkaV9ob3RwbHVnX3RyaWdnZXIsCiAJCQkJICAg
ZGlnX2hvdHBsdWdfcmVnLCBocGRfaWNwLAogCQkJCSAgIGljcF9kZGlfcG9ydF9ob3RwbHVnX2xv
bmdfZGV0ZWN0KTsKQEAgLTI1MjEsMjAgKzI1MjEsMjAgQEAgc3RhdGljIHZvaWQgaWNwX2lycV9o
YW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBjaF9paXIpCiAJ
CWRpZ19ob3RwbHVnX3JlZyA9IEk5MTVfUkVBRChTSE9UUExVR19DVExfVEMpOwogCQlJOTE1X1dS
SVRFKFNIT1RQTFVHX0NUTF9UQywgZGlnX2hvdHBsdWdfcmVnKTsKIAotCQlpbnRlbF9nZXRfaHBk
X3BpbnMoZGV2X3ByaXYsICZwaW5fbWFzaywgJmxvbmdfbWFzaywKKwkJaW50ZWxfZ2V0X2hwZF9w
aW5zKGk5MTUsICZwaW5fbWFzaywgJmxvbmdfbWFzaywKIAkJCQkgICB0Y19ob3RwbHVnX3RyaWdn
ZXIsCiAJCQkJICAgZGlnX2hvdHBsdWdfcmVnLCBocGRfaWNwLAogCQkJCSAgIGljcF90Y19wb3J0
X2hvdHBsdWdfbG9uZ19kZXRlY3QpOwogCX0KIAogCWlmIChwaW5fbWFzaykKLQkJaW50ZWxfaHBk
X2lycV9oYW5kbGVyKGRldl9wcml2LCBwaW5fbWFzaywgbG9uZ19tYXNrKTsKKwkJaW50ZWxfaHBk
X2lycV9oYW5kbGVyKGk5MTUsIHBpbl9tYXNrLCBsb25nX21hc2spOwogCiAJaWYgKHBjaF9paXIg
JiBTREVfR01CVVNfSUNQKQotCQlnbWJ1c19pcnFfaGFuZGxlcihkZXZfcHJpdik7CisJCWdtYnVz
X2lycV9oYW5kbGVyKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBzcHRfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcGNoX2lpcikKK3N0YXRpYyB2b2lk
IHNwdF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHBjaF9p
aXIpCiB7CiAJdTMyIGhvdHBsdWdfdHJpZ2dlciA9IHBjaF9paXIgJiBTREVfSE9UUExVR19NQVNL
X1NQVCAmCiAJCX5TREVfUE9SVEVfSE9UUExVR19TUFQ7CkBAIC0yNTQ3LDcgKzI1NDcsNyBAQCBz
dGF0aWMgdm9pZCBzcHRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1MzIgcGNoX2lpcikKIAkJZGlnX2hvdHBsdWdfcmVnID0gSTkxNV9SRUFEKFBDSF9QT1JU
X0hPVFBMVUcpOwogCQlJOTE1X1dSSVRFKFBDSF9QT1JUX0hPVFBMVUcsIGRpZ19ob3RwbHVnX3Jl
Zyk7CiAKLQkJaW50ZWxfZ2V0X2hwZF9waW5zKGRldl9wcml2LCAmcGluX21hc2ssICZsb25nX21h
c2ssCisJCWludGVsX2dldF9ocGRfcGlucyhpOTE1LCAmcGluX21hc2ssICZsb25nX21hc2ssCiAJ
CQkJICAgaG90cGx1Z190cmlnZ2VyLCBkaWdfaG90cGx1Z19yZWcsIGhwZF9zcHQsCiAJCQkJICAg
c3B0X3BvcnRfaG90cGx1Z19sb25nX2RldGVjdCk7CiAJfQpAQCAtMjU1OCwxOSArMjU1OCwxOSBA
QCBzdGF0aWMgdm9pZCBzcHRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCB1MzIgcGNoX2lpcikKIAkJZGlnX2hvdHBsdWdfcmVnID0gSTkxNV9SRUFEKFBDSF9Q
T1JUX0hPVFBMVUcyKTsKIAkJSTkxNV9XUklURShQQ0hfUE9SVF9IT1RQTFVHMiwgZGlnX2hvdHBs
dWdfcmVnKTsKIAotCQlpbnRlbF9nZXRfaHBkX3BpbnMoZGV2X3ByaXYsICZwaW5fbWFzaywgJmxv
bmdfbWFzaywKKwkJaW50ZWxfZ2V0X2hwZF9waW5zKGk5MTUsICZwaW5fbWFzaywgJmxvbmdfbWFz
aywKIAkJCQkgICBob3RwbHVnMl90cmlnZ2VyLCBkaWdfaG90cGx1Z19yZWcsIGhwZF9zcHQsCiAJ
CQkJICAgc3B0X3BvcnRfaG90cGx1ZzJfbG9uZ19kZXRlY3QpOwogCX0KIAogCWlmIChwaW5fbWFz
aykKLQkJaW50ZWxfaHBkX2lycV9oYW5kbGVyKGRldl9wcml2LCBwaW5fbWFzaywgbG9uZ19tYXNr
KTsKKwkJaW50ZWxfaHBkX2lycV9oYW5kbGVyKGk5MTUsIHBpbl9tYXNrLCBsb25nX21hc2spOwog
CiAJaWYgKHBjaF9paXIgJiBTREVfR01CVVNfQ1BUKQotCQlnbWJ1c19pcnFfaGFuZGxlcihkZXZf
cHJpdik7CisJCWdtYnVzX2lycV9oYW5kbGVyKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBpbGtf
aHBkX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRp
YyB2b2lkIGlsa19ocGRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkJdTMyIGhvdHBsdWdfdHJpZ2dlciwKIAkJCQljb25zdCB1MzIgaHBkW0hQRF9OVU1fUElO
U10pCiB7CkBAIC0yNTc5LDk0ICsyNTc5LDk0IEBAIHN0YXRpYyB2b2lkIGlsa19ocGRfaXJxX2hh
bmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWRpZ19ob3RwbHVnX3Jl
ZyA9IEk5MTVfUkVBRChESUdJVEFMX1BPUlRfSE9UUExVR19DTlRSTCk7CiAJSTkxNV9XUklURShE
SUdJVEFMX1BPUlRfSE9UUExVR19DTlRSTCwgZGlnX2hvdHBsdWdfcmVnKTsKIAotCWludGVsX2dl
dF9ocGRfcGlucyhkZXZfcHJpdiwgJnBpbl9tYXNrLCAmbG9uZ19tYXNrLCBob3RwbHVnX3RyaWdn
ZXIsCisJaW50ZWxfZ2V0X2hwZF9waW5zKGk5MTUsICZwaW5fbWFzaywgJmxvbmdfbWFzaywgaG90
cGx1Z190cmlnZ2VyLAogCQkJICAgZGlnX2hvdHBsdWdfcmVnLCBocGQsCiAJCQkgICBpbGtfcG9y
dF9ob3RwbHVnX2xvbmdfZGV0ZWN0KTsKIAotCWludGVsX2hwZF9pcnFfaGFuZGxlcihkZXZfcHJp
diwgcGluX21hc2ssIGxvbmdfbWFzayk7CisJaW50ZWxfaHBkX2lycV9oYW5kbGVyKGk5MTUsIHBp
bl9tYXNrLCBsb25nX21hc2spOwogfQogCi1zdGF0aWMgdm9pZCBpbGtfZGlzcGxheV9pcnFfaGFu
ZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbGtf
ZGlzcGxheV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICAgdTMyIGRlX2lpcikKIHsKIAllbnVtIHBpcGUgcGlwZTsKIAl1MzIgaG90cGx1Z190cmlnZ2Vy
ID0gZGVfaWlyICYgREVfRFBfQV9IT1RQTFVHOwogCiAJaWYgKGhvdHBsdWdfdHJpZ2dlcikKLQkJ
aWxrX2hwZF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgaG90cGx1Z190cmlnZ2VyLCBocGRfaWxrKTsK
KwkJaWxrX2hwZF9pcnFfaGFuZGxlcihpOTE1LCBob3RwbHVnX3RyaWdnZXIsIGhwZF9pbGspOwog
CiAJaWYgKGRlX2lpciAmIERFX0FVWF9DSEFOTkVMX0EpCi0JCWRwX2F1eF9pcnFfaGFuZGxlcihk
ZXZfcHJpdik7CisJCWRwX2F1eF9pcnFfaGFuZGxlcihpOTE1KTsKIAogCWlmIChkZV9paXIgJiBE
RV9HU0UpCi0JCWludGVsX29wcmVnaW9uX2FzbGVfaW50cihkZXZfcHJpdik7CisJCWludGVsX29w
cmVnaW9uX2FzbGVfaW50cihpOTE1KTsKIAogCWlmIChkZV9paXIgJiBERV9QT0lTT04pCiAJCURS
TV9FUlJPUigiUG9pc29uIGludGVycnVwdFxuIik7CiAKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2
LCBwaXBlKSB7CisJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKSB7CiAJCWlmIChkZV9paXIgJiBE
RV9QSVBFX1ZCTEFOSyhwaXBlKSkKLQkJCWRybV9oYW5kbGVfdmJsYW5rKCZkZXZfcHJpdi0+ZHJt
LCBwaXBlKTsKKwkJCWRybV9oYW5kbGVfdmJsYW5rKCZpOTE1LT5kcm0sIHBpcGUpOwogCiAJCWlm
IChkZV9paXIgJiBERV9QSVBFX0ZJRk9fVU5ERVJSVU4ocGlwZSkpCi0JCQlpbnRlbF9jcHVfZmlm
b191bmRlcnJ1bl9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGlwZSk7CisJCQlpbnRlbF9jcHVfZmlm
b191bmRlcnJ1bl9pcnFfaGFuZGxlcihpOTE1LCBwaXBlKTsKIAogCQlpZiAoZGVfaWlyICYgREVf
UElQRV9DUkNfRE9ORShwaXBlKSkKLQkJCWk5eHhfcGlwZV9jcmNfaXJxX2hhbmRsZXIoZGV2X3By
aXYsIHBpcGUpOworCQkJaTl4eF9waXBlX2NyY19pcnFfaGFuZGxlcihpOTE1LCBwaXBlKTsKIAl9
CiAKIAkvKiBjaGVjayBldmVudCBmcm9tIFBDSCAqLwogCWlmIChkZV9paXIgJiBERV9QQ0hfRVZF
TlQpIHsKIAkJdTMyIHBjaF9paXIgPSBJOTE1X1JFQUQoU0RFSUlSKTsKIAotCQlpZiAoSEFTX1BD
SF9DUFQoZGV2X3ByaXYpKQotCQkJY3B0X2lycV9oYW5kbGVyKGRldl9wcml2LCBwY2hfaWlyKTsK
KwkJaWYgKEhBU19QQ0hfQ1BUKGk5MTUpKQorCQkJY3B0X2lycV9oYW5kbGVyKGk5MTUsIHBjaF9p
aXIpOwogCQllbHNlCi0JCQlpYnhfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBjaF9paXIpOworCQkJ
aWJ4X2lycV9oYW5kbGVyKGk5MTUsIHBjaF9paXIpOwogCiAJCS8qIHNob3VsZCBjbGVhciBQQ0gg
aG90cGx1ZyBldmVudCBiZWZvcmUgY2xlYXIgQ1BVIGlycSAqLwogCQlJOTE1X1dSSVRFKFNERUlJ
UiwgcGNoX2lpcik7CiAJfQogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgNSkgJiYgZGVfaWlyICYg
REVfUENVX0VWRU5UKQotCQlpcm9ubGFrZV9ycHNfY2hhbmdlX2lycV9oYW5kbGVyKGRldl9wcml2
KTsKKwlpZiAoSVNfR0VOKGk5MTUsIDUpICYmIGRlX2lpciAmIERFX1BDVV9FVkVOVCkKKwkJaXJv
bmxha2VfcnBzX2NoYW5nZV9pcnFfaGFuZGxlcihpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgaXZi
X2Rpc3BsYXlfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgaXZiX2Rpc3BsYXlfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICAgIHUzMiBkZV9paXIpCiB7CiAJZW51bSBwaXBlIHBpcGU7CiAJdTMy
IGhvdHBsdWdfdHJpZ2dlciA9IGRlX2lpciAmIERFX0RQX0FfSE9UUExVR19JVkI7CiAKIAlpZiAo
aG90cGx1Z190cmlnZ2VyKQotCQlpbGtfaHBkX2lycV9oYW5kbGVyKGRldl9wcml2LCBob3RwbHVn
X3RyaWdnZXIsIGhwZF9pdmIpOworCQlpbGtfaHBkX2lycV9oYW5kbGVyKGk5MTUsIGhvdHBsdWdf
dHJpZ2dlciwgaHBkX2l2Yik7CiAKIAlpZiAoZGVfaWlyICYgREVfRVJSX0lOVF9JVkIpCi0JCWl2
Yl9lcnJfaW50X2hhbmRsZXIoZGV2X3ByaXYpOworCQlpdmJfZXJyX2ludF9oYW5kbGVyKGk5MTUp
OwogCiAJaWYgKGRlX2lpciAmIERFX0VEUF9QU1JfSU5UX0hTVykgewogCQl1MzIgcHNyX2lpciA9
IEk5MTVfUkVBRChFRFBfUFNSX0lJUik7CiAKLQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGRldl9w
cml2LCBwc3JfaWlyKTsKKwkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGk5MTUsIHBzcl9paXIpOwog
CQlJOTE1X1dSSVRFKEVEUF9QU1JfSUlSLCBwc3JfaWlyKTsKIAl9CiAKIAlpZiAoZGVfaWlyICYg
REVfQVVYX0NIQU5ORUxfQV9JVkIpCi0JCWRwX2F1eF9pcnFfaGFuZGxlcihkZXZfcHJpdik7CisJ
CWRwX2F1eF9pcnFfaGFuZGxlcihpOTE1KTsKIAogCWlmIChkZV9paXIgJiBERV9HU0VfSVZCKQot
CQlpbnRlbF9vcHJlZ2lvbl9hc2xlX2ludHIoZGV2X3ByaXYpOworCQlpbnRlbF9vcHJlZ2lvbl9h
c2xlX2ludHIoaTkxNSk7CiAKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBwaXBlKSB7CisJZm9y
X2VhY2hfcGlwZShpOTE1LCBwaXBlKSB7CiAJCWlmIChkZV9paXIgJiAoREVfUElQRV9WQkxBTktf
SVZCKHBpcGUpKSkKLQkJCWRybV9oYW5kbGVfdmJsYW5rKCZkZXZfcHJpdi0+ZHJtLCBwaXBlKTsK
KwkJCWRybV9oYW5kbGVfdmJsYW5rKCZpOTE1LT5kcm0sIHBpcGUpOwogCX0KIAogCS8qIGNoZWNr
IGV2ZW50IGZyb20gUENIICovCi0JaWYgKCFIQVNfUENIX05PUChkZXZfcHJpdikgJiYgKGRlX2lp
ciAmIERFX1BDSF9FVkVOVF9JVkIpKSB7CisJaWYgKCFIQVNfUENIX05PUChpOTE1KSAmJiAoZGVf
aWlyICYgREVfUENIX0VWRU5UX0lWQikpIHsKIAkJdTMyIHBjaF9paXIgPSBJOTE1X1JFQUQoU0RF
SUlSKTsKIAotCQljcHRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBjaF9paXIpOworCQljcHRfaXJx
X2hhbmRsZXIoaTkxNSwgcGNoX2lpcik7CiAKIAkJLyogY2xlYXIgUENIIGhvdHBsdWcgZXZlbnQg
YmVmb3JlIGNsZWFyIENQVSBpcnEgKi8KIAkJSTkxNV9XUklURShTREVJSVIsIHBjaF9paXIpOwpA
QCAtMjY4NCwxNSArMjY4NCwxNSBAQCBzdGF0aWMgdm9pZCBpdmJfZGlzcGxheV9pcnFfaGFuZGxl
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgaXJxcmV0dXJuX3Qg
aXJvbmxha2VfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSBhcmc7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShk
ZXYpOwogCXUzMiBkZV9paXIsIGd0X2lpciwgZGVfaWVyLCBzZGVfaWVyID0gMDsKIAlpcnFyZXR1
cm5fdCByZXQgPSBJUlFfTk9ORTsKIAotCWlmICghaW50ZWxfaXJxc19lbmFibGVkKGRldl9wcml2
KSkKKwlpZiAoIWludGVsX2lycXNfZW5hYmxlZChpOTE1KSkKIAkJcmV0dXJuIElSUV9OT05FOwog
CiAJLyogSVJRcyBhcmUgc3luY2VkIGR1cmluZyBydW50aW1lX3N1c3BlbmQsIHdlIGRvbid0IHJl
cXVpcmUgYSB3YWtlcmVmICovCi0JZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGRldl9wcml2
KTsKKwlkaXNhYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAKIAkvKiBkaXNhYmxlIG1h
c3RlciBpbnRlcnJ1cHQgYmVmb3JlIGNsZWFyaW5nIGlpciAgKi8KIAlkZV9pZXIgPSBJOTE1X1JF
QUQoREVJRVIpOwpAQCAtMjcwMyw3ICsyNzAzLDcgQEAgc3RhdGljIGlycXJldHVybl90IGlyb25s
YWtlX2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKIAkgKiBhYmxlIHRvIHByb2Nlc3Mg
dGhlbSBhZnRlciB3ZSByZXN0b3JlIFNERUlFUiAoYXMgc29vbiBhcyB3ZSByZXN0b3JlCiAJICog
aXQsIHdlJ2xsIGdldCBhbiBpbnRlcnJ1cHQgaWYgU0RFSUlSIHN0aWxsIGhhcyBzb21ldGhpbmcg
dG8gcHJvY2VzcwogCSAqIGR1ZSB0byBpdHMgYmFjayBxdWV1ZSkuICovCi0JaWYgKCFIQVNfUENI
X05PUChkZXZfcHJpdikpIHsKKwlpZiAoIUhBU19QQ0hfTk9QKGk5MTUpKSB7CiAJCXNkZV9pZXIg
PSBJOTE1X1JFQUQoU0RFSUVSKTsKIAkJSTkxNV9XUklURShTREVJRVIsIDApOwogCX0KQEAgLTI3
MTQsNDIgKzI3MTQsNDIgQEAgc3RhdGljIGlycXJldHVybl90IGlyb25sYWtlX2lycV9oYW5kbGVy
KGludCBpcnEsIHZvaWQgKmFyZykKIAlpZiAoZ3RfaWlyKSB7CiAJCUk5MTVfV1JJVEUoR1RJSVIs
IGd0X2lpcik7CiAJCXJldCA9IElSUV9IQU5ETEVEOwotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA2KQotCQkJc25iX2d0X2lycV9oYW5kbGVyKGRldl9wcml2LCBndF9paXIpOworCQlpZiAo
SU5URUxfR0VOKGk5MTUpID49IDYpCisJCQlzbmJfZ3RfaXJxX2hhbmRsZXIoaTkxNSwgZ3RfaWly
KTsKIAkJZWxzZQotCQkJaWxrX2d0X2lycV9oYW5kbGVyKGRldl9wcml2LCBndF9paXIpOworCQkJ
aWxrX2d0X2lycV9oYW5kbGVyKGk5MTUsIGd0X2lpcik7CiAJfQogCiAJZGVfaWlyID0gSTkxNV9S
RUFEKERFSUlSKTsKIAlpZiAoZGVfaWlyKSB7CiAJCUk5MTVfV1JJVEUoREVJSVIsIGRlX2lpcik7
CiAJCXJldCA9IElSUV9IQU5ETEVEOwotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA3KQot
CQkJaXZiX2Rpc3BsYXlfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIGRlX2lpcik7CisJCWlmIChJTlRF
TF9HRU4oaTkxNSkgPj0gNykKKwkJCWl2Yl9kaXNwbGF5X2lycV9oYW5kbGVyKGk5MTUsIGRlX2lp
cik7CiAJCWVsc2UKLQkJCWlsa19kaXNwbGF5X2lycV9oYW5kbGVyKGRldl9wcml2LCBkZV9paXIp
OworCQkJaWxrX2Rpc3BsYXlfaXJxX2hhbmRsZXIoaTkxNSwgZGVfaWlyKTsKIAl9CiAKLQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA2KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KSB7
CiAJCXUzMiBwbV9paXIgPSBJOTE1X1JFQUQoR0VONl9QTUlJUik7CiAJCWlmIChwbV9paXIpIHsK
IAkJCUk5MTVfV1JJVEUoR0VONl9QTUlJUiwgcG1faWlyKTsKIAkJCXJldCA9IElSUV9IQU5ETEVE
OwotCQkJZ2VuNl9ycHNfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBtX2lpcik7CisJCQlnZW42X3Jw
c19pcnFfaGFuZGxlcihpOTE1LCBwbV9paXIpOwogCQl9CiAJfQogCiAJSTkxNV9XUklURShERUlF
UiwgZGVfaWVyKTsKLQlpZiAoIUhBU19QQ0hfTk9QKGRldl9wcml2KSkKKwlpZiAoIUhBU19QQ0hf
Tk9QKGk5MTUpKQogCQlJOTE1X1dSSVRFKFNERUlFUiwgc2RlX2llcik7CiAKIAkvKiBJUlFzIGFy
ZSBzeW5jZWQgZHVyaW5nIHJ1bnRpbWVfc3VzcGVuZCwgd2UgZG9uJ3QgcmVxdWlyZSBhIHdha2Vy
ZWYgKi8KLQllbmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7CisJZW5hYmxlX3Jw
bV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9p
ZCBieHRfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyB2b2lkIGJ4dF9ocGRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkJdTMyIGhvdHBsdWdfdHJpZ2dlciwKIAkJCQljb25zdCB1MzIgaHBkW0hQRF9O
VU1fUElOU10pCiB7CkBAIC0yNzU4LDE0ICsyNzU4LDE0IEBAIHN0YXRpYyB2b2lkIGJ4dF9ocGRf
aXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWRpZ19ob3Rw
bHVnX3JlZyA9IEk5MTVfUkVBRChQQ0hfUE9SVF9IT1RQTFVHKTsKIAlJOTE1X1dSSVRFKFBDSF9Q
T1JUX0hPVFBMVUcsIGRpZ19ob3RwbHVnX3JlZyk7CiAKLQlpbnRlbF9nZXRfaHBkX3BpbnMoZGV2
X3ByaXYsICZwaW5fbWFzaywgJmxvbmdfbWFzaywgaG90cGx1Z190cmlnZ2VyLAorCWludGVsX2dl
dF9ocGRfcGlucyhpOTE1LCAmcGluX21hc2ssICZsb25nX21hc2ssIGhvdHBsdWdfdHJpZ2dlciwK
IAkJCSAgIGRpZ19ob3RwbHVnX3JlZywgaHBkLAogCQkJICAgYnh0X3BvcnRfaG90cGx1Z19sb25n
X2RldGVjdCk7CiAKLQlpbnRlbF9ocGRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBpbl9tYXNrLCBs
b25nX21hc2spOworCWludGVsX2hwZF9pcnFfaGFuZGxlcihpOTE1LCBwaW5fbWFzaywgbG9uZ19t
YXNrKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuMTFfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGlpcikKK3N0YXRpYyB2b2lkIGdlbjExX2hwZF9p
cnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIGlpcikKIHsKIAl1
MzIgcGluX21hc2sgPSAwLCBsb25nX21hc2sgPSAwOwogCXUzMiB0cmlnZ2VyX3RjID0gaWlyICYg
R0VOMTFfREVfVENfSE9UUExVR19NQVNLOwpAQCAtMjc3Nyw3ICsyNzc3LDcgQEAgc3RhdGljIHZv
aWQgZ2VuMTFfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgdTMyIGlpcikKIAkJZGlnX2hvdHBsdWdfcmVnID0gSTkxNV9SRUFEKEdFTjExX1RDX0hPVFBM
VUdfQ1RMKTsKIAkJSTkxNV9XUklURShHRU4xMV9UQ19IT1RQTFVHX0NUTCwgZGlnX2hvdHBsdWdf
cmVnKTsKIAotCQlpbnRlbF9nZXRfaHBkX3BpbnMoZGV2X3ByaXYsICZwaW5fbWFzaywgJmxvbmdf
bWFzaywgdHJpZ2dlcl90YywKKwkJaW50ZWxfZ2V0X2hwZF9waW5zKGk5MTUsICZwaW5fbWFzaywg
JmxvbmdfbWFzaywgdHJpZ2dlcl90YywKIAkJCQkgICBkaWdfaG90cGx1Z19yZWcsIGhwZF9nZW4x
MSwKIAkJCQkgICBnZW4xMV9wb3J0X2hvdHBsdWdfbG9uZ19kZXRlY3QpOwogCX0KQEAgLTI3ODgs
MzAgKzI3ODgsMzAgQEAgc3RhdGljIHZvaWQgZ2VuMTFfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGlpcikKIAkJZGlnX2hvdHBsdWdfcmVnID0g
STkxNV9SRUFEKEdFTjExX1RCVF9IT1RQTFVHX0NUTCk7CiAJCUk5MTVfV1JJVEUoR0VOMTFfVEJU
X0hPVFBMVUdfQ1RMLCBkaWdfaG90cGx1Z19yZWcpOwogCi0JCWludGVsX2dldF9ocGRfcGlucyhk
ZXZfcHJpdiwgJnBpbl9tYXNrLCAmbG9uZ19tYXNrLCB0cmlnZ2VyX3RidCwKKwkJaW50ZWxfZ2V0
X2hwZF9waW5zKGk5MTUsICZwaW5fbWFzaywgJmxvbmdfbWFzaywgdHJpZ2dlcl90YnQsCiAJCQkJ
ICAgZGlnX2hvdHBsdWdfcmVnLCBocGRfZ2VuMTEsCiAJCQkJICAgZ2VuMTFfcG9ydF9ob3RwbHVn
X2xvbmdfZGV0ZWN0KTsKIAl9CiAKIAlpZiAocGluX21hc2spCi0JCWludGVsX2hwZF9pcnFfaGFu
ZGxlcihkZXZfcHJpdiwgcGluX21hc2ssIGxvbmdfbWFzayk7CisJCWludGVsX2hwZF9pcnFfaGFu
ZGxlcihpOTE1LCBwaW5fbWFzaywgbG9uZ19tYXNrKTsKIAllbHNlCiAJCURSTV9FUlJPUigiVW5l
eHBlY3RlZCBERSBIUEQgaW50ZXJydXB0IDB4JTA4eFxuIiwgaWlyKTsKIH0KIAotc3RhdGljIHUz
MiBnZW44X2RlX3BvcnRfYXV4X21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHUzMiBnZW44X2RlX3BvcnRfYXV4X21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7CiAJdTMyIG1hc2sgPSBHRU44X0FVWF9DSEFOTkVMX0E7CiAKLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA5KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJbWFz
ayB8PSBHRU45X0FVWF9DSEFOTkVMX0IgfAogCQkJR0VOOV9BVVhfQ0hBTk5FTF9DIHwKIAkJCUdF
TjlfQVVYX0NIQU5ORUxfRDsKIAotCWlmIChJU19DTkxfV0lUSF9QT1JUX0YoZGV2X3ByaXYpKQor
CWlmIChJU19DTkxfV0lUSF9QT1JUX0YoaTkxNSkpCiAJCW1hc2sgfD0gQ05MX0FVWF9DSEFOTkVM
X0Y7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGk5
MTUpID49IDExKQogCQltYXNrIHw9IElDTF9BVVhfQ0hBTk5FTF9FIHwKIAkJCUNOTF9BVVhfQ0hB
Tk5FTF9GOwogCkBAIC0yODE5LDcgKzI4MTksNyBAQCBzdGF0aWMgdTMyIGdlbjhfZGVfcG9ydF9h
dXhfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB9CiAKIHN0YXRpYyBp
cnFyZXR1cm5fdAotZ2VuOF9kZV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIHUzMiBtYXN0ZXJfY3RsKQorZ2VuOF9kZV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIG1hc3Rlcl9jdGwpCiB7CiAJaXJxcmV0dXJuX3QgcmV0
ID0gSVJRX05PTkU7CiAJdTMyIGlpcjsKQEAgLTI4MzQsMTQgKzI4MzQsMTQgQEAgZ2VuOF9kZV9p
cnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBtYXN0ZXJf
Y3RsKQogCQkJcmV0ID0gSVJRX0hBTkRMRUQ7CiAKIAkJCWlmIChpaXIgJiBHRU44X0RFX01JU0Nf
R1NFKSB7Ci0JCQkJaW50ZWxfb3ByZWdpb25fYXNsZV9pbnRyKGRldl9wcml2KTsKKwkJCQlpbnRl
bF9vcHJlZ2lvbl9hc2xlX2ludHIoaTkxNSk7CiAJCQkJZm91bmQgPSB0cnVlOwogCQkJfQogCiAJ
CQlpZiAoaWlyICYgR0VOOF9ERV9FRFBfUFNSKSB7CiAJCQkJdTMyIHBzcl9paXIgPSBJOTE1X1JF
QUQoRURQX1BTUl9JSVIpOwogCi0JCQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGRldl9wcml2LCBw
c3JfaWlyKTsKKwkJCQlpbnRlbF9wc3JfaXJxX2hhbmRsZXIoaTkxNSwgcHNyX2lpcik7CiAJCQkJ
STkxNV9XUklURShFRFBfUFNSX0lJUiwgcHNyX2lpcik7CiAJCQkJZm91bmQgPSB0cnVlOwogCQkJ
fQpAQCAtMjg1MywxMiArMjg1MywxMiBAQCBnZW44X2RlX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIG1hc3Rlcl9jdGwpCiAJCQlEUk1fRVJST1IoIlRo
ZSBtYXN0ZXIgY29udHJvbCBpbnRlcnJ1cHQgbGllZCAoREUgTUlTQykhXG4iKTsKIAl9CiAKLQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiAobWFzdGVyX2N0bCAmIEdFTjExX0RFX0hQ
RF9JUlEpKSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSAmJiAobWFzdGVyX2N0bCAmIEdF
TjExX0RFX0hQRF9JUlEpKSB7CiAJCWlpciA9IEk5MTVfUkVBRChHRU4xMV9ERV9IUERfSUlSKTsK
IAkJaWYgKGlpcikgewogCQkJSTkxNV9XUklURShHRU4xMV9ERV9IUERfSUlSLCBpaXIpOwogCQkJ
cmV0ID0gSVJRX0hBTkRMRUQ7Ci0JCQlnZW4xMV9ocGRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIGlp
cik7CisJCQlnZW4xMV9ocGRfaXJxX2hhbmRsZXIoaTkxNSwgaWlyKTsKIAkJfSBlbHNlIHsKIAkJ
CURSTV9FUlJPUigiVGhlIG1hc3RlciBjb250cm9sIGludGVycnVwdCBsaWVkLCAoREUgSFBEKSFc
biIpOwogCQl9CkBAIC0yODczLDI5ICsyODczLDI5IEBAIGdlbjhfZGVfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgbWFzdGVyX2N0bCkKIAkJCUk5MTVf
V1JJVEUoR0VOOF9ERV9QT1JUX0lJUiwgaWlyKTsKIAkJCXJldCA9IElSUV9IQU5ETEVEOwogCi0J
CQlpZiAoaWlyICYgZ2VuOF9kZV9wb3J0X2F1eF9tYXNrKGRldl9wcml2KSkgewotCQkJCWRwX2F1
eF9pcnFfaGFuZGxlcihkZXZfcHJpdik7CisJCQlpZiAoaWlyICYgZ2VuOF9kZV9wb3J0X2F1eF9t
YXNrKGk5MTUpKSB7CisJCQkJZHBfYXV4X2lycV9oYW5kbGVyKGk5MTUpOwogCQkJCWZvdW5kID0g
dHJ1ZTsKIAkJCX0KIAotCQkJaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7CisJCQlpZiAoSVNf
R0VOOV9MUChpOTE1KSkgewogCQkJCXRtcF9tYXNrID0gaWlyICYgQlhUX0RFX1BPUlRfSE9UUExV
R19NQVNLOwogCQkJCWlmICh0bXBfbWFzaykgewotCQkJCQlieHRfaHBkX2lycV9oYW5kbGVyKGRl
dl9wcml2LCB0bXBfbWFzaywKKwkJCQkJYnh0X2hwZF9pcnFfaGFuZGxlcihpOTE1LCB0bXBfbWFz
aywKIAkJCQkJCQkgICAgaHBkX2J4dCk7CiAJCQkJCWZvdW5kID0gdHJ1ZTsKIAkJCQl9Ci0JCQl9
IGVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKKwkJCX0gZWxzZSBpZiAoSVNfQlJP
QURXRUxMKGk5MTUpKSB7CiAJCQkJdG1wX21hc2sgPSBpaXIgJiBHRU44X1BPUlRfRFBfQV9IT1RQ
TFVHOwogCQkJCWlmICh0bXBfbWFzaykgewotCQkJCQlpbGtfaHBkX2lycV9oYW5kbGVyKGRldl9w
cml2LAorCQkJCQlpbGtfaHBkX2lycV9oYW5kbGVyKGk5MTUsCiAJCQkJCQkJICAgIHRtcF9tYXNr
LCBocGRfYmR3KTsKIAkJCQkJZm91bmQgPSB0cnVlOwogCQkJCX0KIAkJCX0KIAotCQkJaWYgKElT
X0dFTjlfTFAoZGV2X3ByaXYpICYmIChpaXIgJiBCWFRfREVfUE9SVF9HTUJVUykpIHsKLQkJCQln
bWJ1c19pcnFfaGFuZGxlcihkZXZfcHJpdik7CisJCQlpZiAoSVNfR0VOOV9MUChpOTE1KSAmJiAo
aWlyICYgQlhUX0RFX1BPUlRfR01CVVMpKSB7CisJCQkJZ21idXNfaXJxX2hhbmRsZXIoaTkxNSk7
CiAJCQkJZm91bmQgPSB0cnVlOwogCQkJfQogCkBAIC0yOTA2LDcgKzI5MDYsNyBAQCBnZW44X2Rl
X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIG1hc3Rl
cl9jdGwpCiAJCQlEUk1fRVJST1IoIlRoZSBtYXN0ZXIgY29udHJvbCBpbnRlcnJ1cHQgbGllZCAo
REUgUE9SVCkhXG4iKTsKIAl9CiAKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBwaXBlKSB7CisJ
Zm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKSB7CiAJCXUzMiBmYXVsdF9lcnJvcnM7CiAKIAkJaWYg
KCEobWFzdGVyX2N0bCAmIEdFTjhfREVfUElQRV9JUlEocGlwZSkpKQpAQCAtMjkyMiwxNiArMjky
MiwxNiBAQCBnZW44X2RlX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgdTMyIG1hc3Rlcl9jdGwpCiAJCUk5MTVfV1JJVEUoR0VOOF9ERV9QSVBFX0lJUihwaXBl
KSwgaWlyKTsKIAogCQlpZiAoaWlyICYgR0VOOF9QSVBFX1ZCTEFOSykKLQkJCWRybV9oYW5kbGVf
dmJsYW5rKCZkZXZfcHJpdi0+ZHJtLCBwaXBlKTsKKwkJCWRybV9oYW5kbGVfdmJsYW5rKCZpOTE1
LT5kcm0sIHBpcGUpOwogCiAJCWlmIChpaXIgJiBHRU44X1BJUEVfQ0RDTEtfQ1JDX0RPTkUpCi0J
CQloc3dfcGlwZV9jcmNfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBpcGUpOworCQkJaHN3X3BpcGVf
Y3JjX2lycV9oYW5kbGVyKGk5MTUsIHBpcGUpOwogCiAJCWlmIChpaXIgJiBHRU44X1BJUEVfRklG
T19VTkRFUlJVTikKLQkJCWludGVsX2NwdV9maWZvX3VuZGVycnVuX2lycV9oYW5kbGVyKGRldl9w
cml2LCBwaXBlKTsKKwkJCWludGVsX2NwdV9maWZvX3VuZGVycnVuX2lycV9oYW5kbGVyKGk5MTUs
IHBpcGUpOwogCiAJCWZhdWx0X2Vycm9ycyA9IGlpcjsKLQkJaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gOSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQkJZmF1bHRfZXJyb3JzICY9
IEdFTjlfREVfUElQRV9JUlFfRkFVTFRfRVJST1JTOwogCQllbHNlCiAJCQlmYXVsdF9lcnJvcnMg
Jj0gR0VOOF9ERV9QSVBFX0lSUV9GQVVMVF9FUlJPUlM7CkBAIC0yOTQyLDcgKzI5NDIsNyBAQCBn
ZW44X2RlX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMy
IG1hc3Rlcl9jdGwpCiAJCQkJICBmYXVsdF9lcnJvcnMpOwogCX0KIAotCWlmIChIQVNfUENIX1NQ
TElUKGRldl9wcml2KSAmJiAhSEFTX1BDSF9OT1AoZGV2X3ByaXYpICYmCisJaWYgKEhBU19QQ0hf
U1BMSVQoaTkxNSkgJiYgIUhBU19QQ0hfTk9QKGk5MTUpICYmCiAJICAgIG1hc3Rlcl9jdGwgJiBH
RU44X0RFX1BDSF9JUlEpIHsKIAkJLyoKIAkJICogRklYTUUoQkRXKTogQXNzdW1lIGZvciBub3cg
dGhhdCB0aGUgbmV3IGludGVycnVwdCBoYW5kbGluZwpAQCAtMjk1NCwxMiArMjk1NCwxMiBAQCBn
ZW44X2RlX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMy
IG1hc3Rlcl9jdGwpCiAJCQlJOTE1X1dSSVRFKFNERUlJUiwgaWlyKTsKIAkJCXJldCA9IElSUV9I
QU5ETEVEOwogCi0JCQlpZiAoSU5URUxfUENIX1RZUEUoZGV2X3ByaXYpID49IFBDSF9JQ1ApCi0J
CQkJaWNwX2lycV9oYW5kbGVyKGRldl9wcml2LCBpaXIpOwotCQkJZWxzZSBpZiAoSU5URUxfUENI
X1RZUEUoZGV2X3ByaXYpID49IFBDSF9TUFQpCi0JCQkJc3B0X2lycV9oYW5kbGVyKGRldl9wcml2
LCBpaXIpOworCQkJaWYgKElOVEVMX1BDSF9UWVBFKGk5MTUpID49IFBDSF9JQ1ApCisJCQkJaWNw
X2lycV9oYW5kbGVyKGk5MTUsIGlpcik7CisJCQllbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShpOTE1
KSA+PSBQQ0hfU1BUKQorCQkJCXNwdF9pcnFfaGFuZGxlcihpOTE1LCBpaXIpOwogCQkJZWxzZQot
CQkJCWNwdF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgaWlyKTsKKwkJCQljcHRfaXJxX2hhbmRsZXIo
aTkxNSwgaWlyKTsKIAkJfSBlbHNlIHsKIAkJCS8qCiAJCQkgKiBMaWtlIG9uIHByZXZpb3VzIFBD
SCB0aGVyZSBzZWVtcyB0byBiZSBzb21ldGhpbmcKQEAgLTI5OTIsMTIgKzI5OTIsMTIgQEAgc3Rh
dGljIGlubGluZSB2b2lkIGdlbjhfbWFzdGVyX2ludHJfZW5hYmxlKHZvaWQgX19pb21lbSAqIGNv
bnN0IHJlZ3MpCiAKIHN0YXRpYyBpcnFyZXR1cm5fdCBnZW44X2lycV9oYW5kbGVyKGludCBpcnEs
IHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGFyZyk7Ci0Jdm9pZCBfX2lvbWVtICogY29uc3QgcmVncyA9IGRldl9wcml2LT51bmNvcmUu
cmVnczsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoYXJnKTsKKwl2
b2lkIF9faW9tZW0gKiBjb25zdCByZWdzID0gaTkxNS0+dW5jb3JlLnJlZ3M7CiAJdTMyIG1hc3Rl
cl9jdGw7CiAJdTMyIGd0X2lpcls0XTsKIAotCWlmICghaW50ZWxfaXJxc19lbmFibGVkKGRldl9w
cml2KSkKKwlpZiAoIWludGVsX2lycXNfZW5hYmxlZChpOTE1KSkKIAkJcmV0dXJuIElSUV9OT05F
OwogCiAJbWFzdGVyX2N0bCA9IGdlbjhfbWFzdGVyX2ludHJfZGlzYWJsZShyZWdzKTsKQEAgLTMw
MDcsMTggKzMwMDcsMTggQEAgc3RhdGljIGlycXJldHVybl90IGdlbjhfaXJxX2hhbmRsZXIoaW50
IGlycSwgdm9pZCAqYXJnKQogCX0KIAogCS8qIEZpbmQsIGNsZWFyLCB0aGVuIHByb2Nlc3MgZWFj
aCBzb3VyY2Ugb2YgaW50ZXJydXB0ICovCi0JZ2VuOF9ndF9pcnFfYWNrKGRldl9wcml2LCBtYXN0
ZXJfY3RsLCBndF9paXIpOworCWdlbjhfZ3RfaXJxX2FjayhpOTE1LCBtYXN0ZXJfY3RsLCBndF9p
aXIpOwogCiAJLyogSVJRcyBhcmUgc3luY2VkIGR1cmluZyBydW50aW1lX3N1c3BlbmQsIHdlIGRv
bid0IHJlcXVpcmUgYSB3YWtlcmVmICovCiAJaWYgKG1hc3Rlcl9jdGwgJiB+R0VOOF9HVF9JUlFT
KSB7Ci0JCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7Ci0JCWdlbjhfZGVf
aXJxX2hhbmRsZXIoZGV2X3ByaXYsIG1hc3Rlcl9jdGwpOwotCQllbmFibGVfcnBtX3dha2VyZWZf
YXNzZXJ0cyhkZXZfcHJpdik7CisJCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhpOTE1KTsK
KwkJZ2VuOF9kZV9pcnFfaGFuZGxlcihpOTE1LCBtYXN0ZXJfY3RsKTsKKwkJZW5hYmxlX3JwbV93
YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAJfQogCiAJZ2VuOF9tYXN0ZXJfaW50cl9lbmFibGUocmVn
cyk7CiAKLQlnZW44X2d0X2lycV9oYW5kbGVyKGRldl9wcml2LCBtYXN0ZXJfY3RsLCBndF9paXIp
OworCWdlbjhfZ3RfaXJxX2hhbmRsZXIoaTkxNSwgbWFzdGVyX2N0bCwgZ3RfaWlyKTsKIAogCXJl
dHVybiBJUlFfSEFORExFRDsKIH0KQEAgLTMxNDksOSArMzE0OSw5IEBAIGdlbjExX2d0X2lycV9o
YW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICogY29uc3QgaTkxNSwKIH0KIAogc3RhdGlj
IHUzMgotZ2VuMTFfZ3VfbWlzY19pcnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgY29uc3QgdTMyIG1hc3Rlcl9jdGwpCitnZW4xMV9ndV9taXNjX2lycV9hY2soc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGNvbnN0IHUzMiBtYXN0ZXJfY3RsKQogewotCXZvaWQg
X19pb21lbSAqIGNvbnN0IHJlZ3MgPSBkZXZfcHJpdi0+dW5jb3JlLnJlZ3M7CisJdm9pZCBfX2lv
bWVtICogY29uc3QgcmVncyA9IGk5MTUtPnVuY29yZS5yZWdzOwogCXUzMiBpaXI7CiAKIAlpZiAo
IShtYXN0ZXJfY3RsICYgR0VOMTFfR1VfTUlTQ19JUlEpKQpAQCAtMzE2NSwxMCArMzE2NSwxMCBA
QCBnZW4xMV9ndV9taXNjX2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBjb25zdCB1MzIgbWFzdGVyX2N0bCkKIH0KIAogc3RhdGljIHZvaWQKLWdlbjExX2d1X21pc2Nf
aXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCB1MzIg
aWlyKQorZ2VuMTFfZ3VfbWlzY19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwgY29uc3QgdTMyIGlpcikKIHsKIAlpZiAoaWlyICYgR0VOMTFfR1VfTUlTQ19HU0UpCi0J
CWludGVsX29wcmVnaW9uX2FzbGVfaW50cihkZXZfcHJpdik7CisJCWludGVsX29wcmVnaW9uX2Fz
bGVfaW50cihpOTE1KTsKIH0KIAogc3RhdGljIGlubGluZSB1MzIgZ2VuMTFfbWFzdGVyX2ludHJf
ZGlzYWJsZSh2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzKQpAQCAtMzIzNSw1NCArMzIzNSw1NCBA
QCBzdGF0aWMgaXJxcmV0dXJuX3QgZ2VuMTFfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJn
KQogICovCiBzdGF0aWMgaW50IGk4eHhfZW5hYmxlX3ZibGFuayhzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsKIAotCXNwaW5fbG9ja19pcnFz
YXZlKCZkZXZfcHJpdi0+aXJxX2xvY2ssIGlycWZsYWdzKTsKLQlpOTE1X2VuYWJsZV9waXBlc3Rh
dChkZXZfcHJpdiwgcGlwZSwgUElQRV9WQkxBTktfSU5URVJSVVBUX1NUQVRVUyk7Ci0Jc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl9s
b2NrX2lycXNhdmUoJmk5MTUtPmlycV9sb2NrLCBpcnFmbGFncyk7CisJaTkxNV9lbmFibGVfcGlw
ZXN0YXQoaTkxNSwgcGlwZSwgUElQRV9WQkxBTktfSU5URVJSVVBUX1NUQVRVUyk7CisJc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+aXJxX2xvY2ssIGlycWZsYWdzKTsKIAogCXJldHVybiAw
OwogfQogCiBzdGF0aWMgaW50IGk5NDVnbV9lbmFibGVfdmJsYW5rKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHVuc2lnbmVkIGludCBwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGV2KTsKIAotCWlmIChkZXZfcHJpdi0+aTk0NWdtX3ZibGFuay5lbmFibGVkKysg
PT0gMCkKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPmk5NDVnbV92Ymxhbmsud29yayk7CisJ
aWYgKGk5MTUtPmk5NDVnbV92YmxhbmsuZW5hYmxlZCsrID09IDApCisJCXNjaGVkdWxlX3dvcmso
Jmk5MTUtPmk5NDVnbV92Ymxhbmsud29yayk7CiAKIAlyZXR1cm4gaTh4eF9lbmFibGVfdmJsYW5r
KGRldiwgcGlwZSk7CiB9CiAKIHN0YXRpYyBpbnQgaTk2NV9lbmFibGVfdmJsYW5rKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCBwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwogCi0Jc3Bp
bl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT5pcnFfbG9jaywgaXJxZmxhZ3MpOwotCWk5MTVfZW5h
YmxlX3BpcGVzdGF0KGRldl9wcml2LCBwaXBlLAorCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5p
cnFfbG9jaywgaXJxZmxhZ3MpOworCWk5MTVfZW5hYmxlX3BpcGVzdGF0KGk5MTUsIHBpcGUsCiAJ
CQkgICAgIFBJUEVfU1RBUlRfVkJMQU5LX0lOVEVSUlVQVF9TVEFUVVMpOwotCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmRldl9wcml2LT5pcnFfbG9jaywgaXJxZmxhZ3MpOworCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmk5MTUtPmlycV9sb2NrLCBpcnFmbGFncyk7CiAKIAlyZXR1cm4gMDsKIH0K
IAogc3RhdGljIGludCBpcm9ubGFrZV9lbmFibGVfdmJsYW5rKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHVuc2lnbmVkIGludCBwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoZGV2KTsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwotCXUzMiBiaXQgPSBJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDcgPworCXUzMiBiaXQgPSBJTlRFTF9HRU4oaTkxNSkgPj0gNyA/CiAJ
CURFX1BJUEVfVkJMQU5LX0lWQihwaXBlKSA6IERFX1BJUEVfVkJMQU5LKHBpcGUpOwogCi0Jc3Bp
bl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT5pcnFfbG9jaywgaXJxZmxhZ3MpOwotCWlsa19lbmFi
bGVfZGlzcGxheV9pcnEoZGV2X3ByaXYsIGJpdCk7Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
ZGV2X3ByaXYtPmlycV9sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUt
PmlycV9sb2NrLCBpcnFmbGFncyk7CisJaWxrX2VuYWJsZV9kaXNwbGF5X2lycShpOTE1LCBiaXQp
OworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPmlycV9sb2NrLCBpcnFmbGFncyk7CiAK
IAkvKiBFdmVuIHRob3VnaCB0aGVyZSBpcyBubyBETUMsIGZyYW1lIGNvdW50ZXIgY2FuIGdldCBz
dHVjayB3aGVuCiAJICogUFNSIGlzIGFjdGl2ZSBhcyBubyBmcmFtZXMgYXJlIGdlbmVyYXRlZC4K
IAkgKi8KLQlpZiAoSEFTX1BTUihkZXZfcHJpdikpCisJaWYgKEhBU19QU1IoaTkxNSkpCiAJCWRy
bV92YmxhbmtfcmVzdG9yZShkZXYsIHBpcGUpOwogCiAJcmV0dXJuIDA7CkBAIC0zMjkwLDE3ICsz
MjkwLDE3IEBAIHN0YXRpYyBpbnQgaXJvbmxha2VfZW5hYmxlX3ZibGFuayhzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSkKIAogc3RhdGljIGludCBnZW44X2VuYWJsZV92
Ymxhbmsoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXVuc2lnbmVkIGxvbmcgaXJx
ZmxhZ3M7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBpcnFmbGFn
cyk7Ci0JYmR3X2VuYWJsZV9waXBlX2lycShkZXZfcHJpdiwgcGlwZSwgR0VOOF9QSVBFX1ZCTEFO
Syk7Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBpcnFmbGFn
cyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPmlycV9sb2NrLCBpcnFmbGFncyk7CisJYmR3
X2VuYWJsZV9waXBlX2lycShpOTE1LCBwaXBlLCBHRU44X1BJUEVfVkJMQU5LKTsKKwlzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZpOTE1LT5pcnFfbG9jaywgaXJxZmxhZ3MpOwogCiAJLyogRXZlbiBp
ZiB0aGVyZSBpcyBubyBETUMsIGZyYW1lIGNvdW50ZXIgY2FuIGdldCBzdHVjayB3aGVuCiAJICog
UFNSIGlzIGFjdGl2ZSBhcyBubyBmcmFtZXMgYXJlIGdlbmVyYXRlZCwgc28gY2hlY2sgb25seSBm
b3IgUFNSLgogCSAqLwotCWlmIChIQVNfUFNSKGRldl9wcml2KSkKKwlpZiAoSEFTX1BTUihpOTE1
KSkKIAkJZHJtX3ZibGFua19yZXN0b3JlKGRldiwgcGlwZSk7CiAKIAlyZXR1cm4gMDsKQEAgLTMz
MTEsNjAgKzMzMTEsNjAgQEAgc3RhdGljIGludCBnZW44X2VuYWJsZV92Ymxhbmsoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpCiAgKi8KIHN0YXRpYyB2b2lkIGk4eHhf
ZGlzYWJsZV92Ymxhbmsoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXVuc2lnbmVk
IGxvbmcgaXJxZmxhZ3M7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPmlycV9sb2Nr
LCBpcnFmbGFncyk7Ci0JaTkxNV9kaXNhYmxlX3BpcGVzdGF0KGRldl9wcml2LCBwaXBlLCBQSVBF
X1ZCTEFOS19JTlRFUlJVUFRfU1RBVFVTKTsKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZf
cHJpdi0+aXJxX2xvY2ssIGlycWZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+aXJx
X2xvY2ssIGlycWZsYWdzKTsKKwlpOTE1X2Rpc2FibGVfcGlwZXN0YXQoaTkxNSwgcGlwZSwgUElQ
RV9WQkxBTktfSU5URVJSVVBUX1NUQVRVUyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkx
NS0+aXJxX2xvY2ssIGlycWZsYWdzKTsKIH0KIAogc3RhdGljIHZvaWQgaTk0NWdtX2Rpc2FibGVf
dmJsYW5rKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCBwaXBlKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAogCWk4eHhfZGlzYWJsZV92
YmxhbmsoZGV2LCBwaXBlKTsKIAotCWlmICgtLWRldl9wcml2LT5pOTQ1Z21fdmJsYW5rLmVuYWJs
ZWQgPT0gMCkKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPmk5NDVnbV92Ymxhbmsud29yayk7
CisJaWYgKC0taTkxNS0+aTk0NWdtX3ZibGFuay5lbmFibGVkID09IDApCisJCXNjaGVkdWxlX3dv
cmsoJmk5MTUtPmk5NDVnbV92Ymxhbmsud29yayk7CiB9CiAKIHN0YXRpYyB2b2lkIGk5NjVfZGlz
YWJsZV92Ymxhbmsoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXVuc2lnbmVkIGxv
bmcgaXJxZmxhZ3M7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBp
cnFmbGFncyk7Ci0JaTkxNV9kaXNhYmxlX3BpcGVzdGF0KGRldl9wcml2LCBwaXBlLAorCXNwaW5f
bG9ja19pcnFzYXZlKCZpOTE1LT5pcnFfbG9jaywgaXJxZmxhZ3MpOworCWk5MTVfZGlzYWJsZV9w
aXBlc3RhdChpOTE1LCBwaXBlLAogCQkJICAgICAgUElQRV9TVEFSVF9WQkxBTktfSU5URVJSVVBU
X1NUQVRVUyk7Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBp
cnFmbGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+aXJxX2xvY2ssIGlycWZs
YWdzKTsKIH0KIAogc3RhdGljIHZvaWQgaXJvbmxha2VfZGlzYWJsZV92Ymxhbmsoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdW5zaWduZWQgaW50IHBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShkZXYpOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7Ci0JdTMyIGJp
dCA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gNyA/CisJdTMyIGJpdCA9IElOVEVMX0dFTihpOTE1
KSA+PSA3ID8KIAkJREVfUElQRV9WQkxBTktfSVZCKHBpcGUpIDogREVfUElQRV9WQkxBTksocGlw
ZSk7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBpcnFmbGFncyk7
Ci0JaWxrX2Rpc2FibGVfZGlzcGxheV9pcnEoZGV2X3ByaXYsIGJpdCk7Ci0Jc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl9sb2NrX2ly
cXNhdmUoJmk5MTUtPmlycV9sb2NrLCBpcnFmbGFncyk7CisJaWxrX2Rpc2FibGVfZGlzcGxheV9p
cnEoaTkxNSwgYml0KTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5pcnFfbG9jaywg
aXJxZmxhZ3MpOwogfQogCiBzdGF0aWMgdm9pZCBnZW44X2Rpc2FibGVfdmJsYW5rKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHVuc2lnbmVkIGludCBwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwogCi0Jc3Bp
bl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT5pcnFfbG9jaywgaXJxZmxhZ3MpOwotCWJkd19kaXNh
YmxlX3BpcGVfaXJxKGRldl9wcml2LCBwaXBlLCBHRU44X1BJUEVfVkJMQU5LKTsKLQlzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+aXJxX2xvY2ssIGlycWZsYWdzKTsKKwlzcGluX2xv
Y2tfaXJxc2F2ZSgmaTkxNS0+aXJxX2xvY2ssIGlycWZsYWdzKTsKKwliZHdfZGlzYWJsZV9waXBl
X2lycShpOTE1LCBwaXBlLCBHRU44X1BJUEVfVkJMQU5LKTsKKwlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZpOTE1LT5pcnFfbG9jaywgaXJxZmxhZ3MpOwogfQogCiBzdGF0aWMgdm9pZCBpOTQ1Z21f
dmJsYW5rX3dvcmtfZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9CiAJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSwgaTk0NWdt
X3ZibGFuay53b3JrKTsKIAogCS8qCkBAIC0zMzcyLDkgKzMzNzIsOSBAQCBzdGF0aWMgdm9pZCBp
OTQ1Z21fdmJsYW5rX3dvcmtfZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJICogaGVu
Y2Ugd2Ugd2FudCB0byBwcmV2ZW50IEMzIHVzYWdlIHdoaWxlIHZibGFuayBpbnRlcnJ1cHRzCiAJ
ICogYXJlIGVuYWJsZWQuCiAJICovCi0JcG1fcW9zX3VwZGF0ZV9yZXF1ZXN0KCZkZXZfcHJpdi0+
aTk0NWdtX3ZibGFuay5wbV9xb3MsCi0JCQkgICAgICBSRUFEX09OQ0UoZGV2X3ByaXYtPmk5NDVn
bV92YmxhbmsuZW5hYmxlZCkgPwotCQkJICAgICAgZGV2X3ByaXYtPmk5NDVnbV92YmxhbmsuYzNf
ZGlzYWJsZV9sYXRlbmN5IDoKKwlwbV9xb3NfdXBkYXRlX3JlcXVlc3QoJmk5MTUtPmk5NDVnbV92
YmxhbmsucG1fcW9zLAorCQkJICAgICAgUkVBRF9PTkNFKGk5MTUtPmk5NDVnbV92YmxhbmsuZW5h
YmxlZCkgPworCQkJICAgICAgaTkxNS0+aTk0NWdtX3ZibGFuay5jM19kaXNhYmxlX2xhdGVuY3kg
OgogCQkJICAgICAgUE1fUU9TX0RFRkFVTFRfVkFMVUUpOwogfQogCkBAIC0zMzk4LDM0ICszMzk4
LDM0IEBAIHN0YXRpYyBpbnQgY3N0YXRlX2Rpc2FibGVfbGF0ZW5jeShjb25zdCBjaGFyICpuYW1l
KQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBpOTQ1Z21fdmJsYW5rX3dvcmtfaW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpOTQ1Z21fdmJs
YW5rX3dvcmtfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlJTklUX1dP
UksoJmRldl9wcml2LT5pOTQ1Z21fdmJsYW5rLndvcmssCisJSU5JVF9XT1JLKCZpOTE1LT5pOTQ1
Z21fdmJsYW5rLndvcmssCiAJCSAgaTk0NWdtX3ZibGFua193b3JrX2Z1bmMpOwogCi0JZGV2X3By
aXYtPmk5NDVnbV92YmxhbmsuYzNfZGlzYWJsZV9sYXRlbmN5ID0KKwlpOTE1LT5pOTQ1Z21fdmJs
YW5rLmMzX2Rpc2FibGVfbGF0ZW5jeSA9CiAJCWNzdGF0ZV9kaXNhYmxlX2xhdGVuY3koIkMzIik7
Ci0JcG1fcW9zX2FkZF9yZXF1ZXN0KCZkZXZfcHJpdi0+aTk0NWdtX3ZibGFuay5wbV9xb3MsCisJ
cG1fcW9zX2FkZF9yZXF1ZXN0KCZpOTE1LT5pOTQ1Z21fdmJsYW5rLnBtX3FvcywKIAkJCSAgIFBN
X1FPU19DUFVfRE1BX0xBVEVOQ1ksCiAJCQkgICBQTV9RT1NfREVGQVVMVF9WQUxVRSk7CiB9CiAK
LXN0YXRpYyB2b2lkIGk5NDVnbV92Ymxhbmtfd29ya19maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGk5NDVnbV92Ymxhbmtfd29ya19maW5pKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2
LT5pOTQ1Z21fdmJsYW5rLndvcmspOwotCXBtX3Fvc19yZW1vdmVfcmVxdWVzdCgmZGV2X3ByaXYt
Pmk5NDVnbV92YmxhbmsucG1fcW9zKTsKKwljYW5jZWxfd29ya19zeW5jKCZpOTE1LT5pOTQ1Z21f
dmJsYW5rLndvcmspOworCXBtX3Fvc19yZW1vdmVfcmVxdWVzdCgmaTkxNS0+aTk0NWdtX3ZibGFu
ay5wbV9xb3MpOwogfQogCi1zdGF0aWMgdm9pZCBpYnhfaXJxX3Jlc2V0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGlieF9pcnFfcmVzZXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0g
JmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUt
PnVuY29yZTsKIAotCWlmIChIQVNfUENIX05PUChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfTk9Q
KGk5MTUpKQogCQlyZXR1cm47CiAKIAlHRU4zX0lSUV9SRVNFVCh1bmNvcmUsIFNERSk7CiAKLQlp
ZiAoSEFTX1BDSF9DUFQoZGV2X3ByaXYpIHx8IEhBU19QQ0hfTFBUKGRldl9wcml2KSkKKwlpZiAo
SEFTX1BDSF9DUFQoaTkxNSkgfHwgSEFTX1BDSF9MUFQoaTkxNSkpCiAJCUk5MTVfV1JJVEUoU0VS
Ul9JTlQsIDB4ZmZmZmZmZmYpOwogfQogCkBAIC0zNDM5LDkgKzM0MzksOSBAQCBzdGF0aWMgdm9p
ZCBpYnhfaXJxX3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKICAqLwog
c3RhdGljIHZvaWQgaWJ4X2lycV9wcmVfcG9zdGluc3RhbGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
dikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAKLQlpZiAo
SEFTX1BDSF9OT1AoZGV2X3ByaXYpKQorCWlmIChIQVNfUENIX05PUChpOTE1KSkKIAkJcmV0dXJu
OwogCiAJV0FSTl9PTihJOTE1X1JFQUQoU0RFSUVSKSAhPSAwKTsKQEAgLTM0NDksMzYgKzM0NDks
MzYgQEAgc3RhdGljIHZvaWQgaWJ4X2lycV9wcmVfcG9zdGluc3RhbGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldikKIAlQT1NUSU5HX1JFQUQoU0RFSUVSKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuNV9n
dF9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZv
aWQgZ2VuNV9ndF9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0J
c3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0
IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAogCUdFTjNfSVJRX1JFU0VU
KHVuY29yZSwgR1QpOwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDYpCisJaWYgKElOVEVM
X0dFTihpOTE1KSA+PSA2KQogCQlHRU4zX0lSUV9SRVNFVCh1bmNvcmUsIEdFTjZfUE0pOwogfQog
Ci1zdGF0aWMgdm9pZCB2bHZfZGlzcGxheV9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmx2X2Rpc3BsYXlfaXJxX3Jlc2V0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9
ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1
LT51bmNvcmU7CiAKLQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJaWYgKElTX0NIRVJS
WVZJRVcoaTkxNSkpCiAJCUk5MTVfV1JJVEUoRFBJTlZHVFQsIERQSU5WR1RUX1NUQVRVU19NQVNL
X0NIVik7CiAJZWxzZQogCQlJOTE1X1dSSVRFKERQSU5WR1RULCBEUElOVkdUVF9TVEFUVVNfTUFT
Syk7CiAKLQlpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3VwZGF0ZV9sb2NrZWQoZGV2X3ByaXYsIDB4
ZmZmZmZmZmYsIDApOworCWk5MTVfaG90cGx1Z19pbnRlcnJ1cHRfdXBkYXRlX2xvY2tlZChpOTE1
LCAweGZmZmZmZmZmLCAwKTsKIAlJOTE1X1dSSVRFKFBPUlRfSE9UUExVR19TVEFULCBJOTE1X1JF
QUQoUE9SVF9IT1RQTFVHX1NUQVQpKTsKIAotCWk5eHhfcGlwZXN0YXRfaXJxX3Jlc2V0KGRldl9w
cml2KTsKKwlpOXh4X3BpcGVzdGF0X2lycV9yZXNldChpOTE1KTsKIAogCUdFTjNfSVJRX1JFU0VU
KHVuY29yZSwgVkxWXyk7Ci0JZGV2X3ByaXYtPmlycV9tYXNrID0gfjB1OworCWk5MTUtPmlycV9t
YXNrID0gfjB1OwogfQogCi1zdGF0aWMgdm9pZCB2bHZfZGlzcGxheV9pcnFfcG9zdGluc3RhbGwo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmx2X2Rpc3Bs
YXlfaXJxX3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0
cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBp
bnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1LT51bmNvcmU7CiAKIAl1MzIgcGlwZXN0YXRfbWFz
azsKIAl1MzIgZW5hYmxlX21hc2s7CkBAIC0zNDg2LDkgKzM0ODYsOSBAQCBzdGF0aWMgdm9pZCB2
bHZfZGlzcGxheV9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCiAJcGlwZXN0YXRfbWFzayA9IFBJUEVfQ1JDX0RPTkVfSU5URVJSVVBUX1NUQVRVUzsK
IAotCWk5MTVfZW5hYmxlX3BpcGVzdGF0KGRldl9wcml2LCBQSVBFX0EsIFBJUEVfR01CVVNfSU5U
RVJSVVBUX1NUQVRVUyk7Ci0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkKLQkJaTkxNV9l
bmFibGVfcGlwZXN0YXQoZGV2X3ByaXYsIHBpcGUsIHBpcGVzdGF0X21hc2spOworCWk5MTVfZW5h
YmxlX3BpcGVzdGF0KGk5MTUsIFBJUEVfQSwgUElQRV9HTUJVU19JTlRFUlJVUFRfU1RBVFVTKTsK
Kwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCisJCWk5MTVfZW5hYmxlX3BpcGVzdGF0KGk5MTUs
IHBpcGUsIHBpcGVzdGF0X21hc2spOwogCiAJZW5hYmxlX21hc2sgPSBJOTE1X0RJU1BMQVlfUE9S
VF9JTlRFUlJVUFQgfAogCQlJOTE1X0RJU1BMQVlfUElQRV9BX0VWRU5UX0lOVEVSUlVQVCB8CkBA
IC0zNDk2LDU2ICszNDk2LDU2IEBAIHN0YXRpYyB2b2lkIHZsdl9kaXNwbGF5X2lycV9wb3N0aW5z
dGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCUk5MTVfTFBFX1BJUEVf
QV9JTlRFUlJVUFQgfAogCQlJOTE1X0xQRV9QSVBFX0JfSU5URVJSVVBUOwogCi0JaWYgKElTX0NI
RVJSWVZJRVcoZGV2X3ByaXYpKQorCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQllbmFibGVf
bWFzayB8PSBJOTE1X0RJU1BMQVlfUElQRV9DX0VWRU5UX0lOVEVSUlVQVCB8CiAJCQlJOTE1X0xQ
RV9QSVBFX0NfSU5URVJSVVBUOwogCi0JV0FSTl9PTihkZXZfcHJpdi0+aXJxX21hc2sgIT0gfjB1
KTsKKwlXQVJOX09OKGk5MTUtPmlycV9tYXNrICE9IH4wdSk7CiAKLQlkZXZfcHJpdi0+aXJxX21h
c2sgPSB+ZW5hYmxlX21hc2s7CisJaTkxNS0+aXJxX21hc2sgPSB+ZW5hYmxlX21hc2s7CiAKLQlH
RU4zX0lSUV9JTklUKHVuY29yZSwgVkxWXywgZGV2X3ByaXYtPmlycV9tYXNrLCBlbmFibGVfbWFz
ayk7CisJR0VOM19JUlFfSU5JVCh1bmNvcmUsIFZMVl8sIGk5MTUtPmlycV9tYXNrLCBlbmFibGVf
bWFzayk7CiB9CiAKIC8qIGRybV9kbWEuaCBob29rcwogKi8KIHN0YXRpYyB2b2lkIGlyb25sYWtl
X2lycV9yZXNldChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1
bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+
dW5jb3JlOwogCiAJR0VOM19JUlFfUkVTRVQodW5jb3JlLCBERSk7Ci0JaWYgKElTX0dFTihkZXZf
cHJpdiwgNykpCisJaWYgKElTX0dFTihpOTE1LCA3KSkKIAkJSTkxNV9XUklURShHRU43X0VSUl9J
TlQsIDB4ZmZmZmZmZmYpOwogCi0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKSB7CisJaWYgKElT
X0hBU1dFTEwoaTkxNSkpIHsKIAkJSTkxNV9XUklURShFRFBfUFNSX0lNUiwgMHhmZmZmZmZmZik7
CiAJCUk5MTVfV1JJVEUoRURQX1BTUl9JSVIsIDB4ZmZmZmZmZmYpOwogCX0KIAotCWdlbjVfZ3Rf
aXJxX3Jlc2V0KGRldl9wcml2KTsKKwlnZW41X2d0X2lycV9yZXNldChpOTE1KTsKIAotCWlieF9p
cnFfcmVzZXQoZGV2X3ByaXYpOworCWlieF9pcnFfcmVzZXQoaTkxNSk7CiB9CiAKIHN0YXRpYyB2
b2lkIHZhbGxleXZpZXdfaXJxX3Jlc2V0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCiAJSTkxNV9XUklURShWTFZf
TUFTVEVSX0lFUiwgMCk7CiAJUE9TVElOR19SRUFEKFZMVl9NQVNURVJfSUVSKTsKIAotCWdlbjVf
Z3RfaXJxX3Jlc2V0KGRldl9wcml2KTsKKwlnZW41X2d0X2lycV9yZXNldChpOTE1KTsKIAotCXNw
aW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JaWYgKGRldl9wcml2LT5kaXNwbGF5
X2lycXNfZW5hYmxlZCkKLQkJdmx2X2Rpc3BsYXlfaXJxX3Jlc2V0KGRldl9wcml2KTsKLQlzcGlu
X3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+
aXJxX2xvY2spOworCWlmIChpOTE1LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkKKwkJdmx2X2Rpc3Bs
YXlfaXJxX3Jlc2V0KGk5MTUpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwog
fQogCi1zdGF0aWMgdm9pZCBnZW44X2d0X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW44X2d0X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2
X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5j
b3JlOwogCiAJR0VOOF9JUlFfUkVTRVRfTkRYKHVuY29yZSwgR1QsIDApOwogCUdFTjhfSVJRX1JF
U0VUX05EWCh1bmNvcmUsIEdULCAxKTsKQEAgLTM1NTUsMTkgKzM1NTUsMTkgQEAgc3RhdGljIHZv
aWQgZ2VuOF9ndF9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CiBzdGF0aWMgdm9pZCBnZW44X2lycV9yZXNldChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3Jl
ICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwogCWludCBwaXBlOwogCi0JZ2VuOF9tYXN0ZXJfaW50
cl9kaXNhYmxlKGRldl9wcml2LT51bmNvcmUucmVncyk7CisJZ2VuOF9tYXN0ZXJfaW50cl9kaXNh
YmxlKGk5MTUtPnVuY29yZS5yZWdzKTsKIAotCWdlbjhfZ3RfaXJxX3Jlc2V0KGRldl9wcml2KTsK
KwlnZW44X2d0X2lycV9yZXNldChpOTE1KTsKIAogCUk5MTVfV1JJVEUoRURQX1BTUl9JTVIsIDB4
ZmZmZmZmZmYpOwogCUk5MTVfV1JJVEUoRURQX1BTUl9JSVIsIDB4ZmZmZmZmZmYpOwogCi0JZm9y
X2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkKLQkJaWYgKGludGVsX2Rpc3BsYXlfcG93ZXJfaXNf
ZW5hYmxlZChkZXZfcHJpdiwKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCisJCWlmIChpbnRl
bF9kaXNwbGF5X3Bvd2VyX2lzX2VuYWJsZWQoaTkxNSwKIAkJCQkJCSAgIFBPV0VSX0RPTUFJTl9Q
SVBFKHBpcGUpKSkKIAkJCUdFTjhfSVJRX1JFU0VUX05EWCh1bmNvcmUsIERFX1BJUEUsIHBpcGUp
OwogCkBAIC0zNTc1LDExICszNTc1LDExIEBAIHN0YXRpYyB2b2lkIGdlbjhfaXJxX3Jlc2V0KHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJR0VOM19JUlFfUkVTRVQodW5jb3JlLCBHRU44X0RFX01J
U0NfKTsKIAlHRU4zX0lSUV9SRVNFVCh1bmNvcmUsIEdFTjhfUENVXyk7CiAKLQlpZiAoSEFTX1BD
SF9TUExJVChkZXZfcHJpdikpCi0JCWlieF9pcnFfcmVzZXQoZGV2X3ByaXYpOworCWlmIChIQVNf
UENIX1NQTElUKGk5MTUpKQorCQlpYnhfaXJxX3Jlc2V0KGk5MTUpOwogfQogCi1zdGF0aWMgdm9p
ZCBnZW4xMV9ndF9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIHZvaWQgZ2VuMTFfZ3RfaXJxX3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewogCS8qIERpc2FibGUgUkNTLCBCQ1MsIFZDUyBhbmQgVkVDUyBjbGFzcyBlbmdpbmVz
LiAqLwogCUk5MTVfV1JJVEUoR0VOMTFfUkVOREVSX0NPUFlfSU5UUl9FTkFCTEUsIDApOwpAQCAt
MzYwMCwyMSArMzYwMCwyMSBAQCBzdGF0aWMgdm9pZCBnZW4xMV9ndF9pcnFfcmVzZXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiBzdGF0aWMgdm9pZCBnZW4xMV9pcnFfcmVz
ZXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSA9ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
ZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+
dW5jb3JlOwogCWludCBwaXBlOwogCi0JZ2VuMTFfbWFzdGVyX2ludHJfZGlzYWJsZShkZXZfcHJp
di0+dW5jb3JlLnJlZ3MpOworCWdlbjExX21hc3Rlcl9pbnRyX2Rpc2FibGUoaTkxNS0+dW5jb3Jl
LnJlZ3MpOwogCi0JZ2VuMTFfZ3RfaXJxX3Jlc2V0KGRldl9wcml2KTsKKwlnZW4xMV9ndF9pcnFf
cmVzZXQoaTkxNSk7CiAKIAlJOTE1X1dSSVRFKEdFTjExX0RJU1BMQVlfSU5UX0NUTCwgMCk7CiAK
IAlJOTE1X1dSSVRFKEVEUF9QU1JfSU1SLCAweGZmZmZmZmZmKTsKIAlJOTE1X1dSSVRFKEVEUF9Q
U1JfSUlSLCAweGZmZmZmZmZmKTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpCi0J
CWlmIChpbnRlbF9kaXNwbGF5X3Bvd2VyX2lzX2VuYWJsZWQoZGV2X3ByaXYsCisJZm9yX2VhY2hf
cGlwZShpOTE1LCBwaXBlKQorCQlpZiAoaW50ZWxfZGlzcGxheV9wb3dlcl9pc19lbmFibGVkKGk5
MTUsCiAJCQkJCQkgICBQT1dFUl9ET01BSU5fUElQRShwaXBlKSkpCiAJCQlHRU44X0lSUV9SRVNF
VF9ORFgodW5jb3JlLCBERV9QSVBFLCBwaXBlKTsKIApAQCAtMzYyNCw4NyArMzYyNCw4NyBAQCBz
dGF0aWMgdm9pZCBnZW4xMV9pcnFfcmVzZXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAlHRU4z
X0lSUV9SRVNFVCh1bmNvcmUsIEdFTjExX0dVX01JU0NfKTsKIAlHRU4zX0lSUV9SRVNFVCh1bmNv
cmUsIEdFTjhfUENVXyk7CiAKLQlpZiAoSU5URUxfUENIX1RZUEUoZGV2X3ByaXYpID49IFBDSF9J
Q1ApCisJaWYgKElOVEVMX1BDSF9UWVBFKGk5MTUpID49IFBDSF9JQ1ApCiAJCUdFTjNfSVJRX1JF
U0VUKHVuY29yZSwgU0RFKTsKIH0KIAotdm9pZCBnZW44X2lycV9wb3dlcl93ZWxsX3Bvc3RfZW5h
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgZ2VuOF9pcnFfcG93
ZXJfd2VsbF9wb3N0X2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICAgIHU4IHBpcGVfbWFzaykKIHsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2
X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5j
b3JlOwogCiAJdTMyIGV4dHJhX2llciA9IEdFTjhfUElQRV9WQkxBTksgfCBHRU44X1BJUEVfRklG
T19VTkRFUlJVTjsKIAllbnVtIHBpcGUgcGlwZTsKIAotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2
LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCi0JaWYgKCFp
bnRlbF9pcnFzX2VuYWJsZWQoZGV2X3ByaXYpKSB7Ci0JCXNwaW5fdW5sb2NrX2lycSgmZGV2X3By
aXYtPmlycV9sb2NrKTsKKwlpZiAoIWludGVsX2lycXNfZW5hYmxlZChpOTE1KSkgeworCQlzcGlu
X3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAkJcmV0dXJuOwogCX0KIAotCWZvcl9lYWNo
X3BpcGVfbWFza2VkKGRldl9wcml2LCBwaXBlLCBwaXBlX21hc2spCisJZm9yX2VhY2hfcGlwZV9t
YXNrZWQoaTkxNSwgcGlwZSwgcGlwZV9tYXNrKQogCQlHRU44X0lSUV9JTklUX05EWCh1bmNvcmUs
IERFX1BJUEUsIHBpcGUsCi0JCQkJICBkZXZfcHJpdi0+ZGVfaXJxX21hc2tbcGlwZV0sCi0JCQkJ
ICB+ZGV2X3ByaXYtPmRlX2lycV9tYXNrW3BpcGVdIHwgZXh0cmFfaWVyKTsKKwkJCQkgIGk5MTUt
PmRlX2lycV9tYXNrW3BpcGVdLAorCQkJCSAgfmk5MTUtPmRlX2lycV9tYXNrW3BpcGVdIHwgZXh0
cmFfaWVyKTsKIAotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGlu
X3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIH0KIAotdm9pZCBnZW44X2lycV9wb3dlcl93
ZWxsX3ByZV9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQg
Z2VuOF9pcnFfcG93ZXJfd2VsbF9wcmVfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCQkgICAgIHU4IHBpcGVfbWFzaykKIHsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1
bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUg
PSAmaTkxNS0+dW5jb3JlOwogCWVudW0gcGlwZSBwaXBlOwogCi0Jc3Bpbl9sb2NrX2lycSgmZGV2
X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CiAKLQlp
ZiAoIWludGVsX2lycXNfZW5hYmxlZChkZXZfcHJpdikpIHsKLQkJc3Bpbl91bmxvY2tfaXJxKCZk
ZXZfcHJpdi0+aXJxX2xvY2spOworCWlmICghaW50ZWxfaXJxc19lbmFibGVkKGk5MTUpKSB7CisJ
CXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCQlyZXR1cm47CiAJfQogCi0JZm9y
X2VhY2hfcGlwZV9tYXNrZWQoZGV2X3ByaXYsIHBpcGUsIHBpcGVfbWFzaykKKwlmb3JfZWFjaF9w
aXBlX21hc2tlZChpOTE1LCBwaXBlLCBwaXBlX21hc2spCiAJCUdFTjhfSVJRX1JFU0VUX05EWCh1
bmNvcmUsIERFX1BJUEUsIHBpcGUpOwogCi0Jc3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+aXJx
X2xvY2spOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCiAJLyogbWFrZSBz
dXJlIHdlJ3JlIGRvbmUgcHJvY2Vzc2luZyBkaXNwbGF5IGlycXMgKi8KLQlzeW5jaHJvbml6ZV9p
cnEoZGV2X3ByaXYtPmRybS5pcnEpOworCXN5bmNocm9uaXplX2lycShpOTE1LT5kcm0uaXJxKTsK
IH0KIAogc3RhdGljIHZvaWQgY2hlcnJ5dmlld19pcnFfcmVzZXQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGlu
dGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAogCUk5MTVfV1JJVEUoR0VOOF9N
QVNURVJfSVJRLCAwKTsKIAlQT1NUSU5HX1JFQUQoR0VOOF9NQVNURVJfSVJRKTsKIAotCWdlbjhf
Z3RfaXJxX3Jlc2V0KGRldl9wcml2KTsKKwlnZW44X2d0X2lycV9yZXNldChpOTE1KTsKIAogCUdF
TjNfSVJRX1JFU0VUKHVuY29yZSwgR0VOOF9QQ1VfKTsKIAotCXNwaW5fbG9ja19pcnEoJmRldl9w
cml2LT5pcnFfbG9jayk7Ci0JaWYgKGRldl9wcml2LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkKLQkJ
dmx2X2Rpc3BsYXlfaXJxX3Jlc2V0KGRldl9wcml2KTsKLQlzcGluX3VubG9ja19pcnEoJmRldl9w
cml2LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCWlmIChp
OTE1LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkKKwkJdmx2X2Rpc3BsYXlfaXJxX3Jlc2V0KGk5MTUp
OworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogfQogCi1zdGF0aWMgdTMyIGlu
dGVsX2hwZF9lbmFibGVkX2lycXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHUzMiBpbnRlbF9ocGRfZW5hYmxlZF9pcnFzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCSAgY29uc3QgdTMyIGhwZFtIUERfTlVNX1BJTlNdKQogewogCXN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyOwogCXUzMiBlbmFibGVkX2lycXMgPSAwOwogCi0JZm9yX2Vh
Y2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikKLQkJaWYgKGRldl9wcml2
LT5ob3RwbHVnLnN0YXRzW2VuY29kZXItPmhwZF9waW5dLnN0YXRlID09IEhQRF9FTkFCTEVEKQor
CWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmk5MTUtPmRybSwgZW5jb2RlcikKKwkJaWYgKGk5MTUt
PmhvdHBsdWcuc3RhdHNbZW5jb2Rlci0+aHBkX3Bpbl0uc3RhdGUgPT0gSFBEX0VOQUJMRUQpCiAJ
CQllbmFibGVkX2lycXMgfD0gaHBkW2VuY29kZXItPmhwZF9waW5dOwogCiAJcmV0dXJuIGVuYWJs
ZWRfaXJxczsKIH0KIAotc3RhdGljIHZvaWQgaWJ4X2hwZF9kZXRlY3Rpb25fc2V0dXAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaWJ4X2hwZF9kZXRlY3Rp
b25fc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGhvdHBsdWc7
CiAKQEAgLTM3MjQsMjkgKzM3MjQsMjkgQEAgc3RhdGljIHZvaWQgaWJ4X2hwZF9kZXRlY3Rpb25f
c2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIFdoZW4gQ1BVIGFu
ZCBQQ0ggYXJlIG9uIHRoZSBzYW1lIHBhY2thZ2UsIHBvcnQgQQogCSAqIEhQRCBtdXN0IGJlIGVu
YWJsZWQgaW4gYm90aCBub3J0aCBhbmQgc291dGguCiAJICovCi0JaWYgKEhBU19QQ0hfTFBUX0xQ
KGRldl9wcml2KSkKKwlpZiAoSEFTX1BDSF9MUFRfTFAoaTkxNSkpCiAJCWhvdHBsdWcgfD0gUE9S
VEFfSE9UUExVR19FTkFCTEU7CiAJSTkxNV9XUklURShQQ0hfUE9SVF9IT1RQTFVHLCBob3RwbHVn
KTsKIH0KIAotc3RhdGljIHZvaWQgaWJ4X2hwZF9pcnFfc2V0dXAoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaWJ4X2hwZF9pcnFfc2V0dXAoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGhvdHBsdWdfaXJxcywgZW5hYmxlZF9pcnFz
OwogCi0JaWYgKEhBU19QQ0hfSUJYKGRldl9wcml2KSkgeworCWlmIChIQVNfUENIX0lCWChpOTE1
KSkgewogCQlob3RwbHVnX2lycXMgPSBTREVfSE9UUExVR19NQVNLOwotCQllbmFibGVkX2lycXMg
PSBpbnRlbF9ocGRfZW5hYmxlZF9pcnFzKGRldl9wcml2LCBocGRfaWJ4KTsKKwkJZW5hYmxlZF9p
cnFzID0gaW50ZWxfaHBkX2VuYWJsZWRfaXJxcyhpOTE1LCBocGRfaWJ4KTsKIAl9IGVsc2Ugewog
CQlob3RwbHVnX2lycXMgPSBTREVfSE9UUExVR19NQVNLX0NQVDsKLQkJZW5hYmxlZF9pcnFzID0g
aW50ZWxfaHBkX2VuYWJsZWRfaXJxcyhkZXZfcHJpdiwgaHBkX2NwdCk7CisJCWVuYWJsZWRfaXJx
cyA9IGludGVsX2hwZF9lbmFibGVkX2lycXMoaTkxNSwgaHBkX2NwdCk7CiAJfQogCi0JaWJ4X2Rp
c3BsYXlfaW50ZXJydXB0X3VwZGF0ZShkZXZfcHJpdiwgaG90cGx1Z19pcnFzLCBlbmFibGVkX2ly
cXMpOworCWlieF9kaXNwbGF5X2ludGVycnVwdF91cGRhdGUoaTkxNSwgaG90cGx1Z19pcnFzLCBl
bmFibGVkX2lycXMpOwogCi0JaWJ4X2hwZF9kZXRlY3Rpb25fc2V0dXAoZGV2X3ByaXYpOworCWli
eF9ocGRfZGV0ZWN0aW9uX3NldHVwKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBpY3BfaHBkX2Rl
dGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
dm9pZCBpY3BfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAl1MzIgaG90cGx1ZzsKIApAQCAtMzc2MywxOSArMzc2MywxOSBAQCBzdGF0aWMgdm9p
ZCBpY3BfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJSTkxNV9XUklURShTSE9UUExVR19DVExfVEMsIGhvdHBsdWcpOwogfQogCi1zdGF0aWMg
dm9pZCBpY3BfaHBkX2lycV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCBpY3BfaHBkX2lycV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAl1MzIgaG90cGx1Z19pcnFzLCBlbmFibGVkX2lycXM7CiAKIAlob3RwbHVnX2ly
cXMgPSBTREVfRERJX01BU0tfSUNQIHwgU0RFX1RDX01BU0tfSUNQOwotCWVuYWJsZWRfaXJxcyA9
IGludGVsX2hwZF9lbmFibGVkX2lycXMoZGV2X3ByaXYsIGhwZF9pY3ApOworCWVuYWJsZWRfaXJx
cyA9IGludGVsX2hwZF9lbmFibGVkX2lycXMoaTkxNSwgaHBkX2ljcCk7CiAKLQlpYnhfZGlzcGxh
eV9pbnRlcnJ1cHRfdXBkYXRlKGRldl9wcml2LCBob3RwbHVnX2lycXMsIGVuYWJsZWRfaXJxcyk7
CisJaWJ4X2Rpc3BsYXlfaW50ZXJydXB0X3VwZGF0ZShpOTE1LCBob3RwbHVnX2lycXMsIGVuYWJs
ZWRfaXJxcyk7CiAKLQlpY3BfaHBkX2RldGVjdGlvbl9zZXR1cChkZXZfcHJpdik7CisJaWNwX2hw
ZF9kZXRlY3Rpb25fc2V0dXAoaTkxNSk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjExX2hwZF9kZXRl
Y3Rpb25fc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZv
aWQgZ2VuMTFfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAl1MzIgaG90cGx1ZzsKIApAQCAtMzc5NCwxMiArMzc5NCwxMiBAQCBzdGF0aWMgdm9p
ZCBnZW4xMV9ocGRfZGV0ZWN0aW9uX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAlJOTE1X1dSSVRFKEdFTjExX1RCVF9IT1RQTFVHX0NUTCwgaG90cGx1Zyk7CiB9CiAK
LXN0YXRpYyB2b2lkIGdlbjExX2hwZF9pcnFfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuMTFfaHBkX2lycV9zZXR1cChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgaG90cGx1Z19pcnFzLCBlbmFibGVkX2lycXM7CiAJ
dTMyIHZhbDsKIAotCWVuYWJsZWRfaXJxcyA9IGludGVsX2hwZF9lbmFibGVkX2lycXMoZGV2X3By
aXYsIGhwZF9nZW4xMSk7CisJZW5hYmxlZF9pcnFzID0gaW50ZWxfaHBkX2VuYWJsZWRfaXJxcyhp
OTE1LCBocGRfZ2VuMTEpOwogCWhvdHBsdWdfaXJxcyA9IEdFTjExX0RFX1RDX0hPVFBMVUdfTUFT
SyB8IEdFTjExX0RFX1RCVF9IT1RQTFVHX01BU0s7CiAKIAl2YWwgPSBJOTE1X1JFQUQoR0VOMTFf
REVfSFBEX0lNUik7CkBAIC0zODA3LDE4ICszODA3LDE4IEBAIHN0YXRpYyB2b2lkIGdlbjExX2hw
ZF9pcnFfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJ
VEUoR0VOMTFfREVfSFBEX0lNUiwgdmFsKTsKIAlQT1NUSU5HX1JFQUQoR0VOMTFfREVfSFBEX0lN
Uik7CiAKLQlnZW4xMV9ocGRfZGV0ZWN0aW9uX3NldHVwKGRldl9wcml2KTsKKwlnZW4xMV9ocGRf
ZGV0ZWN0aW9uX3NldHVwKGk5MTUpOwogCi0JaWYgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+
PSBQQ0hfSUNQKQotCQlpY3BfaHBkX2lycV9zZXR1cChkZXZfcHJpdik7CisJaWYgKElOVEVMX1BD
SF9UWVBFKGk5MTUpID49IFBDSF9JQ1ApCisJCWljcF9ocGRfaXJxX3NldHVwKGk5MTUpOwogfQog
Ci1zdGF0aWMgdm9pZCBzcHRfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBzcHRfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFsLCBob3RwbHVnOwogCiAJLyog
RGlzcGxheSBXQSAjMTE3OSBXYUhhcmRIYW5nb25Ib3RQbHVnOiBjbnAgKi8KLQlpZiAoSEFTX1BD
SF9DTlAoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19QQ0hfQ05QKGk5MTUpKSB7CiAJCXZhbCA9IEk5
MTVfUkVBRChTT1VUSF9DSElDS0VOMSk7CiAJCXZhbCAmPSB+Q0hBU1NJU19DTEtfUkVRX0RVUkFU
SU9OX01BU0s7CiAJCXZhbCB8PSBDSEFTU0lTX0NMS19SRVFfRFVSQVRJT04oMHhmKTsKQEAgLTM4
MzgsMTkgKzM4MzgsMTkgQEAgc3RhdGljIHZvaWQgc3B0X2hwZF9kZXRlY3Rpb25fc2V0dXAoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJVEUoUENIX1BPUlRfSE9U
UExVRzIsIGhvdHBsdWcpOwogfQogCi1zdGF0aWMgdm9pZCBzcHRfaHBkX2lycV9zZXR1cChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBzcHRfaHBkX2lycV9z
ZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgaG90cGx1Z19pcnFz
LCBlbmFibGVkX2lycXM7CiAKIAlob3RwbHVnX2lycXMgPSBTREVfSE9UUExVR19NQVNLX1NQVDsK
LQllbmFibGVkX2lycXMgPSBpbnRlbF9ocGRfZW5hYmxlZF9pcnFzKGRldl9wcml2LCBocGRfc3B0
KTsKKwllbmFibGVkX2lycXMgPSBpbnRlbF9ocGRfZW5hYmxlZF9pcnFzKGk5MTUsIGhwZF9zcHQp
OwogCi0JaWJ4X2Rpc3BsYXlfaW50ZXJydXB0X3VwZGF0ZShkZXZfcHJpdiwgaG90cGx1Z19pcnFz
LCBlbmFibGVkX2lycXMpOworCWlieF9kaXNwbGF5X2ludGVycnVwdF91cGRhdGUoaTkxNSwgaG90
cGx1Z19pcnFzLCBlbmFibGVkX2lycXMpOwogCi0Jc3B0X2hwZF9kZXRlY3Rpb25fc2V0dXAoZGV2
X3ByaXYpOworCXNwdF9ocGRfZGV0ZWN0aW9uX3NldHVwKGk5MTUpOwogfQogCi1zdGF0aWMgdm9p
ZCBpbGtfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdm9pZCBpbGtfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgaG90cGx1ZzsKIApAQCAtMzg2NiwzMyArMzg2NiwzMyBA
QCBzdGF0aWMgdm9pZCBpbGtfaHBkX2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShESUdJVEFMX1BPUlRfSE9UUExVR19DTlRSTCwg
aG90cGx1Zyk7CiB9CiAKLXN0YXRpYyB2b2lkIGlsa19ocGRfaXJxX3NldHVwKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGlsa19ocGRfaXJxX3NldHVwKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiBob3RwbHVnX2lycXMsIGVuYWJs
ZWRfaXJxczsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpIHsKKwlpZiAoSU5URUxf
R0VOKGk5MTUpID49IDgpIHsKIAkJaG90cGx1Z19pcnFzID0gR0VOOF9QT1JUX0RQX0FfSE9UUExV
RzsKLQkJZW5hYmxlZF9pcnFzID0gaW50ZWxfaHBkX2VuYWJsZWRfaXJxcyhkZXZfcHJpdiwgaHBk
X2Jkdyk7CisJCWVuYWJsZWRfaXJxcyA9IGludGVsX2hwZF9lbmFibGVkX2lycXMoaTkxNSwgaHBk
X2Jkdyk7CiAKLQkJYmR3X3VwZGF0ZV9wb3J0X2lycShkZXZfcHJpdiwgaG90cGx1Z19pcnFzLCBl
bmFibGVkX2lycXMpOwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA3KSB7CisJ
CWJkd191cGRhdGVfcG9ydF9pcnEoaTkxNSwgaG90cGx1Z19pcnFzLCBlbmFibGVkX2lycXMpOwor
CX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDcpIHsKIAkJaG90cGx1Z19pcnFzID0gREVf
RFBfQV9IT1RQTFVHX0lWQjsKLQkJZW5hYmxlZF9pcnFzID0gaW50ZWxfaHBkX2VuYWJsZWRfaXJx
cyhkZXZfcHJpdiwgaHBkX2l2Yik7CisJCWVuYWJsZWRfaXJxcyA9IGludGVsX2hwZF9lbmFibGVk
X2lycXMoaTkxNSwgaHBkX2l2Yik7CiAKLQkJaWxrX3VwZGF0ZV9kaXNwbGF5X2lycShkZXZfcHJp
diwgaG90cGx1Z19pcnFzLCBlbmFibGVkX2lycXMpOworCQlpbGtfdXBkYXRlX2Rpc3BsYXlfaXJx
KGk5MTUsIGhvdHBsdWdfaXJxcywgZW5hYmxlZF9pcnFzKTsKIAl9IGVsc2UgewogCQlob3RwbHVn
X2lycXMgPSBERV9EUF9BX0hPVFBMVUc7Ci0JCWVuYWJsZWRfaXJxcyA9IGludGVsX2hwZF9lbmFi
bGVkX2lycXMoZGV2X3ByaXYsIGhwZF9pbGspOworCQllbmFibGVkX2lycXMgPSBpbnRlbF9ocGRf
ZW5hYmxlZF9pcnFzKGk5MTUsIGhwZF9pbGspOwogCi0JCWlsa191cGRhdGVfZGlzcGxheV9pcnEo
ZGV2X3ByaXYsIGhvdHBsdWdfaXJxcywgZW5hYmxlZF9pcnFzKTsKKwkJaWxrX3VwZGF0ZV9kaXNw
bGF5X2lycShpOTE1LCBob3RwbHVnX2lycXMsIGVuYWJsZWRfaXJxcyk7CiAJfQogCi0JaWxrX2hw
ZF9kZXRlY3Rpb25fc2V0dXAoZGV2X3ByaXYpOworCWlsa19ocGRfZGV0ZWN0aW9uX3NldHVwKGk5
MTUpOwogCi0JaWJ4X2hwZF9pcnFfc2V0dXAoZGV2X3ByaXYpOworCWlieF9ocGRfaXJxX3NldHVw
KGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBfX2J4dF9ocGRfZGV0ZWN0aW9uX3NldHVwKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIF9fYnh0X2hwZF9kZXRl
Y3Rpb25fc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgdTMy
IGVuYWJsZWRfaXJxcykKIHsKIAl1MzIgaG90cGx1ZzsKQEAgLTM5MTEsMTA2ICszOTExLDEwNiBA
QCBzdGF0aWMgdm9pZCBfX2J4dF9ocGRfZGV0ZWN0aW9uX3NldHVwKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkgKiBmb3IgSFBEIGRldGVjdGlvbiBsb2dpYywgdXBkYXRlIGl0
IGJhc2VkIG9uIFZCVCBmaWVsZHMuCiAJICovCiAJaWYgKChlbmFibGVkX2lycXMgJiBCWFRfREVf
UE9SVF9IUF9ERElBKSAmJgotCSAgICBpbnRlbF9iaW9zX2lzX3BvcnRfaHBkX2ludmVydGVkKGRl
dl9wcml2LCBQT1JUX0EpKQorCSAgICBpbnRlbF9iaW9zX2lzX3BvcnRfaHBkX2ludmVydGVkKGk5
MTUsIFBPUlRfQSkpCiAJCWhvdHBsdWcgfD0gQlhUX0RESUFfSFBEX0lOVkVSVDsKIAlpZiAoKGVu
YWJsZWRfaXJxcyAmIEJYVF9ERV9QT1JUX0hQX0RESUIpICYmCi0JICAgIGludGVsX2Jpb3NfaXNf
cG9ydF9ocGRfaW52ZXJ0ZWQoZGV2X3ByaXYsIFBPUlRfQikpCisJICAgIGludGVsX2Jpb3NfaXNf
cG9ydF9ocGRfaW52ZXJ0ZWQoaTkxNSwgUE9SVF9CKSkKIAkJaG90cGx1ZyB8PSBCWFRfRERJQl9I
UERfSU5WRVJUOwogCWlmICgoZW5hYmxlZF9pcnFzICYgQlhUX0RFX1BPUlRfSFBfRERJQykgJiYK
LQkgICAgaW50ZWxfYmlvc19pc19wb3J0X2hwZF9pbnZlcnRlZChkZXZfcHJpdiwgUE9SVF9DKSkK
KwkgICAgaW50ZWxfYmlvc19pc19wb3J0X2hwZF9pbnZlcnRlZChpOTE1LCBQT1JUX0MpKQogCQlo
b3RwbHVnIHw9IEJYVF9ERElDX0hQRF9JTlZFUlQ7CiAKIAlJOTE1X1dSSVRFKFBDSF9QT1JUX0hP
VFBMVUcsIGhvdHBsdWcpOwogfQogCi1zdGF0aWMgdm9pZCBieHRfaHBkX2RldGVjdGlvbl9zZXR1
cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBieHRfaHBk
X2RldGVjdGlvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlfX2J4
dF9ocGRfZGV0ZWN0aW9uX3NldHVwKGRldl9wcml2LCBCWFRfREVfUE9SVF9IT1RQTFVHX01BU0sp
OworCV9fYnh0X2hwZF9kZXRlY3Rpb25fc2V0dXAoaTkxNSwgQlhUX0RFX1BPUlRfSE9UUExVR19N
QVNLKTsKIH0KIAotc3RhdGljIHZvaWQgYnh0X2hwZF9pcnFfc2V0dXAoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgYnh0X2hwZF9pcnFfc2V0dXAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGhvdHBsdWdfaXJxcywgZW5hYmxlZF9p
cnFzOwogCi0JZW5hYmxlZF9pcnFzID0gaW50ZWxfaHBkX2VuYWJsZWRfaXJxcyhkZXZfcHJpdiwg
aHBkX2J4dCk7CisJZW5hYmxlZF9pcnFzID0gaW50ZWxfaHBkX2VuYWJsZWRfaXJxcyhpOTE1LCBo
cGRfYnh0KTsKIAlob3RwbHVnX2lycXMgPSBCWFRfREVfUE9SVF9IT1RQTFVHX01BU0s7CiAKLQli
ZHdfdXBkYXRlX3BvcnRfaXJxKGRldl9wcml2LCBob3RwbHVnX2lycXMsIGVuYWJsZWRfaXJxcyk7
CisJYmR3X3VwZGF0ZV9wb3J0X2lycShpOTE1LCBob3RwbHVnX2lycXMsIGVuYWJsZWRfaXJxcyk7
CiAKLQlfX2J4dF9ocGRfZGV0ZWN0aW9uX3NldHVwKGRldl9wcml2LCBlbmFibGVkX2lycXMpOwor
CV9fYnh0X2hwZF9kZXRlY3Rpb25fc2V0dXAoaTkxNSwgZW5hYmxlZF9pcnFzKTsKIH0KIAogc3Rh
dGljIHZvaWQgaWJ4X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAl1MzIgbWFzazsKIAot
CWlmIChIQVNfUENIX05PUChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfTk9QKGk5MTUpKQogCQly
ZXR1cm47CiAKLQlpZiAoSEFTX1BDSF9JQlgoZGV2X3ByaXYpKQorCWlmIChIQVNfUENIX0lCWChp
OTE1KSkKIAkJbWFzayA9IFNERV9HTUJVUyB8IFNERV9BVVhfTUFTSyB8IFNERV9QT0lTT047Ci0J
ZWxzZSBpZiAoSEFTX1BDSF9DUFQoZGV2X3ByaXYpIHx8IEhBU19QQ0hfTFBUKGRldl9wcml2KSkK
KwllbHNlIGlmIChIQVNfUENIX0NQVChpOTE1KSB8fCBIQVNfUENIX0xQVChpOTE1KSkKIAkJbWFz
ayA9IFNERV9HTUJVU19DUFQgfCBTREVfQVVYX01BU0tfQ1BUOwogCWVsc2UKIAkJbWFzayA9IFNE
RV9HTUJVU19DUFQ7CiAKLQlnZW4zX2Fzc2VydF9paXJfaXNfemVybygmZGV2X3ByaXYtPnVuY29y
ZSwgU0RFSUlSKTsKKwlnZW4zX2Fzc2VydF9paXJfaXNfemVybygmaTkxNS0+dW5jb3JlLCBTREVJ
SVIpOwogCUk5MTVfV1JJVEUoU0RFSU1SLCB+bWFzayk7CiAKLQlpZiAoSEFTX1BDSF9JQlgoZGV2
X3ByaXYpIHx8IEhBU19QQ0hfQ1BUKGRldl9wcml2KSB8fAotCSAgICBIQVNfUENIX0xQVChkZXZf
cHJpdikpCi0JCWlieF9ocGRfZGV0ZWN0aW9uX3NldHVwKGRldl9wcml2KTsKKwlpZiAoSEFTX1BD
SF9JQlgoaTkxNSkgfHwgSEFTX1BDSF9DUFQoaTkxNSkgfHwKKwkgICAgSEFTX1BDSF9MUFQoaTkx
NSkpCisJCWlieF9ocGRfZGV0ZWN0aW9uX3NldHVwKGk5MTUpOwogCWVsc2UKLQkJc3B0X2hwZF9k
ZXRlY3Rpb25fc2V0dXAoZGV2X3ByaXYpOworCQlzcHRfaHBkX2RldGVjdGlvbl9zZXR1cChpOTE1
KTsKIH0KIAogc3RhdGljIHZvaWQgZ2VuNV9ndF9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGRldik7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNv
cmU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAl1MzIgcG1faXJxcywg
Z3RfaXJxczsKIAogCXBtX2lycXMgPSBndF9pcnFzID0gMDsKIAotCWRldl9wcml2LT5ndF9pcnFf
bWFzayA9IH4wOwotCWlmIChIQVNfTDNfRFBGKGRldl9wcml2KSkgeworCWk5MTUtPmd0X2lycV9t
YXNrID0gfjA7CisJaWYgKEhBU19MM19EUEYoaTkxNSkpIHsKIAkJLyogTDMgcGFyaXR5IGludGVy
cnVwdCBpcyBhbHdheXMgdW5tYXNrZWQuICovCi0JCWRldl9wcml2LT5ndF9pcnFfbWFzayA9IH5H
VF9QQVJJVFlfRVJST1IoZGV2X3ByaXYpOwotCQlndF9pcnFzIHw9IEdUX1BBUklUWV9FUlJPUihk
ZXZfcHJpdik7CisJCWk5MTUtPmd0X2lycV9tYXNrID0gfkdUX1BBUklUWV9FUlJPUihpOTE1KTsK
KwkJZ3RfaXJxcyB8PSBHVF9QQVJJVFlfRVJST1IoaTkxNSk7CiAJfQogCiAJZ3RfaXJxcyB8PSBH
VF9SRU5ERVJfVVNFUl9JTlRFUlJVUFQ7Ci0JaWYgKElTX0dFTihkZXZfcHJpdiwgNSkpIHsKKwlp
ZiAoSVNfR0VOKGk5MTUsIDUpKSB7CiAJCWd0X2lycXMgfD0gSUxLX0JTRF9VU0VSX0lOVEVSUlVQ
VDsKIAl9IGVsc2UgewogCQlndF9pcnFzIHw9IEdUX0JMVF9VU0VSX0lOVEVSUlVQVCB8IEdUX0JT
RF9VU0VSX0lOVEVSUlVQVDsKIAl9CiAKLQlHRU4zX0lSUV9JTklUKHVuY29yZSwgR1QsIGRldl9w
cml2LT5ndF9pcnFfbWFzaywgZ3RfaXJxcyk7CisJR0VOM19JUlFfSU5JVCh1bmNvcmUsIEdULCBp
OTE1LT5ndF9pcnFfbWFzaywgZ3RfaXJxcyk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA2KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KSB7CiAJCS8qCiAJCSAqIFJQUyBpbnRl
cnJ1cHRzIHdpbGwgZ2V0IGVuYWJsZWQvZGlzYWJsZWQgb24gZGVtYW5kIHdoZW4gUlBTCiAJCSAq
IGl0c2VsZiBpcyBlbmFibGVkL2Rpc2FibGVkLgogCQkgKi8KLQkJaWYgKEhBU19FTkdJTkUoZGV2
X3ByaXYsIFZFQ1MwKSkgeworCQlpZiAoSEFTX0VOR0lORShpOTE1LCBWRUNTMCkpIHsKIAkJCXBt
X2lycXMgfD0gUE1fVkVCT1hfVVNFUl9JTlRFUlJVUFQ7Ci0JCQlkZXZfcHJpdi0+cG1faWVyIHw9
IFBNX1ZFQk9YX1VTRVJfSU5URVJSVVBUOworCQkJaTkxNS0+cG1faWVyIHw9IFBNX1ZFQk9YX1VT
RVJfSU5URVJSVVBUOwogCQl9CiAKLQkJZGV2X3ByaXYtPnBtX2ltciA9IDB4ZmZmZmZmZmY7Ci0J
CUdFTjNfSVJRX0lOSVQodW5jb3JlLCBHRU42X1BNLCBkZXZfcHJpdi0+cG1faW1yLCBwbV9pcnFz
KTsKKwkJaTkxNS0+cG1faW1yID0gMHhmZmZmZmZmZjsKKwkJR0VOM19JUlFfSU5JVCh1bmNvcmUs
IEdFTjZfUE0sIGk5MTUtPnBtX2ltciwgcG1faXJxcyk7CiAJfQogfQogCiBzdGF0aWMgaW50IGly
b25sYWtlX2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNv
cmUgPSAmaTkxNS0+dW5jb3JlOwogCXUzMiBkaXNwbGF5X21hc2ssIGV4dHJhX21hc2s7CiAKLQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA3KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA3
KSB7CiAJCWRpc3BsYXlfbWFzayA9IChERV9NQVNURVJfSVJRX0NPTlRST0wgfCBERV9HU0VfSVZC
IHwKIAkJCQlERV9QQ0hfRVZFTlRfSVZCIHwgREVfQVVYX0NIQU5ORUxfQV9JVkIpOwogCQlleHRy
YV9tYXNrID0gKERFX1BJUEVDX1ZCTEFOS19JVkIgfCBERV9QSVBFQl9WQkxBTktfSVZCIHwKQEAg
LTQwMjUsNzggKzQwMjUsNzggQEAgc3RhdGljIGludCBpcm9ubGFrZV9pcnFfcG9zdGluc3RhbGwo
c3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJCSAgICAgIERFX0RQX0FfSE9UUExVRyk7CiAJfQog
Ci0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKSB7CisJaWYgKElTX0hBU1dFTEwoaTkxNSkpIHsK
IAkJZ2VuM19hc3NlcnRfaWlyX2lzX3plcm8odW5jb3JlLCBFRFBfUFNSX0lJUik7Ci0JCWludGVs
X3Bzcl9pcnFfY29udHJvbChkZXZfcHJpdiwgZGV2X3ByaXYtPnBzci5kZWJ1Zyk7CisJCWludGVs
X3Bzcl9pcnFfY29udHJvbChpOTE1LCBpOTE1LT5wc3IuZGVidWcpOwogCQlkaXNwbGF5X21hc2sg
fD0gREVfRURQX1BTUl9JTlRfSFNXOwogCX0KIAotCWRldl9wcml2LT5pcnFfbWFzayA9IH5kaXNw
bGF5X21hc2s7CisJaTkxNS0+aXJxX21hc2sgPSB+ZGlzcGxheV9tYXNrOwogCiAJaWJ4X2lycV9w
cmVfcG9zdGluc3RhbGwoZGV2KTsKIAotCUdFTjNfSVJRX0lOSVQodW5jb3JlLCBERSwgZGV2X3By
aXYtPmlycV9tYXNrLAorCUdFTjNfSVJRX0lOSVQodW5jb3JlLCBERSwgaTkxNS0+aXJxX21hc2ss
CiAJCSAgICAgIGRpc3BsYXlfbWFzayB8IGV4dHJhX21hc2spOwogCiAJZ2VuNV9ndF9pcnFfcG9z
dGluc3RhbGwoZGV2KTsKIAotCWlsa19ocGRfZGV0ZWN0aW9uX3NldHVwKGRldl9wcml2KTsKKwlp
bGtfaHBkX2RldGVjdGlvbl9zZXR1cChpOTE1KTsKIAogCWlieF9pcnFfcG9zdGluc3RhbGwoZGV2
KTsKIAotCWlmIChJU19JUk9OTEFLRV9NKGRldl9wcml2KSkgeworCWlmIChJU19JUk9OTEFLRV9N
KGk5MTUpKSB7CiAJCS8qIEVuYWJsZSBQQ1UgZXZlbnQgaW50ZXJydXB0cwogCQkgKgogCQkgKiBz
cGlubG9ja2luZyBub3QgcmVxdWlyZWQgaGVyZSBmb3IgY29ycmVjdG5lc3Mgc2luY2UgaW50ZXJy
dXB0CiAJCSAqIHNldHVwIGlzIGd1YXJhbnRlZWQgdG8gcnVuIGluIHNpbmdsZS10aHJlYWRlZCBj
b250ZXh0LiBCdXQgd2UKIAkJICogbmVlZCBpdCB0byBtYWtlIHRoZSBhc3NlcnRfc3Bpbl9sb2Nr
ZWQgaGFwcHkuICovCi0JCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JCWls
a19lbmFibGVfZGlzcGxheV9pcnEoZGV2X3ByaXYsIERFX1BDVV9FVkVOVCk7Ci0JCXNwaW5fdW5s
b2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJx
X2xvY2spOworCQlpbGtfZW5hYmxlX2Rpc3BsYXlfaXJxKGk5MTUsIERFX1BDVV9FVkVOVCk7CisJ
CXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCX0KIAogCXJldHVybiAwOwogfQog
Ci12b2lkIHZhbGxleXZpZXdfZW5hYmxlX2Rpc3BsYXlfaXJxcyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCit2b2lkIHZhbGxleXZpZXdfZW5hYmxlX2Rpc3BsYXlfaXJxcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZf
cHJpdi0+aXJxX2xvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsK
IAotCWlmIChkZXZfcHJpdi0+ZGlzcGxheV9pcnFzX2VuYWJsZWQpCisJaWYgKGk5MTUtPmRpc3Bs
YXlfaXJxc19lbmFibGVkKQogCQlyZXR1cm47CiAKLQlkZXZfcHJpdi0+ZGlzcGxheV9pcnFzX2Vu
YWJsZWQgPSB0cnVlOworCWk5MTUtPmRpc3BsYXlfaXJxc19lbmFibGVkID0gdHJ1ZTsKIAotCWlm
IChpbnRlbF9pcnFzX2VuYWJsZWQoZGV2X3ByaXYpKSB7Ci0JCXZsdl9kaXNwbGF5X2lycV9yZXNl
dChkZXZfcHJpdik7Ci0JCXZsdl9kaXNwbGF5X2lycV9wb3N0aW5zdGFsbChkZXZfcHJpdik7CisJ
aWYgKGludGVsX2lycXNfZW5hYmxlZChpOTE1KSkgeworCQl2bHZfZGlzcGxheV9pcnFfcmVzZXQo
aTkxNSk7CisJCXZsdl9kaXNwbGF5X2lycV9wb3N0aW5zdGFsbChpOTE1KTsKIAl9CiB9CiAKLXZv
aWQgdmFsbGV5dmlld19kaXNhYmxlX2Rpc3BsYXlfaXJxcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCit2b2lkIHZhbGxleXZpZXdfZGlzYWJsZV9kaXNwbGF5X2lycXMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3By
aXYtPmlycV9sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5pcnFfbG9jayk7CiAK
LQlpZiAoIWRldl9wcml2LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkKKwlpZiAoIWk5MTUtPmRpc3Bs
YXlfaXJxc19lbmFibGVkKQogCQlyZXR1cm47CiAKLQlkZXZfcHJpdi0+ZGlzcGxheV9pcnFzX2Vu
YWJsZWQgPSBmYWxzZTsKKwlpOTE1LT5kaXNwbGF5X2lycXNfZW5hYmxlZCA9IGZhbHNlOwogCi0J
aWYgKGludGVsX2lycXNfZW5hYmxlZChkZXZfcHJpdikpCi0JCXZsdl9kaXNwbGF5X2lycV9yZXNl
dChkZXZfcHJpdik7CisJaWYgKGludGVsX2lycXNfZW5hYmxlZChpOTE1KSkKKwkJdmx2X2Rpc3Bs
YXlfaXJxX3Jlc2V0KGk5MTUpOwogfQogCiAKIHN0YXRpYyBpbnQgdmFsbGV5dmlld19pcnFfcG9z
dGluc3RhbGwoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGRldik7CiAKIAlnZW41X2d0X2lycV9wb3N0aW5zdGFsbChkZXYpOwog
Ci0Jc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlpZiAoZGV2X3ByaXYtPmRp
c3BsYXlfaXJxc19lbmFibGVkKQotCQl2bHZfZGlzcGxheV9pcnFfcG9zdGluc3RhbGwoZGV2X3By
aXYpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tf
aXJxKCZpOTE1LT5pcnFfbG9jayk7CisJaWYgKGk5MTUtPmRpc3BsYXlfaXJxc19lbmFibGVkKQor
CQl2bHZfZGlzcGxheV9pcnFfcG9zdGluc3RhbGwoaTkxNSk7CisJc3Bpbl91bmxvY2tfaXJxKCZp
OTE1LT5pcnFfbG9jayk7CiAKIAlJOTE1X1dSSVRFKFZMVl9NQVNURVJfSUVSLCBNQVNURVJfSU5U
RVJSVVBUX0VOQUJMRSk7CiAJUE9TVElOR19SRUFEKFZMVl9NQVNURVJfSUVSKTsKQEAgLTQxMDQs
OSArNDEwNCw5IEBAIHN0YXRpYyBpbnQgdmFsbGV5dmlld19pcnFfcG9zdGluc3RhbGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldikKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOF9ndF9p
cnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgZ2VuOF9ndF9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7
CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAogCS8qIFRo
ZXNlIGFyZSBpbnRlcnJ1cHRzIHdlJ2xsIHRvZ2dsZSB3aXRoIHRoZSByaW5nIG1hc2sgcmVnaXN0
ZXIgKi8KIAl1MzIgZ3RfaW50ZXJydXB0c1tdID0gewpAQCAtNDEyNiwyMSArNDEyNiwyMSBAQCBz
dGF0aWMgdm9pZCBnZW44X2d0X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJCSBHVF9DT05URVhUX1NXSVRDSF9JTlRFUlJVUFQgPDwgR0VOOF9WRUNT
X0lSUV9TSElGVCkKIAl9OwogCi0JZGV2X3ByaXYtPnBtX2llciA9IDB4MDsKLQlkZXZfcHJpdi0+
cG1faW1yID0gfmRldl9wcml2LT5wbV9pZXI7CisJaTkxNS0+cG1faWVyID0gMHgwOworCWk5MTUt
PnBtX2ltciA9IH5pOTE1LT5wbV9pZXI7CiAJR0VOOF9JUlFfSU5JVF9ORFgodW5jb3JlLCBHVCwg
MCwgfmd0X2ludGVycnVwdHNbMF0sIGd0X2ludGVycnVwdHNbMF0pOwogCUdFTjhfSVJRX0lOSVRf
TkRYKHVuY29yZSwgR1QsIDEsIH5ndF9pbnRlcnJ1cHRzWzFdLCBndF9pbnRlcnJ1cHRzWzFdKTsK
IAkvKgogCSAqIFJQUyBpbnRlcnJ1cHRzIHdpbGwgZ2V0IGVuYWJsZWQvZGlzYWJsZWQgb24gZGVt
YW5kIHdoZW4gUlBTIGl0c2VsZgogCSAqIGlzIGVuYWJsZWQvZGlzYWJsZWQuIFNhbWUgd2lsIGJl
IHRoZSBjYXNlIGZvciBHdUMgaW50ZXJydXB0cy4KIAkgKi8KLQlHRU44X0lSUV9JTklUX05EWCh1
bmNvcmUsIEdULCAyLCBkZXZfcHJpdi0+cG1faW1yLCBkZXZfcHJpdi0+cG1faWVyKTsKKwlHRU44
X0lSUV9JTklUX05EWCh1bmNvcmUsIEdULCAyLCBpOTE1LT5wbV9pbXIsIGk5MTUtPnBtX2llcik7
CiAJR0VOOF9JUlFfSU5JVF9ORFgodW5jb3JlLCBHVCwgMywgfmd0X2ludGVycnVwdHNbM10sIGd0
X2ludGVycnVwdHNbM10pOwogfQogCi1zdGF0aWMgdm9pZCBnZW44X2RlX2lycV9wb3N0aW5zdGFs
bChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW44X2Rl
X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwogCiAJdTMyIGRlX3BpcGVfbWFza2Vk
ID0gR0VOOF9QSVBFX0NEQ0xLX0NSQ19ET05FOwogCXUzMiBkZV9waXBlX2VuYWJsZXM7CkBAIC00
MTQ5LDg0ICs0MTQ5LDg0IEBAIHN0YXRpYyB2b2lkIGdlbjhfZGVfaXJxX3Bvc3RpbnN0YWxsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl1MzIgZGVfbWlzY19tYXNrZWQgPSBH
RU44X0RFX0VEUF9QU1I7CiAJZW51bSBwaXBlIHBpcGU7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA8PSAxMCkKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDw9IDEwKQogCQlkZV9taXNjX21hc2tl
ZCB8PSBHRU44X0RFX01JU0NfR1NFOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkg
eworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkgewogCQlkZV9waXBlX21hc2tlZCB8PSBHRU45
X0RFX1BJUEVfSVJRX0ZBVUxUX0VSUk9SUzsKIAkJZGVfcG9ydF9tYXNrZWQgfD0gR0VOOV9BVVhf
Q0hBTk5FTF9CIHwgR0VOOV9BVVhfQ0hBTk5FTF9DIHwKIAkJCQkgIEdFTjlfQVVYX0NIQU5ORUxf
RDsKLQkJaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQorCQlpZiAoSVNfR0VOOV9MUChpOTE1KSkK
IAkJCWRlX3BvcnRfbWFza2VkIHw9IEJYVF9ERV9QT1JUX0dNQlVTOwogCX0gZWxzZSB7CiAJCWRl
X3BpcGVfbWFza2VkIHw9IEdFTjhfREVfUElQRV9JUlFfRkFVTFRfRVJST1JTOwogCX0KIAotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEp
CiAJCWRlX3BvcnRfbWFza2VkIHw9IElDTF9BVVhfQ0hBTk5FTF9FOwogCi0JaWYgKElTX0NOTF9X
SVRIX1BPUlRfRihkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlpZiAo
SVNfQ05MX1dJVEhfUE9SVF9GKGk5MTUpIHx8IElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJZGVf
cG9ydF9tYXNrZWQgfD0gQ05MX0FVWF9DSEFOTkVMX0Y7CiAKIAlkZV9waXBlX2VuYWJsZXMgPSBk
ZV9waXBlX21hc2tlZCB8IEdFTjhfUElQRV9WQkxBTksgfAogCQkJCQkgICBHRU44X1BJUEVfRklG
T19VTkRFUlJVTjsKIAogCWRlX3BvcnRfZW5hYmxlcyA9IGRlX3BvcnRfbWFza2VkOwotCWlmIChJ
U19HRU45X0xQKGRldl9wcml2KSkKKwlpZiAoSVNfR0VOOV9MUChpOTE1KSkKIAkJZGVfcG9ydF9l
bmFibGVzIHw9IEJYVF9ERV9QT1JUX0hPVFBMVUdfTUFTSzsKLQllbHNlIGlmIChJU19CUk9BRFdF
TEwoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0JST0FEV0VMTChpOTE1KSkKIAkJZGVfcG9ydF9l
bmFibGVzIHw9IEdFTjhfUE9SVF9EUF9BX0hPVFBMVUc7CiAKIAlnZW4zX2Fzc2VydF9paXJfaXNf
emVybyh1bmNvcmUsIEVEUF9QU1JfSUlSKTsKLQlpbnRlbF9wc3JfaXJxX2NvbnRyb2woZGV2X3By
aXYsIGRldl9wcml2LT5wc3IuZGVidWcpOworCWludGVsX3Bzcl9pcnFfY29udHJvbChpOTE1LCBp
OTE1LT5wc3IuZGVidWcpOwogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgewotCQlk
ZXZfcHJpdi0+ZGVfaXJxX21hc2tbcGlwZV0gPSB+ZGVfcGlwZV9tYXNrZWQ7CisJZm9yX2VhY2hf
cGlwZShpOTE1LCBwaXBlKSB7CisJCWk5MTUtPmRlX2lycV9tYXNrW3BpcGVdID0gfmRlX3BpcGVf
bWFza2VkOwogCi0JCWlmIChpbnRlbF9kaXNwbGF5X3Bvd2VyX2lzX2VuYWJsZWQoZGV2X3ByaXYs
CisJCWlmIChpbnRlbF9kaXNwbGF5X3Bvd2VyX2lzX2VuYWJsZWQoaTkxNSwKIAkJCQlQT1dFUl9E
T01BSU5fUElQRShwaXBlKSkpCiAJCQlHRU44X0lSUV9JTklUX05EWCh1bmNvcmUsIERFX1BJUEUs
IHBpcGUsCi0JCQkJCSAgZGV2X3ByaXYtPmRlX2lycV9tYXNrW3BpcGVdLAorCQkJCQkgIGk5MTUt
PmRlX2lycV9tYXNrW3BpcGVdLAogCQkJCQkgIGRlX3BpcGVfZW5hYmxlcyk7CiAJfQogCiAJR0VO
M19JUlFfSU5JVCh1bmNvcmUsIEdFTjhfREVfUE9SVF8sIH5kZV9wb3J0X21hc2tlZCwgZGVfcG9y
dF9lbmFibGVzKTsKIAlHRU4zX0lSUV9JTklUKHVuY29yZSwgR0VOOF9ERV9NSVNDXywgfmRlX21p
c2NfbWFza2VkLCBkZV9taXNjX21hc2tlZCk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHsKIAkJdTMyIGRlX2hwZF9tYXNr
ZWQgPSAwOwogCQl1MzIgZGVfaHBkX2VuYWJsZXMgPSBHRU4xMV9ERV9UQ19IT1RQTFVHX01BU0sg
fAogCQkJCSAgICAgR0VOMTFfREVfVEJUX0hPVFBMVUdfTUFTSzsKIAogCQlHRU4zX0lSUV9JTklU
KHVuY29yZSwgR0VOMTFfREVfSFBEXywgfmRlX2hwZF9tYXNrZWQsCiAJCQkgICAgICBkZV9ocGRf
ZW5hYmxlcyk7Ci0JCWdlbjExX2hwZF9kZXRlY3Rpb25fc2V0dXAoZGV2X3ByaXYpOwotCX0gZWxz
ZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKLQkJYnh0X2hwZF9kZXRlY3Rpb25fc2V0dXAo
ZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSkgewotCQlpbGtf
aHBkX2RldGVjdGlvbl9zZXR1cChkZXZfcHJpdik7CisJCWdlbjExX2hwZF9kZXRlY3Rpb25fc2V0
dXAoaTkxNSk7CisJfSBlbHNlIGlmIChJU19HRU45X0xQKGk5MTUpKSB7CisJCWJ4dF9ocGRfZGV0
ZWN0aW9uX3NldHVwKGk5MTUpOworCX0gZWxzZSBpZiAoSVNfQlJPQURXRUxMKGk5MTUpKSB7CisJ
CWlsa19ocGRfZGV0ZWN0aW9uX3NldHVwKGk5MTUpOwogCX0KIH0KIAogc3RhdGljIGludCBnZW44
X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAotCWlmIChIQVNfUENIX1NQTElUKGRldl9w
cml2KSkKKwlpZiAoSEFTX1BDSF9TUExJVChpOTE1KSkKIAkJaWJ4X2lycV9wcmVfcG9zdGluc3Rh
bGwoZGV2KTsKIAotCWdlbjhfZ3RfaXJxX3Bvc3RpbnN0YWxsKGRldl9wcml2KTsKLQlnZW44X2Rl
X2lycV9wb3N0aW5zdGFsbChkZXZfcHJpdik7CisJZ2VuOF9ndF9pcnFfcG9zdGluc3RhbGwoaTkx
NSk7CisJZ2VuOF9kZV9pcnFfcG9zdGluc3RhbGwoaTkxNSk7CiAKLQlpZiAoSEFTX1BDSF9TUExJ
VChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkpCiAJCWlieF9pcnFfcG9zdGlu
c3RhbGwoZGV2KTsKIAotCWdlbjhfbWFzdGVyX2ludHJfZW5hYmxlKGRldl9wcml2LT51bmNvcmUu
cmVncyk7CisJZ2VuOF9tYXN0ZXJfaW50cl9lbmFibGUoaTkxNS0+dW5jb3JlLnJlZ3MpOwogCiAJ
cmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjExX2d0X2lycV9wb3N0aW5zdGFsbChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW4xMV9ndF9pcnFf
cG9zdGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJY29uc3QgdTMy
IGlycXMgPSBHVF9SRU5ERVJfVVNFUl9JTlRFUlJVUFQgfCBHVF9DT05URVhUX1NXSVRDSF9JTlRF
UlJVUFQ7CiAKQEAgLTQyNDcsOCArNDI0Nyw4IEBAIHN0YXRpYyB2b2lkIGdlbjExX2d0X2lycV9w
b3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogUlBTIGlu
dGVycnVwdHMgd2lsbCBnZXQgZW5hYmxlZC9kaXNhYmxlZCBvbiBkZW1hbmQgd2hlbiBSUFMgaXRz
ZWxmCiAJICogaXMgZW5hYmxlZC9kaXNhYmxlZC4KIAkgKi8KLQlkZXZfcHJpdi0+cG1faWVyID0g
MHgwOwotCWRldl9wcml2LT5wbV9pbXIgPSB+ZGV2X3ByaXYtPnBtX2llcjsKKwlpOTE1LT5wbV9p
ZXIgPSAweDA7CisJaTkxNS0+cG1faW1yID0gfmk5MTUtPnBtX2llcjsKIAlJOTE1X1dSSVRFKEdF
TjExX0dQTV9XR0JPWFBFUkZfSU5UUl9FTkFCTEUsIDApOwogCUk5MTVfV1JJVEUoR0VOMTFfR1BN
X1dHQk9YUEVSRl9JTlRSX01BU0ssICB+MCk7CiAKQEAgLTQyNTksMzYgKzQyNTksMzYgQEAgc3Rh
dGljIHZvaWQgZ2VuMTFfZ3RfaXJxX3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAogc3RhdGljIHZvaWQgaWNwX2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2
KTsKIAl1MzIgbWFzayA9IFNERV9HTUJVU19JQ1A7CiAKIAlXQVJOX09OKEk5MTVfUkVBRChTREVJ
RVIpICE9IDApOwogCUk5MTVfV1JJVEUoU0RFSUVSLCAweGZmZmZmZmZmKTsKIAlQT1NUSU5HX1JF
QUQoU0RFSUVSKTsKIAotCWdlbjNfYXNzZXJ0X2lpcl9pc196ZXJvKCZkZXZfcHJpdi0+dW5jb3Jl
LCBTREVJSVIpOworCWdlbjNfYXNzZXJ0X2lpcl9pc196ZXJvKCZpOTE1LT51bmNvcmUsIFNERUlJ
Uik7CiAJSTkxNV9XUklURShTREVJTVIsIH5tYXNrKTsKIAotCWljcF9ocGRfZGV0ZWN0aW9uX3Nl
dHVwKGRldl9wcml2KTsKKwlpY3BfaHBkX2RldGVjdGlvbl9zZXR1cChpOTE1KTsKIH0KIAogc3Rh
dGljIGludCBnZW4xMV9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkZXYtPmRldl9wcml2YXRlOwot
CXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwogCXUzMiBndV9taXNjX21hc2tlZCA9
IEdFTjExX0dVX01JU0NfR1NFOwogCi0JaWYgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQ
Q0hfSUNQKQorCWlmIChJTlRFTF9QQ0hfVFlQRShpOTE1KSA+PSBQQ0hfSUNQKQogCQlpY3BfaXJx
X3Bvc3RpbnN0YWxsKGRldik7CiAKLQlnZW4xMV9ndF9pcnFfcG9zdGluc3RhbGwoZGV2X3ByaXYp
OwotCWdlbjhfZGVfaXJxX3Bvc3RpbnN0YWxsKGRldl9wcml2KTsKKwlnZW4xMV9ndF9pcnFfcG9z
dGluc3RhbGwoaTkxNSk7CisJZ2VuOF9kZV9pcnFfcG9zdGluc3RhbGwoaTkxNSk7CiAKIAlHRU4z
X0lSUV9JTklUKHVuY29yZSwgR0VOMTFfR1VfTUlTQ18sIH5ndV9taXNjX21hc2tlZCwgZ3VfbWlz
Y19tYXNrZWQpOwogCiAJSTkxNV9XUklURShHRU4xMV9ESVNQTEFZX0lOVF9DVEwsIEdFTjExX0RJ
U1BMQVlfSVJRX0VOQUJMRSk7CiAKLQlnZW4xMV9tYXN0ZXJfaW50cl9lbmFibGUoZGV2X3ByaXYt
PnVuY29yZS5yZWdzKTsKKwlnZW4xMV9tYXN0ZXJfaW50cl9lbmFibGUoaTkxNS0+dW5jb3JlLnJl
Z3MpOwogCVBPU1RJTkdfUkVBRChHRU4xMV9HRlhfTVNUUl9JUlEpOwogCiAJcmV0dXJuIDA7CkBA
IC00Mjk2LDE0ICs0Mjk2LDE0IEBAIHN0YXRpYyBpbnQgZ2VuMTFfaXJxX3Bvc3RpbnN0YWxsKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIHN0YXRpYyBpbnQgY2hlcnJ5dmlld19pcnFfcG9zdGlu
c3RhbGwoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGRldik7CiAKLQlnZW44X2d0X2lycV9wb3N0aW5zdGFsbChkZXZfcHJpdik7
CisJZ2VuOF9ndF9pcnFfcG9zdGluc3RhbGwoaTkxNSk7CiAKLQlzcGluX2xvY2tfaXJxKCZkZXZf
cHJpdi0+aXJxX2xvY2spOwotCWlmIChkZXZfcHJpdi0+ZGlzcGxheV9pcnFzX2VuYWJsZWQpCi0J
CXZsdl9kaXNwbGF5X2lycV9wb3N0aW5zdGFsbChkZXZfcHJpdik7Ci0Jc3Bpbl91bmxvY2tfaXJx
KCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsK
KwlpZiAoaTkxNS0+ZGlzcGxheV9pcnFzX2VuYWJsZWQpCisJCXZsdl9kaXNwbGF5X2lycV9wb3N0
aW5zdGFsbChpOTE1KTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAogCUk5
MTVfV1JJVEUoR0VOOF9NQVNURVJfSVJRLCBHRU44X01BU1RFUl9JUlFfQ09OVFJPTCk7CiAJUE9T
VElOR19SRUFEKEdFTjhfTUFTVEVSX0lSUSk7CkBAIC00MzEzLDE4ICs0MzEzLDE4IEBAIHN0YXRp
YyBpbnQgY2hlcnJ5dmlld19pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9kZXZpY2UgKmRldikK
IAogc3RhdGljIHZvaWQgaTh4eF9pcnFfcmVzZXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX3VuY29y
ZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAotCWk5eHhfcGlwZXN0YXRfaXJxX3Jlc2V0KGRl
dl9wcml2KTsKKwlpOXh4X3BpcGVzdGF0X2lycV9yZXNldChpOTE1KTsKIAogCUdFTjJfSVJRX1JF
U0VUKHVuY29yZSk7CiB9CiAKIHN0YXRpYyBpbnQgaTh4eF9pcnFfcG9zdGluc3RhbGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2
LT51bmNvcmU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7
CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAl1MTYgZW5h
YmxlX21hc2s7CiAKIAlpbnRlbF91bmNvcmVfd3JpdGUxNih1bmNvcmUsCkBAIC00MzMzLDcgKzQz
MzMsNyBAQCBzdGF0aWMgaW50IGk4eHhfaXJxX3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYpCiAJCQkgICAgICAgSTkxNV9FUlJPUl9NRU1PUllfUkVGUkVTSCkpOwogCiAJLyogVW5t
YXNrIHRoZSBpbnRlcnJ1cHRzIHRoYXQgd2UgYWx3YXlzIHdhbnQgb24uICovCi0JZGV2X3ByaXYt
PmlycV9tYXNrID0KKwlpOTE1LT5pcnFfbWFzayA9CiAJCX4oSTkxNV9ESVNQTEFZX1BJUEVfQV9F
VkVOVF9JTlRFUlJVUFQgfAogCQkgIEk5MTVfRElTUExBWV9QSVBFX0JfRVZFTlRfSU5URVJSVVBU
IHwKIAkJICBJOTE1X01BU1RFUl9FUlJPUl9JTlRFUlJVUFQpOwpAQCAtNDM0NCwxNCArNDM0NCwx
NCBAQCBzdGF0aWMgaW50IGk4eHhfaXJxX3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpCiAJCUk5MTVfTUFTVEVSX0VSUk9SX0lOVEVSUlVQVCB8CiAJCUk5MTVfVVNFUl9JTlRFUlJV
UFQ7CiAKLQlHRU4yX0lSUV9JTklUKHVuY29yZSwgZGV2X3ByaXYtPmlycV9tYXNrLCBlbmFibGVf
bWFzayk7CisJR0VOMl9JUlFfSU5JVCh1bmNvcmUsIGk5MTUtPmlycV9tYXNrLCBlbmFibGVfbWFz
ayk7CiAKIAkvKiBJbnRlcnJ1cHQgc2V0dXAgaXMgYWxyZWFkeSBndWFyYW50ZWVkIHRvIGJlIHNp
bmdsZS10aHJlYWRlZCwgdGhpcyBpcwogCSAqIGp1c3QgdG8gbWFrZSB0aGUgYXNzZXJ0X3NwaW5f
bG9ja2VkIGNoZWNrIGhhcHB5LiAqLwotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9j
ayk7Ci0JaTkxNV9lbmFibGVfcGlwZXN0YXQoZGV2X3ByaXYsIFBJUEVfQSwgUElQRV9DUkNfRE9O
RV9JTlRFUlJVUFRfU1RBVFVTKTsKLQlpOTE1X2VuYWJsZV9waXBlc3RhdChkZXZfcHJpdiwgUElQ
RV9CLCBQSVBFX0NSQ19ET05FX0lOVEVSUlVQVF9TVEFUVVMpOwotCXNwaW5fdW5sb2NrX2lycSgm
ZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJ
aTkxNV9lbmFibGVfcGlwZXN0YXQoaTkxNSwgUElQRV9BLCBQSVBFX0NSQ19ET05FX0lOVEVSUlVQ
VF9TVEFUVVMpOworCWk5MTVfZW5hYmxlX3BpcGVzdGF0KGk5MTUsIFBJUEVfQiwgUElQRV9DUkNf
RE9ORV9JTlRFUlJVUFRfU1RBVFVTKTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2Nr
KTsKIAogCXJldHVybiAwOwogfQpAQCAtNDM4Niw3ICs0Mzg2LDcgQEAgc3RhdGljIHZvaWQgaTh4
eF9lcnJvcl9pcnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWludGVsX3Vu
Y29yZV93cml0ZTE2KHVuY29yZSwgRU1SLCBlbXIgfCAqZWlyX3N0dWNrKTsKIH0KIAotc3RhdGlj
IHZvaWQgaTh4eF9lcnJvcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBpOHh4X2Vycm9yX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJCSAgIHUxNiBlaXIsIHUxNiBlaXJfc3R1Y2spCiB7CiAJRFJN
X0RFQlVHKCJNYXN0ZXIgRXJyb3I6IEVJUiAweCUwNHhcbiIsIGVpcik7CkBAIC00Mzk1LDcgKzQz
OTUsNyBAQCBzdGF0aWMgdm9pZCBpOHh4X2Vycm9yX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkJRFJNX0RFQlVHX0RSSVZFUigiRUlSIHN0dWNrOiAweCUw
NHgsIG1hc2tlZFxuIiwgZWlyX3N0dWNrKTsKIH0KIAotc3RhdGljIHZvaWQgaTl4eF9lcnJvcl9p
cnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGk5
eHhfZXJyb3JfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAg
ICB1MzIgKmVpciwgdTMyICplaXJfc3R1Y2spCiB7CiAJdTMyIGVtcjsKQEAgLTQ0MjMsNyArNDQy
Myw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfZXJyb3JfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJSTkxNV9XUklURShFTVIsIGVtciB8ICplaXJfc3R1Y2spOwogfQog
Ci1zdGF0aWMgdm9pZCBpOXh4X2Vycm9yX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGk5eHhfZXJyb3JfaXJxX2hhbmRsZXIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgdTMyIGVpciwgdTMyIGVpcl9zdHVjaykK
IHsKIAlEUk1fREVCVUcoIk1hc3RlciBFcnJvciwgRUlSIDB4JTA4eFxuIiwgZWlyKTsKQEAgLTQ0
MzUsMjEgKzQ0MzUsMjEgQEAgc3RhdGljIHZvaWQgaTl4eF9lcnJvcl9pcnFfaGFuZGxlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgaXJxcmV0dXJuX3QgaTh4eF9p
cnFfaGFuZGxlcihpbnQgaXJxLCB2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGFyZzsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJaXJx
cmV0dXJuX3QgcmV0ID0gSVJRX05PTkU7CiAKLQlpZiAoIWludGVsX2lycXNfZW5hYmxlZChkZXZf
cHJpdikpCisJaWYgKCFpbnRlbF9pcnFzX2VuYWJsZWQoaTkxNSkpCiAJCXJldHVybiBJUlFfTk9O
RTsKIAogCS8qIElSUXMgYXJlIHN5bmNlZCBkdXJpbmcgcnVudGltZV9zdXNwZW5kLCB3ZSBkb24n
dCByZXF1aXJlIGEgd2FrZXJlZiAqLwotCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZf
cHJpdik7CisJZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGk5MTUpOwogCiAJZG8gewogCQl1
MzIgcGlwZV9zdGF0c1tJOTE1X01BWF9QSVBFU10gPSB7fTsKIAkJdTE2IGVpciA9IDAsIGVpcl9z
dHVjayA9IDA7CiAJCXUxNiBpaXI7CiAKLQkJaWlyID0gaW50ZWxfdW5jb3JlX3JlYWQxNigmZGV2
X3ByaXYtPnVuY29yZSwgR0VOMl9JSVIpOworCQlpaXIgPSBpbnRlbF91bmNvcmVfcmVhZDE2KCZp
OTE1LT51bmNvcmUsIEdFTjJfSUlSKTsKIAkJaWYgKGlpciA9PSAwKQogCQkJYnJlYWs7CiAKQEAg
LTQ0NTcsNTMgKzQ0NTcsNTMgQEAgc3RhdGljIGlycXJldHVybl90IGk4eHhfaXJxX2hhbmRsZXIo
aW50IGlycSwgdm9pZCAqYXJnKQogCiAJCS8qIENhbGwgcmVnYXJkbGVzcywgYXMgc29tZSBzdGF0
dXMgYml0cyBtaWdodCBub3QgYmUKIAkJICogc2lnbmFsbGVkIGluIGlpciAqLwotCQlpOXh4X3Bp
cGVzdGF0X2lycV9hY2soZGV2X3ByaXYsIGlpciwgcGlwZV9zdGF0cyk7CisJCWk5eHhfcGlwZXN0
YXRfaXJxX2FjayhpOTE1LCBpaXIsIHBpcGVfc3RhdHMpOwogCiAJCWlmIChpaXIgJiBJOTE1X01B
U1RFUl9FUlJPUl9JTlRFUlJVUFQpCi0JCQlpOHh4X2Vycm9yX2lycV9hY2soZGV2X3ByaXYsICZl
aXIsICZlaXJfc3R1Y2spOworCQkJaTh4eF9lcnJvcl9pcnFfYWNrKGk5MTUsICZlaXIsICZlaXJf
c3R1Y2spOwogCi0JCWludGVsX3VuY29yZV93cml0ZTE2KCZkZXZfcHJpdi0+dW5jb3JlLCBHRU4y
X0lJUiwgaWlyKTsKKwkJaW50ZWxfdW5jb3JlX3dyaXRlMTYoJmk5MTUtPnVuY29yZSwgR0VOMl9J
SVIsIGlpcik7CiAKIAkJaWYgKGlpciAmIEk5MTVfVVNFUl9JTlRFUlJVUFQpCi0JCQlpbnRlbF9l
bmdpbmVfYnJlYWRjcnVtYnNfaXJxKGRldl9wcml2LT5lbmdpbmVbUkNTMF0pOworCQkJaW50ZWxf
ZW5naW5lX2JyZWFkY3J1bWJzX2lycShpOTE1LT5lbmdpbmVbUkNTMF0pOwogCiAJCWlmIChpaXIg
JiBJOTE1X01BU1RFUl9FUlJPUl9JTlRFUlJVUFQpCi0JCQlpOHh4X2Vycm9yX2lycV9oYW5kbGVy
KGRldl9wcml2LCBlaXIsIGVpcl9zdHVjayk7CisJCQlpOHh4X2Vycm9yX2lycV9oYW5kbGVyKGk5
MTUsIGVpciwgZWlyX3N0dWNrKTsKIAotCQlpOHh4X3BpcGVzdGF0X2lycV9oYW5kbGVyKGRldl9w
cml2LCBpaXIsIHBpcGVfc3RhdHMpOworCQlpOHh4X3BpcGVzdGF0X2lycV9oYW5kbGVyKGk5MTUs
IGlpciwgcGlwZV9zdGF0cyk7CiAJfSB3aGlsZSAoMCk7CiAKLQllbmFibGVfcnBtX3dha2VyZWZf
YXNzZXJ0cyhkZXZfcHJpdik7CisJZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CiAK
IAlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCBpOTE1X2lycV9yZXNldChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVu
Y29yZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKKwlz
dHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwogCi0JaWYgKEk5MTVf
SEFTX0hPVFBMVUcoZGV2X3ByaXYpKSB7Ci0JCWk5MTVfaG90cGx1Z19pbnRlcnJ1cHRfdXBkYXRl
KGRldl9wcml2LCAweGZmZmZmZmZmLCAwKTsKKwlpZiAoSTkxNV9IQVNfSE9UUExVRyhpOTE1KSkg
eworCQlpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3VwZGF0ZShpOTE1LCAweGZmZmZmZmZmLCAwKTsK
IAkJSTkxNV9XUklURShQT1JUX0hPVFBMVUdfU1RBVCwgSTkxNV9SRUFEKFBPUlRfSE9UUExVR19T
VEFUKSk7CiAJfQogCi0JaTl4eF9waXBlc3RhdF9pcnFfcmVzZXQoZGV2X3ByaXYpOworCWk5eHhf
cGlwZXN0YXRfaXJxX3Jlc2V0KGk5MTUpOwogCiAJR0VOM19JUlFfUkVTRVQodW5jb3JlLCBHRU4y
Xyk7CiB9CiAKIHN0YXRpYyBpbnQgaTkxNV9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGRldik7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAl1MzIgZW5hYmxlX21hc2s7
CiAKIAlJOTE1X1dSSVRFKEVNUiwgfihJOTE1X0VSUk9SX1BBR0VfVEFCTEUgfAogCQkJICBJOTE1
X0VSUk9SX01FTU9SWV9SRUZSRVNIKSk7CiAKIAkvKiBVbm1hc2sgdGhlIGludGVycnVwdHMgdGhh
dCB3ZSBhbHdheXMgd2FudCBvbi4gKi8KLQlkZXZfcHJpdi0+aXJxX21hc2sgPQorCWk5MTUtPmly
cV9tYXNrID0KIAkJfihJOTE1X0FTTEVfSU5URVJSVVBUIHwKIAkJICBJOTE1X0RJU1BMQVlfUElQ
RV9BX0VWRU5UX0lOVEVSUlVQVCB8CiAJCSAgSTkxNV9ESVNQTEFZX1BJUEVfQl9FVkVOVF9JTlRF
UlJVUFQgfApAQCAtNDUxNiwyMyArNDUxNiwyMyBAQCBzdGF0aWMgaW50IGk5MTVfaXJxX3Bvc3Rp
bnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCUk5MTVfTUFTVEVSX0VSUk9SX0lOVEVS
UlVQVCB8CiAJCUk5MTVfVVNFUl9JTlRFUlJVUFQ7CiAKLQlpZiAoSTkxNV9IQVNfSE9UUExVRyhk
ZXZfcHJpdikpIHsKKwlpZiAoSTkxNV9IQVNfSE9UUExVRyhpOTE1KSkgewogCQkvKiBFbmFibGUg
aW4gSUVSLi4uICovCiAJCWVuYWJsZV9tYXNrIHw9IEk5MTVfRElTUExBWV9QT1JUX0lOVEVSUlVQ
VDsKIAkJLyogYW5kIHVubWFzayBpbiBJTVIgKi8KLQkJZGV2X3ByaXYtPmlycV9tYXNrICY9IH5J
OTE1X0RJU1BMQVlfUE9SVF9JTlRFUlJVUFQ7CisJCWk5MTUtPmlycV9tYXNrICY9IH5JOTE1X0RJ
U1BMQVlfUE9SVF9JTlRFUlJVUFQ7CiAJfQogCi0JR0VOM19JUlFfSU5JVCh1bmNvcmUsIEdFTjJf
LCBkZXZfcHJpdi0+aXJxX21hc2ssIGVuYWJsZV9tYXNrKTsKKwlHRU4zX0lSUV9JTklUKHVuY29y
ZSwgR0VOMl8sIGk5MTUtPmlycV9tYXNrLCBlbmFibGVfbWFzayk7CiAKIAkvKiBJbnRlcnJ1cHQg
c2V0dXAgaXMgYWxyZWFkeSBndWFyYW50ZWVkIHRvIGJlIHNpbmdsZS10aHJlYWRlZCwgdGhpcyBp
cwogCSAqIGp1c3QgdG8gbWFrZSB0aGUgYXNzZXJ0X3NwaW5fbG9ja2VkIGNoZWNrIGhhcHB5LiAq
LwotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JaTkxNV9lbmFibGVfcGlw
ZXN0YXQoZGV2X3ByaXYsIFBJUEVfQSwgUElQRV9DUkNfRE9ORV9JTlRFUlJVUFRfU1RBVFVTKTsK
LQlpOTE1X2VuYWJsZV9waXBlc3RhdChkZXZfcHJpdiwgUElQRV9CLCBQSVBFX0NSQ19ET05FX0lO
VEVSUlVQVF9TVEFUVVMpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsK
KwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJaTkxNV9lbmFibGVfcGlwZXN0YXQo
aTkxNSwgUElQRV9BLCBQSVBFX0NSQ19ET05FX0lOVEVSUlVQVF9TVEFUVVMpOworCWk5MTVfZW5h
YmxlX3BpcGVzdGF0KGk5MTUsIFBJUEVfQiwgUElQRV9DUkNfRE9ORV9JTlRFUlJVUFRfU1RBVFVT
KTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAotCWk5MTVfZW5hYmxlX2Fz
bGVfcGlwZXN0YXQoZGV2X3ByaXYpOworCWk5MTVfZW5hYmxlX2FzbGVfcGlwZXN0YXQoaTkxNSk7
CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTQ1NDAsMTQgKzQ1NDAsMTQgQEAgc3RhdGljIGludCBpOTE1
X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogc3RhdGljIGlycXJldHVy
bl90IGk5MTVfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSBhcmc7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShk
ZXYpOwogCWlycXJldHVybl90IHJldCA9IElSUV9OT05FOwogCi0JaWYgKCFpbnRlbF9pcnFzX2Vu
YWJsZWQoZGV2X3ByaXYpKQorCWlmICghaW50ZWxfaXJxc19lbmFibGVkKGk5MTUpKQogCQlyZXR1
cm4gSVJRX05PTkU7CiAKIAkvKiBJUlFzIGFyZSBzeW5jZWQgZHVyaW5nIHJ1bnRpbWVfc3VzcGVu
ZCwgd2UgZG9uJ3QgcmVxdWlyZSBhIHdha2VyZWYgKi8KLQlkaXNhYmxlX3JwbV93YWtlcmVmX2Fz
c2VydHMoZGV2X3ByaXYpOworCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhpOTE1KTsKIAog
CWRvIHsKIAkJdTMyIHBpcGVfc3RhdHNbSTkxNV9NQVhfUElQRVNdID0ge307CkBAIC00NTYxLDUz
ICs0NTYxLDUzIEBAIHN0YXRpYyBpcnFyZXR1cm5fdCBpOTE1X2lycV9oYW5kbGVyKGludCBpcnEs
IHZvaWQgKmFyZykKIAogCQlyZXQgPSBJUlFfSEFORExFRDsKIAotCQlpZiAoSTkxNV9IQVNfSE9U
UExVRyhkZXZfcHJpdikgJiYKKwkJaWYgKEk5MTVfSEFTX0hPVFBMVUcoaTkxNSkgJiYKIAkJICAg
IGlpciAmIEk5MTVfRElTUExBWV9QT1JUX0lOVEVSUlVQVCkKLQkJCWhvdHBsdWdfc3RhdHVzID0g
aTl4eF9ocGRfaXJxX2FjayhkZXZfcHJpdik7CisJCQlob3RwbHVnX3N0YXR1cyA9IGk5eHhfaHBk
X2lycV9hY2soaTkxNSk7CiAKIAkJLyogQ2FsbCByZWdhcmRsZXNzLCBhcyBzb21lIHN0YXR1cyBi
aXRzIG1pZ2h0IG5vdCBiZQogCQkgKiBzaWduYWxsZWQgaW4gaWlyICovCi0JCWk5eHhfcGlwZXN0
YXRfaXJxX2FjayhkZXZfcHJpdiwgaWlyLCBwaXBlX3N0YXRzKTsKKwkJaTl4eF9waXBlc3RhdF9p
cnFfYWNrKGk5MTUsIGlpciwgcGlwZV9zdGF0cyk7CiAKIAkJaWYgKGlpciAmIEk5MTVfTUFTVEVS
X0VSUk9SX0lOVEVSUlVQVCkKLQkJCWk5eHhfZXJyb3JfaXJxX2FjayhkZXZfcHJpdiwgJmVpciwg
JmVpcl9zdHVjayk7CisJCQlpOXh4X2Vycm9yX2lycV9hY2soaTkxNSwgJmVpciwgJmVpcl9zdHVj
ayk7CiAKIAkJSTkxNV9XUklURShHRU4yX0lJUiwgaWlyKTsKIAogCQlpZiAoaWlyICYgSTkxNV9V
U0VSX0lOVEVSUlVQVCkKLQkJCWludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEoZGV2X3ByaXYt
PmVuZ2luZVtSQ1MwXSk7CisJCQlpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxKGk5MTUtPmVu
Z2luZVtSQ1MwXSk7CiAKIAkJaWYgKGlpciAmIEk5MTVfTUFTVEVSX0VSUk9SX0lOVEVSUlVQVCkK
LQkJCWk5eHhfZXJyb3JfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIGVpciwgZWlyX3N0dWNrKTsKKwkJ
CWk5eHhfZXJyb3JfaXJxX2hhbmRsZXIoaTkxNSwgZWlyLCBlaXJfc3R1Y2spOwogCiAJCWlmICho
b3RwbHVnX3N0YXR1cykKLQkJCWk5eHhfaHBkX2lycV9oYW5kbGVyKGRldl9wcml2LCBob3RwbHVn
X3N0YXR1cyk7CisJCQlpOXh4X2hwZF9pcnFfaGFuZGxlcihpOTE1LCBob3RwbHVnX3N0YXR1cyk7
CiAKLQkJaTkxNV9waXBlc3RhdF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgaWlyLCBwaXBlX3N0YXRz
KTsKKwkJaTkxNV9waXBlc3RhdF9pcnFfaGFuZGxlcihpOTE1LCBpaXIsIHBpcGVfc3RhdHMpOwog
CX0gd2hpbGUgKDApOwogCi0JZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoZGV2X3ByaXYpOwor
CWVuYWJsZV9ycG1fd2FrZXJlZl9hc3NlcnRzKGk5MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KIAog
c3RhdGljIHZvaWQgaTk2NV9pcnFfcmVzZXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0
IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX3VuY29yZSAq
dW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAotCWk5MTVfaG90cGx1Z19pbnRlcnJ1cHRfdXBkYXRl
KGRldl9wcml2LCAweGZmZmZmZmZmLCAwKTsKKwlpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3VwZGF0
ZShpOTE1LCAweGZmZmZmZmZmLCAwKTsKIAlJOTE1X1dSSVRFKFBPUlRfSE9UUExVR19TVEFULCBJ
OTE1X1JFQUQoUE9SVF9IT1RQTFVHX1NUQVQpKTsKIAotCWk5eHhfcGlwZXN0YXRfaXJxX3Jlc2V0
KGRldl9wcml2KTsKKwlpOXh4X3BpcGVzdGF0X2lycV9yZXNldChpOTE1KTsKIAogCUdFTjNfSVJR
X1JFU0VUKHVuY29yZSwgR0VOMl8pOwogfQogCiBzdGF0aWMgaW50IGk5NjVfaXJxX3Bvc3RpbnN0
YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9
ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShkZXYpOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1LT51bmNvcmU7
CiAJdTMyIGVuYWJsZV9tYXNrOwogCXUzMiBlcnJvcl9tYXNrOwogCkBAIC00NjE1LDcgKzQ2MTUs
NyBAQCBzdGF0aWMgaW50IGk5NjVfaXJxX3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpCiAJICogRW5hYmxlIHNvbWUgZXJyb3IgZGV0ZWN0aW9uLCBub3RlIHRoZSBpbnN0cnVjdGlv
biBlcnJvciBtYXNrCiAJICogYml0IGlzIHJlc2VydmVkLCBzbyB3ZSBsZWF2ZSBpdCBtYXNrZWQu
CiAJICovCi0JaWYgKElTX0c0WChkZXZfcHJpdikpIHsKKwlpZiAoSVNfRzRYKGk5MTUpKSB7CiAJ
CWVycm9yX21hc2sgPSB+KEdNNDVfRVJST1JfUEFHRV9UQUJMRSB8CiAJCQkgICAgICAgR000NV9F
UlJPUl9NRU1fUFJJViB8CiAJCQkgICAgICAgR000NV9FUlJPUl9DUF9QUklWIHwKQEAgLTQ2Mjcs
NyArNDYyNyw3IEBAIHN0YXRpYyBpbnQgaTk2NV9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldikKIAlJOTE1X1dSSVRFKEVNUiwgZXJyb3JfbWFzayk7CiAKIAkvKiBVbm1hc2sg
dGhlIGludGVycnVwdHMgdGhhdCB3ZSBhbHdheXMgd2FudCBvbi4gKi8KLQlkZXZfcHJpdi0+aXJx
X21hc2sgPQorCWk5MTUtPmlycV9tYXNrID0KIAkJfihJOTE1X0FTTEVfSU5URVJSVVBUIHwKIAkJ
ICBJOTE1X0RJU1BMQVlfUE9SVF9JTlRFUlJVUFQgfAogCQkgIEk5MTVfRElTUExBWV9QSVBFX0Ff
RVZFTlRfSU5URVJSVVBUIHwKQEAgLTQ2NDIsNDMgKzQ2NDIsNDMgQEAgc3RhdGljIGludCBpOTY1
X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQlJOTE1X01BU1RFUl9F
UlJPUl9JTlRFUlJVUFQgfAogCQlJOTE1X1VTRVJfSU5URVJSVVBUOwogCi0JaWYgKElTX0c0WChk
ZXZfcHJpdikpCisJaWYgKElTX0c0WChpOTE1KSkKIAkJZW5hYmxlX21hc2sgfD0gSTkxNV9CU0Rf
VVNFUl9JTlRFUlJVUFQ7CiAKLQlHRU4zX0lSUV9JTklUKHVuY29yZSwgR0VOMl8sIGRldl9wcml2
LT5pcnFfbWFzaywgZW5hYmxlX21hc2spOworCUdFTjNfSVJRX0lOSVQodW5jb3JlLCBHRU4yXywg
aTkxNS0+aXJxX21hc2ssIGVuYWJsZV9tYXNrKTsKIAogCS8qIEludGVycnVwdCBzZXR1cCBpcyBh
bHJlYWR5IGd1YXJhbnRlZWQgdG8gYmUgc2luZ2xlLXRocmVhZGVkLCB0aGlzIGlzCiAJICoganVz
dCB0byBtYWtlIHRoZSBhc3NlcnRfc3Bpbl9sb2NrZWQgY2hlY2sgaGFwcHkuICovCi0Jc3Bpbl9s
b2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlpOTE1X2VuYWJsZV9waXBlc3RhdChkZXZf
cHJpdiwgUElQRV9BLCBQSVBFX0dNQlVTX0lOVEVSUlVQVF9TVEFUVVMpOwotCWk5MTVfZW5hYmxl
X3BpcGVzdGF0KGRldl9wcml2LCBQSVBFX0EsIFBJUEVfQ1JDX0RPTkVfSU5URVJSVVBUX1NUQVRV
Uyk7Ci0JaTkxNV9lbmFibGVfcGlwZXN0YXQoZGV2X3ByaXYsIFBJUEVfQiwgUElQRV9DUkNfRE9O
RV9JTlRFUlJVUFRfU1RBVFVTKTsKLQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9j
ayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCWk5MTVfZW5hYmxlX3BpcGVz
dGF0KGk5MTUsIFBJUEVfQSwgUElQRV9HTUJVU19JTlRFUlJVUFRfU1RBVFVTKTsKKwlpOTE1X2Vu
YWJsZV9waXBlc3RhdChpOTE1LCBQSVBFX0EsIFBJUEVfQ1JDX0RPTkVfSU5URVJSVVBUX1NUQVRV
Uyk7CisJaTkxNV9lbmFibGVfcGlwZXN0YXQoaTkxNSwgUElQRV9CLCBQSVBFX0NSQ19ET05FX0lO
VEVSUlVQVF9TVEFUVVMpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCi0J
aTkxNV9lbmFibGVfYXNsZV9waXBlc3RhdChkZXZfcHJpdik7CisJaTkxNV9lbmFibGVfYXNsZV9w
aXBlc3RhdChpOTE1KTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBpOTE1X2hwZF9p
cnFfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQg
aTkxNV9ocGRfaXJxX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXUz
MiBob3RwbHVnX2VuOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmlycV9sb2Nr
KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5pcnFfbG9jayk7CiAKIAkvKiBOb3RlIEhE
TUkgYW5kIERQIHNoYXJlIGhvdHBsdWcgYml0cyAqLwogCS8qIGVuYWJsZSBiaXRzIGFyZSB0aGUg
c2FtZSBmb3IgYWxsIGdlbmVyYXRpb25zICovCi0JaG90cGx1Z19lbiA9IGludGVsX2hwZF9lbmFi
bGVkX2lycXMoZGV2X3ByaXYsIGhwZF9tYXNrX2k5MTUpOworCWhvdHBsdWdfZW4gPSBpbnRlbF9o
cGRfZW5hYmxlZF9pcnFzKGk5MTUsIGhwZF9tYXNrX2k5MTUpOwogCS8qIFByb2dyYW1taW5nIHRo
ZSBDUlQgZGV0ZWN0aW9uIHBhcmFtZXRlcnMgdGVuZHMKIAkgICB0byBnZW5lcmF0ZSBhIHNwdXJp
b3VzIGhvdHBsdWcgZXZlbnQgYWJvdXQgdGhyZWUKIAkgICBzZWNvbmRzIGxhdGVyLiAgU28ganVz
dCBkbyBpdCBvbmNlLgogCSovCi0JaWYgKElTX0c0WChkZXZfcHJpdikpCisJaWYgKElTX0c0WChp
OTE1KSkKIAkJaG90cGx1Z19lbiB8PSBDUlRfSE9UUExVR19BQ1RJVkFUSU9OX1BFUklPRF82NDsK
IAlob3RwbHVnX2VuIHw9IENSVF9IT1RQTFVHX1ZPTFRBR0VfQ09NUEFSRV81MDsKIAogCS8qIEln
bm9yZSBUViBzaW5jZSBpdCdzIGJ1Z2d5ICovCi0JaTkxNV9ob3RwbHVnX2ludGVycnVwdF91cGRh
dGVfbG9ja2VkKGRldl9wcml2LAorCWk5MTVfaG90cGx1Z19pbnRlcnJ1cHRfdXBkYXRlX2xvY2tl
ZChpOTE1LAogCQkJCQkgICAgIEhPVFBMVUdfSU5UX0VOX01BU0sgfAogCQkJCQkgICAgIENSVF9I
T1RQTFVHX1ZPTFRBR0VfQ09NUEFSRV9NQVNLIHwKIAkJCQkJICAgICBDUlRfSE9UUExVR19BQ1RJ
VkFUSU9OX1BFUklPRF82NCwKQEAgLTQ2ODgsMTQgKzQ2ODgsMTQgQEAgc3RhdGljIHZvaWQgaTkx
NV9ocGRfaXJxX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHN0YXRp
YyBpcnFyZXR1cm5fdCBpOTY1X2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKIHsKIAlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gYXJnOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGV2KTsKIAlpcnFyZXR1cm5fdCByZXQgPSBJUlFfTk9ORTsKIAotCWlmICghaW50
ZWxfaXJxc19lbmFibGVkKGRldl9wcml2KSkKKwlpZiAoIWludGVsX2lycXNfZW5hYmxlZChpOTE1
KSkKIAkJcmV0dXJuIElSUV9OT05FOwogCiAJLyogSVJRcyBhcmUgc3luY2VkIGR1cmluZyBydW50
aW1lX3N1c3BlbmQsIHdlIGRvbid0IHJlcXVpcmUgYSB3YWtlcmVmICovCi0JZGlzYWJsZV9ycG1f
d2FrZXJlZl9hc3NlcnRzKGRldl9wcml2KTsKKwlkaXNhYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMo
aTkxNSk7CiAKIAlkbyB7CiAJCXUzMiBwaXBlX3N0YXRzW0k5MTVfTUFYX1BJUEVTXSA9IHt9OwpA
QCAtNDcxMCw3NiArNDcxMCw3NiBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgaTk2NV9pcnFfaGFuZGxl
cihpbnQgaXJxLCB2b2lkICphcmcpCiAJCXJldCA9IElSUV9IQU5ETEVEOwogCiAJCWlmIChpaXIg
JiBJOTE1X0RJU1BMQVlfUE9SVF9JTlRFUlJVUFQpCi0JCQlob3RwbHVnX3N0YXR1cyA9IGk5eHhf
aHBkX2lycV9hY2soZGV2X3ByaXYpOworCQkJaG90cGx1Z19zdGF0dXMgPSBpOXh4X2hwZF9pcnFf
YWNrKGk5MTUpOwogCiAJCS8qIENhbGwgcmVnYXJkbGVzcywgYXMgc29tZSBzdGF0dXMgYml0cyBt
aWdodCBub3QgYmUKIAkJICogc2lnbmFsbGVkIGluIGlpciAqLwotCQlpOXh4X3BpcGVzdGF0X2ly
cV9hY2soZGV2X3ByaXYsIGlpciwgcGlwZV9zdGF0cyk7CisJCWk5eHhfcGlwZXN0YXRfaXJxX2Fj
ayhpOTE1LCBpaXIsIHBpcGVfc3RhdHMpOwogCiAJCWlmIChpaXIgJiBJOTE1X01BU1RFUl9FUlJP
Ul9JTlRFUlJVUFQpCi0JCQlpOXh4X2Vycm9yX2lycV9hY2soZGV2X3ByaXYsICZlaXIsICZlaXJf
c3R1Y2spOworCQkJaTl4eF9lcnJvcl9pcnFfYWNrKGk5MTUsICZlaXIsICZlaXJfc3R1Y2spOwog
CiAJCUk5MTVfV1JJVEUoR0VOMl9JSVIsIGlpcik7CiAKIAkJaWYgKGlpciAmIEk5MTVfVVNFUl9J
TlRFUlJVUFQpCi0JCQlpbnRlbF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxKGRldl9wcml2LT5lbmdp
bmVbUkNTMF0pOworCQkJaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShpOTE1LT5lbmdpbmVb
UkNTMF0pOwogCiAJCWlmIChpaXIgJiBJOTE1X0JTRF9VU0VSX0lOVEVSUlVQVCkKLQkJCWludGVs
X2VuZ2luZV9icmVhZGNydW1ic19pcnEoZGV2X3ByaXYtPmVuZ2luZVtWQ1MwXSk7CisJCQlpbnRl
bF9lbmdpbmVfYnJlYWRjcnVtYnNfaXJxKGk5MTUtPmVuZ2luZVtWQ1MwXSk7CiAKIAkJaWYgKGlp
ciAmIEk5MTVfTUFTVEVSX0VSUk9SX0lOVEVSUlVQVCkKLQkJCWk5eHhfZXJyb3JfaXJxX2hhbmRs
ZXIoZGV2X3ByaXYsIGVpciwgZWlyX3N0dWNrKTsKKwkJCWk5eHhfZXJyb3JfaXJxX2hhbmRsZXIo
aTkxNSwgZWlyLCBlaXJfc3R1Y2spOwogCiAJCWlmIChob3RwbHVnX3N0YXR1cykKLQkJCWk5eHhf
aHBkX2lycV9oYW5kbGVyKGRldl9wcml2LCBob3RwbHVnX3N0YXR1cyk7CisJCQlpOXh4X2hwZF9p
cnFfaGFuZGxlcihpOTE1LCBob3RwbHVnX3N0YXR1cyk7CiAKLQkJaTk2NV9waXBlc3RhdF9pcnFf
aGFuZGxlcihkZXZfcHJpdiwgaWlyLCBwaXBlX3N0YXRzKTsKKwkJaTk2NV9waXBlc3RhdF9pcnFf
aGFuZGxlcihpOTE1LCBpaXIsIHBpcGVfc3RhdHMpOwogCX0gd2hpbGUgKDApOwogCi0JZW5hYmxl
X3JwbV93YWtlcmVmX2Fzc2VydHMoZGV2X3ByaXYpOworCWVuYWJsZV9ycG1fd2FrZXJlZl9hc3Nl
cnRzKGk5MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KIAogLyoqCiAgKiBpbnRlbF9pcnFfaW5pdCAt
IGluaXRpYWxpemVzIGlycSBzdXBwb3J0Ci0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGluc3Rh
bmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqCiAgKiBUaGlzIGZ1bmN0aW9u
IGluaXRpYWxpemVzIGFsbCB0aGUgaXJxIHN1cHBvcnQgaW5jbHVkaW5nIHdvcmsgaXRlbXMsIHRp
bWVycwogICogYW5kIGFsbCB0aGUgdnRhYmxlcy4gSXQgZG9lcyBub3Qgc2V0dXAgdGhlIGludGVy
cnVwdCBpdHNlbGYgdGhvdWdoLgogICovCi12b2lkIGludGVsX2lycV9pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfaXJxX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJp
di0+ZHJtOwotCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZkZXZfcHJpdi0+Z3RfcG0ucnBzOwor
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOworCXN0cnVjdCBpbnRlbF9ycHMg
KnJwcyA9ICZpOTE1LT5ndF9wbS5ycHM7CiAJaW50IGk7CiAKLQlpZiAoSVNfSTk0NUdNKGRldl9w
cml2KSkKLQkJaTk0NWdtX3ZibGFua193b3JrX2luaXQoZGV2X3ByaXYpOworCWlmIChJU19JOTQ1
R00oaTkxNSkpCisJCWk5NDVnbV92Ymxhbmtfd29ya19pbml0KGk5MTUpOwogCi0JaW50ZWxfaHBk
X2luaXRfd29yayhkZXZfcHJpdik7CisJaW50ZWxfaHBkX2luaXRfd29yayhpOTE1KTsKIAogCUlO
SVRfV09SSygmcnBzLT53b3JrLCBnZW42X3BtX3Jwc193b3JrKTsKIAotCUlOSVRfV09SSygmZGV2
X3ByaXYtPmwzX3Bhcml0eS5lcnJvcl93b3JrLCBpdnlicmlkZ2VfcGFyaXR5X3dvcmspOworCUlO
SVRfV09SSygmaTkxNS0+bDNfcGFyaXR5LmVycm9yX3dvcmssIGl2eWJyaWRnZV9wYXJpdHlfd29y
ayk7CiAJZm9yIChpID0gMDsgaSA8IE1BWF9MM19TTElDRVM7ICsraSkKLQkJZGV2X3ByaXYtPmwz
X3Bhcml0eS5yZW1hcF9pbmZvW2ldID0gTlVMTDsKKwkJaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2lu
Zm9baV0gPSBOVUxMOwogCi0JaWYgKEhBU19HVUNfU0NIRUQoZGV2X3ByaXYpICYmIElOVEVMX0dF
TihkZXZfcHJpdikgPCAxMSkKLQkJZGV2X3ByaXYtPnBtX2d1Y19ldmVudHMgPSBHRU45X0dVQ19U
T19IT1NUX0lOVF9FVkVOVDsKKwlpZiAoSEFTX0dVQ19TQ0hFRChpOTE1KSAmJiBJTlRFTF9HRU4o
aTkxNSkgPCAxMSkKKwkJaTkxNS0+cG1fZ3VjX2V2ZW50cyA9IEdFTjlfR1VDX1RPX0hPU1RfSU5U
X0VWRU5UOwogCiAJLyogTGV0J3MgdHJhY2sgdGhlIGVuYWJsZWQgcnBzIGV2ZW50cyAqLwotCWlm
IChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKKwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkKIAkJ
LyogV2FHc3ZSQzBSZXNpZGVuY3lNZXRob2Q6dmx2ICovCi0JCWRldl9wcml2LT5wbV9ycHNfZXZl
bnRzID0gR0VONl9QTV9SUF9VUF9FSV9FWFBJUkVEOworCQlpOTE1LT5wbV9ycHNfZXZlbnRzID0g
R0VONl9QTV9SUF9VUF9FSV9FWFBJUkVEOwogCWVsc2UKLQkJZGV2X3ByaXYtPnBtX3Jwc19ldmVu
dHMgPSAoR0VONl9QTV9SUF9VUF9USFJFU0hPTEQgfAorCQlpOTE1LT5wbV9ycHNfZXZlbnRzID0g
KEdFTjZfUE1fUlBfVVBfVEhSRVNIT0xEIHwKIAkJCQkJICAgR0VONl9QTV9SUF9ET1dOX1RIUkVT
SE9MRCB8CiAJCQkJCSAgIEdFTjZfUE1fUlBfRE9XTl9USU1FT1VUKTsKIAogCS8qIFdlIHNoYXJl
IHRoZSByZWdpc3RlciB3aXRoIG90aGVyIGVuZ2luZSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID4gOSkKLQkJR0VNX1dBUk5fT04oZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMgJiAweGZmZmYw
MDAwKTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID4gOSkKKwkJR0VNX1dBUk5fT04oaTkxNS0+cG1f
cnBzX2V2ZW50cyAmIDB4ZmZmZjAwMDApOwogCiAJcnBzLT5wbV9pbnRybXNrX21ieiA9IDA7CiAK
QEAgLTQ3ODksMTUgKzQ3ODksMTUgQEAgdm9pZCBpbnRlbF9pcnFfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICoKIAkgKiBUT0RPOiB2ZXJpZnkgaWYgdGhpcyBjYW4g
YmUgcmVwcm9kdWNlZCBvbiBWTFYsQ0hWLgogCSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
IDw9IDcpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8PSA3KQogCQlycHMtPnBtX2ludHJtc2tfbWJ6
IHw9IEdFTjZfUE1fUlBfVVBfRUlfRVhQSVJFRDsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDgpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KQogCQlycHMtPnBtX2ludHJtc2tfbWJ6
IHw9IEdFTjhfUE1JTlRSX0RJU0FCTEVfUkVESVJFQ1RfVE9fR1VDOwogCi0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gNSB8fCBJU19HNFgoZGV2X3ByaXYpKQorCWlmIChJTlRFTF9HRU4oaTkx
NSkgPj0gNSB8fCBJU19HNFgoaTkxNSkpCiAJCWRldi0+ZHJpdmVyLT5nZXRfdmJsYW5rX2NvdW50
ZXIgPSBnNHhfZ2V0X3ZibGFua19jb3VudGVyOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMykKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMykKIAkJZGV2LT5kcml2ZXIt
PmdldF92YmxhbmtfY291bnRlciA9IGk5MTVfZ2V0X3ZibGFua19jb3VudGVyOwogCiAJZGV2LT52
YmxhbmtfZGlzYWJsZV9pbW1lZGlhdGUgPSB0cnVlOwpAQCAtNDgwOCw4MyArNDgwOCw4MyBAQCB2
b2lkIGludGVsX2lycV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkg
KiBvdXRzaWRlIG9mIHRoZSBwb3dlciBkb21haW4uIFdlIGRlZmVyIHNldHRpbmcgdXAgdGhlIGRp
c3BsYXkgaXJxcwogCSAqIGluIHRoaXMgY2FzZSB0byB0aGUgcnVudGltZSBwbS4KIAkgKi8KLQlk
ZXZfcHJpdi0+ZGlzcGxheV9pcnFzX2VuYWJsZWQgPSB0cnVlOwotCWlmIChJU19WQUxMRVlWSUVX
KGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3Bs
YXlfaXJxc19lbmFibGVkID0gZmFsc2U7CisJaTkxNS0+ZGlzcGxheV9pcnFzX2VuYWJsZWQgPSB0
cnVlOworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpCisJ
CWk5MTUtPmRpc3BsYXlfaXJxc19lbmFibGVkID0gZmFsc2U7CiAKLQlkZXZfcHJpdi0+aG90cGx1
Zy5ocGRfc3Rvcm1fdGhyZXNob2xkID0gSFBEX1NUT1JNX0RFRkFVTFRfVEhSRVNIT0xEOworCWk5
MTUtPmhvdHBsdWcuaHBkX3N0b3JtX3RocmVzaG9sZCA9IEhQRF9TVE9STV9ERUZBVUxUX1RIUkVT
SE9MRDsKIAkvKiBJZiB3ZSBoYXZlIE1TVCBzdXBwb3J0LCB3ZSB3YW50IHRvIGF2b2lkIGRvaW5n
IHNob3J0IEhQRCBJUlEgc3Rvcm0KIAkgKiBkZXRlY3Rpb24sIGFzIHNob3J0IEhQRCBzdG9ybXMg
d2lsbCBvY2N1ciBhcyBhIG5hdHVyYWwgcGFydCBvZgogCSAqIHNpZGViYW5kIG1lc3NhZ2luZyB3
aXRoIE1TVC4KIAkgKiBPbiBvbGRlciBwbGF0Zm9ybXMgaG93ZXZlciwgSVJRIHN0b3JtcyBjYW4g
b2NjdXIgd2l0aCBib3RoIGxvbmcgYW5kCiAJICogc2hvcnQgcHVsc2VzLCBhcyBzZWVuIG9uIHNv
bWUgRzR4IHN5c3RlbXMuCiAJICovCi0JZGV2X3ByaXYtPmhvdHBsdWcuaHBkX3Nob3J0X3N0b3Jt
X2VuYWJsZWQgPSAhSEFTX0RQX01TVChkZXZfcHJpdik7CisJaTkxNS0+aG90cGx1Zy5ocGRfc2hv
cnRfc3Rvcm1fZW5hYmxlZCA9ICFIQVNfRFBfTVNUKGk5MTUpOwogCiAJZGV2LT5kcml2ZXItPmdl
dF92YmxhbmtfdGltZXN0YW1wID0gZHJtX2NhbGNfdmJsdGltZXN0YW1wX2Zyb21fc2Nhbm91dHBv
czsKIAlkZXYtPmRyaXZlci0+Z2V0X3NjYW5vdXRfcG9zaXRpb24gPSBpOTE1X2dldF9jcnRjX3Nj
YW5vdXRwb3M7CiAKLQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKKwlpZiAoSVNfQ0hF
UlJZVklFVyhpOTE1KSkgewogCQlkZXYtPmRyaXZlci0+aXJxX2hhbmRsZXIgPSBjaGVycnl2aWV3
X2lycV9oYW5kbGVyOwogCQlkZXYtPmRyaXZlci0+aXJxX3ByZWluc3RhbGwgPSBjaGVycnl2aWV3
X2lycV9yZXNldDsKIAkJZGV2LT5kcml2ZXItPmlycV9wb3N0aW5zdGFsbCA9IGNoZXJyeXZpZXdf
aXJxX3Bvc3RpbnN0YWxsOwogCQlkZXYtPmRyaXZlci0+aXJxX3VuaW5zdGFsbCA9IGNoZXJyeXZp
ZXdfaXJxX3Jlc2V0OwogCQlkZXYtPmRyaXZlci0+ZW5hYmxlX3ZibGFuayA9IGk5NjVfZW5hYmxl
X3ZibGFuazsKIAkJZGV2LT5kcml2ZXItPmRpc2FibGVfdmJsYW5rID0gaTk2NV9kaXNhYmxlX3Zi
bGFuazsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaHBkX2lycV9zZXR1cCA9IGk5MTVfaHBkX2lycV9z
ZXR1cDsKLQl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKSB7CisJCWk5MTUtPmRp
c3BsYXkuaHBkX2lycV9zZXR1cCA9IGk5MTVfaHBkX2lycV9zZXR1cDsKKwl9IGVsc2UgaWYgKElT
X1ZBTExFWVZJRVcoaTkxNSkpIHsKIAkJZGV2LT5kcml2ZXItPmlycV9oYW5kbGVyID0gdmFsbGV5
dmlld19pcnFfaGFuZGxlcjsKIAkJZGV2LT5kcml2ZXItPmlycV9wcmVpbnN0YWxsID0gdmFsbGV5
dmlld19pcnFfcmVzZXQ7CiAJCWRldi0+ZHJpdmVyLT5pcnFfcG9zdGluc3RhbGwgPSB2YWxsZXl2
aWV3X2lycV9wb3N0aW5zdGFsbDsKIAkJZGV2LT5kcml2ZXItPmlycV91bmluc3RhbGwgPSB2YWxs
ZXl2aWV3X2lycV9yZXNldDsKIAkJZGV2LT5kcml2ZXItPmVuYWJsZV92YmxhbmsgPSBpOTY1X2Vu
YWJsZV92Ymxhbms7CiAJCWRldi0+ZHJpdmVyLT5kaXNhYmxlX3ZibGFuayA9IGk5NjVfZGlzYWJs
ZV92Ymxhbms7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXAgPSBpOTE1X2hwZF9p
cnFfc2V0dXA7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJCWk5
MTUtPmRpc3BsYXkuaHBkX2lycV9zZXR1cCA9IGk5MTVfaHBkX2lycV9zZXR1cDsKKwl9IGVsc2Ug
aWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewogCQlkZXYtPmRyaXZlci0+aXJxX2hhbmRsZXIg
PSBnZW4xMV9pcnFfaGFuZGxlcjsKIAkJZGV2LT5kcml2ZXItPmlycV9wcmVpbnN0YWxsID0gZ2Vu
MTFfaXJxX3Jlc2V0OwogCQlkZXYtPmRyaXZlci0+aXJxX3Bvc3RpbnN0YWxsID0gZ2VuMTFfaXJx
X3Bvc3RpbnN0YWxsOwogCQlkZXYtPmRyaXZlci0+aXJxX3VuaW5zdGFsbCA9IGdlbjExX2lycV9y
ZXNldDsKIAkJZGV2LT5kcml2ZXItPmVuYWJsZV92YmxhbmsgPSBnZW44X2VuYWJsZV92Ymxhbms7
CiAJCWRldi0+ZHJpdmVyLT5kaXNhYmxlX3ZibGFuayA9IGdlbjhfZGlzYWJsZV92Ymxhbms7Ci0J
CWRldl9wcml2LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXAgPSBnZW4xMV9ocGRfaXJxX3NldHVwOwot
CX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KSB7CisJCWk5MTUtPmRpc3BsYXku
aHBkX2lycV9zZXR1cCA9IGdlbjExX2hwZF9pcnFfc2V0dXA7CisJfSBlbHNlIGlmIChJTlRFTF9H
RU4oaTkxNSkgPj0gOCkgewogCQlkZXYtPmRyaXZlci0+aXJxX2hhbmRsZXIgPSBnZW44X2lycV9o
YW5kbGVyOwogCQlkZXYtPmRyaXZlci0+aXJxX3ByZWluc3RhbGwgPSBnZW44X2lycV9yZXNldDsK
IAkJZGV2LT5kcml2ZXItPmlycV9wb3N0aW5zdGFsbCA9IGdlbjhfaXJxX3Bvc3RpbnN0YWxsOwog
CQlkZXYtPmRyaXZlci0+aXJxX3VuaW5zdGFsbCA9IGdlbjhfaXJxX3Jlc2V0OwogCQlkZXYtPmRy
aXZlci0+ZW5hYmxlX3ZibGFuayA9IGdlbjhfZW5hYmxlX3ZibGFuazsKIAkJZGV2LT5kcml2ZXIt
PmRpc2FibGVfdmJsYW5rID0gZ2VuOF9kaXNhYmxlX3ZibGFuazsKLQkJaWYgKElTX0dFTjlfTFAo
ZGV2X3ByaXYpKQotCQkJZGV2X3ByaXYtPmRpc3BsYXkuaHBkX2lycV9zZXR1cCA9IGJ4dF9ocGRf
aXJxX3NldHVwOwotCQllbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShkZXZfcHJpdikgPj0gUENIX1NQ
VCkKLQkJCWRldl9wcml2LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXAgPSBzcHRfaHBkX2lycV9zZXR1
cDsKKwkJaWYgKElTX0dFTjlfTFAoaTkxNSkpCisJCQlpOTE1LT5kaXNwbGF5LmhwZF9pcnFfc2V0
dXAgPSBieHRfaHBkX2lycV9zZXR1cDsKKwkJZWxzZSBpZiAoSU5URUxfUENIX1RZUEUoaTkxNSkg
Pj0gUENIX1NQVCkKKwkJCWk5MTUtPmRpc3BsYXkuaHBkX2lycV9zZXR1cCA9IHNwdF9ocGRfaXJx
X3NldHVwOwogCQllbHNlCi0JCQlkZXZfcHJpdi0+ZGlzcGxheS5ocGRfaXJxX3NldHVwID0gaWxr
X2hwZF9pcnFfc2V0dXA7Ci0JfSBlbHNlIGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgewor
CQkJaTkxNS0+ZGlzcGxheS5ocGRfaXJxX3NldHVwID0gaWxrX2hwZF9pcnFfc2V0dXA7CisJfSBl
bHNlIGlmIChIQVNfUENIX1NQTElUKGk5MTUpKSB7CiAJCWRldi0+ZHJpdmVyLT5pcnFfaGFuZGxl
ciA9IGlyb25sYWtlX2lycV9oYW5kbGVyOwogCQlkZXYtPmRyaXZlci0+aXJxX3ByZWluc3RhbGwg
PSBpcm9ubGFrZV9pcnFfcmVzZXQ7CiAJCWRldi0+ZHJpdmVyLT5pcnFfcG9zdGluc3RhbGwgPSBp
cm9ubGFrZV9pcnFfcG9zdGluc3RhbGw7CiAJCWRldi0+ZHJpdmVyLT5pcnFfdW5pbnN0YWxsID0g
aXJvbmxha2VfaXJxX3Jlc2V0OwogCQlkZXYtPmRyaXZlci0+ZW5hYmxlX3ZibGFuayA9IGlyb25s
YWtlX2VuYWJsZV92Ymxhbms7CiAJCWRldi0+ZHJpdmVyLT5kaXNhYmxlX3ZibGFuayA9IGlyb25s
YWtlX2Rpc2FibGVfdmJsYW5rOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5ocGRfaXJxX3NldHVwID0g
aWxrX2hwZF9pcnFfc2V0dXA7CisJCWk5MTUtPmRpc3BsYXkuaHBkX2lycV9zZXR1cCA9IGlsa19o
cGRfaXJxX3NldHVwOwogCX0gZWxzZSB7Ci0JCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpKSB7CisJ
CWlmIChJU19HRU4oaTkxNSwgMikpIHsKIAkJCWRldi0+ZHJpdmVyLT5pcnFfcHJlaW5zdGFsbCA9
IGk4eHhfaXJxX3Jlc2V0OwogCQkJZGV2LT5kcml2ZXItPmlycV9wb3N0aW5zdGFsbCA9IGk4eHhf
aXJxX3Bvc3RpbnN0YWxsOwogCQkJZGV2LT5kcml2ZXItPmlycV9oYW5kbGVyID0gaTh4eF9pcnFf
aGFuZGxlcjsKIAkJCWRldi0+ZHJpdmVyLT5pcnFfdW5pbnN0YWxsID0gaTh4eF9pcnFfcmVzZXQ7
CiAJCQlkZXYtPmRyaXZlci0+ZW5hYmxlX3ZibGFuayA9IGk4eHhfZW5hYmxlX3ZibGFuazsKIAkJ
CWRldi0+ZHJpdmVyLT5kaXNhYmxlX3ZibGFuayA9IGk4eHhfZGlzYWJsZV92Ymxhbms7Ci0JCX0g
ZWxzZSBpZiAoSVNfSTk0NUdNKGRldl9wcml2KSkgeworCQl9IGVsc2UgaWYgKElTX0k5NDVHTShp
OTE1KSkgewogCQkJZGV2LT5kcml2ZXItPmlycV9wcmVpbnN0YWxsID0gaTkxNV9pcnFfcmVzZXQ7
CiAJCQlkZXYtPmRyaXZlci0+aXJxX3Bvc3RpbnN0YWxsID0gaTkxNV9pcnFfcG9zdGluc3RhbGw7
CiAJCQlkZXYtPmRyaXZlci0+aXJxX3VuaW5zdGFsbCA9IGk5MTVfaXJxX3Jlc2V0OwogCQkJZGV2
LT5kcml2ZXItPmlycV9oYW5kbGVyID0gaTkxNV9pcnFfaGFuZGxlcjsKIAkJCWRldi0+ZHJpdmVy
LT5lbmFibGVfdmJsYW5rID0gaTk0NWdtX2VuYWJsZV92Ymxhbms7CiAJCQlkZXYtPmRyaXZlci0+
ZGlzYWJsZV92YmxhbmsgPSBpOTQ1Z21fZGlzYWJsZV92Ymxhbms7Ci0JCX0gZWxzZSBpZiAoSVNf
R0VOKGRldl9wcml2LCAzKSkgeworCQl9IGVsc2UgaWYgKElTX0dFTihpOTE1LCAzKSkgewogCQkJ
ZGV2LT5kcml2ZXItPmlycV9wcmVpbnN0YWxsID0gaTkxNV9pcnFfcmVzZXQ7CiAJCQlkZXYtPmRy
aXZlci0+aXJxX3Bvc3RpbnN0YWxsID0gaTkxNV9pcnFfcG9zdGluc3RhbGw7CiAJCQlkZXYtPmRy
aXZlci0+aXJxX3VuaW5zdGFsbCA9IGk5MTVfaXJxX3Jlc2V0OwpAQCAtNDg5OSw4ICs0ODk5LDgg
QEAgdm9pZCBpbnRlbF9pcnFfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJCQlkZXYtPmRyaXZlci0+ZW5hYmxlX3ZibGFuayA9IGk5NjVfZW5hYmxlX3ZibGFuazsKIAkJ
CWRldi0+ZHJpdmVyLT5kaXNhYmxlX3ZibGFuayA9IGk5NjVfZGlzYWJsZV92Ymxhbms7CiAJCX0K
LQkJaWYgKEk5MTVfSEFTX0hPVFBMVUcoZGV2X3ByaXYpKQotCQkJZGV2X3ByaXYtPmRpc3BsYXku
aHBkX2lycV9zZXR1cCA9IGk5MTVfaHBkX2lycV9zZXR1cDsKKwkJaWYgKEk5MTVfSEFTX0hPVFBM
VUcoaTkxNSkpCisJCQlpOTE1LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXAgPSBpOTE1X2hwZF9pcnFf
c2V0dXA7CiAJfQogfQogCkBAIC00OTIzLDcgKzQ5MjMsNyBAQCB2b2lkIGludGVsX2lycV9maW5p
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAvKioKICAqIGludGVsX2lycV9pbnN0
YWxsIC0gZW5hYmxlcyB0aGUgaGFyZHdhcmUgaW50ZXJydXB0Ci0gKiBAZGV2X3ByaXY6IGk5MTUg
ZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqCiAgKiBU
aGlzIGZ1bmN0aW9uIGVuYWJsZXMgdGhlIGhhcmR3YXJlIGludGVycnVwdCBoYW5kbGluZywgYnV0
IGxlYXZlcyB0aGUgaG90cGx1ZwogICogaGFuZGxpbmcgc3RpbGwgZGlzYWJsZWQuIEl0IGlzIGNh
bGxlZCBhZnRlciBpbnRlbF9pcnFfaW5pdCgpLgpAQCAtNDkzMiw1NiArNDkzMiw1NiBAQCB2b2lk
IGludGVsX2lycV9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogICogYnV0IGRv
bid0IHdhbnQgdG8gZGVhbCB3aXRoIHRoZSBoYXNzbGUgb2YgY29uY3VycmVudCBwcm9iZSBhbmQg
aG90cGx1ZwogICogd29ya2Vycy4gSGVuY2UgdGhlIHNwbGl0IGludG8gdGhpcyB0d28tc3RhZ2Ug
YXBwcm9hY2guCiAgKi8KLWludCBpbnRlbF9pcnFfaW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitpbnQgaW50ZWxfaXJxX2luc3RhbGwoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7CiAJLyoKIAkgKiBXZSBlbmFibGUgc29tZSBpbnRlcnJ1cHQgc291cmNl
cyBpbiBvdXIgcG9zdGluc3RhbGwgaG9va3MsIHNvIG1hcmsKIAkgKiBpbnRlcnJ1cHRzIGFzIGVu
YWJsZWQgX2JlZm9yZV8gYWN0dWFsbHkgZW5hYmxpbmcgdGhlbSB0byBhdm9pZAogCSAqIHNwZWNp
YWwgY2FzZXMgaW4gb3VyIG9yZGVyaW5nIGNoZWNrcy4KIAkgKi8KLQlkZXZfcHJpdi0+cnVudGlt
ZV9wbS5pcnFzX2VuYWJsZWQgPSB0cnVlOworCWk5MTUtPnJ1bnRpbWVfcG0uaXJxc19lbmFibGVk
ID0gdHJ1ZTsKIAotCXJldHVybiBkcm1faXJxX2luc3RhbGwoJmRldl9wcml2LT5kcm0sIGRldl9w
cml2LT5kcm0ucGRldi0+aXJxKTsKKwlyZXR1cm4gZHJtX2lycV9pbnN0YWxsKCZpOTE1LT5kcm0s
IGk5MTUtPmRybS5wZGV2LT5pcnEpOwogfQogCiAvKioKICAqIGludGVsX2lycV91bmluc3RhbGwg
LSBmaW5pbGl6ZXMgYWxsIGlycSBoYW5kbGluZwotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBp
bnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogVGhpcyBzdG9w
cyBpbnRlcnJ1cHQgYW5kIGhvdHBsdWcgaGFuZGxpbmcgYW5kIHVucmVnaXN0ZXJzIGFuZCBmcmVl
cyBhbGwKICAqIHJlc291cmNlcyBhY3F1aXJlZCBpbiB0aGUgaW5pdCBmdW5jdGlvbnMuCiAgKi8K
LXZvaWQgaW50ZWxfaXJxX3VuaW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCit2b2lkIGludGVsX2lycV91bmluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7Ci0JZHJtX2lycV91bmluc3RhbGwoJmRldl9wcml2LT5kcm0pOwotCWludGVsX2hwZF9j
YW5jZWxfd29yayhkZXZfcHJpdik7Ci0JZGV2X3ByaXYtPnJ1bnRpbWVfcG0uaXJxc19lbmFibGVk
ID0gZmFsc2U7CisJZHJtX2lycV91bmluc3RhbGwoJmk5MTUtPmRybSk7CisJaW50ZWxfaHBkX2Nh
bmNlbF93b3JrKGk5MTUpOworCWk5MTUtPnJ1bnRpbWVfcG0uaXJxc19lbmFibGVkID0gZmFsc2U7
CiB9CiAKIC8qKgogICogaW50ZWxfcnVudGltZV9wbV9kaXNhYmxlX2ludGVycnVwdHMgLSBydW50
aW1lIGludGVycnVwdCBkaXNhYmxpbmcKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFu
Y2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAqIFRoaXMgZnVuY3Rpb24g
aXMgdXNlZCB0byBkaXNhYmxlIGludGVycnVwdHMgYXQgcnVudGltZSwgYm90aCBpbiB0aGUgcnVu
dGltZQogICogcG0gYW5kIHRoZSBzeXN0ZW0gc3VzcGVuZC9yZXN1bWUgY29kZS4KICAqLwotdm9p
ZCBpbnRlbF9ydW50aW1lX3BtX2Rpc2FibGVfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX3J1bnRpbWVfcG1fZGlzYWJsZV9pbnRlcnJ1cHRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWRldl9wcml2LT5kcm0uZHJpdmVy
LT5pcnFfdW5pbnN0YWxsKCZkZXZfcHJpdi0+ZHJtKTsKLQlkZXZfcHJpdi0+cnVudGltZV9wbS5p
cnFzX2VuYWJsZWQgPSBmYWxzZTsKLQlzeW5jaHJvbml6ZV9pcnEoZGV2X3ByaXYtPmRybS5pcnEp
OworCWk5MTUtPmRybS5kcml2ZXItPmlycV91bmluc3RhbGwoJmk5MTUtPmRybSk7CisJaTkxNS0+
cnVudGltZV9wbS5pcnFzX2VuYWJsZWQgPSBmYWxzZTsKKwlzeW5jaHJvbml6ZV9pcnEoaTkxNS0+
ZHJtLmlycSk7CiB9CiAKIC8qKgogICogaW50ZWxfcnVudGltZV9wbV9lbmFibGVfaW50ZXJydXB0
cyAtIHJ1bnRpbWUgaW50ZXJydXB0IGVuYWJsaW5nCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNl
IGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqCiAgKiBUaGlzIGZ1
bmN0aW9uIGlzIHVzZWQgdG8gZW5hYmxlIGludGVycnVwdHMgYXQgcnVudGltZSwgYm90aCBpbiB0
aGUgcnVudGltZQogICogcG0gYW5kIHRoZSBzeXN0ZW0gc3VzcGVuZC9yZXN1bWUgY29kZS4KICAq
Lwotdm9pZCBpbnRlbF9ydW50aW1lX3BtX2VuYWJsZV9pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfcnVudGltZV9wbV9lbmFibGVfaW50ZXJy
dXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlkZXZfcHJpdi0+cnVudGlt
ZV9wbS5pcnFzX2VuYWJsZWQgPSB0cnVlOwotCWRldl9wcml2LT5kcm0uZHJpdmVyLT5pcnFfcHJl
aW5zdGFsbCgmZGV2X3ByaXYtPmRybSk7Ci0JZGV2X3ByaXYtPmRybS5kcml2ZXItPmlycV9wb3N0
aW5zdGFsbCgmZGV2X3ByaXYtPmRybSk7CisJaTkxNS0+cnVudGltZV9wbS5pcnFzX2VuYWJsZWQg
PSB0cnVlOworCWk5MTUtPmRybS5kcml2ZXItPmlycV9wcmVpbnN0YWxsKCZpOTE1LT5kcm0pOwor
CWk5MTUtPmRybS5kcml2ZXItPmlycV9wb3N0aW5zdGFsbCgmaTkxNS0+ZHJtKTsKIH0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2lycS5oCmluZGV4IGNiMjVkZDIxMzMwOC4uNjA0NTA0OTkzNTEzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfaXJxLmgKQEAgLTEzLDc3ICsxMyw3NyBAQAogc3RydWN0IGRybV9pOTE1X3By
aXZhdGU7CiBzdHJ1Y3QgaW50ZWxfY3J0YzsKIAotZXh0ZXJuIHZvaWQgaW50ZWxfaXJxX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLWV4dGVybiB2b2lkIGludGVsX2ly
cV9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1pbnQgaW50ZWxfaXJx
X2luc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxf
aXJxX3VuaW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworZXh0ZXJu
IHZvaWQgaW50ZWxfaXJxX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworZXh0
ZXJuIHZvaWQgaW50ZWxfaXJxX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwor
aW50IGludGVsX2lycV9pbnN0YWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3Zv
aWQgaW50ZWxfaXJxX3VuaW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAK
LXUzMiBpOTE1X3BpcGVzdGF0X2VuYWJsZV9tYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3UzMiBpOTE1X3BpcGVzdGF0X2VuYWJsZV9tYXNrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICAgICAgZW51bSBwaXBlIHBpcGUpOwogdm9pZAotaTkxNV9lbmFi
bGVfcGlwZXN0YXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUg
cGlwZSwKK2k5MTVfZW5hYmxlX3BpcGVzdGF0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCBlbnVtIHBpcGUgcGlwZSwKIAkJICAgICB1MzIgc3RhdHVzX21hc2spOwogCiB2b2lkCi1pOTE1
X2Rpc2FibGVfcGlwZXN0YXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVt
IHBpcGUgcGlwZSwKK2k5MTVfZGlzYWJsZV9waXBlc3RhdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUsCiAJCSAgICAgIHUzMiBzdGF0dXNfbWFzayk7CiAKLXZv
aWQgdmFsbGV5dmlld19lbmFibGVfZGlzcGxheV9pcnFzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7Ci12b2lkIHZhbGxleXZpZXdfZGlzYWJsZV9kaXNwbGF5X2lycXMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgdmFsbGV5dmlld19lbmFibGVfZGlz
cGxheV9pcnFzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgdmFsbGV5dmll
d19kaXNhYmxlX2Rpc3BsYXlfaXJxcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAK
LXZvaWQgaTkxNV9ob3RwbHVnX2ludGVycnVwdF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAordm9pZCBpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3VwZGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICB1MzIgbWFzaywKIAkJCQkgICB1MzIgYml0
cyk7Ci12b2lkIGlsa191cGRhdGVfZGlzcGxheV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAordm9pZCBpbGtfdXBkYXRlX2Rpc3BsYXlfaXJxKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICAgIHUzMiBpbnRlcnJ1cHRfbWFzaywKIAkJCSAgICB1MzIgZW5h
YmxlZF9pcnFfbWFzayk7CiBzdGF0aWMgaW5saW5lIHZvaWQKLWlsa19lbmFibGVfZGlzcGxheV9p
cnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgYml0cykKK2lsa19lbmFi
bGVfZGlzcGxheV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBiaXRzKQog
ewotCWlsa191cGRhdGVfZGlzcGxheV9pcnEoZGV2X3ByaXYsIGJpdHMsIGJpdHMpOworCWlsa191
cGRhdGVfZGlzcGxheV9pcnEoaTkxNSwgYml0cywgYml0cyk7CiB9CiBzdGF0aWMgaW5saW5lIHZv
aWQKLWlsa19kaXNhYmxlX2Rpc3BsYXlfaXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgdTMyIGJpdHMpCitpbGtfZGlzYWJsZV9kaXNwbGF5X2lycShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwgdTMyIGJpdHMpCiB7Ci0JaWxrX3VwZGF0ZV9kaXNwbGF5X2lycShkZXZf
cHJpdiwgYml0cywgMCk7CisJaWxrX3VwZGF0ZV9kaXNwbGF5X2lycShpOTE1LCBiaXRzLCAwKTsK
IH0KLXZvaWQgYmR3X3VwZGF0ZV9waXBlX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCit2b2lkIGJkd191cGRhdGVfcGlwZV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkgZW51bSBwaXBlIHBpcGUsCiAJCQkgdTMyIGludGVycnVwdF9tYXNrLAogCQkJ
IHUzMiBlbmFibGVkX2lycV9tYXNrKTsKLXN0YXRpYyBpbmxpbmUgdm9pZCBiZHdfZW5hYmxlX3Bp
cGVfaXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBpbmxpbmUg
dm9pZCBiZHdfZW5hYmxlX3BpcGVfaXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCSAgICAgICBlbnVtIHBpcGUgcGlwZSwgdTMyIGJpdHMpCiB7Ci0JYmR3X3VwZGF0ZV9waXBl
X2lycShkZXZfcHJpdiwgcGlwZSwgYml0cywgYml0cyk7CisJYmR3X3VwZGF0ZV9waXBlX2lycShp
OTE1LCBwaXBlLCBiaXRzLCBiaXRzKTsKIH0KLXN0YXRpYyBpbmxpbmUgdm9pZCBiZHdfZGlzYWJs
ZV9waXBlX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgaW5s
aW5lIHZvaWQgYmR3X2Rpc2FibGVfcGlwZV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJCWVudW0gcGlwZSBwaXBlLCB1MzIgYml0cykKIHsKLQliZHdfdXBkYXRlX3BpcGVf
aXJxKGRldl9wcml2LCBwaXBlLCBiaXRzLCAwKTsKKwliZHdfdXBkYXRlX3BpcGVfaXJxKGk5MTUs
IHBpcGUsIGJpdHMsIDApOwogfQotdm9pZCBpYnhfZGlzcGxheV9pbnRlcnJ1cHRfdXBkYXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaWJ4X2Rpc3BsYXlfaW50ZXJy
dXB0X3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgIHUzMiBpbnRl
cnJ1cHRfbWFzaywKIAkJCQkgIHUzMiBlbmFibGVkX2lycV9tYXNrKTsKIHN0YXRpYyBpbmxpbmUg
dm9pZAotaWJ4X2VuYWJsZV9kaXNwbGF5X2ludGVycnVwdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIHUzMiBiaXRzKQoraWJ4X2VuYWJsZV9kaXNwbGF5X2ludGVycnVwdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIGJpdHMpCiB7Ci0JaWJ4X2Rpc3BsYXlfaW50
ZXJydXB0X3VwZGF0ZShkZXZfcHJpdiwgYml0cywgYml0cyk7CisJaWJ4X2Rpc3BsYXlfaW50ZXJy
dXB0X3VwZGF0ZShpOTE1LCBiaXRzLCBiaXRzKTsKIH0KIHN0YXRpYyBpbmxpbmUgdm9pZAotaWJ4
X2Rpc2FibGVfZGlzcGxheV9pbnRlcnJ1cHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1MzIgYml0cykKK2lieF9kaXNhYmxlX2Rpc3BsYXlfaW50ZXJydXB0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LCB1MzIgYml0cykKIHsKLQlpYnhfZGlzcGxheV9pbnRlcnJ1cHRf
dXBkYXRlKGRldl9wcml2LCBiaXRzLCAwKTsKKwlpYnhfZGlzcGxheV9pbnRlcnJ1cHRfdXBkYXRl
KGk5MTUsIGJpdHMsIDApOwogfQogCi12b2lkIGdlbjVfZW5hYmxlX2d0X2lycShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBtYXNrKTsKLXZvaWQgZ2VuNV9kaXNhYmxlX2d0
X2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBtYXNrKTsKLXZvaWQg
Z2VuNl9tYXNrX3BtX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBt
YXNrKTsKLXZvaWQgZ2VuNl91bm1hc2tfcG1faXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgdTMyIG1hc2spOwotdm9pZCBnZW4xMV9yZXNldF9ycHNfaW50ZXJydXB0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBnZW42X3Jlc2V0X3Jwc19pbnRl
cnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGdlbjZfZW5h
YmxlX3Jwc19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12
b2lkIGdlbjZfZGlzYWJsZV9ycHNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpOwotdm9pZCBnZW42X3Jwc19yZXNldF9laShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOwordm9pZCBnZW41X2VuYWJsZV9ndF9pcnEoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIHUzMiBtYXNrKTsKK3ZvaWQgZ2VuNV9kaXNhYmxlX2d0X2lycShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIG1hc2spOwordm9pZCBnZW42X21hc2tfcG1faXJx
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgbWFzayk7Cit2b2lkIGdlbjZfdW5t
YXNrX3BtX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIG1hc2spOwordm9p
ZCBnZW4xMV9yZXNldF9ycHNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSk7Cit2b2lkIGdlbjZfcmVzZXRfcnBzX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwordm9pZCBnZW42X2VuYWJsZV9ycHNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGdlbjZfZGlzYWJsZV9ycHNfaW50ZXJydXB0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGdlbjZfcnBzX3Jlc2V0X2VpKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogc3RhdGljIGlubGluZSB1MzIgZ2VuNl9zYW5p
dGl6ZV9ycHNfcG1fbWFzayhjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQkJICAgIHUzMiBtYXNrKQpAQCAtOTEsMjUgKzkxLDI1IEBAIHN0YXRpYyBpbmxpbmUgdTMyIGdl
bjZfc2FuaXRpemVfcnBzX3BtX21hc2soY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJcmV0dXJuIG1hc2sgJiB+aTkxNS0+Z3RfcG0ucnBzLnBtX2ludHJtc2tfbWJ6OwogfQog
Ci12b2lkIGludGVsX3J1bnRpbWVfcG1fZGlzYWJsZV9pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX3J1bnRpbWVfcG1fZW5hYmxlX2ludGVy
cnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXN0YXRpYyBpbmxpbmUg
Ym9vbCBpbnRlbF9pcnFzX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQordm9pZCBpbnRlbF9ydW50aW1lX3BtX2Rpc2FibGVfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX3J1bnRpbWVfcG1fZW5hYmxlX2ludGVycnVw
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworc3RhdGljIGlubGluZSBib29sIGlu
dGVsX2lycXNfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAkvKgog
CSAqIFdlIG9ubHkgdXNlIGRybV9pcnFfdW5pbnN0YWxsKCkgYXQgdW5sb2FkIGFuZCBWVCBzd2l0
Y2gsIHNvCiAJICogdGhpcyBpcyB0aGUgb25seSB0aGluZyB3ZSBuZWVkIHRvIGNoZWNrLgogCSAq
LwotCXJldHVybiBkZXZfcHJpdi0+cnVudGltZV9wbS5pcnFzX2VuYWJsZWQ7CisJcmV0dXJuIGk5
MTUtPnJ1bnRpbWVfcG0uaXJxc19lbmFibGVkOwogfQogCiBpbnQgaW50ZWxfZ2V0X2NydGNfc2Nh
bmxpbmUoc3RydWN0IGludGVsX2NydGMgKmNydGMpOwotdm9pZCBnZW44X2lycV9wb3dlcl93ZWxs
X3Bvc3RfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgZ2Vu
OF9pcnFfcG93ZXJfd2VsbF9wb3N0X2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkgICAgIHU4IHBpcGVfbWFzayk7Ci12b2lkIGdlbjhfaXJxX3Bvd2VyX3dlbGxfcHJl
X2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBnZW44X2ly
cV9wb3dlcl93ZWxsX3ByZV9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCSAgICAgdTggcGlwZV9tYXNrKTsKLXZvaWQgZ2VuOV9yZXNldF9ndWNfaW50ZXJydXB0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBnZW45X2VuYWJsZV9ndWNf
aW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBnZW45
X2Rpc2FibGVfZ3VjX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KTsKK3ZvaWQgZ2VuOV9yZXNldF9ndWNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSk7Cit2b2lkIGdlbjlfZW5hYmxlX2d1Y19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KTsKK3ZvaWQgZ2VuOV9kaXNhYmxlX2d1Y19pbnRlcnJ1cHRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHZvaWQgZ2VuMTFfcmVzZXRfZ3VjX2ludGVycnVw
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBnZW4xMV9lbmFibGVfZ3Vj
X2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBnZW4xMV9k
aXNhYmxlX2d1Y19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfbWVtY3B5LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X21lbWNweS5jCmluZGV4IDc5ZjhlYzc1NjM2Mi4uMmJkNjY0YzE2YmEw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X21lbWNweS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfbWVtY3B5LmMKQEAgLTk0LDcgKzk0LDcgQEAgYm9vbCBp
OTE1X21lbWNweV9mcm9tX3djKHZvaWQgKmRzdCwgY29uc3Qgdm9pZCAqc3JjLCB1bnNpZ25lZCBs
b25nIGxlbikKIAlyZXR1cm4gZmFsc2U7CiB9CiAKLXZvaWQgaTkxNV9tZW1jcHlfaW5pdF9lYXJs
eShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGk5MTVfbWVtY3B5X2lu
aXRfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyoKIAkgKiBTb21l
IGh5cGVydmlzb3JzIChlLmcuIEtWTSkgZG9uJ3Qgc3VwcG9ydCBWRVgtcHJlZml4IGluc3RydWN0
aW9ucwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9iZHcuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfYmR3LmMKaW5kZXggNGFjZGI5NDU1NWI3Li43Yzk3
Y2Q5MGU5NzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfYmR3LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9iZHcuYwpAQCAtNjQsMjggKzY0LDI4
IEBAIHNob3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0
dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0
X2NvbmZpZ19iZHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJm
X2xvYWRfdGVzdF9jb25maWdfYmR3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5KGk5
MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJImQ2ZGU2ZjU1LWU1MjYtNGY3OS1hNmE2
LWQ3MzE1YzA5MDQ0ZSIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy51
dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXplb2Yo
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9
IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhf
cmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190ZXN0
X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0g
Yl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmln
LmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0X29h
KTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVy
X2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3Jl
Z3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2X3By
aXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVzdF9v
YTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlf
U0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmln
LmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29h
KTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0g
ImQ2ZGU2ZjU1LWU1MjYtNGY3OS1hNmE2LWQ3MzE1YzA5MDQ0ZSI7Ci0JZGV2X3ByaXYtPnBlcmYu
b2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2EudGVz
dF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMu
bmFtZSA9ICJkNmRlNmY1NS1lNTI2LTRmNzktYTZhNi1kNzMxNWMwOTA0NGUiOworCWk5MTUtPnBl
cmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJzWzBd
ID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyOwor
CWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRldl9w
cml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0
X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIu
bmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQu
YXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJp
Y19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9vYV9iZHcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfYmR3
LmgKaW5kZXggMGU2NjdmMWE4YWExLi42OTQ3OWU1YjQzNmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfb2FfYmR3LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9vYV9iZHcuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVfT0FfQkRXX0hfXwog
I2RlZmluZSBfX0k5MTVfT0FfQkRXX0hfXwogCi1leHRlcm4gdm9pZCBpOTE1X3BlcmZfbG9hZF90
ZXN0X2NvbmZpZ19iZHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2V4dGVy
biB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2JkdyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9vYV9ieHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfYnh0LmMKaW5kZXgg
YTQ0MTk1YzM5OTIzLi41ZWMyMzZiMzNlY2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfb2FfYnh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9ieHQu
YwpAQCAtNjIsMjggKzYyLDI4IEBAIHNob3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2
LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1p
OTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19ieHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQoraTkxNV9wZXJmX2xvYWRfdGVzdF9jb25maWdfYnh0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewotCXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcu
dXVpZCwKKwlzdHJsY3B5KGk5MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJIjVlZTcy
ZjVjLTA5MmYtNDIxZS04YjcwLTIyNWY3YzNlOTYxMiIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVy
Zi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcu
aWQgPSAxOworCQlzaXplb2YoaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkx
NS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5tdXhfcmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9v
YSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVz
dF9vYTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJ
WkUobXV4X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmln
LmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3Vu
dGVyX2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRl
cl9yZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9j
b25maWcuYl9jb3VudGVyX3JlZ3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rl
c3Rfb2EpOwogCi0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxl
eF9ldV9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4
X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJ
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4
X2V1X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5
c2ZzX21ldHJpYy5uYW1lID0gIjVlZTcyZjVjLTA5MmYtNDIxZS04YjcwLTIyNWY3YzNlOTYxMiI7
Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2
X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5zeXNmc19tZXRyaWMubmFtZSA9ICI1ZWU3MmY1Yy0wOTJmLTQyMWUtOGI3MC0yMjVmN2Mz
ZTk2MTIiOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0g
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRl
c3RfY29uZmlnLmF0dHJzWzBdID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2Zz
X21ldHJpY19pZC5hdHRyOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAm
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9w
cml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQi
OwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1v
ZGUgPSAwNDQ0OwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19p
ZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lz
ZnNfbWV0cmljX2lkLmF0dHIubmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5zeXNmc19tZXRyaWNfaWQuYXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9ieHQuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfb2FfYnh0LmgKaW5kZXggNjc5ZTkyY2Y0ZjFkLi40N2Q4MzI3ZjM4YTEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfYnh0LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9ieHQuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBf
X0k5MTVfT0FfQlhUX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfQlhUX0hfXwogCi1leHRlcm4gdm9p
ZCBpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19ieHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2J4dChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jZmxndDIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfb2FfY2ZsZ3QyLmMKaW5kZXggN2Y2MGQ1MWI4NzYxLi4zOTcyY2Q3ZGNiZmMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY2ZsZ3QyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jZmxndDIuYwpAQCAtNjMsMjggKzYzLDI4IEBAIHNob3df
dGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAq
YXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19j
ZmxndDIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJmX2xvYWRf
dGVzdF9jb25maWdfY2ZsZ3QyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0
cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5KGk5MTUt
PnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJIjc0ZmI0OTAyLWQzZDMtNDIzNy05ZTkwLWNi
ZGM2OGQwYTQ0NiIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlk
KSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXplb2YoaTkx
NS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11
eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVn
c19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5wZXJmLm9h
LnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190ZXN0X29h
KTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9j
b3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJf
Y291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hKTsK
KwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVyX2Nv
bmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3JlZ3Nf
bGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2X3ByaXYt
PnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVzdF9vYTsK
LQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0la
RShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmZs
ZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsK
IAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0gIjc0
ZmI0OTAyLWQzZDMtNDIzNy05ZTkwLWNiZGM2OGQwYTQ0NiI7Ci0JZGV2X3ByaXYtPnBlcmYub2Eu
dGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2EudGVzdF9j
b25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMubmFt
ZSA9ICI3NGZiNDkwMi1kM2QzLTQyMzctOWU5MC1jYmRjNjhkMGE0NDYiOworCWk5MTUtPnBlcmYu
b2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJzWzBdID0g
JmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyOworCWk5
MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5wZXJmLm9h
LnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRldl9wcml2
LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29h
X2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIubmFt
ZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0
ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19p
ZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9vYV9jZmxndDIuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY2Zs
Z3QyLmgKaW5kZXggNGQ2MDI1NTU5YmJlLi40MzQ1NDVjOWM1ZDkgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY2ZsZ3QyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9vYV9jZmxndDIuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVfT0Ff
Q0ZMR1QyX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfQ0ZMR1QyX0hfXwogCi1leHRlcm4gdm9pZCBp
OTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19jZmxndDIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2NmbGd0
MihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jZmxndDMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfb2FfY2ZsZ3QzLmMKaW5kZXggYTkyYzM4ZTNhMGNlLi5jMDBiOWQ5ZDZkZGYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY2ZsZ3QzLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jZmxndDMuYwpAQCAtNjMsMjggKzYzLDI4IEBAIHNo
b3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0
ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZp
Z19jZmxndDMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJmX2xv
YWRfdGVzdF9jb25maWdfY2ZsZ3QzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5KGk5
MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJIjU3N2U4ZTJjLTNmYTAtNDg3NS04NzQz
LTM1MzhkNTg1ZTNiMCIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy51
dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXplb2Yo
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9
IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhf
cmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190ZXN0
X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0g
Yl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmln
LmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0X29h
KTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVy
X2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3Jl
Z3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2X3By
aXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVzdF9v
YTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlf
U0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmln
LmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29h
KTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0g
IjU3N2U4ZTJjLTNmYTAtNDg3NS04NzQzLTM1MzhkNTg1ZTNiMCI7Ci0JZGV2X3ByaXYtPnBlcmYu
b2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2EudGVz
dF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMu
bmFtZSA9ICI1NzdlOGUyYy0zZmEwLTQ4NzUtODc0My0zNTM4ZDU4NWUzYjAiOworCWk5MTUtPnBl
cmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJzWzBd
ID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyOwor
CWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRldl9w
cml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0
X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIu
bmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQu
YXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJp
Y19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9vYV9jZmxndDMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ff
Y2ZsZ3QzLmgKaW5kZXggMDY5N2Y0MDc3NDAyLi4yYzIzZWRhMDU2YWEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY2ZsZ3QzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9vYV9jZmxndDMuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVf
T0FfQ0ZMR1QzX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfQ0ZMR1QzX0hfXwogCi1leHRlcm4gdm9p
ZCBpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19jZmxndDMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2Nm
bGd0MyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jaHYuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfb2FfY2h2LmMKaW5kZXggNzFlYzg4OWEwMTE0Li41ODI5ZDI0ZDBmN2MgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY2h2LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9vYV9jaHYuYwpAQCAtNjMsMjggKzYzLDI4IEBAIHNob3dfdGVzdF9v
YV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwg
Y2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19jaHYoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJmX2xvYWRfdGVzdF9jb25m
aWdfY2h2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cmxjcHkoZGV2X3By
aXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5KGk5MTUtPnBlcmYub2EudGVz
dF9jb25maWcudXVpZCwKIAkJIjRhNTM0YjA3LWNiYTMtNDE0ZC04ZDYwLTg3NDgzMGU4ODNhYSIs
Ci0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7Ci0JZGV2X3By
aXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXplb2YoaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5pZCA9IDE7CiAK
LQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVz
dF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVnc19sZW4gPSBBUlJB
WV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5t
dXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmln
Lm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9w
cml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVyX2NvbmZp
Z190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdz
X2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29h
OworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3JlZ3NfbGVuID0gQVJSQVlf
U0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2X3ByaXYtPnBlcmYub2EudGVz
dF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+
cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2Nv
bmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmZsZXhfcmVncyA9IGZs
ZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3Jl
Z3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9wcml2
LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0gIjRhNTM0YjA3LWNiYTMt
NDE0ZC04ZDYwLTg3NDgzMGU4ODNhYSI7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcu
c3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnM7
CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMubmFtZSA9ICI0YTUzNGIw
Ny1jYmEzLTQxNGQtOGQ2MC04NzQ4MzBlODgzYWEiOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25m
aWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5hdHRyczsK
IAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJzWzBdID0gJmRldl9wcml2LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyOworCWk5MTUtPnBlcmYub2Eu
dGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19t
ZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21l
dHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmln
LnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRldl9wcml2LT5wZXJmLm9hLnRl
c3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOworCWk5MTUt
PnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIubmFtZSA9ICJpZCI7CisJ
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0ci5tb2RlID0gMDQ0
NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hv
d190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9v
YV9jaHYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY2h2LmgKaW5kZXggMDk4NmVh
ZTMxMzVmLi40YmIzYjZiZTdiZDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfb2FfY2h2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jaHYuaApAQCAt
MTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVfT0FfQ0hWX0hfXwogI2RlZmluZSBfX0k5MTVf
T0FfQ0hWX0hfXwogCi1leHRlcm4gdm9pZCBpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19jaHYo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVy
Zl9sb2FkX3Rlc3RfY29uZmlnX2NodihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAK
ICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jbmwuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY25sLmMKaW5kZXggNWMyM2Q4ODNkNmM5Li5m
Y2YwOGI5ZTdjNzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY25s
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9jbmwuYwpAQCAtNzUsMjggKzc1
LDI4IEBAIHNob3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNl
X2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90
ZXN0X2NvbmZpZ19jbmwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9w
ZXJmX2xvYWRfdGVzdF9jb25maWdfY25sKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5
KGk5MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJImRiNDFlZGQ0LWQ4ZTctNDczMC1h
ZDExLWI5YTJkNjgzMzUwMyIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy51dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXpl
b2YoaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVn
cyA9IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5t
dXhfcmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVy
Zi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190
ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdz
ID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0
X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3Vu
dGVyX2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVy
X3JlZ3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2
X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVz
dF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJS
QVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0
X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1l
ID0gImRiNDFlZGQ0LWQ4ZTctNDczMC1hZDExLWI5YTJkNjgzMzUwMyI7Ci0JZGV2X3ByaXYtPnBl
cmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2Eu
dGVzdF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRy
aWMubmFtZSA9ICJkYjQxZWRkNC1kOGU3LTQ3MzAtYWQxMS1iOWEyZDY4MzM1MDMiOworCWk5MTUt
PnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJz
WzBdID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRy
OworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRl
c3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRl
dl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190
ZXN0X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0
dHIubmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNf
aWQuYXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21l
dHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9vYV9jbmwuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ff
Y25sLmgKaW5kZXggZTgzMGE0MDZhZmYyLi5jNzAxMDE2NTUwNDkgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfY25sLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9vYV9jbmwuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVfT0FfQ05MX0hf
XwogI2RlZmluZSBfX0k5MTVfT0FfQ05MX0hfXwogCi1leHRlcm4gdm9pZCBpOTE1X3BlcmZfbG9h
ZF90ZXN0X2NvbmZpZ19jbmwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2V4
dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2NubChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9vYV9nbGsuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfZ2xrLmMKaW5k
ZXggNGJkZGE2NmRmN2QyLi5mZGIzOGI5ZWE5YmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfb2FfZ2xrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9n
bGsuYwpAQCAtNjIsMjggKzYyLDI4IEBAIHNob3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICpr
ZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lk
Ci1pOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19nbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQoraTkxNV9wZXJmX2xvYWRfdGVzdF9jb25maWdfZ2xrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25m
aWcudXVpZCwKKwlzdHJsY3B5KGk5MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJImRk
M2ZkNzg5LWU3ODMtNDIwNC04Y2QwLWI2NzFiYmNjYjBjZiIsCi0JCXNpemVvZihkZXZfcHJpdi0+
cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25m
aWcuaWQgPSAxOworCQlzaXplb2YoaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJ
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVy
Zi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVz
dF9vYSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdf
dGVzdF9vYTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZ
X1NJWkUobXV4X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2
LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9j
b3VudGVyX2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291
bnRlcl9yZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVz
dF9jb25maWcuYl9jb3VudGVyX3JlZ3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmln
X3Rlc3Rfb2EpOwogCi0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0g
ZmxleF9ldV9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5m
bGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1
LT5wZXJmLm9hLnRlc3RfY29uZmlnLmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7
CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShm
bGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmln
LnN5c2ZzX21ldHJpYy5uYW1lID0gImRkM2ZkNzg5LWU3ODMtNDIwNC04Y2QwLWI2NzFiYmNjYjBj
ZiI7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0g
ZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5zeXNmc19tZXRyaWMubmFtZSA9ICJkZDNmZDc4OS1lNzgzLTQyMDQtOGNkMC1iNjcx
YmJjY2IwY2YiOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJz
ID0gaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9h
LnRlc3RfY29uZmlnLmF0dHJzWzBdID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5
c2ZzX21ldHJpY19pZC5hdHRyOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0g
PSAmaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRl
dl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAi
aWQiOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRy
Lm1vZGUgPSAwNDQ0OwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJp
Y19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcu
c3lzZnNfbWV0cmljX2lkLmF0dHIubmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRl
c3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9nbGsuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfb2FfZ2xrLmgKaW5kZXggMDZkZWRmOTkxZWRiLi41ZDA3OTg2ODI3Yzgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfZ2xrLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9nbGsuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRl
ZiBfX0k5MTVfT0FfR0xLX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfR0xLX0hfXwogCi1leHRlcm4g
dm9pZCBpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19nbGsoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2ds
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9oc3cuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfb2FfaHN3LmMKaW5kZXggY2M2NTI2ZmRkMmJkLi42NDAzMDFjOWZiOWQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfaHN3LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9vYV9oc3cuYwpAQCAtOTIsMjggKzkyLDI4IEBAIHNob3dfcmVuZGVyX2Jh
c2ljX2lkKHN0cnVjdCBkZXZpY2UgKmtkZXYsIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRy
LCBjaGFyICpiCiB9CiAKIHZvaWQKLWk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2hzdyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZp
Z19oc3coc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RybGNweShkZXZfcHJp
di0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkLAorCXN0cmxjcHkoaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy51dWlkLAogCQkiNDAzZDg4MzItMWEyNy00YWE2LWE2NGUtZjUzODljZTdiMjEyIiwK
LQkJc2l6ZW9mKGRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnV1aWQpKTsKLQlkZXZfcHJp
di0+cGVyZi5vYS50ZXN0X2NvbmZpZy5pZCA9IDE7CisJCXNpemVvZihpOTE1LT5wZXJmLm9hLnRl
c3RfY29uZmlnLnV1aWQpKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmlkID0gMTsKIAot
CWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLm11eF9yZWdzID0gbXV4X2NvbmZpZ19yZW5k
ZXJfYmFzaWM7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcubXV4X3JlZ3NfbGVuID0g
QVJSQVlfU0laRShtdXhfY29uZmlnX3JlbmRlcl9iYXNpYyk7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfcmVuZGVyX2Jhc2ljOworCWk5MTUtPnBlcmYu
b2EudGVzdF9jb25maWcubXV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShtdXhfY29uZmlnX3JlbmRl
cl9iYXNpYyk7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5iX2NvdW50ZXJfcmVn
cyA9IGJfY291bnRlcl9jb25maWdfcmVuZGVyX2Jhc2ljOwotCWRldl9wcml2LT5wZXJmLm9hLnRl
c3RfY29uZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZp
Z19yZW5kZXJfYmFzaWMpOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3Jl
Z3MgPSBiX2NvdW50ZXJfY29uZmlnX3JlbmRlcl9iYXNpYzsKKwlpOTE1LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ19y
ZW5kZXJfYmFzaWMpOwogCi0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdz
ID0gZmxleF9ldV9jb25maWdfcmVuZGVyX2Jhc2ljOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLmZsZXhfcmVnc19sZW4gPSBBUlJBWV9TSVpFKGZsZXhfZXVfY29uZmlnX3JlbmRlcl9i
YXNpYyk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3MgPSBmbGV4X2V1X2Nv
bmZpZ19yZW5kZXJfYmFzaWM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3Nf
bGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ19yZW5kZXJfYmFzaWMpOwogCi0JZGV2X3By
aXYtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLm5hbWUgPSAiNDAzZDg4MzItMWEy
Ny00YWE2LWE2NGUtZjUzODljZTdiMjEyIjsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5zeXNmc19tZXRyaWMuYXR0cnMgPSBkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5hdHRy
czsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0gIjQwM2Q4
ODMyLTFhMjctNGFhNi1hNjRlLWY1Mzg5Y2U3YjIxMiI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5zeXNmc19tZXRyaWMuYXR0cnMgPSBpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJz
OwogCi0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmZGV2X3ByaXYt
PnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHI7CisJaTkxNS0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5hdHRyc1swXSA9ICZpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2Zz
X21ldHJpY19pZC5hdHRyOwogCi0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNf
bWV0cmljX2lkLmF0dHIubmFtZSA9ICJpZCI7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25m
aWcuc3lzZnNfbWV0cmljX2lkLmF0dHIubW9kZSA9IDA0NDQ7Ci0JZGV2X3ByaXYtPnBlcmYub2Eu
dGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLnNob3cgPSBzaG93X3JlbmRlcl9iYXNpY19pZDsK
KwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAi
aWQiOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIubW9k
ZSA9IDA0NDQ7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuc2hv
dyA9IHNob3dfcmVuZGVyX2Jhc2ljX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9vYV9oc3cuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfaHN3LmgK
aW5kZXggM2QwYzg3MGNkMGJkLi43ODEyYTlkZjg2NDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfb2FfaHN3LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9v
YV9oc3cuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVfT0FfSFNXX0hfXwogI2Rl
ZmluZSBfX0k5MTVfT0FfSFNXX0hfXwogCi1leHRlcm4gdm9pZCBpOTE1X3BlcmZfbG9hZF90ZXN0
X2NvbmZpZ19oc3coc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2V4dGVybiB2
b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2hzdyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9vYV9pY2wuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfaWNsLmMKaW5kZXggYmFh
NTE0MjdhNTQzLi4yYThjNmRlNjE5YmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfb2FfaWNsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9pY2wuYwpA
QCAtNzIsMjggKzcyLDI4IEBAIHNob3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBz
dHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1
X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19pY2woc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQoraTkxNV9wZXJmX2xvYWRfdGVzdF9jb25maWdfaWNsKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewotCXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVp
ZCwKKwlzdHJsY3B5KGk5MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJImEyOTE2NjVl
LTI0NGItNGI3Ni05YjlhLTAxZGU5ZDNjODA2OCIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5v
YS50ZXN0X2NvbmZpZy51dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQg
PSAxOworCQlzaXplb2YoaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+
cGVyZi5vYS50ZXN0X2NvbmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5tdXhfcmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7
CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9v
YTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUo
bXV4X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJf
Y291bnRlcl9yZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVy
X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9y
ZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25m
aWcuYl9jb3VudGVyX3JlZ3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rf
b2EpOwogCi0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9l
dV9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3Jl
Z3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkx
NS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1
X2NvbmZpZ190ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2Zz
X21ldHJpYy5uYW1lID0gImEyOTE2NjVlLTI0NGItNGI3Ni05YjlhLTAxZGU5ZDNjODA2OCI7Ci0J
ZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3By
aXYtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5zeXNmc19tZXRyaWMubmFtZSA9ICJhMjkxNjY1ZS0yNDRiLTRiNzYtOWI5YS0wMWRlOWQzYzgw
NjgiOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkx
NS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLmF0dHJzWzBdID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21l
dHJpY19pZC5hdHRyOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkx
NS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2
LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwot
CWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUg
PSAwNDQ0OwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5z
aG93ID0gc2hvd190ZXN0X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNf
bWV0cmljX2lkLmF0dHIubmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5z
eXNmc19tZXRyaWNfaWQuYXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9pY2wuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfb2FfaWNsLmgKaW5kZXggMjRlYWE5N2Q2MWJhLi5hN2M1MGQzMWU2NzggMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2FfaWNsLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9vYV9pY2wuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5
MTVfT0FfSUNMX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfSUNMX0hfXwogCi1leHRlcm4gdm9pZCBp
OTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19pY2woc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2ljbChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9rYmxndDIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfb2Ffa2JsZ3QyLmMKaW5kZXggMTY4ZTQ5YWIwZDRkLi45NzUzMTFkZjNkNjIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffa2JsZ3QyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9vYV9rYmxndDIuYwpAQCAtNjMsMjggKzYzLDI4IEBAIHNob3dfdGVz
dF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0
ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19rYmxn
dDIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJmX2xvYWRfdGVz
dF9jb25maWdfa2JsZ3QyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cmxj
cHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5KGk5MTUtPnBl
cmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJImJhYTNjN2U0LTUyYjYtNGI4NS04MDFlLTQ2NWE5
NGI3NDZkZCIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7
Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXplb2YoaTkxNS0+
cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5p
ZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9j
b25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVnc19s
ZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5wZXJmLm9hLnRl
c3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190ZXN0X29hKTsK
IAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3Vu
dGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291
bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hKTsKKwlp
OTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVyX2NvbmZp
Z190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3JlZ3NfbGVu
ID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2X3ByaXYtPnBl
cmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVzdF9vYTsKLQlk
ZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShm
bGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmZsZXhf
cmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKIAot
CWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0gImJhYTNj
N2U0LTUyYjYtNGI4NS04MDFlLTQ2NWE5NGI3NDZkZCI7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVz
dF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25m
aWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMubmFtZSA9
ICJiYWEzYzdlNC01MmI2LTRiODUtODAxZS00NjVhOTRiNzQ2ZGQiOworCWk5MTUtPnBlcmYub2Eu
dGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJzWzBdID0gJmRl
dl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyOworCWk5MTUt
PnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmln
LnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5wZXJmLm9hLnRl
c3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRldl9wcml2LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lk
OworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIubmFtZSA9
ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0ci5t
b2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5z
aG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9vYV9rYmxndDIuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffa2JsZ3Qy
LmgKaW5kZXggYTU1Mzk4YTkwNGRlLi41MzY1NWRlN2I5NzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfb2Ffa2JsZ3QyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9vYV9rYmxndDIuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVfT0FfS0JM
R1QyX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfS0JMR1QyX0hfXwogCi1leHRlcm4gdm9pZCBpOTE1
X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19rYmxndDIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2tibGd0Mihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9rYmxndDMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfb2Ffa2JsZ3QzLmMKaW5kZXggNmZmYTU1M2MzODhlLi5lZDM5ZjhkZDlhZjIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffa2JsZ3QzLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9rYmxndDMuYwpAQCAtNjMsMjggKzYzLDI4IEBAIHNob3df
dGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAq
YXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19r
YmxndDMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJmX2xvYWRf
dGVzdF9jb25maWdfa2JsZ3QzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0
cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5KGk5MTUt
PnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJImYxNzkyZjMyLTZkYjItNGI1MC1iNGIyLTU1
NzEyOGYxNjg4ZCIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlk
KSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXplb2YoaTkx
NS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11
eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVn
c19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5wZXJmLm9h
LnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190ZXN0X29h
KTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9j
b3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJf
Y291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hKTsK
KwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVyX2Nv
bmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3JlZ3Nf
bGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2X3ByaXYt
PnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVzdF9vYTsK
LQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0la
RShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmZs
ZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsK
IAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0gImYx
NzkyZjMyLTZkYjItNGI1MC1iNGIyLTU1NzEyOGYxNjg4ZCI7Ci0JZGV2X3ByaXYtPnBlcmYub2Eu
dGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2EudGVzdF9j
b25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMubmFt
ZSA9ICJmMTc5MmYzMi02ZGIyLTRiNTAtYjRiMi01NTcxMjhmMTY4OGQiOworCWk5MTUtPnBlcmYu
b2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJzWzBdID0g
JmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyOworCWk5
MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5wZXJmLm9h
LnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRldl9wcml2
LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29h
X2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIubmFt
ZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0
ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19p
ZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9vYV9rYmxndDMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffa2Js
Z3QzLmgKaW5kZXggM2RkZDM0ODNiN2NjLi42MGViZTJiMjBhZGEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffa2JsZ3QzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9vYV9rYmxndDMuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVfT0Ff
S0JMR1QzX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfS0JMR1QzX0hfXwogCi1leHRlcm4gdm9pZCBp
OTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19rYmxndDMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2tibGd0
MyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDIuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfb2Ffc2tsZ3QyLmMKaW5kZXggN2NlNmVlODUxZDQzLi42MGI0ZGJjZDRjNTkgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffc2tsZ3QyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDIuYwpAQCAtNjIsMjggKzYyLDI4IEBAIHNo
b3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0
ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZp
Z19za2xndDIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJmX2xv
YWRfdGVzdF9jb25maWdfc2tsZ3QyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5KGk5
MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJIjE2NTE5NDlmLTBhYzAtNGNiMS1hMDZm
LWRhZmQ3NGE0MDdkMSIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy51
dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXplb2Yo
aTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9
IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhf
cmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190ZXN0
X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0g
Yl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmln
LmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0X29h
KTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3VudGVy
X2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVyX3Jl
Z3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2X3By
aXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVzdF9v
YTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlf
U0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmln
LmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29h
KTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1lID0g
IjE2NTE5NDlmLTBhYzAtNGNiMS1hMDZmLWRhZmQ3NGE0MDdkMSI7Ci0JZGV2X3ByaXYtPnBlcmYu
b2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2EudGVz
dF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMu
bmFtZSA9ICIxNjUxOTQ5Zi0wYWMwLTRjYjEtYTA2Zi1kYWZkNzRhNDA3ZDEiOworCWk5MTUtPnBl
cmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJzWzBd
ID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyOwor
CWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRldl9w
cml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0
X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIu
bmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQu
YXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJp
Y19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9vYV9za2xndDIuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ff
c2tsZ3QyLmgKaW5kZXggYmU2MjU2MDM3MjM5Li5lZTZmNzQ3NTAyZWEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffc2tsZ3QyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9vYV9za2xndDIuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5MTVf
T0FfU0tMR1QyX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfU0tMR1QyX0hfXwogCi1leHRlcm4gdm9p
ZCBpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19za2xndDIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX3Nr
bGd0MihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfb2Ffc2tsZ3QzLmMKaW5kZXggMDg2Y2EyNjMxZTFjLi44YzIzY2Y3MTJhN2Eg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffc2tsZ3QzLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDMuYwpAQCAtNjMsMjggKzYzLDI4IEBA
IHNob3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJp
YnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0X2Nv
bmZpZ19za2xndDMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9wZXJm
X2xvYWRfdGVzdF9jb25maWdfc2tsZ3QzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJsY3B5
KGk5MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJIjJiOTg1ODAzLWQzYzktNDYyOS04
YTRmLTYzNGJmZWNiYTBlOCIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy51dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlzaXpl
b2YoaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50ZXN0
X2NvbmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVn
cyA9IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5t
dXhfcmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+cGVy
Zi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZpZ190
ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdz
ID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190ZXN0
X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9jb3Vu
dGVyX2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3VudGVy
X3JlZ3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0JZGV2
X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdfdGVz
dF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJS
QVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0
X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5uYW1l
ID0gIjJiOTg1ODAzLWQzYzktNDYyOS04YTRmLTYzNGJmZWNiYTBlOCI7Ci0JZGV2X3ByaXYtPnBl
cmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYub2Eu
dGVzdF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRy
aWMubmFtZSA9ICIyYjk4NTgwMy1kM2M5LTQ2MjktOGE0Zi02MzRiZmVjYmEwZTgiOworCWk5MTUt
PnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0dHJz
WzBdID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRy
OworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRl
c3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0OwotCWRl
dl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hvd190
ZXN0X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0
dHIubmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNf
aWQuYXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21l
dHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
b2Ffc2tsZ3QzLmgKaW5kZXggNjUwYmViMDY4ZTU2Li4zNWNjYjQxMjVkNzEgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffc2tsZ3QzLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9vYV9za2xndDMuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBfX0k5
MTVfT0FfU0tMR1QzX0hfXwogI2RlZmluZSBfX0k5MTVfT0FfU0tMR1QzX0hfXwogCi1leHRlcm4g
dm9pZCBpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19za2xndDMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmln
X3NrbGd0MyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfb2Ffc2tsZ3Q0LmMKaW5kZXggYjI5MWE2ZWI4YTg3Li5iODQ2ZGE2MTk4
ZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffc2tsZ3Q0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDQuYwpAQCAtNjMsMjggKzYzLDI4
IEBAIHNob3dfdGVzdF9vYV9pZChzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0
dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogfQogCiB2b2lkCi1pOTE1X3BlcmZfbG9hZF90ZXN0
X2NvbmZpZ19za2xndDQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9w
ZXJmX2xvYWRfdGVzdF9jb25maWdfc2tsZ3Q0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewotCXN0cmxjcHkoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKKwlzdHJs
Y3B5KGk5MTUtPnBlcmYub2EudGVzdF9jb25maWcudXVpZCwKIAkJIjg4MmZhNDMzLTFmNGEtNGE2
Ny1hOTYyLWM3NDE4ODhmZTVmNSIsCi0JCXNpemVvZihkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2Nv
bmZpZy51dWlkKSk7Ci0JZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPSAxOworCQlz
aXplb2YoaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy51dWlkKSk7CisJaTkxNS0+cGVyZi5vYS50
ZXN0X2NvbmZpZy5pZCA9IDE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhf
cmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZp
Zy5tdXhfcmVnc19sZW4gPSBBUlJBWV9TSVpFKG11eF9jb25maWdfdGVzdF9vYSk7CisJaTkxNS0+
cGVyZi5vYS50ZXN0X2NvbmZpZy5tdXhfcmVncyA9IG11eF9jb25maWdfdGVzdF9vYTsKKwlpOTE1
LT5wZXJmLm9hLnRlc3RfY29uZmlnLm11eF9yZWdzX2xlbiA9IEFSUkFZX1NJWkUobXV4X2NvbmZp
Z190ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9y
ZWdzID0gYl9jb3VudGVyX2NvbmZpZ190ZXN0X29hOwotCWRldl9wcml2LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLmJfY291bnRlcl9yZWdzX2xlbiA9IEFSUkFZX1NJWkUoYl9jb3VudGVyX2NvbmZpZ190
ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLmJfY291bnRlcl9yZWdzID0gYl9j
b3VudGVyX2NvbmZpZ190ZXN0X29hOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYl9jb3Vu
dGVyX3JlZ3NfbGVuID0gQVJSQVlfU0laRShiX2NvdW50ZXJfY29uZmlnX3Rlc3Rfb2EpOwogCi0J
ZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuZmxleF9yZWdzID0gZmxleF9ldV9jb25maWdf
dGVzdF9vYTsKLQlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0g
QVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190ZXN0X29hKTsKKwlpOTE1LT5wZXJmLm9hLnRlc3Rf
Y29uZmlnLmZsZXhfcmVncyA9IGZsZXhfZXVfY29uZmlnX3Rlc3Rfb2E7CisJaTkxNS0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5mbGV4X3JlZ3NfbGVuID0gQVJSQVlfU0laRShmbGV4X2V1X2NvbmZpZ190
ZXN0X29hKTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpYy5u
YW1lID0gIjg4MmZhNDMzLTFmNGEtNGE2Ny1hOTYyLWM3NDE4ODhmZTVmNSI7Ci0JZGV2X3ByaXYt
PnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gZGV2X3ByaXYtPnBlcmYu
b2EudGVzdF9jb25maWcuYXR0cnM7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19t
ZXRyaWMubmFtZSA9ICI4ODJmYTQzMy0xZjRhLTRhNjctYTk2Mi1jNzQxODg4ZmU1ZjUiOworCWk5
MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljLmF0dHJzID0gaTkxNS0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5hdHRyczsKIAotCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmF0
dHJzWzBdID0gJmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5h
dHRyOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuYXR0cnNbMF0gPSAmaTkxNS0+cGVyZi5v
YS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWNfaWQuYXR0cjsKIAotCWRldl9wcml2LT5wZXJmLm9h
LnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm5hbWUgPSAiaWQiOwotCWRldl9wcml2
LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyLm1vZGUgPSAwNDQ0Owot
CWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5zaG93ID0gc2hv
d190ZXN0X29hX2lkOworCWk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lk
LmF0dHIubmFtZSA9ICJpZCI7CisJaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRy
aWNfaWQuYXR0ci5tb2RlID0gMDQ0NDsKKwlpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnLnN5c2Zz
X21ldHJpY19pZC5zaG93ID0gc2hvd190ZXN0X29hX2lkOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfb2Ffc2tsZ3Q0LmgKaW5kZXggOGRjZjg0OWQxMzFlLi5mM2Y2ZDdiZjI4ZTAgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfb2Ffc2tsZ3Q0LmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9vYV9za2xndDQuaApAQCAtMTAsNiArMTAsNiBAQAogI2lmbmRlZiBf
X0k5MTVfT0FfU0tMR1Q0X0hfXwogI2RlZmluZSBfX0k5MTVfT0FfU0tMR1Q0X0hfXwogCi1leHRl
cm4gdm9pZCBpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19za2xndDQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KTsKK2V4dGVybiB2b2lkIGk5MTVfcGVyZl9sb2FkX3Rlc3RfY29u
ZmlnX3NrbGd0NChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCBkOTJkZGZhZGEyNjIuLmUwZWY3N2VjNGRhMyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTM2Niw3ICszNjYsNyBAQCBzdHJ1Y3QgcGVyZl9v
cGVuX3Byb3BlcnRpZXMgewogCWludCBvYV9wZXJpb2RfZXhwb25lbnQ7CiB9OwogCi1zdGF0aWMg
dm9pZCBmcmVlX29hX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdm9pZCBmcmVlX29hX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnKQogewogCWlmICghUFRSX0VS
UihvYV9jb25maWctPmZsZXhfcmVncykpCkBAIC0zNzgsNDggKzM3OCw0OCBAQCBzdGF0aWMgdm9p
ZCBmcmVlX29hX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJa2Zy
ZWUob2FfY29uZmlnKTsKIH0KIAotc3RhdGljIHZvaWQgcHV0X29hX2NvbmZpZyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9h
X2NvbmZpZykKIHsKIAlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJm9hX2NvbmZpZy0+cmVmX2Nv
dW50KSkKIAkJcmV0dXJuOwogCi0JZnJlZV9vYV9jb25maWcoZGV2X3ByaXYsIG9hX2NvbmZpZyk7
CisJZnJlZV9vYV9jb25maWcoaTkxNSwgb2FfY29uZmlnKTsKIH0KIAotc3RhdGljIGludCBnZXRf
b2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBpbnQg
Z2V0X29hX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSBpbnQgbWV0
cmljc19zZXQsCiAJCQkgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZykKIHsKIAlp
bnQgcmV0OwogCiAJaWYgKG1ldHJpY3Nfc2V0ID09IDEpIHsKLQkJKm91dF9jb25maWcgPSAmZGV2
X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWc7Ci0JCWF0b21pY19pbmMoJmRldl9wcml2LT5wZXJm
Lm9hLnRlc3RfY29uZmlnLnJlZl9jb3VudCk7CisJCSpvdXRfY29uZmlnID0gJmk5MTUtPnBlcmYu
b2EudGVzdF9jb25maWc7CisJCWF0b21pY19pbmMoJmk5MTUtPnBlcmYub2EudGVzdF9jb25maWcu
cmVmX2NvdW50KTsKIAkJcmV0dXJuIDA7CiAJfQogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOworCXJldCA9IG11dGV4X2xvY2tf
aW50ZXJydXB0aWJsZSgmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOwogCWlmIChyZXQpCiAJCXJl
dHVybiByZXQ7CiAKLQkqb3V0X2NvbmZpZyA9IGlkcl9maW5kKCZkZXZfcHJpdi0+cGVyZi5tZXRy
aWNzX2lkciwgbWV0cmljc19zZXQpOworCSpvdXRfY29uZmlnID0gaWRyX2ZpbmQoJmk5MTUtPnBl
cmYubWV0cmljc19pZHIsIG1ldHJpY3Nfc2V0KTsKIAlpZiAoISpvdXRfY29uZmlnKQogCQlyZXQg
PSAtRUlOVkFMOwogCWVsc2UKIAkJYXRvbWljX2luYygmKCpvdXRfY29uZmlnKS0+cmVmX2NvdW50
KTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKKwltdXRl
eF91bmxvY2soJmk5MTUtPnBlcmYubWV0cmljc19sb2NrKTsKIAogCXJldHVybiByZXQ7CiB9CiAK
LXN0YXRpYyB1MzIgZ2VuOF9vYV9od190YWlsX3JlYWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHUzMiBnZW44X29hX2h3X3RhaWxfcmVhZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlyZXR1cm4gSTkxNV9SRUFEKEdFTjhfT0FUQUlMUFRSKSAm
IEdFTjhfT0FUQUlMUFRSX01BU0s7CiB9CiAKLXN0YXRpYyB1MzIgZ2VuN19vYV9od190YWlsX3Jl
YWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHUzMiBnZW43X29h
X2h3X3RhaWxfcmVhZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgb2Fz
dGF0dXMxID0gSTkxNV9SRUFEKEdFTjdfT0FTVEFUVVMxKTsKIApAQCAtNDI4LDcgKzQyOCw3IEBA
IHN0YXRpYyB1MzIgZ2VuN19vYV9od190YWlsX3JlYWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCiAvKioKICAqIG9hX2J1ZmZlcl9jaGVja191bmxvY2tlZCAtIGNoZWNrIGZv
ciBkYXRhIGFuZCB1cGRhdGUgdGFpbCBwdHIgc3RhdGUKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZp
Y2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAqIFRoaXMg
aXMgZWl0aGVyIGNhbGxlZCB2aWEgZm9wcyAoZm9yIGJsb2NraW5nIHJlYWRzIGluIHVzZXIgY3R4
KSBvciB0aGUgcG9sbAogICogY2hlY2sgaHJ0aW1lciAoYXRvbWljIGN0eCkgdG8gY2hlY2sgdGhl
IE9BIGJ1ZmZlciB0YWlsIHBvaW50ZXIgYW5kIGNoZWNrCkBAIC00NTAsOSArNDUwLDkgQEAgc3Rh
dGljIHUzMiBnZW43X29hX2h3X3RhaWxfcmVhZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAgKgogICogUmV0dXJuczogJXRydWUgaWYgdGhlIE9BIGJ1ZmZlciBjb250YWlucyBk
YXRhLCBlbHNlICVmYWxzZQogICovCi1zdGF0aWMgYm9vbCBvYV9idWZmZXJfY2hlY2tfdW5sb2Nr
ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGJvb2wgb2FfYnVm
ZmVyX2NoZWNrX3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlu
dCByZXBvcnRfc2l6ZSA9IGRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5mb3JtYXRfc2l6ZTsK
KwlpbnQgcmVwb3J0X3NpemUgPSBpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5mb3JtYXRfc2l6ZTsK
IAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCXVuc2lnbmVkIGludCBhZ2VkX2lkeDsKIAl1MzIgaGVh
ZCwgaHdfdGFpbCwgYWdlZF90YWlsLCBhZ2luZ190YWlsOwpAQCAtNDYyLDE5ICs0NjIsMTkgQEAg
c3RhdGljIGJvb2wgb2FfYnVmZmVyX2NoZWNrX3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAkgKiBjb3VsZCByZXN1bHQgaW4gYW4gT0EgYnVmZmVyIHJlc2V0IHdo
aWNoIG1pZ2h0IHJlc2V0IHRoZSBoZWFkLAogCSAqIHRhaWxzW10gYW5kIGFnZWRfdGFpbCBzdGF0
ZS4KIAkgKi8KLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVy
LnB0cl9sb2NrLCBmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPnBlcmYub2Eub2Ff
YnVmZmVyLnB0cl9sb2NrLCBmbGFncyk7CiAKIAkvKiBOQjogVGhlIGhlYWQgd2Ugb2JzZXJ2ZSBo
ZXJlIG1pZ2h0IGVmZmVjdGl2ZWx5IGJlIGEgbGl0dGxlIG91dCBvZgogCSAqIGRhdGUgKGJldHdl
ZW4gaGVhZCBhbmQgdGFpbHNbYWdlZF9pZHhdLm9mZnNldCBpZiB0aGVyZSBpcyBjdXJyZW50bHkK
IAkgKiBhIHJlYWQoKSBpbiBwcm9ncmVzcy4KIAkgKi8KLQloZWFkID0gZGV2X3ByaXYtPnBlcmYu
b2Eub2FfYnVmZmVyLmhlYWQ7CisJaGVhZCA9IGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmhlYWQ7
CiAKLQlhZ2VkX2lkeCA9IGRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5hZ2VkX3RhaWxfaWR4
OwotCWFnZWRfdGFpbCA9IGRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci50YWlsc1thZ2VkX2lk
eF0ub2Zmc2V0OwotCWFnaW5nX3RhaWwgPSBkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudGFp
bHNbIWFnZWRfaWR4XS5vZmZzZXQ7CisJYWdlZF9pZHggPSBpOTE1LT5wZXJmLm9hLm9hX2J1ZmZl
ci5hZ2VkX3RhaWxfaWR4OworCWFnZWRfdGFpbCA9IGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnRh
aWxzW2FnZWRfaWR4XS5vZmZzZXQ7CisJYWdpbmdfdGFpbCA9IGk5MTUtPnBlcmYub2Eub2FfYnVm
ZmVyLnRhaWxzWyFhZ2VkX2lkeF0ub2Zmc2V0OwogCi0JaHdfdGFpbCA9IGRldl9wcml2LT5wZXJm
Lm9hLm9wcy5vYV9od190YWlsX3JlYWQoZGV2X3ByaXYpOworCWh3X3RhaWwgPSBpOTE1LT5wZXJm
Lm9hLm9wcy5vYV9od190YWlsX3JlYWQoaTkxNSk7CiAKIAkvKiBUaGUgdGFpbCBwb2ludGVyIGlu
Y3JlYXNlcyBpbiA2NCBieXRlIGluY3JlbWVudHMsCiAJICogbm90IGluIHJlcG9ydF9zaXplIHN0
ZXBzLi4uCkBAIC00OTQsMTYgKzQ5NCwxNiBAQCBzdGF0aWMgYm9vbCBvYV9idWZmZXJfY2hlY2tf
dW5sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIGF2YWlsYWJs
ZSkgd2l0aG91dCBuZWVkaW5nIHRvIHdhaXQgZm9yIGEgbGF0ZXIgaHJ0aW1lciBjYWxsYmFjay4K
IAkgKi8KIAlpZiAoYWdpbmdfdGFpbCAhPSBJTlZBTElEX1RBSUxfUFRSICYmCi0JICAgICgobm93
IC0gZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLmFnaW5nX3RpbWVzdGFtcCkgPgorCSAgICAo
KG5vdyAtIGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmFnaW5nX3RpbWVzdGFtcCkgPgogCSAgICAg
T0FfVEFJTF9NQVJHSU5fTlNFQykpIHsKIAogCQlhZ2VkX2lkeCBePSAxOwotCQlkZXZfcHJpdi0+
cGVyZi5vYS5vYV9idWZmZXIuYWdlZF90YWlsX2lkeCA9IGFnZWRfaWR4OworCQlpOTE1LT5wZXJm
Lm9hLm9hX2J1ZmZlci5hZ2VkX3RhaWxfaWR4ID0gYWdlZF9pZHg7CiAKIAkJYWdlZF90YWlsID0g
YWdpbmdfdGFpbDsKIAogCQkvKiBNYXJrIHRoYXQgd2UgbmVlZCBhIG5ldyBwb2ludGVyIHRvIHN0
YXJ0IGFnaW5nLi4uICovCi0JCWRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci50YWlsc1shYWdl
ZF9pZHhdLm9mZnNldCA9IElOVkFMSURfVEFJTF9QVFI7CisJCWk5MTUtPnBlcmYub2Eub2FfYnVm
ZmVyLnRhaWxzWyFhZ2VkX2lkeF0ub2Zmc2V0ID0gSU5WQUxJRF9UQUlMX1BUUjsKIAkJYWdpbmdf
dGFpbCA9IElOVkFMSURfVEFJTF9QVFI7CiAJfQogCkBAIC01MTgsNyArNTE4LDcgQEAgc3RhdGlj
IGJvb2wgb2FfYnVmZmVyX2NoZWNrX3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAlpZiAoYWdpbmdfdGFpbCA9PSBJTlZBTElEX1RBSUxfUFRSICYmCiAJICAgIChh
Z2VkX3RhaWwgPT0gSU5WQUxJRF9UQUlMX1BUUiB8fAogCSAgICAgT0FfVEFLRU4oaHdfdGFpbCwg
YWdlZF90YWlsKSA+PSByZXBvcnRfc2l6ZSkpIHsKLQkJc3RydWN0IGk5MTVfdm1hICp2bWEgPSBk
ZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudm1hOworCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9
IGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZtYTsKIAkJdTMyIGd0dF9vZmZzZXQgPSBpOTE1X2dn
dHRfb2Zmc2V0KHZtYSk7CiAKIAkJLyogQmUgcGFyYW5vaWQgYW5kIGRvIGEgYm91bmRzIGNoZWNr
IG9uIHRoZSBwb2ludGVyIHJlYWQgYmFjawpAQCAtNTI3LDE2ICs1MjcsMTYgQEAgc3RhdGljIGJv
b2wgb2FfYnVmZmVyX2NoZWNrX3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJICovCiAJCWlmIChod190YWlsID49IGd0dF9vZmZzZXQgJiYKIAkJICAgIGh3X3Rh
aWwgPCAoZ3R0X29mZnNldCArIE9BX0JVRkZFUl9TSVpFKSkgewotCQkJZGV2X3ByaXYtPnBlcmYu
b2Eub2FfYnVmZmVyLnRhaWxzWyFhZ2VkX2lkeF0ub2Zmc2V0ID0KKwkJCWk5MTUtPnBlcmYub2Eu
b2FfYnVmZmVyLnRhaWxzWyFhZ2VkX2lkeF0ub2Zmc2V0ID0KIAkJCQlhZ2luZ190YWlsID0gaHdf
dGFpbDsKLQkJCWRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5hZ2luZ190aW1lc3RhbXAgPSBu
b3c7CisJCQlpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5hZ2luZ190aW1lc3RhbXAgPSBub3c7CiAJ
CX0gZWxzZSB7CiAJCQlEUk1fRVJST1IoIklnbm9yaW5nIHNwdXJpb3VzIG91dCBvZiByYW5nZSBP
QSBidWZmZXIgdGFpbCBwb2ludGVyID0gJXVcbiIsCiAJCQkJICBod190YWlsKTsKIAkJfQogCX0K
IAotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5w
dHJfbG9jaywgZmxhZ3MpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPnBlcmYub2Eu
b2FfYnVmZmVyLnB0cl9sb2NrLCBmbGFncyk7CiAKIAlyZXR1cm4gYWdlZF90YWlsID09IElOVkFM
SURfVEFJTF9QVFIgPwogCQlmYWxzZSA6IE9BX1RBS0VOKGFnZWRfdGFpbCwgaGVhZCkgPj0gcmVw
b3J0X3NpemU7CkBAIC01OTksOCArNTk5LDggQEAgc3RhdGljIGludCBhcHBlbmRfb2Ffc2FtcGxl
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCQkgICAgc2l6ZV90ICpvZmZzZXQs
CiAJCQkgICAgY29uc3QgdTggKnJlcG9ydCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OwotCWludCByZXBvcnRfc2l6ZSA9IGRldl9wcml2
LT5wZXJmLm9hLm9hX2J1ZmZlci5mb3JtYXRfc2l6ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHN0cmVhbS0+aTkxNTsKKwlpbnQgcmVwb3J0X3NpemUgPSBpOTE1LT5wZXJmLm9h
Lm9hX2J1ZmZlci5mb3JtYXRfc2l6ZTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9yZWNvcmRfaGVh
ZGVyIGhlYWRlcjsKIAl1MzIgc2FtcGxlX2ZsYWdzID0gc3RyZWFtLT5zYW1wbGVfZmxhZ3M7CiAK
QEAgLTY1MSwxMCArNjUxLDEwIEBAIHN0YXRpYyBpbnQgZ2VuOF9hcHBlbmRfb2FfcmVwb3J0cyhz
dHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCQkJCSAgc2l6ZV90IGNvdW50LAogCQkJ
CSAgc2l6ZV90ICpvZmZzZXQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gc3RyZWFtLT5kZXZfcHJpdjsKLQlpbnQgcmVwb3J0X3NpemUgPSBkZXZfcHJpdi0+cGVyZi5v
YS5vYV9idWZmZXIuZm9ybWF0X3NpemU7Ci0JdTggKm9hX2J1Zl9iYXNlID0gZGV2X3ByaXYtPnBl
cmYub2Eub2FfYnVmZmVyLnZhZGRyOwotCXUzMiBndHRfb2Zmc2V0ID0gaTkxNV9nZ3R0X29mZnNl
dChkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudm1hKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHN0cmVhbS0+aTkxNTsKKwlpbnQgcmVwb3J0X3NpemUgPSBpOTE1LT5wZXJm
Lm9hLm9hX2J1ZmZlci5mb3JtYXRfc2l6ZTsKKwl1OCAqb2FfYnVmX2Jhc2UgPSBpOTE1LT5wZXJm
Lm9hLm9hX2J1ZmZlci52YWRkcjsKKwl1MzIgZ3R0X29mZnNldCA9IGk5MTVfZ2d0dF9vZmZzZXQo
aTkxNS0+cGVyZi5vYS5vYV9idWZmZXIudm1hKTsKIAl1MzIgbWFzayA9IChPQV9CVUZGRVJfU0la
RSAtIDEpOwogCXNpemVfdCBzdGFydF9vZmZzZXQgPSAqb2Zmc2V0OwogCXVuc2lnbmVkIGxvbmcg
ZmxhZ3M7CkBAIC02NjYsMTMgKzY2NiwxMyBAQCBzdGF0aWMgaW50IGdlbjhfYXBwZW5kX29hX3Jl
cG9ydHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAlpZiAoV0FSTl9PTighc3Ry
ZWFtLT5lbmFibGVkKSkKIAkJcmV0dXJuIC1FSU87CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2
X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnB0cl9sb2NrLCBmbGFncyk7CisJc3Bpbl9sb2NrX2ly
cXNhdmUoJmk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnB0cl9sb2NrLCBmbGFncyk7CiAKLQloZWFk
ID0gZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLmhlYWQ7Ci0JYWdlZF90YWlsX2lkeCA9IGRl
dl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5hZ2VkX3RhaWxfaWR4OwotCXRhaWwgPSBkZXZfcHJp
di0+cGVyZi5vYS5vYV9idWZmZXIudGFpbHNbYWdlZF90YWlsX2lkeF0ub2Zmc2V0OworCWhlYWQg
PSBpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5oZWFkOworCWFnZWRfdGFpbF9pZHggPSBpOTE1LT5w
ZXJmLm9hLm9hX2J1ZmZlci5hZ2VkX3RhaWxfaWR4OworCXRhaWwgPSBpOTE1LT5wZXJmLm9hLm9h
X2J1ZmZlci50YWlsc1thZ2VkX3RhaWxfaWR4XS5vZmZzZXQ7CiAKLQlzcGluX3VubG9ja19pcnFy
ZXN0b3JlKCZkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIucHRyX2xvY2ssIGZsYWdzKTsKKwlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jaywg
ZmxhZ3MpOwogCiAJLyoKIAkgKiBBbiBpbnZhbGlkIHRhaWwgcG9pbnRlciBoZXJlIG1lYW5zIHdl
J3JlIHN0aWxsIHdhaXRpbmcgZm9yIHRoZSBwb2xsCkBAIC03MzYsMTIgKzczNiwxMiBAQCBzdGF0
aWMgaW50IGdlbjhfYXBwZW5kX29hX3JlcG9ydHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0
cmVhbSwKIAkJcmVhc29uID0gKChyZXBvcnQzMlswXSA+PiBPQVJFUE9SVF9SRUFTT05fU0hJRlQp
ICYKIAkJCSAgT0FSRVBPUlRfUkVBU09OX01BU0spOwogCQlpZiAocmVhc29uID09IDApIHsKLQkJ
CWlmIChfX3JhdGVsaW1pdCgmZGV2X3ByaXYtPnBlcmYub2Euc3B1cmlvdXNfcmVwb3J0X3JzKSkK
KwkJCWlmIChfX3JhdGVsaW1pdCgmaTkxNS0+cGVyZi5vYS5zcHVyaW91c19yZXBvcnRfcnMpKQog
CQkJCURSTV9OT1RFKCJTa2lwcGluZyBzcHVyaW91cywgaW52YWxpZCBPQSByZXBvcnRcbiIpOwog
CQkJY29udGludWU7CiAJCX0KIAotCQljdHhfaWQgPSByZXBvcnQzMlsyXSAmIGRldl9wcml2LT5w
ZXJmLm9hLnNwZWNpZmljX2N0eF9pZF9tYXNrOworCQljdHhfaWQgPSByZXBvcnQzMlsyXSAmIGk5
MTUtPnBlcmYub2Euc3BlY2lmaWNfY3R4X2lkX21hc2s7CiAKIAkJLyoKIAkJICogU3F1YXNoIHdo
YXRldmVyIGlzIGluIHRoZSBDVFhfSUQgZmllbGQgaWYgaXQncyBtYXJrZWQgYXMKQEAgLTc1MSw3
ICs3NTEsNyBAQCBzdGF0aWMgaW50IGdlbjhfYXBwZW5kX29hX3JlcG9ydHMoc3RydWN0IGk5MTVf
cGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJICogTm90ZTogdGhhdCB3ZSBkb24ndCBjbGVhciB0aGUg
dmFsaWRfY3R4X2JpdCBzbyB1c2Vyc3BhY2UgY2FuCiAJCSAqIHVuZGVyc3RhbmQgdGhhdCB0aGUg
SUQgaGFzIGJlZW4gc3F1YXNoZWQgYnkgdGhlIGtlcm5lbC4KIAkJICovCi0JCWlmICghKHJlcG9y
dDMyWzBdICYgZGV2X3ByaXYtPnBlcmYub2EuZ2VuOF92YWxpZF9jdHhfYml0KSkKKwkJaWYgKCEo
cmVwb3J0MzJbMF0gJiBpOTE1LT5wZXJmLm9hLmdlbjhfdmFsaWRfY3R4X2JpdCkpCiAJCQljdHhf
aWQgPSByZXBvcnQzMlsyXSA9IElOVkFMSURfQ1RYX0lEOwogCiAJCS8qCkBAIC03ODUsMTggKzc4
NSwxOCBAQCBzdGF0aWMgaW50IGdlbjhfYXBwZW5kX29hX3JlcG9ydHMoc3RydWN0IGk5MTVfcGVy
Zl9zdHJlYW0gKnN0cmVhbSwKIAkJICogc3dpdGNoZXMgc2luY2UgaXQncyBub3QtdW5jb21tb24g
Zm9yIHBlcmlvZGljIHNhbXBsZXMgdG8KIAkJICogaWRlbnRpZnkgYSBzd2l0Y2ggYmVmb3JlIGFu
eSAnY29udGV4dCBzd2l0Y2gnIHJlcG9ydC4KIAkJICovCi0JCWlmICghZGV2X3ByaXYtPnBlcmYu
b2EuZXhjbHVzaXZlX3N0cmVhbS0+Y3R4IHx8Ci0JCSAgICBkZXZfcHJpdi0+cGVyZi5vYS5zcGVj
aWZpY19jdHhfaWQgPT0gY3R4X2lkIHx8Ci0JCSAgICAoZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVm
ZmVyLmxhc3RfY3R4X2lkID09Ci0JCSAgICAgZGV2X3ByaXYtPnBlcmYub2Euc3BlY2lmaWNfY3R4
X2lkKSB8fAorCQlpZiAoIWk5MTUtPnBlcmYub2EuZXhjbHVzaXZlX3N0cmVhbS0+Y3R4IHx8CisJ
CSAgICBpOTE1LT5wZXJmLm9hLnNwZWNpZmljX2N0eF9pZCA9PSBjdHhfaWQgfHwKKwkJICAgIChp
OTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5sYXN0X2N0eF9pZCA9PQorCQkgICAgIGk5MTUtPnBlcmYu
b2Euc3BlY2lmaWNfY3R4X2lkKSB8fAogCQkgICAgcmVhc29uICYgT0FSRVBPUlRfUkVBU09OX0NU
WF9TV0lUQ0gpIHsKIAogCQkJLyoKIAkJCSAqIFdoaWxlIGZpbHRlcmluZyBmb3IgYSBzaW5nbGUg
Y29udGV4dCB3ZSBhdm9pZAogCQkJICogbGVha2luZyB0aGUgSURzIG9mIG90aGVyIGNvbnRleHRz
LgogCQkJICovCi0JCQlpZiAoZGV2X3ByaXYtPnBlcmYub2EuZXhjbHVzaXZlX3N0cmVhbS0+Y3R4
ICYmCi0JCQkgICAgZGV2X3ByaXYtPnBlcmYub2Euc3BlY2lmaWNfY3R4X2lkICE9IGN0eF9pZCkg
eworCQkJaWYgKGk5MTUtPnBlcmYub2EuZXhjbHVzaXZlX3N0cmVhbS0+Y3R4ICYmCisJCQkgICAg
aTkxNS0+cGVyZi5vYS5zcGVjaWZpY19jdHhfaWQgIT0gY3R4X2lkKSB7CiAJCQkJcmVwb3J0MzJb
Ml0gPSBJTlZBTElEX0NUWF9JRDsKIAkJCX0KIApAQCAtODA1LDcgKzgwNSw3IEBAIHN0YXRpYyBp
bnQgZ2VuOF9hcHBlbmRfb2FfcmVwb3J0cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFt
LAogCQkJaWYgKHJldCkKIAkJCQlicmVhazsKIAotCQkJZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVm
ZmVyLmxhc3RfY3R4X2lkID0gY3R4X2lkOworCQkJaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIubGFz
dF9jdHhfaWQgPSBjdHhfaWQ7CiAJCX0KIAogCQkvKgpAQCAtODE5LDcgKzgxOSw3IEBAIHN0YXRp
YyBpbnQgZ2VuOF9hcHBlbmRfb2FfcmVwb3J0cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtLAogCX0KIAogCWlmIChzdGFydF9vZmZzZXQgIT0gKm9mZnNldCkgewotCQlzcGluX2xvY2tf
aXJxc2F2ZSgmZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnB0cl9sb2NrLCBmbGFncyk7CisJ
CXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jaywgZmxh
Z3MpOwogCiAJCS8qCiAJCSAqIFdlIHJlbW92ZWQgdGhlIGd0dF9vZmZzZXQgZm9yIHRoZSBjb3B5
IGxvb3AgYWJvdmUsIGluZGV4aW5nCkBAIC04MjgsOSArODI4LDkgQEAgc3RhdGljIGludCBnZW44
X2FwcGVuZF9vYV9yZXBvcnRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCWhl
YWQgKz0gZ3R0X29mZnNldDsKIAogCQlJOTE1X1dSSVRFKEdFTjhfT0FIRUFEUFRSLCBoZWFkICYg
R0VOOF9PQUhFQURQVFJfTUFTSyk7Ci0JCWRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5oZWFk
ID0gaGVhZDsKKwkJaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIuaGVhZCA9IGhlYWQ7CiAKLQkJc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnB0cl9sb2Nr
LCBmbGFncyk7CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPnBlcmYub2Eub2FfYnVm
ZmVyLnB0cl9sb2NrLCBmbGFncyk7CiAJfQogCiAJcmV0dXJuIHJldDsKQEAgLTg2MSwxMSArODYx
LDExIEBAIHN0YXRpYyBpbnQgZ2VuOF9vYV9yZWFkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0sCiAJCQlzaXplX3QgY291bnQsCiAJCQlzaXplX3QgKm9mZnNldCkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5pOTE1OwogCXUzMiBvYXN0YXR1czsKIAlp
bnQgcmV0OwogCi0JaWYgKFdBUk5fT04oIWRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci52YWRk
cikpCisJaWYgKFdBUk5fT04oIWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyKSkKIAkJcmV0
dXJuIC1FSU87CiAKIAlvYXN0YXR1cyA9IEk5MTVfUkVBRChHRU44X09BU1RBVFVTKTsKQEAgLTg5
MSwxMCArODkxLDEwIEBAIHN0YXRpYyBpbnQgZ2VuOF9vYV9yZWFkKHN0cnVjdCBpOTE1X3BlcmZf
c3RyZWFtICpzdHJlYW0sCiAJCQlyZXR1cm4gcmV0OwogCiAJCURSTV9ERUJVRygiT0EgYnVmZmVy
IG92ZXJmbG93IChleHBvbmVudCA9ICVkKTogZm9yY2UgcmVzdGFydFxuIiwKLQkJCSAgZGV2X3By
aXYtPnBlcmYub2EucGVyaW9kX2V4cG9uZW50KTsKKwkJCSAgaTkxNS0+cGVyZi5vYS5wZXJpb2Rf
ZXhwb25lbnQpOwogCi0JCWRldl9wcml2LT5wZXJmLm9hLm9wcy5vYV9kaXNhYmxlKHN0cmVhbSk7
Ci0JCWRldl9wcml2LT5wZXJmLm9hLm9wcy5vYV9lbmFibGUoc3RyZWFtKTsKKwkJaTkxNS0+cGVy
Zi5vYS5vcHMub2FfZGlzYWJsZShzdHJlYW0pOworCQlpOTE1LT5wZXJmLm9hLm9wcy5vYV9lbmFi
bGUoc3RyZWFtKTsKIAogCQkvKgogCQkgKiBOb3RlOiAub2FfZW5hYmxlKCkgaXMgZXhwZWN0ZWQg
dG8gcmUtaW5pdCB0aGUgb2FidWZmZXIgYW5kCkBAIC05NDAsMTAgKzk0MCwxMCBAQCBzdGF0aWMg
aW50IGdlbjdfYXBwZW5kX29hX3JlcG9ydHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSwKIAkJCQkgIHNpemVfdCBjb3VudCwKIAkJCQkgIHNpemVfdCAqb2Zmc2V0KQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHN0cmVhbS0+ZGV2X3ByaXY7Ci0JaW50IHJl
cG9ydF9zaXplID0gZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLmZvcm1hdF9zaXplOwotCXU4
ICpvYV9idWZfYmFzZSA9IGRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci52YWRkcjsKLQl1MzIg
Z3R0X29mZnNldCA9IGk5MTVfZ2d0dF9vZmZzZXQoZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVy
LnZtYSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmk5MTU7CisJ
aW50IHJlcG9ydF9zaXplID0gaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIuZm9ybWF0X3NpemU7CisJ
dTggKm9hX2J1Zl9iYXNlID0gaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIudmFkZHI7CisJdTMyIGd0
dF9vZmZzZXQgPSBpOTE1X2dndHRfb2Zmc2V0KGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZtYSk7
CiAJdTMyIG1hc2sgPSAoT0FfQlVGRkVSX1NJWkUgLSAxKTsKIAlzaXplX3Qgc3RhcnRfb2Zmc2V0
ID0gKm9mZnNldDsKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwpAQCAtOTU1LDEzICs5NTUsMTMgQEAg
c3RhdGljIGludCBnZW43X2FwcGVuZF9vYV9yZXBvcnRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0sCiAJaWYgKFdBUk5fT04oIXN0cmVhbS0+ZW5hYmxlZCkpCiAJCXJldHVybiAtRUlP
OwogCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJf
bG9jaywgZmxhZ3MpOworCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5wZXJmLm9hLm9hX2J1ZmZl
ci5wdHJfbG9jaywgZmxhZ3MpOwogCi0JaGVhZCA9IGRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZl
ci5oZWFkOwotCWFnZWRfdGFpbF9pZHggPSBkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIuYWdl
ZF90YWlsX2lkeDsKLQl0YWlsID0gZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnRhaWxzW2Fn
ZWRfdGFpbF9pZHhdLm9mZnNldDsKKwloZWFkID0gaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIuaGVh
ZDsKKwlhZ2VkX3RhaWxfaWR4ID0gaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIuYWdlZF90YWlsX2lk
eDsKKwl0YWlsID0gaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIudGFpbHNbYWdlZF90YWlsX2lkeF0u
b2Zmc2V0OwogCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnBlcmYub2Eub2Ff
YnVmZmVyLnB0cl9sb2NrLCBmbGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+
cGVyZi5vYS5vYV9idWZmZXIucHRyX2xvY2ssIGZsYWdzKTsKIAogCS8qIEFuIGludmFsaWQgdGFp
bCBwb2ludGVyIGhlcmUgbWVhbnMgd2UncmUgc3RpbGwgd2FpdGluZyBmb3IgdGhlIHBvbGwKIAkg
KiBocnRpbWVyIGNhbGxiYWNrIHRvIGdpdmUgdXMgYSBwb2ludGVyCkBAIC0xMDE0LDcgKzEwMTQs
NyBAQCBzdGF0aWMgaW50IGdlbjdfYXBwZW5kX29hX3JlcG9ydHMoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSwKIAkJICogY29weWluZyBpdCB0byB1c2Vyc3BhY2UuLi4KIAkJICovCiAJ
CWlmIChyZXBvcnQzMlswXSA9PSAwKSB7Ci0JCQlpZiAoX19yYXRlbGltaXQoJmRldl9wcml2LT5w
ZXJmLm9hLnNwdXJpb3VzX3JlcG9ydF9ycykpCisJCQlpZiAoX19yYXRlbGltaXQoJmk5MTUtPnBl
cmYub2Euc3B1cmlvdXNfcmVwb3J0X3JzKSkKIAkJCQlEUk1fTk9URSgiU2tpcHBpbmcgc3B1cmlv
dXMsIGludmFsaWQgT0EgcmVwb3J0XG4iKTsKIAkJCWNvbnRpbnVlOwogCQl9CkBAIC0xMDMzLDcg
KzEwMzMsNyBAQCBzdGF0aWMgaW50IGdlbjdfYXBwZW5kX29hX3JlcG9ydHMoc3RydWN0IGk5MTVf
cGVyZl9zdHJlYW0gKnN0cmVhbSwKIAl9CiAKIAlpZiAoc3RhcnRfb2Zmc2V0ICE9ICpvZmZzZXQp
IHsKLQkJc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJf
bG9jaywgZmxhZ3MpOworCQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+cGVyZi5vYS5vYV9idWZm
ZXIucHRyX2xvY2ssIGZsYWdzKTsKIAogCQkvKiBXZSByZW1vdmVkIHRoZSBndHRfb2Zmc2V0IGZv
ciB0aGUgY29weSBsb29wIGFib3ZlLCBpbmRleGluZwogCQkgKiByZWxhdGl2ZSB0byBvYV9idWZf
YmFzZSBzbyBwdXQgYmFjayBoZXJlLi4uCkBAIC0xMDQzLDkgKzEwNDMsOSBAQCBzdGF0aWMgaW50
IGdlbjdfYXBwZW5kX29hX3JlcG9ydHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwK
IAkJSTkxNV9XUklURShHRU43X09BU1RBVFVTMiwKIAkJCSAgICgoaGVhZCAmIEdFTjdfT0FTVEFU
VVMyX0hFQURfTUFTSykgfAogCQkJICAgIEdFTjdfT0FTVEFUVVMyX01FTV9TRUxFQ1RfR0dUVCkp
OwotCQlkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIuaGVhZCA9IGhlYWQ7CisJCWk5MTUtPnBl
cmYub2Eub2FfYnVmZmVyLmhlYWQgPSBoZWFkOwogCi0JCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
JmRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jaywgZmxhZ3MpOworCQlzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jaywgZmxhZ3Mp
OwogCX0KIAogCXJldHVybiByZXQ7CkBAIC0xMDcyLDExICsxMDcyLDExIEBAIHN0YXRpYyBpbnQg
Z2VuN19vYV9yZWFkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCQlzaXplX3Qg
Y291bnQsCiAJCQlzaXplX3QgKm9mZnNldCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gc3RyZWFtLT5pOTE1OwogCXUzMiBvYXN0YXR1czE7CiAJaW50IHJldDsKIAotCWlmIChX
QVJOX09OKCFkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudmFkZHIpKQorCWlmIChXQVJOX09O
KCFpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci52YWRkcikpCiAJCXJldHVybiAtRUlPOwogCiAJb2Fz
dGF0dXMxID0gSTkxNV9SRUFEKEdFTjdfT0FTVEFUVVMxKTsKQEAgLTEwODYsNyArMTA4Niw3IEBA
IHN0YXRpYyBpbnQgZ2VuN19vYV9yZWFkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0s
CiAJICogbWF5IGJlIHVwZGF0ZWQgYXN5bmNocm9ub3VzbHkpIHNvIHdlIGlnbm9yZSBzdGF0dXMg
Yml0cwogCSAqIHRoYXQgaGF2ZSBhbHJlYWR5IGJlZW4gcmVwb3J0ZWQgdG8gdXNlcnNwYWNlLgog
CSAqLwotCW9hc3RhdHVzMSAmPSB+ZGV2X3ByaXYtPnBlcmYub2EuZ2VuN19sYXRjaGVkX29hc3Rh
dHVzMTsKKwlvYXN0YXR1czEgJj0gfmk5MTUtPnBlcmYub2EuZ2VuN19sYXRjaGVkX29hc3RhdHVz
MTsKIAogCS8qIFdlIHRyZWF0IE9BQlVGRkVSX09WRVJGTE9XIGFzIGEgc2lnbmlmaWNhbnQgZXJy
b3I6CiAJICoKQEAgLTExMTUsMTAgKzExMTUsMTAgQEAgc3RhdGljIGludCBnZW43X29hX3JlYWQo
c3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJCXJldHVybiByZXQ7CiAKIAkJRFJN
X0RFQlVHKCJPQSBidWZmZXIgb3ZlcmZsb3cgKGV4cG9uZW50ID0gJWQpOiBmb3JjZSByZXN0YXJ0
XG4iLAotCQkJICBkZXZfcHJpdi0+cGVyZi5vYS5wZXJpb2RfZXhwb25lbnQpOworCQkJICBpOTE1
LT5wZXJmLm9hLnBlcmlvZF9leHBvbmVudCk7CiAKLQkJZGV2X3ByaXYtPnBlcmYub2Eub3BzLm9h
X2Rpc2FibGUoc3RyZWFtKTsKLQkJZGV2X3ByaXYtPnBlcmYub2Eub3BzLm9hX2VuYWJsZShzdHJl
YW0pOworCQlpOTE1LT5wZXJmLm9hLm9wcy5vYV9kaXNhYmxlKHN0cmVhbSk7CisJCWk5MTUtPnBl
cmYub2Eub3BzLm9hX2VuYWJsZShzdHJlYW0pOwogCiAJCW9hc3RhdHVzMSA9IEk5MTVfUkVBRChH
RU43X09BU1RBVFVTMSk7CiAJfQpAQCAtMTEyOCw3ICsxMTI4LDcgQEAgc3RhdGljIGludCBnZW43
X29hX3JlYWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJCQkgICAgICAgRFJN
X0k5MTVfUEVSRl9SRUNPUkRfT0FfUkVQT1JUX0xPU1QpOwogCQlpZiAocmV0KQogCQkJcmV0dXJu
IHJldDsKLQkJZGV2X3ByaXYtPnBlcmYub2EuZ2VuN19sYXRjaGVkX29hc3RhdHVzMSB8PQorCQlp
OTE1LT5wZXJmLm9hLmdlbjdfbGF0Y2hlZF9vYXN0YXR1czEgfD0KIAkJCUdFTjdfT0FTVEFUVVMx
X1JFUE9SVF9MT1NUOwogCX0KIApAQCAtMTE1MSwxNCArMTE1MSwxNCBAQCBzdGF0aWMgaW50IGdl
bjdfb2FfcmVhZChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogICovCiBzdGF0aWMg
aW50IGk5MTVfb2Ffd2FpdF91bmxvY2tlZChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFt
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHN0cmVhbS0+ZGV2X3By
aXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmk5MTU7CiAKIAkv
KiBXZSB3b3VsZCB3YWl0IGluZGVmaW5pdGVseSBpZiBwZXJpb2RpYyBzYW1wbGluZyBpcyBub3Qg
ZW5hYmxlZCAqLwotCWlmICghZGV2X3ByaXYtPnBlcmYub2EucGVyaW9kaWMpCisJaWYgKCFpOTE1
LT5wZXJmLm9hLnBlcmlvZGljKQogCQlyZXR1cm4gLUVJTzsKIAotCXJldHVybiB3YWl0X2V2ZW50
X2ludGVycnVwdGlibGUoZGV2X3ByaXYtPnBlcmYub2EucG9sbF93cSwKLQkJCQkJb2FfYnVmZmVy
X2NoZWNrX3VubG9ja2VkKGRldl9wcml2KSk7CisJcmV0dXJuIHdhaXRfZXZlbnRfaW50ZXJydXB0
aWJsZShpOTE1LT5wZXJmLm9hLnBvbGxfd3EsCisJCQkJCW9hX2J1ZmZlcl9jaGVja191bmxvY2tl
ZChpOTE1KSk7CiB9CiAKIC8qKgpAQCAtMTE3NSw5ICsxMTc1LDkgQEAgc3RhdGljIHZvaWQgaTkx
NV9vYV9wb2xsX3dhaXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJCSAgICAg
IHN0cnVjdCBmaWxlICpmaWxlLAogCQkJICAgICAgcG9sbF90YWJsZSAqd2FpdCkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5pOTE1OwogCi0JcG9sbF93YWl0KGZp
bGUsICZkZXZfcHJpdi0+cGVyZi5vYS5wb2xsX3dxLCB3YWl0KTsKKwlwb2xsX3dhaXQoZmlsZSwg
Jmk5MTUtPnBlcmYub2EucG9sbF93cSwgd2FpdCk7CiB9CiAKIC8qKgpAQCAtMTE5Nyw5ICsxMTk3
LDkgQEAgc3RhdGljIGludCBpOTE1X29hX3JlYWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0
cmVhbSwKIAkJCXNpemVfdCBjb3VudCwKIAkJCXNpemVfdCAqb2Zmc2V0KQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHN0cmVhbS0+ZGV2X3ByaXY7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmk5MTU7CiAKLQlyZXR1cm4gZGV2X3ByaXYt
PnBlcmYub2Eub3BzLnJlYWQoc3RyZWFtLCBidWYsIGNvdW50LCBvZmZzZXQpOworCXJldHVybiBp
OTE1LT5wZXJmLm9hLm9wcy5yZWFkKHN0cmVhbSwgYnVmLCBjb3VudCwgb2Zmc2V0KTsKIH0KIAog
c3RhdGljIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpvYV9waW5fY29udGV4dChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKQEAgLTEyNDgsNyArMTI0OCw3IEBAIHN0YXRpYyBzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqb2FfcGluX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAgKi8KIHN0YXRpYyBpbnQgb2FfZ2V0X3JlbmRlcl9jdHhfaWQoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVh
bS0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmk5
MTU7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCiAJY2UgPSBvYV9waW5fY29udGV4dChp
OTE1LCBzdHJlYW0tPmN0eCk7CkBAIC0xMzMwLDE3ICsxMzMwLDE3IEBAIHN0YXRpYyBpbnQgb2Ff
Z2V0X3JlbmRlcl9jdHhfaWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKICAqLwog
c3RhdGljIHZvaWQgb2FfcHV0X3JlbmRlcl9jdHhfaWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0t
PmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5pOTE1
OwogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAotCWRldl9wcml2LT5wZXJmLm9hLnNwZWNp
ZmljX2N0eF9pZCA9IElOVkFMSURfQ1RYX0lEOwotCWRldl9wcml2LT5wZXJmLm9hLnNwZWNpZmlj
X2N0eF9pZF9tYXNrID0gMDsKKwlpOTE1LT5wZXJmLm9hLnNwZWNpZmljX2N0eF9pZCA9IElOVkFM
SURfQ1RYX0lEOworCWk5MTUtPnBlcmYub2Euc3BlY2lmaWNfY3R4X2lkX21hc2sgPSAwOwogCi0J
Y2UgPSBmZXRjaF9hbmRfemVybygmZGV2X3ByaXYtPnBlcmYub2EucGlubmVkX2N0eCk7CisJY2Ug
PSBmZXRjaF9hbmRfemVybygmaTkxNS0+cGVyZi5vYS5waW5uZWRfY3R4KTsKIAlpZiAoY2UpIHsK
LQkJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaW50ZWxfY29udGV4dF91bnBpbihjZSk7Ci0J
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCX0KIH0KIApAQCAtMTM1OSw2NCArMTM1OSw2
NCBAQCBmcmVlX29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogc3Rh
dGljIHZvaWQgaTkxNV9vYV9zdHJlYW1fZGVzdHJveShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAq
c3RyZWFtKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHN0cmVhbS0+
ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmk5MTU7
CiAKLQlCVUdfT04oc3RyZWFtICE9IGRldl9wcml2LT5wZXJmLm9hLmV4Y2x1c2l2ZV9zdHJlYW0p
OworCUJVR19PTihzdHJlYW0gIT0gaTkxNS0+cGVyZi5vYS5leGNsdXNpdmVfc3RyZWFtKTsKIAog
CS8qCiAJICogVW5zZXQgZXhjbHVzaXZlX3N0cmVhbSBmaXJzdCwgaXQgd2lsbCBiZSBjaGVja2Vk
IHdoaWxlIGRpc2FibGluZwogCSAqIHRoZSBtZXRyaWMgc2V0IG9uIGdlbjgrLgogCSAqLwotCW11
dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlkZXZfcHJpdi0+cGVyZi5v
YS5leGNsdXNpdmVfc3RyZWFtID0gTlVMTDsKLQlkZXZfcHJpdi0+cGVyZi5vYS5vcHMuZGlzYWJs
ZV9tZXRyaWNfc2V0KGRldl9wcml2KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpOTE1
LT5wZXJmLm9hLmV4Y2x1c2l2ZV9zdHJlYW0gPSBOVUxMOworCWk5MTUtPnBlcmYub2Eub3BzLmRp
c2FibGVfbWV0cmljX3NldChpOTE1KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCi0JZnJlZV9vYV9idWZmZXIoZGV2X3ByaXYpOworCWZyZWVfb2FfYnVmZmVyKGk5
MTUpOwogCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZP
UkNFV0FLRV9BTEwpOwotCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCBzdHJlYW0tPndh
a2VyZWYpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNF
V0FLRV9BTEwpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHN0cmVhbS0+d2FrZXJlZik7
CiAKIAlpZiAoc3RyZWFtLT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cmVhbSk7CiAK
LQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJcHV0X29hX2Nv
bmZpZyhpOTE1LCBzdHJlYW0tPm9hX2NvbmZpZyk7CiAKLQlpZiAoZGV2X3ByaXYtPnBlcmYub2Eu
c3B1cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgeworCWlmIChpOTE1LT5wZXJmLm9hLnNwdXJpb3Vz
X3JlcG9ydF9ycy5taXNzZWQpIHsKIAkJRFJNX05PVEUoIiVkIHNwdXJpb3VzIE9BIHJlcG9ydCBu
b3RpY2VzIHN1cHByZXNzZWQgZHVlIHRvIHJhdGVsaW1pdGluZ1xuIiwKLQkJCSBkZXZfcHJpdi0+
cGVyZi5vYS5zcHVyaW91c19yZXBvcnRfcnMubWlzc2VkKTsKKwkJCSBpOTE1LT5wZXJmLm9hLnNw
dXJpb3VzX3JlcG9ydF9ycy5taXNzZWQpOwogCX0KIH0KIAotc3RhdGljIHZvaWQgZ2VuN19pbml0
X29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCBnZW43X2luaXRfb2FfYnVmZmVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXUzMiBndHRfb2Zmc2V0ID0gaTkxNV9nZ3R0X29mZnNldChkZXZfcHJpdi0+cGVyZi5vYS5vYV9i
dWZmZXIudm1hKTsKKwl1MzIgZ3R0X29mZnNldCA9IGk5MTVfZ2d0dF9vZmZzZXQoaTkxNS0+cGVy
Zi5vYS5vYV9idWZmZXIudm1hKTsKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0Jc3Bpbl9sb2Nr
X2lycXNhdmUoJmRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jaywgZmxhZ3MpOwor
CXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jaywgZmxh
Z3MpOwogCiAJLyogUHJlLURldkJEVzogT0FCVUZGRVIgbXVzdCBiZSBzZXQgd2l0aCBjb3VudGVy
cyBvZmYsCiAJICogYmVmb3JlIE9BU1RBVFVTMSwgYnV0IGFmdGVyIE9BU1RBVFVTMgogCSAqLwog
CUk5MTVfV1JJVEUoR0VON19PQVNUQVRVUzIsCiAJCSAgIGd0dF9vZmZzZXQgfCBHRU43X09BU1RB
VFVTMl9NRU1fU0VMRUNUX0dHVFQpOyAvKiBoZWFkICovCi0JZGV2X3ByaXYtPnBlcmYub2Eub2Ff
YnVmZmVyLmhlYWQgPSBndHRfb2Zmc2V0OworCWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmhlYWQg
PSBndHRfb2Zmc2V0OwogCiAJSTkxNV9XUklURShHRU43X09BQlVGRkVSLCBndHRfb2Zmc2V0KTsK
IAogCUk5MTVfV1JJVEUoR0VON19PQVNUQVRVUzEsIGd0dF9vZmZzZXQgfCBPQUJVRkZFUl9TSVpF
XzE2TSk7IC8qIHRhaWwgKi8KIAogCS8qIE1hcmsgdGhhdCB3ZSBuZWVkIHVwZGF0ZWQgdGFpbCBw
b2ludGVycyB0byByZWFkIGZyb20uLi4gKi8KLQlkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIu
dGFpbHNbMF0ub2Zmc2V0ID0gSU5WQUxJRF9UQUlMX1BUUjsKLQlkZXZfcHJpdi0+cGVyZi5vYS5v
YV9idWZmZXIudGFpbHNbMV0ub2Zmc2V0ID0gSU5WQUxJRF9UQUlMX1BUUjsKKwlpOTE1LT5wZXJm
Lm9hLm9hX2J1ZmZlci50YWlsc1swXS5vZmZzZXQgPSBJTlZBTElEX1RBSUxfUFRSOworCWk5MTUt
PnBlcmYub2Eub2FfYnVmZmVyLnRhaWxzWzFdLm9mZnNldCA9IElOVkFMSURfVEFJTF9QVFI7CiAK
LQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIucHRy
X2xvY2ssIGZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5wZXJmLm9hLm9h
X2J1ZmZlci5wdHJfbG9jaywgZmxhZ3MpOwogCiAJLyogT24gSGFzd2VsbCB3ZSBoYXZlIHRvIHRy
YWNrIHdoaWNoIE9BU1RBVFVTMSBmbGFncyB3ZSd2ZQogCSAqIGFscmVhZHkgc2VlbiBzaW5jZSB0
aGV5IGNhbid0IGJlIGNsZWFyZWQgd2hpbGUgcGVyaW9kaWMKIAkgKiBzYW1wbGluZyBpcyBlbmFi
bGVkLgogCSAqLwotCWRldl9wcml2LT5wZXJmLm9hLmdlbjdfbGF0Y2hlZF9vYXN0YXR1czEgPSAw
OworCWk5MTUtPnBlcmYub2EuZ2VuN19sYXRjaGVkX29hc3RhdHVzMSA9IDA7CiAKIAkvKiBOQjog
YWx0aG91Z2ggdGhlIE9BIGJ1ZmZlciB3aWxsIGluaXRpYWxseSBiZSBhbGxvY2F0ZWQKIAkgKiB6
ZXJvZWQgdmlhIHNobWZzIChhbmQgc28gdGhpcyBtZW1zZXQgaXMgcmVkdW5kYW50IHdoZW4KQEAg
LTE0MjksMjQgKzE0MjksMjQgQEAgc3RhdGljIHZvaWQgZ2VuN19pbml0X29hX2J1ZmZlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogdGhlIGFzc3VtcHRpb24gdGhhdCBu
ZXcgcmVwb3J0cyBhcmUgYmVpbmcgd3JpdHRlbiB0byB6ZXJvZWQKIAkgKiBtZW1vcnkuLi4KIAkg
Ki8KLQltZW1zZXQoZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyLCAwLCBPQV9CVUZG
RVJfU0laRSk7CisJbWVtc2V0KGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyLCAwLCBPQV9C
VUZGRVJfU0laRSk7CiAKIAkvKiBNYXliZSBtYWtlIC0+cG9sbGluIHBlci1zdHJlYW0gc3RhdGUg
aWYgd2Ugc3VwcG9ydCBtdWx0aXBsZQogCSAqIGNvbmN1cnJlbnQgc3RyZWFtcyBpbiB0aGUgZnV0
dXJlLgogCSAqLwotCWRldl9wcml2LT5wZXJmLm9hLnBvbGxpbiA9IGZhbHNlOworCWk5MTUtPnBl
cmYub2EucG9sbGluID0gZmFsc2U7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjhfaW5pdF9vYV9idWZm
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuOF9p
bml0X29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQl1MzIgZ3R0
X29mZnNldCA9IGk5MTVfZ2d0dF9vZmZzZXQoZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZt
YSk7CisJdTMyIGd0dF9vZmZzZXQgPSBpOTE1X2dndHRfb2Zmc2V0KGk5MTUtPnBlcmYub2Eub2Ff
YnVmZmVyLnZtYSk7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAotCXNwaW5fbG9ja19pcnFzYXZl
KCZkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIucHRyX2xvY2ssIGZsYWdzKTsKKwlzcGluX2xv
Y2tfaXJxc2F2ZSgmaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIucHRyX2xvY2ssIGZsYWdzKTsKIAog
CUk5MTVfV1JJVEUoR0VOOF9PQVNUQVRVUywgMCk7CiAJSTkxNV9XUklURShHRU44X09BSEVBRFBU
UiwgZ3R0X29mZnNldCk7Ci0JZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLmhlYWQgPSBndHRf
b2Zmc2V0OworCWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmhlYWQgPSBndHRfb2Zmc2V0OwogCiAJ
STkxNV9XUklURShHRU44X09BQlVGRkVSX1VEVywgMCk7CiAKQEAgLTE0NjMsMTcgKzE0NjMsMTcg
QEAgc3RhdGljIHZvaWQgZ2VuOF9pbml0X29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShHRU44X09BVEFJTFBUUiwgZ3R0X29mZnNldCAmIEdF
TjhfT0FUQUlMUFRSX01BU0spOwogCiAJLyogTWFyayB0aGF0IHdlIG5lZWQgdXBkYXRlZCB0YWls
IHBvaW50ZXJzIHRvIHJlYWQgZnJvbS4uLiAqLwotCWRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZl
ci50YWlsc1swXS5vZmZzZXQgPSBJTlZBTElEX1RBSUxfUFRSOwotCWRldl9wcml2LT5wZXJmLm9h
Lm9hX2J1ZmZlci50YWlsc1sxXS5vZmZzZXQgPSBJTlZBTElEX1RBSUxfUFRSOworCWk5MTUtPnBl
cmYub2Eub2FfYnVmZmVyLnRhaWxzWzBdLm9mZnNldCA9IElOVkFMSURfVEFJTF9QVFI7CisJaTkx
NS0+cGVyZi5vYS5vYV9idWZmZXIudGFpbHNbMV0ub2Zmc2V0ID0gSU5WQUxJRF9UQUlMX1BUUjsK
IAogCS8qCiAJICogUmVzZXQgc3RhdGUgdXNlZCB0byByZWNvZ25pc2UgY29udGV4dCBzd2l0Y2hl
cywgYWZmZWN0aW5nIHdoaWNoCiAJICogcmVwb3J0cyB3ZSB3aWxsIGZvcndhcmQgdG8gdXNlcnNw
YWNlIHdoaWxlIGZpbHRlcmluZyBmb3IgYSBzaW5nbGUKIAkgKiBjb250ZXh0LgogCSAqLwotCWRl
dl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5sYXN0X2N0eF9pZCA9IElOVkFMSURfQ1RYX0lEOwor
CWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmxhc3RfY3R4X2lkID0gSU5WQUxJRF9DVFhfSUQ7CiAK
LQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIucHRy
X2xvY2ssIGZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5wZXJmLm9hLm9h
X2J1ZmZlci5wdHJfbG9jaywgZmxhZ3MpOwogCiAJLyoKIAkgKiBOQjogYWx0aG91Z2ggdGhlIE9B
IGJ1ZmZlciB3aWxsIGluaXRpYWxseSBiZSBhbGxvY2F0ZWQKQEAgLTE0ODcsMzIgKzE0ODcsMzIg
QEAgc3RhdGljIHZvaWQgZ2VuOF9pbml0X29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJICogdGhlIGFzc3VtcHRpb24gdGhhdCBuZXcgcmVwb3J0cyBhcmUgYmVp
bmcgd3JpdHRlbiB0byB6ZXJvZWQKIAkgKiBtZW1vcnkuLi4KIAkgKi8KLQltZW1zZXQoZGV2X3By
aXYtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyLCAwLCBPQV9CVUZGRVJfU0laRSk7CisJbWVtc2V0
KGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyLCAwLCBPQV9CVUZGRVJfU0laRSk7CiAKIAkv
KgogCSAqIE1heWJlIG1ha2UgLT5wb2xsaW4gcGVyLXN0cmVhbSBzdGF0ZSBpZiB3ZSBzdXBwb3J0
IG11bHRpcGxlCiAJICogY29uY3VycmVudCBzdHJlYW1zIGluIHRoZSBmdXR1cmUuCiAJICovCi0J
ZGV2X3ByaXYtPnBlcmYub2EucG9sbGluID0gZmFsc2U7CisJaTkxNS0+cGVyZi5vYS5wb2xsaW4g
PSBmYWxzZTsKIH0KIAotc3RhdGljIGludCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmJv
OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCByZXQ7CiAKLQlpZiAoV0FSTl9PTihkZXZf
cHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudm1hKSkKKwlpZiAoV0FSTl9PTihpOTE1LT5wZXJmLm9h
Lm9hX2J1ZmZlci52bWEpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXJldCA9IGk5MTVfbXV0ZXhf
bG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+ZHJtKTsKKwlyZXQgPSBpOTE1X211dGV4X2xv
Y2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
CiAJQlVJTERfQlVHX09OX05PVF9QT1dFUl9PRl8yKE9BX0JVRkZFUl9TSVpFKTsKIAlCVUlMRF9C
VUdfT04oT0FfQlVGRkVSX1NJWkUgPCBTWl8xMjhLIHx8IE9BX0JVRkZFUl9TSVpFID4gU1pfMTZN
KTsKIAotCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZfcHJpdiwgT0FfQlVG
RkVSX1NJWkUpOworCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBPQV9C
VUZGRVJfU0laRSk7CiAJaWYgKElTX0VSUihibykpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8g
YWxsb2NhdGUgT0EgYnVmZmVyXG4iKTsKIAkJcmV0ID0gUFRSX0VSUihibyk7CkBAIC0xNTI3LDE4
ICsxNTI3LDE4IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAkJcmV0ID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycl91bnJl
ZjsKIAl9Ci0JZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZtYSA9IHZtYTsKKwlpOTE1LT5w
ZXJmLm9hLm9hX2J1ZmZlci52bWEgPSB2bWE7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZm
ZXIudmFkZHIgPQorCWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyID0KIAkJaTkxNV9nZW1f
b2JqZWN0X3Bpbl9tYXAoYm8sIEk5MTVfTUFQX1dCKTsKLQlpZiAoSVNfRVJSKGRldl9wcml2LT5w
ZXJmLm9hLm9hX2J1ZmZlci52YWRkcikpIHsKLQkJcmV0ID0gUFRSX0VSUihkZXZfcHJpdi0+cGVy
Zi5vYS5vYV9idWZmZXIudmFkZHIpOworCWlmIChJU19FUlIoaTkxNS0+cGVyZi5vYS5vYV9idWZm
ZXIudmFkZHIpKSB7CisJCXJldCA9IFBUUl9FUlIoaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIudmFk
ZHIpOwogCQlnb3RvIGVycl91bnBpbjsKIAl9CiAKIAlEUk1fREVCVUdfRFJJVkVSKCJPQSBCdWZm
ZXIgaW5pdGlhbGl6ZWQsIGd0dCBvZmZzZXQgPSAweCV4LCB2YWRkciA9ICVwXG4iLAotCQkJIGk5
MTVfZ2d0dF9vZmZzZXQoZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZtYSksCi0JCQkgZGV2
X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyKTsKKwkJCSBpOTE1X2dndHRfb2Zmc2V0KGk5
MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZtYSksCisJCQkgaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIu
dmFkZHIpOwogCiAJZ290byB1bmxvY2s7CiAKQEAgLTE1NDgsMTUgKzE1NDgsMTUgQEAgc3RhdGlj
IGludCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
ZXJyX3VucmVmOgogCWk5MTVfZ2VtX29iamVjdF9wdXQoYm8pOwogCi0JZGV2X3ByaXYtPnBlcmYu
b2Eub2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKLQlkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIu
dm1hID0gTlVMTDsKKwlpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci52YWRkciA9IE5VTEw7CisJaTkx
NS0+cGVyZi5vYS5vYV9idWZmZXIudm1hID0gTlVMTDsKIAogdW5sb2NrOgotCW11dGV4X3VubG9j
aygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgY29uZmlnX29h
X3JlZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgY29u
ZmlnX29hX3JlZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBjb25zdCBz
dHJ1Y3QgaTkxNV9vYV9yZWcgKnJlZ3MsCiAJCQkgICB1MzIgbl9yZWdzKQogewpAQCAtMTU3MSw3
ICsxNTcxLDcgQEAgc3RhdGljIHZvaWQgY29uZmlnX29hX3JlZ3Moc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgaW50IGhzd19lbmFibGVfbWV0cmljX3NldChzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHN0cmVhbS0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSBzdHJlYW0tPmk5MTU7CiAJY29uc3Qgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9j
b25maWcgPSBzdHJlYW0tPm9hX2NvbmZpZzsKIAogCS8qIFBSTToKQEAgLTE1ODgsNyArMTU4OCw3
IEBAIHN0YXRpYyBpbnQgaHN3X2VuYWJsZV9tZXRyaWNfc2V0KHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiAJSTkxNV9XUklURShHRU42X1VDR0NUTDEsIChJOTE1X1JFQUQoR0VONl9V
Q0dDVEwxKSB8CiAJCQkJICBHRU42X0NTVU5JVF9DTE9DS19HQVRFX0RJU0FCTEUpKTsKIAotCWNv
bmZpZ19vYV9yZWdzKGRldl9wcml2LCBvYV9jb25maWctPm11eF9yZWdzLCBvYV9jb25maWctPm11
eF9yZWdzX2xlbik7CisJY29uZmlnX29hX3JlZ3MoaTkxNSwgb2FfY29uZmlnLT5tdXhfcmVncywg
b2FfY29uZmlnLT5tdXhfcmVnc19sZW4pOwogCiAJLyogSXQgYXBwYXJlbnRseSB0YWtlcyBhIGZh
aXJseSBsb25nIHRpbWUgZm9yIGEgbmV3IE1VWAogCSAqIGNvbmZpZ3VyYXRpb24gdG8gYmUgYmUg
YXBwbGllZCBhZnRlciB0aGVzZSByZWdpc3RlciB3cml0ZXMuCkBAIC0xNjEzLDEzICsxNjEzLDEz
IEBAIHN0YXRpYyBpbnQgaHN3X2VuYWJsZV9tZXRyaWNfc2V0KHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiAJICovCiAJdXNsZWVwX3JhbmdlKDE1MDAwLCAyMDAwMCk7CiAKLQljb25m
aWdfb2FfcmVncyhkZXZfcHJpdiwgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKKwljb25maWdf
b2FfcmVncyhpOTE1LCBvYV9jb25maWctPmJfY291bnRlcl9yZWdzLAogCQkgICAgICAgb2FfY29u
ZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lk
IGhzd19kaXNhYmxlX21ldHJpY19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgaHN3X2Rpc2FibGVfbWV0cmljX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKIAlJOTE1X1dSSVRFKEdFTjZfVUNHQ1RMMSwgKEk5MTVfUkVBRChHRU42
X1VDR0NUTDEpICYKIAkJCQkgIH5HRU42X0NTVU5JVF9DTE9DS19HQVRFX0RJU0FCTEUpKTsKQEAg
LTE3MTYsMTUgKzE3MTYsMTUgQEAgZ2VuOF91cGRhdGVfcmVnX3N0YXRlX3VubG9ja2VkKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSwKICAqCiAgKiBOb3RlOiBpdCdzIG9ubHkgdGhlIFJDUy9SZW5k
ZXIgY29udGV4dCB0aGF0IGhhcyBhbnkgT0Egc3RhdGUuCiAgKi8KLXN0YXRpYyBpbnQgZ2VuOF9j
b25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyBpbnQgZ2VuOF9jb25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9h
X2NvbmZpZykKIHsKLQl1bnNpZ25lZCBpbnQgbWFwX3R5cGUgPSBpOTE1X2NvaGVyZW50X21hcF90
eXBlKGRldl9wcml2KTsKKwl1bnNpZ25lZCBpbnQgbWFwX3R5cGUgPSBpOTE1X2NvaGVyZW50X21h
cF90eXBlKGk5MTUpOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9w
cml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAogCS8qCiAJICogVGhlIE9BIHJlZ2lzdGVyIGNvbmZpZyBpcyBzZXR1
cCB0aHJvdWdoIHRoZSBjb250ZXh0IGltYWdlLiBUaGlzIGltYWdlCkBAIC0xNzM5LDE0ICsxNzM5
LDE0IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiBTbyBmYXIgdGhlIGJlc3Qgd2F5IHRvIHdvcmsg
YXJvdW5kIHRoaXMgaXNzdWUgc2VlbXMgdG8gYmUgZHJhaW5pbmcKIAkgKiB0aGUgR1BVIGZyb20g
YW55IHN1Ym1pdHRlZCB3b3JrLgogCSAqLwotCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUo
ZGV2X3ByaXYsCisJcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAogCQkJCSAgICAg
STkxNV9XQUlUX0xPQ0tFRCwKIAkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAlpZiAo
cmV0KQogCQlyZXR1cm4gcmV0OwogCiAJLyogVXBkYXRlIGFsbCBjb250ZXh0cyBub3cgdGhhdCB3
ZSd2ZSBzdGFsbGVkIHRoZSBzdWJtaXNzaW9uLiAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4
LCAmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QsIGxpbmspIHsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5
KGN0eCwgJmk5MTUtPmNvbnRleHRzLmxpc3QsIGxpbmspIHsKIAkJc3RydWN0IGk5MTVfZ2VtX2Vu
Z2luZXNfaXRlciBpdDsKIAkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCkBAIC0xNzgzLDcg
KzE3ODMsNyBAQCBzdGF0aWMgaW50IGdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogQXBwbHkgdGhlIGNvbmZpZ3VyYXRpb24g
YnkgZG9pbmcgb25lIGNvbnRleHQgcmVzdG9yZSBvZiB0aGUgZWRpdGVkCiAJICogY29udGV4dCBp
bWFnZS4KIAkgKi8KLQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoZGV2X3ByaXYtPmVuZ2luZVtS
Q1MwXS0+a2VybmVsX2NvbnRleHQpOworCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShpOTE1LT5l
bmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0KTsKIAlpZiAoSVNfRVJSKHJxKSkKIAkJcmV0dXJu
IFBUUl9FUlIocnEpOwogCkBAIC0xNzk0LDcgKzE3OTQsNyBAQCBzdGF0aWMgaW50IGdlbjhfY29u
ZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAK
IHN0YXRpYyBpbnQgZ2VuOF9lbmFibGVfbWV0cmljX3NldChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHN0cmVh
bS0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmk5
MTU7CiAJY29uc3Qgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcgPSBzdHJlYW0tPm9h
X2NvbmZpZzsKIAlpbnQgcmV0OwogCkBAIC0xODIxLDcgKzE4MjEsNyBAQCBzdGF0aWMgaW50IGdl
bjhfZW5hYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAkg
KiBiZSByZWFkIGJhY2sgZnJvbSBhdXRvbWF0aWNhbGx5IHRyaWdnZXJlZCByZXBvcnRzLCBhcyBw
YXJ0IG9mIHRoZQogCSAqIFJQVF9JRCBmaWVsZC4KIAkgKi8KLQlpZiAoSVNfR0VOX1JBTkdFKGRl
dl9wcml2LCA5LCAxMSkpIHsKKwlpZiAoSVNfR0VOX1JBTkdFKGk5MTUsIDksIDExKSkgewogCQlJ
OTE1X1dSSVRFKEdFTjhfT0FfREVCVUcsCiAJCQkgICBfTUFTS0VEX0JJVF9FTkFCTEUoR0VOOV9P
QV9ERUJVR19ESVNBQkxFX0NMS19SQVRJT19SRVBPUlRTIHwKIAkJCQkJICAgICAgR0VOOV9PQV9E
RUJVR19JTkNMVURFX0NMS19SQVRJTykpOwpAQCAtMTgzMiwzMSArMTgzMiwzMSBAQCBzdGF0aWMg
aW50IGdlbjhfZW5hYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSkKIAkgKiB0byBtYWtlIHN1cmUgYWxsIHNsaWNlcy9zdWJzbGljZXMgYXJlIE9OIGJlZm9yZSB3
cml0aW5nIHRvIE5PQQogCSAqIHJlZ2lzdGVycy4KIAkgKi8KLQlyZXQgPSBnZW44X2NvbmZpZ3Vy
ZV9hbGxfY29udGV4dHMoZGV2X3ByaXYsIG9hX2NvbmZpZyk7CisJcmV0ID0gZ2VuOF9jb25maWd1
cmVfYWxsX2NvbnRleHRzKGk5MTUsIG9hX2NvbmZpZyk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJl
dDsKIAotCWNvbmZpZ19vYV9yZWdzKGRldl9wcml2LCBvYV9jb25maWctPm11eF9yZWdzLCBvYV9j
b25maWctPm11eF9yZWdzX2xlbik7CisJY29uZmlnX29hX3JlZ3MoaTkxNSwgb2FfY29uZmlnLT5t
dXhfcmVncywgb2FfY29uZmlnLT5tdXhfcmVnc19sZW4pOwogCi0JY29uZmlnX29hX3JlZ3MoZGV2
X3ByaXYsIG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3MsCisJY29uZmlnX29hX3JlZ3MoaTkxNSwg
b2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKIAkJICAgICAgIG9hX2NvbmZpZy0+Yl9jb3VudGVy
X3JlZ3NfbGVuKTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBnZW44X2Rpc2FibGVf
bWV0cmljX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCBnZW44X2Rpc2FibGVfbWV0cmljX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAkvKiBSZXNldCBhbGwgY29udGV4dHMnIHNsaWNlcy9zdWJzbGljZXMgY29uZmlndXJhdGlv
bnMuICovCi0JZ2VuOF9jb25maWd1cmVfYWxsX2NvbnRleHRzKGRldl9wcml2LCBOVUxMKTsKKwln
ZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoaTkxNSwgTlVMTCk7CiAKIAlJOTE1X1dSSVRFKEdE
VF9DSElDS0VOX0JJVFMsIChJOTE1X1JFQUQoR0RUX0NISUNLRU5fQklUUykgJgogCQkJCSAgICAg
IH5HVF9OT0FfRU5BQkxFKSk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjEwX2Rpc2FibGVfbWV0cmlj
X3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW4x
MF9kaXNhYmxlX21ldHJpY19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJ
LyogUmVzZXQgYWxsIGNvbnRleHRzJyBzbGljZXMvc3Vic2xpY2VzIGNvbmZpZ3VyYXRpb25zLiAq
LwotCWdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0cyhkZXZfcHJpdiwgTlVMTCk7CisJZ2VuOF9j
b25maWd1cmVfYWxsX2NvbnRleHRzKGk5MTUsIE5VTEwpOwogCiAJLyogTWFrZSBzdXJlIHdlIGRp
c2FibGUgbm9hIHRvIHNhdmUgcG93ZXIuICovCiAJSTkxNV9XUklURShSUE1fQ09ORklHMSwKQEAg
LTE4NjUsMTIgKzE4NjUsMTIgQEAgc3RhdGljIHZvaWQgZ2VuMTBfZGlzYWJsZV9tZXRyaWNfc2V0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogc3RhdGljIHZvaWQgZ2VuN19v
YV9lbmFibGUoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5pOTE1OwogCXN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHggPSBzdHJlYW0tPmN0eDsKLQl1MzIgY3R4X2lkID0gZGV2X3ByaXYtPnBlcmYub2Eu
c3BlY2lmaWNfY3R4X2lkOwotCWJvb2wgcGVyaW9kaWMgPSBkZXZfcHJpdi0+cGVyZi5vYS5wZXJp
b2RpYzsKLQl1MzIgcGVyaW9kX2V4cG9uZW50ID0gZGV2X3ByaXYtPnBlcmYub2EucGVyaW9kX2V4
cG9uZW50OwotCXUzMiByZXBvcnRfZm9ybWF0ID0gZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVy
LmZvcm1hdDsKKwl1MzIgY3R4X2lkID0gaTkxNS0+cGVyZi5vYS5zcGVjaWZpY19jdHhfaWQ7CisJ
Ym9vbCBwZXJpb2RpYyA9IGk5MTUtPnBlcmYub2EucGVyaW9kaWM7CisJdTMyIHBlcmlvZF9leHBv
bmVudCA9IGk5MTUtPnBlcmYub2EucGVyaW9kX2V4cG9uZW50OworCXUzMiByZXBvcnRfZm9ybWF0
ID0gaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIuZm9ybWF0OwogCiAJLyoKIAkgKiBSZXNldCBidWYg
cG9pbnRlcnMgc28gd2UgZG9uJ3QgZm9yd2FyZCByZXBvcnRzIGZyb20gYmVmb3JlIG5vdy4KQEAg
LTE4ODEsNyArMTg4MSw3IEBAIHN0YXRpYyB2b2lkIGdlbjdfb2FfZW5hYmxlKHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJICogb24gdGhlIGFzc3VtcHRpb24gdGhhdCBjZXJ0YWlu
IGZpZWxkcyBhcmUgd3JpdHRlbiB0byB6ZXJvZWQKIAkgKiBtZW1vcnkgd2hpY2ggdGhpcyBoZWxw
cyBtYWludGFpbnMuCiAJICovCi0JZ2VuN19pbml0X29hX2J1ZmZlcihkZXZfcHJpdik7CisJZ2Vu
N19pbml0X29hX2J1ZmZlcihpOTE1KTsKIAogCUk5MTVfV1JJVEUoR0VON19PQUNPTlRST0wsCiAJ
CSAgIChjdHhfaWQgJiBHRU43X09BQ09OVFJPTF9DVFhfTUFTSykgfApAQCAtMTg5NSw4ICsxODk1
LDggQEAgc3RhdGljIHZvaWQgZ2VuN19vYV9lbmFibGUoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSkKIAogc3RhdGljIHZvaWQgZ2VuOF9vYV9lbmFibGUoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBz
dHJlYW0tPmRldl9wcml2OwotCXUzMiByZXBvcnRfZm9ybWF0ID0gZGV2X3ByaXYtPnBlcmYub2Eu
b2FfYnVmZmVyLmZvcm1hdDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVh
bS0+aTkxNTsKKwl1MzIgcmVwb3J0X2Zvcm1hdCA9IGk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmZv
cm1hdDsKIAogCS8qCiAJICogUmVzZXQgYnVmIHBvaW50ZXJzIHNvIHdlIGRvbid0IGZvcndhcmQg
cmVwb3J0cyBmcm9tIGJlZm9yZSBub3cuCkBAIC0xOTA3LDcgKzE5MDcsNyBAQCBzdGF0aWMgdm9p
ZCBnZW44X29hX2VuYWJsZShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCSAqIG9u
IHRoZSBhc3N1bXB0aW9uIHRoYXQgY2VydGFpbiBmaWVsZHMgYXJlIHdyaXR0ZW4gdG8gemVyb2Vk
CiAJICogbWVtb3J5IHdoaWNoIHRoaXMgaGVscHMgbWFpbnRhaW5zLgogCSAqLwotCWdlbjhfaW5p
dF9vYV9idWZmZXIoZGV2X3ByaXYpOworCWdlbjhfaW5pdF9vYV9idWZmZXIoaTkxNSk7CiAKIAkv
KgogCSAqIE5vdGU6IHdlIGRvbid0IHJlbHkgb24gdGhlIGhhcmR3YXJlIHRvIHBlcmZvcm0gc2lu
Z2xlIGNvbnRleHQKQEAgLTE5MzAsMTkgKzE5MzAsMTkgQEAgc3RhdGljIHZvaWQgZ2VuOF9vYV9l
bmFibGUoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKICAqLwogc3RhdGljIHZvaWQg
aTkxNV9vYV9zdHJlYW1fZW5hYmxlKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gc3RyZWFtLT5kZXZfcHJpdjsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVhbS0+aTkxNTsKIAotCWRldl9w
cml2LT5wZXJmLm9hLm9wcy5vYV9lbmFibGUoc3RyZWFtKTsKKwlpOTE1LT5wZXJmLm9hLm9wcy5v
YV9lbmFibGUoc3RyZWFtKTsKIAotCWlmIChkZXZfcHJpdi0+cGVyZi5vYS5wZXJpb2RpYykKLQkJ
aHJ0aW1lcl9zdGFydCgmZGV2X3ByaXYtPnBlcmYub2EucG9sbF9jaGVja190aW1lciwKKwlpZiAo
aTkxNS0+cGVyZi5vYS5wZXJpb2RpYykKKwkJaHJ0aW1lcl9zdGFydCgmaTkxNS0+cGVyZi5vYS5w
b2xsX2NoZWNrX3RpbWVyLAogCQkJICAgICAgbnNfdG9fa3RpbWUoUE9MTF9QRVJJT0QpLAogCQkJ
ICAgICAgSFJUSU1FUl9NT0RFX1JFTF9QSU5ORUQpOwogfQogCiBzdGF0aWMgdm9pZCBnZW43X29h
X2Rpc2FibGUoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKLQlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSAmc3RyZWFtLT5kZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBp
bnRlbF91bmNvcmUgKnVuY29yZSA9ICZzdHJlYW0tPmk5MTUtPnVuY29yZTsKIAogCWludGVsX3Vu
Y29yZV93cml0ZSh1bmNvcmUsIEdFTjdfT0FDT05UUk9MLCAwKTsKIAlpZiAoaW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIodW5jb3JlLApAQCAtMTk1Myw3ICsxOTUzLDcgQEAgc3RhdGljIHZvaWQgZ2Vu
N19vYV9kaXNhYmxlKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAKIHN0YXRpYyB2
b2lkIGdlbjhfb2FfZGlzYWJsZShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewot
CXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZzdHJlYW0tPmRldl9wcml2LT51bmNvcmU7
CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJnN0cmVhbS0+aTkxNS0+dW5jb3JlOwog
CiAJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOOF9PQUNPTlRST0wsIDApOwogCWlmIChp
bnRlbF93YWl0X2Zvcl9yZWdpc3Rlcih1bmNvcmUsCkBAIC0xOTcyLDEyICsxOTcyLDEyIEBAIHN0
YXRpYyB2b2lkIGdlbjhfb2FfZGlzYWJsZShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFt
KQogICovCiBzdGF0aWMgdm9pZCBpOTE1X29hX3N0cmVhbV9kaXNhYmxlKHN0cnVjdCBpOTE1X3Bl
cmZfc3RyZWFtICpzdHJlYW0pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gc3RyZWFtLT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0
cmVhbS0+aTkxNTsKIAotCWRldl9wcml2LT5wZXJmLm9hLm9wcy5vYV9kaXNhYmxlKHN0cmVhbSk7
CisJaTkxNS0+cGVyZi5vYS5vcHMub2FfZGlzYWJsZShzdHJlYW0pOwogCi0JaWYgKGRldl9wcml2
LT5wZXJmLm9hLnBlcmlvZGljKQotCQlocnRpbWVyX2NhbmNlbCgmZGV2X3ByaXYtPnBlcmYub2Eu
cG9sbF9jaGVja190aW1lcik7CisJaWYgKGk5MTUtPnBlcmYub2EucGVyaW9kaWMpCisJCWhydGlt
ZXJfY2FuY2VsKCZpOTE1LT5wZXJmLm9hLnBvbGxfY2hlY2tfdGltZXIpOwogfQogCiBzdGF0aWMg
Y29uc3Qgc3RydWN0IGk5MTVfcGVyZl9zdHJlYW1fb3BzIGk5MTVfb2Ffc3RyZWFtX29wcyA9IHsK
QEAgLTIwMTEsNyArMjAxMSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCQkJICAgICAgIHN0cnVjdCBkcm1faTkxNV9w
ZXJmX29wZW5fcGFyYW0gKnBhcmFtLAogCQkJICAgICAgIHN0cnVjdCBwZXJmX29wZW5fcHJvcGVy
dGllcyAqcHJvcHMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gc3Ry
ZWFtLT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVhbS0+
aTkxNTsKIAlpbnQgZm9ybWF0X3NpemU7CiAJaW50IHJldDsKIApAQCAtMjAxOSw3ICsyMDE5LDcg
QEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0sCiAJICogcmVhc29uIHRoZW4gZG9uJ3QgbGV0IHVzZXJzcGFjZSB0cnkgdGhlaXIg
bHVjayB3aXRoIGNvbmZpZwogCSAqIElEcwogCSAqLwotCWlmICghZGV2X3ByaXYtPnBlcmYubWV0
cmljc19rb2JqKSB7CisJaWYgKCFpOTE1LT5wZXJmLm1ldHJpY3Nfa29iaikgewogCQlEUk1fREVC
VUcoIk9BIG1ldHJpY3Mgd2VyZW4ndCBhZHZlcnRpc2VkIHZpYSBzeXNmc1xuIik7CiAJCXJldHVy
biAtRUlOVkFMOwogCX0KQEAgLTIwMjksNyArMjAyOSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9z
dHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCQlyZXR1cm4gLUVJ
TlZBTDsKIAl9CiAKLQlpZiAoIWRldl9wcml2LT5wZXJmLm9hLm9wcy5lbmFibGVfbWV0cmljX3Nl
dCkgeworCWlmICghaTkxNS0+cGVyZi5vYS5vcHMuZW5hYmxlX21ldHJpY19zZXQpIHsKIAkJRFJN
X0RFQlVHKCJPQSB1bml0IG5vdCBzdXBwb3J0ZWRcbiIpOwogCQlyZXR1cm4gLUVOT0RFVjsKIAl9
CkBAIC0yMDM4LDcgKzIwMzgsNyBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkgKiBjb3VudGVyIHJlcG9ydHMgYW5kIG1h
cnNoYWwgdG8gdGhlIGFwcHJvcHJpYXRlIGNsaWVudAogCSAqIHdlIGN1cnJlbnRseSBvbmx5IGFs
bG93IGV4Y2x1c2l2ZSBhY2Nlc3MKIAkgKi8KLQlpZiAoZGV2X3ByaXYtPnBlcmYub2EuZXhjbHVz
aXZlX3N0cmVhbSkgeworCWlmIChpOTE1LT5wZXJmLm9hLmV4Y2x1c2l2ZV9zdHJlYW0pIHsKIAkJ
RFJNX0RFQlVHKCJPQSB1bml0IGFscmVhZHkgaW4gdXNlXG4iKTsKIAkJcmV0dXJuIC1FQlVTWTsK
IAl9CkBAIC0yMDU5LDMyICsyMDU5LDMyIEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5p
dChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCSAqCiAJICogVXNpbmcgdGhlIHNh
bWUgbGltaXRpbmcgZmFjdG9ycyBhcyBwcmludGtfcmF0ZWxpbWl0KCkKIAkgKi8KLQlyYXRlbGlt
aXRfc3RhdGVfaW5pdCgmZGV2X3ByaXYtPnBlcmYub2Euc3B1cmlvdXNfcmVwb3J0X3JzLAorCXJh
dGVsaW1pdF9zdGF0ZV9pbml0KCZpOTE1LT5wZXJmLm9hLnNwdXJpb3VzX3JlcG9ydF9ycywKIAkJ
CSAgICAgNSAqIEhaLCAxMCk7CiAJLyogU2luY2Ugd2UgdXNlIGEgRFJNX05PVEUgZm9yIHNwdXJp
b3VzIHJlcG9ydHMgaXQgd291bGQgYmUKIAkgKiBpbmNvbnNpc3RlbnQgdG8gbGV0IF9fcmF0ZWxp
bWl0KCkgYXV0b21hdGljYWxseSBwcmludCBhIHdhcm5pbmcgZm9yCiAJICogdGhyb3R0bGluZy4K
IAkgKi8KLQlyYXRlbGltaXRfc2V0X2ZsYWdzKCZkZXZfcHJpdi0+cGVyZi5vYS5zcHVyaW91c19y
ZXBvcnRfcnMsCisJcmF0ZWxpbWl0X3NldF9mbGFncygmaTkxNS0+cGVyZi5vYS5zcHVyaW91c19y
ZXBvcnRfcnMsCiAJCQkgICAgUkFURUxJTUlUX01TR19PTl9SRUxFQVNFKTsKIAogCXN0cmVhbS0+
c2FtcGxlX3NpemUgPSBzaXplb2Yoc3RydWN0IGRybV9pOTE1X3BlcmZfcmVjb3JkX2hlYWRlcik7
CiAKLQlmb3JtYXRfc2l6ZSA9IGRldl9wcml2LT5wZXJmLm9hLm9hX2Zvcm1hdHNbcHJvcHMtPm9h
X2Zvcm1hdF0uc2l6ZTsKKwlmb3JtYXRfc2l6ZSA9IGk5MTUtPnBlcmYub2Eub2FfZm9ybWF0c1tw
cm9wcy0+b2FfZm9ybWF0XS5zaXplOwogCiAJc3RyZWFtLT5zYW1wbGVfZmxhZ3MgfD0gU0FNUExF
X09BX1JFUE9SVDsKIAlzdHJlYW0tPnNhbXBsZV9zaXplICs9IGZvcm1hdF9zaXplOwogCi0JZGV2
X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLmZvcm1hdF9zaXplID0gZm9ybWF0X3NpemU7Ci0JaWYg
KFdBUk5fT04oZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLmZvcm1hdF9zaXplID09IDApKQor
CWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmZvcm1hdF9zaXplID0gZm9ybWF0X3NpemU7CisJaWYg
KFdBUk5fT04oaTkxNS0+cGVyZi5vYS5vYV9idWZmZXIuZm9ybWF0X3NpemUgPT0gMCkpCiAJCXJl
dHVybiAtRUlOVkFMOwogCi0JZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLmZvcm1hdCA9Ci0J
CWRldl9wcml2LT5wZXJmLm9hLm9hX2Zvcm1hdHNbcHJvcHMtPm9hX2Zvcm1hdF0uZm9ybWF0Owor
CWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLmZvcm1hdCA9CisJCWk5MTUtPnBlcmYub2Eub2FfZm9y
bWF0c1twcm9wcy0+b2FfZm9ybWF0XS5mb3JtYXQ7CiAKLQlkZXZfcHJpdi0+cGVyZi5vYS5wZXJp
b2RpYyA9IHByb3BzLT5vYV9wZXJpb2RpYzsKLQlpZiAoZGV2X3ByaXYtPnBlcmYub2EucGVyaW9k
aWMpCi0JCWRldl9wcml2LT5wZXJmLm9hLnBlcmlvZF9leHBvbmVudCA9IHByb3BzLT5vYV9wZXJp
b2RfZXhwb25lbnQ7CisJaTkxNS0+cGVyZi5vYS5wZXJpb2RpYyA9IHByb3BzLT5vYV9wZXJpb2Rp
YzsKKwlpZiAoaTkxNS0+cGVyZi5vYS5wZXJpb2RpYykKKwkJaTkxNS0+cGVyZi5vYS5wZXJpb2Rf
ZXhwb25lbnQgPSBwcm9wcy0+b2FfcGVyaW9kX2V4cG9uZW50OwogCiAJaWYgKHN0cmVhbS0+Y3R4
KSB7CiAJCXJldCA9IG9hX2dldF9yZW5kZXJfY3R4X2lkKHN0cmVhbSk7CkBAIC0yMDk0LDcgKzIw
OTQsNyBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSwKIAkJfQogCX0KIAotCXJldCA9IGdldF9vYV9jb25maWcoZGV2X3ByaXYs
IHByb3BzLT5tZXRyaWNzX3NldCwgJnN0cmVhbS0+b2FfY29uZmlnKTsKKwlyZXQgPSBnZXRfb2Ff
Y29uZmlnKGk5MTUsIHByb3BzLT5tZXRyaWNzX3NldCwgJnN0cmVhbS0+b2FfY29uZmlnKTsKIAlp
ZiAocmV0KSB7CiAJCURSTV9ERUJVRygiSW52YWxpZCBPQSBjb25maWcgaWQ9JWlcbiIsIHByb3Bz
LT5tZXRyaWNzX3NldCk7CiAJCWdvdG8gZXJyX2NvbmZpZzsKQEAgLTIxMTIsNDMgKzIxMTIsNDMg
QEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0sCiAJICogICBJbiBvdXIgY2FzZSB3ZSBhcmUgZXhwZWN0aW5nIHRoYXQgdGFraW5n
IHBtICsgRk9SQ0VXQUtFCiAJICogICByZWZlcmVuY2VzIHdpbGwgZWZmZWN0aXZlbHkgZGlzYWJs
ZSBSQzYuCiAJICovCi0Jc3RyZWFtLT53YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2
X3ByaXYpOwotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBG
T1JDRVdBS0VfQUxMKTsKKwlzdHJlYW0tPndha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChp
OTE1KTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKIAotCXJldCA9IGFsbG9jX29hX2J1ZmZlcihkZXZfcHJpdik7CisJcmV0ID0gYWxs
b2Nfb2FfYnVmZmVyKGk5MTUpOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyX29hX2J1Zl9hbGxvYzsK
IAotCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+ZHJtKTsK
KwlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtKTsKIAlpZiAo
cmV0KQogCQlnb3RvIGVycl9sb2NrOwogCiAJc3RyZWFtLT5vcHMgPSAmaTkxNV9vYV9zdHJlYW1f
b3BzOwotCWRldl9wcml2LT5wZXJmLm9hLmV4Y2x1c2l2ZV9zdHJlYW0gPSBzdHJlYW07CisJaTkx
NS0+cGVyZi5vYS5leGNsdXNpdmVfc3RyZWFtID0gc3RyZWFtOwogCi0JcmV0ID0gZGV2X3ByaXYt
PnBlcmYub2Eub3BzLmVuYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CisJcmV0ID0gaTkxNS0+cGVy
Zi5vYS5vcHMuZW5hYmxlX21ldHJpY19zZXQoc3RyZWFtKTsKIAlpZiAocmV0KSB7CiAJCURSTV9E
RUJVRygiVW5hYmxlIHRvIGVuYWJsZSBtZXRyaWMgc2V0XG4iKTsKIAkJZ290byBlcnJfZW5hYmxl
OwogCX0KIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gMDsKIAogZXJy
X2VuYWJsZToKLQlkZXZfcHJpdi0+cGVyZi5vYS5leGNsdXNpdmVfc3RyZWFtID0gTlVMTDsKLQlk
ZXZfcHJpdi0+cGVyZi5vYS5vcHMuZGlzYWJsZV9tZXRyaWNfc2V0KGRldl9wcml2KTsKLQltdXRl
eF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlpOTE1LT5wZXJmLm9hLmV4
Y2x1c2l2ZV9zdHJlYW0gPSBOVUxMOworCWk5MTUtPnBlcmYub2Eub3BzLmRpc2FibGVfbWV0cmlj
X3NldChpOTE1KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiBl
cnJfbG9jazoKLQlmcmVlX29hX2J1ZmZlcihkZXZfcHJpdik7CisJZnJlZV9vYV9idWZmZXIoaTkx
NSk7CiAKIGVycl9vYV9idWZfYWxsb2M6Ci0JcHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgc3RyZWFt
LT5vYV9jb25maWcpOworCXB1dF9vYV9jb25maWcoaTkxNSwgc3RyZWFtLT5vYV9jb25maWcpOwog
Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FL
RV9BTEwpOwotCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCBzdHJlYW0tPndha2VyZWYp
OworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHN0cmVhbS0+d2FrZXJlZik7CiAKIGVy
cl9jb25maWc6CiAJaWYgKHN0cmVhbS0+Y3R4KQpAQCAtMjIzOCw3ICsyMjM4LDcgQEAgc3RhdGlj
IHNzaXplX3QgaTkxNV9wZXJmX3JlYWQoc3RydWN0IGZpbGUgKmZpbGUsCiAJCQkgICAgICBsb2Zm
X3QgKnBwb3MpCiB7CiAJc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSA9IGZpbGUtPnBy
aXZhdGVfZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0t
PmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5pOTE1
OwogCXNzaXplX3QgcmV0OwogCiAJLyogVG8gZW5zdXJlIGl0J3MgaGFuZGxlZCBjb25zaXN0ZW50
bHkgd2Ugc2ltcGx5IHRyZWF0IGFsbCByZWFkcyBvZiBhCkBAIC0yMjYxLDE1ICsyMjYxLDE1IEBA
IHN0YXRpYyBzc2l6ZV90IGk5MTVfcGVyZl9yZWFkKHN0cnVjdCBmaWxlICpmaWxlLAogCQkJaWYg
KHJldCkKIAkJCQlyZXR1cm4gcmV0OwogCi0JCQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cGVyZi5s
b2NrKTsKKwkJCW11dGV4X2xvY2soJmk5MTUtPnBlcmYubG9jayk7CiAJCQlyZXQgPSBpOTE1X3Bl
cmZfcmVhZF9sb2NrZWQoc3RyZWFtLCBmaWxlLAogCQkJCQkJICAgIGJ1ZiwgY291bnQsIHBwb3Mp
OwotCQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5sb2NrKTsKKwkJCW11dGV4X3VubG9j
aygmaTkxNS0+cGVyZi5sb2NrKTsKIAkJfSB3aGlsZSAocmV0ID09IC1FQUdBSU4pOwogCX0gZWxz
ZSB7Ci0JCW11dGV4X2xvY2soJmRldl9wcml2LT5wZXJmLmxvY2spOworCQltdXRleF9sb2NrKCZp
OTE1LT5wZXJmLmxvY2spOwogCQlyZXQgPSBpOTE1X3BlcmZfcmVhZF9sb2NrZWQoc3RyZWFtLCBm
aWxlLCBidWYsIGNvdW50LCBwcG9zKTsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5s
b2NrKTsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wZXJmLmxvY2spOwogCX0KIAogCS8qIFdlIGFs
bG93IHRoZSBwb2xsIGNoZWNraW5nIHRvIHNvbWV0aW1lcyByZXBvcnQgZmFsc2UgcG9zaXRpdmUg
RVBPTExJTgpAQCAtMjI4NCw3ICsyMjg0LDcgQEAgc3RhdGljIHNzaXplX3QgaTkxNV9wZXJmX3Jl
YWQoc3RydWN0IGZpbGUgKmZpbGUsCiAJCS8qIE1heWJlIG1ha2UgLT5wb2xsaW4gcGVyLXN0cmVh
bSBzdGF0ZSBpZiB3ZSBzdXBwb3J0IG11bHRpcGxlCiAJCSAqIGNvbmN1cnJlbnQgc3RyZWFtcyBp
biB0aGUgZnV0dXJlLgogCQkgKi8KLQkJZGV2X3ByaXYtPnBlcmYub2EucG9sbGluID0gZmFsc2U7
CisJCWk5MTUtPnBlcmYub2EucG9sbGluID0gZmFsc2U7CiAJfQogCiAJcmV0dXJuIHJldDsKQEAg
LTIyOTIsMTMgKzIyOTIsMTMgQEAgc3RhdGljIHNzaXplX3QgaTkxNV9wZXJmX3JlYWQoc3RydWN0
IGZpbGUgKmZpbGUsCiAKIHN0YXRpYyBlbnVtIGhydGltZXJfcmVzdGFydCBvYV9wb2xsX2NoZWNr
X3RpbWVyX2NiKHN0cnVjdCBocnRpbWVyICpocnRpbWVyKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9Ci0JCWNvbnRhaW5lcl9vZihocnRpbWVyLCB0eXBlb2YoKmRldl9w
cml2KSwKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CisJCWNvbnRhaW5lcl9vZiho
cnRpbWVyLCB0eXBlb2YoKmk5MTUpLAogCQkJICAgICBwZXJmLm9hLnBvbGxfY2hlY2tfdGltZXIp
OwogCi0JaWYgKG9hX2J1ZmZlcl9jaGVja191bmxvY2tlZChkZXZfcHJpdikpIHsKLQkJZGV2X3By
aXYtPnBlcmYub2EucG9sbGluID0gdHJ1ZTsKLQkJd2FrZV91cCgmZGV2X3ByaXYtPnBlcmYub2Eu
cG9sbF93cSk7CisJaWYgKG9hX2J1ZmZlcl9jaGVja191bmxvY2tlZChpOTE1KSkgeworCQlpOTE1
LT5wZXJmLm9hLnBvbGxpbiA9IHRydWU7CisJCXdha2VfdXAoJmk5MTUtPnBlcmYub2EucG9sbF93
cSk7CiAJfQogCiAJaHJ0aW1lcl9mb3J3YXJkX25vdyhocnRpbWVyLCBuc190b19rdGltZShQT0xM
X1BFUklPRCkpOwpAQCAtMjMwOCw3ICsyMzA4LDcgQEAgc3RhdGljIGVudW0gaHJ0aW1lcl9yZXN0
YXJ0IG9hX3BvbGxfY2hlY2tfdGltZXJfY2Ioc3RydWN0IGhydGltZXIgKmhydGltZXIpCiAKIC8q
KgogICogaTkxNV9wZXJmX3BvbGxfbG9ja2VkIC0gcG9sbF93YWl0KCkgd2l0aCBhIHN1aXRhYmxl
IHdhaXQgcXVldWUgZm9yIHN0cmVhbQotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5j
ZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAc3RyZWFtOiBBbiBpOTE1IHBl
cmYgc3RyZWFtCiAgKiBAZmlsZTogQW4gaTkxNSBwZXJmIHN0cmVhbSBmaWxlCiAgKiBAd2FpdDog
cG9sbCgpIHN0YXRlIHRhYmxlCkBAIC0yMzIyLDcgKzIzMjIsNyBAQCBzdGF0aWMgZW51bSBocnRp
bWVyX3Jlc3RhcnQgb2FfcG9sbF9jaGVja190aW1lcl9jYihzdHJ1Y3QgaHJ0aW1lciAqaHJ0aW1l
cikKICAqCiAgKiBSZXR1cm5zOiBhbnkgcG9sbCBldmVudHMgdGhhdCBhcmUgcmVhZHkgd2l0aG91
dCBzbGVlcGluZwogICovCi1zdGF0aWMgX19wb2xsX3QgaTkxNV9wZXJmX3BvbGxfbG9ja2VkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBfX3BvbGxfdCBpOTE1X3Bl
cmZfcG9sbF9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSAgc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJCQkJICBzdHJ1Y3QgZmlsZSAqZmlsZSwK
IAkJCQkJICBwb2xsX3RhYmxlICp3YWl0KQpAQCAtMjMzNyw3ICsyMzM3LDcgQEAgc3RhdGljIF9f
cG9sbF90IGk5MTVfcGVyZl9wb2xsX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJICogdGhlIGhydGltZXIvb2FfcG9sbF9jaGVja190aW1lcl9jYiB0byBub3RpZnkg
dXMgd2hlbiB0aGVyZSBhcmUKIAkgKiBzYW1wbGVzIHRvIHJlYWQuCiAJICovCi0JaWYgKGRldl9w
cml2LT5wZXJmLm9hLnBvbGxpbikKKwlpZiAoaTkxNS0+cGVyZi5vYS5wb2xsaW4pCiAJCWV2ZW50
cyB8PSBFUE9MTElOOwogCiAJcmV0dXJuIGV2ZW50czsKQEAgLTIzNTksMTIgKzIzNTksMTIgQEAg
c3RhdGljIF9fcG9sbF90IGk5MTVfcGVyZl9wb2xsX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgX19wb2xsX3QgaTkxNV9wZXJmX3BvbGwoc3RydWN0IGZp
bGUgKmZpbGUsIHBvbGxfdGFibGUgKndhaXQpCiB7CiAJc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSA9IGZpbGUtPnByaXZhdGVfZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gc3RyZWFtLT5pOTE1OwogCV9fcG9sbF90IHJldDsKIAotCW11dGV4X2xvY2soJmRldl9w
cml2LT5wZXJmLmxvY2spOwotCXJldCA9IGk5MTVfcGVyZl9wb2xsX2xvY2tlZChkZXZfcHJpdiwg
c3RyZWFtLCBmaWxlLCB3YWl0KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLmxvY2sp
OworCW11dGV4X2xvY2soJmk5MTUtPnBlcmYubG9jayk7CisJcmV0ID0gaTkxNV9wZXJmX3BvbGxf
bG9ja2VkKGk5MTUsIHN0cmVhbSwgZmlsZSwgd2FpdCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5w
ZXJmLmxvY2spOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTI0NjEsMTIgKzI0NjEsMTIgQEAgc3Rh
dGljIGxvbmcgaTkxNV9wZXJmX2lvY3RsKHN0cnVjdCBmaWxlICpmaWxlLAogCQkJICAgIHVuc2ln
bmVkIGxvbmcgYXJnKQogewogCXN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0gPSBmaWxl
LT5wcml2YXRlX2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gc3Ry
ZWFtLT5kZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVhbS0+
aTkxNTsKIAlsb25nIHJldDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wZXJmLmxvY2spOwor
CW11dGV4X2xvY2soJmk5MTUtPnBlcmYubG9jayk7CiAJcmV0ID0gaTkxNV9wZXJmX2lvY3RsX2xv
Y2tlZChzdHJlYW0sIGNtZCwgYXJnKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLmxv
Y2spOworCW11dGV4X3VubG9jaygmaTkxNS0+cGVyZi5sb2NrKTsKIAogCXJldHVybiByZXQ7CiB9
CkBAIC0yNTExLDExICsyNTExLDExIEBAIHN0YXRpYyB2b2lkIGk5MTVfcGVyZl9kZXN0cm95X2xv
Y2tlZChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogc3RhdGljIGludCBpOTE1X3Bl
cmZfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIHsKIAlz
dHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHN0cmVhbS0+ZGV2X3ByaXY7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmk5MTU7CiAKLQltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+cGVyZi5sb2NrKTsKKwltdXRleF9sb2NrKCZpOTE1LT5wZXJmLmxvY2spOwog
CWk5MTVfcGVyZl9kZXN0cm95X2xvY2tlZChzdHJlYW0pOwotCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPnBlcmYubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wZXJmLmxvY2spOwogCiAJcmV0
dXJuIDA7CiB9CkBAIC0yNTM3LDcgKzI1MzcsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGZpbGVf
b3BlcmF0aW9ucyBmb3BzID0gewogCiAvKioKICAqIGk5MTVfcGVyZl9vcGVuX2lvY3RsX2xvY2tl
ZCAtIERSTSBpb2N0bCgpIGZvciB1c2Vyc3BhY2UgdG8gb3BlbiBhIHN0cmVhbSBGRAotICogQGRl
dl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3Rh
bmNlCiAgKiBAcGFyYW06IFRoZSBvcGVuIHBhcmFtZXRlcnMgcGFzc2VkIHRvICdEUk1fSTkxNV9Q
RVJGX09QRU5gCiAgKiBAcHJvcHM6IGluZGl2aWR1YWxseSB2YWxpZGF0ZWQgdTY0IHByb3BlcnR5
IHZhbHVlIHBhaXJzCiAgKiBAZmlsZTogZHJtIGZpbGUKQEAgLTI1NjAsNyArMjU2MCw3IEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGZvcHMgPSB7CiAgKiBSZXR1cm5zOiB6
ZXJvIG9uIHN1Y2Nlc3Mgb3IgYSBuZWdhdGl2ZSBlcnJvciBjb2RlLgogICovCiBzdGF0aWMgaW50
Ci1pOTE1X3BlcmZfb3Blbl9pb2N0bF9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAoraTkxNV9wZXJmX29wZW5faW9jdGxfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJICAgIHN0cnVjdCBkcm1faTkxNV9wZXJmX29wZW5fcGFyYW0gKnBhcmFt
LAogCQkJICAgIHN0cnVjdCBwZXJmX29wZW5fcHJvcGVydGllcyAqcHJvcHMsCiAJCQkgICAgc3Ry
dWN0IGRybV9maWxlICpmaWxlKQpAQCAtMjU5OSw3ICsyNTk5LDcgQEAgaTkxNV9wZXJmX29wZW5f
aW9jdGxfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiBNSV9S
RVBPUlRfUEVSRl9DT1VOVCBjb21tYW5kcyBhbmQgc28gY29uc2lkZXIgaXQgYSBwcml2aWxlZ2Vk
IG9wIHRvCiAJICogZW5hYmxlIHRoZSBPQSB1bml0IGJ5IGRlZmF1bHQuCiAJICovCi0JaWYgKElT
X0hBU1dFTEwoZGV2X3ByaXYpICYmIHNwZWNpZmljX2N0eCkKKwlpZiAoSVNfSEFTV0VMTChpOTE1
KSAmJiBzcGVjaWZpY19jdHgpCiAJCXByaXZpbGVnZWRfb3AgPSBmYWxzZTsKIAogCS8qIFNpbWls
YXIgdG8gcGVyZidzIGtlcm5lbC5wZXJmX3BhcmFub2lkX2NwdSBzeXNjdGwgb3B0aW9uCkBAIC0y
NjIwLDcgKzI2MjAsNyBAQCBpOTE1X3BlcmZfb3Blbl9pb2N0bF9sb2NrZWQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlnb3RvIGVycl9jdHg7CiAJfQogCi0Jc3RyZWFtLT5k
ZXZfcHJpdiA9IGRldl9wcml2OworCXN0cmVhbS0+aTkxNSA9IGk5MTU7CiAJc3RyZWFtLT5jdHgg
PSBzcGVjaWZpY19jdHg7CiAKIAlyZXQgPSBpOTE1X29hX3N0cmVhbV9pbml0KHN0cmVhbSwgcGFy
YW0sIHByb3BzKTsKQEAgLTI2MzYsNyArMjYzNiw3IEBAIGk5MTVfcGVyZl9vcGVuX2lvY3RsX2xv
Y2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWdvdG8gZXJyX2ZsYWdz
OwogCX0KIAotCWxpc3RfYWRkKCZzdHJlYW0tPmxpbmssICZkZXZfcHJpdi0+cGVyZi5zdHJlYW1z
KTsKKwlsaXN0X2FkZCgmc3RyZWFtLT5saW5rLCAmaTkxNS0+cGVyZi5zdHJlYW1zKTsKIAogCWlm
IChwYXJhbS0+ZmxhZ3MgJiBJOTE1X1BFUkZfRkxBR19GRF9DTE9FWEVDKQogCQlmX2ZsYWdzIHw9
IE9fQ0xPRVhFQzsKQEAgLTI2NjgsMTUgKzI2NjgsMTUgQEAgaTkxNV9wZXJmX29wZW5faW9jdGxf
bG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gcmV0Owog
fQogCi1zdGF0aWMgdTY0IG9hX2V4cG9uZW50X3RvX25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgaW50IGV4cG9uZW50KQorc3RhdGljIHU2NCBvYV9leHBvbmVudF90b19ucyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IGV4cG9uZW50KQogewogCXJldHVybiBk
aXY2NF91NjQoMTAwMDAwMDAwMFVMTCAqICgyVUxMIDw8IGV4cG9uZW50KSwKLQkJCSAxMDAwVUxM
ICogUlVOVElNRV9JTkZPKGRldl9wcml2KS0+Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHopOwor
CQkJIDEwMDBVTEwgKiBSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFtcF9mcmVxdWVuY3lf
a2h6KTsKIH0KIAogLyoqCiAgKiByZWFkX3Byb3BlcnRpZXNfdW5sb2NrZWQgLSB2YWxpZGF0ZSAr
IGNvcHkgdXNlcnNwYWNlIHN0cmVhbSBvcGVuIHByb3BlcnRpZXMKLSAqIEBkZXZfcHJpdjogaTkx
NSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICogQHVw
cm9wczogVGhlIGFycmF5IG9mIHU2NCBrZXkgdmFsdWUgcGFpcnMgZ2l2ZW4gYnkgdXNlcnNwYWNl
CiAgKiBAbl9wcm9wczogVGhlIG51bWJlciBvZiBrZXkgdmFsdWUgcGFpcnMgZXhwZWN0ZWQgaW4g
QHVwcm9wcwogICogQHByb3BzOiBUaGUgc3RyZWFtIGNvbmZpZ3VyYXRpb24gYnVpbHQgdXAgd2hp
bGUgdmFsaWRhdGluZyBwcm9wZXJ0aWVzCkBAIC0yNjg5LDcgKzI2ODksNyBAQCBzdGF0aWMgdTY0
IG9hX2V4cG9uZW50X3RvX25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50
IGV4cG9uZW50KQogICogd2Ugc2hvdWxkbid0IHZhbGlkYXRlIG9yIGFzc3VtZSBhbnl0aGluZyBh
Ym91dCBvcmRlcmluZyBoZXJlLiBUaGlzIGRvZXNuJ3QKICAqIHJ1bGUgb3V0IGRlZmluaW5nIG5l
dyBwcm9wZXJ0aWVzIHdpdGggb3JkZXJpbmcgcmVxdWlyZW1lbnRzIGluIHRoZSBmdXR1cmUuCiAg
Ki8KLXN0YXRpYyBpbnQgcmVhZF9wcm9wZXJ0aWVzX3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBpbnQgcmVhZF9wcm9wZXJ0aWVzX3VubG9ja2VkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICB1NjQgX191c2VyICp1cHJvcHMs
CiAJCQkJICAgIHUzMiBuX3Byb3BzLAogCQkJCSAgICBzdHJ1Y3QgcGVyZl9vcGVuX3Byb3BlcnRp
ZXMgKnByb3BzKQpAQCAtMjc1NSw3ICsyNzU1LDcgQEAgc3RhdGljIGludCByZWFkX3Byb3BlcnRp
ZXNfdW5sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCQkgIHZh
bHVlKTsKIAkJCQlyZXR1cm4gLUVJTlZBTDsKIAkJCX0KLQkJCWlmICghZGV2X3ByaXYtPnBlcmYu
b2Eub2FfZm9ybWF0c1t2YWx1ZV0uc2l6ZSkgeworCQkJaWYgKCFpOTE1LT5wZXJmLm9hLm9hX2Zv
cm1hdHNbdmFsdWVdLnNpemUpIHsKIAkJCQlEUk1fREVCVUcoIlVuc3VwcG9ydGVkIE9BIHJlcG9y
dCBmb3JtYXQgJWxsdVxuIiwKIAkJCQkJICB2YWx1ZSk7CiAJCQkJcmV0dXJuIC1FSU5WQUw7CkBA
IC0yNzc2LDcgKzI3NzYsNyBAQCBzdGF0aWMgaW50IHJlYWRfcHJvcGVydGllc191bmxvY2tlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgKi8KIAogCQkJQlVJTERfQlVH
X09OKHNpemVvZihvYV9wZXJpb2QpICE9IDgpOwotCQkJb2FfcGVyaW9kID0gb2FfZXhwb25lbnRf
dG9fbnMoZGV2X3ByaXYsIHZhbHVlKTsKKwkJCW9hX3BlcmlvZCA9IG9hX2V4cG9uZW50X3RvX25z
KGk5MTUsIHZhbHVlKTsKIAogCQkJLyogVGhpcyBjaGVjayBpcyBwcmltYXJpbHkgdG8gZW5zdXJl
IHRoYXQgb2FfcGVyaW9kIDw9CiAJCQkgKiBVSU5UMzJfTUFYIChiZWZvcmUgcGFzc2luZyB0byBk
b19kaXYgd2hpY2ggb25seQpAQCAtMjgzOSwxMyArMjgzOSwxMyBAQCBzdGF0aWMgaW50IHJlYWRf
cHJvcGVydGllc191bmxvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBp
bnQgaTkxNV9wZXJmX29wZW5faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIAkJCSBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZGV2LT5kZXZfcHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGRybV9pOTE1X3BlcmZfb3Blbl9w
YXJhbSAqcGFyYW0gPSBkYXRhOwogCXN0cnVjdCBwZXJmX29wZW5fcHJvcGVydGllcyBwcm9wczsK
IAl1MzIga25vd25fb3Blbl9mbGFnczsKIAlpbnQgcmV0OwogCi0JaWYgKCFkZXZfcHJpdi0+cGVy
Zi5pbml0aWFsaXplZCkgeworCWlmICghaTkxNS0+cGVyZi5pbml0aWFsaXplZCkgewogCQlEUk1f
REVCVUcoImk5MTUgcGVyZiBpbnRlcmZhY2Ugbm90IGF2YWlsYWJsZSBmb3IgdGhpcyBzeXN0ZW1c
biIpOwogCQlyZXR1cm4gLUVOT1RTVVBQOwogCX0KQEAgLTI4NTgsMTI0ICsyODU4LDEyNCBAQCBp
bnQgaTkxNV9wZXJmX29wZW5faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JcmV0ID0gcmVhZF9wcm9wZXJ0aWVzX3VubG9j
a2VkKGRldl9wcml2LAorCXJldCA9IHJlYWRfcHJvcGVydGllc191bmxvY2tlZChpOTE1LAogCQkJ
CSAgICAgICB1NjRfdG9fdXNlcl9wdHIocGFyYW0tPnByb3BlcnRpZXNfcHRyKSwKIAkJCQkgICAg
ICAgcGFyYW0tPm51bV9wcm9wZXJ0aWVzLAogCQkJCSAgICAgICAmcHJvcHMpOwogCWlmIChyZXQp
CiAJCXJldHVybiByZXQ7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cGVyZi5sb2NrKTsKLQly
ZXQgPSBpOTE1X3BlcmZfb3Blbl9pb2N0bF9sb2NrZWQoZGV2X3ByaXYsIHBhcmFtLCAmcHJvcHMs
IGZpbGUpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubG9jayk7CisJbXV0ZXhfbG9j
aygmaTkxNS0+cGVyZi5sb2NrKTsKKwlyZXQgPSBpOTE1X3BlcmZfb3Blbl9pb2N0bF9sb2NrZWQo
aTkxNSwgcGFyYW0sICZwcm9wcywgZmlsZSk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wZXJmLmxv
Y2spOwogCiAJcmV0dXJuIHJldDsKIH0KIAogLyoqCiAgKiBpOTE1X3BlcmZfcmVnaXN0ZXIgLSBl
eHBvc2VzIGk5MTUtcGVyZiB0byB1c2Vyc3BhY2UKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2Ug
aW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAqIEluIHBhcnRp
Y3VsYXIgT0EgbWV0cmljIHNldHMgYXJlIGFkdmVydGlzZWQgdW5kZXIgYSBzeXNmcyBtZXRyaWNz
LwogICogZGlyZWN0b3J5IGFsbG93aW5nIHVzZXJzcGFjZSB0byBlbnVtZXJhdGUgdmFsaWQgSURz
IHRoYXQgY2FuIGJlCiAgKiB1c2VkIHRvIG9wZW4gYW4gaTkxNS1wZXJmIHN0cmVhbS4KICAqLwot
dm9pZCBpOTE1X3BlcmZfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQordm9pZCBpOTE1X3BlcmZfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiB7CiAJaW50IHJldDsKIAotCWlmICghZGV2X3ByaXYtPnBlcmYuaW5pdGlhbGl6ZWQpCisJaWYg
KCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKQogCQlyZXR1cm47CiAKIAkvKiBUbyBiZSBzdXJlIHdl
J3JlIHN5bmNocm9uaXplZCB3aXRoIGFuIGF0dGVtcHRlZAogCSAqIGk5MTVfcGVyZl9vcGVuX2lv
Y3RsKCk7IGNvbnNpZGVyaW5nIHRoYXQgd2UgcmVnaXN0ZXIgYWZ0ZXIKIAkgKiBiZWluZyBleHBv
c2VkIHRvIHVzZXJzcGFjZS4KIAkgKi8KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cGVyZi5sb2Nr
KTsKKwltdXRleF9sb2NrKCZpOTE1LT5wZXJmLmxvY2spOwogCi0JZGV2X3ByaXYtPnBlcmYubWV0
cmljc19rb2JqID0KKwlpOTE1LT5wZXJmLm1ldHJpY3Nfa29iaiA9CiAJCWtvYmplY3RfY3JlYXRl
X2FuZF9hZGQoIm1ldHJpY3MiLAotCQkJCSAgICAgICAmZGV2X3ByaXYtPmRybS5wcmltYXJ5LT5r
ZGV2LT5rb2JqKTsKLQlpZiAoIWRldl9wcml2LT5wZXJmLm1ldHJpY3Nfa29iaikKKwkJCQkgICAg
ICAgJmk5MTUtPmRybS5wcmltYXJ5LT5rZGV2LT5rb2JqKTsKKwlpZiAoIWk5MTUtPnBlcmYubWV0
cmljc19rb2JqKQogCQlnb3RvIGV4aXQ7CiAKLQlzeXNmc19hdHRyX2luaXQoJmRldl9wcml2LT5w
ZXJmLm9hLnRlc3RfY29uZmlnLnN5c2ZzX21ldHJpY19pZC5hdHRyKTsKLQotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExKSB7Ci0JCWk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2ljbChk
ZXZfcHJpdik7Ci0JfSBlbHNlIGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSkgewotCQlpOTE1
X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19jbmwoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSVNfQ09G
RkVFTEFLRShkZXZfcHJpdikpIHsKLQkJaWYgKElTX0NGTF9HVDIoZGV2X3ByaXYpKQotCQkJaTkx
NV9wZXJmX2xvYWRfdGVzdF9jb25maWdfY2ZsZ3QyKGRldl9wcml2KTsKLQkJaWYgKElTX0NGTF9H
VDMoZGV2X3ByaXYpKQotCQkJaTkxNV9wZXJmX2xvYWRfdGVzdF9jb25maWdfY2ZsZ3QzKGRldl9w
cml2KTsKLQl9IGVsc2UgaWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7Ci0JCWk5MTVfcGVy
Zl9sb2FkX3Rlc3RfY29uZmlnX2dsayhkZXZfcHJpdik7Ci0JfSBlbHNlIGlmIChJU19LQUJZTEFL
RShkZXZfcHJpdikpIHsKLQkJaWYgKElTX0tCTF9HVDIoZGV2X3ByaXYpKQotCQkJaTkxNV9wZXJm
X2xvYWRfdGVzdF9jb25maWdfa2JsZ3QyKGRldl9wcml2KTsKLQkJZWxzZSBpZiAoSVNfS0JMX0dU
MyhkZXZfcHJpdikpCi0JCQlpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19rYmxndDMoZGV2X3By
aXYpOwotCX0gZWxzZSBpZiAoSVNfQlJPWFRPTihkZXZfcHJpdikpIHsKLQkJaTkxNV9wZXJmX2xv
YWRfdGVzdF9jb25maWdfYnh0KGRldl9wcml2KTsKLQl9IGVsc2UgaWYgKElTX1NLWUxBS0UoZGV2
X3ByaXYpKSB7Ci0JCWlmIChJU19TS0xfR1QyKGRldl9wcml2KSkKLQkJCWk5MTVfcGVyZl9sb2Fk
X3Rlc3RfY29uZmlnX3NrbGd0MihkZXZfcHJpdik7Ci0JCWVsc2UgaWYgKElTX1NLTF9HVDMoZGV2
X3ByaXYpKQotCQkJaTkxNV9wZXJmX2xvYWRfdGVzdF9jb25maWdfc2tsZ3QzKGRldl9wcml2KTsK
LQkJZWxzZSBpZiAoSVNfU0tMX0dUNChkZXZfcHJpdikpCi0JCQlpOTE1X3BlcmZfbG9hZF90ZXN0
X2NvbmZpZ19za2xndDQoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhkZXZf
cHJpdikpIHsKLQkJaTkxNV9wZXJmX2xvYWRfdGVzdF9jb25maWdfY2h2KGRldl9wcml2KTsKLQl9
IGVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKLQkJaTkxNV9wZXJmX2xvYWRfdGVz
dF9jb25maWdfYmR3KGRldl9wcml2KTsKLQl9IGVsc2UgaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYp
KSB7Ci0JCWk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2hzdyhkZXZfcHJpdik7Ci19Ci0KLQlp
ZiAoZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPT0gMCkKKwlzeXNmc19hdHRyX2lu
aXQoJmk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljX2lkLmF0dHIpOworCisJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgeworCQlpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZp
Z19pY2woaTkxNSk7CisJfSBlbHNlIGlmIChJU19DQU5OT05MQUtFKGk5MTUpKSB7CisJCWk5MTVf
cGVyZl9sb2FkX3Rlc3RfY29uZmlnX2NubChpOTE1KTsKKwl9IGVsc2UgaWYgKElTX0NPRkZFRUxB
S0UoaTkxNSkpIHsKKwkJaWYgKElTX0NGTF9HVDIoaTkxNSkpCisJCQlpOTE1X3BlcmZfbG9hZF90
ZXN0X2NvbmZpZ19jZmxndDIoaTkxNSk7CisJCWlmIChJU19DRkxfR1QzKGk5MTUpKQorCQkJaTkx
NV9wZXJmX2xvYWRfdGVzdF9jb25maWdfY2ZsZ3QzKGk5MTUpOworCX0gZWxzZSBpZiAoSVNfR0VN
SU5JTEFLRShpOTE1KSkgeworCQlpOTE1X3BlcmZfbG9hZF90ZXN0X2NvbmZpZ19nbGsoaTkxNSk7
CisJfSBlbHNlIGlmIChJU19LQUJZTEFLRShpOTE1KSkgeworCQlpZiAoSVNfS0JMX0dUMihpOTE1
KSkKKwkJCWk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2tibGd0MihpOTE1KTsKKwkJZWxzZSBp
ZiAoSVNfS0JMX0dUMyhpOTE1KSkKKwkJCWk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX2tibGd0
MyhpOTE1KTsKKwl9IGVsc2UgaWYgKElTX0JST1hUT04oaTkxNSkpIHsKKwkJaTkxNV9wZXJmX2xv
YWRfdGVzdF9jb25maWdfYnh0KGk5MTUpOworCX0gZWxzZSBpZiAoSVNfU0tZTEFLRShpOTE1KSkg
eworCQlpZiAoSVNfU0tMX0dUMihpOTE1KSkKKwkJCWk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmln
X3NrbGd0MihpOTE1KTsKKwkJZWxzZSBpZiAoSVNfU0tMX0dUMyhpOTE1KSkKKwkJCWk5MTVfcGVy
Zl9sb2FkX3Rlc3RfY29uZmlnX3NrbGd0MyhpOTE1KTsKKwkJZWxzZSBpZiAoSVNfU0tMX0dUNChp
OTE1KSkKKwkJCWk5MTVfcGVyZl9sb2FkX3Rlc3RfY29uZmlnX3NrbGd0NChpOTE1KTsKKwl9IGVs
c2UgaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKKwkJaTkxNV9wZXJmX2xvYWRfdGVzdF9jb25m
aWdfY2h2KGk5MTUpOworCX0gZWxzZSBpZiAoSVNfQlJPQURXRUxMKGk5MTUpKSB7CisJCWk5MTVf
cGVyZl9sb2FkX3Rlc3RfY29uZmlnX2JkdyhpOTE1KTsKKwl9IGVsc2UgaWYgKElTX0hBU1dFTEwo
aTkxNSkpIHsKKwkJaTkxNV9wZXJmX2xvYWRfdGVzdF9jb25maWdfaHN3KGk5MTUpOworfQorCisJ
aWYgKGk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuaWQgPT0gMCkKIAkJZ290byBzeXNmc19lcnJv
cjsKIAotCXJldCA9IHN5c2ZzX2NyZWF0ZV9ncm91cChkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2tv
YmosCi0JCQkJICZkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMpOwor
CXJldCA9IHN5c2ZzX2NyZWF0ZV9ncm91cChpOTE1LT5wZXJmLm1ldHJpY3Nfa29iaiwKKwkJCQkg
Jmk5MTUtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljKTsKIAlpZiAocmV0KQogCQln
b3RvIHN5c2ZzX2Vycm9yOwogCi0JYXRvbWljX3NldCgmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9j
b25maWcucmVmX2NvdW50LCAxKTsKKwlhdG9taWNfc2V0KCZpOTE1LT5wZXJmLm9hLnRlc3RfY29u
ZmlnLnJlZl9jb3VudCwgMSk7CiAKIAlnb3RvIGV4aXQ7CiAKIHN5c2ZzX2Vycm9yOgotCWtvYmpl
Y3RfcHV0KGRldl9wcml2LT5wZXJmLm1ldHJpY3Nfa29iaik7Ci0JZGV2X3ByaXYtPnBlcmYubWV0
cmljc19rb2JqID0gTlVMTDsKKwlrb2JqZWN0X3B1dChpOTE1LT5wZXJmLm1ldHJpY3Nfa29iaik7
CisJaTkxNS0+cGVyZi5tZXRyaWNzX2tvYmogPSBOVUxMOwogCiBleGl0OgotCW11dGV4X3VubG9j
aygmZGV2X3ByaXYtPnBlcmYubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wZXJmLmxvY2sp
OwogfQogCiAvKioKICAqIGk5MTVfcGVyZl91bnJlZ2lzdGVyIC0gaGlkZSBpOTE1LXBlcmYgZnJv
bSB1c2Vyc3BhY2UKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1
OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAqIGk5MTUtcGVyZiBzdGF0ZSBjbGVhbnVwIGlz
IHNwbGl0IHVwIGludG8gYW4gJ3VucmVnaXN0ZXInIGFuZAogICogJ2RlaW5pdCcgcGhhc2Ugd2hl
cmUgdGhlIGludGVyZmFjZSBpcyBmaXJzdCBoaWRkZW4gZnJvbQogICogdXNlcnNwYWNlIGJ5IGk5
MTVfcGVyZl91bnJlZ2lzdGVyKCkgYmVmb3JlIGNsZWFuaW5nIHVwCiAgKiByZW1haW5pbmcgc3Rh
dGUgaW4gaTkxNV9wZXJmX2ZpbmkoKS4KICAqLwotdm9pZCBpOTE1X3BlcmZfdW5yZWdpc3Rlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGk5MTVfcGVyZl91bnJlZ2lz
dGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlmICghZGV2X3ByaXYtPnBl
cmYubWV0cmljc19rb2JqKQorCWlmICghaTkxNS0+cGVyZi5tZXRyaWNzX2tvYmopCiAJCXJldHVy
bjsKIAotCXN5c2ZzX3JlbW92ZV9ncm91cChkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2tvYmosCi0J
CQkgICAmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcuc3lzZnNfbWV0cmljKTsKKwlzeXNm
c19yZW1vdmVfZ3JvdXAoaTkxNS0+cGVyZi5tZXRyaWNzX2tvYmosCisJCQkgICAmaTkxNS0+cGVy
Zi5vYS50ZXN0X2NvbmZpZy5zeXNmc19tZXRyaWMpOwogCi0Ja29iamVjdF9wdXQoZGV2X3ByaXYt
PnBlcmYubWV0cmljc19rb2JqKTsKLQlkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2tvYmogPSBOVUxM
OworCWtvYmplY3RfcHV0KGk5MTUtPnBlcmYubWV0cmljc19rb2JqKTsKKwlpOTE1LT5wZXJmLm1l
dHJpY3Nfa29iaiA9IE5VTEw7CiB9CiAKLXN0YXRpYyBib29sIGdlbjhfaXNfdmFsaWRfZmxleF9h
ZGRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGFkZHIpCitzdGF0aWMg
Ym9vbCBnZW44X2lzX3ZhbGlkX2ZsZXhfYWRkcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwgdTMyIGFkZHIpCiB7CiAJc3RhdGljIGNvbnN0IGk5MTVfcmVnX3QgZmxleF9ldV9yZWdzW10g
PSB7CiAJCUVVX1BFUkZfQ05UTDAsCkBAIC0yOTk1LDcgKzI5OTUsNyBAQCBzdGF0aWMgYm9vbCBn
ZW44X2lzX3ZhbGlkX2ZsZXhfYWRkcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IHUzMiBhZGRyKQogCXJldHVybiBmYWxzZTsKIH0KIAotc3RhdGljIGJvb2wgZ2VuN19pc192YWxp
ZF9iX2NvdW50ZXJfYWRkcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBh
ZGRyKQorc3RhdGljIGJvb2wgZ2VuN19pc192YWxpZF9iX2NvdW50ZXJfYWRkcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIGFkZHIpCiB7CiAJcmV0dXJuIChhZGRyID49IGk5MTVf
bW1pb19yZWdfb2Zmc2V0KE9BU1RBUlRUUklHMSkgJiYKIAkJYWRkciA8PSBpOTE1X21taW9fcmVn
X29mZnNldChPQVNUQVJUVFJJRzgpKSB8fApAQCAtMzAwNSw3ICszMDA1LDcgQEAgc3RhdGljIGJv
b2wgZ2VuN19pc192YWxpZF9iX2NvdW50ZXJfYWRkcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIHUzMgogCQkgYWRkciA8PSBpOTE1X21taW9fcmVnX29mZnNldChPQUNFQzdfMSkp
OwogfQogCi1zdGF0aWMgYm9vbCBnZW43X2lzX3ZhbGlkX211eF9hZGRyKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGFkZHIpCitzdGF0aWMgYm9vbCBnZW43X2lzX3ZhbGlk
X211eF9hZGRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgYWRkcikKIHsKIAly
ZXR1cm4gYWRkciA9PSBpOTE1X21taW9fcmVnX29mZnNldChIQUxGX1NMSUNFX0NISUNLRU4yKSB8
fAogCQkoYWRkciA+PSBpOTE1X21taW9fcmVnX29mZnNldChNSUNST19CUDBfMCkgJiYKQEAgLTMw
MTYsMzQgKzMwMTYsMzQgQEAgc3RhdGljIGJvb2wgZ2VuN19pc192YWxpZF9tdXhfYWRkcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBhZGRyKQogCQkgYWRkciA8PSBpOTE1
X21taW9fcmVnX29mZnNldChPQV9QRVJGTUFUUklYX0hJKSk7CiB9CiAKLXN0YXRpYyBib29sIGdl
bjhfaXNfdmFsaWRfbXV4X2FkZHIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1
MzIgYWRkcikKK3N0YXRpYyBib29sIGdlbjhfaXNfdmFsaWRfbXV4X2FkZHIoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBhZGRyKQogewotCXJldHVybiBnZW43X2lzX3ZhbGlkX211
eF9hZGRyKGRldl9wcml2LCBhZGRyKSB8fAorCXJldHVybiBnZW43X2lzX3ZhbGlkX211eF9hZGRy
KGk5MTUsIGFkZHIpIHx8CiAJCWFkZHIgPT0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoV0FJVF9GT1Jf
UkM2X0VYSVQpIHx8CiAJCShhZGRyID49IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJQTV9DT05GSUcw
KSAmJgogCQkgYWRkciA8PSBpOTE1X21taW9fcmVnX29mZnNldChOT0FfQ09ORklHKDgpKSk7CiB9
CiAKLXN0YXRpYyBib29sIGdlbjEwX2lzX3ZhbGlkX211eF9hZGRyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgdTMyIGFkZHIpCitzdGF0aWMgYm9vbCBnZW4xMF9pc192YWxpZF9t
dXhfYWRkcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIGFkZHIpCiB7Ci0JcmV0
dXJuIGdlbjhfaXNfdmFsaWRfbXV4X2FkZHIoZGV2X3ByaXYsIGFkZHIpIHx8CisJcmV0dXJuIGdl
bjhfaXNfdmFsaWRfbXV4X2FkZHIoaTkxNSwgYWRkcikgfHwKIAkJYWRkciA9PSBpOTE1X21taW9f
cmVnX29mZnNldChHRU4xMF9OT0FfV1JJVEVfSElHSCkgfHwKIAkJKGFkZHIgPj0gaTkxNV9tbWlv
X3JlZ19vZmZzZXQoT0FfUEVSRkNOVDNfTE8pICYmCiAJCSBhZGRyIDw9IGk5MTVfbW1pb19yZWdf
b2Zmc2V0KE9BX1BFUkZDTlQ0X0hJKSk7CiB9CiAKLXN0YXRpYyBib29sIGhzd19pc192YWxpZF9t
dXhfYWRkcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBhZGRyKQorc3Rh
dGljIGJvb2wgaHN3X2lzX3ZhbGlkX211eF9hZGRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCB1MzIgYWRkcikKIHsKLQlyZXR1cm4gZ2VuN19pc192YWxpZF9tdXhfYWRkcihkZXZfcHJp
diwgYWRkcikgfHwKKwlyZXR1cm4gZ2VuN19pc192YWxpZF9tdXhfYWRkcihpOTE1LCBhZGRyKSB8
fAogCQkoYWRkciA+PSAweDI1MTAwICYmIGFkZHIgPD0gMHgyRkY5MCkgfHwKIAkJKGFkZHIgPj0g
aTkxNV9tbWlvX3JlZ19vZmZzZXQoSFNXX01CVklEMl9OT0EwKSAmJgogCQkgYWRkciA8PSBpOTE1
X21taW9fcmVnX29mZnNldChIU1dfTUJWSUQyX05PQTkpKSB8fAogCQlhZGRyID09IGk5MTVfbW1p
b19yZWdfb2Zmc2V0KEhTV19NQlZJRDJfTUlTUjApOwogfQogCi1zdGF0aWMgYm9vbCBjaHZfaXNf
dmFsaWRfbXV4X2FkZHIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgYWRk
cikKK3N0YXRpYyBib29sIGNodl9pc192YWxpZF9tdXhfYWRkcihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgdTMyIGFkZHIpCiB7Ci0JcmV0dXJuIGdlbjdfaXNfdmFsaWRfbXV4X2FkZHIo
ZGV2X3ByaXYsIGFkZHIpIHx8CisJcmV0dXJuIGdlbjdfaXNfdmFsaWRfbXV4X2FkZHIoaTkxNSwg
YWRkcikgfHwKIAkJKGFkZHIgPj0gMHgxODIzMDAgJiYgYWRkciA8PSAweDE4MjNBNCk7CiB9CiAK
QEAgLTMwNjYsOCArMzA2Niw4IEBAIHN0YXRpYyB1MzIgbWFza19yZWdfdmFsdWUodTMyIHJlZywg
dTMyIHZhbCkKIAlyZXR1cm4gdmFsOwogfQogCi1zdGF0aWMgc3RydWN0IGk5MTVfb2FfcmVnICph
bGxvY19vYV9yZWdzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJIGJv
b2wgKCppc192YWxpZCkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgYWRk
ciksCitzdGF0aWMgc3RydWN0IGk5MTVfb2FfcmVnICphbGxvY19vYV9yZWdzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAorCQkJCQkgYm9vbCAoKmlzX3ZhbGlkKShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIGFkZHIpLAogCQkJCQkgdTMyIF9fdXNlciAqcmVncywKIAkJ
CQkJIHUzMiBuX3JlZ3MpCiB7CkBAIC0zMDk3LDcgKzMwOTcsNyBAQCBzdGF0aWMgc3RydWN0IGk5
MTVfb2FfcmVnICphbGxvY19vYV9yZWdzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJaWYgKGVycikKIAkJCWdvdG8gYWRkcl9lcnI7CiAKLQkJaWYgKCFpc192YWxpZChkZXZf
cHJpdiwgYWRkcikpIHsKKwkJaWYgKCFpc192YWxpZChpOTE1LCBhZGRyKSkgewogCQkJRFJNX0RF
QlVHKCJJbnZhbGlkIG9hX3JlZyBhZGRyZXNzOiAlWFxuIiwgYWRkcik7CiAJCQllcnIgPSAtRUlO
VkFMOwogCQkJZ290byBhZGRyX2VycjsKQEAgLTMxMzAsNyArMzEzMCw3IEBAIHN0YXRpYyBzc2l6
ZV90IHNob3dfZHluYW1pY19pZChzdHJ1Y3QgZGV2aWNlICpkZXYsCiAJcmV0dXJuIHNwcmludGYo
YnVmLCAiJWRcbiIsIG9hX2NvbmZpZy0+aWQpOwogfQogCi1zdGF0aWMgaW50IGNyZWF0ZV9keW5h
bWljX29hX3N5c2ZzX2VudHJ5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0
YXRpYyBpbnQgY3JlYXRlX2R5bmFtaWNfb2Ffc3lzZnNfZW50cnkoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCQkJCSBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZykKIHsK
IAlzeXNmc19hdHRyX2luaXQoJm9hX2NvbmZpZy0+c3lzZnNfbWV0cmljX2lkLmF0dHIpOwpAQCAt
MzE0NSw3ICszMTQ1LDcgQEAgc3RhdGljIGludCBjcmVhdGVfZHluYW1pY19vYV9zeXNmc19lbnRy
eShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJb2FfY29uZmlnLT5zeXNmc19t
ZXRyaWMubmFtZSA9IG9hX2NvbmZpZy0+dXVpZDsKIAlvYV9jb25maWctPnN5c2ZzX21ldHJpYy5h
dHRycyA9IG9hX2NvbmZpZy0+YXR0cnM7CiAKLQlyZXR1cm4gc3lzZnNfY3JlYXRlX2dyb3VwKGRl
dl9wcml2LT5wZXJmLm1ldHJpY3Nfa29iaiwKKwlyZXR1cm4gc3lzZnNfY3JlYXRlX2dyb3VwKGk5
MTUtPnBlcmYubWV0cmljc19rb2JqLAogCQkJCSAgJm9hX2NvbmZpZy0+c3lzZnNfbWV0cmljKTsK
IH0KIApAQCAtMzE2NSwxNyArMzE2NSwxNyBAQCBzdGF0aWMgaW50IGNyZWF0ZV9keW5hbWljX29h
X3N5c2ZzX2VudHJ5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIGludCBpOTE1
X3BlcmZfYWRkX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCQkJICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBkZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gZGV2LT5kZXZfcHJpdmF0ZTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9v
YV9jb25maWcgKmFyZ3MgPSBkYXRhOwogCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmln
LCAqdG1wOwogCWludCBlcnIsIGlkOwogCi0JaWYgKCFkZXZfcHJpdi0+cGVyZi5pbml0aWFsaXpl
ZCkgeworCWlmICghaTkxNS0+cGVyZi5pbml0aWFsaXplZCkgewogCQlEUk1fREVCVUcoImk5MTUg
cGVyZiBpbnRlcmZhY2Ugbm90IGF2YWlsYWJsZSBmb3IgdGhpcyBzeXN0ZW1cbiIpOwogCQlyZXR1
cm4gLUVOT1RTVVBQOwogCX0KIAotCWlmICghZGV2X3ByaXYtPnBlcmYubWV0cmljc19rb2JqKSB7
CisJaWYgKCFpOTE1LT5wZXJmLm1ldHJpY3Nfa29iaikgewogCQlEUk1fREVCVUcoIk9BIG1ldHJp
Y3Mgd2VyZW4ndCBhZHZlcnRpc2VkIHZpYSBzeXNmc1xuIik7CiAJCXJldHVybiAtRUlOVkFMOwog
CX0KQEAgLTMyMTMsOCArMzIxMyw4IEBAIGludCBpOTE1X3BlcmZfYWRkX2NvbmZpZ19pb2N0bChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJb2FfY29uZmlnLT5tdXhfcmVn
c19sZW4gPSBhcmdzLT5uX211eF9yZWdzOwogCW9hX2NvbmZpZy0+bXV4X3JlZ3MgPQotCQlhbGxv
Y19vYV9yZWdzKGRldl9wcml2LAotCQkJICAgICAgZGV2X3ByaXYtPnBlcmYub2Eub3BzLmlzX3Zh
bGlkX211eF9yZWcsCisJCWFsbG9jX29hX3JlZ3MoaTkxNSwKKwkJCSAgICAgIGk5MTUtPnBlcmYu
b2Eub3BzLmlzX3ZhbGlkX211eF9yZWcsCiAJCQkgICAgICB1NjRfdG9fdXNlcl9wdHIoYXJncy0+
bXV4X3JlZ3NfcHRyKSwKIAkJCSAgICAgIGFyZ3MtPm5fbXV4X3JlZ3MpOwogCkBAIC0zMjI2LDgg
KzMyMjYsOCBAQCBpbnQgaTkxNV9wZXJmX2FkZF9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwKIAogCW9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuID0g
YXJncy0+bl9ib29sZWFuX3JlZ3M7CiAJb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncyA9Ci0JCWFs
bG9jX29hX3JlZ3MoZGV2X3ByaXYsCi0JCQkgICAgICBkZXZfcHJpdi0+cGVyZi5vYS5vcHMuaXNf
dmFsaWRfYl9jb3VudGVyX3JlZywKKwkJYWxsb2Nfb2FfcmVncyhpOTE1LAorCQkJICAgICAgaTkx
NS0+cGVyZi5vYS5vcHMuaXNfdmFsaWRfYl9jb3VudGVyX3JlZywKIAkJCSAgICAgIHU2NF90b191
c2VyX3B0cihhcmdzLT5ib29sZWFuX3JlZ3NfcHRyKSwKIAkJCSAgICAgIGFyZ3MtPm5fYm9vbGVh
bl9yZWdzKTsKIApAQCAtMzIzNyw3ICszMjM3LDcgQEAgaW50IGk5MTVfcGVyZl9hZGRfY29uZmln
X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCWdvdG8gcmVnX2Vy
cjsKIAl9CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDgpIHsKKwlpZiAoSU5URUxfR0VO
KGk5MTUpIDwgOCkgewogCQlpZiAoYXJncy0+bl9mbGV4X3JlZ3MgIT0gMCkgewogCQkJZXJyID0g
LUVJTlZBTDsKIAkJCWdvdG8gcmVnX2VycjsKQEAgLTMyNDUsOCArMzI0NSw4IEBAIGludCBpOTE1
X3BlcmZfYWRkX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCX0gZWxzZSB7CiAJCW9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiA9IGFyZ3MtPm5fZmxleF9y
ZWdzOwogCQlvYV9jb25maWctPmZsZXhfcmVncyA9Ci0JCQlhbGxvY19vYV9yZWdzKGRldl9wcml2
LAotCQkJCSAgICAgIGRldl9wcml2LT5wZXJmLm9hLm9wcy5pc192YWxpZF9mbGV4X3JlZywKKwkJ
CWFsbG9jX29hX3JlZ3MoaTkxNSwKKwkJCQkgICAgICBpOTE1LT5wZXJmLm9hLm9wcy5pc192YWxp
ZF9mbGV4X3JlZywKIAkJCQkgICAgICB1NjRfdG9fdXNlcl9wdHIoYXJncy0+ZmxleF9yZWdzX3B0
ciksCiAJCQkJICAgICAgYXJncy0+bl9mbGV4X3JlZ3MpOwogCkBAIC0zMjU3LDE0ICszMjU3LDE0
IEBAIGludCBpOTE1X3BlcmZfYWRkX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogCQl9CiAJfQogCi0JZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOworCWVyciA9IG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOwogCWlmIChlcnIpCiAJCWdvdG8gcmVn
X2VycjsKIAogCS8qIFdlIHNob3VsZG4ndCBoYXZlIHRvbyBtYW55IGNvbmZpZ3MsIHNvIHRoaXMg
aXRlcmF0aW9uIHNob3VsZG4ndCBiZQogCSAqIHRvbyBjb3N0bHkuCiAJICovCi0JaWRyX2Zvcl9l
YWNoX2VudHJ5KCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgdG1wLCBpZCkgeworCWlkcl9m
b3JfZWFjaF9lbnRyeSgmaTkxNS0+cGVyZi5tZXRyaWNzX2lkciwgdG1wLCBpZCkgewogCQlpZiAo
IXN0cmNtcCh0bXAtPnV1aWQsIG9hX2NvbmZpZy0+dXVpZCkpIHsKIAkJCURSTV9ERUJVRygiT0Eg
Y29uZmlnIGFscmVhZHkgZXhpc3RzIHdpdGggdGhpcyB1dWlkXG4iKTsKIAkJCWVyciA9IC1FQURE
UklOVVNFOwpAQCAtMzI3MiwxNCArMzI3MiwxNCBAQCBpbnQgaTkxNV9wZXJmX2FkZF9jb25maWdf
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJfQogCX0KIAotCWVy
ciA9IGNyZWF0ZV9keW5hbWljX29hX3N5c2ZzX2VudHJ5KGRldl9wcml2LCBvYV9jb25maWcpOwor
CWVyciA9IGNyZWF0ZV9keW5hbWljX29hX3N5c2ZzX2VudHJ5KGk5MTUsIG9hX2NvbmZpZyk7CiAJ
aWYgKGVycikgewogCQlEUk1fREVCVUcoIkZhaWxlZCB0byBjcmVhdGUgc3lzZnMgZW50cnkgZm9y
IE9BIGNvbmZpZ1xuIik7CiAJCWdvdG8gc3lzZnNfZXJyOwogCX0KIAogCS8qIENvbmZpZyBpZCAw
IGlzIGludmFsaWQsIGlkIDEgZm9yIGtlcm5lbCBzdG9yZWQgdGVzdCBjb25maWcuICovCi0Jb2Ff
Y29uZmlnLT5pZCA9IGlkcl9hbGxvYygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19pZHIsCisJb2Ff
Y29uZmlnLT5pZCA9IGlkcl9hbGxvYygmaTkxNS0+cGVyZi5tZXRyaWNzX2lkciwKIAkJCQkgIG9h
X2NvbmZpZywgMiwKIAkJCQkgIDAsIEdGUF9LRVJORUwpOwogCWlmIChvYV9jb25maWctPmlkIDwg
MCkgewpAQCAtMzI4OCwxNiArMzI4OCwxNiBAQCBpbnQgaTkxNV9wZXJmX2FkZF9jb25maWdfaW9j
dGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJZ290byBzeXNmc19lcnI7
CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOworCW11
dGV4X3VubG9jaygmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOwogCiAJRFJNX0RFQlVHKCJBZGRl
ZCBjb25maWcgJXMgaWQ9JWlcbiIsIG9hX2NvbmZpZy0+dXVpZCwgb2FfY29uZmlnLT5pZCk7CiAK
IAlyZXR1cm4gb2FfY29uZmlnLT5pZDsKIAogc3lzZnNfZXJyOgotCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKKwltdXRleF91bmxvY2soJmk5MTUtPnBlcmYubWV0
cmljc19sb2NrKTsKIHJlZ19lcnI6Ci0JcHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmln
KTsKKwlwdXRfb2FfY29uZmlnKGk5MTUsIG9hX2NvbmZpZyk7CiAJRFJNX0RFQlVHKCJGYWlsZWQg
dG8gYWRkIG5ldyBPQSBjb25maWdcbiIpOwogCXJldHVybiBlcnI7CiB9CkBAIC0zMzE2LDEyICsz
MzE2LDEyIEBAIGludCBpOTE1X3BlcmZfYWRkX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAogaW50IGk5MTVfcGVyZl9yZW1vdmVfY29uZmlnX2lvY3RsKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkJICBzdHJ1Y3QgZHJtX2ZpbGUg
KmZpbGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGV2LT5kZXZf
cHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRldi0+ZGV2X3ByaXZh
dGU7CiAJdTY0ICphcmcgPSBkYXRhOwogCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmln
OwogCWludCByZXQ7CiAKLQlpZiAoIWRldl9wcml2LT5wZXJmLmluaXRpYWxpemVkKSB7CisJaWYg
KCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKSB7CiAJCURSTV9ERUJVRygiaTkxNSBwZXJmIGludGVy
ZmFjZSBub3QgYXZhaWxhYmxlIGZvciB0aGlzIHN5c3RlbVxuIik7CiAJCXJldHVybiAtRU5PVFNV
UFA7CiAJfQpAQCAtMzMzMSwxMSArMzMzMSwxMSBAQCBpbnQgaTkxNV9wZXJmX3JlbW92ZV9jb25m
aWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJcmV0dXJuIC1F
QUNDRVM7CiAJfQogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+
cGVyZi5tZXRyaWNzX2xvY2spOworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkx
NS0+cGVyZi5tZXRyaWNzX2xvY2spOwogCWlmIChyZXQpCiAJCWdvdG8gbG9ja19lcnI7CiAKLQlv
YV9jb25maWcgPSBpZHJfZmluZCgmZGV2X3ByaXYtPnBlcmYubWV0cmljc19pZHIsICphcmcpOwor
CW9hX2NvbmZpZyA9IGlkcl9maW5kKCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCAqYXJnKTsKIAlp
ZiAoIW9hX2NvbmZpZykgewogCQlEUk1fREVCVUcoIkZhaWxlZCB0byByZW1vdmUgdW5rbm93biBP
QSBjb25maWdcbiIpOwogCQlyZXQgPSAtRU5PRU5UOwpAQCAtMzM0NCwxNyArMzM0NCwxNyBAQCBp
bnQgaTkxNV9wZXJmX3JlbW92ZV9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
dm9pZCAqZGF0YSwKIAogCUdFTV9CVUdfT04oKmFyZyAhPSBvYV9jb25maWctPmlkKTsKIAotCXN5
c2ZzX3JlbW92ZV9ncm91cChkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2tvYmosCisJc3lzZnNfcmVt
b3ZlX2dyb3VwKGk5MTUtPnBlcmYubWV0cmljc19rb2JqLAogCQkJICAgJm9hX2NvbmZpZy0+c3lz
ZnNfbWV0cmljKTsKIAotCWlkcl9yZW1vdmUoJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyLCAq
YXJnKTsKKwlpZHJfcmVtb3ZlKCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCAqYXJnKTsKIAogCURS
TV9ERUJVRygiUmVtb3ZlZCBjb25maWcgJXMgaWQ9JWlcbiIsIG9hX2NvbmZpZy0+dXVpZCwgb2Ff
Y29uZmlnLT5pZCk7CiAKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBvYV9jb25maWcpOworCXB1
dF9vYV9jb25maWcoaTkxNSwgb2FfY29uZmlnKTsKIAogY29uZmlnX2VycjoKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5w
ZXJmLm1ldHJpY3NfbG9jayk7CiBsb2NrX2VycjoKIAlyZXR1cm4gcmV0OwogfQpAQCAtMzQwMywx
MzUgKzM0MDMsMTM1IEBAIHN0YXRpYyBzdHJ1Y3QgY3RsX3RhYmxlIGRldl9yb290W10gPSB7CiAK
IC8qKgogICogaTkxNV9wZXJmX2luaXQgLSBpbml0aWFsaXplIGk5MTUtcGVyZiBzdGF0ZSBvbiBt
b2R1bGUgbG9hZAotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6
IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogSW5pdGlhbGl6ZXMgaTkxNS1wZXJmIHN0YXRl
IHdpdGhvdXQgZXhwb3NpbmcgYW55dGhpbmcgdG8gdXNlcnNwYWNlLgogICoKICAqIE5vdGU6IGk5
MTUtcGVyZiBpbml0aWFsaXphdGlvbiBpcyBzcGxpdCBpbnRvIGFuICdpbml0JyBhbmQgJ3JlZ2lz
dGVyJwogICogcGhhc2Ugd2l0aCB0aGUgaTkxNV9wZXJmX3JlZ2lzdGVyKCkgZXhwb3Npbmcgc3Rh
dGUgdG8gdXNlcnNwYWNlLgogICovCi12b2lkIGk5MTVfcGVyZl9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaTkxNV9wZXJmX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKSB7Ci0JCWRldl9w
cml2LT5wZXJmLm9hLm9wcy5pc192YWxpZF9iX2NvdW50ZXJfcmVnID0KKwlpZiAoSVNfSEFTV0VM
TChpOTE1KSkgeworCQlpOTE1LT5wZXJmLm9hLm9wcy5pc192YWxpZF9iX2NvdW50ZXJfcmVnID0K
IAkJCWdlbjdfaXNfdmFsaWRfYl9jb3VudGVyX2FkZHI7Ci0JCWRldl9wcml2LT5wZXJmLm9hLm9w
cy5pc192YWxpZF9tdXhfcmVnID0KKwkJaTkxNS0+cGVyZi5vYS5vcHMuaXNfdmFsaWRfbXV4X3Jl
ZyA9CiAJCQloc3dfaXNfdmFsaWRfbXV4X2FkZHI7Ci0JCWRldl9wcml2LT5wZXJmLm9hLm9wcy5p
c192YWxpZF9mbGV4X3JlZyA9IE5VTEw7Ci0JCWRldl9wcml2LT5wZXJmLm9hLm9wcy5lbmFibGVf
bWV0cmljX3NldCA9IGhzd19lbmFibGVfbWV0cmljX3NldDsKLQkJZGV2X3ByaXYtPnBlcmYub2Eu
b3BzLmRpc2FibGVfbWV0cmljX3NldCA9IGhzd19kaXNhYmxlX21ldHJpY19zZXQ7Ci0JCWRldl9w
cml2LT5wZXJmLm9hLm9wcy5vYV9lbmFibGUgPSBnZW43X29hX2VuYWJsZTsKLQkJZGV2X3ByaXYt
PnBlcmYub2Eub3BzLm9hX2Rpc2FibGUgPSBnZW43X29hX2Rpc2FibGU7Ci0JCWRldl9wcml2LT5w
ZXJmLm9hLm9wcy5yZWFkID0gZ2VuN19vYV9yZWFkOwotCQlkZXZfcHJpdi0+cGVyZi5vYS5vcHMu
b2FfaHdfdGFpbF9yZWFkID0KKwkJaTkxNS0+cGVyZi5vYS5vcHMuaXNfdmFsaWRfZmxleF9yZWcg
PSBOVUxMOworCQlpOTE1LT5wZXJmLm9hLm9wcy5lbmFibGVfbWV0cmljX3NldCA9IGhzd19lbmFi
bGVfbWV0cmljX3NldDsKKwkJaTkxNS0+cGVyZi5vYS5vcHMuZGlzYWJsZV9tZXRyaWNfc2V0ID0g
aHN3X2Rpc2FibGVfbWV0cmljX3NldDsKKwkJaTkxNS0+cGVyZi5vYS5vcHMub2FfZW5hYmxlID0g
Z2VuN19vYV9lbmFibGU7CisJCWk5MTUtPnBlcmYub2Eub3BzLm9hX2Rpc2FibGUgPSBnZW43X29h
X2Rpc2FibGU7CisJCWk5MTUtPnBlcmYub2Eub3BzLnJlYWQgPSBnZW43X29hX3JlYWQ7CisJCWk5
MTUtPnBlcmYub2Eub3BzLm9hX2h3X3RhaWxfcmVhZCA9CiAJCQlnZW43X29hX2h3X3RhaWxfcmVh
ZDsKIAotCQlkZXZfcHJpdi0+cGVyZi5vYS5vYV9mb3JtYXRzID0gaHN3X29hX2Zvcm1hdHM7Ci0J
fSBlbHNlIGlmIChIQVNfTE9HSUNBTF9SSU5HX0NPTlRFWFRTKGRldl9wcml2KSkgeworCQlpOTE1
LT5wZXJmLm9hLm9hX2Zvcm1hdHMgPSBoc3dfb2FfZm9ybWF0czsKKwl9IGVsc2UgaWYgKEhBU19M
T0dJQ0FMX1JJTkdfQ09OVEVYVFMoaTkxNSkpIHsKIAkJLyogTm90ZTogdGhhdCBhbHRob3VnaCB3
ZSBjb3VsZCB0aGVvcmV0aWNhbGx5IGFsc28gc3VwcG9ydCB0aGUKIAkJICogbGVnYWN5IHJpbmdi
dWZmZXIgbW9kZSBvbiBCRFcgKGFuZCBlYXJsaWVyIGl0ZXJhdGlvbnMgb2YKIAkJICogdGhpcyBk
cml2ZXIsIGJlZm9yZSB1cHN0cmVhbWluZyBkaWQgdGhpcykgaXQgZGlkbid0IHNlZW0KIAkJICog
d29ydGggdGhlIGNvbXBsZXhpdHkgdG8gbWFpbnRhaW4gbm93IHRoYXQgQkRXKyBlbmFibGUKIAkJ
ICogZXhlY2xpc3QgbW9kZSBieSBkZWZhdWx0LgogCQkgKi8KLQkJZGV2X3ByaXYtPnBlcmYub2Eu
b2FfZm9ybWF0cyA9IGdlbjhfcGx1c19vYV9mb3JtYXRzOworCQlpOTE1LT5wZXJmLm9hLm9hX2Zv
cm1hdHMgPSBnZW44X3BsdXNfb2FfZm9ybWF0czsKIAotCQlkZXZfcHJpdi0+cGVyZi5vYS5vcHMu
b2FfZW5hYmxlID0gZ2VuOF9vYV9lbmFibGU7Ci0JCWRldl9wcml2LT5wZXJmLm9hLm9wcy5vYV9k
aXNhYmxlID0gZ2VuOF9vYV9kaXNhYmxlOwotCQlkZXZfcHJpdi0+cGVyZi5vYS5vcHMucmVhZCA9
IGdlbjhfb2FfcmVhZDsKLQkJZGV2X3ByaXYtPnBlcmYub2Eub3BzLm9hX2h3X3RhaWxfcmVhZCA9
IGdlbjhfb2FfaHdfdGFpbF9yZWFkOworCQlpOTE1LT5wZXJmLm9hLm9wcy5vYV9lbmFibGUgPSBn
ZW44X29hX2VuYWJsZTsKKwkJaTkxNS0+cGVyZi5vYS5vcHMub2FfZGlzYWJsZSA9IGdlbjhfb2Ff
ZGlzYWJsZTsKKwkJaTkxNS0+cGVyZi5vYS5vcHMucmVhZCA9IGdlbjhfb2FfcmVhZDsKKwkJaTkx
NS0+cGVyZi5vYS5vcHMub2FfaHdfdGFpbF9yZWFkID0gZ2VuOF9vYV9od190YWlsX3JlYWQ7CiAK
LQkJaWYgKElTX0dFTl9SQU5HRShkZXZfcHJpdiwgOCwgOSkpIHsKLQkJCWRldl9wcml2LT5wZXJm
Lm9hLm9wcy5pc192YWxpZF9iX2NvdW50ZXJfcmVnID0KKwkJaWYgKElTX0dFTl9SQU5HRShpOTE1
LCA4LCA5KSkgeworCQkJaTkxNS0+cGVyZi5vYS5vcHMuaXNfdmFsaWRfYl9jb3VudGVyX3JlZyA9
CiAJCQkJZ2VuN19pc192YWxpZF9iX2NvdW50ZXJfYWRkcjsKLQkJCWRldl9wcml2LT5wZXJmLm9h
Lm9wcy5pc192YWxpZF9tdXhfcmVnID0KKwkJCWk5MTUtPnBlcmYub2Eub3BzLmlzX3ZhbGlkX211
eF9yZWcgPQogCQkJCWdlbjhfaXNfdmFsaWRfbXV4X2FkZHI7Ci0JCQlkZXZfcHJpdi0+cGVyZi5v
YS5vcHMuaXNfdmFsaWRfZmxleF9yZWcgPQorCQkJaTkxNS0+cGVyZi5vYS5vcHMuaXNfdmFsaWRf
ZmxleF9yZWcgPQogCQkJCWdlbjhfaXNfdmFsaWRfZmxleF9hZGRyOwogCi0JCQlpZiAoSVNfQ0hF
UlJZVklFVyhkZXZfcHJpdikpIHsKLQkJCQlkZXZfcHJpdi0+cGVyZi5vYS5vcHMuaXNfdmFsaWRf
bXV4X3JlZyA9CisJCQlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkgeworCQkJCWk5MTUtPnBlcmYu
b2Eub3BzLmlzX3ZhbGlkX211eF9yZWcgPQogCQkJCQljaHZfaXNfdmFsaWRfbXV4X2FkZHI7CiAJ
CQl9CiAKLQkJCWRldl9wcml2LT5wZXJmLm9hLm9wcy5lbmFibGVfbWV0cmljX3NldCA9IGdlbjhf
ZW5hYmxlX21ldHJpY19zZXQ7Ci0JCQlkZXZfcHJpdi0+cGVyZi5vYS5vcHMuZGlzYWJsZV9tZXRy
aWNfc2V0ID0gZ2VuOF9kaXNhYmxlX21ldHJpY19zZXQ7CisJCQlpOTE1LT5wZXJmLm9hLm9wcy5l
bmFibGVfbWV0cmljX3NldCA9IGdlbjhfZW5hYmxlX21ldHJpY19zZXQ7CisJCQlpOTE1LT5wZXJm
Lm9hLm9wcy5kaXNhYmxlX21ldHJpY19zZXQgPSBnZW44X2Rpc2FibGVfbWV0cmljX3NldDsKIAot
CQkJaWYgKElTX0dFTihkZXZfcHJpdiwgOCkpIHsKLQkJCQlkZXZfcHJpdi0+cGVyZi5vYS5jdHhf
b2FjdHhjdHJsX29mZnNldCA9IDB4MTIwOwotCQkJCWRldl9wcml2LT5wZXJmLm9hLmN0eF9mbGV4
ZXUwX29mZnNldCA9IDB4MmNlOworCQkJaWYgKElTX0dFTihpOTE1LCA4KSkgeworCQkJCWk5MTUt
PnBlcmYub2EuY3R4X29hY3R4Y3RybF9vZmZzZXQgPSAweDEyMDsKKwkJCQlpOTE1LT5wZXJmLm9h
LmN0eF9mbGV4ZXUwX29mZnNldCA9IDB4MmNlOwogCi0JCQkJZGV2X3ByaXYtPnBlcmYub2EuZ2Vu
OF92YWxpZF9jdHhfYml0ID0gKDE8PDI1KTsKKwkJCQlpOTE1LT5wZXJmLm9hLmdlbjhfdmFsaWRf
Y3R4X2JpdCA9ICgxPDwyNSk7CiAJCQl9IGVsc2UgewotCQkJCWRldl9wcml2LT5wZXJmLm9hLmN0
eF9vYWN0eGN0cmxfb2Zmc2V0ID0gMHgxMjg7Ci0JCQkJZGV2X3ByaXYtPnBlcmYub2EuY3R4X2Zs
ZXhldTBfb2Zmc2V0ID0gMHgzZGU7CisJCQkJaTkxNS0+cGVyZi5vYS5jdHhfb2FjdHhjdHJsX29m
ZnNldCA9IDB4MTI4OworCQkJCWk5MTUtPnBlcmYub2EuY3R4X2ZsZXhldTBfb2Zmc2V0ID0gMHgz
ZGU7CiAKLQkJCQlkZXZfcHJpdi0+cGVyZi5vYS5nZW44X3ZhbGlkX2N0eF9iaXQgPSAoMTw8MTYp
OworCQkJCWk5MTUtPnBlcmYub2EuZ2VuOF92YWxpZF9jdHhfYml0ID0gKDE8PDE2KTsKIAkJCX0K
LQkJfSBlbHNlIGlmIChJU19HRU5fUkFOR0UoZGV2X3ByaXYsIDEwLCAxMSkpIHsKLQkJCWRldl9w
cml2LT5wZXJmLm9hLm9wcy5pc192YWxpZF9iX2NvdW50ZXJfcmVnID0KKwkJfSBlbHNlIGlmIChJ
U19HRU5fUkFOR0UoaTkxNSwgMTAsIDExKSkgeworCQkJaTkxNS0+cGVyZi5vYS5vcHMuaXNfdmFs
aWRfYl9jb3VudGVyX3JlZyA9CiAJCQkJZ2VuN19pc192YWxpZF9iX2NvdW50ZXJfYWRkcjsKLQkJ
CWRldl9wcml2LT5wZXJmLm9hLm9wcy5pc192YWxpZF9tdXhfcmVnID0KKwkJCWk5MTUtPnBlcmYu
b2Eub3BzLmlzX3ZhbGlkX211eF9yZWcgPQogCQkJCWdlbjEwX2lzX3ZhbGlkX211eF9hZGRyOwot
CQkJZGV2X3ByaXYtPnBlcmYub2Eub3BzLmlzX3ZhbGlkX2ZsZXhfcmVnID0KKwkJCWk5MTUtPnBl
cmYub2Eub3BzLmlzX3ZhbGlkX2ZsZXhfcmVnID0KIAkJCQlnZW44X2lzX3ZhbGlkX2ZsZXhfYWRk
cjsKIAotCQkJZGV2X3ByaXYtPnBlcmYub2Eub3BzLmVuYWJsZV9tZXRyaWNfc2V0ID0gZ2VuOF9l
bmFibGVfbWV0cmljX3NldDsKLQkJCWRldl9wcml2LT5wZXJmLm9hLm9wcy5kaXNhYmxlX21ldHJp
Y19zZXQgPSBnZW4xMF9kaXNhYmxlX21ldHJpY19zZXQ7CisJCQlpOTE1LT5wZXJmLm9hLm9wcy5l
bmFibGVfbWV0cmljX3NldCA9IGdlbjhfZW5hYmxlX21ldHJpY19zZXQ7CisJCQlpOTE1LT5wZXJm
Lm9hLm9wcy5kaXNhYmxlX21ldHJpY19zZXQgPSBnZW4xMF9kaXNhYmxlX21ldHJpY19zZXQ7CiAK
LQkJCWRldl9wcml2LT5wZXJmLm9hLmN0eF9vYWN0eGN0cmxfb2Zmc2V0ID0gMHgxMjg7Ci0JCQlk
ZXZfcHJpdi0+cGVyZi5vYS5jdHhfZmxleGV1MF9vZmZzZXQgPSAweDNkZTsKKwkJCWk5MTUtPnBl
cmYub2EuY3R4X29hY3R4Y3RybF9vZmZzZXQgPSAweDEyODsKKwkJCWk5MTUtPnBlcmYub2EuY3R4
X2ZsZXhldTBfb2Zmc2V0ID0gMHgzZGU7CiAKLQkJCWRldl9wcml2LT5wZXJmLm9hLmdlbjhfdmFs
aWRfY3R4X2JpdCA9ICgxPDwxNik7CisJCQlpOTE1LT5wZXJmLm9hLmdlbjhfdmFsaWRfY3R4X2Jp
dCA9ICgxPDwxNik7CiAJCX0KIAl9CiAKLQlpZiAoZGV2X3ByaXYtPnBlcmYub2Eub3BzLmVuYWJs
ZV9tZXRyaWNfc2V0KSB7Ci0JCWhydGltZXJfaW5pdCgmZGV2X3ByaXYtPnBlcmYub2EucG9sbF9j
aGVja190aW1lciwKKwlpZiAoaTkxNS0+cGVyZi5vYS5vcHMuZW5hYmxlX21ldHJpY19zZXQpIHsK
KwkJaHJ0aW1lcl9pbml0KCZpOTE1LT5wZXJmLm9hLnBvbGxfY2hlY2tfdGltZXIsCiAJCQkJQ0xP
Q0tfTU9OT1RPTklDLCBIUlRJTUVSX01PREVfUkVMKTsKLQkJZGV2X3ByaXYtPnBlcmYub2EucG9s
bF9jaGVja190aW1lci5mdW5jdGlvbiA9IG9hX3BvbGxfY2hlY2tfdGltZXJfY2I7Ci0JCWluaXRf
d2FpdHF1ZXVlX2hlYWQoJmRldl9wcml2LT5wZXJmLm9hLnBvbGxfd3EpOworCQlpOTE1LT5wZXJm
Lm9hLnBvbGxfY2hlY2tfdGltZXIuZnVuY3Rpb24gPSBvYV9wb2xsX2NoZWNrX3RpbWVyX2NiOwor
CQlpbml0X3dhaXRxdWV1ZV9oZWFkKCZpOTE1LT5wZXJmLm9hLnBvbGxfd3EpOwogCi0JCUlOSVRf
TElTVF9IRUFEKCZkZXZfcHJpdi0+cGVyZi5zdHJlYW1zKTsKLQkJbXV0ZXhfaW5pdCgmZGV2X3By
aXYtPnBlcmYubG9jayk7Ci0JCXNwaW5fbG9ja19pbml0KCZkZXZfcHJpdi0+cGVyZi5vYS5vYV9i
dWZmZXIucHRyX2xvY2spOworCQlJTklUX0xJU1RfSEVBRCgmaTkxNS0+cGVyZi5zdHJlYW1zKTsK
KwkJbXV0ZXhfaW5pdCgmaTkxNS0+cGVyZi5sb2NrKTsKKwkJc3Bpbl9sb2NrX2luaXQoJmk5MTUt
PnBlcmYub2Eub2FfYnVmZmVyLnB0cl9sb2NrKTsKIAogCQlvYV9zYW1wbGVfcmF0ZV9oYXJkX2xp
bWl0ID0gMTAwMCAqCi0JCQkoUlVOVElNRV9JTkZPKGRldl9wcml2KS0+Y3NfdGltZXN0YW1wX2Zy
ZXF1ZW5jeV9raHogLyAyKTsKLQkJZGV2X3ByaXYtPnBlcmYuc3lzY3RsX2hlYWRlciA9IHJlZ2lz
dGVyX3N5c2N0bF90YWJsZShkZXZfcm9vdCk7CisJCQkoUlVOVElNRV9JTkZPKGk5MTUpLT5jc190
aW1lc3RhbXBfZnJlcXVlbmN5X2toeiAvIDIpOworCQlpOTE1LT5wZXJmLnN5c2N0bF9oZWFkZXIg
PSByZWdpc3Rlcl9zeXNjdGxfdGFibGUoZGV2X3Jvb3QpOwogCi0JCW11dGV4X2luaXQoJmRldl9w
cml2LT5wZXJmLm1ldHJpY3NfbG9jayk7Ci0JCWlkcl9pbml0KCZkZXZfcHJpdi0+cGVyZi5tZXRy
aWNzX2lkcik7CisJCW11dGV4X2luaXQoJmk5MTUtPnBlcmYubWV0cmljc19sb2NrKTsKKwkJaWRy
X2luaXQoJmk5MTUtPnBlcmYubWV0cmljc19pZHIpOwogCi0JCWRldl9wcml2LT5wZXJmLmluaXRp
YWxpemVkID0gdHJ1ZTsKKwkJaTkxNS0+cGVyZi5pbml0aWFsaXplZCA9IHRydWU7CiAJfQogfQog
CiBzdGF0aWMgaW50IGRlc3Ryb3lfY29uZmlnKGludCBpZCwgdm9pZCAqcCwgdm9pZCAqZGF0YSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkYXRhOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKIAlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9h
X2NvbmZpZyA9IHA7CiAKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBvYV9jb25maWcpOworCXB1
dF9vYV9jb25maWcoaTkxNSwgb2FfY29uZmlnKTsKIAogCXJldHVybiAwOwogfQogCiAvKioKICAq
IGk5MTVfcGVyZl9maW5pIC0gQ291bnRlciBwYXJ0IHRvIGk5MTVfcGVyZl9pbml0KCkKLSAqIEBk
ZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0
YW5jZQogICovCi12b2lkIGk5MTVfcGVyZl9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3ZvaWQgaTkxNV9wZXJmX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7Ci0JaWYgKCFkZXZfcHJpdi0+cGVyZi5pbml0aWFsaXplZCkKKwlpZiAoIWk5MTUtPnBl
cmYuaW5pdGlhbGl6ZWQpCiAJCXJldHVybjsKIAotCWlkcl9mb3JfZWFjaCgmZGV2X3ByaXYtPnBl
cmYubWV0cmljc19pZHIsIGRlc3Ryb3lfY29uZmlnLCBkZXZfcHJpdik7Ci0JaWRyX2Rlc3Ryb3ko
JmRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyKTsKKwlpZHJfZm9yX2VhY2goJmk5MTUtPnBlcmYu
bWV0cmljc19pZHIsIGRlc3Ryb3lfY29uZmlnLCBpOTE1KTsKKwlpZHJfZGVzdHJveSgmaTkxNS0+
cGVyZi5tZXRyaWNzX2lkcik7CiAKLQl1bnJlZ2lzdGVyX3N5c2N0bF90YWJsZShkZXZfcHJpdi0+
cGVyZi5zeXNjdGxfaGVhZGVyKTsKKwl1bnJlZ2lzdGVyX3N5c2N0bF90YWJsZShpOTE1LT5wZXJm
LnN5c2N0bF9oZWFkZXIpOwogCi0JbWVtc2V0KCZkZXZfcHJpdi0+cGVyZi5vYS5vcHMsIDAsIHNp
emVvZihkZXZfcHJpdi0+cGVyZi5vYS5vcHMpKTsKKwltZW1zZXQoJmk5MTUtPnBlcmYub2Eub3Bz
LCAwLCBzaXplb2YoaTkxNS0+cGVyZi5vYS5vcHMpKTsKIAotCWRldl9wcml2LT5wZXJmLmluaXRp
YWxpemVkID0gZmFsc2U7CisJaTkxNS0+cGVyZi5pbml0aWFsaXplZCA9IGZhbHNlOwogfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcG11LmMKaW5kZXggZWI5YzBlMGU1NDVjLi5jNDg2MWMxMjEwMGMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wbXUuYwpAQCAtMTU5LDI0ICsxNTksMjQgQEAgYWRkX3NhbXBsZShzdHJ1
Y3QgaTkxNV9wbXVfc2FtcGxlICpzYW1wbGUsIHUzMiB2YWwpCiB9CiAKIHN0YXRpYyB2b2lkCi1l
bmdpbmVzX3NhbXBsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHVuc2lnbmVk
IGludCBwZXJpb2RfbnMpCitlbmdpbmVzX3NhbXBsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwgdW5zaWduZWQgaW50IHBlcmlvZF9ucykKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50ZWxfd2FrZXJlZl90IHdh
a2VyZWY7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAotCWlmICgoZGV2X3ByaXYtPnBtdS5lbmFi
bGUgJiBFTkdJTkVfU0FNUExFX01BU0spID09IDApCisJaWYgKChpOTE1LT5wbXUuZW5hYmxlICYg
RU5HSU5FX1NBTVBMRV9NQVNLKSA9PSAwKQogCQlyZXR1cm47CiAKIAl3YWtlcmVmID0gMDsKLQlp
ZiAoUkVBRF9PTkNFKGRldl9wcml2LT5ndC5hd2FrZSkpCi0JCXdha2VyZWYgPSBpbnRlbF9ydW50
aW1lX3BtX2dldF9pZl9pbl91c2UoZGV2X3ByaXYpOworCWlmIChSRUFEX09OQ0UoaTkxNS0+Z3Qu
YXdha2UpKQorCQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXRfaWZfaW5fdXNlKGk5MTUp
OwogCWlmICghd2FrZXJlZikKIAkJcmV0dXJuOwogCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9w
cml2LT51bmNvcmUubG9jaywgZmxhZ3MpOwotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9w
cml2LCBpZCkgeworCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT51bmNvcmUubG9jaywgZmxhZ3Mp
OworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXN0cnVjdCBpbnRlbF9l
bmdpbmVfcG11ICpwbXUgPSAmZW5naW5lLT5wbXU7CiAJCWJvb2wgYnVzeTsKIAkJdTMyIHZhbDsK
QEAgLTIwNSw5ICsyMDUsOSBAQCBlbmdpbmVzX3NhbXBsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIHVuc2lnbmVkIGludCBwZXJpb2RfbnMpCiAJCWlmIChidXN5KQogCQkJYWRk
X3NhbXBsZSgmcG11LT5zYW1wbGVbSTkxNV9TQU1QTEVfQlVTWV0sIHBlcmlvZF9ucyk7CiAJfQot
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgZmxhZ3MpOwor
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPnVuY29yZS5sb2NrLCBmbGFncyk7CiAKLQlp
bnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7CisJaW50ZWxfcnVudGltZV9w
bV9wdXQoaTkxNSwgd2FrZXJlZik7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC0yMTcsMzMgKzIxNywz
MyBAQCBhZGRfc2FtcGxlX211bHQoc3RydWN0IGk5MTVfcG11X3NhbXBsZSAqc2FtcGxlLCB1MzIg
dmFsLCB1MzIgbXVsKQogfQogCiBzdGF0aWMgdm9pZAotZnJlcXVlbmN5X3NhbXBsZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHVuc2lnbmVkIGludCBwZXJpb2RfbnMpCitmcmVx
dWVuY3lfc2FtcGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1bnNpZ25lZCBpbnQg
cGVyaW9kX25zKQogewotCWlmIChkZXZfcHJpdi0+cG11LmVuYWJsZSAmCisJaWYgKGk5MTUtPnBt
dS5lbmFibGUgJgogCSAgICBjb25maWdfZW5hYmxlZF9tYXNrKEk5MTVfUE1VX0FDVFVBTF9GUkVR
VUVOQ1kpKSB7CiAJCXUzMiB2YWw7CiAKLQkJdmFsID0gZGV2X3ByaXYtPmd0X3BtLnJwcy5jdXJf
ZnJlcTsKLQkJaWYgKGRldl9wcml2LT5ndC5hd2FrZSkgeworCQl2YWwgPSBpOTE1LT5ndF9wbS5y
cHMuY3VyX2ZyZXE7CisJCWlmIChpOTE1LT5ndC5hd2FrZSkgewogCQkJaW50ZWxfd2FrZXJlZl90
IHdha2VyZWY7CiAKLQkJCXdpdGhfaW50ZWxfcnVudGltZV9wbV9pZl9pbl91c2UoZGV2X3ByaXYs
IHdha2VyZWYpIHsKLQkJCQl2YWwgPSBpbnRlbF91bmNvcmVfcmVhZF9ub3RyYWNlKCZkZXZfcHJp
di0+dW5jb3JlLAorCQkJd2l0aF9pbnRlbF9ydW50aW1lX3BtX2lmX2luX3VzZShpOTE1LCB3YWtl
cmVmKSB7CisJCQkJdmFsID0gaW50ZWxfdW5jb3JlX3JlYWRfbm90cmFjZSgmaTkxNS0+dW5jb3Jl
LAogCQkJCQkJCQlHRU42X1JQU1RBVDEpOwotCQkJCXZhbCA9IGludGVsX2dldF9jYWdmKGRldl9w
cml2LCB2YWwpOworCQkJCXZhbCA9IGludGVsX2dldF9jYWdmKGk5MTUsIHZhbCk7CiAJCQl9CiAJ
CX0KIAotCQlhZGRfc2FtcGxlX211bHQoJmRldl9wcml2LT5wbXUuc2FtcGxlW19fSTkxNV9TQU1Q
TEVfRlJFUV9BQ1RdLAotCQkJCWludGVsX2dwdV9mcmVxKGRldl9wcml2LCB2YWwpLAorCQlhZGRf
c2FtcGxlX211bHQoJmk5MTUtPnBtdS5zYW1wbGVbX19JOTE1X1NBTVBMRV9GUkVRX0FDVF0sCisJ
CQkJaW50ZWxfZ3B1X2ZyZXEoaTkxNSwgdmFsKSwKIAkJCQlwZXJpb2RfbnMgLyAxMDAwKTsKIAl9
CiAKLQlpZiAoZGV2X3ByaXYtPnBtdS5lbmFibGUgJgorCWlmIChpOTE1LT5wbXUuZW5hYmxlICYK
IAkgICAgY29uZmlnX2VuYWJsZWRfbWFzayhJOTE1X1BNVV9SRVFVRVNURURfRlJFUVVFTkNZKSkg
ewotCQlhZGRfc2FtcGxlX211bHQoJmRldl9wcml2LT5wbXUuc2FtcGxlW19fSTkxNV9TQU1QTEVf
RlJFUV9SRVFdLAotCQkJCWludGVsX2dwdV9mcmVxKGRldl9wcml2LAotCQkJCQkgICAgICAgZGV2
X3ByaXYtPmd0X3BtLnJwcy5jdXJfZnJlcSksCisJCWFkZF9zYW1wbGVfbXVsdCgmaTkxNS0+cG11
LnNhbXBsZVtfX0k5MTVfU0FNUExFX0ZSRVFfUkVRXSwKKwkJCQlpbnRlbF9ncHVfZnJlcShpOTE1
LAorCQkJCQkgICAgICAgaTkxNS0+Z3RfcG0ucnBzLmN1cl9mcmVxKSwKIAkJCQlwZXJpb2RfbnMg
LyAxMDAwKTsKIAl9CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1
ZXJ5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKaW5kZXggN2I3MDE2MTcx
MDU3Li44NzYwNjM2MmI1NmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cXVlcnkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKQEAgLTMxLDEw
ICszMSwxMCBAQCBzdGF0aWMgaW50IGNvcHlfcXVlcnlfaXRlbSh2b2lkICpxdWVyeV9oZHIsIHNp
emVfdCBxdWVyeV9zeiwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBxdWVyeV90b3BvbG9n
eV9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBpbnQgcXVl
cnlfdG9wb2xvZ3lfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAg
ICBzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRlbSkKIHsKLQljb25zdCBzdHJ1
Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSA9ICZSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5zc2V1Owor
CWNvbnN0IHN0cnVjdCBzc2V1X2Rldl9pbmZvICpzc2V1ID0gJlJVTlRJTUVfSU5GTyhpOTE1KS0+
c3NldTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfdG9wb2xvZ3lfaW5mbyB0b3BvOwogCXUzMiBz
bGljZV9sZW5ndGgsIHN1YnNsaWNlX2xlbmd0aCwgZXVfbGVuZ3RoLCB0b3RhbF9sZW5ndGg7CiAJ
dTggc3Vic2xpY2Vfc3RyaWRlID0gR0VOX1NTRVVfU1RSSURFKHNzZXUtPm1heF9zdWJzbGljZXMp
OwpAQCAtMTQzLDcgKzE0Myw3IEBAIHF1ZXJ5X2VuZ2luZV9pbmZvKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCXJldHVybiBsZW47CiB9CiAKLXN0YXRpYyBpbnQgKCogY29uc3QgaTkx
NV9xdWVyeV9mdW5jc1tdKShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgaW50ICgqIGNvbnN0IGk5MTVfcXVlcnlfZnVuY3NbXSkoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJCXN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVtICpxdWVyeV9pdGVtKSA9
IHsKIAlxdWVyeV90b3BvbG9neV9pbmZvLAogCXF1ZXJ5X2VuZ2luZV9pbmZvLApAQCAtMTUxLDcg
KzE1MSw3IEBAIHN0YXRpYyBpbnQgKCogY29uc3QgaTkxNV9xdWVyeV9mdW5jc1tdKShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIGludCBpOTE1X3F1ZXJ5X2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9p
OTE1X3F1ZXJ5ICphcmdzID0gZGF0YTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSBfX3Vz
ZXIgKnVzZXJfaXRlbV9wdHIgPQogCQl1NjRfdG9fdXNlcl9wdHIoYXJncy0+aXRlbXNfcHRyKTsK
QEAgLTE4MCw3ICsxODAsNyBAQCBpbnQgaTkxNV9xdWVyeV9pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJCWlmIChmdW5jX2lk
eCA8IEFSUkFZX1NJWkUoaTkxNV9xdWVyeV9mdW5jcykpIHsKIAkJCWZ1bmNfaWR4ID0gYXJyYXlf
aW5kZXhfbm9zcGVjKGZ1bmNfaWR4LAogCQkJCQkJICAgICAgQVJSQVlfU0laRShpOTE1X3F1ZXJ5
X2Z1bmNzKSk7Ci0JCQlyZXQgPSBpOTE1X3F1ZXJ5X2Z1bmNzW2Z1bmNfaWR4XShkZXZfcHJpdiwg
Jml0ZW0pOworCQkJcmV0ID0gaTkxNV9xdWVyeV9mdW5jc1tmdW5jX2lkeF0oaTkxNSwgJml0ZW0p
OwogCQl9CiAKIAkJLyogT25seSB3cml0ZSB0aGUgbGVuZ3RoIGJhY2sgdG8gdXNlcnNwYWNlIGlm
IHRoZXkgZGlmZmVyLiAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZWcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKaW5kZXggZWRmOWY5MzkzNGEx
Li5iNTIyOTcwYmRmNzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVn
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaApAQCAtMjA1LDcgKzIwNSw3
IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X21taW9fcmVnX3ZhbGlkKGk5MTVfcmVnX3QgcmVn
KQogI2RlZmluZSBWTFZfTUlQSV9CQVNFCQkJVkxWX0RJU1BMQVlfQkFTRQogI2RlZmluZSBCWFRf
TUlQSV9CQVNFCQkJMHg2MDAwMAogCi0jZGVmaW5lIERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2
KQkoSU5URUxfSU5GTyhkZXZfcHJpdiktPmRpc3BsYXlfbW1pb19vZmZzZXQpCisjZGVmaW5lIERJ
U1BMQVlfTU1JT19CQVNFKGk5MTUpCShJTlRFTF9JTkZPKGk5MTUpLT5kaXNwbGF5X21taW9fb2Zm
c2V0KQogCiAvKgogICogR2l2ZW4gdGhlIGZpcnN0IHR3byBudW1iZXJzIF9fYSBhbmQgX19iIG9m
IGFyYml0cmFyaWx5IG1hbnkgZXZlbmx5IHNwYWNlZApAQCAtMjQ3LDE1ICsyNDcsMTUgQEAgc3Rh
dGljIGlubGluZSBib29sIGk5MTVfbW1pb19yZWdfdmFsaWQoaTkxNV9yZWdfdCByZWcpCiAgKiBE
ZXZpY2UgaW5mbyBvZmZzZXQgYXJyYXkgYmFzZWQgaGVscGVycyBmb3IgZ3JvdXBzIG9mIHJlZ2lz
dGVycyB3aXRoIHVuZXZlbmx5CiAgKiBzcGFjZWQgYmFzZSBvZmZzZXRzLgogICovCi0jZGVmaW5l
IF9NTUlPX1BJUEUyKHBpcGUsIHJlZykJCV9NTUlPKElOVEVMX0lORk8oZGV2X3ByaXYpLT5waXBl
X29mZnNldHNbcGlwZV0gLSBcCi0JCQkJCSAgICAgIElOVEVMX0lORk8oZGV2X3ByaXYpLT5waXBl
X29mZnNldHNbUElQRV9BXSArIChyZWcpICsgXAotCQkJCQkgICAgICBESVNQTEFZX01NSU9fQkFT
RShkZXZfcHJpdikpCi0jZGVmaW5lIF9NTUlPX1RSQU5TMihwaXBlLCByZWcpCQlfTU1JTyhJTlRF
TF9JTkZPKGRldl9wcml2KS0+dHJhbnNfb2Zmc2V0c1socGlwZSldIC0gXAotCQkJCQkgICAgICBJ
TlRFTF9JTkZPKGRldl9wcml2KS0+dHJhbnNfb2Zmc2V0c1tUUkFOU0NPREVSX0FdICsgKHJlZykg
KyBcCi0JCQkJCSAgICAgIERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSkKLSNkZWZpbmUgX0NV
UlNPUjIocGlwZSwgcmVnKQkJX01NSU8oSU5URUxfSU5GTyhkZXZfcHJpdiktPmN1cnNvcl9vZmZz
ZXRzWyhwaXBlKV0gLSBcCi0JCQkJCSAgICAgIElOVEVMX0lORk8oZGV2X3ByaXYpLT5jdXJzb3Jf
b2Zmc2V0c1tQSVBFX0FdICsgKHJlZykgKyBcCi0JCQkJCSAgICAgIERJU1BMQVlfTU1JT19CQVNF
KGRldl9wcml2KSkKKyNkZWZpbmUgX01NSU9fUElQRTIocGlwZSwgcmVnKQkJX01NSU8oSU5URUxf
SU5GTyhpOTE1KS0+cGlwZV9vZmZzZXRzW3BpcGVdIC0gXAorCQkJCQkgICAgICBJTlRFTF9JTkZP
KGk5MTUpLT5waXBlX29mZnNldHNbUElQRV9BXSArIChyZWcpICsgXAorCQkJCQkgICAgICBESVNQ
TEFZX01NSU9fQkFTRShpOTE1KSkKKyNkZWZpbmUgX01NSU9fVFJBTlMyKHBpcGUsIHJlZykJCV9N
TUlPKElOVEVMX0lORk8oaTkxNSktPnRyYW5zX29mZnNldHNbKHBpcGUpXSAtIFwKKwkJCQkJICAg
ICAgSU5URUxfSU5GTyhpOTE1KS0+dHJhbnNfb2Zmc2V0c1tUUkFOU0NPREVSX0FdICsgKHJlZykg
KyBcCisJCQkJCSAgICAgIERJU1BMQVlfTU1JT19CQVNFKGk5MTUpKQorI2RlZmluZSBfQ1VSU09S
MihwaXBlLCByZWcpCQlfTU1JTyhJTlRFTF9JTkZPKGk5MTUpLT5jdXJzb3Jfb2Zmc2V0c1socGlw
ZSldIC0gXAorCQkJCQkgICAgICBJTlRFTF9JTkZPKGk5MTUpLT5jdXJzb3Jfb2Zmc2V0c1tQSVBF
X0FdICsgKHJlZykgKyBcCisJCQkJCSAgICAgIERJU1BMQVlfTU1JT19CQVNFKGk5MTUpKQogCiAj
ZGVmaW5lIF9fTUFTS0VEX0ZJRUxEKG1hc2ssIHZhbHVlKSAoKG1hc2spIDw8IDE2IHwgKHZhbHVl
KSkKICNkZWZpbmUgX01BU0tFRF9GSUVMRChtYXNrLCB2YWx1ZSkgKHsJCQkJCSAgIFwKQEAgLTEz
MDcsNyArMTMwNyw3IEBAIGVudW0gaTkxNV9wb3dlcl93ZWxsX2lkIHsKICNkZWZpbmUgIERQSU9f
Q01OUlNUCQkJKDEgPDwgMCkKIAogI2RlZmluZSBEUElPX1BIWShwaXBlKQkJCSgocGlwZSkgPj4g
MSkKLSNkZWZpbmUgRFBJT19QSFlfSU9TRl9QT1JUKHBoeSkJCShkZXZfcHJpdi0+ZHBpb19waHlf
aW9zZl9wb3J0W3BoeV0pCisjZGVmaW5lIERQSU9fUEhZX0lPU0ZfUE9SVChwaHkpCQkoaTkxNS0+
ZHBpb19waHlfaW9zZl9wb3J0W3BoeV0pCiAKIC8qCiAgKiBQZXIgcGlwZS9QTEwgRFBJTyByZWdz
CkBAIC0zMDA0LDkgKzMwMDQsOSBAQCBlbnVtIGk5MTVfcG93ZXJfd2VsbF9pZCB7CiAjZGVmaW5l
IFBNX1ZFQk9YX0NTX0VSUk9SX0lOVEVSUlVQVAkJKDEgPDwgMTIpIC8qIGhzdysgKi8KICNkZWZp
bmUgUE1fVkVCT1hfVVNFUl9JTlRFUlJVUFQJCQkoMSA8PCAxMCkgLyogaHN3KyAqLwogCi0jZGVm
aW5lIEdUX1BBUklUWV9FUlJPUihkZXZfcHJpdikgXAorI2RlZmluZSBHVF9QQVJJVFlfRVJST1Io
aTkxNSkgXAogCShHVF9SRU5ERVJfTDNfUEFSSVRZX0VSUk9SX0lOVEVSUlVQVCB8IFwKLQkgKElT
X0hBU1dFTEwoZGV2X3ByaXYpID8gR1RfUkVOREVSX0wzX1BBUklUWV9FUlJPUl9JTlRFUlJVUFRf
UzEgOiAwKSkKKwkgKElTX0hBU1dFTEwoaTkxNSkgPyBHVF9SRU5ERVJfTDNfUEFSSVRZX0VSUk9S
X0lOVEVSUlVQVF9TMSA6IDApKQogCiAvKiBUaGVzZSBhcmUgYWxsIHRoZSAib2xkIiBpbnRlcnJ1
cHRzICovCiAjZGVmaW5lIElMS19CU0RfVVNFUl9JTlRFUlJVUFQJCQkJKDEgPDwgNSkKQEAgLTMx
OTUsNyArMzE5NSw3IEBAIGVudW0gaTkxNV9wb3dlcl93ZWxsX2lkIHsKIC8qCiAgKiBHUElPIHJl
Z3MKICAqLwotI2RlZmluZSBHUElPKGdwaW8pCQlfTU1JTyhkZXZfcHJpdi0+Z3Bpb19tbWlvX2Jh
c2UgKyAweDUwMTAgKyBcCisjZGVmaW5lIEdQSU8oZ3BpbykJCV9NTUlPKGk5MTUtPmdwaW9fbW1p
b19iYXNlICsgMHg1MDEwICsgXAogCQkJCSAgICAgIDQgKiAoZ3BpbykpCiAKICMgZGVmaW5lIEdQ
SU9fQ0xPQ0tfRElSX01BU0sJCSgxIDw8IDApCkBAIC0zMjEzLDcgKzMyMTMsNyBAQCBlbnVtIGk5
MTVfcG93ZXJfd2VsbF9pZCB7CiAjIGRlZmluZSBHUElPX0RBVEFfVkFMX0lOCQkoMSA8PCAxMikK
ICMgZGVmaW5lIEdQSU9fREFUQV9QVUxMVVBfRElTQUJMRQkoMSA8PCAxMykKIAotI2RlZmluZSBH
TUJVUzAJCQlfTU1JTyhkZXZfcHJpdi0+Z3Bpb19tbWlvX2Jhc2UgKyAweDUxMDApIC8qIGNsb2Nr
L3BvcnQgc2VsZWN0ICovCisjZGVmaW5lIEdNQlVTMAkJCV9NTUlPKGk5MTUtPmdwaW9fbW1pb19i
YXNlICsgMHg1MTAwKSAvKiBjbG9jay9wb3J0IHNlbGVjdCAqLwogI2RlZmluZSAgIEdNQlVTX0FL
U1ZfU0VMRUNUCSgxIDw8IDExKQogI2RlZmluZSAgIEdNQlVTX1JBVEVfMTAwS0haCSgwIDw8IDgp
CiAjZGVmaW5lICAgR01CVVNfUkFURV81MEtIWgkoMSA8PCA4KQpAQCAtMzI0MCw3ICszMjQwLDcg
QEAgZW51bSBpOTE1X3Bvd2VyX3dlbGxfaWQgewogI2RlZmluZSAgIEdNQlVTX1BJTl8xMl9UQzRf
SUNQCTEyCiAKICNkZWZpbmUgICBHTUJVU19OVU1fUElOUwkxMyAvKiBpbmNsdWRpbmcgMCAqLwot
I2RlZmluZSBHTUJVUzEJCQlfTU1JTyhkZXZfcHJpdi0+Z3Bpb19tbWlvX2Jhc2UgKyAweDUxMDQp
IC8qIGNvbW1hbmQvc3RhdHVzICovCisjZGVmaW5lIEdNQlVTMQkJCV9NTUlPKGk5MTUtPmdwaW9f
bW1pb19iYXNlICsgMHg1MTA0KSAvKiBjb21tYW5kL3N0YXR1cyAqLwogI2RlZmluZSAgIEdNQlVT
X1NXX0NMUl9JTlQJKDEgPDwgMzEpCiAjZGVmaW5lICAgR01CVVNfU1dfUkRZCQkoMSA8PCAzMCkK
ICNkZWZpbmUgICBHTUJVU19FTlQJCSgxIDw8IDI5KSAvKiBlbmFibGUgdGltZW91dCAqLwpAQCAt
MzI1NSw3ICszMjU1LDcgQEAgZW51bSBpOTE1X3Bvd2VyX3dlbGxfaWQgewogI2RlZmluZSAgIEdN
QlVTX1NMQVZFX0FERFJfU0hJRlQgMQogI2RlZmluZSAgIEdNQlVTX1NMQVZFX1JFQUQJKDEgPDwg
MCkKICNkZWZpbmUgICBHTUJVU19TTEFWRV9XUklURQkoMCA8PCAwKQotI2RlZmluZSBHTUJVUzIJ
CQlfTU1JTyhkZXZfcHJpdi0+Z3Bpb19tbWlvX2Jhc2UgKyAweDUxMDgpIC8qIHN0YXR1cyAqLwor
I2RlZmluZSBHTUJVUzIJCQlfTU1JTyhpOTE1LT5ncGlvX21taW9fYmFzZSArIDB4NTEwOCkgLyog
c3RhdHVzICovCiAjZGVmaW5lICAgR01CVVNfSU5VU0UJCSgxIDw8IDE1KQogI2RlZmluZSAgIEdN
QlVTX0hXX1dBSVRfUEhBU0UJKDEgPDwgMTQpCiAjZGVmaW5lICAgR01CVVNfU1RBTExfVElNRU9V
VAkoMSA8PCAxMykKQEAgLTMyNjMsMjIgKzMyNjMsMjIgQEAgZW51bSBpOTE1X3Bvd2VyX3dlbGxf
aWQgewogI2RlZmluZSAgIEdNQlVTX0hXX1JEWQkJKDEgPDwgMTEpCiAjZGVmaW5lICAgR01CVVNf
U0FUT0VSCQkoMSA8PCAxMCkKICNkZWZpbmUgICBHTUJVU19BQ1RJVkUJCSgxIDw8IDkpCi0jZGVm
aW5lIEdNQlVTMwkJCV9NTUlPKGRldl9wcml2LT5ncGlvX21taW9fYmFzZSArIDB4NTEwYykgLyog
ZGF0YSBidWZmZXIgYnl0ZXMgMy0wICovCi0jZGVmaW5lIEdNQlVTNAkJCV9NTUlPKGRldl9wcml2
LT5ncGlvX21taW9fYmFzZSArIDB4NTExMCkgLyogaW50ZXJydXB0IG1hc2sgKFBpbmV2aWV3Kykg
Ki8KKyNkZWZpbmUgR01CVVMzCQkJX01NSU8oaTkxNS0+Z3Bpb19tbWlvX2Jhc2UgKyAweDUxMGMp
IC8qIGRhdGEgYnVmZmVyIGJ5dGVzIDMtMCAqLworI2RlZmluZSBHTUJVUzQJCQlfTU1JTyhpOTE1
LT5ncGlvX21taW9fYmFzZSArIDB4NTExMCkgLyogaW50ZXJydXB0IG1hc2sgKFBpbmV2aWV3Kykg
Ki8KICNkZWZpbmUgICBHTUJVU19TTEFWRV9USU1FT1VUX0VOICgxIDw8IDQpCiAjZGVmaW5lICAg
R01CVVNfTkFLX0VOCQkoMSA8PCAzKQogI2RlZmluZSAgIEdNQlVTX0lETEVfRU4JCSgxIDw8IDIp
CiAjZGVmaW5lICAgR01CVVNfSFdfV0FJVF9FTgkoMSA8PCAxKQogI2RlZmluZSAgIEdNQlVTX0hX
X1JEWV9FTgkoMSA8PCAwKQotI2RlZmluZSBHTUJVUzUJCQlfTU1JTyhkZXZfcHJpdi0+Z3Bpb19t
bWlvX2Jhc2UgKyAweDUxMjApIC8qIGJ5dGUgaW5kZXggKi8KKyNkZWZpbmUgR01CVVM1CQkJX01N
SU8oaTkxNS0+Z3Bpb19tbWlvX2Jhc2UgKyAweDUxMjApIC8qIGJ5dGUgaW5kZXggKi8KICNkZWZp
bmUgICBHTUJVU18yQllURV9JTkRFWF9FTgkoMSA8PCAzMSkKIAogLyoKICAqIENsb2NrIGNvbnRy
b2wgJiBwb3dlciBtYW5hZ2VtZW50CiAgKi8KLSNkZWZpbmUgX0RQTExfQSAoRElTUExBWV9NTUlP
X0JBU0UoZGV2X3ByaXYpICsgMHg2MDE0KQotI2RlZmluZSBfRFBMTF9CIChESVNQTEFZX01NSU9f
QkFTRShkZXZfcHJpdikgKyAweDYwMTgpCi0jZGVmaW5lIF9DSFZfRFBMTF9DIChESVNQTEFZX01N
SU9fQkFTRShkZXZfcHJpdikgKyAweDYwMzApCisjZGVmaW5lIF9EUExMX0EgKERJU1BMQVlfTU1J
T19CQVNFKGk5MTUpICsgMHg2MDE0KQorI2RlZmluZSBfRFBMTF9CIChESVNQTEFZX01NSU9fQkFT
RShpOTE1KSArIDB4NjAxOCkKKyNkZWZpbmUgX0NIVl9EUExMX0MgKERJU1BMQVlfTU1JT19CQVNF
KGk5MTUpICsgMHg2MDMwKQogI2RlZmluZSBEUExMKHBpcGUpIF9NTUlPX1BJUEUzKChwaXBlKSwg
X0RQTExfQSwgX0RQTExfQiwgX0NIVl9EUExMX0MpCiAKICNkZWZpbmUgVkdBMAlfTU1JTygweDYw
MDApCkBAIC0zMzc1LDkgKzMzNzUsOSBAQCBlbnVtIGk5MTVfcG93ZXJfd2VsbF9pZCB7CiAjZGVm
aW5lICAgU0RWT19NVUxUSVBMSUVSX1NISUZUX0hJUkVTCQk0CiAjZGVmaW5lICAgU0RWT19NVUxU
SVBMSUVSX1NISUZUX1ZHQQkJMAogCi0jZGVmaW5lIF9EUExMX0FfTUQgKERJU1BMQVlfTU1JT19C
QVNFKGRldl9wcml2KSArIDB4NjAxYykKLSNkZWZpbmUgX0RQTExfQl9NRCAoRElTUExBWV9NTUlP
X0JBU0UoZGV2X3ByaXYpICsgMHg2MDIwKQotI2RlZmluZSBfQ0hWX0RQTExfQ19NRCAoRElTUExB
WV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2MDNjKQorI2RlZmluZSBfRFBMTF9BX01EIChESVNQ
TEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjAxYykKKyNkZWZpbmUgX0RQTExfQl9NRCAoRElTUExB
WV9NTUlPX0JBU0UoaTkxNSkgKyAweDYwMjApCisjZGVmaW5lIF9DSFZfRFBMTF9DX01EIChESVNQ
TEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjAzYykKICNkZWZpbmUgRFBMTF9NRChwaXBlKSBfTU1J
T19QSVBFMygocGlwZSksIF9EUExMX0FfTUQsIF9EUExMX0JfTUQsIF9DSFZfRFBMTF9DX01EKQog
CiAvKgpAQCAtMzQ0OSw3ICszNDQ5LDcgQEAgZW51bSBpOTE1X3Bvd2VyX3dlbGxfaWQgewogI2Rl
ZmluZSAgRFNUQVRFX1BMTF9EM19PRkYJCQkoMSA8PCAzKQogI2RlZmluZSAgRFNUQVRFX0dGWF9D
TE9DS19HQVRJTkcJCSgxIDw8IDEpCiAjZGVmaW5lICBEU1RBVEVfRE9UX0NMT0NLX0dBVElORwkJ
KDEgPDwgMCkKLSNkZWZpbmUgRFNQQ0xLX0dBVEVfRAlfTU1JTyhESVNQTEFZX01NSU9fQkFTRShk
ZXZfcHJpdikgKyAweDYyMDApCisjZGVmaW5lIERTUENMS19HQVRFX0QJX01NSU8oRElTUExBWV9N
TUlPX0JBU0UoaTkxNSkgKyAweDYyMDApCiAjIGRlZmluZSBEUFVOSVRfQl9DTE9DS19HQVRFX0RJ
U0FCTEUJCSgxIDw8IDMwKSAvKiA5NjUgKi8KICMgZGVmaW5lIFZTVU5JVF9DTE9DS19HQVRFX0RJ
U0FCTEUJCSgxIDw8IDI5KSAvKiA5NjUgKi8KICMgZGVmaW5lIFZSSFVOSVRfQ0xPQ0tfR0FURV9E
SVNBQkxFCQkoMSA8PCAyOCkgLyogOTY1ICovCkBAIC0zNTg5LDcgKzM1ODksNyBAQCBlbnVtIGk5
MTVfcG93ZXJfd2VsbF9pZCB7CiAjZGVmaW5lIF9QQUxFVFRFX0EJCTB4YTAwMAogI2RlZmluZSBf
UEFMRVRURV9CCQkweGE4MDAKICNkZWZpbmUgX0NIVl9QQUxFVFRFX0MJCTB4YzAwMAotI2RlZmlu
ZSBQQUxFVFRFKHBpcGUsIGkpCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIFwK
KyNkZWZpbmUgUEFMRVRURShwaXBlLCBpKQlfTU1JTyhESVNQTEFZX01NSU9fQkFTRShpOTE1KSAr
IFwKIAkJCQkgICAgICBfUElDSygocGlwZSksIF9QQUxFVFRFX0EsCQlcCiAJCQkJCSAgICBfUEFM
RVRURV9CLCBfQ0hWX1BBTEVUVEVfQykgKyBcCiAJCQkJICAgICAgKGkpICogNCkKQEAgLTM5MzYs
OCArMzkzNiw4IEBAIGVudW0gaTkxNV9wb3dlcl93ZWxsX2lkIHsKICNkZWZpbmUgSU5URVJWQUxf
MV8yOF9VUyh1cykJcm91bmR1cCgoKHVzKSAqIDEwMCkgPj4gNywgMjUpCiAjZGVmaW5lIElOVEVS
VkFMXzFfMzNfVVModXMpCSgoKHVzKSAqIDMpICAgPj4gMikKICNkZWZpbmUgSU5URVJWQUxfMF84
MzNfVVModXMpCSgoKHVzKSAqIDYpIC8gNSkKLSNkZWZpbmUgR1RfSU5URVJWQUxfRlJPTV9VUyhk
ZXZfcHJpdiwgdXMpIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkgPyBcCi0JCQkJKElTX0dFTjlf
TFAoZGV2X3ByaXYpID8gXAorI2RlZmluZSBHVF9JTlRFUlZBTF9GUk9NX1VTKGk5MTUsIHVzKSAo
SU5URUxfR0VOKGk5MTUpID49IDkgPyBcCisJCQkJKElTX0dFTjlfTFAoaTkxNSkgPyBcCiAJCQkJ
SU5URVJWQUxfMF84MzNfVVModXMpIDogXAogCQkJCUlOVEVSVkFMXzFfMzNfVVModXMpKSA6IFwK
IAkJCQlJTlRFUlZBTF8xXzI4X1VTKHVzKSkKQEAgLTM5NDUsOCArMzk0NSw4IEBAIGVudW0gaTkx
NV9wb3dlcl93ZWxsX2lkIHsKICNkZWZpbmUgSU5URVJWQUxfMV8yOF9UT19VUyhpbnRlcnZhbCkg
ICgoKGludGVydmFsKSA8PCA3KSAvIDEwMCkKICNkZWZpbmUgSU5URVJWQUxfMV8zM19UT19VUyhp
bnRlcnZhbCkgICgoKGludGVydmFsKSA8PCAyKSAvIDMpCiAjZGVmaW5lIElOVEVSVkFMXzBfODMz
X1RPX1VTKGludGVydmFsKSAoKChpbnRlcnZhbCkgKiA1KSAgLyA2KQotI2RlZmluZSBHVF9QTV9J
TlRFUlZBTF9UT19VUyhkZXZfcHJpdiwgaW50ZXJ2YWwpIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDkgPyBcCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAoSVNfR0VOOV9MUChkZXZfcHJpdikg
PyBcCisjZGVmaW5lIEdUX1BNX0lOVEVSVkFMX1RPX1VTKGk5MTUsIGludGVydmFsKSAoSU5URUxf
R0VOKGk5MTUpID49IDkgPyBcCisgICAgICAgICAgICAgICAgICAgICAgICAgICAoSVNfR0VOOV9M
UChpOTE1KSA/IFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElOVEVSVkFMXzBfODMzX1RP
X1VTKGludGVydmFsKSA6IFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElOVEVSVkFMXzFf
MzNfVE9fVVMoaW50ZXJ2YWwpKSA6IFwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElOVEVS
VkFMXzFfMjhfVE9fVVMoaW50ZXJ2YWwpKQpAQCAtNDIxOSw3ICs0MjE5LDcgQEAgZW51bSB7CiAv
KiBIU1crIGVEUCBQU1IgcmVnaXN0ZXJzICovCiAjZGVmaW5lIEhTV19FRFBfUFNSX0JBU0UJMHg2
NDgwMAogI2RlZmluZSBCRFdfRURQX1BTUl9CQVNFCTB4NmY4MDAKLSNkZWZpbmUgRURQX1BTUl9D
VEwJCQkJX01NSU8oZGV2X3ByaXYtPnBzcl9tbWlvX2Jhc2UgKyAwKQorI2RlZmluZSBFRFBfUFNS
X0NUTAkJCQlfTU1JTyhpOTE1LT5wc3JfbW1pb19iYXNlICsgMCkKICNkZWZpbmUgICBFRFBfUFNS
X0VOQUJMRQkJCSgxIDw8IDMxKQogI2RlZmluZSAgIEJEV19QU1JfU0lOR0xFX0ZSQU1FCQkJKDEg
PDwgMzApCiAjZGVmaW5lICAgRURQX1BTUl9SRVNUT1JFX1BTUl9BQ1RJVkVfQ1RYX01BU0sJKDEg
PDwgMjkpIC8qIFNXIGNhbid0IG1vZGlmeSAqLwpAQCAtNDI1NiwxNiArNDI1NiwxNiBAQCBlbnVt
IHsKICNkZWZpbmUgICBFRFBfUFNSX1RSQU5TQ09ERVJfQV9TSElGVAkJOAogI2RlZmluZSAgIEVE
UF9QU1JfVFJBTlNDT0RFUl9FRFBfU0hJRlQJCTAKIAotI2RlZmluZSBFRFBfUFNSX0FVWF9DVEwJ
CQkJX01NSU8oZGV2X3ByaXYtPnBzcl9tbWlvX2Jhc2UgKyAweDEwKQorI2RlZmluZSBFRFBfUFNS
X0FVWF9DVEwJCQkJX01NSU8oaTkxNS0+cHNyX21taW9fYmFzZSArIDB4MTApCiAjZGVmaW5lICAg
RURQX1BTUl9BVVhfQ1RMX1RJTUVfT1VUX01BU0sJCSgzIDw8IDI2KQogI2RlZmluZSAgIEVEUF9Q
U1JfQVVYX0NUTF9NRVNTQUdFX1NJWkVfTUFTSwkoMHgxZiA8PCAyMCkKICNkZWZpbmUgICBFRFBf
UFNSX0FVWF9DVExfUFJFQ0hBUkdFXzJVU19NQVNLCSgweGYgPDwgMTYpCiAjZGVmaW5lICAgRURQ
X1BTUl9BVVhfQ1RMX0VSUk9SX0lOVEVSUlVQVAkoMSA8PCAxMSkKICNkZWZpbmUgICBFRFBfUFNS
X0FVWF9DVExfQklUX0NMT0NLXzJYX01BU0sJKDB4N2ZmKQogCi0jZGVmaW5lIEVEUF9QU1JfQVVY
X0RBVEEoaSkJCQlfTU1JTyhkZXZfcHJpdi0+cHNyX21taW9fYmFzZSArIDB4MTQgKyAoaSkgKiA0
KSAvKiA1IHJlZ2lzdGVycyAqLworI2RlZmluZSBFRFBfUFNSX0FVWF9EQVRBKGkpCQkJX01NSU8o
aTkxNS0+cHNyX21taW9fYmFzZSArIDB4MTQgKyAoaSkgKiA0KSAvKiA1IHJlZ2lzdGVycyAqLwog
Ci0jZGVmaW5lIEVEUF9QU1JfU1RBVFVTCQkJCV9NTUlPKGRldl9wcml2LT5wc3JfbW1pb19iYXNl
ICsgMHg0MCkKKyNkZWZpbmUgRURQX1BTUl9TVEFUVVMJCQkJX01NSU8oaTkxNS0+cHNyX21taW9f
YmFzZSArIDB4NDApCiAjZGVmaW5lICAgRURQX1BTUl9TVEFUVVNfU1RBVEVfTUFTSwkJKDcgPDwg
MjkpCiAjZGVmaW5lICAgRURQX1BTUl9TVEFUVVNfU1RBVEVfU0hJRlQJCTI5CiAjZGVmaW5lICAg
RURQX1BTUl9TVEFUVVNfU1RBVEVfSURMRQkJKDAgPDwgMjkpCkBAIC00MjkwLDEwICs0MjkwLDEw
IEBAIGVudW0gewogI2RlZmluZSAgIEVEUF9QU1JfU1RBVFVTX1NFTkRJTkdfVFAxCQkoMSA8PCA0
KQogI2RlZmluZSAgIEVEUF9QU1JfU1RBVFVTX0lETEVfTUFTSwkJMHhmCiAKLSNkZWZpbmUgRURQ
X1BTUl9QRVJGX0NOVAkJX01NSU8oZGV2X3ByaXYtPnBzcl9tbWlvX2Jhc2UgKyAweDQ0KQorI2Rl
ZmluZSBFRFBfUFNSX1BFUkZfQ05UCQlfTU1JTyhpOTE1LT5wc3JfbW1pb19iYXNlICsgMHg0NCkK
ICNkZWZpbmUgICBFRFBfUFNSX1BFUkZfQ05UX01BU0sJCTB4ZmZmZmZmCiAKLSNkZWZpbmUgRURQ
X1BTUl9ERUJVRwkJCQlfTU1JTyhkZXZfcHJpdi0+cHNyX21taW9fYmFzZSArIDB4NjApIC8qIFBT
Ul9NQVNLIG9uIFNLTCsgKi8KKyNkZWZpbmUgRURQX1BTUl9ERUJVRwkJCQlfTU1JTyhpOTE1LT5w
c3JfbW1pb19iYXNlICsgMHg2MCkgLyogUFNSX01BU0sgb24gU0tMKyAqLwogI2RlZmluZSAgIEVE
UF9QU1JfREVCVUdfTUFTS19NQVhfU0xFRVAgICAgICAgICAoMSA8PCAyOCkKICNkZWZpbmUgICBF
RFBfUFNSX0RFQlVHX01BU0tfTFBTUCAgICAgICAgICAgICAgKDEgPDwgMjcpCiAjZGVmaW5lICAg
RURQX1BTUl9ERUJVR19NQVNLX01FTVVQICAgICAgICAgICAgICgxIDw8IDI2KQpAQCAtNDQwNSw3
ICs0NDA1LDcgQEAgZW51bSB7CiAKIAogLyogSG90cGx1ZyBjb250cm9sICg5NDUrIG9ubHkpICov
Ci0jZGVmaW5lIFBPUlRfSE9UUExVR19FTgkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2X3By
aXYpICsgMHg2MTExMCkKKyNkZWZpbmUgUE9SVF9IT1RQTFVHX0VOCQlfTU1JTyhESVNQTEFZX01N
SU9fQkFTRShpOTE1KSArIDB4NjExMTApCiAjZGVmaW5lICAgUE9SVEJfSE9UUExVR19JTlRfRU4J
CQkoMSA8PCAyOSkKICNkZWZpbmUgICBQT1JUQ19IT1RQTFVHX0lOVF9FTgkJCSgxIDw8IDI4KQog
I2RlZmluZSAgIFBPUlREX0hPVFBMVUdfSU5UX0VOCQkJKDEgPDwgMjcpCkBAIC00NDM1LDcgKzQ0
MzUsNyBAQCBlbnVtIHsKICNkZWZpbmUgQ1JUX0hPVFBMVUdfREVURUNUX1ZPTFRBR0VfMzI1TVYJ
KDAgPDwgMikKICNkZWZpbmUgQ1JUX0hPVFBMVUdfREVURUNUX1ZPTFRBR0VfNDc1TVYJKDEgPDwg
MikKIAotI2RlZmluZSBQT1JUX0hPVFBMVUdfU1RBVAlfTU1JTyhESVNQTEFZX01NSU9fQkFTRShk
ZXZfcHJpdikgKyAweDYxMTE0KQorI2RlZmluZSBQT1JUX0hPVFBMVUdfU1RBVAlfTU1JTyhESVNQ
TEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjExMTQpCiAvKgogICogSERNSS9EUCBiaXRzIGFyZSBn
NHgrCiAgKgpAQCAtNDUxNyw3ICs0NTE3LDcgQEAgZW51bSB7CiAKICNkZWZpbmUgUE9SVF9ERlRf
STlYWAkJCQlfTU1JTygweDYxMTUwKQogI2RlZmluZSAgIERDX0JBTEFOQ0VfUkVTRVQJCQkoMSA8
PCAyNSkKLSNkZWZpbmUgUE9SVF9ERlQyX0c0WAkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2
X3ByaXYpICsgMHg2MTE1NCkKKyNkZWZpbmUgUE9SVF9ERlQyX0c0WAkJX01NSU8oRElTUExBWV9N
TUlPX0JBU0UoaTkxNSkgKyAweDYxMTU0KQogI2RlZmluZSAgIERDX0JBTEFOQ0VfUkVTRVRfVkxW
CQkJKDEgPDwgMzEpCiAjZGVmaW5lICAgUElQRV9TQ1JBTUJMRV9SRVNFVF9NQVNLCQkoKDEgPDwg
MTQpIHwgKDB4MyA8PCAwKSkKICNkZWZpbmUgICBQSVBFX0NfU0NSQU1CTEVfUkVTRVQJCQkoMSA8
PCAxNCkgLyogY2h2ICovCkBAIC00NzE5LDcgKzQ3MTksNyBAQCBlbnVtIHsKICNkZWZpbmUgVkxW
X1BQU19CQVNFCQkJKFZMVl9ESVNQTEFZX0JBU0UgKyBQUFNfQkFTRSkKICNkZWZpbmUgUENIX1BQ
U19CQVNFCQkJMHhDNzIwMAogCi0jZGVmaW5lIF9NTUlPX1BQUyhwcHNfaWR4LCByZWcpCQlfTU1J
TyhkZXZfcHJpdi0+cHBzX21taW9fYmFzZSAtCVwKKyNkZWZpbmUgX01NSU9fUFBTKHBwc19pZHgs
IHJlZykJCV9NTUlPKGk5MTUtPnBwc19tbWlvX2Jhc2UgLQlcCiAJCQkJCSAgICAgIFBQU19CQVNF
ICsgKHJlZykgKwlcCiAJCQkJCSAgICAgIChwcHNfaWR4KSAqIDB4MTAwKQogCkBAIC00NzkyLDcg
KzQ3OTIsNyBAQCBlbnVtIHsKICNkZWZpbmUgIFBBTkVMX1BPV0VSX0NZQ0xFX0RFTEFZX01BU0sJ
UkVHX0dFTk1BU0soNCwgMCkKIAogLyogUGFuZWwgZml0dGluZyAqLwotI2RlZmluZSBQRklUX0NP
TlRST0wJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2MTIzMCkKKyNkZWZp
bmUgUEZJVF9DT05UUk9MCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg2MTIzMCkK
ICNkZWZpbmUgICBQRklUX0VOQUJMRQkJKDEgPDwgMzEpCiAjZGVmaW5lICAgUEZJVF9QSVBFX01B
U0sJKDMgPDwgMjkpCiAjZGVmaW5lICAgUEZJVF9QSVBFX1NISUZUCTI5CkBAIC00ODEwLDcgKzQ4
MTAsNyBAQCBlbnVtIHsKICNkZWZpbmUgICBQRklUX1NDQUxJTkdfUFJPR1JBTU1FRCAoMSA8PCAy
NikKICNkZWZpbmUgICBQRklUX1NDQUxJTkdfUElMTEFSCSgyIDw8IDI2KQogI2RlZmluZSAgIFBG
SVRfU0NBTElOR19MRVRURVIJKDMgPDwgMjYpCi0jZGVmaW5lIFBGSVRfUEdNX1JBVElPUyBfTU1J
TyhESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDYxMjM0KQorI2RlZmluZSBQRklUX1BH
TV9SQVRJT1MgX01NSU8oRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDYxMjM0KQogLyogUHJl
LTk2NSAqLwogI2RlZmluZQkJUEZJVF9WRVJUX1NDQUxFX1NISUZUCQkyMAogI2RlZmluZQkJUEZJ
VF9WRVJUX1NDQUxFX01BU0sJCTB4ZmZmMDAwMDAKQEAgLTQ4MjIsMjUgKzQ4MjIsMjUgQEAgZW51
bSB7CiAjZGVmaW5lCQlQRklUX0hPUklaX1NDQUxFX1NISUZUXzk2NQkwCiAjZGVmaW5lCQlQRklU
X0hPUklaX1NDQUxFX01BU0tfOTY1CTB4MDAwMDFmZmYKIAotI2RlZmluZSBQRklUX0FVVE9fUkFU
SU9TIF9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjEyMzgpCisjZGVmaW5l
IFBGSVRfQVVUT19SQVRJT1MgX01NSU8oRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDYxMjM4
KQogCi0jZGVmaW5lIF9WTFZfQkxDX1BXTV9DVEwyX0EgKERJU1BMQVlfTU1JT19CQVNFKGRldl9w
cml2KSArIDB4NjEyNTApCi0jZGVmaW5lIF9WTFZfQkxDX1BXTV9DVEwyX0IgKERJU1BMQVlfTU1J
T19CQVNFKGRldl9wcml2KSArIDB4NjEzNTApCisjZGVmaW5lIF9WTFZfQkxDX1BXTV9DVEwyX0Eg
KERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg2MTI1MCkKKyNkZWZpbmUgX1ZMVl9CTENfUFdN
X0NUTDJfQiAoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDYxMzUwKQogI2RlZmluZSBWTFZf
QkxDX1BXTV9DVEwyKHBpcGUpIF9NTUlPX1BJUEUocGlwZSwgX1ZMVl9CTENfUFdNX0NUTDJfQSwg
XAogCQkJCQkgX1ZMVl9CTENfUFdNX0NUTDJfQikKIAotI2RlZmluZSBfVkxWX0JMQ19QV01fQ1RM
X0EgKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjEyNTQpCi0jZGVmaW5lIF9WTFZf
QkxDX1BXTV9DVExfQiAoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2MTM1NCkKKyNk
ZWZpbmUgX1ZMVl9CTENfUFdNX0NUTF9BIChESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjEy
NTQpCisjZGVmaW5lIF9WTFZfQkxDX1BXTV9DVExfQiAoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkg
KyAweDYxMzU0KQogI2RlZmluZSBWTFZfQkxDX1BXTV9DVEwocGlwZSkgX01NSU9fUElQRShwaXBl
LCBfVkxWX0JMQ19QV01fQ1RMX0EsIFwKIAkJCQkJX1ZMVl9CTENfUFdNX0NUTF9CKQogCi0jZGVm
aW5lIF9WTFZfQkxDX0hJU1RfQ1RMX0EgKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4
NjEyNjApCi0jZGVmaW5lIF9WTFZfQkxDX0hJU1RfQ1RMX0IgKERJU1BMQVlfTU1JT19CQVNFKGRl
dl9wcml2KSArIDB4NjEzNjApCisjZGVmaW5lIF9WTFZfQkxDX0hJU1RfQ1RMX0EgKERJU1BMQVlf
TU1JT19CQVNFKGk5MTUpICsgMHg2MTI2MCkKKyNkZWZpbmUgX1ZMVl9CTENfSElTVF9DVExfQiAo
RElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDYxMzYwKQogI2RlZmluZSBWTFZfQkxDX0hJU1Rf
Q1RMKHBpcGUpIF9NTUlPX1BJUEUocGlwZSwgX1ZMVl9CTENfSElTVF9DVExfQSwgXAogCQkJCQkg
X1ZMVl9CTENfSElTVF9DVExfQikKIAogLyogQmFja2xpZ2h0IGNvbnRyb2wgKi8KLSNkZWZpbmUg
QkxDX1BXTV9DVEwyCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjEyNTAp
IC8qIDk2NSsgb25seSAqLworI2RlZmluZSBCTENfUFdNX0NUTDIJX01NSU8oRElTUExBWV9NTUlP
X0JBU0UoaTkxNSkgKyAweDYxMjUwKSAvKiA5NjUrIG9ubHkgKi8KICNkZWZpbmUgICBCTE1fUFdN
X0VOQUJMRQkJKDEgPDwgMzEpCiAjZGVmaW5lICAgQkxNX0NPTUJJTkFUSU9OX01PREUJCSgxIDw8
IDMwKSAvKiBnZW40IG9ubHkgKi8KICNkZWZpbmUgICBCTE1fUElQRV9TRUxFQ1QJCSgxIDw8IDI5
KQpAQCAtNDg2Myw3ICs0ODYzLDcgQEAgZW51bSB7CiAjZGVmaW5lICAgQkxNX1BIQVNFX0lOX0NP
VU5UX01BU0sJKDB4ZmYgPDwgOCkKICNkZWZpbmUgICBCTE1fUEhBU0VfSU5fSU5DUl9TSElGVAko
MCkKICNkZWZpbmUgICBCTE1fUEhBU0VfSU5fSU5DUl9NQVNLCSgweGZmIDw8IDApCi0jZGVmaW5l
IEJMQ19QV01fQ1RMCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjEyNTQp
CisjZGVmaW5lIEJMQ19QV01fQ1RMCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg2
MTI1NCkKIC8qCiAgKiBUaGlzIGlzIHRoZSBtb3N0IHNpZ25pZmljYW50IDE1IGJpdHMgb2YgdGhl
IG51bWJlciBvZiBiYWNrbGlnaHQgY3ljbGVzIGluIGEKICAqIGNvbXBsZXRlIGN5Y2xlIG9mIHRo
ZSBtb2R1bGF0ZWQgYmFja2xpZ2h0IGNvbnRyb2wuCkBAIC00ODg1LDcgKzQ4ODUsNyBAQCBlbnVt
IHsKICNkZWZpbmUgICBCQUNLTElHSFRfRFVUWV9DWUNMRV9NQVNLX1BOVgkJKDB4ZmZmZSkKICNk
ZWZpbmUgICBCTE1fUE9MQVJJVFlfUE5WCQkJKDEgPDwgMCkgLyogcG52IG9ubHkgKi8KIAotI2Rl
ZmluZSBCTENfSElTVF9DVEwJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2
MTI2MCkKKyNkZWZpbmUgQkxDX0hJU1RfQ1RMCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGk5MTUp
ICsgMHg2MTI2MCkKICNkZWZpbmUgIEJMTV9ISVNUT0dSQU1fRU5BQkxFCQkJKDEgPDwgMzEpCiAK
IC8qIE5ldyByZWdpc3RlcnMgZm9yIFBDSC1zcGxpdCBwbGF0Zm9ybXMuIFNhZmUgd2hlcmUgbmV3
IGJpdHMgc2hvdyB1cCwgdGhlCkBAIC01NTEwLDQ3ICs1NTEwLDQ3IEBAIGVudW0gewogICogaXMg
MjAgYnl0ZXMgaW4gZWFjaCBkaXJlY3Rpb24sIGhlbmNlIHRoZSA1IGZpeGVkCiAgKiBkYXRhIHJl
Z2lzdGVycwogICovCi0jZGVmaW5lIF9EUEFfQVVYX0NIX0NUTAkJKERJU1BMQVlfTU1JT19CQVNF
KGRldl9wcml2KSArIDB4NjQwMTApCi0jZGVmaW5lIF9EUEFfQVVYX0NIX0RBVEExCShESVNQTEFZ
X01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0MDE0KQotI2RlZmluZSBfRFBBX0FVWF9DSF9EQVRB
MgkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2NDAxOCkKLSNkZWZpbmUgX0RQQV9B
VVhfQ0hfREFUQTMJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjQwMWMpCi0jZGVm
aW5lIF9EUEFfQVVYX0NIX0RBVEE0CShESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0
MDIwKQotI2RlZmluZSBfRFBBX0FVWF9DSF9EQVRBNQkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3By
aXYpICsgMHg2NDAyNCkKLQotI2RlZmluZSBfRFBCX0FVWF9DSF9DVEwJCShESVNQTEFZX01NSU9f
QkFTRShkZXZfcHJpdikgKyAweDY0MTEwKQotI2RlZmluZSBfRFBCX0FVWF9DSF9EQVRBMQkoRElT
UExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2NDExNCkKLSNkZWZpbmUgX0RQQl9BVVhfQ0hf
REFUQTIJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjQxMTgpCi0jZGVmaW5lIF9E
UEJfQVVYX0NIX0RBVEEzCShESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0MTFjKQot
I2RlZmluZSBfRFBCX0FVWF9DSF9EQVRBNAkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsg
MHg2NDEyMCkKLSNkZWZpbmUgX0RQQl9BVVhfQ0hfREFUQTUJKERJU1BMQVlfTU1JT19CQVNFKGRl
dl9wcml2KSArIDB4NjQxMjQpCi0KLSNkZWZpbmUgX0RQQ19BVVhfQ0hfQ1RMCQkoRElTUExBWV9N
TUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2NDIxMCkKLSNkZWZpbmUgX0RQQ19BVVhfQ0hfREFUQTEJ
KERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjQyMTQpCi0jZGVmaW5lIF9EUENfQVVY
X0NIX0RBVEEyCShESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0MjE4KQotI2RlZmlu
ZSBfRFBDX0FVWF9DSF9EQVRBMwkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2NDIx
YykKLSNkZWZpbmUgX0RQQ19BVVhfQ0hfREFUQTQJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2
KSArIDB4NjQyMjApCi0jZGVmaW5lIF9EUENfQVVYX0NIX0RBVEE1CShESVNQTEFZX01NSU9fQkFT
RShkZXZfcHJpdikgKyAweDY0MjI0KQotCi0jZGVmaW5lIF9EUERfQVVYX0NIX0NUTAkJKERJU1BM
QVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjQzMTApCi0jZGVmaW5lIF9EUERfQVVYX0NIX0RB
VEExCShESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0MzE0KQotI2RlZmluZSBfRFBE
X0FVWF9DSF9EQVRBMgkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2NDMxOCkKLSNk
ZWZpbmUgX0RQRF9BVVhfQ0hfREFUQTMJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4
NjQzMWMpCi0jZGVmaW5lIF9EUERfQVVYX0NIX0RBVEE0CShESVNQTEFZX01NSU9fQkFTRShkZXZf
cHJpdikgKyAweDY0MzIwKQotI2RlZmluZSBfRFBEX0FVWF9DSF9EQVRBNQkoRElTUExBWV9NTUlP
X0JBU0UoZGV2X3ByaXYpICsgMHg2NDMyNCkKLQotI2RlZmluZSBfRFBFX0FVWF9DSF9DVEwJCShE
SVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0NDEwKQotI2RlZmluZSBfRFBFX0FVWF9D
SF9EQVRBMQkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2NDQxNCkKLSNkZWZpbmUg
X0RQRV9BVVhfQ0hfREFUQTIJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjQ0MTgp
Ci0jZGVmaW5lIF9EUEVfQVVYX0NIX0RBVEEzCShESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikg
KyAweDY0NDFjKQotI2RlZmluZSBfRFBFX0FVWF9DSF9EQVRBNAkoRElTUExBWV9NTUlPX0JBU0Uo
ZGV2X3ByaXYpICsgMHg2NDQyMCkKLSNkZWZpbmUgX0RQRV9BVVhfQ0hfREFUQTUJKERJU1BMQVlf
TU1JT19CQVNFKGRldl9wcml2KSArIDB4NjQ0MjQpCi0KLSNkZWZpbmUgX0RQRl9BVVhfQ0hfQ1RM
CQkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2NDUxMCkKLSNkZWZpbmUgX0RQRl9B
VVhfQ0hfREFUQTEJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NjQ1MTQpCi0jZGVm
aW5lIF9EUEZfQVVYX0NIX0RBVEEyCShESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0
NTE4KQotI2RlZmluZSBfRFBGX0FVWF9DSF9EQVRBMwkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3By
aXYpICsgMHg2NDUxYykKLSNkZWZpbmUgX0RQRl9BVVhfQ0hfREFUQTQJKERJU1BMQVlfTU1JT19C
QVNFKGRldl9wcml2KSArIDB4NjQ1MjApCi0jZGVmaW5lIF9EUEZfQVVYX0NIX0RBVEE1CShESVNQ
TEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDY0NTI0KQorI2RlZmluZSBfRFBBX0FVWF9DSF9D
VEwJCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQwMTApCisjZGVmaW5lIF9EUEFfQVVY
X0NIX0RBVEExCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQwMTQpCisjZGVmaW5lIF9E
UEFfQVVYX0NIX0RBVEEyCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQwMTgpCisjZGVm
aW5lIF9EUEFfQVVYX0NIX0RBVEEzCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQwMWMp
CisjZGVmaW5lIF9EUEFfQVVYX0NIX0RBVEE0CShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4
NjQwMjApCisjZGVmaW5lIF9EUEFfQVVYX0NIX0RBVEE1CShESVNQTEFZX01NSU9fQkFTRShpOTE1
KSArIDB4NjQwMjQpCisKKyNkZWZpbmUgX0RQQl9BVVhfQ0hfQ1RMCQkoRElTUExBWV9NTUlPX0JB
U0UoaTkxNSkgKyAweDY0MTEwKQorI2RlZmluZSBfRFBCX0FVWF9DSF9EQVRBMQkoRElTUExBWV9N
TUlPX0JBU0UoaTkxNSkgKyAweDY0MTE0KQorI2RlZmluZSBfRFBCX0FVWF9DSF9EQVRBMgkoRElT
UExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0MTE4KQorI2RlZmluZSBfRFBCX0FVWF9DSF9EQVRB
MwkoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0MTFjKQorI2RlZmluZSBfRFBCX0FVWF9D
SF9EQVRBNAkoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0MTIwKQorI2RlZmluZSBfRFBC
X0FVWF9DSF9EQVRBNQkoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0MTI0KQorCisjZGVm
aW5lIF9EUENfQVVYX0NIX0NUTAkJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg2NDIxMCkK
KyNkZWZpbmUgX0RQQ19BVVhfQ0hfREFUQTEJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg2
NDIxNCkKKyNkZWZpbmUgX0RQQ19BVVhfQ0hfREFUQTIJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUp
ICsgMHg2NDIxOCkKKyNkZWZpbmUgX0RQQ19BVVhfQ0hfREFUQTMJKERJU1BMQVlfTU1JT19CQVNF
KGk5MTUpICsgMHg2NDIxYykKKyNkZWZpbmUgX0RQQ19BVVhfQ0hfREFUQTQJKERJU1BMQVlfTU1J
T19CQVNFKGk5MTUpICsgMHg2NDIyMCkKKyNkZWZpbmUgX0RQQ19BVVhfQ0hfREFUQTUJKERJU1BM
QVlfTU1JT19CQVNFKGk5MTUpICsgMHg2NDIyNCkKKworI2RlZmluZSBfRFBEX0FVWF9DSF9DVEwJ
CShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQzMTApCisjZGVmaW5lIF9EUERfQVVYX0NI
X0RBVEExCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQzMTQpCisjZGVmaW5lIF9EUERf
QVVYX0NIX0RBVEEyCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQzMTgpCisjZGVmaW5l
IF9EUERfQVVYX0NIX0RBVEEzCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQzMWMpCisj
ZGVmaW5lIF9EUERfQVVYX0NIX0RBVEE0CShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NjQz
MjApCisjZGVmaW5lIF9EUERfQVVYX0NIX0RBVEE1CShESVNQTEFZX01NSU9fQkFTRShpOTE1KSAr
IDB4NjQzMjQpCisKKyNkZWZpbmUgX0RQRV9BVVhfQ0hfQ1RMCQkoRElTUExBWV9NTUlPX0JBU0Uo
aTkxNSkgKyAweDY0NDEwKQorI2RlZmluZSBfRFBFX0FVWF9DSF9EQVRBMQkoRElTUExBWV9NTUlP
X0JBU0UoaTkxNSkgKyAweDY0NDE0KQorI2RlZmluZSBfRFBFX0FVWF9DSF9EQVRBMgkoRElTUExB
WV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0NDE4KQorI2RlZmluZSBfRFBFX0FVWF9DSF9EQVRBMwko
RElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0NDFjKQorI2RlZmluZSBfRFBFX0FVWF9DSF9E
QVRBNAkoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0NDIwKQorI2RlZmluZSBfRFBFX0FV
WF9DSF9EQVRBNQkoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDY0NDI0KQorCisjZGVmaW5l
IF9EUEZfQVVYX0NIX0NUTAkJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg2NDUxMCkKKyNk
ZWZpbmUgX0RQRl9BVVhfQ0hfREFUQTEJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg2NDUx
NCkKKyNkZWZpbmUgX0RQRl9BVVhfQ0hfREFUQTIJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsg
MHg2NDUxOCkKKyNkZWZpbmUgX0RQRl9BVVhfQ0hfREFUQTMJKERJU1BMQVlfTU1JT19CQVNFKGk5
MTUpICsgMHg2NDUxYykKKyNkZWZpbmUgX0RQRl9BVVhfQ0hfREFUQTQJKERJU1BMQVlfTU1JT19C
QVNFKGk5MTUpICsgMHg2NDUyMCkKKyNkZWZpbmUgX0RQRl9BVVhfQ0hfREFUQTUJKERJU1BMQVlf
TU1JT19CQVNFKGk5MTUpICsgMHg2NDUyNCkKIAogI2RlZmluZSBEUF9BVVhfQ0hfQ1RMKGF1eF9j
aCkJX01NSU9fUE9SVChhdXhfY2gsIF9EUEFfQVVYX0NIX0NUTCwgX0RQQl9BVVhfQ0hfQ1RMKQog
I2RlZmluZSBEUF9BVVhfQ0hfREFUQShhdXhfY2gsIGkpCV9NTUlPKF9QT1JUKGF1eF9jaCwgX0RQ
QV9BVVhfQ0hfREFUQTEsIF9EUEJfQVVYX0NIX0RBVEExKSArIChpKSAqIDQpIC8qIDUgcmVnaXN0
ZXJzICovCkBAIC01ODQzLDcgKzU4NDMsNyBAQCBlbnVtIHsKICNkZWZpbmUgICBEUElOVkdUVF9T
VEFUVVNfTUFTSwkJCTB4ZmYKICNkZWZpbmUgICBEUElOVkdUVF9TVEFUVVNfTUFTS19DSFYJCTB4
ZmZmCiAKLSNkZWZpbmUgRFNQQVJCCQkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYp
ICsgMHg3MDAzMCkKKyNkZWZpbmUgRFNQQVJCCQkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoaTkx
NSkgKyAweDcwMDMwKQogI2RlZmluZSAgIERTUEFSQl9DU1RBUlRfTUFTSwkoMHg3ZiA8PCA3KQog
I2RlZmluZSAgIERTUEFSQl9DU1RBUlRfU0hJRlQJNwogI2RlZmluZSAgIERTUEFSQl9CU1RBUlRf
TUFTSwkoMHg3ZikKQEAgLTU4NzgsNyArNTg3OCw3IEBAIGVudW0gewogI2RlZmluZSAgIERTUEFS
Ql9TUFJJVEVGX01BU0tfVkxWCSgweGZmIDw8IDgpCiAKIC8qIHBudi9nZW40L2c0eC92bHYvY2h2
ICovCi0jZGVmaW5lIERTUEZXMQkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsg
MHg3MDAzNCkKKyNkZWZpbmUgRFNQRlcxCQlfTU1JTyhESVNQTEFZX01NSU9fQkFTRShpOTE1KSAr
IDB4NzAwMzQpCiAjZGVmaW5lICAgRFNQRldfU1JfU0hJRlQJCTIzCiAjZGVmaW5lICAgRFNQRldf
U1JfTUFTSwkJCSgweDFmZiA8PCAyMykKICNkZWZpbmUgICBEU1BGV19DVVJTT1JCX1NISUZUCQkx
NgpAQCAtNTg4OSw3ICs1ODg5LDcgQEAgZW51bSB7CiAjZGVmaW5lICAgRFNQRldfUExBTkVBX1NI
SUZUCQkwCiAjZGVmaW5lICAgRFNQRldfUExBTkVBX01BU0sJCSgweDdmIDw8IDApCiAjZGVmaW5l
ICAgRFNQRldfUExBTkVBX01BU0tfVkxWCQkoMHhmZiA8PCAwKSAvKiB2bHYvY2h2ICovCi0jZGVm
aW5lIERTUEZXMgkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg3MDAzOCkK
KyNkZWZpbmUgRFNQRlcyCQlfTU1JTyhESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzAwMzgp
CiAjZGVmaW5lICAgRFNQRldfRkJDX1NSX0VOCQkoMSA8PCAzMSkJICAvKiBnNHggKi8KICNkZWZp
bmUgICBEU1BGV19GQkNfU1JfU0hJRlQJCTI4CiAjZGVmaW5lICAgRFNQRldfRkJDX1NSX01BU0sJ
CSgweDcgPDwgMjgpIC8qIGc0eCAqLwpAQCAtNTkwNSw3ICs1OTA1LDcgQEAgZW51bSB7CiAjZGVm
aW5lICAgRFNQRldfU1BSSVRFQV9TSElGVAkJMAogI2RlZmluZSAgIERTUEZXX1NQUklURUFfTUFT
SwkJKDB4N2YgPDwgMCkgLyogZzR4ICovCiAjZGVmaW5lICAgRFNQRldfU1BSSVRFQV9NQVNLX1ZM
VgkoMHhmZiA8PCAwKSAvKiB2bHYvY2h2ICovCi0jZGVmaW5lIERTUEZXMwkJX01NSU8oRElTUExB
WV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg3MDAzYykKKyNkZWZpbmUgRFNQRlczCQlfTU1JTyhE
SVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzAwM2MpCiAjZGVmaW5lICAgRFNQRldfSFBMTF9T
Ul9FTgkJKDEgPDwgMzEpCiAjZGVmaW5lICAgUElORVZJRVdfU0VMRl9SRUZSRVNIX0VOCSgxIDw8
IDMwKQogI2RlZmluZSAgIERTUEZXX0NVUlNPUl9TUl9TSElGVAkJMjQKQEAgLTYzMjIsMzUgKzYz
MjIsMzUgQEAgZW51bSB7CiAgKiBbMTA6MWZdIGFsbAogICogWzMwOjMyXSBhbGwKICAqLwotI2Rl
ZmluZSBTV0YwKGkpCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NzA0MTAg
KyAoaSkgKiA0KQotI2RlZmluZSBTV0YxKGkpCV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGRldl9w
cml2KSArIDB4NzE0MTAgKyAoaSkgKiA0KQotI2RlZmluZSBTV0YzKGkpCV9NTUlPKERJU1BMQVlf
TU1JT19CQVNFKGRldl9wcml2KSArIDB4NzI0MTQgKyAoaSkgKiA0KQorI2RlZmluZSBTV0YwKGkp
CV9NTUlPKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg3MDQxMCArIChpKSAqIDQpCisjZGVm
aW5lIFNXRjEoaSkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDcxNDEwICsgKGkp
ICogNCkKKyNkZWZpbmUgU1dGMyhpKQlfTU1JTyhESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4
NzI0MTQgKyAoaSkgKiA0KQogI2RlZmluZSBTV0ZfSUxLKGkpCV9NTUlPKDB4NEYwMDAgKyAoaSkg
KiA0KQogCiAvKiBQaXBlIEIgKi8KLSNkZWZpbmUgX1BJUEVCRFNMCQkoRElTUExBWV9NTUlPX0JB
U0UoZGV2X3ByaXYpICsgMHg3MTAwMCkKLSNkZWZpbmUgX1BJUEVCQ09ORgkJKERJU1BMQVlfTU1J
T19CQVNFKGRldl9wcml2KSArIDB4NzEwMDgpCi0jZGVmaW5lIF9QSVBFQlNUQVQJCShESVNQTEFZ
X01NSU9fQkFTRShkZXZfcHJpdikgKyAweDcxMDI0KQorI2RlZmluZSBfUElQRUJEU0wJCShESVNQ
TEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzEwMDApCisjZGVmaW5lIF9QSVBFQkNPTkYJCShESVNQ
TEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzEwMDgpCisjZGVmaW5lIF9QSVBFQlNUQVQJCShESVNQ
TEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzEwMjQpCiAjZGVmaW5lIF9QSVBFQkZSQU1FSElHSAkJ
MHg3MTA0MAogI2RlZmluZSBfUElQRUJGUkFNRVBJWEVMCTB4NzEwNDQKLSNkZWZpbmUgX1BJUEVC
X0ZSTUNPVU5UX0c0WAkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg3MTA0MCkKLSNk
ZWZpbmUgX1BJUEVCX0ZMSVBDT1VOVF9HNFgJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSAr
IDB4NzEwNDQpCisjZGVmaW5lIF9QSVBFQl9GUk1DT1VOVF9HNFgJKERJU1BMQVlfTU1JT19CQVNF
KGk5MTUpICsgMHg3MTA0MCkKKyNkZWZpbmUgX1BJUEVCX0ZMSVBDT1VOVF9HNFgJKERJU1BMQVlf
TU1JT19CQVNFKGk5MTUpICsgMHg3MTA0NCkKIAogCiAvKiBEaXNwbGF5IEIgY29udHJvbCAqLwot
I2RlZmluZSBfRFNQQkNOVFIJCShESVNQTEFZX01NSU9fQkFTRShkZXZfcHJpdikgKyAweDcxMTgw
KQorI2RlZmluZSBfRFNQQkNOVFIJCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzExODAp
CiAjZGVmaW5lICAgRElTUFBMQU5FX0FMUEhBX1RSQU5TX0VOQUJMRQkJKDEgPDwgMTUpCiAjZGVm
aW5lICAgRElTUFBMQU5FX0FMUEhBX1RSQU5TX0RJU0FCTEUJCTAKICNkZWZpbmUgICBESVNQUExB
TkVfU1BSSVRFX0FCT1ZFX0RJU1BMQVkJMAogI2RlZmluZSAgIERJU1BQTEFORV9TUFJJVEVfQUJP
VkVfT1ZFUkxBWQkoMSkKLSNkZWZpbmUgX0RTUEJBRERSCQkoRElTUExBWV9NTUlPX0JBU0UoZGV2
X3ByaXYpICsgMHg3MTE4NCkKLSNkZWZpbmUgX0RTUEJTVFJJREUJCShESVNQTEFZX01NSU9fQkFT
RShkZXZfcHJpdikgKyAweDcxMTg4KQotI2RlZmluZSBfRFNQQlBPUwkJKERJU1BMQVlfTU1JT19C
QVNFKGRldl9wcml2KSArIDB4NzExOEMpCi0jZGVmaW5lIF9EU1BCU0laRQkJKERJU1BMQVlfTU1J
T19CQVNFKGRldl9wcml2KSArIDB4NzExOTApCi0jZGVmaW5lIF9EU1BCU1VSRgkJKERJU1BMQVlf
TU1JT19CQVNFKGRldl9wcml2KSArIDB4NzExOUMpCi0jZGVmaW5lIF9EU1BCVElMRU9GRgkJKERJ
U1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NzExQTQpCi0jZGVmaW5lIF9EU1BCT0ZGU0VU
CQkoRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg3MTFBNCkKLSNkZWZpbmUgX0RTUEJT
VVJGTElWRQkJKERJU1BMQVlfTU1JT19CQVNFKGRldl9wcml2KSArIDB4NzExQUMpCisjZGVmaW5l
IF9EU1BCQUREUgkJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg3MTE4NCkKKyNkZWZpbmUg
X0RTUEJTVFJJREUJCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzExODgpCisjZGVmaW5l
IF9EU1BCUE9TCQkoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDcxMThDKQorI2RlZmluZSBf
RFNQQlNJWkUJCShESVNQTEFZX01NSU9fQkFTRShpOTE1KSArIDB4NzExOTApCisjZGVmaW5lIF9E
U1BCU1VSRgkJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg3MTE5QykKKyNkZWZpbmUgX0RT
UEJUSUxFT0ZGCQkoRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDcxMUE0KQorI2RlZmluZSBf
RFNQQk9GRlNFVAkJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg3MTFBNCkKKyNkZWZpbmUg
X0RTUEJTVVJGTElWRQkJKERJU1BMQVlfTU1JT19CQVNFKGk5MTUpICsgMHg3MTFBQykKIAogLyog
SUNMIERTSSAwIGFuZCAxICovCiAjZGVmaW5lIF9QSVBFRFNJMENPTkYJCTB4N2IwMDgKQEAgLTg5
NDYsNyArODk0Niw3IEBAIGVudW0gewogI2RlZmluZSAgIEdFTjlfRU5BQkxFX0dQR1BVX1BSRUVN
UFRJT04JKDEgPDwgMikKIAogLyogQXVkaW8gKi8KLSNkZWZpbmUgRzRYX0FVRF9WSURfRElECQkJ
X01NSU8oRElTUExBWV9NTUlPX0JBU0UoZGV2X3ByaXYpICsgMHg2MjAyMCkKKyNkZWZpbmUgRzRY
X0FVRF9WSURfRElECQkJX01NSU8oRElTUExBWV9NTUlPX0JBU0UoaTkxNSkgKyAweDYyMDIwKQog
I2RlZmluZSAgIElOVEVMX0FVRElPX0RFVkNMCQkweDgwODYyOUZCCiAjZGVmaW5lICAgSU5URUxf
QVVESU9fREVWQkxDCQkweDgwODYyODAxCiAjZGVmaW5lICAgSU5URUxfQVVESU9fREVWQ1RHCQkw
eDgwODYyODAyCkBAIC0xMDQ2OSw4ICsxMDQ2OSw4IEBAIGVudW0gc2tsX3Bvd2VyX2dhdGUgewog
CiAvKiBNSVBJIERTSSBDb250cm9sbGVyIGFuZCBELVBIWSByZWdpc3RlcnMgKi8KIAotI2RlZmlu
ZSBfTUlQSUFfREVWSUNFX1JFQURZCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDAw
KQotI2RlZmluZSBfTUlQSUNfREVWSUNFX1JFQURZCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNl
ICsgMHhiODAwKQorI2RlZmluZSBfTUlQSUFfREVWSUNFX1JFQURZCQkoaTkxNS0+bWlwaV9tbWlv
X2Jhc2UgKyAweGIwMDApCisjZGVmaW5lIF9NSVBJQ19ERVZJQ0VfUkVBRFkJCShpOTE1LT5taXBp
X21taW9fYmFzZSArIDB4YjgwMCkKICNkZWZpbmUgTUlQSV9ERVZJQ0VfUkVBRFkocG9ydCkJCV9N
TUlPX01JUEkocG9ydCwgX01JUElBX0RFVklDRV9SRUFEWSwgX01JUElDX0RFVklDRV9SRUFEWSkK
ICNkZWZpbmUgIEJVU19QT1NTRVNTSU9OCQkJCQkoMSA8PCAzKSAvKiBzZXQgdG8gZ2l2ZSBidXMg
dG8gcmVjZWl2ZXIgKi8KICNkZWZpbmUgIFVMUFNfU1RBVEVfTUFTSwkJCQkoMyA8PCAxKQpAQCAt
MTA0NzksMTEgKzEwNDc5LDExIEBAIGVudW0gc2tsX3Bvd2VyX2dhdGUgewogI2RlZmluZSAgVUxQ
U19TVEFURV9OT1JNQUxfT1BFUkFUSU9OCQkJKDAgPDwgMSkKICNkZWZpbmUgIERFVklDRV9SRUFE
WQkJCQkJKDEgPDwgMCkKIAotI2RlZmluZSBfTUlQSUFfSU5UUl9TVEFUCQkoZGV2X3ByaXYtPm1p
cGlfbW1pb19iYXNlICsgMHhiMDA0KQotI2RlZmluZSBfTUlQSUNfSU5UUl9TVEFUCQkoZGV2X3By
aXYtPm1pcGlfbW1pb19iYXNlICsgMHhiODA0KQorI2RlZmluZSBfTUlQSUFfSU5UUl9TVEFUCQko
aTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwMDQpCisjZGVmaW5lIF9NSVBJQ19JTlRSX1NUQVQJ
CShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4YjgwNCkKICNkZWZpbmUgTUlQSV9JTlRSX1NUQVQo
cG9ydCkJCV9NTUlPX01JUEkocG9ydCwgX01JUElBX0lOVFJfU1RBVCwgX01JUElDX0lOVFJfU1RB
VCkKLSNkZWZpbmUgX01JUElBX0lOVFJfRU4JCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsg
MHhiMDA4KQotI2RlZmluZSBfTUlQSUNfSU5UUl9FTgkJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jh
c2UgKyAweGI4MDgpCisjZGVmaW5lIF9NSVBJQV9JTlRSX0VOCQkJKGk5MTUtPm1pcGlfbW1pb19i
YXNlICsgMHhiMDA4KQorI2RlZmluZSBfTUlQSUNfSU5UUl9FTgkJCShpOTE1LT5taXBpX21taW9f
YmFzZSArIDB4YjgwOCkKICNkZWZpbmUgTUlQSV9JTlRSX0VOKHBvcnQpCQlfTU1JT19NSVBJKHBv
cnQsIF9NSVBJQV9JTlRSX0VOLCBfTUlQSUNfSU5UUl9FTikKICNkZWZpbmUgIFRFQVJJTkdfRUZG
RUNUCQkJCQkoMSA8PCAzMSkKICNkZWZpbmUgIFNQTF9QS1RfU0VOVF9JTlRFUlJVUFQJCQkJKDEg
PDwgMzApCkBAIC0xMDUxOCw4ICsxMDUxOCw4IEBAIGVudW0gc2tsX3Bvd2VyX2dhdGUgewogI2Rl
ZmluZSAgUlhTT1RfU1lOQ19FUlJPUgkJCQkoMSA8PCAxKQogI2RlZmluZSAgUlhTT1RfRVJST1IJ
CQkJCSgxIDw8IDApCiAKLSNkZWZpbmUgX01JUElBX0RTSV9GVU5DX1BSRwkJKGRldl9wcml2LT5t
aXBpX21taW9fYmFzZSArIDB4YjAwYykKLSNkZWZpbmUgX01JUElDX0RTSV9GVU5DX1BSRwkJKGRl
dl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4YjgwYykKKyNkZWZpbmUgX01JUElBX0RTSV9GVU5D
X1BSRwkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDBjKQorI2RlZmluZSBfTUlQSUNfRFNJ
X0ZVTkNfUFJHCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4MGMpCiAjZGVmaW5lIE1JUElf
RFNJX0ZVTkNfUFJHKHBvcnQpCQlfTU1JT19NSVBJKHBvcnQsIF9NSVBJQV9EU0lfRlVOQ19QUkcs
IF9NSVBJQ19EU0lfRlVOQ19QUkcpCiAjZGVmaW5lICBDTURfTU9ERV9EQVRBX1dJRFRIX01BU0sJ
CQkoNyA8PCAxMykKICNkZWZpbmUgIENNRF9NT0RFX05PVF9TVVBQT1JURUQJCQkJKDAgPDwgMTMp
CkBAIC0xMDU0MSw3OCArMTA1NDEsNzggQEAgZW51bSBza2xfcG93ZXJfZ2F0ZSB7CiAjZGVmaW5l
ICBEQVRBX0xBTkVTX1BSR19SRUdfU0hJRlQJCQkwCiAjZGVmaW5lICBEQVRBX0xBTkVTX1BSR19S
RUdfTUFTSwkJCSg3IDw8IDApCiAKLSNkZWZpbmUgX01JUElBX0hTX1RYX1RJTUVPVVQJCShkZXZf
cHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwMTApCi0jZGVmaW5lIF9NSVBJQ19IU19UWF9USU1F
T1VUCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiODEwKQorI2RlZmluZSBfTUlQSUFf
SFNfVFhfVElNRU9VVAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDEwKQorI2RlZmluZSBf
TUlQSUNfSFNfVFhfVElNRU9VVAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODEwKQogI2Rl
ZmluZSBNSVBJX0hTX1RYX1RJTUVPVVQocG9ydCkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfSFNf
VFhfVElNRU9VVCwgX01JUElDX0hTX1RYX1RJTUVPVVQpCiAjZGVmaW5lICBISUdIX1NQRUVEX1RY
X1RJTUVPVVRfQ09VTlRFUl9NQVNLCQkweGZmZmZmZgogCi0jZGVmaW5lIF9NSVBJQV9MUF9SWF9U
SU1FT1VUCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDE0KQotI2RlZmluZSBfTUlQ
SUNfTFBfUlhfVElNRU9VVAkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4YjgxNCkKKyNk
ZWZpbmUgX01JUElBX0xQX1JYX1RJTUVPVVQJCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4YjAx
NCkKKyNkZWZpbmUgX01JUElDX0xQX1JYX1RJTUVPVVQJCShpOTE1LT5taXBpX21taW9fYmFzZSAr
IDB4YjgxNCkKICNkZWZpbmUgTUlQSV9MUF9SWF9USU1FT1VUKHBvcnQpCV9NTUlPX01JUEkocG9y
dCwgX01JUElBX0xQX1JYX1RJTUVPVVQsIF9NSVBJQ19MUF9SWF9USU1FT1VUKQogI2RlZmluZSAg
TE9XX1BPV0VSX1JYX1RJTUVPVVRfQ09VTlRFUl9NQVNLCQkweGZmZmZmZgogCi0jZGVmaW5lIF9N
SVBJQV9UVVJOX0FST1VORF9USU1FT1VUCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIw
MTgpCi0jZGVmaW5lIF9NSVBJQ19UVVJOX0FST1VORF9USU1FT1VUCShkZXZfcHJpdi0+bWlwaV9t
bWlvX2Jhc2UgKyAweGI4MTgpCisjZGVmaW5lIF9NSVBJQV9UVVJOX0FST1VORF9USU1FT1VUCShp
OTE1LT5taXBpX21taW9fYmFzZSArIDB4YjAxOCkKKyNkZWZpbmUgX01JUElDX1RVUk5fQVJPVU5E
X1RJTUVPVVQJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODE4KQogI2RlZmluZSBNSVBJX1RV
Uk5fQVJPVU5EX1RJTUVPVVQocG9ydCkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfVFVSTl9BUk9V
TkRfVElNRU9VVCwgX01JUElDX1RVUk5fQVJPVU5EX1RJTUVPVVQpCiAjZGVmaW5lICBUVVJOX0FS
T1VORF9USU1FT1VUX01BU0sJCQkweDNmCiAKLSNkZWZpbmUgX01JUElBX0RFVklDRV9SRVNFVF9U
SU1FUgkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDFjKQotI2RlZmluZSBfTUlQSUNf
REVWSUNFX1JFU0VUX1RJTUVSCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4MWMpCisj
ZGVmaW5lIF9NSVBJQV9ERVZJQ0VfUkVTRVRfVElNRVIJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsg
MHhiMDFjKQorI2RlZmluZSBfTUlQSUNfREVWSUNFX1JFU0VUX1RJTUVSCShpOTE1LT5taXBpX21t
aW9fYmFzZSArIDB4YjgxYykKICNkZWZpbmUgTUlQSV9ERVZJQ0VfUkVTRVRfVElNRVIocG9ydCkJ
X01NSU9fTUlQSShwb3J0LCBfTUlQSUFfREVWSUNFX1JFU0VUX1RJTUVSLCBfTUlQSUNfREVWSUNF
X1JFU0VUX1RJTUVSKQogI2RlZmluZSAgREVWSUNFX1JFU0VUX1RJTUVSX01BU0sJCQkweGZmZmYK
IAotI2RlZmluZSBfTUlQSUFfRFBJX1JFU09MVVRJT04JCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jh
c2UgKyAweGIwMjApCi0jZGVmaW5lIF9NSVBJQ19EUElfUkVTT0xVVElPTgkJKGRldl9wcml2LT5t
aXBpX21taW9fYmFzZSArIDB4YjgyMCkKKyNkZWZpbmUgX01JUElBX0RQSV9SRVNPTFVUSU9OCQko
aTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwMjApCisjZGVmaW5lIF9NSVBJQ19EUElfUkVTT0xV
VElPTgkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODIwKQogI2RlZmluZSBNSVBJX0RQSV9S
RVNPTFVUSU9OKHBvcnQpCV9NTUlPX01JUEkocG9ydCwgX01JUElBX0RQSV9SRVNPTFVUSU9OLCBf
TUlQSUNfRFBJX1JFU09MVVRJT04pCiAjZGVmaW5lICBWRVJUSUNBTF9BRERSRVNTX1NISUZUCQkJ
CTE2CiAjZGVmaW5lICBWRVJUSUNBTF9BRERSRVNTX01BU0sJCQkJKDB4ZmZmZiA8PCAxNikKICNk
ZWZpbmUgIEhPUklaT05UQUxfQUREUkVTU19TSElGVAkJCTAKICNkZWZpbmUgIEhPUklaT05UQUxf
QUREUkVTU19NQVNLCQkJMHhmZmZmCiAKLSNkZWZpbmUgX01JUElBX0RCSV9GSUZPX1RIUk9UVExF
CShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwMjQpCi0jZGVmaW5lIF9NSVBJQ19EQklf
RklGT19USFJPVFRMRQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiODI0KQorI2RlZmlu
ZSBfTUlQSUFfREJJX0ZJRk9fVEhST1RUTEUJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDI0
KQorI2RlZmluZSBfTUlQSUNfREJJX0ZJRk9fVEhST1RUTEUJKGk5MTUtPm1pcGlfbW1pb19iYXNl
ICsgMHhiODI0KQogI2RlZmluZSBNSVBJX0RCSV9GSUZPX1RIUk9UVExFKHBvcnQpCV9NTUlPX01J
UEkocG9ydCwgX01JUElBX0RCSV9GSUZPX1RIUk9UVExFLCBfTUlQSUNfREJJX0ZJRk9fVEhST1RU
TEUpCiAjZGVmaW5lICBEQklfRklGT19FTVBUWV9IQUxGCQkJCSgwIDw8IDApCiAjZGVmaW5lICBE
QklfRklGT19FTVBUWV9RVUFSVEVSCQkJCSgxIDw8IDApCiAjZGVmaW5lICBEQklfRklGT19FTVBU
WV83X0xPQ0FUSU9OUwkJCSgyIDw8IDApCiAKIC8qIHJlZ3MgYmVsb3cgYXJlIGJpdHMgMTU6MCAq
LwotI2RlZmluZSBfTUlQSUFfSFNZTkNfUEFERElOR19DT1VOVAkoZGV2X3ByaXYtPm1pcGlfbW1p
b19iYXNlICsgMHhiMDI4KQotI2RlZmluZSBfTUlQSUNfSFNZTkNfUEFERElOR19DT1VOVAkoZGV2
X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiODI4KQorI2RlZmluZSBfTUlQSUFfSFNZTkNfUEFE
RElOR19DT1VOVAkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwMjgpCisjZGVmaW5lIF9NSVBJ
Q19IU1lOQ19QQURESU5HX0NPVU5UCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4YjgyOCkKICNk
ZWZpbmUgTUlQSV9IU1lOQ19QQURESU5HX0NPVU5UKHBvcnQpCV9NTUlPX01JUEkocG9ydCwgX01J
UElBX0hTWU5DX1BBRERJTkdfQ09VTlQsIF9NSVBJQ19IU1lOQ19QQURESU5HX0NPVU5UKQogCi0j
ZGVmaW5lIF9NSVBJQV9IQlBfQ09VTlQJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIw
MmMpCi0jZGVmaW5lIF9NSVBJQ19IQlBfQ09VTlQJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2Ug
KyAweGI4MmMpCisjZGVmaW5lIF9NSVBJQV9IQlBfQ09VTlQJCShpOTE1LT5taXBpX21taW9fYmFz
ZSArIDB4YjAyYykKKyNkZWZpbmUgX01JUElDX0hCUF9DT1VOVAkJKGk5MTUtPm1pcGlfbW1pb19i
YXNlICsgMHhiODJjKQogI2RlZmluZSBNSVBJX0hCUF9DT1VOVChwb3J0KQkJX01NSU9fTUlQSShw
b3J0LCBfTUlQSUFfSEJQX0NPVU5ULCBfTUlQSUNfSEJQX0NPVU5UKQogCi0jZGVmaW5lIF9NSVBJ
QV9IRlBfQ09VTlQJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwMzApCi0jZGVmaW5l
IF9NSVBJQ19IRlBfQ09VTlQJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4MzApCisj
ZGVmaW5lIF9NSVBJQV9IRlBfQ09VTlQJCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4YjAzMCkK
KyNkZWZpbmUgX01JUElDX0hGUF9DT1VOVAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODMw
KQogI2RlZmluZSBNSVBJX0hGUF9DT1VOVChwb3J0KQkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFf
SEZQX0NPVU5ULCBfTUlQSUNfSEZQX0NPVU5UKQogCi0jZGVmaW5lIF9NSVBJQV9IQUNUSVZFX0FS
RUFfQ09VTlQJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4YjAzNCkKLSNkZWZpbmUgX01J
UElDX0hBQ1RJVkVfQVJFQV9DT1VOVAkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiODM0
KQorI2RlZmluZSBfTUlQSUFfSEFDVElWRV9BUkVBX0NPVU5UCShpOTE1LT5taXBpX21taW9fYmFz
ZSArIDB4YjAzNCkKKyNkZWZpbmUgX01JUElDX0hBQ1RJVkVfQVJFQV9DT1VOVAkoaTkxNS0+bWlw
aV9tbWlvX2Jhc2UgKyAweGI4MzQpCiAjZGVmaW5lIE1JUElfSEFDVElWRV9BUkVBX0NPVU5UKHBv
cnQpCV9NTUlPX01JUEkocG9ydCwgX01JUElBX0hBQ1RJVkVfQVJFQV9DT1VOVCwgX01JUElDX0hB
Q1RJVkVfQVJFQV9DT1VOVCkKIAotI2RlZmluZSBfTUlQSUFfVlNZTkNfUEFERElOR19DT1VOVAko
ZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDM4KQotI2RlZmluZSBfTUlQSUNfVlNZTkNf
UEFERElOR19DT1VOVAkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiODM4KQorI2RlZmlu
ZSBfTUlQSUFfVlNZTkNfUEFERElOR19DT1VOVAkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIw
MzgpCisjZGVmaW5lIF9NSVBJQ19WU1lOQ19QQURESU5HX0NPVU5UCShpOTE1LT5taXBpX21taW9f
YmFzZSArIDB4YjgzOCkKICNkZWZpbmUgTUlQSV9WU1lOQ19QQURESU5HX0NPVU5UKHBvcnQpCV9N
TUlPX01JUEkocG9ydCwgX01JUElBX1ZTWU5DX1BBRERJTkdfQ09VTlQsIF9NSVBJQ19WU1lOQ19Q
QURESU5HX0NPVU5UKQogCi0jZGVmaW5lIF9NSVBJQV9WQlBfQ09VTlQJCShkZXZfcHJpdi0+bWlw
aV9tbWlvX2Jhc2UgKyAweGIwM2MpCi0jZGVmaW5lIF9NSVBJQ19WQlBfQ09VTlQJCShkZXZfcHJp
di0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4M2MpCisjZGVmaW5lIF9NSVBJQV9WQlBfQ09VTlQJCShp
OTE1LT5taXBpX21taW9fYmFzZSArIDB4YjAzYykKKyNkZWZpbmUgX01JUElDX1ZCUF9DT1VOVAkJ
KGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODNjKQogI2RlZmluZSBNSVBJX1ZCUF9DT1VOVChw
b3J0KQkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfVkJQX0NPVU5ULCBfTUlQSUNfVkJQX0NPVU5U
KQogCi0jZGVmaW5lIF9NSVBJQV9WRlBfQ09VTlQJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2Ug
KyAweGIwNDApCi0jZGVmaW5lIF9NSVBJQ19WRlBfQ09VTlQJCShkZXZfcHJpdi0+bWlwaV9tbWlv
X2Jhc2UgKyAweGI4NDApCisjZGVmaW5lIF9NSVBJQV9WRlBfQ09VTlQJCShpOTE1LT5taXBpX21t
aW9fYmFzZSArIDB4YjA0MCkKKyNkZWZpbmUgX01JUElDX1ZGUF9DT1VOVAkJKGk5MTUtPm1pcGlf
bW1pb19iYXNlICsgMHhiODQwKQogI2RlZmluZSBNSVBJX1ZGUF9DT1VOVChwb3J0KQkJX01NSU9f
TUlQSShwb3J0LCBfTUlQSUFfVkZQX0NPVU5ULCBfTUlQSUNfVkZQX0NPVU5UKQogCi0jZGVmaW5l
IF9NSVBJQV9ISUdIX0xPV19TV0lUQ0hfQ09VTlQJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSAr
IDB4YjA0NCkKLSNkZWZpbmUgX01JUElDX0hJR0hfTE9XX1NXSVRDSF9DT1VOVAkoZGV2X3ByaXYt
Pm1pcGlfbW1pb19iYXNlICsgMHhiODQ0KQorI2RlZmluZSBfTUlQSUFfSElHSF9MT1dfU1dJVENI
X0NPVU5UCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4YjA0NCkKKyNkZWZpbmUgX01JUElDX0hJ
R0hfTE9XX1NXSVRDSF9DT1VOVAkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4NDQpCiAjZGVm
aW5lIE1JUElfSElHSF9MT1dfU1dJVENIX0NPVU5UKHBvcnQpCV9NTUlPX01JUEkocG9ydCwJX01J
UElBX0hJR0hfTE9XX1NXSVRDSF9DT1VOVCwgX01JUElDX0hJR0hfTE9XX1NXSVRDSF9DT1VOVCkK
IAogLyogcmVncyBhYm92ZSBhcmUgYml0cyAxNTowICovCiAKLSNkZWZpbmUgX01JUElBX0RQSV9D
T05UUk9MCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDQ4KQotI2RlZmluZSBfTUlQ
SUNfRFBJX0NPTlRST0wJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4NDgpCisjZGVm
aW5lIF9NSVBJQV9EUElfQ09OVFJPTAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDQ4KQor
I2RlZmluZSBfTUlQSUNfRFBJX0NPTlRST0wJCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4Yjg0
OCkKICNkZWZpbmUgTUlQSV9EUElfQ09OVFJPTChwb3J0KQkJX01NSU9fTUlQSShwb3J0LCBfTUlQ
SUFfRFBJX0NPTlRST0wsIF9NSVBJQ19EUElfQ09OVFJPTCkKICNkZWZpbmUgIERQSV9MUF9NT0RF
CQkJCQkoMSA8PCA2KQogI2RlZmluZSAgQkFDS0xJR0hUX09GRgkJCQkJKDEgPDwgNSkKQEAgLTEw
NjIyLDI3ICsxMDYyMiwyNyBAQCBlbnVtIHNrbF9wb3dlcl9nYXRlIHsKICNkZWZpbmUgIFRVUk5f
T04JCQkJCSgxIDw8IDEpCiAjZGVmaW5lICBTSFVURE9XTgkJCQkJKDEgPDwgMCkKIAotI2RlZmlu
ZSBfTUlQSUFfRFBJX0RBVEEJCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDRjKQot
I2RlZmluZSBfTUlQSUNfRFBJX0RBVEEJCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhi
ODRjKQorI2RlZmluZSBfTUlQSUFfRFBJX0RBVEEJCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAw
eGIwNGMpCisjZGVmaW5lIF9NSVBJQ19EUElfREFUQQkJCShpOTE1LT5taXBpX21taW9fYmFzZSAr
IDB4Yjg0YykKICNkZWZpbmUgTUlQSV9EUElfREFUQShwb3J0KQkJX01NSU9fTUlQSShwb3J0LCBf
TUlQSUFfRFBJX0RBVEEsIF9NSVBJQ19EUElfREFUQSkKICNkZWZpbmUgIENPTU1BTkRfQllURV9T
SElGVAkJCQkwCiAjZGVmaW5lICBDT01NQU5EX0JZVEVfTUFTSwkJCQkoMHgzZiA8PCAwKQogCi0j
ZGVmaW5lIF9NSVBJQV9JTklUX0NPVU5UCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhi
MDUwKQotI2RlZmluZSBfTUlQSUNfSU5JVF9DT1VOVAkJKGRldl9wcml2LT5taXBpX21taW9fYmFz
ZSArIDB4Yjg1MCkKKyNkZWZpbmUgX01JUElBX0lOSVRfQ09VTlQJCShpOTE1LT5taXBpX21taW9f
YmFzZSArIDB4YjA1MCkKKyNkZWZpbmUgX01JUElDX0lOSVRfQ09VTlQJCShpOTE1LT5taXBpX21t
aW9fYmFzZSArIDB4Yjg1MCkKICNkZWZpbmUgTUlQSV9JTklUX0NPVU5UKHBvcnQpCQlfTU1JT19N
SVBJKHBvcnQsIF9NSVBJQV9JTklUX0NPVU5ULCBfTUlQSUNfSU5JVF9DT1VOVCkKICNkZWZpbmUg
IE1BU1RFUl9JTklUX1RJTUVSX1NISUZUCQkJMAogI2RlZmluZSAgTUFTVEVSX0lOSVRfVElNRVJf
TUFTSwkJCQkoMHhmZmZmIDw8IDApCiAKLSNkZWZpbmUgX01JUElBX01BWF9SRVRVUk5fUEtUX1NJ
WkUJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4YjA1NCkKLSNkZWZpbmUgX01JUElDX01B
WF9SRVRVUk5fUEtUX1NJWkUJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4Yjg1NCkKKyNk
ZWZpbmUgX01JUElBX01BWF9SRVRVUk5fUEtUX1NJWkUJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsg
MHhiMDU0KQorI2RlZmluZSBfTUlQSUNfTUFYX1JFVFVSTl9QS1RfU0laRQkoaTkxNS0+bWlwaV9t
bWlvX2Jhc2UgKyAweGI4NTQpCiAjZGVmaW5lIE1JUElfTUFYX1JFVFVSTl9QS1RfU0laRShwb3J0
KQlfTU1JT19NSVBJKHBvcnQsIFwKIAkJCV9NSVBJQV9NQVhfUkVUVVJOX1BLVF9TSVpFLCBfTUlQ
SUNfTUFYX1JFVFVSTl9QS1RfU0laRSkKICNkZWZpbmUgIE1BWF9SRVRVUk5fUEtUX1NJWkVfU0hJ
RlQJCQkwCiAjZGVmaW5lICBNQVhfUkVUVVJOX1BLVF9TSVpFX01BU0sJCQkoMHgzZmYgPDwgMCkK
IAotI2RlZmluZSBfTUlQSUFfVklERU9fTU9ERV9GT1JNQVQJKGRldl9wcml2LT5taXBpX21taW9f
YmFzZSArIDB4YjA1OCkKLSNkZWZpbmUgX01JUElDX1ZJREVPX01PREVfRk9STUFUCShkZXZfcHJp
di0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4NTgpCisjZGVmaW5lIF9NSVBJQV9WSURFT19NT0RFX0ZP
Uk1BVAkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNTgpCisjZGVmaW5lIF9NSVBJQ19WSURF
T19NT0RFX0ZPUk1BVAkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4NTgpCiAjZGVmaW5lIE1J
UElfVklERU9fTU9ERV9GT1JNQVQocG9ydCkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfVklERU9f
TU9ERV9GT1JNQVQsIF9NSVBJQ19WSURFT19NT0RFX0ZPUk1BVCkKICNkZWZpbmUgIFJBTkRPTV9E
UElfRElTUExBWV9SRVNPTFVUSU9OCQkJKDEgPDwgNCkKICNkZWZpbmUgIERJU0FCTEVfVklERU9f
QlRBCQkJCSgxIDw8IDMpCkBAIC0xMDY1MSw4ICsxMDY1MSw4IEBAIGVudW0gc2tsX3Bvd2VyX2dh
dGUgewogI2RlZmluZSAgVklERU9fTU9ERV9OT05fQlVSU1RfV0lUSF9TWU5DX0VWRU5UUwkJKDIg
PDwgMCkKICNkZWZpbmUgIFZJREVPX01PREVfQlVSU1QJCQkJKDMgPDwgMCkKIAotI2RlZmluZSBf
TUlQSUFfRU9UX0RJU0FCTEUJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNWMpCi0j
ZGVmaW5lIF9NSVBJQ19FT1RfRElTQUJMRQkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4
Yjg1YykKKyNkZWZpbmUgX01JUElBX0VPVF9ESVNBQkxFCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2Ug
KyAweGIwNWMpCisjZGVmaW5lIF9NSVBJQ19FT1RfRElTQUJMRQkJKGk5MTUtPm1pcGlfbW1pb19i
YXNlICsgMHhiODVjKQogI2RlZmluZSBNSVBJX0VPVF9ESVNBQkxFKHBvcnQpCQlfTU1JT19NSVBJ
KHBvcnQsIF9NSVBJQV9FT1RfRElTQUJMRSwgX01JUElDX0VPVF9ESVNBQkxFKQogI2RlZmluZSAg
QlhUX0RFRkVBVFVSRV9EUElfRklGT19DVFIJCQkoMSA8PCA5KQogI2RlZmluZSAgQlhUX0RQSFlf
REVGRUFUVVJFX0VOCQkJCSgxIDw8IDgpCkBAIC0xMDY2NSwzNSArMTA2NjUsMzUgQEAgZW51bSBz
a2xfcG93ZXJfZ2F0ZSB7CiAjZGVmaW5lICBDTE9DS1NUT1AJCQkJCSgxIDw8IDEpCiAjZGVmaW5l
ICBFT1RfRElTQUJMRQkJCQkJKDEgPDwgMCkKIAotI2RlZmluZSBfTUlQSUFfTFBfQllURUNMSwkJ
KGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4YjA2MCkKLSNkZWZpbmUgX01JUElDX0xQX0JZ
VEVDTEsJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4NjApCisjZGVmaW5lIF9NSVBJ
QV9MUF9CWVRFQ0xLCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNjApCisjZGVmaW5lIF9N
SVBJQ19MUF9CWVRFQ0xLCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4NjApCiAjZGVmaW5l
IE1JUElfTFBfQllURUNMSyhwb3J0KQkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfTFBfQllURUNM
SywgX01JUElDX0xQX0JZVEVDTEspCiAjZGVmaW5lICBMUF9CWVRFQ0xLX1NISUZUCQkJCTAKICNk
ZWZpbmUgIExQX0JZVEVDTEtfTUFTSwkJCQkoMHhmZmZmIDw8IDApCiAKLSNkZWZpbmUgX01JUElB
X1RMUFhfVElNRV9DT1VOVAkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4YjBhNCkKLSNk
ZWZpbmUgX01JUElDX1RMUFhfVElNRV9DT1VOVAkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSAr
IDB4YjhhNCkKKyNkZWZpbmUgX01JUElBX1RMUFhfVElNRV9DT1VOVAkJKGk5MTUtPm1pcGlfbW1p
b19iYXNlICsgMHhiMGE0KQorI2RlZmluZSBfTUlQSUNfVExQWF9USU1FX0NPVU5UCQkoaTkxNS0+
bWlwaV9tbWlvX2Jhc2UgKyAweGI4YTQpCiAjZGVmaW5lIE1JUElfVExQWF9USU1FX0NPVU5UKHBv
cnQpCSBfTU1JT19NSVBJKHBvcnQsIF9NSVBJQV9UTFBYX1RJTUVfQ09VTlQsIF9NSVBJQ19UTFBY
X1RJTUVfQ09VTlQpCiAKLSNkZWZpbmUgX01JUElBX0NMS19MQU5FX1RJTUlORwkJKGRldl9wcml2
LT5taXBpX21taW9fYmFzZSArIDB4YjA5OCkKLSNkZWZpbmUgX01JUElDX0NMS19MQU5FX1RJTUlO
RwkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4Yjg5OCkKKyNkZWZpbmUgX01JUElBX0NM
S19MQU5FX1RJTUlORwkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDk4KQorI2RlZmluZSBf
TUlQSUNfQ0xLX0xBTkVfVElNSU5HCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4OTgpCiAj
ZGVmaW5lIE1JUElfQ0xLX0xBTkVfVElNSU5HKHBvcnQpCSBfTU1JT19NSVBJKHBvcnQsIF9NSVBJ
QV9DTEtfTEFORV9USU1JTkcsIF9NSVBJQ19DTEtfTEFORV9USU1JTkcpCiAKIC8qIGJpdHMgMzE6
MCAqLwotI2RlZmluZSBfTUlQSUFfTFBfR0VOX0RBVEEJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jh
c2UgKyAweGIwNjQpCi0jZGVmaW5lIF9NSVBJQ19MUF9HRU5fREFUQQkJKGRldl9wcml2LT5taXBp
X21taW9fYmFzZSArIDB4Yjg2NCkKKyNkZWZpbmUgX01JUElBX0xQX0dFTl9EQVRBCQkoaTkxNS0+
bWlwaV9tbWlvX2Jhc2UgKyAweGIwNjQpCisjZGVmaW5lIF9NSVBJQ19MUF9HRU5fREFUQQkJKGk5
MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODY0KQogI2RlZmluZSBNSVBJX0xQX0dFTl9EQVRBKHBv
cnQpCQlfTU1JT19NSVBJKHBvcnQsIF9NSVBJQV9MUF9HRU5fREFUQSwgX01JUElDX0xQX0dFTl9E
QVRBKQogCiAvKiBiaXRzIDMxOjAgKi8KLSNkZWZpbmUgX01JUElBX0hTX0dFTl9EQVRBCQkoZGV2
X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDY4KQotI2RlZmluZSBfTUlQSUNfSFNfR0VOX0RB
VEEJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4NjgpCisjZGVmaW5lIF9NSVBJQV9I
U19HRU5fREFUQQkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDY4KQorI2RlZmluZSBfTUlQ
SUNfSFNfR0VOX0RBVEEJCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4Yjg2OCkKICNkZWZpbmUg
TUlQSV9IU19HRU5fREFUQShwb3J0KQkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfSFNfR0VOX0RB
VEEsIF9NSVBJQ19IU19HRU5fREFUQSkKIAotI2RlZmluZSBfTUlQSUFfTFBfR0VOX0NUUkwJCShk
ZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNmMpCi0jZGVmaW5lIF9NSVBJQ19MUF9HRU5f
Q1RSTAkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4Yjg2YykKKyNkZWZpbmUgX01JUElB
X0xQX0dFTl9DVFJMCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNmMpCisjZGVmaW5lIF9N
SVBJQ19MUF9HRU5fQ1RSTAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODZjKQogI2RlZmlu
ZSBNSVBJX0xQX0dFTl9DVFJMKHBvcnQpCQlfTU1JT19NSVBJKHBvcnQsIF9NSVBJQV9MUF9HRU5f
Q1RSTCwgX01JUElDX0xQX0dFTl9DVFJMKQotI2RlZmluZSBfTUlQSUFfSFNfR0VOX0NUUkwJCShk
ZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNzApCi0jZGVmaW5lIF9NSVBJQ19IU19HRU5f
Q1RSTAkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4Yjg3MCkKKyNkZWZpbmUgX01JUElB
X0hTX0dFTl9DVFJMCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNzApCisjZGVmaW5lIF9N
SVBJQ19IU19HRU5fQ1RSTAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODcwKQogI2RlZmlu
ZSBNSVBJX0hTX0dFTl9DVFJMKHBvcnQpCQlfTU1JT19NSVBJKHBvcnQsIF9NSVBJQV9IU19HRU5f
Q1RSTCwgX01JUElDX0hTX0dFTl9DVFJMKQogI2RlZmluZSAgTE9OR19QQUNLRVRfV09SRF9DT1VO
VF9TSElGVAkJCTgKICNkZWZpbmUgIExPTkdfUEFDS0VUX1dPUkRfQ09VTlRfTUFTSwkJCSgweGZm
ZmYgPDwgOCkKQEAgLTEwNzA1LDggKzEwNzA1LDggQEAgZW51bSBza2xfcG93ZXJfZ2F0ZSB7CiAj
ZGVmaW5lICBEQVRBX1RZUEVfTUFTSwkJCQkJKDB4M2YgPDwgMCkKIC8qIGRhdGEgdHlwZSB2YWx1
ZXMsIHNlZSBpbmNsdWRlL3ZpZGVvL21pcGlfZGlzcGxheS5oICovCiAKLSNkZWZpbmUgX01JUElB
X0dFTl9GSUZPX1NUQVQJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwNzQpCi0jZGVm
aW5lIF9NSVBJQ19HRU5fRklGT19TVEFUCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhi
ODc0KQorI2RlZmluZSBfTUlQSUFfR0VOX0ZJRk9fU1RBVAkJKGk5MTUtPm1pcGlfbW1pb19iYXNl
ICsgMHhiMDc0KQorI2RlZmluZSBfTUlQSUNfR0VOX0ZJRk9fU1RBVAkJKGk5MTUtPm1pcGlfbW1p
b19iYXNlICsgMHhiODc0KQogI2RlZmluZSBNSVBJX0dFTl9GSUZPX1NUQVQocG9ydCkJX01NSU9f
TUlQSShwb3J0LCBfTUlQSUFfR0VOX0ZJRk9fU1RBVCwgX01JUElDX0dFTl9GSUZPX1NUQVQpCiAj
ZGVmaW5lICBEUElfRklGT19FTVBUWQkJCQkJKDEgPDwgMjgpCiAjZGVmaW5lICBEQklfRklGT19F
TVBUWQkJCQkJKDEgPDwgMjcpCkBAIC0xMDcyMywxNSArMTA3MjMsMTUgQEAgZW51bSBza2xfcG93
ZXJfZ2F0ZSB7CiAjZGVmaW5lICBIU19EQVRBX0ZJRk9fSEFMRl9FTVBUWQkJCSgxIDw8IDEpCiAj
ZGVmaW5lICBIU19EQVRBX0ZJRk9fRlVMTAkJCQkoMSA8PCAwKQogCi0jZGVmaW5lIF9NSVBJQV9I
U19MU19EQklfRU5BQkxFCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDc4KQotI2Rl
ZmluZSBfTUlQSUNfSFNfTFNfREJJX0VOQUJMRQkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSAr
IDB4Yjg3OCkKKyNkZWZpbmUgX01JUElBX0hTX0xTX0RCSV9FTkFCTEUJCShpOTE1LT5taXBpX21t
aW9fYmFzZSArIDB4YjA3OCkKKyNkZWZpbmUgX01JUElDX0hTX0xTX0RCSV9FTkFCTEUJCShpOTE1
LT5taXBpX21taW9fYmFzZSArIDB4Yjg3OCkKICNkZWZpbmUgTUlQSV9IU19MUF9EQklfRU5BQkxF
KHBvcnQpCV9NTUlPX01JUEkocG9ydCwgX01JUElBX0hTX0xTX0RCSV9FTkFCTEUsIF9NSVBJQ19I
U19MU19EQklfRU5BQkxFKQogI2RlZmluZSAgREJJX0hTX0xQX01PREVfTUFTSwkJCQkoMSA8PCAw
KQogI2RlZmluZSAgREJJX0xQX01PREUJCQkJCSgxIDw8IDApCiAjZGVmaW5lICBEQklfSFNfTU9E
RQkJCQkJKDAgPDwgMCkKIAotI2RlZmluZSBfTUlQSUFfRFBIWV9QQVJBTQkJKGRldl9wcml2LT5t
aXBpX21taW9fYmFzZSArIDB4YjA4MCkKLSNkZWZpbmUgX01JUElDX0RQSFlfUEFSQU0JCShkZXZf
cHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4ODApCisjZGVmaW5lIF9NSVBJQV9EUEhZX1BBUkFN
CQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwODApCisjZGVmaW5lIF9NSVBJQ19EUEhZX1BB
UkFNCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4ODApCiAjZGVmaW5lIE1JUElfRFBIWV9Q
QVJBTShwb3J0KQkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfRFBIWV9QQVJBTSwgX01JUElDX0RQ
SFlfUEFSQU0pCiAjZGVmaW5lICBFWElUX1pFUk9fQ09VTlRfU0hJRlQJCQkJMjQKICNkZWZpbmUg
IEVYSVRfWkVST19DT1VOVF9NQVNLCQkJCSgweDNmIDw8IDI0KQpAQCAtMTA5NzgsMzQgKzEwOTc4
LDM0IEBAIGVudW0gc2tsX3Bvd2VyX2dhdGUgewogI2RlZmluZSAgVEFfVElNRU9VVF9WQUxVRSh4
KQkJKCh4KSA8PCAwKQogCiAvKiBiaXRzIDMxOjAgKi8KLSNkZWZpbmUgX01JUElBX0RCSV9CV19D
VFJMCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDg0KQotI2RlZmluZSBfTUlQSUNf
REJJX0JXX0NUUkwJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI4ODQpCisjZGVmaW5l
IF9NSVBJQV9EQklfQldfQ1RSTAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDg0KQorI2Rl
ZmluZSBfTUlQSUNfREJJX0JXX0NUUkwJCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4Yjg4NCkK
ICNkZWZpbmUgTUlQSV9EQklfQldfQ1RSTChwb3J0KQkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFf
REJJX0JXX0NUUkwsIF9NSVBJQ19EQklfQldfQ1RSTCkKIAotI2RlZmluZSBfTUlQSUFfQ0xLX0xB
TkVfU1dJVENIX1RJTUVfQ05UCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMDg4KQot
I2RlZmluZSBfTUlQSUNfQ0xLX0xBTkVfU1dJVENIX1RJTUVfQ05UCQkoZGV2X3ByaXYtPm1pcGlf
bW1pb19iYXNlICsgMHhiODg4KQorI2RlZmluZSBfTUlQSUFfQ0xLX0xBTkVfU1dJVENIX1RJTUVf
Q05UCQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIwODgpCisjZGVmaW5lIF9NSVBJQ19DTEtf
TEFORV9TV0lUQ0hfVElNRV9DTlQJCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4Yjg4OCkKICNk
ZWZpbmUgTUlQSV9DTEtfTEFORV9TV0lUQ0hfVElNRV9DTlQocG9ydCkJX01NSU9fTUlQSShwb3J0
LCBfTUlQSUFfQ0xLX0xBTkVfU1dJVENIX1RJTUVfQ05ULCBfTUlQSUNfQ0xLX0xBTkVfU1dJVENI
X1RJTUVfQ05UKQogI2RlZmluZSAgTFBfSFNfU1NXX0NOVF9TSElGVAkJCQkxNgogI2RlZmluZSAg
TFBfSFNfU1NXX0NOVF9NQVNLCQkJCSgweGZmZmYgPDwgMTYpCiAjZGVmaW5lICBIU19MUF9QV1Jf
U1dfQ05UX1NISUZUCQkJCTAKICNkZWZpbmUgIEhTX0xQX1BXUl9TV19DTlRfTUFTSwkJCQkoMHhm
ZmZmIDw8IDApCiAKLSNkZWZpbmUgX01JUElBX1NUT1BfU1RBVEVfU1RBTEwJCShkZXZfcHJpdi0+
bWlwaV9tbWlvX2Jhc2UgKyAweGIwOGMpCi0jZGVmaW5lIF9NSVBJQ19TVE9QX1NUQVRFX1NUQUxM
CQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiODhjKQorI2RlZmluZSBfTUlQSUFfU1RP
UF9TVEFURV9TVEFMTAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDhjKQorI2RlZmluZSBf
TUlQSUNfU1RPUF9TVEFURV9TVEFMTAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODhjKQog
I2RlZmluZSBNSVBJX1NUT1BfU1RBVEVfU1RBTEwocG9ydCkJX01NSU9fTUlQSShwb3J0LCBfTUlQ
SUFfU1RPUF9TVEFURV9TVEFMTCwgX01JUElDX1NUT1BfU1RBVEVfU1RBTEwpCiAjZGVmaW5lICBT
VE9QX1NUQVRFX1NUQUxMX0NPVU5URVJfU0hJRlQJCQkwCiAjZGVmaW5lICBTVE9QX1NUQVRFX1NU
QUxMX0NPVU5URVJfTUFTSwkJCSgweGZmIDw8IDApCiAKLSNkZWZpbmUgX01JUElBX0lOVFJfU1RB
VF9SRUdfMQkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4YjA5MCkKLSNkZWZpbmUgX01J
UElDX0lOVFJfU1RBVF9SRUdfMQkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4Yjg5MCkK
KyNkZWZpbmUgX01JUElBX0lOVFJfU1RBVF9SRUdfMQkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsg
MHhiMDkwKQorI2RlZmluZSBfTUlQSUNfSU5UUl9TVEFUX1JFR18xCQkoaTkxNS0+bWlwaV9tbWlv
X2Jhc2UgKyAweGI4OTApCiAjZGVmaW5lIE1JUElfSU5UUl9TVEFUX1JFR18xKHBvcnQpCV9NTUlP
X01JUEkocG9ydCwgX01JUElBX0lOVFJfU1RBVF9SRUdfMSwgX01JUElDX0lOVFJfU1RBVF9SRUdf
MSkKLSNkZWZpbmUgX01JUElBX0lOVFJfRU5fUkVHXzEJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jh
c2UgKyAweGIwOTQpCi0jZGVmaW5lIF9NSVBJQ19JTlRSX0VOX1JFR18xCQkoZGV2X3ByaXYtPm1p
cGlfbW1pb19iYXNlICsgMHhiODk0KQorI2RlZmluZSBfTUlQSUFfSU5UUl9FTl9SRUdfMQkJKGk5
MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMDk0KQorI2RlZmluZSBfTUlQSUNfSU5UUl9FTl9SRUdf
MQkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiODk0KQogI2RlZmluZSBNSVBJX0lOVFJfRU5f
UkVHXzEocG9ydCkJX01NSU9fTUlQSShwb3J0LCBfTUlQSUFfSU5UUl9FTl9SRUdfMSwgX01JUElD
X0lOVFJfRU5fUkVHXzEpCiAjZGVmaW5lICBSWF9DT05URU5USU9OX0RFVEVDVEVECQkJCSgxIDw8
IDApCiAKIC8qIFhYWDogb25seSBwaXBlIEEgPyE/ICovCi0jZGVmaW5lIE1JUElBX0RCSV9UWVBF
Q19DVFJMCQkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMTAwKQorI2RlZmluZSBNSVBJ
QV9EQklfVFlQRUNfQ1RSTAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMTAwKQogI2RlZmlu
ZSAgREJJX1RZUEVDX0VOQUJMRQkJCQkoMSA8PCAzMSkKICNkZWZpbmUgIERCSV9UWVBFQ19XSVAJ
CQkJCSgxIDw8IDMwKQogI2RlZmluZSAgREJJX1RZUEVDX09QVElPTl9TSElGVAkJCQkyOApAQCAt
MTEwMTksOCArMTEwMTksOCBAQCBlbnVtIHNrbF9wb3dlcl9nYXRlIHsKIAogLyogTUlQSSBhZGFw
dGVyIHJlZ2lzdGVycyAqLwogCi0jZGVmaW5lIF9NSVBJQV9DVFJMCQkJKGRldl9wcml2LT5taXBp
X21taW9fYmFzZSArIDB4YjEwNCkKLSNkZWZpbmUgX01JUElDX0NUUkwJCQkoZGV2X3ByaXYtPm1p
cGlfbW1pb19iYXNlICsgMHhiOTA0KQorI2RlZmluZSBfTUlQSUFfQ1RSTAkJCShpOTE1LT5taXBp
X21taW9fYmFzZSArIDB4YjEwNCkKKyNkZWZpbmUgX01JUElDX0NUUkwJCQkoaTkxNS0+bWlwaV9t
bWlvX2Jhc2UgKyAweGI5MDQpCiAjZGVmaW5lIE1JUElfQ1RSTChwb3J0KQkJCV9NTUlPX01JUEko
cG9ydCwgX01JUElBX0NUUkwsIF9NSVBJQ19DVFJMKQogI2RlZmluZSAgRVNDQVBFX0NMT0NLX0RJ
VklERVJfU0hJRlQJCQk1IC8qIEEgb25seSAqLwogI2RlZmluZSAgRVNDQVBFX0NMT0NLX0RJVklE
RVJfTUFTSwkJCSgzIDw8IDUpCkBAIC0xMTA1MiwyMSArMTEwNTIsMjEgQEAgZW51bSBza2xfcG93
ZXJfZ2F0ZSB7CiAjZGVmaW5lICBHTEtfTUlQSUlPX1BPUlRfUE9XRVJFRAkJCSgxIDw8IDEpIC8q
IFJPICovCiAjZGVmaW5lICBHTEtfTUlQSUlPX0VOQUJMRQkJCQkoMSA8PCAwKQogCi0jZGVmaW5l
IF9NSVBJQV9EQVRBX0FERFJFU1MJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIxMDgp
Ci0jZGVmaW5lIF9NSVBJQ19EQVRBX0FERFJFU1MJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2Ug
KyAweGI5MDgpCisjZGVmaW5lIF9NSVBJQV9EQVRBX0FERFJFU1MJCShpOTE1LT5taXBpX21taW9f
YmFzZSArIDB4YjEwOCkKKyNkZWZpbmUgX01JUElDX0RBVEFfQUREUkVTUwkJKGk5MTUtPm1pcGlf
bW1pb19iYXNlICsgMHhiOTA4KQogI2RlZmluZSBNSVBJX0RBVEFfQUREUkVTUyhwb3J0KQkJX01N
SU9fTUlQSShwb3J0LCBfTUlQSUFfREFUQV9BRERSRVNTLCBfTUlQSUNfREFUQV9BRERSRVNTKQog
I2RlZmluZSAgREFUQV9NRU1fQUREUkVTU19TSElGVAkJCQk1CiAjZGVmaW5lICBEQVRBX01FTV9B
RERSRVNTX01BU0sJCQkJKDB4N2ZmZmZmZiA8PCA1KQogI2RlZmluZSAgREFUQV9WQUxJRAkJCQkJ
KDEgPDwgMCkKIAotI2RlZmluZSBfTUlQSUFfREFUQV9MRU5HVEgJCShkZXZfcHJpdi0+bWlwaV9t
bWlvX2Jhc2UgKyAweGIxMGMpCi0jZGVmaW5lIF9NSVBJQ19EQVRBX0xFTkdUSAkJKGRldl9wcml2
LT5taXBpX21taW9fYmFzZSArIDB4YjkwYykKKyNkZWZpbmUgX01JUElBX0RBVEFfTEVOR1RICQko
aTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGIxMGMpCisjZGVmaW5lIF9NSVBJQ19EQVRBX0xFTkdU
SAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiOTBjKQogI2RlZmluZSBNSVBJX0RBVEFfTEVO
R1RIKHBvcnQpCQlfTU1JT19NSVBJKHBvcnQsIF9NSVBJQV9EQVRBX0xFTkdUSCwgX01JUElDX0RB
VEFfTEVOR1RIKQogI2RlZmluZSAgREFUQV9MRU5HVEhfU0hJRlQJCQkJMAogI2RlZmluZSAgREFU
QV9MRU5HVEhfTUFTSwkJCQkoMHhmZmZmZiA8PCAwKQogCi0jZGVmaW5lIF9NSVBJQV9DT01NQU5E
X0FERFJFU1MJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGIxMTApCi0jZGVmaW5lIF9N
SVBJQ19DT01NQU5EX0FERFJFU1MJCShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI5MTAp
CisjZGVmaW5lIF9NSVBJQV9DT01NQU5EX0FERFJFU1MJCShpOTE1LT5taXBpX21taW9fYmFzZSAr
IDB4YjExMCkKKyNkZWZpbmUgX01JUElDX0NPTU1BTkRfQUREUkVTUwkJKGk5MTUtPm1pcGlfbW1p
b19iYXNlICsgMHhiOTEwKQogI2RlZmluZSBNSVBJX0NPTU1BTkRfQUREUkVTUyhwb3J0KQlfTU1J
T19NSVBJKHBvcnQsIF9NSVBJQV9DT01NQU5EX0FERFJFU1MsIF9NSVBJQ19DT01NQU5EX0FERFJF
U1MpCiAjZGVmaW5lICBDT01NQU5EX01FTV9BRERSRVNTX1NISUZUCQkJNQogI2RlZmluZSAgQ09N
TUFORF9NRU1fQUREUkVTU19NQVNLCQkJKDB4N2ZmZmZmZiA8PCA1KQpAQCAtMTEwNzQsMTggKzEx
MDc0LDE4IEBAIGVudW0gc2tsX3Bvd2VyX2dhdGUgewogI2RlZmluZSAgTUVNT1JZX1dSSVRFX0RB
VEFfRlJPTV9QSVBFX1JFTkRFUklORwkJKDEgPDwgMSkKICNkZWZpbmUgIENPTU1BTkRfVkFMSUQJ
CQkJCSgxIDw8IDApCiAKLSNkZWZpbmUgX01JUElBX0NPTU1BTkRfTEVOR1RICQkoZGV2X3ByaXYt
Pm1pcGlfbW1pb19iYXNlICsgMHhiMTE0KQotI2RlZmluZSBfTUlQSUNfQ09NTUFORF9MRU5HVEgJ
CShkZXZfcHJpdi0+bWlwaV9tbWlvX2Jhc2UgKyAweGI5MTQpCisjZGVmaW5lIF9NSVBJQV9DT01N
QU5EX0xFTkdUSAkJKGk5MTUtPm1pcGlfbW1pb19iYXNlICsgMHhiMTE0KQorI2RlZmluZSBfTUlQ
SUNfQ09NTUFORF9MRU5HVEgJCShpOTE1LT5taXBpX21taW9fYmFzZSArIDB4YjkxNCkKICNkZWZp
bmUgTUlQSV9DT01NQU5EX0xFTkdUSChwb3J0KQlfTU1JT19NSVBJKHBvcnQsIF9NSVBJQV9DT01N
QU5EX0xFTkdUSCwgX01JUElDX0NPTU1BTkRfTEVOR1RIKQogI2RlZmluZSAgQ09NTUFORF9MRU5H
VEhfU0hJRlQobikJCQkoOCAqIChuKSkgLyogbjogMC4uLjMgKi8KICNkZWZpbmUgIENPTU1BTkRf
TEVOR1RIX01BU0sobikJCQkJKDB4ZmYgPDwgKDggKiAobikpKQogCi0jZGVmaW5lIF9NSVBJQV9S
RUFEX0RBVEFfUkVUVVJOMAkoZGV2X3ByaXYtPm1pcGlfbW1pb19iYXNlICsgMHhiMTE4KQotI2Rl
ZmluZSBfTUlQSUNfUkVBRF9EQVRBX1JFVFVSTjAJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSAr
IDB4YjkxOCkKKyNkZWZpbmUgX01JUElBX1JFQURfREFUQV9SRVRVUk4wCShpOTE1LT5taXBpX21t
aW9fYmFzZSArIDB4YjExOCkKKyNkZWZpbmUgX01JUElDX1JFQURfREFUQV9SRVRVUk4wCShpOTE1
LT5taXBpX21taW9fYmFzZSArIDB4YjkxOCkKICNkZWZpbmUgTUlQSV9SRUFEX0RBVEFfUkVUVVJO
KHBvcnQsIG4pIF9NTUlPKF9NSVBJKHBvcnQsIF9NSVBJQV9SRUFEX0RBVEFfUkVUVVJOMCwgX01J
UElDX1JFQURfREFUQV9SRVRVUk4wKSArIDQgKiAobikpIC8qIG46IDAuLi43ICovCiAKLSNkZWZp
bmUgX01JUElBX1JFQURfREFUQV9WQUxJRAkJKGRldl9wcml2LT5taXBpX21taW9fYmFzZSArIDB4
YjEzOCkKLSNkZWZpbmUgX01JUElDX1JFQURfREFUQV9WQUxJRAkJKGRldl9wcml2LT5taXBpX21t
aW9fYmFzZSArIDB4YjkzOCkKKyNkZWZpbmUgX01JUElBX1JFQURfREFUQV9WQUxJRAkJKGk5MTUt
Pm1pcGlfbW1pb19iYXNlICsgMHhiMTM4KQorI2RlZmluZSBfTUlQSUNfUkVBRF9EQVRBX1ZBTElE
CQkoaTkxNS0+bWlwaV9tbWlvX2Jhc2UgKyAweGI5MzgpCiAjZGVmaW5lIE1JUElfUkVBRF9EQVRB
X1ZBTElEKHBvcnQpCV9NTUlPX01JUEkocG9ydCwgX01JUElBX1JFQURfREFUQV9WQUxJRCwgX01J
UElDX1JFQURfREFUQV9WQUxJRCkKICNkZWZpbmUgIFJFQURfREFUQV9WQUxJRChuKQkJCQkoMSA8
PCAobikpCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3VzcGVuZC5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zdXNwZW5kLmMKaW5kZXggNTgxMjAxYmNiODFh
Li41YjNhZDdjOTI0MGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3Vz
cGVuZC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3VzcGVuZC5jCkBAIC0zMSwx
MjEgKzMxLDEyMSBAQAogI2luY2x1ZGUgImludGVsX2ZiYy5oIgogI2luY2x1ZGUgImludGVsX2dt
YnVzLmgiCiAKLXN0YXRpYyB2b2lkIGk5MTVfc2F2ZV9kaXNwbGF5KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGk5MTVfc2F2ZV9kaXNwbGF5KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIERpc3BsYXkgYXJiaXRyYXRpb24gY29udHJv
bCAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDQpCi0JCWRldl9wcml2LT5yZWdmaWxl
LnNhdmVEU1BBUkIgPSBJOTE1X1JFQUQoRFNQQVJCKTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDw9
IDQpCisJCWk5MTUtPnJlZ2ZpbGUuc2F2ZURTUEFSQiA9IEk5MTVfUkVBRChEU1BBUkIpOwogCiAJ
Lyogc2F2ZSBGQkMgaW50ZXJ2YWwgKi8KLQlpZiAoSEFTX0ZCQyhkZXZfcHJpdikgJiYgSU5URUxf
R0VOKGRldl9wcml2KSA8PSA0ICYmICFJU19HNFgoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+cmVn
ZmlsZS5zYXZlRkJDX0NPTlRST0wgPSBJOTE1X1JFQUQoRkJDX0NPTlRST0wpOworCWlmIChIQVNf
RkJDKGk5MTUpICYmIElOVEVMX0dFTihpOTE1KSA8PSA0ICYmICFJU19HNFgoaTkxNSkpCisJCWk5
MTUtPnJlZ2ZpbGUuc2F2ZUZCQ19DT05UUk9MID0gSTkxNV9SRUFEKEZCQ19DT05UUk9MKTsKIH0K
IAotc3RhdGljIHZvaWQgaTkxNV9yZXN0b3JlX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaTkxNV9yZXN0b3JlX2Rpc3BsYXkoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyogRGlzcGxheSBhcmJpdHJhdGlvbiAqLwotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDQpCi0JCUk5MTVfV1JJVEUoRFNQQVJCLCBkZXZfcHJp
di0+cmVnZmlsZS5zYXZlRFNQQVJCKTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDw9IDQpCisJCUk5
MTVfV1JJVEUoRFNQQVJCLCBpOTE1LT5yZWdmaWxlLnNhdmVEU1BBUkIpOwogCiAJLyogb25seSBy
ZXN0b3JlIEZCQyBpbmZvIG9uIHRoZSBwbGF0Zm9ybSB0aGF0IHN1cHBvcnRzIEZCQyovCi0JaW50
ZWxfZmJjX2dsb2JhbF9kaXNhYmxlKGRldl9wcml2KTsKKwlpbnRlbF9mYmNfZ2xvYmFsX2Rpc2Fi
bGUoaTkxNSk7CiAKIAkvKiByZXN0b3JlIEZCQyBpbnRlcnZhbCAqLwotCWlmIChIQVNfRkJDKGRl
dl9wcml2KSAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDQgJiYgIUlTX0c0WChkZXZfcHJpdikp
Ci0JCUk5MTVfV1JJVEUoRkJDX0NPTlRST0wsIGRldl9wcml2LT5yZWdmaWxlLnNhdmVGQkNfQ09O
VFJPTCk7CisJaWYgKEhBU19GQkMoaTkxNSkgJiYgSU5URUxfR0VOKGk5MTUpIDw9IDQgJiYgIUlT
X0c0WChpOTE1KSkKKwkJSTkxNV9XUklURShGQkNfQ09OVFJPTCwgaTkxNS0+cmVnZmlsZS5zYXZl
RkJDX0NPTlRST0wpOwogCi0JaTkxNV9yZWRpc2FibGVfdmdhKGRldl9wcml2KTsKKwlpOTE1X3Jl
ZGlzYWJsZV92Z2EoaTkxNSk7CiB9CiAKLWludCBpOTE1X3NhdmVfc3RhdGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50IGk5MTVfc2F2ZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGRldl9wcml2LT5k
cm0ucGRldjsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5wZGV2OwogCWludCBp
OwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0JaTkxNV9zYXZlX2Rpc3BsYXkoZGV2X3By
aXYpOworCWk5MTVfc2F2ZV9kaXNwbGF5KGk5MTUpOwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwg
NCkpCisJaWYgKElTX0dFTihpOTE1LCA0KSkKIAkJcGNpX3JlYWRfY29uZmlnX3dvcmQocGRldiwg
R0NER01CVVMsCi0JCQkJICAgICAmZGV2X3ByaXYtPnJlZ2ZpbGUuc2F2ZUdDREdNQlVTKTsKKwkJ
CQkgICAgICZpOTE1LT5yZWdmaWxlLnNhdmVHQ0RHTUJVUyk7CiAKIAkvKiBDYWNoZSBtb2RlIHN0
YXRlICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA3KQotCQlkZXZfcHJpdi0+cmVnZmls
ZS5zYXZlQ0FDSEVfTU9ERV8wID0gSTkxNV9SRUFEKENBQ0hFX01PREVfMCk7CisJaWYgKElOVEVM
X0dFTihpOTE1KSA8IDcpCisJCWk5MTUtPnJlZ2ZpbGUuc2F2ZUNBQ0hFX01PREVfMCA9IEk5MTVf
UkVBRChDQUNIRV9NT0RFXzApOwogCiAJLyogTWVtb3J5IEFyYml0cmF0aW9uIHN0YXRlICovCi0J
ZGV2X3ByaXYtPnJlZ2ZpbGUuc2F2ZU1JX0FSQl9TVEFURSA9IEk5MTVfUkVBRChNSV9BUkJfU1RB
VEUpOworCWk5MTUtPnJlZ2ZpbGUuc2F2ZU1JX0FSQl9TVEFURSA9IEk5MTVfUkVBRChNSV9BUkJf
U1RBVEUpOwogCiAJLyogU2NyYXRjaCBzcGFjZSAqLwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDIp
ICYmIElTX01PQklMRShkZXZfcHJpdikpIHsKKwlpZiAoSVNfR0VOKGk5MTUsIDIpICYmIElTX01P
QklMRShpOTE1KSkgewogCQlmb3IgKGkgPSAwOyBpIDwgNzsgaSsrKSB7Ci0JCQlkZXZfcHJpdi0+
cmVnZmlsZS5zYXZlU1dGMFtpXSA9IEk5MTVfUkVBRChTV0YwKGkpKTsKLQkJCWRldl9wcml2LT5y
ZWdmaWxlLnNhdmVTV0YxW2ldID0gSTkxNV9SRUFEKFNXRjEoaSkpOworCQkJaTkxNS0+cmVnZmls
ZS5zYXZlU1dGMFtpXSA9IEk5MTVfUkVBRChTV0YwKGkpKTsKKwkJCWk5MTUtPnJlZ2ZpbGUuc2F2
ZVNXRjFbaV0gPSBJOTE1X1JFQUQoU1dGMShpKSk7CiAJCX0KIAkJZm9yIChpID0gMDsgaSA8IDM7
IGkrKykKLQkJCWRldl9wcml2LT5yZWdmaWxlLnNhdmVTV0YzW2ldID0gSTkxNV9SRUFEKFNXRjMo
aSkpOwotCX0gZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCAyKSkgeworCQkJaTkxNS0+cmVnZmls
ZS5zYXZlU1dGM1tpXSA9IEk5MTVfUkVBRChTV0YzKGkpKTsKKwl9IGVsc2UgaWYgKElTX0dFTihp
OTE1LCAyKSkgewogCQlmb3IgKGkgPSAwOyBpIDwgNzsgaSsrKQotCQkJZGV2X3ByaXYtPnJlZ2Zp
bGUuc2F2ZVNXRjFbaV0gPSBJOTE1X1JFQUQoU1dGMShpKSk7Ci0JfSBlbHNlIGlmIChIQVNfR01D
SChkZXZfcHJpdikpIHsKKwkJCWk5MTUtPnJlZ2ZpbGUuc2F2ZVNXRjFbaV0gPSBJOTE1X1JFQUQo
U1dGMShpKSk7CisJfSBlbHNlIGlmIChIQVNfR01DSChpOTE1KSkgewogCQlmb3IgKGkgPSAwOyBp
IDwgMTY7IGkrKykgewotCQkJZGV2X3ByaXYtPnJlZ2ZpbGUuc2F2ZVNXRjBbaV0gPSBJOTE1X1JF
QUQoU1dGMChpKSk7Ci0JCQlkZXZfcHJpdi0+cmVnZmlsZS5zYXZlU1dGMVtpXSA9IEk5MTVfUkVB
RChTV0YxKGkpKTsKKwkJCWk5MTUtPnJlZ2ZpbGUuc2F2ZVNXRjBbaV0gPSBJOTE1X1JFQUQoU1dG
MChpKSk7CisJCQlpOTE1LT5yZWdmaWxlLnNhdmVTV0YxW2ldID0gSTkxNV9SRUFEKFNXRjEoaSkp
OwogCQl9CiAJCWZvciAoaSA9IDA7IGkgPCAzOyBpKyspCi0JCQlkZXZfcHJpdi0+cmVnZmlsZS5z
YXZlU1dGM1tpXSA9IEk5MTVfUkVBRChTV0YzKGkpKTsKKwkJCWk5MTUtPnJlZ2ZpbGUuc2F2ZVNX
RjNbaV0gPSBJOTE1X1JFQUQoU1dGMyhpKSk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAogCXJldHVybiAwOwogfQogCi1pbnQgaTkxNV9yZXN0b3JlX3N0YXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludCBpOTE1X3Jlc3RvcmVfc3RhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZf
cHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsK
IAlpbnQgaTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAotCWlmIChJU19HRU4oZGV2X3By
aXYsIDQpKQorCWlmIChJU19HRU4oaTkxNSwgNCkpCiAJCXBjaV93cml0ZV9jb25maWdfd29yZChw
ZGV2LCBHQ0RHTUJVUywKLQkJCQkgICAgICBkZXZfcHJpdi0+cmVnZmlsZS5zYXZlR0NER01CVVMp
OwotCWk5MTVfcmVzdG9yZV9kaXNwbGF5KGRldl9wcml2KTsKKwkJCQkgICAgICBpOTE1LT5yZWdm
aWxlLnNhdmVHQ0RHTUJVUyk7CisJaTkxNV9yZXN0b3JlX2Rpc3BsYXkoaTkxNSk7CiAKIAkvKiBD
YWNoZSBtb2RlIHN0YXRlICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA3KQotCQlJOTE1
X1dSSVRFKENBQ0hFX01PREVfMCwgZGV2X3ByaXYtPnJlZ2ZpbGUuc2F2ZUNBQ0hFX01PREVfMCB8
CisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDcpCisJCUk5MTVfV1JJVEUoQ0FDSEVfTU9ERV8wLCBp
OTE1LT5yZWdmaWxlLnNhdmVDQUNIRV9NT0RFXzAgfAogCQkJICAgMHhmZmZmMDAwMCk7CiAKIAkv
KiBNZW1vcnkgYXJiaXRyYXRpb24gc3RhdGUgKi8KLQlJOTE1X1dSSVRFKE1JX0FSQl9TVEFURSwg
ZGV2X3ByaXYtPnJlZ2ZpbGUuc2F2ZU1JX0FSQl9TVEFURSB8IDB4ZmZmZjAwMDApOworCUk5MTVf
V1JJVEUoTUlfQVJCX1NUQVRFLCBpOTE1LT5yZWdmaWxlLnNhdmVNSV9BUkJfU1RBVEUgfCAweGZm
ZmYwMDAwKTsKIAogCS8qIFNjcmF0Y2ggc3BhY2UgKi8KLQlpZiAoSVNfR0VOKGRldl9wcml2LCAy
KSAmJiBJU19NT0JJTEUoZGV2X3ByaXYpKSB7CisJaWYgKElTX0dFTihpOTE1LCAyKSAmJiBJU19N
T0JJTEUoaTkxNSkpIHsKIAkJZm9yIChpID0gMDsgaSA8IDc7IGkrKykgewotCQkJSTkxNV9XUklU
RShTV0YwKGkpLCBkZXZfcHJpdi0+cmVnZmlsZS5zYXZlU1dGMFtpXSk7Ci0JCQlJOTE1X1dSSVRF
KFNXRjEoaSksIGRldl9wcml2LT5yZWdmaWxlLnNhdmVTV0YxW2ldKTsKKwkJCUk5MTVfV1JJVEUo
U1dGMChpKSwgaTkxNS0+cmVnZmlsZS5zYXZlU1dGMFtpXSk7CisJCQlJOTE1X1dSSVRFKFNXRjEo
aSksIGk5MTUtPnJlZ2ZpbGUuc2F2ZVNXRjFbaV0pOwogCQl9CiAJCWZvciAoaSA9IDA7IGkgPCAz
OyBpKyspCi0JCQlJOTE1X1dSSVRFKFNXRjMoaSksIGRldl9wcml2LT5yZWdmaWxlLnNhdmVTV0Yz
W2ldKTsKLQl9IGVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgMikpIHsKKwkJCUk5MTVfV1JJVEUo
U1dGMyhpKSwgaTkxNS0+cmVnZmlsZS5zYXZlU1dGM1tpXSk7CisJfSBlbHNlIGlmIChJU19HRU4o
aTkxNSwgMikpIHsKIAkJZm9yIChpID0gMDsgaSA8IDc7IGkrKykKLQkJCUk5MTVfV1JJVEUoU1dG
MShpKSwgZGV2X3ByaXYtPnJlZ2ZpbGUuc2F2ZVNXRjFbaV0pOwotCX0gZWxzZSBpZiAoSEFTX0dN
Q0goZGV2X3ByaXYpKSB7CisJCQlJOTE1X1dSSVRFKFNXRjEoaSksIGk5MTUtPnJlZ2ZpbGUuc2F2
ZVNXRjFbaV0pOworCX0gZWxzZSBpZiAoSEFTX0dNQ0goaTkxNSkpIHsKIAkJZm9yIChpID0gMDsg
aSA8IDE2OyBpKyspIHsKLQkJCUk5MTVfV1JJVEUoU1dGMChpKSwgZGV2X3ByaXYtPnJlZ2ZpbGUu
c2F2ZVNXRjBbaV0pOwotCQkJSTkxNV9XUklURShTV0YxKGkpLCBkZXZfcHJpdi0+cmVnZmlsZS5z
YXZlU1dGMVtpXSk7CisJCQlJOTE1X1dSSVRFKFNXRjAoaSksIGk5MTUtPnJlZ2ZpbGUuc2F2ZVNX
RjBbaV0pOworCQkJSTkxNV9XUklURShTV0YxKGkpLCBpOTE1LT5yZWdmaWxlLnNhdmVTV0YxW2ld
KTsKIAkJfQogCQlmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKQotCQkJSTkxNV9XUklURShTV0YzKGkp
LCBkZXZfcHJpdi0+cmVnZmlsZS5zYXZlU1dGM1tpXSk7CisJCQlJOTE1X1dSSVRFKFNXRjMoaSks
IGk5MTUtPnJlZ2ZpbGUuc2F2ZVNXRjNbaV0pOwogCX0KIAotCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKLQlpbnRlbF9nbWJ1c19yZXNldChkZXZfcHJpdik7CisJaW50ZWxfZ21idXNfcmVz
ZXQoaTkxNSk7CiAKIAlyZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfc3lzZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYwppbmRl
eCAzZWYwN2I5ODdkNDAuLjljODliZTNlYzRjMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9zeXNmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMu
YwpAQCAtNDIsMTQgKzQyLDE0IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmtkZXZfbWlub3JfdG9faTkxNShzdHJ1Y3QgZGV2aWNlICprZGV2KQogfQogCiAjaWZkZWYg
Q09ORklHX1BNCi1zdGF0aWMgdTMyIGNhbGNfcmVzaWRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB1MzIgY2FsY19yZXNpZGVuY3koc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkgIGk5MTVfcmVnX3QgcmVnKQogewogCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCXU2NCByZXMgPSAwOwogCi0Jd2l0aF9pbnRlbF9ydW50aW1lX3BtKGRldl9w
cml2LCB3YWtlcmVmKQotCQlyZXMgPSBpbnRlbF9yYzZfcmVzaWRlbmN5X3VzKGRldl9wcml2LCBy
ZWcpOworCXdpdGhfaW50ZWxfcnVudGltZV9wbShpOTE1LCB3YWtlcmVmKQorCQlyZXMgPSBpbnRl
bF9yYzZfcmVzaWRlbmN5X3VzKGk5MTUsIHJlZyk7CiAKIAlyZXR1cm4gRElWX1JPVU5EX0NMT1NF
U1RfVUxMKHJlcywgMTAwMCk7CiB9CkBAIC01NywxNSArNTcsMTUgQEAgc3RhdGljIHUzMiBjYWxj
X3Jlc2lkZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgc3Np
emVfdAogc2hvd19yYzZfbWFzayhzdHJ1Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0
dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKIAl1bnNpZ25lZCBpbnQgbWFz
azsKIAogCW1hc2sgPSAwOwotCWlmIChIQVNfUkM2KGRldl9wcml2KSkKKwlpZiAoSEFTX1JDNihp
OTE1KSkKIAkJbWFzayB8PSBCSVQoMCk7Ci0JaWYgKEhBU19SQzZwKGRldl9wcml2KSkKKwlpZiAo
SEFTX1JDNnAoaTkxNSkpCiAJCW1hc2sgfD0gQklUKDEpOwotCWlmIChIQVNfUkM2cHAoZGV2X3By
aXYpKQorCWlmIChIQVNfUkM2cHAoaTkxNSkpCiAJCW1hc2sgfD0gQklUKDIpOwogCiAJcmV0dXJu
IHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJXhcbiIsIG1hc2spOwpAQCAtNzQsMzIgKzc0LDMy
IEBAIHNob3dfcmM2X21hc2soc3RydWN0IGRldmljZSAqa2Rldiwgc3RydWN0IGRldmljZV9hdHRy
aWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKIHN0YXRpYyBzc2l6ZV90CiBzaG93X3JjNl9tcyhzdHJ1
Y3QgZGV2aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVm
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9f
aTkxNShrZGV2KTsKLQl1MzIgcmM2X3Jlc2lkZW5jeSA9IGNhbGNfcmVzaWRlbmN5KGRldl9wcml2
LCBHRU42X0dUX0dGWF9SQzYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rl
dl9taW5vcl90b19pOTE1KGtkZXYpOworCXUzMiByYzZfcmVzaWRlbmN5ID0gY2FsY19yZXNpZGVu
Y3koaTkxNSwgR0VONl9HVF9HRlhfUkM2KTsKIAlyZXR1cm4gc25wcmludGYoYnVmLCBQQUdFX1NJ
WkUsICIldVxuIiwgcmM2X3Jlc2lkZW5jeSk7CiB9CiAKIHN0YXRpYyBzc2l6ZV90CiBzaG93X3Jj
NnBfbXMoc3RydWN0IGRldmljZSAqa2Rldiwgc3RydWN0IGRldmljZV9hdHRyaWJ1dGUgKmF0dHIs
IGNoYXIgKmJ1ZikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBrZGV2
X21pbm9yX3RvX2k5MTUoa2Rldik7Ci0JdTMyIHJjNnBfcmVzaWRlbmN5ID0gY2FsY19yZXNpZGVu
Y3koZGV2X3ByaXYsIEdFTjZfR1RfR0ZYX1JDNnApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOworCXUzMiByYzZwX3Jlc2lkZW5jeSA9
IGNhbGNfcmVzaWRlbmN5KGk5MTUsIEdFTjZfR1RfR0ZYX1JDNnApOwogCXJldHVybiBzbnByaW50
ZihidWYsIFBBR0VfU0laRSwgIiV1XG4iLCByYzZwX3Jlc2lkZW5jeSk7CiB9CiAKIHN0YXRpYyBz
c2l6ZV90CiBzaG93X3JjNnBwX21zKHN0cnVjdCBkZXZpY2UgKmtkZXYsIHN0cnVjdCBkZXZpY2Vf
YXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwotCXUzMiByYzZwcF9yZXNpZGVu
Y3kgPSBjYWxjX3Jlc2lkZW5jeShkZXZfcHJpdiwgR0VONl9HVF9HRlhfUkM2cHApOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOworCXUz
MiByYzZwcF9yZXNpZGVuY3kgPSBjYWxjX3Jlc2lkZW5jeShpOTE1LCBHRU42X0dUX0dGWF9SQzZw
cCk7CiAJcmV0dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJXVcbiIsIHJjNnBwX3Jlc2lk
ZW5jeSk7CiB9CiAKIHN0YXRpYyBzc2l6ZV90CiBzaG93X21lZGlhX3JjNl9tcyhzdHJ1Y3QgZGV2
aWNlICprZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShr
ZGV2KTsKLQl1MzIgcmM2X3Jlc2lkZW5jeSA9IGNhbGNfcmVzaWRlbmN5KGRldl9wcml2LCBWTFZf
R1RfTUVESUFfUkM2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlu
b3JfdG9faTkxNShrZGV2KTsKKwl1MzIgcmM2X3Jlc2lkZW5jeSA9IGNhbGNfcmVzaWRlbmN5KGk5
MTUsIFZMVl9HVF9NRURJQV9SQzYpOwogCXJldHVybiBzbnByaW50ZihidWYsIFBBR0VfU0laRSwg
IiV1XG4iLCByYzZfcmVzaWRlbmN5KTsKIH0KIApAQCAtMTQyLDkgKzE0Miw5IEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIG1lZGlhX3JjNl9hdHRyX2dyb3VwID0gewogfTsK
ICNlbmRpZgogCi1zdGF0aWMgaW50IGwzX2FjY2Vzc192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIGxvZmZfdCBvZmZzZXQpCitzdGF0aWMgaW50IGwzX2FjY2Vzc192YWxp
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgbG9mZl90IG9mZnNldCkKIHsKLQlpZiAo
IUhBU19MM19EUEYoZGV2X3ByaXYpKQorCWlmICghSEFTX0wzX0RQRihpOTE1KSkKIAkJcmV0dXJu
IC1FUEVSTTsKIAogCWlmIChvZmZzZXQgJSA0ICE9IDApCkBAIC0xNjIsMTQgKzE2MiwxNCBAQCBp
OTE1X2wzX3JlYWQoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCSAg
ICAgbG9mZl90IG9mZnNldCwgc2l6ZV90IGNvdW50KQogewogCXN0cnVjdCBkZXZpY2UgKmtkZXYg
PSBrb2JqX3RvX2Rldihrb2JqKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZk
ZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl9taW5v
cl90b19pOTE1KGtkZXYpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwog
CWludCBzbGljZSA9IChpbnQpKHVpbnRwdHJfdClhdHRyLT5wcml2YXRlOwogCWludCByZXQ7CiAK
IAljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOwogCi0JcmV0ID0gbDNfYWNjZXNzX3ZhbGlk
KGRldl9wcml2LCBvZmZzZXQpOworCXJldCA9IGwzX2FjY2Vzc192YWxpZChpOTE1LCBvZmZzZXQp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTE3OSw5ICsxNzksOSBAQCBpOTE1X2wz
X3JlYWQoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCWlmIChyZXQp
CiAJCXJldHVybiByZXQ7CiAKLQlpZiAoZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3Ns
aWNlXSkKKwlpZiAoaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdKQogCQltZW1jcHko
YnVmLAotCQkgICAgICAgZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSArIChv
ZmZzZXQvNCksCisJCSAgICAgICBpOTE1LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0gKyAo
b2Zmc2V0LzQpLAogCQkgICAgICAgY291bnQpOwogCWVsc2UKIAkJbWVtc2V0KGJ1ZiwgMCwgY291
bnQpOwpAQCAtMTk3LDE0ICsxOTcsMTQgQEAgaTkxNV9sM193cml0ZShzdHJ1Y3QgZmlsZSAqZmls
cCwgc3RydWN0IGtvYmplY3QgKmtvYmosCiAJICAgICAgbG9mZl90IG9mZnNldCwgc2l6ZV90IGNv
dW50KQogewogCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSBrb2JqX3RvX2Rldihrb2JqKTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7
Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOworCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7CiAJaW50IHNsaWNlID0gKGludCkodWludHB0cl90KWF0dHItPnByaXZhdGU7CiAJdTMyICoq
cmVtYXBfaW5mbzsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbDNfYWNjZXNzX3ZhbGlkKGRldl9wcml2
LCBvZmZzZXQpOworCXJldCA9IGwzX2FjY2Vzc192YWxpZChpOTE1LCBvZmZzZXQpOwogCWlmIChy
ZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTIxMiw3ICsyMTIsNyBAQCBpOTE1X2wzX3dyaXRlKHN0
cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qga29iamVjdCAqa29iaiwKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCi0JcmVtYXBfaW5mbyA9ICZkZXZfcHJpdi0+bDNfcGFyaXR5LnJlbWFwX2luZm9b
c2xpY2VdOworCXJlbWFwX2luZm8gPSAmaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2Vd
OwogCWlmICghKnJlbWFwX2luZm8pIHsKIAkJKnJlbWFwX2luZm8gPSBremFsbG9jKEdFTjdfTDNM
T0dfU0laRSwgR0ZQX0tFUk5FTCk7CiAJCWlmICghKnJlbWFwX2luZm8pIHsKQEAgLTIyOCw3ICsy
MjgsNyBAQCBpOTE1X2wzX3dyaXRlKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qga29iamVjdCAq
a29iaiwKIAltZW1jcHkoKnJlbWFwX2luZm8gKyAob2Zmc2V0LzQpLCBidWYsIGNvdW50KTsKIAog
CS8qIE5COiBXZSBkZWZlciB0aGUgcmVtYXBwaW5nIHVudGlsIHdlIHN3aXRjaCB0byB0aGUgY29u
dGV4dCAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmZGV2X3ByaXYtPmNvbnRleHRzLmxp
c3QsIGxpbmspCisJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5jb250ZXh0cy5saXN0
LCBsaW5rKQogCQljdHgtPnJlbWFwX3NsaWNlIHw9ICgxPDxzbGljZSk7CiAKIAlyZXQgPSBjb3Vu
dDsKQEAgLTI2MCw1MiArMjYwLDUyIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYmluX2F0dHJpYnV0
ZSBkcGZfYXR0cnNfMSA9IHsKIHN0YXRpYyBzc2l6ZV90IGd0X2FjdF9mcmVxX21oel9zaG93KHN0
cnVjdCBkZXZpY2UgKmtkZXYsCiAJCQkJICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRy
LCBjaGFyICpidWYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rl
dl9taW5vcl90b19pOTE1KGtkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
a2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXUz
MiBmcmVxOwogCi0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsKKwl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CiAKLQlpZiAoSVNfVkFMTEVZVklF
VyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKLQkJdmx2X3B1bml0X2dl
dChkZXZfcHJpdik7Ci0JCWZyZXEgPSB2bHZfcHVuaXRfcmVhZChkZXZfcHJpdiwgUFVOSVRfUkVH
X0dQVV9GUkVRX1NUUyk7Ci0JCXZsdl9wdW5pdF9wdXQoZGV2X3ByaXYpOworCWlmIChJU19WQUxM
RVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKKwkJdmx2X3B1bml0X2dldChp
OTE1KTsKKwkJZnJlcSA9IHZsdl9wdW5pdF9yZWFkKGk5MTUsIFBVTklUX1JFR19HUFVfRlJFUV9T
VFMpOworCQl2bHZfcHVuaXRfcHV0KGk5MTUpOwogCiAJCWZyZXEgPSAoZnJlcSA+PiA4KSAmIDB4
ZmY7CiAJfSBlbHNlIHsKLQkJZnJlcSA9IGludGVsX2dldF9jYWdmKGRldl9wcml2LCBJOTE1X1JF
QUQoR0VONl9SUFNUQVQxKSk7CisJCWZyZXEgPSBpbnRlbF9nZXRfY2FnZihpOTE1LCBJOTE1X1JF
QUQoR0VONl9SUFNUQVQxKSk7CiAJfQogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYs
IHdha2VyZWYpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwogCi0JcmV0
dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJWRcbiIsIGludGVsX2dwdV9mcmVxKGRldl9w
cml2LCBmcmVxKSk7CisJcmV0dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJWRcbiIsIGlu
dGVsX2dwdV9mcmVxKGk5MTUsIGZyZXEpKTsKIH0KIAogc3RhdGljIHNzaXplX3QgZ3RfY3VyX2Zy
ZXFfbWh6X3Nob3coc3RydWN0IGRldmljZSAqa2RldiwKIAkJCQkgICAgc3RydWN0IGRldmljZV9h
dHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7CiAKIAlyZXR1cm4gc25wcmlu
dGYoYnVmLCBQQUdFX1NJWkUsICIlZFxuIiwKLQkJCWludGVsX2dwdV9mcmVxKGRldl9wcml2LAot
CQkJCSAgICAgICBkZXZfcHJpdi0+Z3RfcG0ucnBzLmN1cl9mcmVxKSk7CisJCQlpbnRlbF9ncHVf
ZnJlcShpOTE1LAorCQkJCSAgICAgICBpOTE1LT5ndF9wbS5ycHMuY3VyX2ZyZXEpKTsKIH0KIAog
c3RhdGljIHNzaXplX3QgZ3RfYm9vc3RfZnJlcV9taHpfc2hvdyhzdHJ1Y3QgZGV2aWNlICprZGV2
LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsK
IAogCXJldHVybiBzbnByaW50ZihidWYsIFBBR0VfU0laRSwgIiVkXG4iLAotCQkJaW50ZWxfZ3B1
X2ZyZXEoZGV2X3ByaXYsCi0JCQkJICAgICAgIGRldl9wcml2LT5ndF9wbS5ycHMuYm9vc3RfZnJl
cSkpOworCQkJaW50ZWxfZ3B1X2ZyZXEoaTkxNSwKKwkJCQkgICAgICAgaTkxNS0+Z3RfcG0ucnBz
LmJvb3N0X2ZyZXEpKTsKIH0KIAogc3RhdGljIHNzaXplX3QgZ3RfYm9vc3RfZnJlcV9taHpfc3Rv
cmUoc3RydWN0IGRldmljZSAqa2RldiwKIAkJCQkgICAgICAgc3RydWN0IGRldmljZV9hdHRyaWJ1
dGUgKmF0dHIsCiAJCQkJICAgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50KQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShr
ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsK
KwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCWJvb2wgYm9vc3Qg
PSBmYWxzZTsKIAlzc2l6ZV90IHJldDsKIAl1MzIgdmFsOwpAQCAtMzE1LDcgKzMxNSw3IEBAIHN0
YXRpYyBzc2l6ZV90IGd0X2Jvb3N0X2ZyZXFfbWh6X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmtkZXYs
CiAJCXJldHVybiByZXQ7CiAKIAkvKiBWYWxpZGF0ZSBhZ2FpbnN0IChzdGF0aWMpIGhhcmR3YXJl
IGxpbWl0cyAqLwotCXZhbCA9IGludGVsX2ZyZXFfb3Bjb2RlKGRldl9wcml2LCB2YWwpOworCXZh
bCA9IGludGVsX2ZyZXFfb3Bjb2RlKGk5MTUsIHZhbCk7CiAJaWYgKHZhbCA8IHJwcy0+bWluX2Zy
ZXEgfHwgdmFsID4gcnBzLT5tYXhfZnJlcSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKQEAgLTMzNCwy
OCArMzM0LDI4IEBAIHN0YXRpYyBzc2l6ZV90IGd0X2Jvb3N0X2ZyZXFfbWh6X3N0b3JlKHN0cnVj
dCBkZXZpY2UgKmtkZXYsCiBzdGF0aWMgc3NpemVfdCB2bHZfcnBlX2ZyZXFfbWh6X3Nob3coc3Ry
dWN0IGRldmljZSAqa2RldiwKIAkJCQkgICAgIHN0cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRy
LCBjaGFyICpidWYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rl
dl9taW5vcl90b19pOTE1KGtkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
a2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwogCiAJcmV0dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9T
SVpFLCAiJWRcbiIsCi0JCQlpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwKLQkJCQkgICAgICAgZGV2
X3ByaXYtPmd0X3BtLnJwcy5lZmZpY2llbnRfZnJlcSkpOworCQkJaW50ZWxfZ3B1X2ZyZXEoaTkx
NSwKKwkJCQkgICAgICAgaTkxNS0+Z3RfcG0ucnBzLmVmZmljaWVudF9mcmVxKSk7CiB9CiAKIHN0
YXRpYyBzc2l6ZV90IGd0X21heF9mcmVxX21oel9zaG93KHN0cnVjdCBkZXZpY2UgKmtkZXYsIHN0
cnVjdCBkZXZpY2VfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwogCiAJ
cmV0dXJuIHNucHJpbnRmKGJ1ZiwgUEFHRV9TSVpFLCAiJWRcbiIsCi0JCQlpbnRlbF9ncHVfZnJl
cShkZXZfcHJpdiwKLQkJCQkgICAgICAgZGV2X3ByaXYtPmd0X3BtLnJwcy5tYXhfZnJlcV9zb2Z0
bGltaXQpKTsKKwkJCWludGVsX2dwdV9mcmVxKGk5MTUsCisJCQkJICAgICAgIGk5MTUtPmd0X3Bt
LnJwcy5tYXhfZnJlcV9zb2Z0bGltaXQpKTsKIH0KIAogc3RhdGljIHNzaXplX3QgZ3RfbWF4X2Zy
ZXFfbWh6X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmtkZXYsCiAJCQkJICAgICBzdHJ1Y3QgZGV2aWNl
X2F0dHJpYnV0ZSAqYXR0ciwKIAkJCQkgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9f
aTkxNShrZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJw
czsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShr
ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCWludGVs
X3dha2VyZWZfdCB3YWtlcmVmOwogCXUzMiB2YWw7CiAJc3NpemVfdCByZXQ7CkBAIC0zNjQsMTAg
KzM2NCwxMCBAQCBzdGF0aWMgc3NpemVfdCBndF9tYXhfZnJlcV9taHpfc3RvcmUoc3RydWN0IGRl
dmljZSAqa2RldiwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0Jd2FrZXJlZiA9IGludGVs
X3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoaTkxNSk7CiAJbXV0ZXhfbG9jaygmcnBzLT5sb2NrKTsKIAotCXZhbCA9IGludGVsX2ZyZXFf
b3Bjb2RlKGRldl9wcml2LCB2YWwpOworCXZhbCA9IGludGVsX2ZyZXFfb3Bjb2RlKGk5MTUsIHZh
bCk7CiAJaWYgKHZhbCA8IHJwcy0+bWluX2ZyZXEgfHwKIAkgICAgdmFsID4gcnBzLT5tYXhfZnJl
cSB8fAogCSAgICB2YWwgPCBycHMtPm1pbl9mcmVxX3NvZnRsaW1pdCkgewpAQCAtMzc3LDcgKzM3
Nyw3IEBAIHN0YXRpYyBzc2l6ZV90IGd0X21heF9mcmVxX21oel9zdG9yZShzdHJ1Y3QgZGV2aWNl
ICprZGV2LAogCiAJaWYgKHZhbCA+IHJwcy0+cnAwX2ZyZXEpCiAJCURSTV9ERUJVRygiVXNlciBy
ZXF1ZXN0ZWQgb3ZlcmNsb2NraW5nIHRvICVkXG4iLAotCQkJICBpbnRlbF9ncHVfZnJlcShkZXZf
cHJpdiwgdmFsKSk7CisJCQkgIGludGVsX2dwdV9mcmVxKGk5MTUsIHZhbCkpOwogCiAJcnBzLT5t
YXhfZnJlcV9zb2Z0bGltaXQgPSB2YWw7CiAKQEAgLTM4OCwzMCArMzg4LDMwIEBAIHN0YXRpYyBz
c2l6ZV90IGd0X21heF9mcmVxX21oel9zdG9yZShzdHJ1Y3QgZGV2aWNlICprZGV2LAogCS8qIFdl
IHN0aWxsIG5lZWQgKl9zZXRfcnBzIHRvIHByb2Nlc3MgdGhlIG5ldyBtYXhfZGVsYXkgYW5kCiAJ
ICogdXBkYXRlIHRoZSBpbnRlcnJ1cHQgbGltaXRzIGFuZCBQTUlOVFJNU0sgZXZlbiB0aG91Z2gK
IAkgKiBmcmVxdWVuY3kgcmVxdWVzdCBtYXkgYmUgdW5jaGFuZ2VkLiAqLwotCXJldCA9IGludGVs
X3NldF9ycHMoZGV2X3ByaXYsIHZhbCk7CisJcmV0ID0gaW50ZWxfc2V0X3JwcyhpOTE1LCB2YWwp
OwogCiB1bmxvY2s6CiAJbXV0ZXhfdW5sb2NrKCZycHMtPmxvY2spOwotCWludGVsX3J1bnRpbWVf
cG1fcHV0KGRldl9wcml2LCB3YWtlcmVmKTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dChpOTE1LCB3
YWtlcmVmKTsKIAogCXJldHVybiByZXQgPzogY291bnQ7CiB9CiAKIHN0YXRpYyBzc2l6ZV90IGd0
X21pbl9mcmVxX21oel9zaG93KHN0cnVjdCBkZXZpY2UgKmtkZXYsIHN0cnVjdCBkZXZpY2VfYXR0
cmlidXRlICphdHRyLCBjaGFyICpidWYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwogCiAJcmV0dXJuIHNucHJpbnRm
KGJ1ZiwgUEFHRV9TSVpFLCAiJWRcbiIsCi0JCQlpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwKLQkJ
CQkgICAgICAgZGV2X3ByaXYtPmd0X3BtLnJwcy5taW5fZnJlcV9zb2Z0bGltaXQpKTsKKwkJCWlu
dGVsX2dwdV9mcmVxKGk5MTUsCisJCQkJICAgICAgIGk5MTUtPmd0X3BtLnJwcy5taW5fZnJlcV9z
b2Z0bGltaXQpKTsKIH0KIAogc3RhdGljIHNzaXplX3QgZ3RfbWluX2ZyZXFfbWh6X3N0b3JlKHN0
cnVjdCBkZXZpY2UgKmtkZXYsCiAJCQkJICAgICBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0
ciwKIAkJCQkgICAgIGNvbnN0IGNoYXIgKmJ1Ziwgc2l6ZV90IGNvdW50KQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKLQlz
dHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKKwlzdHJ1Y3Qg
aW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCWludGVsX3dha2VyZWZfdCB3YWtl
cmVmOwogCXUzMiB2YWw7CiAJc3NpemVfdCByZXQ7CkBAIC00MjAsMTAgKzQyMCwxMCBAQCBzdGF0
aWMgc3NpemVfdCBndF9taW5fZnJlcV9taHpfc3RvcmUoc3RydWN0IGRldmljZSAqa2RldiwKIAlp
ZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0
KGRldl9wcml2KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CiAJbXV0
ZXhfbG9jaygmcnBzLT5sb2NrKTsKIAotCXZhbCA9IGludGVsX2ZyZXFfb3Bjb2RlKGRldl9wcml2
LCB2YWwpOworCXZhbCA9IGludGVsX2ZyZXFfb3Bjb2RlKGk5MTUsIHZhbCk7CiAJaWYgKHZhbCA8
IHJwcy0+bWluX2ZyZXEgfHwKIAkgICAgdmFsID4gcnBzLT5tYXhfZnJlcSB8fAogCSAgICB2YWwg
PiBycHMtPm1heF9mcmVxX3NvZnRsaW1pdCkgewpAQCAtNDQwLDExICs0NDAsMTEgQEAgc3RhdGlj
IHNzaXplX3QgZ3RfbWluX2ZyZXFfbWh6X3N0b3JlKHN0cnVjdCBkZXZpY2UgKmtkZXYsCiAJLyog
V2Ugc3RpbGwgbmVlZCAqX3NldF9ycHMgdG8gcHJvY2VzcyB0aGUgbmV3IG1pbl9kZWxheSBhbmQK
IAkgKiB1cGRhdGUgdGhlIGludGVycnVwdCBsaW1pdHMgYW5kIFBNSU5UUk1TSyBldmVuIHRob3Vn
aAogCSAqIGZyZXF1ZW5jeSByZXF1ZXN0IG1heSBiZSB1bmNoYW5nZWQuICovCi0JcmV0ID0gaW50
ZWxfc2V0X3JwcyhkZXZfcHJpdiwgdmFsKTsKKwlyZXQgPSBpbnRlbF9zZXRfcnBzKGk5MTUsIHZh
bCk7CiAKIHVubG9jazoKIAltdXRleF91bmxvY2soJnJwcy0+bG9jayk7Ci0JaW50ZWxfcnVudGlt
ZV9wbV9wdXQoZGV2X3ByaXYsIHdha2VyZWYpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUs
IHdha2VyZWYpOwogCiAJcmV0dXJuIHJldCA/OiBjb3VudDsKIH0KQEAgLTQ2NSwxNiArNDY1LDE2
IEBAIHN0YXRpYyBERVZJQ0VfQVRUUihndF9SUG5fZnJlcV9taHosIFNfSVJVR08sIGd0X3JwX21o
el9zaG93LCBOVUxMKTsKIC8qIEZvciBub3cgd2UgaGF2ZSBhIHN0YXRpYyBudW1iZXIgb2YgUlAg
c3RhdGVzICovCiBzdGF0aWMgc3NpemVfdCBndF9ycF9taHpfc2hvdyhzdHJ1Y3QgZGV2aWNlICpr
ZGV2LCBzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSAqYXR0ciwgY2hhciAqYnVmKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsK
LQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKKwlzdHJ1
Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCXUzMiB2YWw7CiAKIAlpZiAo
YXR0ciA9PSAmZGV2X2F0dHJfZ3RfUlAwX2ZyZXFfbWh6KQotCQl2YWwgPSBpbnRlbF9ncHVfZnJl
cShkZXZfcHJpdiwgcnBzLT5ycDBfZnJlcSk7CisJCXZhbCA9IGludGVsX2dwdV9mcmVxKGk5MTUs
IHJwcy0+cnAwX2ZyZXEpOwogCWVsc2UgaWYgKGF0dHIgPT0gJmRldl9hdHRyX2d0X1JQMV9mcmVx
X21oeikKLQkJdmFsID0gaW50ZWxfZ3B1X2ZyZXEoZGV2X3ByaXYsIHJwcy0+cnAxX2ZyZXEpOwor
CQl2YWwgPSBpbnRlbF9ncHVfZnJlcShpOTE1LCBycHMtPnJwMV9mcmVxKTsKIAllbHNlIGlmIChh
dHRyID09ICZkZXZfYXR0cl9ndF9SUG5fZnJlcV9taHopCi0JCXZhbCA9IGludGVsX2dwdV9mcmVx
KGRldl9wcml2LCBycHMtPm1pbl9mcmVxKTsKKwkJdmFsID0gaW50ZWxfZ3B1X2ZyZXEoaTkxNSwg
cnBzLT5taW5fZnJlcSk7CiAJZWxzZQogCQlCVUcoKTsKIApAQCAtNTQwLDEwICs1NDAsMTAgQEAg
c3RhdGljIHNzaXplX3QgZXJyb3Jfc3RhdGVfd3JpdGUoc3RydWN0IGZpbGUgKmZpbGUsIHN0cnVj
dCBrb2JqZWN0ICprb2JqLAogCQkJCSBsb2ZmX3Qgb2ZmLCBzaXplX3QgY291bnQpCiB7CiAJc3Ry
dWN0IGRldmljZSAqa2RldiA9IGtvYmpfdG9fZGV2KGtvYmopOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKIAogCURSTV9E
RUJVR19EUklWRVIoIlJlc2V0dGluZyBlcnJvciBzdGF0ZVxuIik7Ci0JaTkxNV9yZXNldF9lcnJv
cl9zdGF0ZShkZXZfcHJpdik7CisJaTkxNV9yZXNldF9lcnJvcl9zdGF0ZShpOTE1KTsKIAogCXJl
dHVybiBjb3VudDsKIH0KQEAgLTU3MSwzNyArNTcxLDM3IEBAIHN0YXRpYyB2b2lkIGk5MTVfc2V0
dXBfZXJyb3JfY2FwdHVyZShzdHJ1Y3QgZGV2aWNlICprZGV2KSB7fQogc3RhdGljIHZvaWQgaTkx
NV90ZWFyZG93bl9lcnJvcl9jYXB0dXJlKHN0cnVjdCBkZXZpY2UgKmtkZXYpIHt9CiAjZW5kaWYK
IAotdm9pZCBpOTE1X3NldHVwX3N5c2ZzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKK3ZvaWQgaTkxNV9zZXR1cF9zeXNmcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKLQlzdHJ1Y3QgZGV2aWNlICprZGV2ID0gZGV2X3ByaXYtPmRybS5wcmltYXJ5LT5rZGV2Owor
CXN0cnVjdCBkZXZpY2UgKmtkZXYgPSBpOTE1LT5kcm0ucHJpbWFyeS0+a2RldjsKIAlpbnQgcmV0
OwogCiAjaWZkZWYgQ09ORklHX1BNCi0JaWYgKEhBU19SQzYoZGV2X3ByaXYpKSB7CisJaWYgKEhB
U19SQzYoaTkxNSkpIHsKIAkJcmV0ID0gc3lzZnNfbWVyZ2VfZ3JvdXAoJmtkZXYtPmtvYmosCiAJ
CQkJCSZyYzZfYXR0cl9ncm91cCk7CiAJCWlmIChyZXQpCiAJCQlEUk1fRVJST1IoIlJDNiByZXNp
ZGVuY3kgc3lzZnMgc2V0dXAgZmFpbGVkXG4iKTsKIAl9Ci0JaWYgKEhBU19SQzZwKGRldl9wcml2
KSkgeworCWlmIChIQVNfUkM2cChpOTE1KSkgewogCQlyZXQgPSBzeXNmc19tZXJnZV9ncm91cCgm
a2Rldi0+a29iaiwKIAkJCQkJJnJjNnBfYXR0cl9ncm91cCk7CiAJCWlmIChyZXQpCiAJCQlEUk1f
RVJST1IoIlJDNnAgcmVzaWRlbmN5IHN5c2ZzIHNldHVwIGZhaWxlZFxuIik7CiAJfQotCWlmIChJ
U19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlm
IChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJcmV0ID0g
c3lzZnNfbWVyZ2VfZ3JvdXAoJmtkZXYtPmtvYmosCiAJCQkJCSZtZWRpYV9yYzZfYXR0cl9ncm91
cCk7CiAJCWlmIChyZXQpCiAJCQlEUk1fRVJST1IoIk1lZGlhIFJDNiByZXNpZGVuY3kgc3lzZnMg
c2V0dXAgZmFpbGVkXG4iKTsKIAl9CiAjZW5kaWYKLQlpZiAoSEFTX0wzX0RQRihkZXZfcHJpdikp
IHsKKwlpZiAoSEFTX0wzX0RQRihpOTE1KSkgewogCQlyZXQgPSBkZXZpY2VfY3JlYXRlX2Jpbl9m
aWxlKGtkZXYsICZkcGZfYXR0cnMpOwogCQlpZiAocmV0KQogCQkJRFJNX0VSUk9SKCJsMyBwYXJp
dHkgc3lzZnMgc2V0dXAgZmFpbGVkXG4iKTsKIAotCQlpZiAoTlVNX0wzX1NMSUNFUyhkZXZfcHJp
dikgPiAxKSB7CisJCWlmIChOVU1fTDNfU0xJQ0VTKGk5MTUpID4gMSkgewogCQkJcmV0ID0gZGV2
aWNlX2NyZWF0ZV9iaW5fZmlsZShrZGV2LAogCQkJCQkJICAgICAmZHBmX2F0dHJzXzEpOwogCQkJ
aWYgKHJldCkKQEAgLTYxMCw5ICs2MTAsOSBAQCB2b2lkIGk5MTVfc2V0dXBfc3lzZnMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIAogCXJldCA9IDA7Ci0JaWYgKElTX1ZB
TExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCWlmIChJU19W
QUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpCiAJCXJldCA9IHN5c2ZzX2Ny
ZWF0ZV9maWxlcygma2Rldi0+a29iaiwgdmx2X2F0dHJzKTsKLQllbHNlIGlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDYpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDYpCiAJCXJldCA9
IHN5c2ZzX2NyZWF0ZV9maWxlcygma2Rldi0+a29iaiwgZ2VuNl9hdHRycyk7CiAJaWYgKHJldCkK
IAkJRFJNX0VSUk9SKCJSUFMgc3lzZnMgc2V0dXAgZmFpbGVkXG4iKTsKQEAgLTYyMCwxMyArNjIw
LDEzIEBAIHZvaWQgaTkxNV9zZXR1cF9zeXNmcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJaTkxNV9zZXR1cF9lcnJvcl9jYXB0dXJlKGtkZXYpOwogfQogCi12b2lkIGk5MTVf
dGVhcmRvd25fc3lzZnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBp
OTE1X3RlYXJkb3duX3N5c2ZzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0
cnVjdCBkZXZpY2UgKmtkZXYgPSBkZXZfcHJpdi0+ZHJtLnByaW1hcnktPmtkZXY7CisJc3RydWN0
IGRldmljZSAqa2RldiA9IGk5MTUtPmRybS5wcmltYXJ5LT5rZGV2OwogCiAJaTkxNV90ZWFyZG93
bl9lcnJvcl9jYXB0dXJlKGtkZXYpOwogCi0JaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8
IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElT
X0NIRVJSWVZJRVcoaTkxNSkpCiAJCXN5c2ZzX3JlbW92ZV9maWxlcygma2Rldi0+a29iaiwgdmx2
X2F0dHJzKTsKIAllbHNlCiAJCXN5c2ZzX3JlbW92ZV9maWxlcygma2Rldi0+a29iaiwgZ2VuNl9h
dHRycyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmgKaW5kZXggNWM4Y2ZhYTcwZDcyLi45NTQ4
YjlmZTQxOTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJhY2UuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmgKQEAgLTIxLDggKzIxLDggQEAK
IC8qIHdhdGVybWFyay9maWZvIHVwZGF0ZXMgKi8KIAogVFJBQ0VfRVZFTlQoaW50ZWxfcGlwZV9l
bmFibGUsCi0JICAgIFRQX1BST1RPKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
ZW51bSBwaXBlIHBpcGUpLAotCSAgICBUUF9BUkdTKGRldl9wcml2LCBwaXBlKSwKKwkgICAgVFBf
UFJPVE8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcGlwZSBwaXBlKSwKKwkg
ICAgVFBfQVJHUyhpOTE1LCBwaXBlKSwKIAogCSAgICBUUF9TVFJVQ1RfX2VudHJ5KAogCQkJICAg
ICBfX2FycmF5KHUzMiwgZnJhbWUsIDMpCkBAIC0zMiwxMSArMzIsMTEgQEAgVFJBQ0VfRVZFTlQo
aW50ZWxfcGlwZV9lbmFibGUsCiAKIAkgICAgVFBfZmFzdF9hc3NpZ24oCiAJCQkgICBlbnVtIHBp
cGUgX3BpcGU7Ci0JCQkgICBmb3JfZWFjaF9waXBlKGRldl9wcml2LCBfcGlwZSkgeworCQkJICAg
Zm9yX2VhY2hfcGlwZShpOTE1LCBfcGlwZSkgewogCQkJCSAgIF9fZW50cnktPmZyYW1lW19waXBl
XSA9Ci0JCQkJCSAgIGRldl9wcml2LT5kcm0uZHJpdmVyLT5nZXRfdmJsYW5rX2NvdW50ZXIoJmRl
dl9wcml2LT5kcm0sIF9waXBlKTsKKwkJCQkJICAgaTkxNS0+ZHJtLmRyaXZlci0+Z2V0X3ZibGFu
a19jb3VudGVyKCZpOTE1LT5kcm0sIF9waXBlKTsKIAkJCQkgICBfX2VudHJ5LT5zY2FubGluZVtf
cGlwZV0gPQotCQkJCQkgICBpbnRlbF9nZXRfY3J0Y19zY2FubGluZShpbnRlbF9nZXRfY3J0Y19m
b3JfcGlwZShkZXZfcHJpdiwgX3BpcGUpKTsKKwkJCQkJICAgaW50ZWxfZ2V0X2NydGNfc2Nhbmxp
bmUoaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoaTkxNSwgX3BpcGUpKTsKIAkJCSAgIH0KIAkJCSAg
IF9fZW50cnktPnBpcGUgPSBwaXBlOwogCQkJICAgKSwKQEAgLTQ5LDggKzQ5LDggQEAgVFJBQ0Vf
RVZFTlQoaW50ZWxfcGlwZV9lbmFibGUsCiApOwogCiBUUkFDRV9FVkVOVChpbnRlbF9waXBlX2Rp
c2FibGUsCi0JICAgIFRQX1BST1RPKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
ZW51bSBwaXBlIHBpcGUpLAotCSAgICBUUF9BUkdTKGRldl9wcml2LCBwaXBlKSwKKwkgICAgVFBf
UFJPVE8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcGlwZSBwaXBlKSwKKwkg
ICAgVFBfQVJHUyhpOTE1LCBwaXBlKSwKIAogCSAgICBUUF9TVFJVQ1RfX2VudHJ5KAogCQkJICAg
ICBfX2FycmF5KHUzMiwgZnJhbWUsIDMpCkBAIC02MCwxMSArNjAsMTEgQEAgVFJBQ0VfRVZFTlQo
aW50ZWxfcGlwZV9kaXNhYmxlLAogCiAJICAgIFRQX2Zhc3RfYXNzaWduKAogCQkJICAgZW51bSBw
aXBlIF9waXBlOwotCQkJICAgZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgX3BpcGUpIHsKKwkJCSAg
IGZvcl9lYWNoX3BpcGUoaTkxNSwgX3BpcGUpIHsKIAkJCQkgICBfX2VudHJ5LT5mcmFtZVtfcGlw
ZV0gPQotCQkJCQkgICBkZXZfcHJpdi0+ZHJtLmRyaXZlci0+Z2V0X3ZibGFua19jb3VudGVyKCZk
ZXZfcHJpdi0+ZHJtLCBfcGlwZSk7CisJCQkJCSAgIGk5MTUtPmRybS5kcml2ZXItPmdldF92Ymxh
bmtfY291bnRlcigmaTkxNS0+ZHJtLCBfcGlwZSk7CiAJCQkJICAgX19lbnRyeS0+c2NhbmxpbmVb
X3BpcGVdID0KLQkJCQkJICAgaW50ZWxfZ2V0X2NydGNfc2NhbmxpbmUoaW50ZWxfZ2V0X2NydGNf
Zm9yX3BpcGUoZGV2X3ByaXYsIF9waXBlKSk7CisJCQkJCSAgIGludGVsX2dldF9jcnRjX3NjYW5s
aW5lKGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIF9waXBlKSk7CiAJCQkgICB9CiAJCQkg
ICBfX2VudHJ5LT5waXBlID0gcGlwZTsKIAkJCSAgICksCkBAIC0xMDIsOCArMTAyLDggQEAgVFJB
Q0VfRVZFTlQoaW50ZWxfcGlwZV9jcmMsCiApOwogCiBUUkFDRV9FVkVOVChpbnRlbF9jcHVfZmlm
b191bmRlcnJ1biwKLQkgICAgVFBfUFJPVE8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCBlbnVtIHBpcGUgcGlwZSksCi0JICAgIFRQX0FSR1MoZGV2X3ByaXYsIHBpcGUpLAorCSAg
ICBUUF9QUk9UTyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUp
LAorCSAgICBUUF9BUkdTKGk5MTUsIHBpcGUpLAogCiAJICAgIFRQX1NUUlVDVF9fZW50cnkoCiAJ
CQkgICAgIF9fZmllbGQoZW51bSBwaXBlLCBwaXBlKQpAQCAtMTEzLDggKzExMyw4IEBAIFRSQUNF
X0VWRU5UKGludGVsX2NwdV9maWZvX3VuZGVycnVuLAogCiAJICAgIFRQX2Zhc3RfYXNzaWduKAog
CQkJICAgX19lbnRyeS0+cGlwZSA9IHBpcGU7Ci0JCQkgICBfX2VudHJ5LT5mcmFtZSA9IGRldl9w
cml2LT5kcm0uZHJpdmVyLT5nZXRfdmJsYW5rX2NvdW50ZXIoJmRldl9wcml2LT5kcm0sIHBpcGUp
OwotCQkJICAgX19lbnRyeS0+c2NhbmxpbmUgPSBpbnRlbF9nZXRfY3J0Y19zY2FubGluZShpbnRl
bF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSkpOworCQkJICAgX19lbnRyeS0+ZnJh
bWUgPSBpOTE1LT5kcm0uZHJpdmVyLT5nZXRfdmJsYW5rX2NvdW50ZXIoJmk5MTUtPmRybSwgcGlw
ZSk7CisJCQkgICBfX2VudHJ5LT5zY2FubGluZSA9IGludGVsX2dldF9jcnRjX3NjYW5saW5lKGlu
dGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIHBpcGUpKTsKIAkJCSAgICksCiAKIAkgICAgVFBf
cHJpbnRrKCJwaXBlICVjLCBmcmFtZT0ldSwgc2NhbmxpbmU9JXUiLApAQCAtMTIzLDggKzEyMyw4
IEBAIFRSQUNFX0VWRU5UKGludGVsX2NwdV9maWZvX3VuZGVycnVuLAogKTsKIAogVFJBQ0VfRVZF
TlQoaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW4sCi0JICAgIFRQX1BST1RPKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBjaF90cmFuc2NvZGVyKSwKLQkgICAgVFBf
QVJHUyhkZXZfcHJpdiwgcGNoX3RyYW5zY29kZXIpLAorCSAgICBUUF9QUk9UTyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBjaF90cmFuc2NvZGVyKSwKKwkgICAgVFBf
QVJHUyhpOTE1LCBwY2hfdHJhbnNjb2RlciksCiAKIAkgICAgVFBfU1RSVUNUX19lbnRyeSgKIAkJ
CSAgICAgX19maWVsZChlbnVtIHBpcGUsIHBpcGUpCkBAIC0xMzUsOCArMTM1LDggQEAgVFJBQ0Vf
RVZFTlQoaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW4sCiAJICAgIFRQX2Zhc3RfYXNzaWduKAogCQkJ
ICAgZW51bSBwaXBlIHBpcGUgPSBwY2hfdHJhbnNjb2RlcjsKIAkJCSAgIF9fZW50cnktPnBpcGUg
PSBwaXBlOwotCQkJICAgX19lbnRyeS0+ZnJhbWUgPSBkZXZfcHJpdi0+ZHJtLmRyaXZlci0+Z2V0
X3ZibGFua19jb3VudGVyKCZkZXZfcHJpdi0+ZHJtLCBwaXBlKTsKLQkJCSAgIF9fZW50cnktPnNj
YW5saW5lID0gaW50ZWxfZ2V0X2NydGNfc2NhbmxpbmUoaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUo
ZGV2X3ByaXYsIHBpcGUpKTsKKwkJCSAgIF9fZW50cnktPmZyYW1lID0gaTkxNS0+ZHJtLmRyaXZl
ci0+Z2V0X3ZibGFua19jb3VudGVyKCZpOTE1LT5kcm0sIHBpcGUpOworCQkJICAgX19lbnRyeS0+
c2NhbmxpbmUgPSBpbnRlbF9nZXRfY3J0Y19zY2FubGluZShpbnRlbF9nZXRfY3J0Y19mb3JfcGlw
ZShpOTE1LCBwaXBlKSk7CiAJCQkgICApLAogCiAJICAgIFRQX3ByaW50aygicGNoIHRyYW5zY29k
ZXIgJWMsIGZyYW1lPSV1LCBzY2FubGluZT0ldSIsCkBAIC0xNDUsOCArMTQ1LDggQEAgVFJBQ0Vf
RVZFTlQoaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW4sCiApOwogCiBUUkFDRV9FVkVOVChpbnRlbF9t
ZW1vcnlfY3hzciwKLQkgICAgVFBfUFJPVE8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCBib29sIG9sZCwgYm9vbCBuZXcpLAotCSAgICBUUF9BUkdTKGRldl9wcml2LCBvbGQsIG5l
dyksCisJICAgIFRQX1BST1RPKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29sIG9s
ZCwgYm9vbCBuZXcpLAorCSAgICBUUF9BUkdTKGk5MTUsIG9sZCwgbmV3KSwKIAogCSAgICBUUF9T
VFJVQ1RfX2VudHJ5KAogCQkJICAgICBfX2FycmF5KHUzMiwgZnJhbWUsIDMpCkBAIC0xNTcsMTEg
KzE1NywxMSBAQCBUUkFDRV9FVkVOVChpbnRlbF9tZW1vcnlfY3hzciwKIAogCSAgICBUUF9mYXN0
X2Fzc2lnbigKIAkJCSAgIGVudW0gcGlwZSBwaXBlOwotCQkJICAgZm9yX2VhY2hfcGlwZShkZXZf
cHJpdiwgcGlwZSkgeworCQkJICAgZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKSB7CiAJCQkJICAg
X19lbnRyeS0+ZnJhbWVbcGlwZV0gPQotCQkJCQkgICBkZXZfcHJpdi0+ZHJtLmRyaXZlci0+Z2V0
X3ZibGFua19jb3VudGVyKCZkZXZfcHJpdi0+ZHJtLCBwaXBlKTsKKwkJCQkJICAgaTkxNS0+ZHJt
LmRyaXZlci0+Z2V0X3ZibGFua19jb3VudGVyKCZpOTE1LT5kcm0sIHBpcGUpOwogCQkJCSAgIF9f
ZW50cnktPnNjYW5saW5lW3BpcGVdID0KLQkJCQkJICAgaW50ZWxfZ2V0X2NydGNfc2NhbmxpbmUo
aW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpKTsKKwkJCQkJICAgaW50ZWxf
Z2V0X2NydGNfc2NhbmxpbmUoaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoaTkxNSwgcGlwZSkpOwog
CQkJICAgfQogCQkJICAgX19lbnRyeS0+b2xkID0gb2xkOwogCQkJICAgX19lbnRyeS0+bmV3ID0g
bmV3OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZncHUuYwppbmRleCA5NGQzOTkyYjU5OWQuLjk2ODc0YTQ4
MTlhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmMKQEAgLTUzLDE0ICs1MywxNCBAQAogCiAv
KioKICAqIGk5MTVfY2hlY2tfdmdwdSAtIGRldGVjdCB2aXJ0dWFsIEdQVQotICogQGRldl9wcml2
OiBpOTE1IGRldmljZSBwcml2YXRlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgcHJpdmF0ZQogICoK
ICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGF0IHRoZSBpbml0aWFsaXphdGlvbiBzdGFnZSwg
dG8gZGV0ZWN0IHdoZXRoZXIKICAqIHJ1bm5pbmcgb24gYSB2R1BVLgogICovCi12b2lkIGk5MTVf
Y2hlY2tfdmdwdShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGk5MTVf
Y2hlY2tfdmdwdShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgaW50ZWxfdW5j
b3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwogCXU2NCBtYWdpYzsKIAl1MTYgdmVyc2lvbl9t
YWpvcjsKIApAQCAtNzYsMTUgKzc2LDE1IEBAIHZvaWQgaTkxNV9jaGVja192Z3B1KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJcmV0dXJuOwogCX0KIAotCWRldl9wcml2LT52
Z3B1LmNhcHMgPSBfX3Jhd191bmNvcmVfcmVhZDMyKHVuY29yZSwgdmd0aWZfcmVnKHZndF9jYXBz
KSk7CisJaTkxNS0+dmdwdS5jYXBzID0gX19yYXdfdW5jb3JlX3JlYWQzMih1bmNvcmUsIHZndGlm
X3JlZyh2Z3RfY2FwcykpOwogCi0JZGV2X3ByaXYtPnZncHUuYWN0aXZlID0gdHJ1ZTsKKwlpOTE1
LT52Z3B1LmFjdGl2ZSA9IHRydWU7CiAJRFJNX0lORk8oIlZpcnR1YWwgR1BVIGZvciBJbnRlbCBH
VlQtZyBkZXRlY3RlZC5cbiIpOwogfQogCi1ib29sIGludGVsX3ZncHVfaGFzX2Z1bGxfcHBndHQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorYm9vbCBpbnRlbF92Z3B1X2hhc19m
dWxsX3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXJldHVybiBkZXZf
cHJpdi0+dmdwdS5jYXBzICYgVkdUX0NBUFNfRlVMTF9QUEdUVDsKKwlyZXR1cm4gaTkxNS0+dmdw
dS5jYXBzICYgVkdUX0NBUFNfRlVMTF9QUEdUVDsKIH0KIAogc3RydWN0IF9iYWxsb29uX2luZm9f
IHsKQEAgLTExMiwyMiArMTEyLDIyIEBAIHN0YXRpYyB2b2lkIHZndF9kZWJhbGxvb25fc3BhY2Uo
c3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwKIAogLyoqCiAgKiBpbnRlbF92Z3RfZGViYWxsb29uIC0g
ZGViYWxsb29uIHJlc2VydmVkIGdyYXBoaWNzIGFkZHJlc3MgdHJ1bmtzCi0gKiBAZGV2X3ByaXY6
IGk5MTUgZGV2aWNlIHByaXZhdGUgZGF0YQorICogQGk5MTU6IGk5MTUgZGV2aWNlIHByaXZhdGUg
ZGF0YQogICoKICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHRvIGRlYWxsb2NhdGUgdGhlIGJh
bGxvb25lZC1vdXQgZ3JhcGhpYyBtZW1vcnksIHdoZW4KICAqIGRyaXZlciBpcyB1bmxvYWRlZCBv
ciB3aGVuIGJhbGxvb25pbmcgZmFpbHMuCiAgKi8KLXZvaWQgaW50ZWxfdmd0X2RlYmFsbG9vbihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX3ZndF9kZWJhbGxv
b24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IGk7CiAKLQlpZiAoIWlu
dGVsX3ZncHVfYWN0aXZlKGRldl9wcml2KSkKKwlpZiAoIWludGVsX3ZncHVfYWN0aXZlKGk5MTUp
KQogCQlyZXR1cm47CiAKIAlEUk1fREVCVUcoIlZHVCBkZWJhbGxvb24uXG4iKTsKIAogCWZvciAo
aSA9IDA7IGkgPCA0OyBpKyspCi0JCXZndF9kZWJhbGxvb25fc3BhY2UoJmRldl9wcml2LT5nZ3R0
LCAmYmxfaW5mby5zcGFjZVtpXSk7CisJCXZndF9kZWJhbGxvb25fc3BhY2UoJmk5MTUtPmdndHQs
ICZibF9pbmZvLnNwYWNlW2ldKTsKIH0KIAogc3RhdGljIGludCB2Z3RfYmFsbG9vbl9zcGFjZShz
dHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LApAQCAtMTUzLDcgKzE1Myw3IEBAIHN0YXRpYyBpbnQgdmd0
X2JhbGxvb25fc3BhY2Uoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwKIAogLyoqCiAgKiBpbnRlbF92
Z3RfYmFsbG9vbiAtIGJhbGxvb24gb3V0IHJlc2VydmVkIGdyYXBoaWNzIGFkZHJlc3MgdHJ1bmtz
Ci0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIHByaXZhdGUgZGF0YQorICogQGk5MTU6IGk5MTUg
ZGV2aWNlIHByaXZhdGUgZGF0YQogICoKICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGF0IHRo
ZSBpbml0aWFsaXphdGlvbiBzdGFnZSwgdG8gYmFsbG9vbiBvdXQgdGhlCiAgKiBncmFwaGljIGFk
ZHJlc3Mgc3BhY2UgYWxsb2NhdGVkIHRvIG90aGVyIHZHUFVzLCBieSBtYXJraW5nIHRoZXNlIHNw
YWNlcyBhcwpAQCAtMTk1LDE2ICsxOTUsMTYgQEAgc3RhdGljIGludCB2Z3RfYmFsbG9vbl9zcGFj
ZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LAogICogUmV0dXJuczoKICAqIHplcm8gb24gc3VjY2Vz
cywgbm9uLXplcm8gaWYgY29uZmlndXJhdGlvbiBpbnZhbGlkIG9yIGJhbGxvb25pbmcgZmFpbGVk
CiAgKi8KLWludCBpbnRlbF92Z3RfYmFsbG9vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitpbnQgaW50ZWxfdmd0X2JhbGxvb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7Ci0Jc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZkZXZfcHJpdi0+Z2d0dDsKKwlzdHJ1
Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmk5MTUtPmdndHQ7CiAJdW5zaWduZWQgbG9uZyBnZ3R0X2Vu
ZCA9IGdndHQtPnZtLnRvdGFsOwogCiAJdW5zaWduZWQgbG9uZyBtYXBwYWJsZV9iYXNlLCBtYXBw
YWJsZV9zaXplLCBtYXBwYWJsZV9lbmQ7CiAJdW5zaWduZWQgbG9uZyB1bm1hcHBhYmxlX2Jhc2Us
IHVubWFwcGFibGVfc2l6ZSwgdW5tYXBwYWJsZV9lbmQ7CiAJaW50IHJldDsKIAotCWlmICghaW50
ZWxfdmdwdV9hY3RpdmUoZGV2X3ByaXYpKQorCWlmICghaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkp
CiAJCXJldHVybiAwOwogCiAJbWFwcGFibGVfYmFzZSA9IEk5MTVfUkVBRCh2Z3RpZl9yZWcoYXZh
aWxfcnMubWFwcGFibGVfZ21hZHIuYmFzZSkpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV92Z3B1LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZncHUuaAppbmRl
eCBlYmUxYjdiY2VkOTguLjBmYTBiZmI4OGJlZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV92Z3B1LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92Z3B1LmgK
QEAgLTI2LDIzICsyNiwyMyBAQAogCiAjaW5jbHVkZSAiaTkxNV9wdmluZm8uaCIKIAotdm9pZCBp
OTE1X2NoZWNrX3ZncHUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQg
aTkxNV9jaGVja192Z3B1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAotYm9vbCBp
bnRlbF92Z3B1X2hhc19mdWxsX3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dik7Citib29sIGludGVsX3ZncHVfaGFzX2Z1bGxfcHBndHQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwogCiBzdGF0aWMgaW5saW5lIGJvb2wKLWludGVsX3ZncHVfaGFzX2h3c3BfZW11
bGF0aW9uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludGVsX3ZncHVfaGFz
X2h3c3BfZW11bGF0aW9uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXJldHVy
biBkZXZfcHJpdi0+dmdwdS5jYXBzICYgVkdUX0NBUFNfSFdTUF9FTVVMQVRJT047CisJcmV0dXJu
IGk5MTUtPnZncHUuY2FwcyAmIFZHVF9DQVBTX0hXU1BfRU1VTEFUSU9OOwogfQogCiBzdGF0aWMg
aW5saW5lIGJvb2wKLWludGVsX3ZncHVfaGFzX2h1Z2VfZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK2ludGVsX3ZncHVfaGFzX2h1Z2VfZ3R0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewotCXJldHVybiBkZXZfcHJpdi0+dmdwdS5jYXBzICYgVkdUX0NBUFNf
SFVHRV9HVFQ7CisJcmV0dXJuIGk5MTUtPnZncHUuY2FwcyAmIFZHVF9DQVBTX0hVR0VfR1RUOwog
fQogCi1pbnQgaW50ZWxfdmd0X2JhbGxvb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KTsKLXZvaWQgaW50ZWxfdmd0X2RlYmFsbG9vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpOworaW50IGludGVsX3ZndF9iYWxsb29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKK3ZvaWQgaW50ZWxfdmd0X2RlYmFsbG9vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSk7CiAKICNlbmRpZiAvKiBfSTkxNV9WR1BVX0hfICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYwppbmRleCBjYjM0MWU0YWNmOTkuLmUzZjRkNzAwNmExYiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jCkBAIC01NTUsNyArNTU1LDcgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2JpbmRfY291bnQo
Y29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0YXRpYyBpbnQKIGk5MTVf
dm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQs
IHU2NCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bWEt
PnZtLT5pOTE1OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm1hLT52bS0+aTkx
NTsKIAl1bnNpZ25lZCBpbnQgY2FjaGVfbGV2ZWw7CiAJdTY0IHN0YXJ0LCBlbmQ7CiAJaW50IHJl
dDsKQEAgLTU4MSw3ICs1ODEsNyBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2
bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAKIAllbmQgPSB2bWEtPnZt
LT50b3RhbDsKIAlpZiAoZmxhZ3MgJiBQSU5fTUFQUEFCTEUpCi0JCWVuZCA9IG1pbl90KHU2NCwg
ZW5kLCBkZXZfcHJpdi0+Z2d0dC5tYXBwYWJsZV9lbmQpOworCQllbmQgPSBtaW5fdCh1NjQsIGVu
ZCwgaTkxNS0+Z2d0dC5tYXBwYWJsZV9lbmQpOwogCWlmIChmbGFncyAmIFBJTl9aT05FXzRHKQog
CQllbmQgPSBtaW5fdCh1NjQsIGVuZCwgKDFVTEwgPDwgMzIpIC0gSTkxNV9HVFRfUEFHRV9TSVpF
KTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVEKGVuZCwgSTkxNV9HVFRfUEFHRV9TSVpFKSk7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pY2xfZHNpLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pY2xfZHNpLmMKaW5kZXggNzQ0NDhlNmJmNzQ5Li5kMDE5MmUwOTNmNmYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ljbF9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pY2xfZHNpLmMKQEAgLTM1LDMyICszNSwzMiBAQAogI2luY2x1ZGUgImludGVsX2Rz
aS5oIgogI2luY2x1ZGUgImludGVsX3BhbmVsLmgiCiAKLXN0YXRpYyBpbmxpbmUgaW50IGhlYWRl
cl9jcmVkaXRzX2F2YWlsYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgaW5saW5lIGludCBoZWFkZXJfY3JlZGl0c19hdmFpbGFibGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSAgIGVudW0gdHJhbnNjb2RlciBkc2lfdHJhbnMpCiB7CiAJ
cmV0dXJuIChJOTE1X1JFQUQoRFNJX0NNRF9UWENUTChkc2lfdHJhbnMpKSAmIEZSRUVfSEVBREVS
X0NSRURJVF9NQVNLKQogCQk+PiBGUkVFX0hFQURFUl9DUkVESVRfU0hJRlQ7CiB9CiAKLXN0YXRp
YyBpbmxpbmUgaW50IHBheWxvYWRfY3JlZGl0c19hdmFpbGFibGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIGlubGluZSBpbnQgcGF5bG9hZF9jcmVkaXRzX2F2YWls
YWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgIGVudW0gdHJhbnNj
b2RlciBkc2lfdHJhbnMpCiB7CiAJcmV0dXJuIChJOTE1X1JFQUQoRFNJX0NNRF9UWENUTChkc2lf
dHJhbnMpKSAmIEZSRUVfUExPQURfQ1JFRElUX01BU0spCiAJCT4+IEZSRUVfUExPQURfQ1JFRElU
X1NISUZUOwogfQogCi1zdGF0aWMgdm9pZCB3YWl0X2Zvcl9oZWFkZXJfY3JlZGl0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCB3YWl0X2Zvcl9oZWFkZXJf
Y3JlZGl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgZW51bSB0cmFu
c2NvZGVyIGRzaV90cmFucykKIHsKLQlpZiAod2FpdF9mb3JfdXMoaGVhZGVyX2NyZWRpdHNfYXZh
aWxhYmxlKGRldl9wcml2LCBkc2lfdHJhbnMpID49CisJaWYgKHdhaXRfZm9yX3VzKGhlYWRlcl9j
cmVkaXRzX2F2YWlsYWJsZShpOTE1LCBkc2lfdHJhbnMpID49CiAJCQlNQVhfSEVBREVSX0NSRURJ
VCwgMTAwKSkKIAkJRFJNX0VSUk9SKCJEU0kgaGVhZGVyIGNyZWRpdHMgbm90IHJlbGVhc2VkXG4i
KTsKIH0KIAotc3RhdGljIHZvaWQgd2FpdF9mb3JfcGF5bG9hZF9jcmVkaXRzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHdhaXRfZm9yX3BheWxvYWRfY3Jl
ZGl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIGVudW0gdHJhbnNj
b2RlciBkc2lfdHJhbnMpCiB7Ci0JaWYgKHdhaXRfZm9yX3VzKHBheWxvYWRfY3JlZGl0c19hdmFp
bGFibGUoZGV2X3ByaXYsIGRzaV90cmFucykgPj0KKwlpZiAod2FpdF9mb3JfdXMocGF5bG9hZF9j
cmVkaXRzX2F2YWlsYWJsZShpOTE1LCBkc2lfdHJhbnMpID49CiAJCQlNQVhfUExPQURfQ1JFRElU
LCAxMDApKQogCQlEUk1fRVJST1IoIkRTSSBwYXlsb2FkIGNyZWRpdHMgbm90IHJlbGVhc2VkXG4i
KTsKIH0KQEAgLTc1LDcgKzc1LDcgQEAgc3RhdGljIGVudW0gdHJhbnNjb2RlciBkc2lfcG9ydF90
b190cmFuc2NvZGVyKGVudW0gcG9ydCBwb3J0KQogCiBzdGF0aWMgdm9pZCB3YWl0X2Zvcl9jbWRz
X2Rpc3BhdGNoZWRfdG9fcGFuZWwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxf
ZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgbWlwaV9kc2lfZGV2aWNlICpkc2k7CiAJZW51
bSBwb3J0IHBvcnQ7CkBAIC04NSw4ICs4NSw4IEBAIHN0YXRpYyB2b2lkIHdhaXRfZm9yX2NtZHNf
ZGlzcGF0Y2hlZF90b19wYW5lbChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAkvKiB3
YWl0IGZvciBoZWFkZXIvcGF5bG9hZCBjcmVkaXRzIHRvIGJlIHJlbGVhc2VkICovCiAJZm9yX2Vh
Y2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewogCQlkc2lfdHJhbnMgPSBkc2lf
cG9ydF90b190cmFuc2NvZGVyKHBvcnQpOwotCQl3YWl0X2Zvcl9oZWFkZXJfY3JlZGl0cyhkZXZf
cHJpdiwgZHNpX3RyYW5zKTsKLQkJd2FpdF9mb3JfcGF5bG9hZF9jcmVkaXRzKGRldl9wcml2LCBk
c2lfdHJhbnMpOworCQl3YWl0X2Zvcl9oZWFkZXJfY3JlZGl0cyhpOTE1LCBkc2lfdHJhbnMpOwor
CQl3YWl0X2Zvcl9wYXlsb2FkX2NyZWRpdHMoaTkxNSwgZHNpX3RyYW5zKTsKIAl9CiAKIAkvKiBz
ZW5kIG5vcCBEQ1MgY29tbWFuZCAqLwpAQCAtMTAyLDcgKzEwMiw3IEBAIHN0YXRpYyB2b2lkIHdh
aXRfZm9yX2NtZHNfZGlzcGF0Y2hlZF90b19wYW5lbChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlcikKIAkvKiB3YWl0IGZvciBoZWFkZXIgY3JlZGl0cyB0byBiZSByZWxlYXNlZCAqLwogCWZv
cl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+cG9ydHMpIHsKIAkJZHNpX3RyYW5zID0g
ZHNpX3BvcnRfdG9fdHJhbnNjb2Rlcihwb3J0KTsKLQkJd2FpdF9mb3JfaGVhZGVyX2NyZWRpdHMo
ZGV2X3ByaXYsIGRzaV90cmFucyk7CisJCXdhaXRfZm9yX2hlYWRlcl9jcmVkaXRzKGk5MTUsIGRz
aV90cmFucyk7CiAJfQogCiAJLyogd2FpdCBmb3IgTFAgVFggaW4gcHJvZ3Jlc3MgYml0IHRvIGJl
IGNsZWFyZWQgKi8KQEAgLTExOCw3ICsxMTgsNyBAQCBzdGF0aWMgYm9vbCBhZGRfcGF5bGRfdG9f
cXVldWUoc3RydWN0IGludGVsX2RzaV9ob3N0ICpob3N0LCBjb25zdCB1OCAqZGF0YSwKIAkJCSAg
ICAgICB1MzIgbGVuKQogewogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGhvc3QtPmlu
dGVsX2RzaTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGlu
dGVsX2RzaS0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGludGVsX2RzaS0+YmFzZS5iYXNlLmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGRz
aV90cmFucyA9IGRzaV9wb3J0X3RvX3RyYW5zY29kZXIoaG9zdC0+cG9ydCk7CiAJaW50IGZyZWVf
Y3JlZGl0czsKIAlpbnQgaSwgajsKQEAgLTEyNiw3ICsxMjYsNyBAQCBzdGF0aWMgYm9vbCBhZGRf
cGF5bGRfdG9fcXVldWUoc3RydWN0IGludGVsX2RzaV9ob3N0ICpob3N0LCBjb25zdCB1OCAqZGF0
YSwKIAlmb3IgKGkgPSAwOyBpIDwgbGVuOyBpICs9IDQpIHsKIAkJdTMyIHRtcCA9IDA7CiAKLQkJ
ZnJlZV9jcmVkaXRzID0gcGF5bG9hZF9jcmVkaXRzX2F2YWlsYWJsZShkZXZfcHJpdiwgZHNpX3Ry
YW5zKTsKKwkJZnJlZV9jcmVkaXRzID0gcGF5bG9hZF9jcmVkaXRzX2F2YWlsYWJsZShpOTE1LCBk
c2lfdHJhbnMpOwogCQlpZiAoZnJlZV9jcmVkaXRzIDwgMSkgewogCQkJRFJNX0VSUk9SKCJQYXls
b2FkIGNyZWRpdCBub3QgYXZhaWxhYmxlXG4iKTsKIAkJCXJldHVybiBmYWxzZTsKQEAgLTE0NSwx
MyArMTQ1LDEzIEBAIHN0YXRpYyBpbnQgZHNpX3NlbmRfcGt0X2hkcihzdHJ1Y3QgaW50ZWxfZHNp
X2hvc3QgKmhvc3QsCiAJCQkgICAgc3RydWN0IG1pcGlfZHNpX3BhY2tldCBwa3QsIGJvb2wgZW5h
YmxlX2xwZHQpCiB7CiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpID0gaG9zdC0+aW50ZWxf
ZHNpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxf
ZHNpLT5iYXNlLmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoaW50ZWxfZHNpLT5iYXNlLmJhc2UuZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgZHNpX3Ry
YW5zID0gZHNpX3BvcnRfdG9fdHJhbnNjb2Rlcihob3N0LT5wb3J0KTsKIAl1MzIgdG1wOwogCWlu
dCBmcmVlX2NyZWRpdHM7CiAKIAkvKiBjaGVjayBpZiBoZWFkZXIgY3JlZGl0IGF2YWlsYWJsZSAq
LwotCWZyZWVfY3JlZGl0cyA9IGhlYWRlcl9jcmVkaXRzX2F2YWlsYWJsZShkZXZfcHJpdiwgZHNp
X3RyYW5zKTsKKwlmcmVlX2NyZWRpdHMgPSBoZWFkZXJfY3JlZGl0c19hdmFpbGFibGUoaTkxNSwg
ZHNpX3RyYW5zKTsKIAlpZiAoZnJlZV9jcmVkaXRzIDwgMSkgewogCQlEUk1fRVJST1IoInNlbmQg
cGt0IGhlYWRlciBmYWlsZWQsIG5vdCBlbm91Z2ggaGRyIGNyZWRpdHNcbiIpOwogCQlyZXR1cm4g
LTE7CkBAIC0yMDAsNyArMjAwLDcgQEAgc3RhdGljIGludCBkc2lfc2VuZF9wa3RfcGF5bGQoc3Ry
dWN0IGludGVsX2RzaV9ob3N0ICpob3N0LAogCiBzdGF0aWMgdm9pZCBkc2lfcHJvZ3JhbV9zd2lu
Z19hbmRfZGVlbXBoYXNpcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2ko
JmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBwb3J0OwogCXUzMiB0bXA7CkBAIC0yNjYsNyAr
MjY2LDcgQEAgc3RhdGljIHZvaWQgZHNpX3Byb2dyYW1fc3dpbmdfYW5kX2RlZW1waGFzaXMoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiBzdGF0aWMgdm9pZCBjb25maWd1cmVfZHVhbF9s
aW5rX21vZGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlz
dHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5i
YXNlKTsKIAl1MzIgZHNzX2N0bDE7CiAKQEAgLTMwNCw3ICszMDQsNyBAQCBzdGF0aWMgdm9pZCBj
b25maWd1cmVfZHVhbF9saW5rX21vZGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAK
IHN0YXRpYyB2b2lkIGdlbjExX2RzaV9wcm9ncmFtX2VzY19jbGtfZGl2KHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAqaW50
ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJZW51bSBwb3J0IHBv
cnQ7CiAJdTMyIGJwcCA9IG1pcGlfZHNpX3BpeGVsX2Zvcm1hdF90b19icHAoaW50ZWxfZHNpLT5w
aXhlbF9mb3JtYXQpOwpAQCAtMzI5LDcgKzMyOSw3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9w
cm9ncmFtX2VzY19jbGtfZGl2KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCX0KIH0K
IAotc3RhdGljIHZvaWQgZ2V0X2RzaV9pb19wb3dlcl9kb21haW5zKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGdldF9kc2lfaW9fcG93ZXJfZG9tYWlucyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9kc2kg
KmludGVsX2RzaSkKIHsKIAllbnVtIHBvcnQgcG9ydDsKQEAgLTMzNyw3ICszMzcsNyBAQCBzdGF0
aWMgdm9pZCBnZXRfZHNpX2lvX3Bvd2VyX2RvbWFpbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+cG9ydHMpIHsK
IAkJV0FSTl9PTihpbnRlbF9kc2ktPmlvX3dha2VyZWZbcG9ydF0pOwogCQlpbnRlbF9kc2ktPmlv
X3dha2VyZWZbcG9ydF0gPQotCQkJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsCisJ
CQlpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChpOTE1LAogCQkJCQkJcG9ydCA9PSBQT1JUX0EgPwog
CQkJCQkJUE9XRVJfRE9NQUlOX1BPUlRfRERJX0FfSU8gOgogCQkJCQkJUE9XRVJfRE9NQUlOX1BP
UlRfRERJX0JfSU8pOwpAQCAtMzQ2LDcgKzM0Niw3IEBAIHN0YXRpYyB2b2lkIGdldF9kc2lfaW9f
cG93ZXJfZG9tYWlucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIHN0YXRp
YyB2b2lkIGdlbjExX2RzaV9lbmFibGVfaW9fcG93ZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBl
bmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9ydDsKIAl1MzIg
dG1wOwpAQCAtMzU3LDIzICszNTcsMjMgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2VuYWJsZV9p
b19wb3dlcihzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAkJSTkxNV9XUklURShJQ0xf
RFNJX0lPX01PREVDVEwocG9ydCksIHRtcCk7CiAJfQogCi0JZ2V0X2RzaV9pb19wb3dlcl9kb21h
aW5zKGRldl9wcml2LCBpbnRlbF9kc2kpOworCWdldF9kc2lfaW9fcG93ZXJfZG9tYWlucyhpOTE1
LCBpbnRlbF9kc2kpOwogfQogCiBzdGF0aWMgdm9pZCBnZW4xMV9kc2lfcG93ZXJfdXBfbGFuZXMo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3Qg
aW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsK
IAllbnVtIHBvcnQgcG9ydDsKIAogCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+
cG9ydHMpCi0JCWludGVsX2NvbWJvX3BoeV9wb3dlcl91cF9sYW5lcyhkZXZfcHJpdiwgcG9ydCwg
dHJ1ZSwKKwkJaW50ZWxfY29tYm9fcGh5X3Bvd2VyX3VwX2xhbmVzKGk5MTUsIHBvcnQsIHRydWUs
CiAJCQkJCSAgICAgICBpbnRlbF9kc2ktPmxhbmVfY291bnQsIGZhbHNlKTsKIH0KIAogc3RhdGlj
IHZvaWQgZ2VuMTFfZHNpX2NvbmZpZ19waHlfbGFuZXNfc2VxdWVuY2Uoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRl
bF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9y
dDsKIAl1MzIgdG1wOwpAQCAtNDA5LDcgKzQwOSw3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9j
b25maWdfcGh5X2xhbmVzX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQog
CiBzdGF0aWMgdm9pZCBnZW4xMV9kc2lfdm9sdGFnZV9zd2luZ19wcm9ncmFtX3NlcShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9k
c2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCXUzMiB0
bXA7CiAJZW51bSBwb3J0IHBvcnQ7CkBAIC00NjEsNyArNDYxLDcgQEAgc3RhdGljIHZvaWQgZ2Vu
MTFfZHNpX3ZvbHRhZ2Vfc3dpbmdfcHJvZ3JhbV9zZXEoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIpCiAKIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9lbmFibGVfZGRpX2J1ZmZlcihzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9k
c2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCXUzMiB0
bXA7CiAJZW51bSBwb3J0IHBvcnQ7CkBAIC00ODAsNyArNDgwLDcgQEAgc3RhdGljIHZvaWQgZ2Vu
MTFfZHNpX2VuYWJsZV9kZGlfYnVmZmVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQog
CiBzdGF0aWMgdm9pZCBnZW4xMV9kc2lfc2V0dXBfZHBoeV90aW1pbmdzKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAqaW50
ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJdTMyIHRtcDsKIAll
bnVtIHBvcnQgcG9ydDsKQEAgLTUzNSw0OCArNTM1LDQ4IEBAIHN0YXRpYyB2b2lkIGdlbjExX2Rz
aV9zZXR1cF9kcGh5X3RpbWluZ3Moc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIHN0
YXRpYyB2b2lkIGdlbjExX2RzaV9nYXRlX2Nsb2NrcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVu
Y29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVu
Y190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCXUzMiB0bXA7CiAJZW51bSBwb3J0IHBv
cnQ7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHBsbF9sb2NrKTsKKwltdXRleF9sb2NrKCZp
OTE1LT5kcGxsX2xvY2spOwogCXRtcCA9IEk5MTVfUkVBRChEUENMS0FfQ0ZHQ1IwX0lDTCk7CiAJ
Zm9yX2VhY2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewogCQl0bXAgfD0gRFBD
TEtBX0NGR0NSMF9ERElfQ0xLX09GRihwb3J0KTsKIAl9CiAKIAlJOTE1X1dSSVRFKERQQ0xLQV9D
RkdDUjBfSUNMLCB0bXApOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRwbGxfbG9jayk7CisJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcGxsX2xvY2spOwogfQogCiBzdGF0aWMgdm9pZCBnZW4xMV9k
c2lfdW5nYXRlX2Nsb2NrcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2ko
JmVuY29kZXItPmJhc2UpOwogCXUzMiB0bXA7CiAJZW51bSBwb3J0IHBvcnQ7CiAKLQltdXRleF9s
b2NrKCZkZXZfcHJpdi0+ZHBsbF9sb2NrKTsKKwltdXRleF9sb2NrKCZpOTE1LT5kcGxsX2xvY2sp
OwogCXRtcCA9IEk5MTVfUkVBRChEUENMS0FfQ0ZHQ1IwX0lDTCk7CiAJZm9yX2VhY2hfZHNpX3Bv
cnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewogCQl0bXAgJj0gfkRQQ0xLQV9DRkdDUjBfRERJ
X0NMS19PRkYocG9ydCk7CiAJfQogCiAJSTkxNV9XUklURShEUENMS0FfQ0ZHQ1IwX0lDTCwgdG1w
KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcGxsX2xvY2spOworCW11dGV4X3VubG9jaygm
aTkxNS0+ZHBsbF9sb2NrKTsKIH0KIAogc3RhdGljIHZvaWQgZ2VuMTFfZHNpX21hcF9wbGwoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9k
c2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCXN0cnVj
dCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGw7CiAJZW51
bSBwb3J0IHBvcnQ7CiAJdTMyIHZhbDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcGxsX2xv
Y2spOworCW11dGV4X2xvY2soJmk5MTUtPmRwbGxfbG9jayk7CiAKIAl2YWwgPSBJOTE1X1JFQUQo
RFBDTEtBX0NGR0NSMF9JQ0wpOwogCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+
cG9ydHMpIHsKQEAgLTU5MiwxNCArNTkyLDE0IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9tYXBf
cGxsKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJUE9TVElOR19SRUFEKERQQ0xL
QV9DRkdDUjBfSUNMKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRwbGxfbG9jayk7CisJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcGxsX2xvY2spOwogfQogCiBzdGF0aWMgdm9pZAogZ2VuMTFf
ZHNpX2NvbmZpZ3VyZV90cmFuc2NvZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRl
bF9kc2koJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0g
dG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKIAllbnVtIHBpcGUgcGlwZSA9
IGludGVsX2NydGMtPnBpcGU7CkBAIC03MzYsNyArNzM2LDcgQEAgc3RhdGljIHZvaWQKIGdlbjEx
X2RzaV9zZXRfdHJhbnNjb2Rlcl90aW1pbmdzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxf
ZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9CiAJCQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOwpAQCAt
ODQ5LDcgKzg0OSw3IEBAIGdlbjExX2RzaV9zZXRfdHJhbnNjb2Rlcl90aW1pbmdzKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiBzdGF0aWMgdm9pZCBnZW4xMV9kc2lfZW5hYmxlX3Ry
YW5zY29kZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsK
IAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVy
LT5iYXNlKTsKIAllbnVtIHBvcnQgcG9ydDsKIAllbnVtIHRyYW5zY29kZXIgZHNpX3RyYW5zOwpA
QCAtODYyLDcgKzg2Miw3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9lbmFibGVfdHJhbnNjb2Rl
cihzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAkJSTkxNV9XUklURShQSVBFQ09ORihk
c2lfdHJhbnMpLCB0bXApOwogCiAJCS8qIHdhaXQgZm9yIHRyYW5zY29kZXIgdG8gYmUgZW5hYmxl
ZCAqLwotCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJ
CWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAgUElQ
RUNPTkYoZHNpX3RyYW5zKSwKIAkJCQkJICAgIEk5NjVfUElQRUNPTkZfQUNUSVZFLAogCQkJCQkg
ICAgSTk2NV9QSVBFQ09ORl9BQ1RJVkUsIDEwKSkKQEAgLTg3Miw3ICs4NzIsNyBAQCBzdGF0aWMg
dm9pZCBnZW4xMV9kc2lfZW5hYmxlX3RyYW5zY29kZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIpCiAKIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9zZXR1cF90aW1lb3V0cyhzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kg
KmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9y
dCBwb3J0OwogCWVudW0gdHJhbnNjb2RlciBkc2lfdHJhbnM7CkBAIC05NTAsNyArOTUwLDcgQEAg
Z2VuMTFfZHNpX2VuYWJsZV9wb3J0X2FuZF9waHkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAKIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9wb3dlcnVwX3BhbmVsKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAqaW50
ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IG1pcGlf
ZHNpX2RldmljZSAqZHNpOwogCWVudW0gcG9ydCBwb3J0OwpAQCAtMTAyNiw3ICsxMDI2LDcgQEAg
c3RhdGljIHZvaWQgZ2VuMTFfZHNpX3ByZV9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAKIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9kaXNhYmxlX3RyYW5zY29kZXIoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxf
ZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVt
IHBvcnQgcG9ydDsKIAllbnVtIHRyYW5zY29kZXIgZHNpX3RyYW5zOwpAQCAtMTA0MSw3ICsxMDQx
LDcgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2Rpc2FibGVfdHJhbnNjb2RlcihzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlcikKIAkJSTkxNV9XUklURShQSVBFQ09ORihkc2lfdHJhbnMpLCB0
bXApOwogCiAJCS8qIHdhaXQgZm9yIHRyYW5zY29kZXIgdG8gYmUgZGlzYWJsZWQgKi8KLQkJaWYg
KGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCQlpZiAoaW50ZWxf
d2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkJICAgIFBJUEVDT05GKGRzaV90
cmFucyksCiAJCQkJCSAgICBJOTY1X1BJUEVDT05GX0FDVElWRSwgMCwgNTApKQogCQkJRFJNX0VS
Uk9SKCJEU0kgdHJhbmNvZGVyIG5vdCBkaXNhYmxlZFxuIik7CkBAIC0xMDYyLDcgKzEwNjIsNyBA
QCBzdGF0aWMgdm9pZCBnZW4xMV9kc2lfcG93ZXJkb3duX3BhbmVsKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyKQogCiBzdGF0aWMgdm9pZCBnZW4xMV9kc2lfZGVjb25maWd1cmVfdHJhbmNv
ZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGludGVsX2RzaSAqaW50ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFz
ZSk7CiAJZW51bSBwb3J0IHBvcnQ7CiAJZW51bSB0cmFuc2NvZGVyIGRzaV90cmFuczsKQEAgLTEx
MDMsNyArMTEwMyw3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9kZWNvbmZpZ3VyZV90cmFuY29k
ZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIHN0YXRpYyB2b2lkIGdlbjExX2Rz
aV9kaXNhYmxlX3BvcnQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZl
bmNvZGVyLT5iYXNlKTsKIAl1MzIgdG1wOwogCWVudW0gcG9ydCBwb3J0OwpAQCAtMTEyNSw3ICsx
MTI1LDcgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2Rpc2FibGVfcG9ydChzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlcikKIAogc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2Rpc2FibGVfaW9fcG93
ZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNl
KTsKIAllbnVtIHBvcnQgcG9ydDsKIAl1MzIgdG1wOwpAQCAtMTEzNCw3ICsxMTM0LDcgQEAgc3Rh
dGljIHZvaWQgZ2VuMTFfZHNpX2Rpc2FibGVfaW9fcG93ZXIoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIpCiAJCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCiAJCXdha2VyZWYgPSBmZXRj
aF9hbmRfemVybygmaW50ZWxfZHNpLT5pb193YWtlcmVmW3BvcnRdKTsKLQkJaW50ZWxfZGlzcGxh
eV9wb3dlcl9wdXQoZGV2X3ByaXYsCisJCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsCiAJ
CQkJCXBvcnQgPT0gUE9SVF9BID8KIAkJCQkJUE9XRVJfRE9NQUlOX1BPUlRfRERJX0FfSU8gOgog
CQkJCQlQT1dFUl9ET01BSU5fUE9SVF9ERElfQl9JTywKQEAgLTEyMDUsMTMgKzEyMDUsMTMgQEAg
c3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dldF90aW1pbmdzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dldF9jb25maWcoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9k
c2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAogCS8qIEZJWE1FOiBhZGFw
dCBpY2xfZGRpX2Nsb2NrX2dldCgpIGZvciBEU0kgYW5kIHVzZSB0aGF0PyAqLwogCXBpcGVfY29u
ZmlnLT5wb3J0X2Nsb2NrID0KLQkJY25sX2NhbGNfd3JwbGxfbGluayhkZXZfcHJpdiwgJnBpcGVf
Y29uZmlnLT5kcGxsX2h3X3N0YXRlKTsKKwkJY25sX2NhbGNfd3JwbGxfbGluayhpOTE1LCAmcGlw
ZV9jb25maWctPmRwbGxfaHdfc3RhdGUpOwogCiAJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX2Nsb2NrID0gaW50ZWxfZHNpLT5wY2xrOwogCWlmIChpbnRlbF9kc2ktPmR1YWxf
bGluaykKQEAgLTEyNjMsNyArMTI2Myw3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9nZXRfcG93
ZXJfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRpYyBib29sIGdl
bjExX2RzaV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJ
ICAgZW51bSBwaXBlICpwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAq
aW50ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJZW51bSB0cmFu
c2NvZGVyIGRzaV90cmFuczsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKQEAgLTEyNzEsNyAr
MTI3MSw3IEBAIHN0YXRpYyBib29sIGdlbjExX2RzaV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJYm9vbCByZXQgPSBmYWxzZTsKIAl1MzIgdG1wOwogCi0Jd2Fr
ZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsCisJd2Fr
ZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwKIAkJCQkJCSAg
ICAgZW5jb2Rlci0+cG93ZXJfZG9tYWluKTsKIAlpZiAoIXdha2VyZWYpCiAJCXJldHVybiBmYWxz
ZTsKQEAgLTEyOTgsNyArMTI5OCw3IEBAIHN0YXRpYyBib29sIGdlbjExX2RzaV9nZXRfaHdfc3Rh
dGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCXJldCA9IHRtcCAmIFBJUEVDT05G
X0VOQUJMRTsKIAl9CiBvdXQ6Ci0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIGVu
Y29kZXItPnBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQo
aTkxNSwgZW5jb2Rlci0+cG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKIAlyZXR1cm4gcmV0OwogfQog
CkBAIC0xMzkxLDggKzEzOTEsOCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IG1pcGlfZHNpX2hvc3Rf
b3BzIGdlbjExX2RzaV9ob3N0X29wcyA9IHsKIHN0YXRpYyB2b2lkIGljbF9kcGh5X3BhcmFtX2lu
aXQoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSBpbnRlbF9kc2ktPmJhc2UuYmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBtaXBpX2NvbmZpZyAqbWlwaV9jb25m
aWcgPSBkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWc7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IG1pcGlfY29uZmlnICptaXBpX2NvbmZpZyA9
IGk5MTUtPnZidC5kc2kuY29uZmlnOwogCXUzMiB0bHB4X25zOwogCXUzMiBwcmVwYXJlX2NudCwg
ZXhpdF96ZXJvX2NudCwgY2xrX3plcm9fY250LCB0cmFpbF9jbnQ7CiAJdTMyIHRoc19wcmVwYXJl
X25zLCB0Y2xrX3RyYWlsX25zOwpAQCAtMTQ4Nyw5ICsxNDg3LDkgQEAgc3RhdGljIHZvaWQgaWNs
X2RwaHlfcGFyYW1faW5pdChzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kpCiAJaW50ZWxfZHNp
X2xvZ19wYXJhbXMoaW50ZWxfZHNpKTsKIH0KIAotdm9pZCBpY2xfZHNpX2luaXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpY2xfZHNpX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJp
di0+ZHJtOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBp
bnRlbF9kc2kgKmludGVsX2RzaTsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAlz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3I7CkBAIC0xNDk3LDcgKzE0OTcs
NyBAQCB2b2lkIGljbF9kc2lfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmZpeGVkX21vZGU7CiAJZW51bSBwb3J0IHBvcnQ7
CiAKLQlpZiAoIWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoZGV2X3ByaXYsICZwb3J0KSkKKwlp
ZiAoIWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoaTkxNSwgJnBvcnQpKQogCQlyZXR1cm47CiAK
IAlpbnRlbF9kc2kgPSBremFsbG9jKHNpemVvZigqaW50ZWxfZHNpKSwgR0ZQX0tFUk5FTCk7CkBA
IC0xNTU2LDEzICsxNTU2LDEzIEBAIHZvaWQgaWNsX2RzaV9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAlpbnRlbF9wYW5lbF9pbml0KCZpbnRlbF9jb25uZWN0b3ItPnBh
bmVsLCBmaXhlZF9tb2RlLCBOVUxMKTsKIAlpbnRlbF9wYW5lbF9zZXR1cF9iYWNrbGlnaHQoY29u
bmVjdG9yLCBJTlZBTElEX1BJUEUpOwogCi0JaWYgKGRldl9wcml2LT52YnQuZHNpLmNvbmZpZy0+
ZHVhbF9saW5rKQorCWlmIChpOTE1LT52YnQuZHNpLmNvbmZpZy0+ZHVhbF9saW5rKQogCQlpbnRl
bF9kc2ktPnBvcnRzID0gQklUKFBPUlRfQSkgfCBCSVQoUE9SVF9CKTsKIAllbHNlCiAJCWludGVs
X2RzaS0+cG9ydHMgPSBCSVQocG9ydCk7CiAKLQlpbnRlbF9kc2ktPmRjc19iYWNrbGlnaHRfcG9y
dHMgPSBkZXZfcHJpdi0+dmJ0LmRzaS5ibF9wb3J0czsKLQlpbnRlbF9kc2ktPmRjc19jYWJjX3Bv
cnRzID0gZGV2X3ByaXYtPnZidC5kc2kuY2FiY19wb3J0czsKKwlpbnRlbF9kc2ktPmRjc19iYWNr
bGlnaHRfcG9ydHMgPSBpOTE1LT52YnQuZHNpLmJsX3BvcnRzOworCWludGVsX2RzaS0+ZGNzX2Nh
YmNfcG9ydHMgPSBpOTE1LT52YnQuZHNpLmNhYmNfcG9ydHM7CiAKIAlmb3JfZWFjaF9kc2lfcG9y
dChwb3J0LCBpbnRlbF9kc2ktPnBvcnRzKSB7CiAJCXN0cnVjdCBpbnRlbF9kc2lfaG9zdCAqaG9z
dDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2F0b21pYy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfYXRvbWljLmMKaW5kZXggNmI5ODVlODk1YTk3Li40NTc4
MmU2ZmYwZjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2F0b21pYy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2F0b21pYy5jCkBAIC01NCwxMyArNTQs
MTMgQEAgaW50IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX2F0b21pY19nZXRfcHJvcGVydHkoc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJCQkJCXU2NCAqdmFsKQogewogCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXYgPSBjb25uZWN0b3ItPmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0
YXRlICppbnRlbF9jb25uX3N0YXRlID0KIAkJdG9faW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3Rh
dGUoc3RhdGUpOwogCi0JaWYgKHByb3BlcnR5ID09IGRldl9wcml2LT5mb3JjZV9hdWRpb19wcm9w
ZXJ0eSkKKwlpZiAocHJvcGVydHkgPT0gaTkxNS0+Zm9yY2VfYXVkaW9fcHJvcGVydHkpCiAJCSp2
YWwgPSBpbnRlbF9jb25uX3N0YXRlLT5mb3JjZV9hdWRpbzsKLQllbHNlIGlmIChwcm9wZXJ0eSA9
PSBkZXZfcHJpdi0+YnJvYWRjYXN0X3JnYl9wcm9wZXJ0eSkKKwllbHNlIGlmIChwcm9wZXJ0eSA9
PSBpOTE1LT5icm9hZGNhc3RfcmdiX3Byb3BlcnR5KQogCQkqdmFsID0gaW50ZWxfY29ubl9zdGF0
ZS0+YnJvYWRjYXN0X3JnYjsKIAllbHNlIHsKIAkJRFJNX0RFQlVHX0FUT01JQygiVW5rbm93biBw
cm9wZXJ0eSBbUFJPUDolZDolc11cbiIsCkBAIC04NiwxNiArODYsMTYgQEAgaW50IGludGVsX2Rp
Z2l0YWxfY29ubmVjdG9yX2F0b21pY19zZXRfcHJvcGVydHkoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvciwKIAkJCQkJCXU2NCB2YWwpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
IGNvbm5lY3Rvci0+ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2
KTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3Rh
dGUgPQogCQl0b19pbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZShzdGF0ZSk7CiAKLQlpZiAo
cHJvcGVydHkgPT0gZGV2X3ByaXYtPmZvcmNlX2F1ZGlvX3Byb3BlcnR5KSB7CisJaWYgKHByb3Bl
cnR5ID09IGk5MTUtPmZvcmNlX2F1ZGlvX3Byb3BlcnR5KSB7CiAJCWludGVsX2Nvbm5fc3RhdGUt
PmZvcmNlX2F1ZGlvID0gdmFsOwogCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAocHJvcGVydHkgPT0g
ZGV2X3ByaXYtPmJyb2FkY2FzdF9yZ2JfcHJvcGVydHkpIHsKKwlpZiAocHJvcGVydHkgPT0gaTkx
NS0+YnJvYWRjYXN0X3JnYl9wcm9wZXJ0eSkgewogCQlpbnRlbF9jb25uX3N0YXRlLT5icm9hZGNh
c3RfcmdiID0gdmFsOwogCQlyZXR1cm4gMDsKIAl9CkBAIC0yMjcsNyArMjI3LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zY2FsZXJf
c3RhdGUgKnNjYWxlcl9zdGEKIAkJCQkgICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlLAogCQkJCSAgICAgIGludCAqc2NhbGVyX2lkKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfY3J0Yy0+YmFzZS5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRl
dik7CiAJaW50IGo7CiAJdTMyIG1vZGU7CiAKQEAgLTI1MSwxMCArMjUxLDEwIEBAIHN0YXRpYyB2
b2lkIGludGVsX2F0b21pY19zZXR1cF9zY2FsZXIoc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0
YXRlICpzY2FsZXJfc3RhCiAJICAgIHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmlzX3l1
diAmJgogCSAgICBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5udW1fcGxhbmVzID4gMSkg
ewogCQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUpOwotCQlpZiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJgotCQkgICAgIUlT
X0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJCWlmIChJU19HRU4oaTkxNSwgOSkgJiYKKwkJICAg
ICFJU19HRU1JTklMQUtFKGk5MTUpKSB7CiAJCQltb2RlID0gU0tMX1BTX1NDQUxFUl9NT0RFX05W
MTI7Ci0JCX0gZWxzZSBpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmUtPmlkKSkg
eworCQl9IGVsc2UgaWYgKGljbF9pc19oZHJfcGxhbmUoaTkxNSwgcGxhbmUtPmlkKSkgewogCQkJ
LyoKIAkJCSAqIE9uIGdlbjExKydzIEhEUiBwbGFuZXMgd2Ugb25seSB1c2UgdGhlIHNjYWxlciBm
b3IKIAkJCSAqIHNjYWxpbmcuIFRoZXkgaGF2ZSBhIGRlZGljYXRlZCBjaHJvbWEgdXBzYW1wbGVy
LCBzbwpAQCAtMjY3LDcgKzI2Nyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19zZXR1cF9z
Y2FsZXIoc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhCiAJCQlpZiAo
cGxhbmVfc3RhdGUtPmxpbmtlZF9wbGFuZSkKIAkJCQltb2RlIHw9IFBTX1BMQU5FX1lfU0VMKHBs
YW5lX3N0YXRlLT5saW5rZWRfcGxhbmUtPmlkKTsKIAkJfQotCX0gZWxzZSBpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+IDkgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYg
KElOVEVMX0dFTihpOTE1KSA+IDkgfHwgSVNfR0VNSU5JTEFLRShpOTE1KSkgewogCQltb2RlID0g
UFNfU0NBTEVSX01PREVfTk9STUFMOwogCX0gZWxzZSBpZiAobnVtX3NjYWxlcnNfbmVlZCA9PSAx
ICYmIGludGVsX2NydGMtPm51bV9zY2FsZXJzID4gMSkgewogCQkvKgpAQCAtMjkwLDcgKzI5MCw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19zZXR1cF9zY2FsZXIoc3RydWN0IGludGVsX2Ny
dGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhCiAKIC8qKgogICogaW50ZWxfYXRvbWljX3NldHVw
X3NjYWxlcnMoKSAtIHNldHVwIHNjYWxlcnMgZm9yIGNydGMgcGVyIHN0YWdlZCByZXF1ZXN0cwot
ICogQGRldl9wcml2OiBpOTE1IGRldmljZQorICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKiBAaW50
ZWxfY3J0YzogaW50ZWwgY3J0YwogICogQGNydGNfc3RhdGU6IGluY29taW5nIGNydGNfc3RhdGUg
dG8gdmFsaWRhdGUgYW5kIHNldHVwIHNjYWxlcnMKICAqCkBAIC0zMDUsNyArMzA1LDcgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zY2Fs
ZXJfc3RhdGUgKnNjYWxlcl9zdGEKICAqICAgICAgICAgMCAtIHNjYWxlcnMgd2VyZSBzZXR1cCBz
dWNjZXNmdWxseQogICogICAgICAgICBlcnJvciBjb2RlIC0gb3RoZXJ3aXNlCiAgKi8KLWludCBp
bnRlbF9hdG9taWNfc2V0dXBfc2NhbGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitpbnQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcnMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkgICAgICAgc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJCQkg
ICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CkBAIC0zNjksNyAr
MzY5LDcgQEAgaW50IGludGVsX2F0b21pY19zZXR1cF9zY2FsZXJzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkJCSAqLwogCQkJaWYgKCFwbGFuZSkgewogCQkJCXN0cnVjdCBk
cm1fcGxhbmVfc3RhdGUgKnN0YXRlOwotCQkJCXBsYW5lID0gZHJtX3BsYW5lX2Zyb21faW5kZXgo
JmRldl9wcml2LT5kcm0sIGkpOworCQkJCXBsYW5lID0gZHJtX3BsYW5lX2Zyb21faW5kZXgoJmk5
MTUtPmRybSwgaSk7CiAJCQkJc3RhdGUgPSBkcm1fYXRvbWljX2dldF9wbGFuZV9zdGF0ZShkcm1f
c3RhdGUsIHBsYW5lKTsKIAkJCQlpZiAoSVNfRVJSKHN0YXRlKSkgewogCQkJCQlEUk1fREVCVUdf
S01TKCJGYWlsZWQgdG8gYWRkIFtQTEFORTolZF0gdG8gZHJtX3N0YXRlXG4iLApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfYXRvbWljLmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9hdG9taWMuaAppbmRleCAxYzg1MDdkYTFhNjkuLjU0ODJmZDA0ZDYzOSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfYXRvbWljLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfYXRvbWljLmgKQEAgLTQyLDcgKzQyLDcgQEAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKgogaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKHN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7CiAK
LWludCBpbnRlbF9hdG9taWNfc2V0dXBfc2NhbGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCitpbnQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcnMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMs
CiAJCQkgICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9hdWRpby5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfYXVkaW8uYwppbmRleCA4NDBkYWZmMTIyNDYuLmY0NjNkODQ1MmZlOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfYXVkaW8uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9hdWRpby5jCkBAIC0yMzAsNyArMjMwLDcgQEAgc3RhdGlj
IGJvb2wgaW50ZWxfZWxkX3VwdG9kYXRlKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Is
CiAJCQkgICAgICAgaTkxNV9yZWdfdCByZWdfZWxkYSwgdTMyIGJpdHNfZWxkYSwKIAkJCSAgICAg
ICBpOTE1X3JlZ190IHJlZ19lZGlkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7CiAJY29uc3QgdTggKmVsZCA9IGNvbm5l
Y3Rvci0+ZWxkOwogCXUzMiB0bXA7CiAJaW50IGk7CkBAIC0yNTYsNyArMjU2LDcgQEAgc3RhdGlj
IHZvaWQgZzR4X2F1ZGlvX2NvZGVjX2Rpc2FibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
ZSwKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0
YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIGVsZHYsIHRtcDsKIAogCURSTV9ERUJVR19LTVMo
IkRpc2FibGUgYXVkaW8gY29kZWNcbiIpOwpAQCAtMjc3LDcgKzI3Nyw3IEBAIHN0YXRpYyB2b2lk
IGc0eF9hdWRpb19jb2RlY19lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAg
Y29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gY29ubl9zdGF0ZS0+Y29u
bmVjdG9yOwogCWNvbnN0IHU4ICplbGQgPSBjb25uZWN0b3ItPmVsZDsKIAl1MzIgZWxkdjsKQEAg
LTMxNyw4ICszMTcsOCBAQCBzdGF0aWMgdm9pZAogaHN3X2RwX2F1ZGlvX2NvbmZpZ191cGRhdGUo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaTkxNV9hdWRpb19j
b21wb25lbnQgKmFjb21wID0gZGV2X3ByaXYtPmF1ZGlvX2NvbXBvbmVudDsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVj
dCBpOTE1X2F1ZGlvX2NvbXBvbmVudCAqYWNvbXAgPSBpOTE1LT5hdWRpb19jb21wb25lbnQ7CiAJ
ZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29k
ZXI7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWNvbnN0IHN0cnVjdCBkcF9h
dWRfbl9tICpubTsKQEAgLTM2NCw4ICszNjQsOCBAQCBzdGF0aWMgdm9pZAogaHN3X2hkbWlfYXVk
aW9fY29uZmlnX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0J
c3RydWN0IGk5MTVfYXVkaW9fY29tcG9uZW50ICphY29tcCA9IGRldl9wcml2LT5hdWRpb19jb21w
b25lbnQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaTkxNV9hdWRpb19jb21wb25lbnQgKmFjb21wID0gaTkxNS0+
YXVkaW9fY29tcG9uZW50OwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNf
c3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsK
IAlpbnQgbiwgcmF0ZTsKQEAgLTQxNiwxNCArNDE2LDE0IEBAIHN0YXRpYyB2b2lkIGhzd19hdWRp
b19jb2RlY19kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJICAgIGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IG9sZF9jcnRjX3N0YXRl
LT5jcHVfdHJhbnNjb2RlcjsKIAl1MzIgdG1wOwogCiAJRFJNX0RFQlVHX0tNUygiRGlzYWJsZSBh
dWRpbyBjb2RlYyBvbiB0cmFuc2NvZGVyICVzXG4iLAogCQkgICAgICB0cmFuc2NvZGVyX25hbWUo
Y3B1X3RyYW5zY29kZXIpKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5hdl9tdXRleCk7CisJ
bXV0ZXhfbG9jaygmaTkxNS0+YXZfbXV0ZXgpOwogCiAJLyogRGlzYWJsZSB0aW1lc3RhbXBzICov
CiAJdG1wID0gSTkxNV9SRUFEKEhTV19BVURfQ0ZHKGNwdV90cmFuc2NvZGVyKSk7CkBAIC00NDEs
MTQgKzQ0MSwxNCBAQCBzdGF0aWMgdm9pZCBoc3dfYXVkaW9fY29kZWNfZGlzYWJsZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAl0bXAgJj0gfkFVRElPX09VVFBVVF9FTkFCTEUoY3B1
X3RyYW5zY29kZXIpOwogCUk5MTVfV1JJVEUoSFNXX0FVRF9QSU5fRUxEX0NQX1ZMRCwgdG1wKTsK
IAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmF2X211dGV4KTsKKwltdXRleF91bmxvY2soJmk5
MTUtPmF2X211dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgaHN3X2F1ZGlvX2NvZGVjX2VuYWJsZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IgPSBjb25uX3N0YXRlLT5jb25uZWN0b3I7CiAJZW51bSB0cmFuc2NvZGVy
IGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAJY29uc3QgdTgg
KmVsZCA9IGNvbm5lY3Rvci0+ZWxkOwpAQCAtNDU4LDcgKzQ1OCw3IEBAIHN0YXRpYyB2b2lkIGhz
d19hdWRpb19jb2RlY19lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJRFJN
X0RFQlVHX0tNUygiRW5hYmxlIGF1ZGlvIGNvZGVjIG9uIHRyYW5zY29kZXIgJXMsICV1IGJ5dGVz
IEVMRFxuIiwKIAkJICAgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSwgZHJtX2Vs
ZF9zaXplKGVsZCkpOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmF2X211dGV4KTsKKwltdXRl
eF9sb2NrKCZpOTE1LT5hdl9tdXRleCk7CiAKIAkvKiBFbmFibGUgYXVkaW8gcHJlc2VuY2UgZGV0
ZWN0LCBpbnZhbGlkYXRlIEVMRCAqLwogCXRtcCA9IEk5MTVfUkVBRChIU1dfQVVEX1BJTl9FTERf
Q1BfVkxEKTsKQEAgLTQ5MSwxNCArNDkxLDE0IEBAIHN0YXRpYyB2b2lkIGhzd19hdWRpb19jb2Rl
Y19lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJLyogRW5hYmxlIHRpbWVz
dGFtcHMgKi8KIAloc3dfYXVkaW9fY29uZmlnX3VwZGF0ZShlbmNvZGVyLCBjcnRjX3N0YXRlKTsK
IAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmF2X211dGV4KTsKKwltdXRleF91bmxvY2soJmk5
MTUtPmF2X211dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgaWxrX2F1ZGlvX2NvZGVjX2Rpc2FibGUo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNy
dGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAllbnVtIHBvcnQgcG9ydCA9IGVu
Y29kZXItPnBvcnQ7CkBAIC01MTEsMTAgKzUxMSwxMCBAQCBzdGF0aWMgdm9pZCBpbGtfYXVkaW9f
Y29kZWNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlpZiAoV0FSTl9P
Tihwb3J0ID09IFBPUlRfQSkpCiAJCXJldHVybjsKIAotCWlmIChIQVNfUENIX0lCWChkZXZfcHJp
dikpIHsKKwlpZiAoSEFTX1BDSF9JQlgoaTkxNSkpIHsKIAkJYXVkX2NvbmZpZyA9IElCWF9BVURf
Q0ZHKHBpcGUpOwogCQlhdWRfY250cmxfc3QyID0gSUJYX0FVRF9DTlRMX1NUMjsKLQl9IGVsc2Ug
aWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7
CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkp
IHsKIAkJYXVkX2NvbmZpZyA9IFZMVl9BVURfQ0ZHKHBpcGUpOwogCQlhdWRfY250cmxfc3QyID0g
VkxWX0FVRF9DTlRMX1NUMjsKIAl9IGVsc2UgewpAQCAtNTQ0LDcgKzU0NCw3IEBAIHN0YXRpYyB2
b2lkIGlsa19hdWRpb19jb2RlY19lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJ
ICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gY29u
bl9zdGF0ZS0+Y29ubmVjdG9yOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKQEAgLTU2
NywxMyArNTY3LDEzIEBAIHN0YXRpYyB2b2lkIGlsa19hdWRpb19jb2RlY19lbmFibGUoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICogaW5mcmFzdHJ1Y3R1cmUgaXMgbm90IHRoZXJl
IHlldC4KIAkgKi8KIAotCWlmIChIQVNfUENIX0lCWChkZXZfcHJpdikpIHsKKwlpZiAoSEFTX1BD
SF9JQlgoaTkxNSkpIHsKIAkJaGRtaXdfaGRtaWVkaWQgPSBJQlhfSERNSVdfSERNSUVESUQocGlw
ZSk7CiAJCWF1ZF9jb25maWcgPSBJQlhfQVVEX0NGRyhwaXBlKTsKIAkJYXVkX2NudGxfc3QgPSBJ
QlhfQVVEX0NOVExfU1QocGlwZSk7CiAJCWF1ZF9jbnRybF9zdDIgPSBJQlhfQVVEX0NOVExfU1Qy
OwotCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwKLQkJICAgSVNfQ0hFUlJZ
VklFVyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwKKwkJ
ICAgSVNfQ0hFUlJZVklFVyhpOTE1KSkgewogCQloZG1pd19oZG1pZWRpZCA9IFZMVl9IRE1JV19I
RE1JRURJRChwaXBlKTsKIAkJYXVkX2NvbmZpZyA9IFZMVl9BVURfQ0ZHKHBpcGUpOwogCQlhdWRf
Y250bF9zdCA9IFZMVl9BVURfQ05UTF9TVChwaXBlKTsKQEAgLTYzMiw4ICs2MzIsOCBAQCB2b2lk
IGludGVsX2F1ZGlvX2NvZGVjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJ
ICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7Ci0Jc3RydWN0IGk5MTVfYXVkaW9fY29tcG9uZW50ICphY29tcCA9IGRldl9wcml2LT5h
dWRpb19jb21wb25lbnQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaTkxNV9hdWRpb19jb21wb25lbnQgKmFjb21w
ID0gaTkxNS0+YXVkaW9fY29tcG9uZW50OwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IgPSBjb25uX3N0YXRlLT5jb25uZWN0b3I7CiAJY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQpAQCAtNjU0LDE3ICs2NTQsMTcgQEAgdm9pZCBp
bnRlbF9hdWRpb19jb2RlY19lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAK
IAljb25uZWN0b3ItPmVsZFs2XSA9IGRybV9hdl9zeW5jX2RlbGF5KGNvbm5lY3RvciwgYWRqdXN0
ZWRfbW9kZSkgLyAyOwogCi0JaWYgKGRldl9wcml2LT5kaXNwbGF5LmF1ZGlvX2NvZGVjX2VuYWJs
ZSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuYXVkaW9fY29kZWNfZW5hYmxlKGVuY29kZXIsCisJaWYg
KGk5MTUtPmRpc3BsYXkuYXVkaW9fY29kZWNfZW5hYmxlKQorCQlpOTE1LT5kaXNwbGF5LmF1ZGlv
X2NvZGVjX2VuYWJsZShlbmNvZGVyLAogCQkJCQkJICAgICBjcnRjX3N0YXRlLAogCQkJCQkJICAg
ICBjb25uX3N0YXRlKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5hdl9tdXRleCk7CisJbXV0
ZXhfbG9jaygmaTkxNS0+YXZfbXV0ZXgpOwogCWVuY29kZXItPmF1ZGlvX2Nvbm5lY3RvciA9IGNv
bm5lY3RvcjsKIAogCS8qIHJlZmVycmVkIGluIGF1ZGlvIGNhbGxiYWNrcyAqLwotCWRldl9wcml2
LT5hdl9lbmNfbWFwW3BpcGVdID0gZW5jb2RlcjsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5h
dl9tdXRleCk7CisJaTkxNS0+YXZfZW5jX21hcFtwaXBlXSA9IGVuY29kZXI7CisJbXV0ZXhfdW5s
b2NrKCZpOTE1LT5hdl9tdXRleCk7CiAKIAlpZiAoYWNvbXAgJiYgYWNvbXAtPmJhc2UuYXVkaW9f
b3BzICYmCiAJICAgIGFjb21wLT5iYXNlLmF1ZGlvX29wcy0+cGluX2VsZF9ub3RpZnkpIHsKQEAg
LTY3NSw3ICs2NzUsNyBAQCB2b2lkIGludGVsX2F1ZGlvX2NvZGVjX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJCSAoaW50KSBwb3J0LCAoaW50KSBwaXBlKTsKIAl9
CiAKLQlpbnRlbF9scGVfYXVkaW9fbm90aWZ5KGRldl9wcml2LCBwaXBlLCBwb3J0LCBjb25uZWN0
b3ItPmVsZCwKKwlpbnRlbF9scGVfYXVkaW9fbm90aWZ5KGk5MTUsIHBpcGUsIHBvcnQsIGNvbm5l
Y3Rvci0+ZWxkLAogCQkJICAgICAgIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCiAJCQkgICAgICAg
aW50ZWxfY3J0Y19oYXNfZHBfZW5jb2RlcihjcnRjX3N0YXRlKSk7CiB9CkBAIC02OTMsMjEgKzY5
MywyMSBAQCB2b2lkIGludGVsX2F1ZGlvX2NvZGVjX2Rpc2FibGUoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9s
ZF9jcnRjX3N0YXRlLAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRl
ICpvbGRfY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaTkxNV9hdWRpb19jb21wb25l
bnQgKmFjb21wID0gZGV2X3ByaXYtPmF1ZGlvX2NvbXBvbmVudDsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBpOTE1
X2F1ZGlvX2NvbXBvbmVudCAqYWNvbXAgPSBpOTE1LT5hdWRpb19jb21wb25lbnQ7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNy
dGMpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAllbnVtIHBpcGUgcGlwZSA9
IGNydGMtPnBpcGU7CiAKLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuYXVkaW9fY29kZWNfZGlzYWJs
ZSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuYXVkaW9fY29kZWNfZGlzYWJsZShlbmNvZGVyLAorCWlm
IChpOTE1LT5kaXNwbGF5LmF1ZGlvX2NvZGVjX2Rpc2FibGUpCisJCWk5MTUtPmRpc3BsYXkuYXVk
aW9fY29kZWNfZGlzYWJsZShlbmNvZGVyLAogCQkJCQkJICAgICAgb2xkX2NydGNfc3RhdGUsCiAJ
CQkJCQkgICAgICBvbGRfY29ubl9zdGF0ZSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YXZf
bXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPmF2X211dGV4KTsKIAllbmNvZGVyLT5hdWRpb19j
b25uZWN0b3IgPSBOVUxMOwotCWRldl9wcml2LT5hdl9lbmNfbWFwW3BpcGVdID0gTlVMTDsKLQlt
dXRleF91bmxvY2soJmRldl9wcml2LT5hdl9tdXRleCk7CisJaTkxNS0+YXZfZW5jX21hcFtwaXBl
XSA9IE5VTEw7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5hdl9tdXRleCk7CiAKIAlpZiAoYWNvbXAg
JiYgYWNvbXAtPmJhc2UuYXVkaW9fb3BzICYmCiAJICAgIGFjb21wLT5iYXNlLmF1ZGlvX29wcy0+
cGluX2VsZF9ub3RpZnkpIHsKQEAgLTcxOCwzMSArNzE4LDMxIEBAIHZvaWQgaW50ZWxfYXVkaW9f
Y29kZWNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJCSAoaW50
KSBwb3J0LCAoaW50KSBwaXBlKTsKIAl9CiAKLQlpbnRlbF9scGVfYXVkaW9fbm90aWZ5KGRldl9w
cml2LCBwaXBlLCBwb3J0LCBOVUxMLCAwLCBmYWxzZSk7CisJaW50ZWxfbHBlX2F1ZGlvX25vdGlm
eShpOTE1LCBwaXBlLCBwb3J0LCBOVUxMLCAwLCBmYWxzZSk7CiB9CiAKIC8qKgogICogaW50ZWxf
aW5pdF9hdWRpb19ob29rcyAtIFNldCB1cCBjaGlwIHNwZWNpZmljIGF1ZGlvIGhvb2tzCi0gKiBA
ZGV2X3ByaXY6IGRldmljZSBwcml2YXRlCisgKiBAaTkxNTogZGV2aWNlIHByaXZhdGUKICAqLwot
dm9pZCBpbnRlbF9pbml0X2F1ZGlvX2hvb2tzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3ZvaWQgaW50ZWxfaW5pdF9hdWRpb19ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKLQlpZiAoSVNfRzRYKGRldl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZGlzcGxh
eS5hdWRpb19jb2RlY19lbmFibGUgPSBnNHhfYXVkaW9fY29kZWNfZW5hYmxlOwotCQlkZXZfcHJp
di0+ZGlzcGxheS5hdWRpb19jb2RlY19kaXNhYmxlID0gZzR4X2F1ZGlvX2NvZGVjX2Rpc2FibGU7
Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRl
dl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5hdWRpb19jb2RlY19lbmFibGUgPSBpbGtf
YXVkaW9fY29kZWNfZW5hYmxlOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5hdWRpb19jb2RlY19kaXNh
YmxlID0gaWxrX2F1ZGlvX2NvZGVjX2Rpc2FibGU7Ci0JfSBlbHNlIGlmIChJU19IQVNXRUxMKGRl
dl9wcml2KSB8fCBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpIHsKLQkJZGV2X3ByaXYtPmRpc3Bs
YXkuYXVkaW9fY29kZWNfZW5hYmxlID0gaHN3X2F1ZGlvX2NvZGVjX2VuYWJsZTsKLQkJZGV2X3By
aXYtPmRpc3BsYXkuYXVkaW9fY29kZWNfZGlzYWJsZSA9IGhzd19hdWRpb19jb2RlY19kaXNhYmxl
OwotCX0gZWxzZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpIHsKLQkJZGV2X3ByaXYtPmRp
c3BsYXkuYXVkaW9fY29kZWNfZW5hYmxlID0gaWxrX2F1ZGlvX2NvZGVjX2VuYWJsZTsKLQkJZGV2
X3ByaXYtPmRpc3BsYXkuYXVkaW9fY29kZWNfZGlzYWJsZSA9IGlsa19hdWRpb19jb2RlY19kaXNh
YmxlOworCWlmIChJU19HNFgoaTkxNSkpIHsKKwkJaTkxNS0+ZGlzcGxheS5hdWRpb19jb2RlY19l
bmFibGUgPSBnNHhfYXVkaW9fY29kZWNfZW5hYmxlOworCQlpOTE1LT5kaXNwbGF5LmF1ZGlvX2Nv
ZGVjX2Rpc2FibGUgPSBnNHhfYXVkaW9fY29kZWNfZGlzYWJsZTsKKwl9IGVsc2UgaWYgKElTX1ZB
TExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkgeworCQlpOTE1LT5kaXNwbGF5
LmF1ZGlvX2NvZGVjX2VuYWJsZSA9IGlsa19hdWRpb19jb2RlY19lbmFibGU7CisJCWk5MTUtPmRp
c3BsYXkuYXVkaW9fY29kZWNfZGlzYWJsZSA9IGlsa19hdWRpb19jb2RlY19kaXNhYmxlOworCX0g
ZWxzZSBpZiAoSVNfSEFTV0VMTChpOTE1KSB8fCBJTlRFTF9HRU4oaTkxNSkgPj0gOCkgeworCQlp
OTE1LT5kaXNwbGF5LmF1ZGlvX2NvZGVjX2VuYWJsZSA9IGhzd19hdWRpb19jb2RlY19lbmFibGU7
CisJCWk5MTUtPmRpc3BsYXkuYXVkaW9fY29kZWNfZGlzYWJsZSA9IGhzd19hdWRpb19jb2RlY19k
aXNhYmxlOworCX0gZWxzZSBpZiAoSEFTX1BDSF9TUExJVChpOTE1KSkgeworCQlpOTE1LT5kaXNw
bGF5LmF1ZGlvX2NvZGVjX2VuYWJsZSA9IGlsa19hdWRpb19jb2RlY19lbmFibGU7CisJCWk5MTUt
PmRpc3BsYXkuYXVkaW9fY29kZWNfZGlzYWJsZSA9IGlsa19hdWRpb19jb2RlY19kaXNhYmxlOwog
CX0KIH0KIAotc3RhdGljIHZvaWQgZ2xrX2ZvcmNlX2F1ZGlvX2NkY2xrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGdsa19mb3JjZV9hdWRpb19jZGNsayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgIGJvb2wgZW5hYmxlKQogewogCXN0
cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCBjdHg7CkBAIC03NTAsNyArNzUwLDcgQEAgc3Rh
dGljIHZvaWQgZ2xrX2ZvcmNlX2F1ZGlvX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAlpbnQgcmV0OwogCiAJZHJtX21vZGVzZXRfYWNxdWlyZV9pbml0KCZjdHgsIDAp
OwotCXN0YXRlID0gZHJtX2F0b21pY19zdGF0ZV9hbGxvYygmZGV2X3ByaXYtPmRybSk7CisJc3Rh
dGUgPSBkcm1fYXRvbWljX3N0YXRlX2FsbG9jKCZpOTE1LT5kcm0pOwogCWlmIChXQVJOX09OKCFz
dGF0ZSkpCiAJCXJldHVybjsKIApAQCAtNzYyLDExICs3NjIsMTEgQEAgc3RhdGljIHZvaWQgZ2xr
X2ZvcmNlX2F1ZGlvX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJ
ZW5hYmxlID8gMiAqIDk2MDAwIDogMDsKIAogCS8qCi0JICogUHJvdGVjdHMgZGV2X3ByaXYtPmNk
Y2xrLmZvcmNlX21pbl9jZGNsaworCSAqIFByb3RlY3RzIGk5MTUtPmNkY2xrLmZvcmNlX21pbl9j
ZGNsawogCSAqIE5lZWQgdG8gbG9jayB0aGlzIGhlcmUgaW4gY2FzZSB3ZSBoYXZlIG5vIGFjdGl2
ZSBwaXBlcwogCSAqIGFuZCB0aHVzIHdvdWxkbid0IGxvY2sgaXQgZHVyaW5nIHRoZSBjb21taXQg
b3RoZXJ3aXNlLgogCSAqLwotCXJldCA9IGRybV9tb2Rlc2V0X2xvY2soJmRldl9wcml2LT5kcm0u
bW9kZV9jb25maWcuY29ubmVjdGlvbl9tdXRleCwKKwlyZXQgPSBkcm1fbW9kZXNldF9sb2NrKCZp
OTE1LT5kcm0ubW9kZV9jb25maWcuY29ubmVjdGlvbl9tdXRleCwKIAkJCSAgICAgICAmY3R4KTsK
IAlpZiAoIXJldCkKIAkJcmV0ID0gZHJtX2F0b21pY19jb21taXQoc3RhdGUpOwpAQCAtNzg3LDE4
ICs3ODcsMTggQEAgc3RhdGljIHZvaWQgZ2xrX2ZvcmNlX2F1ZGlvX2NkY2xrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogc3RhdGljIHVuc2lnbmVkIGxvbmcgaTkxNV9hdWRp
b19jb21wb25lbnRfZ2V0X3Bvd2VyKHN0cnVjdCBkZXZpY2UgKmtkZXYpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl90b19pOTE1KGtkZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl90b19pOTE1KGtkZXYpOwogCWludGVsX3dha2Vy
ZWZfdCByZXQ7CiAKIAkvKiBDYXRjaCBwb3RlbnRpYWwgaW1wZWRhbmNlIG1pc21hdGNoZXMgYmVm
b3JlIHRoZXkgb2NjdXIhICovCiAJQlVJTERfQlVHX09OKHNpemVvZihpbnRlbF93YWtlcmVmX3Qp
ID4gc2l6ZW9mKHVuc2lnbmVkIGxvbmcpKTsKIAotCXJldCA9IGludGVsX2Rpc3BsYXlfcG93ZXJf
Z2V0KGRldl9wcml2LCBQT1dFUl9ET01BSU5fQVVESU8pOworCXJldCA9IGludGVsX2Rpc3BsYXlf
cG93ZXJfZ2V0KGk5MTUsIFBPV0VSX0RPTUFJTl9BVURJTyk7CiAKIAkvKiBGb3JjZSBDRENMSyB0
byAyKkJDTEsgYXMgbG9uZyBhcyB3ZSBuZWVkIGF1ZGlvIHRvIGJlIHBvd2VyZWQuICovCi0JaWYg
KGRldl9wcml2LT5hdWRpb19wb3dlcl9yZWZjb3VudCsrID09IDApCi0JCWlmIChJU19DQU5OT05M
QUtFKGRldl9wcml2KSB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKLQkJCWdsa19mb3JjZV9h
dWRpb19jZGNsayhkZXZfcHJpdiwgdHJ1ZSk7CisJaWYgKGk5MTUtPmF1ZGlvX3Bvd2VyX3JlZmNv
dW50KysgPT0gMCkKKwkJaWYgKElTX0NBTk5PTkxBS0UoaTkxNSkgfHwgSVNfR0VNSU5JTEFLRShp
OTE1KSkKKwkJCWdsa19mb3JjZV9hdWRpb19jZGNsayhpOTE1LCB0cnVlKTsKIAogCXJldHVybiBy
ZXQ7CiB9CkBAIC04MDYsMjQgKzgwNiwyNCBAQCBzdGF0aWMgdW5zaWduZWQgbG9uZyBpOTE1X2F1
ZGlvX2NvbXBvbmVudF9nZXRfcG93ZXIoc3RydWN0IGRldmljZSAqa2RldikKIHN0YXRpYyB2b2lk
IGk5MTVfYXVkaW9fY29tcG9uZW50X3B1dF9wb3dlcihzdHJ1Y3QgZGV2aWNlICprZGV2LAogCQkJ
CQkgICB1bnNpZ25lZCBsb25nIGNvb2tpZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBrZGV2X3RvX2k5MTUoa2Rldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSBrZGV2X3RvX2k5MTUoa2Rldik7CiAKIAkvKiBTdG9wIGZvcmNpbmcgQ0RDTEsgdG8g
MipCQ0xLIGlmIG5vIG5lZWQgZm9yIGF1ZGlvIHRvIGJlIHBvd2VyZWQuICovCi0JaWYgKC0tZGV2
X3ByaXYtPmF1ZGlvX3Bvd2VyX3JlZmNvdW50ID09IDApCi0JCWlmIChJU19DQU5OT05MQUtFKGRl
dl9wcml2KSB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKLQkJCWdsa19mb3JjZV9hdWRpb19j
ZGNsayhkZXZfcHJpdiwgZmFsc2UpOworCWlmICgtLWk5MTUtPmF1ZGlvX3Bvd2VyX3JlZmNvdW50
ID09IDApCisJCWlmIChJU19DQU5OT05MQUtFKGk5MTUpIHx8IElTX0dFTUlOSUxBS0UoaTkxNSkp
CisJCQlnbGtfZm9yY2VfYXVkaW9fY2RjbGsoaTkxNSwgZmFsc2UpOwogCi0JaW50ZWxfZGlzcGxh
eV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9BVURJTywgY29va2llKTsKKwlpbnRl
bF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01BSU5fQVVESU8sIGNvb2tpZSk7CiB9
CiAKIHN0YXRpYyB2b2lkIGk5MTVfYXVkaW9fY29tcG9uZW50X2NvZGVjX3dha2Vfb3ZlcnJpZGUo
c3RydWN0IGRldmljZSAqa2RldiwKIAkJCQkJCSAgICAgYm9vbCBlbmFibGUpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl90b19pOTE1KGtkZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl90b19pOTE1KGtkZXYpOwogCXVuc2lnbmVk
IGxvbmcgY29va2llOwogCXUzMiB0bXA7CiAKLQlpZiAoIUlTX0dFTihkZXZfcHJpdiwgOSkpCisJ
aWYgKCFJU19HRU4oaTkxNSwgOSkpCiAJCXJldHVybjsKIAogCWNvb2tpZSA9IGk5MTVfYXVkaW9f
Y29tcG9uZW50X2dldF9wb3dlcihrZGV2KTsKQEAgLTg1MCwxMiArODUwLDEyIEBAIHN0YXRpYyB2
b2lkIGk5MTVfYXVkaW9fY29tcG9uZW50X2NvZGVjX3dha2Vfb3ZlcnJpZGUoc3RydWN0IGRldmlj
ZSAqa2RldiwKIC8qIEdldCBDRENMSyBpbiBrSHogICovCiBzdGF0aWMgaW50IGk5MTVfYXVkaW9f
Y29tcG9uZW50X2dldF9jZGNsa19mcmVxKHN0cnVjdCBkZXZpY2UgKmtkZXYpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl90b19pOTE1KGtkZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl90b19pOTE1KGtkZXYpOwogCi0JaWYgKFdB
Uk5fT05fT05DRSghSEFTX0RESShkZXZfcHJpdikpKQorCWlmIChXQVJOX09OX09OQ0UoIUhBU19E
REkoaTkxNSkpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXJldHVybiBkZXZfcHJpdi0+Y2RjbGsu
aHcuY2RjbGs7CisJcmV0dXJuIGk5MTUtPmNkY2xrLmh3LmNkY2xrOwogfQogCiAvKgpAQCAtODY4
LDE3ICs4NjgsMTcgQEAgc3RhdGljIGludCBpOTE1X2F1ZGlvX2NvbXBvbmVudF9nZXRfY2RjbGtf
ZnJlcShzdHJ1Y3QgZGV2aWNlICprZGV2KQogICogICB3aWxsIGdldCB0aGUgcmlnaHQgaW50ZWxf
ZW5jb2RlciB3aXRoIHBvcnQgbWF0Y2hlZAogICogTm9uLU1TVCAmIChwaXBlIDwgMCk6IGdldCB0
aGUgcmlnaHQgaW50ZWxfZW5jb2RlciB3aXRoIHBvcnQgbWF0Y2hlZAogICovCi1zdGF0aWMgc3Ry
dWN0IGludGVsX2VuY29kZXIgKmdldF9zYXZlZF9lbmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIHN0cnVjdCBpbnRlbF9lbmNvZGVyICpnZXRfc2F2ZWRfZW5jKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgICAgICAgaW50IHBvcnQsIGludCBw
aXBlKQogewogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCiAJLyogTVNUICovCiAJ
aWYgKHBpcGUgPj0gMCkgewotCQlpZiAoV0FSTl9PTihwaXBlID49IEFSUkFZX1NJWkUoZGV2X3By
aXYtPmF2X2VuY19tYXApKSkKKwkJaWYgKFdBUk5fT04ocGlwZSA+PSBBUlJBWV9TSVpFKGk5MTUt
PmF2X2VuY19tYXApKSkKIAkJCXJldHVybiBOVUxMOwogCi0JCWVuY29kZXIgPSBkZXZfcHJpdi0+
YXZfZW5jX21hcFtwaXBlXTsKKwkJZW5jb2RlciA9IGk5MTUtPmF2X2VuY19tYXBbcGlwZV07CiAJ
CS8qCiAJCSAqIHdoZW4gYm9vdHVwLCBhdWRpbyBkcml2ZXIgbWF5IG5vdCBrbm93IGl0IGlzCiAJ
CSAqIE1TVCBvciBub3QuIFNvIGl0IHdpbGwgcG9sbCBhbGwgdGhlIHBvcnQgJiBwaXBlCkBAIC04
OTMsOCArODkzLDggQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9lbmNvZGVyICpnZXRfc2F2ZWRfZW5j
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAocGlwZSA+IDApCiAJCXJl
dHVybiBOVUxMOwogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgewotCQllbmNvZGVy
ID0gZGV2X3ByaXYtPmF2X2VuY19tYXBbcGlwZV07CisJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBl
KSB7CisJCWVuY29kZXIgPSBpOTE1LT5hdl9lbmNfbWFwW3BpcGVdOwogCQlpZiAoZW5jb2RlciA9
PSBOVUxMKQogCQkJY29udGludWU7CiAKQEAgLTkxMSwyMSArOTExLDIxIEBAIHN0YXRpYyBzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZ2V0X3NhdmVkX2VuYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiBzdGF0aWMgaW50IGk5MTVfYXVkaW9fY29tcG9uZW50X3N5bmNfYXVkaW9fcmF0
ZShzdHJ1Y3QgZGV2aWNlICprZGV2LCBpbnQgcG9ydCwKIAkJCQkJCWludCBwaXBlLCBpbnQgcmF0
ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBrZGV2X3RvX2k5MTUo
a2Rldik7Ci0Jc3RydWN0IGk5MTVfYXVkaW9fY29tcG9uZW50ICphY29tcCA9IGRldl9wcml2LT5h
dWRpb19jb21wb25lbnQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBrZGV2X3Rv
X2k5MTUoa2Rldik7CisJc3RydWN0IGk5MTVfYXVkaW9fY29tcG9uZW50ICphY29tcCA9IGk5MTUt
PmF1ZGlvX2NvbXBvbmVudDsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAl1bnNpZ25lZCBsb25nIGNvb2tpZTsKIAlpbnQgZXJyID0g
MDsKIAotCWlmICghSEFTX0RESShkZXZfcHJpdikpCisJaWYgKCFIQVNfRERJKGk5MTUpKQogCQly
ZXR1cm4gMDsKIAogCWNvb2tpZSA9IGk5MTVfYXVkaW9fY29tcG9uZW50X2dldF9wb3dlcihrZGV2
KTsKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YXZfbXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUt
PmF2X211dGV4KTsKIAogCS8qIDEuIGdldCB0aGUgcGlwZSAqLwotCWVuY29kZXIgPSBnZXRfc2F2
ZWRfZW5jKGRldl9wcml2LCBwb3J0LCBwaXBlKTsKKwllbmNvZGVyID0gZ2V0X3NhdmVkX2VuYyhp
OTE1LCBwb3J0LCBwaXBlKTsKIAlpZiAoIWVuY29kZXIgfHwgIWVuY29kZXItPmJhc2UuY3J0Yykg
ewogCQlEUk1fREVCVUdfS01TKCJOb3QgdmFsaWQgZm9yIHBvcnQgJWNcbiIsIHBvcnRfbmFtZShw
b3J0KSk7CiAJCWVyciA9IC1FTk9ERVY7CkBAIC05NDAsNyArOTQwLDcgQEAgc3RhdGljIGludCBp
OTE1X2F1ZGlvX2NvbXBvbmVudF9zeW5jX2F1ZGlvX3JhdGUoc3RydWN0IGRldmljZSAqa2Rldiwg
aW50IHBvcnQsCiAJaHN3X2F1ZGlvX2NvbmZpZ191cGRhdGUoZW5jb2RlciwgY3J0Yy0+Y29uZmln
KTsKIAogIHVubG9jazoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5hdl9tdXRleCk7CisJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5hdl9tdXRleCk7CiAJaTkxNV9hdWRpb19jb21wb25lbnRfcHV0X3Bv
d2VyKGtkZXYsIGNvb2tpZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTk0OSwxNyArOTQ5LDE3IEBA
IHN0YXRpYyBpbnQgaTkxNV9hdWRpb19jb21wb25lbnRfZ2V0X2VsZChzdHJ1Y3QgZGV2aWNlICpr
ZGV2LCBpbnQgcG9ydCwKIAkJCQkJaW50IHBpcGUsIGJvb2wgKmVuYWJsZWQsCiAJCQkJCXVuc2ln
bmVkIGNoYXIgKmJ1ZiwgaW50IG1heF9ieXRlcykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBrZGV2X3RvX2k5MTUoa2Rldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBrZGV2X3RvX2k5MTUoa2Rldik7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmlu
dGVsX2VuY29kZXI7CiAJY29uc3QgdTggKmVsZDsKIAlpbnQgcmV0ID0gLUVJTlZBTDsKIAotCW11
dGV4X2xvY2soJmRldl9wcml2LT5hdl9tdXRleCk7CisJbXV0ZXhfbG9jaygmaTkxNS0+YXZfbXV0
ZXgpOwogCi0JaW50ZWxfZW5jb2RlciA9IGdldF9zYXZlZF9lbmMoZGV2X3ByaXYsIHBvcnQsIHBp
cGUpOworCWludGVsX2VuY29kZXIgPSBnZXRfc2F2ZWRfZW5jKGk5MTUsIHBvcnQsIHBpcGUpOwog
CWlmICghaW50ZWxfZW5jb2RlcikgewogCQlEUk1fREVCVUdfS01TKCJOb3QgdmFsaWQgZm9yIHBv
cnQgJWNcbiIsIHBvcnRfbmFtZShwb3J0KSk7Ci0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmF2
X211dGV4KTsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5hdl9tdXRleCk7CiAJCXJldHVybiByZXQ7
CiAJfQogCkBAIC05NzEsNyArOTcxLDcgQEAgc3RhdGljIGludCBpOTE1X2F1ZGlvX2NvbXBvbmVu
dF9nZXRfZWxkKHN0cnVjdCBkZXZpY2UgKmtkZXYsIGludCBwb3J0LAogCQltZW1jcHkoYnVmLCBl
bGQsIG1pbihtYXhfYnl0ZXMsIHJldCkpOwogCX0KIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYt
PmF2X211dGV4KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmF2X211dGV4KTsKIAlyZXR1cm4gcmV0
OwogfQogCkBAIC05ODksNyArOTg5LDcgQEAgc3RhdGljIGludCBpOTE1X2F1ZGlvX2NvbXBvbmVu
dF9iaW5kKHN0cnVjdCBkZXZpY2UgKmk5MTVfa2RldiwKIAkJCQkgICAgIHN0cnVjdCBkZXZpY2Ug
KmhkYV9rZGV2LCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBpOTE1X2F1ZGlvX2NvbXBvbmVudCAq
YWNvbXAgPSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZf
dG9faTkxNShpOTE1X2tkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rl
dl90b19pOTE1KGk5MTVfa2Rldik7CiAJaW50IGk7CiAKIAlpZiAoV0FSTl9PTihhY29tcC0+YmFz
ZS5vcHMgfHwgYWNvbXAtPmJhc2UuZGV2KSkKQEAgLTk5OCwxNCArOTk4LDE0IEBAIHN0YXRpYyBp
bnQgaTkxNV9hdWRpb19jb21wb25lbnRfYmluZChzdHJ1Y3QgZGV2aWNlICppOTE1X2tkZXYsCiAJ
aWYgKFdBUk5fT04oIWRldmljZV9saW5rX2FkZChoZGFfa2RldiwgaTkxNV9rZGV2LCBETF9GTEFH
X1NUQVRFTEVTUykpKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWRybV9tb2Rlc2V0X2xvY2tfYWxs
KCZkZXZfcHJpdi0+ZHJtKTsKKwlkcm1fbW9kZXNldF9sb2NrX2FsbCgmaTkxNS0+ZHJtKTsKIAlh
Y29tcC0+YmFzZS5vcHMgPSAmaTkxNV9hdWRpb19jb21wb25lbnRfb3BzOwogCWFjb21wLT5iYXNl
LmRldiA9IGk5MTVfa2RldjsKIAlCVUlMRF9CVUdfT04oTUFYX1BPUlRTICE9IEk5MTVfTUFYX1BP
UlRTKTsKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShhY29tcC0+YXVkX3NhbXBsZV9yYXRl
KTsgaSsrKQogCQlhY29tcC0+YXVkX3NhbXBsZV9yYXRlW2ldID0gMDsKLQlkZXZfcHJpdi0+YXVk
aW9fY29tcG9uZW50ID0gYWNvbXA7Ci0JZHJtX21vZGVzZXRfdW5sb2NrX2FsbCgmZGV2X3ByaXYt
PmRybSk7CisJaTkxNS0+YXVkaW9fY29tcG9uZW50ID0gYWNvbXA7CisJZHJtX21vZGVzZXRfdW5s
b2NrX2FsbCgmaTkxNS0+ZHJtKTsKIAogCXJldHVybiAwOwogfQpAQCAtMTAxNCwxMyArMTAxNCwx
MyBAQCBzdGF0aWMgdm9pZCBpOTE1X2F1ZGlvX2NvbXBvbmVudF91bmJpbmQoc3RydWN0IGRldmlj
ZSAqaTkxNV9rZGV2LAogCQkJCQlzdHJ1Y3QgZGV2aWNlICpoZGFfa2Rldiwgdm9pZCAqZGF0YSkK
IHsKIAlzdHJ1Y3QgaTkxNV9hdWRpb19jb21wb25lbnQgKmFjb21wID0gZGF0YTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBrZGV2X3RvX2k5MTUoaTkxNV9rZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfdG9faTkxNShpOTE1X2tkZXYpOwog
Ci0JZHJtX21vZGVzZXRfbG9ja19hbGwoJmRldl9wcml2LT5kcm0pOworCWRybV9tb2Rlc2V0X2xv
Y2tfYWxsKCZpOTE1LT5kcm0pOwogCWFjb21wLT5iYXNlLm9wcyA9IE5VTEw7CiAJYWNvbXAtPmJh
c2UuZGV2ID0gTlVMTDsKLQlkZXZfcHJpdi0+YXVkaW9fY29tcG9uZW50ID0gTlVMTDsKLQlkcm1f
bW9kZXNldF91bmxvY2tfYWxsKCZkZXZfcHJpdi0+ZHJtKTsKKwlpOTE1LT5hdWRpb19jb21wb25l
bnQgPSBOVUxMOworCWRybV9tb2Rlc2V0X3VubG9ja19hbGwoJmk5MTUtPmRybSk7CiAKIAlkZXZp
Y2VfbGlua19yZW1vdmUoaGRhX2tkZXYsIGk5MTVfa2Rldik7CiB9CkBAIC0xMDMyLDcgKzEwMzIs
NyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGNvbXBvbmVudF9vcHMgaTkxNV9hdWRpb19jb21wb25l
bnRfYmluZF9vcHMgPSB7CiAKIC8qKgogICogaTkxNV9hdWRpb19jb21wb25lbnRfaW5pdCAtIGlu
aXRpYWxpemUgYW5kIHJlZ2lzdGVyIHRoZSBhdWRpbyBjb21wb25lbnQKLSAqIEBkZXZfcHJpdjog
aTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoK
ICAqIFRoaXMgd2lsbCByZWdpc3RlciB3aXRoIHRoZSBjb21wb25lbnQgZnJhbWV3b3JrIGEgY2hp
bGQgY29tcG9uZW50IHdoaWNoCiAgKiB3aWxsIGJpbmQgZHluYW1pY2FsbHkgdG8gdGhlIHNuZF9o
ZGFfaW50ZWwgZHJpdmVyJ3MgY29ycmVzcG9uZGluZyBtYXN0ZXIKQEAgLTEwNDYsMTEgKzEwNDYs
MTEgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBjb21wb25lbnRfb3BzIGk5MTVfYXVkaW9fY29tcG9u
ZW50X2JpbmRfb3BzID0gewogICogV2UgaWdub3JlIGFueSBlcnJvciBkdXJpbmcgcmVnaXN0cmF0
aW9uIGFuZCBjb250aW51ZSB3aXRoIHJlZHVjZWQKICAqIGZ1bmN0aW9uYWxpdHkgKGkuZS4gd2l0
aG91dCBIRE1JIGF1ZGlvKS4KICAqLwotc3RhdGljIHZvaWQgaTkxNV9hdWRpb19jb21wb25lbnRf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpOTE1
X2F1ZGlvX2NvbXBvbmVudF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewog
CWludCByZXQ7CiAKLQlyZXQgPSBjb21wb25lbnRfYWRkX3R5cGVkKGRldl9wcml2LT5kcm0uZGV2
LAorCXJldCA9IGNvbXBvbmVudF9hZGRfdHlwZWQoaTkxNS0+ZHJtLmRldiwKIAkJCQkgICZpOTE1
X2F1ZGlvX2NvbXBvbmVudF9iaW5kX29wcywKIAkJCQkgIEk5MTVfQ09NUE9ORU5UX0FVRElPKTsK
IAlpZiAocmV0IDwgMCkgewpAQCAtMTA1OSw0NiArMTA1OSw0NiBAQCBzdGF0aWMgdm9pZCBpOTE1
X2F1ZGlvX2NvbXBvbmVudF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJcmV0dXJuOwogCX0KIAotCWRldl9wcml2LT5hdWRpb19jb21wb25lbnRfcmVnaXN0ZXJlZCA9
IHRydWU7CisJaTkxNS0+YXVkaW9fY29tcG9uZW50X3JlZ2lzdGVyZWQgPSB0cnVlOwogfQogCiAv
KioKICAqIGk5MTVfYXVkaW9fY29tcG9uZW50X2NsZWFudXAgLSBkZXJlZ2lzdGVyIHRoZSBhdWRp
byBjb21wb25lbnQKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1
OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAqIERlcmVnaXN0ZXJzIHRoZSBhdWRpbyBjb21w
b25lbnQsIGJyZWFraW5nIGFueSBleGlzdGluZyBiaW5kaW5nIHRvIHRoZQogICogY29ycmVzcG9u
ZGluZyBzbmRfaGRhX2ludGVsIGRyaXZlcidzIG1hc3RlciBjb21wb25lbnQuCiAgKi8KLXN0YXRp
YyB2b2lkIGk5MTVfYXVkaW9fY29tcG9uZW50X2NsZWFudXAoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaTkxNV9hdWRpb19jb21wb25lbnRfY2xlYW51cChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpZiAoIWRldl9wcml2LT5hdWRpb19j
b21wb25lbnRfcmVnaXN0ZXJlZCkKKwlpZiAoIWk5MTUtPmF1ZGlvX2NvbXBvbmVudF9yZWdpc3Rl
cmVkKQogCQlyZXR1cm47CiAKLQljb21wb25lbnRfZGVsKGRldl9wcml2LT5kcm0uZGV2LCAmaTkx
NV9hdWRpb19jb21wb25lbnRfYmluZF9vcHMpOwotCWRldl9wcml2LT5hdWRpb19jb21wb25lbnRf
cmVnaXN0ZXJlZCA9IGZhbHNlOworCWNvbXBvbmVudF9kZWwoaTkxNS0+ZHJtLmRldiwgJmk5MTVf
YXVkaW9fY29tcG9uZW50X2JpbmRfb3BzKTsKKwlpOTE1LT5hdWRpb19jb21wb25lbnRfcmVnaXN0
ZXJlZCA9IGZhbHNlOwogfQogCiAvKioKICAqIGludGVsX2F1ZGlvX2luaXQoKSAtIEluaXRpYWxp
emUgdGhlIGF1ZGlvIGRyaXZlciBlaXRoZXIgdXNpbmcKICAqIGNvbXBvbmVudCBmcmFtZXdvcmsg
b3IgdXNpbmcgbHBlIGF1ZGlvIGJyaWRnZQotICogQGRldl9wcml2OiB0aGUgaTkxNSBkcm0gZGV2
aWNlIHByaXZhdGUgZGF0YQorICogQGk5MTU6IHRoZSBpOTE1IGRybSBkZXZpY2UgcHJpdmF0ZSBk
YXRhCiAgKgogICovCi12b2lkIGludGVsX2F1ZGlvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9hdWRpb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewotCWlmIChpbnRlbF9scGVfYXVkaW9faW5pdChkZXZfcHJpdikgPCAwKQot
CQlpOTE1X2F1ZGlvX2NvbXBvbmVudF9pbml0KGRldl9wcml2KTsKKwlpZiAoaW50ZWxfbHBlX2F1
ZGlvX2luaXQoaTkxNSkgPCAwKQorCQlpOTE1X2F1ZGlvX2NvbXBvbmVudF9pbml0KGk5MTUpOwog
fQogCiAvKioKICAqIGludGVsX2F1ZGlvX2RlaW5pdCgpIC0gZGVpbml0aWFsaXplIHRoZSBhdWRp
byBkcml2ZXIKLSAqIEBkZXZfcHJpdjogdGhlIGk5MTUgZHJtIGRldmljZSBwcml2YXRlIGRhdGEK
KyAqIEBpOTE1OiB0aGUgaTkxNSBkcm0gZGV2aWNlIHByaXZhdGUgZGF0YQogICoKICAqLwotdm9p
ZCBpbnRlbF9hdWRpb19kZWluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
dm9pZCBpbnRlbF9hdWRpb19kZWluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
Ci0JaWYgKChkZXZfcHJpdiktPmxwZV9hdWRpby5wbGF0ZGV2ICE9IE5VTEwpCi0JCWludGVsX2xw
ZV9hdWRpb190ZWFyZG93bihkZXZfcHJpdik7CisJaWYgKChpOTE1KS0+bHBlX2F1ZGlvLnBsYXRk
ZXYgIT0gTlVMTCkKKwkJaW50ZWxfbHBlX2F1ZGlvX3RlYXJkb3duKGk5MTUpOwogCWVsc2UKLQkJ
aTkxNV9hdWRpb19jb21wb25lbnRfY2xlYW51cChkZXZfcHJpdik7CisJCWk5MTVfYXVkaW9fY29t
cG9uZW50X2NsZWFudXAoaTkxNSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9hdWRpby5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfYXVkaW8uaAppbmRl
eCBhMzY1N2M3YTdiYTIuLmM4ZmRlNDJhOWZkZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfYXVkaW8uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9hdWRp
by5oCkBAIC0xMSwxNCArMTEsMTQgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CiBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZTsKIHN0cnVjdCBpbnRlbF9lbmNvZGVyOwogCi12b2lkIGludGVsX2lu
aXRfYXVkaW9faG9va3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQg
aW50ZWxfaW5pdF9hdWRpb19ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2
b2lkIGludGVsX2F1ZGlvX2NvZGVjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpOwog
dm9pZCBpbnRlbF9hdWRpb19jb2RlY19kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19z
dGF0ZSwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nv
bm5fc3RhdGUpOwotdm9pZCBpbnRlbF9hdWRpb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7Ci12b2lkIGludGVsX2F1ZGlvX2RlaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9hdWRpb19pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfYXVkaW9fZGVpbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKIAogI2VuZGlmIC8qIF9fSU5URUxfQVVESU9fSF9fICovCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9iaW9zLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9iaW9zLmMKaW5kZXggMWMwMzdkZmE4M2Y1Li43YmRhYzU1ZDA4Y2MgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Jpb3MuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9iaW9zLmMKQEAgLTIwMiw3ICsyMDIsNyBAQCBnZXRfbHZkc19mcF90
aW1pbmcoY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYiwKIAogLyogVHJ5IHRvIGZpbmQgaW50
ZWdyYXRlZCBwYW5lbCBkYXRhICovCiBzdGF0aWMgdm9pZAotcGFyc2VfbGZwX3BhbmVsX2RhdGEo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2VfbGZwX3BhbmVsX2RhdGEo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAgY29uc3Qgc3RydWN0IGJkYl9o
ZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1Y3QgYmRiX2x2ZHNfb3B0aW9ucyAqbHZkc19vcHRp
b25zOwpAQCAtMjE5LDkgKzIxOSw5IEBAIHBhcnNlX2xmcF9wYW5lbF9kYXRhKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAoIWx2ZHNfb3B0aW9ucykKIAkJcmV0dXJuOwog
Ci0JZGV2X3ByaXYtPnZidC5sdmRzX2RpdGhlciA9IGx2ZHNfb3B0aW9ucy0+cGl4ZWxfZGl0aGVy
OworCWk5MTUtPnZidC5sdmRzX2RpdGhlciA9IGx2ZHNfb3B0aW9ucy0+cGl4ZWxfZGl0aGVyOwog
Ci0JcmV0ID0gaW50ZWxfb3ByZWdpb25fZ2V0X3BhbmVsX3R5cGUoZGV2X3ByaXYpOworCXJldCA9
IGludGVsX29wcmVnaW9uX2dldF9wYW5lbF90eXBlKGk5MTUpOwogCWlmIChyZXQgPj0gMCkgewog
CQlXQVJOX09OKHJldCA+IDB4Zik7CiAJCXBhbmVsX3R5cGUgPSByZXQ7CkBAIC0yMzYsNyArMjM2
LDcgQEAgcGFyc2VfbGZwX3BhbmVsX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQlEUk1fREVCVUdfS01TKCJQYW5lbCB0eXBlOiAlZCAoVkJUKVxuIiwgcGFuZWxfdHlw
ZSk7CiAJfQogCi0JZGV2X3ByaXYtPnZidC5wYW5lbF90eXBlID0gcGFuZWxfdHlwZTsKKwlpOTE1
LT52YnQucGFuZWxfdHlwZSA9IHBhbmVsX3R5cGU7CiAKIAlkcnJzX21vZGUgPSAobHZkc19vcHRp
b25zLT5kcHNfcGFuZWxfdHlwZV9iaXRzCiAJCQkJPj4gKHBhbmVsX3R5cGUgKiAyKSkgJiBNT0RF
X01BU0s7CkBAIC0yNDcsMTUgKzI0NywxNSBAQCBwYXJzZV9sZnBfcGFuZWxfZGF0YShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICovCiAJc3dpdGNoIChkcnJzX21vZGUpIHsK
IAljYXNlIDA6Ci0JCWRldl9wcml2LT52YnQuZHJyc190eXBlID0gU1RBVElDX0RSUlNfU1VQUE9S
VDsKKwkJaTkxNS0+dmJ0LmRycnNfdHlwZSA9IFNUQVRJQ19EUlJTX1NVUFBPUlQ7CiAJCURSTV9E
RUJVR19LTVMoIkRSUlMgc3VwcG9ydGVkIG1vZGUgaXMgc3RhdGljXG4iKTsKIAkJYnJlYWs7CiAJ
Y2FzZSAyOgotCQlkZXZfcHJpdi0+dmJ0LmRycnNfdHlwZSA9IFNFQU1MRVNTX0RSUlNfU1VQUE9S
VDsKKwkJaTkxNS0+dmJ0LmRycnNfdHlwZSA9IFNFQU1MRVNTX0RSUlNfU1VQUE9SVDsKIAkJRFJN
X0RFQlVHX0tNUygiRFJSUyBzdXBwb3J0ZWQgbW9kZSBpcyBzZWFtbGVzc1xuIik7CiAJCWJyZWFr
OwogCWRlZmF1bHQ6Ci0JCWRldl9wcml2LT52YnQuZHJyc190eXBlID0gRFJSU19OT1RfU1VQUE9S
VEVEOworCQlpOTE1LT52YnQuZHJyc190eXBlID0gRFJSU19OT1RfU1VQUE9SVEVEOwogCQlEUk1f
REVCVUdfS01TKCJEUlJTIG5vdCBzdXBwb3J0ZWQgKFZCVCBpbnB1dClcbiIpOwogCQlicmVhazsK
IAl9CkBAIC0yNzgsNyArMjc4LDcgQEAgcGFyc2VfbGZwX3BhbmVsX2RhdGEoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJZmlsbF9kZXRhaWxfdGltaW5nX2RhdGEocGFuZWxf
Zml4ZWRfbW9kZSwgcGFuZWxfZHZvX3RpbWluZyk7CiAKLQlkZXZfcHJpdi0+dmJ0LmxmcF9sdmRz
X3ZidF9tb2RlID0gcGFuZWxfZml4ZWRfbW9kZTsKKwlpOTE1LT52YnQubGZwX2x2ZHNfdmJ0X21v
ZGUgPSBwYW5lbF9maXhlZF9tb2RlOwogCiAJRFJNX0RFQlVHX0tNUygiRm91bmQgcGFuZWwgbW9k
ZSBpbiBCSU9TIFZCVCB0YWJsZXM6XG4iKTsKIAlkcm1fbW9kZV9kZWJ1Z19wcmludG1vZGVsaW5l
KHBhbmVsX2ZpeGVkX21vZGUpOwpAQCAtMjkwLDIwICsyOTAsMjAgQEAgcGFyc2VfbGZwX3BhbmVs
X2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkvKiBjaGVjayB0aGUg
cmVzb2x1dGlvbiwganVzdCB0byBiZSBzdXJlICovCiAJCWlmIChmcF90aW1pbmctPnhfcmVzID09
IHBhbmVsX2ZpeGVkX21vZGUtPmhkaXNwbGF5ICYmCiAJCSAgICBmcF90aW1pbmctPnlfcmVzID09
IHBhbmVsX2ZpeGVkX21vZGUtPnZkaXNwbGF5KSB7Ci0JCQlkZXZfcHJpdi0+dmJ0LmJpb3NfbHZk
c192YWwgPSBmcF90aW1pbmctPmx2ZHNfcmVnX3ZhbDsKKwkJCWk5MTUtPnZidC5iaW9zX2x2ZHNf
dmFsID0gZnBfdGltaW5nLT5sdmRzX3JlZ192YWw7CiAJCQlEUk1fREVCVUdfS01TKCJWQlQgaW5p
dGlhbCBMVkRTIHZhbHVlICV4XG4iLAotCQkJCSAgICAgIGRldl9wcml2LT52YnQuYmlvc19sdmRz
X3ZhbCk7CisJCQkJICAgICAgaTkxNS0+dmJ0LmJpb3NfbHZkc192YWwpOwogCQl9CiAJfQogfQog
CiBzdGF0aWMgdm9pZAotcGFyc2VfbGZwX2JhY2tsaWdodChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitwYXJzZV9sZnBfYmFja2xpZ2h0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkgICAgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25zdCBz
dHJ1Y3QgYmRiX2xmcF9iYWNrbGlnaHRfZGF0YSAqYmFja2xpZ2h0X2RhdGE7CiAJY29uc3Qgc3Ry
dWN0IGxmcF9iYWNrbGlnaHRfZGF0YV9lbnRyeSAqZW50cnk7Ci0JaW50IHBhbmVsX3R5cGUgPSBk
ZXZfcHJpdi0+dmJ0LnBhbmVsX3R5cGU7CisJaW50IHBhbmVsX3R5cGUgPSBpOTE1LT52YnQucGFu
ZWxfdHlwZTsKIAogCWJhY2tsaWdodF9kYXRhID0gZmluZF9zZWN0aW9uKGJkYiwgQkRCX0xWRFNf
QkFDS0xJR0hUKTsKIAlpZiAoIWJhY2tsaWdodF9kYXRhKQpAQCAtMzE3LDM4ICszMTcsMzggQEAg
cGFyc2VfbGZwX2JhY2tsaWdodChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAK
IAllbnRyeSA9ICZiYWNrbGlnaHRfZGF0YS0+ZGF0YVtwYW5lbF90eXBlXTsKIAotCWRldl9wcml2
LT52YnQuYmFja2xpZ2h0LnByZXNlbnQgPSBlbnRyeS0+dHlwZSA9PSBCREJfQkFDS0xJR0hUX1RZ
UEVfUFdNOwotCWlmICghZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQucHJlc2VudCkgeworCWk5MTUt
PnZidC5iYWNrbGlnaHQucHJlc2VudCA9IGVudHJ5LT50eXBlID09IEJEQl9CQUNLTElHSFRfVFlQ
RV9QV007CisJaWYgKCFpOTE1LT52YnQuYmFja2xpZ2h0LnByZXNlbnQpIHsKIAkJRFJNX0RFQlVH
X0tNUygiUFdNIGJhY2tsaWdodCBub3QgcHJlc2VudCBpbiBWQlQgKHR5cGUgJXUpXG4iLAogCQkJ
ICAgICAgZW50cnktPnR5cGUpOwogCQlyZXR1cm47CiAJfQogCi0JZGV2X3ByaXYtPnZidC5iYWNr
bGlnaHQudHlwZSA9IElOVEVMX0JBQ0tMSUdIVF9ESVNQTEFZX0RESTsKKwlpOTE1LT52YnQuYmFj
a2xpZ2h0LnR5cGUgPSBJTlRFTF9CQUNLTElHSFRfRElTUExBWV9EREk7CiAJaWYgKGJkYi0+dmVy
c2lvbiA+PSAxOTEgJiYKIAkgICAgZ2V0X2Jsb2Nrc2l6ZShiYWNrbGlnaHRfZGF0YSkgPj0gc2l6
ZW9mKCpiYWNrbGlnaHRfZGF0YSkpIHsKIAkJY29uc3Qgc3RydWN0IGxmcF9iYWNrbGlnaHRfY29u
dHJvbF9tZXRob2QgKm1ldGhvZDsKIAogCQltZXRob2QgPSAmYmFja2xpZ2h0X2RhdGEtPmJhY2ts
aWdodF9jb250cm9sW3BhbmVsX3R5cGVdOwotCQlkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC50eXBl
ID0gbWV0aG9kLT50eXBlOwotCQlkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5jb250cm9sbGVyID0g
bWV0aG9kLT5jb250cm9sbGVyOworCQlpOTE1LT52YnQuYmFja2xpZ2h0LnR5cGUgPSBtZXRob2Qt
PnR5cGU7CisJCWk5MTUtPnZidC5iYWNrbGlnaHQuY29udHJvbGxlciA9IG1ldGhvZC0+Y29udHJv
bGxlcjsKIAl9CiAKLQlkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wd21fZnJlcV9oeiA9IGVudHJ5
LT5wd21fZnJlcV9oejsKLQlkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5hY3RpdmVfbG93X3B3bSA9
IGVudHJ5LT5hY3RpdmVfbG93X3B3bTsKLQlkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5taW5fYnJp
Z2h0bmVzcyA9IGVudHJ5LT5taW5fYnJpZ2h0bmVzczsKKwlpOTE1LT52YnQuYmFja2xpZ2h0LnB3
bV9mcmVxX2h6ID0gZW50cnktPnB3bV9mcmVxX2h6OworCWk5MTUtPnZidC5iYWNrbGlnaHQuYWN0
aXZlX2xvd19wd20gPSBlbnRyeS0+YWN0aXZlX2xvd19wd207CisJaTkxNS0+dmJ0LmJhY2tsaWdo
dC5taW5fYnJpZ2h0bmVzcyA9IGVudHJ5LT5taW5fYnJpZ2h0bmVzczsKIAlEUk1fREVCVUdfS01T
KCJWQlQgYmFja2xpZ2h0IFBXTSBtb2R1bGF0aW9uIGZyZXF1ZW5jeSAldSBIeiwgIgogCQkgICAg
ICAiYWN0aXZlICVzLCBtaW4gYnJpZ2h0bmVzcyAldSwgbGV2ZWwgJXUsIGNvbnRyb2xsZXIgJXVc
biIsCi0JCSAgICAgIGRldl9wcml2LT52YnQuYmFja2xpZ2h0LnB3bV9mcmVxX2h6LAotCQkgICAg
ICBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5hY3RpdmVfbG93X3B3bSA/ICJsb3ciIDogImhpZ2gi
LAotCQkgICAgICBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0bmVzcywKKwkJICAg
ICAgaTkxNS0+dmJ0LmJhY2tsaWdodC5wd21fZnJlcV9oeiwKKwkJICAgICAgaTkxNS0+dmJ0LmJh
Y2tsaWdodC5hY3RpdmVfbG93X3B3bSA/ICJsb3ciIDogImhpZ2giLAorCQkgICAgICBpOTE1LT52
YnQuYmFja2xpZ2h0Lm1pbl9icmlnaHRuZXNzLAogCQkgICAgICBiYWNrbGlnaHRfZGF0YS0+bGV2
ZWxbcGFuZWxfdHlwZV0sCi0JCSAgICAgIGRldl9wcml2LT52YnQuYmFja2xpZ2h0LmNvbnRyb2xs
ZXIpOworCQkgICAgICBpOTE1LT52YnQuYmFja2xpZ2h0LmNvbnRyb2xsZXIpOwogfQogCiAvKiBU
cnkgdG8gZmluZCBzZHZvIHBhbmVsIGRhdGEgKi8KIHN0YXRpYyB2b2lkCi1wYXJzZV9zZHZvX3Bh
bmVsX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2Vfc2R2b19w
YW5lbF9kYXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgICBjb25zdCBz
dHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfc2R2b19wYW5lbF9k
dGRzICpkdGRzOwpAQCAtMzgxLDE2ICszODEsMTYgQEAgcGFyc2Vfc2R2b19wYW5lbF9kYXRhKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCWZpbGxfZGV0YWlsX3RpbWluZ19k
YXRhKHBhbmVsX2ZpeGVkX21vZGUsICZkdGRzLT5kdGRzW2luZGV4XSk7CiAKLQlkZXZfcHJpdi0+
dmJ0LnNkdm9fbHZkc192YnRfbW9kZSA9IHBhbmVsX2ZpeGVkX21vZGU7CisJaTkxNS0+dmJ0LnNk
dm9fbHZkc192YnRfbW9kZSA9IHBhbmVsX2ZpeGVkX21vZGU7CiAKIAlEUk1fREVCVUdfS01TKCJG
b3VuZCBTRFZPIHBhbmVsIG1vZGUgaW4gQklPUyBWQlQgdGFibGVzOlxuIik7CiAJZHJtX21vZGVf
ZGVidWdfcHJpbnRtb2RlbGluZShwYW5lbF9maXhlZF9tb2RlKTsKIH0KIAotc3RhdGljIGludCBp
bnRlbF9iaW9zX3NzY19mcmVxdWVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIGludCBpbnRlbF9iaW9zX3NzY19mcmVxdWVuY3koc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCQkJICAgIGJvb2wgYWx0ZXJuYXRlKQogewotCXN3aXRjaCAoSU5URUxf
R0VOKGRldl9wcml2KSkgeworCXN3aXRjaCAoSU5URUxfR0VOKGk5MTUpKSB7CiAJY2FzZSAyOgog
CQlyZXR1cm4gYWx0ZXJuYXRlID8gNjY2NjcgOiA0ODAwMDsKIAljYXNlIDM6CkBAIC00MDIsNyAr
NDAyLDcgQEAgc3RhdGljIGludCBpbnRlbF9iaW9zX3NzY19mcmVxdWVuY3koc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdGF0aWMgdm9pZAotcGFyc2VfZ2VuZXJhbF9m
ZWF0dXJlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9nZW5lcmFs
X2ZlYXR1cmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgICAgY29uc3Qg
c3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1Y3QgYmRiX2dlbmVyYWxfZmVh
dHVyZXMgKmdlbmVyYWw7CkBAIC00MTEsMzAgKzQxMSwzMCBAQCBwYXJzZV9nZW5lcmFsX2ZlYXR1
cmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAoIWdlbmVyYWwpCiAJ
CXJldHVybjsKIAotCWRldl9wcml2LT52YnQuaW50X3R2X3N1cHBvcnQgPSBnZW5lcmFsLT5pbnRf
dHZfc3VwcG9ydDsKKwlpOTE1LT52YnQuaW50X3R2X3N1cHBvcnQgPSBnZW5lcmFsLT5pbnRfdHZf
c3VwcG9ydDsKIAkvKiBpbnRfY3J0X3N1cHBvcnQgY2FuJ3QgYmUgdHJ1c3RlZCBvbiBlYXJsaWVy
IHBsYXRmb3JtcyAqLwogCWlmIChiZGItPnZlcnNpb24gPj0gMTU1ICYmCi0JICAgIChIQVNfRERJ
KGRldl9wcml2KSB8fCBJU19WQUxMRVlWSUVXKGRldl9wcml2KSkpCi0JCWRldl9wcml2LT52YnQu
aW50X2NydF9zdXBwb3J0ID0gZ2VuZXJhbC0+aW50X2NydF9zdXBwb3J0OwotCWRldl9wcml2LT52
YnQubHZkc191c2Vfc3NjID0gZ2VuZXJhbC0+ZW5hYmxlX3NzYzsKLQlkZXZfcHJpdi0+dmJ0Lmx2
ZHNfc3NjX2ZyZXEgPQotCQlpbnRlbF9iaW9zX3NzY19mcmVxdWVuY3koZGV2X3ByaXYsIGdlbmVy
YWwtPnNzY19mcmVxKTsKLQlkZXZfcHJpdi0+dmJ0LmRpc3BsYXlfY2xvY2tfbW9kZSA9IGdlbmVy
YWwtPmRpc3BsYXlfY2xvY2tfbW9kZTsKLQlkZXZfcHJpdi0+dmJ0LmZkaV9yeF9wb2xhcml0eV9p
bnZlcnRlZCA9IGdlbmVyYWwtPmZkaV9yeF9wb2xhcml0eV9pbnZlcnRlZDsKKwkgICAgKEhBU19E
REkoaTkxNSkgfHwgSVNfVkFMTEVZVklFVyhpOTE1KSkpCisJCWk5MTUtPnZidC5pbnRfY3J0X3N1
cHBvcnQgPSBnZW5lcmFsLT5pbnRfY3J0X3N1cHBvcnQ7CisJaTkxNS0+dmJ0Lmx2ZHNfdXNlX3Nz
YyA9IGdlbmVyYWwtPmVuYWJsZV9zc2M7CisJaTkxNS0+dmJ0Lmx2ZHNfc3NjX2ZyZXEgPQorCQlp
bnRlbF9iaW9zX3NzY19mcmVxdWVuY3koaTkxNSwgZ2VuZXJhbC0+c3NjX2ZyZXEpOworCWk5MTUt
PnZidC5kaXNwbGF5X2Nsb2NrX21vZGUgPSBnZW5lcmFsLT5kaXNwbGF5X2Nsb2NrX21vZGU7CisJ
aTkxNS0+dmJ0LmZkaV9yeF9wb2xhcml0eV9pbnZlcnRlZCA9IGdlbmVyYWwtPmZkaV9yeF9wb2xh
cml0eV9pbnZlcnRlZDsKIAlpZiAoYmRiLT52ZXJzaW9uID49IDE4MSkgewotCQlkZXZfcHJpdi0+
dmJ0Lm9yaWVudGF0aW9uID0gZ2VuZXJhbC0+cm90YXRlXzE4MCA/CisJCWk5MTUtPnZidC5vcmll
bnRhdGlvbiA9IGdlbmVyYWwtPnJvdGF0ZV8xODAgPwogCQkJRFJNX01PREVfUEFORUxfT1JJRU5U
QVRJT05fQk9UVE9NX1VQIDoKIAkJCURSTV9NT0RFX1BBTkVMX09SSUVOVEFUSU9OX05PUk1BTDsK
IAl9IGVsc2UgewotCQlkZXZfcHJpdi0+dmJ0Lm9yaWVudGF0aW9uID0gRFJNX01PREVfUEFORUxf
T1JJRU5UQVRJT05fVU5LTk9XTjsKKwkJaTkxNS0+dmJ0Lm9yaWVudGF0aW9uID0gRFJNX01PREVf
UEFORUxfT1JJRU5UQVRJT05fVU5LTk9XTjsKIAl9CiAJRFJNX0RFQlVHX0tNUygiQkRCX0dFTkVS
QUxfRkVBVFVSRVMgaW50X3R2X3N1cHBvcnQgJWQgaW50X2NydF9zdXBwb3J0ICVkIGx2ZHNfdXNl
X3NzYyAlZCBsdmRzX3NzY19mcmVxICVkIGRpc3BsYXlfY2xvY2tfbW9kZSAlZCBmZGlfcnhfcG9s
YXJpdHlfaW52ZXJ0ZWQgJWRcbiIsCi0JCSAgICAgIGRldl9wcml2LT52YnQuaW50X3R2X3N1cHBv
cnQsCi0JCSAgICAgIGRldl9wcml2LT52YnQuaW50X2NydF9zdXBwb3J0LAotCQkgICAgICBkZXZf
cHJpdi0+dmJ0Lmx2ZHNfdXNlX3NzYywKLQkJICAgICAgZGV2X3ByaXYtPnZidC5sdmRzX3NzY19m
cmVxLAotCQkgICAgICBkZXZfcHJpdi0+dmJ0LmRpc3BsYXlfY2xvY2tfbW9kZSwKLQkJICAgICAg
ZGV2X3ByaXYtPnZidC5mZGlfcnhfcG9sYXJpdHlfaW52ZXJ0ZWQpOworCQkgICAgICBpOTE1LT52
YnQuaW50X3R2X3N1cHBvcnQsCisJCSAgICAgIGk5MTUtPnZidC5pbnRfY3J0X3N1cHBvcnQsCisJ
CSAgICAgIGk5MTUtPnZidC5sdmRzX3VzZV9zc2MsCisJCSAgICAgIGk5MTUtPnZidC5sdmRzX3Nz
Y19mcmVxLAorCQkgICAgICBpOTE1LT52YnQuZGlzcGxheV9jbG9ja19tb2RlLAorCQkgICAgICBp
OTE1LT52YnQuZmRpX3J4X3BvbGFyaXR5X2ludmVydGVkKTsKIH0KIAogc3RhdGljIGNvbnN0IHN0
cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICoKQEAgLTQ0NCw3ICs0NDQsNyBAQCBjaGlsZF9kZXZp
Y2VfcHRyKGNvbnN0IHN0cnVjdCBiZGJfZ2VuZXJhbF9kZWZpbml0aW9ucyAqZGVmcywgaW50IGkp
CiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9zZHZvX2RldmljZV9tYXBwaW5nKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggYmRiX3ZlcnNpb24pCitwYXJzZV9zZHZvX2Rldmlj
ZV9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1OCBiZGJfdmVyc2lvbikK
IHsKIAlzdHJ1Y3Qgc2R2b19kZXZpY2VfbWFwcGluZyAqbWFwcGluZzsKIAljb25zdCBzdHJ1Y3Qg
Y2hpbGRfZGV2aWNlX2NvbmZpZyAqY2hpbGQ7CkBAIC00NTQsMTMgKzQ1NCwxMyBAQCBwYXJzZV9z
ZHZvX2RldmljZV9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTgg
YmRiX3ZlcnNpb24pCiAJICogT25seSBwYXJzZSBTRFZPIG1hcHBpbmdzIG9uIGdlbnMgdGhhdCBj
b3VsZCBoYXZlIFNEVk8uIFRoaXMgaXNuJ3QKIAkgKiBhY2N1cmF0ZSBhbmQgZG9lc24ndCBoYXZl
IHRvIGJlLCBhcyBsb25nIGFzIGl0J3Mgbm90IHRvbyBzdHJpY3QuCiAJICovCi0JaWYgKCFJU19H
RU5fUkFOR0UoZGV2X3ByaXYsIDMsIDcpKSB7CisJaWYgKCFJU19HRU5fUkFOR0UoaTkxNSwgMywg
NykpIHsKIAkJRFJNX0RFQlVHX0tNUygiU2tpcHBpbmcgU0RWTyBkZXZpY2UgbWFwcGluZ1xuIik7
CiAJCXJldHVybjsKIAl9CiAKLQlmb3IgKGkgPSAwLCBjb3VudCA9IDA7IGkgPCBkZXZfcHJpdi0+
dmJ0LmNoaWxkX2Rldl9udW07IGkrKykgewotCQljaGlsZCA9IGRldl9wcml2LT52YnQuY2hpbGRf
ZGV2ICsgaTsKKwlmb3IgKGkgPSAwLCBjb3VudCA9IDA7IGkgPCBpOTE1LT52YnQuY2hpbGRfZGV2
X251bTsgaSsrKSB7CisJCWNoaWxkID0gaTkxNS0+dmJ0LmNoaWxkX2RldiArIGk7CiAKIAkJaWYg
KGNoaWxkLT5zbGF2ZV9hZGRyICE9IFNMQVZFX0FERFIxICYmCiAJCSAgICBjaGlsZC0+c2xhdmVf
YWRkciAhPSBTTEFWRV9BRERSMikgewpAQCAtNDgxLDcgKzQ4MSw3IEBAIHBhcnNlX3Nkdm9fZGV2
aWNlX21hcHBpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJfdmVy
c2lvbikKIAkJCSAgICAgIGNoaWxkLT5zbGF2ZV9hZGRyLAogCQkJICAgICAgKGNoaWxkLT5kdm9f
cG9ydCA9PSBERVZJQ0VfUE9SVF9EVk9CKSA/CiAJCQkgICAgICAiU0RWT0IiIDogIlNEVk9DIik7
Ci0JCW1hcHBpbmcgPSAmZGV2X3ByaXYtPnZidC5zZHZvX21hcHBpbmdzW2NoaWxkLT5kdm9fcG9y
dCAtIDFdOworCQltYXBwaW5nID0gJmk5MTUtPnZidC5zZHZvX21hcHBpbmdzW2NoaWxkLT5kdm9f
cG9ydCAtIDFdOwogCQlpZiAoIW1hcHBpbmctPmluaXRpYWxpemVkKSB7CiAJCQltYXBwaW5nLT5k
dm9fcG9ydCA9IGNoaWxkLT5kdm9fcG9ydDsKIAkJCW1hcHBpbmctPnNsYXZlX2FkZHIgPSBjaGls
ZC0+c2xhdmVfYWRkcjsKQEAgLTUxNSw3ICs1MTUsNyBAQCBwYXJzZV9zZHZvX2RldmljZV9tYXBw
aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggYmRiX3ZlcnNpb24pCiB9
CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9kcml2ZXJfZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorcGFyc2VfZHJpdmVyX2ZlYXR1cmVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkgICAgICBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewog
CWNvbnN0IHN0cnVjdCBiZGJfZHJpdmVyX2ZlYXR1cmVzICpkcml2ZXI7CkBAIC01MjQsMTQgKzUy
NCwxNCBAQCBwYXJzZV9kcml2ZXJfZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCWlmICghZHJpdmVyKQogCQlyZXR1cm47CiAKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA1KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA1KSB7CiAJCS8qCiAJCSAqIE5v
dGUgdGhhdCB3ZSBjb25zaWRlciBCREJfRFJJVkVSX0ZFQVRVUkVfSU5UX1NEVk9fTFZEUwogCQkg
KiB0byBtZWFuICJlRFAiLiBUaGUgVkJUIHNwZWMgZG9lc24ndCBhZ3JlZSB3aXRoIHRoYXQKIAkJ
ICogaW50ZXJwcmV0YXRpb24sIGJ1dCByZWFsIHdvcmxkIFZCVHMgc2VlbSB0by4KIAkJICovCiAJ
CWlmIChkcml2ZXItPmx2ZHNfY29uZmlnICE9IEJEQl9EUklWRVJfRkVBVFVSRV9JTlRfTFZEUykK
LQkJCWRldl9wcml2LT52YnQuaW50X2x2ZHNfc3VwcG9ydCA9IDA7CisJCQlpOTE1LT52YnQuaW50
X2x2ZHNfc3VwcG9ydCA9IDA7CiAJfSBlbHNlIHsKIAkJLyoKIAkJICogRklYTUUgaXQncyBub3Qg
Y2xlYXIgd2hpY2ggQkRCIHZlcnNpb24gaGFzIHRoZSBMVkRTIGNvbmZpZwpAQCAtNTQ3LDcgKzU0
Nyw3IEBAIHBhcnNlX2RyaXZlcl9mZWF0dXJlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJCWlmIChiZGItPnZlcnNpb24gPj0gMTM0ICYmCiAJCSAgICBkcml2ZXItPmx2ZHNf
Y29uZmlnICE9IEJEQl9EUklWRVJfRkVBVFVSRV9JTlRfTFZEUyAmJgogCQkgICAgZHJpdmVyLT5s
dmRzX2NvbmZpZyAhPSBCREJfRFJJVkVSX0ZFQVRVUkVfSU5UX1NEVk9fTFZEUykKLQkJCWRldl9w
cml2LT52YnQuaW50X2x2ZHNfc3VwcG9ydCA9IDA7CisJCQlpOTE1LT52YnQuaW50X2x2ZHNfc3Vw
cG9ydCA9IDA7CiAJfQogCiAJRFJNX0RFQlVHX0tNUygiRFJSUyBTdGF0ZSBFbmFibGVkOiVkXG4i
LCBkcml2ZXItPmRycnNfZW5hYmxlZCk7CkBAIC01NTgsMTcgKzU1OCwxNyBAQCBwYXJzZV9kcml2
ZXJfZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIGRyaXZl
ci0+ZHJyc19lbmFibGVkPWZhbHNlCiAJICovCiAJaWYgKCFkcml2ZXItPmRycnNfZW5hYmxlZCkK
LQkJZGV2X3ByaXYtPnZidC5kcnJzX3R5cGUgPSBEUlJTX05PVF9TVVBQT1JURUQ7Ci0JZGV2X3By
aXYtPnZidC5wc3IuZW5hYmxlID0gZHJpdmVyLT5wc3JfZW5hYmxlZDsKKwkJaTkxNS0+dmJ0LmRy
cnNfdHlwZSA9IERSUlNfTk9UX1NVUFBPUlRFRDsKKwlpOTE1LT52YnQucHNyLmVuYWJsZSA9IGRy
aXZlci0+cHNyX2VuYWJsZWQ7CiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9lZHAoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQor
cGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBjb25zdCBzdHJ1Y3QgYmRi
X2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfZWRwICplZHA7CiAJY29uc3Qgc3Ry
dWN0IGVkcF9wb3dlcl9zZXEgKmVkcF9wcHM7CiAJY29uc3Qgc3RydWN0IGVkcF9mYXN0X2xpbmtf
cGFyYW1zICplZHBfbGlua19wYXJhbXM7Ci0JaW50IHBhbmVsX3R5cGUgPSBkZXZfcHJpdi0+dmJ0
LnBhbmVsX3R5cGU7CisJaW50IHBhbmVsX3R5cGUgPSBpOTE1LT52YnQucGFuZWxfdHlwZTsKIAog
CWVkcCA9IGZpbmRfc2VjdGlvbihiZGIsIEJEQl9FRFApOwogCWlmICghZWRwKQpAQCAtNTc2LDEz
ICs1NzYsMTMgQEAgcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
Y29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAogCXN3aXRjaCAoKGVkcC0+Y29sb3JfZGVw
dGggPj4gKHBhbmVsX3R5cGUgKiAyKSkgJiAzKSB7CiAJY2FzZSBFRFBfMThCUFA6Ci0JCWRldl9w
cml2LT52YnQuZWRwLmJwcCA9IDE4OworCQlpOTE1LT52YnQuZWRwLmJwcCA9IDE4OwogCQlicmVh
azsKIAljYXNlIEVEUF8yNEJQUDoKLQkJZGV2X3ByaXYtPnZidC5lZHAuYnBwID0gMjQ7CisJCWk5
MTUtPnZidC5lZHAuYnBwID0gMjQ7CiAJCWJyZWFrOwogCWNhc2UgRURQXzMwQlBQOgotCQlkZXZf
cHJpdi0+dmJ0LmVkcC5icHAgPSAzMDsKKwkJaTkxNS0+dmJ0LmVkcC5icHAgPSAzMDsKIAkJYnJl
YWs7CiAJfQogCkBAIC01OTAsMTQgKzU5MCwxNCBAQCBwYXJzZV9lZHAoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogCWVkcF9w
cHMgPSAmZWRwLT5wb3dlcl9zZXFzW3BhbmVsX3R5cGVdOwogCWVkcF9saW5rX3BhcmFtcyA9ICZl
ZHAtPmZhc3RfbGlua19wYXJhbXNbcGFuZWxfdHlwZV07CiAKLQlkZXZfcHJpdi0+dmJ0LmVkcC5w
cHMgPSAqZWRwX3BwczsKKwlpOTE1LT52YnQuZWRwLnBwcyA9ICplZHBfcHBzOwogCiAJc3dpdGNo
IChlZHBfbGlua19wYXJhbXMtPnJhdGUpIHsKIAljYXNlIEVEUF9SQVRFXzFfNjI6Ci0JCWRldl9w
cml2LT52YnQuZWRwLnJhdGUgPSBEUF9MSU5LX0JXXzFfNjI7CisJCWk5MTUtPnZidC5lZHAucmF0
ZSA9IERQX0xJTktfQldfMV82MjsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfUkFURV8yXzc6Ci0JCWRl
dl9wcml2LT52YnQuZWRwLnJhdGUgPSBEUF9MSU5LX0JXXzJfNzsKKwkJaTkxNS0+dmJ0LmVkcC5y
YXRlID0gRFBfTElOS19CV18yXzc7CiAJCWJyZWFrOwogCWRlZmF1bHQ6CiAJCURSTV9ERUJVR19L
TVMoIlZCVCBoYXMgdW5rbm93biBlRFAgbGluayByYXRlIHZhbHVlICV1XG4iLApAQCAtNjA3LDEz
ICs2MDcsMTMgQEAgcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
Y29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAogCXN3aXRjaCAoZWRwX2xpbmtfcGFyYW1z
LT5sYW5lcykgewogCWNhc2UgRURQX0xBTkVfMToKLQkJZGV2X3ByaXYtPnZidC5lZHAubGFuZXMg
PSAxOworCQlpOTE1LT52YnQuZWRwLmxhbmVzID0gMTsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfTEFO
RV8yOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5sYW5lcyA9IDI7CisJCWk5MTUtPnZidC5lZHAubGFu
ZXMgPSAyOwogCQlicmVhazsKIAljYXNlIEVEUF9MQU5FXzQ6Ci0JCWRldl9wcml2LT52YnQuZWRw
LmxhbmVzID0gNDsKKwkJaTkxNS0+dmJ0LmVkcC5sYW5lcyA9IDQ7CiAJCWJyZWFrOwogCWRlZmF1
bHQ6CiAJCURSTV9ERUJVR19LTVMoIlZCVCBoYXMgdW5rbm93biBlRFAgbGFuZSBjb3VudCB2YWx1
ZSAldVxuIiwKQEAgLTYyMywxNiArNjIzLDE2IEBAIHBhcnNlX2VkcChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiAKIAlzd2l0
Y2ggKGVkcF9saW5rX3BhcmFtcy0+cHJlZW1waGFzaXMpIHsKIAljYXNlIEVEUF9QUkVFTVBIQVNJ
U19OT05FOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5wcmVlbXBoYXNpcyA9IERQX1RSQUlOX1BSRV9F
TVBIX0xFVkVMXzA7CisJCWk5MTUtPnZidC5lZHAucHJlZW1waGFzaXMgPSBEUF9UUkFJTl9QUkVf
RU1QSF9MRVZFTF8wOwogCQlicmVhazsKIAljYXNlIEVEUF9QUkVFTVBIQVNJU18zXzVkQjoKLQkJ
ZGV2X3ByaXYtPnZidC5lZHAucHJlZW1waGFzaXMgPSBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8x
OworCQlpOTE1LT52YnQuZWRwLnByZWVtcGhhc2lzID0gRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxf
MTsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfUFJFRU1QSEFTSVNfNmRCOgotCQlkZXZfcHJpdi0+dmJ0
LmVkcC5wcmVlbXBoYXNpcyA9IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzI7CisJCWk5MTUtPnZi
dC5lZHAucHJlZW1waGFzaXMgPSBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8yOwogCQlicmVhazsK
IAljYXNlIEVEUF9QUkVFTVBIQVNJU185XzVkQjoKLQkJZGV2X3ByaXYtPnZidC5lZHAucHJlZW1w
aGFzaXMgPSBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8zOworCQlpOTE1LT52YnQuZWRwLnByZWVt
cGhhc2lzID0gRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxfMzsKIAkJYnJlYWs7CiAJZGVmYXVsdDoK
IAkJRFJNX0RFQlVHX0tNUygiVkJUIGhhcyB1bmtub3duIGVEUCBwcmUtZW1waGFzaXMgdmFsdWUg
JXVcbiIsCkBAIC02NDIsMTYgKzY0MiwxNiBAQCBwYXJzZV9lZHAoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogCiAJc3dpdGNo
IChlZHBfbGlua19wYXJhbXMtPnZzd2luZykgewogCWNhc2UgRURQX1ZTV0lOR18wXzRWOgotCQlk
ZXZfcHJpdi0+dmJ0LmVkcC52c3dpbmcgPSBEUF9UUkFJTl9WT0xUQUdFX1NXSU5HX0xFVkVMXzA7
CisJCWk5MTUtPnZidC5lZHAudnN3aW5nID0gRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8w
OwogCQlicmVhazsKIAljYXNlIEVEUF9WU1dJTkdfMF82VjoKLQkJZGV2X3ByaXYtPnZidC5lZHAu
dnN3aW5nID0gRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8xOworCQlpOTE1LT52YnQuZWRw
LnZzd2luZyA9IERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMTsKIAkJYnJlYWs7CiAJY2Fz
ZSBFRFBfVlNXSU5HXzBfOFY6Ci0JCWRldl9wcml2LT52YnQuZWRwLnZzd2luZyA9IERQX1RSQUlO
X1ZPTFRBR0VfU1dJTkdfTEVWRUxfMjsKKwkJaTkxNS0+dmJ0LmVkcC52c3dpbmcgPSBEUF9UUkFJ
Tl9WT0xUQUdFX1NXSU5HX0xFVkVMXzI7CiAJCWJyZWFrOwogCWNhc2UgRURQX1ZTV0lOR18xXzJW
OgotCQlkZXZfcHJpdi0+dmJ0LmVkcC52c3dpbmcgPSBEUF9UUkFJTl9WT0xUQUdFX1NXSU5HX0xF
VkVMXzM7CisJCWk5MTUtPnZidC5lZHAudnN3aW5nID0gRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19M
RVZFTF8zOwogCQlicmVhazsKIAlkZWZhdWx0OgogCQlEUk1fREVCVUdfS01TKCJWQlQgaGFzIHVu
a25vd24gZURQIHZvbHRhZ2Ugc3dpbmcgdmFsdWUgJXVcbiIsCkBAIC02NjQsMjEgKzY2NCwyMSBA
QCBwYXJzZV9lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1
Y3QgYmRiX2hlYWRlciAqYmRiKQogCiAJCS8qIERvbid0IHJlYWQgZnJvbSBWQlQgaWYgbW9kdWxl
IHBhcmFtZXRlciBoYXMgdmFsaWQgdmFsdWUqLwogCQlpZiAoaTkxNV9tb2RwYXJhbXMuZWRwX3Zz
d2luZykgewotCQkJZGV2X3ByaXYtPnZidC5lZHAubG93X3Zzd2luZyA9CisJCQlpOTE1LT52YnQu
ZWRwLmxvd192c3dpbmcgPQogCQkJCWk5MTVfbW9kcGFyYW1zLmVkcF92c3dpbmcgPT0gMTsKIAkJ
fSBlbHNlIHsKIAkJCXZzd2luZyA9IChlZHAtPmVkcF92c3dpbmdfcHJlZW1waCA+PiAocGFuZWxf
dHlwZSAqIDQpKSAmIDB4RjsKLQkJCWRldl9wcml2LT52YnQuZWRwLmxvd192c3dpbmcgPSB2c3dp
bmcgPT0gMDsKKwkJCWk5MTUtPnZidC5lZHAubG93X3Zzd2luZyA9IHZzd2luZyA9PSAwOwogCQl9
CiAJfQogfQogCiBzdGF0aWMgdm9pZAotcGFyc2VfcHNyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKK3BhcnNlX3BzcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikK
IHsKIAljb25zdCBzdHJ1Y3QgYmRiX3BzciAqcHNyOwogCWNvbnN0IHN0cnVjdCBwc3JfdGFibGUg
KnBzcl90YWJsZTsKLQlpbnQgcGFuZWxfdHlwZSA9IGRldl9wcml2LT52YnQucGFuZWxfdHlwZTsK
KwlpbnQgcGFuZWxfdHlwZSA9IGk5MTUtPnZidC5wYW5lbF90eXBlOwogCiAJcHNyID0gZmluZF9z
ZWN0aW9uKGJkYiwgQkRCX1BTUik7CiAJaWYgKCFwc3IpIHsKQEAgLTY4OCwyNSArNjg4LDI1IEBA
IHBhcnNlX3BzcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGNvbnN0IHN0cnVj
dCBiZGJfaGVhZGVyICpiZGIpCiAKIAlwc3JfdGFibGUgPSAmcHNyLT5wc3JfdGFibGVbcGFuZWxf
dHlwZV07CiAKLQlkZXZfcHJpdi0+dmJ0LnBzci5mdWxsX2xpbmsgPSBwc3JfdGFibGUtPmZ1bGxf
bGluazsKLQlkZXZfcHJpdi0+dmJ0LnBzci5yZXF1aXJlX2F1eF93YWtldXAgPSBwc3JfdGFibGUt
PnJlcXVpcmVfYXV4X3RvX3dha2V1cDsKKwlpOTE1LT52YnQucHNyLmZ1bGxfbGluayA9IHBzcl90
YWJsZS0+ZnVsbF9saW5rOworCWk5MTUtPnZidC5wc3IucmVxdWlyZV9hdXhfd2FrZXVwID0gcHNy
X3RhYmxlLT5yZXF1aXJlX2F1eF90b193YWtldXA7CiAKIAkvKiBBbGxvd2VkIFZCVCB2YWx1ZXMg
Z29lcyBmcm9tIDAgdG8gMTUgKi8KLQlkZXZfcHJpdi0+dmJ0LnBzci5pZGxlX2ZyYW1lcyA9IHBz
cl90YWJsZS0+aWRsZV9mcmFtZXMgPCAwID8gMCA6CisJaTkxNS0+dmJ0LnBzci5pZGxlX2ZyYW1l
cyA9IHBzcl90YWJsZS0+aWRsZV9mcmFtZXMgPCAwID8gMCA6CiAJCXBzcl90YWJsZS0+aWRsZV9m
cmFtZXMgPiAxNSA/IDE1IDogcHNyX3RhYmxlLT5pZGxlX2ZyYW1lczsKIAogCXN3aXRjaCAocHNy
X3RhYmxlLT5saW5lc190b193YWl0KSB7CiAJY2FzZSAwOgotCQlkZXZfcHJpdi0+dmJ0LnBzci5s
aW5lc190b193YWl0ID0gUFNSXzBfTElORVNfVE9fV0FJVDsKKwkJaTkxNS0+dmJ0LnBzci5saW5l
c190b193YWl0ID0gUFNSXzBfTElORVNfVE9fV0FJVDsKIAkJYnJlYWs7CiAJY2FzZSAxOgotCQlk
ZXZfcHJpdi0+dmJ0LnBzci5saW5lc190b193YWl0ID0gUFNSXzFfTElORV9UT19XQUlUOworCQlp
OTE1LT52YnQucHNyLmxpbmVzX3RvX3dhaXQgPSBQU1JfMV9MSU5FX1RPX1dBSVQ7CiAJCWJyZWFr
OwogCWNhc2UgMjoKLQkJZGV2X3ByaXYtPnZidC5wc3IubGluZXNfdG9fd2FpdCA9IFBTUl80X0xJ
TkVTX1RPX1dBSVQ7CisJCWk5MTUtPnZidC5wc3IubGluZXNfdG9fd2FpdCA9IFBTUl80X0xJTkVT
X1RPX1dBSVQ7CiAJCWJyZWFrOwogCWNhc2UgMzoKLQkJZGV2X3ByaXYtPnZidC5wc3IubGluZXNf
dG9fd2FpdCA9IFBTUl84X0xJTkVTX1RPX1dBSVQ7CisJCWk5MTUtPnZidC5wc3IubGluZXNfdG9f
d2FpdCA9IFBTUl84X0xJTkVTX1RPX1dBSVQ7CiAJCWJyZWFrOwogCWRlZmF1bHQ6CiAJCURSTV9E
RUJVR19LTVMoIlZCVCBoYXMgdW5rbm93biBQU1IgbGluZXMgdG8gd2FpdCAldVxuIiwKQEAgLTcx
OSw0OCArNzE5LDQ4IEBAIHBhcnNlX3BzcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiAJICogT2xkIGRlY2ltYWwgdmFsdWUg
aXMgd2FrZSB1cCB0aW1lIGluIG11bHRpcGxlcyBvZiAxMDAgdXMuCiAJICovCiAJaWYgKGJkYi0+
dmVyc2lvbiA+PSAyMDUgJiYKLQkgICAgKElTX0dFTjlfQkMoZGV2X3ByaXYpIHx8IElTX0dFTUlO
SUxBS0UoZGV2X3ByaXYpIHx8Ci0JICAgICBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKSkgewor
CSAgICAoSVNfR0VOOV9CQyhpOTE1KSB8fCBJU19HRU1JTklMQUtFKGk5MTUpIHx8CisJICAgICBJ
TlRFTF9HRU4oaTkxNSkgPj0gMTApKSB7CiAJCXN3aXRjaCAocHNyX3RhYmxlLT50cDFfd2FrZXVw
X3RpbWUpIHsKIAkJY2FzZSAwOgotCQkJZGV2X3ByaXYtPnZidC5wc3IudHAxX3dha2V1cF90aW1l
X3VzID0gNTAwOworCQkJaTkxNS0+dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMgPSA1MDA7CiAJ
CQlicmVhazsKIAkJY2FzZSAxOgotCQkJZGV2X3ByaXYtPnZidC5wc3IudHAxX3dha2V1cF90aW1l
X3VzID0gMTAwOworCQkJaTkxNS0+dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMgPSAxMDA7CiAJ
CQlicmVhazsKIAkJY2FzZSAzOgotCQkJZGV2X3ByaXYtPnZidC5wc3IudHAxX3dha2V1cF90aW1l
X3VzID0gMDsKKwkJCWk5MTUtPnZidC5wc3IudHAxX3dha2V1cF90aW1lX3VzID0gMDsKIAkJCWJy
ZWFrOwogCQlkZWZhdWx0OgogCQkJRFJNX0RFQlVHX0tNUygiVkJUIHRwMSB3YWtldXAgdGltZSB2
YWx1ZSAlZCBpcyBvdXRzaWRlIHJhbmdlWzAtM10sIGRlZmF1bHRpbmcgdG8gbWF4IHZhbHVlIDI1
MDB1c1xuIiwKIAkJCQkJcHNyX3RhYmxlLT50cDFfd2FrZXVwX3RpbWUpOwogCQkJLyogZmFsbHRo
cm91Z2ggKi8KIAkJY2FzZSAyOgotCQkJZGV2X3ByaXYtPnZidC5wc3IudHAxX3dha2V1cF90aW1l
X3VzID0gMjUwMDsKKwkJCWk5MTUtPnZidC5wc3IudHAxX3dha2V1cF90aW1lX3VzID0gMjUwMDsK
IAkJCWJyZWFrOwogCQl9CiAKIAkJc3dpdGNoIChwc3JfdGFibGUtPnRwMl90cDNfd2FrZXVwX3Rp
bWUpIHsKIAkJY2FzZSAwOgotCQkJZGV2X3ByaXYtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGlt
ZV91cyA9IDUwMDsKKwkJCWk5MTUtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IDUw
MDsKIAkJCWJyZWFrOwogCQljYXNlIDE6Ci0JCQlkZXZfcHJpdi0+dmJ0LnBzci50cDJfdHAzX3dh
a2V1cF90aW1lX3VzID0gMTAwOworCQkJaTkxNS0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1l
X3VzID0gMTAwOwogCQkJYnJlYWs7CiAJCWNhc2UgMzoKLQkJCWRldl9wcml2LT52YnQucHNyLnRw
Ml90cDNfd2FrZXVwX3RpbWVfdXMgPSAwOworCQkJaTkxNS0+dmJ0LnBzci50cDJfdHAzX3dha2V1
cF90aW1lX3VzID0gMDsKIAkJCWJyZWFrOwogCQlkZWZhdWx0OgogCQkJRFJNX0RFQlVHX0tNUygi
VkJUIHRwMl90cDMgd2FrZXVwIHRpbWUgdmFsdWUgJWQgaXMgb3V0c2lkZSByYW5nZVswLTNdLCBk
ZWZhdWx0aW5nIHRvIG1heCB2YWx1ZSAyNTAwdXNcbiIsCiAJCQkJCXBzcl90YWJsZS0+dHAyX3Rw
M193YWtldXBfdGltZSk7CiAJCQkvKiBmYWxsdGhyb3VnaCAqLwogCQljYXNlIDI6Ci0JCQlkZXZf
cHJpdi0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1lX3VzID0gMjUwMDsKKwkJCWk5MTUtPnZi
dC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IDI1MDA7CiAJCWJyZWFrOwogCQl9CiAJfSBl
bHNlIHsKLQkJZGV2X3ByaXYtPnZidC5wc3IudHAxX3dha2V1cF90aW1lX3VzID0gcHNyX3RhYmxl
LT50cDFfd2FrZXVwX3RpbWUgKiAxMDA7Ci0JCWRldl9wcml2LT52YnQucHNyLnRwMl90cDNfd2Fr
ZXVwX3RpbWVfdXMgPSBwc3JfdGFibGUtPnRwMl90cDNfd2FrZXVwX3RpbWUgKiAxMDA7CisJCWk5
MTUtPnZidC5wc3IudHAxX3dha2V1cF90aW1lX3VzID0gcHNyX3RhYmxlLT50cDFfd2FrZXVwX3Rp
bWUgKiAxMDA7CisJCWk5MTUtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IHBzcl90
YWJsZS0+dHAyX3RwM193YWtldXBfdGltZSAqIDEwMDsKIAl9CiAKIAlpZiAoYmRiLT52ZXJzaW9u
ID49IDIyNikgewpAQCAtNzgyLDc0ICs3ODIsNzQgQEAgcGFyc2VfcHNyKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAkJCXdh
a2V1cF90aW1lID0gMjUwMDsKIAkJCWJyZWFrOwogCQl9Ci0JCWRldl9wcml2LT52YnQucHNyLnBz
cjJfdHAyX3RwM193YWtldXBfdGltZV91cyA9IHdha2V1cF90aW1lOworCQlpOTE1LT52YnQucHNy
LnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA9IHdha2V1cF90aW1lOwogCX0gZWxzZSB7CiAJ
CS8qIFJldXNpbmcgUFNSMSB3YWtldXAgdGltZSBmb3IgUFNSMiBpbiBvbGRlciBWQlRzICovCi0J
CWRldl9wcml2LT52YnQucHNyLnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA9IGRldl9wcml2
LT52YnQucHNyLnRwMl90cDNfd2FrZXVwX3RpbWVfdXM7CisJCWk5MTUtPnZidC5wc3IucHNyMl90
cDJfdHAzX3dha2V1cF90aW1lX3VzID0gaTkxNS0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1l
X3VzOwogCX0KIH0KIAotc3RhdGljIHZvaWQgcGFyc2VfZHNpX2JhY2tsaWdodF9wb3J0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBwYXJzZV9kc2lfYmFj
a2xpZ2h0X3BvcnRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgIHUx
NiB2ZXJzaW9uLCBlbnVtIHBvcnQgcG9ydCkKIHsKLQlpZiAoIWRldl9wcml2LT52YnQuZHNpLmNv
bmZpZy0+ZHVhbF9saW5rIHx8IHZlcnNpb24gPCAxOTcpIHsKLQkJZGV2X3ByaXYtPnZidC5kc2ku
YmxfcG9ydHMgPSBCSVQocG9ydCk7Ci0JCWlmIChkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPmNh
YmNfc3VwcG9ydGVkKQotCQkJZGV2X3ByaXYtPnZidC5kc2kuY2FiY19wb3J0cyA9IEJJVChwb3J0
KTsKKwlpZiAoIWk5MTUtPnZidC5kc2kuY29uZmlnLT5kdWFsX2xpbmsgfHwgdmVyc2lvbiA8IDE5
NykgeworCQlpOTE1LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKHBvcnQpOworCQlpZiAoaTkxNS0+
dmJ0LmRzaS5jb25maWctPmNhYmNfc3VwcG9ydGVkKQorCQkJaTkxNS0+dmJ0LmRzaS5jYWJjX3Bv
cnRzID0gQklUKHBvcnQpOwogCiAJCXJldHVybjsKIAl9CiAKLQlzd2l0Y2ggKGRldl9wcml2LT52
YnQuZHNpLmNvbmZpZy0+ZGxfZGNzX2JhY2tsaWdodF9wb3J0cykgeworCXN3aXRjaCAoaTkxNS0+
dmJ0LmRzaS5jb25maWctPmRsX2Rjc19iYWNrbGlnaHRfcG9ydHMpIHsKIAljYXNlIERMX0RDU19Q
T1JUX0E6Ci0JCWRldl9wcml2LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKFBPUlRfQSk7CisJCWk5
MTUtPnZidC5kc2kuYmxfcG9ydHMgPSBCSVQoUE9SVF9BKTsKIAkJYnJlYWs7CiAJY2FzZSBETF9E
Q1NfUE9SVF9DOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5ibF9wb3J0cyA9IEJJVChQT1JUX0MpOwor
CQlpOTE1LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKFBPUlRfQyk7CiAJCWJyZWFrOwogCWRlZmF1
bHQ6CiAJY2FzZSBETF9EQ1NfUE9SVF9BX0FORF9DOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5ibF9w
b3J0cyA9IEJJVChQT1JUX0EpIHwgQklUKFBPUlRfQyk7CisJCWk5MTUtPnZidC5kc2kuYmxfcG9y
dHMgPSBCSVQoUE9SVF9BKSB8IEJJVChQT1JUX0MpOwogCQlicmVhazsKIAl9CiAKLQlpZiAoIWRl
dl9wcml2LT52YnQuZHNpLmNvbmZpZy0+Y2FiY19zdXBwb3J0ZWQpCisJaWYgKCFpOTE1LT52YnQu
ZHNpLmNvbmZpZy0+Y2FiY19zdXBwb3J0ZWQpCiAJCXJldHVybjsKIAotCXN3aXRjaCAoZGV2X3By
aXYtPnZidC5kc2kuY29uZmlnLT5kbF9kY3NfY2FiY19wb3J0cykgeworCXN3aXRjaCAoaTkxNS0+
dmJ0LmRzaS5jb25maWctPmRsX2Rjc19jYWJjX3BvcnRzKSB7CiAJY2FzZSBETF9EQ1NfUE9SVF9B
OgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5jYWJjX3BvcnRzID0gQklUKFBPUlRfQSk7CisJCWk5MTUt
PnZidC5kc2kuY2FiY19wb3J0cyA9IEJJVChQT1JUX0EpOwogCQlicmVhazsKIAljYXNlIERMX0RD
U19QT1JUX0M6Ci0JCWRldl9wcml2LT52YnQuZHNpLmNhYmNfcG9ydHMgPSBCSVQoUE9SVF9DKTsK
KwkJaTkxNS0+dmJ0LmRzaS5jYWJjX3BvcnRzID0gQklUKFBPUlRfQyk7CiAJCWJyZWFrOwogCWRl
ZmF1bHQ6CiAJY2FzZSBETF9EQ1NfUE9SVF9BX0FORF9DOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5j
YWJjX3BvcnRzID0KKwkJaTkxNS0+dmJ0LmRzaS5jYWJjX3BvcnRzID0KIAkJCQkJQklUKFBPUlRf
QSkgfCBCSVQoUE9SVF9DKTsKIAkJYnJlYWs7CiAJfQogfQogCiBzdGF0aWMgdm9pZAotcGFyc2Vf
bWlwaV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2VfbWlw
aV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgY29uc3Qgc3RydWN0
IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1Y3QgYmRiX21pcGlfY29uZmlnICpzdGFy
dDsKIAljb25zdCBzdHJ1Y3QgbWlwaV9jb25maWcgKmNvbmZpZzsKIAljb25zdCBzdHJ1Y3QgbWlw
aV9wcHNfZGF0YSAqcHBzOwotCWludCBwYW5lbF90eXBlID0gZGV2X3ByaXYtPnZidC5wYW5lbF90
eXBlOworCWludCBwYW5lbF90eXBlID0gaTkxNS0+dmJ0LnBhbmVsX3R5cGU7CiAJZW51bSBwb3J0
IHBvcnQ7CiAKIAkvKiBwYXJzZSBNSVBJIGJsb2NrcyBvbmx5IGlmIExGUCB0eXBlIGlzIE1JUEkg
Ki8KLQlpZiAoIWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoZGV2X3ByaXYsICZwb3J0KSkKKwlp
ZiAoIWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoaTkxNSwgJnBvcnQpKQogCQlyZXR1cm47CiAK
IAkvKiBJbml0aWFsaXplIHRoaXMgdG8gdW5kZWZpbmVkIGluZGljYXRpbmcgbm8gZ2VuZXJpYyBN
SVBJIHN1cHBvcnQgKi8KLQlkZXZfcHJpdi0+dmJ0LmRzaS5wYW5lbF9pZCA9IE1JUElfRFNJX1VO
REVGSU5FRF9QQU5FTF9JRDsKKwlpOTE1LT52YnQuZHNpLnBhbmVsX2lkID0gTUlQSV9EU0lfVU5E
RUZJTkVEX1BBTkVMX0lEOwogCiAJLyogQmxvY2sgIzQwIGlzIGFscmVhZHkgcGFyc2VkIGFuZCBw
YW5lbF9maXhlZF9tb2RlIGlzCi0JICogc3RvcmVkIGluIGRldl9wcml2LT5sZnBfbHZkc192YnRf
bW9kZQorCSAqIHN0b3JlZCBpbiBpOTE1LT5sZnBfbHZkc192YnRfbW9kZQogCSAqIHJlc3VzZSB0
aGlzIHdoZW4gbmVlZGVkCiAJICovCiAKQEAgLTg3MywxNyArODczLDE3IEBAIHBhcnNlX21pcGlf
Y29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlwcHMgPSAmc3RhcnQt
PnBwc1twYW5lbF90eXBlXTsKIAogCS8qIHN0b3JlIGFzIG9mIG5vdyBmdWxsIGRhdGEuIFRyaW0g
d2hlbiB3ZSByZWFsaXNlIGFsbCBpcyBub3QgbmVlZGVkICovCi0JZGV2X3ByaXYtPnZidC5kc2ku
Y29uZmlnID0ga21lbWR1cChjb25maWcsIHNpemVvZihzdHJ1Y3QgbWlwaV9jb25maWcpLCBHRlBf
S0VSTkVMKTsKLQlpZiAoIWRldl9wcml2LT52YnQuZHNpLmNvbmZpZykKKwlpOTE1LT52YnQuZHNp
LmNvbmZpZyA9IGttZW1kdXAoY29uZmlnLCBzaXplb2Yoc3RydWN0IG1pcGlfY29uZmlnKSwgR0ZQ
X0tFUk5FTCk7CisJaWYgKCFpOTE1LT52YnQuZHNpLmNvbmZpZykKIAkJcmV0dXJuOwogCi0JZGV2
X3ByaXYtPnZidC5kc2kucHBzID0ga21lbWR1cChwcHMsIHNpemVvZihzdHJ1Y3QgbWlwaV9wcHNf
ZGF0YSksIEdGUF9LRVJORUwpOwotCWlmICghZGV2X3ByaXYtPnZidC5kc2kucHBzKSB7Ci0JCWtm
cmVlKGRldl9wcml2LT52YnQuZHNpLmNvbmZpZyk7CisJaTkxNS0+dmJ0LmRzaS5wcHMgPSBrbWVt
ZHVwKHBwcywgc2l6ZW9mKHN0cnVjdCBtaXBpX3Bwc19kYXRhKSwgR0ZQX0tFUk5FTCk7CisJaWYg
KCFpOTE1LT52YnQuZHNpLnBwcykgeworCQlrZnJlZShpOTE1LT52YnQuZHNpLmNvbmZpZyk7CiAJ
CXJldHVybjsKIAl9CiAKLQlwYXJzZV9kc2lfYmFja2xpZ2h0X3BvcnRzKGRldl9wcml2LCBiZGIt
PnZlcnNpb24sIHBvcnQpOworCXBhcnNlX2RzaV9iYWNrbGlnaHRfcG9ydHMoaTkxNSwgYmRiLT52
ZXJzaW9uLCBwb3J0KTsKIAogCS8qIEZJWE1FIGlzIHRoZSA5MCB2cy4gMjcwIGNvcnJlY3Q/ICov
CiAJc3dpdGNoIChjb25maWctPnJvdGF0aW9uKSB7CkBAIC04OTIsMjUgKzg5MiwyNSBAQCBwYXJz
ZV9taXBpX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAqIE1v
c3QgKGFsbD8pIFZCVHMgY2xhaW0gMCBkZWdyZWVzIGRlc3BpdGUgaGF2aW5nCiAJCSAqIGFuIHVw
c2lkZSBkb3duIHBhbmVsLCB0aHVzIHdlIGRvIG5vdCB0cnVzdCB0aGlzLgogCQkgKi8KLQkJZGV2
X3ByaXYtPnZidC5kc2kub3JpZW50YXRpb24gPQorCQlpOTE1LT52YnQuZHNpLm9yaWVudGF0aW9u
ID0KIAkJCURSTV9NT0RFX1BBTkVMX09SSUVOVEFUSU9OX1VOS05PV047CiAJCWJyZWFrOwogCWNh
c2UgRU5BQkxFX1JPVEFUSU9OXzkwOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5vcmllbnRhdGlvbiA9
CisJCWk5MTUtPnZidC5kc2kub3JpZW50YXRpb24gPQogCQkJRFJNX01PREVfUEFORUxfT1JJRU5U
QVRJT05fUklHSFRfVVA7CiAJCWJyZWFrOwogCWNhc2UgRU5BQkxFX1JPVEFUSU9OXzE4MDoKLQkJ
ZGV2X3ByaXYtPnZidC5kc2kub3JpZW50YXRpb24gPQorCQlpOTE1LT52YnQuZHNpLm9yaWVudGF0
aW9uID0KIAkJCURSTV9NT0RFX1BBTkVMX09SSUVOVEFUSU9OX0JPVFRPTV9VUDsKIAkJYnJlYWs7
CiAJY2FzZSBFTkFCTEVfUk9UQVRJT05fMjcwOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5vcmllbnRh
dGlvbiA9CisJCWk5MTUtPnZidC5kc2kub3JpZW50YXRpb24gPQogCQkJRFJNX01PREVfUEFORUxf
T1JJRU5UQVRJT05fTEVGVF9VUDsKIAkJYnJlYWs7CiAJfQogCiAJLyogV2UgaGF2ZSBtYW5kYXRv
cnkgbWlwaSBjb25maWcgYmxvY2tzLiBJbml0aWFsaXplIGFzIGdlbmVyaWMgcGFuZWwgKi8KLQlk
ZXZfcHJpdi0+dmJ0LmRzaS5wYW5lbF9pZCA9IE1JUElfRFNJX0dFTkVSSUNfUEFORUxfSUQ7CisJ
aTkxNS0+dmJ0LmRzaS5wYW5lbF9pZCA9IE1JUElfRFNJX0dFTkVSSUNfUEFORUxfSUQ7CiB9CiAK
IC8qIEZpbmQgdGhlIHNlcXVlbmNlIGJsb2NrIGFuZCBzaXplIGZvciB0aGUgZ2l2ZW4gcGFuZWwu
ICovCkBAIC0xMDczLDEyICsxMDczLDEyIEBAIHN0YXRpYyBpbnQgZ290b19uZXh0X3NlcXVlbmNl
X3YzKGNvbnN0IHU4ICpkYXRhLCBpbnQgaW5kZXgsIGludCB0b3RhbCkKICAqIEdldCBsZW4gb2Yg
cHJlLWZpeGVkIGRlYXNzZXJ0IGZyYWdtZW50IGZyb20gYSB2MSBpbml0IE9UUCBzZXF1ZW5jZSwK
ICAqIHNraXAgYWxsIGRlbGF5ICsgZ3BpbyBvcGVyYW5kcyBhbmQgc3RvcCBhdCB0aGUgZmlyc3Qg
RFNJIHBhY2tldCBvcC4KICAqLwotc3RhdGljIGludCBnZXRfaW5pdF9vdHBfZGVhc3NlcnRfZnJh
Z21lbnRfbGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbnQg
Z2V0X2luaXRfb3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKLQljb25zdCB1OCAqZGF0YSA9IGRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNl
W01JUElfU0VRX0lOSVRfT1RQXTsKKwljb25zdCB1OCAqZGF0YSA9IGk5MTUtPnZidC5kc2kuc2Vx
dWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdOwogCWludCBpbmRleCwgbGVuOwogCi0JaWYgKFdBUk5f
T04oIWRhdGEgfHwgZGV2X3ByaXYtPnZidC5kc2kuc2VxX3ZlcnNpb24gIT0gMSkpCisJaWYgKFdB
Uk5fT04oIWRhdGEgfHwgaTkxNS0+dmJ0LmRzaS5zZXFfdmVyc2lvbiAhPSAxKSkKIAkJcmV0dXJu
IDA7CiAKIAkvKiBpbmRleCA9IDEgdG8gc2tpcCBzZXF1ZW5jZSBieXRlICovCkBAIC0xMTA2LDU0
ICsxMTA2LDU0IEBAIHN0YXRpYyBpbnQgZ2V0X2luaXRfb3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xl
bihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKiB0aGVzZSBkZXZpY2VzIHdl
IHNwbGl0IHRoZSBpbml0IE9UUCBzZXF1ZW5jZSBpbnRvIGEgZGVhc3NlcnQgc2VxdWVuY2UgYW5k
CiAgKiB0aGUgYWN0dWFsIGluaXQgT1RQIHBhcnQuCiAgKi8KLXN0YXRpYyB2b2lkIGZpeHVwX21p
cGlfc2VxdWVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIGZpeHVwX21pcGlfc2VxdWVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCXU4ICppbml0X290cDsKIAlpbnQgbGVuOwogCiAJLyogTGltaXQgdGhpcyB0byBWTFYgZm9y
IG5vdy4gKi8KLQlpZiAoIUlTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQorCWlmICghSVNfVkFMTEVZ
VklFVyhpOTE1KSkKIAkJcmV0dXJuOwogCiAJLyogTGltaXQgdGhpcyB0byB2MSB2aWQtbW9kZSBz
ZXF1ZW5jZXMgKi8KLQlpZiAoZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnLT5pc19jbWRfbW9kZSB8
fAotCSAgICBkZXZfcHJpdi0+dmJ0LmRzaS5zZXFfdmVyc2lvbiAhPSAxKQorCWlmIChpOTE1LT52
YnQuZHNpLmNvbmZpZy0+aXNfY21kX21vZGUgfHwKKwkgICAgaTkxNS0+dmJ0LmRzaS5zZXFfdmVy
c2lvbiAhPSAxKQogCQlyZXR1cm47CiAKIAkvKiBPbmx5IGRvIHRoaXMgaWYgdGhlcmUgYXJlIG90
cCBhbmQgYXNzZXJ0IHNlcXMgYW5kIG5vIGRlYXNzZXJ0IHNlcSAqLwotCWlmICghZGV2X3ByaXYt
PnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdIHx8Ci0JICAgICFkZXZfcHJpdi0+
dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJX1NFUV9BU1NFUlRfUkVTRVRdIHx8Ci0JICAgIGRldl9wcml2
LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0RFQVNTRVJUX1JFU0VUXSkKKwlpZiAoIWk5MTUt
PnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdIHx8CisJICAgICFpOTE1LT52YnQu
ZHNpLnNlcXVlbmNlW01JUElfU0VRX0FTU0VSVF9SRVNFVF0gfHwKKwkgICAgaTkxNS0+dmJ0LmRz
aS5zZXF1ZW5jZVtNSVBJX1NFUV9ERUFTU0VSVF9SRVNFVF0pCiAJCXJldHVybjsKIAogCS8qIFRo
ZSBkZWFzc2VydC1zZXF1ZW5jZSBlbmRzIGF0IHRoZSBmaXJzdCBEU0kgcGFja2V0ICovCi0JbGVu
ID0gZ2V0X2luaXRfb3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xlbihkZXZfcHJpdik7CisJbGVuID0g
Z2V0X2luaXRfb3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xlbihpOTE1KTsKIAlpZiAoIWxlbikKIAkJ
cmV0dXJuOwogCiAJRFJNX0RFQlVHX0tNUygiVXNpbmcgaW5pdCBPVFAgZnJhZ21lbnQgdG8gZGVh
c3NlcnQgcmVzZXRcbiIpOwogCiAJLyogQ29weSB0aGUgZnJhZ21lbnQsIHVwZGF0ZSBzZXEgYnl0
ZSBhbmQgdGVybWluYXRlIGl0ICovCi0JaW5pdF9vdHAgPSAodTggKilkZXZfcHJpdi0+dmJ0LmRz
aS5zZXF1ZW5jZVtNSVBJX1NFUV9JTklUX09UUF07Ci0JZGV2X3ByaXYtPnZidC5kc2kuZGVhc3Nl
cnRfc2VxID0ga21lbWR1cChpbml0X290cCwgbGVuICsgMSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFk
ZXZfcHJpdi0+dmJ0LmRzaS5kZWFzc2VydF9zZXEpCisJaW5pdF9vdHAgPSAodTggKilpOTE1LT52
YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0lOSVRfT1RQXTsKKwlpOTE1LT52YnQuZHNpLmRlYXNz
ZXJ0X3NlcSA9IGttZW1kdXAoaW5pdF9vdHAsIGxlbiArIDEsIEdGUF9LRVJORUwpOworCWlmICgh
aTkxNS0+dmJ0LmRzaS5kZWFzc2VydF9zZXEpCiAJCXJldHVybjsKLQlkZXZfcHJpdi0+dmJ0LmRz
aS5kZWFzc2VydF9zZXFbMF0gPSBNSVBJX1NFUV9ERUFTU0VSVF9SRVNFVDsKLQlkZXZfcHJpdi0+
dmJ0LmRzaS5kZWFzc2VydF9zZXFbbGVuXSA9IE1JUElfU0VRX0VMRU1fRU5EOworCWk5MTUtPnZi
dC5kc2kuZGVhc3NlcnRfc2VxWzBdID0gTUlQSV9TRVFfREVBU1NFUlRfUkVTRVQ7CisJaTkxNS0+
dmJ0LmRzaS5kZWFzc2VydF9zZXFbbGVuXSA9IE1JUElfU0VRX0VMRU1fRU5EOwogCS8qIFVzZSB0
aGUgY29weSBmb3IgZGVhc3NlcnQgKi8KLQlkZXZfcHJpdi0+dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJ
X1NFUV9ERUFTU0VSVF9SRVNFVF0gPQotCQlkZXZfcHJpdi0+dmJ0LmRzaS5kZWFzc2VydF9zZXE7
CisJaTkxNS0+dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJX1NFUV9ERUFTU0VSVF9SRVNFVF0gPQorCQlp
OTE1LT52YnQuZHNpLmRlYXNzZXJ0X3NlcTsKIAkvKiBSZXBsYWNlIHRoZSBsYXN0IGJ5dGUgb2Yg
dGhlIGZyYWdtZW50IHdpdGggaW5pdCBPVFAgc2VxIGJ5dGUgKi8KIAlpbml0X290cFtsZW4gLSAx
XSA9IE1JUElfU0VRX0lOSVRfT1RQOwogCS8qIEFuZCBtYWtlIE1JUElfTUlQSV9TRVFfSU5JVF9P
VFAgcG9pbnQgdG8gaXQgKi8KLQlkZXZfcHJpdi0+dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJX1NFUV9J
TklUX09UUF0gPSBpbml0X290cCArIGxlbiAtIDE7CisJaTkxNS0+dmJ0LmRzaS5zZXF1ZW5jZVtN
SVBJX1NFUV9JTklUX09UUF0gPSBpbml0X290cCArIGxlbiAtIDE7CiB9CiAKIHN0YXRpYyB2b2lk
Ci1wYXJzZV9taXBpX3NlcXVlbmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3BhcnNlX21pcGlfc2VxdWVuY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAg
ICBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewotCWludCBwYW5lbF90eXBlID0gZGV2
X3ByaXYtPnZidC5wYW5lbF90eXBlOworCWludCBwYW5lbF90eXBlID0gaTkxNS0+dmJ0LnBhbmVs
X3R5cGU7CiAJY29uc3Qgc3RydWN0IGJkYl9taXBpX3NlcXVlbmNlICpzZXF1ZW5jZTsKIAljb25z
dCB1OCAqc2VxX2RhdGE7CiAJdTMyIHNlcV9zaXplOwpAQCAtMTE2MSw3ICsxMTYxLDcgQEAgcGFy
c2VfbWlwaV9zZXF1ZW5jZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaW50
IGluZGV4ID0gMDsKIAogCS8qIE9ubHkgb3VyIGdlbmVyaWMgcGFuZWwgZHJpdmVyIHVzZXMgdGhl
IHNlcXVlbmNlIGJsb2NrLiAqLwotCWlmIChkZXZfcHJpdi0+dmJ0LmRzaS5wYW5lbF9pZCAhPSBN
SVBJX0RTSV9HRU5FUklDX1BBTkVMX0lEKQorCWlmIChpOTE1LT52YnQuZHNpLnBhbmVsX2lkICE9
IE1JUElfRFNJX0dFTkVSSUNfUEFORUxfSUQpCiAJCXJldHVybjsKIAogCXNlcXVlbmNlID0gZmlu
ZF9zZWN0aW9uKGJkYiwgQkRCX01JUElfU0VRVUVOQ0UpOwpAQCAtMTIwMiw3ICsxMjAyLDcgQEAg
cGFyc2VfbWlwaV9zZXF1ZW5jZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
CWlmIChzZXFfaWQgPT0gTUlQSV9TRVFfVEVBUl9PTiB8fCBzZXFfaWQgPT0gTUlQSV9TRVFfVEVB
Ul9PRkYpCiAJCQlEUk1fREVCVUdfS01TKCJVbnN1cHBvcnRlZCBzZXF1ZW5jZSAldVxuIiwgc2Vx
X2lkKTsKIAotCQlkZXZfcHJpdi0+dmJ0LmRzaS5zZXF1ZW5jZVtzZXFfaWRdID0gZGF0YSArIGlu
ZGV4OworCQlpOTE1LT52YnQuZHNpLnNlcXVlbmNlW3NlcV9pZF0gPSBkYXRhICsgaW5kZXg7CiAK
IAkJaWYgKHNlcXVlbmNlLT52ZXJzaW9uID49IDMpCiAJCQlpbmRleCA9IGdvdG9fbmV4dF9zZXF1
ZW5jZV92MyhkYXRhLCBpbmRleCwgc2VxX3NpemUpOwpAQCAtMTIxNCwxOCArMTIxNCwxOCBAQCBw
YXJzZV9taXBpX3NlcXVlbmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJ
fQogCX0KIAotCWRldl9wcml2LT52YnQuZHNpLmRhdGEgPSBkYXRhOwotCWRldl9wcml2LT52YnQu
ZHNpLnNpemUgPSBzZXFfc2l6ZTsKLQlkZXZfcHJpdi0+dmJ0LmRzaS5zZXFfdmVyc2lvbiA9IHNl
cXVlbmNlLT52ZXJzaW9uOworCWk5MTUtPnZidC5kc2kuZGF0YSA9IGRhdGE7CisJaTkxNS0+dmJ0
LmRzaS5zaXplID0gc2VxX3NpemU7CisJaTkxNS0+dmJ0LmRzaS5zZXFfdmVyc2lvbiA9IHNlcXVl
bmNlLT52ZXJzaW9uOwogCi0JZml4dXBfbWlwaV9zZXF1ZW5jZXMoZGV2X3ByaXYpOworCWZpeHVw
X21pcGlfc2VxdWVuY2VzKGk5MTUpOwogCiAJRFJNX0RFQlVHX0RSSVZFUigiTUlQSSByZWxhdGVk
IFZCVCBwYXJzaW5nIGNvbXBsZXRlXG4iKTsKIAlyZXR1cm47CiAKIGVycjoKIAlrZnJlZShkYXRh
KTsKLQltZW1zZXQoZGV2X3ByaXYtPnZidC5kc2kuc2VxdWVuY2UsIDAsIHNpemVvZihkZXZfcHJp
di0+dmJ0LmRzaS5zZXF1ZW5jZSkpOworCW1lbXNldChpOTE1LT52YnQuZHNpLnNlcXVlbmNlLCAw
LCBzaXplb2YoaTkxNS0+dmJ0LmRzaS5zZXF1ZW5jZSkpOwogfQogCiBzdGF0aWMgdTggdHJhbnNs
YXRlX2lib29zdCh1OCB2YWwpCkBAIC0xMjU0LDE2ICsxMjU0LDE2IEBAIHN0YXRpYyBlbnVtIHBv
cnQgZ2V0X3BvcnRfYnlfZGRjX3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTgg
ZGRjX3BpbikKIAlyZXR1cm4gUE9SVF9OT05FOwogfQogCi1zdGF0aWMgdm9pZCBzYW5pdGl6ZV9k
ZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHNh
bml0aXplX2RkY19waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgIGVu
dW0gcG9ydCBwb3J0KQogewotCXN0cnVjdCBkZGlfdmJ0X3BvcnRfaW5mbyAqaW5mbyA9ICZkZXZf
cHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CisJc3RydWN0IGRkaV92YnRfcG9ydF9pbmZv
ICppbmZvID0gJmk5MTUtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOwogCWVudW0gcG9ydCBwOwog
CiAJaWYgKCFpbmZvLT5hbHRlcm5hdGVfZGRjX3BpbikKIAkJcmV0dXJuOwogCi0JcCA9IGdldF9w
b3J0X2J5X2RkY19waW4oZGV2X3ByaXYsIGluZm8tPmFsdGVybmF0ZV9kZGNfcGluKTsKKwlwID0g
Z2V0X3BvcnRfYnlfZGRjX3BpbihpOTE1LCBpbmZvLT5hbHRlcm5hdGVfZGRjX3Bpbik7CiAJaWYg
KHAgIT0gUE9SVF9OT05FKSB7CiAJCURSTV9ERUJVR19LTVMoInBvcnQgJWMgdHJ5aW5nIHRvIHVz
ZSB0aGUgc2FtZSBEREMgcGluICgweCV4KSBhcyBwb3J0ICVjLCAiCiAJCQkgICAgICAiZGlzYWJs
aW5nIHBvcnQgJWMgRFZJL0hETUkgc3VwcG9ydFxuIiwKQEAgLTEzMDAsMTYgKzEzMDAsMTYgQEAg
c3RhdGljIGVudW0gcG9ydCBnZXRfcG9ydF9ieV9hdXhfY2goc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIHU4IGF1eF9jaCkKIAlyZXR1cm4gUE9SVF9OT05FOwogfQogCi1zdGF0aWMgdm9p
ZCBzYW5pdGl6ZV9hdXhfY2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIHZvaWQgc2FuaXRpemVfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJICAgIGVudW0gcG9ydCBwb3J0KQogewotCXN0cnVjdCBkZGlfdmJ0X3BvcnRfaW5mbyAqaW5m
byA9ICZkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CisJc3RydWN0IGRkaV92YnRf
cG9ydF9pbmZvICppbmZvID0gJmk5MTUtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOwogCWVudW0g
cG9ydCBwOwogCiAJaWYgKCFpbmZvLT5hbHRlcm5hdGVfYXV4X2NoYW5uZWwpCiAJCXJldHVybjsK
IAotCXAgPSBnZXRfcG9ydF9ieV9hdXhfY2goZGV2X3ByaXYsIGluZm8tPmFsdGVybmF0ZV9hdXhf
Y2hhbm5lbCk7CisJcCA9IGdldF9wb3J0X2J5X2F1eF9jaChpOTE1LCBpbmZvLT5hbHRlcm5hdGVf
YXV4X2NoYW5uZWwpOwogCWlmIChwICE9IFBPUlRfTk9ORSkgewogCQlEUk1fREVCVUdfS01TKCJw
b3J0ICVjIHRyeWluZyB0byB1c2UgdGhlIHNhbWUgQVVYIENIICgweCV4KSBhcyBwb3J0ICVjLCAi
CiAJCQkgICAgICAiZGlzYWJsaW5nIHBvcnQgJWMgRFAgc3VwcG9ydFxuIiwKQEAgLTEzNDcsMTUg
KzEzNDcsMTUgQEAgc3RhdGljIGNvbnN0IHU4IGljcF9kZGNfcGluX21hcFtdID0gewogCVtJQ0xf
RERDX0JVU19QT1JUXzRdID0gR01CVVNfUElOXzEyX1RDNF9JQ1AsCiB9OwogCi1zdGF0aWMgdTgg
bWFwX2RkY19waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCB2YnRfcGlu
KQorc3RhdGljIHU4IG1hcF9kZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1
OCB2YnRfcGluKQogewogCWNvbnN0IHU4ICpkZGNfcGluX21hcDsKIAlpbnQgbl9lbnRyaWVzOwog
Ci0JaWYgKEhBU19QQ0hfSUNQKGRldl9wcml2KSkgeworCWlmIChIQVNfUENIX0lDUChpOTE1KSkg
ewogCQlkZGNfcGluX21hcCA9IGljcF9kZGNfcGluX21hcDsKIAkJbl9lbnRyaWVzID0gQVJSQVlf
U0laRShpY3BfZGRjX3Bpbl9tYXApOwotCX0gZWxzZSBpZiAoSEFTX1BDSF9DTlAoZGV2X3ByaXYp
KSB7CisJfSBlbHNlIGlmIChIQVNfUENIX0NOUChpOTE1KSkgewogCQlkZGNfcGluX21hcCA9IGNu
cF9kZGNfcGluX21hcDsKIAkJbl9lbnRyaWVzID0gQVJSQVlfU0laRShjbnBfZGRjX3Bpbl9tYXAp
OwogCX0gZWxzZSB7CkBAIC0xNDAxLDcgKzE0MDEsNyBAQCBzdGF0aWMgZW51bSBwb3J0IGR2b19w
b3J0X3RvX3BvcnQodTggZHZvX3BvcnQpCiAJcmV0dXJuIFBPUlRfTk9ORTsKIH0KIAotc3RhdGlj
IHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkgICBjb25zdCBzdHJ1Y3QgY2hpbGRfZGV2aWNlX2NvbmZpZyAqY2hpbGQsCiAJCQkgICB1
OCBiZGJfdmVyc2lvbikKIHsKQEAgLTE0MTMsNyArMTQxMyw3IEBAIHN0YXRpYyB2b2lkIHBhcnNl
X2RkaV9wb3J0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAocG9ydCA9
PSBQT1JUX05PTkUpCiAJCXJldHVybjsKIAotCWluZm8gPSAmZGV2X3ByaXYtPnZidC5kZGlfcG9y
dF9pbmZvW3BvcnRdOworCWluZm8gPSAmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CiAK
IAlpZiAoaW5mby0+Y2hpbGQpIHsKIAkJRFJNX0RFQlVHX0tNUygiTW9yZSB0aGFuIG9uZSBjaGls
ZCBkZXZpY2UgZm9yIHBvcnQgJWMgaW4gVkJULCB1c2luZyB0aGUgZmlyc3QuXG4iLApAQCAtMTQ0
Nyw3ICsxNDQ3LDcgQEAgc3RhdGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCiAJRFJNX0RFQlVHX0tNUygiUG9ydCAlYyBWQlQgaW5mbzog
Q1JUOiVkIERWSTolZCBIRE1JOiVkIERQOiVkIGVEUDolZCBMU1BDT046JWQgVVNCLVR5cGUtQzol
ZCBUQlQ6JWRcbiIsCiAJCSAgICAgIHBvcnRfbmFtZShwb3J0KSwgaXNfY3J0LCBpc19kdmksIGlz
X2hkbWksIGlzX2RwLCBpc19lZHAsCi0JCSAgICAgIEhBU19MU1BDT04oZGV2X3ByaXYpICYmIGNo
aWxkLT5sc3Bjb24sCisJCSAgICAgIEhBU19MU1BDT04oaTkxNSkgJiYgY2hpbGQtPmxzcGNvbiwK
IAkJICAgICAgaW5mby0+c3VwcG9ydHNfdHlwZWNfdXNiLCBpbmZvLT5zdXBwb3J0c190YnQpOwog
CiAJaWYgKGlzX2VkcCAmJiBpc19kdmkpCkBAIC0xNDY5LDEwICsxNDY5LDEwIEBAIHN0YXRpYyB2
b2lkIHBhcnNlX2RkaV9wb3J0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlp
ZiAoaXNfZHZpKSB7CiAJCXU4IGRkY19waW47CiAKLQkJZGRjX3BpbiA9IG1hcF9kZGNfcGluKGRl
dl9wcml2LCBjaGlsZC0+ZGRjX3Bpbik7Ci0JCWlmIChpbnRlbF9nbWJ1c19pc192YWxpZF9waW4o
ZGV2X3ByaXYsIGRkY19waW4pKSB7CisJCWRkY19waW4gPSBtYXBfZGRjX3BpbihpOTE1LCBjaGls
ZC0+ZGRjX3Bpbik7CisJCWlmIChpbnRlbF9nbWJ1c19pc192YWxpZF9waW4oaTkxNSwgZGRjX3Bp
bikpIHsKIAkJCWluZm8tPmFsdGVybmF0ZV9kZGNfcGluID0gZGRjX3BpbjsKLQkJCXNhbml0aXpl
X2RkY19waW4oZGV2X3ByaXYsIHBvcnQpOworCQkJc2FuaXRpemVfZGRjX3BpbihpOTE1LCBwb3J0
KTsKIAkJfSBlbHNlIHsKIAkJCURSTV9ERUJVR19LTVMoIlBvcnQgJWMgaGFzIGludmFsaWQgRERD
IHBpbiAlZCwgIgogCQkJCSAgICAgICJzdGlja2luZyB0byBkZWZhdWx0c1xuIiwKQEAgLTE0ODMs
NyArMTQ4Myw3IEBAIHN0YXRpYyB2b2lkIHBhcnNlX2RkaV9wb3J0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAlpZiAoaXNfZHApIHsKIAkJaW5mby0+YWx0ZXJuYXRlX2F1eF9j
aGFubmVsID0gY2hpbGQtPmF1eF9jaGFubmVsOwogCi0JCXNhbml0aXplX2F1eF9jaChkZXZfcHJp
diwgcG9ydCk7CisJCXNhbml0aXplX2F1eF9jaChpOTE1LCBwb3J0KTsKIAl9CiAKIAlpZiAoYmRi
X3ZlcnNpb24gPj0gMTU4KSB7CkBAIC0xNTUzLDI2ICsxNTUzLDI2IEBAIHN0YXRpYyB2b2lkIHBh
cnNlX2RkaV9wb3J0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpbmZvLT5j
aGlsZCA9IGNoaWxkOwogfQogCi1zdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydHMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJfdmVyc2lvbikKK3N0YXRpYyB2b2lkIHBh
cnNlX2RkaV9wb3J0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTggYmRiX3ZlcnNp
b24pCiB7CiAJY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZV9jb25maWcgKmNoaWxkOwogCWludCBp
OwogCi0JaWYgKCFIQVNfRERJKGRldl9wcml2KSAmJiAhSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikp
CisJaWYgKCFIQVNfRERJKGk5MTUpICYmICFJU19DSEVSUllWSUVXKGk5MTUpKQogCQlyZXR1cm47
CiAKIAlpZiAoYmRiX3ZlcnNpb24gPCAxNTUpCiAJCXJldHVybjsKIAotCWZvciAoaSA9IDA7IGkg
PCBkZXZfcHJpdi0+dmJ0LmNoaWxkX2Rldl9udW07IGkrKykgewotCQljaGlsZCA9IGRldl9wcml2
LT52YnQuY2hpbGRfZGV2ICsgaTsKKwlmb3IgKGkgPSAwOyBpIDwgaTkxNS0+dmJ0LmNoaWxkX2Rl
dl9udW07IGkrKykgeworCQljaGlsZCA9IGk5MTUtPnZidC5jaGlsZF9kZXYgKyBpOwogCi0JCXBh
cnNlX2RkaV9wb3J0KGRldl9wcml2LCBjaGlsZCwgYmRiX3ZlcnNpb24pOworCQlwYXJzZV9kZGlf
cG9ydChpOTE1LCBjaGlsZCwgYmRiX3ZlcnNpb24pOwogCX0KIH0KIAogc3RhdGljIHZvaWQKLXBh
cnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorcGFyc2VfZ2VuZXJhbF9kZWZpbml0aW9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCSAgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1Y3Qg
YmRiX2dlbmVyYWxfZGVmaW5pdGlvbnMgKmRlZnM7CkBAIC0xNTk3LDggKzE1OTcsOCBAQCBwYXJz
ZV9nZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAogCWJ1c19waW4gPSBkZWZzLT5jcnRfZGRjX2dtYnVzX3BpbjsKIAlEUk1fREVCVUdfS01TKCJj
cnRfZGRjX2J1c19waW46ICVkXG4iLCBidXNfcGluKTsKLQlpZiAoaW50ZWxfZ21idXNfaXNfdmFs
aWRfcGluKGRldl9wcml2LCBidXNfcGluKSkKLQkJZGV2X3ByaXYtPnZidC5jcnRfZGRjX3BpbiA9
IGJ1c19waW47CisJaWYgKGludGVsX2dtYnVzX2lzX3ZhbGlkX3BpbihpOTE1LCBidXNfcGluKSkK
KwkJaTkxNS0+dmJ0LmNydF9kZGNfcGluID0gYnVzX3BpbjsKIAogCWlmIChiZGItPnZlcnNpb24g
PCAxMDYpIHsKIAkJZXhwZWN0ZWRfc2l6ZSA9IDIyOwpAQCAtMTY0NSwxMyArMTY0NSwxMyBAQCBw
YXJzZV9nZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJRFJNX0RFQlVHX0tNUygibm8gY2hpbGQgZGV2IGlzIHBhcnNlZCBmcm9tIFZCVFxuIik7
CiAJCXJldHVybjsKIAl9Ci0JZGV2X3ByaXYtPnZidC5jaGlsZF9kZXYgPSBrY2FsbG9jKGNvdW50
LCBzaXplb2YoKmNoaWxkKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFkZXZfcHJpdi0+dmJ0LmNoaWxk
X2RldikgeworCWk5MTUtPnZidC5jaGlsZF9kZXYgPSBrY2FsbG9jKGNvdW50LCBzaXplb2YoKmNo
aWxkKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFpOTE1LT52YnQuY2hpbGRfZGV2KSB7CiAJCURSTV9E
RUJVR19LTVMoIk5vIG1lbW9yeSBzcGFjZSBmb3IgY2hpbGQgZGV2aWNlXG4iKTsKIAkJcmV0dXJu
OwogCX0KIAotCWRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bSA9IGNvdW50OworCWk5MTUtPnZi
dC5jaGlsZF9kZXZfbnVtID0gY291bnQ7CiAJY291bnQgPSAwOwogCWZvciAoaSA9IDA7IGkgPCBj
aGlsZF9kZXZpY2VfbnVtOyBpKyspIHsKIAkJY2hpbGQgPSBjaGlsZF9kZXZpY2VfcHRyKGRlZnMs
IGkpOwpAQCAtMTY2Myw3ICsxNjYzLDcgQEAgcGFyc2VfZ2VuZXJhbF9kZWZpbml0aW9ucyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAqIChjaGlsZF9kZXZfc2l6ZSkgb2Yg
dGhlIGNoaWxkIGRldmljZS4gQWNjZXNzaW5nIHRoZSBkYXRhIG11c3QKIAkJICogZGVwZW5kIG9u
IFZCVCB2ZXJzaW9uLgogCQkgKi8KLQkJbWVtY3B5KGRldl9wcml2LT52YnQuY2hpbGRfZGV2ICsg
Y291bnQsIGNoaWxkLAorCQltZW1jcHkoaTkxNS0+dmJ0LmNoaWxkX2RldiArIGNvdW50LCBjaGls
ZCwKIAkJICAgICAgIG1pbl90KHNpemVfdCwgZGVmcy0+Y2hpbGRfZGV2X3NpemUsIHNpemVvZigq
Y2hpbGQpKSk7CiAJCWNvdW50Kys7CiAJfQpAQCAtMTY3MSw0MSArMTY3MSw0MSBAQCBwYXJzZV9n
ZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAog
LyogQ29tbW9uIGRlZmF1bHRzIHdoaWNoIG1heSBiZSBvdmVycmlkZGVuIGJ5IFZCVC4gKi8KIHN0
YXRpYyB2b2lkCi1pbml0X3ZidF9kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitpbml0X3ZidF9kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAllbnVtIHBvcnQgcG9ydDsKIAotCWRldl9wcml2LT52YnQuY3J0X2RkY19waW4gPSBHTUJV
U19QSU5fVkdBRERDOworCWk5MTUtPnZidC5jcnRfZGRjX3BpbiA9IEdNQlVTX1BJTl9WR0FEREM7
CiAKIAkvKiBEZWZhdWx0IHRvIGhhdmluZyBiYWNrbGlnaHQgKi8KLQlkZXZfcHJpdi0+dmJ0LmJh
Y2tsaWdodC5wcmVzZW50ID0gdHJ1ZTsKKwlpOTE1LT52YnQuYmFja2xpZ2h0LnByZXNlbnQgPSB0
cnVlOwogCiAJLyogTEZQIHBhbmVsIGRhdGEgKi8KLQlkZXZfcHJpdi0+dmJ0Lmx2ZHNfZGl0aGVy
ID0gMTsKKwlpOTE1LT52YnQubHZkc19kaXRoZXIgPSAxOwogCiAJLyogU0RWTyBwYW5lbCBkYXRh
ICovCi0JZGV2X3ByaXYtPnZidC5zZHZvX2x2ZHNfdmJ0X21vZGUgPSBOVUxMOworCWk5MTUtPnZi
dC5zZHZvX2x2ZHNfdmJ0X21vZGUgPSBOVUxMOwogCiAJLyogZ2VuZXJhbCBmZWF0dXJlcyAqLwot
CWRldl9wcml2LT52YnQuaW50X3R2X3N1cHBvcnQgPSAxOwotCWRldl9wcml2LT52YnQuaW50X2Ny
dF9zdXBwb3J0ID0gMTsKKwlpOTE1LT52YnQuaW50X3R2X3N1cHBvcnQgPSAxOworCWk5MTUtPnZi
dC5pbnRfY3J0X3N1cHBvcnQgPSAxOwogCiAJLyogZHJpdmVyIGZlYXR1cmVzICovCi0JZGV2X3By
aXYtPnZidC5pbnRfbHZkc19zdXBwb3J0ID0gMTsKKwlpOTE1LT52YnQuaW50X2x2ZHNfc3VwcG9y
dCA9IDE7CiAKIAkvKiBEZWZhdWx0IHRvIHVzaW5nIFNTQyAqLwotCWRldl9wcml2LT52YnQubHZk
c191c2Vfc3NjID0gMTsKKwlpOTE1LT52YnQubHZkc191c2Vfc3NjID0gMTsKIAkvKgogCSAqIENv
cmUvU2FuZHlCcmlkZ2UvSXZ5QnJpZGdlIHVzZSBhbHRlcm5hdGl2ZSAoMTIwTUh6KSByZWZlcmVu
Y2UKIAkgKiBjbG9jayBmb3IgTFZEUy4KIAkgKi8KLQlkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2Zy
ZXEgPSBpbnRlbF9iaW9zX3NzY19mcmVxdWVuY3koZGV2X3ByaXYsCi0JCQkhSEFTX1BDSF9TUExJ
VChkZXZfcHJpdikpOwotCURSTV9ERUJVR19LTVMoIlNldCBkZWZhdWx0IHRvIFNTQyBhdCAlZCBr
SHpcbiIsIGRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcSk7CisJaTkxNS0+dmJ0Lmx2ZHNfc3Nj
X2ZyZXEgPSBpbnRlbF9iaW9zX3NzY19mcmVxdWVuY3koaTkxNSwKKwkJCSFIQVNfUENIX1NQTElU
KGk5MTUpKTsKKwlEUk1fREVCVUdfS01TKCJTZXQgZGVmYXVsdCB0byBTU0MgYXQgJWQga0h6XG4i
LCBpOTE1LT52YnQubHZkc19zc2NfZnJlcSk7CiAKIAlmb3IgKHBvcnQgPSBQT1JUX0E7IHBvcnQg
PCBJOTE1X01BWF9QT1JUUzsgcG9ydCsrKSB7CiAJCXN0cnVjdCBkZGlfdmJ0X3BvcnRfaW5mbyAq
aW5mbyA9Ci0JCQkmZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOworCQkJJmk5MTUt
PnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOwogCiAJCWluZm8tPmhkbWlfbGV2ZWxfc2hpZnQgPSBI
RE1JX0xFVkVMX1NISUZUX1VOS05PV047CiAJfQpAQCAtMTcxMywxOSArMTcxMywxOSBAQCBpbml0
X3ZidF9kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIC8qIERl
ZmF1bHRzIHRvIGluaXRpYWxpemUgb25seSBpZiB0aGVyZSBpcyBubyBWQlQuICovCiBzdGF0aWMg
dm9pZAotaW5pdF92YnRfbWlzc2luZ19kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitpbml0X3ZidF9taXNzaW5nX2RlZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCWVudW0gcG9ydCBwb3J0OwogCiAJZm9yIChwb3J0ID0gUE9SVF9BOyBw
b3J0IDwgSTkxNV9NQVhfUE9SVFM7IHBvcnQrKykgewogCQlzdHJ1Y3QgZGRpX3ZidF9wb3J0X2lu
Zm8gKmluZm8gPQotCQkJJmRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKKwkJCSZp
OTE1LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKIAogCQkvKgogCQkgKiBWQlQgaGFzIHRoZSBU
eXBlQyBtb2RlIChuYXRpdmUsVEJUL1VTQikgYW5kIHdlIGRvbid0IHdhbnQKIAkJICogdG8gZGV0
ZWN0IGl0LgogCQkgKi8KLQkJaWYgKGludGVsX3BvcnRfaXNfdGMoZGV2X3ByaXYsIHBvcnQpKQor
CQlpZiAoaW50ZWxfcG9ydF9pc190YyhpOTE1LCBwb3J0KSkKIAkJCWNvbnRpbnVlOwogCiAJCWlu
Zm8tPnN1cHBvcnRzX2R2aSA9IChwb3J0ICE9IFBPUlRfQSAmJiBwb3J0ICE9IFBPUlRfRSk7CkBA
IC0xODExLDI1ICsxODExLDI1IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgdmJ0X2hlYWRlciAqZmlu
ZF92YnQodm9pZCBfX2lvbWVtICpiaW9zLCBzaXplX3Qgc2l6ZSkKIAogLyoqCiAgKiBpbnRlbF9i
aW9zX2luaXQgLSBmaW5kIFZCVCBhbmQgaW5pdGlhbGl6ZSBzZXR0aW5ncyBmcm9tIHRoZSBCSU9T
Ci0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZp
Y2UgaW5zdGFuY2UKICAqCiAgKiBQYXJzZSBhbmQgaW5pdGlhbGl6ZSBzZXR0aW5ncyBmcm9tIHRo
ZSBWaWRlbyBCSU9TIFRhYmxlcyAoVkJUKS4gSWYgdGhlIFZCVAogICogd2FzIG5vdCBmb3VuZCBp
biBBQ1BJIE9wUmVnaW9uLCB0cnkgdG8gZmluZCBpdCBpbiBQQ0kgUk9NIGZpcnN0LiBBbHNvCiAg
KiBpbml0aWFsaXplIHNvbWUgZGVmYXVsdHMgaWYgdGhlIFZCVCBpcyBub3QgcHJlc2VudCBhdCBh
bGwuCiAgKi8KLXZvaWQgaW50ZWxfYmlvc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3ZvaWQgaW50ZWxfYmlvc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OwotCWNv
bnN0IHN0cnVjdCB2YnRfaGVhZGVyICp2YnQgPSBkZXZfcHJpdi0+b3ByZWdpb24udmJ0OworCXN0
cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CisJY29uc3Qgc3RydWN0IHZidF9o
ZWFkZXIgKnZidCA9IGk5MTUtPm9wcmVnaW9uLnZidDsKIAljb25zdCBzdHJ1Y3QgYmRiX2hlYWRl
ciAqYmRiOwogCXU4IF9faW9tZW0gKmJpb3MgPSBOVUxMOwogCi0JaWYgKCFIQVNfRElTUExBWShk
ZXZfcHJpdikpIHsKKwlpZiAoIUhBU19ESVNQTEFZKGk5MTUpKSB7CiAJCURSTV9ERUJVR19LTVMo
IlNraXBwaW5nIFZCVCBpbml0IGR1ZSB0byBkaXNhYmxlZCBkaXNwbGF5LlxuIik7CiAJCXJldHVy
bjsKIAl9CiAKLQlpbml0X3ZidF9kZWZhdWx0cyhkZXZfcHJpdik7CisJaW5pdF92YnRfZGVmYXVs
dHMoaTkxNSk7CiAKIAkvKiBJZiB0aGUgT3BSZWdpb24gZG9lcyBub3QgaGF2ZSBWQlQsIGxvb2sg
aW4gUENJIFJPTS4gKi8KIAlpZiAoIXZidCkgewpAQCAtMTg1MiwyNSArMTg1MiwyNSBAQCB2b2lk
IGludGVsX2Jpb3NfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAg
ICAgIChpbnQpc2l6ZW9mKHZidC0+c2lnbmF0dXJlKSwgdmJ0LT5zaWduYXR1cmUsIGJkYi0+dmVy
c2lvbik7CiAKIAkvKiBHcmFiIHVzZWZ1bCBnZW5lcmFsIGRlZmluaXRpb25zICovCi0JcGFyc2Vf
Z2VuZXJhbF9mZWF0dXJlcyhkZXZfcHJpdiwgYmRiKTsKLQlwYXJzZV9nZW5lcmFsX2RlZmluaXRp
b25zKGRldl9wcml2LCBiZGIpOwotCXBhcnNlX2xmcF9wYW5lbF9kYXRhKGRldl9wcml2LCBiZGIp
OwotCXBhcnNlX2xmcF9iYWNrbGlnaHQoZGV2X3ByaXYsIGJkYik7Ci0JcGFyc2Vfc2R2b19wYW5l
bF9kYXRhKGRldl9wcml2LCBiZGIpOwotCXBhcnNlX2RyaXZlcl9mZWF0dXJlcyhkZXZfcHJpdiwg
YmRiKTsKLQlwYXJzZV9lZHAoZGV2X3ByaXYsIGJkYik7Ci0JcGFyc2VfcHNyKGRldl9wcml2LCBi
ZGIpOwotCXBhcnNlX21pcGlfY29uZmlnKGRldl9wcml2LCBiZGIpOwotCXBhcnNlX21pcGlfc2Vx
dWVuY2UoZGV2X3ByaXYsIGJkYik7CisJcGFyc2VfZ2VuZXJhbF9mZWF0dXJlcyhpOTE1LCBiZGIp
OworCXBhcnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoaTkxNSwgYmRiKTsKKwlwYXJzZV9sZnBfcGFu
ZWxfZGF0YShpOTE1LCBiZGIpOworCXBhcnNlX2xmcF9iYWNrbGlnaHQoaTkxNSwgYmRiKTsKKwlw
YXJzZV9zZHZvX3BhbmVsX2RhdGEoaTkxNSwgYmRiKTsKKwlwYXJzZV9kcml2ZXJfZmVhdHVyZXMo
aTkxNSwgYmRiKTsKKwlwYXJzZV9lZHAoaTkxNSwgYmRiKTsKKwlwYXJzZV9wc3IoaTkxNSwgYmRi
KTsKKwlwYXJzZV9taXBpX2NvbmZpZyhpOTE1LCBiZGIpOworCXBhcnNlX21pcGlfc2VxdWVuY2Uo
aTkxNSwgYmRiKTsKIAogCS8qIEZ1cnRoZXIgcHJvY2Vzc2luZyBvbiBwcmUtcGFyc2VkIGRhdGEg
Ki8KLQlwYXJzZV9zZHZvX2RldmljZV9tYXBwaW5nKGRldl9wcml2LCBiZGItPnZlcnNpb24pOwot
CXBhcnNlX2RkaV9wb3J0cyhkZXZfcHJpdiwgYmRiLT52ZXJzaW9uKTsKKwlwYXJzZV9zZHZvX2Rl
dmljZV9tYXBwaW5nKGk5MTUsIGJkYi0+dmVyc2lvbik7CisJcGFyc2VfZGRpX3BvcnRzKGk5MTUs
IGJkYi0+dmVyc2lvbik7CiAKIG91dDoKIAlpZiAoIXZidCkgewogCQlEUk1fSU5GTygiRmFpbGVk
IHRvIGZpbmQgVkJJT1MgdGFibGVzIChWQlQpXG4iKTsKLQkJaW5pdF92YnRfbWlzc2luZ19kZWZh
dWx0cyhkZXZfcHJpdik7CisJCWluaXRfdmJ0X21pc3NpbmdfZGVmYXVsdHMoaTkxNSk7CiAJfQog
CiAJaWYgKGJpb3MpCkBAIC0xODc5LDQ3ICsxODc5LDQ3IEBAIHZvaWQgaW50ZWxfYmlvc19pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogLyoqCiAgKiBpbnRlbF9iaW9z
X2NsZWFudXAgLSBGcmVlIGFueSByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IGludGVsX2Jpb3NfaW5p
dCgpCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBk
ZXZpY2UgaW5zdGFuY2UKICAqLwotdm9pZCBpbnRlbF9iaW9zX2NsZWFudXAoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9iaW9zX2NsZWFudXAoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Ja2ZyZWUoZGV2X3ByaXYtPnZidC5jaGlsZF9kZXYp
OwotCWRldl9wcml2LT52YnQuY2hpbGRfZGV2ID0gTlVMTDsKLQlkZXZfcHJpdi0+dmJ0LmNoaWxk
X2Rldl9udW0gPSAwOwotCWtmcmVlKGRldl9wcml2LT52YnQuc2R2b19sdmRzX3ZidF9tb2RlKTsK
LQlkZXZfcHJpdi0+dmJ0LnNkdm9fbHZkc192YnRfbW9kZSA9IE5VTEw7Ci0Ja2ZyZWUoZGV2X3By
aXYtPnZidC5sZnBfbHZkc192YnRfbW9kZSk7Ci0JZGV2X3ByaXYtPnZidC5sZnBfbHZkc192YnRf
bW9kZSA9IE5VTEw7Ci0Ja2ZyZWUoZGV2X3ByaXYtPnZidC5kc2kuZGF0YSk7Ci0JZGV2X3ByaXYt
PnZidC5kc2kuZGF0YSA9IE5VTEw7Ci0Ja2ZyZWUoZGV2X3ByaXYtPnZidC5kc2kucHBzKTsKLQlk
ZXZfcHJpdi0+dmJ0LmRzaS5wcHMgPSBOVUxMOwotCWtmcmVlKGRldl9wcml2LT52YnQuZHNpLmNv
bmZpZyk7Ci0JZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnID0gTlVMTDsKLQlrZnJlZShkZXZfcHJp
di0+dmJ0LmRzaS5kZWFzc2VydF9zZXEpOwotCWRldl9wcml2LT52YnQuZHNpLmRlYXNzZXJ0X3Nl
cSA9IE5VTEw7CisJa2ZyZWUoaTkxNS0+dmJ0LmNoaWxkX2Rldik7CisJaTkxNS0+dmJ0LmNoaWxk
X2RldiA9IE5VTEw7CisJaTkxNS0+dmJ0LmNoaWxkX2Rldl9udW0gPSAwOworCWtmcmVlKGk5MTUt
PnZidC5zZHZvX2x2ZHNfdmJ0X21vZGUpOworCWk5MTUtPnZidC5zZHZvX2x2ZHNfdmJ0X21vZGUg
PSBOVUxMOworCWtmcmVlKGk5MTUtPnZidC5sZnBfbHZkc192YnRfbW9kZSk7CisJaTkxNS0+dmJ0
LmxmcF9sdmRzX3ZidF9tb2RlID0gTlVMTDsKKwlrZnJlZShpOTE1LT52YnQuZHNpLmRhdGEpOwor
CWk5MTUtPnZidC5kc2kuZGF0YSA9IE5VTEw7CisJa2ZyZWUoaTkxNS0+dmJ0LmRzaS5wcHMpOwor
CWk5MTUtPnZidC5kc2kucHBzID0gTlVMTDsKKwlrZnJlZShpOTE1LT52YnQuZHNpLmNvbmZpZyk7
CisJaTkxNS0+dmJ0LmRzaS5jb25maWcgPSBOVUxMOworCWtmcmVlKGk5MTUtPnZidC5kc2kuZGVh
c3NlcnRfc2VxKTsKKwlpOTE1LT52YnQuZHNpLmRlYXNzZXJ0X3NlcSA9IE5VTEw7CiB9CiAKIC8q
KgogICogaW50ZWxfYmlvc19pc190dl9wcmVzZW50IC0gaXMgaW50ZWdyYXRlZCBUViBwcmVzZW50
IGluIFZCVAotICogQGRldl9wcml2OglpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6CWk5
MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogUmV0dXJuIHRydWUgaWYgVFYgaXMgcHJlc2VudC4g
SWYgbm8gY2hpbGQgZGV2aWNlcyB3ZXJlIHBhcnNlZCBmcm9tIFZCVCwKICAqIGFzc3VtZSBUViBp
cyBwcmVzZW50LgogICovCi1ib29sIGludGVsX2Jpb3NfaXNfdHZfcHJlc2VudChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitib29sIGludGVsX2Jpb3NfaXNfdHZfcHJlc2VudChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAljb25zdCBzdHJ1Y3QgY2hpbGRfZGV2
aWNlX2NvbmZpZyAqY2hpbGQ7CiAJaW50IGk7CiAKLQlpZiAoIWRldl9wcml2LT52YnQuaW50X3R2
X3N1cHBvcnQpCisJaWYgKCFpOTE1LT52YnQuaW50X3R2X3N1cHBvcnQpCiAJCXJldHVybiBmYWxz
ZTsKIAotCWlmICghZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZfbnVtKQorCWlmICghaTkxNS0+dmJ0
LmNoaWxkX2Rldl9udW0pCiAJCXJldHVybiB0cnVlOwogCi0JZm9yIChpID0gMDsgaSA8IGRldl9w
cml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0JCWNoaWxkID0gZGV2X3ByaXYtPnZidC5j
aGlsZF9kZXYgKyBpOworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT52YnQuY2hpbGRfZGV2X251bTsg
aSsrKSB7CisJCWNoaWxkID0gaTkxNS0+dmJ0LmNoaWxkX2RldiArIGk7CiAJCS8qCiAJCSAqIElm
IHRoZSBkZXZpY2UgdHlwZSBpcyBub3QgVFYsIGNvbnRpbnVlLgogCQkgKi8KQEAgLTE5NDMsMjIg
KzE5NDMsMjIgQEAgYm9vbCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCiAvKioKICAqIGludGVsX2Jpb3NfaXNfbHZkc19wcmVzZW50
IC0gaXMgTFZEUyBwcmVzZW50IGluIFZCVAotICogQGRldl9wcml2OglpOTE1IGRldmljZSBpbnN0
YW5jZQorICogQGk5MTU6CWk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAaTJjX3BpbjoJaTJjIHBp
biBmb3IgTFZEUyBpZiBwcmVzZW50CiAgKgogICogUmV0dXJuIHRydWUgaWYgTFZEUyBpcyBwcmVz
ZW50LiBJZiBubyBjaGlsZCBkZXZpY2VzIHdlcmUgcGFyc2VkIGZyb20gVkJULAogICogYXNzdW1l
IExWRFMgaXMgcHJlc2VudC4KICAqLwotYm9vbCBpbnRlbF9iaW9zX2lzX2x2ZHNfcHJlc2VudChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4ICppMmNfcGluKQorYm9vbCBpbnRl
bF9iaW9zX2lzX2x2ZHNfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTgg
KmkyY19waW4pCiB7CiAJY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZV9jb25maWcgKmNoaWxkOwog
CWludCBpOwogCi0JaWYgKCFkZXZfcHJpdi0+dmJ0LmNoaWxkX2Rldl9udW0pCisJaWYgKCFpOTE1
LT52YnQuY2hpbGRfZGV2X251bSkKIAkJcmV0dXJuIHRydWU7CiAKLQlmb3IgKGkgPSAwOyBpIDwg
ZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZfbnVtOyBpKyspIHsKLQkJY2hpbGQgPSBkZXZfcHJpdi0+
dmJ0LmNoaWxkX2RldiArIGk7CisJZm9yIChpID0gMDsgaSA8IGk5MTUtPnZidC5jaGlsZF9kZXZf
bnVtOyBpKyspIHsKKwkJY2hpbGQgPSBpOTE1LT52YnQuY2hpbGRfZGV2ICsgaTsKIAogCQkvKiBJ
ZiB0aGUgZGV2aWNlIHR5cGUgaXMgbm90IExGUCwgY29udGludWUuCiAJCSAqIFdlIGhhdmUgdG8g
Y2hlY2sgYm90aCB0aGUgbmV3IGlkZW50aWZpZXJzIGFzIHdlbGwgYXMgdGhlCkBAIC0xOTY4LDcg
KzE5NjgsNyBAQCBib29sIGludGVsX2Jpb3NfaXNfbHZkc19wcmVzZW50KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgdTggKmkyY19waW4pCiAJCSAgICBjaGlsZC0+ZGV2aWNlX3R5
cGUgIT0gREVWSUNFX1RZUEVfTEZQKQogCQkJY29udGludWU7CiAKLQkJaWYgKGludGVsX2dtYnVz
X2lzX3ZhbGlkX3BpbihkZXZfcHJpdiwgY2hpbGQtPmkyY19waW4pKQorCQlpZiAoaW50ZWxfZ21i
dXNfaXNfdmFsaWRfcGluKGk5MTUsIGNoaWxkLT5pMmNfcGluKSkKIAkJCSppMmNfcGluID0gY2hp
bGQtPmkyY19waW47CiAKIAkJLyogSG93ZXZlciwgd2UgY2Fubm90IHRydXN0IHRoZSBCSU9TIHdy
aXRlcnMgdG8gcG9wdWxhdGUKQEAgLTE5ODQsNyArMTk4NCw3IEBAIGJvb2wgaW50ZWxfYmlvc19p
c19sdmRzX3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCAqaTJj
X3BpbikKIAkJICogYWRkaXRpb25hbCBkYXRhLiAgVHJ1c3QgdGhhdCBpZiB0aGUgVkJUIHdhcyB3
cml0dGVuIGludG8KIAkJICogdGhlIE9wUmVnaW9uIHRoZW4gdGhleSBoYXZlIHZhbGlkYXRlZCB0
aGUgTFZEUydzIGV4aXN0ZW5jZS4KIAkJICovCi0JCWlmIChkZXZfcHJpdi0+b3ByZWdpb24udmJ0
KQorCQlpZiAoaTkxNS0+b3ByZWdpb24udmJ0KQogCQkJcmV0dXJuIHRydWU7CiAJfQogCkBAIC0x
OTkzLDEyICsxOTkzLDEyIEBAIGJvb2wgaW50ZWxfYmlvc19pc19sdmRzX3ByZXNlbnQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCAqaTJjX3BpbikKIAogLyoqCiAgKiBpbnRl
bF9iaW9zX2lzX3BvcnRfcHJlc2VudCAtIGlzIHRoZSBzcGVjaWZpZWQgZGlnaXRhbCBwb3J0IHBy
ZXNlbnQKLSAqIEBkZXZfcHJpdjoJaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OglpOTE1
IGRldmljZSBpbnN0YW5jZQogICogQHBvcnQ6CXBvcnQgdG8gY2hlY2sKICAqCiAgKiBSZXR1cm4g
dHJ1ZSBpZiB0aGUgZGV2aWNlIGluICVwb3J0IGlzIHByZXNlbnQuCiAgKi8KLWJvb2wgaW50ZWxf
Ymlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIHBvcnQgcG9ydCkKK2Jvb2wgaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9ydCBwb3J0KQogewogCWNvbnN0IHN0cnVjdCBj
aGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKIAlzdGF0aWMgY29uc3Qgc3RydWN0IHsKQEAgLTIw
MTIsOSArMjAxMiw5IEBAIGJvb2wgaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9yCiAJfTsKIAlpbnQgaTsKIAot
CWlmIChIQVNfRERJKGRldl9wcml2KSkgeworCWlmIChIQVNfRERJKGk5MTUpKSB7CiAJCWNvbnN0
IHN0cnVjdCBkZGlfdmJ0X3BvcnRfaW5mbyAqcG9ydF9pbmZvID0KLQkJCSZkZXZfcHJpdi0+dmJ0
LmRkaV9wb3J0X2luZm9bcG9ydF07CisJCQkmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07
CiAKIAkJcmV0dXJuIHBvcnRfaW5mby0+c3VwcG9ydHNfZHAgfHwKIAkJICAgICAgIHBvcnRfaW5m
by0+c3VwcG9ydHNfZHZpIHx8CkBAIC0yMDI1LDExICsyMDI1LDExIEBAIGJvb2wgaW50ZWxfYmlv
c19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVt
IHBvcnQgcG9yCiAJaWYgKFdBUk5fT04ocG9ydCA9PSBQT1JUX0EpIHx8IHBvcnQgPj0gQVJSQVlf
U0laRShwb3J0X21hcHBpbmcpKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoIWRldl9wcml2LT52
YnQuY2hpbGRfZGV2X251bSkKKwlpZiAoIWk5MTUtPnZidC5jaGlsZF9kZXZfbnVtKQogCQlyZXR1
cm4gZmFsc2U7CiAKLQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZfbnVt
OyBpKyspIHsKLQkJY2hpbGQgPSBkZXZfcHJpdi0+dmJ0LmNoaWxkX2RldiArIGk7CisJZm9yIChp
ID0gMDsgaSA8IGk5MTUtPnZidC5jaGlsZF9kZXZfbnVtOyBpKyspIHsKKwkJY2hpbGQgPSBpOTE1
LT52YnQuY2hpbGRfZGV2ICsgaTsKIAogCQlpZiAoKGNoaWxkLT5kdm9fcG9ydCA9PSBwb3J0X21h
cHBpbmdbcG9ydF0uZHAgfHwKIAkJICAgICBjaGlsZC0+ZHZvX3BvcnQgPT0gcG9ydF9tYXBwaW5n
W3BvcnRdLmhkbWkpICYmCkBAIC0yMDQzLDEyICsyMDQzLDEyIEBAIGJvb2wgaW50ZWxfYmlvc19p
c19wb3J0X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBv
cnQgcG9yCiAKIC8qKgogICogaW50ZWxfYmlvc19pc19wb3J0X2VkcCAtIGlzIHRoZSBkZXZpY2Ug
aW4gZ2l2ZW4gcG9ydCBlRFAKLSAqIEBkZXZfcHJpdjoJaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAq
IEBpOTE1OglpOTE1IGRldmljZSBpbnN0YW5jZQogICogQHBvcnQ6CXBvcnQgdG8gY2hlY2sKICAq
CiAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZGV2aWNlIGluICVwb3J0IGlzIGVEUC4KICAqLwotYm9v
bCBpbnRlbF9iaW9zX2lzX3BvcnRfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgZW51bSBwb3J0IHBvcnQpCitib29sIGludGVsX2Jpb3NfaXNfcG9ydF9lZHAoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9ydCBwb3J0KQogewogCWNvbnN0IHN0cnVjdCBj
aGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKIAlzdGF0aWMgY29uc3Qgc2hvcnQgcG9ydF9tYXBw
aW5nW10gPSB7CkBAIC0yMDYwLDE0ICsyMDYwLDE0IEBAIGJvb2wgaW50ZWxfYmlvc19pc19wb3J0
X2VkcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQog
CX07CiAJaW50IGk7CiAKLQlpZiAoSEFTX0RESShkZXZfcHJpdikpCi0JCXJldHVybiBkZXZfcHJp
di0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF0uc3VwcG9ydHNfZWRwOworCWlmIChIQVNfRERJKGk5
MTUpKQorCQlyZXR1cm4gaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF0uc3VwcG9ydHNfZWRw
OwogCi0JaWYgKCFkZXZfcHJpdi0+dmJ0LmNoaWxkX2Rldl9udW0pCisJaWYgKCFpOTE1LT52YnQu
Y2hpbGRfZGV2X251bSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JZm9yIChpID0gMDsgaSA8IGRldl9w
cml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0JCWNoaWxkID0gZGV2X3ByaXYtPnZidC5j
aGlsZF9kZXYgKyBpOworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT52YnQuY2hpbGRfZGV2X251bTsg
aSsrKSB7CisJCWNoaWxkID0gaTkxNS0+dmJ0LmNoaWxkX2RldiArIGk7CiAKIAkJaWYgKGNoaWxk
LT5kdm9fcG9ydCA9PSBwb3J0X21hcHBpbmdbcG9ydF0gJiYKIAkJICAgIChjaGlsZC0+ZGV2aWNl
X3R5cGUgJiBERVZJQ0VfVFlQRV9lRFBfQklUUykgPT0KQEAgLTIxMTMsMTQgKzIxMTMsMTQgQEAg
c3RhdGljIGJvb2wgY2hpbGRfZGV2X2lzX2RwX2R1YWxfbW9kZShjb25zdCBzdHJ1Y3QgY2hpbGRf
ZGV2aWNlX2NvbmZpZyAqY2hpbGQsCiAJcmV0dXJuIGZhbHNlOwogfQogCi1ib29sIGludGVsX2Jp
b3NfaXNfcG9ydF9kcF9kdWFsX21vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfZHBfZHVhbF9tb2RlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSAgICAgZW51bSBwb3J0IHBvcnQpCiB7CiAJY29uc3Qgc3RydWN0
IGNoaWxkX2RldmljZV9jb25maWcgKmNoaWxkOwogCWludCBpOwogCi0JZm9yIChpID0gMDsgaSA8
IGRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0JCWNoaWxkID0gZGV2X3ByaXYt
PnZidC5jaGlsZF9kZXYgKyBpOworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT52YnQuY2hpbGRfZGV2
X251bTsgaSsrKSB7CisJCWNoaWxkID0gaTkxNS0+dmJ0LmNoaWxkX2RldiArIGk7CiAKIAkJaWYg
KGNoaWxkX2Rldl9pc19kcF9kdWFsX21vZGUoY2hpbGQsIHBvcnQpKQogCQkJcmV0dXJuIHRydWU7
CkBAIC0yMTMxLDIwICsyMTMxLDIwIEBAIGJvb2wgaW50ZWxfYmlvc19pc19wb3J0X2RwX2R1YWxf
bW9kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIC8qKgogICogaW50ZWxf
Ymlvc19pc19kc2lfcHJlc2VudCAtIGlzIERTSSBwcmVzZW50IGluIFZCVAotICogQGRldl9wcml2
OglpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6CWk5MTUgZGV2aWNlIGluc3RhbmNlCiAg
KiBAcG9ydDoJcG9ydCBmb3IgRFNJIGlmIHByZXNlbnQKICAqCiAgKiBSZXR1cm4gdHJ1ZSBpZiBE
U0kgaXMgcHJlc2VudCwgYW5kIHJldHVybiB0aGUgcG9ydCBpbiAlcG9ydC4KICAqLwotYm9vbCBp
bnRlbF9iaW9zX2lzX2RzaV9wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK2Jvb2wgaW50ZWxfYmlvc19pc19kc2lfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCSAgICAgICBlbnVtIHBvcnQgKnBvcnQpCiB7CiAJY29uc3Qgc3RydWN0IGNo
aWxkX2RldmljZV9jb25maWcgKmNoaWxkOwogCXU4IGR2b19wb3J0OwogCWludCBpOwogCi0JZm9y
IChpID0gMDsgaSA8IGRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0JCWNoaWxk
ID0gZGV2X3ByaXYtPnZidC5jaGlsZF9kZXYgKyBpOworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT52
YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7CisJCWNoaWxkID0gaTkxNS0+dmJ0LmNoaWxkX2RldiAr
IGk7CiAKIAkJaWYgKCEoY2hpbGQtPmRldmljZV90eXBlICYgREVWSUNFX1RZUEVfTUlQSV9PVVRQ
VVQpKQogCQkJY29udGludWU7CkBAIC0yMTUyLDggKzIxNTIsOCBAQCBib29sIGludGVsX2Jpb3Nf
aXNfZHNpX3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlkdm9f
cG9ydCA9IGNoaWxkLT5kdm9fcG9ydDsKIAogCQlpZiAoZHZvX3BvcnQgPT0gRFZPX1BPUlRfTUlQ
SUEgfHwKLQkJICAgIChkdm9fcG9ydCA9PSBEVk9fUE9SVF9NSVBJQiAmJiBJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDExKSB8fAotCQkgICAgKGR2b19wb3J0ID09IERWT19QT1JUX01JUElDICYmIElO
VEVMX0dFTihkZXZfcHJpdikgPCAxMSkpIHsKKwkJICAgIChkdm9fcG9ydCA9PSBEVk9fUE9SVF9N
SVBJQiAmJiBJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHx8CisJCSAgICAoZHZvX3BvcnQgPT0gRFZP
X1BPUlRfTUlQSUMgJiYgSU5URUxfR0VOKGk5MTUpIDwgMTEpKSB7CiAJCQlpZiAocG9ydCkKIAkJ
CQkqcG9ydCA9IGR2b19wb3J0IC0gRFZPX1BPUlRfTUlQSUE7CiAJCQlyZXR1cm4gdHJ1ZTsKQEAg
LTIyMDUsMTEgKzIyMDUsMTEgQEAgaW50ZWxfYmlvc19pc19sc3Bjb25fcHJlc2VudChjb25zdCBz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZXR1cm4gSEFTX0xTUENPTihpOTE1KSAm
JiBjaGlsZCAmJiBjaGlsZC0+bHNwY29uOwogfQogCi1lbnVtIGF1eF9jaCBpbnRlbF9iaW9zX3Bv
cnRfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2VudW0gYXV4X2No
IGludGVsX2Jpb3NfcG9ydF9hdXhfY2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkJICAgZW51bSBwb3J0IHBvcnQpCiB7CiAJY29uc3Qgc3RydWN0IGRkaV92YnRfcG9ydF9pbmZv
ICppbmZvID0KLQkJJmRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKKwkJJmk5MTUt
PnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOwogCWVudW0gYXV4X2NoIGF1eF9jaDsKIAogCWlmICgh
aW5mby0+YWx0ZXJuYXRlX2F1eF9jaGFubmVsKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9iaW9zLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9iaW9zLmgK
aW5kZXggNGU0MmNmYWY2MWE3Li5kMjkyYmQxNzkwYWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2Jpb3MuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9i
aW9zLmgKQEAgLTIyNiwxOSArMjI2LDE5IEBAIHN0cnVjdCBtaXBpX3Bwc19kYXRhIHsKIAl1MTYg
cGFuZWxfcG93ZXJfY3ljbGVfZGVsYXk7CiB9IF9fcGFja2VkOwogCi12b2lkIGludGVsX2Jpb3Nf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9iaW9z
X2NsZWFudXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxf
Ymlvc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfYmlv
c19jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIGJvb2wgaW50ZWxfYmlv
c19pc192YWxpZF92YnQoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3Qgc2l6ZSk7Ci1ib29sIGludGVs
X2Jpb3NfaXNfdHZfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwot
Ym9vbCBpbnRlbF9iaW9zX2lzX2x2ZHNfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIHU4ICppMmNfcGluKTsKLWJvb2wgaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCk7Ci1ib29s
IGludGVsX2Jpb3NfaXNfcG9ydF9lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBlbnVtIHBvcnQgcG9ydCk7Ci1ib29sIGludGVsX2Jpb3NfaXNfcG9ydF9kcF9kdWFsX21vZGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCk7Ci1ib29s
IGludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCBlbnVtIHBvcnQgKnBvcnQpOworYm9vbCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworYm9vbCBpbnRlbF9iaW9zX2lzX2x2ZHNfcHJl
c2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTggKmkyY19waW4pOworYm9vbCBp
bnRlbF9iaW9zX2lzX3BvcnRfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
ZW51bSBwb3J0IHBvcnQpOworYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfZWRwKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9ydCk7Citib29sIGludGVsX2Jpb3NfaXNf
cG9ydF9kcF9kdWFsX21vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9y
dCBwb3J0KTsKK2Jvb2wgaW50ZWxfYmlvc19pc19kc2lfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwgZW51bSBwb3J0ICpwb3J0KTsKIGJvb2wgaW50ZWxfYmlvc19pc19wb3J0
X2hwZF9pbnZlcnRlZChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICAgIGVudW0gcG9ydCBwb3J0KTsKIGJvb2wgaW50ZWxfYmlvc19pc19sc3Bjb25fcHJlc2VudChj
b25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgIGVudW0gcG9ydCBwb3J0
KTsKLWVudW0gYXV4X2NoIGludGVsX2Jpb3NfcG9ydF9hdXhfY2goc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCk7CitlbnVtIGF1eF9jaCBpbnRlbF9iaW9z
X3BvcnRfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9y
dCk7CiAKICNlbmRpZiAvKiBfSU5URUxfQklPU19IXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfYncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2J3LmMK
aW5kZXggNzUzYWMzMTY1MDYxLi4xYWNhNDRhMjU4ZDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2J3LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfYncu
YwpAQCAtMjIsMTMgKzIyLDEzIEBAIHN0cnVjdCBpbnRlbF9xZ3ZfaW5mbyB7CiAJZW51bSBpbnRl
bF9kcmFtX3R5cGUgZHJhbV90eXBlOwogfTsKIAotc3RhdGljIGludCBpY2xfcGNvZGVfcmVhZF9t
ZW1fZ2xvYmFsX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IGludCBpY2xfcGNvZGVfcmVhZF9tZW1fZ2xvYmFsX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJCSAgc3RydWN0IGludGVsX3Fndl9pbmZvICpxaSkKIHsKIAl1MzIgdmFs
ID0gMDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gc2FuZHlicmlkZ2VfcGNvZGVfcmVhZChkZXZfcHJp
diwKKwlyZXQgPSBzYW5keWJyaWRnZV9wY29kZV9yZWFkKGk5MTUsCiAJCQkJICAgICBJQ0xfUENP
REVfTUVNX1NVQlNZU1lTVEVNX0lORk8gfAogCQkJCSAgICAgSUNMX1BDT0RFX01FTV9TU19SRUFE
X0dMT0JBTF9JTkZPLAogCQkJCSAgICAgJnZhbCwgTlVMTCk7CkBAIC02MSwxNCArNjEsMTQgQEAg
c3RhdGljIGludCBpY2xfcGNvZGVfcmVhZF9tZW1fZ2xvYmFsX2luZm8oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGljbF9wY29k
ZV9yZWFkX3Fndl9wb2ludF9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyBpbnQgaWNsX3Bjb2RlX3JlYWRfcWd2X3BvaW50X2luZm8oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSBzdHJ1Y3QgaW50ZWxfcWd2X3BvaW50ICpzcCwKIAkJCQkJ
IGludCBwb2ludCkKIHsKIAl1MzIgdmFsID0gMCwgdmFsMjsKIAlpbnQgcmV0OwogCi0JcmV0ID0g
c2FuZHlicmlkZ2VfcGNvZGVfcmVhZChkZXZfcHJpdiwKKwlyZXQgPSBzYW5keWJyaWRnZV9wY29k
ZV9yZWFkKGk5MTUsCiAJCQkJICAgICBJQ0xfUENPREVfTUVNX1NVQlNZU1lTVEVNX0lORk8gfAog
CQkJCSAgICAgSUNMX1BDT0RFX01FTV9TU19SRUFEX1FHVl9QT0lOVF9JTkZPKHBvaW50KSwKIAkJ
CQkgICAgICZ2YWwsICZ2YWwyKTsKQEAgLTg3LDEyICs4NywxMiBAQCBzdGF0aWMgaW50IGljbF9w
Y29kZV9yZWFkX3Fndl9wb2ludF9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBpY2xfZ2V0X3Fndl9wb2ludHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGludCBpY2xfZ2V0X3Fndl9wb2lu
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxf
cWd2X2luZm8gKnFpKQogewogCWludCBpLCByZXQ7CiAKLQlyZXQgPSBpY2xfcGNvZGVfcmVhZF9t
ZW1fZ2xvYmFsX2luZm8oZGV2X3ByaXYsIHFpKTsKKwlyZXQgPSBpY2xfcGNvZGVfcmVhZF9tZW1f
Z2xvYmFsX2luZm8oaTkxNSwgcWkpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTEw
Miw3ICsxMDIsNyBAQCBzdGF0aWMgaW50IGljbF9nZXRfcWd2X3BvaW50cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJZm9yIChpID0gMDsgaSA8IHFpLT5udW1fcG9pbnRzOyBp
KyspIHsKIAkJc3RydWN0IGludGVsX3Fndl9wb2ludCAqc3AgPSAmcWktPnBvaW50c1tpXTsKIAot
CQlyZXQgPSBpY2xfcGNvZGVfcmVhZF9xZ3ZfcG9pbnRfaW5mbyhkZXZfcHJpdiwgc3AsIGkpOwor
CQlyZXQgPSBpY2xfcGNvZGVfcmVhZF9xZ3ZfcG9pbnRfaW5mbyhpOTE1LCBzcCwgaSk7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCkBAIC0xNDIsNyArMTQyLDcgQEAgc3RhdGljIGNvbnN0
IHN0cnVjdCBpbnRlbF9zYV9pbmZvIGljbF9zYV9pbmZvID0gewogCS5kaXNwbGF5cnRpZHMgPSAx
MjgsCiB9OwogCi1zdGF0aWMgaW50IGljbF9nZXRfYndfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW50IGljbF9nZXRfYndfaW5mbyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcWd2X2luZm8gcWkgPSB7fTsKIAlj
b25zdCBzdHJ1Y3QgaW50ZWxfc2FfaW5mbyAqc2EgPSAmaWNsX3NhX2luZm87CkBAIC0xNTQsNyAr
MTU0LDcgQEAgc3RhdGljIGludCBpY2xfZ2V0X2J3X2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCWludCBtYXhkZWJ3OwogCWludCBpLCByZXQ7CiAKLQlyZXQgPSBpY2xf
Z2V0X3Fndl9wb2ludHMoZGV2X3ByaXYsICZxaSk7CisJcmV0ID0gaWNsX2dldF9xZ3ZfcG9pbnRz
KGk5MTUsICZxaSk7CiAJaWYgKHJldCkgewogCQlEUk1fREVCVUdfS01TKCJGYWlsZWQgdG8gZ2V0
IG1lbW9yeSBzdWJzeXN0ZW0gaW5mb3JtYXRpb24sIGlnbm9yaW5nIGJhbmR3aWR0aCBsaW1pdHMi
KTsKIAkJcmV0dXJuIHJldDsKQEAgLTE3MCw4ICsxNzAsOCBAQCBzdGF0aWMgaW50IGljbF9nZXRf
YndfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAgICAgIGljbF9j
YWxjX2J3KGRjbGtfbWF4LCAxNiwgMSkgKiA2IC8gMTApOyAvKiA2MCUgKi8KIAlpcHFkZXB0aCA9
IG1pbihpcHFkZXB0aHBjaCwgc2EtPmRpc3BsYXlydGlkcyAvIG51bV9jaGFubmVscyk7CiAKLQlm
b3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShkZXZfcHJpdi0+bWF4X2J3KTsgaSsrKSB7Ci0JCXN0
cnVjdCBpbnRlbF9id19pbmZvICpiaSA9ICZkZXZfcHJpdi0+bWF4X2J3W2ldOworCWZvciAoaSA9
IDA7IGkgPCBBUlJBWV9TSVpFKGk5MTUtPm1heF9idyk7IGkrKykgeworCQlzdHJ1Y3QgaW50ZWxf
YndfaW5mbyAqYmkgPSAmaTkxNS0+bWF4X2J3W2ldOwogCQlpbnQgY2xwY2hncm91cDsKIAkJaW50
IGo7CiAKQEAgLTIwNiwxOCArMjA2LDE4IEBAIHN0YXRpYyBpbnQgaWNsX2dldF9id19pbmZvKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGlj
IHVuc2lnbmVkIGludCBpY2xfbWF4X2J3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK3N0YXRpYyB1bnNpZ25lZCBpbnQgaWNsX21heF9idyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCSAgICAgICBpbnQgbnVtX3BsYW5lcywgaW50IHFndl9wb2ludCkKIHsKIAlp
bnQgaTsKIAogCS8qIERpZCB3ZSBpbml0aWFsaXplIHRoZSBidyBsaW1pdHMgc3VjY2Vzc2Z1bGx5
PyAqLwotCWlmIChkZXZfcHJpdi0+bWF4X2J3WzBdLm51bV9wbGFuZXMgPT0gMCkKKwlpZiAoaTkx
NS0+bWF4X2J3WzBdLm51bV9wbGFuZXMgPT0gMCkKIAkJcmV0dXJuIFVJTlRfTUFYOwogCi0JZm9y
IChpID0gMDsgaSA8IEFSUkFZX1NJWkUoZGV2X3ByaXYtPm1heF9idyk7IGkrKykgeworCWZvciAo
aSA9IDA7IGkgPCBBUlJBWV9TSVpFKGk5MTUtPm1heF9idyk7IGkrKykgewogCQljb25zdCBzdHJ1
Y3QgaW50ZWxfYndfaW5mbyAqYmkgPQotCQkJJmRldl9wcml2LT5tYXhfYndbaV07CisJCQkmaTkx
NS0+bWF4X2J3W2ldOwogCiAJCWlmIChudW1fcGxhbmVzID49IGJpLT5udW1fcGxhbmVzKQogCQkJ
cmV0dXJuIGJpLT5kZXJhdGVkYndbcWd2X3BvaW50XTsKQEAgLTIyNiwyNCArMjI2LDI0IEBAIHN0
YXRpYyB1bnNpZ25lZCBpbnQgaWNsX21heF9idyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfYndfaW5pdF9odyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2J3X2luaXRfaHcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKElTX0dFTihkZXZfcHJpdiwgMTEpKQotCQlp
Y2xfZ2V0X2J3X2luZm8oZGV2X3ByaXYpOworCWlmIChJU19HRU4oaTkxNSwgMTEpKQorCQlpY2xf
Z2V0X2J3X2luZm8oaTkxNSk7CiB9CiAKLXN0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfbWF4X2Rh
dGFfcmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdW5zaWdu
ZWQgaW50IGludGVsX21heF9kYXRhX3JhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkJCWludCBudW1fcGxhbmVzKQogewotCWlmIChJU19HRU4oZGV2X3ByaXYsIDExKSkKKwlp
ZiAoSVNfR0VOKGk5MTUsIDExKSkKIAkJLyoKIAkJICogRklYTUUgd2l0aCBTQUdWIGRpc2FibGVk
IG1heWJlIHdlIGNhbiBhc3N1bWUKIAkJICogcG9pbnQgMSB3aWxsIGFsd2F5cyBiZSB1c2VkPyBT
ZWVtcyB0byBtYXRjaAogCQkgKiB0aGUgYmVoYXZpb3VyIG9ic2VydmVkIGluIHRoZSB3aWxkLgog
CQkgKi8KLQkJcmV0dXJuIG1pbjMoaWNsX21heF9idyhkZXZfcHJpdiwgbnVtX3BsYW5lcywgMCks
Ci0JCQkgICAgaWNsX21heF9idyhkZXZfcHJpdiwgbnVtX3BsYW5lcywgMSksCi0JCQkgICAgaWNs
X21heF9idyhkZXZfcHJpdiwgbnVtX3BsYW5lcywgMikpOworCQlyZXR1cm4gbWluMyhpY2xfbWF4
X2J3KGk5MTUsIG51bV9wbGFuZXMsIDApLAorCQkJICAgIGljbF9tYXhfYncoaTkxNSwgbnVtX3Bs
YW5lcywgMSksCisJCQkgICAgaWNsX21heF9idyhpOTE1LCBudW1fcGxhbmVzLCAyKSk7CiAJZWxz
ZQogCQlyZXR1cm4gVUlOVF9NQVg7CiB9CkBAIC0yOTMsMjUgKzI5MywyNSBAQCB2b2lkIGludGVs
X2J3X2NydGNfdXBkYXRlKHN0cnVjdCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGUsCiAJCSAgICAg
IGJ3X3N0YXRlLT5udW1fYWN0aXZlX3BsYW5lc1tjcnRjLT5waXBlXSk7CiB9CiAKLXN0YXRpYyB1
bnNpZ25lZCBpbnQgaW50ZWxfYndfbnVtX2FjdGl2ZV9wbGFuZXMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9id19udW1fYWN0aXZl
X3BsYW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGUpCiB7CiAJdW5zaWduZWQgaW50IG51bV9h
Y3RpdmVfcGxhbmVzID0gMDsKIAllbnVtIHBpcGUgcGlwZTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2
X3ByaXYsIHBpcGUpCisJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKQogCQludW1fYWN0aXZlX3Bs
YW5lcyArPSBid19zdGF0ZS0+bnVtX2FjdGl2ZV9wbGFuZXNbcGlwZV07CiAKIAlyZXR1cm4gbnVt
X2FjdGl2ZV9wbGFuZXM7CiB9CiAKLXN0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfYndfZGF0YV9y
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB1bnNpZ25lZCBp
bnQgaW50ZWxfYndfZGF0YV9yYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
CSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0YXRlKQogewogCXVuc2ln
bmVkIGludCBkYXRhX3JhdGUgPSAwOwogCWVudW0gcGlwZSBwaXBlOwogCi0JZm9yX2VhY2hfcGlw
ZShkZXZfcHJpdiwgcGlwZSkKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCiAJCWRhdGFfcmF0
ZSArPSBid19zdGF0ZS0+ZGF0YV9yYXRlW3BpcGVdOwogCiAJcmV0dXJuIGRhdGFfcmF0ZTsKQEAg
LTMxOSw3ICszMTksNyBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2J3X2RhdGFfcmF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIGludCBpbnRlbF9id19hdG9taWNf
Y2hlY2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCXN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwgKm9sZF9jcnRjX3N0YXRlOwog
CXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGUgPSBOVUxMOwogCXVuc2lnbmVkIGludCBk
YXRhX3JhdGUsIG1heF9kYXRhX3JhdGU7CkBAIC0zMjgsNyArMzI4LDcgQEAgaW50IGludGVsX2J3
X2F0b21pY19jaGVjayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlpbnQgaTsK
IAogCS8qIEZJWE1FIGVhcmxpZXIgZ2VucyBuZWVkIHNvbWUgY2hlY2tzIHRvbyAqLwotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDExKQogCQly
ZXR1cm4gMDsKIAogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBj
cnRjLCBvbGRfY3J0Y19zdGF0ZSwKQEAgLTM2NiwxMCArMzY2LDEwIEBAIGludCBpbnRlbF9id19h
dG9taWNfY2hlY2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKCFid19z
dGF0ZSkKIAkJcmV0dXJuIDA7CiAKLQlkYXRhX3JhdGUgPSBpbnRlbF9id19kYXRhX3JhdGUoZGV2
X3ByaXYsIGJ3X3N0YXRlKTsKLQludW1fYWN0aXZlX3BsYW5lcyA9IGludGVsX2J3X251bV9hY3Rp
dmVfcGxhbmVzKGRldl9wcml2LCBid19zdGF0ZSk7CisJZGF0YV9yYXRlID0gaW50ZWxfYndfZGF0
YV9yYXRlKGk5MTUsIGJ3X3N0YXRlKTsKKwludW1fYWN0aXZlX3BsYW5lcyA9IGludGVsX2J3X251
bV9hY3RpdmVfcGxhbmVzKGk5MTUsIGJ3X3N0YXRlKTsKIAotCW1heF9kYXRhX3JhdGUgPSBpbnRl
bF9tYXhfZGF0YV9yYXRlKGRldl9wcml2LCBudW1fYWN0aXZlX3BsYW5lcyk7CisJbWF4X2RhdGFf
cmF0ZSA9IGludGVsX21heF9kYXRhX3JhdGUoaTkxNSwgbnVtX2FjdGl2ZV9wbGFuZXMpOwogCiAJ
ZGF0YV9yYXRlID0gRElWX1JPVU5EX1VQKGRhdGFfcmF0ZSwgMTAwMCk7CiAKQEAgLTQwNiw3ICs0
MDYsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wcml2YXRlX3N0YXRlX2Z1bmNzIGludGVs
X2J3X2Z1bmNzID0gewogCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGludGVsX2J3X2Rlc3Ryb3lf
c3RhdGUsCiB9OwogCi1pbnQgaW50ZWxfYndfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitpbnQgaW50ZWxfYndfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKnN0YXRlOwogCkBAIC00MTQsNyArNDE0LDcg
QEAgaW50IGludGVsX2J3X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CWlmICghc3RhdGUpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JZHJtX2F0b21pY19wcml2YXRlX29i
al9pbml0KCZkZXZfcHJpdi0+ZHJtLCAmZGV2X3ByaXYtPmJ3X29iaiwKKwlkcm1fYXRvbWljX3By
aXZhdGVfb2JqX2luaXQoJmk5MTUtPmRybSwgJmk5MTUtPmJ3X29iaiwKIAkJCQkgICAgJnN0YXRl
LT5iYXNlLCAmaW50ZWxfYndfZnVuY3MpOwogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9idy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
YncuaAppbmRleCBlOWQ5YzZkNjNiYzMuLjM5NmU1MDI5ZjlhNCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfYncuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9idy5oCkBAIC0yNywxOSArMjcsMTkgQEAgc3RydWN0IGludGVsX2J3X3N0YXRlIHsKIHN0YXRp
YyBpbmxpbmUgc3RydWN0IGludGVsX2J3X3N0YXRlICoKIGludGVsX2F0b21pY19nZXRfYndfc3Rh
dGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCXN0cnVj
dCBkcm1fcHJpdmF0ZV9zdGF0ZSAqYndfc3RhdGU7CiAKIAlid19zdGF0ZSA9IGRybV9hdG9taWNf
Z2V0X3ByaXZhdGVfb2JqX3N0YXRlKCZzdGF0ZS0+YmFzZSwKLQkJCQkJCSAgICAmZGV2X3ByaXYt
PmJ3X29iaik7CisJCQkJCQkgICAgJmk5MTUtPmJ3X29iaik7CiAJaWYgKElTX0VSUihid19zdGF0
ZSkpCiAJCXJldHVybiBFUlJfQ0FTVChid19zdGF0ZSk7CiAKIAlyZXR1cm4gdG9faW50ZWxfYndf
c3RhdGUoYndfc3RhdGUpOwogfQogCi12b2lkIGludGVsX2J3X2luaXRfaHcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLWludCBpbnRlbF9id19pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX2J3X2luaXRfaHcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpOworaW50IGludGVsX2J3X2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOwogaW50IGludGVsX2J3X2F0b21pY19jaGVjayhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSk7CiB2b2lkIGludGVsX2J3X2NydGNfdXBkYXRlKHN0cnVjdCBpbnRl
bF9id19zdGF0ZSAqYndfc3RhdGUsCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Nk
Y2xrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jZGNsay5jCmluZGV4IDg5OTNhYjI4
MzU2Mi4uMDJjNjE3MTgwYzRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9jZGNsay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2NkY2xrLmMKQEAgLTUz
LDQ2ICs1Myw0NiBAQAogICogZGl2aWRlcnMgY2FuIGJlIHByb2dyYW1tZWQgY29ycmVjdGx5Lgog
ICovCiAKLXN0YXRpYyB2b2lkIGZpeGVkXzEzM21oel9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgZml4ZWRfMTMzbWh6X2dldF9jZGNsayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY2RjbGtf
c3RhdGUgKmNkY2xrX3N0YXRlKQogewogCWNkY2xrX3N0YXRlLT5jZGNsayA9IDEzMzMzMzsKIH0K
IAotc3RhdGljIHZvaWQgZml4ZWRfMjAwbWh6X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBmaXhlZF8yMDBtaHpfZ2V0X2NkY2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgIHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0
ZSAqY2RjbGtfc3RhdGUpCiB7CiAJY2RjbGtfc3RhdGUtPmNkY2xrID0gMjAwMDAwOwogfQogCi1z
dGF0aWMgdm9pZCBmaXhlZF8yNjZtaHpfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGZpeGVkXzI2Nm1oel9nZXRfY2RjbGsoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpj
ZGNsa19zdGF0ZSkKIHsKIAljZGNsa19zdGF0ZS0+Y2RjbGsgPSAyNjY2Njc7CiB9CiAKLXN0YXRp
YyB2b2lkIGZpeGVkXzMzM21oel9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAorc3RhdGljIHZvaWQgZml4ZWRfMzMzbWh6X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xr
X3N0YXRlKQogewogCWNkY2xrX3N0YXRlLT5jZGNsayA9IDMzMzMzMzsKIH0KIAotc3RhdGljIHZv
aWQgZml4ZWRfNDAwbWh6X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitzdGF0aWMgdm9pZCBmaXhlZF80MDBtaHpfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSAgIHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3Rh
dGUpCiB7CiAJY2RjbGtfc3RhdGUtPmNkY2xrID0gNDAwMDAwOwogfQogCi1zdGF0aWMgdm9pZCBm
aXhlZF80NTBtaHpfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyB2b2lkIGZpeGVkXzQ1MG1oel9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICAgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSkK
IHsKIAljZGNsa19zdGF0ZS0+Y2RjbGsgPSA0NTAwMDA7CiB9CiAKLXN0YXRpYyB2b2lkIGk4NXhf
Z2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lk
IGk4NXhfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgc3Ry
dWN0IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSkKIHsKLQlzdHJ1Y3QgcGNpX2RldiAq
cGRldiA9IGRldl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5MTUt
PmRybS5wZGV2OwogCXUxNiBocGxsY2MgPSAwOwogCiAJLyoKQEAgLTEzMSwxMCArMTMxLDEwIEBA
IHN0YXRpYyB2b2lkIGk4NXhfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIGk5MTVnbV9nZXRfY2RjbGsoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaTkxNWdtX2dldF9jZGNsayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgc3RydWN0IGludGVsX2NkY2xrX3N0
YXRlICpjZGNsa19zdGF0ZSkKIHsKLQlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGRldl9wcml2LT5k
cm0ucGRldjsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5wZGV2OwogCXUxNiBn
Y2ZnYyA9IDA7CiAKIAlwY2lfcmVhZF9jb25maWdfd29yZChwZGV2LCBHQ0ZHQywgJmdjZmdjKTsK
QEAgLTE1NSwxMCArMTU1LDEwIEBAIHN0YXRpYyB2b2lkIGk5MTVnbV9nZXRfY2RjbGsoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0KIAotc3RhdGljIHZvaWQgaTk0NWdt
X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9p
ZCBpOTQ1Z21fZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAg
ICBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlKQogewotCXN0cnVjdCBwY2lf
ZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0g
aTkxNS0+ZHJtLnBkZXY7CiAJdTE2IGdjZmdjID0gMDsKIAogCXBjaV9yZWFkX2NvbmZpZ193b3Jk
KHBkZXYsIEdDRkdDLCAmZ2NmZ2MpOwpAQCAtMTc5LDcgKzE3OSw3IEBAIHN0YXRpYyB2b2lkIGk5
NDVnbV9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0K
IAotc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9ocGxsX3ZjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2hwbGxfdmNvKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0YXRpYyBjb25zdCB1bnNpZ25lZCBpbnQg
YmxiX3Zjb1s4XSA9IHsKIAkJWzBdID0gMzIwMDAwMCwKQEAgLTIyMywyMCArMjIzLDIwIEBAIHN0
YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfaHBsbF92Y28oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCXU4IHRtcCA9IDA7CiAKIAkvKiBGSVhNRSBvdGhlciBjaGlwc2V0cz8gKi8K
LQlpZiAoSVNfR000NShkZXZfcHJpdikpCisJaWYgKElTX0dNNDUoaTkxNSkpCiAJCXZjb190YWJs
ZSA9IGN0Z192Y287Ci0JZWxzZSBpZiAoSVNfRzQ1KGRldl9wcml2KSkKKwllbHNlIGlmIChJU19H
NDUoaTkxNSkpCiAJCXZjb190YWJsZSA9IGVsa192Y287Ci0JZWxzZSBpZiAoSVNfSTk2NUdNKGRl
dl9wcml2KSkKKwllbHNlIGlmIChJU19JOTY1R00oaTkxNSkpCiAJCXZjb190YWJsZSA9IGNsX3Zj
bzsKLQllbHNlIGlmIChJU19QSU5FVklFVyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfUElORVZJ
RVcoaTkxNSkpCiAJCXZjb190YWJsZSA9IHBudl92Y287Ci0JZWxzZSBpZiAoSVNfRzMzKGRldl9w
cml2KSkKKwllbHNlIGlmIChJU19HMzMoaTkxNSkpCiAJCXZjb190YWJsZSA9IGJsYl92Y287CiAJ
ZWxzZQogCQlyZXR1cm4gMDsKIAotCXRtcCA9IEk5MTVfUkVBRChJU19QSU5FVklFVyhkZXZfcHJp
dikgfHwgSVNfTU9CSUxFKGRldl9wcml2KSA/CisJdG1wID0gSTkxNV9SRUFEKElTX1BJTkVWSUVX
KGk5MTUpIHx8IElTX01PQklMRShpOTE1KSA/CiAJCQlIUExMVkNPX01PQklMRSA6IEhQTExWQ08p
OwogCiAJdmNvID0gdmNvX3RhYmxlW3RtcCAmIDB4N107CkBAIC0yNDgsMTAgKzI0OCwxMCBAQCBz
dGF0aWMgdW5zaWduZWQgaW50IGludGVsX2hwbGxfdmNvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAlyZXR1cm4gdmNvOwogfQogCi1zdGF0aWMgdm9pZCBnMzNfZ2V0X2NkY2xr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGczM19nZXRf
Y2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHN0cnVjdCBpbnRlbF9j
ZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUpCiB7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZf
cHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsK
IAlzdGF0aWMgY29uc3QgdTggZGl2XzMyMDBbXSA9IHsgMTIsIDEwLCAgOCwgIDcsIDUsIDE2IH07
CiAJc3RhdGljIGNvbnN0IHU4IGRpdl80MDAwW10gPSB7IDE0LCAxMiwgMTAsICA4LCA2LCAyMCB9
OwogCXN0YXRpYyBjb25zdCB1OCBkaXZfNDgwMFtdID0geyAyMCwgMTQsIDEyLCAxMCwgOCwgMjQg
fTsKQEAgLTI2MCw3ICsyNjAsNyBAQCBzdGF0aWMgdm9pZCBnMzNfZ2V0X2NkY2xrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl1bnNpZ25lZCBpbnQgY2RjbGtfc2VsOwogCXUx
NiB0bXAgPSAwOwogCi0JY2RjbGtfc3RhdGUtPnZjbyA9IGludGVsX2hwbGxfdmNvKGRldl9wcml2
KTsKKwljZGNsa19zdGF0ZS0+dmNvID0gaW50ZWxfaHBsbF92Y28oaTkxNSk7CiAKIAlwY2lfcmVh
ZF9jb25maWdfd29yZChwZGV2LCBHQ0ZHQywgJnRtcCk7CiAKQEAgLTI5NiwxMCArMjk2LDEwIEBA
IHN0YXRpYyB2b2lkIGczM19nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCWNkY2xrX3N0YXRlLT5jZGNsayA9IDE5MDQ3NjsKIH0KIAotc3RhdGljIHZvaWQgcG52
X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9p
ZCBwbnZfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBzdHJ1
Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlKQogewotCXN0cnVjdCBwY2lfZGV2ICpw
ZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+
ZHJtLnBkZXY7CiAJdTE2IGdjZmdjID0gMDsKIAogCXBjaV9yZWFkX2NvbmZpZ193b3JkKHBkZXYs
IEdDRkdDLCAmZ2NmZ2MpOwpAQCAtMzI5LDEwICszMjksMTAgQEAgc3RhdGljIHZvaWQgcG52X2dl
dF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0
aWMgdm9pZCBpOTY1Z21fZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK3N0YXRpYyB2b2lkIGk5NjVnbV9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkgICAgIHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUpCiB7
Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZfcHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IHBj
aV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsKIAlzdGF0aWMgY29uc3QgdTggZGl2XzMyMDBb
XSA9IHsgMTYsIDEwLCAgOCB9OwogCXN0YXRpYyBjb25zdCB1OCBkaXZfNDAwMFtdID0geyAyMCwg
MTIsIDEwIH07CiAJc3RhdGljIGNvbnN0IHU4IGRpdl81MzMzW10gPSB7IDI0LCAxNiwgMTQgfTsK
QEAgLTM0MCw3ICszNDAsNyBAQCBzdGF0aWMgdm9pZCBpOTY1Z21fZ2V0X2NkY2xrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl1bnNpZ25lZCBpbnQgY2RjbGtfc2VsOwogCXUx
NiB0bXAgPSAwOwogCi0JY2RjbGtfc3RhdGUtPnZjbyA9IGludGVsX2hwbGxfdmNvKGRldl9wcml2
KTsKKwljZGNsa19zdGF0ZS0+dmNvID0gaW50ZWxfaHBsbF92Y28oaTkxNSk7CiAKIAlwY2lfcmVh
ZF9jb25maWdfd29yZChwZGV2LCBHQ0ZHQywgJnRtcCk7CiAKQEAgLTM3MywxNCArMzczLDE0IEBA
IHN0YXRpYyB2b2lkIGk5NjVnbV9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCWNkY2xrX3N0YXRlLT5jZGNsayA9IDIwMDAwMDsKIH0KIAotc3RhdGljIHZvaWQg
Z200NV9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IHZvaWQgZ200NV9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkg
ICBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlKQogewotCXN0cnVjdCBwY2lf
ZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0g
aTkxNS0+ZHJtLnBkZXY7CiAJdW5zaWduZWQgaW50IGNkY2xrX3NlbDsKIAl1MTYgdG1wID0gMDsK
IAotCWNkY2xrX3N0YXRlLT52Y28gPSBpbnRlbF9ocGxsX3ZjbyhkZXZfcHJpdik7CisJY2RjbGtf
c3RhdGUtPnZjbyA9IGludGVsX2hwbGxfdmNvKGk5MTUpOwogCiAJcGNpX3JlYWRfY29uZmlnX3dv
cmQocGRldiwgR0NGR0MsICZ0bXApOwogCkBAIC00MDMsNyArNDAzLDcgQEAgc3RhdGljIHZvaWQg
Z200NV9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0K
IAotc3RhdGljIHZvaWQgaHN3X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBoc3dfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJICBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlKQogewog
CXUzMiBsY3BsbCA9IEk5MTVfUkVBRChMQ1BMTF9DVEwpOwpAQCAtNDE1LDE1ICs0MTUsMTUgQEAg
c3RhdGljIHZvaWQgaHN3X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJCWNkY2xrX3N0YXRlLT5jZGNsayA9IDQ1MDAwMDsKIAllbHNlIGlmIChmcmVxID09IExD
UExMX0NMS19GUkVRXzQ1MCkKIAkJY2RjbGtfc3RhdGUtPmNkY2xrID0gNDUwMDAwOwotCWVsc2Ug
aWYgKElTX0hTV19VTFQoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0hTV19VTFQoaTkxNSkpCiAJ
CWNkY2xrX3N0YXRlLT5jZGNsayA9IDMzNzUwMDsKIAllbHNlCiAJCWNkY2xrX3N0YXRlLT5jZGNs
ayA9IDU0MDAwMDsKIH0KIAotc3RhdGljIGludCB2bHZfY2FsY19jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCBtaW5fY2RjbGspCitzdGF0aWMgaW50IHZsdl9jYWxj
X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgbWluX2NkY2xrKQogewot
CWludCBmcmVxXzMyMCA9IChkZXZfcHJpdi0+aHBsbF9mcmVxIDw8ICAxKSAlIDMyMDAwMCAhPSAw
ID8KKwlpbnQgZnJlcV8zMjAgPSAoaTkxNS0+aHBsbF9mcmVxIDw8ICAxKSAlIDMyMDAwMCAhPSAw
ID8KIAkJMzMzMzMzIDogMzIwMDAwOwogCiAJLyoKQEAgLTQzMSw3ICs0MzEsNyBAQCBzdGF0aWMg
aW50IHZsdl9jYWxjX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50
IG1pbl9jZGNsaykKIAkgKiBOb3Qgc3VyZSB3aGF0J3Mgd3JvbmcuIEZvciBub3cgdXNlIDIwME1I
eiBvbmx5IHdoZW4gYWxsIHBpcGVzCiAJICogYXJlIG9mZi4KIAkgKi8KLQlpZiAoSVNfVkFMTEVZ
VklFVyhkZXZfcHJpdikgJiYgbWluX2NkY2xrID4gZnJlcV8zMjApCisJaWYgKElTX1ZBTExFWVZJ
RVcoaTkxNSkgJiYgbWluX2NkY2xrID4gZnJlcV8zMjApCiAJCXJldHVybiA0MDAwMDA7CiAJZWxz
ZSBpZiAobWluX2NkY2xrID4gMjY2NjY3KQogCQlyZXR1cm4gZnJlcV8zMjA7CkBAIC00NDEsOSAr
NDQxLDkgQEAgc3RhdGljIGludCB2bHZfY2FsY19jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIGludCBtaW5fY2RjbGspCiAJCXJldHVybiAyMDAwMDA7CiB9CiAKLXN0YXRp
YyB1OCB2bHZfY2FsY192b2x0YWdlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgaW50IGNkY2xrKQorc3RhdGljIHU4IHZsdl9jYWxjX3ZvbHRhZ2VfbGV2ZWwoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCBjZGNsaykKIHsKLQlpZiAoSVNfVkFMTEVZVklF
VyhkZXZfcHJpdikpIHsKKwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkgewogCQlpZiAoY2RjbGsg
Pj0gMzIwMDAwKSAvKiBqdW1wIHRvIGhpZ2hlc3Qgdm9sdGFnZSBmb3IgNDAwTUh6IHRvbyAqLwog
CQkJcmV0dXJuIDI7CiAJCWVsc2UgaWYgKGNkY2xrID49IDI2NjY2NykKQEAgLTQ1NiwyOSArNDU2
LDI5IEBAIHN0YXRpYyB1OCB2bHZfY2FsY192b2x0YWdlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgaW50IGNkY2xrKQogCQkgKiBoYXJkd2FyZSBoYXMgc2hvd24gdGhh
dCB3ZSBqdXN0IG5lZWQgdG8gd3JpdGUgdGhlIGRlc2lyZWQKIAkJICogQ0NLIGRpdmlkZXIgaW50
byB0aGUgUHVuaXQgcmVnaXN0ZXIuCiAJCSAqLwotCQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1Qo
ZGV2X3ByaXYtPmhwbGxfZnJlcSA8PCAxLCBjZGNsaykgLSAxOworCQlyZXR1cm4gRElWX1JPVU5E
X0NMT1NFU1QoaTkxNS0+aHBsbF9mcmVxIDw8IDEsIGNkY2xrKSAtIDE7CiAJfQogfQogCi1zdGF0
aWMgdm9pZCB2bHZfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyB2b2lkIHZsdl9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkgIHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUpCiB7CiAJdTMyIHZh
bDsKIAotCXZsdl9pb3NmX3NiX2dldChkZXZfcHJpdiwKKwl2bHZfaW9zZl9zYl9nZXQoaTkxNSwK
IAkJCUJJVChWTFZfSU9TRl9TQl9DQ0spIHwgQklUKFZMVl9JT1NGX1NCX1BVTklUKSk7CiAKLQlj
ZGNsa19zdGF0ZS0+dmNvID0gdmx2X2dldF9ocGxsX3ZjbyhkZXZfcHJpdik7Ci0JY2RjbGtfc3Rh
dGUtPmNkY2xrID0gdmx2X2dldF9jY2tfY2xvY2soZGV2X3ByaXYsICJjZGNsayIsCisJY2RjbGtf
c3RhdGUtPnZjbyA9IHZsdl9nZXRfaHBsbF92Y28oaTkxNSk7CisJY2RjbGtfc3RhdGUtPmNkY2xr
ID0gdmx2X2dldF9jY2tfY2xvY2soaTkxNSwgImNkY2xrIiwKIAkJCQkJICAgICAgIENDS19ESVNQ
TEFZX0NMT0NLX0NPTlRST0wsCiAJCQkJCSAgICAgICBjZGNsa19zdGF0ZS0+dmNvKTsKIAotCXZh
bCA9IHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5JVF9SRUdfRFNQU1NQTSk7CisJdmFsID0g
dmx2X3B1bml0X3JlYWQoaTkxNSwgUFVOSVRfUkVHX0RTUFNTUE0pOwogCi0Jdmx2X2lvc2Zfc2Jf
cHV0KGRldl9wcml2LAorCXZsdl9pb3NmX3NiX3B1dChpOTE1LAogCQkJQklUKFZMVl9JT1NGX1NC
X0NDSykgfCBCSVQoVkxWX0lPU0ZfU0JfUFVOSVQpKTsKIAotCWlmIChJU19WQUxMRVlWSUVXKGRl
dl9wcml2KSkKKwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkKIAkJY2RjbGtfc3RhdGUtPnZvbHRh
Z2VfbGV2ZWwgPSAodmFsICYgRFNQRlJFUUdVQVJfTUFTSykgPj4KIAkJCURTUEZSRVFHVUFSX1NI
SUZUOwogCWVsc2UKQEAgLTQ4NiwxOCArNDg2LDE4IEBAIHN0YXRpYyB2b2lkIHZsdl9nZXRfY2Rj
bGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJRFNQRlJFUUdVQVJfU0hJ
RlRfQ0hWOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfcHJvZ3JhbV9wZmlfY3JlZGl0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB2bHZfcHJvZ3JhbV9wZmlf
Y3JlZGl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1bnNpZ25lZCBpbnQg
Y3JlZGl0cywgZGVmYXVsdF9jcmVkaXRzOwogCi0JaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYp
KQorCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQlkZWZhdWx0X2NyZWRpdHMgPSBQRklfQ1JF
RElUKDEyKTsKIAllbHNlCiAJCWRlZmF1bHRfY3JlZGl0cyA9IFBGSV9DUkVESVQoOCk7CiAKLQlp
ZiAoZGV2X3ByaXYtPmNkY2xrLmh3LmNkY2xrID49IGRldl9wcml2LT5jemNsa19mcmVxKSB7CisJ
aWYgKGk5MTUtPmNkY2xrLmh3LmNkY2xrID49IGk5MTUtPmN6Y2xrX2ZyZXEpIHsKIAkJLyogQ0hW
IHN1Z2dlc3RlZCB2YWx1ZSBpcyAzMSBvciA2MyAqLwotCQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZf
cHJpdikpCisJCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQkJY3JlZGl0cyA9IFBGSV9DUkVE
SVRfNjM7CiAJCWVsc2UKIAkJCWNyZWRpdHMgPSBQRklfQ1JFRElUKDE1KTsKQEAgLTUyMiw3ICs1
MjIsNyBAQCBzdGF0aWMgdm9pZCB2bHZfcHJvZ3JhbV9wZmlfY3JlZGl0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJV0FSTl9PTihJOTE1X1JFQUQoR0NJX0NPTlRST0wpICYg
UEZJX0NSRURJVF9SRVNFTkQpOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfc2V0X2NkY2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHZsdl9zZXRfY2RjbGso
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
ZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUsCiAJCQkgIGVudW0gcGlwZSBwaXBlKQogewpAQCAtNTQ4
LDE4ICs1NDgsMTggQEAgc3RhdGljIHZvaWQgdmx2X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogYSBzeXN0ZW0gc3VzcGVuZC4gIFNvIGdyYWIgdGhlIFBJ
UEUtQSBkb21haW4sIHdoaWNoIGNvdmVycwogCSAqIHRoZSBIVyBibG9ja3MgbmVlZGVkIGZvciB0
aGUgZm9sbG93aW5nIHByb2dyYW1taW5nLgogCSAqLwotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2dldChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX1BJUEVfQSk7CisJd2FrZXJlZiA9IGlu
dGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGk5MTUsIFBPV0VSX0RPTUFJTl9QSVBFX0EpOwogCi0Jdmx2
X2lvc2Zfc2JfZ2V0KGRldl9wcml2LAorCXZsdl9pb3NmX3NiX2dldChpOTE1LAogCQkJQklUKFZM
Vl9JT1NGX1NCX0NDSykgfAogCQkJQklUKFZMVl9JT1NGX1NCX0JVTklUKSB8CiAJCQlCSVQoVkxW
X0lPU0ZfU0JfUFVOSVQpKTsKIAotCXZhbCA9IHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5J
VF9SRUdfRFNQU1NQTSk7CisJdmFsID0gdmx2X3B1bml0X3JlYWQoaTkxNSwgUFVOSVRfUkVHX0RT
UFNTUE0pOwogCXZhbCAmPSB+RFNQRlJFUUdVQVJfTUFTSzsKIAl2YWwgfD0gKGNtZCA8PCBEU1BG
UkVRR1VBUl9TSElGVCk7Ci0Jdmx2X3B1bml0X3dyaXRlKGRldl9wcml2LCBQVU5JVF9SRUdfRFNQ
U1NQTSwgdmFsKTsKLQlpZiAod2FpdF9mb3IoKHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5J
VF9SRUdfRFNQU1NQTSkgJgorCXZsdl9wdW5pdF93cml0ZShpOTE1LCBQVU5JVF9SRUdfRFNQU1NQ
TSwgdmFsKTsKKwlpZiAod2FpdF9mb3IoKHZsdl9wdW5pdF9yZWFkKGk5MTUsIFBVTklUX1JFR19E
U1BTU1BNKSAmCiAJCSAgICAgIERTUEZSRVFTVEFUX01BU0spID09IChjbWQgPDwgRFNQRlJFUVNU
QVRfU0hJRlQpLAogCQkgICAgIDUwKSkgewogCQlEUk1fRVJST1IoInRpbWVkIG91dCB3YWl0aW5n
IGZvciBDRGNsayBjaGFuZ2VcbiIpOwpAQCAtNTY4LDIzICs1NjgsMjMgQEAgc3RhdGljIHZvaWQg
dmx2X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKGNk
Y2xrID09IDQwMDAwMCkgewogCQl1MzIgZGl2aWRlcjsKIAotCQlkaXZpZGVyID0gRElWX1JPVU5E
X0NMT1NFU1QoZGV2X3ByaXYtPmhwbGxfZnJlcSA8PCAxLAorCQlkaXZpZGVyID0gRElWX1JPVU5E
X0NMT1NFU1QoaTkxNS0+aHBsbF9mcmVxIDw8IDEsCiAJCQkJCSAgICBjZGNsaykgLSAxOwogCiAJ
CS8qIGFkanVzdCBjZGNsayBkaXZpZGVyICovCi0JCXZhbCA9IHZsdl9jY2tfcmVhZChkZXZfcHJp
diwgQ0NLX0RJU1BMQVlfQ0xPQ0tfQ09OVFJPTCk7CisJCXZhbCA9IHZsdl9jY2tfcmVhZChpOTE1
LCBDQ0tfRElTUExBWV9DTE9DS19DT05UUk9MKTsKIAkJdmFsICY9IH5DQ0tfRlJFUVVFTkNZX1ZB
TFVFUzsKIAkJdmFsIHw9IGRpdmlkZXI7Ci0JCXZsdl9jY2tfd3JpdGUoZGV2X3ByaXYsIENDS19E
SVNQTEFZX0NMT0NLX0NPTlRST0wsIHZhbCk7CisJCXZsdl9jY2tfd3JpdGUoaTkxNSwgQ0NLX0RJ
U1BMQVlfQ0xPQ0tfQ09OVFJPTCwgdmFsKTsKIAotCQlpZiAod2FpdF9mb3IoKHZsdl9jY2tfcmVh
ZChkZXZfcHJpdiwgQ0NLX0RJU1BMQVlfQ0xPQ0tfQ09OVFJPTCkgJgorCQlpZiAod2FpdF9mb3Io
KHZsdl9jY2tfcmVhZChpOTE1LCBDQ0tfRElTUExBWV9DTE9DS19DT05UUk9MKSAmCiAJCQkgICAg
ICBDQ0tfRlJFUVVFTkNZX1NUQVRVUykgPT0gKGRpdmlkZXIgPDwgQ0NLX0ZSRVFVRU5DWV9TVEFU
VVNfU0hJRlQpLAogCQkJICAgICA1MCkpCiAJCQlEUk1fRVJST1IoInRpbWVkIG91dCB3YWl0aW5n
IGZvciBDRGNsayBjaGFuZ2VcbiIpOwogCX0KIAogCS8qIGFkanVzdCBzZWxmLXJlZnJlc2ggZXhp
dCBsYXRlbmN5IHZhbHVlICovCi0JdmFsID0gdmx2X2J1bml0X3JlYWQoZGV2X3ByaXYsIEJVTklU
X1JFR19CSVNPQyk7CisJdmFsID0gdmx2X2J1bml0X3JlYWQoaTkxNSwgQlVOSVRfUkVHX0JJU09D
KTsKIAl2YWwgJj0gfjB4N2Y7CiAKIAkvKgpAQCAtNTk1LDIxICs1OTUsMjEgQEAgc3RhdGljIHZv
aWQgdmx2X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXZh
bCB8PSA0NTAwIC8gMjUwOyAvKiA0LjUgdXNlYyAqLwogCWVsc2UKIAkJdmFsIHw9IDMwMDAgLyAy
NTA7IC8qIDMuMCB1c2VjICovCi0Jdmx2X2J1bml0X3dyaXRlKGRldl9wcml2LCBCVU5JVF9SRUdf
QklTT0MsIHZhbCk7CisJdmx2X2J1bml0X3dyaXRlKGk5MTUsIEJVTklUX1JFR19CSVNPQywgdmFs
KTsKIAotCXZsdl9pb3NmX3NiX3B1dChkZXZfcHJpdiwKKwl2bHZfaW9zZl9zYl9wdXQoaTkxNSwK
IAkJCUJJVChWTFZfSU9TRl9TQl9DQ0spIHwKIAkJCUJJVChWTFZfSU9TRl9TQl9CVU5JVCkgfAog
CQkJQklUKFZMVl9JT1NGX1NCX1BVTklUKSk7CiAKLQlpbnRlbF91cGRhdGVfY2RjbGsoZGV2X3By
aXYpOworCWludGVsX3VwZGF0ZV9jZGNsayhpOTE1KTsKIAotCXZsdl9wcm9ncmFtX3BmaV9jcmVk
aXRzKGRldl9wcml2KTsKKwl2bHZfcHJvZ3JhbV9wZmlfY3JlZGl0cyhpOTE1KTsKIAotCWludGVs
X2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBQT1dFUl9ET01BSU5fUElQRV9BLCB3YWtlcmVm
KTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01BSU5fUElQRV9BLCB3
YWtlcmVmKTsKIH0KIAotc3RhdGljIHZvaWQgY2h2X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBjaHZfc2V0X2NkY2xrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUg
KmNkY2xrX3N0YXRlLAogCQkJICBlbnVtIHBpcGUgcGlwZSkKIHsKQEAgLTYzNCwyNiArNjM0LDI2
IEBAIHN0YXRpYyB2b2lkIGNodl9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCSAqIGEgc3lzdGVtIHN1c3BlbmQuICBTbyBncmFiIHRoZSBQSVBFLUEgZG9tYWlu
LCB3aGljaCBjb3ZlcnMKIAkgKiB0aGUgSFcgYmxvY2tzIG5lZWRlZCBmb3IgdGhlIGZvbGxvd2lu
ZyBwcm9ncmFtbWluZy4KIAkgKi8KLQl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQo
ZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9QSVBFX0EpOworCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2dldChpOTE1LCBQT1dFUl9ET01BSU5fUElQRV9BKTsKIAotCXZsdl9wdW5pdF9nZXQo
ZGV2X3ByaXYpOwotCXZhbCA9IHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5JVF9SRUdfRFNQ
U1NQTSk7CisJdmx2X3B1bml0X2dldChpOTE1KTsKKwl2YWwgPSB2bHZfcHVuaXRfcmVhZChpOTE1
LCBQVU5JVF9SRUdfRFNQU1NQTSk7CiAJdmFsICY9IH5EU1BGUkVRR1VBUl9NQVNLX0NIVjsKIAl2
YWwgfD0gKGNtZCA8PCBEU1BGUkVRR1VBUl9TSElGVF9DSFYpOwotCXZsdl9wdW5pdF93cml0ZShk
ZXZfcHJpdiwgUFVOSVRfUkVHX0RTUFNTUE0sIHZhbCk7Ci0JaWYgKHdhaXRfZm9yKCh2bHZfcHVu
aXRfcmVhZChkZXZfcHJpdiwgUFVOSVRfUkVHX0RTUFNTUE0pICYKKwl2bHZfcHVuaXRfd3JpdGUo
aTkxNSwgUFVOSVRfUkVHX0RTUFNTUE0sIHZhbCk7CisJaWYgKHdhaXRfZm9yKCh2bHZfcHVuaXRf
cmVhZChpOTE1LCBQVU5JVF9SRUdfRFNQU1NQTSkgJgogCQkgICAgICBEU1BGUkVRU1RBVF9NQVNL
X0NIVikgPT0gKGNtZCA8PCBEU1BGUkVRU1RBVF9TSElGVF9DSFYpLAogCQkgICAgIDUwKSkgewog
CQlEUk1fRVJST1IoInRpbWVkIG91dCB3YWl0aW5nIGZvciBDRGNsayBjaGFuZ2VcbiIpOwogCX0K
IAotCXZsdl9wdW5pdF9wdXQoZGV2X3ByaXYpOworCXZsdl9wdW5pdF9wdXQoaTkxNSk7CiAKLQlp
bnRlbF91cGRhdGVfY2RjbGsoZGV2X3ByaXYpOworCWludGVsX3VwZGF0ZV9jZGNsayhpOTE1KTsK
IAotCXZsdl9wcm9ncmFtX3BmaV9jcmVkaXRzKGRldl9wcml2KTsKKwl2bHZfcHJvZ3JhbV9wZmlf
Y3JlZGl0cyhpOTE1KTsKIAotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBQT1dF
Ul9ET01BSU5fUElQRV9BLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1
LCBQT1dFUl9ET01BSU5fUElQRV9BLCB3YWtlcmVmKTsKIH0KIAogc3RhdGljIGludCBiZHdfY2Fs
Y19jZGNsayhpbnQgbWluX2NkY2xrKQpAQCAtNjgzLDcgKzY4Myw3IEBAIHN0YXRpYyB1OCBiZHdf
Y2FsY192b2x0YWdlX2xldmVsKGludCBjZGNsaykKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIGJkd19n
ZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQg
YmR3X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgc3RydWN0
IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSkKIHsKIAl1MzIgbGNwbGwgPSBJOTE1X1JF
QUQoTENQTExfQ1RMKTsKQEAgLTcxMCw3ICs3MTAsNyBAQCBzdGF0aWMgdm9pZCBiZHdfZ2V0X2Nk
Y2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJYmR3X2NhbGNfdm9sdGFn
ZV9sZXZlbChjZGNsa19zdGF0ZS0+Y2RjbGspOwogfQogCi1zdGF0aWMgdm9pZCBiZHdfc2V0X2Nk
Y2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGJkd19z
ZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUsCiAJCQkgIGVudW0gcGlwZSBwaXBlKQog
ewpAQCAtNzI2LDcgKzcyNiw3IEBAIHN0YXRpYyB2b2lkIGJkd19zZXRfY2RjbGsoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkgInRyeWluZyB0byBjaGFuZ2UgY2RjbGsgZnJl
cXVlbmN5IHdpdGggY2RjbGsgbm90IGVuYWJsZWRcbiIpKQogCQlyZXR1cm47CiAKLQlyZXQgPSBz
YW5keWJyaWRnZV9wY29kZV93cml0ZShkZXZfcHJpdiwKKwlyZXQgPSBzYW5keWJyaWRnZV9wY29k
ZV93cml0ZShpOTE1LAogCQkJCSAgICAgIEJEV19QQ09ERV9ESVNQTEFZX0ZSRVFfQ0hBTkdFX1JF
USwgMHgwKTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiZmFpbGVkIHRvIGluZm9ybSBwY29k
ZSBhYm91dCBjZGNsayBjaGFuZ2VcbiIpOwpAQCAtNzc2LDEyICs3NzYsMTIgQEAgc3RhdGljIHZv
aWQgYmR3X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQlM
Q1BMTF9DRF9TT1VSQ0VfRkNMS19ET05FKSA9PSAwLCAxKSkKIAkJRFJNX0VSUk9SKCJTd2l0Y2hp
bmcgYmFjayB0byBMQ1BMTCBmYWlsZWRcbiIpOwogCi0Jc2FuZHlicmlkZ2VfcGNvZGVfd3JpdGUo
ZGV2X3ByaXYsIEhTV19QQ09ERV9ERV9XUklURV9GUkVRX1JFUSwKKwlzYW5keWJyaWRnZV9wY29k
ZV93cml0ZShpOTE1LCBIU1dfUENPREVfREVfV1JJVEVfRlJFUV9SRVEsCiAJCQkJY2RjbGtfc3Rh
dGUtPnZvbHRhZ2VfbGV2ZWwpOwogCiAJSTkxNV9XUklURShDRENMS19GUkVRLCBESVZfUk9VTkRf
Q0xPU0VTVChjZGNsaywgMTAwMCkgLSAxKTsKIAotCWludGVsX3VwZGF0ZV9jZGNsayhkZXZfcHJp
dik7CisJaW50ZWxfdXBkYXRlX2NkY2xrKGk5MTUpOwogfQogCiBzdGF0aWMgaW50IHNrbF9jYWxj
X2NkY2xrKGludCBtaW5fY2RjbGssIGludCB2Y28pCkBAIC04MTksNyArODE5LDcgQEAgc3RhdGlj
IHU4IHNrbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQogCQlyZXR1cm4gMDsKIH0KIAot
c3RhdGljIHZvaWQgc2tsX2RwbGwwX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBza2xfZHBsbDBfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRl
KQogewogCXUzMiB2YWw7CkBAIC04NTksMTIgKzg1OSwxMiBAQCBzdGF0aWMgdm9pZCBza2xfZHBs
bDBfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl9CiB9CiAKLXN0
YXRpYyB2b2lkIHNrbF9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIHZvaWQgc2tsX2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCSAgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSkKIHsKIAl1MzIg
Y2RjdGw7CiAKLQlza2xfZHBsbDBfdXBkYXRlKGRldl9wcml2LCBjZGNsa19zdGF0ZSk7CisJc2ts
X2RwbGwwX3VwZGF0ZShpOTE1LCBjZGNsa19zdGF0ZSk7CiAKIAljZGNsa19zdGF0ZS0+Y2RjbGsg
PSBjZGNsa19zdGF0ZS0+YnlwYXNzID0gY2RjbGtfc3RhdGUtPnJlZjsKIApAQCAtOTI2LDE4ICs5
MjYsMTggQEAgc3RhdGljIGludCBza2xfY2RjbGtfZGVjaW1hbChpbnQgY2RjbGspCiAJcmV0dXJu
IERJVl9ST1VORF9DTE9TRVNUKGNkY2xrIC0gMTAwMCwgNTAwKTsKIH0KIAotc3RhdGljIHZvaWQg
c2tsX3NldF9wcmVmZXJyZWRfY2RjbGtfdmNvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyB2b2lkIHNrbF9zZXRfcHJlZmVycmVkX2NkY2xrX3ZjbyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJaW50IHZjbykKIHsKLQlib29sIGNoYW5nZWQgPSBk
ZXZfcHJpdi0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcSAhPSB2Y287CisJYm9vbCBjaGFuZ2VkID0g
aTkxNS0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcSAhPSB2Y287CiAKLQlkZXZfcHJpdi0+c2tsX3By
ZWZlcnJlZF92Y29fZnJlcSA9IHZjbzsKKwlpOTE1LT5za2xfcHJlZmVycmVkX3Zjb19mcmVxID0g
dmNvOwogCiAJaWYgKGNoYW5nZWQpCi0JCWludGVsX3VwZGF0ZV9tYXhfY2RjbGsoZGV2X3ByaXYp
OworCQlpbnRlbF91cGRhdGVfbWF4X2NkY2xrKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBza2xf
ZHBsbDBfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50IHZjbykK
K3N0YXRpYyB2b2lkIHNrbF9kcGxsMF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsIGludCB2Y28pCiB7CiAJdTMyIHZhbDsKIApAQCAtOTY5LDI5ICs5NjksMjkgQEAgc3RhdGlj
IHZvaWQgc2tsX2RwbGwwX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IGludCB2Y28pCiAKIAlJOTE1X1dSSVRFKExDUExMMV9DVEwsIEk5MTVfUkVBRChMQ1BMTDFfQ1RM
KSB8IExDUExMX1BMTF9FTkFCTEUpOwogCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZk
ZXZfcHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5j
b3JlLAogCQkJCSAgICBMQ1BMTDFfQ1RMLCBMQ1BMTF9QTExfTE9DSywgTENQTExfUExMX0xPQ0ss
CiAJCQkJICAgIDUpKQogCQlEUk1fRVJST1IoIkRQTEwwIG5vdCBsb2NrZWRcbiIpOwogCi0JZGV2
X3ByaXYtPmNkY2xrLmh3LnZjbyA9IHZjbzsKKwlpOTE1LT5jZGNsay5ody52Y28gPSB2Y287CiAK
IAkvKiBXZSdsbCB3YW50IHRvIGtlZXAgdXNpbmcgdGhlIGN1cnJlbnQgdmNvIGZyb20gbm93IG9u
LiAqLwotCXNrbF9zZXRfcHJlZmVycmVkX2NkY2xrX3ZjbyhkZXZfcHJpdiwgdmNvKTsKKwlza2xf
c2V0X3ByZWZlcnJlZF9jZGNsa192Y28oaTkxNSwgdmNvKTsKIH0KIAotc3RhdGljIHZvaWQgc2ts
X2RwbGwwX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgc2tsX2RwbGwwX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
CiAJSTkxNV9XUklURShMQ1BMTDFfQ1RMLCBJOTE1X1JFQUQoTENQTEwxX0NUTCkgJiB+TENQTExf
UExMX0VOQUJMRSk7Ci0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5j
b3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCSAg
ICBMQ1BMTDFfQ1RMLCBMQ1BMTF9QTExfTE9DSywgMCwKIAkJCQkgICAgMSkpCiAJCURSTV9FUlJP
UigiQ291bGRuJ3QgZGlzYWJsZSBEUExMMFxuIik7CiAKLQlkZXZfcHJpdi0+Y2RjbGsuaHcudmNv
ID0gMDsKKwlpOTE1LT5jZGNsay5ody52Y28gPSAwOwogfQogCi1zdGF0aWMgdm9pZCBza2xfc2V0
X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHNr
bF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIGNvbnN0IHN0
cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUsCiAJCQkgIGVudW0gcGlwZSBwaXBl
KQogewpAQCAtMTAwOCw5ICsxMDA4LDkgQEAgc3RhdGljIHZvaWQgc2tsX3NldF9jZGNsayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogdXNlIHRoZSBjb3JyZXNwb25kaW5n
IFZDTyBmcmVxIGFzIHRoYXQgYWx3YXlzIGxlYWRzIHRvIHVzaW5nIHRoZQogCSAqIG1pbmltdW0g
MzA4TUh6IENEQ0xLLgogCSAqLwotCVdBUk5fT05fT05DRShJU19TS1lMQUtFKGRldl9wcml2KSAm
JiB2Y28gPT0gODY0MDAwMCk7CisJV0FSTl9PTl9PTkNFKElTX1NLWUxBS0UoaTkxNSkgJiYgdmNv
ID09IDg2NDAwMDApOwogCi0JcmV0ID0gc2tsX3Bjb2RlX3JlcXVlc3QoZGV2X3ByaXYsIFNLTF9Q
Q09ERV9DRENMS19DT05UUk9MLAorCXJldCA9IHNrbF9wY29kZV9yZXF1ZXN0KGk5MTUsIFNLTF9Q
Q09ERV9DRENMS19DT05UUk9MLAogCQkJCVNLTF9DRENMS19QUkVQQVJFX0ZPUl9DSEFOR0UsCiAJ
CQkJU0tMX0NEQ0xLX1JFQURZX0ZPUl9DSEFOR0UsCiAJCQkJU0tMX0NEQ0xLX1JFQURZX0ZPUl9D
SEFOR0UsIDMpOwpAQCAtMTAyMyw3ICsxMDIzLDcgQEAgc3RhdGljIHZvaWQgc2tsX3NldF9jZGNs
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJLyogQ2hvb3NlIGZyZXF1ZW5j
eSBmb3IgdGhpcyBjZGNsayAqLwogCXN3aXRjaCAoY2RjbGspIHsKIAlkZWZhdWx0OgotCQlXQVJO
X09OKGNkY2xrICE9IGRldl9wcml2LT5jZGNsay5ody5ieXBhc3MpOworCQlXQVJOX09OKGNkY2xr
ICE9IGk5MTUtPmNkY2xrLmh3LmJ5cGFzcyk7CiAJCVdBUk5fT04odmNvICE9IDApOwogCQkvKiBm
YWxsIHRocm91Z2ggKi8KIAljYXNlIDMwODU3MToKQEAgLTEwNDMsMTMgKzEwNDMsMTMgQEAgc3Rh
dGljIHZvaWQgc2tsX3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJCWJyZWFrOwogCX0KIAotCWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IDAgJiYKLQkg
ICAgZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyAhPSB2Y28pCi0JCXNrbF9kcGxsMF9kaXNhYmxlKGRl
dl9wcml2KTsKKwlpZiAoaTkxNS0+Y2RjbGsuaHcudmNvICE9IDAgJiYKKwkgICAgaTkxNS0+Y2Rj
bGsuaHcudmNvICE9IHZjbykKKwkJc2tsX2RwbGwwX2Rpc2FibGUoaTkxNSk7CiAKIAljZGNsa19j
dGwgPSBJOTE1X1JFQUQoQ0RDTEtfQ1RMKTsKIAotCWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcudmNv
ICE9IHZjbykgeworCWlmIChpOTE1LT5jZGNsay5ody52Y28gIT0gdmNvKSB7CiAJCS8qIFdhIERp
c3BsYXkgIzExODM6IHNrbCxrYmwsY2ZsICovCiAJCWNkY2xrX2N0bCAmPSB+KENEQ0xLX0ZSRVFf
U0VMX01BU0sgfCBDRENMS19GUkVRX0RFQ0lNQUxfTUFTSyk7CiAJCWNkY2xrX2N0bCB8PSBmcmVx
X3NlbGVjdCB8IHNrbF9jZGNsa19kZWNpbWFsKGNkY2xrKTsKQEAgLTEwNjEsOCArMTA2MSw4IEBA
IHN0YXRpYyB2b2lkIHNrbF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCUk5MTVfV1JJVEUoQ0RDTEtfQ1RMLCBjZGNsa19jdGwpOwogCVBPU1RJTkdfUkVBRChD
RENMS19DVEwpOwogCi0JaWYgKGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gdmNvKQotCQlza2xf
ZHBsbDBfZW5hYmxlKGRldl9wcml2LCB2Y28pOworCWlmIChpOTE1LT5jZGNsay5ody52Y28gIT0g
dmNvKQorCQlza2xfZHBsbDBfZW5hYmxlKGk5MTUsIHZjbyk7CiAKIAkvKiBXYSBEaXNwbGF5ICMx
MTgzOiBza2wsa2JsLGNmbCAqLwogCWNkY2xrX2N0bCAmPSB+KENEQ0xLX0ZSRVFfU0VMX01BU0sg
fCBDRENMS19GUkVRX0RFQ0lNQUxfTUFTSyk7CkBAIC0xMDc3LDEzICsxMDc3LDEzIEBAIHN0YXRp
YyB2b2lkIHNrbF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CVBPU1RJTkdfUkVBRChDRENMS19DVEwpOwogCiAJLyogaW5mb3JtIFBDVSBvZiB0aGUgY2hhbmdl
ICovCi0Jc2FuZHlicmlkZ2VfcGNvZGVfd3JpdGUoZGV2X3ByaXYsIFNLTF9QQ09ERV9DRENMS19D
T05UUk9MLAorCXNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlKGk5MTUsIFNLTF9QQ09ERV9DRENMS19D
T05UUk9MLAogCQkJCWNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsKTsKIAotCWludGVsX3VwZGF0
ZV9jZGNsayhkZXZfcHJpdik7CisJaW50ZWxfdXBkYXRlX2NkY2xrKGk5MTUpOwogfQogCi1zdGF0
aWMgdm9pZCBza2xfc2FuaXRpemVfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIHZvaWQgc2tsX3Nhbml0aXplX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCXUzMiBjZGN0bCwgZXhwZWN0ZWQ7CiAKQEAgLTEwOTUsMTIgKzEwOTUs
MTIgQEAgc3RhdGljIHZvaWQgc2tsX3Nhbml0aXplX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlpZiAoKEk5MTVfUkVBRChTV0ZfSUxLKDB4MTgpKSAmIDB4MDBGRkZG
RkYpID09IDApCiAJCWdvdG8gc2FuaXRpemU7CiAKLQlpbnRlbF91cGRhdGVfY2RjbGsoZGV2X3By
aXYpOwotCWludGVsX2R1bXBfY2RjbGtfc3RhdGUoJmRldl9wcml2LT5jZGNsay5odywgIkN1cnJl
bnQgQ0RDTEsiKTsKKwlpbnRlbF91cGRhdGVfY2RjbGsoaTkxNSk7CisJaW50ZWxfZHVtcF9jZGNs
a19zdGF0ZSgmaTkxNS0+Y2RjbGsuaHcsICJDdXJyZW50IENEQ0xLIik7CiAKIAkvKiBJcyBQTEwg
ZW5hYmxlZCBhbmQgbG9ja2VkID8gKi8KLQlpZiAoZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyA9PSAw
IHx8Ci0JICAgIGRldl9wcml2LT5jZGNsay5ody5jZGNsayA9PSBkZXZfcHJpdi0+Y2RjbGsuaHcu
YnlwYXNzKQorCWlmIChpOTE1LT5jZGNsay5ody52Y28gPT0gMCB8fAorCSAgICBpOTE1LT5jZGNs
ay5ody5jZGNsayA9PSBpOTE1LT5jZGNsay5ody5ieXBhc3MpCiAJCWdvdG8gc2FuaXRpemU7CiAK
IAkvKiBEUExMIG9rYXk7IHZlcmlmeSB0aGUgY2RjbG9jawpAQCAtMTExMSw3ICsxMTExLDcgQEAg
c3RhdGljIHZvaWQgc2tsX3Nhbml0aXplX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAkgKi8KIAljZGN0bCA9IEk5MTVfUkVBRChDRENMS19DVEwpOwogCWV4cGVjdGVk
ID0gKGNkY3RsICYgQ0RDTEtfRlJFUV9TRUxfTUFTSykgfAotCQlza2xfY2RjbGtfZGVjaW1hbChk
ZXZfcHJpdi0+Y2RjbGsuaHcuY2RjbGspOworCQlza2xfY2RjbGtfZGVjaW1hbChpOTE1LT5jZGNs
ay5ody5jZGNsayk7CiAJaWYgKGNkY3RsID09IGV4cGVjdGVkKQogCQkvKiBBbGwgd2VsbDsgbm90
aGluZyB0byBzYW5pdGl6ZSAqLwogCQlyZXR1cm47CkBAIC0xMTIwLDQ5ICsxMTIwLDQ5IEBAIHN0
YXRpYyB2b2lkIHNrbF9zYW5pdGl6ZV9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJRFJNX0RFQlVHX0tNUygiU2FuaXRpemluZyBjZGNsayBwcm9ncmFtbWVkIGJ5IHBy
ZS1vc1xuIik7CiAKIAkvKiBmb3JjZSBjZGNsayBwcm9ncmFtbWluZyAqLwotCWRldl9wcml2LT5j
ZGNsay5ody5jZGNsayA9IDA7CisJaTkxNS0+Y2RjbGsuaHcuY2RjbGsgPSAwOwogCS8qIGZvcmNl
IGZ1bGwgUExMIGRpc2FibGUgKyBlbmFibGUgKi8KLQlkZXZfcHJpdi0+Y2RjbGsuaHcudmNvID0g
LTE7CisJaTkxNS0+Y2RjbGsuaHcudmNvID0gLTE7CiB9CiAKLXN0YXRpYyB2b2lkIHNrbF9pbml0
X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHNr
bF9pbml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBp
bnRlbF9jZGNsa19zdGF0ZSBjZGNsa19zdGF0ZTsKIAotCXNrbF9zYW5pdGl6ZV9jZGNsayhkZXZf
cHJpdik7CisJc2tsX3Nhbml0aXplX2NkY2xrKGk5MTUpOwogCi0JaWYgKGRldl9wcml2LT5jZGNs
ay5ody5jZGNsayAhPSAwICYmCi0JICAgIGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gMCkgewor
CWlmIChpOTE1LT5jZGNsay5ody5jZGNsayAhPSAwICYmCisJICAgIGk5MTUtPmNkY2xrLmh3LnZj
byAhPSAwKSB7CiAJCS8qCiAJCSAqIFVzZSB0aGUgY3VycmVudCB2Y28gYXMgb3VyIGluaXRpYWwK
IAkJICogZ3Vlc3MgYXMgdG8gd2hhdCB0aGUgcHJlZmVycmVkIHZjbyBpcy4KIAkJICovCi0JCWlm
IChkZXZfcHJpdi0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcSA9PSAwKQotCQkJc2tsX3NldF9wcmVm
ZXJyZWRfY2RjbGtfdmNvKGRldl9wcml2LAotCQkJCQkJICAgIGRldl9wcml2LT5jZGNsay5ody52
Y28pOworCQlpZiAoaTkxNS0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcSA9PSAwKQorCQkJc2tsX3Nl
dF9wcmVmZXJyZWRfY2RjbGtfdmNvKGk5MTUsCisJCQkJCQkgICAgaTkxNS0+Y2RjbGsuaHcudmNv
KTsKIAkJcmV0dXJuOwogCX0KIAotCWNkY2xrX3N0YXRlID0gZGV2X3ByaXYtPmNkY2xrLmh3Owor
CWNkY2xrX3N0YXRlID0gaTkxNS0+Y2RjbGsuaHc7CiAKLQljZGNsa19zdGF0ZS52Y28gPSBkZXZf
cHJpdi0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcTsKKwljZGNsa19zdGF0ZS52Y28gPSBpOTE1LT5z
a2xfcHJlZmVycmVkX3Zjb19mcmVxOwogCWlmIChjZGNsa19zdGF0ZS52Y28gPT0gMCkKIAkJY2Rj
bGtfc3RhdGUudmNvID0gODEwMDAwMDsKIAljZGNsa19zdGF0ZS5jZGNsayA9IHNrbF9jYWxjX2Nk
Y2xrKDAsIGNkY2xrX3N0YXRlLnZjbyk7CiAJY2RjbGtfc3RhdGUudm9sdGFnZV9sZXZlbCA9IHNr
bF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoY2RjbGtfc3RhdGUuY2RjbGspOwogCi0Jc2tsX3NldF9jZGNs
ayhkZXZfcHJpdiwgJmNkY2xrX3N0YXRlLCBJTlZBTElEX1BJUEUpOworCXNrbF9zZXRfY2RjbGso
aTkxNSwgJmNkY2xrX3N0YXRlLCBJTlZBTElEX1BJUEUpOwogfQogCi1zdGF0aWMgdm9pZCBza2xf
dW5pbml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIHNrbF91bmluaXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0J
c3RydWN0IGludGVsX2NkY2xrX3N0YXRlIGNkY2xrX3N0YXRlID0gZGV2X3ByaXYtPmNkY2xrLmh3
OworCXN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSBjZGNsa19zdGF0ZSA9IGk5MTUtPmNkY2xrLmh3
OwogCiAJY2RjbGtfc3RhdGUuY2RjbGsgPSBjZGNsa19zdGF0ZS5ieXBhc3M7CiAJY2RjbGtfc3Rh
dGUudmNvID0gMDsKIAljZGNsa19zdGF0ZS52b2x0YWdlX2xldmVsID0gc2tsX2NhbGNfdm9sdGFn
ZV9sZXZlbChjZGNsa19zdGF0ZS5jZGNsayk7CiAKLQlza2xfc2V0X2NkY2xrKGRldl9wcml2LCAm
Y2RjbGtfc3RhdGUsIElOVkFMSURfUElQRSk7CisJc2tsX3NldF9jZGNsayhpOTE1LCAmY2RjbGtf
c3RhdGUsIElOVkFMSURfUElQRSk7CiB9CiAKIHN0YXRpYyBpbnQgYnh0X2NhbGNfY2RjbGsoaW50
IG1pbl9jZGNsaykKQEAgLTExOTQsMTEgKzExOTQsMTEgQEAgc3RhdGljIHU4IGJ4dF9jYWxjX3Zv
bHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQogCXJldHVybiBESVZfUk9VTkRfVVAoY2RjbGssIDI1MDAw
KTsKIH0KIAotc3RhdGljIGludCBieHRfZGVfcGxsX3ZjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIGludCBjZGNsaykKK3N0YXRpYyBpbnQgYnh0X2RlX3BsbF92Y28oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCBjZGNsaykKIHsKIAlpbnQgcmF0aW87CiAKLQlp
ZiAoY2RjbGsgPT0gZGV2X3ByaXYtPmNkY2xrLmh3LmJ5cGFzcykKKwlpZiAoY2RjbGsgPT0gaTkx
NS0+Y2RjbGsuaHcuYnlwYXNzKQogCQlyZXR1cm4gMDsKIAogCXN3aXRjaCAoY2RjbGspIHsKQEAg
LTEyMTYsMTQgKzEyMTYsMTQgQEAgc3RhdGljIGludCBieHRfZGVfcGxsX3ZjbyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCBjZGNsaykKIAkJYnJlYWs7CiAJfQogCi0JcmV0
dXJuIGRldl9wcml2LT5jZGNsay5ody5yZWYgKiByYXRpbzsKKwlyZXR1cm4gaTkxNS0+Y2RjbGsu
aHcucmVmICogcmF0aW87CiB9CiAKLXN0YXRpYyBpbnQgZ2xrX2RlX3BsbF92Y28oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgY2RjbGspCitzdGF0aWMgaW50IGdsa19kZV9w
bGxfdmNvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgY2RjbGspCiB7CiAJaW50
IHJhdGlvOwogCi0JaWYgKGNkY2xrID09IGRldl9wcml2LT5jZGNsay5ody5ieXBhc3MpCisJaWYg
KGNkY2xrID09IGk5MTUtPmNkY2xrLmh3LmJ5cGFzcykKIAkJcmV0dXJuIDA7CiAKIAlzd2l0Y2gg
KGNkY2xrKSB7CkBAIC0xMjM3LDEwICsxMjM3LDEwIEBAIHN0YXRpYyBpbnQgZ2xrX2RlX3BsbF92
Y28oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgY2RjbGspCiAJCWJyZWFr
OwogCX0KIAotCXJldHVybiBkZXZfcHJpdi0+Y2RjbGsuaHcucmVmICogcmF0aW87CisJcmV0dXJu
IGk5MTUtPmNkY2xrLmh3LnJlZiAqIHJhdGlvOwogfQogCi1zdGF0aWMgdm9pZCBieHRfZGVfcGxs
X3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBi
eHRfZGVfcGxsX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAg
IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUpCiB7CiAJdTMyIHZhbDsKQEAg
LTEyNTksMTMgKzEyNTksMTMgQEAgc3RhdGljIHZvaWQgYnh0X2RlX3BsbF91cGRhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWNkY2xrX3N0YXRlLT52Y28gPSAodmFsICYg
QlhUX0RFX1BMTF9SQVRJT19NQVNLKSAqIGNkY2xrX3N0YXRlLT5yZWY7CiB9CiAKLXN0YXRpYyB2
b2lkIGJ4dF9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIHZvaWQgYnh0X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CSAgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSkKIHsKIAl1MzIgZGl2aWRl
cjsKIAlpbnQgZGl2OwogCi0JYnh0X2RlX3BsbF91cGRhdGUoZGV2X3ByaXYsIGNkY2xrX3N0YXRl
KTsKKwlieHRfZGVfcGxsX3VwZGF0ZShpOTE1LCBjZGNsa19zdGF0ZSk7CiAKIAljZGNsa19zdGF0
ZS0+Y2RjbGsgPSBjZGNsa19zdGF0ZS0+YnlwYXNzID0gY2RjbGtfc3RhdGUtPnJlZjsKIApAQCAt
MTI3OSw3ICsxMjc5LDcgQEAgc3RhdGljIHZvaWQgYnh0X2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWRpdiA9IDI7CiAJCWJyZWFrOwogCWNhc2UgQlhUX0NE
Q0xLX0NEMlhfRElWX1NFTF8xXzU6Ci0JCVdBUk4oSVNfR0VNSU5JTEFLRShkZXZfcHJpdiksICJV
bnN1cHBvcnRlZCBkaXZpZGVyXG4iKTsKKwkJV0FSTihJU19HRU1JTklMQUtFKGk5MTUpLCAiVW5z
dXBwb3J0ZWQgZGl2aWRlclxuIik7CiAJCWRpdiA9IDM7CiAJCWJyZWFrOwogCWNhc2UgQlhUX0NE
Q0xLX0NEMlhfRElWX1NFTF8yOgpAQCAtMTMwNCwyMiArMTMwNCwyMiBAQCBzdGF0aWMgdm9pZCBi
eHRfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJYnh0X2Nh
bGNfdm9sdGFnZV9sZXZlbChjZGNsa19zdGF0ZS0+Y2RjbGspOwogfQogCi1zdGF0aWMgdm9pZCBi
eHRfZGVfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgYnh0X2RlX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewogCUk5MTVfV1JJVEUoQlhUX0RFX1BMTF9FTkFCTEUsIDApOwogCiAJLyogVGltZW91dCAy
MDB1cyAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwK
KwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkgICAgQlhU
X0RFX1BMTF9FTkFCTEUsIEJYVF9ERV9QTExfTE9DSywgMCwKIAkJCQkgICAgMSkpCiAJCURSTV9F
UlJPUigidGltZW91dCB3YWl0aW5nIGZvciBERSBQTEwgdW5sb2NrXG4iKTsKIAotCWRldl9wcml2
LT5jZGNsay5ody52Y28gPSAwOworCWk5MTUtPmNkY2xrLmh3LnZjbyA9IDA7CiB9CiAKLXN0YXRp
YyB2b2lkIGJ4dF9kZV9wbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgaW50IHZjbykKK3N0YXRpYyB2b2lkIGJ4dF9kZV9wbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LCBpbnQgdmNvKQogewotCWludCByYXRpbyA9IERJVl9ST1VORF9DTE9T
RVNUKHZjbywgZGV2X3ByaXYtPmNkY2xrLmh3LnJlZik7CisJaW50IHJhdGlvID0gRElWX1JPVU5E
X0NMT1NFU1QodmNvLCBpOTE1LT5jZGNsay5ody5yZWYpOwogCXUzMiB2YWw7CiAKIAl2YWwgPSBJ
OTE1X1JFQUQoQlhUX0RFX1BMTF9DVEwpOwpAQCAtMTMzMCwxNyArMTMzMCwxNyBAQCBzdGF0aWMg
dm9pZCBieHRfZGVfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IGludCB2Y28pCiAJSTkxNV9XUklURShCWFRfREVfUExMX0VOQUJMRSwgQlhUX0RFX1BMTF9QTExf
RU5BQkxFKTsKIAogCS8qIFRpbWVvdXQgMjAwdXMgKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVn
aXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZp
OTE1LT51bmNvcmUsCiAJCQkJICAgIEJYVF9ERV9QTExfRU5BQkxFLAogCQkJCSAgICBCWFRfREVf
UExMX0xPQ0ssCiAJCQkJICAgIEJYVF9ERV9QTExfTE9DSywKIAkJCQkgICAgMSkpCiAJCURSTV9F
UlJPUigidGltZW91dCB3YWl0aW5nIGZvciBERSBQTEwgbG9ja1xuIik7CiAKLQlkZXZfcHJpdi0+
Y2RjbGsuaHcudmNvID0gdmNvOworCWk5MTUtPmNkY2xrLmh3LnZjbyA9IHZjbzsKIH0KIAotc3Rh
dGljIHZvaWQgYnh0X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitzdGF0aWMgdm9pZCBieHRfc2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlLAogCQkJ
ICBlbnVtIHBpcGUgcGlwZSkKIHsKQEAgLTEzNTIsMTQgKzEzNTIsMTQgQEAgc3RhdGljIHZvaWQg
Ynh0X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJLyogY2Rj
bGsgPSB2Y28gLyAyIC8gZGl2ezEsMS41LDIsNH0gKi8KIAlzd2l0Y2ggKERJVl9ST1VORF9DTE9T
RVNUKHZjbywgY2RjbGspKSB7CiAJZGVmYXVsdDoKLQkJV0FSTl9PTihjZGNsayAhPSBkZXZfcHJp
di0+Y2RjbGsuaHcuYnlwYXNzKTsKKwkJV0FSTl9PTihjZGNsayAhPSBpOTE1LT5jZGNsay5ody5i
eXBhc3MpOwogCQlXQVJOX09OKHZjbyAhPSAwKTsKIAkJLyogZmFsbCB0aHJvdWdoICovCiAJY2Fz
ZSAyOgogCQlkaXZpZGVyID0gQlhUX0NEQ0xLX0NEMlhfRElWX1NFTF8xOwogCQlicmVhazsKIAlj
YXNlIDM6Ci0JCVdBUk4oSVNfR0VNSU5JTEFLRShkZXZfcHJpdiksICJVbnN1cHBvcnRlZCBkaXZp
ZGVyXG4iKTsKKwkJV0FSTihJU19HRU1JTklMQUtFKGk5MTUpLCAiVW5zdXBwb3J0ZWQgZGl2aWRl
clxuIik7CiAJCWRpdmlkZXIgPSBCWFRfQ0RDTEtfQ0QyWF9ESVZfU0VMXzFfNTsKIAkJYnJlYWs7
CiAJY2FzZSA0OgpAQCAtMTM3NSw3ICsxMzc1LDcgQEAgc3RhdGljIHZvaWQgYnh0X3NldF9jZGNs
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogcmVxdWlyZXMgdXMgdG8g
d2FpdCB1cCB0byAxNTB1c2VjLCBidXQgdGhhdCBsZWFkcyB0byB0aW1lb3V0czsKIAkgKiB0aGUg
Mm1zIHVzZWQgaGVyZSBpcyBiYXNlZCBvbiBleHBlcmltZW50LgogCSAqLwotCXJldCA9IHNhbmR5
YnJpZGdlX3Bjb2RlX3dyaXRlX3RpbWVvdXQoZGV2X3ByaXYsCisJcmV0ID0gc2FuZHlicmlkZ2Vf
cGNvZGVfd3JpdGVfdGltZW91dChpOTE1LAogCQkJCQkgICAgICBIU1dfUENPREVfREVfV1JJVEVf
RlJFUV9SRVEsCiAJCQkJCSAgICAgIDB4ODAwMDAwMDAsIDE1MCwgMik7CiAJaWYgKHJldCkgewpA
QCAtMTM4NCwxMiArMTM4NCwxMiBAQCBzdGF0aWMgdm9pZCBieHRfc2V0X2NkY2xrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuOwogCX0KIAotCWlmIChkZXZfcHJp
di0+Y2RjbGsuaHcudmNvICE9IDAgJiYKLQkgICAgZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyAhPSB2
Y28pCi0JCWJ4dF9kZV9wbGxfZGlzYWJsZShkZXZfcHJpdik7CisJaWYgKGk5MTUtPmNkY2xrLmh3
LnZjbyAhPSAwICYmCisJICAgIGk5MTUtPmNkY2xrLmh3LnZjbyAhPSB2Y28pCisJCWJ4dF9kZV9w
bGxfZGlzYWJsZShpOTE1KTsKIAotCWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IHZjbykK
LQkJYnh0X2RlX3BsbF9lbmFibGUoZGV2X3ByaXYsIHZjbyk7CisJaWYgKGk5MTUtPmNkY2xrLmh3
LnZjbyAhPSB2Y28pCisJCWJ4dF9kZV9wbGxfZW5hYmxlKGk5MTUsIHZjbyk7CiAKIAl2YWwgPSBk
aXZpZGVyIHwgc2tsX2NkY2xrX2RlY2ltYWwoY2RjbGspOwogCWlmIChwaXBlID09IElOVkFMSURf
UElQRSkKQEAgLTE0MDUsNyArMTQwNSw3IEBAIHN0YXRpYyB2b2lkIGJ4dF9zZXRfY2RjbGsoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoQ0RDTEtfQ1RMLCB2
YWwpOwogCiAJaWYgKHBpcGUgIT0gSU5WQUxJRF9QSVBFKQotCQlpbnRlbF93YWl0X2Zvcl92Ymxh
bmsoZGV2X3ByaXYsIHBpcGUpOworCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoaTkxNSwgcGlwZSk7
CiAKIAkvKgogCSAqIFRoZSB0aW1lb3V0IGlzbid0IHNwZWNpZmllZCwgdGhlIDJtcyB1c2VkIGhl
cmUgaXMgYmFzZWQgb24KQEAgLTE0MTMsNyArMTQxMyw3IEBAIHN0YXRpYyB2b2lkIGJ4dF9zZXRf
Y2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIEZJWE1FOiBXYWl0
aW5nIGZvciB0aGUgcmVxdWVzdCBjb21wbGV0aW9uIGNvdWxkIGJlIGRlbGF5ZWQgdW50aWwKIAkg
KiB0aGUgbmV4dCBQQ09ERSByZXF1ZXN0IGJhc2VkIG9uIEJTcGVjLgogCSAqLwotCXJldCA9IHNh
bmR5YnJpZGdlX3Bjb2RlX3dyaXRlX3RpbWVvdXQoZGV2X3ByaXYsCisJcmV0ID0gc2FuZHlicmlk
Z2VfcGNvZGVfd3JpdGVfdGltZW91dChpOTE1LAogCQkJCQkgICAgICBIU1dfUENPREVfREVfV1JJ
VEVfRlJFUV9SRVEsCiAJCQkJCSAgICAgIGNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsLCAxNTAs
IDIpOwogCWlmIChyZXQpIHsKQEAgLTE0MjIsMTggKzE0MjIsMTggQEAgc3RhdGljIHZvaWQgYnh0
X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsK
IAl9CiAKLQlpbnRlbF91cGRhdGVfY2RjbGsoZGV2X3ByaXYpOworCWludGVsX3VwZGF0ZV9jZGNs
ayhpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgYnh0X3Nhbml0aXplX2NkY2xrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGJ4dF9zYW5pdGl6ZV9jZGNsayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgY2RjdGwsIGV4cGVjdGVkOwog
Ci0JaW50ZWxfdXBkYXRlX2NkY2xrKGRldl9wcml2KTsKLQlpbnRlbF9kdW1wX2NkY2xrX3N0YXRl
KCZkZXZfcHJpdi0+Y2RjbGsuaHcsICJDdXJyZW50IENEQ0xLIik7CisJaW50ZWxfdXBkYXRlX2Nk
Y2xrKGk5MTUpOworCWludGVsX2R1bXBfY2RjbGtfc3RhdGUoJmk5MTUtPmNkY2xrLmh3LCAiQ3Vy
cmVudCBDRENMSyIpOwogCi0JaWYgKGRldl9wcml2LT5jZGNsay5ody52Y28gPT0gMCB8fAotCSAg
ICBkZXZfcHJpdi0+Y2RjbGsuaHcuY2RjbGsgPT0gZGV2X3ByaXYtPmNkY2xrLmh3LmJ5cGFzcykK
KwlpZiAoaTkxNS0+Y2RjbGsuaHcudmNvID09IDAgfHwKKwkgICAgaTkxNS0+Y2RjbGsuaHcuY2Rj
bGsgPT0gaTkxNS0+Y2RjbGsuaHcuYnlwYXNzKQogCQlnb3RvIHNhbml0aXplOwogCiAJLyogRFBM
TCBva2F5OyB2ZXJpZnkgdGhlIGNkY2xvY2sKQEAgLTE0NTEsMTIgKzE0NTEsMTIgQEAgc3RhdGlj
IHZvaWQgYnh0X3Nhbml0aXplX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAljZGN0bCAmPSB+QlhUX0NEQ0xLX0NEMlhfUElQRV9OT05FOwogCiAJZXhwZWN0ZWQgPSAo
Y2RjdGwgJiBCWFRfQ0RDTEtfQ0QyWF9ESVZfU0VMX01BU0spIHwKLQkJc2tsX2NkY2xrX2RlY2lt
YWwoZGV2X3ByaXYtPmNkY2xrLmh3LmNkY2xrKTsKKwkJc2tsX2NkY2xrX2RlY2ltYWwoaTkxNS0+
Y2RjbGsuaHcuY2RjbGspOwogCS8qCiAJICogRGlzYWJsZSBTU0EgUHJlY2hhcmdlIHdoZW4gQ0Qg
Y2xvY2sgZnJlcXVlbmN5IDwgNTAwIE1IeiwKIAkgKiBlbmFibGUgb3RoZXJ3aXNlLgogCSAqLwot
CWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcuY2RjbGsgPj0gNTAwMDAwKQorCWlmIChpOTE1LT5jZGNs
ay5ody5jZGNsayA+PSA1MDAwMDApCiAJCWV4cGVjdGVkIHw9IEJYVF9DRENMS19TU0FfUFJFQ0hB
UkdFX0VOQUJMRTsKIAogCWlmIChjZGN0bCA9PSBleHBlY3RlZCkKQEAgLTE0NjcsNTAgKzE0Njcs
NTAgQEAgc3RhdGljIHZvaWQgYnh0X3Nhbml0aXplX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlEUk1fREVCVUdfS01TKCJTYW5pdGl6aW5nIGNkY2xrIHByb2dyYW1t
ZWQgYnkgcHJlLW9zXG4iKTsKIAogCS8qIGZvcmNlIGNkY2xrIHByb2dyYW1taW5nICovCi0JZGV2
X3ByaXYtPmNkY2xrLmh3LmNkY2xrID0gMDsKKwlpOTE1LT5jZGNsay5ody5jZGNsayA9IDA7CiAK
IAkvKiBmb3JjZSBmdWxsIFBMTCBkaXNhYmxlICsgZW5hYmxlICovCi0JZGV2X3ByaXYtPmNkY2xr
Lmh3LnZjbyA9IC0xOworCWk5MTUtPmNkY2xrLmh3LnZjbyA9IC0xOwogfQogCi1zdGF0aWMgdm9p
ZCBieHRfaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0
aWMgdm9pZCBieHRfaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAlzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgY2RjbGtfc3RhdGU7CiAKLQlieHRfc2FuaXRpemVf
Y2RjbGsoZGV2X3ByaXYpOworCWJ4dF9zYW5pdGl6ZV9jZGNsayhpOTE1KTsKIAotCWlmIChkZXZf
cHJpdi0+Y2RjbGsuaHcuY2RjbGsgIT0gMCAmJgotCSAgICBkZXZfcHJpdi0+Y2RjbGsuaHcudmNv
ICE9IDApCisJaWYgKGk5MTUtPmNkY2xrLmh3LmNkY2xrICE9IDAgJiYKKwkgICAgaTkxNS0+Y2Rj
bGsuaHcudmNvICE9IDApCiAJCXJldHVybjsKIAotCWNkY2xrX3N0YXRlID0gZGV2X3ByaXYtPmNk
Y2xrLmh3OworCWNkY2xrX3N0YXRlID0gaTkxNS0+Y2RjbGsuaHc7CiAKIAkvKgogCSAqIEZJWE1F
OgogCSAqIC0gVGhlIGluaXRpYWwgQ0RDTEsgbmVlZHMgdG8gYmUgcmVhZCBmcm9tIFZCVC4KIAkg
KiAgIE5lZWQgdG8gbWFrZSB0aGlzIGNoYW5nZSBhZnRlciBWQlQgaGFzIGNoYW5nZXMgZm9yIEJY
VC4KIAkgKi8KLQlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwlpZiAoSVNfR0VNSU5J
TEFLRShpOTE1KSkgewogCQljZGNsa19zdGF0ZS5jZGNsayA9IGdsa19jYWxjX2NkY2xrKDApOwot
CQljZGNsa19zdGF0ZS52Y28gPSBnbGtfZGVfcGxsX3ZjbyhkZXZfcHJpdiwgY2RjbGtfc3RhdGUu
Y2RjbGspOworCQljZGNsa19zdGF0ZS52Y28gPSBnbGtfZGVfcGxsX3ZjbyhpOTE1LCBjZGNsa19z
dGF0ZS5jZGNsayk7CiAJfSBlbHNlIHsKIAkJY2RjbGtfc3RhdGUuY2RjbGsgPSBieHRfY2FsY19j
ZGNsaygwKTsKLQkJY2RjbGtfc3RhdGUudmNvID0gYnh0X2RlX3BsbF92Y28oZGV2X3ByaXYsIGNk
Y2xrX3N0YXRlLmNkY2xrKTsKKwkJY2RjbGtfc3RhdGUudmNvID0gYnh0X2RlX3BsbF92Y28oaTkx
NSwgY2RjbGtfc3RhdGUuY2RjbGspOwogCX0KIAljZGNsa19zdGF0ZS52b2x0YWdlX2xldmVsID0g
Ynh0X2NhbGNfdm9sdGFnZV9sZXZlbChjZGNsa19zdGF0ZS5jZGNsayk7CiAKLQlieHRfc2V0X2Nk
Y2xrKGRldl9wcml2LCAmY2RjbGtfc3RhdGUsIElOVkFMSURfUElQRSk7CisJYnh0X3NldF9jZGNs
ayhpOTE1LCAmY2RjbGtfc3RhdGUsIElOVkFMSURfUElQRSk7CiB9CiAKLXN0YXRpYyB2b2lkIGJ4
dF91bmluaXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgYnh0X3VuaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgY2RjbGtfc3RhdGUgPSBkZXZfcHJpdi0+Y2RjbGsu
aHc7CisJc3RydWN0IGludGVsX2NkY2xrX3N0YXRlIGNkY2xrX3N0YXRlID0gaTkxNS0+Y2RjbGsu
aHc7CiAKIAljZGNsa19zdGF0ZS5jZGNsayA9IGNkY2xrX3N0YXRlLmJ5cGFzczsKIAljZGNsa19z
dGF0ZS52Y28gPSAwOwogCWNkY2xrX3N0YXRlLnZvbHRhZ2VfbGV2ZWwgPSBieHRfY2FsY192b2x0
YWdlX2xldmVsKGNkY2xrX3N0YXRlLmNkY2xrKTsKIAotCWJ4dF9zZXRfY2RjbGsoZGV2X3ByaXYs
ICZjZGNsa19zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKKwlieHRfc2V0X2NkY2xrKGk5MTUsICZjZGNs
a19zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKIH0KIAogc3RhdGljIGludCBjbmxfY2FsY19jZGNsayhp
bnQgbWluX2NkY2xrKQpAQCAtMTUzMyw3ICsxNTMzLDcgQEAgc3RhdGljIHU4IGNubF9jYWxjX3Zv
bHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQogCQlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgY25s
X2NkY2xrX3BsbF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIHZvaWQgY25sX2NkY2xrX3BsbF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJIHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUpCiB7CiAJdTMy
IHZhbDsKQEAgLTE1NTUsMTMgKzE1NTUsMTMgQEAgc3RhdGljIHZvaWQgY25sX2NkY2xrX3BsbF91
cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWNkY2xrX3N0YXRlLT52
Y28gPSAodmFsICYgQ05MX0NEQ0xLX1BMTF9SQVRJT19NQVNLKSAqIGNkY2xrX3N0YXRlLT5yZWY7
CiB9CiAKLXN0YXRpYyB2b2lkIGNubF9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIHZvaWQgY25sX2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCSBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlKQog
ewogCXUzMiBkaXZpZGVyOwogCWludCBkaXY7CiAKLQljbmxfY2RjbGtfcGxsX3VwZGF0ZShkZXZf
cHJpdiwgY2RjbGtfc3RhdGUpOworCWNubF9jZGNsa19wbGxfdXBkYXRlKGk5MTUsIGNkY2xrX3N0
YXRlKTsKIAogCWNkY2xrX3N0YXRlLT5jZGNsayA9IGNkY2xrX3N0YXRlLT5ieXBhc3MgPSBjZGNs
a19zdGF0ZS0+cmVmOwogCkBAIC0xNTkzLDcgKzE1OTMsNyBAQCBzdGF0aWMgdm9pZCBjbmxfZ2V0
X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJY25sX2NhbGNfdm9s
dGFnZV9sZXZlbChjZGNsa19zdGF0ZS0+Y2RjbGspOwogfQogCi1zdGF0aWMgdm9pZCBjbmxfY2Rj
bGtfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgY25sX2NkY2xrX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewogCXUzMiB2YWw7CiAKQEAgLTE2MDUsMTIgKzE2MDUsMTIgQEAgc3RhdGljIHZvaWQgY25s
X2NkY2xrX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlp
ZiAod2FpdF9mb3IoKEk5MTVfUkVBRChCWFRfREVfUExMX0VOQUJMRSkgJiBCWFRfREVfUExMX0xP
Q0spID09IDAsIDEpKQogCQlEUk1fRVJST1IoInRpbWVvdXQgd2FpdGluZyBmb3IgQ0RDTEsgUExM
IHVubG9ja1xuIik7CiAKLQlkZXZfcHJpdi0+Y2RjbGsuaHcudmNvID0gMDsKKwlpOTE1LT5jZGNs
ay5ody52Y28gPSAwOwogfQogCi1zdGF0aWMgdm9pZCBjbmxfY2RjbGtfcGxsX2VuYWJsZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCB2Y28pCitzdGF0aWMgdm9pZCBjbmxf
Y2RjbGtfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHZjbykK
IHsKLQlpbnQgcmF0aW8gPSBESVZfUk9VTkRfQ0xPU0VTVCh2Y28sIGRldl9wcml2LT5jZGNsay5o
dy5yZWYpOworCWludCByYXRpbyA9IERJVl9ST1VORF9DTE9TRVNUKHZjbywgaTkxNS0+Y2RjbGsu
aHcucmVmKTsKIAl1MzIgdmFsOwogCiAJdmFsID0gQ05MX0NEQ0xLX1BMTF9SQVRJTyhyYXRpbyk7
CkBAIC0xNjIzLDEwICsxNjIzLDEwIEBAIHN0YXRpYyB2b2lkIGNubF9jZGNsa19wbGxfZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50IHZjbykKIAlpZiAod2FpdF9m
b3IoKEk5MTVfUkVBRChCWFRfREVfUExMX0VOQUJMRSkgJiBCWFRfREVfUExMX0xPQ0spICE9IDAs
IDEpKQogCQlEUk1fRVJST1IoInRpbWVvdXQgd2FpdGluZyBmb3IgQ0RDTEsgUExMIGxvY2tcbiIp
OwogCi0JZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyA9IHZjbzsKKwlpOTE1LT5jZGNsay5ody52Y28g
PSB2Y287CiB9CiAKLXN0YXRpYyB2b2lkIGNubF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgY25sX3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpj
ZGNsa19zdGF0ZSwKIAkJCSAgZW51bSBwaXBlIHBpcGUpCiB7CkBAIC0xNjM1LDcgKzE2MzUsNyBA
QCBzdGF0aWMgdm9pZCBjbmxfc2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAl1MzIgdmFsLCBkaXZpZGVyOwogCWludCByZXQ7CiAKLQlyZXQgPSBza2xfcGNvZGVf
cmVxdWVzdChkZXZfcHJpdiwgU0tMX1BDT0RFX0NEQ0xLX0NPTlRST0wsCisJcmV0ID0gc2tsX3Bj
b2RlX3JlcXVlc3QoaTkxNSwgU0tMX1BDT0RFX0NEQ0xLX0NPTlRST0wsCiAJCQkJU0tMX0NEQ0xL
X1BSRVBBUkVfRk9SX0NIQU5HRSwKIAkJCQlTS0xfQ0RDTEtfUkVBRFlfRk9SX0NIQU5HRSwKIAkJ
CQlTS0xfQ0RDTEtfUkVBRFlfRk9SX0NIQU5HRSwgMyk7CkBAIC0xNjQ4LDcgKzE2NDgsNyBAQCBz
dGF0aWMgdm9pZCBjbmxfc2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkvKiBjZGNsayA9IHZjbyAvIDIgLyBkaXZ7MSwyfSAqLwogCXN3aXRjaCAoRElWX1JPVU5E
X0NMT1NFU1QodmNvLCBjZGNsaykpIHsKIAlkZWZhdWx0OgotCQlXQVJOX09OKGNkY2xrICE9IGRl
dl9wcml2LT5jZGNsay5ody5ieXBhc3MpOworCQlXQVJOX09OKGNkY2xrICE9IGk5MTUtPmNkY2xr
Lmh3LmJ5cGFzcyk7CiAJCVdBUk5fT04odmNvICE9IDApOwogCQkvKiBmYWxsIHRocm91Z2ggKi8K
IAljYXNlIDI6CkBAIC0xNjU5LDEyICsxNjU5LDEyIEBAIHN0YXRpYyB2b2lkIGNubF9zZXRfY2Rj
bGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlicmVhazsKIAl9CiAKLQlp
ZiAoZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyAhPSAwICYmCi0JICAgIGRldl9wcml2LT5jZGNsay5o
dy52Y28gIT0gdmNvKQotCQljbmxfY2RjbGtfcGxsX2Rpc2FibGUoZGV2X3ByaXYpOworCWlmIChp
OTE1LT5jZGNsay5ody52Y28gIT0gMCAmJgorCSAgICBpOTE1LT5jZGNsay5ody52Y28gIT0gdmNv
KQorCQljbmxfY2RjbGtfcGxsX2Rpc2FibGUoaTkxNSk7CiAKLQlpZiAoZGV2X3ByaXYtPmNkY2xr
Lmh3LnZjbyAhPSB2Y28pCi0JCWNubF9jZGNsa19wbGxfZW5hYmxlKGRldl9wcml2LCB2Y28pOwor
CWlmIChpOTE1LT5jZGNsay5ody52Y28gIT0gdmNvKQorCQljbmxfY2RjbGtfcGxsX2VuYWJsZShp
OTE1LCB2Y28pOwogCiAJdmFsID0gZGl2aWRlciB8IHNrbF9jZGNsa19kZWNpbWFsKGNkY2xrKTsK
IAlpZiAocGlwZSA9PSBJTlZBTElEX1BJUEUpCkBAIC0xNjc0LDI2ICsxNjc0LDI2IEBAIHN0YXRp
YyB2b2lkIGNubF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CUk5MTVfV1JJVEUoQ0RDTEtfQ1RMLCB2YWwpOwogCiAJaWYgKHBpcGUgIT0gSU5WQUxJRF9QSVBF
KQotCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIHBpcGUpOworCQlpbnRlbF93YWl0
X2Zvcl92YmxhbmsoaTkxNSwgcGlwZSk7CiAKIAkvKiBpbmZvcm0gUENVIG9mIHRoZSBjaGFuZ2Ug
Ki8KLQlzYW5keWJyaWRnZV9wY29kZV93cml0ZShkZXZfcHJpdiwgU0tMX1BDT0RFX0NEQ0xLX0NP
TlRST0wsCisJc2FuZHlicmlkZ2VfcGNvZGVfd3JpdGUoaTkxNSwgU0tMX1BDT0RFX0NEQ0xLX0NP
TlRST0wsCiAJCQkJY2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWwpOwogCi0JaW50ZWxfdXBkYXRl
X2NkY2xrKGRldl9wcml2KTsKKwlpbnRlbF91cGRhdGVfY2RjbGsoaTkxNSk7CiAKIAkvKgogCSAq
IENhbid0IHJlYWQgb3V0IHRoZSB2b2x0YWdlIGxldmVsIDooCiAJICogTGV0J3MganVzdCBhc3N1
bWUgZXZlcnl0aGluZyBpcyBhcyBleHBlY3RlZC4KIAkgKi8KLQlkZXZfcHJpdi0+Y2RjbGsuaHcu
dm9sdGFnZV9sZXZlbCA9IGNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsOworCWk5MTUtPmNkY2xr
Lmh3LnZvbHRhZ2VfbGV2ZWwgPSBjZGNsa19zdGF0ZS0+dm9sdGFnZV9sZXZlbDsKIH0KIAotc3Rh
dGljIGludCBjbmxfY2RjbGtfcGxsX3ZjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIGludCBjZGNsaykKK3N0YXRpYyBpbnQgY25sX2NkY2xrX3BsbF92Y28oc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIGludCBjZGNsaykKIHsKIAlpbnQgcmF0aW87CiAKLQlpZiAoY2Rj
bGsgPT0gZGV2X3ByaXYtPmNkY2xrLmh3LmJ5cGFzcykKKwlpZiAoY2RjbGsgPT0gaTkxNS0+Y2Rj
bGsuaHcuYnlwYXNzKQogCQlyZXR1cm4gMDsKIAogCXN3aXRjaCAoY2RjbGspIHsKQEAgLTE3MDIs
MjUgKzE3MDIsMjUgQEAgc3RhdGljIGludCBjbmxfY2RjbGtfcGxsX3ZjbyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCBjZGNsaykKIAkJLyogZmFsbCB0aHJvdWdoICovCiAJ
Y2FzZSAxNjgwMDA6CiAJY2FzZSAzMzYwMDA6Ci0JCXJhdGlvID0gZGV2X3ByaXYtPmNkY2xrLmh3
LnJlZiA9PSAxOTIwMCA/IDM1IDogMjg7CisJCXJhdGlvID0gaTkxNS0+Y2RjbGsuaHcucmVmID09
IDE5MjAwID8gMzUgOiAyODsKIAkJYnJlYWs7CiAJY2FzZSA1MjgwMDA6Ci0JCXJhdGlvID0gZGV2
X3ByaXYtPmNkY2xrLmh3LnJlZiA9PSAxOTIwMCA/IDU1IDogNDQ7CisJCXJhdGlvID0gaTkxNS0+
Y2RjbGsuaHcucmVmID09IDE5MjAwID8gNTUgOiA0NDsKIAkJYnJlYWs7CiAJfQogCi0JcmV0dXJu
IGRldl9wcml2LT5jZGNsay5ody5yZWYgKiByYXRpbzsKKwlyZXR1cm4gaTkxNS0+Y2RjbGsuaHcu
cmVmICogcmF0aW87CiB9CiAKLXN0YXRpYyB2b2lkIGNubF9zYW5pdGl6ZV9jZGNsayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBjbmxfc2FuaXRpemVfY2Rj
bGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGNkY3RsLCBleHBlY3Rl
ZDsKIAotCWludGVsX3VwZGF0ZV9jZGNsayhkZXZfcHJpdik7Ci0JaW50ZWxfZHVtcF9jZGNsa19z
dGF0ZSgmZGV2X3ByaXYtPmNkY2xrLmh3LCAiQ3VycmVudCBDRENMSyIpOworCWludGVsX3VwZGF0
ZV9jZGNsayhpOTE1KTsKKwlpbnRlbF9kdW1wX2NkY2xrX3N0YXRlKCZpOTE1LT5jZGNsay5odywg
IkN1cnJlbnQgQ0RDTEsiKTsKIAotCWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcudmNvID09IDAgfHwK
LQkgICAgZGV2X3ByaXYtPmNkY2xrLmh3LmNkY2xrID09IGRldl9wcml2LT5jZGNsay5ody5ieXBh
c3MpCisJaWYgKGk5MTUtPmNkY2xrLmh3LnZjbyA9PSAwIHx8CisJICAgIGk5MTUtPmNkY2xrLmh3
LmNkY2xrID09IGk5MTUtPmNkY2xrLmh3LmJ5cGFzcykKIAkJZ290byBzYW5pdGl6ZTsKIAogCS8q
IERQTEwgb2theTsgdmVyaWZ5IHRoZSBjZGNsb2NrCkBAIC0xNzM4LDcgKzE3MzgsNyBAQCBzdGF0
aWMgdm9pZCBjbmxfc2FuaXRpemVfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCWNkY3RsICY9IH5CWFRfQ0RDTEtfQ0QyWF9QSVBFX05PTkU7CiAKIAlleHBlY3RlZCA9
IChjZGN0bCAmIEJYVF9DRENMS19DRDJYX0RJVl9TRUxfTUFTSykgfAotCQkgICBza2xfY2RjbGtf
ZGVjaW1hbChkZXZfcHJpdi0+Y2RjbGsuaHcuY2RjbGspOworCQkgICBza2xfY2RjbGtfZGVjaW1h
bChpOTE1LT5jZGNsay5ody5jZGNsayk7CiAKIAlpZiAoY2RjdGwgPT0gZXhwZWN0ZWQpCiAJCS8q
IEFsbCB3ZWxsOyBub3RoaW5nIHRvIHNhbml0aXplICovCkBAIC0xNzQ4LDEwICsxNzQ4LDEwIEBA
IHN0YXRpYyB2b2lkIGNubF9zYW5pdGl6ZV9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJRFJNX0RFQlVHX0tNUygiU2FuaXRpemluZyBjZGNsayBwcm9ncmFtbWVkIGJ5
IHByZS1vc1xuIik7CiAKIAkvKiBmb3JjZSBjZGNsayBwcm9ncmFtbWluZyAqLwotCWRldl9wcml2
LT5jZGNsay5ody5jZGNsayA9IDA7CisJaTkxNS0+Y2RjbGsuaHcuY2RjbGsgPSAwOwogCiAJLyog
Zm9yY2UgZnVsbCBQTEwgZGlzYWJsZSArIGVuYWJsZSAqLwotCWRldl9wcml2LT5jZGNsay5ody52
Y28gPSAtMTsKKwlpOTE1LT5jZGNsay5ody52Y28gPSAtMTsKIH0KIAogc3RhdGljIGludCBpY2xf
Y2FsY19jZGNsayhpbnQgbWluX2NkY2xrLCB1bnNpZ25lZCBpbnQgcmVmKQpAQCAtMTc4MSwxMSAr
MTc4MSwxMSBAQCBzdGF0aWMgaW50IGljbF9jYWxjX2NkY2xrKGludCBtaW5fY2RjbGssIHVuc2ln
bmVkIGludCByZWYpCiAJCXJldHVybiByYW5nZXNbMF07CiB9CiAKLXN0YXRpYyBpbnQgaWNsX2Nh
bGNfY2RjbGtfcGxsX3ZjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCBj
ZGNsaykKK3N0YXRpYyBpbnQgaWNsX2NhbGNfY2RjbGtfcGxsX3ZjbyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwgaW50IGNkY2xrKQogewogCWludCByYXRpbzsKIAotCWlmIChjZGNsayA9
PSBkZXZfcHJpdi0+Y2RjbGsuaHcuYnlwYXNzKQorCWlmIChjZGNsayA9PSBpOTE1LT5jZGNsay5o
dy5ieXBhc3MpCiAJCXJldHVybiAwOwogCiAJc3dpdGNoIChjZGNsaykgewpAQCAtMTc5NSwyMSAr
MTc5NSwyMSBAQCBzdGF0aWMgaW50IGljbF9jYWxjX2NkY2xrX3BsbF92Y28oc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgY2RjbGspCiAJY2FzZSAzMDcyMDA6CiAJY2FzZSA1
NTY4MDA6CiAJY2FzZSA2NTI4MDA6Ci0JCVdBUk5fT04oZGV2X3ByaXYtPmNkY2xrLmh3LnJlZiAh
PSAxOTIwMCAmJgotCQkJZGV2X3ByaXYtPmNkY2xrLmh3LnJlZiAhPSAzODQwMCk7CisJCVdBUk5f
T04oaTkxNS0+Y2RjbGsuaHcucmVmICE9IDE5MjAwICYmCisJCQlpOTE1LT5jZGNsay5ody5yZWYg
IT0gMzg0MDApOwogCQlicmVhazsKIAljYXNlIDMxMjAwMDoKIAljYXNlIDU1MjAwMDoKIAljYXNl
IDY0ODAwMDoKLQkJV0FSTl9PTihkZXZfcHJpdi0+Y2RjbGsuaHcucmVmICE9IDI0MDAwKTsKKwkJ
V0FSTl9PTihpOTE1LT5jZGNsay5ody5yZWYgIT0gMjQwMDApOwogCX0KIAotCXJhdGlvID0gY2Rj
bGsgLyAoZGV2X3ByaXYtPmNkY2xrLmh3LnJlZiAvIDIpOworCXJhdGlvID0gY2RjbGsgLyAoaTkx
NS0+Y2RjbGsuaHcucmVmIC8gMik7CiAKLQlyZXR1cm4gZGV2X3ByaXYtPmNkY2xrLmh3LnJlZiAq
IHJhdGlvOworCXJldHVybiBpOTE1LT5jZGNsay5ody5yZWYgKiByYXRpbzsKIH0KIAotc3RhdGlj
IHZvaWQgaWNsX3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdm9pZCBpY2xfc2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlLAogCQkJICBl
bnVtIHBpcGUgcGlwZSkKIHsKQEAgLTE4MTcsNyArMTgxNyw3IEBAIHN0YXRpYyB2b2lkIGljbF9z
ZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXVuc2lnbmVkIGlu
dCB2Y28gPSBjZGNsa19zdGF0ZS0+dmNvOwogCWludCByZXQ7CiAKLQlyZXQgPSBza2xfcGNvZGVf
cmVxdWVzdChkZXZfcHJpdiwgU0tMX1BDT0RFX0NEQ0xLX0NPTlRST0wsCisJcmV0ID0gc2tsX3Bj
b2RlX3JlcXVlc3QoaTkxNSwgU0tMX1BDT0RFX0NEQ0xLX0NPTlRST0wsCiAJCQkJU0tMX0NEQ0xL
X1BSRVBBUkVfRk9SX0NIQU5HRSwKIAkJCQlTS0xfQ0RDTEtfUkVBRFlfRk9SX0NIQU5HRSwKIAkJ
CQlTS0xfQ0RDTEtfUkVBRFlfRk9SX0NIQU5HRSwgMyk7CkBAIC0xODI3LDEyICsxODI3LDEyIEBA
IHN0YXRpYyB2b2lkIGljbF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQlyZXR1cm47CiAJfQogCi0JaWYgKGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gMCAm
JgotCSAgICBkZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IHZjbykKLQkJY25sX2NkY2xrX3BsbF9k
aXNhYmxlKGRldl9wcml2KTsKKwlpZiAoaTkxNS0+Y2RjbGsuaHcudmNvICE9IDAgJiYKKwkgICAg
aTkxNS0+Y2RjbGsuaHcudmNvICE9IHZjbykKKwkJY25sX2NkY2xrX3BsbF9kaXNhYmxlKGk5MTUp
OwogCi0JaWYgKGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gdmNvKQotCQljbmxfY2RjbGtfcGxs
X2VuYWJsZShkZXZfcHJpdiwgdmNvKTsKKwlpZiAoaTkxNS0+Y2RjbGsuaHcudmNvICE9IHZjbykK
KwkJY25sX2NkY2xrX3BsbF9lbmFibGUoaTkxNSwgdmNvKTsKIAogCS8qCiAJICogT24gSUNMIENE
MlhfRElWIGNhbiBvbmx5IGJlIDEsIHNvIHdlJ2xsIG5ldmVyIGVuZCB1cCBjaGFuZ2luZyB0aGUK
QEAgLTE4NDIsMTYgKzE4NDIsMTYgQEAgc3RhdGljIHZvaWQgaWNsX3NldF9jZGNsayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJSTkxNV9XUklURShDRENMS19DVEwsIElDTF9D
RENMS19DRDJYX1BJUEVfTk9ORSB8CiAJCQkgICAgICBza2xfY2RjbGtfZGVjaW1hbChjZGNsaykp
OwogCi0Jc2FuZHlicmlkZ2VfcGNvZGVfd3JpdGUoZGV2X3ByaXYsIFNLTF9QQ09ERV9DRENMS19D
T05UUk9MLAorCXNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlKGk5MTUsIFNLTF9QQ09ERV9DRENMS19D
T05UUk9MLAogCQkJCWNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsKTsKIAotCWludGVsX3VwZGF0
ZV9jZGNsayhkZXZfcHJpdik7CisJaW50ZWxfdXBkYXRlX2NkY2xrKGk5MTUpOwogCiAJLyoKIAkg
KiBDYW4ndCByZWFkIG91dCB0aGUgdm9sdGFnZSBsZXZlbCA6KAogCSAqIExldCdzIGp1c3QgYXNz
dW1lIGV2ZXJ5dGhpbmcgaXMgYXMgZXhwZWN0ZWQuCiAJICovCi0JZGV2X3ByaXYtPmNkY2xrLmh3
LnZvbHRhZ2VfbGV2ZWwgPSBjZGNsa19zdGF0ZS0+dm9sdGFnZV9sZXZlbDsKKwlpOTE1LT5jZGNs
ay5ody52b2x0YWdlX2xldmVsID0gY2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWw7CiB9CiAKIHN0
YXRpYyB1OCBpY2xfY2FsY192b2x0YWdlX2xldmVsKGludCBjZGNsaykKQEAgLTE4NjQsNyArMTg2
NCw3IEBAIHN0YXRpYyB1OCBpY2xfY2FsY192b2x0YWdlX2xldmVsKGludCBjZGNsaykKIAkJcmV0
dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIGljbF9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaWNsX2dldF9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19z
dGF0ZSkKIHsKIAl1MzIgdmFsOwpAQCAtMTkxNSwxNyArMTkxNSwxNyBAQCBzdGF0aWMgdm9pZCBp
Y2xfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaWNsX2Nh
bGNfdm9sdGFnZV9sZXZlbChjZGNsa19zdGF0ZS0+Y2RjbGspOwogfQogCi1zdGF0aWMgdm9pZCBp
Y2xfaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
dm9pZCBpY2xfaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgc2FuaXRpemVkX3N0YXRlOwogCXUzMiB2YWw7CiAKLQkv
KiBUaGlzIHNldHMgZGV2X3ByaXYtPmNkY2xrLmh3LiAqLwotCWludGVsX3VwZGF0ZV9jZGNsayhk
ZXZfcHJpdik7Ci0JaW50ZWxfZHVtcF9jZGNsa19zdGF0ZSgmZGV2X3ByaXYtPmNkY2xrLmh3LCAi
Q3VycmVudCBDRENMSyIpOworCS8qIFRoaXMgc2V0cyBpOTE1LT5jZGNsay5ody4gKi8KKwlpbnRl
bF91cGRhdGVfY2RjbGsoaTkxNSk7CisJaW50ZWxfZHVtcF9jZGNsa19zdGF0ZSgmaTkxNS0+Y2Rj
bGsuaHcsICJDdXJyZW50IENEQ0xLIik7CiAKIAkvKiBUaGlzIG1lYW5zIENEQ0xLIGRpc2FibGVk
LiAqLwotCWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcuY2RjbGsgPT0gZGV2X3ByaXYtPmNkY2xrLmh3
LmJ5cGFzcykKKwlpZiAoaTkxNS0+Y2RjbGsuaHcuY2RjbGsgPT0gaTkxNS0+Y2RjbGsuaHcuYnlw
YXNzKQogCQlnb3RvIHNhbml0aXplOwogCiAJdmFsID0gSTkxNV9SRUFEKENEQ0xLX0NUTCk7CkBA
IC0xOTM0LDcgKzE5MzQsNyBAQCBzdGF0aWMgdm9pZCBpY2xfaW5pdF9jZGNsayhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gc2FuaXRpemU7CiAKIAlpZiAoKHZhbCAm
IENEQ0xLX0ZSRVFfREVDSU1BTF9NQVNLKSAhPQotCSAgICBza2xfY2RjbGtfZGVjaW1hbChkZXZf
cHJpdi0+Y2RjbGsuaHcuY2RjbGspKQorCSAgICBza2xfY2RjbGtfZGVjaW1hbChpOTE1LT5jZGNs
ay5ody5jZGNsaykpCiAJCWdvdG8gc2FuaXRpemU7CiAKIAlyZXR1cm47CkBAIC0xOTQyLDYyICsx
OTQyLDYyIEBAIHN0YXRpYyB2b2lkIGljbF9pbml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIHNhbml0aXplOgogCURSTV9ERUJVR19LTVMoIlNhbml0aXppbmcgY2Rj
bGsgcHJvZ3JhbW1lZCBieSBwcmUtb3NcbiIpOwogCi0Jc2FuaXRpemVkX3N0YXRlLnJlZiA9IGRl
dl9wcml2LT5jZGNsay5ody5yZWY7CisJc2FuaXRpemVkX3N0YXRlLnJlZiA9IGk5MTUtPmNkY2xr
Lmh3LnJlZjsKIAlzYW5pdGl6ZWRfc3RhdGUuY2RjbGsgPSBpY2xfY2FsY19jZGNsaygwLCBzYW5p
dGl6ZWRfc3RhdGUucmVmKTsKLQlzYW5pdGl6ZWRfc3RhdGUudmNvID0gaWNsX2NhbGNfY2RjbGtf
cGxsX3ZjbyhkZXZfcHJpdiwKKwlzYW5pdGl6ZWRfc3RhdGUudmNvID0gaWNsX2NhbGNfY2RjbGtf
cGxsX3ZjbyhpOTE1LAogCQkJCQkJICAgICBzYW5pdGl6ZWRfc3RhdGUuY2RjbGspOwogCXNhbml0
aXplZF9zdGF0ZS52b2x0YWdlX2xldmVsID0KIAkJCQlpY2xfY2FsY192b2x0YWdlX2xldmVsKHNh
bml0aXplZF9zdGF0ZS5jZGNsayk7CiAKLQlpY2xfc2V0X2NkY2xrKGRldl9wcml2LCAmc2FuaXRp
emVkX3N0YXRlLCBJTlZBTElEX1BJUEUpOworCWljbF9zZXRfY2RjbGsoaTkxNSwgJnNhbml0aXpl
ZF9zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKIH0KIAotc3RhdGljIHZvaWQgaWNsX3VuaW5pdF9jZGNs
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpY2xfdW5p
bml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRl
bF9jZGNsa19zdGF0ZSBjZGNsa19zdGF0ZSA9IGRldl9wcml2LT5jZGNsay5odzsKKwlzdHJ1Y3Qg
aW50ZWxfY2RjbGtfc3RhdGUgY2RjbGtfc3RhdGUgPSBpOTE1LT5jZGNsay5odzsKIAogCWNkY2xr
X3N0YXRlLmNkY2xrID0gY2RjbGtfc3RhdGUuYnlwYXNzOwogCWNkY2xrX3N0YXRlLnZjbyA9IDA7
CiAJY2RjbGtfc3RhdGUudm9sdGFnZV9sZXZlbCA9IGljbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoY2Rj
bGtfc3RhdGUuY2RjbGspOwogCi0JaWNsX3NldF9jZGNsayhkZXZfcHJpdiwgJmNkY2xrX3N0YXRl
LCBJTlZBTElEX1BJUEUpOworCWljbF9zZXRfY2RjbGsoaTkxNSwgJmNkY2xrX3N0YXRlLCBJTlZB
TElEX1BJUEUpOwogfQogCi1zdGF0aWMgdm9pZCBjbmxfaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBjbmxfaW5pdF9jZGNsayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgY2Rj
bGtfc3RhdGU7CiAKLQljbmxfc2FuaXRpemVfY2RjbGsoZGV2X3ByaXYpOworCWNubF9zYW5pdGl6
ZV9jZGNsayhpOTE1KTsKIAotCWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcuY2RjbGsgIT0gMCAmJgot
CSAgICBkZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IDApCisJaWYgKGk5MTUtPmNkY2xrLmh3LmNk
Y2xrICE9IDAgJiYKKwkgICAgaTkxNS0+Y2RjbGsuaHcudmNvICE9IDApCiAJCXJldHVybjsKIAot
CWNkY2xrX3N0YXRlID0gZGV2X3ByaXYtPmNkY2xrLmh3OworCWNkY2xrX3N0YXRlID0gaTkxNS0+
Y2RjbGsuaHc7CiAKIAljZGNsa19zdGF0ZS5jZGNsayA9IGNubF9jYWxjX2NkY2xrKDApOwotCWNk
Y2xrX3N0YXRlLnZjbyA9IGNubF9jZGNsa19wbGxfdmNvKGRldl9wcml2LCBjZGNsa19zdGF0ZS5j
ZGNsayk7CisJY2RjbGtfc3RhdGUudmNvID0gY25sX2NkY2xrX3BsbF92Y28oaTkxNSwgY2RjbGtf
c3RhdGUuY2RjbGspOwogCWNkY2xrX3N0YXRlLnZvbHRhZ2VfbGV2ZWwgPSBjbmxfY2FsY192b2x0
YWdlX2xldmVsKGNkY2xrX3N0YXRlLmNkY2xrKTsKIAotCWNubF9zZXRfY2RjbGsoZGV2X3ByaXYs
ICZjZGNsa19zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKKwljbmxfc2V0X2NkY2xrKGk5MTUsICZjZGNs
a19zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKIH0KIAotc3RhdGljIHZvaWQgY25sX3VuaW5pdF9jZGNs
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBjbmxfdW5p
bml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRl
bF9jZGNsa19zdGF0ZSBjZGNsa19zdGF0ZSA9IGRldl9wcml2LT5jZGNsay5odzsKKwlzdHJ1Y3Qg
aW50ZWxfY2RjbGtfc3RhdGUgY2RjbGtfc3RhdGUgPSBpOTE1LT5jZGNsay5odzsKIAogCWNkY2xr
X3N0YXRlLmNkY2xrID0gY2RjbGtfc3RhdGUuYnlwYXNzOwogCWNkY2xrX3N0YXRlLnZjbyA9IDA7
CiAJY2RjbGtfc3RhdGUudm9sdGFnZV9sZXZlbCA9IGNubF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoY2Rj
bGtfc3RhdGUuY2RjbGspOwogCi0JY25sX3NldF9jZGNsayhkZXZfcHJpdiwgJmNkY2xrX3N0YXRl
LCBJTlZBTElEX1BJUEUpOworCWNubF9zZXRfY2RjbGsoaTkxNSwgJmNkY2xrX3N0YXRlLCBJTlZB
TElEX1BJUEUpOwogfQogCiAvKioKICAqIGludGVsX2NkY2xrX2luaXQgLSBJbml0aWFsaXplIENE
Q0xLCiAgKiBAaTkxNTogaTkxNSBkZXZpY2UKICAqCi0gKiBJbml0aWFsaXplIENEQ0xLLiBUaGlz
IGNvbnNpc3RzIG1haW5seSBvZiBpbml0aWFsaXppbmcgZGV2X3ByaXYtPmNkY2xrLmh3IGFuZAor
ICogSW5pdGlhbGl6ZSBDRENMSy4gVGhpcyBjb25zaXN0cyBtYWlubHkgb2YgaW5pdGlhbGl6aW5n
IGk5MTUtPmNkY2xrLmh3IGFuZAogICogc2FuaXRpemluZyB0aGUgc3RhdGUgb2YgdGhlIGhhcmR3
YXJlIGlmIG5lZWRlZC4gVGhpcyBpcyBnZW5lcmFsbHkgZG9uZSBvbmx5CiAgKiBkdXJpbmcgdGhl
IGRpc3BsYXkgY29yZSBpbml0aWFsaXphdGlvbiBzZXF1ZW5jZSwgYWZ0ZXIgd2hpY2ggdGhlIERN
QyB3aWxsCiAgKiB0YWtlIGNhcmUgb2YgdHVybmluZyBDRENMSyBvZmYvb24gYXMgbmVlZGVkLgpA
QCAtMjA1MSwxOSArMjA1MSwxOSBAQCBib29sIGludGVsX2NkY2xrX25lZWRzX21vZGVzZXQoY29u
c3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICphLAogCiAvKioKICAqIGludGVsX2NkY2xrX25l
ZWRzX2NkMnhfdXBkYXRlIC0gRGV0ZXJtaW5lIGlmIHR3byBDRENMSyBzdGF0ZXMgcmVxdWlyZSBh
IGNkMnggZGl2aWRlciB1cGRhdGUKLSAqIEBkZXZfcHJpdjogTm90IGEgQ0RDTEsgc3RhdGUsIGl0
J3MgdGhlIGRybV9pOTE1X3ByaXZhdGUhCisgKiBAaTkxNTogTm90IGEgQ0RDTEsgc3RhdGUsIGl0
J3MgdGhlIGRybV9pOTE1X3ByaXZhdGUhCiAgKiBAYTogZmlyc3QgQ0RDTEsgc3RhdGUKICAqIEBi
OiBzZWNvbmQgQ0RDTEsgc3RhdGUKICAqCiAgKiBSZXR1cm5zOgogICogVHJ1ZSBpZiB0aGUgQ0RD
TEsgc3RhdGVzIHJlcXVpcmUganVzdCBhIGNkMnggZGl2aWRlciB1cGRhdGUsIGZhbHNlIGlmIG5v
dC4KICAqLwotYm9vbCBpbnRlbF9jZGNsa19uZWVkc19jZDJ4X3VwZGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitib29sIGludGVsX2NkY2xrX25lZWRzX2NkMnhfdXBkYXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jZGNsa19zdGF0ZSAqYSwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUg
KmIpCiB7CiAJLyogT2xkZXIgaHcgZG9lc24ndCBoYXZlIHRoZSBjYXBhYmlsaXR5ICovCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPCAxMCAmJiAhSVNfR0VOOV9MUChkZXZfcHJpdikpCisJaWYg
KElOVEVMX0dFTihpOTE1KSA8IDEwICYmICFJU19HRU45X0xQKGk5MTUpKQogCQlyZXR1cm4gZmFs
c2U7CiAKIAlyZXR1cm4gYS0+Y2RjbGsgIT0gYi0+Y2RjbGsgJiYKQEAgLTIxMDAsMTAgKzIxMDAs
MTAgQEAgYm9vbCBpbnRlbF9jZGNsa19jaGFuZ2VkKGNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19z
dGF0ZSAqYSwKICAqLwogdm9pZCBpbnRlbF9jZGNsa19zd2FwX3N0YXRlKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAotCXN3YXAoc3RhdGUtPmNkY2xrLmxv
Z2ljYWwsIGRldl9wcml2LT5jZGNsay5sb2dpY2FsKTsKLQlzd2FwKHN0YXRlLT5jZGNsay5hY3R1
YWwsIGRldl9wcml2LT5jZGNsay5hY3R1YWwpOworCXN3YXAoc3RhdGUtPmNkY2xrLmxvZ2ljYWws
IGk5MTUtPmNkY2xrLmxvZ2ljYWwpOworCXN3YXAoc3RhdGUtPmNkY2xrLmFjdHVhbCwgaTkxNS0+
Y2RjbGsuYWN0dWFsKTsKIH0KIAogdm9pZCBpbnRlbF9kdW1wX2NkY2xrX3N0YXRlKGNvbnN0IHN0
cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUsCkBAIC0yMTE3LDM3ICsyMTE3LDM3
IEBAIHZvaWQgaW50ZWxfZHVtcF9jZGNsa19zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtf
c3RhdGUgKmNkY2xrX3N0YXRlLAogCiAvKioKICAqIGludGVsX3NldF9jZGNsayAtIFB1c2ggdGhl
IENEQ0xLIHN0YXRlIHRvIHRoZSBoYXJkd2FyZQotICogQGRldl9wcml2OiBpOTE1IGRldmljZQor
ICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKiBAY2RjbGtfc3RhdGU6IG5ldyBDRENMSyBzdGF0ZQog
ICogQHBpcGU6IHBpcGUgd2l0aCB3aGljaCB0byBzeW5jaHJvbml6ZSB0aGUgdXBkYXRlCiAgKgog
ICogUHJvZ3JhbSB0aGUgaGFyZHdhcmUgYmFzZWQgb24gdGhlIHBhc3NlZCBpbiBDRENMSyBzdGF0
ZSwKICAqIGlmIG5lY2Vzc2FyeS4KICAqLwotc3RhdGljIHZvaWQgaW50ZWxfc2V0X2NkY2xrKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGludGVsX3NldF9j
ZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlLAogCQkJICAgIGVudW0gcGlwZSBwaXBlKQog
ewotCWlmICghaW50ZWxfY2RjbGtfY2hhbmdlZCgmZGV2X3ByaXYtPmNkY2xrLmh3LCBjZGNsa19z
dGF0ZSkpCisJaWYgKCFpbnRlbF9jZGNsa19jaGFuZ2VkKCZpOTE1LT5jZGNsay5odywgY2RjbGtf
c3RhdGUpKQogCQlyZXR1cm47CiAKLQlpZiAoV0FSTl9PTl9PTkNFKCFkZXZfcHJpdi0+ZGlzcGxh
eS5zZXRfY2RjbGspKQorCWlmIChXQVJOX09OX09OQ0UoIWk5MTUtPmRpc3BsYXkuc2V0X2NkY2xr
KSkKIAkJcmV0dXJuOwogCiAJaW50ZWxfZHVtcF9jZGNsa19zdGF0ZShjZGNsa19zdGF0ZSwgIkNo
YW5naW5nIENEQ0xLIHRvIik7CiAKLQlkZXZfcHJpdi0+ZGlzcGxheS5zZXRfY2RjbGsoZGV2X3By
aXYsIGNkY2xrX3N0YXRlLCBwaXBlKTsKKwlpOTE1LT5kaXNwbGF5LnNldF9jZGNsayhpOTE1LCBj
ZGNsa19zdGF0ZSwgcGlwZSk7CiAKLQlpZiAoV0FSTihpbnRlbF9jZGNsa19jaGFuZ2VkKCZkZXZf
cHJpdi0+Y2RjbGsuaHcsIGNkY2xrX3N0YXRlKSwKKwlpZiAoV0FSTihpbnRlbF9jZGNsa19jaGFu
Z2VkKCZpOTE1LT5jZGNsay5odywgY2RjbGtfc3RhdGUpLAogCQkgImNkY2xrIHN0YXRlIGRvZXNu
J3QgbWF0Y2ghXG4iKSkgewotCQlpbnRlbF9kdW1wX2NkY2xrX3N0YXRlKCZkZXZfcHJpdi0+Y2Rj
bGsuaHcsICJbaHcgc3RhdGVdIik7CisJCWludGVsX2R1bXBfY2RjbGtfc3RhdGUoJmk5MTUtPmNk
Y2xrLmh3LCAiW2h3IHN0YXRlXSIpOwogCQlpbnRlbF9kdW1wX2NkY2xrX3N0YXRlKGNkY2xrX3N0
YXRlLCAiW3N3IHN0YXRlXSIpOwogCX0KIH0KIAogLyoqCiAgKiBpbnRlbF9zZXRfY2RjbGtfcHJl
X3BsYW5lX3VwZGF0ZSAtIFB1c2ggdGhlIENEQ0xLIHN0YXRlIHRvIHRoZSBoYXJkd2FyZQotICog
QGRldl9wcml2OiBpOTE1IGRldmljZQorICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKiBAb2xkX3N0
YXRlOiBvbGQgQ0RDTEsgc3RhdGUKICAqIEBuZXdfc3RhdGU6IG5ldyBDRENMSyBzdGF0ZQogICog
QHBpcGU6IHBpcGUgd2l0aCB3aGljaCB0byBzeW5jaHJvbml6ZSB0aGUgdXBkYXRlCkBAIC0yMTU2
LDE4ICsyMTU2LDE4IEBAIHN0YXRpYyB2b2lkIGludGVsX3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBpbiBDRENMSyBzdGF0ZSwgaWYgbmVjZXNzYXJ5Lgog
ICovCiB2b2lkCi1pbnRlbF9zZXRfY2RjbGtfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9zZXRfY2RjbGtfcHJlX3BsYW5lX3VwZGF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgY29uc3Qgc3RydWN0IGludGVsX2Nk
Y2xrX3N0YXRlICpvbGRfc3RhdGUsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0
ZSAqbmV3X3N0YXRlLAogCQkJCSBlbnVtIHBpcGUgcGlwZSkKIHsKIAlpZiAocGlwZSA9PSBJTlZB
TElEX1BJUEUgfHwgb2xkX3N0YXRlLT5jZGNsayA8PSBuZXdfc3RhdGUtPmNkY2xrKQotCQlpbnRl
bF9zZXRfY2RjbGsoZGV2X3ByaXYsIG5ld19zdGF0ZSwgcGlwZSk7CisJCWludGVsX3NldF9jZGNs
ayhpOTE1LCBuZXdfc3RhdGUsIHBpcGUpOwogfQogCiAvKioKICAqIGludGVsX3NldF9jZGNsa19w
b3N0X3BsYW5lX3VwZGF0ZSAtIFB1c2ggdGhlIENEQ0xLIHN0YXRlIHRvIHRoZSBoYXJkd2FyZQot
ICogQGRldl9wcml2OiBpOTE1IGRldmljZQorICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKiBAb2xk
X3N0YXRlOiBvbGQgQ0RDTEsgc3RhdGUKICAqIEBuZXdfc3RhdGU6IG5ldyBDRENMSyBzdGF0ZQog
ICogQHBpcGU6IHBpcGUgd2l0aCB3aGljaCB0byBzeW5jaHJvbml6ZSB0aGUgdXBkYXRlCkBAIC0y
MTc2LDI0ICsyMTc2LDI0IEBAIGludGVsX3NldF9jZGNsa19wcmVfcGxhbmVfdXBkYXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqIGluIENEQ0xLIHN0YXRlLCBpZiBuZWNl
c3NhcnkuCiAgKi8KIHZvaWQKLWludGVsX3NldF9jZGNsa19wb3N0X3BsYW5lX3VwZGF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9zZXRfY2RjbGtfcG9zdF9wbGFu
ZV91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICBjb25zdCBzdHJ1
Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKm9sZF9zdGF0ZSwKIAkJCQkgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jZGNsa19zdGF0ZSAqbmV3X3N0YXRlLAogCQkJCSAgZW51bSBwaXBlIHBpcGUpCiB7CiAJaWYg
KHBpcGUgIT0gSU5WQUxJRF9QSVBFICYmIG9sZF9zdGF0ZS0+Y2RjbGsgPiBuZXdfc3RhdGUtPmNk
Y2xrKQotCQlpbnRlbF9zZXRfY2RjbGsoZGV2X3ByaXYsIG5ld19zdGF0ZSwgcGlwZSk7CisJCWlu
dGVsX3NldF9jZGNsayhpOTE1LCBuZXdfc3RhdGUsIHBpcGUpOwogfQogCi1zdGF0aWMgaW50IGlu
dGVsX3BpeGVsX3JhdGVfdG9fY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIGludCBpbnRlbF9waXhlbF9yYXRlX3RvX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSAgICAgaW50IHBpeGVsX3JhdGUpCiB7Ci0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElOVEVM
X0dFTihpOTE1KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGk5MTUpKQogCQlyZXR1cm4gRElWX1JP
VU5EX1VQKHBpeGVsX3JhdGUsIDIpOwotCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgOSkgfHwK
LQkJIElTX0JST0FEV0VMTChkZXZfcHJpdikgfHwgSVNfSEFTV0VMTChkZXZfcHJpdikpCisJZWxz
ZSBpZiAoSVNfR0VOKGk5MTUsIDkpIHx8CisJCSBJU19CUk9BRFdFTEwoaTkxNSkgfHwgSVNfSEFT
V0VMTChpOTE1KSkKIAkJcmV0dXJuIHBpeGVsX3JhdGU7Ci0JZWxzZSBpZiAoSVNfQ0hFUlJZVklF
VyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJcmV0dXJuIERJ
Vl9ST1VORF9VUChwaXhlbF9yYXRlICogMTAwLCA5NSk7CiAJZWxzZQogCQlyZXR1cm4gRElWX1JP
VU5EX1VQKHBpeGVsX3JhdGUgKiAxMDAsIDkwKTsKQEAgLTIyMDEsMTcgKzIyMDEsMTcgQEAgc3Rh
dGljIGludCBpbnRlbF9waXhlbF9yYXRlX3RvX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAogaW50IGludGVsX2NydGNfY29tcHV0ZV9taW5fY2RjbGsoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCXRv
X2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCWludCBtaW5fY2RjbGs7CiAKIAlp
ZiAoIWNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQogCQlyZXR1cm4gMDsKIAotCW1pbl9jZGNsayA9
IGludGVsX3BpeGVsX3JhdGVfdG9fY2RjbGsoZGV2X3ByaXYsIGNydGNfc3RhdGUtPnBpeGVsX3Jh
dGUpOworCW1pbl9jZGNsayA9IGludGVsX3BpeGVsX3JhdGVfdG9fY2RjbGsoaTkxNSwgY3J0Y19z
dGF0ZS0+cGl4ZWxfcmF0ZSk7CiAKIAkvKiBwaXhlbCByYXRlIG11c3RuJ3QgZXhjZWVkIDk1JSBv
ZiBjZGNsayB3aXRoIElQUyBvbiBCRFcgKi8KLQlpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSAm
JiBoc3dfY3J0Y19zdGF0ZV9pcHNfY2FwYWJsZShjcnRjX3N0YXRlKSkKKwlpZiAoSVNfQlJPQURX
RUxMKGk5MTUpICYmIGhzd19jcnRjX3N0YXRlX2lwc19jYXBhYmxlKGNydGNfc3RhdGUpKQogCQlt
aW5fY2RjbGsgPSBESVZfUk9VTkRfVVAobWluX2NkY2xrICogMTAwLCA5NSk7CiAKIAkvKiBCU3Bl
YyBzYXlzICJEbyBub3QgdXNlIERpc3BsYXlQb3J0IHdpdGggQ0RDTEsgbGVzcyB0aGFuIDQzMiBN
SHosCkBAIC0yMjIzLDEwICsyMjIzLDEwIEBAIGludCBpbnRlbF9jcnRjX2NvbXB1dGVfbWluX2Nk
Y2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAgICBjcnRj
X3N0YXRlLT5oYXNfYXVkaW8gJiYKIAkgICAgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayA+PSA1NDAw
MDAgJiYKIAkgICAgY3J0Y19zdGF0ZS0+bGFuZV9jb3VudCA9PSA0KSB7Ci0JCWlmIChJU19DQU5O
T05MQUtFKGRldl9wcml2KSB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCQlpZiAoSVNf
Q0FOTk9OTEFLRShpOTE1KSB8fCBJU19HRU1JTklMQUtFKGk5MTUpKSB7CiAJCQkvKiBEaXNwbGF5
IFdBICMxMTQ1OiBnbGssY25sICovCiAJCQltaW5fY2RjbGsgPSBtYXgoMzE2ODAwLCBtaW5fY2Rj
bGspOwotCQl9IGVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgOSkgfHwgSVNfQlJPQURXRUxMKGRl
dl9wcml2KSkgeworCQl9IGVsc2UgaWYgKElTX0dFTihpOTE1LCA5KSB8fCBJU19CUk9BRFdFTEwo
aTkxNSkpIHsKIAkJCS8qIERpc3BsYXkgV0EgIzExNDQ6IHNrbCxieHQgKi8KIAkJCW1pbl9jZGNs
ayA9IG1heCg0MzIwMDAsIG1pbl9jZGNsayk7CiAJCX0KQEAgLTIyMzYsNyArMjIzNiw3IEBAIGlu
dCBpbnRlbF9jcnRjX2NvbXB1dGVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogCSAqIEFjY29yZGluZyB0byBCU3BlYywgIlRoZSBDRCBjbG9jayBm
cmVxdWVuY3kgbXVzdCBiZSBhdCBsZWFzdCB0d2ljZQogCSAqIHRoZSBmcmVxdWVuY3kgb2YgdGhl
IEF6YWxpYSBCQ0xLLiIgYW5kIEJDTEsgaXMgOTYgTUh6IGJ5IGRlZmF1bHQuCiAJICovCi0JaWYg
KGNydGNfc3RhdGUtPmhhc19hdWRpbyAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYg
KGNydGNfc3RhdGUtPmhhc19hdWRpbyAmJiBJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJbWluX2Nk
Y2xrID0gbWF4KDIgKiA5NjAwMCwgbWluX2NkY2xrKTsKIAogCS8qCkBAIC0yMjQ0LDcgKzIyNDQs
NyBAQCBpbnQgaW50ZWxfY3J0Y19jb21wdXRlX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKiB0aGFuIDMyMDAwMEtIei4KIAkgKi8KIAlpZiAo
aW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFNJKSAmJgotCSAg
ICBJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKKwkgICAgSVNfVkFMTEVZVklFVyhpOTE1KSkKIAkJ
bWluX2NkY2xrID0gbWF4KDMyMDAwMCwgbWluX2NkY2xrKTsKIAogCS8qCkBAIC0yMjUzLDEyICsy
MjUzLDEyIEBAIGludCBpbnRlbF9jcnRjX2NvbXB1dGVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAqIGNvcnJlY3QgZm9yIERTSSBQTEwgYW5k
IERFIFBMTC4KIAkgKi8KIAlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRF
TF9PVVRQVVRfRFNJKSAmJgotCSAgICBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkgICAgSVNf
R0VNSU5JTEFLRShpOTE1KSkKIAkJbWluX2NkY2xrID0gbWF4KDE1ODQwMCwgbWluX2NkY2xrKTsK
IAotCWlmIChtaW5fY2RjbGsgPiBkZXZfcHJpdi0+bWF4X2NkY2xrX2ZyZXEpIHsKKwlpZiAobWlu
X2NkY2xrID4gaTkxNS0+bWF4X2NkY2xrX2ZyZXEpIHsKIAkJRFJNX0RFQlVHX0tNUygicmVxdWly
ZWQgY2RjbGsgKCVkIGtIeikgZXhjZWVkcyBtYXggKCVkIGtIeilcbiIsCi0JCQkgICAgICBtaW5f
Y2RjbGssIGRldl9wcml2LT5tYXhfY2RjbGtfZnJlcSk7CisJCQkgICAgICBtaW5fY2RjbGssIGk5
MTUtPm1heF9jZGNsa19mcmVxKTsKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCkBAIC0yMjY3LDEz
ICsyMjY3LDEzIEBAIGludCBpbnRlbF9jcnRjX2NvbXB1dGVfbWluX2NkY2xrKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgaW50IGludGVsX2NvbXB1
dGVfbWluX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2
KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZTsKIAlpbnQgbWluX2NkY2xrLCBpOwogCWVudW0gcGlwZSBwaXBlOwogCi0JbWVt
Y3B5KHN0YXRlLT5taW5fY2RjbGssIGRldl9wcml2LT5taW5fY2RjbGssCisJbWVtY3B5KHN0YXRl
LT5taW5fY2RjbGssIGk5MTUtPm1pbl9jZGNsaywKIAkgICAgICAgc2l6ZW9mKHN0YXRlLT5taW5f
Y2RjbGspKTsKIAogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRj
LCBjcnRjX3N0YXRlLCBpKSB7CkBAIC0yMjg1LDcgKzIyODUsNyBAQCBzdGF0aWMgaW50IGludGVs
X2NvbXB1dGVfbWluX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCX0K
IAogCW1pbl9jZGNsayA9IHN0YXRlLT5jZGNsay5mb3JjZV9taW5fY2RjbGs7Ci0JZm9yX2VhY2hf
cGlwZShkZXZfcHJpdiwgcGlwZSkKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCiAJCW1pbl9j
ZGNsayA9IG1heChzdGF0ZS0+bWluX2NkY2xrW3BpcGVdLCBtaW5fY2RjbGspOwogCiAJcmV0dXJu
IG1pbl9jZGNsazsKQEAgLTIzMDIsMTQgKzIzMDIsMTQgQEAgc3RhdGljIGludCBpbnRlbF9jb21w
dXRlX21pbl9jZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKICAqLwogc3Rh
dGljIHU4IGNubF9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKIAl1OCBtaW5fdm9sdGFnZV9sZXZl
bDsKIAlpbnQgaTsKIAllbnVtIHBpcGUgcGlwZTsKIAotCW1lbWNweShzdGF0ZS0+bWluX3ZvbHRh
Z2VfbGV2ZWwsIGRldl9wcml2LT5taW5fdm9sdGFnZV9sZXZlbCwKKwltZW1jcHkoc3RhdGUtPm1p
bl92b2x0YWdlX2xldmVsLCBpOTE1LT5taW5fdm9sdGFnZV9sZXZlbCwKIAkgICAgICAgc2l6ZW9m
KHN0YXRlLT5taW5fdm9sdGFnZV9sZXZlbCkpOwogCiAJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNf
aW5fc3RhdGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsKQEAgLTIzMjEsNyArMjMyMSw3
IEBAIHN0YXRpYyB1OCBjbmxfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSkKIAl9CiAKIAltaW5fdm9sdGFnZV9sZXZlbCA9IDA7Ci0JZm9y
X2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCiAJ
CW1pbl92b2x0YWdlX2xldmVsID0gbWF4KHN0YXRlLT5taW5fdm9sdGFnZV9sZXZlbFtwaXBlXSwK
IAkJCQkJbWluX3ZvbHRhZ2VfbGV2ZWwpOwogCkBAIC0yMzMwLDI1ICsyMzMwLDI1IEBAIHN0YXRp
YyB1OCBjbmxfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAogc3RhdGljIGludCB2bHZfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAlpbnQgbWluX2NkY2xrLCBj
ZGNsazsKIAogCW1pbl9jZGNsayA9IGludGVsX2NvbXB1dGVfbWluX2NkY2xrKHN0YXRlKTsKIAlp
ZiAobWluX2NkY2xrIDwgMCkKIAkJcmV0dXJuIG1pbl9jZGNsazsKIAotCWNkY2xrID0gdmx2X2Nh
bGNfY2RjbGsoZGV2X3ByaXYsIG1pbl9jZGNsayk7CisJY2RjbGsgPSB2bHZfY2FsY19jZGNsayhp
OTE1LCBtaW5fY2RjbGspOwogCiAJc3RhdGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsK
IAlzdGF0ZS0+Y2RjbGsubG9naWNhbC52b2x0YWdlX2xldmVsID0KLQkJdmx2X2NhbGNfdm9sdGFn
ZV9sZXZlbChkZXZfcHJpdiwgY2RjbGspOworCQl2bHZfY2FsY192b2x0YWdlX2xldmVsKGk5MTUs
IGNkY2xrKTsKIAogCWlmICghc3RhdGUtPmFjdGl2ZV9jcnRjcykgewotCQljZGNsayA9IHZsdl9j
YWxjX2NkY2xrKGRldl9wcml2LCBzdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrKTsKKwkJY2Rj
bGsgPSB2bHZfY2FsY19jZGNsayhpOTE1LCBzdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrKTsK
IAogCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLmNkY2xrID0gY2RjbGs7CiAJCXN0YXRlLT5jZGNsay5h
Y3R1YWwudm9sdGFnZV9sZXZlbCA9Ci0JCQl2bHZfY2FsY192b2x0YWdlX2xldmVsKGRldl9wcml2
LCBjZGNsayk7CisJCQl2bHZfY2FsY192b2x0YWdlX2xldmVsKGk5MTUsIGNkY2xrKTsKIAl9IGVs
c2UgewogCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsID0gc3RhdGUtPmNkY2xrLmxvZ2ljYWw7CiAJfQpA
QCAtMjM4OSwxNCArMjM4OSwxNCBAQCBzdGF0aWMgaW50IGJkd19tb2Rlc2V0X2NhbGNfY2RjbGso
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIHN0YXRpYyBpbnQgc2tsX2RwbGww
X3ZjbyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGludGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGU7CiAJaW50IHZjbywgaTsKIAogCXZjbyA9IHN0YXRlLT5jZGNsay5sb2dpY2FsLnZjbzsKIAlp
ZiAoIXZjbykKLQkJdmNvID0gZGV2X3ByaXYtPnNrbF9wcmVmZXJyZWRfdmNvX2ZyZXE7CisJCXZj
byA9IGk5MTUtPnNrbF9wcmVmZXJyZWRfdmNvX2ZyZXE7CiAKIAlmb3JfZWFjaF9uZXdfaW50ZWxf
Y3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkgewogCQlpZiAoIWNydGNf
c3RhdGUtPmJhc2UuZW5hYmxlKQpAQCAtMjQ2MCwxOSArMjQ2MCwxOSBAQCBzdGF0aWMgaW50IHNr
bF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAK
IHN0YXRpYyBpbnQgYnh0X21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CiAJaW50IG1pbl9jZGNsaywgY2RjbGssIHZjbzsKIAog
CW1pbl9jZGNsayA9IGludGVsX2NvbXB1dGVfbWluX2NkY2xrKHN0YXRlKTsKIAlpZiAobWluX2Nk
Y2xrIDwgMCkKIAkJcmV0dXJuIG1pbl9jZGNsazsKIAotCWlmIChJU19HRU1JTklMQUtFKGRldl9w
cml2KSkgeworCWlmIChJU19HRU1JTklMQUtFKGk5MTUpKSB7CiAJCWNkY2xrID0gZ2xrX2NhbGNf
Y2RjbGsobWluX2NkY2xrKTsKLQkJdmNvID0gZ2xrX2RlX3BsbF92Y28oZGV2X3ByaXYsIGNkY2xr
KTsKKwkJdmNvID0gZ2xrX2RlX3BsbF92Y28oaTkxNSwgY2RjbGspOwogCX0gZWxzZSB7CiAJCWNk
Y2xrID0gYnh0X2NhbGNfY2RjbGsobWluX2NkY2xrKTsKLQkJdmNvID0gYnh0X2RlX3BsbF92Y28o
ZGV2X3ByaXYsIGNkY2xrKTsKKwkJdmNvID0gYnh0X2RlX3BsbF92Y28oaTkxNSwgY2RjbGspOwog
CX0KIAogCXN0YXRlLT5jZGNsay5sb2dpY2FsLnZjbyA9IHZjbzsKQEAgLTI0ODEsMTIgKzI0ODEs
MTIgQEAgc3RhdGljIGludCBieHRfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogCQlieHRfY2FsY192b2x0YWdlX2xldmVsKGNkY2xrKTsKIAogCWlm
ICghc3RhdGUtPmFjdGl2ZV9jcnRjcykgewotCQlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikp
IHsKKwkJaWYgKElTX0dFTUlOSUxBS0UoaTkxNSkpIHsKIAkJCWNkY2xrID0gZ2xrX2NhbGNfY2Rj
bGsoc3RhdGUtPmNkY2xrLmZvcmNlX21pbl9jZGNsayk7Ci0JCQl2Y28gPSBnbGtfZGVfcGxsX3Zj
byhkZXZfcHJpdiwgY2RjbGspOworCQkJdmNvID0gZ2xrX2RlX3BsbF92Y28oaTkxNSwgY2RjbGsp
OwogCQl9IGVsc2UgewogCQkJY2RjbGsgPSBieHRfY2FsY19jZGNsayhzdGF0ZS0+Y2RjbGsuZm9y
Y2VfbWluX2NkY2xrKTsKLQkJCXZjbyA9IGJ4dF9kZV9wbGxfdmNvKGRldl9wcml2LCBjZGNsayk7
CisJCQl2Y28gPSBieHRfZGVfcGxsX3ZjbyhpOTE1LCBjZGNsayk7CiAJCX0KIAogCQlzdGF0ZS0+
Y2RjbGsuYWN0dWFsLnZjbyA9IHZjbzsKQEAgLTI1MDIsNyArMjUwMiw3IEBAIHN0YXRpYyBpbnQg
Ynh0X21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAogc3RhdGljIGludCBjbmxfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAlpbnQgbWluX2NkY2xrLCBjZGNsaywgdmNvOwog
CiAJbWluX2NkY2xrID0gaW50ZWxfY29tcHV0ZV9taW5fY2RjbGsoc3RhdGUpOwpAQCAtMjUxMCw3
ICsyNTEwLDcgQEAgc3RhdGljIGludCBjbmxfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQlyZXR1cm4gbWluX2NkY2xrOwogCiAJY2RjbGsgPSBj
bmxfY2FsY19jZGNsayhtaW5fY2RjbGspOwotCXZjbyA9IGNubF9jZGNsa19wbGxfdmNvKGRldl9w
cml2LCBjZGNsayk7CisJdmNvID0gY25sX2NkY2xrX3BsbF92Y28oaTkxNSwgY2RjbGspOwogCiAJ
c3RhdGUtPmNkY2xrLmxvZ2ljYWwudmNvID0gdmNvOwogCXN0YXRlLT5jZGNsay5sb2dpY2FsLmNk
Y2xrID0gY2RjbGs7CkBAIC0yNTIwLDcgKzI1MjAsNyBAQCBzdGF0aWMgaW50IGNubF9tb2Rlc2V0
X2NhbGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAlpZiAoIXN0
YXRlLT5hY3RpdmVfY3J0Y3MpIHsKIAkJY2RjbGsgPSBjbmxfY2FsY19jZGNsayhzdGF0ZS0+Y2Rj
bGsuZm9yY2VfbWluX2NkY2xrKTsKLQkJdmNvID0gY25sX2NkY2xrX3BsbF92Y28oZGV2X3ByaXYs
IGNkY2xrKTsKKwkJdmNvID0gY25sX2NkY2xrX3BsbF92Y28oaTkxNSwgY2RjbGspOwogCiAJCXN0
YXRlLT5jZGNsay5hY3R1YWwudmNvID0gdmNvOwogCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLmNkY2xr
ID0gY2RjbGs7CkBAIC0yNTM1LDcgKzI1MzUsNyBAQCBzdGF0aWMgaW50IGNubF9tb2Rlc2V0X2Nh
bGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIHN0YXRpYyBpbnQg
aWNsX21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHN0YXRl
LT5iYXNlLmRldik7CiAJdW5zaWduZWQgaW50IHJlZiA9IHN0YXRlLT5jZGNsay5sb2dpY2FsLnJl
ZjsKIAlpbnQgbWluX2NkY2xrLCBjZGNsaywgdmNvOwogCkBAIC0yNTQ0LDcgKzI1NDQsNyBAQCBz
dGF0aWMgaW50IGljbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiAJCXJldHVybiBtaW5fY2RjbGs7CiAKIAljZGNsayA9IGljbF9jYWxjX2NkY2xr
KG1pbl9jZGNsaywgcmVmKTsKLQl2Y28gPSBpY2xfY2FsY19jZGNsa19wbGxfdmNvKGRldl9wcml2
LCBjZGNsayk7CisJdmNvID0gaWNsX2NhbGNfY2RjbGtfcGxsX3ZjbyhpOTE1LCBjZGNsayk7CiAK
IAlzdGF0ZS0+Y2RjbGsubG9naWNhbC52Y28gPSB2Y287CiAJc3RhdGUtPmNkY2xrLmxvZ2ljYWwu
Y2RjbGsgPSBjZGNsazsKQEAgLTI1NTQsNyArMjU1NCw3IEBAIHN0YXRpYyBpbnQgaWNsX21vZGVz
ZXRfY2FsY19jZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAogCWlmICgh
c3RhdGUtPmFjdGl2ZV9jcnRjcykgewogCQljZGNsayA9IGljbF9jYWxjX2NkY2xrKHN0YXRlLT5j
ZGNsay5mb3JjZV9taW5fY2RjbGssIHJlZik7Ci0JCXZjbyA9IGljbF9jYWxjX2NkY2xrX3BsbF92
Y28oZGV2X3ByaXYsIGNkY2xrKTsKKwkJdmNvID0gaWNsX2NhbGNfY2RjbGtfcGxsX3ZjbyhpOTE1
LCBjZGNsayk7CiAKIAkJc3RhdGUtPmNkY2xrLmFjdHVhbC52Y28gPSB2Y287CiAJCXN0YXRlLT5j
ZGNsay5hY3R1YWwuY2RjbGsgPSBjZGNsazsKQEAgLTI1NjcsMTggKzI1NjcsMTggQEAgc3RhdGlj
IGludCBpY2xfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGludGVsX2NvbXB1dGVfbWF4X2RvdGNs
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW50IGludGVsX2Nv
bXB1dGVfbWF4X2RvdGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnQg
bWF4X2NkY2xrX2ZyZXEgPSBkZXZfcHJpdi0+bWF4X2NkY2xrX2ZyZXE7CisJaW50IG1heF9jZGNs
a19mcmVxID0gaTkxNS0+bWF4X2NkY2xrX2ZyZXE7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDEwIHx8IElTX0dFTUlOSUxBS0UoaTkxNSkpCiAJCXJldHVybiAyICogbWF4X2NkY2xrX2Zy
ZXE7Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA5KSB8fAotCQkgSVNfQlJPQURXRUxMKGRl
dl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSkKKwllbHNlIGlmIChJU19HRU4oaTkxNSwg
OSkgfHwKKwkJIElTX0JST0FEV0VMTChpOTE1KSB8fCBJU19IQVNXRUxMKGk5MTUpKQogCQlyZXR1
cm4gbWF4X2NkY2xrX2ZyZXE7Ci0JZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJ
ZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJcmV0dXJuIG1heF9jZGNsa19mcmVxKjk1
LzEwMDsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCkKKwllbHNlIGlmIChJTlRF
TF9HRU4oaTkxNSkgPCA0KQogCQlyZXR1cm4gMiptYXhfY2RjbGtfZnJlcSo5MC8xMDA7CiAJZWxz
ZQogCQlyZXR1cm4gbWF4X2NkY2xrX2ZyZXEqOTAvMTAwOwpAQCAtMjU4NiwyNiArMjU4NiwyNiBA
QCBzdGF0aWMgaW50IGludGVsX2NvbXB1dGVfbWF4X2RvdGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAKIC8qKgogICogaW50ZWxfdXBkYXRlX21heF9jZGNsayAtIERldGVy
bWluZSB0aGUgbWF4aW11bSBzdXBwb3J0IENEQ0xLIGZyZXF1ZW5jeQotICogQGRldl9wcml2OiBp
OTE1IGRldmljZQorICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKgogICogRGV0ZXJtaW5lIHRoZSBt
YXhpbXVtIENEQ0xLIGZyZXF1ZW5jeSB0aGUgcGxhdGZvcm0gc3VwcG9ydHMsIGFuZCBhbHNvCiAg
KiBkZXJpdmUgdGhlIG1heGltdW0gZG90IGNsb2NrIGZyZXF1ZW5jeSB0aGUgbWF4aW11bSBDRENM
SyBmcmVxdWVuY3kKICAqIGFsbG93cy4KICAqLwotdm9pZCBpbnRlbF91cGRhdGVfbWF4X2NkY2xr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfdXBkYXRlX21h
eF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMSkgewotCQlpZiAoZGV2X3ByaXYtPmNkY2xrLmh3LnJlZiA9PSAyNDAw
MCkKLQkJCWRldl9wcml2LT5tYXhfY2RjbGtfZnJlcSA9IDY0ODAwMDsKKwlpZiAoSU5URUxfR0VO
KGk5MTUpID49IDExKSB7CisJCWlmIChpOTE1LT5jZGNsay5ody5yZWYgPT0gMjQwMDApCisJCQlp
OTE1LT5tYXhfY2RjbGtfZnJlcSA9IDY0ODAwMDsKIAkJZWxzZQotCQkJZGV2X3ByaXYtPm1heF9j
ZGNsa19mcmVxID0gNjUyODAwOwotCX0gZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikp
IHsKLQkJZGV2X3ByaXYtPm1heF9jZGNsa19mcmVxID0gNTI4MDAwOwotCX0gZWxzZSBpZiAoSVNf
R0VOOV9CQyhkZXZfcHJpdikpIHsKKwkJCWk5MTUtPm1heF9jZGNsa19mcmVxID0gNjUyODAwOwor
CX0gZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShpOTE1KSkgeworCQlpOTE1LT5tYXhfY2RjbGtfZnJl
cSA9IDUyODAwMDsKKwl9IGVsc2UgaWYgKElTX0dFTjlfQkMoaTkxNSkpIHsKIAkJdTMyIGxpbWl0
ID0gSTkxNV9SRUFEKFNLTF9ERlNNKSAmIFNLTF9ERlNNX0NEQ0xLX0xJTUlUX01BU0s7CiAJCWlu
dCBtYXhfY2RjbGssIHZjbzsKIAotCQl2Y28gPSBkZXZfcHJpdi0+c2tsX3ByZWZlcnJlZF92Y29f
ZnJlcTsKKwkJdmNvID0gaTkxNS0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcTsKIAkJV0FSTl9PTih2
Y28gIT0gODEwMDAwMCAmJiB2Y28gIT0gODY0MDAwMCk7CiAKIAkJLyoKQEAgLTI2MjIsMTIgKzI2
MjIsMTIgQEAgdm9pZCBpbnRlbF91cGRhdGVfbWF4X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAkJZWxzZQogCQkJbWF4X2NkY2xrID0gMzA4NTcxOwogCi0JCWRldl9w
cml2LT5tYXhfY2RjbGtfZnJlcSA9IHNrbF9jYWxjX2NkY2xrKG1heF9jZGNsaywgdmNvKTsKLQl9
IGVsc2UgaWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7Ci0JCWRldl9wcml2LT5tYXhfY2Rj
bGtfZnJlcSA9IDMxNjgwMDsKLQl9IGVsc2UgaWYgKElTX0JST1hUT04oZGV2X3ByaXYpKSB7Ci0J
CWRldl9wcml2LT5tYXhfY2RjbGtfZnJlcSA9IDYyNDAwMDsKLQl9IGVsc2UgaWYgKElTX0JST0FE
V0VMTChkZXZfcHJpdikpICB7CisJCWk5MTUtPm1heF9jZGNsa19mcmVxID0gc2tsX2NhbGNfY2Rj
bGsobWF4X2NkY2xrLCB2Y28pOworCX0gZWxzZSBpZiAoSVNfR0VNSU5JTEFLRShpOTE1KSkgewor
CQlpOTE1LT5tYXhfY2RjbGtfZnJlcSA9IDMxNjgwMDsKKwl9IGVsc2UgaWYgKElTX0JST1hUT04o
aTkxNSkpIHsKKwkJaTkxNS0+bWF4X2NkY2xrX2ZyZXEgPSA2MjQwMDA7CisJfSBlbHNlIGlmIChJ
U19CUk9BRFdFTEwoaTkxNSkpICB7CiAJCS8qCiAJCSAqIEZJWE1FIHdpdGggZXh0cmEgY29vbGlu
ZyB3ZSBjYW4gYWxsb3cKIAkJICogNTQwIE1IeiBmb3IgVUxYIGFuZCA2NzUgTWh6IGZvciBVTFQu
CkBAIC0yNjM1LDQwICsyNjM1LDQwIEBAIHZvaWQgaW50ZWxfdXBkYXRlX21heF9jZGNsayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIGF2YWlsYWJsZT8gUENJIElELCBW
VEIsIHNvbWV0aGluZyBlbHNlPwogCQkgKi8KIAkJaWYgKEk5MTVfUkVBRChGVVNFX1NUUkFQKSAm
IEhTV19DRENMS19MSU1JVCkKLQkJCWRldl9wcml2LT5tYXhfY2RjbGtfZnJlcSA9IDQ1MDAwMDsK
LQkJZWxzZSBpZiAoSVNfQkRXX1VMWChkZXZfcHJpdikpCi0JCQlkZXZfcHJpdi0+bWF4X2NkY2xr
X2ZyZXEgPSA0NTAwMDA7Ci0JCWVsc2UgaWYgKElTX0JEV19VTFQoZGV2X3ByaXYpKQotCQkJZGV2
X3ByaXYtPm1heF9jZGNsa19mcmVxID0gNTQwMDAwOworCQkJaTkxNS0+bWF4X2NkY2xrX2ZyZXEg
PSA0NTAwMDA7CisJCWVsc2UgaWYgKElTX0JEV19VTFgoaTkxNSkpCisJCQlpOTE1LT5tYXhfY2Rj
bGtfZnJlcSA9IDQ1MDAwMDsKKwkJZWxzZSBpZiAoSVNfQkRXX1VMVChpOTE1KSkKKwkJCWk5MTUt
Pm1heF9jZGNsa19mcmVxID0gNTQwMDAwOwogCQllbHNlCi0JCQlkZXZfcHJpdi0+bWF4X2NkY2xr
X2ZyZXEgPSA2NzUwMDA7Ci0JfSBlbHNlIGlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgewot
CQlkZXZfcHJpdi0+bWF4X2NkY2xrX2ZyZXEgPSAzMjAwMDA7Ci0JfSBlbHNlIGlmIChJU19WQUxM
RVlWSUVXKGRldl9wcml2KSkgewotCQlkZXZfcHJpdi0+bWF4X2NkY2xrX2ZyZXEgPSA0MDAwMDA7
CisJCQlpOTE1LT5tYXhfY2RjbGtfZnJlcSA9IDY3NTAwMDsKKwl9IGVsc2UgaWYgKElTX0NIRVJS
WVZJRVcoaTkxNSkpIHsKKwkJaTkxNS0+bWF4X2NkY2xrX2ZyZXEgPSAzMjAwMDA7CisJfSBlbHNl
IGlmIChJU19WQUxMRVlWSUVXKGk5MTUpKSB7CisJCWk5MTUtPm1heF9jZGNsa19mcmVxID0gNDAw
MDAwOwogCX0gZWxzZSB7CiAJCS8qIG90aGVyd2lzZSBhc3N1bWUgY2RjbGsgaXMgZml4ZWQgKi8K
LQkJZGV2X3ByaXYtPm1heF9jZGNsa19mcmVxID0gZGV2X3ByaXYtPmNkY2xrLmh3LmNkY2xrOwor
CQlpOTE1LT5tYXhfY2RjbGtfZnJlcSA9IGk5MTUtPmNkY2xrLmh3LmNkY2xrOwogCX0KIAotCWRl
dl9wcml2LT5tYXhfZG90Y2xrX2ZyZXEgPSBpbnRlbF9jb21wdXRlX21heF9kb3RjbGsoZGV2X3By
aXYpOworCWk5MTUtPm1heF9kb3RjbGtfZnJlcSA9IGludGVsX2NvbXB1dGVfbWF4X2RvdGNsayhp
OTE1KTsKIAogCURSTV9ERUJVR19EUklWRVIoIk1heCBDRCBjbG9jayByYXRlOiAlZCBrSHpcbiIs
Ci0JCQkgZGV2X3ByaXYtPm1heF9jZGNsa19mcmVxKTsKKwkJCSBpOTE1LT5tYXhfY2RjbGtfZnJl
cSk7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCJNYXggZG90Y2xvY2sgcmF0ZTogJWQga0h6XG4iLAot
CQkJIGRldl9wcml2LT5tYXhfZG90Y2xrX2ZyZXEpOworCQkJIGk5MTUtPm1heF9kb3RjbGtfZnJl
cSk7CiB9CiAKIC8qKgogICogaW50ZWxfdXBkYXRlX2NkY2xrIC0gRGV0ZXJtaW5lIHRoZSBjdXJy
ZW50IENEQ0xLIGZyZXF1ZW5jeQotICogQGRldl9wcml2OiBpOTE1IGRldmljZQorICogQGk5MTU6
IGk5MTUgZGV2aWNlCiAgKgogICogRGV0ZXJtaW5lIHRoZSBjdXJyZW50IENEQ0xLIGZyZXF1ZW5j
eS4KICAqLwotdm9pZCBpbnRlbF91cGRhdGVfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQordm9pZCBpbnRlbF91cGRhdGVfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7Ci0JZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2NkY2xrKGRldl9wcml2LCAmZGV2
X3ByaXYtPmNkY2xrLmh3KTsKKwlpOTE1LT5kaXNwbGF5LmdldF9jZGNsayhpOTE1LCAmaTkxNS0+
Y2RjbGsuaHcpOwogCiAJLyoKIAkgKiA5OjAgQ01CVVMgW3NpY10gQ0RDTEsgZnJlcXVlbmN5IChj
ZGZyZXEpOgpAQCAtMjY3NiwxMiArMjY3NiwxMiBAQCB2b2lkIGludGVsX3VwZGF0ZV9jZGNsayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogb2YgY2RjbGsgdGhhdCBnZW5l
cmF0ZXMgNE1IeiByZWZlcmVuY2UgY2xvY2sgZnJlcSB3aGljaCBpcyB1c2VkIHRvCiAJICogZ2Vu
ZXJhdGUgR01CdXMgY2xvY2suIFRoaXMgd2lsbCB2YXJ5IHdpdGggdGhlIGNkY2xrIGZyZXEuCiAJ
ICovCi0JaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3By
aXYpKQorCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpCiAJ
CUk5MTVfV1JJVEUoR01CVVNGUkVRX1ZMViwKLQkJCSAgIERJVl9ST1VORF9VUChkZXZfcHJpdi0+
Y2RjbGsuaHcuY2RjbGssIDEwMDApKTsKKwkJCSAgIERJVl9ST1VORF9VUChpOTE1LT5jZGNsay5o
dy5jZGNsaywgMTAwMCkpOwogfQogCi1zdGF0aWMgaW50IGNucF9yYXdjbGsoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCBjbnBfcmF3Y2xrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiByYXdjbGs7CiAJaW50IGRpdmlkZXIsIGZyYWN0
aW9uOwpAQCAtMjcwMiw3ICsyNzAyLDcgQEAgc3RhdGljIGludCBjbnBfcmF3Y2xrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCQlyYXdjbGsgfD0gQ05QX1JBV0NMS19ERU4o
RElWX1JPVU5EX0NMT1NFU1QobnVtZXJhdG9yICogMTAwMCwKIAkJCQkJCQkgICBmcmFjdGlvbikg
LSAxKTsKLQkJaWYgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQQ0hfSUNQKQorCQlpZiAo
SU5URUxfUENIX1RZUEUoaTkxNSkgPj0gUENIX0lDUCkKIAkJCXJhd2NsayB8PSBJQ1BfUkFXQ0xL
X05VTShudW1lcmF0b3IpOwogCX0KIApAQCAtMjcxMCwxOSArMjcxMCwxOSBAQCBzdGF0aWMgaW50
IGNucF9yYXdjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBk
aXZpZGVyICsgZnJhY3Rpb247CiB9CiAKLXN0YXRpYyBpbnQgcGNoX3Jhd2NsayhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW50IHBjaF9yYXdjbGsoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJcmV0dXJuIChJOTE1X1JFQUQoUENIX1JBV0NMS19G
UkVRKSAmIFJBV0NMS19GUkVRX01BU0spICogMTAwMDsKIH0KIAotc3RhdGljIGludCB2bHZfaHJh
d2NsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW50IHZsdl9o
cmF3Y2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIFJBV0NMS19GUkVR
X1ZMViByZWdpc3RlciB1cGRhdGVkIGZyb20gcG93ZXIgd2VsbCBjb2RlICovCi0JcmV0dXJuIHZs
dl9nZXRfY2NrX2Nsb2NrX2hwbGwoZGV2X3ByaXYsICJocmF3Y2xrIiwKKwlyZXR1cm4gdmx2X2dl
dF9jY2tfY2xvY2tfaHBsbChpOTE1LCAiaHJhd2NsayIsCiAJCQkJICAgICAgQ0NLX0RJU1BMQVlf
UkVGX0NMT0NLX0NPTlRST0wpOwogfQogCi1zdGF0aWMgaW50IGc0eF9ocmF3Y2xrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbnQgZzR4X2hyYXdjbGsoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGNsa2NmZzsKIApAQCAtMjc1MCwxMDQg
KzI3NTAsMTA0IEBAIHN0YXRpYyBpbnQgZzR4X2hyYXdjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCiAvKioKICAqIGludGVsX3VwZGF0ZV9yYXdjbGsgLSBEZXRlcm1pbmUg
dGhlIGN1cnJlbnQgUkFXQ0xLIGZyZXF1ZW5jeQotICogQGRldl9wcml2OiBpOTE1IGRldmljZQor
ICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKgogICogRGV0ZXJtaW5lIHRoZSBjdXJyZW50IFJBV0NM
SyBmcmVxdWVuY3kuIFJBV0NMSyBpcyBhIGZpeGVkCiAgKiBmcmVxdWVuY3kgY2xvY2sgc28gdGhp
cyBuZWVkcyB0byBkb25lIG9ubHkgb25jZS4KICAqLwotdm9pZCBpbnRlbF91cGRhdGVfcmF3Y2xr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKLXsKLQlpZiAoSU5URUxfUENIX1RZ
UEUoZGV2X3ByaXYpID49IFBDSF9DTlApCi0JCWRldl9wcml2LT5yYXdjbGtfZnJlcSA9IGNucF9y
YXdjbGsoZGV2X3ByaXYpOwotCWVsc2UgaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKQotCQlk
ZXZfcHJpdi0+cmF3Y2xrX2ZyZXEgPSBwY2hfcmF3Y2xrKGRldl9wcml2KTsKLQllbHNlIGlmIChJ
U19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJZGV2
X3ByaXYtPnJhd2Nsa19mcmVxID0gdmx2X2hyYXdjbGsoZGV2X3ByaXYpOwotCWVsc2UgaWYgKElT
X0c0WChkZXZfcHJpdikgfHwgSVNfUElORVZJRVcoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+cmF3
Y2xrX2ZyZXEgPSBnNHhfaHJhd2NsayhkZXZfcHJpdik7Cit2b2lkIGludGVsX3VwZGF0ZV9yYXdj
bGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJaWYgKElOVEVMX1BDSF9UWVBF
KGk5MTUpID49IFBDSF9DTlApCisJCWk5MTUtPnJhd2Nsa19mcmVxID0gY25wX3Jhd2NsayhpOTE1
KTsKKwllbHNlIGlmIChIQVNfUENIX1NQTElUKGk5MTUpKQorCQlpOTE1LT5yYXdjbGtfZnJlcSA9
IHBjaF9yYXdjbGsoaTkxNSk7CisJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19D
SEVSUllWSUVXKGk5MTUpKQorCQlpOTE1LT5yYXdjbGtfZnJlcSA9IHZsdl9ocmF3Y2xrKGk5MTUp
OworCWVsc2UgaWYgKElTX0c0WChpOTE1KSB8fCBJU19QSU5FVklFVyhpOTE1KSkKKwkJaTkxNS0+
cmF3Y2xrX2ZyZXEgPSBnNHhfaHJhd2NsayhpOTE1KTsKIAllbHNlCiAJCS8qIG5vIHJhd2NsayBv
biBvdGhlciBwbGF0Zm9ybXMsIG9yIG5vIG5lZWQgdG8ga25vdyBpdCAqLwogCQlyZXR1cm47CiAK
LQlEUk1fREVCVUdfRFJJVkVSKCJyYXdjbGsgcmF0ZTogJWQga0h6XG4iLCBkZXZfcHJpdi0+cmF3
Y2xrX2ZyZXEpOworCURSTV9ERUJVR19EUklWRVIoInJhd2NsayByYXRlOiAlZCBrSHpcbiIsIGk5
MTUtPnJhd2Nsa19mcmVxKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9pbml0X2NkY2xrX2hvb2tzIC0g
SW5pdGlhbGl6ZSBDRENMSyByZWxhdGVkIG1vZGVzZXR0aW5nIGhvb2tzCi0gKiBAZGV2X3ByaXY6
IGk5MTUgZGV2aWNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UKICAqLwotdm9pZCBpbnRlbF9pbml0
X2NkY2xrX2hvb2tzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKLXsKLQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5zZXRfY2Rj
bGsgPSBpY2xfc2V0X2NkY2xrOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2Rj
bGsgPSBpY2xfbW9kZXNldF9jYWxjX2NkY2xrOwotCX0gZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShk
ZXZfcHJpdikpIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuc2V0X2NkY2xrID0gY25sX3NldF9jZGNs
azsKLQkJZGV2X3ByaXYtPmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xrID0gY25sX21vZGVzZXRf
Y2FsY19jZGNsazsKLQl9IGVsc2UgaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7Ci0JCWRldl9w
cml2LT5kaXNwbGF5LnNldF9jZGNsayA9IGJ4dF9zZXRfY2RjbGs7Ci0JCWRldl9wcml2LT5kaXNw
bGF5Lm1vZGVzZXRfY2FsY19jZGNsayA9IGJ4dF9tb2Rlc2V0X2NhbGNfY2RjbGs7Ci0JfSBlbHNl
IGlmIChJU19HRU45X0JDKGRldl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5zZXRfY2Rj
bGsgPSBza2xfc2V0X2NkY2xrOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2Rj
bGsgPSBza2xfbW9kZXNldF9jYWxjX2NkY2xrOwotCX0gZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRl
dl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5zZXRfY2RjbGsgPSBiZHdfc2V0X2NkY2xr
OwotCQlkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGsgPSBiZHdfbW9kZXNldF9j
YWxjX2NkY2xrOwotCX0gZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKLQkJZGV2
X3ByaXYtPmRpc3BsYXkuc2V0X2NkY2xrID0gY2h2X3NldF9jZGNsazsKLQkJZGV2X3ByaXYtPmRp
c3BsYXkubW9kZXNldF9jYWxjX2NkY2xrID0gdmx2X21vZGVzZXRfY2FsY19jZGNsazsKLQl9IGVs
c2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKSB7Ci0JCWRldl9wcml2LT5kaXNwbGF5LnNl
dF9jZGNsayA9IHZsdl9zZXRfY2RjbGs7Ci0JCWRldl9wcml2LT5kaXNwbGF5Lm1vZGVzZXRfY2Fs
Y19jZGNsayA9IHZsdl9tb2Rlc2V0X2NhbGNfY2RjbGs7Cit2b2lkIGludGVsX2luaXRfY2RjbGtf
aG9va3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJaWYgKElOVEVMX0dFTihp
OTE1KSA+PSAxMSkgeworCQlpOTE1LT5kaXNwbGF5LnNldF9jZGNsayA9IGljbF9zZXRfY2RjbGs7
CisJCWk5MTUtPmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xrID0gaWNsX21vZGVzZXRfY2FsY19j
ZGNsazsKKwl9IGVsc2UgaWYgKElTX0NBTk5PTkxBS0UoaTkxNSkpIHsKKwkJaTkxNS0+ZGlzcGxh
eS5zZXRfY2RjbGsgPSBjbmxfc2V0X2NkY2xrOworCQlpOTE1LT5kaXNwbGF5Lm1vZGVzZXRfY2Fs
Y19jZGNsayA9IGNubF9tb2Rlc2V0X2NhbGNfY2RjbGs7CisJfSBlbHNlIGlmIChJU19HRU45X0xQ
KGk5MTUpKSB7CisJCWk5MTUtPmRpc3BsYXkuc2V0X2NkY2xrID0gYnh0X3NldF9jZGNsazsKKwkJ
aTkxNS0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGsgPSBieHRfbW9kZXNldF9jYWxjX2NkY2xr
OworCX0gZWxzZSBpZiAoSVNfR0VOOV9CQyhpOTE1KSkgeworCQlpOTE1LT5kaXNwbGF5LnNldF9j
ZGNsayA9IHNrbF9zZXRfY2RjbGs7CisJCWk5MTUtPmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xr
ID0gc2tsX21vZGVzZXRfY2FsY19jZGNsazsKKwl9IGVsc2UgaWYgKElTX0JST0FEV0VMTChpOTE1
KSkgeworCQlpOTE1LT5kaXNwbGF5LnNldF9jZGNsayA9IGJkd19zZXRfY2RjbGs7CisJCWk5MTUt
PmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xrID0gYmR3X21vZGVzZXRfY2FsY19jZGNsazsKKwl9
IGVsc2UgaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKKwkJaTkxNS0+ZGlzcGxheS5zZXRfY2Rj
bGsgPSBjaHZfc2V0X2NkY2xrOworCQlpOTE1LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsayA9
IHZsdl9tb2Rlc2V0X2NhbGNfY2RjbGs7CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUp
KSB7CisJCWk5MTUtPmRpc3BsYXkuc2V0X2NkY2xrID0gdmx2X3NldF9jZGNsazsKKwkJaTkxNS0+
ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGsgPSB2bHZfbW9kZXNldF9jYWxjX2NkY2xrOwogCX0K
IAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5n
ZXRfY2RjbGsgPSBpY2xfZ2V0X2NkY2xrOwotCWVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3By
aXYpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfY2RjbGsgPSBjbmxfZ2V0X2NkY2xrOwotCWVs
c2UgaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfY2Rj
bGsgPSBieHRfZ2V0X2NkY2xrOwotCWVsc2UgaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKQotCQlk
ZXZfcHJpdi0+ZGlzcGxheS5nZXRfY2RjbGsgPSBza2xfZ2V0X2NkY2xrOwotCWVsc2UgaWYgKElT
X0JST0FEV0VMTChkZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGJk
d19nZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikpCi0JCWRldl9wcml2
LT5kaXNwbGF5LmdldF9jZGNsayA9IGhzd19nZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZ
VklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCWRldl9wcml2LT5k
aXNwbGF5LmdldF9jZGNsayA9IHZsdl9nZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9w
cml2LCA2KSB8fCBJU19JVllCUklER0UoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5n
ZXRfY2RjbGsgPSBmaXhlZF80MDBtaHpfZ2V0X2NkY2xrOwotCWVsc2UgaWYgKElTX0dFTihkZXZf
cHJpdiwgNSkpCi0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGZpeGVkXzQ1MG1oel9n
ZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfR000NShkZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNw
bGF5LmdldF9jZGNsayA9IGdtNDVfZ2V0X2NkY2xrOwotCWVsc2UgaWYgKElTX0c0NShkZXZfcHJp
dikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGczM19nZXRfY2RjbGs7Ci0JZWxz
ZSBpZiAoSVNfSTk2NUdNKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2NkY2xr
ID0gaTk2NWdtX2dldF9jZGNsazsKLQllbHNlIGlmIChJU19JOTY1RyhkZXZfcHJpdikpCi0JCWRl
dl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGZpeGVkXzQwMG1oel9nZXRfY2RjbGs7Ci0JZWxz
ZSBpZiAoSVNfUElORVZJRVcoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfY2Rj
bGsgPSBwbnZfZ2V0X2NkY2xrOwotCWVsc2UgaWYgKElTX0czMyhkZXZfcHJpdikpCi0JCWRldl9w
cml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGczM19nZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfSTk0
NUdNKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2NkY2xrID0gaTk0NWdtX2dl
dF9jZGNsazsKLQllbHNlIGlmIChJU19JOTQ1RyhkZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNw
bGF5LmdldF9jZGNsayA9IGZpeGVkXzQwMG1oel9nZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfSTkx
NUdNKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2NkY2xrID0gaTkxNWdtX2dl
dF9jZGNsazsKLQllbHNlIGlmIChJU19JOTE1RyhkZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNw
bGF5LmdldF9jZGNsayA9IGZpeGVkXzMzM21oel9nZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfSTg2
NUcoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfY2RjbGsgPSBmaXhlZF8yNjZt
aHpfZ2V0X2NkY2xrOwotCWVsc2UgaWYgKElTX0k4NVgoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+
ZGlzcGxheS5nZXRfY2RjbGsgPSBpODV4X2dldF9jZGNsazsKLQllbHNlIGlmIChJU19JODQ1Ryhk
ZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGZpeGVkXzIwMG1oel9n
ZXRfY2RjbGs7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKKwkJaTkxNS0+ZGlzcGxheS5n
ZXRfY2RjbGsgPSBpY2xfZ2V0X2NkY2xrOworCWVsc2UgaWYgKElTX0NBTk5PTkxBS0UoaTkxNSkp
CisJCWk5MTUtPmRpc3BsYXkuZ2V0X2NkY2xrID0gY25sX2dldF9jZGNsazsKKwllbHNlIGlmIChJ
U19HRU45X0xQKGk5MTUpKQorCQlpOTE1LT5kaXNwbGF5LmdldF9jZGNsayA9IGJ4dF9nZXRfY2Rj
bGs7CisJZWxzZSBpZiAoSVNfR0VOOV9CQyhpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5nZXRfY2Rj
bGsgPSBza2xfZ2V0X2NkY2xrOworCWVsc2UgaWYgKElTX0JST0FEV0VMTChpOTE1KSkKKwkJaTkx
NS0+ZGlzcGxheS5nZXRfY2RjbGsgPSBiZHdfZ2V0X2NkY2xrOworCWVsc2UgaWYgKElTX0hBU1dF
TEwoaTkxNSkpCisJCWk5MTUtPmRpc3BsYXkuZ2V0X2NkY2xrID0gaHN3X2dldF9jZGNsazsKKwll
bHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpCisJCWk5
MTUtPmRpc3BsYXkuZ2V0X2NkY2xrID0gdmx2X2dldF9jZGNsazsKKwllbHNlIGlmIChJU19HRU4o
aTkxNSwgNikgfHwgSVNfSVZZQlJJREdFKGk5MTUpKQorCQlpOTE1LT5kaXNwbGF5LmdldF9jZGNs
ayA9IGZpeGVkXzQwMG1oel9nZXRfY2RjbGs7CisJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDUpKQor
CQlpOTE1LT5kaXNwbGF5LmdldF9jZGNsayA9IGZpeGVkXzQ1MG1oel9nZXRfY2RjbGs7CisJZWxz
ZSBpZiAoSVNfR000NShpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5nZXRfY2RjbGsgPSBnbTQ1X2dl
dF9jZGNsazsKKwllbHNlIGlmIChJU19HNDUoaTkxNSkpCisJCWk5MTUtPmRpc3BsYXkuZ2V0X2Nk
Y2xrID0gZzMzX2dldF9jZGNsazsKKwllbHNlIGlmIChJU19JOTY1R00oaTkxNSkpCisJCWk5MTUt
PmRpc3BsYXkuZ2V0X2NkY2xrID0gaTk2NWdtX2dldF9jZGNsazsKKwllbHNlIGlmIChJU19JOTY1
RyhpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5nZXRfY2RjbGsgPSBmaXhlZF80MDBtaHpfZ2V0X2Nk
Y2xrOworCWVsc2UgaWYgKElTX1BJTkVWSUVXKGk5MTUpKQorCQlpOTE1LT5kaXNwbGF5LmdldF9j
ZGNsayA9IHBudl9nZXRfY2RjbGs7CisJZWxzZSBpZiAoSVNfRzMzKGk5MTUpKQorCQlpOTE1LT5k
aXNwbGF5LmdldF9jZGNsayA9IGczM19nZXRfY2RjbGs7CisJZWxzZSBpZiAoSVNfSTk0NUdNKGk5
MTUpKQorCQlpOTE1LT5kaXNwbGF5LmdldF9jZGNsayA9IGk5NDVnbV9nZXRfY2RjbGs7CisJZWxz
ZSBpZiAoSVNfSTk0NUcoaTkxNSkpCisJCWk5MTUtPmRpc3BsYXkuZ2V0X2NkY2xrID0gZml4ZWRf
NDAwbWh6X2dldF9jZGNsazsKKwllbHNlIGlmIChJU19JOTE1R00oaTkxNSkpCisJCWk5MTUtPmRp
c3BsYXkuZ2V0X2NkY2xrID0gaTkxNWdtX2dldF9jZGNsazsKKwllbHNlIGlmIChJU19JOTE1Ryhp
OTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5nZXRfY2RjbGsgPSBmaXhlZF8zMzNtaHpfZ2V0X2NkY2xr
OworCWVsc2UgaWYgKElTX0k4NjVHKGk5MTUpKQorCQlpOTE1LT5kaXNwbGF5LmdldF9jZGNsayA9
IGZpeGVkXzI2Nm1oel9nZXRfY2RjbGs7CisJZWxzZSBpZiAoSVNfSTg1WChpOTE1KSkKKwkJaTkx
NS0+ZGlzcGxheS5nZXRfY2RjbGsgPSBpODV4X2dldF9jZGNsazsKKwllbHNlIGlmIChJU19JODQ1
RyhpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5nZXRfY2RjbGsgPSBmaXhlZF8yMDBtaHpfZ2V0X2Nk
Y2xrOwogCWVsc2UgeyAvKiA4MzAgKi8KLQkJV0FSTighSVNfSTgzMChkZXZfcHJpdiksCisJCVdB
Uk4oIUlTX0k4MzAoaTkxNSksCiAJCSAgICAgIlVua25vd24gcGxhdGZvcm0uIEFzc3VtaW5nIDEz
MyBNSHogQ0RDTEtcbiIpOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfY2RjbGsgPSBmaXhlZF8x
MzNtaHpfZ2V0X2NkY2xrOworCQlpOTE1LT5kaXNwbGF5LmdldF9jZGNsayA9IGZpeGVkXzEzM21o
el9nZXRfY2RjbGs7CiAJfQogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfY2RjbGsuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2NkY2xrLmgKaW5kZXggNGQ2
ZjdmNWY4OTMwLi40ZTE3MTAyYWY2NmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2NkY2xrLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfY2RjbGsuaApA
QCAtMTgsMTEgKzE4LDExIEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOwogaW50IGludGVsX2Ny
dGNfY29tcHV0ZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpOwogdm9pZCBpbnRlbF9jZGNsa19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKIHZvaWQgaW50ZWxfY2RjbGtfdW5pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKLXZvaWQgaW50ZWxfaW5pdF9jZGNsa19ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF91cGRhdGVfbWF4X2NkY2xrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX3VwZGF0ZV9jZGNsayhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF91cGRhdGVfcmF3Y2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1ib29sIGludGVsX2NkY2xrX25lZWRzX2Nk
MnhfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxf
aW5pdF9jZGNsa19ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGlu
dGVsX3VwZGF0ZV9tYXhfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9p
ZCBpbnRlbF91cGRhdGVfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9p
ZCBpbnRlbF91cGRhdGVfcmF3Y2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK2Jv
b2wgaW50ZWxfY2RjbGtfbmVlZHNfY2QyeF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICphLAogCQkJCSAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqYik7CiBib29sIGludGVsX2NkY2xrX25l
ZWRzX21vZGVzZXQoY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICphLApAQCAtMzEsMTIg
KzMxLDEyIEBAIGJvb2wgaW50ZWxfY2RjbGtfY2hhbmdlZChjb25zdCBzdHJ1Y3QgaW50ZWxfY2Rj
bGtfc3RhdGUgKmEsCiAJCQkgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpiKTsKIHZv
aWQgaW50ZWxfY2RjbGtfc3dhcF9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSk7CiB2b2lkCi1pbnRlbF9zZXRfY2RjbGtfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9zZXRfY2RjbGtfcHJlX3BsYW5lX3VwZGF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgY29uc3Qgc3RydWN0IGludGVsX2Nk
Y2xrX3N0YXRlICpvbGRfc3RhdGUsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0
ZSAqbmV3X3N0YXRlLAogCQkJCSBlbnVtIHBpcGUgcGlwZSk7CiB2b2lkCi1pbnRlbF9zZXRfY2Rj
bGtfcG9zdF9wbGFuZV91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
aW50ZWxfc2V0X2NkY2xrX3Bvc3RfcGxhbmVfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpvbGRfc3RhdGUs
CiAJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKm5ld19zdGF0ZSwKIAkJCQkg
IGVudW0gcGlwZSBwaXBlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jb2xvci5jCmluZGV4IDBiOGNm
M2U4Yzk2My4uZWZjNjdlNGEwYmE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9jb2xvci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2NvbG9yLmMKQEAg
LTEzNyw3ICsxMzcsNyBAQCBzdGF0aWMgdm9pZCBpbGtfdXBkYXRlX3BpcGVfY3NjKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAogCQkJCWNvbnN0IHUxNiBjb2VmZls5XSwKIAkJCQljb25zdCB1MTYg
cG9zdG9mZlszXSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAog
CUk5MTVfV1JJVEUoUElQRV9DU0NfUFJFT0ZGX0hJKHBpcGUpLCBwcmVvZmZbMF0pOwpAQCAtMTUz
LDcgKzE1Myw3IEBAIHN0YXRpYyB2b2lkIGlsa191cGRhdGVfcGlwZV9jc2Moc3RydWN0IGludGVs
X2NydGMgKmNydGMsCiAJSTkxNV9XUklURShQSVBFX0NTQ19DT0VGRl9SVl9HVihwaXBlKSwgY29l
ZmZbNl0gPDwgMTYgfCBjb2VmZls3XSk7CiAJSTkxNV9XUklURShQSVBFX0NTQ19DT0VGRl9CVihw
aXBlKSwgY29lZmZbOF0gPDwgMTYpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNykg
eworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNykgewogCQlJOTE1X1dSSVRFKFBJUEVfQ1NDX1BP
U1RPRkZfSEkocGlwZSksIHBvc3RvZmZbMF0pOwogCQlJOTE1X1dSSVRFKFBJUEVfQ1NDX1BPU1RP
RkZfTUUocGlwZSksIHBvc3RvZmZbMV0pOwogCQlJOTE1X1dSSVRFKFBJUEVfQ1NDX1BPU1RPRkZf
TE8ocGlwZSksIHBvc3RvZmZbMl0pOwpAQCAtMTY1LDcgKzE2NSw3IEBAIHN0YXRpYyB2b2lkIGlj
bF91cGRhdGVfb3V0cHV0X2NzYyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkgIGNvbnN0
IHUxNiBjb2VmZls5XSwKIAkJCQkgIGNvbnN0IHUxNiBwb3N0b2ZmWzNdKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCiAJSTkxNV9XUklURShQSVBFX0NTQ19PVVRQ
VVRfUFJFT0ZGX0hJKHBpcGUpLCBwcmVvZmZbMF0pOwpAQCAtMTg4LDE1ICsxODgsMTUgQEAgc3Rh
dGljIHZvaWQgaWNsX3VwZGF0ZV9vdXRwdXRfY3NjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CiBzdGF0aWMgYm9vbCBpbGtfY3NjX2xpbWl0ZWRfcmFuZ2UoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsK
IAogCS8qCiAJICogRklYTUUgaWYgdGhlcmUncyBhIGdhbW1hIExVVCBhZnRlciB0aGUgQ1NDLCB3
ZSBzaG91bGQKIAkgKiBkbyB0aGUgcmFuZ2UgY29tcHJlc3Npb24gdXNpbmcgdGhlIGdhbW1hIExV
VCBpbnN0ZWFkLgogCSAqLwogCXJldHVybiBjcnRjX3N0YXRlLT5saW1pdGVkX2NvbG9yX3Jhbmdl
ICYmCi0JCShJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpIHx8
Ci0JCSBJU19HRU5fUkFOR0UoZGV2X3ByaXYsIDksIDEwKSk7CisJCShJU19IQVNXRUxMKGk5MTUp
IHx8IElTX0JST0FEV0VMTChpOTE1KSB8fAorCQkgSVNfR0VOX1JBTkdFKGk5MTUsIDksIDEwKSk7
CiB9CiAKIHN0YXRpYyB2b2lkIGlsa19jc2NfY29udmVydF9jdG0oY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC0yNTQsNyArMjU0LDcgQEAgc3RhdGljIHZvaWQg
aWxrX2NzY19jb252ZXJ0X2N0bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIHN0YXRpYyB2b2lkIGlsa19sb2FkX2NzY19tYXRyaXgoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlib29sIGxpbWl0
ZWRfY29sb3JfcmFuZ2UgPSBpbGtfY3NjX2xpbWl0ZWRfcmFuZ2UoY3J0Y19zdGF0ZSk7CiAKIAlp
ZiAoY3J0Y19zdGF0ZS0+YmFzZS5jdG0pIHsKQEAgLTI4MCw3ICsyODAsNyBAQCBzdGF0aWMgdm9p
ZCBpbGtfbG9hZF9jc2NfbWF0cml4KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCQkgKiBMVVQgaXMgbmVlZGVkIGJ1dCBDU0MgaXMgbm90IHdlIG5lZWQgdG8gbG9h
ZCBhbgogCQkgKiBpZGVudGl0eSBtYXRyaXguCiAJCSAqLwotCQlXQVJOX09OKCFJU19DQU5OT05M
QUtFKGRldl9wcml2KSAmJiAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpOworCQlXQVJOX09OKCFJ
U19DQU5OT05MQUtFKGk5MTUpICYmICFJU19HRU1JTklMQUtFKGk5MTUpKTsKIAogCQlpbGtfdXBk
YXRlX3BpcGVfY3NjKGNydGMsIGlsa19jc2Nfb2ZmX3plcm8sCiAJCQkJICAgIGlsa19jc2NfY29l
ZmZfaWRlbnRpdHksCkBAIC0yOTMsNyArMjkzLDcgQEAgc3RhdGljIHZvaWQgaWxrX2xvYWRfY3Nj
X21hdHJpeChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRp
YyB2b2lkIGljbF9sb2FkX2NzY19tYXRyaXgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAogCWlmIChjcnRjX3N0YXRlLT5iYXNl
LmN0bSkgewogCQl1MTYgY29lZmZbOV07CkBAIC0zMjIsNyArMzIyLDcgQEAgc3RhdGljIHZvaWQg
aWNsX2xvYWRfY3NjX21hdHJpeChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHN0YXRpYyB2b2lkIGNoZXJyeXZpZXdfbG9hZF9jc2NfbWF0cml4KGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51
bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCiAJaWYgKGNydGNfc3RhdGUtPmJhc2UuY3RtKSB7
CkBAIC0zODgsMTUgKzM4OCwxNSBAQCBzdGF0aWMgdm9pZCBpOXh4X2xvYWRfbHV0c19pbnRlcm5h
bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgY29u
c3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iKQogewogCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWludCBpOwogCi0JaWYgKEhBU19HTUNIKGRl
dl9wcml2KSkgeworCWlmIChIQVNfR01DSChpOTE1KSkgewogCQlpZiAoaW50ZWxfY3J0Y19oYXNf
dHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFNJKSkKLQkJCWFzc2VydF9kc2lfcGxsX2Vu
YWJsZWQoZGV2X3ByaXYpOworCQkJYXNzZXJ0X2RzaV9wbGxfZW5hYmxlZChpOTE1KTsKIAkJZWxz
ZQotCQkJYXNzZXJ0X3BsbF9lbmFibGVkKGRldl9wcml2LCBwaXBlKTsKKwkJCWFzc2VydF9wbGxf
ZW5hYmxlZChpOTE1LCBwaXBlKTsKIAl9CiAKIAlpZiAoYmxvYikgewpAQCAtNDA4LDcgKzQwOCw3
IEBAIHN0YXRpYyB2b2lkIGk5eHhfbG9hZF9sdXRzX2ludGVybmFsKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCShkcm1fY29sb3JfbHV0X2V4dHJhY3QobHV0
W2ldLmdyZWVuLCA4KSA8PCA4KSB8CiAJCQkJZHJtX2NvbG9yX2x1dF9leHRyYWN0KGx1dFtpXS5i
bHVlLCA4KTsKIAotCQkJaWYgKEhBU19HTUNIKGRldl9wcml2KSkKKwkJCWlmIChIQVNfR01DSChp
OTE1KSkKIAkJCQlJOTE1X1dSSVRFKFBBTEVUVEUocGlwZSwgaSksIHdvcmQpOwogCQkJZWxzZQog
CQkJCUk5MTVfV1JJVEUoTEdDX1BBTEVUVEUocGlwZSwgaSksIHdvcmQpOwpAQCAtNDI0LDcgKzQy
NCw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHZvaWQgaTl4eF9jb2xvcl9jb21taXQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
IAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIHZhbDsKIApAQCAtNDM3LDcgKzQz
Nyw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfY29sb3JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHZvaWQgaWxrX2NvbG9yX2NvbW1pdChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgdmFsOwogCkBAIC00NTIsNyAr
NDUyLDcgQEAgc3RhdGljIHZvaWQgaWxrX2NvbG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGhzd19jb2xvcl9jb21taXQoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAogCUk5MTVfV1JJVEUoR0FNTUFfTU9ERShjcnRjLT5waXBlKSwgY3J0Y19zdGF0ZS0+Z2Ft
bWFfbW9kZSk7CiAKQEAgLTQ2Miw3ICs0NjIsNyBAQCBzdGF0aWMgdm9pZCBoc3dfY29sb3JfY29t
bWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHZv
aWQgc2tsX2NvbG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsK
IAl1MzIgdmFsID0gMDsKIApAQCAtNDc5LDcgKzQ3OSw3IEBAIHN0YXRpYyB2b2lkIHNrbF9jb2xv
cl9jb21taXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIAlJ
OTE1X1dSSVRFKEdBTU1BX01PREUoY3J0Yy0+cGlwZSksIGNydGNfc3RhdGUtPmdhbW1hX21vZGUp
OwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1
KSA+PSAxMSkKIAkJaWNsX2xvYWRfY3NjX21hdHJpeChjcnRjX3N0YXRlKTsKIAllbHNlCiAJCWls
a19sb2FkX2NzY19tYXRyaXgoY3J0Y19zdGF0ZSk7CkBAIC00ODgsNyArNDg4LDcgQEAgc3RhdGlj
IHZvaWQgc2tsX2NvbG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGk5NjVfbG9hZF9sdXRfMTBwNihzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmJsb2Ip
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0
YTsKIAlpbnQgaSwgbHV0X3NpemUgPSBkcm1fY29sb3JfbHV0X3NpemUoYmxvYik7CiAJZW51bSBw
aXBlIHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtNTE5LDcgKzUxOSw3IEBAIHN0YXRpYyB2b2lkIGk5
NjVfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
c3RhdGljIHZvaWQgaWxrX2xvYWRfbHV0XzEwKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJ
ICAgIGNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxvYikKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWNv
bnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9iLT5kYXRhOwogCWludCBpLCBsdXRf
c2l6ZSA9IGRybV9jb2xvcl9sdXRfc2l6ZShibG9iKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMt
PnBpcGU7CkBAIC01NTYsNyArNTU2LDcgQEAgc3RhdGljIHZvaWQgaXZiX2xvYWRfbHV0XzEwKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlf
YmxvYiAqYmxvYiwKIAkJCSAgICB1MzIgcHJlY19pbmRleCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWludCBod19s
dXRfc2l6ZSA9IGl2Yl9sdXRfMTBfc2l6ZShwcmVjX2luZGV4KTsKIAljb25zdCBzdHJ1Y3QgZHJt
X2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0YTsKIAlpbnQgaSwgbHV0X3NpemUgPSBkcm1fY29s
b3JfbHV0X3NpemUoYmxvYik7CkBAIC01ODMsNyArNTgzLDcgQEAgc3RhdGljIHZvaWQgYmR3X2xv
YWRfbHV0XzEwKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgIGNvbnN0IHN0cnVjdCBk
cm1fcHJvcGVydHlfYmxvYiAqYmxvYiwKIAkJCSAgICB1MzIgcHJlY19pbmRleCkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwogCWludCBod19sdXRfc2l6ZSA9IGl2Yl9sdXRfMTBfc2l6ZShwcmVjX2luZGV4KTsKIAljb25z
dCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0YTsKIAlpbnQgaSwgbHV0X3Np
emUgPSBkcm1fY29sb3JfbHV0X3NpemUoYmxvYik7CkBAIC02MDksNyArNjA5LDcgQEAgc3RhdGlj
IHZvaWQgYmR3X2xvYWRfbHV0XzEwKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMg
dm9pZCBpdmJfbG9hZF9sdXRfMTBfbWF4KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCiAJLyogUHJvZ3JhbSB0aGUgbWF4
IHJlZ2lzdGVyIHRvIGNsYW1wIHZhbHVlcyA+IDEuMC4gKi8KQEAgLTYyMiw3ICs2MjIsNyBAQCBz
dGF0aWMgdm9pZCBpdmJfbG9hZF9sdXRfMTBfbWF4KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQog
CSAqIFRvRG86IEV4dGVuZCB0aGUgQUJJIHRvIGJlIGFibGUgdG8gcHJvZ3JhbSB2YWx1ZXMKIAkg
KiBmcm9tIDMuMCB0byA3LjAKIAkgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8
fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTAg
fHwgSVNfR0VNSU5JTEFLRShpOTE1KSkgewogCQlJOTE1X1dSSVRFKFBSRUNfUEFMX0VYVDJfR0Nf
TUFYKHBpcGUsIDApLCAxIDw8IDE2KTsKIAkJSTkxNV9XUklURShQUkVDX1BBTF9FWFQyX0dDX01B
WChwaXBlLCAxKSwgMSA8PCAxNik7CiAJCUk5MTVfV1JJVEUoUFJFQ19QQUxfRVhUMl9HQ19NQVgo
cGlwZSwgMiksIDEgPDwgMTYpOwpAQCAtNjc4LDkgKzY3OCw5IEBAIHN0YXRpYyB2b2lkIGJkd19s
b2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0
aWMgdm9pZCBnbGtfbG9hZF9kZWdhbW1hX2x1dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKLQljb25zdCB1MzIgbHV0X3NpemUgPSBJTlRFTF9JTkZPKGRldl9wcml2KS0+Y29s
b3IuZGVnYW1tYV9sdXRfc2l6ZTsKKwljb25zdCB1MzIgbHV0X3NpemUgPSBJTlRFTF9JTkZPKGk5
MTUpLT5jb2xvci5kZWdhbW1hX2x1dF9zaXplOwogCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0
ICpsdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0LT5kYXRhOwogCXUzMiBpOwogCkBA
IC03MTcsOSArNzE3LDkgQEAgc3RhdGljIHZvaWQgZ2xrX2xvYWRfZGVnYW1tYV9sdXQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0aWMgdm9pZCBnbGtfbG9h
ZF9kZWdhbW1hX2x1dF9saW5lYXIoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7
Ci0JY29uc3QgdTMyIGx1dF9zaXplID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPmNvbG9yLmRlZ2Ft
bWFfbHV0X3NpemU7CisJY29uc3QgdTMyIGx1dF9zaXplID0gSU5URUxfSU5GTyhpOTE1KS0+Y29s
b3IuZGVnYW1tYV9sdXRfc2l6ZTsKIAl1MzIgaTsKIAogCS8qCkBAIC03OTgsNyArNzk4LDcgQEAg
c3RhdGljIHUzMiBjaHZfY2dtX2RlZ2FtbWFfdWR3KGNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0
ICpjb2xvcikKIHN0YXRpYyB2b2lkIGNodl9sb2FkX2NnbV9kZWdhbW1hKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmJsb2IpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJh
c2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0YTsK
IAlpbnQgaSwgbHV0X3NpemUgPSBkcm1fY29sb3JfbHV0X3NpemUoYmxvYik7CiAJZW51bSBwaXBl
IHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtODI1LDcgKzgyNSw3IEBAIHN0YXRpYyB1MzIgY2h2X2Nn
bV9nYW1tYV91ZHcoY29uc3Qgc3RydWN0IGRybV9jb2xvcl9sdXQgKmNvbG9yKQogc3RhdGljIHZv
aWQgY2h2X2xvYWRfY2dtX2dhbW1hKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgICAg
IGNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxvYikKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWNvbnN0
IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9iLT5kYXRhOwogCWludCBpLCBsdXRfc2l6
ZSA9IGRybV9jb2xvcl9sdXRfc2l6ZShibG9iKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBp
cGU7CkBAIC04NjAsMzcgKzg2MCwzNyBAQCBzdGF0aWMgdm9pZCBjaHZfbG9hZF9sdXRzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiB2b2lkIGludGVsX2NvbG9y
X2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUt
PmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCi0JZGV2X3ByaXYtPmRpc3BsYXkubG9h
ZF9sdXRzKGNydGNfc3RhdGUpOworCWk5MTUtPmRpc3BsYXkubG9hZF9sdXRzKGNydGNfc3RhdGUp
OwogfQogCiB2b2lkIGludGVsX2NvbG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCi0J
ZGV2X3ByaXYtPmRpc3BsYXkuY29sb3JfY29tbWl0KGNydGNfc3RhdGUpOworCWk5MTUtPmRpc3Bs
YXkuY29sb3JfY29tbWl0KGNydGNfc3RhdGUpOwogfQogCiBpbnQgaW50ZWxfY29sb3JfY2hlY2so
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJh
c2UuY3J0Yy0+ZGV2KTsKIAotCXJldHVybiBkZXZfcHJpdi0+ZGlzcGxheS5jb2xvcl9jaGVjayhj
cnRjX3N0YXRlKTsKKwlyZXR1cm4gaTkxNS0+ZGlzcGxheS5jb2xvcl9jaGVjayhjcnRjX3N0YXRl
KTsKIH0KIAogdm9pZCBpbnRlbF9jb2xvcl9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CiAKLQlp
ZiAoZGV2X3ByaXYtPmRpc3BsYXkucmVhZF9sdXRzKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5yZWFk
X2x1dHMoY3J0Y19zdGF0ZSk7CisJaWYgKGk5MTUtPmRpc3BsYXkucmVhZF9sdXRzKQorCQlpOTE1
LT5kaXNwbGF5LnJlYWRfbHV0cyhjcnRjX3N0YXRlKTsKIH0KIAogc3RhdGljIGJvb2wgbmVlZF9w
bGFuZV91cGRhdGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCSAgICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAogCS8qCiAJ
ICogT24gcHJlLVNLTCB0aGUgcGlwZSBnYW1tYSBlbmFibGUgYW5kIHBpcGUgY3NjIGVuYWJsZSBm
b3IKQEAgLTg5OCw3ICs4OTgsNyBAQCBzdGF0aWMgYm9vbCBuZWVkX3BsYW5lX3VwZGF0ZShzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCSAqIFdlIGhhdmUgdG8gcmVjb25maWd1cmUgdGhhdCBl
dmVuIGlmIHRoZSBwbGFuZSBpcyBpbmFjdGl2ZS4KIAkgKi8KIAlyZXR1cm4gY3J0Y19zdGF0ZS0+
YWN0aXZlX3BsYW5lcyAmIEJJVChwbGFuZS0+aWQpIHx8Ci0JCShJTlRFTF9HRU4oZGV2X3ByaXYp
IDwgOSAmJgorCQkoSU5URUxfR0VOKGk5MTUpIDwgOSAmJgogCQkgcGxhbmUtPmlkID09IFBMQU5F
X1BSSU1BUlkpOwogfQogCkBAIC05MDYsNyArOTA2LDcgQEAgc3RhdGljIGludAogaW50ZWxfY29s
b3JfYWRkX2FmZmVjdGVkX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNf
c3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19j
cnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUgPQogCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3RhdGUtPmJhc2Uu
c3RhdGUpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9
CkBAIC05MjEsNyArOTIxLDcgQEAgaW50ZWxfY29sb3JfYWRkX2FmZmVjdGVkX3BsYW5lcyhzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJICAgIG5ld19jcnRjX3N0YXRl
LT5jc2NfZW5hYmxlID09IG9sZF9jcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQogCQlyZXR1cm4gMDsK
IAotCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMsIHBs
YW5lKSB7CisJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmaTkxNS0+ZHJtLCBjcnRjLCBw
bGFuZSkgewogCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOwogCiAJCWlm
ICghbmVlZF9wbGFuZV91cGRhdGUocGxhbmUsIG5ld19jcnRjX3N0YXRlKSkKQEAgLTk1Niw3ICs5
NTYsNyBAQCBzdGF0aWMgaW50IGNoZWNrX2x1dF9zaXplKGNvbnN0IHN0cnVjdCBkcm1fcHJvcGVy
dHlfYmxvYiAqbHV0LCBpbnQgZXhwZWN0ZWQpCiAKIHN0YXRpYyBpbnQgY2hlY2tfbHV0cyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2FtbWFf
bHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CiAJY29uc3Qgc3RydWN0IGRybV9wcm9w
ZXJ0eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQ7CiAJ
aW50IGdhbW1hX2xlbmd0aCwgZGVnYW1tYV9sZW5ndGg7CkBAIC05NzIsMTAgKzk3MiwxMCBAQCBz
dGF0aWMgaW50IGNoZWNrX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCWRlZ2FtbWFfbGVuZ3RoID0gSU5URUxf
SU5GTyhkZXZfcHJpdiktPmNvbG9yLmRlZ2FtbWFfbHV0X3NpemU7Ci0JZ2FtbWFfbGVuZ3RoID0g
SU5URUxfSU5GTyhkZXZfcHJpdiktPmNvbG9yLmdhbW1hX2x1dF9zaXplOwotCWRlZ2FtbWFfdGVz
dHMgPSBJTlRFTF9JTkZPKGRldl9wcml2KS0+Y29sb3IuZGVnYW1tYV9sdXRfdGVzdHM7Ci0JZ2Ft
bWFfdGVzdHMgPSBJTlRFTF9JTkZPKGRldl9wcml2KS0+Y29sb3IuZ2FtbWFfbHV0X3Rlc3RzOwor
CWRlZ2FtbWFfbGVuZ3RoID0gSU5URUxfSU5GTyhpOTE1KS0+Y29sb3IuZGVnYW1tYV9sdXRfc2l6
ZTsKKwlnYW1tYV9sZW5ndGggPSBJTlRFTF9JTkZPKGk5MTUpLT5jb2xvci5nYW1tYV9sdXRfc2l6
ZTsKKwlkZWdhbW1hX3Rlc3RzID0gSU5URUxfSU5GTyhpOTE1KS0+Y29sb3IuZGVnYW1tYV9sdXRf
dGVzdHM7CisJZ2FtbWFfdGVzdHMgPSBJTlRFTF9JTkZPKGk5MTUpLT5jb2xvci5nYW1tYV9sdXRf
dGVzdHM7CiAKIAlpZiAoY2hlY2tfbHV0X3NpemUoZGVnYW1tYV9sdXQsIGRlZ2FtbWFfbGVuZ3Ro
KSB8fAogCSAgICBjaGVja19sdXRfc2l6ZShnYW1tYV9sdXQsIGdhbW1hX2xlbmd0aCkpCkBAIC0x
MjU1LDU2ICsxMjU1LDU2IEBAIHN0YXRpYyBpbnQgaWNsX2NvbG9yX2NoZWNrKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiB2b2lkIGludGVsX2NvbG9yX2luaXQoc3RydWN0
IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JYm9vbCBoYXNfY3RtID0gSU5URUxfSU5GTyhk
ZXZfcHJpdiktPmNvbG9yLmRlZ2FtbWFfbHV0X3NpemUgIT0gMDsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCWJvb2wgaGFzX2N0bSA9
IElOVEVMX0lORk8oaTkxNSktPmNvbG9yLmRlZ2FtbWFfbHV0X3NpemUgIT0gMDsKIAogCWRybV9t
b2RlX2NydGNfc2V0X2dhbW1hX3NpemUoJmNydGMtPmJhc2UsIDI1Nik7CiAKLQlpZiAoSEFTX0dN
Q0goZGV2X3ByaXYpKSB7Ci0JCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgewotCQkJZGV2
X3ByaXYtPmRpc3BsYXkuY29sb3JfY2hlY2sgPSBjaHZfY29sb3JfY2hlY2s7Ci0JCQlkZXZfcHJp
di0+ZGlzcGxheS5jb2xvcl9jb21taXQgPSBpOXh4X2NvbG9yX2NvbW1pdDsKLQkJCWRldl9wcml2
LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGNodl9sb2FkX2x1dHM7Ci0JCX0gZWxzZSBpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA0KSB7Ci0JCQlkZXZfcHJpdi0+ZGlzcGxheS5jb2xvcl9jaGVjayA9
IGk5eHhfY29sb3JfY2hlY2s7Ci0JCQlkZXZfcHJpdi0+ZGlzcGxheS5jb2xvcl9jb21taXQgPSBp
OXh4X2NvbG9yX2NvbW1pdDsKLQkJCWRldl9wcml2LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGk5NjVf
bG9hZF9sdXRzOworCWlmIChIQVNfR01DSChpOTE1KSkgeworCQlpZiAoSVNfQ0hFUlJZVklFVyhp
OTE1KSkgeworCQkJaTkxNS0+ZGlzcGxheS5jb2xvcl9jaGVjayA9IGNodl9jb2xvcl9jaGVjazsK
KwkJCWk5MTUtPmRpc3BsYXkuY29sb3JfY29tbWl0ID0gaTl4eF9jb2xvcl9jb21taXQ7CisJCQlp
OTE1LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGNodl9sb2FkX2x1dHM7CisJCX0gZWxzZSBpZiAoSU5U
RUxfR0VOKGk5MTUpID49IDQpIHsKKwkJCWk5MTUtPmRpc3BsYXkuY29sb3JfY2hlY2sgPSBpOXh4
X2NvbG9yX2NoZWNrOworCQkJaTkxNS0+ZGlzcGxheS5jb2xvcl9jb21taXQgPSBpOXh4X2NvbG9y
X2NvbW1pdDsKKwkJCWk5MTUtPmRpc3BsYXkubG9hZF9sdXRzID0gaTk2NV9sb2FkX2x1dHM7CiAJ
CX0gZWxzZSB7Ci0JCQlkZXZfcHJpdi0+ZGlzcGxheS5jb2xvcl9jaGVjayA9IGk5eHhfY29sb3Jf
Y2hlY2s7Ci0JCQlkZXZfcHJpdi0+ZGlzcGxheS5jb2xvcl9jb21taXQgPSBpOXh4X2NvbG9yX2Nv
bW1pdDsKLQkJCWRldl9wcml2LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGk5eHhfbG9hZF9sdXRzOwor
CQkJaTkxNS0+ZGlzcGxheS5jb2xvcl9jaGVjayA9IGk5eHhfY29sb3JfY2hlY2s7CisJCQlpOTE1
LT5kaXNwbGF5LmNvbG9yX2NvbW1pdCA9IGk5eHhfY29sb3JfY29tbWl0OworCQkJaTkxNS0+ZGlz
cGxheS5sb2FkX2x1dHMgPSBpOXh4X2xvYWRfbHV0czsKIAkJfQogCX0gZWxzZSB7Ci0JCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQkJZGV2X3ByaXYtPmRpc3BsYXkuY29sb3JfY2hl
Y2sgPSBpY2xfY29sb3JfY2hlY2s7Ci0JCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCi0JCQlkZXZfcHJpdi0+ZGlzcGxheS5jb2xv
cl9jaGVjayA9IGdsa19jb2xvcl9jaGVjazsKLQkJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA3KQotCQkJZGV2X3ByaXYtPmRpc3BsYXkuY29sb3JfY2hlY2sgPSBpdmJfY29sb3JfY2hl
Y2s7CisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCisJCQlpOTE1LT5kaXNwbGF5LmNvbG9y
X2NoZWNrID0gaWNsX2NvbG9yX2NoZWNrOworCQllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0g
MTAgfHwgSVNfR0VNSU5JTEFLRShpOTE1KSkKKwkJCWk5MTUtPmRpc3BsYXkuY29sb3JfY2hlY2sg
PSBnbGtfY29sb3JfY2hlY2s7CisJCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA3KQorCQkJ
aTkxNS0+ZGlzcGxheS5jb2xvcl9jaGVjayA9IGl2Yl9jb2xvcl9jaGVjazsKIAkJZWxzZQotCQkJ
ZGV2X3ByaXYtPmRpc3BsYXkuY29sb3JfY2hlY2sgPSBpbGtfY29sb3JfY2hlY2s7CisJCQlpOTE1
LT5kaXNwbGF5LmNvbG9yX2NoZWNrID0gaWxrX2NvbG9yX2NoZWNrOwogCi0JCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDkpCi0JCQlkZXZfcHJpdi0+ZGlzcGxheS5jb2xvcl9jb21taXQgPSBz
a2xfY29sb3JfY29tbWl0OwotCQllbHNlIGlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpIHx8IElT
X0hBU1dFTEwoZGV2X3ByaXYpKQotCQkJZGV2X3ByaXYtPmRpc3BsYXkuY29sb3JfY29tbWl0ID0g
aHN3X2NvbG9yX2NvbW1pdDsKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQorCQkJaTkxNS0+
ZGlzcGxheS5jb2xvcl9jb21taXQgPSBza2xfY29sb3JfY29tbWl0OworCQllbHNlIGlmIChJU19C
Uk9BRFdFTEwoaTkxNSkgfHwgSVNfSEFTV0VMTChpOTE1KSkKKwkJCWk5MTUtPmRpc3BsYXkuY29s
b3JfY29tbWl0ID0gaHN3X2NvbG9yX2NvbW1pdDsKIAkJZWxzZQotCQkJZGV2X3ByaXYtPmRpc3Bs
YXkuY29sb3JfY29tbWl0ID0gaWxrX2NvbG9yX2NvbW1pdDsKLQotCQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMSkKLQkJCWRldl9wcml2LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGljbF9sb2Fk
X2x1dHM7Ci0JCWVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpIHx8IElTX0dFTUlOSUxB
S0UoZGV2X3ByaXYpKQotCQkJZGV2X3ByaXYtPmRpc3BsYXkubG9hZF9sdXRzID0gZ2xrX2xvYWRf
bHV0czsKLQkJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KQotCQkJZGV2X3ByaXYt
PmRpc3BsYXkubG9hZF9sdXRzID0gYmR3X2xvYWRfbHV0czsKLQkJZWxzZSBpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA3KQotCQkJZGV2X3ByaXYtPmRpc3BsYXkubG9hZF9sdXRzID0gaXZiX2xv
YWRfbHV0czsKKwkJCWk5MTUtPmRpc3BsYXkuY29sb3JfY29tbWl0ID0gaWxrX2NvbG9yX2NvbW1p
dDsKKworCQlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQorCQkJaTkxNS0+ZGlzcGxheS5sb2Fk
X2x1dHMgPSBpY2xfbG9hZF9sdXRzOworCQllbHNlIGlmIChJU19DQU5OT05MQUtFKGk5MTUpIHx8
IElTX0dFTUlOSUxBS0UoaTkxNSkpCisJCQlpOTE1LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGdsa19s
b2FkX2x1dHM7CisJCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KQorCQkJaTkxNS0+ZGlz
cGxheS5sb2FkX2x1dHMgPSBiZHdfbG9hZF9sdXRzOworCQllbHNlIGlmIChJTlRFTF9HRU4oaTkx
NSkgPj0gNykKKwkJCWk5MTUtPmRpc3BsYXkubG9hZF9sdXRzID0gaXZiX2xvYWRfbHV0czsKIAkJ
ZWxzZQotCQkJZGV2X3ByaXYtPmRpc3BsYXkubG9hZF9sdXRzID0gaWxrX2xvYWRfbHV0czsKKwkJ
CWk5MTUtPmRpc3BsYXkubG9hZF9sdXRzID0gaWxrX2xvYWRfbHV0czsKIAl9CiAKIAlkcm1fY3J0
Y19lbmFibGVfY29sb3JfbWdtdCgmY3J0Yy0+YmFzZSwKLQkJCQkgICBJTlRFTF9JTkZPKGRldl9w
cml2KS0+Y29sb3IuZGVnYW1tYV9sdXRfc2l6ZSwKKwkJCQkgICBJTlRFTF9JTkZPKGk5MTUpLT5j
b2xvci5kZWdhbW1hX2x1dF9zaXplLAogCQkJCSAgIGhhc19jdG0sCi0JCQkJICAgSU5URUxfSU5G
TyhkZXZfcHJpdiktPmNvbG9yLmdhbW1hX2x1dF9zaXplKTsKKwkJCQkgICBJTlRFTF9JTkZPKGk5
MTUpLT5jb2xvci5nYW1tYV9sdXRfc2l6ZSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9jb21ib19waHkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Nv
bWJvX3BoeS5jCmluZGV4IDg0MTcwOGRhNWE1Ni4uMGU3YzE4ZDc4M2NhIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jb21ib19waHkuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9jb21ib19waHkuYwpAQCAtNDQsNyArNDQsNyBAQCBzdGF0aWMgY29uc3Qg
c3RydWN0IGNubF9wcm9jbW9uIHsKICAqIG9uIGl0cyBuYW1lLgogICovCiBzdGF0aWMgY29uc3Qg
c3RydWN0IGNubF9wcm9jbW9uICoKLWNubF9nZXRfcHJvY21vbl9yZWZfdmFsdWVzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCitjbmxfZ2V0X3Byb2Nt
b25fcmVmX3ZhbHVlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwb3J0IHBv
cnQpCiB7CiAJY29uc3Qgc3RydWN0IGNubF9wcm9jbW9uICpwcm9jbW9uOwogCXUzMiB2YWw7CkBA
IC03NCwxMyArNzQsMTMgQEAgY25sX2dldF9wcm9jbW9uX3JlZl92YWx1ZXMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKIAlyZXR1cm4gcHJvY21vbjsK
IH0KIAotc3RhdGljIHZvaWQgY25sX3NldF9wcm9jbW9uX3JlZl92YWx1ZXMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgY25sX3NldF9wcm9jbW9uX3JlZl92
YWx1ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgIGVudW0gcG9y
dCBwb3J0KQogewogCWNvbnN0IHN0cnVjdCBjbmxfcHJvY21vbiAqcHJvY21vbjsKIAl1MzIgdmFs
OwogCi0JcHJvY21vbiA9IGNubF9nZXRfcHJvY21vbl9yZWZfdmFsdWVzKGRldl9wcml2LCBwb3J0
KTsKKwlwcm9jbW9uID0gY25sX2dldF9wcm9jbW9uX3JlZl92YWx1ZXMoaTkxNSwgcG9ydCk7CiAK
IAl2YWwgPSBJOTE1X1JFQUQoSUNMX1BPUlRfQ09NUF9EVzEocG9ydCkpOwogCXZhbCAmPSB+KCgw
eGZmIDw8IDE2KSB8IDB4ZmYpOwpAQCAtOTEsNyArOTEsNyBAQCBzdGF0aWMgdm9pZCBjbmxfc2V0
X3Byb2Ntb25fcmVmX3ZhbHVlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
STkxNV9XUklURShJQ0xfUE9SVF9DT01QX0RXMTAocG9ydCksIHByb2Ntb24tPmR3MTApOwogfQog
Ci1zdGF0aWMgYm9vbCBjaGVja19waHlfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyBib29sIGNoZWNrX3BoeV9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkgIGVudW0gcG9ydCBwb3J0LCBpOTE1X3JlZ190IHJlZywgdTMyIG1hc2ssCiAJ
CQkgIHUzMiBleHBlY3RlZF92YWwpCiB7CkBAIC0xMDgsNDcgKzEwOCw0NyBAQCBzdGF0aWMgYm9v
bCBjaGVja19waHlfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1
cm4gdHJ1ZTsKIH0KIAotc3RhdGljIGJvb2wgY25sX3ZlcmlmeV9wcm9jbW9uX3JlZl92YWx1ZXMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgY25sX3Zlcmlm
eV9wcm9jbW9uX3JlZl92YWx1ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJ
CSAgZW51bSBwb3J0IHBvcnQpCiB7CiAJY29uc3Qgc3RydWN0IGNubF9wcm9jbW9uICpwcm9jbW9u
OwogCWJvb2wgcmV0OwogCi0JcHJvY21vbiA9IGNubF9nZXRfcHJvY21vbl9yZWZfdmFsdWVzKGRl
dl9wcml2LCBwb3J0KTsKKwlwcm9jbW9uID0gY25sX2dldF9wcm9jbW9uX3JlZl92YWx1ZXMoaTkx
NSwgcG9ydCk7CiAKLQlyZXQgPSBjaGVja19waHlfcmVnKGRldl9wcml2LCBwb3J0LCBJQ0xfUE9S
VF9DT01QX0RXMShwb3J0KSwKKwlyZXQgPSBjaGVja19waHlfcmVnKGk5MTUsIHBvcnQsIElDTF9Q
T1JUX0NPTVBfRFcxKHBvcnQpLAogCQkJICAgICgweGZmIDw8IDE2KSB8IDB4ZmYsIHByb2Ntb24t
PmR3MSk7Ci0JcmV0ICY9IGNoZWNrX3BoeV9yZWcoZGV2X3ByaXYsIHBvcnQsIElDTF9QT1JUX0NP
TVBfRFc5KHBvcnQpLAorCXJldCAmPSBjaGVja19waHlfcmVnKGk5MTUsIHBvcnQsIElDTF9QT1JU
X0NPTVBfRFc5KHBvcnQpLAogCQkJICAgICAtMVUsIHByb2Ntb24tPmR3OSk7Ci0JcmV0ICY9IGNo
ZWNrX3BoeV9yZWcoZGV2X3ByaXYsIHBvcnQsIElDTF9QT1JUX0NPTVBfRFcxMChwb3J0KSwKKwly
ZXQgJj0gY2hlY2tfcGh5X3JlZyhpOTE1LCBwb3J0LCBJQ0xfUE9SVF9DT01QX0RXMTAocG9ydCks
CiAJCQkgICAgIC0xVSwgcHJvY21vbi0+ZHcxMCk7CiAKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0
aWMgYm9vbCBjbmxfY29tYm9fcGh5X2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIGJvb2wgY25sX2NvbWJvX3BoeV9lbmFibGVkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCXJldHVybiAhKEk5MTVfUkVBRChDSElDS0VOX01JU0NfMikg
JiBDTkxfQ09NUF9QV1JfRE9XTikgJiYKIAkJKEk5MTVfUkVBRChDTkxfUE9SVF9DT01QX0RXMCkg
JiBDT01QX0lOSVQpOwogfQogCi1zdGF0aWMgYm9vbCBjbmxfY29tYm9fcGh5X3ZlcmlmeV9zdGF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBjbmxfY29t
Ym9fcGh5X3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAll
bnVtIHBvcnQgcG9ydCA9IFBPUlRfQTsKIAlib29sIHJldDsKIAotCWlmICghY25sX2NvbWJvX3Bo
eV9lbmFibGVkKGRldl9wcml2KSkKKwlpZiAoIWNubF9jb21ib19waHlfZW5hYmxlZChpOTE1KSkK
IAkJcmV0dXJuIGZhbHNlOwogCi0JcmV0ID0gY25sX3ZlcmlmeV9wcm9jbW9uX3JlZl92YWx1ZXMo
ZGV2X3ByaXYsIHBvcnQpOworCXJldCA9IGNubF92ZXJpZnlfcHJvY21vbl9yZWZfdmFsdWVzKGk5
MTUsIHBvcnQpOwogCi0JcmV0ICY9IGNoZWNrX3BoeV9yZWcoZGV2X3ByaXYsIHBvcnQsIENOTF9Q
T1JUX0NMMUNNX0RXNSwKKwlyZXQgJj0gY2hlY2tfcGh5X3JlZyhpOTE1LCBwb3J0LCBDTkxfUE9S
VF9DTDFDTV9EVzUsCiAJCQkgICAgIENMX1BPV0VSX0RPV05fRU5BQkxFLCBDTF9QT1dFUl9ET1dO
X0VOQUJMRSk7CiAKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9pZCBjbmxfY29tYm9fcGh5
c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGNu
bF9jb21ib19waHlzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMy
IHZhbDsKIApAQCAtMTU3LDcgKzE1Nyw3IEBAIHN0YXRpYyB2b2lkIGNubF9jb21ib19waHlzX2lu
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJVEUoQ0hJQ0tF
Tl9NSVNDXzIsIHZhbCk7CiAKIAkvKiBEdW1teSBQT1JUX0EgdG8gZ2V0IHRoZSBjb3JyZWN0IENO
TCByZWdpc3RlciBmcm9tIHRoZSBJQ0wgbWFjcm8gKi8KLQljbmxfc2V0X3Byb2Ntb25fcmVmX3Zh
bHVlcyhkZXZfcHJpdiwgUE9SVF9BKTsKKwljbmxfc2V0X3Byb2Ntb25fcmVmX3ZhbHVlcyhpOTE1
LCBQT1JUX0EpOwogCiAJdmFsID0gSTkxNV9SRUFEKENOTF9QT1JUX0NPTVBfRFcwKTsKIAl2YWwg
fD0gQ09NUF9JTklUOwpAQCAtMTY4LDExICsxNjgsMTEgQEAgc3RhdGljIHZvaWQgY25sX2NvbWJv
X3BoeXNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklU
RShDTkxfUE9SVF9DTDFDTV9EVzUsIHZhbCk7CiB9CiAKLXN0YXRpYyB2b2lkIGNubF9jb21ib19w
aHlzX3VuaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCBjbmxfY29tYm9fcGh5c191bmluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
CiAJdTMyIHZhbDsKIAotCWlmICghY25sX2NvbWJvX3BoeV92ZXJpZnlfc3RhdGUoZGV2X3ByaXYp
KQorCWlmICghY25sX2NvbWJvX3BoeV92ZXJpZnlfc3RhdGUoaTkxNSkpCiAJCURSTV9XQVJOKCJD
b21ibyBQSFkgSFcgc3RhdGUgY2hhbmdlZCB1bmV4cGVjdGVkbHkuXG4iKTsKIAogCXZhbCA9IEk5
MTVfUkVBRChDSElDS0VOX01JU0NfMik7CkBAIC0xODAsNyArMTgwLDcgQEAgc3RhdGljIHZvaWQg
Y25sX2NvbWJvX3BoeXNfdW5pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAlJOTE1X1dSSVRFKENISUNLRU5fTUlTQ18yLCB2YWwpOwogfQogCi1zdGF0aWMgYm9vbCBpY2xf
Y29tYm9fcGh5X2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIGJvb2wgaWNsX2NvbWJvX3BoeV9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCSAgZW51bSBwb3J0IHBvcnQpCiB7CiAJcmV0dXJuICEoSTkxNV9SRUFEKElDTF9Q
SFlfTUlTQyhwb3J0KSkgJgpAQCAtMTg4LDI3ICsxODgsMjcgQEAgc3RhdGljIGJvb2wgaWNsX2Nv
bWJvX3BoeV9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJKEk5
MTVfUkVBRChJQ0xfUE9SVF9DT01QX0RXMChwb3J0KSkgJiBDT01QX0lOSVQpOwogfQogCi1zdGF0
aWMgYm9vbCBpY2xfY29tYm9fcGh5X3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBpY2xfY29tYm9fcGh5X3ZlcmlmeV9zdGF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICAgZW51bSBwb3J0IHBvcnQpCiB7
CiAJYm9vbCByZXQ7CiAKLQlpZiAoIWljbF9jb21ib19waHlfZW5hYmxlZChkZXZfcHJpdiwgcG9y
dCkpCisJaWYgKCFpY2xfY29tYm9fcGh5X2VuYWJsZWQoaTkxNSwgcG9ydCkpCiAJCXJldHVybiBm
YWxzZTsKIAotCXJldCA9IGNubF92ZXJpZnlfcHJvY21vbl9yZWZfdmFsdWVzKGRldl9wcml2LCBw
b3J0KTsKKwlyZXQgPSBjbmxfdmVyaWZ5X3Byb2Ntb25fcmVmX3ZhbHVlcyhpOTE1LCBwb3J0KTsK
IAogCWlmIChwb3J0ID09IFBPUlRfQSkKLQkJcmV0ICY9IGNoZWNrX3BoeV9yZWcoZGV2X3ByaXYs
IHBvcnQsIElDTF9QT1JUX0NPTVBfRFc4KHBvcnQpLAorCQlyZXQgJj0gY2hlY2tfcGh5X3JlZyhp
OTE1LCBwb3J0LCBJQ0xfUE9SVF9DT01QX0RXOChwb3J0KSwKIAkJCQkgICAgIElSRUZHRU4sIElS
RUZHRU4pOwogCi0JcmV0ICY9IGNoZWNrX3BoeV9yZWcoZGV2X3ByaXYsIHBvcnQsIElDTF9QT1JU
X0NMX0RXNShwb3J0KSwKKwlyZXQgJj0gY2hlY2tfcGh5X3JlZyhpOTE1LCBwb3J0LCBJQ0xfUE9S
VF9DTF9EVzUocG9ydCksCiAJCQkgICAgIENMX1BPV0VSX0RPV05fRU5BQkxFLCBDTF9QT1dFUl9E
T1dOX0VOQUJMRSk7CiAKIAlyZXR1cm4gcmV0OwogfQogCi12b2lkIGludGVsX2NvbWJvX3BoeV9w
b3dlcl91cF9sYW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGlu
dGVsX2NvbWJvX3BoeV9wb3dlcl91cF9sYW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkgICAgZW51bSBwb3J0IHBvcnQsIGJvb2wgaXNfZHNpLAogCQkJCSAgICBpbnQgbGFu
ZV9jb3VudCwgYm9vbCBsYW5lX3JldmVyc2FsKQogewpAQCAtMjYwLDE0ICsyNjAsMTQgQEAgdm9p
ZCBpbnRlbF9jb21ib19waHlfcG93ZXJfdXBfbGFuZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCUk5MTVfV1JJVEUoSUNMX1BPUlRfQ0xfRFcxMChwb3J0KSwgdmFsKTsKIH0K
IAotc3RhdGljIHZvaWQgaWNsX2NvbWJvX3BoeXNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpY2xfY29tYm9fcGh5c19pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCWVudW0gcG9ydCBwb3J0OwogCi0JZm9yX2VhY2hfY29t
Ym9fcG9ydChkZXZfcHJpdiwgcG9ydCkgeworCWZvcl9lYWNoX2NvbWJvX3BvcnQoaTkxNSwgcG9y
dCkgewogCQl1MzIgdmFsOwogCi0JCWlmIChpY2xfY29tYm9fcGh5X3ZlcmlmeV9zdGF0ZShkZXZf
cHJpdiwgcG9ydCkpIHsKKwkJaWYgKGljbF9jb21ib19waHlfdmVyaWZ5X3N0YXRlKGk5MTUsIHBv
cnQpKSB7CiAJCQlEUk1fREVCVUdfRFJJVkVSKCJQb3J0ICVjIGNvbWJvIFBIWSBhbHJlYWR5IGVu
YWJsZWQsIHdvbid0IHJlcHJvZ3JhbSBpdC5cbiIsCiAJCQkJCSBwb3J0X25hbWUocG9ydCkpOwog
CQkJY29udGludWU7CkBAIC0yNzcsNyArMjc3LDcgQEAgc3RhdGljIHZvaWQgaWNsX2NvbWJvX3Bo
eXNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCXZhbCAmPSB+SUNM
X1BIWV9NSVNDX0RFX0lPX0NPTVBfUFdSX0RPV047CiAJCUk5MTVfV1JJVEUoSUNMX1BIWV9NSVND
KHBvcnQpLCB2YWwpOwogCi0JCWNubF9zZXRfcHJvY21vbl9yZWZfdmFsdWVzKGRldl9wcml2LCBw
b3J0KTsKKwkJY25sX3NldF9wcm9jbW9uX3JlZl92YWx1ZXMoaTkxNSwgcG9ydCk7CiAKIAkJaWYg
KHBvcnQgPT0gUE9SVF9BKSB7CiAJCQl2YWwgPSBJOTE1X1JFQUQoSUNMX1BPUlRfQ09NUF9EVzgo
cG9ydCkpOwpAQCAtMjk1LDE1ICsyOTUsMTUgQEAgc3RhdGljIHZvaWQgaWNsX2NvbWJvX3BoeXNf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMg
dm9pZCBpY2xfY29tYm9fcGh5c191bmluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIHZvaWQgaWNsX2NvbWJvX3BoeXNfdW5pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCWVudW0gcG9ydCBwb3J0OwogCi0JZm9yX2VhY2hfY29tYm9fcG9y
dF9yZXZlcnNlKGRldl9wcml2LCBwb3J0KSB7CisJZm9yX2VhY2hfY29tYm9fcG9ydF9yZXZlcnNl
KGk5MTUsIHBvcnQpIHsKIAkJdTMyIHZhbDsKIAogCQlpZiAocG9ydCA9PSBQT1JUX0EgJiYKLQkJ
ICAgICFpY2xfY29tYm9fcGh5X3ZlcmlmeV9zdGF0ZShkZXZfcHJpdiwgcG9ydCkpCisJCSAgICAh
aWNsX2NvbWJvX3BoeV92ZXJpZnlfc3RhdGUoaTkxNSwgcG9ydCkpCiAJCQlEUk1fV0FSTigiUG9y
dCAlYyBjb21ibyBQSFkgSFcgc3RhdGUgY2hhbmdlZCB1bmV4cGVjdGVkbHlcbiIsCiAJCQkJIHBv
cnRfbmFtZShwb3J0KSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2NvbWJvX3BoeS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfY29tYm9fcGh5LmgKaW5k
ZXggZTZlMTk1YTgzYjE5Li5hMDgyODZjZmNlY2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2NvbWJvX3BoeS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2NvbWJvX3BoeS5oCkBAIC0xMSw5ICsxMSw5IEBACiAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
OwogCi12b2lkIGludGVsX2NvbWJvX3BoeV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7Ci12b2lkIGludGVsX2NvbWJvX3BoeV91bmluaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfY29tYm9fcGh5X3Bvd2VyX3VwX2xhbmVzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfY29tYm9fcGh5X2lu
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpbnRlbF9jb21ib19waHlf
dW5pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfY29tYm9f
cGh5X3Bvd2VyX3VwX2xhbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAg
ICBlbnVtIHBvcnQgcG9ydCwgYm9vbCBpc19kc2ksCiAJCQkJICAgIGludCBsYW5lX2NvdW50LCBi
b29sIGxhbmVfcmV2ZXJzYWwpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9jb25uZWN0b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Nvbm5lY3Rvci5j
CmluZGV4IDA3M2I2YzNhYjdjYy4uMjkxMjgwNGQ1YTBkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9jb25uZWN0b3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9jb25uZWN0b3IuYwpAQCAtMjE5LDEwICsyMTksMTAgQEAgdm9pZAogaW50ZWxfYXR0YWNo
X2ZvcmNlX2F1ZGlvX3Byb3BlcnR5KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7
CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+ZGV2OwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX3Byb3BlcnR5ICpwcm9w
OwogCi0JcHJvcCA9IGRldl9wcml2LT5mb3JjZV9hdWRpb19wcm9wZXJ0eTsKKwlwcm9wID0gaTkx
NS0+Zm9yY2VfYXVkaW9fcHJvcGVydHk7CiAJaWYgKHByb3AgPT0gTlVMTCkgewogCQlwcm9wID0g
ZHJtX3Byb3BlcnR5X2NyZWF0ZV9lbnVtKGRldiwgMCwKIAkJCQkJICAgImF1ZGlvIiwKQEAgLTIz
MSw3ICsyMzEsNyBAQCBpbnRlbF9hdHRhY2hfZm9yY2VfYXVkaW9fcHJvcGVydHkoc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAkJaWYgKHByb3AgPT0gTlVMTCkKIAkJCXJldHVybjsK
IAotCQlkZXZfcHJpdi0+Zm9yY2VfYXVkaW9fcHJvcGVydHkgPSBwcm9wOworCQlpOTE1LT5mb3Jj
ZV9hdWRpb19wcm9wZXJ0eSA9IHByb3A7CiAJfQogCWRybV9vYmplY3RfYXR0YWNoX3Byb3BlcnR5
KCZjb25uZWN0b3ItPmJhc2UsIHByb3AsIDApOwogfQpAQCAtMjQ2LDEwICsyNDYsMTAgQEAgdm9p
ZAogaW50ZWxfYXR0YWNoX2Jyb2FkY2FzdF9yZ2JfcHJvcGVydHkoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY29ubmVjdG9yLT5k
ZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBk
cm1fcHJvcGVydHkgKnByb3A7CiAKLQlwcm9wID0gZGV2X3ByaXYtPmJyb2FkY2FzdF9yZ2JfcHJv
cGVydHk7CisJcHJvcCA9IGk5MTUtPmJyb2FkY2FzdF9yZ2JfcHJvcGVydHk7CiAJaWYgKHByb3Ag
PT0gTlVMTCkgewogCQlwcm9wID0gZHJtX3Byb3BlcnR5X2NyZWF0ZV9lbnVtKGRldiwgRFJNX01P
REVfUFJPUF9FTlVNLAogCQkJCQkgICAiQnJvYWRjYXN0IFJHQiIsCkBAIC0yNTgsNyArMjU4LDcg
QEAgaW50ZWxfYXR0YWNoX2Jyb2FkY2FzdF9yZ2JfcHJvcGVydHkoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIAkJaWYgKHByb3AgPT0gTlVMTCkKIAkJCXJldHVybjsKIAotCQlkZXZf
cHJpdi0+YnJvYWRjYXN0X3JnYl9wcm9wZXJ0eSA9IHByb3A7CisJCWk5MTUtPmJyb2FkY2FzdF9y
Z2JfcHJvcGVydHkgPSBwcm9wOwogCX0KIAogCWRybV9vYmplY3RfYXR0YWNoX3Byb3BlcnR5KCZj
b25uZWN0b3ItPmJhc2UsIHByb3AsIDApOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfY3J0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jcnQuYwppbmRleCAz
ZmNmMmY4NGJjY2UuLjJhNzk0ZTBiZjQ1NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfY3J0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfY3J0LmMKQEAg
LTcwLDcgKzcwLDcgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9jcnQgKmludGVsX2F0dGFjaGVkX2Ny
dChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCXJldHVybiBpbnRlbF9lbmNvZGVy
X3RvX2NydChpbnRlbF9hdHRhY2hlZF9lbmNvZGVyKGNvbm5lY3RvcikpOwogfQogCi1ib29sIGlu
dGVsX2NydF9wb3J0X2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
Ym9vbCBpbnRlbF9jcnRfcG9ydF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICAgIGk5MTVfcmVnX3QgYWRwYV9yZWcsIGVudW0gcGlwZSAqcGlwZSkKIHsKIAl1MzIg
dmFsOwpAQCAtNzgsNyArNzgsNyBAQCBib29sIGludGVsX2NydF9wb3J0X2VuYWJsZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXZhbCA9IEk5MTVfUkVBRChhZHBhX3JlZyk7
CiAKIAkvKiBhc3NlcnRzIHdhbnQgdG8ga25vdyB0aGUgcGlwZSBldmVuIGlmIHRoZSBwb3J0IGlz
IGRpc2FibGVkICovCi0JaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSkKKwlpZiAoSEFTX1BDSF9D
UFQoaTkxNSkpCiAJCSpwaXBlID0gKHZhbCAmIEFEUEFfUElQRV9TRUxfTUFTS19DUFQpID4+IEFE
UEFfUElQRV9TRUxfU0hJRlRfQ1BUOwogCWVsc2UKIAkJKnBpcGUgPSAodmFsICYgQURQQV9QSVBF
X1NFTF9NQVNLKSA+PiBBRFBBX1BJUEVfU0VMX1NISUZUOwpAQCAtODksMjYgKzg5LDI2IEBAIGJv
b2wgaW50ZWxfY3J0X3BvcnRfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiBzdGF0aWMgYm9vbCBpbnRlbF9jcnRfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJCSAgIGVudW0gcGlwZSAqcGlwZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CXN0cnVjdCBpbnRlbF9jcnQgKmNydCA9IGludGVsX2VuY29kZXJfdG9fY3J0KGVuY29kZXIpOwog
CWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWJvb2wgcmV0OwogCi0Jd2FrZXJlZiA9IGludGVs
X2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsCisJd2FrZXJlZiA9IGludGVs
X2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwKIAkJCQkJCSAgICAgZW5jb2Rlci0+
cG93ZXJfZG9tYWluKTsKIAlpZiAoIXdha2VyZWYpCiAJCXJldHVybiBmYWxzZTsKIAotCXJldCA9
IGludGVsX2NydF9wb3J0X2VuYWJsZWQoZGV2X3ByaXYsIGNydC0+YWRwYV9yZWcsIHBpcGUpOwor
CXJldCA9IGludGVsX2NydF9wb3J0X2VuYWJsZWQoaTkxNSwgY3J0LT5hZHBhX3JlZywgcGlwZSk7
CiAKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgZW5jb2Rlci0+cG93ZXJfZG9t
YWluLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBlbmNvZGVyLT5w
b3dlcl9kb21haW4sIHdha2VyZWYpOwogCiAJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIHVuc2ln
bmVkIGludCBpbnRlbF9jcnRfZ2V0X2ZsYWdzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2NydCAqY3J0ID0gaW50ZWxfZW5jb2Rl
cl90b19jcnQoZW5jb2Rlcik7CiAJdTMyIHRtcCwgZmxhZ3MgPSAwOwogCkBAIC0xNDAsNyArMTQw
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiBzdGF0aWMgdm9pZCBoc3dfY3J0X2dldF9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBp
cGVfY29uZmlnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAKIAlpbnRlbF9kZGlfZ2V0X2NvbmZpZyhlbmNv
ZGVyLCBwaXBlX2NvbmZpZyk7CiAKQEAgLTE1MCw3ICsxNTAsNyBAQCBzdGF0aWMgdm9pZCBoc3df
Y3J0X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCSAgICAg
IERSTV9NT0RFX0ZMQUdfTlZTWU5DKTsKIAlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
LmZsYWdzIHw9IGludGVsX2NydF9nZXRfZmxhZ3MoZW5jb2Rlcik7CiAKLQlwaXBlX2NvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBscHRfZ2V0X2ljbGtpcChkZXZfcHJpdik7
CisJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gbHB0X2dldF9p
Y2xraXAoaTkxNSk7CiB9CiAKIC8qIE5vdGU6IFRoZSBjYWxsZXIgaXMgcmVxdWlyZWQgdG8gZmls
dGVyIG91dCBkcG1zIG1vZGVzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlCkBAIC0xNTksMTMgKzE1OSwx
MyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRfc2V0X2RwbXMoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCQkgICAgICAgaW50IG1vZGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfY3J0ICpjcnQgPSBpbnRlbF9lbmNvZGVyX3RvX2NydChlbmNvZGVyKTsKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlj
b25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRl
LT5iYXNlLmFkanVzdGVkX21vZGU7CiAJdTMyIGFkcGE7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA1KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJYWRwYSA9IEFEUEFfSE9U
UExVR19CSVRTOwogCWVsc2UKIAkJYWRwYSA9IDA7CkBAIC0xNzYsMTQgKzE3NiwxNCBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9jcnRfc2V0X2RwbXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCWFkcGEgfD0gQURQQV9WU1lOQ19BQ1RJVkVfSElHSDsKIAogCS8qIEZvciBDUFQgYWxsb3cg
MyBwaXBlIGNvbmZpZywgZm9yIG90aGVycyBqdXN0IHVzZSBBIG9yIEIgKi8KLQlpZiAoSEFTX1BD
SF9MUFQoZGV2X3ByaXYpKQorCWlmIChIQVNfUENIX0xQVChpOTE1KSkKIAkJOyAvKiBUaG9zZSBi
aXRzIGRvbid0IGV4aXN0IGhlcmUgKi8KLQllbHNlIGlmIChIQVNfUENIX0NQVChkZXZfcHJpdikp
CisJZWxzZSBpZiAoSEFTX1BDSF9DUFQoaTkxNSkpCiAJCWFkcGEgfD0gQURQQV9QSVBFX1NFTF9D
UFQoY3J0Yy0+cGlwZSk7CiAJZWxzZQogCQlhZHBhIHw9IEFEUEFfUElQRV9TRUwoY3J0Yy0+cGlw
ZSk7CiAKLQlpZiAoIUhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKQorCWlmICghSEFTX1BDSF9TUExJ
VChpOTE1KSkKIAkJSTkxNV9XUklURShCQ0xSUEFUKGNydGMtPnBpcGUpLCAwKTsKIAogCXN3aXRj
aCAobW9kZSkgewpAQCAtMjI4LDU3ICsyMjgsNTcgQEAgc3RhdGljIHZvaWQgaHN3X2Rpc2FibGVf
Y3J0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCSAgICBjb25zdCBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAogCVdB
Uk5fT04oIW9sZF9jcnRjX3N0YXRlLT5oYXNfcGNoX2VuY29kZXIpOwogCi0JaW50ZWxfc2V0X3Bj
aF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgUElQRV9BLCBmYWxzZSk7CisJaW50
ZWxfc2V0X3BjaF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBQSVBFX0EsIGZhbHNlKTsK
IH0KIAogc3RhdGljIHZvaWQgaHN3X3Bvc3RfZGlzYWJsZV9jcnQoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0
Y19zdGF0ZSwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25u
X3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAKIAlpbnRlbF9kZGlfZGlzYWJsZV9waXBlX2Nsb2Nr
KG9sZF9jcnRjX3N0YXRlKTsKIAogCXBjaF9wb3N0X2Rpc2FibGVfY3J0KGVuY29kZXIsIG9sZF9j
cnRjX3N0YXRlLCBvbGRfY29ubl9zdGF0ZSk7CiAKLQlscHRfZGlzYWJsZV9wY2hfdHJhbnNjb2Rl
cihkZXZfcHJpdik7Ci0JbHB0X2Rpc2FibGVfaWNsa2lwKGRldl9wcml2KTsKKwlscHRfZGlzYWJs
ZV9wY2hfdHJhbnNjb2RlcihpOTE1KTsKKwlscHRfZGlzYWJsZV9pY2xraXAoaTkxNSk7CiAKIAlp
bnRlbF9kZGlfZmRpX3Bvc3RfZGlzYWJsZShlbmNvZGVyLCBvbGRfY3J0Y19zdGF0ZSwgb2xkX2Nv
bm5fc3RhdGUpOwogCiAJV0FSTl9PTighb2xkX2NydGNfc3RhdGUtPmhhc19wY2hfZW5jb2Rlcik7
CiAKLQlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBQSVBF
X0EsIHRydWUpOworCWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwg
UElQRV9BLCB0cnVlKTsKIH0KIAogc3RhdGljIHZvaWQgaHN3X3ByZV9wbGxfZW5hYmxlX2NydChz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCiAJV0FSTl9PTighY3J0Y19z
dGF0ZS0+aGFzX3BjaF9lbmNvZGVyKTsKIAotCWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9y
ZXBvcnRpbmcoZGV2X3ByaXYsIFBJUEVfQSwgZmFsc2UpOworCWludGVsX3NldF9wY2hfZmlmb191
bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgUElQRV9BLCBmYWxzZSk7CiB9CiAKIHN0YXRpYyB2b2lk
IGhzd19wcmVfZW5hYmxlX2NydChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAg
ICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCVdBUk5f
T04oIWNydGNfc3RhdGUtPmhhc19wY2hfZW5jb2Rlcik7CiAKLQlpbnRlbF9zZXRfY3B1X2ZpZm9f
dW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBwaXBlLCBmYWxzZSk7CisJaW50ZWxfc2V0X2Nw
dV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBwaXBlLCBmYWxzZSk7CiAKLQlkZXZfcHJp
di0+ZGlzcGxheS5mZGlfbGlua190cmFpbihjcnRjLCBjcnRjX3N0YXRlKTsKKwlpOTE1LT5kaXNw
bGF5LmZkaV9saW5rX3RyYWluKGNydGMsIGNydGNfc3RhdGUpOwogCiAJaW50ZWxfZGRpX2VuYWJs
ZV9waXBlX2Nsb2NrKGNydGNfc3RhdGUpOwogfQpAQCAtMjg3LDcgKzI4Nyw3IEBAIHN0YXRpYyB2
b2lkIGhzd19lbmFibGVfY3J0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICBjb25zdCBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNl
LmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIApAQCAtMjk1LDEwICsyOTUs
MTAgQEAgc3RhdGljIHZvaWQgaHN3X2VuYWJsZV9jcnQoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAKIAlpbnRlbF9jcnRfc2V0X2RwbXMoZW5jb2RlciwgY3J0Y19zdGF0ZSwgRFJNX01P
REVfRFBNU19PTik7CiAKLQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIHBpcGUpOwot
CWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgcGlwZSk7Ci0JaW50ZWxfc2V0X2NwdV9m
aWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgcGlwZSwgdHJ1ZSk7Ci0JaW50ZWxfc2V0
X3BjaF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgUElQRV9BLCB0cnVlKTsKKwlp
bnRlbF93YWl0X2Zvcl92YmxhbmsoaTkxNSwgcGlwZSk7CisJaW50ZWxfd2FpdF9mb3JfdmJsYW5r
KGk5MTUsIHBpcGUpOworCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkx
NSwgcGlwZSwgdHJ1ZSk7CisJaW50ZWxfc2V0X3BjaF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhp
OTE1LCBQSVBFX0EsIHRydWUpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9lbmFibGVfY3J0KHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMzEzLDggKzMxMyw4IEBAIGludGVsX2Ny
dF9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCSAgICAgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
IGNvbm5lY3Rvci0+ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKLQlpbnQgbWF4X2RvdGNsayA9IGRldl9wcml2LT5tYXhfZG90Y2xrX2ZyZXE7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJaW50IG1h
eF9kb3RjbGsgPSBpOTE1LT5tYXhfZG90Y2xrX2ZyZXE7CiAJaW50IG1heF9jbG9jazsKIAogCWlm
IChtb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfREJMU0NBTikKQEAgLTMyMywxNSArMzIzLDE1
IEBAIGludGVsX2NydF9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Is
CiAJaWYgKG1vZGUtPmNsb2NrIDwgMjUwMDApCiAJCXJldHVybiBNT0RFX0NMT0NLX0xPVzsKIAot
CWlmIChIQVNfUENIX0xQVChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfTFBUKGk5MTUpKQogCQlt
YXhfY2xvY2sgPSAxODAwMDA7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCisJ
ZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkKIAkJLyoKIAkJICogMjcwIE1IeiBkdWUgdG8g
Y3VycmVudCBEUExMIGxpbWl0cywKIAkJICogREFDIGxpbWl0IHN1cHBvc2VkbHkgMzU1IE1Iei4K
IAkJICovCiAJCW1heF9jbG9jayA9IDI3MDAwMDsKLQllbHNlIGlmIChJU19HRU5fUkFOR0UoZGV2
X3ByaXYsIDMsIDQpKQorCWVsc2UgaWYgKElTX0dFTl9SQU5HRShpOTE1LCAzLCA0KSkKIAkJbWF4
X2Nsb2NrID0gNDAwMDAwOwogCWVsc2UKIAkJbWF4X2Nsb2NrID0gMzUwMDAwOwpAQCAtMzQyLDcg
KzM0Miw3IEBAIGludGVsX2NydF9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3IsCiAJCXJldHVybiBNT0RFX0NMT0NLX0hJR0g7CiAKIAkvKiBUaGUgRkRJIHJlY2VpdmVy
IG9uIExQVCBvbmx5IHN1cHBvcnRzIDhicGMgYW5kIG9ubHkgaGFzIDIgbGFuZXMuICovCi0JaWYg
KEhBU19QQ0hfTFBUKGRldl9wcml2KSAmJgorCWlmIChIQVNfUENIX0xQVChpOTE1KSAmJgogCSAg
ICAoaXJvbmxha2VfZ2V0X2xhbmVzX3JlcXVpcmVkKG1vZGUtPmNsb2NrLCAyNzAwMDAsIDI0KSA+
IDIpKQogCQlyZXR1cm4gTU9ERV9DTE9DS19ISUdIOwogCkBAIC0zODgsNyArMzg4LDcgQEAgc3Rh
dGljIGludCBoc3dfY3J0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCSAg
c3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsK
IAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJCSZwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlOwogCkBAIC00MDQsNyArNDA0LDcgQEAgc3RhdGljIGludCBo
c3dfY3J0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXBp
cGVfY29uZmlnLT5vdXRwdXRfZm9ybWF0ID0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0I7CiAKIAkv
KiBMUFQgRkRJIFJYIG9ubHkgc3VwcG9ydHMgOGJwYy4gKi8KLQlpZiAoSEFTX1BDSF9MUFQoZGV2
X3ByaXYpKSB7CisJaWYgKEhBU19QQ0hfTFBUKGk5MTUpKSB7CiAJCWlmIChwaXBlX2NvbmZpZy0+
YndfY29uc3RyYWluZWQgJiYgcGlwZV9jb25maWctPnBpcGVfYnBwIDwgMjQpIHsKIAkJCURSTV9E
RUJVR19LTVMoIkxQVCBvbmx5IHN1cHBvcnRzIDI0YnBwXG4iKTsKIAkJCXJldHVybiAtRUlOVkFM
OwpAQCAtNDIzLDEzICs0MjMsMTMgQEAgc3RhdGljIGJvb2wgaW50ZWxfaXJvbmxha2VfY3J0X2Rl
dGVjdF9ob3RwbHVnKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+ZGV2OwogCXN0cnVjdCBpbnRlbF9jcnQgKmNy
dCA9IGludGVsX2F0dGFjaGVkX2NydChjb25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoZGV2KTsKIAl1MzIgYWRwYTsKIAlib29sIHJldDsKIAogCS8qIFRoZSBm
aXJzdCB0aW1lIHRocm91Z2gsIHRyaWdnZXIgYW4gZXhwbGljaXQgZGV0ZWN0aW9uIGN5Y2xlICov
CiAJaWYgKGNydC0+Zm9yY2VfaG90cGx1Z19yZXF1aXJlZCkgewotCQlib29sIHR1cm5fb2ZmX2Rh
YyA9IEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpOworCQlib29sIHR1cm5fb2ZmX2RhYyA9IEhBU19Q
Q0hfU1BMSVQoaTkxNSk7CiAJCXUzMiBzYXZlX2FkcGE7CiAKIAkJY3J0LT5mb3JjZV9ob3RwbHVn
X3JlcXVpcmVkID0gMDsKQEAgLTQ0Myw3ICs0NDMsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9pcm9u
bGFrZV9jcnRfZGV0ZWN0X2hvdHBsdWcoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikK
IAogCQlJOTE1X1dSSVRFKGNydC0+YWRwYV9yZWcsIGFkcGEpOwogCi0JCWlmIChpbnRlbF93YWl0
X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwkJaWYgKGludGVsX3dhaXRfZm9yX3Jl
Z2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJCSAgICBjcnQtPmFkcGFfcmVnLAogCQkJCQkgICAg
QURQQV9DUlRfSE9UUExVR19GT1JDRV9UUklHR0VSLCAwLAogCQkJCQkgICAgMTAwMCkpCkBAIC00
NzAsNyArNDcwLDcgQEAgc3RhdGljIGJvb2wgdmFsbGV5dmlld19jcnRfZGV0ZWN0X2hvdHBsdWco
c3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gY29ubmVjdG9yLT5kZXY7CiAJc3RydWN0IGludGVsX2NydCAqY3J0ID0gaW50ZWxfYXR0
YWNoZWRfY3J0KGNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShkZXYpOwogCWJvb2wgcmVlbmFibGVfaHBkOwogCXUzMiBhZHBhOwogCWJvb2wgcmV0OwpAQCAt
NDg4LDcgKzQ4OCw3IEBAIHN0YXRpYyBib29sIHZhbGxleXZpZXdfY3J0X2RldGVjdF9ob3RwbHVn
KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAJICoKIAkgKiBKdXN0IGRpc2FibGUg
SFBEIGludGVycnVwdHMgaGVyZSB0byBwcmV2ZW50IHRoaXMKIAkgKi8KLQlyZWVuYWJsZV9ocGQg
PSBpbnRlbF9ocGRfZGlzYWJsZShkZXZfcHJpdiwgY3J0LT5iYXNlLmhwZF9waW4pOworCXJlZW5h
YmxlX2hwZCA9IGludGVsX2hwZF9kaXNhYmxlKGk5MTUsIGNydC0+YmFzZS5ocGRfcGluKTsKIAog
CXNhdmVfYWRwYSA9IGFkcGEgPSBJOTE1X1JFQUQoY3J0LT5hZHBhX3JlZyk7CiAJRFJNX0RFQlVH
X0tNUygidHJpZ2dlciBob3RwbHVnIGRldGVjdCBjeWNsZTogYWRwYT0weCV4XG4iLCBhZHBhKTsK
QEAgLTQ5Nyw3ICs0OTcsNyBAQCBzdGF0aWMgYm9vbCB2YWxsZXl2aWV3X2NydF9kZXRlY3RfaG90
cGx1ZyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCiAJSTkxNV9XUklURShjcnQt
PmFkcGFfcmVnLCBhZHBhKTsKIAotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3By
aXYtPnVuY29yZSwKKwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwK
IAkJCQkgICAgY3J0LT5hZHBhX3JlZywKIAkJCQkgICAgQURQQV9DUlRfSE9UUExVR19GT1JDRV9U
UklHR0VSLCAwLAogCQkJCSAgICAxMDAwKSkgewpAQCAtNTE1LDcgKzUxNSw3IEBAIHN0YXRpYyBi
b29sIHZhbGxleXZpZXdfY3J0X2RldGVjdF9ob3RwbHVnKHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IpCiAJRFJNX0RFQlVHX0tNUygidmFsbGV5dmlldyBob3RwbHVnIGFkcGE9MHgleCwg
cmVzdWx0ICVkXG4iLCBhZHBhLCByZXQpOwogCiAJaWYgKHJlZW5hYmxlX2hwZCkKLQkJaW50ZWxf
aHBkX2VuYWJsZShkZXZfcHJpdiwgY3J0LT5iYXNlLmhwZF9waW4pOworCQlpbnRlbF9ocGRfZW5h
YmxlKGk5MTUsIGNydC0+YmFzZS5ocGRfcGluKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC01MjMs
MTUgKzUyMywxNSBAQCBzdGF0aWMgYm9vbCB2YWxsZXl2aWV3X2NydF9kZXRlY3RfaG90cGx1Zyhz
dHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogc3RhdGljIGJvb2wgaW50ZWxfY3J0X2Rl
dGVjdF9ob3RwbHVnKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoZGV2KTsKIAl1MzIgc3RhdDsKIAlib29sIHJldCA9IGZhbHNlOwogCWlu
dCBpLCB0cmllcyA9IDA7CiAKLQlpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpCisJaWYgKEhB
U19QQ0hfU1BMSVQoaTkxNSkpCiAJCXJldHVybiBpbnRlbF9pcm9ubGFrZV9jcnRfZGV0ZWN0X2hv
dHBsdWcoY29ubmVjdG9yKTsKIAotCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKKwlpZiAo
SVNfVkFMTEVZVklFVyhpOTE1KSkKIAkJcmV0dXJuIHZhbGxleXZpZXdfY3J0X2RldGVjdF9ob3Rw
bHVnKGNvbm5lY3Rvcik7CiAKIAkvKgpAQCAtNTM5LDE4ICs1MzksMTggQEAgc3RhdGljIGJvb2wg
aW50ZWxfY3J0X2RldGVjdF9ob3RwbHVnKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Ip
CiAJICogdG8gZ2V0IGEgcmVsaWFibGUgcmVzdWx0LgogCSAqLwogCi0JaWYgKElTX0c0NShkZXZf
cHJpdikpCisJaWYgKElTX0c0NShpOTE1KSkKIAkJdHJpZXMgPSAyOwogCWVsc2UKIAkJdHJpZXMg
PSAxOwogCiAJZm9yIChpID0gMDsgaSA8IHRyaWVzIDsgaSsrKSB7CiAJCS8qIHR1cm4gb24gdGhl
IEZPUkNFX0RFVEVDVCAqLwotCQlpOTE1X2hvdHBsdWdfaW50ZXJydXB0X3VwZGF0ZShkZXZfcHJp
diwKKwkJaTkxNV9ob3RwbHVnX2ludGVycnVwdF91cGRhdGUoaTkxNSwKIAkJCQkJICAgICAgQ1JU
X0hPVFBMVUdfRk9SQ0VfREVURUNULAogCQkJCQkgICAgICBDUlRfSE9UUExVR19GT1JDRV9ERVRF
Q1QpOwogCQkvKiB3YWl0IGZvciBGT1JDRV9ERVRFQ1QgdG8gZ28gb2ZmICovCi0JCWlmIChpbnRl
bF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgUE9SVF9IT1RQTFVHX0VOLAor
CQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwgUE9SVF9IT1RQTFVH
X0VOLAogCQkJCQkgICAgQ1JUX0hPVFBMVUdfRk9SQ0VfREVURUNULCAwLAogCQkJCQkgICAgMTAw
MCkpCiAJCQlEUk1fREVCVUdfS01TKCJ0aW1lZCBvdXQgd2FpdGluZyBmb3IgRk9SQ0VfREVURUNU
IHRvIGdvIG9mZiIpOwpAQCAtNTYzLDcgKzU2Myw3IEBAIHN0YXRpYyBib29sIGludGVsX2NydF9k
ZXRlY3RfaG90cGx1ZyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCS8qIGNsZWFy
IHRoZSBpbnRlcnJ1cHQgd2UganVzdCBnZW5lcmF0ZWQsIGlmIGFueSAqLwogCUk5MTVfV1JJVEUo
UE9SVF9IT1RQTFVHX1NUQVQsIENSVF9IT1RQTFVHX0lOVF9TVEFUVVMpOwogCi0JaTkxNV9ob3Rw
bHVnX2ludGVycnVwdF91cGRhdGUoZGV2X3ByaXYsIENSVF9IT1RQTFVHX0ZPUkNFX0RFVEVDVCwg
MCk7CisJaTkxNV9ob3RwbHVnX2ludGVycnVwdF91cGRhdGUoaTkxNSwgQ1JUX0hPVFBMVUdfRk9S
Q0VfREVURUNULCAwKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC02MDUsMTQgKzYwNSwxNCBAQCBz
dGF0aWMgaW50IGludGVsX2NydF9kZGNfZ2V0X21vZGVzKHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IsCiBzdGF0aWMgYm9vbCBpbnRlbF9jcnRfZGV0ZWN0X2RkYyhzdHJ1Y3QgZHJtX2Nv
bm5lY3RvciAqY29ubmVjdG9yKQogewogCXN0cnVjdCBpbnRlbF9jcnQgKmNydCA9IGludGVsX2F0
dGFjaGVkX2NydChjb25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3J0LT5iYXNlLmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0LT5iYXNlLmJhc2UuZGV2KTsKIAlzdHJ1Y3QgZWRpZCAqZWRp
ZDsKIAlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmkyYzsKIAlib29sIHJldCA9IGZhbHNlOwogCiAJQlVH
X09OKGNydC0+YmFzZS50eXBlICE9IElOVEVMX09VVFBVVF9BTkFMT0cpOwogCi0JaTJjID0gaW50
ZWxfZ21idXNfZ2V0X2FkYXB0ZXIoZGV2X3ByaXYsIGRldl9wcml2LT52YnQuY3J0X2RkY19waW4p
OworCWkyYyA9IGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGk5MTUsIGk5MTUtPnZidC5jcnRfZGRj
X3Bpbik7CiAJZWRpZCA9IGludGVsX2NydF9nZXRfZWRpZChjb25uZWN0b3IsIGkyYyk7CiAKIAlp
ZiAoZWRpZCkgewpAQCAtNjQyLDggKzY0Miw4IEBAIHN0YXRpYyBlbnVtIGRybV9jb25uZWN0b3Jf
c3RhdHVzCiBpbnRlbF9jcnRfbG9hZF9kZXRlY3Qoc3RydWN0IGludGVsX2NydCAqY3J0LCB1MzIg
cGlwZSkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0LT5iYXNlLmJhc2UuZGV2Owot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3Jl
ICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwogCXUzMiBzYXZlX2JjbHJwYXQ7CiAJdTMyIHNhdmVf
dnRvdGFsOwogCXUzMiB2dG90YWwsIHZhY3RpdmU7CkBAIC02NzcsNyArNjc3LDcgQEAgaW50ZWxf
Y3J0X2xvYWRfZGV0ZWN0KHN0cnVjdCBpbnRlbF9jcnQgKmNydCwgdTMyIHBpcGUpCiAJLyogU2V0
IHRoZSBib3JkZXIgY29sb3IgdG8gcHVycGxlLiAqLwogCWludGVsX3VuY29yZV93cml0ZSh1bmNv
cmUsIGJjbHJwYXRfcmVnLCAweDUwMDA1MCk7CiAKLQlpZiAoIUlTX0dFTihkZXZfcHJpdiwgMikp
IHsKKwlpZiAoIUlTX0dFTihpOTE1LCAyKSkgewogCQl1MzIgcGlwZWNvbmYgPSBpbnRlbF91bmNv
cmVfcmVhZCh1bmNvcmUsIHBpcGVjb25mX3JlZyk7CiAJCWludGVsX3VuY29yZV93cml0ZSh1bmNv
cmUsCiAJCQkJICAgcGlwZWNvbmZfcmVnLApAQCAtNjg1LDcgKzY4NSw3IEBAIGludGVsX2NydF9s
b2FkX2RldGVjdChzdHJ1Y3QgaW50ZWxfY3J0ICpjcnQsIHUzMiBwaXBlKQogCQlpbnRlbF91bmNv
cmVfcG9zdGluZ19yZWFkKHVuY29yZSwgcGlwZWNvbmZfcmVnKTsKIAkJLyogV2FpdCBmb3IgbmV4
dCBWYmxhbmsgdG8gc3Vic3RpdHVlCiAJCSAqIGJvcmRlciBjb2xvciBmb3IgQ29sb3IgaW5mbyAq
LwotCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIHBpcGUpOworCQlpbnRlbF93YWl0
X2Zvcl92YmxhbmsoaTkxNSwgcGlwZSk7CiAJCXN0MDAgPSBpbnRlbF91bmNvcmVfcmVhZDgodW5j
b3JlLCBfVkdBX01TUl9XUklURSk7CiAJCXN0YXR1cyA9ICgoc3QwMCAmICgxIDw8IDQpKSAhPSAw
KSA/CiAJCQljb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZCA6CkBAIC03ODksNyArNzg5LDcgQEAg
aW50ZWxfY3J0X2RldGVjdChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkgc3Ry
dWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4ICpjdHgsCiAJCSBib29sIGZvcmNlKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmRl
dik7CiAJc3RydWN0IGludGVsX2NydCAqY3J0ID0gaW50ZWxfYXR0YWNoZWRfY3J0KGNvbm5lY3Rv
cik7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIgPSAmY3J0LT5iYXNlOwog
CWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwpAQCAtODAxLDcgKzgwMSw3IEBAIGludGVsX2NydF9k
ZXRlY3Qoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJICAgICAgZm9yY2UpOwog
CiAJaWYgKGk5MTVfbW9kcGFyYW1zLmxvYWRfZGV0ZWN0X3Rlc3QpIHsKLQkJd2FrZXJlZiA9IGlu
dGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGRldl9wcml2LAorCQl3YWtlcmVmID0gaW50ZWxfZGlzcGxh
eV9wb3dlcl9nZXQoaTkxNSwKIAkJCQkJCSAgaW50ZWxfZW5jb2Rlci0+cG93ZXJfZG9tYWluKTsK
IAkJZ290byBsb2FkX2RldGVjdDsKIAl9CkBAIC04MTAsMTAgKzgxMCwxMCBAQCBpbnRlbF9jcnRf
ZGV0ZWN0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJaWYgKGRtaV9jaGVja19z
eXN0ZW0oaW50ZWxfc3B1cmlvdXNfY3J0X2RldGVjdCkpCiAJCXJldHVybiBjb25uZWN0b3Jfc3Rh
dHVzX2Rpc2Nvbm5lY3RlZDsKIAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChk
ZXZfcHJpdiwKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoaTkxNSwKIAkJCQkJ
ICBpbnRlbF9lbmNvZGVyLT5wb3dlcl9kb21haW4pOwogCi0JaWYgKEk5MTVfSEFTX0hPVFBMVUco
ZGV2X3ByaXYpKSB7CisJaWYgKEk5MTVfSEFTX0hPVFBMVUcoaTkxNSkpIHsKIAkJLyogV2UgY2Fu
IG5vdCByZWx5IG9uIHRoZSBIUEQgcGluIGFsd2F5cyBiZWluZyBjb3JyZWN0bHkgd2lyZWQKIAkJ
ICogdXAsIGZvciBleGFtcGxlIG1hbnkgS1ZNIGRvIG5vdCBwYXNzIGl0IHRocm91Z2gsIGFuZCBz
bwogCQkgKiBvbmx5IHRydXN0IGFuIGFzc2VydGlvbiB0aGF0IHRoZSBtb25pdG9yIGlzIGNvbm5l
Y3RlZC4KQEAgLTgzNSw3ICs4MzUsNyBAQCBpbnRlbF9jcnRfZGV0ZWN0KHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsCiAJICogYnJva2VuIG1vbml0b3IgKHdpdGhvdXQgZWRpZCkgdG8g
d29yayBiZWhpbmQgYSBicm9rZW4ga3ZtICh0aGF0IGZhaWxzCiAJICogdG8gaGF2ZSB0aGUgcmln
aHQgcmVzaXN0b3JzIGZvciBIUCBkZXRlY3Rpb24pIG5lZWRzIHRvIGZpeCB0aGlzIHVwLgogCSAq
IEZvciBub3cganVzdCBiYWlsIG91dC4gKi8KLQlpZiAoSTkxNV9IQVNfSE9UUExVRyhkZXZfcHJp
dikpIHsKKwlpZiAoSTkxNV9IQVNfSE9UUExVRyhpOTE1KSkgewogCQlzdGF0dXMgPSBjb25uZWN0
b3Jfc3RhdHVzX2Rpc2Nvbm5lY3RlZDsKIAkJZ290byBvdXQ7CiAJfQpAQCAtODUxLDcgKzg1MSw3
IEBAIGludGVsX2NydF9kZXRlY3Qoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAlp
ZiAocmV0ID4gMCkgewogCQlpZiAoaW50ZWxfY3J0X2RldGVjdF9kZGMoY29ubmVjdG9yKSkKIAkJ
CXN0YXR1cyA9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkOwotCQllbHNlIGlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpIDwgNCkKKwkJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpIDwgNCkKIAkJCXN0
YXR1cyA9IGludGVsX2NydF9sb2FkX2RldGVjdChjcnQsCiAJCQkJdG9faW50ZWxfY3J0Yyhjb25u
ZWN0b3ItPnN0YXRlLT5jcnRjKS0+cGlwZSk7CiAJCWVsc2UgaWYgKGk5MTVfbW9kcGFyYW1zLmxv
YWRfZGV0ZWN0X3Rlc3QpCkBAIC04NjYsNDQgKzg2Niw0NCBAQCBpbnRlbF9jcnRfZGV0ZWN0KHN0
cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJfQogCiBvdXQ6Ci0JaW50ZWxfZGlzcGxh
eV9wb3dlcl9wdXQoZGV2X3ByaXYsIGludGVsX2VuY29kZXItPnBvd2VyX2RvbWFpbiwgd2FrZXJl
Zik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgaW50ZWxfZW5jb2Rlci0+cG93ZXJf
ZG9tYWluLCB3YWtlcmVmKTsKIAlyZXR1cm4gc3RhdHVzOwogfQogCiBzdGF0aWMgaW50IGludGVs
X2NydF9nZXRfbW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gY29ubmVjdG9yLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnQgKmNydCA9IGludGVsX2F0
dGFjaGVkX2NydChjb25uZWN0b3IpOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNv
ZGVyID0gJmNydC0+YmFzZTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1Y3QgaTJj
X2FkYXB0ZXIgKmkyYzsKIAlpbnQgcmV0OwogCi0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93
ZXJfZ2V0KGRldl9wcml2LAorCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChpOTE1
LAogCQkJCQkgIGludGVsX2VuY29kZXItPnBvd2VyX2RvbWFpbik7CiAKLQlpMmMgPSBpbnRlbF9n
bWJ1c19nZXRfYWRhcHRlcihkZXZfcHJpdiwgZGV2X3ByaXYtPnZidC5jcnRfZGRjX3Bpbik7CisJ
aTJjID0gaW50ZWxfZ21idXNfZ2V0X2FkYXB0ZXIoaTkxNSwgaTkxNS0+dmJ0LmNydF9kZGNfcGlu
KTsKIAlyZXQgPSBpbnRlbF9jcnRfZGRjX2dldF9tb2Rlcyhjb25uZWN0b3IsIGkyYyk7Ci0JaWYg
KHJldCB8fCAhSVNfRzRYKGRldl9wcml2KSkKKwlpZiAocmV0IHx8ICFJU19HNFgoaTkxNSkpCiAJ
CWdvdG8gb3V0OwogCiAJLyogVHJ5IHRvIHByb2JlIGRpZ2l0YWwgcG9ydCBmb3Igb3V0cHV0IGlu
IERWSS1JIC0+IFZHQSBtb2RlLiAqLwotCWkyYyA9IGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGRl
dl9wcml2LCBHTUJVU19QSU5fRFBCKTsKKwlpMmMgPSBpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihp
OTE1LCBHTUJVU19QSU5fRFBCKTsKIAlyZXQgPSBpbnRlbF9jcnRfZGRjX2dldF9tb2Rlcyhjb25u
ZWN0b3IsIGkyYyk7CiAKIG91dDoKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwg
aW50ZWxfZW5jb2Rlci0+cG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bv
d2VyX3B1dChpOTE1LCBpbnRlbF9lbmNvZGVyLT5wb3dlcl9kb21haW4sIHdha2VyZWYpOwogCiAJ
cmV0dXJuIHJldDsKIH0KIAogdm9pZCBpbnRlbF9jcnRfcmVzZXQoc3RydWN0IGRybV9lbmNvZGVy
ICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZW5jb2Rlci0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZW5jb2Rlci0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0ICpjcnQgPSBpbnRlbF9lbmNvZGVy
X3RvX2NydCh0b19pbnRlbF9lbmNvZGVyKGVuY29kZXIpKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDUpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDUpIHsKIAkJdTMyIGFkcGE7
CiAKIAkJYWRwYSA9IEk5MTVfUkVBRChjcnQtPmFkcGFfcmVnKTsKQEAgLTk0Miw3ICs5NDIsNyBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9lbmNvZGVyX2Z1bmNzIGludGVsX2NydF9lbmNfZnVu
Y3MgPSB7CiAJLmRlc3Ryb3kgPSBpbnRlbF9lbmNvZGVyX2Rlc3Ryb3ksCiB9OwogCi12b2lkIGlu
dGVsX2NydF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50
ZWxfY3J0X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKIAlzdHJ1Y3QgaW50ZWxfY3J0ICpjcnQ7CkBAIC05NTAs
OSArOTUwLDkgQEAgdm9pZCBpbnRlbF9jcnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJaTkxNV9yZWdfdCBhZHBhX3JlZzsKIAl1MzIgYWRwYTsKIAotCWlmIChIQVNf
UENIX1NQTElUKGRldl9wcml2KSkKKwlpZiAoSEFTX1BDSF9TUExJVChpOTE1KSkKIAkJYWRwYV9y
ZWcgPSBQQ0hfQURQQTsKLQllbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKKwllbHNl
IGlmIChJU19WQUxMRVlWSUVXKGk5MTUpKQogCQlhZHBhX3JlZyA9IFZMVl9BRFBBOwogCWVsc2UK
IAkJYWRwYV9yZWcgPSBBRFBBOwpAQCAtOTg2LDIyICs5ODYsMjIgQEAgdm9pZCBpbnRlbF9jcnRf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAljb25uZWN0b3IgPSAm
aW50ZWxfY29ubmVjdG9yLT5iYXNlOwogCWNydC0+Y29ubmVjdG9yID0gaW50ZWxfY29ubmVjdG9y
OwotCWRybV9jb25uZWN0b3JfaW5pdCgmZGV2X3ByaXYtPmRybSwgJmludGVsX2Nvbm5lY3Rvci0+
YmFzZSwKKwlkcm1fY29ubmVjdG9yX2luaXQoJmk5MTUtPmRybSwgJmludGVsX2Nvbm5lY3Rvci0+
YmFzZSwKIAkJCSAgICZpbnRlbF9jcnRfY29ubmVjdG9yX2Z1bmNzLCBEUk1fTU9ERV9DT05ORUNU
T1JfVkdBKTsKIAotCWRybV9lbmNvZGVyX2luaXQoJmRldl9wcml2LT5kcm0sICZjcnQtPmJhc2Uu
YmFzZSwgJmludGVsX2NydF9lbmNfZnVuY3MsCisJZHJtX2VuY29kZXJfaW5pdCgmaTkxNS0+ZHJt
LCAmY3J0LT5iYXNlLmJhc2UsICZpbnRlbF9jcnRfZW5jX2Z1bmNzLAogCQkJIERSTV9NT0RFX0VO
Q09ERVJfREFDLCAiQ1JUIik7CiAKIAlpbnRlbF9jb25uZWN0b3JfYXR0YWNoX2VuY29kZXIoaW50
ZWxfY29ubmVjdG9yLCAmY3J0LT5iYXNlKTsKIAogCWNydC0+YmFzZS50eXBlID0gSU5URUxfT1VU
UFVUX0FOQUxPRzsKIAljcnQtPmJhc2UuY2xvbmVhYmxlID0gKDEgPDwgSU5URUxfT1VUUFVUX0RW
TykgfCAoMSA8PCBJTlRFTF9PVVRQVVRfSERNSSk7Ci0JaWYgKElTX0k4MzAoZGV2X3ByaXYpKQor
CWlmIChJU19JODMwKGk5MTUpKQogCQljcnQtPmJhc2UuY3J0Y19tYXNrID0gKDEgPDwgMCk7CiAJ
ZWxzZQogCQljcnQtPmJhc2UuY3J0Y19tYXNrID0gKDEgPDwgMCkgfCAoMSA8PCAxKSB8ICgxIDw8
IDIpOwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgMikpCisJaWYgKElTX0dFTihpOTE1LCAyKSkK
IAkJY29ubmVjdG9yLT5pbnRlcmxhY2VfYWxsb3dlZCA9IDA7CiAJZWxzZQogCQljb25uZWN0b3It
PmludGVybGFjZV9hbGxvd2VkID0gMTsKQEAgLTEwMTEsMTMgKzEwMTEsMTMgQEAgdm9pZCBpbnRl
bF9jcnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAljcnQtPmJh
c2UucG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlOX1BPUlRfQ1JUOwogCi0JaWYgKEk5MTVfSEFT
X0hPVFBMVUcoZGV2X3ByaXYpICYmCisJaWYgKEk5MTVfSEFTX0hPVFBMVUcoaTkxNSkgJiYKIAkg
ICAgIWRtaV9jaGVja19zeXN0ZW0oaW50ZWxfc3B1cmlvdXNfY3J0X2RldGVjdCkpIHsKIAkJY3J0
LT5iYXNlLmhwZF9waW4gPSBIUERfQ1JUOwogCQljcnQtPmJhc2UuaG90cGx1ZyA9IGludGVsX2Vu
Y29kZXJfaG90cGx1ZzsKIAl9CiAKLQlpZiAoSEFTX0RESShkZXZfcHJpdikpIHsKKwlpZiAoSEFT
X0RESShpOTE1KSkgewogCQljcnQtPmJhc2UucG9ydCA9IFBPUlRfRTsKIAkJY3J0LT5iYXNlLmdl
dF9jb25maWcgPSBoc3dfY3J0X2dldF9jb25maWc7CiAJCWNydC0+YmFzZS5nZXRfaHdfc3RhdGUg
PSBpbnRlbF9kZGlfZ2V0X2h3X3N0YXRlOwpAQCAtMTAyOCw3ICsxMDI4LDcgQEAgdm9pZCBpbnRl
bF9jcnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWNydC0+YmFz
ZS5kaXNhYmxlID0gaHN3X2Rpc2FibGVfY3J0OwogCQljcnQtPmJhc2UucG9zdF9kaXNhYmxlID0g
aHN3X3Bvc3RfZGlzYWJsZV9jcnQ7CiAJfSBlbHNlIHsKLQkJaWYgKEhBU19QQ0hfU1BMSVQoZGV2
X3ByaXYpKSB7CisJCWlmIChIQVNfUENIX1NQTElUKGk5MTUpKSB7CiAJCQljcnQtPmJhc2UuY29t
cHV0ZV9jb25maWcgPSBwY2hfY3J0X2NvbXB1dGVfY29uZmlnOwogCQkJY3J0LT5iYXNlLmRpc2Fi
bGUgPSBwY2hfZGlzYWJsZV9jcnQ7CiAJCQljcnQtPmJhc2UucG9zdF9kaXNhYmxlID0gcGNoX3Bv
c3RfZGlzYWJsZV9jcnQ7CkBAIC0xMDQ1LDcgKzEwNDUsNyBAQCB2b2lkIGludGVsX2NydF9pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWRybV9jb25uZWN0b3JfaGVs
cGVyX2FkZChjb25uZWN0b3IsICZpbnRlbF9jcnRfY29ubmVjdG9yX2hlbHBlcl9mdW5jcyk7CiAK
LQlpZiAoIUk5MTVfSEFTX0hPVFBMVUcoZGV2X3ByaXYpKQorCWlmICghSTkxNV9IQVNfSE9UUExV
RyhpOTE1KSkKIAkJaW50ZWxfY29ubmVjdG9yLT5wb2xsZWQgPSBEUk1fQ09OTkVDVE9SX1BPTExf
Q09OTkVDVDsKIAogCS8qCkBAIC0xMDU4LDExICsxMDU4LDExIEBAIHZvaWQgaW50ZWxfY3J0X2lu
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIHBvbGFyaXR5IGFuZCBs
aW5rIHJldmVyc2FsIGJpdHMgb3Igbm90LCBpbnN0ZWFkIG9mIHJlbHlpbmcgb24gdGhlCiAJICog
QklPUy4KIAkgKi8KLQlpZiAoSEFTX1BDSF9MUFQoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19QQ0hf
TFBUKGk5MTUpKSB7CiAJCXUzMiBmZGlfY29uZmlnID0gRkRJX1JYX1BPTEFSSVRZX1JFVkVSU0VE
X0xQVCB8CiAJCQkJIEZESV9SWF9MSU5LX1JFVkVSU0FMX09WRVJSSURFOwogCi0JCWRldl9wcml2
LT5mZGlfcnhfY29uZmlnID0gSTkxNV9SRUFEKEZESV9SWF9DVEwoUElQRV9BKSkgJiBmZGlfY29u
ZmlnOworCQlpOTE1LT5mZGlfcnhfY29uZmlnID0gSTkxNV9SRUFEKEZESV9SWF9DVEwoUElQRV9B
KSkgJiBmZGlfY29uZmlnOwogCX0KIAogCWludGVsX2NydF9yZXNldCgmY3J0LT5iYXNlLmJhc2Up
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfY3J0LmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9jcnQuaAppbmRleCAxYjNmYmEzNTllZmMuLmY3NzFmYmNmOGIy
NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfY3J0LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfY3J0LmgKQEAgLTEzLDkgKzEzLDkgQEAgc3RydWN0IGRy
bV9lbmNvZGVyOwogc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CiBzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZTsKIAotYm9vbCBpbnRlbF9jcnRfcG9ydF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK2Jvb2wgaW50ZWxfY3J0X3BvcnRfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBpOTE1X3JlZ190IGFkcGFfcmVnLCBlbnVtIHBpcGUg
KnBpcGUpOwotdm9pZCBpbnRlbF9jcnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwordm9pZCBpbnRlbF9jcnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSk7CiB2b2lkIGludGVsX2NydF9yZXNldChzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpOwog
CiAjZW5kaWYgLyogX19JTlRFTF9DUlRfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9jc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Nzci5jCmlu
ZGV4IGJmMGVlYmQzODViOS4uMjllYTNjYjZiYmFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9jc3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jc3Iu
YwpAQCAtMjA2LDE4ICsyMDYsMTggQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBzdGVwcGluZ19pbmZv
IGljbF9zdGVwcGluZ19pbmZvW10gPSB7CiBzdGF0aWMgY29uc3Qgc3RydWN0IHN0ZXBwaW5nX2lu
Zm8gbm9fc3RlcHBpbmdfaW5mbyA9IHsgJyonLCAnKicgfTsKIAogc3RhdGljIGNvbnN0IHN0cnVj
dCBzdGVwcGluZ19pbmZvICoKLWludGVsX2dldF9zdGVwcGluZ19pbmZvKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK2ludGVsX2dldF9zdGVwcGluZ19pbmZvKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCWNvbnN0IHN0cnVjdCBzdGVwcGluZ19pbmZvICpzaTsK
IAl1bnNpZ25lZCBpbnQgc2l6ZTsKIAotCWlmIChJU19JQ0VMQUtFKGRldl9wcml2KSkgeworCWlm
IChJU19JQ0VMQUtFKGk5MTUpKSB7CiAJCXNpemUgPSBBUlJBWV9TSVpFKGljbF9zdGVwcGluZ19p
bmZvKTsKIAkJc2kgPSBpY2xfc3RlcHBpbmdfaW5mbzsKLQl9IGVsc2UgaWYgKElTX1NLWUxBS0Uo
ZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19TS1lMQUtFKGk5MTUpKSB7CiAJCXNpemUgPSBB
UlJBWV9TSVpFKHNrbF9zdGVwcGluZ19pbmZvKTsKIAkJc2kgPSBza2xfc3RlcHBpbmdfaW5mbzsK
LQl9IGVsc2UgaWYgKElTX0JST1hUT04oZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19CUk9Y
VE9OKGk5MTUpKSB7CiAJCXNpemUgPSBBUlJBWV9TSVpFKGJ4dF9zdGVwcGluZ19pbmZvKTsKIAkJ
c2kgPSBieHRfc3RlcHBpbmdfaW5mbzsKIAl9IGVsc2UgewpAQCAtMjI1LDE5ICsyMjUsMTkgQEAg
aW50ZWxfZ2V0X3N0ZXBwaW5nX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCQlzaSA9IE5VTEw7CiAJfQogCi0JaWYgKElOVEVMX1JFVklEKGRldl9wcml2KSA8IHNpemUp
Ci0JCXJldHVybiBzaSArIElOVEVMX1JFVklEKGRldl9wcml2KTsKKwlpZiAoSU5URUxfUkVWSUQo
aTkxNSkgPCBzaXplKQorCQlyZXR1cm4gc2kgKyBJTlRFTF9SRVZJRChpOTE1KTsKIAogCXJldHVy
biAmbm9fc3RlcHBpbmdfaW5mbzsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOV9zZXRfZGNfc3RhdGVf
ZGVidWdtYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lk
IGdlbjlfc2V0X2RjX3N0YXRlX2RlYnVnbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAl1MzIgdmFsLCBtYXNrOwogCiAJbWFzayA9IERDX1NUQVRFX0RFQlVHX01BU0tfTUVN
T1JZX1VQOwogCi0JaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQorCWlmIChJU19HRU45X0xQKGk5
MTUpKQogCQltYXNrIHw9IERDX1NUQVRFX0RFQlVHX01BU0tfQ09SRVM7CiAKIAkvKiBUaGUgYmVs
b3cgYml0IGRvZXNuJ3QgbmVlZCB0byBiZSBjbGVhcmVkIGV2ZXIgYWZ0ZXJ3YXJkcyAqLwpAQCAt
MjUxLDI5ICsyNTEsMjkgQEAgc3RhdGljIHZvaWQgZ2VuOV9zZXRfZGNfc3RhdGVfZGVidWdtYXNr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogLyoqCiAgKiBpbnRlbF9jc3Jf
bG9hZF9wcm9ncmFtKCkgLSB3cml0ZSB0aGUgZmlybXdhcmUgZnJvbSBtZW1vcnkgdG8gcmVnaXN0
ZXIuCi0gKiBAZGV2X3ByaXY6IGk5MTUgZHJtIGRldmljZS4KKyAqIEBpOTE1OiBpOTE1IGRybSBk
ZXZpY2UuCiAgKgogICogQ1NSIGZpcm13YXJlIGlzIHJlYWQgZnJvbSBhIC5iaW4gZmlsZSBhbmQg
a2VwdCBpbiBpbnRlcm5hbCBtZW1vcnkgb25lIHRpbWUuCiAgKiBFdmVyeXRpbWUgZGlzcGxheSBj
b21lcyBiYWNrIGZyb20gbG93IHBvd2VyIHN0YXRlIHRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHRv
CiAgKiBjb3B5IHRoZSBmaXJtd2FyZSBmcm9tIGludGVybmFsIG1lbW9yeSB0byByZWdpc3RlcnMu
CiAgKi8KLXZvaWQgaW50ZWxfY3NyX2xvYWRfcHJvZ3JhbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2Nzcl9sb2FkX3Byb2dyYW0oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7Ci0JdTMyICpwYXlsb2FkID0gZGV2X3ByaXYtPmNzci5kbWNfcGF5
bG9hZDsKKwl1MzIgKnBheWxvYWQgPSBpOTE1LT5jc3IuZG1jX3BheWxvYWQ7CiAJdTMyIGksIGZ3
X3NpemU7CiAKLQlpZiAoIUhBU19DU1IoZGV2X3ByaXYpKSB7CisJaWYgKCFIQVNfQ1NSKGk5MTUp
KSB7CiAJCURSTV9FUlJPUigiTm8gQ1NSIHN1cHBvcnQgYXZhaWxhYmxlIGZvciB0aGlzIHBsYXRm
b3JtXG4iKTsKIAkJcmV0dXJuOwogCX0KIAotCWlmICghZGV2X3ByaXYtPmNzci5kbWNfcGF5bG9h
ZCkgeworCWlmICghaTkxNS0+Y3NyLmRtY19wYXlsb2FkKSB7CiAJCURSTV9FUlJPUigiVHJpZWQg
dG8gcHJvZ3JhbSBDU1Igd2l0aCBlbXB0eSBwYXlsb2FkXG4iKTsKIAkJcmV0dXJuOwogCX0KIAot
CWZ3X3NpemUgPSBkZXZfcHJpdi0+Y3NyLmRtY19md19zaXplOwotCWFzc2VydF9ycG1fd2FrZWxv
Y2tfaGVsZChkZXZfcHJpdik7CisJZndfc2l6ZSA9IGk5MTUtPmNzci5kbWNfZndfc2l6ZTsKKwlh
c3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoaTkxNSk7CiAKIAlwcmVlbXB0X2Rpc2FibGUoKTsKIApA
QCAtMjgyLDI0ICsyODIsMjQgQEAgdm9pZCBpbnRlbF9jc3JfbG9hZF9wcm9ncmFtKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCXByZWVtcHRfZW5hYmxlKCk7CiAKLQlmb3Ig
KGkgPSAwOyBpIDwgZGV2X3ByaXYtPmNzci5tbWlvX2NvdW50OyBpKyspIHsKLQkJSTkxNV9XUklU
RShkZXZfcHJpdi0+Y3NyLm1taW9hZGRyW2ldLAotCQkJICAgZGV2X3ByaXYtPmNzci5tbWlvZGF0
YVtpXSk7CisJZm9yIChpID0gMDsgaSA8IGk5MTUtPmNzci5tbWlvX2NvdW50OyBpKyspIHsKKwkJ
STkxNV9XUklURShpOTE1LT5jc3IubW1pb2FkZHJbaV0sCisJCQkgICBpOTE1LT5jc3IubW1pb2Rh
dGFbaV0pOwogCX0KIAotCWRldl9wcml2LT5jc3IuZGNfc3RhdGUgPSAwOworCWk5MTUtPmNzci5k
Y19zdGF0ZSA9IDA7CiAKLQlnZW45X3NldF9kY19zdGF0ZV9kZWJ1Z21hc2soZGV2X3ByaXYpOwor
CWdlbjlfc2V0X2RjX3N0YXRlX2RlYnVnbWFzayhpOTE1KTsKIH0KIAotc3RhdGljIHUzMiAqcGFy
c2VfY3NyX2Z3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB1MzIg
KnBhcnNlX2Nzcl9mdyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSBjb25zdCBz
dHJ1Y3QgZmlybXdhcmUgKmZ3KQogewogCXN0cnVjdCBpbnRlbF9jc3NfaGVhZGVyICpjc3NfaGVh
ZGVyOwogCXN0cnVjdCBpbnRlbF9wYWNrYWdlX2hlYWRlciAqcGFja2FnZV9oZWFkZXI7CiAJc3Ry
dWN0IGludGVsX2RtY19oZWFkZXIgKmRtY19oZWFkZXI7Ci0Jc3RydWN0IGludGVsX2NzciAqY3Ny
ID0gJmRldl9wcml2LT5jc3I7Ci0JY29uc3Qgc3RydWN0IHN0ZXBwaW5nX2luZm8gKnNpID0gaW50
ZWxfZ2V0X3N0ZXBwaW5nX2luZm8oZGV2X3ByaXYpOworCXN0cnVjdCBpbnRlbF9jc3IgKmNzciA9
ICZpOTE1LT5jc3I7CisJY29uc3Qgc3RydWN0IHN0ZXBwaW5nX2luZm8gKnNpID0gaW50ZWxfZ2V0
X3N0ZXBwaW5nX2luZm8oaTkxNSk7CiAJdTMyIGRtY19vZmZzZXQgPSBDU1JfREVGQVVMVF9GV19P
RkZTRVQsIHJlYWRjb3VudCA9IDAsIG5ieXRlczsKIAl1MzIgaTsKIAl1MzIgKmRtY19wYXlsb2Fk
OwpAQCAtNDMwLDQ4ICs0MzAsNDggQEAgc3RhdGljIHUzMiAqcGFyc2VfY3NyX2Z3KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gTlVMTDsKIH0KIAotc3RhdGljIHZv
aWQgaW50ZWxfY3NyX3J1bnRpbWVfcG1fZ2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2Nzcl9ydW50aW1lX3BtX2dldChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlXQVJOX09OKGRldl9wcml2LT5jc3Iud2FrZXJlZik7Ci0J
ZGV2X3ByaXYtPmNzci53YWtlcmVmID0KLQkJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2X3By
aXYsIFBPV0VSX0RPTUFJTl9JTklUKTsKKwlXQVJOX09OKGk5MTUtPmNzci53YWtlcmVmKTsKKwlp
OTE1LT5jc3Iud2FrZXJlZiA9CisJCWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGk5MTUsIFBPV0VS
X0RPTUFJTl9JTklUKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfY3NyX3J1bnRpbWVfcG1fcHV0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2Nz
cl9ydW50aW1lX3BtX3B1dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnRl
bF93YWtlcmVmX3Qgd2FrZXJlZiBfX21heWJlX3VudXNlZCA9Ci0JCWZldGNoX2FuZF96ZXJvKCZk
ZXZfcHJpdi0+Y3NyLndha2VyZWYpOworCQlmZXRjaF9hbmRfemVybygmaTkxNS0+Y3NyLndha2Vy
ZWYpOwogCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9J
TklULCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01B
SU5fSU5JVCwgd2FrZXJlZik7CiB9CiAKIHN0YXRpYyB2b2lkIGNzcl9sb2FkX3dvcmtfZm4oc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKIAlzdHJ1Y3QgaW50ZWxfY3Ny
ICpjc3I7CiAJY29uc3Qgc3RydWN0IGZpcm13YXJlICpmdyA9IE5VTEw7CiAKLQlkZXZfcHJpdiA9
IGNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmRldl9wcml2KSwgY3NyLndvcmspOwotCWNzciA9
ICZkZXZfcHJpdi0+Y3NyOworCWk5MTUgPSBjb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1
KSwgY3NyLndvcmspOworCWNzciA9ICZpOTE1LT5jc3I7CiAKLQlyZXF1ZXN0X2Zpcm13YXJlKCZm
dywgZGV2X3ByaXYtPmNzci5md19wYXRoLCAmZGV2X3ByaXYtPmRybS5wZGV2LT5kZXYpOworCXJl
cXVlc3RfZmlybXdhcmUoJmZ3LCBpOTE1LT5jc3IuZndfcGF0aCwgJmk5MTUtPmRybS5wZGV2LT5k
ZXYpOwogCWlmIChmdykKLQkJZGV2X3ByaXYtPmNzci5kbWNfcGF5bG9hZCA9IHBhcnNlX2Nzcl9m
dyhkZXZfcHJpdiwgZncpOworCQlpOTE1LT5jc3IuZG1jX3BheWxvYWQgPSBwYXJzZV9jc3JfZnco
aTkxNSwgZncpOwogCi0JaWYgKGRldl9wcml2LT5jc3IuZG1jX3BheWxvYWQpIHsKLQkJaW50ZWxf
Y3NyX2xvYWRfcHJvZ3JhbShkZXZfcHJpdik7Ci0JCWludGVsX2Nzcl9ydW50aW1lX3BtX3B1dChk
ZXZfcHJpdik7CisJaWYgKGk5MTUtPmNzci5kbWNfcGF5bG9hZCkgeworCQlpbnRlbF9jc3JfbG9h
ZF9wcm9ncmFtKGk5MTUpOworCQlpbnRlbF9jc3JfcnVudGltZV9wbV9wdXQoaTkxNSk7CiAKIAkJ
RFJNX0lORk8oIkZpbmlzaGVkIGxvYWRpbmcgRE1DIGZpcm13YXJlICVzICh2JXUuJXUpXG4iLAot
CQkJIGRldl9wcml2LT5jc3IuZndfcGF0aCwKKwkJCSBpOTE1LT5jc3IuZndfcGF0aCwKIAkJCSBD
U1JfVkVSU0lPTl9NQUpPUihjc3ItPnZlcnNpb24pLAogCQkJIENTUl9WRVJTSU9OX01JTk9SKGNz
ci0+dmVyc2lvbikpOwogCX0gZWxzZSB7Ci0JCWRldl9ub3RpY2UoZGV2X3ByaXYtPmRybS5kZXYs
CisJCWRldl9ub3RpY2UoaTkxNS0+ZHJtLmRldiwKIAkJCSAgICJGYWlsZWQgdG8gbG9hZCBETUMg
ZmlybXdhcmUgJXMuIgogCQkJICAgIiBEaXNhYmxpbmcgcnVudGltZSBwb3dlciBtYW5hZ2VtZW50
LlxuIiwKIAkJCSAgIGNzci0+ZndfcGF0aCk7Ci0JCWRldl9ub3RpY2UoZGV2X3ByaXYtPmRybS5k
ZXYsICJETUMgZmlybXdhcmUgaG9tZXBhZ2U6ICVzIiwKKwkJZGV2X25vdGljZShpOTE1LT5kcm0u
ZGV2LCAiRE1DIGZpcm13YXJlIGhvbWVwYWdlOiAlcyIsCiAJCQkgICBJTlRFTF9VQ19GSVJNV0FS
RV9VUkwpOwogCX0KIApAQCAtNDgwLDE4ICs0ODAsMTggQEAgc3RhdGljIHZvaWQgY3NyX2xvYWRf
d29ya19mbihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAKIC8qKgogICogaW50ZWxfY3NyX3Vj
b2RlX2luaXQoKSAtIGluaXRpYWxpemUgdGhlIGZpcm13YXJlIGxvYWRpbmcuCi0gKiBAZGV2X3By
aXY6IGk5MTUgZHJtIGRldmljZS4KKyAqIEBpOTE1OiBpOTE1IGRybSBkZXZpY2UuCiAgKgogICog
VGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYXQgdGhlIHRpbWUgb2YgbG9hZGluZyB0aGUgZGlzcGxh
eSBkcml2ZXIgdG8gcmVhZAogICogZmlybXdhcmUgZnJvbSBhIC5iaW4gZmlsZSBhbmQgY29waWVk
IGludG8gYSBpbnRlcm5hbCBtZW1vcnkuCiAgKi8KLXZvaWQgaW50ZWxfY3NyX3Vjb2RlX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9jc3JfdWNvZGVf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3Ny
ICpjc3IgPSAmZGV2X3ByaXYtPmNzcjsKKwlzdHJ1Y3QgaW50ZWxfY3NyICpjc3IgPSAmaTkxNS0+
Y3NyOwogCi0JSU5JVF9XT1JLKCZkZXZfcHJpdi0+Y3NyLndvcmssIGNzcl9sb2FkX3dvcmtfZm4p
OworCUlOSVRfV09SSygmaTkxNS0+Y3NyLndvcmssIGNzcl9sb2FkX3dvcmtfZm4pOwogCi0JaWYg
KCFIQVNfQ1NSKGRldl9wcml2KSkKKwlpZiAoIUhBU19DU1IoaTkxNSkpCiAJCXJldHVybjsKIAog
CS8qCkBAIC01MDIsMzIgKzUwMiwzMiBAQCB2b2lkIGludGVsX2Nzcl91Y29kZV9pbml0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBzdXNwZW5kIGFzIHJ1bnRpbWUgc3Vz
cGVuZCAqcmVxdWlyZXMqIGEgd29ya2luZyBDU1IgZm9yIHdoYXRldmVyCiAJICogcmVhc29uLgog
CSAqLwotCWludGVsX2Nzcl9ydW50aW1lX3BtX2dldChkZXZfcHJpdik7CisJaW50ZWxfY3NyX3J1
bnRpbWVfcG1fZ2V0KGk5MTUpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsK
KwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDEyKSB7CiAJCS8qIEFsbG93IHRvIGxvYWQgZncgdmlh
IHBhcmFtZXRlciB1c2luZyB0aGUgbGFzdCBrbm93biBzaXplICovCiAJCWNzci0+bWF4X2Z3X3Np
emUgPSBHRU4xMl9DU1JfTUFYX0ZXX1NJWkU7Ci0JfSBlbHNlIGlmIChJU19HRU4oZGV2X3ByaXYs
IDExKSkgeworCX0gZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDExKSkgewogCQljc3ItPmZ3X3BhdGgg
PSBJQ0xfQ1NSX1BBVEg7CiAJCWNzci0+cmVxdWlyZWRfdmVyc2lvbiA9IElDTF9DU1JfVkVSU0lP
Tl9SRVFVSVJFRDsKIAkJY3NyLT5tYXhfZndfc2l6ZSA9IElDTF9DU1JfTUFYX0ZXX1NJWkU7Ci0J
fSBlbHNlIGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfQ0FO
Tk9OTEFLRShpOTE1KSkgewogCQljc3ItPmZ3X3BhdGggPSBDTkxfQ1NSX1BBVEg7CiAJCWNzci0+
cmVxdWlyZWRfdmVyc2lvbiA9IENOTF9DU1JfVkVSU0lPTl9SRVFVSVJFRDsKIAkJY3NyLT5tYXhf
Zndfc2l6ZSA9IENOTF9DU1JfTUFYX0ZXX1NJWkU7Ci0JfSBlbHNlIGlmIChJU19HRU1JTklMQUtF
KGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfR0VNSU5JTEFLRShpOTE1KSkgewogCQljc3It
PmZ3X3BhdGggPSBHTEtfQ1NSX1BBVEg7CiAJCWNzci0+cmVxdWlyZWRfdmVyc2lvbiA9IEdMS19D
U1JfVkVSU0lPTl9SRVFVSVJFRDsKIAkJY3NyLT5tYXhfZndfc2l6ZSA9IEdMS19DU1JfTUFYX0ZX
X1NJWkU7Ci0JfSBlbHNlIGlmIChJU19LQUJZTEFLRShkZXZfcHJpdikgfHwgSVNfQ09GRkVFTEFL
RShkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0tBQllMQUtFKGk5MTUpIHx8IElTX0NPRkZF
RUxBS0UoaTkxNSkpIHsKIAkJY3NyLT5md19wYXRoID0gS0JMX0NTUl9QQVRIOwogCQljc3ItPnJl
cXVpcmVkX3ZlcnNpb24gPSBLQkxfQ1NSX1ZFUlNJT05fUkVRVUlSRUQ7CiAJCWNzci0+bWF4X2Z3
X3NpemUgPSBLQkxfQ1NSX01BWF9GV19TSVpFOwotCX0gZWxzZSBpZiAoSVNfU0tZTEFLRShkZXZf
cHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1NLWUxBS0UoaTkxNSkpIHsKIAkJY3NyLT5md19wYXRo
ID0gU0tMX0NTUl9QQVRIOwogCQljc3ItPnJlcXVpcmVkX3ZlcnNpb24gPSBTS0xfQ1NSX1ZFUlNJ
T05fUkVRVUlSRUQ7CiAJCWNzci0+bWF4X2Z3X3NpemUgPSBTS0xfQ1NSX01BWF9GV19TSVpFOwot
CX0gZWxzZSBpZiAoSVNfQlJPWFRPTihkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0JST1hU
T04oaTkxNSkpIHsKIAkJY3NyLT5md19wYXRoID0gQlhUX0NTUl9QQVRIOwogCQljc3ItPnJlcXVp
cmVkX3ZlcnNpb24gPSBCWFRfQ1NSX1ZFUlNJT05fUkVRVUlSRUQ7CiAJCWNzci0+bWF4X2Z3X3Np
emUgPSBCWFRfQ1NSX01BWF9GV19TSVpFOwpAQCAtNTUxLDYzICs1NTEsNjMgQEAgdm9pZCBpbnRl
bF9jc3JfdWNvZGVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQog
CiAJRFJNX0RFQlVHX0tNUygiTG9hZGluZyAlc1xuIiwgY3NyLT5md19wYXRoKTsKLQlzY2hlZHVs
ZV93b3JrKCZkZXZfcHJpdi0+Y3NyLndvcmspOworCXNjaGVkdWxlX3dvcmsoJmk5MTUtPmNzci53
b3JrKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9jc3JfdWNvZGVfc3VzcGVuZCgpIC0gcHJlcGFyZSBD
U1IgZmlybXdhcmUgYmVmb3JlIHN5c3RlbSBzdXNwZW5kCi0gKiBAZGV2X3ByaXY6IGk5MTUgZHJt
IGRldmljZQorICogQGk5MTU6IGk5MTUgZHJtIGRldmljZQogICoKICAqIFByZXBhcmUgdGhlIERN
QyBmaXJtd2FyZSBiZWZvcmUgZW50ZXJpbmcgc3lzdGVtIHN1c3BlbmQuIFRoaXMgaW5jbHVkZXMK
ICAqIGZsdXNoaW5nIHBlbmRpbmcgd29yayBpdGVtcyBhbmQgcmVsZWFzaW5nIGFueSByZXNvdXJj
ZXMgYWNxdWlyZWQgZHVyaW5nCiAgKiBpbml0LgogICovCi12b2lkIGludGVsX2Nzcl91Y29kZV9z
dXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfY3Ny
X3Vjb2RlX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKCFI
QVNfQ1NSKGRldl9wcml2KSkKKwlpZiAoIUhBU19DU1IoaTkxNSkpCiAJCXJldHVybjsKIAotCWZs
dXNoX3dvcmsoJmRldl9wcml2LT5jc3Iud29yayk7CisJZmx1c2hfd29yaygmaTkxNS0+Y3NyLndv
cmspOwogCiAJLyogRHJvcCB0aGUgcmVmZXJlbmNlIGhlbGQgaW4gY2FzZSBETUMgaXNuJ3QgbG9h
ZGVkLiAqLwotCWlmICghZGV2X3ByaXYtPmNzci5kbWNfcGF5bG9hZCkKLQkJaW50ZWxfY3NyX3J1
bnRpbWVfcG1fcHV0KGRldl9wcml2KTsKKwlpZiAoIWk5MTUtPmNzci5kbWNfcGF5bG9hZCkKKwkJ
aW50ZWxfY3NyX3J1bnRpbWVfcG1fcHV0KGk5MTUpOwogfQogCiAvKioKICAqIGludGVsX2Nzcl91
Y29kZV9yZXN1bWUoKSAtIGluaXQgQ1NSIGZpcm13YXJlIGR1cmluZyBzeXN0ZW0gcmVzdW1lCi0g
KiBAZGV2X3ByaXY6IGk5MTUgZHJtIGRldmljZQorICogQGk5MTU6IGk5MTUgZHJtIGRldmljZQog
ICoKICAqIFJlaW5pdGlhbGl6ZSB0aGUgRE1DIGZpcm13YXJlIGR1cmluZyBzeXN0ZW0gcmVzdW1l
LCByZWFjcXVpcmluZyBhbnkKICAqIHJlc291cmNlcyByZWxlYXNlZCBpbiBpbnRlbF9jc3JfdWNv
ZGVfc3VzcGVuZCgpLgogICovCi12b2lkIGludGVsX2Nzcl91Y29kZV9yZXN1bWUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9jc3JfdWNvZGVfcmVzdW1lKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlmICghSEFTX0NTUihkZXZfcHJpdikp
CisJaWYgKCFIQVNfQ1NSKGk5MTUpKQogCQlyZXR1cm47CiAKIAkvKgogCSAqIFJlYWNxdWlyZSB0
aGUgcmVmZXJlbmNlIHRvIGtlZXAgUlBNIGRpc2FibGVkIGluIGNhc2UgRE1DIGlzbid0CiAJICog
bG9hZGVkLgogCSAqLwotCWlmICghZGV2X3ByaXYtPmNzci5kbWNfcGF5bG9hZCkKLQkJaW50ZWxf
Y3NyX3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsKKwlpZiAoIWk5MTUtPmNzci5kbWNfcGF5bG9h
ZCkKKwkJaW50ZWxfY3NyX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwogfQogCiAvKioKICAqIGludGVs
X2Nzcl91Y29kZV9maW5pKCkgLSB1bmxvYWQgdGhlIENTUiBmaXJtd2FyZS4KLSAqIEBkZXZfcHJp
djogaTkxNSBkcm0gZGV2aWNlLgorICogQGk5MTU6IGk5MTUgZHJtIGRldmljZS4KICAqCiAgKiBG
aXJtbXdhcmUgdW5sb2FkaW5nIGluY2x1ZGVzIGZyZWVpbmcgdGhlIGludGVybmFsIG1lbW9yeSBh
bmQgcmVzZXQgdGhlCiAgKiBmaXJtd2FyZSBsb2FkaW5nIHN0YXR1cy4KICAqLwotdm9pZCBpbnRl
bF9jc3JfdWNvZGVfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lk
IGludGVsX2Nzcl91Y29kZV9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CWlmICghSEFTX0NTUihkZXZfcHJpdikpCisJaWYgKCFIQVNfQ1NSKGk5MTUpKQogCQlyZXR1cm47
CiAKLQlpbnRlbF9jc3JfdWNvZGVfc3VzcGVuZChkZXZfcHJpdik7Ci0JV0FSTl9PTihkZXZfcHJp
di0+Y3NyLndha2VyZWYpOworCWludGVsX2Nzcl91Y29kZV9zdXNwZW5kKGk5MTUpOworCVdBUk5f
T04oaTkxNS0+Y3NyLndha2VyZWYpOwogCi0Ja2ZyZWUoZGV2X3ByaXYtPmNzci5kbWNfcGF5bG9h
ZCk7CisJa2ZyZWUoaTkxNS0+Y3NyLmRtY19wYXlsb2FkKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
ZGRpLmMKaW5kZXggNzkyNWExNzZmOTAwLi5lYjYxNzMxZjFhYmMgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2RkaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2RkaS5jCkBAIC01ODYsOSArNTg2LDkgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpY2xfbWdf
cGh5X2RkaV9idWZfdHJhbnMgaWNsX21nX3BoeV9kZGlfdHJhbnNsYXRpb25zW10gPSB7CiB9Owog
CiBzdGF0aWMgY29uc3Qgc3RydWN0IGRkaV9idWZfdHJhbnMgKgotYmR3X2dldF9idWZfdHJhbnNf
ZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJpZXMpCiti
ZHdfZ2V0X2J1Zl90cmFuc19lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCAq
bl9lbnRyaWVzKQogewotCWlmIChkZXZfcHJpdi0+dmJ0LmVkcC5sb3dfdnN3aW5nKSB7CisJaWYg
KGk5MTUtPnZidC5lZHAubG93X3Zzd2luZykgewogCQkqbl9lbnRyaWVzID0gQVJSQVlfU0laRShi
ZHdfZGRpX3RyYW5zbGF0aW9uc19lZHApOwogCQlyZXR1cm4gYmR3X2RkaV90cmFuc2xhdGlvbnNf
ZWRwOwogCX0gZWxzZSB7CkBAIC01OTgsMTIgKzU5OCwxMiBAQCBiZHdfZ2V0X2J1Zl90cmFuc19l
ZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgKm5fZW50cmllcykKIH0K
IAogc3RhdGljIGNvbnN0IHN0cnVjdCBkZGlfYnVmX3RyYW5zICoKLXNrbF9nZXRfYnVmX3RyYW5z
X2RwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJpZXMpCitz
a2xfZ2V0X2J1Zl90cmFuc19kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50ICpu
X2VudHJpZXMpCiB7Ci0JaWYgKElTX1NLTF9VTFgoZGV2X3ByaXYpKSB7CisJaWYgKElTX1NLTF9V
TFgoaTkxNSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoc2tsX3lfZGRpX3RyYW5zbGF0
aW9uc19kcCk7CiAJCXJldHVybiBza2xfeV9kZGlfdHJhbnNsYXRpb25zX2RwOwotCX0gZWxzZSBp
ZiAoSVNfU0tMX1VMVChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1NLTF9VTFQoaTkxNSkp
IHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoc2tsX3VfZGRpX3RyYW5zbGF0aW9uc19kcCk7
CiAJCXJldHVybiBza2xfdV9kZGlfdHJhbnNsYXRpb25zX2RwOwogCX0gZWxzZSB7CkBAIC02MTMs
MTIgKzYxMywxMiBAQCBza2xfZ2V0X2J1Zl90cmFuc19kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIGludCAqbl9lbnRyaWVzKQogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRk
aV9idWZfdHJhbnMgKgota2JsX2dldF9idWZfdHJhbnNfZHAoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCBpbnQgKm5fZW50cmllcykKK2tibF9nZXRfYnVmX3RyYW5zX2RwKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgKm5fZW50cmllcykKIHsKLQlpZiAoSVNfS0JM
X1VMWChkZXZfcHJpdikgfHwgSVNfQ0ZMX1VMWChkZXZfcHJpdikpIHsKKwlpZiAoSVNfS0JMX1VM
WChpOTE1KSB8fCBJU19DRkxfVUxYKGk5MTUpKSB7CiAJCSpuX2VudHJpZXMgPSBBUlJBWV9TSVpF
KGtibF95X2RkaV90cmFuc2xhdGlvbnNfZHApOwogCQlyZXR1cm4ga2JsX3lfZGRpX3RyYW5zbGF0
aW9uc19kcDsKLQl9IGVsc2UgaWYgKElTX0tCTF9VTFQoZGV2X3ByaXYpIHx8IElTX0NGTF9VTFQo
ZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19LQkxfVUxUKGk5MTUpIHx8IElTX0NGTF9VTFQo
aTkxNSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoa2JsX3VfZGRpX3RyYW5zbGF0aW9u
c19kcCk7CiAJCXJldHVybiBrYmxfdV9kZGlfdHJhbnNsYXRpb25zX2RwOwogCX0gZWxzZSB7CkBA
IC02MjgsMTUgKzYyOCwxNSBAQCBrYmxfZ2V0X2J1Zl90cmFuc19kcChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIGludCAqbl9lbnRyaWVzKQogfQogCiBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGRkaV9idWZfdHJhbnMgKgotc2tsX2dldF9idWZfdHJhbnNfZWRwKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJpZXMpCitza2xfZ2V0X2J1Zl90cmFuc19l
ZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCAqbl9lbnRyaWVzKQogewotCWlm
IChkZXZfcHJpdi0+dmJ0LmVkcC5sb3dfdnN3aW5nKSB7Ci0JCWlmIChJU19TS0xfVUxYKGRldl9w
cml2KSB8fCBJU19LQkxfVUxYKGRldl9wcml2KSB8fAotCQkgICAgSVNfQ0ZMX1VMWChkZXZfcHJp
dikpIHsKKwlpZiAoaTkxNS0+dmJ0LmVkcC5sb3dfdnN3aW5nKSB7CisJCWlmIChJU19TS0xfVUxY
KGk5MTUpIHx8IElTX0tCTF9VTFgoaTkxNSkgfHwKKwkJICAgIElTX0NGTF9VTFgoaTkxNSkpIHsK
IAkJCSpuX2VudHJpZXMgPSBBUlJBWV9TSVpFKHNrbF95X2RkaV90cmFuc2xhdGlvbnNfZWRwKTsK
IAkJCXJldHVybiBza2xfeV9kZGlfdHJhbnNsYXRpb25zX2VkcDsKLQkJfSBlbHNlIGlmIChJU19T
S0xfVUxUKGRldl9wcml2KSB8fCBJU19LQkxfVUxUKGRldl9wcml2KSB8fAotCQkJICAgSVNfQ0ZM
X1VMVChkZXZfcHJpdikpIHsKKwkJfSBlbHNlIGlmIChJU19TS0xfVUxUKGk5MTUpIHx8IElTX0tC
TF9VTFQoaTkxNSkgfHwKKwkJCSAgIElTX0NGTF9VTFQoaTkxNSkpIHsKIAkJCSpuX2VudHJpZXMg
PSBBUlJBWV9TSVpFKHNrbF91X2RkaV90cmFuc2xhdGlvbnNfZWRwKTsKIAkJCXJldHVybiBza2xf
dV9kZGlfdHJhbnNsYXRpb25zX2VkcDsKIAkJfSBlbHNlIHsKQEAgLTY0NSwxNyArNjQ1LDE3IEBA
IHNrbF9nZXRfYnVmX3RyYW5zX2VkcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IGludCAqbl9lbnRyaWVzKQogCQl9CiAJfQogCi0JaWYgKElTX0tBQllMQUtFKGRldl9wcml2KSB8
fCBJU19DT0ZGRUVMQUtFKGRldl9wcml2KSkKLQkJcmV0dXJuIGtibF9nZXRfYnVmX3RyYW5zX2Rw
KGRldl9wcml2LCBuX2VudHJpZXMpOworCWlmIChJU19LQUJZTEFLRShpOTE1KSB8fCBJU19DT0ZG
RUVMQUtFKGk5MTUpKQorCQlyZXR1cm4ga2JsX2dldF9idWZfdHJhbnNfZHAoaTkxNSwgbl9lbnRy
aWVzKTsKIAllbHNlCi0JCXJldHVybiBza2xfZ2V0X2J1Zl90cmFuc19kcChkZXZfcHJpdiwgbl9l
bnRyaWVzKTsKKwkJcmV0dXJuIHNrbF9nZXRfYnVmX3RyYW5zX2RwKGk5MTUsIG5fZW50cmllcyk7
CiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZGRpX2J1Zl90cmFucyAqCi1za2xfZ2V0X2J1Zl90
cmFuc19oZG1pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJp
ZXMpCitza2xfZ2V0X2J1Zl90cmFuc19oZG1pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCBpbnQgKm5fZW50cmllcykKIHsKLQlpZiAoSVNfU0tMX1VMWChkZXZfcHJpdikgfHwgSVNfS0JM
X1VMWChkZXZfcHJpdikgfHwKLQkgICAgSVNfQ0ZMX1VMWChkZXZfcHJpdikpIHsKKwlpZiAoSVNf
U0tMX1VMWChpOTE1KSB8fCBJU19LQkxfVUxYKGk5MTUpIHx8CisJICAgIElTX0NGTF9VTFgoaTkx
NSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoc2tsX3lfZGRpX3RyYW5zbGF0aW9uc19o
ZG1pKTsKIAkJcmV0dXJuIHNrbF95X2RkaV90cmFuc2xhdGlvbnNfaGRtaTsKIAl9IGVsc2UgewpA
QCAtNjc0LDIzICs2NzQsMjMgQEAgc3RhdGljIGludCBza2xfYnVmX3RyYW5zX251bV9lbnRyaWVz
KGVudW0gcG9ydCBwb3J0LCBpbnQgbl9lbnRyaWVzKQogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0
IGRkaV9idWZfdHJhbnMgKgotaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZHAoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZHAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBlbnVtIHBvcnQgcG9ydCwgaW50ICpuX2Vu
dHJpZXMpCiB7Ci0JaWYgKElTX0tBQllMQUtFKGRldl9wcml2KSB8fCBJU19DT0ZGRUVMQUtFKGRl
dl9wcml2KSkgeworCWlmIChJU19LQUJZTEFLRShpOTE1KSB8fCBJU19DT0ZGRUVMQUtFKGk5MTUp
KSB7CiAJCWNvbnN0IHN0cnVjdCBkZGlfYnVmX3RyYW5zICpkZGlfdHJhbnNsYXRpb25zID0KLQkJ
CWtibF9nZXRfYnVmX3RyYW5zX2RwKGRldl9wcml2LCBuX2VudHJpZXMpOworCQkJa2JsX2dldF9i
dWZfdHJhbnNfZHAoaTkxNSwgbl9lbnRyaWVzKTsKIAkJKm5fZW50cmllcyA9IHNrbF9idWZfdHJh
bnNfbnVtX2VudHJpZXMocG9ydCwgKm5fZW50cmllcyk7CiAJCXJldHVybiBkZGlfdHJhbnNsYXRp
b25zOwotCX0gZWxzZSBpZiAoSVNfU0tZTEFLRShkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElT
X1NLWUxBS0UoaTkxNSkpIHsKIAkJY29uc3Qgc3RydWN0IGRkaV9idWZfdHJhbnMgKmRkaV90cmFu
c2xhdGlvbnMgPQotCQkJc2tsX2dldF9idWZfdHJhbnNfZHAoZGV2X3ByaXYsIG5fZW50cmllcyk7
CisJCQlza2xfZ2V0X2J1Zl90cmFuc19kcChpOTE1LCBuX2VudHJpZXMpOwogCQkqbl9lbnRyaWVz
ID0gc2tsX2J1Zl90cmFuc19udW1fZW50cmllcyhwb3J0LCAqbl9lbnRyaWVzKTsKIAkJcmV0dXJu
IGRkaV90cmFuc2xhdGlvbnM7Ci0JfSBlbHNlIGlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7
CisJfSBlbHNlIGlmIChJU19CUk9BRFdFTEwoaTkxNSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZ
X1NJWkUoYmR3X2RkaV90cmFuc2xhdGlvbnNfZHApOwogCQlyZXR1cm4gIGJkd19kZGlfdHJhbnNs
YXRpb25zX2RwOwotCX0gZWxzZSBpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikpIHsKKwl9IGVsc2Ug
aWYgKElTX0hBU1dFTEwoaTkxNSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoaHN3X2Rk
aV90cmFuc2xhdGlvbnNfZHApOwogCQlyZXR1cm4gaHN3X2RkaV90cmFuc2xhdGlvbnNfZHA7CiAJ
fQpAQCAtNzAwLDE3ICs3MDAsMTcgQEAgaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZHAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRk
aV9idWZfdHJhbnMgKgotaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZWRwKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKK2ludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2VkcChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBlbnVtIHBvcnQgcG9ydCwgaW50ICpuX2Vu
dHJpZXMpCiB7Ci0JaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKSB7CisJaWYgKElTX0dFTjlfQkMo
aTkxNSkpIHsKIAkJY29uc3Qgc3RydWN0IGRkaV9idWZfdHJhbnMgKmRkaV90cmFuc2xhdGlvbnMg
PQotCQkJc2tsX2dldF9idWZfdHJhbnNfZWRwKGRldl9wcml2LCBuX2VudHJpZXMpOworCQkJc2ts
X2dldF9idWZfdHJhbnNfZWRwKGk5MTUsIG5fZW50cmllcyk7CiAJCSpuX2VudHJpZXMgPSBza2xf
YnVmX3RyYW5zX251bV9lbnRyaWVzKHBvcnQsICpuX2VudHJpZXMpOwogCQlyZXR1cm4gZGRpX3Ry
YW5zbGF0aW9uczsKLQl9IGVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKLQkJcmV0
dXJuIGJkd19nZXRfYnVmX3RyYW5zX2VkcChkZXZfcHJpdiwgbl9lbnRyaWVzKTsKLQl9IGVsc2Ug
aWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19CUk9BRFdFTEwoaTkx
NSkpIHsKKwkJcmV0dXJuIGJkd19nZXRfYnVmX3RyYW5zX2VkcChpOTE1LCBuX2VudHJpZXMpOwor
CX0gZWxzZSBpZiAoSVNfSEFTV0VMTChpOTE1KSkgewogCQkqbl9lbnRyaWVzID0gQVJSQVlfU0la
RShoc3dfZGRpX3RyYW5zbGF0aW9uc19kcCk7CiAJCXJldHVybiBoc3dfZGRpX3RyYW5zbGF0aW9u
c19kcDsKIAl9CkBAIC03MjAsMTMgKzcyMCwxMyBAQCBpbnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19l
ZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdGF0aWMgY29uc3Qg
c3RydWN0IGRkaV9idWZfdHJhbnMgKgotaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZmRpKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2Zk
aShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBpbnQgKm5fZW50cmllcykK
IHsKLQlpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSkgeworCWlmIChJU19CUk9BRFdFTEwoaTkx
NSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoYmR3X2RkaV90cmFuc2xhdGlvbnNfZmRp
KTsKIAkJcmV0dXJuIGJkd19kZGlfdHJhbnNsYXRpb25zX2ZkaTsKLQl9IGVsc2UgaWYgKElTX0hB
U1dFTEwoZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19IQVNXRUxMKGk5MTUpKSB7CiAJCSpu
X2VudHJpZXMgPSBBUlJBWV9TSVpFKGhzd19kZGlfdHJhbnNsYXRpb25zX2ZkaSk7CiAJCXJldHVy
biBoc3dfZGRpX3RyYW5zbGF0aW9uc19mZGk7CiAJfQpAQCAtNzM2LDE1ICs3MzYsMTUgQEAgaW50
ZWxfZGRpX2dldF9idWZfdHJhbnNfZmRpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBkZGlfYnVmX3RyYW5zICoKLWludGVsX2RkaV9n
ZXRfYnVmX3RyYW5zX2hkbWkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50
ZWxfZGRpX2dldF9idWZfdHJhbnNfaGRtaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgICAgaW50ICpuX2VudHJpZXMpCiB7Ci0JaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKSB7
Ci0JCXJldHVybiBza2xfZ2V0X2J1Zl90cmFuc19oZG1pKGRldl9wcml2LCBuX2VudHJpZXMpOwot
CX0gZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSkgeworCWlmIChJU19HRU45X0JDKGk5
MTUpKSB7CisJCXJldHVybiBza2xfZ2V0X2J1Zl90cmFuc19oZG1pKGk5MTUsIG5fZW50cmllcyk7
CisJfSBlbHNlIGlmIChJU19CUk9BRFdFTEwoaTkxNSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZ
X1NJWkUoYmR3X2RkaV90cmFuc2xhdGlvbnNfaGRtaSk7CiAJCXJldHVybiBiZHdfZGRpX3RyYW5z
bGF0aW9uc19oZG1pOwotCX0gZWxzZSBpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikpIHsKKwl9IGVs
c2UgaWYgKElTX0hBU1dFTEwoaTkxNSkpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoaHN3
X2RkaV90cmFuc2xhdGlvbnNfaGRtaSk7CiAJCXJldHVybiBoc3dfZGRpX3RyYW5zbGF0aW9uc19o
ZG1pOwogCX0KQEAgLTc1NCwzMiArNzU0LDMyIEBAIGludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2hk
bWkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdGF0aWMgY29uc3Qg
c3RydWN0IGJ4dF9kZGlfYnVmX3RyYW5zICoKLWJ4dF9nZXRfYnVmX3RyYW5zX2RwKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJpZXMpCitieHRfZ2V0X2J1Zl90
cmFuc19kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50ICpuX2VudHJpZXMpCiB7
CiAJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoYnh0X2RkaV90cmFuc2xhdGlvbnNfZHApOwogCXJl
dHVybiBieHRfZGRpX3RyYW5zbGF0aW9uc19kcDsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBi
eHRfZGRpX2J1Zl90cmFucyAqCi1ieHRfZ2V0X2J1Zl90cmFuc19lZHAoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgKm5fZW50cmllcykKK2J4dF9nZXRfYnVmX3RyYW5zX2Vk
cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50ICpuX2VudHJpZXMpCiB7Ci0JaWYg
KGRldl9wcml2LT52YnQuZWRwLmxvd192c3dpbmcpIHsKKwlpZiAoaTkxNS0+dmJ0LmVkcC5sb3df
dnN3aW5nKSB7CiAJCSpuX2VudHJpZXMgPSBBUlJBWV9TSVpFKGJ4dF9kZGlfdHJhbnNsYXRpb25z
X2VkcCk7CiAJCXJldHVybiBieHRfZGRpX3RyYW5zbGF0aW9uc19lZHA7CiAJfQogCi0JcmV0dXJu
IGJ4dF9nZXRfYnVmX3RyYW5zX2RwKGRldl9wcml2LCBuX2VudHJpZXMpOworCXJldHVybiBieHRf
Z2V0X2J1Zl90cmFuc19kcChpOTE1LCBuX2VudHJpZXMpOwogfQogCiBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGJ4dF9kZGlfYnVmX3RyYW5zICoKLWJ4dF9nZXRfYnVmX3RyYW5zX2hkbWkoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgKm5fZW50cmllcykKK2J4dF9nZXRfYnVmX3Ry
YW5zX2hkbWkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCAqbl9lbnRyaWVzKQog
ewogCSpuX2VudHJpZXMgPSBBUlJBWV9TSVpFKGJ4dF9kZGlfdHJhbnNsYXRpb25zX2hkbWkpOwog
CXJldHVybiBieHRfZGRpX3RyYW5zbGF0aW9uc19oZG1pOwogfQogCiBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGNubF9kZGlfYnVmX3RyYW5zICoKLWNubF9nZXRfYnVmX3RyYW5zX2hkbWkoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgKm5fZW50cmllcykKK2NubF9nZXRfYnVmX3Ry
YW5zX2hkbWkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCAqbl9lbnRyaWVzKQog
ewogCXUzMiB2b2x0YWdlID0gSTkxNV9SRUFEKENOTF9QT1JUX0NPTVBfRFczKSAmIFZPTFRBR0Vf
SU5GT19NQVNLOwogCkBAIC04MDAsNyArODAwLDcgQEAgY25sX2dldF9idWZfdHJhbnNfaGRtaShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCAqbl9lbnRyaWVzKQogfQogCiBz
dGF0aWMgY29uc3Qgc3RydWN0IGNubF9kZGlfYnVmX3RyYW5zICoKLWNubF9nZXRfYnVmX3RyYW5z
X2RwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJpZXMpCitj
bmxfZ2V0X2J1Zl90cmFuc19kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50ICpu
X2VudHJpZXMpCiB7CiAJdTMyIHZvbHRhZ2UgPSBJOTE1X1JFQUQoQ05MX1BPUlRfQ09NUF9EVzMp
ICYgVk9MVEFHRV9JTkZPX01BU0s7CiAKQEAgLTgyMSwxMSArODIxLDExIEBAIGNubF9nZXRfYnVm
X3RyYW5zX2RwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJp
ZXMpCiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgY25sX2RkaV9idWZfdHJhbnMgKgotY25sX2dl
dF9idWZfdHJhbnNfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpu
X2VudHJpZXMpCitjbmxfZ2V0X2J1Zl90cmFuc19lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIGludCAqbl9lbnRyaWVzKQogewogCXUzMiB2b2x0YWdlID0gSTkxNV9SRUFEKENOTF9Q
T1JUX0NPTVBfRFczKSAmIFZPTFRBR0VfSU5GT19NQVNLOwogCi0JaWYgKGRldl9wcml2LT52YnQu
ZWRwLmxvd192c3dpbmcpIHsKKwlpZiAoaTkxNS0+dmJ0LmVkcC5sb3dfdnN3aW5nKSB7CiAJCWlm
ICh2b2x0YWdlID09IFZPTFRBR0VfSU5GT18wXzg1VikgewogCQkJKm5fZW50cmllcyA9IEFSUkFZ
X1NJWkUoY25sX2RkaV90cmFuc2xhdGlvbnNfZWRwXzBfODVWKTsKIAkJCXJldHVybiBjbmxfZGRp
X3RyYW5zbGF0aW9uc19lZHBfMF84NVY7CkBAIC04NDEsMTIgKzg0MSwxMiBAQCBjbmxfZ2V0X2J1
Zl90cmFuc19lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgKm5fZW50
cmllcykKIAkJfQogCQlyZXR1cm4gTlVMTDsKIAl9IGVsc2UgewotCQlyZXR1cm4gY25sX2dldF9i
dWZfdHJhbnNfZHAoZGV2X3ByaXYsIG5fZW50cmllcyk7CisJCXJldHVybiBjbmxfZ2V0X2J1Zl90
cmFuc19kcChpOTE1LCBuX2VudHJpZXMpOwogCX0KIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBj
bmxfZGRpX2J1Zl90cmFucyAqCi1pY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0LAoraWNsX2dldF9jb21ib19idWZf
dHJhbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9ydCBwb3J0LAogCQkJ
aW50IHR5cGUsIGludCByYXRlLCBpbnQgKm5fZW50cmllcykKIHsKIAlpZiAodHlwZSA9PSBJTlRF
TF9PVVRQVVRfSERNSSkgewpAQCAtODU1LDcgKzg1NSw3IEBAIGljbF9nZXRfY29tYm9fYnVmX3Ry
YW5zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQsCiAJ
fSBlbHNlIGlmIChyYXRlID4gNTQwMDAwICYmIHR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkgewog
CQkqbl9lbnRyaWVzID0gQVJSQVlfU0laRShpY2xfY29tYm9fcGh5X2RkaV90cmFuc2xhdGlvbnNf
ZWRwX2hicjMpOwogCQlyZXR1cm4gaWNsX2NvbWJvX3BoeV9kZGlfdHJhbnNsYXRpb25zX2VkcF9o
YnIzOwotCX0gZWxzZSBpZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQICYmIGRldl9wcml2LT52
YnQuZWRwLmxvd192c3dpbmcpIHsKKwl9IGVsc2UgaWYgKHR5cGUgPT0gSU5URUxfT1VUUFVUX0VE
UCAmJiBpOTE1LT52YnQuZWRwLmxvd192c3dpbmcpIHsKIAkJKm5fZW50cmllcyA9IEFSUkFZX1NJ
WkUoaWNsX2NvbWJvX3BoeV9kZGlfdHJhbnNsYXRpb25zX2VkcF9oYnIyKTsKIAkJcmV0dXJuIGlj
bF9jb21ib19waHlfZGRpX3RyYW5zbGF0aW9uc19lZHBfaGJyMjsKIAl9CkBAIC04NjQsMzMgKzg2
NCwzMyBAQCBpY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0LAogCXJldHVybiBpY2xfY29tYm9fcGh5X2RkaV90cmFu
c2xhdGlvbnNfZHBfaGJyMjsKIH0KIAotc3RhdGljIGludCBpbnRlbF9kZGlfaGRtaV9sZXZlbChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQorc3RhdGlj
IGludCBpbnRlbF9kZGlfaGRtaV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
ZW51bSBwb3J0IHBvcnQpCiB7CiAJaW50IG5fZW50cmllcywgbGV2ZWwsIGRlZmF1bHRfZW50cnk7
CiAKLQlsZXZlbCA9IGRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XS5oZG1pX2xldmVs
X3NoaWZ0OworCWxldmVsID0gaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF0uaGRtaV9sZXZl
bF9zaGlmdDsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7Ci0JCWlmIChpbnRl
bF9wb3J0X2lzX2NvbWJvcGh5KGRldl9wcml2LCBwb3J0KSkKLQkJCWljbF9nZXRfY29tYm9fYnVm
X3RyYW5zKGRldl9wcml2LCBwb3J0LCBJTlRFTF9PVVRQVVRfSERNSSwKKwlpZiAoSU5URUxfR0VO
KGk5MTUpID49IDExKSB7CisJCWlmIChpbnRlbF9wb3J0X2lzX2NvbWJvcGh5KGk5MTUsIHBvcnQp
KQorCQkJaWNsX2dldF9jb21ib19idWZfdHJhbnMoaTkxNSwgcG9ydCwgSU5URUxfT1VUUFVUX0hE
TUksCiAJCQkJCQkwLCAmbl9lbnRyaWVzKTsKIAkJZWxzZQogCQkJbl9lbnRyaWVzID0gQVJSQVlf
U0laRShpY2xfbWdfcGh5X2RkaV90cmFuc2xhdGlvbnMpOwogCQlkZWZhdWx0X2VudHJ5ID0gbl9l
bnRyaWVzIC0gMTsKLQl9IGVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKSB7Ci0JCWNu
bF9nZXRfYnVmX3RyYW5zX2hkbWkoZGV2X3ByaXYsICZuX2VudHJpZXMpOworCX0gZWxzZSBpZiAo
SVNfQ0FOTk9OTEFLRShpOTE1KSkgeworCQljbmxfZ2V0X2J1Zl90cmFuc19oZG1pKGk5MTUsICZu
X2VudHJpZXMpOwogCQlkZWZhdWx0X2VudHJ5ID0gbl9lbnRyaWVzIC0gMTsKLQl9IGVsc2UgaWYg
KElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7Ci0JCWJ4dF9nZXRfYnVmX3RyYW5zX2hkbWkoZGV2X3By
aXYsICZuX2VudHJpZXMpOworCX0gZWxzZSBpZiAoSVNfR0VOOV9MUChpOTE1KSkgeworCQlieHRf
Z2V0X2J1Zl90cmFuc19oZG1pKGk5MTUsICZuX2VudHJpZXMpOwogCQlkZWZhdWx0X2VudHJ5ID0g
bl9lbnRyaWVzIC0gMTsKLQl9IGVsc2UgaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKSB7Ci0JCWlu
dGVsX2RkaV9nZXRfYnVmX3RyYW5zX2hkbWkoZGV2X3ByaXYsICZuX2VudHJpZXMpOworCX0gZWxz
ZSBpZiAoSVNfR0VOOV9CQyhpOTE1KSkgeworCQlpbnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19oZG1p
KGk5MTUsICZuX2VudHJpZXMpOwogCQlkZWZhdWx0X2VudHJ5ID0gODsKLQl9IGVsc2UgaWYgKElT
X0JST0FEV0VMTChkZXZfcHJpdikpIHsKLQkJaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfaGRtaShk
ZXZfcHJpdiwgJm5fZW50cmllcyk7CisJfSBlbHNlIGlmIChJU19CUk9BRFdFTEwoaTkxNSkpIHsK
KwkJaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfaGRtaShpOTE1LCAmbl9lbnRyaWVzKTsKIAkJZGVm
YXVsdF9lbnRyeSA9IDc7Ci0JfSBlbHNlIGlmIChJU19IQVNXRUxMKGRldl9wcml2KSkgewotCQlp
bnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19oZG1pKGRldl9wcml2LCAmbl9lbnRyaWVzKTsKKwl9IGVs
c2UgaWYgKElTX0hBU1dFTEwoaTkxNSkpIHsKKwkJaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfaGRt
aShpOTE1LCAmbl9lbnRyaWVzKTsKIAkJZGVmYXVsdF9lbnRyeSA9IDY7CiAJfSBlbHNlIHsKIAkJ
V0FSTigxLCAiZGRpIHRyYW5zbGF0aW9uIHRhYmxlIG1pc3NpbmdcbiIpOwpAQCAtOTE3LDI1ICs5
MTcsMjUgQEAgc3RhdGljIGludCBpbnRlbF9kZGlfaGRtaV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3IKIHN0YXRpYyB2b2lkIGludGVsX3ByZXBh
cmVfZHBfZGRpX2J1ZmZlcnMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCSBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OwogCXUzMiBpYm9vc3RfYml0ID0gMDsKIAlpbnQgaSwgbl9lbnRyaWVzOwogCWVudW0gcG9ydCBw
b3J0ID0gZW5jb2Rlci0+cG9ydDsKIAljb25zdCBzdHJ1Y3QgZGRpX2J1Zl90cmFucyAqZGRpX3Ry
YW5zbGF0aW9uczsKIAogCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVM
X09VVFBVVF9BTkFMT0cpKQotCQlkZGlfdHJhbnNsYXRpb25zID0gaW50ZWxfZGRpX2dldF9idWZf
dHJhbnNfZmRpKGRldl9wcml2LAorCQlkZGlfdHJhbnNsYXRpb25zID0gaW50ZWxfZGRpX2dldF9i
dWZfdHJhbnNfZmRpKGk5MTUsCiAJCQkJCQkJICAgICAgICZuX2VudHJpZXMpOwogCWVsc2UgaWYg
KGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0VEUCkpCi0JCWRk
aV90cmFuc2xhdGlvbnMgPSBpbnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19lZHAoZGV2X3ByaXYsIHBv
cnQsCisJCWRkaV90cmFuc2xhdGlvbnMgPSBpbnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19lZHAoaTkx
NSwgcG9ydCwKIAkJCQkJCQkgICAgICAgJm5fZW50cmllcyk7CiAJZWxzZQotCQlkZGlfdHJhbnNs
YXRpb25zID0gaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZHAoZGV2X3ByaXYsIHBvcnQsCisJCWRk
aV90cmFuc2xhdGlvbnMgPSBpbnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19kcChpOTE1LCBwb3J0LAog
CQkJCQkJCSAgICAgICZuX2VudHJpZXMpOwogCiAJLyogSWYgd2UncmUgYm9vc3RpbmcgdGhlIGN1
cnJlbnQsIHNldCBiaXQgMzEgb2YgdHJhbnMxICovCi0JaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYp
ICYmCi0JICAgIGRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XS5kcF9ib29zdF9sZXZl
bCkKKwlpZiAoSVNfR0VOOV9CQyhpOTE1KSAmJgorCSAgICBpOTE1LT52YnQuZGRpX3BvcnRfaW5m
b1twb3J0XS5kcF9ib29zdF9sZXZlbCkKIAkJaWJvb3N0X2JpdCA9IERESV9CVUZfQkFMQU5DRV9M
RUdfRU5BQkxFOwogCiAJZm9yIChpID0gMDsgaSA8IG5fZW50cmllczsgaSsrKSB7CkBAIC05NTQs
MTMgKzk1NCwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVwYXJlX2RwX2RkaV9idWZmZXJzKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogc3RhdGljIHZvaWQgaW50ZWxfcHJlcGFyZV9o
ZG1pX2RkaV9idWZmZXJzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCQkgICBp
bnQgbGV2ZWwpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAl1MzIgaWJvb3N0X2JpdCA9IDA7CiAJaW50IG5f
ZW50cmllczsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJY29uc3Qgc3RydWN0
IGRkaV9idWZfdHJhbnMgKmRkaV90cmFuc2xhdGlvbnM7CiAKLQlkZGlfdHJhbnNsYXRpb25zID0g
aW50ZWxfZGRpX2dldF9idWZfdHJhbnNfaGRtaShkZXZfcHJpdiwgJm5fZW50cmllcyk7CisJZGRp
X3RyYW5zbGF0aW9ucyA9IGludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2hkbWkoaTkxNSwgJm5fZW50
cmllcyk7CiAKIAlpZiAoV0FSTl9PTl9PTkNFKCFkZGlfdHJhbnNsYXRpb25zKSkKIAkJcmV0dXJu
OwpAQCAtOTY4LDggKzk2OCw4IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByZXBhcmVfaGRtaV9kZGlf
YnVmZmVycyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJbGV2ZWwgPSBuX2VudHJp
ZXMgLSAxOwogCiAJLyogSWYgd2UncmUgYm9vc3RpbmcgdGhlIGN1cnJlbnQsIHNldCBiaXQgMzEg
b2YgdHJhbnMxICovCi0JaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpICYmCi0JICAgIGRldl9wcml2
LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XS5oZG1pX2Jvb3N0X2xldmVsKQorCWlmIChJU19HRU45
X0JDKGk5MTUpICYmCisJICAgIGk5MTUtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdLmhkbWlfYm9v
c3RfbGV2ZWwpCiAJCWlib29zdF9iaXQgPSBERElfQlVGX0JBTEFOQ0VfTEVHX0VOQUJMRTsKIAog
CS8qIEVudHJ5IDkgaXMgZm9yIEhETUk6ICovCkBAIC05NzksNyArOTc5LDcgQEAgc3RhdGljIHZv
aWQgaW50ZWxfcHJlcGFyZV9oZG1pX2RkaV9idWZmZXJzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQkgICBkZGlfdHJhbnNsYXRpb25zW2xldmVsXS50cmFuczIpOwogfQogCi1zdGF0
aWMgdm9pZCBpbnRlbF93YWl0X2RkaV9idWZfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRlbF93YWl0X2RkaV9idWZfaWRsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgZW51bSBwb3J0IHBvcnQpCiB7CiAJaTkxNV9y
ZWdfdCByZWcgPSBERElfQlVGX0NUTChwb3J0KTsKQEAgLTEwNjQsNyArMTA2NCw3IEBAIHZvaWQg
aHN3X2ZkaV9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAl1MzIgdGVtcCwgaSwg
cnhfY3RsX3ZhbCwgZGRpX3BsbF9zZWw7CiAKQEAgLTEwODUsNyArMTA4NSw3IEBAIHZvaWQgaHN3
X2ZkaV9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgRkRJX1JYX1RQ
MV9UT19UUDJfNDggfCBGRElfUlhfRkRJX0RFTEFZXzkwKTsKIAogCS8qIEVuYWJsZSB0aGUgUENI
IFJlY2VpdmVyIEZESSBQTEwgKi8KLQlyeF9jdGxfdmFsID0gZGV2X3ByaXYtPmZkaV9yeF9jb25m
aWcgfCBGRElfUlhfRU5IQU5DRV9GUkFNRV9FTkFCTEUgfAorCXJ4X2N0bF92YWwgPSBpOTE1LT5m
ZGlfcnhfY29uZmlnIHwgRkRJX1JYX0VOSEFOQ0VfRlJBTUVfRU5BQkxFIHwKIAkJICAgICBGRElf
UlhfUExMX0VOQUJMRSB8CiAJCSAgICAgRkRJX0RQX1BPUlRfV0lEVEgoY3J0Y19zdGF0ZS0+ZmRp
X2xhbmVzKTsKIAlJOTE1X1dSSVRFKEZESV9SWF9DVEwoUElQRV9BKSwgcnhfY3RsX3ZhbCk7CkBA
IC0xMTc0LDcgKzExNzQsNyBAQCB2b2lkIGhzd19mZGlfbGlua190cmFpbihzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIAkJSTkxNV9XUklURShEUF9UUF9DVEwoUE9SVF9FKSwgdGVtcCk7CiAJCVBP
U1RJTkdfUkVBRChEUF9UUF9DVEwoUE9SVF9FKSk7CiAKLQkJaW50ZWxfd2FpdF9kZGlfYnVmX2lk
bGUoZGV2X3ByaXYsIFBPUlRfRSk7CisJCWludGVsX3dhaXRfZGRpX2J1Zl9pZGxlKGk5MTUsIFBP
UlRfRSk7CiAKIAkJLyogUmVzZXQgRkRJX1JYX01JU0MgcHdyZG4gbGFuZXMgKi8KIAkJdGVtcCA9
IEk5MTVfUkVBRChGRElfUlhfTUlTQyhQSVBFX0EpKTsKQEAgLTEyMjMsNyArMTIyMyw3IEBAIGlu
dGVsX2RkaV9nZXRfY3J0Y19lbmNvZGVyKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCXJldHVy
biByZXQ7CiB9CiAKLXN0YXRpYyBpbnQgaHN3X2RkaV9jYWxjX3dycGxsX2xpbmsoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGludCBoc3dfZGRpX2NhbGNfd3JwbGxf
bGluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBpOTE1X3JlZ190IHJl
ZykKIHsKIAlpbnQgcmVmY2xrOwpAQCAtMTIzOCw3ICsxMjM4LDcgQEAgc3RhdGljIGludCBoc3df
ZGRpX2NhbGNfd3JwbGxfbGluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
CSAqIG5vbi1TU0MgZm9yIG5vbi1VTFQgSFNXLiBDaGVjayBGVVNFX1NUUkFQMwogCQkgKiBmb3Ig
dGhlIG5vbi1TU0MgcmVmZXJlbmNlIGZyZXF1ZW5jeS4KIAkJICovCi0JCWlmIChJU19IQVNXRUxM
KGRldl9wcml2KSAmJiAhSVNfSFNXX1VMVChkZXZfcHJpdikpIHsKKwkJaWYgKElTX0hBU1dFTEwo
aTkxNSkgJiYgIUlTX0hTV19VTFQoaTkxNSkpIHsKIAkJCWlmIChJOTE1X1JFQUQoRlVTRV9TVFJB
UDMpICYgSFNXX1JFRl9DTEtfU0VMRUNUKQogCQkJCXJlZmNsayA9IDI0OwogCQkJZWxzZQpAQCAt
MTMyNSw3ICsxMzI1LDcgQEAgc3RhdGljIGludCBza2xfY2FsY193cnBsbF9saW5rKGNvbnN0IHN0
cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpwbGxfc3RhdGUpCiAJcmV0dXJuIGRjb19mcmVxIC8g
KHAwICogcDEgKiBwMiAqIDUpOwogfQogCi1pbnQgY25sX2NhbGNfd3JwbGxfbGluayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnQgY25sX2NhbGNfd3JwbGxfbGluayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCXN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRl
ICpwbGxfc3RhdGUpCiB7CiAJdTMyIHAwLCBwMSwgcDIsIGRjb19mcmVxLCByZWZfY2xvY2s7CkBA
IC0xMzY3LDcgKzEzNjcsNyBAQCBpbnQgY25sX2NhbGNfd3JwbGxfbGluayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWJyZWFrOwogCX0KIAotCXJlZl9jbG9jayA9IGNubF9o
ZG1pX3BsbF9yZWZfY2xvY2soZGV2X3ByaXYpOworCXJlZl9jbG9jayA9IGNubF9oZG1pX3BsbF9y
ZWZfY2xvY2soaTkxNSk7CiAKIAlkY29fZnJlcSA9IChwbGxfc3RhdGUtPmNmZ2NyMCAmIERQTExf
Q0ZHQ1IwX0RDT19JTlRFR0VSX01BU0spCiAJCSogcmVmX2Nsb2NrOwpAQCAtMTM4MSw3ICsxMzgx
LDcgQEAgaW50IGNubF9jYWxjX3dycGxsX2xpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCXJldHVybiBkY29fZnJlcSAvIChwMCAqIHAxICogcDIgKiA1KTsKIH0KIAotc3Rh
dGljIGludCBpY2xfY2FsY190YnRfcGxsX2xpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAorc3RhdGljIGludCBpY2xfY2FsY190YnRfcGxsX2xpbmsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJIGVudW0gcG9ydCBwb3J0KQogewogCXUzMiB2YWwgPSBJOTE1
X1JFQUQoRERJX0NMS19TRUwocG9ydCkpICYgRERJX0NMS19TRUxfTUFTSzsKQEAgLTE0MDMsMTMg
KzE0MDMsMTMgQEAgc3RhdGljIGludCBpY2xfY2FsY190YnRfcGxsX2xpbmsoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0KIAotc3RhdGljIGludCBpY2xfY2FsY19tZ19w
bGxfbGluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgaW50IGlj
bF9jYWxjX21nX3BsbF9saW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCWNv
bnN0IHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpwbGxfc3RhdGUpCiB7CiAJdTMyIG0xLCBt
Ml9pbnQsIG0yX2ZyYWMsIGRpdjEsIGRpdjIsIHJlZl9jbG9jazsKIAl1NjQgdG1wOwogCi0JcmVm
X2Nsb2NrID0gZGV2X3ByaXYtPmNkY2xrLmh3LnJlZjsKKwlyZWZfY2xvY2sgPSBpOTE1LT5jZGNs
ay5ody5yZWY7CiAKIAltMSA9IHBsbF9zdGF0ZS0+bWdfcGxsX2RpdjEgJiBNR19QTExfRElWMV9G
QlBSRURJVl9NQVNLOwogCW0yX2ludCA9IHBsbF9zdGF0ZS0+bWdfcGxsX2RpdjAgJiBNR19QTExf
RElWMF9GQkRJVl9JTlRfTUFTSzsKQEAgLTE0ODMsMjEgKzE0ODMsMjEgQEAgc3RhdGljIHZvaWQg
ZGRpX2RvdGNsb2NrX2dldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiBz
dGF0aWMgdm9pZCBpY2xfZGRpX2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkJCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpwbGxfc3RhdGUgPSAmcGlw
ZV9jb25maWctPmRwbGxfaHdfc3RhdGU7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0
OwogCWludCBsaW5rX2Nsb2NrOwogCi0JaWYgKGludGVsX3BvcnRfaXNfY29tYm9waHkoZGV2X3By
aXYsIHBvcnQpKSB7Ci0JCWxpbmtfY2xvY2sgPSBjbmxfY2FsY193cnBsbF9saW5rKGRldl9wcml2
LCBwbGxfc3RhdGUpOworCWlmIChpbnRlbF9wb3J0X2lzX2NvbWJvcGh5KGk5MTUsIHBvcnQpKSB7
CisJCWxpbmtfY2xvY2sgPSBjbmxfY2FsY193cnBsbF9saW5rKGk5MTUsIHBsbF9zdGF0ZSk7CiAJ
fSBlbHNlIHsKLQkJZW51bSBpbnRlbF9kcGxsX2lkIHBsbF9pZCA9IGludGVsX2dldF9zaGFyZWRf
ZHBsbF9pZChkZXZfcHJpdiwKKwkJZW51bSBpbnRlbF9kcGxsX2lkIHBsbF9pZCA9IGludGVsX2dl
dF9zaGFyZWRfZHBsbF9pZChpOTE1LAogCQkJCQkJcGlwZV9jb25maWctPnNoYXJlZF9kcGxsKTsK
IAogCQlpZiAocGxsX2lkID09IERQTExfSURfSUNMX1RCVFBMTCkKLQkJCWxpbmtfY2xvY2sgPSBp
Y2xfY2FsY190YnRfcGxsX2xpbmsoZGV2X3ByaXYsIHBvcnQpOworCQkJbGlua19jbG9jayA9IGlj
bF9jYWxjX3RidF9wbGxfbGluayhpOTE1LCBwb3J0KTsKIAkJZWxzZQotCQkJbGlua19jbG9jayA9
IGljbF9jYWxjX21nX3BsbF9saW5rKGRldl9wcml2LCBwbGxfc3RhdGUpOworCQkJbGlua19jbG9j
ayA9IGljbF9jYWxjX21nX3BsbF9saW5rKGk5MTUsIHBsbF9zdGF0ZSk7CiAJfQogCiAJcGlwZV9j
b25maWctPnBvcnRfY2xvY2sgPSBsaW5rX2Nsb2NrOwpAQCAtMTUwOCwxMiArMTUwOCwxMiBAQCBz
dGF0aWMgdm9pZCBpY2xfZGRpX2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIHN0YXRpYyB2b2lkIGNubF9kZGlfY2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQkJICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNv
ZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKnBsbF9zdGF0ZSA9
ICZwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZTsKIAlpbnQgbGlua19jbG9jazsKIAogCWlmIChw
bGxfc3RhdGUtPmNmZ2NyMCAmIERQTExfQ0ZHQ1IwX0hETUlfTU9ERSkgewotCQlsaW5rX2Nsb2Nr
ID0gY25sX2NhbGNfd3JwbGxfbGluayhkZXZfcHJpdiwgcGxsX3N0YXRlKTsKKwkJbGlua19jbG9j
ayA9IGNubF9jYWxjX3dycGxsX2xpbmsoaTkxNSwgcGxsX3N0YXRlKTsKIAl9IGVsc2UgewogCQls
aW5rX2Nsb2NrID0gcGxsX3N0YXRlLT5jZmdjcjAgJiBEUExMX0NGR0NSMF9MSU5LX1JBVEVfTUFT
SzsKIApAQCAtMTYwNCw3ICsxNjA0LDcgQEAgc3RhdGljIHZvaWQgc2tsX2RkaV9jbG9ja19nZXQo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiBzdGF0aWMgdm9pZCBoc3dfZGRpX2Nsb2Nr
X2dldChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWludCBsaW5rX2Ns
b2NrID0gMDsKIAl1MzIgdmFsLCBwbGw7CiAKQEAgLTE2MjAsMTAgKzE2MjAsMTAgQEAgc3RhdGlj
IHZvaWQgaHN3X2RkaV9jbG9ja19nZXQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CWxpbmtfY2xvY2sgPSAyNzAwMDA7CiAJCWJyZWFrOwogCWNhc2UgUE9SVF9DTEtfU0VMX1dSUExM
MToKLQkJbGlua19jbG9jayA9IGhzd19kZGlfY2FsY193cnBsbF9saW5rKGRldl9wcml2LCBXUlBM
TF9DVEwoMCkpOworCQlsaW5rX2Nsb2NrID0gaHN3X2RkaV9jYWxjX3dycGxsX2xpbmsoaTkxNSwg
V1JQTExfQ1RMKDApKTsKIAkJYnJlYWs7CiAJY2FzZSBQT1JUX0NMS19TRUxfV1JQTEwyOgotCQls
aW5rX2Nsb2NrID0gaHN3X2RkaV9jYWxjX3dycGxsX2xpbmsoZGV2X3ByaXYsIFdSUExMX0NUTCgx
KSk7CisJCWxpbmtfY2xvY2sgPSBoc3dfZGRpX2NhbGNfd3JwbGxfbGluayhpOTE1LCBXUlBMTF9D
VEwoMSkpOwogCQlicmVhazsKIAljYXNlIFBPUlRfQ0xLX1NFTF9TUExMOgogCQlwbGwgPSBJOTE1
X1JFQUQoU1BMTF9DVEwpICYgU1BMTF9GUkVRX01BU0s7CkBAIC0xNjc1LDI0ICsxNjc1LDI0IEBA
IHN0YXRpYyB2b2lkIGJ4dF9kZGlfY2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogc3RhdGljIHZvaWQgaW50ZWxfZGRpX2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlmIChJ
TlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCWljbF9kZGlfY2xvY2tfZ2V0KGVuY29kZXIsIHBpcGVf
Y29uZmlnKTsKLQllbHNlIGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSkKKwllbHNlIGlmIChJ
U19DQU5OT05MQUtFKGk5MTUpKQogCQljbmxfZGRpX2Nsb2NrX2dldChlbmNvZGVyLCBwaXBlX2Nv
bmZpZyk7Ci0JZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfR0VO
OV9MUChpOTE1KSkKIAkJYnh0X2RkaV9jbG9ja19nZXQoZW5jb2RlciwgcGlwZV9jb25maWcpOwot
CWVsc2UgaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0dFTjlfQkMoaTkx
NSkpCiAJCXNrbF9kZGlfY2xvY2tfZ2V0KGVuY29kZXIsIHBpcGVfY29uZmlnKTsKLQllbHNlIGlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDgpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpIDw9
IDgpCiAJCWhzd19kZGlfY2xvY2tfZ2V0KGVuY29kZXIsIHBpcGVfY29uZmlnKTsKIH0KIAogdm9p
ZCBpbnRlbF9kZGlfc2V0X3BpcGVfc2V0dGluZ3MoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1
X3RyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKIAl1MzIgdGVtcDsKIApA
QCAtMTc0Niw3ICsxNzQ2LDcgQEAgdm9pZCBpbnRlbF9kZGlfc2V0X3ZjX3BheWxvYWRfYWxsb2Mo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgIGJvb2wg
c3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29k
ZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKIAl1MzIgdGVtcDsKIApAQCAtMTc2Miw3
ICsxNzYyLDcgQEAgdm9pZCBpbnRlbF9kZGlfZW5hYmxlX3RyYW5zY29kZXJfZnVuYyhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciA9IGludGVsX2RkaV9nZXRfY3J0Y19lbmNvZGVyKGNydGMp
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWVudW0gdHJhbnNjb2Rl
ciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCWVudW0gcG9y
dCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKQEAgLTE4NDUsNyArMTg0NSw3IEBAIHZvaWQgaW50ZWxf
ZGRpX2VuYWJsZV90cmFuc2NvZGVyX2Z1bmMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB2b2lkIGludGVsX2RkaV9kaXNhYmxlX3RyYW5zY29kZXJfZnVuYyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFu
c2NvZGVyOwogCWk5MTVfcmVnX3QgcmVnID0gVFJBTlNfRERJX0ZVTkNfQ1RMKGNwdV90cmFuc2Nv
ZGVyKTsKIAl1MzIgdmFsID0gSTkxNV9SRUFEKHJlZyk7CkBAIC0xODU0LDcgKzE4NTQsNyBAQCB2
b2lkIGludGVsX2RkaV9kaXNhYmxlX3RyYW5zY29kZXJfZnVuYyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZQogCXZhbCB8PSBUUkFOU19ERElfUE9SVF9OT05FOwogCUk5
MTVfV1JJVEUocmVnLCB2YWwpOwogCi0JaWYgKGRldl9wcml2LT5xdWlya3MgJiBRVUlSS19JTkNS
RUFTRV9ERElfRElTQUJMRURfVElNRSAmJgorCWlmIChpOTE1LT5xdWlya3MgJiBRVUlSS19JTkNS
RUFTRV9ERElfRElTQUJMRURfVElNRSAmJgogCSAgICBpbnRlbF9jcnRjX2hhc190eXBlKGNydGNf
c3RhdGUsIElOVEVMX09VVFBVVF9IRE1JKSkgewogCQlEUk1fREVCVUdfS01TKCJRdWlyayBJbmNy
ZWFzZSBEREkgZGlzYWJsZWQgdGltZVxuIik7CiAJCS8qIFF1aXJrIHRpbWUgYXQgMTAwbXMgZm9y
IHJlbGlhYmxlIG9wZXJhdGlvbiAqLwpAQCAtMTg2NiwxMyArMTg2NiwxMyBAQCBpbnQgaW50ZWxf
ZGRpX3RvZ2dsZV9oZGNwX3NpZ25hbGxpbmcoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2Vu
Y29kZXIsCiAJCQkJICAgICBib29sIGVuYWJsZSkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gaW50ZWxfZW5jb2Rlci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShkZXYpOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWVudW0gcGlwZSBwaXBl
ID0gMDsKIAlpbnQgcmV0ID0gMDsKIAl1MzIgdG1wOwogCi0Jd2FrZXJlZiA9IGludGVsX2Rpc3Bs
YXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsCisJd2FrZXJlZiA9IGludGVsX2Rpc3Bs
YXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwKIAkJCQkJCSAgICAgaW50ZWxfZW5jb2Rlci0+
cG93ZXJfZG9tYWluKTsKIAlpZiAoV0FSTl9PTighd2FrZXJlZikpCiAJCXJldHVybiAtRU5YSU87
CkBAIC0xODg5LDE0ICsxODg5LDE0IEBAIGludCBpbnRlbF9kZGlfdG9nZ2xlX2hkY3Bfc2lnbmFs
bGluZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlciwKIAkJdG1wICY9IH5UUkFO
U19ERElfSERDUF9TSUdOQUxMSU5HOwogCUk5MTVfV1JJVEUoVFJBTlNfRERJX0ZVTkNfQ1RMKHBp
cGUpLCB0bXApOwogb3V0OgotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBpbnRl
bF9lbmNvZGVyLT5wb3dlcl9kb21haW4sIHdha2VyZWYpOworCWludGVsX2Rpc3BsYXlfcG93ZXJf
cHV0KGk5MTUsIGludGVsX2VuY29kZXItPnBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CiAJcmV0dXJu
IHJldDsKIH0KIAogYm9vbCBpbnRlbF9kZGlfY29ubmVjdG9yX2dldF9od19zdGF0ZShzdHJ1Y3Qg
aW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCiB7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IGludGVsX2Nvbm5lY3Rvci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0gaW50
ZWxfY29ubmVjdG9yLT5lbmNvZGVyOwogCWludCB0eXBlID0gaW50ZWxfY29ubmVjdG9yLT5iYXNl
LmNvbm5lY3Rvcl90eXBlOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKQEAgLTE5
MDYsNyArMTkwNiw3IEBAIGJvb2wgaW50ZWxfZGRpX2Nvbm5lY3Rvcl9nZXRfaHdfc3RhdGUoc3Ry
dWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yKQogCXUzMiB0bXA7CiAJYm9vbCBy
ZXQ7CiAKLQl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZf
cHJpdiwKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChpOTE1
LAogCQkJCQkJICAgICBlbmNvZGVyLT5wb3dlcl9kb21haW4pOwogCWlmICghd2FrZXJlZikKIAkJ
cmV0dXJuIGZhbHNlOwpAQCAtMTkxNiw3ICsxOTE2LDcgQEAgYm9vbCBpbnRlbF9kZGlfY29ubmVj
dG9yX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3Ip
CiAJCWdvdG8gb3V0OwogCX0KIAotCWlmIChIQVNfVFJBTlNDT0RFUl9FRFAoZGV2X3ByaXYpICYm
IHBvcnQgPT0gUE9SVF9BKQorCWlmIChIQVNfVFJBTlNDT0RFUl9FRFAoaTkxNSkgJiYgcG9ydCA9
PSBQT1JUX0EpCiAJCWNwdV90cmFuc2NvZGVyID0gVFJBTlNDT0RFUl9FRFA7CiAJZWxzZQogCQlj
cHVfdHJhbnNjb2RlciA9IChlbnVtIHRyYW5zY29kZXIpIHBpcGU7CkBAIC0xOTUwLDcgKzE5NTAs
NyBAQCBib29sIGludGVsX2RkaV9jb25uZWN0b3JfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcikKIAl9CiAKIG91dDoKLQlpbnRlbF9kaXNwbGF5X3Bv
d2VyX3B1dChkZXZfcHJpdiwgZW5jb2Rlci0+cG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKKwlpbnRl
bF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBlbmNvZGVyLT5wb3dlcl9kb21haW4sIHdha2VyZWYp
OwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTE5NTksNyArMTk1OSw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX2RkaV9nZXRfZW5jb2Rlcl9waXBlcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAkJCQkJdTggKnBpcGVfbWFzaywgYm9vbCAqaXNfZHBfbXN0KQogewogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBlbmNvZGVyLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWludGVs
X3dha2VyZWZfdCB3YWtlcmVmOwogCWVudW0gcGlwZSBwOwpAQCAtMTk2OSw3ICsxOTY5LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZGRpX2dldF9lbmNvZGVyX3BpcGVzKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCSpwaXBlX21hc2sgPSAwOwogCSppc19kcF9tc3QgPSBmYWxzZTsKIAot
CXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGRldl9wcml2LAor
CXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsCiAJCQkJ
CQkgICAgIGVuY29kZXItPnBvd2VyX2RvbWFpbik7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1cm47
CkBAIC0xOTc4LDcgKzE5NzgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfZ2V0X2VuY29kZXJf
cGlwZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaWYgKCEodG1wICYgRERJX0JV
Rl9DVExfRU5BQkxFKSkKIAkJZ290byBvdXQ7CiAKLQlpZiAoSEFTX1RSQU5TQ09ERVJfRURQKGRl
dl9wcml2KSAmJiBwb3J0ID09IFBPUlRfQSkgeworCWlmIChIQVNfVFJBTlNDT0RFUl9FRFAoaTkx
NSkgJiYgcG9ydCA9PSBQT1JUX0EpIHsKIAkJdG1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5D
X0NUTChUUkFOU0NPREVSX0VEUCkpOwogCiAJCXN3aXRjaCAodG1wICYgVFJBTlNfRERJX0VEUF9J
TlBVVF9NQVNLKSB7CkBAIC0yMDAxLDcgKzIwMDEsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlf
Z2V0X2VuY29kZXJfcGlwZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJfQogCiAJ
bXN0X3BpcGVfbWFzayA9IDA7Ci0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcCkgeworCWZvcl9l
YWNoX3BpcGUoaTkxNSwgcCkgewogCQllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSAo
ZW51bSB0cmFuc2NvZGVyKXA7CiAKIAkJdG1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NU
TChjcHVfdHJhbnNjb2RlcikpOwpAQCAtMjAzMyw3ICsyMDMzLDcgQEAgc3RhdGljIHZvaWQgaW50
ZWxfZGRpX2dldF9lbmNvZGVyX3BpcGVzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CQkqaXNfZHBfbXN0ID0gbXN0X3BpcGVfbWFzazsKIAogb3V0OgotCWlmICgqcGlwZV9tYXNrICYm
IElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7CisJaWYgKCpwaXBlX21hc2sgJiYgSVNfR0VOOV9MUChp
OTE1KSkgewogCQl0bXAgPSBJOTE1X1JFQUQoQlhUX1BIWV9DVEwocG9ydCkpOwogCQlpZiAoKHRt
cCAmIChCWFRfUEhZX0NNTkxBTkVfUE9XRVJET1dOX0FDSyB8CiAJCQkgICAgQlhUX1BIWV9MQU5F
X1BPV0VSRE9XTl9BQ0sgfApAQCAtMjA0Miw3ICsyMDQyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
ZGRpX2dldF9lbmNvZGVyX3BpcGVzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJ
CSAgIihQSFlfQ1RMICUwOHgpXG4iLCBwb3J0X25hbWUocG9ydCksIHRtcCk7CiAJfQogCi0JaW50
ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIGVuY29kZXItPnBvd2VyX2RvbWFpbiwgd2Fr
ZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgZW5jb2Rlci0+cG93ZXJfZG9t
YWluLCB3YWtlcmVmKTsKIH0KIAogYm9vbCBpbnRlbF9kZGlfZ2V0X2h3X3N0YXRlKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMjA4Myw3ICsyMDgzLDcgQEAgaW50ZWxfZGRpX21h
aW5fbGlua19hdXhfZG9tYWluKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0KQog
c3RhdGljIHZvaWQgaW50ZWxfZGRpX2dldF9wb3dlcl9kb21haW5zKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0Owog
CiAJLyoKQEAgLTIwOTUsMjkgKzIwOTUsMjkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX2dldF9w
b3dlcl9kb21haW5zKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlyZXR1cm47CiAK
IAlkaWdfcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7Ci0JaW50ZWxfZGlz
cGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsIGRpZ19wb3J0LT5kZGlfaW9fcG93ZXJfZG9tYWluKTsK
KwlpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChpOTE1LCBkaWdfcG9ydC0+ZGRpX2lvX3Bvd2VyX2Rv
bWFpbik7CiAKIAkvKgogCSAqIEFVWCBwb3dlciBpcyBvbmx5IG5lZWRlZCBmb3IgKGUpRFAgbW9k
ZSwgYW5kIGZvciBIRE1JIG1vZGUgb24gVEMKIAkgKiBwb3J0cy4KIAkgKi8KIAlpZiAoaW50ZWxf
Y3J0Y19oYXNfZHBfZW5jb2RlcihjcnRjX3N0YXRlKSB8fAotCSAgICBpbnRlbF9wb3J0X2lzX3Rj
KGRldl9wcml2LCBlbmNvZGVyLT5wb3J0KSkKLQkJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2
X3ByaXYsCisJICAgIGludGVsX3BvcnRfaXNfdGMoaTkxNSwgZW5jb2Rlci0+cG9ydCkpCisJCWlu
dGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGk5MTUsCiAJCQkJCWludGVsX2RkaV9tYWluX2xpbmtfYXV4
X2RvbWFpbihkaWdfcG9ydCkpOwogCiAJLyoKIAkgKiBWRFNDIHBvd2VyIGlzIG5lZWRlZCB3aGVu
IERTQyBpcyBlbmFibGVkCiAJICovCiAJaWYgKGNydGNfc3RhdGUtPmRzY19wYXJhbXMuY29tcHJl
c3Npb25fZW5hYmxlKQotCQlpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwKKwkJaW50
ZWxfZGlzcGxheV9wb3dlcl9nZXQoaTkxNSwKIAkJCQkJaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihj
cnRjX3N0YXRlKSk7CiB9CiAKIHZvaWQgaW50ZWxfZGRpX2VuYWJsZV9waXBlX2Nsb2NrKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSBpbnRlbF9kZGlfZ2V0X2NydGNfZW5j
b2RlcihjcnRjKTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJZW51bSB0cmFu
c2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CkBAIC0y
MTI5LDcgKzIxMjksNyBAQCB2b2lkIGludGVsX2RkaV9lbmFibGVfcGlwZV9jbG9jayhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogdm9pZCBpbnRlbF9kZGlfZGlz
YWJsZV9waXBlX2Nsb2NrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNw
dV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAKIAlpZiAoY3B1X3Ry
YW5zY29kZXIgIT0gVFJBTlNDT0RFUl9FRFApCkBAIC0yMTM3LDcgKzIxMzcsNyBAQCB2b2lkIGlu
dGVsX2RkaV9kaXNhYmxlX3BpcGVfY2xvY2soY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiAJCQkgICBUUkFOU19DTEtfU0VMX0RJU0FCTEVEKTsKIH0KIAotc3RhdGlj
IHZvaWQgX3NrbF9kZGlfc2V0X2lib29zdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitzdGF0aWMgdm9pZCBfc2tsX2RkaV9zZXRfaWJvb3N0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJCWVudW0gcG9ydCBwb3J0LCB1OCBpYm9vc3QpCiB7CiAJdTMyIHRtcDsK
QEAgLTIxNTUsMjUgKzIxNTUsMjUgQEAgc3RhdGljIHZvaWQgc2tsX2RkaV9zZXRfaWJvb3N0KHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAgIGludCBsZXZlbCwgZW51bSBp
bnRlbF9vdXRwdXRfdHlwZSB0eXBlKQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmlu
dGVsX2RpZ19wb3J0ID0gZW5jX3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5k
ZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAl1OCBpYm9vc3Q7CiAKIAlp
ZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfSERNSSkKLQkJaWJvb3N0ID0gZGV2X3ByaXYtPnZidC5k
ZGlfcG9ydF9pbmZvW3BvcnRdLmhkbWlfYm9vc3RfbGV2ZWw7CisJCWlib29zdCA9IGk5MTUtPnZi
dC5kZGlfcG9ydF9pbmZvW3BvcnRdLmhkbWlfYm9vc3RfbGV2ZWw7CiAJZWxzZQotCQlpYm9vc3Qg
PSBkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF0uZHBfYm9vc3RfbGV2ZWw7CisJCWli
b29zdCA9IGk5MTUtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdLmRwX2Jvb3N0X2xldmVsOwogCiAJ
aWYgKGlib29zdCA9PSAwKSB7CiAJCWNvbnN0IHN0cnVjdCBkZGlfYnVmX3RyYW5zICpkZGlfdHJh
bnNsYXRpb25zOwogCQlpbnQgbl9lbnRyaWVzOwogCiAJCWlmICh0eXBlID09IElOVEVMX09VVFBV
VF9IRE1JKQotCQkJZGRpX3RyYW5zbGF0aW9ucyA9IGludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2hk
bWkoZGV2X3ByaXYsICZuX2VudHJpZXMpOworCQkJZGRpX3RyYW5zbGF0aW9ucyA9IGludGVsX2Rk
aV9nZXRfYnVmX3RyYW5zX2hkbWkoaTkxNSwgJm5fZW50cmllcyk7CiAJCWVsc2UgaWYgKHR5cGUg
PT0gSU5URUxfT1VUUFVUX0VEUCkKLQkJCWRkaV90cmFuc2xhdGlvbnMgPSBpbnRlbF9kZGlfZ2V0
X2J1Zl90cmFuc19lZHAoZGV2X3ByaXYsIHBvcnQsICZuX2VudHJpZXMpOworCQkJZGRpX3RyYW5z
bGF0aW9ucyA9IGludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2VkcChpOTE1LCBwb3J0LCAmbl9lbnRy
aWVzKTsKIAkJZWxzZQotCQkJZGRpX3RyYW5zbGF0aW9ucyA9IGludGVsX2RkaV9nZXRfYnVmX3Ry
YW5zX2RwKGRldl9wcml2LCBwb3J0LCAmbl9lbnRyaWVzKTsKKwkJCWRkaV90cmFuc2xhdGlvbnMg
PSBpbnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19kcChpOTE1LCBwb3J0LCAmbl9lbnRyaWVzKTsKIAog
CQlpZiAoV0FSTl9PTl9PTkNFKCFkZGlfdHJhbnNsYXRpb25zKSkKIAkJCXJldHVybjsKQEAgLTIx
ODksMzMgKzIxODksMzMgQEAgc3RhdGljIHZvaWQgc2tsX2RkaV9zZXRfaWJvb3N0KHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlyZXR1cm47CiAJfQogCi0JX3NrbF9kZGlfc2V0X2li
b29zdChkZXZfcHJpdiwgcG9ydCwgaWJvb3N0KTsKKwlfc2tsX2RkaV9zZXRfaWJvb3N0KGk5MTUs
IHBvcnQsIGlib29zdCk7CiAKIAlpZiAocG9ydCA9PSBQT1JUX0EgJiYgaW50ZWxfZGlnX3BvcnQt
Pm1heF9sYW5lcyA9PSA0KQotCQlfc2tsX2RkaV9zZXRfaWJvb3N0KGRldl9wcml2LCBQT1JUX0Us
IGlib29zdCk7CisJCV9za2xfZGRpX3NldF9pYm9vc3QoaTkxNSwgUE9SVF9FLCBpYm9vc3QpOwog
fQogCiBzdGF0aWMgdm9pZCBieHRfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIAkJCQkgICAgaW50IGxldmVsLCBlbnVtIGludGVsX291dHB1dF90eXBl
IHR5cGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgYnh0X2RkaV9idWZfdHJhbnMg
KmRkaV90cmFuc2xhdGlvbnM7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWlu
dCBuX2VudHJpZXM7CiAKIAlpZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfSERNSSkKLQkJZGRpX3Ry
YW5zbGF0aW9ucyA9IGJ4dF9nZXRfYnVmX3RyYW5zX2hkbWkoZGV2X3ByaXYsICZuX2VudHJpZXMp
OworCQlkZGlfdHJhbnNsYXRpb25zID0gYnh0X2dldF9idWZfdHJhbnNfaGRtaShpOTE1LCAmbl9l
bnRyaWVzKTsKIAllbHNlIGlmICh0eXBlID09IElOVEVMX09VVFBVVF9FRFApCi0JCWRkaV90cmFu
c2xhdGlvbnMgPSBieHRfZ2V0X2J1Zl90cmFuc19lZHAoZGV2X3ByaXYsICZuX2VudHJpZXMpOwor
CQlkZGlfdHJhbnNsYXRpb25zID0gYnh0X2dldF9idWZfdHJhbnNfZWRwKGk5MTUsICZuX2VudHJp
ZXMpOwogCWVsc2UKLQkJZGRpX3RyYW5zbGF0aW9ucyA9IGJ4dF9nZXRfYnVmX3RyYW5zX2RwKGRl
dl9wcml2LCAmbl9lbnRyaWVzKTsKKwkJZGRpX3RyYW5zbGF0aW9ucyA9IGJ4dF9nZXRfYnVmX3Ry
YW5zX2RwKGk5MTUsICZuX2VudHJpZXMpOwogCiAJaWYgKFdBUk5fT05fT05DRSghZGRpX3RyYW5z
bGF0aW9ucykpCiAJCXJldHVybjsKIAlpZiAoV0FSTl9PTl9PTkNFKGxldmVsID49IG5fZW50cmll
cykpCiAJCWxldmVsID0gbl9lbnRyaWVzIC0gMTsKIAotCWJ4dF9kZGlfcGh5X3NldF9zaWduYWxf
bGV2ZWwoZGV2X3ByaXYsIHBvcnQsCisJYnh0X2RkaV9waHlfc2V0X3NpZ25hbF9sZXZlbChpOTE1
LCBwb3J0LAogCQkJCSAgICAgZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0ubWFyZ2luLAogCQkJCSAg
ICAgZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0uc2NhbGUsCiAJCQkJICAgICBkZGlfdHJhbnNsYXRp
b25zW2xldmVsXS5lbmFibGUsCkBAIC0yMjI0LDMyICsyMjI0LDMyIEBAIHN0YXRpYyB2b2lkIGJ4
dF9kZGlfdnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiB1
OCBpbnRlbF9kZGlfZHBfdm9sdGFnZV9tYXgoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVu
Y29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2lu
dGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7
CiAJaW50IG5fZW50cmllczsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7Ci0J
CWlmIChpbnRlbF9wb3J0X2lzX2NvbWJvcGh5KGRldl9wcml2LCBwb3J0KSkKLQkJCWljbF9nZXRf
Y29tYm9fYnVmX3RyYW5zKGRldl9wcml2LCBwb3J0LCBlbmNvZGVyLT50eXBlLAorCWlmIChJTlRF
TF9HRU4oaTkxNSkgPj0gMTEpIHsKKwkJaWYgKGludGVsX3BvcnRfaXNfY29tYm9waHkoaTkxNSwg
cG9ydCkpCisJCQlpY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhpOTE1LCBwb3J0LCBlbmNvZGVyLT50
eXBlLAogCQkJCQkJaW50ZWxfZHAtPmxpbmtfcmF0ZSwgJm5fZW50cmllcyk7CiAJCWVsc2UKIAkJ
CW5fZW50cmllcyA9IEFSUkFZX1NJWkUoaWNsX21nX3BoeV9kZGlfdHJhbnNsYXRpb25zKTsKLQl9
IGVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19DQU5O
T05MQUtFKGk5MTUpKSB7CiAJCWlmIChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFAp
Ci0JCQljbmxfZ2V0X2J1Zl90cmFuc19lZHAoZGV2X3ByaXYsICZuX2VudHJpZXMpOworCQkJY25s
X2dldF9idWZfdHJhbnNfZWRwKGk5MTUsICZuX2VudHJpZXMpOwogCQllbHNlCi0JCQljbmxfZ2V0
X2J1Zl90cmFuc19kcChkZXZfcHJpdiwgJm5fZW50cmllcyk7Ci0JfSBlbHNlIGlmIChJU19HRU45
X0xQKGRldl9wcml2KSkgeworCQkJY25sX2dldF9idWZfdHJhbnNfZHAoaTkxNSwgJm5fZW50cmll
cyk7CisJfSBlbHNlIGlmIChJU19HRU45X0xQKGk5MTUpKSB7CiAJCWlmIChlbmNvZGVyLT50eXBl
ID09IElOVEVMX09VVFBVVF9FRFApCi0JCQlieHRfZ2V0X2J1Zl90cmFuc19lZHAoZGV2X3ByaXYs
ICZuX2VudHJpZXMpOworCQkJYnh0X2dldF9idWZfdHJhbnNfZWRwKGk5MTUsICZuX2VudHJpZXMp
OwogCQllbHNlCi0JCQlieHRfZ2V0X2J1Zl90cmFuc19kcChkZXZfcHJpdiwgJm5fZW50cmllcyk7
CisJCQlieHRfZ2V0X2J1Zl90cmFuc19kcChpOTE1LCAmbl9lbnRyaWVzKTsKIAl9IGVsc2Ugewog
CQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKQotCQkJaW50ZWxfZGRpX2dl
dF9idWZfdHJhbnNfZWRwKGRldl9wcml2LCBwb3J0LCAmbl9lbnRyaWVzKTsKKwkJCWludGVsX2Rk
aV9nZXRfYnVmX3RyYW5zX2VkcChpOTE1LCBwb3J0LCAmbl9lbnRyaWVzKTsKIAkJZWxzZQotCQkJ
aW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZHAoZGV2X3ByaXYsIHBvcnQsICZuX2VudHJpZXMpOwor
CQkJaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZHAoaTkxNSwgcG9ydCwgJm5fZW50cmllcyk7CiAJ
fQogCiAJaWYgKFdBUk5fT04obl9lbnRyaWVzIDwgMSkpCkBAIC0yMjg0LDE4ICsyMjg0LDE4IEBA
IHU4IGludGVsX2RkaV9kcF9wcmVfZW1waGFzaXNfbWF4KHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLCB1OCB2b2x0YWdlX3N3aW5nCiBzdGF0aWMgdm9pZCBjbmxfZGRpX3Zzd2luZ19wcm9n
cmFtKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgIGludCBsZXZlbCwgZW51
bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0
IGNubF9kZGlfYnVmX3RyYW5zICpkZGlfdHJhbnNsYXRpb25zOwogCWVudW0gcG9ydCBwb3J0ID0g
ZW5jb2Rlci0+cG9ydDsKIAlpbnQgbl9lbnRyaWVzLCBsbjsKIAl1MzIgdmFsOwogCiAJaWYgKHR5
cGUgPT0gSU5URUxfT1VUUFVUX0hETUkpCi0JCWRkaV90cmFuc2xhdGlvbnMgPSBjbmxfZ2V0X2J1
Zl90cmFuc19oZG1pKGRldl9wcml2LCAmbl9lbnRyaWVzKTsKKwkJZGRpX3RyYW5zbGF0aW9ucyA9
IGNubF9nZXRfYnVmX3RyYW5zX2hkbWkoaTkxNSwgJm5fZW50cmllcyk7CiAJZWxzZSBpZiAodHlw
ZSA9PSBJTlRFTF9PVVRQVVRfRURQKQotCQlkZGlfdHJhbnNsYXRpb25zID0gY25sX2dldF9idWZf
dHJhbnNfZWRwKGRldl9wcml2LCAmbl9lbnRyaWVzKTsKKwkJZGRpX3RyYW5zbGF0aW9ucyA9IGNu
bF9nZXRfYnVmX3RyYW5zX2VkcChpOTE1LCAmbl9lbnRyaWVzKTsKIAllbHNlCi0JCWRkaV90cmFu
c2xhdGlvbnMgPSBjbmxfZ2V0X2J1Zl90cmFuc19kcChkZXZfcHJpdiwgJm5fZW50cmllcyk7CisJ
CWRkaV90cmFuc2xhdGlvbnMgPSBjbmxfZ2V0X2J1Zl90cmFuc19kcChpOTE1LCAmbl9lbnRyaWVz
KTsKIAogCWlmIChXQVJOX09OX09OQ0UoIWRkaV90cmFuc2xhdGlvbnMpKQogCQlyZXR1cm47CkBA
IC0yMzQ4LDcgKzIzNDgsNyBAQCBzdGF0aWMgdm9pZCBjbmxfZGRpX3Zzd2luZ19wcm9ncmFtKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogc3RhdGljIHZvaWQgY25sX2RkaV92c3dpbmdf
c2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICAgIGludCBsZXZl
bCwgZW51bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJZW51bSBw
b3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWludCB3aWR0aCwgcmF0ZSwgbG47CiAJdTMyIHZh
bDsKQEAgLTI0MTIsNyArMjQxMiw3IEBAIHN0YXRpYyB2b2lkIGNubF9kZGlfdnN3aW5nX3NlcXVl
bmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCUk5MTVfV1JJVEUoQ05MX1BPUlRf
VFhfRFc1X0dSUChwb3J0KSwgdmFsKTsKIH0KIAotc3RhdGljIHZvaWQgaWNsX2RkaV9jb21ib192
c3dpbmdfcHJvZ3JhbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
dm9pZCBpY2xfZGRpX2NvbWJvX3Zzd2luZ19wcm9ncmFtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCQl1MzIgbGV2ZWwsIGVudW0gcG9ydCBwb3J0LCBpbnQgdHlwZSwKIAkJCQkJ
aW50IHJhdGUpCiB7CkBAIC0yNDIwLDcgKzI0MjAsNyBAQCBzdGF0aWMgdm9pZCBpY2xfZGRpX2Nv
bWJvX3Zzd2luZ19wcm9ncmFtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl1
MzIgbl9lbnRyaWVzLCB2YWw7CiAJaW50IGxuOwogCi0JZGRpX3RyYW5zbGF0aW9ucyA9IGljbF9n
ZXRfY29tYm9fYnVmX3RyYW5zKGRldl9wcml2LCBwb3J0LCB0eXBlLAorCWRkaV90cmFuc2xhdGlv
bnMgPSBpY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhpOTE1LCBwb3J0LCB0eXBlLAogCQkJCQkJICAg
cmF0ZSwgJm5fZW50cmllcyk7CiAJaWYgKCFkZGlfdHJhbnNsYXRpb25zKQogCQlyZXR1cm47CkBA
IC0yNDcyLDcgKzI0NzIsNyBAQCBzdGF0aWMgdm9pZCBpY2xfY29tYm9fcGh5X2RkaV92c3dpbmdf
c2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCSAgICAgIHUzMiBs
ZXZlbCwKIAkJCQkJICAgICAgZW51bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBlKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWludCB3aWR0aCA9IDA7
CiAJaW50IHJhdGUgPSAwOwpAQCAtMjUzMCw3ICsyNTMwLDcgQEAgc3RhdGljIHZvaWQgaWNsX2Nv
bWJvX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCUk5MTVfV1JJVEUoSUNMX1BPUlRfVFhfRFc1X0dSUChwb3J0KSwgdmFsKTsKIAogCS8qIDUu
IFByb2dyYW0gc3dpbmcgYW5kIGRlLWVtcGhhc2lzICovCi0JaWNsX2RkaV9jb21ib192c3dpbmdf
cHJvZ3JhbShkZXZfcHJpdiwgbGV2ZWwsIHBvcnQsIHR5cGUsIHJhdGUpOworCWljbF9kZGlfY29t
Ym9fdnN3aW5nX3Byb2dyYW0oaTkxNSwgbGV2ZWwsIHBvcnQsIHR5cGUsIHJhdGUpOwogCiAJLyog
Ni4gU2V0IHRyYWluaW5nIGVuYWJsZSB0byB0cmlnZ2VyIHVwZGF0ZSAqLwogCXZhbCA9IEk5MTVf
UkVBRChJQ0xfUE9SVF9UWF9EVzVfTE4wKHBvcnQpKTsKQEAgLTI1NDIsNyArMjU0Miw3IEBAIHN0
YXRpYyB2b2lkIGljbF9tZ19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIAkJCQkJICAgaW50IGxpbmtfY2xvY2ssCiAJCQkJCSAgIHUzMiBsZXZl
bCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAlj
b25zdCBzdHJ1Y3QgaWNsX21nX3BoeV9kZGlfYnVmX3RyYW5zICpkZGlfdHJhbnNsYXRpb25zOwog
CXUzMiBuX2VudHJpZXMsIHZhbDsKQEAgLTI2NjIsMTAgKzI2NjIsMTAgQEAgc3RhdGljIHZvaWQg
aWNsX2RkaV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CQkJICAgIHUzMiBsZXZlbCwKIAkJCQkgICAgZW51bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBlKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNv
ZGVyLT5iYXNlLmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCi0JaWYg
KGludGVsX3BvcnRfaXNfY29tYm9waHkoZGV2X3ByaXYsIHBvcnQpKQorCWlmIChpbnRlbF9wb3J0
X2lzX2NvbWJvcGh5KGk5MTUsIHBvcnQpKQogCQlpY2xfY29tYm9fcGh5X2RkaV92c3dpbmdfc2Vx
dWVuY2UoZW5jb2RlciwgbGV2ZWwsIHR5cGUpOwogCWVsc2UKIAkJaWNsX21nX3BoeV9kZGlfdnN3
aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxpbmtfY2xvY2ssIGxldmVsKTsKQEAgLTI2OTgsMTQgKzI2
OTgsMTQgQEAgc3RhdGljIHUzMiBpbnRlbF9kZGlfZHBfbGV2ZWwoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIHUzMiBieHRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRwb3J0ID0gZHBfdG9fZGlnX3BvcnQo
aW50ZWxfZHApOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZHBvcnQtPmJhc2UuYmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShkcG9ydC0+YmFzZS5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIgPSAmZHBvcnQtPmJhc2U7CiAJaW50IGxldmVsID0gaW50ZWxfZGRpX2RwX2xldmVsKGlu
dGVsX2RwKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlmIChJTlRFTF9H
RU4oaTkxNSkgPj0gMTEpCiAJCWljbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGludGVs
X2RwLT5saW5rX3JhdGUsCiAJCQkJCWxldmVsLCBlbmNvZGVyLT50eXBlKTsKLQllbHNlIGlmIChJ
U19DQU5OT05MQUtFKGRldl9wcml2KSkKKwllbHNlIGlmIChJU19DQU5OT05MQUtFKGk5MTUpKQog
CQljbmxfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgZW5jb2Rlci0+dHlwZSk7
CiAJZWxzZQogCQlieHRfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgZW5jb2Rl
ci0+dHlwZSk7CkBAIC0yNzE2LDI0ICsyNzE2LDI0IEBAIHUzMiBieHRfc2lnbmFsX2xldmVscyhz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogdTMyIGRkaV9zaWduYWxfbGV2ZWxzKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZHBvcnQg
PSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkcG9ydC0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRwb3J0LT5iYXNlLmJhc2UuZGV2KTsKIAlzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkcG9ydC0+YmFzZTsKIAlpbnQgbGV2ZWwgPSBpbnRl
bF9kZGlfZHBfbGV2ZWwoaW50ZWxfZHApOwogCi0JaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKQor
CWlmIChJU19HRU45X0JDKGk5MTUpKQogCQlza2xfZGRpX3NldF9pYm9vc3QoZW5jb2RlciwgbGV2
ZWwsIGVuY29kZXItPnR5cGUpOwogCiAJcmV0dXJuIERESV9CVUZfVFJBTlNfU0VMRUNUKGxldmVs
KTsKIH0KIAogc3RhdGljIGlubGluZQotdTMyIGljbF9kcGNsa2FfY2ZnY3IwX2Nsa19vZmYoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordTMyIGljbF9kcGNsa2FfY2ZnY3IwX2Ns
a19vZmYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBlbnVtIHBvcnQg
cG9ydCkKIHsKLQlpZiAoaW50ZWxfcG9ydF9pc19jb21ib3BoeShkZXZfcHJpdiwgcG9ydCkpIHsK
KwlpZiAoaW50ZWxfcG9ydF9pc19jb21ib3BoeShpOTE1LCBwb3J0KSkgewogCQlyZXR1cm4gSUNM
X0RQQ0xLQV9DRkdDUjBfRERJX0NMS19PRkYocG9ydCk7Ci0JfSBlbHNlIGlmIChpbnRlbF9wb3J0
X2lzX3RjKGRldl9wcml2LCBwb3J0KSkgewotCQllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVs
X3BvcnRfdG9fdGMoZGV2X3ByaXYsIHBvcnQpOworCX0gZWxzZSBpZiAoaW50ZWxfcG9ydF9pc190
YyhpOTE1LCBwb3J0KSkgeworCQllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVsX3BvcnRfdG9f
dGMoaTkxNSwgcG9ydCk7CiAKIAkJcmV0dXJuIElDTF9EUENMS0FfQ0ZHQ1IwX1RDX0NMS19PRkYo
dGNfcG9ydCk7CiAJfQpAQCAtMjc0NCw0NyArMjc0NCw0NyBAQCB1MzIgaWNsX2RwY2xrYV9jZmdj
cjBfY2xrX29mZihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgdm9p
ZCBpY2xfbWFwX3BsbHNfdG9fcG9ydHMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gY3J0Y19zdGF0ZS0+c2hh
cmVkX2RwbGw7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCXUzMiB2YWw7CiAK
LQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHBsbF9sb2NrKTsKKwltdXRleF9sb2NrKCZpOTE1LT5k
cGxsX2xvY2spOwogCiAJdmFsID0gSTkxNV9SRUFEKERQQ0xLQV9DRkdDUjBfSUNMKTsKLQlXQVJO
X09OKCh2YWwgJiBpY2xfZHBjbGthX2NmZ2NyMF9jbGtfb2ZmKGRldl9wcml2LCBwb3J0KSkgPT0g
MCk7CisJV0FSTl9PTigodmFsICYgaWNsX2RwY2xrYV9jZmdjcjBfY2xrX29mZihpOTE1LCBwb3J0
KSkgPT0gMCk7CiAKLQlpZiAoaW50ZWxfcG9ydF9pc19jb21ib3BoeShkZXZfcHJpdiwgcG9ydCkp
IHsKKwlpZiAoaW50ZWxfcG9ydF9pc19jb21ib3BoeShpOTE1LCBwb3J0KSkgewogCQl2YWwgJj0g
fkRQQ0xLQV9DRkdDUjBfRERJX0NMS19TRUxfTUFTSyhwb3J0KTsKIAkJdmFsIHw9IERQQ0xLQV9D
RkdDUjBfRERJX0NMS19TRUwocGxsLT5pbmZvLT5pZCwgcG9ydCk7CiAJCUk5MTVfV1JJVEUoRFBD
TEtBX0NGR0NSMF9JQ0wsIHZhbCk7CiAJCVBPU1RJTkdfUkVBRChEUENMS0FfQ0ZHQ1IwX0lDTCk7
CiAJfQogCi0JdmFsICY9IH5pY2xfZHBjbGthX2NmZ2NyMF9jbGtfb2ZmKGRldl9wcml2LCBwb3J0
KTsKKwl2YWwgJj0gfmljbF9kcGNsa2FfY2ZnY3IwX2Nsa19vZmYoaTkxNSwgcG9ydCk7CiAJSTkx
NV9XUklURShEUENMS0FfQ0ZHQ1IwX0lDTCwgdmFsKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPmRwbGxfbG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcGxsX2xvY2spOwogfQogCiBz
dGF0aWMgdm9pZCBpY2xfdW5tYXBfcGxsc190b19wb3J0cyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9y
dDsKIAl1MzIgdmFsOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRwbGxfbG9jayk7CisJbXV0
ZXhfbG9jaygmaTkxNS0+ZHBsbF9sb2NrKTsKIAogCXZhbCA9IEk5MTVfUkVBRChEUENMS0FfQ0ZH
Q1IwX0lDTCk7Ci0JdmFsIHw9IGljbF9kcGNsa2FfY2ZnY3IwX2Nsa19vZmYoZGV2X3ByaXYsIHBv
cnQpOworCXZhbCB8PSBpY2xfZHBjbGthX2NmZ2NyMF9jbGtfb2ZmKGk5MTUsIHBvcnQpOwogCUk5
MTVfV1JJVEUoRFBDTEtBX0NGR0NSMF9JQ0wsIHZhbCk7CiAKLQltdXRleF91bmxvY2soJmRldl9w
cml2LT5kcGxsX2xvY2spOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHBsbF9sb2NrKTsKIH0KIAog
dm9pZCBpY2xfc2FuaXRpemVfZW5jb2Rlcl9wbGxfbWFwcGluZyhzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXUzMiB2YWw7CiAJZW51bSBwb3J0IHBvcnQ7
CiAJdTMyIHBvcnRfbWFzazsKQEAgLTI4MjEsNyArMjgyMSw3IEBAIHZvaWQgaWNsX3Nhbml0aXpl
X2VuY29kZXJfcGxsX21hcHBpbmcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJCSAq
IFNhbml0eSBjaGVjayB0aGF0IHdlIGhhdmVuJ3QgaW5jb3JyZWN0bHkgcmVnaXN0ZXJlZCBhbm90
aGVyCiAJCSAqIGVuY29kZXIgdXNpbmcgYW55IG9mIHRoZSBwb3J0cyBvZiB0aGlzIERTSSBlbmNv
ZGVyLgogCQkgKi8KLQkJZm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgb3Ro
ZXJfZW5jb2RlcikgeworCQlmb3JfZWFjaF9pbnRlbF9lbmNvZGVyKCZpOTE1LT5kcm0sIG90aGVy
X2VuY29kZXIpIHsKIAkJCWlmIChvdGhlcl9lbmNvZGVyID09IGVuY29kZXIpCiAJCQkJY29udGlu
dWU7CiAKQEAgLTI4MzgsNyArMjgzOCw3IEBAIHZvaWQgaWNsX3Nhbml0aXplX2VuY29kZXJfcGxs
X21hcHBpbmcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJdmFsID0gSTkxNV9SRUFE
KERQQ0xLQV9DRkdDUjBfSUNMKTsKIAlmb3JfZWFjaF9wb3J0X21hc2tlZChwb3J0LCBwb3J0X21h
c2spIHsKIAkJYm9vbCBkZGlfY2xrX3VuZ2F0ZWQgPSAhKHZhbCAmCi0JCQkJCSBpY2xfZHBjbGth
X2NmZ2NyMF9jbGtfb2ZmKGRldl9wcml2LAorCQkJCQkgaWNsX2RwY2xrYV9jZmdjcjBfY2xrX29m
ZihpOTE1LAogCQkJCQkJCQkgICBwb3J0KSk7CiAKIAkJaWYgKGRkaV9jbGtfbmVlZGVkID09IGRk
aV9jbGtfdW5nYXRlZCkKQEAgLTI4NTMsNyArMjg1Myw3IEBAIHZvaWQgaWNsX3Nhbml0aXplX2Vu
Y29kZXJfcGxsX21hcHBpbmcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIAkJRFJN
X05PVEUoIlBvcnQgJWMgaXMgZGlzYWJsZWQvaW4gRFNJIG1vZGUgd2l0aCBhbiB1bmdhdGVkIERE
SSBjbG9jaywgZ2F0ZSBpdFxuIiwKIAkJCSBwb3J0X25hbWUocG9ydCkpOwotCQl2YWwgfD0gaWNs
X2RwY2xrYV9jZmdjcjBfY2xrX29mZihkZXZfcHJpdiwgcG9ydCk7CisJCXZhbCB8PSBpY2xfZHBj
bGthX2NmZ2NyMF9jbGtfb2ZmKGk5MTUsIHBvcnQpOwogCQlJOTE1X1dSSVRFKERQQ0xLQV9DRkdD
UjBfSUNMLCB2YWwpOwogCX0KIH0KQEAgLTI4NjEsNyArMjg2MSw3IEBAIHZvaWQgaWNsX3Nhbml0
aXplX2VuY29kZXJfcGxsX21hcHBpbmcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiBz
dGF0aWMgdm9pZCBpbnRlbF9kZGlfY2xrX3NlbGVjdChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJdTMyIHZh
bDsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCA9IGNydGNfc3RhdGUtPnNo
YXJlZF9kcGxsOwpAQCAtMjg2OSwxMyArMjg2OSwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlf
Y2xrX3NlbGVjdChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlpZiAoV0FSTl9PTigh
cGxsKSkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRwbGxfbG9jayk7CisJ
bXV0ZXhfbG9jaygmaTkxNS0+ZHBsbF9sb2NrKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDExKSB7Ci0JCWlmICghaW50ZWxfcG9ydF9pc19jb21ib3BoeShkZXZfcHJpdiwgcG9ydCkp
CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgeworCQlpZiAoIWludGVsX3BvcnRfaXNfY29t
Ym9waHkoaTkxNSwgcG9ydCkpCiAJCQlJOTE1X1dSSVRFKERESV9DTEtfU0VMKHBvcnQpLAogCQkJ
CSAgIGljbF9wbGxfdG9fZGRpX2Nsa19zZWwoZW5jb2RlciwgY3J0Y19zdGF0ZSkpOwotCX0gZWxz
ZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0NBTk5PTkxB
S0UoaTkxNSkpIHsKIAkJLyogQ29uZmlndXJlIERQQ0xLQV9DRkdDUjAgdG8gbWFwIHRoZSBEUExM
IHRvIHRoZSBEREkuICovCiAJCXZhbCA9IEk5MTVfUkVBRChEUENMS0FfQ0ZHQ1IwKTsKIAkJdmFs
ICY9IH5EUENMS0FfQ0ZHQ1IwX0RESV9DTEtfU0VMX01BU0socG9ydCk7CkBAIC0yODkwLDcgKzI4
OTAsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfY2xrX3NlbGVjdChzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIAkJdmFsID0gSTkxNV9SRUFEKERQQ0xLQV9DRkdDUjApOwogCQl2YWwg
Jj0gfkRQQ0xLQV9DRkdDUjBfRERJX0NMS19PRkYocG9ydCk7CiAJCUk5MTVfV1JJVEUoRFBDTEtB
X0NGR0NSMCwgdmFsKTsKLQl9IGVsc2UgaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKSB7CisJfSBl
bHNlIGlmIChJU19HRU45X0JDKGk5MTUpKSB7CiAJCS8qIERESSAtPiBQTEwgbWFwcGluZyAgKi8K
IAkJdmFsID0gSTkxNV9SRUFEKERQTExfQ1RSTDIpOwogCkBAIC0yOTAxLDM3ICsyOTAxLDM3IEBA
IHN0YXRpYyB2b2lkIGludGVsX2RkaV9jbGtfc2VsZWN0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCiAJCUk5MTVfV1JJVEUoRFBMTF9DVFJMMiwgdmFsKTsKIAotCX0gZWxzZSBpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA8IDkpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA8
IDkpIHsKIAkJSTkxNV9XUklURShQT1JUX0NMS19TRUwocG9ydCksIGhzd19wbGxfdG9fZGRpX3Bs
bF9zZWwocGxsKSk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHBsbF9sb2NrKTsK
KwltdXRleF91bmxvY2soJmk5MTUtPmRwbGxfbG9jayk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVs
X2RkaV9jbGtfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExKSB7Ci0JCWlmICghaW50ZWxfcG9ydF9pc19jb21ib3BoeShkZXZf
cHJpdiwgcG9ydCkpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgeworCQlpZiAoIWludGVs
X3BvcnRfaXNfY29tYm9waHkoaTkxNSwgcG9ydCkpCiAJCQlJOTE1X1dSSVRFKERESV9DTEtfU0VM
KHBvcnQpLCBERElfQ0xLX1NFTF9OT05FKTsKLQl9IGVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2
X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19DQU5OT05MQUtFKGk5MTUpKSB7CiAJCUk5MTVfV1JJ
VEUoRFBDTEtBX0NGR0NSMCwgSTkxNV9SRUFEKERQQ0xLQV9DRkdDUjApIHwKIAkJCSAgIERQQ0xL
QV9DRkdDUjBfRERJX0NMS19PRkYocG9ydCkpOwotCX0gZWxzZSBpZiAoSVNfR0VOOV9CQyhkZXZf
cHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0dFTjlfQkMoaTkxNSkpIHsKIAkJSTkxNV9XUklURShE
UExMX0NUUkwyLCBJOTE1X1JFQUQoRFBMTF9DVFJMMikgfAogCQkJICAgRFBMTF9DVFJMMl9ERElf
Q0xLX09GRihwb3J0KSk7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSkgewor
CX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpIDwgOSkgewogCQlJOTE1X1dSSVRFKFBPUlRfQ0xL
X1NFTChwb3J0KSwgUE9SVF9DTEtfU0VMX05PTkUpOwogCX0KIH0KIAogc3RhdGljIHZvaWQgaWNs
X2VuYWJsZV9waHlfY2xvY2tfZ2F0aW5nKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19w
b3J0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGln
X3BvcnQtPmJhc2UuYmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBkaWdf
cG9ydC0+YmFzZS5wb3J0OwotCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190
YyhkZXZfcHJpdiwgcG9ydCk7CisJZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0X3Rv
X3RjKGk5MTUsIHBvcnQpOwogCXUzMiB2YWw7CiAJaW50IGxuOwogCkBAIC0yOTYxLDkgKzI5NjEs
OSBAQCBzdGF0aWMgdm9pZCBpY2xfZW5hYmxlX3BoeV9jbG9ja19nYXRpbmcoc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQpCiAKIHN0YXRpYyB2b2lkIGljbF9kaXNhYmxlX3BoeV9j
bG9ja19nYXRpbmcoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRpZ19w
b3J0LT5iYXNlLmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGRpZ19wb3J0LT5iYXNlLnBv
cnQ7Ci0JZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0X3RvX3RjKGRldl9wcml2LCBw
b3J0KTsKKwllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVsX3BvcnRfdG9fdGMoaTkxNSwgcG9y
dCk7CiAJdTMyIHZhbDsKIAlpbnQgbG47CiAKQEAgLTI5OTMsOSArMjk5Myw5IEBAIHN0YXRpYyB2
b2lkIGljbF9kaXNhYmxlX3BoeV9jbG9ja19nYXRpbmcoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9y
dCAqZGlnX3BvcnQpCiAKIHN0YXRpYyB2b2lkIGljbF9wcm9ncmFtX21nX2RwX21vZGUoc3RydWN0
IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9kaWdfcG9ydC0+YmFzZS5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGludGVsX2RpZ19w
b3J0LT5iYXNlLmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGludGVsX2RpZ19wb3J0LT5i
YXNlLnBvcnQ7Ci0JZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0X3RvX3RjKGRldl9w
cml2LCBwb3J0KTsKKwllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVsX3BvcnRfdG9fdGMoaTkx
NSwgcG9ydCk7CiAJdTMyIGxuMCwgbG4xLCBsYW5lX2luZm87CiAKIAlpZiAodGNfcG9ydCA9PSBQ
T1JUX1RDX05PTkUgfHwgaW50ZWxfZGlnX3BvcnQtPnRjX3R5cGUgPT0gVENfUE9SVF9UQlQpCkBA
IC0zMDY5LDcgKzMwNjksNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9zaW5rX3NldF9mZWNfcmVh
ZHkoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIHN0YXRpYyB2b2lkIGludGVsX2RkaV9lbmFi
bGVfZmVjKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0gcG9y
dCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAl1MzIgdmFsOwogCkBAIC0zMDgwLDcgKzMwODAsNyBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfZW5hYmxlX2ZlYyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAl2YWwgfD0gRFBfVFBfQ1RMX0ZFQ19FTkFCTEU7CiAJSTkxNV9XUklURShEUF9U
UF9DVEwocG9ydCksIHZhbCk7CiAKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9w
cml2LT51bmNvcmUsIERQX1RQX1NUQVRVUyhwb3J0KSwKKwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVn
aXN0ZXIoJmk5MTUtPnVuY29yZSwgRFBfVFBfU1RBVFVTKHBvcnQpLAogCQkJCSAgICBEUF9UUF9T
VEFUVVNfRkVDX0VOQUJMRV9MSVZFLAogCQkJCSAgICBEUF9UUF9TVEFUVVNfRkVDX0VOQUJMRV9M
SVZFLAogCQkJCSAgICAxKSkKQEAgLTMwOTAsNyArMzA5MCw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2RkaV9lbmFibGVfZmVjKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogc3RhdGljIHZv
aWQgaW50ZWxfZGRpX2Rpc2FibGVfZmVjX3N0YXRlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAl1MzIgdmFs
OwogCkBAIC0zMTA4LDcgKzMxMDgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlX2VuYWJs
ZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICAgY29uc3Qgc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmZW5jb2Rlci0+YmFzZSk7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsK
IAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxf
cG9ydCAqZGlnX3BvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpOwogCWJvb2wg
aXNfbXN0ID0gaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFBf
TVNUKTsKQEAgLTMxMjMsMjYgKzMxMjMsMjYgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX3ByZV9l
bmFibGVfZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlpbnRlbF9kZGlfY2xr
X3NlbGVjdChlbmNvZGVyLCBjcnRjX3N0YXRlKTsKIAotCWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0
KGRldl9wcml2LCBkaWdfcG9ydC0+ZGRpX2lvX3Bvd2VyX2RvbWFpbik7CisJaW50ZWxfZGlzcGxh
eV9wb3dlcl9nZXQoaTkxNSwgZGlnX3BvcnQtPmRkaV9pb19wb3dlcl9kb21haW4pOwogCiAJaWNs
X3Byb2dyYW1fbWdfZHBfbW9kZShkaWdfcG9ydCk7CiAJaWNsX2Rpc2FibGVfcGh5X2Nsb2NrX2dh
dGluZyhkaWdfcG9ydCk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlpZiAo
SU5URUxfR0VOKGk5MTUpID49IDExKQogCQlpY2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVy
LCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAogCQkJCQlsZXZlbCwgZW5jb2Rlci0+dHlwZSk7Ci0J
ZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfQ0FOTk9OTEFL
RShpOTE1KSkKIAkJY25sX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgbGV2ZWwsIGVuY29k
ZXItPnR5cGUpOwotCWVsc2UgaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElT
X0dFTjlfTFAoaTkxNSkpCiAJCWJ4dF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxldmVs
LCBlbmNvZGVyLT50eXBlKTsKIAllbHNlCiAJCWludGVsX3ByZXBhcmVfZHBfZGRpX2J1ZmZlcnMo
ZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAKLQlpZiAoaW50ZWxfcG9ydF9pc19jb21ib3BoeShkZXZf
cHJpdiwgcG9ydCkpIHsKKwlpZiAoaW50ZWxfcG9ydF9pc19jb21ib3BoeShpOTE1LCBwb3J0KSkg
ewogCQlib29sIGxhbmVfcmV2ZXJzYWwgPQogCQkJZGlnX3BvcnQtPnNhdmVkX3BvcnRfYml0cyAm
IERESV9CVUZfUE9SVF9SRVZFUlNBTDsKIAotCQlpbnRlbF9jb21ib19waHlfcG93ZXJfdXBfbGFu
ZXMoZGV2X3ByaXYsIHBvcnQsIGZhbHNlLAorCQlpbnRlbF9jb21ib19waHlfcG93ZXJfdXBfbGFu
ZXMoaTkxNSwgcG9ydCwgZmFsc2UsCiAJCQkJCSAgICAgICBjcnRjX3N0YXRlLT5sYW5lX2NvdW50
LAogCQkJCQkgICAgICAgbGFuZV9yZXZlcnNhbCk7CiAJfQpAQCAtMzE1NCw3ICszMTU0LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCQkJCSAgICAgIHRydWUpOwogCWludGVsX2RwX3Npbmtfc2V0X2ZlY19yZWFk
eShpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAJaW50ZWxfZHBfc3RhcnRfbGlua190cmFpbihpbnRl
bF9kcCk7Ci0JaWYgKHBvcnQgIT0gUE9SVF9BIHx8IElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkK
KwlpZiAocG9ydCAhPSBQT1JUX0EgfHwgSU5URUxfR0VOKGk5MTUpID49IDkpCiAJCWludGVsX2Rw
X3N0b3BfbGlua190cmFpbihpbnRlbF9kcCk7CiAKIAlpbnRlbF9kZGlfZW5hYmxlX2ZlYyhlbmNv
ZGVyLCBjcnRjX3N0YXRlKTsKQEAgLTMxNzMsMzIgKzMxNzMsMzIgQEAgc3RhdGljIHZvaWQgaW50
ZWxfZGRpX3ByZV9lbmFibGVfaGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsK
IAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9IGVuY190b19kaWdf
cG9ydCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSAm
aW50ZWxfZGlnX3BvcnQtPmhkbWk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGVu
Y29kZXItPnBvcnQ7Ci0JaW50IGxldmVsID0gaW50ZWxfZGRpX2hkbWlfbGV2ZWwoZGV2X3ByaXYs
IHBvcnQpOworCWludCBsZXZlbCA9IGludGVsX2RkaV9oZG1pX2xldmVsKGk5MTUsIHBvcnQpOwog
CXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZW5jX3RvX2RpZ19wb3J0KCZl
bmNvZGVyLT5iYXNlKTsKIAogCWludGVsX2RwX2R1YWxfbW9kZV9zZXRfdG1kc19vdXRwdXQoaW50
ZWxfaGRtaSwgdHJ1ZSk7CiAJaW50ZWxfZGRpX2Nsa19zZWxlY3QoZW5jb2RlciwgY3J0Y19zdGF0
ZSk7CiAKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgZGlnX3BvcnQtPmRkaV9p
b19wb3dlcl9kb21haW4pOworCWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGk5MTUsIGRpZ19wb3J0
LT5kZGlfaW9fcG93ZXJfZG9tYWluKTsKIAogCWljbF9wcm9ncmFtX21nX2RwX21vZGUoZGlnX3Bv
cnQpOwogCWljbF9kaXNhYmxlX3BoeV9jbG9ja19nYXRpbmcoZGlnX3BvcnQpOwogCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJ
aWNsX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywK
IAkJCQkJbGV2ZWwsIElOVEVMX09VVFBVVF9IRE1JKTsKLQllbHNlIGlmIChJU19DQU5OT05MQUtF
KGRldl9wcml2KSkKKwllbHNlIGlmIChJU19DQU5OT05MQUtFKGk5MTUpKQogCQljbmxfZGRpX3Zz
d2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgSU5URUxfT1VUUFVUX0hETUkpOwotCWVsc2Ug
aWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0dFTjlfTFAoaTkxNSkpCiAJ
CWJ4dF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxldmVsLCBJTlRFTF9PVVRQVVRfSERN
SSk7CiAJZWxzZQogCQlpbnRlbF9wcmVwYXJlX2hkbWlfZGRpX2J1ZmZlcnMoZW5jb2RlciwgbGV2
ZWwpOwogCiAJaWNsX2VuYWJsZV9waHlfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0KTsKIAotCWlmIChJ
U19HRU45X0JDKGRldl9wcml2KSkKKwlpZiAoSVNfR0VOOV9CQyhpOTE1KSkKIAkJc2tsX2RkaV9z
ZXRfaWJvb3N0KGVuY29kZXIsIGxldmVsLCBJTlRFTF9PVVRQVVRfSERNSSk7CiAKIAlpbnRlbF9k
ZGlfZW5hYmxlX3BpcGVfY2xvY2soY3J0Y19zdGF0ZSk7CkBAIC0zMjEzLDcgKzMyMTMsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUp
CiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKIAkv
KgpAQCAtMzIzMSwxMCArMzIzMSwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlX2VuYWJs
ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCVdBUk5fT04oY3J0Y19zdGF0ZS0+
aGFzX3BjaF9lbmNvZGVyKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCWljbF9tYXBfcGxsc190b19wb3J0cyhlbmNvZGVy
LCBjcnRjX3N0YXRlKTsKIAotCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmco
ZGV2X3ByaXYsIHBpcGUsIHRydWUpOworCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBv
cnRpbmcoaTkxNSwgcGlwZSwgdHJ1ZSk7CiAKIAlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRj
X3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpIHsKIAkJaW50ZWxfZGRpX3ByZV9lbmFibGVfaGRt
aShlbmNvZGVyLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKQEAgLTMyNTcsNyArMzI1Nyw3IEBA
IHN0YXRpYyB2b2lkIGludGVsX2RkaV9wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9kZGlfYnVmKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBv
cnQ7CiAJYm9vbCB3YWl0ID0gZmFsc2U7CiAJdTMyIHZhbDsKQEAgLTMyNzgsMTQgKzMyNzgsMTQg
QEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9kZGlfYnVmKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCWludGVsX2RkaV9kaXNhYmxlX2ZlY19zdGF0ZShlbmNvZGVyLCBjcnRjX3N0
YXRlKTsKIAogCWlmICh3YWl0KQotCQlpbnRlbF93YWl0X2RkaV9idWZfaWRsZShkZXZfcHJpdiwg
cG9ydCk7CisJCWludGVsX3dhaXRfZGRpX2J1Zl9pZGxlKGk5MTUsIHBvcnQpOwogfQogCiBzdGF0
aWMgdm9pZCBpbnRlbF9kZGlfcG9zdF9kaXNhYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0
Y19zdGF0ZSwKIAkJCQkgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xk
X2Nvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0
ICpkaWdfcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCA9ICZkaWdfcG9ydC0+ZHA7CiAJYm9vbCBpc19tc3QgPSBpbnRlbF9j
cnRjX2hhc190eXBlKG9sZF9jcnRjX3N0YXRlLApAQCAtMzMwNSw3ICszMzA1LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfZGRpX3Bvc3RfZGlzYWJsZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAlpbnRlbF9lZHBfcGFuZWxfdmRkX29uKGludGVsX2RwKTsKIAlpbnRlbF9lZHBfcGFu
ZWxfb2ZmKGludGVsX2RwKTsKIAotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tlZChk
ZXZfcHJpdiwKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF91bmNoZWNrZWQoaTkxNSwKIAkJCQkJ
ICBkaWdfcG9ydC0+ZGRpX2lvX3Bvd2VyX2RvbWFpbik7CiAKIAlpbnRlbF9kZGlfY2xrX2Rpc2Fi
bGUoZW5jb2Rlcik7CkBAIC0zMzE1LDcgKzMzMTUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlf
cG9zdF9kaXNhYmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCWNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJY29uc3Qg
c3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBlbmNfdG9fZGlnX3Bv
cnQoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1pID0gJmRp
Z19wb3J0LT5oZG1pOwogCkBAIC0zMzI2LDcgKzMzMjYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9k
ZGlfcG9zdF9kaXNhYmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlp
bnRlbF9kaXNhYmxlX2RkaV9idWYoZW5jb2Rlciwgb2xkX2NydGNfc3RhdGUpOwogCi0JaW50ZWxf
ZGlzcGxheV9wb3dlcl9wdXRfdW5jaGVja2VkKGRldl9wcml2LAorCWludGVsX2Rpc3BsYXlfcG93
ZXJfcHV0X3VuY2hlY2tlZChpOTE1LAogCQkJCQkgIGRpZ19wb3J0LT5kZGlfaW9fcG93ZXJfZG9t
YWluKTsKIAogCWludGVsX2RkaV9jbGtfZGlzYWJsZShlbmNvZGVyKTsKQEAgLTMzMzgsNyArMzMz
OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9wb3N0X2Rpc2FibGUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9s
ZF9jcnRjX3N0YXRlLAogCQkJCSAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpv
bGRfY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCiAJLyoKIAkgKiBXaGVuIGNhbGxlZCBm
cm9tIERQIE1TVCBjb2RlOgpAQCAtMzM2MCw3ICszMzYwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
ZGRpX3Bvc3RfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJaW50ZWxf
ZGRpX3Bvc3RfZGlzYWJsZV9kcChlbmNvZGVyLAogCQkJCQkgIG9sZF9jcnRjX3N0YXRlLCBvbGRf
Y29ubl9zdGF0ZSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlpZiAoSU5U
RUxfR0VOKGk5MTUpID49IDExKQogCQlpY2xfdW5tYXBfcGxsc190b19wb3J0cyhlbmNvZGVyKTsK
IH0KIApAQCAtMzM2OCw3ICszMzY4LDcgQEAgdm9pZCBpbnRlbF9kZGlfZmRpX3Bvc3RfZGlzYWJs
ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQljb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIHZhbDsKIAog
CS8qCkBAIC0zNDAyLDExICszNDAyLDExIEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9kZGlf
ZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9y
dCA9IGVuY29kZXItPnBvcnQ7CiAKLQlpZiAocG9ydCA9PSBQT1JUX0EgJiYgSU5URUxfR0VOKGRl
dl9wcml2KSA8IDkpCisJaWYgKHBvcnQgPT0gUE9SVF9BICYmIElOVEVMX0dFTihpOTE1KSA8IDkp
CiAJCWludGVsX2RwX3N0b3BfbGlua190cmFpbihpbnRlbF9kcCk7CiAKIAlpbnRlbF9lZHBfYmFj
a2xpZ2h0X29uKGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOwpAQCAtMzQxOSw3ICszNDE5LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX2RkaV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIH0KIAogc3RhdGljIGk5MTVfcmVnX3QKLWdlbjlfY2hpY2tlbl90cmFuc19yZWdfYnlf
cG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitnZW45X2NoaWNrZW5fdHJh
bnNfcmVnX2J5X3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAg
ZW51bSBwb3J0IHBvcnQpCiB7CiAJc3RhdGljIGNvbnN0IGk5MTVfcmVnX3QgcmVnc1tdID0gewpA
QCAtMzQzMCw3ICszNDMwLDcgQEAgZ2VuOV9jaGlja2VuX3RyYW5zX3JlZ19ieV9wb3J0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJW1BPUlRfRV0gPSBDSElDS0VOX1RSQU5T
X0EsCiAJfTsKIAotCVdBUk5fT04oSU5URUxfR0VOKGRldl9wcml2KSA8IDkpOworCVdBUk5fT04o
SU5URUxfR0VOKGk5MTUpIDwgOSk7CiAKIAlpZiAoV0FSTl9PTihwb3J0IDwgUE9SVF9BIHx8IHBv
cnQgPiBQT1JUX0UpKQogCQlwb3J0ID0gUE9SVF9BOwpAQCAtMzQ0Miw3ICszNDQyLDcgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZW5hYmxlX2RkaV9oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZW5jX3Rv
X2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVj
dG9yID0gY29ubl9zdGF0ZS0+Y29ubmVjdG9yOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+
cG9ydDsKQEAgLTM0NTQsMTQgKzM0NTQsMTQgQEAgc3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX2Rk
aV9oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICBjb25uZWN0b3ItPmJh
c2UuaWQsIGNvbm5lY3Rvci0+bmFtZSk7CiAKIAkvKiBEaXNwbGF5IFdBICMxMTQzOiBza2wsa2Js
LGNmbCAqLwotCWlmIChJU19HRU45X0JDKGRldl9wcml2KSkgeworCWlmIChJU19HRU45X0JDKGk5
MTUpKSB7CiAJCS8qCiAJCSAqIEZvciBzb21lIHJlYXNvbiB0aGVzZSBjaGlja2VuIGJpdHMgaGF2
ZSBiZWVuCiAJCSAqIHN0dWZmZWQgaW50byBhIHRyYW5zY29kZXIgcmVnaXN0ZXIsIGV2ZW50IHRo
b3VnaAogCQkgKiB0aGUgYml0cyBhZmZlY3QgYSBzcGVjaWZpYyBEREkgcG9ydCByYXRoZXIgdGhh
bgogCQkgKiBhIHNwZWNpZmljIHRyYW5zY29kZXIuCiAJCSAqLwotCQlpOTE1X3JlZ190IHJlZyA9
IGdlbjlfY2hpY2tlbl90cmFuc19yZWdfYnlfcG9ydChkZXZfcHJpdiwgcG9ydCk7CisJCWk5MTVf
cmVnX3QgcmVnID0gZ2VuOV9jaGlja2VuX3RyYW5zX3JlZ19ieV9wb3J0KGk5MTUsIHBvcnQpOwog
CQl1MzIgdmFsOwogCiAJCXZhbCA9IEk5MTVfUkVBRChyZWcpOwpAQCAtMzU5NSw5ICszNTk1LDkg
QEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX3NldF9maWFfbGFuZV9jb3VudChzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpw
aXBlX2NvbmZpZywKIAkJCQkJIGVudW0gcG9ydCBwb3J0KQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29k
ZXItPmJhc2UpOwotCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190YyhkZXZf
cHJpdiwgcG9ydCk7CisJZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0X3RvX3RjKGk5
MTUsIHBvcnQpOwogCXUzMiB2YWwgPSBJOTE1X1JFQUQoUE9SVF9UWF9ERkxFWERQTUxFMSk7CiAJ
Ym9vbCBsYW5lX3JldmVyc2FsID0gZGlnX3BvcnQtPnNhdmVkX3BvcnRfYml0cyAmIERESV9CVUZf
UE9SVF9SRVZFUlNBTDsKIApAQCAtMzYyNSwxNiArMzYyNSwxNiBAQCBpbnRlbF9kZGlfcHJlX3Bs
bF9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgY29uc3Qgc3RydWN0IGRybV9jb25u
ZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxf
ZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7
CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCiAJaWYgKGludGVsX2NydGNfaGFz
X2RwX2VuY29kZXIoY3J0Y19zdGF0ZSkgfHwKLQkgICAgaW50ZWxfcG9ydF9pc190YyhkZXZfcHJp
diwgZW5jb2Rlci0+cG9ydCkpCi0JCWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGRldl9wcml2LAor
CSAgICBpbnRlbF9wb3J0X2lzX3RjKGk5MTUsIGVuY29kZXItPnBvcnQpKQorCQlpbnRlbF9kaXNw
bGF5X3Bvd2VyX2dldChpOTE1LAogCQkJCQlpbnRlbF9kZGlfbWFpbl9saW5rX2F1eF9kb21haW4o
ZGlnX3BvcnQpKTsKIAotCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKKwlpZiAoSVNfR0VOOV9M
UChpOTE1KSkKIAkJYnh0X2RkaV9waHlfc2V0X2xhbmVfb3B0aW1fbWFzayhlbmNvZGVyLAogCQkJ
CQkJY3J0Y19zdGF0ZS0+bGFuZV9sYXRfb3B0aW1fbWFzayk7CiAKQEAgLTM2NTQsMTkgKzM2NTQs
MTkgQEAgaW50ZWxfZGRpX3Bvc3RfcGxsX2Rpc2FibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAkJCSAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBlbmNf
dG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpOwogCiAJaWYgKGludGVsX2NydGNfaGFzX2RwX2Vu
Y29kZXIoY3J0Y19zdGF0ZSkgfHwKLQkgICAgaW50ZWxfcG9ydF9pc190YyhkZXZfcHJpdiwgZW5j
b2Rlci0+cG9ydCkpCi0JCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tlZChkZXZfcHJp
diwKKwkgICAgaW50ZWxfcG9ydF9pc190YyhpOTE1LCBlbmNvZGVyLT5wb3J0KSkKKwkJaW50ZWxf
ZGlzcGxheV9wb3dlcl9wdXRfdW5jaGVja2VkKGk5MTUsCiAJCQkJCQkgIGludGVsX2RkaV9tYWlu
X2xpbmtfYXV4X2RvbWFpbihkaWdfcG9ydCkpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kZGlf
cHJlcGFyZV9saW5rX3JldHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGlu
dGVsX2RwKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJdG9faTkxNShpbnRlbF9kaWdfcG9ydC0+YmFzZS5i
YXNlLmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9kaWdfcG9ydC0+YmFzZS5wb3J0Owog
CXUzMiB2YWw7CkBAIC0zNjg3LDcgKzM2ODcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJl
cGFyZV9saW5rX3JldHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJUE9TVElOR19S
RUFEKERQX1RQX0NUTChwb3J0KSk7CiAKIAkJaWYgKHdhaXQpCi0JCQlpbnRlbF93YWl0X2RkaV9i
dWZfaWRsZShkZXZfcHJpdiwgcG9ydCk7CisJCQlpbnRlbF93YWl0X2RkaV9idWZfaWRsZShpOTE1
LCBwb3J0KTsKIAl9CiAKIAl2YWwgPSBEUF9UUF9DVExfRU5BQkxFIHwKQEAgLTM3MDksMzIgKzM3
MDksMzIgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX3ByZXBhcmVfbGlua19yZXRyYWluKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJdWRlbGF5KDYwMCk7CiB9CiAKLXN0YXRpYyBib29sIGlu
dGVsX2RkaV9pc19hdWRpb19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK3N0YXRpYyBib29sIGludGVsX2RkaV9pc19hdWRpb19lbmFibGVkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgICBlbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29k
ZXIpCiB7CiAJaWYgKGNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09ERVJfRURQKQogCQlyZXR1cm4g
ZmFsc2U7CiAKLQlpZiAoIWludGVsX2Rpc3BsYXlfcG93ZXJfaXNfZW5hYmxlZChkZXZfcHJpdiwg
UE9XRVJfRE9NQUlOX0FVRElPKSkKKwlpZiAoIWludGVsX2Rpc3BsYXlfcG93ZXJfaXNfZW5hYmxl
ZChpOTE1LCBQT1dFUl9ET01BSU5fQVVESU8pKQogCQlyZXR1cm4gZmFsc2U7CiAKIAlyZXR1cm4g
STkxNV9SRUFEKEhTV19BVURfUElOX0VMRF9DUF9WTEQpICYKIAkJQVVESU9fT1VUUFVUX0VOQUJM
RShjcHVfdHJhbnNjb2Rlcik7CiB9CiAKLXZvaWQgaW50ZWxfZGRpX2NvbXB1dGVfbWluX3ZvbHRh
Z2VfbGV2ZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9k
ZGlfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIGNydGNfc3RhdGUtPnBvcnRfY2xvY2sgPiA1OTQw
MDApCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSAmJiBjcnRjX3N0YXRlLT5wb3J0X2Nsb2Nr
ID4gNTk0MDAwKQogCQljcnRjX3N0YXRlLT5taW5fdm9sdGFnZV9sZXZlbCA9IDE7Ci0JZWxzZSBp
ZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikgJiYgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayA+IDU5
NDAwMCkKKwllbHNlIGlmIChJU19DQU5OT05MQUtFKGk5MTUpICYmIGNydGNfc3RhdGUtPnBvcnRf
Y2xvY2sgPiA1OTQwMDApCiAJCWNydGNfc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsID0gMjsKIH0K
IAogdm9pZCBpbnRlbF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKHBp
cGVfY29uZmlnLT5iYXNlLmNydGMpOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9
IHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlcjsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0
ICppbnRlbF9kaWdfcG9ydDsKQEAgLTM4MTYsMTAgKzM4MTYsMTAgQEAgdm9pZCBpbnRlbF9kZGlf
Z2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAl9CiAKIAlwaXBlX2Nv
bmZpZy0+aGFzX2F1ZGlvID0KLQkJaW50ZWxfZGRpX2lzX2F1ZGlvX2VuYWJsZWQoZGV2X3ByaXYs
IGNwdV90cmFuc2NvZGVyKTsKKwkJaW50ZWxfZGRpX2lzX2F1ZGlvX2VuYWJsZWQoaTkxNSwgY3B1
X3RyYW5zY29kZXIpOwogCi0JaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCAm
JiBkZXZfcHJpdi0+dmJ0LmVkcC5icHAgJiYKLQkgICAgcGlwZV9jb25maWctPnBpcGVfYnBwID4g
ZGV2X3ByaXYtPnZidC5lZHAuYnBwKSB7CisJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VU
UFVUX0VEUCAmJiBpOTE1LT52YnQuZWRwLmJwcCAmJgorCSAgICBwaXBlX2NvbmZpZy0+cGlwZV9i
cHAgPiBpOTE1LT52YnQuZWRwLmJwcCkgewogCQkvKgogCQkgKiBUaGlzIGlzIGEgYmlnIGZhdCB1
Z2x5IGhhY2suCiAJCSAqCkBAIC0zODM0LDE3ICszODM0LDE3IEBAIHZvaWQgaW50ZWxfZGRpX2dl
dF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCSAqIGxvYWQuCiAJCSAq
LwogCQlEUk1fREVCVUdfS01TKCJwaXBlIGhhcyAlZCBicHAgZm9yIGVEUCBwYW5lbCwgb3ZlcnJp
ZGluZyBCSU9TLXByb3ZpZGVkIG1heCAlZCBicHBcbiIsCi0JCQkgICAgICBwaXBlX2NvbmZpZy0+
cGlwZV9icHAsIGRldl9wcml2LT52YnQuZWRwLmJwcCk7Ci0JCWRldl9wcml2LT52YnQuZWRwLmJw
cCA9IHBpcGVfY29uZmlnLT5waXBlX2JwcDsKKwkJCSAgICAgIHBpcGVfY29uZmlnLT5waXBlX2Jw
cCwgaTkxNS0+dmJ0LmVkcC5icHApOworCQlpOTE1LT52YnQuZWRwLmJwcCA9IHBpcGVfY29uZmln
LT5waXBlX2JwcDsKIAl9CiAKIAlpbnRlbF9kZGlfY2xvY2tfZ2V0KGVuY29kZXIsIHBpcGVfY29u
ZmlnKTsKIAotCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKKwlpZiAoSVNfR0VOOV9MUChpOTE1
KSkKIAkJcGlwZV9jb25maWctPmxhbmVfbGF0X29wdGltX21hc2sgPQogCQkJYnh0X2RkaV9waHlf
Z2V0X2xhbmVfbGF0X29wdGltX21hc2soZW5jb2Rlcik7CiAKLQlpbnRlbF9kZGlfY29tcHV0ZV9t
aW5fdm9sdGFnZV9sZXZlbChkZXZfcHJpdiwgcGlwZV9jb25maWcpOworCWludGVsX2RkaV9jb21w
dXRlX21pbl92b2x0YWdlX2xldmVsKGk5MTUsIHBpcGVfY29uZmlnKTsKIAogCWludGVsX2hkbWlf
cmVhZF9nY3BfaW5mb2ZyYW1lKGVuY29kZXIsIHBpcGVfY29uZmlnKTsKIApAQCAtMzg4NSwxMSAr
Mzg4NSwxMSBAQCBzdGF0aWMgaW50IGludGVsX2RkaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUg
KmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJZW51bSBwb3J0IHBvcnQg
PSBlbmNvZGVyLT5wb3J0OwogCWludCByZXQ7CiAKLQlpZiAoSEFTX1RSQU5TQ09ERVJfRURQKGRl
dl9wcml2KSAmJiBwb3J0ID09IFBPUlRfQSkKKwlpZiAoSEFTX1RSQU5TQ09ERVJfRURQKGk5MTUp
ICYmIHBvcnQgPT0gUE9SVF9BKQogCQlwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIgPSBUUkFO
U0NPREVSX0VEUDsKIAogCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKHBpcGVfY29uZmlnLCBJTlRF
TF9PVVRQVVRfSERNSSkpCkBAIC0zODk5LDE3ICszODk5LDE3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
ZGRpX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWlmIChy
ZXQpCiAJCXJldHVybiByZXQ7CiAKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgJiYgY3J0Yy0+
cGlwZSA9PSBQSVBFX0EgJiYKKwlpZiAoSVNfSEFTV0VMTChpOTE1KSAmJiBjcnRjLT5waXBlID09
IFBJUEVfQSAmJgogCSAgICBwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIgPT0gVFJBTlNDT0RF
Ul9FRFApCiAJCXBpcGVfY29uZmlnLT5wY2hfcGZpdC5mb3JjZV90aHJ1ID0KIAkJCXBpcGVfY29u
ZmlnLT5wY2hfcGZpdC5lbmFibGVkIHx8CiAJCQlwaXBlX2NvbmZpZy0+Y3JjX2VuYWJsZWQ7CiAK
LQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCisJaWYgKElTX0dFTjlfTFAoaTkxNSkpCiAJCXBp
cGVfY29uZmlnLT5sYW5lX2xhdF9vcHRpbV9tYXNrID0KIAkJCWJ4dF9kZGlfcGh5X2NhbGNfbGFu
ZV9sYXRfb3B0aW1fbWFzayhwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCk7CiAKLQlpbnRlbF9kZGlf
Y29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChkZXZfcHJpdiwgcGlwZV9jb25maWcpOworCWludGVs
X2RkaV9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKGk5MTUsIHBpcGVfY29uZmlnKTsKIAogCXJl
dHVybiAwOwogfQpAQCAtNDAxMywxMSArNDAxMywxMSBAQCBzdGF0aWMgaW50IG1vZGVzZXRfcGlw
ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiBzdGF0aWMgaW50IGludGVsX2hkbWlfcmVzZXRfbGlu
ayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgc3RydWN0IGRybV9tb2Rlc2V0
X2FjcXVpcmVfY3R4ICpjdHgpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfaGRtaSAq
aGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IgPSBoZG1pLT5hdHRhY2hlZF9jb25uZWN0b3I7CiAJc3RydWN0
IGkyY19hZGFwdGVyICphZGFwdGVyID0KLQkJaW50ZWxfZ21idXNfZ2V0X2FkYXB0ZXIoZGV2X3By
aXYsIGhkbWktPmRkY19idXMpOworCQlpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihpOTE1LCBoZG1p
LT5kZGNfYnVzKTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsKIAlz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YzsKQEAgLTQwMjcsNyArNDAyNyw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfaGRtaV9yZXNldF9s
aW5rKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWlmICghY29ubmVjdG9yIHx8IGNv
bm5lY3Rvci0+YmFzZS5zdGF0dXMgIT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpCiAJCXJl
dHVybiAwOwogCi0JcmV0ID0gZHJtX21vZGVzZXRfbG9jaygmZGV2X3ByaXYtPmRybS5tb2RlX2Nv
bmZpZy5jb25uZWN0aW9uX211dGV4LAorCXJldCA9IGRybV9tb2Rlc2V0X2xvY2soJmk5MTUtPmRy
bS5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4LAogCQkJICAgICAgIGN0eCk7CiAJaWYgKHJl
dCkKIAkJcmV0dXJuIHJldDsKQEAgLTQxMzEsNyArNDEzMSw3IEBAIGludGVsX2RkaV9pbml0X2hk
bWlfY29ubmVjdG9yKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0KQog
CiBzdGF0aWMgYm9vbCBpbnRlbF9kZGlfYV9mb3JjZV80X2xhbmVzKHN0cnVjdCBpbnRlbF9kaWdp
dGFsX3BvcnQgKmRwb3J0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZHBvcnQtPmJhc2UuYmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShkcG9ydC0+YmFzZS5iYXNlLmRldik7CiAKIAlpZiAoZHBvcnQtPmJh
c2UucG9ydCAhPSBQT1JUX0EpCiAJCXJldHVybiBmYWxzZTsKQEAgLTQxNDIsNyArNDE0Miw3IEBA
IHN0YXRpYyBib29sIGludGVsX2RkaV9hX2ZvcmNlXzRfbGFuZXMoc3RydWN0IGludGVsX2RpZ2l0
YWxfcG9ydCAqZHBvcnQpCiAJLyogQnJveHRvbi9HZW1pbmlsYWtlOiBCc3BlYyBzYXlzIHRoYXQg
RERJX0FfNF9MQU5FUyBpcyB0aGUgb25seQogCSAqICAgICAgICAgICAgICAgICAgICAgc3VwcG9y
dGVkIGNvbmZpZ3VyYXRpb24KIAkgKi8KLQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCisJaWYg
KElTX0dFTjlfTFAoaTkxNSkpCiAJCXJldHVybiB0cnVlOwogCiAJLyogQ2Fubm9ubGFrZTogTW9z
dCBvZiBTS1VzIGRvbid0IHN1cHBvcnQgRERJX0UsIGFuZCB0aGUgb25seQpAQCAtNDE1MCw4ICs0
MTUwLDggQEAgc3RhdGljIGJvb2wgaW50ZWxfZGRpX2FfZm9yY2VfNF9sYW5lcyhzdHJ1Y3QgaW50
ZWxfZGlnaXRhbF9wb3J0ICpkcG9ydCkKIAkgKiAgICAgICAgICAgICBERElfRiB3aGF0IG1ha2Vz
IERESV9FIHVzZWxlc3MuIEhvd2V2ZXIgZm9yIHRoaXMKIAkgKiAgICAgICAgICAgICBjYXNlIGxl
dCdzIHRydXN0IFZCVCBpbmZvLgogCSAqLwotCWlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSAm
JgotCSAgICAhaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoZGV2X3ByaXYsIFBPUlRfRSkpCisJ
aWYgKElTX0NBTk5PTkxBS0UoaTkxNSkgJiYKKwkgICAgIWludGVsX2Jpb3NfaXNfcG9ydF9wcmVz
ZW50KGk5MTUsIFBPUlRfRSkpCiAJCXJldHVybiB0cnVlOwogCiAJcmV0dXJuIGZhbHNlOwpAQCAt
NDE2MCwxMSArNDE2MCwxMSBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kZGlfYV9mb3JjZV80X2xhbmVz
KHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRwb3J0KQogc3RhdGljIGludAogaW50ZWxfZGRp
X21heF9sYW5lcyhzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kcG9ydCkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2Rwb3J0LT5i
YXNlLmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
aW50ZWxfZHBvcnQtPmJhc2UuYmFzZS5kZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gaW50ZWxfZHBv
cnQtPmJhc2UucG9ydDsKIAlpbnQgbWF4X2xhbmVzID0gNDsKIAotCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDExKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCXJldHVybiBtYXhf
bGFuZXM7CiAKIAlpZiAocG9ydCA9PSBQT1JUX0EgfHwgcG9ydCA9PSBQT1JUX0UpIHsKQEAgLTQx
ODksMTAgKzQxODksMTAgQEAgaW50ZWxfZGRpX21heF9sYW5lcyhzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICppbnRlbF9kcG9ydCkKIAlyZXR1cm4gbWF4X2xhbmVzOwogfQogCi12b2lkIGludGVs
X2RkaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBv
cnQpCit2b2lkIGludGVsX2RkaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBl
bnVtIHBvcnQgcG9ydCkKIHsKIAlzdHJ1Y3QgZGRpX3ZidF9wb3J0X2luZm8gKnBvcnRfaW5mbyA9
Ci0JCSZkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CisJCSZpOTE1LT52YnQuZGRp
X3BvcnRfaW5mb1twb3J0XTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdf
cG9ydDsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlcjsKIAlzdHJ1Y3QgZHJt
X2VuY29kZXIgKmVuY29kZXI7CkBAIC00MjAyLDcgKzQyMDIsNyBAQCB2b2lkIGludGVsX2RkaV9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCiAJ
aW5pdF9oZG1pID0gcG9ydF9pbmZvLT5zdXBwb3J0c19kdmkgfHwgcG9ydF9pbmZvLT5zdXBwb3J0
c19oZG1pOwogCWluaXRfZHAgPSBwb3J0X2luZm8tPnN1cHBvcnRzX2RwOwogCi0JaWYgKGludGVs
X2Jpb3NfaXNfbHNwY29uX3ByZXNlbnQoZGV2X3ByaXYsIHBvcnQpKSB7CisJaWYgKGludGVsX2Jp
b3NfaXNfbHNwY29uX3ByZXNlbnQoaTkxNSwgcG9ydCkpIHsKIAkJLyoKIAkJICogTHNwY29uIGRl
dmljZSBuZWVkcyB0byBiZSBkcml2ZW4gd2l0aCBEUCBjb25uZWN0b3IKIAkJICogd2l0aCBzcGVj
aWFsIGRldGVjdGlvbiBzZXF1ZW5jZS4gU28gbWFrZSBzdXJlIERQCkBAIC00MjI3LDcgKzQyMjcs
NyBAQCB2b2lkIGludGVsX2RkaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgZW51bSBwb3J0IHBvcnQpCiAJaW50ZWxfZW5jb2RlciA9ICZpbnRlbF9kaWdfcG9ydC0+YmFz
ZTsKIAllbmNvZGVyID0gJmludGVsX2VuY29kZXItPmJhc2U7CiAKLQlkcm1fZW5jb2Rlcl9pbml0
KCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyLCAmaW50ZWxfZGRpX2Z1bmNzLAorCWRybV9lbmNvZGVy
X2luaXQoJmk5MTUtPmRybSwgZW5jb2RlciwgJmludGVsX2RkaV9mdW5jcywKIAkJCSBEUk1fTU9E
RV9FTkNPREVSX1RNRFMsICJEREkgJWMiLCBwb3J0X25hbWUocG9ydCkpOwogCiAJaW50ZWxfZW5j
b2Rlci0+aG90cGx1ZyA9IGludGVsX2RkaV9ob3RwbHVnOwpAQCAtNDI0OCwxMCArNDI0OCwxMCBA
QCB2b2lkIGludGVsX2RkaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
ZW51bSBwb3J0IHBvcnQpCiAJaW50ZWxfZW5jb2Rlci0+cG93ZXJfZG9tYWluID0gaW50ZWxfcG9y
dF90b19wb3dlcl9kb21haW4ocG9ydCk7CiAJaW50ZWxfZW5jb2Rlci0+cG9ydCA9IHBvcnQ7CiAJ
aW50ZWxfZW5jb2Rlci0+Y2xvbmVhYmxlID0gMDsKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBw
aXBlKQorCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkKIAkJaW50ZWxfZW5jb2Rlci0+Y3J0Y19t
YXNrIHw9IEJJVChwaXBlKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCWludGVsX2RpZ19wb3J0LT5zYXZlZF9wb3J0X2Jp
dHMgPSBJOTE1X1JFQUQoRERJX0JVRl9DVEwocG9ydCkpICYKIAkJCURESV9CVUZfUE9SVF9SRVZF
UlNBTDsKIAllbHNlCkBAIC00MjU5LDkgKzQyNTksOSBAQCB2b2lkIGludGVsX2RkaV9pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCiAJCQkoRERJ
X0JVRl9QT1JUX1JFVkVSU0FMIHwgRERJX0FfNF9MQU5FUyk7CiAJaW50ZWxfZGlnX3BvcnQtPmRw
Lm91dHB1dF9yZWcgPSBJTlZBTElEX01NSU9fUkVHOwogCWludGVsX2RpZ19wb3J0LT5tYXhfbGFu
ZXMgPSBpbnRlbF9kZGlfbWF4X2xhbmVzKGludGVsX2RpZ19wb3J0KTsKLQlpbnRlbF9kaWdfcG9y
dC0+YXV4X2NoID0gaW50ZWxfYmlvc19wb3J0X2F1eF9jaChkZXZfcHJpdiwgcG9ydCk7CisJaW50
ZWxfZGlnX3BvcnQtPmF1eF9jaCA9IGludGVsX2Jpb3NfcG9ydF9hdXhfY2goaTkxNSwgcG9ydCk7
CiAKLQlpbnRlbF9kaWdfcG9ydC0+dGNfbGVnYWN5X3BvcnQgPSBpbnRlbF9wb3J0X2lzX3RjKGRl
dl9wcml2LCBwb3J0KSAmJgorCWludGVsX2RpZ19wb3J0LT50Y19sZWdhY3lfcG9ydCA9IGludGVs
X3BvcnRfaXNfdGMoaTkxNSwgcG9ydCkgJiYKIAkJCQkJICFwb3J0X2luZm8tPnN1cHBvcnRzX3R5
cGVjX3VzYiAmJgogCQkJCQkgIXBvcnRfaW5mby0+c3VwcG9ydHNfdGJ0OwogCkBAIC00MzI0LDcg
KzQzMjQsNyBAQCB2b2lkIGludGVsX2RkaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCiAKIAlpbnRlbF9pbmZvZnJhbWVfaW5pdChpbnRlbF9k
aWdfcG9ydCk7CiAKLQlpZiAoaW50ZWxfcG9ydF9pc190YyhkZXZfcHJpdiwgcG9ydCkpCisJaWYg
KGludGVsX3BvcnRfaXNfdGMoaTkxNSwgcG9ydCkpCiAJCWludGVsX2RpZ2l0YWxfcG9ydF9jb25u
ZWN0ZWQoaW50ZWxfZW5jb2Rlcik7CiAKIAlyZXR1cm47CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9kZGkuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RkaS5o
CmluZGV4IGEwODM2NWRhMjY0My4uNTBkZDZmYWM0ZTNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9kZGkuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9k
ZGkuaApAQCAtMjQsNyArMjQsNyBAQCB2b2lkIGludGVsX2RkaV9mZGlfcG9zdF9kaXNhYmxlKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyLAogCQkJCWNvbnN0IHN0cnVjdCBkcm1f
Y29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSk7CiB2b2lkIGhzd19mZGlfbGlua190cmFp
bihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKTsKLXZvaWQgaW50ZWxfZGRpX2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCk7Cit2b2lkIGludGVsX2RkaV9pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9ydCk7CiBib29sIGludGVs
X2RkaV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGVudW0gcGlw
ZSAqcGlwZSk7CiB2b2lkIGludGVsX2RkaV9lbmFibGVfdHJhbnNjb2Rlcl9mdW5jKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHZvaWQgaW50ZWxfZGRpX2Rpc2Fi
bGVfdHJhbnNjb2Rlcl9mdW5jKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKTsKQEAgLTM2LDcgKzM2LDcgQEAgdm9pZCBpbnRlbF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBp
cGVfY29uZmlnKTsKIHZvaWQgaW50ZWxfZGRpX3NldF92Y19wYXlsb2FkX2FsbG9jKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICBib29sIHN0YXRlKTsK
LXZvaWQgaW50ZWxfZGRpX2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9kZGlfY29tcHV0ZV9taW5fdm9sdGFnZV9s
ZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJIHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHUzMiBieHRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKTsKIHUzMiBkZGlfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwKTsKQEAgLTQ2LDcgKzQ2LDcgQEAgdTggaW50ZWxfZGRpX2RwX3ByZV9lbXBoYXNp
c19tYXgoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiBpbnQgaW50ZWxfZGRpX3RvZ2ds
ZV9oZGNwX3NpZ25hbGxpbmcoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAJ
CQkJICAgICBib29sIGVuYWJsZSk7CiB2b2lkIGljbF9zYW5pdGl6ZV9lbmNvZGVyX3BsbF9tYXBw
aW5nKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKTsKLWludCBjbmxfY2FsY193cnBsbF9s
aW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludCBjbmxfY2FsY193cnBs
bF9saW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJc3RydWN0IGludGVsX2Rw
bGxfaHdfc3RhdGUgKnN0YXRlKTsKIAogI2VuZGlmIC8qIF9fSU5URUxfRERJX0hfXyAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmMKaW5kZXggNzEzNWQ4ZGMzMmE3Li5h
NjcwODgxYjNmMWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rldmlj
ZV9pbmZvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uYwpA
QCAtMTgyLDE1ICsxODIsMTUgQEAgc3RhdGljIHUxNiBjb21wdXRlX2V1X3RvdGFsKGNvbnN0IHN0
cnVjdCBzc2V1X2Rldl9pbmZvICpzc2V1KQogCXJldHVybiB0b3RhbDsKIH0KIAotc3RhdGljIHZv
aWQgZ2VuMTFfc3NldV9pbmZvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgZ2VuMTFfc3NldV9pbmZvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7Ci0Jc3RydWN0IHNzZXVfZGV2X2luZm8gKnNzZXUgPSAmUlVOVElNRV9JTkZP
KGRldl9wcml2KS0+c3NldTsKKwlzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSA9ICZSVU5USU1F
X0lORk8oaTkxNSktPnNzZXU7CiAJdTggc19lbjsKIAl1MzIgc3NfZW4sIHNzX2VuX21hc2s7CiAJ
dTggZXVfZW47CiAJaW50IHM7CiAKLQlpZiAoSVNfRUxLSEFSVExBS0UoZGV2X3ByaXYpKSB7CisJ
aWYgKElTX0VMS0hBUlRMQUtFKGk5MTUpKSB7CiAJCXNzZXUtPm1heF9zbGljZXMgPSAxOwogCQlz
c2V1LT5tYXhfc3Vic2xpY2VzID0gNDsKIAkJc3NldS0+bWF4X2V1c19wZXJfc3Vic2xpY2UgPSA4
OwpAQCAtMjI3LDkgKzIyNyw5IEBAIHN0YXRpYyB2b2lkIGdlbjExX3NzZXVfaW5mb19pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlzc2V1LT5oYXNfZXVfcGcgPSAxOwog
fQogCi1zdGF0aWMgdm9pZCBnZW4xMF9zc2V1X2luZm9faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW4xMF9zc2V1X2luZm9faW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSA9
ICZSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5zc2V1OworCXN0cnVjdCBzc2V1X2Rldl9pbmZvICpz
c2V1ID0gJlJVTlRJTUVfSU5GTyhpOTE1KS0+c3NldTsKIAljb25zdCB1MzIgZnVzZTIgPSBJOTE1
X1JFQUQoR0VOOF9GVVNFMik7CiAJaW50IHMsIHNzOwogCWNvbnN0IGludCBldV9tYXNrID0gMHhm
ZjsKQEAgLTMwNSw5ICszMDUsOSBAQCBzdGF0aWMgdm9pZCBnZW4xMF9zc2V1X2luZm9faW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJc3NldS0+aGFzX2V1X3BnID0gMTsK
IH0KIAotc3RhdGljIHZvaWQgY2hlcnJ5dmlld19zc2V1X2luZm9faW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBjaGVycnl2aWV3X3NzZXVfaW5mb19p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBzc2V1X2Rldl9p
bmZvICpzc2V1ID0gJlJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPnNzZXU7CisJc3RydWN0IHNzZXVf
ZGV2X2luZm8gKnNzZXUgPSAmUlVOVElNRV9JTkZPKGk5MTUpLT5zc2V1OwogCXUzMiBmdXNlOwog
CiAJZnVzZSA9IEk5MTVfUkVBRChDSFZfRlVTRV9HVCk7CkBAIC0zNTksMTAgKzM1OSwxMCBAQCBz
dGF0aWMgdm9pZCBjaGVycnl2aWV3X3NzZXVfaW5mb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlzc2V1LT5oYXNfZXVfcGcgPSAoc3NldS0+ZXVfcGVyX3N1YnNsaWNl
ID4gMik7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjlfc3NldV9pbmZvX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuOV9zc2V1X2luZm9faW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZGV2aWNlX2lu
Zm8gKmluZm8gPSBta3dyaXRlX2RldmljZV9pbmZvKGRldl9wcml2KTsKLQlzdHJ1Y3Qgc3NldV9k
ZXZfaW5mbyAqc3NldSA9ICZSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5zc2V1OworCXN0cnVjdCBp
bnRlbF9kZXZpY2VfaW5mbyAqaW5mbyA9IG1rd3JpdGVfZGV2aWNlX2luZm8oaTkxNSk7CisJc3Ry
dWN0IHNzZXVfZGV2X2luZm8gKnNzZXUgPSAmUlVOVElNRV9JTkZPKGk5MTUpLT5zc2V1OwogCWlu
dCBzLCBzczsKIAl1MzIgZnVzZTIsIGV1X2Rpc2FibGUsIHN1YnNsaWNlX21hc2s7CiAJY29uc3Qg
dTggZXVfbWFzayA9IDB4ZmY7CkBAIC0zNzEsOCArMzcxLDggQEAgc3RhdGljIHZvaWQgZ2VuOV9z
c2V1X2luZm9faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJc3NldS0+
c2xpY2VfbWFzayA9IChmdXNlMiAmIEdFTjhfRjJfU19FTkFfTUFTSykgPj4gR0VOOF9GMl9TX0VO
QV9TSElGVDsKIAogCS8qIEJYVCBoYXMgYSBzaW5nbGUgc2xpY2UgYW5kIGF0IG1vc3QgMyBzdWJz
bGljZXMuICovCi0Jc3NldS0+bWF4X3NsaWNlcyA9IElTX0dFTjlfTFAoZGV2X3ByaXYpID8gMSA6
IDM7Ci0Jc3NldS0+bWF4X3N1YnNsaWNlcyA9IElTX0dFTjlfTFAoZGV2X3ByaXYpID8gMyA6IDQ7
CisJc3NldS0+bWF4X3NsaWNlcyA9IElTX0dFTjlfTFAoaTkxNSkgPyAxIDogMzsKKwlzc2V1LT5t
YXhfc3Vic2xpY2VzID0gSVNfR0VOOV9MUChpOTE1KSA/IDMgOiA0OwogCXNzZXUtPm1heF9ldXNf
cGVyX3N1YnNsaWNlID0gODsKIAogCS8qCkBAIC00NDIsMTIgKzQ0MiwxMiBAQCBzdGF0aWMgdm9p
ZCBnZW45X3NzZXVfaW5mb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkgKiBwYWlyIHBlciBzdWJzbGljZS4KIAkqLwogCXNzZXUtPmhhc19zbGljZV9wZyA9Ci0JCSFJ
U19HRU45X0xQKGRldl9wcml2KSAmJiBod2VpZ2h0OChzc2V1LT5zbGljZV9tYXNrKSA+IDE7CisJ
CSFJU19HRU45X0xQKGk5MTUpICYmIGh3ZWlnaHQ4KHNzZXUtPnNsaWNlX21hc2spID4gMTsKIAlz
c2V1LT5oYXNfc3Vic2xpY2VfcGcgPQotCQlJU19HRU45X0xQKGRldl9wcml2KSAmJiBpbnRlbF9z
c2V1X3N1YnNsaWNlX3RvdGFsKHNzZXUpID4gMTsKKwkJSVNfR0VOOV9MUChpOTE1KSAmJiBpbnRl
bF9zc2V1X3N1YnNsaWNlX3RvdGFsKHNzZXUpID4gMTsKIAlzc2V1LT5oYXNfZXVfcGcgPSBzc2V1
LT5ldV9wZXJfc3Vic2xpY2UgPiAyOwogCi0JaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7CisJ
aWYgKElTX0dFTjlfTFAoaTkxNSkpIHsKICNkZWZpbmUgSVNfU1NfRElTQUJMRUQoc3MpCSghKHNz
ZXUtPnN1YnNsaWNlX21hc2tbMF0gJiBCSVQoc3MpKSkKIAkJaW5mby0+aGFzX3Bvb2xlZF9ldSA9
IGh3ZWlnaHQ4KHNzZXUtPnN1YnNsaWNlX21hc2tbMF0pID09IDM7CiAKQEAgLTQ2NCw5ICs0NjQs
OSBAQCBzdGF0aWMgdm9pZCBnZW45X3NzZXVfaW5mb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIGJyb2Fkd2VsbF9zc2V1X2luZm9f
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBicm9h
ZHdlbGxfc3NldV9pbmZvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0J
c3RydWN0IHNzZXVfZGV2X2luZm8gKnNzZXUgPSAmUlVOVElNRV9JTkZPKGRldl9wcml2KS0+c3Nl
dTsKKwlzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSA9ICZSVU5USU1FX0lORk8oaTkxNSktPnNz
ZXU7CiAJaW50IHMsIHNzOwogCXUzMiBmdXNlMiwgc3Vic2xpY2VfbWFzaywgZXVfZGlzYWJsZVsz
XTsgLyogc19tYXggKi8KIApAQCAtNTQ3LDkgKzU0Nyw5IEBAIHN0YXRpYyB2b2lkIGJyb2Fkd2Vs
bF9zc2V1X2luZm9faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJc3Nl
dS0+aGFzX2V1X3BnID0gMDsKIH0KIAotc3RhdGljIHZvaWQgaGFzd2VsbF9zc2V1X2luZm9faW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBoYXN3ZWxs
X3NzZXVfaW5mb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVj
dCBzc2V1X2Rldl9pbmZvICpzc2V1ID0gJlJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPnNzZXU7CisJ
c3RydWN0IHNzZXVfZGV2X2luZm8gKnNzZXUgPSAmUlVOVElNRV9JTkZPKGk5MTUpLT5zc2V1Owog
CXUzMiBmdXNlMTsKIAlpbnQgcywgc3M7CiAKQEAgLTU1Nyw5ICs1NTcsOSBAQCBzdGF0aWMgdm9p
ZCBoYXN3ZWxsX3NzZXVfaW5mb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkgKiBUaGVyZSBpc24ndCBhIHJlZ2lzdGVyIHRvIHRlbGwgdXMgaG93IG1hbnkgc2xpY2Vz
L3N1YnNsaWNlcy4gV2UKIAkgKiB3b3JrIG9mZiB0aGUgUENJLWlkcyBoZXJlLgogCSAqLwotCXN3
aXRjaCAoSU5URUxfSU5GTyhkZXZfcHJpdiktPmd0KSB7CisJc3dpdGNoIChJTlRFTF9JTkZPKGk5
MTUpLT5ndCkgewogCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShJTlRFTF9JTkZPKGRldl9wcml2
KS0+Z3QpOworCQlNSVNTSU5HX0NBU0UoSU5URUxfSU5GTyhpOTE1KS0+Z3QpOwogCQkvKiBmYWxs
IHRocm91Z2ggKi8KIAljYXNlIDE6CiAJCXNzZXUtPnNsaWNlX21hc2sgPSBCSVQoMCk7CkBAIC02
MTIsNyArNjEyLDcgQEAgc3RhdGljIHZvaWQgaGFzd2VsbF9zc2V1X2luZm9faW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJc3NldS0+aGFzX2V1X3BnID0gMDsKIH0KIAot
c3RhdGljIHUzMiByZWFkX3JlZmVyZW5jZV90c19mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK3N0YXRpYyB1MzIgcmVhZF9yZWZlcmVuY2VfdHNfZnJlcShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdHNfb3ZlcnJpZGUgPSBJOTE1X1JFQUQoR0VO
OV9USU1FU1RBTVBfT1ZFUlJJREUpOwogCXUzMiBiYXNlX2ZyZXEsIGZyYWNfZnJlcTsKQEAgLTYy
OSw3ICs2MjksNyBAQCBzdGF0aWMgdTMyIHJlYWRfcmVmZXJlbmNlX3RzX2ZyZXEoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBiYXNlX2ZyZXEgKyBmcmFjX2ZyZXE7
CiB9CiAKLXN0YXRpYyB1MzIgZ2VuMTBfZ2V0X2NyeXN0YWxfY2xvY2tfZnJlcShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdTMyIGdlbjEwX2dldF9jcnlzdGFsX2Ns
b2NrX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCXUzMiBycG1fY29u
ZmlnX3JlZykKIHsKIAl1MzIgZjE5XzJfbWh6ID0gMTkyMDA7CkBAIC02NDksNyArNjQ5LDcgQEAg
c3RhdGljIHUzMiBnZW4xMF9nZXRfY3J5c3RhbF9jbG9ja19mcmVxKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAl9CiB9CiAKLXN0YXRpYyB1MzIgZ2VuMTFfZ2V0X2NyeXN0YWxf
Y2xvY2tfZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdTMy
IGdlbjExX2dldF9jcnlzdGFsX2Nsb2NrX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJCXUzMiBycG1fY29uZmlnX3JlZykKIHsKIAl1MzIgZjE5XzJfbWh6ID0gMTkyMDA7
CkBAIC02NzUsMjEgKzY3NSwyMSBAQCBzdGF0aWMgdTMyIGdlbjExX2dldF9jcnlzdGFsX2Nsb2Nr
X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0KIAotc3RhdGlj
IHUzMiByZWFkX3RpbWVzdGFtcF9mcmVxdWVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIHUzMiByZWFkX3RpbWVzdGFtcF9mcmVxdWVuY3koc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGYxMl81X21oeiA9IDEyNTAwOwogCXUzMiBmMTlf
Ml9taHogPSAxOTIwMDsKIAl1MzIgZjI0X21oeiA9IDI0MDAwOwogCi0JaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPD0gNCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPD0gNCkgewogCQkvKiBQUk1z
IHNheToKIAkJICoKIAkJICogICAgICJUaGUgdmFsdWUgaW4gdGhpcyByZWdpc3RlciBpbmNyZW1l
bnRzIG9uY2UgZXZlcnkgMTYKIAkJICogICAgICBoY2xrcy4iICh0aHJvdWdoIHRoZSDigJxDbG9j
a2luZyBDb25maWd1cmF0aW9u4oCdCiAJCSAqICAgICAgKOKAnENMS0NGR+KAnSkgTUNIQkFSIHJl
Z2lzdGVyKQogCQkgKi8KLQkJcmV0dXJuIGRldl9wcml2LT5yYXdjbGtfZnJlcSAvIDE2OwotCX0g
ZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8PSA4KSB7CisJCXJldHVybiBpOTE1LT5yYXdj
bGtfZnJlcSAvIDE2OworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpIDw9IDgpIHsKIAkJLyog
UFJNcyBzYXk6CiAJCSAqCiAJCSAqICAgICAiVGhlIFBDVSBUU0MgY291bnRzIDEwbnMgaW5jcmVt
ZW50czsgdGhpcyB0aW1lc3RhbXAKQEAgLTY5NywxNCArNjk3LDE0IEBAIHN0YXRpYyB1MzIgcmVh
ZF90aW1lc3RhbXBfZnJlcXVlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJICogICAgICByb2xsaW5nIG92ZXIgZXZlcnkgMS41IGhvdXJzKS4KIAkJICovCiAJCXJldHVy
biBmMTJfNV9taHo7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDkpIHsKKwl9
IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA8PSA5KSB7CiAJCXUzMiBjdGNfcmVnID0gSTkxNV9S
RUFEKENUQ19NT0RFKTsKIAkJdTMyIGZyZXEgPSAwOwogCiAJCWlmICgoY3RjX3JlZyAmIENUQ19T
T1VSQ0VfUEFSQU1FVEVSX01BU0spID09IENUQ19TT1VSQ0VfRElWSURFX0xPR0lDKSB7Ci0JCQlm
cmVxID0gcmVhZF9yZWZlcmVuY2VfdHNfZnJlcShkZXZfcHJpdik7CisJCQlmcmVxID0gcmVhZF9y
ZWZlcmVuY2VfdHNfZnJlcShpOTE1KTsKIAkJfSBlbHNlIHsKLQkJCWZyZXEgPSBJU19HRU45X0xQ
KGRldl9wcml2KSA/IGYxOV8yX21oeiA6IGYyNF9taHo7CisJCQlmcmVxID0gSVNfR0VOOV9MUChp
OTE1KSA/IGYxOV8yX21oeiA6IGYyNF9taHo7CiAKIAkJCS8qIE5vdyBmaWd1cmUgb3V0IGhvdyB0
aGUgY29tbWFuZCBzdHJlYW0ncyB0aW1lc3RhbXAKIAkJCSAqIHJlZ2lzdGVyIGluY3JlbWVudHMg
ZnJvbSB0aGlzIGZyZXF1ZW5jeSAoaXQgbWlnaHQKQEAgLTcxNSw3ICs3MTUsNyBAQCBzdGF0aWMg
dTMyIHJlYWRfdGltZXN0YW1wX2ZyZXF1ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJCX0KIAogCQlyZXR1cm4gZnJlcTsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPD0gMTEpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA8PSAxMSkgewogCQl1
MzIgY3RjX3JlZyA9IEk5MTVfUkVBRChDVENfTU9ERSk7CiAJCXUzMiBmcmVxID0gMDsKIApAQCAt
NzI1LDE1ICs3MjUsMTUgQEAgc3RhdGljIHUzMiByZWFkX3RpbWVzdGFtcF9mcmVxdWVuY3koc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgKiB0ZWxscyB1cyB3aGljaCBvbmUg
d2Ugc2hvdWxkIHVzZS4KIAkJICovCiAJCWlmICgoY3RjX3JlZyAmIENUQ19TT1VSQ0VfUEFSQU1F
VEVSX01BU0spID09IENUQ19TT1VSQ0VfRElWSURFX0xPR0lDKSB7Ci0JCQlmcmVxID0gcmVhZF9y
ZWZlcmVuY2VfdHNfZnJlcShkZXZfcHJpdik7CisJCQlmcmVxID0gcmVhZF9yZWZlcmVuY2VfdHNf
ZnJlcShpOTE1KTsKIAkJfSBlbHNlIHsKIAkJCXUzMiBycG1fY29uZmlnX3JlZyA9IEk5MTVfUkVB
RChSUE1fQ09ORklHMCk7CiAKLQkJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDEwKQotCQkJ
CWZyZXEgPSBnZW4xMF9nZXRfY3J5c3RhbF9jbG9ja19mcmVxKGRldl9wcml2LAorCQkJaWYgKElO
VEVMX0dFTihpOTE1KSA8PSAxMCkKKwkJCQlmcmVxID0gZ2VuMTBfZ2V0X2NyeXN0YWxfY2xvY2tf
ZnJlcShpOTE1LAogCQkJCQkJCQlycG1fY29uZmlnX3JlZyk7CiAJCQllbHNlCi0JCQkJZnJlcSA9
IGdlbjExX2dldF9jcnlzdGFsX2Nsb2NrX2ZyZXEoZGV2X3ByaXYsCisJCQkJZnJlcSA9IGdlbjEx
X2dldF9jcnlzdGFsX2Nsb2NrX2ZyZXEoaTkxNSwKIAkJCQkJCQkJcnBtX2NvbmZpZ19yZWcpOwog
CiAJCQkvKiBOb3cgZmlndXJlIG91dCBob3cgdGhlIGNvbW1hbmQgc3RyZWFtJ3MgdGltZXN0YW1w
CkBAIC04NDEsNyArODQxLDcgQEAgdm9pZCBpbnRlbF9kZXZpY2VfaW5mb19zdWJwbGF0Zm9ybV9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAvKioKICAqIGludGVsX2Rldmlj
ZV9pbmZvX3J1bnRpbWVfaW5pdCAtIGluaXRpYWxpemUgcnVudGltZSBpbmZvCi0gKiBAZGV2X3By
aXY6IHRoZSBpOTE1IGRldmljZQorICogQGk5MTU6IHRoZSBpOTE1IGRldmljZQogICoKICAqIERl
dGVybWluZSB2YXJpb3VzIGludGVsX2RldmljZV9pbmZvIGZpZWxkcyBhdCBydW50aW1lLgogICoK
QEAgLTg1NSwxNiArODU1LDE2IEBAIHZvaWQgaW50ZWxfZGV2aWNlX2luZm9fc3VicGxhdGZvcm1f
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKICAqICAgLSBhZnRlciB0aGUgUENI
IGhhcyBiZWVuIGRldGVjdGVkLAogICogICAtIGJlZm9yZSB0aGUgZmlyc3QgdXNhZ2Ugb2YgdGhl
IGZpZWxkcyBpdCBjYW4gdHdlYWsuCiAgKi8KLXZvaWQgaW50ZWxfZGV2aWNlX2luZm9fcnVudGlt
ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfZGV2
aWNlX2luZm9fcnVudGltZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyAqaW5mbyA9IG1rd3JpdGVfZGV2aWNlX2luZm8oZGV2
X3ByaXYpOwotCXN0cnVjdCBpbnRlbF9ydW50aW1lX2luZm8gKnJ1bnRpbWUgPSBSVU5USU1FX0lO
Rk8oZGV2X3ByaXYpOworCXN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyAqaW5mbyA9IG1rd3JpdGVf
ZGV2aWNlX2luZm8oaTkxNSk7CisJc3RydWN0IGludGVsX3J1bnRpbWVfaW5mbyAqcnVudGltZSA9
IFJVTlRJTUVfSU5GTyhpOTE1KTsKIAllbnVtIHBpcGUgcGlwZTsKIAotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDEwKSB7Ci0JCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpCisJaWYg
KElOVEVMX0dFTihpOTE1KSA+PSAxMCkgeworCQlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCiAJ
CQlydW50aW1lLT5udW1fc2NhbGVyc1twaXBlXSA9IDI7Ci0JfSBlbHNlIGlmIChJU19HRU4oZGV2
X3ByaXYsIDkpKSB7CisJfSBlbHNlIGlmIChJU19HRU4oaTkxNSwgOSkpIHsKIAkJcnVudGltZS0+
bnVtX3NjYWxlcnNbUElQRV9BXSA9IDI7CiAJCXJ1bnRpbWUtPm51bV9zY2FsZXJzW1BJUEVfQl0g
PSAyOwogCQlydW50aW1lLT5udW1fc2NhbGVyc1tQSVBFX0NdID0gMTsKQEAgLTg3MiwxMyArODcy
LDEzIEBAIHZvaWQgaW50ZWxfZGV2aWNlX2luZm9fcnVudGltZV9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAogCUJVSUxEX0JVR19PTihCSVRTX1BFUl9UWVBFKGludGVs
X2VuZ2luZV9tYXNrX3QpIDwgSTkxNV9OVU1fRU5HSU5FUyk7CiAKLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMSkKLQkJZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkKKwlpZiAoSU5U
RUxfR0VOKGk5MTUpID49IDExKQorCQlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCiAJCQlydW50
aW1lLT5udW1fc3ByaXRlc1twaXBlXSA9IDY7Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCAx
MCkgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCi0JCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYs
IHBpcGUpCisJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDEwKSB8fCBJU19HRU1JTklMQUtFKGk5MTUp
KQorCQlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpCiAJCQlydW50aW1lLT5udW1fc3ByaXRlc1tw
aXBlXSA9IDM7Ci0JZWxzZSBpZiAoSVNfQlJPWFRPTihkZXZfcHJpdikpIHsKKwllbHNlIGlmIChJ
U19CUk9YVE9OKGk5MTUpKSB7CiAJCS8qCiAJCSAqIFNreWxha2UgYW5kIEJyb3h0b24gY3VycmVu
dGx5IGRvbid0IGV4cG9zZSB0aGUgdG9wbW9zdCBwbGFuZSBhcyBpdHMKIAkJICogdXNlIGlzIGV4
Y2x1c2l2ZSB3aXRoIHRoZSBsZWdhY3kgY3Vyc29yIGFuZCB3ZSBvbmx5IHdhbnQgdG8gZXhwb3Nl
CkBAIC04OTEsMjAgKzg5MSwyMCBAQCB2b2lkIGludGVsX2RldmljZV9pbmZvX3J1bnRpbWVfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCXJ1bnRpbWUtPm51bV9zcHJp
dGVzW1BJUEVfQV0gPSAyOwogCQlydW50aW1lLT5udW1fc3ByaXRlc1tQSVBFX0JdID0gMjsKIAkJ
cnVudGltZS0+bnVtX3Nwcml0ZXNbUElQRV9DXSA9IDE7Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlW
SUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgewotCQlmb3JfZWFjaF9w
aXBlKGRldl9wcml2LCBwaXBlKQorCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJ
U19DSEVSUllWSUVXKGk5MTUpKSB7CisJCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkKIAkJCXJ1
bnRpbWUtPm51bV9zcHJpdGVzW3BpcGVdID0gMjsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gNSB8fCBJU19HNFgoZGV2X3ByaXYpKSB7Ci0JCWZvcl9lYWNoX3BpcGUoZGV2X3By
aXYsIHBpcGUpCisJfSBlbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSB8fCBJU19HNFgoaTkx
NSkpIHsKKwkJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKQogCQkJcnVudGltZS0+bnVtX3Nwcml0
ZXNbcGlwZV0gPSAxOwogCX0KIAogCWlmIChpOTE1X21vZHBhcmFtcy5kaXNhYmxlX2Rpc3BsYXkp
IHsKIAkJRFJNX0lORk8oIkRpc3BsYXkgZGlzYWJsZWQgKG1vZHVsZSBwYXJhbWV0ZXIpXG4iKTsK
IAkJaW5mby0+bnVtX3BpcGVzID0gMDsKLQl9IGVsc2UgaWYgKEhBU19ESVNQTEFZKGRldl9wcml2
KSAmJgotCQkgICAoSVNfR0VOX1JBTkdFKGRldl9wcml2LCA3LCA4KSkgJiYKLQkJICAgSEFTX1BD
SF9TUExJVChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKEhBU19ESVNQTEFZKGk5MTUpICYmCisJ
CSAgIChJU19HRU5fUkFOR0UoaTkxNSwgNywgOCkpICYmCisJCSAgIEhBU19QQ0hfU1BMSVQoaTkx
NSkpIHsKIAkJdTMyIGZ1c2Vfc3RyYXAgPSBJOTE1X1JFQUQoRlVTRV9TVFJBUCk7CiAJCXUzMiBz
ZnVzZV9zdHJhcCA9IEk5MTVfUkVBRChTRlVTRV9TVFJBUCk7CiAKQEAgLTkxOSw3ICs5MTksNyBA
QCB2b2lkIGludGVsX2RldmljZV9pbmZvX3J1bnRpbWVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJCSAqLwogCQlpZiAoZnVzZV9zdHJhcCAmIElMS19JTlRFUk5BTF9E
SVNQTEFZX0RJU0FCTEUgfHwKIAkJICAgIHNmdXNlX3N0cmFwICYgU0ZVU0VfU1RSQVBfRElTUExB
WV9ESVNBQkxFRCB8fAotCQkgICAgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSAmJgorCQkgICAgKEhB
U19QQ0hfQ1BUKGk5MTUpICYmCiAJCSAgICAgIShzZnVzZV9zdHJhcCAmIFNGVVNFX1NUUkFQX0ZV
U0VfTE9DSykpKSB7CiAJCQlEUk1fSU5GTygiRGlzcGxheSBmdXNlZCBvZmYsIGRpc2FibGluZ1xu
Iik7CiAJCQlpbmZvLT5udW1fcGlwZXMgPSAwOwpAQCAtOTI3LDcgKzkyNyw3IEBAIHZvaWQgaW50
ZWxfZGV2aWNlX2luZm9fcnVudGltZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJCURSTV9JTkZPKCJQaXBlQyBmdXNlZCBvZmZcbiIpOwogCQkJaW5mby0+bnVtX3Bp
cGVzIC09IDE7CiAJCX0KLQl9IGVsc2UgaWYgKEhBU19ESVNQTEFZKGRldl9wcml2KSAmJiBJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDkpIHsKKwl9IGVsc2UgaWYgKEhBU19ESVNQTEFZKGk5MTUpICYm
IElOVEVMX0dFTihpOTE1KSA+PSA5KSB7CiAJCXUzMiBkZnNtID0gSTkxNV9SRUFEKFNLTF9ERlNN
KTsKIAkJdTggZGlzYWJsZWRfbWFzayA9IDA7CiAJCWJvb2wgaW52YWxpZDsKQEAgLTk2MSwyNiAr
OTYxLDI2IEBAIHZvaWQgaW50ZWxfZGV2aWNlX2luZm9fcnVudGltZV9pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiAKIAkvKiBJbml0aWFsaXplIHNsaWNlL3N1YnNs
aWNlL0VVIGluZm8gKi8KLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikpCi0JCWhhc3dlbGxfc3Nl
dV9pbmZvX2luaXQoZGV2X3ByaXYpOwotCWVsc2UgaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYp
KQotCQljaGVycnl2aWV3X3NzZXVfaW5mb19pbml0KGRldl9wcml2KTsKLQllbHNlIGlmIChJU19C
Uk9BRFdFTEwoZGV2X3ByaXYpKQotCQlicm9hZHdlbGxfc3NldV9pbmZvX2luaXQoZGV2X3ByaXYp
OwotCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgOSkpCi0JCWdlbjlfc3NldV9pbmZvX2luaXQo
ZGV2X3ByaXYpOwotCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgMTApKQotCQlnZW4xMF9zc2V1
X2luZm9faW5pdChkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MSkKLQkJZ2VuMTFfc3NldV9pbmZvX2luaXQoZGV2X3ByaXYpOwotCi0JaWYgKElTX0dFTihkZXZf
cHJpdiwgNikgJiYgaW50ZWxfdnRkX2FjdGl2ZSgpKSB7CisJaWYgKElTX0hBU1dFTEwoaTkxNSkp
CisJCWhhc3dlbGxfc3NldV9pbmZvX2luaXQoaTkxNSk7CisJZWxzZSBpZiAoSVNfQ0hFUlJZVklF
VyhpOTE1KSkKKwkJY2hlcnJ5dmlld19zc2V1X2luZm9faW5pdChpOTE1KTsKKwllbHNlIGlmIChJ
U19CUk9BRFdFTEwoaTkxNSkpCisJCWJyb2Fkd2VsbF9zc2V1X2luZm9faW5pdChpOTE1KTsKKwll
bHNlIGlmIChJU19HRU4oaTkxNSwgOSkpCisJCWdlbjlfc3NldV9pbmZvX2luaXQoaTkxNSk7CisJ
ZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDEwKSkKKwkJZ2VuMTBfc3NldV9pbmZvX2luaXQoaTkxNSk7
CisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQorCQlnZW4xMV9zc2V1X2luZm9faW5p
dChpOTE1KTsKKworCWlmIChJU19HRU4oaTkxNSwgNikgJiYgaW50ZWxfdnRkX2FjdGl2ZSgpKSB7
CiAJCURSTV9JTkZPKCJEaXNhYmxpbmcgcHBHVFQgZm9yIFZULWQgc3VwcG9ydFxuIik7CiAJCWlu
Zm8tPnBwZ3R0X3R5cGUgPSBJTlRFTF9QUEdUVF9OT05FOwogCX0KIAogCS8qIEluaXRpYWxpemUg
Y29tbWFuZCBzdHJlYW0gdGltZXN0YW1wIGZyZXF1ZW5jeSAqLwotCXJ1bnRpbWUtPmNzX3RpbWVz
dGFtcF9mcmVxdWVuY3lfa2h6ID0gcmVhZF90aW1lc3RhbXBfZnJlcXVlbmN5KGRldl9wcml2KTsK
KwlydW50aW1lLT5jc190aW1lc3RhbXBfZnJlcXVlbmN5X2toeiA9IHJlYWRfdGltZXN0YW1wX2Zy
ZXF1ZW5jeShpOTE1KTsKIH0KIAogdm9pZCBpbnRlbF9kcml2ZXJfY2Fwc19wcmludChjb25zdCBz
dHJ1Y3QgaW50ZWxfZHJpdmVyX2NhcHMgKmNhcHMsCkBAIC05OTcsMTYgKzk5NywxNiBAQCB2b2lk
IGludGVsX2RyaXZlcl9jYXBzX3ByaW50KGNvbnN0IHN0cnVjdCBpbnRlbF9kcml2ZXJfY2FwcyAq
Y2FwcywKICAqIHRoaXMgcG9pbnQgKGJ1dCBsYXRlciB3ZSBuZWVkIHRvIHBydW5lIHRoZSBmb3Jj
ZXdha2UgZG9tYWlucyBmb3IgZW5naW5lcyB0aGF0CiAgKiBhcmUgaW5kZWVkIGZ1c2VkIG9mZiku
CiAgKi8KLXZvaWQgaW50ZWxfZGV2aWNlX2luZm9faW5pdF9tbWlvKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfZGV2aWNlX2luZm9faW5pdF9tbWlvKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyAq
aW5mbyA9IG1rd3JpdGVfZGV2aWNlX2luZm8oZGV2X3ByaXYpOworCXN0cnVjdCBpbnRlbF9kZXZp
Y2VfaW5mbyAqaW5mbyA9IG1rd3JpdGVfZGV2aWNlX2luZm8oaTkxNSk7CiAJdW5zaWduZWQgaW50
IGxvZ2ljYWxfdmRib3ggPSAwOwogCXVuc2lnbmVkIGludCBpOwogCXUzMiBtZWRpYV9mdXNlOwog
CXUxNiB2ZGJveF9tYXNrOwogCXUxNiB2ZWJveF9tYXNrOwogCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPCAxMSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgMTEpCiAJCXJldHVybjsKIAogCW1l
ZGlhX2Z1c2UgPSB+STkxNV9SRUFEKEdFTjExX0dUX1ZFQk9YX1ZEQk9YX0RJU0FCTEUpOwpAQCAt
MTAxNiw3ICsxMDE2LDcgQEAgdm9pZCBpbnRlbF9kZXZpY2VfaW5mb19pbml0X21taW8oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgICAgICBHRU4xMV9HVF9WRUJPWF9ESVNB
QkxFX1NISUZUOwogCiAJZm9yIChpID0gMDsgaSA8IEk5MTVfTUFYX1ZDUzsgaSsrKSB7Ci0JCWlm
ICghSEFTX0VOR0lORShkZXZfcHJpdiwgX1ZDUyhpKSkpCisJCWlmICghSEFTX0VOR0lORShpOTE1
LCBfVkNTKGkpKSkKIAkJCWNvbnRpbnVlOwogCiAJCWlmICghKEJJVChpKSAmIHZkYm94X21hc2sp
KSB7CkBAIC0xMDMwLDE0ICsxMDMwLDE0IEBAIHZvaWQgaW50ZWxfZGV2aWNlX2luZm9faW5pdF9t
bWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICogaG9va2VkIHVwIHRv
IGFuIFNGQyAoU2NhbGVyICYgRm9ybWF0IENvbnZlcnRlcikgdW5pdC4KIAkJICovCiAJCWlmIChs
b2dpY2FsX3ZkYm94KysgJSAyID09IDApCi0JCQlSVU5USU1FX0lORk8oZGV2X3ByaXYpLT52ZGJv
eF9zZmNfYWNjZXNzIHw9IEJJVChpKTsKKwkJCVJVTlRJTUVfSU5GTyhpOTE1KS0+dmRib3hfc2Zj
X2FjY2VzcyB8PSBCSVQoaSk7CiAJfQogCURSTV9ERUJVR19EUklWRVIoInZkYm94IGVuYWJsZTog
JTA0eCwgaW5zdGFuY2VzOiAlMDRseFxuIiwKLQkJCSB2ZGJveF9tYXNrLCBWREJPWF9NQVNLKGRl
dl9wcml2KSk7Ci0JR0VNX0JVR19PTih2ZGJveF9tYXNrICE9IFZEQk9YX01BU0soZGV2X3ByaXYp
KTsKKwkJCSB2ZGJveF9tYXNrLCBWREJPWF9NQVNLKGk5MTUpKTsKKwlHRU1fQlVHX09OKHZkYm94
X21hc2sgIT0gVkRCT1hfTUFTSyhpOTE1KSk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhf
VkVDUzsgaSsrKSB7Ci0JCWlmICghSEFTX0VOR0lORShkZXZfcHJpdiwgX1ZFQ1MoaSkpKQorCQlp
ZiAoIUhBU19FTkdJTkUoaTkxNSwgX1ZFQ1MoaSkpKQogCQkJY29udGludWU7CiAKIAkJaWYgKCEo
QklUKGkpICYgdmVib3hfbWFzaykpIHsKQEAgLTEwNDYsNiArMTA0Niw2IEBAIHZvaWQgaW50ZWxf
ZGV2aWNlX2luZm9faW5pdF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJfQogCX0KIAlEUk1fREVCVUdfRFJJVkVSKCJ2ZWJveCBlbmFibGU6ICUwNHgsIGluc3RhbmNl
czogJTA0bHhcbiIsCi0JCQkgdmVib3hfbWFzaywgVkVCT1hfTUFTSyhkZXZfcHJpdikpOwotCUdF
TV9CVUdfT04odmVib3hfbWFzayAhPSBWRUJPWF9NQVNLKGRldl9wcml2KSk7CisJCQkgdmVib3hf
bWFzaywgVkVCT1hfTUFTSyhpOTE1KSk7CisJR0VNX0JVR19PTih2ZWJveF9tYXNrICE9IFZFQk9Y
X01BU0soaTkxNSkpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
ZGV2aWNlX2luZm8uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmgK
aW5kZXggM2VhOTUzYTIzMGIzLi45M2U1Y2M5NWU1YzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZGV2aWNlX2luZm8uaApAQCAtMjE4LDggKzIxOCw4IEBAIHN0cnVjdCBpbnRlbF9kcml2
ZXJfY2FwcyB7CiAKIGNvbnN0IGNoYXIgKmludGVsX3BsYXRmb3JtX25hbWUoZW51bSBpbnRlbF9w
bGF0Zm9ybSBwbGF0Zm9ybSk7CiAKLXZvaWQgaW50ZWxfZGV2aWNlX2luZm9fc3VicGxhdGZvcm1f
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9kZXZp
Y2VfaW5mb19ydW50aW1lX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsK
K3ZvaWQgaW50ZWxfZGV2aWNlX2luZm9fc3VicGxhdGZvcm1faW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2RldmljZV9pbmZvX3J1bnRpbWVfaW5pdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGludGVsX2RldmljZV9pbmZvX2R1bXBf
ZmxhZ3MoY29uc3Qgc3RydWN0IGludGVsX2RldmljZV9pbmZvICppbmZvLAogCQkJCSAgc3RydWN0
IGRybV9wcmludGVyICpwKTsKIHZvaWQgaW50ZWxfZGV2aWNlX2luZm9fZHVtcF9ydW50aW1lKGNv
bnN0IHN0cnVjdCBpbnRlbF9ydW50aW1lX2luZm8gKmluZm8sCkBAIC0yMjcsNyArMjI3LDcgQEAg
dm9pZCBpbnRlbF9kZXZpY2VfaW5mb19kdW1wX3J1bnRpbWUoY29uc3Qgc3RydWN0IGludGVsX3J1
bnRpbWVfaW5mbyAqaW5mbywKIHZvaWQgaW50ZWxfZGV2aWNlX2luZm9fZHVtcF90b3BvbG9neShj
b25zdCBzdHJ1Y3Qgc3NldV9kZXZfaW5mbyAqc3NldSwKIAkJCQkgICAgIHN0cnVjdCBkcm1fcHJp
bnRlciAqcCk7CiAKLXZvaWQgaW50ZWxfZGV2aWNlX2luZm9faW5pdF9tbWlvKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX2RldmljZV9pbmZvX2luaXRfbW1p
byhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKIHZvaWQgaW50ZWxfZHJpdmVyX2Nh
cHNfcHJpbnQoY29uc3Qgc3RydWN0IGludGVsX2RyaXZlcl9jYXBzICpjYXBzLAogCQkJICAgICBz
dHJ1Y3QgZHJtX3ByaW50ZXIgKnApOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxheS5jCmlu
ZGV4IDFiMWRkYjQ4Y2E3YS4uYmUyNmFkOWZjMTk0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
ZGlzcGxheS5jCkBAIC0xNTYsMjQgKzE1NiwyNCBAQCBzdHJ1Y3QgaW50ZWxfbGltaXQgewogfTsK
IAogLyogcmV0dXJucyBIUExMIGZyZXF1ZW5jeSBpbiBrSHogKi8KLWludCB2bHZfZ2V0X2hwbGxf
dmNvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludCB2bHZfZ2V0X2hwbGxf
dmNvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWludCBocGxsX2ZyZXEsIHZj
b19mcmVxW10gPSB7IDgwMCwgMTYwMCwgMjAwMCwgMjQwMCB9OwogCiAJLyogT2J0YWluIFNLVSBp
bmZvcm1hdGlvbiAqLwotCWhwbGxfZnJlcSA9IHZsdl9jY2tfcmVhZChkZXZfcHJpdiwgQ0NLX0ZV
U0VfUkVHKSAmCisJaHBsbF9mcmVxID0gdmx2X2Nja19yZWFkKGk5MTUsIENDS19GVVNFX1JFRykg
JgogCQlDQ0tfRlVTRV9IUExMX0ZSRVFfTUFTSzsKIAogCXJldHVybiB2Y29fZnJlcVtocGxsX2Zy
ZXFdICogMTAwMDsKIH0KIAotaW50IHZsdl9nZXRfY2NrX2Nsb2NrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK2ludCB2bHZfZ2V0X2Nja19jbG9jayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJICAgICAgY29uc3QgY2hhciAqbmFtZSwgdTMyIHJlZywgaW50IHJl
Zl9mcmVxKQogewogCXUzMiB2YWw7CiAJaW50IGRpdmlkZXI7CiAKLQl2YWwgPSB2bHZfY2NrX3Jl
YWQoZGV2X3ByaXYsIHJlZyk7CisJdmFsID0gdmx2X2Nja19yZWFkKGk5MTUsIHJlZyk7CiAJZGl2
aWRlciA9IHZhbCAmIENDS19GUkVRVUVOQ1lfVkFMVUVTOwogCiAJV0FSTigodmFsICYgQ0NLX0ZS
RVFVRU5DWV9TVEFUVVMpICE9CkBAIC0xODMsNDIgKzE4Myw0MiBAQCBpbnQgdmx2X2dldF9jY2tf
Y2xvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiBESVZfUk9V
TkRfQ0xPU0VTVChyZWZfZnJlcSA8PCAxLCBkaXZpZGVyICsgMSk7CiB9CiAKLWludCB2bHZfZ2V0
X2Nja19jbG9ja19ocGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludCB2
bHZfZ2V0X2Nja19jbG9ja19ocGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
ICAgY29uc3QgY2hhciAqbmFtZSwgdTMyIHJlZykKIHsKIAlpbnQgaHBsbDsKIAotCXZsdl9jY2tf
Z2V0KGRldl9wcml2KTsKKwl2bHZfY2NrX2dldChpOTE1KTsKIAotCWlmIChkZXZfcHJpdi0+aHBs
bF9mcmVxID09IDApCi0JCWRldl9wcml2LT5ocGxsX2ZyZXEgPSB2bHZfZ2V0X2hwbGxfdmNvKGRl
dl9wcml2KTsKKwlpZiAoaTkxNS0+aHBsbF9mcmVxID09IDApCisJCWk5MTUtPmhwbGxfZnJlcSA9
IHZsdl9nZXRfaHBsbF92Y28oaTkxNSk7CiAKLQlocGxsID0gdmx2X2dldF9jY2tfY2xvY2soZGV2
X3ByaXYsIG5hbWUsIHJlZywgZGV2X3ByaXYtPmhwbGxfZnJlcSk7CisJaHBsbCA9IHZsdl9nZXRf
Y2NrX2Nsb2NrKGk5MTUsIG5hbWUsIHJlZywgaTkxNS0+aHBsbF9mcmVxKTsKIAotCXZsdl9jY2tf
cHV0KGRldl9wcml2KTsKKwl2bHZfY2NrX3B1dChpOTE1KTsKIAogCXJldHVybiBocGxsOwogfQog
Ci1zdGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3pjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX2N6Y2xrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCWlmICghKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElT
X0NIRVJSWVZJRVcoZGV2X3ByaXYpKSkKKwlpZiAoIShJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElT
X0NIRVJSWVZJRVcoaTkxNSkpKQogCQlyZXR1cm47CiAKLQlkZXZfcHJpdi0+Y3pjbGtfZnJlcSA9
IHZsdl9nZXRfY2NrX2Nsb2NrX2hwbGwoZGV2X3ByaXYsICJjemNsayIsCisJaTkxNS0+Y3pjbGtf
ZnJlcSA9IHZsdl9nZXRfY2NrX2Nsb2NrX2hwbGwoaTkxNSwgImN6Y2xrIiwKIAkJCQkJCSAgICAg
IENDS19DWl9DTE9DS19DT05UUk9MKTsKIAotCURSTV9ERUJVR19EUklWRVIoIkNaIGNsb2NrIHJh
dGU6ICVkIGtIelxuIiwgZGV2X3ByaXYtPmN6Y2xrX2ZyZXEpOworCURSTV9ERUJVR19EUklWRVIo
IkNaIGNsb2NrIHJhdGU6ICVkIGtIelxuIiwgaTkxNS0+Y3pjbGtfZnJlcSk7CiB9CiAKIHN0YXRp
YyBpbmxpbmUgdTMyIC8qIHVuaXRzIG9mIDEwME1IeiAqLwotaW50ZWxfZmRpX2xpbmtfZnJlcShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9mZGlfbGlua19mcmVxKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewotCWlmIChIQVNfRERJKGRldl9wcml2KSkKKwlpZiAo
SEFTX0RESShpOTE1KSkKIAkJcmV0dXJuIHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOyAvKiBTUExM
ICovCiAJZWxzZQotCQlyZXR1cm4gZGV2X3ByaXYtPmZkaV9wbGxfZnJlcTsKKwkJcmV0dXJuIGk5
MTUtPmZkaV9wbGxfZnJlcTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCBp
bnRlbF9saW1pdHNfaTh4eF9kYWMgPSB7CkBAIC00ODgsNyArNDg4LDcgQEAgc3RhdGljIGNvbnN0
IHN0cnVjdCBpbnRlbF9saW1pdCBpbnRlbF9saW1pdHNfYnh0ID0gewogCiAvKiBXQSBEaXNwbGF5
ICMwODI3OiBHZW45OmFsbCAqLwogc3RhdGljIHZvaWQKLXNrbF93YV84Mjcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgcGlwZSwgYm9vbCBlbmFibGUpCitza2xfd2FfODI3
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgcGlwZSwgYm9vbCBlbmFibGUpCiB7
CiAJaWYgKGVuYWJsZSkKIAkJSTkxNV9XUklURShDTEtHQVRFX0RJU19QU0wocGlwZSksCkBAIC01
MDIsNyArNTAyLDcgQEAgc2tsX3dhXzgyNyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIGludCBwaXBlLCBib29sIGVuYWJsZSkKIAogLyogV2FfMjAwNjYwNDMxMjppY2wgKi8KIHN0
YXRpYyB2b2lkCi1pY2xfd2Ffc2NhbGVyY2xrZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUsCitpY2xfd2Ffc2NhbGVyY2xrZ2F0aW5nKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBpcGUgcGlwZSwKIAkJICAgICAgIGJvb2wg
ZW5hYmxlKQogewogCWlmIChlbmFibGUpCkBAIC01ODgsNyArNTg4LDcgQEAgaW50IGNodl9jYWxj
X2RwbGxfcGFyYW1zKGludCByZWZjbGssIHN0cnVjdCBkcGxsICpjbG9jaykKICAqIFJldHVybnMg
d2hldGhlciB0aGUgZ2l2ZW4gc2V0IG9mIGRpdmlzb3JzIGFyZSB2YWxpZCBmb3IgYSBnaXZlbiBy
ZWZjbGsgd2l0aAogICogdGhlIGdpdmVuIGNvbm5lY3RvcnMuCiAgKi8KLXN0YXRpYyBib29sIGlu
dGVsX1BMTF9pc192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgYm9vbCBpbnRlbF9QTExfaXNfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKIAkJCSAgICAgICBj
b25zdCBzdHJ1Y3QgZHBsbCAqY2xvY2spCiB7CkBAIC02MDEsMTMgKzYwMSwxMyBAQCBzdGF0aWMg
Ym9vbCBpbnRlbF9QTExfaXNfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCWlmIChjbG9jay0+bTEgIDwgbGltaXQtPm0xLm1pbiAgfHwgbGltaXQtPm0xLm1heCAgPCBj
bG9jay0+bTEpCiAJCUlOVEVMUGxsSW52YWxpZCgibTEgb3V0IG9mIHJhbmdlXG4iKTsKIAotCWlm
ICghSVNfUElORVZJRVcoZGV2X3ByaXYpICYmICFJU19WQUxMRVlWSUVXKGRldl9wcml2KSAmJgot
CSAgICAhSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgJiYgIUlTX0dFTjlfTFAoZGV2X3ByaXYpKQor
CWlmICghSVNfUElORVZJRVcoaTkxNSkgJiYgIUlTX1ZBTExFWVZJRVcoaTkxNSkgJiYKKwkgICAg
IUlTX0NIRVJSWVZJRVcoaTkxNSkgJiYgIUlTX0dFTjlfTFAoaTkxNSkpCiAJCWlmIChjbG9jay0+
bTEgPD0gY2xvY2stPm0yKQogCQkJSU5URUxQbGxJbnZhbGlkKCJtMSA8PSBtMlxuIik7CiAKLQlp
ZiAoIUlTX1ZBTExFWVZJRVcoZGV2X3ByaXYpICYmICFJU19DSEVSUllWSUVXKGRldl9wcml2KSAm
JgotCSAgICAhSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKKwlpZiAoIUlTX1ZBTExFWVZJRVcoaTkx
NSkgJiYgIUlTX0NIRVJSWVZJRVcoaTkxNSkgJiYKKwkgICAgIUlTX0dFTjlfTFAoaTkxNSkpIHsK
IAkJaWYgKGNsb2NrLT5wIDwgbGltaXQtPnAubWluIHx8IGxpbWl0LT5wLm1heCA8IGNsb2NrLT5w
KQogCQkJSU5URUxQbGxJbnZhbGlkKCJwIG91dCBvZiByYW5nZVxuIik7CiAJCWlmIChjbG9jay0+
bSA8IGxpbWl0LT5tLm1pbiB8fCBsaW1pdC0+bS5tYXggPCBjbG9jay0+bSkKQEAgLTYzMCw3ICs2
MzAsNyBAQCBpOXh4X3NlbGVjdF9wMl9kaXYoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1p
dCwKIAkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAg
IGludCB0YXJnZXQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAogCWlmIChp
bnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkgewogCQkv
KgpAQCAtNjM4LDcgKzYzOCw3IEBAIGk5eHhfc2VsZWN0X3AyX2Rpdihjb25zdCBzdHJ1Y3QgaW50
ZWxfbGltaXQgKmxpbWl0LAogCQkgKiBXZSBoYXZlbid0IGZpZ3VyZWQgb3V0IGhvdyB0byByZWxp
YWJseSBzZXQgdXAgZGlmZmVyZW50CiAJCSAqIHNpbmdsZS9kdWFsIGNoYW5uZWwgc3RhdGUsIGlm
IHdlIGV2ZW4gY2FuLgogCQkgKi8KLQkJaWYgKGludGVsX2lzX2R1YWxfbGlua19sdmRzKGRldl9w
cml2KSkKKwkJaWYgKGludGVsX2lzX2R1YWxfbGlua19sdmRzKGk5MTUpKQogCQkJcmV0dXJuIGxp
bWl0LT5wMi5wMl9mYXN0OwogCQllbHNlCiAJCQlyZXR1cm4gbGltaXQtPnAyLnAyX3Nsb3c7CkBA
IC0xMDE2LDIyICsxMDE2LDIyIEBAIGJvb2wgaW50ZWxfY3J0Y19hY3RpdmUoc3RydWN0IGludGVs
X2NydGMgKmNydGMpCiAJCWNydGMtPmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xv
Y2s7CiB9CiAKLWVudW0gdHJhbnNjb2RlciBpbnRlbF9waXBlX3RvX2NwdV90cmFuc2NvZGVyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2VudW0gdHJhbnNjb2RlciBpbnRlbF9w
aXBlX3RvX2NwdV90cmFuc2NvZGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
CQkgICAgIGVudW0gcGlwZSBwaXBlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gaW50
ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoaTkxNSwgcGlwZSk7CiAKIAlyZXR1cm4g
Y3J0Yy0+Y29uZmlnLT5jcHVfdHJhbnNjb2RlcjsKIH0KIAotc3RhdGljIGJvb2wgcGlwZV9zY2Fu
bGluZV9pc19tb3Zpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IGJvb2wgcGlwZV9zY2FubGluZV9pc19tb3Zpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICAgIGVudW0gcGlwZSBwaXBlKQogewogCWk5MTVfcmVnX3QgcmVnID0gUElQRURT
TChwaXBlKTsKIAl1MzIgbGluZTEsIGxpbmUyOwogCXUzMiBsaW5lX21hc2s7CiAKLQlpZiAoSVNf
R0VOKGRldl9wcml2LCAyKSkKKwlpZiAoSVNfR0VOKGk5MTUsIDIpKQogCQlsaW5lX21hc2sgPSBE
U0xfTElORU1BU0tfR0VOMjsKIAllbHNlCiAJCWxpbmVfbWFzayA9IERTTF9MSU5FTUFTS19HRU4z
OwpAQCAtMTA0NSwxMSArMTA0NSwxMSBAQCBzdGF0aWMgYm9vbCBwaXBlX3NjYW5saW5lX2lzX21v
dmluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIHN0YXRpYyB2b2lkIHdh
aXRfZm9yX3BpcGVfc2NhbmxpbmVfbW92aW5nKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLCBib29s
IHN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCiAJLyog
V2FpdCBmb3IgdGhlIGRpc3BsYXkgbGluZSB0byBzZXR0bGUvc3RhcnQgbW92aW5nICovCi0JaWYg
KHdhaXRfZm9yKHBpcGVfc2NhbmxpbmVfaXNfbW92aW5nKGRldl9wcml2LCBwaXBlKSA9PSBzdGF0
ZSwgMTAwKSkKKwlpZiAod2FpdF9mb3IocGlwZV9zY2FubGluZV9pc19tb3ZpbmcoaTkxNSwgcGlw
ZSkgPT0gc3RhdGUsIDEwMCkpCiAJCURSTV9FUlJPUigicGlwZSAlYyBzY2FubGluZSAlcyB3YWl0
IHRpbWVkIG91dFxuIiwKIAkJCSAgcGlwZV9uYW1lKHBpcGUpLCBvbm9mZihzdGF0ZSkpOwogfQpA
QCAtMTA2OCwxNCArMTA2OCwxNCBAQCBzdGF0aWMgdm9pZAogaW50ZWxfd2FpdF9mb3JfcGlwZV9v
ZmYoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogewogCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFz
ZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
Y3J0Yy0+YmFzZS5kZXYpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkgeworCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gNCkgewogCQllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29k
ZXIgPSBvbGRfY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAJCWk5MTVfcmVnX3QgcmVnID0g
UElQRUNPTkYoY3B1X3RyYW5zY29kZXIpOwogCiAJCS8qIFdhaXQgZm9yIHRoZSBQaXBlIFN0YXRl
IHRvIGdvIG9mZiAqLwotCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51
bmNvcmUsCisJCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJ
CQkgICAgcmVnLCBJOTY1X1BJUEVDT05GX0FDVElWRSwgMCwKIAkJCQkJICAgIDEwMCkpCiAJCQlX
QVJOKDEsICJwaXBlX29mZiB3YWl0IHRpbWVkIG91dFxuIik7CkBAIC0xMDg1LDcgKzEwODUsNyBA
QCBpbnRlbF93YWl0X2Zvcl9waXBlX29mZihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
b2xkX2NydGNfc3RhdGUpCiB9CiAKIC8qIE9ubHkgZm9yIHByZS1JTEsgY29uZmlncyAqLwotdm9p
ZCBhc3NlcnRfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgYXNz
ZXJ0X3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZW51bSBwaXBlIHBpcGUs
IGJvb2wgc3RhdGUpCiB7CiAJdTMyIHZhbDsKQEAgLTEwOTksMTQgKzEwOTksMTQgQEAgdm9pZCBh
c3NlcnRfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogLyogWFhY
OiB0aGUgZHNpIHBsbCBpcyBzaGFyZWQgYmV0d2VlbiBNSVBJIERTSSBwb3J0cyAqLwotdm9pZCBh
c3NlcnRfZHNpX3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgc3Rh
dGUpCit2b2lkIGFzc2VydF9kc2lfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBi
b29sIHN0YXRlKQogewogCXUzMiB2YWw7CiAJYm9vbCBjdXJfc3RhdGU7CiAKLQl2bHZfY2NrX2dl
dChkZXZfcHJpdik7Ci0JdmFsID0gdmx2X2Nja19yZWFkKGRldl9wcml2LCBDQ0tfUkVHX0RTSV9Q
TExfQ09OVFJPTCk7Ci0Jdmx2X2Nja19wdXQoZGV2X3ByaXYpOworCXZsdl9jY2tfZ2V0KGk5MTUp
OworCXZhbCA9IHZsdl9jY2tfcmVhZChpOTE1LCBDQ0tfUkVHX0RTSV9QTExfQ09OVFJPTCk7CisJ
dmx2X2Nja19wdXQoaTkxNSk7CiAKIAljdXJfc3RhdGUgPSB2YWwgJiBEU0lfUExMX1ZDT19FTjsK
IAlJOTE1X1NUQVRFX1dBUk4oY3VyX3N0YXRlICE9IHN0YXRlLApAQCAtMTExNCwxNCArMTExNCwx
NCBAQCB2b2lkIGFzc2VydF9kc2lfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgYm9vbCBzdGF0ZSkKIAkJCW9ub2ZmKHN0YXRlKSwgb25vZmYoY3VyX3N0YXRlKSk7CiB9CiAK
LXN0YXRpYyB2b2lkIGFzc2VydF9mZGlfdHgoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAorc3RhdGljIHZvaWQgYXNzZXJ0X2ZkaV90eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCSAgZW51bSBwaXBlIHBpcGUsIGJvb2wgc3RhdGUpCiB7CiAJYm9vbCBjdXJfc3Rh
dGU7Ci0JZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gaW50ZWxfcGlwZV90b19jcHVf
dHJhbnNjb2RlcihkZXZfcHJpdiwKKwllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBp
bnRlbF9waXBlX3RvX2NwdV90cmFuc2NvZGVyKGk5MTUsCiAJCQkJCQkJCSAgICAgIHBpcGUpOwog
Ci0JaWYgKEhBU19EREkoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19EREkoaTkxNSkpIHsKIAkJLyog
RERJIGRvZXMgbm90IGhhdmUgYSBzcGVjaWZpYyBGRElfVFggcmVnaXN0ZXIgKi8KIAkJdTMyIHZh
bCA9IEk5MTVfUkVBRChUUkFOU19ERElfRlVOQ19DVEwoY3B1X3RyYW5zY29kZXIpKTsKIAkJY3Vy
X3N0YXRlID0gISEodmFsICYgVFJBTlNfRERJX0ZVTkNfRU5BQkxFKTsKQEAgLTExMzYsNyArMTEz
Niw3IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9mZGlfdHgoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogI2RlZmluZSBhc3NlcnRfZmRpX3R4X2VuYWJsZWQoZCwgcCkgYXNzZXJ0X2Zk
aV90eChkLCBwLCB0cnVlKQogI2RlZmluZSBhc3NlcnRfZmRpX3R4X2Rpc2FibGVkKGQsIHApIGFz
c2VydF9mZGlfdHgoZCwgcCwgZmFsc2UpCiAKLXN0YXRpYyB2b2lkIGFzc2VydF9mZGlfcngoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgYXNzZXJ0X2ZkaV9y
eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgZW51bSBwaXBlIHBpcGUsIGJv
b2wgc3RhdGUpCiB7CiAJdTMyIHZhbDsKQEAgLTExNTEsMjQgKzExNTEsMjQgQEAgc3RhdGljIHZv
aWQgYXNzZXJ0X2ZkaV9yeChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAjZGVm
aW5lIGFzc2VydF9mZGlfcnhfZW5hYmxlZChkLCBwKSBhc3NlcnRfZmRpX3J4KGQsIHAsIHRydWUp
CiAjZGVmaW5lIGFzc2VydF9mZGlfcnhfZGlzYWJsZWQoZCwgcCkgYXNzZXJ0X2ZkaV9yeChkLCBw
LCBmYWxzZSkKIAotc3RhdGljIHZvaWQgYXNzZXJ0X2ZkaV90eF9wbGxfZW5hYmxlZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBhc3NlcnRfZmRpX3R4X3Bs
bF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgIGVudW0g
cGlwZSBwaXBlKQogewogCXUzMiB2YWw7CiAKIAkvKiBJTEsgRkRJIFBMTCBpcyBhbHdheXMgZW5h
YmxlZCAqLwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDUpKQorCWlmIChJU19HRU4oaTkxNSwgNSkp
CiAJCXJldHVybjsKIAogCS8qIE9uIEhhc3dlbGwsIERESSBwb3J0cyBhcmUgcmVzcG9uc2libGUg
Zm9yIHRoZSBGREkgUExMIHNldHVwICovCi0JaWYgKEhBU19EREkoZGV2X3ByaXYpKQorCWlmIChI
QVNfRERJKGk5MTUpKQogCQlyZXR1cm47CiAKIAl2YWwgPSBJOTE1X1JFQUQoRkRJX1RYX0NUTChw
aXBlKSk7CiAJSTkxNV9TVEFURV9XQVJOKCEodmFsICYgRkRJX1RYX1BMTF9FTkFCTEUpLCAiRkRJ
IFRYIFBMTCBhc3NlcnRpb24gZmFpbHVyZSwgc2hvdWxkIGJlIGFjdGl2ZSBidXQgaXMgZGlzYWJs
ZWRcbiIpOwogfQogCi12b2lkIGFzc2VydF9mZGlfcnhfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3ZvaWQgYXNzZXJ0X2ZkaV9yeF9wbGwoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCSAgICAgICBlbnVtIHBpcGUgcGlwZSwgYm9vbCBzdGF0ZSkKIHsKIAl1
MzIgdmFsOwpAQCAtMTE4MSwxNyArMTE4MSwxNyBAQCB2b2lkIGFzc2VydF9mZGlfcnhfcGxsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCW9ub2ZmKHN0YXRlKSwgb25vZmYo
Y3VyX3N0YXRlKSk7CiB9CiAKLXZvaWQgYXNzZXJ0X3BhbmVsX3VubG9ja2VkKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCit2b2lkIGFzc2VydF9wYW5l
bF91bmxvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUp
CiB7CiAJaTkxNV9yZWdfdCBwcF9yZWc7CiAJdTMyIHZhbDsKIAllbnVtIHBpcGUgcGFuZWxfcGlw
ZSA9IElOVkFMSURfUElQRTsKIAlib29sIGxvY2tlZCA9IHRydWU7CiAKLQlpZiAoV0FSTl9PTihI
QVNfRERJKGRldl9wcml2KSkpCisJaWYgKFdBUk5fT04oSEFTX0RESShpOTE1KSkpCiAJCXJldHVy
bjsKIAotCWlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgeworCWlmIChIQVNfUENIX1NQTElU
KGk5MTUpKSB7CiAJCXUzMiBwb3J0X3NlbDsKIAogCQlwcF9yZWcgPSBQUF9DT05UUk9MKDApOwpA
QCAtMTE5OSwyMiArMTE5OSwyMiBAQCB2b2lkIGFzc2VydF9wYW5lbF91bmxvY2tlZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQogCiAJCXN3aXRjaCAo
cG9ydF9zZWwpIHsKIAkJY2FzZSBQQU5FTF9QT1JUX1NFTEVDVF9MVkRTOgotCQkJaW50ZWxfbHZk
c19wb3J0X2VuYWJsZWQoZGV2X3ByaXYsIFBDSF9MVkRTLCAmcGFuZWxfcGlwZSk7CisJCQlpbnRl
bF9sdmRzX3BvcnRfZW5hYmxlZChpOTE1LCBQQ0hfTFZEUywgJnBhbmVsX3BpcGUpOwogCQkJYnJl
YWs7CiAJCWNhc2UgUEFORUxfUE9SVF9TRUxFQ1RfRFBBOgotCQkJaW50ZWxfZHBfcG9ydF9lbmFi
bGVkKGRldl9wcml2LCBEUF9BLCBQT1JUX0EsICZwYW5lbF9waXBlKTsKKwkJCWludGVsX2RwX3Bv
cnRfZW5hYmxlZChpOTE1LCBEUF9BLCBQT1JUX0EsICZwYW5lbF9waXBlKTsKIAkJCWJyZWFrOwog
CQljYXNlIFBBTkVMX1BPUlRfU0VMRUNUX0RQQzoKLQkJCWludGVsX2RwX3BvcnRfZW5hYmxlZChk
ZXZfcHJpdiwgUENIX0RQX0MsIFBPUlRfQywgJnBhbmVsX3BpcGUpOworCQkJaW50ZWxfZHBfcG9y
dF9lbmFibGVkKGk5MTUsIFBDSF9EUF9DLCBQT1JUX0MsICZwYW5lbF9waXBlKTsKIAkJCWJyZWFr
OwogCQljYXNlIFBBTkVMX1BPUlRfU0VMRUNUX0RQRDoKLQkJCWludGVsX2RwX3BvcnRfZW5hYmxl
ZChkZXZfcHJpdiwgUENIX0RQX0QsIFBPUlRfRCwgJnBhbmVsX3BpcGUpOworCQkJaW50ZWxfZHBf
cG9ydF9lbmFibGVkKGk5MTUsIFBDSF9EUF9ELCBQT1JUX0QsICZwYW5lbF9waXBlKTsKIAkJCWJy
ZWFrOwogCQlkZWZhdWx0OgogCQkJTUlTU0lOR19DQVNFKHBvcnRfc2VsKTsKIAkJCWJyZWFrOwog
CQl9Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVX
KGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVS
UllWSUVXKGk5MTUpKSB7CiAJCS8qIHByZXN1bWFibHkgd3JpdGUgbG9jayBkZXBlbmRzIG9uIHBp
cGUsIG5vdCBwb3J0IHNlbGVjdCAqLwogCQlwcF9yZWcgPSBQUF9DT05UUk9MKHBpcGUpOwogCQlw
YW5lbF9waXBlID0gcGlwZTsKQEAgLTEyMjUsNyArMTIyNSw3IEBAIHZvaWQgYXNzZXJ0X3BhbmVs
X3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBp
cGUpCiAJCXBvcnRfc2VsID0gSTkxNV9SRUFEKFBQX09OX0RFTEFZUygwKSkgJiBQQU5FTF9QT1JU
X1NFTEVDVF9NQVNLOwogCiAJCVdBUk5fT04ocG9ydF9zZWwgIT0gUEFORUxfUE9SVF9TRUxFQ1Rf
TFZEUyk7Ci0JCWludGVsX2x2ZHNfcG9ydF9lbmFibGVkKGRldl9wcml2LCBMVkRTLCAmcGFuZWxf
cGlwZSk7CisJCWludGVsX2x2ZHNfcG9ydF9lbmFibGVkKGk5MTUsIExWRFMsICZwYW5lbF9waXBl
KTsKIAl9CiAKIAl2YWwgPSBJOTE1X1JFQUQocHBfcmVnKTsKQEAgLTEyMzgsMjYgKzEyMzgsMjYg
QEAgdm9pZCBhc3NlcnRfcGFuZWxfdW5sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKIAkgICAgIHBpcGVfbmFtZShwaXBlKSk7CiB9CiAKLXZv
aWQgYXNzZXJ0X3BpcGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBh
c3NlcnRfcGlwZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJIGVudW0gcGlwZSBw
aXBlLCBib29sIHN0YXRlKQogewogCWJvb2wgY3VyX3N0YXRlOwotCWVudW0gdHJhbnNjb2RlciBj
cHVfdHJhbnNjb2RlciA9IGludGVsX3BpcGVfdG9fY3B1X3RyYW5zY29kZXIoZGV2X3ByaXYsCisJ
ZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gaW50ZWxfcGlwZV90b19jcHVfdHJhbnNj
b2RlcihpOTE1LAogCQkJCQkJCQkgICAgICBwaXBlKTsKIAllbnVtIGludGVsX2Rpc3BsYXlfcG93
ZXJfZG9tYWluIHBvd2VyX2RvbWFpbjsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAogCS8q
IHdlIGtlZXAgYm90aCBwaXBlcyBlbmFibGVkIG9uIDgzMCAqLwotCWlmIChJU19JODMwKGRldl9w
cml2KSkKKwlpZiAoSVNfSTgzMChpOTE1KSkKIAkJc3RhdGUgPSB0cnVlOwogCiAJcG93ZXJfZG9t
YWluID0gUE9XRVJfRE9NQUlOX1RSQU5TQ09ERVIoY3B1X3RyYW5zY29kZXIpOwotCXdha2VyZWYg
PSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21h
aW4pOworCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUs
IHBvd2VyX2RvbWFpbik7CiAJaWYgKHdha2VyZWYpIHsKIAkJdTMyIHZhbCA9IEk5MTVfUkVBRChQ
SVBFQ09ORihjcHVfdHJhbnNjb2RlcikpOwogCQljdXJfc3RhdGUgPSAhISh2YWwgJiBQSVBFQ09O
Rl9FTkFCTEUpOwogCi0JCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBwb3dlcl9k
b21haW4sIHdha2VyZWYpOworCQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBwb3dlcl9k
b21haW4sIHdha2VyZWYpOwogCX0gZWxzZSB7CiAJCWN1cl9zdGF0ZSA9IGZhbHNlOwogCX0KQEAg
LTEyODQsMTAgKzEyODQsMTAgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X3BsYW5lKHN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUsIGJvb2wgc3RhdGUpCiAKIHN0YXRpYyB2b2lkIGFzc2VydF9wbGFuZXNf
ZGlzYWJsZWQoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lOwogCi0JZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3By
aXYtPmRybSwgY3J0YywgcGxhbmUpCisJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmaTkx
NS0+ZHJtLCBjcnRjLCBwbGFuZSkKIAkJYXNzZXJ0X3BsYW5lX2Rpc2FibGVkKHBsYW5lKTsKIH0K
IApAQCAtMTI5Nyw3ICsxMjk3LDcgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X3ZibGFua19kaXNhYmxl
ZChzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCiAJCWRybV9jcnRjX3ZibGFua19wdXQoY3J0Yyk7CiB9
CiAKLXZvaWQgYXNzZXJ0X3BjaF90cmFuc2NvZGVyX2Rpc2FibGVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgYXNzZXJ0X3BjaF90cmFuc2NvZGVyX2Rpc2FibGVkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICBlbnVtIHBpcGUgcGlwZSkKIHsK
IAl1MzIgdmFsOwpAQCAtMTMxMCw3OCArMTMxMCw3OCBAQCB2b2lkIGFzc2VydF9wY2hfdHJhbnNj
b2Rlcl9kaXNhYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICAgICBw
aXBlX25hbWUocGlwZSkpOwogfQogCi1zdGF0aWMgdm9pZCBhc3NlcnRfcGNoX2RwX2Rpc2FibGVk
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGFzc2VydF9w
Y2hfZHBfZGlzYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgZW51
bSBwaXBlIHBpcGUsIGVudW0gcG9ydCBwb3J0LAogCQkJCSAgIGk5MTVfcmVnX3QgZHBfcmVnKQog
ewogCWVudW0gcGlwZSBwb3J0X3BpcGU7CiAJYm9vbCBzdGF0ZTsKIAotCXN0YXRlID0gaW50ZWxf
ZHBfcG9ydF9lbmFibGVkKGRldl9wcml2LCBkcF9yZWcsIHBvcnQsICZwb3J0X3BpcGUpOworCXN0
YXRlID0gaW50ZWxfZHBfcG9ydF9lbmFibGVkKGk5MTUsIGRwX3JlZywgcG9ydCwgJnBvcnRfcGlw
ZSk7CiAKIAlJOTE1X1NUQVRFX1dBUk4oc3RhdGUgJiYgcG9ydF9waXBlID09IHBpcGUsCiAJCQki
UENIIERQICVjIGVuYWJsZWQgb24gdHJhbnNjb2RlciAlYywgc2hvdWxkIGJlIGRpc2FibGVkXG4i
LAogCQkJcG9ydF9uYW1lKHBvcnQpLCBwaXBlX25hbWUocGlwZSkpOwogCi0JSTkxNV9TVEFURV9X
QVJOKEhBU19QQ0hfSUJYKGRldl9wcml2KSAmJiAhc3RhdGUgJiYgcG9ydF9waXBlID09IFBJUEVf
QiwKKwlJOTE1X1NUQVRFX1dBUk4oSEFTX1BDSF9JQlgoaTkxNSkgJiYgIXN0YXRlICYmIHBvcnRf
cGlwZSA9PSBQSVBFX0IsCiAJCQkiSUJYIFBDSCBEUCAlYyBzdGlsbCB1c2luZyB0cmFuc2NvZGVy
IEJcbiIsCiAJCQlwb3J0X25hbWUocG9ydCkpOwogfQogCi1zdGF0aWMgdm9pZCBhc3NlcnRfcGNo
X2hkbWlfZGlzYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IHZvaWQgYXNzZXJ0X3BjaF9oZG1pX2Rpc2FibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCSAgICAgZW51bSBwaXBlIHBpcGUsIGVudW0gcG9ydCBwb3J0LAogCQkJCSAgICAg
aTkxNV9yZWdfdCBoZG1pX3JlZykKIHsKIAllbnVtIHBpcGUgcG9ydF9waXBlOwogCWJvb2wgc3Rh
dGU7CiAKLQlzdGF0ZSA9IGludGVsX3Nkdm9fcG9ydF9lbmFibGVkKGRldl9wcml2LCBoZG1pX3Jl
ZywgJnBvcnRfcGlwZSk7CisJc3RhdGUgPSBpbnRlbF9zZHZvX3BvcnRfZW5hYmxlZChpOTE1LCBo
ZG1pX3JlZywgJnBvcnRfcGlwZSk7CiAKIAlJOTE1X1NUQVRFX1dBUk4oc3RhdGUgJiYgcG9ydF9w
aXBlID09IHBpcGUsCiAJCQkiUENIIEhETUkgJWMgZW5hYmxlZCBvbiB0cmFuc2NvZGVyICVjLCBz
aG91bGQgYmUgZGlzYWJsZWRcbiIsCiAJCQlwb3J0X25hbWUocG9ydCksIHBpcGVfbmFtZShwaXBl
KSk7CiAKLQlJOTE1X1NUQVRFX1dBUk4oSEFTX1BDSF9JQlgoZGV2X3ByaXYpICYmICFzdGF0ZSAm
JiBwb3J0X3BpcGUgPT0gUElQRV9CLAorCUk5MTVfU1RBVEVfV0FSTihIQVNfUENIX0lCWChpOTE1
KSAmJiAhc3RhdGUgJiYgcG9ydF9waXBlID09IFBJUEVfQiwKIAkJCSJJQlggUENIIEhETUkgJWMg
c3RpbGwgdXNpbmcgdHJhbnNjb2RlciBCXG4iLAogCQkJcG9ydF9uYW1lKHBvcnQpKTsKIH0KIAot
c3RhdGljIHZvaWQgYXNzZXJ0X3BjaF9wb3J0c19kaXNhYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBhc3NlcnRfcGNoX3BvcnRzX2Rpc2FibGVkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgIGVudW0gcGlwZSBwaXBlKQog
ewogCWVudW0gcGlwZSBwb3J0X3BpcGU7CiAKLQlhc3NlcnRfcGNoX2RwX2Rpc2FibGVkKGRldl9w
cml2LCBwaXBlLCBQT1JUX0IsIFBDSF9EUF9CKTsKLQlhc3NlcnRfcGNoX2RwX2Rpc2FibGVkKGRl
dl9wcml2LCBwaXBlLCBQT1JUX0MsIFBDSF9EUF9DKTsKLQlhc3NlcnRfcGNoX2RwX2Rpc2FibGVk
KGRldl9wcml2LCBwaXBlLCBQT1JUX0QsIFBDSF9EUF9EKTsKKwlhc3NlcnRfcGNoX2RwX2Rpc2Fi
bGVkKGk5MTUsIHBpcGUsIFBPUlRfQiwgUENIX0RQX0IpOworCWFzc2VydF9wY2hfZHBfZGlzYWJs
ZWQoaTkxNSwgcGlwZSwgUE9SVF9DLCBQQ0hfRFBfQyk7CisJYXNzZXJ0X3BjaF9kcF9kaXNhYmxl
ZChpOTE1LCBwaXBlLCBQT1JUX0QsIFBDSF9EUF9EKTsKIAotCUk5MTVfU1RBVEVfV0FSTihpbnRl
bF9jcnRfcG9ydF9lbmFibGVkKGRldl9wcml2LCBQQ0hfQURQQSwgJnBvcnRfcGlwZSkgJiYKKwlJ
OTE1X1NUQVRFX1dBUk4oaW50ZWxfY3J0X3BvcnRfZW5hYmxlZChpOTE1LCBQQ0hfQURQQSwgJnBv
cnRfcGlwZSkgJiYKIAkJCXBvcnRfcGlwZSA9PSBwaXBlLAogCQkJIlBDSCBWR0EgZW5hYmxlZCBv
biB0cmFuc2NvZGVyICVjLCBzaG91bGQgYmUgZGlzYWJsZWRcbiIsCiAJCQlwaXBlX25hbWUocGlw
ZSkpOwogCi0JSTkxNV9TVEFURV9XQVJOKGludGVsX2x2ZHNfcG9ydF9lbmFibGVkKGRldl9wcml2
LCBQQ0hfTFZEUywgJnBvcnRfcGlwZSkgJiYKKwlJOTE1X1NUQVRFX1dBUk4oaW50ZWxfbHZkc19w
b3J0X2VuYWJsZWQoaTkxNSwgUENIX0xWRFMsICZwb3J0X3BpcGUpICYmCiAJCQlwb3J0X3BpcGUg
PT0gcGlwZSwKIAkJCSJQQ0ggTFZEUyBlbmFibGVkIG9uIHRyYW5zY29kZXIgJWMsIHNob3VsZCBi
ZSBkaXNhYmxlZFxuIiwKIAkJCXBpcGVfbmFtZShwaXBlKSk7CiAKIAkvKiBQQ0ggU0RWT0IgbXVs
dGlwbGV4IHdpdGggSERNSUIgKi8KLQlhc3NlcnRfcGNoX2hkbWlfZGlzYWJsZWQoZGV2X3ByaXYs
IHBpcGUsIFBPUlRfQiwgUENIX0hETUlCKTsKLQlhc3NlcnRfcGNoX2hkbWlfZGlzYWJsZWQoZGV2
X3ByaXYsIHBpcGUsIFBPUlRfQywgUENIX0hETUlDKTsKLQlhc3NlcnRfcGNoX2hkbWlfZGlzYWJs
ZWQoZGV2X3ByaXYsIHBpcGUsIFBPUlRfRCwgUENIX0hETUlEKTsKKwlhc3NlcnRfcGNoX2hkbWlf
ZGlzYWJsZWQoaTkxNSwgcGlwZSwgUE9SVF9CLCBQQ0hfSERNSUIpOworCWFzc2VydF9wY2hfaGRt
aV9kaXNhYmxlZChpOTE1LCBwaXBlLCBQT1JUX0MsIFBDSF9IRE1JQyk7CisJYXNzZXJ0X3BjaF9o
ZG1pX2Rpc2FibGVkKGk5MTUsIHBpcGUsIFBPUlRfRCwgUENIX0hETUlEKTsKIH0KIAogc3RhdGlj
IHZvaWQgX3Zsdl9lbmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVu
dW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCUk5MTVfV1JJVEUoRFBMTChwaXBlKSwgcGlw
ZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCk7CiAJUE9TVElOR19SRUFEKERQTEwocGlwZSkp
OwogCXVkZWxheSgxNTApOwogCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJp
di0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAog
CQkJCSAgICBEUExMKHBpcGUpLAogCQkJCSAgICBEUExMX0xPQ0tfVkxWLAogCQkJCSAgICBEUExM
X0xPQ0tfVkxWLApAQCAtMTM5MiwxMyArMTM5MiwxMyBAQCBzdGF0aWMgdm9pZCBfdmx2X2VuYWJs
ZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiBzdGF0aWMgdm9pZCB2bHZfZW5hYmxlX3Bs
bChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+
cGlwZTsKIAotCWFzc2VydF9waXBlX2Rpc2FibGVkKGRldl9wcml2LCBwaXBlKTsKKwlhc3NlcnRf
cGlwZV9kaXNhYmxlZChpOTE1LCBwaXBlKTsKIAogCS8qIFBMTCBpcyBwcm90ZWN0ZWQgYnkgcGFu
ZWwsIG1ha2Ugc3VyZSB3ZSBjYW4gd3JpdGUgaXQgKi8KLQlhc3NlcnRfcGFuZWxfdW5sb2NrZWQo
ZGV2X3ByaXYsIHBpcGUpOworCWFzc2VydF9wYW5lbF91bmxvY2tlZChpOTE1LCBwaXBlKTsKIAog
CWlmIChwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsICYgRFBMTF9WQ09fRU5BQkxFKQog
CQlfdmx2X2VuYWJsZV9wbGwoY3J0YywgcGlwZV9jb25maWcpOwpAQCAtMTQxMSwxOSArMTQxMSwx
OSBAQCBzdGF0aWMgdm9pZCB2bHZfZW5hYmxlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywK
IHN0YXRpYyB2b2lkIF9jaHZfZW5hYmxlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJ
CSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJZW51bSBkcGlvX2NoYW5uZWwgcG9y
dCA9IHZsdl9waXBlX3RvX2NoYW5uZWwocGlwZSk7CiAJdTMyIHRtcDsKIAotCXZsdl9kcGlvX2dl
dChkZXZfcHJpdik7CisJdmx2X2RwaW9fZ2V0KGk5MTUpOwogCiAJLyogRW5hYmxlIGJhY2sgdGhl
IDEwYml0IGNsb2NrIHRvIGRpc3BsYXkgY29udHJvbGxlciAqLwotCXRtcCA9IHZsdl9kcGlvX3Jl
YWQoZGV2X3ByaXYsIHBpcGUsIENIVl9DTU5fRFcxNChwb3J0KSk7CisJdG1wID0gdmx2X2RwaW9f
cmVhZChpOTE1LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCkpOwogCXRtcCB8PSBEUElPX0RDTEtQ
X0VOOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCks
IHRtcCk7CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgQ0hWX0NNTl9EVzE0KHBvcnQpLCB0
bXApOwogCi0Jdmx2X2RwaW9fcHV0KGRldl9wcml2KTsKKwl2bHZfZHBpb19wdXQoaTkxNSk7CiAK
IAkvKgogCSAqIE5lZWQgdG8gd2FpdCA+IDEwMG5zIGJldHdlZW4gZGNsa3AgY2xvY2sgZW5hYmxl
IGJpdCBhbmQgUExMIGVuYWJsZS4KQEAgLTE0MzQsNyArMTQzNCw3IEBAIHN0YXRpYyB2b2lkIF9j
aHZfZW5hYmxlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlJOTE1X1dSSVRFKERQTEwo
cGlwZSksIHBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlLmRwbGwpOwogCiAJLyogQ2hlY2sgUExM
IGlzIGxvY2tlZCAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVu
Y29yZSwKKwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkg
ICAgRFBMTChwaXBlKSwgRFBMTF9MT0NLX1ZMViwgRFBMTF9MT0NLX1ZMViwKIAkJCQkgICAgMSkp
CiAJCURSTV9FUlJPUigiUExMICVkIGZhaWxlZCB0byBsb2NrXG4iLCBwaXBlKTsKQEAgLTE0NDMs
MTMgKzE0NDMsMTMgQEAgc3RhdGljIHZvaWQgX2Nodl9lbmFibGVfcGxsKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogc3RhdGljIHZvaWQgY2h2X2VuYWJsZV9wbGwoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKLQlhc3NlcnRfcGlw
ZV9kaXNhYmxlZChkZXZfcHJpdiwgcGlwZSk7CisJYXNzZXJ0X3BpcGVfZGlzYWJsZWQoaTkxNSwg
cGlwZSk7CiAKIAkvKiBQTEwgaXMgcHJvdGVjdGVkIGJ5IHBhbmVsLCBtYWtlIHN1cmUgd2UgY2Fu
IHdyaXRlIGl0ICovCi0JYXNzZXJ0X3BhbmVsX3VubG9ja2VkKGRldl9wcml2LCBwaXBlKTsKKwlh
c3NlcnRfcGFuZWxfdW5sb2NrZWQoaTkxNSwgcGlwZSk7CiAKIAlpZiAocGlwZV9jb25maWctPmRw
bGxfaHdfc3RhdGUuZHBsbCAmIERQTExfVkNPX0VOQUJMRSkKIAkJX2Nodl9lbmFibGVfcGxsKGNy
dGMsIHBpcGVfY29uZmlnKTsKQEAgLTE0NjQsNyArMTQ2NCw3IEBAIHN0YXRpYyB2b2lkIGNodl9l
bmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQlJOTE1X1dSSVRFKENCUjRfVkxW
LCBDQlJfRFBMTEJNRF9QSVBFKHBpcGUpKTsKIAkJSTkxNV9XUklURShEUExMX01EKFBJUEVfQiks
IHBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlLmRwbGxfbWQpOwogCQlJOTE1X1dSSVRFKENCUjRf
VkxWLCAwKTsKLQkJZGV2X3ByaXYtPmNodl9kcGxsX21kW3BpcGVdID0gcGlwZV9jb25maWctPmRw
bGxfaHdfc3RhdGUuZHBsbF9tZDsKKwkJaTkxNS0+Y2h2X2RwbGxfbWRbcGlwZV0gPSBwaXBlX2Nv
bmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsX21kOwogCiAJCS8qCiAJCSAqIERQTExCIFZHQSBtb2Rl
IGFsc28gc2VlbXMgdG8gY2F1c2UgcHJvYmxlbXMuCkBAIC0xNDc3LDI3ICsxNDc3LDI3IEBAIHN0
YXRpYyB2b2lkIGNodl9lbmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCX0KIH0K
IAotc3RhdGljIGJvb2wgaTl4eF9oYXNfcHBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3N0YXRpYyBib29sIGk5eHhfaGFzX3BwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlpZiAoSVNfSTgzMChkZXZfcHJpdikpCisJaWYgKElTX0k4MzAoaTkxNSkpCiAJ
CXJldHVybiBmYWxzZTsKIAotCXJldHVybiBJU19QSU5FVklFVyhkZXZfcHJpdikgfHwgSVNfTU9C
SUxFKGRldl9wcml2KTsKKwlyZXR1cm4gSVNfUElORVZJRVcoaTkxNSkgfHwgSVNfTU9CSUxFKGk5
MTUpOwogfQogCiBzdGF0aWMgdm9pZCBpOXh4X2VuYWJsZV9wbGwoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAlpOTE1X3JlZ190IHJlZyA9IERQTEwoY3J0Yy0+cGlwZSk7CiAJdTMyIGRw
bGwgPSBjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlLmRwbGw7CiAJaW50IGk7CiAKLQlhc3NlcnRf
cGlwZV9kaXNhYmxlZChkZXZfcHJpdiwgY3J0Yy0+cGlwZSk7CisJYXNzZXJ0X3BpcGVfZGlzYWJs
ZWQoaTkxNSwgY3J0Yy0+cGlwZSk7CiAKIAkvKiBQTEwgaXMgcHJvdGVjdGVkIGJ5IHBhbmVsLCBt
YWtlIHN1cmUgd2UgY2FuIHdyaXRlIGl0ICovCi0JaWYgKGk5eHhfaGFzX3BwcyhkZXZfcHJpdikp
Ci0JCWFzc2VydF9wYW5lbF91bmxvY2tlZChkZXZfcHJpdiwgY3J0Yy0+cGlwZSk7CisJaWYgKGk5
eHhfaGFzX3BwcyhpOTE1KSkKKwkJYXNzZXJ0X3BhbmVsX3VubG9ja2VkKGk5MTUsIGNydGMtPnBp
cGUpOwogCiAJLyoKIAkgKiBBcHBhcmVudGx5IHdlIG5lZWQgdG8gaGF2ZSBWR0EgbW9kZSBlbmFi
bGVkIHByaW9yIHRvIGNoYW5naW5nCkBAIC0xNTExLDcgKzE1MTEsNyBAQCBzdGF0aWMgdm9pZCBp
OXh4X2VuYWJsZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJUE9TVElOR19SRUFEKHJl
Zyk7CiAJdWRlbGF5KDE1MCk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7CisJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KSB7CiAJCUk5MTVfV1JJVEUoRFBMTF9NRChjcnRjLT5w
aXBlKSwKIAkJCSAgIGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUuZHBsbF9tZCk7CiAJfSBlbHNl
IHsKQEAgLTE1MzQsMjYgKzE1MzQsMjYgQEAgc3RhdGljIHZvaWQgaTl4eF9lbmFibGVfcGxsKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogc3RhdGljIHZvaWQgaTl4eF9kaXNhYmxlX3BsbChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCS8qIERvbid0IGRpc2FibGUgcGlw
ZSBvciBwaXBlIFBMTHMgaWYgbmVlZGVkICovCi0JaWYgKElTX0k4MzAoZGV2X3ByaXYpKQorCWlm
IChJU19JODMwKGk5MTUpKQogCQlyZXR1cm47CiAKIAkvKiBNYWtlIHN1cmUgdGhlIHBpcGUgaXNu
J3Qgc3RpbGwgcmVseWluZyBvbiB1cyAqLwotCWFzc2VydF9waXBlX2Rpc2FibGVkKGRldl9wcml2
LCBwaXBlKTsKKwlhc3NlcnRfcGlwZV9kaXNhYmxlZChpOTE1LCBwaXBlKTsKIAogCUk5MTVfV1JJ
VEUoRFBMTChwaXBlKSwgRFBMTF9WR0FfTU9ERV9ESVMpOwogCVBPU1RJTkdfUkVBRChEUExMKHBp
cGUpKTsKIH0KIAotc3RhdGljIHZvaWQgdmx2X2Rpc2FibGVfcGxsKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCitzdGF0aWMgdm9pZCB2bHZfZGlzYWJs
ZV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcGlwZSBwaXBlKQogewog
CXUzMiB2YWw7CiAKIAkvKiBNYWtlIHN1cmUgdGhlIHBpcGUgaXNuJ3Qgc3RpbGwgcmVseWluZyBv
biB1cyAqLwotCWFzc2VydF9waXBlX2Rpc2FibGVkKGRldl9wcml2LCBwaXBlKTsKKwlhc3NlcnRf
cGlwZV9kaXNhYmxlZChpOTE1LCBwaXBlKTsKIAogCXZhbCA9IERQTExfSU5URUdSQVRFRF9SRUZf
Q0xLX1ZMViB8CiAJCURQTExfUkVGX0NMS19FTkFCTEVfVkxWIHwgRFBMTF9WR0FfTU9ERV9ESVM7
CkBAIC0xNTY0LDEzICsxNTY0LDEzIEBAIHN0YXRpYyB2b2lkIHZsdl9kaXNhYmxlX3BsbChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQogCVBPU1RJTkdf
UkVBRChEUExMKHBpcGUpKTsKIH0KIAotc3RhdGljIHZvaWQgY2h2X2Rpc2FibGVfcGxsKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCitzdGF0aWMgdm9p
ZCBjaHZfZGlzYWJsZV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcGlw
ZSBwaXBlKQogewogCWVudW0gZHBpb19jaGFubmVsIHBvcnQgPSB2bHZfcGlwZV90b19jaGFubmVs
KHBpcGUpOwogCXUzMiB2YWw7CiAKIAkvKiBNYWtlIHN1cmUgdGhlIHBpcGUgaXNuJ3Qgc3RpbGwg
cmVseWluZyBvbiB1cyAqLwotCWFzc2VydF9waXBlX2Rpc2FibGVkKGRldl9wcml2LCBwaXBlKTsK
Kwlhc3NlcnRfcGlwZV9kaXNhYmxlZChpOTE1LCBwaXBlKTsKIAogCXZhbCA9IERQTExfU1NDX1JF
Rl9DTEtfQ0hWIHwKIAkJRFBMTF9SRUZfQ0xLX0VOQUJMRV9WTFYgfCBEUExMX1ZHQV9NT0RFX0RJ
UzsKQEAgLTE1ODAsMTcgKzE1ODAsMTcgQEAgc3RhdGljIHZvaWQgY2h2X2Rpc2FibGVfcGxsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJSTkxNV9X
UklURShEUExMKHBpcGUpLCB2YWwpOwogCVBPU1RJTkdfUkVBRChEUExMKHBpcGUpKTsKIAotCXZs
dl9kcGlvX2dldChkZXZfcHJpdik7CisJdmx2X2RwaW9fZ2V0KGk5MTUpOwogCiAJLyogRGlzYWJs
ZSAxMGJpdCBjbG9jayB0byBkaXNwbGF5IGNvbnRyb2xsZXIgKi8KLQl2YWwgPSB2bHZfZHBpb19y
ZWFkKGRldl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCkpOworCXZhbCA9IHZsdl9kcGlv
X3JlYWQoaTkxNSwgcGlwZSwgQ0hWX0NNTl9EVzE0KHBvcnQpKTsKIAl2YWwgJj0gfkRQSU9fRENM
S1BfRU47Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9DTU5fRFcxNChwb3J0
KSwgdmFsKTsKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCks
IHZhbCk7CiAKLQl2bHZfZHBpb19wdXQoZGV2X3ByaXYpOworCXZsdl9kcGlvX3B1dChpOTE1KTsK
IH0KIAotdm9pZCB2bHZfd2FpdF9wb3J0X3JlYWR5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3ZvaWQgdmx2X3dhaXRfcG9ydF9yZWFkeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCSBzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkcG9ydCwKIAkJCSB1bnNp
Z25lZCBpbnQgZXhwZWN0ZWRfbWFzaykKIHsKQEAgLTE2MTUsNyArMTYxNSw3IEBAIHZvaWQgdmx2
X3dhaXRfcG9ydF9yZWFkeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCUJV
RygpOwogCX0KIAotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29y
ZSwKKwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkgICAg
ZHBsbF9yZWcsIHBvcnRfbWFzaywgZXhwZWN0ZWRfbWFzaywKIAkJCQkgICAgMTAwMCkpCiAJCVdB
Uk4oMSwgInRpbWVkIG91dCB3YWl0aW5nIGZvciBwb3J0ICVjIHJlYWR5OiBnb3QgMHgleCwgZXhw
ZWN0ZWQgMHgleFxuIiwKQEAgLTE2MjYsMTkgKzE2MjYsMTkgQEAgdm9pZCB2bHZfd2FpdF9wb3J0
X3JlYWR5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIHN0YXRpYyB2b2lkIGly
b25sYWtlX2VuYWJsZV9wY2hfdHJhbnNjb2Rlcihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIAlpOTE1X3JlZ190IHJlZzsKIAl1MzIgdmFsLCBwaXBlY29uZl92YWw7CiAKIAkv
KiBNYWtlIHN1cmUgUENIIERQTEwgaXMgZW5hYmxlZCAqLwotCWFzc2VydF9zaGFyZWRfZHBsbF9l
bmFibGVkKGRldl9wcml2LCBjcnRjX3N0YXRlLT5zaGFyZWRfZHBsbCk7CisJYXNzZXJ0X3NoYXJl
ZF9kcGxsX2VuYWJsZWQoaTkxNSwgY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwpOwogCiAJLyogRkRJ
IG11c3QgYmUgZmVlZGluZyB1cyBiaXRzIGZvciBQQ0ggcG9ydHMgKi8KLQlhc3NlcnRfZmRpX3R4
X2VuYWJsZWQoZGV2X3ByaXYsIHBpcGUpOwotCWFzc2VydF9mZGlfcnhfZW5hYmxlZChkZXZfcHJp
diwgcGlwZSk7CisJYXNzZXJ0X2ZkaV90eF9lbmFibGVkKGk5MTUsIHBpcGUpOworCWFzc2VydF9m
ZGlfcnhfZW5hYmxlZChpOTE1LCBwaXBlKTsKIAotCWlmIChIQVNfUENIX0NQVChkZXZfcHJpdikp
IHsKKwlpZiAoSEFTX1BDSF9DUFQoaTkxNSkpIHsKIAkJLyogV29ya2Fyb3VuZDogU2V0IHRoZSB0
aW1pbmcgb3ZlcnJpZGUgYml0IGJlZm9yZSBlbmFibGluZyB0aGUKIAkJICogcGNoIHRyYW5zY29k
ZXIuICovCiAJCXJlZyA9IFRSQU5TX0NISUNLRU4yKHBpcGUpOwpAQCAtMTY1MSw3ICsxNjUxLDcg
QEAgc3RhdGljIHZvaWQgaXJvbmxha2VfZW5hYmxlX3BjaF90cmFuc2NvZGVyKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3MKIAl2YWwgPSBJOTE1X1JFQUQocmVnKTsKIAlwaXBl
Y29uZl92YWwgPSBJOTE1X1JFQUQoUElQRUNPTkYocGlwZSkpOwogCi0JaWYgKEhBU19QQ0hfSUJY
KGRldl9wcml2KSkgeworCWlmIChIQVNfUENIX0lCWChpOTE1KSkgewogCQkvKgogCQkgKiBNYWtl
IHRoZSBCUEMgaW4gdHJhbnNjb2RlciBiZSBjb25zaXN0ZW50IHdpdGgKIAkJICogdGhhdCBpbiBw
aXBlY29uZiByZWcuIEZvciBIRE1JIHdlIG11c3QgdXNlIDhicGMKQEAgLTE2NjYsNyArMTY2Niw3
IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2VuYWJsZV9wY2hfdHJhbnNjb2Rlcihjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zCiAKIAl2YWwgJj0gflRSQU5TX0lOVEVSTEFDRV9N
QVNLOwogCWlmICgocGlwZWNvbmZfdmFsICYgUElQRUNPTkZfSU5URVJMQUNFX01BU0spID09IFBJ
UEVDT05GX0lOVEVSTEFDRURfSUxLKSB7Ci0JCWlmIChIQVNfUENIX0lCWChkZXZfcHJpdikgJiYK
KwkJaWYgKEhBU19QQ0hfSUJYKGk5MTUpICYmCiAJCSAgICBpbnRlbF9jcnRjX2hhc190eXBlKGNy
dGNfc3RhdGUsIElOVEVMX09VVFBVVF9TRFZPKSkKIAkJCXZhbCB8PSBUUkFOU19MRUdBQ1lfSU5U
RVJMQUNFRF9JTEs7CiAJCWVsc2UKQEAgLTE2NzYsMjAgKzE2NzYsMjAgQEAgc3RhdGljIHZvaWQg
aXJvbmxha2VfZW5hYmxlX3BjaF90cmFuc2NvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3MKIAl9CiAKIAlJOTE1X1dSSVRFKHJlZywgdmFsIHwgVFJBTlNfRU5BQkxFKTsK
LQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYgKGlu
dGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIHJlZywgVFJBTlNf
U1RBVEVfRU5BQkxFLCBUUkFOU19TVEFURV9FTkFCTEUsCiAJCQkJICAgIDEwMCkpCiAJCURSTV9F
UlJPUigiZmFpbGVkIHRvIGVuYWJsZSB0cmFuc2NvZGVyICVjXG4iLCBwaXBlX25hbWUocGlwZSkp
OwogfQogCi1zdGF0aWMgdm9pZCBscHRfZW5hYmxlX3BjaF90cmFuc2NvZGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGxwdF9lbmFibGVfcGNoX3RyYW5z
Y29kZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgZW51bSB0cmFu
c2NvZGVyIGNwdV90cmFuc2NvZGVyKQogewogCXUzMiB2YWwsIHBpcGVjb25mX3ZhbDsKIAogCS8q
IEZESSBtdXN0IGJlIGZlZWRpbmcgdXMgYml0cyBmb3IgUENIIHBvcnRzICovCi0JYXNzZXJ0X2Zk
aV90eF9lbmFibGVkKGRldl9wcml2LCAoZW51bSBwaXBlKSBjcHVfdHJhbnNjb2Rlcik7Ci0JYXNz
ZXJ0X2ZkaV9yeF9lbmFibGVkKGRldl9wcml2LCBQSVBFX0EpOworCWFzc2VydF9mZGlfdHhfZW5h
YmxlZChpOTE1LCAoZW51bSBwaXBlKSBjcHVfdHJhbnNjb2Rlcik7CisJYXNzZXJ0X2ZkaV9yeF9l
bmFibGVkKGk5MTUsIFBJUEVfQSk7CiAKIAkvKiBXb3JrYXJvdW5kOiBzZXQgdGltaW5nIG92ZXJy
aWRlIGJpdC4gKi8KIAl2YWwgPSBJOTE1X1JFQUQoVFJBTlNfQ0hJQ0tFTjIoUElQRV9BKSk7CkBA
IC0xNzA2LDcgKzE3MDYsNyBAQCBzdGF0aWMgdm9pZCBscHRfZW5hYmxlX3BjaF90cmFuc2NvZGVy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJdmFsIHw9IFRSQU5TX1BST0dS
RVNTSVZFOwogCiAJSTkxNV9XUklURShMUFRfVFJBTlNDT05GLCB2YWwpOwotCWlmIChpbnRlbF93
YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwlpZiAoaW50ZWxfd2FpdF9mb3Jf
cmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkgICAgTFBUX1RSQU5TQ09ORiwKIAkJCQkgICAg
VFJBTlNfU1RBVEVfRU5BQkxFLAogCQkJCSAgICBUUkFOU19TVEFURV9FTkFCTEUsCkBAIC0xNzE0
LDMwICsxNzE0LDMwIEBAIHN0YXRpYyB2b2lkIGxwdF9lbmFibGVfcGNoX3RyYW5zY29kZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlEUk1fRVJST1IoIkZhaWxlZCB0byBl
bmFibGUgUENIIHRyYW5zY29kZXJcbiIpOwogfQogCi1zdGF0aWMgdm9pZCBpcm9ubGFrZV9kaXNh
YmxlX3BjaF90cmFuc2NvZGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0
YXRpYyB2b2lkIGlyb25sYWtlX2Rpc2FibGVfcGNoX3RyYW5zY29kZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSAgICBlbnVtIHBpcGUgcGlwZSkKIHsKIAlpOTE1X3JlZ190
IHJlZzsKIAl1MzIgdmFsOwogCiAJLyogRkRJIHJlbGllcyBvbiB0aGUgdHJhbnNjb2RlciAqLwot
CWFzc2VydF9mZGlfdHhfZGlzYWJsZWQoZGV2X3ByaXYsIHBpcGUpOwotCWFzc2VydF9mZGlfcnhf
ZGlzYWJsZWQoZGV2X3ByaXYsIHBpcGUpOworCWFzc2VydF9mZGlfdHhfZGlzYWJsZWQoaTkxNSwg
cGlwZSk7CisJYXNzZXJ0X2ZkaV9yeF9kaXNhYmxlZChpOTE1LCBwaXBlKTsKIAogCS8qIFBvcnRz
IG11c3QgYmUgb2ZmIGFzIHdlbGwgKi8KLQlhc3NlcnRfcGNoX3BvcnRzX2Rpc2FibGVkKGRldl9w
cml2LCBwaXBlKTsKKwlhc3NlcnRfcGNoX3BvcnRzX2Rpc2FibGVkKGk5MTUsIHBpcGUpOwogCiAJ
cmVnID0gUENIX1RSQU5TQ09ORihwaXBlKTsKIAl2YWwgPSBJOTE1X1JFQUQocmVnKTsKIAl2YWwg
Jj0gflRSQU5TX0VOQUJMRTsKIAlJOTE1X1dSSVRFKHJlZywgdmFsKTsKIAkvKiB3YWl0IGZvciBQ
Q0ggdHJhbnNjb2RlciBvZmYsIHRyYW5zY29kZXIgc3RhdGUgKi8KLQlpZiAoaW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lz
dGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIHJlZywgVFJBTlNfU1RBVEVfRU5BQkxFLCAwLAog
CQkJCSAgICA1MCkpCiAJCURSTV9FUlJPUigiZmFpbGVkIHRvIGRpc2FibGUgdHJhbnNjb2RlciAl
Y1xuIiwgcGlwZV9uYW1lKHBpcGUpKTsKIAotCWlmIChIQVNfUENIX0NQVChkZXZfcHJpdikpIHsK
KwlpZiAoSEFTX1BDSF9DUFQoaTkxNSkpIHsKIAkJLyogV29ya2Fyb3VuZDogQ2xlYXIgdGhlIHRp
bWluZyBvdmVycmlkZSBjaGlja2VuIGJpdCBhZ2Fpbi4gKi8KIAkJcmVnID0gVFJBTlNfQ0hJQ0tF
TjIocGlwZSk7CiAJCXZhbCA9IEk5MTVfUkVBRChyZWcpOwpAQCAtMTc0Niw3ICsxNzQ2LDcgQEAg
c3RhdGljIHZvaWQgaXJvbmxha2VfZGlzYWJsZV9wY2hfdHJhbnNjb2RlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi12b2lkIGxwdF9kaXNhYmxlX3BjaF90cmFu
c2NvZGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgbHB0X2Rpc2Fi
bGVfcGNoX3RyYW5zY29kZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMy
IHZhbDsKIApAQCAtMTc1NCw3ICsxNzU0LDcgQEAgdm9pZCBscHRfZGlzYWJsZV9wY2hfdHJhbnNj
b2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJdmFsICY9IH5UUkFOU19F
TkFCTEU7CiAJSTkxNV9XUklURShMUFRfVFJBTlNDT05GLCB2YWwpOwogCS8qIHdhaXQgZm9yIFBD
SCB0cmFuc2NvZGVyIG9mZiwgdHJhbnNjb2RlciBzdGF0ZSAqLwotCWlmIChpbnRlbF93YWl0X2Zv
cl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0
ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkgICAgTFBUX1RSQU5TQ09ORiwgVFJBTlNfU1RBVEVfRU5B
QkxFLCAwLAogCQkJCSAgICA1MCkpCiAJCURSTV9FUlJPUigiRmFpbGVkIHRvIGRpc2FibGUgUENI
IHRyYW5zY29kZXJcbiIpOwpAQCAtMTc2Nyw5ICsxNzY3LDkgQEAgdm9pZCBscHRfZGlzYWJsZV9w
Y2hfdHJhbnNjb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIGVudW0g
cGlwZSBpbnRlbF9jcnRjX3BjaF90cmFuc2NvZGVyKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAKLQlpZiAoSEFTX1BDSF9MUFQoZGV2X3ByaXYpKQorCWlmIChIQVNfUENIX0xQ
VChpOTE1KSkKIAkJcmV0dXJuIFBJUEVfQTsKIAllbHNlCiAJCXJldHVybiBjcnRjLT5waXBlOwpA
QCAtMTc3NywxOSArMTc3NywxOSBAQCBlbnVtIHBpcGUgaW50ZWxfY3J0Y19wY2hfdHJhbnNjb2Rl
cihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAogc3RhdGljIHUzMiBpbnRlbF9jcnRjX21heF92
YmxhbmtfY291bnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAogCS8qCiAJICogT24gaTk2NWdtIHRo
ZSBoYXJkd2FyZSBmcmFtZSBjb3VudGVyIHJlYWRzCiAJICogemVybyB3aGVuIHRoZSBUViBlbmNv
ZGVyIGlzIGVuYWJsZWQgOigKIAkgKi8KLQlpZiAoSVNfSTk2NUdNKGRldl9wcml2KSAmJgorCWlm
IChJU19JOTY1R00oaTkxNSkgJiYKIAkgICAgKGNydGNfc3RhdGUtPm91dHB1dF90eXBlcyAmIEJJ
VChJTlRFTF9PVVRQVVRfVFZPVVQpKSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSA1IHx8IElTX0c0WChkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+
PSA1IHx8IElTX0c0WChpOTE1KSkKIAkJcmV0dXJuIDB4ZmZmZmZmZmY7IC8qIGZ1bGwgMzIgYml0
IGNvdW50ZXIgKi8KLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDMpCisJZWxzZSBp
ZiAoSU5URUxfR0VOKGk5MTUpID49IDMpCiAJCXJldHVybiAweGZmZmZmZjsgLyogb25seSAyNCBi
aXRzIG9mIGZyYW1lIGNvdW50ICovCiAJZWxzZQogCQlyZXR1cm4gMDsgLyogR2VuMiBkb2Vzbid0
IGhhdmUgYSBoYXJkd2FyZSBmcmFtZSBjb3VudGVyICovCkBAIC0xODA3LDcgKzE4MDcsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9jcnRjX3ZibGFua19vbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9waXBlKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBuZXdfY3J0Y19zdGF0ZS0+
Y3B1X3RyYW5zY29kZXI7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWk5MTVfcmVn
X3QgcmVnOwpAQCAtMTgyMiwyOSArMTgyMiwyOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9lbmFibGVf
cGlwZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJICog
YSBwbGFuZS4gIE9uIElMSysgdGhlIHBpcGUgUExMcyBhcmUgaW50ZWdyYXRlZCwgc28gd2UgZG9u
J3QKIAkgKiBuZWVkIHRoZSBjaGVjay4KIAkgKi8KLQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpKSB7
CisJaWYgKEhBU19HTUNIKGk5MTUpKSB7CiAJCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKG5ld19j
cnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFNJKSkKLQkJCWFzc2VydF9kc2lfcGxsX2VuYWJsZWQo
ZGV2X3ByaXYpOworCQkJYXNzZXJ0X2RzaV9wbGxfZW5hYmxlZChpOTE1KTsKIAkJZWxzZQotCQkJ
YXNzZXJ0X3BsbF9lbmFibGVkKGRldl9wcml2LCBwaXBlKTsKKwkJCWFzc2VydF9wbGxfZW5hYmxl
ZChpOTE1LCBwaXBlKTsKIAl9IGVsc2UgewogCQlpZiAobmV3X2NydGNfc3RhdGUtPmhhc19wY2hf
ZW5jb2RlcikgewogCQkJLyogaWYgZHJpdmluZyB0aGUgUENILCB3ZSBuZWVkIEZESSBlbmFibGVk
ICovCi0JCQlhc3NlcnRfZmRpX3J4X3BsbF9lbmFibGVkKGRldl9wcml2LAorCQkJYXNzZXJ0X2Zk
aV9yeF9wbGxfZW5hYmxlZChpOTE1LAogCQkJCQkJICBpbnRlbF9jcnRjX3BjaF90cmFuc2NvZGVy
KGNydGMpKTsKLQkJCWFzc2VydF9mZGlfdHhfcGxsX2VuYWJsZWQoZGV2X3ByaXYsCisJCQlhc3Nl
cnRfZmRpX3R4X3BsbF9lbmFibGVkKGk5MTUsCiAJCQkJCQkgIChlbnVtIHBpcGUpIGNwdV90cmFu
c2NvZGVyKTsKIAkJfQogCQkvKiBGSVhNRTogYXNzZXJ0IENQVSBwb3J0IGNvbmRpdGlvbnMgZm9y
IFNOQisgKi8KIAl9CiAKLQl0cmFjZV9pbnRlbF9waXBlX2VuYWJsZShkZXZfcHJpdiwgcGlwZSk7
CisJdHJhY2VfaW50ZWxfcGlwZV9lbmFibGUoaTkxNSwgcGlwZSk7CiAKIAlyZWcgPSBQSVBFQ09O
RihjcHVfdHJhbnNjb2Rlcik7CiAJdmFsID0gSTkxNV9SRUFEKHJlZyk7CiAJaWYgKHZhbCAmIFBJ
UEVDT05GX0VOQUJMRSkgewogCQkvKiB3ZSBrZWVwIGJvdGggcGlwZXMgZW5hYmxlZCBvbiA4MzAg
Ki8KLQkJV0FSTl9PTighSVNfSTgzMChkZXZfcHJpdikpOworCQlXQVJOX09OKCFJU19JODMwKGk5
MTUpKTsKIAkJcmV0dXJuOwogCX0KIApAQCAtMTg2NSw3ICsxODY1LDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZW5hYmxlX3BpcGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRj
X3N0YXRlKQogc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9waXBlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAll
bnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBvbGRfY3J0Y19zdGF0ZS0+Y3B1X3RyYW5z
Y29kZXI7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWk5MTVfcmVnX3QgcmVnOwpA
QCAtMTg3OSw3ICsxODc5LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9waXBlKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIAkgKi8KIAlhc3NlcnRf
cGxhbmVzX2Rpc2FibGVkKGNydGMpOwogCi0JdHJhY2VfaW50ZWxfcGlwZV9kaXNhYmxlKGRldl9w
cml2LCBwaXBlKTsKKwl0cmFjZV9pbnRlbF9waXBlX2Rpc2FibGUoaTkxNSwgcGlwZSk7CiAKIAly
ZWcgPSBQSVBFQ09ORihjcHVfdHJhbnNjb2Rlcik7CiAJdmFsID0gSTkxNV9SRUFEKHJlZyk7CkBA
IC0xODk0LDcgKzE4OTQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kaXNhYmxlX3BpcGUoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogCQl2YWwgJj0gflBJUEVD
T05GX0RPVUJMRV9XSURFOwogCiAJLyogRG9uJ3QgZGlzYWJsZSBwaXBlIG9yIHBpcGUgUExMcyBp
ZiBuZWVkZWQgKi8KLQlpZiAoIUlTX0k4MzAoZGV2X3ByaXYpKQorCWlmICghSVNfSTgzMChpOTE1
KSkKIAkJdmFsICY9IH5QSVBFQ09ORl9FTkFCTEU7CiAKIAlJOTE1X1dSSVRFKHJlZywgdmFsKTsK
QEAgLTE5MDIsMjIgKzE5MDIsMjIgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9waXBlKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIAkJaW50ZWxfd2Fp
dF9mb3JfcGlwZV9vZmYob2xkX2NydGNfc3RhdGUpOwogfQogCi1zdGF0aWMgdW5zaWduZWQgaW50
IGludGVsX3RpbGVfc2l6ZShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX3RpbGVfc2l6ZShjb25zdCBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1cm4gSVNfR0VOKGRldl9wcml2LCAyKSA/IDIwNDgg
OiA0MDk2OworCXJldHVybiBJU19HRU4oaTkxNSwgMikgPyAyMDQ4IDogNDA5NjsKIH0KIAogc3Rh
dGljIHVuc2lnbmVkIGludAogaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZmItPmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGZiLT5kZXYpOwogCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+
Zm9ybWF0LT5jcHBbY29sb3JfcGxhbmVdOwogCiAJc3dpdGNoIChmYi0+bW9kaWZpZXIpIHsKIAlj
YXNlIERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKLQkJcmV0dXJuIGludGVsX3RpbGVfc2l6ZShkZXZf
cHJpdik7CisJCXJldHVybiBpbnRlbF90aWxlX3NpemUoaTkxNSk7CiAJY2FzZSBJOTE1X0ZPUk1B
VF9NT0RfWF9USUxFRDoKLQkJaWYgKElTX0dFTihkZXZfcHJpdiwgMikpCisJCWlmIChJU19HRU4o
aTkxNSwgMikpCiAJCQlyZXR1cm4gMTI4OwogCQllbHNlCiAJCQlyZXR1cm4gNTEyOwpAQCAtMTky
Niw3ICsxOTI2LDcgQEAgaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogCQkJcmV0dXJuIDEyODsKIAkJLyogZmFs
bCB0aHJvdWdoICovCiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKLQkJaWYgKElTX0dF
TihkZXZfcHJpdiwgMikgfHwgSEFTXzEyOF9CWVRFX1lfVElMSU5HKGRldl9wcml2KSkKKwkJaWYg
KElTX0dFTihpOTE1LCAyKSB8fCBIQVNfMTI4X0JZVEVfWV9USUxJTkcoaTkxNSkpCiAJCQlyZXR1
cm4gMTI4OwogCQllbHNlCiAJCQlyZXR1cm4gNTEyOwpAQCAtMjAxNywyNiArMjAxNywyNiBAQCBp
bnRlbF9maWxsX2ZiX2dndHRfdmlldyhzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcgKnZpZXcsCiAJfQog
fQogCi1zdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2N1cnNvcl9hbGlnbm1lbnQoY29uc3Qgc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHVuc2lnbmVkIGludCBpbnRl
bF9jdXJzb3JfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCWlmIChJU19JODMwKGRldl9wcml2KSkKKwlpZiAoSVNfSTgzMChpOTE1KSkKIAkJcmV0dXJu
IDE2ICogMTAyNDsKLQllbHNlIGlmIChJU19JODVYKGRldl9wcml2KSkKKwllbHNlIGlmIChJU19J
ODVYKGk5MTUpKQogCQlyZXR1cm4gMjU2OwotCWVsc2UgaWYgKElTX0k4NDVHKGRldl9wcml2KSB8
fCBJU19JODY1RyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfSTg0NUcoaTkxNSkgfHwgSVNfSTg2
NUcoaTkxNSkpCiAJCXJldHVybiAzMjsKIAllbHNlCiAJCXJldHVybiA0ICogMTAyNDsKIH0KIAot
c3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9saW5lYXJfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfbGlu
ZWFyX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkK
IAkJcmV0dXJuIDI1NiAqIDEwMjQ7Ci0JZWxzZSBpZiAoSVNfSTk2NUcoZGV2X3ByaXYpIHx8IElT
X0k5NjVHTShkZXZfcHJpdikgfHwKLQkJIElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NI
RVJSWVZJRVcoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0k5NjVHKGk5MTUpIHx8IElTX0k5NjVH
TShpOTE1KSB8fAorCQkgSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUp
KQogCQlyZXR1cm4gMTI4ICogMTAyNDsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDQpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDQpCiAJCXJldHVybiA0ICogMTAyNDsK
IAllbHNlCiAJCXJldHVybiAwOwpAQCAtMjA0NSw3ICsyMDQ1LDcgQEAgc3RhdGljIHVuc2lnbmVk
IGludCBpbnRlbF9saW5lYXJfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHIKIHN0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJCQkJCSBpbnQgY29sb3JfcGxhbmUpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShmYi0+ZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZmItPmRldik7CiAKIAkvKiBB
VVhfRElTVCBuZWVkcyBvbmx5IDRLIGFsaWdubWVudCAqLwogCWlmIChjb2xvcl9wbGFuZSA9PSAx
KQpAQCAtMjA1Myw5ICsyMDUzLDkgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9zdXJmX2Fs
aWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAogCXN3aXRjaCAoZmIt
Pm1vZGlmaWVyKSB7CiAJY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6Ci0JCXJldHVybiBpbnRl
bF9saW5lYXJfYWxpZ25tZW50KGRldl9wcml2KTsKKwkJcmV0dXJuIGludGVsX2xpbmVhcl9hbGln
bm1lbnQoaTkxNSk7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDoKLQkJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gOSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQkJcmV0
dXJuIDI1NiAqIDEwMjQ7CiAJCXJldHVybiAwOwogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfQ0NTOgpAQCAtMjA3Miw5ICsyMDcyLDkgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9z
dXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIHN0YXRpYyBi
b29sIGludGVsX3BsYW5lX3VzZXNfZmVuY2UoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxf
cGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAotCXJldHVybiBJTlRF
TF9HRU4oZGV2X3ByaXYpIDwgNCB8fAorCXJldHVybiBJTlRFTF9HRU4oaTkxNSkgPCA0IHx8CiAJ
CShwbGFuZS0+aGFzX2ZiYyAmJgogCQkgcGxhbmVfc3RhdGUtPnZpZXcudHlwZSA9PSBJOTE1X0dH
VFRfVklFV19OT1JNQUwpOwogfQpAQCAtMjA4Niw3ICsyMDg2LDcgQEAgaW50ZWxfcGluX2FuZF9m
ZW5jZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJCQkgICB1bnNpZ25lZCBs
b25nICpvdXRfZmxhZ3MpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGZiLT5kZXY7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCWludGVsX3dha2VyZWZfdCB3
YWtlcmVmOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtMjEwMiw3ICsyMTAyLDcgQEAgaW50
ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJICog
d2Ugc2hvdWxkIGFsd2F5cyBoYXZlIHZhbGlkIFBURSBmb2xsb3dpbmcgdGhlIHNjYW5vdXQgcHJl
dmVudGluZwogCSAqIHRoZSBWVC1kIHdhcm5pbmcuCiAJICovCi0JaWYgKGludGVsX3NjYW5vdXRf
bmVlZHNfdnRkX3dhKGRldl9wcml2KSAmJiBhbGlnbm1lbnQgPCAyNTYgKiAxMDI0KQorCWlmIChp
bnRlbF9zY2Fub3V0X25lZWRzX3Z0ZF93YShpOTE1KSAmJiBhbGlnbm1lbnQgPCAyNTYgKiAxMDI0
KQogCQlhbGlnbm1lbnQgPSAyNTYgKiAxMDI0OwogCiAJLyoKQEAgLTIxMTIsMTAgKzIxMTIsMTAg
QEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
CiAJICogaW50ZWxfcnVudGltZV9wbV9wdXQoKSwgc28gaXQgaXMgY29ycmVjdCB0byB3cmFwIG9u
bHkgdGhlCiAJICogcGluL3VucGluL2ZlbmNlIGFuZCBub3QgbW9yZS4KIAkgKi8KLQl3YWtlcmVm
ID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50
aW1lX3BtX2dldChpOTE1KTsKIAlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwogCi0JYXRvbWlj
X2luYygmZGV2X3ByaXYtPmdwdV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7CisJYXRvbWljX2luYygm
aTkxNS0+Z3B1X2Vycm9yLnBlbmRpbmdfZmJfcGluKTsKIAogCXBpbmN0bCA9IDA7CiAKQEAgLTIx
MjYsNyArMjEyNiw3IEBAIGludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiLAogCSAqIGNvbXBsaWNhdGVkIHRoYW4gdGhpcy4gRm9yIGV4YW1wbGUsIENo
ZXJyeXZpZXcgYXBwZWFycyBxdWl0ZQogCSAqIGhhcHB5IHRvIHNjYW5vdXQgZnJvbSBhbnl3aGVy
ZSB3aXRoaW4gaXRzIGdsb2JhbCBhcGVydHVyZS4KIAkgKi8KLQlpZiAoSEFTX0dNQ0goZGV2X3By
aXYpKQorCWlmIChIQVNfR01DSChpOTE1KSkKIAkJcGluY3RsIHw9IFBJTl9NQVBQQUJMRTsKIAog
CXZtYSA9IGk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShvYmosCkBAIC0yMTU0
LDcgKzIxNTQsNyBAQCBpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwKIAkJICogbW9kZSB0aGF0IG1hdGNoZXMgdGhlIHVzZXIgY29uZmlndXJhdGlv
bi4KIAkJICovCiAJCXJldCA9IGk5MTVfdm1hX3Bpbl9mZW5jZSh2bWEpOwotCQlpZiAocmV0ICE9
IDAgJiYgSU5URUxfR0VOKGRldl9wcml2KSA8IDQpIHsKKwkJaWYgKHJldCAhPSAwICYmIElOVEVM
X0dFTihpOTE1KSA8IDQpIHsKIAkJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9mcm9tX2Rpc3BsYXlf
cGxhbmUodm1hKTsKIAkJCXZtYSA9IEVSUl9QVFIocmV0KTsKIAkJCWdvdG8gZXJyOwpAQCAtMjE2
NiwxMCArMjE2NiwxMCBAQCBpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwKIAogCWk5MTVfdm1hX2dldCh2bWEpOwogZXJyOgotCWF0b21pY19kZWMo
JmRldl9wcml2LT5ncHVfZXJyb3IucGVuZGluZ19mYl9waW4pOworCWF0b21pY19kZWMoJmk5MTUt
PmdwdV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7CiAKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9i
aik7Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYsIHdha2VyZWYpOworCWludGVsX3J1
bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwogCXJldHVybiB2bWE7CiB9CiAKQEAgLTIyNjUs
NyArMjI2NSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAq
eCwgaW50ICp5LAogCQkJCSAgICAgICB1bnNpZ25lZCBpbnQgcGl0Y2gsCiAJCQkJICAgICAgIHUz
MiBvbGRfb2Zmc2V0LCB1MzIgbmV3X29mZnNldCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGZiLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShmYi0+ZGV2KTsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmItPmZvcm1h
dC0+Y3BwW2NvbG9yX3BsYW5lXTsKIAogCVdBUk5fT04obmV3X29mZnNldCA+IG9sZF9vZmZzZXQp
OwpAQCAtMjI3NCw3ICsyMjc0LDcgQEAgc3RhdGljIHUzMiBpbnRlbF9hZGp1c3RfYWxpZ25lZF9v
ZmZzZXQoaW50ICp4LCBpbnQgKnksCiAJCXVuc2lnbmVkIGludCB0aWxlX3NpemUsIHRpbGVfd2lk
dGgsIHRpbGVfaGVpZ2h0OwogCQl1bnNpZ25lZCBpbnQgcGl0Y2hfdGlsZXM7CiAKLQkJdGlsZV9z
aXplID0gaW50ZWxfdGlsZV9zaXplKGRldl9wcml2KTsKKwkJdGlsZV9zaXplID0gaW50ZWxfdGls
ZV9zaXplKGk5MTUpOwogCQlpbnRlbF90aWxlX2RpbXMoZmIsIGNvbG9yX3BsYW5lLCAmdGlsZV93
aWR0aCwgJnRpbGVfaGVpZ2h0KTsKIAogCQlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3Rh
dGlvbikpIHsKQEAgLTIzMjYsNyArMjMyNiw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfcGxhbmVfYWRq
dXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAogICogdXNlZC4gVGhpcyBpcyB3aHkg
dGhlIHVzZXIgaGFzIHRvIHBhc3MgaW4gdGhlIHBpdGNoIHNpbmNlIGl0CiAgKiBpcyBzcGVjaWZp
ZWQgaW4gdGhlIHJvdGF0ZWQgb3JpZW50YXRpb24uCiAgKi8KLXN0YXRpYyB1MzIgaW50ZWxfY29t
cHV0ZV9hbGlnbmVkX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdTMyIGludGVsX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCQkJCWludCAqeCwgaW50ICp5LAogCQkJCQljb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwKIAkJCQkJaW50IGNvbG9yX3BsYW5lLApAQCAtMjM0NCw3ICsyMzQ0
LDcgQEAgc3RhdGljIHUzMiBpbnRlbF9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJdW5zaWduZWQgaW50IHRpbGVfc2l6ZSwgdGlsZV93
aWR0aCwgdGlsZV9oZWlnaHQ7CiAJCXVuc2lnbmVkIGludCB0aWxlX3Jvd3MsIHRpbGVzLCBwaXRj
aF90aWxlczsKIAotCQl0aWxlX3NpemUgPSBpbnRlbF90aWxlX3NpemUoZGV2X3ByaXYpOworCQl0
aWxlX3NpemUgPSBpbnRlbF90aWxlX3NpemUoaTkxNSk7CiAJCWludGVsX3RpbGVfZGltcyhmYiwg
Y29sb3JfcGxhbmUsICZ0aWxlX3dpZHRoLCAmdGlsZV9oZWlnaHQpOwogCiAJCWlmIChkcm1fcm90
YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkgewpAQCAtMjM4MiwxOCArMjM4MiwxOCBAQCBzdGF0
aWMgdTMyIGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoaW50ICp4LCBpbnQgKnks
CiAJCQkJCSAgICAgIGludCBjb2xvcl9wbGFuZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmlu
dGVsX3BsYW5lID0gdG9faW50ZWxfcGxhbmUoc3RhdGUtPmJhc2UucGxhbmUpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfcGxhbmUtPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoaW50ZWxfcGxhbmUt
PmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHN0YXRlLT5i
YXNlLmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHN0YXRlLT5iYXNlLnJvdGF0aW9uOwog
CWludCBwaXRjaCA9IHN0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0uc3RyaWRlOwogCXUz
MiBhbGlnbm1lbnQ7CiAKIAlpZiAoaW50ZWxfcGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUikKLQkJ
YWxpZ25tZW50ID0gaW50ZWxfY3Vyc29yX2FsaWdubWVudChkZXZfcHJpdik7CisJCWFsaWdubWVu
dCA9IGludGVsX2N1cnNvcl9hbGlnbm1lbnQoaTkxNSk7CiAJZWxzZQogCQlhbGlnbm1lbnQgPSBp
bnRlbF9zdXJmX2FsaWdubWVudChmYiwgY29sb3JfcGxhbmUpOwogCi0JcmV0dXJuIGludGVsX2Nv
bXB1dGVfYWxpZ25lZF9vZmZzZXQoZGV2X3ByaXYsIHgsIHksIGZiLCBjb2xvcl9wbGFuZSwKKwly
ZXR1cm4gaW50ZWxfY29tcHV0ZV9hbGlnbmVkX29mZnNldChpOTE1LCB4LCB5LCBmYiwgY29sb3Jf
cGxhbmUsCiAJCQkJCSAgICBwaXRjaCwgcm90YXRpb24sIGFsaWdubWVudCk7CiB9CiAKQEAgLTI0
MDIsMTEgKzI0MDIsMTEgQEAgc3RhdGljIGludCBpbnRlbF9mYl9vZmZzZXRfdG9feHkoaW50ICp4
LCBpbnQgKnksCiAJCQkJIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCQkJCSBp
bnQgY29sb3JfcGxhbmUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShmYi0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZmItPmRldik7CiAJdW5zaWduZWQgaW50IGhlaWdodDsKIAogCWlmIChmYi0+bW9kaWZpZXIg
IT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSICYmCi0JICAgIGZiLT5vZmZzZXRzW2NvbG9yX3BsYW5l
XSAlIGludGVsX3RpbGVfc2l6ZShkZXZfcHJpdikpIHsKKwkgICAgZmItPm9mZnNldHNbY29sb3Jf
cGxhbmVdICUgaW50ZWxfdGlsZV9zaXplKGk5MTUpKSB7CiAJCURSTV9ERUJVR19LTVMoIk1pc2Fs
aWduZWQgb2Zmc2V0IDB4JTA4eCBmb3IgY29sb3IgcGxhbmUgJWRcbiIsCiAJCQkgICAgICBmYi0+
b2Zmc2V0c1tjb2xvcl9wbGFuZV0sIGNvbG9yX3BsYW5lKTsKIAkJcmV0dXJuIC1FSU5WQUw7CkBA
IC0yNTA3LDcgKzI1MDcsNyBAQCBib29sIGlzX2Njc19tb2RpZmllcih1NjQgbW9kaWZpZXIpCiAJ
ICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M7CiB9CiAKLXUz
MiBpbnRlbF9wbGFuZV9mYl9tYXhfc3RyaWRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3UzMiBpbnRlbF9wbGFuZV9mYl9tYXhfc3RyaWRlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJICAgICAgdTMyIHBpeGVsX2Zvcm1hdCwgdTY0IG1vZGlmaWVyKQogewog
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwpAQCAtMjUxNyw3ICsyNTE3LDcgQEAgdTMyIGludGVs
X3BsYW5lX2ZiX21heF9zdHJpZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CSAqIFdlIGFzc3VtZSB0aGUgcHJpbWFyeSBwbGFuZSBmb3IgcGlwZSBBIGhhcwogCSAqIHRoZSBo
aWdoZXN0IHN0cmlkZSBsaW1pdHMgb2YgdGhlbSBhbGwuCiAJICovCi0JY3J0YyA9IGludGVsX2dl
dF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBQSVBFX0EpOworCWNydGMgPSBpbnRlbF9nZXRfY3J0
Y19mb3JfcGlwZShpOTE1LCBQSVBFX0EpOwogCXBsYW5lID0gdG9faW50ZWxfcGxhbmUoY3J0Yy0+
YmFzZS5wcmltYXJ5KTsKIAogCXJldHVybiBwbGFuZS0+bWF4X3N0cmlkZShwbGFuZSwgcGl4ZWxf
Zm9ybWF0LCBtb2RpZmllciwKQEAgLTI1MjUsNyArMjUyNSw3IEBAIHUzMiBpbnRlbF9wbGFuZV9m
Yl9tYXhfc3RyaWRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogc3Rh
dGljCi11MzIgaW50ZWxfZmJfbWF4X3N0cmlkZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCit1MzIgaW50ZWxfZmJfbWF4X3N0cmlkZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCXUzMiBwaXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllcikKIHsKIAkvKgpAQCAtMjUz
NSwyMiArMjUzNSwyMiBAQCB1MzIgaW50ZWxfZmJfbWF4X3N0cmlkZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogVGhlIG5ldyBDQ1MgaGFzaCBtb2RlIG1ha2VzIHJlbWFw
cGluZyBpbXBvc3NpYmxlCiAJICovCiAJaWYgKCFpc19jY3NfbW9kaWZpZXIobW9kaWZpZXIpKSB7
Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDcpCisJCWlmIChJTlRFTF9HRU4oaTkxNSkg
Pj0gNykKIAkJCXJldHVybiAyNTYqMTAyNDsKLQkJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA0KQorCQllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkKIAkJCXJldHVybiAxMjgq
MTAyNDsKIAl9CiAKLQlyZXR1cm4gaW50ZWxfcGxhbmVfZmJfbWF4X3N0cmlkZShkZXZfcHJpdiwg
cGl4ZWxfZm9ybWF0LCBtb2RpZmllcik7CisJcmV0dXJuIGludGVsX3BsYW5lX2ZiX21heF9zdHJp
ZGUoaTkxNSwgcGl4ZWxfZm9ybWF0LCBtb2RpZmllcik7CiB9CiAKIHN0YXRpYyB1MzIKIGludGVs
X2ZiX3N0cmlkZV9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGlu
dCBjb2xvcl9wbGFuZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGZiLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShmYi0+ZGV2KTsKIAogCWlmIChmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFS
KSB7Ci0JCXUzMiBtYXhfc3RyaWRlID0gaW50ZWxfcGxhbmVfZmJfbWF4X3N0cmlkZShkZXZfcHJp
diwKKwkJdTMyIG1heF9zdHJpZGUgPSBpbnRlbF9wbGFuZV9mYl9tYXhfc3RyaWRlKGk5MTUsCiAJ
CQkJCQkJICAgZmItPmZvcm1hdC0+Zm9ybWF0LAogCQkJCQkJCSAgIGZiLT5tb2RpZmllcik7CiAK
QEAgLTI1NTksNyArMjU1OSw3IEBAIGludGVsX2ZiX3N0cmlkZV9hbGlnbm1lbnQoY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIAkJICogd2UgbmVlZCB0
aGUgc3RyaWRlIHRvIGJlIHBhZ2UgYWxpZ25lZC4KIAkJICovCiAJCWlmIChmYi0+cGl0Y2hlc1tj
b2xvcl9wbGFuZV0gPiBtYXhfc3RyaWRlKQotCQkJcmV0dXJuIGludGVsX3RpbGVfc2l6ZShkZXZf
cHJpdik7CisJCQlyZXR1cm4gaW50ZWxfdGlsZV9zaXplKGk5MTUpOwogCQllbHNlCiAJCQlyZXR1
cm4gNjQ7CiAJfSBlbHNlIHsKQEAgLTI1NzAsNyArMjU3MCw3IEBAIGludGVsX2ZiX3N0cmlkZV9h
bGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFu
ZSkKIGJvb2wgaW50ZWxfcGxhbmVfY2FuX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAlpbnQgaTsK
IApAQCAtMjU4NCw3ICsyNTg0LDcgQEAgYm9vbCBpbnRlbF9wbGFuZV9jYW5fcmVtYXAoY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkgKiBXb3VsZCBhbHNvIG5l
ZWQgdG8gZGVhbCB3aXRoIHRoZSBmZW5jZSBQT1QgYWxpZ25tZW50CiAJICogYW5kIGdlbjIgMktp
QiBHVFQgdGlsZSBzaXplLgogCSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCkKKwlp
ZiAoSU5URUxfR0VOKGk5MTUpIDwgNCkKIAkJcmV0dXJuIGZhbHNlOwogCiAJLyoKQEAgLTI1OTYs
NyArMjU5Niw3IEBAIGJvb2wgaW50ZWxfcGxhbmVfY2FuX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIAkvKiBMaW5lYXIgbmVlZHMgYSBwYWdlIGFs
aWduZWQgc3RyaWRlIGZvciByZW1hcHBpbmcgKi8KIAlpZiAoZmItPm1vZGlmaWVyID09IERSTV9G
T1JNQVRfTU9EX0xJTkVBUikgewotCQl1bnNpZ25lZCBpbnQgYWxpZ25tZW50ID0gaW50ZWxfdGls
ZV9zaXplKGRldl9wcml2KSAtIDE7CisJCXVuc2lnbmVkIGludCBhbGlnbm1lbnQgPSBpbnRlbF90
aWxlX3NpemUoaTkxNSkgLSAxOwogCiAJCWZvciAoaSA9IDA7IGkgPCBmYi0+Zm9ybWF0LT5udW1f
cGxhbmVzOyBpKyspIHsKIAkJCWlmIChmYi0+cGl0Y2hlc1tpXSAmIGFsaWdubWVudCkKQEAgLTI2
MzYsNyArMjYzNiw3IEBAIHN0YXRpYyBib29sIGludGVsX3BsYW5lX25lZWRzX3JlbWFwKGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB9CiAKIHN0YXRpYyBpbnQK
LWludGVsX2ZpbGxfZmJfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitp
bnRlbF9maWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgIHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKQogewogCXN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAq
aW50ZWxfZmIgPSB0b19pbnRlbF9mcmFtZWJ1ZmZlcihmYik7CkBAIC0yNjQ1LDcgKzI2NDUsNyBA
QCBpbnRlbF9maWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CXUzMiBndHRfb2Zmc2V0X3JvdGF0ZWQgPSAwOwogCXVuc2lnbmVkIGludCBtYXhfc2l6ZSA9IDA7
CiAJaW50IGksIG51bV9wbGFuZXMgPSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOwotCXVuc2lnbmVk
IGludCB0aWxlX3NpemUgPSBpbnRlbF90aWxlX3NpemUoZGV2X3ByaXYpOworCXVuc2lnbmVkIGlu
dCB0aWxlX3NpemUgPSBpbnRlbF90aWxlX3NpemUoaTkxNSk7CiAKIAlmb3IgKGkgPSAwOyBpIDwg
bnVtX3BsYW5lczsgaSsrKSB7CiAJCXVuc2lnbmVkIGludCB3aWR0aCwgaGVpZ2h0OwpAQCAtMjcx
OSw3ICsyNzE5LDcgQEAgaW50ZWxfZmlsbF9mYl9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkJaW50ZWxfZmItPm5vcm1hbFtpXS54ID0geDsKIAkJaW50ZWxfZmItPm5v
cm1hbFtpXS55ID0geTsKIAotCQlvZmZzZXQgPSBpbnRlbF9jb21wdXRlX2FsaWduZWRfb2Zmc2V0
KGRldl9wcml2LCAmeCwgJnksIGZiLCBpLAorCQlvZmZzZXQgPSBpbnRlbF9jb21wdXRlX2FsaWdu
ZWRfb2Zmc2V0KGk5MTUsICZ4LCAmeSwgZmIsIGksCiAJCQkJCQkgICAgICBmYi0+cGl0Y2hlc1tp
XSwKIAkJCQkJCSAgICAgIERSTV9NT0RFX1JPVEFURV8wLAogCQkJCQkJICAgICAgdGlsZV9zaXpl
KTsKQEAgLTI4MDMsMTQgKzI4MDMsMTQgQEAgaW50ZWxfZmlsbF9mYl9pbmZvKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIHN0YXRpYyB2b2lkCiBpbnRlbF9wbGFuZV9yZW1hcF9n
dHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0KIAkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKIAlzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwogCXN0cnVjdCBpbnRlbF9m
cmFtZWJ1ZmZlciAqaW50ZWxfZmIgPSB0b19pbnRlbF9mcmFtZWJ1ZmZlcihmYik7CiAJc3RydWN0
IGludGVsX3JvdGF0aW9uX2luZm8gKmluZm8gPSAmcGxhbmVfc3RhdGUtPnZpZXcucm90YXRlZDsK
IAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKIAlp
bnQgaSwgbnVtX3BsYW5lcyA9IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7Ci0JdW5zaWduZWQgaW50
IHRpbGVfc2l6ZSA9IGludGVsX3RpbGVfc2l6ZShkZXZfcHJpdik7CisJdW5zaWduZWQgaW50IHRp
bGVfc2l6ZSA9IGludGVsX3RpbGVfc2l6ZShpOTE1KTsKIAl1bnNpZ25lZCBpbnQgc3JjX3gsIHNy
Y195OwogCXVuc2lnbmVkIGludCBzcmNfdywgc3JjX2g7CiAJdTMyIGd0dF9vZmZzZXQgPSAwOwpA
QCAtMjg2MCw3ICsyODYwLDcgQEAgaW50ZWxfcGxhbmVfcmVtYXBfZ3R0KHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJCXggKz0gaW50ZWxfZmItPm5vcm1hbFtpXS54Owog
CQl5ICs9IGludGVsX2ZiLT5ub3JtYWxbaV0ueTsKIAotCQlvZmZzZXQgPSBpbnRlbF9jb21wdXRl
X2FsaWduZWRfb2Zmc2V0KGRldl9wcml2LCAmeCwgJnksCisJCW9mZnNldCA9IGludGVsX2NvbXB1
dGVfYWxpZ25lZF9vZmZzZXQoaTkxNSwgJngsICZ5LAogCQkJCQkJICAgICAgZmIsIGksIGZiLT5w
aXRjaGVzW2ldLAogCQkJCQkJICAgICAgRFJNX01PREVfUk9UQVRFXzAsIHRpbGVfc2l6ZSk7CiAJ
CW9mZnNldCAvPSB0aWxlX3NpemU7CkBAIC0zMDQ2LDcgKzMwNDYsNyBAQCBpbnRlbF9hbGxvY19p
bml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgICAgIHN0cnVj
dCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyAqcGxhbmVfY29uZmlnKQogewogCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IE5V
TEw7CiAJc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgbW9kZV9jbWQgPSB7IDAgfTsKIAlzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9ICZwbGFuZV9jb25maWctPmZiLT5iYXNlOwpAQCAtMzA2Miw3
ICszMDYyLDcgQEAgaW50ZWxfYWxsb2NfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAJLyogSWYgdGhlIEZCIGlzIHRvbyBiaWcsIGp1c3QgZG9uJ3QgdXNlIGl0IHNp
bmNlIGZiZGV2IGlzIG5vdCB2ZXJ5CiAJICogaW1wb3J0YW50IGFuZCB3ZSBzaG91bGQgcHJvYmFi
bHkgdXNlIHRoYXQgc3BhY2Ugd2l0aCBGQkMgb3Igb3RoZXIKIAkgKiBmZWF0dXJlcy4gKi8KLQlp
ZiAoc2l6ZV9hbGlnbmVkICogMiA+IGRldl9wcml2LT5zdG9sZW5fdXNhYmxlX3NpemUpCisJaWYg
KHNpemVfYWxpZ25lZCAqIDIgPiBpOTE1LT5zdG9sZW5fdXNhYmxlX3NpemUpCiAJCXJldHVybiBm
YWxzZTsKIAogCXN3aXRjaCAoZmItPm1vZGlmaWVyKSB7CkBAIC0zMDc3LDcgKzMwNzcsNyBAQCBp
bnRlbF9hbGxvY19pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAl9
CiAKIAltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0Jb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChkZXZfcHJpdiwKKwlvYmogPSBpOTE1
X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKGk5MTUsCiAJCQkJCQkJ
ICAgICBiYXNlX2FsaWduZWQsCiAJCQkJCQkJICAgICBiYXNlX2FsaWduZWQsCiAJCQkJCQkJICAg
ICBzaXplX2FsaWduZWQpOwpAQCAtMzEzNSw3ICszMTM1LDcgQEAgaW50ZWxfc2V0X3BsYW5lX3Zp
c2libGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIHN0YXRpYyB2b2lk
IGZpeHVwX2FjdGl2ZV9wbGFuZXMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0
YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgZHJtX3BsYW5lICpw
bGFuZTsKIAogCS8qCkBAIC0zMTQ1LDcgKzMxNDUsNyBAQCBzdGF0aWMgdm9pZCBmaXh1cF9hY3Rp
dmVfcGxhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAqLwogCWNy
dGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgPSAwOwogCi0JZHJtX2Zvcl9lYWNoX3BsYW5lX21hc2so
cGxhbmUsICZkZXZfcHJpdi0+ZHJtLAorCWRybV9mb3JfZWFjaF9wbGFuZV9tYXNrKHBsYW5lLCAm
aTkxNS0+ZHJtLAogCQkJCWNydGNfc3RhdGUtPmJhc2UucGxhbmVfbWFzaykKIAkJY3J0Y19zdGF0
ZS0+YWN0aXZlX3BsYW5lcyB8PSBCSVQodG9faW50ZWxfcGxhbmUocGxhbmUpLT5pZCk7CiB9CkBA
IC0zMTc3LDcgKzMxNzcsNyBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBp
bnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFu
ZV9jb25maWcgKnBsYW5lX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50
ZWxfY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShk
ZXYpOwogCXN0cnVjdCBkcm1fY3J0YyAqYzsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqOwogCXN0cnVjdCBkcm1fcGxhbmUgKnByaW1hcnkgPSBpbnRlbF9jcnRjLT5iYXNlLnByaW1h
cnk7CkBAIC0zMjcyLDcgKzMyNzIsNyBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCWludGVsX3N0YXRlLT5iYXNlLmRzdCA9IGRy
bV9wbGFuZV9zdGF0ZV9kZXN0KHBsYW5lX3N0YXRlKTsKIAogCWlmIChpOTE1X2dlbV9vYmplY3Rf
aXNfdGlsZWQob2JqKSkKLQkJZGV2X3ByaXYtPnByZXNlcnZlX2Jpb3Nfc3dpenpsZSA9IHRydWU7
CisJCWk5MTUtPnByZXNlcnZlX2Jpb3Nfc3dpenpsZSA9IHRydWU7CiAKIAlwbGFuZV9zdGF0ZS0+
ZmIgPSBmYjsKIAlwbGFuZV9zdGF0ZS0+Y3J0YyA9ICZpbnRlbF9jcnRjLT5iYXNlOwpAQCAtMzM4
MSw3ICszMzgxLDcgQEAgc3RhdGljIGJvb2wgc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVz
KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUKIAogc3RhdGljIGludCBza2xf
Y2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZV9z
dGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7CiAJY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAl1bnNpZ25lZCBpbnQg
cm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKIAlpbnQgeCA9IHBsYW5lX3N0
YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKQEAgLTMzOTIsOSArMzM5Miw5IEBAIHN0YXRpYyBpbnQg
c2tsX2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogCWludCBtYXhfaGVpZ2h0ID0gNDA5NjsKIAl1MzIgYWxpZ25tZW50LCBvZmZzZXQsIGF1
eF9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ub2Zmc2V0OwogCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJ
bWF4X3dpZHRoID0gaWNsX21heF9wbGFuZV93aWR0aChmYiwgMCwgcm90YXRpb24pOwotCWVsc2Ug
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikp
CisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoaTkxNSkp
CiAJCW1heF93aWR0aCA9IGdsa19tYXhfcGxhbmVfd2lkdGgoZmIsIDAsIHJvdGF0aW9uKTsKIAll
bHNlCiAJCW1heF93aWR0aCA9IHNrbF9tYXhfcGxhbmVfd2lkdGgoZmIsIDAsIHJvdGF0aW9uKTsK
QEAgLTM1NjQsMTYgKzM1NjQsMTYgQEAgaTl4eF9wbGFuZV9tYXhfc3RyaWRlKHN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUsCiAJCSAgICAgIHUzMiBwaXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllciwK
IAkJICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAotCWlmICghSEFT
X0dNQ0goZGV2X3ByaXYpKSB7CisJaWYgKCFIQVNfR01DSChpOTE1KSkgewogCQlyZXR1cm4gMzIq
MTAyNDsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkgeworCX0gZWxzZSBp
ZiAoSU5URUxfR0VOKGk5MTUpID49IDQpIHsKIAkJaWYgKG1vZGlmaWVyID09IEk5MTVfRk9STUFU
X01PRF9YX1RJTEVEKQogCQkJcmV0dXJuIDE2KjEwMjQ7CiAJCWVsc2UKIAkJCXJldHVybiAzMiox
MDI0OwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAzKSB7CisJfSBlbHNlIGlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gMykgewogCQlpZiAobW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRf
TU9EX1hfVElMRUQpCiAJCQlyZXR1cm4gOCoxMDI0OwogCQllbHNlCkBAIC0zNTg5LDcgKzM1ODks
NyBAQCBpOXh4X3BsYW5lX21heF9zdHJpZGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIHN0
YXRpYyB1MzIgaTl4eF9wbGFuZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXUzMiBkc3BjbnRyID0gMDsKIAog
CWlmIChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCkBAIC0zNTk4LDcgKzM1OTgsNyBAQCBzdGF0
aWMgdTMyIGk5eHhfcGxhbmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiAJaWYgKGNydGNfc3RhdGUtPmNzY19lbmFibGUpCiAJCWRzcGNudHIgfD0g
RElTUFBMQU5FX1BJUEVfQ1NDX0VOQUJMRTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwg
NSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNSkKIAkJZHNwY250ciB8PSBESVNQUExBTkVfU0VM
X1BJUEUoY3J0Yy0+cGlwZSk7CiAKIAlyZXR1cm4gZHNwY250cjsKQEAgLTM2MDcsNyArMzYwNyw3
IEBAIHN0YXRpYyB1MzIgaTl4eF9wbGFuZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB1MzIgaTl4eF9wbGFuZV9jdGwoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCXRvX2k5MTUo
cGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24g
PSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKQEAgLTM2MTUsOCArMzYxNSw4IEBAIHN0YXRp
YyB1MzIgaTl4eF9wbGFuZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAKIAlkc3BjbnRyID0gRElTUExBWV9QTEFORV9FTkFCTEU7CiAKLQlpZiAoSVNfRzRY
KGRldl9wcml2KSB8fCBJU19HRU4oZGV2X3ByaXYsIDUpIHx8Ci0JICAgIElTX0dFTihkZXZfcHJp
diwgNikgfHwgSVNfSVZZQlJJREdFKGRldl9wcml2KSkKKwlpZiAoSVNfRzRYKGk5MTUpIHx8IElT
X0dFTihpOTE1LCA1KSB8fAorCSAgICBJU19HRU4oaTkxNSwgNikgfHwgSVNfSVZZQlJJREdFKGk5
MTUpKQogCQlkc3BjbnRyIHw9IERJU1BQTEFORV9UUklDS0xFX0ZFRURfRElTQUJMRTsKIAogCXN3
aXRjaCAoZmItPmZvcm1hdC0+Zm9ybWF0KSB7CkBAIC0zNjQ2LDcgKzM2NDYsNyBAQCBzdGF0aWMg
dTMyIGk5eHhfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0ICYm
CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0ICYmCiAJICAgIGZiLT5tb2RpZmllciA9PSBJOTE1
X0ZPUk1BVF9NT0RfWF9USUxFRCkKIAkJZHNwY250ciB8PSBESVNQUExBTkVfVElMRUQ7CiAKQEAg
LTM2NjEsNyArMzY2MSw3IEBAIHN0YXRpYyB1MzIgaTl4eF9wbGFuZV9jdGwoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIGludCBpOXh4X2NoZWNrX3BsYW5lX3N1
cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0KIAkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKIAlpbnQgc3Jj
X3gsIHNyY195OwogCXUzMiBvZmZzZXQ7CkBAIC0zNjc5LDcgKzM2NzksNyBAQCBpbnQgaTl4eF9j
aGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
CiAKIAlpbnRlbF9hZGRfZmJfb2Zmc2V0cygmc3JjX3gsICZzcmNfeSwgcGxhbmVfc3RhdGUsIDAp
OwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKKwlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDQpCiAJCW9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoJnNy
Y194LCAmc3JjX3ksCiAJCQkJCQkJICAgIHBsYW5lX3N0YXRlLCAwKTsKIAllbHNlCkBAIC0zNjk0
LDcgKzM2OTQsNyBAQCBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJCQkgICAoc3JjX3kgPDwgMTYpIC0gcGxhbmVfc3Rh
dGUtPmJhc2Uuc3JjLnkxKTsKIAogCS8qIEhTVy9CRFcgZG8gdGhpcyBhdXRvbWFnaWNhbGx5IGlu
IGhhcmR3YXJlICovCi0JaWYgKCFJU19IQVNXRUxMKGRldl9wcml2KSAmJiAhSVNfQlJPQURXRUxM
KGRldl9wcml2KSkgeworCWlmICghSVNfSEFTV0VMTChpOTE1KSAmJiAhSVNfQlJPQURXRUxMKGk5
MTUpKSB7CiAJCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0
aW9uOwogCQlpbnQgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3Jj
KSA+PiAxNjsKIAkJaW50IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMpID4+IDE2OwpAQCAtMzc1Miw3ICszNzUyLDcgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRh
dGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCSAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJZW51bSBpOXh4X3Bs
YW5lX2lkIGk5eHhfcGxhbmUgPSBwbGFuZS0+aTl4eF9wbGFuZTsKIAl1MzIgbGluZWFyX29mZnNl
dDsKIAlpbnQgeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS54OwpAQCAtMzc2NSwxNiAr
Mzc2NSwxNiBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lLAogCiAJbGluZWFyX29mZnNldCA9IGludGVsX2ZiX3h5X3RvX2xpbmVhcih4LCB5
LCBwbGFuZV9zdGF0ZSwgMCk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQorCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gNCkKIAkJZHNwYWRkcl9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMF0ub2Zmc2V0OwogCWVsc2UKIAkJZHNwYWRkcl9vZmZzZXQgPSBsaW5lYXJf
b2Zmc2V0OwogCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJx
ZmxhZ3MpOworCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT51bmNvcmUubG9jaywgaXJxZmxhZ3Mp
OwogCiAJSTkxNV9XUklURV9GVyhEU1BTVFJJREUoaTl4eF9wbGFuZSksIHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVswXS5zdHJpZGUpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA0KSB7
CisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDQpIHsKIAkJLyogcGlwZXNyYyBhbmQgZHNwc2l6ZSBj
b250cm9sIHRoZSBzaXplIHRoYXQgaXMgc2NhbGVkIGZyb20sCiAJCSAqIHdoaWNoIHNob3VsZCBh
bHdheXMgYmUgdGhlIHVzZXIncyByZXF1ZXN0ZWQgc2l6ZS4KIAkJICovCkBAIC0zNzgyLDcgKzM3
ODIsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lLAogCQlJOTE1X1dSSVRFX0ZXKERTUFNJWkUoaTl4eF9wbGFuZSksCiAJCQkgICAgICAo
KGNydGNfc3RhdGUtPnBpcGVfc3JjX2ggLSAxKSA8PCAxNikgfAogCQkJICAgICAgKGNydGNfc3Rh
dGUtPnBpcGVfc3JjX3cgLSAxKSk7Ci0JfSBlbHNlIGlmIChJU19DSEVSUllWSUVXKGRldl9wcml2
KSAmJiBpOXh4X3BsYW5lID09IFBMQU5FX0IpIHsKKwl9IGVsc2UgaWYgKElTX0NIRVJSWVZJRVco
aTkxNSkgJiYgaTl4eF9wbGFuZSA9PSBQTEFORV9CKSB7CiAJCUk5MTVfV1JJVEVfRlcoUFJJTVBP
UyhpOXh4X3BsYW5lKSwgMCk7CiAJCUk5MTVfV1JJVEVfRlcoUFJJTVNJWkUoaTl4eF9wbGFuZSks
CiAJCQkgICAgICAoKGNydGNfc3RhdGUtPnBpcGVfc3JjX2ggLSAxKSA8PCAxNikgfApAQCAtMzc5
MCw5ICszNzkwLDkgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSwKIAkJSTkxNV9XUklURV9GVyhQUklNQ05TVEFMUEhBKGk5eHhfcGxhbmUp
LCAwKTsKIAl9CiAKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRl
dl9wcml2KSkgeworCWlmIChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FEV0VMTChpOTE1KSkg
ewogCQlJOTE1X1dSSVRFX0ZXKERTUE9GRlNFVChpOXh4X3BsYW5lKSwgKHkgPDwgMTYpIHwgeCk7
Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpIHsKKwl9IGVsc2UgaWYgKElO
VEVMX0dFTihpOTE1KSA+PSA0KSB7CiAJCUk5MTVfV1JJVEVfRlcoRFNQTElOT0ZGKGk5eHhfcGxh
bmUpLCBsaW5lYXJfb2Zmc2V0KTsKIAkJSTkxNV9XUklURV9GVyhEU1BUSUxFT0ZGKGk5eHhfcGxh
bmUpLCAoeSA8PCAxNikgfCB4KTsKIAl9CkBAIC0zODAzLDcgKzM4MDMsNyBAQCBzdGF0aWMgdm9p
ZCBpOXh4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCSAqIHRoZSBj
b250cm9sIHJlZ2lzdGVyIGp1c3QgYmVmb3JlIHRoZSBzdXJmYWNlIHJlZ2lzdGVyLgogCSAqLwog
CUk5MTVfV1JJVEVfRlcoRFNQQ05UUihpOXh4X3BsYW5lKSwgZHNwY250cik7Ci0JaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gNCkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDQpCiAJCUk5MTVf
V1JJVEVfRlcoRFNQU1VSRihpOXh4X3BsYW5lKSwKIAkJCSAgICAgIGludGVsX3BsYW5lX2dndHRf
b2Zmc2V0KHBsYW5lX3N0YXRlKSArCiAJCQkgICAgICBkc3BhZGRyX29mZnNldCk7CkBAIC0zODEy
LDEzICszODEyLDEzIEBAIHN0YXRpYyB2b2lkIGk5eHhfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUsCiAJCQkgICAgICBpbnRlbF9wbGFuZV9nZ3R0X29mZnNldChwbGFuZV9z
dGF0ZSkgKwogCQkJICAgICAgZHNwYWRkcl9vZmZzZXQpOwogCi0Jc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmaTkxNS0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKIH0KIAogc3RhdGljIHZvaWQg
aTl4eF9kaXNhYmxlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCQkgICAgICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwog
CWVudW0gaTl4eF9wbGFuZV9pZCBpOXh4X3BsYW5lID0gcGxhbmUtPmk5eHhfcGxhbmU7CiAJdW5z
aWduZWQgbG9uZyBpcnFmbGFnczsKIAl1MzIgZHNwY250cjsKQEAgLTM4MzUsMjEgKzM4MzUsMjEg
QEAgc3RhdGljIHZvaWQgaTl4eF9kaXNhYmxlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCiAJICovCiAJZHNwY250ciA9IGk5eHhfcGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CiAK
LQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisJ
c3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiAKIAlJOTE1
X1dSSVRFX0ZXKERTUENOVFIoaTl4eF9wbGFuZSksIGRzcGNudHIpOwotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDQpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KQogCQlJOTE1X1dSSVRF
X0ZXKERTUFNVUkYoaTl4eF9wbGFuZSksIDApOwogCWVsc2UKIAkJSTkxNV9XUklURV9GVyhEU1BB
RERSKGk5eHhfcGxhbmUpLCAwKTsKIAotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2
LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUt
PnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiB9CiAKIHN0YXRpYyBib29sIGk5eHhfcGxhbmVfZ2V0
X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCQkJICAgIGVudW0gcGlwZSAq
cGlwZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBs
YW5lLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KHBsYW5lLT5iYXNlLmRldik7CiAJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dl
cl9kb21haW47CiAJZW51bSBpOXh4X3BsYW5lX2lkIGk5eHhfcGxhbmUgPSBwbGFuZS0+aTl4eF9w
bGFuZTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKQEAgLTM4NjIsNyArMzg2Miw3IEBAIHN0
YXRpYyBib29sIGk5eHhfcGxhbmVfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCiAJICogZGlzcGxheSBwb3dlciB3ZWxscy4KIAkgKi8KIAlwb3dlcl9kb21haW4gPSBQT1dF
Ul9ET01BSU5fUElQRShwbGFuZS0+cGlwZSk7Ci0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93
ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbik7CisJd2FrZXJlZiA9IGlu
dGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwgcG93ZXJfZG9tYWluKTsKIAlp
ZiAoIXdha2VyZWYpCiAJCXJldHVybiBmYWxzZTsKIApAQCAtMzg3MCwxMyArMzg3MCwxMyBAQCBz
dGF0aWMgYm9vbCBpOXh4X3BsYW5lX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAogCiAJcmV0ID0gdmFsICYgRElTUExBWV9QTEFORV9FTkFCTEU7CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA1KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJKnBpcGUg
PSBwbGFuZS0+cGlwZTsKIAllbHNlCiAJCSpwaXBlID0gKHZhbCAmIERJU1BQTEFORV9TRUxfUElQ
RV9NQVNLKSA+PgogCQkJRElTUFBMQU5FX1NFTF9QSVBFX1NISUZUOwogCi0JaW50ZWxfZGlzcGxh
eV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CisJaW50ZWxfZGlz
cGxheV9wb3dlcl9wdXQoaTkxNSwgcG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKIAogCXJldHVybiBy
ZXQ7CiB9CkBAIC0zODg0LDcgKzM4ODQsNyBAQCBzdGF0aWMgYm9vbCBpOXh4X3BsYW5lX2dldF9o
d19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogc3RhdGljIHZvaWQgc2tsX2RldGFj
aF9zY2FsZXIoc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsIGludCBpZCkKIHsKIAlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50ZWxfY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCiAJSTkxNV9XUklURShTS0xfUFNfQ1RSTChp
bnRlbF9jcnRjLT5waXBlLCBpZCksIDApOwogCUk5MTVfV1JJVEUoU0tMX1BTX1dJTl9QT1MoaW50
ZWxfY3J0Yy0+cGlwZSwgaWQpLCAwKTsKQEAgLTQwOTEsMTAgKzQwOTEsMTAgQEAgc3RhdGljIHUz
MiBjbmxfcGxhbmVfY3RsX2ZsaXAodW5zaWduZWQgaW50IHJlZmxlY3QpCiAKIHUzMiBza2xfcGxh
bmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAl1MzIgcGxhbmVfY3RsID0gMDsKIAot
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYp
KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShpOTE1KSkKIAkJ
cmV0dXJuIHBsYW5lX2N0bDsKIAogCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCkBAIC00
MTA5LDcgKzQxMDksNyBAQCB1MzIgc2tsX3BsYW5lX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogdTMyIHNrbF9wbGFuZV9jdGwoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJdG9faTkxNShwbGFu
ZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBs
YW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOwpAQCAtNDExOCw3ICs0MTE4LDcgQEAgdTMyIHNrbF9w
bGFuZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIAlw
bGFuZV9jdGwgPSBQTEFORV9DVExfRU5BQkxFOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
PCAxMCAmJiAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUp
IDwgMTAgJiYgIUlTX0dFTUlOSUxBS0UoaTkxNSkpIHsKIAkJcGxhbmVfY3RsIHw9IHNrbF9wbGFu
ZV9jdGxfYWxwaGEocGxhbmVfc3RhdGUpOwogCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1BMQU5F
X0dBTU1BX0RJU0FCTEU7CiAKQEAgLTQxMzMsNyArNDEzMyw3IEBAIHUzMiBza2xfcGxhbmVfY3Rs
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXBsYW5lX2N0bCB8
PSBza2xfcGxhbmVfY3RsX3RpbGluZyhmYi0+bW9kaWZpZXIpOwogCXBsYW5lX2N0bCB8PSBza2xf
cGxhbmVfY3RsX3JvdGF0ZShyb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV9NQVNLKTsKIAotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTAp
CiAJCXBsYW5lX2N0bCB8PSBjbmxfcGxhbmVfY3RsX2ZsaXAocm90YXRpb24gJgogCQkJCQkJRFJN
X01PREVfUkVGTEVDVF9NQVNLKTsKIApAQCAtNDE0NywxMCArNDE0NywxMCBAQCB1MzIgc2tsX3Bs
YW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogdTMy
IGdsa19wbGFuZV9jb2xvcl9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCXUzMiBwbGFu
ZV9jb2xvcl9jdGwgPSAwOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYg
KElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJcmV0dXJuIHBsYW5lX2NvbG9yX2N0bDsKIAogCWlm
IChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCkBAIC00MTY1LDcgKzQxNjUsNyBAQCB1MzIgZ2xr
X3BsYW5lX2NvbG9yX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogdTMyIGdsa19wbGFuZV9jb2xvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNl
LnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmJhc2UuZmI7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKQEAgLTQxNzQsNyArNDE3NCw3IEBAIHUzMiBn
bGtfcGxhbmVfY29sb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9QTEFORV9HQU1NQV9ESVNBQkxF
OwogCXBsYW5lX2NvbG9yX2N0bCB8PSBnbGtfcGxhbmVfY29sb3JfY3RsX2FscGhhKHBsYW5lX3N0
YXRlKTsKIAotCWlmIChmYi0+Zm9ybWF0LT5pc195dXYgJiYgIWljbF9pc19oZHJfcGxhbmUoZGV2
X3ByaXYsIHBsYW5lLT5pZCkpIHsKKwlpZiAoZmItPmZvcm1hdC0+aXNfeXV2ICYmICFpY2xfaXNf
aGRyX3BsYW5lKGk5MTUsIHBsYW5lLT5pZCkpIHsKIAkJaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNv
bG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKIAkJCXBsYW5lX2NvbG9yX2N0
bCB8PSBQTEFORV9DT0xPUl9DU0NfTU9ERV9ZVVY3MDlfVE9fUkdCNzA5OwogCQllbHNlCkBAIC00
MjI4LDMxICs0MjI4LDMxIEBAIF9faW50ZWxfZGlzcGxheV9yZXN1bWUoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgYm9vbCBncHVfcmVzZXRfY2xvYmJl
cnNfZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9v
bCBncHVfcmVzZXRfY2xvYmJlcnNfZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKLQlyZXR1cm4gKElOVEVMX0lORk8oZGV2X3ByaXYpLT5ncHVfcmVzZXRfY2xvYmJlcnNf
ZGlzcGxheSAmJgotCQlpbnRlbF9oYXNfZ3B1X3Jlc2V0KGRldl9wcml2KSk7CisJcmV0dXJuIChJ
TlRFTF9JTkZPKGk5MTUpLT5ncHVfcmVzZXRfY2xvYmJlcnNfZGlzcGxheSAmJgorCQlpbnRlbF9o
YXNfZ3B1X3Jlc2V0KGk5MTUpKTsKIH0KIAotdm9pZCBpbnRlbF9wcmVwYXJlX3Jlc2V0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfcHJlcGFyZV9yZXNldChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4ICpjdHgg
PSAmZGV2X3ByaXYtPnJlc2V0X2N0eDsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5MTUt
PmRybTsKKwlzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCA9ICZpOTE1LT5yZXNl
dF9jdHg7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlOwogCWludCByZXQ7CiAKIAkv
KiByZXNldCBkb2Vzbid0IHRvdWNoIHRoZSBkaXNwbGF5ICovCiAJaWYgKCFpOTE1X21vZHBhcmFt
cy5mb3JjZV9yZXNldF9tb2Rlc2V0X3Rlc3QgJiYKLQkgICAgIWdwdV9yZXNldF9jbG9iYmVyc19k
aXNwbGF5KGRldl9wcml2KSkKKwkgICAgIWdwdV9yZXNldF9jbG9iYmVyc19kaXNwbGF5KGk5MTUp
KQogCQlyZXR1cm47CiAKIAkvKiBXZSBoYXZlIGEgbW9kZXNldCB2cyByZXNldCBkZWFkbG9jaywg
ZGVmZW5zaXZlbHkgdW5icmVhayBpdC4gKi8KLQlzZXRfYml0KEk5MTVfUkVTRVRfTU9ERVNFVCwg
JmRldl9wcml2LT5ncHVfZXJyb3IuZmxhZ3MpOwotCXdha2VfdXBfYWxsKCZkZXZfcHJpdi0+Z3B1
X2Vycm9yLndhaXRfcXVldWUpOworCXNldF9iaXQoSTkxNV9SRVNFVF9NT0RFU0VULCAmaTkxNS0+
Z3B1X2Vycm9yLmZsYWdzKTsKKwl3YWtlX3VwX2FsbCgmaTkxNS0+Z3B1X2Vycm9yLndhaXRfcXVl
dWUpOwogCi0JaWYgKGF0b21pY19yZWFkKCZkZXZfcHJpdi0+Z3B1X2Vycm9yLnBlbmRpbmdfZmJf
cGluKSkgeworCWlmIChhdG9taWNfcmVhZCgmaTkxNS0+Z3B1X2Vycm9yLnBlbmRpbmdfZmJfcGlu
KSkgewogCQlEUk1fREVCVUdfS01TKCJNb2Rlc2V0IHBvdGVudGlhbGx5IHN0dWNrLCB1bmJyZWFr
aW5nIHRocm91Z2ggd2VkZ2luZ1xuIik7Ci0JCWk5MTVfZ2VtX3NldF93ZWRnZWQoZGV2X3ByaXYp
OworCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOwogCX0KIAogCS8qCkBAIC00Mjg2LDI3ICs0
Mjg2LDI3IEBAIHZvaWQgaW50ZWxfcHJlcGFyZV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJCXJldHVybjsKIAl9CiAKLQlkZXZfcHJpdi0+bW9kZXNldF9yZXN0b3Jl
X3N0YXRlID0gc3RhdGU7CisJaTkxNS0+bW9kZXNldF9yZXN0b3JlX3N0YXRlID0gc3RhdGU7CiAJ
c3RhdGUtPmFjcXVpcmVfY3R4ID0gY3R4OwogfQogCi12b2lkIGludGVsX2ZpbmlzaF9yZXNldChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2ZpbmlzaF9yZXNl
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4ICpj
dHggPSAmZGV2X3ByaXYtPnJlc2V0X2N0eDsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5
MTUtPmRybTsKKwlzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCA9ICZpOTE1LT5y
ZXNldF9jdHg7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlOwogCWludCByZXQ7CiAK
IAkvKiByZXNldCBkb2Vzbid0IHRvdWNoIHRoZSBkaXNwbGF5ICovCi0JaWYgKCF0ZXN0X2JpdChJ
OTE1X1JFU0VUX01PREVTRVQsICZkZXZfcHJpdi0+Z3B1X2Vycm9yLmZsYWdzKSkKKwlpZiAoIXRl
c3RfYml0KEk5MTVfUkVTRVRfTU9ERVNFVCwgJmk5MTUtPmdwdV9lcnJvci5mbGFncykpCiAJCXJl
dHVybjsKIAotCXN0YXRlID0gZmV0Y2hfYW5kX3plcm8oJmRldl9wcml2LT5tb2Rlc2V0X3Jlc3Rv
cmVfc3RhdGUpOworCXN0YXRlID0gZmV0Y2hfYW5kX3plcm8oJmk5MTUtPm1vZGVzZXRfcmVzdG9y
ZV9zdGF0ZSk7CiAJaWYgKCFzdGF0ZSkKIAkJZ290byB1bmxvY2s7CiAKIAkvKiByZXNldCBkb2Vz
bid0IHRvdWNoIHRoZSBkaXNwbGF5ICovCi0JaWYgKCFncHVfcmVzZXRfY2xvYmJlcnNfZGlzcGxh
eShkZXZfcHJpdikpIHsKKwlpZiAoIWdwdV9yZXNldF9jbG9iYmVyc19kaXNwbGF5KGk5MTUpKSB7
CiAJCS8qIGZvciB0ZXN0aW5nIG9ubHkgcmVzdG9yZSB0aGUgZGlzcGxheSAqLwogCQlyZXQgPSBf
X2ludGVsX2Rpc3BsYXlfcmVzdW1lKGRldiwgc3RhdGUsIGN0eCk7CiAJCWlmIChyZXQpCkBAIC00
MzE2LDIwICs0MzE2LDIwIEBAIHZvaWQgaW50ZWxfZmluaXNoX3Jlc2V0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAkJICogVGhlIGRpc3BsYXkgaGFzIGJlZW4gcmVzZXQgYXMg
d2VsbCwKIAkJICogc28gbmVlZCBhIGZ1bGwgcmUtaW5pdGlhbGl6YXRpb24uCiAJCSAqLwotCQlp
bnRlbF9wcHNfdW5sb2NrX3JlZ3Nfd2EoZGV2X3ByaXYpOworCQlpbnRlbF9wcHNfdW5sb2NrX3Jl
Z3Nfd2EoaTkxNSk7CiAJCWludGVsX21vZGVzZXRfaW5pdF9odyhkZXYpOwotCQlpbnRlbF9pbml0
X2Nsb2NrX2dhdGluZyhkZXZfcHJpdik7CisJCWludGVsX2luaXRfY2xvY2tfZ2F0aW5nKGk5MTUp
OwogCi0JCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JCWlmIChkZXZfcHJp
di0+ZGlzcGxheS5ocGRfaXJxX3NldHVwKQotCQkJZGV2X3ByaXYtPmRpc3BsYXkuaHBkX2lycV9z
ZXR1cChkZXZfcHJpdik7Ci0JCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsK
KwkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCQlpZiAoaTkxNS0+ZGlzcGxheS5o
cGRfaXJxX3NldHVwKQorCQkJaTkxNS0+ZGlzcGxheS5ocGRfaXJxX3NldHVwKGk5MTUpOworCQlz
cGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAogCQlyZXQgPSBfX2ludGVsX2Rpc3Bs
YXlfcmVzdW1lKGRldiwgc3RhdGUsIGN0eCk7CiAJCWlmIChyZXQpCiAJCQlEUk1fRVJST1IoIlJl
c3RvcmluZyBvbGQgc3RhdGUgZmFpbGVkIHdpdGggJWlcbiIsIHJldCk7CiAKLQkJaW50ZWxfaHBk
X2luaXQoZGV2X3ByaXYpOworCQlpbnRlbF9ocGRfaW5pdChpOTE1KTsKIAl9CiAKIAlkcm1fYXRv
bWljX3N0YXRlX3B1dChzdGF0ZSk7CkBAIC00MzM4LDEyICs0MzM4LDEyIEBAIHZvaWQgaW50ZWxf
ZmluaXNoX3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlkcm1fbW9k
ZXNldF9hY3F1aXJlX2ZpbmkoY3R4KTsKIAltdXRleF91bmxvY2soJmRldi0+bW9kZV9jb25maWcu
bXV0ZXgpOwogCi0JY2xlYXJfYml0KEk5MTVfUkVTRVRfTU9ERVNFVCwgJmRldl9wcml2LT5ncHVf
ZXJyb3IuZmxhZ3MpOworCWNsZWFyX2JpdChJOTE1X1JFU0VUX01PREVTRVQsICZpOTE1LT5ncHVf
ZXJyb3IuZmxhZ3MpOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfc2V0X3BpcGVfY2hpY2tlbihzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+
cGlwZTsKIAl1MzIgdG1wOwogCkBAIC00MzY5LDcgKzQzNjksNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF91cGRhdGVfcGlwZV9jb25maWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YQogCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdf
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJLyogZHJtX2F0b21pY19oZWxwZXJf
dXBkYXRlX2xlZ2FjeV9tb2Rlc2V0X3N0YXRlIG1pZ2h0IG5vdCBiZSBjYWxsZWQuICovCiAJY3J0
Yy0+YmFzZS5tb2RlID0gbmV3X2NydGNfc3RhdGUtPmJhc2UubW9kZTsKQEAgLTQzODgsMjYgKzQz
ODgsMjYgQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX3BpcGVfY29uZmlnKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGEKIAkJICAgKG5ld19jcnRjX3N0YXRlLT5w
aXBlX3NyY19oIC0gMSkpOwogCiAJLyogb24gc2t5bGFrZSB0aGlzIGlzIGRvbmUgYnkgZGV0YWNo
aW5nIHNjYWxlcnMgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KSB7CisJaWYgKElO
VEVMX0dFTihpOTE1KSA+PSA5KSB7CiAJCXNrbF9kZXRhY2hfc2NhbGVycyhuZXdfY3J0Y19zdGF0
ZSk7CiAKIAkJaWYgKG5ld19jcnRjX3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkKQogCQkJc2t5bGFr
ZV9wZml0X2VuYWJsZShuZXdfY3J0Y19zdGF0ZSk7Ci0JfSBlbHNlIGlmIChIQVNfUENIX1NQTElU
KGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSEFTX1BDSF9TUExJVChpOTE1KSkgewogCQlpZiAo
bmV3X2NydGNfc3RhdGUtPnBjaF9wZml0LmVuYWJsZWQpCiAJCQlpcm9ubGFrZV9wZml0X2VuYWJs
ZShuZXdfY3J0Y19zdGF0ZSk7CiAJCWVsc2UgaWYgKG9sZF9jcnRjX3N0YXRlLT5wY2hfcGZpdC5l
bmFibGVkKQogCQkJaXJvbmxha2VfcGZpdF9kaXNhYmxlKG9sZF9jcnRjX3N0YXRlKTsKIAl9CiAK
LQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDExKQogCQlpY2xfc2V0X3BpcGVfY2hpY2tlbihjcnRjKTsKIH0KIAogc3RhdGljIHZvaWQgaW50
ZWxfZmRpX25vcm1hbF90cmFpbihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShkZXYpOwogCWludCBwaXBlID0gY3J0Yy0+cGlwZTsKIAlpOTE1X3JlZ190
IHJlZzsKIAl1MzIgdGVtcDsKQEAgLTQ0MTUsNyArNDQxNSw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2ZkaV9ub3JtYWxfdHJhaW4oc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJLyogZW5hYmxlIG5v
cm1hbCB0cmFpbiAqLwogCXJlZyA9IEZESV9UWF9DVEwocGlwZSk7CiAJdGVtcCA9IEk5MTVfUkVB
RChyZWcpOwotCWlmIChJU19JVllCUklER0UoZGV2X3ByaXYpKSB7CisJaWYgKElTX0lWWUJSSURH
RShpOTE1KSkgewogCQl0ZW1wICY9IH5GRElfTElOS19UUkFJTl9OT05FX0lWQjsKIAkJdGVtcCB8
PSBGRElfTElOS19UUkFJTl9OT05FX0lWQiB8IEZESV9UWF9FTkhBTkNFX0ZSQU1FX0VOQUJMRTsK
IAl9IGVsc2UgewpAQCAtNDQyNiw3ICs0NDI2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZmRpX25v
cm1hbF90cmFpbihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAogCXJlZyA9IEZESV9SWF9DVEwo
cGlwZSk7CiAJdGVtcCA9IEk5MTVfUkVBRChyZWcpOwotCWlmIChIQVNfUENIX0NQVChkZXZfcHJp
dikpIHsKKwlpZiAoSEFTX1BDSF9DUFQoaTkxNSkpIHsKIAkJdGVtcCAmPSB+RkRJX0xJTktfVFJB
SU5fUEFUVEVSTl9NQVNLX0NQVDsKIAkJdGVtcCB8PSBGRElfTElOS19UUkFJTl9OT1JNQUxfQ1BU
OwogCX0gZWxzZSB7CkBAIC00NDQwLDcgKzQ0NDAsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mZGlf
bm9ybWFsX3RyYWluKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCXVkZWxheSgxMDAwKTsKIAog
CS8qIElWQiB3YW50cyBlcnJvciBjb3JyZWN0aW9uIGVuYWJsZWQgKi8KLQlpZiAoSVNfSVZZQlJJ
REdFKGRldl9wcml2KSkKKwlpZiAoSVNfSVZZQlJJREdFKGk5MTUpKQogCQlJOTE1X1dSSVRFKHJl
ZywgSTkxNV9SRUFEKHJlZykgfCBGRElfRlNfRVJSQ19FTkFCTEUgfAogCQkJICAgRkRJX0ZFX0VS
UkNfRU5BQkxFKTsKIH0KQEAgLTQ0NTAsMTMgKzQ0NTAsMTMgQEAgc3RhdGljIHZvaWQgaXJvbmxh
a2VfZmRpX2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CiAJaW50IHBpcGUgPSBjcnRjLT5waXBlOwogCWk5MTVfcmVnX3QgcmVnOwog
CXUzMiB0ZW1wLCB0cmllczsKIAogCS8qIEZESSBuZWVkcyBiaXRzIGZyb20gcGlwZSBmaXJzdCAq
LwotCWFzc2VydF9waXBlX2VuYWJsZWQoZGV2X3ByaXYsIHBpcGUpOworCWFzc2VydF9waXBlX2Vu
YWJsZWQoaTkxNSwgcGlwZSk7CiAKIAkvKiBUcmFpbiAxOiB1bWFzayBGREkgUlggSW50ZXJydXB0
IHN5bWJvbF9sb2NrIGFuZCBiaXRfbG9jayBiaXQKIAkgICBmb3IgdHJhaW4gcmVzdWx0ICovCkBA
IC00NTUxLDcgKzQ1NTEsNyBAQCBzdGF0aWMgdm9pZCBnZW42X2ZkaV9saW5rX3RyYWluKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJaW50IHBpcGUgPSBj
cnRjLT5waXBlOwogCWk5MTVfcmVnX3QgcmVnOwogCXUzMiB0ZW1wLCBpLCByZXRyeTsKQEAgLTQ1
ODQsNyArNDU4NCw3IEBAIHN0YXRpYyB2b2lkIGdlbjZfZmRpX2xpbmtfdHJhaW4oc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiAKIAlyZWcgPSBGRElfUlhfQ1RMKHBpcGUpOwogCXRlbXAgPSBJOTE1
X1JFQUQocmVnKTsKLQlpZiAoSEFTX1BDSF9DUFQoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19QQ0hf
Q1BUKGk5MTUpKSB7CiAJCXRlbXAgJj0gfkZESV9MSU5LX1RSQUlOX1BBVFRFUk5fTUFTS19DUFQ7
CiAJCXRlbXAgfD0gRkRJX0xJTktfVFJBSU5fUEFUVEVSTl8xX0NQVDsKIAl9IGVsc2UgewpAQCAt
NDYyOCw3ICs0NjI4LDcgQEAgc3RhdGljIHZvaWQgZ2VuNl9mZGlfbGlua190cmFpbihzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKIAl0ZW1wID0gSTkxNV9SRUFEKHJlZyk7CiAJdGVtcCAmPSB+RkRJ
X0xJTktfVFJBSU5fTk9ORTsKIAl0ZW1wIHw9IEZESV9MSU5LX1RSQUlOX1BBVFRFUk5fMjsKLQlp
ZiAoSVNfR0VOKGRldl9wcml2LCA2KSkgeworCWlmIChJU19HRU4oaTkxNSwgNikpIHsKIAkJdGVt
cCAmPSB+RkRJX0xJTktfVFJBSU5fVk9MX0VNUF9NQVNLOwogCQkvKiBTTkItQiAqLwogCQl0ZW1w
IHw9IEZESV9MSU5LX1RSQUlOXzQwME1WXzBEQl9TTkJfQjsKQEAgLTQ2MzcsNyArNDYzNyw3IEBA
IHN0YXRpYyB2b2lkIGdlbjZfZmRpX2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2NydGMgKmNydGMs
CiAKIAlyZWcgPSBGRElfUlhfQ1RMKHBpcGUpOwogCXRlbXAgPSBJOTE1X1JFQUQocmVnKTsKLQlp
ZiAoSEFTX1BDSF9DUFQoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19QQ0hfQ1BUKGk5MTUpKSB7CiAJ
CXRlbXAgJj0gfkZESV9MSU5LX1RSQUlOX1BBVFRFUk5fTUFTS19DUFQ7CiAJCXRlbXAgfD0gRkRJ
X0xJTktfVFJBSU5fUEFUVEVSTl8yX0NQVDsKIAl9IGVsc2UgewpAQCAtNDY4NCw3ICs0Njg0LDcg
QEAgc3RhdGljIHZvaWQgaXZiX21hbnVhbF9mZGlfbGlua190cmFpbihzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKIAkJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWludCBwaXBlID0gY3J0Yy0+
cGlwZTsKIAlpOTE1X3JlZ190IHJlZzsKIAl1MzIgdGVtcCwgaSwgajsKQEAgLTQ4MDIsNyArNDgw
Miw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9tYW51YWxfZmRpX2xpbmtfdHJhaW4oc3RydWN0IGludGVs
X2NydGMgKmNydGMsCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9mZGlfcGxsX2VuYWJsZShjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2NydGMtPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoaW50ZWxf
Y3J0Yy0+YmFzZS5kZXYpOwogCWludCBwaXBlID0gaW50ZWxfY3J0Yy0+cGlwZTsKIAlpOTE1X3Jl
Z190IHJlZzsKIAl1MzIgdGVtcDsKQEAgLTQ4MzksNyArNDgzOSw3IEBAIHN0YXRpYyB2b2lkIGly
b25sYWtlX2ZkaV9wbGxfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogc3RhdGljIHZvaWQgaXJvbmxha2VfZmRpX3BsbF9kaXNhYmxlKHN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBpbnRlbF9j
cnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7
CiAJaW50IHBpcGUgPSBpbnRlbF9jcnRjLT5waXBlOwogCWk5MTVfcmVnX3QgcmVnOwogCXUzMiB0
ZW1wOwpAQCAtNDg2OSw3ICs0ODY5LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfZmRpX3BsbF9k
aXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjKQogc3RhdGljIHZvaWQgaXJvbmxh
a2VfZmRpX2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRjKQogewogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBjcnRjLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjKTsKIAlpbnQgcGlwZSA9IGludGVsX2NydGMtPnBpcGU7CiAJaTkxNV9yZWdfdCByZWc7CkBA
IC00ODkxLDcgKzQ4OTEsNyBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9mZGlfZGlzYWJsZShzdHJ1
Y3QgZHJtX2NydGMgKmNydGMpCiAJdWRlbGF5KDEwMCk7CiAKIAkvKiBJcm9ubGFrZSB3b3JrYXJv
dW5kLCBkaXNhYmxlIGNsb2NrIHBvaW50ZXIgYWZ0ZXIgZG93bmluZyBGREkgKi8KLQlpZiAoSEFT
X1BDSF9JQlgoZGV2X3ByaXYpKQorCWlmIChIQVNfUENIX0lCWChpOTE1KSkKIAkJSTkxNV9XUklU
RShGRElfUlhfQ0hJQ0tFTihwaXBlKSwgRkRJX1JYX1BIQVNFX1NZTkNfUE9JTlRFUl9PVlIpOwog
CiAJLyogc3RpbGwgc2V0IHRyYWluIHBhdHRlcm4gMSAqLwpAQCAtNDkwMyw3ICs0OTAzLDcgQEAg
c3RhdGljIHZvaWQgaXJvbmxha2VfZmRpX2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRjKQog
CiAJcmVnID0gRkRJX1JYX0NUTChwaXBlKTsKIAl0ZW1wID0gSTkxNV9SRUFEKHJlZyk7Ci0JaWYg
KEhBU19QQ0hfQ1BUKGRldl9wcml2KSkgeworCWlmIChIQVNfUENIX0NQVChpOTE1KSkgewogCQl0
ZW1wICY9IH5GRElfTElOS19UUkFJTl9QQVRURVJOX01BU0tfQ1BUOwogCQl0ZW1wIHw9IEZESV9M
SU5LX1RSQUlOX1BBVFRFUk5fMV9DUFQ7CiAJfSBlbHNlIHsKQEAgLTQ5MTksMTIgKzQ5MTksMTIg
QEAgc3RhdGljIHZvaWQgaXJvbmxha2VfZmRpX2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRj
KQogCXVkZWxheSgxMDApOwogfQogCi1ib29sIGludGVsX2hhc19wZW5kaW5nX2ZiX3VucGluKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2Jvb2wgaW50ZWxfaGFzX3BlbmRpbmdf
ZmJfdW5waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGRybV9j
cnRjICpjcnRjOwogCWJvb2wgY2xlYW51cF9kb25lOwogCi0JZHJtX2Zvcl9lYWNoX2NydGMoY3J0
YywgJmRldl9wcml2LT5kcm0pIHsKKwlkcm1fZm9yX2VhY2hfY3J0YyhjcnRjLCAmaTkxNS0+ZHJt
KSB7CiAJCXN0cnVjdCBkcm1fY3J0Y19jb21taXQgKmNvbW1pdDsKIAkJc3Bpbl9sb2NrKCZjcnRj
LT5jb21taXRfbG9jayk7CiAJCWNvbW1pdCA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmY3J0
Yy0+Y29tbWl0X2xpc3QsCkBAIC00OTQ0LDMxICs0OTQ0LDMxIEBAIGJvb2wgaW50ZWxfaGFzX3Bl
bmRpbmdfZmJfdW5waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVy
biBmYWxzZTsKIH0KIAotdm9pZCBscHRfZGlzYWJsZV9pY2xraXAoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQordm9pZCBscHRfZGlzYWJsZV9pY2xraXAoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIHRlbXA7CiAKIAlJOTE1X1dSSVRFKFBJWENMS19HQVRF
LCBQSVhDTEtfR0FURV9HQVRFKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5zYl9sb2NrKTsK
KwltdXRleF9sb2NrKCZpOTE1LT5zYl9sb2NrKTsKIAotCXRlbXAgPSBpbnRlbF9zYmlfcmVhZChk
ZXZfcHJpdiwgU0JJX1NTQ0NUTDYsIFNCSV9JQ0xLKTsKKwl0ZW1wID0gaW50ZWxfc2JpX3JlYWQo
aTkxNSwgU0JJX1NTQ0NUTDYsIFNCSV9JQ0xLKTsKIAl0ZW1wIHw9IFNCSV9TU0NDVExfRElTQUJM
RTsKLQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIFNCSV9TU0NDVEw2LCB0ZW1wLCBTQklfSUNM
Syk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIFNCSV9TU0NDVEw2LCB0ZW1wLCBTQklfSUNMSyk7
CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5zYl9sb2NrKTsKKwltdXRleF91bmxvY2soJmk5
MTUtPnNiX2xvY2spOwogfQogCiAvKiBQcm9ncmFtIGlDTEtJUCBjbG9jayB0byB0aGUgZGVzaXJl
ZCBmcmVxdWVuY3kgKi8KIHN0YXRpYyB2b2lkIGxwdF9wcm9ncmFtX2ljbGtpcChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWlu
dCBjbG9jayA9IGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCXUz
MiBkaXZzZWwsIHBoYXNlaW5jLCBhdXhkaXYsIHBoYXNlZGlyID0gMDsKIAl1MzIgdGVtcDsKIAot
CWxwdF9kaXNhYmxlX2ljbGtpcChkZXZfcHJpdik7CisJbHB0X2Rpc2FibGVfaWNsa2lwKGk5MTUp
OwogCiAJLyogVGhlIGlDTEsgdmlydHVhbCBjbG9jayByb290IGZyZXF1ZW5jeSBpcyBpbiBNSHos
CiAJICogYnV0IHRoZSBhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrIGluIGluIEtIei4gVG8gZ2V0
IHRoZQpAQCAtNTAwNywzMCArNTAwNywzMCBAQCBzdGF0aWMgdm9pZCBscHRfcHJvZ3JhbV9pY2xr
aXAoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCQlwaGFzZWRp
ciwKIAkJCXBoYXNlaW5jKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5zYl9sb2NrKTsKKwlt
dXRleF9sb2NrKCZpOTE1LT5zYl9sb2NrKTsKIAogCS8qIFByb2dyYW0gU1NDRElWSU5UUEhBU0U2
ICovCi0JdGVtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCBTQklfU1NDRElWSU5UUEhBU0U2
LCBTQklfSUNMSyk7CisJdGVtcCA9IGludGVsX3NiaV9yZWFkKGk5MTUsIFNCSV9TU0NESVZJTlRQ
SEFTRTYsIFNCSV9JQ0xLKTsKIAl0ZW1wICY9IH5TQklfU1NDRElWSU5UUEhBU0VfRElWU0VMX01B
U0s7CiAJdGVtcCB8PSBTQklfU1NDRElWSU5UUEhBU0VfRElWU0VMKGRpdnNlbCk7CiAJdGVtcCAm
PSB+U0JJX1NTQ0RJVklOVFBIQVNFX0lOQ1ZBTF9NQVNLOwogCXRlbXAgfD0gU0JJX1NTQ0RJVklO
VFBIQVNFX0lOQ1ZBTChwaGFzZWluYyk7CiAJdGVtcCB8PSBTQklfU1NDRElWSU5UUEhBU0VfRElS
KHBoYXNlZGlyKTsKIAl0ZW1wIHw9IFNCSV9TU0NESVZJTlRQSEFTRV9QUk9QQUdBVEU7Ci0JaW50
ZWxfc2JpX3dyaXRlKGRldl9wcml2LCBTQklfU1NDRElWSU5UUEhBU0U2LCB0ZW1wLCBTQklfSUNM
Syk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIFNCSV9TU0NESVZJTlRQSEFTRTYsIHRlbXAsIFNC
SV9JQ0xLKTsKIAogCS8qIFByb2dyYW0gU1NDQVVYRElWICovCi0JdGVtcCA9IGludGVsX3NiaV9y
ZWFkKGRldl9wcml2LCBTQklfU1NDQVVYRElWNiwgU0JJX0lDTEspOworCXRlbXAgPSBpbnRlbF9z
YmlfcmVhZChpOTE1LCBTQklfU1NDQVVYRElWNiwgU0JJX0lDTEspOwogCXRlbXAgJj0gflNCSV9T
U0NBVVhESVZfRklOQUxESVYyU0VMKDEpOwogCXRlbXAgfD0gU0JJX1NTQ0FVWERJVl9GSU5BTERJ
VjJTRUwoYXV4ZGl2KTsKLQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIFNCSV9TU0NBVVhESVY2
LCB0ZW1wLCBTQklfSUNMSyk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIFNCSV9TU0NBVVhESVY2
LCB0ZW1wLCBTQklfSUNMSyk7CiAKIAkvKiBFbmFibGUgbW9kdWxhdG9yIGFuZCBhc3NvY2lhdGVk
IGRpdmlkZXIgKi8KLQl0ZW1wID0gaW50ZWxfc2JpX3JlYWQoZGV2X3ByaXYsIFNCSV9TU0NDVEw2
LCBTQklfSUNMSyk7CisJdGVtcCA9IGludGVsX3NiaV9yZWFkKGk5MTUsIFNCSV9TU0NDVEw2LCBT
QklfSUNMSyk7CiAJdGVtcCAmPSB+U0JJX1NTQ0NUTF9ESVNBQkxFOwotCWludGVsX3NiaV93cml0
ZShkZXZfcHJpdiwgU0JJX1NTQ0NUTDYsIHRlbXAsIFNCSV9JQ0xLKTsKKwlpbnRlbF9zYmlfd3Jp
dGUoaTkxNSwgU0JJX1NTQ0NUTDYsIHRlbXAsIFNCSV9JQ0xLKTsKIAotCW11dGV4X3VubG9jaygm
ZGV2X3ByaXYtPnNiX2xvY2spOworCW11dGV4X3VubG9jaygmaTkxNS0+c2JfbG9jayk7CiAKIAkv
KiBXYWl0IGZvciBpbml0aWFsaXphdGlvbiB0aW1lICovCiAJdWRlbGF5KDI0KTsKQEAgLTUwMzgs
NyArNTAzOCw3IEBAIHN0YXRpYyB2b2lkIGxwdF9wcm9ncmFtX2ljbGtpcChjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlJOTE1X1dSSVRFKFBJWENMS19HQVRFLCBQ
SVhDTEtfR0FURV9VTkdBVEUpOwogfQogCi1pbnQgbHB0X2dldF9pY2xraXAoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50IGxwdF9nZXRfaWNsa2lwKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCXUzMiBkaXZzZWwsIHBoYXNlaW5jLCBhdXhkaXY7CiAJdTMy
IGljbGtfdmlydHVhbF9yb290X2ZyZXEgPSAxNzI4MDAgKiAxMDAwOwpAQCAtNTA0OSwyNSArNTA0
OSwyNSBAQCBpbnQgbHB0X2dldF9pY2xraXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCWlmICgoSTkxNV9SRUFEKFBJWENMS19HQVRFKSAmIFBJWENMS19HQVRFX1VOR0FURSkg
PT0gMCkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+c2JfbG9jayk7CisJ
bXV0ZXhfbG9jaygmaTkxNS0+c2JfbG9jayk7CiAKLQl0ZW1wID0gaW50ZWxfc2JpX3JlYWQoZGV2
X3ByaXYsIFNCSV9TU0NDVEw2LCBTQklfSUNMSyk7CisJdGVtcCA9IGludGVsX3NiaV9yZWFkKGk5
MTUsIFNCSV9TU0NDVEw2LCBTQklfSUNMSyk7CiAJaWYgKHRlbXAgJiBTQklfU1NDQ1RMX0RJU0FC
TEUpIHsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+c2JfbG9jayk7CisJCW11dGV4X3VubG9j
aygmaTkxNS0+c2JfbG9jayk7CiAJCXJldHVybiAwOwogCX0KIAotCXRlbXAgPSBpbnRlbF9zYmlf
cmVhZChkZXZfcHJpdiwgU0JJX1NTQ0RJVklOVFBIQVNFNiwgU0JJX0lDTEspOworCXRlbXAgPSBp
bnRlbF9zYmlfcmVhZChpOTE1LCBTQklfU1NDRElWSU5UUEhBU0U2LCBTQklfSUNMSyk7CiAJZGl2
c2VsID0gKHRlbXAgJiBTQklfU1NDRElWSU5UUEhBU0VfRElWU0VMX01BU0spID4+CiAJCVNCSV9T
U0NESVZJTlRQSEFTRV9ESVZTRUxfU0hJRlQ7CiAJcGhhc2VpbmMgPSAodGVtcCAmIFNCSV9TU0NE
SVZJTlRQSEFTRV9JTkNWQUxfTUFTSykgPj4KIAkJU0JJX1NTQ0RJVklOVFBIQVNFX0lOQ1ZBTF9T
SElGVDsKIAotCXRlbXAgPSBpbnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgU0JJX1NTQ0FVWERJVjYs
IFNCSV9JQ0xLKTsKKwl0ZW1wID0gaW50ZWxfc2JpX3JlYWQoaTkxNSwgU0JJX1NTQ0FVWERJVjYs
IFNCSV9JQ0xLKTsKIAlhdXhkaXYgPSAodGVtcCAmIFNCSV9TU0NBVVhESVZfRklOQUxESVYyU0VM
X01BU0spID4+CiAJCVNCSV9TU0NBVVhESVZfRklOQUxESVYyU0VMX1NISUZUOwogCi0JbXV0ZXhf
dW5sb2NrKCZkZXZfcHJpdi0+c2JfbG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5zYl9sb2Nr
KTsKIAogCWRlc2lyZWRfZGl2aXNvciA9IChkaXZzZWwgKyAyKSAqIGljbGtfcGlfcmFuZ2UgKyBw
aGFzZWluYzsKIApAQCAtNTA3OSw3ICs1MDc5LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGNo
X3RyYW5zY29kZXJfc2V0X3RpbWluZ3MoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmMK
IAkJCQkJCWVudW0gcGlwZSBwY2hfdHJhbnNjb2RlcikKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVu
dW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVy
OwogCiAJSTkxNV9XUklURShQQ0hfVFJBTlNfSFRPVEFMKHBjaF90cmFuc2NvZGVyKSwKQEAgLTUw
OTksNyArNTA5OSw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3BjaF90cmFuc2NvZGVyX3NldF90
aW1pbmdzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjCiAJCSAgIEk5MTVfUkVBRChW
U1lOQ1NISUZUKGNwdV90cmFuc2NvZGVyKSkpOwogfQogCi1zdGF0aWMgdm9pZCBjcHRfc2V0X2Zk
aV9iY19iaWZ1cmNhdGlvbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wg
ZW5hYmxlKQorc3RhdGljIHZvaWQgY3B0X3NldF9mZGlfYmNfYmlmdXJjYXRpb24oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIGJvb2wgZW5hYmxlKQogewogCXUzMiB0ZW1wOwogCkBAIC01
MTIyLDIwICs1MTIyLDIwIEBAIHN0YXRpYyB2b2lkIGNwdF9zZXRfZmRpX2JjX2JpZnVyY2F0aW9u
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBlCiBzdGF0aWMgdm9pZCBp
dnlicmlkZ2VfdXBkYXRlX2ZkaV9iY19iaWZ1cmNhdGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJc3dpdGNoIChjcnRj
LT5waXBlKSB7CiAJY2FzZSBQSVBFX0E6CiAJCWJyZWFrOwogCWNhc2UgUElQRV9COgogCQlpZiAo
Y3J0Y19zdGF0ZS0+ZmRpX2xhbmVzID4gMikKLQkJCWNwdF9zZXRfZmRpX2JjX2JpZnVyY2F0aW9u
KGRldl9wcml2LCBmYWxzZSk7CisJCQljcHRfc2V0X2ZkaV9iY19iaWZ1cmNhdGlvbihpOTE1LCBm
YWxzZSk7CiAJCWVsc2UKLQkJCWNwdF9zZXRfZmRpX2JjX2JpZnVyY2F0aW9uKGRldl9wcml2LCB0
cnVlKTsKKwkJCWNwdF9zZXRfZmRpX2JjX2JpZnVyY2F0aW9uKGk5MTUsIHRydWUpOwogCiAJCWJy
ZWFrOwogCWNhc2UgUElQRV9DOgotCQljcHRfc2V0X2ZkaV9iY19iaWZ1cmNhdGlvbihkZXZfcHJp
diwgdHJ1ZSk7CisJCWNwdF9zZXRfZmRpX2JjX2JpZnVyY2F0aW9uKGk5MTUsIHRydWUpOwogCiAJ
CWJyZWFrOwogCWRlZmF1bHQ6CkBAIC01MTg1LDEzICs1MTg1LDEzIEBAIHN0YXRpYyB2b2lkIGly
b25sYWtlX3BjaF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUs
CiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PmJhc2UuY3J0Yyk7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2Owot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlpbnQgcGlwZSA9IGNy
dGMtPnBpcGU7CiAJdTMyIHRlbXA7CiAKLQlhc3NlcnRfcGNoX3RyYW5zY29kZXJfZGlzYWJsZWQo
ZGV2X3ByaXYsIHBpcGUpOworCWFzc2VydF9wY2hfdHJhbnNjb2Rlcl9kaXNhYmxlZChpOTE1LCBw
aXBlKTsKIAotCWlmIChJU19JVllCUklER0UoZGV2X3ByaXYpKQorCWlmIChJU19JVllCUklER0Uo
aTkxNSkpCiAJCWl2eWJyaWRnZV91cGRhdGVfZmRpX2JjX2JpZnVyY2F0aW9uKGNydGNfc3RhdGUp
OwogCiAJLyogV3JpdGUgdGhlIFRVIHNpemUgYml0cyBiZWZvcmUgZmRpIGxpbmsgdHJhaW5pbmcs
IHNvIHRoYXQgZXJyb3IKQEAgLTUyMDAsMTggKzUyMDAsMTggQEAgc3RhdGljIHZvaWQgaXJvbmxh
a2VfcGNoX2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJ
ICAgSTkxNV9SRUFEKFBJUEVfREFUQV9NMShwaXBlKSkgJiBUVV9TSVpFX01BU0spOwogCiAJLyog
Rm9yIFBDSCBvdXRwdXQsIHRyYWluaW5nIEZESSBsaW5rICovCi0JZGV2X3ByaXYtPmRpc3BsYXku
ZmRpX2xpbmtfdHJhaW4oY3J0YywgY3J0Y19zdGF0ZSk7CisJaTkxNS0+ZGlzcGxheS5mZGlfbGlu
a190cmFpbihjcnRjLCBjcnRjX3N0YXRlKTsKIAogCS8qIFdlIG5lZWQgdG8gcHJvZ3JhbSB0aGUg
cmlnaHQgY2xvY2sgc2VsZWN0aW9uIGJlZm9yZSB3cml0aW5nIHRoZSBwaXhlbAogCSAqIG11dGxp
cGxpZXIgaW50byB0aGUgRFBMTC4gKi8KLQlpZiAoSEFTX1BDSF9DUFQoZGV2X3ByaXYpKSB7CisJ
aWYgKEhBU19QQ0hfQ1BUKGk5MTUpKSB7CiAJCXUzMiBzZWw7CiAKIAkJdGVtcCA9IEk5MTVfUkVB
RChQQ0hfRFBMTF9TRUwpOwogCQl0ZW1wIHw9IFRSQU5TX0RQTExfRU5BQkxFKHBpcGUpOwogCQlz
ZWwgPSBUUkFOU19EUExMQl9TRUwocGlwZSk7CiAJCWlmIChjcnRjX3N0YXRlLT5zaGFyZWRfZHBs
bCA9PQotCQkgICAgaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lkKGRldl9wcml2LCBEUExMX0lE
X1BDSF9QTExfQikpCisJCSAgICBpbnRlbF9nZXRfc2hhcmVkX2RwbGxfYnlfaWQoaTkxNSwgRFBM
TF9JRF9QQ0hfUExMX0IpKQogCQkJdGVtcCB8PSBzZWw7CiAJCWVsc2UKIAkJCXRlbXAgJj0gfnNl
bDsKQEAgLTUyMjgsMTMgKzUyMjgsMTMgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX2VuYWJs
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlpbnRlbF9lbmFibGVf
c2hhcmVkX2RwbGwoY3J0Y19zdGF0ZSk7CiAKIAkvKiBzZXQgdHJhbnNjb2RlciB0aW1pbmcsIHBh
bmVsIG11c3QgYWxsb3cgaXQgKi8KLQlhc3NlcnRfcGFuZWxfdW5sb2NrZWQoZGV2X3ByaXYsIHBp
cGUpOworCWFzc2VydF9wYW5lbF91bmxvY2tlZChpOTE1LCBwaXBlKTsKIAlpcm9ubGFrZV9wY2hf
dHJhbnNjb2Rlcl9zZXRfdGltaW5ncyhjcnRjX3N0YXRlLCBwaXBlKTsKIAogCWludGVsX2ZkaV9u
b3JtYWxfdHJhaW4oY3J0Yyk7CiAKIAkvKiBGb3IgUENIIERQLCBlbmFibGUgVFJBTlNfRFBfQ1RM
ICovCi0JaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSAmJgorCWlmIChIQVNfUENIX0NQVChpOTE1
KSAmJgogCSAgICBpbnRlbF9jcnRjX2hhc19kcF9lbmNvZGVyKGNydGNfc3RhdGUpKSB7CiAJCWNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KIAkJCSZjcnRjX3N0
YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CkBAIC01MjY4LDIyICs1MjY4LDIyIEBAIHN0YXRpYyB2
b2lkIGxwdF9wY2hfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
LAogCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRjX3N0
YXRlLT5jcHVfdHJhbnNjb2RlcjsKIAotCWFzc2VydF9wY2hfdHJhbnNjb2Rlcl9kaXNhYmxlZChk
ZXZfcHJpdiwgUElQRV9BKTsKKwlhc3NlcnRfcGNoX3RyYW5zY29kZXJfZGlzYWJsZWQoaTkxNSwg
UElQRV9BKTsKIAogCWxwdF9wcm9ncmFtX2ljbGtpcChjcnRjX3N0YXRlKTsKIAogCS8qIFNldCB0
cmFuc2NvZGVyIHRpbWluZy4gKi8KIAlpcm9ubGFrZV9wY2hfdHJhbnNjb2Rlcl9zZXRfdGltaW5n
cyhjcnRjX3N0YXRlLCBQSVBFX0EpOwogCi0JbHB0X2VuYWJsZV9wY2hfdHJhbnNjb2RlcihkZXZf
cHJpdiwgY3B1X3RyYW5zY29kZXIpOworCWxwdF9lbmFibGVfcGNoX3RyYW5zY29kZXIoaTkxNSwg
Y3B1X3RyYW5zY29kZXIpOwogfQogCiBzdGF0aWMgdm9pZCBjcHRfdmVyaWZ5X21vZGVzZXQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgaW50IHBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShkZXYpOwogCWk5MTVfcmVnX3QgZHNscmVnID0gUElQRURTTChwaXBlKTsK
IAl1MzIgdGVtcDsKIApAQCAtNTM4NSw3ICs1Mzg1LDcgQEAgc2tsX3VwZGF0ZV9zY2FsZXIoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsIGJvb2wgZm9yY2VfZGV0YWNoLAogCQkm
Y3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRj
ID0KIAkJdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfY3J0Yy0+YmFzZS5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNl
LmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQog
CQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOwogCkBAIC01NDAzLDcgKzU0MDMsNyBA
QCBza2xfdXBkYXRlX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwg
Ym9vbCBmb3JjZV9kZXRhY2gsCiAJICogT25jZSBOVjEyIGlzIGVuYWJsZWQsIGhhbmRsZSBpdCBo
ZXJlIHdoaWxlIGFsbG9jYXRpbmcgc2NhbGVyCiAJICogZm9yIE5WMTIuCiAJICovCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gOSAmJiBjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJgorCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gOSAmJiBjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJgogCSAg
ICBuZWVkX3NjYWxlciAmJiBhZGp1c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5U
RVJMQUNFKSB7CiAJCURSTV9ERUJVR19LTVMoIlBpcGUvUGxhbmUgc2NhbGluZyBub3Qgc3VwcG9y
dGVkIHdpdGggSUYtSUQgbW9kZVxuIik7CiAJCXJldHVybiAtRUlOVkFMOwpAQCAtNTQ0MiwxMCAr
NTQ0MiwxMCBAQCBza2xfdXBkYXRlX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwgYm9vbCBmb3JjZV9kZXRhY2gsCiAJLyogcmFuZ2UgY2hlY2tzICovCiAJaWYgKHNy
Y193IDwgU0tMX01JTl9TUkNfVyB8fCBzcmNfaCA8IFNLTF9NSU5fU1JDX0ggfHwKIAkgICAgZHN0
X3cgPCBTS0xfTUlOX0RTVF9XIHx8IGRzdF9oIDwgU0tMX01JTl9EU1RfSCB8fAotCSAgICAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCSAgICAoSU5URUxfR0VOKGk5MTUpID49IDExICYm
CiAJICAgICAoc3JjX3cgPiBJQ0xfTUFYX1NSQ19XIHx8IHNyY19oID4gSUNMX01BWF9TUkNfSCB8
fAogCSAgICAgIGRzdF93ID4gSUNMX01BWF9EU1RfVyB8fCBkc3RfaCA+IElDTF9NQVhfRFNUX0gp
KSB8fAotCSAgICAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExICYmCisJICAgIChJTlRFTF9HRU4o
aTkxNSkgPCAxMSAmJgogCSAgICAgKHNyY193ID4gU0tMX01BWF9TUkNfVyB8fCBzcmNfaCA+IFNL
TF9NQVhfU1JDX0ggfHwKIAkgICAgICBkc3RfdyA+IFNLTF9NQVhfRFNUX1cgfHwgZHN0X2ggPiBT
S0xfTUFYX0RTVF9IKSkpCXsKIAkJRFJNX0RFQlVHX0tNUygic2NhbGVyX3VzZXIgaW5kZXggJXUu
JXU6IHNyYyAldXgldSBkc3QgJXV4JXUgIgpAQCAtNTUwMiwxNCArNTUwMiwxNCBAQCBzdGF0aWMg
aW50IHNrbF91cGRhdGVfc2NhbGVyX3BsYW5lKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPQogCQl0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwog
CXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CiAJaW50
IHJldDsKIAlib29sIGZvcmNlX2RldGFjaCA9ICFmYiB8fCAhcGxhbmVfc3RhdGUtPmJhc2Uudmlz
aWJsZTsKIAlib29sIG5lZWRfc2NhbGVyID0gZmFsc2U7CiAKIAkvKiBQcmUtZ2VuMTEgYW5kIFNE
UiBwbGFuZXMgYWx3YXlzIG5lZWQgYSBzY2FsZXIgZm9yIHBsYW5hciBmb3JtYXRzLiAqLwotCWlm
ICghaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgaW50ZWxfcGxhbmUtPmlkKSAmJgorCWlmICgh
aWNsX2lzX2hkcl9wbGFuZShpOTE1LCBpbnRlbF9wbGFuZS0+aWQpICYmCiAJICAgIGZiICYmIGlz
X3BsYW5hcl95dXZfZm9ybWF0KGZiLT5mb3JtYXQtPmZvcm1hdCkpCiAJCW5lZWRfc2NhbGVyID0g
dHJ1ZTsKIApAQCAtNTU4Miw3ICs1NTgyLDcgQEAgc3RhdGljIHZvaWQgc2t5bGFrZV9zY2FsZXJf
ZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHN0YXRpYyB2b2lkIHNreWxha2VfcGZp
dF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUgPQogCQkmY3J0Y19zdGF0
ZS0+c2NhbGVyX3N0YXRlOwpAQCAtNTYxOSw3ICs1NjE5LDcgQEAgc3RhdGljIHZvaWQgc2t5bGFr
ZV9wZml0X2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHN0YXRpYyB2b2lkIGlyb25sYWtlX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJaW50IHBpcGUgPSBjcnRj
LT5waXBlOwogCiAJaWYgKGNydGNfc3RhdGUtPnBjaF9wZml0LmVuYWJsZWQpIHsKQEAgLTU2Mjcs
NyArNTYyNyw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQkgKiBhcyBzb21lIHByZS1wcm9ncmFt
bWVkIHZhbHVlcyBhcmUgYnJva2VuLAogCQkgKiBlLmcuIHgyMDEuCiAJCSAqLwotCQlpZiAoSVNf
SVZZQlJJREdFKGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSkKKwkJaWYgKElTX0lW
WUJSSURHRShpOTE1KSB8fCBJU19IQVNXRUxMKGk5MTUpKQogCQkJSTkxNV9XUklURShQRl9DVEwo
cGlwZSksIFBGX0VOQUJMRSB8IFBGX0ZJTFRFUl9NRURfM3gzIHwKIAkJCQkJCSBQRl9QSVBFX1NF
TF9JVkIocGlwZSkpOwogCQllbHNlCkBAIC01NjQxLDcgKzU2NDEsNyBAQCB2b2lkIGhzd19lbmFi
bGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNy
dGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAKIAlpZiAoIWNydGNfc3RhdGUtPmlw
c19lbmFibGVkKQogCQlyZXR1cm47CkBAIC01NjUzLDggKzU2NTMsOCBAQCB2b2lkIGhzd19lbmFi
bGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAqLwog
CVdBUk5fT04oIShjcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzICYgfkJJVChQTEFORV9DVVJTT1Ip
KSk7CiAKLQlpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSkgewotCQlXQVJOX09OKHNhbmR5YnJp
ZGdlX3Bjb2RlX3dyaXRlKGRldl9wcml2LCBESVNQTEFZX0lQU19DT05UUk9MLAorCWlmIChJU19C
Uk9BRFdFTEwoaTkxNSkpIHsKKwkJV0FSTl9PTihzYW5keWJyaWRnZV9wY29kZV93cml0ZShpOTE1
LCBESVNQTEFZX0lQU19DT05UUk9MLAogCQkJCQkJSVBTX0VOQUJMRSB8IElQU19QQ09ERV9DT05U
Uk9MKSk7CiAJCS8qIFF1b3RpbmcgQXJ0IFJ1bnlhbjogIml0cyBub3Qgc2FmZSB0byBleHBlY3Qg
YW55IHBhcnRpY3VsYXIKIAkJICogdmFsdWUgaW4gSVBTX0NUTCBiaXQgMzEgYWZ0ZXIgZW5hYmxp
bmcgSVBTIHRocm91Z2ggdGhlCkBAIC01NjY4LDcgKzU2NjgsNyBAQCB2b2lkIGhzd19lbmFibGVf
aXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQkgKiBhbmQg
ZG9uJ3Qgd2FpdCBmb3IgdmJsYW5rcyB1bnRpbCB0aGUgZW5kIG9mIGNydGNfZW5hYmxlLCB0aGVu
CiAJCSAqIHRoZSBIVyBzdGF0ZSByZWFkb3V0IGNvZGUgd2lsbCBjb21wbGFpbiB0aGF0IHRoZSBl
eHBlY3RlZAogCQkgKiBJUFNfQ1RMIHZhbHVlIGlzIG5vdCB0aGUgb25lIHdlIHJlYWQuICovCi0J
CWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwkJaWYgKGlu
dGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJCSAgICBJUFNfQ1RMLCBJ
UFNfRU5BQkxFLCBJUFNfRU5BQkxFLAogCQkJCQkgICAgNTApKQogCQkJRFJNX0VSUk9SKCJUaW1l
ZCBvdXQgd2FpdGluZyBmb3IgSVBTIGVuYWJsZVxuIik7CkBAIC01Njc5LDE5ICs1Njc5LDE5IEBA
IHZvaWQgaHN3X2Rpc2FibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNl
LmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAKIAlpZiAo
IWNydGNfc3RhdGUtPmlwc19lbmFibGVkKQogCQlyZXR1cm47CiAKLQlpZiAoSVNfQlJPQURXRUxM
KGRldl9wcml2KSkgewotCQlXQVJOX09OKHNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlKGRldl9wcml2
LCBESVNQTEFZX0lQU19DT05UUk9MLCAwKSk7CisJaWYgKElTX0JST0FEV0VMTChpOTE1KSkgewor
CQlXQVJOX09OKHNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlKGk5MTUsIERJU1BMQVlfSVBTX0NPTlRS
T0wsIDApKTsKIAkJLyoKIAkJICogV2FpdCBmb3IgUENPREUgdG8gZmluaXNoIGRpc2FibGluZyBJ
UFMuIFRoZSBCU3BlYyBzcGVjaWZpZWQKIAkJICogNDJtcyB0aW1lb3V0IHZhbHVlIGxlYWRzIHRv
IG9jY2FzaW9uYWwgdGltZW91dHMgc28gdXNlIDEwMG1zCiAJCSAqIGluc3RlYWQuCiAJCSAqLwot
CQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJCWlmIChp
bnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAgSVBTX0NUTCwg
SVBTX0VOQUJMRSwgMCwKIAkJCQkJICAgIDEwMCkpCiAJCQlEUk1fRVJST1IoIlRpbWVkIG91dCB3
YWl0aW5nIGZvciBJUFMgZGlzYWJsZVxuIik7CkBAIC01NzAxLDcgKzU3MDEsNyBAQCB2b2lkIGhz
d19kaXNhYmxlX2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IAl9CiAKIAkvKiBXZSBuZWVkIHRvIHdhaXQgZm9yIGEgdmJsYW5rIGJlZm9yZSB3ZSBjYW4gZGlz
YWJsZSB0aGUgcGxhbmUuICovCi0JaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LCBjcnRj
LT5waXBlKTsKKwlpbnRlbF93YWl0X2Zvcl92YmxhbmsoaTkxNSwgY3J0Yy0+cGlwZSk7CiB9CiAK
IHN0YXRpYyB2b2lkIGludGVsX2NydGNfZHBtc19vdmVybGF5X2Rpc2FibGUoc3RydWN0IGludGVs
X2NydGMgKmludGVsX2NydGMpCkBAIC01NzM1LDcgKzU3MzUsNyBAQCBpbnRlbF9wb3N0X2VuYWJs
ZV9wcmltYXJ5KHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCSAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBjcnRjLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwog
CXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKIAlp
bnQgcGlwZSA9IGludGVsX2NydGMtPnBpcGU7CiAKQEAgLTU3NDYsMTIgKzU3NDYsMTIgQEAgaW50
ZWxfcG9zdF9lbmFibGVfcHJpbWFyeShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJICogRklYTUU6
IE5lZWQgdG8gZml4IHRoZSBsb2dpYyB0byB3b3JrIHdoZW4gd2UgdHVybiBvZmYgYWxsIHBsYW5l
cwogCSAqIGJ1dCBsZWF2ZSB0aGUgcGlwZSBydW5uaW5nLgogCSAqLwotCWlmIChJU19HRU4oZGV2
X3ByaXYsIDIpKQotCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9w
cml2LCBwaXBlLCB0cnVlKTsKKwlpZiAoSVNfR0VOKGk5MTUsIDIpKQorCQlpbnRlbF9zZXRfY3B1
X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsIHBpcGUsIHRydWUpOwogCiAJLyogVW5kZXJy
dW5zIGRvbid0IGFsd2F5cyByYWlzZSBpbnRlcnJ1cHRzLCBzbyBjaGVjayBtYW51YWxseS4gKi8K
LQlpbnRlbF9jaGVja19jcHVfZmlmb191bmRlcnJ1bnMoZGV2X3ByaXYpOwotCWludGVsX2NoZWNr
X3BjaF9maWZvX3VuZGVycnVucyhkZXZfcHJpdik7CisJaW50ZWxfY2hlY2tfY3B1X2ZpZm9fdW5k
ZXJydW5zKGk5MTUpOworCWludGVsX2NoZWNrX3BjaF9maWZvX3VuZGVycnVucyhpOTE1KTsKIH0K
IAogLyogRklYTUUgZ2V0IHJpZCBvZiB0aGlzIGFuZCB1c2UgcHJlX3BsYW5lX3VwZGF0ZSAqLwpA
QCAtNTc1OSw3ICs1NzU5LDcgQEAgc3RhdGljIHZvaWQKIGludGVsX3ByZV9kaXNhYmxlX3ByaW1h
cnlfbm9hdG9taWMoc3RydWN0IGRybV9jcnRjICpjcnRjKQogewogCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBjcnRjLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShk
ZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
KTsKIAlpbnQgcGlwZSA9IGludGVsX2NydGMtPnBpcGU7CiAKQEAgLTU3NjcsOCArNTc2Nyw4IEBA
IGludGVsX3ByZV9kaXNhYmxlX3ByaW1hcnlfbm9hdG9taWMoc3RydWN0IGRybV9jcnRjICpjcnRj
KQogCSAqIEdlbjIgcmVwb3J0cyBwaXBlIHVuZGVycnVucyB3aGVuZXZlciBhbGwgcGxhbmVzIGFy
ZSBkaXNhYmxlZC4KIAkgKiBTbyBkaXNhYmxlIHVuZGVycnVuIHJlcG9ydGluZyBiZWZvcmUgYWxs
IHRoZSBwbGFuZXMgZ2V0IGRpc2FibGVkLgogCSAqLwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDIp
KQotCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBwaXBl
LCBmYWxzZSk7CisJaWYgKElTX0dFTihpOTE1LCAyKSkKKwkJaW50ZWxfc2V0X2NwdV9maWZvX3Vu
ZGVycnVuX3JlcG9ydGluZyhpOTE1LCBwaXBlLCBmYWxzZSk7CiAKIAloc3dfZGlzYWJsZV9pcHMo
dG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5zdGF0ZSkpOwogCkBAIC01NzgxLDE2ICs1NzgxLDE2
IEBAIGludGVsX3ByZV9kaXNhYmxlX3ByaW1hcnlfbm9hdG9taWMoc3RydWN0IGRybV9jcnRjICpj
cnRjKQogCSAqIGV2ZW50IHdoaWNoIGlzIGFmdGVyIHRoZSB2Ymxhbmsgc3RhcnQgZXZlbnQsIHNv
IHdlIG5lZWQgdG8gaGF2ZSBhCiAJICogd2FpdC1mb3ItdmJsYW5rIGJldHdlZW4gZGlzYWJsaW5n
IHRoZSBwbGFuZSBhbmQgdGhlIHBpcGUuCiAJICovCi0JaWYgKEhBU19HTUNIKGRldl9wcml2KSAm
JgotCSAgICBpbnRlbF9zZXRfbWVtb3J5X2N4c3IoZGV2X3ByaXYsIGZhbHNlKSkKLQkJaW50ZWxf
d2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LCBwaXBlKTsKKwlpZiAoSEFTX0dNQ0goaTkxNSkgJiYK
KwkgICAgaW50ZWxfc2V0X21lbW9yeV9jeHNyKGk5MTUsIGZhbHNlKSkKKwkJaW50ZWxfd2FpdF9m
b3JfdmJsYW5rKGk5MTUsIHBpcGUpOwogfQogCiBzdGF0aWMgYm9vbCBoc3dfcHJlX3VwZGF0ZV9k
aXNhYmxlX2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUs
CiAJCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0
ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAogCWlmICghb2xkX2NydGNfc3RhdGUtPmlwc19l
bmFibGVkKQogCQlyZXR1cm4gZmFsc2U7CkBAIC01ODA0LDcgKzU4MDQsNyBAQCBzdGF0aWMgYm9v
bCBoc3dfcHJlX3VwZGF0ZV9kaXNhYmxlX2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqb2xkX2NydGNfcwogCSAqCiAJICogRGlzYWJsZSBJUFMgYmVmb3JlIHdlIHByb2dyYW0gdGhl
IExVVC4KIAkgKi8KLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgJiYKKwlpZiAoSVNfSEFTV0VM
TChpOTE1KSAmJgogCSAgICAobmV3X2NydGNfc3RhdGUtPmJhc2UuY29sb3JfbWdtdF9jaGFuZ2Vk
IHx8CiAJICAgICBuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpICYmCiAJICAgIG5ld19jcnRj
X3N0YXRlLT5nYW1tYV9tb2RlID09IEdBTU1BX01PREVfTU9ERV9TUExJVCkKQEAgLTU4MTcsNyAr
NTgxNyw3IEBAIHN0YXRpYyBib29sIGhzd19wb3N0X3VwZGF0ZV9lbmFibGVfaXBzKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zCiAJCQkJICAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAogCWlmICghbmV3X2NydGNfc3RhdGUtPmlwc19lbmFibGVkKQogCQlyZXR1cm4gZmFsc2U7
CkBAIC01ODMxLDcgKzU4MzEsNyBAQCBzdGF0aWMgYm9vbCBoc3dfcG9zdF91cGRhdGVfZW5hYmxl
X2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfcwogCSAqCiAJICog
UmUtZW5hYmxlIElQUyBhZnRlciB0aGUgTFVUIGhhcyBiZWVuIHByb2dyYW1tZWQuCiAJICovCi0J
aWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmCisJaWYgKElTX0hBU1dFTEwoaTkxNSkgJiYKIAkg
ICAgKG5ld19jcnRjX3N0YXRlLT5iYXNlLmNvbG9yX21nbXRfY2hhbmdlZCB8fAogCSAgICAgbmV3
X2NydGNfc3RhdGUtPnVwZGF0ZV9waXBlKSAmJgogCSAgICBuZXdfY3J0Y19zdGF0ZS0+Z2FtbWFf
bW9kZSA9PSBHQU1NQV9NT0RFX01PREVfU1BMSVQpCkBAIC01ODQ4LDI0ICs1ODQ4LDI0IEBAIHN0
YXRpYyBib29sIGhzd19wb3N0X3VwZGF0ZV9lbmFibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpvbGRfY3J0Y19zCiAJcmV0dXJuICFvbGRfY3J0Y19zdGF0ZS0+aXBzX2VuYWJs
ZWQ7CiB9CiAKLXN0YXRpYyBib29sIG5lZWRzX252MTJfd2Eoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgbmVlZHNfbnYxMl93YShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7CiAJaWYgKCFjcnRjX3N0YXRlLT5udjEyX3BsYW5lcykKIAkJcmV0dXJuIGZhbHNl
OwogCiAJLyogV0EgRGlzcGxheSAjMDgyNzogR2VuOTphbGwgKi8KLQlpZiAoSVNfR0VOKGRldl9w
cml2LCA5KSAmJiAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElTX0dFTihpOTE1LCA5
KSAmJiAhSVNfR0VNSU5JTEFLRShpOTE1KSkKIAkJcmV0dXJuIHRydWU7CiAKIAlyZXR1cm4gZmFs
c2U7CiB9CiAKLXN0YXRpYyBib29sIG5lZWRzX3NjYWxlcmNsa193YShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBuZWVkc19zY2FsZXJjbGtfd2Eoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJLyogV2FfMjAwNjYwNDMxMjppY2wgKi8KLQlpZiAo
Y3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlLnNjYWxlcl91c2VycyA+IDAgJiYgSVNfSUNFTEFLRShk
ZXZfcHJpdikpCisJaWYgKGNydGNfc3RhdGUtPnNjYWxlcl9zdGF0ZS5zY2FsZXJfdXNlcnMgPiAw
ICYmIElTX0lDRUxBS0UoaTkxNSkpCiAJCXJldHVybiB0cnVlOwogCiAJcmV0dXJuIGZhbHNlOwpA
QCAtNTg3NSw3ICs1ODc1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9zdF9wbGFuZV91cGRhdGUo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
IAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpv
bGRfc3RhdGUgPSBvbGRfY3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcgPQogCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRl
KHRvX2ludGVsX2F0b21pY19zdGF0ZShvbGRfc3RhdGUpLApAQCAtNTkwNCwxMyArNTkwNCwxMyBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9wb3N0X3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGUpCiAJCQlpbnRlbF9wb3N0X2VuYWJsZV9wcmltYXJ5KCZjcnRj
LT5iYXNlLCBwaXBlX2NvbmZpZyk7CiAJfQogCi0JaWYgKG5lZWRzX252MTJfd2EoZGV2X3ByaXYs
IG9sZF9jcnRjX3N0YXRlKSAmJgotCSAgICAhbmVlZHNfbnYxMl93YShkZXZfcHJpdiwgcGlwZV9j
b25maWcpKQotCQlza2xfd2FfODI3KGRldl9wcml2LCBjcnRjLT5waXBlLCBmYWxzZSk7CisJaWYg
KG5lZWRzX252MTJfd2EoaTkxNSwgb2xkX2NydGNfc3RhdGUpICYmCisJICAgICFuZWVkc19udjEy
X3dhKGk5MTUsIHBpcGVfY29uZmlnKSkKKwkJc2tsX3dhXzgyNyhpOTE1LCBjcnRjLT5waXBlLCBm
YWxzZSk7CiAKLQlpZiAobmVlZHNfc2NhbGVyY2xrX3dhKGRldl9wcml2LCBvbGRfY3J0Y19zdGF0
ZSkgJiYKLQkgICAgIW5lZWRzX3NjYWxlcmNsa193YShkZXZfcHJpdiwgcGlwZV9jb25maWcpKQot
CQlpY2xfd2Ffc2NhbGVyY2xrZ2F0aW5nKGRldl9wcml2LCBjcnRjLT5waXBlLCBmYWxzZSk7CisJ
aWYgKG5lZWRzX3NjYWxlcmNsa193YShpOTE1LCBvbGRfY3J0Y19zdGF0ZSkgJiYKKwkgICAgIW5l
ZWRzX3NjYWxlcmNsa193YShpOTE1LCBwaXBlX2NvbmZpZykpCisJCWljbF93YV9zY2FsZXJjbGtn
YXRpbmcoaTkxNSwgY3J0Yy0+cGlwZSwgZmFsc2UpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9w
cmVfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwK
QEAgLTU5MTgsNyArNTkxOCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByZV9wbGFuZV91cGRhdGUo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogewogCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
IAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpv
bGRfc3RhdGUgPSBvbGRfY3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZTsKIAlzdHJ1Y3QgZHJtX3BsYW5l
ICpwcmltYXJ5ID0gY3J0Yy0+YmFzZS5wcmltYXJ5OwogCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUg
Km9sZF9wcmltYXJ5X3N0YXRlID0KQEAgLTU5NDAsMjAgKzU5NDAsMjAgQEAgc3RhdGljIHZvaWQg
aW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUsCiAJCSAqIEdlbjIgcmVwb3J0cyBwaXBlIHVuZGVycnVucyB3aGVuZXZlciBhbGwgcGxh
bmVzIGFyZSBkaXNhYmxlZC4KIAkJICogU28gZGlzYWJsZSB1bmRlcnJ1biByZXBvcnRpbmcgYmVm
b3JlIGFsbCB0aGUgcGxhbmVzIGdldCBkaXNhYmxlZC4KIAkJICovCi0JCWlmIChJU19HRU4oZGV2
X3ByaXYsIDIpICYmIG9sZF9wcmltYXJ5X3N0YXRlLT52aXNpYmxlICYmCisJCWlmIChJU19HRU4o
aTkxNSwgMikgJiYgb2xkX3ByaW1hcnlfc3RhdGUtPnZpc2libGUgJiYKIAkJICAgIChtb2Rlc2V0
IHx8ICFuZXdfcHJpbWFyeV9zdGF0ZS0+YmFzZS52aXNpYmxlKSkKLQkJCWludGVsX3NldF9jcHVf
Zmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIGNydGMtPnBpcGUsIGZhbHNlKTsKKwkJ
CWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgY3J0Yy0+cGlwZSwg
ZmFsc2UpOwogCX0KIAogCS8qIERpc3BsYXkgV0EgODI3ICovCi0JaWYgKCFuZWVkc19udjEyX3dh
KGRldl9wcml2LCBvbGRfY3J0Y19zdGF0ZSkgJiYKLQkgICAgbmVlZHNfbnYxMl93YShkZXZfcHJp
diwgcGlwZV9jb25maWcpKQotCQlza2xfd2FfODI3KGRldl9wcml2LCBjcnRjLT5waXBlLCB0cnVl
KTsKKwlpZiAoIW5lZWRzX252MTJfd2EoaTkxNSwgb2xkX2NydGNfc3RhdGUpICYmCisJICAgIG5l
ZWRzX252MTJfd2EoaTkxNSwgcGlwZV9jb25maWcpKQorCQlza2xfd2FfODI3KGk5MTUsIGNydGMt
PnBpcGUsIHRydWUpOwogCiAJLyogV2FfMjAwNjYwNDMxMjppY2wgKi8KLQlpZiAoIW5lZWRzX3Nj
YWxlcmNsa193YShkZXZfcHJpdiwgb2xkX2NydGNfc3RhdGUpICYmCi0JICAgIG5lZWRzX3NjYWxl
cmNsa193YShkZXZfcHJpdiwgcGlwZV9jb25maWcpKQotCQlpY2xfd2Ffc2NhbGVyY2xrZ2F0aW5n
KGRldl9wcml2LCBjcnRjLT5waXBlLCB0cnVlKTsKKwlpZiAoIW5lZWRzX3NjYWxlcmNsa193YShp
OTE1LCBvbGRfY3J0Y19zdGF0ZSkgJiYKKwkgICAgbmVlZHNfc2NhbGVyY2xrX3dhKGk5MTUsIHBp
cGVfY29uZmlnKSkKKwkJaWNsX3dhX3NjYWxlcmNsa2dhdGluZyhpOTE1LCBjcnRjLT5waXBlLCB0
cnVlKTsKIAogCS8qCiAJICogVmJsYW5rIHRpbWUgdXBkYXRlcyBmcm9tIHRoZSBzaGFkb3cgdG8g
bGl2ZSBwbGFuZSBjb250cm9sIHJlZ2lzdGVyCkBAIC01OTY0LDkgKzU5NjQsOSBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRf
Y3J0Y19zdGF0ZSwKIAkgKiBldmVudCB3aGljaCBpcyBhZnRlciB0aGUgdmJsYW5rIHN0YXJ0IGV2
ZW50LCBzbyB3ZSBuZWVkIHRvIGhhdmUgYQogCSAqIHdhaXQtZm9yLXZibGFuayBiZXR3ZWVuIGRp
c2FibGluZyB0aGUgcGxhbmUgYW5kIHRoZSBwaXBlLgogCSAqLwotCWlmIChIQVNfR01DSChkZXZf
cHJpdikgJiYgb2xkX2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlICYmCi0JICAgIHBpcGVfY29uZmln
LT5kaXNhYmxlX2N4c3IgJiYgaW50ZWxfc2V0X21lbW9yeV9jeHNyKGRldl9wcml2LCBmYWxzZSkp
Ci0JCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgY3J0Yy0+cGlwZSk7CisJaWYgKEhB
U19HTUNIKGk5MTUpICYmIG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCSAgICBwaXBl
X2NvbmZpZy0+ZGlzYWJsZV9jeHNyICYmIGludGVsX3NldF9tZW1vcnlfY3hzcihpOTE1LCBmYWxz
ZSkpCisJCWludGVsX3dhaXRfZm9yX3ZibGFuayhpOTE1LCBjcnRjLT5waXBlKTsKIAogCS8qCiAJ
ICogSVZCIHdvcmthcm91bmQ6IG11c3QgZGlzYWJsZSBsb3cgcG93ZXIgd2F0ZXJtYXJrcyBmb3Ig
YXQgbGVhc3QKQEAgLTU5NzcsNyArNTk3Nyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByZV9wbGFu
ZV91cGRhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCSAqLwog
CWlmIChwaXBlX2NvbmZpZy0+ZGlzYWJsZV9scF93bSAmJiBpbGtfZGlzYWJsZV9scF93bShkZXYp
ICYmCiAJICAgIG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKLQkJaW50ZWxfd2FpdF9mb3Jf
dmJsYW5rKGRldl9wcml2LCBjcnRjLT5waXBlKTsKKwkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGk5
MTUsIGNydGMtPnBpcGUpOwogCiAJLyoKIAkgKiBJZiB3ZSdyZSBkb2luZyBhIG1vZGVzZXQsIHdl
J3JlIGRvbmUuICBObyBuZWVkIHRvIGRvIGFueSBwcmUtdmJsYW5rCkBAIC02MDAwLDggKzYwMDAs
OCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkgKiB3ZSdsbCBjb250aW51ZSB0byB1cGRhdGUgd2F0
ZXJtYXJrcyB0aGUgb2xkIHdheSwgaWYgZmxhZ3MgdGVsbAogCSAqIHVzIHRvLgogCSAqLwotCWlm
IChkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MgIT0gTlVMTCkKLQkJZGV2X3By
aXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKG9sZF9pbnRlbF9zdGF0ZSwKKwlpZiAoaTkx
NS0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MgIT0gTlVMTCkKKwkJaTkxNS0+ZGlzcGxheS5p
bml0aWFsX3dhdGVybWFya3Mob2xkX2ludGVsX3N0YXRlLAogCQkJCQkJICAgICBwaXBlX2NvbmZp
Zyk7CiAJZWxzZSBpZiAocGlwZV9jb25maWctPnVwZGF0ZV93bV9wcmUpCiAJCWludGVsX3VwZGF0
ZV93YXRlcm1hcmtzKGNydGMpOwpAQCAtNjAxMCw3ICs2MDEwLDcgQEAgc3RhdGljIHZvaWQgaW50
ZWxfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3Rh
dGUsCiBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2Rpc2FibGVfcGxhbmVzKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRl
ID0KIAkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CiAJdW5z
aWduZWQgaW50IHVwZGF0ZV9tYXNrID0gbmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9wbGFuZXM7CkBA
IC02MDMyLDcgKzYwMzIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2Rpc2FibGVfcGxhbmVz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJZmJfYml0cyB8PSBwbGFuZS0+
ZnJvbnRidWZmZXJfYml0OwogCX0KIAotCWludGVsX2Zyb250YnVmZmVyX2ZsaXAoZGV2X3ByaXYs
IGZiX2JpdHMpOworCWludGVsX2Zyb250YnVmZmVyX2ZsaXAoaTkxNSwgZmJfYml0cyk7CiB9CiAK
IHN0YXRpYyB2b2lkIGludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5hYmxlKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKQEAgLTYxOTAsNyArNjE5MCw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNf
ZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIHsKIAlzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+YmFzZS5jcnRjOwogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBjcnRjLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjKTsKIAlpbnQgcGlwZSA9IGludGVsX2NydGMtPnBpcGU7CiAJc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqb2xkX2ludGVsX3N0YXRlID0KQEAgLTYyMDksOCArNjIwOSw4IEBAIHN0YXRpYyB2
b2lkIGlyb25sYWtlX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZywKIAkgKgogCSAqIFNwdXJpb3VzIFBDSCB1bmRlcnJ1bnMgYWxzbyBvY2N1ciBkdXJpbmcg
UENIIGVuYWJsaW5nLgogCSAqLwotCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRp
bmcoZGV2X3ByaXYsIHBpcGUsIGZhbHNlKTsKLQlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5f
cmVwb3J0aW5nKGRldl9wcml2LCBwaXBlLCBmYWxzZSk7CisJaW50ZWxfc2V0X2NwdV9maWZvX3Vu
ZGVycnVuX3JlcG9ydGluZyhpOTE1LCBwaXBlLCBmYWxzZSk7CisJaW50ZWxfc2V0X3BjaF9maWZv
X3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBwaXBlLCBmYWxzZSk7CiAKIAlpZiAocGlwZV9jb25m
aWctPmhhc19wY2hfZW5jb2RlcikKIAkJaW50ZWxfcHJlcGFyZV9zaGFyZWRfZHBsbChwaXBlX2Nv
bmZpZyk7CkBAIC02MjM4LDggKzYyMzgsOCBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9jcnRjX2Vu
YWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCSAqIGVuYWJsaW5n
LiAqLwogCQlpcm9ubGFrZV9mZGlfcGxsX2VuYWJsZShwaXBlX2NvbmZpZyk7CiAJfSBlbHNlIHsK
LQkJYXNzZXJ0X2ZkaV90eF9kaXNhYmxlZChkZXZfcHJpdiwgcGlwZSk7Ci0JCWFzc2VydF9mZGlf
cnhfZGlzYWJsZWQoZGV2X3ByaXYsIHBpcGUpOworCQlhc3NlcnRfZmRpX3R4X2Rpc2FibGVkKGk5
MTUsIHBpcGUpOworCQlhc3NlcnRfZmRpX3J4X2Rpc2FibGVkKGk5MTUsIHBpcGUpOwogCX0KIAog
CWlyb25sYWtlX3BmaXRfZW5hYmxlKHBpcGVfY29uZmlnKTsKQEAgLTYyNTMsOCArNjI1Myw4IEBA
IHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZywKIAkvKiB1cGRhdGUgRFNQQ05UUiB0byBjb25maWd1cmUgZ2FtbWEgZm9y
IHBpcGUgYm90dG9tIGNvbG9yICovCiAJaW50ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKHBpcGVf
Y29uZmlnKTsKIAotCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MgIT0g
TlVMTCkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKG9sZF9pbnRlbF9z
dGF0ZSwgcGlwZV9jb25maWcpOworCWlmIChpOTE1LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJr
cyAhPSBOVUxMKQorCQlpOTE1LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhvbGRfaW50ZWxf
c3RhdGUsIHBpcGVfY29uZmlnKTsKIAlpbnRlbF9lbmFibGVfcGlwZShwaXBlX2NvbmZpZyk7CiAK
IAlpZiAocGlwZV9jb25maWctPmhhc19wY2hfZW5jb2RlcikKQEAgLTYyNjUsNyArNjI2NSw3IEBA
IHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZywKIAogCWludGVsX2VuY29kZXJzX2VuYWJsZShjcnRjLCBwaXBlX2NvbmZp
Zywgb2xkX3N0YXRlKTsKIAotCWlmIChIQVNfUENIX0NQVChkZXZfcHJpdikpCisJaWYgKEhBU19Q
Q0hfQ1BUKGk5MTUpKQogCQljcHRfdmVyaWZ5X21vZGVzZXQoZGV2LCBpbnRlbF9jcnRjLT5waXBl
KTsKIAogCS8qCkBAIC02Mjc1LDExICs2Mjc1LDExIEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2Ny
dGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkgKiBpbiBj
YXNlIHRoZXJlIGFyZSBtb3JlIGNvcm5lciBjYXNlcyB3ZSBkb24ndCBrbm93IGFib3V0LgogCSAq
LwogCWlmIChwaXBlX2NvbmZpZy0+aGFzX3BjaF9lbmNvZGVyKSB7Ci0JCWludGVsX3dhaXRfZm9y
X3ZibGFuayhkZXZfcHJpdiwgcGlwZSk7Ci0JCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJp
diwgcGlwZSk7CisJCWludGVsX3dhaXRfZm9yX3ZibGFuayhpOTE1LCBwaXBlKTsKKwkJaW50ZWxf
d2FpdF9mb3JfdmJsYW5rKGk5MTUsIHBpcGUpOwogCX0KLQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5k
ZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBwaXBlLCB0cnVlKTsKLQlpbnRlbF9zZXRfcGNoX2Zp
Zm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBwaXBlLCB0cnVlKTsKKwlpbnRlbF9zZXRf
Y3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsIHBpcGUsIHRydWUpOworCWludGVsX3Nl
dF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgcGlwZSwgdHJ1ZSk7CiB9CiAKIC8q
IElQUyBvbmx5IGV4aXN0cyBvbiBVTFQgbWFjaGluZXMgYW5kIGlzIHRpZWQgdG8gcGlwZSBBLiAq
LwpAQCAtNjI4OCw3ICs2Mjg4LDcgQEAgc3RhdGljIGJvb2wgaHN3X2NydGNfc3VwcG9ydHNfaXBz
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCXJldHVybiBIQVNfSVBTKHRvX2k5MTUoY3J0Yy0+
YmFzZS5kZXYpKSAmJiBjcnRjLT5waXBlID09IFBJUEVfQTsKIH0KIAotc3RhdGljIHZvaWQgZ2xr
X3BpcGVfc2NhbGVyX2Nsb2NrX2dhdGluZ193YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBnbGtfcGlwZV9zY2FsZXJfY2xvY2tfZ2F0aW5nX3dhKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgICAgZW51bSBwaXBlIHBpcGUsIGJvb2wg
YXBwbHkpCiB7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChDTEtHQVRFX0RJU19QU0wocGlwZSkpOwpA
QCAtNjMwNCw3ICs2MzA0LDcgQEAgc3RhdGljIHZvaWQgZ2xrX3BpcGVfc2NhbGVyX2Nsb2NrX2dh
dGluZ193YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIHN0YXRpYyB2b2lk
IGljbF9waXBlX21idXNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiB2YWw7CiAKQEAgLTYzMTksNyAr
NjMxOSw3IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRf
c3RhdGUpCiB7CiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlwZV9jb25maWctPmJhc2UuY3J0
YzsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmRldik7
CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwog
CWludCBwaXBlID0gaW50ZWxfY3J0Yy0+cGlwZSwgaHN3X3dvcmthcm91bmRfcGlwZTsKIAllbnVt
IHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXI7
CkBAIC02MzU5LDE4ICs2MzU5LDE4IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCWlmICghdHJhbnNjb2Rlcl9p
c19kc2koY3B1X3RyYW5zY29kZXIpKQogCQloYXN3ZWxsX3NldF9waXBlY29uZihwaXBlX2NvbmZp
Zyk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5IHx8IElTX0JST0FEV0VMTChkZXZf
cHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5IHx8IElTX0JST0FEV0VMTChpOTE1KSkK
IAkJYmR3X3NldF9waXBlbWlzYyhwaXBlX2NvbmZpZyk7CiAKIAlpbnRlbF9jcnRjLT5hY3RpdmUg
PSB0cnVlOwogCiAJLyogRGlzcGxheSBXQSAjMTE4MDogV2FEaXNhYmxlU2NhbGFyQ2xvY2tHYXRp
bmc6IGdsaywgY25sICovCi0JcHNsX2Nsa2dhdGVfd2EgPSAoSVNfR0VNSU5JTEFLRShkZXZfcHJp
dikgfHwgSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpICYmCisJcHNsX2Nsa2dhdGVfd2EgPSAoSVNf
R0VNSU5JTEFLRShpOTE1KSB8fCBJU19DQU5OT05MQUtFKGk5MTUpKSAmJgogCQkJIHBpcGVfY29u
ZmlnLT5wY2hfcGZpdC5lbmFibGVkOwogCWlmIChwc2xfY2xrZ2F0ZV93YSkKLQkJZ2xrX3BpcGVf
c2NhbGVyX2Nsb2NrX2dhdGluZ193YShkZXZfcHJpdiwgcGlwZSwgdHJ1ZSk7CisJCWdsa19waXBl
X3NjYWxlcl9jbG9ja19nYXRpbmdfd2EoaTkxNSwgcGlwZSwgdHJ1ZSk7CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA5KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJc2t5bGFr
ZV9wZml0X2VuYWJsZShwaXBlX2NvbmZpZyk7CiAJZWxzZQogCQlpcm9ubGFrZV9wZml0X2VuYWJs
ZShwaXBlX2NvbmZpZyk7CkBAIC02MzgyLDIwICs2MzgyLDIwIEBAIHN0YXRpYyB2b2lkIGhhc3dl
bGxfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCWlu
dGVsX2NvbG9yX2xvYWRfbHV0cyhwaXBlX2NvbmZpZyk7CiAJaW50ZWxfY29sb3JfY29tbWl0KHBp
cGVfY29uZmlnKTsKIAkvKiB1cGRhdGUgRFNQQ05UUiB0byBjb25maWd1cmUgZ2FtbWEvY3NjIGZv
ciBwaXBlIGJvdHRvbSBjb2xvciAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSkKKwlp
ZiAoSU5URUxfR0VOKGk5MTUpIDwgOSkKIAkJaW50ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKHBp
cGVfY29uZmlnKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlmIChJTlRF
TF9HRU4oaTkxNSkgPj0gMTEpCiAJCWljbF9zZXRfcGlwZV9jaGlja2VuKGludGVsX2NydGMpOwog
CiAJaW50ZWxfZGRpX3NldF9waXBlX3NldHRpbmdzKHBpcGVfY29uZmlnKTsKIAlpZiAoIXRyYW5z
Y29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkKIAkJaW50ZWxfZGRpX2VuYWJsZV90cmFuc2Nv
ZGVyX2Z1bmMocGlwZV9jb25maWcpOwogCi0JaWYgKGRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxf
d2F0ZXJtYXJrcyAhPSBOVUxMKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFy
a3Mob2xkX2ludGVsX3N0YXRlLCBwaXBlX2NvbmZpZyk7CisJaWYgKGk5MTUtPmRpc3BsYXkuaW5p
dGlhbF93YXRlcm1hcmtzICE9IE5VTEwpCisJCWk5MTUtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1h
cmtzKG9sZF9pbnRlbF9zdGF0ZSwgcGlwZV9jb25maWcpOwogCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJaWNsX3BpcGVfbWJ1
c19lbmFibGUoaW50ZWxfY3J0Yyk7CiAKIAkvKiBYWFg6IERvIHRoZSBwaXBlIGFzc2VydGlvbnMg
YXQgdGhlIHJpZ2h0IHBsYWNlIGZvciBCWFQgRFNJLiAqLwpAQCAtNjQxNCwyMyArNjQxNCwyMyBA
QCBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZywKIAlpbnRlbF9lbmNvZGVyc19lbmFibGUoY3J0YywgcGlwZV9jb25maWcs
IG9sZF9zdGF0ZSk7CiAKIAlpZiAocHNsX2Nsa2dhdGVfd2EpIHsKLQkJaW50ZWxfd2FpdF9mb3Jf
dmJsYW5rKGRldl9wcml2LCBwaXBlKTsKLQkJZ2xrX3BpcGVfc2NhbGVyX2Nsb2NrX2dhdGluZ193
YShkZXZfcHJpdiwgcGlwZSwgZmFsc2UpOworCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoaTkxNSwg
cGlwZSk7CisJCWdsa19waXBlX3NjYWxlcl9jbG9ja19nYXRpbmdfd2EoaTkxNSwgcGlwZSwgZmFs
c2UpOwogCX0KIAogCS8qIElmIHdlIGNoYW5nZSB0aGUgcmVsYXRpdmUgb3JkZXIgYmV0d2VlbiBw
aXBlL3BsYW5lcyBlbmFibGluZywgd2UgbmVlZAogCSAqIHRvIGNoYW5nZSB0aGUgd29ya2Fyb3Vu
ZC4gKi8KIAloc3dfd29ya2Fyb3VuZF9waXBlID0gcGlwZV9jb25maWctPmhzd193b3JrYXJvdW5k
X3BpcGU7Ci0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmIGhzd193b3JrYXJvdW5kX3BpcGUg
IT0gSU5WQUxJRF9QSVBFKSB7Ci0JCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgaHN3
X3dvcmthcm91bmRfcGlwZSk7Ci0JCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgaHN3
X3dvcmthcm91bmRfcGlwZSk7CisJaWYgKElTX0hBU1dFTEwoaTkxNSkgJiYgaHN3X3dvcmthcm91
bmRfcGlwZSAhPSBJTlZBTElEX1BJUEUpIHsKKwkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGk5MTUs
IGhzd193b3JrYXJvdW5kX3BpcGUpOworCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoaTkxNSwgaHN3
X3dvcmthcm91bmRfcGlwZSk7CiAJfQogfQogCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9wZml0X2Rp
c2FibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogewog
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCS8q
IFRvIGF2b2lkIHVwc2V0dGluZyB0aGUgcG93ZXIgd2VsbCBvbiBoYXN3ZWxsIG9ubHkgZGlzYWJs
ZSB0aGUgcGZpdCBpZgpAQCAtNjQ0Nyw3ICs2NDQ3LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2Vf
Y3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIHsK
IAlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjOwogCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjKTsKIAlpbnQgcGlwZSA9IGludGVsX2NydGMtPnBpcGU7CiAKQEAgLTY0
NTYsOCArNjQ1Niw4IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZGlzYWJsZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJICogcGlwZSBpcyBhbHJlYWR5IGRp
c2FibGVkLCBidXQgRkRJIFJYL1RYIGlzIHN0aWxsIGVuYWJsZWQuCiAJICogSGFwcGVucyBhdCBs
ZWFzdCB3aXRoIFZHQStIRE1JIGNsb25pbmcuIFN1cHByZXNzIHRoZW0uCiAJICovCi0JaW50ZWxf
c2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgcGlwZSwgZmFsc2UpOwot
CWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBpcGUsIGZh
bHNlKTsKKwlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsIHBpcGUs
IGZhbHNlKTsKKwlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsIHBp
cGUsIGZhbHNlKTsKIAogCWludGVsX2VuY29kZXJzX2Rpc2FibGUoY3J0Yywgb2xkX2NydGNfc3Rh
dGUsIG9sZF9zdGF0ZSk7CiAKQEAgLTY0NzQsOSArNjQ3NCw5IEBAIHN0YXRpYyB2b2lkIGlyb25s
YWtlX2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUs
CiAJaW50ZWxfZW5jb2RlcnNfcG9zdF9kaXNhYmxlKGNydGMsIG9sZF9jcnRjX3N0YXRlLCBvbGRf
c3RhdGUpOwogCiAJaWYgKG9sZF9jcnRjX3N0YXRlLT5oYXNfcGNoX2VuY29kZXIpIHsKLQkJaXJv
bmxha2VfZGlzYWJsZV9wY2hfdHJhbnNjb2RlcihkZXZfcHJpdiwgcGlwZSk7CisJCWlyb25sYWtl
X2Rpc2FibGVfcGNoX3RyYW5zY29kZXIoaTkxNSwgcGlwZSk7CiAKLQkJaWYgKEhBU19QQ0hfQ1BU
KGRldl9wcml2KSkgeworCQlpZiAoSEFTX1BDSF9DUFQoaTkxNSkpIHsKIAkJCWk5MTVfcmVnX3Qg
cmVnOwogCQkJdTMyIHRlbXA7CiAKQEAgLTY0OTcsMTUgKzY0OTcsMTUgQEAgc3RhdGljIHZvaWQg
aXJvbmxha2VfY3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19z
dGF0ZSwKIAkJaXJvbmxha2VfZmRpX3BsbF9kaXNhYmxlKGludGVsX2NydGMpOwogCX0KIAotCWlu
dGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBpcGUsIHRydWUp
OwotCWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBpcGUs
IHRydWUpOworCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgcGlw
ZSwgdHJ1ZSk7CisJaW50ZWxfc2V0X3BjaF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBw
aXBlLCB0cnVlKTsKIH0KIAogc3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2Rpc2FibGUoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCQkJCSBzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqb2xkX3N0YXRlKQogewogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IG9sZF9jcnRj
X3N0YXRlLT5iYXNlLmNydGM7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShjcnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjKTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBvbGRfY3J0
Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAKQEAgLTY1MjYsNyArNjUyNiw3IEBAIHN0YXRpYyB2
b2lkIGhhc3dlbGxfY3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0
Y19zdGF0ZSwKIAogCWludGVsX2RzY19kaXNhYmxlKG9sZF9jcnRjX3N0YXRlKTsKIAotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQlz
a3lsYWtlX3NjYWxlcl9kaXNhYmxlKGludGVsX2NydGMpOwogCWVsc2UKIAkJaXJvbmxha2VfcGZp
dF9kaXNhYmxlKG9sZF9jcnRjX3N0YXRlKTsKQEAgLTY1MzksNyArNjUzOSw3IEBAIHN0YXRpYyB2
b2lkIGhhc3dlbGxfY3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0
Y19zdGF0ZSwKIHN0YXRpYyB2b2lkIGk5eHhfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAogCWlmICghY3J0
Y19zdGF0ZS0+Z21jaF9wZml0LmNvbnRyb2wpCiAJCXJldHVybjsKQEAgLTY1NDksNyArNjU0OSw3
IEBAIHN0YXRpYyB2b2lkIGk5eHhfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiAJICogYWNjb3JkaW5nIHRvIHJlZ2lzdGVyIGRlc2NyaXB0aW9u
IGFuZCBQUk0uCiAJICovCiAJV0FSTl9PTihJOTE1X1JFQUQoUEZJVF9DT05UUk9MKSAmIFBGSVRf
RU5BQkxFKTsKLQlhc3NlcnRfcGlwZV9kaXNhYmxlZChkZXZfcHJpdiwgY3J0Yy0+cGlwZSk7CisJ
YXNzZXJ0X3BpcGVfZGlzYWJsZWQoaTkxNSwgY3J0Yy0+cGlwZSk7CiAKIAlJOTE1X1dSSVRFKFBG
SVRfUEdNX1JBVElPUywgY3J0Y19zdGF0ZS0+Z21jaF9wZml0LnBnbV9yYXRpb3MpOwogCUk5MTVf
V1JJVEUoUEZJVF9DT05UUk9MLCBjcnRjX3N0YXRlLT5nbWNoX3BmaXQuY29udHJvbCk7CkBAIC02
NTU5LDMxICs2NTU5LDMxIEBAIHN0YXRpYyB2b2lkIGk5eHhfcGZpdF9lbmFibGUoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJSTkxNV9XUklURShCQ0xSUEFUKGNy
dGMtPnBpcGUpLCAwKTsKIH0KIAotYm9vbCBpbnRlbF9wb3J0X2lzX2NvbWJvcGh5KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCitib29sIGludGVsX3Bv
cnRfaXNfY29tYm9waHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9ydCBw
b3J0KQogewogCWlmIChwb3J0ID09IFBPUlRfTk9ORSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYg
KElTX0VMS0hBUlRMQUtFKGRldl9wcml2KSkKKwlpZiAoSVNfRUxLSEFSVExBS0UoaTkxNSkpCiAJ
CXJldHVybiBwb3J0IDw9IFBPUlRfQzsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEx
KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCXJldHVybiBwb3J0IDw9IFBPUlRfQjsK
IAogCXJldHVybiBmYWxzZTsKIH0KIAotYm9vbCBpbnRlbF9wb3J0X2lzX3RjKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCitib29sIGludGVsX3BvcnRf
aXNfdGMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9ydCBwb3J0KQogewot
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmICFJU19FTEtIQVJUTEFLRShkZXZfcHJp
dikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSAmJiAhSVNfRUxLSEFSVExBS0UoaTkxNSkp
CiAJCXJldHVybiBwb3J0ID49IFBPUlRfQyAmJiBwb3J0IDw9IFBPUlRfRjsKIAogCXJldHVybiBm
YWxzZTsKIH0KIAotZW51bSB0Y19wb3J0IGludGVsX3BvcnRfdG9fdGMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKK2VudW0gdGNfcG9ydCBpbnRlbF9w
b3J0X3RvX3RjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9ydCkK
IHsKLQlpZiAoIWludGVsX3BvcnRfaXNfdGMoZGV2X3ByaXYsIHBvcnQpKQorCWlmICghaW50ZWxf
cG9ydF9pc190YyhpOTE1LCBwb3J0KSkKIAkJcmV0dXJuIFBPUlRfVENfTk9ORTsKIAogCXJldHVy
biBwb3J0IC0gUE9SVF9DOwpAQCAtNjYzNiw3ICs2NjM2LDcgQEAgc3RhdGljIHU2NCBnZXRfY3J0
Y19wb3dlcl9kb21haW5zKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCQkgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
cnRjLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShk
ZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0
cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcjsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUgPSBpbnRlbF9jcnRjLT5w
aXBlOwpAQCAtNjY1OCw3ICs2NjU4LDcgQEAgc3RhdGljIHU2NCBnZXRfY3J0Y19wb3dlcl9kb21h
aW5zKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJbWFzayB8PSBCSVRfVUxMKGludGVsX2VuY29k
ZXItPnBvd2VyX2RvbWFpbik7CiAJfQogCi0JaWYgKEhBU19EREkoZGV2X3ByaXYpICYmIGNydGNf
c3RhdGUtPmhhc19hdWRpbykKKwlpZiAoSEFTX0RESShpOTE1KSAmJiBjcnRjX3N0YXRlLT5oYXNf
YXVkaW8pCiAJCW1hc2sgfD0gQklUX1VMTChQT1dFUl9ET01BSU5fQVVESU8pOwogCiAJaWYgKGNy
dGNfc3RhdGUtPnNoYXJlZF9kcGxsKQpAQCAtNjY3MSw3ICs2NjcxLDcgQEAgc3RhdGljIHU2NAog
bW9kZXNldF9nZXRfY3J0Y19wb3dlcl9kb21haW5zKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJ
CSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwogCWVudW0gaW50ZWxf
ZGlzcGxheV9wb3dlcl9kb21haW4gZG9tYWluOwogCXU2NCBkb21haW5zLCBuZXdfZG9tYWlucywg
b2xkX2RvbWFpbnM7CkBAIC02NjgzLDE4ICs2NjgzLDE4IEBAIG1vZGVzZXRfZ2V0X2NydGNfcG93
ZXJfZG9tYWlucyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJZG9tYWlucyA9IG5ld19kb21haW5z
ICYgfm9sZF9kb21haW5zOwogCiAJZm9yX2VhY2hfcG93ZXJfZG9tYWluKGRvbWFpbiwgZG9tYWlu
cykKLQkJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsIGRvbWFpbik7CisJCWludGVs
X2Rpc3BsYXlfcG93ZXJfZ2V0KGk5MTUsIGRvbWFpbik7CiAKIAlyZXR1cm4gb2xkX2RvbWFpbnMg
JiB+bmV3X2RvbWFpbnM7CiB9CiAKLXN0YXRpYyB2b2lkIG1vZGVzZXRfcHV0X3Bvd2VyX2RvbWFp
bnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgbW9kZXNl
dF9wdXRfcG93ZXJfZG9tYWlucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICAgICB1NjQgZG9tYWlucykKIHsKIAllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIGRv
bWFpbjsKIAogCWZvcl9lYWNoX3Bvd2VyX2RvbWFpbihkb21haW4sIGRvbWFpbnMpCi0JCWludGVs
X2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tlZChkZXZfcHJpdiwgZG9tYWluKTsKKwkJaW50ZWxf
ZGlzcGxheV9wb3dlcl9wdXRfdW5jaGVja2VkKGk5MTUsIGRvbWFpbik7CiB9CiAKIHN0YXRpYyB2
b2lkIHZhbGxleXZpZXdfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnLApAQCAtNjcwNCw3ICs2NzA0LDcgQEAgc3RhdGljIHZvaWQgdmFsbGV5dmlld19jcnRj
X2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCXRvX2ludGVs
X2F0b21pY19zdGF0ZShvbGRfc3RhdGUpOwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVf
Y29uZmlnLT5iYXNlLmNydGM7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVs
X2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwogCWludCBwaXBlID0gaW50
ZWxfY3J0Yy0+cGlwZTsKIApAQCAtNjcxNyw3ICs2NzE3LDcgQEAgc3RhdGljIHZvaWQgdmFsbGV5
dmlld19jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJ
aW50ZWxfc2V0X3BpcGVfdGltaW5ncyhwaXBlX2NvbmZpZyk7CiAJaW50ZWxfc2V0X3BpcGVfc3Jj
X3NpemUocGlwZV9jb25maWcpOwogCi0JaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpICYmIHBp
cGUgPT0gUElQRV9CKSB7CisJaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkgJiYgcGlwZSA9PSBQSVBF
X0IpIHsKIAkJSTkxNV9XUklURShDSFZfQkxFTkQocGlwZSksIENIVl9CTEVORF9MRUdBQ1kpOwog
CQlJOTE1X1dSSVRFKENIVl9DQU5WQVMocGlwZSksIDApOwogCX0KQEAgLTY3MjYsMTEgKzY3MjYs
MTEgQEAgc3RhdGljIHZvaWQgdmFsbGV5dmlld19jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAKIAlpbnRlbF9jcnRjLT5hY3RpdmUgPSB0cnVlOwogCi0J
aW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgcGlwZSwgdHJ1
ZSk7CisJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBwaXBlLCB0
cnVlKTsKIAogCWludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5hYmxlKGNydGMsIHBpcGVfY29uZmln
LCBvbGRfc3RhdGUpOwogCi0JaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJaWYgKElT
X0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJY2h2X3ByZXBhcmVfcGxsKGludGVsX2NydGMsIHBpcGVf
Y29uZmlnKTsKIAkJY2h2X2VuYWJsZV9wbGwoaW50ZWxfY3J0YywgcGlwZV9jb25maWcpOwogCX0g
ZWxzZSB7CkBAIC02NzQ3LDcgKzY3NDcsNyBAQCBzdGF0aWMgdm9pZCB2YWxsZXl2aWV3X2NydGNf
ZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkvKiB1cGRhdGUg
RFNQQ05UUiB0byBjb25maWd1cmUgZ2FtbWEgZm9yIHBpcGUgYm90dG9tIGNvbG9yICovCiAJaW50
ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKHBpcGVfY29uZmlnKTsKIAotCWRldl9wcml2LT5kaXNw
bGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhvbGRfaW50ZWxfc3RhdGUsCisJaTkxNS0+ZGlzcGxheS5p
bml0aWFsX3dhdGVybWFya3Mob2xkX2ludGVsX3N0YXRlLAogCQkJCQkgICAgIHBpcGVfY29uZmln
KTsKIAlpbnRlbF9lbmFibGVfcGlwZShwaXBlX2NvbmZpZyk7CiAKQEAgLTY3NjAsNyArNjc2MCw3
IEBAIHN0YXRpYyB2b2lkIHZhbGxleXZpZXdfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKnBpcGVfY29uZmlnLAogc3RhdGljIHZvaWQgaTl4eF9zZXRfcGxsX2RpdmlkZXJzKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CiAKIAlJOTE1X1dSSVRFKEZQMChjcnRjLT5waXBlKSwgY3J0Y19zdGF0ZS0+ZHBsbF9od19z
dGF0ZS5mcDApOwogCUk5MTVfV1JJVEUoRlAxKGNydGMtPnBpcGUpLCBjcnRjX3N0YXRlLT5kcGxs
X2h3X3N0YXRlLmZwMSk7CkBAIC02NzczLDcgKzY3NzMsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2Ny
dGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJdG9faW50
ZWxfYXRvbWljX3N0YXRlKG9sZF9zdGF0ZSk7CiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlw
ZV9jb25maWctPmJhc2UuY3J0YzsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7CiAJZW51bSBwaXBlIHBp
cGUgPSBpbnRlbF9jcnRjLT5waXBlOwogCkBAIC02NzkyLDggKzY3OTIsOCBAQCBzdGF0aWMgdm9p
ZCBpOXh4X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywK
IAogCWludGVsX2NydGMtPmFjdGl2ZSA9IHRydWU7CiAKLQlpZiAoIUlTX0dFTihkZXZfcHJpdiwg
MikpCi0JCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBp
cGUsIHRydWUpOworCWlmICghSVNfR0VOKGk5MTUsIDIpKQorCQlpbnRlbF9zZXRfY3B1X2ZpZm9f
dW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsIHBpcGUsIHRydWUpOwogCiAJaW50ZWxfZW5jb2RlcnNf
cHJlX2VuYWJsZShjcnRjLCBwaXBlX2NvbmZpZywgb2xkX3N0YXRlKTsKIApAQCAtNjgwNiw4ICs2
ODA2LDggQEAgc3RhdGljIHZvaWQgaTl4eF9jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcsCiAJLyogdXBkYXRlIERTUENOVFIgdG8gY29uZmlndXJlIGdhbW1h
IGZvciBwaXBlIGJvdHRvbSBjb2xvciAqLwogCWludGVsX2Rpc2FibGVfcHJpbWFyeV9wbGFuZShw
aXBlX2NvbmZpZyk7CiAKLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtz
ICE9IE5VTEwpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhvbGRfaW50
ZWxfc3RhdGUsCisJaWYgKGk5MTUtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzICE9IE5VTEwp
CisJCWk5MTUtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKG9sZF9pbnRlbF9zdGF0ZSwKIAkJ
CQkJCSAgICAgcGlwZV9jb25maWcpOwogCWVsc2UKIAkJaW50ZWxfdXBkYXRlX3dhdGVybWFya3Mo
aW50ZWxfY3J0Yyk7CkBAIC02ODIyLDEyICs2ODIyLDEyIEBAIHN0YXRpYyB2b2lkIGk5eHhfY3J0
Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogc3RhdGljIHZv
aWQgaTl4eF9wZml0X2Rpc2FibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhv
bGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJaWYgKCFvbGRfY3J0Y19zdGF0
ZS0+Z21jaF9wZml0LmNvbnRyb2wpCiAJCXJldHVybjsKIAotCWFzc2VydF9waXBlX2Rpc2FibGVk
KGRldl9wcml2LCBjcnRjLT5waXBlKTsKKwlhc3NlcnRfcGlwZV9kaXNhYmxlZChpOTE1LCBjcnRj
LT5waXBlKTsKIAogCURSTV9ERUJVR19LTVMoImRpc2FibGluZyBwZml0LCBjdXJyZW50OiAweCUw
OHhcbiIsCiAJCSAgICAgIEk5MTVfUkVBRChQRklUX0NPTlRST0wpKTsKQEAgLTY4MzksNyArNjgz
OSw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfY3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpvbGRfY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKIAlpbnQgcGlwZSA9IGlu
dGVsX2NydGMtPnBpcGU7CiAKQEAgLTY4NDcsOCArNjg0Nyw4IEBAIHN0YXRpYyB2b2lkIGk5eHhf
Y3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkg
KiBPbiBnZW4yIHBsYW5lcyBhcmUgZG91YmxlIGJ1ZmZlcmVkIGJ1dCB0aGUgcGlwZSBpc24ndCwg
c28gd2UgbXVzdAogCSAqIHdhaXQgZm9yIHBsYW5lcyB0byBmdWxseSB0dXJuIG9mZiBiZWZvcmUg
ZGlzYWJsaW5nIHRoZSBwaXBlLgogCSAqLwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpKQotCQlp
bnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIHBpcGUpOworCWlmIChJU19HRU4oaTkxNSwg
MikpCisJCWludGVsX3dhaXRfZm9yX3ZibGFuayhpOTE1LCBwaXBlKTsKIAogCWludGVsX2VuY29k
ZXJzX2Rpc2FibGUoY3J0Yywgb2xkX2NydGNfc3RhdGUsIG9sZF9zdGF0ZSk7CiAKQEAgLTY4NjIs
MjUgKzY4NjIsMjUgQEAgc3RhdGljIHZvaWQgaTl4eF9jcnRjX2Rpc2FibGUoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCWludGVsX2VuY29kZXJzX3Bvc3RfZGlzYWJs
ZShjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgb2xkX3N0YXRlKTsKIAogCWlmICghaW50ZWxfY3J0Y19o
YXNfdHlwZShvbGRfY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RTSSkpIHsKLQkJaWYgKElTX0NI
RVJSWVZJRVcoZGV2X3ByaXYpKQotCQkJY2h2X2Rpc2FibGVfcGxsKGRldl9wcml2LCBwaXBlKTsK
LQkJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCi0JCQl2bHZfZGlzYWJsZV9wbGwo
ZGV2X3ByaXYsIHBpcGUpOworCQlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKKwkJCWNodl9kaXNh
YmxlX3BsbChpOTE1LCBwaXBlKTsKKwkJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkKKwkJ
CXZsdl9kaXNhYmxlX3BsbChpOTE1LCBwaXBlKTsKIAkJZWxzZQogCQkJaTl4eF9kaXNhYmxlX3Bs
bChvbGRfY3J0Y19zdGF0ZSk7CiAJfQogCiAJaW50ZWxfZW5jb2RlcnNfcG9zdF9wbGxfZGlzYWJs
ZShjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgb2xkX3N0YXRlKTsKIAotCWlmICghSVNfR0VOKGRldl9w
cml2LCAyKSkKLQkJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJp
diwgcGlwZSwgZmFsc2UpOworCWlmICghSVNfR0VOKGk5MTUsIDIpKQorCQlpbnRlbF9zZXRfY3B1
X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsIHBpcGUsIGZhbHNlKTsKIAotCWlmICghZGV2
X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKQorCWlmICghaTkxNS0+ZGlzcGxheS5p
bml0aWFsX3dhdGVybWFya3MpCiAJCWludGVsX3VwZGF0ZV93YXRlcm1hcmtzKGludGVsX2NydGMp
OwogCiAJLyogY2xvY2sgdGhlIHBpcGUgZG93biB0byA2NDB4NDgwQDYwIHRvIHBvdGVudGlhbGx5
IHNhdmUgcG93ZXIgKi8KLQlpZiAoSVNfSTgzMChkZXZfcHJpdikpCi0JCWk4MzBfZW5hYmxlX3Bp
cGUoZGV2X3ByaXYsIHBpcGUpOworCWlmIChJU19JODMwKGk5MTUpKQorCQlpODMwX2VuYWJsZV9w
aXBlKGk5MTUsIHBpcGUpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2Rpc2FibGVfbm9h
dG9taWMoc3RydWN0IGRybV9jcnRjICpjcnRjLApAQCAtNjg4OCw5ICs2ODg4LDkgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfY3J0Y19kaXNhYmxlX25vYXRvbWljKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
IHsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAq
Yndfc3RhdGUgPQotCQl0b19pbnRlbF9id19zdGF0ZShkZXZfcHJpdi0+Yndfb2JqLnN0YXRlKTsK
KwkJdG9faW50ZWxfYndfc3RhdGUoaTkxNS0+Yndfb2JqLnN0YXRlKTsKIAllbnVtIGludGVsX2Rp
c3BsYXlfcG93ZXJfZG9tYWluIGRvbWFpbjsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwog
CXU2NCBkb21haW5zOwpAQCAtNjkwMSw3ICs2OTAxLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0
Y19kaXNhYmxlX25vYXRvbWljKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAlpZiAoIWludGVsX2Ny
dGMtPmFjdGl2ZSkKIAkJcmV0dXJuOwogCi0JZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0Yygm
ZGV2X3ByaXYtPmRybSwgaW50ZWxfY3J0YywgcGxhbmUpIHsKKwlmb3JfZWFjaF9pbnRlbF9wbGFu
ZV9vbl9jcnRjKCZpOTE1LT5kcm0sIGludGVsX2NydGMsIHBsYW5lKSB7CiAJCWNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQogCQkJdG9faW50ZWxfcGxhbmVfc3Rh
dGUocGxhbmUtPmJhc2Uuc3RhdGUpOwogCkBAIC02OTI0LDcgKzY5MjQsNyBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9jcnRjX2Rpc2FibGVfbm9hdG9taWMoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCiAJ
V0FSTl9PTihJU19FUlIoY3J0Y19zdGF0ZSkgfHwgcmV0KTsKIAotCWRldl9wcml2LT5kaXNwbGF5
LmNydGNfZGlzYWJsZShjcnRjX3N0YXRlLCBzdGF0ZSk7CisJaTkxNS0+ZGlzcGxheS5jcnRjX2Rp
c2FibGUoY3J0Y19zdGF0ZSwgc3RhdGUpOwogCiAJZHJtX2F0b21pY19zdGF0ZV9wdXQoc3RhdGUp
OwogCkBAIC02OTQ3LDEyICs2OTQ3LDEyIEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfZGlzYWJs
ZV9ub2F0b21pYyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAKIAlkb21haW5zID0gaW50ZWxfY3J0
Yy0+ZW5hYmxlZF9wb3dlcl9kb21haW5zOwogCWZvcl9lYWNoX3Bvd2VyX2RvbWFpbihkb21haW4s
IGRvbWFpbnMpCi0JCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tlZChkZXZfcHJpdiwg
ZG9tYWluKTsKKwkJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfdW5jaGVja2VkKGk5MTUsIGRvbWFp
bik7CiAJaW50ZWxfY3J0Yy0+ZW5hYmxlZF9wb3dlcl9kb21haW5zID0gMDsKIAotCWRldl9wcml2
LT5hY3RpdmVfY3J0Y3MgJj0gfigxIDw8IGludGVsX2NydGMtPnBpcGUpOwotCWRldl9wcml2LT5t
aW5fY2RjbGtbaW50ZWxfY3J0Yy0+cGlwZV0gPSAwOwotCWRldl9wcml2LT5taW5fdm9sdGFnZV9s
ZXZlbFtpbnRlbF9jcnRjLT5waXBlXSA9IDA7CisJaTkxNS0+YWN0aXZlX2NydGNzICY9IH4oMSA8
PCBpbnRlbF9jcnRjLT5waXBlKTsKKwlpOTE1LT5taW5fY2RjbGtbaW50ZWxfY3J0Yy0+cGlwZV0g
PSAwOworCWk5MTUtPm1pbl92b2x0YWdlX2xldmVsW2ludGVsX2NydGMtPnBpcGVdID0gMDsKIAog
CWJ3X3N0YXRlLT5kYXRhX3JhdGVbaW50ZWxfY3J0Yy0+cGlwZV0gPSAwOwogCWJ3X3N0YXRlLT5u
dW1fYWN0aXZlX3BsYW5lc1tpbnRlbF9jcnRjLT5waXBlXSA9IDA7CkBAIC02OTY0LDcgKzY5NjQs
NyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2Rpc2FibGVfbm9hdG9taWMoc3RydWN0IGRybV9j
cnRjICpjcnRjLAogICovCiBpbnQgaW50ZWxfZGlzcGxheV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwog
CXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZTsKIAlpbnQgcmV0OwogCkBAIC02OTczLDcg
KzY5NzMsNyBAQCBpbnQgaW50ZWxfZGlzcGxheV9zdXNwZW5kKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpCiAJaWYgKHJldCkKIAkJRFJNX0VSUk9SKCJTdXNwZW5kaW5nIGNydGMncyBmYWlsZWQgd2l0
aCAlaVxuIiwgcmV0KTsKIAllbHNlCi0JCWRldl9wcml2LT5tb2Rlc2V0X3Jlc3RvcmVfc3RhdGUg
PSBzdGF0ZTsKKwkJaTkxNS0+bW9kZXNldF9yZXN0b3JlX3N0YXRlID0gc3RhdGU7CiAJcmV0dXJu
IHJldDsKIH0KIApAQCAtNzAzNSw3ICs3MDM1LDcgQEAgc3RhdGljIGludCBwaXBlX3JlcXVpcmVk
X2ZkaV9sYW5lcyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyBp
bnQgaXJvbmxha2VfY2hlY2tfZmRpX2xhbmVzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGVudW0g
cGlwZSBwaXBlLAogCQkJCSAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmln
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBwaXBlX2NvbmZpZy0+YmFzZS5zdGF0ZTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqb3RoZXJfY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb3Ro
ZXJfY3J0Y19zdGF0ZTsKQEAgLTcwNDgsNyArNzA0OCw3IEBAIHN0YXRpYyBpbnQgaXJvbmxha2Vf
Y2hlY2tfZmRpX2xhbmVzKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIGVudW0gcGlwZSBwaXBlLAog
CQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNf
QlJPQURXRUxMKGRldl9wcml2KSkgeworCWlmIChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FE
V0VMTChpOTE1KSkgewogCQlpZiAocGlwZV9jb25maWctPmZkaV9sYW5lcyA+IDIpIHsKIAkJCURS
TV9ERUJVR19LTVMoIm9ubHkgMiBsYW5lcyBvbiBoYXN3ZWxsLCByZXF1aXJlZDogJWkgbGFuZXNc
biIsCiAJCQkJICAgICAgcGlwZV9jb25maWctPmZkaV9sYW5lcyk7CkBAIC03MDU4LDcgKzcwNTgs
NyBAQCBzdGF0aWMgaW50IGlyb25sYWtlX2NoZWNrX2ZkaV9sYW5lcyhzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCBlbnVtIHBpcGUgcGlwZSwKIAkJfQogCX0KIAotCWlmIChJTlRFTF9JTkZPKGRldl9w
cml2KS0+bnVtX3BpcGVzID09IDIpCisJaWYgKElOVEVMX0lORk8oaTkxNSktPm51bV9waXBlcyA9
PSAyKQogCQlyZXR1cm4gMDsKIAogCS8qIEl2eWJyaWRnZSAzIHBpcGUgaXMgcmVhbGx5IGNvbXBs
aWNhdGVkICovCkBAIC03MDY5LDcgKzcwNjksNyBAQCBzdGF0aWMgaW50IGlyb25sYWtlX2NoZWNr
X2ZkaV9sYW5lcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBlbnVtIHBpcGUgcGlwZSwKIAkJaWYg
KHBpcGVfY29uZmlnLT5mZGlfbGFuZXMgPD0gMikKIAkJCXJldHVybiAwOwogCi0JCW90aGVyX2Ny
dGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgUElQRV9DKTsKKwkJb3RoZXJf
Y3J0YyA9IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIFBJUEVfQyk7CiAJCW90aGVyX2Ny
dGNfc3RhdGUgPQogCQkJaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKHN0YXRlLCBvdGhlcl9j
cnRjKTsKIAkJaWYgKElTX0VSUihvdGhlcl9jcnRjX3N0YXRlKSkKQEAgLTcwODgsNyArNzA4OCw3
IEBAIHN0YXRpYyBpbnQgaXJvbmxha2VfY2hlY2tfZmRpX2xhbmVzKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIGVudW0gcGlwZSBwaXBlLAogCQkJcmV0dXJuIC1FSU5WQUw7CiAJCX0KIAotCQlvdGhl
cl9jcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIFBJUEVfQik7CisJCW90
aGVyX2NydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShpOTE1LCBQSVBFX0IpOwogCQlvdGhl
cl9jcnRjX3N0YXRlID0KIAkJCWludGVsX2F0b21pY19nZXRfY3J0Y19zdGF0ZShzdGF0ZSwgb3Ro
ZXJfY3J0Yyk7CiAJCWlmIChJU19FUlIob3RoZXJfY3J0Y19zdGF0ZSkpCkBAIC03MTU2LDcgKzcx
NTYsNyBAQCBzdGF0aWMgaW50IGlyb25sYWtlX2ZkaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YywKIGJvb2wgaHN3X2NydGNfc3RhdGVfaXBzX2NhcGFibGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAogCS8qIElQUyBvbmx5IGV4aXN0cyBvbiBVTFQgbWFjaGluZXMgYW5kIGlzIHRpZWQgdG8g
cGlwZSBBLiAqLwogCWlmICghaHN3X2NydGNfc3VwcG9ydHNfaXBzKGNydGMpKQpAQCAtNzE3NSw4
ICs3MTc1LDggQEAgYm9vbCBoc3dfY3J0Y19zdGF0ZV9pcHNfY2FwYWJsZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKgogCSAqIFNob3VsZCBtZWFzdXJlIHdo
ZXRoZXIgdXNpbmcgYSBsb3dlciBjZGNsayB3L28gSVBTCiAJICovCi0JaWYgKElTX0JST0FEV0VM
TChkZXZfcHJpdikgJiYKLQkgICAgY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSA+IGRldl9wcml2LT5t
YXhfY2RjbGtfZnJlcSAqIDk1IC8gMTAwKQorCWlmIChJU19CUk9BRFdFTEwoaTkxNSkgJiYKKwkg
ICAgY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSA+IGk5MTUtPm1heF9jZGNsa19mcmVxICogOTUgLyAx
MDApCiAJCXJldHVybiBmYWxzZTsKIAogCXJldHVybiB0cnVlOwpAQCAtNzE4NCw3ICs3MTg0LDcg
QEAgYm9vbCBoc3dfY3J0Y19zdGF0ZV9pcHNfY2FwYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogc3RhdGljIGJvb2wgaHN3X2NvbXB1dGVfaXBzX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0K
IAkJdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CiAJc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPQogCQl0b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19z
dGF0ZS0+YmFzZS5zdGF0ZSk7CkBAIC03MjA2LDcgKzcyMDYsNyBAQCBzdGF0aWMgYm9vbCBoc3df
Y29tcHV0ZV9pcHNfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CQlyZXR1cm4gZmFsc2U7CiAKIAkvKiBwaXhlbCByYXRlIG11c3RuJ3QgZXhjZWVkIDk1JSBvZiBj
ZGNsayB3aXRoIElQUyBvbiBCRFcgKi8KLQlpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSAmJgor
CWlmIChJU19CUk9BRFdFTEwoaTkxNSkgJiYKIAkgICAgY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSA+
IGludGVsX3N0YXRlLT5jZGNsay5sb2dpY2FsLmNkY2xrICogOTUgLyAxMDApCiAJCXJldHVybiBm
YWxzZTsKIApAQCAtNzIxNSwxMSArNzIxNSwxMSBAQCBzdGF0aWMgYm9vbCBoc3dfY29tcHV0ZV9p
cHNfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMg
Ym9vbCBpbnRlbF9jcnRjX3N1cHBvcnRzX2RvdWJsZV93aWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjKQogewotCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAKIAkvKiBHREcgZG91YmxlIHdpZGUg
b24gZWl0aGVyIHBpcGUsIG90aGVyd2lzZSBwaXBlIEEgb25seSAqLwotCXJldHVybiBJTlRFTF9H
RU4oZGV2X3ByaXYpIDwgNCAmJgotCQkoY3J0Yy0+cGlwZSA9PSBQSVBFX0EgfHwgSVNfSTkxNUco
ZGV2X3ByaXYpKTsKKwlyZXR1cm4gSU5URUxfR0VOKGk5MTUpIDwgNCAmJgorCQkoY3J0Yy0+cGlw
ZSA9PSBQSVBFX0EgfHwgSVNfSTkxNUcoaTkxNSkpOwogfQogCiBzdGF0aWMgdTMyIGlsa19waXBl
X3BpeGVsX3JhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQpA
QCAtNzI1OSw5ICs3MjU5LDkgQEAgc3RhdGljIHUzMiBpbGtfcGlwZV9waXhlbF9yYXRlKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIAogc3RhdGljIHZvaWQgaW50
ZWxfY3J0Y19jb21wdXRlX3BpeGVsX3JhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAotCWlmIChIQVNfR01D
SChkZXZfcHJpdikpCisJaWYgKEhBU19HTUNIKGk5MTUpKQogCQkvKiBGSVhNRSBjYWxjdWxhdGUg
cHJvcGVyIHBpcGUgcGl4ZWwgcmF0ZSBmb3IgR01DSCBwZml0ICovCiAJCWNydGNfc3RhdGUtPnBp
eGVsX3JhdGUgPQogCQkJY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7
CkBAIC03MjczLDEyICs3MjczLDEyIEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfY29tcHV0ZV9w
aXhlbF9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIGlu
dCBpbnRlbF9jcnRjX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJ
CSAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25m
aWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKLQlpbnQgY2xvY2tfbGltaXQgPSBkZXZfcHJpdi0+bWF4
X2RvdGNsa19mcmVxOworCWludCBjbG9ja19saW1pdCA9IGk5MTUtPm1heF9kb3RjbGtfZnJlcTsK
IAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCkgewotCQljbG9ja19saW1pdCA9IGRldl9w
cml2LT5tYXhfY2RjbGtfZnJlcSAqIDkgLyAxMDsKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNCkg
eworCQljbG9ja19saW1pdCA9IGk5MTUtPm1heF9jZGNsa19mcmVxICogOSAvIDEwOwogCiAJCS8q
CiAJCSAqIEVuYWJsZSBkb3VibGUgd2lkZSBtb2RlIHdoZW4gdGhlIGRvdCBjbG9jawpAQCAtNzI4
Niw3ICs3Mjg2LDcgQEAgc3RhdGljIGludCBpbnRlbF9jcnRjX2NvbXB1dGVfY29uZmlnKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogCQkgKi8KIAkJaWYgKGludGVsX2NydGNfc3VwcG9ydHNfZG91
YmxlX3dpZGUoY3J0YykgJiYKIAkJICAgIGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2sgPiBjbG9j
a19saW1pdCkgewotCQkJY2xvY2tfbGltaXQgPSBkZXZfcHJpdi0+bWF4X2RvdGNsa19mcmVxOwor
CQkJY2xvY2tfbGltaXQgPSBpOTE1LT5tYXhfZG90Y2xrX2ZyZXE7CiAJCQlwaXBlX2NvbmZpZy0+
ZG91YmxlX3dpZGUgPSB0cnVlOwogCQl9CiAJfQpAQCAtNzMyMyw3ICs3MzIzLDcgQEAgc3RhdGlj
IGludCBpbnRlbF9jcnRjX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CQl9CiAKIAkJaWYgKGludGVsX2NydGNfaGFzX3R5cGUocGlwZV9jb25maWcsIElOVEVMX09VVFBV
VF9MVkRTKSAmJgotCQkgICAgaW50ZWxfaXNfZHVhbF9saW5rX2x2ZHMoZGV2X3ByaXYpKSB7CisJ
CSAgICBpbnRlbF9pc19kdWFsX2xpbmtfbHZkcyhpOTE1KSkgewogCQkJRFJNX0RFQlVHX0tNUygi
T2RkIHBpcGUgc291cmNlIHdpZHRoIG5vdCBzdXBwb3J0ZWQgd2l0aCBkdWFsIGxpbmsgTFZEU1xu
Iik7CiAJCQlyZXR1cm4gLUVJTlZBTDsKIAkJfQpAQCAtNzMzMiw3ICs3MzMyLDcgQEAgc3RhdGlj
IGludCBpbnRlbF9jcnRjX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CS8qIENhbnRpZ2ErIGNhbm5vdCBoYW5kbGUgbW9kZXMgd2l0aCBhIGhzeW5jIGZyb250IHBvcmNo
IG9mIDAuCiAJICogV2FQcnVuZU1vZGVXaXRoSW5jb3JyZWN0SHN5bmNPZmZzZXQ6Y3RnLGVsayxp
bGssc25iLGl2Yix2bHYsaHN3LgogCSAqLwotCWlmICgoSU5URUxfR0VOKGRldl9wcml2KSA+IDQg
fHwgSVNfRzRYKGRldl9wcml2KSkgJiYKKwlpZiAoKElOVEVMX0dFTihpOTE1KSA+IDQgfHwgSVNf
RzRYKGk5MTUpKSAmJgogCQlhZGp1c3RlZF9tb2RlLT5jcnRjX2hzeW5jX3N0YXJ0ID09IGFkanVz
dGVkX21vZGUtPmNydGNfaGRpc3BsYXkpCiAJCXJldHVybiAtRUlOVkFMOwogCkBAIC03MzkyLDEy
ICs3MzkyLDEyIEBAIGludGVsX2xpbmtfY29tcHV0ZV9tX24odTE2IGJpdHNfcGVyX3BpeGVsLCBp
bnQgbmxhbmVzLAogCQkgICAgY29uc3RhbnRfbik7CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBp
bnRlbF9wYW5lbF91c2Vfc3NjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0
YXRpYyBpbmxpbmUgYm9vbCBpbnRlbF9wYW5lbF91c2Vfc3NjKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCWlmIChpOTE1X21vZHBhcmFtcy5wYW5lbF91c2Vfc3NjID49IDApCiAJ
CXJldHVybiBpOTE1X21vZHBhcmFtcy5wYW5lbF91c2Vfc3NjICE9IDA7Ci0JcmV0dXJuIGRldl9w
cml2LT52YnQubHZkc191c2Vfc3NjCi0JCSYmICEoZGV2X3ByaXYtPnF1aXJrcyAmIFFVSVJLX0xW
RFNfU1NDX0RJU0FCTEUpOworCXJldHVybiBpOTE1LT52YnQubHZkc191c2Vfc3NjCisJCSYmICEo
aTkxNS0+cXVpcmtzICYgUVVJUktfTFZEU19TU0NfRElTQUJMRSk7CiB9CiAKIHN0YXRpYyB1MzIg
cG52X2RwbGxfY29tcHV0ZV9mcChzdHJ1Y3QgZHBsbCAqZHBsbCkKQEAgLTc0MTQsMTAgKzc0MTQs
MTAgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfcGxsX2RpdmlkZXJzKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkJCSAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCQkJICAgICBzdHJ1Y3QgZHBsbCAqcmVkdWNlZF9jbG9jaykKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXUzMiBm
cCwgZnAyID0gMDsKIAotCWlmIChJU19QSU5FVklFVyhkZXZfcHJpdikpIHsKKwlpZiAoSVNfUElO
RVZJRVcoaTkxNSkpIHsKIAkJZnAgPSBwbnZfZHBsbF9jb21wdXRlX2ZwKCZjcnRjX3N0YXRlLT5k
cGxsKTsKIAkJaWYgKHJlZHVjZWRfY2xvY2spCiAJCQlmcDIgPSBwbnZfZHBsbF9jb21wdXRlX2Zw
KHJlZHVjZWRfY2xvY2spOwpAQCAtNzQzNyw3ICs3NDM3LDcgQEAgc3RhdGljIHZvaWQgaTl4eF91
cGRhdGVfcGxsX2RpdmlkZXJzKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCX0KIH0KIAotc3Rh
dGljIHZvaWQgdmx2X3BsbGJfcmVjYWxfb3BhbXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHBpcGUKK3N0YXRpYyB2b2lkIHZsdl9wbGxiX3JlY2FsX29wYW1wKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBpcGUKIAkJcGlwZSkKIHsKIAl1MzIgcmVn
X3ZhbDsKQEAgLTc0NDYsMzEgKzc0NDYsMzEgQEAgc3RhdGljIHZvaWQgdmx2X3BsbGJfcmVjYWxf
b3BhbXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUKIAkgKiBQ
TExCIG9wYW1wIGFsd2F5cyBjYWxpYnJhdGVzIHRvIG1heCB2YWx1ZSBvZiAweDNmLCBmb3JjZSBl
bmFibGUgaXQKIAkgKiBhbmQgc2V0IGl0IHRvIGEgcmVhc29uYWJsZSB2YWx1ZSBpbnN0ZWFkLgog
CSAqLwotCXJlZ192YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RX
OSgxKSk7CisJcmVnX3ZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgVkxWX1BMTF9EVzko
MSkpOwogCXJlZ192YWwgJj0gMHhmZmZmZmYwMDsKIAlyZWdfdmFsIHw9IDB4MDAwMDAwMzA7Ci0J
dmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc5KDEpLCByZWdfdmFsKTsK
Kwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUExMX0RXOSgxKSwgcmVnX3ZhbCk7CiAK
LQlyZWdfdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgVkxWX1JFRl9EVzEzKTsK
KwlyZWdfdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBWTFZfUkVGX0RXMTMpOwogCXJl
Z192YWwgJj0gMHgwMGZmZmZmZjsKIAlyZWdfdmFsIHw9IDB4OGMwMDAwMDA7Ci0Jdmx2X2RwaW9f
d3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9SRUZfRFcxMywgcmVnX3ZhbCk7CisJdmx2X2RwaW9f
d3JpdGUoaTkxNSwgcGlwZSwgVkxWX1JFRl9EVzEzLCByZWdfdmFsKTsKIAotCXJlZ192YWwgPSB2
bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXOSgxKSk7CisJcmVnX3ZhbCA9
IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgVkxWX1BMTF9EVzkoMSkpOwogCXJlZ192YWwgJj0g
MHhmZmZmZmYwMDsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzko
MSksIHJlZ192YWwpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QTExfRFc5KDEp
LCByZWdfdmFsKTsKIAotCXJlZ192YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBW
TFZfUkVGX0RXMTMpOworCXJlZ192YWwgPSB2bHZfZHBpb19yZWFkKGk5MTUsIHBpcGUsIFZMVl9S
RUZfRFcxMyk7CiAJcmVnX3ZhbCAmPSAweDAwZmZmZmZmOwogCXJlZ192YWwgfD0gMHhiMDAwMDAw
MDsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1JFRl9EVzEzLCByZWdfdmFs
KTsKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUkVGX0RXMTMsIHJlZ192YWwpOwog
fQogCiBzdGF0aWMgdm9pZCBpbnRlbF9wY2hfdHJhbnNjb2Rlcl9zZXRfbV9uKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCQkgY29uc3Qgc3RydWN0IGludGVs
X2xpbmtfbV9uICptX24pCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNy
dGMtPnBpcGU7CiAKIAlJOTE1X1dSSVRFKFBDSF9UUkFOU19EQVRBX00xKHBpcGUpLCBUVV9TSVpF
KG1fbi0+dHUpIHwgbV9uLT5nbWNoX20pOwpAQCAtNzQ3OSwxNyArNzQ3OSwxNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wY2hfdHJhbnNjb2Rlcl9zZXRfbV9uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YQogCUk5MTVfV1JJVEUoUENIX1RSQU5TX0xJTktfTjEocGlwZSksIG1f
bi0+bGlua19uKTsKIH0KIAotc3RhdGljIGJvb2wgdHJhbnNjb2Rlcl9oYXNfbTJfbjIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgdHJhbnNjb2Rlcl9oYXNf
bTJfbjIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJIGVudW0gdHJhbnNjb2Rl
ciB0cmFuc2NvZGVyKQogewotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSkKKwlpZiAoSVNfSEFT
V0VMTChpOTE1KSkKIAkJcmV0dXJuIHRyYW5zY29kZXIgPT0gVFJBTlNDT0RFUl9FRFA7CiAKIAkv
KgogCSAqIFN0cmljdGx5IHNwZWFraW5nIHNvbWUgcmVnaXN0ZXJzIGFyZSBhdmFpbGFibGUgYmVm
b3JlCiAJICogZ2VuNywgYnV0IHdlIG9ubHkgc3VwcG9ydCBEUlJTIG9uIGdlbjcrCiAJICovCi0J
cmV0dXJuIElTX0dFTihkZXZfcHJpdiwgNykgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdik7CisJ
cmV0dXJuIElTX0dFTihpOTE1LCA3KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpOwogfQogCiBzdGF0
aWMgdm9pZCBpbnRlbF9jcHVfdHJhbnNjb2Rlcl9zZXRfbV9uKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtNzQ5NywxMSArNzQ5NywxMSBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9jcHVfdHJhbnNjb2Rlcl9zZXRfbV9uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YQogCQkJCQkgY29uc3Qgc3RydWN0IGludGVsX2xpbmtfbV9uICptMl9uMikK
IHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAllbnVt
IHRyYW5zY29kZXIgdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0g
NSkgewogCQlJOTE1X1dSSVRFKFBJUEVfREFUQV9NMSh0cmFuc2NvZGVyKSwgVFVfU0laRShtX24t
PnR1KSB8IG1fbi0+Z21jaF9tKTsKIAkJSTkxNV9XUklURShQSVBFX0RBVEFfTjEodHJhbnNjb2Rl
ciksIG1fbi0+Z21jaF9uKTsKIAkJSTkxNV9XUklURShQSVBFX0xJTktfTTEodHJhbnNjb2Rlciks
IG1fbi0+bGlua19tKTsKQEAgLTc1MTEsNyArNzUxMSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Nw
dV90cmFuc2NvZGVyX3NldF9tX24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhCiAJCSAqICh0byBtYWtlIHN1cmUgdGhlIHJlZ2lzdGVycyBhcmUgbm90IHVubmVjZXNzYXJp
bHkgYWNjZXNzZWQpLgogCQkgKi8KIAkJaWYgKG0yX24yICYmIGNydGNfc3RhdGUtPmhhc19kcnJz
ICYmCi0JCSAgICB0cmFuc2NvZGVyX2hhc19tMl9uMihkZXZfcHJpdiwgdHJhbnNjb2RlcikpIHsK
KwkJICAgIHRyYW5zY29kZXJfaGFzX20yX24yKGk5MTUsIHRyYW5zY29kZXIpKSB7CiAJCQlJOTE1
X1dSSVRFKFBJUEVfREFUQV9NMih0cmFuc2NvZGVyKSwKIAkJCQkJVFVfU0laRShtMl9uMi0+dHUp
IHwgbTJfbjItPmdtY2hfbSk7CiAJCQlJOTE1X1dSSVRFKFBJUEVfREFUQV9OMih0cmFuc2NvZGVy
KSwgbTJfbjItPmdtY2hfbik7CkBAIC03NTg4LDcgKzc1ODgsNyBAQCBzdGF0aWMgdm9pZCB2bHZf
cHJlcGFyZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KGRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiBtZGl2OwogCXUzMiBi
ZXN0biwgYmVzdG0xLCBiZXN0bTIsIGJlc3RwMSwgYmVzdHAyOwpAQCAtNzYwMyw3ICs3NjAzLDcg
QEAgc3RhdGljIHZvaWQgdmx2X3ByZXBhcmVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CWlmICgocGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCAmIERQTExfVkNPX0VOQUJMRSkg
PT0gMCkKIAkJcmV0dXJuOwogCi0Jdmx2X2RwaW9fZ2V0KGRldl9wcml2KTsKKwl2bHZfZHBpb19n
ZXQoaTkxNSk7CiAKIAliZXN0biA9IHBpcGVfY29uZmlnLT5kcGxsLm47CiAJYmVzdG0xID0gcGlw
ZV9jb25maWctPmRwbGwubTE7CkBAIC03NjE1LDE4ICs3NjE1LDE4IEBAIHN0YXRpYyB2b2lkIHZs
dl9wcmVwYXJlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCS8qIFBMTCBCIG5lZWRz
IHNwZWNpYWwgaGFuZGxpbmcgKi8KIAlpZiAocGlwZSA9PSBQSVBFX0IpCi0JCXZsdl9wbGxiX3Jl
Y2FsX29wYW1wKGRldl9wcml2LCBwaXBlKTsKKwkJdmx2X3BsbGJfcmVjYWxfb3BhbXAoaTkxNSwg
cGlwZSk7CiAKIAkvKiBTZXQgdXAgVHggdGFyZ2V0IGZvciBwZXJpb2RpYyBSY29tcCB1cGRhdGUg
Ki8KLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzlfQkNBU1QsIDB4
MDEwMDAwMGYpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QTExfRFc5X0JDQVNU
LCAweDAxMDAwMDBmKTsKIAogCS8qIERpc2FibGUgdGFyZ2V0IElSZWYgb24gUExMICovCi0JcmVn
X3ZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc4KHBpcGUpKTsK
KwlyZWdfdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBWTFZfUExMX0RXOChwaXBlKSk7
CiAJcmVnX3ZhbCAmPSAweDAwZmZmZmZmOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBl
LCBWTFZfUExMX0RXOChwaXBlKSwgcmVnX3ZhbCk7CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlw
ZSwgVkxWX1BMTF9EVzgocGlwZSksIHJlZ192YWwpOwogCiAJLyogRGlzYWJsZSBmYXN0IGxvY2sg
Ki8KLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX0NNTl9EVzAsIDB4NjEwKTsK
Kwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfQ01OX0RXMCwgMHg2MTApOwogCiAJLyog
U2V0IGlkdGFmY3JlY2FsIGJlZm9yZSBQTEwgaXMgZW5hYmxlZCAqLwogCW1kaXYgPSAoKGJlc3Rt
MSA8PCBEUElPX00xRElWX1NISUZUKSB8IChiZXN0bTIgJiBEUElPX00yRElWX01BU0spKTsKQEAg
LTc2NDAsNTUgKzc2NDAsNTUgQEAgc3RhdGljIHZvaWQgdmx2X3ByZXBhcmVfcGxsKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAogCSAqIE5vdGU6IGRvbid0IHVzZSB0aGUgREFDIHBvc3QgZGl2aWRl
ciBhcyBpdCBzZWVtcyB1bnN0YWJsZS4KIAkgKi8KIAltZGl2IHw9IChEUElPX1BPU1RfRElWX0hE
TUlEUCA8PCBEUElPX1BPU1RfRElWX1NISUZUKTsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwg
cGlwZSwgVkxWX1BMTF9EVzMocGlwZSksIG1kaXYpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBp
cGUsIFZMVl9QTExfRFczKHBpcGUpLCBtZGl2KTsKIAogCW1kaXYgfD0gRFBJT19FTkFCTEVfQ0FM
SUJSQVRJT047Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFczKHBp
cGUpLCBtZGl2KTsKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUExMX0RXMyhwaXBl
KSwgbWRpdik7CiAKIAkvKiBTZXQgSEJSIGFuZCBSQlIgTFBGIGNvZWZmaWNpZW50cyAqLwogCWlm
IChwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayA9PSAxNjIwMDAgfHwKIAkgICAgaW50ZWxfY3J0Y19o
YXNfdHlwZShwaXBlX2NvbmZpZywgSU5URUxfT1VUUFVUX0FOQUxPRykgfHwKIAkgICAgaW50ZWxf
Y3J0Y19oYXNfdHlwZShwaXBlX2NvbmZpZywgSU5URUxfT1VUUFVUX0hETUkpKQotCQl2bHZfZHBp
b193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzEwKHBpcGUpLAorCQl2bHZfZHBpb193
cml0ZShpOTE1LCBwaXBlLCBWTFZfUExMX0RXMTAocGlwZSksCiAJCQkJIDB4MDA5ZjAwMDMpOwog
CWVsc2UKLQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFcxMChwaXBl
KSwKKwkJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgVkxWX1BMTF9EVzEwKHBpcGUpLAogCQkJ
CSAweDAwZDAwMDBmKTsKIAogCWlmIChpbnRlbF9jcnRjX2hhc19kcF9lbmNvZGVyKHBpcGVfY29u
ZmlnKSkgewogCQkvKiBVc2UgU1NDIHNvdXJjZSAqLwogCQlpZiAocGlwZSA9PSBQSVBFX0EpCi0J
CQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzUocGlwZSksCisJCQl2
bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUExMX0RXNShwaXBlKSwKIAkJCQkJIDB4MGRm
NDAwMDApOwogCQllbHNlCi0JCQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BM
TF9EVzUocGlwZSksCisJCQl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUExMX0RXNShw
aXBlKSwKIAkJCQkJIDB4MGRmNzAwMDApOwogCX0gZWxzZSB7IC8qIEhETUkgb3IgVkdBICovCiAJ
CS8qIFVzZSBiZW5kIHNvdXJjZSAqLwogCQlpZiAocGlwZSA9PSBQSVBFX0EpCi0JCQl2bHZfZHBp
b193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzUocGlwZSksCisJCQl2bHZfZHBpb193
cml0ZShpOTE1LCBwaXBlLCBWTFZfUExMX0RXNShwaXBlKSwKIAkJCQkJIDB4MGRmNzAwMDApOwog
CQllbHNlCi0JCQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzUocGlw
ZSksCisJCQl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUExMX0RXNShwaXBlKSwKIAkJ
CQkJIDB4MGRmNDAwMDApOwogCX0KIAotCWNvcmVjbGsgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2
LCBwaXBlLCBWTFZfUExMX0RXNyhwaXBlKSk7CisJY29yZWNsayA9IHZsdl9kcGlvX3JlYWQoaTkx
NSwgcGlwZSwgVkxWX1BMTF9EVzcocGlwZSkpOwogCWNvcmVjbGsgPSAoY29yZWNsayAmIDB4MDAw
MGZmMDApIHwgMHgwMWMwMDAwMDsKIAlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2RlcihwaXBl
X2NvbmZpZykpCiAJCWNvcmVjbGsgfD0gMHgwMTAwMDAwMDsKLQl2bHZfZHBpb193cml0ZShkZXZf
cHJpdiwgcGlwZSwgVkxWX1BMTF9EVzcocGlwZSksIGNvcmVjbGspOworCXZsdl9kcGlvX3dyaXRl
KGk5MTUsIHBpcGUsIFZMVl9QTExfRFc3KHBpcGUpLCBjb3JlY2xrKTsKIAotCXZsdl9kcGlvX3dy
aXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXMTEocGlwZSksIDB4ODc4NzEwMDApOworCXZs
dl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QTExfRFcxMShwaXBlKSwgMHg4Nzg3MTAwMCk7
CiAKLQl2bHZfZHBpb19wdXQoZGV2X3ByaXYpOworCXZsdl9kcGlvX3B1dChpOTE1KTsKIH0KIAog
c3RhdGljIHZvaWQgY2h2X3ByZXBhcmVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJ
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShkZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAll
bnVtIGRwaW9fY2hhbm5lbCBwb3J0ID0gdmx2X3BpcGVfdG9fY2hhbm5lbChwaXBlKTsKIAl1MzIg
bG9vcGZpbHRlciwgdHJpYnVmX2NhbGNudHI7CkBAIC03NzE0LDQyICs3NzE0LDQyIEBAIHN0YXRp
YyB2b2lkIGNodl9wcmVwYXJlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlkcGlvX3Zh
bCA9IDA7CiAJbG9vcGZpbHRlciA9IDA7CiAKLQl2bHZfZHBpb19nZXQoZGV2X3ByaXYpOworCXZs
dl9kcGlvX2dldChpOTE1KTsKIAogCS8qIHAxIGFuZCBwMiBkaXZpZGVyICovCi0Jdmx2X2RwaW9f
d3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9DTU5fRFcxMyhwb3J0KSwKKwl2bHZfZHBpb193cml0
ZShpOTE1LCBwaXBlLCBDSFZfQ01OX0RXMTMocG9ydCksCiAJCQk1IDw8IERQSU9fQ0hWX1MxX0RJ
Vl9TSElGVCB8CiAJCQliZXN0cDEgPDwgRFBJT19DSFZfUDFfRElWX1NISUZUIHwKIAkJCWJlc3Rw
MiA8PCBEUElPX0NIVl9QMl9ESVZfU0hJRlQgfAogCQkJMSA8PCBEUElPX0NIVl9LX0RJVl9TSElG
VCk7CiAKIAkvKiBGZWVkYmFjayBwb3N0LWRpdmlkZXIgLSBtMiAqLwotCXZsdl9kcGlvX3dyaXRl
KGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXMChwb3J0KSwgYmVzdG0yKTsKKwl2bHZfZHBpb193
cml0ZShpOTE1LCBwaXBlLCBDSFZfUExMX0RXMChwb3J0KSwgYmVzdG0yKTsKIAogCS8qIEZlZWRi
YWNrIHJlZmNsayBkaXZpZGVyIC0gbiBhbmQgbTEgKi8KLQl2bHZfZHBpb193cml0ZShkZXZfcHJp
diwgcGlwZSwgQ0hWX1BMTF9EVzEocG9ydCksCisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwg
Q0hWX1BMTF9EVzEocG9ydCksCiAJCQlEUElPX0NIVl9NMV9ESVZfQllfMiB8CiAJCQkxIDw8IERQ
SU9fQ0hWX05fRElWX1NISUZUKTsKIAogCS8qIE0yIGZyYWN0aW9uIGRpdmlzaW9uICovCi0Jdmx2
X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9QTExfRFcyKHBvcnQpLCBiZXN0bTJfZnJh
Yyk7CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgQ0hWX1BMTF9EVzIocG9ydCksIGJlc3Rt
Ml9mcmFjKTsKIAogCS8qIE0yIGZyYWN0aW9uIGRpdmlzaW9uIGVuYWJsZSAqLwotCWRwaW9fdmFs
ID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX1BMTF9EVzMocG9ydCkpOworCWRw
aW9fdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBDSFZfUExMX0RXMyhwb3J0KSk7CiAJ
ZHBpb192YWwgJj0gfihEUElPX0NIVl9GRUVERldEX0dBSU5fTUFTSyB8IERQSU9fQ0hWX0ZSQUNf
RElWX0VOKTsKIAlkcGlvX3ZhbCB8PSAoMiA8PCBEUElPX0NIVl9GRUVERldEX0dBSU5fU0hJRlQp
OwogCWlmIChiZXN0bTJfZnJhYykKIAkJZHBpb192YWwgfD0gRFBJT19DSFZfRlJBQ19ESVZfRU47
Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9QTExfRFczKHBvcnQpLCBkcGlv
X3ZhbCk7CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgQ0hWX1BMTF9EVzMocG9ydCksIGRw
aW9fdmFsKTsKIAogCS8qIFByb2dyYW0gZGlnaXRhbCBsb2NrIGRldGVjdCB0aHJlc2hvbGQgKi8K
LQlkcGlvX3ZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIENIVl9QTExfRFc5KHBv
cnQpKTsKKwlkcGlvX3ZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgQ0hWX1BMTF9EVzko
cG9ydCkpOwogCWRwaW9fdmFsICY9IH4oRFBJT19DSFZfSU5UX0xPQ0tfVEhSRVNIT0xEX01BU0sg
fAogCQkJCQlEUElPX0NIVl9JTlRfTE9DS19USFJFU0hPTERfU0VMX0NPQVJTRSk7CiAJZHBpb192
YWwgfD0gKDB4NSA8PCBEUElPX0NIVl9JTlRfTE9DS19USFJFU0hPTERfU0hJRlQpOwogCWlmICgh
YmVzdG0yX2ZyYWMpCiAJCWRwaW9fdmFsIHw9IERQSU9fQ0hWX0lOVF9MT0NLX1RIUkVTSE9MRF9T
RUxfQ09BUlNFOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXOShw
b3J0KSwgZHBpb192YWwpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIENIVl9QTExfRFc5
KHBvcnQpLCBkcGlvX3ZhbCk7CiAKIAkvKiBMb29wIGZpbHRlciAqLwogCWlmICh2Y28gPT0gNTQw
MDAwMCkgewpAQCAtNzc3NCwyNCArNzc3NCwyNCBAQCBzdGF0aWMgdm9pZCBjaHZfcHJlcGFyZV9w
bGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCWxvb3BmaWx0ZXIgfD0gKDB4MyA8PCBEUElP
X0NIVl9HQUlOX0NUUkxfU0hJRlQpOwogCQl0cmlidWZfY2FsY250ciA9IDA7CiAJfQotCXZsdl9k
cGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXNihwb3J0KSwgbG9vcGZpbHRlcik7
CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgQ0hWX1BMTF9EVzYocG9ydCksIGxvb3BmaWx0
ZXIpOwogCi0JZHBpb192YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBDSFZfUExM
X0RXOChwb3J0KSk7CisJZHBpb192YWwgPSB2bHZfZHBpb19yZWFkKGk5MTUsIHBpcGUsIENIVl9Q
TExfRFc4KHBvcnQpKTsKIAlkcGlvX3ZhbCAmPSB+RFBJT19DSFZfVERDX1RBUkdFVF9DTlRfTUFT
SzsKIAlkcGlvX3ZhbCB8PSAodHJpYnVmX2NhbGNudHIgPDwgRFBJT19DSFZfVERDX1RBUkdFVF9D
TlRfU0hJRlQpOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXOChw
b3J0KSwgZHBpb192YWwpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIENIVl9QTExfRFc4
KHBvcnQpLCBkcGlvX3ZhbCk7CiAKIAkvKiBBRkMgUmVjYWwgKi8KLQl2bHZfZHBpb193cml0ZShk
ZXZfcHJpdiwgcGlwZSwgQ0hWX0NNTl9EVzE0KHBvcnQpLAotCQkJdmx2X2RwaW9fcmVhZChkZXZf
cHJpdiwgcGlwZSwgQ0hWX0NNTl9EVzE0KHBvcnQpKSB8CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwg
cGlwZSwgQ0hWX0NNTl9EVzE0KHBvcnQpLAorCQkJdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBD
SFZfQ01OX0RXMTQocG9ydCkpIHwKIAkJCURQSU9fQUZDX1JFQ0FMKTsKIAotCXZsdl9kcGlvX3B1
dChkZXZfcHJpdik7CisJdmx2X2RwaW9fcHV0KGk5MTUpOwogfQogCiAvKioKICAqIHZsdl9mb3Jj
ZV9wbGxfb24gLSBmb3JjaWJseSBlbmFibGUganVzdCB0aGUgUExMCi0gKiBAZGV2X3ByaXY6IGk5
MTUgcHJpdmF0ZSBzdHJ1Y3R1cmUKKyAqIEBpOTE1OiBpOTE1IHByaXZhdGUgc3RydWN0dXJlCiAg
KiBAcGlwZTogcGlwZSBQTEwgdG8gZW5hYmxlCiAgKiBAZHBsbDogUExMIGNvbmZpZ3VyYXRpb24K
ICAqCkBAIC03Nzk5LDEwICs3Nzk5LDEwIEBAIHN0YXRpYyB2b2lkIGNodl9wcmVwYXJlX3BsbChz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKICAqIGluIGNhc2VzIHdoZXJlIHdlIG5lZWQgdGhlIFBM
TCBlbmFibGVkIGV2ZW4gd2hlbiBAcGlwZSBpcyBub3QgZ29pbmcgdG8KICAqIGJlIGVuYWJsZWQu
CiAgKi8KLWludCB2bHZfZm9yY2VfcGxsX29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgZW51bSBwaXBlIHBpcGUsCitpbnQgdmx2X2ZvcmNlX3BsbF9vbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUsCiAJCSAgICAgY29uc3Qgc3RydWN0IGRw
bGwgKmRwbGwpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBpbnRlbF9nZXRfY3J0Y19m
b3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBpbnRl
bF9nZXRfY3J0Y19mb3JfcGlwZShpOTE1LCBwaXBlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqcGlwZV9jb25maWc7CiAKIAlwaXBlX2NvbmZpZyA9IGt6YWxsb2Moc2l6ZW9mKCpwaXBlX2Nv
bmZpZyksIEdGUF9LRVJORUwpOwpAQCAtNzgxMyw3ICs3ODEzLDcgQEAgaW50IHZsdl9mb3JjZV9w
bGxfb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSwK
IAlwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllciA9IDE7CiAJcGlwZV9jb25maWctPmRwbGwg
PSAqZHBsbDsKIAotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19DSEVS
UllWSUVXKGk5MTUpKSB7CiAJCWNodl9jb21wdXRlX2RwbGwoY3J0YywgcGlwZV9jb25maWcpOwog
CQljaHZfcHJlcGFyZV9wbGwoY3J0YywgcGlwZV9jb25maWcpOwogCQljaHZfZW5hYmxlX3BsbChj
cnRjLCBwaXBlX2NvbmZpZyk7CkBAIC03ODMwLDI1ICs3ODMwLDI1IEBAIGludCB2bHZfZm9yY2Vf
cGxsX29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUs
CiAKIC8qKgogICogdmx2X2ZvcmNlX3BsbF9vZmYgLSBmb3JjaWJseSBkaXNhYmxlIGp1c3QgdGhl
IFBMTAotICogQGRldl9wcml2OiBpOTE1IHByaXZhdGUgc3RydWN0dXJlCisgKiBAaTkxNTogaTkx
NSBwcml2YXRlIHN0cnVjdHVyZQogICogQHBpcGU6IHBpcGUgUExMIHRvIGRpc2FibGUKICAqCiAg
KiBEaXNhYmxlIHRoZSBQTEwgZm9yIEBwaXBlLiBUbyBiZSB1c2VkIGluIGNhc2VzIHdoZXJlIHdl
IG5lZWQKICAqIHRoZSBQTEwgZW5hYmxlZCBldmVuIHdoZW4gQHBpcGUgaXMgbm90IGdvaW5nIHRv
IGJlIGVuYWJsZWQuCiAgKi8KLXZvaWQgdmx2X2ZvcmNlX3BsbF9vZmYoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKK3ZvaWQgdmx2X2ZvcmNlX3BsbF9v
ZmYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcGlwZSBwaXBlKQogewotCWlm
IChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJY2h2X2Rpc2FibGVfcGxsKGRldl9wcml2LCBw
aXBlKTsKKwlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKKwkJY2h2X2Rpc2FibGVfcGxsKGk5MTUs
IHBpcGUpOwogCWVsc2UKLQkJdmx2X2Rpc2FibGVfcGxsKGRldl9wcml2LCBwaXBlKTsKKwkJdmx2
X2Rpc2FibGVfcGxsKGk5MTUsIHBpcGUpOwogfQogCiBzdGF0aWMgdm9pZCBpOXh4X2NvbXB1dGVf
ZHBsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgc3RydWN0IGRwbGwgKnJlZHVjZWRfY2xvY2sp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAl1MzIgZHBsbDsKIAlzdHJ1Y3QgZHBsbCAqY2xvY2sgPSAmY3J0Y19zdGF0
ZS0+ZHBsbDsKIApAQCAtNzg2MSw4ICs3ODYxLDggQEAgc3RhdGljIHZvaWQgaTl4eF9jb21wdXRl
X2RwbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJZWxzZQogCQlkcGxsIHw9IERQTExCX01P
REVfREFDX1NFUklBTDsKIAotCWlmIChJU19JOTQ1RyhkZXZfcHJpdikgfHwgSVNfSTk0NUdNKGRl
dl9wcml2KSB8fAotCSAgICBJU19HMzMoZGV2X3ByaXYpIHx8IElTX1BJTkVWSUVXKGRldl9wcml2
KSkgeworCWlmIChJU19JOTQ1RyhpOTE1KSB8fCBJU19JOTQ1R00oaTkxNSkgfHwKKwkgICAgSVNf
RzMzKGk5MTUpIHx8IElTX1BJTkVWSUVXKGk5MTUpKSB7CiAJCWRwbGwgfD0gKGNydGNfc3RhdGUt
PnBpeGVsX211bHRpcGxpZXIgLSAxKQogCQkJPDwgU0RWT19NVUxUSVBMSUVSX1NISUZUX0hJUkVT
OwogCX0KQEAgLTc4NzUsMTEgKzc4NzUsMTEgQEAgc3RhdGljIHZvaWQgaTl4eF9jb21wdXRlX2Rw
bGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCWRwbGwgfD0gRFBMTF9TRFZPX0hJR0hfU1BF
RUQ7CiAKIAkvKiBjb21wdXRlIGJpdG1hc2sgZnJvbSBwMSB2YWx1ZSAqLwotCWlmIChJU19QSU5F
VklFVyhkZXZfcHJpdikpCisJaWYgKElTX1BJTkVWSUVXKGk5MTUpKQogCQlkcGxsIHw9ICgxIDw8
IChjbG9jay0+cDEgLSAxKSkgPDwgRFBMTF9GUEEwMV9QMV9QT1NUX0RJVl9TSElGVF9QSU5FVklF
VzsKIAllbHNlIHsKIAkJZHBsbCB8PSAoMSA8PCAoY2xvY2stPnAxIC0gMSkpIDw8IERQTExfRlBB
MDFfUDFfUE9TVF9ESVZfU0hJRlQ7Ci0JCWlmIChJU19HNFgoZGV2X3ByaXYpICYmIHJlZHVjZWRf
Y2xvY2spCisJCWlmIChJU19HNFgoaTkxNSkgJiYgcmVkdWNlZF9jbG9jaykKIAkJCWRwbGwgfD0g
KDEgPDwgKHJlZHVjZWRfY2xvY2stPnAxIC0gMSkpIDw8IERQTExfRlBBMV9QMV9QT1NUX0RJVl9T
SElGVDsKIAl9CiAJc3dpdGNoIChjbG9jay0+cDIpIHsKQEAgLTc4OTYsMTMgKzc4OTYsMTMgQEAg
c3RhdGljIHZvaWQgaTl4eF9jb21wdXRlX2RwbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJ
CWRwbGwgfD0gRFBMTEJfTFZEU19QMl9DTE9DS19ESVZfMTQ7CiAJCWJyZWFrOwogCX0KLQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkKIAkJ
ZHBsbCB8PSAoNiA8PCBQTExfTE9BRF9QVUxTRV9QSEFTRV9TSElGVCk7CiAKIAlpZiAoY3J0Y19z
dGF0ZS0+c2R2b190dl9jbG9jaykKIAkJZHBsbCB8PSBQTExfUkVGX0lOUFVUX1RWQ0xLSU5CQzsK
IAllbHNlIGlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9M
VkRTKSAmJgotCQkgaW50ZWxfcGFuZWxfdXNlX3NzYyhkZXZfcHJpdikpCisJCSBpbnRlbF9wYW5l
bF91c2Vfc3NjKGk5MTUpKQogCQlkcGxsIHw9IFBMTEJfUkVGX0lOUFVUX1NQUkVBRFNQRUNUUlVN
SU47CiAJZWxzZQogCQlkcGxsIHw9IFBMTF9SRUZfSU5QVVRfRFJFRkNMSzsKQEAgLTc5MTAsNyAr
NzkxMCw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfY29tcHV0ZV9kcGxsKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCWRwbGwgfD0gRFBMTF9WQ09fRU5BQkxFOwogCWNydGNfc3RhdGUtPmRwbGxfaHdf
c3RhdGUuZHBsbCA9IGRwbGw7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7CisJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KSB7CiAJCXUzMiBkcGxsX21kID0gKGNydGNfc3RhdGUt
PnBpeGVsX211bHRpcGxpZXIgLSAxKQogCQkJPDwgRFBMTF9NRF9VRElfTVVMVElQTElFUl9TSElG
VDsKIAkJY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZS5kcGxsX21kID0gZHBsbF9tZDsKQEAgLTc5
MjIsNyArNzkyMiw3IEBAIHN0YXRpYyB2b2lkIGk4eHhfY29tcHV0ZV9kcGxsKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCQkJICAgICAgc3RydWN0IGRwbGwgKnJlZHVjZWRfY2xvY2spCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAl1MzIgZHBsbDsKIAlzdHJ1Y3QgZHBsbCAqY2xv
Y2sgPSAmY3J0Y19zdGF0ZS0+ZHBsbDsKIApAQCAtNzk1MywxMiArNzk1MywxMiBAQCBzdGF0aWMg
dm9pZCBpOHh4X2NvbXB1dGVfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkgKiBib3Ro
IERQTExTLiBUaGUgc3BlYyBzYXlzIHdlIHNob3VsZCBkaXNhYmxlIHRoZSBEVk8gMlggY2xvY2sK
IAkgKiB3aGVuIG5vdCBuZWVkZWQsIGJ1dCB0aGlzIHNlZW1zIHRvIHdvcmsgZmluZSBpbiBwcmFj
dGljZS4KIAkgKi8KLQlpZiAoSVNfSTgzMChkZXZfcHJpdikgfHwKKwlpZiAoSVNfSTgzMChpOTE1
KSB8fAogCSAgICBpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9E
Vk8pKQogCQlkcGxsIHw9IERQTExfRFZPXzJYX01PREU7CiAKIAlpZiAoaW50ZWxfY3J0Y19oYXNf
dHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykgJiYKLQkgICAgaW50ZWxfcGFuZWxf
dXNlX3NzYyhkZXZfcHJpdikpCisJICAgIGludGVsX3BhbmVsX3VzZV9zc2MoaTkxNSkpCiAJCWRw
bGwgfD0gUExMQl9SRUZfSU5QVVRfU1BSRUFEU1BFQ1RSVU1JTjsKIAllbHNlCiAJCWRwbGwgfD0g
UExMX1JFRl9JTlBVVF9EUkVGQ0xLOwpAQCAtNzk3MCw3ICs3OTcwLDcgQEAgc3RhdGljIHZvaWQg
aTh4eF9jb21wdXRlX2RwbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiBzdGF0aWMgdm9pZCBp
bnRlbF9zZXRfcGlwZV90aW1pbmdzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBl
OwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFu
c2NvZGVyOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0g
JmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKQEAgLTc5OTYsNyArNzk5Niw3IEBAIHN0
YXRpYyB2b2lkIGludGVsX3NldF9waXBlX3RpbWluZ3MoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiAJCQl2c3luY3NoaWZ0ICs9IGFkanVzdGVkX21vZGUtPmNydGNf
aHRvdGFsOwogCX0KIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID4gMykKKwlpZiAoSU5URUxf
R0VOKGk5MTUpID4gMykKIAkJSTkxNV9XUklURShWU1lOQ1NISUZUKGNwdV90cmFuc2NvZGVyKSwg
dnN5bmNzaGlmdCk7CiAKIAlJOTE1X1dSSVRFKEhUT1RBTChjcHVfdHJhbnNjb2RlciksCkBAIC04
MDIzLDcgKzgwMjMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZXRfcGlwZV90aW1pbmdzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAqIHByb2dyYW1tZWQgd2l0
aCB0aGUgVlRPVEFMX0VEUCB2YWx1ZS4gU2FtZSBmb3IgVlRPVEFMX0MuIFRoaXMgaXMKIAkgKiBk
b2N1bWVudGVkIG9uIHRoZSBERElfRlVOQ19DVEwgcmVnaXN0ZXIgZGVzY3JpcHRpb24sIEVEUCBJ
bnB1dCBTZWxlY3QKIAkgKiBiaXRzLiAqLwotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSAmJiBj
cHVfdHJhbnNjb2RlciA9PSBUUkFOU0NPREVSX0VEUCAmJgorCWlmIChJU19IQVNXRUxMKGk5MTUp
ICYmIGNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09ERVJfRURQICYmCiAJICAgIChwaXBlID09IFBJ
UEVfQiB8fCBwaXBlID09IFBJUEVfQykpCiAJCUk5MTVfV1JJVEUoVlRPVEFMKHBpcGUpLCBJOTE1
X1JFQUQoVlRPVEFMKGNwdV90cmFuc2NvZGVyKSkpOwogCkBAIC04MDMyLDcgKzgwMzIsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9zZXRfcGlwZV90aW1pbmdzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHZvaWQgaW50ZWxfc2V0X3BpcGVfc3JjX3NpemUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKIAkvKiBwaXBlc3JjIGNvbnRy
b2xzIHRoZSBzaXplIHRoYXQgaXMgc2NhbGVkIGZyb20sIHdoaWNoIHNob3VsZApAQCAtODA0Nyw3
ICs4MDQ3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZ2V0X3BpcGVfdGltaW5ncyhzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YywKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25m
aWcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1
X3RyYW5zY29kZXIgPSBwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXI7CiAJdTMyIHRtcDsKIApA
QCAtODA5Miw3ICs4MDkyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZ2V0X3BpcGVfc3JjX3NpemUo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5k
ZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXUzMiB0bXA7
CiAKIAl0bXAgPSBJOTE1X1JFQUQoUElQRVNSQyhjcnRjLT5waXBlKSk7CkBAIC04MTI5LDIxICs4
MTI5LDIxIEBAIHZvaWQgaW50ZWxfbW9kZV9mcm9tX3BpcGVfY29uZmlnKHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICptb2RlLAogc3RhdGljIHZvaWQgaTl4eF9zZXRfcGlwZWNvbmYoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1
MzIgcGlwZWNvbmY7CiAKIAlwaXBlY29uZiA9IDA7CiAKIAkvKiB3ZSBrZWVwIGJvdGggcGlwZXMg
ZW5hYmxlZCBvbiA4MzAgKi8KLQlpZiAoSVNfSTgzMChkZXZfcHJpdikpCisJaWYgKElTX0k4MzAo
aTkxNSkpCiAJCXBpcGVjb25mIHw9IEk5MTVfUkVBRChQSVBFQ09ORihjcnRjLT5waXBlKSkgJiBQ
SVBFQ09ORl9FTkFCTEU7CiAKIAlpZiAoY3J0Y19zdGF0ZS0+ZG91YmxlX3dpZGUpCiAJCXBpcGVj
b25mIHw9IFBJUEVDT05GX0RPVUJMRV9XSURFOwogCiAJLyogb25seSBnNHggYW5kIGxhdGVyIGhh
dmUgZmFuY3kgYnBjL2RpdGhlciBjb250cm9scyAqLwotCWlmIChJU19HNFgoZGV2X3ByaXYpIHx8
IElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8Ci0JICAgIElTX0NIRVJSWVZJRVcoZGV2X3ByaXYp
KSB7CisJaWYgKElTX0c0WChpOTE1KSB8fCBJU19WQUxMRVlWSUVXKGk5MTUpIHx8CisJICAgIElT
X0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJLyogQnNwZWMgY2xhaW1zIHRoYXQgd2UgY2FuJ3QgdXNl
IGRpdGhlcmluZyBmb3IgMzBicHAgcGlwZXMuICovCiAJCWlmIChjcnRjX3N0YXRlLT5kaXRoZXIg
JiYgY3J0Y19zdGF0ZS0+cGlwZV9icHAgIT0gMzApCiAJCQlwaXBlY29uZiB8PSBQSVBFQ09ORl9E
SVRIRVJfRU4gfApAQCAtODE2Niw3ICs4MTY2LDcgQEAgc3RhdGljIHZvaWQgaTl4eF9zZXRfcGlw
ZWNvbmYoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJfQogCiAJ
aWYgKGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdf
SU5URVJMQUNFKSB7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCB8fAorCQlpZiAoSU5U
RUxfR0VOKGk5MTUpIDwgNCB8fAogCQkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRl
LCBJTlRFTF9PVVRQVVRfU0RWTykpCiAJCQlwaXBlY29uZiB8PSBQSVBFQ09ORl9JTlRFUkxBQ0Vf
V19GSUVMRF9JTkRJQ0FUSU9OOwogCQllbHNlCkBAIC04MTc1LDcgKzgxNzUsNyBAQCBzdGF0aWMg
dm9pZCBpOXh4X3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIAkJcGlwZWNvbmYgfD0gUElQRUNPTkZfUFJPR1JFU1NJVkU7CiAJfQogCi0JaWYg
KChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgJiYK
KwlpZiAoKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkgJiYKIAkg
ICAgIGNydGNfc3RhdGUtPmxpbWl0ZWRfY29sb3JfcmFuZ2UpCiAJCXBpcGVjb25mIHw9IFBJUEVD
T05GX0NPTE9SX1JBTkdFX1NFTEVDVDsKIApAQCAtODE4OSw3ICs4MTg5LDcgQEAgc3RhdGljIGlu
dCBpOHh4X2NydGNfY29tcHV0ZV9jbG9jayhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkg
ICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShkZXYpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGltaXQ7CiAJaW50IHJl
ZmNsayA9IDQ4MDAwOwogCkBAIC04MTk3LDggKzgxOTcsOCBAQCBzdGF0aWMgaW50IGk4eHhfY3J0
Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCSAgICAgICBzaXplb2Yo
Y3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZSkpOwogCiAJaWYgKGludGVsX2NydGNfaGFzX3R5cGUo
Y3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMpKSB7Ci0JCWlmIChpbnRlbF9wYW5lbF91c2Vf
c3NjKGRldl9wcml2KSkgewotCQkJcmVmY2xrID0gZGV2X3ByaXYtPnZidC5sdmRzX3NzY19mcmVx
OworCQlpZiAoaW50ZWxfcGFuZWxfdXNlX3NzYyhpOTE1KSkgeworCQkJcmVmY2xrID0gaTkxNS0+
dmJ0Lmx2ZHNfc3NjX2ZyZXE7CiAJCQlEUk1fREVCVUdfS01TKCJ1c2luZyBTU0MgcmVmZXJlbmNl
IGNsb2NrIG9mICVkIGtIelxuIiwgcmVmY2xrKTsKIAkJfQogCkBAIC04MjI0LDcgKzgyMjQsNyBA
QCBzdGF0aWMgaW50IGk4eHhfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAogc3RhdGljIGludCBnNHhfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0OwogCWludCByZWZjbGsgPSA5
NjAwMDsKIApAQCAtODIzMiwxMiArODIzMiwxMiBAQCBzdGF0aWMgaW50IGc0eF9jcnRjX2NvbXB1
dGVfY2xvY2soc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJICAgICAgIHNpemVvZihjcnRjX3N0
YXRlLT5kcGxsX2h3X3N0YXRlKSk7CiAKIAlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0
YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykpIHsKLQkJaWYgKGludGVsX3BhbmVsX3VzZV9zc2MoZGV2
X3ByaXYpKSB7Ci0JCQlyZWZjbGsgPSBkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2ZyZXE7CisJCWlm
IChpbnRlbF9wYW5lbF91c2Vfc3NjKGk5MTUpKSB7CisJCQlyZWZjbGsgPSBpOTE1LT52YnQubHZk
c19zc2NfZnJlcTsKIAkJCURSTV9ERUJVR19LTVMoInVzaW5nIFNTQyByZWZlcmVuY2UgY2xvY2sg
b2YgJWQga0h6XG4iLCByZWZjbGspOwogCQl9CiAKLQkJaWYgKGludGVsX2lzX2R1YWxfbGlua19s
dmRzKGRldl9wcml2KSkKKwkJaWYgKGludGVsX2lzX2R1YWxfbGlua19sdmRzKGk5MTUpKQogCQkJ
bGltaXQgPSAmaW50ZWxfbGltaXRzX2c0eF9kdWFsX2NoYW5uZWxfbHZkczsKIAkJZWxzZQogCQkJ
bGltaXQgPSAmaW50ZWxfbGltaXRzX2c0eF9zaW5nbGVfY2hhbm5lbF9sdmRzOwpAQCAtODI2Nyw3
ICs4MjY3LDcgQEAgc3RhdGljIGludCBwbnZfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfbGlt
aXQgKmxpbWl0OwogCWludCByZWZjbGsgPSA5NjAwMDsKIApAQCAtODI3NSw4ICs4Mjc1LDggQEAg
c3RhdGljIGludCBwbnZfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCSAgICAgICBzaXplb2YoY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZSkpOwogCiAJaWYgKGlu
dGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMpKSB7Ci0JCWlm
IChpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSkgewotCQkJcmVmY2xrID0gZGV2X3ByaXYt
PnZidC5sdmRzX3NzY19mcmVxOworCQlpZiAoaW50ZWxfcGFuZWxfdXNlX3NzYyhpOTE1KSkgewor
CQkJcmVmY2xrID0gaTkxNS0+dmJ0Lmx2ZHNfc3NjX2ZyZXE7CiAJCQlEUk1fREVCVUdfS01TKCJ1
c2luZyBTU0MgcmVmZXJlbmNlIGNsb2NrIG9mICVkIGtIelxuIiwgcmVmY2xrKTsKIAkJfQogCkBA
IC04MzAxLDcgKzgzMDEsNyBAQCBzdGF0aWMgaW50IGk5eHhfY3J0Y19jb21wdXRlX2Nsb2NrKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJY29uc3Qgc3RydWN0
IGludGVsX2xpbWl0ICpsaW1pdDsKIAlpbnQgcmVmY2xrID0gOTYwMDA7CiAKQEAgLTgzMDksOCAr
ODMwOSw4IEBAIHN0YXRpYyBpbnQgaTl4eF9jcnRjX2NvbXB1dGVfY2xvY2soc3RydWN0IGludGVs
X2NydGMgKmNydGMsCiAJICAgICAgIHNpemVvZihjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlKSk7
CiAKIAlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZE
UykpIHsKLQkJaWYgKGludGVsX3BhbmVsX3VzZV9zc2MoZGV2X3ByaXYpKSB7Ci0JCQlyZWZjbGsg
PSBkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2ZyZXE7CisJCWlmIChpbnRlbF9wYW5lbF91c2Vfc3Nj
KGk5MTUpKSB7CisJCQlyZWZjbGsgPSBpOTE1LT52YnQubHZkc19zc2NfZnJlcTsKIAkJCURSTV9E
RUJVR19LTVMoInVzaW5nIFNTQyByZWZlcmVuY2UgY2xvY2sgb2YgJWQga0h6XG4iLCByZWZjbGsp
OwogCQl9CiAKQEAgLTgzNzMsMjIgKzgzNzMsMjIgQEAgc3RhdGljIGludCB2bHZfY3J0Y19jb21w
dXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCXJldHVybiAwOwogfQogCi1zdGF0
aWMgYm9vbCBpOXh4X2hhc19wZml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3N0YXRpYyBib29sIGk5eHhfaGFzX3BmaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiB7Ci0JaWYgKElTX0k4MzAoZGV2X3ByaXYpKQorCWlmIChJU19JODMwKGk5MTUpKQogCQlyZXR1
cm4gZmFsc2U7CiAKLQlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSA0IHx8Ci0JCUlTX1BJ
TkVWSUVXKGRldl9wcml2KSB8fCBJU19NT0JJTEUoZGV2X3ByaXYpOworCXJldHVybiBJTlRFTF9H
RU4oaTkxNSkgPj0gNCB8fAorCQlJU19QSU5FVklFVyhpOTE1KSB8fCBJU19NT0JJTEUoaTkxNSk7
CiB9CiAKIHN0YXRpYyB2b2lkIGk5eHhfZ2V0X3BmaXRfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKIAl1MzIgdG1wOwogCi0JaWYgKCFpOXh4X2hhc19wZml0KGRldl9wcml2KSkKKwlpZiAo
IWk5eHhfaGFzX3BmaXQoaTkxNSkpCiAJCXJldHVybjsKIAogCXRtcCA9IEk5MTVfUkVBRChQRklU
X0NPTlRST0wpOwpAQCAtODM5Niw3ICs4Mzk2LDcgQEAgc3RhdGljIHZvaWQgaTl4eF9nZXRfcGZp
dF9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCXJldHVybjsKIAogCS8qIENoZWNr
IHdoZXRoZXIgdGhlIHBmaXQgaXMgYXR0YWNoZWQgdG8gb3VyIHBpcGUuICovCi0JaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPCA0KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDQpIHsKIAkJaWYg
KGNydGMtPnBpcGUgIT0gUElQRV9CKQogCQkJcmV0dXJuOwogCX0gZWxzZSB7CkBAIC04NDEyLDcg
Kzg0MTIsNyBAQCBzdGF0aWMgdm9pZCB2bHZfY3J0Y19jbG9ja19nZXQoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAJCQkgICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmln
KQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJaW50IHBpcGUgPSBwaXBlX2NvbmZp
Zy0+Y3B1X3RyYW5zY29kZXI7CiAJc3RydWN0IGRwbGwgY2xvY2s7CiAJdTMyIG1kaXY7CkBAIC04
NDIyLDkgKzg0MjIsOSBAQCBzdGF0aWMgdm9pZCB2bHZfY3J0Y19jbG9ja19nZXQoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiAJaWYgKChwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsICYg
RFBMTF9WQ09fRU5BQkxFKSA9PSAwKQogCQlyZXR1cm47CiAKLQl2bHZfZHBpb19nZXQoZGV2X3By
aXYpOwotCW1kaXYgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXMyhw
aXBlKSk7Ci0Jdmx2X2RwaW9fcHV0KGRldl9wcml2KTsKKwl2bHZfZHBpb19nZXQoaTkxNSk7CisJ
bWRpdiA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgVkxWX1BMTF9EVzMocGlwZSkpOworCXZs
dl9kcGlvX3B1dChpOTE1KTsKIAogCWNsb2NrLm0xID0gKG1kaXYgPj4gRFBJT19NMURJVl9TSElG
VCkgJiA3OwogCWNsb2NrLm0yID0gbWRpdiAmIERQSU9fTTJESVZfTUFTSzsKQEAgLTg0NDAsNyAr
ODQ0MCw3IEBAIGk5eHhfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCQkJICAgICAgc3RydWN0IGludGVsX2luaXRpYWxfcGxhbmVfY29uZmlnICpwbGFu
ZV9jb25maWcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2Owot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKIAllbnVt
IGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHBsYW5lLT5pOXh4X3BsYW5lOwogCWVudW0gcGlw
ZSBwaXBlOwpAQCAtODQ2Nyw3ICs4NDY3LDcgQEAgaTl4eF9nZXRfaW5pdGlhbF9wbGFuZV9jb25m
aWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAl2YWwgPSBJOTE1X1JFQUQoRFNQQ05UUihp
OXh4X3BsYW5lKSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7CisJaWYgKElO
VEVMX0dFTihpOTE1KSA+PSA0KSB7CiAJCWlmICh2YWwgJiBESVNQUExBTkVfVElMRUQpIHsKIAkJ
CXBsYW5lX2NvbmZpZy0+dGlsaW5nID0gSTkxNV9USUxJTkdfWDsKIAkJCWZiLT5tb2RpZmllciA9
IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOwpAQCAtODQ3Nyw3ICs4NDc3LDcgQEAgaTl4eF9nZXRf
aW5pdGlhbF9wbGFuZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQlwbGFuZV9j
b25maWctPnJvdGF0aW9uID0gRFJNX01PREVfUk9UQVRFXzE4MDsKIAl9CiAKLQlpZiAoSVNfQ0hF
UlJZVklFVyhkZXZfcHJpdikgJiYgcGlwZSA9PSBQSVBFX0IgJiYKKwlpZiAoSVNfQ0hFUlJZVklF
VyhpOTE1KSAmJiBwaXBlID09IFBJUEVfQiAmJgogCSAgICB2YWwgJiBESVNQUExBTkVfTUlSUk9S
KQogCQlwbGFuZV9jb25maWctPnJvdGF0aW9uIHw9IERSTV9NT0RFX1JFRkxFQ1RfWDsKIApAQCAt
ODQ4NSwxMCArODQ4NSwxMCBAQCBpOXh4X2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKIAlmb3VyY2MgPSBpOXh4X2Zvcm1hdF90b19mb3VyY2MocGl4ZWxf
Zm9ybWF0KTsKIAlmYi0+Zm9ybWF0ID0gZHJtX2Zvcm1hdF9pbmZvKGZvdXJjYyk7CiAKLQlpZiAo
SVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkgeworCWlmIChJ
U19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FEV0VMTChpOTE1KSkgewogCQlvZmZzZXQgPSBJOTE1
X1JFQUQoRFNQT0ZGU0VUKGk5eHhfcGxhbmUpKTsKIAkJYmFzZSA9IEk5MTVfUkVBRChEU1BTVVJG
KGk5eHhfcGxhbmUpKSAmIDB4ZmZmZmYwMDA7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDQpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KSB7CiAJCWlmIChw
bGFuZV9jb25maWctPnRpbGluZykKIAkJCW9mZnNldCA9IEk5MTVfUkVBRChEU1BUSUxFT0ZGKGk5
eHhfcGxhbmUpKTsKIAkJZWxzZQpAQCAtODUyMiw3ICs4NTIyLDcgQEAgc3RhdGljIHZvaWQgY2h2
X2NydGNfY2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgICAgIHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShkZXYpOwogCWludCBwaXBlID0gcGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyOwogCWVudW0g
ZHBpb19jaGFubmVsIHBvcnQgPSB2bHZfcGlwZV90b19jaGFubmVsKHBpcGUpOwogCXN0cnVjdCBk
cGxsIGNsb2NrOwpAQCAtODUzMywxMyArODUzMywxMyBAQCBzdGF0aWMgdm9pZCBjaHZfY3J0Y19j
bG9ja19nZXQoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJaWYgKChwaXBlX2NvbmZpZy0+ZHBs
bF9od19zdGF0ZS5kcGxsICYgRFBMTF9WQ09fRU5BQkxFKSA9PSAwKQogCQlyZXR1cm47CiAKLQl2
bHZfZHBpb19nZXQoZGV2X3ByaXYpOwotCWNtbl9kdzEzID0gdmx2X2RwaW9fcmVhZChkZXZfcHJp
diwgcGlwZSwgQ0hWX0NNTl9EVzEzKHBvcnQpKTsKLQlwbGxfZHcwID0gdmx2X2RwaW9fcmVhZChk
ZXZfcHJpdiwgcGlwZSwgQ0hWX1BMTF9EVzAocG9ydCkpOwotCXBsbF9kdzEgPSB2bHZfZHBpb19y
ZWFkKGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXMShwb3J0KSk7Ci0JcGxsX2R3MiA9IHZsdl9k
cGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIENIVl9QTExfRFcyKHBvcnQpKTsKLQlwbGxfZHczID0g
dmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX1BMTF9EVzMocG9ydCkpOwotCXZsdl9k
cGlvX3B1dChkZXZfcHJpdik7CisJdmx2X2RwaW9fZ2V0KGk5MTUpOworCWNtbl9kdzEzID0gdmx2
X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBDSFZfQ01OX0RXMTMocG9ydCkpOworCXBsbF9kdzAgPSB2
bHZfZHBpb19yZWFkKGk5MTUsIHBpcGUsIENIVl9QTExfRFcwKHBvcnQpKTsKKwlwbGxfZHcxID0g
dmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBDSFZfUExMX0RXMShwb3J0KSk7CisJcGxsX2R3MiA9
IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgQ0hWX1BMTF9EVzIocG9ydCkpOworCXBsbF9kdzMg
PSB2bHZfZHBpb19yZWFkKGk5MTUsIHBpcGUsIENIVl9QTExfRFczKHBvcnQpKTsKKwl2bHZfZHBp
b19wdXQoaTkxNSk7CiAKIAljbG9jay5tMSA9IChwbGxfZHcxICYgMHg3KSA9PSBEUElPX0NIVl9N
MV9ESVZfQllfMiA/IDIgOiAwOwogCWNsb2NrLm0yID0gKHBsbF9kdzAgJiAweGZmKSA8PCAyMjsK
QEAgLTg1NTUsMTIgKzg1NTUsMTIgQEAgc3RhdGljIHZvaWQgY2h2X2NydGNfY2xvY2tfZ2V0KHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogc3RhdGljIHZvaWQgaW50ZWxfZ2V0X2NydGNfeWNiY3Jf
Y29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIGludGVsX291dHB1dF9mb3JtYXQg
b3V0cHV0ID0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0I7CiAKIAlwaXBlX2NvbmZpZy0+bHNwY29u
X2Rvd25zYW1wbGluZyA9IGZhbHNlOwogCi0JaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikgfHwg
SU5URUxfR0VOKGRldl9wcml2KSA+PSA5KSB7CisJaWYgKElTX0JST0FEV0VMTChpOTE1KSB8fCBJ
TlRFTF9HRU4oaTkxNSkgPj0gOSkgewogCQl1MzIgdG1wID0gSTkxNV9SRUFEKFBJUEVNSVNDKGNy
dGMtPnBpcGUpKTsKIAogCQlpZiAodG1wICYgUElQRU1JU0NfT1VUUFVUX0NPTE9SU1BBQ0VfWVVW
KSB7CkBAIC04NTcxLDggKzg1NzEsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9nZXRfY3J0Y195Y2Jj
cl9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJLyogV2Ugc3VwcG9ydCA0OjI6
MCBpbiBmdWxsIGJsZW5kIG1vZGUgb25seSAqLwogCQkJCWlmICghYmxlbmQpCiAJCQkJCW91dHB1
dCA9IElOVEVMX09VVFBVVF9GT1JNQVRfSU5WQUxJRDsKLQkJCQllbHNlIGlmICghKElTX0dFTUlO
SUxBS0UoZGV2X3ByaXYpIHx8Ci0JCQkJCSAgIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApKQor
CQkJCWVsc2UgaWYgKCEoSVNfR0VNSU5JTEFLRShpOTE1KSB8fAorCQkJCQkgICBJTlRFTF9HRU4o
aTkxNSkgPj0gMTApKQogCQkJCQlvdXRwdXQgPSBJTlRFTF9PVVRQVVRfRk9STUFUX0lOVkFMSUQ7
CiAJCQkJZWxzZQogCQkJCQlvdXRwdXQgPSBJTlRFTF9PVVRQVVRfRk9STUFUX1lDQkNSNDIwOwpA
QCAtODU5OSw3ICs4NTk5LDcgQEAgc3RhdGljIHZvaWQgaTl4eF9nZXRfcGlwZV9jb2xvcl9jb25m
aWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFy
eSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAllbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHBsYW5lLT5pOXh4
X3BsYW5lOwogCXUzMiB0bXA7CiAKQEAgLTg2MDgsNyArODYwOCw3IEBAIHN0YXRpYyB2b2lkIGk5
eHhfZ2V0X3BpcGVfY29sb3JfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogCWlmICh0bXAgJiBESVNQUExBTkVfR0FNTUFfRU5BQkxFKQogCQljcnRjX3N0YXRlLT5n
YW1tYV9lbmFibGUgPSB0cnVlOwogCi0JaWYgKCFIQVNfR01DSChkZXZfcHJpdikgJiYKKwlpZiAo
IUhBU19HTUNIKGk5MTUpICYmCiAJICAgIHRtcCAmIERJU1BQTEFORV9QSVBFX0NTQ19FTkFCTEUp
CiAJCWNydGNfc3RhdGUtPmNzY19lbmFibGUgPSB0cnVlOwogfQpAQCAtODYxNiwxNCArODYxNiwx
NCBAQCBzdGF0aWMgdm9pZCBpOXh4X2dldF9waXBlX2NvbG9yX2NvbmZpZyhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyBib29sIGk5eHhfZ2V0X3BpcGVfY29uZmln
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWlu
IHBvd2VyX2RvbWFpbjsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1MzIgdG1wOwogCWJv
b2wgcmV0OwogCiAJcG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlOX1BJUEUoY3J0Yy0+cGlwZSk7
Ci0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYs
IHBvd2VyX2RvbWFpbik7CisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2Vu
YWJsZWQoaTkxNSwgcG93ZXJfZG9tYWluKTsKIAlpZiAoIXdha2VyZWYpCiAJCXJldHVybiBmYWxz
ZTsKIApAQCAtODYzNyw4ICs4NjM3LDggQEAgc3RhdGljIGJvb2wgaTl4eF9nZXRfcGlwZV9jb25m
aWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJaWYgKCEodG1wICYgUElQRUNPTkZfRU5BQkxF
KSkKIAkJZ290byBvdXQ7CiAKLQlpZiAoSVNfRzRYKGRldl9wcml2KSB8fCBJU19WQUxMRVlWSUVX
KGRldl9wcml2KSB8fAotCSAgICBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19H
NFgoaTkxNSkgfHwgSVNfVkFMTEVZVklFVyhpOTE1KSB8fAorCSAgICBJU19DSEVSUllWSUVXKGk5
MTUpKSB7CiAJCXN3aXRjaCAodG1wICYgUElQRUNPTkZfQlBDX01BU0spIHsKIAkJY2FzZSBQSVBF
Q09ORl82QlBDOgogCQkJcGlwZV9jb25maWctPnBpcGVfYnBwID0gMTg7CkBAIC04NjU0LDIwICs4
NjU0LDIwIEBAIHN0YXRpYyBib29sIGk5eHhfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQl9CiAJfQogCi0JaWYgKChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJ
U19DSEVSUllWSUVXKGRldl9wcml2KSkgJiYKKwlpZiAoKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwg
SVNfQ0hFUlJZVklFVyhpOTE1KSkgJiYKIAkgICAgKHRtcCAmIFBJUEVDT05GX0NPTE9SX1JBTkdF
X1NFTEVDVCkpCiAJCXBpcGVfY29uZmlnLT5saW1pdGVkX2NvbG9yX3JhbmdlID0gdHJ1ZTsKIAog
CXBpcGVfY29uZmlnLT5nYW1tYV9tb2RlID0gKHRtcCAmIFBJUEVDT05GX0dBTU1BX01PREVfTUFT
S19JOVhYKSA+PgogCQlQSVBFQ09ORl9HQU1NQV9NT0RFX1NISUZUOwogCi0JaWYgKElTX0NIRVJS
WVZJRVcoZGV2X3ByaXYpKQorCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQlwaXBlX2NvbmZp
Zy0+Y2dtX21vZGUgPSBJOTE1X1JFQUQoQ0dNX1BJUEVfTU9ERShjcnRjLT5waXBlKSk7CiAKIAlp
OXh4X2dldF9waXBlX2NvbG9yX2NvbmZpZyhwaXBlX2NvbmZpZyk7CiAJaW50ZWxfY29sb3JfZ2V0
X2NvbmZpZyhwaXBlX2NvbmZpZyk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDQpCisJ
aWYgKElOVEVMX0dFTihpOTE1KSA8IDQpCiAJCXBpcGVfY29uZmlnLT5kb3VibGVfd2lkZSA9IHRt
cCAmIFBJUEVDT05GX0RPVUJMRV9XSURFOwogCiAJaW50ZWxfZ2V0X3BpcGVfdGltaW5ncyhjcnRj
LCBwaXBlX2NvbmZpZyk7CkBAIC04Njc1LDE4ICs4Njc1LDE4IEBAIHN0YXRpYyBib29sIGk5eHhf
Z2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJaTl4eF9nZXRfcGZp
dF9jb25maWcoY3J0YywgcGlwZV9jb25maWcpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gNCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkgewogCQkvKiBObyB3YXkgdG8gcmVh
ZCBpdCBvdXQgb24gcGlwZXMgQiBhbmQgQyAqLwotCQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJp
dikgJiYgY3J0Yy0+cGlwZSAhPSBQSVBFX0EpCi0JCQl0bXAgPSBkZXZfcHJpdi0+Y2h2X2RwbGxf
bWRbY3J0Yy0+cGlwZV07CisJCWlmIChJU19DSEVSUllWSUVXKGk5MTUpICYmIGNydGMtPnBpcGUg
IT0gUElQRV9BKQorCQkJdG1wID0gaTkxNS0+Y2h2X2RwbGxfbWRbY3J0Yy0+cGlwZV07CiAJCWVs
c2UKIAkJCXRtcCA9IEk5MTVfUkVBRChEUExMX01EKGNydGMtPnBpcGUpKTsKIAkJcGlwZV9jb25m
aWctPnBpeGVsX211bHRpcGxpZXIgPQogCQkJKCh0bXAgJiBEUExMX01EX1VESV9NVUxUSVBMSUVS
X01BU0spCiAJCQkgPj4gRFBMTF9NRF9VRElfTVVMVElQTElFUl9TSElGVCkgKyAxOwogCQlwaXBl
X2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsX21kID0gdG1wOwotCX0gZWxzZSBpZiAoSVNfSTk0
NUcoZGV2X3ByaXYpIHx8IElTX0k5NDVHTShkZXZfcHJpdikgfHwKLQkJICAgSVNfRzMzKGRldl9w
cml2KSB8fCBJU19QSU5FVklFVyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0k5NDVHKGk5
MTUpIHx8IElTX0k5NDVHTShpOTE1KSB8fAorCQkgICBJU19HMzMoaTkxNSkgfHwgSVNfUElORVZJ
RVcoaTkxNSkpIHsKIAkJdG1wID0gSTkxNV9SRUFEKERQTEwoY3J0Yy0+cGlwZSkpOwogCQlwaXBl
X2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllciA9CiAJCQkoKHRtcCAmIFNEVk9fTVVMVElQTElFUl9N
QVNLKQpAQCAtODY5OCw3ICs4Njk4LDcgQEAgc3RhdGljIGJvb2wgaTl4eF9nZXRfcGlwZV9jb25m
aWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCXBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBs
aWVyID0gMTsKIAl9CiAJcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCA9IEk5MTVfUkVB
RChEUExMKGNydGMtPnBpcGUpKTsKLQlpZiAoIUlTX1ZBTExFWVZJRVcoZGV2X3ByaXYpICYmICFJ
U19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlmICghSVNfVkFMTEVZVklFVyhpOTE1KSAmJiAh
SVNfQ0hFUlJZVklFVyhpOTE1KSkgewogCQlwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5mcDAg
PSBJOTE1X1JFQUQoRlAwKGNydGMtPnBpcGUpKTsKIAkJcGlwZV9jb25maWctPmRwbGxfaHdfc3Rh
dGUuZnAxID0gSTkxNV9SRUFEKEZQMShjcnRjLT5waXBlKSk7CiAJfSBlbHNlIHsKQEAgLTg3MDgs
OSArODcwOCw5IEBAIHN0YXRpYyBib29sIGk5eHhfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCQkJCQkJICAgICBEUExMX1BPUlRCX1JFQURZX01BU0spOwogCX0KIAot
CWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKKwlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkK
IAkJY2h2X2NydGNfY2xvY2tfZ2V0KGNydGMsIHBpcGVfY29uZmlnKTsKLQllbHNlIGlmIChJU19W
QUxMRVlWSUVXKGRldl9wcml2KSkKKwllbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpKQogCQl2
bHZfY3J0Y19jbG9ja19nZXQoY3J0YywgcGlwZV9jb25maWcpOwogCWVsc2UKIAkJaTl4eF9jcnRj
X2Nsb2NrX2dldChjcnRjLCBwaXBlX2NvbmZpZyk7CkBAIC04NzI2LDEyICs4NzI2LDEyIEBAIHN0
YXRpYyBib29sIGk5eHhfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CXJldCA9IHRydWU7CiAKIG91dDoKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwg
cG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBw
b3dlcl9kb21haW4sIHdha2VyZWYpOwogCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQg
aXJvbmxha2VfaW5pdF9wY2hfcmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKK3N0YXRpYyB2b2lkIGlyb25sYWtlX2luaXRfcGNoX3JlZmNsayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAlpbnQg
aTsKQEAgLTg3NDQsNyArODc0NCw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2luaXRfcGNoX3Jl
ZmNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJYm9vbCB1c2luZ19zc2Nf
c291cmNlID0gZmFsc2U7CiAKIAkvKiBXZSBuZWVkIHRvIHRha2UgdGhlIGdsb2JhbCBjb25maWcg
aW50byBhY2NvdW50ICovCi0JZm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwg
ZW5jb2RlcikgeworCWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmk5MTUtPmRybSwgZW5jb2Rlcikg
ewogCQlzd2l0Y2ggKGVuY29kZXItPnR5cGUpIHsKIAkJY2FzZSBJTlRFTF9PVVRQVVRfTFZEUzoK
IAkJCWhhc19wYW5lbCA9IHRydWU7CkBAIC04NzYwLDggKzg3NjAsOCBAQCBzdGF0aWMgdm9pZCBp
cm9ubGFrZV9pbml0X3BjaF9yZWZjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCQl9CiAJfQogCi0JaWYgKEhBU19QQ0hfSUJYKGRldl9wcml2KSkgewotCQloYXNfY2s1MDUg
PSBkZXZfcHJpdi0+dmJ0LmRpc3BsYXlfY2xvY2tfbW9kZTsKKwlpZiAoSEFTX1BDSF9JQlgoaTkx
NSkpIHsKKwkJaGFzX2NrNTA1ID0gaTkxNS0+dmJ0LmRpc3BsYXlfY2xvY2tfbW9kZTsKIAkJY2Fu
X3NzYyA9IGhhc19jazUwNTsKIAl9IGVsc2UgewogCQloYXNfY2s1MDUgPSBmYWxzZTsKQEAgLTg3
NjksNyArODc2OSw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2luaXRfcGNoX3JlZmNsayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogCiAJLyogQ2hlY2sgaWYgYW55IERQ
TExzIGFyZSB1c2luZyB0aGUgU1NDIHNvdXJjZSAqLwotCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJp
di0+bnVtX3NoYXJlZF9kcGxsOyBpKyspIHsKKwlmb3IgKGkgPSAwOyBpIDwgaTkxNS0+bnVtX3No
YXJlZF9kcGxsOyBpKyspIHsKIAkJdTMyIHRlbXAgPSBJOTE1X1JFQUQoUENIX0RQTEwoaSkpOwog
CiAJCWlmICghKHRlbXAgJiBEUExMX1ZDT19FTkFCTEUpKQpAQCAtODgxMCwxMSArODgxMCwxMSBA
QCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9pbml0X3BjaF9yZWZjbGsoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCWlmIChoYXNfcGFuZWwpIHsKIAkJZmluYWwgfD0gRFJFRl9TU0Nf
U09VUkNFX0VOQUJMRTsKIAotCQlpZiAoaW50ZWxfcGFuZWxfdXNlX3NzYyhkZXZfcHJpdikgJiYg
Y2FuX3NzYykKKwkJaWYgKGludGVsX3BhbmVsX3VzZV9zc2MoaTkxNSkgJiYgY2FuX3NzYykKIAkJ
CWZpbmFsIHw9IERSRUZfU1NDMV9FTkFCTEU7CiAKIAkJaWYgKGhhc19jcHVfZWRwKSB7Ci0JCQlp
ZiAoaW50ZWxfcGFuZWxfdXNlX3NzYyhkZXZfcHJpdikgJiYgY2FuX3NzYykKKwkJCWlmIChpbnRl
bF9wYW5lbF91c2Vfc3NjKGk5MTUpICYmIGNhbl9zc2MpCiAJCQkJZmluYWwgfD0gRFJFRl9DUFVf
U09VUkNFX09VVFBVVF9ET1dOU1BSRUFEOwogCQkJZWxzZQogCQkJCWZpbmFsIHw9IERSRUZfQ1BV
X1NPVVJDRV9PVVRQVVRfTk9OU1BSRUFEOwpAQCAtODg0MSw3ICs4ODQxLDcgQEAgc3RhdGljIHZv
aWQgaXJvbmxha2VfaW5pdF9wY2hfcmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJdmFsIHw9IERSRUZfU1NDX1NPVVJDRV9FTkFCTEU7CiAKIAkJLyogU1NDIG11c3Qg
YmUgdHVybmVkIG9uIGJlZm9yZSBlbmFibGluZyB0aGUgQ1BVIG91dHB1dCAgKi8KLQkJaWYgKGlu
dGVsX3BhbmVsX3VzZV9zc2MoZGV2X3ByaXYpICYmIGNhbl9zc2MpIHsKKwkJaWYgKGludGVsX3Bh
bmVsX3VzZV9zc2MoaTkxNSkgJiYgY2FuX3NzYykgewogCQkJRFJNX0RFQlVHX0tNUygiVXNpbmcg
U1NDIG9uIHBhbmVsXG4iKTsKIAkJCXZhbCB8PSBEUkVGX1NTQzFfRU5BQkxFOwogCQl9IGVsc2UK
QEAgLTg4NTYsNyArODg1Niw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2luaXRfcGNoX3JlZmNs
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAkJLyogRW5hYmxlIENQVSBz
b3VyY2Ugb24gQ1BVIGF0dGFjaGVkIGVEUCAqLwogCQlpZiAoaGFzX2NwdV9lZHApIHsKLQkJCWlm
IChpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSAmJiBjYW5fc3NjKSB7CisJCQlpZiAoaW50
ZWxfcGFuZWxfdXNlX3NzYyhpOTE1KSAmJiBjYW5fc3NjKSB7CiAJCQkJRFJNX0RFQlVHX0tNUygi
VXNpbmcgU1NDIG9uIGVEUFxuIik7CiAJCQkJdmFsIHw9IERSRUZfQ1BVX1NPVVJDRV9PVVRQVVRf
RE9XTlNQUkVBRDsKIAkJCX0gZWxzZQpAQCAtODg5OCw3ICs4ODk4LDcgQEAgc3RhdGljIHZvaWQg
aXJvbmxha2VfaW5pdF9wY2hfcmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAlCVUdfT04odmFsICE9IGZpbmFsKTsKIH0KIAotc3RhdGljIHZvaWQgbHB0X3Jlc2V0X2Zk
aV9tcGh5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGxw
dF9yZXNldF9mZGlfbXBoeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIg
dG1wOwogCkBAIC04OTIwLDc4ICs4OTIwLDc4IEBAIHN0YXRpYyB2b2lkIGxwdF9yZXNldF9mZGlf
bXBoeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB9CiAKIC8qIFdhTVBoeVBy
b2dyYW1taW5nOmhzdyAqLwotc3RhdGljIHZvaWQgbHB0X3Byb2dyYW1fZmRpX21waHkoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgbHB0X3Byb2dyYW1fZmRp
X21waHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIHRtcDsKIAotCXRt
cCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAweDgwMDgsIFNCSV9NUEhZKTsKKwl0bXAgPSBp
bnRlbF9zYmlfcmVhZChpOTE1LCAweDgwMDgsIFNCSV9NUEhZKTsKIAl0bXAgJj0gfigweEZGIDw8
IDI0KTsKIAl0bXAgfD0gKDB4MTIgPDwgMjQpOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwg
MHg4MDA4LCB0bXAsIFNCSV9NUEhZKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgMHg4MDA4LCB0
bXAsIFNCSV9NUEhZKTsKIAotCXRtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAweDIwMDgs
IFNCSV9NUEhZKTsKKwl0bXAgPSBpbnRlbF9zYmlfcmVhZChpOTE1LCAweDIwMDgsIFNCSV9NUEhZ
KTsKIAl0bXAgfD0gKDEgPDwgMTEpOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwgMHgyMDA4
LCB0bXAsIFNCSV9NUEhZKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgMHgyMDA4LCB0bXAsIFNC
SV9NUEhZKTsKIAotCXRtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAweDIxMDgsIFNCSV9N
UEhZKTsKKwl0bXAgPSBpbnRlbF9zYmlfcmVhZChpOTE1LCAweDIxMDgsIFNCSV9NUEhZKTsKIAl0
bXAgfD0gKDEgPDwgMTEpOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwgMHgyMTA4LCB0bXAs
IFNCSV9NUEhZKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgMHgyMTA4LCB0bXAsIFNCSV9NUEhZ
KTsKIAotCXRtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAweDIwNkMsIFNCSV9NUEhZKTsK
Kwl0bXAgPSBpbnRlbF9zYmlfcmVhZChpOTE1LCAweDIwNkMsIFNCSV9NUEhZKTsKIAl0bXAgfD0g
KDEgPDwgMjQpIHwgKDEgPDwgMjEpIHwgKDEgPDwgMTgpOwotCWludGVsX3NiaV93cml0ZShkZXZf
cHJpdiwgMHgyMDZDLCB0bXAsIFNCSV9NUEhZKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgMHgy
MDZDLCB0bXAsIFNCSV9NUEhZKTsKIAotCXRtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAw
eDIxNkMsIFNCSV9NUEhZKTsKKwl0bXAgPSBpbnRlbF9zYmlfcmVhZChpOTE1LCAweDIxNkMsIFNC
SV9NUEhZKTsKIAl0bXAgfD0gKDEgPDwgMjQpIHwgKDEgPDwgMjEpIHwgKDEgPDwgMTgpOwotCWlu
dGVsX3NiaV93cml0ZShkZXZfcHJpdiwgMHgyMTZDLCB0bXAsIFNCSV9NUEhZKTsKKwlpbnRlbF9z
Ymlfd3JpdGUoaTkxNSwgMHgyMTZDLCB0bXAsIFNCSV9NUEhZKTsKIAotCXRtcCA9IGludGVsX3Ni
aV9yZWFkKGRldl9wcml2LCAweDIwODAsIFNCSV9NUEhZKTsKKwl0bXAgPSBpbnRlbF9zYmlfcmVh
ZChpOTE1LCAweDIwODAsIFNCSV9NUEhZKTsKIAl0bXAgJj0gfig3IDw8IDEzKTsKIAl0bXAgfD0g
KDUgPDwgMTMpOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwgMHgyMDgwLCB0bXAsIFNCSV9N
UEhZKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgMHgyMDgwLCB0bXAsIFNCSV9NUEhZKTsKIAot
CXRtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAweDIxODAsIFNCSV9NUEhZKTsKKwl0bXAg
PSBpbnRlbF9zYmlfcmVhZChpOTE1LCAweDIxODAsIFNCSV9NUEhZKTsKIAl0bXAgJj0gfig3IDw8
IDEzKTsKIAl0bXAgfD0gKDUgPDwgMTMpOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwgMHgy
MTgwLCB0bXAsIFNCSV9NUEhZKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgMHgyMTgwLCB0bXAs
IFNCSV9NUEhZKTsKIAotCXRtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAweDIwOEMsIFNC
SV9NUEhZKTsKKwl0bXAgPSBpbnRlbF9zYmlfcmVhZChpOTE1LCAweDIwOEMsIFNCSV9NUEhZKTsK
IAl0bXAgJj0gfjB4RkY7CiAJdG1wIHw9IDB4MUM7Ci0JaW50ZWxfc2JpX3dyaXRlKGRldl9wcml2
LCAweDIwOEMsIHRtcCwgU0JJX01QSFkpOworCWludGVsX3NiaV93cml0ZShpOTE1LCAweDIwOEMs
IHRtcCwgU0JJX01QSFkpOwogCi0JdG1wID0gaW50ZWxfc2JpX3JlYWQoZGV2X3ByaXYsIDB4MjE4
QywgU0JJX01QSFkpOworCXRtcCA9IGludGVsX3NiaV9yZWFkKGk5MTUsIDB4MjE4QywgU0JJX01Q
SFkpOwogCXRtcCAmPSB+MHhGRjsKIAl0bXAgfD0gMHgxQzsKLQlpbnRlbF9zYmlfd3JpdGUoZGV2
X3ByaXYsIDB4MjE4QywgdG1wLCBTQklfTVBIWSk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIDB4
MjE4QywgdG1wLCBTQklfTVBIWSk7CiAKLQl0bXAgPSBpbnRlbF9zYmlfcmVhZChkZXZfcHJpdiwg
MHgyMDk4LCBTQklfTVBIWSk7CisJdG1wID0gaW50ZWxfc2JpX3JlYWQoaTkxNSwgMHgyMDk4LCBT
QklfTVBIWSk7CiAJdG1wICY9IH4oMHhGRiA8PCAxNik7CiAJdG1wIHw9ICgweDFDIDw8IDE2KTsK
LQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIDB4MjA5OCwgdG1wLCBTQklfTVBIWSk7CisJaW50
ZWxfc2JpX3dyaXRlKGk5MTUsIDB4MjA5OCwgdG1wLCBTQklfTVBIWSk7CiAKLQl0bXAgPSBpbnRl
bF9zYmlfcmVhZChkZXZfcHJpdiwgMHgyMTk4LCBTQklfTVBIWSk7CisJdG1wID0gaW50ZWxfc2Jp
X3JlYWQoaTkxNSwgMHgyMTk4LCBTQklfTVBIWSk7CiAJdG1wICY9IH4oMHhGRiA8PCAxNik7CiAJ
dG1wIHw9ICgweDFDIDw8IDE2KTsKLQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIDB4MjE5OCwg
dG1wLCBTQklfTVBIWSk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIDB4MjE5OCwgdG1wLCBTQklf
TVBIWSk7CiAKLQl0bXAgPSBpbnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgMHgyMEM0LCBTQklfTVBI
WSk7CisJdG1wID0gaW50ZWxfc2JpX3JlYWQoaTkxNSwgMHgyMEM0LCBTQklfTVBIWSk7CiAJdG1w
IHw9ICgxIDw8IDI3KTsKLQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIDB4MjBDNCwgdG1wLCBT
QklfTVBIWSk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIDB4MjBDNCwgdG1wLCBTQklfTVBIWSk7
CiAKLQl0bXAgPSBpbnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgMHgyMUM0LCBTQklfTVBIWSk7CisJ
dG1wID0gaW50ZWxfc2JpX3JlYWQoaTkxNSwgMHgyMUM0LCBTQklfTVBIWSk7CiAJdG1wIHw9ICgx
IDw8IDI3KTsKLQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIDB4MjFDNCwgdG1wLCBTQklfTVBI
WSk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIDB4MjFDNCwgdG1wLCBTQklfTVBIWSk7CiAKLQl0
bXAgPSBpbnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgMHgyMEVDLCBTQklfTVBIWSk7CisJdG1wID0g
aW50ZWxfc2JpX3JlYWQoaTkxNSwgMHgyMEVDLCBTQklfTVBIWSk7CiAJdG1wICY9IH4oMHhGIDw8
IDI4KTsKIAl0bXAgfD0gKDQgPDwgMjgpOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwgMHgy
MEVDLCB0bXAsIFNCSV9NUEhZKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgMHgyMEVDLCB0bXAs
IFNCSV9NUEhZKTsKIAotCXRtcCA9IGludGVsX3NiaV9yZWFkKGRldl9wcml2LCAweDIxRUMsIFNC
SV9NUEhZKTsKKwl0bXAgPSBpbnRlbF9zYmlfcmVhZChpOTE1LCAweDIxRUMsIFNCSV9NUEhZKTsK
IAl0bXAgJj0gfigweEYgPDwgMjgpOwogCXRtcCB8PSAoNCA8PCAyOCk7Ci0JaW50ZWxfc2JpX3dy
aXRlKGRldl9wcml2LCAweDIxRUMsIHRtcCwgU0JJX01QSFkpOworCWludGVsX3NiaV93cml0ZShp
OTE1LCAweDIxRUMsIHRtcCwgU0JJX01QSFkpOwogfQogCiAvKiBJbXBsZW1lbnRzIDMgZGlmZmVy
ZW50IHNlcXVlbmNlcyBmcm9tIEJTcGVjIGNoYXB0ZXIgIkRpc3BsYXkgaUNMSwpAQCAtOTAwMCw2
OSArOTAwMCw2OSBAQCBzdGF0aWMgdm9pZCBscHRfcHJvZ3JhbV9mZGlfbXBoeShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKiAtIFNlcXVlbmNlIHRvIGVuYWJsZSBDTEtPVVRf
RFAgd2l0aG91dCBzcHJlYWQKICAqIC0gU2VxdWVuY2UgdG8gZW5hYmxlIENMS09VVF9EUCBmb3Ig
RkRJIHVzYWdlIGFuZCBjb25maWd1cmUgUENIIEZESSBJL08KICAqLwotc3RhdGljIHZvaWQgbHB0
X2VuYWJsZV9jbGtvdXRfZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIHZvaWQgbHB0X2VuYWJsZV9jbGtvdXRfZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJIGJvb2wgd2l0aF9zcHJlYWQsIGJvb2wgd2l0aF9mZGkpCiB7CiAJdTMyIHJlZywg
dG1wOwogCiAJaWYgKFdBUk4od2l0aF9mZGkgJiYgIXdpdGhfc3ByZWFkLCAiRkRJIHJlcXVpcmVz
IGRvd25zcHJlYWRcbiIpKQogCQl3aXRoX3NwcmVhZCA9IHRydWU7Ci0JaWYgKFdBUk4oSEFTX1BD
SF9MUFRfTFAoZGV2X3ByaXYpICYmCisJaWYgKFdBUk4oSEFTX1BDSF9MUFRfTFAoaTkxNSkgJiYK
IAkgICAgd2l0aF9mZGksICJMUCBQQ0ggZG9lc24ndCBoYXZlIEZESVxuIikpCiAJCXdpdGhfZmRp
ID0gZmFsc2U7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+c2JfbG9jayk7CisJbXV0ZXhfbG9j
aygmaTkxNS0+c2JfbG9jayk7CiAKLQl0bXAgPSBpbnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgU0JJ
X1NTQ0NUTCwgU0JJX0lDTEspOworCXRtcCA9IGludGVsX3NiaV9yZWFkKGk5MTUsIFNCSV9TU0ND
VEwsIFNCSV9JQ0xLKTsKIAl0bXAgJj0gflNCSV9TU0NDVExfRElTQUJMRTsKIAl0bXAgfD0gU0JJ
X1NTQ0NUTF9QQVRIQUxUOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwgU0JJX1NTQ0NUTCwg
dG1wLCBTQklfSUNMSyk7CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIFNCSV9TU0NDVEwsIHRtcCwg
U0JJX0lDTEspOwogCiAJdWRlbGF5KDI0KTsKIAogCWlmICh3aXRoX3NwcmVhZCkgewotCQl0bXAg
PSBpbnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgU0JJX1NTQ0NUTCwgU0JJX0lDTEspOworCQl0bXAg
PSBpbnRlbF9zYmlfcmVhZChpOTE1LCBTQklfU1NDQ1RMLCBTQklfSUNMSyk7CiAJCXRtcCAmPSB+
U0JJX1NTQ0NUTF9QQVRIQUxUOwotCQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIFNCSV9TU0ND
VEwsIHRtcCwgU0JJX0lDTEspOworCQlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgU0JJX1NTQ0NUTCwg
dG1wLCBTQklfSUNMSyk7CiAKIAkJaWYgKHdpdGhfZmRpKSB7Ci0JCQlscHRfcmVzZXRfZmRpX21w
aHkoZGV2X3ByaXYpOwotCQkJbHB0X3Byb2dyYW1fZmRpX21waHkoZGV2X3ByaXYpOworCQkJbHB0
X3Jlc2V0X2ZkaV9tcGh5KGk5MTUpOworCQkJbHB0X3Byb2dyYW1fZmRpX21waHkoaTkxNSk7CiAJ
CX0KIAl9CiAKLQlyZWcgPSBIQVNfUENIX0xQVF9MUChkZXZfcHJpdikgPyBTQklfR0VOMCA6IFNC
SV9EQlVGRjA7Ci0JdG1wID0gaW50ZWxfc2JpX3JlYWQoZGV2X3ByaXYsIHJlZywgU0JJX0lDTEsp
OworCXJlZyA9IEhBU19QQ0hfTFBUX0xQKGk5MTUpID8gU0JJX0dFTjAgOiBTQklfREJVRkYwOwor
CXRtcCA9IGludGVsX3NiaV9yZWFkKGk5MTUsIHJlZywgU0JJX0lDTEspOwogCXRtcCB8PSBTQklf
R0VOMF9DRkdfQlVGRkVOQUJMRV9ESVNBQkxFOwotCWludGVsX3NiaV93cml0ZShkZXZfcHJpdiwg
cmVnLCB0bXAsIFNCSV9JQ0xLKTsKKwlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgcmVnLCB0bXAsIFNC
SV9JQ0xLKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnNiX2xvY2spOworCW11dGV4X3Vu
bG9jaygmaTkxNS0+c2JfbG9jayk7CiB9CiAKIC8qIFNlcXVlbmNlIHRvIGRpc2FibGUgQ0xLT1VU
X0RQICovCi12b2lkIGxwdF9kaXNhYmxlX2Nsa291dF9kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCit2b2lkIGxwdF9kaXNhYmxlX2Nsa291dF9kcChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgcmVnLCB0bXA7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJp
di0+c2JfbG9jayk7CisJbXV0ZXhfbG9jaygmaTkxNS0+c2JfbG9jayk7CiAKLQlyZWcgPSBIQVNf
UENIX0xQVF9MUChkZXZfcHJpdikgPyBTQklfR0VOMCA6IFNCSV9EQlVGRjA7Ci0JdG1wID0gaW50
ZWxfc2JpX3JlYWQoZGV2X3ByaXYsIHJlZywgU0JJX0lDTEspOworCXJlZyA9IEhBU19QQ0hfTFBU
X0xQKGk5MTUpID8gU0JJX0dFTjAgOiBTQklfREJVRkYwOworCXRtcCA9IGludGVsX3NiaV9yZWFk
KGk5MTUsIHJlZywgU0JJX0lDTEspOwogCXRtcCAmPSB+U0JJX0dFTjBfQ0ZHX0JVRkZFTkFCTEVf
RElTQUJMRTsKLQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIHJlZywgdG1wLCBTQklfSUNMSyk7
CisJaW50ZWxfc2JpX3dyaXRlKGk5MTUsIHJlZywgdG1wLCBTQklfSUNMSyk7CiAKLQl0bXAgPSBp
bnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgU0JJX1NTQ0NUTCwgU0JJX0lDTEspOworCXRtcCA9IGlu
dGVsX3NiaV9yZWFkKGk5MTUsIFNCSV9TU0NDVEwsIFNCSV9JQ0xLKTsKIAlpZiAoISh0bXAgJiBT
QklfU1NDQ1RMX0RJU0FCTEUpKSB7CiAJCWlmICghKHRtcCAmIFNCSV9TU0NDVExfUEFUSEFMVCkp
IHsKIAkJCXRtcCB8PSBTQklfU1NDQ1RMX1BBVEhBTFQ7Ci0JCQlpbnRlbF9zYmlfd3JpdGUoZGV2
X3ByaXYsIFNCSV9TU0NDVEwsIHRtcCwgU0JJX0lDTEspOworCQkJaW50ZWxfc2JpX3dyaXRlKGk5
MTUsIFNCSV9TU0NDVEwsIHRtcCwgU0JJX0lDTEspOwogCQkJdWRlbGF5KDMyKTsKIAkJfQogCQl0
bXAgfD0gU0JJX1NTQ0NUTF9ESVNBQkxFOwotCQlpbnRlbF9zYmlfd3JpdGUoZGV2X3ByaXYsIFNC
SV9TU0NDVEwsIHRtcCwgU0JJX0lDTEspOworCQlpbnRlbF9zYmlfd3JpdGUoaTkxNSwgU0JJX1NT
Q0NUTCwgdG1wLCBTQklfSUNMSyk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+c2Jf
bG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5zYl9sb2NrKTsKIH0KIAogI2RlZmluZSBCRU5E
X0lEWChzdGVwcykgKCg1MCArIChzdGVwcykpIC8gNSkKQEAgLTkwOTcsNyArOTA5Nyw3IEBAIHN0
YXRpYyBjb25zdCB1MTYgc3NjZGl2aW50cGhhc2VbXSA9IHsKICAqIDwgMCBzbG93IGRvd24gdGhl
IGNsb2NrLCA+IDAgc3BlZWQgdXAgdGhlIGNsb2NrLCAwID09IG5vIGJlbmQgKDEzNU1IeikKICAq
IGNoYW5nZSBpbiBjbG9jayBwZXJpb2QgPSAtKHN0ZXBzIC8gMTApICogNS43ODcgcHMKICAqLwot
c3RhdGljIHZvaWQgbHB0X2JlbmRfY2xrb3V0X2RwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgaW50IHN0ZXBzKQorc3RhdGljIHZvaWQgbHB0X2JlbmRfY2xrb3V0X2RwKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgc3RlcHMpCiB7CiAJdTMyIHRtcDsKIAlpbnQg
aWR4ID0gQkVORF9JRFgoc3RlcHMpOwpAQCAtOTEwOCwyNSArOTEwOCwyNSBAQCBzdGF0aWMgdm9p
ZCBscHRfYmVuZF9jbGtvdXRfZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBp
bnQgc3RlcHMpCiAJaWYgKFdBUk5fT04oaWR4ID49IEFSUkFZX1NJWkUoc3NjZGl2aW50cGhhc2Up
KSkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnNiX2xvY2spOworCW11dGV4
X2xvY2soJmk5MTUtPnNiX2xvY2spOwogCiAJaWYgKHN0ZXBzICUgMTAgIT0gMCkKIAkJdG1wID0g
MHhBQUFBQUFBQjsKIAllbHNlCiAJCXRtcCA9IDB4MDAwMDAwMDA7Ci0JaW50ZWxfc2JpX3dyaXRl
KGRldl9wcml2LCBTQklfU1NDRElUSFBIQVNFLCB0bXAsIFNCSV9JQ0xLKTsKKwlpbnRlbF9zYmlf
d3JpdGUoaTkxNSwgU0JJX1NTQ0RJVEhQSEFTRSwgdG1wLCBTQklfSUNMSyk7CiAKLQl0bXAgPSBp
bnRlbF9zYmlfcmVhZChkZXZfcHJpdiwgU0JJX1NTQ0RJVklOVFBIQVNFLCBTQklfSUNMSyk7CisJ
dG1wID0gaW50ZWxfc2JpX3JlYWQoaTkxNSwgU0JJX1NTQ0RJVklOVFBIQVNFLCBTQklfSUNMSyk7
CiAJdG1wICY9IDB4ZmZmZjAwMDA7CiAJdG1wIHw9IHNzY2RpdmludHBoYXNlW2lkeF07Ci0JaW50
ZWxfc2JpX3dyaXRlKGRldl9wcml2LCBTQklfU1NDRElWSU5UUEhBU0UsIHRtcCwgU0JJX0lDTEsp
OworCWludGVsX3NiaV93cml0ZShpOTE1LCBTQklfU1NDRElWSU5UUEhBU0UsIHRtcCwgU0JJX0lD
TEspOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+c2JfbG9jayk7CisJbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5zYl9sb2NrKTsKIH0KIAogI3VuZGVmIEJFTkRfSURYCiAKLXN0YXRpYyBib29sIHNw
bGxfdXNlc19wY2hfc3NjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRp
YyBib29sIHNwbGxfdXNlc19wY2hfc3NjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCXUzMiBmdXNlX3N0cmFwID0gSTkxNV9SRUFEKEZVU0VfU1RSQVApOwogCXUzMiBjdGwgPSBJ
OTE1X1JFQUQoU1BMTF9DVEwpOwpAQCAtOTEzOCwxNCArOTEzOCwxNCBAQCBzdGF0aWMgYm9vbCBz
cGxsX3VzZXNfcGNoX3NzYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICAg
IChmdXNlX3N0cmFwICYgSFNXX0NQVV9TU0NfRU5BQkxFKSA9PSAwKQogCQlyZXR1cm4gdHJ1ZTsK
IAotCWlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpICYmCisJaWYgKElTX0JST0FEV0VMTChpOTE1
KSAmJgogCSAgICAoY3RsICYgU1BMTF9SRUZfTUFTSykgPT0gU1BMTF9SRUZfUENIX1NTQ19CRFcp
CiAJCXJldHVybiB0cnVlOwogCiAJcmV0dXJuIGZhbHNlOwogfQogCi1zdGF0aWMgYm9vbCB3cnBs
bF91c2VzX3BjaF9zc2Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IGJvb2wgd3JwbGxfdXNlc19wY2hfc3NjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJICAgICAgIGVudW0gaW50ZWxfZHBsbF9pZCBpZCkKIHsKIAl1MzIgZnVzZV9zdHJhcCA9IEk5
MTVfUkVBRChGVVNFX1NUUkFQKTsKQEAgLTkxNTcsNyArOTE1Nyw3IEBAIHN0YXRpYyBib29sIHdy
cGxsX3VzZXNfcGNoX3NzYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYg
KChjdGwgJiBXUlBMTF9SRUZfTUFTSykgPT0gV1JQTExfUkVGX1BDSF9TU0MpCiAJCXJldHVybiB0
cnVlOwogCi0JaWYgKChJU19CUk9BRFdFTEwoZGV2X3ByaXYpIHx8IElTX0hTV19VTFQoZGV2X3By
aXYpKSAmJgorCWlmICgoSVNfQlJPQURXRUxMKGk5MTUpIHx8IElTX0hTV19VTFQoaTkxNSkpICYm
CiAJICAgIChjdGwgJiBXUlBMTF9SRUZfTUFTSykgPT0gV1JQTExfUkVGX01VWEVEX1NTQ19CRFcg
JiYKIAkgICAgKGZ1c2Vfc3RyYXAgJiBIU1dfQ1BVX1NTQ19FTkFCTEUpID09IDApCiAJCXJldHVy
biB0cnVlOwpAQCAtOTE2NSwxMyArOTE2NSwxMyBAQCBzdGF0aWMgYm9vbCB3cnBsbF91c2VzX3Bj
aF9zc2Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiBmYWxzZTsK
IH0KIAotc3RhdGljIHZvaWQgbHB0X2luaXRfcGNoX3JlZmNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBscHRfaW5pdF9wY2hfcmVmY2xrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
OwogCWJvb2wgcGNoX3NzY19pbl91c2UgPSBmYWxzZTsKIAlib29sIGhhc19mZGkgPSBmYWxzZTsK
IAotCWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwlm
b3JfZWFjaF9pbnRlbF9lbmNvZGVyKCZpOTE1LT5kcm0sIGVuY29kZXIpIHsKIAkJc3dpdGNoIChl
bmNvZGVyLT50eXBlKSB7CiAJCWNhc2UgSU5URUxfT1VUUFVUX0FOQUxPRzoKIAkJCWhhc19mZGkg
PSB0cnVlOwpAQCAtOTE5NiwxNyArOTE5NiwxNyBAQCBzdGF0aWMgdm9pZCBscHRfaW5pdF9wY2hf
cmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBjbG9jayBoaWVy
YXJjaHkuIFRoYXQgd291bGQgYWxzbyBhbGxvdyB1cyB0byBkbwogCSAqIGNsb2NrIGJlbmRpbmcg
ZmluYWxseS4KIAkgKi8KLQlpZiAoc3BsbF91c2VzX3BjaF9zc2MoZGV2X3ByaXYpKSB7CisJaWYg
KHNwbGxfdXNlc19wY2hfc3NjKGk5MTUpKSB7CiAJCURSTV9ERUJVR19LTVMoIlNQTEwgdXNpbmcg
UENIIFNTQ1xuIik7CiAJCXBjaF9zc2NfaW5fdXNlID0gdHJ1ZTsKIAl9CiAKLQlpZiAod3JwbGxf
dXNlc19wY2hfc3NjKGRldl9wcml2LCBEUExMX0lEX1dSUExMMSkpIHsKKwlpZiAod3JwbGxfdXNl
c19wY2hfc3NjKGk5MTUsIERQTExfSURfV1JQTEwxKSkgewogCQlEUk1fREVCVUdfS01TKCJXUlBM
TDEgdXNpbmcgUENIIFNTQ1xuIik7CiAJCXBjaF9zc2NfaW5fdXNlID0gdHJ1ZTsKIAl9CiAKLQlp
ZiAod3JwbGxfdXNlc19wY2hfc3NjKGRldl9wcml2LCBEUExMX0lEX1dSUExMMikpIHsKKwlpZiAo
d3JwbGxfdXNlc19wY2hfc3NjKGk5MTUsIERQTExfSURfV1JQTEwyKSkgewogCQlEUk1fREVCVUdf
S01TKCJXUlBMTDIgdXNpbmcgUENIIFNTQ1xuIik7CiAJCXBjaF9zc2NfaW5fdXNlID0gdHJ1ZTsK
IAl9CkBAIC05MjE1LDI4ICs5MjE1LDI4IEBAIHN0YXRpYyB2b2lkIGxwdF9pbml0X3BjaF9yZWZj
bGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlyZXR1cm47CiAKIAlpZiAo
aGFzX2ZkaSkgewotCQlscHRfYmVuZF9jbGtvdXRfZHAoZGV2X3ByaXYsIDApOwotCQlscHRfZW5h
YmxlX2Nsa291dF9kcChkZXZfcHJpdiwgdHJ1ZSwgdHJ1ZSk7CisJCWxwdF9iZW5kX2Nsa291dF9k
cChpOTE1LCAwKTsKKwkJbHB0X2VuYWJsZV9jbGtvdXRfZHAoaTkxNSwgdHJ1ZSwgdHJ1ZSk7CiAJ
fSBlbHNlIHsKLQkJbHB0X2Rpc2FibGVfY2xrb3V0X2RwKGRldl9wcml2KTsKKwkJbHB0X2Rpc2Fi
bGVfY2xrb3V0X2RwKGk5MTUpOwogCX0KIH0KIAogLyoKICAqIEluaXRpYWxpemUgcmVmZXJlbmNl
IGNsb2NrcyB3aGVuIHRoZSBkcml2ZXIgbG9hZHMKICAqLwotdm9pZCBpbnRlbF9pbml0X3BjaF9y
ZWZjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9pbml0
X3BjaF9yZWZjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKEhBU19Q
Q0hfSUJYKGRldl9wcml2KSB8fCBIQVNfUENIX0NQVChkZXZfcHJpdikpCi0JCWlyb25sYWtlX2lu
aXRfcGNoX3JlZmNsayhkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSEFTX1BDSF9MUFQoZGV2X3ByaXYp
KQotCQlscHRfaW5pdF9wY2hfcmVmY2xrKGRldl9wcml2KTsKKwlpZiAoSEFTX1BDSF9JQlgoaTkx
NSkgfHwgSEFTX1BDSF9DUFQoaTkxNSkpCisJCWlyb25sYWtlX2luaXRfcGNoX3JlZmNsayhpOTE1
KTsKKwllbHNlIGlmIChIQVNfUENIX0xQVChpOTE1KSkKKwkJbHB0X2luaXRfcGNoX3JlZmNsayhp
OTE1KTsKIH0KIAogc3RhdGljIHZvaWQgaXJvbmxha2Vfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51
bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiB2YWw7CiAKQEAgLTkyODAsMTEgKzkyODAs
MTEgQEAgc3RhdGljIHZvaWQgaXJvbmxha2Vfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHZvaWQgaGFzd2VsbF9zZXRfcGlwZWNv
bmYoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJh
c2UuZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5j
cHVfdHJhbnNjb2RlcjsKIAl1MzIgdmFsID0gMDsKIAotCWlmIChJU19IQVNXRUxMKGRldl9wcml2
KSAmJiBjcnRjX3N0YXRlLT5kaXRoZXIpCisJaWYgKElTX0hBU1dFTEwoaTkxNSkgJiYgY3J0Y19z
dGF0ZS0+ZGl0aGVyKQogCQl2YWwgfD0gKFBJUEVDT05GX0RJVEhFUl9FTiB8IFBJUEVDT05GX0RJ
VEhFUl9UWVBFX1NQKTsKIAogCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxh
Z3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKQEAgLTkyOTksNyArOTI5OSw3IEBAIHN0YXRp
YyB2b2lkIGhhc3dlbGxfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogc3RhdGljIHZvaWQgYmR3X3NldF9waXBlbWlzYyhjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXUzMiB2
YWwgPSAwOwogCiAJc3dpdGNoIChjcnRjX3N0YXRlLT5waXBlX2JwcCkgewpAQCAtOTMzMSw3ICs5
MzMxLDcgQEAgc3RhdGljIHZvaWQgYmR3X3NldF9waXBlbWlzYyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJdmFsIHw9IFBJUEVNSVNDX1lVVjQyMF9FTkFCTEUg
fAogCQkJUElQRU1JU0NfWVVWNDIwX01PREVfRlVMTF9CTEVORDsKIAotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDExICYmCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSAmJgogCSAgICAo
Y3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lcyAmIH4oaWNsX2hkcl9wbGFuZV9tYXNrKCkgfAogCQkJ
CQkgICBCSVQoUExBTkVfQ1VSU09SKSkpID09IDApCiAJCXZhbCB8PSBQSVBFTUlTQ19IRFJfTU9E
RV9QUkVDSVNJT047CkBAIC05MzQxLDcgKzkzNDEsNyBAQCBzdGF0aWMgdm9pZCBiZHdfc2V0X3Bp
cGVtaXNjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBpbnQg
YmR3X2dldF9waXBlbWlzY19icHAoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
IAl1MzIgdG1wOwogCiAJdG1wID0gSTkxNV9SRUFEKFBJUEVNSVNDKGNydGMtPnBpcGUpKTsKQEAg
LTkzODEsMTcgKzkzODEsMTcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfY29tcHV0ZV9kcGxsKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQkJICBzdHJ1Y3QgZHBsbCAqcmVkdWNlZF9jbG9jaykKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwog
CXUzMiBkcGxsLCBmcCwgZnAyOwogCWludCBmYWN0b3I7CiAKIAkvKiBFbmFibGUgYXV0b3R1bmlu
ZyBvZiB0aGUgUExMIGNsb2NrIChpZiBwZXJtaXNzaWJsZSkgKi8KIAlmYWN0b3IgPSAyMTsKIAlp
ZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykpIHsK
LQkJaWYgKChpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSAmJgotCQkgICAgIGRldl9wcml2
LT52YnQubHZkc19zc2NfZnJlcSA9PSAxMDAwMDApIHx8Ci0JCSAgICAoSEFTX1BDSF9JQlgoZGV2
X3ByaXYpICYmCi0JCSAgICAgaW50ZWxfaXNfZHVhbF9saW5rX2x2ZHMoZGV2X3ByaXYpKSkKKwkJ
aWYgKChpbnRlbF9wYW5lbF91c2Vfc3NjKGk5MTUpICYmCisJCSAgICAgaTkxNS0+dmJ0Lmx2ZHNf
c3NjX2ZyZXEgPT0gMTAwMDAwKSB8fAorCQkgICAgKEhBU19QQ0hfSUJYKGk5MTUpICYmCisJCSAg
ICAgaW50ZWxfaXNfZHVhbF9saW5rX2x2ZHMoaTkxNSkpKQogCQkJZmFjdG9yID0gMjU7CiAJfSBl
bHNlIGlmIChjcnRjX3N0YXRlLT5zZHZvX3R2X2Nsb2NrKSB7CiAJCWZhY3RvciA9IDIwOwpAQCAt
OTQ0Miw3ICs5NDQyLDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfY29tcHV0ZV9kcGxsKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogCSAqIGNsZWFyIGlmIGl0JydzIGEgd2luIG9yIGxvc3MgcG93
ZXIgd2lzZS4gTm8gcG9pbnQgaW4gZG9pbmcKIAkgKiB0aGlzIG9uIElMSyBhdCBhbGwgc2luY2Ug
aXQgaGFzIGEgZml4ZWQgRFBMTDwtPnBpcGUgbWFwcGluZy4KIAkgKi8KLQlpZiAoSU5URUxfSU5G
TyhkZXZfcHJpdiktPm51bV9waXBlcyA9PSAzICYmCisJaWYgKElOVEVMX0lORk8oaTkxNSktPm51
bV9waXBlcyA9PSAzICYmCiAJICAgIGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5U
RUxfT1VUUFVUX0FOQUxPRykpCiAJCWRwbGwgfD0gRFBMTF9TRFZPX0hJR0hfU1BFRUQ7CiAKQEAg
LTk0NjcsNyArOTQ2Nyw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2NvbXB1dGVfZHBsbChzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAl9CiAKIAlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRj
X3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykgJiYKLQkgICAgaW50ZWxfcGFuZWxfdXNlX3NzYyhk
ZXZfcHJpdikpCisJICAgIGludGVsX3BhbmVsX3VzZV9zc2MoaTkxNSkpCiAJCWRwbGwgfD0gUExM
Ql9SRUZfSU5QVVRfU1BSRUFEU1BFQ1RSVU1JTjsKIAllbHNlCiAJCWRwbGwgfD0gUExMX1JFRl9J
TlBVVF9EUkVGQ0xLOwpAQCAtOTQ4Miw3ICs5NDgyLDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2Vf
Y29tcHV0ZV9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogc3RhdGljIGludCBpcm9ubGFr
ZV9jcnRjX2NvbXB1dGVfY2xvY2soc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICAgICAg
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJY29uc3Qg
c3RydWN0IGludGVsX2xpbWl0ICpsaW1pdDsKIAlpbnQgcmVmY2xrID0gMTIwMDAwOwogCkBAIC05
NDk0LDEzICs5NDk0LDEzIEBAIHN0YXRpYyBpbnQgaXJvbmxha2VfY3J0Y19jb21wdXRlX2Nsb2Nr
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQlyZXR1cm4gMDsKIAogCWlmIChpbnRlbF9jcnRj
X2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkgewotCQlpZiAoaW50ZWxf
cGFuZWxfdXNlX3NzYyhkZXZfcHJpdikpIHsKKwkJaWYgKGludGVsX3BhbmVsX3VzZV9zc2MoaTkx
NSkpIHsKIAkJCURSTV9ERUJVR19LTVMoInVzaW5nIFNTQyByZWZlcmVuY2UgY2xvY2sgb2YgJWQg
a0h6XG4iLAotCQkJCSAgICAgIGRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcSk7Ci0JCQlyZWZj
bGsgPSBkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2ZyZXE7CisJCQkJICAgICAgaTkxNS0+dmJ0Lmx2
ZHNfc3NjX2ZyZXEpOworCQkJcmVmY2xrID0gaTkxNS0+dmJ0Lmx2ZHNfc3NjX2ZyZXE7CiAJCX0K
IAotCQlpZiAoaW50ZWxfaXNfZHVhbF9saW5rX2x2ZHMoZGV2X3ByaXYpKSB7CisJCWlmIChpbnRl
bF9pc19kdWFsX2xpbmtfbHZkcyhpOTE1KSkgewogCQkJaWYgKHJlZmNsayA9PSAxMDAwMDApCiAJ
CQkJbGltaXQgPSAmaW50ZWxfbGltaXRzX2lyb25sYWtlX2R1YWxfbHZkc18xMDBtOwogCQkJZWxz
ZQpAQCAtOTUzNyw3ICs5NTM3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcGNoX3RyYW5zY29kZXJf
Z2V0X21fbihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkJIHN0cnVjdCBpbnRlbF9saW5r
X21fbiAqbV9uKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJZW51bSBwaXBlIHBp
cGUgPSBjcnRjLT5waXBlOwogCiAJbV9uLT5saW5rX20gPSBJOTE1X1JFQUQoUENIX1RSQU5TX0xJ
TktfTTEocGlwZSkpOwpAQCAtOTU1NCwxMCArOTU1NCwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9j
cHVfdHJhbnNjb2Rlcl9nZXRfbV9uKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCQkgc3Ry
dWN0IGludGVsX2xpbmtfbV9uICptX24sCiAJCQkJCSBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm0y
X24yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShj
cnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gNSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkgewog
CQltX24tPmxpbmtfbSA9IEk5MTVfUkVBRChQSVBFX0xJTktfTTEodHJhbnNjb2RlcikpOwogCQlt
X24tPmxpbmtfbiA9IEk5MTVfUkVBRChQSVBFX0xJTktfTjEodHJhbnNjb2RlcikpOwogCQltX24t
PmdtY2hfbSA9IEk5MTVfUkVBRChQSVBFX0RBVEFfTTEodHJhbnNjb2RlcikpCkBAIC05NTY2LDcg
Kzk1NjYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcHVfdHJhbnNjb2Rlcl9nZXRfbV9uKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogCQltX24tPnR1ID0gKChJOTE1X1JFQUQoUElQRV9EQVRBX00x
KHRyYW5zY29kZXIpKQogCQkJICAgICYgVFVfU0laRV9NQVNLKSA+PiBUVV9TSVpFX1NISUZUKSAr
IDE7CiAKLQkJaWYgKG0yX24yICYmIHRyYW5zY29kZXJfaGFzX20yX24yKGRldl9wcml2LCB0cmFu
c2NvZGVyKSkgeworCQlpZiAobTJfbjIgJiYgdHJhbnNjb2Rlcl9oYXNfbTJfbjIoaTkxNSwgdHJh
bnNjb2RlcikpIHsKIAkJCW0yX24yLT5saW5rX20gPSBJOTE1X1JFQUQoUElQRV9MSU5LX00yKHRy
YW5zY29kZXIpKTsKIAkJCW0yX24yLT5saW5rX24gPQlJOTE1X1JFQUQoUElQRV9MSU5LX04yKHRy
YW5zY29kZXIpKTsKIAkJCW0yX24yLT5nbWNoX20gPQlJOTE1X1JFQUQoUElQRV9EQVRBX00yKHRy
YW5zY29kZXIpKQpAQCAtOTYwOCw3ICs5NjA4LDcgQEAgc3RhdGljIHZvaWQgc2t5bGFrZV9nZXRf
cGZpdF9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICAgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
Y3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYp
OwogCXN0cnVjdCBpbnRlbF9jcnRjX3NjYWxlcl9zdGF0ZSAqc2NhbGVyX3N0YXRlID0gJnBpcGVf
Y29uZmlnLT5zY2FsZXJfc3RhdGU7CiAJdTMyIHBzX2N0cmwgPSAwOwogCWludCBpZCA9IC0xOwpA
QCAtOTY0MCw3ICs5NjQwLDcgQEAgc2t5bGFrZV9nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcoc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJIHN0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2Nv
bmZpZyAqcGxhbmVfY29uZmlnKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5i
YXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFy
eSk7CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAllbnVtIHBpcGUgcGlw
ZTsKQEAgLTk2NjcsMTIgKzk2NjcsMTIgQEAgc2t5bGFrZV9nZXRfaW5pdGlhbF9wbGFuZV9jb25m
aWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAl2YWwgPSBJOTE1X1JFQUQoUExBTkVfQ1RM
KHBpcGUsIHBsYW5lX2lkKSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlp
ZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQogCQlwaXhlbF9mb3JtYXQgPSB2YWwgJiBJQ0xfUExB
TkVfQ1RMX0ZPUk1BVF9NQVNLOwogCWVsc2UKIAkJcGl4ZWxfZm9ybWF0ID0gdmFsICYgUExBTkVf
Q1RMX0ZPUk1BVF9NQVNLOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNf
R0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDEwIHx8IElT
X0dFTUlOSUxBS0UoaTkxNSkpIHsKIAkJYWxwaGEgPSBJOTE1X1JFQUQoUExBTkVfQ09MT1JfQ1RM
KHBpcGUsIHBsYW5lX2lkKSk7CiAJCWFscGhhICY9IFBMQU5FX0NPTE9SX0FMUEhBX01BU0s7CiAJ
fSBlbHNlIHsKQEAgLTk3MjksNyArOTcyOSw3IEBAIHNreWxha2VfZ2V0X2luaXRpYWxfcGxhbmVf
Y29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQlicmVhazsKIAl9CiAKLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMCAmJgorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTAgJiYK
IAkgICAgdmFsICYgUExBTkVfQ1RMX0ZMSVBfSE9SSVpPTlRBTCkKIAkJcGxhbmVfY29uZmlnLT5y
b3RhdGlvbiB8PSBEUk1fTU9ERV9SRUZMRUNUX1g7CiAKQEAgLTk3NjYsNyArOTc2Niw3IEBAIHN0
YXRpYyB2b2lkIGlyb25sYWtlX2dldF9wZml0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YywKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXUzMiB0bXA7CiAKIAl0bXAgPSBJOTE1X1JFQUQo
UEZfQ1RMKGNydGMtPnBpcGUpKTsKQEAgLTk3NzksNyArOTc3OSw3IEBAIHN0YXRpYyB2b2lkIGly
b25sYWtlX2dldF9wZml0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJLyogV2Ug
Y3VycmVudGx5IGRvIG5vdCBmcmVlIGFzc2lnbmVtZW50cyBvZiBwYW5lbCBmaXR0ZXJzIG9uCiAJ
CSAqIGl2Yi9oc3cgKHNpbmNlIHdlIGRvbid0IHVzZSB0aGUgaGlnaGVyIHVwc2NhbGluZyBtb2Rl
cyB3aGljaAogCQkgKiBkaWZmZXJlbnRpYXRlcyB0aGVtKSBzbyBqdXN0IFdBUk4gYWJvdXQgdGhp
cyBjYXNlIGZvciBub3cuICovCi0JCWlmIChJU19HRU4oZGV2X3ByaXYsIDcpKSB7CisJCWlmIChJ
U19HRU4oaTkxNSwgNykpIHsKIAkJCVdBUk5fT04oKHRtcCAmIFBGX1BJUEVfU0VMX01BU0tfSVZC
KSAhPQogCQkJCVBGX1BJUEVfU0VMX0lWQihjcnRjLT5waXBlKSk7CiAJCX0KQEAgLTk3OTAsMTQg
Kzk3OTAsMTQgQEAgc3RhdGljIGJvb2wgaXJvbmxha2VfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJZW51bSBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7
CiAJdTMyIHRtcDsKIAlib29sIHJldDsKIAogCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9Q
SVBFKGNydGMtPnBpcGUpOwotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9l
bmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21haW4pOworCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsIHBvd2VyX2RvbWFpbik7CiAJaWYgKCF3YWtlcmVm
KQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTk4NTAsNyArOTg1MCw3IEBAIHN0YXRpYyBib29sIGly
b25sYWtlX2dldF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCQlpcm9u
bGFrZV9nZXRfZmRpX21fbl9jb25maWcoY3J0YywgcGlwZV9jb25maWcpOwogCi0JCWlmIChIQVNf
UENIX0lCWChkZXZfcHJpdikpIHsKKwkJaWYgKEhBU19QQ0hfSUJYKGk5MTUpKSB7CiAJCQkvKgog
CQkJICogVGhlIHBpcGUtPnBjaCB0cmFuc2NvZGVyIGFuZCBwY2ggdHJhbnNjb2Rlci0+cGxsCiAJ
CQkgKiBtYXBwaW5nIGlzIGZpeGVkLgpAQCAtOTg2NSwxMCArOTg2NSwxMCBAQCBzdGF0aWMgYm9v
bCBpcm9ubGFrZV9nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCX0K
IAogCQlwaXBlX2NvbmZpZy0+c2hhcmVkX2RwbGwgPQotCQkJaW50ZWxfZ2V0X3NoYXJlZF9kcGxs
X2J5X2lkKGRldl9wcml2LCBwbGxfaWQpOworCQkJaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lk
KGk5MTUsIHBsbF9pZCk7CiAJCXBsbCA9IHBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbDsKIAotCQlX
QVJOX09OKCFwbGwtPmluZm8tPmZ1bmNzLT5nZXRfaHdfc3RhdGUoZGV2X3ByaXYsIHBsbCwKKwkJ
V0FSTl9PTighcGxsLT5pbmZvLT5mdW5jcy0+Z2V0X2h3X3N0YXRlKGk5MTUsIHBsbCwKIAkJCQkJ
CSZwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZSkpOwogCiAJCXRtcCA9IHBpcGVfY29uZmlnLT5k
cGxsX2h3X3N0YXRlLmRwbGw7CkBAIC05ODg5LDE5ICs5ODg5LDE5IEBAIHN0YXRpYyBib29sIGly
b25sYWtlX2dldF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlyZXQgPSB0
cnVlOwogCiBvdXQ6Ci0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2Rv
bWFpbiwgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgcG93ZXJfZG9t
YWluLCB3YWtlcmVmKTsKIAogCXJldHVybiByZXQ7CiB9CiBzdGF0aWMgaW50IGhhc3dlbGxfY3J0
Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgIHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUgPQogCQl0b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0
ZS0+YmFzZS5zdGF0ZSk7CiAKIAlpZiAoIWludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwg
SU5URUxfT1VUUFVUX0RTSSkgfHwKLQkgICAgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewor
CSAgICBJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHsKIAkJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIgPQogCQkJaW50ZWxfZ2V0X2NydGNfbmV3X2VuY29kZXIoc3RhdGUsIGNydGNfc3RhdGUp
OwogCkBAIC05OTE1LDcgKzk5MTUsNyBAQCBzdGF0aWMgaW50IGhhc3dlbGxfY3J0Y19jb21wdXRl
X2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMg
dm9pZCBjYW5ub25sYWtlX2dldF9kZGlfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyB2b2lkIGNhbm5vbmxha2VfZ2V0X2RkaV9wbGwoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgZW51bSBwb3J0IHBvcnQsCiAJCQkJICAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewpAQCAtOTkyOCwxMCArOTkyOCwxMCBAQCBz
dGF0aWMgdm9pZCBjYW5ub25sYWtlX2dldF9kZGlfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlpZiAoV0FSTl9PTihpZCA8IFNLTF9EUExMMCB8fCBpZCA+IFNLTF9EUExM
MikpCiAJCXJldHVybjsKIAotCXBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCA9IGludGVsX2dldF9z
aGFyZWRfZHBsbF9ieV9pZChkZXZfcHJpdiwgaWQpOworCXBpcGVfY29uZmlnLT5zaGFyZWRfZHBs
bCA9IGludGVsX2dldF9zaGFyZWRfZHBsbF9ieV9pZChpOTE1LCBpZCk7CiB9CiAKLXN0YXRpYyB2
b2lkIGljZWxha2VfZ2V0X2RkaV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIHZvaWQgaWNlbGFrZV9nZXRfZGRpX3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQllbnVtIHBvcnQgcG9ydCwKIAkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqcGlwZV9jb25maWcpCiB7CkBAIC05OTM5LDIxICs5OTM5LDIxIEBAIHN0YXRpYyB2b2lkIGlj
ZWxha2VfZ2V0X2RkaV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXUz
MiB0ZW1wOwogCiAJLyogVE9ETzogVEJUIHBsbCBub3QgaW1wbGVtZW50ZWQuICovCi0JaWYgKGlu
dGVsX3BvcnRfaXNfY29tYm9waHkoZGV2X3ByaXYsIHBvcnQpKSB7CisJaWYgKGludGVsX3BvcnRf
aXNfY29tYm9waHkoaTkxNSwgcG9ydCkpIHsKIAkJdGVtcCA9IEk5MTVfUkVBRChEUENMS0FfQ0ZH
Q1IwX0lDTCkgJgogCQkgICAgICAgRFBDTEtBX0NGR0NSMF9ERElfQ0xLX1NFTF9NQVNLKHBvcnQp
OwogCQlpZCA9IHRlbXAgPj4gRFBDTEtBX0NGR0NSMF9ERElfQ0xLX1NFTF9TSElGVChwb3J0KTsK
LQl9IGVsc2UgaWYgKGludGVsX3BvcnRfaXNfdGMoZGV2X3ByaXYsIHBvcnQpKSB7Ci0JCWlkID0g
aWNsX3RjX3BvcnRfdG9fcGxsX2lkKGludGVsX3BvcnRfdG9fdGMoZGV2X3ByaXYsIHBvcnQpKTsK
Kwl9IGVsc2UgaWYgKGludGVsX3BvcnRfaXNfdGMoaTkxNSwgcG9ydCkpIHsKKwkJaWQgPSBpY2xf
dGNfcG9ydF90b19wbGxfaWQoaW50ZWxfcG9ydF90b190YyhpOTE1LCBwb3J0KSk7CiAJfSBlbHNl
IHsKIAkJV0FSTigxLCAiSW52YWxpZCBwb3J0ICV4XG4iLCBwb3J0KTsKIAkJcmV0dXJuOwogCX0K
IAotCXBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCA9IGludGVsX2dldF9zaGFyZWRfZHBsbF9ieV9p
ZChkZXZfcHJpdiwgaWQpOworCXBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCA9IGludGVsX2dldF9z
aGFyZWRfZHBsbF9ieV9pZChpOTE1LCBpZCk7CiB9CiAKLXN0YXRpYyB2b2lkIGJ4dF9nZXRfZGRp
X3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBieHRf
Z2V0X2RkaV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJZW51bSBwb3J0
IHBvcnQsCiAJCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewpAQCAt
OTk3NCwxMCArOTk3NCwxMCBAQCBzdGF0aWMgdm9pZCBieHRfZ2V0X2RkaV9wbGwoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJfQogCi0JcGlwZV9jb25maWct
PnNoYXJlZF9kcGxsID0gaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lkKGRldl9wcml2LCBpZCk7
CisJcGlwZV9jb25maWctPnNoYXJlZF9kcGxsID0gaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lk
KGk5MTUsIGlkKTsKIH0KIAotc3RhdGljIHZvaWQgc2t5bGFrZV9nZXRfZGRpX3BsbChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBza3lsYWtlX2dldF9kZGlf
cGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCWVudW0gcG9ydCBwb3J0LAog
CQkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKQEAgLTk5OTAsMTAg
Kzk5OTAsMTAgQEAgc3RhdGljIHZvaWQgc2t5bGFrZV9nZXRfZGRpX3BsbChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKFdBUk5fT04oaWQgPCBTS0xfRFBMTDAgfHwgaWQg
PiBTS0xfRFBMTDMpKQogCQlyZXR1cm47CiAKLQlwaXBlX2NvbmZpZy0+c2hhcmVkX2RwbGwgPSBp
bnRlbF9nZXRfc2hhcmVkX2RwbGxfYnlfaWQoZGV2X3ByaXYsIGlkKTsKKwlwaXBlX2NvbmZpZy0+
c2hhcmVkX2RwbGwgPSBpbnRlbF9nZXRfc2hhcmVkX2RwbGxfYnlfaWQoaTkxNSwgaWQpOwogfQog
Ci1zdGF0aWMgdm9pZCBoYXN3ZWxsX2dldF9kZGlfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGhhc3dlbGxfZ2V0X2RkaV9wbGwoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJZW51bSBwb3J0IHBvcnQsCiAJCQkJc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewpAQCAtMTAwMjYsNyArMTAwMjYsNyBAQCBzdGF0
aWMgdm9pZCBoYXN3ZWxsX2dldF9kZGlfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkJcmV0dXJuOwogCX0KIAotCXBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCA9IGludGVs
X2dldF9zaGFyZWRfZHBsbF9ieV9pZChkZXZfcHJpdiwgaWQpOworCXBpcGVfY29uZmlnLT5zaGFy
ZWRfZHBsbCA9IGludGVsX2dldF9zaGFyZWRfZHBsbF9ieV9pZChpOTE1LCBpZCk7CiB9CiAKIHN0
YXRpYyBib29sIGhzd19nZXRfdHJhbnNjb2Rlcl9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YywKQEAgLTEwMDM1LDcgKzEwMDM1LDcgQEAgc3RhdGljIGJvb2wgaHN3X2dldF90cmFuc2NvZGVy
X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgaW50ZWxfd2FrZXJlZl90
ICp3YWtlcmVmcykKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWVudW0gaW50ZWxf
ZGlzcGxheV9wb3dlcl9kb21haW4gcG93ZXJfZG9tYWluOwogCXVuc2lnbmVkIGxvbmcgcGFuZWxf
dHJhbnNjb2Rlcl9tYXNrID0gMDsKIAl1bnNpZ25lZCBsb25nIGVuYWJsZWRfcGFuZWxfdHJhbnNj
b2RlcnMgPSAwOwpAQCAtMTAwNDMsMTEgKzEwMDQzLDExIEBAIHN0YXRpYyBib29sIGhzd19nZXRf
dHJhbnNjb2Rlcl9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlpbnRlbF93YWtlcmVm
X3Qgd2Y7CiAJdTMyIHRtcDsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCXBhbmVsX3RyYW5zY29kZXJfbWFzayB8PQogCQkJ
QklUKFRSQU5TQ09ERVJfRFNJXzApIHwgQklUKFRSQU5TQ09ERVJfRFNJXzEpOwogCi0JaWYgKEhB
U19UUkFOU0NPREVSX0VEUChkZXZfcHJpdikpCisJaWYgKEhBU19UUkFOU0NPREVSX0VEUChpOTE1
KSkKIAkJcGFuZWxfdHJhbnNjb2Rlcl9tYXNrIHw9IEJJVChUUkFOU0NPREVSX0VEUCk7CiAKIAkv
KgpAQCAtMTAwNjIsNyArMTAwNjIsNyBAQCBzdGF0aWMgYm9vbCBoc3dfZ2V0X3RyYW5zY29kZXJf
c3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJICovCiAJZm9yX2VhY2hfc2V0X2JpdChw
YW5lbF90cmFuc2NvZGVyLAogCQkJICZwYW5lbF90cmFuc2NvZGVyX21hc2ssCi0JCQkgQVJSQVlf
U0laRShJTlRFTF9JTkZPKGRldl9wcml2KS0+dHJhbnNfb2Zmc2V0cykpIHsKKwkJCSBBUlJBWV9T
SVpFKElOVEVMX0lORk8oaTkxNSktPnRyYW5zX29mZnNldHMpKSB7CiAJCWJvb2wgZm9yY2VfdGhy
dSA9IGZhbHNlOwogCQllbnVtIHBpcGUgdHJhbnNfcGlwZTsKIApAQCAtMTAxMTMsNyArMTAxMTMs
NyBAQCBzdGF0aWMgYm9vbCBoc3dfZ2V0X3RyYW5zY29kZXJfc3RhdGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAJcG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlOX1RSQU5TQ09ERVIocGlwZV9j
b25maWctPmNwdV90cmFuc2NvZGVyKTsKIAlXQVJOX09OKCpwb3dlcl9kb21haW5fbWFzayAmIEJJ
VF9VTEwocG93ZXJfZG9tYWluKSk7CiAKLQl3ZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lm
X2VuYWJsZWQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbik7CisJd2YgPSBpbnRlbF9kaXNwbGF5X3Bv
d2VyX2dldF9pZl9lbmFibGVkKGk5MTUsIHBvd2VyX2RvbWFpbik7CiAJaWYgKCF3ZikKIAkJcmV0
dXJuIGZhbHNlOwogCkBAIC0xMDEzMSw3ICsxMDEzMSw3IEBAIHN0YXRpYyBib29sIGJ4dF9nZXRf
ZHNpX3RyYW5zY29kZXJfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJCSBpbnRl
bF93YWtlcmVmX3QgKndha2VyZWZzKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRj
LT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJ
ZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CiAJZW51bSB0cmFu
c2NvZGVyIGNwdV90cmFuc2NvZGVyOwogCWludGVsX3dha2VyZWZfdCB3ZjsKQEAgLTEwMTQ3LDcg
KzEwMTQ3LDcgQEAgc3RhdGljIGJvb2wgYnh0X2dldF9kc2lfdHJhbnNjb2Rlcl9zdGF0ZShzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJcG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlOX1RSQU5T
Q09ERVIoY3B1X3RyYW5zY29kZXIpOwogCQlXQVJOX09OKCpwb3dlcl9kb21haW5fbWFzayAmIEJJ
VF9VTEwocG93ZXJfZG9tYWluKSk7CiAKLQkJd2YgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9p
Zl9lbmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21haW4pOworCQl3ZiA9IGludGVsX2Rpc3BsYXlf
cG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwgcG93ZXJfZG9tYWluKTsKIAkJaWYgKCF3ZikKIAkJ
CWNvbnRpbnVlOwogCkBAIC0xMDE2MSw3ICsxMDE2MSw3IEBAIHN0YXRpYyBib29sIGJ4dF9nZXRf
ZHNpX3RyYW5zY29kZXJfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCSAqIHJlZ2lz
dGVycy9NSVBJW0JYVF0uIFdlIGNhbiBicmVhayBvdXQgaGVyZSBlYXJseSwgc2luY2Ugd2UKIAkJ
ICogbmVlZCB0aGUgc2FtZSBEU0kgUExMIHRvIGJlIGVuYWJsZWQgZm9yIGJvdGggRFNJIHBvcnRz
LgogCQkgKi8KLQkJaWYgKCFieHRfZHNpX3BsbF9pc19lbmFibGVkKGRldl9wcml2KSkKKwkJaWYg
KCFieHRfZHNpX3BsbF9pc19lbmFibGVkKGk5MTUpKQogCQkJYnJlYWs7CiAKIAkJLyogWFhYOiB0
aGlzIHdvcmtzIGZvciB2aWRlbyBtb2RlIG9ubHkgKi8KQEAgLTEwMTgzLDcgKzEwMTgzLDcgQEAg
c3RhdGljIGJvb2wgYnh0X2dldF9kc2lfdHJhbnNjb2Rlcl9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKIHN0YXRpYyB2b2lkIGhhc3dlbGxfZ2V0X2RkaV9wb3J0X3N0YXRlKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbDsKIAll
bnVtIHBvcnQgcG9ydDsKIAl1MzIgdG1wOwpAQCAtMTAxOTIsMjAgKzEwMTkyLDIwIEBAIHN0YXRp
YyB2b2lkIGhhc3dlbGxfZ2V0X2RkaV9wb3J0X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCiAJcG9ydCA9ICh0bXAgJiBUUkFOU19ERElfUE9SVF9NQVNLKSA+PiBUUkFOU19ERElfUE9S
VF9TSElGVDsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlpY2VsYWtlX2dl
dF9kZGlfcGxsKGRldl9wcml2LCBwb3J0LCBwaXBlX2NvbmZpZyk7Ci0JZWxzZSBpZiAoSVNfQ0FO
Tk9OTEFLRShkZXZfcHJpdikpCi0JCWNhbm5vbmxha2VfZ2V0X2RkaV9wbGwoZGV2X3ByaXYsIHBv
cnQsIHBpcGVfY29uZmlnKTsKLQllbHNlIGlmIChJU19HRU45X0JDKGRldl9wcml2KSkKLQkJc2t5
bGFrZV9nZXRfZGRpX3BsbChkZXZfcHJpdiwgcG9ydCwgcGlwZV9jb25maWcpOwotCWVsc2UgaWYg
KElTX0dFTjlfTFAoZGV2X3ByaXYpKQotCQlieHRfZ2V0X2RkaV9wbGwoZGV2X3ByaXYsIHBvcnQs
IHBpcGVfY29uZmlnKTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQorCQlpY2VsYWtlX2dl
dF9kZGlfcGxsKGk5MTUsIHBvcnQsIHBpcGVfY29uZmlnKTsKKwllbHNlIGlmIChJU19DQU5OT05M
QUtFKGk5MTUpKQorCQljYW5ub25sYWtlX2dldF9kZGlfcGxsKGk5MTUsIHBvcnQsIHBpcGVfY29u
ZmlnKTsKKwllbHNlIGlmIChJU19HRU45X0JDKGk5MTUpKQorCQlza3lsYWtlX2dldF9kZGlfcGxs
KGk5MTUsIHBvcnQsIHBpcGVfY29uZmlnKTsKKwllbHNlIGlmIChJU19HRU45X0xQKGk5MTUpKQor
CQlieHRfZ2V0X2RkaV9wbGwoaTkxNSwgcG9ydCwgcGlwZV9jb25maWcpOwogCWVsc2UKLQkJaGFz
d2VsbF9nZXRfZGRpX3BsbChkZXZfcHJpdiwgcG9ydCwgcGlwZV9jb25maWcpOworCQloYXN3ZWxs
X2dldF9kZGlfcGxsKGk5MTUsIHBvcnQsIHBpcGVfY29uZmlnKTsKIAogCXBsbCA9IHBpcGVfY29u
ZmlnLT5zaGFyZWRfZHBsbDsKIAlpZiAocGxsKSB7Ci0JCVdBUk5fT04oIXBsbC0+aW5mby0+ZnVu
Y3MtPmdldF9od19zdGF0ZShkZXZfcHJpdiwgcGxsLAorCQlXQVJOX09OKCFwbGwtPmluZm8tPmZ1
bmNzLT5nZXRfaHdfc3RhdGUoaTkxNSwgcGxsLAogCQkJCQkJJnBpcGVfY29uZmlnLT5kcGxsX2h3
X3N0YXRlKSk7CiAJfQogCkBAIC0xMDIxNCw3ICsxMDIxNCw3IEBAIHN0YXRpYyB2b2lkIGhhc3dl
bGxfZ2V0X2RkaV9wb3J0X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCSAqIERESSBF
LiBTbyBqdXN0IGNoZWNrIHdoZXRoZXIgdGhpcyBwaXBlIGlzIHdpcmVkIHRvIERESSBFIGFuZCB3
aGV0aGVyCiAJICogdGhlIFBDSCB0cmFuc2NvZGVyIGlzIG9uLgogCSAqLwotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpIDwgOSAmJgorCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA5ICYmCiAJICAgIChw
b3J0ID09IFBPUlRfRSkgJiYgSTkxNV9SRUFEKExQVF9UUkFOU0NPTkYpICYgVFJBTlNfRU5BQkxF
KSB7CiAJCXBpcGVfY29uZmlnLT5oYXNfcGNoX2VuY29kZXIgPSB0cnVlOwogCkBAIC0xMDIyOSw3
ICsxMDIyOSw3IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxfZ2V0X2RkaV9wb3J0X3N0YXRlKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogc3RhdGljIGJvb2wgaGFzd2VsbF9nZXRfcGlwZV9jb25maWco
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmc1tQT1dF
Ul9ET01BSU5fTlVNXSwgd2Y7CiAJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dl
cl9kb21haW47CiAJdTY0IHBvd2VyX2RvbWFpbl9tYXNrOwpAQCAtMTAyMzgsNyArMTAyMzgsNyBA
QCBzdGF0aWMgYm9vbCBoYXN3ZWxsX2dldF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAlpbnRlbF9jcnRjX2luaXRfc2NhbGVycyhjcnRjLCBwaXBlX2NvbmZpZyk7CiAKIAlw
b3dlcl9kb21haW4gPSBQT1dFUl9ET01BSU5fUElQRShjcnRjLT5waXBlKTsKLQl3ZiA9IGludGVs
X2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbik7CisJ
d2YgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsIHBvd2VyX2RvbWFp
bik7CiAJaWYgKCF3ZikKIAkJcmV0dXJuIGZhbHNlOwogCkBAIC0xMDI1MCw3ICsxMDI1MCw3IEBA
IHN0YXRpYyBib29sIGhhc3dlbGxfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAogCWFjdGl2ZSA9IGhzd19nZXRfdHJhbnNjb2Rlcl9zdGF0ZShjcnRjLCBwaXBlX2NvbmZp
ZywKIAkJCQkJICAmcG93ZXJfZG9tYWluX21hc2ssIHdha2VyZWZzKTsKIAotCWlmIChJU19HRU45
X0xQKGRldl9wcml2KSAmJgorCWlmIChJU19HRU45X0xQKGk5MTUpICYmCiAJICAgIGJ4dF9nZXRf
ZHNpX3RyYW5zY29kZXJfc3RhdGUoY3J0YywgcGlwZV9jb25maWcsCiAJCQkJCSAmcG93ZXJfZG9t
YWluX21hc2ssIHdha2VyZWZzKSkgewogCQlXQVJOX09OKGFjdGl2ZSk7CkBAIC0xMDI2MSw3ICsx
MDI2MSw3IEBAIHN0YXRpYyBib29sIGhhc3dlbGxfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCQlnb3RvIG91dDsKIAogCWlmICghdHJhbnNjb2Rlcl9pc19kc2kocGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyKSB8fAotCSAgICBJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDExKSB7CisJICAgIElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewogCQloYXN3ZWxsX2dldF9kZGlf
cG9ydF9zdGF0ZShjcnRjLCBwaXBlX2NvbmZpZyk7CiAJCWludGVsX2dldF9waXBlX3RpbWluZ3Mo
Y3J0YywgcGlwZV9jb25maWcpOwogCX0KQEAgLTEwMjczLDcgKzEwMjczLDcgQEAgc3RhdGljIGJv
b2wgaGFzd2VsbF9nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAlw
aXBlX2NvbmZpZy0+Y3NjX21vZGUgPSBJOTE1X1JFQUQoUElQRV9DU0NfTU9ERShjcnRjLT5waXBl
KSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KSB7CisJaWYgKElOVEVMX0dFTihp
OTE1KSA+PSA5KSB7CiAJCXUzMiB0bXAgPSBJOTE1X1JFQUQoU0tMX0JPVFRPTV9DT0xPUihjcnRj
LT5waXBlKSk7CiAKIAkJaWYgKHRtcCAmIFNLTF9CT1RUT01fQ09MT1JfR0FNTUFfRU5BQkxFKQpA
QCAtMTAyOTAsMTkgKzEwMjkwLDE5IEBAIHN0YXRpYyBib29sIGhhc3dlbGxfZ2V0X3BpcGVfY29u
ZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJ
Tl9QSVBFX1BBTkVMX0ZJVFRFUihjcnRjLT5waXBlKTsKIAlXQVJOX09OKHBvd2VyX2RvbWFpbl9t
YXNrICYgQklUX1VMTChwb3dlcl9kb21haW4pKTsKIAotCXdmID0gaW50ZWxfZGlzcGxheV9wb3dl
cl9nZXRfaWZfZW5hYmxlZChkZXZfcHJpdiwgcG93ZXJfZG9tYWluKTsKKwl3ZiA9IGludGVsX2Rp
c3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwgcG93ZXJfZG9tYWluKTsKIAlpZiAod2Yp
IHsKIAkJd2FrZXJlZnNbcG93ZXJfZG9tYWluXSA9IHdmOwogCQlwb3dlcl9kb21haW5fbWFzayB8
PSBCSVRfVUxMKHBvd2VyX2RvbWFpbik7CiAKLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQkJc2t5bGFrZV9nZXRfcGZpdF9jb25m
aWcoY3J0YywgcGlwZV9jb25maWcpOwogCQllbHNlCiAJCQlpcm9ubGFrZV9nZXRfcGZpdF9jb25m
aWcoY3J0YywgcGlwZV9jb25maWcpOwogCX0KIAogCWlmIChoc3dfY3J0Y19zdXBwb3J0c19pcHMo
Y3J0YykpIHsKLQkJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQorCQlpZiAoSVNfSEFTV0VMTChp
OTE1KSkKIAkJCXBpcGVfY29uZmlnLT5pcHNfZW5hYmxlZCA9IEk5MTVfUkVBRChJUFNfQ1RMKSAm
IElQU19FTkFCTEU7CiAJCWVsc2UgewogCQkJLyoKQEAgLTEwMzI0LDcgKzEwMzI0LDcgQEAgc3Rh
dGljIGJvb2wgaGFzd2VsbF9nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMs
CiAKIG91dDoKIAlmb3JfZWFjaF9wb3dlcl9kb21haW4ocG93ZXJfZG9tYWluLCBwb3dlcl9kb21h
aW5fbWFzaykKLQkJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsCisJCWludGVsX2Rp
c3BsYXlfcG93ZXJfcHV0KGk5MTUsCiAJCQkJCXBvd2VyX2RvbWFpbiwgd2FrZXJlZnNbcG93ZXJf
ZG9tYWluXSk7CiAKIAlyZXR1cm4gYWN0aXZlOwpAQCAtMTAzMzIsMTMgKzEwMzMyLDEzIEBAIHN0
YXRpYyBib29sIGhhc3dlbGxfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCiBzdGF0aWMgdTMyIGludGVsX2N1cnNvcl9iYXNlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCXRvX2k5MTUocGxhbmVf
c3RhdGUtPmJhc2UucGxhbmUtPmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqID0gaW50ZWxfZmJfb2JqKGZiKTsKIAl1MzIgYmFzZTsKIAotCWlmIChJTlRFTF9J
TkZPKGRldl9wcml2KS0+ZGlzcGxheS5jdXJzb3JfbmVlZHNfcGh5c2ljYWwpCisJaWYgKElOVEVM
X0lORk8oaTkxNSktPmRpc3BsYXkuY3Vyc29yX25lZWRzX3BoeXNpY2FsKQogCQliYXNlID0gb2Jq
LT5waHlzX2hhbmRsZS0+YnVzYWRkcjsKIAllbHNlCiAJCWJhc2UgPSBpbnRlbF9wbGFuZV9nZ3R0
X29mZnNldChwbGFuZV9zdGF0ZSk7CkBAIC0xMDM0Niw3ICsxMDM0Niw3IEBAIHN0YXRpYyB1MzIg
aW50ZWxfY3Vyc29yX2Jhc2UoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIAliYXNlICs9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7CiAKIAkv
KiBJTEsrIGRvIHRoaXMgYXV0b21hZ2ljYWxseSAqLwotCWlmIChIQVNfR01DSChkZXZfcHJpdikg
JiYKKwlpZiAoSEFTX0dNQ0goaTkxNSkgJiYKIAkgICAgcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRp
b24gJiBEUk1fTU9ERV9ST1RBVEVfMTgwKQogCQliYXNlICs9IChwbGFuZV9zdGF0ZS0+YmFzZS5j
cnRjX2ggKgogCQkJIHBsYW5lX3N0YXRlLT5iYXNlLmNydGNfdyAtIDEpICogZmItPmZvcm1hdC0+
Y3BwWzBdOwpAQCAtMTA1MzIsNyArMTA1MzIsNyBAQCBzdGF0aWMgdm9pZCBpODQ1X3VwZGF0ZV9j
dXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAl1MzIgY250bCA9IDAs
IGJhc2UgPSAwLCBwb3MgPSAwLCBzaXplID0gMDsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwog
CkBAIC0xMDU0OSw3ICsxMDU0OSw3IEBAIHN0YXRpYyB2b2lkIGk4NDVfdXBkYXRlX2N1cnNvcihz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQlwb3MgPSBpbnRlbF9jdXJzb3JfcG9zaXRpb24o
cGxhbmVfc3RhdGUpOwogCX0KIAotCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3Jl
LmxvY2ssIGlycWZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+dW5jb3JlLmxvY2ss
IGlycWZsYWdzKTsKIAogCS8qIE9uIHRoZXNlIGNoaXBzZXRzIHdlIGNhbiBvbmx5IG1vZGlmeSB0
aGUgYmFzZS9zaXplL3N0cmlkZQogCSAqIHdoaWxzdCB0aGUgY3Vyc29yIGlzIGRpc2FibGVkLgpA
QCAtMTA1NzAsNyArMTA1NzAsNyBAQCBzdGF0aWMgdm9pZCBpODQ1X3VwZGF0ZV9jdXJzb3Ioc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJSTkxNV9XUklURV9GVyhDVVJQT1MoUElQRV9BKSwg
cG9zKTsKIAl9CiAKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxv
Y2ssIGlycWZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT51bmNvcmUubG9j
aywgaXJxZmxhZ3MpOwogfQogCiBzdGF0aWMgdm9pZCBpODQ1X2Rpc2FibGVfY3Vyc29yKHN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUsCkBAIC0xMDU4MiwxMyArMTA1ODIsMTMgQEAgc3RhdGljIHZv
aWQgaTg0NV9kaXNhYmxlX2N1cnNvcihzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogc3RhdGlj
IGJvb2wgaTg0NV9jdXJzb3JfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUs
CiAJCQkJICAgICBlbnVtIHBpcGUgKnBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWVudW0gaW50ZWxfZGlz
cGxheV9wb3dlcl9kb21haW4gcG93ZXJfZG9tYWluOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVm
OwogCWJvb2wgcmV0OwogCiAJcG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlOX1BJUEUoUElQRV9B
KTsKLQl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZfcHJp
diwgcG93ZXJfZG9tYWluKTsKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZf
ZW5hYmxlZChpOTE1LCBwb3dlcl9kb21haW4pOwogCWlmICghd2FrZXJlZikKIAkJcmV0dXJuIGZh
bHNlOwogCkBAIC0xMDU5Niw3ICsxMDU5Niw3IEBAIHN0YXRpYyBib29sIGk4NDVfY3Vyc29yX2dl
dF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCiAJKnBpcGUgPSBQSVBFX0E7
CiAKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgcG93ZXJfZG9tYWluLCB3YWtl
cmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBwb3dlcl9kb21haW4sIHdha2Vy
ZWYpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTEwNjEyLDEwICsxMDYxMiwxMCBAQCBpOXh4X2N1
cnNvcl9tYXhfc3RyaWRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiBzdGF0aWMgdTMyIGk5
eHhfY3Vyc29yX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyIGNudGwgPSAwOwogCi0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJcmV0dXJu
IGNudGw7CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlKQpAQCAtMTA2MjQsNyArMTA2
MjQsNyBAQCBzdGF0aWMgdTMyIGk5eHhfY3Vyc29yX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChjcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQog
CQljbnRsIHw9IE1DVVJTT1JfUElQRV9DU0NfRU5BQkxFOwogCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPCA1ICYmICFJU19HNFgoZGV2X3ByaXYpKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA1
ICYmICFJU19HNFgoaTkxNSkpCiAJCWNudGwgfD0gTUNVUlNPUl9QSVBFX1NFTEVDVChjcnRjLT5w
aXBlKTsKIAogCXJldHVybiBjbnRsOwpAQCAtMTA2MzMsMTEgKzEwNjMzLDExIEBAIHN0YXRpYyB1
MzIgaTl4eF9jdXJzb3JfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiBzdGF0aWMgdTMyIGk5eHhfY3Vyc29yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUtPmRldik7CiAJdTMyIGNudGwgPSAwOwogCi0JaWYgKElTX0dFTihkZXZf
cHJpdiwgNikgfHwgSVNfSVZZQlJJREdFKGRldl9wcml2KSkKKwlpZiAoSVNfR0VOKGk5MTUsIDYp
IHx8IElTX0lWWUJSSURHRShpOTE1KSkKIAkJY250bCB8PSBNQ1VSU09SX1RSSUNLTEVfRkVFRF9E
SVNBQkxFOwogCiAJc3dpdGNoIChwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3cpIHsKQEAgLTEwNjYz
LDcgKzEwNjYzLDcgQEAgc3RhdGljIHUzMiBpOXh4X2N1cnNvcl9jdGwoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIHN0YXRpYyBib29sIGk5eHhfY3Vyc29yX3Np
emVfb2soY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0KIAkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKIAlp
bnQgd2lkdGggPSBwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3c7CiAJaW50IGhlaWdodCA9IHBsYW5l
X3N0YXRlLT5iYXNlLmNydGNfaDsKQEAgLTEwNjg3LDcgKzEwNjg3LDcgQEAgc3RhdGljIGJvb2wg
aTl4eF9jdXJzb3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogCSAqIGN1cnNvciBpcyBub3Qgcm90YXRlZC4gRXZlcnl0aGluZyBlbHNlIHJlcXVp
cmVzIHNxdWFyZQogCSAqIGN1cnNvcnMuCiAJICovCi0JaWYgKEhBU19DVVJfRkJDKGRldl9wcml2
KSAmJgorCWlmIChIQVNfQ1VSX0ZCQyhpOTE1KSAmJgogCSAgICBwbGFuZV9zdGF0ZS0+YmFzZS5y
b3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV8wKSB7CiAJCWlmIChoZWlnaHQgPCA4IHx8IGhlaWdo
dCA+IHdpZHRoKQogCQkJcmV0dXJuIGZhbHNlOwpAQCAtMTA3MDMsNyArMTA3MDMsNyBAQCBzdGF0
aWMgaW50IGk5eHhfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewog
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
YmFzZS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShwbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsK
IAlpbnQgcmV0OwpAQCAtMTA3NDMsNyArMTA3NDMsNyBAQCBzdGF0aWMgaW50IGk5eHhfY2hlY2tf
Y3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAqIGRpc3BsYXkg
cG93ZXIgd2VsbCBtdXN0IGJlIHR1cm5lZCBvZmYgYW5kIG9uIGFnYWluLgogCSAqIFJlZnVzZSB0
aGUgcHV0IHRoZSBjdXJzb3IgaW50byB0aGF0IGNvbXByb21pc2VkIHBvc2l0aW9uLgogCSAqLwot
CWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSAmJiBwaXBlID09IFBJUEVfQyAmJgorCWlmIChJ
U19DSEVSUllWSUVXKGk5MTUpICYmIHBpcGUgPT0gUElQRV9DICYmCiAJICAgIHBsYW5lX3N0YXRl
LT5iYXNlLnZpc2libGUgJiYgcGxhbmVfc3RhdGUtPmJhc2UuY3J0Y194IDwgMCkgewogCQlEUk1f
REVCVUdfS01TKCJDSFYgY3Vyc29yIEMgbm90IGFsbG93ZWQgdG8gc3RyYWRkbGUgdGhlIGxlZnQg
c2NyZWVuIGVkZ2VcbiIpOwogCQlyZXR1cm4gLUVJTlZBTDsKQEAgLTEwNzU4LDcgKzEwNzU4LDcg
QEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfY3Vyc29yKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5l
LT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAl1MzIgY250bCA9
IDAsIGJhc2UgPSAwLCBwb3MgPSAwLCBmYmNfY3RsID0gMDsKIAl1bnNpZ25lZCBsb25nIGlycWZs
YWdzOwpAQCAtMTA3NzQsNyArMTA3NzQsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9jdXJz
b3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJcG9zID0gaW50ZWxfY3Vyc29yX3Bvc2l0
aW9uKHBsYW5lX3N0YXRlKTsKIAl9CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVu
Y29yZS5sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPnVuY29yZS5s
b2NrLCBpcnFmbGFncyk7CiAKIAkvKgogCSAqIE9uIHNvbWUgcGxhdGZvcm1zIHdyaXRpbmcgQ1VS
Q05UUiBmaXJzdCB3aWxsIGFsc28KQEAgLTEwNzk2LDEzICsxMDc5NiwxMyBAQCBzdGF0aWMgdm9p
ZCBpOXh4X3VwZGF0ZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkgKiB0aGUg
Q1VSQ05UUiB3cml0ZSBhcm1zIHRoZSB1cGRhdGUuCiAJICovCiAKLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSA5KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJc2tsX3dyaXRlX2N1
cnNvcl93bShwbGFuZSwgY3J0Y19zdGF0ZSk7CiAKIAlpZiAocGxhbmUtPmN1cnNvci5iYXNlICE9
IGJhc2UgfHwKIAkgICAgcGxhbmUtPmN1cnNvci5zaXplICE9IGZiY19jdGwgfHwKIAkgICAgcGxh
bmUtPmN1cnNvci5jbnRsICE9IGNudGwpIHsKLQkJaWYgKEhBU19DVVJfRkJDKGRldl9wcml2KSkK
KwkJaWYgKEhBU19DVVJfRkJDKGk5MTUpKQogCQkJSTkxNV9XUklURV9GVyhDVVJfRkJDX0NUTChw
aXBlKSwgZmJjX2N0bCk7CiAJCUk5MTVfV1JJVEVfRlcoQ1VSQ05UUihwaXBlKSwgY250bCk7CiAJ
CUk5MTVfV1JJVEVfRlcoQ1VSUE9TKHBpcGUpLCBwb3MpOwpAQCAtMTA4MTYsNyArMTA4MTYsNyBA
QCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSwKIAkJSTkxNV9XUklURV9GVyhDVVJCQVNFKHBpcGUpLCBiYXNlKTsKIAl9CiAKLQlzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKwlzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogfQogCiBz
dGF0aWMgdm9pZCBpOXh4X2Rpc2FibGVfY3Vyc29yKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUs
CkBAIC0xMDgyOCw3ICsxMDgyOCw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfZGlzYWJsZV9jdXJzb3Io
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIHN0YXRpYyBib29sIGk5eHhfY3Vyc29yX2dldF9o
d19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkJCSAgICAgZW51bSBwaXBlICpw
aXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxh
bmUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
cGxhbmUtPmJhc2UuZGV2KTsKIAllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIHBvd2Vy
X2RvbWFpbjsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlib29sIHJldDsKQEAgLTEwODQw
LDcgKzEwODQwLDcgQEAgc3RhdGljIGJvb2wgaTl4eF9jdXJzb3JfZ2V0X2h3X3N0YXRlKHN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJICogZGlzcGxheSBwb3dlciB3ZWxscy4KIAkgKi8KIAlw
b3dlcl9kb21haW4gPSBQT1dFUl9ET01BSU5fUElQRShwbGFuZS0+cGlwZSk7Ci0Jd2FrZXJlZiA9
IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsIHBvd2VyX2RvbWFp
bik7CisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwg
cG93ZXJfZG9tYWluKTsKIAlpZiAoIXdha2VyZWYpCiAJCXJldHVybiBmYWxzZTsKIApAQCAtMTA4
NDgsMTMgKzEwODQ4LDEzIEBAIHN0YXRpYyBib29sIGk5eHhfY3Vyc29yX2dldF9od19zdGF0ZShz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCiAJcmV0ID0gdmFsICYgTUNVUlNPUl9NT0RFOwog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSB8fCBJU19HNFgoZGV2X3ByaXYpKQorCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gNSB8fCBJU19HNFgoaTkxNSkpCiAJCSpwaXBlID0gcGxhbmUt
PnBpcGU7CiAJZWxzZQogCQkqcGlwZSA9ICh2YWwgJiBNQ1VSU09SX1BJUEVfU0VMRUNUX01BU0sp
ID4+CiAJCQlNQ1VSU09SX1BJUEVfU0VMRUNUX1NISUZUOwogCi0JaW50ZWxfZGlzcGxheV9wb3dl
cl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9w
b3dlcl9wdXQoaTkxNSwgcG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKIAogCXJldHVybiByZXQ7CiB9
CkBAIC0xMDkyNCw3ICsxMDkyNCw3IEBAIGludCBpbnRlbF9nZXRfbG9hZF9kZXRlY3RfcGlwZShz
dHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5j
b2RlciA9ICZpbnRlbF9lbmNvZGVyLT5iYXNlOwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IE5V
TEw7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmRldjsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9tb2RlX2NvbmZpZyAq
Y29uZmlnID0gJmRldi0+bW9kZV9jb25maWc7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlID0gTlVMTCwgKnJlc3RvcmVfc3RhdGUgPSBOVUxMOwogCXN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpjb25uZWN0b3Jfc3RhdGU7CkBAIC0xMTA1MSw3ICsxMTA1MSw3IEBAIGludCBpbnRl
bF9nZXRfbG9hZF9kZXRlY3RfcGlwZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAog
CWRybV9hdG9taWNfc3RhdGVfcHV0KHN0YXRlKTsKIAogCS8qIGxldCB0aGUgY29ubmVjdG9yIGdl
dCB0aHJvdWdoIG9uZSBmdWxsIGN5Y2xlIGJlZm9yZSB0ZXN0aW5nICovCi0JaW50ZWxfd2FpdF9m
b3JfdmJsYW5rKGRldl9wcml2LCBpbnRlbF9jcnRjLT5waXBlKTsKKwlpbnRlbF93YWl0X2Zvcl92
YmxhbmsoaTkxNSwgaW50ZWxfY3J0Yy0+cGlwZSk7CiAJcmV0dXJuIHRydWU7CiAKIGZhaWw6CkBA
IC0xMTA5NiwxNCArMTEwOTYsMTQgQEAgdm9pZCBpbnRlbF9yZWxlYXNlX2xvYWRfZGV0ZWN0X3Bp
cGUoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIHN0YXRpYyBpbnQgaTl4eF9wbGxf
cmVmY2xrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShkZXYpOwogCXUzMiBkcGxsID0gcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBs
bDsKIAogCWlmICgoZHBsbCAmIFBMTF9SRUZfSU5QVVRfTUFTSykgPT0gUExMQl9SRUZfSU5QVVRf
U1BSRUFEU1BFQ1RSVU1JTikKLQkJcmV0dXJuIGRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcTsK
LQllbHNlIGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkKKwkJcmV0dXJuIGk5MTUtPnZidC5s
dmRzX3NzY19mcmVxOworCWVsc2UgaWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkpCiAJCXJldHVybiAx
MjAwMDA7Ci0JZWxzZSBpZiAoIUlTX0dFTihkZXZfcHJpdiwgMikpCisJZWxzZSBpZiAoIUlTX0dF
TihpOTE1LCAyKSkKIAkJcmV0dXJuIDk2MDAwOwogCWVsc2UKIAkJcmV0dXJuIDQ4MDAwOwpAQCAt
MTExMTQsNyArMTExMTQsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2NydGNfY2xvY2tfZ2V0KHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWludCBwaXBlID0gcGlwZV9j
b25maWctPmNwdV90cmFuc2NvZGVyOwogCXUzMiBkcGxsID0gcGlwZV9jb25maWctPmRwbGxfaHdf
c3RhdGUuZHBsbDsKIAl1MzIgZnA7CkBAIC0xMTEyOCw3ICsxMTEyOCw3IEBAIHN0YXRpYyB2b2lk
IGk5eHhfY3J0Y19jbG9ja19nZXQoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCWZwID0gcGlw
ZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZnAxOwogCiAJY2xvY2subTEgPSAoZnAgJiBGUF9NMV9E
SVZfTUFTSykgPj4gRlBfTTFfRElWX1NISUZUOwotCWlmIChJU19QSU5FVklFVyhkZXZfcHJpdikp
IHsKKwlpZiAoSVNfUElORVZJRVcoaTkxNSkpIHsKIAkJY2xvY2subiA9IGZmcygoZnAgJiBGUF9O
X1BJTkVWSUVXX0RJVl9NQVNLKSA+PiBGUF9OX0RJVl9TSElGVCkgLSAxOwogCQljbG9jay5tMiA9
IChmcCAmIEZQX00yX1BJTkVWSUVXX0RJVl9NQVNLKSA+PiBGUF9NMl9ESVZfU0hJRlQ7CiAJfSBl
bHNlIHsKQEAgLTExMTM2LDggKzExMTM2LDggQEAgc3RhdGljIHZvaWQgaTl4eF9jcnRjX2Nsb2Nr
X2dldChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJY2xvY2subTIgPSAoZnAgJiBGUF9NMl9E
SVZfTUFTSykgPj4gRlBfTTJfRElWX1NISUZUOwogCX0KIAotCWlmICghSVNfR0VOKGRldl9wcml2
LCAyKSkgewotCQlpZiAoSVNfUElORVZJRVcoZGV2X3ByaXYpKQorCWlmICghSVNfR0VOKGk5MTUs
IDIpKSB7CisJCWlmIChJU19QSU5FVklFVyhpOTE1KSkKIAkJCWNsb2NrLnAxID0gZmZzKChkcGxs
ICYgRFBMTF9GUEEwMV9QMV9QT1NUX0RJVl9NQVNLX1BJTkVWSUVXKSA+PgogCQkJCURQTExfRlBB
MDFfUDFfUE9TVF9ESVZfU0hJRlRfUElORVZJRVcpOwogCQllbHNlCkBAIC0xMTE1OSwxMiArMTEx
NTksMTIgQEAgc3RhdGljIHZvaWQgaTl4eF9jcnRjX2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKIAkJCXJldHVybjsKIAkJfQogCi0JCWlmIChJU19QSU5FVklFVyhkZXZfcHJpdikp
CisJCWlmIChJU19QSU5FVklFVyhpOTE1KSkKIAkJCXBvcnRfY2xvY2sgPSBwbnZfY2FsY19kcGxs
X3BhcmFtcyhyZWZjbGssICZjbG9jayk7CiAJCWVsc2UKIAkJCXBvcnRfY2xvY2sgPSBpOXh4X2Nh
bGNfZHBsbF9wYXJhbXMocmVmY2xrLCAmY2xvY2spOwogCX0gZWxzZSB7Ci0JCXUzMiBsdmRzID0g
SVNfSTgzMChkZXZfcHJpdikgPyAwIDogSTkxNV9SRUFEKExWRFMpOworCQl1MzIgbHZkcyA9IElT
X0k4MzAoaTkxNSkgPyAwIDogSTkxNV9SRUFEKExWRFMpOwogCQlib29sIGlzX2x2ZHMgPSAocGlw
ZSA9PSAxKSAmJiAobHZkcyAmIExWRFNfUE9SVF9FTik7CiAKIAkJaWYgKGlzX2x2ZHMpIHsKQEAg
LTExMjIxLDcgKzExMjIxLDcgQEAgaW50IGludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShpbnQgbGlu
a19mcmVxLAogc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAogCS8qIHJlYWQgb3V0IHBvcnRfY2xvY2sgZnJvbSB0aGUgRFBMTCAqLwog
CWk5eHhfY3J0Y19jbG9ja19nZXQoY3J0YywgcGlwZV9jb25maWcpOwpAQCAtMTEyMzIsNyArMTEy
MzIsNyBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9wY2hfY2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCSAqIENhbGN1bGF0ZSBvbmUgYmFzZWQgb24gdGhlIEZESSBjb25maWd1cmF0
aW9uLgogCSAqLwogCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9
Ci0JCWludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShpbnRlbF9mZGlfbGlua19mcmVxKGRldl9wcml2
LCBwaXBlX2NvbmZpZyksCisJCWludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShpbnRlbF9mZGlfbGlu
a19mcmVxKGk5MTUsIHBpcGVfY29uZmlnKSwKIAkJCQkJICZwaXBlX2NvbmZpZy0+ZmRpX21fbik7
CiB9CiAKQEAgLTExMjQwLDcgKzExMjQwLDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX2Ns
b2NrX2dldChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICoKIGludGVsX2VuY29kZXJfY3VycmVudF9tb2RlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGU7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGU7CiAJc3RydWN0IGludGVsX2NydGMg
KmNydGM7CkBAIC0xMTI0OSw3ICsxMTI0OSw3IEBAIGludGVsX2VuY29kZXJfY3VycmVudF9tb2Rl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCWlmICghZW5jb2Rlci0+Z2V0X2h3X3N0
YXRlKGVuY29kZXIsICZwaXBlKSkKIAkJcmV0dXJuIE5VTEw7CiAKLQljcnRjID0gaW50ZWxfZ2V0
X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOworCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19m
b3JfcGlwZShpOTE1LCBwaXBlKTsKIAogCW1vZGUgPSBremFsbG9jKHNpemVvZigqbW9kZSksIEdG
UF9LRVJORUwpOwogCWlmICghbW9kZSkKQEAgLTExMjYzLDcgKzExMjYzLDcgQEAgaW50ZWxfZW5j
b2Rlcl9jdXJyZW50X21vZGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIAljcnRj
X3N0YXRlLT5iYXNlLmNydGMgPSAmY3J0Yy0+YmFzZTsKIAotCWlmICghZGV2X3ByaXYtPmRpc3Bs
YXkuZ2V0X3BpcGVfY29uZmlnKGNydGMsIGNydGNfc3RhdGUpKSB7CisJaWYgKCFpOTE1LT5kaXNw
bGF5LmdldF9waXBlX2NvbmZpZyhjcnRjLCBjcnRjX3N0YXRlKSkgewogCQlrZnJlZShjcnRjX3N0
YXRlKTsKIAkJa2ZyZWUobW9kZSk7CiAJCXJldHVybiBOVUxMOwpAQCAtMTEzMzcsNyArMTEzMzcs
NyBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdlcyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0g
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gY3J0Yy0+ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2
KTsKIAlib29sIG1vZGVfY2hhbmdlZCA9IG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSk7CiAJYm9v
bCB3YXNfY3J0Y19lbmFibGVkID0gb2xkX2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlOwogCWJvb2wg
aXNfY3J0Y19lbmFibGVkID0gY3J0Y19zdGF0ZS0+YWN0aXZlOwpAQCAtMTEzNDUsNyArMTEzNDUs
NyBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdlcyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmZiOwogCWludCByZXQ7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA5ICYmIHBsYW5lLT5pZCAhPSBQTEFORV9DVVJTT1IpIHsKKwlpZiAoSU5URUxfR0VOKGk5
MTUpID49IDkgJiYgcGxhbmUtPmlkICE9IFBMQU5FX0NVUlNPUikgewogCQlyZXQgPSBza2xfdXBk
YXRlX3NjYWxlcl9wbGFuZSgKIAkJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Y19zdGF0ZSksCiAJ
CQl0b19pbnRlbF9wbGFuZV9zdGF0ZShwbGFuZV9zdGF0ZSkpOwpAQCAtMTEzOTUsMTQgKzExMzk1
LDE0IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0CiAJCQkgdHVybl9vZmYsIHR1cm5fb24sIG1v
ZGVfY2hhbmdlZCk7CiAKIAlpZiAodHVybl9vbikgewotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA8IDUgJiYgIUlTX0c0WChkZXZfcHJpdikpCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA1ICYm
ICFJU19HNFgoaTkxNSkpCiAJCQlwaXBlX2NvbmZpZy0+dXBkYXRlX3dtX3ByZSA9IHRydWU7CiAK
IAkJLyogbXVzdCBkaXNhYmxlIGN4c3IgYXJvdW5kIHBsYW5lIGVuYWJsZS9kaXNhYmxlICovCiAJ
CWlmIChwbGFuZS0+aWQgIT0gUExBTkVfQ1VSU09SKQogCQkJcGlwZV9jb25maWctPmRpc2FibGVf
Y3hzciA9IHRydWU7CiAJfSBlbHNlIGlmICh0dXJuX29mZikgewotCQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA8IDUgJiYgIUlTX0c0WChkZXZfcHJpdikpCisJCWlmIChJTlRFTF9HRU4oaTkxNSkg
PCA1ICYmICFJU19HNFgoaTkxNSkpCiAJCQlwaXBlX2NvbmZpZy0+dXBkYXRlX3dtX3Bvc3QgPSB0
cnVlOwogCiAJCS8qIG11c3QgZGlzYWJsZSBjeHNyIGFyb3VuZCBwbGFuZSBlbmFibGUvZGlzYWJs
ZSAqLwpAQCAtMTE0MTAsNyArMTE0MTAsNyBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNf
Y2hhbmdlcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCQkJ
cGlwZV9jb25maWctPmRpc2FibGVfY3hzciA9IHRydWU7CiAJfSBlbHNlIGlmIChpbnRlbF93bV9u
ZWVkX3VwZGF0ZSh0b19pbnRlbF9wbGFuZV9zdGF0ZShwbGFuZS0+YmFzZS5zdGF0ZSksCiAJCQkJ
CXRvX2ludGVsX3BsYW5lX3N0YXRlKHBsYW5lX3N0YXRlKSkpIHsKLQkJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPCA1ICYmICFJU19HNFgoZGV2X3ByaXYpKSB7CisJCWlmIChJTlRFTF9HRU4oaTkx
NSkgPCA1ICYmICFJU19HNFgoaTkxNSkpIHsKIAkJCS8qIEZJWE1FIGJvbGxvY2tzICovCiAJCQlw
aXBlX2NvbmZpZy0+dXBkYXRlX3dtX3ByZSA9IHRydWU7CiAJCQlwaXBlX2NvbmZpZy0+dXBkYXRl
X3dtX3Bvc3QgPSB0cnVlOwpAQCAtMTE0NTQsOCArMTE0NTQsOCBAQCBpbnQgaW50ZWxfcGxhbmVf
YXRvbWljX2NhbGNfY2hhbmdlcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfc3RhdAogCSAqIHBsYW5lLCBub3Qgb25seSBzcHJpdGUgcGxhbmUuCiAJICovCiAJaWYgKHBs
YW5lLT5pZCAhPSBQTEFORV9DVVJTT1IgJiYKLQkgICAgKElTX0dFTl9SQU5HRShkZXZfcHJpdiwg
NSwgNikgfHwKLQkgICAgIElTX0lWWUJSSURHRShkZXZfcHJpdikpICYmCisJICAgIChJU19HRU5f
UkFOR0UoaTkxNSwgNSwgNikgfHwKKwkgICAgIElTX0lWWUJSSURHRShpOTE1KSkgJiYKIAkgICAg
KHR1cm5fb24gfHwgKCFuZWVkc19zY2FsaW5nKG9sZF9wbGFuZV9zdGF0ZSkgJiYKIAkJCSBuZWVk
c19zY2FsaW5nKHRvX2ludGVsX3BsYW5lX3N0YXRlKHBsYW5lX3N0YXRlKSkpKSkKIAkJcGlwZV9j
b25maWctPmRpc2FibGVfbHBfd20gPSB0cnVlOwpAQCAtMTE1MTksMTMgKzExNTE5LDEzIEBAIHN0
YXRpYyBpbnQgaWNsX2FkZF9saW5rZWRfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogc3RhdGljIGludCBpY2xfY2hlY2tfbnYxMl9wbGFuZXMoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5i
YXNlLnN0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLCAqbGlua2VkOwogCXN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CiAJaW50IGk7CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA8IDExKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPCAxMSkKIAkJcmV0dXJu
IDA7CiAKIAkvKgpAQCAtMTE1NTUsNyArMTE1NTUsNyBAQCBzdGF0aWMgaW50IGljbF9jaGVja19u
djEyX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJICAgICEo
Y3J0Y19zdGF0ZS0+bnYxMl9wbGFuZXMgJiBCSVQocGxhbmUtPmlkKSkpCiAJCQljb250aW51ZTsK
IAotCQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjLCBs
aW5rZWQpIHsKKwkJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmaTkxNS0+ZHJtLCBjcnRj
LCBsaW5rZWQpIHsKIAkJCWlmICghaWNsX2lzX252MTJfeV9wbGFuZShsaW5rZWQtPmlkKSkKIAkJ
CQljb250aW51ZTsKIApAQCAtMTE2MDIsMjEgKzExNjAyLDIxIEBAIHN0YXRpYyBib29sIGM4X3Bs
YW5lc19jaGFuZ2VkKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0
ZSkKIHN0YXRpYyBpbnQgaW50ZWxfY3J0Y19hdG9taWNfY2hlY2soc3RydWN0IGRybV9jcnRjICpj
cnRjLAogCQkJCSAgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwogCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZyA9CiAJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0
Y19zdGF0ZSk7CiAJaW50IHJldDsKIAlib29sIG1vZGVfY2hhbmdlZCA9IG5lZWRzX21vZGVzZXQo
Y3J0Y19zdGF0ZSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDUgJiYgIUlTX0c0WChk
ZXZfcHJpdikgJiYKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNSAmJiAhSVNfRzRYKGk5MTUpICYm
CiAJICAgIG1vZGVfY2hhbmdlZCAmJiAhY3J0Y19zdGF0ZS0+YWN0aXZlKQogCQlwaXBlX2NvbmZp
Zy0+dXBkYXRlX3dtX3Bvc3QgPSB0cnVlOwogCiAJaWYgKG1vZGVfY2hhbmdlZCAmJiBjcnRjX3N0
YXRlLT5lbmFibGUgJiYKLQkgICAgZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2Nr
ICYmCisJICAgIGk5MTUtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrICYmCiAJICAgICFXQVJO
X09OKHBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCkpIHsKLQkJcmV0ID0gZGV2X3ByaXYtPmRpc3Bs
YXkuY3J0Y19jb21wdXRlX2Nsb2NrKGludGVsX2NydGMsCisJCXJldCA9IGk5MTUtPmRpc3BsYXku
Y3J0Y19jb21wdXRlX2Nsb2NrKGludGVsX2NydGMsCiAJCQkJCQkJICAgcGlwZV9jb25maWcpOwog
CQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKQEAgLTExNjM3LDE2ICsxMTYzNywxNiBAQCBzdGF0
aWMgaW50IGludGVsX2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAl9
CiAKIAlyZXQgPSAwOwotCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5jb21wdXRlX3BpcGVfd20pIHsK
LQkJcmV0ID0gZGV2X3ByaXYtPmRpc3BsYXkuY29tcHV0ZV9waXBlX3dtKHBpcGVfY29uZmlnKTsK
KwlpZiAoaTkxNS0+ZGlzcGxheS5jb21wdXRlX3BpcGVfd20pIHsKKwkJcmV0ID0gaTkxNS0+ZGlz
cGxheS5jb21wdXRlX3BpcGVfd20ocGlwZV9jb25maWcpOwogCQlpZiAocmV0KSB7CiAJCQlEUk1f
REVCVUdfS01TKCJUYXJnZXQgcGlwZSB3YXRlcm1hcmtzIGFyZSBpbnZhbGlkXG4iKTsKIAkJCXJl
dHVybiByZXQ7CiAJCX0KIAl9CiAKLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuY29tcHV0ZV9pbnRl
cm1lZGlhdGVfd20pIHsKLQkJaWYgKFdBUk5fT04oIWRldl9wcml2LT5kaXNwbGF5LmNvbXB1dGVf
cGlwZV93bSkpCisJaWYgKGk5MTUtPmRpc3BsYXkuY29tcHV0ZV9pbnRlcm1lZGlhdGVfd20pIHsK
KwkJaWYgKFdBUk5fT04oIWk5MTUtPmRpc3BsYXkuY29tcHV0ZV9waXBlX3dtKSkKIAkJCXJldHVy
biAwOwogCiAJCS8qCkBAIC0xMTY1NCwxNCArMTE2NTQsMTQgQEAgc3RhdGljIGludCBpbnRlbF9j
cnRjX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCSAqIG9sZCBzdGF0ZSBh
bmQgdGhlIG5ldyBzdGF0ZS4gIFdlIGNhbiBwcm9ncmFtIHRoZXNlCiAJCSAqIGltbWVkaWF0ZWx5
LgogCQkgKi8KLQkJcmV0ID0gZGV2X3ByaXYtPmRpc3BsYXkuY29tcHV0ZV9pbnRlcm1lZGlhdGVf
d20ocGlwZV9jb25maWcpOworCQlyZXQgPSBpOTE1LT5kaXNwbGF5LmNvbXB1dGVfaW50ZXJtZWRp
YXRlX3dtKHBpcGVfY29uZmlnKTsKIAkJaWYgKHJldCkgewogCQkJRFJNX0RFQlVHX0tNUygiTm8g
dmFsaWQgaW50ZXJtZWRpYXRlIHBpcGUgd2F0ZXJtYXJrcyBhcmUgcG9zc2libGVcbiIpOwogCQkJ
cmV0dXJuIHJldDsKIAkJfQogCX0KIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpIHsK
KwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsKIAkJaWYgKG1vZGVfY2hhbmdlZCB8fCBwaXBl
X2NvbmZpZy0+dXBkYXRlX3BpcGUpCiAJCQlyZXQgPSBza2xfdXBkYXRlX3NjYWxlcl9jcnRjKHBp
cGVfY29uZmlnKTsKIApAQCAtMTE2NzEsMTEgKzExNjcxLDExIEBAIHN0YXRpYyBpbnQgaW50ZWxf
Y3J0Y19hdG9taWNfY2hlY2soc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJcmV0ID0gc2tsX2No
ZWNrX3BpcGVfbWF4X3BpeGVsX3JhdGUoaW50ZWxfY3J0YywKIAkJCQkJCQkgICAgcGlwZV9jb25m
aWcpOwogCQlpZiAoIXJldCkKLQkJCXJldCA9IGludGVsX2F0b21pY19zZXR1cF9zY2FsZXJzKGRl
dl9wcml2LCBpbnRlbF9jcnRjLAorCQkJcmV0ID0gaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcnMo
aTkxNSwgaW50ZWxfY3J0YywKIAkJCQkJCQkgcGlwZV9jb25maWcpOwogCX0KIAotCWlmIChIQVNf
SVBTKGRldl9wcml2KSkKKwlpZiAoSEFTX0lQUyhpOTE1KSkKIAkJcGlwZV9jb25maWctPmlwc19l
bmFibGVkID0gaHN3X2NvbXB1dGVfaXBzX2NvbmZpZyhwaXBlX2NvbmZpZyk7CiAKIAlyZXR1cm4g
cmV0OwpAQCAtMTE3NTIsMTYgKzExNzUyLDE2IEBAIHN0YXRpYyBpbnQKIGNvbXB1dGVfYmFzZWxp
bmVfcGlwZV9icHAoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgIHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fYXRvbWljX3N0
YXRlICpzdGF0ZSA9IHBpcGVfY29uZmlnLT5iYXNlLnN0YXRlOwogCXN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rvcl9z
dGF0ZTsKIAlpbnQgYnBwLCBpOwogCi0JaWYgKChJU19HNFgoZGV2X3ByaXYpIHx8IElTX1ZBTExF
WVZJRVcoZGV2X3ByaXYpIHx8Ci0JICAgIElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSkKKwlpZiAo
KElTX0c0WChpOTE1KSB8fCBJU19WQUxMRVlWSUVXKGk5MTUpIHx8CisJICAgIElTX0NIRVJSWVZJ
RVcoaTkxNSkpKQogCQlicHAgPSAxMCozOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gNSkKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJYnBwID0gMTIqMzsKIAll
bHNlCiAJCWJwcCA9IDgqMzsKQEAgLTExODA3LDEzICsxMTgwNywxMyBAQCBpbnRlbF9kdW1wX21f
bl9jb25maWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogfQog
CiBzdGF0aWMgdm9pZAotaW50ZWxfZHVtcF9pbmZvZnJhbWUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAoraW50ZWxfZHVtcF9pbmZvZnJhbWUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCSAgICAgY29uc3QgdW5pb24gaGRtaV9pbmZvZnJhbWUgKmZyYW1lKQogewog
CWlmICgoZHJtX2RlYnVnICYgRFJNX1VUX0tNUykgPT0gMCkKIAkJcmV0dXJuOwogCi0JaGRtaV9p
bmZvZnJhbWVfbG9nKEtFUk5fREVCVUcsIGRldl9wcml2LT5kcm0uZGV2LCBmcmFtZSk7CisJaGRt
aV9pbmZvZnJhbWVfbG9nKEtFUk5fREVCVUcsIGk5MTUtPmRybS5kZXYsIGZyYW1lKTsKIH0KIAog
I2RlZmluZSBPVVRQVVRfVFlQRSh4KSBbSU5URUxfT1VUUFVUXyAjIyB4XSA9ICN4CkBAIC0xMTkw
Nyw3ICsxMTkwNyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGlwZV9jb25maWcoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCSAgIGNvbnN0IGNoYXIg
KmNvbnRleHQpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBp
cGVfY29uZmlnLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCWNoYXIg
YnVmWzY0XTsKQEAgLTExOTUzLDEzICsxMTk1MywxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kdW1w
X3BpcGVfY29uZmlnKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywK
IAkJRFJNX0RFQlVHX0tNUygiR0NQOiAweCV4XG4iLCBwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5n
Y3ApOwogCWlmIChwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5lbmFibGUgJgogCSAgICBpbnRlbF9o
ZG1pX2luZm9mcmFtZV9lbmFibGUoSERNSV9JTkZPRlJBTUVfVFlQRV9BVkkpKQotCQlpbnRlbF9k
dW1wX2luZm9mcmFtZShkZXZfcHJpdiwgJnBpcGVfY29uZmlnLT5pbmZvZnJhbWVzLmF2aSk7CisJ
CWludGVsX2R1bXBfaW5mb2ZyYW1lKGk5MTUsICZwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5hdmkp
OwogCWlmIChwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5lbmFibGUgJgogCSAgICBpbnRlbF9oZG1p
X2luZm9mcmFtZV9lbmFibGUoSERNSV9JTkZPRlJBTUVfVFlQRV9TUEQpKQotCQlpbnRlbF9kdW1w
X2luZm9mcmFtZShkZXZfcHJpdiwgJnBpcGVfY29uZmlnLT5pbmZvZnJhbWVzLnNwZCk7CisJCWlu
dGVsX2R1bXBfaW5mb2ZyYW1lKGk5MTUsICZwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5zcGQpOwog
CWlmIChwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5lbmFibGUgJgogCSAgICBpbnRlbF9oZG1pX2lu
Zm9mcmFtZV9lbmFibGUoSERNSV9JTkZPRlJBTUVfVFlQRV9WRU5ET1IpKQotCQlpbnRlbF9kdW1w
X2luZm9mcmFtZShkZXZfcHJpdiwgJnBpcGVfY29uZmlnLT5pbmZvZnJhbWVzLmhkbWkpOworCQlp
bnRlbF9kdW1wX2luZm9mcmFtZShpOTE1LCAmcGlwZV9jb25maWctPmluZm9mcmFtZXMuaGRtaSk7
CiAKIAlEUk1fREVCVUdfS01TKCJyZXF1ZXN0ZWQgbW9kZTpcbiIpOwogCWRybV9tb2RlX2RlYnVn
X3ByaW50bW9kZWxpbmUoJnBpcGVfY29uZmlnLT5iYXNlLm1vZGUpOwpAQCAtMTE5NzEsMTMgKzEx
OTcxLDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGlwZV9jb25maWcoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkgICAgICBwaXBlX2NvbmZpZy0+cGlw
ZV9zcmNfdywgcGlwZV9jb25maWctPnBpcGVfc3JjX2gsCiAJCSAgICAgIHBpcGVfY29uZmlnLT5w
aXhlbF9yYXRlKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYgKElOVEVM
X0dFTihpOTE1KSA+PSA5KQogCQlEUk1fREVCVUdfS01TKCJudW1fc2NhbGVyczogJWQsIHNjYWxl
cl91c2VyczogMHgleCwgc2NhbGVyX2lkOiAlZFxuIiwKIAkJCSAgICAgIGNydGMtPm51bV9zY2Fs
ZXJzLAogCQkJICAgICAgcGlwZV9jb25maWctPnNjYWxlcl9zdGF0ZS5zY2FsZXJfdXNlcnMsCiAJ
CSAgICAgICAgICAgICAgcGlwZV9jb25maWctPnNjYWxlcl9zdGF0ZS5zY2FsZXJfaWQpOwogCi0J
aWYgKEhBU19HTUNIKGRldl9wcml2KSkKKwlpZiAoSEFTX0dNQ0goaTkxNSkpCiAJCURSTV9ERUJV
R19LTVMoImdtY2ggcGZpdDogY29udHJvbDogMHglMDh4LCByYXRpb3M6IDB4JTA4eCwgbHZkcyBi
b3JkZXI6IDB4JTA4eFxuIiwKIAkJCSAgICAgIHBpcGVfY29uZmlnLT5nbWNoX3BmaXQuY29udHJv
bCwKIAkJCSAgICAgIHBpcGVfY29uZmlnLT5nbWNoX3BmaXQucGdtX3JhdGlvcywKQEAgLTExOTky
LDcgKzExOTkyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHVtcF9waXBlX2NvbmZpZyhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJRFJNX0RFQlVHX0tNUygiaXBz
OiAlaSwgZG91YmxlIHdpZGU6ICVpXG4iLAogCQkgICAgICBwaXBlX2NvbmZpZy0+aXBzX2VuYWJs
ZWQsIHBpcGVfY29uZmlnLT5kb3VibGVfd2lkZSk7CiAKLQlpbnRlbF9kcGxsX2R1bXBfaHdfc3Rh
dGUoZGV2X3ByaXYsICZwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZSk7CisJaW50ZWxfZHBsbF9k
dW1wX2h3X3N0YXRlKGk5MTUsICZwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZSk7CiAKIGR1bXBf
cGxhbmVzOgogCWlmICghc3RhdGUpCkBAIC0xMjA3Myw3ICsxMjA3Myw3IEBAIHN0YXRpYyBib29s
IGNoZWNrX2RpZ2l0YWxfcG9ydF9jb25mbGljdHMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiBzdGF0aWMgaW50CiBjbGVhcl9pbnRlbF9jcnRjX3N0YXRlKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQl0b19pOTE1KGNydGNf
c3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqc2F2ZWRf
c3RhdGU7CiAKQEAgLTEyMDkwLDggKzEyMDkwLDggQEAgY2xlYXJfaW50ZWxfY3J0Y19zdGF0ZShz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlzYXZlZF9zdGF0ZS0+c2hhcmVk
X2RwbGwgPSBjcnRjX3N0YXRlLT5zaGFyZWRfZHBsbDsKIAlzYXZlZF9zdGF0ZS0+ZHBsbF9od19z
dGF0ZSA9IGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGU7CiAJc2F2ZWRfc3RhdGUtPmNyY19lbmFi
bGVkID0gY3J0Y19zdGF0ZS0+Y3JjX2VuYWJsZWQ7Ci0JaWYgKElTX0c0WChkZXZfcHJpdikgfHwK
LQkgICAgSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikp
CisJaWYgKElTX0c0WChpOTE1KSB8fAorCSAgICBJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NI
RVJSWVZJRVcoaTkxNSkpCiAJCXNhdmVkX3N0YXRlLT53bSA9IGNydGNfc3RhdGUtPndtOwogCiAJ
LyogS2VlcCBiYXNlIGRybV9jcnRjX3N0YXRlIGludGFjdCwgb25seSBjbGVhciBvdXIgZXh0ZW5k
ZWQgc3RydWN0ICovCkBAIC0xMjMxNiw3ICsxMjMxNiw3IEBAIGludGVsX2NvbXBhcmVfaW5mb2Zy
YW1lKGNvbnN0IHVuaW9uIGhkbWlfaW5mb2ZyYW1lICphLAogfQogCiBzdGF0aWMgdm9pZAotcGlw
ZV9jb25maWdfaW5mb2ZyYW1lX2VycihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitwaXBlX2NvbmZpZ19pbmZvZnJhbWVfZXJyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICBib29sIGFkanVzdCwgY29uc3QgY2hhciAqbmFtZSwKIAkJCSAgY29uc3QgdW5pb24g
aGRtaV9pbmZvZnJhbWUgKmEsCiAJCQkgIGNvbnN0IHVuaW9uIGhkbWlfaW5mb2ZyYW1lICpiKQpA
QCAtMTIzMjcsMTUgKzEyMzI3LDE1IEBAIHBpcGVfY29uZmlnX2luZm9mcmFtZV9lcnIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJCWRybV9kYmcoRFJNX1VUX0tNUywgIm1p
c21hdGNoIGluICVzIGluZm9mcmFtZSIsIG5hbWUpOwogCQlkcm1fZGJnKERSTV9VVF9LTVMsICJl
eHBlY3RlZDoiKTsKLQkJaGRtaV9pbmZvZnJhbWVfbG9nKEtFUk5fREVCVUcsIGRldl9wcml2LT5k
cm0uZGV2LCBhKTsKKwkJaGRtaV9pbmZvZnJhbWVfbG9nKEtFUk5fREVCVUcsIGk5MTUtPmRybS5k
ZXYsIGEpOwogCQlkcm1fZGJnKERSTV9VVF9LTVMsICJmb3VuZCIpOwotCQloZG1pX2luZm9mcmFt
ZV9sb2coS0VSTl9ERUJVRywgZGV2X3ByaXYtPmRybS5kZXYsIGIpOworCQloZG1pX2luZm9mcmFt
ZV9sb2coS0VSTl9ERUJVRywgaTkxNS0+ZHJtLmRldiwgYik7CiAJfSBlbHNlIHsKIAkJZHJtX2Vy
cigibWlzbWF0Y2ggaW4gJXMgaW5mb2ZyYW1lIiwgbmFtZSk7CiAJCWRybV9lcnIoImV4cGVjdGVk
OiIpOwotCQloZG1pX2luZm9mcmFtZV9sb2coS0VSTl9FUlIsIGRldl9wcml2LT5kcm0uZGV2LCBh
KTsKKwkJaGRtaV9pbmZvZnJhbWVfbG9nKEtFUk5fRVJSLCBpOTE1LT5kcm0uZGV2LCBhKTsKIAkJ
ZHJtX2VycigiZm91bmQiKTsKLQkJaGRtaV9pbmZvZnJhbWVfbG9nKEtFUk5fRVJSLCBkZXZfcHJp
di0+ZHJtLmRldiwgYik7CisJCWhkbWlfaW5mb2ZyYW1lX2xvZyhLRVJOX0VSUiwgaTkxNS0+ZHJt
LmRldiwgYik7CiAJfQogfQogCkBAIC0xMjM1NywxNyArMTIzNTcsMTcgQEAgcGlwZV9jb25maWdf
ZXJyKGJvb2wgYWRqdXN0LCBjb25zdCBjaGFyICpuYW1lLCBjb25zdCBjaGFyICpmb3JtYXQsIC4u
LikKIAl2YV9lbmQoYXJncyk7CiB9CiAKLXN0YXRpYyBib29sIGZhc3Rib290X2VuYWJsZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGJvb2wgZmFzdGJvb3RfZW5h
YmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpZiAoaTkxNV9tb2RwYXJh
bXMuZmFzdGJvb3QgIT0gLTEpCiAJCXJldHVybiBpOTE1X21vZHBhcmFtcy5mYXN0Ym9vdDsKIAog
CS8qIEVuYWJsZSBmYXN0Ym9vdCBieSBkZWZhdWx0IG9uIFNreWxha2UgYW5kIG5ld2VyICovCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkp
CiAJCXJldHVybiB0cnVlOwogCiAJLyogRW5hYmxlIGZhc3Rib290IGJ5IGRlZmF1bHQgb24gVkxW
IGFuZCBDSFYgKi8KLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklF
VyhkZXZfcHJpdikpCisJaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhp
OTE1KSkKIAkJcmV0dXJuIHRydWU7CiAKIAkvKiBEaXNhYmxlZCBieSBkZWZhdWx0IG9uIGFsbCBv
dGhlcnMgKi8KQEAgLTEyMzc1LDcgKzEyMzc1LDcgQEAgc3RhdGljIGJvb2wgZmFzdGJvb3RfZW5h
YmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB9CiAKIHN0YXRpYyBib29s
Ci1pbnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK2ludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAkJ
CSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJICBib29sIGFkanVz
dCkKQEAgLTEyMzg1LDcgKzEyMzg1LDcgQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCShjdXJyZW50X2NvbmZpZy0+YmFzZS5t
b2RlLnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklURUQpICYmCiAJCSEocGlw
ZV9jb25maWctPmJhc2UubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJ
VEVEKTsKIAotCWlmIChmaXh1cF9pbmhlcml0ZWQgJiYgIWZhc3Rib290X2VuYWJsZWQoZGV2X3By
aXYpKSB7CisJaWYgKGZpeHVwX2luaGVyaXRlZCAmJiAhZmFzdGJvb3RfZW5hYmxlZChpOTE1KSkg
ewogCQlEUk1fREVCVUdfS01TKCJpbml0aWFsIG1vZGVzZXQgYW5kIGZhc3Rib290IG5vdCBzZXRc
biIpOwogCQlyZXQgPSBmYWxzZTsKIAl9CkBAIC0xMjUyNSw3ICsxMjUyNSw3IEBAIGludGVsX3Bp
cGVfY29uZmlnX2NvbXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogI2Rl
ZmluZSBQSVBFX0NPTkZfQ0hFQ0tfSU5GT0ZSQU1FKG5hbWUpIGRvIHsgXAogCWlmICghaW50ZWxf
Y29tcGFyZV9pbmZvZnJhbWUoJmN1cnJlbnRfY29uZmlnLT5pbmZvZnJhbWVzLm5hbWUsIFwKIAkJ
CQkgICAgICZwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5uYW1lKSkgeyBcCi0JCXBpcGVfY29uZmln
X2luZm9mcmFtZV9lcnIoZGV2X3ByaXYsIGFkanVzdCwgX19zdHJpbmdpZnkobmFtZSksIFwKKwkJ
cGlwZV9jb25maWdfaW5mb2ZyYW1lX2VycihpOTE1LCBhZGp1c3QsIF9fc3RyaW5naWZ5KG5hbWUp
LCBcCiAJCQkJCSAgJmN1cnJlbnRfY29uZmlnLT5pbmZvZnJhbWVzLm5hbWUsIFwKIAkJCQkJICAm
cGlwZV9jb25maWctPmluZm9mcmFtZXMubmFtZSk7IFwKIAkJcmV0ID0gZmFsc2U7IFwKQEAgLTEy
NTQ0LDcgKzEyNTQ0LDcgQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJUElQRV9DT05GX0NIRUNLX0kobGFuZV9jb3VudCk7CiAJ
UElQRV9DT05GX0NIRUNLX1gobGFuZV9sYXRfb3B0aW1fbWFzayk7CiAKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA8IDgpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgOCkgewogCQlQSVBFX0NP
TkZfQ0hFQ0tfTV9OKGRwX21fbik7CiAKIAkJaWYgKGN1cnJlbnRfY29uZmlnLT5oYXNfZHJycykK
QEAgLTEyNTcxLDggKzEyNTcxLDggQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJUElQRV9DT05GX0NIRUNLX0kocGl4ZWxfbXVs
dGlwbGllcik7CiAJUElQRV9DT05GX0NIRUNLX0kob3V0cHV0X2Zvcm1hdCk7CiAJUElQRV9DT05G
X0NIRUNLX0JPT0woaGFzX2hkbWlfc2luayk7Ci0JaWYgKChJTlRFTF9HRU4oZGV2X3ByaXYpIDwg
OCAmJiAhSVNfSEFTV0VMTChkZXZfcHJpdikpIHx8Ci0JICAgIElTX1ZBTExFWVZJRVcoZGV2X3By
aXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCWlmICgoSU5URUxfR0VOKGk5MTUpIDwg
OCAmJiAhSVNfSEFTV0VMTChpOTE1KSkgfHwKKwkgICAgSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJ
U19DSEVSUllWSUVXKGk5MTUpKQogCQlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChsaW1pdGVkX2NvbG9y
X3JhbmdlKTsKIAogCVBJUEVfQ09ORl9DSEVDS19CT09MKGhkbWlfc2NyYW1ibGluZyk7CkBAIC0x
MjU5Nyw3ICsxMjU5Nyw3IEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJUElQRV9DT05GX0NIRUNLX1goZ21jaF9wZml0LmNv
bnRyb2wpOwogCS8qIHBmaXQgcmF0aW9zIGFyZSBhdXRvY29tcHV0ZWQgYnkgdGhlIGh3IG9uIGdl
bjQrICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA0KQorCWlmIChJTlRFTF9HRU4oaTkx
NSkgPCA0KQogCQlQSVBFX0NPTkZfQ0hFQ0tfWChnbWNoX3BmaXQucGdtX3JhdGlvcyk7CiAJUElQ
RV9DT05GX0NIRUNLX1goZ21jaF9wZml0Lmx2ZHNfYm9yZGVyX2JpdHMpOwogCkBAIC0xMjYyMSw3
ICsxMjYyMSw3IEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCQlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkocGl4ZWxfcmF0
ZSk7CiAKIAkJUElQRV9DT05GX0NIRUNLX1goZ2FtbWFfbW9kZSk7Ci0JCWlmIChJU19DSEVSUllW
SUVXKGRldl9wcml2KSkKKwkJaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkpCiAJCQlQSVBFX0NPTkZf
Q0hFQ0tfWChjZ21fbW9kZSk7CiAJCWVsc2UKIAkJCVBJUEVfQ09ORl9DSEVDS19YKGNzY19tb2Rl
KTsKQEAgLTEyNjY3LDcgKzEyNjY3LDcgQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJUElQRV9DT05GX0NIRUNLX1goZHNpX3Bs
bC5jdHJsKTsKIAlQSVBFX0NPTkZfQ0hFQ0tfWChkc2lfcGxsLmRpdik7CiAKLQlpZiAoSVNfRzRY
KGRldl9wcml2KSB8fCBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDUpCisJaWYgKElTX0c0WChpOTE1
KSB8fCBJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJUElQRV9DT05GX0NIRUNLX0kocGlwZV9icHAp
OwogCiAJUElQRV9DT05GX0NIRUNLX0NMT0NLX0ZVWlpZKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRj
X2Nsb2NrKTsKQEAgLTEyNjk0LDExICsxMjY5NCwxMSBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21w
YXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gcmV0OwogfQog
Ci1zdGF0aWMgdm9pZCBpbnRlbF9waXBlX2NvbmZpZ19zYW5pdHlfY2hlY2soc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50ZWxfcGlwZV9jb25maWdfc2Fu
aXR5X2NoZWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJaWYgKHBpcGVfY29uZmln
LT5oYXNfcGNoX2VuY29kZXIpIHsKLQkJaW50IGZkaV9kb3RjbG9jayA9IGludGVsX2RvdGNsb2Nr
X2NhbGN1bGF0ZShpbnRlbF9mZGlfbGlua19mcmVxKGRldl9wcml2LCBwaXBlX2NvbmZpZyksCisJ
CWludCBmZGlfZG90Y2xvY2sgPSBpbnRlbF9kb3RjbG9ja19jYWxjdWxhdGUoaW50ZWxfZmRpX2xp
bmtfZnJlcShpOTE1LCBwaXBlX2NvbmZpZyksCiAJCQkJCQkJICAgICZwaXBlX2NvbmZpZy0+ZmRp
X21fbik7CiAJCWludCBkb3RjbG9jayA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUu
Y3J0Y19jbG9jazsKIApAQCAtMTI3MTUsNyArMTI3MTUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9w
aXBlX2NvbmZpZ19zYW5pdHlfY2hlY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJ
CSAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IHNrbF9od19z
dGF0ZSB7CiAJCXN0cnVjdCBza2xfZGRiX2VudHJ5IGRkYl95W0k5MTVfTUFYX1BMQU5FU107CiAJ
CXN0cnVjdCBza2xfZGRiX2VudHJ5IGRkYl91dltJOTE1X01BWF9QTEFORVNdOwpAQCAtMTI3Mjcs
OSArMTI3MjcsOSBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGRybV9jcnRj
ICpjcnRjLAogCXN0cnVjdCBza2xfZGRiX2VudHJ5ICpod19kZGJfZW50cnksICpzd19kZGJfZW50
cnk7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMp
OwogCWNvbnN0IGVudW0gcGlwZSBwaXBlID0gaW50ZWxfY3J0Yy0+cGlwZTsKLQlpbnQgcGxhbmUs
IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsKKwlpbnQgcGxh
bmUsIGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGk5MTUpOwogCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPCA5IHx8ICFuZXdfc3RhdGUtPmFjdGl2ZSkKKwlpZiAoSU5URUxf
R0VOKGk5MTUpIDwgOSB8fCAhbmV3X3N0YXRlLT5hY3RpdmUpCiAJCXJldHVybjsKIAogCWh3ID0g
a3phbGxvYyhzaXplb2YoKmh3KSwgR0ZQX0tFUk5FTCk7CkBAIC0xMjc0MSwxNyArMTI3NDEsMTcg
QEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAog
CXNrbF9waXBlX2RkYl9nZXRfaHdfc3RhdGUoaW50ZWxfY3J0YywgaHctPmRkYl95LCBody0+ZGRi
X3V2KTsKIAotCXNrbF9kZGJfZ2V0X2h3X3N0YXRlKGRldl9wcml2LCAmaHctPmRkYik7Ci0Jc3df
ZGRiID0gJmRldl9wcml2LT53bS5za2xfaHcuZGRiOworCXNrbF9kZGJfZ2V0X2h3X3N0YXRlKGk5
MTUsICZody0+ZGRiKTsKKwlzd19kZGIgPSAmaTkxNS0+d20uc2tsX2h3LmRkYjsKIAotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSAm
JgogCSAgICBody0+ZGRiLmVuYWJsZWRfc2xpY2VzICE9IHN3X2RkYi0+ZW5hYmxlZF9zbGljZXMp
CiAJCURSTV9FUlJPUigibWlzbWF0Y2ggaW4gREJVRiBTbGljZXMgKGV4cGVjdGVkICV1LCBnb3Qg
JXUpXG4iLAogCQkJICBzd19kZGItPmVuYWJsZWRfc2xpY2VzLAogCQkJICBody0+ZGRiLmVuYWJs
ZWRfc2xpY2VzKTsKIAogCS8qIHBsYW5lcyAqLwotCWZvcl9lYWNoX3VuaXZlcnNhbF9wbGFuZShk
ZXZfcHJpdiwgcGlwZSwgcGxhbmUpIHsKKwlmb3JfZWFjaF91bml2ZXJzYWxfcGxhbmUoaTkxNSwg
cGlwZSwgcGxhbmUpIHsKIAkJc3RydWN0IHNrbF9wbGFuZV93bSAqaHdfcGxhbmVfd20sICpzd19w
bGFuZV93bTsKIAogCQlod19wbGFuZV93bSA9ICZody0+d20ucGxhbmVzW3BsYW5lXTsKQEAgLTEy
OTMzLDcgKzEyOTMzLDcgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRj
LAogCQkgIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiB7CiAJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAJc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwogCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywgKnN3X2NvbmZpZzsKQEAgLTEyOTQ5LDEwICsx
Mjk0OSwxMCBAQCB2ZXJpZnlfY3J0Y19zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAKIAlE
Uk1fREVCVUdfS01TKCJbQ1JUQzolZDolc11cbiIsIGNydGMtPmJhc2UuaWQsIGNydGMtPm5hbWUp
OwogCi0JYWN0aXZlID0gZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnKGludGVsX2Ny
dGMsIHBpcGVfY29uZmlnKTsKKwlhY3RpdmUgPSBpOTE1LT5kaXNwbGF5LmdldF9waXBlX2NvbmZp
ZyhpbnRlbF9jcnRjLCBwaXBlX2NvbmZpZyk7CiAKIAkvKiB3ZSBrZWVwIGJvdGggcGlwZXMgZW5h
YmxlZCBvbiA4MzAgKi8KLQlpZiAoSVNfSTgzMChkZXZfcHJpdikpCisJaWYgKElTX0k4MzAoaTkx
NSkpCiAJCWFjdGl2ZSA9IG5ld19jcnRjX3N0YXRlLT5hY3RpdmU7CiAKIAlJOTE1X1NUQVRFX1dB
Uk4obmV3X2NydGNfc3RhdGUtPmFjdGl2ZSAhPSBhY3RpdmUsCkBAIC0xMjk4NCwxMCArMTI5ODQs
MTAgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCWlmICghbmV3
X2NydGNfc3RhdGUtPmFjdGl2ZSkKIAkJcmV0dXJuOwogCi0JaW50ZWxfcGlwZV9jb25maWdfc2Fu
aXR5X2NoZWNrKGRldl9wcml2LCBwaXBlX2NvbmZpZyk7CisJaW50ZWxfcGlwZV9jb25maWdfc2Fu
aXR5X2NoZWNrKGk5MTUsIHBpcGVfY29uZmlnKTsKIAogCXN3X2NvbmZpZyA9IHRvX2ludGVsX2Ny
dGNfc3RhdGUobmV3X2NydGNfc3RhdGUpOwotCWlmICghaW50ZWxfcGlwZV9jb25maWdfY29tcGFy
ZShkZXZfcHJpdiwgc3dfY29uZmlnLAorCWlmICghaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShp
OTE1LCBzd19jb25maWcsCiAJCQkJICAgICAgIHBpcGVfY29uZmlnLCBmYWxzZSkpIHsKIAkJSTkx
NV9TVEFURV9XQVJOKDEsICJwaXBlIHN0YXRlIGRvZXNuJ3QgbWF0Y2ghXG4iKTsKIAkJaW50ZWxf
ZHVtcF9waXBlX2NvbmZpZyhwaXBlX2NvbmZpZywgTlVMTCwgIltodyBzdGF0ZV0iKTsKQEAgLTEz
MDA5LDcgKzEzMDA5LDcgQEAgaW50ZWxfdmVyaWZ5X3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIH0KIAogc3RhdGljIHZvaWQKLXZlcmlmeV9zaW5nbGVfZHBsbF9zdGF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2ZXJpZnlfc2luZ2xlX2RwbGxf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgc3RydWN0IGludGVsX3No
YXJlZF9kcGxsICpwbGwsCiAJCQkgc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJIHN0cnVjdCBk
cm1fY3J0Y19zdGF0ZSAqbmV3X3N0YXRlKQpAQCAtMTMwMjIsNyArMTMwMjIsNyBAQCB2ZXJpZnlf
c2luZ2xlX2RwbGxfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJ
RFJNX0RFQlVHX0tNUygiJXNcbiIsIHBsbC0+aW5mby0+bmFtZSk7CiAKLQlhY3RpdmUgPSBwbGwt
PmluZm8tPmZ1bmNzLT5nZXRfaHdfc3RhdGUoZGV2X3ByaXYsIHBsbCwgJmRwbGxfaHdfc3RhdGUp
OworCWFjdGl2ZSA9IHBsbC0+aW5mby0+ZnVuY3MtPmdldF9od19zdGF0ZShpOTE1LCBwbGwsICZk
cGxsX2h3X3N0YXRlKTsKIAogCWlmICghKHBsbC0+aW5mby0+ZmxhZ3MgJiBJTlRFTF9EUExMX0FM
V0FZU19PTikpIHsKIAkJSTkxNV9TVEFURV9XQVJOKCFwbGwtPm9uICYmIHBsbC0+YWN0aXZlX21h
c2ssCkBAIC0xMzA2OCwxMiArMTMwNjgsMTIgQEAgdmVyaWZ5X3NoYXJlZF9kcGxsX3N0YXRlKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCSBzdHJ1Y3Qg
ZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCQkJIHN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqbmV3X2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfc3RhdGUgPSB0b19pbnRlbF9j
cnRjX3N0YXRlKG9sZF9jcnRjX3N0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShuZXdfY3J0Y19zdGF0ZSk7CiAKIAlpZiAobmV3
X3N0YXRlLT5zaGFyZWRfZHBsbCkKLQkJdmVyaWZ5X3NpbmdsZV9kcGxsX3N0YXRlKGRldl9wcml2
LCBuZXdfc3RhdGUtPnNoYXJlZF9kcGxsLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSk7CisJCXZlcmlm
eV9zaW5nbGVfZHBsbF9zdGF0ZShpOTE1LCBuZXdfc3RhdGUtPnNoYXJlZF9kcGxsLCBjcnRjLCBu
ZXdfY3J0Y19zdGF0ZSk7CiAKIAlpZiAob2xkX3N0YXRlLT5zaGFyZWRfZHBsbCAmJgogCSAgICBv
bGRfc3RhdGUtPnNoYXJlZF9kcGxsICE9IG5ld19zdGF0ZS0+c2hhcmVkX2RwbGwpIHsKQEAgLTEz
MTA4LDExICsxMzEwOCwxMSBAQCBpbnRlbF9tb2Rlc2V0X3ZlcmlmeV9jcnRjKHN0cnVjdCBkcm1f
Y3J0YyAqY3J0YywKIHN0YXRpYyB2b2lkCiB2ZXJpZnlfZGlzYWJsZWRfZHBsbF9zdGF0ZShzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZGV2KTsKIAlpbnQgaTsKIAotCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+bnVtX3NoYXJl
ZF9kcGxsOyBpKyspCi0JCXZlcmlmeV9zaW5nbGVfZHBsbF9zdGF0ZShkZXZfcHJpdiwgJmRldl9w
cml2LT5zaGFyZWRfZHBsbHNbaV0sIE5VTEwsIE5VTEwpOworCWZvciAoaSA9IDA7IGkgPCBpOTE1
LT5udW1fc2hhcmVkX2RwbGw7IGkrKykKKwkJdmVyaWZ5X3NpbmdsZV9kcGxsX3N0YXRlKGk5MTUs
ICZpOTE1LT5zaGFyZWRfZHBsbHNbaV0sIE5VTEwsIE5VTEwpOwogfQogCiBzdGF0aWMgdm9pZApA
QCAtMTMxMjcsNyArMTMxMjcsNyBAQCBpbnRlbF9tb2Rlc2V0X3ZlcmlmeV9kaXNhYmxlZChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LAogc3RhdGljIHZvaWQgdXBkYXRlX3NjYW5saW5lX29mZnNldChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCiAJLyoKIAkgKiBUaGUgc2NhbmxpbmUgY291bnRlciBpbmNyZW1lbnRzIGF0IHRoZSBs
ZWFkaW5nIGVkZ2Ugb2YgaHN5bmMuCkBAIC0xMzE1Niw3ICsxMzE1Niw3IEBAIHN0YXRpYyB2b2lk
IHVwZGF0ZV9zY2FubGluZV9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiAJICogSG93ZXZlciBpZiBxdWVyaWVkIGp1c3QgYmVmb3JlIHRoZSBzdGFydCBv
ZiB2Ymxhbmsgd2UnbGwgZ2V0IGFuCiAJICogYW5zd2VyIHRoYXQncyBzbGlnaHRseSBpbiB0aGUg
ZnV0dXJlLgogCSAqLwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpKSB7CisJaWYgKElTX0dFTihp
OTE1LCAyKSkgewogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9k
ZSA9ICZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CiAJCWludCB2dG90YWw7CiAKQEAg
LTEzMTY1LDcgKzEzMTY1LDcgQEAgc3RhdGljIHZvaWQgdXBkYXRlX3NjYW5saW5lX29mZnNldChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJCXZ0b3RhbCAvPSAy
OwogCiAJCWNydGMtPnNjYW5saW5lX29mZnNldCA9IHZ0b3RhbCAtIDE7Ci0JfSBlbHNlIGlmIChI
QVNfRERJKGRldl9wcml2KSAmJgorCX0gZWxzZSBpZiAoSEFTX0RESShpOTE1KSAmJgogCQkgICBp
bnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9IRE1JKSkgewogCQlj
cnRjLT5zY2FubGluZV9vZmZzZXQgPSAyOwogCX0gZWxzZQpAQCAtMTMxNzQsMTIgKzEzMTc0LDEy
IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9zY2FubGluZV9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfY2xl
YXJfcGxscyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CiAJ
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLCAqbmV3X2NydGNfc3RhdGU7
CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7CiAJaW50IGk7CiAKLQlpZiAoIWRldl9wcml2LT5k
aXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jaykKKwlpZiAoIWk5MTUtPmRpc3BsYXkuY3J0Y19jb21w
dXRlX2Nsb2NrKQogCQlyZXR1cm47CiAKIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9z
dGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsCkBAIC0xMzMxMSw3ICsxMzMxMSw3IEBA
IHN0YXRpYyBpbnQgaW50ZWxfbW9kZXNldF9hbGxfcGlwZXMoc3RydWN0IGRybV9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCiBzdGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YzsKIAlpbnQgcmV0ID0gMCwgaTsKQEAgLTEzMzIzLDEyICsxMzMyMywxMiBAQCBzdGF0
aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCiAJLyoga2VlcCB0aGUgY3VycmVudCBzZXR0aW5nICovCiAJaWYgKCFzdGF0ZS0+Y2Rj
bGsuZm9yY2VfbWluX2NkY2xrX2NoYW5nZWQpCi0JCXN0YXRlLT5jZGNsay5mb3JjZV9taW5fY2Rj
bGsgPSBkZXZfcHJpdi0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrOworCQlzdGF0ZS0+Y2RjbGsuZm9y
Y2VfbWluX2NkY2xrID0gaTkxNS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrOwogCiAJc3RhdGUtPm1v
ZGVzZXQgPSB0cnVlOwotCXN0YXRlLT5hY3RpdmVfY3J0Y3MgPSBkZXZfcHJpdi0+YWN0aXZlX2Ny
dGNzOwotCXN0YXRlLT5jZGNsay5sb2dpY2FsID0gZGV2X3ByaXYtPmNkY2xrLmxvZ2ljYWw7Ci0J
c3RhdGUtPmNkY2xrLmFjdHVhbCA9IGRldl9wcml2LT5jZGNsay5hY3R1YWw7CisJc3RhdGUtPmFj
dGl2ZV9jcnRjcyA9IGk5MTUtPmFjdGl2ZV9jcnRjczsKKwlzdGF0ZS0+Y2RjbGsubG9naWNhbCA9
IGk5MTUtPmNkY2xrLmxvZ2ljYWw7CisJc3RhdGUtPmNkY2xrLmFjdHVhbCA9IGk5MTUtPmNkY2xr
LmFjdHVhbDsKIAlzdGF0ZS0+Y2RjbGsucGlwZSA9IElOVkFMSURfUElQRTsKIAogCWZvcl9lYWNo
X29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwK
QEAgLTEzMzQ5LDE5ICsxMzM0OSwxOSBAQCBzdGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCSAqIG1vZGUgc2V0IG9uIHRoaXMg
Y3J0Yy4gIEZvciBvdGhlciBjcnRjcyB3ZSBuZWVkIHRvIHVzZSB0aGUKIAkgKiBhZGp1c3RlZF9t
b2RlIGJpdHMgaW4gdGhlIGNydGMgZGlyZWN0bHkuCiAJICovCi0JaWYgKGRldl9wcml2LT5kaXNw
bGF5Lm1vZGVzZXRfY2FsY19jZGNsaykgeworCWlmIChpOTE1LT5kaXNwbGF5Lm1vZGVzZXRfY2Fs
Y19jZGNsaykgewogCQllbnVtIHBpcGUgcGlwZTsKIAotCQlyZXQgPSBkZXZfcHJpdi0+ZGlzcGxh
eS5tb2Rlc2V0X2NhbGNfY2RjbGsoc3RhdGUpOworCQlyZXQgPSBpOTE1LT5kaXNwbGF5Lm1vZGVz
ZXRfY2FsY19jZGNsayhzdGF0ZSk7CiAJCWlmIChyZXQgPCAwKQogCQkJcmV0dXJuIHJldDsKIAog
CQkvKgotCQkgKiBXcml0ZXMgdG8gZGV2X3ByaXYtPmNkY2xrLmxvZ2ljYWwgbXVzdCBwcm90ZWN0
ZWQgYnkKKwkJICogV3JpdGVzIHRvIGk5MTUtPmNkY2xrLmxvZ2ljYWwgbXVzdCBwcm90ZWN0ZWQg
YnkKIAkJICogaG9sZGluZyBhbGwgdGhlIGNydGMgbG9ja3MsIGV2ZW4gaWYgd2UgZG9uJ3QgZW5k
IHVwCiAJCSAqIHRvdWNoaW5nIHRoZSBoYXJkd2FyZQogCQkgKi8KLQkJaWYgKGludGVsX2NkY2xr
X2NoYW5nZWQoJmRldl9wcml2LT5jZGNsay5sb2dpY2FsLAorCQlpZiAoaW50ZWxfY2RjbGtfY2hh
bmdlZCgmaTkxNS0+Y2RjbGsubG9naWNhbCwKIAkJCQkJJnN0YXRlLT5jZGNsay5sb2dpY2FsKSkg
ewogCQkJcmV0ID0gaW50ZWxfbG9ja19hbGxfcGlwZXMoJnN0YXRlLT5iYXNlKTsKIAkJCWlmIChy
ZXQgPCAwKQpAQCAtMTMzNzMsNyArMTMzNzMsNyBAQCBzdGF0aWMgaW50IGludGVsX21vZGVzZXRf
Y2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJc3RydWN0IGRybV9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlOwogCiAJCQlwaXBlID0gaWxvZzIoc3RhdGUtPmFjdGl2ZV9j
cnRjcyk7Ci0JCQljcnRjID0gJmludGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBwaXBl
KS0+YmFzZTsKKwkJCWNydGMgPSAmaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoaTkxNSwgcGlwZSkt
PmJhc2U7CiAJCQljcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoJnN0
YXRlLT5iYXNlLCBjcnRjKTsKIAkJCWlmIChjcnRjX3N0YXRlICYmIG5lZWRzX21vZGVzZXQoY3J0
Y19zdGF0ZSkpCiAJCQkJcGlwZSA9IElOVkFMSURfUElQRTsKQEAgLTEzMzgzLDE1ICsxMzM4Mywx
NSBAQCBzdGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogCiAJCS8qIEFsbCBwaXBlcyBtdXN0IGJlIHN3aXRjaGVkIG9mZiB3aGls
ZSB3ZSBjaGFuZ2UgdGhlIGNkY2xrLiAqLwogCQlpZiAocGlwZSAhPSBJTlZBTElEX1BJUEUgJiYK
LQkJICAgIGludGVsX2NkY2xrX25lZWRzX2NkMnhfdXBkYXRlKGRldl9wcml2LAotCQkJCQkJICAm
ZGV2X3ByaXYtPmNkY2xrLmFjdHVhbCwKKwkJICAgIGludGVsX2NkY2xrX25lZWRzX2NkMnhfdXBk
YXRlKGk5MTUsCisJCQkJCQkgICZpOTE1LT5jZGNsay5hY3R1YWwsCiAJCQkJCQkgICZzdGF0ZS0+
Y2RjbGsuYWN0dWFsKSkgewogCQkJcmV0ID0gaW50ZWxfbG9ja19hbGxfcGlwZXMoJnN0YXRlLT5i
YXNlKTsKIAkJCWlmIChyZXQgPCAwKQogCQkJCXJldHVybiByZXQ7CiAKIAkJCXN0YXRlLT5jZGNs
ay5waXBlID0gcGlwZTsKLQkJfSBlbHNlIGlmIChpbnRlbF9jZGNsa19uZWVkc19tb2Rlc2V0KCZk
ZXZfcHJpdi0+Y2RjbGsuYWN0dWFsLAorCQl9IGVsc2UgaWYgKGludGVsX2NkY2xrX25lZWRzX21v
ZGVzZXQoJmk5MTUtPmNkY2xrLmFjdHVhbCwKIAkJCQkJCSAgICAgJnN0YXRlLT5jZGNsay5hY3R1
YWwpKSB7CiAJCQlyZXQgPSBpbnRlbF9tb2Rlc2V0X2FsbF9waXBlcygmc3RhdGUtPmJhc2UpOwog
CQkJaWYgKHJldCA8IDApCkBAIC0xMzQxMCw3ICsxMzQxMCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
bW9kZXNldF9jaGVja3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAlpbnRl
bF9tb2Rlc2V0X2NsZWFyX3BsbHMoc3RhdGUpOwogCi0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYp
KQorCWlmIChJU19IQVNXRUxMKGk5MTUpKQogCQlyZXR1cm4gaGFzd2VsbF9tb2RlX3NldF9wbGFu
ZXNfd29ya2Fyb3VuZChzdGF0ZSk7CiAKIAlyZXR1cm4gMDsKQEAgLTEzNDI0LDExICsxMzQyNCwx
MSBAQCBzdGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogc3RhdGljIGludCBjYWxjX3dhdGVybWFya19kYXRhKHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0
ZS0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwog
CiAJLyogSXMgdGhlcmUgcGxhdGZvcm0tc3BlY2lmaWMgd2F0ZXJtYXJrIGluZm9ybWF0aW9uIHRv
IGNhbGN1bGF0ZT8gKi8KLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuY29tcHV0ZV9nbG9iYWxfd2F0
ZXJtYXJrcykKLQkJcmV0dXJuIGRldl9wcml2LT5kaXNwbGF5LmNvbXB1dGVfZ2xvYmFsX3dhdGVy
bWFya3Moc3RhdGUpOworCWlmIChpOTE1LT5kaXNwbGF5LmNvbXB1dGVfZ2xvYmFsX3dhdGVybWFy
a3MpCisJCXJldHVybiBpOTE1LT5kaXNwbGF5LmNvbXB1dGVfZ2xvYmFsX3dhdGVybWFya3Moc3Rh
dGUpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0xMzQ0MSw3ICsxMzQ0MSw3IEBAIHN0YXRpYyBpbnQg
Y2FsY193YXRlcm1hcmtfZGF0YShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHN0
YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkg
ICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShfc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjOwpAQCAtMTM0NzQsNyArMTM0NzQsNyBAQCBzdGF0aWMgaW50IGludGVsX2F0b21p
Y19jaGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQlpZiAocmV0KQogCQkJZ290byBmYWls
OwogCi0JCWlmIChpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKGRldl9wcml2LCBvbGRfY3J0Y19z
dGF0ZSwKKwkJaWYgKGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoaTkxNSwgb2xkX2NydGNfc3Rh
dGUsCiAJCQkJCSAgICAgIG5ld19jcnRjX3N0YXRlLCB0cnVlKSkgewogCQkJbmV3X2NydGNfc3Rh
dGUtPmJhc2UubW9kZV9jaGFuZ2VkID0gZmFsc2U7CiAJCQluZXdfY3J0Y19zdGF0ZS0+dXBkYXRl
X3BpcGUgPSB0cnVlOwpAQCAtMTM0OTMsNyArMTM0OTMsNyBAQCBzdGF0aWMgaW50IGludGVsX2F0
b21pY19jaGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQlpZiAocmV0KQogCQkJZ290byBm
YWlsOwogCX0gZWxzZSB7Ci0JCXN0YXRlLT5jZGNsay5sb2dpY2FsID0gZGV2X3ByaXYtPmNkY2xr
LmxvZ2ljYWw7CisJCXN0YXRlLT5jZGNsay5sb2dpY2FsID0gaTkxNS0+Y2RjbGsubG9naWNhbDsK
IAl9CiAKIAlyZXQgPSBpY2xfYWRkX2xpbmtlZF9wbGFuZXMoc3RhdGUpOwpAQCAtMTM1MDQsNyAr
MTM1MDQsNyBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LAogCWlmIChyZXQpCiAJCWdvdG8gZmFpbDsKIAotCWludGVsX2ZiY19jaG9vc2VfY3J0
YyhkZXZfcHJpdiwgc3RhdGUpOworCWludGVsX2ZiY19jaG9vc2VfY3J0YyhpOTE1LCBzdGF0ZSk7
CiAJcmV0ID0gY2FsY193YXRlcm1hcmtfZGF0YShzdGF0ZSk7CiAJaWYgKHJldCkKIAkJZ290byBm
YWlsOwpAQCAtMTM1NjQsNyArMTM1NjQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3J0
YyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCQkgICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUg
Km5ld19jcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKIAlzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqcGlwZV9jb25maWcgPSB0b19pbnRlbF9jcnRjX3N0YXRlKG5ld19jcnRjX3N0
YXRlKTsKIAlib29sIG1vZGVzZXQgPSBuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKTsKQEAg
LTEzNTc0LDcgKzEzNTc0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX2NydGMoc3RydWN0
IGRybV9jcnRjICpjcnRjLAogCiAJaWYgKG1vZGVzZXQpIHsKIAkJdXBkYXRlX3NjYW5saW5lX29m
ZnNldChwaXBlX2NvbmZpZyk7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfZW5hYmxlKHBpcGVf
Y29uZmlnLCBzdGF0ZSk7CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19lbmFibGUocGlwZV9jb25maWcs
IHN0YXRlKTsKIAogCQkvKiB2YmxhbmtzIHdvcmsgYWdhaW4sIHJlLWVuYWJsZSBwaXBlIENSQy4g
Ki8KIAkJaW50ZWxfY3J0Y19lbmFibGVfcGlwZV9jcmMoaW50ZWxfY3J0Yyk7CkBAIC0xMzU5Myw3
ICsxMzU5Myw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3VwZGF0ZV9jcnRjKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKIAogCWludGVsX2JlZ2luX2NydGNfY29tbWl0KHRvX2ludGVsX2F0b21pY19zdGF0
ZShzdGF0ZSksIGludGVsX2NydGMpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkK
KwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpCiAJCXNrbF91cGRhdGVfcGxhbmVzX29uX2NydGMo
dG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKSwgaW50ZWxfY3J0Yyk7CiAJZWxzZQogCQlpOXh4
X3VwZGF0ZV9wbGFuZXNfb25fY3J0Yyh0b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpLCBpbnRl
bF9jcnRjKTsKQEAgLTEzNjE4LDcgKzEzNjE4LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRl
X2NydGNzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAogc3RhdGljIHZvaWQgc2ts
X3VwZGF0ZV9jcnRjcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+ZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoc3RhdGUtPmRldik7CiAJc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUo
c3RhdGUpOwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50
ZWxfY3J0YzsKQEAgLTEzNjI4LDcgKzEzNjI4LDcgQEAgc3RhdGljIHZvaWQgc2tsX3VwZGF0ZV9j
cnRjcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJYm9vbCBwcm9ncmVzczsKIAll
bnVtIHBpcGUgcGlwZTsKIAlpbnQgaTsKLQl1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2
LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzOworCXU4IGh3X2VuYWJsZWRfc2xpY2VzID0g
aTkxNS0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlczsKIAl1OCByZXF1aXJlZF9zbGljZXMg
PSBpbnRlbF9zdGF0ZS0+d21fcmVzdWx0cy5kZGIuZW5hYmxlZF9zbGljZXM7CiAJc3RydWN0IHNr
bF9kZGJfZW50cnkgZW50cmllc1tJOTE1X01BWF9QSVBFU10gPSB7fTsKIApAQCAtMTM2MzgsOCAr
MTM2MzgsOCBAQCBzdGF0aWMgdm9pZCBza2xfdXBkYXRlX2NydGNzKHN0cnVjdCBkcm1fYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAkJCWVudHJpZXNbaV0gPSB0b19pbnRlbF9jcnRjX3N0YXRlKG9sZF9j
cnRjX3N0YXRlKS0+d20uc2tsLmRkYjsKIAogCS8qIElmIDJuZCBEQnVmIHNsaWNlIHJlcXVpcmVk
LCBlbmFibGUgaXQgaGVyZSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHJl
cXVpcmVkX3NsaWNlcyA+IGh3X2VuYWJsZWRfc2xpY2VzKQotCQlpY2xfZGJ1Zl9zbGljZXNfdXBk
YXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0g
MTEgJiYgcmVxdWlyZWRfc2xpY2VzID4gaHdfZW5hYmxlZF9zbGljZXMpCisJCWljbF9kYnVmX3Ns
aWNlc191cGRhdGUoaTkxNSwgcmVxdWlyZWRfc2xpY2VzKTsKIAogCS8qCiAJICogV2hlbmV2ZXIg
dGhlIG51bWJlciBvZiBhY3RpdmUgcGlwZXMgY2hhbmdlcywgd2UgbmVlZCB0byBtYWtlIHN1cmUg
d2UKQEAgLTEzNjYzLDcgKzEzNjYzLDcgQEAgc3RhdGljIHZvaWQgc2tsX3VwZGF0ZV9jcnRjcyhz
dHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAkJCWlmIChza2xfZGRiX2FsbG9jYXRp
b25fb3ZlcmxhcHMoJmNzdGF0ZS0+d20uc2tsLmRkYiwKIAkJCQkJCQllbnRyaWVzLAotCQkJCQkJ
CUlOVEVMX0lORk8oZGV2X3ByaXYpLT5udW1fcGlwZXMsIGkpKQorCQkJCQkJCUlOVEVMX0lORk8o
aTkxNSktPm51bV9waXBlcywgaSkpCiAJCQkJY29udGludWU7CiAKIAkJCXVwZGF0ZWQgfD0gY21h
c2s7CkBAIC0xMzY4NSw1NyArMTM2ODUsNTcgQEAgc3RhdGljIHZvaWQgc2tsX3VwZGF0ZV9jcnRj
cyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJCSAgbmV3X2NydGNfc3RhdGUp
OwogCiAJCQlpZiAodmJsX3dhaXQpCi0JCQkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9wcml2
LCBwaXBlKTsKKwkJCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoaTkxNSwgcGlwZSk7CiAKIAkJCXBy
b2dyZXNzID0gdHJ1ZTsKIAkJfQogCX0gd2hpbGUgKHByb2dyZXNzKTsKIAogCS8qIElmIDJuZCBE
QnVmIHNsaWNlIGlzIG5vIG1vcmUgcmVxdWlyZWQgZGlzYWJsZSBpdCAqLwotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA8IGh3X2VuYWJsZWRfc2xpY2Vz
KQotCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOwor
CWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEgJiYgcmVxdWlyZWRfc2xpY2VzIDwgaHdfZW5hYmxl
ZF9zbGljZXMpCisJCWljbF9kYnVmX3NsaWNlc191cGRhdGUoaTkxNSwgcmVxdWlyZWRfc2xpY2Vz
KTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2hlbHBlcl9mcmVlX3N0YXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2F0b21pY19o
ZWxwZXJfZnJlZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwgKm5leHQ7CiAJc3RydWN0IGxsaXN0X25vZGUg
KmZyZWVkOwogCi0JZnJlZWQgPSBsbGlzdF9kZWxfYWxsKCZkZXZfcHJpdi0+YXRvbWljX2hlbHBl
ci5mcmVlX2xpc3QpOworCWZyZWVkID0gbGxpc3RfZGVsX2FsbCgmaTkxNS0+YXRvbWljX2hlbHBl
ci5mcmVlX2xpc3QpOwogCWxsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoc3RhdGUsIG5leHQsIGZy
ZWVkLCBmcmVlZCkKIAkJZHJtX2F0b21pY19zdGF0ZV9wdXQoJnN0YXRlLT5iYXNlKTsKIH0KIAog
c3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2hlbHBlcl9mcmVlX3N0YXRlX3dvcmtlcihzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZGV2X3ByaXYpLCBhdG9taWNfaGVscGVy
LmZyZWVfd29yayk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQorCQljb250YWlu
ZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwgYXRvbWljX2hlbHBlci5mcmVlX3dvcmspOwogCi0J
aW50ZWxfYXRvbWljX2hlbHBlcl9mcmVlX3N0YXRlKGRldl9wcml2KTsKKwlpbnRlbF9hdG9taWNf
aGVscGVyX2ZyZWVfc3RhdGUoaTkxNSk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19j
b21taXRfZmVuY2Vfd2FpdChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSkK
IHsKIAlzdHJ1Y3Qgd2FpdF9xdWV1ZV9lbnRyeSB3YWl0X2ZlbmNlLCB3YWl0X3Jlc2V0OwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfc3RhdGUtPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoaW50ZWxf
c3RhdGUtPmJhc2UuZGV2KTsKIAogCWluaXRfd2FpdF9lbnRyeSgmd2FpdF9mZW5jZSwgMCk7CiAJ
aW5pdF93YWl0X2VudHJ5KCZ3YWl0X3Jlc2V0LCAwKTsKIAlmb3IgKDs7KSB7CiAJCXByZXBhcmVf
dG9fd2FpdCgmaW50ZWxfc3RhdGUtPmNvbW1pdF9yZWFkeS53YWl0LAogCQkJCSZ3YWl0X2ZlbmNl
LCBUQVNLX1VOSU5URVJSVVBUSUJMRSk7Ci0JCXByZXBhcmVfdG9fd2FpdCgmZGV2X3ByaXYtPmdw
dV9lcnJvci53YWl0X3F1ZXVlLAorCQlwcmVwYXJlX3RvX3dhaXQoJmk5MTUtPmdwdV9lcnJvci53
YWl0X3F1ZXVlLAogCQkJCSZ3YWl0X3Jlc2V0LCBUQVNLX1VOSU5URVJSVVBUSUJMRSk7CiAKIAog
CQlpZiAoaTkxNV9zd19mZW5jZV9kb25lKCZpbnRlbF9zdGF0ZS0+Y29tbWl0X3JlYWR5KQotCQkg
ICAgfHwgdGVzdF9iaXQoSTkxNV9SRVNFVF9NT0RFU0VULCAmZGV2X3ByaXYtPmdwdV9lcnJvci5m
bGFncykpCisJCSAgICB8fCB0ZXN0X2JpdChJOTE1X1JFU0VUX01PREVTRVQsICZpOTE1LT5ncHVf
ZXJyb3IuZmxhZ3MpKQogCQkJYnJlYWs7CiAKIAkJc2NoZWR1bGUoKTsKIAl9CiAJZmluaXNoX3dh
aXQoJmludGVsX3N0YXRlLT5jb21taXRfcmVhZHkud2FpdCwgJndhaXRfZmVuY2UpOwotCWZpbmlz
aF93YWl0KCZkZXZfcHJpdi0+Z3B1X2Vycm9yLndhaXRfcXVldWUsICZ3YWl0X3Jlc2V0KTsKKwlm
aW5pc2hfd2FpdCgmaTkxNS0+Z3B1X2Vycm9yLndhaXRfcXVldWUsICZ3YWl0X3Jlc2V0KTsKIH0K
IAogc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NsZWFudXBfd29yayhzdHJ1Y3Qgd29ya19zdHJ1
Y3QgKndvcmspCkBAIC0xMzc1NSw3ICsxMzc1NSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21p
Y19jb21taXRfdGFpbChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5kZXY7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUg
Km9sZF9jcnRjX3N0YXRlLCAqbmV3X2NydGNfc3RhdGU7CiAJc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm5ld19pbnRlbF9jcnRjX3N0YXRlLCAqb2xkX2ludGVsX2NydGNfc3RhdGU7CiAJc3RydWN0
IGRybV9jcnRjICpjcnRjOwpAQCAtMTM3NjksNyArMTM3NjksNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWRy
bV9hdG9taWNfaGVscGVyX3dhaXRfZm9yX2RlcGVuZGVuY2llcyhzdGF0ZSk7CiAKIAlpZiAoaW50
ZWxfc3RhdGUtPm1vZGVzZXQpCi0JCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChk
ZXZfcHJpdiwgUE9XRVJfRE9NQUlOX01PREVTRVQpOworCQl3YWtlcmVmID0gaW50ZWxfZGlzcGxh
eV9wb3dlcl9nZXQoaTkxNSwgUE9XRVJfRE9NQUlOX01PREVTRVQpOwogCiAJZm9yX2VhY2hfb2xk
bmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19z
dGF0ZSwgaSkgewogCQlvbGRfaW50ZWxfY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUo
b2xkX2NydGNfc3RhdGUpOwpAQCAtMTM3OTgsNyArMTM3OTgsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJ
ICovCiAJCQlpbnRlbF9jcnRjX2Rpc2FibGVfcGlwZV9jcmMoaW50ZWxfY3J0Yyk7CiAKLQkJCWRl
dl9wcml2LT5kaXNwbGF5LmNydGNfZGlzYWJsZShvbGRfaW50ZWxfY3J0Y19zdGF0ZSwgc3RhdGUp
OworCQkJaTkxNS0+ZGlzcGxheS5jcnRjX2Rpc2FibGUob2xkX2ludGVsX2NydGNfc3RhdGUsIHN0
YXRlKTsKIAkJCWludGVsX2NydGMtPmFjdGl2ZSA9IGZhbHNlOwogCQkJaW50ZWxfZmJjX2Rpc2Fi
bGUoaW50ZWxfY3J0Yyk7CiAJCQlpbnRlbF9kaXNhYmxlX3NoYXJlZF9kcGxsKG9sZF9pbnRlbF9j
cnRjX3N0YXRlKTsKQEAgLTEzODA3LDE0ICsxMzgwNywxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9h
dG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJICog
VW5kZXJydW5zIGRvbid0IGFsd2F5cyByYWlzZQogCQkJICogaW50ZXJydXB0cywgc28gY2hlY2sg
bWFudWFsbHkuCiAJCQkgKi8KLQkJCWludGVsX2NoZWNrX2NwdV9maWZvX3VuZGVycnVucyhkZXZf
cHJpdik7Ci0JCQlpbnRlbF9jaGVja19wY2hfZmlmb191bmRlcnJ1bnMoZGV2X3ByaXYpOworCQkJ
aW50ZWxfY2hlY2tfY3B1X2ZpZm9fdW5kZXJydW5zKGk5MTUpOworCQkJaW50ZWxfY2hlY2tfcGNo
X2ZpZm9fdW5kZXJydW5zKGk5MTUpOwogCiAJCQkvKiBGSVhNRSB1bmlmeSB0aGlzIGZvciBhbGwg
cGxhdGZvcm1zICovCiAJCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5hY3RpdmUgJiYKLQkJCSAgICAh
SEFTX0dNQ0goZGV2X3ByaXYpICYmCi0JCQkgICAgZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93
YXRlcm1hcmtzKQotCQkJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhpbnRl
bF9zdGF0ZSwKKwkJCSAgICAhSEFTX0dNQ0goaTkxNSkgJiYKKwkJCSAgICBpOTE1LT5kaXNwbGF5
LmluaXRpYWxfd2F0ZXJtYXJrcykKKwkJCQlpOTE1LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJr
cyhpbnRlbF9zdGF0ZSwKIAkJCQkJCQkJICAgICBuZXdfaW50ZWxfY3J0Y19zdGF0ZSk7CiAJCX0K
IAl9CkBAIC0xMzgyNiw5ICsxMzgyNiw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21t
aXRfdGFpbChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKGludGVsX3N0YXRl
LT5tb2Rlc2V0KSB7CiAJCWRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9sZWdhY3lfbW9kZXNldF9z
dGF0ZShzdGF0ZS0+ZGV2LCBzdGF0ZSk7CiAKLQkJaW50ZWxfc2V0X2NkY2xrX3ByZV9wbGFuZV91
cGRhdGUoZGV2X3ByaXYsCisJCWludGVsX3NldF9jZGNsa19wcmVfcGxhbmVfdXBkYXRlKGk5MTUs
CiAJCQkJCQkgJmludGVsX3N0YXRlLT5jZGNsay5hY3R1YWwsCi0JCQkJCQkgJmRldl9wcml2LT5j
ZGNsay5hY3R1YWwsCisJCQkJCQkgJmk5MTUtPmNkY2xrLmFjdHVhbCwKIAkJCQkJCSBpbnRlbF9z
dGF0ZS0+Y2RjbGsucGlwZSk7CiAKIAkJLyoKQEAgLTEzODM2LDcgKzEzODM2LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAkJICogaGF2ZSBtb3JlIHRoZW4gb25lIHBpcGUgZW5hYmxlZAogCQkgKi8KIAkJaWYg
KCFpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQotCQkJaW50ZWxfZGlzYWJsZV9zYWd2KGRl
dl9wcml2KTsKKwkJCWludGVsX2Rpc2FibGVfc2FndihpOTE1KTsKIAogCQlpbnRlbF9tb2Rlc2V0
X3ZlcmlmeV9kaXNhYmxlZChkZXYsIHN0YXRlKTsKIAl9CkBAIC0xMzg1NiwxMiArMTM4NTYsMTIg
QEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAl9CiAKIAkvKiBOb3cgZW5hYmxlIHRoZSBjbG9ja3MsIHBsYW5lLCBw
aXBlLCBhbmQgY29ubmVjdG9ycyB0aGF0IHdlIHNldCB1cC4gKi8KLQlkZXZfcHJpdi0+ZGlzcGxh
eS51cGRhdGVfY3J0Y3Moc3RhdGUpOworCWk5MTUtPmRpc3BsYXkudXBkYXRlX2NydGNzKHN0YXRl
KTsKIAogCWlmIChpbnRlbF9zdGF0ZS0+bW9kZXNldCkKLQkJaW50ZWxfc2V0X2NkY2xrX3Bvc3Rf
cGxhbmVfdXBkYXRlKGRldl9wcml2LAorCQlpbnRlbF9zZXRfY2RjbGtfcG9zdF9wbGFuZV91cGRh
dGUoaTkxNSwKIAkJCQkJCSAgJmludGVsX3N0YXRlLT5jZGNsay5hY3R1YWwsCi0JCQkJCQkgICZk
ZXZfcHJpdi0+Y2RjbGsuYWN0dWFsLAorCQkJCQkJICAmaTkxNS0+Y2RjbGsuYWN0dWFsLAogCQkJ
CQkJICBpbnRlbF9zdGF0ZS0+Y2RjbGsucGlwZSk7CiAKIAkvKiBGSVhNRTogV2Ugc2hvdWxkIGNh
bGwgZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2h3X2RvbmUoKSBoZXJlCkBAIC0xMzg5NSw4ICsx
Mzg5NSw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgZHJt
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUs
IGNydGMsIG5ld19jcnRjX3N0YXRlLCBpKSB7CiAJCW5ld19pbnRlbF9jcnRjX3N0YXRlID0gdG9f
aW50ZWxfY3J0Y19zdGF0ZShuZXdfY3J0Y19zdGF0ZSk7CiAKLQkJaWYgKGRldl9wcml2LT5kaXNw
bGF5Lm9wdGltaXplX3dhdGVybWFya3MpCi0JCQlkZXZfcHJpdi0+ZGlzcGxheS5vcHRpbWl6ZV93
YXRlcm1hcmtzKGludGVsX3N0YXRlLAorCQlpZiAoaTkxNS0+ZGlzcGxheS5vcHRpbWl6ZV93YXRl
cm1hcmtzKQorCQkJaTkxNS0+ZGlzcGxheS5vcHRpbWl6ZV93YXRlcm1hcmtzKGludGVsX3N0YXRl
LAogCQkJCQkJCSAgICAgIG5ld19pbnRlbF9jcnRjX3N0YXRlKTsKIAl9CiAKQEAgLTEzOTA0LDcg
KzEzOTA0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJaW50ZWxfcG9zdF9wbGFuZV91cGRhdGUodG9faW50
ZWxfY3J0Y19zdGF0ZShvbGRfY3J0Y19zdGF0ZSkpOwogCiAJCWlmIChwdXRfZG9tYWluc1tpXSkK
LQkJCW1vZGVzZXRfcHV0X3Bvd2VyX2RvbWFpbnMoZGV2X3ByaXYsIHB1dF9kb21haW5zW2ldKTsK
KwkJCW1vZGVzZXRfcHV0X3Bvd2VyX2RvbWFpbnMoaTkxNSwgcHV0X2RvbWFpbnNbaV0pOwogCiAJ
CWludGVsX21vZGVzZXRfdmVyaWZ5X2NydGMoY3J0Yywgc3RhdGUsIG9sZF9jcnRjX3N0YXRlLCBu
ZXdfY3J0Y19zdGF0ZSk7CiAJfQpAQCAtMTM5MTMsNyArMTM5MTMsNyBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQog
CQlpbnRlbF92ZXJpZnlfcGxhbmVzKGludGVsX3N0YXRlKTsKIAogCWlmIChpbnRlbF9zdGF0ZS0+
bW9kZXNldCAmJiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQotCQlpbnRlbF9lbmFibGVf
c2FndihkZXZfcHJpdik7CisJCWludGVsX2VuYWJsZV9zYWd2KGk5MTUpOwogCiAJZHJtX2F0b21p
Y19oZWxwZXJfY29tbWl0X2h3X2RvbmUoc3RhdGUpOwogCkBAIC0xMzkyNCwxMCArMTM5MjQsMTAg
QEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAkJICogc28gZW5hYmxlIGRlYnVnZ2luZyBmb3IgdGhlIG5leHQgbW9k
ZXNldCAtIGFuZCBob3BlIHdlIGNhdGNoCiAJCSAqIHRoZSBjdWxwcml0LgogCQkgKi8KLQkJaW50
ZWxfdW5jb3JlX2FybV91bmNsYWltZWRfbW1pb19kZXRlY3Rpb24oJmRldl9wcml2LT51bmNvcmUp
OwotCQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX01PREVT
RVQsIHdha2VyZWYpOworCQlpbnRlbF91bmNvcmVfYXJtX3VuY2xhaW1lZF9tbWlvX2RldGVjdGlv
bigmaTkxNS0+dW5jb3JlKTsKKwkJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJf
RE9NQUlOX01PREVTRVQsIHdha2VyZWYpOwogCX0KLQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZf
cHJpdiwgaW50ZWxfc3RhdGUtPndha2VyZWYpOworCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUs
IGludGVsX3N0YXRlLT53YWtlcmVmKTsKIAogCS8qCiAJICogRGVmZXIgdGhlIGNsZWFudXAgb2Yg
dGhlIG9sZCBzdGF0ZSB0byBhIHNlcGFyYXRlIHdvcmtlciB0byBub3QKQEAgLTE0MDAzLDEwICsx
NDAwMywxMCBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jb21taXQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAkJCSAgICAgICBib29sIG5vbmJsb2NrKQogewogCXN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKmludGVsX3N0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJaW50IHJldCA9IDA7CiAK
LQlpbnRlbF9zdGF0ZS0+d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsK
KwlpbnRlbF9zdGF0ZS0+d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwogCiAJ
ZHJtX2F0b21pY19zdGF0ZV9nZXQoc3RhdGUpOwogCWk5MTVfc3dfZmVuY2VfaW5pdCgmaW50ZWxf
c3RhdGUtPmNvbW1pdF9yZWFkeSwKQEAgLTE0MDI5LDcgKzE0MDI5LDcgQEAgc3RhdGljIGludCBp
bnRlbF9hdG9taWNfY29tbWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJICogRklYTUUgZG9p
bmcgd2F0ZXJtYXJrcyBhbmQgZmIgY2xlYW51cCBmcm9tIGEgdmJsYW5rIHdvcmtlcgogCSAqIChh
c3N1bWluZyB3ZSBoYWQgYW55KSB3b3VsZCBzb2x2ZSB0aGVzZSBwcm9ibGVtcy4KIAkgKi8KLQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkgJiYgc3RhdGUtPmxlZ2FjeV9jdXJzb3JfdXBkYXRl
KSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDkgJiYgc3RhdGUtPmxlZ2FjeV9jdXJzb3JfdXBk
YXRlKSB7CiAJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKIAkJc3Ry
dWN0IGludGVsX2NydGMgKmNydGM7CiAJCWludCBpOwpAQCAtMTQwNDQsNyArMTQwNDQsNyBAQCBz
dGF0aWMgaW50IGludGVsX2F0b21pY19jb21taXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlp
ZiAocmV0KSB7CiAJCURSTV9ERUJVR19BVE9NSUMoIlByZXBhcmluZyBzdGF0ZSBmYWlsZWQgd2l0
aCAlaVxuIiwgcmV0KTsKIAkJaTkxNV9zd19mZW5jZV9jb21taXQoJmludGVsX3N0YXRlLT5jb21t
aXRfcmVhZHkpOwotCQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgaW50ZWxfc3RhdGUt
Pndha2VyZWYpOworCQlpbnRlbF9ydW50aW1lX3BtX3B1dChpOTE1LCBpbnRlbF9zdGF0ZS0+d2Fr
ZXJlZik7CiAJCXJldHVybiByZXQ7CiAJfQogCkBAIC0xNDA1NiwyMSArMTQwNTYsMjEgQEAgc3Rh
dGljIGludCBpbnRlbF9hdG9taWNfY29tbWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCWk5
MTVfc3dfZmVuY2VfY29tbWl0KCZpbnRlbF9zdGF0ZS0+Y29tbWl0X3JlYWR5KTsKIAogCQlkcm1f
YXRvbWljX2hlbHBlcl9jbGVhbnVwX3BsYW5lcyhkZXYsIHN0YXRlKTsKLQkJaW50ZWxfcnVudGlt
ZV9wbV9wdXQoZGV2X3ByaXYsIGludGVsX3N0YXRlLT53YWtlcmVmKTsKKwkJaW50ZWxfcnVudGlt
ZV9wbV9wdXQoaTkxNSwgaW50ZWxfc3RhdGUtPndha2VyZWYpOwogCQlyZXR1cm4gcmV0OwogCX0K
LQlkZXZfcHJpdi0+d20uZGlzdHJ1c3RfYmlvc193bSA9IGZhbHNlOworCWk5MTUtPndtLmRpc3Ry
dXN0X2Jpb3Nfd20gPSBmYWxzZTsKIAlpbnRlbF9zaGFyZWRfZHBsbF9zd2FwX3N0YXRlKHN0YXRl
KTsKIAlpbnRlbF9hdG9taWNfdHJhY2tfZmJzKHN0YXRlKTsKIAogCWlmIChpbnRlbF9zdGF0ZS0+
bW9kZXNldCkgewotCQltZW1jcHkoZGV2X3ByaXYtPm1pbl9jZGNsaywgaW50ZWxfc3RhdGUtPm1p
bl9jZGNsaywKKwkJbWVtY3B5KGk5MTUtPm1pbl9jZGNsaywgaW50ZWxfc3RhdGUtPm1pbl9jZGNs
aywKIAkJICAgICAgIHNpemVvZihpbnRlbF9zdGF0ZS0+bWluX2NkY2xrKSk7Ci0JCW1lbWNweShk
ZXZfcHJpdi0+bWluX3ZvbHRhZ2VfbGV2ZWwsCisJCW1lbWNweShpOTE1LT5taW5fdm9sdGFnZV9s
ZXZlbCwKIAkJICAgICAgIGludGVsX3N0YXRlLT5taW5fdm9sdGFnZV9sZXZlbCwKIAkJICAgICAg
IHNpemVvZihpbnRlbF9zdGF0ZS0+bWluX3ZvbHRhZ2VfbGV2ZWwpKTsKLQkJZGV2X3ByaXYtPmFj
dGl2ZV9jcnRjcyA9IGludGVsX3N0YXRlLT5hY3RpdmVfY3J0Y3M7Ci0JCWRldl9wcml2LT5jZGNs
ay5mb3JjZV9taW5fY2RjbGsgPQorCQlpOTE1LT5hY3RpdmVfY3J0Y3MgPSBpbnRlbF9zdGF0ZS0+
YWN0aXZlX2NydGNzOworCQlpOTE1LT5jZGNsay5mb3JjZV9taW5fY2RjbGsgPQogCQkJaW50ZWxf
c3RhdGUtPmNkY2xrLmZvcmNlX21pbl9jZGNsazsKIAogCQlpbnRlbF9jZGNsa19zd2FwX3N0YXRl
KGludGVsX3N0YXRlKTsKQEAgLTE0MDgxLDEyICsxNDA4MSwxMiBAQCBzdGF0aWMgaW50IGludGVs
X2F0b21pY19jb21taXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCWk5MTVfc3dfZmVuY2Vf
Y29tbWl0KCZpbnRlbF9zdGF0ZS0+Y29tbWl0X3JlYWR5KTsKIAlpZiAobm9uYmxvY2sgJiYgaW50
ZWxfc3RhdGUtPm1vZGVzZXQpIHsKLQkJcXVldWVfd29yayhkZXZfcHJpdi0+bW9kZXNldF93cSwg
JnN0YXRlLT5jb21taXRfd29yayk7CisJCXF1ZXVlX3dvcmsoaTkxNS0+bW9kZXNldF93cSwgJnN0
YXRlLT5jb21taXRfd29yayk7CiAJfSBlbHNlIGlmIChub25ibG9jaykgewogCQlxdWV1ZV93b3Jr
KHN5c3RlbV91bmJvdW5kX3dxLCAmc3RhdGUtPmNvbW1pdF93b3JrKTsKIAl9IGVsc2UgewogCQlp
ZiAoaW50ZWxfc3RhdGUtPm1vZGVzZXQpCi0JCQlmbHVzaF93b3JrcXVldWUoZGV2X3ByaXYtPm1v
ZGVzZXRfd3EpOworCQkJZmx1c2hfd29ya3F1ZXVlKGk5MTUtPm1vZGVzZXRfd3EpOwogCQlpbnRl
bF9hdG9taWNfY29tbWl0X3RhaWwoc3RhdGUpOwogCX0KIApAQCAtMTQxNjYsMTQgKzE0MTY2LDE0
IEBAIHN0YXRpYyB2b2lkIGFkZF9ycHNfYm9vc3RfYWZ0ZXJfdmJsYW5rKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YywKIHN0YXRpYyBpbnQgaW50ZWxfcGxhbmVfcGluX2ZiKHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRv
X2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAlzdHJ1Y3QgaTkx
NV92bWEgKnZtYTsKIAogCWlmIChwbGFuZS0+aWQgPT0gUExBTkVfQ1VSU09SICYmCi0JICAgIElO
VEVMX0lORk8oZGV2X3ByaXYpLT5kaXNwbGF5LmN1cnNvcl9uZWVkc19waHlzaWNhbCkgeworCSAg
ICBJTlRFTF9JTkZPKGk5MTUpLT5kaXNwbGF5LmN1cnNvcl9uZWVkc19waHlzaWNhbCkgewogCQlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gaW50ZWxfZmJfb2JqKGZiKTsKLQkJY29u
c3QgaW50IGFsaWduID0gaW50ZWxfY3Vyc29yX2FsaWdubWVudChkZXZfcHJpdik7CisJCWNvbnN0
IGludCBhbGlnbiA9IGludGVsX2N1cnNvcl9hbGlnbm1lbnQoaTkxNSk7CiAJCWludCBlcnI7CiAK
IAkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzKG9iaiwgYWxpZ24pOwpAQCAtMTQy
MzEsNyArMTQyMzEsNyBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUg
KnBsYW5lLAogewogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0KIAkJ
dG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19zdGF0ZS0+c3RhdGUpOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5kZXYpOwogCXN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gbmV3X3N0YXRlLT5mYjsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqID0gaW50ZWxfZmJfb2JqKGZiKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2xkX29iaiA9IGludGVsX2ZiX29iaihwbGFuZS0+c3RhdGUtPmZiKTsKQEAgLTE0Mjc5LDcgKzE0
Mjc5LDcgQEAgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwK
IAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJcmV0ID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAocmV0KSB7CiAJCWk5MTVf
Z2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCQlyZXR1cm4gcmV0OwpAQCAtMTQyODcsNyAr
MTQyODcsNyBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5l
LAogCiAJcmV0ID0gaW50ZWxfcGxhbmVfcGluX2ZiKHRvX2ludGVsX3BsYW5lX3N0YXRlKG5ld19z
dGF0ZSkpOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fcGFnZXMob2JqKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAtMTQzMjMsNyAr
MTQzMjMsNyBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5l
LAogCSAqIG1heGltdW0gY2xvY2tzIGZvbGxvd2luZyBhIHZibGFuayBtaXNzIChzZWUgZG9fcnBz
X2Jvb3N0KCkpLgogCSAqLwogCWlmICghaW50ZWxfc3RhdGUtPnJwc19pbnRlcmFjdGl2ZSkgewot
CQlpbnRlbF9ycHNfbWFya19pbnRlcmFjdGl2ZShkZXZfcHJpdiwgdHJ1ZSk7CisJCWludGVsX3Jw
c19tYXJrX2ludGVyYWN0aXZlKGk5MTUsIHRydWUpOwogCQlpbnRlbF9zdGF0ZS0+cnBzX2ludGVy
YWN0aXZlID0gdHJ1ZTsKIAl9CiAKQEAgLTE0MzQ1LDE3ICsxNDM0NSwxNyBAQCBpbnRlbF9jbGVh
bnVwX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogewogCXN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0KIAkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG9sZF9z
dGF0ZS0+c3RhdGUpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUocGxhbmUtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KHBsYW5lLT5kZXYpOwogCiAJaWYgKGludGVsX3N0YXRlLT5ycHNfaW50ZXJhY3RpdmUpIHsKLQkJ
aW50ZWxfcnBzX21hcmtfaW50ZXJhY3RpdmUoZGV2X3ByaXYsIGZhbHNlKTsKKwkJaW50ZWxfcnBz
X21hcmtfaW50ZXJhY3RpdmUoaTkxNSwgZmFsc2UpOwogCQlpbnRlbF9zdGF0ZS0+cnBzX2ludGVy
YWN0aXZlID0gZmFsc2U7CiAJfQogCiAJLyogU2hvdWxkIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGEg
c3VjY2Vzc2Z1bCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKCkhICovCi0JbXV0ZXhfbG9jaygmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWludGVsX3BsYW5lX3VucGluX2ZiKHRvX2ludGVsX3BsYW5lX3N0YXRlKG9sZF9z
dGF0ZSkpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAKIGludApAQCAtMTQzNjMs
NyArMTQzNjMsNyBAQCBza2xfbWF4X3NjYWxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCSAgICAgIHUzMiBwaXhlbF9mb3JtYXQpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAlpbnQgbWF4X3NjYWxlLCBtdWx0OwogCWludCBjcnRjX2Nsb2NrLCBtYXhfZG90Y2xrLCB0
bXBjbGsxLCB0bXBjbGsyOwogCkBAIC0xNDM3Myw3ICsxNDM3Myw3IEBAIHNrbF9tYXhfc2NhbGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY3J0Y19jbG9jayA9
IGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCW1heF9kb3RjbGsg
PSB0b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZSktPmNkY2xrLmxv
Z2ljYWwuY2RjbGs7CiAKLQlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwgSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMCkKKwlpZiAoSVNfR0VNSU5JTEFLRShpOTE1KSB8fCBJTlRFTF9HRU4o
aTkxNSkgPj0gMTApCiAJCW1heF9kb3RjbGsgKj0gMjsKIAogCWlmIChXQVJOX09OX09OQ0UoIWNy
dGNfY2xvY2sgfHwgbWF4X2RvdGNsayA8IGNydGNfY2xvY2spKQpAQCAtMTQzOTYsNyArMTQzOTYs
NyBAQCBza2xfbWF4X3NjYWxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogc3RhdGljIHZvaWQgaW50ZWxfYmVnaW5fY3J0Y19jb21taXQoc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlID0KIAkJaW50
ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CiAJc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlID0KQEAgLTE0NDE1LDMxICsxNDQxNSwzMSBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9iZWdpbl9jcnRjX2NvbW1pdChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSwKIAogCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpCiAJCWludGVs
X3VwZGF0ZV9waXBlX2NvbmZpZyhvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOwotCWVs
c2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkx
NSkgPj0gOSkKIAkJc2tsX2RldGFjaF9zY2FsZXJzKG5ld19jcnRjX3N0YXRlKTsKIAotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDkgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKKwlpZiAo
SU5URUxfR0VOKGk5MTUpID49IDkgfHwgSVNfQlJPQURXRUxMKGk5MTUpKQogCQliZHdfc2V0X3Bp
cGVtaXNjKG5ld19jcnRjX3N0YXRlKTsKIAogb3V0OgotCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5h
dG9taWNfdXBkYXRlX3dhdGVybWFya3MpCi0JCWRldl9wcml2LT5kaXNwbGF5LmF0b21pY191cGRh
dGVfd2F0ZXJtYXJrcyhzdGF0ZSwKKwlpZiAoaTkxNS0+ZGlzcGxheS5hdG9taWNfdXBkYXRlX3dh
dGVybWFya3MpCisJCWk5MTUtPmRpc3BsYXkuYXRvbWljX3VwZGF0ZV93YXRlcm1hcmtzKHN0YXRl
LAogCQkJCQkJCSAgIG5ld19jcnRjX3N0YXRlKTsKIH0KIAogdm9pZCBpbnRlbF9jcnRjX2FybV9m
aWZvX3VuZGVycnVuKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAotCWlmICghSVNfR0VOKGRldl9w
cml2LCAyKSkKLQkJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJp
diwgY3J0Yy0+cGlwZSwgdHJ1ZSk7CisJaWYgKCFJU19HRU4oaTkxNSwgMikpCisJCWludGVsX3Nl
dF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgY3J0Yy0+cGlwZSwgdHJ1ZSk7CiAK
IAlpZiAoY3J0Y19zdGF0ZS0+aGFzX3BjaF9lbmNvZGVyKSB7CiAJCWVudW0gcGlwZSBwY2hfdHJh
bnNjb2RlciA9CiAJCQlpbnRlbF9jcnRjX3BjaF90cmFuc2NvZGVyKGNydGMpOwogCi0JCWludGVs
X3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBjaF90cmFuc2NvZGVy
LCB0cnVlKTsKKwkJaW50ZWxfc2V0X3BjaF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBw
Y2hfdHJhbnNjb2RlciwgdHJ1ZSk7CiAJfQogfQogCkBAIC0xNDU1OSw3ICsxNDU1OSw3IEBAIGlu
dGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQkJICAg
dTMyIHNyY193LCB1MzIgc3JjX2gsCiAJCQkgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9j
dHggKmN0eCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNy
dGMtPmRldik7CiAJaW50IHJldDsKIAlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVf
c3RhdGUsICpuZXdfcGxhbmVfc3RhdGU7CiAJc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lKTsKQEAgLTE0NjI2LDcgKzE0NjI2LDcgQEAgaW50ZWxf
bGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkK
IAkJZ290byBvdXRfZnJlZTsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfZnJlZTsK
IApAQCAtMTQ2NjQsNyArMTQ2NjQsNyBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlpbnRlbF9wbGFuZV91bnBpbl9mYih0b19pbnRlbF9wbGFu
ZV9zdGF0ZShvbGRfcGxhbmVfc3RhdGUpKTsKIAogb3V0X3VubG9jazoKLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogb3V0X2ZyZWU6CiAJaWYgKG5ld19jcnRjX3N0YXRlKQogCQlpbnRlbF9j
cnRjX2Rlc3Ryb3lfc3RhdGUoY3J0YywgJm5ld19jcnRjX3N0YXRlLT5iYXNlKTsKQEAgLTE0Njkx
LDI1ICsxNDY5MSwyNSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBpbnRl
bF9jdXJzb3JfcGxhbmVfZnVuY3MgPSB7CiAJLmZvcm1hdF9tb2Rfc3VwcG9ydGVkID0gaW50ZWxf
Y3Vyc29yX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkLAogfTsKIAotc3RhdGljIGJvb2wgaTl4eF9wbGFu
ZV9oYXNfZmJjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBib29s
IGk5eHhfcGxhbmVfaGFzX2ZiYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAg
ICAgICBlbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSkKIHsKLQlpZiAoIUhBU19GQkMoZGV2
X3ByaXYpKQorCWlmICghSEFTX0ZCQyhpOTE1KSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKElT
X0JST0FEV0VMTChkZXZfcHJpdikgfHwgSVNfSEFTV0VMTChkZXZfcHJpdikpCisJaWYgKElTX0JS
T0FEV0VMTChpOTE1KSB8fCBJU19IQVNXRUxMKGk5MTUpKQogCQlyZXR1cm4gaTl4eF9wbGFuZSA9
PSBQTEFORV9BOyAvKiB0aWVkIHRvIHBpcGUgQSAqLwotCWVsc2UgaWYgKElTX0lWWUJSSURHRShk
ZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfSVZZQlJJREdFKGk5MTUpKQogCQlyZXR1cm4gaTl4eF9w
bGFuZSA9PSBQTEFORV9BIHx8IGk5eHhfcGxhbmUgPT0gUExBTkVfQiB8fAogCQkJaTl4eF9wbGFu
ZSA9PSBQTEFORV9DOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKKwllbHNl
IGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkKIAkJcmV0dXJuIGk5eHhfcGxhbmUgPT0gUExBTkVf
QSB8fCBpOXh4X3BsYW5lID09IFBMQU5FX0I7CiAJZWxzZQogCQlyZXR1cm4gaTl4eF9wbGFuZSA9
PSBQTEFORV9BOwogfQogCiBzdGF0aWMgc3RydWN0IGludGVsX3BsYW5lICoKLWludGVsX3ByaW1h
cnlfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBw
aXBlIHBpcGUpCitpbnRlbF9wcmltYXJ5X3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZTsKIAljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzICpwbGFuZV9mdW5jczsKQEAgLTE0NzIw
LDggKzE0NzIwLDggQEAgaW50ZWxfcHJpbWFyeV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKIAlpbnQgbnVtX2Zvcm1hdHM7CiAJ
aW50IHJldDsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCi0JCXJldHVybiBza2xf
dW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSwKKwlpZiAoSU5URUxfR0VOKGk5
MTUpID49IDkpCisJCXJldHVybiBza2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShpOTE1LCBwaXBl
LAogCQkJCQkJICBQTEFORV9QUklNQVJZKTsKIAogCXBsYW5lID0gaW50ZWxfcGxhbmVfYWxsb2Mo
KTsKQEAgLTE0NzMzLDIxICsxNDczMywyMSBAQCBpbnRlbF9wcmltYXJ5X3BsYW5lX2NyZWF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQogCSAqIE9u
IGdlbjIvMyBvbmx5IHBsYW5lIEEgY2FuIGRvIEZCQywgYnV0IHRoZSBwYW5lbCBmaXR0ZXIgYW5k
IExWRFMKIAkgKiBwb3J0IGlzIGhvb2tlZCB0byBwaXBlIEIuIEhlbmNlIHdlIHdhbnQgcGxhbmUg
QSBmZWVkaW5nIHBpcGUgQi4KIAkgKi8KLQlpZiAoSEFTX0ZCQyhkZXZfcHJpdikgJiYgSU5URUxf
R0VOKGRldl9wcml2KSA8IDQpCisJaWYgKEhBU19GQkMoaTkxNSkgJiYgSU5URUxfR0VOKGk5MTUp
IDwgNCkKIAkJcGxhbmUtPmk5eHhfcGxhbmUgPSAoZW51bSBpOXh4X3BsYW5lX2lkKSAhcGlwZTsK
IAllbHNlCiAJCXBsYW5lLT5pOXh4X3BsYW5lID0gKGVudW0gaTl4eF9wbGFuZV9pZCkgcGlwZTsK
IAlwbGFuZS0+aWQgPSBQTEFORV9QUklNQVJZOwogCXBsYW5lLT5mcm9udGJ1ZmZlcl9iaXQgPSBJ
TlRFTF9GUk9OVEJVRkZFUihwaXBlLCBwbGFuZS0+aWQpOwogCi0JcGxhbmUtPmhhc19mYmMgPSBp
OXh4X3BsYW5lX2hhc19mYmMoZGV2X3ByaXYsIHBsYW5lLT5pOXh4X3BsYW5lKTsKKwlwbGFuZS0+
aGFzX2ZiYyA9IGk5eHhfcGxhbmVfaGFzX2ZiYyhpOTE1LCBwbGFuZS0+aTl4eF9wbGFuZSk7CiAJ
aWYgKHBsYW5lLT5oYXNfZmJjKSB7Ci0JCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJp
di0+ZmJjOworCQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCiAJCWZiYy0+
cG9zc2libGVfZnJhbWVidWZmZXJfYml0cyB8PSBwbGFuZS0+ZnJvbnRidWZmZXJfYml0OwogCX0K
IAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDQpIHsKIAkJZm9ybWF0cyA9IGk5NjVfcHJpbWFyeV9mb3JtYXRzOwogCQludW1fZm9ybWF0
cyA9IEFSUkFZX1NJWkUoaTk2NV9wcmltYXJ5X2Zvcm1hdHMpOwogCQltb2RpZmllcnMgPSBpOXh4
X2Zvcm1hdF9tb2RpZmllcnM7CkBAIC0xNDc3NSwxNCArMTQ3NzUsMTQgQEAgaW50ZWxfcHJpbWFy
eV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBp
cGUgcGlwZSkKIAogCXBvc3NpYmxlX2NydGNzID0gQklUKHBpcGUpOwogCi0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gNSB8fCBJU19HNFgoZGV2X3ByaXYpKQotCQlyZXQgPSBkcm1fdW5pdmVy
c2FsX3BsYW5lX2luaXQoJmRldl9wcml2LT5kcm0sICZwbGFuZS0+YmFzZSwKKwlpZiAoSU5URUxf
R0VOKGk5MTUpID49IDUgfHwgSVNfRzRYKGk5MTUpKQorCQlyZXQgPSBkcm1fdW5pdmVyc2FsX3Bs
YW5lX2luaXQoJmk5MTUtPmRybSwgJnBsYW5lLT5iYXNlLAogCQkJCQkgICAgICAgcG9zc2libGVf
Y3J0Y3MsIHBsYW5lX2Z1bmNzLAogCQkJCQkgICAgICAgZm9ybWF0cywgbnVtX2Zvcm1hdHMsIG1v
ZGlmaWVycywKIAkJCQkJICAgICAgIERSTV9QTEFORV9UWVBFX1BSSU1BUlksCiAJCQkJCSAgICAg
ICAicHJpbWFyeSAlYyIsIHBpcGVfbmFtZShwaXBlKSk7CiAJZWxzZQotCQlyZXQgPSBkcm1fdW5p
dmVyc2FsX3BsYW5lX2luaXQoJmRldl9wcml2LT5kcm0sICZwbGFuZS0+YmFzZSwKKwkJcmV0ID0g
ZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KCZpOTE1LT5kcm0sICZwbGFuZS0+YmFzZSwKIAkJCQkJ
ICAgICAgIHBvc3NpYmxlX2NydGNzLCBwbGFuZV9mdW5jcywKIAkJCQkJICAgICAgIGZvcm1hdHMs
IG51bV9mb3JtYXRzLCBtb2RpZmllcnMsCiAJCQkJCSAgICAgICBEUk1fUExBTkVfVFlQRV9QUklN
QVJZLApAQCAtMTQ3OTEsMTggKzE0NzkxLDE4IEBAIGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJaWYg
KHJldCkKIAkJZ290byBmYWlsOwogCi0JaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpICYmIHBp
cGUgPT0gUElQRV9CKSB7CisJaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkgJiYgcGlwZSA9PSBQSVBF
X0IpIHsKIAkJc3VwcG9ydGVkX3JvdGF0aW9ucyA9CiAJCQlEUk1fTU9ERV9ST1RBVEVfMCB8IERS
TV9NT0RFX1JPVEFURV8xODAgfAogCQkJRFJNX01PREVfUkVGTEVDVF9YOwotCX0gZWxzZSBpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkg
Pj0gNCkgewogCQlzdXBwb3J0ZWRfcm90YXRpb25zID0KIAkJCURSTV9NT0RFX1JPVEFURV8wIHwg
RFJNX01PREVfUk9UQVRFXzE4MDsKIAl9IGVsc2UgewogCQlzdXBwb3J0ZWRfcm90YXRpb25zID0g
RFJNX01PREVfUk9UQVRFXzA7CiAJfQogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkK
KwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDQpCiAJCWRybV9wbGFuZV9jcmVhdGVfcm90YXRpb25f
cHJvcGVydHkoJnBsYW5lLT5iYXNlLAogCQkJCQkJICAgRFJNX01PREVfUk9UQVRFXzAsCiAJCQkJ
CQkgICBzdXBwb3J0ZWRfcm90YXRpb25zKTsKQEAgLTE0ODE4LDcgKzE0ODE4LDcgQEAgaW50ZWxf
cHJpbWFyeV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIHBpcGUgcGlwZSkKIH0KIAogc3RhdGljIHN0cnVjdCBpbnRlbF9wbGFuZSAqCi1pbnRlbF9j
dXJzb3JfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2lu
dGVsX2N1cnNvcl9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkgIGVudW0gcGlwZSBwaXBlKQogewogCXVuc2lnbmVkIGludCBwb3NzaWJsZV9jcnRjczsKQEAg
LTE0ODM0LDcgKzE0ODM0LDcgQEAgaW50ZWxfY3Vyc29yX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJY3Vyc29yLT5pZCA9IFBMQU5FX0NVUlNPUjsKIAlj
dXJzb3ItPmZyb250YnVmZmVyX2JpdCA9IElOVEVMX0ZST05UQlVGRkVSKHBpcGUsIGN1cnNvci0+
aWQpOwogCi0JaWYgKElTX0k4NDVHKGRldl9wcml2KSB8fCBJU19JODY1RyhkZXZfcHJpdikpIHsK
KwlpZiAoSVNfSTg0NUcoaTkxNSkgfHwgSVNfSTg2NUcoaTkxNSkpIHsKIAkJY3Vyc29yLT5tYXhf
c3RyaWRlID0gaTg0NV9jdXJzb3JfbWF4X3N0cmlkZTsKIAkJY3Vyc29yLT51cGRhdGVfcGxhbmUg
PSBpODQ1X3VwZGF0ZV9jdXJzb3I7CiAJCWN1cnNvci0+ZGlzYWJsZV9wbGFuZSA9IGk4NDVfZGlz
YWJsZV9jdXJzb3I7CkBAIC0xNDg1MSwxMiArMTQ4NTEsMTIgQEAgaW50ZWxfY3Vyc29yX3BsYW5l
X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJY3Vyc29yLT5jdXJz
b3IuYmFzZSA9IH4wOwogCWN1cnNvci0+Y3Vyc29yLmNudGwgPSB+MDsKIAotCWlmIChJU19JODQ1
RyhkZXZfcHJpdikgfHwgSVNfSTg2NUcoZGV2X3ByaXYpIHx8IEhBU19DVVJfRkJDKGRldl9wcml2
KSkKKwlpZiAoSVNfSTg0NUcoaTkxNSkgfHwgSVNfSTg2NUcoaTkxNSkgfHwgSEFTX0NVUl9GQkMo
aTkxNSkpCiAJCWN1cnNvci0+Y3Vyc29yLnNpemUgPSB+MDsKIAogCXBvc3NpYmxlX2NydGNzID0g
QklUKHBpcGUpOwogCi0JcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KCZkZXZfcHJpdi0+
ZHJtLCAmY3Vyc29yLT5iYXNlLAorCXJldCA9IGRybV91bml2ZXJzYWxfcGxhbmVfaW5pdCgmaTkx
NS0+ZHJtLCAmY3Vyc29yLT5iYXNlLAogCQkJCSAgICAgICBwb3NzaWJsZV9jcnRjcywgJmludGVs
X2N1cnNvcl9wbGFuZV9mdW5jcywKIAkJCQkgICAgICAgaW50ZWxfY3Vyc29yX2Zvcm1hdHMsCiAJ
CQkJICAgICAgIEFSUkFZX1NJWkUoaW50ZWxfY3Vyc29yX2Zvcm1hdHMpLApAQCAtMTQ4NjYsNyAr
MTQ4NjYsNyBAQCBpbnRlbF9jdXJzb3JfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAlpZiAocmV0KQogCQlnb3RvIGZhaWw7CiAKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA0KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkKIAkJZHJtX3BsYW5l
X2NyZWF0ZV9yb3RhdGlvbl9wcm9wZXJ0eSgmY3Vyc29yLT5iYXNlLAogCQkJCQkJICAgRFJNX01P
REVfUk9UQVRFXzAsCiAJCQkJCQkgICBEUk1fTU9ERV9ST1RBVEVfMCB8CkBAIC0xNDg4NywxMCAr
MTQ4ODcsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19pbml0X3NjYWxlcnMoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiB7CiAJc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2Fs
ZXJfc3RhdGUgPQogCQkmY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJaW50IGk7
CiAKLQljcnRjLT5udW1fc2NhbGVycyA9IFJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPm51bV9zY2Fs
ZXJzW2NydGMtPnBpcGVdOworCWNydGMtPm51bV9zY2FsZXJzID0gUlVOVElNRV9JTkZPKGk5MTUp
LT5udW1fc2NhbGVyc1tjcnRjLT5waXBlXTsKIAlpZiAoIWNydGMtPm51bV9zY2FsZXJzKQogCQly
ZXR1cm47CiAKQEAgLTE0OTA0LDcgKzE0OTA0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19p
bml0X3NjYWxlcnMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJc2NhbGVyX3N0YXRlLT5zY2Fs
ZXJfaWQgPSAtMTsKIH0KIAotc3RhdGljIGludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKK3N0YXRpYyBpbnQgaW50ZWxf
Y3J0Y19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBpcGUgcGlwZSkK
IHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSA9IE5VTEw7CkBAIC0xNDkyNCwxNyArMTQ5MjQsMTcgQEAgc3RhdGlj
IGludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIHBpcGUgcGlwZSkKIAlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfcmVzZXQoJmludGVsX2Ny
dGMtPmJhc2UsICZjcnRjX3N0YXRlLT5iYXNlKTsKIAlpbnRlbF9jcnRjLT5jb25maWcgPSBjcnRj
X3N0YXRlOwogCi0JcHJpbWFyeSA9IGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRlKGRldl9wcml2
LCBwaXBlKTsKKwlwcmltYXJ5ID0gaW50ZWxfcHJpbWFyeV9wbGFuZV9jcmVhdGUoaTkxNSwgcGlw
ZSk7CiAJaWYgKElTX0VSUihwcmltYXJ5KSkgewogCQlyZXQgPSBQVFJfRVJSKHByaW1hcnkpOwog
CQlnb3RvIGZhaWw7CiAJfQogCWludGVsX2NydGMtPnBsYW5lX2lkc19tYXNrIHw9IEJJVChwcmlt
YXJ5LT5pZCk7CiAKLQlmb3JfZWFjaF9zcHJpdGUoZGV2X3ByaXYsIHBpcGUsIHNwcml0ZSkgewor
CWZvcl9lYWNoX3Nwcml0ZShpOTE1LCBwaXBlLCBzcHJpdGUpIHsKIAkJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZTsKIAotCQlwbGFuZSA9IGludGVsX3Nwcml0ZV9wbGFuZV9jcmVhdGUoZGV2X3By
aXYsIHBpcGUsIHNwcml0ZSk7CisJCXBsYW5lID0gaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShp
OTE1LCBwaXBlLCBzcHJpdGUpOwogCQlpZiAoSVNfRVJSKHBsYW5lKSkgewogCQkJcmV0ID0gUFRS
X0VSUihwbGFuZSk7CiAJCQlnb3RvIGZhaWw7CkBAIC0xNDk0MiwxNCArMTQ5NDIsMTQgQEAgc3Rh
dGljIGludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBlbnVtIHBpcGUgcGlwZSkKIAkJaW50ZWxfY3J0Yy0+cGxhbmVfaWRzX21hc2sgfD0gQklUKHBs
YW5lLT5pZCk7CiAJfQogCi0JY3Vyc29yID0gaW50ZWxfY3Vyc29yX3BsYW5lX2NyZWF0ZShkZXZf
cHJpdiwgcGlwZSk7CisJY3Vyc29yID0gaW50ZWxfY3Vyc29yX3BsYW5lX2NyZWF0ZShpOTE1LCBw
aXBlKTsKIAlpZiAoSVNfRVJSKGN1cnNvcikpIHsKIAkJcmV0ID0gUFRSX0VSUihjdXJzb3IpOwog
CQlnb3RvIGZhaWw7CiAJfQogCWludGVsX2NydGMtPnBsYW5lX2lkc19tYXNrIHw9IEJJVChjdXJz
b3ItPmlkKTsKIAotCXJldCA9IGRybV9jcnRjX2luaXRfd2l0aF9wbGFuZXMoJmRldl9wcml2LT5k
cm0sICZpbnRlbF9jcnRjLT5iYXNlLAorCXJldCA9IGRybV9jcnRjX2luaXRfd2l0aF9wbGFuZXMo
Jmk5MTUtPmRybSwgJmludGVsX2NydGMtPmJhc2UsCiAJCQkJCSZwcmltYXJ5LT5iYXNlLCAmY3Vy
c29yLT5iYXNlLAogCQkJCQkmaW50ZWxfY3J0Y19mdW5jcywKIAkJCQkJInBpcGUgJWMiLCBwaXBl
X25hbWUocGlwZSkpOwpAQCAtMTQ5NjEsMTYgKzE0OTYxLDE2IEBAIHN0YXRpYyBpbnQgaW50ZWxf
Y3J0Y19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBp
cGUpCiAJLyogaW5pdGlhbGl6ZSBzaGFyZWQgc2NhbGVycyAqLwogCWludGVsX2NydGNfaW5pdF9z
Y2FsZXJzKGludGVsX2NydGMsIGNydGNfc3RhdGUpOwogCi0JQlVHX09OKHBpcGUgPj0gQVJSQVlf
U0laRShkZXZfcHJpdi0+cGlwZV90b19jcnRjX21hcHBpbmcpIHx8Ci0JICAgICAgIGRldl9wcml2
LT5waXBlX3RvX2NydGNfbWFwcGluZ1twaXBlXSAhPSBOVUxMKTsKLQlkZXZfcHJpdi0+cGlwZV90
b19jcnRjX21hcHBpbmdbcGlwZV0gPSBpbnRlbF9jcnRjOworCUJVR19PTihwaXBlID49IEFSUkFZ
X1NJWkUoaTkxNS0+cGlwZV90b19jcnRjX21hcHBpbmcpIHx8CisJICAgICAgIGk5MTUtPnBpcGVf
dG9fY3J0Y19tYXBwaW5nW3BpcGVdICE9IE5VTEwpOworCWk5MTUtPnBpcGVfdG9fY3J0Y19tYXBw
aW5nW3BpcGVdID0gaW50ZWxfY3J0YzsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSkg
eworCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA5KSB7CiAJCWVudW0gaTl4eF9wbGFuZV9pZCBpOXh4
X3BsYW5lID0gcHJpbWFyeS0+aTl4eF9wbGFuZTsKIAotCQlCVUdfT04oaTl4eF9wbGFuZSA+PSBB
UlJBWV9TSVpFKGRldl9wcml2LT5wbGFuZV90b19jcnRjX21hcHBpbmcpIHx8Ci0JCSAgICAgICBk
ZXZfcHJpdi0+cGxhbmVfdG9fY3J0Y19tYXBwaW5nW2k5eHhfcGxhbmVdICE9IE5VTEwpOwotCQlk
ZXZfcHJpdi0+cGxhbmVfdG9fY3J0Y19tYXBwaW5nW2k5eHhfcGxhbmVdID0gaW50ZWxfY3J0YzsK
KwkJQlVHX09OKGk5eHhfcGxhbmUgPj0gQVJSQVlfU0laRShpOTE1LT5wbGFuZV90b19jcnRjX21h
cHBpbmcpIHx8CisJCSAgICAgICBpOTE1LT5wbGFuZV90b19jcnRjX21hcHBpbmdbaTl4eF9wbGFu
ZV0gIT0gTlVMTCk7CisJCWk5MTUtPnBsYW5lX3RvX2NydGNfbWFwcGluZ1tpOXh4X3BsYW5lXSA9
IGludGVsX2NydGM7CiAJfQogCiAJZHJtX2NydGNfaGVscGVyX2FkZCgmaW50ZWxfY3J0Yy0+YmFz
ZSwgJmludGVsX2hlbHBlcl9mdW5jcyk7CkBAIC0xNTAyNiwyOSArMTUwMjYsMjkgQEAgc3RhdGlj
IGludCBpbnRlbF9lbmNvZGVyX2Nsb25lcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikK
IAlyZXR1cm4gaW5kZXhfbWFzazsKIH0KIAotc3RhdGljIGJvb2wgaWxrX2hhc19lZHBfYShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBpbGtfaGFzX2VkcF9h
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlmICghSVNfTU9CSUxFKGRldl9w
cml2KSkKKwlpZiAoIUlTX01PQklMRShpOTE1KSkKIAkJcmV0dXJuIGZhbHNlOwogCiAJaWYgKChJ
OTE1X1JFQUQoRFBfQSkgJiBEUF9ERVRFQ1RFRCkgPT0gMCkKIAkJcmV0dXJuIGZhbHNlOwogCi0J
aWYgKElTX0dFTihkZXZfcHJpdiwgNSkgJiYgKEk5MTVfUkVBRChGVVNFX1NUUkFQKSAmIElMS19l
RFBfQV9ESVNBQkxFKSkKKwlpZiAoSVNfR0VOKGk5MTUsIDUpICYmIChJOTE1X1JFQUQoRlVTRV9T
VFJBUCkgJiBJTEtfZURQX0FfRElTQUJMRSkpCiAJCXJldHVybiBmYWxzZTsKIAogCXJldHVybiB0
cnVlOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9kZGlfY3J0X3ByZXNlbnQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGJvb2wgaW50ZWxfZGRpX2NydF9wcmVzZW50
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDkpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQlyZXR1cm4gZmFsc2U7CiAK
LQlpZiAoSVNfSFNXX1VMVChkZXZfcHJpdikgfHwgSVNfQkRXX1VMVChkZXZfcHJpdikpCisJaWYg
KElTX0hTV19VTFQoaTkxNSkgfHwgSVNfQkRXX1VMVChpOTE1KSkKIAkJcmV0dXJuIGZhbHNlOwog
Ci0JaWYgKEhBU19QQ0hfTFBUX0goZGV2X3ByaXYpICYmCisJaWYgKEhBU19QQ0hfTFBUX0goaTkx
NSkgJiYKIAkgICAgSTkxNV9SRUFEKFNGVVNFX1NUUkFQKSAmIFNGVVNFX1NUUkFQX0NSVF9ESVNB
QkxFRCkKIAkJcmV0dXJuIGZhbHNlOwogCkBAIC0xNTA1NiwyNCArMTUwNTYsMjQgQEAgc3RhdGlj
IGJvb2wgaW50ZWxfZGRpX2NydF9wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAlpZiAoSTkxNV9SRUFEKERESV9CVUZfQ1RMKFBPUlRfQSkpICYgRERJX0FfNF9MQU5F
UykKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKCFkZXZfcHJpdi0+dmJ0LmludF9jcnRfc3VwcG9y
dCkKKwlpZiAoIWk5MTUtPnZidC5pbnRfY3J0X3N1cHBvcnQpCiAJCXJldHVybiBmYWxzZTsKIAog
CXJldHVybiB0cnVlOwogfQogCi12b2lkIGludGVsX3Bwc191bmxvY2tfcmVnc193YShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX3Bwc191bmxvY2tfcmVnc193
YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgcHBzX251bTsKIAlpbnQg
cHBzX2lkeDsKIAotCWlmIChIQVNfRERJKGRldl9wcml2KSkKKwlpZiAoSEFTX0RESShpOTE1KSkK
IAkJcmV0dXJuOwogCS8qCiAJICogVGhpcyB3L2EgaXMgbmVlZGVkIGF0IGxlYXN0IG9uIENQVC9Q
UFQsIGJ1dCB0byBiZSBzdXJlIGFwcGx5IGl0CiAJICogZXZlcnl3aGVyZSB3aGVyZSByZWdpc3Rl
cnMgY2FuIGJlIHdyaXRlIHByb3RlY3RlZC4KIAkgKi8KLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZf
cHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJaWYgKElTX1ZBTExFWVZJRVcoaTkx
NSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJcHBzX251bSA9IDI7CiAJZWxzZQogCQlwcHNf
bnVtID0gMTsKQEAgLTE1MDg2LDY1ICsxNTA4Niw2NSBAQCB2b2lkIGludGVsX3Bwc191bmxvY2tf
cmVnc193YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0
aWMgdm9pZCBpbnRlbF9wcHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCBpbnRlbF9wcHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKLQlpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikgfHwgSVNfR0VOOV9MUChkZXZfcHJp
dikpCi0JCWRldl9wcml2LT5wcHNfbW1pb19iYXNlID0gUENIX1BQU19CQVNFOwotCWVsc2UgaWYg
KElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQotCQlk
ZXZfcHJpdi0+cHBzX21taW9fYmFzZSA9IFZMVl9QUFNfQkFTRTsKKwlpZiAoSEFTX1BDSF9TUExJ
VChpOTE1KSB8fCBJU19HRU45X0xQKGk5MTUpKQorCQlpOTE1LT5wcHNfbW1pb19iYXNlID0gUENI
X1BQU19CQVNFOworCWVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklF
VyhpOTE1KSkKKwkJaTkxNS0+cHBzX21taW9fYmFzZSA9IFZMVl9QUFNfQkFTRTsKIAllbHNlCi0J
CWRldl9wcml2LT5wcHNfbW1pb19iYXNlID0gUFBTX0JBU0U7CisJCWk5MTUtPnBwc19tbWlvX2Jh
c2UgPSBQUFNfQkFTRTsKIAotCWludGVsX3Bwc191bmxvY2tfcmVnc193YShkZXZfcHJpdik7CisJ
aW50ZWxfcHBzX3VubG9ja19yZWdzX3dhKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9z
ZXR1cF9vdXRwdXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIGludGVsX3NldHVwX291dHB1dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAJYm9vbCBkcGRfaXNfZWRwID0gZmFs
c2U7CiAKLQlpbnRlbF9wcHNfaW5pdChkZXZfcHJpdik7CisJaW50ZWxfcHBzX2luaXQoaTkxNSk7
CiAKLQlpZiAoIUhBU19ESVNQTEFZKGRldl9wcml2KSkKKwlpZiAoIUhBU19ESVNQTEFZKGk5MTUp
KQogCQlyZXR1cm47CiAKLQlpZiAoSVNfRUxLSEFSVExBS0UoZGV2X3ByaXYpKSB7Ci0JCWludGVs
X2RkaV9pbml0KGRldl9wcml2LCBQT1JUX0EpOwotCQlpbnRlbF9kZGlfaW5pdChkZXZfcHJpdiwg
UE9SVF9CKTsKLQkJaW50ZWxfZGRpX2luaXQoZGV2X3ByaXYsIFBPUlRfQyk7Ci0JCWljbF9kc2lf
aW5pdChkZXZfcHJpdik7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7
Ci0JCWludGVsX2RkaV9pbml0KGRldl9wcml2LCBQT1JUX0EpOwotCQlpbnRlbF9kZGlfaW5pdChk
ZXZfcHJpdiwgUE9SVF9CKTsKLQkJaW50ZWxfZGRpX2luaXQoZGV2X3ByaXYsIFBPUlRfQyk7Ci0J
CWludGVsX2RkaV9pbml0KGRldl9wcml2LCBQT1JUX0QpOwotCQlpbnRlbF9kZGlfaW5pdChkZXZf
cHJpdiwgUE9SVF9FKTsKKwlpZiAoSVNfRUxLSEFSVExBS0UoaTkxNSkpIHsKKwkJaW50ZWxfZGRp
X2luaXQoaTkxNSwgUE9SVF9BKTsKKwkJaW50ZWxfZGRpX2luaXQoaTkxNSwgUE9SVF9CKTsKKwkJ
aW50ZWxfZGRpX2luaXQoaTkxNSwgUE9SVF9DKTsKKwkJaWNsX2RzaV9pbml0KGk5MTUpOworCX0g
ZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKSB7CisJCWludGVsX2RkaV9pbml0KGk5MTUs
IFBPUlRfQSk7CisJCWludGVsX2RkaV9pbml0KGk5MTUsIFBPUlRfQik7CisJCWludGVsX2RkaV9p
bml0KGk5MTUsIFBPUlRfQyk7CisJCWludGVsX2RkaV9pbml0KGk5MTUsIFBPUlRfRCk7CisJCWlu
dGVsX2RkaV9pbml0KGk5MTUsIFBPUlRfRSk7CiAJCS8qCiAJCSAqIE9uIHNvbWUgSUNMIFNLVXMg
cG9ydCBGIGlzIG5vdCBwcmVzZW50LiBObyBzdHJhcCBiaXRzIGZvcgogCQkgKiB0aGlzLCBzbyBy
ZWx5IG9uIFZCVC4KIAkJICogV29yayBhcm91bmQgYnJva2VuIFZCVHMgb24gU0tVcyBrbm93biB0
byBoYXZlIG5vIHBvcnQgRi4KIAkJICovCi0JCWlmIChJU19JQ0xfV0lUSF9QT1JUX0YoZGV2X3By
aXYpICYmCi0JCSAgICBpbnRlbF9iaW9zX2lzX3BvcnRfcHJlc2VudChkZXZfcHJpdiwgUE9SVF9G
KSkKLQkJCWludGVsX2RkaV9pbml0KGRldl9wcml2LCBQT1JUX0YpOworCQlpZiAoSVNfSUNMX1dJ
VEhfUE9SVF9GKGk5MTUpICYmCisJCSAgICBpbnRlbF9iaW9zX2lzX3BvcnRfcHJlc2VudChpOTE1
LCBQT1JUX0YpKQorCQkJaW50ZWxfZGRpX2luaXQoaTkxNSwgUE9SVF9GKTsKIAotCQlpY2xfZHNp
X2luaXQoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKKwkJ
aWNsX2RzaV9pbml0KGk5MTUpOworCX0gZWxzZSBpZiAoSVNfR0VOOV9MUChpOTE1KSkgewogCQkv
KgogCQkgKiBGSVhNRTogQnJveHRvbiBkb2Vzbid0IHN1cHBvcnQgcG9ydCBkZXRlY3Rpb24gdmlh
IHRoZQogCQkgKiBERElfQlVGX0NUTF9BIG9yIFNGVVNFX1NUUkFQIHJlZ2lzdGVycywgZmluZCBh
bm90aGVyIHdheSB0bwogCQkgKiBkZXRlY3QgdGhlIHBvcnRzLgogCQkgKi8KLQkJaW50ZWxfZGRp
X2luaXQoZGV2X3ByaXYsIFBPUlRfQSk7Ci0JCWludGVsX2RkaV9pbml0KGRldl9wcml2LCBQT1JU
X0IpOwotCQlpbnRlbF9kZGlfaW5pdChkZXZfcHJpdiwgUE9SVF9DKTsKKwkJaW50ZWxfZGRpX2lu
aXQoaTkxNSwgUE9SVF9BKTsKKwkJaW50ZWxfZGRpX2luaXQoaTkxNSwgUE9SVF9CKTsKKwkJaW50
ZWxfZGRpX2luaXQoaTkxNSwgUE9SVF9DKTsKIAotCQl2bHZfZHNpX2luaXQoZGV2X3ByaXYpOwot
CX0gZWxzZSBpZiAoSEFTX0RESShkZXZfcHJpdikpIHsKKwkJdmx2X2RzaV9pbml0KGk5MTUpOwor
CX0gZWxzZSBpZiAoSEFTX0RESShpOTE1KSkgewogCQlpbnQgZm91bmQ7CiAKLQkJaWYgKGludGVs
X2RkaV9jcnRfcHJlc2VudChkZXZfcHJpdikpCi0JCQlpbnRlbF9jcnRfaW5pdChkZXZfcHJpdik7
CisJCWlmIChpbnRlbF9kZGlfY3J0X3ByZXNlbnQoaTkxNSkpCisJCQlpbnRlbF9jcnRfaW5pdChp
OTE1KTsKIAogCQkvKgogCQkgKiBIYXN3ZWxsIHVzZXMgRERJIGZ1bmN0aW9ucyB0byBkZXRlY3Qg
ZGlnaXRhbCBvdXRwdXRzLgpAQCAtMTUxNTMsMjkgKzE1MTUzLDI5IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3NldHVwX291dHB1dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkg
Ki8KIAkJZm91bmQgPSBJOTE1X1JFQUQoRERJX0JVRl9DVEwoUE9SVF9BKSkgJiBERElfSU5JVF9E
SVNQTEFZX0RFVEVDVEVEOwogCQkvKiBXYUlnbm9yZURESUFTdHJhcDogc2tsICovCi0JCWlmIChm
b3VuZCB8fCBJU19HRU45X0JDKGRldl9wcml2KSkKLQkJCWludGVsX2RkaV9pbml0KGRldl9wcml2
LCBQT1JUX0EpOworCQlpZiAoZm91bmQgfHwgSVNfR0VOOV9CQyhpOTE1KSkKKwkJCWludGVsX2Rk
aV9pbml0KGk5MTUsIFBPUlRfQSk7CiAKIAkJLyogRERJIEIsIEMsIEQsIGFuZCBGIGRldGVjdGlv
biBpcyBpbmRpY2F0ZWQgYnkgdGhlIFNGVVNFX1NUUkFQCiAJCSAqIHJlZ2lzdGVyICovCiAJCWZv
dW5kID0gSTkxNV9SRUFEKFNGVVNFX1NUUkFQKTsKIAogCQlpZiAoZm91bmQgJiBTRlVTRV9TVFJB
UF9ERElCX0RFVEVDVEVEKQotCQkJaW50ZWxfZGRpX2luaXQoZGV2X3ByaXYsIFBPUlRfQik7CisJ
CQlpbnRlbF9kZGlfaW5pdChpOTE1LCBQT1JUX0IpOwogCQlpZiAoZm91bmQgJiBTRlVTRV9TVFJB
UF9ERElDX0RFVEVDVEVEKQotCQkJaW50ZWxfZGRpX2luaXQoZGV2X3ByaXYsIFBPUlRfQyk7CisJ
CQlpbnRlbF9kZGlfaW5pdChpOTE1LCBQT1JUX0MpOwogCQlpZiAoZm91bmQgJiBTRlVTRV9TVFJB
UF9ERElEX0RFVEVDVEVEKQotCQkJaW50ZWxfZGRpX2luaXQoZGV2X3ByaXYsIFBPUlRfRCk7CisJ
CQlpbnRlbF9kZGlfaW5pdChpOTE1LCBQT1JUX0QpOwogCQlpZiAoZm91bmQgJiBTRlVTRV9TVFJB
UF9ERElGX0RFVEVDVEVEKQotCQkJaW50ZWxfZGRpX2luaXQoZGV2X3ByaXYsIFBPUlRfRik7CisJ
CQlpbnRlbF9kZGlfaW5pdChpOTE1LCBQT1JUX0YpOwogCQkvKgogCQkgKiBPbiBTS0wgd2UgZG9u
J3QgaGF2ZSBhIHdheSB0byBkZXRlY3QgRERJLUUgc28gd2UgcmVseSBvbiBWQlQuCiAJCSAqLwot
CQlpZiAoSVNfR0VOOV9CQyhkZXZfcHJpdikgJiYKLQkJICAgIGludGVsX2Jpb3NfaXNfcG9ydF9w
cmVzZW50KGRldl9wcml2LCBQT1JUX0UpKQotCQkJaW50ZWxfZGRpX2luaXQoZGV2X3ByaXYsIFBP
UlRfRSk7CisJCWlmIChJU19HRU45X0JDKGk5MTUpICYmCisJCSAgICBpbnRlbF9iaW9zX2lzX3Bv
cnRfcHJlc2VudChpOTE1LCBQT1JUX0UpKQorCQkJaW50ZWxfZGRpX2luaXQoaTkxNSwgUE9SVF9F
KTsKIAotCX0gZWxzZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYg
KEhBU19QQ0hfU1BMSVQoaTkxNSkpIHsKIAkJaW50IGZvdW5kOwogCiAJCS8qCkBAIC0xNTE4Mywz
OSArMTUxODMsMzkgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2V0dXBfb3V0cHV0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIHRvIHByZXZlbnQgdGhlIHJlZ2lzdHJhdGlv
biBvZiBib3RoIGVEUCBhbmQgTFZEUyBhbmQgdGhlCiAJCSAqIGluY29ycmVjdCBzaGFyaW5nIG9m
IHRoZSBQUFMuCiAJCSAqLwotCQlpbnRlbF9sdmRzX2luaXQoZGV2X3ByaXYpOwotCQlpbnRlbF9j
cnRfaW5pdChkZXZfcHJpdik7CisJCWludGVsX2x2ZHNfaW5pdChpOTE1KTsKKwkJaW50ZWxfY3J0
X2luaXQoaTkxNSk7CiAKLQkJZHBkX2lzX2VkcCA9IGludGVsX2RwX2lzX3BvcnRfZWRwKGRldl9w
cml2LCBQT1JUX0QpOworCQlkcGRfaXNfZWRwID0gaW50ZWxfZHBfaXNfcG9ydF9lZHAoaTkxNSwg
UE9SVF9EKTsKIAotCQlpZiAoaWxrX2hhc19lZHBfYShkZXZfcHJpdikpCi0JCQlpbnRlbF9kcF9p
bml0KGRldl9wcml2LCBEUF9BLCBQT1JUX0EpOworCQlpZiAoaWxrX2hhc19lZHBfYShpOTE1KSkK
KwkJCWludGVsX2RwX2luaXQoaTkxNSwgRFBfQSwgUE9SVF9BKTsKIAogCQlpZiAoSTkxNV9SRUFE
KFBDSF9IRE1JQikgJiBTRFZPX0RFVEVDVEVEKSB7CiAJCQkvKiBQQ0ggU0RWT0IgbXVsdGlwbGV4
IHdpdGggSERNSUIgKi8KLQkJCWZvdW5kID0gaW50ZWxfc2R2b19pbml0KGRldl9wcml2LCBQQ0hf
U0RWT0IsIFBPUlRfQik7CisJCQlmb3VuZCA9IGludGVsX3Nkdm9faW5pdChpOTE1LCBQQ0hfU0RW
T0IsIFBPUlRfQik7CiAJCQlpZiAoIWZvdW5kKQotCQkJCWludGVsX2hkbWlfaW5pdChkZXZfcHJp
diwgUENIX0hETUlCLCBQT1JUX0IpOworCQkJCWludGVsX2hkbWlfaW5pdChpOTE1LCBQQ0hfSERN
SUIsIFBPUlRfQik7CiAJCQlpZiAoIWZvdW5kICYmIChJOTE1X1JFQUQoUENIX0RQX0IpICYgRFBf
REVURUNURUQpKQotCQkJCWludGVsX2RwX2luaXQoZGV2X3ByaXYsIFBDSF9EUF9CLCBQT1JUX0Ip
OworCQkJCWludGVsX2RwX2luaXQoaTkxNSwgUENIX0RQX0IsIFBPUlRfQik7CiAJCX0KIAogCQlp
ZiAoSTkxNV9SRUFEKFBDSF9IRE1JQykgJiBTRFZPX0RFVEVDVEVEKQotCQkJaW50ZWxfaGRtaV9p
bml0KGRldl9wcml2LCBQQ0hfSERNSUMsIFBPUlRfQyk7CisJCQlpbnRlbF9oZG1pX2luaXQoaTkx
NSwgUENIX0hETUlDLCBQT1JUX0MpOwogCiAJCWlmICghZHBkX2lzX2VkcCAmJiBJOTE1X1JFQUQo
UENIX0hETUlEKSAmIFNEVk9fREVURUNURUQpCi0JCQlpbnRlbF9oZG1pX2luaXQoZGV2X3ByaXYs
IFBDSF9IRE1JRCwgUE9SVF9EKTsKKwkJCWludGVsX2hkbWlfaW5pdChpOTE1LCBQQ0hfSERNSUQs
IFBPUlRfRCk7CiAKIAkJaWYgKEk5MTVfUkVBRChQQ0hfRFBfQykgJiBEUF9ERVRFQ1RFRCkKLQkJ
CWludGVsX2RwX2luaXQoZGV2X3ByaXYsIFBDSF9EUF9DLCBQT1JUX0MpOworCQkJaW50ZWxfZHBf
aW5pdChpOTE1LCBQQ0hfRFBfQywgUE9SVF9DKTsKIAogCQlpZiAoSTkxNV9SRUFEKFBDSF9EUF9E
KSAmIERQX0RFVEVDVEVEKQotCQkJaW50ZWxfZHBfaW5pdChkZXZfcHJpdiwgUENIX0RQX0QsIFBP
UlRfRCk7Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllW
SUVXKGRldl9wcml2KSkgeworCQkJaW50ZWxfZHBfaW5pdChpOTE1LCBQQ0hfRFBfRCwgUE9SVF9E
KTsKKwl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1
KSkgewogCQlib29sIGhhc19lZHAsIGhhc19wb3J0OwogCi0JCWlmIChJU19WQUxMRVlWSUVXKGRl
dl9wcml2KSAmJiBkZXZfcHJpdi0+dmJ0LmludF9jcnRfc3VwcG9ydCkKLQkJCWludGVsX2NydF9p
bml0KGRldl9wcml2KTsKKwkJaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgJiYgaTkxNS0+dmJ0Lmlu
dF9jcnRfc3VwcG9ydCkKKwkJCWludGVsX2NydF9pbml0KGk5MTUpOwogCiAJCS8qCiAJCSAqIFRo
ZSBEUF9ERVRFQ1RFRCBiaXQgaXMgdGhlIGxhdGNoZWQgc3RhdGUgb2YgdGhlIEREQwpAQCAtMTUy
MzIsOTcgKzE1MjMyLDk3IEBAIHN0YXRpYyB2b2lkIGludGVsX3NldHVwX291dHB1dHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgKiB0cnVzdCB0aGUgcG9ydCB0eXBlIHRo
ZSBWQlQgZGVjbGFyZXMgYXMgd2UndmUgc2VlbiBhdCBsZWFzdAogCQkgKiBIRE1JIHBvcnRzIHRo
YXQgdGhlIFZCVCBjbGFpbSBhcmUgRFAgb3IgZURQLgogCQkgKi8KLQkJaGFzX2VkcCA9IGludGVs
X2RwX2lzX3BvcnRfZWRwKGRldl9wcml2LCBQT1JUX0IpOwotCQloYXNfcG9ydCA9IGludGVsX2Jp
b3NfaXNfcG9ydF9wcmVzZW50KGRldl9wcml2LCBQT1JUX0IpOworCQloYXNfZWRwID0gaW50ZWxf
ZHBfaXNfcG9ydF9lZHAoaTkxNSwgUE9SVF9CKTsKKwkJaGFzX3BvcnQgPSBpbnRlbF9iaW9zX2lz
X3BvcnRfcHJlc2VudChpOTE1LCBQT1JUX0IpOwogCQlpZiAoSTkxNV9SRUFEKFZMVl9EUF9CKSAm
IERQX0RFVEVDVEVEIHx8IGhhc19wb3J0KQotCQkJaGFzX2VkcCAmPSBpbnRlbF9kcF9pbml0KGRl
dl9wcml2LCBWTFZfRFBfQiwgUE9SVF9CKTsKKwkJCWhhc19lZHAgJj0gaW50ZWxfZHBfaW5pdChp
OTE1LCBWTFZfRFBfQiwgUE9SVF9CKTsKIAkJaWYgKChJOTE1X1JFQUQoVkxWX0hETUlCKSAmIFNE
Vk9fREVURUNURUQgfHwgaGFzX3BvcnQpICYmICFoYXNfZWRwKQotCQkJaW50ZWxfaGRtaV9pbml0
KGRldl9wcml2LCBWTFZfSERNSUIsIFBPUlRfQik7CisJCQlpbnRlbF9oZG1pX2luaXQoaTkxNSwg
VkxWX0hETUlCLCBQT1JUX0IpOwogCi0JCWhhc19lZHAgPSBpbnRlbF9kcF9pc19wb3J0X2VkcChk
ZXZfcHJpdiwgUE9SVF9DKTsKLQkJaGFzX3BvcnQgPSBpbnRlbF9iaW9zX2lzX3BvcnRfcHJlc2Vu
dChkZXZfcHJpdiwgUE9SVF9DKTsKKwkJaGFzX2VkcCA9IGludGVsX2RwX2lzX3BvcnRfZWRwKGk5
MTUsIFBPUlRfQyk7CisJCWhhc19wb3J0ID0gaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoaTkx
NSwgUE9SVF9DKTsKIAkJaWYgKEk5MTVfUkVBRChWTFZfRFBfQykgJiBEUF9ERVRFQ1RFRCB8fCBo
YXNfcG9ydCkKLQkJCWhhc19lZHAgJj0gaW50ZWxfZHBfaW5pdChkZXZfcHJpdiwgVkxWX0RQX0Ms
IFBPUlRfQyk7CisJCQloYXNfZWRwICY9IGludGVsX2RwX2luaXQoaTkxNSwgVkxWX0RQX0MsIFBP
UlRfQyk7CiAJCWlmICgoSTkxNV9SRUFEKFZMVl9IRE1JQykgJiBTRFZPX0RFVEVDVEVEIHx8IGhh
c19wb3J0KSAmJiAhaGFzX2VkcCkKLQkJCWludGVsX2hkbWlfaW5pdChkZXZfcHJpdiwgVkxWX0hE
TUlDLCBQT1JUX0MpOworCQkJaW50ZWxfaGRtaV9pbml0KGk5MTUsIFZMVl9IRE1JQywgUE9SVF9D
KTsKIAotCQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKKwkJaWYgKElTX0NIRVJSWVZJ
RVcoaTkxNSkpIHsKIAkJCS8qCiAJCQkgKiBlRFAgbm90IHN1cHBvcnRlZCBvbiBwb3J0IEQsCiAJ
CQkgKiBzbyBubyBuZWVkIHRvIHdvcnJ5IGFib3V0IGl0CiAJCQkgKi8KLQkJCWhhc19wb3J0ID0g
aW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoZGV2X3ByaXYsIFBPUlRfRCk7CisJCQloYXNfcG9y
dCA9IGludGVsX2Jpb3NfaXNfcG9ydF9wcmVzZW50KGk5MTUsIFBPUlRfRCk7CiAJCQlpZiAoSTkx
NV9SRUFEKENIVl9EUF9EKSAmIERQX0RFVEVDVEVEIHx8IGhhc19wb3J0KQotCQkJCWludGVsX2Rw
X2luaXQoZGV2X3ByaXYsIENIVl9EUF9ELCBQT1JUX0QpOworCQkJCWludGVsX2RwX2luaXQoaTkx
NSwgQ0hWX0RQX0QsIFBPUlRfRCk7CiAJCQlpZiAoSTkxNV9SRUFEKENIVl9IRE1JRCkgJiBTRFZP
X0RFVEVDVEVEIHx8IGhhc19wb3J0KQotCQkJCWludGVsX2hkbWlfaW5pdChkZXZfcHJpdiwgQ0hW
X0hETUlELCBQT1JUX0QpOworCQkJCWludGVsX2hkbWlfaW5pdChpOTE1LCBDSFZfSERNSUQsIFBP
UlRfRCk7CiAJCX0KIAotCQl2bHZfZHNpX2luaXQoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSVNf
UElORVZJRVcoZGV2X3ByaXYpKSB7Ci0JCWludGVsX2x2ZHNfaW5pdChkZXZfcHJpdik7Ci0JCWlu
dGVsX2NydF9pbml0KGRldl9wcml2KTsKLQl9IGVsc2UgaWYgKElTX0dFTl9SQU5HRShkZXZfcHJp
diwgMywgNCkpIHsKKwkJdmx2X2RzaV9pbml0KGk5MTUpOworCX0gZWxzZSBpZiAoSVNfUElORVZJ
RVcoaTkxNSkpIHsKKwkJaW50ZWxfbHZkc19pbml0KGk5MTUpOworCQlpbnRlbF9jcnRfaW5pdChp
OTE1KTsKKwl9IGVsc2UgaWYgKElTX0dFTl9SQU5HRShpOTE1LCAzLCA0KSkgewogCQlib29sIGZv
dW5kID0gZmFsc2U7CiAKLQkJaWYgKElTX01PQklMRShkZXZfcHJpdikpCi0JCQlpbnRlbF9sdmRz
X2luaXQoZGV2X3ByaXYpOworCQlpZiAoSVNfTU9CSUxFKGk5MTUpKQorCQkJaW50ZWxfbHZkc19p
bml0KGk5MTUpOwogCi0JCWludGVsX2NydF9pbml0KGRldl9wcml2KTsKKwkJaW50ZWxfY3J0X2lu
aXQoaTkxNSk7CiAKIAkJaWYgKEk5MTVfUkVBRChHRU4zX1NEVk9CKSAmIFNEVk9fREVURUNURUQp
IHsKIAkJCURSTV9ERUJVR19LTVMoInByb2JpbmcgU0RWT0JcbiIpOwotCQkJZm91bmQgPSBpbnRl
bF9zZHZvX2luaXQoZGV2X3ByaXYsIEdFTjNfU0RWT0IsIFBPUlRfQik7Ci0JCQlpZiAoIWZvdW5k
ICYmIElTX0c0WChkZXZfcHJpdikpIHsKKwkJCWZvdW5kID0gaW50ZWxfc2R2b19pbml0KGk5MTUs
IEdFTjNfU0RWT0IsIFBPUlRfQik7CisJCQlpZiAoIWZvdW5kICYmIElTX0c0WChpOTE1KSkgewog
CQkJCURSTV9ERUJVR19LTVMoInByb2JpbmcgSERNSSBvbiBTRFZPQlxuIik7Ci0JCQkJaW50ZWxf
aGRtaV9pbml0KGRldl9wcml2LCBHRU40X0hETUlCLCBQT1JUX0IpOworCQkJCWludGVsX2hkbWlf
aW5pdChpOTE1LCBHRU40X0hETUlCLCBQT1JUX0IpOwogCQkJfQogCi0JCQlpZiAoIWZvdW5kICYm
IElTX0c0WChkZXZfcHJpdikpCi0JCQkJaW50ZWxfZHBfaW5pdChkZXZfcHJpdiwgRFBfQiwgUE9S
VF9CKTsKKwkJCWlmICghZm91bmQgJiYgSVNfRzRYKGk5MTUpKQorCQkJCWludGVsX2RwX2luaXQo
aTkxNSwgRFBfQiwgUE9SVF9CKTsKIAkJfQogCiAJCS8qIEJlZm9yZSBHNFggU0RWT0MgZG9lc24n
dCBoYXZlIGl0cyBvd24gZGV0ZWN0IHJlZ2lzdGVyICovCiAKIAkJaWYgKEk5MTVfUkVBRChHRU4z
X1NEVk9CKSAmIFNEVk9fREVURUNURUQpIHsKIAkJCURSTV9ERUJVR19LTVMoInByb2JpbmcgU0RW
T0NcbiIpOwotCQkJZm91bmQgPSBpbnRlbF9zZHZvX2luaXQoZGV2X3ByaXYsIEdFTjNfU0RWT0Ms
IFBPUlRfQyk7CisJCQlmb3VuZCA9IGludGVsX3Nkdm9faW5pdChpOTE1LCBHRU4zX1NEVk9DLCBQ
T1JUX0MpOwogCQl9CiAKIAkJaWYgKCFmb3VuZCAmJiAoSTkxNV9SRUFEKEdFTjNfU0RWT0MpICYg
U0RWT19ERVRFQ1RFRCkpIHsKIAotCQkJaWYgKElTX0c0WChkZXZfcHJpdikpIHsKKwkJCWlmIChJ
U19HNFgoaTkxNSkpIHsKIAkJCQlEUk1fREVCVUdfS01TKCJwcm9iaW5nIEhETUkgb24gU0RWT0Nc
biIpOwotCQkJCWludGVsX2hkbWlfaW5pdChkZXZfcHJpdiwgR0VONF9IRE1JQywgUE9SVF9DKTsK
KwkJCQlpbnRlbF9oZG1pX2luaXQoaTkxNSwgR0VONF9IRE1JQywgUE9SVF9DKTsKIAkJCX0KLQkJ
CWlmIChJU19HNFgoZGV2X3ByaXYpKQotCQkJCWludGVsX2RwX2luaXQoZGV2X3ByaXYsIERQX0Ms
IFBPUlRfQyk7CisJCQlpZiAoSVNfRzRYKGk5MTUpKQorCQkJCWludGVsX2RwX2luaXQoaTkxNSwg
RFBfQywgUE9SVF9DKTsKIAkJfQogCi0JCWlmIChJU19HNFgoZGV2X3ByaXYpICYmIChJOTE1X1JF
QUQoRFBfRCkgJiBEUF9ERVRFQ1RFRCkpCi0JCQlpbnRlbF9kcF9pbml0KGRldl9wcml2LCBEUF9E
LCBQT1JUX0QpOworCQlpZiAoSVNfRzRYKGk5MTUpICYmIChJOTE1X1JFQUQoRFBfRCkgJiBEUF9E
RVRFQ1RFRCkpCisJCQlpbnRlbF9kcF9pbml0KGk5MTUsIERQX0QsIFBPUlRfRCk7CiAKLQkJaWYg
KFNVUFBPUlRTX1RWKGRldl9wcml2KSkKLQkJCWludGVsX3R2X2luaXQoZGV2X3ByaXYpOwotCX0g
ZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCAyKSkgewotCQlpZiAoSVNfSTg1WChkZXZfcHJpdikp
Ci0JCQlpbnRlbF9sdmRzX2luaXQoZGV2X3ByaXYpOworCQlpZiAoU1VQUE9SVFNfVFYoaTkxNSkp
CisJCQlpbnRlbF90dl9pbml0KGk5MTUpOworCX0gZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDIpKSB7
CisJCWlmIChJU19JODVYKGk5MTUpKQorCQkJaW50ZWxfbHZkc19pbml0KGk5MTUpOwogCi0JCWlu
dGVsX2NydF9pbml0KGRldl9wcml2KTsKLQkJaW50ZWxfZHZvX2luaXQoZGV2X3ByaXYpOworCQlp
bnRlbF9jcnRfaW5pdChpOTE1KTsKKwkJaW50ZWxfZHZvX2luaXQoaTkxNSk7CiAJfQogCi0JaW50
ZWxfcHNyX2luaXQoZGV2X3ByaXYpOworCWludGVsX3Bzcl9pbml0KGk5MTUpOwogCi0JZm9yX2Vh
Y2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgeworCWZvcl9lYWNoX2lu
dGVsX2VuY29kZXIoJmk5MTUtPmRybSwgZW5jb2RlcikgewogCQllbmNvZGVyLT5iYXNlLnBvc3Np
YmxlX2NydGNzID0gZW5jb2Rlci0+Y3J0Y19tYXNrOwogCQllbmNvZGVyLT5iYXNlLnBvc3NpYmxl
X2Nsb25lcyA9CiAJCQlpbnRlbF9lbmNvZGVyX2Nsb25lcyhlbmNvZGVyKTsKIAl9CiAKLQlpbnRl
bF9pbml0X3BjaF9yZWZjbGsoZGV2X3ByaXYpOworCWludGVsX2luaXRfcGNoX3JlZmNsayhpOTE1
KTsKIAotCWRybV9oZWxwZXJfbW92ZV9wYW5lbF9jb25uZWN0b3JzX3RvX2hlYWQoJmRldl9wcml2
LT5kcm0pOworCWRybV9oZWxwZXJfbW92ZV9wYW5lbF9jb25uZWN0b3JzX3RvX2hlYWQoJmk5MTUt
PmRybSk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3VzZXJfZnJhbWVidWZmZXJfZGVzdHJveShz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKQEAgLTE1Mzc5LDcgKzE1Mzc5LDcgQEAgc3RhdGlj
IGludCBpbnRlbF9mcmFtZWJ1ZmZlcl9pbml0KHN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAqaW50
ZWxfZmIsCiAJCQkJICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJCSAgc3Ry
dWN0IGRybV9tb2RlX2ZiX2NtZDIgKm1vZGVfY21kKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gJmludGVsX2ZiLT5iYXNlOwogCXUzMiBtYXhfc3RyaWRlOwogCXVuc2ln
bmVkIGludCB0aWxpbmcsIHN0cmlkZTsKQEAgLTE1NDExLDcgKzE1NDExLDcgQEAgc3RhdGljIGlu
dCBpbnRlbF9mcmFtZWJ1ZmZlcl9pbml0KHN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAqaW50ZWxf
ZmIsCiAJCX0KIAl9CiAKLQlpZiAoIWRybV9hbnlfcGxhbmVfaGFzX2Zvcm1hdCgmZGV2X3ByaXYt
PmRybSwKKwlpZiAoIWRybV9hbnlfcGxhbmVfaGFzX2Zvcm1hdCgmaTkxNS0+ZHJtLAogCQkJCSAg
ICAgIG1vZGVfY21kLT5waXhlbF9mb3JtYXQsCiAJCQkJICAgICAgbW9kZV9jbWQtPm1vZGlmaWVy
WzBdKSkgewogCQlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBmb3JtYXRfbmFtZTsKQEAgLTE1
NDI3LDEzICsxNTQyNywxMyBAQCBzdGF0aWMgaW50IGludGVsX2ZyYW1lYnVmZmVyX2luaXQoc3Ry
dWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiwKIAkgKiBnZW4yLzMgZGlzcGxheSBlbmdp
bmUgdXNlcyB0aGUgZmVuY2UgaWYgcHJlc2VudCwKIAkgKiBzbyB0aGUgdGlsaW5nIG1vZGUgbXVz
dCBtYXRjaCB0aGUgZmIgbW9kaWZpZXIgZXhhY3RseS4KIAkgKi8KLQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA8IDQgJiYKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNCAmJgogCSAgICB0aWxpbmcg
IT0gaW50ZWxfZmJfbW9kaWZpZXJfdG9fdGlsaW5nKG1vZGVfY21kLT5tb2RpZmllclswXSkpIHsK
IAkJRFJNX0RFQlVHX0tNUygidGlsaW5nX21vZGUgbXVzdCBtYXRjaCBmYiBtb2RpZmllciBleGFj
dGx5IG9uIGdlbjIvM1xuIik7CiAJCWdvdG8gZXJyOwogCX0KIAotCW1heF9zdHJpZGUgPSBpbnRl
bF9mYl9tYXhfc3RyaWRlKGRldl9wcml2LCBtb2RlX2NtZC0+cGl4ZWxfZm9ybWF0LAorCW1heF9z
dHJpZGUgPSBpbnRlbF9mYl9tYXhfc3RyaWRlKGk5MTUsIG1vZGVfY21kLT5waXhlbF9mb3JtYXQs
CiAJCQkJCSBtb2RlX2NtZC0+bW9kaWZpZXJbMF0pOwogCWlmIChtb2RlX2NtZC0+cGl0Y2hlc1sw
XSA+IG1heF9zdHJpZGUpIHsKIAkJRFJNX0RFQlVHX0tNUygiJXMgcGl0Y2ggKCV1KSBtdXN0IGJl
IGF0IG1vc3QgJWRcbiIsCkBAIC0xNTQ1Nyw3ICsxNTQ1Nyw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
ZnJhbWVidWZmZXJfaW5pdChzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiLAogCWlm
IChtb2RlX2NtZC0+b2Zmc2V0c1swXSAhPSAwKQogCQlnb3RvIGVycjsKIAotCWRybV9oZWxwZXJf
bW9kZV9maWxsX2ZiX3N0cnVjdCgmZGV2X3ByaXYtPmRybSwgZmIsIG1vZGVfY21kKTsKKwlkcm1f
aGVscGVyX21vZGVfZmlsbF9mYl9zdHJ1Y3QoJmk5MTUtPmRybSwgZmIsIG1vZGVfY21kKTsKIAog
CWZvciAoaSA9IDA7IGkgPCBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBpKyspIHsKIAkJdTMyIHN0
cmlkZV9hbGlnbm1lbnQ7CkBAIC0xNTQ3OCw3ICsxNTQ3OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
ZnJhbWVidWZmZXJfaW5pdChzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiLAogCQkg
KiByZXF1aXJlIHRoZSBlbnRpcmUgZmIgdG8gYWNjb21tb2RhdGUgdGhhdCB0byBhdm9pZAogCQkg
KiBwb3RlbnRpYWwgcnVudGltZSBlcnJvcnMgYXQgcGxhbmUgY29uZmlndXJhdGlvbiB0aW1lLgog
CQkgKi8KLQkJaWYgKElTX0dFTihkZXZfcHJpdiwgOSkgJiYgaSA9PSAwICYmIGZiLT53aWR0aCA+
IDM4NDAgJiYKKwkJaWYgKElTX0dFTihpOTE1LCA5KSAmJiBpID09IDAgJiYgZmItPndpZHRoID4g
Mzg0MCAmJgogCQkgICAgaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCiAJCQlzdHJpZGVf
YWxpZ25tZW50ICo9IDQ7CiAKQEAgLTE1NDkxLDExICsxNTQ5MSwxMSBAQCBzdGF0aWMgaW50IGlu
dGVsX2ZyYW1lYnVmZmVyX2luaXQoc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiwK
IAkJZmItPm9ialtpXSA9ICZvYmotPmJhc2U7CiAJfQogCi0JcmV0ID0gaW50ZWxfZmlsbF9mYl9p
bmZvKGRldl9wcml2LCBmYik7CisJcmV0ID0gaW50ZWxfZmlsbF9mYl9pbmZvKGk5MTUsIGZiKTsK
IAlpZiAocmV0KQogCQlnb3RvIGVycjsKIAotCXJldCA9IGRybV9mcmFtZWJ1ZmZlcl9pbml0KCZk
ZXZfcHJpdi0+ZHJtLCBmYiwgJmludGVsX2ZiX2Z1bmNzKTsKKwlyZXQgPSBkcm1fZnJhbWVidWZm
ZXJfaW5pdCgmaTkxNS0+ZHJtLCBmYiwgJmludGVsX2ZiX2Z1bmNzKTsKIAlpZiAocmV0KSB7CiAJ
CURSTV9FUlJPUigiZnJhbWVidWZmZXIgaW5pdCBmYWlsZWQgJWRcbiIsIHJldCk7CiAJCWdvdG8g
ZXJyOwpAQCAtMTU1NDUsNyArMTU1NDUsNyBAQCBzdGF0aWMgZW51bSBkcm1fbW9kZV9zdGF0dXMK
IGludGVsX21vZGVfdmFsaWQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJIGNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICptb2RlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGV2KTsKIAlpbnQgaGRpc3BsYXlfbWF4LCBodG90YWxfbWF4OwogCWludCB2ZGlz
cGxheV9tYXgsIHZ0b3RhbF9tYXg7CiAKQEAgLTE1NTc4LDEzICsxNTU3OCwxMyBAQCBpbnRlbF9t
b2RlX3ZhbGlkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkgICBEUk1fTU9ERV9GTEFHX0NM
S0RJVjIpKQogCQlyZXR1cm4gTU9ERV9CQUQ7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA5IHx8Ci0JICAgIElTX0JST0FEV0VMTChkZXZfcHJpdikgfHwgSVNfSEFTV0VMTChkZXZfcHJp
dikpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkgfHwKKwkgICAgSVNfQlJPQURXRUxMKGk5
MTUpIHx8IElTX0hBU1dFTEwoaTkxNSkpIHsKIAkJaGRpc3BsYXlfbWF4ID0gODE5MjsgLyogRkRJ
IG1heCA0MDk2IGhhbmRsZWQgZWxzZXdoZXJlICovCiAJCXZkaXNwbGF5X21heCA9IDQwOTY7CiAJ
CWh0b3RhbF9tYXggPSA4MTkyOwogCQl2dG90YWxfbWF4ID0gODE5MjsKLQl9IGVsc2UgaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMykgeworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49
IDMpIHsKIAkJaGRpc3BsYXlfbWF4ID0gNDA5NjsKIAkJdmRpc3BsYXlfbWF4ID0gNDA5NjsKIAkJ
aHRvdGFsX21heCA9IDgxOTI7CkBAIC0xNTYyNSwxMTMgKzE1NjI1LDExMyBAQCBzdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZ19mdW5jcyBpbnRlbF9tb2RlX2Z1bmNzID0gewogCiAv
KioKICAqIGludGVsX2luaXRfZGlzcGxheV9ob29rcyAtIGluaXRpYWxpemUgdGhlIGRpc3BsYXkg
bW9kZXNldHRpbmcgaG9va3MKLSAqIEBkZXZfcHJpdjogZGV2aWNlIHByaXZhdGUKKyAqIEBpOTE1
OiBkZXZpY2UgcHJpdmF0ZQogICovCi12b2lkIGludGVsX2luaXRfZGlzcGxheV9ob29rcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2luaXRfZGlzcGxheV9o
b29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnRlbF9pbml0X2NkY2xr
X2hvb2tzKGRldl9wcml2KTsKKwlpbnRlbF9pbml0X2NkY2xrX2hvb2tzKGk5MTUpOwogCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlw
ZV9jb25maWcgPSBoYXN3ZWxsX2dldF9waXBlX2NvbmZpZzsKLQkJZGV2X3ByaXYtPmRpc3BsYXku
Z2V0X2luaXRpYWxfcGxhbmVfY29uZmlnID0KKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsK
KwkJaTkxNS0+ZGlzcGxheS5nZXRfcGlwZV9jb25maWcgPSBoYXN3ZWxsX2dldF9waXBlX2NvbmZp
ZzsKKwkJaTkxNS0+ZGlzcGxheS5nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcgPQogCQkJc2t5bGFr
ZV9nZXRfaW5pdGlhbF9wbGFuZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29t
cHV0ZV9jbG9jayA9CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrID0KIAkJCWhh
c3dlbGxfY3J0Y19jb21wdXRlX2Nsb2NrOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2VuYWJs
ZSA9IGhhc3dlbGxfY3J0Y19lbmFibGU7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfZGlzYWJs
ZSA9IGhhc3dlbGxfY3J0Y19kaXNhYmxlOwotCX0gZWxzZSBpZiAoSEFTX0RESShkZXZfcHJpdikp
IHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaGFzd2VsbF9nZXRfcGlw
ZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFsX3BsYW5lX2NvbmZpZyA9
CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19lbmFibGUgPSBoYXN3ZWxsX2NydGNfZW5hYmxlOworCQlp
OTE1LT5kaXNwbGF5LmNydGNfZGlzYWJsZSA9IGhhc3dlbGxfY3J0Y19kaXNhYmxlOworCX0gZWxz
ZSBpZiAoSEFTX0RESShpOTE1KSkgeworCQlpOTE1LT5kaXNwbGF5LmdldF9waXBlX2NvbmZpZyA9
IGhhc3dlbGxfZ2V0X3BpcGVfY29uZmlnOworCQlpOTE1LT5kaXNwbGF5LmdldF9pbml0aWFsX3Bs
YW5lX2NvbmZpZyA9CiAJCQlpOXh4X2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZzsKLQkJZGV2X3By
aXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrID0KKwkJaTkxNS0+ZGlzcGxheS5jcnRjX2Nv
bXB1dGVfY2xvY2sgPQogCQkJaGFzd2VsbF9jcnRjX2NvbXB1dGVfY2xvY2s7Ci0JCWRldl9wcml2
LT5kaXNwbGF5LmNydGNfZW5hYmxlID0gaGFzd2VsbF9jcnRjX2VuYWJsZTsKLQkJZGV2X3ByaXYt
PmRpc3BsYXkuY3J0Y19kaXNhYmxlID0gaGFzd2VsbF9jcnRjX2Rpc2FibGU7Ci0JfSBlbHNlIGlm
IChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlw
ZV9jb25maWcgPSBpcm9ubGFrZV9nZXRfcGlwZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5
LmdldF9pbml0aWFsX3BsYW5lX2NvbmZpZyA9CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19lbmFibGUg
PSBoYXN3ZWxsX2NydGNfZW5hYmxlOworCQlpOTE1LT5kaXNwbGF5LmNydGNfZGlzYWJsZSA9IGhh
c3dlbGxfY3J0Y19kaXNhYmxlOworCX0gZWxzZSBpZiAoSEFTX1BDSF9TUExJVChpOTE1KSkgewor
CQlpOTE1LT5kaXNwbGF5LmdldF9waXBlX2NvbmZpZyA9IGlyb25sYWtlX2dldF9waXBlX2NvbmZp
ZzsKKwkJaTkxNS0+ZGlzcGxheS5nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcgPQogCQkJaTl4eF9n
ZXRfaW5pdGlhbF9wbGFuZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0
ZV9jbG9jayA9CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrID0KIAkJCWlyb25s
YWtlX2NydGNfY29tcHV0ZV9jbG9jazsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFibGUg
PSBpcm9ubGFrZV9jcnRjX2VuYWJsZTsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19kaXNhYmxl
ID0gaXJvbmxha2VfY3J0Y19kaXNhYmxlOwotCX0gZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhkZXZf
cHJpdikpIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4eF9nZXRf
cGlwZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFsX3BsYW5lX2NvbmZp
ZyA9CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19lbmFibGUgPSBpcm9ubGFrZV9jcnRjX2VuYWJsZTsK
KwkJaTkxNS0+ZGlzcGxheS5jcnRjX2Rpc2FibGUgPSBpcm9ubGFrZV9jcnRjX2Rpc2FibGU7CisJ
fSBlbHNlIGlmIChJU19DSEVSUllWSUVXKGk5MTUpKSB7CisJCWk5MTUtPmRpc3BsYXkuZ2V0X3Bp
cGVfY29uZmlnID0gaTl4eF9nZXRfcGlwZV9jb25maWc7CisJCWk5MTUtPmRpc3BsYXkuZ2V0X2lu
aXRpYWxfcGxhbmVfY29uZmlnID0KIAkJCWk5eHhfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnOwot
CQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sgPSBjaHZfY3J0Y19jb21wdXRl
X2Nsb2NrOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2VuYWJsZSA9IHZhbGxleXZpZXdfY3J0
Y19lbmFibGU7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfZGlzYWJsZSA9IGk5eHhfY3J0Y19k
aXNhYmxlOwotCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpIHsKLQkJZGV2X3By
aXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4eF9nZXRfcGlwZV9jb25maWc7Ci0JCWRl
dl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFsX3BsYW5lX2NvbmZpZyA9CisJCWk5MTUtPmRpc3Bs
YXkuY3J0Y19jb21wdXRlX2Nsb2NrID0gY2h2X2NydGNfY29tcHV0ZV9jbG9jazsKKwkJaTkxNS0+
ZGlzcGxheS5jcnRjX2VuYWJsZSA9IHZhbGxleXZpZXdfY3J0Y19lbmFibGU7CisJCWk5MTUtPmRp
c3BsYXkuY3J0Y19kaXNhYmxlID0gaTl4eF9jcnRjX2Rpc2FibGU7CisJfSBlbHNlIGlmIChJU19W
QUxMRVlWSUVXKGk5MTUpKSB7CisJCWk5MTUtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4
eF9nZXRfcGlwZV9jb25maWc7CisJCWk5MTUtPmRpc3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29u
ZmlnID0KIAkJCWk5eHhfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnOwotCQlkZXZfcHJpdi0+ZGlz
cGxheS5jcnRjX2NvbXB1dGVfY2xvY2sgPSB2bHZfY3J0Y19jb21wdXRlX2Nsb2NrOwotCQlkZXZf
cHJpdi0+ZGlzcGxheS5jcnRjX2VuYWJsZSA9IHZhbGxleXZpZXdfY3J0Y19lbmFibGU7Ci0JCWRl
dl9wcml2LT5kaXNwbGF5LmNydGNfZGlzYWJsZSA9IGk5eHhfY3J0Y19kaXNhYmxlOwotCX0gZWxz
ZSBpZiAoSVNfRzRYKGRldl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlwZV9j
b25maWcgPSBpOXh4X2dldF9waXBlX2NvbmZpZzsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2lu
aXRpYWxfcGxhbmVfY29uZmlnID0KKwkJaTkxNS0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sg
PSB2bHZfY3J0Y19jb21wdXRlX2Nsb2NrOworCQlpOTE1LT5kaXNwbGF5LmNydGNfZW5hYmxlID0g
dmFsbGV5dmlld19jcnRjX2VuYWJsZTsKKwkJaTkxNS0+ZGlzcGxheS5jcnRjX2Rpc2FibGUgPSBp
OXh4X2NydGNfZGlzYWJsZTsKKwl9IGVsc2UgaWYgKElTX0c0WChpOTE1KSkgeworCQlpOTE1LT5k
aXNwbGF5LmdldF9waXBlX2NvbmZpZyA9IGk5eHhfZ2V0X3BpcGVfY29uZmlnOworCQlpOTE1LT5k
aXNwbGF5LmdldF9pbml0aWFsX3BsYW5lX2NvbmZpZyA9CiAJCQlpOXh4X2dldF9pbml0aWFsX3Bs
YW5lX2NvbmZpZzsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrID0gZzR4
X2NydGNfY29tcHV0ZV9jbG9jazsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFibGUgPSBp
OXh4X2NydGNfZW5hYmxlOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rpc2FibGUgPSBpOXh4
X2NydGNfZGlzYWJsZTsKLQl9IGVsc2UgaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSkgewotCQlk
ZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlwZV9jb25maWcgPSBpOXh4X2dldF9waXBlX2NvbmZpZzsK
LQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnID0KKwkJaTkxNS0+
ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sgPSBnNHhfY3J0Y19jb21wdXRlX2Nsb2NrOworCQlp
OTE1LT5kaXNwbGF5LmNydGNfZW5hYmxlID0gaTl4eF9jcnRjX2VuYWJsZTsKKwkJaTkxNS0+ZGlz
cGxheS5jcnRjX2Rpc2FibGUgPSBpOXh4X2NydGNfZGlzYWJsZTsKKwl9IGVsc2UgaWYgKElTX1BJ
TkVWSUVXKGk5MTUpKSB7CisJCWk5MTUtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4eF9n
ZXRfcGlwZV9jb25maWc7CisJCWk5MTUtPmRpc3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29uZmln
ID0KIAkJCWk5eHhfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnOwotCQlkZXZfcHJpdi0+ZGlzcGxh
eS5jcnRjX2NvbXB1dGVfY2xvY2sgPSBwbnZfY3J0Y19jb21wdXRlX2Nsb2NrOwotCQlkZXZfcHJp
di0+ZGlzcGxheS5jcnRjX2VuYWJsZSA9IGk5eHhfY3J0Y19lbmFibGU7Ci0JCWRldl9wcml2LT5k
aXNwbGF5LmNydGNfZGlzYWJsZSA9IGk5eHhfY3J0Y19kaXNhYmxlOwotCX0gZWxzZSBpZiAoIUlT
X0dFTihkZXZfcHJpdiwgMikpIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmln
ID0gaTl4eF9nZXRfcGlwZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFs
X3BsYW5lX2NvbmZpZyA9CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrID0gcG52
X2NydGNfY29tcHV0ZV9jbG9jazsKKwkJaTkxNS0+ZGlzcGxheS5jcnRjX2VuYWJsZSA9IGk5eHhf
Y3J0Y19lbmFibGU7CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19kaXNhYmxlID0gaTl4eF9jcnRjX2Rp
c2FibGU7CisJfSBlbHNlIGlmICghSVNfR0VOKGk5MTUsIDIpKSB7CisJCWk5MTUtPmRpc3BsYXku
Z2V0X3BpcGVfY29uZmlnID0gaTl4eF9nZXRfcGlwZV9jb25maWc7CisJCWk5MTUtPmRpc3BsYXku
Z2V0X2luaXRpYWxfcGxhbmVfY29uZmlnID0KIAkJCWk5eHhfZ2V0X2luaXRpYWxfcGxhbmVfY29u
ZmlnOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sgPSBpOXh4X2NydGNf
Y29tcHV0ZV9jbG9jazsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFibGUgPSBpOXh4X2Ny
dGNfZW5hYmxlOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rpc2FibGUgPSBpOXh4X2NydGNf
ZGlzYWJsZTsKKwkJaTkxNS0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sgPSBpOXh4X2NydGNf
Y29tcHV0ZV9jbG9jazsKKwkJaTkxNS0+ZGlzcGxheS5jcnRjX2VuYWJsZSA9IGk5eHhfY3J0Y19l
bmFibGU7CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19kaXNhYmxlID0gaTl4eF9jcnRjX2Rpc2FibGU7
CiAJfSBlbHNlIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4eF9n
ZXRfcGlwZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFsX3BsYW5lX2Nv
bmZpZyA9CisJCWk5MTUtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4eF9nZXRfcGlwZV9j
b25maWc7CisJCWk5MTUtPmRpc3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnID0KIAkJCWk5
eHhfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Nv
bXB1dGVfY2xvY2sgPSBpOHh4X2NydGNfY29tcHV0ZV9jbG9jazsKLQkJZGV2X3ByaXYtPmRpc3Bs
YXkuY3J0Y19lbmFibGUgPSBpOXh4X2NydGNfZW5hYmxlOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5j
cnRjX2Rpc2FibGUgPSBpOXh4X2NydGNfZGlzYWJsZTsKKwkJaTkxNS0+ZGlzcGxheS5jcnRjX2Nv
bXB1dGVfY2xvY2sgPSBpOHh4X2NydGNfY29tcHV0ZV9jbG9jazsKKwkJaTkxNS0+ZGlzcGxheS5j
cnRjX2VuYWJsZSA9IGk5eHhfY3J0Y19lbmFibGU7CisJCWk5MTUtPmRpc3BsYXkuY3J0Y19kaXNh
YmxlID0gaTl4eF9jcnRjX2Rpc2FibGU7CiAJfQogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgNSkp
IHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZmRpX2xpbmtfdHJhaW4gPSBpcm9ubGFrZV9mZGlfbGlu
a190cmFpbjsKLQl9IGVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgNikpIHsKLQkJZGV2X3ByaXYt
PmRpc3BsYXkuZmRpX2xpbmtfdHJhaW4gPSBnZW42X2ZkaV9saW5rX3RyYWluOwotCX0gZWxzZSBp
ZiAoSVNfSVZZQlJJREdFKGRldl9wcml2KSkgeworCWlmIChJU19HRU4oaTkxNSwgNSkpIHsKKwkJ
aTkxNS0+ZGlzcGxheS5mZGlfbGlua190cmFpbiA9IGlyb25sYWtlX2ZkaV9saW5rX3RyYWluOwor
CX0gZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDYpKSB7CisJCWk5MTUtPmRpc3BsYXkuZmRpX2xpbmtf
dHJhaW4gPSBnZW42X2ZkaV9saW5rX3RyYWluOworCX0gZWxzZSBpZiAoSVNfSVZZQlJJREdFKGk5
MTUpKSB7CiAJCS8qIEZJWE1FOiBkZXRlY3QgQjArIHN0ZXBwaW5nIGFuZCB1c2UgYXV0byB0cmFp
bmluZyAqLwotCQlkZXZfcHJpdi0+ZGlzcGxheS5mZGlfbGlua190cmFpbiA9IGl2Yl9tYW51YWxf
ZmRpX2xpbmtfdHJhaW47Ci0JfSBlbHNlIGlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19C
Uk9BRFdFTEwoZGV2X3ByaXYpKSB7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmZkaV9saW5rX3RyYWlu
ID0gaHN3X2ZkaV9saW5rX3RyYWluOworCQlpOTE1LT5kaXNwbGF5LmZkaV9saW5rX3RyYWluID0g
aXZiX21hbnVhbF9mZGlfbGlua190cmFpbjsKKwl9IGVsc2UgaWYgKElTX0hBU1dFTEwoaTkxNSkg
fHwgSVNfQlJPQURXRUxMKGk5MTUpKSB7CisJCWk5MTUtPmRpc3BsYXkuZmRpX2xpbmtfdHJhaW4g
PSBoc3dfZmRpX2xpbmtfdHJhaW47CiAJfQogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkudXBkYXRlX2NydGNzID0gc2tsX3VwZGF0ZV9jcnRjczsK
KwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpCisJCWk5MTUtPmRpc3BsYXkudXBkYXRlX2NydGNz
ID0gc2tsX3VwZGF0ZV9jcnRjczsKIAllbHNlCi0JCWRldl9wcml2LT5kaXNwbGF5LnVwZGF0ZV9j
cnRjcyA9IGludGVsX3VwZGF0ZV9jcnRjczsKKwkJaTkxNS0+ZGlzcGxheS51cGRhdGVfY3J0Y3Mg
PSBpbnRlbF91cGRhdGVfY3J0Y3M7CiB9CiAKLXN0YXRpYyBpOTE1X3JlZ190IGk5MTVfdmdhY250
cmxfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpOTE1X3Jl
Z190IGk5MTVfdmdhY250cmxfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkK
KwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQogCQlyZXR1
cm4gVkxWX1ZHQUNOVFJMOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkKKwll
bHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJcmV0dXJuIENQVV9WR0FDTlRSTDsKIAll
bHNlCiAJCXJldHVybiBWR0FDTlRSTDsKIH0KIAogLyogRGlzYWJsZSB0aGUgVkdBIHBsYW5lIHRo
YXQgd2UgbmV2ZXIgdXNlICovCi1zdGF0aWMgdm9pZCBpOTE1X2Rpc2FibGVfdmdhKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGk5MTVfZGlzYWJsZV92Z2Eo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYg
PSBkZXZfcHJpdi0+ZHJtLnBkZXY7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0u
cGRldjsKIAl1OCBzcjE7Ci0JaTkxNV9yZWdfdCB2Z2FfcmVnID0gaTkxNV92Z2FjbnRybF9yZWco
ZGV2X3ByaXYpOworCWk5MTVfcmVnX3QgdmdhX3JlZyA9IGk5MTVfdmdhY250cmxfcmVnKGk5MTUp
OwogCiAJLyogV2FFbmFibGVWR0FBY2Nlc3NUaHJvdWdoSU9Qb3J0OmN0ZyxlbGssaWxrLHNuYixp
dmIsdmx2LGhzdyAqLwogCXZnYV9nZXRfdW5pbnRlcnJ1cHRpYmxlKHBkZXYsIFZHQV9SU1JDX0xF
R0FDWV9JTyk7CkBAIC0xNTc0NywxMSArMTU3NDcsMTEgQEAgc3RhdGljIHZvaWQgaTkxNV9kaXNh
YmxlX3ZnYShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIHZvaWQgaW50ZWxf
bW9kZXNldF9pbml0X2h3KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCi0JaW50ZWxfdXBkYXRlX2NkY2xrKGRldl9w
cml2KTsKLQlpbnRlbF9kdW1wX2NkY2xrX3N0YXRlKCZkZXZfcHJpdi0+Y2RjbGsuaHcsICJDdXJy
ZW50IENEQ0xLIik7Ci0JZGV2X3ByaXYtPmNkY2xrLmxvZ2ljYWwgPSBkZXZfcHJpdi0+Y2RjbGsu
YWN0dWFsID0gZGV2X3ByaXYtPmNkY2xrLmh3OworCWludGVsX3VwZGF0ZV9jZGNsayhpOTE1KTsK
KwlpbnRlbF9kdW1wX2NkY2xrX3N0YXRlKCZpOTE1LT5jZGNsay5odywgIkN1cnJlbnQgQ0RDTEsi
KTsKKwlpOTE1LT5jZGNsay5sb2dpY2FsID0gaTkxNS0+Y2RjbGsuYWN0dWFsID0gaTkxNS0+Y2Rj
bGsuaHc7CiB9CiAKIC8qCkBAIC0xNTc2Niw3ICsxNTc2Niw3IEBAIHZvaWQgaW50ZWxfbW9kZXNl
dF9pbml0X2h3KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAgKi8KIHN0YXRpYyB2b2lkIHNhbml0
aXplX3dhdGVybWFya3Moc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlOwogCXN0cnVjdCBk
cm1fY3J0YyAqY3J0YzsKQEAgLTE1Nzc2LDcgKzE1Nzc2LDcgQEAgc3RhdGljIHZvaWQgc2FuaXRp
emVfd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWludCBpOwogCiAJLyogT25s
eSBzdXBwb3J0ZWQgb24gcGxhdGZvcm1zIHRoYXQgdXNlIGF0b21pYyB3YXRlcm1hcmsgZGVzaWdu
ICovCi0JaWYgKCFkZXZfcHJpdi0+ZGlzcGxheS5vcHRpbWl6ZV93YXRlcm1hcmtzKQorCWlmICgh
aTkxNS0+ZGlzcGxheS5vcHRpbWl6ZV93YXRlcm1hcmtzKQogCQlyZXR1cm47CiAKIAkvKgpAQCAt
MTU4MDQsNyArMTU4MDQsNyBAQCBzdGF0aWMgdm9pZCBzYW5pdGl6ZV93YXRlcm1hcmtzKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYpCiAJICogaW50ZXJtZWRpYXRlIHdhdGVybWFya3MgKHNpbmNlIHdl
IGRvbid0IHRydXN0IHRoZSBjdXJyZW50CiAJICogd2F0ZXJtYXJrcykuCiAJICovCi0JaWYgKCFI
QVNfR01DSChkZXZfcHJpdikpCisJaWYgKCFIQVNfR01DSChpOTE1KSkKIAkJaW50ZWxfc3RhdGUt
PnNraXBfaW50ZXJtZWRpYXRlX3dtID0gdHJ1ZTsKIAogCXJldCA9IGludGVsX2F0b21pY19jaGVj
ayhkZXYsIHN0YXRlKTsKQEAgLTE1ODI5LDcgKzE1ODI5LDcgQEAgc3RhdGljIHZvaWQgc2FuaXRp
emVfd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQlzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3MgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNzdGF0ZSk7CiAKIAkJY3MtPndtLm5l
ZWRfcG9zdHZibF91cGRhdGUgPSB0cnVlOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5vcHRpbWl6ZV93
YXRlcm1hcmtzKGludGVsX3N0YXRlLCBjcyk7CisJCWk5MTUtPmRpc3BsYXkub3B0aW1pemVfd2F0
ZXJtYXJrcyhpbnRlbF9zdGF0ZSwgY3MpOwogCiAJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+
c3RhdGUpLT53bSA9IGNzLT53bTsKIAl9CkBAIC0xNTg0MSwyMCArMTU4NDEsMjAgQEAgc3RhdGlj
IHZvaWQgc2FuaXRpemVfd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWRybV9t
b2Rlc2V0X2FjcXVpcmVfZmluaSgmY3R4KTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRl
X2ZkaV9wbGxfZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
dm9pZCBpbnRlbF91cGRhdGVfZmRpX3BsbF9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewotCWlmIChJU19HRU4oZGV2X3ByaXYsIDUpKSB7CisJaWYgKElTX0dFTihpOTE1LCA1
KSkgewogCQl1MzIgZmRpX3BsbF9jbGsgPQogCQkJSTkxNV9SRUFEKEZESV9QTExfQklPU18wKSAm
IEZESV9QTExfRkJfQ0xPQ0tfTUFTSzsKIAotCQlkZXZfcHJpdi0+ZmRpX3BsbF9mcmVxID0gKGZk
aV9wbGxfY2xrICsgMikgKiAxMDAwMDsKLQl9IGVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgNikg
fHwgSVNfSVZZQlJJREdFKGRldl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZmRpX3BsbF9mcmVxID0g
MjcwMDAwOworCQlpOTE1LT5mZGlfcGxsX2ZyZXEgPSAoZmRpX3BsbF9jbGsgKyAyKSAqIDEwMDAw
OworCX0gZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDYpIHx8IElTX0lWWUJSSURHRShpOTE1KSkgewor
CQlpOTE1LT5mZGlfcGxsX2ZyZXEgPSAyNzAwMDA7CiAJfSBlbHNlIHsKIAkJcmV0dXJuOwogCX0K
IAotCURSTV9ERUJVR19EUklWRVIoIkZESSBQTEwgZnJlcT0lZFxuIiwgZGV2X3ByaXYtPmZkaV9w
bGxfZnJlcSk7CisJRFJNX0RFQlVHX0RSSVZFUigiRkRJIFBMTCBmcmVxPSVkXG4iLCBpOTE1LT5m
ZGlfcGxsX2ZyZXEpOwogfQogCiBzdGF0aWMgaW50IGludGVsX2luaXRpYWxfY29tbWl0KHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYpCkBAIC0xNTkxNSwxNyArMTU5MTUsMTcgQEAgc3RhdGljIGludCBp
bnRlbF9pbml0aWFsX2NvbW1pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiBpbnQgaW50ZWxf
bW9kZXNldF9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBpOTE1X2dndHQgKmdn
dHQgPSAmZGV2X3ByaXYtPmdndHQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZpOTE1LT5nZ3R0OwogCWVu
dW0gcGlwZSBwaXBlOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCWludCByZXQ7CiAKLQlk
ZXZfcHJpdi0+bW9kZXNldF93cSA9IGFsbG9jX29yZGVyZWRfd29ya3F1ZXVlKCJpOTE1X21vZGVz
ZXQiLCAwKTsKKwlpOTE1LT5tb2Rlc2V0X3dxID0gYWxsb2Nfb3JkZXJlZF93b3JrcXVldWUoImk5
MTVfbW9kZXNldCIsIDApOwogCiAJZHJtX21vZGVfY29uZmlnX2luaXQoZGV2KTsKIAotCXJldCA9
IGludGVsX2J3X2luaXQoZGV2X3ByaXYpOworCXJldCA9IGludGVsX2J3X2luaXQoaTkxNSk7CiAJ
aWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMTU5MzksMTUgKzE1OTM5LDE1IEBAIGludCBp
bnRlbF9tb2Rlc2V0X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAogCWRldi0+bW9kZV9j
b25maWcuZnVuY3MgPSAmaW50ZWxfbW9kZV9mdW5jczsKIAotCWluaXRfbGxpc3RfaGVhZCgmZGV2
X3ByaXYtPmF0b21pY19oZWxwZXIuZnJlZV9saXN0KTsKLQlJTklUX1dPUksoJmRldl9wcml2LT5h
dG9taWNfaGVscGVyLmZyZWVfd29yaywKKwlpbml0X2xsaXN0X2hlYWQoJmk5MTUtPmF0b21pY19o
ZWxwZXIuZnJlZV9saXN0KTsKKwlJTklUX1dPUksoJmk5MTUtPmF0b21pY19oZWxwZXIuZnJlZV93
b3JrLAogCQkgIGludGVsX2F0b21pY19oZWxwZXJfZnJlZV9zdGF0ZV93b3JrZXIpOwogCi0JaW50
ZWxfaW5pdF9xdWlya3MoZGV2X3ByaXYpOworCWludGVsX2luaXRfcXVpcmtzKGk5MTUpOwogCi0J
aW50ZWxfZmJjX2luaXQoZGV2X3ByaXYpOworCWludGVsX2ZiY19pbml0KGk5MTUpOwogCi0JaW50
ZWxfaW5pdF9wbShkZXZfcHJpdik7CisJaW50ZWxfaW5pdF9wbShpOTE1KTsKIAogCS8qCiAJICog
VGhlcmUgbWF5IGJlIG5vIFZCVDsgYW5kIGlmIHRoZSBCSU9TIGVuYWJsZWQgU1NDIHdlIGNhbgpA
QCAtMTU5NTUsMTUgKzE1OTU1LDE1IEBAIGludCBpbnRlbF9tb2Rlc2V0X2luaXQoc3RydWN0IGRy
bV9kZXZpY2UgKmRldikKIAkgKiBCSU9TIGlzbid0IHVzaW5nIGl0LCBkb24ndCBhc3N1bWUgaXQg
d2lsbCB3b3JrIGV2ZW4gaWYgdGhlIFZCVAogCSAqIGluZGljYXRlcyBhcyBtdWNoLgogCSAqLwot
CWlmIChIQVNfUENIX0lCWChkZXZfcHJpdikgfHwgSEFTX1BDSF9DUFQoZGV2X3ByaXYpKSB7CisJ
aWYgKEhBU19QQ0hfSUJYKGk5MTUpIHx8IEhBU19QQ0hfQ1BUKGk5MTUpKSB7CiAJCWJvb2wgYmlv
c19sdmRzX3VzZV9zc2MgPSAhIShJOTE1X1JFQUQoUENIX0RSRUZfQ09OVFJPTCkgJgogCQkJCQkg
ICAgRFJFRl9TU0MxX0VOQUJMRSk7CiAKLQkJaWYgKGRldl9wcml2LT52YnQubHZkc191c2Vfc3Nj
ICE9IGJpb3NfbHZkc191c2Vfc3NjKSB7CisJCWlmIChpOTE1LT52YnQubHZkc191c2Vfc3NjICE9
IGJpb3NfbHZkc191c2Vfc3NjKSB7CiAJCQlEUk1fREVCVUdfS01TKCJTU0MgJXNhYmxlZCBieSBC
SU9TLCBvdmVycmlkaW5nIFZCVCB3aGljaCBzYXlzICVzYWJsZWRcbiIsCiAJCQkJICAgICBiaW9z
X2x2ZHNfdXNlX3NzYyA/ICJlbiIgOiAiZGlzIiwKLQkJCQkgICAgIGRldl9wcml2LT52YnQubHZk
c191c2Vfc3NjID8gImVuIiA6ICJkaXMiKTsKLQkJCWRldl9wcml2LT52YnQubHZkc191c2Vfc3Nj
ID0gYmlvc19sdmRzX3VzZV9zc2M7CisJCQkJICAgICBpOTE1LT52YnQubHZkc191c2Vfc3NjID8g
ImVuIiA6ICJkaXMiKTsKKwkJCWk5MTUtPnZidC5sdmRzX3VzZV9zc2MgPSBiaW9zX2x2ZHNfdXNl
X3NzYzsKIAkJfQogCX0KIApAQCAtMTU5NzEsMTMgKzE1OTcxLDEzIEBAIGludCBpbnRlbF9tb2Rl
c2V0X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkgKiBNYXhpbXVtIGZyYW1lYnVmZmVy
IGRpbWVuc2lvbnMsIGNob3NlbiB0byBtYXRjaAogCSAqIHRoZSBtYXhpbXVtIHJlbmRlciBlbmdp
bmUgc3VyZmFjZSBzaXplIG9uIGdlbjQrLgogCSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDcpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDcpIHsKIAkJZGV2LT5tb2RlX2NvbmZp
Zy5tYXhfd2lkdGggPSAxNjM4NDsKIAkJZGV2LT5tb2RlX2NvbmZpZy5tYXhfaGVpZ2h0ID0gMTYz
ODQ7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpIHsKKwl9IGVsc2UgaWYg
KElOVEVMX0dFTihpOTE1KSA+PSA0KSB7CiAJCWRldi0+bW9kZV9jb25maWcubWF4X3dpZHRoID0g
ODE5MjsKIAkJZGV2LT5tb2RlX2NvbmZpZy5tYXhfaGVpZ2h0ID0gODE5MjsKLQl9IGVsc2UgaWYg
KElTX0dFTihkZXZfcHJpdiwgMykpIHsKKwl9IGVsc2UgaWYgKElTX0dFTihpOTE1LCAzKSkgewog
CQlkZXYtPm1vZGVfY29uZmlnLm1heF93aWR0aCA9IDQwOTY7CiAJCWRldi0+bW9kZV9jb25maWcu
bWF4X2hlaWdodCA9IDQwOTY7CiAJfSBlbHNlIHsKQEAgLTE1OTg1LDEwICsxNTk4NSwxMCBAQCBp
bnQgaW50ZWxfbW9kZXNldF9pbml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCWRldi0+bW9k
ZV9jb25maWcubWF4X2hlaWdodCA9IDIwNDg7CiAJfQogCi0JaWYgKElTX0k4NDVHKGRldl9wcml2
KSB8fCBJU19JODY1RyhkZXZfcHJpdikpIHsKLQkJZGV2LT5tb2RlX2NvbmZpZy5jdXJzb3Jfd2lk
dGggPSBJU19JODQ1RyhkZXZfcHJpdikgPyA2NCA6IDUxMjsKKwlpZiAoSVNfSTg0NUcoaTkxNSkg
fHwgSVNfSTg2NUcoaTkxNSkpIHsKKwkJZGV2LT5tb2RlX2NvbmZpZy5jdXJzb3Jfd2lkdGggPSBJ
U19JODQ1RyhpOTE1KSA/IDY0IDogNTEyOwogCQlkZXYtPm1vZGVfY29uZmlnLmN1cnNvcl9oZWln
aHQgPSAxMDIzOwotCX0gZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCAyKSkgeworCX0gZWxzZSBp
ZiAoSVNfR0VOKGk5MTUsIDIpKSB7CiAJCWRldi0+bW9kZV9jb25maWcuY3Vyc29yX3dpZHRoID0g
NjQ7CiAJCWRldi0+bW9kZV9jb25maWcuY3Vyc29yX2hlaWdodCA9IDY0OwogCX0gZWxzZSB7CkBA
IC0xNTk5OSwxMSArMTU5OTksMTEgQEAgaW50IGludGVsX21vZGVzZXRfaW5pdChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KQogCWRldi0+bW9kZV9jb25maWcuZmJfYmFzZSA9IGdndHQtPmdtYWRyLnN0
YXJ0OwogCiAJRFJNX0RFQlVHX0tNUygiJWQgZGlzcGxheSBwaXBlJXMgYXZhaWxhYmxlLlxuIiwK
LQkJICAgICAgSU5URUxfSU5GTyhkZXZfcHJpdiktPm51bV9waXBlcywKLQkJICAgICAgSU5URUxf
SU5GTyhkZXZfcHJpdiktPm51bV9waXBlcyA+IDEgPyAicyIgOiAiIik7CisJCSAgICAgIElOVEVM
X0lORk8oaTkxNSktPm51bV9waXBlcywKKwkJICAgICAgSU5URUxfSU5GTyhpOTE1KS0+bnVtX3Bp
cGVzID4gMSA/ICJzIiA6ICIiKTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpIHsK
LQkJcmV0ID0gaW50ZWxfY3J0Y19pbml0KGRldl9wcml2LCBwaXBlKTsKKwlmb3JfZWFjaF9waXBl
KGk5MTUsIHBpcGUpIHsKKwkJcmV0ID0gaW50ZWxfY3J0Y19pbml0KGk5MTUsIHBpcGUpOwogCQlp
ZiAocmV0KSB7CiAJCQlkcm1fbW9kZV9jb25maWdfY2xlYW51cChkZXYpOwogCQkJcmV0dXJuIHJl
dDsKQEAgLTE2MDExLDE5ICsxNjAxMSwxOSBAQCBpbnQgaW50ZWxfbW9kZXNldF9pbml0KHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYpCiAJfQogCiAJaW50ZWxfc2hhcmVkX2RwbGxfaW5pdChkZXYpOwot
CWludGVsX3VwZGF0ZV9mZGlfcGxsX2ZyZXEoZGV2X3ByaXYpOworCWludGVsX3VwZGF0ZV9mZGlf
cGxsX2ZyZXEoaTkxNSk7CiAKLQlpbnRlbF91cGRhdGVfY3pjbGsoZGV2X3ByaXYpOworCWludGVs
X3VwZGF0ZV9jemNsayhpOTE1KTsKIAlpbnRlbF9tb2Rlc2V0X2luaXRfaHcoZGV2KTsKIAotCWlu
dGVsX2hkY3BfY29tcG9uZW50X2luaXQoZGV2X3ByaXYpOworCWludGVsX2hkY3BfY29tcG9uZW50
X2luaXQoaTkxNSk7CiAKLQlpZiAoZGV2X3ByaXYtPm1heF9jZGNsa19mcmVxID09IDApCi0JCWlu
dGVsX3VwZGF0ZV9tYXhfY2RjbGsoZGV2X3ByaXYpOworCWlmIChpOTE1LT5tYXhfY2RjbGtfZnJl
cSA9PSAwKQorCQlpbnRlbF91cGRhdGVfbWF4X2NkY2xrKGk5MTUpOwogCiAJLyogSnVzdCBkaXNh
YmxlIGl0IG9uY2UgYXQgc3RhcnR1cCAqLwotCWk5MTVfZGlzYWJsZV92Z2EoZGV2X3ByaXYpOwot
CWludGVsX3NldHVwX291dHB1dHMoZGV2X3ByaXYpOworCWk5MTVfZGlzYWJsZV92Z2EoaTkxNSk7
CisJaW50ZWxfc2V0dXBfb3V0cHV0cyhpOTE1KTsKIAogCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGRl
dik7CiAJaW50ZWxfbW9kZXNldF9zZXR1cF9od19zdGF0ZShkZXYsIGRldi0+bW9kZV9jb25maWcu
YWNxdWlyZV9jdHgpOwpAQCAtMTYwNDIsNyArMTYwNDIsNyBAQCBpbnQgaW50ZWxfbW9kZXNldF9p
bml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCSAqIGNhbiBldmVuIGFsbG93IGZvciBzbW9v
dGggYm9vdCB0cmFuc2l0aW9ucyBpZiB0aGUgQklPUwogCQkgKiBmYiBpcyBsYXJnZSBlbm91Z2gg
Zm9yIHRoZSBhY3RpdmUgcGlwZSBjb25maWd1cmF0aW9uLgogCQkgKi8KLQkJZGV2X3ByaXYtPmRp
c3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnKGNydGMsCisJCWk5MTUtPmRpc3BsYXkuZ2V0
X2luaXRpYWxfcGxhbmVfY29uZmlnKGNydGMsCiAJCQkJCQkJICAgJnBsYW5lX2NvbmZpZyk7CiAK
IAkJLyoKQEAgLTE2MDU3LDcgKzE2MDU3LDcgQEAgaW50IGludGVsX21vZGVzZXRfaW5pdChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2KQogCSAqIE5vdGUgdGhhdCB3ZSBuZWVkIHRvIGRvIHRoaXMgYWZ0
ZXIgcmVjb25zdHJ1Y3RpbmcgdGhlIEJJT1MgZmIncwogCSAqIHNpbmNlIHRoZSB3YXRlcm1hcmsg
Y2FsY3VsYXRpb24gZG9uZSBoZXJlIHdpbGwgdXNlIHBzdGF0ZS0+ZmIuCiAJICovCi0JaWYgKCFI
QVNfR01DSChkZXZfcHJpdikpCisJaWYgKCFIQVNfR01DSChpOTE1KSkKIAkJc2FuaXRpemVfd2F0
ZXJtYXJrcyhkZXYpOwogCiAJLyoKQEAgLTE2MDczLDkgKzE2MDczLDkgQEAgaW50IGludGVsX21v
ZGVzZXRfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXJldHVybiAwOwogfQogCi12b2lk
IGk4MzBfZW5hYmxlX3BpcGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVt
IHBpcGUgcGlwZSkKK3ZvaWQgaTgzMF9lbmFibGVfcGlwZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBp
bnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShpOTE1LCBwaXBlKTsKIAkvKiA2NDB4
NDgwQDYwSHosIH4yNTE3NSBrSHogKi8KIAlzdHJ1Y3QgZHBsbCBjbG9jayA9IHsKIAkJLm0xID0g
MTgsCkBAIC0xNjE0Myw5ICsxNjE0Myw5IEBAIHZvaWQgaTgzMF9lbmFibGVfcGlwZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQogCWludGVsX3dhaXRf
Zm9yX3BpcGVfc2NhbmxpbmVfbW92aW5nKGNydGMpOwogfQogCi12b2lkIGk4MzBfZGlzYWJsZV9w
aXBlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCit2
b2lkIGk4MzBfZGlzYWJsZV9waXBlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVt
IHBpcGUgcGlwZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGludGVsX2dldF9jcnRj
X2Zvcl9waXBlKGRldl9wcml2LCBwaXBlKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGlu
dGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIHBpcGUpOwogCiAJRFJNX0RFQlVHX0tNUygiZGlz
YWJsaW5nIHBpcGUgJWMgZHVlIHRvIGZvcmNlIHF1aXJrXG4iLAogCQkgICAgICBwaXBlX25hbWUo
cGlwZSkpOwpAQCAtMTYxNjYsMTQgKzE2MTY2LDE0IEBAIHZvaWQgaTgzMF9kaXNhYmxlX3BpcGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKIH0KIAog
c3RhdGljIHZvaWQKLWludGVsX3Nhbml0aXplX3BsYW5lX21hcHBpbmcoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQoraW50ZWxfc2FuaXRpemVfcGxhbmVfbWFwcGluZyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAot
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0
KQogCQlyZXR1cm47CiAKLQlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRj
KSB7CisJZm9yX2VhY2hfaW50ZWxfY3J0YygmaTkxNS0+ZHJtLCBjcnRjKSB7CiAJCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPQogCQkJdG9faW50ZWxfcGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5
KTsKIAkJc3RydWN0IGludGVsX2NydGMgKnBsYW5lX2NydGM7CkBAIC0xNjE4OCw3ICsxNjE4OCw3
IEBAIGludGVsX3Nhbml0aXplX3BsYW5lX21hcHBpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCQlEUk1fREVCVUdfS01TKCJbUExBTkU6JWQ6JXNdIGF0dGFjaGVkIHRvIHRo
ZSB3cm9uZyBwaXBlLCBkaXNhYmxpbmcgcGxhbmVcbiIsCiAJCQkgICAgICBwbGFuZS0+YmFzZS5i
YXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lKTsKIAotCQlwbGFuZV9jcnRjID0gaW50ZWxfZ2V0X2Ny
dGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOworCQlwbGFuZV9jcnRjID0gaW50ZWxfZ2V0X2Ny
dGNfZm9yX3BpcGUoaTkxNSwgcGlwZSk7CiAJCWludGVsX3BsYW5lX2Rpc2FibGVfbm9hdG9taWMo
cGxhbmVfY3J0YywgcGxhbmUpOwogCX0KIH0KQEAgLTE2MjE1LDE4ICsxNjIxNSwxOCBAQCBzdGF0
aWMgc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfZW5jb2Rlcl9maW5kX2Nvbm5lY3Rvcihz
dHJ1Y3QgaW50ZWxfZW5jb2RlcgogCXJldHVybiBOVUxMOwogfQogCi1zdGF0aWMgYm9vbCBoYXNf
cGNoX3RyYW5jb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
Ym9vbCBoYXNfcGNoX3RyYW5jb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CSAgICAgIGVudW0gcGlwZSBwY2hfdHJhbnNjb2RlcikKIHsKLQlyZXR1cm4gSEFTX1BDSF9JQlgo
ZGV2X3ByaXYpIHx8IEhBU19QQ0hfQ1BUKGRldl9wcml2KSB8fAotCQkoSEFTX1BDSF9MUFRfSChk
ZXZfcHJpdikgJiYgcGNoX3RyYW5zY29kZXIgPT0gUElQRV9BKTsKKwlyZXR1cm4gSEFTX1BDSF9J
QlgoaTkxNSkgfHwgSEFTX1BDSF9DUFQoaTkxNSkgfHwKKwkJKEhBU19QQ0hfTFBUX0goaTkxNSkg
JiYgcGNoX3RyYW5zY29kZXIgPT0gUElQRV9BKTsKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfc2Fu
aXRpemVfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQlzdHJ1Y3QgZHJtX21vZGVz
ZXRfYWNxdWlyZV9jdHggKmN0eCkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+
YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShk
ZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShj
cnRjLT5iYXNlLnN0YXRlKTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRj
X3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKIApAQCAtMTYyNTUsNyArMTYyNTUsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9zYW5pdGl6ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkgKiBE
aXNhYmxlIGFueSBiYWNrZ3JvdW5kIGNvbG9yIHNldCBieSB0aGUgQklPUywgYnV0IGVuYWJsZSB0
aGUKIAkJICogZ2FtbWEgYW5kIENTQyB0byBtYXRjaCBob3cgd2UgcHJvZ3JhbSBvdXIgcGxhbmVz
LgogCQkgKi8KLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwkJaWYgKElOVEVMX0dF
TihpOTE1KSA+PSA5KQogCQkJSTkxNV9XUklURShTS0xfQk9UVE9NX0NPTE9SKGNydGMtPnBpcGUp
LAogCQkJCSAgIFNLTF9CT1RUT01fQ09MT1JfR0FNTUFfRU5BQkxFIHwKIAkJCQkgICBTS0xfQk9U
VE9NX0NPTE9SX0NTQ19FTkFCTEUpOwpAQCAtMTYyNjYsNyArMTYyNjYsNyBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9zYW5pdGl6ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCWlmIChjcnRj
X3N0YXRlLT5iYXNlLmFjdGl2ZSAmJiAhaW50ZWxfY3J0Y19oYXNfZW5jb2RlcnMoY3J0YykpCiAJ
CWludGVsX2NydGNfZGlzYWJsZV9ub2F0b21pYygmY3J0Yy0+YmFzZSwgY3R4KTsKIAotCWlmIChj
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSB8fCBIQVNfR01DSChkZXZfcHJpdikpIHsKKwlpZiAoY3J0
Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwgSEFTX0dNQ0goaTkxNSkpIHsKIAkJLyoKIAkJICogV2Ug
c3RhcnQgb3V0IHdpdGggdW5kZXJydW4gcmVwb3J0aW5nIGRpc2FibGVkIHRvIGF2b2lkIHJhY2Vz
LgogCQkgKiBGb3IgY29ycmVjdCBib29ra2VlcGluZyBtYXJrIHRoaXMgb24gYWN0aXZlIGNydGNz
LgpAQCAtMTYyOTAsMTQgKzE2MjkwLDE0IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nhbml0aXplX2Ny
dGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCSAqIFBDSCB0cmFuc2NvZGVycyBCIGFuZCBD
IHdvdWxkIHByZXZlbnQgZW5hYmxpbmcgdGhlIHNvdXRoCiAJCSAqIGVycm9yIGludGVycnVwdCAo
c2VlIGNwdF9jYW5fZW5hYmxlX3NlcnJfaW50KCkpLgogCQkgKi8KLQkJaWYgKGhhc19wY2hfdHJh
bmNvZGVyKGRldl9wcml2LCBjcnRjLT5waXBlKSkKKwkJaWYgKGhhc19wY2hfdHJhbmNvZGVyKGk5
MTUsIGNydGMtPnBpcGUpKQogCQkJY3J0Yy0+cGNoX2ZpZm9fdW5kZXJydW5fZGlzYWJsZWQgPSB0
cnVlOwogCX0KIH0KIAogc3RhdGljIGJvb2wgaGFzX2JvZ3VzX2RwbGxfY29uZmlnKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNl
LmNydGMtPmRldik7CiAKIAkvKgogCSAqIFNvbWUgU05CIEJJT1NlbiAoZWcuIEFTVVMgSzUzU1Yp
IGFyZSBrbm93biB0byBtaXNwcm9ncmFtCkBAIC0xNjMwOSw3ICsxNjMwOSw3IEBAIHN0YXRpYyBi
b29sIGhhc19ib2d1c19kcGxsX2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIAkgKiB3aXRob3V0IHNldmVyYWwgV0FSTnMsIGJ1dCBmb3Igbm93IGxldCdz
IHRha2UgdGhlIGVhc3kKIAkgKiByb2FkLgogCSAqLwotCXJldHVybiBJU19HRU4oZGV2X3ByaXYs
IDYpICYmCisJcmV0dXJuIElTX0dFTihpOTE1LCA2KSAmJgogCQljcnRjX3N0YXRlLT5iYXNlLmFj
dGl2ZSAmJgogCQljcnRjX3N0YXRlLT5zaGFyZWRfZHBsbCAmJgogCQljcnRjX3N0YXRlLT5wb3J0
X2Nsb2NrID09IDA7CkBAIC0xNjMxNyw3ICsxNjMxNyw3IEBAIHN0YXRpYyBib29sIGhhc19ib2d1
c19kcGxsX2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IAogc3RhdGljIHZvaWQgaW50ZWxfc2FuaXRpemVfZW5jb2RlcihzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNv
bm5lY3RvcjsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoZW5jb2Rl
ci0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IGNy
dGMgPwpAQCAtMTYzNzgsMjEgKzE2Mzc4LDIxIEBAIHN0YXRpYyB2b2lkIGludGVsX3Nhbml0aXpl
X2VuY29kZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJLyogbm90aWZ5IG9wcmVn
aW9uIG9mIHRoZSBzYW5pdGl6ZWQgZW5jb2RlciBzdGF0ZSAqLwogCWludGVsX29wcmVnaW9uX25v
dGlmeV9lbmNvZGVyKGVuY29kZXIsIGNvbm5lY3RvciAmJiBoYXNfYWN0aXZlX2NydGMpOwogCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAx
MSkKIAkJaWNsX3Nhbml0aXplX2VuY29kZXJfcGxsX21hcHBpbmcoZW5jb2Rlcik7CiB9CiAKLXZv
aWQgaTkxNV9yZWRpc2FibGVfdmdhX3Bvd2VyX29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3ZvaWQgaTkxNV9yZWRpc2FibGVfdmdhX3Bvd2VyX29uKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCWk5MTVfcmVnX3QgdmdhX3JlZyA9IGk5MTVfdmdhY250cmxf
cmVnKGRldl9wcml2KTsKKwlpOTE1X3JlZ190IHZnYV9yZWcgPSBpOTE1X3ZnYWNudHJsX3JlZyhp
OTE1KTsKIAogCWlmICghKEk5MTVfUkVBRCh2Z2FfcmVnKSAmIFZHQV9ESVNQX0RJU0FCTEUpKSB7
CiAJCURSTV9ERUJVR19LTVMoIlNvbWV0aGluZyBlbmFibGVkIFZHQSBwbGFuZSwgZGlzYWJsaW5n
IGl0XG4iKTsKLQkJaTkxNV9kaXNhYmxlX3ZnYShkZXZfcHJpdik7CisJCWk5MTVfZGlzYWJsZV92
Z2EoaTkxNSk7CiAJfQogfQogCi12b2lkIGk5MTVfcmVkaXNhYmxlX3ZnYShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGk5MTVfcmVkaXNhYmxlX3ZnYShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIApAQCAt
MTY0MDUsMjMgKzE2NDA1LDIzIEBAIHZvaWQgaTkxNV9yZWRpc2FibGVfdmdhKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBmb2xsb3cgdGhlICJkb24ndCB0b3VjaCB0aGUg
cG93ZXIgd2VsbCBpZiB3ZSBkb24ndCBuZWVkIGl0IiBwb2xpY3kKIAkgKiB0aGUgcmVzdCBvZiB0
aGUgZHJpdmVyIHVzZXMuCiAJICovCi0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0
X2lmX2VuYWJsZWQoZGV2X3ByaXYsCisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0
X2lmX2VuYWJsZWQoaTkxNSwKIAkJCQkJCSAgICAgUE9XRVJfRE9NQUlOX1ZHQSk7CiAJaWYgKCF3
YWtlcmVmKQogCQlyZXR1cm47CiAKLQlpOTE1X3JlZGlzYWJsZV92Z2FfcG93ZXJfb24oZGV2X3By
aXYpOworCWk5MTVfcmVkaXNhYmxlX3ZnYV9wb3dlcl9vbihpOTE1KTsKIAotCWludGVsX2Rpc3Bs
YXlfcG93ZXJfcHV0KGRldl9wcml2LCBQT1dFUl9ET01BSU5fVkdBLCB3YWtlcmVmKTsKKwlpbnRl
bF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01BSU5fVkdBLCB3YWtlcmVmKTsKIH0K
IAogLyogRklYTUUgcmVhZCBvdXQgZnVsbCBwbGFuZSBzdGF0ZSBmb3IgYWxsIHBsYW5lcyAqLwot
c3RhdGljIHZvaWQgcmVhZG91dF9wbGFuZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitzdGF0aWMgdm9pZCByZWFkb3V0X3BsYW5lX3N0YXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGM7CiAKLQlmb3JfZWFjaF9pbnRlbF9wbGFuZSgmZGV2X3ByaXYtPmRy
bSwgcGxhbmUpIHsKKwlmb3JfZWFjaF9pbnRlbF9wbGFuZSgmaTkxNS0+ZHJtLCBwbGFuZSkgewog
CQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0KIAkJCXRvX2ludGVsX3Bs
YW5lX3N0YXRlKHBsYW5lLT5iYXNlLnN0YXRlKTsKIAkJc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGU7CkBAIC0xNjQzMCw3ICsxNjQzMCw3IEBAIHN0YXRpYyB2b2lkIHJlYWRvdXRf
cGxhbmVfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJCXZpc2li
bGUgPSBwbGFuZS0+Z2V0X2h3X3N0YXRlKHBsYW5lLCAmcGlwZSk7CiAKLQkJY3J0YyA9IGludGVs
X2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBwaXBlKTsKKwkJY3J0YyA9IGludGVsX2dldF9j
cnRjX2Zvcl9waXBlKGk5MTUsIHBpcGUpOwogCQljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19z
dGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAogCQlpbnRlbF9zZXRfcGxhbmVfdmlzaWJsZShjcnRj
X3N0YXRlLCBwbGFuZV9zdGF0ZSwgdmlzaWJsZSk7CkBAIC0xNjQ0MCw3ICsxNjQ0MCw3IEBAIHN0
YXRpYyB2b2lkIHJlYWRvdXRfcGxhbmVfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCQkJICAgICAgZW5hYmxlZGRpc2FibGVkKHZpc2libGUpLCBwaXBlX25hbWUocGlw
ZSkpOwogCX0KIAotCWZvcl9lYWNoX2ludGVsX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMpIHsK
Kwlmb3JfZWFjaF9pbnRlbF9jcnRjKCZpOTE1LT5kcm0sIGNydGMpIHsKIAkJc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQogCQkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5i
YXNlLnN0YXRlKTsKIApAQCAtMTY0NTAsNyArMTY0NTAsNyBAQCBzdGF0aWMgdm9pZCByZWFkb3V0
X3BsYW5lX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogc3RhdGlj
IHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWVudW0g
cGlwZSBwaXBlOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCXN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyOwpAQCAtMTY0NTgsNyArMTY0NTgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9t
b2Rlc2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAlzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOwogCWludCBpOwogCi0JZGV2X3ByaXYt
PmFjdGl2ZV9jcnRjcyA9IDA7CisJaTkxNS0+YWN0aXZlX2NydGNzID0gMDsKIAogCWZvcl9lYWNo
X2ludGVsX2NydGMoZGV2LCBjcnRjKSB7CiAJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlID0KQEAgLTE2NDY5LDI1ICsxNjQ2OSwyNSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rl
c2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJX19kcm1fYXRv
bWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZjcnRjLT5iYXNlLCAmY3J0Y19zdGF0ZS0+YmFzZSk7CiAK
IAkJY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgPSBjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSA9Ci0J
CQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlwZV9jb25maWcoY3J0YywgY3J0Y19zdGF0ZSk7CisJ
CQlpOTE1LT5kaXNwbGF5LmdldF9waXBlX2NvbmZpZyhjcnRjLCBjcnRjX3N0YXRlKTsKIAogCQlj
cnRjLT5iYXNlLmVuYWJsZWQgPSBjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZTsKIAkJY3J0Yy0+YWN0
aXZlID0gY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CiAKIAkJaWYgKGNydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlKQotCQkJZGV2X3ByaXYtPmFjdGl2ZV9jcnRjcyB8PSAxIDw8IGNydGMtPnBpcGU7CisJ
CQlpOTE1LT5hY3RpdmVfY3J0Y3MgfD0gMSA8PCBjcnRjLT5waXBlOwogCiAJCURSTV9ERUJVR19L
TVMoIltDUlRDOiVkOiVzXSBodyBzdGF0ZSByZWFkb3V0OiAlc1xuIiwKIAkJCSAgICAgIGNydGMt
PmJhc2UuYmFzZS5pZCwgY3J0Yy0+YmFzZS5uYW1lLAogCQkJICAgICAgZW5hYmxlZGRpc2FibGVk
KGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKSk7CiAJfQogCi0JcmVhZG91dF9wbGFuZV9zdGF0ZShk
ZXZfcHJpdik7CisJcmVhZG91dF9wbGFuZV9zdGF0ZShpOTE1KTsKIAotCWZvciAoaSA9IDA7IGkg
PCBkZXZfcHJpdi0+bnVtX3NoYXJlZF9kcGxsOyBpKyspIHsKLQkJc3RydWN0IGludGVsX3NoYXJl
ZF9kcGxsICpwbGwgPSAmZGV2X3ByaXYtPnNoYXJlZF9kcGxsc1tpXTsKKwlmb3IgKGkgPSAwOyBp
IDwgaTkxNS0+bnVtX3NoYXJlZF9kcGxsOyBpKyspIHsKKwkJc3RydWN0IGludGVsX3NoYXJlZF9k
cGxsICpwbGwgPSAmaTkxNS0+c2hhcmVkX2RwbGxzW2ldOwogCi0JCXBsbC0+b24gPSBwbGwtPmlu
Zm8tPmZ1bmNzLT5nZXRfaHdfc3RhdGUoZGV2X3ByaXYsIHBsbCwKKwkJcGxsLT5vbiA9IHBsbC0+
aW5mby0+ZnVuY3MtPmdldF9od19zdGF0ZShpOTE1LCBwbGwsCiAJCQkJCQkJJnBsbC0+c3RhdGUu
aHdfc3RhdGUpOwogCQlwbGwtPnN0YXRlLmNydGNfbWFzayA9IDA7CiAJCWZvcl9lYWNoX2ludGVs
X2NydGMoZGV2LCBjcnRjKSB7CkBAIC0xNjUxMCw3ICsxNjUxMCw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQlp
ZiAoZW5jb2Rlci0+Z2V0X2h3X3N0YXRlKGVuY29kZXIsICZwaXBlKSkgewogCQkJc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CiAKLQkJCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19m
b3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJCQljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3Bp
cGUoaTkxNSwgcGlwZSk7CiAJCQljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRj
LT5iYXNlLnN0YXRlKTsKIAogCQkJZW5jb2Rlci0+YmFzZS5jcnRjID0gJmNydGMtPmJhc2U7CkBA
IC0xNjU1OCw3ICsxNjU1OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9o
d19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJZm9yX2VhY2hfaW50ZWxfY3J0Yyhk
ZXYsIGNydGMpIHsKIAkJc3RydWN0IGludGVsX2J3X3N0YXRlICpid19zdGF0ZSA9Ci0JCQl0b19p
bnRlbF9id19zdGF0ZShkZXZfcHJpdi0+Yndfb2JqLnN0YXRlKTsKKwkJCXRvX2ludGVsX2J3X3N0
YXRlKGk5MTUtPmJ3X29iai5zdGF0ZSk7CiAJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlID0KIAkJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAJCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CkBAIC0xNjU4NSw3ICsxNjU4NSw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQogCiAJCQlpbnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlKTsKIAotCQkJ
aWYgKGRldl9wcml2LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsaykgeworCQkJaWYgKGk5MTUt
PmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xrKSB7CiAJCQkJbWluX2NkY2xrID0gaW50ZWxfY3J0
Y19jb21wdXRlX21pbl9jZGNsayhjcnRjX3N0YXRlKTsKIAkJCQlpZiAoV0FSTl9PTihtaW5fY2Rj
bGsgPCAwKSkKIAkJCQkJbWluX2NkY2xrID0gMDsKQEAgLTE2NTk2LDExICsxNjU5NiwxMSBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZp
Y2UgKmRldikKIAkJCXVwZGF0ZV9zY2FubGluZV9vZmZzZXQoY3J0Y19zdGF0ZSk7CiAJCX0KIAot
CQlkZXZfcHJpdi0+bWluX2NkY2xrW2NydGMtPnBpcGVdID0gbWluX2NkY2xrOwotCQlkZXZfcHJp
di0+bWluX3ZvbHRhZ2VfbGV2ZWxbY3J0Yy0+cGlwZV0gPQorCQlpOTE1LT5taW5fY2RjbGtbY3J0
Yy0+cGlwZV0gPSBtaW5fY2RjbGs7CisJCWk5MTUtPm1pbl92b2x0YWdlX2xldmVsW2NydGMtPnBp
cGVdID0KIAkJCWNydGNfc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsOwogCi0JCWZvcl9lYWNoX2lu
dGVsX3BsYW5lX29uX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMsIHBsYW5lKSB7CisJCWZvcl9l
YWNoX2ludGVsX3BsYW5lX29uX2NydGMoJmk5MTUtPmRybSwgY3J0YywgcGxhbmUpIHsKIAkJCWNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQogCQkJCXRvX2ludGVs
X3BsYW5lX3N0YXRlKHBsYW5lLT5iYXNlLnN0YXRlKTsKIApAQCAtMTY2MTUsMTYgKzE2NjE1LDE2
IEBAIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KQogCiAJCWludGVsX2J3X2NydGNfdXBkYXRlKGJ3X3N0YXRlLCBjcnRjX3N0
YXRlKTsKIAotCQlpbnRlbF9waXBlX2NvbmZpZ19zYW5pdHlfY2hlY2soZGV2X3ByaXYsIGNydGNf
c3RhdGUpOworCQlpbnRlbF9waXBlX2NvbmZpZ19zYW5pdHlfY2hlY2soaTkxNSwgY3J0Y19zdGF0
ZSk7CiAJfQogfQogCiBzdGF0aWMgdm9pZAotZ2V0X2VuY29kZXJfcG93ZXJfZG9tYWlucyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitnZXRfZW5jb2Rlcl9wb3dlcl9kb21haW5z
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyOwogCi0JZm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5j
b2RlcikgeworCWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmk5MTUtPmRybSwgZW5jb2Rlcikgewog
CQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKIAogCQlpZiAoIWVuY29kZXIt
PmdldF9wb3dlcl9kb21haW5zKQpAQCAtMTY2NDIsMTQgKzE2NjQyLDE0IEBAIGdldF9lbmNvZGVy
X3Bvd2VyX2RvbWFpbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIH0K
IAotc3RhdGljIHZvaWQgaW50ZWxfZWFybHlfZGlzcGxheV93YXMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaW50ZWxfZWFybHlfZGlzcGxheV93YXMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyogRGlzcGxheSBXQSAjMTE4NSBXYURp
c2FibGVEQVJCRkNsa0dhdGluZzpjbmwsZ2xrICovCi0JaWYgKElTX0NBTk5PTkxBS0UoZGV2X3By
aXYpIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCWlmIChJU19DQU5OT05MQUtFKGk5MTUp
IHx8IElTX0dFTUlOSUxBS0UoaTkxNSkpCiAJCUk5MTVfV1JJVEUoR0VOOV9DTEtHQVRFX0RJU18w
LCBJOTE1X1JFQUQoR0VOOV9DTEtHQVRFX0RJU18wKSB8CiAJCQkgICBEQVJCRl9HQVRJTkdfRElT
KTsKIAotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSkgeworCWlmIChJU19IQVNXRUxMKGk5MTUp
KSB7CiAJCS8qCiAJCSAqIFdhUnNQa2dDU3RhdGVEaXNwbGF5UE1SZXE6aHN3CiAJCSAqIFN5c3Rl
bSBoYW5nIGlmIHRoaXMgaXNuJ3QgZG9uZSBiZWZvcmUgZGlzYWJsaW5nIGFsbCBwbGFuZXMhCkBA
IC0xNjY1OSw3ICsxNjY1OSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Vhcmx5X2Rpc3BsYXlfd2Fz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiB9CiAKLXN0YXRpYyB2b2lk
IGlieF9zYW5pdGl6ZV9wY2hfaGRtaV9wb3J0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyB2b2lkIGlieF9zYW5pdGl6ZV9wY2hfaGRtaV9wb3J0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgICBlbnVtIHBvcnQgcG9ydCwgaTkxNV9yZWdf
dCBoZG1pX3JlZykKIHsKIAl1MzIgdmFsID0gSTkxNV9SRUFEKGhkbWlfcmVnKTsKQEAgLTE2Njc3
LDcgKzE2Njc3LDcgQEAgc3RhdGljIHZvaWQgaWJ4X3Nhbml0aXplX3BjaF9oZG1pX3BvcnQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoaGRtaV9yZWcsIHZh
bCk7CiB9CiAKLXN0YXRpYyB2b2lkIGlieF9zYW5pdGl6ZV9wY2hfZHBfcG9ydChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpYnhfc2FuaXRpemVfcGNoX2Rw
X3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICBlbnVtIHBvcnQg
cG9ydCwgaTkxNV9yZWdfdCBkcF9yZWcpCiB7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChkcF9yZWcp
OwpAQCAtMTY2OTUsNyArMTY2OTUsNyBAQCBzdGF0aWMgdm9pZCBpYnhfc2FuaXRpemVfcGNoX2Rw
X3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoZHBf
cmVnLCB2YWwpOwogfQogCi1zdGF0aWMgdm9pZCBpYnhfc2FuaXRpemVfcGNoX3BvcnRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGlieF9zYW5pdGl6ZV9w
Y2hfcG9ydHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyoKIAkgKiBUaGUg
QklPUyBtYXkgc2VsZWN0IHRyYW5zY29kZXIgQiBvbiBzb21lIG9mIHRoZSBQQ0gKQEAgLTE2NzA4
LDE0ICsxNjcwOCwxNCBAQCBzdGF0aWMgdm9pZCBpYnhfc2FuaXRpemVfcGNoX3BvcnRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiAoc2VlLiBpbnRlbF9kcF9saW5rX2Rv
d24oKSwgaW50ZWxfZGlzYWJsZV9oZG1pKCksCiAJICogaW50ZWxfZGlzYWJsZV9zZHZvKCkpLgog
CSAqLwotCWlieF9zYW5pdGl6ZV9wY2hfZHBfcG9ydChkZXZfcHJpdiwgUE9SVF9CLCBQQ0hfRFBf
Qik7Ci0JaWJ4X3Nhbml0aXplX3BjaF9kcF9wb3J0KGRldl9wcml2LCBQT1JUX0MsIFBDSF9EUF9D
KTsKLQlpYnhfc2FuaXRpemVfcGNoX2RwX3BvcnQoZGV2X3ByaXYsIFBPUlRfRCwgUENIX0RQX0Qp
OworCWlieF9zYW5pdGl6ZV9wY2hfZHBfcG9ydChpOTE1LCBQT1JUX0IsIFBDSF9EUF9CKTsKKwlp
Ynhfc2FuaXRpemVfcGNoX2RwX3BvcnQoaTkxNSwgUE9SVF9DLCBQQ0hfRFBfQyk7CisJaWJ4X3Nh
bml0aXplX3BjaF9kcF9wb3J0KGk5MTUsIFBPUlRfRCwgUENIX0RQX0QpOwogCiAJLyogUENIIFNE
Vk9CIG11bHRpcGxleCB3aXRoIEhETUlCICovCi0JaWJ4X3Nhbml0aXplX3BjaF9oZG1pX3BvcnQo
ZGV2X3ByaXYsIFBPUlRfQiwgUENIX0hETUlCKTsKLQlpYnhfc2FuaXRpemVfcGNoX2hkbWlfcG9y
dChkZXZfcHJpdiwgUE9SVF9DLCBQQ0hfSERNSUMpOwotCWlieF9zYW5pdGl6ZV9wY2hfaGRtaV9w
b3J0KGRldl9wcml2LCBQT1JUX0QsIFBDSF9IRE1JRCk7CisJaWJ4X3Nhbml0aXplX3BjaF9oZG1p
X3BvcnQoaTkxNSwgUE9SVF9CLCBQQ0hfSERNSUIpOworCWlieF9zYW5pdGl6ZV9wY2hfaGRtaV9w
b3J0KGk5MTUsIFBPUlRfQywgUENIX0hETUlDKTsKKwlpYnhfc2FuaXRpemVfcGNoX2hkbWlfcG9y
dChpOTE1LCBQT1JUX0QsIFBDSF9IRE1JRCk7CiB9CiAKIC8qIFNjYW4gb3V0IHRoZSBjdXJyZW50
IGh3IG1vZGVzZXQgc3RhdGUsCkBAIC0xNjcyNSwyOSArMTY3MjUsMjkgQEAgc3RhdGljIHZvaWQK
IGludGVsX21vZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJ
CSAgICAgc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4ICpjdHgpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBpOwogCi0J
d2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGRldl9wcml2LCBQT1dFUl9ET01BSU5f
SU5JVCk7CisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGk5MTUsIFBPV0VSX0RP
TUFJTl9JTklUKTsKIAotCWludGVsX2Vhcmx5X2Rpc3BsYXlfd2FzKGRldl9wcml2KTsKKwlpbnRl
bF9lYXJseV9kaXNwbGF5X3dhcyhpOTE1KTsKIAlpbnRlbF9tb2Rlc2V0X3JlYWRvdXRfaHdfc3Rh
dGUoZGV2KTsKIAogCS8qIEhXIHN0YXRlIGlzIHJlYWQgb3V0LCBub3cgd2UgbmVlZCB0byBzYW5p
dGl6ZSB0aGlzIG1lc3MuICovCi0JZ2V0X2VuY29kZXJfcG93ZXJfZG9tYWlucyhkZXZfcHJpdik7
CisJZ2V0X2VuY29kZXJfcG93ZXJfZG9tYWlucyhpOTE1KTsKIAotCWlmIChIQVNfUENIX0lCWChk
ZXZfcHJpdikpCi0JCWlieF9zYW5pdGl6ZV9wY2hfcG9ydHMoZGV2X3ByaXYpOworCWlmIChIQVNf
UENIX0lCWChpOTE1KSkKKwkJaWJ4X3Nhbml0aXplX3BjaF9wb3J0cyhpOTE1KTsKIAogCS8qCiAJ
ICogaW50ZWxfc2FuaXRpemVfcGxhbmVfbWFwcGluZygpIG1heSBuZWVkIHRvIGRvIHZibGFuawog
CSAqIHdhaXRzLCBzbyB3ZSBuZWVkIHZibGFuayBpbnRlcnJ1cHRzIHJlc3RvcmVkIGJlZm9yZWhh
bmQuCiAJICovCi0JZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0Yykgewor
CWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRybSwgY3J0YykgewogCQljcnRjX3N0YXRlID0g
dG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAogCQlkcm1fY3J0Y192Ymxh
bmtfcmVzZXQoJmNydGMtPmJhc2UpOwpAQCAtMTY3NTYsMTIgKzE2NzU2LDEyIEBAIGludGVsX21v
ZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCWludGVsX2Ny
dGNfdmJsYW5rX29uKGNydGNfc3RhdGUpOwogCX0KIAotCWludGVsX3Nhbml0aXplX3BsYW5lX21h
cHBpbmcoZGV2X3ByaXYpOworCWludGVsX3Nhbml0aXplX3BsYW5lX21hcHBpbmcoaTkxNSk7CiAK
IAlmb3JfZWFjaF9pbnRlbF9lbmNvZGVyKGRldiwgZW5jb2RlcikKIAkJaW50ZWxfc2FuaXRpemVf
ZW5jb2RlcihlbmNvZGVyKTsKIAotCWZvcl9lYWNoX2ludGVsX2NydGMoJmRldl9wcml2LT5kcm0s
IGNydGMpIHsKKwlmb3JfZWFjaF9pbnRlbF9jcnRjKCZpOTE1LT5kcm0sIGNydGMpIHsKIAkJY3J0
Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAJCWludGVs
X3Nhbml0aXplX2NydGMoY3J0YywgY3R4KTsKIAkJaW50ZWxfZHVtcF9waXBlX2NvbmZpZyhjcnRj
X3N0YXRlLCBOVUxMLCAiW3NldHVwX2h3X3N0YXRlXSIpOwpAQCAtMTY3NjksOCArMTY3NjksOCBA
QCBpbnRlbF9tb2Rlc2V0X3NldHVwX2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAK
IAlpbnRlbF9tb2Rlc2V0X3VwZGF0ZV9jb25uZWN0b3JfYXRvbWljX3N0YXRlKGRldik7CiAKLQlm
b3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPm51bV9zaGFyZWRfZHBsbDsgaSsrKSB7Ci0JCXN0cnVj
dCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gJmRldl9wcml2LT5zaGFyZWRfZHBsbHNbaV07CisJ
Zm9yIChpID0gMDsgaSA8IGk5MTUtPm51bV9zaGFyZWRfZHBsbDsgaSsrKSB7CisJCXN0cnVjdCBp
bnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gJmk5MTUtPnNoYXJlZF9kcGxsc1tpXTsKIAogCQlpZiAo
IXBsbC0+b24gfHwgcGxsLT5hY3RpdmVfbWFzaykKIAkJCWNvbnRpbnVlOwpAQCAtMTY3NzgsMjAg
KzE2Nzc4LDIwIEBAIGludGVsX21vZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAkJRFJNX0RFQlVHX0tNUygiJXMgZW5hYmxlZCBidXQgbm90IGluIHVzZSwgZGlz
YWJsaW5nXG4iLAogCQkJICAgICAgcGxsLT5pbmZvLT5uYW1lKTsKIAotCQlwbGwtPmluZm8tPmZ1
bmNzLT5kaXNhYmxlKGRldl9wcml2LCBwbGwpOworCQlwbGwtPmluZm8tPmZ1bmNzLT5kaXNhYmxl
KGk5MTUsIHBsbCk7CiAJCXBsbC0+b24gPSBmYWxzZTsKIAl9CiAKLQlpZiAoSVNfRzRYKGRldl9w
cml2KSkgewotCQlnNHhfd21fZ2V0X2h3X3N0YXRlKGRldl9wcml2KTsKLQkJZzR4X3dtX3Nhbml0
aXplKGRldl9wcml2KTsKLQl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElT
X0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7Ci0JCXZsdl93bV9nZXRfaHdfc3RhdGUoZGV2X3ByaXYp
OwotCQl2bHZfd21fc2FuaXRpemUoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSA5KSB7Ci0JCXNrbF93bV9nZXRfaHdfc3RhdGUoZGV2X3ByaXYpOwotCX0gZWxz
ZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpIHsKLQkJaWxrX3dtX2dldF9od19zdGF0ZShk
ZXZfcHJpdik7CisJaWYgKElTX0c0WChpOTE1KSkgeworCQlnNHhfd21fZ2V0X2h3X3N0YXRlKGk5
MTUpOworCQlnNHhfd21fc2FuaXRpemUoaTkxNSk7CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVX
KGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKKwkJdmx2X3dtX2dldF9od19zdGF0ZShp
OTE1KTsKKwkJdmx2X3dtX3Nhbml0aXplKGk5MTUpOworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5
MTUpID49IDkpIHsKKwkJc2tsX3dtX2dldF9od19zdGF0ZShpOTE1KTsKKwl9IGVsc2UgaWYgKEhB
U19QQ0hfU1BMSVQoaTkxNSkpIHsKKwkJaWxrX3dtX2dldF9od19zdGF0ZShpOTE1KTsKIAl9CiAK
IAlmb3JfZWFjaF9pbnRlbF9jcnRjKGRldiwgY3J0YykgewpAQCAtMTY4MDAsMjIgKzE2ODAwLDIy
IEBAIGludGVsX21vZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwK
IAkJY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAJ
CXB1dF9kb21haW5zID0gbW9kZXNldF9nZXRfY3J0Y19wb3dlcl9kb21haW5zKCZjcnRjLT5iYXNl
LCBjcnRjX3N0YXRlKTsKIAkJaWYgKFdBUk5fT04ocHV0X2RvbWFpbnMpKQotCQkJbW9kZXNldF9w
dXRfcG93ZXJfZG9tYWlucyhkZXZfcHJpdiwgcHV0X2RvbWFpbnMpOworCQkJbW9kZXNldF9wdXRf
cG93ZXJfZG9tYWlucyhpOTE1LCBwdXRfZG9tYWlucyk7CiAJfQogCi0JaW50ZWxfZGlzcGxheV9w
b3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9JTklULCB3YWtlcmVmKTsKKwlpbnRlbF9k
aXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01BSU5fSU5JVCwgd2FrZXJlZik7CiAKLQlp
bnRlbF9mYmNfaW5pdF9waXBlX3N0YXRlKGRldl9wcml2KTsKKwlpbnRlbF9mYmNfaW5pdF9waXBl
X3N0YXRlKGk5MTUpOwogfQogCiB2b2lkIGludGVsX2Rpc3BsYXlfcmVzdW1lKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShkZXYpOwotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGRldl9wcml2LT5t
b2Rlc2V0X3Jlc3RvcmVfc3RhdGU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gaTkxNS0+bW9k
ZXNldF9yZXN0b3JlX3N0YXRlOwogCXN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCBjdHg7
CiAJaW50IHJldDsKIAotCWRldl9wcml2LT5tb2Rlc2V0X3Jlc3RvcmVfc3RhdGUgPSBOVUxMOwor
CWk5MTUtPm1vZGVzZXRfcmVzdG9yZV9zdGF0ZSA9IE5VTEw7CiAJaWYgKHN0YXRlKQogCQlzdGF0
ZS0+YWNxdWlyZV9jdHggPSAmY3R4OwogCkBAIC0xNjgzMiw3ICsxNjgzMiw3IEBAIHZvaWQgaW50
ZWxfZGlzcGxheV9yZXN1bWUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAlpZiAoIXJldCkKIAkJ
cmV0ID0gX19pbnRlbF9kaXNwbGF5X3Jlc3VtZShkZXYsIHN0YXRlLCAmY3R4KTsKIAotCWludGVs
X2VuYWJsZV9pcGMoZGV2X3ByaXYpOworCWludGVsX2VuYWJsZV9pcGMoaTkxNSk7CiAJZHJtX21v
ZGVzZXRfZHJvcF9sb2NrcygmY3R4KTsKIAlkcm1fbW9kZXNldF9hY3F1aXJlX2ZpbmkoJmN0eCk7
CiAKQEAgLTE2ODYyLDE5ICsxNjg2MiwxOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9ocGRfcG9sbF9m
aW5pKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIHZvaWQgaW50ZWxfbW9kZXNldF9jbGVhbnVw
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShkZXYpOwogCi0JZmx1c2hfd29ya3F1ZXVlKGRldl9wcml2LT5tb2Rlc2V0X3dxKTsK
KwlmbHVzaF93b3JrcXVldWUoaTkxNS0+bW9kZXNldF93cSk7CiAKLQlmbHVzaF93b3JrKCZkZXZf
cHJpdi0+YXRvbWljX2hlbHBlci5mcmVlX3dvcmspOwotCVdBUk5fT04oIWxsaXN0X2VtcHR5KCZk
ZXZfcHJpdi0+YXRvbWljX2hlbHBlci5mcmVlX2xpc3QpKTsKKwlmbHVzaF93b3JrKCZpOTE1LT5h
dG9taWNfaGVscGVyLmZyZWVfd29yayk7CisJV0FSTl9PTighbGxpc3RfZW1wdHkoJmk5MTUtPmF0
b21pY19oZWxwZXIuZnJlZV9saXN0KSk7CiAKIAkvKgogCSAqIEludGVycnVwdHMgYW5kIHBvbGxp
bmcgYXMgdGhlIGZpcnN0IHRoaW5nIHRvIGF2b2lkIGNyZWF0aW5nIGhhdm9jLgogCSAqIFRvbyBt
dWNoIHN0dWZmIGhlcmUgKHR1cm5pbmcgb2YgY29ubmVjdG9ycywgLi4uKSB3b3VsZAogCSAqIGV4
cGVyaWVuY2UgZmFuY3kgcmFjZXMgb3RoZXJ3aXNlLgogCSAqLwotCWludGVsX2lycV91bmluc3Rh
bGwoZGV2X3ByaXYpOworCWludGVsX2lycV91bmluc3RhbGwoaTkxNSk7CiAKIAkvKgogCSAqIER1
ZSB0byB0aGUgaHBkIGlycSBzdG9ybSBoYW5kbGluZyB0aGUgaG90cGx1ZyB3b3JrIGNhbiByZS1h
cm0gdGhlCkBAIC0xNjg4MywzNyArMTY4ODMsMzcgQEAgdm9pZCBpbnRlbF9tb2Rlc2V0X2NsZWFu
dXAoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAlpbnRlbF9ocGRfcG9sbF9maW5pKGRldik7CiAK
IAkvKiBwb2xsIHdvcmsgY2FuIGNhbGwgaW50byBmYmRldiwgaGVuY2UgY2xlYW4gdGhhdCB1cCBh
ZnRlcndhcmRzICovCi0JaW50ZWxfZmJkZXZfZmluaShkZXZfcHJpdik7CisJaW50ZWxfZmJkZXZf
ZmluaShpOTE1KTsKIAogCWludGVsX3VucmVnaXN0ZXJfZHNtX2hhbmRsZXIoKTsKIAotCWludGVs
X2ZiY19nbG9iYWxfZGlzYWJsZShkZXZfcHJpdik7CisJaW50ZWxfZmJjX2dsb2JhbF9kaXNhYmxl
KGk5MTUpOwogCiAJLyogZmx1c2ggYW55IGRlbGF5ZWQgdGFza3Mgb3IgcGVuZGluZyB3b3JrICov
CiAJZmx1c2hfc2NoZWR1bGVkX3dvcmsoKTsKIAotCWludGVsX2hkY3BfY29tcG9uZW50X2Zpbmko
ZGV2X3ByaXYpOworCWludGVsX2hkY3BfY29tcG9uZW50X2ZpbmkoaTkxNSk7CiAKIAlkcm1fbW9k
ZV9jb25maWdfY2xlYW51cChkZXYpOwogCi0JaW50ZWxfb3ZlcmxheV9jbGVhbnVwKGRldl9wcml2
KTsKKwlpbnRlbF9vdmVybGF5X2NsZWFudXAoaTkxNSk7CiAKLQlpbnRlbF9nbWJ1c190ZWFyZG93
bihkZXZfcHJpdik7CisJaW50ZWxfZ21idXNfdGVhcmRvd24oaTkxNSk7CiAKLQlkZXN0cm95X3dv
cmtxdWV1ZShkZXZfcHJpdi0+bW9kZXNldF93cSk7CisJZGVzdHJveV93b3JrcXVldWUoaTkxNS0+
bW9kZXNldF93cSk7CiAKLQlpbnRlbF9mYmNfY2xlYW51cF9jZmIoZGV2X3ByaXYpOworCWludGVs
X2ZiY19jbGVhbnVwX2NmYihpOTE1KTsKIH0KIAogLyoKICAqIHNldCB2Z2EgZGVjb2RlIHN0YXRl
IC0gdHJ1ZSA9PSBlbmFibGUgVkdBIGRlY29kZQogICovCi1pbnQgaW50ZWxfbW9kZXNldF92Z2Ff
c2V0X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBzdGF0ZSkK
K2ludCBpbnRlbF9tb2Rlc2V0X3ZnYV9zZXRfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIGJvb2wgc3RhdGUpCiB7Ci0JdW5zaWduZWQgcmVnID0gSU5URUxfR0VOKGRldl9wcml2
KSA+PSA2ID8gU05CX0dNQ0hfQ1RSTCA6IElOVEVMX0dNQ0hfQ1RSTDsKKwl1bnNpZ25lZCByZWcg
PSBJTlRFTF9HRU4oaTkxNSkgPj0gNiA/IFNOQl9HTUNIX0NUUkwgOiBJTlRFTF9HTUNIX0NUUkw7
CiAJdTE2IGdtY2hfY3RybDsKIAotCWlmIChwY2lfcmVhZF9jb25maWdfd29yZChkZXZfcHJpdi0+
YnJpZGdlX2RldiwgcmVnLCAmZ21jaF9jdHJsKSkgeworCWlmIChwY2lfcmVhZF9jb25maWdfd29y
ZChpOTE1LT5icmlkZ2VfZGV2LCByZWcsICZnbWNoX2N0cmwpKSB7CiAJCURSTV9FUlJPUigiZmFp
bGVkIHRvIHJlYWQgY29udHJvbCB3b3JkXG4iKTsKIAkJcmV0dXJuIC1FSU87CiAJfQpAQCAtMTY5
MjYsNyArMTY5MjYsNyBAQCBpbnQgaW50ZWxfbW9kZXNldF92Z2Ffc2V0X3N0YXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBzdGF0ZSkKIAllbHNlCiAJCWdtY2hfY3Ry
bCB8PSBJTlRFTF9HTUNIX1ZHQV9ESVNBQkxFOwogCi0JaWYgKHBjaV93cml0ZV9jb25maWdfd29y
ZChkZXZfcHJpdi0+YnJpZGdlX2RldiwgcmVnLCBnbWNoX2N0cmwpKSB7CisJaWYgKHBjaV93cml0
ZV9jb25maWdfd29yZChpOTE1LT5icmlkZ2VfZGV2LCByZWcsIGdtY2hfY3RybCkpIHsKIAkJRFJN
X0VSUk9SKCJmYWlsZWQgdG8gd3JpdGUgY29udHJvbCB3b3JkXG4iKTsKIAkJcmV0dXJuIC1FSU87
CiAJfQpAQCAtMTY5ODAsNyArMTY5ODAsNyBAQCBzdHJ1Y3QgaW50ZWxfZGlzcGxheV9lcnJvcl9z
dGF0ZSB7CiB9OwogCiBzdHJ1Y3QgaW50ZWxfZGlzcGxheV9lcnJvcl9zdGF0ZSAqCi1pbnRlbF9k
aXNwbGF5X2NhcHR1cmVfZXJyb3Jfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQoraW50ZWxfZGlzcGxheV9jYXB0dXJlX2Vycm9yX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9kaXNwbGF5X2Vycm9yX3N0YXRlICplcnJv
cjsKIAlpbnQgdHJhbnNjb2RlcnNbXSA9IHsKQEAgLTE2OTkzLDE5ICsxNjk5MywxOSBAQCBpbnRl
bF9kaXNwbGF5X2NhcHR1cmVfZXJyb3Jfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCiAJQlVJTERfQlVHX09OKEFSUkFZX1NJWkUodHJhbnNjb2RlcnMpICE9IEFSUkFZ
X1NJWkUoZXJyb3ItPnRyYW5zY29kZXIpKTsKIAotCWlmICghSEFTX0RJU1BMQVkoZGV2X3ByaXYp
KQorCWlmICghSEFTX0RJU1BMQVkoaTkxNSkpCiAJCXJldHVybiBOVUxMOwogCiAJZXJyb3IgPSBr
emFsbG9jKHNpemVvZigqZXJyb3IpLCBHRlBfQVRPTUlDKTsKIAlpZiAoZXJyb3IgPT0gTlVMTCkK
IAkJcmV0dXJuIE5VTEw7CiAKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURX
RUxMKGRldl9wcml2KSkKKwlpZiAoSVNfSEFTV0VMTChpOTE1KSB8fCBJU19CUk9BRFdFTEwoaTkx
NSkpCiAJCWVycm9yLT5wb3dlcl93ZWxsX2RyaXZlciA9IEk5MTVfUkVBRChIU1dfUFdSX1dFTExf
Q1RMMik7CiAKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBpKSB7CisJZm9yX2VhY2hfcGlwZShp
OTE1LCBpKSB7CiAJCWVycm9yLT5waXBlW2ldLnBvd2VyX2RvbWFpbl9vbiA9Ci0JCQlfX2ludGVs
X2Rpc3BsYXlfcG93ZXJfaXNfZW5hYmxlZChkZXZfcHJpdiwKKwkJCV9faW50ZWxfZGlzcGxheV9w
b3dlcl9pc19lbmFibGVkKGk5MTUsCiAJCQkJCQkJIFBPV0VSX0RPTUFJTl9QSVBFKGkpKTsKIAkJ
aWYgKCFlcnJvci0+cGlwZVtpXS5wb3dlcl9kb21haW5fb24pCiAJCQljb250aW51ZTsKQEAgLTE3
MDE2LDMyICsxNzAxNiwzMiBAQCBpbnRlbF9kaXNwbGF5X2NhcHR1cmVfZXJyb3Jfc3RhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJCWVycm9yLT5wbGFuZVtpXS5jb250
cm9sID0gSTkxNV9SRUFEKERTUENOVFIoaSkpOwogCQllcnJvci0+cGxhbmVbaV0uc3RyaWRlID0g
STkxNV9SRUFEKERTUFNUUklERShpKSk7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDMp
IHsKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA8PSAzKSB7CiAJCQllcnJvci0+cGxhbmVbaV0uc2l6
ZSA9IEk5MTVfUkVBRChEU1BTSVpFKGkpKTsKIAkJCWVycm9yLT5wbGFuZVtpXS5wb3MgPSBJOTE1
X1JFQUQoRFNQUE9TKGkpKTsKIAkJfQotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8PSA3ICYm
ICFJU19IQVNXRUxMKGRldl9wcml2KSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA8PSA3ICYmICFJ
U19IQVNXRUxMKGk5MTUpKQogCQkJZXJyb3ItPnBsYW5lW2ldLmFkZHIgPSBJOTE1X1JFQUQoRFNQ
QUREUihpKSk7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpIHsKKwkJaWYgKElOVEVM
X0dFTihpOTE1KSA+PSA0KSB7CiAJCQllcnJvci0+cGxhbmVbaV0uc3VyZmFjZSA9IEk5MTVfUkVB
RChEU1BTVVJGKGkpKTsKIAkJCWVycm9yLT5wbGFuZVtpXS50aWxlX29mZnNldCA9IEk5MTVfUkVB
RChEU1BUSUxFT0ZGKGkpKTsKIAkJfQogCiAJCWVycm9yLT5waXBlW2ldLnNvdXJjZSA9IEk5MTVf
UkVBRChQSVBFU1JDKGkpKTsKIAotCQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpKQorCQlpZiAoSEFT
X0dNQ0goaTkxNSkpCiAJCQllcnJvci0+cGlwZVtpXS5zdGF0ID0gSTkxNV9SRUFEKFBJUEVTVEFU
KGkpKTsKIAl9CiAKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShlcnJvci0+dHJhbnNjb2Rl
cik7IGkrKykgewogCQllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSB0cmFuc2NvZGVy
c1tpXTsKIAotCQlpZiAoIUlOVEVMX0lORk8oZGV2X3ByaXYpLT50cmFuc19vZmZzZXRzW2NwdV90
cmFuc2NvZGVyXSkKKwkJaWYgKCFJTlRFTF9JTkZPKGk5MTUpLT50cmFuc19vZmZzZXRzW2NwdV90
cmFuc2NvZGVyXSkKIAkJCWNvbnRpbnVlOwogCiAJCWVycm9yLT50cmFuc2NvZGVyW2ldLmF2YWls
YWJsZSA9IHRydWU7CiAJCWVycm9yLT50cmFuc2NvZGVyW2ldLnBvd2VyX2RvbWFpbl9vbiA9Ci0J
CQlfX2ludGVsX2Rpc3BsYXlfcG93ZXJfaXNfZW5hYmxlZChkZXZfcHJpdiwKKwkJCV9faW50ZWxf
ZGlzcGxheV9wb3dlcl9pc19lbmFibGVkKGk5MTUsCiAJCQkJUE9XRVJfRE9NQUlOX1RSQU5TQ09E
RVIoY3B1X3RyYW5zY29kZXIpKTsKIAkJaWYgKCFlcnJvci0+dHJhbnNjb2RlcltpXS5wb3dlcl9k
b21haW5fb24pCiAJCQljb250aW51ZTsKQEAgLTE3MDY2LDE3ICsxNzA2NiwxNyBAQCB2b2lkCiBp
bnRlbF9kaXNwbGF5X3ByaW50X2Vycm9yX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0
ZV9idWYgKm0sCiAJCQkJc3RydWN0IGludGVsX2Rpc3BsYXlfZXJyb3Jfc3RhdGUgKmVycm9yKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPmk5MTU7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBtLT5pOTE1OwogCWludCBpOwogCiAJaWYgKCFlcnJv
cikKIAkJcmV0dXJuOwogCi0JZXJyX3ByaW50ZihtLCAiTnVtIFBpcGVzOiAlZFxuIiwgSU5URUxf
SU5GTyhkZXZfcHJpdiktPm51bV9waXBlcyk7Ci0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8
IElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJZXJyX3ByaW50ZihtLCAiTnVtIFBpcGVzOiAlZFxu
IiwgSU5URUxfSU5GTyhpOTE1KS0+bnVtX3BpcGVzKTsKKwlpZiAoSVNfSEFTV0VMTChpOTE1KSB8
fCBJU19CUk9BRFdFTEwoaTkxNSkpCiAJCWVycl9wcmludGYobSwgIlBXUl9XRUxMX0NUTDI6ICUw
OHhcbiIsCiAJCQkgICBlcnJvci0+cG93ZXJfd2VsbF9kcml2ZXIpOwotCWZvcl9lYWNoX3BpcGUo
ZGV2X3ByaXYsIGkpIHsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIGkpIHsKIAkJZXJyX3ByaW50Ziht
LCAiUGlwZSBbJWRdOlxuIiwgaSk7CiAJCWVycl9wcmludGYobSwgIiAgUG93ZXI6ICVzXG4iLAog
CQkJICAgb25vZmYoZXJyb3ItPnBpcGVbaV0ucG93ZXJfZG9tYWluX29uKSk7CkBAIC0xNzA4Niwx
MyArMTcwODYsMTMgQEAgaW50ZWxfZGlzcGxheV9wcmludF9lcnJvcl9zdGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfZXJyb3Jfc3RhdGVfYnVmICptLAogCQllcnJfcHJpbnRmKG0sICJQbGFuZSBbJWRdOlxu
IiwgaSk7CiAJCWVycl9wcmludGYobSwgIiAgQ05UUjogJTA4eFxuIiwgZXJyb3ItPnBsYW5lW2ld
LmNvbnRyb2wpOwogCQllcnJfcHJpbnRmKG0sICIgIFNUUklERTogJTA4eFxuIiwgZXJyb3ItPnBs
YW5lW2ldLnN0cmlkZSk7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDMpIHsKKwkJaWYg
KElOVEVMX0dFTihpOTE1KSA8PSAzKSB7CiAJCQllcnJfcHJpbnRmKG0sICIgIFNJWkU6ICUwOHhc
biIsIGVycm9yLT5wbGFuZVtpXS5zaXplKTsKIAkJCWVycl9wcmludGYobSwgIiAgUE9TOiAlMDh4
XG4iLCBlcnJvci0+cGxhbmVbaV0ucG9zKTsKIAkJfQotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA8PSA3ICYmICFJU19IQVNXRUxMKGRldl9wcml2KSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA8
PSA3ICYmICFJU19IQVNXRUxMKGk5MTUpKQogCQkJZXJyX3ByaW50ZihtLCAiICBBRERSOiAlMDh4
XG4iLCBlcnJvci0+cGxhbmVbaV0uYWRkcik7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDQpIHsKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KSB7CiAJCQllcnJfcHJpbnRmKG0sICIg
IFNVUkY6ICUwOHhcbiIsIGVycm9yLT5wbGFuZVtpXS5zdXJmYWNlKTsKIAkJCWVycl9wcmludGYo
bSwgIiAgVElMRU9GRjogJTA4eFxuIiwgZXJyb3ItPnBsYW5lW2ldLnRpbGVfb2Zmc2V0KTsKIAkJ
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxheS5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxheS5oCmluZGV4IGVlNmI4MTk0YTQ1OS4uN2U0
YjRiMWMwYWM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxheS5oCkBAIC0xMjUsNyAr
MTI1LDcgQEAgZW51bSBpOXh4X3BsYW5lX2lkIHsKIH07CiAKICNkZWZpbmUgcGxhbmVfbmFtZShw
KSAoKHApICsgJ0EnKQotI2RlZmluZSBzcHJpdGVfbmFtZShwLCBzKSAoKHApICogUlVOVElNRV9J
TkZPKGRldl9wcml2KS0+bnVtX3Nwcml0ZXNbKHApXSArIChzKSArICdBJykKKyNkZWZpbmUgc3By
aXRlX25hbWUocCwgcykgKChwKSAqIFJVTlRJTUVfSU5GTyhpOTE1KS0+bnVtX3Nwcml0ZXNbKHAp
XSArIChzKSArICdBJykKIAogLyoKICAqIFBlci1waXBlIHBsYW5lIGlkZW50aWZpZXIuCkBAIC0z
NTMsOCArMzUzLDggQEAgdm9pZCBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBicHAsIGludCBu
bGFuZXMsCiAJCQkgICAgc3RydWN0IGludGVsX2xpbmtfbV9uICptX24sCiAJCQkgICAgYm9vbCBj
b25zdGFudF9uKTsKIGJvb2wgaXNfY2NzX21vZGlmaWVyKHU2NCBtb2RpZmllcik7Ci12b2lkIGxw
dF9kaXNhYmxlX2Nsa291dF9kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwot
dTMyIGludGVsX3BsYW5lX2ZiX21heF9zdHJpZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAordm9pZCBscHRfZGlzYWJsZV9jbGtvdXRfZHAoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwordTMyIGludGVsX3BsYW5lX2ZiX21heF9zdHJpZGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICB1MzIgcGl4ZWxfZm9ybWF0LCB1NjQgbW9kaWZpZXIp
OwogYm9vbCBpbnRlbF9wbGFuZV9jYW5fcmVtYXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2Rpc3BsYXlfcG93ZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXlf
cG93ZXIuYwppbmRleCBiYjllZjFjZWE1ZGIuLjlhY2ZhZDVjODNlZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxheV9wb3dlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2Rpc3BsYXlfcG93ZXIuYwpAQCAtMTcsNyArMTcsNyBAQAogI2luY2x1
ZGUgImludGVsX2hvdHBsdWcuaCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFuZC5oIgogCi1ib29s
IGludGVsX2Rpc3BsYXlfcG93ZXJfd2VsbF9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK2Jvb2wgaW50ZWxfZGlzcGxheV9wb3dlcl93ZWxsX2lzX2VuYWJsZWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSBlbnVtIGk5MTVfcG93ZXJfd2Vs
bF9pZCBwb3dlcl93ZWxsX2lkKTsKIAogY29uc3QgY2hhciAqCkBAIC0xMjIsNDIgKzEyMiw0MiBA
QCBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbl9zdHIoZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2Vy
X2RvbWFpbiBkb21haW4pCiAJfQogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wb3dlcl93ZWxsX2Vu
YWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRl
bF9wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICAgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsKIAlEUk1fREVCVUdfS01T
KCJlbmFibGluZyAlc1xuIiwgcG93ZXJfd2VsbC0+ZGVzYy0+bmFtZSk7Ci0JcG93ZXJfd2VsbC0+
ZGVzYy0+b3BzLT5lbmFibGUoZGV2X3ByaXYsIHBvd2VyX3dlbGwpOworCXBvd2VyX3dlbGwtPmRl
c2MtPm9wcy0+ZW5hYmxlKGk5MTUsIHBvd2VyX3dlbGwpOwogCXBvd2VyX3dlbGwtPmh3X2VuYWJs
ZWQgPSB0cnVlOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wb3dlcl93ZWxsX2Rpc2FibGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50ZWxfcG93ZXJf
d2VsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgc3Ry
dWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsKIAlEUk1fREVCVUdfS01TKCJkaXNh
YmxpbmcgJXNcbiIsIHBvd2VyX3dlbGwtPmRlc2MtPm5hbWUpOwogCXBvd2VyX3dlbGwtPmh3X2Vu
YWJsZWQgPSBmYWxzZTsKLQlwb3dlcl93ZWxsLT5kZXNjLT5vcHMtPmRpc2FibGUoZGV2X3ByaXYs
IHBvd2VyX3dlbGwpOworCXBvd2VyX3dlbGwtPmRlc2MtPm9wcy0+ZGlzYWJsZShpOTE1LCBwb3dl
cl93ZWxsKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfcG93ZXJfd2VsbF9nZXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50ZWxfcG93ZXJfd2VsbF9n
ZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJIHN0cnVjdCBpOTE1X3Bvd2Vy
X3dlbGwgKnBvd2VyX3dlbGwpCiB7CiAJaWYgKCFwb3dlcl93ZWxsLT5jb3VudCsrKQotCQlpbnRl
bF9wb3dlcl93ZWxsX2VuYWJsZShkZXZfcHJpdiwgcG93ZXJfd2VsbCk7CisJCWludGVsX3Bvd2Vy
X3dlbGxfZW5hYmxlKGk5MTUsIHBvd2VyX3dlbGwpOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9w
b3dlcl93ZWxsX3B1dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
dm9pZCBpbnRlbF9wb3dlcl93ZWxsX3B1dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsKIAlXQVJOKCFwb3dl
cl93ZWxsLT5jb3VudCwgIlVzZSBjb3VudCBvbiBwb3dlciB3ZWxsICVzIGlzIGFscmVhZHkgemVy
byIsCiAJICAgICBwb3dlcl93ZWxsLT5kZXNjLT5uYW1lKTsKIAogCWlmICghLS1wb3dlcl93ZWxs
LT5jb3VudCkKLQkJaW50ZWxfcG93ZXJfd2VsbF9kaXNhYmxlKGRldl9wcml2LCBwb3dlcl93ZWxs
KTsKKwkJaW50ZWxfcG93ZXJfd2VsbF9kaXNhYmxlKGk5MTUsIHBvd2VyX3dlbGwpOwogfQogCiAv
KioKICAqIF9faW50ZWxfZGlzcGxheV9wb3dlcl9pc19lbmFibGVkIC0gdW5sb2NrZWQgY2hlY2sg
Zm9yIGEgcG93ZXIgZG9tYWluCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGluc3RhbmNlCisg
KiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqIEBkb21haW46IHBvd2VyIGRvbWFpbiB0
byBjaGVjawogICoKICAqIFRoaXMgaXMgdGhlIHVubG9ja2VkIHZlcnNpb24gb2YgaW50ZWxfZGlz
cGxheV9wb3dlcl9pc19lbmFibGVkKCkgYW5kIHNob3VsZApAQCAtMTY3LDE4ICsxNjcsMTggQEAg
c3RhdGljIHZvaWQgaW50ZWxfcG93ZXJfd2VsbF9wdXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogICogUmV0dXJuczoKICAqIFRydWUgd2hlbiB0aGUgcG93ZXIgZG9tYWluIGlz
IGVuYWJsZWQsIGZhbHNlIG90aGVyd2lzZS4KICAqLwotYm9vbCBfX2ludGVsX2Rpc3BsYXlfcG93
ZXJfaXNfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitib29sIF9f
aW50ZWxfZGlzcGxheV9wb3dlcl9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCSAgICAgIGVudW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gZG9tYWluKQog
ewogCXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGw7CiAJYm9vbCBpc19lbmFibGVk
OwogCi0JaWYgKGRldl9wcml2LT5ydW50aW1lX3BtLnN1c3BlbmRlZCkKKwlpZiAoaTkxNS0+cnVu
dGltZV9wbS5zdXNwZW5kZWQpCiAJCXJldHVybiBmYWxzZTsKIAogCWlzX2VuYWJsZWQgPSB0cnVl
OwogCi0JZm9yX2VhY2hfcG93ZXJfZG9tYWluX3dlbGxfcmV2ZXJzZShkZXZfcHJpdiwgcG93ZXJf
d2VsbCwgQklUX1VMTChkb21haW4pKSB7CisJZm9yX2VhY2hfcG93ZXJfZG9tYWluX3dlbGxfcmV2
ZXJzZShpOTE1LCBwb3dlcl93ZWxsLCBCSVRfVUxMKGRvbWFpbikpIHsKIAkJaWYgKHBvd2VyX3dl
bGwtPmRlc2MtPmFsd2F5c19vbikKIAkJCWNvbnRpbnVlOwogCkBAIC0xOTMsNyArMTkzLDcgQEAg
Ym9vbCBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfaXNfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAKIC8qKgogICogaW50ZWxfZGlzcGxheV9wb3dlcl9pc19lbmFibGVk
IC0gY2hlY2sgZm9yIGEgcG93ZXIgZG9tYWluCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGlu
c3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqIEBkb21haW46IHBvd2Vy
IGRvbWFpbiB0byBjaGVjawogICoKICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIHVzZWQgdG8gY2hl
Y2sgdGhlIGh3IHBvd2VyIGRvbWFpbiBzdGF0ZS4gSXQgaXMgbW9zdGx5CkBAIC0yMDgsMTYgKzIw
OCwxNiBAQCBib29sIF9faW50ZWxfZGlzcGxheV9wb3dlcl9pc19lbmFibGVkKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqIFJldHVybnM6CiAgKiBUcnVlIHdoZW4gdGhlIHBv
d2VyIGRvbWFpbiBpcyBlbmFibGVkLCBmYWxzZSBvdGhlcndpc2UuCiAgKi8KLWJvb2wgaW50ZWxf
ZGlzcGxheV9wb3dlcl9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK2Jvb2wgaW50ZWxfZGlzcGxheV9wb3dlcl9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSAgICBlbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIGRv
bWFpbikKIHsKIAlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zOwogCWJv
b2wgcmV0OwogCi0JcG93ZXJfZG9tYWlucyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlw
b3dlcl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7CiAKIAltdXRleF9sb2NrKCZwb3dl
cl9kb21haW5zLT5sb2NrKTsKLQlyZXQgPSBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfaXNfZW5hYmxl
ZChkZXZfcHJpdiwgZG9tYWluKTsKKwlyZXQgPSBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfaXNfZW5h
YmxlZChpOTE1LCBkb21haW4pOwogCW11dGV4X3VubG9jaygmcG93ZXJfZG9tYWlucy0+bG9jayk7
CiAKIAlyZXR1cm4gcmV0OwpAQCAtMjI5LDEwICsyMjksMTAgQEAgYm9vbCBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2lzX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICog
dG8gYmUgZW5hYmxlZCwgYW5kIGl0IHdpbGwgb25seSBiZSBkaXNhYmxlZCBpZiBub25lIG9mIHRo
ZSByZWdpc3RlcnMgaXMKICAqIHJlcXVlc3RpbmcgaXQgdG8gYmUgZW5hYmxlZC4KICAqLwotc3Rh
dGljIHZvaWQgaHN3X3Bvd2VyX3dlbGxfcG9zdF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaHN3X3Bvd2VyX3dlbGxfcG9zdF9lbmFibGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgIHU4IGlycV9waXBlX21hc2ss
IGJvb2wgaGFzX3ZnYSkKIHsKLQlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGRldl9wcml2LT5kcm0u
cGRldjsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5wZGV2OwogCiAJLyoKIAkg
KiBBZnRlciB3ZSByZS1lbmFibGUgdGhlIHBvd2VyIHdlbGwsIGlmIHdlIHRvdWNoIFZHQSByZWdp
c3RlciAweDNkNQpAQCAtMjUxLDMxICsyNTEsMzEgQEAgc3RhdGljIHZvaWQgaHN3X3Bvd2VyX3dl
bGxfcG9zdF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIAog
CWlmIChpcnFfcGlwZV9tYXNrKQotCQlnZW44X2lycV9wb3dlcl93ZWxsX3Bvc3RfZW5hYmxlKGRl
dl9wcml2LCBpcnFfcGlwZV9tYXNrKTsKKwkJZ2VuOF9pcnFfcG93ZXJfd2VsbF9wb3N0X2VuYWJs
ZShpOTE1LCBpcnFfcGlwZV9tYXNrKTsKIH0KIAotc3RhdGljIHZvaWQgaHN3X3Bvd2VyX3dlbGxf
cHJlX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZv
aWQgaHN3X3Bvd2VyX3dlbGxfcHJlX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICAgICAgIHU4IGlycV9waXBlX21hc2spCiB7CiAJaWYgKGlycV9waXBlX21hc2sp
Ci0JCWdlbjhfaXJxX3Bvd2VyX3dlbGxfcHJlX2Rpc2FibGUoZGV2X3ByaXYsIGlycV9waXBlX21h
c2spOworCQlnZW44X2lycV9wb3dlcl93ZWxsX3ByZV9kaXNhYmxlKGk5MTUsIGlycV9waXBlX21h
c2spOwogfQogCi1zdGF0aWMgdm9pZCBoc3dfd2FpdF9mb3JfcG93ZXJfd2VsbF9lbmFibGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaHN3X3dhaXRfZm9y
X3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkg
ICBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewogCWNvbnN0IHN0cnVjdCBp
OTE1X3Bvd2VyX3dlbGxfcmVncyAqcmVncyA9IHBvd2VyX3dlbGwtPmRlc2MtPmhzdy5yZWdzOwog
CWludCBwd19pZHggPSBwb3dlcl93ZWxsLT5kZXNjLT5oc3cuaWR4OwogCiAJLyogVGltZW91dCBm
b3IgUFcxOjEwIHVzLCBBVVg6bm90IHNwZWNpZmllZCwgb3RoZXIgUFdzOjIwIHVzLiAqLwotCVdB
Uk5fT04oaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJV0FSTl9P
TihpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQlyZWdzLT5kcml2
ZXIsCiAJCQkJCUhTV19QV1JfV0VMTF9DVExfU1RBVEUocHdfaWR4KSwKIAkJCQkJSFNXX1BXUl9X
RUxMX0NUTF9TVEFURShwd19pZHgpLAogCQkJCQkxKSk7CiB9CiAKLXN0YXRpYyB1MzIgaHN3X3Bv
d2VyX3dlbGxfcmVxdWVzdGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdTMyIGhzd19wb3dlcl93ZWxsX3JlcXVlc3RlcnMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICAgICBjb25zdCBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsX3JlZ3MgKnJl
Z3MsCiAJCQkJICAgICBpbnQgcHdfaWR4KQogewpAQCAtMjkxLDcgKzI5MSw3IEBAIHN0YXRpYyB1
MzIgaHN3X3Bvd2VyX3dlbGxfcmVxdWVzdGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgaHN3X3dhaXRfZm9yX3Bvd2Vy
X3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
dm9pZCBoc3dfd2FpdF9mb3JfcG93ZXJfd2VsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJCQkgICAgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkK
IHsKIAljb25zdCBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsX3JlZ3MgKnJlZ3MgPSBwb3dlcl93ZWxs
LT5kZXNjLT5oc3cucmVnczsKQEAgLTMxMCw3ICszMTAsNyBAQCBzdGF0aWMgdm9pZCBoc3dfd2Fp
dF9mb3JfcG93ZXJfd2VsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkgKi8KIAl3YWl0X2ZvcigoZGlzYWJsZWQgPSAhKEk5MTVfUkVBRChyZWdzLT5kcml2ZXIp
ICYKIAkJCSAgICAgICBIU1dfUFdSX1dFTExfQ1RMX1NUQVRFKHB3X2lkeCkpKSB8fAotCQkgKHJl
cXMgPSBoc3dfcG93ZXJfd2VsbF9yZXF1ZXN0ZXJzKGRldl9wcml2LCByZWdzLCBwd19pZHgpKSwg
MSk7CisJCSAocmVxcyA9IGhzd19wb3dlcl93ZWxsX3JlcXVlc3RlcnMoaTkxNSwgcmVncywgcHdf
aWR4KSksIDEpOwogCWlmIChkaXNhYmxlZCkKIAkJcmV0dXJuOwogCkBAIC0zMTksMTYgKzMxOSwx
NiBAQCBzdGF0aWMgdm9pZCBoc3dfd2FpdF9mb3JfcG93ZXJfd2VsbF9kaXNhYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJICAgICAgISEocmVxcyAmIDEpLCAhIShyZXFz
ICYgMiksICEhKHJlcXMgJiA0KSwgISEocmVxcyAmIDgpKTsKIH0KIAotc3RhdGljIHZvaWQgZ2Vu
OV93YWl0X2Zvcl9wb3dlcl93ZWxsX2Z1c2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyB2b2lkIGdlbjlfd2FpdF9mb3JfcG93ZXJfd2VsbF9mdXNlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgZW51bSBza2xfcG93ZXJfZ2F0ZSBwZykK
IHsKIAkvKiBUaW1lb3V0IDV1cyBmb3IgUEcjMCwgZm9yIG90aGVyIFBHcyAxdXMgKi8KLQlXQVJO
X09OKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBTS0xfRlVTRV9T
VEFUVVMsCisJV0FSTl9PTihpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLCBT
S0xfRlVTRV9TVEFUVVMsCiAJCQkJCVNLTF9GVVNFX1BHX0RJU1RfU1RBVFVTKHBnKSwKIAkJCQkJ
U0tMX0ZVU0VfUEdfRElTVF9TVEFUVVMocGcpLCAxKSk7CiB9CiAKLXN0YXRpYyB2b2lkIGhzd19w
b3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdm9pZCBoc3dfcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewogCWNvbnN0
IHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGxfcmVncyAqcmVncyA9IHBvd2VyX3dlbGwtPmRlc2MtPmhz
dy5yZWdzOwpAQCAtMzM4LDcgKzMzOCw3IEBAIHN0YXRpYyB2b2lkIGhzd19wb3dlcl93ZWxsX2Vu
YWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdTMyIHZhbDsKIAogCWlm
ICh3YWl0X2Z1c2VzKSB7Ci0JCXBnID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSA/IElDTF9Q
V19DVExfSURYX1RPX1BHKHB3X2lkeCkgOgorCQlwZyA9IElOVEVMX0dFTihpOTE1KSA+PSAxMSA/
IElDTF9QV19DVExfSURYX1RPX1BHKHB3X2lkeCkgOgogCQkJCQkJIFNLTF9QV19DVExfSURYX1RP
X1BHKHB3X2lkeCk7CiAJCS8qCiAJCSAqIEZvciBQVzEgd2UgaGF2ZSB0byB3YWl0IGJvdGggZm9y
IHRoZSBQVzAvUEcwIGZ1c2Ugc3RhdGUKQEAgLTM0OCwxNSArMzQ4LDE1IEBAIHN0YXRpYyB2b2lk
IGhzd19wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJCSAqIGFmdGVyIHRoZSBlbmFibGluZy4KIAkJICovCiAJCWlmIChwZyA9PSBTS0xfUEcxKQot
CQkJZ2VuOV93YWl0X2Zvcl9wb3dlcl93ZWxsX2Z1c2VzKGRldl9wcml2LCBTS0xfUEcwKTsKKwkJ
CWdlbjlfd2FpdF9mb3JfcG93ZXJfd2VsbF9mdXNlcyhpOTE1LCBTS0xfUEcwKTsKIAl9CiAKIAl2
YWwgPSBJOTE1X1JFQUQocmVncy0+ZHJpdmVyKTsKIAlJOTE1X1dSSVRFKHJlZ3MtPmRyaXZlciwg
dmFsIHwgSFNXX1BXUl9XRUxMX0NUTF9SRVEocHdfaWR4KSk7Ci0JaHN3X3dhaXRfZm9yX3Bvd2Vy
X3dlbGxfZW5hYmxlKGRldl9wcml2LCBwb3dlcl93ZWxsKTsKKwloc3dfd2FpdF9mb3JfcG93ZXJf
d2VsbF9lbmFibGUoaTkxNSwgcG93ZXJfd2VsbCk7CiAKIAkvKiBEaXNwbGF5IFdBICMxMTc4OiBj
bmwgKi8KLQlpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikgJiYKKwlpZiAoSVNfQ0FOTk9OTEFL
RShpOTE1KSAmJgogCSAgICBwd19pZHggPj0gR0xLX1BXX0NUTF9JRFhfQVVYX0IgJiYKIAkgICAg
cHdfaWR4IDw9IENOTF9QV19DVExfSURYX0FVWF9GKSB7CiAJCXZhbCA9IEk5MTVfUkVBRChDTkxf
QVVYX0FOQU9WUkQxKHB3X2lkeCkpOwpAQCAtMzY1LDMyICszNjUsMzIgQEAgc3RhdGljIHZvaWQg
aHN3X3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAl9CiAKIAlpZiAod2FpdF9mdXNlcykKLQkJZ2VuOV93YWl0X2Zvcl9wb3dlcl93ZWxsX2Z1c2Vz
KGRldl9wcml2LCBwZyk7CisJCWdlbjlfd2FpdF9mb3JfcG93ZXJfd2VsbF9mdXNlcyhpOTE1LCBw
Zyk7CiAKLQloc3dfcG93ZXJfd2VsbF9wb3N0X2VuYWJsZShkZXZfcHJpdiwKKwloc3dfcG93ZXJf
d2VsbF9wb3N0X2VuYWJsZShpOTE1LAogCQkJCSAgIHBvd2VyX3dlbGwtPmRlc2MtPmhzdy5pcnFf
cGlwZV9tYXNrLAogCQkJCSAgIHBvd2VyX3dlbGwtPmRlc2MtPmhzdy5oYXNfdmdhKTsKIH0KIAot
c3RhdGljIHZvaWQgaHN3X3Bvd2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBoc3dfcG93ZXJfd2VsbF9kaXNhYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBv
d2VyX3dlbGwpCiB7CiAJY29uc3Qgc3RydWN0IGk5MTVfcG93ZXJfd2VsbF9yZWdzICpyZWdzID0g
cG93ZXJfd2VsbC0+ZGVzYy0+aHN3LnJlZ3M7CiAJaW50IHB3X2lkeCA9IHBvd2VyX3dlbGwtPmRl
c2MtPmhzdy5pZHg7CiAJdTMyIHZhbDsKIAotCWhzd19wb3dlcl93ZWxsX3ByZV9kaXNhYmxlKGRl
dl9wcml2LAorCWhzd19wb3dlcl93ZWxsX3ByZV9kaXNhYmxlKGk5MTUsCiAJCQkJICAgcG93ZXJf
d2VsbC0+ZGVzYy0+aHN3LmlycV9waXBlX21hc2spOwogCiAJdmFsID0gSTkxNV9SRUFEKHJlZ3Mt
PmRyaXZlcik7CiAJSTkxNV9XUklURShyZWdzLT5kcml2ZXIsIHZhbCAmIH5IU1dfUFdSX1dFTExf
Q1RMX1JFUShwd19pZHgpKTsKLQloc3dfd2FpdF9mb3JfcG93ZXJfd2VsbF9kaXNhYmxlKGRldl9w
cml2LCBwb3dlcl93ZWxsKTsKKwloc3dfd2FpdF9mb3JfcG93ZXJfd2VsbF9kaXNhYmxlKGk5MTUs
IHBvd2VyX3dlbGwpOwogfQogCiAjZGVmaW5lIElDTF9BVVhfUFdfVE9fUE9SVChwd19pZHgpCSgo
cHdfaWR4KSAtIElDTF9QV19DVExfSURYX0FVWF9BKQogCiBzdGF0aWMgdm9pZAotaWNsX2NvbWJv
X3BoeV9hdXhfcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAoraWNsX2NvbWJvX3BoeV9hdXhfcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dl
bGwpCiB7CiAJY29uc3Qgc3RydWN0IGk5MTVfcG93ZXJfd2VsbF9yZWdzICpyZWdzID0gcG93ZXJf
d2VsbC0+ZGVzYy0+aHN3LnJlZ3M7CkBAIC00MDQsMTIgKzQwNCwxMiBAQCBpY2xfY29tYm9fcGh5
X2F1eF9wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJdmFsID0gSTkxNV9SRUFEKElDTF9QT1JUX0NMX0RXMTIocG9ydCkpOwogCUk5MTVfV1JJVEUo
SUNMX1BPUlRfQ0xfRFcxMihwb3J0KSwgdmFsIHwgSUNMX0xBTkVfRU5BQkxFX0FVWCk7CiAKLQlo
c3dfd2FpdF9mb3JfcG93ZXJfd2VsbF9lbmFibGUoZGV2X3ByaXYsIHBvd2VyX3dlbGwpOworCWhz
d193YWl0X2Zvcl9wb3dlcl93ZWxsX2VuYWJsZShpOTE1LCBwb3dlcl93ZWxsKTsKIAogCS8qIERp
c3BsYXkgV0EgIzExNzg6IGljbCAqLwotCWlmIChJU19JQ0VMQUtFKGRldl9wcml2KSAmJgorCWlm
IChJU19JQ0VMQUtFKGk5MTUpICYmCiAJICAgIHB3X2lkeCA+PSBJQ0xfUFdfQ1RMX0lEWF9BVVhf
QSAmJiBwd19pZHggPD0gSUNMX1BXX0NUTF9JRFhfQVVYX0IgJiYKLQkgICAgIWludGVsX2Jpb3Nf
aXNfcG9ydF9lZHAoZGV2X3ByaXYsIHBvcnQpKSB7CisJICAgICFpbnRlbF9iaW9zX2lzX3BvcnRf
ZWRwKGk5MTUsIHBvcnQpKSB7CiAJCXZhbCA9IEk5MTVfUkVBRChJQ0xfQVVYX0FOQU9WUkQxKHB3
X2lkeCkpOwogCQl2YWwgfD0gSUNMX0FVWF9BTkFPVlJEMV9FTkFCTEUgfCBJQ0xfQVVYX0FOQU9W
UkQxX0xET19CWVBBU1M7CiAJCUk5MTVfV1JJVEUoSUNMX0FVWF9BTkFPVlJEMShwd19pZHgpLCB2
YWwpOwpAQCAtNDE3LDcgKzQxNyw3IEBAIGljbF9jb21ib19waHlfYXV4X3Bvd2VyX3dlbGxfZW5h
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogc3RhdGljIHZvaWQK
LWljbF9jb21ib19waHlfYXV4X3Bvd2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCitpY2xfY29tYm9fcGh5X2F1eF9wb3dlcl93ZWxsX2Rpc2FibGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICBzdHJ1Y3QgaTkxNV9wb3dlcl93
ZWxsICpwb3dlcl93ZWxsKQogewogCWNvbnN0IHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGxfcmVncyAq
cmVncyA9IHBvd2VyX3dlbGwtPmRlc2MtPmhzdy5yZWdzOwpAQCAtNDMxLDE0ICs0MzEsMTQgQEAg
aWNsX2NvbWJvX3BoeV9hdXhfcG93ZXJfd2VsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAl2YWwgPSBJOTE1X1JFQUQocmVncy0+ZHJpdmVyKTsKIAlJOTE1X1dS
SVRFKHJlZ3MtPmRyaXZlciwgdmFsICYgfkhTV19QV1JfV0VMTF9DVExfUkVRKHB3X2lkeCkpOwog
Ci0JaHN3X3dhaXRfZm9yX3Bvd2VyX3dlbGxfZGlzYWJsZShkZXZfcHJpdiwgcG93ZXJfd2VsbCk7
CisJaHN3X3dhaXRfZm9yX3Bvd2VyX3dlbGxfZGlzYWJsZShpOTE1LCBwb3dlcl93ZWxsKTsKIH0K
IAogI2RlZmluZSBJQ0xfQVVYX1BXX1RPX0NIKHB3X2lkeCkJXAogCSgocHdfaWR4KSAtIElDTF9Q
V19DVExfSURYX0FVWF9BICsgQVVYX0NIX0EpCiAKIHN0YXRpYyB2b2lkCi1pY2xfdGNfcGh5X2F1
eF9wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitp
Y2xfdGNfcGh5X2F1eF9wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCQkgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsKIAllbnVt
IGF1eF9jaCBhdXhfY2ggPSBJQ0xfQVVYX1BXX1RPX0NIKHBvd2VyX3dlbGwtPmRlc2MtPmhzdy5p
ZHgpOwpAQCAtNDUwLDcgKzQ1MCw3IEBAIGljbF90Y19waHlfYXV4X3Bvd2VyX3dlbGxfZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJdmFsIHw9IERQX0FVWF9DSF9D
VExfVEJUX0lPOwogCUk5MTVfV1JJVEUoRFBfQVVYX0NIX0NUTChhdXhfY2gpLCB2YWwpOwogCi0J
aHN3X3Bvd2VyX3dlbGxfZW5hYmxlKGRldl9wcml2LCBwb3dlcl93ZWxsKTsKKwloc3dfcG93ZXJf
d2VsbF9lbmFibGUoaTkxNSwgcG93ZXJfd2VsbCk7CiB9CiAKIC8qCkBAIC00NTgsNyArNDU4LDcg
QEAgaWNsX3RjX3BoeV9hdXhfcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogICogZW5hYmxlIGl0LCBzbyBjaGVjayBpZiBpdCdzIGVuYWJsZWQgYW5k
IGFsc28gY2hlY2sgaWYgd2UndmUgcmVxdWVzdGVkIGl0IHRvCiAgKiBiZSBlbmFibGVkLgogICov
Ci1zdGF0aWMgYm9vbCBoc3dfcG93ZXJfd2VsbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBib29sIGhzd19wb3dlcl93ZWxsX2VuYWJsZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAq
cG93ZXJfd2VsbCkKIHsKIAljb25zdCBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsX3JlZ3MgKnJlZ3Mg
PSBwb3dlcl93ZWxsLT5kZXNjLT5oc3cucmVnczsKQEAgLTQ3NiwxNCArNDc2LDE0IEBAIHN0YXRp
YyBib29sIGhzd19wb3dlcl93ZWxsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCSAqIEJJT1MncyBvd24gcmVxdWVzdCBiaXRzLCB3aGljaCBhcmUgZm9yY2VkLW9u
IGZvciB0aGVzZSBwb3dlciB3ZWxscwogCSAqIHdoZW4gZXhpdGluZyBEQzUvNi4KIAkgKi8KLQlp
ZiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJiAhSVNfR0VOOV9MUChkZXZfcHJpdikgJiYKKwlpZiAo
SVNfR0VOKGk5MTUsIDkpICYmICFJU19HRU45X0xQKGk5MTUpICYmCiAJICAgIChpZCA9PSBTS0xf
RElTUF9QV18xIHx8IGlkID09IFNLTF9ESVNQX1BXX01JU0NfSU8pKQogCQl2YWwgfD0gSTkxNV9S
RUFEKHJlZ3MtPmJpb3MpOwogCiAJcmV0dXJuICh2YWwgJiBtYXNrKSA9PSBtYXNrOwogfQogCi1z
dGF0aWMgdm9pZCBhc3NlcnRfY2FuX2VuYWJsZV9kYzkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHZvaWQgYXNzZXJ0X2Nhbl9lbmFibGVfZGM5KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCVdBUk5fT05DRSgoSTkxNV9SRUFEKERDX1NUQVRFX0VO
KSAmIERDX1NUQVRFX0VOX0RDOSksCiAJCSAgIkRDOSBhbHJlYWR5IHByb2dyYW1tZWQgdG8gYmUg
ZW5hYmxlZC5cbiIpOwpAQCAtNDkyLDcgKzQ5Miw3IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9jYW5f
ZW5hYmxlX2RjOShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJV0FSTl9PTkNF
KEk5MTVfUkVBRChIU1dfUFdSX1dFTExfQ1RMMikgJgogCQkgIEhTV19QV1JfV0VMTF9DVExfUkVR
KFNLTF9QV19DVExfSURYX1BXXzIpLAogCQkgICJQb3dlciB3ZWxsIDIgb24uXG4iKTsKLQlXQVJO
X09OQ0UoaW50ZWxfaXJxc19lbmFibGVkKGRldl9wcml2KSwKKwlXQVJOX09OQ0UoaW50ZWxfaXJx
c19lbmFibGVkKGk5MTUpLAogCQkgICJJbnRlcnJ1cHRzIG5vdCBkaXNhYmxlZCB5ZXQuXG4iKTsK
IAogCSAvKgpAQCAtNTA0LDkgKzUwNCw5IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9jYW5fZW5hYmxl
X2RjOShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICAqLwogfQogCi1zdGF0
aWMgdm9pZCBhc3NlcnRfY2FuX2Rpc2FibGVfZGM5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyB2b2lkIGFzc2VydF9jYW5fZGlzYWJsZV9kYzkoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JV0FSTl9PTkNFKGludGVsX2lycXNfZW5hYmxlZChkZXZf
cHJpdiksCisJV0FSTl9PTkNFKGludGVsX2lycXNfZW5hYmxlZChpOTE1KSwKIAkJICAiSW50ZXJy
dXB0cyBub3QgZGlzYWJsZWQgeWV0LlxuIik7CiAJV0FSTl9PTkNFKEk5MTVfUkVBRChEQ19TVEFU
RV9FTikgJiBEQ19TVEFURV9FTl9VUFRPX0RDNSwKIAkJICAiREM1IHN0aWxsIG5vdCBkaXNhYmxl
ZC5cbiIpOwpAQCAtNTIwLDcgKzUyMCw3IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9jYW5fZGlzYWJs
ZV9kYzkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAgKi8KIH0KIAotc3Rh
dGljIHZvaWQgZ2VuOV93cml0ZV9kY19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBnZW45X3dyaXRlX2RjX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCXUzMiBzdGF0ZSkKIHsKIAlpbnQgcmV3cml0ZXMgPSAwOwpAQCAt
NTU3LDE0ICs1NTcsMTQgQEAgc3RhdGljIHZvaWQgZ2VuOV93cml0ZV9kY19zdGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAgICBzdGF0ZSwgcmV3cml0ZXMpOwog
fQogCi1zdGF0aWMgdTMyIGdlbjlfZGNfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitzdGF0aWMgdTMyIGdlbjlfZGNfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAl1MzIgbWFzazsKIAogCW1hc2sgPSBEQ19TVEFURV9FTl9VUFRPX0RDNTsKLQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDEx
KQogCQltYXNrIHw9IERDX1NUQVRFX0VOX1VQVE9fREM2IHwgRENfU1RBVEVfRU5fREM5OwotCWVs
c2UgaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0dFTjlfTFAoaTkxNSkp
CiAJCW1hc2sgfD0gRENfU1RBVEVfRU5fREM5OwogCWVsc2UKIAkJbWFzayB8PSBEQ19TVEFURV9F
Tl9VUFRPX0RDNjsKQEAgLTU3MiwyMCArNTcyLDIwIEBAIHN0YXRpYyB1MzIgZ2VuOV9kY19tYXNr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gbWFzazsKIH0KIAot
dm9pZCBnZW45X3Nhbml0aXplX2RjX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3ZvaWQgZ2VuOV9zYW5pdGl6ZV9kY19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKIAl1MzIgdmFsOwogCi0JdmFsID0gSTkxNV9SRUFEKERDX1NUQVRFX0VOKSAm
IGdlbjlfZGNfbWFzayhkZXZfcHJpdik7CisJdmFsID0gSTkxNV9SRUFEKERDX1NUQVRFX0VOKSAm
IGdlbjlfZGNfbWFzayhpOTE1KTsKIAogCURSTV9ERUJVR19LTVMoIlJlc2V0dGluZyBEQyBzdGF0
ZSB0cmFja2luZyBmcm9tICUwMnggdG8gJTAyeFxuIiwKLQkJICAgICAgZGV2X3ByaXYtPmNzci5k
Y19zdGF0ZSwgdmFsKTsKLQlkZXZfcHJpdi0+Y3NyLmRjX3N0YXRlID0gdmFsOworCQkgICAgICBp
OTE1LT5jc3IuZGNfc3RhdGUsIHZhbCk7CisJaTkxNS0+Y3NyLmRjX3N0YXRlID0gdmFsOwogfQog
CiAvKioKICAqIGdlbjlfc2V0X2RjX3N0YXRlIC0gc2V0IHRhcmdldCBkaXNwbGF5IEMgcG93ZXIg
c3RhdGUKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1
IGRldmljZSBpbnN0YW5jZQogICogQHN0YXRlOiB0YXJnZXQgREMgcG93ZXIgc3RhdGUKICAqIC0g
RENfU1RBVEVfRElTQUJMRQogICogLSBEQ19TVEFURV9FTl9VUFRPX0RDNQpAQCAtNjA2LDM1ICs2
MDYsMzUgQEAgdm9pZCBnZW45X3Nhbml0aXplX2RjX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKICAqIGJhY2sgb24gYW5kIHJlZ2lzdGVyIHN0YXRlIGlzIHJlc3RvcmVk
LiBUaGlzIGlzIGd1YXJhbnRlZWQgYnkgdGhlIE1NSU8gd3JpdGUKICAqIHRvIERDX1NUQVRFX0VO
IGJsb2NraW5nIHVudGlsIHRoZSBzdGF0ZSBpcyByZXN0b3JlZC4KICAqLwotc3RhdGljIHZvaWQg
Z2VuOV9zZXRfZGNfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIg
c3RhdGUpCitzdGF0aWMgdm9pZCBnZW45X3NldF9kY19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgdTMyIHN0YXRlKQogewogCXUzMiB2YWw7CiAJdTMyIG1hc2s7CiAKLQlpZiAo
V0FSTl9PTl9PTkNFKHN0YXRlICYgfmRldl9wcml2LT5jc3IuYWxsb3dlZF9kY19tYXNrKSkKLQkJ
c3RhdGUgJj0gZGV2X3ByaXYtPmNzci5hbGxvd2VkX2RjX21hc2s7CisJaWYgKFdBUk5fT05fT05D
RShzdGF0ZSAmIH5pOTE1LT5jc3IuYWxsb3dlZF9kY19tYXNrKSkKKwkJc3RhdGUgJj0gaTkxNS0+
Y3NyLmFsbG93ZWRfZGNfbWFzazsKIAogCXZhbCA9IEk5MTVfUkVBRChEQ19TVEFURV9FTik7Ci0J
bWFzayA9IGdlbjlfZGNfbWFzayhkZXZfcHJpdik7CisJbWFzayA9IGdlbjlfZGNfbWFzayhpOTE1
KTsKIAlEUk1fREVCVUdfS01TKCJTZXR0aW5nIERDIHN0YXRlIGZyb20gJTAyeCB0byAlMDJ4XG4i
LAogCQkgICAgICB2YWwgJiBtYXNrLCBzdGF0ZSk7CiAKIAkvKiBDaGVjayBpZiBETUMgaXMgaWdu
b3Jpbmcgb3VyIERDIHN0YXRlIHJlcXVlc3RzICovCi0JaWYgKCh2YWwgJiBtYXNrKSAhPSBkZXZf
cHJpdi0+Y3NyLmRjX3N0YXRlKQorCWlmICgodmFsICYgbWFzaykgIT0gaTkxNS0+Y3NyLmRjX3N0
YXRlKQogCQlEUk1fRVJST1IoIkRDIHN0YXRlIG1pc21hdGNoICgweCV4IC0+IDB4JXgpXG4iLAot
CQkJICBkZXZfcHJpdi0+Y3NyLmRjX3N0YXRlLCB2YWwgJiBtYXNrKTsKKwkJCSAgaTkxNS0+Y3Ny
LmRjX3N0YXRlLCB2YWwgJiBtYXNrKTsKIAogCXZhbCAmPSB+bWFzazsKIAl2YWwgfD0gc3RhdGU7
CiAKLQlnZW45X3dyaXRlX2RjX3N0YXRlKGRldl9wcml2LCB2YWwpOworCWdlbjlfd3JpdGVfZGNf
c3RhdGUoaTkxNSwgdmFsKTsKIAotCWRldl9wcml2LT5jc3IuZGNfc3RhdGUgPSB2YWwgJiBtYXNr
OworCWk5MTUtPmNzci5kY19zdGF0ZSA9IHZhbCAmIG1hc2s7CiB9CiAKLXZvaWQgYnh0X2VuYWJs
ZV9kYzkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBieHRfZW5hYmxl
X2RjOShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlhc3NlcnRfY2FuX2VuYWJs
ZV9kYzkoZGV2X3ByaXYpOworCWFzc2VydF9jYW5fZW5hYmxlX2RjOShpOTE1KTsKIAogCURSTV9E
RUJVR19LTVMoIkVuYWJsaW5nIERDOVxuIik7CiAJLyoKQEAgLTY0MiwyMyArNjQyLDIzIEBAIHZv
aWQgYnh0X2VuYWJsZV9kYzkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAq
IHBsYXRmb3JtcyB3aXRoIFNvdXRoIERpc3BsYXkgRW5naW5lIG9uIFBDSCwKIAkgKiBiZWNhdXNl
IFBQUyByZWdpc3RlcnMgYXJlIGFsd2F5cyBvbi4KIAkgKi8KLQlpZiAoIUhBU19QQ0hfU1BMSVQo
ZGV2X3ByaXYpKQotCQlpbnRlbF9wb3dlcl9zZXF1ZW5jZXJfcmVzZXQoZGV2X3ByaXYpOwotCWdl
bjlfc2V0X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9FTl9EQzkpOworCWlmICghSEFTX1BD
SF9TUExJVChpOTE1KSkKKwkJaW50ZWxfcG93ZXJfc2VxdWVuY2VyX3Jlc2V0KGk5MTUpOworCWdl
bjlfc2V0X2RjX3N0YXRlKGk5MTUsIERDX1NUQVRFX0VOX0RDOSk7CiB9CiAKLXZvaWQgYnh0X2Rp
c2FibGVfZGM5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgYnh0X2Rp
c2FibGVfZGM5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWFzc2VydF9jYW5f
ZGlzYWJsZV9kYzkoZGV2X3ByaXYpOworCWFzc2VydF9jYW5fZGlzYWJsZV9kYzkoaTkxNSk7CiAK
IAlEUk1fREVCVUdfS01TKCJEaXNhYmxpbmcgREM5XG4iKTsKIAotCWdlbjlfc2V0X2RjX3N0YXRl
KGRldl9wcml2LCBEQ19TVEFURV9ESVNBQkxFKTsKKwlnZW45X3NldF9kY19zdGF0ZShpOTE1LCBE
Q19TVEFURV9ESVNBQkxFKTsKIAotCWludGVsX3Bwc191bmxvY2tfcmVnc193YShkZXZfcHJpdik7
CisJaW50ZWxfcHBzX3VubG9ja19yZWdzX3dhKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBhc3Nl
cnRfY3NyX2xvYWRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
dm9pZCBhc3NlcnRfY3NyX2xvYWRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAlXQVJOX09OQ0UoIUk5MTVfUkVBRChDU1JfUFJPR1JBTSgwKSksCiAJCSAgIkNTUiBwcm9ncmFt
IHN0b3JhZ2Ugc3RhcnQgaXMgTlVMTFxuIik7CkBAIC02NjcsMTIgKzY2NywxMiBAQCBzdGF0aWMg
dm9pZCBhc3NlcnRfY3NyX2xvYWRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICoKLWxvb2t1cF9wb3dlcl93ZWxs
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2xvb2t1cF9wb3dlcl93ZWxsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgIGVudW0gaTkxNV9wb3dlcl93ZWxsX2lk
IHBvd2VyX3dlbGxfaWQpCiB7CiAJc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbDsK
IAotCWZvcl9lYWNoX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIHBvd2VyX3dlbGwpCisJZm9yX2VhY2hf
cG93ZXJfd2VsbChpOTE1LCBwb3dlcl93ZWxsKQogCQlpZiAocG93ZXJfd2VsbC0+ZGVzYy0+aWQg
PT0gcG93ZXJfd2VsbF9pZCkKIAkJCXJldHVybiBwb3dlcl93ZWxsOwogCkBAIC02ODQsNjIgKzY4
NCw2MiBAQCBsb29rdXBfcG93ZXJfd2VsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJICogb3VyIGRyaXZlci4KIAkgKi8KIAlXQVJOKDEsICJQb3dlciB3ZWxsICVkIG5vdCBk
ZWZpbmVkIGZvciB0aGlzIHBsYXRmb3JtXG4iLCBwb3dlcl93ZWxsX2lkKTsKLQlyZXR1cm4gJmRl
dl9wcml2LT5wb3dlcl9kb21haW5zLnBvd2VyX3dlbGxzWzBdOworCXJldHVybiAmaTkxNS0+cG93
ZXJfZG9tYWlucy5wb3dlcl93ZWxsc1swXTsKIH0KIAotc3RhdGljIHZvaWQgYXNzZXJ0X2Nhbl9l
bmFibGVfZGM1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lk
IGFzc2VydF9jYW5fZW5hYmxlX2RjNShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQlib29sIHBnMl9lbmFibGVkID0gaW50ZWxfZGlzcGxheV9wb3dlcl93ZWxsX2lzX2VuYWJsZWQo
ZGV2X3ByaXYsCisJYm9vbCBwZzJfZW5hYmxlZCA9IGludGVsX2Rpc3BsYXlfcG93ZXJfd2VsbF9p
c19lbmFibGVkKGk5MTUsCiAJCQkJCVNLTF9ESVNQX1BXXzIpOwogCiAJV0FSTl9PTkNFKHBnMl9l
bmFibGVkLCAiUEcyIG5vdCBkaXNhYmxlZCB0byBlbmFibGUgREM1LlxuIik7CiAKIAlXQVJOX09O
Q0UoKEk5MTVfUkVBRChEQ19TVEFURV9FTikgJiBEQ19TVEFURV9FTl9VUFRPX0RDNSksCiAJCSAg
IkRDNSBhbHJlYWR5IHByb2dyYW1tZWQgdG8gYmUgZW5hYmxlZC5cbiIpOwotCWFzc2VydF9ycG1f
d2FrZWxvY2tfaGVsZChkZXZfcHJpdik7CisJYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKGk5MTUp
OwogCi0JYXNzZXJ0X2Nzcl9sb2FkZWQoZGV2X3ByaXYpOworCWFzc2VydF9jc3JfbG9hZGVkKGk5
MTUpOwogfQogCi12b2lkIGdlbjlfZW5hYmxlX2RjNShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCit2b2lkIGdlbjlfZW5hYmxlX2RjNShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlhc3NlcnRfY2FuX2VuYWJsZV9kYzUoZGV2X3ByaXYpOworCWFzc2VydF9jYW5f
ZW5hYmxlX2RjNShpOTE1KTsKIAogCURSTV9ERUJVR19LTVMoIkVuYWJsaW5nIERDNVxuIik7CiAK
IAkvKiBXYSBEaXNwbGF5ICMxMTgzOiBza2wsa2JsLGNmbCAqLwotCWlmIChJU19HRU45X0JDKGRl
dl9wcml2KSkKKwlpZiAoSVNfR0VOOV9CQyhpOTE1KSkKIAkJSTkxNV9XUklURShHRU44X0NISUNL
RU5fRENQUl8xLCBJOTE1X1JFQUQoR0VOOF9DSElDS0VOX0RDUFJfMSkgfAogCQkJICAgU0tMX1NF
TEVDVF9BTFRFUk5BVEVfRENfRVhJVCk7CiAKLQlnZW45X3NldF9kY19zdGF0ZShkZXZfcHJpdiwg
RENfU1RBVEVfRU5fVVBUT19EQzUpOworCWdlbjlfc2V0X2RjX3N0YXRlKGk5MTUsIERDX1NUQVRF
X0VOX1VQVE9fREM1KTsKIH0KIAotc3RhdGljIHZvaWQgYXNzZXJ0X2Nhbl9lbmFibGVfZGM2KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGFzc2VydF9jYW5f
ZW5hYmxlX2RjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlXQVJOX09OQ0Uo
STkxNV9SRUFEKFVUSUxfUElOX0NUTCkgJiBVVElMX1BJTl9FTkFCTEUsCiAJCSAgIkJhY2tsaWdo
dCBpcyBub3QgZGlzYWJsZWQuXG4iKTsKIAlXQVJOX09OQ0UoKEk5MTVfUkVBRChEQ19TVEFURV9F
TikgJiBEQ19TVEFURV9FTl9VUFRPX0RDNiksCiAJCSAgIkRDNiBhbHJlYWR5IHByb2dyYW1tZWQg
dG8gYmUgZW5hYmxlZC5cbiIpOwogCi0JYXNzZXJ0X2Nzcl9sb2FkZWQoZGV2X3ByaXYpOworCWFz
c2VydF9jc3JfbG9hZGVkKGk5MTUpOwogfQogCi12b2lkIHNrbF9lbmFibGVfZGM2KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgc2tsX2VuYWJsZV9kYzYoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JYXNzZXJ0X2Nhbl9lbmFibGVfZGM2KGRldl9wcml2
KTsKKwlhc3NlcnRfY2FuX2VuYWJsZV9kYzYoaTkxNSk7CiAKIAlEUk1fREVCVUdfS01TKCJFbmFi
bGluZyBEQzZcbiIpOwogCiAJLyogV2EgRGlzcGxheSAjMTE4Mzogc2tsLGtibCxjZmwgKi8KLQlp
ZiAoSVNfR0VOOV9CQyhkZXZfcHJpdikpCisJaWYgKElTX0dFTjlfQkMoaTkxNSkpCiAJCUk5MTVf
V1JJVEUoR0VOOF9DSElDS0VOX0RDUFJfMSwgSTkxNV9SRUFEKEdFTjhfQ0hJQ0tFTl9EQ1BSXzEp
IHwKIAkJCSAgIFNLTF9TRUxFQ1RfQUxURVJOQVRFX0RDX0VYSVQpOwogCi0JZ2VuOV9zZXRfZGNf
c3RhdGUoZGV2X3ByaXYsIERDX1NUQVRFX0VOX1VQVE9fREM2KTsKKwlnZW45X3NldF9kY19zdGF0
ZShpOTE1LCBEQ19TVEFURV9FTl9VUFRPX0RDNik7CiB9CiAKLXN0YXRpYyB2b2lkIGhzd19wb3dl
cl93ZWxsX3N5bmNfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IHZvaWQgaHN3X3Bvd2VyX3dlbGxfc3luY19odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkgICBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewogCWNvbnN0
IHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGxfcmVncyAqcmVncyA9IHBvd2VyX3dlbGwtPmRlc2MtPmhz
dy5yZWdzOwpAQCAtNzU3LDUyICs3NTcsNTIgQEAgc3RhdGljIHZvaWQgaHN3X3Bvd2VyX3dlbGxf
c3luY19odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0
aWMgdm9pZCBieHRfZHBpb19jbW5fcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgYnh0X2RwaW9fY21uX3Bvd2VyX3dlbGxfZW5h
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgICBzdHJ1Y3QgaTkxNV9w
b3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewotCWJ4dF9kZGlfcGh5X2luaXQoZGV2X3ByaXYsIHBv
d2VyX3dlbGwtPmRlc2MtPmJ4dC5waHkpOworCWJ4dF9kZGlfcGh5X2luaXQoaTkxNSwgcG93ZXJf
d2VsbC0+ZGVzYy0+Ynh0LnBoeSk7CiB9CiAKLXN0YXRpYyB2b2lkIGJ4dF9kcGlvX2Ntbl9wb3dl
cl93ZWxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IHZvaWQgYnh0X2RwaW9fY21uX3Bvd2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCQkJICAgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwp
CiB7Ci0JYnh0X2RkaV9waHlfdW5pbml0KGRldl9wcml2LCBwb3dlcl93ZWxsLT5kZXNjLT5ieHQu
cGh5KTsKKwlieHRfZGRpX3BoeV91bmluaXQoaTkxNSwgcG93ZXJfd2VsbC0+ZGVzYy0+Ynh0LnBo
eSk7CiB9CiAKLXN0YXRpYyBib29sIGJ4dF9kcGlvX2Ntbl9wb3dlcl93ZWxsX2VuYWJsZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgYnh0X2RwaW9fY21u
X3Bvd2VyX3dlbGxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJ
ICAgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwpCiB7Ci0JcmV0dXJuIGJ4dF9k
ZGlfcGh5X2lzX2VuYWJsZWQoZGV2X3ByaXYsIHBvd2VyX3dlbGwtPmRlc2MtPmJ4dC5waHkpOwor
CXJldHVybiBieHRfZGRpX3BoeV9pc19lbmFibGVkKGk5MTUsIHBvd2VyX3dlbGwtPmRlc2MtPmJ4
dC5waHkpOwogfQogCi1zdGF0aWMgdm9pZCBieHRfdmVyaWZ5X2RkaV9waHlfcG93ZXJfd2VsbHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgYnh0X3Zlcmlm
eV9kZGlfcGh5X3Bvd2VyX3dlbGxzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewog
CXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGw7CiAKLQlwb3dlcl93ZWxsID0gbG9v
a3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIEJYVF9ESVNQX1BXX0RQSU9fQ01OX0EpOworCXBvd2Vy
X3dlbGwgPSBsb29rdXBfcG93ZXJfd2VsbChpOTE1LCBCWFRfRElTUF9QV19EUElPX0NNTl9BKTsK
IAlpZiAocG93ZXJfd2VsbC0+Y291bnQgPiAwKQotCQlieHRfZGRpX3BoeV92ZXJpZnlfc3RhdGUo
ZGV2X3ByaXYsIHBvd2VyX3dlbGwtPmRlc2MtPmJ4dC5waHkpOworCQlieHRfZGRpX3BoeV92ZXJp
Znlfc3RhdGUoaTkxNSwgcG93ZXJfd2VsbC0+ZGVzYy0+Ynh0LnBoeSk7CiAKLQlwb3dlcl93ZWxs
ID0gbG9va3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIFZMVl9ESVNQX1BXX0RQSU9fQ01OX0JDKTsK
Kwlwb3dlcl93ZWxsID0gbG9va3VwX3Bvd2VyX3dlbGwoaTkxNSwgVkxWX0RJU1BfUFdfRFBJT19D
TU5fQkMpOwogCWlmIChwb3dlcl93ZWxsLT5jb3VudCA+IDApCi0JCWJ4dF9kZGlfcGh5X3Zlcmlm
eV9zdGF0ZShkZXZfcHJpdiwgcG93ZXJfd2VsbC0+ZGVzYy0+Ynh0LnBoeSk7CisJCWJ4dF9kZGlf
cGh5X3ZlcmlmeV9zdGF0ZShpOTE1LCBwb3dlcl93ZWxsLT5kZXNjLT5ieHQucGh5KTsKIAotCWlm
IChJU19HRU1JTklMQUtFKGRldl9wcml2KSkgewotCQlwb3dlcl93ZWxsID0gbG9va3VwX3Bvd2Vy
X3dlbGwoZGV2X3ByaXYsCisJaWYgKElTX0dFTUlOSUxBS0UoaTkxNSkpIHsKKwkJcG93ZXJfd2Vs
bCA9IGxvb2t1cF9wb3dlcl93ZWxsKGk5MTUsCiAJCQkJCSAgICAgICBHTEtfRElTUF9QV19EUElP
X0NNTl9DKTsKIAkJaWYgKHBvd2VyX3dlbGwtPmNvdW50ID4gMCkKLQkJCWJ4dF9kZGlfcGh5X3Zl
cmlmeV9zdGF0ZShkZXZfcHJpdiwKKwkJCWJ4dF9kZGlfcGh5X3ZlcmlmeV9zdGF0ZShpOTE1LAog
CQkJCQkJIHBvd2VyX3dlbGwtPmRlc2MtPmJ4dC5waHkpOwogCX0KIH0KIAotc3RhdGljIGJvb2wg
Z2VuOV9kY19vZmZfcG93ZXJfd2VsbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyBib29sIGdlbjlfZGNfb2ZmX3Bvd2VyX3dlbGxfZW5hYmxlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgc3RydWN0IGk5MTVfcG93ZXJfd2Vs
bCAqcG93ZXJfd2VsbCkKIHsKIAlyZXR1cm4gKEk5MTVfUkVBRChEQ19TVEFURV9FTikgJiBEQ19T
VEFURV9FTl9VUFRPX0RDNV9EQzZfTUFTSykgPT0gMDsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOV9h
c3NlcnRfZGJ1Zl9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0
YXRpYyB2b2lkIGdlbjlfYXNzZXJ0X2RidWZfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKIAl1MzIgdG1wID0gSTkxNV9SRUFEKERCVUZfQ1RMKTsKIApAQCAtODExLDky
ICs4MTEsOTIgQEAgc3RhdGljIHZvaWQgZ2VuOV9hc3NlcnRfZGJ1Zl9lbmFibGVkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgICAgICJVbmV4cGVjdGVkIERCdWYgcG93ZXIg
cG93ZXIgc3RhdGUgKDB4JTA4eClcbiIsIHRtcCk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjlfZGNf
b2ZmX3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyB2b2lkIGdlbjlfZGNfb2ZmX3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJCQkgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dl
bGwpCiB7CiAJc3RydWN0IGludGVsX2NkY2xrX3N0YXRlIGNkY2xrX3N0YXRlID0ge307CiAKLQln
ZW45X3NldF9kY19zdGF0ZShkZXZfcHJpdiwgRENfU1RBVEVfRElTQUJMRSk7CisJZ2VuOV9zZXRf
ZGNfc3RhdGUoaTkxNSwgRENfU1RBVEVfRElTQUJMRSk7CiAKLQlkZXZfcHJpdi0+ZGlzcGxheS5n
ZXRfY2RjbGsoZGV2X3ByaXYsICZjZGNsa19zdGF0ZSk7CisJaTkxNS0+ZGlzcGxheS5nZXRfY2Rj
bGsoaTkxNSwgJmNkY2xrX3N0YXRlKTsKIAkvKiBDYW4ndCByZWFkIG91dCB2b2x0YWdlX2xldmVs
IHNvIGNhbid0IHVzZSBpbnRlbF9jZGNsa19jaGFuZ2VkKCkgKi8KLQlXQVJOX09OKGludGVsX2Nk
Y2xrX25lZWRzX21vZGVzZXQoJmRldl9wcml2LT5jZGNsay5odywgJmNkY2xrX3N0YXRlKSk7CisJ
V0FSTl9PTihpbnRlbF9jZGNsa19uZWVkc19tb2Rlc2V0KCZpOTE1LT5jZGNsay5odywgJmNkY2xr
X3N0YXRlKSk7CiAKLQlnZW45X2Fzc2VydF9kYnVmX2VuYWJsZWQoZGV2X3ByaXYpOworCWdlbjlf
YXNzZXJ0X2RidWZfZW5hYmxlZChpOTE1KTsKIAotCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkK
LQkJYnh0X3ZlcmlmeV9kZGlfcGh5X3Bvd2VyX3dlbGxzKGRldl9wcml2KTsKKwlpZiAoSVNfR0VO
OV9MUChpOTE1KSkKKwkJYnh0X3ZlcmlmeV9kZGlfcGh5X3Bvd2VyX3dlbGxzKGk5MTUpOwogCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAx
MSkKIAkJLyoKIAkJICogRE1DIHJldGFpbnMgSFcgY29udGV4dCBvbmx5IGZvciBwb3J0IEEsIHRo
ZSBvdGhlciBjb21ibwogCQkgKiBQSFkncyBIVyBjb250ZXh0IGZvciBwb3J0IEIgaXMgbG9zdCBh
ZnRlciBEQyB0cmFuc2l0aW9ucywKIAkJICogc28gd2UgbmVlZCB0byByZXN0b3JlIGl0IG1hbnVh
bGx5LgogCQkgKi8KLQkJaW50ZWxfY29tYm9fcGh5X2luaXQoZGV2X3ByaXYpOworCQlpbnRlbF9j
b21ib19waHlfaW5pdChpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOV9kY19vZmZfcG93ZXJf
d2VsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2
b2lkIGdlbjlfZGNfb2ZmX3Bvd2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkJICAgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsK
LQlpZiAoIWRldl9wcml2LT5jc3IuZG1jX3BheWxvYWQpCisJaWYgKCFpOTE1LT5jc3IuZG1jX3Bh
eWxvYWQpCiAJCXJldHVybjsKIAotCWlmIChkZXZfcHJpdi0+Y3NyLmFsbG93ZWRfZGNfbWFzayAm
IERDX1NUQVRFX0VOX1VQVE9fREM2KQotCQlza2xfZW5hYmxlX2RjNihkZXZfcHJpdik7Ci0JZWxz
ZSBpZiAoZGV2X3ByaXYtPmNzci5hbGxvd2VkX2RjX21hc2sgJiBEQ19TVEFURV9FTl9VUFRPX0RD
NSkKLQkJZ2VuOV9lbmFibGVfZGM1KGRldl9wcml2KTsKKwlpZiAoaTkxNS0+Y3NyLmFsbG93ZWRf
ZGNfbWFzayAmIERDX1NUQVRFX0VOX1VQVE9fREM2KQorCQlza2xfZW5hYmxlX2RjNihpOTE1KTsK
KwllbHNlIGlmIChpOTE1LT5jc3IuYWxsb3dlZF9kY19tYXNrICYgRENfU1RBVEVfRU5fVVBUT19E
QzUpCisJCWdlbjlfZW5hYmxlX2RjNShpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgaTl4eF9wb3dl
cl93ZWxsX3N5bmNfaHdfbm9vcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdm9pZCBpOXh4X3Bvd2VyX3dlbGxfc3luY19od19ub29wKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCQkgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkK
IHsKIH0KIAotc3RhdGljIHZvaWQgaTl4eF9hbHdheXNfb25fcG93ZXJfd2VsbF9ub29wKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGk5eHhfYWx3YXlzX29u
X3Bvd2VyX3dlbGxfbm9vcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAg
c3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsKIH0KIAotc3RhdGljIGJvb2wg
aTl4eF9hbHdheXNfb25fcG93ZXJfd2VsbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyBib29sIGk5eHhfYWx3YXlzX29uX3Bvd2VyX3dlbGxfZW5hYmxl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgICBzdHJ1Y3QgaTkxNV9w
b3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewogCXJldHVybiB0cnVlOwogfQogCi1zdGF0aWMgdm9p
ZCBpODMwX3BpcGVzX3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGk4MzBfcGlwZXNfcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpw
b3dlcl93ZWxsKQogewogCWlmICgoSTkxNV9SRUFEKFBJUEVDT05GKFBJUEVfQSkpICYgUElQRUNP
TkZfRU5BQkxFKSA9PSAwKQotCQlpODMwX2VuYWJsZV9waXBlKGRldl9wcml2LCBQSVBFX0EpOwor
CQlpODMwX2VuYWJsZV9waXBlKGk5MTUsIFBJUEVfQSk7CiAJaWYgKChJOTE1X1JFQUQoUElQRUNP
TkYoUElQRV9CKSkgJiBQSVBFQ09ORl9FTkFCTEUpID09IDApCi0JCWk4MzBfZW5hYmxlX3BpcGUo
ZGV2X3ByaXYsIFBJUEVfQik7CisJCWk4MzBfZW5hYmxlX3BpcGUoaTkxNSwgUElQRV9CKTsKIH0K
IAotc3RhdGljIHZvaWQgaTgzMF9waXBlc19wb3dlcl93ZWxsX2Rpc2FibGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaTgzMF9waXBlc19wb3dlcl93ZWxs
X2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSAgc3RydWN0IGk5
MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsKLQlpODMwX2Rpc2FibGVfcGlwZShkZXZfcHJp
diwgUElQRV9CKTsKLQlpODMwX2Rpc2FibGVfcGlwZShkZXZfcHJpdiwgUElQRV9BKTsKKwlpODMw
X2Rpc2FibGVfcGlwZShpOTE1LCBQSVBFX0IpOworCWk4MzBfZGlzYWJsZV9waXBlKGk5MTUsIFBJ
UEVfQSk7CiB9CiAKLXN0YXRpYyBib29sIGk4MzBfcGlwZXNfcG93ZXJfd2VsbF9lbmFibGVkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBib29sIGk4MzBfcGlwZXNf
cG93ZXJfd2VsbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkg
IHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwpCiB7CiAJcmV0dXJuIEk5MTVfUkVB
RChQSVBFQ09ORihQSVBFX0EpKSAmIFBJUEVDT05GX0VOQUJMRSAmJgogCQlJOTE1X1JFQUQoUElQ
RUNPTkYoUElQRV9CKSkgJiBQSVBFQ09ORl9FTkFCTEU7CiB9CiAKLXN0YXRpYyB2b2lkIGk4MzBf
cGlwZXNfcG93ZXJfd2VsbF9zeW5jX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK3N0YXRpYyB2b2lkIGk4MzBfcGlwZXNfcG93ZXJfd2VsbF9zeW5jX2h3KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2Vy
X3dlbGwpCiB7CiAJaWYgKHBvd2VyX3dlbGwtPmNvdW50ID4gMCkKLQkJaTgzMF9waXBlc19wb3dl
cl93ZWxsX2VuYWJsZShkZXZfcHJpdiwgcG93ZXJfd2VsbCk7CisJCWk4MzBfcGlwZXNfcG93ZXJf
d2VsbF9lbmFibGUoaTkxNSwgcG93ZXJfd2VsbCk7CiAJZWxzZQotCQlpODMwX3BpcGVzX3Bvd2Vy
X3dlbGxfZGlzYWJsZShkZXZfcHJpdiwgcG93ZXJfd2VsbCk7CisJCWk4MzBfcGlwZXNfcG93ZXJf
d2VsbF9kaXNhYmxlKGk5MTUsIHBvd2VyX3dlbGwpOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfc2V0
X3Bvd2VyX3dlbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZv
aWQgdmx2X3NldF9wb3dlcl93ZWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
ICAgICAgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwsIGJvb2wgZW5hYmxlKQog
ewogCWludCBwd19pZHggPSBwb3dlcl93ZWxsLT5kZXNjLT52bHYuaWR4OwpAQCAtOTA4LDQzICs5
MDgsNDMgQEAgc3RhdGljIHZvaWQgdmx2X3NldF9wb3dlcl93ZWxsKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAlzdGF0ZSA9IGVuYWJsZSA/IFBVTklUX1BXUkdUX1BXUl9PTihw
d19pZHgpIDoKIAkJCSBQVU5JVF9QV1JHVF9QV1JfR0FURShwd19pZHgpOwogCi0Jdmx2X3B1bml0
X2dldChkZXZfcHJpdik7CisJdmx2X3B1bml0X2dldChpOTE1KTsKIAogI2RlZmluZSBDT05EIFwK
LQkoKHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5JVF9SRUdfUFdSR1RfU1RBVFVTKSAmIG1h
c2spID09IHN0YXRlKQorCSgodmx2X3B1bml0X3JlYWQoaTkxNSwgUFVOSVRfUkVHX1BXUkdUX1NU
QVRVUykgJiBtYXNrKSA9PSBzdGF0ZSkKIAogCWlmIChDT05EKQogCQlnb3RvIG91dDsKIAotCWN0
cmwgPSB2bHZfcHVuaXRfcmVhZChkZXZfcHJpdiwgUFVOSVRfUkVHX1BXUkdUX0NUUkwpOworCWN0
cmwgPSB2bHZfcHVuaXRfcmVhZChpOTE1LCBQVU5JVF9SRUdfUFdSR1RfQ1RSTCk7CiAJY3RybCAm
PSB+bWFzazsKIAljdHJsIHw9IHN0YXRlOwotCXZsdl9wdW5pdF93cml0ZShkZXZfcHJpdiwgUFVO
SVRfUkVHX1BXUkdUX0NUUkwsIGN0cmwpOworCXZsdl9wdW5pdF93cml0ZShpOTE1LCBQVU5JVF9S
RUdfUFdSR1RfQ1RSTCwgY3RybCk7CiAKIAlpZiAod2FpdF9mb3IoQ09ORCwgMTAwKSkKIAkJRFJN
X0VSUk9SKCJ0aW1lb3V0IHNldHRpbmcgcG93ZXIgd2VsbCBzdGF0ZSAlMDh4ICglMDh4KVxuIiwK
IAkJCSAgc3RhdGUsCi0JCQkgIHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5JVF9SRUdfUFdS
R1RfQ1RSTCkpOworCQkJICB2bHZfcHVuaXRfcmVhZChpOTE1LCBQVU5JVF9SRUdfUFdSR1RfQ1RS
TCkpOwogCiAjdW5kZWYgQ09ORAogCiBvdXQ6Ci0Jdmx2X3B1bml0X3B1dChkZXZfcHJpdik7CisJ
dmx2X3B1bml0X3B1dChpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgdmx2X3Bvd2VyX3dlbGxfZW5h
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHZsdl9w
b3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgIHN0
cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwpCiB7Ci0Jdmx2X3NldF9wb3dlcl93ZWxs
KGRldl9wcml2LCBwb3dlcl93ZWxsLCB0cnVlKTsKKwl2bHZfc2V0X3Bvd2VyX3dlbGwoaTkxNSwg
cG93ZXJfd2VsbCwgdHJ1ZSk7CiB9CiAKLXN0YXRpYyB2b2lkIHZsdl9wb3dlcl93ZWxsX2Rpc2Fi
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgdmx2X3Bv
d2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBz
dHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewotCXZsdl9zZXRfcG93ZXJfd2Vs
bChkZXZfcHJpdiwgcG93ZXJfd2VsbCwgZmFsc2UpOworCXZsdl9zZXRfcG93ZXJfd2VsbChpOTE1
LCBwb3dlcl93ZWxsLCBmYWxzZSk7CiB9CiAKLXN0YXRpYyBib29sIHZsdl9wb3dlcl93ZWxsX2Vu
YWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgdmx2
X3Bvd2VyX3dlbGxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewogCWludCBwd19pZHggPSBw
b3dlcl93ZWxsLT5kZXNjLT52bHYuaWR4OwpAQCAtOTU2LDkgKzk1Niw5IEBAIHN0YXRpYyBib29s
IHZsdl9wb3dlcl93ZWxsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCW1hc2sgPSBQVU5JVF9QV1JHVF9NQVNLKHB3X2lkeCk7CiAJY3RybCA9IFBVTklUX1BXUkdU
X1BXUl9PTihwd19pZHgpOwogCi0Jdmx2X3B1bml0X2dldChkZXZfcHJpdik7CisJdmx2X3B1bml0
X2dldChpOTE1KTsKIAotCXN0YXRlID0gdmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBVTklUX1JF
R19QV1JHVF9TVEFUVVMpICYgbWFzazsKKwlzdGF0ZSA9IHZsdl9wdW5pdF9yZWFkKGk5MTUsIFBV
TklUX1JFR19QV1JHVF9TVEFUVVMpICYgbWFzazsKIAkvKgogCSAqIFdlIG9ubHkgZXZlciBzZXQg
dGhlIHBvd2VyLW9uIGFuZCBwb3dlci1nYXRlIHN0YXRlcywgYW55dGhpbmcKIAkgKiBlbHNlIGlz
IHVuZXhwZWN0ZWQuCkBAIC05NzIsMTUgKzk3MiwxNSBAQCBzdGF0aWMgYm9vbCB2bHZfcG93ZXJf
d2VsbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiBBIHRy
YW5zaWVudCBzdGF0ZSBhdCB0aGlzIHBvaW50IHdvdWxkIG1lYW4gc29tZSB1bmV4cGVjdGVkIHBh
cnR5CiAJICogaXMgcG9raW5nIGF0IHRoZSBwb3dlciBjb250cm9scyB0b28uCiAJICovCi0JY3Ry
bCA9IHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5JVF9SRUdfUFdSR1RfQ1RSTCkgJiBtYXNr
OworCWN0cmwgPSB2bHZfcHVuaXRfcmVhZChpOTE1LCBQVU5JVF9SRUdfUFdSR1RfQ1RSTCkgJiBt
YXNrOwogCVdBUk5fT04oY3RybCAhPSBzdGF0ZSk7CiAKLQl2bHZfcHVuaXRfcHV0KGRldl9wcml2
KTsKKwl2bHZfcHVuaXRfcHV0KGk5MTUpOwogCiAJcmV0dXJuIGVuYWJsZWQ7CiB9CiAKLXN0YXRp
YyB2b2lkIHZsdl9pbml0X2Rpc3BsYXlfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHZsdl9pbml0X2Rpc3BsYXlfY2xvY2tfZ2F0aW5n
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiB2YWw7CiAKQEAgLTEwMDEs
MTMgKzEwMDEsMTMgQEAgc3RhdGljIHZvaWQgdmx2X2luaXRfZGlzcGxheV9jbG9ja19nYXRpbmco
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJVEUoTUlfQVJCX1ZM
ViwgTUlfQVJCX0RJU1BMQVlfVFJJQ0tMRV9GRUVEX0RJU0FCTEUpOwogCUk5MTVfV1JJVEUoQ0JS
MV9WTFYsIDApOwogCi0JV0FSTl9PTihkZXZfcHJpdi0+cmF3Y2xrX2ZyZXEgPT0gMCk7CisJV0FS
Tl9PTihpOTE1LT5yYXdjbGtfZnJlcSA9PSAwKTsKIAogCUk5MTVfV1JJVEUoUkFXQ0xLX0ZSRVFf
VkxWLAotCQkgICBESVZfUk9VTkRfQ0xPU0VTVChkZXZfcHJpdi0+cmF3Y2xrX2ZyZXEsIDEwMDAp
KTsKKwkJICAgRElWX1JPVU5EX0NMT1NFU1QoaTkxNS0+cmF3Y2xrX2ZyZXEsIDEwMDApKTsKIH0K
IAotc3RhdGljIHZvaWQgdmx2X2Rpc3BsYXlfcG93ZXJfd2VsbF9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHZsdl9kaXNwbGF5X3Bvd2VyX3dlbGxf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlcjsKIAllbnVtIHBpcGUgcGlwZTsKQEAgLTEwMjAsNyArMTAyMCw3IEBAIHN0
YXRpYyB2b2lkIHZsdl9kaXNwbGF5X3Bvd2VyX3dlbGxfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJICoKIAkgKiBDSFYgRFBMTCBCL0MgaGF2ZSBzb21lIGlzc3VlcyBp
ZiBWR0EgbW9kZSBpcyBlbmFibGVkLgogCSAqLwotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBp
cGUpIHsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJdTMyIHZhbCA9IEk5MTVfUkVB
RChEUExMKHBpcGUpKTsKIAogCQl2YWwgfD0gRFBMTF9SRUZfQ0xLX0VOQUJMRV9WTFYgfCBEUExM
X1ZHQV9NT0RFX0RJUzsKQEAgLTEwMzAsNzEgKzEwMzAsNzEgQEAgc3RhdGljIHZvaWQgdmx2X2Rp
c3BsYXlfcG93ZXJfd2VsbF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJSTkxNV9XUklURShEUExMKHBpcGUpLCB2YWwpOwogCX0KIAotCXZsdl9pbml0X2Rpc3BsYXlf
Y2xvY2tfZ2F0aW5nKGRldl9wcml2KTsKKwl2bHZfaW5pdF9kaXNwbGF5X2Nsb2NrX2dhdGluZyhp
OTE1KTsKIAotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JdmFsbGV5dmll
d19lbmFibGVfZGlzcGxheV9pcnFzKGRldl9wcml2KTsKLQlzcGluX3VubG9ja19pcnEoJmRldl9w
cml2LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCXZhbGxl
eXZpZXdfZW5hYmxlX2Rpc3BsYXlfaXJxcyhpOTE1KTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUt
PmlycV9sb2NrKTsKIAogCS8qCiAJICogRHVyaW5nIGRyaXZlciBpbml0aWFsaXphdGlvbi9yZXN1
bWUgd2UgY2FuIGF2b2lkIHJlc3RvcmluZyB0aGUKIAkgKiBwYXJ0IG9mIHRoZSBIVy9TVyBzdGF0
ZSB0aGF0IHdpbGwgYmUgaW5pdGVkIGFueXdheSBleHBsaWNpdGx5LgogCSAqLwotCWlmIChkZXZf
cHJpdi0+cG93ZXJfZG9tYWlucy5pbml0aWFsaXppbmcpCisJaWYgKGk5MTUtPnBvd2VyX2RvbWFp
bnMuaW5pdGlhbGl6aW5nKQogCQlyZXR1cm47CiAKLQlpbnRlbF9ocGRfaW5pdChkZXZfcHJpdik7
CisJaW50ZWxfaHBkX2luaXQoaTkxNSk7CiAKIAkvKiBSZS1lbmFibGUgdGhlIEFEUEEsIGlmIHdl
IGhhdmUgb25lICovCi0JZm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5j
b2RlcikgeworCWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmk5MTUtPmRybSwgZW5jb2Rlcikgewog
CQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfQU5BTE9HKQogCQkJaW50ZWxfY3J0
X3Jlc2V0KCZlbmNvZGVyLT5iYXNlKTsKIAl9CiAKLQlpOTE1X3JlZGlzYWJsZV92Z2FfcG93ZXJf
b24oZGV2X3ByaXYpOworCWk5MTVfcmVkaXNhYmxlX3ZnYV9wb3dlcl9vbihpOTE1KTsKIAotCWlu
dGVsX3Bwc191bmxvY2tfcmVnc193YShkZXZfcHJpdik7CisJaW50ZWxfcHBzX3VubG9ja19yZWdz
X3dhKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfZGlzcGxheV9wb3dlcl93ZWxsX2RlaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB2bHZfZGlz
cGxheV9wb3dlcl93ZWxsX2RlaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOwotCXZhbGxleXZpZXdfZGlzYWJs
ZV9kaXNwbGF5X2lycXMoZGV2X3ByaXYpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmly
cV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJdmFsbGV5dmlld19k
aXNhYmxlX2Rpc3BsYXlfaXJxcyhpOTE1KTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9s
b2NrKTsKIAogCS8qIG1ha2Ugc3VyZSB3ZSdyZSBkb25lIHByb2Nlc3NpbmcgZGlzcGxheSBpcnFz
ICovCi0Jc3luY2hyb25pemVfaXJxKGRldl9wcml2LT5kcm0uaXJxKTsKKwlzeW5jaHJvbml6ZV9p
cnEoaTkxNS0+ZHJtLmlycSk7CiAKLQlpbnRlbF9wb3dlcl9zZXF1ZW5jZXJfcmVzZXQoZGV2X3By
aXYpOworCWludGVsX3Bvd2VyX3NlcXVlbmNlcl9yZXNldChpOTE1KTsKIAogCS8qIFByZXZlbnQg
dXMgZnJvbSByZS1lbmFibGluZyBwb2xsaW5nIG9uIGFjY2lkZW50IGluIGxhdGUgc3VzcGVuZCAq
LwotCWlmICghZGV2X3ByaXYtPmRybS5kZXYtPnBvd2VyLmlzX3N1c3BlbmRlZCkKLQkJaW50ZWxf
aHBkX3BvbGxfaW5pdChkZXZfcHJpdik7CisJaWYgKCFpOTE1LT5kcm0uZGV2LT5wb3dlci5pc19z
dXNwZW5kZWQpCisJCWludGVsX2hwZF9wb2xsX2luaXQoaTkxNSk7CiB9CiAKLXN0YXRpYyB2b2lk
IHZsdl9kaXNwbGF5X3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHZsdl9kaXNwbGF5X3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwg
KnBvd2VyX3dlbGwpCiB7Ci0Jdmx2X3NldF9wb3dlcl93ZWxsKGRldl9wcml2LCBwb3dlcl93ZWxs
LCB0cnVlKTsKKwl2bHZfc2V0X3Bvd2VyX3dlbGwoaTkxNSwgcG93ZXJfd2VsbCwgdHJ1ZSk7CiAK
LQl2bHZfZGlzcGxheV9wb3dlcl93ZWxsX2luaXQoZGV2X3ByaXYpOworCXZsdl9kaXNwbGF5X3Bv
d2VyX3dlbGxfaW5pdChpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgdmx2X2Rpc3BsYXlfcG93ZXJf
d2VsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2
b2lkIHZsdl9kaXNwbGF5X3Bvd2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkJICAgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsK
LQl2bHZfZGlzcGxheV9wb3dlcl93ZWxsX2RlaW5pdChkZXZfcHJpdik7CisJdmx2X2Rpc3BsYXlf
cG93ZXJfd2VsbF9kZWluaXQoaTkxNSk7CiAKLQl2bHZfc2V0X3Bvd2VyX3dlbGwoZGV2X3ByaXYs
IHBvd2VyX3dlbGwsIGZhbHNlKTsKKwl2bHZfc2V0X3Bvd2VyX3dlbGwoaTkxNSwgcG93ZXJfd2Vs
bCwgZmFsc2UpOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfZHBpb19jbW5fcG93ZXJfd2VsbF9lbmFi
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgdmx2X2Rw
aW9fY21uX3Bvd2VyX3dlbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCQkgICBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpwb3dlcl93ZWxsKQogewogCS8qIHNpbmNl
IHJlZi9jcmkgY2xvY2sgd2FzIGVuYWJsZWQgKi8KIAl1ZGVsYXkoMSk7IC8qID4xMG5zIGZvciBj
bW5yZXNldCwgPjBucyBmb3Igc2lkZXJlc2V0ICovCiAKLQl2bHZfc2V0X3Bvd2VyX3dlbGwoZGV2
X3ByaXYsIHBvd2VyX3dlbGwsIHRydWUpOworCXZsdl9zZXRfcG93ZXJfd2VsbChpOTE1LCBwb3dl
cl93ZWxsLCB0cnVlKTsKIAogCS8qCiAJICogRnJvbSBWTFYyQTBfRFBfZURQX0RQSU9fZHJpdmVy
X3ZiaW9zX25vdGVzXzEwLmRvY3ggLQpAQCAtMTExMCwzMSArMTExMCwzMSBAQCBzdGF0aWMgdm9p
ZCB2bHZfZHBpb19jbW5fcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCUk5MTVfV1JJVEUoRFBJT19DVEwsIEk5MTVfUkVBRChEUElPX0NUTCkgfCBE
UElPX0NNTlJTVCk7CiB9CiAKLXN0YXRpYyB2b2lkIHZsdl9kcGlvX2Ntbl9wb3dlcl93ZWxsX2Rp
c2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgdmx2
X2RwaW9fY21uX3Bvd2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkJICAgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwpCiB7CiAJZW51
bSBwaXBlIHBpcGU7CiAKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBwaXBlKQotCQlhc3NlcnRf
cGxsX2Rpc2FibGVkKGRldl9wcml2LCBwaXBlKTsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUp
CisJCWFzc2VydF9wbGxfZGlzYWJsZWQoaTkxNSwgcGlwZSk7CiAKIAkvKiBBc3NlcnQgY29tbW9u
IHJlc2V0ICovCiAJSTkxNV9XUklURShEUElPX0NUTCwgSTkxNV9SRUFEKERQSU9fQ1RMKSAmIH5E
UElPX0NNTlJTVCk7CiAKLQl2bHZfc2V0X3Bvd2VyX3dlbGwoZGV2X3ByaXYsIHBvd2VyX3dlbGws
IGZhbHNlKTsKKwl2bHZfc2V0X3Bvd2VyX3dlbGwoaTkxNSwgcG93ZXJfd2VsbCwgZmFsc2UpOwog
fQogCiAjZGVmaW5lIFBPV0VSX0RPTUFJTl9NQVNLIChHRU5NQVNLX1VMTChQT1dFUl9ET01BSU5f
TlVNIC0gMSwgMCkpCiAKICNkZWZpbmUgQklUU19TRVQodmFsLCBiaXRzKSAoKCh2YWwpICYgKGJp
dHMpKSA9PSAoYml0cykpCiAKLXN0YXRpYyB2b2lkIGFzc2VydF9jaHZfcGh5X3N0YXR1cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBhc3NlcnRfY2h2X3Bo
eV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGk5MTVf
cG93ZXJfd2VsbCAqY21uX2JjID0KLQkJbG9va3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIFZMVl9E
SVNQX1BXX0RQSU9fQ01OX0JDKTsKKwkJbG9va3VwX3Bvd2VyX3dlbGwoaTkxNSwgVkxWX0RJU1Bf
UFdfRFBJT19DTU5fQkMpOwogCXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKmNtbl9kID0KLQkJbG9v
a3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIENIVl9ESVNQX1BXX0RQSU9fQ01OX0QpOwotCXUzMiBw
aHlfY29udHJvbCA9IGRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2w7CisJCWxvb2t1cF9wb3dlcl93
ZWxsKGk5MTUsIENIVl9ESVNQX1BXX0RQSU9fQ01OX0QpOworCXUzMiBwaHlfY29udHJvbCA9IGk5
MTUtPmNodl9waHlfY29udHJvbDsKIAl1MzIgcGh5X3N0YXR1cyA9IDA7CiAJdTMyIHBoeV9zdGF0
dXNfbWFzayA9IDB4ZmZmZmZmZmY7CiAKQEAgLTExNDUsNyArMTE0NSw3IEBAIHN0YXRpYyB2b2lk
IGFzc2VydF9jaHZfcGh5X3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJICogcmVzZXQgKGllLiB0aGUgcG93ZXIgd2VsbCBoYXMgYmVlbiBkaXNhYmxlZCBhdAogCSAq
IGxlYXN0IG9uY2UpLgogCSAqLwotCWlmICghZGV2X3ByaXYtPmNodl9waHlfYXNzZXJ0W0RQSU9f
UEhZMF0pCisJaWYgKCFpOTE1LT5jaHZfcGh5X2Fzc2VydFtEUElPX1BIWTBdKQogCQlwaHlfc3Rh
dHVzX21hc2sgJj0gfihQSFlfU1RBVFVTX0NNTl9MRE8oRFBJT19QSFkwLCBEUElPX0NIMCkgfAog
CQkJCSAgICAgUEhZX1NUQVRVU19TUExJTkVfTERPKERQSU9fUEhZMCwgRFBJT19DSDAsIDApIHwK
IAkJCQkgICAgIFBIWV9TVEFUVVNfU1BMSU5FX0xETyhEUElPX1BIWTAsIERQSU9fQ0gwLCAxKSB8
CkBAIC0xMTUzLDEyICsxMTUzLDEyIEBAIHN0YXRpYyB2b2lkIGFzc2VydF9jaHZfcGh5X3N0YXR1
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCQkJICAgICBQSFlfU1RBVFVT
X1NQTElORV9MRE8oRFBJT19QSFkwLCBEUElPX0NIMSwgMCkgfAogCQkJCSAgICAgUEhZX1NUQVRV
U19TUExJTkVfTERPKERQSU9fUEhZMCwgRFBJT19DSDEsIDEpKTsKIAotCWlmICghZGV2X3ByaXYt
PmNodl9waHlfYXNzZXJ0W0RQSU9fUEhZMV0pCisJaWYgKCFpOTE1LT5jaHZfcGh5X2Fzc2VydFtE
UElPX1BIWTFdKQogCQlwaHlfc3RhdHVzX21hc2sgJj0gfihQSFlfU1RBVFVTX0NNTl9MRE8oRFBJ
T19QSFkxLCBEUElPX0NIMCkgfAogCQkJCSAgICAgUEhZX1NUQVRVU19TUExJTkVfTERPKERQSU9f
UEhZMSwgRFBJT19DSDAsIDApIHwKIAkJCQkgICAgIFBIWV9TVEFUVVNfU1BMSU5FX0xETyhEUElP
X1BIWTEsIERQSU9fQ0gwLCAxKSk7CiAKLQlpZiAoY21uX2JjLT5kZXNjLT5vcHMtPmlzX2VuYWJs
ZWQoZGV2X3ByaXYsIGNtbl9iYykpIHsKKwlpZiAoY21uX2JjLT5kZXNjLT5vcHMtPmlzX2VuYWJs
ZWQoaTkxNSwgY21uX2JjKSkgewogCQlwaHlfc3RhdHVzIHw9IFBIWV9QT1dFUkdPT0QoRFBJT19Q
SFkwKTsKIAogCQkvKiB0aGlzIGFzc3VtZXMgb3ZlcnJpZGUgaXMgb25seSB1c2VkIHRvIGVuYWJs
ZSBsYW5lcyAqLwpAQCAtMTE5OSw3ICsxMTk5LDcgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2Nodl9w
aHlfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJCXBoeV9zdGF0
dXMgfD0gUEhZX1NUQVRVU19TUExJTkVfTERPKERQSU9fUEhZMCwgRFBJT19DSDEsIDEpOwogCX0K
IAotCWlmIChjbW5fZC0+ZGVzYy0+b3BzLT5pc19lbmFibGVkKGRldl9wcml2LCBjbW5fZCkpIHsK
KwlpZiAoY21uX2QtPmRlc2MtPm9wcy0+aXNfZW5hYmxlZChpOTE1LCBjbW5fZCkpIHsKIAkJcGh5
X3N0YXR1cyB8PSBQSFlfUE9XRVJHT09EKERQSU9fUEhZMSk7CiAKIAkJLyogdGhpcyBhc3N1bWVz
IG92ZXJyaWRlIGlzIG9ubHkgdXNlZCB0byBlbmFibGUgbGFuZXMgKi8KQEAgLTEyMjQsMTkgKzEy
MjQsMTkgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2Nodl9waHlfc3RhdHVzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBUaGUgUEhZIG1heSBiZSBidXN5IHdpdGggc29tZSBp
bml0aWFsIGNhbGlicmF0aW9uIGFuZCB3aGF0bm90LAogCSAqIHNvIHRoZSBwb3dlciBzdGF0ZSBj
YW4gdGFrZSBhIHdoaWxlIHRvIGFjdHVhbGx5IGNoYW5nZS4KIAkgKi8KLQlpZiAoaW50ZWxfd2Fp
dF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYgKGludGVsX3dhaXRfZm9yX3Jl
Z2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIERJU1BMQVlfUEhZX1NUQVRVUywKIAkJCQkg
ICAgcGh5X3N0YXR1c19tYXNrLAogCQkJCSAgICBwaHlfc3RhdHVzLAogCQkJCSAgICAxMCkpCiAJ
CURSTV9FUlJPUigiVW5leHBlY3RlZCBQSFlfU1RBVFVTIDB4JTA4eCwgZXhwZWN0ZWQgMHglMDh4
IChQSFlfQ09OVFJPTD0weCUwOHgpXG4iLAogCQkJICBJOTE1X1JFQUQoRElTUExBWV9QSFlfU1RB
VFVTKSAmIHBoeV9zdGF0dXNfbWFzaywKLQkJCSAgIHBoeV9zdGF0dXMsIGRldl9wcml2LT5jaHZf
cGh5X2NvbnRyb2wpOworCQkJICAgcGh5X3N0YXR1cywgaTkxNS0+Y2h2X3BoeV9jb250cm9sKTsK
IH0KIAogI3VuZGVmIEJJVFNfU0VUCiAKLXN0YXRpYyB2b2lkIGNodl9kcGlvX2Ntbl9wb3dlcl93
ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9p
ZCBjaHZfZHBpb19jbW5fcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkJCSAgIHN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwpCiB7CiAJ
ZW51bSBkcGlvX3BoeSBwaHk7CkBAIC0xMjU2LDUxICsxMjU2LDUxIEBAIHN0YXRpYyB2b2lkIGNo
dl9kcGlvX2Ntbl9wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAKIAkvKiBzaW5jZSByZWYvY3JpIGNsb2NrIHdhcyBlbmFibGVkICovCiAJdWRlbGF5
KDEpOyAvKiA+MTBucyBmb3IgY21ucmVzZXQsID4wbnMgZm9yIHNpZGVyZXNldCAqLwotCXZsdl9z
ZXRfcG93ZXJfd2VsbChkZXZfcHJpdiwgcG93ZXJfd2VsbCwgdHJ1ZSk7CisJdmx2X3NldF9wb3dl
cl93ZWxsKGk5MTUsIHBvd2VyX3dlbGwsIHRydWUpOwogCiAJLyogUG9sbCBmb3IgcGh5cHdyZ29v
ZCBzaWduYWwgKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNv
cmUsCisJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAg
IERJU1BMQVlfUEhZX1NUQVRVUywKIAkJCQkgICAgUEhZX1BPV0VSR09PRChwaHkpLAogCQkJCSAg
ICBQSFlfUE9XRVJHT09EKHBoeSksCiAJCQkJICAgIDEpKQogCQlEUk1fRVJST1IoIkRpc3BsYXkg
UEhZICVkIGlzIG5vdCBwb3dlciB1cFxuIiwgcGh5KTsKIAotCXZsdl9kcGlvX2dldChkZXZfcHJp
dik7CisJdmx2X2RwaW9fZ2V0KGk5MTUpOwogCiAJLyogRW5hYmxlIGR5bmFtaWMgcG93ZXIgZG93
biAqLwotCXRtcCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIENIVl9DTU5fRFcyOCk7
CisJdG1wID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBDSFZfQ01OX0RXMjgpOwogCXRtcCB8
PSBEUElPX0RZTlBXUkRPV05FTl9DSDAgfCBEUElPX0NMMVBPV0VSRE9XTkVOIHwKIAkJRFBJT19T
VVNfQ0xLX0NPTkZJR19HQVRFX0NMS1JFUTsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlw
ZSwgQ0hWX0NNTl9EVzI4LCB0bXApOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIENIVl9D
TU5fRFcyOCwgdG1wKTsKIAogCWlmIChwb3dlcl93ZWxsLT5kZXNjLT5pZCA9PSBWTFZfRElTUF9Q
V19EUElPX0NNTl9CQykgewotCQl0bXAgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBf
Q0hWX0NNTl9EVzZfQ0gxKTsKKwkJdG1wID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBfQ0hW
X0NNTl9EVzZfQ0gxKTsKIAkJdG1wIHw9IERQSU9fRFlOUFdSRE9XTkVOX0NIMTsKLQkJdmx2X2Rw
aW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIF9DSFZfQ01OX0RXNl9DSDEsIHRtcCk7CisJCXZsdl9k
cGlvX3dyaXRlKGk5MTUsIHBpcGUsIF9DSFZfQ01OX0RXNl9DSDEsIHRtcCk7CiAJfSBlbHNlIHsK
IAkJLyoKIAkJICogRm9yY2UgdGhlIG5vbi1leGlzdGluZyBDTDIgb2ZmLiBCWFQgZG9lcyB0aGlz
CiAJCSAqIHRvbywgc28gbWF5YmUgaXQgc2F2ZXMgc29tZSBwb3dlciBldmVuIHRob3VnaAogCQkg
KiBDTDIgZG9lc24ndCBleGlzdD8KIAkJICovCi0JCXRtcCA9IHZsdl9kcGlvX3JlYWQoZGV2X3By
aXYsIHBpcGUsIENIVl9DTU5fRFczMCk7CisJCXRtcCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlw
ZSwgQ0hWX0NNTl9EVzMwKTsKIAkJdG1wIHw9IERQSU9fQ0wyX0xET0ZVU0VfUFdSRU5COwotCQl2
bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgQ0hWX0NNTl9EVzMwLCB0bXApOworCQl2bHZf
ZHBpb193cml0ZShpOTE1LCBwaXBlLCBDSFZfQ01OX0RXMzAsIHRtcCk7CiAJfQogCi0Jdmx2X2Rw
aW9fcHV0KGRldl9wcml2KTsKKwl2bHZfZHBpb19wdXQoaTkxNSk7CiAKLQlkZXZfcHJpdi0+Y2h2
X3BoeV9jb250cm9sIHw9IFBIWV9DT01fTEFORV9SRVNFVF9ERUFTU0VSVChwaHkpOwotCUk5MTVf
V1JJVEUoRElTUExBWV9QSFlfQ09OVFJPTCwgZGV2X3ByaXYtPmNodl9waHlfY29udHJvbCk7CisJ
aTkxNS0+Y2h2X3BoeV9jb250cm9sIHw9IFBIWV9DT01fTEFORV9SRVNFVF9ERUFTU0VSVChwaHkp
OworCUk5MTVfV1JJVEUoRElTUExBWV9QSFlfQ09OVFJPTCwgaTkxNS0+Y2h2X3BoeV9jb250cm9s
KTsKIAogCURSTV9ERUJVR19LTVMoIkVuYWJsZWQgRFBJTyBQSFklZCAoUEhZX0NPTlRST0w9MHgl
MDh4KVxuIiwKLQkJICAgICAgcGh5LCBkZXZfcHJpdi0+Y2h2X3BoeV9jb250cm9sKTsKKwkJICAg
ICAgcGh5LCBpOTE1LT5jaHZfcGh5X2NvbnRyb2wpOwogCi0JYXNzZXJ0X2Nodl9waHlfc3RhdHVz
KGRldl9wcml2KTsKKwlhc3NlcnRfY2h2X3BoeV9zdGF0dXMoaTkxNSk7CiB9CiAKLXN0YXRpYyB2
b2lkIGNodl9kcGlvX2Ntbl9wb3dlcl93ZWxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgY2h2X2RwaW9fY21uX3Bvd2VyX3dlbGxfZGlzYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgIHN0cnVjdCBpOTE1X3Bv
d2VyX3dlbGwgKnBvd2VyX3dlbGwpCiB7CiAJZW51bSBkcGlvX3BoeSBwaHk7CkBAIC0xMzEwLDI4
ICsxMzEwLDI4IEBAIHN0YXRpYyB2b2lkIGNodl9kcGlvX2Ntbl9wb3dlcl93ZWxsX2Rpc2FibGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJaWYgKHBvd2VyX3dlbGwtPmRl
c2MtPmlkID09IFZMVl9ESVNQX1BXX0RQSU9fQ01OX0JDKSB7CiAJCXBoeSA9IERQSU9fUEhZMDsK
LQkJYXNzZXJ0X3BsbF9kaXNhYmxlZChkZXZfcHJpdiwgUElQRV9BKTsKLQkJYXNzZXJ0X3BsbF9k
aXNhYmxlZChkZXZfcHJpdiwgUElQRV9CKTsKKwkJYXNzZXJ0X3BsbF9kaXNhYmxlZChpOTE1LCBQ
SVBFX0EpOworCQlhc3NlcnRfcGxsX2Rpc2FibGVkKGk5MTUsIFBJUEVfQik7CiAJfSBlbHNlIHsK
IAkJcGh5ID0gRFBJT19QSFkxOwotCQlhc3NlcnRfcGxsX2Rpc2FibGVkKGRldl9wcml2LCBQSVBF
X0MpOworCQlhc3NlcnRfcGxsX2Rpc2FibGVkKGk5MTUsIFBJUEVfQyk7CiAJfQogCi0JZGV2X3By
aXYtPmNodl9waHlfY29udHJvbCAmPSB+UEhZX0NPTV9MQU5FX1JFU0VUX0RFQVNTRVJUKHBoeSk7
Ci0JSTkxNV9XUklURShESVNQTEFZX1BIWV9DT05UUk9MLCBkZXZfcHJpdi0+Y2h2X3BoeV9jb250
cm9sKTsKKwlpOTE1LT5jaHZfcGh5X2NvbnRyb2wgJj0gflBIWV9DT01fTEFORV9SRVNFVF9ERUFT
U0VSVChwaHkpOworCUk5MTVfV1JJVEUoRElTUExBWV9QSFlfQ09OVFJPTCwgaTkxNS0+Y2h2X3Bo
eV9jb250cm9sKTsKIAotCXZsdl9zZXRfcG93ZXJfd2VsbChkZXZfcHJpdiwgcG93ZXJfd2VsbCwg
ZmFsc2UpOworCXZsdl9zZXRfcG93ZXJfd2VsbChpOTE1LCBwb3dlcl93ZWxsLCBmYWxzZSk7CiAK
IAlEUk1fREVCVUdfS01TKCJEaXNhYmxlZCBEUElPIFBIWSVkIChQSFlfQ09OVFJPTD0weCUwOHgp
XG4iLAotCQkgICAgICBwaHksIGRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2wpOworCQkgICAgICBw
aHksIGk5MTUtPmNodl9waHlfY29udHJvbCk7CiAKIAkvKiBQSFkgaXMgZnVsbHkgcmVzZXQgbm93
LCBzbyB3ZSBjYW4gZW5hYmxlIHRoZSBQSFkgc3RhdGUgYXNzZXJ0cyAqLwotCWRldl9wcml2LT5j
aHZfcGh5X2Fzc2VydFtwaHldID0gdHJ1ZTsKKwlpOTE1LT5jaHZfcGh5X2Fzc2VydFtwaHldID0g
dHJ1ZTsKIAotCWFzc2VydF9jaHZfcGh5X3N0YXR1cyhkZXZfcHJpdik7CisJYXNzZXJ0X2Nodl9w
aHlfc3RhdHVzKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBhc3NlcnRfY2h2X3BoeV9wb3dlcmdh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIGRwaW9fcGh5IHBoeSwK
K3N0YXRpYyB2b2lkIGFzc2VydF9jaHZfcGh5X3Bvd2VyZ2F0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgZW51bSBkcGlvX3BoeSBwaHksCiAJCQkJICAgICBlbnVtIGRwaW9fY2hhbm5l
bCBjaCwgYm9vbCBvdmVycmlkZSwgdW5zaWduZWQgaW50IG1hc2spCiB7CiAJZW51bSBwaXBlIHBp
cGUgPSBwaHkgPT0gRFBJT19QSFkwID8gUElQRV9BIDogUElQRV9DOwpAQCAtMTM0NCw3ICsxMzQ0
LDcgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2Nodl9waHlfcG93ZXJnYXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBkcGkKIAkgKiByZXNldCAoaWUuIHRoZSBwb3dlciB3
ZWxsIGhhcyBiZWVuIGRpc2FibGVkIGF0CiAJICogbGVhc3Qgb25jZSkuCiAJICovCi0JaWYgKCFk
ZXZfcHJpdi0+Y2h2X3BoeV9hc3NlcnRbcGh5XSkKKwlpZiAoIWk5MTUtPmNodl9waHlfYXNzZXJ0
W3BoeV0pCiAJCXJldHVybjsKIAogCWlmIChjaCA9PSBEUElPX0NIMCkKQEAgLTEzNTIsOSArMTM1
Miw5IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9jaHZfcGh5X3Bvd2VyZ2F0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gZHBpCiAJZWxzZQogCQlyZWcgPSBfQ0hWX0NNTl9E
VzZfQ0gxOwogCi0Jdmx2X2RwaW9fZ2V0KGRldl9wcml2KTsKLQl2YWwgPSB2bHZfZHBpb19yZWFk
KGRldl9wcml2LCBwaXBlLCByZWcpOwotCXZsdl9kcGlvX3B1dChkZXZfcHJpdik7CisJdmx2X2Rw
aW9fZ2V0KGk5MTUpOworCXZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgcmVnKTsKKwl2
bHZfZHBpb19wdXQoaTkxNSk7CiAKIAkvKgogCSAqIFRoaXMgYXNzdW1lcyAhb3ZlcnJpZGUgaXMg
b25seSB1c2VkIHdoZW4gdGhlIHBvcnQgaXMgZGlzYWJsZWQuCkBAIC0xMzkzLDMwICsxMzkzLDMw
IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9jaHZfcGh5X3Bvd2VyZ2F0ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gZHBpCiAJICAgICByZWcsIHZhbCk7CiB9CiAKLWJvb2wg
Y2h2X3BoeV9wb3dlcmdhdGVfY2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIGRwaW9fcGh5IHBoeSwKK2Jvb2wgY2h2X3BoeV9wb3dlcmdhdGVfY2goc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gZHBpb19waHkgcGh5LAogCQkJICBlbnVtIGRwaW9fY2hh
bm5lbCBjaCwgYm9vbCBvdmVycmlkZSkKIHsKLQlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpw
b3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dlcl9kb21haW5zOworCXN0cnVjdCBpOTE1X3Bv
d2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMgPSAmaTkxNS0+cG93ZXJfZG9tYWluczsKIAlib29s
IHdhc19vdmVycmlkZTsKIAogCW11dGV4X2xvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwogCi0J
d2FzX292ZXJyaWRlID0gZGV2X3ByaXYtPmNodl9waHlfY29udHJvbCAmIFBIWV9DSF9QT1dFUl9E
T1dOX09WUkRfRU4ocGh5LCBjaCk7CisJd2FzX292ZXJyaWRlID0gaTkxNS0+Y2h2X3BoeV9jb250
cm9sICYgUEhZX0NIX1BPV0VSX0RPV05fT1ZSRF9FTihwaHksIGNoKTsKIAogCWlmIChvdmVycmlk
ZSA9PSB3YXNfb3ZlcnJpZGUpCiAJCWdvdG8gb3V0OwogCiAJaWYgKG92ZXJyaWRlKQotCQlkZXZf
cHJpdi0+Y2h2X3BoeV9jb250cm9sIHw9IFBIWV9DSF9QT1dFUl9ET1dOX09WUkRfRU4ocGh5LCBj
aCk7CisJCWk5MTUtPmNodl9waHlfY29udHJvbCB8PSBQSFlfQ0hfUE9XRVJfRE9XTl9PVlJEX0VO
KHBoeSwgY2gpOwogCWVsc2UKLQkJZGV2X3ByaXYtPmNodl9waHlfY29udHJvbCAmPSB+UEhZX0NI
X1BPV0VSX0RPV05fT1ZSRF9FTihwaHksIGNoKTsKKwkJaTkxNS0+Y2h2X3BoeV9jb250cm9sICY9
IH5QSFlfQ0hfUE9XRVJfRE9XTl9PVlJEX0VOKHBoeSwgY2gpOwogCi0JSTkxNV9XUklURShESVNQ
TEFZX1BIWV9DT05UUk9MLCBkZXZfcHJpdi0+Y2h2X3BoeV9jb250cm9sKTsKKwlJOTE1X1dSSVRF
KERJU1BMQVlfUEhZX0NPTlRST0wsIGk5MTUtPmNodl9waHlfY29udHJvbCk7CiAKIAlEUk1fREVC
VUdfS01TKCJQb3dlciBnYXRpbmcgRFBJTyBQSFklZCBDSCVkIChEUElPX1BIWV9DT05UUk9MPTB4
JTA4eClcbiIsCi0JCSAgICAgIHBoeSwgY2gsIGRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2wpOwor
CQkgICAgICBwaHksIGNoLCBpOTE1LT5jaHZfcGh5X2NvbnRyb2wpOwogCi0JYXNzZXJ0X2Nodl9w
aHlfc3RhdHVzKGRldl9wcml2KTsKKwlhc3NlcnRfY2h2X3BoeV9zdGF0dXMoaTkxNSk7CiAKIG91
dDoKIAltdXRleF91bmxvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwpAQCAtMTQyNyw0MyArMTQy
Nyw0MyBAQCBib29sIGNodl9waHlfcG93ZXJnYXRlX2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgZW51bSBkcGlvX3BoeSBwaHksCiB2b2lkIGNodl9waHlfcG93ZXJnYXRlX2xh
bmVzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICBib29sIG92ZXJyaWRl
LCB1bnNpZ25lZCBpbnQgbWFzaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21h
aW5zICpwb3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dlcl9kb21haW5zOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3Ry
dWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlucyA9ICZpOTE1LT5wb3dlcl9kb21h
aW5zOwogCWVudW0gZHBpb19waHkgcGh5ID0gdmx2X2Rwb3J0X3RvX3BoeShlbmNfdG9fZGlnX3Bv
cnQoJmVuY29kZXItPmJhc2UpKTsKIAllbnVtIGRwaW9fY2hhbm5lbCBjaCA9IHZsdl9kcG9ydF90
b19jaGFubmVsKGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSkpOwogCiAJbXV0ZXhfbG9j
aygmcG93ZXJfZG9tYWlucy0+bG9jayk7CiAKLQlkZXZfcHJpdi0+Y2h2X3BoeV9jb250cm9sICY9
IH5QSFlfQ0hfUE9XRVJfRE9XTl9PVlJEKDB4ZiwgcGh5LCBjaCk7Ci0JZGV2X3ByaXYtPmNodl9w
aHlfY29udHJvbCB8PSBQSFlfQ0hfUE9XRVJfRE9XTl9PVlJEKG1hc2ssIHBoeSwgY2gpOworCWk5
MTUtPmNodl9waHlfY29udHJvbCAmPSB+UEhZX0NIX1BPV0VSX0RPV05fT1ZSRCgweGYsIHBoeSwg
Y2gpOworCWk5MTUtPmNodl9waHlfY29udHJvbCB8PSBQSFlfQ0hfUE9XRVJfRE9XTl9PVlJEKG1h
c2ssIHBoeSwgY2gpOwogCiAJaWYgKG92ZXJyaWRlKQotCQlkZXZfcHJpdi0+Y2h2X3BoeV9jb250
cm9sIHw9IFBIWV9DSF9QT1dFUl9ET1dOX09WUkRfRU4ocGh5LCBjaCk7CisJCWk5MTUtPmNodl9w
aHlfY29udHJvbCB8PSBQSFlfQ0hfUE9XRVJfRE9XTl9PVlJEX0VOKHBoeSwgY2gpOwogCWVsc2UK
LQkJZGV2X3ByaXYtPmNodl9waHlfY29udHJvbCAmPSB+UEhZX0NIX1BPV0VSX0RPV05fT1ZSRF9F
TihwaHksIGNoKTsKKwkJaTkxNS0+Y2h2X3BoeV9jb250cm9sICY9IH5QSFlfQ0hfUE9XRVJfRE9X
Tl9PVlJEX0VOKHBoeSwgY2gpOwogCi0JSTkxNV9XUklURShESVNQTEFZX1BIWV9DT05UUk9MLCBk
ZXZfcHJpdi0+Y2h2X3BoeV9jb250cm9sKTsKKwlJOTE1X1dSSVRFKERJU1BMQVlfUEhZX0NPTlRS
T0wsIGk5MTUtPmNodl9waHlfY29udHJvbCk7CiAKIAlEUk1fREVCVUdfS01TKCJQb3dlciBnYXRp
bmcgRFBJTyBQSFklZCBDSCVkIGxhbmVzIDB4JXggKFBIWV9DT05UUk9MPTB4JTA4eClcbiIsCi0J
CSAgICAgIHBoeSwgY2gsIG1hc2ssIGRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2wpOworCQkgICAg
ICBwaHksIGNoLCBtYXNrLCBpOTE1LT5jaHZfcGh5X2NvbnRyb2wpOwogCi0JYXNzZXJ0X2Nodl9w
aHlfc3RhdHVzKGRldl9wcml2KTsKKwlhc3NlcnRfY2h2X3BoeV9zdGF0dXMoaTkxNSk7CiAKLQlh
c3NlcnRfY2h2X3BoeV9wb3dlcmdhdGUoZGV2X3ByaXYsIHBoeSwgY2gsIG92ZXJyaWRlLCBtYXNr
KTsKKwlhc3NlcnRfY2h2X3BoeV9wb3dlcmdhdGUoaTkxNSwgcGh5LCBjaCwgb3ZlcnJpZGUsIG1h
c2spOwogCiAJbXV0ZXhfdW5sb2NrKCZwb3dlcl9kb21haW5zLT5sb2NrKTsKIH0KIAotc3RhdGlj
IGJvb2wgY2h2X3BpcGVfcG93ZXJfd2VsbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyBib29sIGNodl9waXBlX3Bvd2VyX3dlbGxfZW5hYmxlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAq
cG93ZXJfd2VsbCkKIHsKIAllbnVtIHBpcGUgcGlwZSA9IFBJUEVfQTsKIAlib29sIGVuYWJsZWQ7
CiAJdTMyIHN0YXRlLCBjdHJsOwogCi0Jdmx2X3B1bml0X2dldChkZXZfcHJpdik7CisJdmx2X3B1
bml0X2dldChpOTE1KTsKIAotCXN0YXRlID0gdmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBVTklU
X1JFR19EU1BTU1BNKSAmIERQX1NTU19NQVNLKHBpcGUpOworCXN0YXRlID0gdmx2X3B1bml0X3Jl
YWQoaTkxNSwgUFVOSVRfUkVHX0RTUFNTUE0pICYgRFBfU1NTX01BU0socGlwZSk7CiAJLyoKIAkg
KiBXZSBvbmx5IGV2ZXIgc2V0IHRoZSBwb3dlci1vbiBhbmQgcG93ZXItZ2F0ZSBzdGF0ZXMsIGFu
eXRoaW5nCiAJICogZWxzZSBpcyB1bmV4cGVjdGVkLgpAQCAtMTQ3NSwxNSArMTQ3NSwxNSBAQCBz
dGF0aWMgYm9vbCBjaHZfcGlwZV9wb3dlcl93ZWxsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCSAqIEEgdHJhbnNpZW50IHN0YXRlIGF0IHRoaXMgcG9pbnQgd291
bGQgbWVhbiBzb21lIHVuZXhwZWN0ZWQgcGFydHkKIAkgKiBpcyBwb2tpbmcgYXQgdGhlIHBvd2Vy
IGNvbnRyb2xzIHRvby4KIAkgKi8KLQljdHJsID0gdmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBV
TklUX1JFR19EU1BTU1BNKSAmIERQX1NTQ19NQVNLKHBpcGUpOworCWN0cmwgPSB2bHZfcHVuaXRf
cmVhZChpOTE1LCBQVU5JVF9SRUdfRFNQU1NQTSkgJiBEUF9TU0NfTUFTSyhwaXBlKTsKIAlXQVJO
X09OKGN0cmwgPDwgMTYgIT0gc3RhdGUpOwogCi0Jdmx2X3B1bml0X3B1dChkZXZfcHJpdik7CisJ
dmx2X3B1bml0X3B1dChpOTE1KTsKIAogCXJldHVybiBlbmFibGVkOwogfQogCi1zdGF0aWMgdm9p
ZCBjaHZfc2V0X3BpcGVfcG93ZXJfd2VsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitzdGF0aWMgdm9pZCBjaHZfc2V0X3BpcGVfcG93ZXJfd2VsbChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93ZXJfd2Vs
bCwKIAkJCQkgICAgYm9vbCBlbmFibGUpCiB7CkBAIC0xNDkzLDQ0ICsxNDkzLDQ0IEBAIHN0YXRp
YyB2b2lkIGNodl9zZXRfcGlwZV9wb3dlcl93ZWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAogCXN0YXRlID0gZW5hYmxlID8gRFBfU1NTX1BXUl9PTihwaXBlKSA6IERQX1NT
U19QV1JfR0FURShwaXBlKTsKIAotCXZsdl9wdW5pdF9nZXQoZGV2X3ByaXYpOworCXZsdl9wdW5p
dF9nZXQoaTkxNSk7CiAKICNkZWZpbmUgQ09ORCBcCi0JKCh2bHZfcHVuaXRfcmVhZChkZXZfcHJp
diwgUFVOSVRfUkVHX0RTUFNTUE0pICYgRFBfU1NTX01BU0socGlwZSkpID09IHN0YXRlKQorCSgo
dmx2X3B1bml0X3JlYWQoaTkxNSwgUFVOSVRfUkVHX0RTUFNTUE0pICYgRFBfU1NTX01BU0socGlw
ZSkpID09IHN0YXRlKQogCiAJaWYgKENPTkQpCiAJCWdvdG8gb3V0OwogCi0JY3RybCA9IHZsdl9w
dW5pdF9yZWFkKGRldl9wcml2LCBQVU5JVF9SRUdfRFNQU1NQTSk7CisJY3RybCA9IHZsdl9wdW5p
dF9yZWFkKGk5MTUsIFBVTklUX1JFR19EU1BTU1BNKTsKIAljdHJsICY9IH5EUF9TU0NfTUFTSyhw
aXBlKTsKIAljdHJsIHw9IGVuYWJsZSA/IERQX1NTQ19QV1JfT04ocGlwZSkgOiBEUF9TU0NfUFdS
X0dBVEUocGlwZSk7Ci0Jdmx2X3B1bml0X3dyaXRlKGRldl9wcml2LCBQVU5JVF9SRUdfRFNQU1NQ
TSwgY3RybCk7CisJdmx2X3B1bml0X3dyaXRlKGk5MTUsIFBVTklUX1JFR19EU1BTU1BNLCBjdHJs
KTsKIAogCWlmICh3YWl0X2ZvcihDT05ELCAxMDApKQogCQlEUk1fRVJST1IoInRpbWVvdXQgc2V0
dGluZyBwb3dlciB3ZWxsIHN0YXRlICUwOHggKCUwOHgpXG4iLAogCQkJICBzdGF0ZSwKLQkJCSAg
dmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBVTklUX1JFR19EU1BTU1BNKSk7CisJCQkgIHZsdl9w
dW5pdF9yZWFkKGk5MTUsIFBVTklUX1JFR19EU1BTU1BNKSk7CiAKICN1bmRlZiBDT05ECiAKIG91
dDoKLQl2bHZfcHVuaXRfcHV0KGRldl9wcml2KTsKKwl2bHZfcHVuaXRfcHV0KGk5MTUpOwogfQog
Ci1zdGF0aWMgdm9pZCBjaHZfcGlwZV9wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBjaHZfcGlwZV9wb3dlcl93ZWxsX2VuYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICAgc3RydWN0IGk5MTVf
cG93ZXJfd2VsbCAqcG93ZXJfd2VsbCkKIHsKLQljaHZfc2V0X3BpcGVfcG93ZXJfd2VsbChkZXZf
cHJpdiwgcG93ZXJfd2VsbCwgdHJ1ZSk7CisJY2h2X3NldF9waXBlX3Bvd2VyX3dlbGwoaTkxNSwg
cG93ZXJfd2VsbCwgdHJ1ZSk7CiAKLQl2bHZfZGlzcGxheV9wb3dlcl93ZWxsX2luaXQoZGV2X3By
aXYpOworCXZsdl9kaXNwbGF5X3Bvd2VyX3dlbGxfaW5pdChpOTE1KTsKIH0KIAotc3RhdGljIHZv
aWQgY2h2X3BpcGVfcG93ZXJfd2VsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGNodl9waXBlX3Bvd2VyX3dlbGxfZGlzYWJsZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqcG93
ZXJfd2VsbCkKIHsKLQl2bHZfZGlzcGxheV9wb3dlcl93ZWxsX2RlaW5pdChkZXZfcHJpdik7CisJ
dmx2X2Rpc3BsYXlfcG93ZXJfd2VsbF9kZWluaXQoaTkxNSk7CiAKLQljaHZfc2V0X3BpcGVfcG93
ZXJfd2VsbChkZXZfcHJpdiwgcG93ZXJfd2VsbCwgZmFsc2UpOworCWNodl9zZXRfcGlwZV9wb3dl
cl93ZWxsKGk5MTUsIHBvd2VyX3dlbGwsIGZhbHNlKTsKIH0KIAogc3RhdGljIHU2NCBfX2FzeW5j
X3B1dF9kb21haW5zX21hc2soc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlu
cykKQEAgLTE2MjcsMTAgKzE2MjcsMTAgQEAgYXN5bmNfcHV0X2RvbWFpbnNfY2xlYXJfZG9tYWlu
KHN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMsCiB9CiAKIHN0YXRpYyBi
b29sCi1pbnRlbF9kaXNwbGF5X3Bvd2VyX2dyYWJfYXN5bmNfcHV0X3JlZihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9kaXNwbGF5X3Bvd2VyX2dyYWJfYXN5bmNfcHV0
X3JlZihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICAgZW51bSBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBkb21haW4pCiB7Ci0Jc3RydWN0IGk5MTVfcG93ZXJfZG9t
YWlucyAqcG93ZXJfZG9tYWlucyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlzdHJ1Y3Qg
aTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7
CiAJYm9vbCByZXQgPSBmYWxzZTsKIAogCWlmICghKGFzeW5jX3B1dF9kb21haW5zX21hc2socG93
ZXJfZG9tYWlucykgJiBCSVRfVUxMKGRvbWFpbikpKQpAQCAtMTY0NCw3ICsxNjQ0LDcgQEAgaW50
ZWxfZGlzcGxheV9wb3dlcl9ncmFiX2FzeW5jX3B1dF9yZWYoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQlnb3RvIG91dF92ZXJpZnk7CiAKIAljYW5jZWxfZGVsYXllZF93b3Jr
KCZwb3dlcl9kb21haW5zLT5hc3luY19wdXRfd29yayk7Ci0JaW50ZWxfcnVudGltZV9wbV9wdXRf
cmF3KGRldl9wcml2LAorCWludGVsX3J1bnRpbWVfcG1fcHV0X3JhdyhpOTE1LAogCQkJCSBmZXRj
aF9hbmRfemVybygmcG93ZXJfZG9tYWlucy0+YXN5bmNfcHV0X3dha2VyZWYpKTsKIG91dF92ZXJp
Znk6CiAJdmVyaWZ5X2FzeW5jX3B1dF9kb21haW5zX3N0YXRlKHBvd2VyX2RvbWFpbnMpOwpAQCAt
MTY1MywyNCArMTY1MywyNCBAQCBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dyYWJfYXN5bmNfcHV0X3Jl
ZihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAKIHN0YXRpYyB2b2lkCi1f
X2ludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCitfX2ludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2RvbWFpbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBk
b21haW4pCiB7Ci0Jc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlucyA9ICZk
ZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dl
cl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7CiAJc3RydWN0IGk5MTVfcG93ZXJfd2Vs
bCAqcG93ZXJfd2VsbDsKIAotCWlmIChpbnRlbF9kaXNwbGF5X3Bvd2VyX2dyYWJfYXN5bmNfcHV0
X3JlZihkZXZfcHJpdiwgZG9tYWluKSkKKwlpZiAoaW50ZWxfZGlzcGxheV9wb3dlcl9ncmFiX2Fz
eW5jX3B1dF9yZWYoaTkxNSwgZG9tYWluKSkKIAkJcmV0dXJuOwogCi0JZm9yX2VhY2hfcG93ZXJf
ZG9tYWluX3dlbGwoZGV2X3ByaXYsIHBvd2VyX3dlbGwsIEJJVF9VTEwoZG9tYWluKSkKLQkJaW50
ZWxfcG93ZXJfd2VsbF9nZXQoZGV2X3ByaXYsIHBvd2VyX3dlbGwpOworCWZvcl9lYWNoX3Bvd2Vy
X2RvbWFpbl93ZWxsKGk5MTUsIHBvd2VyX3dlbGwsIEJJVF9VTEwoZG9tYWluKSkKKwkJaW50ZWxf
cG93ZXJfd2VsbF9nZXQoaTkxNSwgcG93ZXJfd2VsbCk7CiAKIAlwb3dlcl9kb21haW5zLT5kb21h
aW5fdXNlX2NvdW50W2RvbWFpbl0rKzsKIH0KIAogLyoqCiAgKiBpbnRlbF9kaXNwbGF5X3Bvd2Vy
X2dldCAtIGdyYWIgYSBwb3dlciBkb21haW4gcmVmZXJlbmNlCi0gKiBAZGV2X3ByaXY6IGk5MTUg
ZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqIEBkb21h
aW46IHBvd2VyIGRvbWFpbiB0byByZWZlcmVuY2UKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGdyYWJz
IGEgcG93ZXIgZG9tYWluIHJlZmVyZW5jZSBmb3IgQGRvbWFpbiBhbmQgZW5zdXJlcyB0aGF0IHRo
ZQpAQCAtMTY4MCwxNCArMTY4MCwxNCBAQCBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2RvbWFp
bihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBBbnkgcG93ZXIgZG9tYWlu
IHJlZmVyZW5jZSBvYnRhaW5lZCBieSB0aGlzIGZ1bmN0aW9uIG11c3QgaGF2ZSBhIHN5bW1ldHJp
YwogICogY2FsbCB0byBpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dCgpIHRvIHJlbGVhc2UgdGhlIHJl
ZmVyZW5jZSBhZ2Fpbi4KICAqLwotaW50ZWxfd2FrZXJlZl90IGludGVsX2Rpc3BsYXlfcG93ZXJf
Z2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludGVsX3dha2VyZWZfdCBp
bnRlbF9kaXNwbGF5X3Bvd2VyX2dldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQkJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBkb21haW4pCiB7Ci0Jc3RydWN0IGk5
MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlucyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWlu
czsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGRldl9w
cml2KTsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zID0gJmk5MTUt
PnBvd2VyX2RvbWFpbnM7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldChpOTE1KTsKIAogCW11dGV4X2xvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwotCV9f
aW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfZG9tYWluKGRldl9wcml2LCBkb21haW4pOworCV9faW50
ZWxfZGlzcGxheV9wb3dlcl9nZXRfZG9tYWluKGk5MTUsIGRvbWFpbik7CiAJbXV0ZXhfdW5sb2Nr
KCZwb3dlcl9kb21haW5zLT5sb2NrKTsKIAogCXJldHVybiB3YWtlcmVmOwpAQCAtMTY5NSw3ICsx
Njk1LDcgQEAgaW50ZWxfd2FrZXJlZl90IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogLyoqCiAgKiBpbnRlbF9kaXNwbGF5X3Bvd2Vy
X2dldF9pZl9lbmFibGVkIC0gZ3JhYiBhIHJlZmVyZW5jZSBmb3IgYW4gZW5hYmxlZCBkaXNwbGF5
IHBvd2VyIGRvbWFpbgotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5
MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAZG9tYWluOiBwb3dlciBkb21haW4gdG8gcmVm
ZXJlbmNlCiAgKgogICogVGhpcyBmdW5jdGlvbiBncmFicyBhIHBvd2VyIGRvbWFpbiByZWZlcmVu
Y2UgZm9yIEBkb21haW4gYW5kIGVuc3VyZXMgdGhhdCB0aGUKQEAgLTE3MDYsMjEgKzE3MDYsMjEg
QEAgaW50ZWxfd2FrZXJlZl90IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKICAqIGNhbGwgdG8gaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQo
KSB0byByZWxlYXNlIHRoZSByZWZlcmVuY2UgYWdhaW4uCiAgKi8KIGludGVsX3dha2VyZWZfdAot
aW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgIGVudW0gaW50ZWxfZGlzcGxheV9wb3dlcl9k
b21haW4gZG9tYWluKQogewotCXN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFp
bnMgPSAmZGV2X3ByaXYtPnBvd2VyX2RvbWFpbnM7CisJc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlu
cyAqcG93ZXJfZG9tYWlucyA9ICZpOTE1LT5wb3dlcl9kb21haW5zOwogCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCWJvb2wgaXNfZW5hYmxlZDsKIAotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldF9pZl9pbl91c2UoZGV2X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3Bt
X2dldF9pZl9pbl91c2UoaTkxNSk7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1cm4gZmFsc2U7CiAK
IAltdXRleF9sb2NrKCZwb3dlcl9kb21haW5zLT5sb2NrKTsKIAotCWlmIChfX2ludGVsX2Rpc3Bs
YXlfcG93ZXJfaXNfZW5hYmxlZChkZXZfcHJpdiwgZG9tYWluKSkgewotCQlfX2ludGVsX2Rpc3Bs
YXlfcG93ZXJfZ2V0X2RvbWFpbihkZXZfcHJpdiwgZG9tYWluKTsKKwlpZiAoX19pbnRlbF9kaXNw
bGF5X3Bvd2VyX2lzX2VuYWJsZWQoaTkxNSwgZG9tYWluKSkgeworCQlfX2ludGVsX2Rpc3BsYXlf
cG93ZXJfZ2V0X2RvbWFpbihpOTE1LCBkb21haW4pOwogCQlpc19lbmFibGVkID0gdHJ1ZTsKIAl9
IGVsc2UgewogCQlpc19lbmFibGVkID0gZmFsc2U7CkBAIC0xNzI5LDcgKzE3MjksNyBAQCBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAltdXRleF91bmxvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwogCiAJaWYgKCFp
c19lbmFibGVkKSB7Ci0JCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCB3YWtlcmVmKTsK
KwkJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CiAJCXdha2VyZWYgPSAwOwog
CX0KIApAQCAtMTczNywxNCArMTczNywxNCBAQCBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9l
bmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogc3RhdGljIHZv
aWQKLV9faW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK19faW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfZG9tYWluKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSBlbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9t
YWluIGRvbWFpbikKIHsKIAlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5z
OwogCXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGw7CiAJY29uc3QgY2hhciAqbmFt
ZSA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluX3N0cihkb21haW4pOwogCi0JcG93ZXJfZG9t
YWlucyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlwb3dlcl9kb21haW5zID0gJmk5MTUt
PnBvd2VyX2RvbWFpbnM7CiAKIAlXQVJOKCFwb3dlcl9kb21haW5zLT5kb21haW5fdXNlX2NvdW50
W2RvbWFpbl0sCiAJICAgICAiVXNlIGNvdW50IG9uIGRvbWFpbiAlcyBpcyBhbHJlYWR5IHplcm9c
biIsCkBAIC0xNzU1LDIzICsxNzU1LDIzIEBAIF9faW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfZG9t
YWluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCXBvd2VyX2RvbWFpbnMt
PmRvbWFpbl91c2VfY291bnRbZG9tYWluXS0tOwogCi0JZm9yX2VhY2hfcG93ZXJfZG9tYWluX3dl
bGxfcmV2ZXJzZShkZXZfcHJpdiwgcG93ZXJfd2VsbCwgQklUX1VMTChkb21haW4pKQotCQlpbnRl
bF9wb3dlcl93ZWxsX3B1dChkZXZfcHJpdiwgcG93ZXJfd2VsbCk7CisJZm9yX2VhY2hfcG93ZXJf
ZG9tYWluX3dlbGxfcmV2ZXJzZShpOTE1LCBwb3dlcl93ZWxsLCBCSVRfVUxMKGRvbWFpbikpCisJ
CWludGVsX3Bvd2VyX3dlbGxfcHV0KGk5MTUsIHBvd2VyX3dlbGwpOwogfQogCi1zdGF0aWMgdm9p
ZCBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyB2b2lkIF9faW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2Rv
bWFpbiBkb21haW4pCiB7Ci0Jc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlu
cyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5z
ICpwb3dlcl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7CiAKIAltdXRleF9sb2NrKCZw
b3dlcl9kb21haW5zLT5sb2NrKTsKLQlfX2ludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2RvbWFpbihk
ZXZfcHJpdiwgZG9tYWluKTsKKwlfX2ludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2RvbWFpbihpOTE1
LCBkb21haW4pOwogCW11dGV4X3VubG9jaygmcG93ZXJfZG9tYWlucy0+bG9jayk7CiB9CiAKIC8q
KgogICogaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfdW5jaGVja2VkIC0gcmVsZWFzZSBhbiB1bmNo
ZWNrZWQgcG93ZXIgZG9tYWluIHJlZmVyZW5jZQotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBp
bnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAZG9tYWluOiBwb3dl
ciBkb21haW4gdG8gcmVmZXJlbmNlCiAgKgogICogVGhpcyBmdW5jdGlvbiBkcm9wcyB0aGUgcG93
ZXIgZG9tYWluIHJlZmVyZW5jZSBvYnRhaW5lZCBieQpAQCAtMTc4MiwxMSArMTc4MiwxMSBAQCBz
dGF0aWMgdm9pZCBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKICAqIG5ldyBjb2RlLCBhcyB0aGUgY29ycmVjdG5lc3Mgb2YgaXRzIHVz
ZSBjYW5ub3QgYmUgY2hlY2tlZC4gQWx3YXlzIHVzZQogICogaW50ZWxfZGlzcGxheV9wb3dlcl9w
dXQoKSBpbnN0ZWFkLgogICovCi12b2lkIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2Rpc3BsYXlf
cG93ZXJfcHV0X3VuY2hlY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICAgICAgZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBkb21haW4pCiB7Ci0JX19pbnRl
bF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgZG9tYWluKTsKLQlpbnRlbF9ydW50aW1lX3Bt
X3B1dF91bmNoZWNrZWQoZGV2X3ByaXYpOworCV9faW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkx
NSwgZG9tYWluKTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dF91bmNoZWNrZWQoaTkxNSk7CiB9CiAK
IHN0YXRpYyB2b2lkCkBAIC0xODAzLDcgKzE4MDMsNyBAQCBxdWV1ZV9hc3luY19wdXRfZG9tYWlu
c193b3JrKHN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMsCiBzdGF0aWMg
dm9pZAogcmVsZWFzZV9hc3luY19wdXRfZG9tYWlucyhzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5z
ICpwb3dlcl9kb21haW5zLCB1NjQgbWFzaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVy
X29mKHBvd2VyX2RvbWFpbnMsIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLAogCQkJICAgICBwb3dl
cl9kb21haW5zKTsKIAllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIGRvbWFpbjsKQEAg
LTE4MTQsMjYgKzE4MTQsMjYgQEAgcmVsZWFzZV9hc3luY19wdXRfZG9tYWlucyhzdHJ1Y3QgaTkx
NV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zLCB1NjQgbWFzaykKIAkgKiB3YWtlcmVmIHRv
IG1ha2UgdGhlIHN0YXRlIGNoZWNrZXIgaGFwcHkgYWJvdXQgdGhlIEhXIGFjY2VzcyBkdXJpbmcK
IAkgKiBwb3dlciB3ZWxsIGRpc2FibGluZy4KIAkgKi8KLQlhc3NlcnRfcnBtX3Jhd193YWtlcmVm
X2hlbGQoZGV2X3ByaXYpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChkZXZfcHJp
dik7CisJYXNzZXJ0X3JwbV9yYXdfd2FrZXJlZl9oZWxkKGk5MTUpOworCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAogCWZvcl9lYWNoX3Bvd2VyX2RvbWFpbihkb21haW4s
IG1hc2spIHsKIAkJLyogQ2xlYXIgYmVmb3JlIHB1dCwgc28gcHV0J3Mgc2FuaXR5IGNoZWNrIGlz
IGhhcHB5LiAqLwogCQlhc3luY19wdXRfZG9tYWluc19jbGVhcl9kb21haW4ocG93ZXJfZG9tYWlu
cywgZG9tYWluKTsKLQkJX19pbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF9kb21haW4oZGV2X3ByaXYs
IGRvbWFpbik7CisJCV9faW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfZG9tYWluKGk5MTUsIGRvbWFp
bik7CiAJfQogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYsIHdha2VyZWYpOworCWlu
dGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwogfQogCiBzdGF0aWMgdm9pZAogaW50
ZWxfZGlzcGxheV9wb3dlcl9wdXRfYXN5bmNfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmsp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSwKIAkJCSAgICAgcG93ZXJfZG9tYWlucy5hc3luY19wdXRfd29yay53b3JrKTsKLQlz
dHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dl
cl9kb21haW5zOwotCWludGVsX3dha2VyZWZfdCBuZXdfd29ya193YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXRfcmF3KGRldl9wcml2KTsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpw
b3dlcl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7CisJaW50ZWxfd2FrZXJlZl90IG5l
d193b3JrX3dha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9yYXcoaTkxNSk7CiAJaW50ZWxf
d2FrZXJlZl90IG9sZF93b3JrX3dha2VyZWYgPSAwOwogCiAJbXV0ZXhfbG9jaygmcG93ZXJfZG9t
YWlucy0+bG9jayk7CkBAIC0xODYzLDkgKzE4NjMsOSBAQCBpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1
dF9hc3luY193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAltdXRleF91bmxvY2soJnBv
d2VyX2RvbWFpbnMtPmxvY2spOwogCiAJaWYgKG9sZF93b3JrX3dha2VyZWYpCi0JCWludGVsX3J1
bnRpbWVfcG1fcHV0X3JhdyhkZXZfcHJpdiwgb2xkX3dvcmtfd2FrZXJlZik7CisJCWludGVsX3J1
bnRpbWVfcG1fcHV0X3JhdyhpOTE1LCBvbGRfd29ya193YWtlcmVmKTsKIAlpZiAobmV3X3dvcmtf
d2FrZXJlZikKLQkJaW50ZWxfcnVudGltZV9wbV9wdXRfcmF3KGRldl9wcml2LCBuZXdfd29ya193
YWtlcmVmKTsKKwkJaW50ZWxfcnVudGltZV9wbV9wdXRfcmF3KGk5MTUsIG5ld193b3JrX3dha2Vy
ZWYpOwogfQogCiAvKioKQEAgLTE5NzQsNyArMTk3NCw3IEBAIGludGVsX2Rpc3BsYXlfcG93ZXJf
Zmx1c2hfd29ya19zeW5jKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogI2lmIElTX0VO
QUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX1JVTlRJTUVfUE0pCiAvKioKICAqIGludGVsX2Rp
c3BsYXlfcG93ZXJfcHV0IC0gcmVsZWFzZSBhIHBvd2VyIGRvbWFpbiByZWZlcmVuY2UKLSAqIEBk
ZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0
YW5jZQogICogQGRvbWFpbjogcG93ZXIgZG9tYWluIHRvIHJlZmVyZW5jZQogICogQHdha2VyZWY6
IHdha2VyZWYgYWNxdWlyZWQgZm9yIHRoZSByZWZlcmVuY2UgdGhhdCBpcyBiZWluZyByZWxlYXNl
ZAogICoKQEAgLTE5ODIsMTIgKzE5ODIsMTIgQEAgaW50ZWxfZGlzcGxheV9wb3dlcl9mbHVzaF93
b3JrX3N5bmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAgKiBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2dldCgpIGFuZCBtaWdodCBwb3dlciBkb3duIHRoZSBjb3JyZXNwb25kaW5nIGhhcmR3
YXJlCiAgKiBibG9jayByaWdodCBhd2F5IGlmIHRoaXMgaXMgdGhlIGxhc3QgcmVmZXJlbmNlLgog
ICovCi12b2lkIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgIGVudW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4g
ZG9tYWluLAogCQkJICAgICBpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZikKIHsKLQlfX2ludGVsX2Rp
c3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBkb21haW4pOwotCWludGVsX3J1bnRpbWVfcG1fcHV0
KGRldl9wcml2LCB3YWtlcmVmKTsKKwlfX2ludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsIGRv
bWFpbik7CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CiB9CiAjZW5kaWYK
IApAQCAtMjY1NSwxNCArMjY1NSwxNCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfcG93ZXJf
d2VsbF9kZXNjIGNodl9wb3dlcl93ZWxsc1tdID0gewogCX0sCiB9OwogCi1ib29sIGludGVsX2Rp
c3BsYXlfcG93ZXJfd2VsbF9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK2Jvb2wgaW50ZWxfZGlzcGxheV9wb3dlcl93ZWxsX2lzX2VuYWJsZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSBlbnVtIGk5MTVfcG93ZXJfd2VsbF9pZCBwb3dl
cl93ZWxsX2lkKQogewogCXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGw7CiAJYm9v
bCByZXQ7CiAKLQlwb3dlcl93ZWxsID0gbG9va3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIHBvd2Vy
X3dlbGxfaWQpOwotCXJldCA9IHBvd2VyX3dlbGwtPmRlc2MtPm9wcy0+aXNfZW5hYmxlZChkZXZf
cHJpdiwgcG93ZXJfd2VsbCk7CisJcG93ZXJfd2VsbCA9IGxvb2t1cF9wb3dlcl93ZWxsKGk5MTUs
IHBvd2VyX3dlbGxfaWQpOworCXJldCA9IHBvd2VyX3dlbGwtPmRlc2MtPm9wcy0+aXNfZW5hYmxl
ZChpOTE1LCBwb3dlcl93ZWxsKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC0zMzUyLDcgKzMzNTIs
NyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfcG93ZXJfd2VsbF9kZXNjIGljbF9wb3dlcl93
ZWxsc1tdID0gewogfTsKIAogc3RhdGljIGludAotc2FuaXRpemVfZGlzYWJsZV9wb3dlcl93ZWxs
X29wdGlvbihjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzYW5pdGl6
ZV9kaXNhYmxlX3Bvd2VyX3dlbGxfb3B0aW9uKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCSAgIGludCBkaXNhYmxlX3Bvd2VyX3dlbGwpCiB7CiAJaWYgKGRpc2FibGVf
cG93ZXJfd2VsbCA+PSAwKQpAQCAtMzM2MSwxNCArMzM2MSwxNCBAQCBzYW5pdGl6ZV9kaXNhYmxl
X3Bvd2VyX3dlbGxfb3B0aW9uKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAlyZXR1cm4gMTsKIH0KIAotc3RhdGljIHUzMiBnZXRfYWxsb3dlZF9kY19tYXNrKGNvbnN0
IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB1MzIgZ2V0X2FsbG93
ZWRfZGNfbWFzayhjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAg
ICBpbnQgZW5hYmxlX2RjKQogewogCXUzMiBtYXNrOwogCWludCByZXF1ZXN0ZWRfZGM7CiAJaW50
IG1heF9kYzsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJaWYgKElOVEVM
X0dFTihpOTE1KSA+PSAxMSkgewogCQltYXhfZGMgPSAyOwogCQkvKgogCQkgKiBEQzkgaGFzIGEg
c2VwYXJhdGUgSFcgZmxvdyBmcm9tIHRoZSByZXN0IG9mIHRoZSBEQyBzdGF0ZXMsCkBAIC0zMzc2
LDEwICszMzc2LDEwIEBAIHN0YXRpYyB1MzIgZ2V0X2FsbG93ZWRfZGNfbWFzayhjb25zdCBzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAqIHN1c3BlbmQvcmVzdW1lLCBzbyBh
bGxvdyBpdCB1bmNvbmRpdGlvbmFsbHkuCiAJCSAqLwogCQltYXNrID0gRENfU1RBVEVfRU5fREM5
OwotCX0gZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCAxMCkgfHwgSVNfR0VOOV9CQyhkZXZfcHJp
dikpIHsKKwl9IGVsc2UgaWYgKElTX0dFTihpOTE1LCAxMCkgfHwgSVNfR0VOOV9CQyhpOTE1KSkg
ewogCQltYXhfZGMgPSAyOwogCQltYXNrID0gMDsKLQl9IGVsc2UgaWYgKElTX0dFTjlfTFAoZGV2
X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19HRU45X0xQKGk5MTUpKSB7CiAJCW1heF9kYyA9IDE7
CiAJCW1hc2sgPSBEQ19TVEFURV9FTl9EQzk7CiAJfSBlbHNlIHsKQEAgLTM0NTEsMjEgKzM0NTEs
MjEgQEAgX19zZXRfcG93ZXJfd2VsbHMoc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJf
ZG9tYWlucywKIAogLyoqCiAgKiBpbnRlbF9wb3dlcl9kb21haW5zX2luaXQgLSBpbml0aWFsaXpl
cyB0aGUgcG93ZXIgZG9tYWluIHN0cnVjdHVyZXMKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2Ug
aW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKLSAqIEluaXRpYWxp
emVzIHRoZSBwb3dlciBkb21haW4gc3RydWN0dXJlcyBmb3IgQGRldl9wcml2IGRlcGVuZGluZyB1
cG9uIHRoZQorICogSW5pdGlhbGl6ZXMgdGhlIHBvd2VyIGRvbWFpbiBzdHJ1Y3R1cmVzIGZvciBA
aTkxNSBkZXBlbmRpbmcgdXBvbiB0aGUKICAqIHN1cHBvcnRlZCBwbGF0Zm9ybS4KICAqLwotaW50
IGludGVsX3Bvd2VyX2RvbWFpbnNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitpbnQgaW50ZWxfcG93ZXJfZG9tYWluc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCXN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMgPSAm
ZGV2X3ByaXYtPnBvd2VyX2RvbWFpbnM7CisJc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93
ZXJfZG9tYWlucyA9ICZpOTE1LT5wb3dlcl9kb21haW5zOwogCWludCBlcnI7CiAKIAlpOTE1X21v
ZHBhcmFtcy5kaXNhYmxlX3Bvd2VyX3dlbGwgPQotCQlzYW5pdGl6ZV9kaXNhYmxlX3Bvd2VyX3dl
bGxfb3B0aW9uKGRldl9wcml2LAorCQlzYW5pdGl6ZV9kaXNhYmxlX3Bvd2VyX3dlbGxfb3B0aW9u
KGk5MTUsCiAJCQkJCQkgICBpOTE1X21vZHBhcmFtcy5kaXNhYmxlX3Bvd2VyX3dlbGwpOwotCWRl
dl9wcml2LT5jc3IuYWxsb3dlZF9kY19tYXNrID0KLQkJZ2V0X2FsbG93ZWRfZGNfbWFzayhkZXZf
cHJpdiwgaTkxNV9tb2RwYXJhbXMuZW5hYmxlX2RjKTsKKwlpOTE1LT5jc3IuYWxsb3dlZF9kY19t
YXNrID0KKwkJZ2V0X2FsbG93ZWRfZGNfbWFzayhpOTE1LCBpOTE1X21vZHBhcmFtcy5lbmFibGVf
ZGMpOwogCiAJQlVJTERfQlVHX09OKFBPV0VSX0RPTUFJTl9OVU0gPiA2NCk7CiAKQEAgLTM0Nzgs
OSArMzQ3OCw5IEBAIGludCBpbnRlbF9wb3dlcl9kb21haW5zX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIFRoZSBlbmFibGluZyBvcmRlciB3aWxsIGJlIGZyb20g
bG93ZXIgdG8gaGlnaGVyIGluZGV4ZWQgd2VsbHMsCiAJICogdGhlIGRpc2FibGluZyBvcmRlciBp
cyByZXZlcnNlZC4KIAkgKi8KLQlpZiAoSVNfR0VOKGRldl9wcml2LCAxMSkpIHsKKwlpZiAoSVNf
R0VOKGk5MTUsIDExKSkgewogCQllcnIgPSBzZXRfcG93ZXJfd2VsbHMocG93ZXJfZG9tYWlucywg
aWNsX3Bvd2VyX3dlbGxzKTsKLQl9IGVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKSB7
CisJfSBlbHNlIGlmIChJU19DQU5OT05MQUtFKGk5MTUpKSB7CiAJCWVyciA9IHNldF9wb3dlcl93
ZWxscyhwb3dlcl9kb21haW5zLCBjbmxfcG93ZXJfd2VsbHMpOwogCiAJCS8qCkBAIC0zNDg5LDIz
ICszNDg5LDIzIEBAIGludCBpbnRlbF9wb3dlcl9kb21haW5zX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCQkgKiB0aW1lb3V0cywgbGV0cyByZW1vdmUgdGhlbSBmcm9t
IHRoZSBsaXN0CiAJCSAqIGZvciB0aGUgU0tVcyB3aXRob3V0IHBvcnQgRi4KIAkJICovCi0JCWlm
ICghSVNfQ05MX1dJVEhfUE9SVF9GKGRldl9wcml2KSkKKwkJaWYgKCFJU19DTkxfV0lUSF9QT1JU
X0YoaTkxNSkpCiAJCQlwb3dlcl9kb21haW5zLT5wb3dlcl93ZWxsX2NvdW50IC09IDI7Ci0JfSBl
bHNlIGlmIChJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfR0VNSU5J
TEFLRShpOTE1KSkgewogCQllcnIgPSBzZXRfcG93ZXJfd2VsbHMocG93ZXJfZG9tYWlucywgZ2xr
X3Bvd2VyX3dlbGxzKTsKLQl9IGVsc2UgaWYgKElTX0JST1hUT04oZGV2X3ByaXYpKSB7CisJfSBl
bHNlIGlmIChJU19CUk9YVE9OKGk5MTUpKSB7CiAJCWVyciA9IHNldF9wb3dlcl93ZWxscyhwb3dl
cl9kb21haW5zLCBieHRfcG93ZXJfd2VsbHMpOwotCX0gZWxzZSBpZiAoSVNfR0VOOV9CQyhkZXZf
cHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0dFTjlfQkMoaTkxNSkpIHsKIAkJZXJyID0gc2V0X3Bv
d2VyX3dlbGxzKHBvd2VyX2RvbWFpbnMsIHNrbF9wb3dlcl93ZWxscyk7Ci0JfSBlbHNlIGlmIChJ
U19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhpOTE1
KSkgewogCQllcnIgPSBzZXRfcG93ZXJfd2VsbHMocG93ZXJfZG9tYWlucywgY2h2X3Bvd2VyX3dl
bGxzKTsKLQl9IGVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYg
KElTX0JST0FEV0VMTChpOTE1KSkgewogCQllcnIgPSBzZXRfcG93ZXJfd2VsbHMocG93ZXJfZG9t
YWlucywgYmR3X3Bvd2VyX3dlbGxzKTsKLQl9IGVsc2UgaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYp
KSB7CisJfSBlbHNlIGlmIChJU19IQVNXRUxMKGk5MTUpKSB7CiAJCWVyciA9IHNldF9wb3dlcl93
ZWxscyhwb3dlcl9kb21haW5zLCBoc3dfcG93ZXJfd2VsbHMpOwotCX0gZWxzZSBpZiAoSVNfVkFM
TEVZVklFVyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkpIHsK
IAkJZXJyID0gc2V0X3Bvd2VyX3dlbGxzKHBvd2VyX2RvbWFpbnMsIHZsdl9wb3dlcl93ZWxscyk7
Ci0JfSBlbHNlIGlmIChJU19JODMwKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfSTgzMChp
OTE1KSkgewogCQllcnIgPSBzZXRfcG93ZXJfd2VsbHMocG93ZXJfZG9tYWlucywgaTgzMF9wb3dl
cl93ZWxscyk7CiAJfSBlbHNlIHsKIAkJZXJyID0gc2V0X3Bvd2VyX3dlbGxzKHBvd2VyX2RvbWFp
bnMsIGk5eHhfYWx3YXlzX29uX3Bvd2VyX3dlbGwpOwpAQCAtMzUxNiwzMSArMzUxNiwzMSBAQCBp
bnQgaW50ZWxfcG93ZXJfZG9tYWluc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAogLyoqCiAgKiBpbnRlbF9wb3dlcl9kb21haW5zX2NsZWFudXAgLSBjbGVhbiB1cCBw
b3dlciBkb21haW5zIHJlc291cmNlcwotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5j
ZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogUmVsZWFzZSBhbnkgcmVz
b3VyY2VzIGFjcXVpcmVkIGJ5IGludGVsX3Bvd2VyX2RvbWFpbnNfaW5pdCgpCiAgKi8KLXZvaWQg
aW50ZWxfcG93ZXJfZG9tYWluc19jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3ZvaWQgaW50ZWxfcG93ZXJfZG9tYWluc19jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewotCWtmcmVlKGRldl9wcml2LT5wb3dlcl9kb21haW5zLnBvd2VyX3dl
bGxzKTsKKwlrZnJlZShpOTE1LT5wb3dlcl9kb21haW5zLnBvd2VyX3dlbGxzKTsKIH0KIAotc3Rh
dGljIHZvaWQgaW50ZWxfcG93ZXJfZG9tYWluc19zeW5jX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX3Bvd2VyX2RvbWFpbnNfc3luY19odyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21h
aW5zICpwb3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dlcl9kb21haW5zOworCXN0cnVjdCBp
OTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMgPSAmaTkxNS0+cG93ZXJfZG9tYWluczsK
IAlzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpwb3dlcl93ZWxsOwogCiAJbXV0ZXhfbG9jaygmcG93
ZXJfZG9tYWlucy0+bG9jayk7Ci0JZm9yX2VhY2hfcG93ZXJfd2VsbChkZXZfcHJpdiwgcG93ZXJf
d2VsbCkgewotCQlwb3dlcl93ZWxsLT5kZXNjLT5vcHMtPnN5bmNfaHcoZGV2X3ByaXYsIHBvd2Vy
X3dlbGwpOworCWZvcl9lYWNoX3Bvd2VyX3dlbGwoaTkxNSwgcG93ZXJfd2VsbCkgeworCQlwb3dl
cl93ZWxsLT5kZXNjLT5vcHMtPnN5bmNfaHcoaTkxNSwgcG93ZXJfd2VsbCk7CiAJCXBvd2VyX3dl
bGwtPmh3X2VuYWJsZWQgPQotCQkJcG93ZXJfd2VsbC0+ZGVzYy0+b3BzLT5pc19lbmFibGVkKGRl
dl9wcml2LCBwb3dlcl93ZWxsKTsKKwkJCXBvd2VyX3dlbGwtPmRlc2MtPm9wcy0+aXNfZW5hYmxl
ZChpOTE1LCBwb3dlcl93ZWxsKTsKIAl9CiAJbXV0ZXhfdW5sb2NrKCZwb3dlcl9kb21haW5zLT5s
b2NrKTsKIH0KIAogc3RhdGljIGlubGluZQotYm9vbCBpbnRlbF9kYnVmX3NsaWNlX3NldChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitib29sIGludGVsX2RidWZfc2xpY2Vfc2V0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBpOTE1X3JlZ190IHJlZywgYm9v
bCBlbmFibGUpCiB7CiAJdTMyIHZhbCwgc3RhdHVzOwpAQCAtMzU2MCwzMCArMzU2MCwzMCBAQCBi
b29sIGludGVsX2RidWZfc2xpY2Vfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOV9kYnVmX2VuYWJsZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW45X2RidWZfZW5h
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWludGVsX2RidWZfc2xpY2Vf
c2V0KGRldl9wcml2LCBEQlVGX0NUTCwgdHJ1ZSk7CisJaW50ZWxfZGJ1Zl9zbGljZV9zZXQoaTkx
NSwgREJVRl9DVEwsIHRydWUpOwogfQogCi1zdGF0aWMgdm9pZCBnZW45X2RidWZfZGlzYWJsZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW45X2RidWZf
ZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnRlbF9kYnVmX3Ns
aWNlX3NldChkZXZfcHJpdiwgREJVRl9DVEwsIGZhbHNlKTsKKwlpbnRlbF9kYnVmX3NsaWNlX3Nl
dChpOTE1LCBEQlVGX0NUTCwgZmFsc2UpOwogfQogCi1zdGF0aWMgdTggaW50ZWxfZGJ1Zl9tYXhf
c2xpY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB1OCBpbnRl
bF9kYnVmX21heF9zbGljZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgMTEpCiAJ
CXJldHVybiAxOwogCXJldHVybiAyOwogfQogCi12b2lkIGljbF9kYnVmX3NsaWNlc191cGRhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpY2xfZGJ1Zl9zbGljZXNf
dXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgIHU4IHJlcV9zbGlj
ZXMpCiB7Ci0JY29uc3QgdTggaHdfZW5hYmxlZF9zbGljZXMgPSBkZXZfcHJpdi0+d20uc2tsX2h3
LmRkYi5lbmFibGVkX3NsaWNlczsKKwljb25zdCB1OCBod19lbmFibGVkX3NsaWNlcyA9IGk5MTUt
PndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXM7CiAJYm9vbCByZXQ7CiAKLQlpZiAocmVxX3Ns
aWNlcyA+IGludGVsX2RidWZfbWF4X3NsaWNlcyhkZXZfcHJpdikpIHsKKwlpZiAocmVxX3NsaWNl
cyA+IGludGVsX2RidWZfbWF4X3NsaWNlcyhpOTE1KSkgewogCQlEUk1fRVJST1IoIkludmFsaWQg
bnVtYmVyIG9mIGRidWYgc2xpY2VzIHJlcXVlc3RlZFxuIik7CiAJCXJldHVybjsKIAl9CkBAIC0z
NTkyLDE1ICszNTkyLDE1IEBAIHZvaWQgaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsKIAogCWlmIChyZXFfc2xpY2VzID4g
aHdfZW5hYmxlZF9zbGljZXMpCi0JCXJldCA9IGludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2
LCBEQlVGX0NUTF9TMiwgdHJ1ZSk7CisJCXJldCA9IGludGVsX2RidWZfc2xpY2Vfc2V0KGk5MTUs
IERCVUZfQ1RMX1MyLCB0cnVlKTsKIAllbHNlCi0JCXJldCA9IGludGVsX2RidWZfc2xpY2Vfc2V0
KGRldl9wcml2LCBEQlVGX0NUTF9TMiwgZmFsc2UpOworCQlyZXQgPSBpbnRlbF9kYnVmX3NsaWNl
X3NldChpOTE1LCBEQlVGX0NUTF9TMiwgZmFsc2UpOwogCiAJaWYgKHJldCkKLQkJZGV2X3ByaXYt
PndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXMgPSByZXFfc2xpY2VzOworCQlpOTE1LT53bS5z
a2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzID0gcmVxX3NsaWNlczsKIH0KIAotc3RhdGljIHZvaWQg
aWNsX2RidWZfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRp
YyB2b2lkIGljbF9kYnVmX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAlJOTE1X1dSSVRFKERCVUZfQ1RMX1MxLCBJOTE1X1JFQUQoREJVRl9DVExfUzEpIHwgREJVRl9Q
T1dFUl9SRVFVRVNUKTsKIAlJOTE1X1dSSVRFKERCVUZfQ1RMX1MyLCBJOTE1X1JFQUQoREJVRl9D
VExfUzIpIHwgREJVRl9QT1dFUl9SRVFVRVNUKTsKQEAgLTM2MTYsMTAgKzM2MTYsMTAgQEAgc3Rh
dGljIHZvaWQgaWNsX2RidWZfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkJICogRklYTUU6IGZvciBub3cgcHJldGVuZCB0aGF0IHdlIG9ubHkgaGF2ZSAxIHNsaWNl
LCBzZWUKIAkJICogaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19udW0oKS4KIAkJICovCi0JCWRl
dl9wcml2LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzID0gMTsKKwkJaTkxNS0+d20uc2ts
X2h3LmRkYi5lbmFibGVkX3NsaWNlcyA9IDE7CiB9CiAKLXN0YXRpYyB2b2lkIGljbF9kYnVmX2Rp
c2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaWNs
X2RidWZfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlJOTE1X1dS
SVRFKERCVUZfQ1RMX1MxLCBJOTE1X1JFQUQoREJVRl9DVExfUzEpICYgfkRCVUZfUE9XRVJfUkVR
VUVTVCk7CiAJSTkxNV9XUklURShEQlVGX0NUTF9TMiwgSTkxNV9SRUFEKERCVUZfQ1RMX1MyKSAm
IH5EQlVGX1BPV0VSX1JFUVVFU1QpOwpAQCAtMzYzNSwxMCArMzYzNSwxMCBAQCBzdGF0aWMgdm9p
ZCBpY2xfZGJ1Zl9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJ
ICogRklYTUU6IGZvciBub3cgcHJldGVuZCB0aGF0IHRoZSBmaXJzdCBzbGljZSBpcyBhbHdheXMK
IAkJICogZW5hYmxlZCwgc2VlIGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKCkuCiAJCSAq
LwotCQlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlcyA9IDE7CisJCWk5MTUt
PndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXMgPSAxOwogfQogCi1zdGF0aWMgdm9pZCBpY2xf
bWJ1c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lk
IGljbF9tYnVzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIHZh
bDsKIApAQCAtMzY1MCw3ICszNjUwLDcgQEAgc3RhdGljIHZvaWQgaWNsX21idXNfaW5pdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShNQlVTX0FCT1hfQ1RM
LCB2YWwpOwogfQogCi1zdGF0aWMgdm9pZCBoc3dfYXNzZXJ0X2NkY2xrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGhzd19hc3NlcnRfY2RjbGsoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChMQ1BMTF9D
VEwpOwogCkBAIC0zNjcwLDkgKzM2NzAsOSBAQCBzdGF0aWMgdm9pZCBoc3dfYXNzZXJ0X2NkY2xr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJRFJNX0VSUk9SKCJMQ1BMTCBu
b3QgdXNpbmcgbm9uLVNTQyByZWZlcmVuY2VcbiIpOwogfQogCi1zdGF0aWMgdm9pZCBhc3NlcnRf
Y2FuX2Rpc2FibGVfbGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgYXNzZXJ0X2Nhbl9kaXNhYmxlX2xjcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YzsKIAogCWZvcl9lYWNoX2ludGVsX2NydGMoZGV2LCBjcnRjKQpAQCAtMzY5MSw3ICszNjkx
LDcgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2Nhbl9kaXNhYmxlX2xjcGxsKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAkJCSJQYW5lbCBwb3dlciBvblxuIik7CiAJSTkxNV9TVEFU
RV9XQVJOKEk5MTVfUkVBRChCTENfUFdNX0NQVV9DVEwyKSAmIEJMTV9QV01fRU5BQkxFLAogCQkJ
IkNQVSBQV00xIGVuYWJsZWRcbiIpOwotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSkKKwlpZiAo
SVNfSEFTV0VMTChpOTE1KSkKIAkJSTkxNV9TVEFURV9XQVJOKEk5MTVfUkVBRChIU1dfQkxDX1BX
TTJfQ1RMKSAmIEJMTV9QV01fRU5BQkxFLAogCQkJCSJDUFUgUFdNMiBlbmFibGVkXG4iKTsKIAlJ
OTE1X1NUQVRFX1dBUk4oSTkxNV9SRUFEKEJMQ19QV01fUENIX0NUTDEpICYgQkxNX1BDSF9QV01f
RU5BQkxFLApAQCAtMzcwNywyMSArMzcwNywyMSBAQCBzdGF0aWMgdm9pZCBhc3NlcnRfY2FuX2Rp
c2FibGVfbGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIGdlbi1z
cGVjaWZpYyBhbmQgc2luY2Ugd2Ugb25seSBkaXNhYmxlIExDUExMIGFmdGVyIHdlIGZ1bGx5IGRp
c2FibGUKIAkgKiB0aGUgaW50ZXJydXB0cywgdGhlIGNoZWNrIGJlbG93IHNob3VsZCBiZSBlbm91
Z2guCiAJICovCi0JSTkxNV9TVEFURV9XQVJOKGludGVsX2lycXNfZW5hYmxlZChkZXZfcHJpdiks
ICJJUlFzIGVuYWJsZWRcbiIpOworCUk5MTVfU1RBVEVfV0FSTihpbnRlbF9pcnFzX2VuYWJsZWQo
aTkxNSksICJJUlFzIGVuYWJsZWRcbiIpOwogfQogCi1zdGF0aWMgdTMyIGhzd19yZWFkX2Rjb21w
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB1MzIgaHN3X3JlYWRf
ZGNvbXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKElTX0hBU1dFTEwo
ZGV2X3ByaXYpKQorCWlmIChJU19IQVNXRUxMKGk5MTUpKQogCQlyZXR1cm4gSTkxNV9SRUFEKERf
Q09NUF9IU1cpOwogCWVsc2UKIAkJcmV0dXJuIEk5MTVfUkVBRChEX0NPTVBfQkRXKTsKIH0KIAot
c3RhdGljIHZvaWQgaHN3X3dyaXRlX2Rjb21wKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgdTMyIHZhbCkKK3N0YXRpYyB2b2lkIGhzd193cml0ZV9kY29tcChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHZhbCkKIHsKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikp
IHsKLQkJaWYgKHNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlKGRldl9wcml2LAorCWlmIChJU19IQVNX
RUxMKGk5MTUpKSB7CisJCWlmIChzYW5keWJyaWRnZV9wY29kZV93cml0ZShpOTE1LAogCQkJCQkg
ICAgR0VONl9QQ09ERV9XUklURV9EX0NPTVAsIHZhbCkpCiAJCQlEUk1fREVCVUdfS01TKCJGYWls
ZWQgdG8gd3JpdGUgdG8gRF9DT01QXG4iKTsKIAl9IGVsc2UgewpAQCAtMzczOCwxMiArMzczOCwx
MiBAQCBzdGF0aWMgdm9pZCBoc3dfd3JpdGVfZGNvbXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LCB1MzIgdmFsKQogICogcmVnaXN0ZXIuIENhbGxlcnMgc2hvdWxkIHRha2UgY2Fy
ZSBvZiBkaXNhYmxpbmcgYWxsIHRoZSBkaXNwbGF5IGVuZ2luZQogICogZnVuY3Rpb25zLCBkb2lu
ZyB0aGUgbW9kZSB1bnNldCwgZml4aW5nIGludGVycnVwdHMsIGV0Yy4KICAqLwotc3RhdGljIHZv
aWQgaHN3X2Rpc2FibGVfbGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgaHN3X2Rpc2FibGVfbGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkgICAgICBib29sIHN3aXRjaF90b19mY2xrLCBib29sIGFsbG93X3Bvd2VyX2Rvd24p
CiB7CiAJdTMyIHZhbDsKIAotCWFzc2VydF9jYW5fZGlzYWJsZV9sY3BsbChkZXZfcHJpdik7CisJ
YXNzZXJ0X2Nhbl9kaXNhYmxlX2xjcGxsKGk5MTUpOwogCiAJdmFsID0gSTkxNV9SRUFEKExDUExM
X0NUTCk7CiAKQEAgLTM3NjIsMTYgKzM3NjIsMTYgQEAgc3RhdGljIHZvaWQgaHN3X2Rpc2FibGVf
bGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoTENQ
TExfQ1RMLCB2YWwpOwogCVBPU1RJTkdfUkVBRChMQ1BMTF9DVEwpOwogCi0JaWYgKGludGVsX3dh
aXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBMQ1BMTF9DVEwsCisJaWYgKGludGVs
X3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsIExDUExMX0NUTCwKIAkJCQkgICAgTENQ
TExfUExMX0xPQ0ssIDAsIDEpKQogCQlEUk1fRVJST1IoIkxDUExMIHN0aWxsIGxvY2tlZFxuIik7
CiAKLQl2YWwgPSBoc3dfcmVhZF9kY29tcChkZXZfcHJpdik7CisJdmFsID0gaHN3X3JlYWRfZGNv
bXAoaTkxNSk7CiAJdmFsIHw9IERfQ09NUF9DT01QX0RJU0FCTEU7Ci0JaHN3X3dyaXRlX2Rjb21w
KGRldl9wcml2LCB2YWwpOworCWhzd193cml0ZV9kY29tcChpOTE1LCB2YWwpOwogCW5kZWxheSgx
MDApOwogCi0JaWYgKHdhaXRfZm9yKChoc3dfcmVhZF9kY29tcChkZXZfcHJpdikgJgorCWlmICh3
YWl0X2ZvcigoaHN3X3JlYWRfZGNvbXAoaTkxNSkgJgogCQkgICAgICBEX0NPTVBfUkNPTVBfSU5f
UFJPR1JFU1MpID09IDAsIDEpKQogCQlEUk1fRVJST1IoIkRfQ09NUCBSQ09NUCBzdGlsbCBpbiBw
cm9ncmVzc1xuIik7CiAKQEAgLTM3ODcsNyArMzc4Nyw3IEBAIHN0YXRpYyB2b2lkIGhzd19kaXNh
YmxlX2xjcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqIEZ1bGx5IHJl
c3RvcmVzIExDUExMLCBkaXNhbGxvd2luZyBwb3dlciBkb3duIGFuZCBzd2l0Y2hpbmcgYmFjayB0
byBMQ1BMTAogICogc291cmNlLgogICovCi1zdGF0aWMgdm9pZCBoc3dfcmVzdG9yZV9sY3BsbChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBoc3dfcmVzdG9y
ZV9sY3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFsOwogCkBA
IC0zODAxLDcgKzM4MDEsNyBAQCBzdGF0aWMgdm9pZCBoc3dfcmVzdG9yZV9sY3BsbChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogTWFrZSBzdXJlIHdlJ3JlIG5vdCBvbiBQ
Qzggc3RhdGUgYmVmb3JlIGRpc2FibGluZyBQQzgsIG90aGVyd2lzZQogCSAqIHdlJ2xsIGhhbmcg
dGhlIG1hY2hpbmUuIFRvIHByZXZlbnQgUEM4IHN0YXRlLCBqdXN0IGVuYWJsZSBmb3JjZV93YWtl
LgogCSAqLwotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBG
T1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3Jl
LCBGT1JDRVdBS0VfQUxMKTsKIAogCWlmICh2YWwgJiBMQ1BMTF9QT1dFUl9ET1dOX0FMTE9XKSB7
CiAJCXZhbCAmPSB+TENQTExfUE9XRVJfRE9XTl9BTExPVzsKQEAgLTM4MDksMTYgKzM4MDksMTYg
QEAgc3RhdGljIHZvaWQgaHN3X3Jlc3RvcmVfbGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCQlQT1NUSU5HX1JFQUQoTENQTExfQ1RMKTsKIAl9CiAKLQl2YWwgPSBoc3df
cmVhZF9kY29tcChkZXZfcHJpdik7CisJdmFsID0gaHN3X3JlYWRfZGNvbXAoaTkxNSk7CiAJdmFs
IHw9IERfQ09NUF9DT01QX0ZPUkNFOwogCXZhbCAmPSB+RF9DT01QX0NPTVBfRElTQUJMRTsKLQlo
c3dfd3JpdGVfZGNvbXAoZGV2X3ByaXYsIHZhbCk7CisJaHN3X3dyaXRlX2Rjb21wKGk5MTUsIHZh
bCk7CiAKIAl2YWwgPSBJOTE1X1JFQUQoTENQTExfQ1RMKTsKIAl2YWwgJj0gfkxDUExMX1BMTF9E
SVNBQkxFOwogCUk5MTVfV1JJVEUoTENQTExfQ1RMLCB2YWwpOwogCi0JaWYgKGludGVsX3dhaXRf
Zm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBMQ1BMTF9DVEwsCisJaWYgKGludGVsX3dh
aXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsIExDUExMX0NUTCwKIAkJCQkgICAgTENQTExf
UExMX0xPQ0ssIExDUExMX1BMTF9MT0NLLCA1KSkKIAkJRFJNX0VSUk9SKCJMQ1BMTCBub3QgbG9j
a2VkIHlldFxuIik7CiAKQEAgLTM4MzIsMTAgKzM4MzIsMTAgQEAgc3RhdGljIHZvaWQgaHN3X3Jl
c3RvcmVfbGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJRFJNX0VS
Uk9SKCJTd2l0Y2hpbmcgYmFjayB0byBMQ1BMTCBmYWlsZWRcbiIpOwogCX0KIAotCWludGVsX3Vu
Y29yZV9mb3JjZXdha2VfcHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlp
bnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsK
IAotCWludGVsX3VwZGF0ZV9jZGNsayhkZXZfcHJpdik7Ci0JaW50ZWxfZHVtcF9jZGNsa19zdGF0
ZSgmZGV2X3ByaXYtPmNkY2xrLmh3LCAiQ3VycmVudCBDRENMSyIpOworCWludGVsX3VwZGF0ZV9j
ZGNsayhpOTE1KTsKKwlpbnRlbF9kdW1wX2NkY2xrX3N0YXRlKCZpOTE1LT5jZGNsay5odywgIkN1
cnJlbnQgQ0RDTEsiKTsKIH0KIAogLyoKQEAgLTM4NjEsNDUgKzM4NjEsNDUgQEAgc3RhdGljIHZv
aWQgaHN3X3Jlc3RvcmVfbGNwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
ICogRm9yIG1vcmUsIHJlYWQgIkRpc3BsYXkgU2VxdWVuY2VzIGZvciBQYWNrYWdlIEM4IiBvbiB0
aGUgaGFyZHdhcmUKICAqIGRvY3VtZW50YXRpb24uCiAgKi8KLXZvaWQgaHN3X2VuYWJsZV9wYzgo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBoc3dfZW5hYmxlX3BjOChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFsOwogCiAJRFJNX0RFQlVH
X0tNUygiRW5hYmxpbmcgcGFja2FnZSBDOCtcbiIpOwogCi0JaWYgKEhBU19QQ0hfTFBUX0xQKGRl
dl9wcml2KSkgeworCWlmIChIQVNfUENIX0xQVF9MUChpOTE1KSkgewogCQl2YWwgPSBJOTE1X1JF
QUQoU09VVEhfRFNQQ0xLX0dBVEVfRCk7CiAJCXZhbCAmPSB+UENIX0xQX1BBUlRJVElPTl9MRVZF
TF9ESVNBQkxFOwogCQlJOTE1X1dSSVRFKFNPVVRIX0RTUENMS19HQVRFX0QsIHZhbCk7CiAJfQog
Ci0JbHB0X2Rpc2FibGVfY2xrb3V0X2RwKGRldl9wcml2KTsKLQloc3dfZGlzYWJsZV9sY3BsbChk
ZXZfcHJpdiwgdHJ1ZSwgdHJ1ZSk7CisJbHB0X2Rpc2FibGVfY2xrb3V0X2RwKGk5MTUpOworCWhz
d19kaXNhYmxlX2xjcGxsKGk5MTUsIHRydWUsIHRydWUpOwogfQogCi12b2lkIGhzd19kaXNhYmxl
X3BjOChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGhzd19kaXNhYmxl
X3BjOChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFsOwogCiAJRFJN
X0RFQlVHX0tNUygiRGlzYWJsaW5nIHBhY2thZ2UgQzgrXG4iKTsKIAotCWhzd19yZXN0b3JlX2xj
cGxsKGRldl9wcml2KTsKLQlpbnRlbF9pbml0X3BjaF9yZWZjbGsoZGV2X3ByaXYpOworCWhzd19y
ZXN0b3JlX2xjcGxsKGk5MTUpOworCWludGVsX2luaXRfcGNoX3JlZmNsayhpOTE1KTsKIAotCWlm
IChIQVNfUENIX0xQVF9MUChkZXZfcHJpdikpIHsKKwlpZiAoSEFTX1BDSF9MUFRfTFAoaTkxNSkp
IHsKIAkJdmFsID0gSTkxNV9SRUFEKFNPVVRIX0RTUENMS19HQVRFX0QpOwogCQl2YWwgfD0gUENI
X0xQX1BBUlRJVElPTl9MRVZFTF9ESVNBQkxFOwogCQlJOTE1X1dSSVRFKFNPVVRIX0RTUENMS19H
QVRFX0QsIHZhbCk7CiAJfQogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wY2hfcmVzZXRfaGFuZHNo
YWtlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGludGVs
X3BjaF9yZXNldF9oYW5kc2hha2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJ
ICAgICAgYm9vbCBlbmFibGUpCiB7CiAJaTkxNV9yZWdfdCByZWc7CiAJdTMyIHJlc2V0X2JpdHMs
IHZhbDsKIAotCWlmIChJU19JVllCUklER0UoZGV2X3ByaXYpKSB7CisJaWYgKElTX0lWWUJSSURH
RShpOTE1KSkgewogCQlyZWcgPSBHRU43X01TR19DVEw7CiAJCXJlc2V0X2JpdHMgPSBXQUlUX0ZP
Ul9QQ0hfRkxSX0FDSyB8IFdBSVRfRk9SX1BDSF9SRVNFVF9BQ0s7CiAJfSBlbHNlIHsKQEAgLTM5
MTcsNDYgKzM5MTcsNDYgQEAgc3RhdGljIHZvaWQgaW50ZWxfcGNoX3Jlc2V0X2hhbmRzaGFrZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJSTkxNV9XUklURShyZWcsIHZhbCk7
CiB9CiAKLXN0YXRpYyB2b2lkIHNrbF9kaXNwbGF5X2NvcmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBza2xfZGlzcGxheV9jb3JlX2luaXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICBib29sIHJlc3VtZSkKIHsKLQlzdHJ1
Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dlcl9k
b21haW5zOworCXN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMgPSAmaTkx
NS0+cG93ZXJfZG9tYWluczsKIAlzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICp3ZWxsOwogCi0JZ2Vu
OV9zZXRfZGNfc3RhdGUoZGV2X3ByaXYsIERDX1NUQVRFX0RJU0FCTEUpOworCWdlbjlfc2V0X2Rj
X3N0YXRlKGk5MTUsIERDX1NUQVRFX0RJU0FCTEUpOwogCiAJLyogZW5hYmxlIFBDSCByZXNldCBo
YW5kc2hha2UgKi8KLQlpbnRlbF9wY2hfcmVzZXRfaGFuZHNoYWtlKGRldl9wcml2LCAhSEFTX1BD
SF9OT1AoZGV2X3ByaXYpKTsKKwlpbnRlbF9wY2hfcmVzZXRfaGFuZHNoYWtlKGk5MTUsICFIQVNf
UENIX05PUChpOTE1KSk7CiAKIAkvKiBlbmFibGUgUEcxIGFuZCBNaXNjIEkvTyAqLwogCW11dGV4
X2xvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwogCi0Jd2VsbCA9IGxvb2t1cF9wb3dlcl93ZWxs
KGRldl9wcml2LCBTS0xfRElTUF9QV18xKTsKLQlpbnRlbF9wb3dlcl93ZWxsX2VuYWJsZShkZXZf
cHJpdiwgd2VsbCk7CisJd2VsbCA9IGxvb2t1cF9wb3dlcl93ZWxsKGk5MTUsIFNLTF9ESVNQX1BX
XzEpOworCWludGVsX3Bvd2VyX3dlbGxfZW5hYmxlKGk5MTUsIHdlbGwpOwogCi0Jd2VsbCA9IGxv
b2t1cF9wb3dlcl93ZWxsKGRldl9wcml2LCBTS0xfRElTUF9QV19NSVNDX0lPKTsKLQlpbnRlbF9w
b3dlcl93ZWxsX2VuYWJsZShkZXZfcHJpdiwgd2VsbCk7CisJd2VsbCA9IGxvb2t1cF9wb3dlcl93
ZWxsKGk5MTUsIFNLTF9ESVNQX1BXX01JU0NfSU8pOworCWludGVsX3Bvd2VyX3dlbGxfZW5hYmxl
KGk5MTUsIHdlbGwpOwogCiAJbXV0ZXhfdW5sb2NrKCZwb3dlcl9kb21haW5zLT5sb2NrKTsKIAot
CWludGVsX2NkY2xrX2luaXQoZGV2X3ByaXYpOworCWludGVsX2NkY2xrX2luaXQoaTkxNSk7CiAK
LQlnZW45X2RidWZfZW5hYmxlKGRldl9wcml2KTsKKwlnZW45X2RidWZfZW5hYmxlKGk5MTUpOwog
Ci0JaWYgKHJlc3VtZSAmJiBkZXZfcHJpdi0+Y3NyLmRtY19wYXlsb2FkKQotCQlpbnRlbF9jc3Jf
bG9hZF9wcm9ncmFtKGRldl9wcml2KTsKKwlpZiAocmVzdW1lICYmIGk5MTUtPmNzci5kbWNfcGF5
bG9hZCkKKwkJaW50ZWxfY3NyX2xvYWRfcHJvZ3JhbShpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQg
c2tsX2Rpc3BsYXlfY29yZV91bmluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgc2tsX2Rpc3BsYXlfY29yZV91bmluaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlu
cyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5z
ICpwb3dlcl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7CiAJc3RydWN0IGk5MTVfcG93
ZXJfd2VsbCAqd2VsbDsKIAotCWdlbjlfc2V0X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9E
SVNBQkxFKTsKKwlnZW45X3NldF9kY19zdGF0ZShpOTE1LCBEQ19TVEFURV9ESVNBQkxFKTsKIAot
CWdlbjlfZGJ1Zl9kaXNhYmxlKGRldl9wcml2KTsKKwlnZW45X2RidWZfZGlzYWJsZShpOTE1KTsK
IAotCWludGVsX2NkY2xrX3VuaW5pdChkZXZfcHJpdik7CisJaW50ZWxfY2RjbGtfdW5pbml0KGk5
MTUpOwogCiAJLyogVGhlIHNwZWMgZG9lc24ndCBjYWxsIGZvciByZW1vdmluZyB0aGUgcmVzZXQg
aGFuZHNoYWtlIGZsYWcgKi8KIAkvKiBkaXNhYmxlIFBHMSBhbmQgTWlzYyBJL08gKi8KQEAgLTM5
NjksMjEgKzM5NjksMjEgQEAgc3RhdGljIHZvaWQgc2tsX2Rpc3BsYXlfY29yZV91bmluaXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIE5vdGUgdGhhdCBldmVuIHRob3Vn
aCB0aGUgZHJpdmVyJ3MgcmVxdWVzdCBpcyByZW1vdmVkIHBvd2VyIHdlbGwgMQogCSAqIG1heSBz
dGF5IGVuYWJsZWQgYWZ0ZXIgdGhpcyBkdWUgdG8gRE1DJ3Mgb3duIHJlcXVlc3Qgb24gaXQuCiAJ
ICovCi0Jd2VsbCA9IGxvb2t1cF9wb3dlcl93ZWxsKGRldl9wcml2LCBTS0xfRElTUF9QV18xKTsK
LQlpbnRlbF9wb3dlcl93ZWxsX2Rpc2FibGUoZGV2X3ByaXYsIHdlbGwpOworCXdlbGwgPSBsb29r
dXBfcG93ZXJfd2VsbChpOTE1LCBTS0xfRElTUF9QV18xKTsKKwlpbnRlbF9wb3dlcl93ZWxsX2Rp
c2FibGUoaTkxNSwgd2VsbCk7CiAKIAltdXRleF91bmxvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2sp
OwogCiAJdXNsZWVwX3JhbmdlKDEwLCAzMCk7CQkvKiAxMCB1cyBkZWxheSBwZXIgQnNwZWMgKi8K
IH0KIAotdm9pZCBieHRfZGlzcGxheV9jb3JlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAordm9pZCBieHRfZGlzcGxheV9jb3JlX2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCQkgICBib29sIHJlc3VtZSkKIHsKLQlzdHJ1Y3QgaTkxNV9wb3dlcl9k
b21haW5zICpwb3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dlcl9kb21haW5zOworCXN0cnVj
dCBpOTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMgPSAmaTkxNS0+cG93ZXJfZG9tYWlu
czsKIAlzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICp3ZWxsOwogCi0JZ2VuOV9zZXRfZGNfc3RhdGUo
ZGV2X3ByaXYsIERDX1NUQVRFX0RJU0FCTEUpOworCWdlbjlfc2V0X2RjX3N0YXRlKGk5MTUsIERD
X1NUQVRFX0RJU0FCTEUpOwogCiAJLyoKIAkgKiBOREVfUlNUV1JOX09QVCBSU1QgUENIIEhhbmRz
aGFrZSBFbiBtdXN0IGFsd2F5cyBiZSAwYiBvbiBCWFQKQEAgLTM5OTEsMzQgKzM5OTEsMzQgQEAg
dm9pZCBieHRfZGlzcGxheV9jb3JlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCSAqIE1vdmUgdGhlIGhhbmRzaGFrZSBwcm9ncmFtbWluZyB0byBpbml0aWFsaXphdGlv
biBzZXF1ZW5jZS4KIAkgKiBQcmV2aW91c2x5IHdhcyBsZWZ0IHVwIHRvIEJJT1MuCiAJICovCi0J
aW50ZWxfcGNoX3Jlc2V0X2hhbmRzaGFrZShkZXZfcHJpdiwgZmFsc2UpOworCWludGVsX3BjaF9y
ZXNldF9oYW5kc2hha2UoaTkxNSwgZmFsc2UpOwogCiAJLyogRW5hYmxlIFBHMSAqLwogCW11dGV4
X2xvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwogCi0Jd2VsbCA9IGxvb2t1cF9wb3dlcl93ZWxs
KGRldl9wcml2LCBTS0xfRElTUF9QV18xKTsKLQlpbnRlbF9wb3dlcl93ZWxsX2VuYWJsZShkZXZf
cHJpdiwgd2VsbCk7CisJd2VsbCA9IGxvb2t1cF9wb3dlcl93ZWxsKGk5MTUsIFNLTF9ESVNQX1BX
XzEpOworCWludGVsX3Bvd2VyX3dlbGxfZW5hYmxlKGk5MTUsIHdlbGwpOwogCiAJbXV0ZXhfdW5s
b2NrKCZwb3dlcl9kb21haW5zLT5sb2NrKTsKIAotCWludGVsX2NkY2xrX2luaXQoZGV2X3ByaXYp
OworCWludGVsX2NkY2xrX2luaXQoaTkxNSk7CiAKLQlnZW45X2RidWZfZW5hYmxlKGRldl9wcml2
KTsKKwlnZW45X2RidWZfZW5hYmxlKGk5MTUpOwogCi0JaWYgKHJlc3VtZSAmJiBkZXZfcHJpdi0+
Y3NyLmRtY19wYXlsb2FkKQotCQlpbnRlbF9jc3JfbG9hZF9wcm9ncmFtKGRldl9wcml2KTsKKwlp
ZiAocmVzdW1lICYmIGk5MTUtPmNzci5kbWNfcGF5bG9hZCkKKwkJaW50ZWxfY3NyX2xvYWRfcHJv
Z3JhbShpOTE1KTsKIH0KIAotdm9pZCBieHRfZGlzcGxheV9jb3JlX3VuaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGJ4dF9kaXNwbGF5X2NvcmVfdW5pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFp
bnMgKnBvd2VyX2RvbWFpbnMgPSAmZGV2X3ByaXYtPnBvd2VyX2RvbWFpbnM7CisJc3RydWN0IGk5
MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlucyA9ICZpOTE1LT5wb3dlcl9kb21haW5zOwog
CXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKndlbGw7CiAKLQlnZW45X3NldF9kY19zdGF0ZShkZXZf
cHJpdiwgRENfU1RBVEVfRElTQUJMRSk7CisJZ2VuOV9zZXRfZGNfc3RhdGUoaTkxNSwgRENfU1RB
VEVfRElTQUJMRSk7CiAKLQlnZW45X2RidWZfZGlzYWJsZShkZXZfcHJpdik7CisJZ2VuOV9kYnVm
X2Rpc2FibGUoaTkxNSk7CiAKLQlpbnRlbF9jZGNsa191bmluaXQoZGV2X3ByaXYpOworCWludGVs
X2NkY2xrX3VuaW5pdChpOTE1KTsKIAogCS8qIFRoZSBzcGVjIGRvZXNuJ3QgY2FsbCBmb3IgcmVt
b3ZpbmcgdGhlIHJlc2V0IGhhbmRzaGFrZSBmbGFnICovCiAKQEAgLTQwMjksNjAgKzQwMjksNjAg
QEAgdm9pZCBieHRfZGlzcGxheV9jb3JlX3VuaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJICovCiAJbXV0ZXhfbG9jaygmcG93ZXJfZG9tYWlucy0+bG9jayk7CiAKLQl3
ZWxsID0gbG9va3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIFNLTF9ESVNQX1BXXzEpOwotCWludGVs
X3Bvd2VyX3dlbGxfZGlzYWJsZShkZXZfcHJpdiwgd2VsbCk7CisJd2VsbCA9IGxvb2t1cF9wb3dl
cl93ZWxsKGk5MTUsIFNLTF9ESVNQX1BXXzEpOworCWludGVsX3Bvd2VyX3dlbGxfZGlzYWJsZShp
OTE1LCB3ZWxsKTsKIAogCW11dGV4X3VubG9jaygmcG93ZXJfZG9tYWlucy0+bG9jayk7CiAKIAl1
c2xlZXBfcmFuZ2UoMTAsIDMwKTsJCS8qIDEwIHVzIGRlbGF5IHBlciBCc3BlYyAqLwogfQogCi1z
dGF0aWMgdm9pZCBjbmxfZGlzcGxheV9jb3JlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LCBib29sIHJlc3VtZSkKK3N0YXRpYyB2b2lkIGNubF9kaXNwbGF5X2NvcmVfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgYm9vbCByZXN1bWUpCiB7Ci0Jc3RydWN0
IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlucyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9t
YWluczsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zID0gJmk5MTUt
PnBvd2VyX2RvbWFpbnM7CiAJc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqd2VsbDsKIAotCWdlbjlf
c2V0X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9ESVNBQkxFKTsKKwlnZW45X3NldF9kY19z
dGF0ZShpOTE1LCBEQ19TVEFURV9ESVNBQkxFKTsKIAogCS8qIDEuIEVuYWJsZSBQQ0ggUmVzZXQg
SGFuZHNoYWtlICovCi0JaW50ZWxfcGNoX3Jlc2V0X2hhbmRzaGFrZShkZXZfcHJpdiwgIUhBU19Q
Q0hfTk9QKGRldl9wcml2KSk7CisJaW50ZWxfcGNoX3Jlc2V0X2hhbmRzaGFrZShpOTE1LCAhSEFT
X1BDSF9OT1AoaTkxNSkpOwogCiAJLyogMi0zLiAqLwotCWludGVsX2NvbWJvX3BoeV9pbml0KGRl
dl9wcml2KTsKKwlpbnRlbF9jb21ib19waHlfaW5pdChpOTE1KTsKIAogCS8qCiAJICogNC4gRW5h
YmxlIFBvd2VyIFdlbGwgMSAoUEcxKS4KIAkgKiAgICBUaGUgQVVYIElPIHBvd2VyIHdlbGxzIHdp
bGwgYmUgZW5hYmxlZCBvbiBkZW1hbmQuCiAJICovCiAJbXV0ZXhfbG9jaygmcG93ZXJfZG9tYWlu
cy0+bG9jayk7Ci0Jd2VsbCA9IGxvb2t1cF9wb3dlcl93ZWxsKGRldl9wcml2LCBTS0xfRElTUF9Q
V18xKTsKLQlpbnRlbF9wb3dlcl93ZWxsX2VuYWJsZShkZXZfcHJpdiwgd2VsbCk7CisJd2VsbCA9
IGxvb2t1cF9wb3dlcl93ZWxsKGk5MTUsIFNLTF9ESVNQX1BXXzEpOworCWludGVsX3Bvd2VyX3dl
bGxfZW5hYmxlKGk5MTUsIHdlbGwpOwogCW11dGV4X3VubG9jaygmcG93ZXJfZG9tYWlucy0+bG9j
ayk7CiAKIAkvKiA1LiBFbmFibGUgQ0QgY2xvY2sgKi8KLQlpbnRlbF9jZGNsa19pbml0KGRldl9w
cml2KTsKKwlpbnRlbF9jZGNsa19pbml0KGk5MTUpOwogCiAJLyogNi4gRW5hYmxlIERCVUYgKi8K
LQlnZW45X2RidWZfZW5hYmxlKGRldl9wcml2KTsKKwlnZW45X2RidWZfZW5hYmxlKGk5MTUpOwog
Ci0JaWYgKHJlc3VtZSAmJiBkZXZfcHJpdi0+Y3NyLmRtY19wYXlsb2FkKQotCQlpbnRlbF9jc3Jf
bG9hZF9wcm9ncmFtKGRldl9wcml2KTsKKwlpZiAocmVzdW1lICYmIGk5MTUtPmNzci5kbWNfcGF5
bG9hZCkKKwkJaW50ZWxfY3NyX2xvYWRfcHJvZ3JhbShpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQg
Y25sX2Rpc3BsYXlfY29yZV91bmluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgY25sX2Rpc3BsYXlfY29yZV91bmluaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlu
cyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWluczsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5z
ICpwb3dlcl9kb21haW5zID0gJmk5MTUtPnBvd2VyX2RvbWFpbnM7CiAJc3RydWN0IGk5MTVfcG93
ZXJfd2VsbCAqd2VsbDsKIAotCWdlbjlfc2V0X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9E
SVNBQkxFKTsKKwlnZW45X3NldF9kY19zdGF0ZShpOTE1LCBEQ19TVEFURV9ESVNBQkxFKTsKIAog
CS8qIDEuIERpc2FibGUgYWxsIGRpc3BsYXkgZW5naW5lIGZ1bmN0aW9ucyAtPiBhcmVhZHkgZG9u
ZSAqLwogCiAJLyogMi4gRGlzYWJsZSBEQlVGICovCi0JZ2VuOV9kYnVmX2Rpc2FibGUoZGV2X3By
aXYpOworCWdlbjlfZGJ1Zl9kaXNhYmxlKGk5MTUpOwogCiAJLyogMy4gRGlzYWJsZSBDRCBjbG9j
ayAqLwotCWludGVsX2NkY2xrX3VuaW5pdChkZXZfcHJpdik7CisJaW50ZWxfY2RjbGtfdW5pbml0
KGk5MTUpOwogCiAJLyoKIAkgKiA0LiBEaXNhYmxlIFBvd2VyIFdlbGwgMSAoUEcxKS4KQEAgLTQw
OTAsNjYgKzQwOTAsNjYgQEAgc3RhdGljIHZvaWQgY25sX2Rpc3BsYXlfY29yZV91bmluaXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqICAgIGRpc2FibGVkIGF0IHRoaXMg
cG9pbnQuCiAJICovCiAJbXV0ZXhfbG9jaygmcG93ZXJfZG9tYWlucy0+bG9jayk7Ci0Jd2VsbCA9
IGxvb2t1cF9wb3dlcl93ZWxsKGRldl9wcml2LCBTS0xfRElTUF9QV18xKTsKLQlpbnRlbF9wb3dl
cl93ZWxsX2Rpc2FibGUoZGV2X3ByaXYsIHdlbGwpOworCXdlbGwgPSBsb29rdXBfcG93ZXJfd2Vs
bChpOTE1LCBTS0xfRElTUF9QV18xKTsKKwlpbnRlbF9wb3dlcl93ZWxsX2Rpc2FibGUoaTkxNSwg
d2VsbCk7CiAJbXV0ZXhfdW5sb2NrKCZwb3dlcl9kb21haW5zLT5sb2NrKTsKIAogCXVzbGVlcF9y
YW5nZSgxMCwgMzApOwkJLyogMTAgdXMgZGVsYXkgcGVyIEJzcGVjICovCiAKIAkvKiA1LiAqLwot
CWludGVsX2NvbWJvX3BoeV91bmluaXQoZGV2X3ByaXYpOworCWludGVsX2NvbWJvX3BoeV91bmlu
aXQoaTkxNSk7CiB9CiAKLXZvaWQgaWNsX2Rpc3BsYXlfY29yZV9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaWNsX2Rpc3BsYXlfY29yZV9pbml0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgYm9vbCByZXN1bWUpCiB7Ci0Jc3RydWN0IGk5
MTVfcG93ZXJfZG9tYWlucyAqcG93ZXJfZG9tYWlucyA9ICZkZXZfcHJpdi0+cG93ZXJfZG9tYWlu
czsKKwlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5zID0gJmk5MTUtPnBv
d2VyX2RvbWFpbnM7CiAJc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqd2VsbDsKIAotCWdlbjlfc2V0
X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9ESVNBQkxFKTsKKwlnZW45X3NldF9kY19zdGF0
ZShpOTE1LCBEQ19TVEFURV9ESVNBQkxFKTsKIAogCS8qIDEuIEVuYWJsZSBQQ0ggcmVzZXQgaGFu
ZHNoYWtlLiAqLwotCWludGVsX3BjaF9yZXNldF9oYW5kc2hha2UoZGV2X3ByaXYsICFIQVNfUENI
X05PUChkZXZfcHJpdikpOworCWludGVsX3BjaF9yZXNldF9oYW5kc2hha2UoaTkxNSwgIUhBU19Q
Q0hfTk9QKGk5MTUpKTsKIAogCS8qIDIuIEluaXRpYWxpemUgYWxsIGNvbWJvIHBoeXMgKi8KLQlp
bnRlbF9jb21ib19waHlfaW5pdChkZXZfcHJpdik7CisJaW50ZWxfY29tYm9fcGh5X2luaXQoaTkx
NSk7CiAKIAkvKgogCSAqIDMuIEVuYWJsZSBQb3dlciBXZWxsIDEgKFBHMSkuCiAJICogICAgVGhl
IEFVWCBJTyBwb3dlciB3ZWxscyB3aWxsIGJlIGVuYWJsZWQgb24gZGVtYW5kLgogCSAqLwogCW11
dGV4X2xvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwotCXdlbGwgPSBsb29rdXBfcG93ZXJfd2Vs
bChkZXZfcHJpdiwgU0tMX0RJU1BfUFdfMSk7Ci0JaW50ZWxfcG93ZXJfd2VsbF9lbmFibGUoZGV2
X3ByaXYsIHdlbGwpOworCXdlbGwgPSBsb29rdXBfcG93ZXJfd2VsbChpOTE1LCBTS0xfRElTUF9Q
V18xKTsKKwlpbnRlbF9wb3dlcl93ZWxsX2VuYWJsZShpOTE1LCB3ZWxsKTsKIAltdXRleF91bmxv
Y2soJnBvd2VyX2RvbWFpbnMtPmxvY2spOwogCiAJLyogNC4gRW5hYmxlIENEQ0xLLiAqLwotCWlu
dGVsX2NkY2xrX2luaXQoZGV2X3ByaXYpOworCWludGVsX2NkY2xrX2luaXQoaTkxNSk7CiAKIAkv
KiA1LiBFbmFibGUgREJVRi4gKi8KLQlpY2xfZGJ1Zl9lbmFibGUoZGV2X3ByaXYpOworCWljbF9k
YnVmX2VuYWJsZShpOTE1KTsKIAogCS8qIDYuIFNldHVwIE1CVVMuICovCi0JaWNsX21idXNfaW5p
dChkZXZfcHJpdik7CisJaWNsX21idXNfaW5pdChpOTE1KTsKIAotCWlmIChyZXN1bWUgJiYgZGV2
X3ByaXYtPmNzci5kbWNfcGF5bG9hZCkKLQkJaW50ZWxfY3NyX2xvYWRfcHJvZ3JhbShkZXZfcHJp
dik7CisJaWYgKHJlc3VtZSAmJiBpOTE1LT5jc3IuZG1jX3BheWxvYWQpCisJCWludGVsX2Nzcl9s
b2FkX3Byb2dyYW0oaTkxNSk7CiB9CiAKLXZvaWQgaWNsX2Rpc3BsYXlfY29yZV91bmluaXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpY2xfZGlzcGxheV9jb3JlX3Vu
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9wb3dl
cl9kb21haW5zICpwb3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dlcl9kb21haW5zOworCXN0
cnVjdCBpOTE1X3Bvd2VyX2RvbWFpbnMgKnBvd2VyX2RvbWFpbnMgPSAmaTkxNS0+cG93ZXJfZG9t
YWluczsKIAlzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICp3ZWxsOwogCi0JZ2VuOV9zZXRfZGNfc3Rh
dGUoZGV2X3ByaXYsIERDX1NUQVRFX0RJU0FCTEUpOworCWdlbjlfc2V0X2RjX3N0YXRlKGk5MTUs
IERDX1NUQVRFX0RJU0FCTEUpOwogCiAJLyogMS4gRGlzYWJsZSBhbGwgZGlzcGxheSBlbmdpbmUg
ZnVuY3Rpb25zIC0+IGFyZWFkeSBkb25lICovCiAKIAkvKiAyLiBEaXNhYmxlIERCVUYgKi8KLQlp
Y2xfZGJ1Zl9kaXNhYmxlKGRldl9wcml2KTsKKwlpY2xfZGJ1Zl9kaXNhYmxlKGk5MTUpOwogCiAJ
LyogMy4gRGlzYWJsZSBDRCBjbG9jayAqLwotCWludGVsX2NkY2xrX3VuaW5pdChkZXZfcHJpdik7
CisJaW50ZWxfY2RjbGtfdW5pbml0KGk5MTUpOwogCiAJLyoKIAkgKiA0LiBEaXNhYmxlIFBvd2Vy
IFdlbGwgMSAoUEcxKS4KQEAgLTQxNTcsMjAgKzQxNTcsMjAgQEAgdm9pZCBpY2xfZGlzcGxheV9j
b3JlX3VuaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogICAgZGlz
YWJsZWQgYXQgdGhpcyBwb2ludC4KIAkgKi8KIAltdXRleF9sb2NrKCZwb3dlcl9kb21haW5zLT5s
b2NrKTsKLQl3ZWxsID0gbG9va3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIFNLTF9ESVNQX1BXXzEp
OwotCWludGVsX3Bvd2VyX3dlbGxfZGlzYWJsZShkZXZfcHJpdiwgd2VsbCk7CisJd2VsbCA9IGxv
b2t1cF9wb3dlcl93ZWxsKGk5MTUsIFNLTF9ESVNQX1BXXzEpOworCWludGVsX3Bvd2VyX3dlbGxf
ZGlzYWJsZShpOTE1LCB3ZWxsKTsKIAltdXRleF91bmxvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2sp
OwogCiAJLyogNS4gKi8KLQlpbnRlbF9jb21ib19waHlfdW5pbml0KGRldl9wcml2KTsKKwlpbnRl
bF9jb21ib19waHlfdW5pbml0KGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBjaHZfcGh5X2NvbnRy
b2xfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBj
aHZfcGh5X2NvbnRyb2xfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlz
dHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpjbW5fYmMgPQotCQlsb29rdXBfcG93ZXJfd2VsbChkZXZf
cHJpdiwgVkxWX0RJU1BfUFdfRFBJT19DTU5fQkMpOworCQlsb29rdXBfcG93ZXJfd2VsbChpOTE1
LCBWTFZfRElTUF9QV19EUElPX0NNTl9CQyk7CiAJc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqY21u
X2QgPQotCQlsb29rdXBfcG93ZXJfd2VsbChkZXZfcHJpdiwgQ0hWX0RJU1BfUFdfRFBJT19DTU5f
RCk7CisJCWxvb2t1cF9wb3dlcl93ZWxsKGk5MTUsIENIVl9ESVNQX1BXX0RQSU9fQ01OX0QpOwog
CiAJLyoKIAkgKiBESVNQTEFZX1BIWV9DT05UUk9MIGNhbiBnZXQgY29ycnVwdGVkIGlmIHJlYWQu
IEFzIGEKQEAgLTQxNzksNyArNDE3OSw3IEBAIHN0YXRpYyB2b2lkIGNodl9waHlfY29udHJvbF9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBwb3dlciB3ZWxsIHN0
YXRlIGFuZCBsYW5lIHN0YXR1cyB0byByZWNvbnN0cnVjdCB0aGUKIAkgKiBleHBlY3RlZCBpbml0
aWFsIHZhbHVlLgogCSAqLwotCWRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2wgPQorCWk5MTUtPmNo
dl9waHlfY29udHJvbCA9CiAJCVBIWV9MRE9fU0VRX0RFTEFZKFBIWV9MRE9fREVMQVlfNjAwTlMs
IERQSU9fUEhZMCkgfAogCQlQSFlfTERPX1NFUV9ERUxBWShQSFlfTERPX0RFTEFZXzYwME5TLCBE
UElPX1BIWTEpIHwKIAkJUEhZX0NIX1BPV0VSX01PREUoUEhZX0NIX0RFRVBfUFNSLCBEUElPX1BI
WTAsIERQSU9fQ0gwKSB8CkBAIC00MTkzLDcgKzQxOTMsNyBAQCBzdGF0aWMgdm9pZCBjaHZfcGh5
X2NvbnRyb2xfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogb3Zl
cnJpZGUgYW5kIHNldCB0aGUgbGFuZSBwb3dlcmRvd24gYml0cyBhY2NkaW5nIHRvIHRoZQogCSAq
IGN1cnJlbnQgbGFuZSBzdGF0dXMuCiAJICovCi0JaWYgKGNtbl9iYy0+ZGVzYy0+b3BzLT5pc19l
bmFibGVkKGRldl9wcml2LCBjbW5fYmMpKSB7CisJaWYgKGNtbl9iYy0+ZGVzYy0+b3BzLT5pc19l
bmFibGVkKGk5MTUsIGNtbl9iYykpIHsKIAkJdTMyIHN0YXR1cyA9IEk5MTVfUkVBRChEUExMKFBJ
UEVfQSkpOwogCQl1bnNpZ25lZCBpbnQgbWFzazsKIApAQCAtNDIwMSwzMCArNDIwMSwzMCBAQCBz
dGF0aWMgdm9pZCBjaHZfcGh5X2NvbnRyb2xfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJCWlmIChtYXNrID09IDB4ZikKIAkJCW1hc2sgPSAweDA7CiAJCWVsc2UKLQkJ
CWRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2wgfD0KKwkJCWk5MTUtPmNodl9waHlfY29udHJvbCB8
PQogCQkJCVBIWV9DSF9QT1dFUl9ET1dOX09WUkRfRU4oRFBJT19QSFkwLCBEUElPX0NIMCk7CiAK
LQkJZGV2X3ByaXYtPmNodl9waHlfY29udHJvbCB8PQorCQlpOTE1LT5jaHZfcGh5X2NvbnRyb2wg
fD0KIAkJCVBIWV9DSF9QT1dFUl9ET1dOX09WUkQobWFzaywgRFBJT19QSFkwLCBEUElPX0NIMCk7
CiAKIAkJbWFzayA9IChzdGF0dXMgJiBEUExMX1BPUlRDX1JFQURZX01BU0spID4+IDQ7CiAJCWlm
IChtYXNrID09IDB4ZikKIAkJCW1hc2sgPSAweDA7CiAJCWVsc2UKLQkJCWRldl9wcml2LT5jaHZf
cGh5X2NvbnRyb2wgfD0KKwkJCWk5MTUtPmNodl9waHlfY29udHJvbCB8PQogCQkJCVBIWV9DSF9Q
T1dFUl9ET1dOX09WUkRfRU4oRFBJT19QSFkwLCBEUElPX0NIMSk7CiAKLQkJZGV2X3ByaXYtPmNo
dl9waHlfY29udHJvbCB8PQorCQlpOTE1LT5jaHZfcGh5X2NvbnRyb2wgfD0KIAkJCVBIWV9DSF9Q
T1dFUl9ET1dOX09WUkQobWFzaywgRFBJT19QSFkwLCBEUElPX0NIMSk7CiAKLQkJZGV2X3ByaXYt
PmNodl9waHlfY29udHJvbCB8PSBQSFlfQ09NX0xBTkVfUkVTRVRfREVBU1NFUlQoRFBJT19QSFkw
KTsKKwkJaTkxNS0+Y2h2X3BoeV9jb250cm9sIHw9IFBIWV9DT01fTEFORV9SRVNFVF9ERUFTU0VS
VChEUElPX1BIWTApOwogCi0JCWRldl9wcml2LT5jaHZfcGh5X2Fzc2VydFtEUElPX1BIWTBdID0g
ZmFsc2U7CisJCWk5MTUtPmNodl9waHlfYXNzZXJ0W0RQSU9fUEhZMF0gPSBmYWxzZTsKIAl9IGVs
c2UgewotCQlkZXZfcHJpdi0+Y2h2X3BoeV9hc3NlcnRbRFBJT19QSFkwXSA9IHRydWU7CisJCWk5
MTUtPmNodl9waHlfYXNzZXJ0W0RQSU9fUEhZMF0gPSB0cnVlOwogCX0KIAotCWlmIChjbW5fZC0+
ZGVzYy0+b3BzLT5pc19lbmFibGVkKGRldl9wcml2LCBjbW5fZCkpIHsKKwlpZiAoY21uX2QtPmRl
c2MtPm9wcy0+aXNfZW5hYmxlZChpOTE1LCBjbW5fZCkpIHsKIAkJdTMyIHN0YXR1cyA9IEk5MTVf
UkVBRChEUElPX1BIWV9TVEFUVVMpOwogCQl1bnNpZ25lZCBpbnQgbWFzazsKIApAQCAtNDIzMyw0
MiArNDIzMyw0MiBAQCBzdGF0aWMgdm9pZCBjaHZfcGh5X2NvbnRyb2xfaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWlmIChtYXNrID09IDB4ZikKIAkJCW1hc2sgPSAw
eDA7CiAJCWVsc2UKLQkJCWRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2wgfD0KKwkJCWk5MTUtPmNo
dl9waHlfY29udHJvbCB8PQogCQkJCVBIWV9DSF9QT1dFUl9ET1dOX09WUkRfRU4oRFBJT19QSFkx
LCBEUElPX0NIMCk7CiAKLQkJZGV2X3ByaXYtPmNodl9waHlfY29udHJvbCB8PQorCQlpOTE1LT5j
aHZfcGh5X2NvbnRyb2wgfD0KIAkJCVBIWV9DSF9QT1dFUl9ET1dOX09WUkQobWFzaywgRFBJT19Q
SFkxLCBEUElPX0NIMCk7CiAKLQkJZGV2X3ByaXYtPmNodl9waHlfY29udHJvbCB8PSBQSFlfQ09N
X0xBTkVfUkVTRVRfREVBU1NFUlQoRFBJT19QSFkxKTsKKwkJaTkxNS0+Y2h2X3BoeV9jb250cm9s
IHw9IFBIWV9DT01fTEFORV9SRVNFVF9ERUFTU0VSVChEUElPX1BIWTEpOwogCi0JCWRldl9wcml2
LT5jaHZfcGh5X2Fzc2VydFtEUElPX1BIWTFdID0gZmFsc2U7CisJCWk5MTUtPmNodl9waHlfYXNz
ZXJ0W0RQSU9fUEhZMV0gPSBmYWxzZTsKIAl9IGVsc2UgewotCQlkZXZfcHJpdi0+Y2h2X3BoeV9h
c3NlcnRbRFBJT19QSFkxXSA9IHRydWU7CisJCWk5MTUtPmNodl9waHlfYXNzZXJ0W0RQSU9fUEhZ
MV0gPSB0cnVlOwogCX0KIAotCUk5MTVfV1JJVEUoRElTUExBWV9QSFlfQ09OVFJPTCwgZGV2X3By
aXYtPmNodl9waHlfY29udHJvbCk7CisJSTkxNV9XUklURShESVNQTEFZX1BIWV9DT05UUk9MLCBp
OTE1LT5jaHZfcGh5X2NvbnRyb2wpOwogCiAJRFJNX0RFQlVHX0tNUygiSW5pdGlhbCBQSFlfQ09O
VFJPTD0weCUwOHhcbiIsCi0JCSAgICAgIGRldl9wcml2LT5jaHZfcGh5X2NvbnRyb2wpOworCQkg
ICAgICBpOTE1LT5jaHZfcGh5X2NvbnRyb2wpOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfY21ubGFu
ZV93YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB2bHZf
Y21ubGFuZV93YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaTkx
NV9wb3dlcl93ZWxsICpjbW4gPQotCQlsb29rdXBfcG93ZXJfd2VsbChkZXZfcHJpdiwgVkxWX0RJ
U1BfUFdfRFBJT19DTU5fQkMpOworCQlsb29rdXBfcG93ZXJfd2VsbChpOTE1LCBWTFZfRElTUF9Q
V19EUElPX0NNTl9CQyk7CiAJc3RydWN0IGk5MTVfcG93ZXJfd2VsbCAqZGlzcDJkID0KLQkJbG9v
a3VwX3Bvd2VyX3dlbGwoZGV2X3ByaXYsIFZMVl9ESVNQX1BXX0RJU1AyRCk7CisJCWxvb2t1cF9w
b3dlcl93ZWxsKGk5MTUsIFZMVl9ESVNQX1BXX0RJU1AyRCk7CiAKIAkvKiBJZiB0aGUgZGlzcGxh
eSBtaWdodCBiZSBhbHJlYWR5IGFjdGl2ZSBza2lwIHRoaXMgKi8KLQlpZiAoY21uLT5kZXNjLT5v
cHMtPmlzX2VuYWJsZWQoZGV2X3ByaXYsIGNtbikgJiYKLQkgICAgZGlzcDJkLT5kZXNjLT5vcHMt
PmlzX2VuYWJsZWQoZGV2X3ByaXYsIGRpc3AyZCkgJiYKKwlpZiAoY21uLT5kZXNjLT5vcHMtPmlz
X2VuYWJsZWQoaTkxNSwgY21uKSAmJgorCSAgICBkaXNwMmQtPmRlc2MtPm9wcy0+aXNfZW5hYmxl
ZChpOTE1LCBkaXNwMmQpICYmCiAJICAgIEk5MTVfUkVBRChEUElPX0NUTCkgJiBEUElPX0NNTlJT
VCkKIAkJcmV0dXJuOwogCiAJRFJNX0RFQlVHX0tNUygidG9nZ2xpbmcgZGlzcGxheSBQSFkgc2lk
ZSByZXNldFxuIik7CiAKIAkvKiBjbW5sYW5lIG5lZWRzIERQTEwgcmVnaXN0ZXJzICovCi0JZGlz
cDJkLT5kZXNjLT5vcHMtPmVuYWJsZShkZXZfcHJpdiwgZGlzcDJkKTsKKwlkaXNwMmQtPmRlc2Mt
Pm9wcy0+ZW5hYmxlKGk5MTUsIGRpc3AyZCk7CiAKIAkvKgogCSAqIEZyb20gVkxWMkEwX0RQX2VE
UF9IRE1JX0RQSU9fZHJpdmVyX3ZiaW9zX25vdGVzXzExLmRvY3g6CkBAIC00Mjc3LDI3ICs0Mjc3
LDI3IEBAIHN0YXRpYyB2b2lkIHZsdl9jbW5sYW5lX3dhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAkgKiBTaW1wbHkgdW5nYXRpbmcgaXNuJ3QgZW5vdWdoIHRvIHJlc2V0IHRo
ZSBQSFkgZW5vdWdoIHRvIGdldAogCSAqIHBvcnRzIGFuZCBsYW5lcyBydW5uaW5nLgogCSAqLwot
CWNtbi0+ZGVzYy0+b3BzLT5kaXNhYmxlKGRldl9wcml2LCBjbW4pOworCWNtbi0+ZGVzYy0+b3Bz
LT5kaXNhYmxlKGk5MTUsIGNtbik7CiB9CiAKLXN0YXRpYyBib29sIHZsdl9wdW5pdF9pc19wb3dl
cl9nYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiByZWcwKQorc3Rh
dGljIGJvb2wgdmx2X3B1bml0X2lzX3Bvd2VyX2dhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCB1MzIgcmVnMCkKIHsKIAlib29sIHJldDsKIAotCXZsdl9wdW5pdF9nZXQoZGV2X3By
aXYpOwotCXJldCA9ICh2bHZfcHVuaXRfcmVhZChkZXZfcHJpdiwgcmVnMCkgJiBTU1BNMF9TU0Nf
TUFTSykgPT0gU1NQTTBfU1NDX1BXUl9HQVRFOwotCXZsdl9wdW5pdF9wdXQoZGV2X3ByaXYpOwor
CXZsdl9wdW5pdF9nZXQoaTkxNSk7CisJcmV0ID0gKHZsdl9wdW5pdF9yZWFkKGk5MTUsIHJlZzAp
ICYgU1NQTTBfU1NDX01BU0spID09IFNTUE0wX1NTQ19QV1JfR0FURTsKKwl2bHZfcHVuaXRfcHV0
KGk5MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgYXNzZXJ0X3ZlZF9wb3dl
cl9nYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBh
c3NlcnRfdmVkX3Bvd2VyX2dhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CVdBUk4oIXZsdl9wdW5pdF9pc19wb3dlcl9nYXRlZChkZXZfcHJpdiwgUFVOSVRfUkVHX1ZFRFNT
UE0wKSwKKwlXQVJOKCF2bHZfcHVuaXRfaXNfcG93ZXJfZ2F0ZWQoaTkxNSwgUFVOSVRfUkVHX1ZF
RFNTUE0wKSwKIAkgICAgICJWRUQgbm90IHBvd2VyIGdhdGVkXG4iKTsKIH0KIAotc3RhdGljIHZv
aWQgYXNzZXJ0X2lzcF9wb3dlcl9nYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdm9pZCBhc3NlcnRfaXNwX3Bvd2VyX2dhdGVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgcGNpX2RldmljZV9pZCBpc3Bf
aWRzW10gPSB7CiAJCXtQQ0lfREVWSUNFKFBDSV9WRU5ET1JfSURfSU5URUwsIDB4MGYzOCl9LApA
QCAtNDMwNiwxMSArNDMwNiwxMSBAQCBzdGF0aWMgdm9pZCBhc3NlcnRfaXNwX3Bvd2VyX2dhdGVk
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9OwogCiAJV0FSTighcGNpX2Rl
dl9wcmVzZW50KGlzcF9pZHMpICYmCi0JICAgICAhdmx2X3B1bml0X2lzX3Bvd2VyX2dhdGVkKGRl
dl9wcml2LCBQVU5JVF9SRUdfSVNQU1NQTTApLAorCSAgICAgIXZsdl9wdW5pdF9pc19wb3dlcl9n
YXRlZChpOTE1LCBQVU5JVF9SRUdfSVNQU1NQTTApLAogCSAgICAgIklTUCBub3QgcG93ZXIgZ2F0
ZWRcbiIpOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wb3dlcl9kb21haW5zX3ZlcmlmeV9zdGF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworc3RhdGljIHZvaWQgaW50ZWxf
cG93ZXJfZG9tYWluc192ZXJpZnlfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
OwogCiAvKioKICAqIGludGVsX3Bvd2VyX2RvbWFpbnNfaW5pdF9odyAtIGluaXRpYWxpemUgaGFy
ZHdhcmUgcG93ZXIgZG9tYWluIHN0YXRlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNw
bGF5X3Bvd2VyLmgKaW5kZXggZmY1N2IwYTdmZTU5Li4wMzEwZmUxMTRlY2MgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXlfcG93ZXIuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmgKQEAgLTgwLDIzICs4MCwyMyBAQCBz
dHJ1Y3QgaTkxNV9wb3dlcl93ZWxsX29wcyB7CiAJICogZHVyaW5nIGRyaXZlciBpbml0IGFuZCBy
ZXN1bWUgdGltZSwgcG9zc2libHkgYWZ0ZXIgZmlyc3QgY2FsbGluZwogCSAqIHRoZSBlbmFibGUv
ZGlzYWJsZSBoYW5kbGVycy4KIAkgKi8KLQl2b2lkICgqc3luY19odykoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorCXZvaWQgKCpzeW5jX2h3KShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwpOwogCS8q
CiAJICogRW5hYmxlIHRoZSB3ZWxsIGFuZCByZXNvdXJjZXMgdGhhdCBkZXBlbmQgb24gaXQgKGZv
ciBleGFtcGxlCiAJICogaW50ZXJydXB0cyBsb2NhdGVkIG9uIHRoZSB3ZWxsKS4gQ2FsbGVkIGFm
dGVyIHRoZSAwLT4xIHJlZmNvdW50CiAJICogdHJhbnNpdGlvbi4KIAkgKi8KLQl2b2lkICgqZW5h
YmxlKShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJdm9pZCAoKmVuYWJsZSko
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAgICBzdHJ1Y3QgaTkxNV9wb3dl
cl93ZWxsICpwb3dlcl93ZWxsKTsKIAkvKgogCSAqIERpc2FibGUgdGhlIHdlbGwgYW5kIHJlc291
cmNlcyB0aGF0IGRlcGVuZCBvbiBpdC4gQ2FsbGVkIGFmdGVyCiAJICogdGhlIDEtPjAgcmVmY291
bnQgdHJhbnNpdGlvbi4KIAkgKi8KLQl2b2lkICgqZGlzYWJsZSkoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorCXZvaWQgKCpkaXNhYmxlKShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCXN0cnVjdCBpOTE1X3Bvd2VyX3dlbGwgKnBvd2VyX3dlbGwpOwogCS8qIFJl
dHVybnMgdGhlIGh3IGVuYWJsZWQgc3RhdGUuICovCi0JYm9vbCAoKmlzX2VuYWJsZWQpKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwlib29sICgqaXNfZW5hYmxlZCkoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBzdHJ1Y3QgaTkxNV9wb3dlcl93ZWxsICpw
b3dlcl93ZWxsKTsKIH07CiAKQEAgLTIwNCw0OCArMjA0LDQ4IEBAIHN0cnVjdCBpOTE1X3Bvd2Vy
X2RvbWFpbnMgewogCWZvcl9lYWNoX3Bvd2VyX3dlbGxfcmV2ZXJzZShfX2Rldl9wcml2LCBfX3Bv
d2VyX3dlbGwpCQkgICAgICAgIFwKIAkJZm9yX2VhY2hfaWYoKF9fcG93ZXJfd2VsbCktPmRlc2Mt
PmRvbWFpbnMgJiAoX19kb21haW5fbWFzaykpCiAKLXZvaWQgc2tsX2VuYWJsZV9kYzYoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgZ2VuOV9zYW5pdGl6ZV9kY19zdGF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBieHRfZW5hYmxlX2Rj
OShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBieHRfZGlzYWJsZV9k
Yzkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgZ2VuOV9lbmFibGVf
ZGM1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIHNrbF9lbmFibGVf
ZGM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgZ2VuOV9zYW5pdGl6ZV9k
Y19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGJ4dF9lbmFibGVf
ZGM5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgYnh0X2Rpc2FibGVfZGM5
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgZ2VuOV9lbmFibGVfZGM1KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAotaW50IGludGVsX3Bvd2VyX2RvbWFpbnNf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9wb3dl
cl9kb21haW5zX2NsZWFudXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZv
aWQgaW50ZWxfcG93ZXJfZG9tYWluc19pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgYm9vbCByZXN1bWUpOwotdm9pZCBpbnRlbF9wb3dlcl9kb21haW5zX2ZpbmlfaHco
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaWNsX2Rpc3BsYXlfY29y
ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCByZXN1bWUpOwot
dm9pZCBpY2xfZGlzcGxheV9jb3JlX3VuaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwotdm9pZCBpbnRlbF9wb3dlcl9kb21haW5zX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9wb3dlcl9kb21haW5zX2Rpc2FibGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfcG93ZXJfZG9tYWlu
c19zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludCBpbnRlbF9w
b3dlcl9kb21haW5zX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBp
bnRlbF9wb3dlcl9kb21haW5zX2NsZWFudXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Owordm9pZCBpbnRlbF9wb3dlcl9kb21haW5zX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIGJvb2wgcmVzdW1lKTsKK3ZvaWQgaW50ZWxfcG93ZXJfZG9tYWluc19maW5pX2h3
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaWNsX2Rpc3BsYXlfY29yZV9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29sIHJlc3VtZSk7Cit2b2lkIGlj
bF9kaXNwbGF5X2NvcmVfdW5pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3Zv
aWQgaW50ZWxfcG93ZXJfZG9tYWluc19lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpOwordm9pZCBpbnRlbF9wb3dlcl9kb21haW5zX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOwordm9pZCBpbnRlbF9wb3dlcl9kb21haW5zX3N1c3BlbmQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJIGVudW0gaTkxNV9kcm1fc3VzcGVuZF9tb2RlKTsK
LXZvaWQgaW50ZWxfcG93ZXJfZG9tYWluc19yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKLXZvaWQgaHN3X2VuYWJsZV9wYzgoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKLXZvaWQgaHN3X2Rpc2FibGVfcGM4KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7Ci12b2lkIGJ4dF9kaXNwbGF5X2NvcmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgcmVzdW1lKTsKLXZvaWQgYnh0X2Rpc3BsYXlfY29yZV91
bmluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfcG93
ZXJfZG9tYWluc19yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBo
c3dfZW5hYmxlX3BjOChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGhzd19k
aXNhYmxlX3BjOChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGJ4dF9kaXNw
bGF5X2NvcmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgYm9vbCByZXN1bWUp
Owordm9pZCBieHRfZGlzcGxheV9jb3JlX3VuaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSk7CiAKIGNvbnN0IGNoYXIgKgogaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW5fc3RyKGVu
dW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gZG9tYWluKTsKIAotYm9vbCBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2lzX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
Ym9vbCBpbnRlbF9kaXNwbGF5X3Bvd2VyX2lzX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICAgIGVudW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gZG9tYWlu
KTsKLWJvb2wgX19pbnRlbF9kaXNwbGF5X3Bvd2VyX2lzX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorYm9vbCBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfaXNfZW5hYmxl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICBlbnVtIGludGVsX2Rp
c3BsYXlfcG93ZXJfZG9tYWluIGRvbWFpbik7Ci1pbnRlbF93YWtlcmVmX3QgaW50ZWxfZGlzcGxh
eV9wb3dlcl9nZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50ZWxfd2Fr
ZXJlZl90IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCQllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIGRvbWFpbik7CiBpbnRl
bF93YWtlcmVmX3QKLWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5h
YmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBlbnVtIGludGVsX2Rp
c3BsYXlfcG93ZXJfZG9tYWluIGRvbWFpbik7Ci12b2lkIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0
X3VuY2hlY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVs
X2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkgICAgICAgZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBkb21haW4pOwog
dm9pZCBfX2ludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2FzeW5jKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJCSAgICAgZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBkb21h
aW4sCiAJCQkJICAgICBpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZik7CiB2b2lkIGludGVsX2Rpc3Bs
YXlfcG93ZXJfZmx1c2hfd29yayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAjaWYg
SVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfUlVOVElNRV9QTSkKLXZvaWQgaW50ZWxf
ZGlzcGxheV9wb3dlcl9wdXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9p
ZCBpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgICAgZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBkb21haW4sCiAJCQkgICAg
IGludGVsX3dha2VyZWZfdCB3YWtlcmVmKTsKIHN0YXRpYyBpbmxpbmUgdm9pZApAQCAtMjc3LDEy
ICsyNzcsMTIgQEAgaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfYXN5bmMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJZm9yICgod2YpID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoKGk5
MTUpLCAoZG9tYWluKSk7ICh3Zik7IFwKIAkgICAgIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2Fz
eW5jKChpOTE1KSwgKGRvbWFpbiksICh3ZikpLCAod2YpID0gMCkKIAotdm9pZCBpY2xfZGJ1Zl9z
bGljZXNfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaWNs
X2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAg
ICB1OCByZXFfc2xpY2VzKTsKIAogdm9pZCBjaHZfcGh5X3Bvd2VyZ2F0ZV9sYW5lcyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgYm9vbCBvdmVycmlkZSwgdW5zaWduZWQg
aW50IG1hc2spOwotYm9vbCBjaHZfcGh5X3Bvd2VyZ2F0ZV9jaChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIGVudW0gZHBpb19waHkgcGh5LAorYm9vbCBjaHZfcGh5X3Bvd2VyZ2F0
ZV9jaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBkcGlvX3BoeSBwaHksCiAJ
CQkgIGVudW0gZHBpb19jaGFubmVsIGNoLCBib29sIG92ZXJyaWRlKTsKIAogI2VuZGlmIC8qIF9f
SU5URUxfRElTUExBWV9QT1dFUl9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2RwLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcC5jCmluZGV4IDQz
MzZkZjQ2ZmU3OC4uZDRkYzJiOTUwNmU1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9kcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwLmMKQEAgLTE2
MCw3ICsxNjAsNyBAQCBzdGF0aWMgYm9vbCBlZHBfcGFuZWxfdmRkX29uKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApOwogc3RhdGljIHZvaWQgZWRwX3BhbmVsX3ZkZF9vZmYoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwgYm9vbCBzeW5jKTsKIHN0YXRpYyB2b2lkIHZsdl9pbml0X3BhbmVsX3Bv
d2VyX3NlcXVlbmNlcihzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJICAgY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwotc3RhdGljIHZvaWQgdmx2
X3N0ZWFsX3Bvd2VyX3NlcXVlbmNlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitzdGF0aWMgdm9pZCB2bHZfc3RlYWxfcG93ZXJfc2VxdWVuY2VyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSAgICAgIGVudW0gcGlwZSBwaXBlKTsKIHN0YXRpYyB2b2lkIGlu
dGVsX2RwX3Vuc2V0X2VkaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7CiAKQEAgLTIxNCw4
ICsyMTQsOCBAQCBzdGF0aWMgaW50IGludGVsX2RwX21heF9jb21tb25fcmF0ZShzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQogc3RhdGljIGludCBpbnRlbF9kcF9nZXRfZmlhX3N1cHBvcnRlZF9s
YW5lX2NvdW50KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGludGVsX2Rp
Z2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNl
LmRldik7Ci0JZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0X3RvX3RjKGRldl9wcml2
LCBkaWdfcG9ydC0+YmFzZS5wb3J0KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOworCWVudW0gdGNfcG9ydCB0Y19wb3J0
ID0gaW50ZWxfcG9ydF90b190YyhpOTE1LCBkaWdfcG9ydC0+YmFzZS5wb3J0KTsKIAlpbnRlbF93
YWtlcmVmX3Qgd2FrZXJlZjsKIAl1MzIgbGFuZV9pbmZvOwogCkBAIC0yMjMsNyArMjIzLDcgQEAg
c3RhdGljIGludCBpbnRlbF9kcF9nZXRfZmlhX3N1cHBvcnRlZF9sYW5lX2NvdW50KHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCiAJCXJldHVybiA0OwogCiAJbGFuZV9pbmZvID0gMDsKLQl3aXRo
X2ludGVsX2Rpc3BsYXlfcG93ZXIoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUs
IHdha2VyZWYpCisJd2l0aF9pbnRlbF9kaXNwbGF5X3Bvd2VyKGk5MTUsIFBPV0VSX0RPTUFJTl9E
SVNQTEFZX0NPUkUsIHdha2VyZWYpCiAJCWxhbmVfaW5mbyA9IChJOTE1X1JFQUQoUE9SVF9UWF9E
RkxFWERQU1ApICYKIAkJCSAgICAgRFBfTEFORV9BU1NJR05NRU5UX01BU0sodGNfcG9ydCkpID4+
CiAJCQkJRFBfTEFORV9BU1NJR05NRU5UX1NISUZUKHRjX3BvcnQpOwpAQCAtMjg0LDggKzI4NCw4
IEBAIGludGVsX2RwX2Rvd25zdHJlYW1fbWF4X2RvdGNsb2NrKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBk
cF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIg
PSAmaW50ZWxfZGlnX3BvcnQtPmJhc2U7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0JaW50IG1heF9kb3RjbGsgPSBkZXZf
cHJpdi0+bWF4X2RvdGNsa19mcmVxOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJaW50IG1heF9kb3RjbGsgPSBpOTE1LT5tYXhf
ZG90Y2xrX2ZyZXE7CiAJaW50IGRzX21heF9kb3RjbGs7CiAKIAlpbnQgdHlwZSA9IGludGVsX2Rw
LT5kb3duc3RyZWFtX3BvcnRzWzBdICYgRFBfRFNfUE9SVF9UWVBFX01BU0s7CkBAIC0zMDUsNyAr
MzA1LDcgQEAgaW50ZWxfZHBfZG93bnN0cmVhbV9tYXhfZG90Y2xvY2soc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIHN0YXRpYyBpbnQgY25sX21heF9zb3VyY2VfcmF0ZShzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0g
ZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CiAJZW51
bSBwb3J0IHBvcnQgPSBkaWdfcG9ydC0+YmFzZS5wb3J0OwogCiAJdTMyIHZvbHRhZ2UgPSBJOTE1
X1JFQUQoQ05MX1BPUlRfQ09NUF9EVzMpICYgVk9MVEFHRV9JTkZPX01BU0s7CkBAIC0zMTUsNyAr
MzE1LDcgQEAgc3RhdGljIGludCBjbmxfbWF4X3NvdXJjZV9yYXRlKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCiAJCXJldHVybiA1NDAwMDA7CiAKIAkvKiBGb3IgdGhpcyBTS1UgOC4xRyBpcyBz
dXBwb3J0ZWQgaW4gYWxsIHBvcnRzICovCi0JaWYgKElTX0NOTF9XSVRIX1BPUlRfRihkZXZfcHJp
dikpCisJaWYgKElTX0NOTF9XSVRIX1BPUlRfRihpOTE1KSkKIAkJcmV0dXJuIDgxMDAwMDsKIAog
CS8qIEZvciBvdGhlciBTS1VzLCBtYXggcmF0ZSBvbiBwb3J0cyBBIGFuZCBEIGlzIDUuNEcgKi8K
QEAgLTMyOCwxMSArMzI4LDExIEBAIHN0YXRpYyBpbnQgY25sX21heF9zb3VyY2VfcmF0ZShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogc3RhdGljIGludCBpY2xfbWF4X3NvdXJjZV9yYXRlKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
ZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2Uu
ZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGRpZ19wb3J0LT5iYXNlLnBvcnQ7CiAKLQlpZiAoaW50
ZWxfcG9ydF9pc19jb21ib3BoeShkZXZfcHJpdiwgcG9ydCkgJiYKLQkgICAgIUlTX0VMS0hBUlRM
QUtFKGRldl9wcml2KSAmJgorCWlmIChpbnRlbF9wb3J0X2lzX2NvbWJvcGh5KGk5MTUsIHBvcnQp
ICYmCisJICAgICFJU19FTEtIQVJUTEFLRShpOTE1KSAmJgogCSAgICAhaW50ZWxfZHBfaXNfZWRw
KGludGVsX2RwKSkKIAkJcmV0dXJuIDU0MDAwMDsKIApAQCAtMzU5LDMwICszNTksMzAgQEAgaW50
ZWxfZHBfc2V0X3NvdXJjZV9yYXRlcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkxNjIw
MDAsIDI3MDAwMAogCX07CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBk
cF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKIAljb25z
dCBzdHJ1Y3QgZGRpX3ZidF9wb3J0X2luZm8gKmluZm8gPQotCQkmZGV2X3ByaXYtPnZidC5kZGlf
cG9ydF9pbmZvW2RpZ19wb3J0LT5iYXNlLnBvcnRdOworCQkmaTkxNS0+dmJ0LmRkaV9wb3J0X2lu
Zm9bZGlnX3BvcnQtPmJhc2UucG9ydF07CiAJY29uc3QgaW50ICpzb3VyY2VfcmF0ZXM7CiAJaW50
IHNpemUsIG1heF9yYXRlID0gMCwgdmJ0X21heF9yYXRlID0gaW5mby0+ZHBfbWF4X2xpbmtfcmF0
ZTsKIAogCS8qIFRoaXMgc2hvdWxkIG9ubHkgYmUgZG9uZSBvbmNlICovCiAJV0FSTl9PTihpbnRl
bF9kcC0+c291cmNlX3JhdGVzIHx8IGludGVsX2RwLT5udW1fc291cmNlX3JhdGVzKTsKIAotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAx
MCkgewogCQlzb3VyY2VfcmF0ZXMgPSBjbmxfcmF0ZXM7CiAJCXNpemUgPSBBUlJBWV9TSVpFKGNu
bF9yYXRlcyk7Ci0JCWlmIChJU19HRU4oZGV2X3ByaXYsIDEwKSkKKwkJaWYgKElTX0dFTihpOTE1
LCAxMCkpCiAJCQltYXhfcmF0ZSA9IGNubF9tYXhfc291cmNlX3JhdGUoaW50ZWxfZHApOwogCQll
bHNlCiAJCQltYXhfcmF0ZSA9IGljbF9tYXhfc291cmNlX3JhdGUoaW50ZWxfZHApOwotCX0gZWxz
ZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0dFTjlfTFAoaTkx
NSkpIHsKIAkJc291cmNlX3JhdGVzID0gYnh0X3JhdGVzOwogCQlzaXplID0gQVJSQVlfU0laRShi
eHRfcmF0ZXMpOwotCX0gZWxzZSBpZiAoSVNfR0VOOV9CQyhkZXZfcHJpdikpIHsKKwl9IGVsc2Ug
aWYgKElTX0dFTjlfQkMoaTkxNSkpIHsKIAkJc291cmNlX3JhdGVzID0gc2tsX3JhdGVzOwogCQlz
aXplID0gQVJSQVlfU0laRShza2xfcmF0ZXMpOwotCX0gZWxzZSBpZiAoKElTX0hBU1dFTEwoZGV2
X3ByaXYpICYmICFJU19IU1dfVUxYKGRldl9wcml2KSkgfHwKLQkJICAgSVNfQlJPQURXRUxMKGRl
dl9wcml2KSkgeworCX0gZWxzZSBpZiAoKElTX0hBU1dFTEwoaTkxNSkgJiYgIUlTX0hTV19VTFgo
aTkxNSkpIHx8CisJCSAgIElTX0JST0FEV0VMTChpOTE1KSkgewogCQlzb3VyY2VfcmF0ZXMgPSBo
c3dfcmF0ZXM7CiAJCXNpemUgPSBBUlJBWV9TSVpFKGhzd19yYXRlcyk7CiAJfSBlbHNlIHsKQEAg
LTUzMiw3ICs1MzIsNyBAQCBpbnRlbF9kcF9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IsCiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGludGVsX2F0dGFjaGVk
X2RwKGNvbm5lY3Rvcik7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9y
ID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3Rvcik7CiAJc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmZpeGVkX21vZGUgPSBpbnRlbF9jb25uZWN0b3ItPnBhbmVsLmZpeGVkX21vZGU7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2
KTsKIAlpbnQgdGFyZ2V0X2Nsb2NrID0gbW9kZS0+Y2xvY2s7CiAJaW50IG1heF9yYXRlLCBtb2Rl
X3JhdGUsIG1heF9sYW5lcywgbWF4X2xpbmtfY2xvY2s7CiAJaW50IG1heF9kb3RjbGs7CkBAIC01
NjQsNyArNTY0LDcgQEAgaW50ZWxfZHBfbW9kZV92YWxpZChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAq
Y29ubmVjdG9yLAogCSAqIE91dHB1dCBicHAgaXMgc3RvcmVkIGluIDYuNCBmb3JtYXQgc28gcmln
aHQgc2hpZnQgYnkgNCB0byBnZXQgdGhlCiAJICogaW50ZWdlciB2YWx1ZSBzaW5jZSB3ZSBzdXBw
b3J0IG9ubHkgaW50ZWdlciB2YWx1ZXMgb2YgYnBwLgogCSAqLwotCWlmICgoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgJiYKKwlpZiAoKElOVEVM
X0dFTihpOTE1KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGk5MTUpKSAmJgogCSAgICBkcm1fZHBf
c2lua19zdXBwb3J0c19kc2MoaW50ZWxfZHAtPmRzY19kcGNkKSkgewogCQlpZiAoaW50ZWxfZHBf
aXNfZWRwKGludGVsX2RwKSkgewogCQkJZHNjX21heF9vdXRwdXRfYnBwID0KQEAgLTYzMCwxNyAr
NjMwLDE3IEBAIGludGVsX2RwX3Bwc19pbml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwog
c3RhdGljIGludGVsX3dha2VyZWZfdAogcHBzX2xvY2soc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50
ZWxfZHApOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCiAJLyoKIAkgKiBTZWUgaW50ZWxf
cG93ZXJfc2VxdWVuY2VyX3Jlc2V0KCkgd2h5IHdlIG5lZWQKIAkgKiBhIHBvd2VyIGRvbWFpbiBy
ZWZlcmVuY2UgaGVyZS4KIAkgKi8KLQl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQo
ZGV2X3ByaXYsCisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGk5MTUsCiAJCQkJ
CSAgaW50ZWxfYXV4X3Bvd2VyX2RvbWFpbihkcF90b19kaWdfcG9ydChpbnRlbF9kcCkpKTsKIAot
CW11dGV4X2xvY2soJmRldl9wcml2LT5wcHNfbXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPnBw
c19tdXRleCk7CiAKIAlyZXR1cm4gd2FrZXJlZjsKIH0KQEAgLTY0OCwxMCArNjQ4LDEwIEBAIHBw
c19sb2NrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiBzdGF0aWMgaW50ZWxfd2FrZXJlZl90
CiBwcHNfdW5sb2NrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludGVsX3dha2VyZWZfdCB3
YWtlcmVmKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5
MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wcHNfbXV0ZXgpOwotCWlu
dGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LAorCW11dGV4X3VubG9jaygmaTkxNS0+cHBz
X211dGV4KTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LAogCQkJCWludGVsX2F1eF9w
b3dlcl9kb21haW4oZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApKSwKIAkJCQl3YWtlcmVmKTsKIAly
ZXR1cm4gMDsKQEAgLTY2Myw3ICs2NjMsNyBAQCBwcHNfdW5sb2NrKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsIGludGVsX3dha2VyZWZfdCB3YWtlcmVmKQogc3RhdGljIHZvaWQKIHZsdl9wb3dl
cl9zZXF1ZW5jZXJfa2ljayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0
IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRl
bF9kcCk7CiAJZW51bSBwaXBlIHBpcGUgPSBpbnRlbF9kcC0+cHBzX3BpcGU7CiAJYm9vbCBwbGxf
ZW5hYmxlZCwgcmVsZWFzZV9jbF9vdmVycmlkZSA9IGZhbHNlOwpAQCAtNjg3LDcgKzY4Nyw3IEBA
IHZsdl9wb3dlcl9zZXF1ZW5jZXJfa2ljayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCURQ
IHw9IERQX1BPUlRfV0lEVEgoMSk7CiAJRFAgfD0gRFBfTElOS19UUkFJTl9QQVRfMTsKIAotCWlm
IChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKKwlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJ
RFAgfD0gRFBfUElQRV9TRUxfQ0hWKHBpcGUpOwogCWVsc2UKIAkJRFAgfD0gRFBfUElQRV9TRUwo
cGlwZSk7CkBAIC02OTksMTAgKzY5OSwxMCBAQCB2bHZfcG93ZXJfc2VxdWVuY2VyX2tpY2soc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkgKiBTbyBlbmFibGUgdGVtcG9yYXJpbHkgaXQgaWYg
aXQncyBub3QgYWxyZWFkeSBlbmFibGVkLgogCSAqLwogCWlmICghcGxsX2VuYWJsZWQpIHsKLQkJ
cmVsZWFzZV9jbF9vdmVycmlkZSA9IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpICYmCi0JCQkhY2h2
X3BoeV9wb3dlcmdhdGVfY2goZGV2X3ByaXYsIHBoeSwgY2gsIHRydWUpOworCQlyZWxlYXNlX2Ns
X292ZXJyaWRlID0gSVNfQ0hFUlJZVklFVyhpOTE1KSAmJgorCQkJIWNodl9waHlfcG93ZXJnYXRl
X2NoKGk5MTUsIHBoeSwgY2gsIHRydWUpOwogCi0JCWlmICh2bHZfZm9yY2VfcGxsX29uKGRldl9w
cml2LCBwaXBlLCBJU19DSEVSUllWSUVXKGRldl9wcml2KSA/CisJCWlmICh2bHZfZm9yY2VfcGxs
X29uKGk5MTUsIHBpcGUsIElTX0NIRVJSWVZJRVcoaTkxNSkgPwogCQkJCSAgICAgJmNodl9kcGxs
WzBdLmRwbGwgOiAmdmx2X2RwbGxbMF0uZHBsbCkpIHsKIAkJCURSTV9FUlJPUigiRmFpbGVkIHRv
IGZvcmNlIG9uIHBsbCBmb3IgcGlwZSAlYyFcbiIsCiAJCQkJICBwaXBlX25hbWUocGlwZSkpOwpA
QCAtNzI2LDE0ICs3MjYsMTQgQEAgdmx2X3Bvd2VyX3NlcXVlbmNlcl9raWNrKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiAJUE9TVElOR19SRUFEKGludGVsX2RwLT5vdXRwdXRfcmVnKTsKIAog
CWlmICghcGxsX2VuYWJsZWQpIHsKLQkJdmx2X2ZvcmNlX3BsbF9vZmYoZGV2X3ByaXYsIHBpcGUp
OworCQl2bHZfZm9yY2VfcGxsX29mZihpOTE1LCBwaXBlKTsKIAogCQlpZiAocmVsZWFzZV9jbF9v
dmVycmlkZSkKLQkJCWNodl9waHlfcG93ZXJnYXRlX2NoKGRldl9wcml2LCBwaHksIGNoLCBmYWxz
ZSk7CisJCQljaHZfcGh5X3Bvd2VyZ2F0ZV9jaChpOTE1LCBwaHksIGNoLCBmYWxzZSk7CiAJfQog
fQogCi1zdGF0aWMgZW51bSBwaXBlIHZsdl9maW5kX2ZyZWVfcHBzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBlbnVtIHBpcGUgdmx2X2ZpbmRfZnJlZV9wcHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXI7CiAJdW5zaWduZWQgaW50IHBpcGVzID0gKDEgPDwgUElQRV9BKSB8ICgxIDw8IFBJUEVf
Qik7CkBAIC03NDIsNyArNzQyLDcgQEAgc3RhdGljIGVudW0gcGlwZSB2bHZfZmluZF9mcmVlX3Bw
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogV2UgZG9uJ3QgaGF2ZSBw
b3dlciBzZXF1ZW5jZXIgY3VycmVudGx5LgogCSAqIFBpY2sgb25lIHRoYXQncyBub3QgdXNlZCBi
eSBvdGhlciBwb3J0cy4KIAkgKi8KLQlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwg
ZW5jb2RlcikgeworCWZvcl9lYWNoX2ludGVsX2RwKCZpOTE1LT5kcm0sIGVuY29kZXIpIHsKIAkJ
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmZW5jb2Rlci0+YmFz
ZSk7CiAKIAkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkgewpAQCAtNzY4
LDExICs3NjgsMTEgQEAgc3RhdGljIGVudW0gcGlwZSB2bHZfZmluZF9mcmVlX3BwcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiBzdGF0aWMgZW51bSBwaXBlCiB2bHZfcG93ZXJf
c2VxdWVuY2VyX3BpcGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBp
bnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxf
ZHApOwogCWVudW0gcGlwZSBwaXBlOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYt
PnBwc19tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+cHBzX211dGV4KTsKIAog
CS8qIFdlIHNob3VsZCBuZXZlciBsYW5kIGhlcmUgd2l0aCByZWd1bGFyIERQIHBvcnRzICovCiAJ
V0FSTl9PTighaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSk7CkBAIC03ODMsNyArNzgzLDcgQEAg
dmx2X3Bvd2VyX3NlcXVlbmNlcl9waXBlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYg
KGludGVsX2RwLT5wcHNfcGlwZSAhPSBJTlZBTElEX1BJUEUpCiAJCXJldHVybiBpbnRlbF9kcC0+
cHBzX3BpcGU7CiAKLQlwaXBlID0gdmx2X2ZpbmRfZnJlZV9wcHMoZGV2X3ByaXYpOworCXBpcGUg
PSB2bHZfZmluZF9mcmVlX3BwcyhpOTE1KTsKIAogCS8qCiAJICogRGlkbid0IGZpbmQgb25lLiBU
aGlzIHNob3VsZCBub3QgaGFwcGVuIHNpbmNlIHRoZXJlCkBAIC03OTIsNyArNzkyLDcgQEAgdmx2
X3Bvd2VyX3NlcXVlbmNlcl9waXBlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYgKFdB
Uk5fT04ocGlwZSA9PSBJTlZBTElEX1BJUEUpKQogCQlwaXBlID0gUElQRV9BOwogCi0Jdmx2X3N0
ZWFsX3Bvd2VyX3NlcXVlbmNlcihkZXZfcHJpdiwgcGlwZSk7CisJdmx2X3N0ZWFsX3Bvd2VyX3Nl
cXVlbmNlcihpOTE1LCBwaXBlKTsKIAlpbnRlbF9kcC0+cHBzX3BpcGUgPSBwaXBlOwogCiAJRFJN
X0RFQlVHX0tNUygicGlja2VkIHBpcGUgJWMgcG93ZXIgc2VxdWVuY2VyIGZvciBwb3J0ICVjXG4i
LApAQCAtODE1LDEwICs4MTUsMTAgQEAgdmx2X3Bvd2VyX3NlcXVlbmNlcl9waXBlKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCiBzdGF0aWMgaW50CiBieHRfcG93ZXJfc2VxdWVuY2VyX2lkeChz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCWludCBiYWNrbGlnaHRfY29udHJvbGxl
ciA9IGRldl9wcml2LT52YnQuYmFja2xpZ2h0LmNvbnRyb2xsZXI7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlpbnQgYmFja2xpZ2h0X2Nv
bnRyb2xsZXIgPSBpOTE1LT52YnQuYmFja2xpZ2h0LmNvbnRyb2xsZXI7CiAKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZkZXZfcHJpdi0+cHBzX211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZp
OTE1LT5wcHNfbXV0ZXgpOwogCiAJLyogV2Ugc2hvdWxkIG5ldmVyIGxhbmQgaGVyZSB3aXRoIHJl
Z3VsYXIgRFAgcG9ydHMgKi8KIAlXQVJOX09OKCFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKTsK
QEAgLTgzNywyOSArODM3LDI5IEBAIGJ4dF9wb3dlcl9zZXF1ZW5jZXJfaWR4KHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiAJcmV0dXJuIGJhY2tsaWdodF9jb250cm9sbGVyOwogfQogCi10eXBl
ZGVmIGJvb2wgKCp2bHZfcGlwZV9jaGVjaykoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAordHlwZWRlZiBib29sICgqdmx2X3BpcGVfY2hlY2spKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJICAgICAgIGVudW0gcGlwZSBwaXBlKTsKIAotc3RhdGljIGJvb2wgdmx2
X3BpcGVfaGFzX3BwX29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRp
YyBib29sIHZsdl9waXBlX2hhc19wcF9vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgICAgICBlbnVtIHBpcGUgcGlwZSkKIHsKIAlyZXR1cm4gSTkxNV9SRUFEKFBQX1NUQVRV
UyhwaXBlKSkgJiBQUF9PTjsKIH0KIAotc3RhdGljIGJvb2wgdmx2X3BpcGVfaGFzX3ZkZF9vbihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCB2bHZfcGlwZV9o
YXNfdmRkX29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCWVudW0gcGlwZSBw
aXBlKQogewogCXJldHVybiBJOTE1X1JFQUQoUFBfQ09OVFJPTChwaXBlKSkgJiBFRFBfRk9SQ0Vf
VkREOwogfQogCi1zdGF0aWMgYm9vbCB2bHZfcGlwZV9hbnkoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgdmx2X3BpcGVfYW55KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJIGVudW0gcGlwZSBwaXBlKQogewogCXJldHVybiB0cnVlOwogfQog
CiBzdGF0aWMgZW51bSBwaXBlCi12bHZfaW5pdGlhbF9wcHNfcGlwZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCit2bHZfaW5pdGlhbF9wcHNfcGlwZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJICAgICBlbnVtIHBvcnQgcG9ydCwKIAkJICAgICB2bHZfcGlwZV9j
aGVjayBwaXBlX2NoZWNrKQogewpAQCAtODcyLDcgKzg3Miw3IEBAIHZsdl9pbml0aWFsX3Bwc19w
aXBlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaWYgKHBvcnRfc2VsICE9
IFBBTkVMX1BPUlRfU0VMRUNUX1ZMVihwb3J0KSkKIAkJCWNvbnRpbnVlOwogCi0JCWlmICghcGlw
ZV9jaGVjayhkZXZfcHJpdiwgcGlwZSkpCisJCWlmICghcGlwZV9jaGVjayhpOTE1LCBwaXBlKSkK
IAkJCWNvbnRpbnVlOwogCiAJCXJldHVybiBwaXBlOwpAQCAtODg0LDIzICs4ODQsMjMgQEAgdmx2
X2luaXRpYWxfcHBzX3BpcGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogc3Rh
dGljIHZvaWQKIHZsdl9pbml0aWFsX3Bvd2VyX3NlcXVlbmNlcl9zZXR1cChzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBf
dG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGln
X3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRl
bF9kaWdfcG9ydC0+YmFzZS5wb3J0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYt
PnBwc19tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+cHBzX211dGV4KTsKIAog
CS8qIHRyeSB0byBmaW5kIGEgcGlwZSB3aXRoIHRoaXMgcG9ydCBzZWxlY3RlZCAqLwogCS8qIGZp
cnN0IHBpY2sgb25lIHdoZXJlIHRoZSBwYW5lbCBpcyBvbiAqLwotCWludGVsX2RwLT5wcHNfcGlw
ZSA9IHZsdl9pbml0aWFsX3Bwc19waXBlKGRldl9wcml2LCBwb3J0LAorCWludGVsX2RwLT5wcHNf
cGlwZSA9IHZsdl9pbml0aWFsX3Bwc19waXBlKGk5MTUsIHBvcnQsCiAJCQkJCQkgIHZsdl9waXBl
X2hhc19wcF9vbik7CiAJLyogZGlkbid0IGZpbmQgb25lPyBwaWNrIG9uZSB3aGVyZSB2ZGQgaXMg
b24gKi8KIAlpZiAoaW50ZWxfZHAtPnBwc19waXBlID09IElOVkFMSURfUElQRSkKLQkJaW50ZWxf
ZHAtPnBwc19waXBlID0gdmx2X2luaXRpYWxfcHBzX3BpcGUoZGV2X3ByaXYsIHBvcnQsCisJCWlu
dGVsX2RwLT5wcHNfcGlwZSA9IHZsdl9pbml0aWFsX3Bwc19waXBlKGk5MTUsIHBvcnQsCiAJCQkJ
CQkJICB2bHZfcGlwZV9oYXNfdmRkX29uKTsKIAkvKiBkaWRuJ3QgZmluZCBvbmU/IHBpY2sgb25l
IHdpdGgganVzdCB0aGUgY29ycmVjdCBwb3J0ICovCiAJaWYgKGludGVsX2RwLT5wcHNfcGlwZSA9
PSBJTlZBTElEX1BJUEUpCi0JCWludGVsX2RwLT5wcHNfcGlwZSA9IHZsdl9pbml0aWFsX3Bwc19w
aXBlKGRldl9wcml2LCBwb3J0LAorCQlpbnRlbF9kcC0+cHBzX3BpcGUgPSB2bHZfaW5pdGlhbF9w
cHNfcGlwZShpOTE1LCBwb3J0LAogCQkJCQkJCSAgdmx2X3BpcGVfYW55KTsKIAogCS8qIGRpZG4n
dCBmaW5kIG9uZT8ganVzdCBsZXQgdmx2X3Bvd2VyX3NlcXVlbmNlcl9waXBlKCkgcGljayBvbmUg
d2hlbiBuZWVkZWQgKi8KQEAgLTkxNywxMiArOTE3LDEyIEBAIHZsdl9pbml0aWFsX3Bvd2VyX3Nl
cXVlbmNlcl9zZXR1cChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCWludGVsX2RwX2luaXRf
cGFuZWxfcG93ZXJfc2VxdWVuY2VyX3JlZ2lzdGVycyhpbnRlbF9kcCwgZmFsc2UpOwogfQogCi12
b2lkIGludGVsX3Bvd2VyX3NlcXVlbmNlcl9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCit2b2lkIGludGVsX3Bvd2VyX3NlcXVlbmNlcl9yZXNldChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAot
CWlmIChXQVJOX09OKCFJU19WQUxMRVlWSUVXKGRldl9wcml2KSAmJiAhSVNfQ0hFUlJZVklFVyhk
ZXZfcHJpdikgJiYKLQkJICAgICFJU19HRU45X0xQKGRldl9wcml2KSkpCisJaWYgKFdBUk5fT04o
IUlTX1ZBTExFWVZJRVcoaTkxNSkgJiYgIUlTX0NIRVJSWVZJRVcoaTkxNSkgJiYKKwkJICAgICFJ
U19HRU45X0xQKGk5MTUpKSkKIAkJcmV0dXJuOwogCiAJLyoKQEAgLTkzNSw3ICs5MzUsNyBAQCB2
b2lkIGludGVsX3Bvd2VyX3NlcXVlbmNlcl9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJICogc2hvdWxkIHVzZSB0aGVtIGFsd2F5cy4KIAkgKi8KIAotCWZvcl9lYWNo
X2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJZm9yX2VhY2hfaW50ZWxfZHAo
Jmk5MTUtPmRybSwgZW5jb2RlcikgewogCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5j
X3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAogCQlXQVJOX09OKGludGVsX2RwLT5hY3Rp
dmVfcGlwZSAhPSBJTlZBTElEX1BJUEUpOwpAQCAtOTQzLDcgKzk0Myw3IEBAIHZvaWQgaW50ZWxf
cG93ZXJfc2VxdWVuY2VyX3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJaWYgKGVuY29kZXItPnR5cGUgIT0gSU5URUxfT1VUUFVUX0VEUCkKIAkJCWNvbnRpbnVlOwog
Ci0JCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKKwkJaWYgKElTX0dFTjlfTFAoaTkxNSkpCiAJ
CQlpbnRlbF9kcC0+cHBzX3Jlc2V0ID0gdHJ1ZTsKIAkJZWxzZQogCQkJaW50ZWxfZHAtPnBwc19w
aXBlID0gSU5WQUxJRF9QSVBFOwpAQCAtOTYxLDE0ICs5NjEsMTQgQEAgc3RydWN0IHBwc19yZWdp
c3RlcnMgewogc3RhdGljIHZvaWQgaW50ZWxfcHBzX2dldF9yZWdpc3RlcnMoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwKIAkJCQkgICAgc3RydWN0IHBwc19yZWdpc3RlcnMgKnJlZ3MpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
IAlpbnQgcHBzX2lkeCA9IDA7CiAKIAltZW1zZXQocmVncywgMCwgc2l6ZW9mKCpyZWdzKSk7CiAK
LQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCisJaWYgKElTX0dFTjlfTFAoaTkxNSkpCiAJCXBw
c19pZHggPSBieHRfcG93ZXJfc2VxdWVuY2VyX2lkeChpbnRlbF9kcCk7Ci0JZWxzZSBpZiAoSVNf
VkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJZWxzZSBp
ZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQogCQlwcHNfaWR4
ID0gdmx2X3Bvd2VyX3NlcXVlbmNlcl9waXBlKGludGVsX2RwKTsKIAogCXJlZ3MtPnBwX2N0cmwg
PSBQUF9DT05UUk9MKHBwc19pZHgpOwpAQCAtOTc3LDcgKzk3Nyw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3Bwc19nZXRfcmVnaXN0ZXJzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJcmVncy0+
cHBfb2ZmID0gUFBfT0ZGX0RFTEFZUyhwcHNfaWR4KTsKIAogCS8qIEN5Y2xlIGRlbGF5IG1vdmVk
IGZyb20gUFBfRElWSVNPUiB0byBQUF9DT05UUk9MICovCi0JaWYgKElTX0dFTjlfTFAoZGV2X3By
aXYpIHx8IElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQQ0hfQ05QKQorCWlmIChJU19HRU45
X0xQKGk5MTUpIHx8IElOVEVMX1BDSF9UWVBFKGk5MTUpID49IFBDSF9DTlApCiAJCXJlZ3MtPnBw
X2RpdiA9IElOVkFMSURfTU1JT19SRUc7CiAJZWxzZQogCQlyZWdzLT5wcF9kaXYgPSBQUF9ESVZJ
U09SKHBwc19pZHgpOwpAQCAtMTAxMCwxNCArMTAxMCwxNCBAQCBzdGF0aWMgaW50IGVkcF9ub3Rp
ZnlfaGFuZGxlcihzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKnRoaXMsIHVuc2lnbmVkIGxvbmcgY29k
ZSwKIHsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gY29udGFpbmVyX29mKHRoaXMsIHR5
cGVvZigqIGludGVsX2RwKSwKIAkJCQkJCSBlZHBfbm90aWZpZXIpOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJaW50ZWxfd2FrZXJl
Zl90IHdha2VyZWY7CiAKIAlpZiAoIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkgfHwgY29kZSAh
PSBTWVNfUkVTVEFSVCkKIAkJcmV0dXJuIDA7CiAKIAl3aXRoX3Bwc19sb2NrKGludGVsX2RwLCB3
YWtlcmVmKSB7Ci0JCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVX
KGRldl9wcml2KSkgeworCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVX
KGk5MTUpKSB7CiAJCQllbnVtIHBpcGUgcGlwZSA9IHZsdl9wb3dlcl9zZXF1ZW5jZXJfcGlwZShp
bnRlbF9kcCk7CiAJCQlpOTE1X3JlZ190IHBwX2N0cmxfcmVnLCBwcF9kaXZfcmVnOwogCQkJdTMy
IHBwX2RpdjsKQEAgLTEwMzksMTEgKzEwMzksMTEgQEAgc3RhdGljIGludCBlZHBfbm90aWZ5X2hh
bmRsZXIoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICp0aGlzLCB1bnNpZ25lZCBsb25nIGNvZGUsCiAK
IHN0YXRpYyBib29sIGVkcF9oYXZlX3BhbmVsX3Bvd2VyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShp
bnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5wcHNfbXV0ZXgpOwor
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPnBwc19tdXRleCk7CiAKLQlpZiAoKElTX1ZBTExF
WVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSAmJgorCWlmICgoSVNf
VkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSAmJgogCSAgICBpbnRlbF9k
cC0+cHBzX3BpcGUgPT0gSU5WQUxJRF9QSVBFKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTEwNTIs
MTEgKzEwNTIsMTEgQEAgc3RhdGljIGJvb2wgZWRwX2hhdmVfcGFuZWxfcG93ZXIoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIAogc3RhdGljIGJvb2wgZWRwX2hhdmVfcGFuZWxfdmRkKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9w
cml2LT5wcHNfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPnBwc19tdXRleCk7
CiAKLQlpZiAoKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3By
aXYpKSAmJgorCWlmICgoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUp
KSAmJgogCSAgICBpbnRlbF9kcC0+cHBzX3BpcGUgPT0gSU5WQUxJRF9QSVBFKQogCQlyZXR1cm4g
ZmFsc2U7CiAKQEAgLTEwNjYsNyArMTA2Niw3IEBAIHN0YXRpYyBib29sIGVkcF9oYXZlX3BhbmVs
X3ZkZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogc3RhdGljIHZvaWQKIGludGVsX2RwX2No
ZWNrX2VkcChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKIAlpZiAoIWludGVsX2Rw
X2lzX2VkcChpbnRlbF9kcCkpCiAJCXJldHVybjsKQEAgLTExMDMsNyArMTEwMyw3IEBAIGludGVs
X2RwX2F1eF93YWl0X2RvbmUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogc3RhdGljIHUz
MiBnNHhfZ2V0X2F1eF9jbG9ja19kaXZpZGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGlu
dCBpbmRleCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19p
OTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5
MTUoaW50ZWxfZHApOwogCiAJaWYgKGluZGV4KQogCQlyZXR1cm4gMDsKQEAgLTExMTIsMTIgKzEx
MTIsMTIgQEAgc3RhdGljIHUzMiBnNHhfZ2V0X2F1eF9jbG9ja19kaXZpZGVyKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsIGludCBpbmRleCkKIAkgKiBUaGUgY2xvY2sgZGl2aWRlciBpcyBiYXNl
ZCBvZmYgdGhlIGhyYXdjbGssIGFuZCB3b3VsZCBsaWtlIHRvIHJ1biBhdAogCSAqIDJNSHouICBT
bywgdGFrZSB0aGUgaHJhd2NsayB2YWx1ZSBhbmQgZGl2aWRlIGJ5IDIwMDAgYW5kIHVzZSB0aGF0
CiAJICovCi0JcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKGRldl9wcml2LT5yYXdjbGtfZnJlcSwg
MjAwMCk7CisJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKGk5MTUtPnJhd2Nsa19mcmVxLCAyMDAw
KTsKIH0KIAogc3RhdGljIHUzMiBpbGtfZ2V0X2F1eF9jbG9ja19kaXZpZGVyKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsIGludCBpbmRleCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3Bv
cnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCiAJaWYgKGluZGV4KQpA
QCAtMTEyOSwxNyArMTEyOSwxNyBAQCBzdGF0aWMgdTMyIGlsa19nZXRfYXV4X2Nsb2NrX2Rpdmlk
ZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQogCSAqIGRpdmlkZSBieSAy
MDAwIGFuZCB1c2UgdGhhdAogCSAqLwogCWlmIChkaWdfcG9ydC0+YXV4X2NoID09IEFVWF9DSF9B
KQotCQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoZGV2X3ByaXYtPmNkY2xrLmh3LmNkY2xrLCAy
MDAwKTsKKwkJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKGk5MTUtPmNkY2xrLmh3LmNkY2xrLCAy
MDAwKTsKIAllbHNlCi0JCXJldHVybiBESVZfUk9VTkRfQ0xPU0VTVChkZXZfcHJpdi0+cmF3Y2xr
X2ZyZXEsIDIwMDApOworCQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoaTkxNS0+cmF3Y2xrX2Zy
ZXEsIDIwMDApOwogfQogCiBzdGF0aWMgdTMyIGhzd19nZXRfYXV4X2Nsb2NrX2RpdmlkZXIoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2Rp
Z2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAKLQlpZiAo
ZGlnX3BvcnQtPmF1eF9jaCAhPSBBVVhfQ0hfQSAmJiBIQVNfUENIX0xQVF9IKGRldl9wcml2KSkg
eworCWlmIChkaWdfcG9ydC0+YXV4X2NoICE9IEFVWF9DSF9BICYmIEhBU19QQ0hfTFBUX0goaTkx
NSkpIHsKIAkJLyogV29ya2Fyb3VuZCBmb3Igbm9uLVVMVCBIU1cgKi8KIAkJc3dpdGNoIChpbmRl
eCkgewogCQljYXNlIDA6IHJldHVybiA2MzsKQEAgLTExNjYsMTYgKzExNjYsMTYgQEAgc3RhdGlj
IHUzMiBnNHhfZ2V0X2F1eF9zZW5kX2N0bChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJ
CXUzMiBhdXhfY2xvY2tfZGl2aWRlcikKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpp
bnRlbF9kaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0K
IAkJCXRvX2k5MTUoaW50ZWxfZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwogCXUzMiBwcmVjaGFy
Z2UsIHRpbWVvdXQ7CiAKLQlpZiAoSVNfR0VOKGRldl9wcml2LCA2KSkKKwlpZiAoSVNfR0VOKGk5
MTUsIDYpKQogCQlwcmVjaGFyZ2UgPSAzOwogCWVsc2UKIAkJcHJlY2hhcmdlID0gNTsKIAotCWlm
IChJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCWlmIChJU19CUk9BRFdFTEwoaTkxNSkpCiAJCXRp
bWVvdXQgPSBEUF9BVVhfQ0hfQ1RMX1RJTUVfT1VUXzYwMHVzOwogCWVsc2UKIAkJdGltZW91dCA9
IERQX0FVWF9DSF9DVExfVElNRV9PVVRfNDAwdXM7CkBAIC0xNDgxLDcgKzE0ODEsNyBAQCBpbnRl
bF9kcF9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRybV9kcF9h
dXhfbXNnICptc2cpCiAKIHN0YXRpYyBpOTE1X3JlZ190IGc0eF9hdXhfY3RsX3JlZyhzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGln
X3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJZW51bSBhdXhfY2ggYXV4X2NoID0g
ZGlnX3BvcnQtPmF1eF9jaDsKIApAQCAtMTQ5OCw3ICsxNDk4LDcgQEAgc3RhdGljIGk5MTVfcmVn
X3QgZzR4X2F1eF9jdGxfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIHN0YXRpYyBp
OTE1X3JlZ190IGc0eF9hdXhfZGF0YV9yZWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50
IGluZGV4KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5
MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90
b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1
eF9jaDsKIApAQCAtMTUxNSw3ICsxNTE1LDcgQEAgc3RhdGljIGk5MTVfcmVnX3QgZzR4X2F1eF9k
YXRhX3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgaW5kZXgpCiAKIHN0YXRpYyBp
OTE1X3JlZ190IGlsa19hdXhfY3RsX3JlZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHAp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7
CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChp
bnRlbF9kcCk7CiAJZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKIApAQCAt
MTUzNCw3ICsxNTM0LDcgQEAgc3RhdGljIGk5MTVfcmVnX3QgaWxrX2F1eF9jdGxfcmVnKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIHN0YXRpYyBpOTE1X3JlZ190IGlsa19hdXhfZGF0YV9y
ZWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJ
ZW51bSBhdXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKIApAQCAtMTU1Myw3ICsxNTUz
LDcgQEAgc3RhdGljIGk5MTVfcmVnX3QgaWxrX2F1eF9kYXRhX3JlZyhzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLCBpbnQgaW5kZXgpCiAKIHN0YXRpYyBpOTE1X3JlZ190IHNrbF9hdXhfY3RsX3Jl
ZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxf
cG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJZW51bSBhdXhfY2gg
YXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKIApAQCAtMTU3Myw3ICsxNTczLDcgQEAgc3RhdGlj
IGk5MTVfcmVnX3Qgc2tsX2F1eF9jdGxfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAK
IHN0YXRpYyBpOTE1X3JlZ190IHNrbF9hdXhfZGF0YV9yZWcoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwgaW50IGluZGV4KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3Bv
cnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJZW51bSBhdXhfY2ggYXV4X2NoID0gZGln
X3BvcnQtPmF1eF9jaDsKIApAQCAtMTYwMCwxNCArMTYwMCwxNCBAQCBpbnRlbF9kcF9hdXhfZmlu
aShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogc3RhdGljIHZvaWQKIGludGVsX2RwX2F1eF9p
bml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKIAlzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkaWdfcG9ydC0+YmFzZTsKIAotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDkpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsKIAkJaW50ZWxf
ZHAtPmF1eF9jaF9jdGxfcmVnID0gc2tsX2F1eF9jdGxfcmVnOwogCQlpbnRlbF9kcC0+YXV4X2No
X2RhdGFfcmVnID0gc2tsX2F1eF9kYXRhX3JlZzsKLQl9IGVsc2UgaWYgKEhBU19QQ0hfU1BMSVQo
ZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChIQVNfUENIX1NQTElUKGk5MTUpKSB7CiAJCWludGVs
X2RwLT5hdXhfY2hfY3RsX3JlZyA9IGlsa19hdXhfY3RsX3JlZzsKIAkJaW50ZWxfZHAtPmF1eF9j
aF9kYXRhX3JlZyA9IGlsa19hdXhfZGF0YV9yZWc7CiAJfSBlbHNlIHsKQEAgLTE2MTUsMTYgKzE2
MTUsMTYgQEAgaW50ZWxfZHBfYXV4X2luaXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJ
aW50ZWxfZHAtPmF1eF9jaF9kYXRhX3JlZyA9IGc0eF9hdXhfZGF0YV9yZWc7CiAJfQogCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpCiAJ
CWludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2RpdmlkZXIgPSBza2xfZ2V0X2F1eF9jbG9ja19kaXZp
ZGVyOwotCWVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikgfHwgSVNfSEFTV0VMTChkZXZf
cHJpdikpCisJZWxzZSBpZiAoSVNfQlJPQURXRUxMKGk5MTUpIHx8IElTX0hBU1dFTEwoaTkxNSkp
CiAJCWludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2RpdmlkZXIgPSBoc3dfZ2V0X2F1eF9jbG9ja19k
aXZpZGVyOwotCWVsc2UgaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKQorCWVsc2UgaWYgKEhB
U19QQ0hfU1BMSVQoaTkxNSkpCiAJCWludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2RpdmlkZXIgPSBp
bGtfZ2V0X2F1eF9jbG9ja19kaXZpZGVyOwogCWVsc2UKIAkJaW50ZWxfZHAtPmdldF9hdXhfY2xv
Y2tfZGl2aWRlciA9IGc0eF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXI7CiAKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA5KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJaW50ZWxfZHAt
PmdldF9hdXhfc2VuZF9jdGwgPSBza2xfZ2V0X2F1eF9zZW5kX2N0bDsKIAllbHNlCiAJCWludGVs
X2RwLT5nZXRfYXV4X3NlbmRfY3RsID0gZzR4X2dldF9hdXhfc2VuZF9jdGw7CkBAIC0xNjU1LDIw
ICsxNjU1LDIwIEBAIHN0YXRpYyB2b2lkCiBpbnRlbF9kcF9zZXRfY2xvY2soc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVu
Y29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcF9saW5rX2RwbGwgKmRpdmlz
b3IgPSBOVUxMOwogCWludCBpLCBjb3VudCA9IDA7CiAKLQlpZiAoSVNfRzRYKGRldl9wcml2KSkg
eworCWlmIChJU19HNFgoaTkxNSkpIHsKIAkJZGl2aXNvciA9IGc0eF9kcGxsOwogCQljb3VudCA9
IEFSUkFZX1NJWkUoZzR4X2RwbGwpOwotCX0gZWxzZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJp
dikpIHsKKwl9IGVsc2UgaWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkpIHsKIAkJZGl2aXNvciA9IHBj
aF9kcGxsOwogCQljb3VudCA9IEFSUkFZX1NJWkUocGNoX2RwbGwpOwotCX0gZWxzZSBpZiAoSVNf
Q0hFUlJZVklFVyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkp
IHsKIAkJZGl2aXNvciA9IGNodl9kcGxsOwogCQljb3VudCA9IEFSUkFZX1NJWkUoY2h2X2RwbGwp
OwotCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElT
X1ZBTExFWVZJRVcoaTkxNSkpIHsKIAkJZGl2aXNvciA9IHZsdl9kcGxsOwogCQljb3VudCA9IEFS
UkFZX1NJWkUodmx2X2RwbGwpOwogCX0KQEAgLTE3NjAsOSArMTc2MCw5IEBAIHZvaWQgaW50ZWxf
ZHBfY29tcHV0ZV9yYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBwb3J0X2Nsb2Nr
LAogc3RhdGljIGJvb2wgaW50ZWxfZHBfc291cmNlX3N1cHBvcnRzX2ZlYyhzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwLAogCQkJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5
MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CiAKLQlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCXJl
dHVybiBJTlRFTF9HRU4oaTkxNSkgPj0gMTEgJiYKIAkJcGlwZV9jb25maWctPmNwdV90cmFuc2Nv
ZGVyICE9IFRSQU5TQ09ERVJfQTsKIH0KIApAQCAtMTc3Niw5ICsxNzc2LDkgQEAgc3RhdGljIGJv
b2wgaW50ZWxfZHBfc3VwcG9ydHNfZmVjKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiBzdGF0
aWMgYm9vbCBpbnRlbF9kcF9zb3VyY2Vfc3VwcG9ydHNfZHNjKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiAJCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRl
bF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVs
X2RwKTsKIAotCXJldHVybiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwICYmCisJcmV0dXJuIElO
VEVMX0dFTihpOTE1KSA+PSAxMCAmJgogCQlwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIgIT0g
VFJBTlNDT0RFUl9BOwogfQogCkBAIC0xNzk1LDcgKzE3OTUsNyBAQCBzdGF0aWMgYm9vbCBpbnRl
bF9kcF9zdXBwb3J0c19kc2Moc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIHN0YXRpYyBpbnQg
aW50ZWxfZHBfY29tcHV0ZV9icHAoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQlzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1Y3QgaW50ZWxfY29u
bmVjdG9yICppbnRlbF9jb25uZWN0b3IgPSBpbnRlbF9kcC0+YXR0YWNoZWRfY29ubmVjdG9yOwog
CWludCBicHAsIGJwYzsKIApAQCAtMTgwOCwxMCArMTgwOCwxMCBAQCBzdGF0aWMgaW50IGludGVs
X2RwX2NvbXB1dGVfYnBwKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKGludGVsX2Rw
X2lzX2VkcChpbnRlbF9kcCkpIHsKIAkJLyogR2V0IGJwcCBmcm9tIHZidCBvbmx5IGZvciBwYW5l
bHMgdGhhdCBkb250IGhhdmUgYnBwIGluIGVkaWQgKi8KIAkJaWYgKGludGVsX2Nvbm5lY3Rvci0+
YmFzZS5kaXNwbGF5X2luZm8uYnBjID09IDAgJiYKLQkJICAgIGRldl9wcml2LT52YnQuZWRwLmJw
cCAmJiBkZXZfcHJpdi0+dmJ0LmVkcC5icHAgPCBicHApIHsKKwkJICAgIGk5MTUtPnZidC5lZHAu
YnBwICYmIGk5MTUtPnZidC5lZHAuYnBwIDwgYnBwKSB7CiAJCQlEUk1fREVCVUdfS01TKCJjbGFt
cGluZyBicHAgZm9yIGVEUCBwYW5lbCB0byBCSU9TLXByb3ZpZGVkICVpXG4iLAotCQkJCSAgICAg
IGRldl9wcml2LT52YnQuZWRwLmJwcCk7Ci0JCQlicHAgPSBkZXZfcHJpdi0+dmJ0LmVkcC5icHA7
CisJCQkJICAgICAgaTkxNS0+dmJ0LmVkcC5icHApOworCQkJYnBwID0gaTkxNS0+dmJ0LmVkcC5i
cHA7CiAJCX0KIAl9CiAKQEAgLTE5MjQsNyArMTkyNCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHBf
ZHNjX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJICAgICAg
IHN0cnVjdCBsaW5rX2NvbmZpZ19saW1pdHMgKmxpbWl0cykKIHsKIAlzdHJ1Y3QgaW50ZWxfZGln
aXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGlnX3BvcnQt
PmJhc2UuYmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2Rl
ID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CiAJdTggZHNjX21heF9icGM7CiAJ
aW50IHBpcGVfYnBwOwpAQCAtMTk4OCw3ICsxOTg4LDcgQEAgc3RhdGljIGludCBpbnRlbF9kcF9k
c2NfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkgKiBpcyBncmVh
dGVyIHRoYW4gdGhlIG1heGltdW0gQ2RjbG9jayBhbmQgaWYgc2xpY2UgY291bnQgaXMgZXZlbgog
CSAqIHRoZW4gd2UgbmVlZCB0byB1c2UgMiBWRFNDIGluc3RhbmNlcy4KIAkgKi8KLQlpZiAoYWRq
dXN0ZWRfbW9kZS0+Y3J0Y19jbG9jayA+IGRldl9wcml2LT5tYXhfY2RjbGtfZnJlcSkgeworCWlm
IChhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrID4gaTkxNS0+bWF4X2NkY2xrX2ZyZXEpIHsKIAkJ
aWYgKHBpcGVfY29uZmlnLT5kc2NfcGFyYW1zLnNsaWNlX2NvdW50ID4gMSkgewogCQkJcGlwZV9j
b25maWctPmRzY19wYXJhbXMuZHNjX3NwbGl0ID0gdHJ1ZTsKIAkJfSBlbHNlIHsKQEAgLTIxNjgs
NyArMjE2OCw3IEBAIGludGVsX2RwX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJ
c3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsK
IAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9f
aW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9sc3Bjb24gKmxzcGNvbiA9
IGVuY190b19pbnRlbF9sc3Bjb24oJmVuY29kZXItPmJhc2UpOwpAQCAtMjE4MSw3ICsyMTgxLDcg
QEAgaW50ZWxfZHBfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCQkJCSAgIERQX0RQQ0RfUVVJUktfQ09OU1RBTlRfTik7CiAJaW50IHJldCA9IDAsIG91dHB1
dF9icHA7CiAKLQlpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikgJiYgIUhBU19EREkoZGV2X3By
aXYpICYmIHBvcnQgIT0gUE9SVF9BKQorCWlmIChIQVNfUENIX1NQTElUKGk5MTUpICYmICFIQVNf
RERJKGk5MTUpICYmIHBvcnQgIT0gUE9SVF9BKQogCQlwaXBlX2NvbmZpZy0+aGFzX3BjaF9lbmNv
ZGVyID0gdHJ1ZTsKIAogCXBpcGVfY29uZmlnLT5vdXRwdXRfZm9ybWF0ID0gSU5URUxfT1VUUFVU
X0ZPUk1BVF9SR0I7CkBAIC0yMTk1LDcgKzIxOTUsNyBAQCBpbnRlbF9kcF9jb21wdXRlX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJcmV0dXJuIHJldDsKIAogCXBpcGVf
Y29uZmlnLT5oYXNfZHJycyA9IGZhbHNlOwotCWlmIChJU19HNFgoZGV2X3ByaXYpIHx8IHBvcnQg
PT0gUE9SVF9BKQorCWlmIChJU19HNFgoaTkxNSkgfHwgcG9ydCA9PSBQT1JUX0EpCiAJCXBpcGVf
Y29uZmlnLT5oYXNfYXVkaW8gPSBmYWxzZTsKIAllbHNlIGlmIChpbnRlbF9jb25uX3N0YXRlLT5m
b3JjZV9hdWRpbyA9PSBIRE1JX0FVRElPX0FVVE8pCiAJCXBpcGVfY29uZmlnLT5oYXNfYXVkaW8g
PSBpbnRlbF9kcC0+aGFzX2F1ZGlvOwpAQCAtMjIwNiwxMyArMjIwNiwxMyBAQCBpbnRlbF9kcF9j
b21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJaW50ZWxfZml4
ZWRfcGFuZWxfbW9kZShpbnRlbF9jb25uZWN0b3ItPnBhbmVsLmZpeGVkX21vZGUsCiAJCQkJICAg
ICAgIGFkanVzdGVkX21vZGUpOwogCi0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpIHsK
KwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KSB7CiAJCQlyZXQgPSBza2xfdXBkYXRlX3NjYWxl
cl9jcnRjKHBpcGVfY29uZmlnKTsKIAkJCWlmIChyZXQpCiAJCQkJcmV0dXJuIHJldDsKIAkJfQog
Ci0JCWlmIChIQVNfR01DSChkZXZfcHJpdikpCisJCWlmIChIQVNfR01DSChpOTE1KSkKIAkJCWlu
dGVsX2dtY2hfcGFuZWxfZml0dGluZyhpbnRlbF9jcnRjLCBwaXBlX2NvbmZpZywKIAkJCQkJCSBj
b25uX3N0YXRlLT5zY2FsaW5nX21vZGUpOwogCQllbHNlCkBAIC0yMjIzLDcgKzIyMjMsNyBAQCBp
bnRlbF9kcF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlp
ZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0RCTFNDQU4pCiAJCXJldHVy
biAtRUlOVkFMOwogCi0JaWYgKEhBU19HTUNIKGRldl9wcml2KSAmJgorCWlmIChIQVNfR01DSChp
OTE1KSAmJgogCSAgICBhZGp1c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJM
QUNFKQogCQlyZXR1cm4gLUVJTlZBTDsKIApAQCAtMjI1MCw3ICsyMjUwLDcgQEAgaW50ZWxfZHBf
Y29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAg
Y29uc3RhbnRfbik7CiAKIAlpZiAoaW50ZWxfY29ubmVjdG9yLT5wYW5lbC5kb3duY2xvY2tfbW9k
ZSAhPSBOVUxMICYmCi0JCWRldl9wcml2LT5kcnJzLnR5cGUgPT0gU0VBTUxFU1NfRFJSU19TVVBQ
T1JUKSB7CisJCWk5MTUtPmRycnMudHlwZSA9PSBTRUFNTEVTU19EUlJTX1NVUFBPUlQpIHsKIAkJ
CXBpcGVfY29uZmlnLT5oYXNfZHJycyA9IHRydWU7CiAJCQlpbnRlbF9saW5rX2NvbXB1dGVfbV9u
KG91dHB1dF9icHAsCiAJCQkJCSAgICAgICBwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCwKQEAgLTIy
NjAsNyArMjI2MCw3IEBAIGludGVsX2RwX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJCQkgICAgICAgY29uc3RhbnRfbik7CiAJfQogCi0JaWYgKCFIQVNf
RERJKGRldl9wcml2KSkKKwlpZiAoIUhBU19EREkoaTkxNSkpCiAJCWludGVsX2RwX3NldF9jbG9j
ayhlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CiAKIAlpbnRlbF9wc3JfY29tcHV0ZV9jb25maWcoaW50
ZWxfZHAsIHBpcGVfY29uZmlnKTsKQEAgLTIyODEsNyArMjI4MSw3IEBAIHZvaWQgaW50ZWxfZHBf
c2V0X2xpbmtfcGFyYW1zKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiBzdGF0aWMgdm9pZCBp
bnRlbF9kcF9wcmVwYXJlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVy
LT5iYXNlKTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOwpAQCAt
MjMyMCw3ICsyMzIwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfcHJlcGFyZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCS8qIFNwbGl0IG91dCB0aGUgSUJYL0NQVSB2cyBDUFQg
c2V0dGluZ3MgKi8KIAotCWlmIChJU19JVllCUklER0UoZGV2X3ByaXYpICYmIHBvcnQgPT0gUE9S
VF9BKSB7CisJaWYgKElTX0lWWUJSSURHRShpOTE1KSAmJiBwb3J0ID09IFBPUlRfQSkgewogCQlp
ZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX1BIU1lOQykKIAkJCWludGVs
X2RwLT5EUCB8PSBEUF9TWU5DX0hTX0hJR0g7CiAJCWlmIChhZGp1c3RlZF9tb2RlLT5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfUFZTWU5DKQpAQCAtMjMzMSw3ICsyMzMxLDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHBfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCWludGVs
X2RwLT5EUCB8PSBEUF9FTkhBTkNFRF9GUkFNSU5HOwogCiAJCWludGVsX2RwLT5EUCB8PSBEUF9Q
SVBFX1NFTF9JVkIoY3J0Yy0+cGlwZSk7Ci0JfSBlbHNlIGlmIChIQVNfUENIX0NQVChkZXZfcHJp
dikgJiYgcG9ydCAhPSBQT1JUX0EpIHsKKwl9IGVsc2UgaWYgKEhBU19QQ0hfQ1BUKGk5MTUpICYm
IHBvcnQgIT0gUE9SVF9BKSB7CiAJCXUzMiB0cmFuc19kcDsKIAogCQlpbnRlbF9kcC0+RFAgfD0g
RFBfTElOS19UUkFJTl9PRkZfQ1BUOwpAQCAtMjM0Myw3ICsyMzQzLDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHBfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCXRyYW5z
X2RwICY9IH5UUkFOU19EUF9FTkhfRlJBTUlORzsKIAkJSTkxNV9XUklURShUUkFOU19EUF9DVEwo
Y3J0Yy0+cGlwZSksIHRyYW5zX2RwKTsKIAl9IGVsc2UgewotCQlpZiAoSVNfRzRYKGRldl9wcml2
KSAmJiBwaXBlX2NvbmZpZy0+bGltaXRlZF9jb2xvcl9yYW5nZSkKKwkJaWYgKElTX0c0WChpOTE1
KSAmJiBwaXBlX2NvbmZpZy0+bGltaXRlZF9jb2xvcl9yYW5nZSkKIAkJCWludGVsX2RwLT5EUCB8
PSBEUF9DT0xPUl9SQU5HRV8xNl8yMzU7CiAKIAkJaWYgKGFkanVzdGVkX21vZGUtPmZsYWdzICYg
RFJNX01PREVfRkxBR19QSFNZTkMpCkBAIC0yMzU1LDcgKzIzNTUsNyBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9kcF9wcmVwYXJlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlpZiAoZHJt
X2RwX2VuaGFuY2VkX2ZyYW1lX2NhcChpbnRlbF9kcC0+ZHBjZCkpCiAJCQlpbnRlbF9kcC0+RFAg
fD0gRFBfRU5IQU5DRURfRlJBTUlORzsKIAotCQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikp
CisJCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQkJaW50ZWxfZHAtPkRQIHw9IERQX1BJUEVf
U0VMX0NIVihjcnRjLT5waXBlKTsKIAkJZWxzZQogCQkJaW50ZWxfZHAtPkRQIHw9IERQX1BJUEVf
U0VMKGNydGMtPnBpcGUpOwpAQCAtMjM3NywxMCArMjM3NywxMCBAQCBzdGF0aWMgdm9pZCB3YWl0
X3BhbmVsX3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgICAgICB1MzIg
bWFzaywKIAkJCQkgICAgICAgdTMyIHZhbHVlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJaTkxNV9yZWdfdCBwcF9zdGF0X3Jl
ZywgcHBfY3RybF9yZWc7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+cHBzX211
dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5wcHNfbXV0ZXgpOwogCiAJaW50ZWxf
cHBzX3ZlcmlmeV9zdGF0ZShpbnRlbF9kcCk7CiAKQEAgLTIzOTIsNyArMjM5Miw3IEBAIHN0YXRp
YyB2b2lkIHdhaXRfcGFuZWxfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQlJ
OTE1X1JFQUQocHBfc3RhdF9yZWcpLAogCQkJSTkxNV9SRUFEKHBwX2N0cmxfcmVnKSk7CiAKLQlp
ZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYgKGludGVs
X3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIHBwX3N0YXRfcmVnLCBt
YXNrLCB2YWx1ZSwKIAkJCQkgICAgNTAwMCkpCiAJCURSTV9FUlJPUigiUGFuZWwgc3RhdHVzIHRp
bWVvdXQ6IHN0YXR1cyAlMDh4IGNvbnRyb2wgJTA4eFxuIiwKQEAgLTI0NTMsMTMgKzI0NTMsMTMg
QEAgc3RhdGljIHZvaWQgZWRwX3dhaXRfYmFja2xpZ2h0X29mZihzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwKQogCiBzdGF0aWMgIHUzMiBpcm9ubGFrZV9nZXRfcHBfY29udHJvbChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTMyIGNvbnRyb2w7CiAKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZkZXZfcHJpdi0+cHBzX211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5w
cHNfbXV0ZXgpOwogCiAJY29udHJvbCA9IEk5MTVfUkVBRChfcHBfY3RybF9yZWcoaW50ZWxfZHAp
KTsKLQlpZiAoV0FSTl9PTighSEFTX0RESShkZXZfcHJpdikgJiYKKwlpZiAoV0FSTl9PTighSEFT
X0RESShpOTE1KSAmJgogCQkgICAgKGNvbnRyb2wgJiBQQU5FTF9VTkxPQ0tfTUFTSykgIT0gUEFO
RUxfVU5MT0NLX1JFR1MpKSB7CiAJCWNvbnRyb2wgJj0gflBBTkVMX1VOTE9DS19NQVNLOwogCQlj
b250cm9sIHw9IFBBTkVMX1VOTE9DS19SRUdTOwpAQCAtMjQ3NCwxMyArMjQ3NCwxMyBAQCBzdGF0
aWMgIHUzMiBpcm9ubGFrZV9nZXRfcHBfY29udHJvbChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogICovCiBzdGF0aWMgYm9vbCBlZHBfcGFuZWxfdmRkX29uKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1
KGludGVsX2RwKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9
IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKIAl1MzIgcHA7CiAJaTkxNV9yZWdfdCBwcF9zdGF0
X3JlZywgcHBfY3RybF9yZWc7CiAJYm9vbCBuZWVkX3RvX2Rpc2FibGUgPSAhaW50ZWxfZHAtPndh
bnRfcGFuZWxfdmRkOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBwc19tdXRl
eCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+cHBzX211dGV4KTsKIAogCWlmICghaW50
ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMjQ5MSw3ICsyNDkx
LDcgQEAgc3RhdGljIGJvb2wgZWRwX3BhbmVsX3ZkZF9vbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQogCWlmIChlZHBfaGF2ZV9wYW5lbF92ZGQoaW50ZWxfZHApKQogCQlyZXR1cm4gbmVlZF90
b19kaXNhYmxlOwogCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsCisJaW50ZWxf
ZGlzcGxheV9wb3dlcl9nZXQoaTkxNSwKIAkJCQlpbnRlbF9hdXhfcG93ZXJfZG9tYWluKGludGVs
X2RpZ19wb3J0KSk7CiAKIAlEUk1fREVCVUdfS01TKCJUdXJuaW5nIGVEUCBwb3J0ICVjIFZERCBv
blxuIiwKQEAgLTI1NDYsMTMgKzI1NDYsMTMgQEAgdm9pZCBpbnRlbF9lZHBfcGFuZWxfdmRkX29u
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIHN0YXRpYyB2b2lkIGVkcF9wYW5lbF92ZGRf
b2ZmX3N5bmMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9k
aWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0ID0KIAkJZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHAp
OwogCXUzMiBwcDsKIAlpOTE1X3JlZ190IHBwX3N0YXRfcmVnLCBwcF9jdHJsX3JlZzsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5wcHNfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJmk5MTUtPnBwc19tdXRleCk7CiAKIAlXQVJOX09OKGludGVsX2RwLT53YW50X3BhbmVs
X3ZkZCk7CiAKQEAgLTI1NzgsNyArMjU3OCw3IEBAIHN0YXRpYyB2b2lkIGVkcF9wYW5lbF92ZGRf
b2ZmX3N5bmMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpZiAoKHBwICYgUEFORUxfUE9X
RVJfT04pID09IDApCiAJCWludGVsX2RwLT5wYW5lbF9wb3dlcl9vZmZfdGltZSA9IGt0aW1lX2dl
dF9ib290dGltZSgpOwogCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfdW5jaGVja2VkKGRldl9w
cml2LAorCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tlZChpOTE1LAogCQkJCQkgIGlu
dGVsX2F1eF9wb3dlcl9kb21haW4oaW50ZWxfZGlnX3BvcnQpKTsKIH0KIApAQCAtMjYxNSw5ICsy
NjE1LDkgQEAgc3RhdGljIHZvaWQgZWRwX3BhbmVsX3ZkZF9zY2hlZHVsZV9vZmYoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKICAqLwogc3RhdGljIHZvaWQgZWRwX3BhbmVsX3ZkZF9vZmYoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwgYm9vbCBzeW5jKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKLQlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZkZXZfcHJpdi0+cHBzX211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1
LT5wcHNfbXV0ZXgpOwogCiAJaWYgKCFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKQogCQlyZXR1
cm47CkBAIC0yNjM1LDExICsyNjM1LDExIEBAIHN0YXRpYyB2b2lkIGVkcF9wYW5lbF92ZGRfb2Zm
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGJvb2wgc3luYykKIAogc3RhdGljIHZvaWQgZWRw
X3BhbmVsX29uKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1MzIgcHA7CiAJaTkx
NV9yZWdfdCBwcF9jdHJsX3JlZzsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5w
cHNfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPnBwc19tdXRleCk7CiAKIAlp
ZiAoIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCiAJCXJldHVybjsKQEAgLTI2NTYsNyArMjY1
Niw3IEBAIHN0YXRpYyB2b2lkIGVkcF9wYW5lbF9vbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogCiAJcHBfY3RybF9yZWcgPSBfcHBfY3RybF9yZWcoaW50ZWxfZHApOwogCXBwID0gaXJvbmxh
a2VfZ2V0X3BwX2NvbnRyb2woaW50ZWxfZHApOwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDUpKSB7
CisJaWYgKElTX0dFTihpOTE1LCA1KSkgewogCQkvKiBJTEsgd29ya2Fyb3VuZDogZGlzYWJsZSBy
ZXNldCBhcm91bmQgcG93ZXIgc2VxdWVuY2UgKi8KIAkJcHAgJj0gflBBTkVMX1BPV0VSX1JFU0VU
OwogCQlJOTE1X1dSSVRFKHBwX2N0cmxfcmVnLCBwcCk7CkBAIC0yNjY0LDcgKzI2NjQsNyBAQCBz
dGF0aWMgdm9pZCBlZHBfcGFuZWxfb24oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAl9CiAK
IAlwcCB8PSBQQU5FTF9QT1dFUl9PTjsKLQlpZiAoIUlTX0dFTihkZXZfcHJpdiwgNSkpCisJaWYg
KCFJU19HRU4oaTkxNSwgNSkpCiAJCXBwIHw9IFBBTkVMX1BPV0VSX1JFU0VUOwogCiAJSTkxNV9X
UklURShwcF9jdHJsX3JlZywgcHApOwpAQCAtMjY3Myw3ICsyNjczLDcgQEAgc3RhdGljIHZvaWQg
ZWRwX3BhbmVsX29uKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJd2FpdF9wYW5lbF9vbihp
bnRlbF9kcCk7CiAJaW50ZWxfZHAtPmxhc3RfcG93ZXJfb24gPSBqaWZmaWVzOwogCi0JaWYgKElT
X0dFTihkZXZfcHJpdiwgNSkpIHsKKwlpZiAoSVNfR0VOKGk5MTUsIDUpKSB7CiAJCXBwIHw9IFBB
TkVMX1BPV0VSX1JFU0VUOyAvKiByZXN0b3JlIHBhbmVsIHJlc2V0IGJpdCAqLwogCQlJOTE1X1dS
SVRFKHBwX2N0cmxfcmVnLCBwcCk7CiAJCVBPU1RJTkdfUkVBRChwcF9jdHJsX3JlZyk7CkBAIC0y
Njk0LDEyICsyNjk0LDEyIEBAIHZvaWQgaW50ZWxfZWRwX3BhbmVsX29uKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApCiAKIHN0YXRpYyB2b2lkIGVkcF9wYW5lbF9vZmYoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90
b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3Rv
X2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0g
ZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXUzMiBwcDsKIAlpOTE1X3JlZ190IHBwX2N0cmxf
cmVnOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBwc19tdXRleCk7CisJbG9j
a2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+cHBzX211dGV4KTsKIAogCWlmICghaW50ZWxfZHBfaXNf
ZWRwKGludGVsX2RwKSkKIAkJcmV0dXJuOwpAQCAtMjcyNyw3ICsyNzI3LDcgQEAgc3RhdGljIHZv
aWQgZWRwX3BhbmVsX29mZihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCWludGVsX2RwLT5w
YW5lbF9wb3dlcl9vZmZfdGltZSA9IGt0aW1lX2dldF9ib290dGltZSgpOwogCiAJLyogV2UgZ290
IGEgcmVmZXJlbmNlIHdoZW4gd2UgZW5hYmxlZCB0aGUgVkRELiAqLwotCWludGVsX2Rpc3BsYXlf
cG93ZXJfcHV0X3VuY2hlY2tlZChkZXZfcHJpdiwgaW50ZWxfYXV4X3Bvd2VyX2RvbWFpbihkaWdf
cG9ydCkpOworCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X3VuY2hlY2tlZChpOTE1LCBpbnRlbF9h
dXhfcG93ZXJfZG9tYWluKGRpZ19wb3J0KSk7CiB9CiAKIHZvaWQgaW50ZWxfZWRwX3BhbmVsX29m
ZihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQpAQCAtMjc0NCw3ICsyNzQ0LDcgQEAgdm9pZCBp
bnRlbF9lZHBfcGFuZWxfb2ZmKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAvKiBFbmFibGUg
YmFja2xpZ2h0IGluIHRoZSBwYW5lbCBwb3dlciBjb250cm9sLiAqLwogc3RhdGljIHZvaWQgX2lu
dGVsX2VkcF9iYWNrbGlnaHRfb24oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCiAJLyoKQEAgLTI3ODUsNyArMjc4NSw3IEBAIHZvaWQg
aW50ZWxfZWRwX2JhY2tsaWdodF9vbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIC8qIERpc2FibGUgYmFja2xpZ2h0IGluIHRoZSBwYW5lbCBwb3dlciBjb250cm9s
LiAqLwogc3RhdGljIHZvaWQgX2ludGVsX2VkcF9iYWNrbGlnaHRfb2ZmKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBf
dG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90
b19pOTE1KGludGVsX2RwKTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAogCWlmICghaW50
ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKQEAgLTI4NDksNyArMjg0OSw3IEBAIHN0YXRpYyB2b2lk
IGludGVsX2VkcF9iYWNrbGlnaHRfcG93ZXIoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVj
dG9yLAogc3RhdGljIHZvaWQgYXNzZXJ0X2RwX3BvcnQoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwgYm9vbCBzdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9
IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwogCWJv
b2wgY3VyX3N0YXRlID0gSTkxNV9SRUFEKGludGVsX2RwLT5vdXRwdXRfcmVnKSAmIERQX1BPUlRf
RU47CiAKIAlJOTE1X1NUQVRFX1dBUk4oY3VyX3N0YXRlICE9IHN0YXRlLApAQCAtMjg1OSw3ICsy
ODU5LDcgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2RwX3BvcnQoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwgYm9vbCBzdGF0ZSkKIH0KICNkZWZpbmUgYXNzZXJ0X2RwX3BvcnRfZGlzYWJsZWQoZCkg
YXNzZXJ0X2RwX3BvcnQoKGQpLCBmYWxzZSkKIAotc3RhdGljIHZvaWQgYXNzZXJ0X2VkcF9wbGwo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIHN0YXRlKQorc3RhdGljIHZv
aWQgYXNzZXJ0X2VkcF9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGJvb2wgc3Rh
dGUpCiB7CiAJYm9vbCBjdXJfc3RhdGUgPSBJOTE1X1JFQUQoRFBfQSkgJiBEUF9QTExfRU5BQkxF
OwogCkBAIC0yODc0LDExICsyODc0LDExIEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2VkcF9wbGxf
b24oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAKLQlhc3NlcnRfcGlw
ZV9kaXNhYmxlZChkZXZfcHJpdiwgY3J0Yy0+cGlwZSk7CisJYXNzZXJ0X3BpcGVfZGlzYWJsZWQo
aTkxNSwgY3J0Yy0+cGlwZSk7CiAJYXNzZXJ0X2RwX3BvcnRfZGlzYWJsZWQoaW50ZWxfZHApOwot
CWFzc2VydF9lZHBfcGxsX2Rpc2FibGVkKGRldl9wcml2KTsKKwlhc3NlcnRfZWRwX3BsbF9kaXNh
YmxlZChpOTE1KTsKIAogCURSTV9ERUJVR19LTVMoImVuYWJsaW5nIGVEUCBQTEwgZm9yIGNsb2Nr
ICVkXG4iLAogCQkgICAgICBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayk7CkBAIC0yOTAwLDggKzI5
MDAsOCBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9lZHBfcGxsX29uKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJICogMS4gV2FpdCBmb3IgdGhlIHN0YXJ0IG9mIHZlcnRpY2FsIGJsYW5rIG9u
IHRoZSBlbmFibGVkIHBpcGUgZ29pbmcgdG8gRkRJCiAJICogMi4gUHJvZ3JhbSBEUCBQTEwgZW5h
YmxlCiAJICovCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgNSkpCi0JCWludGVsX3dhaXRfZm9yX3Zi
bGFua19pZl9hY3RpdmUoZGV2X3ByaXYsICFjcnRjLT5waXBlKTsKKwlpZiAoSVNfR0VOKGk5MTUs
IDUpKQorCQlpbnRlbF93YWl0X2Zvcl92YmxhbmtfaWZfYWN0aXZlKGk5MTUsICFjcnRjLT5waXBl
KTsKIAogCWludGVsX2RwLT5EUCB8PSBEUF9QTExfRU5BQkxFOwogCkBAIC0yOTE0LDExICsyOTE0
LDExIEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2VkcF9wbGxfb2ZmKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19z
dGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2Ny
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAotCWFzc2VydF9waXBlX2Rpc2FibGVkKGRl
dl9wcml2LCBjcnRjLT5waXBlKTsKKwlhc3NlcnRfcGlwZV9kaXNhYmxlZChpOTE1LCBjcnRjLT5w
aXBlKTsKIAlhc3NlcnRfZHBfcG9ydF9kaXNhYmxlZChpbnRlbF9kcCk7Ci0JYXNzZXJ0X2VkcF9w
bGxfZW5hYmxlZChkZXZfcHJpdik7CisJYXNzZXJ0X2VkcF9wbGxfZW5hYmxlZChpOTE1KTsKIAog
CURSTV9ERUJVR19LTVMoImRpc2FibGluZyBlRFAgUExMXG4iKTsKIApAQCAtMjk5OSwxMiArMjk5
OSwxMiBAQCB2b2lkIGludGVsX2RwX3NpbmtfZHBtcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
LCBpbnQgbW9kZSkKIAkJCSAgICAgIG1vZGUgPT0gRFJNX01PREVfRFBNU19PTiA/ICJlbmFibGUi
IDogImRpc2FibGUiKTsKIH0KIAotc3RhdGljIGJvb2wgY3B0X2RwX3BvcnRfc2VsZWN0ZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgY3B0X2RwX3BvcnRf
c2VsZWN0ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJIGVudW0gcG9ydCBw
b3J0LCBlbnVtIHBpcGUgKnBpcGUpCiB7CiAJZW51bSBwaXBlIHA7CiAKLQlmb3JfZWFjaF9waXBl
KGRldl9wcml2LCBwKSB7CisJZm9yX2VhY2hfcGlwZShpOTE1LCBwKSB7CiAJCXUzMiB2YWwgPSBJ
OTE1X1JFQUQoVFJBTlNfRFBfQ1RMKHApKTsKIAogCQlpZiAoKHZhbCAmIFRSQU5TX0RQX1BPUlRf
U0VMX01BU0spID09IFRSQU5TX0RQX1BPUlRfU0VMKHBvcnQpKSB7CkBAIC0zMDIxLDcgKzMwMjEs
NyBAQCBzdGF0aWMgYm9vbCBjcHRfZHBfcG9ydF9zZWxlY3RlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIGZhbHNlOwogfQogCi1ib29sIGludGVsX2RwX3BvcnRf
ZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitib29sIGludGVsX2Rw
X3BvcnRfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgIGk5MTVf
cmVnX3QgZHBfcmVnLCBlbnVtIHBvcnQgcG9ydCwKIAkJCSAgIGVudW0gcGlwZSAqcGlwZSkKIHsK
QEAgLTMwMzMsMTEgKzMwMzMsMTEgQEAgYm9vbCBpbnRlbF9kcF9wb3J0X2VuYWJsZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldCA9IHZhbCAmIERQX1BPUlRfRU47CiAK
IAkvKiBhc3NlcnRzIHdhbnQgdG8ga25vdyB0aGUgcGlwZSBldmVuIGlmIHRoZSBwb3J0IGlzIGRp
c2FibGVkICovCi0JaWYgKElTX0lWWUJSSURHRShkZXZfcHJpdikgJiYgcG9ydCA9PSBQT1JUX0Ep
CisJaWYgKElTX0lWWUJSSURHRShpOTE1KSAmJiBwb3J0ID09IFBPUlRfQSkKIAkJKnBpcGUgPSAo
dmFsICYgRFBfUElQRV9TRUxfTUFTS19JVkIpID4+IERQX1BJUEVfU0VMX1NISUZUX0lWQjsKLQll
bHNlIGlmIChIQVNfUENIX0NQVChkZXZfcHJpdikgJiYgcG9ydCAhPSBQT1JUX0EpCi0JCXJldCAm
PSBjcHRfZHBfcG9ydF9zZWxlY3RlZChkZXZfcHJpdiwgcG9ydCwgcGlwZSk7Ci0JZWxzZSBpZiAo
SVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSEFTX1BDSF9DUFQoaTkxNSkgJiYg
cG9ydCAhPSBQT1JUX0EpCisJCXJldCAmPSBjcHRfZHBfcG9ydF9zZWxlY3RlZChpOTE1LCBwb3J0
LCBwaXBlKTsKKwllbHNlIGlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQkqcGlwZSA9ICh2YWwg
JiBEUF9QSVBFX1NFTF9NQVNLX0NIVikgPj4gRFBfUElQRV9TRUxfU0hJRlRfQ0hWOwogCWVsc2UK
IAkJKnBpcGUgPSAodmFsICYgRFBfUElQRV9TRUxfTUFTSykgPj4gRFBfUElQRV9TRUxfU0hJRlQ7
CkBAIC0zMDQ4LDIwICszMDQ4LDIwIEBAIGJvb2wgaW50ZWxfZHBfcG9ydF9lbmFibGVkKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIHN0YXRpYyBib29sIGludGVsX2RwX2dldF9o
d19zdGF0ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgIGVudW0gcGlwZSAq
cGlwZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVu
Y29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNf
dG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwog
CWJvb2wgcmV0OwogCi0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJs
ZWQoZGV2X3ByaXYsCisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJs
ZWQoaTkxNSwKIAkJCQkJCSAgICAgZW5jb2Rlci0+cG93ZXJfZG9tYWluKTsKIAlpZiAoIXdha2Vy
ZWYpCiAJCXJldHVybiBmYWxzZTsKIAotCXJldCA9IGludGVsX2RwX3BvcnRfZW5hYmxlZChkZXZf
cHJpdiwgaW50ZWxfZHAtPm91dHB1dF9yZWcsCisJcmV0ID0gaW50ZWxfZHBfcG9ydF9lbmFibGVk
KGk5MTUsIGludGVsX2RwLT5vdXRwdXRfcmVnLAogCQkJCSAgICBlbmNvZGVyLT5wb3J0LCBwaXBl
KTsKIAotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBlbmNvZGVyLT5wb3dlcl9k
b21haW4sIHdha2VyZWYpOworCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsIGVuY29kZXIt
PnBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtMzA2OSw3ICsz
MDY5LDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfZHBfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogc3RhdGljIHZvaWQgaW50ZWxfZHBfZ2V0X2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0g
ZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAl1MzIgdG1wLCBmbGFncyA9IDA7CiAJ
ZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwpAQCAtMzA4NCw3ICszMDg0LDcgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZHBfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAogCXBpcGVfY29uZmlnLT5oYXNfYXVkaW8gPSB0bXAgJiBEUF9BVURJT19PVVRQVVRfRU5B
QkxFICYmIHBvcnQgIT0gUE9SVF9BOwogCi0JaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSAmJiBw
b3J0ICE9IFBPUlRfQSkgeworCWlmIChIQVNfUENIX0NQVChpOTE1KSAmJiBwb3J0ICE9IFBPUlRf
QSkgewogCQl1MzIgdHJhbnNfZHAgPSBJOTE1X1JFQUQoVFJBTlNfRFBfQ1RMKGNydGMtPnBpcGUp
KTsKIAogCQlpZiAodHJhbnNfZHAgJiBUUkFOU19EUF9IU1lOQ19BQ1RJVkVfSElHSCkKQEAgLTMx
MTAsNyArMzExMCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2dldF9jb25maWcoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
LmZsYWdzIHw9IGZsYWdzOwogCi0JaWYgKElTX0c0WChkZXZfcHJpdikgJiYgdG1wICYgRFBfQ09M
T1JfUkFOR0VfMTZfMjM1KQorCWlmIChJU19HNFgoaTkxNSkgJiYgdG1wICYgRFBfQ09MT1JfUkFO
R0VfMTZfMjM1KQogCQlwaXBlX2NvbmZpZy0+bGltaXRlZF9jb2xvcl9yYW5nZSA9IHRydWU7CiAK
IAlwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCA9CkBAIC0zMTI5LDggKzMxMjksOCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9kcF9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CQlpbnRlbF9kb3RjbG9ja19jYWxjdWxhdGUocGlwZV9jb25maWctPnBvcnRfY2xvY2ssCiAJCQkJ
CSAmcGlwZV9jb25maWctPmRwX21fbik7CiAKLQlpZiAoaW50ZWxfZHBfaXNfZWRwKGludGVsX2Rw
KSAmJiBkZXZfcHJpdi0+dmJ0LmVkcC5icHAgJiYKLQkgICAgcGlwZV9jb25maWctPnBpcGVfYnBw
ID4gZGV2X3ByaXYtPnZidC5lZHAuYnBwKSB7CisJaWYgKGludGVsX2RwX2lzX2VkcChpbnRlbF9k
cCkgJiYgaTkxNS0+dmJ0LmVkcC5icHAgJiYKKwkgICAgcGlwZV9jb25maWctPnBpcGVfYnBwID4g
aTkxNS0+dmJ0LmVkcC5icHApIHsKIAkJLyoKIAkJICogVGhpcyBpcyBhIGJpZyBmYXQgdWdseSBo
YWNrLgogCQkgKgpAQCAtMzE0NSw4ICszMTQ1LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfZ2V0
X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJICogbG9hZC4KIAkJICov
CiAJCURSTV9ERUJVR19LTVMoInBpcGUgaGFzICVkIGJwcCBmb3IgZURQIHBhbmVsLCBvdmVycmlk
aW5nIEJJT1MtcHJvdmlkZWQgbWF4ICVkIGJwcFxuIiwKLQkJCSAgICAgIHBpcGVfY29uZmlnLT5w
aXBlX2JwcCwgZGV2X3ByaXYtPnZidC5lZHAuYnBwKTsKLQkJZGV2X3ByaXYtPnZidC5lZHAuYnBw
ID0gcGlwZV9jb25maWctPnBpcGVfYnBwOworCQkJICAgICAgcGlwZV9jb25maWctPnBpcGVfYnBw
LCBpOTE1LT52YnQuZWRwLmJwcCk7CisJCWk5MTUtPnZidC5lZHAuYnBwID0gcGlwZV9jb25maWct
PnBpcGVfYnBwOwogCX0KIH0KIApAQCAtMzIxNSwxNiArMzIxNSwxNiBAQCBzdGF0aWMgdm9pZCBj
aHZfcG9zdF9kaXNhYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCWNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCQljb25zdCBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKIAogCWludGVsX2RwX2xpbmtfZG93bihlbmNvZGVyLCBvbGRfY3J0Y19zdGF0ZSk7CiAKLQl2
bHZfZHBpb19nZXQoZGV2X3ByaXYpOworCXZsdl9kcGlvX2dldChpOTE1KTsKIAogCS8qIEFzc2Vy
dCBkYXRhIGxhbmUgcmVzZXQgKi8KIAljaHZfZGF0YV9sYW5lX3NvZnRfcmVzZXQoZW5jb2Rlciwg
b2xkX2NydGNfc3RhdGUsIHRydWUpOwogCi0Jdmx2X2RwaW9fcHV0KGRldl9wcml2KTsKKwl2bHZf
ZHBpb19wdXQoaTkxNSk7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC0zMjMyLDcgKzMyMzIsNyBAQCBf
aW50ZWxfZHBfc2V0X2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCSB1
MzIgKkRQLAogCQkJIHU4IGRwX3RyYWluX3BhdCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFs
X3BvcnQgKmludGVsX2RpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCWVudW0g
cG9ydCBwb3J0ID0gaW50ZWxfZGlnX3BvcnQtPmJhc2UucG9ydDsKIAl1OCB0cmFpbl9wYXRfbWFz
ayA9IGRybV9kcF90cmFpbmluZ19wYXR0ZXJuX21hc2soaW50ZWxfZHAtPmRwY2QpOwpAQCAtMzI0
MSw3ICszMjQxLDcgQEAgX2ludGVsX2RwX3NldF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJCURSTV9ERUJVR19LTVMoIlVzaW5nIERQIHRyYWluaW5nIHBhdHRlcm4gVFBT
JWRcbiIsCiAJCQkgICAgICBkcF90cmFpbl9wYXQgJiB0cmFpbl9wYXRfbWFzayk7CiAKLQlpZiAo
SEFTX0RESShkZXZfcHJpdikpIHsKKwlpZiAoSEFTX0RESShpOTE1KSkgewogCQl1MzIgdGVtcCA9
IEk5MTVfUkVBRChEUF9UUF9DVEwocG9ydCkpOwogCiAJCWlmIChkcF90cmFpbl9wYXQgJiBEUF9M
SU5LX1NDUkFNQkxJTkdfRElTQUJMRSkKQEAgLTMyNzAsOCArMzI3MCw4IEBAIF9pbnRlbF9kcF9z
ZXRfbGlua190cmFpbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQl9CiAJCUk5MTVfV1JJ
VEUoRFBfVFBfQ1RMKHBvcnQpLCB0ZW1wKTsKIAotCX0gZWxzZSBpZiAoKElTX0lWWUJSSURHRShk
ZXZfcHJpdikgJiYgcG9ydCA9PSBQT1JUX0EpIHx8Ci0JCSAgIChIQVNfUENIX0NQVChkZXZfcHJp
dikgJiYgcG9ydCAhPSBQT1JUX0EpKSB7CisJfSBlbHNlIGlmICgoSVNfSVZZQlJJREdFKGk5MTUp
ICYmIHBvcnQgPT0gUE9SVF9BKSB8fAorCQkgICAoSEFTX1BDSF9DUFQoaTkxNSkgJiYgcG9ydCAh
PSBQT1JUX0EpKSB7CiAJCSpEUCAmPSB+RFBfTElOS19UUkFJTl9NQVNLX0NQVDsKIAogCQlzd2l0
Y2ggKGRwX3RyYWluX3BhdCAmIERQX1RSQUlOSU5HX1BBVFRFUk5fTUFTSykgewpAQCAtMzMxNCw3
ICszMzE0LDcgQEAgX2ludGVsX2RwX3NldF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiBzdGF0aWMgdm9pZCBpbnRlbF9kcF9lbmFibGVfcG9ydChzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLAogCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1
KGludGVsX2RwKTsKIAogCS8qIGVuYWJsZSB3aXRoIHBhdHRlcm4gMSAoYXMgcGVyIHNwZWMpICov
CiAKQEAgLTMzMzgsNyArMzMzOCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9kcChzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CiAJdTMy
IGRwX3JlZyA9IEk5MTVfUkVBRChpbnRlbF9kcC0+b3V0cHV0X3JlZyk7CkBAIC0zMzQ5LDcgKzMz
NDksNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9lbmFibGVfZHAoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCXJldHVybjsKIAogCXdpdGhfcHBzX2xvY2soaW50ZWxfZHAsIHdha2VyZWYp
IHsKLQkJaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3By
aXYpKQorCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQog
CQkJdmx2X2luaXRfcGFuZWxfcG93ZXJfc2VxdWVuY2VyKGVuY29kZXIsIHBpcGVfY29uZmlnKTsK
IAogCQlpbnRlbF9kcF9lbmFibGVfcG9ydChpbnRlbF9kcCwgcGlwZV9jb25maWcpOwpAQCAtMzM1
OSwxMyArMzM1OSwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9lbmFibGVfZHAoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCWVkcF9wYW5lbF92ZGRfb2ZmKGludGVsX2RwLCB0cnVlKTsK
IAl9CiAKLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZf
cHJpdikpIHsKKwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUp
KSB7CiAJCXVuc2lnbmVkIGludCBsYW5lX21hc2sgPSAweDA7CiAKLQkJaWYgKElTX0NIRVJSWVZJ
RVcoZGV2X3ByaXYpKQorCQlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJCWxhbmVfbWFzayA9
IGludGVsX2RwX3VudXNlZF9sYW5lX21hc2socGlwZV9jb25maWctPmxhbmVfY291bnQpOwogCi0J
CXZsdl93YWl0X3BvcnRfcmVhZHkoZGV2X3ByaXYsIGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKSwK
KwkJdmx2X3dhaXRfcG9ydF9yZWFkeShpOTE1LCBkcF90b19kaWdfcG9ydChpbnRlbF9kcCksCiAJ
CQkJICAgIGxhbmVfbWFzayk7CiAJfQogCkBAIC0zNDEyLDcgKzM0MTIsNyBAQCBzdGF0aWMgdm9p
ZCBnNHhfcHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRp
YyB2b2lkIHZsdl9kZXRhY2hfcG93ZXJfc2VxdWVuY2VyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBkcF90
b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShpbnRlbF9kaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGludGVsX2RpZ19wb3J0LT5iYXNlLmJhc2UuZGV2
KTsKIAllbnVtIHBpcGUgcGlwZSA9IGludGVsX2RwLT5wcHNfcGlwZTsKIAlpOTE1X3JlZ190IHBw
X29uX3JlZyA9IFBQX09OX0RFTEFZUyhwaXBlKTsKIApAQCAtMzQ0MCwxNCArMzQ0MCwxNCBAQCBz
dGF0aWMgdm9pZCB2bHZfZGV0YWNoX3Bvd2VyX3NlcXVlbmNlcihzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwKQogCWludGVsX2RwLT5wcHNfcGlwZSA9IElOVkFMSURfUElQRTsKIH0KIAotc3RhdGlj
IHZvaWQgdmx2X3N0ZWFsX3Bvd2VyX3NlcXVlbmNlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCitzdGF0aWMgdm9pZCB2bHZfc3RlYWxfcG93ZXJfc2VxdWVuY2VyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgIGVudW0gcGlwZSBwaXBlKQogewogCXN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2
X3ByaXYtPnBwc19tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+cHBzX211dGV4
KTsKIAotCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJZm9y
X2VhY2hfaW50ZWxfZHAoJmk5MTUtPmRybSwgZW5jb2RlcikgewogCQlzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAkJZW51bSBwb3J0
IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCkBAIC0zNDY5LDExICszNDY5LDExIEBAIHN0YXRpYyB2
b2lkIHZsdl9zdGVhbF9wb3dlcl9zZXF1ZW5jZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogc3RhdGljIHZvaWQgdmx2X2luaXRfcGFuZWxfcG93ZXJfc2VxdWVuY2VyKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCi0J
bG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBwc19tdXRleCk7CisJbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmaTkxNS0+cHBzX211dGV4KTsKIAogCVdBUk5fT04oaW50ZWxfZHAtPmFjdGl2ZV9w
aXBlICE9IElOVkFMSURfUElQRSk7CiAKQEAgLTM0OTEsNyArMzQ5MSw3IEBAIHN0YXRpYyB2b2lk
IHZsdl9pbml0X3BhbmVsX3Bvd2VyX3NlcXVlbmNlcihzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkgKiBXZSBtYXkgYmUgc3RlYWxpbmcgdGhlIHBvd2VyCiAJICogc2VxdWVuY2VyIGZy
b20gYW5vdGhlciBwb3J0LgogCSAqLwotCXZsdl9zdGVhbF9wb3dlcl9zZXF1ZW5jZXIoZGV2X3By
aXYsIGNydGMtPnBpcGUpOworCXZsdl9zdGVhbF9wb3dlcl9zZXF1ZW5jZXIoaTkxNSwgY3J0Yy0+
cGlwZSk7CiAKIAlpbnRlbF9kcC0+YWN0aXZlX3BpcGUgPSBjcnRjLT5waXBlOwogCkBAIC0zNTcw
LDE3ICszNTcwLDE3IEBAIGludGVsX2RwX2dldF9saW5rX3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLCB1OCBsaW5rX3N0YXR1c1tEUF9MSU5LX1NUQVRVCiB1OAogaW50ZWxfZHBfdm9s
dGFnZV9tYXgoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyID0gJmRwX3RvX2RpZ19wb3J0KGludGVsX2RwKS0+YmFzZTsKIAllbnVt
IHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAKLQlpZiAoSEFTX0RESShkZXZfcHJpdikpCisJ
aWYgKEhBU19EREkoaTkxNSkpCiAJCXJldHVybiBpbnRlbF9kZGlfZHBfdm9sdGFnZV9tYXgoZW5j
b2Rlcik7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklF
VyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllW
SUVXKGk5MTUpKQogCQlyZXR1cm4gRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8zOwotCWVs
c2UgaWYgKElTX0lWWUJSSURHRShkZXZfcHJpdikgJiYgcG9ydCA9PSBQT1JUX0EpCisJZWxzZSBp
ZiAoSVNfSVZZQlJJREdFKGk5MTUpICYmIHBvcnQgPT0gUE9SVF9BKQogCQlyZXR1cm4gRFBfVFJB
SU5fVk9MVEFHRV9TV0lOR19MRVZFTF8yOwotCWVsc2UgaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2
KSAmJiBwb3J0ICE9IFBPUlRfQSkKKwllbHNlIGlmIChIQVNfUENIX0NQVChpOTE1KSAmJiBwb3J0
ICE9IFBPUlRfQSkKIAkJcmV0dXJuIERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMzsKIAll
bHNlCiAJCXJldHVybiBEUF9UUkFJTl9WT0xUQUdFX1NXSU5HX0xFVkVMXzI7CkBAIC0zNTg5LDEz
ICszNTg5LDEzIEBAIGludGVsX2RwX3ZvbHRhZ2VfbWF4KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiB1OAogaW50ZWxfZHBfcHJlX2VtcGhhc2lzX21heChzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLCB1OCB2b2x0YWdlX3N3aW5nKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlOwogCWVudW0gcG9ydCBwb3J0ID0g
ZW5jb2Rlci0+cG9ydDsKIAotCWlmIChIQVNfRERJKGRldl9wcml2KSkgeworCWlmIChIQVNfRERJ
KGk5MTUpKSB7CiAJCXJldHVybiBpbnRlbF9kZGlfZHBfcHJlX2VtcGhhc2lzX21heChlbmNvZGVy
LCB2b2x0YWdlX3N3aW5nKTsKLQl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8
IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5
MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJc3dpdGNoICh2b2x0YWdlX3N3aW5nICYg
RFBfVFJBSU5fVk9MVEFHRV9TV0lOR19NQVNLKSB7CiAJCWNhc2UgRFBfVFJBSU5fVk9MVEFHRV9T
V0lOR19MRVZFTF8wOgogCQkJcmV0dXJuIERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzM7CkBAIC0z
NjA3LDcgKzM2MDcsNyBAQCBpbnRlbF9kcF9wcmVfZW1waGFzaXNfbWF4KHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAsIHU4IHZvbHRhZ2Vfc3dpbmcpCiAJCWRlZmF1bHQ6CiAJCQlyZXR1cm4gRFBf
VFJBSU5fUFJFX0VNUEhfTEVWRUxfMDsKIAkJfQotCX0gZWxzZSBpZiAoSVNfSVZZQlJJREdFKGRl
dl9wcml2KSAmJiBwb3J0ID09IFBPUlRfQSkgeworCX0gZWxzZSBpZiAoSVNfSVZZQlJJREdFKGk5
MTUpICYmIHBvcnQgPT0gUE9SVF9BKSB7CiAJCXN3aXRjaCAodm9sdGFnZV9zd2luZyAmIERQX1RS
QUlOX1ZPTFRBR0VfU1dJTkdfTUFTSykgewogCQljYXNlIERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdf
TEVWRUxfMDoKIAkJCXJldHVybiBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8yOwpAQCAtMzkwMSwy
NSArMzkwMSwyNSBAQCBpdmJfY3B1X2VkcF9zaWduYWxfbGV2ZWxzKHU4IHRyYWluX3NldCkKIHZv
aWQKIGludGVsX2RwX3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRl
bF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVs
X2RwKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9IGRwX3Rv
X2RpZ19wb3J0KGludGVsX2RwKTsKIAllbnVtIHBvcnQgcG9ydCA9IGludGVsX2RpZ19wb3J0LT5i
YXNlLnBvcnQ7CiAJdTMyIHNpZ25hbF9sZXZlbHMsIG1hc2sgPSAwOwogCXU4IHRyYWluX3NldCA9
IGludGVsX2RwLT50cmFpbl9zZXRbMF07CiAKLQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikgfHwg
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkgeworCWlmIChJU19HRU45X0xQKGk5MTUpIHx8IElO
VEVMX0dFTihpOTE1KSA+PSAxMCkgewogCQlzaWduYWxfbGV2ZWxzID0gYnh0X3NpZ25hbF9sZXZl
bHMoaW50ZWxfZHApOwotCX0gZWxzZSBpZiAoSEFTX0RESShkZXZfcHJpdikpIHsKKwl9IGVsc2Ug
aWYgKEhBU19EREkoaTkxNSkpIHsKIAkJc2lnbmFsX2xldmVscyA9IGRkaV9zaWduYWxfbGV2ZWxz
KGludGVsX2RwKTsKIAkJbWFzayA9IERESV9CVUZfRU1QX01BU0s7Ci0JfSBlbHNlIGlmIChJU19D
SEVSUllWSUVXKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkg
ewogCQlzaWduYWxfbGV2ZWxzID0gY2h2X3NpZ25hbF9sZXZlbHMoaW50ZWxfZHApOwotCX0gZWxz
ZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1ZBTExFWVZJ
RVcoaTkxNSkpIHsKIAkJc2lnbmFsX2xldmVscyA9IHZsdl9zaWduYWxfbGV2ZWxzKGludGVsX2Rw
KTsKLQl9IGVsc2UgaWYgKElTX0lWWUJSSURHRShkZXZfcHJpdikgJiYgcG9ydCA9PSBQT1JUX0Ep
IHsKKwl9IGVsc2UgaWYgKElTX0lWWUJSSURHRShpOTE1KSAmJiBwb3J0ID09IFBPUlRfQSkgewog
CQlzaWduYWxfbGV2ZWxzID0gaXZiX2NwdV9lZHBfc2lnbmFsX2xldmVscyh0cmFpbl9zZXQpOwog
CQltYXNrID0gRURQX0xJTktfVFJBSU5fVk9MX0VNUF9NQVNLX0lWQjsKLQl9IGVsc2UgaWYgKElT
X0dFTihkZXZfcHJpdiwgNikgJiYgcG9ydCA9PSBQT1JUX0EpIHsKKwl9IGVsc2UgaWYgKElTX0dF
TihpOTE1LCA2KSAmJiBwb3J0ID09IFBPUlRfQSkgewogCQlzaWduYWxfbGV2ZWxzID0gc25iX2Nw
dV9lZHBfc2lnbmFsX2xldmVscyh0cmFpbl9zZXQpOwogCQltYXNrID0gRURQX0xJTktfVFJBSU5f
Vk9MX0VNUF9NQVNLX1NOQjsKIAl9IGVsc2UgewpAQCAtMzk0Nyw3ICszOTQ3LDcgQEAgaW50ZWxf
ZHBfcHJvZ3JhbV9saW5rX3RyYWluaW5nX3BhdHRlcm4oc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwKIAkJCQkgICAgICAgdTggZHBfdHJhaW5fcGF0KQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFs
X3BvcnQgKmludGVsX2RpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPQogCQl0b19pOTE1KGludGVsX2RpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKIAogCV9p
bnRlbF9kcF9zZXRfbGlua190cmFpbihpbnRlbF9kcCwgJmludGVsX2RwLT5EUCwgZHBfdHJhaW5f
cGF0KTsKQEAgLTM5NTgsMTIgKzM5NTgsMTIgQEAgaW50ZWxfZHBfcHJvZ3JhbV9saW5rX3RyYWlu
aW5nX3BhdHRlcm4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAogdm9pZCBpbnRlbF9kcF9z
ZXRfaWRsZV9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGlu
dGVsX2RwKTsKIAllbnVtIHBvcnQgcG9ydCA9IGludGVsX2RpZ19wb3J0LT5iYXNlLnBvcnQ7CiAJ
dTMyIHZhbDsKIAotCWlmICghSEFTX0RESShkZXZfcHJpdikpCisJaWYgKCFIQVNfRERJKGk5MTUp
KQogCQlyZXR1cm47CiAKIAl2YWwgPSBJOTE1X1JFQUQoRFBfVFBfQ1RMKHBvcnQpKTsKQEAgLTM5
ODEsNyArMzk4MSw3IEBAIHZvaWQgaW50ZWxfZHBfc2V0X2lkbGVfbGlua190cmFpbihzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwKQogCWlmIChwb3J0ID09IFBPUlRfQSkKIAkJcmV0dXJuOwogCi0J
aWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBEUF9UUF9TVEFU
VVMocG9ydCksCisJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsIERQ
X1RQX1NUQVRVUyhwb3J0KSwKIAkJCQkgICAgRFBfVFBfU1RBVFVTX0lETEVfRE9ORSwKIAkJCQkg
ICAgRFBfVFBfU1RBVFVTX0lETEVfRE9ORSwKIAkJCQkgICAgMSkpCkBAIC0zOTkyLDcgKzM5OTIs
NyBAQCBzdGF0aWMgdm9pZAogaW50ZWxfZHBfbGlua19kb3duKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5j
X3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJZW51bSBwb3J0IHBv
cnQgPSBlbmNvZGVyLT5wb3J0OwpAQCAtNDAwMyw4ICs0MDAzLDggQEAgaW50ZWxfZHBfbGlua19k
b3duKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJRFJNX0RFQlVHX0tNUygiXG4i
KTsKIAotCWlmICgoSVNfSVZZQlJJREdFKGRldl9wcml2KSAmJiBwb3J0ID09IFBPUlRfQSkgfHwK
LQkgICAgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSAmJiBwb3J0ICE9IFBPUlRfQSkpIHsKKwlpZiAo
KElTX0lWWUJSSURHRShpOTE1KSAmJiBwb3J0ID09IFBPUlRfQSkgfHwKKwkgICAgKEhBU19QQ0hf
Q1BUKGk5MTUpICYmIHBvcnQgIT0gUE9SVF9BKSkgewogCQlEUCAmPSB+RFBfTElOS19UUkFJTl9N
QVNLX0NQVDsKIAkJRFAgfD0gRFBfTElOS19UUkFJTl9QQVRfSURMRV9DUFQ7CiAJfSBlbHNlIHsK
QEAgLTQwMjMsMTMgKzQwMjMsMTMgQEAgaW50ZWxfZHBfbGlua19kb3duKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCSAqIHRvIHRyYW5zY29kZXIgQSBhZnRlciBkaXNhYmxpbmcgaXQg
dG8gYWxsb3cgdGhlCiAJICogbWF0Y2hpbmcgSERNSSBwb3J0IHRvIGJlIGVuYWJsZWQgb24gdHJh
bnNjb2RlciBBLgogCSAqLwotCWlmIChIQVNfUENIX0lCWChkZXZfcHJpdikgJiYgY3J0Yy0+cGlw
ZSA9PSBQSVBFX0IgJiYgcG9ydCAhPSBQT1JUX0EpIHsKKwlpZiAoSEFTX1BDSF9JQlgoaTkxNSkg
JiYgY3J0Yy0+cGlwZSA9PSBQSVBFX0IgJiYgcG9ydCAhPSBQT1JUX0EpIHsKIAkJLyoKIAkJICog
V2UgZ2V0IENQVS9QQ0ggRklGTyB1bmRlcnJ1bnMgb24gdGhlIG90aGVyIHBpcGUgd2hlbgogCQkg
KiBkb2luZyB0aGUgd29ya2Fyb3VuZC4gU3dlZXAgdGhlbSB1bmRlciB0aGUgcnVnLgogCQkgKi8K
LQkJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgUElQRV9B
LCBmYWxzZSk7Ci0JCWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3By
aXYsIFBJUEVfQSwgZmFsc2UpOworCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0
aW5nKGk5MTUsIFBJUEVfQSwgZmFsc2UpOworCQlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5f
cmVwb3J0aW5nKGk5MTUsIFBJUEVfQSwgZmFsc2UpOwogCiAJCS8qIGFsd2F5cyBlbmFibGUgd2l0
aCBwYXR0ZXJuIDEgKGFzIHBlciBzcGVjKSAqLwogCQlEUCAmPSB+KERQX1BJUEVfU0VMX01BU0sg
fCBEUF9MSU5LX1RSQUlOX01BU0spOwpAQCAtNDA0MiwxNiArNDA0MiwxNiBAQCBpbnRlbF9kcF9s
aW5rX2Rvd24oc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCUk5MTVfV1JJVEUoaW50
ZWxfZHAtPm91dHB1dF9yZWcsIERQKTsKIAkJUE9TVElOR19SRUFEKGludGVsX2RwLT5vdXRwdXRf
cmVnKTsKIAotCQlpbnRlbF93YWl0X2Zvcl92YmxhbmtfaWZfYWN0aXZlKGRldl9wcml2LCBQSVBF
X0EpOwotCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBQ
SVBFX0EsIHRydWUpOwotCQlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRl
dl9wcml2LCBQSVBFX0EsIHRydWUpOworCQlpbnRlbF93YWl0X2Zvcl92YmxhbmtfaWZfYWN0aXZl
KGk5MTUsIFBJUEVfQSk7CisJCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmco
aTkxNSwgUElQRV9BLCB0cnVlKTsKKwkJaW50ZWxfc2V0X3BjaF9maWZvX3VuZGVycnVuX3JlcG9y
dGluZyhpOTE1LCBQSVBFX0EsIHRydWUpOwogCX0KIAogCW1zbGVlcChpbnRlbF9kcC0+cGFuZWxf
cG93ZXJfZG93bl9kZWxheSk7CiAKIAlpbnRlbF9kcC0+RFAgPSBEUDsKIAotCWlmIChJU19WQUxM
RVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19W
QUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJaW50ZWxfd2FrZXJl
Zl90IHdha2VyZWY7CiAKIAkJd2l0aF9wcHNfbG9jayhpbnRlbF9kcCwgd2FrZXJlZikKQEAgLTQx
NTYsNyArNDE1Niw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2dldF9kc2Nfc2lua19jYXAoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIHN0YXRpYyBib29sCiBpbnRlbF9lZHBfaW5pdF9kcGNk
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCXRvX2k5MTUo
ZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlLmJhc2UuZGV2KTsKIAogCS8qIHRoaXMgZnVu
Y3Rpb24gaXMgbWVhbnQgdG8gYmUgY2FsbGVkIG9ubHkgb25jZSAqLwpAQCAtNDE2OSw3ICs0MTY5
LDcgQEAgaW50ZWxfZWRwX2luaXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkJ
IGRybV9kcF9pc19icmFuY2goaW50ZWxfZHAtPmRwY2QpKTsKIAogCWlmIChpbnRlbF9kcC0+ZHBj
ZFtEUF9EUENEX1JFVl0gPj0gMHgxMSkKLQkJZGV2X3ByaXYtPm5vX2F1eF9oYW5kc2hha2UgPSBp
bnRlbF9kcC0+ZHBjZFtEUF9NQVhfRE9XTlNQUkVBRF0gJgorCQlpOTE1LT5ub19hdXhfaGFuZHNo
YWtlID0gaW50ZWxfZHAtPmRwY2RbRFBfTUFYX0RPV05TUFJFQURdICYKIAkJCURQX05PX0FVWF9I
QU5EU0hBS0VfTElOS19UUkFJTklORzsKIAogCS8qCkBAIC00MjMwLDcgKzQyMzAsNyBAQCBpbnRl
bF9lZHBfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaW50ZWxfZHBfc2V0
X2NvbW1vbl9yYXRlcyhpbnRlbF9kcCk7CiAKIAkvKiBSZWFkIHRoZSBlRFAgRFNDIERQQ0QgcmVn
aXN0ZXJzICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFL
RShkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMCB8fCBJU19HRU1JTklMQUtF
KGk5MTUpKQogCQlpbnRlbF9kcF9nZXRfZHNjX3NpbmtfY2FwKGludGVsX2RwKTsKIAogCXJldHVy
biB0cnVlOwpAQCAtNDgwNCw3ICs0ODA0LDcgQEAgaW50ZWxfZHBfbmVlZHNfbGlua19yZXRyYWlu
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiBpbnQgaW50ZWxfZHBfcmV0cmFpbl9saW5rKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNx
dWlyZV9jdHggKmN0eCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAgPSBlbmNfdG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvciA9IGludGVsX2RwLT5hdHRhY2hlZF9jb25uZWN0b3I7CiAJc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGU7CkBAIC00ODE3LDcgKzQ4MTcsNyBAQCBp
bnQgaW50ZWxfZHBfcmV0cmFpbl9saW5rKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CWlmICghY29ubmVjdG9yIHx8IGNvbm5lY3Rvci0+YmFzZS5zdGF0dXMgIT0gY29ubmVjdG9yX3N0
YXR1c19jb25uZWN0ZWQpCiAJCXJldHVybiAwOwogCi0JcmV0ID0gZHJtX21vZGVzZXRfbG9jaygm
ZGV2X3ByaXYtPmRybS5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4LAorCXJldCA9IGRybV9t
b2Rlc2V0X2xvY2soJmk5MTUtPmRybS5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4LAogCQkJ
ICAgICAgIGN0eCk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKQEAgLTQ4NDcsMjAgKzQ4NDcs
MjAgQEAgaW50IGludGVsX2RwX3JldHJhaW5fbGluayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJcmV0dXJuIDA7CiAKIAkvKiBTdXBwcmVzcyB1bmRlcnJ1bnMgY2F1c2VkIGJ5IHJl
LXRyYWluaW5nICovCi0JaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZf
cHJpdiwgY3J0Yy0+cGlwZSwgZmFsc2UpOworCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9y
ZXBvcnRpbmcoaTkxNSwgY3J0Yy0+cGlwZSwgZmFsc2UpOwogCWlmIChjcnRjX3N0YXRlLT5oYXNf
cGNoX2VuY29kZXIpCi0JCWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2
X3ByaXYsCisJCWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwKIAkJ
CQkJCSAgICAgIGludGVsX2NydGNfcGNoX3RyYW5zY29kZXIoY3J0YyksIGZhbHNlKTsKIAogCWlu
dGVsX2RwX3N0YXJ0X2xpbmtfdHJhaW4oaW50ZWxfZHApOwogCWludGVsX2RwX3N0b3BfbGlua190
cmFpbihpbnRlbF9kcCk7CiAKIAkvKiBLZWVwIHVuZGVycnVuIHJlcG9ydGluZyBkaXNhYmxlZCB1
bnRpbCB0aGluZ3MgYXJlIHN0YWJsZSAqLwotCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJp
diwgY3J0Yy0+cGlwZSk7CisJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGk5MTUsIGNydGMtPnBpcGUp
OwogCi0JaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgY3J0
Yy0+cGlwZSwgdHJ1ZSk7CisJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhp
OTE1LCBjcnRjLT5waXBlLCB0cnVlKTsKIAlpZiAoY3J0Y19zdGF0ZS0+aGFzX3BjaF9lbmNvZGVy
KQotCQlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LAorCQlp
bnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsCiAJCQkJCQkgICAgICBp
bnRlbF9jcnRjX3BjaF90cmFuc2NvZGVyKGNydGMpLCB0cnVlKTsKIAogCXJldHVybiAwOwpAQCAt
NDk0Niw3ICs0OTQ2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfY2hlY2tfc2VydmljZV9pcnEo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHN0YXRpYyBib29sCiBpbnRlbF9kcF9zaG9ydF9w
dWxzZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTggb2xkX3NpbmtfY291bnQg
PSBpbnRlbF9kcC0+c2lua19jb3VudDsKIAlib29sIHJldDsKIApAQCAtNDk4Myw3ICs0OTgzLDcg
QEAgaW50ZWxfZHBfc2hvcnRfcHVsc2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpZiAo
aW50ZWxfZHAtPmNvbXBsaWFuY2UudGVzdF90eXBlID09IERQX1RFU1RfTElOS19UUkFJTklORykg
ewogCQlEUk1fREVCVUdfS01TKCJMaW5rIFRyYWluaW5nIENvbXBsaWFuY2UgVGVzdCByZXF1ZXN0
ZWRcbiIpOwogCQkvKiBTZW5kIGEgSG90cGx1ZyBVZXZlbnQgdG8gdXNlcnNwYWNlIHRvIHN0YXJ0
IG1vZGVzZXQgKi8KLQkJZHJtX2ttc19oZWxwZXJfaG90cGx1Z19ldmVudCgmZGV2X3ByaXYtPmRy
bSk7CisJCWRybV9rbXNfaGVscGVyX2hvdHBsdWdfZXZlbnQoJmk5MTUtPmRybSk7CiAJfQogCiAJ
cmV0dXJuIHRydWU7CkBAIC01MDUyLDcgKzUwNTIsNyBAQCBlZHBfZGV0ZWN0KHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiAKIHN0YXRpYyBib29sIGlieF9kaWdpdGFsX3BvcnRfY29ubmVjdGVk
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIGJp
dDsKIAogCXN3aXRjaCAoZW5jb2Rlci0+aHBkX3BpbikgewpAQCAtNTA3NSw3ICs1MDc1LDcgQEAg
c3RhdGljIGJvb2wgaWJ4X2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIpCiAKIHN0YXRpYyBib29sIGNwdF9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIGJpdDsK
IAogCXN3aXRjaCAoZW5jb2Rlci0+aHBkX3BpbikgewpAQCAtNTA5OCw3ICs1MDk4LDcgQEAgc3Rh
dGljIGJvb2wgY3B0X2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIpCiAKIHN0YXRpYyBib29sIHNwdF9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIGJpdDsKIAog
CXN3aXRjaCAoZW5jb2Rlci0+aHBkX3BpbikgewpAQCAtNTExNyw3ICs1MTE3LDcgQEAgc3RhdGlj
IGJvb2wgc3B0X2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIpCiAKIHN0YXRpYyBib29sIGc0eF9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIGJpdDsKIAogCXN3
aXRjaCAoZW5jb2Rlci0+aHBkX3BpbikgewpAQCAtNTE0MCw3ICs1MTQwLDcgQEAgc3RhdGljIGJv
b2wgZzR4X2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIpCiAKIHN0YXRpYyBib29sIGdtNDVfZGlnaXRhbF9wb3J0X2Nvbm5lY3RlZChzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXUzMiBiaXQ7CiAKIAlzd2l0
Y2ggKGVuY29kZXItPmhwZF9waW4pIHsKQEAgLTUxNjMsNyArNTE2Myw3IEBAIHN0YXRpYyBib29s
IGdtNDVfZGlnaXRhbF9wb3J0X2Nvbm5lY3RlZChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
cikKIAogc3RhdGljIGJvb2wgaWxrX2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAogCWlmIChlbmNvZGVyLT5ocGRf
cGluID09IEhQRF9QT1JUX0EpCiAJCXJldHVybiBJOTE1X1JFQUQoREVJU1IpICYgREVfRFBfQV9I
T1RQTFVHOwpAQCAtNTE3Myw3ICs1MTczLDcgQEAgc3RhdGljIGJvb2wgaWxrX2RpZ2l0YWxfcG9y
dF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIHN0YXRpYyBib29s
IHNuYl9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CiAKIAlpZiAoZW5jb2Rlci0+aHBkX3BpbiA9PSBIUERfUE9SVF9B
KQogCQlyZXR1cm4gSTkxNV9SRUFEKERFSVNSKSAmIERFX0RQX0FfSE9UUExVRzsKQEAgLTUxODMs
NyArNTE4Myw3IEBAIHN0YXRpYyBib29sIHNuYl9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiBzdGF0aWMgYm9vbCBpdmJfZGlnaXRhbF9wb3J0
X2Nvbm5lY3RlZChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OwogCiAJaWYgKGVuY29kZXItPmhwZF9waW4gPT0gSFBEX1BPUlRfQSkKIAkJcmV0dXJuIEk5MTVf
UkVBRChERUlTUikgJiBERV9EUF9BX0hPVFBMVUdfSVZCOwpAQCAtNTE5Myw3ICs1MTkzLDcgQEAg
c3RhdGljIGJvb2wgaXZiX2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIpCiAKIHN0YXRpYyBib29sIGJkd19kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAKIAlpZiAoZW5j
b2Rlci0+aHBkX3BpbiA9PSBIUERfUE9SVF9BKQogCQlyZXR1cm4gSTkxNV9SRUFEKEdFTjhfREVf
UE9SVF9JU1IpICYgR0VOOF9QT1JUX0RQX0FfSE9UUExVRzsKQEAgLTUyMDMsNyArNTIwMyw3IEBA
IHN0YXRpYyBib29sIGJkd19kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyKQogCiBzdGF0aWMgYm9vbCBieHRfZGlnaXRhbF9wb3J0X2Nvbm5lY3RlZChz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXUzMiBiaXQ7
CiAKIAlzd2l0Y2ggKGVuY29kZXItPmhwZF9waW4pIHsKQEAgLTUyMjQsNyArNTIyNCw3IEBAIHN0
YXRpYyBib29sIGJ4dF9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyKQogCXJldHVybiBJOTE1X1JFQUQoR0VOOF9ERV9QT1JUX0lTUikgJiBiaXQ7CiB9
CiAKLXN0YXRpYyBib29sIGljbF9jb21ib19wb3J0X2Nvbm5lY3RlZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBpY2xfY29tYm9fcG9ydF9jb25uZWN0ZWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICBzdHJ1Y3QgaW50ZWxfZGln
aXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCkKIHsKIAllbnVtIHBvcnQgcG9ydCA9IGludGVsX2Rp
Z19wb3J0LT5iYXNlLnBvcnQ7CkBAIC01MjQ3LDcgKzUyNDcsNyBAQCBzdGF0aWMgY29uc3QgY2hh
ciAqdGNfdHlwZV9uYW1lKGVudW0gdGNfcG9ydF90eXBlIHR5cGUpCiAJcmV0dXJuIG5hbWVzW3R5
cGVdOwogfQogCi1zdGF0aWMgdm9pZCBpY2xfdXBkYXRlX3RjX3BvcnRfdHlwZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpY2xfdXBkYXRlX3RjX3BvcnRf
dHlwZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiAJCQkJICAgIGJvb2wgaXNfbGVnYWN5LCBi
b29sIGlzX3R5cGVjLCBib29sIGlzX3RidCkKIHsKQEAgLTUyOTUsMTAgKzUyOTUsMTAgQEAgc3Rh
dGljIHZvaWQgaWNsX3VwZGF0ZV90Y19wb3J0X3R5cGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogICogd2lsbCByZXF1aXJlIGEgbG90IG9mIGNvb3JkaW5hdGlvbiB3aXRoIHVz
ZXIgc3BhY2UgYW5kIHRob3JvdWdoIHRlc3RpbmcgZm9yCiAgKiB0aGUgZXh0cmEgcG9zc2libGUg
Y2FzZXMuCiAgKi8KLXN0YXRpYyBib29sIGljbF90Y19waHlfY29ubmVjdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBpY2xfdGNfcGh5X2Nvbm5lY3Qoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgc3RydWN0IGludGVsX2RpZ2l0
YWxfcG9ydCAqZGlnX3BvcnQpCiB7Ci0JZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0
X3RvX3RjKGRldl9wcml2LCBkaWdfcG9ydC0+YmFzZS5wb3J0KTsKKwllbnVtIHRjX3BvcnQgdGNf
cG9ydCA9IGludGVsX3BvcnRfdG9fdGMoaTkxNSwgZGlnX3BvcnQtPmJhc2UucG9ydCk7CiAJdTMy
IHZhbDsKIAogCWlmIChkaWdfcG9ydC0+dGNfdHlwZSAhPSBUQ19QT1JUX0xFR0FDWSAmJgpAQCAt
NTMyOSw3ICs1MzI5LDcgQEAgc3RhdGljIGJvb2wgaWNsX3RjX3BoeV9jb25uZWN0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAoZGlnX3BvcnQtPnRjX3R5cGUgPT0gVENf
UE9SVF9UWVBFQyAmJgogCSAgICAhKEk5MTVfUkVBRChQT1JUX1RYX0RGTEVYRFBTUCkgJiBUQ19M
SVZFX1NUQVRFX1RDKHRjX3BvcnQpKSkgewogCQlEUk1fREVCVUdfS01TKCJUQyBQSFkgJWQgc3Vk
ZGVuIGRpc2Nvbm5lY3QuXG4iLCB0Y19wb3J0KTsKLQkJaWNsX3RjX3BoeV9kaXNjb25uZWN0KGRl
dl9wcml2LCBkaWdfcG9ydCk7CisJCWljbF90Y19waHlfZGlzY29ubmVjdChpOTE1LCBkaWdfcG9y
dCk7CiAJCXJldHVybiBmYWxzZTsKIAl9CiAKQEAgLTUzNDAsMTAgKzUzNDAsMTAgQEAgc3RhdGlj
IGJvb2wgaWNsX3RjX3BoeV9jb25uZWN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKICAqIFNlZSB0aGUgY29tbWVudCBhdCB0aGUgY29ubmVjdCBmdW5jdGlvbi4gVGhpcyBpbXBs
ZW1lbnRzIHRoZSBEaXNjb25uZWN0CiAgKiBGbG93LgogICovCi12b2lkIGljbF90Y19waHlfZGlz
Y29ubmVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGljbF90Y19w
aHlfZGlzY29ubmVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgIHN0cnVj
dCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0KQogewotCWVudW0gdGNfcG9ydCB0Y19wb3J0
ID0gaW50ZWxfcG9ydF90b190YyhkZXZfcHJpdiwgZGlnX3BvcnQtPmJhc2UucG9ydCk7CisJZW51
bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0X3RvX3RjKGk5MTUsIGRpZ19wb3J0LT5iYXNl
LnBvcnQpOwogCiAJaWYgKGRpZ19wb3J0LT50Y190eXBlID09IFRDX1BPUlRfVU5LTk9XTikKIAkJ
cmV0dXJuOwpAQCAtNTM3OCwxMSArNTM3OCwxMSBAQCB2b2lkIGljbF90Y19waHlfZGlzY29ubmVj
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBjb25uZWN0ZWQgcG9ydHMg
YXJlIHVzYWJsZSwgYW5kIGF2b2lkcyBleHBvc2luZyB0byB0aGUgdXNlcnMgb2JqZWN0cyB0aGV5
CiAgKiBjYW4ndCByZWFsbHkgdXNlLgogICovCi1zdGF0aWMgYm9vbCBpY2xfdGNfcG9ydF9jb25u
ZWN0ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgaWNs
X3RjX3BvcnRfY29ubmVjdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAg
c3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQpCiB7CiAJZW51bSBwb3J0
IHBvcnQgPSBpbnRlbF9kaWdfcG9ydC0+YmFzZS5wb3J0OwotCWVudW0gdGNfcG9ydCB0Y19wb3J0
ID0gaW50ZWxfcG9ydF90b190YyhkZXZfcHJpdiwgcG9ydCk7CisJZW51bSB0Y19wb3J0IHRjX3Bv
cnQgPSBpbnRlbF9wb3J0X3RvX3RjKGk5MTUsIHBvcnQpOwogCWJvb2wgaXNfbGVnYWN5LCBpc190
eXBlYywgaXNfdGJ0OwogCXUzMiBkcHNwOwogCkBAIC01NDA3LDE1ICs1NDA3LDE1IEBAIHN0YXRp
YyBib29sIGljbF90Y19wb3J0X2Nvbm5lY3RlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJaXNfdGJ0ID0gZHBzcCAmIFRDX0xJVkVfU1RBVEVfVEJUKHRjX3BvcnQpOwogCiAJ
aWYgKCFpc19sZWdhY3kgJiYgIWlzX3R5cGVjICYmICFpc190YnQpIHsKLQkJaWNsX3RjX3BoeV9k
aXNjb25uZWN0KGRldl9wcml2LCBpbnRlbF9kaWdfcG9ydCk7CisJCWljbF90Y19waHlfZGlzY29u
bmVjdChpOTE1LCBpbnRlbF9kaWdfcG9ydCk7CiAKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAotCWlj
bF91cGRhdGVfdGNfcG9ydF90eXBlKGRldl9wcml2LCBpbnRlbF9kaWdfcG9ydCwgaXNfbGVnYWN5
LCBpc190eXBlYywKKwlpY2xfdXBkYXRlX3RjX3BvcnRfdHlwZShpOTE1LCBpbnRlbF9kaWdfcG9y
dCwgaXNfbGVnYWN5LCBpc190eXBlYywKIAkJCQlpc190YnQpOwogCi0JaWYgKCFpY2xfdGNfcGh5
X2Nvbm5lY3QoZGV2X3ByaXYsIGludGVsX2RpZ19wb3J0KSkKKwlpZiAoIWljbF90Y19waHlfY29u
bmVjdChpOTE1LCBpbnRlbF9kaWdfcG9ydCkpCiAJCXJldHVybiBmYWxzZTsKIAogCXJldHVybiB0
cnVlOwpAQCAtNTQyMywxMyArNTQyMywxMyBAQCBzdGF0aWMgYm9vbCBpY2xfdGNfcG9ydF9jb25u
ZWN0ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgYm9vbCBp
Y2xfZGlnaXRhbF9wb3J0X2Nvbm5lY3RlZChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0g
ZW5jX3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKIAotCWlmIChpbnRlbF9wb3J0X2lzX2Nv
bWJvcGh5KGRldl9wcml2LCBlbmNvZGVyLT5wb3J0KSkKLQkJcmV0dXJuIGljbF9jb21ib19wb3J0
X2Nvbm5lY3RlZChkZXZfcHJpdiwgZGlnX3BvcnQpOwotCWVsc2UgaWYgKGludGVsX3BvcnRfaXNf
dGMoZGV2X3ByaXYsIGVuY29kZXItPnBvcnQpKQotCQlyZXR1cm4gaWNsX3RjX3BvcnRfY29ubmVj
dGVkKGRldl9wcml2LCBkaWdfcG9ydCk7CisJaWYgKGludGVsX3BvcnRfaXNfY29tYm9waHkoaTkx
NSwgZW5jb2Rlci0+cG9ydCkpCisJCXJldHVybiBpY2xfY29tYm9fcG9ydF9jb25uZWN0ZWQoaTkx
NSwgZGlnX3BvcnQpOworCWVsc2UgaWYgKGludGVsX3BvcnRfaXNfdGMoaTkxNSwgZW5jb2Rlci0+
cG9ydCkpCisJCXJldHVybiBpY2xfdGNfcG9ydF9jb25uZWN0ZWQoaTkxNSwgZGlnX3BvcnQpOwog
CWVsc2UKIAkJTUlTU0lOR19DQVNFKGVuY29kZXItPmhwZF9waW4pOwogCkBAIC01NDQ5LDQxICs1
NDQ5LDQxIEBAIHN0YXRpYyBib29sIGljbF9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyKQogICovCiBzdGF0aWMgYm9vbCBfX2ludGVsX2RpZ2l0YWxf
cG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKIAotCWlmIChIQVNfR01DSChkZXZfcHJpdikpIHsKLQkJaWYgKElTX0dNNDUoZGV2X3By
aXYpKQorCWlmIChIQVNfR01DSChpOTE1KSkgeworCQlpZiAoSVNfR000NShpOTE1KSkKIAkJCXJl
dHVybiBnbTQ1X2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoZW5jb2Rlcik7CiAJCWVsc2UKIAkJCXJl
dHVybiBnNHhfZGlnaXRhbF9wb3J0X2Nvbm5lY3RlZChlbmNvZGVyKTsKIAl9CiAKLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQogCQly
ZXR1cm4gaWNsX2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoZW5jb2Rlcik7Ci0JZWxzZSBpZiAoSVNf
R0VOKGRldl9wcml2LCAxMCkgfHwgSVNfR0VOOV9CQyhkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNf
R0VOKGk5MTUsIDEwKSB8fCBJU19HRU45X0JDKGk5MTUpKQogCQlyZXR1cm4gc3B0X2RpZ2l0YWxf
cG9ydF9jb25uZWN0ZWQoZW5jb2Rlcik7Ci0JZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikp
CisJZWxzZSBpZiAoSVNfR0VOOV9MUChpOTE1KSkKIAkJcmV0dXJuIGJ4dF9kaWdpdGFsX3BvcnRf
Y29ubmVjdGVkKGVuY29kZXIpOwotCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgOCkpCisJZWxz
ZSBpZiAoSVNfR0VOKGk5MTUsIDgpKQogCQlyZXR1cm4gYmR3X2RpZ2l0YWxfcG9ydF9jb25uZWN0
ZWQoZW5jb2Rlcik7Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA3KSkKKwllbHNlIGlmIChJ
U19HRU4oaTkxNSwgNykpCiAJCXJldHVybiBpdmJfZGlnaXRhbF9wb3J0X2Nvbm5lY3RlZChlbmNv
ZGVyKTsKLQllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDYpKQorCWVsc2UgaWYgKElTX0dFTihp
OTE1LCA2KSkKIAkJcmV0dXJuIHNuYl9kaWdpdGFsX3BvcnRfY29ubmVjdGVkKGVuY29kZXIpOwot
CWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgNSkpCisJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDUp
KQogCQlyZXR1cm4gaWxrX2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoZW5jb2Rlcik7CiAKLQlNSVNT
SU5HX0NBU0UoSU5URUxfR0VOKGRldl9wcml2KSk7CisJTUlTU0lOR19DQVNFKElOVEVMX0dFTihp
OTE1KSk7CiAJcmV0dXJuIGZhbHNlOwogfQogCiBib29sIGludGVsX2RpZ2l0YWxfcG9ydF9jb25u
ZWN0ZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAli
b29sIGlzX2Nvbm5lY3RlZCA9IGZhbHNlOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCi0J
d2l0aF9pbnRlbF9kaXNwbGF5X3Bvd2VyKGRldl9wcml2LCBQT1dFUl9ET01BSU5fRElTUExBWV9D
T1JFLCB3YWtlcmVmKQorCXdpdGhfaW50ZWxfZGlzcGxheV9wb3dlcihpOTE1LCBQT1dFUl9ET01B
SU5fRElTUExBWV9DT1JFLCB3YWtlcmVmKQogCQlpc19jb25uZWN0ZWQgPSBfX2ludGVsX2RpZ2l0
YWxfcG9ydF9jb25uZWN0ZWQoZW5jb2Rlcik7CiAKIAlyZXR1cm4gaXNfY29ubmVjdGVkOwpAQCAt
NTUzNyw3ICs1NTM3LDcgQEAgaW50ZWxfZHBfZGV0ZWN0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IsCiAJCXN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4LAogCQlib29s
IGZvcmNlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShjb25uZWN0b3ItPmRldik7CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGludGVsX2F0
dGFjaGVkX2RwKGNvbm5lY3Rvcik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3Bv
cnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIgPSAmZGlnX3BvcnQtPmJhc2U7CkBAIC01NTQ1LDcgKzU1NDUsNyBAQCBpbnRlbF9kcF9k
ZXRlY3Qoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAogCURSTV9ERUJVR19LTVMo
IltDT05ORUNUT1I6JWQ6JXNdXG4iLAogCQkgICAgICBjb25uZWN0b3ItPmJhc2UuaWQsIGNvbm5l
Y3Rvci0+bmFtZSk7Ci0JV0FSTl9PTighZHJtX21vZGVzZXRfaXNfbG9ja2VkKCZkZXZfcHJpdi0+
ZHJtLm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0ZXgpKTsKKwlXQVJOX09OKCFkcm1fbW9kZXNl
dF9pc19sb2NrZWQoJmk5MTUtPmRybS5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4KSk7CiAK
IAkvKiBDYW4ndCBkaXNjb25uZWN0IGVEUCAqLwogCWlmIChpbnRlbF9kcF9pc19lZHAoaW50ZWxf
ZHApKQpAQCAtNTU4NCw3ICs1NTg0LDcgQEAgaW50ZWxfZHBfZGV0ZWN0KHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsCiAJaW50ZWxfZHBfcHJpbnRfcmF0ZXMoaW50ZWxfZHApOwogCiAJ
LyogUmVhZCBEUCBTaW5rIERTQyBDYXAgRFBDRCByZWdzIGZvciBEUCB2MS40ICovCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJ
aW50ZWxfZHBfZ2V0X2RzY19zaW5rX2NhcChpbnRlbF9kcCk7CiAKIAlkcm1fZHBfcmVhZF9kZXNj
KCZpbnRlbF9kcC0+YXV4LCAmaW50ZWxfZHAtPmRlc2MsCkBAIC01NjQyLDcgKzU2NDIsNyBAQCBp
bnRlbF9kcF9mb3JjZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCXN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAgPSBpbnRlbF9hdHRhY2hlZF9kcChjb25uZWN0b3IpOwogCXN0cnVj
dCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHAp
OwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyID0gJmRpZ19wb3J0LT5iYXNl
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfZW5j
b2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShpbnRlbF9lbmNvZGVyLT5iYXNlLmRldik7CiAJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2Rv
bWFpbiBhdXhfZG9tYWluID0KIAkJaW50ZWxfYXV4X3Bvd2VyX2RvbWFpbihkaWdfcG9ydCk7CiAJ
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CkBAIC01NjU0LDExICs1NjU0LDExIEBAIGludGVsX2Rw
X2ZvcmNlKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAJaWYgKGNvbm5lY3Rvci0+
c3RhdHVzICE9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkKQogCQlyZXR1cm47CiAKLQl3YWtl
cmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsIGF1eF9kb21haW4pOworCXdh
a2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChpOTE1LCBhdXhfZG9tYWluKTsKIAogCWlu
dGVsX2RwX3NldF9lZGlkKGludGVsX2RwKTsKIAotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRl
dl9wcml2LCBhdXhfZG9tYWluLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChp
OTE1LCBhdXhfZG9tYWluLCB3YWtlcmVmKTsKIH0KIAogc3RhdGljIGludCBpbnRlbF9kcF9nZXRf
bW9kZXMoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKQEAgLTYzNjIsMTAgKzYzNjIs
MTAgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9oZGNwX3NoaW0gaW50ZWxfZHBfaGRjcF9z
aGltID0gewogCiBzdGF0aWMgdm9pZCBpbnRlbF9lZHBfcGFuZWxfdmRkX3Nhbml0aXplKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpk
aWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hl
bGQoJmRldl9wcml2LT5wcHNfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPnBw
c19tdXRleCk7CiAKIAlpZiAoIWVkcF9oYXZlX3BhbmVsX3ZkZChpbnRlbF9kcCkpCiAJCXJldHVy
bjsKQEAgLTYzNzcsMTggKzYzNzcsMTggQEAgc3RhdGljIHZvaWQgaW50ZWxfZWRwX3BhbmVsX3Zk
ZF9zYW5pdGl6ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCSAqIGluZGVmaW5pdGVseS4K
IAkgKi8KIAlEUk1fREVCVUdfS01TKCJWREQgbGVmdCBvbiBieSBCSU9TLCBhZGp1c3Rpbmcgc3Rh
dGUgdHJhY2tpbmdcbiIpOwotCWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGRldl9wcml2LCBpbnRl
bF9hdXhfcG93ZXJfZG9tYWluKGRpZ19wb3J0KSk7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQo
aTkxNSwgaW50ZWxfYXV4X3Bvd2VyX2RvbWFpbihkaWdfcG9ydCkpOwogCiAJZWRwX3BhbmVsX3Zk
ZF9zY2hlZHVsZV9vZmYoaW50ZWxfZHApOwogfQogCiBzdGF0aWMgZW51bSBwaXBlIHZsdl9hY3Rp
dmVfcGlwZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlOwogCWVudW0g
cGlwZSBwaXBlOwogCi0JaWYgKGludGVsX2RwX3BvcnRfZW5hYmxlZChkZXZfcHJpdiwgaW50ZWxf
ZHAtPm91dHB1dF9yZWcsCisJaWYgKGludGVsX2RwX3BvcnRfZW5hYmxlZChpOTE1LCBpbnRlbF9k
cC0+b3V0cHV0X3JlZywKIAkJCQkgIGVuY29kZXItPnBvcnQsICZwaXBlKSkKIAkJcmV0dXJuIHBp
cGU7CiAKQEAgLTYzOTcsMTIgKzYzOTcsMTIgQEAgc3RhdGljIGVudW0gcGlwZSB2bHZfYWN0aXZl
X3BpcGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogdm9pZCBpbnRlbF9kcF9lbmNvZGVy
X3Jlc2V0KHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmRldik7CiAJc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKIAlzdHJ1Y3QgaW50ZWxf
bHNwY29uICpsc3Bjb24gPSBkcF90b19sc3Bjb24oaW50ZWxfZHApOwogCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCi0JaWYgKCFIQVNfRERJKGRldl9wcml2KSkKKwlpZiAoIUhBU19EREkoaTkx
NSkpCiAJCWludGVsX2RwLT5EUCA9IEk5MTVfUkVBRChpbnRlbF9kcC0+b3V0cHV0X3JlZyk7CiAK
IAlpZiAobHNwY29uLT5hY3RpdmUpCkBAIC02NDEwLDEyICs2NDEwLDEyIEBAIHZvaWQgaW50ZWxf
ZHBfZW5jb2Rlcl9yZXNldChzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAKIAlpbnRlbF9k
cC0+cmVzZXRfbGlua19wYXJhbXMgPSB0cnVlOwogCi0JaWYgKCFJU19WQUxMRVlWSUVXKGRldl9w
cml2KSAmJiAhSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgJiYKKwlpZiAoIUlTX1ZBTExFWVZJRVco
aTkxNSkgJiYgIUlTX0NIRVJSWVZJRVcoaTkxNSkgJiYKIAkgICAgIWludGVsX2RwX2lzX2VkcChp
bnRlbF9kcCkpCiAJCXJldHVybjsKIAogCXdpdGhfcHBzX2xvY2soaW50ZWxfZHAsIHdha2VyZWYp
IHsKLQkJaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3By
aXYpKQorCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQog
CQkJaW50ZWxfZHAtPmFjdGl2ZV9waXBlID0gdmx2X2FjdGl2ZV9waXBlKGludGVsX2RwKTsKIAog
CQlpZiAoaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkgewpAQCAtNjUwOCw0MSArNjUwOCw0MSBA
QCBpbnRlbF9kcF9ocGRfcHVsc2Uoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGln
X3BvcnQsIGJvb2wgbG9uZ19ocGQpCiB9CiAKIC8qIGNoZWNrIHRoZSBWQlQgdG8gc2VlIHdoZXRo
ZXIgdGhlIGVEUCBpcyBvbiBhbm90aGVyIHBvcnQgKi8KLWJvb2wgaW50ZWxfZHBfaXNfcG9ydF9l
ZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKK2Jv
b2wgaW50ZWxfZHBfaXNfcG9ydF9lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVu
dW0gcG9ydCBwb3J0KQogewogCS8qCiAJICogZURQIG5vdCBzdXBwb3J0ZWQgb24gZzR4LiBzbyBi
YWlsIG91dCBlYXJseSBqdXN0CiAJICogZm9yIGEgYml0IGV4dHJhIHNhZmV0eSBpbiBjYXNlIHRo
ZSBWQlQgaXMgYm9ua2Vycy4KIAkgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDUpCisJ
aWYgKElOVEVMX0dFTihpOTE1KSA8IDUpCiAJCXJldHVybiBmYWxzZTsKIAotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpIDwgOSAmJiBwb3J0ID09IFBPUlRfQSkKKwlpZiAoSU5URUxfR0VOKGk5MTUp
IDwgOSAmJiBwb3J0ID09IFBPUlRfQSkKIAkJcmV0dXJuIHRydWU7CiAKLQlyZXR1cm4gaW50ZWxf
Ymlvc19pc19wb3J0X2VkcChkZXZfcHJpdiwgcG9ydCk7CisJcmV0dXJuIGludGVsX2Jpb3NfaXNf
cG9ydF9lZHAoaTkxNSwgcG9ydCk7CiB9CiAKIHN0YXRpYyB2b2lkCiBpbnRlbF9kcF9hZGRfcHJv
cGVydGllcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAq
Y29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShjb25uZWN0b3ItPmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBkcF90b19kaWdfcG9ydChp
bnRlbF9kcCktPmJhc2UucG9ydDsKIAotCWlmICghSVNfRzRYKGRldl9wcml2KSAmJiBwb3J0ICE9
IFBPUlRfQSkKKwlpZiAoIUlTX0c0WChpOTE1KSAmJiBwb3J0ICE9IFBPUlRfQSkKIAkJaW50ZWxf
YXR0YWNoX2ZvcmNlX2F1ZGlvX3Byb3BlcnR5KGNvbm5lY3Rvcik7CiAKIAlpbnRlbF9hdHRhY2hf
YnJvYWRjYXN0X3JnYl9wcm9wZXJ0eShjb25uZWN0b3IpOwotCWlmIChIQVNfR01DSChkZXZfcHJp
dikpCisJaWYgKEhBU19HTUNIKGk5MTUpKQogCQlkcm1fY29ubmVjdG9yX2F0dGFjaF9tYXhfYnBj
X3Byb3BlcnR5KGNvbm5lY3RvciwgNiwgMTApOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gNSkKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJZHJtX2Nvbm5lY3Rv
cl9hdHRhY2hfbWF4X2JwY19wcm9wZXJ0eShjb25uZWN0b3IsIDYsIDEyKTsKIAogCWlmIChpbnRl
bF9kcF9pc19lZHAoaW50ZWxfZHApKSB7CiAJCXUzMiBhbGxvd2VkX3NjYWxlcnM7CiAKIAkJYWxs
b3dlZF9zY2FsZXJzID0gQklUKERSTV9NT0RFX1NDQUxFX0FTUEVDVCkgfCBCSVQoRFJNX01PREVf
U0NBTEVfRlVMTFNDUkVFTik7Ci0JCWlmICghSEFTX0dNQ0goZGV2X3ByaXYpKQorCQlpZiAoIUhB
U19HTUNIKGk5MTUpKQogCQkJYWxsb3dlZF9zY2FsZXJzIHw9IEJJVChEUk1fTU9ERV9TQ0FMRV9D
RU5URVIpOwogCiAJCWRybV9jb25uZWN0b3JfYXR0YWNoX3NjYWxpbmdfbW9kZV9wcm9wZXJ0eShj
b25uZWN0b3IsIGFsbG93ZWRfc2NhbGVycyk7CkBAIC02NTYyLDcgKzY1NjIsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9kcF9pbml0X3BhbmVsX3Bvd2VyX3RpbWVzdGFtcHMoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIHN0YXRpYyB2b2lkCiBpbnRlbF9wcHNfcmVhZG91dF9od19zdGF0ZShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBzdHJ1Y3QgZWRwX3Bvd2VyX3NlcSAqc2VxKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJ
dTMyIHBwX29uLCBwcF9vZmYsIHBwX2N0bDsKIAlzdHJ1Y3QgcHBzX3JlZ2lzdGVycyByZWdzOwog
CkBAIC02NTcxLDcgKzY1NzEsNyBAQCBpbnRlbF9wcHNfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLCBzdHJ1Y3QgZWRwX3Bvd2VyX3NlcSAqc2VxKQogCXBwX2N0bCA9
IGlyb25sYWtlX2dldF9wcF9jb250cm9sKGludGVsX2RwKTsKIAogCS8qIEVuc3VyZSBQUFMgaXMg
dW5sb2NrZWQgKi8KLQlpZiAoIUhBU19EREkoZGV2X3ByaXYpKQorCWlmICghSEFTX0RESShpOTE1
KSkKIAkJSTkxNV9XUklURShyZWdzLnBwX2N0cmwsIHBwX2N0bCk7CiAKIAlwcF9vbiA9IEk5MTVf
UkVBRChyZWdzLnBwX29uKTsKQEAgLTY2MjEsMTEgKzY2MjEsMTEgQEAgaW50ZWxfcHBzX3Zlcmlm
eV9zdGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogc3RhdGljIHZvaWQKIGludGVsX2Rw
X2luaXRfcGFuZWxfcG93ZXJfc2VxdWVuY2VyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9k
cCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2Rw
KTsKIAlzdHJ1Y3QgZWRwX3Bvd2VyX3NlcSBjdXIsIHZidCwgc3BlYywKIAkJKmZpbmFsID0gJmlu
dGVsX2RwLT5wcHNfZGVsYXlzOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBw
c19tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+cHBzX211dGV4KTsKIAogCS8q
IGFscmVhZHkgaW5pdGlhbGl6ZWQ/ICovCiAJaWYgKGZpbmFsLT50MTFfdDEyICE9IDApCkBAIC02
NjM1LDEzICs2NjM1LDEzIEBAIGludGVsX2RwX2luaXRfcGFuZWxfcG93ZXJfc2VxdWVuY2VyKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIAlpbnRlbF9wcHNfZHVtcF9zdGF0ZSgiY3VyIiwg
JmN1cik7CiAKLQl2YnQgPSBkZXZfcHJpdi0+dmJ0LmVkcC5wcHM7CisJdmJ0ID0gaTkxNS0+dmJ0
LmVkcC5wcHM7CiAJLyogT24gVG9zaGliYSBTYXRlbGxpdGUgUDUwLUMtMThDIHN5c3RlbSB0aGUg
VkJUIFQxMiBkZWxheQogCSAqIG9mIDUwMG1zIGFwcGVhcnMgdG8gYmUgdG9vIHNob3J0LiBPY2Fz
c2lvbmFsbHkgdGhlIHBhbmVsCiAJICoganVzdCBmYWlscyB0byBwb3dlciBiYWNrIG9uLiBJbmNy
ZWFzaW5nIHRoZSBkZWxheSB0byA4MDBtcwogCSAqIHNlZW1zIHN1ZmZpY2llbnQgdG8gYXZvaWQg
dGhpcyBwcm9ibGVtLgogCSAqLwotCWlmIChkZXZfcHJpdi0+cXVpcmtzICYgUVVJUktfSU5DUkVB
U0VfVDEyX0RFTEFZKSB7CisJaWYgKGk5MTUtPnF1aXJrcyAmIFFVSVJLX0lOQ1JFQVNFX1QxMl9E
RUxBWSkgewogCQl2YnQudDExX3QxMiA9IG1heF90KHUxNiwgdmJ0LnQxMV90MTIsIDEzMDAgKiAx
MCk7CiAJCURSTV9ERUJVR19LTVMoIkluY3JlYXNpbmcgVDEyIHBhbmVsIGRlbGF5IGFzIHBlciB0
aGUgcXVpcmsgdG8gJWRcbiIsCiAJCQkgICAgICB2YnQudDExX3QxMik7CkBAIC02NzE0LDE0ICs2
NzE0LDE0IEBAIHN0YXRpYyB2b2lkCiBpbnRlbF9kcF9pbml0X3BhbmVsX3Bvd2VyX3NlcXVlbmNl
cl9yZWdpc3RlcnMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkJICAgICAgYm9vbCBm
b3JjZV9kaXNhYmxlX3ZkZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXUzMiBwcF9vbiwgcHBfb2ZmLCBwb3J0X3NlbCA9IDA7
Ci0JaW50IGRpdiA9IGRldl9wcml2LT5yYXdjbGtfZnJlcSAvIDEwMDA7CisJaW50IGRpdiA9IGk5
MTUtPnJhd2Nsa19mcmVxIC8gMTAwMDsKIAlzdHJ1Y3QgcHBzX3JlZ2lzdGVycyByZWdzOwogCWVu
dW0gcG9ydCBwb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlLnBvcnQ7CiAJY29u
c3Qgc3RydWN0IGVkcF9wb3dlcl9zZXEgKnNlcSA9ICZpbnRlbF9kcC0+cHBzX2RlbGF5czsKIAot
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5wcHNfbXV0ZXgpOworCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmk5MTUtPnBwc19tdXRleCk7CiAKIAlpbnRlbF9wcHNfZ2V0X3JlZ2lzdGVycyhp
bnRlbF9kcCwgJnJlZ3MpOwogCkBAIC02NzU3LDkgKzY3NTcsOSBAQCBpbnRlbF9kcF9pbml0X3Bh
bmVsX3Bvd2VyX3NlcXVlbmNlcl9yZWdpc3RlcnMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IAogCS8qIEhhc3dlbGwgZG9lc24ndCBoYXZlIGFueSBwb3J0IHNlbGVjdGlvbiBiaXRzIGZvciB0
aGUgcGFuZWwKIAkgKiBwb3dlciBzZXF1ZW5jZXIgYW55IG1vcmUuICovCi0JaWYgKElTX1ZBTExF
WVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJaWYgKElTX1ZB
TExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkgewogCQlwb3J0X3NlbCA9IFBB
TkVMX1BPUlRfU0VMRUNUX1ZMVihwb3J0KTsKLQl9IGVsc2UgaWYgKEhBU19QQ0hfSUJYKGRldl9w
cml2KSB8fCBIQVNfUENIX0NQVChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKEhBU19QQ0hfSUJY
KGk5MTUpIHx8IEhBU19QQ0hfQ1BUKGk5MTUpKSB7CiAJCXN3aXRjaCAocG9ydCkgewogCQljYXNl
IFBPUlRfQToKIAkJCXBvcnRfc2VsID0gUEFORUxfUE9SVF9TRUxFQ1RfRFBBOwpAQCAtNjgwNyw5
ICs2ODA3LDkgQEAgaW50ZWxfZHBfaW5pdF9wYW5lbF9wb3dlcl9zZXF1ZW5jZXJfcmVnaXN0ZXJz
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAKIHN0YXRpYyB2b2lkIGludGVsX2RwX3Bwc19p
bml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAotCWlmIChJU19WQUxMRVlWSUVX
KGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19WQUxMRVlW
SUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJdmx2X2luaXRpYWxfcG93ZXJf
c2VxdWVuY2VyX3NldHVwKGludGVsX2RwKTsKIAl9IGVsc2UgewogCQlpbnRlbF9kcF9pbml0X3Bh
bmVsX3Bvd2VyX3NlcXVlbmNlcihpbnRlbF9kcCk7CkBAIC02ODE5LDcgKzY4MTksNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9kcF9wcHNfaW5pdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCiAv
KioKICAqIGludGVsX2RwX3NldF9kcnJzX3N0YXRlIC0gcHJvZ3JhbSByZWdpc3RlcnMgZm9yIFJS
IHN3aXRjaCB0byB0YWtlIGVmZmVjdAotICogQGRldl9wcml2OiBpOTE1IGRldmljZQorICogQGk5
MTU6IGk5MTUgZGV2aWNlCiAgKiBAY3J0Y19zdGF0ZTogYSBwb2ludGVyIHRvIHRoZSBhY3RpdmUg
aW50ZWxfY3J0Y19zdGF0ZQogICogQHJlZnJlc2hfcmF0ZTogUlIgdG8gYmUgcHJvZ3JhbW1lZAog
ICoKQEAgLTY4MjgsMTUgKzY4MjgsMTUgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfcHBzX2luaXQo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKICAqIHN1cHBvcnRlZCBieSB0aGUgcGFuZWwgb3Ig
dG8gYW55IG90aGVyIFJSIGJhc2VkIG9uIG1lZGlhIHBsYXliYWNrIChpbgogICogdGhpcyBjYXNl
LCBSUiB2YWx1ZSBuZWVkcyB0byBiZSBwYXNzZWQgZnJvbSB1c2VyIHNwYWNlKS4KICAqCi0gKiBU
aGUgY2FsbGVyIG9mIHRoaXMgZnVuY3Rpb24gbmVlZHMgdG8gdGFrZSBhIGxvY2sgb24gZGV2X3By
aXYtPmRycnMuCisgKiBUaGUgY2FsbGVyIG9mIHRoaXMgZnVuY3Rpb24gbmVlZHMgdG8gdGFrZSBh
IGxvY2sgb24gaTkxNS0+ZHJycy4KICAqLwotc3RhdGljIHZvaWQgaW50ZWxfZHBfc2V0X2RycnNf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50
ZWxfZHBfc2V0X2RycnNfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJ
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICBp
bnQgcmVmcmVzaF9yYXRlKQogewogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCXN0
cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gTlVMTDsKLQlzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwID0gZGV2X3ByaXYtPmRycnMuZHA7CisJc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCA9IGk5MTUtPmRycnMuZHA7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJZW51bSBkcnJzX3JlZnJlc2hf
cmF0ZV90eXBlIGluZGV4ID0gRFJSU19ISUdIX1JSOwogCkBAIC02ODU4LDcgKzY4NTgsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9kcF9zZXRfZHJyc19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoZGV2X3ByaXYtPmRycnMudHlwZSA8
IFNFQU1MRVNTX0RSUlNfU1VQUE9SVCkgeworCWlmIChpOTE1LT5kcnJzLnR5cGUgPCBTRUFNTEVT
U19EUlJTX1NVUFBPUlQpIHsKIAkJRFJNX0RFQlVHX0tNUygiT25seSBTZWFtbGVzcyBEUlJTIHN1
cHBvcnRlZC5cbiIpOwogCQlyZXR1cm47CiAJfQpAQCAtNjg2Nyw3ICs2ODY3LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfZHBfc2V0X2RycnNfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCQkJcmVmcmVzaF9yYXRlKQogCQlpbmRleCA9IERSUlNfTE9XX1JSOwogCi0JaWYg
KGluZGV4ID09IGRldl9wcml2LT5kcnJzLnJlZnJlc2hfcmF0ZV90eXBlKSB7CisJaWYgKGluZGV4
ID09IGk5MTUtPmRycnMucmVmcmVzaF9yYXRlX3R5cGUpIHsKIAkJRFJNX0RFQlVHX0tNUygKIAkJ
CSJEUlJTIHJlcXVlc3RlZCBmb3IgcHJldmlvdXNseSBzZXQgUlIuLi5pZ25vcmluZ1xuIik7CiAJ
CXJldHVybjsKQEAgLTY4NzgsNyArNjg3OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX3NldF9k
cnJzX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuOwog
CX0KIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDggJiYgIUlTX0NIRVJSWVZJRVcoZGV2
X3ByaXYpKSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4ICYmICFJU19DSEVSUllWSUVXKGk5
MTUpKSB7CiAJCXN3aXRjaCAoaW5kZXgpIHsKIAkJY2FzZSBEUlJTX0hJR0hfUlI6CiAJCQlpbnRl
bF9kcF9zZXRfbV9uKGNydGNfc3RhdGUsIE0xX04xKTsKQEAgLTY4OTAsMTggKzY4OTAsMTggQEAg
c3RhdGljIHZvaWQgaW50ZWxfZHBfc2V0X2RycnNfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQlkZWZhdWx0OgogCQkJRFJNX0VSUk9SKCJVbnN1cHBvcnRlZCByZWZy
ZXNocmF0ZSB0eXBlXG4iKTsKIAkJfQotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
IDYpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+IDYpIHsKIAkJaTkxNV9yZWdfdCBy
ZWcgPSBQSVBFQ09ORihjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2Rlcik7CiAJCXUzMiB2YWw7CiAK
IAkJdmFsID0gSTkxNV9SRUFEKHJlZyk7CiAJCWlmIChpbmRleCA+IERSUlNfSElHSF9SUikgewot
CQkJaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYp
KQorCQkJaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJ
CQl2YWwgfD0gUElQRUNPTkZfRURQX1JSX01PREVfU1dJVENIX1ZMVjsKIAkJCWVsc2UKIAkJCQl2
YWwgfD0gUElQRUNPTkZfRURQX1JSX01PREVfU1dJVENIOwogCQl9IGVsc2UgewotCQkJaWYgKElT
X1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCQkJaWYg
KElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJCQl2YWwgJj0g
flBJUEVDT05GX0VEUF9SUl9NT0RFX1NXSVRDSF9WTFY7CiAJCQllbHNlCiAJCQkJdmFsICY9IH5Q
SVBFQ09ORl9FRFBfUlJfTU9ERV9TV0lUQ0g7CkBAIC02OTA5LDcgKzY5MDksNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9kcF9zZXRfZHJyc19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJCUk5MTVfV1JJVEUocmVnLCB2YWwpOwogCX0KIAotCWRldl9wcml2LT5kcnJzLnJl
ZnJlc2hfcmF0ZV90eXBlID0gaW5kZXg7CisJaTkxNS0+ZHJycy5yZWZyZXNoX3JhdGVfdHlwZSA9
IGluZGV4OwogCiAJRFJNX0RFQlVHX0tNUygiZURQIFJlZnJlc2ggUmF0ZSBzZXQgdG8gOiAlZEh6
XG4iLCByZWZyZXNoX3JhdGUpOwogfQpAQCAtNjkyNCwzMCArNjkyNCwzMCBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9kcF9zZXRfZHJyc19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiB2b2lkIGludGVsX2VkcF9kcnJzX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
LAogCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
IAogCWlmICghY3J0Y19zdGF0ZS0+aGFzX2RycnMpIHsKIAkJRFJNX0RFQlVHX0tNUygiUGFuZWwg
ZG9lc24ndCBzdXBwb3J0IERSUlNcbiIpOwogCQlyZXR1cm47CiAJfQogCi0JaWYgKGRldl9wcml2
LT5wc3IuZW5hYmxlZCkgeworCWlmIChpOTE1LT5wc3IuZW5hYmxlZCkgewogCQlEUk1fREVCVUdf
S01TKCJQU1IgZW5hYmxlZC4gTm90IGVuYWJsaW5nIERSUlMuXG4iKTsKIAkJcmV0dXJuOwogCX0K
IAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcnJzLm11dGV4KTsKLQlpZiAoZGV2X3ByaXYtPmRy
cnMuZHApIHsKKwltdXRleF9sb2NrKCZpOTE1LT5kcnJzLm11dGV4KTsKKwlpZiAoaTkxNS0+ZHJy
cy5kcCkgewogCQlEUk1fREVCVUdfS01TKCJEUlJTIGFscmVhZHkgZW5hYmxlZFxuIik7CiAJCWdv
dG8gdW5sb2NrOwogCX0KIAotCWRldl9wcml2LT5kcnJzLmJ1c3lfZnJvbnRidWZmZXJfYml0cyA9
IDA7CisJaTkxNS0+ZHJycy5idXN5X2Zyb250YnVmZmVyX2JpdHMgPSAwOwogCi0JZGV2X3ByaXYt
PmRycnMuZHAgPSBpbnRlbF9kcDsKKwlpOTE1LT5kcnJzLmRwID0gaW50ZWxfZHA7CiAKIHVubG9j
azoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcnJzLm11dGV4KTsKKwltdXRleF91bmxvY2so
Jmk5MTUtPmRycnMubXV0ZXgpOwogfQogCiAvKioKQEAgLTY5NTksMzYgKzY5NTksMzYgQEAgdm9p
ZCBpbnRlbF9lZHBfZHJyc19lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIHZvaWQg
aW50ZWxfZWRwX2RycnNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJ
aWYgKCFvbGRfY3J0Y19zdGF0ZS0+aGFzX2RycnMpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2so
JmRldl9wcml2LT5kcnJzLm11dGV4KTsKLQlpZiAoIWRldl9wcml2LT5kcnJzLmRwKSB7Ci0JCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPmRycnMubXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPmRy
cnMubXV0ZXgpOworCWlmICghaTkxNS0+ZHJycy5kcCkgeworCQltdXRleF91bmxvY2soJmk5MTUt
PmRycnMubXV0ZXgpOwogCQlyZXR1cm47CiAJfQogCi0JaWYgKGRldl9wcml2LT5kcnJzLnJlZnJl
c2hfcmF0ZV90eXBlID09IERSUlNfTE9XX1JSKQotCQlpbnRlbF9kcF9zZXRfZHJyc19zdGF0ZShk
ZXZfcHJpdiwgb2xkX2NydGNfc3RhdGUsCisJaWYgKGk5MTUtPmRycnMucmVmcmVzaF9yYXRlX3R5
cGUgPT0gRFJSU19MT1dfUlIpCisJCWludGVsX2RwX3NldF9kcnJzX3N0YXRlKGk5MTUsIG9sZF9j
cnRjX3N0YXRlLAogCQkJaW50ZWxfZHAtPmF0dGFjaGVkX2Nvbm5lY3Rvci0+cGFuZWwuZml4ZWRf
bW9kZS0+dnJlZnJlc2gpOwogCi0JZGV2X3ByaXYtPmRycnMuZHAgPSBOVUxMOwotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmRycnMubXV0ZXgpOworCWk5MTUtPmRycnMuZHAgPSBOVUxMOworCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJycy5tdXRleCk7CiAKLQljYW5jZWxfZGVsYXllZF93b3JrX3N5
bmMoJmRldl9wcml2LT5kcnJzLndvcmspOworCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaTkx
NS0+ZHJycy53b3JrKTsKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfZWRwX2RycnNfZG93bmNsb2Nr
X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9Ci0JCWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmRldl9wcml2KSwg
ZHJycy53b3JrLndvcmspOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KKwkJY29u
dGFpbmVyX29mKHdvcmssIHR5cGVvZigqaTkxNSksIGRycnMud29yay53b3JrKTsKIAlzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRycnMubXV0ZXgp
OworCW11dGV4X2xvY2soJmk5MTUtPmRycnMubXV0ZXgpOwogCi0JaW50ZWxfZHAgPSBkZXZfcHJp
di0+ZHJycy5kcDsKKwlpbnRlbF9kcCA9IGk5MTUtPmRycnMuZHA7CiAKIAlpZiAoIWludGVsX2Rw
KQogCQlnb3RvIHVubG9jazsKQEAgLTY5OTgsMjMgKzY5OTgsMjMgQEAgc3RhdGljIHZvaWQgaW50
ZWxfZWRwX2RycnNfZG93bmNsb2NrX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCSAq
IHJlY2hlY2suCiAJICovCiAKLQlpZiAoZGV2X3ByaXYtPmRycnMuYnVzeV9mcm9udGJ1ZmZlcl9i
aXRzKQorCWlmIChpOTE1LT5kcnJzLmJ1c3lfZnJvbnRidWZmZXJfYml0cykKIAkJZ290byB1bmxv
Y2s7CiAKLQlpZiAoZGV2X3ByaXYtPmRycnMucmVmcmVzaF9yYXRlX3R5cGUgIT0gRFJSU19MT1df
UlIpIHsKKwlpZiAoaTkxNS0+ZHJycy5yZWZyZXNoX3JhdGVfdHlwZSAhPSBEUlJTX0xPV19SUikg
ewogCQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCktPmJh
c2UuYmFzZS5jcnRjOwogCi0JCWludGVsX2RwX3NldF9kcnJzX3N0YXRlKGRldl9wcml2LCB0b19p
bnRlbF9jcnRjKGNydGMpLT5jb25maWcsCisJCWludGVsX2RwX3NldF9kcnJzX3N0YXRlKGk5MTUs
IHRvX2ludGVsX2NydGMoY3J0YyktPmNvbmZpZywKIAkJCWludGVsX2RwLT5hdHRhY2hlZF9jb25u
ZWN0b3ItPnBhbmVsLmRvd25jbG9ja19tb2RlLT52cmVmcmVzaCk7CiAJfQogCiB1bmxvY2s6Ci0J
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJycy5tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcnJzLm11dGV4KTsKIH0KIAogLyoqCiAgKiBpbnRlbF9lZHBfZHJyc19pbnZhbGlkYXRlIC0g
RGlzYWJsZSBJZGxlbmVzcyBEUlJTCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisgKiBAaTkx
NTogaTkxNSBkZXZpY2UKICAqIEBmcm9udGJ1ZmZlcl9iaXRzOiBmcm9udGJ1ZmZlciBwbGFuZSB0
cmFja2luZyBiaXRzCiAgKgogICogVGhpcyBmdW5jdGlvbiBnZXRzIGNhbGxlZCBldmVyeXRpbWUg
cmVuZGVyaW5nIG9uIHRoZSBnaXZlbiBwbGFuZXMgc3RhcnQuCkBAIC03MDIyLDQwICs3MDIyLDQw
IEBAIHN0YXRpYyB2b2lkIGludGVsX2VkcF9kcnJzX2Rvd25jbG9ja193b3JrKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd29yaykKICAqCiAgKiBEaXJ0eSBmcm9udGJ1ZmZlcnMgcmVsZXZhbnQgdG8gRFJS
UyBhcmUgdHJhY2tlZCBpbiBidXN5X2Zyb250YnVmZmVyX2JpdHMuCiAgKi8KLXZvaWQgaW50ZWxf
ZWRwX2RycnNfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2
b2lkIGludGVsX2VkcF9kcnJzX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkgICAgICAgdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpCiB7CiAJc3RydWN0
IGRybV9jcnRjICpjcnRjOwogCWVudW0gcGlwZSBwaXBlOwogCi0JaWYgKGRldl9wcml2LT5kcnJz
LnR5cGUgPT0gRFJSU19OT1RfU1VQUE9SVEVEKQorCWlmIChpOTE1LT5kcnJzLnR5cGUgPT0gRFJS
U19OT1RfU1VQUE9SVEVEKQogCQlyZXR1cm47CiAKLQljYW5jZWxfZGVsYXllZF93b3JrKCZkZXZf
cHJpdi0+ZHJycy53b3JrKTsKKwljYW5jZWxfZGVsYXllZF93b3JrKCZpOTE1LT5kcnJzLndvcmsp
OwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRycnMubXV0ZXgpOwotCWlmICghZGV2X3ByaXYt
PmRycnMuZHApIHsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJycy5tdXRleCk7CisJbXV0
ZXhfbG9jaygmaTkxNS0+ZHJycy5tdXRleCk7CisJaWYgKCFpOTE1LT5kcnJzLmRwKSB7CisJCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJycy5tdXRleCk7CiAJCXJldHVybjsKIAl9CiAKLQljcnRjID0g
ZHBfdG9fZGlnX3BvcnQoZGV2X3ByaXYtPmRycnMuZHApLT5iYXNlLmJhc2UuY3J0YzsKKwljcnRj
ID0gZHBfdG9fZGlnX3BvcnQoaTkxNS0+ZHJycy5kcCktPmJhc2UuYmFzZS5jcnRjOwogCXBpcGUg
PSB0b19pbnRlbF9jcnRjKGNydGMpLT5waXBlOwogCiAJZnJvbnRidWZmZXJfYml0cyAmPSBJTlRF
TF9GUk9OVEJVRkZFUl9BTExfTUFTSyhwaXBlKTsKLQlkZXZfcHJpdi0+ZHJycy5idXN5X2Zyb250
YnVmZmVyX2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKKwlpOTE1LT5kcnJzLmJ1c3lfZnJvbnRi
dWZmZXJfYml0cyB8PSBmcm9udGJ1ZmZlcl9iaXRzOwogCiAJLyogaW52YWxpZGF0ZSBtZWFucyBi
dXN5IHNjcmVlbiBoZW5jZSB1cGNsb2NrICovCi0JaWYgKGZyb250YnVmZmVyX2JpdHMgJiYgZGV2
X3ByaXYtPmRycnMucmVmcmVzaF9yYXRlX3R5cGUgPT0gRFJSU19MT1dfUlIpCi0JCWludGVsX2Rw
X3NldF9kcnJzX3N0YXRlKGRldl9wcml2LCB0b19pbnRlbF9jcnRjKGNydGMpLT5jb25maWcsCi0J
CQlkZXZfcHJpdi0+ZHJycy5kcC0+YXR0YWNoZWRfY29ubmVjdG9yLT5wYW5lbC5maXhlZF9tb2Rl
LT52cmVmcmVzaCk7CisJaWYgKGZyb250YnVmZmVyX2JpdHMgJiYgaTkxNS0+ZHJycy5yZWZyZXNo
X3JhdGVfdHlwZSA9PSBEUlJTX0xPV19SUikKKwkJaW50ZWxfZHBfc2V0X2RycnNfc3RhdGUoaTkx
NSwgdG9faW50ZWxfY3J0YyhjcnRjKS0+Y29uZmlnLAorCQkJaTkxNS0+ZHJycy5kcC0+YXR0YWNo
ZWRfY29ubmVjdG9yLT5wYW5lbC5maXhlZF9tb2RlLT52cmVmcmVzaCk7CiAKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT5kcnJzLm11dGV4KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRycnMubXV0
ZXgpOwogfQogCiAvKioKICAqIGludGVsX2VkcF9kcnJzX2ZsdXNoIC0gUmVzdGFydCBJZGxlbmVz
cyBEUlJTCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UK
ICAqIEBmcm9udGJ1ZmZlcl9iaXRzOiBmcm9udGJ1ZmZlciBwbGFuZSB0cmFja2luZyBiaXRzCiAg
KgogICogVGhpcyBmdW5jdGlvbiBnZXRzIGNhbGxlZCBldmVyeSB0aW1lIHJlbmRlcmluZyBvbiB0
aGUgZ2l2ZW4gcGxhbmVzIGhhcwpAQCAtNzA2NSw0MiArNzA2NSw0MiBAQCB2b2lkIGludGVsX2Vk
cF9kcnJzX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICoK
ICAqIERpcnR5IGZyb250YnVmZmVycyByZWxldmFudCB0byBEUlJTIGFyZSB0cmFja2VkIGluIGJ1
c3lfZnJvbnRidWZmZXJfYml0cy4KICAqLwotdm9pZCBpbnRlbF9lZHBfZHJyc19mbHVzaChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2VkcF9kcnJzX2ZsdXNo
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICB1bnNpZ25lZCBpbnQgZnJvbnRi
dWZmZXJfYml0cykKIHsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CiAJZW51bSBwaXBlIHBpcGU7
CiAKLQlpZiAoZGV2X3ByaXYtPmRycnMudHlwZSA9PSBEUlJTX05PVF9TVVBQT1JURUQpCisJaWYg
KGk5MTUtPmRycnMudHlwZSA9PSBEUlJTX05PVF9TVVBQT1JURUQpCiAJCXJldHVybjsKIAotCWNh
bmNlbF9kZWxheWVkX3dvcmsoJmRldl9wcml2LT5kcnJzLndvcmspOworCWNhbmNlbF9kZWxheWVk
X3dvcmsoJmk5MTUtPmRycnMud29yayk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJycy5t
dXRleCk7Ci0JaWYgKCFkZXZfcHJpdi0+ZHJycy5kcCkgewotCQltdXRleF91bmxvY2soJmRldl9w
cml2LT5kcnJzLm11dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5kcnJzLm11dGV4KTsKKwlpZiAo
IWk5MTUtPmRycnMuZHApIHsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcnJzLm11dGV4KTsKIAkJ
cmV0dXJuOwogCX0KIAotCWNydGMgPSBkcF90b19kaWdfcG9ydChkZXZfcHJpdi0+ZHJycy5kcCkt
PmJhc2UuYmFzZS5jcnRjOworCWNydGMgPSBkcF90b19kaWdfcG9ydChpOTE1LT5kcnJzLmRwKS0+
YmFzZS5iYXNlLmNydGM7CiAJcGlwZSA9IHRvX2ludGVsX2NydGMoY3J0YyktPnBpcGU7CiAKIAlm
cm9udGJ1ZmZlcl9iaXRzICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKHBpcGUpOwotCWRl
dl9wcml2LT5kcnJzLmJ1c3lfZnJvbnRidWZmZXJfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsK
KwlpOTE1LT5kcnJzLmJ1c3lfZnJvbnRidWZmZXJfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsK
IAogCS8qIGZsdXNoIG1lYW5zIGJ1c3kgc2NyZWVuIGhlbmNlIHVwY2xvY2sgKi8KLQlpZiAoZnJv
bnRidWZmZXJfYml0cyAmJiBkZXZfcHJpdi0+ZHJycy5yZWZyZXNoX3JhdGVfdHlwZSA9PSBEUlJT
X0xPV19SUikKLQkJaW50ZWxfZHBfc2V0X2RycnNfc3RhdGUoZGV2X3ByaXYsIHRvX2ludGVsX2Ny
dGMoY3J0YyktPmNvbmZpZywKLQkJCQlkZXZfcHJpdi0+ZHJycy5kcC0+YXR0YWNoZWRfY29ubmVj
dG9yLT5wYW5lbC5maXhlZF9tb2RlLT52cmVmcmVzaCk7CisJaWYgKGZyb250YnVmZmVyX2JpdHMg
JiYgaTkxNS0+ZHJycy5yZWZyZXNoX3JhdGVfdHlwZSA9PSBEUlJTX0xPV19SUikKKwkJaW50ZWxf
ZHBfc2V0X2RycnNfc3RhdGUoaTkxNSwgdG9faW50ZWxfY3J0YyhjcnRjKS0+Y29uZmlnLAorCQkJ
CWk5MTUtPmRycnMuZHAtPmF0dGFjaGVkX2Nvbm5lY3Rvci0+cGFuZWwuZml4ZWRfbW9kZS0+dnJl
ZnJlc2gpOwogCiAJLyoKIAkgKiBmbHVzaCBhbHNvIG1lYW5zIG5vIG1vcmUgYWN0aXZpdHkgaGVu
Y2Ugc2NoZWR1bGUgZG93bmNsb2NrLCBpZiBhbGwKIAkgKiBvdGhlciBmYnMgYXJlIHF1aWVzY2Vu
dCB0b28KIAkgKi8KLQlpZiAoIWRldl9wcml2LT5kcnJzLmJ1c3lfZnJvbnRidWZmZXJfYml0cykK
LQkJc2NoZWR1bGVfZGVsYXllZF93b3JrKCZkZXZfcHJpdi0+ZHJycy53b3JrLAorCWlmICghaTkx
NS0+ZHJycy5idXN5X2Zyb250YnVmZmVyX2JpdHMpCisJCXNjaGVkdWxlX2RlbGF5ZWRfd29yaygm
aTkxNS0+ZHJycy53b3JrLAogCQkJCW1zZWNzX3RvX2ppZmZpZXMoMTAwMCkpOwotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmRycnMubXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJycy5t
dXRleCk7CiB9CiAKIC8qKgpAQCAtNzE1NywxOCArNzE1NywxOCBAQCBzdGF0aWMgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKgogaW50ZWxfZHBfZHJyc19pbml0KHN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvciwKIAkJICAgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmZpeGVkX21vZGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0
b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
Y29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmRvd25jbG9j
a19tb2RlID0gTlVMTDsKIAotCUlOSVRfREVMQVlFRF9XT1JLKCZkZXZfcHJpdi0+ZHJycy53b3Jr
LCBpbnRlbF9lZHBfZHJyc19kb3duY2xvY2tfd29yayk7Ci0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYt
PmRycnMubXV0ZXgpOworCUlOSVRfREVMQVlFRF9XT1JLKCZpOTE1LT5kcnJzLndvcmssIGludGVs
X2VkcF9kcnJzX2Rvd25jbG9ja193b3JrKTsKKwltdXRleF9pbml0KCZpOTE1LT5kcnJzLm11dGV4
KTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDYpIHsKKwlpZiAoSU5URUxfR0VOKGk5
MTUpIDw9IDYpIHsKIAkJRFJNX0RFQlVHX0tNUygiRFJSUyBzdXBwb3J0ZWQgZm9yIEdlbjcgYW5k
IGFib3ZlXG4iKTsKIAkJcmV0dXJuIE5VTEw7CiAJfQogCi0JaWYgKGRldl9wcml2LT52YnQuZHJy
c190eXBlICE9IFNFQU1MRVNTX0RSUlNfU1VQUE9SVCkgeworCWlmIChpOTE1LT52YnQuZHJyc190
eXBlICE9IFNFQU1MRVNTX0RSUlNfU1VQUE9SVCkgewogCQlEUk1fREVCVUdfS01TKCJWQlQgZG9l
c24ndCBzdXBwb3J0IERSUlNcbiIpOwogCQlyZXR1cm4gTlVMTDsKIAl9CkBAIC03MTc5LDkgKzcx
NzksOSBAQCBpbnRlbF9kcF9kcnJzX2luaXQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVj
dG9yLAogCQlyZXR1cm4gTlVMTDsKIAl9CiAKLQlkZXZfcHJpdi0+ZHJycy50eXBlID0gZGV2X3By
aXYtPnZidC5kcnJzX3R5cGU7CisJaTkxNS0+ZHJycy50eXBlID0gaTkxNS0+dmJ0LmRycnNfdHlw
ZTsKIAotCWRldl9wcml2LT5kcnJzLnJlZnJlc2hfcmF0ZV90eXBlID0gRFJSU19ISUdIX1JSOwor
CWk5MTUtPmRycnMucmVmcmVzaF9yYXRlX3R5cGUgPSBEUlJTX0hJR0hfUlI7CiAJRFJNX0RFQlVH
X0tNUygic2VhbWxlc3MgRFJSUyBzdXBwb3J0ZWQgZm9yIGVEUCBwYW5lbC5cbiIpOwogCXJldHVy
biBkb3duY2xvY2tfbW9kZTsKIH0KQEAgLTcxODksOCArNzE4OSw4IEBAIGludGVsX2RwX2RycnNf
aW5pdChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiBzdGF0aWMgYm9vbCBpbnRl
bF9lZHBfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAg
IHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gJmludGVs
X2Nvbm5lY3Rvci0+YmFzZTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZml4ZWRfbW9kZSA9
IE5VTEw7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmRvd25jbG9ja19tb2RlID0gTlVMTDsK
QEAgLTcyMTAsOCArNzIxMCw4IEBAIHN0YXRpYyBib29sIGludGVsX2VkcF9pbml0X2Nvbm5lY3Rv
cihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCSAqIGVEUCBhbmQgTFZEUyBiYWlsIG91dCBl
YXJseSBpbiB0aGlzIGNhc2UgdG8gcHJldmVudCBpbnRlcmZlcmluZwogCSAqIHdpdGggYW4gYWxy
ZWFkeSBwb3dlcmVkLW9uIExWRFMgcG93ZXIgc2VxdWVuY2VyLgogCSAqLwotCWlmIChpbnRlbF9n
ZXRfbHZkc19lbmNvZGVyKGRldl9wcml2KSkgewotCQlXQVJOX09OKCEoSEFTX1BDSF9JQlgoZGV2
X3ByaXYpIHx8IEhBU19QQ0hfQ1BUKGRldl9wcml2KSkpOworCWlmIChpbnRlbF9nZXRfbHZkc19l
bmNvZGVyKGk5MTUpKSB7CisJCVdBUk5fT04oIShIQVNfUENIX0lCWChpOTE1KSB8fCBIQVNfUENI
X0NQVChpOTE1KSkpOwogCQlEUk1fSU5GTygiTFZEUyB3YXMgZGV0ZWN0ZWQsIG5vdCByZWdpc3Rl
cmluZyBlRFBcbiIpOwogCiAJCXJldHVybiBmYWxzZTsKQEAgLTcyNTYsNyArNzI1Niw3IEBAIHN0
YXRpYyBib29sIGludGVsX2VkcF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAogCQlmaXhlZF9tb2RlID0gaW50ZWxfcGFuZWxfdmJ0X2ZpeGVkX21vZGUoaW50ZWxfY29u
bmVjdG9yKTsKIAltdXRleF91bmxvY2soJmRldi0+bW9kZV9jb25maWcubXV0ZXgpOwogCi0JaWYg
KElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJ
aWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkgewogCQlpbnRl
bF9kcC0+ZWRwX25vdGlmaWVyLm5vdGlmaWVyX2NhbGwgPSBlZHBfbm90aWZ5X2hhbmRsZXI7CiAJ
CXJlZ2lzdGVyX3JlYm9vdF9ub3RpZmllcigmaW50ZWxfZHAtPmVkcF9ub3RpZmllcik7CiAKQEAg
LTczMzAsNyArNzMzMCw3IEBAIGludGVsX2RwX2luaXRfY29ubmVjdG9yKHN0cnVjdCBpbnRlbF9k
aWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAg
PSAmaW50ZWxfZGlnX3BvcnQtPmRwOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNv
ZGVyID0gJmludGVsX2RpZ19wb3J0LT5iYXNlOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBp
bnRlbF9lbmNvZGVyLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9lbmNvZGVyLT5wb3J0OwogCWludCB0
eXBlOwogCkBAIC03MzUzLDE4ICs3MzUzLDE4IEBAIGludGVsX2RwX2luaXRfY29ubmVjdG9yKHN0
cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCWludGVsX2RwLT5EUCA9
IEk5MTVfUkVBRChpbnRlbF9kcC0+b3V0cHV0X3JlZyk7CiAJaW50ZWxfZHAtPmF0dGFjaGVkX2Nv
bm5lY3RvciA9IGludGVsX2Nvbm5lY3RvcjsKIAotCWlmIChpbnRlbF9kcF9pc19wb3J0X2VkcChk
ZXZfcHJpdiwgcG9ydCkpIHsKKwlpZiAoaW50ZWxfZHBfaXNfcG9ydF9lZHAoaTkxNSwgcG9ydCkp
IHsKIAkJLyoKIAkJICogQ3VycmVudGx5IHdlIGRvbid0IHN1cHBvcnQgZURQIG9uIFR5cGVDIHBv
cnRzLCBhbHRob3VnaCBpbgogCQkgKiB0aGVvcnkgaXQgY291bGQgd29yayBvbiBUeXBlQyBsZWdh
Y3kgcG9ydHMuCiAJCSAqLwotCQlXQVJOX09OKGludGVsX3BvcnRfaXNfdGMoZGV2X3ByaXYsIHBv
cnQpKTsKKwkJV0FSTl9PTihpbnRlbF9wb3J0X2lzX3RjKGk5MTUsIHBvcnQpKTsKIAkJdHlwZSA9
IERSTV9NT0RFX0NPTk5FQ1RPUl9lRFA7CiAJfSBlbHNlIHsKIAkJdHlwZSA9IERSTV9NT0RFX0NP
Tk5FQ1RPUl9EaXNwbGF5UG9ydDsKIAl9CiAKLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikg
fHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwg
SVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJaW50ZWxfZHAtPmFjdGl2ZV9waXBlID0gdmx2X2FjdGl2
ZV9waXBlKGludGVsX2RwKTsKIAogCS8qCkBAIC03Mzc2LDcgKzczNzYsNyBAQCBpbnRlbF9kcF9p
bml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwK
IAkJaW50ZWxfZW5jb2Rlci0+dHlwZSA9IElOVEVMX09VVFBVVF9FRFA7CiAKIAkvKiBlRFAgb25s
eSBvbiBwb3J0IEIgYW5kL29yIEMgb24gdmx2L2NodiAqLwotCWlmIChXQVJOX09OKChJU19WQUxM
RVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgJiYKKwlpZiAoV0FS
Tl9PTigoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSAmJgogCQkg
ICAgaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSAmJgogCQkgICAgcG9ydCAhPSBQT1JUX0IgJiYg
cG9ydCAhPSBQT1JUX0MpKQogCQlyZXR1cm4gZmFsc2U7CkBAIC03Mzg4LDI2ICs3Mzg4LDI2IEBA
IGludGVsX2RwX2luaXRfY29ubmVjdG9yKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVs
X2RpZ19wb3J0LAogCWRybV9jb25uZWN0b3JfaW5pdChkZXYsIGNvbm5lY3RvciwgJmludGVsX2Rw
X2Nvbm5lY3Rvcl9mdW5jcywgdHlwZSk7CiAJZHJtX2Nvbm5lY3Rvcl9oZWxwZXJfYWRkKGNvbm5l
Y3RvciwgJmludGVsX2RwX2Nvbm5lY3Rvcl9oZWxwZXJfZnVuY3MpOwogCi0JaWYgKCFIQVNfR01D
SChkZXZfcHJpdikpCisJaWYgKCFIQVNfR01DSChpOTE1KSkKIAkJY29ubmVjdG9yLT5pbnRlcmxh
Y2VfYWxsb3dlZCA9IHRydWU7CiAJY29ubmVjdG9yLT5kb3VibGVzY2FuX2FsbG93ZWQgPSAwOwog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+
PSAxMSkKIAkJY29ubmVjdG9yLT55Y2Jjcl80MjBfYWxsb3dlZCA9IHRydWU7CiAKLQlpbnRlbF9l
bmNvZGVyLT5ocGRfcGluID0gaW50ZWxfaHBkX3Bpbl9kZWZhdWx0KGRldl9wcml2LCBwb3J0KTsK
KwlpbnRlbF9lbmNvZGVyLT5ocGRfcGluID0gaW50ZWxfaHBkX3Bpbl9kZWZhdWx0KGk5MTUsIHBv
cnQpOwogCiAJaW50ZWxfZHBfYXV4X2luaXQoaW50ZWxfZHApOwogCiAJaW50ZWxfY29ubmVjdG9y
X2F0dGFjaF9lbmNvZGVyKGludGVsX2Nvbm5lY3RvciwgaW50ZWxfZW5jb2Rlcik7CiAKLQlpZiAo
SEFTX0RESShkZXZfcHJpdikpCisJaWYgKEhBU19EREkoaTkxNSkpCiAJCWludGVsX2Nvbm5lY3Rv
ci0+Z2V0X2h3X3N0YXRlID0gaW50ZWxfZGRpX2Nvbm5lY3Rvcl9nZXRfaHdfc3RhdGU7CiAJZWxz
ZQogCQlpbnRlbF9jb25uZWN0b3ItPmdldF9od19zdGF0ZSA9IGludGVsX2Nvbm5lY3Rvcl9nZXRf
aHdfc3RhdGU7CiAKIAkvKiBpbml0IE1TVCBvbiBwb3J0cyB0aGF0IGNhbiBzdXBwb3J0IGl0ICov
Ci0JaWYgKEhBU19EUF9NU1QoZGV2X3ByaXYpICYmICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHAp
ICYmCisJaWYgKEhBU19EUF9NU1QoaTkxNSkgJiYgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkg
JiYKIAkgICAgKHBvcnQgPT0gUE9SVF9CIHx8IHBvcnQgPT0gUE9SVF9DIHx8CiAJICAgICBwb3J0
ID09IFBPUlRfRCB8fCBwb3J0ID09IFBPUlRfRikpCiAJCWludGVsX2RwX21zdF9lbmNvZGVyX2lu
aXQoaW50ZWxfZGlnX3BvcnQsCkBAIC03NDIxLDcgKzc0MjEsNyBAQCBpbnRlbF9kcF9pbml0X2Nv
bm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKIAogCWlu
dGVsX2RwX2FkZF9wcm9wZXJ0aWVzKGludGVsX2RwLCBjb25uZWN0b3IpOwogCi0JaWYgKGlzX2hk
Y3Bfc3VwcG9ydGVkKGRldl9wcml2LCBwb3J0KSAmJiAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2Rw
KSkgeworCWlmIChpc19oZGNwX3N1cHBvcnRlZChpOTE1LCBwb3J0KSAmJiAhaW50ZWxfZHBfaXNf
ZWRwKGludGVsX2RwKSkgewogCQlpbnQgcmV0ID0gaW50ZWxfaGRjcF9pbml0KGludGVsX2Nvbm5l
Y3RvciwgJmludGVsX2RwX2hkY3Bfc2hpbSk7CiAJCWlmIChyZXQpCiAJCQlEUk1fREVCVUdfS01T
KCJIRENQIGluaXQgZmFpbGVkLCBza2lwcGluZy5cbiIpOwpAQCAtNzQzMSw3ICs3NDMxLDcgQEAg
aW50ZWxfZHBfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxf
ZGlnX3BvcnQsCiAJICogMHhkLiAgRmFpbHVyZSB0byBkbyBzbyB3aWxsIHJlc3VsdCBpbiBzcHVy
aW91cyBpbnRlcnJ1cHRzIGJlaW5nCiAJICogZ2VuZXJhdGVkIG9uIHRoZSBwb3J0IHdoZW4gYSBj
YWJsZSBpcyBub3QgYXR0YWNoZWQuCiAJICovCi0JaWYgKElTX0c0NShkZXZfcHJpdikpIHsKKwlp
ZiAoSVNfRzQ1KGk5MTUpKSB7CiAJCXUzMiB0ZW1wID0gSTkxNV9SRUFEKFBFR19CQU5EX0dBUF9E
QVRBKTsKIAkJSTkxNV9XUklURShQRUdfQkFORF9HQVBfREFUQSwgKHRlbXAgJiB+MHhmKSB8IDB4
ZCk7CiAJfQpAQCAtNzQ0NCw3ICs3NDQ0LDcgQEAgaW50ZWxfZHBfaW5pdF9jb25uZWN0b3Ioc3Ry
dWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiAJcmV0dXJuIGZhbHNlOwog
fQogCi1ib29sIGludGVsX2RwX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorYm9vbCBpbnRlbF9kcF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkg
ICBpOTE1X3JlZ190IG91dHB1dF9yZWcsCiAJCSAgIGVudW0gcG9ydCBwb3J0KQogewpAQCAtNzQ2
NCw3ICs3NDY0LDcgQEAgYm9vbCBpbnRlbF9kcF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlpbnRlbF9lbmNvZGVyID0gJmludGVsX2RpZ19wb3J0LT5iYXNlOwogCWVu
Y29kZXIgPSAmaW50ZWxfZW5jb2Rlci0+YmFzZTsKIAotCWlmIChkcm1fZW5jb2Rlcl9pbml0KCZk
ZXZfcHJpdi0+ZHJtLCAmaW50ZWxfZW5jb2Rlci0+YmFzZSwKKwlpZiAoZHJtX2VuY29kZXJfaW5p
dCgmaTkxNS0+ZHJtLCAmaW50ZWxfZW5jb2Rlci0+YmFzZSwKIAkJCSAgICAgJmludGVsX2RwX2Vu
Y19mdW5jcywgRFJNX01PREVfRU5DT0RFUl9UTURTLAogCQkJICAgICAiRFAgJWMiLCBwb3J0X25h
bWUocG9ydCkpKQogCQlnb3RvIGVycl9lbmNvZGVyX2luaXQ7CkBAIC03NDc1LDE0ICs3NDc1LDE0
IEBAIGJvb2wgaW50ZWxfZHBfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJaW50ZWxfZW5jb2Rlci0+Z2V0X2NvbmZpZyA9IGludGVsX2RwX2dldF9jb25maWc7CiAJaW50
ZWxfZW5jb2Rlci0+dXBkYXRlX3BpcGUgPSBpbnRlbF9wYW5lbF91cGRhdGVfYmFja2xpZ2h0Owog
CWludGVsX2VuY29kZXItPnN1c3BlbmQgPSBpbnRlbF9kcF9lbmNvZGVyX3N1c3BlbmQ7Ci0JaWYg
KElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkpIHsK
IAkJaW50ZWxfZW5jb2Rlci0+cHJlX3BsbF9lbmFibGUgPSBjaHZfZHBfcHJlX3BsbF9lbmFibGU7
CiAJCWludGVsX2VuY29kZXItPnByZV9lbmFibGUgPSBjaHZfcHJlX2VuYWJsZV9kcDsKIAkJaW50
ZWxfZW5jb2Rlci0+ZW5hYmxlID0gdmx2X2VuYWJsZV9kcDsKIAkJaW50ZWxfZW5jb2Rlci0+ZGlz
YWJsZSA9IHZsdl9kaXNhYmxlX2RwOwogCQlpbnRlbF9lbmNvZGVyLT5wb3N0X2Rpc2FibGUgPSBj
aHZfcG9zdF9kaXNhYmxlX2RwOwogCQlpbnRlbF9lbmNvZGVyLT5wb3N0X3BsbF9kaXNhYmxlID0g
Y2h2X2RwX3Bvc3RfcGxsX2Rpc2FibGU7Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9w
cml2KSkgeworCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkgewogCQlpbnRlbF9lbmNv
ZGVyLT5wcmVfcGxsX2VuYWJsZSA9IHZsdl9kcF9wcmVfcGxsX2VuYWJsZTsKIAkJaW50ZWxfZW5j
b2Rlci0+cHJlX2VuYWJsZSA9IHZsdl9wcmVfZW5hYmxlX2RwOwogCQlpbnRlbF9lbmNvZGVyLT5l
bmFibGUgPSB2bHZfZW5hYmxlX2RwOwpAQCAtNzUwMCw3ICs3NTAwLDcgQEAgYm9vbCBpbnRlbF9k
cF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCWludGVsX2VuY29k
ZXItPnR5cGUgPSBJTlRFTF9PVVRQVVRfRFA7CiAJaW50ZWxfZW5jb2Rlci0+cG93ZXJfZG9tYWlu
ID0gaW50ZWxfcG9ydF90b19wb3dlcl9kb21haW4ocG9ydCk7Ci0JaWYgKElTX0NIRVJSWVZJRVco
ZGV2X3ByaXYpKSB7CisJaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJaWYgKHBvcnQgPT0g
UE9SVF9EKQogCQkJaW50ZWxfZW5jb2Rlci0+Y3J0Y19tYXNrID0gMSA8PCAyOwogCQllbHNlCkBA
IC03NTE2LDcgKzc1MTYsNyBAQCBib29sIGludGVsX2RwX2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCWlmIChwb3J0ICE9IFBPUlRfQSkKIAkJaW50ZWxfaW5mb2ZyYW1l
X2luaXQoaW50ZWxfZGlnX3BvcnQpOwogCi0JaW50ZWxfZGlnX3BvcnQtPmF1eF9jaCA9IGludGVs
X2Jpb3NfcG9ydF9hdXhfY2goZGV2X3ByaXYsIHBvcnQpOworCWludGVsX2RpZ19wb3J0LT5hdXhf
Y2ggPSBpbnRlbF9iaW9zX3BvcnRfYXV4X2NoKGk5MTUsIHBvcnQpOwogCWlmICghaW50ZWxfZHBf
aW5pdF9jb25uZWN0b3IoaW50ZWxfZGlnX3BvcnQsIGludGVsX2Nvbm5lY3RvcikpCiAJCWdvdG8g
ZXJyX2luaXRfY29ubmVjdG9yOwogCkBAIC03NTMxLDExICs3NTMxLDExIEBAIGJvb2wgaW50ZWxf
ZHBfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIGZhbHNl
OwogfQogCi12b2lkIGludGVsX2RwX21zdF9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfZHBfbXN0X3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAKLQlmb3Jf
ZWFjaF9pbnRlbF9lbmNvZGVyKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJZm9yX2VhY2hf
aW50ZWxfZW5jb2RlcigmaTkxNS0+ZHJtLCBlbmNvZGVyKSB7CiAJCXN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHA7CiAKIAkJaWYgKGVuY29kZXItPnR5cGUgIT0gSU5URUxfT1VUUFVUX0RESSkKQEAg
LTc1NTEsMTEgKzc1NTEsMTEgQEAgdm9pZCBpbnRlbF9kcF9tc3Rfc3VzcGVuZChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi12b2lkIGludGVsX2RwX21zdF9yZXN1
bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9kcF9tc3Rf
cmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyOwogCi0JZm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRy
bSwgZW5jb2RlcikgeworCWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmk5MTUtPmRybSwgZW5jb2Rl
cikgewogCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwogCQlpbnQgcmV0OwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfZHAuaAppbmRleCBkYTcwYjFhNDFjODMuLmI2ZmVjYjE4NWIyMyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHAuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9kcC5oCkBAIC0zNSwxMCArMzUsMTAgQEAgdm9pZCBpbnRlbF9kcF9hZGp1c3Rf
Y29tcGxpYW5jZV9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIGJvb2wgaW50ZWxf
ZHBfbGltaXRlZF9jb2xvcl9yYW5nZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIAkJCQkgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0
YXRlKTsKIGludCBpbnRlbF9kcF9taW5fYnBwKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKTsKLWJvb2wgaW50ZWxfZHBfcG9ydF9lbmFibGVkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKK2Jvb2wgaW50ZWxfZHBfcG9ydF9lbmFibGVkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgaTkxNV9yZWdfdCBkcF9yZWcsIGVudW0gcG9y
dCBwb3J0LAogCQkJICAgZW51bSBwaXBlICpwaXBlKTsKLWJvb2wgaW50ZWxfZHBfaW5pdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGk5MTVfcmVnX3Qgb3V0cHV0X3JlZywKK2Jv
b2wgaW50ZWxfZHBfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaTkxNV9yZWdf
dCBvdXRwdXRfcmVnLAogCQkgICBlbnVtIHBvcnQgcG9ydCk7CiBib29sIGludGVsX2RwX2luaXRf
Y29ubmVjdG9yKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCQkJ
ICAgICBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpOwpAQCAtNjAsNyAr
NjAsNyBAQCBpbnQgaW50ZWxfZHBfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAog
CQkJICAgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKTsKIGJvb2wgaW50
ZWxfZHBfaXNfZWRwKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwotYm9vbCBpbnRlbF9kcF9p
c19wb3J0X2VkcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBw
b3J0KTsKK2Jvb2wgaW50ZWxfZHBfaXNfcG9ydF9lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIGVudW0gcG9ydCBwb3J0KTsKIGVudW0gaXJxcmV0dXJuIGludGVsX2RwX2hwZF9wdWxz
ZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKIAkJCQkgIGJvb2wg
bG9uZ19ocGQpOwogdm9pZCBpbnRlbF9lZHBfYmFja2xpZ2h0X29uKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtNjksMjEgKzY5LDIxIEBAIHZvaWQgaW50ZWxf
ZWRwX2JhY2tsaWdodF9vZmYoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5f
c3RhdGUpOwogdm9pZCBpbnRlbF9lZHBfcGFuZWxfdmRkX29uKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApOwogdm9pZCBpbnRlbF9lZHBfcGFuZWxfb24oc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCk7CiB2b2lkIGludGVsX2VkcF9wYW5lbF9vZmYoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7
Ci12b2lkIGludGVsX2RwX21zdF9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdik7Ci12b2lkIGludGVsX2RwX21zdF9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfZHBfbXN0X3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOwordm9pZCBpbnRlbF9kcF9tc3RfcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKIGludCBpbnRlbF9kcF9tYXhfbGlua19yYXRlKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApOwogaW50IGludGVsX2RwX21heF9sYW5lX2NvdW50KHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApOwogaW50IGludGVsX2RwX3JhdGVfc2VsZWN0KHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsIGludCByYXRlKTsKLXZvaWQgaW50ZWxfcG93ZXJfc2VxdWVuY2VyX3Jlc2V0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX3Bvd2VyX3NlcXVl
bmNlcl9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB1MzIgaW50ZWxfZHBf
cGFja19hdXgoY29uc3QgdTggKnNyYywgaW50IHNyY19ieXRlcyk7CiAKIHZvaWQgaW50ZWxfZWRw
X2RycnNfZW5hYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiB2b2lkIGludGVsX2VkcF9kcnJzX2Rp
c2FibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCSAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Ci12b2lkIGludGVsX2VkcF9kcnJzX2ludmFsaWRh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9lZHBfZHJy
c19pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgIHVu
c2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzKTsKLXZvaWQgaW50ZWxfZWRwX2RycnNfZmx1c2go
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9lZHBfZHJyc19m
bHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgdW5zaWduZWQgaW50IGZy
b250YnVmZmVyX2JpdHMpOwogCiB2b2lkCkBAIC0xMTIsNyArMTEyLDcgQEAgYm9vbCBpbnRlbF9k
cF9nZXRfY29sb3JpbWV0cnlfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogaW50
IGludGVsX2RwX2xpbmtfcmVxdWlyZWQoaW50IHBpeGVsX2Nsb2NrLCBpbnQgYnBwKTsKIGludCBp
bnRlbF9kcF9tYXhfZGF0YV9yYXRlKGludCBtYXhfbGlua19jbG9jaywgaW50IG1heF9sYW5lcyk7
CiBib29sIGludGVsX2RpZ2l0YWxfcG9ydF9jb25uZWN0ZWQoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIpOwotdm9pZCBpY2xfdGNfcGh5X2Rpc2Nvbm5lY3Qoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAordm9pZCBpY2xfdGNfcGh5X2Rpc2Nvbm5lY3Qoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdf
cG9ydCk7CiAKIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IGludGVsX2RwX3VudXNlZF9sYW5l
X21hc2soaW50IGxhbmVfY291bnQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9h
dXhfYmFja2xpZ2h0LmMKaW5kZXggN2RlZDk1YTMzNGRiLi43YTNiZDI5ZGNmMGIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwX2F1eF9iYWNrbGlnaHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMKQEAgLTEwOSw3ICsx
MDksNyBAQCBpbnRlbF9kcF9hdXhfc2V0X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyIGxldgogICovCiBzdGF0aWMgYm9vbCBpbnRlbF9k
cF9hdXhfc2V0X3B3bV9mcmVxKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+
YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25u
ZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2lu
dGVsX2RwKCZjb25uZWN0b3ItPmVuY29kZXItPmJhc2UpOwogCWludCBmcmVxLCBmeHAsIGZ4cF9t
aW4sIGZ4cF9tYXgsIGZ4cF9hY3R1YWwsIGYgPSAxOwogCXU4IHBuLCBwbl9taW4sIHBuX21heDsK
QEAgLTExOCw3ICsxMTgsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kcF9hdXhfc2V0X3B3bV9mcmVx
KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAkgKiBOb3RlIHRoYXQsIGlmIEYg
eCBQIGlzIG91dCBvZiBzdXBwb3J0ZWQgcmFuZ2UsIHRoZSBtYXhpbXVtIHZhbHVlIG9yCiAJICog
bWluaW11bSB2YWx1ZSB3aWxsIGFwcGxpZWQgYXV0b21hdGljYWxseS4gU28gbm8gbmVlZCB0byBj
aGVjayB0aGF0LgogCSAqLwotCWZyZXEgPSBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wd21fZnJl
cV9oejsKKwlmcmVxID0gaTkxNS0+dmJ0LmJhY2tsaWdodC5wd21fZnJlcV9oejsKIAlEUk1fREVC
VUdfS01TKCJWQlQgZGVmaW5lZCBiYWNrbGlnaHQgZnJlcXVlbmN5ICV1IEh6XG4iLCBmcmVxKTsK
IAlpZiAoIWZyZXEpIHsKIAkJRFJNX0RFQlVHX0tNUygiVXNlIHBhbmVsIGRlZmF1bHQgYmFja2xp
Z2h0IGZyZXF1ZW5jeVxuIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9kcF9tc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwX21zdC5jCmluZGV4IDBj
YWY2NDVmYmJiOC4uYWIyMWRjNjkwYzlmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9kcF9tc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcF9tc3Qu
YwpAQCAtOTEsNyArOTEsNyBAQCBzdGF0aWMgaW50IGludGVsX2RwX21zdF9jb21wdXRlX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICAgICAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCSAgICAgICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcF9t
c3RfZW5jb2RlciAqaW50ZWxfbXN0ID0gZW5jX3RvX21zdCgmZW5jb2Rlci0+YmFzZSk7CiAJc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCA9ICZpbnRlbF9tc3QtPnByaW1hcnktPmRwOwogCXN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9CkBAIC0xNDAsMTEgKzE0MCwxMSBAQCBzdGF0
aWMgaW50IGludGVsX2RwX21zdF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAlwaXBlX2NvbmZpZy0+bGltaXRlZF9jb2xvcl9yYW5nZSA9CiAJCWludGVsX2Rw
X2xpbWl0ZWRfY29sb3JfcmFuZ2UocGlwZV9jb25maWcsIGNvbm5fc3RhdGUpOwogCi0JaWYgKElT
X0dFTjlfTFAoZGV2X3ByaXYpKQorCWlmIChJU19HRU45X0xQKGk5MTUpKQogCQlwaXBlX2NvbmZp
Zy0+bGFuZV9sYXRfb3B0aW1fbWFzayA9CiAJCQlieHRfZGRpX3BoeV9jYWxjX2xhbmVfbGF0X29w
dGltX21hc2socGlwZV9jb25maWctPmxhbmVfY291bnQpOwogCi0JaW50ZWxfZGRpX2NvbXB1dGVf
bWluX3ZvbHRhZ2VfbGV2ZWwoZGV2X3ByaXYsIHBpcGVfY29uZmlnKTsKKwlpbnRlbF9kZGlfY29t
cHV0ZV9taW5fdm9sdGFnZV9sZXZlbChpOTE1LCBwaXBlX2NvbmZpZyk7CiAKIAlyZXR1cm4gMDsK
IH0KQEAgLTI4NSw3ICsyODUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tc3RfcHJlX2VuYWJsZV9k
cChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfZHBfbXN0X2Vu
Y29kZXIgKmludGVsX21zdCA9IGVuY190b19tc3QoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBp
bnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0ID0gaW50ZWxfbXN0LT5wcmltYXJ5Owog
CXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSAmaW50ZWxfZGlnX3BvcnQtPmRwOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9kaWdfcG9ydC0+YmFzZS5wb3J0OwogCXN0
cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9CiAJCXRvX2ludGVsX2Nvbm5lY3Rvcihj
b25uX3N0YXRlLT5jb25uZWN0b3IpOwpAQCAtMzMyLDEyICszMzIsMTIgQEAgc3RhdGljIHZvaWQg
aW50ZWxfbXN0X2VuYWJsZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1
Y3QgaW50ZWxfZHBfbXN0X2VuY29kZXIgKmludGVsX21zdCA9IGVuY190b19tc3QoJmVuY29kZXIt
PmJhc2UpOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0ID0gaW50
ZWxfbXN0LT5wcmltYXJ5OwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSAmaW50ZWxfZGln
X3BvcnQtPmRwOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9kaWdfcG9y
dC0+YmFzZS5wb3J0OwogCiAJRFJNX0RFQlVHX0tNUygiYWN0aXZlIGxpbmtzICVkXG4iLCBpbnRl
bF9kcC0+YWN0aXZlX21zdF9saW5rcyk7CiAKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIo
JmRldl9wcml2LT51bmNvcmUsCisJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51
bmNvcmUsCiAJCQkJICAgIERQX1RQX1NUQVRVUyhwb3J0KSwKIAkJCQkgICAgRFBfVFBfU1RBVFVT
X0FDVF9TRU5ULAogCQkJCSAgICBEUF9UUF9TVEFUVVNfQUNUX1NFTlQsCkBAIC00OTUsNyArNDk1
LDcgQEAgc3RhdGljIHN0cnVjdCBkcm1fY29ubmVjdG9yICppbnRlbF9kcF9hZGRfbXN0X2Nvbm5l
Y3RvcihzdHJ1Y3QgZHJtX2RwX21zdF90b3BvbG8KIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
ID0gY29udGFpbmVyX29mKG1nciwgc3RydWN0IGludGVsX2RwLCBtc3RfbWdyKTsKIAlzdHJ1Y3Qg
aW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVs
X2RwKTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50ZWxfZGlnX3BvcnQtPmJhc2UuYmFz
ZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcjsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yOwogCWVudW0gcGlwZSBwaXBlOwpAQCAtNTIwLDcgKzUyMCw3IEBAIHN0YXRp
YyBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqaW50ZWxfZHBfYWRkX21zdF9jb25uZWN0b3Ioc3RydWN0
IGRybV9kcF9tc3RfdG9wb2xvCiAKIAlkcm1fY29ubmVjdG9yX2hlbHBlcl9hZGQoY29ubmVjdG9y
LCAmaW50ZWxfZHBfbXN0X2Nvbm5lY3Rvcl9oZWxwZXJfZnVuY3MpOwogCi0JZm9yX2VhY2hfcGlw
ZShkZXZfcHJpdiwgcGlwZSkgeworCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkgewogCQlzdHJ1
Y3QgZHJtX2VuY29kZXIgKmVuYyA9CiAJCQkmaW50ZWxfZHAtPm1zdF9lbmNvZGVyc1twaXBlXS0+
YmFzZS5iYXNlOwogCkBAIC01NDksMTAgKzU0OSwxMCBAQCBzdGF0aWMgc3RydWN0IGRybV9jb25u
ZWN0b3IgKmludGVsX2RwX2FkZF9tc3RfY29ubmVjdG9yKHN0cnVjdCBkcm1fZHBfbXN0X3RvcG9s
bwogCiBzdGF0aWMgdm9pZCBpbnRlbF9kcF9yZWdpc3Rlcl9tc3RfY29ubmVjdG9yKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKIAotCWlmIChkZXZfcHJpdi0+ZmJk
ZXYpCi0JCWRybV9mYl9oZWxwZXJfYWRkX29uZV9jb25uZWN0b3IoJmRldl9wcml2LT5mYmRldi0+
aGVscGVyLAorCWlmIChpOTE1LT5mYmRldikKKwkJZHJtX2ZiX2hlbHBlcl9hZGRfb25lX2Nvbm5l
Y3RvcigmaTkxNS0+ZmJkZXYtPmhlbHBlciwKIAkJCQkJCWNvbm5lY3Rvcik7CiAKIAlkcm1fY29u
bmVjdG9yX3JlZ2lzdGVyKGNvbm5lY3Rvcik7CkBAIC01NjEsMTMgKzU2MSwxMyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9kcF9yZWdpc3Rlcl9tc3RfY29ubmVjdG9yKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IpCiBzdGF0aWMgdm9pZCBpbnRlbF9kcF9kZXN0cm95X21zdF9jb25uZWN0b3Io
c3RydWN0IGRybV9kcF9tc3RfdG9wb2xvZ3lfbWdyICptZ3IsCiAJCQkJCSAgIHN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKIAogCURSTV9ERUJVR19LTVMoIltDT05O
RUNUT1I6JWQ6JXNdXG4iLCBjb25uZWN0b3ItPmJhc2UuaWQsIGNvbm5lY3Rvci0+bmFtZSk7CiAJ
ZHJtX2Nvbm5lY3Rvcl91bnJlZ2lzdGVyKGNvbm5lY3Rvcik7CiAKLQlpZiAoZGV2X3ByaXYtPmZi
ZGV2KQotCQlkcm1fZmJfaGVscGVyX3JlbW92ZV9vbmVfY29ubmVjdG9yKCZkZXZfcHJpdi0+ZmJk
ZXYtPmhlbHBlciwKKwlpZiAoaTkxNS0+ZmJkZXYpCisJCWRybV9mYl9oZWxwZXJfcmVtb3ZlX29u
ZV9jb25uZWN0b3IoJmk5MTUtPmZiZGV2LT5oZWxwZXIsCiAJCQkJCQkgICBjb25uZWN0b3IpOwog
CiAJZHJtX2Nvbm5lY3Rvcl9wdXQoY29ubmVjdG9yKTsKQEAgLTYyMiwxMCArNjIyLDEwIEBAIHN0
YXRpYyBib29sCiBpbnRlbF9kcF9jcmVhdGVfZmFrZV9tc3RfZW5jb2RlcnMoc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQpCiB7CiAJc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCA9ICZpbnRlbF9kaWdfcG9ydC0+ZHA7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShpbnRlbF9kaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGludGVsX2RpZ19wb3J0LT5iYXNlLmJh
c2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZTsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBp
cGUpCisJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKQogCQlpbnRlbF9kcC0+bXN0X2VuY29kZXJz
W3BpcGVdID0gaW50ZWxfZHBfY3JlYXRlX2Zha2VfbXN0X2VuY29kZXIoaW50ZWxfZGlnX3BvcnQs
IHBpcGUpOwogCXJldHVybiB0cnVlOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfZHBpb19waHkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwaW9fcGh5
LmMKaW5kZXggYmRiZTQxNzU5ODI3Li5jODU2NzJiYjFhN2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2RwaW9fcGh5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZHBpb19waHkuYwpAQCAtMjEyLDkgKzIxMiw5IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
Ynh0X2RkaV9waHlfaW5mbyBnbGtfZGRpX3BoeV9pbmZvW10gPSB7CiB9OwogCiBzdGF0aWMgY29u
c3Qgc3RydWN0IGJ4dF9kZGlfcGh5X2luZm8gKgotYnh0X2dldF9waHlfbGlzdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCAqY291bnQpCitieHRfZ2V0X3BoeV9saXN0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgKmNvdW50KQogewotCWlmIChJU19HRU1J
TklMQUtFKGRldl9wcml2KSkgeworCWlmIChJU19HRU1JTklMQUtFKGk5MTUpKSB7CiAJCSpjb3Vu
dCA9ICBBUlJBWV9TSVpFKGdsa19kZGlfcGh5X2luZm8pOwogCQlyZXR1cm4gZ2xrX2RkaV9waHlf
aW5mbzsKIAl9IGVsc2UgewpAQCAtMjI0LDIyICsyMjQsMjIgQEAgYnh0X2dldF9waHlfbGlzdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCAqY291bnQpCiB9CiAKIHN0YXRp
YyBjb25zdCBzdHJ1Y3QgYnh0X2RkaV9waHlfaW5mbyAqCi1ieHRfZ2V0X3BoeV9pbmZvKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBkcGlvX3BoeSBwaHkpCitieHRfZ2V0
X3BoeV9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIGRwaW9fcGh5IHBo
eSkKIHsKIAlpbnQgY291bnQ7CiAJY29uc3Qgc3RydWN0IGJ4dF9kZGlfcGh5X2luZm8gKnBoeV9s
aXN0ID0KLQkJYnh0X2dldF9waHlfbGlzdChkZXZfcHJpdiwgJmNvdW50KTsKKwkJYnh0X2dldF9w
aHlfbGlzdChpOTE1LCAmY291bnQpOwogCiAJcmV0dXJuICZwaHlfbGlzdFtwaHldOwogfQogCi12
b2lkIGJ4dF9wb3J0X3RvX3BoeV9jaGFubmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgZW51bSBwb3J0IHBvcnQsCit2b2lkIGJ4dF9wb3J0X3RvX3BoeV9jaGFubmVsKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9ydCwKIAkJCSAgICAgZW51bSBk
cGlvX3BoeSAqcGh5LCBlbnVtIGRwaW9fY2hhbm5lbCAqY2gpCiB7CiAJY29uc3Qgc3RydWN0IGJ4
dF9kZGlfcGh5X2luZm8gKnBoeV9pbmZvLCAqcGh5czsKIAlpbnQgaSwgY291bnQ7CiAKLQlwaHlz
ID0gYnh0X2dldF9waHlfbGlzdChkZXZfcHJpdiwgJmNvdW50KTsKKwlwaHlzID0gYnh0X2dldF9w
aHlfbGlzdChpOTE1LCAmY291bnQpOwogCiAJZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsK
IAkJcGh5X2luZm8gPSAmcGh5c1tpXTsKQEAgLTI2Myw3ICsyNjMsNyBAQCB2b2lkIGJ4dF9wb3J0
X3RvX3BoeV9jaGFubmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBw
b3J0IHBvcnQsCiAJKmNoID0gRFBJT19DSDA7CiB9CiAKLXZvaWQgYnh0X2RkaV9waHlfc2V0X3Np
Z25hbF9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGJ4dF9k
ZGlfcGh5X3NldF9zaWduYWxfbGV2ZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkJICBlbnVtIHBvcnQgcG9ydCwgdTMyIG1hcmdpbiwgdTMyIHNjYWxlLAogCQkJCSAgdTMyIGVu
YWJsZSwgdTMyIGRlZW1waGFzaXMpCiB7CkBAIC0yNzEsNyArMjcxLDcgQEAgdm9pZCBieHRfZGRp
X3BoeV9zZXRfc2lnbmFsX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAllbnVtIGRwaW9fcGh5IHBoeTsKIAllbnVtIGRwaW9fY2hhbm5lbCBjaDsKIAotCWJ4dF9wb3J0
X3RvX3BoeV9jaGFubmVsKGRldl9wcml2LCBwb3J0LCAmcGh5LCAmY2gpOworCWJ4dF9wb3J0X3Rv
X3BoeV9jaGFubmVsKGk5MTUsIHBvcnQsICZwaHksICZjaCk7CiAKIAkvKgogCSAqIFdoaWxlIHdl
IHdyaXRlIHRvIHRoZSBncm91cCByZWdpc3RlciB0byBwcm9ncmFtIGFsbCBsYW5lcyBhdCBvbmNl
IHdlCkBAIC0zMDYsMTIgKzMwNiwxMiBAQCB2b2lkIGJ4dF9kZGlfcGh5X3NldF9zaWduYWxfbGV2
ZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoQlhUX1BP
UlRfUENTX0RXMTBfR1JQKHBoeSwgY2gpLCB2YWwpOwogfQogCi1ib29sIGJ4dF9kZGlfcGh5X2lz
X2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorYm9vbCBieHRfZGRp
X3BoeV9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgIGVu
dW0gZHBpb19waHkgcGh5KQogewogCWNvbnN0IHN0cnVjdCBieHRfZGRpX3BoeV9pbmZvICpwaHlf
aW5mbzsKIAotCXBoeV9pbmZvID0gYnh0X2dldF9waHlfaW5mbyhkZXZfcHJpdiwgcGh5KTsKKwlw
aHlfaW5mbyA9IGJ4dF9nZXRfcGh5X2luZm8oaTkxNSwgcGh5KTsKIAogCWlmICghKEk5MTVfUkVB
RChCWFRfUF9DUl9HVF9ESVNQX1BXUk9OKSAmIHBoeV9pbmZvLT5wd3Jvbl9tYXNrKSkKIAkJcmV0
dXJuIGZhbHNlOwpAQCAtMzM0LDM3ICszMzQsMzcgQEAgYm9vbCBieHRfZGRpX3BoeV9pc19lbmFi
bGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gdHJ1ZTsKIH0K
IAotc3RhdGljIHUzMiBieHRfZ2V0X2dyYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIGVudW0gZHBpb19waHkgcGh5KQorc3RhdGljIHUzMiBieHRfZ2V0X2dyYyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBkcGlvX3BoeSBwaHkpCiB7CiAJdTMyIHZhbCA9IEk5
MTVfUkVBRChCWFRfUE9SVF9SRUZfRFc2KHBoeSkpOwogCiAJcmV0dXJuICh2YWwgJiBHUkNfQ09E
RV9NQVNLKSA+PiBHUkNfQ09ERV9TSElGVDsKIH0KIAotc3RhdGljIHZvaWQgYnh0X3BoeV93YWl0
X2dyY19kb25lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lk
IGJ4dF9waHlfd2FpdF9ncmNfZG9uZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQkgIGVudW0gZHBpb19waHkgcGh5KQogewotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3Rlcigm
ZGV2X3ByaXYtPnVuY29yZSwKKwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVu
Y29yZSwKIAkJCQkgICAgQlhUX1BPUlRfUkVGX0RXMyhwaHkpLAogCQkJCSAgICBHUkNfRE9ORSwg
R1JDX0RPTkUsCiAJCQkJICAgIDEwKSkKIAkJRFJNX0VSUk9SKCJ0aW1lb3V0IHdhaXRpbmcgZm9y
IFBIWSVkIEdSQ1xuIiwgcGh5KTsKIH0KIAotc3RhdGljIHZvaWQgX2J4dF9kZGlfcGh5X2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgX2J4dF9kZGlf
cGh5X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBlbnVtIGRw
aW9fcGh5IHBoeSkKIHsKIAljb25zdCBzdHJ1Y3QgYnh0X2RkaV9waHlfaW5mbyAqcGh5X2luZm87
CiAJdTMyIHZhbDsKIAotCXBoeV9pbmZvID0gYnh0X2dldF9waHlfaW5mbyhkZXZfcHJpdiwgcGh5
KTsKKwlwaHlfaW5mbyA9IGJ4dF9nZXRfcGh5X2luZm8oaTkxNSwgcGh5KTsKIAotCWlmIChieHRf
ZGRpX3BoeV9pc19lbmFibGVkKGRldl9wcml2LCBwaHkpKSB7CisJaWYgKGJ4dF9kZGlfcGh5X2lz
X2VuYWJsZWQoaTkxNSwgcGh5KSkgewogCQkvKiBTdGlsbCByZWFkIG91dCB0aGUgR1JDIHZhbHVl
IGZvciBzdGF0ZSB2ZXJpZmljYXRpb24gKi8KIAkJaWYgKHBoeV9pbmZvLT5yY29tcF9waHkgIT0g
LTEpCi0JCQlkZXZfcHJpdi0+Ynh0X3BoeV9ncmMgPSBieHRfZ2V0X2dyYyhkZXZfcHJpdiwgcGh5
KTsKKwkJCWk5MTUtPmJ4dF9waHlfZ3JjID0gYnh0X2dldF9ncmMoaTkxNSwgcGh5KTsKIAotCQlp
ZiAoYnh0X2RkaV9waHlfdmVyaWZ5X3N0YXRlKGRldl9wcml2LCBwaHkpKSB7CisJCWlmIChieHRf
ZGRpX3BoeV92ZXJpZnlfc3RhdGUoaTkxNSwgcGh5KSkgewogCQkJRFJNX0RFQlVHX0RSSVZFUigi
RERJIFBIWSAlZCBhbHJlYWR5IGVuYWJsZWQsICIKIAkJCQkJICJ3b24ndCByZXByb2dyYW0gaXRc
biIsIHBoeSk7CiAJCQlyZXR1cm47CkBAIC0zODYsNyArMzg2LDcgQEAgc3RhdGljIHZvaWQgX2J4
dF9kZGlfcGh5X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIFRo
ZSBmbGFnIHNob3VsZCBnZXQgc2V0IGluIDEwMHVzIGFjY29yZGluZyB0byB0aGUgSFcgdGVhbSwg
YnV0CiAJICogdXNlIDFtcyBkdWUgdG8gb2NjYXNpb25hbCB0aW1lb3V0cyBvYnNlcnZlZCB3aXRo
IHRoYXQuCiAJICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyX2Z3KCZkZXZfcHJpdi0+
dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3Rlcl9mdygmaTkxNS0+dW5jb3JlLAog
CQkJCSAgICAgICBCWFRfUE9SVF9DTDFDTV9EVzAocGh5KSwKIAkJCQkgICAgICAgUEhZX1JFU0VS
VkVEIHwgUEhZX1BPV0VSX0dPT0QsCiAJCQkJICAgICAgIFBIWV9QT1dFUl9HT09ELApAQCAtNDE5
LDE0ICs0MTksMTQgQEAgc3RhdGljIHZvaWQgX2J4dF9kZGlfcGh5X2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlmIChwaHlfaW5mby0+cmNvbXBfcGh5ICE9IC0xKSB7
CiAJCXUzMiBncmNfY29kZTsKIAotCQlieHRfcGh5X3dhaXRfZ3JjX2RvbmUoZGV2X3ByaXYsIHBo
eV9pbmZvLT5yY29tcF9waHkpOworCQlieHRfcGh5X3dhaXRfZ3JjX2RvbmUoaTkxNSwgcGh5X2lu
Zm8tPnJjb21wX3BoeSk7CiAKIAkJLyoKIAkJICogUEhZMCBpc24ndCBjb25uZWN0ZWQgdG8gYW4g
UkNPTVAgcmVzaXN0b3Igc28gY29weSBvdmVyCiAJCSAqIHRoZSBjb3JyZXNwb25kaW5nIGNhbGli
cmF0ZWQgdmFsdWUgZnJvbSBQSFkxLCBhbmQgZGlzYWJsZQogCQkgKiB0aGUgYXV0b21hdGljIGNh
bGlicmF0aW9uIG9uIFBIWTAuCiAJCSAqLwotCQl2YWwgPSBkZXZfcHJpdi0+Ynh0X3BoeV9ncmMg
PSBieHRfZ2V0X2dyYyhkZXZfcHJpdiwKKwkJdmFsID0gaTkxNS0+Ynh0X3BoeV9ncmMgPSBieHRf
Z2V0X2dyYyhpOTE1LAogCQkJCQkJCSAgcGh5X2luZm8tPnJjb21wX3BoeSk7CiAJCWdyY19jb2Rl
ID0gdmFsIDw8IEdSQ19DT0RFX0ZBU1RfU0hJRlQgfAogCQkJICAgdmFsIDw8IEdSQ19DT0RFX1NM
T1dfU0hJRlQgfApAQCAtNDQ2LDEyICs0NDYsMTIgQEAgc3RhdGljIHZvaWQgX2J4dF9kZGlfcGh5
X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoQlhU
X1BIWV9DVExfRkFNSUxZKHBoeSksIHZhbCk7CiB9CiAKLXZvaWQgYnh0X2RkaV9waHlfdW5pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBkcGlvX3BoeSBwaHkpCit2
b2lkIGJ4dF9kZGlfcGh5X3VuaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51
bSBkcGlvX3BoeSBwaHkpCiB7CiAJY29uc3Qgc3RydWN0IGJ4dF9kZGlfcGh5X2luZm8gKnBoeV9p
bmZvOwogCXUzMiB2YWw7CiAKLQlwaHlfaW5mbyA9IGJ4dF9nZXRfcGh5X2luZm8oZGV2X3ByaXYs
IHBoeSk7CisJcGh5X2luZm8gPSBieHRfZ2V0X3BoeV9pbmZvKGk5MTUsIHBoeSk7CiAKIAl2YWwg
PSBJOTE1X1JFQUQoQlhUX1BIWV9DVExfRkFNSUxZKHBoeSkpOwogCXZhbCAmPSB+Q09NTU9OX1JF
U0VUX0RJUzsKQEAgLTQ2MiwzNCArNDYyLDM0IEBAIHZvaWQgYnh0X2RkaV9waHlfdW5pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBkcGlvX3BoeSBwaHkpCiAJSTkx
NV9XUklURShCWFRfUF9DUl9HVF9ESVNQX1BXUk9OLCB2YWwpOwogfQogCi12b2lkIGJ4dF9kZGlf
cGh5X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIGRwaW9fcGh5
IHBoeSkKK3ZvaWQgYnh0X2RkaV9waHlfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwgZW51bSBkcGlvX3BoeSBwaHkpCiB7CiAJY29uc3Qgc3RydWN0IGJ4dF9kZGlfcGh5X2luZm8g
KnBoeV9pbmZvID0KLQkJYnh0X2dldF9waHlfaW5mbyhkZXZfcHJpdiwgcGh5KTsKKwkJYnh0X2dl
dF9waHlfaW5mbyhpOTE1LCBwaHkpOwogCWVudW0gZHBpb19waHkgcmNvbXBfcGh5ID0gcGh5X2lu
Zm8tPnJjb21wX3BoeTsKIAlib29sIHdhc19lbmFibGVkOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmZGV2X3ByaXYtPnBvd2VyX2RvbWFpbnMubG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgm
aTkxNS0+cG93ZXJfZG9tYWlucy5sb2NrKTsKIAogCXdhc19lbmFibGVkID0gdHJ1ZTsKIAlpZiAo
cmNvbXBfcGh5ICE9IC0xKQotCQl3YXNfZW5hYmxlZCA9IGJ4dF9kZGlfcGh5X2lzX2VuYWJsZWQo
ZGV2X3ByaXYsIHJjb21wX3BoeSk7CisJCXdhc19lbmFibGVkID0gYnh0X2RkaV9waHlfaXNfZW5h
YmxlZChpOTE1LCByY29tcF9waHkpOwogCiAJLyoKIAkgKiBXZSBuZWVkIHRvIGNvcHkgdGhlIEdS
QyBjYWxpYnJhdGlvbiB2YWx1ZSBmcm9tIHJjb21wX3BoeSwKIAkgKiBzbyBtYWtlIHN1cmUgaXQn
cyBwb3dlcmVkIHVwLgogCSAqLwogCWlmICghd2FzX2VuYWJsZWQpCi0JCV9ieHRfZGRpX3BoeV9p
bml0KGRldl9wcml2LCByY29tcF9waHkpOworCQlfYnh0X2RkaV9waHlfaW5pdChpOTE1LCByY29t
cF9waHkpOwogCi0JX2J4dF9kZGlfcGh5X2luaXQoZGV2X3ByaXYsIHBoeSk7CisJX2J4dF9kZGlf
cGh5X2luaXQoaTkxNSwgcGh5KTsKIAogCWlmICghd2FzX2VuYWJsZWQpCi0JCWJ4dF9kZGlfcGh5
X3VuaW5pdChkZXZfcHJpdiwgcmNvbXBfcGh5KTsKKwkJYnh0X2RkaV9waHlfdW5pbml0KGk5MTUs
IHJjb21wX3BoeSk7CiB9CiAKIHN0YXRpYyBib29sIF9fcHJpbnRmKDYsIDcpCi1fX3BoeV9yZWdf
dmVyaWZ5X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBkcGlv
X3BoeSBwaHksCitfX3BoeV9yZWdfdmVyaWZ5X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCBlbnVtIGRwaW9fcGh5IHBoeSwKIAkJICAgICAgIGk5MTVfcmVnX3QgcmVnLCB1MzIg
bWFzaywgdTMyIGV4cGVjdGVkLAogCQkgICAgICAgY29uc3QgY2hhciAqcmVnX2ZtdCwgLi4uKQog
ewpAQCAtNTE1LDIwICs1MTUsMjAgQEAgX19waHlfcmVnX3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gZHBpb19waHkgcGh5LAogCXJldHVybiBmYWxz
ZTsKIH0KIAotYm9vbCBieHRfZGRpX3BoeV92ZXJpZnlfc3RhdGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorYm9vbCBieHRfZGRpX3BoeV92ZXJpZnlfc3RhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBlbnVtIGRwaW9fcGh5IHBoeSkKIHsKIAlj
b25zdCBzdHJ1Y3QgYnh0X2RkaV9waHlfaW5mbyAqcGh5X2luZm87CiAJdTMyIG1hc2s7CiAJYm9v
bCBvazsKIAotCXBoeV9pbmZvID0gYnh0X2dldF9waHlfaW5mbyhkZXZfcHJpdiwgcGh5KTsKKwlw
aHlfaW5mbyA9IGJ4dF9nZXRfcGh5X2luZm8oaTkxNSwgcGh5KTsKIAogI2RlZmluZSBfQ0hLKHJl
ZywgbWFzaywgZXhwLCBmbXQsIC4uLikJCQkJCVwKLQlfX3BoeV9yZWdfdmVyaWZ5X3N0YXRlKGRl
dl9wcml2LCBwaHksIHJlZywgbWFzaywgZXhwLCBmbXQsCVwKKwlfX3BoeV9yZWdfdmVyaWZ5X3N0
YXRlKGk5MTUsIHBoeSwgcmVnLCBtYXNrLCBleHAsIGZtdCwJXAogCQkJICAgICAgICMjIF9fVkFf
QVJHU19fKQogCi0JaWYgKCFieHRfZGRpX3BoeV9pc19lbmFibGVkKGRldl9wcml2LCBwaHkpKQor
CWlmICghYnh0X2RkaV9waHlfaXNfZW5hYmxlZChpOTE1LCBwaHkpKQogCQlyZXR1cm4gZmFsc2U7
CiAKIAlvayA9IHRydWU7CkBAIC01NTIsNyArNTUyLDcgQEAgYm9vbCBieHRfZGRpX3BoeV92ZXJp
Znlfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICAgIkJYVF9Q
T1JUX0NMMkNNX0RXNiglZCkiLCBwaHkpOwogCiAJaWYgKHBoeV9pbmZvLT5yY29tcF9waHkgIT0g
LTEpIHsKLQkJdTMyIGdyY19jb2RlID0gZGV2X3ByaXYtPmJ4dF9waHlfZ3JjOworCQl1MzIgZ3Jj
X2NvZGUgPSBpOTE1LT5ieHRfcGh5X2dyYzsKIAogCQlncmNfY29kZSA9IGdyY19jb2RlIDw8IEdS
Q19DT0RFX0ZBU1RfU0hJRlQgfAogCQkJICAgZ3JjX2NvZGUgPDwgR1JDX0NPREVfU0xPV19TSElG
VCB8CkBAIC01OTEsMTMgKzU5MSwxMyBAQCBieHRfZGRpX3BoeV9jYWxjX2xhbmVfbGF0X29wdGlt
X21hc2sodTggbGFuZV9jb3VudCkKIHZvaWQgYnh0X2RkaV9waHlfc2V0X2xhbmVfb3B0aW1fbWFz
ayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICAgIHU4IGxhbmVfbGF0X29w
dGltX21hc2spCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBv
cnQ7CiAJZW51bSBkcGlvX3BoeSBwaHk7CiAJZW51bSBkcGlvX2NoYW5uZWwgY2g7CiAJaW50IGxh
bmU7CiAKLQlieHRfcG9ydF90b19waHlfY2hhbm5lbChkZXZfcHJpdiwgcG9ydCwgJnBoeSwgJmNo
KTsKKwlieHRfcG9ydF90b19waHlfY2hhbm5lbChpOTE1LCBwb3J0LCAmcGh5LCAmY2gpOwogCiAJ
Zm9yIChsYW5lID0gMDsgbGFuZSA8IDQ7IGxhbmUrKykgewogCQl1MzIgdmFsID0gSTkxNV9SRUFE
KEJYVF9QT1JUX1RYX0RXMTRfTE4ocGh5LCBjaCwgbGFuZSkpOwpAQCAtNjE3LDE0ICs2MTcsMTQg
QEAgdm9pZCBieHRfZGRpX3BoeV9zZXRfbGFuZV9vcHRpbV9tYXNrKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogdTgKIGJ4dF9kZGlfcGh5X2dldF9sYW5lX2xhdF9vcHRpbV9tYXNrKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJZW51bSBwb3J0
IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWVudW0gZHBpb19waHkgcGh5OwogCWVudW0gZHBpb19j
aGFubmVsIGNoOwogCWludCBsYW5lOwogCXU4IG1hc2s7CiAKLQlieHRfcG9ydF90b19waHlfY2hh
bm5lbChkZXZfcHJpdiwgcG9ydCwgJnBoeSwgJmNoKTsKKwlieHRfcG9ydF90b19waHlfY2hhbm5l
bChpOTE1LCBwb3J0LCAmcGh5LCAmY2gpOwogCiAJbWFzayA9IDA7CiAJZm9yIChsYW5lID0gMDsg
bGFuZSA8IDQ7IGxhbmUrKykgewpAQCAtNjQyLDcgKzY0Miw3IEBAIHZvaWQgY2h2X3NldF9waHlf
c2lnbmFsX2xldmVsKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAgdTMy
IGRlZW1waF9yZWdfdmFsdWUsIHUzMiBtYXJnaW5fcmVnX3ZhbHVlLAogCQkJICAgICAgYm9vbCB1
bmlxX3RyYW5zX3NjYWxlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxf
cG9ydCAqZHBvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBp
bnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhlbmNvZGVyLT5iYXNlLmNydGMp
OwogCWVudW0gZHBpb19jaGFubmVsIGNoID0gdmx2X2Rwb3J0X3RvX2NoYW5uZWwoZHBvcnQpOwpA
QCAtNjUwLDQ2ICs2NTAsNDYgQEAgdm9pZCBjaHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJdTMyIHZhbDsKIAlpbnQgaTsKIAotCXZsdl9kcGlv
X2dldChkZXZfcHJpdik7CisJdmx2X2RwaW9fZ2V0KGk5MTUpOwogCiAJLyogQ2xlYXIgY2FsYyBp
bml0ICovCi0JdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgVkxWX1BDUzAxX0RX
MTAoY2gpKTsKKwl2YWwgPSB2bHZfZHBpb19yZWFkKGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9EVzEw
KGNoKSk7CiAJdmFsICY9IH4oRFBJT19QQ1NfU1dJTkdfQ0FMQ19UWDBfVFgyIHwgRFBJT19QQ1Nf
U1dJTkdfQ0FMQ19UWDFfVFgzKTsKIAl2YWwgJj0gfihEUElPX1BDU19UWDFERUVNUF9NQVNLIHwg
RFBJT19QQ1NfVFgyREVFTVBfTUFTSyk7CiAJdmFsIHw9IERQSU9fUENTX1RYMURFRU1QXzlQNSB8
IERQSU9fUENTX1RYMkRFRU1QXzlQNTsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwg
VkxWX1BDUzAxX0RXMTAoY2gpLCB2YWwpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZM
Vl9QQ1MwMV9EVzEwKGNoKSwgdmFsKTsKIAogCWlmIChpbnRlbF9jcnRjLT5jb25maWctPmxhbmVf
Y291bnQgPiAyKSB7Ci0JCXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9Q
Q1MyM19EVzEwKGNoKSk7CisJCXZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgVkxWX1BD
UzIzX0RXMTAoY2gpKTsKIAkJdmFsICY9IH4oRFBJT19QQ1NfU1dJTkdfQ0FMQ19UWDBfVFgyIHwg
RFBJT19QQ1NfU1dJTkdfQ0FMQ19UWDFfVFgzKTsKIAkJdmFsICY9IH4oRFBJT19QQ1NfVFgxREVF
TVBfTUFTSyB8IERQSU9fUENTX1RYMkRFRU1QX01BU0spOwogCQl2YWwgfD0gRFBJT19QQ1NfVFgx
REVFTVBfOVA1IHwgRFBJT19QQ1NfVFgyREVFTVBfOVA1OwotCQl2bHZfZHBpb193cml0ZShkZXZf
cHJpdiwgcGlwZSwgVkxWX1BDUzIzX0RXMTAoY2gpLCB2YWwpOworCQl2bHZfZHBpb193cml0ZShp
OTE1LCBwaXBlLCBWTFZfUENTMjNfRFcxMChjaCksIHZhbCk7CiAJfQogCi0JdmFsID0gdmx2X2Rw
aW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgVkxWX1BDUzAxX0RXOShjaCkpOworCXZhbCA9IHZsdl9k
cGlvX3JlYWQoaTkxNSwgcGlwZSwgVkxWX1BDUzAxX0RXOShjaCkpOwogCXZhbCAmPSB+KERQSU9f
UENTX1RYMU1BUkdJTl9NQVNLIHwgRFBJT19QQ1NfVFgyTUFSR0lOX01BU0spOwogCXZhbCB8PSBE
UElPX1BDU19UWDFNQVJHSU5fMDAwIHwgRFBJT19QQ1NfVFgyTUFSR0lOXzAwMDsKLQl2bHZfZHBp
b193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BDUzAxX0RXOShjaCksIHZhbCk7CisJdmx2X2Rw
aW9fd3JpdGUoaTkxNSwgcGlwZSwgVkxWX1BDUzAxX0RXOShjaCksIHZhbCk7CiAKIAlpZiAoaW50
ZWxfY3J0Yy0+Y29uZmlnLT5sYW5lX2NvdW50ID4gMikgewotCQl2YWwgPSB2bHZfZHBpb19yZWFk
KGRldl9wcml2LCBwaXBlLCBWTFZfUENTMjNfRFc5KGNoKSk7CisJCXZhbCA9IHZsdl9kcGlvX3Jl
YWQoaTkxNSwgcGlwZSwgVkxWX1BDUzIzX0RXOShjaCkpOwogCQl2YWwgJj0gfihEUElPX1BDU19U
WDFNQVJHSU5fTUFTSyB8IERQSU9fUENTX1RYMk1BUkdJTl9NQVNLKTsKIAkJdmFsIHw9IERQSU9f
UENTX1RYMU1BUkdJTl8wMDAgfCBEUElPX1BDU19UWDJNQVJHSU5fMDAwOwotCQl2bHZfZHBpb193
cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BDUzIzX0RXOShjaCksIHZhbCk7CisJCXZsdl9kcGlv
X3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1MyM19EVzkoY2gpLCB2YWwpOwogCX0KIAogCS8qIFBy
b2dyYW0gc3dpbmcgZGVlbXBoICovCiAJZm9yIChpID0gMDsgaSA8IGludGVsX2NydGMtPmNvbmZp
Zy0+bGFuZV9jb3VudDsgaSsrKSB7Ci0JCXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBp
cGUsIENIVl9UWF9EVzQoY2gsIGkpKTsKKwkJdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBl
LCBDSFZfVFhfRFc0KGNoLCBpKSk7CiAJCXZhbCAmPSB+RFBJT19TV0lOR19ERUVNUEg5UDVfTUFT
SzsKIAkJdmFsIHw9IGRlZW1waF9yZWdfdmFsdWUgPDwgRFBJT19TV0lOR19ERUVNUEg5UDVfU0hJ
RlQ7Ci0JCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfVFhfRFc0KGNoLCBpKSwg
dmFsKTsKKwkJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgQ0hWX1RYX0RXNChjaCwgaSksIHZh
bCk7CiAJfQogCiAJLyogUHJvZ3JhbSBzd2luZyBtYXJnaW4gKi8KIAlmb3IgKGkgPSAwOyBpIDwg
aW50ZWxfY3J0Yy0+Y29uZmlnLT5sYW5lX2NvdW50OyBpKyspIHsKLQkJdmFsID0gdmx2X2RwaW9f
cmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX1RYX0RXMihjaCwgaSkpOworCQl2YWwgPSB2bHZfZHBp
b19yZWFkKGk5MTUsIHBpcGUsIENIVl9UWF9EVzIoY2gsIGkpKTsKIAogCQl2YWwgJj0gfkRQSU9f
U1dJTkdfTUFSR0lOMDAwX01BU0s7CiAJCXZhbCB8PSBtYXJnaW5fcmVnX3ZhbHVlIDw8IERQSU9f
U1dJTkdfTUFSR0lOMDAwX1NISUZUOwpAQCAtNzAyLDcgKzcwMiw3IEBAIHZvaWQgY2h2X3NldF9w
aHlfc2lnbmFsX2xldmVsKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQl2YWwgJj0g
figweGZmIDw8IERQSU9fVU5JUV9UUkFOU19TQ0FMRV9TSElGVCk7CiAJCXZhbCB8PSAweDlhIDw8
IERQSU9fVU5JUV9UUkFOU19TQ0FMRV9TSElGVDsKIAotCQl2bHZfZHBpb193cml0ZShkZXZfcHJp
diwgcGlwZSwgQ0hWX1RYX0RXMihjaCwgaSksIHZhbCk7CisJCXZsdl9kcGlvX3dyaXRlKGk5MTUs
IHBpcGUsIENIVl9UWF9EVzIoY2gsIGkpLCB2YWwpOwogCX0KIAogCS8qCkBAIC03MTIsNzAgKzcx
Miw3MCBAQCB2b2lkIGNodl9zZXRfcGh5X3NpZ25hbF9sZXZlbChzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAkgKiAyNyBmb3IgY2gwIGFuZCBjaDEuCiAJICovCiAJZm9yIChpID0gMDsg
aSA8IGludGVsX2NydGMtPmNvbmZpZy0+bGFuZV9jb3VudDsgaSsrKSB7Ci0JCXZhbCA9IHZsdl9k
cGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIENIVl9UWF9EVzMoY2gsIGkpKTsKKwkJdmFsID0gdmx2
X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBDSFZfVFhfRFczKGNoLCBpKSk7CiAJCWlmICh1bmlxX3Ry
YW5zX3NjYWxlKQogCQkJdmFsIHw9IERQSU9fVFhfVU5JUV9UUkFOU19TQ0FMRV9FTjsKIAkJZWxz
ZQogCQkJdmFsICY9IH5EUElPX1RYX1VOSVFfVFJBTlNfU0NBTEVfRU47Ci0JCXZsdl9kcGlvX3dy
aXRlKGRldl9wcml2LCBwaXBlLCBDSFZfVFhfRFczKGNoLCBpKSwgdmFsKTsKKwkJdmx2X2RwaW9f
d3JpdGUoaTkxNSwgcGlwZSwgQ0hWX1RYX0RXMyhjaCwgaSksIHZhbCk7CiAJfQogCiAJLyogU3Rh
cnQgc3dpbmcgY2FsY3VsYXRpb24gKi8KLQl2YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBw
aXBlLCBWTFZfUENTMDFfRFcxMChjaCkpOworCXZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlw
ZSwgVkxWX1BDUzAxX0RXMTAoY2gpKTsKIAl2YWwgfD0gRFBJT19QQ1NfU1dJTkdfQ0FMQ19UWDBf
VFgyIHwgRFBJT19QQ1NfU1dJTkdfQ0FMQ19UWDFfVFgzOwotCXZsdl9kcGlvX3dyaXRlKGRldl9w
cml2LCBwaXBlLCBWTFZfUENTMDFfRFcxMChjaCksIHZhbCk7CisJdmx2X2RwaW9fd3JpdGUoaTkx
NSwgcGlwZSwgVkxWX1BDUzAxX0RXMTAoY2gpLCB2YWwpOwogCiAJaWYgKGludGVsX2NydGMtPmNv
bmZpZy0+bGFuZV9jb3VudCA+IDIpIHsKLQkJdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwg
cGlwZSwgVkxWX1BDUzIzX0RXMTAoY2gpKTsKKwkJdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBw
aXBlLCBWTFZfUENTMjNfRFcxMChjaCkpOwogCQl2YWwgfD0gRFBJT19QQ1NfU1dJTkdfQ0FMQ19U
WDBfVFgyIHwgRFBJT19QQ1NfU1dJTkdfQ0FMQ19UWDFfVFgzOwotCQl2bHZfZHBpb193cml0ZShk
ZXZfcHJpdiwgcGlwZSwgVkxWX1BDUzIzX0RXMTAoY2gpLCB2YWwpOworCQl2bHZfZHBpb193cml0
ZShpOTE1LCBwaXBlLCBWTFZfUENTMjNfRFcxMChjaCksIHZhbCk7CiAJfQogCi0Jdmx2X2RwaW9f
cHV0KGRldl9wcml2KTsKKwl2bHZfZHBpb19wdXQoaTkxNSk7CiB9CiAKIHZvaWQgY2h2X2RhdGFf
bGFuZV9zb2Z0X3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgICBib29s
IHJlc2V0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJZW51bSBkcGlvX2NoYW5uZWwgY2ggPSB2bHZfZHBv
cnRfdG9fY2hhbm5lbChlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpKTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
IAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIHZhbDsKIAotCXZhbCA9IHZsdl9k
cGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MwMV9EVzAoY2gpKTsKKwl2YWwgPSB2bHZf
ZHBpb19yZWFkKGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9EVzAoY2gpKTsKIAlpZiAocmVzZXQpCiAJ
CXZhbCAmPSB+KERQSU9fUENTX1RYX0xBTkUyX1JFU0VUIHwgRFBJT19QQ1NfVFhfTEFORTFfUkVT
RVQpOwogCWVsc2UKIAkJdmFsIHw9IERQSU9fUENTX1RYX0xBTkUyX1JFU0VUIHwgRFBJT19QQ1Nf
VFhfTEFORTFfUkVTRVQ7Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1Mw
MV9EVzAoY2gpLCB2YWwpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9E
VzAoY2gpLCB2YWwpOwogCiAJaWYgKGNydGNfc3RhdGUtPmxhbmVfY291bnQgPiAyKSB7Ci0JCXZh
bCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MyM19EVzAoY2gpKTsKKwkJ
dmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBWTFZfUENTMjNfRFcwKGNoKSk7CiAJCWlm
IChyZXNldCkKIAkJCXZhbCAmPSB+KERQSU9fUENTX1RYX0xBTkUyX1JFU0VUIHwgRFBJT19QQ1Nf
VFhfTEFORTFfUkVTRVQpOwogCQllbHNlCiAJCQl2YWwgfD0gRFBJT19QQ1NfVFhfTEFORTJfUkVT
RVQgfCBEUElPX1BDU19UWF9MQU5FMV9SRVNFVDsKLQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYs
IHBpcGUsIFZMVl9QQ1MyM19EVzAoY2gpLCB2YWwpOworCQl2bHZfZHBpb193cml0ZShpOTE1LCBw
aXBlLCBWTFZfUENTMjNfRFcwKGNoKSwgdmFsKTsKIAl9CiAKLQl2YWwgPSB2bHZfZHBpb19yZWFk
KGRldl9wcml2LCBwaXBlLCBWTFZfUENTMDFfRFcxKGNoKSk7CisJdmFsID0gdmx2X2RwaW9fcmVh
ZChpOTE1LCBwaXBlLCBWTFZfUENTMDFfRFcxKGNoKSk7CiAJdmFsIHw9IENIVl9QQ1NfUkVRX1NP
RlRSRVNFVF9FTjsKIAlpZiAocmVzZXQpCiAJCXZhbCAmPSB+RFBJT19QQ1NfQ0xLX1NPRlRfUkVT
RVQ7CiAJZWxzZQogCQl2YWwgfD0gRFBJT19QQ1NfQ0xLX1NPRlRfUkVTRVQ7Ci0Jdmx2X2RwaW9f
d3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MwMV9EVzEoY2gpLCB2YWwpOworCXZsdl9kcGlv
X3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9EVzEoY2gpLCB2YWwpOwogCiAJaWYgKGNydGNf
c3RhdGUtPmxhbmVfY291bnQgPiAyKSB7Ci0JCXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYs
IHBpcGUsIFZMVl9QQ1MyM19EVzEoY2gpKTsKKwkJdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBw
aXBlLCBWTFZfUENTMjNfRFcxKGNoKSk7CiAJCXZhbCB8PSBDSFZfUENTX1JFUV9TT0ZUUkVTRVRf
RU47CiAJCWlmIChyZXNldCkKIAkJCXZhbCAmPSB+RFBJT19QQ1NfQ0xLX1NPRlRfUkVTRVQ7CiAJ
CWVsc2UKIAkJCXZhbCB8PSBEUElPX1BDU19DTEtfU09GVF9SRVNFVDsKLQkJdmx2X2RwaW9fd3Jp
dGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MyM19EVzEoY2gpLCB2YWwpOworCQl2bHZfZHBpb193
cml0ZShpOTE1LCBwaXBlLCBWTFZfUENTMjNfRFcxKGNoKSwgdmFsKTsKIAl9CiB9CiAKQEAgLTc4
Myw3ICs3ODMsNyBAQCB2b2lkIGNodl9waHlfcHJlX3BsbF9lbmFibGUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZHBvcnQgPSBlbmNfdG9f
ZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJZW51bSBk
cGlvX2NoYW5uZWwgY2ggPSB2bHZfZHBvcnRfdG9fY2hhbm5lbChkcG9ydCk7CiAJZW51bSBwaXBl
IHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtNzk3LDUxICs3OTcsNTEgQEAgdm9pZCBjaHZfcGh5X3By
ZV9wbGxfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCSAqLwogCWlmIChj
aCA9PSBEUElPX0NIMCAmJiBwaXBlID09IFBJUEVfQikKIAkJZHBvcnQtPnJlbGVhc2VfY2wyX292
ZXJyaWRlID0KLQkJCSFjaHZfcGh5X3Bvd2VyZ2F0ZV9jaChkZXZfcHJpdiwgRFBJT19QSFkwLCBE
UElPX0NIMSwgdHJ1ZSk7CisJCQkhY2h2X3BoeV9wb3dlcmdhdGVfY2goaTkxNSwgRFBJT19QSFkw
LCBEUElPX0NIMSwgdHJ1ZSk7CiAKIAljaHZfcGh5X3Bvd2VyZ2F0ZV9sYW5lcyhlbmNvZGVyLCB0
cnVlLCBsYW5lX21hc2spOwogCi0Jdmx2X2RwaW9fZ2V0KGRldl9wcml2KTsKKwl2bHZfZHBpb19n
ZXQoaTkxNSk7CiAKIAkvKiBBc3NlcnQgZGF0YSBsYW5lIHJlc2V0ICovCiAJY2h2X2RhdGFfbGFu
ZV9zb2Z0X3Jlc2V0KGVuY29kZXIsIGNydGNfc3RhdGUsIHRydWUpOwogCiAJLyogcHJvZ3JhbSBs
ZWZ0L3JpZ2h0IGNsb2NrIGRpc3RyaWJ1dGlvbiAqLwogCWlmIChwaXBlICE9IFBJUEVfQikgewot
CQl2YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBfQ0hWX0NNTl9EVzVfQ0gwKTsK
KwkJdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBfQ0hWX0NNTl9EVzVfQ0gwKTsKIAkJ
dmFsICY9IH4oQ0hWX0JVRkxFRlRFTkExX01BU0sgfCBDSFZfQlVGUklHSFRFTkExX01BU0spOwog
CQlpZiAoY2ggPT0gRFBJT19DSDApCiAJCQl2YWwgfD0gQ0hWX0JVRkxFRlRFTkExX0ZPUkNFOwog
CQlpZiAoY2ggPT0gRFBJT19DSDEpCiAJCQl2YWwgfD0gQ0hWX0JVRlJJR0hURU5BMV9GT1JDRTsK
LQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIF9DSFZfQ01OX0RXNV9DSDAsIHZhbCk7
CisJCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIF9DSFZfQ01OX0RXNV9DSDAsIHZhbCk7CiAJ
fSBlbHNlIHsKLQkJdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgX0NIVl9DTU5f
RFcxX0NIMSk7CisJCXZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgX0NIVl9DTU5fRFcx
X0NIMSk7CiAJCXZhbCAmPSB+KENIVl9CVUZMRUZURU5BMl9NQVNLIHwgQ0hWX0JVRlJJR0hURU5B
Ml9NQVNLKTsKIAkJaWYgKGNoID09IERQSU9fQ0gwKQogCQkJdmFsIHw9IENIVl9CVUZMRUZURU5B
Ml9GT1JDRTsKIAkJaWYgKGNoID09IERQSU9fQ0gxKQogCQkJdmFsIHw9IENIVl9CVUZSSUdIVEVO
QTJfRk9SQ0U7Ci0JCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBfQ0hWX0NNTl9EVzFf
Q0gxLCB2YWwpOworCQl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBfQ0hWX0NNTl9EVzFfQ0gx
LCB2YWwpOwogCX0KIAogCS8qIHByb2dyYW0gY2xvY2sgY2hhbm5lbCB1c2FnZSAqLwotCXZhbCA9
IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MwMV9EVzgoY2gpKTsKKwl2YWwg
PSB2bHZfZHBpb19yZWFkKGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9EVzgoY2gpKTsKIAl2YWwgfD0g
Q0hWX1BDU19VU0VEQ0xLQ0hBTk5FTF9PVlJSSURFOwogCWlmIChwaXBlICE9IFBJUEVfQikKIAkJ
dmFsICY9IH5DSFZfUENTX1VTRURDTEtDSEFOTkVMOwogCWVsc2UKIAkJdmFsIHw9IENIVl9QQ1Nf
VVNFRENMS0NIQU5ORUw7Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1Mw
MV9EVzgoY2gpLCB2YWwpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9E
VzgoY2gpLCB2YWwpOwogCiAJaWYgKGNydGNfc3RhdGUtPmxhbmVfY291bnQgPiAyKSB7Ci0JCXZh
bCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MyM19EVzgoY2gpKTsKKwkJ
dmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBWTFZfUENTMjNfRFc4KGNoKSk7CiAJCXZh
bCB8PSBDSFZfUENTX1VTRURDTEtDSEFOTkVMX09WUlJJREU7CiAJCWlmIChwaXBlICE9IFBJUEVf
QikKIAkJCXZhbCAmPSB+Q0hWX1BDU19VU0VEQ0xLQ0hBTk5FTDsKIAkJZWxzZQogCQkJdmFsIHw9
IENIVl9QQ1NfVVNFRENMS0NIQU5ORUw7Ci0JCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBl
LCBWTFZfUENTMjNfRFc4KGNoKSwgdmFsKTsKKwkJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwg
VkxWX1BDUzIzX0RXOChjaCksIHZhbCk7CiAJfQogCiAJLyoKQEAgLTg0OSwxNCArODQ5LDE0IEBA
IHZvaWQgY2h2X3BoeV9wcmVfcGxsX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkgKiBtYXRjaGVzIHRoZSBwaXBlLCBidXQgaGVyZSB3ZSBuZWVkIHRvCiAJICogcGljayB0
aGUgQ0wgYmFzZWQgb24gdGhlIHBvcnQuCiAJICovCi0JdmFsID0gdmx2X2RwaW9fcmVhZChkZXZf
cHJpdiwgcGlwZSwgQ0hWX0NNTl9EVzE5KGNoKSk7CisJdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1
LCBwaXBlLCBDSFZfQ01OX0RXMTkoY2gpKTsKIAlpZiAocGlwZSAhPSBQSVBFX0IpCiAJCXZhbCAm
PSB+Q0hWX0NNTl9VU0VEQ0xLQ0hBTk5FTDsKIAllbHNlCiAJCXZhbCB8PSBDSFZfQ01OX1VTRURD
TEtDSEFOTkVMOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTko
Y2gpLCB2YWwpOworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIENIVl9DTU5fRFcxOShjaCks
IHZhbCk7CiAKLQl2bHZfZHBpb19wdXQoZGV2X3ByaXYpOworCXZsdl9kcGlvX3B1dChpOTE1KTsK
IH0KIAogdm9pZCBjaHZfcGh5X3ByZV9lbmNvZGVyX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKQEAgLTg2NCwyNCArODY0LDI0IEBAIHZvaWQgY2h2X3BoeV9wcmVfZW5jb2Rl
cl9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0
IGludGVsX2RpZ2l0YWxfcG9ydCAqZHBvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAllbnVtIGRwaW9fY2hhbm5lbCBjaCA9IHZsdl9kcG9ydF90
b19jaGFubmVsKGRwb3J0KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJaW50IGRh
dGEsIGksIHN0YWdnZXI7CiAJdTMyIHZhbDsKIAotCXZsdl9kcGlvX2dldChkZXZfcHJpdik7CisJ
dmx2X2RwaW9fZ2V0KGk5MTUpOwogCiAJLyogYWxsb3cgaGFyZHdhcmUgdG8gbWFuYWdlIFRYIEZJ
Rk8gcmVzZXQgc291cmNlICovCi0JdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwg
VkxWX1BDUzAxX0RXMTEoY2gpKTsKKwl2YWwgPSB2bHZfZHBpb19yZWFkKGk5MTUsIHBpcGUsIFZM
Vl9QQ1MwMV9EVzExKGNoKSk7CiAJdmFsICY9IH5EUElPX0xBTkVERVNLRVdfU1RSQVBfT1ZSRDsK
LQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BDUzAxX0RXMTEoY2gpLCB2YWwp
OworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9EVzExKGNoKSwgdmFsKTsK
IAogCWlmIChjcnRjX3N0YXRlLT5sYW5lX2NvdW50ID4gMikgewotCQl2YWwgPSB2bHZfZHBpb19y
ZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUENTMjNfRFcxMShjaCkpOworCQl2YWwgPSB2bHZfZHBp
b19yZWFkKGk5MTUsIHBpcGUsIFZMVl9QQ1MyM19EVzExKGNoKSk7CiAJCXZhbCAmPSB+RFBJT19M
QU5FREVTS0VXX1NUUkFQX09WUkQ7Ci0JCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBW
TFZfUENTMjNfRFcxMShjaCksIHZhbCk7CisJCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZM
Vl9QQ1MyM19EVzExKGNoKSwgdmFsKTsKIAl9CiAKIAkvKiBQcm9ncmFtIFR4IGxhbmUgbGF0ZW5j
eSBvcHRpbWFsIHNldHRpbmcqLwpAQCAtODkxLDcgKzg5MSw3IEBAIHZvaWQgY2h2X3BoeV9wcmVf
ZW5jb2Rlcl9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQlkYXRhID0g
MHgwOwogCQllbHNlCiAJCQlkYXRhID0gKGkgPT0gMSkgPyAweDAgOiAweDE7Ci0JCXZsdl9kcGlv
X3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfVFhfRFcxNChjaCwgaSksCisJCXZsdl9kcGlvX3dy
aXRlKGk5MTUsIHBpcGUsIENIVl9UWF9EVzE0KGNoLCBpKSwKIAkJCQlkYXRhIDw8IERQSU9fVVBB
Ul9TSElGVCk7CiAJfQogCkBAIC05MDcsMTcgKzkwNywxNyBAQCB2b2lkIGNodl9waHlfcHJlX2Vu
Y29kZXJfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWVsc2UKIAkJc3Rh
Z2dlciA9IDB4MjsKIAotCXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9Q
Q1MwMV9EVzExKGNoKSk7CisJdmFsID0gdmx2X2RwaW9fcmVhZChpOTE1LCBwaXBlLCBWTFZfUENT
MDFfRFcxMShjaCkpOwogCXZhbCB8PSBEUElPX1RYMl9TVEFHR0VSX01BU0soMHgxZik7Ci0Jdmx2
X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MwMV9EVzExKGNoKSwgdmFsKTsKKwl2
bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUENTMDFfRFcxMShjaCksIHZhbCk7CiAKIAlp
ZiAoY3J0Y19zdGF0ZS0+bGFuZV9jb3VudCA+IDIpIHsKLQkJdmFsID0gdmx2X2RwaW9fcmVhZChk
ZXZfcHJpdiwgcGlwZSwgVkxWX1BDUzIzX0RXMTEoY2gpKTsKKwkJdmFsID0gdmx2X2RwaW9fcmVh
ZChpOTE1LCBwaXBlLCBWTFZfUENTMjNfRFcxMShjaCkpOwogCQl2YWwgfD0gRFBJT19UWDJfU1RB
R0dFUl9NQVNLKDB4MWYpOwotCQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BD
UzIzX0RXMTEoY2gpLCB2YWwpOworCQl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUENT
MjNfRFcxMShjaCksIHZhbCk7CiAJfQogCi0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUs
IFZMVl9QQ1MwMV9EVzEyKGNoKSwKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUENT
MDFfRFcxMihjaCksCiAJCSAgICAgICBEUElPX0xBTkVTVEFHR0VSX1NUUkFQKHN0YWdnZXIpIHwK
IAkJICAgICAgIERQSU9fTEFORVNUQUdHRVJfU1RSQVBfT1ZSRCB8CiAJCSAgICAgICBEUElPX1RY
MV9TVEFHR0VSX01BU0soMHgxZikgfApAQCAtOTI1LDcgKzkyNSw3IEBAIHZvaWQgY2h2X3BoeV9w
cmVfZW5jb2Rlcl9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCSAgICAg
ICBEUElPX1RYMl9TVEFHR0VSX01VTFQoMCkpOwogCiAJaWYgKGNydGNfc3RhdGUtPmxhbmVfY291
bnQgPiAyKSB7Ci0JCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUENTMjNfRFcx
MihjaCksCisJCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1MyM19EVzEyKGNoKSwK
IAkJCSAgICAgICBEUElPX0xBTkVTVEFHR0VSX1NUUkFQKHN0YWdnZXIpIHwKIAkJCSAgICAgICBE
UElPX0xBTkVTVEFHR0VSX1NUUkFQX09WUkQgfAogCQkJICAgICAgIERQSU9fVFgxX1NUQUdHRVJf
TUFTSygweDFmKSB8CkBAIC05MzYsMTYgKzkzNiwxNiBAQCB2b2lkIGNodl9waHlfcHJlX2VuY29k
ZXJfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCS8qIERlYXNzZXJ0IGRh
dGEgbGFuZSByZXNldCAqLwogCWNodl9kYXRhX2xhbmVfc29mdF9yZXNldChlbmNvZGVyLCBjcnRj
X3N0YXRlLCBmYWxzZSk7CiAKLQl2bHZfZHBpb19wdXQoZGV2X3ByaXYpOworCXZsdl9kcGlvX3B1
dChpOTE1KTsKIH0KIAogdm9pZCBjaHZfcGh5X3JlbGVhc2VfY2wyX292ZXJyaWRlKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyKQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRw
b3J0ID0gZW5jX3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCiAJ
aWYgKGRwb3J0LT5yZWxlYXNlX2NsMl9vdmVycmlkZSkgewotCQljaHZfcGh5X3Bvd2VyZ2F0ZV9j
aChkZXZfcHJpdiwgRFBJT19QSFkwLCBEUElPX0NIMSwgZmFsc2UpOworCQljaHZfcGh5X3Bvd2Vy
Z2F0ZV9jaChpOTE1LCBEUElPX1BIWTAsIERQSU9fQ0gxLCBmYWxzZSk7CiAJCWRwb3J0LT5yZWxl
YXNlX2NsMl9vdmVycmlkZSA9IGZhbHNlOwogCX0KIH0KQEAgLTk1MywyNCArOTUzLDI0IEBAIHZv
aWQgY2h2X3BoeV9yZWxlYXNlX2NsMl9vdmVycmlkZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlcikKIHZvaWQgY2h2X3BoeV9wb3N0X3BsbF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9j
cnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMpLT5waXBlOwogCXUzMiB2YWw7CiAKLQl2bHZf
ZHBpb19nZXQoZGV2X3ByaXYpOworCXZsdl9kcGlvX2dldChpOTE1KTsKIAogCS8qIGRpc2FibGUg
bGVmdC9yaWdodCBjbG9jayBkaXN0cmlidXRpb24gKi8KIAlpZiAocGlwZSAhPSBQSVBFX0IpIHsK
LQkJdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgX0NIVl9DTU5fRFc1X0NIMCk7
CisJCXZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgX0NIVl9DTU5fRFc1X0NIMCk7CiAJ
CXZhbCAmPSB+KENIVl9CVUZMRUZURU5BMV9NQVNLIHwgQ0hWX0JVRlJJR0hURU5BMV9NQVNLKTsK
LQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIF9DSFZfQ01OX0RXNV9DSDAsIHZhbCk7
CisJCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIF9DSFZfQ01OX0RXNV9DSDAsIHZhbCk7CiAJ
fSBlbHNlIHsKLQkJdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgX0NIVl9DTU5f
RFcxX0NIMSk7CisJCXZhbCA9IHZsdl9kcGlvX3JlYWQoaTkxNSwgcGlwZSwgX0NIVl9DTU5fRFcx
X0NIMSk7CiAJCXZhbCAmPSB+KENIVl9CVUZMRUZURU5BMl9NQVNLIHwgQ0hWX0JVRlJJR0hURU5B
Ml9NQVNLKTsKLQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIF9DSFZfQ01OX0RXMV9D
SDEsIHZhbCk7CisJCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIF9DSFZfQ01OX0RXMV9DSDEs
IHZhbCk7CiAJfQogCi0Jdmx2X2RwaW9fcHV0KGRldl9wcml2KTsKKwl2bHZfZHBpb19wdXQoaTkx
NSk7CiAKIAkvKgogCSAqIExlYXZlIHRoZSBwb3dlciBkb3duIGJpdCBjbGVhcmVkIGZvciBhdCBs
ZWFzdCBvbmUKQEAgLTk4OCw1NyArOTg4LDU3IEBAIHZvaWQgdmx2X3NldF9waHlfc2lnbmFsX2xl
dmVsKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAgdTMyIGRlbXBoX3Jl
Z192YWx1ZSwgdTMyIHByZWVtcGhfcmVnX3ZhbHVlLAogCQkJICAgICAgdTMyIHVuaXF0cmFuc2Nh
bGVfcmVnX3ZhbHVlLCB1MzIgdHgzX2RlbXBoKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGVuY29kZXItPmJhc2UuY3J0Yyk7
CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZHBvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVu
Y29kZXItPmJhc2UpOwogCWVudW0gZHBpb19jaGFubmVsIHBvcnQgPSB2bHZfZHBvcnRfdG9fY2hh
bm5lbChkcG9ydCk7CiAJZW51bSBwaXBlIHBpcGUgPSBpbnRlbF9jcnRjLT5waXBlOwogCi0Jdmx2
X2RwaW9fZ2V0KGRldl9wcml2KTsKKwl2bHZfZHBpb19nZXQoaTkxNSk7CiAKLQl2bHZfZHBpb193
cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1RYX0RXNShwb3J0KSwgMHgwMDAwMDAwMCk7Ci0Jdmx2
X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9UWF9EVzQocG9ydCksIGRlbXBoX3JlZ192
YWx1ZSk7Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9UWF9EVzIocG9ydCks
CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgVkxWX1RYX0RXNShwb3J0KSwgMHgwMDAwMDAw
MCk7CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgVkxWX1RYX0RXNChwb3J0KSwgZGVtcGhf
cmVnX3ZhbHVlKTsKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfVFhfRFcyKHBvcnQp
LAogCQkJIHVuaXF0cmFuc2NhbGVfcmVnX3ZhbHVlKTsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJp
diwgcGlwZSwgVkxWX1RYX0RXMyhwb3J0KSwgMHgwQzc4MjA0MCk7CisJdmx2X2RwaW9fd3JpdGUo
aTkxNSwgcGlwZSwgVkxWX1RYX0RXMyhwb3J0KSwgMHgwQzc4MjA0MCk7CiAKIAlpZiAodHgzX2Rl
bXBoKQotCQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1RYM19EVzQocG9ydCks
IHR4M19kZW1waCk7CisJCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9UWDNfRFc0KHBv
cnQpLCB0eDNfZGVtcGgpOwogCi0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9Q
Q1NfRFcxMShwb3J0KSwgMHgwMDAzMDAwMCk7Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBp
cGUsIFZMVl9QQ1NfRFc5KHBvcnQpLCBwcmVlbXBoX3JlZ192YWx1ZSk7Ci0Jdmx2X2RwaW9fd3Jp
dGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9UWF9EVzUocG9ydCksIERQSU9fVFhfT0NBTElOSVRfRU4p
OworCXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1NfRFcxMShwb3J0KSwgMHgwMDAz
MDAwMCk7CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgVkxWX1BDU19EVzkocG9ydCksIHBy
ZWVtcGhfcmVnX3ZhbHVlKTsKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfVFhfRFc1
KHBvcnQpLCBEUElPX1RYX09DQUxJTklUX0VOKTsKIAotCXZsdl9kcGlvX3B1dChkZXZfcHJpdik7
CisJdmx2X2RwaW9fcHV0KGk5MTUpOwogfQogCiB2b2lkIHZsdl9waHlfcHJlX3BsbF9lbmFibGUo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
ZHBvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CiAJZW51bSBkcGlvX2NoYW5uZWwgcG9ydCA9IHZsdl9kcG9ydF90b19jaGFubmVsKGRw
b3J0KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKIAkvKiBQcm9ncmFtIFR4IGxh
bmUgcmVzZXRzIHRvIGRlZmF1bHQgKi8KLQl2bHZfZHBpb19nZXQoZGV2X3ByaXYpOworCXZsdl9k
cGlvX2dldChpOTE1KTsKIAotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUENT
X0RXMChwb3J0KSwKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUENTX0RXMChwb3J0
KSwKIAkJCSBEUElPX1BDU19UWF9MQU5FMl9SRVNFVCB8CiAJCQkgRFBJT19QQ1NfVFhfTEFORTFf
UkVTRVQpOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUENTX0RXMShwb3J0
KSwKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUENTX0RXMShwb3J0KSwKIAkJCSBE
UElPX1BDU19DTEtfQ1JJX1JYRUJfRUlPU19FTiB8CiAJCQkgRFBJT19QQ1NfQ0xLX0NSSV9SWERJ
R0ZJTFRTR19FTiB8CiAJCQkgKDE8PERQSU9fUENTX0NMS19EQVRBV0lEVEhfU0hJRlQpIHwKIAkJ
CQkgRFBJT19QQ1NfQ0xLX1NPRlRfUkVTRVQpOwogCiAJLyogRml4IHVwIGludGVyLXBhaXIgc2tl
dyBmYWlsdXJlICovCi0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1NfRFcx
Mihwb3J0KSwgMHgwMDc1MGYwMCk7Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZM
Vl9UWF9EVzExKHBvcnQpLCAweDAwMDAxNTAwKTsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwg
cGlwZSwgVkxWX1RYX0RXMTQocG9ydCksIDB4NDA0MDAwMDApOworCXZsdl9kcGlvX3dyaXRlKGk5
MTUsIHBpcGUsIFZMVl9QQ1NfRFcxMihwb3J0KSwgMHgwMDc1MGYwMCk7CisJdmx2X2RwaW9fd3Jp
dGUoaTkxNSwgcGlwZSwgVkxWX1RYX0RXMTEocG9ydCksIDB4MDAwMDE1MDApOworCXZsdl9kcGlv
X3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9UWF9EVzE0KHBvcnQpLCAweDQwNDAwMDAwKTsKIAotCXZs
dl9kcGlvX3B1dChkZXZfcHJpdik7CisJdmx2X2RwaW9fcHV0KGk5MTUpOwogfQogCiB2b2lkIHZs
dl9waHlfcHJlX2VuY29kZXJfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApA
QCAtMTA0Niw0MiArMTA0Niw0MiBAQCB2b2lkIHZsdl9waHlfcHJlX2VuY29kZXJfZW5hYmxlKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAgPSBlbmNfdG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9kaWdp
dGFsX3BvcnQgKmRwb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJh
c2UuY3J0Yyk7CiAJZW51bSBkcGlvX2NoYW5uZWwgcG9ydCA9IHZsdl9kcG9ydF90b19jaGFubmVs
KGRwb3J0KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIHZhbDsKIAotCXZs
dl9kcGlvX2dldChkZXZfcHJpdik7CisJdmx2X2RwaW9fZ2V0KGk5MTUpOwogCiAJLyogRW5hYmxl
IGNsb2NrIGNoYW5uZWxzIGZvciB0aGlzIHBvcnQgKi8KLQl2YWwgPSB2bHZfZHBpb19yZWFkKGRl
dl9wcml2LCBwaXBlLCBWTFZfUENTMDFfRFc4KHBvcnQpKTsKKwl2YWwgPSB2bHZfZHBpb19yZWFk
KGk5MTUsIHBpcGUsIFZMVl9QQ1MwMV9EVzgocG9ydCkpOwogCXZhbCA9IDA7CiAJaWYgKHBpcGUp
CiAJCXZhbCB8PSAoMTw8MjEpOwogCWVsc2UKIAkJdmFsICY9IH4oMTw8MjEpOwogCXZhbCB8PSAw
eDAwMTAwMGM0OwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUENTX0RXOChw
b3J0KSwgdmFsKTsKKwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUENTX0RXOChwb3J0
KSwgdmFsKTsKIAogCS8qIFByb2dyYW0gbGFuZSBjbG9jayAqLwotCXZsdl9kcGlvX3dyaXRlKGRl
dl9wcml2LCBwaXBlLCBWTFZfUENTX0RXMTQocG9ydCksIDB4MDA3NjAwMTgpOwotCXZsdl9kcGlv
X3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUENTX0RXMjMocG9ydCksIDB4MDA0MDA4ODgpOwor
CXZsdl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1NfRFcxNChwb3J0KSwgMHgwMDc2MDAx
OCk7CisJdmx2X2RwaW9fd3JpdGUoaTkxNSwgcGlwZSwgVkxWX1BDU19EVzIzKHBvcnQpLCAweDAw
NDAwODg4KTsKIAotCXZsdl9kcGlvX3B1dChkZXZfcHJpdik7CisJdmx2X2RwaW9fcHV0KGk5MTUp
OwogfQogCiB2b2lkIHZsdl9waHlfcmVzZXRfbGFuZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRl
KQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRwb3J0ID0gZW5jX3RvX2RpZ19wb3J0
KCZlbmNvZGVyLT5iYXNlKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAllbnVtIGRwaW9f
Y2hhbm5lbCBwb3J0ID0gdmx2X2Rwb3J0X3RvX2NoYW5uZWwoZHBvcnQpOwogCWVudW0gcGlwZSBw
aXBlID0gY3J0Yy0+cGlwZTsKIAotCXZsdl9kcGlvX2dldChkZXZfcHJpdik7Ci0Jdmx2X2RwaW9f
d3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1NfRFcwKHBvcnQpLCAweDAwMDAwMDAwKTsKLQl2
bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BDU19EVzEocG9ydCksIDB4MDBlMDAw
NjApOwotCXZsdl9kcGlvX3B1dChkZXZfcHJpdik7CisJdmx2X2RwaW9fZ2V0KGk5MTUpOworCXZs
dl9kcGlvX3dyaXRlKGk5MTUsIHBpcGUsIFZMVl9QQ1NfRFcwKHBvcnQpLCAweDAwMDAwMDAwKTsK
Kwl2bHZfZHBpb193cml0ZShpOTE1LCBwaXBlLCBWTFZfUENTX0RXMShwb3J0KSwgMHgwMGUwMDA2
MCk7CisJdmx2X2RwaW9fcHV0KGk5MTUpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZHBpb19waHkuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwaW9f
cGh5LmgKaW5kZXggZjQxOGFhYjkwYjdlLi5kNGM5MzkzYmViY2UgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwaW9fcGh5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfZHBpb19waHkuaApAQCAtMTUsMTYgKzE1LDE2IEBAIHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlOwogc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfZW5jb2RlcjsK
IAotdm9pZCBieHRfcG9ydF90b19waHlfY2hhbm5lbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0LAordm9pZCBieHRfcG9ydF90b19waHlfY2hhbm5lbChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwb3J0IHBvcnQsCiAJCQkgICAgIGVu
dW0gZHBpb19waHkgKnBoeSwgZW51bSBkcGlvX2NoYW5uZWwgKmNoKTsKLXZvaWQgYnh0X2RkaV9w
aHlfc2V0X3NpZ25hbF9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2
b2lkIGJ4dF9kZGlfcGh5X3NldF9zaWduYWxfbGV2ZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkJICBlbnVtIHBvcnQgcG9ydCwgdTMyIG1hcmdpbiwgdTMyIHNjYWxlLAogCQkJ
CSAgdTMyIGVuYWJsZSwgdTMyIGRlZW1waGFzaXMpOwotdm9pZCBieHRfZGRpX3BoeV9pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBkcGlvX3BoeSBwaHkpOwotdm9p
ZCBieHRfZGRpX3BoeV91bmluaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIGRwaW9fcGh5IHBoeSk7Ci1ib29sIGJ4dF9kZGlfcGh5X2lzX2VuYWJsZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBieHRfZGRpX3BoeV9pbml0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIGRwaW9fcGh5IHBoeSk7Cit2b2lkIGJ4dF9kZGlf
cGh5X3VuaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBkcGlvX3BoeSBw
aHkpOworYm9vbCBieHRfZGRpX3BoeV9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJICAgIGVudW0gZHBpb19waHkgcGh5KTsKLWJvb2wgYnh0X2RkaV9waHlfdmVy
aWZ5X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2Jvb2wgYnh0X2Rk
aV9waHlfdmVyaWZ5X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAg
ICAgZW51bSBkcGlvX3BoeSBwaHkpOwogdTggYnh0X2RkaV9waHlfY2FsY19sYW5lX2xhdF9vcHRp
bV9tYXNrKHU4IGxhbmVfY291bnQpOwogdm9pZCBieHRfZGRpX3BoeV9zZXRfbGFuZV9vcHRpbV9t
YXNrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZHBsbF9tZ3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2RwbGxfbWdyLmMKaW5kZXggMmQ0ZTdiOWE3YjlkLi4yZGFiY2RmMjdkZjQgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwbGxfbWdyLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZHBsbF9tZ3IuYwpAQCAtNDUsMTQgKzQ1LDE0IEBACiAgKi8KIAogc3Rh
dGljIHZvaWQKLWludGVsX2F0b21pY19kdXBsaWNhdGVfZHBsbF9zdGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9hdG9taWNfZHVwbGljYXRlX2RwbGxfc3RhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfc2hhcmVk
X2RwbGxfc3RhdGUgKnNoYXJlZF9kcGxsKQogewogCWVudW0gaW50ZWxfZHBsbF9pZCBpOwogCiAJ
LyogQ29weSBzaGFyZWQgZHBsbCBzdGF0ZSAqLwotCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+
bnVtX3NoYXJlZF9kcGxsOyBpKyspIHsKLQkJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwg
PSAmZGV2X3ByaXYtPnNoYXJlZF9kcGxsc1tpXTsKKwlmb3IgKGkgPSAwOyBpIDwgaTkxNS0+bnVt
X3NoYXJlZF9kcGxsOyBpKyspIHsKKwkJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwgPSAm
aTkxNS0+c2hhcmVkX2RwbGxzW2ldOwogCiAJCXNoYXJlZF9kcGxsW2ldID0gcGxsLT5zdGF0ZTsK
IAl9CkBAIC03Nyw0MCArNzcsNDAgQEAgaW50ZWxfYXRvbWljX2dldF9zaGFyZWRfZHBsbF9zdGF0
ZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqcykKIAogLyoqCiAgKiBpbnRlbF9nZXRfc2hhcmVk
X2RwbGxfYnlfaWQgLSBnZXQgYSBEUExMIGdpdmVuIGl0cyBpZAotICogQGRldl9wcml2OiBpOTE1
IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAaWQ6
IHBsbCBpZAogICoKICAqIFJldHVybnM6CiAgKiBBIHBvaW50ZXIgdG8gdGhlIERQTEwgd2l0aCBA
aWQKICAqLwogc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICoKLWludGVsX2dldF9zaGFyZWRfZHBs
bF9ieV9pZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9nZXRfc2hh
cmVkX2RwbGxfYnlfaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgZW51
bSBpbnRlbF9kcGxsX2lkIGlkKQogewotCXJldHVybiAmZGV2X3ByaXYtPnNoYXJlZF9kcGxsc1tp
ZF07CisJcmV0dXJuICZpOTE1LT5zaGFyZWRfZHBsbHNbaWRdOwogfQogCiAvKioKICAqIGludGVs
X2dldF9zaGFyZWRfZHBsbF9pZCAtIGdldCB0aGUgaWQgb2YgYSBEUExMCi0gKiBAZGV2X3ByaXY6
IGk5MTUgZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAq
IEBwbGw6IHRoZSBEUExMCiAgKgogICogUmV0dXJuczoKICAqIFRoZSBpZCBvZiBAcGxsCiAgKi8K
IGVudW0gaW50ZWxfZHBsbF9pZAotaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2lkKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludGVsX2dldF9zaGFyZWRfZHBsbF9pZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBs
bCkKIHsKLQlpZiAoV0FSTl9PTihwbGwgPCBkZXZfcHJpdi0+c2hhcmVkX2RwbGxzfHwKLQkJICAg
IHBsbCA+ICZkZXZfcHJpdi0+c2hhcmVkX2RwbGxzW2Rldl9wcml2LT5udW1fc2hhcmVkX2RwbGxd
KSkKKwlpZiAoV0FSTl9PTihwbGwgPCBpOTE1LT5zaGFyZWRfZHBsbHN8fAorCQkgICAgcGxsID4g
Jmk5MTUtPnNoYXJlZF9kcGxsc1tpOTE1LT5udW1fc2hhcmVkX2RwbGxdKSkKIAkJcmV0dXJuIC0x
OwogCi0JcmV0dXJuIChlbnVtIGludGVsX2RwbGxfaWQpIChwbGwgLSBkZXZfcHJpdi0+c2hhcmVk
X2RwbGxzKTsKKwlyZXR1cm4gKGVudW0gaW50ZWxfZHBsbF9pZCkgKHBsbCAtIGk5MTUtPnNoYXJl
ZF9kcGxscyk7CiB9CiAKIC8qIEZvciBJTEsrICovCi12b2lkIGFzc2VydF9zaGFyZWRfZHBsbChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGFzc2VydF9zaGFyZWRfZHBs
bChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCXN0cnVjdCBpbnRlbF9zaGFyZWRf
ZHBsbCAqcGxsLAogCQkJYm9vbCBzdGF0ZSkKIHsKQEAgLTEyMCw3ICsxMjAsNyBAQCB2b2lkIGFz
c2VydF9zaGFyZWRfZHBsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYg
KFdBUk4oIXBsbCwgImFzc2VydGluZyBEUExMICVzIHdpdGggbm8gRFBMTFxuIiwgb25vZmYoc3Rh
dGUpKSkKIAkJcmV0dXJuOwogCi0JY3VyX3N0YXRlID0gcGxsLT5pbmZvLT5mdW5jcy0+Z2V0X2h3
X3N0YXRlKGRldl9wcml2LCBwbGwsICZod19zdGF0ZSk7CisJY3VyX3N0YXRlID0gcGxsLT5pbmZv
LT5mdW5jcy0+Z2V0X2h3X3N0YXRlKGk5MTUsIHBsbCwgJmh3X3N0YXRlKTsKIAlJOTE1X1NUQVRF
X1dBUk4oY3VyX3N0YXRlICE9IHN0YXRlLAogCSAgICAgIiVzIGFzc2VydGlvbiBmYWlsdXJlIChl
eHBlY3RlZCAlcywgY3VycmVudCAlcylcbiIsCiAJCQlwbGwtPmluZm8tPm5hbWUsIG9ub2ZmKHN0
YXRlKSwgb25vZmYoY3VyX3N0YXRlKSk7CkBAIC0xMzYsMjIgKzEzNiwyMiBAQCB2b2lkIGFzc2Vy
dF9zaGFyZWRfZHBsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB2b2lkIGlu
dGVsX3ByZXBhcmVfc2hhcmVkX2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwg
KnBsbCA9IGNydGNfc3RhdGUtPnNoYXJlZF9kcGxsOwogCiAJaWYgKFdBUk5fT04ocGxsID09IE5V
TEwpKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHBsbF9sb2NrKTsKKwlt
dXRleF9sb2NrKCZpOTE1LT5kcGxsX2xvY2spOwogCVdBUk5fT04oIXBsbC0+c3RhdGUuY3J0Y19t
YXNrKTsKIAlpZiAoIXBsbC0+YWN0aXZlX21hc2spIHsKIAkJRFJNX0RFQlVHX0RSSVZFUigic2V0
dGluZyB1cCAlc1xuIiwgcGxsLT5pbmZvLT5uYW1lKTsKIAkJV0FSTl9PTihwbGwtPm9uKTsKLQkJ
YXNzZXJ0X3NoYXJlZF9kcGxsX2Rpc2FibGVkKGRldl9wcml2LCBwbGwpOworCQlhc3NlcnRfc2hh
cmVkX2RwbGxfZGlzYWJsZWQoaTkxNSwgcGxsKTsKIAotCQlwbGwtPmluZm8tPmZ1bmNzLT5wcmVw
YXJlKGRldl9wcml2LCBwbGwpOworCQlwbGwtPmluZm8tPmZ1bmNzLT5wcmVwYXJlKGk5MTUsIHBs
bCk7CiAJfQotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRwbGxfbG9jayk7CisJbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcGxsX2xvY2spOwogfQogCiAvKioKQEAgLTE2Myw3ICsxNjMsNyBAQCB2b2lk
IGludGVsX3ByZXBhcmVfc2hhcmVkX2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB2b2lkIGludGVsX2VuYWJsZV9zaGFyZWRfZHBsbChjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVj
dCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGw7CiAJdW5z
aWduZWQgaW50IGNydGNfbWFzayA9IGRybV9jcnRjX21hc2soJmNydGMtPmJhc2UpOwogCXVuc2ln
bmVkIGludCBvbGRfbWFzazsKQEAgLTE3MSw3ICsxNzEsNyBAQCB2b2lkIGludGVsX2VuYWJsZV9z
aGFyZWRfZHBsbChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlp
ZiAoV0FSTl9PTihwbGwgPT0gTlVMTCkpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2soJmRldl9w
cml2LT5kcGxsX2xvY2spOworCW11dGV4X2xvY2soJmk5MTUtPmRwbGxfbG9jayk7CiAJb2xkX21h
c2sgPSBwbGwtPmFjdGl2ZV9tYXNrOwogCiAJaWYgKFdBUk5fT04oIShwbGwtPnN0YXRlLmNydGNf
bWFzayAmIGNydGNfbWFzaykpIHx8CkBAIC0xODYsMTcgKzE4NiwxNyBAQCB2b2lkIGludGVsX2Vu
YWJsZV9zaGFyZWRfZHBsbChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIAogCWlmIChvbGRfbWFzaykgewogCQlXQVJOX09OKCFwbGwtPm9uKTsKLQkJYXNzZXJ0X3No
YXJlZF9kcGxsX2VuYWJsZWQoZGV2X3ByaXYsIHBsbCk7CisJCWFzc2VydF9zaGFyZWRfZHBsbF9l
bmFibGVkKGk5MTUsIHBsbCk7CiAJCWdvdG8gb3V0OwogCX0KIAlXQVJOX09OKHBsbC0+b24pOwog
CiAJRFJNX0RFQlVHX0tNUygiZW5hYmxpbmcgJXNcbiIsIHBsbC0+aW5mby0+bmFtZSk7Ci0JcGxs
LT5pbmZvLT5mdW5jcy0+ZW5hYmxlKGRldl9wcml2LCBwbGwpOworCXBsbC0+aW5mby0+ZnVuY3Mt
PmVuYWJsZShpOTE1LCBwbGwpOwogCXBsbC0+b24gPSB0cnVlOwogCiBvdXQ6Ci0JbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+ZHBsbF9sb2NrKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRwbGxfbG9j
ayk7CiB9CiAKIC8qKgpAQCAtMjA4LDE4ICsyMDgsMTggQEAgdm9pZCBpbnRlbF9lbmFibGVfc2hh
cmVkX2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB2b2lk
IGludGVsX2Rpc2FibGVfc2hhcmVkX2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2Rw
bGwgKnBsbCA9IGNydGNfc3RhdGUtPnNoYXJlZF9kcGxsOwogCXVuc2lnbmVkIGludCBjcnRjX21h
c2sgPSBkcm1fY3J0Y19tYXNrKCZjcnRjLT5iYXNlKTsKIAogCS8qIFBDSCBvbmx5IGF2YWlsYWJs
ZSBvbiBJTEsrICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA1KQorCWlmIChJTlRFTF9H
RU4oaTkxNSkgPCA1KQogCQlyZXR1cm47CiAKIAlpZiAocGxsID09IE5VTEwpCiAJCXJldHVybjsK
IAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcGxsX2xvY2spOworCW11dGV4X2xvY2soJmk5MTUt
PmRwbGxfbG9jayk7CiAJaWYgKFdBUk5fT04oIShwbGwtPmFjdGl2ZV9tYXNrICYgY3J0Y19tYXNr
KSkpCiAJCWdvdG8gb3V0OwogCkBAIC0yMjcsNyArMjI3LDcgQEAgdm9pZCBpbnRlbF9kaXNhYmxl
X3NoYXJlZF9kcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CQkgICAgICBwbGwtPmluZm8tPm5hbWUsIHBsbC0+YWN0aXZlX21hc2ssIHBsbC0+b24sCiAJCSAg
ICAgIGNydGMtPmJhc2UuYmFzZS5pZCk7CiAKLQlhc3NlcnRfc2hhcmVkX2RwbGxfZW5hYmxlZChk
ZXZfcHJpdiwgcGxsKTsKKwlhc3NlcnRfc2hhcmVkX2RwbGxfZW5hYmxlZChpOTE1LCBwbGwpOwog
CVdBUk5fT04oIXBsbC0+b24pOwogCiAJcGxsLT5hY3RpdmVfbWFzayAmPSB+Y3J0Y19tYXNrOwpA
QCAtMjM1LDExICsyMzUsMTEgQEAgdm9pZCBpbnRlbF9kaXNhYmxlX3NoYXJlZF9kcGxsKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlnb3RvIG91dDsKIAogCURS
TV9ERUJVR19LTVMoImRpc2FibGluZyAlc1xuIiwgcGxsLT5pbmZvLT5uYW1lKTsKLQlwbGwtPmlu
Zm8tPmZ1bmNzLT5kaXNhYmxlKGRldl9wcml2LCBwbGwpOworCXBsbC0+aW5mby0+ZnVuY3MtPmRp
c2FibGUoaTkxNSwgcGxsKTsKIAlwbGwtPm9uID0gZmFsc2U7CiAKIG91dDoKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT5kcGxsX2xvY2spOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHBsbF9sb2Nr
KTsKIH0KIAogc3RhdGljIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqCkBAIC0yNDgsNyArMjQ4
LDcgQEAgaW50ZWxfZmluZF9zaGFyZWRfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIAkJICAgICAgIGVudW0gaW50ZWxfZHBsbF9pZCByYW5nZV9tYXgpCiB7CiAJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0
Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCwgKnVudXNlZF9wbGwg
PSBOVUxMOwogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbF9zdGF0ZSAqc2hhcmVkX2RwbGw7CiAJ
ZW51bSBpbnRlbF9kcGxsX2lkIGk7CkBAIC0yNTYsNyArMjU2LDcgQEAgaW50ZWxfZmluZF9zaGFy
ZWRfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlzaGFyZWRfZHBs
bCA9IGludGVsX2F0b21pY19nZXRfc2hhcmVkX2RwbGxfc3RhdGUoY3J0Y19zdGF0ZS0+YmFzZS5z
dGF0ZSk7CiAKIAlmb3IgKGkgPSByYW5nZV9taW47IGkgPD0gcmFuZ2VfbWF4OyBpKyspIHsKLQkJ
cGxsID0gJmRldl9wcml2LT5zaGFyZWRfZHBsbHNbaV07CisJCXBsbCA9ICZpOTE1LT5zaGFyZWRf
ZHBsbHNbaV07CiAKIAkJLyogT25seSB3YW50IHRvIGNoZWNrIGVuYWJsZWQgdGltaW5ncyBmaXJz
dCAqLwogCQlpZiAoc2hhcmVkX2RwbGxbaV0uY3J0Y19tYXNrID09IDApIHsKQEAgLTMyMiw3ICsz
MjIsNyBAQCBpbnRlbF9yZWZlcmVuY2Vfc2hhcmVkX2RwbGwoc3RydWN0IGludGVsX3NoYXJlZF9k
cGxsICpwbGwsCiAgKi8KIHZvaWQgaW50ZWxfc2hhcmVkX2RwbGxfc3dhcF9zdGF0ZShzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShzdGF0ZS0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoc3RhdGUtPmRldik7CiAJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsX3N0
YXRlICpzaGFyZWRfZHBsbDsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbDsKIAllbnVt
IGludGVsX2RwbGxfaWQgaTsKQEAgLTMzMSwxMCArMzMxLDEwIEBAIHZvaWQgaW50ZWxfc2hhcmVk
X2RwbGxfc3dhcF9zdGF0ZShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCXJldHVy
bjsKIAogCXNoYXJlZF9kcGxsID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKS0+c2hhcmVk
X2RwbGw7Ci0JZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1fc2hhcmVkX2RwbGw7IGkrKykg
eworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT5udW1fc2hhcmVkX2RwbGw7IGkrKykgewogCQlzdHJ1
Y3QgaW50ZWxfc2hhcmVkX2RwbGxfc3RhdGUgdG1wOwogCi0JCXBsbCA9ICZkZXZfcHJpdi0+c2hh
cmVkX2RwbGxzW2ldOworCQlwbGwgPSAmaTkxNS0+c2hhcmVkX2RwbGxzW2ldOwogCiAJCXRtcCA9
IHBsbC0+c3RhdGU7CiAJCXBsbC0+c3RhdGUgPSBzaGFyZWRfZHBsbFtpXTsKQEAgLTM0Miw3ICsz
NDIsNyBAQCB2b2lkIGludGVsX3NoYXJlZF9kcGxsX3N3YXBfc3RhdGUoc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogCX0KIH0KIAotc3RhdGljIGJvb2wgaWJ4X3BjaF9kcGxsX2dldF9o
d19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBp
YnhfcGNoX2RwbGxfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCSAgICAgIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsLAogCQkJCSAgICAgIHN0cnVj
dCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0ZSkKIHsKQEAgLTM1MCw3ICszNTAsNyBAQCBz
dGF0aWMgYm9vbCBpYnhfcGNoX2RwbGxfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1MzIgdmFsOwogCi0J
d2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsCisJ
d2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwKIAkJCQkJ
CSAgICAgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSk7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1
cm4gZmFsc2U7CkBAIC0zNjAsMTIgKzM2MCwxMiBAQCBzdGF0aWMgYm9vbCBpYnhfcGNoX2RwbGxf
Z2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlod19zdGF0
ZS0+ZnAwID0gSTkxNV9SRUFEKFBDSF9GUDAoaWQpKTsKIAlod19zdGF0ZS0+ZnAxID0gSTkxNV9S
RUFEKFBDSF9GUDEoaWQpKTsKIAotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBQ
T1dFUl9ET01BSU5fRElTUExBWV9DT1JFLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2Vy
X3B1dChpOTE1LCBQT1dFUl9ET01BSU5fRElTUExBWV9DT1JFLCB3YWtlcmVmKTsKIAogCXJldHVy
biB2YWwgJiBEUExMX1ZDT19FTkFCTEU7CiB9CiAKLXN0YXRpYyB2b2lkIGlieF9wY2hfZHBsbF9w
cmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGli
eF9wY2hfZHBsbF9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSBz
dHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCkKIHsKIAljb25zdCBlbnVtIGludGVsX2RwbGxf
aWQgaWQgPSBwbGwtPmluZm8tPmlkOwpAQCAtMzc0LDEyICszNzQsMTIgQEAgc3RhdGljIHZvaWQg
aWJ4X3BjaF9kcGxsX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CUk5MTVfV1JJVEUoUENIX0ZQMShpZCksIHBsbC0+c3RhdGUuaHdfc3RhdGUuZnAxKTsKIH0KIAot
c3RhdGljIHZvaWQgaWJ4X2Fzc2VydF9wY2hfcmVmY2xrX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaWJ4X2Fzc2VydF9wY2hfcmVmY2xrX2Vu
YWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIHZhbDsKIAlib29s
IGVuYWJsZWQ7CiAKLQlJOTE1X1NUQVRFX1dBUk5fT04oIShIQVNfUENIX0lCWChkZXZfcHJpdikg
fHwgSEFTX1BDSF9DUFQoZGV2X3ByaXYpKSk7CisJSTkxNV9TVEFURV9XQVJOX09OKCEoSEFTX1BD
SF9JQlgoaTkxNSkgfHwgSEFTX1BDSF9DUFQoaTkxNSkpKTsKIAogCXZhbCA9IEk5MTVfUkVBRChQ
Q0hfRFJFRl9DT05UUk9MKTsKIAllbmFibGVkID0gISEodmFsICYgKERSRUZfU1NDX1NPVVJDRV9N
QVNLIHwgRFJFRl9OT05TUFJFQURfU09VUkNFX01BU0sgfApAQCAtMzg3LDEzICszODcsMTMgQEAg
c3RhdGljIHZvaWQgaWJ4X2Fzc2VydF9wY2hfcmVmY2xrX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfU1RBVEVfV0FSTighZW5hYmxlZCwgIlBDSCByZWZj
bGsgYXNzZXJ0aW9uIGZhaWx1cmUsIHNob3VsZCBiZSBhY3RpdmUgYnV0IGlzIGRpc2FibGVkXG4i
KTsKIH0KIAotc3RhdGljIHZvaWQgaWJ4X3BjaF9kcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpYnhfcGNoX2RwbGxfZW5hYmxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAq
cGxsKQogewogCWNvbnN0IGVudW0gaW50ZWxfZHBsbF9pZCBpZCA9IHBsbC0+aW5mby0+aWQ7CiAK
IAkvKiBQQ0ggcmVmY2xvY2sgbXVzdCBiZSBlbmFibGVkIGZpcnN0ICovCi0JaWJ4X2Fzc2VydF9w
Y2hfcmVmY2xrX2VuYWJsZWQoZGV2X3ByaXYpOworCWlieF9hc3NlcnRfcGNoX3JlZmNsa19lbmFi
bGVkKGk5MTUpOwogCiAJSTkxNV9XUklURShQQ0hfRFBMTChpZCksIHBsbC0+c3RhdGUuaHdfc3Rh
dGUuZHBsbCk7CiAKQEAgLTQxMSw3ICs0MTEsNyBAQCBzdGF0aWMgdm9pZCBpYnhfcGNoX2RwbGxf
ZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl1ZGVsYXkoMjAwKTsK
IH0KIAotc3RhdGljIHZvaWQgaWJ4X3BjaF9kcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaWJ4X3BjaF9kcGxsX2Rpc2FibGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAq
cGxsKQogewogCWNvbnN0IGVudW0gaW50ZWxfZHBsbF9pZCBpZCA9IHBsbC0+aW5mby0+aWQ7CkBA
IC00MjYsMTQgKzQyNiwxNCBAQCBpYnhfZ2V0X2RwbGwoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJICAgICBzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKIAlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0
Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsOwogCWVudW0gaW50
ZWxfZHBsbF9pZCBpOwogCi0JaWYgKEhBU19QQ0hfSUJYKGRldl9wcml2KSkgeworCWlmIChIQVNf
UENIX0lCWChpOTE1KSkgewogCQkvKiBJcm9ubGFrZSBQQ0ggaGFzIGEgZml4ZWQgUExMLT5QQ0gg
cGlwZSBtYXBwaW5nLiAqLwogCQlpID0gKGVudW0gaW50ZWxfZHBsbF9pZCkgY3J0Yy0+cGlwZTsK
LQkJcGxsID0gJmRldl9wcml2LT5zaGFyZWRfZHBsbHNbaV07CisJCXBsbCA9ICZpOTE1LT5zaGFy
ZWRfZHBsbHNbaV07CiAKIAkJRFJNX0RFQlVHX0tNUygiW0NSVEM6JWQ6JXNdIHVzaW5nIHByZS1h
bGxvY2F0ZWQgJXNcbiIsCiAJCQkgICAgICBjcnRjLT5iYXNlLmJhc2UuaWQsIGNydGMtPmJhc2Uu
bmFtZSwKQEAgLTQ1Myw3ICs0NTMsNyBAQCBpYnhfZ2V0X2RwbGwoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJcmV0dXJuIHBsbDsKIH0KIAotc3RhdGljIHZvaWQgaWJ4X2R1
bXBfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZv
aWQgaWJ4X2R1bXBfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZHBsbF9od19zdGF0ZSAqaHdfc3RhdGUpCiB7CiAJRFJN
X0RFQlVHX0tNUygiZHBsbF9od19zdGF0ZTogZHBsbDogMHgleCwgZHBsbF9tZDogMHgleCwgIgpA
QCAtNDcxLDcgKzQ3MSw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGxf
ZnVuY3MgaWJ4X3BjaF9kcGxsX2Z1bmNzID0gewogCS5nZXRfaHdfc3RhdGUgPSBpYnhfcGNoX2Rw
bGxfZ2V0X2h3X3N0YXRlLAogfTsKIAotc3RhdGljIHZvaWQgaHN3X2RkaV93cnBsbF9lbmFibGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaHN3X2RkaV93
cnBsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgc3Ry
dWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwpCiB7CiAJY29uc3QgZW51bSBpbnRlbF9kcGxsX2lk
IGlkID0gcGxsLT5pbmZvLT5pZDsKQEAgLTQ4MSw3ICs0ODEsNyBAQCBzdGF0aWMgdm9pZCBoc3df
ZGRpX3dycGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdWRl
bGF5KDIwKTsKIH0KIAotc3RhdGljIHZvaWQgaHN3X2RkaV9zcGxsX2VuYWJsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBoc3dfZGRpX3NwbGxfZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXN0cnVjdCBpbnRlbF9zaGFyZWRf
ZHBsbCAqcGxsKQogewogCUk5MTVfV1JJVEUoU1BMTF9DVEwsIHBsbC0+c3RhdGUuaHdfc3RhdGUu
c3BsbCk7CkBAIC00ODksNyArNDg5LDcgQEAgc3RhdGljIHZvaWQgaHN3X2RkaV9zcGxsX2VuYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdWRlbGF5KDIwKTsKIH0KIAot
c3RhdGljIHZvaWQgaHN3X2RkaV93cnBsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGhzd19kZGlfd3JwbGxfZGlzYWJsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxs
KQogewogCWNvbnN0IGVudW0gaW50ZWxfZHBsbF9pZCBpZCA9IHBsbC0+aW5mby0+aWQ7CkBAIC01
MDAsNyArNTAwLDcgQEAgc3RhdGljIHZvaWQgaHN3X2RkaV93cnBsbF9kaXNhYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlQT1NUSU5HX1JFQUQoV1JQTExfQ1RMKGlkKSk7
CiB9CiAKLXN0YXRpYyB2b2lkIGhzd19kZGlfc3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGhzd19kZGlfc3BsbF9kaXNhYmxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwg
KnBsbCkKIHsKIAl1MzIgdmFsOwpAQCAtNTEwLDcgKzUxMCw3IEBAIHN0YXRpYyB2b2lkIGhzd19k
ZGlfc3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlQT1NU
SU5HX1JFQUQoU1BMTF9DVEwpOwogfQogCi1zdGF0aWMgYm9vbCBoc3dfZGRpX3dycGxsX2dldF9o
d19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBo
c3dfZGRpX3dycGxsX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgICAgICAgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwsCiAJCQkJICAgICAgIHN0
cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0ZSkKIHsKQEAgLTUxOCw3ICs1MTgsNyBA
QCBzdGF0aWMgYm9vbCBoc3dfZGRpX3dycGxsX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJdTMyIHZhbDsK
IAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGRldl9wcml2
LAorCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsCiAJ
CQkJCQkgICAgIFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUpOwogCWlmICghd2FrZXJlZikKIAkJ
cmV0dXJuIGZhbHNlOwpAQCAtNTI2LDE5ICs1MjYsMTkgQEAgc3RhdGljIGJvb2wgaHN3X2RkaV93
cnBsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXZh
bCA9IEk5MTVfUkVBRChXUlBMTF9DVEwoaWQpKTsKIAlod19zdGF0ZS0+d3JwbGwgPSB2YWw7CiAK
LQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0RJU1BMQVlf
Q09SRSwgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9N
QUlOX0RJU1BMQVlfQ09SRSwgd2FrZXJlZik7CiAKIAlyZXR1cm4gdmFsICYgV1JQTExfUExMX0VO
QUJMRTsKIH0KIAotc3RhdGljIGJvb2wgaHN3X2RkaV9zcGxsX2dldF9od19zdGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBoc3dfZGRpX3NwbGxfZ2V0
X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgIHN0cnVj
dCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsLAogCQkJCSAgICAgIHN0cnVjdCBpbnRlbF9kcGxsX2h3
X3N0YXRlICpod19zdGF0ZSkKIHsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1MzIgdmFs
OwogCi0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3By
aXYsCisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwK
IAkJCQkJCSAgICAgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSk7CiAJaWYgKCF3YWtlcmVmKQog
CQlyZXR1cm4gZmFsc2U7CkBAIC01NDYsNyArNTQ2LDcgQEAgc3RhdGljIGJvb2wgaHN3X2RkaV9z
cGxsX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdmFs
ID0gSTkxNV9SRUFEKFNQTExfQ1RMKTsKIAlod19zdGF0ZS0+c3BsbCA9IHZhbDsKIAotCWludGVs
X2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBQT1dFUl9ET01BSU5fRElTUExBWV9DT1JFLCB3
YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01BSU5fRElT
UExBWV9DT1JFLCB3YWtlcmVmKTsKIAogCXJldHVybiB2YWwgJiBTUExMX1BMTF9FTkFCTEU7CiB9
CkBAIC03OTMsNyArNzkzLDcgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqaHN3
X2RkaV9oZG1pX2dldF9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICoKIHN0YXRpYyBzdHJ1
Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKgogaHN3X2RkaV9kcF9nZXRfZHBsbChzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYp
OwogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsOwogCWVudW0gaW50ZWxfZHBsbF9pZCBw
bGxfaWQ7CiAJaW50IGNsb2NrID0gY3J0Y19zdGF0ZS0+cG9ydF9jbG9jazsKQEAgLTgxMyw3ICs4
MTMsNyBAQCBoc3dfZGRpX2RwX2dldF9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCQlyZXR1cm4gTlVMTDsKIAl9CiAKLQlwbGwgPSBpbnRlbF9nZXRfc2hhcmVkX2Rw
bGxfYnlfaWQoZGV2X3ByaXYsIHBsbF9pZCk7CisJcGxsID0gaW50ZWxfZ2V0X3NoYXJlZF9kcGxs
X2J5X2lkKGk5MTUsIHBsbF9pZCk7CiAKIAlpZiAoIXBsbCkKIAkJcmV0dXJuIE5VTEw7CkBAIC04
NTUsNyArODU1LDcgQEAgaHN3X2dldF9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCXJldHVybiBwbGw7CiB9CiAKLXN0YXRpYyB2b2lkIGhzd19kdW1wX2h3X3N0YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGhzd19kdW1w
X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgY29uc3Qg
c3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKmh3X3N0YXRlKQogewogCURSTV9ERUJVR19LTVMo
ImRwbGxfaHdfc3RhdGU6IHdycGxsOiAweCV4IHNwbGw6IDB4JXhcbiIsCkBAIC04NzQsMTcgKzg3
NCwxNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsX2Z1bmNzIGhzd19k
ZGlfc3BsbF9mdW5jcyA9IHsKIAkuZ2V0X2h3X3N0YXRlID0gaHN3X2RkaV9zcGxsX2dldF9od19z
dGF0ZSwKIH07CiAKLXN0YXRpYyB2b2lkIGhzd19kZGlfbGNwbGxfZW5hYmxlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGhzd19kZGlfbGNwbGxfZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSBzdHJ1Y3QgaW50ZWxfc2hhcmVk
X2RwbGwgKnBsbCkKIHsKIH0KIAotc3RhdGljIHZvaWQgaHN3X2RkaV9sY3BsbF9kaXNhYmxlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGhzd19kZGlfbGNw
bGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgIHN0cnVjdCBp
bnRlbF9zaGFyZWRfZHBsbCAqcGxsKQogewogfQogCi1zdGF0aWMgYm9vbCBoc3dfZGRpX2xjcGxs
X2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
Ym9vbCBoc3dfZGRpX2xjcGxsX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCQkgICAgICAgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwsCiAJCQkJICAg
ICAgIHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0ZSkKIHsKQEAgLTkyOCw3ICs5
MjgsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHNrbF9kcGxsX3JlZ3Mgc2tsX2RwbGxfcmVnc1s0
XSA9IHsKIAl9LAogfTsKIAotc3RhdGljIHZvaWQgc2tsX2RkaV9wbGxfd3JpdGVfY3RybDEoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgc2tsX2RkaV9wbGxf
d3JpdGVfY3RybDEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgIHN0cnVj
dCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsKQogewogCWNvbnN0IGVudW0gaW50ZWxfZHBsbF9pZCBp
ZCA9IHBsbC0+aW5mby0+aWQ7CkBAIC05NDUsMTMgKzk0NSwxMyBAQCBzdGF0aWMgdm9pZCBza2xf
ZGRpX3BsbF93cml0ZV9jdHJsMShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
UE9TVElOR19SRUFEKERQTExfQ1RSTDEpOwogfQogCi1zdGF0aWMgdm9pZCBza2xfZGRpX3BsbF9l
bmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgc2ts
X2RkaV9wbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAg
IHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsKQogewogCWNvbnN0IHN0cnVjdCBza2xfZHBs
bF9yZWdzICpyZWdzID0gc2tsX2RwbGxfcmVnczsKIAljb25zdCBlbnVtIGludGVsX2RwbGxfaWQg
aWQgPSBwbGwtPmluZm8tPmlkOwogCi0Jc2tsX2RkaV9wbGxfd3JpdGVfY3RybDEoZGV2X3ByaXYs
IHBsbCk7CisJc2tsX2RkaV9wbGxfd3JpdGVfY3RybDEoaTkxNSwgcGxsKTsKIAogCUk5MTVfV1JJ
VEUocmVnc1tpZF0uY2ZnY3IxLCBwbGwtPnN0YXRlLmh3X3N0YXRlLmNmZ2NyMSk7CiAJSTkxNV9X
UklURShyZWdzW2lkXS5jZmdjcjIsIHBsbC0+c3RhdGUuaHdfc3RhdGUuY2ZnY3IyKTsKQEAgLTk2
Miw3ICs5NjIsNyBAQCBzdGF0aWMgdm9pZCBza2xfZGRpX3BsbF9lbmFibGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUocmVnc1tpZF0uY3RsLAogCQkgICBJ
OTE1X1JFQUQocmVnc1tpZF0uY3RsKSB8IExDUExMX1BMTF9FTkFCTEUpOwogCi0JaWYgKGludGVs
X3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zv
cl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCSAgICBEUExMX1NUQVRVUywKIAkJCQkgICAg
RFBMTF9MT0NLKGlkKSwKIAkJCQkgICAgRFBMTF9MT0NLKGlkKSwKQEAgLTk3MCwxMyArOTcwLDEz
IEBAIHN0YXRpYyB2b2lkIHNrbF9kZGlfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCURSTV9FUlJPUigiRFBMTCAlZCBub3QgbG9ja2VkXG4iLCBpZCk7CiB9
CiAKLXN0YXRpYyB2b2lkIHNrbF9kZGlfZHBsbDBfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHNrbF9kZGlfZHBsbDBfZW5hYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBs
bCkKIHsKLQlza2xfZGRpX3BsbF93cml0ZV9jdHJsMShkZXZfcHJpdiwgcGxsKTsKKwlza2xfZGRp
X3BsbF93cml0ZV9jdHJsMShpOTE1LCBwbGwpOwogfQogCi1zdGF0aWMgdm9pZCBza2xfZGRpX3Bs
bF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lk
IHNrbF9kZGlfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJ
c3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwpCiB7CiAJY29uc3Qgc3RydWN0IHNrbF9kcGxs
X3JlZ3MgKnJlZ3MgPSBza2xfZHBsbF9yZWdzOwpAQCAtOTg4LDEyICs5ODgsMTIgQEAgc3RhdGlj
IHZvaWQgc2tsX2RkaV9wbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJUE9TVElOR19SRUFEKHJlZ3NbaWRdLmN0bCk7CiB9CiAKLXN0YXRpYyB2b2lkIHNrbF9k
ZGlfZHBsbDBfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdm9pZCBza2xfZGRpX2RwbGwwX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCkKIHsKIH0KIAotc3RhdGlj
IGJvb2wgc2tsX2RkaV9wbGxfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyBib29sIHNrbF9kZGlfcGxsX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAq
cGxsLAogCQkJCSAgICAgc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKmh3X3N0YXRlKQogewpA
QCAtMTAwMyw3ICsxMDAzLDcgQEAgc3RhdGljIGJvb2wgc2tsX2RkaV9wbGxfZ2V0X2h3X3N0YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZjsKIAlib29sIHJldDsKIAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9p
Zl9lbmFibGVkKGRldl9wcml2LAorCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9p
Zl9lbmFibGVkKGk5MTUsCiAJCQkJCQkgICAgIFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUpOwog
CWlmICghd2FrZXJlZikKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMTAyNSwxMiArMTAyNSwxMiBAQCBz
dGF0aWMgYm9vbCBza2xfZGRpX3BsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCXJldCA9IHRydWU7CiAKIG91dDoKLQlpbnRlbF9kaXNwbGF5X3Bvd2Vy
X3B1dChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSwgd2FrZXJlZik7CisJaW50
ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSwgd2Fr
ZXJlZik7CiAKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgYm9vbCBza2xfZGRpX2RwbGwwX2dl
dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9v
bCBza2xfZGRpX2RwbGwwX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkgICAgICAgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwsCiAJCQkJICAgICAg
IHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0ZSkKIHsKQEAgLTEwNDAsNyArMTA0
MCw3IEBAIHN0YXRpYyBib29sIHNrbF9kZGlfZHBsbDBfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl1MzIgdmFsOwogCWJvb2wgcmV0OwogCi0Jd2FrZXJl
ZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsCisJd2FrZXJl
ZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoaTkxNSwKIAkJCQkJCSAgICAg
UE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSk7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1cm4gZmFs
c2U7CkBAIC0xMDU4LDcgKzEwNTgsNyBAQCBzdGF0aWMgYm9vbCBza2xfZGRpX2RwbGwwX2dldF9o
d19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0ID0gdHJ1ZTsK
IAogb3V0OgotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBQT1dFUl9ET01BSU5f
RElTUExBWV9DT1JFLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQ
T1dFUl9ET01BSU5fRElTUExBWV9DT1JFLCB3YWtlcmVmKTsKIAogCXJldHVybiByZXQ7CiB9CkBA
IC0xNDI0LDcgKzE0MjQsNyBAQCBza2xfZ2V0X2RwbGwoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJcmV0dXJuIHBsbDsKIH0KIAotc3RhdGljIHZvaWQgc2tsX2R1bXBfaHdf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgc2ts
X2R1bXBfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfZHBsbF9od19zdGF0ZSAqaHdfc3RhdGUpCiB7CiAJRFJNX0RFQlVH
X0tNUygiZHBsbF9od19zdGF0ZTogIgpAQCAtMTQ0Niw3ICsxNDQ2LDcgQEAgc3RhdGljIGNvbnN0
IHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbF9mdW5jcyBza2xfZGRpX2RwbGwwX2Z1bmNzID0gewog
CS5nZXRfaHdfc3RhdGUgPSBza2xfZGRpX2RwbGwwX2dldF9od19zdGF0ZSwKIH07CiAKLXN0YXRp
YyB2b2lkIGJ4dF9kZGlfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitzdGF0aWMgdm9pZCBieHRfZGRpX3BsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwpCiB7CiAJdTMyIHRl
bXA7CkBAIC0xNDU0LDE0ICsxNDU0LDE0IEBAIHN0YXRpYyB2b2lkIGJ4dF9kZGlfcGxsX2VuYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJZW51bSBkcGlvX3BoeSBwaHk7
CiAJZW51bSBkcGlvX2NoYW5uZWwgY2g7CiAKLQlieHRfcG9ydF90b19waHlfY2hhbm5lbChkZXZf
cHJpdiwgcG9ydCwgJnBoeSwgJmNoKTsKKwlieHRfcG9ydF90b19waHlfY2hhbm5lbChpOTE1LCBw
b3J0LCAmcGh5LCAmY2gpOwogCiAJLyogTm9uLVNTQyByZWZlcmVuY2UgKi8KIAl0ZW1wID0gSTkx
NV9SRUFEKEJYVF9QT1JUX1BMTF9FTkFCTEUocG9ydCkpOwogCXRlbXAgfD0gUE9SVF9QTExfUkVG
X1NFTDsKIAlJOTE1X1dSSVRFKEJYVF9QT1JUX1BMTF9FTkFCTEUocG9ydCksIHRlbXApOwogCi0J
aWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJaWYgKElTX0dFTUlOSUxBS0UoaTkxNSkp
IHsKIAkJdGVtcCA9IEk5MTVfUkVBRChCWFRfUE9SVF9QTExfRU5BQkxFKHBvcnQpKTsKIAkJdGVt
cCB8PSBQT1JUX1BMTF9QT1dFUl9FTkFCTEU7CiAJCUk5MTVfV1JJVEUoQlhUX1BPUlRfUExMX0VO
QUJMRShwb3J0KSwgdGVtcCk7CkBAIC0xNTQ5LDcgKzE1NDksNyBAQCBzdGF0aWMgdm9pZCBieHRf
ZGRpX3BsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJMjAw
KSkKIAkJRFJNX0VSUk9SKCJQTEwgJWQgbm90IGxvY2tlZFxuIiwgcG9ydCk7CiAKLQlpZiAoSVNf
R0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwlpZiAoSVNfR0VNSU5JTEFLRShpOTE1KSkgewogCQl0
ZW1wID0gSTkxNV9SRUFEKEJYVF9QT1JUX1RYX0RXNV9MTjAocGh5LCBjaCkpOwogCQl0ZW1wIHw9
IERDQ19ERUxBWV9SQU5HRV8yOwogCQlJOTE1X1dSSVRFKEJYVF9QT1JUX1RYX0RXNV9HUlAocGh5
LCBjaCksIHRlbXApOwpAQCAtMTU2Niw3ICsxNTY2LDcgQEAgc3RhdGljIHZvaWQgYnh0X2RkaV9w
bGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlJOTE1X1dSSVRF
KEJYVF9QT1JUX1BDU19EVzEyX0dSUChwaHksIGNoKSwgdGVtcCk7CiB9CiAKLXN0YXRpYyB2b2lk
IGJ4dF9kZGlfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgYnh0X2RkaV9wbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCQkJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwpCiB7CiAJZW51bSBwb3J0
IHBvcnQgPSAoZW51bSBwb3J0KXBsbC0+aW5mby0+aWQ7IC8qIDE6MSBwb3J0LT5QTEwgbWFwcGlu
ZyAqLwpAQCAtMTU3Nyw3ICsxNTc3LDcgQEAgc3RhdGljIHZvaWQgYnh0X2RkaV9wbGxfZGlzYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJSTkxNV9XUklURShCWFRfUE9S
VF9QTExfRU5BQkxFKHBvcnQpLCB0ZW1wKTsKIAlQT1NUSU5HX1JFQUQoQlhUX1BPUlRfUExMX0VO
QUJMRShwb3J0KSk7CiAKLQlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwlpZiAoSVNf
R0VNSU5JTEFLRShpOTE1KSkgewogCQl0ZW1wID0gSTkxNV9SRUFEKEJYVF9QT1JUX1BMTF9FTkFC
TEUocG9ydCkpOwogCQl0ZW1wICY9IH5QT1JUX1BMTF9QT1dFUl9FTkFCTEU7CiAJCUk5MTVfV1JJ
VEUoQlhUX1BPUlRfUExMX0VOQUJMRShwb3J0KSwgdGVtcCk7CkBAIC0xNTg4LDcgKzE1ODgsNyBA
QCBzdGF0aWMgdm9pZCBieHRfZGRpX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAl9CiB9CiAKLXN0YXRpYyBib29sIGJ4dF9kZGlfcGxsX2dldF9od19zdGF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBieHRfZGRp
X3BsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCXN0
cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsLAogCQkJCQlzdHJ1Y3QgaW50ZWxfZHBsbF9od19z
dGF0ZSAqaHdfc3RhdGUpCiB7CkBAIC0xNTk5LDkgKzE1OTksOSBAQCBzdGF0aWMgYm9vbCBieHRf
ZGRpX3BsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CXUzMiB2YWw7CiAJYm9vbCByZXQ7CiAKLQlieHRfcG9ydF90b19waHlfY2hhbm5lbChkZXZfcHJp
diwgcG9ydCwgJnBoeSwgJmNoKTsKKwlieHRfcG9ydF90b19waHlfY2hhbm5lbChpOTE1LCBwb3J0
LCAmcGh5LCAmY2gpOwogCi0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2Vu
YWJsZWQoZGV2X3ByaXYsCisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2Vu
YWJsZWQoaTkxNSwKIAkJCQkJCSAgICAgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSk7CiAJaWYg
KCF3YWtlcmVmKQogCQlyZXR1cm4gZmFsc2U7CkBAIC0xNjYwLDcgKzE2NjAsNyBAQCBzdGF0aWMg
Ym9vbCBieHRfZGRpX3BsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCXJldCA9IHRydWU7CiAKIG91dDoKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChk
ZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSwgd2FrZXJlZik7CisJaW50ZWxfZGlz
cGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSwgd2FrZXJlZik7
CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtMTgzMiw3ICsxODMyLDcgQEAgYnh0X2dldF9kcGxsKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAgICAgc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVk
X2RwbGwgKnBsbDsKIAllbnVtIGludGVsX2RwbGxfaWQgaWQ7CiAKQEAgLTE4NDYsNyArMTg0Niw3
IEBAIGJ4dF9nZXRfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAog
CS8qIDE6MSBtYXBwaW5nIGJldHdlZW4gcG9ydHMgYW5kIFBMTHMgKi8KIAlpZCA9IChlbnVtIGlu
dGVsX2RwbGxfaWQpIGVuY29kZXItPnBvcnQ7Ci0JcGxsID0gaW50ZWxfZ2V0X3NoYXJlZF9kcGxs
X2J5X2lkKGRldl9wcml2LCBpZCk7CisJcGxsID0gaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lk
KGk5MTUsIGlkKTsKIAogCURSTV9ERUJVR19LTVMoIltDUlRDOiVkOiVzXSB1c2luZyBwcmUtYWxs
b2NhdGVkICVzXG4iLAogCQkgICAgICBjcnRjLT5iYXNlLmJhc2UuaWQsIGNydGMtPmJhc2UubmFt
ZSwgcGxsLT5pbmZvLT5uYW1lKTsKQEAgLTE4NTYsNyArMTg1Niw3IEBAIGJ4dF9nZXRfZHBsbChz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlyZXR1cm4gcGxsOwogfQogCi1z
dGF0aWMgdm9pZCBieHRfZHVtcF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBieHRfZHVtcF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpo
d19zdGF0ZSkKIHsKIAlEUk1fREVCVUdfS01TKCJkcGxsX2h3X3N0YXRlOiBlYmIwOiAweCV4LCBl
YmI0OiAweCV4LCIKQEAgLTE4ODcsNyArMTg4Nyw3IEBAIHN0cnVjdCBpbnRlbF9kcGxsX21nciB7
CiAJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICooKmdldF9kcGxsKShzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkJICAgICAgc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIpOwogCi0Jdm9pZCAoKmR1bXBfaHdfc3RhdGUpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKKwl2b2lkICgqZHVtcF9od19zdGF0ZSkoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZHBsbF9od19zdGF0ZSAqaHdf
c3RhdGUpOwogfTsKIApAQCAtMTk0Niw3ICsxOTQ2LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBp
bnRlbF9kcGxsX21nciBieHRfcGxsX21nciA9IHsKIAkuZHVtcF9od19zdGF0ZSA9IGJ4dF9kdW1w
X2h3X3N0YXRlLAogfTsKIAotc3RhdGljIHZvaWQgY25sX2RkaV9wbGxfZW5hYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGNubF9kZGlfcGxsX2VuYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgICBzdHJ1Y3QgaW50ZWxf
c2hhcmVkX2RwbGwgKnBsbCkKIHsKIAljb25zdCBlbnVtIGludGVsX2RwbGxfaWQgaWQgPSBwbGwt
PmluZm8tPmlkOwpAQCAtMTk1OCw3ICsxOTU4LDcgQEAgc3RhdGljIHZvaWQgY25sX2RkaV9wbGxf
ZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlJOTE1X1dSSVRFKENO
TF9EUExMX0VOQUJMRShpZCksIHZhbCk7CiAKIAkvKiAyLiBXYWl0IGZvciBEUExMIHBvd2VyIHN0
YXRlIGVuYWJsZWQgaW4gRFBMTF9FTkFCTEUuICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lz
dGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkx
NS0+dW5jb3JlLAogCQkJCSAgICBDTkxfRFBMTF9FTkFCTEUoaWQpLAogCQkJCSAgICBQTExfUE9X
RVJfU1RBVEUsCiAJCQkJICAgIFBMTF9QT1dFUl9TVEFURSwKQEAgLTE5OTksNyArMTk5OSw3IEBA
IHN0YXRpYyB2b2lkIGNubF9kZGlfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAJSTkxNV9XUklURShDTkxfRFBMTF9FTkFCTEUoaWQpLCB2YWwpOwogCiAJLyog
Ny4gV2FpdCBmb3IgUExMIGxvY2sgc3RhdHVzIGluIERQTExfRU5BQkxFLiAqLwotCWlmIChpbnRl
bF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwlpZiAoaW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkgICAgQ05MX0RQTExfRU5BQkxFKGlkKSwK
IAkJCQkgICAgUExMX0xPQ0ssCiAJCQkJICAgIFBMTF9MT0NLLApAQCAtMjAyMSw3ICsyMDIxLDcg
QEAgc3RhdGljIHZvaWQgY25sX2RkaV9wbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkgKi8KIH0KIAotc3RhdGljIHZvaWQgY25sX2RkaV9wbGxfZGlzYWJsZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBjbmxfZGRpX3Bs
bF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXN0cnVjdCBpbnRl
bF9zaGFyZWRfZHBsbCAqcGxsKQogewogCWNvbnN0IGVudW0gaW50ZWxfZHBsbF9pZCBpZCA9IHBs
bC0+aW5mby0+aWQ7CkBAIC0yMDQ3LDcgKzIwNDcsNyBAQCBzdGF0aWMgdm9pZCBjbmxfZGRpX3Bs
bF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlJOTE1X1dSSVRF
KENOTF9EUExMX0VOQUJMRShpZCksIHZhbCk7CiAKIAkvKiA0LiBXYWl0IGZvciBQTEwgbm90IGxv
Y2tlZCBzdGF0dXMgaW4gRFBMTF9FTkFCTEUuICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lz
dGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkx
NS0+dW5jb3JlLAogCQkJCSAgICBDTkxfRFBMTF9FTkFCTEUoaWQpLAogCQkJCSAgICBQTExfTE9D
SywKIAkJCQkgICAgMCwKQEAgLTIwNjksNyArMjA2OSw3IEBAIHN0YXRpYyB2b2lkIGNubF9kZGlf
cGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJ
VEUoQ05MX0RQTExfRU5BQkxFKGlkKSwgdmFsKTsKIAogCS8qIDcuIFdhaXQgZm9yIERQTEwgcG93
ZXIgc3RhdGUgZGlzYWJsZWQgaW4gRFBMTF9FTkFCTEUuICovCi0JaWYgKGludGVsX3dhaXRfZm9y
X3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3Rl
cigmaTkxNS0+dW5jb3JlLAogCQkJCSAgICBDTkxfRFBMTF9FTkFCTEUoaWQpLAogCQkJCSAgICBQ
TExfUE9XRVJfU1RBVEUsCiAJCQkJICAgIDAsCkBAIC0yMDc3LDcgKzIwNzcsNyBAQCBzdGF0aWMg
dm9pZCBjbmxfZGRpX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJRFJNX0VSUk9SKCJQTEwgJWQgUG93ZXIgbm90IGRpc2FibGVkXG4iLCBpZCk7CiB9CiAK
LXN0YXRpYyBib29sIGNubF9kZGlfcGxsX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBjbmxfZGRpX3BsbF9nZXRfaHdfc3RhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICBzdHJ1Y3QgaW50ZWxfc2hhcmVk
X2RwbGwgKnBsbCwKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0
ZSkKIHsKQEAgLTIwODYsNyArMjA4Niw3IEBAIHN0YXRpYyBib29sIGNubF9kZGlfcGxsX2dldF9o
d19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdTMyIHZhbDsKIAli
b29sIHJldDsKIAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVk
KGRldl9wcml2LAorCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVk
KGk5MTUsCiAJCQkJCQkgICAgIFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUpOwogCWlmICghd2Fr
ZXJlZikKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMjEwNyw3ICsyMTA3LDcgQEAgc3RhdGljIGJvb2wg
Y25sX2RkaV9wbGxfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAlyZXQgPSB0cnVlOwogCiBvdXQ6Ci0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3By
aXYsIFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUsIHdha2VyZWYpOworCWludGVsX2Rpc3BsYXlf
cG93ZXJfcHV0KGk5MTUsIFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUsIHdha2VyZWYpOwogCiAJ
cmV0dXJuIHJldDsKIH0KQEAgLTIxOTksMTUgKzIxOTksMTUgQEAgc3RhdGljIHZvaWQgY25sX3dy
cGxsX3BhcmFtc19wb3B1bGF0ZShzdHJ1Y3Qgc2tsX3dycGxsX3BhcmFtcyAqcGFyYW1zLAogCXBh
cmFtcy0+ZGNvX2ZyYWN0aW9uID0gZGNvICYgMHg3ZmZmOwogfQogCi1pbnQgY25sX2hkbWlfcGxs
X3JlZl9jbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgY25sX2hk
bWlfcGxsX3JlZl9jbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnQg
cmVmX2Nsb2NrID0gZGV2X3ByaXYtPmNkY2xrLmh3LnJlZjsKKwlpbnQgcmVmX2Nsb2NrID0gaTkx
NS0+Y2RjbGsuaHcucmVmOwogCiAJLyoKIAkgKiBGb3IgSUNMKywgdGhlIHNwZWMgc3RhdGVzOiBp
ZiByZWZlcmVuY2UgZnJlcXVlbmN5IGlzIDM4LjQsCiAJICogdXNlIDE5LjIgYmVjYXVzZSB0aGUg
RFBMTCBhdXRvbWF0aWNhbGx5IGRpdmlkZXMgdGhhdCBieSAyLgogCSAqLwotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExICYmIHJlZl9jbG9jayA9PSAzODQwMCkKKwlpZiAoSU5URUxfR0VO
KGk5MTUpID49IDExICYmIHJlZl9jbG9jayA9PSAzODQwMCkKIAkJcmVmX2Nsb2NrID0gMTkyMDA7
CiAKIAlyZXR1cm4gcmVmX2Nsb2NrOwpAQCAtMjIxNyw3ICsyMjE3LDcgQEAgc3RhdGljIGJvb2wK
IGNubF9kZGlfY2FsY3VsYXRlX3dycGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQkJc3RydWN0IHNrbF93cnBsbF9wYXJhbXMgKndycGxsX3BhcmFtcykKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCXUzMiBhZmVfY2xvY2sgPSBjcnRjX3N0YXRlLT5w
b3J0X2Nsb2NrICogNTsKIAl1MzIgcmVmX2Nsb2NrOwogCXUzMiBkY29fbWluID0gNzk5ODAwMDsK
QEAgLTIyNTIsNyArMjI1Miw3IEBAIGNubF9kZGlfY2FsY3VsYXRlX3dycGxsKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJY25sX3dycGxsX2dldF9tdWx0aXBsaWVycyhi
ZXN0X2RpdiwgJnBkaXYsICZxZGl2LCAma2Rpdik7CiAKLQlyZWZfY2xvY2sgPSBjbmxfaGRtaV9w
bGxfcmVmX2Nsb2NrKGRldl9wcml2KTsKKwlyZWZfY2xvY2sgPSBjbmxfaGRtaV9wbGxfcmVmX2Ns
b2NrKGk5MTUpOwogCiAJY25sX3dycGxsX3BhcmFtc19wb3B1bGF0ZSh3cnBsbF9wYXJhbXMsIGJl
c3RfZGNvLCByZWZfY2xvY2ssCiAJCQkJICBwZGl2LCBxZGl2LCBrZGl2KTsKQEAgLTIzNzAsNyAr
MjM3MCw3IEBAIGNubF9nZXRfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAlyZXR1cm4gcGxsOwogfQogCi1zdGF0aWMgdm9pZCBjbmxfZHVtcF9od19zdGF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBjbmxfZHVtcF9od19z
dGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0ZSkKIHsKIAlEUk1fREVCVUdfS01TKCJkcGxs
X2h3X3N0YXRlOiAiCkBAIC0yNDc2LDkgKzI0NzYsOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHNr
bF93cnBsbF9wYXJhbXMgaWNsX3RidF9wbGxfMTlfMk1Iel92YWx1ZXMgPSB7CiBzdGF0aWMgYm9v
bCBpY2xfY2FsY19kcF9jb21ib19wbGwoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJCQkJICBzdHJ1Y3Qgc2tsX3dycGxsX3BhcmFtcyAqcGxsX3BhcmFtcykKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBpY2xfY29tYm9fcGxsX3Bh
cmFtcyAqcGFyYW1zID0KLQkJZGV2X3ByaXYtPmNkY2xrLmh3LnJlZiA9PSAyNDAwMCA/CisJCWk5
MTUtPmNkY2xrLmh3LnJlZiA9PSAyNDAwMCA/CiAJCWljbF9kcF9jb21ib19wbGxfMjRNSHpfdmFs
dWVzIDoKIAkJaWNsX2RwX2NvbWJvX3BsbF8xOV8yTUh6X3ZhbHVlczsKIAlpbnQgY2xvY2sgPSBj
cnRjX3N0YXRlLT5wb3J0X2Nsb2NrOwpAQCAtMjQ5OCw5ICsyNDk4LDkgQEAgc3RhdGljIGJvb2wg
aWNsX2NhbGNfZHBfY29tYm9fcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogc3RhdGljIGJvb2wgaWNsX2NhbGNfdGJ0X3BsbChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAkJCSAgICAgc3RydWN0IHNrbF93cnBsbF9wYXJhbXMgKnBsbF9wYXJhbXMp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0
YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAotCSpwbGxfcGFyYW1zID0gZGV2
X3ByaXYtPmNkY2xrLmh3LnJlZiA9PSAyNDAwMCA/CisJKnBsbF9wYXJhbXMgPSBpOTE1LT5jZGNs
ay5ody5yZWYgPT0gMjQwMDAgPwogCQkJaWNsX3RidF9wbGxfMjRNSHpfdmFsdWVzIDogaWNsX3Ri
dF9wbGxfMTlfMk1Iel92YWx1ZXM7CiAJcmV0dXJuIHRydWU7CiB9CkBAIC0yNTA4LDEyICsyNTA4
LDEyIEBAIHN0YXRpYyBib29sIGljbF9jYWxjX3RidF9wbGwoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgYm9vbCBpY2xfY2FsY19kcGxsX3N0YXRlKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCXN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CiAJdTMyIGNmZ2NyMCwg
Y2ZnY3IxOwogCXN0cnVjdCBza2xfd3JwbGxfcGFyYW1zIHBsbF9wYXJhbXMgPSB7IDAgfTsKIAli
b29sIHJldDsKIAotCWlmIChpbnRlbF9wb3J0X2lzX3RjKGRldl9wcml2LCBlbmNvZGVyLT5wb3J0
KSkKKwlpZiAoaW50ZWxfcG9ydF9pc190YyhpOTE1LCBlbmNvZGVyLT5wb3J0KSkKIAkJcmV0ID0g
aWNsX2NhbGNfdGJ0X3BsbChjcnRjX3N0YXRlLCAmcGxsX3BhcmFtcyk7CiAJZWxzZSBpZiAoaW50
ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkgfHwKIAkJIGlu
dGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RTSSkpCkBAIC0yNjI5
LDkgKzI2MjksOSBAQCBzdGF0aWMgYm9vbCBpY2xfbWdfcGxsX2ZpbmRfZGl2aXNvcnMoaW50IGNs
b2NrX2toeiwgYm9vbCBpc19kcCwgYm9vbCB1c2Vfc3NjLAogICovCiBzdGF0aWMgYm9vbCBpY2xf
Y2FsY19tZ19wbGxfc3RhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHBsbF9od19z
dGF0ZSAqcGxsX3N0YXRlID0gJmNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGU7Ci0JaW50IHJlZmNs
a19raHogPSBkZXZfcHJpdi0+Y2RjbGsuaHcucmVmOworCWludCByZWZjbGtfa2h6ID0gaTkxNS0+
Y2RjbGsuaHcucmVmOwogCWludCBjbG9jayA9IGNydGNfc3RhdGUtPnBvcnRfY2xvY2s7CiAJdTMy
IGRjb19raHosIG0xZGl2LCBtMmRpdl9pbnQsIG0yZGl2X3JlbSwgbTJkaXZfZnJhYzsKIAl1MzIg
aXJlZl9uZGl2LCBpcmVmX3RyaW0sIGlyZWZfcHVsc2VfdzsKQEAgLTI3OTYsMTggKzI3OTYsMTgg
QEAgc3RhdGljIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqCiBpY2xfZ2V0X2RwbGwoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICAgICBzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCXN0cnVjdCBp
bnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0OwogCXN0cnVjdCBpbnRlbF9zaGFyZWRf
ZHBsbCAqcGxsOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAllbnVtIGludGVs
X2RwbGxfaWQgbWluLCBtYXg7CiAJYm9vbCByZXQ7CiAKLQlpZiAoaW50ZWxfcG9ydF9pc19jb21i
b3BoeShkZXZfcHJpdiwgcG9ydCkpIHsKKwlpZiAoaW50ZWxfcG9ydF9pc19jb21ib3BoeShpOTE1
LCBwb3J0KSkgewogCQltaW4gPSBEUExMX0lEX0lDTF9EUExMMDsKIAkJbWF4ID0gRFBMTF9JRF9J
Q0xfRFBMTDE7CiAJCXJldCA9IGljbF9jYWxjX2RwbGxfc3RhdGUoY3J0Y19zdGF0ZSwgZW5jb2Rl
cik7Ci0JfSBlbHNlIGlmIChpbnRlbF9wb3J0X2lzX3RjKGRldl9wcml2LCBwb3J0KSkgeworCX0g
ZWxzZSBpZiAoaW50ZWxfcG9ydF9pc190YyhpOTE1LCBwb3J0KSkgewogCQlpZiAoZW5jb2Rlci0+
dHlwZSA9PSBJTlRFTF9PVVRQVVRfRFBfTVNUKSB7CiAJCQlzdHJ1Y3QgaW50ZWxfZHBfbXN0X2Vu
Y29kZXIgKm1zdF9lbmNvZGVyOwogCkBAIC0yODI0LDcgKzI4MjQsNyBAQCBpY2xfZ2V0X2RwbGwo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCX0gZWxzZSB7CiAJCQllbnVt
IHRjX3BvcnQgdGNfcG9ydDsKIAotCQkJdGNfcG9ydCA9IGludGVsX3BvcnRfdG9fdGMoZGV2X3By
aXYsIHBvcnQpOworCQkJdGNfcG9ydCA9IGludGVsX3BvcnRfdG9fdGMoaTkxNSwgcG9ydCk7CiAJ
CQltaW4gPSBpY2xfdGNfcG9ydF90b19wbGxfaWQodGNfcG9ydCk7CiAJCQltYXggPSBtaW47CiAJ
CQlyZXQgPSBpY2xfY2FsY19tZ19wbGxfc3RhdGUoY3J0Y19zdGF0ZSk7CkBAIC0yODUxLDcgKzI4
NTEsNyBAQCBpY2xfZ2V0X2RwbGwoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJcmV0dXJuIHBsbDsKIH0KIAotc3RhdGljIGJvb2wgbWdfcGxsX2dldF9od19zdGF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBtZ19wbGxfZ2V0X2h3
X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXN0cnVjdCBpbnRlbF9z
aGFyZWRfZHBsbCAqcGxsLAogCQkJCXN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0
ZSkKIHsKQEAgLTI4NjEsNyArMjg2MSw3IEBAIHN0YXRpYyBib29sIG1nX3BsbF9nZXRfaHdfc3Rh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWJvb2wgcmV0ID0gZmFsc2U7
CiAJdTMyIHZhbDsKIAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFi
bGVkKGRldl9wcml2LAorCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFi
bGVkKGk5MTUsCiAJCQkJCQkgICAgIFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUpOwogCWlmICgh
d2FrZXJlZikKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMjg5Niw3ICsyODk2LDcgQEAgc3RhdGljIGJv
b2wgbWdfcGxsX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJaHdfc3RhdGUtPm1nX3BsbF90ZGNfY29sZHN0X2JpYXMgPQogCQlJOTE1X1JFQUQoTUdfUExM
X1REQ19DT0xEU1RfQklBUyh0Y19wb3J0KSk7CiAKLQlpZiAoZGV2X3ByaXYtPmNkY2xrLmh3LnJl
ZiA9PSAzODQwMCkgeworCWlmIChpOTE1LT5jZGNsay5ody5yZWYgPT0gMzg0MDApIHsKIAkJaHdf
c3RhdGUtPm1nX3BsbF90ZGNfY29sZHN0X2JpYXNfbWFzayA9IE1HX1BMTF9URENfQ09MRFNUX0NP
TERTVEFSVDsKIAkJaHdfc3RhdGUtPm1nX3BsbF9iaWFzX21hc2sgPSAwOwogCX0gZWxzZSB7CkBA
IC0yOTA5LDExICsyOTA5LDExIEBAIHN0YXRpYyBib29sIG1nX3BsbF9nZXRfaHdfc3RhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJcmV0ID0gdHJ1ZTsKIG91dDoKLQlp
bnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09S
RSwgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlO
X0RJU1BMQVlfQ09SRSwgd2FrZXJlZik7CiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIGJvb2wg
aWNsX3BsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIGJvb2wgaWNsX3BsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkJIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsLAogCQkJCSBzdHJ1Y3Qg
aW50ZWxfZHBsbF9od19zdGF0ZSAqaHdfc3RhdGUsCiAJCQkJIGk5MTVfcmVnX3QgZW5hYmxlX3Jl
ZykKQEAgLTI5MjMsNyArMjkyMyw3IEBAIHN0YXRpYyBib29sIGljbF9wbGxfZ2V0X2h3X3N0YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlib29sIHJldCA9IGZhbHNlOwog
CXUzMiB2YWw7CiAKLQl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxl
ZChkZXZfcHJpdiwKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxl
ZChpOTE1LAogCQkJCQkJICAgICBQT1dFUl9ET01BSU5fRElTUExBWV9DT1JFKTsKIAlpZiAoIXdh
a2VyZWYpCiAJCXJldHVybiBmYWxzZTsKQEAgLTI5MzcsMjYgKzI5MzcsMjYgQEAgc3RhdGljIGJv
b2wgaWNsX3BsbF9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCiAJcmV0ID0gdHJ1ZTsKIG91dDoKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJp
diwgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSwgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9w
b3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlOX0RJU1BMQVlfQ09SRSwgd2FrZXJlZik7CiAJcmV0
dXJuIHJldDsKIH0KIAotc3RhdGljIGJvb2wgY29tYm9fcGxsX2dldF9od19zdGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBjb21ib19wbGxfZ2V0X2h3
X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgIHN0cnVjdCBpbnRl
bF9zaGFyZWRfZHBsbCAqcGxsLAogCQkJCSAgIHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpo
d19zdGF0ZSkKIHsKLQlyZXR1cm4gaWNsX3BsbF9nZXRfaHdfc3RhdGUoZGV2X3ByaXYsIHBsbCwg
aHdfc3RhdGUsCisJcmV0dXJuIGljbF9wbGxfZ2V0X2h3X3N0YXRlKGk5MTUsIHBsbCwgaHdfc3Rh
dGUsCiAJCQkJICAgIENOTF9EUExMX0VOQUJMRShwbGwtPmluZm8tPmlkKSk7CiB9CiAKLXN0YXRp
YyBib29sIHRidF9wbGxfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyBib29sIHRidF9wbGxfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCwKIAkJCQkg
c3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKmh3X3N0YXRlKQogewotCXJldHVybiBpY2xfcGxs
X2dldF9od19zdGF0ZShkZXZfcHJpdiwgcGxsLCBod19zdGF0ZSwgVEJUX1BMTF9FTkFCTEUpOwor
CXJldHVybiBpY2xfcGxsX2dldF9od19zdGF0ZShpOTE1LCBwbGwsIGh3X3N0YXRlLCBUQlRfUExM
X0VOQUJMRSk7CiB9CiAKLXN0YXRpYyB2b2lkIGljbF9kcGxsX3dyaXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGljbF9kcGxsX3dyaXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpw
bGwpCiB7CiAJc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKmh3X3N0YXRlID0gJnBsbC0+c3Rh
dGUuaHdfc3RhdGU7CkBAIC0yOTY3LDcgKzI5NjcsNyBAQCBzdGF0aWMgdm9pZCBpY2xfZHBsbF93
cml0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJUE9TVElOR19SRUFEKElD
TF9EUExMX0NGR0NSMShpZCkpOwogfQogCi1zdGF0aWMgdm9pZCBpY2xfbWdfcGxsX3dyaXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGljbF9tZ19wbGxf
d3JpdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgIHN0cnVjdCBpbnRl
bF9zaGFyZWRfZHBsbCAqcGxsKQogewogCXN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19z
dGF0ZSA9ICZwbGwtPnN0YXRlLmh3X3N0YXRlOwpAQCAtMzAxNyw3ICszMDE3LDcgQEAgc3RhdGlj
IHZvaWQgaWNsX21nX3BsbF93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJUE9TVElOR19SRUFEKE1HX1BMTF9URENfQ09MRFNUX0JJQVModGNfcG9ydCkpOwogfQogCi1z
dGF0aWMgdm9pZCBpY2xfcGxsX3Bvd2VyX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpY2xfcGxsX3Bvd2VyX2VuYWJsZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwsCiAJ
CQkJIGk5MTVfcmVnX3QgZW5hYmxlX3JlZykKIHsKQEAgLTMwMzEsMTIgKzMwMzEsMTIgQEAgc3Rh
dGljIHZvaWQgaWNsX3BsbF9wb3dlcl9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCSAqIFRoZSBzcGVjIHNheXMgd2UgbmVlZCB0byAid2FpdCIgYnV0IGl0IGFsc28g
c2F5cyBpdCBzaG91bGQgYmUKIAkgKiBpbW1lZGlhdGUuCiAJICovCi0JaWYgKGludGVsX3dhaXRf
Zm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBlbmFibGVfcmVnLAorCWlmIChpbnRlbF93
YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLCBlbmFibGVfcmVnLAogCQkJCSAgICBQTExf
UE9XRVJfU1RBVEUsIFBMTF9QT1dFUl9TVEFURSwgMSkpCiAJCURSTV9FUlJPUigiUExMICVkIFBv
d2VyIG5vdCBlbmFibGVkXG4iLCBwbGwtPmluZm8tPmlkKTsKIH0KIAotc3RhdGljIHZvaWQgaWNs
X3BsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZv
aWQgaWNsX3BsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBz
dHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCwKIAkJCSAgIGk5MTVfcmVnX3QgZW5hYmxlX3Jl
ZykKIHsKQEAgLTMwNDcsMTkgKzMwNDcsMTkgQEAgc3RhdGljIHZvaWQgaWNsX3BsbF9lbmFibGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoZW5hYmxlX3Jl
ZywgdmFsKTsKIAogCS8qIFRpbWVvdXQgaXMgYWN0dWFsbHkgNjAwdXMuICovCi0JaWYgKGludGVs
X3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBlbmFibGVfcmVnLAorCWlmIChp
bnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLCBlbmFibGVfcmVnLAogCQkJCSAg
ICBQTExfTE9DSywgUExMX0xPQ0ssIDEpKQogCQlEUk1fRVJST1IoIlBMTCAlZCBub3QgbG9ja2Vk
XG4iLCBwbGwtPmluZm8tPmlkKTsKIH0KIAotc3RhdGljIHZvaWQgY29tYm9fcGxsX2VuYWJsZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBjb21ib19wbGxf
ZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICBzdHJ1Y3QgaW50
ZWxfc2hhcmVkX2RwbGwgKnBsbCkKIHsKIAlpOTE1X3JlZ190IGVuYWJsZV9yZWcgPSBDTkxfRFBM
TF9FTkFCTEUocGxsLT5pbmZvLT5pZCk7CiAKLQlpY2xfcGxsX3Bvd2VyX2VuYWJsZShkZXZfcHJp
diwgcGxsLCBlbmFibGVfcmVnKTsKKwlpY2xfcGxsX3Bvd2VyX2VuYWJsZShpOTE1LCBwbGwsIGVu
YWJsZV9yZWcpOwogCi0JaWNsX2RwbGxfd3JpdGUoZGV2X3ByaXYsIHBsbCk7CisJaWNsX2RwbGxf
d3JpdGUoaTkxNSwgcGxsKTsKIAogCS8qCiAJICogRFZGUyBwcmUgc2VxdWVuY2Ugd291bGQgYmUg
aGVyZSwgYnV0IGluIG91ciBkcml2ZXIgdGhlIGNkY2xrIGNvZGUKQEAgLTMwNjcsMTcgKzMwNjcs
MTcgQEAgc3RhdGljIHZvaWQgY29tYm9fcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJICogbm90aGluZyBoZXJlLgogCSAqLwogCi0JaWNsX3BsbF9lbmFibGUo
ZGV2X3ByaXYsIHBsbCwgZW5hYmxlX3JlZyk7CisJaWNsX3BsbF9lbmFibGUoaTkxNSwgcGxsLCBl
bmFibGVfcmVnKTsKIAogCS8qIERWRlMgcG9zdCBzZXF1ZW5jZSB3b3VsZCBiZSBoZXJlLiBTZWUg
dGhlIGNvbW1lbnQgYWJvdmUuICovCiB9CiAKLXN0YXRpYyB2b2lkIHRidF9wbGxfZW5hYmxlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHRidF9wbGxfZW5h
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgc3RydWN0IGludGVsX3No
YXJlZF9kcGxsICpwbGwpCiB7Ci0JaWNsX3BsbF9wb3dlcl9lbmFibGUoZGV2X3ByaXYsIHBsbCwg
VEJUX1BMTF9FTkFCTEUpOworCWljbF9wbGxfcG93ZXJfZW5hYmxlKGk5MTUsIHBsbCwgVEJUX1BM
TF9FTkFCTEUpOwogCi0JaWNsX2RwbGxfd3JpdGUoZGV2X3ByaXYsIHBsbCk7CisJaWNsX2RwbGxf
d3JpdGUoaTkxNSwgcGxsKTsKIAogCS8qCiAJICogRFZGUyBwcmUgc2VxdWVuY2Ugd291bGQgYmUg
aGVyZSwgYnV0IGluIG91ciBkcml2ZXIgdGhlIGNkY2xrIGNvZGUKQEAgLTMwODUsMjAgKzMwODUs
MjAgQEAgc3RhdGljIHZvaWQgdGJ0X3BsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCSAqIG5vdGhpbmcgaGVyZS4KIAkgKi8KIAotCWljbF9wbGxfZW5hYmxlKGRl
dl9wcml2LCBwbGwsIFRCVF9QTExfRU5BQkxFKTsKKwlpY2xfcGxsX2VuYWJsZShpOTE1LCBwbGws
IFRCVF9QTExfRU5BQkxFKTsKIAogCS8qIERWRlMgcG9zdCBzZXF1ZW5jZSB3b3VsZCBiZSBoZXJl
LiBTZWUgdGhlIGNvbW1lbnQgYWJvdmUuICovCiB9CiAKLXN0YXRpYyB2b2lkIG1nX3BsbF9lbmFi
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgbWdfcGxs
X2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgc3RydWN0IGludGVs
X3NoYXJlZF9kcGxsICpwbGwpCiB7CiAJaTkxNV9yZWdfdCBlbmFibGVfcmVnID0KIAkJTUdfUExM
X0VOQUJMRShpY2xfcGxsX2lkX3RvX3RjX3BvcnQocGxsLT5pbmZvLT5pZCkpOwogCi0JaWNsX3Bs
bF9wb3dlcl9lbmFibGUoZGV2X3ByaXYsIHBsbCwgZW5hYmxlX3JlZyk7CisJaWNsX3BsbF9wb3dl
cl9lbmFibGUoaTkxNSwgcGxsLCBlbmFibGVfcmVnKTsKIAotCWljbF9tZ19wbGxfd3JpdGUoZGV2
X3ByaXYsIHBsbCk7CisJaWNsX21nX3BsbF93cml0ZShpOTE1LCBwbGwpOwogCiAJLyoKIAkgKiBE
VkZTIHByZSBzZXF1ZW5jZSB3b3VsZCBiZSBoZXJlLCBidXQgaW4gb3VyIGRyaXZlciB0aGUgY2Rj
bGsgY29kZQpAQCAtMzEwNiwxMiArMzEwNiwxMiBAQCBzdGF0aWMgdm9pZCBtZ19wbGxfZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiBub3RoaW5nIGhlcmUuCiAJ
ICovCiAKLQlpY2xfcGxsX2VuYWJsZShkZXZfcHJpdiwgcGxsLCBlbmFibGVfcmVnKTsKKwlpY2xf
cGxsX2VuYWJsZShpOTE1LCBwbGwsIGVuYWJsZV9yZWcpOwogCiAJLyogRFZGUyBwb3N0IHNlcXVl
bmNlIHdvdWxkIGJlIGhlcmUuIFNlZSB0aGUgY29tbWVudCBhYm92ZS4gKi8KIH0KIAotc3RhdGlj
IHZvaWQgaWNsX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyB2b2lkIGljbF9wbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCwKIAkJCSAgICBpOTE1X3Jl
Z190IGVuYWJsZV9yZWcpCiB7CkBAIC0zMTMwLDcgKzMxMzAsNyBAQCBzdGF0aWMgdm9pZCBpY2xf
cGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJ
VEUoZW5hYmxlX3JlZywgdmFsKTsKIAogCS8qIFRpbWVvdXQgaXMgYWN0dWFsbHkgMXVzLiAqLwot
CWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwlpZiAoaW50
ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkgICAgZW5hYmxlX3JlZywg
UExMX0xPQ0ssIDAsIDEpKQogCQlEUk1fRVJST1IoIlBMTCAlZCBsb2NrZWRcbiIsIHBsbC0+aW5m
by0+aWQpOwogCkBAIC0zMTQ0LDMzICszMTQ0LDMzIEBAIHN0YXRpYyB2b2lkIGljbF9wbGxfZGlz
YWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogVGhlIHNwZWMgc2F5
cyB3ZSBuZWVkIHRvICJ3YWl0IiBidXQgaXQgYWxzbyBzYXlzIGl0IHNob3VsZCBiZQogCSAqIGlt
bWVkaWF0ZS4KIAkgKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51
bmNvcmUsCisJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJ
ICAgIGVuYWJsZV9yZWcsIFBMTF9QT1dFUl9TVEFURSwgMCwgMSkpCiAJCURSTV9FUlJPUigiUExM
ICVkIFBvd2VyIG5vdCBkaXNhYmxlZFxuIiwgcGxsLT5pbmZvLT5pZCk7CiB9CiAKLXN0YXRpYyB2
b2lkIGNvbWJvX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyB2b2lkIGNvbWJvX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJICAgICAgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwpCiB7Ci0JaWNsX3Bs
bF9kaXNhYmxlKGRldl9wcml2LCBwbGwsIENOTF9EUExMX0VOQUJMRShwbGwtPmluZm8tPmlkKSk7
CisJaWNsX3BsbF9kaXNhYmxlKGk5MTUsIHBsbCwgQ05MX0RQTExfRU5BQkxFKHBsbC0+aW5mby0+
aWQpKTsKIH0KIAotc3RhdGljIHZvaWQgdGJ0X3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHRidF9wbGxfZGlzYWJsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBs
bCkKIHsKLQlpY2xfcGxsX2Rpc2FibGUoZGV2X3ByaXYsIHBsbCwgVEJUX1BMTF9FTkFCTEUpOwor
CWljbF9wbGxfZGlzYWJsZShpOTE1LCBwbGwsIFRCVF9QTExfRU5BQkxFKTsKIH0KIAotc3RhdGlj
IHZvaWQgbWdfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgbWdfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkgICBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCkKIHsKIAlpOTE1X3JlZ190IGVu
YWJsZV9yZWcgPQogCQlNR19QTExfRU5BQkxFKGljbF9wbGxfaWRfdG9fdGNfcG9ydChwbGwtPmlu
Zm8tPmlkKSk7CiAKLQlpY2xfcGxsX2Rpc2FibGUoZGV2X3ByaXYsIHBsbCwgZW5hYmxlX3JlZyk7
CisJaWNsX3BsbF9kaXNhYmxlKGk5MTUsIHBsbCwgZW5hYmxlX3JlZyk7CiB9CiAKLXN0YXRpYyB2
b2lkIGljbF9kdW1wX2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyB2b2lkIGljbF9kdW1wX2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKmh3X3N0YXRl
KQogewogCURSTV9ERUJVR19LTVMoImRwbGxfaHdfc3RhdGU6IGNmZ2NyMDogMHgleCwgY2ZnY3Ix
OiAweCV4LCAiCkBAIC0zMjQ3LDI4ICszMjQ3LDI4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50
ZWxfZHBsbF9tZ3IgZWhsX3BsbF9tZ3IgPSB7CiAgKi8KIHZvaWQgaW50ZWxfc2hhcmVkX2RwbGxf
aW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZGV2KTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfZHBsbF9tZ3IgKmRwbGxfbWdy
ID0gTlVMTDsKIAljb25zdCBzdHJ1Y3QgZHBsbF9pbmZvICpkcGxsX2luZm87CiAJaW50IGk7CiAK
LQlpZiAoSVNfRUxLSEFSVExBS0UoZGV2X3ByaXYpKQorCWlmIChJU19FTEtIQVJUTEFLRShpOTE1
KSkKIAkJZHBsbF9tZ3IgPSAmZWhsX3BsbF9tZ3I7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCWRwbGxfbWdy
ID0gJmljbF9wbGxfbWdyOwotCWVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKQorCWVs
c2UgaWYgKElTX0NBTk5PTkxBS0UoaTkxNSkpCiAJCWRwbGxfbWdyID0gJmNubF9wbGxfbWdyOwot
CWVsc2UgaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0dFTjlfQkMoaTkx
NSkpCiAJCWRwbGxfbWdyID0gJnNrbF9wbGxfbWdyOwotCWVsc2UgaWYgKElTX0dFTjlfTFAoZGV2
X3ByaXYpKQorCWVsc2UgaWYgKElTX0dFTjlfTFAoaTkxNSkpCiAJCWRwbGxfbWdyID0gJmJ4dF9w
bGxfbWdyOwotCWVsc2UgaWYgKEhBU19EREkoZGV2X3ByaXYpKQorCWVsc2UgaWYgKEhBU19EREko
aTkxNSkpCiAJCWRwbGxfbWdyID0gJmhzd19wbGxfbWdyOwotCWVsc2UgaWYgKEhBU19QQ0hfSUJY
KGRldl9wcml2KSB8fCBIQVNfUENIX0NQVChkZXZfcHJpdikpCisJZWxzZSBpZiAoSEFTX1BDSF9J
QlgoaTkxNSkgfHwgSEFTX1BDSF9DUFQoaTkxNSkpCiAJCWRwbGxfbWdyID0gJnBjaF9wbGxfbWdy
OwogCiAJaWYgKCFkcGxsX21ncikgewotCQlkZXZfcHJpdi0+bnVtX3NoYXJlZF9kcGxsID0gMDsK
KwkJaTkxNS0+bnVtX3NoYXJlZF9kcGxsID0gMDsKIAkJcmV0dXJuOwogCX0KIApAQCAtMzI3Niwx
NCArMzI3NiwxNCBAQCB2b2lkIGludGVsX3NoYXJlZF9kcGxsX2luaXQoc3RydWN0IGRybV9kZXZp
Y2UgKmRldikKIAogCWZvciAoaSA9IDA7IGRwbGxfaW5mb1tpXS5uYW1lOyBpKyspIHsKIAkJV0FS
Tl9PTihpICE9IGRwbGxfaW5mb1tpXS5pZCk7Ci0JCWRldl9wcml2LT5zaGFyZWRfZHBsbHNbaV0u
aW5mbyA9ICZkcGxsX2luZm9baV07CisJCWk5MTUtPnNoYXJlZF9kcGxsc1tpXS5pbmZvID0gJmRw
bGxfaW5mb1tpXTsKIAl9CiAKLQlkZXZfcHJpdi0+ZHBsbF9tZ3IgPSBkcGxsX21ncjsKLQlkZXZf
cHJpdi0+bnVtX3NoYXJlZF9kcGxsID0gaTsKLQltdXRleF9pbml0KCZkZXZfcHJpdi0+ZHBsbF9s
b2NrKTsKKwlpOTE1LT5kcGxsX21nciA9IGRwbGxfbWdyOworCWk5MTUtPm51bV9zaGFyZWRfZHBs
bCA9IGk7CisJbXV0ZXhfaW5pdCgmaTkxNS0+ZHBsbF9sb2NrKTsKIAotCUJVR19PTihkZXZfcHJp
di0+bnVtX3NoYXJlZF9kcGxsID4gSTkxNV9OVU1fUExMUyk7CisJQlVHX09OKGk5MTUtPm51bV9z
aGFyZWRfZHBsbCA+IEk5MTVfTlVNX1BMTFMpOwogfQogCiAvKioKQEAgLTMzMDQsOCArMzMwNCw4
IEBAIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqCiBpbnRlbF9nZXRfc2hhcmVkX2RwbGwoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgICAgIHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBpbnRl
bF9kcGxsX21nciAqZHBsbF9tZ3IgPSBkZXZfcHJpdi0+ZHBsbF9tZ3I7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsK
Kwljb25zdCBzdHJ1Y3QgaW50ZWxfZHBsbF9tZ3IgKmRwbGxfbWdyID0gaTkxNS0+ZHBsbF9tZ3I7
CiAKIAlpZiAoV0FSTl9PTighZHBsbF9tZ3IpKQogCQlyZXR1cm4gTlVMTDsKQEAgLTMzMzUsMTYg
KzMzMzUsMTYgQEAgdm9pZCBpbnRlbF9yZWxlYXNlX3NoYXJlZF9kcGxsKHN0cnVjdCBpbnRlbF9z
aGFyZWRfZHBsbCAqZHBsbCwKIAogLyoqCiAgKiBpbnRlbF9zaGFyZWRfZHBsbF9kdW1wX2h3X3N0
YXRlIC0gd3JpdGUgaHdfc3RhdGUgdG8gZG1lc2cKLSAqIEBkZXZfcHJpdjogaTkxNSBkcm0gZGV2
aWNlCisgKiBAaTkxNTogaTkxNSBkcm0gZGV2aWNlCiAgKiBAaHdfc3RhdGU6IGh3IHN0YXRlIHRv
IGJlIHdyaXR0ZW4gdG8gdGhlIGxvZwogICoKICAqIFdyaXRlIHRoZSByZWxldmFudCB2YWx1ZXMg
aW4gQGh3X3N0YXRlIHRvIGRtZXNnIHVzaW5nIERSTV9ERUJVR19LTVMuCiAgKi8KLXZvaWQgaW50
ZWxfZHBsbF9kdW1wX2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3ZvaWQgaW50ZWxfZHBsbF9kdW1wX2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKmh3X3N0YXRl
KQogewotCWlmIChkZXZfcHJpdi0+ZHBsbF9tZ3IpIHsKLQkJZGV2X3ByaXYtPmRwbGxfbWdyLT5k
dW1wX2h3X3N0YXRlKGRldl9wcml2LCBod19zdGF0ZSk7CisJaWYgKGk5MTUtPmRwbGxfbWdyKSB7
CisJCWk5MTUtPmRwbGxfbWdyLT5kdW1wX2h3X3N0YXRlKGk5MTUsIGh3X3N0YXRlKTsKIAl9IGVs
c2UgewogCQkvKiBmYWxsYmFjayBmb3IgcGxhdGZvcm1zIHRoYXQgZG9uJ3QgdXNlIHRoZSBzaGFy
ZWQgZHBsbAogCQkgKiBpbmZyYXN0cnVjdHVyZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZHBsbF9tZ3IuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwbGxf
bWdyLmgKaW5kZXggZDA1NzA0MTRmM2QxLi5iMDY4Yzg0NDEzMjggMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2RwbGxfbWdyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfZHBsbF9tZ3IuaApAQCAtMjIxLDcgKzIyMSw3IEBAIHN0cnVjdCBpbnRlbF9zaGFy
ZWRfZHBsbF9mdW5jcyB7CiAJICogQ2FsbGVkIGZyb20gaW50ZWxfcHJlcGFyZV9zaGFyZWRfZHBs
bCgpIGZ1bmN0aW9uIHVubGVzcyB0aGUgUExMCiAJICogaXMgYWxyZWFkeSBlbmFibGVkLgogCSAq
LwotCXZvaWQgKCpwcmVwYXJlKShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJ
dm9pZCAoKnByZXBhcmUpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJc3RydWN0
IGludGVsX3NoYXJlZF9kcGxsICpwbGwpOwogCiAJLyoqCkBAIC0yMzAsNyArMjMwLDcgQEAgc3Ry
dWN0IGludGVsX3NoYXJlZF9kcGxsX2Z1bmNzIHsKIAkgKiBIb29rIGZvciBlbmFibGluZyB0aGUg
cGxsLCBjYWxsZWQgZnJvbSBpbnRlbF9lbmFibGVfc2hhcmVkX2RwbGwoKQogCSAqIGlmIHRoZSBw
bGwgaXMgbm90IGFscmVhZHkgZW5hYmxlZC4KIAkgKi8KLQl2b2lkICgqZW5hYmxlKShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJdm9pZCAoKmVuYWJsZSkoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAgICBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBs
bCk7CiAKIAkvKioKQEAgLTI0MCw3ICsyNDAsNyBAQCBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGxf
ZnVuY3MgewogCSAqIG9ubHkgd2hlbiBpdCBpcyBzYWZlIHRvIGRpc2FibGUgdGhlIHBsbCwgaS5l
LiwgdGhlcmUgYXJlIG5vIG1vcmUKIAkgKiB0cmFja2VkIHVzZXJzIGZvciBpdC4KIAkgKi8KLQl2
b2lkICgqZGlzYWJsZSkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCXZvaWQg
KCpkaXNhYmxlKShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCXN0cnVjdCBpbnRl
bF9zaGFyZWRfZHBsbCAqcGxsKTsKIAogCS8qKgpAQCAtMjUwLDcgKzI1MCw3IEBAIHN0cnVjdCBp
bnRlbF9zaGFyZWRfZHBsbF9mdW5jcyB7CiAJICogcmVnaXN0ZXJzLiBUaGlzIGlzIHVzZWQgZm9y
IGluaXRpYWwgaHcgc3RhdGUgcmVhZG91dCBhbmQgc3RhdGUKIAkgKiB2ZXJpZmljYXRpb24gYWZ0
ZXIgYSBtb2RlIHNldC4KIAkgKi8KLQlib29sICgqZ2V0X2h3X3N0YXRlKShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJYm9vbCAoKmdldF9od19zdGF0ZSkoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxs
LAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfZHBsbF9od19zdGF0ZSAqaHdfc3RhdGUpOwogfTsKQEAg
LTI3MSw3ICsyNzEsNyBAQCBzdHJ1Y3QgZHBsbF9pbmZvIHsKIAogCS8qKgogCSAqIEBpZDogdW5p
cXVlIGluZGVudGlmaWVyIGZvciB0aGlzIERQTEw7IHNob3VsZCBtYXRjaCB0aGUgaW5kZXggaW4g
dGhlCi0JICogZGV2X3ByaXYtPnNoYXJlZF9kcGxscyBhcnJheQorCSAqIGk5MTUtPnNoYXJlZF9k
cGxscyBhcnJheQogCSAqLwogCWVudW0gaW50ZWxfZHBsbF9pZCBpZDsKIApAQCAtMzIxLDEyICsz
MjEsMTIgQEAgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsIHsKIAogLyogc2hhcmVkIGRwbGwgZnVu
Y3Rpb25zICovCiBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKgotaW50ZWxfZ2V0X3NoYXJlZF9k
cGxsX2J5X2lkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludGVsX2dldF9z
aGFyZWRfZHBsbF9ieV9pZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBl
bnVtIGludGVsX2RwbGxfaWQgaWQpOwogZW51bSBpbnRlbF9kcGxsX2lkCi1pbnRlbF9nZXRfc2hh
cmVkX2RwbGxfaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50ZWxfZ2V0
X3NoYXJlZF9kcGxsX2lkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJIHN0cnVj
dCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsKTsKLXZvaWQgYXNzZXJ0X3NoYXJlZF9kcGxsKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgYXNzZXJ0X3NoYXJlZF9kcGxsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJc3RydWN0IGludGVsX3NoYXJlZF9kcGxs
ICpwbGwsCiAJCQlib29sIHN0YXRlKTsKICNkZWZpbmUgYXNzZXJ0X3NoYXJlZF9kcGxsX2VuYWJs
ZWQoZCwgcCkgYXNzZXJ0X3NoYXJlZF9kcGxsKGQsIHAsIHRydWUpCkBAIC0zNDIsOSArMzQyLDkg
QEAgdm9pZCBpbnRlbF9kaXNhYmxlX3NoYXJlZF9kcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKTsKIHZvaWQgaW50ZWxfc2hhcmVkX2RwbGxfc3dhcF9zdGF0ZShz
dHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogdm9pZCBpbnRlbF9zaGFyZWRfZHBsbF9p
bml0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogCi12b2lkIGludGVsX2RwbGxfZHVtcF9od19z
dGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2RwbGxf
ZHVtcF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpod19zdGF0ZSk7Ci1pbnQgY25sX2hkbWlf
cGxsX3JlZl9jbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaW50IGNu
bF9oZG1pX3BsbF9yZWZfY2xvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogZW51
bSBpbnRlbF9kcGxsX2lkIGljbF90Y19wb3J0X3RvX3BsbF9pZChlbnVtIHRjX3BvcnQgdGNfcG9y
dCk7CiBib29sIGludGVsX2RwbGxfaXNfY29tYm9waHkoZW51bSBpbnRlbF9kcGxsX2lkIGlkKTsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHJ2LmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaAppbmRleCAzZTMzNzMxN2Y3N2UuLjIzMDY1ZGRhODJk
OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHJ2LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHJ2LmgKQEAgLTk2Myw3ICs5NjMsNyBAQCBzdHJ1Y3Qg
aW50ZWxfY3J0YyB7CiAKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY29uZmlnOwogCi0JLyog
QWNjZXNzIHRvIHRoZXNlIHNob3VsZCBiZSBwcm90ZWN0ZWQgYnkgZGV2X3ByaXYtPmlycV9sb2Nr
LiAqLworCS8qIEFjY2VzcyB0byB0aGVzZSBzaG91bGQgYmUgcHJvdGVjdGVkIGJ5IGk5MTUtPmly
cV9sb2NrLiAqLwogCWJvb2wgY3B1X2ZpZm9fdW5kZXJydW5fZGlzYWJsZWQ7CiAJYm9vbCBwY2hf
Zmlmb191bmRlcnJ1bl9kaXNhYmxlZDsKIApAQCAtMTI5MywxNSArMTI5MywxNSBAQCB2bHZfcGlw
ZV90b19jaGFubmVsKGVudW0gcGlwZSBwaXBlKQogfQogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBp
bnRlbF9jcnRjICoKLWludGVsX2dldF9jcnRjX2Zvcl9waXBlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCitpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUpCiB7Ci0JcmV0dXJu
IGRldl9wcml2LT5waXBlX3RvX2NydGNfbWFwcGluZ1twaXBlXTsKKwlyZXR1cm4gaTkxNS0+cGlw
ZV90b19jcnRjX21hcHBpbmdbcGlwZV07CiB9CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGludGVs
X2NydGMgKgotaW50ZWxfZ2V0X2NydGNfZm9yX3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgZW51bSBpOXh4X3BsYW5lX2lkIHBsYW5lKQoraW50ZWxfZ2V0X2NydGNfZm9y
X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIGk5eHhfcGxhbmVfaWQg
cGxhbmUpCiB7Ci0JcmV0dXJuIGRldl9wcml2LT5wbGFuZV90b19jcnRjX21hcHBpbmdbcGxhbmVd
OworCXJldHVybiBpOTE1LT5wbGFuZV90b19jcnRjX21hcHBpbmdbcGxhbmVdOwogfQogCiBzdHJ1
Y3QgaW50ZWxfbG9hZF9kZXRlY3RfcGlwZSB7CkBAIC0xNDQ3LDE3ICsxNDQ3LDE3IEBAIGludGVs
X2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUsCiAKIC8qIGludGVsX2Rpc3BsYXkuYyAqLwogdm9pZCBpbnRlbF9wbGFuZV9kZXN0cm95KHN0
cnVjdCBkcm1fcGxhbmUgKnBsYW5lKTsKLXZvaWQgaTgzMF9lbmFibGVfcGlwZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKTsKLXZvaWQgaTgzMF9kaXNh
YmxlX3BpcGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlw
ZSk7Cit2b2lkIGk4MzBfZW5hYmxlX3BpcGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IGVudW0gcGlwZSBwaXBlKTsKK3ZvaWQgaTgzMF9kaXNhYmxlX3BpcGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIGVudW0gcGlwZSBwaXBlKTsKIGVudW0gcGlwZSBpbnRlbF9jcnRjX3Bj
aF90cmFuc2NvZGVyKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKTsKLWludCB2bHZfZ2V0X2hwbGxf
dmNvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1pbnQgdmx2X2dldF9jY2tf
Y2xvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50IHZsdl9nZXRfaHBs
bF92Y28oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworaW50IHZsdl9nZXRfY2NrX2Ns
b2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgICBjb25zdCBjaGFyICpu
YW1lLCB1MzIgcmVnLCBpbnQgcmVmX2ZyZXEpOwotaW50IHZsdl9nZXRfY2NrX2Nsb2NrX2hwbGwo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50IHZsdl9nZXRfY2NrX2Nsb2Nr
X2hwbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBjb25zdCBjaGFyICpu
YW1lLCB1MzIgcmVnKTsKLXZvaWQgbHB0X2Rpc2FibGVfcGNoX3RyYW5zY29kZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgbHB0X2Rpc2FibGVfaWNsa2lwKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX2luaXRfZGlzcGxheV9o
b29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBscHRfZGlzYWJs
ZV9wY2hfdHJhbnNjb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGxw
dF9kaXNhYmxlX2ljbGtpcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGlu
dGVsX2luaXRfZGlzcGxheV9ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB1
bnNpZ25lZCBpbnQgaW50ZWxfZmJfeHlfdG9fbGluZWFyKGludCB4LCBpbnQgeSwKIAkJCQkgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnN0YXRlLAogCQkJCSAgIGludCBwbGFuZSk7
CkBAIC0xNDY3LDE5ICsxNDY3LDE5IEBAIHZvaWQgaW50ZWxfYWRkX2ZiX29mZnNldHMoaW50ICp4
LCBpbnQgKnksCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsIGlu
dCBwbGFuZSk7CiB1bnNpZ25lZCBpbnQgaW50ZWxfcm90YXRpb25faW5mb19zaXplKGNvbnN0IHN0
cnVjdCBpbnRlbF9yb3RhdGlvbl9pbmZvICpyb3RfaW5mbyk7CiB1bnNpZ25lZCBpbnQgaW50ZWxf
cmVtYXBwZWRfaW5mb19zaXplKGNvbnN0IHN0cnVjdCBpbnRlbF9yZW1hcHBlZF9pbmZvICpyZW1f
aW5mbyk7Ci1ib29sIGludGVsX2hhc19wZW5kaW5nX2ZiX3VucGluKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7Citib29sIGludGVsX2hhc19wZW5kaW5nX2ZiX3VucGluKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIGludCBpbnRlbF9kaXNwbGF5X3N1c3BlbmQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldik7Ci12b2lkIGludGVsX3Bwc191bmxvY2tfcmVnc193YShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9wcHNfdW5sb2NrX3Jl
Z3Nfd2Eoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBpbnRlbF9lbmNvZGVy
X2Rlc3Ryb3koc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyKTsKIHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICoKIGludGVsX2VuY29kZXJfY3VycmVudF9tb2RlKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyKTsKLWJvb2wgaW50ZWxfcG9ydF9pc19jb21ib3BoeShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KTsKLWJvb2wgaW50ZWxfcG9ydF9pc190
YyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KTsKLWVu
dW0gdGNfcG9ydCBpbnRlbF9wb3J0X3RvX3RjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK2Jvb2wgaW50ZWxfcG9ydF9pc19jb21ib3BoeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgZW51bSBwb3J0IHBvcnQpOworYm9vbCBpbnRlbF9wb3J0X2lzX3RjKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9ydCk7CitlbnVtIHRjX3BvcnQgaW50
ZWxfcG9ydF90b190YyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIGVu
dW0gcG9ydCBwb3J0KTsKIGludCBpbnRlbF9nZXRfcGlwZV9mcm9tX2NydGNfaWRfaW9jdGwoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJCQkgICAgICBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGVfcHJpdik7Ci1lbnVtIHRyYW5zY29kZXIgaW50ZWxfcGlwZV90b19jcHVfdHJhbnNj
b2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitlbnVtIHRyYW5zY29kZXIg
aW50ZWxfcGlwZV90b19jcHVfdHJhbnNjb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkJICAgICBlbnVtIHBpcGUgcGlwZSk7CiBzdGF0aWMgaW5saW5lIGJvb2wKIGludGVs
X2NydGNfaGFzX3R5cGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CkBAIC0xNDk2LDIzICsxNDk2LDIzIEBAIGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCSAoMSA8PCBJTlRFTF9PVVRQ
VVRfRURQKSk7CiB9CiBzdGF0aWMgaW5saW5lIHZvaWQKLWludGVsX3dhaXRfZm9yX3ZibGFuayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQoraW50ZWxf
d2FpdF9mb3JfdmJsYW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBpcGUg
cGlwZSkKIHsKLQlkcm1fd2FpdF9vbmVfdmJsYW5rKCZkZXZfcHJpdi0+ZHJtLCBwaXBlKTsKKwlk
cm1fd2FpdF9vbmVfdmJsYW5rKCZpOTE1LT5kcm0sIHBpcGUpOwogfQogc3RhdGljIGlubGluZSB2
b2lkCi1pbnRlbF93YWl0X2Zvcl92YmxhbmtfaWZfYWN0aXZlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgaW50IHBpcGUpCitpbnRlbF93YWl0X2Zvcl92YmxhbmtfaWZfYWN0aXZl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgcGlwZSkKIHsKLQljb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBw
aXBlKTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGludGVsX2dldF9jcnRjX2Zv
cl9waXBlKGk5MTUsIHBpcGUpOwogCiAJaWYgKGNydGMtPmFjdGl2ZSkKLQkJaW50ZWxfd2FpdF9m
b3JfdmJsYW5rKGRldl9wcml2LCBwaXBlKTsKKwkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGk5MTUs
IHBpcGUpOwogfQogCiB1MzIgaW50ZWxfY3J0Y19nZXRfdmJsYW5rX2NvdW50ZXIoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMpOwogCiBpbnQgaXJvbmxha2VfZ2V0X2xhbmVzX3JlcXVpcmVkKGludCB0
YXJnZXRfY2xvY2ssIGludCBsaW5rX2J3LCBpbnQgYnBwKTsKLXZvaWQgdmx2X3dhaXRfcG9ydF9y
ZWFkeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIHZsdl93YWl0X3Bv
cnRfcmVhZHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqZHBvcnQsCiAJCQkgdW5zaWduZWQgaW50IGV4cGVjdGVkX21hc2spOwog
aW50IGludGVsX2dldF9sb2FkX2RldGVjdF9waXBlKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3IsCkBAIC0xNTM2LDM0ICsxNTM2LDM0IEBAIGludCBpbnRlbF9wcmVwYXJlX3BsYW5lX2Zi
KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogdm9pZCBpbnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0
cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQkJICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9s
ZF9zdGF0ZSk7CiAKLXZvaWQgYXNzZXJ0X3BjaF90cmFuc2NvZGVyX2Rpc2FibGVkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgYXNzZXJ0X3BjaF90cmFuc2NvZGVyX2Rp
c2FibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICBlbnVtIHBpcGUg
cGlwZSk7CiAKLWludCB2bHZfZm9yY2VfcGxsX29uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUsCitpbnQgdmx2X2ZvcmNlX3BsbF9vbihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUsCiAJCSAgICAgY29uc3Qgc3RydWN0
IGRwbGwgKmRwbGwpOwotdm9pZCB2bHZfZm9yY2VfcGxsX29mZihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKTsKLWludCBscHRfZ2V0X2ljbGtpcChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCB2bHZfZm9yY2VfcGxsX29mZihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUpOworaW50IGxwdF9n
ZXRfaWNsa2lwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIGJvb2wgaW50ZWxfZnV6
enlfY2xvY2tfY2hlY2soaW50IGNsb2NrMSwgaW50IGNsb2NrMik7CiAKIC8qIG1vZGVzZXR0aW5n
IGFzc2VydHMgKi8KLXZvaWQgYXNzZXJ0X3BhbmVsX3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgYXNzZXJ0X3BhbmVsX3VubG9ja2VkKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgZW51bSBwaXBlIHBpcGUpOwotdm9pZCBhc3NlcnRf
cGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgYXNzZXJ0X3BsbChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZW51bSBwaXBlIHBpcGUsIGJvb2wgc3Rh
dGUpOwogI2RlZmluZSBhc3NlcnRfcGxsX2VuYWJsZWQoZCwgcCkgYXNzZXJ0X3BsbChkLCBwLCB0
cnVlKQogI2RlZmluZSBhc3NlcnRfcGxsX2Rpc2FibGVkKGQsIHApIGFzc2VydF9wbGwoZCwgcCwg
ZmFsc2UpCi12b2lkIGFzc2VydF9kc2lfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgYm9vbCBzdGF0ZSk7Cit2b2lkIGFzc2VydF9kc2lfcGxsKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LCBib29sIHN0YXRlKTsKICNkZWZpbmUgYXNzZXJ0X2RzaV9wbGxfZW5hYmxl
ZChkKSBhc3NlcnRfZHNpX3BsbChkLCB0cnVlKQogI2RlZmluZSBhc3NlcnRfZHNpX3BsbF9kaXNh
YmxlZChkKSBhc3NlcnRfZHNpX3BsbChkLCBmYWxzZSkKLXZvaWQgYXNzZXJ0X2ZkaV9yeF9wbGwo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBhc3NlcnRfZmRpX3J4X3Bs
bChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgICAgIGVudW0gcGlwZSBwaXBl
LCBib29sIHN0YXRlKTsKICNkZWZpbmUgYXNzZXJ0X2ZkaV9yeF9wbGxfZW5hYmxlZChkLCBwKSBh
c3NlcnRfZmRpX3J4X3BsbChkLCBwLCB0cnVlKQogI2RlZmluZSBhc3NlcnRfZmRpX3J4X3BsbF9k
aXNhYmxlZChkLCBwKSBhc3NlcnRfZmRpX3J4X3BsbChkLCBwLCBmYWxzZSkKLXZvaWQgYXNzZXJ0
X3BpcGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSwg
Ym9vbCBzdGF0ZSk7Cit2b2lkIGFzc2VydF9waXBlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCBlbnVtIHBpcGUgcGlwZSwgYm9vbCBzdGF0ZSk7CiAjZGVmaW5lIGFzc2VydF9waXBlX2Vu
YWJsZWQoZCwgcCkgYXNzZXJ0X3BpcGUoZCwgcCwgdHJ1ZSkKICNkZWZpbmUgYXNzZXJ0X3BpcGVf
ZGlzYWJsZWQoZCwgcCkgYXNzZXJ0X3BpcGUoZCwgcCwgZmFsc2UpCi12b2lkIGludGVsX3ByZXBh
cmVfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxf
ZmluaXNoX3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGlu
dGVsX3ByZXBhcmVfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBp
bnRlbF9maW5pc2hfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBp
bnRlbF9kcF9nZXRfbV9uKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkgICAgICBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpOwogdm9pZCBpbnRlbF9kcF9zZXRfbV9uKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9kc2kuYwppbmRleCA1ZmVjMDJhY2VhZWQuLjA5NDE0ZGEzZDgxOCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZHNpLmMKQEAgLTExMywxNCArMTEzLDE0IEBAIHN0cnVjdCBpbnRlbF9kc2lfaG9zdCAq
aW50ZWxfZHNpX2hvc3RfaW5pdChzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2ksCiBlbnVtIGRy
bV9wYW5lbF9vcmllbnRhdGlvbgogaW50ZWxfZHNpX2dldF9wYW5lbF9vcmllbnRhdGlvbihzdHJ1
Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJZW51
bSBkcm1fcGFuZWxfb3JpZW50YXRpb24gb3JpZW50YXRpb247CiAKLQlvcmllbnRhdGlvbiA9IGRl
dl9wcml2LT52YnQuZHNpLm9yaWVudGF0aW9uOworCW9yaWVudGF0aW9uID0gaTkxNS0+dmJ0LmRz
aS5vcmllbnRhdGlvbjsKIAlpZiAob3JpZW50YXRpb24gIT0gRFJNX01PREVfUEFORUxfT1JJRU5U
QVRJT05fVU5LTk9XTikKIAkJcmV0dXJuIG9yaWVudGF0aW9uOwogCi0Jb3JpZW50YXRpb24gPSBk
ZXZfcHJpdi0+dmJ0Lm9yaWVudGF0aW9uOworCW9yaWVudGF0aW9uID0gaTkxNS0+dmJ0Lm9yaWVu
dGF0aW9uOwogCWlmIChvcmllbnRhdGlvbiAhPSBEUk1fTU9ERV9QQU5FTF9PUklFTlRBVElPTl9V
TktOT1dOKQogCQlyZXR1cm4gb3JpZW50YXRpb247CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2RzaS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHNpLmgK
aW5kZXggNmQyMDQzNDYzNmNkLi4yZjQ3NzI2M2QxZjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2RzaS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rz
aS5oCkBAIC0xNTUsNyArMTU1LDcgQEAgc3RhdGljIGlubGluZSB1MTYgaW50ZWxfZHNpX2VuY29k
ZXJfcG9ydHMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB9CiAKIC8qIGljbF9kc2ku
YyAqLwotdm9pZCBpY2xfZHNpX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KTsKK3ZvaWQgaWNsX2RzaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAog
LyogaW50ZWxfZHNpLmMgKi8KIGludCBpbnRlbF9kc2lfYml0cmF0ZShjb25zdCBzdHJ1Y3QgaW50
ZWxfZHNpICppbnRlbF9kc2kpOwpAQCAtMTcyLDcgKzE3Miw3IEBAIGVudW0gZHJtX21vZGVfc3Rh
dHVzIGludGVsX2RzaV9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Is
CiBzdHJ1Y3QgaW50ZWxfZHNpX2hvc3QgKmludGVsX2RzaV9ob3N0X2luaXQoc3RydWN0IGludGVs
X2RzaSAqaW50ZWxfZHNpLAogCQkJCQkgICBjb25zdCBzdHJ1Y3QgbWlwaV9kc2lfaG9zdF9vcHMg
KmZ1bmNzLAogCQkJCQkgICBlbnVtIHBvcnQgcG9ydCk7Ci12b2lkIHZsdl9kc2lfaW5pdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCB2bHZfZHNpX2luaXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiAvKiB2bHZfZHNpX3BsbC5jICovCiBpbnQgdmx2
X2RzaV9wbGxfY29tcHV0ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKQEAgLTE4NCw3
ICsxODQsNyBAQCB1MzIgdmx2X2RzaV9nZXRfcGNsayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY29uZmlnKTsKIHZvaWQgdmx2
X2RzaV9yZXNldF9jbG9ja3Moc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGVudW0gcG9y
dCBwb3J0KTsKIAotYm9vbCBieHRfZHNpX3BsbF9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7Citib29sIGJ4dF9kc2lfcGxsX2lzX2VuYWJsZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogaW50IGJ4dF9kc2lfcGxsX2NvbXB1dGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY29uZmln
KTsKIHZvaWQgYnh0X2RzaV9wbGxfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHNpX2Rjc19iYWNrbGln
aHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RzaV9kY3NfYmFja2xpZ2h0LmMKaW5k
ZXggOGMzMzI2MmNiMGIyLi5lNWRkNDk2MjcwNWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2RzaV9kY3NfYmFja2xpZ2h0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfZHNpX2Rjc19iYWNrbGlnaHQuYwpAQCAtMTU5LDExICsxNTksMTEgQEAgc3RhdGlj
IGludCBkY3Nfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rv
ciwKIGludCBpbnRlbF9kc2lfZGNzX2luaXRfYmFja2xpZ2h0X2Z1bmNzKHN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
aW50ZWxfY29ubmVjdG9yLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSBpbnRlbF9jb25u
ZWN0b3ItPmVuY29kZXI7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZpbnRlbF9jb25u
ZWN0b3ItPnBhbmVsOwogCi0JaWYgKGRldl9wcml2LT52YnQuYmFja2xpZ2h0LnR5cGUgIT0gSU5U
RUxfQkFDS0xJR0hUX0RTSV9EQ1MpCisJaWYgKGk5MTUtPnZidC5iYWNrbGlnaHQudHlwZSAhPSBJ
TlRFTF9CQUNLTElHSFRfRFNJX0RDUykKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlpZiAoV0FSTl9P
TihlbmNvZGVyLT50eXBlICE9IElOVEVMX09VVFBVVF9EU0kpKQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZHNpX3ZidC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfZHNpX3ZidC5jCmluZGV4IGU1YjE3ODY2MDQwOC4uZDQ0ZWJkZmQ4NzYwIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kc2lfdmJ0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZHNpX3ZidC5jCkBAIC0xMjEsNyArMTIxLDcgQEAgc3RhdGljIGlubGlu
ZSBlbnVtIHBvcnQgaW50ZWxfZHNpX3NlcV9wb3J0X3RvX3BvcnQodTggcG9ydCkKIHN0YXRpYyBj
b25zdCB1OCAqbWlwaV9leGVjX3NlbmRfcGFja2V0KHN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2Rz
aSwKIAkJCQkgICAgICAgY29uc3QgdTggKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9kc2ktPmJhc2UuYmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShpbnRlbF9kc2ktPmJhc2UuYmFzZS5k
ZXYpOwogCXN0cnVjdCBtaXBpX2RzaV9kZXZpY2UgKmRzaV9kZXZpY2U7CiAJdTggdHlwZSwgZmxh
Z3MsIHNlcV9wb3J0OwogCXUxNiBsZW47CkBAIC0xOTIsNyArMTkyLDcgQEAgc3RhdGljIGNvbnN0
IHU4ICptaXBpX2V4ZWNfc2VuZF9wYWNrZXQoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpLAog
CQlicmVhazsKIAl9CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQorCWlmIChJTlRF
TF9HRU4oaTkxNSkgPCAxMSkKIAkJdmx2X2RzaV93YWl0X2Zvcl9maWZvX2VtcHR5KGludGVsX2Rz
aSwgcG9ydCk7CiAKIG91dDoKQEAgLTIxMyw3ICsyMTMsNyBAQCBzdGF0aWMgY29uc3QgdTggKm1p
cGlfZXhlY19kZWxheShzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2ksIGNvbnN0IHU4ICpkYXRh
KQogCXJldHVybiBkYXRhOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfZXhlY19ncGlvKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHZsdl9leGVjX2dwaW8oc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHU4IGdwaW9fc291cmNlLCB1OCBncGlv
X2luZGV4LCBib29sIHZhbHVlKQogewogCXN0cnVjdCBncGlvX21hcCAqbWFwOwpAQCAtMjI4LDcg
KzIyOCw3IEBAIHN0YXRpYyB2b2lkIHZsdl9leGVjX2dwaW8oc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCiAJbWFwID0gJnZsdl9ncGlvX3RhYmxlW2dwaW9faW5kZXhdOwogCi0J
aWYgKGRldl9wcml2LT52YnQuZHNpLnNlcV92ZXJzaW9uID49IDMpIHsKKwlpZiAoaTkxNS0+dmJ0
LmRzaS5zZXFfdmVyc2lvbiA+PSAzKSB7CiAJCS8qIFhYWDogdGhpcyBhc3N1bWVzIHZsdl9ncGlv
X3RhYmxlIG9ubHkgaGFzIE5DIEdQSU9zLiAqLwogCQlwb3J0ID0gSU9TRl9QT1JUX0dQSU9fTkM7
CiAJfSBlbHNlIHsKQEAgLTI0NiwyNiArMjQ2LDI2IEBAIHN0YXRpYyB2b2lkIHZsdl9leGVjX2dw
aW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXBjb25mMCA9IFZMVl9HUElP
X1BDT05GMChtYXAtPmJhc2Vfb2Zmc2V0KTsKIAlwYWR2YWwgPSBWTFZfR1BJT19QQURfVkFMKG1h
cC0+YmFzZV9vZmZzZXQpOwogCi0Jdmx2X2lvc2Zfc2JfZ2V0KGRldl9wcml2LCBCSVQoVkxWX0lP
U0ZfU0JfR1BJTykpOworCXZsdl9pb3NmX3NiX2dldChpOTE1LCBCSVQoVkxWX0lPU0ZfU0JfR1BJ
TykpOwogCWlmICghbWFwLT5pbml0KSB7CiAJCS8qIEZJWE1FOiByZW1vdmUgY29uc3RhbnQgYmVs
b3cgKi8KLQkJdmx2X2lvc2Zfc2Jfd3JpdGUoZGV2X3ByaXYsIHBvcnQsIHBjb25mMCwgMHgyMDAw
Q0MwMCk7CisJCXZsdl9pb3NmX3NiX3dyaXRlKGk5MTUsIHBvcnQsIHBjb25mMCwgMHgyMDAwQ0Mw
MCk7CiAJCW1hcC0+aW5pdCA9IHRydWU7CiAJfQogCiAJdG1wID0gMHg0IHwgdmFsdWU7Ci0Jdmx2
X2lvc2Zfc2Jfd3JpdGUoZGV2X3ByaXYsIHBvcnQsIHBhZHZhbCwgdG1wKTsKLQl2bHZfaW9zZl9z
Yl9wdXQoZGV2X3ByaXYsIEJJVChWTFZfSU9TRl9TQl9HUElPKSk7CisJdmx2X2lvc2Zfc2Jfd3Jp
dGUoaTkxNSwgcG9ydCwgcGFkdmFsLCB0bXApOworCXZsdl9pb3NmX3NiX3B1dChpOTE1LCBCSVQo
VkxWX0lPU0ZfU0JfR1BJTykpOwogfQogCi1zdGF0aWMgdm9pZCBjaHZfZXhlY19ncGlvKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGNodl9leGVjX2dwaW8o
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHU4IGdwaW9fc291cmNlLCB1OCBn
cGlvX2luZGV4LCBib29sIHZhbHVlKQogewogCXUxNiBjZmcwLCBjZmcxOwogCXUxNiBmYW1pbHlf
bnVtOwogCXU4IHBvcnQ7CiAKLQlpZiAoZGV2X3ByaXYtPnZidC5kc2kuc2VxX3ZlcnNpb24gPj0g
MykgeworCWlmIChpOTE1LT52YnQuZHNpLnNlcV92ZXJzaW9uID49IDMpIHsKIAkJaWYgKGdwaW9f
aW5kZXggPj0gQ0hWX0dQSU9fSURYX1NUQVJUX1NFKSB7CiAJCQkvKiBYWFg6IGl0J3MgdW5jbGVh
ciB3aGV0aGVyIDI1NS0+NTcgaXMgcGFydCBvZiBTRS4gKi8KIAkJCWdwaW9faW5kZXggLT0gQ0hW
X0dQSU9fSURYX1NUQVJUX1NFOwpAQCAtMzAxLDE1ICszMDEsMTUgQEAgc3RhdGljIHZvaWQgY2h2
X2V4ZWNfZ3BpbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJY2ZnMCA9IENI
Vl9HUElPX1BBRF9DRkcwKGZhbWlseV9udW0sIGdwaW9faW5kZXgpOwogCWNmZzEgPSBDSFZfR1BJ
T19QQURfQ0ZHMShmYW1pbHlfbnVtLCBncGlvX2luZGV4KTsKIAotCXZsdl9pb3NmX3NiX2dldChk
ZXZfcHJpdiwgQklUKFZMVl9JT1NGX1NCX0dQSU8pKTsKLQl2bHZfaW9zZl9zYl93cml0ZShkZXZf
cHJpdiwgcG9ydCwgY2ZnMSwgMCk7Ci0Jdmx2X2lvc2Zfc2Jfd3JpdGUoZGV2X3ByaXYsIHBvcnQs
IGNmZzAsCisJdmx2X2lvc2Zfc2JfZ2V0KGk5MTUsIEJJVChWTFZfSU9TRl9TQl9HUElPKSk7CisJ
dmx2X2lvc2Zfc2Jfd3JpdGUoaTkxNSwgcG9ydCwgY2ZnMSwgMCk7CisJdmx2X2lvc2Zfc2Jfd3Jp
dGUoaTkxNSwgcG9ydCwgY2ZnMCwKIAkJCSAgQ0hWX0dQSU9fR1BJT0VOIHwgQ0hWX0dQSU9fR1BJ
T0NGR19HUE8gfAogCQkJICBDSFZfR1BJT19HUElPVFhTVEFURSh2YWx1ZSkpOwotCXZsdl9pb3Nm
X3NiX3B1dChkZXZfcHJpdiwgQklUKFZMVl9JT1NGX1NCX0dQSU8pKTsKKwl2bHZfaW9zZl9zYl9w
dXQoaTkxNSwgQklUKFZMVl9JT1NGX1NCX0dQSU8pKTsKIH0KIAotc3RhdGljIHZvaWQgYnh0X2V4
ZWNfZ3BpbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBi
eHRfZXhlY19ncGlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICB1OCBncGlv
X3NvdXJjZSwgdTggZ3Bpb19pbmRleCwgYm9vbCB2YWx1ZSkKIHsKIAkvKiBYWFg6IHRoaXMgdGFi
bGUgaXMgYSBxdWljayB1Z2x5IGhhY2suICovCkBAIC0zMTcsNyArMzE3LDcgQEAgc3RhdGljIHZv
aWQgYnh0X2V4ZWNfZ3BpbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJc3Ry
dWN0IGdwaW9fZGVzYyAqZ3Bpb19kZXNjID0gYnh0X2dwaW9fdGFibGVbZ3Bpb19pbmRleF07CiAK
IAlpZiAoIWdwaW9fZGVzYykgewotCQlncGlvX2Rlc2MgPSBkZXZtX2dwaW9kX2dldF9pbmRleChk
ZXZfcHJpdi0+ZHJtLmRldiwKKwkJZ3Bpb19kZXNjID0gZGV2bV9ncGlvZF9nZXRfaW5kZXgoaTkx
NS0+ZHJtLmRldiwKIAkJCQkJCSBOVUxMLCBncGlvX2luZGV4LAogCQkJCQkJIHZhbHVlID8gR1BJ
T0RfT1VUX0xPVyA6CiAJCQkJCQkgR1BJT0RfT1VUX0hJR0gpOwpAQCAtMzM0LDcgKzMzNCw3IEBA
IHN0YXRpYyB2b2lkIGJ4dF9leGVjX2dwaW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCWdwaW9kX3NldF92YWx1ZShncGlvX2Rlc2MsIHZhbHVlKTsKIH0KIAotc3RhdGljIHZv
aWQgaWNsX2V4ZWNfZ3BpbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdm9pZCBpY2xfZXhlY19ncGlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
ICB1OCBncGlvX3NvdXJjZSwgdTggZ3Bpb19pbmRleCwgYm9vbCB2YWx1ZSkKIHsKIAlEUk1fREVC
VUdfS01TKCJTa2lwcGluZyBJQ0wgR1BJTyBlbGVtZW50IGV4ZWN1dGlvblxuIik7CkBAIC0zNDMs
MTkgKzM0MywxOSBAQCBzdGF0aWMgdm9pZCBpY2xfZXhlY19ncGlvKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIHN0YXRpYyBjb25zdCB1OCAqbWlwaV9leGVjX2dwaW8oc3RydWN0
IGludGVsX2RzaSAqaW50ZWxfZHNpLCBjb25zdCB1OCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gaW50ZWxfZHNpLT5iYXNlLmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAl1OCBncGlvX3NvdXJjZSwgZ3Bpb19pbmRleCA9IDAs
IGdwaW9fbnVtYmVyOwogCWJvb2wgdmFsdWU7CiAKIAlEUk1fREVCVUdfS01TKCJcbiIpOwogCi0J
aWYgKGRldl9wcml2LT52YnQuZHNpLnNlcV92ZXJzaW9uID49IDMpCisJaWYgKGk5MTUtPnZidC5k
c2kuc2VxX3ZlcnNpb24gPj0gMykKIAkJZ3Bpb19pbmRleCA9ICpkYXRhKys7CiAKIAlncGlvX251
bWJlciA9ICpkYXRhKys7CiAKIAkvKiBncGlvIHNvdXJjZSBpbiBzZXF1ZW5jZSB2MiBvbmx5ICov
Ci0JaWYgKGRldl9wcml2LT52YnQuZHNpLnNlcV92ZXJzaW9uID09IDIpCisJaWYgKGk5MTUtPnZi
dC5kc2kuc2VxX3ZlcnNpb24gPT0gMikKIAkJZ3Bpb19zb3VyY2UgPSAoKmRhdGEgPj4gMSkgJiAz
OwogCWVsc2UKIAkJZ3Bpb19zb3VyY2UgPSAwOwpAQCAtMzYzLDE0ICszNjMsMTQgQEAgc3RhdGlj
IGNvbnN0IHU4ICptaXBpX2V4ZWNfZ3BpbyhzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2ksIGNv
bnN0IHU4ICpkYXRhKQogCS8qIHB1bGwgdXAvZG93biAqLwogCXZhbHVlID0gKmRhdGErKyAmIDE7
CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKLQkJaWNsX2V4ZWNfZ3BpbyhkZXZf
cHJpdiwgZ3Bpb19zb3VyY2UsIGdwaW9faW5kZXgsIHZhbHVlKTsKLQllbHNlIGlmIChJU19WQUxM
RVlWSUVXKGRldl9wcml2KSkKLQkJdmx2X2V4ZWNfZ3BpbyhkZXZfcHJpdiwgZ3Bpb19zb3VyY2Us
IGdwaW9fbnVtYmVyLCB2YWx1ZSk7Ci0JZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikp
Ci0JCWNodl9leGVjX2dwaW8oZGV2X3ByaXYsIGdwaW9fc291cmNlLCBncGlvX251bWJlciwgdmFs
dWUpOworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCisJCWljbF9leGVjX2dwaW8oaTkxNSwg
Z3Bpb19zb3VyY2UsIGdwaW9faW5kZXgsIHZhbHVlKTsKKwllbHNlIGlmIChJU19WQUxMRVlWSUVX
KGk5MTUpKQorCQl2bHZfZXhlY19ncGlvKGk5MTUsIGdwaW9fc291cmNlLCBncGlvX251bWJlciwg
dmFsdWUpOworCWVsc2UgaWYgKElTX0NIRVJSWVZJRVcoaTkxNSkpCisJCWNodl9leGVjX2dwaW8o
aTkxNSwgZ3Bpb19zb3VyY2UsIGdwaW9fbnVtYmVyLCB2YWx1ZSk7CiAJZWxzZQotCQlieHRfZXhl
Y19ncGlvKGRldl9wcml2LCBncGlvX3NvdXJjZSwgZ3Bpb19pbmRleCwgdmFsdWUpOworCQlieHRf
ZXhlY19ncGlvKGk5MTUsIGdwaW9fc291cmNlLCBncGlvX2luZGV4LCB2YWx1ZSk7CiAKIAlyZXR1
cm4gZGF0YTsKIH0KQEAgLTQ1NiwxNCArNDU2LDE0IEBAIHN0YXRpYyBjb25zdCBjaGFyICpzZXF1
ZW5jZV9uYW1lKGVudW0gbWlwaV9zZXEgc2VxX2lkKQogdm9pZCBpbnRlbF9kc2lfdmJ0X2V4ZWNf
c2VxdWVuY2Uoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpLAogCQkJCSBlbnVtIG1pcGlfc2Vx
IHNlcV9pZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGludGVsX2RzaS0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGludGVsX2RzaS0+YmFzZS5iYXNlLmRldik7CiAJY29uc3QgdTggKmRhdGE7
CiAJZm5fbWlwaV9lbGVtX2V4ZWMgbWlwaV9lbGVtX2V4ZWM7CiAKLQlpZiAoV0FSTl9PTihzZXFf
aWQgPj0gQVJSQVlfU0laRShkZXZfcHJpdi0+dmJ0LmRzaS5zZXF1ZW5jZSkpKQorCWlmIChXQVJO
X09OKHNlcV9pZCA+PSBBUlJBWV9TSVpFKGk5MTUtPnZidC5kc2kuc2VxdWVuY2UpKSkKIAkJcmV0
dXJuOwogCi0JZGF0YSA9IGRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNlW3NlcV9pZF07CisJZGF0
YSA9IGk5MTUtPnZidC5kc2kuc2VxdWVuY2Vbc2VxX2lkXTsKIAlpZiAoIWRhdGEpCiAJCXJldHVy
bjsKIApAQCAtNDc2LDcgKzQ3Niw3IEBAIHZvaWQgaW50ZWxfZHNpX3ZidF9leGVjX3NlcXVlbmNl
KHN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSwKIAlkYXRhKys7CiAKIAkvKiBTa2lwIFNpemUg
b2YgU2VxdWVuY2UuICovCi0JaWYgKGRldl9wcml2LT52YnQuZHNpLnNlcV92ZXJzaW9uID49IDMp
CisJaWYgKGk5MTUtPnZidC5kc2kuc2VxX3ZlcnNpb24gPj0gMykKIAkJZGF0YSArPSA0OwogCiAJ
d2hpbGUgKDEpIHsKQEAgLTQ5Miw3ICs0OTIsNyBAQCB2b2lkIGludGVsX2RzaV92YnRfZXhlY19z
ZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2ksCiAJCQltaXBpX2VsZW1fZXhlYyA9
IE5VTEw7CiAKIAkJLyogU2l6ZSBvZiBPcGVyYXRpb24uICovCi0JCWlmIChkZXZfcHJpdi0+dmJ0
LmRzaS5zZXFfdmVyc2lvbiA+PSAzKQorCQlpZiAoaTkxNS0+dmJ0LmRzaS5zZXFfdmVyc2lvbiA+
PSAzKQogCQkJb3BlcmF0aW9uX3NpemUgPSAqZGF0YSsrOwogCiAJCWlmIChtaXBpX2VsZW1fZXhl
YykgewpAQCAtNTIxLDEwICs1MjEsMTAgQEAgdm9pZCBpbnRlbF9kc2lfdmJ0X2V4ZWNfc2VxdWVu
Y2Uoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpLAogCiB2b2lkIGludGVsX2RzaV9tc2xlZXAo
c3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpLCBpbnQgbXNlYykKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2RzaS0+YmFzZS5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGludGVsX2RzaS0+YmFz
ZS5iYXNlLmRldik7CiAKIAkvKiBGb3IgdjMgVkJUcyBpbiB2aWQtbW9kZSB0aGUgZGVsYXlzIGFy
ZSBwYXJ0IG9mIHRoZSBWQlQgc2VxdWVuY2VzICovCi0JaWYgKGlzX3ZpZF9tb2RlKGludGVsX2Rz
aSkgJiYgZGV2X3ByaXYtPnZidC5kc2kuc2VxX3ZlcnNpb24gPj0gMykKKwlpZiAoaXNfdmlkX21v
ZGUoaW50ZWxfZHNpKSAmJiBpOTE1LT52YnQuZHNpLnNlcV92ZXJzaW9uID49IDMpCiAJCXJldHVy
bjsKIAogCW1zbGVlcChtc2VjKTsKQEAgLTU3MSwxMCArNTcxLDEwIEBAIHZvaWQgaW50ZWxfZHNp
X2xvZ19wYXJhbXMoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpKQogYm9vbCBpbnRlbF9kc2lf
dmJ0X2luaXQoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpLCB1MTYgcGFuZWxfaWQpCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGludGVsX2RzaS0+YmFzZS5iYXNlLmRldjsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IG1p
cGlfY29uZmlnICptaXBpX2NvbmZpZyA9IGRldl9wcml2LT52YnQuZHNpLmNvbmZpZzsKLQlzdHJ1
Y3QgbWlwaV9wcHNfZGF0YSAqcHBzID0gZGV2X3ByaXYtPnZidC5kc2kucHBzOwotCXN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICptb2RlID0gZGV2X3ByaXYtPnZidC5sZnBfbHZkc192YnRfbW9kZTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3Qg
bWlwaV9jb25maWcgKm1pcGlfY29uZmlnID0gaTkxNS0+dmJ0LmRzaS5jb25maWc7CisJc3RydWN0
IG1pcGlfcHBzX2RhdGEgKnBwcyA9IGk5MTUtPnZidC5kc2kucHBzOworCXN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICptb2RlID0gaTkxNS0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlOwogCXUxNiBidXJz
dF9tb2RlX3JhdGlvOwogCWVudW0gcG9ydCBwb3J0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9kdm8uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2R2by5j
CmluZGV4IDIyNjY2ZDI4ZjRhYS4uNmNlZDk1YjczNTM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9kdm8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9k
dm8uYwpAQCAtMTMzLDcgKzEzMyw3IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfZHZvICppbnRlbF9h
dHRhY2hlZF9kdm8oc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHN0YXRpYyBib29s
IGludGVsX2R2b19jb25uZWN0b3JfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY29ubmVjdG9yLT5iYXNl
LmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0
IGludGVsX2R2byAqaW50ZWxfZHZvID0gaW50ZWxfYXR0YWNoZWRfZHZvKCZjb25uZWN0b3ItPmJh
c2UpOwogCXUzMiB0bXA7CiAKQEAgLTE0OCw3ICsxNDgsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9k
dm9fY29ubmVjdG9yX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IpCiBzdGF0aWMgYm9vbCBpbnRlbF9kdm9fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJCSAgIGVudW0gcGlwZSAqcGlwZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CXN0cnVjdCBpbnRlbF9kdm8gKmludGVsX2R2byA9IGVuY190b19kdm8oZW5jb2Rlcik7CiAJdTMy
IHRtcDsKIApAQCAtMTYyLDcgKzE2Miw3IEBAIHN0YXRpYyBib29sIGludGVsX2R2b19nZXRfaHdf
c3RhdGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiBzdGF0aWMgdm9pZCBpbnRlbF9k
dm9fZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0
IGludGVsX2R2byAqaW50ZWxfZHZvID0gZW5jX3RvX2R2byhlbmNvZGVyKTsKIAl1MzIgdG1wLCBm
bGFncyA9IDA7CiAKQEAgLTE4Nyw3ICsxODcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kaXNhYmxl
X2R2byhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCSAgICAgIGNvbnN0IHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CXN0cnVjdCBpbnRlbF9kdm8gKmludGVsX2R2byA9IGVuY190b19kdm8oZW5jb2Rlcik7CiAJaTkx
NV9yZWdfdCBkdm9fcmVnID0gaW50ZWxfZHZvLT5kZXYuZHZvX3JlZzsKIAl1MzIgdGVtcCA9IEk5
MTVfUkVBRChkdm9fcmVnKTsKQEAgLTIwMSw3ICsyMDEsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9l
bmFibGVfZHZvKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgIGNvbnN0IHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGludGVsX2R2byAqaW50ZWxfZHZvID0gZW5jX3RvX2R2byhlbmNvZGVyKTsKIAlpOTE1X3Jl
Z190IGR2b19yZWcgPSBpbnRlbF9kdm8tPmRldi5kdm9fcmVnOwogCXUzMiB0ZW1wID0gSTkxNV9S
RUFEKGR2b19yZWcpOwpAQCAtMjc2LDcgKzI3Niw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2R2b19w
cmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSBjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkJIGNvbnN0IHN0cnVjdCBkcm1f
Y29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOwog
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29u
ZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CiAJc3RydWN0IGludGVsX2R2byAqaW50ZWxfZHZvID0g
ZW5jX3RvX2R2byhlbmNvZGVyKTsKQEAgLTMxOSw3ICszMTksNyBAQCBpbnRlbF9kdm9fZGV0ZWN0
KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGJvb2wgZm9yY2UpCiAKIHN0YXRpYyBp
bnQgaW50ZWxfZHZvX2dldF9tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9y
LT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0
b3ItPmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmZpeGVkX21vZGUgPQog
CQl0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKS0+cGFuZWwuZml4ZWRfbW9kZTsKIApAQCAt
MzMwLDcgKzMzMCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHZvX2dldF9tb2RlcyhzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCSAqIHRoYXQncyBub3QgdGhlIGNhc2UuCiAJICovCiAJ
aW50ZWxfZGRjX2dldF9tb2Rlcyhjb25uZWN0b3IsCi0JCQkgICAgaW50ZWxfZ21idXNfZ2V0X2Fk
YXB0ZXIoZGV2X3ByaXYsIEdNQlVTX1BJTl9EUEMpKTsKKwkJCSAgICBpbnRlbF9nbWJ1c19nZXRf
YWRhcHRlcihpOTE1LCBHTUJVU19QSU5fRFBDKSk7CiAJaWYgKCFsaXN0X2VtcHR5KCZjb25uZWN0
b3ItPnByb2JlZF9tb2RlcykpCiAJCXJldHVybiAxOwogCkBAIC00MDYsNyArNDA2LDcgQEAgc3Rh
dGljIGVudW0gcG9ydCBpbnRlbF9kdm9fcG9ydChpOTE1X3JlZ190IGR2b19yZWcpCiAJCXJldHVy
biBQT1JUX0M7CiB9CiAKLXZvaWQgaW50ZWxfZHZvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9kdm9faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlcjsKIAlzdHJ1
Y3QgaW50ZWxfZHZvICppbnRlbF9kdm87CkBAIC00NTIsNyArNDUyLDcgQEAgdm9pZCBpbnRlbF9k
dm9faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIHNwZWNpYWwg
Y2FzZXMsIGJ1dCBvdGhlcndpc2UgZGVmYXVsdCB0byB3aGF0J3MgZGVmaW5lZAogCQkgKiBpbiB0
aGUgc3BlYy4KIAkJICovCi0JCWlmIChpbnRlbF9nbWJ1c19pc192YWxpZF9waW4oZGV2X3ByaXYs
IGR2by0+Z3BpbykpCisJCWlmIChpbnRlbF9nbWJ1c19pc192YWxpZF9waW4oaTkxNSwgZHZvLT5n
cGlvKSkKIAkJCWdwaW8gPSBkdm8tPmdwaW87CiAJCWVsc2UgaWYgKGR2by0+dHlwZSA9PSBJTlRF
TF9EVk9fQ0hJUF9MVkRTKQogCQkJZ3BpbyA9IEdNQlVTX1BJTl9TU0M7CkBAIC00NjQsNyArNDY0
LDcgQEAgdm9pZCBpbnRlbF9kdm9faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJCSAqIEl0IGFwcGVhcnMgdGhhdCBldmVyeXRoaW5nIGlzIG9uIEdQSU9FIGV4Y2VwdCBm
b3IgcGFuZWxzCiAJCSAqIG9uIGk4MzAgbGFwdG9wcywgd2hpY2ggYXJlIG9uIEdQSU9CIChEVk9B
KS4KIAkJICovCi0JCWkyYyA9IGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGRldl9wcml2LCBncGlv
KTsKKwkJaTJjID0gaW50ZWxfZ21idXNfZ2V0X2FkYXB0ZXIoaTkxNSwgZ3Bpbyk7CiAKIAkJaW50
ZWxfZHZvLT5kZXYgPSAqZHZvOwogCkBAIC00ODAsNyArNDgwLDcgQEAgdm9pZCBpbnRlbF9kdm9f
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIGhhdmUgdGhlIGNs
b2NrIGVuYWJsZWQgYmVmb3JlIHdlIGF0dGVtcHQgdG8KIAkJICogaW5pdGlhbGl6ZSB0aGUgZGV2
aWNlLgogCQkgKi8KLQkJZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCQlmb3JfZWFj
aF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJCWRwbGxbcGlwZV0gPSBJOTE1X1JFQUQoRFBMTChwaXBl
KSk7CiAJCQlJOTE1X1dSSVRFKERQTEwocGlwZSksIGRwbGxbcGlwZV0gfCBEUExMX0RWT18yWF9N
T0RFKTsKIAkJfQpAQCAtNDg4LDcgKzQ4OCw3IEBAIHZvaWQgaW50ZWxfZHZvX2luaXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlkdm9pbml0ID0gZHZvLT5kZXZfb3BzLT5p
bml0KCZpbnRlbF9kdm8tPmRldiwgaTJjKTsKIAogCQkvKiByZXN0b3JlIHRoZSBEVk8gMnggY2xv
Y2sgc3RhdGUgdG8gb3JpZ2luYWwgKi8KLQkJZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkg
eworCQlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJCUk5MTVfV1JJVEUoRFBMTChwaXBl
KSwgZHBsbFtwaXBlXSk7CiAJCX0KIApAQCAtNDk4LDcgKzQ5OCw3IEBAIHZvaWQgaW50ZWxfZHZv
X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJY29udGludWU7CiAK
IAkJcG9ydCA9IGludGVsX2R2b19wb3J0KGR2by0+ZHZvX3JlZyk7Ci0JCWRybV9lbmNvZGVyX2lu
aXQoJmRldl9wcml2LT5kcm0sICZpbnRlbF9lbmNvZGVyLT5iYXNlLAorCQlkcm1fZW5jb2Rlcl9p
bml0KCZpOTE1LT5kcm0sICZpbnRlbF9lbmNvZGVyLT5iYXNlLAogCQkJCSAmaW50ZWxfZHZvX2Vu
Y19mdW5jcywgZW5jb2Rlcl90eXBlLAogCQkJCSAiRFZPICVjIiwgcG9ydF9uYW1lKHBvcnQpKTsK
IApAQCAtNTExLDE0ICs1MTEsMTQgQEAgdm9pZCBpbnRlbF9kdm9faW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWNhc2UgSU5URUxfRFZPX0NISVBfVE1EUzoKIAkJCWlu
dGVsX2VuY29kZXItPmNsb25lYWJsZSA9ICgxIDw8IElOVEVMX09VVFBVVF9BTkFMT0cpIHwKIAkJ
CQkoMSA8PCBJTlRFTF9PVVRQVVRfRFZPKTsKLQkJCWRybV9jb25uZWN0b3JfaW5pdCgmZGV2X3By
aXYtPmRybSwgY29ubmVjdG9yLAorCQkJZHJtX2Nvbm5lY3Rvcl9pbml0KCZpOTE1LT5kcm0sIGNv
bm5lY3RvciwKIAkJCQkJICAgJmludGVsX2R2b19jb25uZWN0b3JfZnVuY3MsCiAJCQkJCSAgIERS
TV9NT0RFX0NPTk5FQ1RPUl9EVklJKTsKIAkJCWVuY29kZXJfdHlwZSA9IERSTV9NT0RFX0VOQ09E
RVJfVE1EUzsKIAkJCWJyZWFrOwogCQljYXNlIElOVEVMX0RWT19DSElQX0xWRFM6CiAJCQlpbnRl
bF9lbmNvZGVyLT5jbG9uZWFibGUgPSAwOwotCQkJZHJtX2Nvbm5lY3Rvcl9pbml0KCZkZXZfcHJp
di0+ZHJtLCBjb25uZWN0b3IsCisJCQlkcm1fY29ubmVjdG9yX2luaXQoJmk5MTUtPmRybSwgY29u
bmVjdG9yLAogCQkJCQkgICAmaW50ZWxfZHZvX2Nvbm5lY3Rvcl9mdW5jcywKIAkJCQkJICAgRFJN
X01PREVfQ09OTkVDVE9SX0xWRFMpOwogCQkJZW5jb2Rlcl90eXBlID0gRFJNX01PREVfRU5DT0RF
Ul9MVkRTOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHZvLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kdm8uaAppbmRleCAzZWQwZmRmOGVmZmYuLmQ4NjVj
ZDQzOWJiNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHZvLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHZvLmgKQEAgLTgsNiArOCw2IEBACiAKIHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlOwogCi12b2lkIGludGVsX2R2b19pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX2R2b19pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KTsKIAogI2VuZGlmIC8qIF9fSU5URUxfRFZPX0hfXyAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHZvX2Rldi5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZHZvX2Rldi5oCmluZGV4IDk0YTZhZTFlMDI5Mi4uMWQxODRkYzc5
MjJiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kdm9fZGV2LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHZvX2Rldi5oCkBAIC00MCw3ICs0MCw3IEBA
IHN0cnVjdCBpbnRlbF9kdm9fZGV2aWNlIHsKIAlpbnQgc2xhdmVfYWRkcjsKIAogCWNvbnN0IHN0
cnVjdCBpbnRlbF9kdm9fZGV2X29wcyAqZGV2X29wczsKLQl2b2lkICpkZXZfcHJpdjsKKwl2b2lk
ICppOTE1OwogCXN0cnVjdCBpMmNfYWRhcHRlciAqaTJjX2J1czsKIH07CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZmJjLmMKaW5kZXggNTY3OWYyZmZmYjdjLi42MjdmZWQyYTU1ZDIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2ZiYy5jCkBAIC00NSwxNCArNDUsMTQgQEAKICNpbmNsdWRlICJpbnRlbF9mYmMu
aCIKICNpbmNsdWRlICJpbnRlbF9mcm9udGJ1ZmZlci5oIgogCi1zdGF0aWMgaW5saW5lIGJvb2wg
ZmJjX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
aW5saW5lIGJvb2wgZmJjX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKLQlyZXR1cm4gSEFTX0ZCQyhkZXZfcHJpdik7CisJcmV0dXJuIEhBU19GQkMoaTkxNSk7CiB9
CiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBub19mYmNfb25fbXVsdGlwbGVfcGlwZXMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGlubGluZSBib29sIG5vX2ZiY19vbl9t
dWx0aXBsZV9waXBlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1cm4g
SU5URUxfR0VOKGRldl9wcml2KSA8PSAzOworCXJldHVybiBJTlRFTF9HRU4oaTkxNSkgPD0gMzsK
IH0KIAogLyoKQEAgLTgyLDIyICs4MiwyMiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmNfZ2V0X3Bs
YW5lX3NvdXJjZV9zaXplKHN0cnVjdCBpbnRlbF9mYmNfc3RhdGVfY2FjaGUgKmNhY2hlLAogCQkq
aGVpZ2h0ID0gY2FjaGUtPnBsYW5lLnNyY19oOwogfQogCi1zdGF0aWMgaW50IGludGVsX2ZiY19j
YWxjdWxhdGVfY2ZiX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIGludCBpbnRlbF9mYmNfY2FsY3VsYXRlX2NmYl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJCQlzdHJ1Y3QgaW50ZWxfZmJjX3N0YXRlX2NhY2hlICpjYWNoZSkKIHsK
IAlpbnQgbGluZXM7CiAKIAlpbnRlbF9mYmNfZ2V0X3BsYW5lX3NvdXJjZV9zaXplKGNhY2hlLCBO
VUxMLCAmbGluZXMpOwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDcpKQorCWlmIChJU19HRU4oaTkx
NSwgNykpCiAJCWxpbmVzID0gbWluKGxpbmVzLCAyMDQ4KTsKLQllbHNlIGlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDgpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDgpCiAJCWxpbmVz
ID0gbWluKGxpbmVzLCAyNTYwKTsKIAogCS8qIEhhcmR3YXJlIG5lZWRzIHRoZSBmdWxsIGJ1ZmZl
ciBzdHJpZGUsIG5vdCBqdXN0IHRoZSBhY3RpdmUgYXJlYS4gKi8KIAlyZXR1cm4gbGluZXMgKiBj
YWNoZS0+ZmIuc3RyaWRlOwogfQogCi1zdGF0aWMgdm9pZCBpOHh4X2ZiY19kZWFjdGl2YXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGk4eHhfZmJjX2Rl
YWN0aXZhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGZiY19jdGw7
CiAKQEAgLTExMCw3ICsxMTAsNyBAQCBzdGF0aWMgdm9pZCBpOHh4X2ZiY19kZWFjdGl2YXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlJOTE1X1dSSVRFKEZCQ19DT05UUk9M
LCBmYmNfY3RsKTsKIAogCS8qIFdhaXQgZm9yIGNvbXByZXNzaW5nIGJpdCB0byBjbGVhciAqLwot
CWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwlpZiAoaW50
ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkgICAgRkJDX1NUQVRVUywg
RkJDX1NUQVRfQ09NUFJFU1NJTkcsIDAsCiAJCQkJICAgIDEwKSkgewogCQlEUk1fREVCVUdfS01T
KCJGQkMgaWRsZSB0aW1lZCBvdXRcbiIpOwpAQCAtMTE4LDkgKzExOCw5IEBAIHN0YXRpYyB2b2lk
IGk4eHhfZmJjX2RlYWN0aXZhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CX0KIH0KIAotc3RhdGljIHZvaWQgaTh4eF9mYmNfYWN0aXZhdGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaTh4eF9mYmNfYWN0aXZhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2ZiY19yZWdfcGFyYW1zICpw
YXJhbXMgPSAmZGV2X3ByaXYtPmZiYy5wYXJhbXM7CisJc3RydWN0IGludGVsX2ZiY19yZWdfcGFy
YW1zICpwYXJhbXMgPSAmaTkxNS0+ZmJjLnBhcmFtczsKIAlpbnQgY2ZiX3BpdGNoOwogCWludCBp
OwogCXUzMiBmYmNfY3RsOwpAQCAtMTMxLDcgKzEzMSw3IEBAIHN0YXRpYyB2b2lkIGk4eHhfZmJj
X2FjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJY2ZiX3BpdGNo
ID0gcGFyYW1zLT5mYi5zdHJpZGU7CiAKIAkvKiBGQkNfQ1RMIHdhbnRzIDMyQiBvciA2NEIgdW5p
dHMgKi8KLQlpZiAoSVNfR0VOKGRldl9wcml2LCAyKSkKKwlpZiAoSVNfR0VOKGk5MTUsIDIpKQog
CQljZmJfcGl0Y2ggPSAoY2ZiX3BpdGNoIC8gMzIpIC0gMTsKIAllbHNlCiAJCWNmYl9waXRjaCA9
IChjZmJfcGl0Y2ggLyA2NCkgLSAxOwpAQCAtMTQwLDcgKzE0MCw3IEBAIHN0YXRpYyB2b2lkIGk4
eHhfZmJjX2FjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlmb3Ig
KGkgPSAwOyBpIDwgKEZCQ19MTF9TSVpFIC8gMzIpICsgMTsgaSsrKQogCQlJOTE1X1dSSVRFKEZC
Q19UQUcoaSksIDApOwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgNCkpIHsKKwlpZiAoSVNfR0VO
KGk5MTUsIDQpKSB7CiAJCXUzMiBmYmNfY3RsMjsKIAogCQkvKiBTZXQgaXQgdXAuLi4gKi8KQEAg
LTE1NCwyMSArMTU0LDIxIEBAIHN0YXRpYyB2b2lkIGk4eHhfZmJjX2FjdGl2YXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlmYmNfY3RsID0gSTkxNV9SRUFEKEZCQ19DT05U
Uk9MKTsKIAlmYmNfY3RsICY9IDB4M2ZmZiA8PCBGQkNfQ1RMX0lOVEVSVkFMX1NISUZUOwogCWZi
Y19jdGwgfD0gRkJDX0NUTF9FTiB8IEZCQ19DVExfUEVSSU9ESUM7Ci0JaWYgKElTX0k5NDVHTShk
ZXZfcHJpdikpCisJaWYgKElTX0k5NDVHTShpOTE1KSkKIAkJZmJjX2N0bCB8PSBGQkNfQ1RMX0Mz
X0lETEU7IC8qIDk0NSBuZWVkcyBzcGVjaWFsIFNSIGhhbmRsaW5nICovCiAJZmJjX2N0bCB8PSAo
Y2ZiX3BpdGNoICYgMHhmZikgPDwgRkJDX0NUTF9TVFJJREVfU0hJRlQ7CiAJZmJjX2N0bCB8PSBw
YXJhbXMtPnZtYS0+ZmVuY2UtPmlkOwogCUk5MTVfV1JJVEUoRkJDX0NPTlRST0wsIGZiY19jdGwp
OwogfQogCi1zdGF0aWMgYm9vbCBpOHh4X2ZiY19pc19hY3RpdmUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIGJvb2wgaTh4eF9mYmNfaXNfYWN0aXZlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXJldHVybiBJOTE1X1JFQUQoRkJDX0NPTlRST0wp
ICYgRkJDX0NUTF9FTjsKIH0KIAotc3RhdGljIHZvaWQgZzR4X2ZiY19hY3RpdmF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnNHhfZmJjX2FjdGl2YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9mYmNfcmVn
X3BhcmFtcyAqcGFyYW1zID0gJmRldl9wcml2LT5mYmMucGFyYW1zOworCXN0cnVjdCBpbnRlbF9m
YmNfcmVnX3BhcmFtcyAqcGFyYW1zID0gJmk5MTUtPmZiYy5wYXJhbXM7CiAJdTMyIGRwZmNfY3Rs
OwogCiAJZHBmY19jdGwgPSBEUEZDX0NUTF9QTEFORShwYXJhbXMtPmNydGMuaTl4eF9wbGFuZSkg
fCBEUEZDX1NSX0VOOwpAQCAtMTg4LDcgKzE4OCw3IEBAIHN0YXRpYyB2b2lkIGc0eF9mYmNfYWN0
aXZhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJVEUoRFBG
Q19DT05UUk9MLCBkcGZjX2N0bCB8IERQRkNfQ1RMX0VOKTsKIH0KIAotc3RhdGljIHZvaWQgZzR4
X2ZiY19kZWFjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRp
YyB2b2lkIGc0eF9mYmNfZGVhY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAl1MzIgZHBmY19jdGw7CiAKQEAgLTIwMCwyMyArMjAwLDIzIEBAIHN0YXRpYyB2b2lkIGc0
eF9mYmNfZGVhY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQog
fQogCi1zdGF0aWMgYm9vbCBnNHhfZmJjX2lzX2FjdGl2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBnNHhfZmJjX2lzX2FjdGl2ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlyZXR1cm4gSTkxNV9SRUFEKERQRkNfQ09OVFJPTCkgJiBE
UEZDX0NUTF9FTjsKIH0KIAogLyogVGhpcyBmdW5jdGlvbiBmb3JjZXMgYSBDRkIgcmVjb21wcmVz
c2lvbiB0aHJvdWdoIHRoZSBudWtlIG9wZXJhdGlvbi4gKi8KLXN0YXRpYyB2b2lkIGludGVsX2Zi
Y19yZWNvbXByZXNzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIGludGVsX2ZiY19yZWNvbXByZXNzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCUk5MTVfV1JJVEUoTVNHX0ZCQ19SRU5EX1NUQVRFLCBGQkNfUkVORF9OVUtFKTsKIAlQT1NU
SU5HX1JFQUQoTVNHX0ZCQ19SRU5EX1NUQVRFKTsKIH0KIAotc3RhdGljIHZvaWQgaWxrX2ZiY19h
Y3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBp
bGtfZmJjX2FjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVj
dCBpbnRlbF9mYmNfcmVnX3BhcmFtcyAqcGFyYW1zID0gJmRldl9wcml2LT5mYmMucGFyYW1zOwor
CXN0cnVjdCBpbnRlbF9mYmNfcmVnX3BhcmFtcyAqcGFyYW1zID0gJmk5MTUtPmZiYy5wYXJhbXM7
CiAJdTMyIGRwZmNfY3RsOwotCWludCB0aHJlc2hvbGQgPSBkZXZfcHJpdi0+ZmJjLnRocmVzaG9s
ZDsKKwlpbnQgdGhyZXNob2xkID0gaTkxNS0+ZmJjLnRocmVzaG9sZDsKIAogCWRwZmNfY3RsID0g
RFBGQ19DVExfUExBTkUocGFyYW1zLT5jcnRjLmk5eHhfcGxhbmUpOwogCWlmIChwYXJhbXMtPmZi
LmZvcm1hdC0+Y3BwWzBdID09IDIpCkBAIC0yMzcsOSArMjM3LDkgQEAgc3RhdGljIHZvaWQgaWxr
X2ZiY19hY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAlpZiAo
cGFyYW1zLT5mbGFncyAmIFBMQU5FX0hBU19GRU5DRSkgewogCQlkcGZjX2N0bCB8PSBEUEZDX0NU
TF9GRU5DRV9FTjsKLQkJaWYgKElTX0dFTihkZXZfcHJpdiwgNSkpCisJCWlmIChJU19HRU4oaTkx
NSwgNSkpCiAJCQlkcGZjX2N0bCB8PSBwYXJhbXMtPnZtYS0+ZmVuY2UtPmlkOwotCQlpZiAoSVNf
R0VOKGRldl9wcml2LCA2KSkgeworCQlpZiAoSVNfR0VOKGk5MTUsIDYpKSB7CiAJCQlJOTE1X1dS
SVRFKFNOQl9EUEZDX0NUTF9TQSwKIAkJCQkgICBTTkJfQ1BVX0ZFTkNFX0VOQUJMRSB8CiAJCQkJ
ICAgcGFyYW1zLT52bWEtPmZlbmNlLT5pZCk7CkBAIC0yNDcsNyArMjQ3LDcgQEAgc3RhdGljIHZv
aWQgaWxrX2ZiY19hY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
CQkJICAgcGFyYW1zLT5jcnRjLmZlbmNlX3lfb2Zmc2V0KTsKIAkJfQogCX0gZWxzZSB7Ci0JCWlm
IChJU19HRU4oZGV2X3ByaXYsIDYpKSB7CisJCWlmIChJU19HRU4oaTkxNSwgNikpIHsKIAkJCUk5
MTVfV1JJVEUoU05CX0RQRkNfQ1RMX1NBLCAwKTsKIAkJCUk5MTVfV1JJVEUoRFBGQ19DUFVfRkVO
Q0VfT0ZGU0VULCAwKTsKIAkJfQpAQCAtMjU5LDEwICsyNTksMTAgQEAgc3RhdGljIHZvaWQgaWxr
X2ZiY19hY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJLyogZW5h
YmxlIGl0Li4uICovCiAJSTkxNV9XUklURShJTEtfRFBGQ19DT05UUk9MLCBkcGZjX2N0bCB8IERQ
RkNfQ1RMX0VOKTsKIAotCWludGVsX2ZiY19yZWNvbXByZXNzKGRldl9wcml2KTsKKwlpbnRlbF9m
YmNfcmVjb21wcmVzcyhpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQgaWxrX2ZiY19kZWFjdGl2YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGlsa19mYmNf
ZGVhY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgZHBmY19j
dGw7CiAKQEAgLTI3NCwxOSArMjc0LDE5IEBAIHN0YXRpYyB2b2lkIGlsa19mYmNfZGVhY3RpdmF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMgYm9v
bCBpbGtfZmJjX2lzX2FjdGl2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitz
dGF0aWMgYm9vbCBpbGtfZmJjX2lzX2FjdGl2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAlyZXR1cm4gSTkxNV9SRUFEKElMS19EUEZDX0NPTlRST0wpICYgRFBGQ19DVExfRU47
CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjdfZmJjX2FjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdlbjdfZmJjX2FjdGl2YXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9mYmNfcmVnX3BhcmFtcyAqcGFy
YW1zID0gJmRldl9wcml2LT5mYmMucGFyYW1zOworCXN0cnVjdCBpbnRlbF9mYmNfcmVnX3BhcmFt
cyAqcGFyYW1zID0gJmk5MTUtPmZiYy5wYXJhbXM7CiAJdTMyIGRwZmNfY3RsOwotCWludCB0aHJl
c2hvbGQgPSBkZXZfcHJpdi0+ZmJjLnRocmVzaG9sZDsKKwlpbnQgdGhyZXNob2xkID0gaTkxNS0+
ZmJjLnRocmVzaG9sZDsKIAogCS8qIERpc3BsYXkgV0EgIzA1Mjk6IHNrbCwga2JsLCBieHQuICov
Ci0JaWYgKElTX0dFTihkZXZfcHJpdiwgOSkgJiYgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7
CisJaWYgKElTX0dFTihpOTE1LCA5KSAmJiAhSVNfR0VNSU5JTEFLRShpOTE1KSkgewogCQl1MzIg
dmFsID0gSTkxNV9SRUFEKENISUNLRU5fTUlTQ180KTsKIAogCQl2YWwgJj0gfihGQkNfU1RSSURF
X09WRVJSSURFIHwgRkJDX1NUUklERV9NQVNLKTsKQEAgLTI5OSw3ICsyOTksNyBAQCBzdGF0aWMg
dm9pZCBnZW43X2ZiY19hY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJfQogCiAJZHBmY19jdGwgPSAwOwotCWlmIChJU19JVllCUklER0UoZGV2X3ByaXYpKQorCWlm
IChJU19JVllCUklER0UoaTkxNSkpCiAJCWRwZmNfY3RsIHw9IElWQl9EUEZDX0NUTF9QTEFORShw
YXJhbXMtPmNydGMuaTl4eF9wbGFuZSk7CiAKIAlpZiAocGFyYW1zLT5mYi5mb3JtYXQtPmNwcFsw
XSA9PSAyKQpAQCAtMzI5LDE1ICszMjksMTUgQEAgc3RhdGljIHZvaWQgZ2VuN19mYmNfYWN0aXZh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlJOTE1X1dSSVRFKERQRkNf
Q1BVX0ZFTkNFX09GRlNFVCwgMCk7CiAJfQogCi0JaWYgKGRldl9wcml2LT5mYmMuZmFsc2VfY29s
b3IpCisJaWYgKGk5MTUtPmZiYy5mYWxzZV9jb2xvcikKIAkJZHBmY19jdGwgfD0gRkJDX0NUTF9G
QUxTRV9DT0xPUjsKIAotCWlmIChJU19JVllCUklER0UoZGV2X3ByaXYpKSB7CisJaWYgKElTX0lW
WUJSSURHRShpOTE1KSkgewogCQkvKiBXYUZiY0FzeW5jaEZsaXBEaXNhYmxlRmJjUXVldWU6aXZi
ICovCiAJCUk5MTVfV1JJVEUoSUxLX0RJU1BMQVlfQ0hJQ0tFTjEsCiAJCQkgICBJOTE1X1JFQUQo
SUxLX0RJU1BMQVlfQ0hJQ0tFTjEpIHwKIAkJCSAgIElMS19GQkNRX0RJUyk7Ci0JfSBlbHNlIGlm
IChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7CisJfSBl
bHNlIGlmIChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FEV0VMTChpOTE1KSkgewogCQkvKiBX
YUZiY0FzeW5jaEZsaXBEaXNhYmxlRmJjUXVldWU6aHN3LGJkdyAqLwogCQlJOTE1X1dSSVRFKENI
SUNLRU5fUElQRVNMXzEocGFyYW1zLT5jcnRjLnBpcGUpLAogCQkJICAgSTkxNV9SRUFEKENISUNL
RU5fUElQRVNMXzEocGFyYW1zLT5jcnRjLnBpcGUpKSB8CkBAIC0zNDYsNzIgKzM0Niw3MiBAQCBz
dGF0aWMgdm9pZCBnZW43X2ZiY19hY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAKIAlJOTE1X1dSSVRFKElMS19EUEZDX0NPTlRST0wsIGRwZmNfY3RsIHwgRFBGQ19D
VExfRU4pOwogCi0JaW50ZWxfZmJjX3JlY29tcHJlc3MoZGV2X3ByaXYpOworCWludGVsX2ZiY19y
ZWNvbXByZXNzKGk5MTUpOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9mYmNfaHdfaXNfYWN0aXZl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBib29sIGludGVsX2Zi
Y19od19pc19hY3RpdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gNSkKLQkJcmV0dXJuIGlsa19mYmNfaXNfYWN0aXZlKGRldl9w
cml2KTsKLQllbHNlIGlmIChJU19HTTQ1KGRldl9wcml2KSkKLQkJcmV0dXJuIGc0eF9mYmNfaXNf
YWN0aXZlKGRldl9wcml2KTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDUpCisJCXJldHVybiBp
bGtfZmJjX2lzX2FjdGl2ZShpOTE1KTsKKwllbHNlIGlmIChJU19HTTQ1KGk5MTUpKQorCQlyZXR1
cm4gZzR4X2ZiY19pc19hY3RpdmUoaTkxNSk7CiAJZWxzZQotCQlyZXR1cm4gaTh4eF9mYmNfaXNf
YWN0aXZlKGRldl9wcml2KTsKKwkJcmV0dXJuIGk4eHhfZmJjX2lzX2FjdGl2ZShpOTE1KTsKIH0K
IAotc3RhdGljIHZvaWQgaW50ZWxfZmJjX2h3X2FjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2ZiY19od19hY3RpdmF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2
X3ByaXYtPmZiYzsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCiAJZmJj
LT5hY3RpdmUgPSB0cnVlOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNykKLQkJZ2Vu
N19mYmNfYWN0aXZhdGUoZGV2X3ByaXYpOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gNSkKLQkJaWxrX2ZiY19hY3RpdmF0ZShkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSVNfR000NShk
ZXZfcHJpdikpCi0JCWc0eF9mYmNfYWN0aXZhdGUoZGV2X3ByaXYpOworCWlmIChJTlRFTF9HRU4o
aTkxNSkgPj0gNykKKwkJZ2VuN19mYmNfYWN0aXZhdGUoaTkxNSk7CisJZWxzZSBpZiAoSU5URUxf
R0VOKGk5MTUpID49IDUpCisJCWlsa19mYmNfYWN0aXZhdGUoaTkxNSk7CisJZWxzZSBpZiAoSVNf
R000NShpOTE1KSkKKwkJZzR4X2ZiY19hY3RpdmF0ZShpOTE1KTsKIAllbHNlCi0JCWk4eHhfZmJj
X2FjdGl2YXRlKGRldl9wcml2KTsKKwkJaTh4eF9mYmNfYWN0aXZhdGUoaTkxNSk7CiB9CiAKLXN0
YXRpYyB2b2lkIGludGVsX2ZiY19od19kZWFjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2ZiY19od19kZWFjdGl2YXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZf
cHJpdi0+ZmJjOworCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZpOTE1LT5mYmM7CiAKIAlmYmMt
PmFjdGl2ZSA9IGZhbHNlOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkKLQkJaWxr
X2ZiY19kZWFjdGl2YXRlKGRldl9wcml2KTsKLQllbHNlIGlmIChJU19HTTQ1KGRldl9wcml2KSkK
LQkJZzR4X2ZiY19kZWFjdGl2YXRlKGRldl9wcml2KTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDUpCisJCWlsa19mYmNfZGVhY3RpdmF0ZShpOTE1KTsKKwllbHNlIGlmIChJU19HTTQ1KGk5MTUp
KQorCQlnNHhfZmJjX2RlYWN0aXZhdGUoaTkxNSk7CiAJZWxzZQotCQlpOHh4X2ZiY19kZWFjdGl2
YXRlKGRldl9wcml2KTsKKwkJaTh4eF9mYmNfZGVhY3RpdmF0ZShpOTE1KTsKIH0KIAogLyoqCiAg
KiBpbnRlbF9mYmNfaXNfYWN0aXZlIC0gSXMgRkJDIGFjdGl2ZT8KLSAqIEBkZXZfcHJpdjogaTkx
NSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAq
IFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byB2ZXJpZnkgdGhlIGN1cnJlbnQgc3RhdGUgb2YgRkJD
LgogICoKICAqIEZJWE1FOiBUaGlzIHNob3VsZCBiZSB0cmFja2VkIGluIHRoZSBwbGFuZSBjb25m
aWcgZXZlbnR1YWxseQogICogaW5zdGVhZCBvZiBxdWVyaWVkIGF0IHJ1bnRpbWUgZm9yIG1vc3Qg
Y2FsbGVycy4KICAqLwotYm9vbCBpbnRlbF9mYmNfaXNfYWN0aXZlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK2Jvb2wgaW50ZWxfZmJjX2lzX2FjdGl2ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1cm4gZGV2X3ByaXYtPmZiYy5hY3RpdmU7CisJcmV0
dXJuIGk5MTUtPmZiYy5hY3RpdmU7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX2ZiY19kZWFjdGl2
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGludGVs
X2ZiY19kZWFjdGl2YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSBjb25z
dCBjaGFyICpyZWFzb24pCiB7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5m
YmM7CisJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmk5MTUtPmZiYzsKIAogCVdBUk5fT04oIW11
dGV4X2lzX2xvY2tlZCgmZmJjLT5sb2NrKSk7CiAKIAlpZiAoZmJjLT5hY3RpdmUpCi0JCWludGVs
X2ZiY19od19kZWFjdGl2YXRlKGRldl9wcml2KTsKKwkJaW50ZWxfZmJjX2h3X2RlYWN0aXZhdGUo
aTkxNSk7CiAKIAlmYmMtPm5vX2ZiY19yZWFzb24gPSByZWFzb247CiB9CkBAIC00MTksMTIgKzQx
OSwxMiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmNfZGVhY3RpdmF0ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgYm9vbCBtdWx0aXBsZV9waXBlc19vayhzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5m
YmM7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCWVudW0gcGlwZSBw
aXBlID0gY3J0Yy0+cGlwZTsKIAogCS8qIERvbid0IGV2ZW4gYm90aGVyIHRyYWNraW5nIGFueXRo
aW5nIHdlIGRvbid0IG5lZWQuICovCi0JaWYgKCFub19mYmNfb25fbXVsdGlwbGVfcGlwZXMoZGV2
X3ByaXYpKQorCWlmICghbm9fZmJjX29uX211bHRpcGxlX3BpcGVzKGk5MTUpKQogCQlyZXR1cm4g
dHJ1ZTsKIAogCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQpAQCAtNDM1LDcgKzQzNSw3
IEBAIHN0YXRpYyBib29sIG11bHRpcGxlX3BpcGVzX29rKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCXJldHVybiAoZmJjLT52aXNpYmxlX3BpcGVzX21hc2sgJiB+KDEgPDwgcGlwZSkpICE9IDA7
CiB9CiAKLXN0YXRpYyBpbnQgZmluZF9jb21wcmVzc2lvbl90aHJlc2hvbGQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGludCBmaW5kX2NvbXByZXNzaW9uX3RocmVz
aG9sZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICBzdHJ1Y3QgZHJt
X21tX25vZGUgKm5vZGUsCiAJCQkJICAgICAgaW50IHNpemUsCiAJCQkJICAgICAgaW50IGZiX2Nw
cCkKQEAgLTQ0OCw4ICs0NDgsOCBAQCBzdGF0aWMgaW50IGZpbmRfY29tcHJlc3Npb25fdGhyZXNo
b2xkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiByZXNlcnZlZCByYW5n
ZSBzaXplLCBzbyBpdCBhbHdheXMgYXNzdW1lcyB0aGUgbWF4aW11bSAoOG1iKSBpcyB1c2VkLgog
CSAqIElmIHdlIGVuYWJsZSBGQkMgdXNpbmcgYSBDRkIgb24gdGhhdCBtZW1vcnkgcmFuZ2Ugd2Un
bGwgZ2V0IEZJRk8KIAkgKiB1bmRlcnJ1bnMsIGV2ZW4gaWYgdGhhdCByYW5nZSBpcyBub3QgcmVz
ZXJ2ZWQgYnkgdGhlIEJJT1MuICovCi0JaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikgfHwgSVNf
R0VOOV9CQyhkZXZfcHJpdikpCi0JCWVuZCA9IHJlc291cmNlX3NpemUoJmRldl9wcml2LT5kc20p
IC0gOCAqIDEwMjQgKiAxMDI0OworCWlmIChJU19CUk9BRFdFTEwoaTkxNSkgfHwgSVNfR0VOOV9C
QyhpOTE1KSkKKwkJZW5kID0gcmVzb3VyY2Vfc2l6ZSgmaTkxNS0+ZHNtKSAtIDggKiAxMDI0ICog
MTAyNDsKIAllbHNlCiAJCWVuZCA9IFU2NF9NQVg7CiAKQEAgLTQ2MSw3ICs0NjEsNyBAQCBzdGF0
aWMgaW50IGZpbmRfY29tcHJlc3Npb25fdGhyZXNob2xkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkgKi8KIAogCS8qIFRyeSB0byBvdmVyLWFsbG9jYXRlIHRvIHJlZHVjZSBy
ZWFsbG9jYXRpb25zIGFuZCBmcmFnbWVudGF0aW9uLiAqLwotCXJldCA9IGk5MTVfZ2VtX3N0b2xl
bl9pbnNlcnRfbm9kZV9pbl9yYW5nZShkZXZfcHJpdiwgbm9kZSwgc2l6ZSA8PD0gMSwKKwlyZXQg
PSBpOTE1X2dlbV9zdG9sZW5faW5zZXJ0X25vZGVfaW5fcmFuZ2UoaTkxNSwgbm9kZSwgc2l6ZSA8
PD0gMSwKIAkJCQkJCSAgIDQwOTYsIDAsIGVuZCk7CiAJaWYgKHJldCA9PSAwKQogCQlyZXR1cm4g
Y29tcHJlc3Npb25fdGhyZXNob2xkOwpAQCAtNDcyLDkgKzQ3Miw5IEBAIHN0YXRpYyBpbnQgZmlu
ZF9jb21wcmVzc2lvbl90aHJlc2hvbGQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCSAgICAoZmJfY3BwID09IDIgJiYgY29tcHJlc3Npb25fdGhyZXNob2xkID09IDIpKQogCQly
ZXR1cm4gMDsKIAotCXJldCA9IGk5MTVfZ2VtX3N0b2xlbl9pbnNlcnRfbm9kZV9pbl9yYW5nZShk
ZXZfcHJpdiwgbm9kZSwgc2l6ZSA+Pj0gMSwKKwlyZXQgPSBpOTE1X2dlbV9zdG9sZW5faW5zZXJ0
X25vZGVfaW5fcmFuZ2UoaTkxNSwgbm9kZSwgc2l6ZSA+Pj0gMSwKIAkJCQkJCSAgIDQwOTYsIDAs
IGVuZCk7Ci0JaWYgKHJldCAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDQpIHsKKwlpZiAocmV0
ICYmIElOVEVMX0dFTihpOTE1KSA8PSA0KSB7CiAJCXJldHVybiAwOwogCX0gZWxzZSBpZiAocmV0
KSB7CiAJCWNvbXByZXNzaW9uX3RocmVzaG9sZCA8PD0gMTsKQEAgLTQ4NiwxNyArNDg2LDE3IEBA
IHN0YXRpYyBpbnQgZmluZF9jb21wcmVzc2lvbl90aHJlc2hvbGQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgaW50IGludGVsX2ZiY19hbGxvY19jZmIoc3RydWN0
IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRl
dl9wcml2LT5mYmM7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCXN0
cnVjdCBkcm1fbW1fbm9kZSAqdW5pbml0aWFsaXplZF92YXIoY29tcHJlc3NlZF9sbGIpOwogCWlu
dCBzaXplLCBmYl9jcHAsIHJldDsKIAogCVdBUk5fT04oZHJtX21tX25vZGVfYWxsb2NhdGVkKCZm
YmMtPmNvbXByZXNzZWRfZmIpKTsKIAotCXNpemUgPSBpbnRlbF9mYmNfY2FsY3VsYXRlX2NmYl9z
aXplKGRldl9wcml2LCAmZmJjLT5zdGF0ZV9jYWNoZSk7CisJc2l6ZSA9IGludGVsX2ZiY19jYWxj
dWxhdGVfY2ZiX3NpemUoaTkxNSwgJmZiYy0+c3RhdGVfY2FjaGUpOwogCWZiX2NwcCA9IGZiYy0+
c3RhdGVfY2FjaGUuZmIuZm9ybWF0LT5jcHBbMF07CiAKLQlyZXQgPSBmaW5kX2NvbXByZXNzaW9u
X3RocmVzaG9sZChkZXZfcHJpdiwgJmZiYy0+Y29tcHJlc3NlZF9mYiwKKwlyZXQgPSBmaW5kX2Nv
bXByZXNzaW9uX3RocmVzaG9sZChpOTE1LCAmZmJjLT5jb21wcmVzc2VkX2ZiLAogCQkJCQkgc2l6
ZSwgZmJfY3BwKTsKIAlpZiAoIXJldCkKIAkJZ290byBlcnJfbGxiOwpAQCAtNTA3LDMyICs1MDcs
MzIgQEAgc3RhdGljIGludCBpbnRlbF9mYmNfYWxsb2NfY2ZiKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjKQogCiAJZmJjLT50aHJlc2hvbGQgPSByZXQ7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA1KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNSkKIAkJSTkxNV9XUklURShJTEtfRFBG
Q19DQl9CQVNFLCBmYmMtPmNvbXByZXNzZWRfZmIuc3RhcnQpOwotCWVsc2UgaWYgKElTX0dNNDUo
ZGV2X3ByaXYpKSB7CisJZWxzZSBpZiAoSVNfR000NShpOTE1KSkgewogCQlJOTE1X1dSSVRFKERQ
RkNfQ0JfQkFTRSwgZmJjLT5jb21wcmVzc2VkX2ZiLnN0YXJ0KTsKIAl9IGVsc2UgewogCQljb21w
cmVzc2VkX2xsYiA9IGt6YWxsb2Moc2l6ZW9mKCpjb21wcmVzc2VkX2xsYiksIEdGUF9LRVJORUwp
OwogCQlpZiAoIWNvbXByZXNzZWRfbGxiKQogCQkJZ290byBlcnJfZmI7CiAKLQkJcmV0ID0gaTkx
NV9nZW1fc3RvbGVuX2luc2VydF9ub2RlKGRldl9wcml2LCBjb21wcmVzc2VkX2xsYiwKKwkJcmV0
ID0gaTkxNV9nZW1fc3RvbGVuX2luc2VydF9ub2RlKGk5MTUsIGNvbXByZXNzZWRfbGxiLAogCQkJ
CQkJICA0MDk2LCA0MDk2KTsKIAkJaWYgKHJldCkKIAkJCWdvdG8gZXJyX2ZiOwogCiAJCWZiYy0+
Y29tcHJlc3NlZF9sbGIgPSBjb21wcmVzc2VkX2xsYjsKIAotCQlHRU1fQlVHX09OKHJhbmdlX292
ZXJmbG93c190KHU2NCwgZGV2X3ByaXYtPmRzbS5zdGFydCwKKwkJR0VNX0JVR19PTihyYW5nZV9v
dmVyZmxvd3NfdCh1NjQsIGk5MTUtPmRzbS5zdGFydCwKIAkJCQkJICAgICBmYmMtPmNvbXByZXNz
ZWRfZmIuc3RhcnQsCiAJCQkJCSAgICAgVTMyX01BWCkpOwotCQlHRU1fQlVHX09OKHJhbmdlX292
ZXJmbG93c190KHU2NCwgZGV2X3ByaXYtPmRzbS5zdGFydCwKKwkJR0VNX0JVR19PTihyYW5nZV9v
dmVyZmxvd3NfdCh1NjQsIGk5MTUtPmRzbS5zdGFydCwKIAkJCQkJICAgICBmYmMtPmNvbXByZXNz
ZWRfbGxiLT5zdGFydCwKIAkJCQkJICAgICBVMzJfTUFYKSk7CiAJCUk5MTVfV1JJVEUoRkJDX0NG
Ql9CQVNFLAotCQkJICAgZGV2X3ByaXYtPmRzbS5zdGFydCArIGZiYy0+Y29tcHJlc3NlZF9mYi5z
dGFydCk7CisJCQkgICBpOTE1LT5kc20uc3RhcnQgKyBmYmMtPmNvbXByZXNzZWRfZmIuc3RhcnQp
OwogCQlJOTE1X1dSSVRFKEZCQ19MTF9CQVNFLAotCQkJICAgZGV2X3ByaXYtPmRzbS5zdGFydCAr
IGNvbXByZXNzZWRfbGxiLT5zdGFydCk7CisJCQkgICBpOTE1LT5kc20uc3RhcnQgKyBjb21wcmVz
c2VkX2xsYi0+c3RhcnQpOwogCX0KIAogCURSTV9ERUJVR19LTVMoInJlc2VydmVkICVsbHUgYnl0
ZXMgb2YgY29udGlndW91cyBzdG9sZW4gc3BhY2UgZm9yIEZCQywgdGhyZXNob2xkOiAlZFxuIiwK
QEAgLTU0MiwzOSArNTQyLDM5IEBAIHN0YXRpYyBpbnQgaW50ZWxfZmJjX2FsbG9jX2NmYihzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAogZXJyX2ZiOgogCWtmcmVlKGNvbXByZXNzZWRfbGxiKTsK
LQlpOTE1X2dlbV9zdG9sZW5fcmVtb3ZlX25vZGUoZGV2X3ByaXYsICZmYmMtPmNvbXByZXNzZWRf
ZmIpOworCWk5MTVfZ2VtX3N0b2xlbl9yZW1vdmVfbm9kZShpOTE1LCAmZmJjLT5jb21wcmVzc2Vk
X2ZiKTsKIGVycl9sbGI6Ci0JaWYgKGRybV9tbV9pbml0aWFsaXplZCgmZGV2X3ByaXYtPm1tLnN0
b2xlbikpCisJaWYgKGRybV9tbV9pbml0aWFsaXplZCgmaTkxNS0+bW0uc3RvbGVuKSkKIAkJcHJf
aW5mb19vbmNlKCJkcm06IG5vdCBlbm91Z2ggc3RvbGVuIHNwYWNlIGZvciBjb21wcmVzc2VkIGJ1
ZmZlciAobmVlZCAlZCBtb3JlIGJ5dGVzKSwgZGlzYWJsaW5nLiBIaW50OiB5b3UgbWF5IGJlIGFi
bGUgdG8gaW5jcmVhc2Ugc3RvbGVuIG1lbW9yeSBzaXplIGluIHRoZSBCSU9TIHRvIGF2b2lkIHRo
aXMuXG4iLCBzaXplKTsKIAlyZXR1cm4gLUVOT1NQQzsKIH0KIAotc3RhdGljIHZvaWQgX19pbnRl
bF9mYmNfY2xlYW51cF9jZmIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgX19pbnRlbF9mYmNfY2xlYW51cF9jZmIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CisJc3Ry
dWN0IGludGVsX2ZiYyAqZmJjID0gJmk5MTUtPmZiYzsKIAogCWlmIChkcm1fbW1fbm9kZV9hbGxv
Y2F0ZWQoJmZiYy0+Y29tcHJlc3NlZF9mYikpCi0JCWk5MTVfZ2VtX3N0b2xlbl9yZW1vdmVfbm9k
ZShkZXZfcHJpdiwgJmZiYy0+Y29tcHJlc3NlZF9mYik7CisJCWk5MTVfZ2VtX3N0b2xlbl9yZW1v
dmVfbm9kZShpOTE1LCAmZmJjLT5jb21wcmVzc2VkX2ZiKTsKIAogCWlmIChmYmMtPmNvbXByZXNz
ZWRfbGxiKSB7Ci0JCWk5MTVfZ2VtX3N0b2xlbl9yZW1vdmVfbm9kZShkZXZfcHJpdiwgZmJjLT5j
b21wcmVzc2VkX2xsYik7CisJCWk5MTVfZ2VtX3N0b2xlbl9yZW1vdmVfbm9kZShpOTE1LCBmYmMt
PmNvbXByZXNzZWRfbGxiKTsKIAkJa2ZyZWUoZmJjLT5jb21wcmVzc2VkX2xsYik7CiAJfQogfQog
Ci12b2lkIGludGVsX2ZiY19jbGVhbnVwX2NmYihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCit2b2lkIGludGVsX2ZiY19jbGVhbnVwX2NmYihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKKwlz
dHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCi0JaWYgKCFmYmNfc3VwcG9ydGVk
KGRldl9wcml2KSkKKwlpZiAoIWZiY19zdXBwb3J0ZWQoaTkxNSkpCiAJCXJldHVybjsKIAogCW11
dGV4X2xvY2soJmZiYy0+bG9jayk7Ci0JX19pbnRlbF9mYmNfY2xlYW51cF9jZmIoZGV2X3ByaXYp
OworCV9faW50ZWxfZmJjX2NsZWFudXBfY2ZiKGk5MTUpOwogCW11dGV4X3VubG9jaygmZmJjLT5s
b2NrKTsKIH0KIAotc3RhdGljIGJvb2wgc3RyaWRlX2lzX3ZhbGlkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBib29sIHN0cmlkZV9pc192YWxpZChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICB1bnNpZ25lZCBpbnQgc3RyaWRlKQogewogCS8q
IFRoaXMgc2hvdWxkIGhhdmUgYmVlbiBjYXVnaHQgZWFybGllci4gKi8KQEAgLTU4NSwxMCArNTg1
LDEwIEBAIHN0YXRpYyBib29sIHN0cmlkZV9pc192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJaWYgKHN0cmlkZSA8IDUxMikKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYg
KElTX0dFTihkZXZfcHJpdiwgMikgfHwgSVNfR0VOKGRldl9wcml2LCAzKSkKKwlpZiAoSVNfR0VO
KGk5MTUsIDIpIHx8IElTX0dFTihpOTE1LCAzKSkKIAkJcmV0dXJuIHN0cmlkZSA9PSA0MDk2IHx8
IHN0cmlkZSA9PSA4MTkyOwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgNCkgJiYgIUlTX0c0WChk
ZXZfcHJpdikgJiYgc3RyaWRlIDwgMjA0OCkKKwlpZiAoSVNfR0VOKGk5MTUsIDQpICYmICFJU19H
NFgoaTkxNSkgJiYgc3RyaWRlIDwgMjA0OCkKIAkJcmV0dXJuIGZhbHNlOwogCiAJaWYgKHN0cmlk
ZSA+IDE2Mzg0KQpAQCAtNTk3LDcgKzU5Nyw3IEBAIHN0YXRpYyBib29sIHN0cmlkZV9pc192YWxp
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIHRydWU7CiB9CiAK
LXN0YXRpYyBib29sIHBpeGVsX2Zvcm1hdF9pc192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBwaXhlbF9mb3JtYXRfaXNfdmFsaWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICB1MzIgcGl4ZWxfZm9ybWF0KQogewogCXN3aXRj
aCAocGl4ZWxfZm9ybWF0KSB7CkBAIC02MDcsMTAgKzYwNywxMCBAQCBzdGF0aWMgYm9vbCBwaXhl
bF9mb3JtYXRfaXNfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWNh
c2UgRFJNX0ZPUk1BVF9YUkdCMTU1NToKIAljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgogCQkvKiAx
NmJwcCBub3Qgc3VwcG9ydGVkIG9uIGdlbjIgKi8KLQkJaWYgKElTX0dFTihkZXZfcHJpdiwgMikp
CisJCWlmIChJU19HRU4oaTkxNSwgMikpCiAJCQlyZXR1cm4gZmFsc2U7CiAJCS8qIFdhRmJjT25s
eTF0bzFSYXRpbzpjdGcgKi8KLQkJaWYgKElTX0c0WChkZXZfcHJpdikpCisJCWlmIChJU19HNFgo
aTkxNSkpCiAJCQlyZXR1cm4gZmFsc2U7CiAJCXJldHVybiB0cnVlOwogCWRlZmF1bHQ6CkBAIC02
MjYsMTcgKzYyNiwxNyBAQCBzdGF0aWMgYm9vbCBwaXhlbF9mb3JtYXRfaXNfdmFsaWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICovCiBzdGF0aWMgYm9vbCBpbnRlbF9mYmNf
aHdfdHJhY2tpbmdfY292ZXJzX3NjcmVlbihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKLQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBp
bnRlbF9mYmMgKmZiYyA9ICZpOTE1LT5mYmM7CiAJdW5zaWduZWQgaW50IGVmZmVjdGl2ZV93LCBl
ZmZlY3RpdmVfaCwgbWF4X3csIG1heF9oOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDEwIHx8IElTX0dFTUlOSUxBS0UoaTkxNSkpIHsKIAkJbWF4X3cgPSA1MTIwOwogCQltYXhfaCA9
IDQwOTY7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDggfHwgSVNfSEFTV0VM
TChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4IHx8IElTX0hB
U1dFTEwoaTkxNSkpIHsKIAkJbWF4X3cgPSA0MDk2OwogCQltYXhfaCA9IDQwOTY7Ci0JfSBlbHNl
IGlmIChJU19HNFgoZGV2X3ByaXYpIHx8IElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkgeworCX0g
ZWxzZSBpZiAoSVNfRzRYKGk5MTUpIHx8IElOVEVMX0dFTihpOTE1KSA+PSA1KSB7CiAJCW1heF93
ID0gNDA5NjsKIAkJbWF4X2ggPSAyMDQ4OwogCX0gZWxzZSB7CkBAIC02NTYsOCArNjU2LDggQEAg
c3RhdGljIHZvaWQgaW50ZWxfZmJjX3VwZGF0ZV9zdGF0ZV9jYWNoZShzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKIAkJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJ
CQkgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9mYmMg
KmZiYyA9ICZpOTE1LT5mYmM7CiAJc3RydWN0IGludGVsX2ZiY19zdGF0ZV9jYWNoZSAqY2FjaGUg
PSAmZmJjLT5zdGF0ZV9jYWNoZTsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5iYXNlLmZiOwogCkBAIC02NjUsNyArNjY1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
ZmJjX3VwZGF0ZV9zdGF0ZV9jYWNoZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAljYWNoZS0+
ZmxhZ3MgPSAwOwogCiAJY2FjaGUtPmNydGMubW9kZV9mbGFncyA9IGNydGNfc3RhdGUtPmJhc2Uu
YWRqdXN0ZWRfbW9kZS5mbGFnczsKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJP
QURXRUxMKGRldl9wcml2KSkKKwlpZiAoSVNfSEFTV0VMTChpOTE1KSB8fCBJU19CUk9BRFdFTEwo
aTkxNSkpCiAJCWNhY2hlLT5jcnRjLmhzd19iZHdfcGl4ZWxfcmF0ZSA9IGNydGNfc3RhdGUtPnBp
eGVsX3JhdGU7CiAKIAljYWNoZS0+cGxhbmUucm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5y
b3RhdGlvbjsKQEAgLTY5Nyw4ICs2OTcsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmNfdXBkYXRl
X3N0YXRlX2NhY2hlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMgYm9vbCBpbnRl
bF9mYmNfY2FuX2FjdGl2YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCXN0
cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJpdi0+ZmJjOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2Zi
YyAqZmJjID0gJmk5MTUtPmZiYzsKIAlzdHJ1Y3QgaW50ZWxfZmJjX3N0YXRlX2NhY2hlICpjYWNo
ZSA9ICZmYmMtPnN0YXRlX2NhY2hlOwogCiAJLyogV2UgZG9uJ3QgbmVlZCB0byB1c2UgYSBzdGF0
ZSBjYWNoZSBoZXJlIHNpbmNlIHRoaXMgaW5mb3JtYXRpb24gaXMKQEAgLTc0MSwxOCArNzQxLDE4
IEBAIHN0YXRpYyBib29sIGludGVsX2ZiY19jYW5fYWN0aXZhdGUoc3RydWN0IGludGVsX2NydGMg
KmNydGMpCiAJCWZiYy0+bm9fZmJjX3JlYXNvbiA9ICJmcmFtZWJ1ZmZlciBub3QgdGlsZWQgb3Ig
ZmVuY2VkIjsKIAkJcmV0dXJuIGZhbHNlOwogCX0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8
PSA0ICYmICFJU19HNFgoZGV2X3ByaXYpICYmCisJaWYgKElOVEVMX0dFTihpOTE1KSA8PSA0ICYm
ICFJU19HNFgoaTkxNSkgJiYKIAkgICAgY2FjaGUtPnBsYW5lLnJvdGF0aW9uICE9IERSTV9NT0RF
X1JPVEFURV8wKSB7CiAJCWZiYy0+bm9fZmJjX3JlYXNvbiA9ICJyb3RhdGlvbiB1bnN1cHBvcnRl
ZCI7CiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQlpZiAoIXN0cmlkZV9pc192YWxpZChkZXZfcHJp
diwgY2FjaGUtPmZiLnN0cmlkZSkpIHsKKwlpZiAoIXN0cmlkZV9pc192YWxpZChpOTE1LCBjYWNo
ZS0+ZmIuc3RyaWRlKSkgewogCQlmYmMtPm5vX2ZiY19yZWFzb24gPSAiZnJhbWVidWZmZXIgc3Ry
aWRlIG5vdCBzdXBwb3J0ZWQiOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCi0JaWYgKCFwaXhlbF9m
b3JtYXRfaXNfdmFsaWQoZGV2X3ByaXYsIGNhY2hlLT5mYi5mb3JtYXQtPmZvcm1hdCkpIHsKKwlp
ZiAoIXBpeGVsX2Zvcm1hdF9pc192YWxpZChpOTE1LCBjYWNoZS0+ZmIuZm9ybWF0LT5mb3JtYXQp
KSB7CiAJCWZiYy0+bm9fZmJjX3JlYXNvbiA9ICJwaXhlbCBmb3JtYXQgaXMgaW52YWxpZCI7CiAJ
CXJldHVybiBmYWxzZTsKIAl9CkBAIC03NjQsOCArNzY0LDggQEAgc3RhdGljIGJvb2wgaW50ZWxf
ZmJjX2Nhbl9hY3RpdmF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAl9CiAKIAkvKiBXYUZi
Y0V4Y2VlZENkQ2xvY2tUaHJlc2hvbGQ6aHN3LGJkdyAqLwotCWlmICgoSVNfSEFTV0VMTChkZXZf
cHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkgJiYKLQkgICAgY2FjaGUtPmNydGMuaHN3
X2Jkd19waXhlbF9yYXRlID49IGRldl9wcml2LT5jZGNsay5ody5jZGNsayAqIDk1IC8gMTAwKSB7
CisJaWYgKChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FEV0VMTChpOTE1KSkgJiYKKwkgICAg
Y2FjaGUtPmNydGMuaHN3X2Jkd19waXhlbF9yYXRlID49IGk5MTUtPmNkY2xrLmh3LmNkY2xrICog
OTUgLyAxMDApIHsKIAkJZmJjLT5ub19mYmNfcmVhc29uID0gInBpeGVsIHJhdGUgaXMgdG9vIGJp
ZyI7CiAJCXJldHVybiBmYWxzZTsKIAl9CkBAIC03ODAsNyArNzgwLDcgQEAgc3RhdGljIGJvb2wg
aW50ZWxfZmJjX2Nhbl9hY3RpdmF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAkgKiB3ZSBk
aWRuJ3QgZ2V0IGFueSBpbnZhbGlkYXRlL2RlYWN0aXZhdGUgY2FsbHMsIGJ1dCB0aGlzIHdvdWxk
IHJlcXVpcmUKIAkgKiBhIGxvdCBvZiB0cmFja2luZyBqdXN0IGZvciBhIHNwZWNpZmljIGNhc2Uu
IElmIHdlIGNvbmNsdWRlIGl0J3MgYW4KIAkgKiBpbXBvcnRhbnQgY2FzZSwgd2UgY2FuIGltcGxl
bWVudCBpdCBsYXRlci4gKi8KLQlpZiAoaW50ZWxfZmJjX2NhbGN1bGF0ZV9jZmJfc2l6ZShkZXZf
cHJpdiwgJmZiYy0+c3RhdGVfY2FjaGUpID4KKwlpZiAoaW50ZWxfZmJjX2NhbGN1bGF0ZV9jZmJf
c2l6ZShpOTE1LCAmZmJjLT5zdGF0ZV9jYWNoZSkgPgogCSAgICBmYmMtPmNvbXByZXNzZWRfZmIu
c2l6ZSAqIGZiYy0+dGhyZXNob2xkKSB7CiAJCWZiYy0+bm9fZmJjX3JlYXNvbiA9ICJDRkIgcmVx
dWlyZW1lbnRzIGNoYW5nZWQiOwogCQlyZXR1cm4gZmFsc2U7CkBAIC03OTEsNyArNzkxLDcgQEAg
c3RhdGljIGJvb2wgaW50ZWxfZmJjX2Nhbl9hY3RpdmF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YykKIAkgKiBoYXZpbmcgYSBZIG9mZnNldCB0aGF0IGlzbid0IGRpdmlzaWJsZSBieSA0IGNhdXNl
cyBGSUZPIHVuZGVycnVuCiAJICogYW5kIHNjcmVlbiBmbGlja2VyLgogCSAqLwotCWlmIChJU19H
RU5fUkFOR0UoZGV2X3ByaXYsIDksIDEwKSAmJgorCWlmIChJU19HRU5fUkFOR0UoaTkxNSwgOSwg
MTApICYmCiAJICAgIChmYmMtPnN0YXRlX2NhY2hlLnBsYW5lLmFkanVzdGVkX3kgJiAzKSkgewog
CQlmYmMtPm5vX2ZiY19yZWFzb24gPSAicGxhbmUgWSBvZmZzZXQgaXMgbWlzYWxpZ25lZCI7CiAJ
CXJldHVybiBmYWxzZTsKQEAgLTgwMCwxMSArODAwLDExIEBAIHN0YXRpYyBib29sIGludGVsX2Zi
Y19jYW5fYWN0aXZhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJcmV0dXJuIHRydWU7CiB9
CiAKLXN0YXRpYyBib29sIGludGVsX2ZiY19jYW5fZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyBib29sIGludGVsX2ZiY19jYW5fZW5hYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZf
cHJpdi0+ZmJjOworCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZpOTE1LT5mYmM7CiAKLQlpZiAo
aW50ZWxfdmdwdV9hY3RpdmUoZGV2X3ByaXYpKSB7CisJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5
MTUpKSB7CiAJCWZiYy0+bm9fZmJjX3JlYXNvbiA9ICJWR1BVIGlzIGFjdGl2ZSI7CiAJCXJldHVy
biBmYWxzZTsKIAl9CkBAIC04MjUsOCArODI1LDggQEAgc3RhdGljIGJvb2wgaW50ZWxfZmJjX2Nh
bl9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogc3RhdGljIHZvaWQg
aW50ZWxfZmJjX2dldF9yZWdfcGFyYW1zKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAg
ICAgc3RydWN0IGludGVsX2ZiY19yZWdfcGFyYW1zICpwYXJhbXMpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0
IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpm
YmMgPSAmaTkxNS0+ZmJjOwogCXN0cnVjdCBpbnRlbF9mYmNfc3RhdGVfY2FjaGUgKmNhY2hlID0g
JmZiYy0+c3RhdGVfY2FjaGU7CiAKIAkvKiBTaW5jZSBhbGwgb3VyIGZpZWxkcyBhcmUgaW50ZWdl
ciB0eXBlcywgdXNlIG1lbXNldCBoZXJlIHNvIHRoZQpAQCAtODQ0LDkgKzg0NCw5IEBAIHN0YXRp
YyB2b2lkIGludGVsX2ZiY19nZXRfcmVnX3BhcmFtcyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywK
IAlwYXJhbXMtPmZiLmZvcm1hdCA9IGNhY2hlLT5mYi5mb3JtYXQ7CiAJcGFyYW1zLT5mYi5zdHJp
ZGUgPSBjYWNoZS0+ZmIuc3RyaWRlOwogCi0JcGFyYW1zLT5jZmJfc2l6ZSA9IGludGVsX2ZiY19j
YWxjdWxhdGVfY2ZiX3NpemUoZGV2X3ByaXYsIGNhY2hlKTsKKwlwYXJhbXMtPmNmYl9zaXplID0g
aW50ZWxfZmJjX2NhbGN1bGF0ZV9jZmJfc2l6ZShpOTE1LCBjYWNoZSk7CiAKLQlpZiAoSVNfR0VO
KGRldl9wcml2LCA5KSAmJiAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElTX0dFTihp
OTE1LCA5KSAmJiAhSVNfR0VNSU5JTEFLRShpOTE1KSkKIAkJcGFyYW1zLT5nZW45X3dhX2NmYl9z
dHJpZGUgPSBESVZfUk9VTkRfVVAoY2FjaGUtPnBsYW5lLnNyY193LAogCQkJCQkJMzIgKiBmYmMt
PnRocmVzaG9sZCkgKiA4OwogfQpAQCAtODU1LDExICs4NTUsMTEgQEAgdm9pZCBpbnRlbF9mYmNf
cHJlX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5m
YmM7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCWNvbnN0IGNoYXIg
KnJlYXNvbiA9ICJ1cGRhdGUgcGVuZGluZyI7CiAKLQlpZiAoIWZiY19zdXBwb3J0ZWQoZGV2X3By
aXYpKQorCWlmICghZmJjX3N1cHBvcnRlZChpOTE1KSkKIAkJcmV0dXJuOwogCiAJbXV0ZXhfbG9j
aygmZmJjLT5sb2NrKTsKQEAgLTg3NiwyMSArODc2LDIxIEBAIHZvaWQgaW50ZWxfZmJjX3ByZV91
cGRhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJZmJjLT5mbGlwX3BlbmRpbmcgPSB0cnVl
OwogCiBkZWFjdGl2YXRlOgotCWludGVsX2ZiY19kZWFjdGl2YXRlKGRldl9wcml2LCByZWFzb24p
OworCWludGVsX2ZiY19kZWFjdGl2YXRlKGk5MTUsIHJlYXNvbik7CiB1bmxvY2s6CiAJbXV0ZXhf
dW5sb2NrKCZmYmMtPmxvY2spOwogfQogCiAvKioKICAqIF9faW50ZWxfZmJjX2Rpc2FibGUgLSBk
aXNhYmxlIEZCQwotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6
IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogVGhpcyBpcyB0aGUgbG93IGxldmVsIGZ1bmN0
aW9uIHRoYXQgYWN0dWFsbHkgZGlzYWJsZXMgRkJDLiBDYWxsZXJzIHNob3VsZAogICogZ3JhYiB0
aGUgRkJDIGxvY2suCiAgKi8KLXN0YXRpYyB2b2lkIF9faW50ZWxfZmJjX2Rpc2FibGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgX19pbnRlbF9mYmNfZGlz
YWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZmJj
ICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+
ZmJjOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gZmJjLT5jcnRjOwogCiAJV0FSTl9PTigh
bXV0ZXhfaXNfbG9ja2VkKCZmYmMtPmxvY2spKTsKQEAgLTg5OSw3ICs4OTksNyBAQCBzdGF0aWMg
dm9pZCBfX2ludGVsX2ZiY19kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAogCURSTV9ERUJVR19LTVMoIkRpc2FibGluZyBGQkMgb24gcGlwZSAlY1xuIiwgcGlwZV9u
YW1lKGNydGMtPnBpcGUpKTsKIAotCV9faW50ZWxfZmJjX2NsZWFudXBfY2ZiKGRldl9wcml2KTsK
KwlfX2ludGVsX2ZiY19jbGVhbnVwX2NmYihpOTE1KTsKIAogCWZiYy0+ZW5hYmxlZCA9IGZhbHNl
OwogCWZiYy0+Y3J0YyA9IE5VTEw7CkBAIC05MDcsOCArOTA3LDggQEAgc3RhdGljIHZvaWQgX19p
bnRlbF9mYmNfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIHN0
YXRpYyB2b2lkIF9faW50ZWxfZmJjX3Bvc3RfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+
YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJpdi0+ZmJjOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJ
c3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmk5MTUtPmZiYzsKIAogCVdBUk5fT04oIW11dGV4X2lz
X2xvY2tlZCgmZmJjLT5sb2NrKSk7CiAKQEAgLTkxOSw4ICs5MTksOCBAQCBzdGF0aWMgdm9pZCBf
X2ludGVsX2ZiY19wb3N0X3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAlXQVJOX09O
KGZiYy0+YWN0aXZlKTsKIAogCWlmICghaTkxNV9tb2RwYXJhbXMuZW5hYmxlX2ZiYykgewotCQlp
bnRlbF9mYmNfZGVhY3RpdmF0ZShkZXZfcHJpdiwgImRpc2FibGVkIGF0IHJ1bnRpbWUgcGVyIG1v
ZHVsZSBwYXJhbSIpOwotCQlfX2ludGVsX2ZiY19kaXNhYmxlKGRldl9wcml2KTsKKwkJaW50ZWxf
ZmJjX2RlYWN0aXZhdGUoaTkxNSwgImRpc2FibGVkIGF0IHJ1bnRpbWUgcGVyIG1vZHVsZSBwYXJh
bSIpOworCQlfX2ludGVsX2ZiY19kaXNhYmxlKGk5MTUpOwogCiAJCXJldHVybjsKIAl9CkBAIC05
MzEsMTggKzkzMSwxOCBAQCBzdGF0aWMgdm9pZCBfX2ludGVsX2ZiY19wb3N0X3VwZGF0ZShzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAkJcmV0dXJuOwogCiAJaWYgKCFmYmMtPmJ1c3lfYml0cykg
ewotCQlpbnRlbF9mYmNfZGVhY3RpdmF0ZShkZXZfcHJpdiwgIkZCQyBlbmFibGVkIChhY3RpdmUg
b3Igc2NoZWR1bGVkKSIpOwotCQlpbnRlbF9mYmNfaHdfYWN0aXZhdGUoZGV2X3ByaXYpOworCQlp
bnRlbF9mYmNfZGVhY3RpdmF0ZShpOTE1LCAiRkJDIGVuYWJsZWQgKGFjdGl2ZSBvciBzY2hlZHVs
ZWQpIik7CisJCWludGVsX2ZiY19od19hY3RpdmF0ZShpOTE1KTsKIAl9IGVsc2UKLQkJaW50ZWxf
ZmJjX2RlYWN0aXZhdGUoZGV2X3ByaXYsICJmcm9udGJ1ZmZlciB3cml0ZSIpOworCQlpbnRlbF9m
YmNfZGVhY3RpdmF0ZShpOTE1LCAiZnJvbnRidWZmZXIgd3JpdGUiKTsKIH0KIAogdm9pZCBpbnRl
bF9mYmNfcG9zdF91cGRhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0Jc3Ry
dWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZmJj
ICpmYmMgPSAmaTkxNS0+ZmJjOwogCi0JaWYgKCFmYmNfc3VwcG9ydGVkKGRldl9wcml2KSkKKwlp
ZiAoIWZiY19zdXBwb3J0ZWQoaTkxNSkpCiAJCXJldHVybjsKIAogCW11dGV4X2xvY2soJmZiYy0+
bG9jayk7CkBAIC05NTgsMTMgKzk1OCwxMyBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2Zi
Y19nZXRfZnJvbnRidWZmZXJfYml0KHN0cnVjdCBpbnRlbF9mYmMgKmZiYykKIAkJcmV0dXJuIGZi
Yy0+cG9zc2libGVfZnJhbWVidWZmZXJfYml0czsKIH0KIAotdm9pZCBpbnRlbF9mYmNfaW52YWxp
ZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2ZiY19p
bnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICB1bnNpZ25lZCBp
bnQgZnJvbnRidWZmZXJfYml0cywKIAkJCSAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewot
CXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJpdi0+ZmJjOworCXN0cnVjdCBpbnRlbF9m
YmMgKmZiYyA9ICZpOTE1LT5mYmM7CiAKLQlpZiAoIWZiY19zdXBwb3J0ZWQoZGV2X3ByaXYpKQor
CWlmICghZmJjX3N1cHBvcnRlZChpOTE1KSkKIAkJcmV0dXJuOwogCiAJaWYgKG9yaWdpbiA9PSBP
UklHSU5fR1RUIHx8IG9yaWdpbiA9PSBPUklHSU5fRkxJUCkKQEAgLTk3NSwxNyArOTc1LDE3IEBA
IHZvaWQgaW50ZWxfZmJjX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCWZiYy0+YnVzeV9iaXRzIHw9IGludGVsX2ZiY19nZXRfZnJvbnRidWZmZXJfYml0KGZi
YykgJiBmcm9udGJ1ZmZlcl9iaXRzOwogCiAJaWYgKGZiYy0+ZW5hYmxlZCAmJiBmYmMtPmJ1c3lf
Yml0cykKLQkJaW50ZWxfZmJjX2RlYWN0aXZhdGUoZGV2X3ByaXYsICJmcm9udGJ1ZmZlciB3cml0
ZSIpOworCQlpbnRlbF9mYmNfZGVhY3RpdmF0ZShpOTE1LCAiZnJvbnRidWZmZXIgd3JpdGUiKTsK
IAogCW11dGV4X3VubG9jaygmZmJjLT5sb2NrKTsKIH0KIAotdm9pZCBpbnRlbF9mYmNfZmx1c2go
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9mYmNfZmx1c2go
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAgdW5zaWduZWQgaW50IGZyb250
YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQlzdHJ1Y3QgaW50ZWxf
ZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkx
NS0+ZmJjOwogCi0JaWYgKCFmYmNfc3VwcG9ydGVkKGRldl9wcml2KSkKKwlpZiAoIWZiY19zdXBw
b3J0ZWQoaTkxNSkpCiAJCXJldHVybjsKIAogCW11dGV4X2xvY2soJmZiYy0+bG9jayk7CkBAIC05
OTgsNyArOTk4LDcgQEAgdm9pZCBpbnRlbF9mYmNfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCWlmICghZmJjLT5idXN5X2JpdHMgJiYgZmJjLT5lbmFibGVkICYmCiAJ
ICAgIChmcm9udGJ1ZmZlcl9iaXRzICYgaW50ZWxfZmJjX2dldF9mcm9udGJ1ZmZlcl9iaXQoZmJj
KSkpIHsKIAkJaWYgKGZiYy0+YWN0aXZlKQotCQkJaW50ZWxfZmJjX3JlY29tcHJlc3MoZGV2X3By
aXYpOworCQkJaW50ZWxfZmJjX3JlY29tcHJlc3MoaTkxNSk7CiAJCWVsc2UgaWYgKCFmYmMtPmZs
aXBfcGVuZGluZykKIAkJCV9faW50ZWxfZmJjX3Bvc3RfdXBkYXRlKGZiYy0+Y3J0Yyk7CiAJfQpA
QCAtMTAwOSw3ICsxMDA5LDcgQEAgdm9pZCBpbnRlbF9mYmNfZmx1c2goc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCiAvKioKICAqIGludGVsX2ZiY19jaG9vc2VfY3J0YyAtIHNl
bGVjdCBhIENSVEMgdG8gZW5hYmxlIEZCQyBvbgotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBp
bnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAc3RhdGU6IHRoZSBh
dG9taWMgc3RhdGUgc3RydWN0dXJlCiAgKgogICogVGhpcyBmdW5jdGlvbiBsb29rcyBhdCB0aGUg
cHJvcG9zZWQgc3RhdGUgZm9yIENSVENzIGFuZCBwbGFuZXMsIHRoZW4gY2hvb3NlcwpAQCAtMTAx
NywxMiArMTAxNywxMiBAQCB2b2lkIGludGVsX2ZiY19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAgKiB0cnVlLgogICoKICAqIExhdGVyLCBpbnRlbF9mYmNfZW5hYmxl
IGlzIGdvaW5nIHRvIGxvb2sgZm9yIHN0YXRlLT5lbmFibGVfZmJjIGFuZCB0aGVuIG1heWJlCi0g
KiBlbmFibGUgRkJDIGZvciB0aGUgY2hvc2VuIENSVEMuIElmIGl0IGRvZXMsIGl0IHdpbGwgc2V0
IGRldl9wcml2LT5mYmMuY3J0Yy4KKyAqIGVuYWJsZSBGQkMgZm9yIHRoZSBjaG9zZW4gQ1JUQy4g
SWYgaXQgZG9lcywgaXQgd2lsbCBzZXQgaTkxNS0+ZmJjLmNydGMuCiAgKi8KLXZvaWQgaW50ZWxf
ZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQg
aW50ZWxfZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
ICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2Zi
YyAqZmJjID0gJmRldl9wcml2LT5mYmM7CisJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmk5MTUt
PmZiYzsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCXN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGU7CiAJYm9vbCBjcnRjX2Nob3NlbiA9IGZhbHNlOwpAQCAtMTAzNSw3
ICsxMDM1LDcgQEAgdm9pZCBpbnRlbF9mYmNfY2hvb3NlX2NydGMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCSAgICAhaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShz
dGF0ZSwgZmJjLT5jcnRjKSkKIAkJZ290byBvdXQ7CiAKLQlpZiAoIWludGVsX2ZiY19jYW5fZW5h
YmxlKGRldl9wcml2KSkKKwlpZiAoIWludGVsX2ZiY19jYW5fZW5hYmxlKGk5MTUpKQogCQlnb3Rv
IG91dDsKIAogCS8qIFNpbXBseSBjaG9vc2UgdGhlIGZpcnN0IENSVEMgdGhhdCBpcyBjb21wYXRp
YmxlIGFuZCBoYXMgYSB2aXNpYmxlCkBAIC0xMDgxLDEwICsxMDgxLDEwIEBAIHZvaWQgaW50ZWxf
ZmJjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJICAgICAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9w
cml2LT5mYmM7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCi0JaWYg
KCFmYmNfc3VwcG9ydGVkKGRldl9wcml2KSkKKwlpZiAoIWZiY19zdXBwb3J0ZWQoaTkxNSkpCiAJ
CXJldHVybjsKIAogCW11dGV4X2xvY2soJmZiYy0+bG9jayk7CkBAIC0xMTI3LDQ0ICsxMTI3LDQ0
IEBAIHZvaWQgaW50ZWxfZmJjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKICAqLwog
dm9pZCBpbnRlbF9mYmNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
LQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRl
bF9mYmMgKmZiYyA9ICZpOTE1LT5mYmM7CiAKLQlpZiAoIWZiY19zdXBwb3J0ZWQoZGV2X3ByaXYp
KQorCWlmICghZmJjX3N1cHBvcnRlZChpOTE1KSkKIAkJcmV0dXJuOwogCiAJbXV0ZXhfbG9jaygm
ZmJjLT5sb2NrKTsKIAlpZiAoZmJjLT5jcnRjID09IGNydGMpCi0JCV9faW50ZWxfZmJjX2Rpc2Fi
bGUoZGV2X3ByaXYpOworCQlfX2ludGVsX2ZiY19kaXNhYmxlKGk5MTUpOwogCW11dGV4X3VubG9j
aygmZmJjLT5sb2NrKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9mYmNfZ2xvYmFsX2Rpc2FibGUgLSBn
bG9iYWxseSBkaXNhYmxlIEZCQwotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5jZQor
ICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogVGhpcyBmdW5jdGlvbiBkaXNh
YmxlcyBGQkMgcmVnYXJkbGVzcyBvZiB3aGljaCBDUlRDIGlzIGFzc29jaWF0ZWQgd2l0aCBpdC4K
ICAqLwotdm9pZCBpbnRlbF9mYmNfZ2xvYmFsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9mYmNfZ2xvYmFsX2Rpc2FibGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2
LT5mYmM7CisJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmk5MTUtPmZiYzsKIAotCWlmICghZmJj
X3N1cHBvcnRlZChkZXZfcHJpdikpCisJaWYgKCFmYmNfc3VwcG9ydGVkKGk5MTUpKQogCQlyZXR1
cm47CiAKIAltdXRleF9sb2NrKCZmYmMtPmxvY2spOwogCWlmIChmYmMtPmVuYWJsZWQpIHsKIAkJ
V0FSTl9PTihmYmMtPmNydGMtPmFjdGl2ZSk7Ci0JCV9faW50ZWxfZmJjX2Rpc2FibGUoZGV2X3By
aXYpOworCQlfX2ludGVsX2ZiY19kaXNhYmxlKGk5MTUpOwogCX0KIAltdXRleF91bmxvY2soJmZi
Yy0+bG9jayk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2ZiY191bmRlcnJ1bl93b3JrX2ZuKHN0
cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVyX29m
KHdvcmssIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBmYmMudW5kZXJydW5fd29yayk7Ci0Jc3Ry
dWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CisJc3RydWN0IGludGVsX2ZiYyAq
ZmJjID0gJmk5MTUtPmZiYzsKIAogCW11dGV4X2xvY2soJmZiYy0+bG9jayk7CiAKQEAgLTExNzUs
NDIgKzExNzUsNDIgQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJjX3VuZGVycnVuX3dvcmtfZm4oc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCURSTV9ERUJVR19LTVMoIkRpc2FibGluZyBGQkMgZHVl
IHRvIEZJRk8gdW5kZXJydW4uXG4iKTsKIAlmYmMtPnVuZGVycnVuX2RldGVjdGVkID0gdHJ1ZTsK
IAotCWludGVsX2ZiY19kZWFjdGl2YXRlKGRldl9wcml2LCAiRklGTyB1bmRlcnJ1biIpOworCWlu
dGVsX2ZiY19kZWFjdGl2YXRlKGk5MTUsICJGSUZPIHVuZGVycnVuIik7CiBvdXQ6CiAJbXV0ZXhf
dW5sb2NrKCZmYmMtPmxvY2spOwogfQogCiAvKgogICogaW50ZWxfZmJjX3Jlc2V0X3VuZGVycnVu
IC0gcmVzZXQgRkJDIGZpZm8gdW5kZXJydW4gc3RhdHVzLgotICogQGRldl9wcml2OiBpOTE1IGRl
dmljZSBpbnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogU2Vl
IGludGVsX2ZiY19oYW5kbGVfZmlmb191bmRlcnJ1bl9pcnEoKS4gRm9yIGF1dG9tYXRlZCB0ZXN0
aW5nIHdlCiAgKiB3YW50IHRvIHJlLWVuYWJsZSBGQkMgYWZ0ZXIgYW4gdW5kZXJydW4gdG8gaW5j
cmVhc2UgdGVzdCBjb3ZlcmFnZS4KICAqLwotaW50IGludGVsX2ZiY19yZXNldF91bmRlcnJ1bihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaW50ZWxfZmJjX3Jlc2V0X3Vu
ZGVycnVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWludCByZXQ7CiAKLQlj
YW5jZWxfd29ya19zeW5jKCZkZXZfcHJpdi0+ZmJjLnVuZGVycnVuX3dvcmspOworCWNhbmNlbF93
b3JrX3N5bmMoJmk5MTUtPmZiYy51bmRlcnJ1bl93b3JrKTsKIAotCXJldCA9IG11dGV4X2xvY2tf
aW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmZiYy5sb2NrKTsKKwlyZXQgPSBtdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoJmk5MTUtPmZiYy5sb2NrKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
Ci0JaWYgKGRldl9wcml2LT5mYmMudW5kZXJydW5fZGV0ZWN0ZWQpIHsKKwlpZiAoaTkxNS0+ZmJj
LnVuZGVycnVuX2RldGVjdGVkKSB7CiAJCURSTV9ERUJVR19LTVMoIlJlLWFsbG93aW5nIEZCQyBh
ZnRlciBmaWZvIHVuZGVycnVuXG4iKTsKLQkJZGV2X3ByaXYtPmZiYy5ub19mYmNfcmVhc29uID0g
IkZJRk8gdW5kZXJydW4gY2xlYXJlZCI7CisJCWk5MTUtPmZiYy5ub19mYmNfcmVhc29uID0gIkZJ
Rk8gdW5kZXJydW4gY2xlYXJlZCI7CiAJfQogCi0JZGV2X3ByaXYtPmZiYy51bmRlcnJ1bl9kZXRl
Y3RlZCA9IGZhbHNlOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmZiYy5sb2NrKTsKKwlpOTE1
LT5mYmMudW5kZXJydW5fZGV0ZWN0ZWQgPSBmYWxzZTsKKwltdXRleF91bmxvY2soJmk5MTUtPmZi
Yy5sb2NrKTsKIAogCXJldHVybiAwOwogfQogCiAvKioKICAqIGludGVsX2ZiY19oYW5kbGVfZmlm
b191bmRlcnJ1bl9pcnEgLSBkaXNhYmxlIEZCQyB3aGVuIHdlIGdldCBhIEZJRk8gdW5kZXJydW4K
LSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmlj
ZSBpbnN0YW5jZQogICoKICAqIFdpdGhvdXQgRkJDLCBtb3N0IHVuZGVycnVucyBhcmUgaGFybWxl
c3MgYW5kIGRvbid0IHJlYWxseSBjYXVzZSB0b28gbWFueQogICogcHJvYmxlbXMsIGV4Y2VwdCBm
b3IgYW4gYW5ub3lpbmcgbWVzc2FnZSBvbiBkbWVzZy4gV2l0aCBGQkMsIHVuZGVycnVucyBjYW4K
QEAgLTEyMjIsMTEgKzEyMjIsMTEgQEAgaW50IGludGVsX2ZiY19yZXNldF91bmRlcnJ1bihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKgogICogVGhpcyBmdW5jdGlvbiBpcyBj
YWxsZWQgZnJvbSB0aGUgSVJRIGhhbmRsZXIuCiAgKi8KLXZvaWQgaW50ZWxfZmJjX2hhbmRsZV9m
aWZvX3VuZGVycnVuX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lk
IGludGVsX2ZiY19oYW5kbGVfZmlmb191bmRlcnJ1bl9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7CisJ
c3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmk5MTUtPmZiYzsKIAotCWlmICghZmJjX3N1cHBvcnRl
ZChkZXZfcHJpdikpCisJaWYgKCFmYmNfc3VwcG9ydGVkKGk5MTUpKQogCQlyZXR1cm47CiAKIAkv
KiBUaGVyZSdzIG5vIGd1YXJhbnRlZSB0aGF0IHVuZGVycnVuX2RldGVjdGVkIHdvbid0IGJlIHNl
dCB0byB0cnVlCkBAIC0xMjQzLDI0ICsxMjQzLDI0IEBAIHZvaWQgaW50ZWxfZmJjX2hhbmRsZV9m
aWZvX3VuZGVycnVuX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIC8q
KgogICogaW50ZWxfZmJjX2luaXRfcGlwZV9zdGF0ZSAtIGluaXRpYWxpemUgRkJDJ3MgQ1JUQyB2
aXNpYmlsaXR5IHRyYWNraW5nCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGluc3RhbmNlCisg
KiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqCiAgKiBUaGUgRkJDIGNvZGUgbmVlZHMg
dG8gdHJhY2sgQ1JUQyB2aXNpYmlsaXR5IHNpbmNlIHRoZSBvbGRlciBwbGF0Zm9ybXMgY2FuJ3QK
ICAqIGhhdmUgRkJDIGVuYWJsZWQgd2hpbGUgbXVsdGlwbGUgcGlwZXMgYXJlIHVzZWQuIFRoaXMg
ZnVuY3Rpb24gZG9lcyB0aGUKICAqIGluaXRpYWwgc2V0dXAgYXQgZHJpdmVyIGxvYWQgdG8gbWFr
ZSBzdXJlIEZCQyBpcyBtYXRjaGluZyB0aGUgcmVhbCBoYXJkd2FyZS4KICAqLwotdm9pZCBpbnRl
bF9mYmNfaW5pdF9waXBlX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3ZvaWQgaW50ZWxfZmJjX2luaXRfcGlwZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAogCS8qIERvbid0IGV2ZW4gYm90
aGVyIHRyYWNraW5nIGFueXRoaW5nIGlmIHdlIGRvbid0IG5lZWQuICovCi0JaWYgKCFub19mYmNf
b25fbXVsdGlwbGVfcGlwZXMoZGV2X3ByaXYpKQorCWlmICghbm9fZmJjX29uX211bHRpcGxlX3Bp
cGVzKGk5MTUpKQogCQlyZXR1cm47CiAKLQlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJpdi0+
ZHJtLCBjcnRjKQorCWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRybSwgY3J0YykKIAkJaWYg
KGludGVsX2NydGNfYWN0aXZlKGNydGMpICYmCiAJCSAgICBjcnRjLT5iYXNlLnByaW1hcnktPnN0
YXRlLT52aXNpYmxlKQotCQkJZGV2X3ByaXYtPmZiYy52aXNpYmxlX3BpcGVzX21hc2sgfD0gKDEg
PDwgY3J0Yy0+cGlwZSk7CisJCQlpOTE1LT5mYmMudmlzaWJsZV9waXBlc19tYXNrIHw9ICgxIDw8
IGNydGMtPnBpcGUpOwogfQogCiAvKgpAQCAtMTI3MiwyOSArMTI3MiwyOSBAQCB2b2lkIGludGVs
X2ZiY19pbml0X3BpcGVfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
ICogc3BhY2UgdG8gY2hhbmdlIHRoZSB2YWx1ZSBkdXJpbmcgcnVudGltZSB3aXRob3V0IHNhbml0
aXppbmcgaXQgYWdhaW4uIElHVAogICogcmVsaWVzIG9uIGJlaW5nIGFibGUgdG8gY2hhbmdlIGk5
MTUuZW5hYmxlX2ZiYyBhdCBydW50aW1lLgogICovCi1zdGF0aWMgaW50IGludGVsX3Nhbml0aXpl
X2ZiY19vcHRpb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGlu
dCBpbnRlbF9zYW5pdGl6ZV9mYmNfb3B0aW9uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewogCWlmIChpOTE1X21vZHBhcmFtcy5lbmFibGVfZmJjID49IDApCiAJCXJldHVybiAhIWk5
MTVfbW9kcGFyYW1zLmVuYWJsZV9mYmM7CiAKLQlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQorCWlm
ICghSEFTX0ZCQyhpOTE1KSkKIAkJcmV0dXJuIDA7CiAKIAkvKiBodHRwczovL2J1Z3MuZnJlZWRl
c2t0b3Aub3JnL3Nob3dfYnVnLmNnaT9pZD0xMDgwODUgKi8KLQlpZiAoSVNfR0VNSU5JTEFLRShk
ZXZfcHJpdikpCisJaWYgKElTX0dFTUlOSUxBS0UoaTkxNSkpCiAJCXJldHVybiAwOwogCi0JaWYg
KElTX0JST0FEV0VMTChkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCWlm
IChJU19CUk9BRFdFTEwoaTkxNSkgfHwgSU5URUxfR0VOKGk5MTUpID49IDkpCiAJCXJldHVybiAx
OwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBib29sIG5lZWRfZmJjX3Z0ZF93YShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBuZWVkX2ZiY192dGRfd2Eo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyogV2FGYmNUdXJuT2ZmRmJjV2hl
bkh5cGVyVmlzb3JJc1VzZWQ6c2tsLGJ4dCAqLwogCWlmIChpbnRlbF92dGRfYWN0aXZlKCkgJiYK
LQkgICAgKElTX1NLWUxBS0UoZGV2X3ByaXYpIHx8IElTX0JST1hUT04oZGV2X3ByaXYpKSkgewor
CSAgICAoSVNfU0tZTEFLRShpOTE1KSB8fCBJU19CUk9YVE9OKGk5MTUpKSkgewogCQlEUk1fSU5G
TygiRGlzYWJsaW5nIGZyYW1lYnVmZmVyIGNvbXByZXNzaW9uIChGQkMpIHRvIHByZXZlbnQgc2Ny
ZWVuIGZsaWNrZXIgd2l0aCBWVC1kIGVuYWJsZWRcbiIpOwogCQlyZXR1cm4gdHJ1ZTsKIAl9CkBA
IC0xMzA0LDM4ICsxMzA0LDM4IEBAIHN0YXRpYyBib29sIG5lZWRfZmJjX3Z0ZF93YShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIC8qKgogICogaW50ZWxfZmJjX2luaXQgLSBJ
bml0aWFsaXplIEZCQwotICogQGRldl9wcml2OiB0aGUgaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiB0
aGUgaTkxNSBkZXZpY2UKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIG1pZ2h0IGJlIGNhbGxlZCBkdXJp
bmcgUE0gaW5pdCBwcm9jZXNzLgogICovCi12b2lkIGludGVsX2ZiY19pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfZmJjX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2
LT5mYmM7CisJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmk5MTUtPmZiYzsKIAogCUlOSVRfV09S
SygmZmJjLT51bmRlcnJ1bl93b3JrLCBpbnRlbF9mYmNfdW5kZXJydW5fd29ya19mbik7CiAJbXV0
ZXhfaW5pdCgmZmJjLT5sb2NrKTsKIAlmYmMtPmVuYWJsZWQgPSBmYWxzZTsKIAlmYmMtPmFjdGl2
ZSA9IGZhbHNlOwogCi0JaWYgKG5lZWRfZmJjX3Z0ZF93YShkZXZfcHJpdikpCi0JCW1rd3JpdGVf
ZGV2aWNlX2luZm8oZGV2X3ByaXYpLT5kaXNwbGF5Lmhhc19mYmMgPSBmYWxzZTsKKwlpZiAobmVl
ZF9mYmNfdnRkX3dhKGk5MTUpKQorCQlta3dyaXRlX2RldmljZV9pbmZvKGk5MTUpLT5kaXNwbGF5
Lmhhc19mYmMgPSBmYWxzZTsKIAotCWk5MTVfbW9kcGFyYW1zLmVuYWJsZV9mYmMgPSBpbnRlbF9z
YW5pdGl6ZV9mYmNfb3B0aW9uKGRldl9wcml2KTsKKwlpOTE1X21vZHBhcmFtcy5lbmFibGVfZmJj
ID0gaW50ZWxfc2FuaXRpemVfZmJjX29wdGlvbihpOTE1KTsKIAlEUk1fREVCVUdfS01TKCJTYW5p
dGl6ZWQgZW5hYmxlX2ZiYyB2YWx1ZTogJWRcbiIsCiAJCSAgICAgIGk5MTVfbW9kcGFyYW1zLmVu
YWJsZV9mYmMpOwogCi0JaWYgKCFIQVNfRkJDKGRldl9wcml2KSkgeworCWlmICghSEFTX0ZCQyhp
OTE1KSkgewogCQlmYmMtPm5vX2ZiY19yZWFzb24gPSAidW5zdXBwb3J0ZWQgYnkgdGhpcyBjaGlw
c2V0IjsKIAkJcmV0dXJuOwogCX0KIAogCS8qIFRoaXMgdmFsdWUgd2FzIHB1bGxlZCBvdXQgb2Yg
c29tZW9uZSdzIGhhdCAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDw9IDQgJiYgIUlTX0dN
NDUoZGV2X3ByaXYpKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPD0gNCAmJiAhSVNfR000NShpOTE1
KSkKIAkJSTkxNV9XUklURShGQkNfQ09OVFJPTCwgNTAwIDw8IEZCQ19DVExfSU5URVJWQUxfU0hJ
RlQpOwogCiAJLyogV2Ugc3RpbGwgZG9uJ3QgaGF2ZSBhbnkgc29ydCBvZiBoYXJkd2FyZSBzdGF0
ZSByZWFkb3V0IGZvciBGQkMsIHNvCiAJICogZGVhY3RpdmF0ZSBpdCBpbiBjYXNlIHRoZSBCSU9T
IGFjdGl2YXRlZCBpdCB0byBtYWtlIHN1cmUgc29mdHdhcmUKIAkgKiBtYXRjaGVzIHRoZSBoYXJk
d2FyZSBzdGF0ZS4gKi8KLQlpZiAoaW50ZWxfZmJjX2h3X2lzX2FjdGl2ZShkZXZfcHJpdikpCi0J
CWludGVsX2ZiY19od19kZWFjdGl2YXRlKGRldl9wcml2KTsKKwlpZiAoaW50ZWxfZmJjX2h3X2lz
X2FjdGl2ZShpOTE1KSkKKwkJaW50ZWxfZmJjX2h3X2RlYWN0aXZhdGUoaTkxNSk7CiB9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mYmMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2ZiYy5oCmluZGV4IDUwMjcyZWRhOGQ0My4uYjdkYzZjYjQzNDk3IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mYmMuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9mYmMuaApAQCAtMTYsMjcgKzE2LDI3IEBAIHN0cnVjdCBpbnRlbF9j
cnRjOwogc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGU7
CiAKLXZvaWQgaW50ZWxfZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3ZvaWQgaW50ZWxfZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOwotYm9v
bCBpbnRlbF9mYmNfaXNfYWN0aXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7
Citib29sIGludGVsX2ZiY19pc19hY3RpdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Owogdm9pZCBpbnRlbF9mYmNfcHJlX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJ
CSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgIHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogdm9pZCBpbnRlbF9mYmNfcG9zdF91cGRhdGUo
c3RydWN0IGludGVsX2NydGMgKmNydGMpOwotdm9pZCBpbnRlbF9mYmNfaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9mYmNfaW5pdF9waXBlX3N0YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX2ZiY19pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfZmJjX2luaXRfcGlw
ZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGludGVsX2ZiY19l
bmFibGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkgICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKTsKIHZvaWQgaW50ZWxfZmJjX2Rpc2FibGUoc3RydWN0IGludGVsX2NydGMgKmNy
dGMpOwotdm9pZCBpbnRlbF9mYmNfZ2xvYmFsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfZmJjX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9mYmNfZ2xvYmFsX2Rpc2FibGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpbnRlbF9mYmNfaW52YWxpZGF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgdW5zaWduZWQgaW50IGZyb250YnVmZmVy
X2JpdHMsCiAJCQkgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbik7Ci12b2lkIGludGVsX2ZiY19m
bHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2ZiY19m
bHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgICB1bnNpZ25lZCBpbnQg
ZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKTsKLXZvaWQgaW50ZWxf
ZmJjX2NsZWFudXBfY2ZiKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lk
IGludGVsX2ZiY19oYW5kbGVfZmlmb191bmRlcnJ1bl9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKLWludCBpbnRlbF9mYmNfcmVzZXRfdW5kZXJydW4oc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfZmJjX2NsZWFudXBfY2ZiKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfZmJjX2hhbmRsZV9maWZvX3Vu
ZGVycnVuX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitpbnQgaW50ZWxfZmJj
X3Jlc2V0X3VuZGVycnVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogI2VuZGlm
IC8qIF9fSU5URUxfRkJDX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZmJkZXYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMKaW5kZXgg
MGQzYTZmYTY3NGU2Li45M2RlZTlmZjVhNTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2ZiZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYu
YwpAQCAtMTE3LDcgKzExNyw3IEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9hbGxvYyhzdHJ1Y3QgZHJt
X2ZiX2hlbHBlciAqaGVscGVyLAogCQljb250YWluZXJfb2YoaGVscGVyLCBzdHJ1Y3QgaW50ZWxf
ZmJkZXYsIGhlbHBlcik7CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CiAJc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGhlbHBlci0+ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiBtb2RlX2NtZCA9IHt9Owog
CXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJaW50IHNpemUsIHJldDsKQEAgLTE0
MSwxMCArMTQxLDEwIEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9hbGxvYyhzdHJ1Y3QgZHJtX2ZiX2hl
bHBlciAqaGVscGVyLAogCSAqIGltcG9ydGFudCBhbmQgd2Ugc2hvdWxkIHByb2JhYmx5IHVzZSB0
aGF0IHNwYWNlIHdpdGggRkJDIG9yIG90aGVyCiAJICogZmVhdHVyZXMuICovCiAJb2JqID0gTlVM
TDsKLQlpZiAoc2l6ZSAqIDIgPCBkZXZfcHJpdi0+c3RvbGVuX3VzYWJsZV9zaXplKQotCQlvYmog
PSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbihkZXZfcHJpdiwgc2l6ZSk7CisJaWYgKHNp
emUgKiAyIDwgaTkxNS0+c3RvbGVuX3VzYWJsZV9zaXplKQorCQlvYmogPSBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX3N0b2xlbihpOTE1LCBzaXplKTsKIAlpZiAob2JqID09IE5VTEwpCi0JCW9iaiA9
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oZGV2X3ByaXYsIHNpemUpOworCQlvYmogPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGk5MTUsIHNpemUpOwogCWlmIChJU19FUlIob2Jq
KSkgewogCQlEUk1fRVJST1IoImZhaWxlZCB0byBhbGxvY2F0ZSBmcmFtZWJ1ZmZlclxuIik7CiAJ
CXJldCA9IFBUUl9FUlIob2JqKTsKQEAgLTE3NCw5ICsxNzQsOSBAQCBzdGF0aWMgaW50IGludGVs
ZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJCWNvbnRhaW5lcl9vZiho
ZWxwZXIsIHN0cnVjdCBpbnRlbF9mYmRldiwgaGVscGVyKTsKIAlzdHJ1Y3QgaW50ZWxfZnJhbWVi
dWZmZXIgKmludGVsX2ZiID0gaWZiZGV2LT5mYjsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
aGVscGVyLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShkZXYpOwotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OwotCXN0
cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmZGV2X3ByaXYtPmdndHQ7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBp
OTE1LT5kcm0ucGRldjsKKwlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmk5MTUtPmdndHQ7CiAJ
Y29uc3Qgc3RydWN0IGk5MTVfZ2d0dF92aWV3IHZpZXcgPSB7CiAJCS50eXBlID0gSTkxNV9HR1RU
X1ZJRVdfTk9STUFMLAogCX07CkBAIC0yMTMsNyArMjEzLDcgQEAgc3RhdGljIGludCBpbnRlbGZi
X2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCX0KIAogCW11dGV4X2xvY2so
JmRldi0+c3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2
X3ByaXYpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAogCS8qIFBp
biB0aGUgR0dUVCB2bWEgZm9yIG91ciBhY2Nlc3MgdmlhIGluZm8tPnNjcmVlbl9iYXNlLgogCSAq
IFRoaXMgYWxzbyB2YWxpZGF0ZXMgdGhhdCBhbnkgZXhpc3RpbmcgZmIgaW5oZXJpdGVkIGZyb20g
dGhlCkBAIC0yNzIsNyArMjcyLDcgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3Qg
ZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCWlmYmRldi0+dm1hID0gdm1hOwogCWlmYmRldi0+dm1h
X2ZsYWdzID0gZmxhZ3M7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJl
Zik7CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CiAJbXV0ZXhfdW5sb2Nr
KCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJdmdhX3N3aXRjaGVyb29fY2xpZW50X2ZiX3NldChwZGV2
LCBpbmZvKTsKIAlyZXR1cm4gMDsKQEAgLTI4MCw3ICsyODAsNyBAQCBzdGF0aWMgaW50IGludGVs
ZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiBvdXRfdW5waW46CiAJaW50
ZWxfdW5waW5fZmJfdm1hKHZtYSwgZmxhZ3MpOwogb3V0X3VubG9jazoKLQlpbnRlbF9ydW50aW1l
X3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwg
d2FrZXJlZik7CiAJbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIHJl
dDsKIH0KQEAgLTQ0NywxMSArNDQ3LDExIEBAIHN0YXRpYyB2b2lkIGludGVsX2ZiZGV2X3N1c3Bl
bmRfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogaW50IGludGVsX2ZiZGV2X2lu
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2ZiZGV2ICppZmJkZXY7CiAJaW50IHJldDsK
IAotCWlmIChXQVJOX09OKCFIQVNfRElTUExBWShkZXZfcHJpdikpKQorCWlmIChXQVJOX09OKCFI
QVNfRElTUExBWShpOTE1KSkpCiAJCXJldHVybiAtRU5PREVWOwogCiAJaWZiZGV2ID0ga3phbGxv
YyhzaXplb2Yoc3RydWN0IGludGVsX2ZiZGV2KSwgR0ZQX0tFUk5FTCk7CkBAIC00NzAsOCArNDcw
LDggQEAgaW50IGludGVsX2ZiZGV2X2luaXQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJcmV0
dXJuIHJldDsKIAl9CiAKLQlkZXZfcHJpdi0+ZmJkZXYgPSBpZmJkZXY7Ci0JSU5JVF9XT1JLKCZk
ZXZfcHJpdi0+ZmJkZXZfc3VzcGVuZF93b3JrLCBpbnRlbF9mYmRldl9zdXNwZW5kX3dvcmtlcik7
CisJaTkxNS0+ZmJkZXYgPSBpZmJkZXY7CisJSU5JVF9XT1JLKCZpOTE1LT5mYmRldl9zdXNwZW5k
X3dvcmssIGludGVsX2ZiZGV2X3N1c3BlbmRfd29ya2VyKTsKIAogCWRybV9mYl9oZWxwZXJfc2lu
Z2xlX2FkZF9hbGxfY29ubmVjdG9ycygmaWZiZGV2LT5oZWxwZXIpOwogCkBAIC01MDgsMjMgKzUw
OCwyMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmRldl9zeW5jKHN0cnVjdCBpbnRlbF9mYmRldiAq
aWZiZGV2KQogCWlmYmRldi0+Y29va2llID0gMDsKIH0KIAotdm9pZCBpbnRlbF9mYmRldl91bnJl
Z2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfZmJk
ZXZfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qg
aW50ZWxfZmJkZXYgKmlmYmRldiA9IGRldl9wcml2LT5mYmRldjsKKwlzdHJ1Y3QgaW50ZWxfZmJk
ZXYgKmlmYmRldiA9IGk5MTUtPmZiZGV2OwogCiAJaWYgKCFpZmJkZXYpCiAJCXJldHVybjsKIAot
CWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5mYmRldl9zdXNwZW5kX3dvcmspOworCWNhbmNl
bF93b3JrX3N5bmMoJmk5MTUtPmZiZGV2X3N1c3BlbmRfd29yayk7CiAJaWYgKCFjdXJyZW50X2lz
X2FzeW5jKCkpCiAJCWludGVsX2ZiZGV2X3N5bmMoaWZiZGV2KTsKIAogCWRybV9mYl9oZWxwZXJf
dW5yZWdpc3Rlcl9mYmkoJmlmYmRldi0+aGVscGVyKTsKIH0KIAotdm9pZCBpbnRlbF9mYmRldl9m
aW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfZmJkZXZf
ZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZmJk
ZXYgKmlmYmRldiA9IGZldGNoX2FuZF96ZXJvKCZkZXZfcHJpdi0+ZmJkZXYpOworCXN0cnVjdCBp
bnRlbF9mYmRldiAqaWZiZGV2ID0gZmV0Y2hfYW5kX3plcm8oJmk5MTUtPmZiZGV2KTsKIAogCWlm
ICghaWZiZGV2KQogCQlyZXR1cm47CkBAIC01NTQsOCArNTU0LDggQEAgc3RhdGljIHZvaWQgaW50
ZWxfZmJkZXZfaHBkX3NldF9zdXNwZW5kKHN0cnVjdCBpbnRlbF9mYmRldiAqaWZiZGV2LCBpbnQg
c3RhdGUpCiAKIHZvaWQgaW50ZWxfZmJkZXZfc2V0X3N1c3BlbmQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgaW50IHN0YXRlLCBib29sIHN5bmNocm9ub3VzKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfZmJkZXYgKmlm
YmRldiA9IGRldl9wcml2LT5mYmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZmJkZXYgKmlmYmRldiA9IGk5MTUtPmZiZGV2
OwogCXN0cnVjdCBmYl9pbmZvICppbmZvOwogCiAJaWYgKCFpZmJkZXYgfHwgIWlmYmRldi0+dm1h
KQpAQCAtNTcyLDcgKzU3Miw3IEBAIHZvaWQgaW50ZWxfZmJkZXZfc2V0X3N1c3BlbmQoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgaW50IHN0YXRlLCBib29sIHN5bmNocm9ub3VzCiAJCSAqIG91cnNl
bHZlcywgc28gb25seSBmbHVzaCBvdXRzdGFuZGluZyB3b3JrIHVwb24gc3VzcGVuZCEKIAkJICov
CiAJCWlmIChzdGF0ZSAhPSBGQklORk9fU1RBVEVfUlVOTklORykKLQkJCWZsdXNoX3dvcmsoJmRl
dl9wcml2LT5mYmRldl9zdXNwZW5kX3dvcmspOworCQkJZmx1c2hfd29yaygmaTkxNS0+ZmJkZXZf
c3VzcGVuZF93b3JrKTsKIAogCQljb25zb2xlX2xvY2soKTsKIAl9IGVsc2UgewpAQCAtNTg2LDcg
KzU4Niw3IEBAIHZvaWQgaW50ZWxfZmJkZXZfc2V0X3N1c3BlbmQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgaW50IHN0YXRlLCBib29sIHN5bmNocm9ub3VzCiAJCQkvKiBEb24ndCBibG9jayBvdXIg
b3duIHdvcmtxdWV1ZSBhcyB0aGlzIGNhbgogCQkJICogYmUgcnVuIGluIHBhcmFsbGVsIHdpdGgg
b3RoZXIgaTkxNS5rbyB0YXNrcy4KIAkJCSAqLwotCQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYt
PmZiZGV2X3N1c3BlbmRfd29yayk7CisJCQlzY2hlZHVsZV93b3JrKCZpOTE1LT5mYmRldl9zdXNw
ZW5kX3dvcmspOwogCQkJcmV0dXJuOwogCQl9CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZmJkZXYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2
LmgKaW5kZXggZGU3Yzg0MjUwZWI1Li40ZDBjOGM4NTFhNWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfZmJkZXYuaApAQCAtMTQsOCArMTQsOCBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKICNp
ZmRlZiBDT05GSUdfRFJNX0ZCREVWX0VNVUxBVElPTgogaW50IGludGVsX2ZiZGV2X2luaXQoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldik7CiB2b2lkIGludGVsX2ZiZGV2X2luaXRpYWxfY29uZmlnX2Fz
eW5jKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwotdm9pZCBpbnRlbF9mYmRldl91bnJlZ2lzdGVy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX2ZiZGV2X2Zp
bmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfZmJkZXZf
dW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2Zi
ZGV2X2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBpbnRlbF9mYmRl
dl9zZXRfc3VzcGVuZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBpbnQgc3RhdGUsIGJvb2wgc3lu
Y2hyb25vdXMpOwogdm9pZCBpbnRlbF9mYmRldl9vdXRwdXRfcG9sbF9jaGFuZ2VkKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYpOwogdm9pZCBpbnRlbF9mYmRldl9yZXN0b3JlX21vZGUoc3RydWN0IGRy
bV9kZXZpY2UgKmRldik7CkBAIC0yOSwxMSArMjksMTEgQEAgc3RhdGljIGlubGluZSB2b2lkIGlu
dGVsX2ZiZGV2X2luaXRpYWxfY29uZmlnX2FzeW5jKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7
CiB9CiAKLXN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9mYmRldl91bnJlZ2lzdGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9mYmRl
dl91bnJlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogfQogCi1zdGF0
aWMgaW5saW5lIHZvaWQgaW50ZWxfZmJkZXZfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZmJkZXZfZmluaShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZmlmb191bmRlcnJ1bi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
Zmlmb191bmRlcnJ1bi5jCmluZGV4IDg1NDVhZDMyYmI1MC4uMDhmMDkyYWRkYWUyIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9maWZvX3VuZGVycnVuLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmlmb191bmRlcnJ1bi5jCkBAIC01MiwxNCArNTIsMTQg
QEAKIAogc3RhdGljIGJvb2wgaXZiX2Nhbl9lbmFibGVfZXJyX2ludChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAllbnVtIHBpcGUgcGlwZTsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmRldl9wcml2LT5pcnFfbG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkx
NS0+aXJxX2xvY2spOwogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgewotCQljcnRj
ID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOworCWZvcl9lYWNoX3Bp
cGUoaTkxNSwgcGlwZSkgeworCQljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoaTkxNSwg
cGlwZSk7CiAKIAkJaWYgKGNydGMtPmNwdV9maWZvX3VuZGVycnVuX2Rpc2FibGVkKQogCQkJcmV0
dXJuIGZhbHNlOwpAQCAtNzAsMTQgKzcwLDE0IEBAIHN0YXRpYyBib29sIGl2Yl9jYW5fZW5hYmxl
X2Vycl9pbnQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAogc3RhdGljIGJvb2wgY3B0X2Nhbl9l
bmFibGVfc2Vycl9pbnQoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJZW51bSBwaXBlIHBpcGU7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmNydGM7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+aXJxX2xv
Y2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsKIAotCWZvcl9lYWNo
X3BpcGUoZGV2X3ByaXYsIHBpcGUpIHsKLQkJY3J0YyA9IGludGVsX2dldF9jcnRjX2Zvcl9waXBl
KGRldl9wcml2LCBwaXBlKTsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKKwkJY3J0YyA9
IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIHBpcGUpOwogCiAJCWlmIChjcnRjLT5wY2hf
Zmlmb191bmRlcnJ1bl9kaXNhYmxlZCkKIAkJCXJldHVybiBmYWxzZTsKQEAgLTg4LDIwICs4OCwy
MCBAQCBzdGF0aWMgYm9vbCBjcHRfY2FuX2VuYWJsZV9zZXJyX2ludChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2KQogCiBzdGF0aWMgdm9pZCBpOXh4X2NoZWNrX2ZpZm9fdW5kZXJydW5zKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJaTkxNV9yZWdfdCByZWcgPSBQSVBFU1RBVChj
cnRjLT5waXBlKTsKIAl1MzIgZW5hYmxlX21hc2s7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZk
ZXZfcHJpdi0+aXJxX2xvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2Nr
KTsKIAogCWlmICgoSTkxNV9SRUFEKHJlZykgJiBQSVBFX0ZJRk9fVU5ERVJSVU5fU1RBVFVTKSA9
PSAwKQogCQlyZXR1cm47CiAKLQllbmFibGVfbWFzayA9IGk5MTVfcGlwZXN0YXRfZW5hYmxlX21h
c2soZGV2X3ByaXYsIGNydGMtPnBpcGUpOworCWVuYWJsZV9tYXNrID0gaTkxNV9waXBlc3RhdF9l
bmFibGVfbWFzayhpOTE1LCBjcnRjLT5waXBlKTsKIAlJOTE1X1dSSVRFKHJlZywgZW5hYmxlX21h
c2sgfCBQSVBFX0ZJRk9fVU5ERVJSVU5fU1RBVFVTKTsKIAlQT1NUSU5HX1JFQUQocmVnKTsKIAot
CXRyYWNlX2ludGVsX2NwdV9maWZvX3VuZGVycnVuKGRldl9wcml2LCBjcnRjLT5waXBlKTsKKwl0
cmFjZV9pbnRlbF9jcHVfZmlmb191bmRlcnJ1bihpOTE1LCBjcnRjLT5waXBlKTsKIAlEUk1fRVJS
T1IoInBpcGUgJWMgdW5kZXJydW5cbiIsIHBpcGVfbmFtZShjcnRjLT5waXBlKSk7CiB9CiAKQEAg
LTEwOSwxMyArMTA5LDEzIEBAIHN0YXRpYyB2b2lkIGk5eHhfc2V0X2ZpZm9fdW5kZXJydW5fcmVw
b3J0aW5nKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSAgICAgZW51bSBwaXBlIHBpcGUs
CiAJCQkJCSAgICAgYm9vbCBlbmFibGUsIGJvb2wgb2xkKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlpOTE1X3JlZ190IHJlZyA9IFBJUEVTVEFUKHBpcGUp
OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZpOTE1LT5pcnFfbG9jayk7CiAKIAlpZiAoZW5hYmxlKSB7Ci0JCXUzMiBl
bmFibGVfbWFzayA9IGk5MTVfcGlwZXN0YXRfZW5hYmxlX21hc2soZGV2X3ByaXYsIHBpcGUpOwor
CQl1MzIgZW5hYmxlX21hc2sgPSBpOTE1X3BpcGVzdGF0X2VuYWJsZV9tYXNrKGk5MTUsIHBpcGUp
OwogCiAJCUk5MTVfV1JJVEUocmVnLCBlbmFibGVfbWFzayB8IFBJUEVfRklGT19VTkRFUlJVTl9T
VEFUVVMpOwogCQlQT1NUSU5HX1JFQUQocmVnKTsKQEAgLTEyOCwyMyArMTI4LDIzIEBAIHN0YXRp
YyB2b2lkIGk5eHhfc2V0X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9zZXRfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmco
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkJCSBlbnVtIHBpcGUgcGlwZSwgYm9vbCBlbmFi
bGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXUzMiBi
aXQgPSAocGlwZSA9PSBQSVBFX0EpID8KIAkJREVfUElQRUFfRklGT19VTkRFUlJVTiA6IERFX1BJ
UEVCX0ZJRk9fVU5ERVJSVU47CiAKIAlpZiAoZW5hYmxlKQotCQlpbGtfZW5hYmxlX2Rpc3BsYXlf
aXJxKGRldl9wcml2LCBiaXQpOworCQlpbGtfZW5hYmxlX2Rpc3BsYXlfaXJxKGk5MTUsIGJpdCk7
CiAJZWxzZQotCQlpbGtfZGlzYWJsZV9kaXNwbGF5X2lycShkZXZfcHJpdiwgYml0KTsKKwkJaWxr
X2Rpc2FibGVfZGlzcGxheV9pcnEoaTkxNSwgYml0KTsKIH0KIAogc3RhdGljIHZvaWQgaXZ5YnJp
ZGdlX2NoZWNrX2ZpZm9fdW5kZXJydW5zKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiBlcnJfaW50ID0gSTkxNV9S
RUFEKEdFTjdfRVJSX0lOVCk7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+aXJx
X2xvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsKIAogCWlmICgo
ZXJyX2ludCAmIEVSUl9JTlRfRklGT19VTkRFUlJVTihwaXBlKSkgPT0gMCkKIAkJcmV0dXJuOwpA
QCAtMTUyLDcgKzE1Miw3IEBAIHN0YXRpYyB2b2lkIGl2eWJyaWRnZV9jaGVja19maWZvX3VuZGVy
cnVucyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAlJOTE1X1dSSVRFKEdFTjdfRVJSX0lOVCwg
RVJSX0lOVF9GSUZPX1VOREVSUlVOKHBpcGUpKTsKIAlQT1NUSU5HX1JFQUQoR0VON19FUlJfSU5U
KTsKIAotCXRyYWNlX2ludGVsX2NwdV9maWZvX3VuZGVycnVuKGRldl9wcml2LCBwaXBlKTsKKwl0
cmFjZV9pbnRlbF9jcHVfZmlmb191bmRlcnJ1bihpOTE1LCBwaXBlKTsKIAlEUk1fRVJST1IoImZp
Zm8gdW5kZXJydW4gb24gcGlwZSAlY1xuIiwgcGlwZV9uYW1lKHBpcGUpKTsKIH0KIApAQCAtMTYw
LDE2ICsxNjAsMTYgQEAgc3RhdGljIHZvaWQgaXZ5YnJpZGdlX3NldF9maWZvX3VuZGVycnVuX3Jl
cG9ydGluZyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJCQkJICBlbnVtIHBpcGUgcGlwZSwK
IAkJCQkJCSAgYm9vbCBlbmFibGUsIGJvb2wgb2xkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlpZiAoZW5hYmxlKSB7CiAJCUk5MTVfV1JJVEUoR0VON19F
UlJfSU5ULCBFUlJfSU5UX0ZJRk9fVU5ERVJSVU4ocGlwZSkpOwogCiAJCWlmICghaXZiX2Nhbl9l
bmFibGVfZXJyX2ludChkZXYpKQogCQkJcmV0dXJuOwogCi0JCWlsa19lbmFibGVfZGlzcGxheV9p
cnEoZGV2X3ByaXYsIERFX0VSUl9JTlRfSVZCKTsKKwkJaWxrX2VuYWJsZV9kaXNwbGF5X2lycShp
OTE1LCBERV9FUlJfSU5UX0lWQik7CiAJfSBlbHNlIHsKLQkJaWxrX2Rpc2FibGVfZGlzcGxheV9p
cnEoZGV2X3ByaXYsIERFX0VSUl9JTlRfSVZCKTsKKwkJaWxrX2Rpc2FibGVfZGlzcGxheV9pcnEo
aTkxNSwgREVfRVJSX0lOVF9JVkIpOwogCiAJCWlmIChvbGQgJiYKIAkJICAgIEk5MTVfUkVBRChH
RU43X0VSUl9JTlQpICYgRVJSX0lOVF9GSUZPX1VOREVSUlVOKHBpcGUpKSB7CkBAIC0xODIsMzUg
KzE4MiwzNSBAQCBzdGF0aWMgdm9pZCBpdnlicmlkZ2Vfc2V0X2ZpZm9fdW5kZXJydW5fcmVwb3J0
aW5nKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiBzdGF0aWMgdm9pZCBicm9hZHdlbGxfc2V0X2Zp
Zm9fdW5kZXJydW5fcmVwb3J0aW5nKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCQkgIGVu
dW0gcGlwZSBwaXBlLCBib29sIGVuYWJsZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGRldik7CiAKIAlpZiAoZW5hYmxlKQotCQliZHdfZW5hYmxlX3BpcGVfaXJxKGRl
dl9wcml2LCBwaXBlLCBHRU44X1BJUEVfRklGT19VTkRFUlJVTik7CisJCWJkd19lbmFibGVfcGlw
ZV9pcnEoaTkxNSwgcGlwZSwgR0VOOF9QSVBFX0ZJRk9fVU5ERVJSVU4pOwogCWVsc2UKLQkJYmR3
X2Rpc2FibGVfcGlwZV9pcnEoZGV2X3ByaXYsIHBpcGUsIEdFTjhfUElQRV9GSUZPX1VOREVSUlVO
KTsKKwkJYmR3X2Rpc2FibGVfcGlwZV9pcnEoaTkxNSwgcGlwZSwgR0VOOF9QSVBFX0ZJRk9fVU5E
RVJSVU4pOwogfQogCiBzdGF0aWMgdm9pZCBpYnhfc2V0X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5n
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSAgICBlbnVtIHBpcGUgcGNoX3RyYW5zY29k
ZXIsCiAJCQkJCSAgICBib29sIGVuYWJsZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGRldik7CiAJdTMyIGJpdCA9IChwY2hfdHJhbnNjb2RlciA9PSBQSVBFX0EpID8K
IAkJU0RFX1RSQU5TQV9GSUZPX1VOREVSIDogU0RFX1RSQU5TQl9GSUZPX1VOREVSOwogCiAJaWYg
KGVuYWJsZSkKLQkJaWJ4X2VuYWJsZV9kaXNwbGF5X2ludGVycnVwdChkZXZfcHJpdiwgYml0KTsK
KwkJaWJ4X2VuYWJsZV9kaXNwbGF5X2ludGVycnVwdChpOTE1LCBiaXQpOwogCWVsc2UKLQkJaWJ4
X2Rpc2FibGVfZGlzcGxheV9pbnRlcnJ1cHQoZGV2X3ByaXYsIGJpdCk7CisJCWlieF9kaXNhYmxl
X2Rpc3BsYXlfaW50ZXJydXB0KGk5MTUsIGJpdCk7CiB9CiAKIHN0YXRpYyB2b2lkIGNwdF9jaGVj
a19wY2hfZmlmb191bmRlcnJ1bnMoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
IAllbnVtIHBpcGUgcGNoX3RyYW5zY29kZXIgPSBjcnRjLT5waXBlOwogCXUzMiBzZXJyX2ludCA9
IEk5MTVfUkVBRChTRVJSX0lOVCk7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+
aXJxX2xvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsKIAogCWlm
ICgoc2Vycl9pbnQgJiBTRVJSX0lOVF9UUkFOU19GSUZPX1VOREVSUlVOKHBjaF90cmFuc2NvZGVy
KSkgPT0gMCkKIAkJcmV0dXJuOwpAQCAtMjE4LDcgKzIxOCw3IEBAIHN0YXRpYyB2b2lkIGNwdF9j
aGVja19wY2hfZmlmb191bmRlcnJ1bnMoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJSTkxNV9X
UklURShTRVJSX0lOVCwgU0VSUl9JTlRfVFJBTlNfRklGT19VTkRFUlJVTihwY2hfdHJhbnNjb2Rl
cikpOwogCVBPU1RJTkdfUkVBRChTRVJSX0lOVCk7CiAKLQl0cmFjZV9pbnRlbF9wY2hfZmlmb191
bmRlcnJ1bihkZXZfcHJpdiwgcGNoX3RyYW5zY29kZXIpOworCXRyYWNlX2ludGVsX3BjaF9maWZv
X3VuZGVycnVuKGk5MTUsIHBjaF90cmFuc2NvZGVyKTsKIAlEUk1fRVJST1IoInBjaCBmaWZvIHVu
ZGVycnVuIG9uIHBjaCB0cmFuc2NvZGVyICVjXG4iLAogCQkgIHBpcGVfbmFtZShwY2hfdHJhbnNj
b2RlcikpOwogfQpAQCAtMjI3LDcgKzIyNyw3IEBAIHN0YXRpYyB2b2lkIGNwdF9zZXRfZmlmb191
bmRlcnJ1bl9yZXBvcnRpbmcoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkJICAgIGVudW0g
cGlwZSBwY2hfdHJhbnNjb2RlciwKIAkJCQkJICAgIGJvb2wgZW5hYmxlLCBib29sIG9sZCkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAKIAlpZiAoZW5hYmxl
KSB7CiAJCUk5MTVfV1JJVEUoU0VSUl9JTlQsCkBAIC0yMzYsOSArMjM2LDkgQEAgc3RhdGljIHZv
aWQgY3B0X3NldF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAogCQlpZiAoIWNwdF9jYW5fZW5hYmxlX3NlcnJfaW50KGRldikpCiAJCQlyZXR1cm47CiAKLQkJ
aWJ4X2VuYWJsZV9kaXNwbGF5X2ludGVycnVwdChkZXZfcHJpdiwgU0RFX0VSUk9SX0NQVCk7CisJ
CWlieF9lbmFibGVfZGlzcGxheV9pbnRlcnJ1cHQoaTkxNSwgU0RFX0VSUk9SX0NQVCk7CiAJfSBl
bHNlIHsKLQkJaWJ4X2Rpc2FibGVfZGlzcGxheV9pbnRlcnJ1cHQoZGV2X3ByaXYsIFNERV9FUlJP
Ul9DUFQpOworCQlpYnhfZGlzYWJsZV9kaXNwbGF5X2ludGVycnVwdChpOTE1LCBTREVfRVJST1Jf
Q1BUKTsKIAogCQlpZiAob2xkICYmIEk5MTVfUkVBRChTRVJSX0lOVCkgJgogCQkgICAgU0VSUl9J
TlRfVFJBTlNfRklGT19VTkRFUlJVTihwY2hfdHJhbnNjb2RlcikpIHsKQEAgLTI1MSwyMiArMjUx
LDIyIEBAIHN0YXRpYyB2b2lkIGNwdF9zZXRfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKIHN0YXRpYyBib29sIF9faW50ZWxfc2V0X2NwdV9maWZvX3VuZGVy
cnVuX3JlcG9ydGluZyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJCQkJICAgIGVudW0gcGlw
ZSBwaXBlLCBib29sIGVuYWJsZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBpbnRlbF9nZXRf
Y3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBpbnRlbF9n
ZXRfY3J0Y19mb3JfcGlwZShpOTE1LCBwaXBlKTsKIAlib29sIG9sZDsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmRldl9wcml2LT5pcnFfbG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkx
NS0+aXJxX2xvY2spOwogCiAJb2xkID0gIWNydGMtPmNwdV9maWZvX3VuZGVycnVuX2Rpc2FibGVk
OwogCWNydGMtPmNwdV9maWZvX3VuZGVycnVuX2Rpc2FibGVkID0gIWVuYWJsZTsKIAotCWlmIChI
QVNfR01DSChkZXZfcHJpdikpCisJaWYgKEhBU19HTUNIKGk5MTUpKQogCQlpOXh4X3NldF9maWZv
X3VuZGVycnVuX3JlcG9ydGluZyhkZXYsIHBpcGUsIGVuYWJsZSwgb2xkKTsKLQllbHNlIGlmIChJ
U19HRU5fUkFOR0UoZGV2X3ByaXYsIDUsIDYpKQorCWVsc2UgaWYgKElTX0dFTl9SQU5HRShpOTE1
LCA1LCA2KSkKIAkJaXJvbmxha2Vfc2V0X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldiwgcGlw
ZSwgZW5hYmxlKTsKLQllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDcpKQorCWVsc2UgaWYgKElT
X0dFTihpOTE1LCA3KSkKIAkJaXZ5YnJpZGdlX3NldF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhk
ZXYsIHBpcGUsIGVuYWJsZSwgb2xkKTsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDgpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDgpCiAJCWJyb2Fkd2VsbF9zZXRfZmlm
b191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2LCBwaXBlLCBlbmFibGUpOwogCiAJcmV0dXJuIG9sZDsK
QEAgLTI3NCw3ICsyNzQsNyBAQCBzdGF0aWMgYm9vbCBfX2ludGVsX3NldF9jcHVfZmlmb191bmRl
cnJ1bl9yZXBvcnRpbmcoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogLyoqCiAgKiBpbnRlbF9z
ZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nIC0gc2V0IGNwdSBmaWZvIHVuZGVycnJ1biBy
ZXBvcnRpbmcgc3RhdGUKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBp
OTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICogQHBpcGU6IChDUFUpIHBpcGUgdG8gc2V0IHN0
YXRlIGZvcgogICogQGVuYWJsZTogd2hldGhlciB1bmRlcnJ1bnMgc2hvdWxkIGJlIHJlcG9ydGVk
IG9yIG5vdAogICoKQEAgLTI4OCwyMyArMjg4LDIzIEBAIHN0YXRpYyBib29sIF9faW50ZWxfc2V0
X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogICoK
ICAqIFJldHVybnMgdGhlIHByZXZpb3VzIHN0YXRlIG9mIHVuZGVycnVuIHJlcG9ydGluZy4KICAq
LwotYm9vbCBpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2Jvb2wgaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVu
X3JlcG9ydGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgZW51bSBw
aXBlIHBpcGUsIGJvb2wgZW5hYmxlKQogewogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAJYm9vbCBy
ZXQ7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBmbGFncyk7Ci0J
cmV0ID0gX19pbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKCZkZXZfcHJpdi0+
ZHJtLCBwaXBlLAorCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5pcnFfbG9jaywgZmxhZ3MpOwor
CXJldCA9IF9faW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZygmaTkxNS0+ZHJt
LCBwaXBlLAogCQkJCQkJICAgICAgZW5hYmxlKTsKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZk
ZXZfcHJpdi0+aXJxX2xvY2ssIGZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1
LT5pcnFfbG9jaywgZmxhZ3MpOwogCiAJcmV0dXJuIHJldDsKIH0KIAogLyoqCiAgKiBpbnRlbF9z
ZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nIC0gc2V0IFBDSCBmaWZvIHVuZGVycnVuIHJl
cG9ydGluZyBzdGF0ZQotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5
MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAcGNoX3RyYW5zY29kZXI6IHRoZSBQQ0ggdHJh
bnNjb2RlciAoc2FtZSBhcyBwaXBlIG9uIElWQiBhbmQgb2xkZXIpCiAgKiBAZW5hYmxlOiB3aGV0
aGVyIHVuZGVycnVucyBzaG91bGQgYmUgcmVwb3J0ZWQgb3Igbm90CiAgKgpAQCAtMzE2LDEyICsz
MTYsMTIgQEAgYm9vbCBpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqCiAgKiBSZXR1cm5zIHRoZSBwcmV2aW91
cyBzdGF0ZSBvZiB1bmRlcnJ1biByZXBvcnRpbmcuCiAgKi8KLWJvb2wgaW50ZWxfc2V0X3BjaF9m
aWZvX3VuZGVycnVuX3JlcG9ydGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Citib29sIGludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSAgIGVudW0gcGlwZSBwY2hfdHJhbnNjb2RlciwKIAkJ
CQkJICAgYm9vbCBlbmFibGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPQotCQlpbnRl
bF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGNoX3RyYW5zY29kZXIpOworCQlpbnRlbF9n
ZXRfY3J0Y19mb3JfcGlwZShpOTE1LCBwY2hfdHJhbnNjb2Rlcik7CiAJdW5zaWduZWQgbG9uZyBm
bGFnczsKIAlib29sIG9sZDsKIApAQCAtMzM0LDcxICszMzQsNzEgQEAgYm9vbCBpbnRlbF9zZXRf
cGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkgKiBjcnRjIG9uIExQVCB3b24ndCBjYXVzZSBpc3N1ZXMuCiAJICovCiAKLQlzcGlu
X2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBmbGFncyk7CisJc3Bpbl9sb2NrX2ly
cXNhdmUoJmk5MTUtPmlycV9sb2NrLCBmbGFncyk7CiAKIAlvbGQgPSAhY3J0Yy0+cGNoX2ZpZm9f
dW5kZXJydW5fZGlzYWJsZWQ7CiAJY3J0Yy0+cGNoX2ZpZm9fdW5kZXJydW5fZGlzYWJsZWQgPSAh
ZW5hYmxlOwogCi0JaWYgKEhBU19QQ0hfSUJYKGRldl9wcml2KSkKLQkJaWJ4X3NldF9maWZvX3Vu
ZGVycnVuX3JlcG9ydGluZygmZGV2X3ByaXYtPmRybSwKKwlpZiAoSEFTX1BDSF9JQlgoaTkxNSkp
CisJCWlieF9zZXRfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoJmk5MTUtPmRybSwKIAkJCQkJCXBj
aF90cmFuc2NvZGVyLAogCQkJCQkJZW5hYmxlKTsKIAllbHNlCi0JCWNwdF9zZXRfZmlmb191bmRl
cnJ1bl9yZXBvcnRpbmcoJmRldl9wcml2LT5kcm0sCisJCWNwdF9zZXRfZmlmb191bmRlcnJ1bl9y
ZXBvcnRpbmcoJmk5MTUtPmRybSwKIAkJCQkJCXBjaF90cmFuc2NvZGVyLAogCQkJCQkJZW5hYmxl
LCBvbGQpOwogCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPmlycV9sb2NrLCBm
bGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+aXJxX2xvY2ssIGZsYWdzKTsK
IAlyZXR1cm4gb2xkOwogfQogCiAvKioKICAqIGludGVsX2NwdV9maWZvX3VuZGVycnVuX2lycV9o
YW5kbGVyIC0gaGFuZGxlIENQVSBmaWZvIHVuZGVycnVuIGludGVycnVwdAotICogQGRldl9wcml2
OiBpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAg
KiBAcGlwZTogKENQVSkgcGlwZSB0byBzZXQgc3RhdGUgZm9yCiAgKgogICogVGhpcyBoYW5kbGVz
IGEgQ1BVIGZpZm8gdW5kZXJydW4gaW50ZXJydXB0LCBnZW5lcmF0aW5nIGFuIHVuZGVycnVuIHdh
cm5pbmcKICAqIGludG8gZG1lc2cgaWYgdW5kZXJydW4gcmVwb3J0aW5nIGlzIGVuYWJsZWQgYW5k
IHRoZW4gZGlzYWJsZXMgdGhlIHVuZGVycnVuCiAgKiBpbnRlcnJ1cHQgdG8gYXZvaWQgYW4gaXJx
IHN0b3JtLgogICovCi12b2lkIGludGVsX2NwdV9maWZvX3VuZGVycnVuX2lycV9oYW5kbGVyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfY3B1X2ZpZm9fdW5k
ZXJydW5faXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSBl
bnVtIHBpcGUgcGlwZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGludGVsX2dldF9j
cnRjX2Zvcl9waXBlKGRldl9wcml2LCBwaXBlKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIHBpcGUpOwogCiAJLyogV2UgbWF5IGJlIGNh
bGxlZCB0b28gZWFybHkgaW4gaW5pdCwgdGhhbmtzIEJJT1MhICovCiAJaWYgKGNydGMgPT0gTlVM
TCkKIAkJcmV0dXJuOwogCiAJLyogR01DSCBjYW4ndCBkaXNhYmxlIGZpZm8gdW5kZXJydW5zLCBm
aWx0ZXIgdGhlbS4gKi8KLQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmCisJaWYgKEhBU19HTUNI
KGk5MTUpICYmCiAJICAgIGNydGMtPmNwdV9maWZvX3VuZGVycnVuX2Rpc2FibGVkKQogCQlyZXR1
cm47CiAKLQlpZiAoaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJp
diwgcGlwZSwgZmFsc2UpKSB7Ci0JCXRyYWNlX2ludGVsX2NwdV9maWZvX3VuZGVycnVuKGRldl9w
cml2LCBwaXBlKTsKKwlpZiAoaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhp
OTE1LCBwaXBlLCBmYWxzZSkpIHsKKwkJdHJhY2VfaW50ZWxfY3B1X2ZpZm9fdW5kZXJydW4oaTkx
NSwgcGlwZSk7CiAJCURSTV9FUlJPUigiQ1BVIHBpcGUgJWMgRklGTyB1bmRlcnJ1blxuIiwKIAkJ
CSAgcGlwZV9uYW1lKHBpcGUpKTsKIAl9CiAKLQlpbnRlbF9mYmNfaGFuZGxlX2ZpZm9fdW5kZXJy
dW5faXJxKGRldl9wcml2KTsKKwlpbnRlbF9mYmNfaGFuZGxlX2ZpZm9fdW5kZXJydW5faXJxKGk5
MTUpOwogfQogCiAvKioKICAqIGludGVsX3BjaF9maWZvX3VuZGVycnVuX2lycV9oYW5kbGVyIC0g
aGFuZGxlIFBDSCBmaWZvIHVuZGVycnVuIGludGVycnVwdAotICogQGRldl9wcml2OiBpOTE1IGRl
dmljZSBpbnN0YW5jZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAcGNoX3Ry
YW5zY29kZXI6IHRoZSBQQ0ggdHJhbnNjb2RlciAoc2FtZSBhcyBwaXBlIG9uIElWQiBhbmQgb2xk
ZXIpCiAgKgogICogVGhpcyBoYW5kbGVzIGEgUENIIGZpZm8gdW5kZXJydW4gaW50ZXJydXB0LCBn
ZW5lcmF0aW5nIGFuIHVuZGVycnVuIHdhcm5pbmcKICAqIGludG8gZG1lc2cgaWYgdW5kZXJydW4g
cmVwb3J0aW5nIGlzIGVuYWJsZWQgYW5kIHRoZW4gZGlzYWJsZXMgdGhlIHVuZGVycnVuCiAgKiBp
bnRlcnJ1cHQgdG8gYXZvaWQgYW4gaXJxIHN0b3JtLgogICovCi12b2lkIGludGVsX3BjaF9maWZv
X3VuZGVycnVuX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3ZvaWQgaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW5faXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSBlbnVtIHBpcGUgcGNoX3RyYW5zY29kZXIpCiB7Ci0JaWYg
KGludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBjaF90cmFu
c2NvZGVyLAorCWlmIChpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUs
IHBjaF90cmFuc2NvZGVyLAogCQkJCQkJICBmYWxzZSkpIHsKLQkJdHJhY2VfaW50ZWxfcGNoX2Zp
Zm9fdW5kZXJydW4oZGV2X3ByaXYsIHBjaF90cmFuc2NvZGVyKTsKKwkJdHJhY2VfaW50ZWxfcGNo
X2ZpZm9fdW5kZXJydW4oaTkxNSwgcGNoX3RyYW5zY29kZXIpOwogCQlEUk1fRVJST1IoIlBDSCB0
cmFuc2NvZGVyICVjIEZJRk8gdW5kZXJydW5cbiIsCiAJCQkgIHBpcGVfbmFtZShwY2hfdHJhbnNj
b2RlcikpOwogCX0KQEAgLTQwNiw1MyArNDA2LDUzIEBAIHZvaWQgaW50ZWxfcGNoX2ZpZm9fdW5k
ZXJydW5faXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAv
KioKICAqIGludGVsX2NoZWNrX2NwdV9maWZvX3VuZGVycnVucyAtIGNoZWNrIGZvciBDUFUgZmlm
byB1bmRlcnJ1bnMgaW1tZWRpYXRlbHkKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFu
Y2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAqIENoZWNrIGZvciBDUFUg
ZmlmbyB1bmRlcnJ1bnMgaW1tZWRpYXRlbHkuIFVzZWZ1bCBvbiBJVkIvSFNXIHdoZXJlIHRoZSBz
aGFyZWQKICAqIGVycm9yIGludGVycnVwdCBtYXkgaGF2ZSBiZWVuIGRpc2FibGVkLCBhbmQgc28g
Q1BVIGZpZm8gdW5kZXJydW5zIHdvbid0CiAgKiBuZWNlc3NhcmlseSByYWlzZSBhbiBpbnRlcnJ1
cHQsIGFuZCBvbiBHTUNIIHBsYXRmb3JtcyB3aGVyZSB1bmRlcnJ1bnMgbmV2ZXIKICAqIHJhaXNl
IGFuIGludGVycnVwdC4KICAqLwotdm9pZCBpbnRlbF9jaGVja19jcHVfZmlmb191bmRlcnJ1bnMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9jaGVja19jcHVf
Zmlmb191bmRlcnJ1bnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGM7CiAKLQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2sp
OworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAotCWZvcl9lYWNoX2ludGVsX2Ny
dGMoJmRldl9wcml2LT5kcm0sIGNydGMpIHsKKwlmb3JfZWFjaF9pbnRlbF9jcnRjKCZpOTE1LT5k
cm0sIGNydGMpIHsKIAkJaWYgKGNydGMtPmNwdV9maWZvX3VuZGVycnVuX2Rpc2FibGVkKQogCQkJ
Y29udGludWU7CiAKLQkJaWYgKEhBU19HTUNIKGRldl9wcml2KSkKKwkJaWYgKEhBU19HTUNIKGk5
MTUpKQogCQkJaTl4eF9jaGVja19maWZvX3VuZGVycnVucyhjcnRjKTsKLQkJZWxzZSBpZiAoSVNf
R0VOKGRldl9wcml2LCA3KSkKKwkJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDcpKQogCQkJaXZ5YnJp
ZGdlX2NoZWNrX2ZpZm9fdW5kZXJydW5zKGNydGMpOwogCX0KIAotCXNwaW5fdW5sb2NrX2lycSgm
ZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsK
IH0KIAogLyoqCiAgKiBpbnRlbF9jaGVja19wY2hfZmlmb191bmRlcnJ1bnMgLSBjaGVjayBmb3Ig
UENIIGZpZm8gdW5kZXJydW5zIGltbWVkaWF0ZWx5Ci0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNl
IGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqCiAgKiBDaGVjayBm
b3IgUENIIGZpZm8gdW5kZXJydW5zIGltbWVkaWF0ZWx5LiBVc2VmdWwgb24gQ1BUL1BQVCB3aGVy
ZSB0aGUgc2hhcmVkCiAgKiBlcnJvciBpbnRlcnJ1cHQgbWF5IGhhdmUgYmVlbiBkaXNhYmxlZCwg
YW5kIHNvIFBDSCBmaWZvIHVuZGVycnVucyB3b24ndAogICogbmVjZXNzYXJpbHkgcmFpc2UgYW4g
aW50ZXJydXB0LgogICovCi12b2lkIGludGVsX2NoZWNrX3BjaF9maWZvX3VuZGVycnVucyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2NoZWNrX3BjaF9maWZv
X3VuZGVycnVucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YzsKIAotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJ
c3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCi0JZm9yX2VhY2hfaW50ZWxfY3J0Yygm
ZGV2X3ByaXYtPmRybSwgY3J0YykgeworCWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRybSwg
Y3J0YykgewogCQlpZiAoY3J0Yy0+cGNoX2ZpZm9fdW5kZXJydW5fZGlzYWJsZWQpCiAJCQljb250
aW51ZTsKIAotCQlpZiAoSEFTX1BDSF9DUFQoZGV2X3ByaXYpKQorCQlpZiAoSEFTX1BDSF9DUFQo
aTkxNSkpCiAJCQljcHRfY2hlY2tfcGNoX2ZpZm9fdW5kZXJydW5zKGNydGMpOwogCX0KIAotCXNw
aW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX3VubG9ja19pcnEoJmk5
MTUtPmlycV9sb2NrKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2ZpZm9fdW5kZXJydW4uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZpZm9fdW5kZXJy
dW4uaAppbmRleCBlMDRmMjJhYzFmNDkuLjI5MDkwOWE2N2RlOCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZmlmb191bmRlcnJ1bi5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2ZpZm9fdW5kZXJydW4uaApAQCAtMTIsMTYgKzEyLDE2IEBACiAKIHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlOwogCi1ib29sIGludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9y
ZXBvcnRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorYm9vbCBpbnRlbF9z
ZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCQkgICBlbnVtIHBpcGUgcGlwZSwgYm9vbCBlbmFibGUpOwotYm9vbCBpbnRlbF9z
ZXRfcGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK2Jvb2wgaW50ZWxfc2V0X3BjaF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgZW51bSBwaXBlIHBjaF90cmFuc2Nv
ZGVyLAogCQkJCQkgICBib29sIGVuYWJsZSk7Ci12b2lkIGludGVsX2NwdV9maWZvX3VuZGVycnVu
X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50
ZWxfY3B1X2ZpZm9fdW5kZXJydW5faXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkJCSBlbnVtIHBpcGUgcGlwZSk7Ci12b2lkIGludGVsX3BjaF9maWZvX3VuZGVy
cnVuX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQg
aW50ZWxfcGNoX2ZpZm9fdW5kZXJydW5faXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJCSBlbnVtIHBpcGUgcGNoX3RyYW5zY29kZXIpOwotdm9pZCBpbnRlbF9j
aGVja19jcHVfZmlmb191bmRlcnJ1bnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KTsKLXZvaWQgaW50ZWxfY2hlY2tfcGNoX2ZpZm9fdW5kZXJydW5zKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX2NoZWNrX2NwdV9maWZvX3VuZGVycnVucyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2NoZWNrX3BjaF9maWZv
X3VuZGVycnVucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZiAvKiBf
X0lOVEVMX0ZJRk9fVU5ERVJSVU5fSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9mcm9udGJ1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZnJv
bnRidWZmZXIuYwppbmRleCBkNjAzNmI5YWQxNmEuLjE2MTEzOWRlM2YyOCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9mcm9udGJ1ZmZlci5jCkBAIC02NiwyNCArNjYsMjQgQEAgdm9pZCBf
X2ludGVsX2ZiX29ial9pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAJCQkgICAgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luLAogCQkJICAgICAgIHVuc2lnbmVk
IGludCBmcm9udGJ1ZmZlcl9iaXRzKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwogCiAJaWYgKG9yaWdpbiA9PSBPUklHSU5f
Q1MpIHsKLQkJc3Bpbl9sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7Ci0JCWRldl9w
cml2LT5mYl90cmFja2luZy5idXN5X2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKLQkJZGV2X3By
aXYtPmZiX3RyYWNraW5nLmZsaXBfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKLQkJc3Bpbl91
bmxvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKKwkJc3Bpbl9sb2NrKCZpOTE1LT5m
Yl90cmFja2luZy5sb2NrKTsKKwkJaTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzIHw9IGZyb250
YnVmZmVyX2JpdHM7CisJCWk5MTUtPmZiX3RyYWNraW5nLmZsaXBfYml0cyAmPSB+ZnJvbnRidWZm
ZXJfYml0czsKKwkJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwogCX0KIAog
CW1pZ2h0X3NsZWVwKCk7Ci0JaW50ZWxfcHNyX2ludmFsaWRhdGUoZGV2X3ByaXYsIGZyb250YnVm
ZmVyX2JpdHMsIG9yaWdpbik7Ci0JaW50ZWxfZWRwX2RycnNfaW52YWxpZGF0ZShkZXZfcHJpdiwg
ZnJvbnRidWZmZXJfYml0cyk7Ci0JaW50ZWxfZmJjX2ludmFsaWRhdGUoZGV2X3ByaXYsIGZyb250
YnVmZmVyX2JpdHMsIG9yaWdpbik7CisJaW50ZWxfcHNyX2ludmFsaWRhdGUoaTkxNSwgZnJvbnRi
dWZmZXJfYml0cywgb3JpZ2luKTsKKwlpbnRlbF9lZHBfZHJyc19pbnZhbGlkYXRlKGk5MTUsIGZy
b250YnVmZmVyX2JpdHMpOworCWludGVsX2ZiY19pbnZhbGlkYXRlKGk5MTUsIGZyb250YnVmZmVy
X2JpdHMsIG9yaWdpbik7CiB9CiAKIC8qKgogICogaW50ZWxfZnJvbnRidWZmZXJfZmx1c2ggLSBm
bHVzaCBmcm9udGJ1ZmZlcgotICogQGRldl9wcml2OiBpOTE1IGRldmljZQorICogQGk5MTU6IGk5
MTUgZGV2aWNlCiAgKiBAZnJvbnRidWZmZXJfYml0czogZnJvbnRidWZmZXIgcGxhbmUgdHJhY2tp
bmcgYml0cwogICogQG9yaWdpbjogd2hpY2ggb3BlcmF0aW9uIGNhdXNlZCB0aGUgZmx1c2gKICAq
CkBAIC05Myw0NSArOTMsNDUgQEAgdm9pZCBfX2ludGVsX2ZiX29ial9pbnZhbGlkYXRlKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAgKgogICogQ2FuIGJlIGNhbGxlZCB3aXRob3V0
IGFueSBsb2NrcyBoZWxkLgogICovCi1zdGF0aWMgdm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbHVz
aChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRlbF9m
cm9udGJ1ZmZlcl9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAg
dW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywKIAkJCQkgICAgZW51bSBmYl9vcF9vcmlnaW4gb3Jp
Z2luKQogewogCS8qIERlbGF5IGZsdXNoaW5nIHdoZW4gcmluZ3MgYXJlIHN0aWxsIGJ1c3kuKi8K
LQlzcGluX2xvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKLQlmcm9udGJ1ZmZlcl9i
aXRzICY9IH5kZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzOwotCXNwaW5fdW5sb2NrKCZk
ZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7CisJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2lu
Zy5sb2NrKTsKKwlmcm9udGJ1ZmZlcl9iaXRzICY9IH5pOTE1LT5mYl90cmFja2luZy5idXN5X2Jp
dHM7CisJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwogCiAJaWYgKCFmcm9u
dGJ1ZmZlcl9iaXRzKQogCQlyZXR1cm47CiAKIAltaWdodF9zbGVlcCgpOwotCWludGVsX2VkcF9k
cnJzX2ZsdXNoKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzKTsKLQlpbnRlbF9wc3JfZmx1c2go
ZGV2X3ByaXYsIGZyb250YnVmZmVyX2JpdHMsIG9yaWdpbik7Ci0JaW50ZWxfZmJjX2ZsdXNoKGRl
dl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOworCWludGVsX2VkcF9kcnJzX2ZsdXNo
KGk5MTUsIGZyb250YnVmZmVyX2JpdHMpOworCWludGVsX3Bzcl9mbHVzaChpOTE1LCBmcm9udGJ1
ZmZlcl9iaXRzLCBvcmlnaW4pOworCWludGVsX2ZiY19mbHVzaChpOTE1LCBmcm9udGJ1ZmZlcl9i
aXRzLCBvcmlnaW4pOwogfQogCiB2b2lkIF9faW50ZWxfZmJfb2JqX2ZsdXNoKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbiwKIAkJ
CSAgdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CiAKIAlpZiAob3JpZ2lu
ID09IE9SSUdJTl9DUykgewotCQlzcGluX2xvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2Nr
KTsKKwkJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKIAkJLyogRmlsdGVyIG91
dCBuZXcgYml0cyBzaW5jZSByZW5kZXJpbmcgc3RhcnRlZC4gKi8KLQkJZnJvbnRidWZmZXJfYml0
cyAmPSBkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzOwotCQlkZXZfcHJpdi0+ZmJfdHJh
Y2tpbmcuYnVzeV9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwotCQlzcGluX3VubG9jaygmZGV2
X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOworCQlmcm9udGJ1ZmZlcl9iaXRzICY9IGk5MTUtPmZi
X3RyYWNraW5nLmJ1c3lfYml0czsKKwkJaTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzICY9IH5m
cm9udGJ1ZmZlcl9iaXRzOworCQlzcGluX3VubG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7
CiAJfQogCiAJaWYgKGZyb250YnVmZmVyX2JpdHMpCi0JCWludGVsX2Zyb250YnVmZmVyX2ZsdXNo
KGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOworCQlpbnRlbF9mcm9udGJ1ZmZl
cl9mbHVzaChpOTE1LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOwogfQogCiAvKioKICAqIGlu
dGVsX2Zyb250YnVmZmVyX2ZsaXBfcHJlcGFyZSAtIHByZXBhcmUgYXN5bmNocm9ub3VzIGZyb250
YnVmZmVyIGZsaXAKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRl
dmljZQogICogQGZyb250YnVmZmVyX2JpdHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJp
dHMKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGdldHMgY2FsbGVkIGFmdGVyIHNjaGVkdWxpbmcgYSBm
bGlwIG9uIEBvYmouIFRoZSBhY3R1YWwKQEAgLTE0MSwxOSArMTQxLDE5IEBAIHZvaWQgX19pbnRl
bF9mYl9vYmpfZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKICAqCiAgKiBD
YW4gYmUgY2FsbGVkIHdpdGhvdXQgYW55IGxvY2tzIGhlbGQuCiAgKi8KLXZvaWQgaW50ZWxfZnJv
bnRidWZmZXJfZmxpcF9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3ZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJCSAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzKQogewotCXNwaW5f
bG9jaygmZGV2X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOwotCWRldl9wcml2LT5mYl90cmFja2lu
Zy5mbGlwX2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKKwlzcGluX2xvY2soJmk5MTUtPmZiX3Ry
YWNraW5nLmxvY2spOworCWk5MTUtPmZiX3RyYWNraW5nLmZsaXBfYml0cyB8PSBmcm9udGJ1ZmZl
cl9iaXRzOwogCS8qIFJlbW92ZSBzdGFsZSBidXN5IGJpdHMgZHVlIHRvIHRoZSBvbGQgYnVmZmVy
LiAqLwotCWRldl9wcml2LT5mYl90cmFja2luZy5idXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2Jp
dHM7Ci0Jc3Bpbl91bmxvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKKwlpOTE1LT5m
Yl90cmFja2luZy5idXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7CisJc3Bpbl91bmxvY2so
Jmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwogfQogCiAvKioKICAqIGludGVsX2Zyb250YnVmZmVy
X2ZsaXBfY29tcGxldGUgLSBjb21wbGV0ZSBhc3luY2hyb25vdXMgZnJvbnRidWZmZXIgZmxpcAot
ICogQGRldl9wcml2OiBpOTE1IGRldmljZQorICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKiBAZnJv
bnRidWZmZXJfYml0czogZnJvbnRidWZmZXIgcGxhbmUgdHJhY2tpbmcgYml0cwogICoKICAqIFRo
aXMgZnVuY3Rpb24gZ2V0cyBjYWxsZWQgYWZ0ZXIgdGhlIGZsaXAgaGFzIGJlZW4gbGF0Y2hlZCBh
bmQgd2lsbCBjb21wbGV0ZQpAQCAtMTYxLDIzICsxNjEsMjMgQEAgdm9pZCBpbnRlbF9mcm9udGJ1
ZmZlcl9mbGlwX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICoK
ICAqIENhbiBiZSBjYWxsZWQgd2l0aG91dCBhbnkgbG9ja3MgaGVsZC4KICAqLwotdm9pZCBpbnRl
bF9mcm9udGJ1ZmZlcl9mbGlwX2NvbXBsZXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3ZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9jb21wbGV0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMpCiB7
Ci0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7CisJc3Bpbl9sb2NrKCZp
OTE1LT5mYl90cmFja2luZy5sb2NrKTsKIAkvKiBNYXNrIGFueSBjYW5jZWxsZWQgZmxpcHMuICov
Ci0JZnJvbnRidWZmZXJfYml0cyAmPSBkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuZmxpcF9iaXRzOwot
CWRldl9wcml2LT5mYl90cmFja2luZy5mbGlwX2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7Ci0J
c3Bpbl91bmxvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKKwlmcm9udGJ1ZmZlcl9i
aXRzICY9IGk5MTUtPmZiX3RyYWNraW5nLmZsaXBfYml0czsKKwlpOTE1LT5mYl90cmFja2luZy5m
bGlwX2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7CisJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3Ry
YWNraW5nLmxvY2spOwogCiAJaWYgKGZyb250YnVmZmVyX2JpdHMpCi0JCWludGVsX2Zyb250YnVm
ZmVyX2ZsdXNoKGRldl9wcml2LAorCQlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChpOTE1LAogCQkJ
CQlmcm9udGJ1ZmZlcl9iaXRzLCBPUklHSU5fRkxJUCk7CiB9CiAKIC8qKgogICogaW50ZWxfZnJv
bnRidWZmZXJfZmxpcCAtIHN5bmNocm9ub3VzIGZyb250YnVmZmVyIGZsaXAKLSAqIEBkZXZfcHJp
djogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICogQGZyb250YnVmZmVyX2Jp
dHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJpdHMKICAqCiAgKiBUaGlzIGZ1bmN0aW9u
IGdldHMgY2FsbGVkIGFmdGVyIHNjaGVkdWxpbmcgYSBmbGlwIG9uIEBvYmouIFRoaXMgaXMgZm9y
CkBAIC0xODYsMTMgKzE4NiwxMyBAQCB2b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfY29tcGxl
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICoKICAqIENhbiBiZSBjYWxs
ZWQgd2l0aG91dCBhbnkgbG9ja3MgaGVsZC4KICAqLwotdm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9m
bGlwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfZnJvbnRi
dWZmZXJfZmxpcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICB1bnNpZ25l
ZCBmcm9udGJ1ZmZlcl9iaXRzKQogewotCXNwaW5fbG9jaygmZGV2X3ByaXYtPmZiX3RyYWNraW5n
LmxvY2spOworCXNwaW5fbG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CiAJLyogUmVtb3Zl
IHN0YWxlIGJ1c3kgYml0cyBkdWUgdG8gdGhlIG9sZCBidWZmZXIuICovCi0JZGV2X3ByaXYtPmZi
X3RyYWNraW5nLmJ1c3lfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKLQlzcGluX3VubG9jaygm
ZGV2X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOworCWk5MTUtPmZiX3RyYWNraW5nLmJ1c3lfYml0
cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKKwlzcGluX3VubG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcu
bG9jayk7CiAKLQlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChkZXZfcHJpdiwgZnJvbnRidWZmZXJf
Yml0cywgT1JJR0lOX0ZMSVApOworCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKGk5MTUsIGZyb250
YnVmZmVyX2JpdHMsIE9SSUdJTl9GTElQKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2Zyb250YnVmZmVyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9m
cm9udGJ1ZmZlci5oCmluZGV4IDU3MjczMjBjODA4NC4uNTVjNDJlZmVlN2NlIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mcm9udGJ1ZmZlci5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2Zyb250YnVmZmVyLmgKQEAgLTM3LDExICszNywxMSBAQCBlbnVt
IGZiX29wX29yaWdpbiB7CiAJT1JJR0lOX0RJUlRZRkIsCiB9OwogCi12b2lkIGludGVsX2Zyb250
YnVmZmVyX2ZsaXBfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2
b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cyk7Ci12b2lkIGludGVs
X2Zyb250YnVmZmVyX2ZsaXBfY29tcGxldGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAordm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwX2NvbXBsZXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cyk7Ci12
b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAordm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJICAgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMpOwogCiB2b2lkIF9faW50
ZWxfZmJfb2JqX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2dtYnVzLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9nbWJ1cy5jCmluZGV4IGFhODhlNmU3Y2M2NS4uZjFiOTg0NGI1OTFl
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9nbWJ1cy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2dtYnVzLmMKQEAgLTg5LDQyICs4OSw0MiBAQCBzdGF0
aWMgY29uc3Qgc3RydWN0IGdtYnVzX3BpbiBnbWJ1c19waW5zX2ljcFtdID0gewogfTsKIAogLyog
cGluIGlzIGV4cGVjdGVkIHRvIGJlIHZhbGlkICovCi1zdGF0aWMgY29uc3Qgc3RydWN0IGdtYnVz
X3BpbiAqZ2V0X2dtYnVzX3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgY29uc3Qgc3RydWN0IGdtYnVzX3BpbiAqZ2V0X2dtYnVzX3BpbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgICB1bnNpZ25lZCBpbnQgcGluKQogewotCWlmIChI
QVNfUENIX0lDUChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfSUNQKGk5MTUpKQogCQlyZXR1cm4g
JmdtYnVzX3BpbnNfaWNwW3Bpbl07Ci0JZWxzZSBpZiAoSEFTX1BDSF9DTlAoZGV2X3ByaXYpKQor
CWVsc2UgaWYgKEhBU19QQ0hfQ05QKGk5MTUpKQogCQlyZXR1cm4gJmdtYnVzX3BpbnNfY25wW3Bp
bl07Ci0JZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfR0VOOV9M
UChpOTE1KSkKIAkJcmV0dXJuICZnbWJ1c19waW5zX2J4dFtwaW5dOwotCWVsc2UgaWYgKElTX0dF
TjlfQkMoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0dFTjlfQkMoaTkxNSkpCiAJCXJldHVybiAm
Z21idXNfcGluc19za2xbcGluXTsKLQllbHNlIGlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQor
CWVsc2UgaWYgKElTX0JST0FEV0VMTChpOTE1KSkKIAkJcmV0dXJuICZnbWJ1c19waW5zX2Jkd1tw
aW5dOwogCWVsc2UKIAkJcmV0dXJuICZnbWJ1c19waW5zW3Bpbl07CiB9CiAKLWJvb2wgaW50ZWxf
Z21idXNfaXNfdmFsaWRfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2Jv
b2wgaW50ZWxfZ21idXNfaXNfdmFsaWRfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICAgICAgdW5zaWduZWQgaW50IHBpbikKIHsKIAl1bnNpZ25lZCBpbnQgc2l6ZTsKIAot
CWlmIChIQVNfUENIX0lDUChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfSUNQKGk5MTUpKQogCQlz
aXplID0gQVJSQVlfU0laRShnbWJ1c19waW5zX2ljcCk7Ci0JZWxzZSBpZiAoSEFTX1BDSF9DTlAo
ZGV2X3ByaXYpKQorCWVsc2UgaWYgKEhBU19QQ0hfQ05QKGk5MTUpKQogCQlzaXplID0gQVJSQVlf
U0laRShnbWJ1c19waW5zX2NucCk7Ci0JZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCisJ
ZWxzZSBpZiAoSVNfR0VOOV9MUChpOTE1KSkKIAkJc2l6ZSA9IEFSUkFZX1NJWkUoZ21idXNfcGlu
c19ieHQpOwotCWVsc2UgaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0dF
TjlfQkMoaTkxNSkpCiAJCXNpemUgPSBBUlJBWV9TSVpFKGdtYnVzX3BpbnNfc2tsKTsKLQllbHNl
IGlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCWVsc2UgaWYgKElTX0JST0FEV0VMTChpOTE1
KSkKIAkJc2l6ZSA9IEFSUkFZX1NJWkUoZ21idXNfcGluc19iZHcpOwogCWVsc2UKIAkJc2l6ZSA9
IEFSUkFZX1NJWkUoZ21idXNfcGlucyk7CiAKLQlyZXR1cm4gcGluIDwgc2l6ZSAmJiBnZXRfZ21i
dXNfcGluKGRldl9wcml2LCBwaW4pLT5uYW1lOworCXJldHVybiBwaW4gPCBzaXplICYmIGdldF9n
bWJ1c19waW4oaTkxNSwgcGluKS0+bmFtZTsKIH0KIAogLyogSW50ZWwgR1BJTyBhY2Nlc3MgZnVu
Y3Rpb25zICovCkBAIC0xMzgsMTMgKzEzOCwxMyBAQCB0b19pbnRlbF9nbWJ1cyhzdHJ1Y3QgaTJj
X2FkYXB0ZXIgKmkyYykKIH0KIAogdm9pZAotaW50ZWxfZ21idXNfcmVzZXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50ZWxfZ21idXNfcmVzZXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJSTkxNV9XUklURShHTUJVUzAsIDApOwogCUk5MTVfV1JJVEUo
R01CVVM0LCAwKTsKIH0KIAotc3RhdGljIHZvaWQgcG52X2dtYnVzX2Nsb2NrX2dhdGluZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBwbnZfZ21idXNfY2xv
Y2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgIGJvb2wgZW5h
YmxlKQogewogCXUzMiB2YWw7CkBAIC0xNTgsNyArMTU4LDcgQEAgc3RhdGljIHZvaWQgcG52X2dt
YnVzX2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJSTkx
NV9XUklURShEU1BDTEtfR0FURV9ELCB2YWwpOwogfQogCi1zdGF0aWMgdm9pZCBwY2hfZ21idXNf
Y2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2
b2lkIHBjaF9nbWJ1c19jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkJICAgYm9vbCBlbmFibGUpCiB7CiAJdTMyIHZhbDsKQEAgLTE3MSw3ICsxNzEsNyBAQCBz
dGF0aWMgdm9pZCBwY2hfZ21idXNfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlJOTE1X1dSSVRFKFNPVVRIX0RTUENMS19HQVRFX0QsIHZhbCk7CiB9CiAK
LXN0YXRpYyB2b2lkIGJ4dF9nbWJ1c19jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgYnh0X2dtYnVzX2Nsb2NrX2dhdGluZyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBib29sIGVuYWJsZSkKIHsKIAl1MzIgdmFs
OwpAQCAtMTg2LDcgKzE4Niw3IEBAIHN0YXRpYyB2b2lkIGJ4dF9nbWJ1c19jbG9ja19nYXRpbmco
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgdTMyIGdldF9yZXNl
cnZlZChzdHJ1Y3QgaW50ZWxfZ21idXMgKmJ1cykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGJ1cy0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBidXMtPmk5MTU7CiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29y
ZTsKIAl1MzIgcmVzZXJ2ZWQgPSAwOwogCkBAIC0yMDIsNyArMjAyLDcgQEAgc3RhdGljIHUzMiBn
ZXRfcmVzZXJ2ZWQoc3RydWN0IGludGVsX2dtYnVzICpidXMpCiBzdGF0aWMgaW50IGdldF9jbG9j
ayh2b2lkICpkYXRhKQogewogCXN0cnVjdCBpbnRlbF9nbWJ1cyAqYnVzID0gZGF0YTsKLQlzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmYnVzLT5kZXZfcHJpdi0+dW5jb3JlOworCXN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZidXMtPmk5MTUtPnVuY29yZTsKIAl1MzIgcmVzZXJ2
ZWQgPSBnZXRfcmVzZXJ2ZWQoYnVzKTsKIAogCWludGVsX3VuY29yZV93cml0ZV9ub3RyYWNlKHVu
Y29yZSwKQEAgLTIxNyw3ICsyMTcsNyBAQCBzdGF0aWMgaW50IGdldF9jbG9jayh2b2lkICpkYXRh
KQogc3RhdGljIGludCBnZXRfZGF0YSh2b2lkICpkYXRhKQogewogCXN0cnVjdCBpbnRlbF9nbWJ1
cyAqYnVzID0gZGF0YTsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmYnVzLT5kZXZf
cHJpdi0+dW5jb3JlOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZidXMtPmk5MTUt
PnVuY29yZTsKIAl1MzIgcmVzZXJ2ZWQgPSBnZXRfcmVzZXJ2ZWQoYnVzKTsKIAogCWludGVsX3Vu
Y29yZV93cml0ZV9ub3RyYWNlKHVuY29yZSwKQEAgLTIzMiw3ICsyMzIsNyBAQCBzdGF0aWMgaW50
IGdldF9kYXRhKHZvaWQgKmRhdGEpCiBzdGF0aWMgdm9pZCBzZXRfY2xvY2sodm9pZCAqZGF0YSwg
aW50IHN0YXRlX2hpZ2gpCiB7CiAJc3RydWN0IGludGVsX2dtYnVzICpidXMgPSBkYXRhOwotCXN0
cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZidXMtPmRldl9wcml2LT51bmNvcmU7CisJc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmJ1cy0+aTkxNS0+dW5jb3JlOwogCXUzMiByZXNl
cnZlZCA9IGdldF9yZXNlcnZlZChidXMpOwogCXUzMiBjbG9ja19iaXRzOwogCkBAIC0yNTEsNyAr
MjUxLDcgQEAgc3RhdGljIHZvaWQgc2V0X2Nsb2NrKHZvaWQgKmRhdGEsIGludCBzdGF0ZV9oaWdo
KQogc3RhdGljIHZvaWQgc2V0X2RhdGEodm9pZCAqZGF0YSwgaW50IHN0YXRlX2hpZ2gpCiB7CiAJ
c3RydWN0IGludGVsX2dtYnVzICpidXMgPSBkYXRhOwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSA9ICZidXMtPmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5j
b3JlID0gJmJ1cy0+aTkxNS0+dW5jb3JlOwogCXUzMiByZXNlcnZlZCA9IGdldF9yZXNlcnZlZChi
dXMpOwogCXUzMiBkYXRhX2JpdHM7CiAKQEAgLTI3MSwxMiArMjcxLDEyIEBAIGludGVsX2dwaW9f
cHJlX3hmZXIoc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVyKQogCXN0cnVjdCBpbnRlbF9nbWJ1
cyAqYnVzID0gY29udGFpbmVyX29mKGFkYXB0ZXIsCiAJCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxf
Z21idXMsCiAJCQkJCSAgICAgICBhZGFwdGVyKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBidXMtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gYnVzLT5pOTE1OwogCi0JaW50ZWxfZ21idXNfcmVzZXQoZGV2X3ByaXYpOworCWludGVsX2dt
YnVzX3Jlc2V0KGk5MTUpOwogCi0JaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSkKLQkJcG52X2dt
YnVzX2Nsb2NrX2dhdGluZyhkZXZfcHJpdiwgZmFsc2UpOworCWlmIChJU19QSU5FVklFVyhpOTE1
KSkKKwkJcG52X2dtYnVzX2Nsb2NrX2dhdGluZyhpOTE1LCBmYWxzZSk7CiAKIAlzZXRfZGF0YShi
dXMsIDEpOwogCXNldF9jbG9jayhidXMsIDEpOwpAQCAtMjkwLDI0ICsyOTAsMjQgQEAgaW50ZWxf
Z3Bpb19wb3N0X3hmZXIoc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVyKQogCXN0cnVjdCBpbnRl
bF9nbWJ1cyAqYnVzID0gY29udGFpbmVyX29mKGFkYXB0ZXIsCiAJCQkJCSAgICAgICBzdHJ1Y3Qg
aW50ZWxfZ21idXMsCiAJCQkJCSAgICAgICBhZGFwdGVyKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBidXMtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gYnVzLT5pOTE1OwogCiAJc2V0X2RhdGEoYnVzLCAxKTsKIAlzZXRfY2xvY2soYnVz
LCAxKTsKIAotCWlmIChJU19QSU5FVklFVyhkZXZfcHJpdikpCi0JCXBudl9nbWJ1c19jbG9ja19n
YXRpbmcoZGV2X3ByaXYsIHRydWUpOworCWlmIChJU19QSU5FVklFVyhpOTE1KSkKKwkJcG52X2dt
YnVzX2Nsb2NrX2dhdGluZyhpOTE1LCB0cnVlKTsKIH0KIAogc3RhdGljIHZvaWQKIGludGVsX2dw
aW9fc2V0dXAoc3RydWN0IGludGVsX2dtYnVzICpidXMsIHVuc2lnbmVkIGludCBwaW4pCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gYnVzLT5kZXZfcHJpdjsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGJ1cy0+aTkxNTsKIAlzdHJ1Y3QgaTJjX2FsZ29f
Yml0X2RhdGEgKmFsZ287CiAKIAlhbGdvID0gJmJ1cy0+Yml0X2FsZ287CiAKLQlidXMtPmdwaW9f
cmVnID0gR1BJTyhnZXRfZ21idXNfcGluKGRldl9wcml2LCBwaW4pLT5ncGlvKTsKKwlidXMtPmdw
aW9fcmVnID0gR1BJTyhnZXRfZ21idXNfcGluKGk5MTUsIHBpbiktPmdwaW8pOwogCWJ1cy0+YWRh
cHRlci5hbGdvX2RhdGEgPSBhbGdvOwogCWFsZ28tPnNldHNkYSA9IHNldF9kYXRhOwogCWFsZ28t
PnNldHNjbCA9IHNldF9jbG9jazsKQEAgLTMyMCw3ICszMjAsNyBAQCBpbnRlbF9ncGlvX3NldHVw
KHN0cnVjdCBpbnRlbF9nbWJ1cyAqYnVzLCB1bnNpZ25lZCBpbnQgcGluKQogCWFsZ28tPmRhdGEg
PSBidXM7CiB9CiAKLXN0YXRpYyBpbnQgZ21idXNfd2FpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIHUzMiBzdGF0dXMsIHUzMiBpcnFfZW4pCitzdGF0aWMgaW50IGdtYnVzX3dh
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBzdGF0dXMsIHUzMiBpcnFfZW4p
CiB7CiAJREVGSU5FX1dBSVQod2FpdCk7CiAJdTMyIGdtYnVzMjsKQEAgLTMzMCwxMCArMzMwLDEw
IEBAIHN0YXRpYyBpbnQgZ21idXNfd2FpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHUzMiBzdGF0dXMsIHUzMiBpcnFfZW4pCiAJICogd2UgYWxzbyBuZWVkIHRvIGNoZWNrIGZv
ciBOQUtzIGJlc2lkZXMgdGhlIGh3IHJlYWR5L2lkbGUgc2lnbmFsLCB3ZQogCSAqIG5lZWQgdG8g
d2FrZSB1cCBwZXJpb2RpY2FsbHkgYW5kIGNoZWNrIHRoYXQgb3Vyc2VsdmVzLgogCSAqLwotCWlm
ICghSEFTX0dNQlVTX0lSUShkZXZfcHJpdikpCisJaWYgKCFIQVNfR01CVVNfSVJRKGk5MTUpKQog
CQlpcnFfZW4gPSAwOwogCi0JYWRkX3dhaXRfcXVldWUoJmRldl9wcml2LT5nbWJ1c193YWl0X3F1
ZXVlLCAmd2FpdCk7CisJYWRkX3dhaXRfcXVldWUoJmk5MTUtPmdtYnVzX3dhaXRfcXVldWUsICZ3
YWl0KTsKIAlJOTE1X1dSSVRFX0ZXKEdNQlVTNCwgaXJxX2VuKTsKIAogCXN0YXR1cyB8PSBHTUJV
U19TQVRPRVI7CkBAIC0zNDIsNyArMzQyLDcgQEAgc3RhdGljIGludCBnbWJ1c193YWl0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHN0YXR1cywgdTMyIGlycV9lbikKIAkJ
cmV0ID0gd2FpdF9mb3IoKGdtYnVzMiA9IEk5MTVfUkVBRF9GVyhHTUJVUzIpKSAmIHN0YXR1cywg
NTApOwogCiAJSTkxNV9XUklURV9GVyhHTUJVUzQsIDApOwotCXJlbW92ZV93YWl0X3F1ZXVlKCZk
ZXZfcHJpdi0+Z21idXNfd2FpdF9xdWV1ZSwgJndhaXQpOworCXJlbW92ZV93YWl0X3F1ZXVlKCZp
OTE1LT5nbWJ1c193YWl0X3F1ZXVlLCAmd2FpdCk7CiAKIAlpZiAoZ21idXMyICYgR01CVVNfU0FU
T0VSKQogCQlyZXR1cm4gLUVOWElPOwpAQCAtMzUxLDcgKzM1MSw3IEBAIHN0YXRpYyBpbnQgZ21i
dXNfd2FpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBzdGF0dXMsIHUz
MiBpcnFfZW4pCiB9CiAKIHN0YXRpYyBpbnQKLWdtYnVzX3dhaXRfaWRsZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitnbWJ1c193YWl0X2lkbGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7CiAJREVGSU5FX1dBSVQod2FpdCk7CiAJdTMyIGlycV9lbmFibGU7CkBA
IC0zNTksMzYgKzM1OSwzNiBAQCBnbWJ1c193YWl0X2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCiAJLyogSW1wb3J0YW50OiBUaGUgaHcgaGFuZGxlcyBvbmx5IHRoZSBm
aXJzdCBiaXQsIHNvIHNldCBvbmx5IG9uZSEgKi8KIAlpcnFfZW5hYmxlID0gMDsKLQlpZiAoSEFT
X0dNQlVTX0lSUShkZXZfcHJpdikpCisJaWYgKEhBU19HTUJVU19JUlEoaTkxNSkpCiAJCWlycV9l
bmFibGUgPSBHTUJVU19JRExFX0VOOwogCi0JYWRkX3dhaXRfcXVldWUoJmRldl9wcml2LT5nbWJ1
c193YWl0X3F1ZXVlLCAmd2FpdCk7CisJYWRkX3dhaXRfcXVldWUoJmk5MTUtPmdtYnVzX3dhaXRf
cXVldWUsICZ3YWl0KTsKIAlJOTE1X1dSSVRFX0ZXKEdNQlVTNCwgaXJxX2VuYWJsZSk7CiAKLQly
ZXQgPSBpbnRlbF93YWl0X2Zvcl9yZWdpc3Rlcl9mdygmZGV2X3ByaXYtPnVuY29yZSwKKwlyZXQg
PSBpbnRlbF93YWl0X2Zvcl9yZWdpc3Rlcl9mdygmaTkxNS0+dW5jb3JlLAogCQkJCQkgR01CVVMy
LCBHTUJVU19BQ1RJVkUsIDAsCiAJCQkJCSAxMCk7CiAKIAlJOTE1X1dSSVRFX0ZXKEdNQlVTNCwg
MCk7Ci0JcmVtb3ZlX3dhaXRfcXVldWUoJmRldl9wcml2LT5nbWJ1c193YWl0X3F1ZXVlLCAmd2Fp
dCk7CisJcmVtb3ZlX3dhaXRfcXVldWUoJmk5MTUtPmdtYnVzX3dhaXRfcXVldWUsICZ3YWl0KTsK
IAogCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbmxpbmUKLXVuc2lnbmVkIGludCBnbWJ1c19t
YXhfeGZlcl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3Vuc2lnbmVk
IGludCBnbWJ1c19tYXhfeGZlcl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCXJldHVybiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkgPyBHRU45X0dNQlVTX0JZVEVfQ09V
TlRfTUFYIDoKKwlyZXR1cm4gSU5URUxfR0VOKGk5MTUpID49IDkgPyBHRU45X0dNQlVTX0JZVEVf
Q09VTlRfTUFYIDoKIAkgICAgICAgR01CVVNfQllURV9DT1VOVF9NQVg7CiB9CiAKIHN0YXRpYyBp
bnQKLWdtYnVzX3hmZXJfcmVhZF9jaHVuayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitnbWJ1c194ZmVyX3JlYWRfY2h1bmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCSAgICAgIHVuc2lnbmVkIHNob3J0IGFkZHIsIHU4ICpidWYsIHVuc2lnbmVkIGludCBsZW4s
CiAJCSAgICAgIHUzMiBnbWJ1czBfcmVnLCB1MzIgZ21idXMxX2luZGV4KQogewogCXVuc2lnbmVk
IGludCBzaXplID0gbGVuOwotCWJvb2wgYnVyc3RfcmVhZCA9IGxlbiA+IGdtYnVzX21heF94ZmVy
X3NpemUoZGV2X3ByaXYpOworCWJvb2wgYnVyc3RfcmVhZCA9IGxlbiA+IGdtYnVzX21heF94ZmVy
X3NpemUoaTkxNSk7CiAJYm9vbCBleHRyYV9ieXRlX2FkZGVkID0gZmFsc2U7CiAKIAlpZiAoYnVy
c3RfcmVhZCkgewpAQCAtNDE0LDcgKzQxNCw3IEBAIGdtYnVzX3hmZXJfcmVhZF9jaHVuayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWludCByZXQ7CiAJCXUzMiB2YWwsIGxv
b3AgPSAwOwogCi0JCXJldCA9IGdtYnVzX3dhaXQoZGV2X3ByaXYsIEdNQlVTX0hXX1JEWSwgR01C
VVNfSFdfUkRZX0VOKTsKKwkJcmV0ID0gZ21idXNfd2FpdChpOTE1LCBHTUJVU19IV19SRFksIEdN
QlVTX0hXX1JEWV9FTik7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCkBAIC00NDYsNyAr
NDQ2LDcgQEAgZ21idXNfeGZlcl9yZWFkX2NodW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKICNkZWZpbmUgSU5URUxfR01CVVNfQlVSU1RfUkVBRF9NQVhfTEVOCQk3NjdVCiAK
IHN0YXRpYyBpbnQKLWdtYnVzX3hmZXJfcmVhZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsIHN0cnVjdCBpMmNfbXNnICptc2csCitnbWJ1c194ZmVyX3JlYWQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIHN0cnVjdCBpMmNfbXNnICptc2csCiAJCXUzMiBnbWJ1czBfcmVn
LCB1MzIgZ21idXMxX2luZGV4KQogewogCXU4ICpidWYgPSBtc2ctPmJ1ZjsKQEAgLTQ1NSwxMiAr
NDU1LDEyIEBAIGdtYnVzX3hmZXJfcmVhZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHN0cnVjdCBpMmNfbXNnICptc2csCiAJaW50IHJldDsKIAogCWRvIHsKLQkJaWYgKEhBU19H
TUJVU19CVVJTVF9SRUFEKGRldl9wcml2KSkKKwkJaWYgKEhBU19HTUJVU19CVVJTVF9SRUFEKGk5
MTUpKQogCQkJbGVuID0gbWluKHJ4X3NpemUsIElOVEVMX0dNQlVTX0JVUlNUX1JFQURfTUFYX0xF
Tik7CiAJCWVsc2UKLQkJCWxlbiA9IG1pbihyeF9zaXplLCBnbWJ1c19tYXhfeGZlcl9zaXplKGRl
dl9wcml2KSk7CisJCQlsZW4gPSBtaW4ocnhfc2l6ZSwgZ21idXNfbWF4X3hmZXJfc2l6ZShpOTE1
KSk7CiAKLQkJcmV0ID0gZ21idXNfeGZlcl9yZWFkX2NodW5rKGRldl9wcml2LCBtc2ctPmFkZHIs
IGJ1ZiwgbGVuLAorCQlyZXQgPSBnbWJ1c194ZmVyX3JlYWRfY2h1bmsoaTkxNSwgbXNnLT5hZGRy
LCBidWYsIGxlbiwKIAkJCQkJICAgIGdtYnVzMF9yZWcsIGdtYnVzMV9pbmRleCk7CiAJCWlmIChy
ZXQpCiAJCQlyZXR1cm4gcmV0OwpAQCAtNDczLDcgKzQ3Myw3IEBAIGdtYnVzX3hmZXJfcmVhZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBpMmNfbXNnICptc2csCiB9
CiAKIHN0YXRpYyBpbnQKLWdtYnVzX3hmZXJfd3JpdGVfY2h1bmsoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorZ21idXNfeGZlcl93cml0ZV9jaHVuayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJICAgICAgIHVuc2lnbmVkIHNob3J0IGFkZHIsIHU4ICpidWYsIHVu
c2lnbmVkIGludCBsZW4sCiAJCSAgICAgICB1MzIgZ21idXMxX2luZGV4KQogewpAQCAtNTAyLDcg
KzUwMiw3IEBAIGdtYnVzX3hmZXJfd3JpdGVfY2h1bmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCiAJCUk5MTVfV1JJVEVfRlcoR01CVVMzLCB2YWwpOwogCi0JCXJldCA9IGdt
YnVzX3dhaXQoZGV2X3ByaXYsIEdNQlVTX0hXX1JEWSwgR01CVVNfSFdfUkRZX0VOKTsKKwkJcmV0
ID0gZ21idXNfd2FpdChpOTE1LCBHTUJVU19IV19SRFksIEdNQlVTX0hXX1JEWV9FTik7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KQEAgLTUxMSw3ICs1MTEsNyBAQCBnbWJ1c194ZmVy
X3dyaXRlX2NodW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogc3Rh
dGljIGludAotZ21idXNfeGZlcl93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHN0cnVjdCBpMmNfbXNnICptc2csCitnbWJ1c194ZmVyX3dyaXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgaTJjX21zZyAqbXNnLAogCQkgdTMyIGdtYnVzMV9pbmRl
eCkKIHsKIAl1OCAqYnVmID0gbXNnLT5idWY7CkBAIC01MjAsOSArNTIwLDkgQEAgZ21idXNfeGZl
cl93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBpMmNfbXNn
ICptc2csCiAJaW50IHJldDsKIAogCWRvIHsKLQkJbGVuID0gbWluKHR4X3NpemUsIGdtYnVzX21h
eF94ZmVyX3NpemUoZGV2X3ByaXYpKTsKKwkJbGVuID0gbWluKHR4X3NpemUsIGdtYnVzX21heF94
ZmVyX3NpemUoaTkxNSkpOwogCi0JCXJldCA9IGdtYnVzX3hmZXJfd3JpdGVfY2h1bmsoZGV2X3By
aXYsIG1zZy0+YWRkciwgYnVmLCBsZW4sCisJCXJldCA9IGdtYnVzX3hmZXJfd3JpdGVfY2h1bmso
aTkxNSwgbXNnLT5hZGRyLCBidWYsIGxlbiwKIAkJCQkJICAgICBnbWJ1czFfaW5kZXgpOwogCQlp
ZiAocmV0KQogCQkJcmV0dXJuIHJldDsKQEAgLTU0OSw3ICs1NDksNyBAQCBnbWJ1c19pc19pbmRl
eF94ZmVyKHN0cnVjdCBpMmNfbXNnICptc2dzLCBpbnQgaSwgaW50IG51bSkKIH0KIAogc3RhdGlj
IGludAotZ21idXNfaW5kZXhfeGZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IHN0cnVjdCBpMmNfbXNnICptc2dzLAorZ21idXNfaW5kZXhfeGZlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwgc3RydWN0IGkyY19tc2cgKm1zZ3MsCiAJCSB1MzIgZ21idXMwX3JlZykK
IHsKIAl1MzIgZ21idXMxX2luZGV4ID0gMDsKQEAgLTU2OCwxMCArNTY4LDEwIEBAIGdtYnVzX2lu
ZGV4X3hmZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBzdHJ1Y3QgaTJjX21z
ZyAqbXNncywKIAkJSTkxNV9XUklURV9GVyhHTUJVUzUsIGdtYnVzNSk7CiAKIAlpZiAobXNnc1sx
XS5mbGFncyAmIEkyQ19NX1JEKQotCQlyZXQgPSBnbWJ1c194ZmVyX3JlYWQoZGV2X3ByaXYsICZt
c2dzWzFdLCBnbWJ1czBfcmVnLAorCQlyZXQgPSBnbWJ1c194ZmVyX3JlYWQoaTkxNSwgJm1zZ3Nb
MV0sIGdtYnVzMF9yZWcsCiAJCQkJICAgICAgZ21idXMxX2luZGV4KTsKIAllbHNlCi0JCXJldCA9
IGdtYnVzX3hmZXJfd3JpdGUoZGV2X3ByaXYsICZtc2dzWzFdLCBnbWJ1czFfaW5kZXgpOworCQly
ZXQgPSBnbWJ1c194ZmVyX3dyaXRlKGk5MTUsICZtc2dzWzFdLCBnbWJ1czFfaW5kZXgpOwogCiAJ
LyogQ2xlYXIgR01CVVM1IGFmdGVyIGVhY2ggaW5kZXggdHJhbnNmZXIgKi8KIAlpZiAoZ21idXM1
KQpAQCAtNTg3LDE1ICs1ODcsMTUgQEAgZG9fZ21idXNfeGZlcihzdHJ1Y3QgaTJjX2FkYXB0ZXIg
KmFkYXB0ZXIsIHN0cnVjdCBpMmNfbXNnICptc2dzLCBpbnQgbnVtLAogCXN0cnVjdCBpbnRlbF9n
bWJ1cyAqYnVzID0gY29udGFpbmVyX29mKGFkYXB0ZXIsCiAJCQkJCSAgICAgICBzdHJ1Y3QgaW50
ZWxfZ21idXMsCiAJCQkJCSAgICAgICBhZGFwdGVyKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBidXMtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gYnVzLT5pOTE1OwogCWludCBpID0gMCwgaW5jLCB0cnkgPSAwOwogCWludCByZXQgPSAw
OwogCiAJLyogRGlzcGxheSBXQSAjMDg2ODogc2tsLGJ4dCxrYmwsY2ZsLGdsayxjbmwgKi8KLQlp
ZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCi0JCWJ4dF9nbWJ1c19jbG9ja19nYXRpbmcoZGV2X3By
aXYsIGZhbHNlKTsKLQllbHNlIGlmIChIQVNfUENIX1NQVChkZXZfcHJpdikgfHwgSEFTX1BDSF9D
TlAoZGV2X3ByaXYpKQotCQlwY2hfZ21idXNfY2xvY2tfZ2F0aW5nKGRldl9wcml2LCBmYWxzZSk7
CisJaWYgKElTX0dFTjlfTFAoaTkxNSkpCisJCWJ4dF9nbWJ1c19jbG9ja19nYXRpbmcoaTkxNSwg
ZmFsc2UpOworCWVsc2UgaWYgKEhBU19QQ0hfU1BUKGk5MTUpIHx8IEhBU19QQ0hfQ05QKGk5MTUp
KQorCQlwY2hfZ21idXNfY2xvY2tfZ2F0aW5nKGk5MTUsIGZhbHNlKTsKIAogcmV0cnk6CiAJSTkx
NV9XUklURV9GVyhHTUJVUzAsIGdtYnVzMF9zb3VyY2UgfCBidXMtPnJlZzApOwpAQCAtNjAzLDE4
ICs2MDMsMTggQEAgZG9fZ21idXNfeGZlcihzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIsIHN0
cnVjdCBpMmNfbXNnICptc2dzLCBpbnQgbnVtLAogCWZvciAoOyBpIDwgbnVtOyBpICs9IGluYykg
ewogCQlpbmMgPSAxOwogCQlpZiAoZ21idXNfaXNfaW5kZXhfeGZlcihtc2dzLCBpLCBudW0pKSB7
Ci0JCQlyZXQgPSBnbWJ1c19pbmRleF94ZmVyKGRldl9wcml2LCAmbXNnc1tpXSwKKwkJCXJldCA9
IGdtYnVzX2luZGV4X3hmZXIoaTkxNSwgJm1zZ3NbaV0sCiAJCQkJCSAgICAgICBnbWJ1czBfc291
cmNlIHwgYnVzLT5yZWcwKTsKIAkJCWluYyA9IDI7IC8qIGFuIGluZGV4IHRyYW5zbWlzc2lvbiBp
cyB0d28gbXNncyAqLwogCQl9IGVsc2UgaWYgKG1zZ3NbaV0uZmxhZ3MgJiBJMkNfTV9SRCkgewot
CQkJcmV0ID0gZ21idXNfeGZlcl9yZWFkKGRldl9wcml2LCAmbXNnc1tpXSwKKwkJCXJldCA9IGdt
YnVzX3hmZXJfcmVhZChpOTE1LCAmbXNnc1tpXSwKIAkJCQkJICAgICAgZ21idXMwX3NvdXJjZSB8
IGJ1cy0+cmVnMCwgMCk7CiAJCX0gZWxzZSB7Ci0JCQlyZXQgPSBnbWJ1c194ZmVyX3dyaXRlKGRl
dl9wcml2LCAmbXNnc1tpXSwgMCk7CisJCQlyZXQgPSBnbWJ1c194ZmVyX3dyaXRlKGk5MTUsICZt
c2dzW2ldLCAwKTsKIAkJfQogCiAJCWlmICghcmV0KQotCQkJcmV0ID0gZ21idXNfd2FpdChkZXZf
cHJpdiwKKwkJCXJldCA9IGdtYnVzX3dhaXQoaTkxNSwKIAkJCQkJIEdNQlVTX0hXX1dBSVRfUEhB
U0UsIEdNQlVTX0hXX1dBSVRfRU4pOwogCQlpZiAocmV0ID09IC1FVElNRURPVVQpCiAJCQlnb3Rv
IHRpbWVvdXQ7CkBAIC02MzIsNyArNjMyLDcgQEAgZG9fZ21idXNfeGZlcihzdHJ1Y3QgaTJjX2Fk
YXB0ZXIgKmFkYXB0ZXIsIHN0cnVjdCBpMmNfbXNnICptc2dzLCBpbnQgbnVtLAogCSAqIFdlIHdp
bGwgcmUtZW5hYmxlIGl0IGF0IHRoZSBzdGFydCBvZiB0aGUgbmV4dCB4ZmVyLAogCSAqIHRpbGwg
dGhlbiBsZXQgaXQgc2xlZXAuCiAJICovCi0JaWYgKGdtYnVzX3dhaXRfaWRsZShkZXZfcHJpdikp
IHsKKwlpZiAoZ21idXNfd2FpdF9pZGxlKGk5MTUpKSB7CiAJCURSTV9ERUJVR19LTVMoIkdNQlVT
IFslc10gdGltZWQgb3V0IHdhaXRpbmcgZm9yIGlkbGVcbiIsCiAJCQkgYWRhcHRlci0+bmFtZSk7
CiAJCXJldCA9IC1FVElNRURPVVQ7CkBAIC02NTYsNyArNjU2LDcgQEAgZG9fZ21idXNfeGZlcihz
dHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIsIHN0cnVjdCBpMmNfbXNnICptc2dzLCBpbnQgbnVt
LAogCSAqIGl0J3Mgc2xvdyByZXNwb25kaW5nIGFuZCBvbmx5IGFuc3dlcnMgb24gdGhlIDJuZCBy
ZXRyeS4KIAkgKi8KIAlyZXQgPSAtRU5YSU87Ci0JaWYgKGdtYnVzX3dhaXRfaWRsZShkZXZfcHJp
dikpIHsKKwlpZiAoZ21idXNfd2FpdF9pZGxlKGk5MTUpKSB7CiAJCURSTV9ERUJVR19LTVMoIkdN
QlVTIFslc10gdGltZWQgb3V0IGFmdGVyIE5BS1xuIiwKIAkJCSAgICAgIGFkYXB0ZXItPm5hbWUp
OwogCQlyZXQgPSAtRVRJTUVET1VUOwpAQCAtNzAxLDEwICs3MDEsMTAgQEAgZG9fZ21idXNfeGZl
cihzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIsIHN0cnVjdCBpMmNfbXNnICptc2dzLCBpbnQg
bnVtLAogCiBvdXQ6CiAJLyogRGlzcGxheSBXQSAjMDg2ODogc2tsLGJ4dCxrYmwsY2ZsLGdsayxj
bmwgKi8KLQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCi0JCWJ4dF9nbWJ1c19jbG9ja19nYXRp
bmcoZGV2X3ByaXYsIHRydWUpOwotCWVsc2UgaWYgKEhBU19QQ0hfU1BUKGRldl9wcml2KSB8fCBI
QVNfUENIX0NOUChkZXZfcHJpdikpCi0JCXBjaF9nbWJ1c19jbG9ja19nYXRpbmcoZGV2X3ByaXYs
IHRydWUpOworCWlmIChJU19HRU45X0xQKGk5MTUpKQorCQlieHRfZ21idXNfY2xvY2tfZ2F0aW5n
KGk5MTUsIHRydWUpOworCWVsc2UgaWYgKEhBU19QQ0hfU1BUKGk5MTUpIHx8IEhBU19QQ0hfQ05Q
KGk5MTUpKQorCQlwY2hfZ21idXNfY2xvY2tfZ2F0aW5nKGk5MTUsIHRydWUpOwogCiAJcmV0dXJu
IHJldDsKIH0KQEAgLTcxNCwxMSArNzE0LDExIEBAIGdtYnVzX3hmZXIoc3RydWN0IGkyY19hZGFw
dGVyICphZGFwdGVyLCBzdHJ1Y3QgaTJjX21zZyAqbXNncywgaW50IG51bSkKIHsKIAlzdHJ1Y3Qg
aW50ZWxfZ21idXMgKmJ1cyA9CiAJCWNvbnRhaW5lcl9vZihhZGFwdGVyLCBzdHJ1Y3QgaW50ZWxf
Z21idXMsIGFkYXB0ZXIpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGJ1
cy0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBidXMtPmk5MTU7
CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IHJldDsKIAotCXdha2VyZWYgPSBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0dNQlVTKTsKKwl3YWtl
cmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoaTkxNSwgUE9XRVJfRE9NQUlOX0dNQlVTKTsK
IAogCWlmIChidXMtPmZvcmNlX2JpdCkgewogCQlyZXQgPSBpMmNfYml0X2FsZ28ubWFzdGVyX3hm
ZXIoYWRhcHRlciwgbXNncywgbnVtKTsKQEAgLTczMCw3ICs3MzAsNyBAQCBnbWJ1c194ZmVyKHN0
cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlciwgc3RydWN0IGkyY19tc2cgKm1zZ3MsIGludCBudW0p
CiAJCQlidXMtPmZvcmNlX2JpdCB8PSBHTUJVU19GT1JDRV9CSVRfUkVUUlk7CiAJfQogCi0JaW50
ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9HTUJVUywgd2FrZXJl
Zik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlOX0dNQlVTLCB3
YWtlcmVmKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC03MzksNyArNzM5LDcgQEAgaW50IGludGVs
X2dtYnVzX291dHB1dF9ha3N2KHN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlcikKIHsKIAlzdHJ1
Y3QgaW50ZWxfZ21idXMgKmJ1cyA9CiAJCWNvbnRhaW5lcl9vZihhZGFwdGVyLCBzdHJ1Y3QgaW50
ZWxfZ21idXMsIGFkYXB0ZXIpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGJ1cy0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBidXMtPmk5
MTU7CiAJdTggY21kID0gRFJNX0hEQ1BfRERDX0FLU1Y7CiAJdTggYnVmW0RSTV9IRENQX0tTVl9M
RU5dID0geyAwIH07CiAJc3RydWN0IGkyY19tc2cgbXNnc1tdID0gewpAQCAtNzU5LDggKzc1OSw4
IEBAIGludCBpbnRlbF9nbWJ1c19vdXRwdXRfYWtzdihzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0
ZXIpCiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IHJldDsKIAotCXdha2VyZWYgPSBp
bnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0dNQlVTKTsKLQlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+Z21idXNfbXV0ZXgpOworCXdha2VyZWYgPSBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2dldChpOTE1LCBQT1dFUl9ET01BSU5fR01CVVMpOworCW11dGV4X2xvY2soJmk5
MTUtPmdtYnVzX211dGV4KTsKIAogCS8qCiAJICogSW4gb3JkZXIgdG8gb3V0cHV0IEFrc3YgdG8g
dGhlIHJlY2VpdmVyLCB1c2UgYW4gaW5kZXhlZCB3cml0ZSB0bwpAQCAtNzY5LDggKzc2OSw4IEBA
IGludCBpbnRlbF9nbWJ1c19vdXRwdXRfYWtzdihzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIp
CiAJICovCiAJcmV0ID0gZG9fZ21idXNfeGZlcihhZGFwdGVyLCBtc2dzLCBBUlJBWV9TSVpFKG1z
Z3MpLCBHTUJVU19BS1NWX1NFTEVDVCk7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5nbWJ1
c19tdXRleCk7Ci0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJ
Tl9HTUJVUywgd2FrZXJlZik7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nbWJ1c19tdXRleCk7CisJ
aW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlOX0dNQlVTLCB3YWtlcmVm
KTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC03OTMsMjcgKzc5MywyNyBAQCBzdGF0aWMgdm9pZCBn
bWJ1c19sb2NrX2J1cyhzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIsCiAJCQkgICB1bnNpZ25l
ZCBpbnQgZmxhZ3MpCiB7CiAJc3RydWN0IGludGVsX2dtYnVzICpidXMgPSB0b19pbnRlbF9nbWJ1
cyhhZGFwdGVyKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBidXMtPmRl
dl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYnVzLT5pOTE1OwogCi0J
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdtYnVzX211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5n
bWJ1c19tdXRleCk7CiB9CiAKIHN0YXRpYyBpbnQgZ21idXNfdHJ5bG9ja19idXMoc3RydWN0IGky
Y19hZGFwdGVyICphZGFwdGVyLAogCQkJICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7CiAJc3Ry
dWN0IGludGVsX2dtYnVzICpidXMgPSB0b19pbnRlbF9nbWJ1cyhhZGFwdGVyKTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBidXMtPmRldl9wcml2OworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gYnVzLT5pOTE1OwogCi0JcmV0dXJuIG11dGV4X3RyeWxvY2so
JmRldl9wcml2LT5nbWJ1c19tdXRleCk7CisJcmV0dXJuIG11dGV4X3RyeWxvY2soJmk5MTUtPmdt
YnVzX211dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgZ21idXNfdW5sb2NrX2J1cyhzdHJ1Y3QgaTJj
X2FkYXB0ZXIgKmFkYXB0ZXIsCiAJCQkgICAgIHVuc2lnbmVkIGludCBmbGFncykKIHsKIAlzdHJ1
Y3QgaW50ZWxfZ21idXMgKmJ1cyA9IHRvX2ludGVsX2dtYnVzKGFkYXB0ZXIpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGJ1cy0+ZGV2X3ByaXY7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBidXMtPmk5MTU7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5nbWJ1c19tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nbWJ1c19tdXRleCk7CiB9CiAK
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTJjX2xvY2tfb3BlcmF0aW9ucyBnbWJ1c19sb2NrX29wcyA9
IHsKQEAgLTgyNCw0NSArODI0LDQ1IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTJjX2xvY2tfb3Bl
cmF0aW9ucyBnbWJ1c19sb2NrX29wcyA9IHsKIAogLyoqCiAgKiBpbnRlbF9nbWJ1c19zZXR1cCAt
IGluc3RhbnRpYXRlIGFsbCBJbnRlbCBpMmMgR01CdXNlcwotICogQGRldl9wcml2OiBpOTE1IGRl
dmljZSBwcml2YXRlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgcHJpdmF0ZQogICovCi1pbnQgaW50
ZWxfZ21idXNfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50IGlu
dGVsX2dtYnVzX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVj
dCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBwY2lfZGV2ICpw
ZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CiAJc3RydWN0IGludGVsX2dtYnVzICpidXM7CiAJdW5zaWdu
ZWQgaW50IHBpbjsKIAlpbnQgcmV0OwogCi0JaWYgKCFIQVNfRElTUExBWShkZXZfcHJpdikpCisJ
aWYgKCFIQVNfRElTUExBWShpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoSVNfVkFMTEVZVklF
VyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCWRldl9wcml2LT5ncGlv
X21taW9fYmFzZSA9IFZMVl9ESVNQTEFZX0JBU0U7Ci0JZWxzZSBpZiAoIUhBU19HTUNIKGRldl9w
cml2KSkKKwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQor
CQlpOTE1LT5ncGlvX21taW9fYmFzZSA9IFZMVl9ESVNQTEFZX0JBU0U7CisJZWxzZSBpZiAoIUhB
U19HTUNIKGk5MTUpKQogCQkvKgogCQkgKiBCcm94dG9uIHVzZXMgdGhlIHNhbWUgUENIIG9mZnNl
dHMgZm9yIFNvdXRoIERpc3BsYXkgRW5naW5lLAogCQkgKiBldmVuIHRob3VnaCBpdCBkb2Vzbid0
IGhhdmUgYSBQQ0guCiAJCSAqLwotCQlkZXZfcHJpdi0+Z3Bpb19tbWlvX2Jhc2UgPSBQQ0hfRElT
UExBWV9CQVNFOworCQlpOTE1LT5ncGlvX21taW9fYmFzZSA9IFBDSF9ESVNQTEFZX0JBU0U7CiAK
LQltdXRleF9pbml0KCZkZXZfcHJpdi0+Z21idXNfbXV0ZXgpOwotCWluaXRfd2FpdHF1ZXVlX2hl
YWQoJmRldl9wcml2LT5nbWJ1c193YWl0X3F1ZXVlKTsKKwltdXRleF9pbml0KCZpOTE1LT5nbWJ1
c19tdXRleCk7CisJaW5pdF93YWl0cXVldWVfaGVhZCgmaTkxNS0+Z21idXNfd2FpdF9xdWV1ZSk7
CiAKLQlmb3IgKHBpbiA9IDA7IHBpbiA8IEFSUkFZX1NJWkUoZGV2X3ByaXYtPmdtYnVzKTsgcGlu
KyspIHsKLQkJaWYgKCFpbnRlbF9nbWJ1c19pc192YWxpZF9waW4oZGV2X3ByaXYsIHBpbikpCisJ
Zm9yIChwaW4gPSAwOyBwaW4gPCBBUlJBWV9TSVpFKGk5MTUtPmdtYnVzKTsgcGluKyspIHsKKwkJ
aWYgKCFpbnRlbF9nbWJ1c19pc192YWxpZF9waW4oaTkxNSwgcGluKSkKIAkJCWNvbnRpbnVlOwog
Ci0JCWJ1cyA9ICZkZXZfcHJpdi0+Z21idXNbcGluXTsKKwkJYnVzID0gJmk5MTUtPmdtYnVzW3Bp
bl07CiAKIAkJYnVzLT5hZGFwdGVyLm93bmVyID0gVEhJU19NT0RVTEU7CiAJCWJ1cy0+YWRhcHRl
ci5jbGFzcyA9IEkyQ19DTEFTU19EREM7CiAJCXNucHJpbnRmKGJ1cy0+YWRhcHRlci5uYW1lLAog
CQkJIHNpemVvZihidXMtPmFkYXB0ZXIubmFtZSksCiAJCQkgImk5MTUgZ21idXMgJXMiLAotCQkJ
IGdldF9nbWJ1c19waW4oZGV2X3ByaXYsIHBpbiktPm5hbWUpOworCQkJIGdldF9nbWJ1c19waW4o
aTkxNSwgcGluKS0+bmFtZSk7CiAKIAkJYnVzLT5hZGFwdGVyLmRldi5wYXJlbnQgPSAmcGRldi0+
ZGV2OwotCQlidXMtPmRldl9wcml2ID0gZGV2X3ByaXY7CisJCWJ1cy0+aTkxNSA9IGk5MTU7CiAK
IAkJYnVzLT5hZGFwdGVyLmFsZ28gPSAmZ21idXNfYWxnb3JpdGhtOwogCQlidXMtPmFkYXB0ZXIu
bG9ja19vcHMgPSAmZ21idXNfbG9ja19vcHM7CkBAIC04NzcsNyArODc3LDcgQEAgaW50IGludGVs
X2dtYnVzX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJYnVzLT5y
ZWcwID0gcGluIHwgR01CVVNfUkFURV8xMDBLSFo7CiAKIAkJLyogZ21idXMgc2VlbXMgdG8gYmUg
YnJva2VuIG9uIGk4MzAgKi8KLQkJaWYgKElTX0k4MzAoZGV2X3ByaXYpKQorCQlpZiAoSVNfSTgz
MChpOTE1KSkKIAkJCWJ1cy0+Zm9yY2VfYml0ID0gMTsKIAogCQlpbnRlbF9ncGlvX3NldHVwKGJ1
cywgcGluKTsKQEAgLTg4NywyOCArODg3LDI4IEBAIGludCBpbnRlbF9nbWJ1c19zZXR1cChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCQlnb3RvIGVycjsKIAl9CiAKLQlpbnRl
bF9nbWJ1c19yZXNldChkZXZfcHJpdik7CisJaW50ZWxfZ21idXNfcmVzZXQoaTkxNSk7CiAKIAly
ZXR1cm4gMDsKIAogZXJyOgogCXdoaWxlIChwaW4tLSkgewotCQlpZiAoIWludGVsX2dtYnVzX2lz
X3ZhbGlkX3BpbihkZXZfcHJpdiwgcGluKSkKKwkJaWYgKCFpbnRlbF9nbWJ1c19pc192YWxpZF9w
aW4oaTkxNSwgcGluKSkKIAkJCWNvbnRpbnVlOwogCi0JCWJ1cyA9ICZkZXZfcHJpdi0+Z21idXNb
cGluXTsKKwkJYnVzID0gJmk5MTUtPmdtYnVzW3Bpbl07CiAJCWkyY19kZWxfYWRhcHRlcigmYnVz
LT5hZGFwdGVyKTsKIAl9CiAJcmV0dXJuIHJldDsKIH0KIAotc3RydWN0IGkyY19hZGFwdGVyICpp
bnRlbF9nbWJ1c19nZXRfYWRhcHRlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmludGVsX2dtYnVzX2dldF9hZGFwdGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgICAgdW5zaWduZWQgaW50IHBpbikKIHsKLQlpZiAo
V0FSTl9PTighaW50ZWxfZ21idXNfaXNfdmFsaWRfcGluKGRldl9wcml2LCBwaW4pKSkKKwlpZiAo
V0FSTl9PTighaW50ZWxfZ21idXNfaXNfdmFsaWRfcGluKGk5MTUsIHBpbikpKQogCQlyZXR1cm4g
TlVMTDsKIAotCXJldHVybiAmZGV2X3ByaXYtPmdtYnVzW3Bpbl0uYWRhcHRlcjsKKwlyZXR1cm4g
Jmk5MTUtPmdtYnVzW3Bpbl0uYWRhcHRlcjsKIH0KIAogdm9pZCBpbnRlbF9nbWJ1c19zZXRfc3Bl
ZWQoc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVyLCBpbnQgc3BlZWQpCkBAIC05MjEsMTYgKzky
MSwxNiBAQCB2b2lkIGludGVsX2dtYnVzX3NldF9zcGVlZChzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFk
YXB0ZXIsIGludCBzcGVlZCkKIHZvaWQgaW50ZWxfZ21idXNfZm9yY2VfYml0KHN0cnVjdCBpMmNf
YWRhcHRlciAqYWRhcHRlciwgYm9vbCBmb3JjZV9iaXQpCiB7CiAJc3RydWN0IGludGVsX2dtYnVz
ICpidXMgPSB0b19pbnRlbF9nbWJ1cyhhZGFwdGVyKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBidXMtPmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gYnVzLT5pOTE1OwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdtYnVzX211dGV4KTsK
KwltdXRleF9sb2NrKCZpOTE1LT5nbWJ1c19tdXRleCk7CiAKIAlidXMtPmZvcmNlX2JpdCArPSBm
b3JjZV9iaXQgPyAxIDogLTE7CiAJRFJNX0RFQlVHX0tNUygiJXNhYmxpbmcgYml0LWJhbmdpbmcg
b24gJXMuIGZvcmNlIGJpdCBub3cgJWRcbiIsCiAJCSAgICAgIGZvcmNlX2JpdCA/ICJlbiIgOiAi
ZGlzIiwgYWRhcHRlci0+bmFtZSwKIAkJICAgICAgYnVzLT5mb3JjZV9iaXQpOwogCi0JbXV0ZXhf
dW5sb2NrKCZkZXZfcHJpdi0+Z21idXNfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+Z21i
dXNfbXV0ZXgpOwogfQogCiBib29sIGludGVsX2dtYnVzX2lzX2ZvcmNlZF9iaXQoc3RydWN0IGky
Y19hZGFwdGVyICphZGFwdGVyKQpAQCAtOTQwLDE2ICs5NDAsMTYgQEAgYm9vbCBpbnRlbF9nbWJ1
c19pc19mb3JjZWRfYml0KHN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlcikKIAlyZXR1cm4gYnVz
LT5mb3JjZV9iaXQ7CiB9CiAKLXZvaWQgaW50ZWxfZ21idXNfdGVhcmRvd24oc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9nbWJ1c190ZWFyZG93bihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZ21idXMgKmJ1czsKIAl1
bnNpZ25lZCBpbnQgcGluOwogCi0JZm9yIChwaW4gPSAwOyBwaW4gPCBBUlJBWV9TSVpFKGRldl9w
cml2LT5nbWJ1cyk7IHBpbisrKSB7Ci0JCWlmICghaW50ZWxfZ21idXNfaXNfdmFsaWRfcGluKGRl
dl9wcml2LCBwaW4pKQorCWZvciAocGluID0gMDsgcGluIDwgQVJSQVlfU0laRShpOTE1LT5nbWJ1
cyk7IHBpbisrKSB7CisJCWlmICghaW50ZWxfZ21idXNfaXNfdmFsaWRfcGluKGk5MTUsIHBpbikp
CiAJCQljb250aW51ZTsKIAotCQlidXMgPSAmZGV2X3ByaXYtPmdtYnVzW3Bpbl07CisJCWJ1cyA9
ICZpOTE1LT5nbWJ1c1twaW5dOwogCQlpMmNfZGVsX2FkYXB0ZXIoJmJ1cy0+YWRhcHRlcik7CiAJ
fQogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ21idXMuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2dtYnVzLmgKaW5kZXggZDk4OTA4NWI4ZDIyLi40YTQx
OTZjYTgzNDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2dtYnVzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ21idXMuaApAQCAtMTEsMTcgKzExLDE3
IEBACiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBpMmNfYWRhcHRlcjsKIAotaW50
IGludGVsX2dtYnVzX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12
b2lkIGludGVsX2dtYnVzX3RlYXJkb3duKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dik7Ci1ib29sIGludGVsX2dtYnVzX2lzX3ZhbGlkX3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitpbnQgaW50ZWxfZ21idXNfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwordm9pZCBpbnRlbF9nbWJ1c190ZWFyZG93bihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSk7Citib29sIGludGVsX2dtYnVzX2lzX3ZhbGlkX3BpbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIHVuc2lnbmVkIGludCBwaW4pOwogaW50IGludGVs
X2dtYnVzX291dHB1dF9ha3N2KHN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlcik7CiAKIHN0cnVj
dCBpMmNfYWRhcHRlciAqCi1pbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIHVuc2lnbmVkIGludCBwaW4pOworaW50ZWxfZ21idXNfZ2V0X2Fk
YXB0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVuc2lnbmVkIGludCBwaW4pOwog
dm9pZCBpbnRlbF9nbWJ1c19zZXRfc3BlZWQoc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVyLCBp
bnQgc3BlZWQpOwogdm9pZCBpbnRlbF9nbWJ1c19mb3JjZV9iaXQoc3RydWN0IGkyY19hZGFwdGVy
ICphZGFwdGVyLCBib29sIGZvcmNlX2JpdCk7CiBib29sIGludGVsX2dtYnVzX2lzX2ZvcmNlZF9i
aXQoc3RydWN0IGkyY19hZGFwdGVyICphZGFwdGVyKTsKLXZvaWQgaW50ZWxfZ21idXNfcmVzZXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfZ21idXNfcmVz
ZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiAjZW5kaWYgLyogX19JTlRFTF9H
TUJVU19IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmMKaW5kZXggYzQwYTZlZmRkMzNhLi5m
MDhhYzI5YzJhNGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCkBAIC0yOSwxNCArMjksMTQg
QEAKIAogc3RhdGljIHZvaWQgZ2VuOF9ndWNfcmFpc2VfaXJxKHN0cnVjdCBpbnRlbF9ndWMgKmd1
YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShn
dWMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsK
IAogCUk5MTVfV1JJVEUoR1VDX1NFTkRfSU5URVJSVVBULCBHVUNfU0VORF9UUklHR0VSKTsKIH0K
IAogc3RhdGljIHZvaWQgZ2VuMTFfZ3VjX3JhaXNlX2lycShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3VjX3RvX2k5MTUoZ3Vj
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7CiAK
IAlJOTE1X1dSSVRFKEdFTjExX0dVQ19IT1NUX0lOVEVSUlVQVCwgMCk7CiB9CkBAIC01MiwxMSAr
NTIsMTEgQEAgc3RhdGljIGlubGluZSBpOTE1X3JlZ190IGd1Y19zZW5kX3JlZyhzdHJ1Y3QgaW50
ZWxfZ3VjICpndWMsIHUzMiBpKQogCiB2b2lkIGludGVsX2d1Y19pbml0X3NlbmRfcmVncyhzdHJ1
Y3QgaW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1
Y190b19pOTE1KGd1Yyk7CiAJZW51bSBmb3JjZXdha2VfZG9tYWlucyBmd19kb21haW5zID0gMDsK
IAl1bnNpZ25lZCBpbnQgaTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewogCQlndWMtPnNlbmRfcmVncy5iYXNlID0KIAkJ
CQlpOTE1X21taW9fcmVnX29mZnNldChHRU4xMV9TT0ZUX1NDUkFUQ0goMCkpOwogCQlndWMtPnNl
bmRfcmVncy5jb3VudCA9IEdFTjExX1NPRlRfU0NSQVRDSF9DT1VOVDsKQEAgLTY3LDcgKzY3LDcg
QEAgdm9pZCBpbnRlbF9ndWNfaW5pdF9zZW5kX3JlZ3Moc3RydWN0IGludGVsX2d1YyAqZ3VjKQog
CX0KIAogCWZvciAoaSA9IDA7IGkgPCBndWMtPnNlbmRfcmVncy5jb3VudDsgaSsrKSB7Ci0JCWZ3
X2RvbWFpbnMgfD0gaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9mb3JfcmVnKCZkZXZfcHJpdi0+dW5j
b3JlLAorCQlmd19kb21haW5zIHw9IGludGVsX3VuY29yZV9mb3JjZXdha2VfZm9yX3JlZygmaTkx
NS0+dW5jb3JlLAogCQkJCQlndWNfc2VuZF9yZWcoZ3VjLCBpKSwKIAkJCQkJRldfUkVHX1JFQUQg
fCBGV19SRUdfV1JJVEUpOwogCX0KQEAgLTEwMSw3ICsxMDEsNyBAQCB2b2lkIGludGVsX2d1Y19p
bml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAogc3RhdGljIGludCBndWNfaW5pdF93
cShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IGd1Y190b19pOTE1KGd1Yyk7CiAKIAkvKgogCSAqIEd1QyBsb2cgYnVmZmVyIGZsdXNoIHdv
cmsgaXRlbSBoYXMgdG8gZG8gcmVnaXN0ZXIgYWNjZXNzIHRvCkBAIC0xMzUsOCArMTM1LDggQEAg
c3RhdGljIGludCBndWNfaW5pdF93cShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiAJICogdG8gbWFr
ZSBzdXJlIHdlJ3JlIGFsd2F5cyBzZW5kaW5nIGEgc2luZ2xlIHByZWVtcHRpb24gcmVxdWVzdCB3
aXRoIGEKIAkgKiBzaW5nbGUgd29ya2l0ZW0uCiAJICovCi0JaWYgKEhBU19MT0dJQ0FMX1JJTkdf
UFJFRU1QVElPTihkZXZfcHJpdikgJiYKLQkgICAgVVNFU19HVUNfU1VCTUlTU0lPTihkZXZfcHJp
dikpIHsKKwlpZiAoSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGk5MTUpICYmCisJICAgIFVT
RVNfR1VDX1NVQk1JU1NJT04oaTkxNSkpIHsKIAkJZ3VjLT5wcmVlbXB0X3dxID0gYWxsb2Nfb3Jk
ZXJlZF93b3JrcXVldWUoImk5MTUtZ3VjX3ByZWVtcHQiLAogCQkJCQkJCSAgV1FfSElHSFBSSSk7
CiAJCWlmICghZ3VjLT5wcmVlbXB0X3dxKSB7CkBAIC0yMTEsNyArMjExLDcgQEAgc3RhdGljIHZv
aWQgZ3VjX3NoYXJlZF9kYXRhX2Rlc3Ryb3koc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCiBpbnQg
aW50ZWxfZ3VjX2luaXQoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGd1Y190b19pOTE1KGd1Yyk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBndWNfdG9faTkxNShndWMpOwogCWludCByZXQ7CiAKIAlyZXQgPSBp
bnRlbF91Y19md19pbml0KCZndWMtPmZ3KTsKQEAgLTIzNyw3ICsyMzcsNyBAQCBpbnQgaW50ZWxf
Z3VjX2luaXQoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCQlnb3RvIGVycl9hZHM7CiAKIAkvKiBX
ZSBuZWVkIHRvIG5vdGlmeSB0aGUgZ3VjIHdoZW5ldmVyIHdlIGNoYW5nZSB0aGUgR0dUVCAqLwot
CWk5MTVfZ2d0dF9lbmFibGVfZ3VjKGRldl9wcml2KTsKKwlpOTE1X2dndHRfZW5hYmxlX2d1Yyhp
OTE1KTsKIAogCXJldHVybiAwOwogCkBAIC0yNTYsOSArMjU2LDkgQEAgaW50IGludGVsX2d1Y19p
bml0KHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAogdm9pZCBpbnRlbF9ndWNfZmluaShzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
Z3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190
b19pOTE1KGd1Yyk7CiAKLQlpOTE1X2dndHRfZGlzYWJsZV9ndWMoZGV2X3ByaXYpOworCWk5MTVf
Z2d0dF9kaXNhYmxlX2d1YyhpOTE1KTsKIAogCWludGVsX2d1Y19jdF9maW5pKCZndWMtPmN0KTsK
IApAQCAtMzY2LDcgKzM2Niw3IEBAIHN0YXRpYyB1MzIgZ3VjX2N0bF9hZHNfZmxhZ3Moc3RydWN0
IGludGVsX2d1YyAqZ3VjKQogICovCiB2b2lkIGludGVsX2d1Y19pbml0X3BhcmFtcyhzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
Z3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190
b19pOTE1KGd1Yyk7CiAJdTMyIHBhcmFtc1tHVUNfQ1RMX01BWF9EV09SRFNdOwogCWludCBpOwog
CkBAIC0zODYsMTQgKzM4NiwxNCBAQCB2b2lkIGludGVsX2d1Y19pbml0X3BhcmFtcyhzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCiAJICogdGhleSBhcmUgcG93ZXIgY29udGV4dCBzYXZlZCBzbyBpdCdz
IG9rIHRvIHJlbGVhc2UgZm9yY2V3YWtlCiAJICogd2hlbiB3ZSBhcmUgZG9uZSBoZXJlIGFuZCB0
YWtlIGl0IGFnYWluIGF0IHhmZXIgdGltZS4KIAkgKi8KLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtl
X2dldCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0JMSVRURVIpOworCWludGVsX3VuY29y
ZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9CTElUVEVSKTsKIAogCUk5
MTVfV1JJVEUoU09GVF9TQ1JBVENIKDApLCAwKTsKIAogCWZvciAoaSA9IDA7IGkgPCBHVUNfQ1RM
X01BWF9EV09SRFM7IGkrKykKIAkJSTkxNV9XUklURShTT0ZUX1NDUkFUQ0goMSArIGkpLCBwYXJh
bXNbaV0pOwogCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUs
IEZPUkNFV0FLRV9CTElUVEVSKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+
dW5jb3JlLCBGT1JDRVdBS0VfQkxJVFRFUik7CiB9CiAKIGludCBpbnRlbF9ndWNfc2VuZF9ub3Ao
c3RydWN0IGludGVsX2d1YyAqZ3VjLCBjb25zdCB1MzIgKmFjdGlvbiwgdTMyIGxlbiwKQEAgLTQx
NCw4ICs0MTQsOCBAQCB2b2lkIGludGVsX2d1Y190b19ob3N0X2V2ZW50X2hhbmRsZXJfbm9wKHN0
cnVjdCBpbnRlbF9ndWMgKmd1YykKIGludCBpbnRlbF9ndWNfc2VuZF9tbWlvKHN0cnVjdCBpbnRl
bF9ndWMgKmd1YywgY29uc3QgdTMyICphY3Rpb24sIHUzMiBsZW4sCiAJCQl1MzIgKnJlc3BvbnNl
X2J1ZiwgdTMyIHJlc3BvbnNlX2J1Zl9zaXplKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGd1Y190b19pOTE1KGd1Yyk7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5j
b3JlID0gJmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBndWNfdG9faTkxNShndWMpOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1
LT51bmNvcmU7CiAJdTMyIHN0YXR1czsKIAlpbnQgaTsKIAlpbnQgcmV0OwpAQCAtNDk3LDEyICs0
OTcsMTIgQEAgaW50IGludGVsX2d1Y190b19ob3N0X3Byb2Nlc3NfcmVjdl9tc2coc3RydWN0IGlu
dGVsX2d1YyAqZ3VjLAogCiBpbnQgaW50ZWxfZ3VjX3NhbXBsZV9mb3JjZXdha2Uoc3RydWN0IGlu
dGVsX2d1YyAqZ3VjKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd1
Y190b19pOTE1KGd1Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndWNfdG9f
aTkxNShndWMpOwogCXUzMiBhY3Rpb25bMl07CiAKIAlhY3Rpb25bMF0gPSBJTlRFTF9HVUNfQUNU
SU9OX1NBTVBMRV9GT1JDRVdBS0U7CiAJLyogV2FSc0Rpc2FibGVDb2Fyc2VQb3dlckdhdGluZzpz
a2wsY25sICovCi0JaWYgKCFIQVNfUkM2KGRldl9wcml2KSB8fCBORUVEU19XYVJzRGlzYWJsZUNv
YXJzZVBvd2VyR2F0aW5nKGRldl9wcml2KSkKKwlpZiAoIUhBU19SQzYoaTkxNSkgfHwgTkVFRFNf
V2FSc0Rpc2FibGVDb2Fyc2VQb3dlckdhdGluZyhpOTE1KSkKIAkJYWN0aW9uWzFdID0gMDsKIAll
bHNlCiAJCS8qIGJpdCAwIGFuZCAxIGFyZSBmb3IgUmVuZGVyIGFuZCBNZWRpYSBkb21haW4gc2Vw
YXJhdGVseSAqLwpAQCAtNTM4LDcgKzUzOCw3IEBAIGludCBpbnRlbF9ndWNfYXV0aF9odWMoc3Ry
dWN0IGludGVsX2d1YyAqZ3VjLCB1MzIgcnNhX29mZnNldCkKICAqLwogaW50IGludGVsX2d1Y19z
dXNwZW5kKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShndWMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKIAlpbnQgcmV0OwogCXUzMiBzdGF0dXM7CiAJdTMy
IGFjdGlvbltdID0gewpAQCAtNTYyLDcgKzU2Miw3IEBAIGludCBpbnRlbF9ndWNfc3VzcGVuZChz
dHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9
IF9faW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsIFNPRlRfU0NSQVRD
SCgxNCksCisJcmV0ID0gX19pbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLCBT
T0ZUX1NDUkFUQ0goMTQpLAogCQkJCQlJTlRFTF9HVUNfU0xFRVBfU1RBVEVfSU5WQUxJRF9NQVNL
LAogCQkJCQkwLCAwLCAxMCwgJnN0YXR1cyk7CiAJaWYgKHJldCkKQEAgLTY1OCwxNyArNjU4LDE3
IEBAIGludCBpbnRlbF9ndWNfcmVzdW1lKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKICAqLwogc3Ry
dWN0IGk5MTVfdm1hICppbnRlbF9ndWNfYWxsb2NhdGVfdm1hKHN0cnVjdCBpbnRlbF9ndWMgKmd1
YywgdTMyIHNpemUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3Vj
X3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19p
OTE1KGd1Yyk7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkx
NV92bWEgKnZtYTsKIAl1NjQgZmxhZ3M7CiAJaW50IHJldDsKIAotCW9iaiA9IGk5MTVfZ2VtX29i
amVjdF9jcmVhdGVfc2htZW0oZGV2X3ByaXYsIHNpemUpOworCW9iaiA9IGk5MTVfZ2VtX29iamVj
dF9jcmVhdGVfc2htZW0oaTkxNSwgc2l6ZSk7CiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4g
RVJSX0NBU1Qob2JqKTsKIAotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmRldl9wcml2
LT5nZ3R0LnZtLCBOVUxMKTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosICZpOTE1LT5n
Z3R0LnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpCiAJCWdvdG8gZXJyOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfYWRzLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9ndWNfYWRzLmMKaW5kZXggZWNiNjlmYzk0MjE4Li40YWM5ZWQyZGQ0Njcg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19hZHMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfYWRzLmMKQEAgLTg1LDcgKzg1LDcgQEAgc3Ry
dWN0IF9fZ3VjX2Fkc19ibG9iIHsKIAogc3RhdGljIGludCBfX2d1Y19hZHNfaW5pdChzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
Z3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190
b19pOTE1KGd1Yyk7CiAJc3RydWN0IF9fZ3VjX2Fkc19ibG9iICpibG9iOwogCWNvbnN0IHUzMiBz
a2lwcGVkX3NpemUgPSBMUkNfUFBIV1NQX1NaICogUEFHRV9TSVpFICsgTFJfSFdfQ09OVEVYVF9T
SVpFOwogCXUzMiBiYXNlOwpAQCAtMTE1LDE4ICsxMTUsMTggQEAgc3RhdGljIGludCBfX2d1Y19h
ZHNfaW5pdChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiAJCSAqLwogCQlibG9iLT5hZHMuZ29sZGVu
X2NvbnRleHRfbHJjYVtlbmdpbmVfY2xhc3NdID0gMDsKIAkJYmxvYi0+YWRzLmVuZ19zdGF0ZV9z
aXplW2VuZ2luZV9jbGFzc10gPQotCQkJaW50ZWxfZW5naW5lX2NvbnRleHRfc2l6ZShkZXZfcHJp
diwgZW5naW5lX2NsYXNzKSAtCisJCQlpbnRlbF9lbmdpbmVfY29udGV4dF9zaXplKGk5MTUsIGVu
Z2luZV9jbGFzcykgLQogCQkJc2tpcHBlZF9zaXplOwogCX0KIAogCS8qIFN5c3RlbSBpbmZvICov
Ci0JYmxvYi0+c3lzdGVtX2luZm8uc2xpY2VfZW5hYmxlZCA9IGh3ZWlnaHQ4KFJVTlRJTUVfSU5G
TyhkZXZfcHJpdiktPnNzZXUuc2xpY2VfbWFzayk7CisJYmxvYi0+c3lzdGVtX2luZm8uc2xpY2Vf
ZW5hYmxlZCA9IGh3ZWlnaHQ4KFJVTlRJTUVfSU5GTyhpOTE1KS0+c3NldS5zbGljZV9tYXNrKTsK
IAlibG9iLT5zeXN0ZW1faW5mby5yY3NfZW5hYmxlZCA9IDE7CiAJYmxvYi0+c3lzdGVtX2luZm8u
YmNzX2VuYWJsZWQgPSAxOwogCi0JYmxvYi0+c3lzdGVtX2luZm8udmRib3hfZW5hYmxlX21hc2sg
PSBWREJPWF9NQVNLKGRldl9wcml2KTsKLQlibG9iLT5zeXN0ZW1faW5mby52ZWJveF9lbmFibGVf
bWFzayA9IFZFQk9YX01BU0soZGV2X3ByaXYpOwotCWJsb2ItPnN5c3RlbV9pbmZvLnZkYm94X3Nm
Y19zdXBwb3J0X21hc2sgPSBSVU5USU1FX0lORk8oZGV2X3ByaXYpLT52ZGJveF9zZmNfYWNjZXNz
OworCWJsb2ItPnN5c3RlbV9pbmZvLnZkYm94X2VuYWJsZV9tYXNrID0gVkRCT1hfTUFTSyhpOTE1
KTsKKwlibG9iLT5zeXN0ZW1faW5mby52ZWJveF9lbmFibGVfbWFzayA9IFZFQk9YX01BU0soaTkx
NSk7CisJYmxvYi0+c3lzdGVtX2luZm8udmRib3hfc2ZjX3N1cHBvcnRfbWFzayA9IFJVTlRJTUVf
SU5GTyhpOTE1KS0+dmRib3hfc2ZjX2FjY2VzczsKIAogCWJhc2UgPSBpbnRlbF9ndWNfZ2d0dF9v
ZmZzZXQoZ3VjLCBndWMtPmFkc192bWEpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9ndWNfZncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19mdy5j
CmluZGV4IDcyY2RhZmQ5NjM2YS4uMmJlYjkwYzYyYTQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9ndWNfZncuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9ndWNfZncuYwpAQCAtMTI1LDcgKzEyNSw3IEBAIHZvaWQgaW50ZWxfZ3VjX2Z3X2luaXRfZWFy
bHkoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCiBzdGF0aWMgdm9pZCBndWNfcHJlcGFyZV94ZmVy
KHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBndWNfdG9faTkxNShndWMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKIAogCS8qIE11c3QgcHJvZ3JhbSB0aGlzIHJlZ2lzdGVyIGJl
Zm9yZSBsb2FkaW5nIHRoZSB1Y29kZSB3aXRoIERNQSAqLwogCUk5MTVfV1JJVEUoR1VDX1NISU1f
Q09OVFJPTCwgR1VDX0RJU0FCTEVfU1JBTV9JTklUX1RPX1pFUk9FUyB8CkBAIC0xMzUsMTIgKzEz
NSwxMiBAQCBzdGF0aWMgdm9pZCBndWNfcHJlcGFyZV94ZmVyKHN0cnVjdCBpbnRlbF9ndWMgKmd1
YykKIAkJCQkgICAgIEdVQ19FTkFCTEVfUkVBRF9DQUNIRV9GT1JfV09QQ01fREFUQSB8CiAJCQkJ
ICAgICBHVUNfRU5BQkxFX01JQV9DTE9DS19HQVRJTkcpOwogCi0JaWYgKElTX0dFTjlfTFAoZGV2
X3ByaXYpKQorCWlmIChJU19HRU45X0xQKGk5MTUpKQogCQlJOTE1X1dSSVRFKEdFTjlMUF9HVF9Q
TV9DT05GSUcsIEdUX0RPT1JCRUxMX0VOQUJMRSk7CiAJZWxzZQogCQlJOTE1X1dSSVRFKEdFTjlf
R1RfUE1fQ09ORklHLCBHVF9ET09SQkVMTF9FTkFCTEUpOwogCi0JaWYgKElTX0dFTihkZXZfcHJp
diwgOSkpIHsKKwlpZiAoSVNfR0VOKGk5MTUsIDkpKSB7CiAJCS8qIERPUCBDbG9jayBHYXRpbmcg
RW5hYmxlIGZvciBHdUMgY2xvY2tzICovCiAJCUk5MTVfV1JJVEUoR0VON19NSVNDQ1BDVEwsIChH
RU44X0RPUF9DTE9DS19HQVRFX0dVQ19FTkFCTEUgfAogCQkJCQkgICAgSTkxNV9SRUFEKEdFTjdf
TUlTQ0NQQ1RMKSkpOwpAQCAtMTUzLDcgKzE1Myw3IEBAIHN0YXRpYyB2b2lkIGd1Y19wcmVwYXJl
X3hmZXIoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogLyogQ29weSBSU0Egc2lnbmF0dXJlIGZyb20g
dGhlIGZ3IGltYWdlIHRvIEhXIGZvciB2ZXJpZmljYXRpb24gKi8KIHN0YXRpYyB2b2lkIGd1Y194
ZmVyX3JzYShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7CiAJc3RydWN0IGludGVsX3VjX2Z3ICpmdyA9ICZn
dWMtPmZ3OwogCXN0cnVjdCBzZ190YWJsZSAqcGFnZXMgPSBmdy0+b2JqLT5tbS5wYWdlczsKIAl1
MzIgcnNhW1VPU19SU0FfU0NSQVRDSF9DT1VOVF07CkBAIC0xNjgsNyArMTY4LDcgQEAgc3RhdGlj
IHZvaWQgZ3VjX3hmZXJfcnNhKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAogc3RhdGljIGJvb2wg
Z3VjX3hmZXJfY29tcGxldGVkKHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTMyICpzdGF0dXMpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3VjX3RvX2k5MTUoZ3VjKTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7CiAKIAkv
KiBEaWQgd2UgY29tcGxldGUgdGhlIHhmZXI/ICovCiAJKnN0YXR1cyA9IEk5MTVfUkVBRChETUFf
Q1RSTCk7CkBAIC0xODYsNyArMTg2LDcgQEAgc3RhdGljIGJvb2wgZ3VjX3hmZXJfY29tcGxldGVk
KHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTMyICpzdGF0dXMpCiAgKi8KIHN0YXRpYyBpbmxpbmUg
Ym9vbCBndWNfcmVhZHkoc3RydWN0IGludGVsX2d1YyAqZ3VjLCB1MzIgKnN0YXR1cykKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShndWMpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKIAl1MzIgdmFs
ID0gSTkxNV9SRUFEKEdVQ19TVEFUVVMpOwogCXUzMiB1a192YWwgPSB2YWwgJiBHU19VS0VSTkVM
X01BU0s7CiAKQEAgLTIzNCw3ICsyMzQsNyBAQCBzdGF0aWMgaW50IGd1Y193YWl0X3Vjb2RlKHN0
cnVjdCBpbnRlbF9ndWMgKmd1YykKICAqLwogc3RhdGljIGludCBndWNfeGZlcl91Y29kZShzdHJ1
Y3QgaW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1
Y190b19pOTE1KGd1Yyk7CiAJc3RydWN0IGludGVsX3VjX2Z3ICpndWNfZncgPSAmZ3VjLT5mdzsK
IAl1bnNpZ25lZCBsb25nIG9mZnNldDsKIApAQCAtMjY3LDEyICsyNjcsMTIgQEAgc3RhdGljIGlu
dCBndWNfeGZlcl91Y29kZShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiBzdGF0aWMgaW50IGd1Y19m
d194ZmVyKHN0cnVjdCBpbnRlbF91Y19mdyAqZ3VjX2Z3KQogewogCXN0cnVjdCBpbnRlbF9ndWMg
Kmd1YyA9IGNvbnRhaW5lcl9vZihndWNfZncsIHN0cnVjdCBpbnRlbF9ndWMsIGZ3KTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShndWMpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKIAlpbnQgcmV0Owog
CiAJR0VNX0JVR19PTihndWNfZnctPnR5cGUgIT0gSU5URUxfVUNfRldfVFlQRV9HVUMpOwogCi0J
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FL
RV9BTEwpOwogCiAJZ3VjX3ByZXBhcmVfeGZlcihndWMpOwogCkBAIC0yODUsNyArMjg1LDcgQEAg
c3RhdGljIGludCBndWNfZndfeGZlcihzdHJ1Y3QgaW50ZWxfdWNfZncgKmd1Y19mdykKIAogCXJl
dCA9IGd1Y194ZmVyX3Vjb2RlKGd1Yyk7CiAKLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgm
ZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2Fr
ZV9wdXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKIAlyZXR1cm4gcmV0OwogfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX2xvZy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX2xvZy5jCmluZGV4IDY3ZWFkYzgyYzM5Ni4uMzAwZWQ5
NDBmMGI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfbG9nLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX2xvZy5jCkBAIC0zOTAsNyArMzkw
LDcgQEAgdm9pZCBpbnRlbF9ndWNfbG9nX2luaXRfZWFybHkoc3RydWN0IGludGVsX2d1Y19sb2cg
KmxvZykKIHN0YXRpYyBpbnQgZ3VjX2xvZ19yZWxheV9jcmVhdGUoc3RydWN0IGludGVsX2d1Y19s
b2cgKmxvZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSBsb2dfdG9fZ3VjKGxvZyk7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7CiAJc3RydWN0
IHJjaGFuICpndWNfbG9nX3JlbGF5X2NoYW47CiAJc2l6ZV90IG5fc3ViYnVmcywgc3ViYnVmX3Np
emU7CiAJaW50IHJldDsKQEAgLTQwOSw5ICs0MDksOSBAQCBzdGF0aWMgaW50IGd1Y19sb2dfcmVs
YXlfY3JlYXRlKHN0cnVjdCBpbnRlbF9ndWNfbG9nICpsb2cpCiAJbl9zdWJidWZzID0gODsKIAog
CWd1Y19sb2dfcmVsYXlfY2hhbiA9IHJlbGF5X29wZW4oImd1Y19sb2ciLAotCQkJCQlkZXZfcHJp
di0+ZHJtLnByaW1hcnktPmRlYnVnZnNfcm9vdCwKKwkJCQkJaTkxNS0+ZHJtLnByaW1hcnktPmRl
YnVnZnNfcm9vdCwKIAkJCQkJc3ViYnVmX3NpemUsIG5fc3ViYnVmcywKLQkJCQkJJnJlbGF5X2Nh
bGxiYWNrcywgZGV2X3ByaXYpOworCQkJCQkmcmVsYXlfY2FsbGJhY2tzLCBpOTE1KTsKIAlpZiAo
IWd1Y19sb2dfcmVsYXlfY2hhbikgewogCQlEUk1fRVJST1IoIkNvdWxkbid0IGNyZWF0ZSByZWxh
eSBjaGFuIGZvciBHdUMgbG9nZ2luZ1xuIik7CiAKQEAgLTQzNiw3ICs0MzYsNyBAQCBzdGF0aWMg
dm9pZCBndWNfbG9nX3JlbGF5X2Rlc3Ryb3koc3RydWN0IGludGVsX2d1Y19sb2cgKmxvZykKIHN0
YXRpYyB2b2lkIGd1Y19sb2dfY2FwdHVyZV9sb2dzKHN0cnVjdCBpbnRlbF9ndWNfbG9nICpsb2cp
CiB7CiAJc3RydWN0IGludGVsX2d1YyAqZ3VjID0gbG9nX3RvX2d1Yyhsb2cpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd1Y190b19pOTE1KGd1Yyk7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndWNfdG9faTkxNShndWMpOwogCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCiAJZ3VjX3JlYWRfdXBkYXRlX2xvZ19idWZmZXIobG9nKTsKQEAgLTQ0NSw3
ICs0NDUsNyBAQCBzdGF0aWMgdm9pZCBndWNfbG9nX2NhcHR1cmVfbG9ncyhzdHJ1Y3QgaW50ZWxf
Z3VjX2xvZyAqbG9nKQogCSAqIEdlbmVyYWxseSBkZXZpY2UgaXMgZXhwZWN0ZWQgdG8gYmUgYWN0
aXZlIG9ubHkgYXQgdGhpcwogCSAqIHRpbWUsIHNvIGdldC9wdXQgc2hvdWxkIGJlIHJlYWxseSBx
dWljay4KIAkgKi8KLQl3aXRoX2ludGVsX3J1bnRpbWVfcG0oZGV2X3ByaXYsIHdha2VyZWYpCisJ
d2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5MTUsIHdha2VyZWYpCiAJCWd1Y19hY3Rpb25fZmx1c2hf
bG9nX2NvbXBsZXRlKGd1Yyk7CiB9CiAKQEAgLTUwNSw3ICs1MDUsNyBAQCB2b2lkIGludGVsX2d1
Y19sb2dfZGVzdHJveShzdHJ1Y3QgaW50ZWxfZ3VjX2xvZyAqbG9nKQogaW50IGludGVsX2d1Y19s
b2dfc2V0X2xldmVsKHN0cnVjdCBpbnRlbF9ndWNfbG9nICpsb2csIHUzMiBsZXZlbCkKIHsKIAlz
dHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSBsb2dfdG9fZ3VjKGxvZyk7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7CiAJaW50ZWxfd2FrZXJlZl90IHdha2Vy
ZWY7CiAJaW50IHJldCA9IDA7CiAKQEAgLTUxOSwxMiArNTE5LDEyIEBAIGludCBpbnRlbF9ndWNf
bG9nX3NldF9sZXZlbChzdHJ1Y3QgaW50ZWxfZ3VjX2xvZyAqbG9nLCB1MzIgbGV2ZWwpCiAJaWYg
KGxldmVsIDwgR1VDX0xPR19MRVZFTF9ESVNBQkxFRCB8fCBsZXZlbCA+IEdVQ19MT0dfTEVWRUxf
TUFYKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWlm
IChsb2ctPmxldmVsID09IGxldmVsKQogCQlnb3RvIG91dF91bmxvY2s7CiAKLQl3aXRoX2ludGVs
X3J1bnRpbWVfcG0oZGV2X3ByaXYsIHdha2VyZWYpCisJd2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5
MTUsIHdha2VyZWYpCiAJCXJldCA9IGd1Y19hY3Rpb25fY29udHJvbF9sb2coZ3VjLAogCQkJCQkg
ICAgIEdVQ19MT0dfTEVWRUxfSVNfVkVSQk9TRShsZXZlbCksCiAJCQkJCSAgICAgR1VDX0xPR19M
RVZFTF9JU19FTkFCTEVEKGxldmVsKSwKQEAgLTUzNyw3ICs1MzcsNyBAQCBpbnQgaW50ZWxfZ3Vj
X2xvZ19zZXRfbGV2ZWwoc3RydWN0IGludGVsX2d1Y19sb2cgKmxvZywgdTMyIGxldmVsKQogCWxv
Zy0+bGV2ZWwgPSBsZXZlbDsKIAogb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2d1Y19zdWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNf
c3VibWlzc2lvbi5jCmluZGV4IDk3ZjY5NzBkOGRhOC4uMDEzZDg1Mjc4MjcwIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKQEAgLTIwMyw3ICsyMDMsNyBA
QCBzdGF0aWMgc3RydWN0IGd1Y19kb29yYmVsbF9pbmZvICpfX2dldF9kb29yYmVsbChzdHJ1Y3Qg
aW50ZWxfZ3VjX2NsaWVudCAqY2xpZW50KQogCiBzdGF0aWMgYm9vbCBfX2Rvb3JiZWxsX3ZhbGlk
KHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTE2IGRiX2lkKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGd1Y190b19pOTE1KGd1Yyk7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBndWNfdG9faTkxNShndWMpOwogCiAJR0VNX0JVR19PTihkYl9pZCA+PSBH
VUNfTlVNX0RPT1JCRUxMUyk7CiAJcmV0dXJuIEk5MTVfUkVBRChHRU44X0RSQlJFR0woZGJfaWQp
KSAmIEdFTjhfRFJCX1ZBTElEOwpAQCAtMTAxNCw3ICsxMDE0LDcgQEAgc3RhdGljIGJvb2wgZ3Vj
X3ZlcmlmeV9kb29yYmVsbHMoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCiAvKioKICAqIGd1Y19j
bGllbnRfYWxsb2MoKSAtIEFsbG9jYXRlIGFuIGludGVsX2d1Y19jbGllbnQKLSAqIEBkZXZfcHJp
djoJZHJpdmVyIHByaXZhdGUgZGF0YSBzdHJ1Y3R1cmUKKyAqIEBpOTE1Oglkcml2ZXIgcHJpdmF0
ZSBkYXRhIHN0cnVjdHVyZQogICogQGVuZ2luZXM6CVRoZSBzZXQgb2YgZW5naW5lcyB0byBlbmFi
bGUgZm9yIHRoaXMgY2xpZW50CiAgKiBAcHJpb3JpdHk6CWZvdXIgbGV2ZWxzIHByaW9yaXR5IF9D
UklUSUNBTCwgX0hJR0gsIF9OT1JNQUwgYW5kIF9MT1cKICAqCQlUaGUga2VybmVsIGNsaWVudCB0
byByZXBsYWNlIEV4ZWNMaXN0IHN1Ym1pc3Npb24gaXMgY3JlYXRlZCB3aXRoCkBAIC0xMDI2LDEz
ICsxMDI2LDEzIEBAIHN0YXRpYyBib29sIGd1Y192ZXJpZnlfZG9vcmJlbGxzKHN0cnVjdCBpbnRl
bF9ndWMgKmd1YykKICAqIFJldHVybjoJQW4gaW50ZWxfZ3VjX2NsaWVudCBvYmplY3QgaWYgc3Vj
Y2VzcywgZWxzZSBOVUxMLgogICovCiBzdGF0aWMgc3RydWN0IGludGVsX2d1Y19jbGllbnQgKgot
Z3VjX2NsaWVudF9hbGxvYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitndWNf
Y2xpZW50X2FsbG9jKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgdTMyIGVuZ2lu
ZXMsCiAJCSB1MzIgcHJpb3JpdHksCiAJCSBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQog
ewogCXN0cnVjdCBpbnRlbF9ndWNfY2xpZW50ICpjbGllbnQ7Ci0Jc3RydWN0IGludGVsX2d1YyAq
Z3VjID0gJmRldl9wcml2LT5ndWM7CisJc3RydWN0IGludGVsX2d1YyAqZ3VjID0gJmk5MTUtPmd1
YzsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl2b2lkICp2YWRkcjsKIAlpbnQgcmV0OwpAQCAt
MTEyOSwyNyArMTEyOSwyNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgY3R4X3NhdmVfcmVzdG9yZV9k
aXNhYmxlZChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIHN0YXRpYyBpbnQgZ3VjX2NsaWVu
dHNfY3JlYXRlKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShndWMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKIAlzdHJ1Y3QgaW50ZWxfZ3VjX2NsaWVudCAq
Y2xpZW50OwogCiAJR0VNX0JVR19PTihndWMtPmV4ZWNidWZfY2xpZW50KTsKIAlHRU1fQlVHX09O
KGd1Yy0+cHJlZW1wdF9jbGllbnQpOwogCi0JY2xpZW50ID0gZ3VjX2NsaWVudF9hbGxvYyhkZXZf
cHJpdiwKLQkJCQkgIElOVEVMX0lORk8oZGV2X3ByaXYpLT5lbmdpbmVfbWFzaywKKwljbGllbnQg
PSBndWNfY2xpZW50X2FsbG9jKGk5MTUsCisJCQkJICBJTlRFTF9JTkZPKGk5MTUpLT5lbmdpbmVf
bWFzaywKIAkJCQkgIEdVQ19DTElFTlRfUFJJT1JJVFlfS01EX05PUk1BTCwKLQkJCQkgIGRldl9w
cml2LT5rZXJuZWxfY29udGV4dCk7CisJCQkJICBpOTE1LT5rZXJuZWxfY29udGV4dCk7CiAJaWYg
KElTX0VSUihjbGllbnQpKSB7CiAJCURSTV9FUlJPUigiRmFpbGVkIHRvIGNyZWF0ZSBHdUMgY2xp
ZW50IGZvciBzdWJtaXNzaW9uIVxuIik7CiAJCXJldHVybiBQVFJfRVJSKGNsaWVudCk7CiAJfQog
CWd1Yy0+ZXhlY2J1Zl9jbGllbnQgPSBjbGllbnQ7CiAKLQlpZiAoZGV2X3ByaXYtPnByZWVtcHRf
Y29udGV4dCkgewotCQljbGllbnQgPSBndWNfY2xpZW50X2FsbG9jKGRldl9wcml2LAotCQkJCQkg
IElOVEVMX0lORk8oZGV2X3ByaXYpLT5lbmdpbmVfbWFzaywKKwlpZiAoaTkxNS0+cHJlZW1wdF9j
b250ZXh0KSB7CisJCWNsaWVudCA9IGd1Y19jbGllbnRfYWxsb2MoaTkxNSwKKwkJCQkJICBJTlRF
TF9JTkZPKGk5MTUpLT5lbmdpbmVfbWFzaywKIAkJCQkJICBHVUNfQ0xJRU5UX1BSSU9SSVRZX0tN
RF9ISUdILAotCQkJCQkgIGRldl9wcml2LT5wcmVlbXB0X2NvbnRleHQpOworCQkJCQkgIGk5MTUt
PnByZWVtcHRfY29udGV4dCk7CiAJCWlmIChJU19FUlIoY2xpZW50KSkgewogCQkJRFJNX0VSUk9S
KCJGYWlsZWQgdG8gY3JlYXRlIEd1QyBjbGllbnQgZm9yIHByZWVtcHRpb24hXG4iKTsKIAkJCWd1
Y19jbGllbnRfZnJlZShndWMtPmV4ZWNidWZfY2xpZW50KTsKQEAgLTEyNDQsNyArMTI0NCw3IEBA
IHN0YXRpYyB2b2lkIGd1Y19jbGllbnRzX2Rpc2FibGUoc3RydWN0IGludGVsX2d1YyAqZ3VjKQog
ICovCiBpbnQgaW50ZWxfZ3VjX3N1Ym1pc3Npb25faW5pdChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3VjX3RvX2k5MTUoZ3Vj
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7CiAJ
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlk
OwogCWludCByZXQ7CkBAIC0xMjY2LDcgKzEyNjYsNyBAQCBpbnQgaW50ZWxfZ3VjX3N1Ym1pc3Np
b25faW5pdChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiAJaWYgKHJldCkKIAkJZ290byBlcnJfcG9v
bDsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgeworCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCWd1Yy0+cHJlZW1wdF93b3JrW2lkXS5lbmdp
bmUgPSBlbmdpbmU7CiAJCUlOSVRfV09SSygmZ3VjLT5wcmVlbXB0X3dvcmtbaWRdLndvcmssIGlu
amVjdF9wcmVlbXB0X2NvbnRleHQpOwogCX0KQEAgLTEyODAsMTEgKzEyODAsMTEgQEAgaW50IGlu
dGVsX2d1Y19zdWJtaXNzaW9uX2luaXQoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCiB2b2lkIGlu
dGVsX2d1Y19zdWJtaXNzaW9uX2Zpbmkoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd1Y190b19pOTE1KGd1Yyk7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndWNfdG9faTkxNShndWMpOwogCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCWZvcl9l
YWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBpOTE1LCBpZCkKIAkJY2FuY2VsX3dvcmtfc3luYygmZ3VjLT5wcmVlbXB0X3dvcmtbaWRdLndv
cmspOwogCiAJZ3VjX2NsaWVudHNfZGVzdHJveShndWMpOwpAQCAtMTI5NCw5ICsxMjk0LDkgQEAg
dm9pZCBpbnRlbF9ndWNfc3VibWlzc2lvbl9maW5pKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAkJ
Z3VjX3N0YWdlX2Rlc2NfcG9vbF9kZXN0cm95KGd1Yyk7CiB9CiAKLXN0YXRpYyB2b2lkIGd1Y19p
bnRlcnJ1cHRzX2NhcHR1cmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgZ3VjX2ludGVycnVwdHNfY2FwdHVyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsK
KwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQgaXJx
czsKQEAgLTEzMDUsNyArMTMwNSw3IEBAIHN0YXRpYyB2b2lkIGd1Y19pbnRlcnJ1cHRzX2NhcHR1
cmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIHRvIEd1QwogCSAqLwog
CWlycXMgPSBfTUFTS0VEX0JJVF9FTkFCTEUoR0ZYX0lOVEVSUlVQVF9TVEVFUklORyk7Ci0JZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgZGV2X3ByaXYsIGlkKQorCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGk5MTUsIGlkKQogCQlFTkdJTkVfV1JJVEUoZW5naW5lLCBSSU5HX01PREVfR0VONywgaXJx
cyk7CiAKIAkvKiByb3V0ZSBVU0VSX0lOVEVSUlVQVCB0byBIb3N0LCBhbGwgb3RoZXJzIGFyZSBz
ZW50IHRvIEd1Qy4gKi8KQEAgLTEzMzksOSArMTMzOSw5IEBAIHN0YXRpYyB2b2lkIGd1Y19pbnRl
cnJ1cHRzX2NhcHR1cmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJwcy0+
cG1faW50cm1za19tYnogJj0gfkdFTjhfUE1JTlRSX0RJU0FCTEVfUkVESVJFQ1RfVE9fR1VDOwog
fQogCi1zdGF0aWMgdm9pZCBndWNfaW50ZXJydXB0c19yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGd1Y19pbnRlcnJ1cHRzX3JlbGVhc2Uoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0g
JmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0
X3BtLnJwczsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQ7CiAJaW50IGlycXM7CkBAIC0xMzUyLDcgKzEzNTIsNyBAQCBzdGF0aWMgdm9p
ZCBndWNfaW50ZXJydXB0c19yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkgKi8KIAlpcnFzID0gX01BU0tFRF9GSUVMRChHRlhfRk9SV0FSRF9WQkxBTktfTUFTSywg
R0ZYX0ZPUldBUkRfVkJMQU5LX05FVkVSKTsKIAlpcnFzIHw9IF9NQVNLRURfQklUX0RJU0FCTEUo
R0ZYX0lOVEVSUlVQVF9TVEVFUklORyk7Ci0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZGV2X3By
aXYsIGlkKQorCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQlFTkdJTkVfV1JJ
VEUoZW5naW5lLCBSSU5HX01PREVfR0VONywgaXJxcyk7CiAKIAkvKiByb3V0ZSBhbGwgR1QgaW50
ZXJydXB0cyB0byB0aGUgaG9zdCAqLwpAQCAtMTQwOCw3ICsxNDA4LDcgQEAgc3RhdGljIHZvaWQg
Z3VjX3NldF9kZWZhdWx0X3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
KQogCiBpbnQgaW50ZWxfZ3VjX3N1Ym1pc3Npb25fZW5hYmxlKHN0cnVjdCBpbnRlbF9ndWMgKmd1
YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShn
dWMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsK
IAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQg
aWQ7CiAJaW50IGVycjsKQEAgLTE0MzMsOSArMTQzMyw5IEBAIGludCBpbnRlbF9ndWNfc3VibWlz
c2lvbl9lbmFibGUoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCQlyZXR1cm4gZXJyOwogCiAJLyog
VGFrZSBvdmVyIGZyb20gbWFudWFsIGNvbnRyb2wgb2YgRUxTUCAoZXhlY2xpc3RzKSAqLwotCWd1
Y19pbnRlcnJ1cHRzX2NhcHR1cmUoZGV2X3ByaXYpOworCWd1Y19pbnRlcnJ1cHRzX2NhcHR1cmUo
aTkxNSk7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBkZXZfcHJpdiwgaWQpIHsKKwlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQllbmdpbmUtPnNldF9kZWZhdWx0X3N1
Ym1pc3Npb24gPSBndWNfc2V0X2RlZmF1bHRfc3VibWlzc2lvbjsKIAkJZW5naW5lLT5zZXRfZGVm
YXVsdF9zdWJtaXNzaW9uKGVuZ2luZSk7CiAJfQpAQCAtMTQ0NSwxMSArMTQ0NSwxMSBAQCBpbnQg
aW50ZWxfZ3VjX3N1Ym1pc3Npb25fZW5hYmxlKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAogdm9p
ZCBpbnRlbF9ndWNfc3VibWlzc2lvbl9kaXNhYmxlKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShndWMpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKIAotCUdF
TV9CVUdfT04oZGV2X3ByaXYtPmd0LmF3YWtlKTsgLyogR1Qgc2hvdWxkIGJlIHBhcmtlZCBmaXJz
dCAqLworCUdFTV9CVUdfT04oaTkxNS0+Z3QuYXdha2UpOyAvKiBHVCBzaG91bGQgYmUgcGFya2Vk
IGZpcnN0ICovCiAKLQlndWNfaW50ZXJydXB0c19yZWxlYXNlKGRldl9wcml2KTsKKwlndWNfaW50
ZXJydXB0c19yZWxlYXNlKGk5MTUpOwogCWd1Y19jbGllbnRzX2Rpc2FibGUoZ3VjKTsKIH0KIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3Z0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9ndnQuYwppbmRleCAxZDdkMjZlNGNmMTQuLmI1MGQzMWEyZTA5NSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3Z0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3Z0LmMKQEAgLTM5LDE3ICszOSwxNyBAQAogICogZG9jIGlz
IGF2YWlsYWJsZSBvbiBodHRwczovLzAxLm9yZy9ncm91cC8yMjMwL2RvY3VtZW50YXRpb24tbGlz
dC4KICAqLwogCi1zdGF0aWMgYm9vbCBpc19zdXBwb3J0ZWRfZGV2aWNlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBib29sIGlzX3N1cHBvcnRlZF9kZXZpY2Uoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKElTX0JST0FEV0VMTChkZXZfcHJp
dikpCisJaWYgKElTX0JST0FEV0VMTChpOTE1KSkKIAkJcmV0dXJuIHRydWU7Ci0JaWYgKElTX1NL
WUxBS0UoZGV2X3ByaXYpKQorCWlmIChJU19TS1lMQUtFKGk5MTUpKQogCQlyZXR1cm4gdHJ1ZTsK
LQlpZiAoSVNfS0FCWUxBS0UoZGV2X3ByaXYpKQorCWlmIChJU19LQUJZTEFLRShpOTE1KSkKIAkJ
cmV0dXJuIHRydWU7Ci0JaWYgKElTX0JST1hUT04oZGV2X3ByaXYpKQorCWlmIChJU19CUk9YVE9O
KGk5MTUpKQogCQlyZXR1cm4gdHJ1ZTsKLQlpZiAoSVNfQ09GRkVFTEFLRShkZXZfcHJpdikpCisJ
aWYgKElTX0NPRkZFRUxBS0UoaTkxNSkpCiAJCXJldHVybiB0cnVlOwogCiAJcmV0dXJuIGZhbHNl
OwpAQCAtNTcsMjEgKzU3LDIxIEBAIHN0YXRpYyBib29sIGlzX3N1cHBvcnRlZF9kZXZpY2Uoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAvKioKICAqIGludGVsX2d2dF9zYW5p
dGl6ZV9vcHRpb25zIC0gc2FuaXRpemUgR1ZUIHJlbGF0ZWQgb3B0aW9ucwotICogQGRldl9wcml2
OiBkcm0gaTkxNSBwcml2YXRlIGRhdGEKKyAqIEBpOTE1OiBkcm0gaTkxNSBwcml2YXRlIGRhdGEK
ICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhdCB0aGUgaTkxNSBvcHRpb25zIHNhbml0
aXplIHN0YWdlLgogICovCi12b2lkIGludGVsX2d2dF9zYW5pdGl6ZV9vcHRpb25zKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfZ3Z0X3Nhbml0aXplX29wdGlv
bnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJaWYgKCFpOTE1X21vZHBhcmFt
cy5lbmFibGVfZ3Z0KQogCQlyZXR1cm47CiAKLQlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoZGV2X3By
aXYpKSB7CisJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5MTUpKSB7CiAJCURSTV9JTkZPKCJHVlQt
ZyBpcyBkaXNhYmxlZCBmb3IgZ3Vlc3RcbiIpOwogCQlnb3RvIGJhaWw7CiAJfQogCi0JaWYgKCFp
c19zdXBwb3J0ZWRfZGV2aWNlKGRldl9wcml2KSkgeworCWlmICghaXNfc3VwcG9ydGVkX2Rldmlj
ZShpOTE1KSkgewogCQlEUk1fSU5GTygiVW5zdXBwb3J0ZWQgZGV2aWNlLiBHVlQtZyBpcyBkaXNh
YmxlZFxuIik7CiAJCWdvdG8gYmFpbDsKIAl9CkBAIC04Myw3ICs4Myw3IEBAIHZvaWQgaW50ZWxf
Z3Z0X3Nhbml0aXplX29wdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CiAvKioKICAqIGludGVsX2d2dF9pbml0IC0gaW5pdGlhbGl6ZSBHVlQgY29tcG9uZW50cwotICog
QGRldl9wcml2OiBkcm0gaTkxNSBwcml2YXRlIGRhdGEKKyAqIEBpOTE1OiBkcm0gaTkxNSBwcml2
YXRlIGRhdGEKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhdCB0aGUgaW5pdGlhbGl6
YXRpb24gc3RhZ2UgdG8gY3JlYXRlIGEgR1ZUIGRldmljZS4KICAqCkBAIC05MSw3ICs5MSw3IEBA
IHZvaWQgaW50ZWxfZ3Z0X3Nhbml0aXplX29wdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogICogWmVybyBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBlcnJvciBjb2RlIGlmIGZh
aWxlZC4KICAqCiAgKi8KLWludCBpbnRlbF9ndnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitpbnQgaW50ZWxfZ3Z0X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJaW50IHJldDsKIApAQCAtMTAzLDEyICsxMDMsMTIgQEAgaW50IGludGVsX2d2
dF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJcmV0dXJuIDA7CiAJ
fQogCi0JaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oZGV2X3ByaXYpKSB7CisJaWYgKFVTRVNfR1VD
X1NVQk1JU1NJT04oaTkxNSkpIHsKIAkJRFJNX0VSUk9SKCJpOTE1IEdWVC1nIGxvYWRpbmcgZmFp
bGVkIGR1ZSB0byBHcmFwaGljcyB2aXJ0dWFsaXphdGlvbiBpcyBub3QgeWV0IHN1cHBvcnRlZCB3
aXRoIEd1QyBzdWJtaXNzaW9uXG4iKTsKIAkJcmV0dXJuIC1FSU87CiAJfQogCi0JcmV0ID0gaW50
ZWxfZ3Z0X2luaXRfZGV2aWNlKGRldl9wcml2KTsKKwlyZXQgPSBpbnRlbF9ndnRfaW5pdF9kZXZp
Y2UoaTkxNSk7CiAJaWYgKHJldCkgewogCQlEUk1fREVCVUdfRFJJVkVSKCJGYWlsIHRvIGluaXQg
R1ZUIGRldmljZVxuIik7CiAJCWdvdG8gYmFpbDsKQEAgLTEyMywxNSArMTIzLDE1IEBAIGludCBp
bnRlbF9ndnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIC8qKgog
ICogaW50ZWxfZ3Z0X2NsZWFudXAgLSBjbGVhbnVwIEdWVCBjb21wb25lbnRzIHdoZW4gaTkxNSBk
cml2ZXIgaXMgdW5sb2FkaW5nCi0gKiBAZGV2X3ByaXY6IGRybSBpOTE1IHByaXZhdGUgKgorICog
QGk5MTU6IGRybSBpOTE1IHByaXZhdGUgKgogICoKICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVk
IGF0IHRoZSBpOTE1IGRyaXZlciB1bmxvYWRpbmcgc3RhZ2UsIHRvIHNodXRkb3duCiAgKiBHVlQg
Y29tcG9uZW50cyBhbmQgcmVsZWFzZSB0aGUgcmVsYXRlZCByZXNvdXJjZXMuCiAgKi8KLXZvaWQg
aW50ZWxfZ3Z0X2NsZWFudXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9p
ZCBpbnRlbF9ndnRfY2xlYW51cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlp
ZiAoIWludGVsX2d2dF9hY3RpdmUoZGV2X3ByaXYpKQorCWlmICghaW50ZWxfZ3Z0X2FjdGl2ZShp
OTE1KSkKIAkJcmV0dXJuOwogCi0JaW50ZWxfZ3Z0X2NsZWFuX2RldmljZShkZXZfcHJpdik7CisJ
aW50ZWxfZ3Z0X2NsZWFuX2RldmljZShpOTE1KTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2d2dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3Z0LmgK
aW5kZXggNjFiMjQ2NDcwMjgyLi42ZjgxZTI2Y2I5YWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2d2dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d2
dC5oCkBAIC0yNywyMiArMjcsMjIgQEAKIHN0cnVjdCBpbnRlbF9ndnQ7CiAKICNpZmRlZiBDT05G
SUdfRFJNX0k5MTVfR1ZUCi1pbnQgaW50ZWxfZ3Z0X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfZ3Z0X2NsZWFudXAoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKLWludCBpbnRlbF9ndnRfaW5pdF9kZXZpY2Uoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfZ3Z0X2NsZWFuX2RldmljZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaW50IGludGVsX2d2dF9pbml0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfZ3Z0X2NsZWFudXAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworaW50IGludGVsX2d2dF9pbml0X2RldmljZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2d2dF9jbGVhbl9kZXZpY2Uo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogaW50IGludGVsX2d2dF9pbml0X2hvc3Qo
dm9pZCk7Ci12b2lkIGludGVsX2d2dF9zYW5pdGl6ZV9vcHRpb25zKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX2d2dF9zYW5pdGl6ZV9vcHRpb25zKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKICNlbHNlCi1zdGF0aWMgaW5saW5lIGludCBpbnRl
bF9ndnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW5s
aW5lIGludCBpbnRlbF9ndnRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAlyZXR1cm4gMDsKIH0KLXN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9ndnRfY2xlYW51cChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxf
Z3Z0X2NsZWFudXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiB9CiAKLXN0YXRp
YyBpbmxpbmUgdm9pZCBpbnRlbF9ndnRfc2FuaXRpemVfb3B0aW9ucyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZ3Z0X3Nhbml0aXpl
X29wdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiB9CiAjZW5kaWYKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2hkY3AuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2hkY3AuYwppbmRleCBiYzNhOTRkNDkxYzQuLjdkZjVmMTliNTJkNSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaGRjcC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2hkY3AuYwpAQCAtODEsNyArODEsNyBAQCBib29sIGludGVs
X2hkY3BfY2FwYWJsZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiAvKiBJcyBI
RENQMi4yIGNhcGFibGUgb24gUGxhdGZvcm0gYW5kIFNpbmsgKi8KIGJvb2wgaW50ZWxfaGRjcDJf
Y2FwYWJsZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNl
LmRldik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBjb25u
X3RvX2RpZ19wb3J0KGNvbm5lY3Rvcik7CiAJc3RydWN0IGludGVsX2hkY3AgKmhkY3AgPSAmY29u
bmVjdG9yLT5oZGNwOwogCWJvb2wgY2FwYWJsZSA9IGZhbHNlOwpAQCAtOTEsMTIgKzkxLDEyIEBA
IGJvb2wgaW50ZWxfaGRjcDJfY2FwYWJsZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IpCiAJCXJldHVybiBmYWxzZTsKIAogCS8qIE1FSSBpbnRlcmZhY2UgaXMgc29saWQgKi8KLQlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+aGRjcF9jb21wX211dGV4KTsKLQlpZiAoIWRldl9wcml2LT5o
ZGNwX2NvbXBfYWRkZWQgfHwgICFkZXZfcHJpdi0+aGRjcF9tYXN0ZXIpIHsKLQkJbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+aGRjcF9jb21wX211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5oZGNw
X2NvbXBfbXV0ZXgpOworCWlmICghaTkxNS0+aGRjcF9jb21wX2FkZGVkIHx8ICAhaTkxNS0+aGRj
cF9tYXN0ZXIpIHsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCQly
ZXR1cm4gZmFsc2U7CiAJfQotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRl
eCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCiAJLyogU2luaydz
IGNhcGFiaWxpdHkgZm9yIEhEQ1AyLjIgKi8KIAloZGNwLT5zaGltLT5oZGNwXzJfMl9jYXBhYmxl
KGludGVsX2RpZ19wb3J0LCAmY2FwYWJsZSk7CkBAIC0xMDYsNyArMTA2LDcgQEAgYm9vbCBpbnRl
bF9oZGNwMl9jYXBhYmxlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAogc3Rh
dGljIGlubGluZSBib29sIGludGVsX2hkY3BfaW5fdXNlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGNvbm5l
Y3Rvci0+ZW5jb2Rlci0+cG9ydDsKIAl1MzIgcmVnOwogCkBAIC0xMTYsNyArMTE2LDcgQEAgc3Rh
dGljIGlubGluZSBib29sIGludGVsX2hkY3BfaW5fdXNlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmNvbm5lY3RvcikKIAogc3RhdGljIGlubGluZSBib29sIGludGVsX2hkY3AyX2luX3VzZShzdHJ1
Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJZW51
bSBwb3J0IHBvcnQgPSBjb25uZWN0b3ItPmVuY29kZXItPnBvcnQ7CiAJdTMyIHJlZzsKIApAQCAt
MTQ1LDkgKzE0NSw5IEBAIHN0YXRpYyBpbnQgaW50ZWxfaGRjcF9wb2xsX2tzdl9maWZvKHN0cnVj
dCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCXJldHVybiAwOwogfQogCi1z
dGF0aWMgYm9vbCBoZGNwX2tleV9sb2FkYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitzdGF0aWMgYm9vbCBoZGNwX2tleV9sb2FkYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zICpwb3dlcl9kb21haW5z
ID0gJmRldl9wcml2LT5wb3dlcl9kb21haW5zOworCXN0cnVjdCBpOTE1X3Bvd2VyX2RvbWFpbnMg
KnBvd2VyX2RvbWFpbnMgPSAmaTkxNS0+cG93ZXJfZG9tYWluczsKIAlzdHJ1Y3QgaTkxNV9wb3dl
cl93ZWxsICpwb3dlcl93ZWxsOwogCWVudW0gaTkxNV9wb3dlcl93ZWxsX2lkIGlkOwogCWJvb2wg
ZW5hYmxlZCA9IGZhbHNlOwpAQCAtMTU2LDcgKzE1Niw3IEBAIHN0YXRpYyBib29sIGhkY3Bfa2V5
X2xvYWRhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBPbiBIU1cg
YW5kIEJEVywgRGlzcGxheSBIVyBsb2FkcyB0aGUgS2V5IGFzIHNvb24gYXMgRGlzcGxheSByZXN1
bWVzLgogCSAqIE9uIGFsbCBCWFQrLCBTVyBjYW4gbG9hZCB0aGUga2V5cyBvbmx5IHdoZW4gdGhl
IFBXIzEgaXMgdHVybmVkIG9uLgogCSAqLwotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJ
U19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCWlmIChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FE
V0VMTChpOTE1KSkKIAkJaWQgPSBIU1dfRElTUF9QV19HTE9CQUw7CiAJZWxzZQogCQlpZCA9IFNL
TF9ESVNQX1BXXzE7CkBAIC0xNjQsOSArMTY0LDkgQEAgc3RhdGljIGJvb2wgaGRjcF9rZXlfbG9h
ZGFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCW11dGV4X2xvY2soJnBv
d2VyX2RvbWFpbnMtPmxvY2spOwogCiAJLyogUEcxIChwb3dlciB3ZWxsICMxKSBuZWVkcyB0byBi
ZSBlbmFibGVkICovCi0JZm9yX2VhY2hfcG93ZXJfd2VsbChkZXZfcHJpdiwgcG93ZXJfd2VsbCkg
eworCWZvcl9lYWNoX3Bvd2VyX3dlbGwoaTkxNSwgcG93ZXJfd2VsbCkgewogCQlpZiAocG93ZXJf
d2VsbC0+ZGVzYy0+aWQgPT0gaWQpIHsKLQkJCWVuYWJsZWQgPSBwb3dlcl93ZWxsLT5kZXNjLT5v
cHMtPmlzX2VuYWJsZWQoZGV2X3ByaXYsCisJCQllbmFibGVkID0gcG93ZXJfd2VsbC0+ZGVzYy0+
b3BzLT5pc19lbmFibGVkKGk5MTUsCiAJCQkJCQkJCSAgICBwb3dlcl93ZWxsKTsKIAkJCWJyZWFr
OwogCQl9CkBAIC0xODIsMTQgKzE4MiwxNCBAQCBzdGF0aWMgYm9vbCBoZGNwX2tleV9sb2FkYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIGVuYWJsZWQ7CiB9
CiAKLXN0YXRpYyB2b2lkIGludGVsX2hkY3BfY2xlYXJfa2V5cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbnRlbF9oZGNwX2NsZWFyX2tleXMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJSTkxNV9XUklURShIRENQX0tFWV9DT05GLCBI
RENQX0NMRUFSX0tFWVNfVFJJR0dFUik7CiAJSTkxNV9XUklURShIRENQX0tFWV9TVEFUVVMsIEhE
Q1BfS0VZX0xPQURfRE9ORSB8IEhEQ1BfS0VZX0xPQURfU1RBVFVTIHwKIAkJICAgSERDUF9GVVNF
X0lOX1BST0dSRVNTIHwgSERDUF9GVVNFX0VSUk9SIHwgSERDUF9GVVNFX0RPTkUpOwogfQogCi1z
dGF0aWMgaW50IGludGVsX2hkY3BfbG9hZF9rZXlzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyBpbnQgaW50ZWxfaGRjcF9sb2FkX2tleXMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IHJldDsKIAl1MzIgdmFsOwpAQCAtMjAyLDcgKzIwMiw3
IEBAIHN0YXRpYyBpbnQgaW50ZWxfaGRjcF9sb2FkX2tleXMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCSAqIE9uIEhTVyBhbmQgQkRXIEhXIGxvYWRzIHRoZSBIRENQMS40IEtl
eSB3aGVuIERpc3BsYXkgY29tZXMKIAkgKiBvdXQgb2YgcmVzZXQuIFNvIGlmIEtleSBpcyBub3Qg
YWxyZWFkeSBsb2FkZWQsIGl0cyBhbiBlcnJvciBzdGF0ZS4KIAkgKi8KLQlpZiAoSVNfSEFTV0VM
TChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKKwlpZiAoSVNfSEFTV0VMTChp
OTE1KSB8fCBJU19CUk9BRFdFTEwoaTkxNSkpCiAJCWlmICghKEk5MTVfUkVBRChIRENQX0tFWV9T
VEFUVVMpICYgSERDUF9LRVlfTE9BRF9ET05FKSkKIAkJCXJldHVybiAtRU5YSU87CiAKQEAgLTIx
Myw4ICsyMTMsOCBAQCBzdGF0aWMgaW50IGludGVsX2hkY3BfbG9hZF9rZXlzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBwbGF0Zm9ybXMgZXhjZXB0IEJYVCBhbmQgR0xL
LCBkaWZmZXIgaW4gdGhlIGtleSBsb2FkIHRyaWdnZXIgcHJvY2VzcwogCSAqIGZyb20gb3RoZXIg
cGxhdGZvcm1zLiBTbyBHRU45X0JDIHVzZXMgdGhlIEdUIERyaXZlciBNYWlsYm94IGkvZi4KIAkg
Ki8KLQlpZiAoSVNfR0VOOV9CQyhkZXZfcHJpdikpIHsKLQkJcmV0ID0gc2FuZHlicmlkZ2VfcGNv
ZGVfd3JpdGUoZGV2X3ByaXYsCisJaWYgKElTX0dFTjlfQkMoaTkxNSkpIHsKKwkJcmV0ID0gc2Fu
ZHlicmlkZ2VfcGNvZGVfd3JpdGUoaTkxNSwKIAkJCQkJICAgICAgU0tMX1BDT0RFX0xPQURfSERD
UF9LRVlTLCAxKTsKIAkJaWYgKHJldCkgewogCQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gaW5pdGlh
dGUgSERDUCBrZXkgbG9hZCAoJWQpXG4iLApAQCAtMjI2LDcgKzIyNiw3IEBAIHN0YXRpYyBpbnQg
aW50ZWxfaGRjcF9sb2FkX2tleXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CX0KIAogCS8qIFdhaXQgZm9yIHRoZSBrZXlzIHRvIGxvYWQgKDUwMHVzKSAqLwotCXJldCA9IF9f
aW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsIEhEQ1BfS0VZX1NUQVRV
UywKKwlyZXQgPSBfX2ludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsIEhEQ1Bf
S0VZX1NUQVRVUywKIAkJCQkJSERDUF9LRVlfTE9BRF9ET05FLCBIRENQX0tFWV9MT0FEX0RPTkUs
CiAJCQkJCTEwLCAxLCAmdmFsKTsKIAlpZiAocmV0KQpAQCAtMjQxLDEwICsyNDEsMTAgQEAgc3Rh
dGljIGludCBpbnRlbF9oZGNwX2xvYWRfa2V5cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiB9CiAKIC8qIFJldHVybnMgdXBkYXRlZCBTSEEtMSBpbmRleCAqLwotc3RhdGljIGlu
dCBpbnRlbF93cml0ZV9zaGFfdGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IHUzMiBzaGFfdGV4dCkKK3N0YXRpYyBpbnQgaW50ZWxfd3JpdGVfc2hhX3RleHQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBzaGFfdGV4dCkKIHsKIAlJOTE1X1dSSVRFKEhEQ1Bf
U0hBX1RFWFQsIHNoYV90ZXh0KTsKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9w
cml2LT51bmNvcmUsIEhEQ1BfUkVQX0NUTCwKKwlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIo
Jmk5MTUtPnVuY29yZSwgSERDUF9SRVBfQ1RMLAogCQkJCSAgICBIRENQX1NIQTFfUkVBRFksIEhE
Q1BfU0hBMV9SRUFEWSwgMSkpIHsKIAkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBmb3Ig
U0hBMSByZWFkeVxuIik7CiAJCXJldHVybiAtRVRJTUVET1VUOwpAQCAtMjc5LDExICsyNzksMTEg
QEAgaW50IGludGVsX2hkY3BfdmFsaWRhdGVfdl9wcmltZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9w
b3J0ICppbnRlbF9kaWdfcG9ydCwKIAkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfaGRjcF9zaGltICpz
aGltLAogCQkJCXU4ICprc3ZfZmlmbywgdTggbnVtX2Rvd25zdHJlYW0sIHU4ICpic3RhdHVzKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNTsKIAl1MzIgdnByaW1lLCBzaGFfdGV4dCwgc2hhX2xlZnRvdmVycywgcmVw
X2N0bDsKIAlpbnQgcmV0LCBpLCBqLCBzaGFfaWR4OwogCi0JZGV2X3ByaXYgPSBpbnRlbF9kaWdf
cG9ydC0+YmFzZS5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CisJaTkxNSA9IGludGVsX2RpZ19wb3J0
LT5iYXNlLmJhc2UuZGV2LT5kZXZfcHJpdmF0ZTsKIAogCS8qIFByb2Nlc3MgVicgdmFsdWVzIGZy
b20gdGhlIHJlY2VpdmVyICovCiAJZm9yIChpID0gMDsgaSA8IERSTV9IRENQX1ZfUFJJTUVfTlVN
X1BBUlRTOyBpKyspIHsKQEAgLTMxNyw3ICszMTcsNyBAQCBpbnQgaW50ZWxfaGRjcF92YWxpZGF0
ZV92X3ByaW1lKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCQlm
b3IgKGogPSAwOyBqIDwgc2hhX2VtcHR5OyBqKyspCiAJCQlzaGFfdGV4dCB8PSBrc3Zbal0gPDwg
KChzaXplb2Yoc2hhX3RleHQpIC0gaiAtIDEpICogOCk7CiAKLQkJcmV0ID0gaW50ZWxfd3JpdGVf
c2hhX3RleHQoZGV2X3ByaXYsIHNoYV90ZXh0KTsKKwkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3Rl
eHQoaTkxNSwgc2hhX3RleHQpOwogCQlpZiAocmV0IDwgMCkKIAkJCXJldHVybiByZXQ7CiAKQEAg
LTM0MCw3ICszNDAsNyBAQCBpbnQgaW50ZWxfaGRjcF92YWxpZGF0ZV92X3ByaW1lKHN0cnVjdCBp
bnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCQlpZiAoc2l6ZW9mKHNoYV90ZXh0
KSA+IHNoYV9sZWZ0b3ZlcnMpCiAJCQljb250aW51ZTsKIAotCQlyZXQgPSBpbnRlbF93cml0ZV9z
aGFfdGV4dChkZXZfcHJpdiwgc2hhX3RleHQpOworCQlyZXQgPSBpbnRlbF93cml0ZV9zaGFfdGV4
dChpOTE1LCBzaGFfdGV4dCk7CiAJCWlmIChyZXQgPCAwKQogCQkJcmV0dXJuIHJldDsKIAkJc2hh
X2xlZnRvdmVycyA9IDA7CkBAIC0zNTcsNyArMzU3LDcgQEAgaW50IGludGVsX2hkY3BfdmFsaWRh
dGVfdl9wcmltZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKIAlp
ZiAoc2hhX2xlZnRvdmVycyA9PSAwKSB7CiAJCS8qIFdyaXRlIDE2IGJpdHMgb2YgdGV4dCwgMTYg
Yml0cyBvZiBNMCAqLwogCQlJOTE1X1dSSVRFKEhEQ1BfUkVQX0NUTCwgcmVwX2N0bCB8IEhEQ1Bf
U0hBMV9URVhUXzE2KTsKLQkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoZGV2X3ByaXYsCisJ
CXJldCA9IGludGVsX3dyaXRlX3NoYV90ZXh0KGk5MTUsCiAJCQkJCSAgIGJzdGF0dXNbMF0gPDwg
OCB8IGJzdGF0dXNbMV0pOwogCQlpZiAocmV0IDwgMCkKIAkJCXJldHVybiByZXQ7CkBAIC0zNjUs
MTQgKzM2NSwxNCBAQCBpbnQgaW50ZWxfaGRjcF92YWxpZGF0ZV92X3ByaW1lKHN0cnVjdCBpbnRl
bF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCiAJCS8qIFdyaXRlIDMyIGJpdHMgb2Yg
TTAgKi8KIAkJSTkxNV9XUklURShIRENQX1JFUF9DVEwsIHJlcF9jdGwgfCBIRENQX1NIQTFfVEVY
VF8wKTsKLQkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoZGV2X3ByaXYsIDApOworCQlyZXQg
PSBpbnRlbF93cml0ZV9zaGFfdGV4dChpOTE1LCAwKTsKIAkJaWYgKHJldCA8IDApCiAJCQlyZXR1
cm4gcmV0OwogCQlzaGFfaWR4ICs9IHNpemVvZihzaGFfdGV4dCk7CiAKIAkJLyogV3JpdGUgMTYg
Yml0cyBvZiBNMCAqLwogCQlJOTE1X1dSSVRFKEhEQ1BfUkVQX0NUTCwgcmVwX2N0bCB8IEhEQ1Bf
U0hBMV9URVhUXzE2KTsKLQkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoZGV2X3ByaXYsIDAp
OworCQlyZXQgPSBpbnRlbF93cml0ZV9zaGFfdGV4dChpOTE1LCAwKTsKIAkJaWYgKHJldCA8IDAp
CiAJCQlyZXR1cm4gcmV0OwogCQlzaGFfaWR4ICs9IHNpemVvZihzaGFfdGV4dCk7CkBAIC0zODMs
MjEgKzM4MywyMSBAQCBpbnQgaW50ZWxfaGRjcF92YWxpZGF0ZV92X3ByaW1lKHN0cnVjdCBpbnRl
bF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCQlzaGFfdGV4dCB8PSBic3RhdHVzWzBd
IDw8IDE2IHwgYnN0YXR1c1sxXSA8PCA4OwogCQkvKiBPbmx5IDI0LWJpdHMgb2YgZGF0YSwgbXVz
dCBiZSBpbiB0aGUgTFNCICovCiAJCXNoYV90ZXh0ID0gKHNoYV90ZXh0ICYgMHhmZmZmZmYwMCkg
Pj4gODsKLQkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoZGV2X3ByaXYsIHNoYV90ZXh0KTsK
KwkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoaTkxNSwgc2hhX3RleHQpOwogCQlpZiAocmV0
IDwgMCkKIAkJCXJldHVybiByZXQ7CiAJCXNoYV9pZHggKz0gc2l6ZW9mKHNoYV90ZXh0KTsKIAog
CQkvKiBXcml0ZSAzMiBiaXRzIG9mIE0wICovCiAJCUk5MTVfV1JJVEUoSERDUF9SRVBfQ1RMLCBy
ZXBfY3RsIHwgSERDUF9TSEExX1RFWFRfMCk7Ci0JCXJldCA9IGludGVsX3dyaXRlX3NoYV90ZXh0
KGRldl9wcml2LCAwKTsKKwkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoaTkxNSwgMCk7CiAJ
CWlmIChyZXQgPCAwKQogCQkJcmV0dXJuIHJldDsKIAkJc2hhX2lkeCArPSBzaXplb2Yoc2hhX3Rl
eHQpOwogCiAJCS8qIFdyaXRlIDI0IGJpdHMgb2YgTTAgKi8KIAkJSTkxNV9XUklURShIRENQX1JF
UF9DVEwsIHJlcF9jdGwgfCBIRENQX1NIQTFfVEVYVF84KTsKLQkJcmV0ID0gaW50ZWxfd3JpdGVf
c2hhX3RleHQoZGV2X3ByaXYsIDApOworCQlyZXQgPSBpbnRlbF93cml0ZV9zaGFfdGV4dChpOTE1
LCAwKTsKIAkJaWYgKHJldCA8IDApCiAJCQlyZXR1cm4gcmV0OwogCQlzaGFfaWR4ICs9IHNpemVv
ZihzaGFfdGV4dCk7CkBAIC00MDYsNyArNDA2LDcgQEAgaW50IGludGVsX2hkY3BfdmFsaWRhdGVf
dl9wcmltZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKIAkJLyog
V3JpdGUgMzIgYml0cyBvZiB0ZXh0ICovCiAJCUk5MTVfV1JJVEUoSERDUF9SRVBfQ1RMLCByZXBf
Y3RsIHwgSERDUF9TSEExX1RFWFRfMzIpOwogCQlzaGFfdGV4dCB8PSBic3RhdHVzWzBdIDw8IDI0
IHwgYnN0YXR1c1sxXSA8PCAxNjsKLQkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoZGV2X3By
aXYsIHNoYV90ZXh0KTsKKwkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoaTkxNSwgc2hhX3Rl
eHQpOwogCQlpZiAocmV0IDwgMCkKIAkJCXJldHVybiByZXQ7CiAJCXNoYV9pZHggKz0gc2l6ZW9m
KHNoYV90ZXh0KTsKQEAgLTQxNCw3ICs0MTQsNyBAQCBpbnQgaW50ZWxfaGRjcF92YWxpZGF0ZV92
X3ByaW1lKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCQkvKiBX
cml0ZSA2NCBiaXRzIG9mIE0wICovCiAJCUk5MTVfV1JJVEUoSERDUF9SRVBfQ1RMLCByZXBfY3Rs
IHwgSERDUF9TSEExX1RFWFRfMCk7CiAJCWZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKLQkJCXJl
dCA9IGludGVsX3dyaXRlX3NoYV90ZXh0KGRldl9wcml2LCAwKTsKKwkJCXJldCA9IGludGVsX3dy
aXRlX3NoYV90ZXh0KGk5MTUsIDApOwogCQkJaWYgKHJldCA8IDApCiAJCQkJcmV0dXJuIHJldDsK
IAkJCXNoYV9pZHggKz0gc2l6ZW9mKHNoYV90ZXh0KTsKQEAgLTQyMywyOCArNDIzLDI4IEBAIGlu
dCBpbnRlbF9oZGNwX3ZhbGlkYXRlX3ZfcHJpbWUoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
aW50ZWxfZGlnX3BvcnQsCiAJCS8qIFdyaXRlIDMyIGJpdHMgb2YgdGV4dCAqLwogCQlJOTE1X1dS
SVRFKEhEQ1BfUkVQX0NUTCwgcmVwX2N0bCB8IEhEQ1BfU0hBMV9URVhUXzMyKTsKIAkJc2hhX3Rl
eHQgfD0gYnN0YXR1c1swXSA8PCAyNDsKLQkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoZGV2
X3ByaXYsIHNoYV90ZXh0KTsKKwkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoaTkxNSwgc2hh
X3RleHQpOwogCQlpZiAocmV0IDwgMCkKIAkJCXJldHVybiByZXQ7CiAJCXNoYV9pZHggKz0gc2l6
ZW9mKHNoYV90ZXh0KTsKIAogCQkvKiBXcml0ZSA4IGJpdHMgb2YgdGV4dCwgMjQgYml0cyBvZiBN
MCAqLwogCQlJOTE1X1dSSVRFKEhEQ1BfUkVQX0NUTCwgcmVwX2N0bCB8IEhEQ1BfU0hBMV9URVhU
XzgpOwotCQlyZXQgPSBpbnRlbF93cml0ZV9zaGFfdGV4dChkZXZfcHJpdiwgYnN0YXR1c1sxXSk7
CisJCXJldCA9IGludGVsX3dyaXRlX3NoYV90ZXh0KGk5MTUsIGJzdGF0dXNbMV0pOwogCQlpZiAo
cmV0IDwgMCkKIAkJCXJldHVybiByZXQ7CiAJCXNoYV9pZHggKz0gc2l6ZW9mKHNoYV90ZXh0KTsK
IAogCQkvKiBXcml0ZSAzMiBiaXRzIG9mIE0wICovCiAJCUk5MTVfV1JJVEUoSERDUF9SRVBfQ1RM
LCByZXBfY3RsIHwgSERDUF9TSEExX1RFWFRfMCk7Ci0JCXJldCA9IGludGVsX3dyaXRlX3NoYV90
ZXh0KGRldl9wcml2LCAwKTsKKwkJcmV0ID0gaW50ZWxfd3JpdGVfc2hhX3RleHQoaTkxNSwgMCk7
CiAJCWlmIChyZXQgPCAwKQogCQkJcmV0dXJuIHJldDsKIAkJc2hhX2lkeCArPSBzaXplb2Yoc2hh
X3RleHQpOwogCiAJCS8qIFdyaXRlIDggYml0cyBvZiBNMCAqLwogCQlJOTE1X1dSSVRFKEhEQ1Bf
UkVQX0NUTCwgcmVwX2N0bCB8IEhEQ1BfU0hBMV9URVhUXzI0KTsKLQkJcmV0ID0gaW50ZWxfd3Jp
dGVfc2hhX3RleHQoZGV2X3ByaXYsIDApOworCQlyZXQgPSBpbnRlbF93cml0ZV9zaGFfdGV4dChp
OTE1LCAwKTsKIAkJaWYgKHJldCA8IDApCiAJCQlyZXR1cm4gcmV0OwogCQlzaGFfaWR4ICs9IHNp
emVvZihzaGFfdGV4dCk7CkBAIC00NTcsNyArNDU3LDcgQEAgaW50IGludGVsX2hkY3BfdmFsaWRh
dGVfdl9wcmltZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKIAlJ
OTE1X1dSSVRFKEhEQ1BfUkVQX0NUTCwgcmVwX2N0bCB8IEhEQ1BfU0hBMV9URVhUXzMyKTsKIAkv
KiBGaWxsIHVwIHRvIDY0LTQgYnl0ZXMgd2l0aCB6ZXJvcyAobGVhdmUgdGhlIGxhc3Qgd3JpdGUg
Zm9yIGxlbmd0aCkgKi8KIAl3aGlsZSAoKHNoYV9pZHggJSA2NCkgPCAoNjQgLSBzaXplb2Yoc2hh
X3RleHQpKSkgewotCQlyZXQgPSBpbnRlbF93cml0ZV9zaGFfdGV4dChkZXZfcHJpdiwgMCk7CisJ
CXJldCA9IGludGVsX3dyaXRlX3NoYV90ZXh0KGk5MTUsIDApOwogCQlpZiAocmV0IDwgMCkKIAkJ
CXJldHVybiByZXQ7CiAJCXNoYV9pZHggKz0gc2l6ZW9mKHNoYV90ZXh0KTsKQEAgLTQ2OSwxMyAr
NDY5LDEzIEBAIGludCBpbnRlbF9oZGNwX3ZhbGlkYXRlX3ZfcHJpbWUoc3RydWN0IGludGVsX2Rp
Z2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiAJICogIC0gMTAgYnl0ZXMgZm9yIEJJTkZPL0JT
VEFUVVMoMiksIE0wKDgpCiAJICovCiAJc2hhX3RleHQgPSAobnVtX2Rvd25zdHJlYW0gKiA1ICsg
MTApICogODsKLQlyZXQgPSBpbnRlbF93cml0ZV9zaGFfdGV4dChkZXZfcHJpdiwgc2hhX3RleHQp
OworCXJldCA9IGludGVsX3dyaXRlX3NoYV90ZXh0KGk5MTUsIHNoYV90ZXh0KTsKIAlpZiAocmV0
IDwgMCkKIAkJcmV0dXJuIHJldDsKIAogCS8qIFRlbGwgdGhlIEhXIHdlJ3JlIGRvbmUgd2l0aCB0
aGUgaGFzaCBhbmQgd2FpdCBmb3IgaXQgdG8gQUNLICovCiAJSTkxNV9XUklURShIRENQX1JFUF9D
VEwsIHJlcF9jdGwgfCBIRENQX1NIQTFfQ09NUExFVEVfSEFTSCk7Ci0JaWYgKGludGVsX3dhaXRf
Zm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBIRENQX1JFUF9DVEwsCisJaWYgKGludGVs
X3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsIEhEQ1BfUkVQX0NUTCwKIAkJCQkgICAg
SERDUF9TSEExX0NPTVBMRVRFLAogCQkJCSAgICBIRENQX1NIQTFfQ09NUExFVEUsIDEpKSB7CiAJ
CURSTV9FUlJPUigiVGltZWQgb3V0IHdhaXRpbmcgZm9yIFNIQTEgY29tcGxldGVcbiIpOwpAQCAt
NTcxLDcgKzU3MSw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfaGRjcF9hdXRoKHN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvcikKIAlzdHJ1Y3QgaW50ZWxfaGRjcCAqaGRjcCA9ICZjb25uZWN0
b3ItPmhkY3A7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+YmFzZS5kZXY7
CiAJY29uc3Qgc3RydWN0IGludGVsX2hkY3Bfc2hpbSAqc2hpbSA9IGhkY3AtPnNoaW07Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1OwogCWVudW0gcG9ydCBwb3J0OwogCXVuc2lnbmVkIGxvbmcgcjBfcHJpbWVfZ2VuX3N0
YXJ0OwogCWludCByZXQsIGksIHRyaWVzID0gMjsKQEAgLTU4OSw3ICs1ODksNyBAQCBzdGF0aWMg
aW50IGludGVsX2hkY3BfYXV0aChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiAJ
fSByaTsKIAlib29sIHJlcGVhdGVyX3ByZXNlbnQsIGhkY3BfY2FwYWJsZTsKIAotCWRldl9wcml2
ID0gaW50ZWxfZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYtPmRldl9wcml2YXRlOworCWk5MTUgPSBp
bnRlbF9kaWdfcG9ydC0+YmFzZS5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CiAKIAlwb3J0ID0gaW50
ZWxfZGlnX3BvcnQtPmJhc2UucG9ydDsKIApAQCAtNjE1LDcgKzYxNSw3IEBAIHN0YXRpYyBpbnQg
aW50ZWxfaGRjcF9hdXRoKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAlJOTE1
X1dSSVRFKFBPUlRfSERDUF9DT05GKHBvcnQpLCBIRENQX0NPTkZfQ0FQVFVSRV9BTik7CiAKIAkv
KiBXYWl0IGZvciBBbiB0byBiZSBhY3F1aXJlZCAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdp
c3RlcigmZGV2X3ByaXYtPnVuY29yZSwgUE9SVF9IRENQX1NUQVRVUyhwb3J0KSwKKwlpZiAoaW50
ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwgUE9SVF9IRENQX1NUQVRVUyhwb3J0
KSwKIAkJCQkgICAgSERDUF9TVEFUVVNfQU5fUkVBRFksCiAJCQkJICAgIEhEQ1BfU1RBVFVTX0FO
X1JFQURZLCAxKSkgewogCQlEUk1fRVJST1IoIlRpbWVkIG91dCB3YWl0aW5nIGZvciBBblxuIik7
CkBAIC03MDEsNyArNzAxLDcgQEAgc3RhdGljIGludCBpbnRlbF9oZGNwX2F1dGgoc3RydWN0IGlu
dGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCX0KIAogCS8qIFdhaXQgZm9yIGVuY3J5cHRpb24g
Y29uZmlybWF0aW9uICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+
dW5jb3JlLCBQT1JUX0hEQ1BfU1RBVFVTKHBvcnQpLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdp
c3RlcigmaTkxNS0+dW5jb3JlLCBQT1JUX0hEQ1BfU1RBVFVTKHBvcnQpLAogCQkJCSAgICBIRENQ
X1NUQVRVU19FTkMsIEhEQ1BfU1RBVFVTX0VOQywKIAkJCQkgICAgRU5DUllQVF9TVEFUVVNfQ0hB
TkdFX1RJTUVPVVRfTVMpKSB7CiAJCURSTV9FUlJPUigiVGltZWQgb3V0IHdhaXRpbmcgZm9yIGVu
Y3J5cHRpb25cbiIpOwpAQCAtNzIzLDcgKzcyMyw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfaGRjcF9h
dXRoKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHN0YXRpYyBpbnQgX2ludGVs
X2hkY3BfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3Ry
dWN0IGludGVsX2hkY3AgKmhkY3AgPSAmY29ubmVjdG9yLT5oZGNwOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGNvbm5lY3Rvci0+YmFzZS5kZXYtPmRldl9wcml2YXRlOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY29ubmVjdG9yLT5iYXNlLmRldi0+ZGV2
X3ByaXZhdGU7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBj
b25uX3RvX2RpZ19wb3J0KGNvbm5lY3Rvcik7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9kaWdf
cG9ydC0+YmFzZS5wb3J0OwogCWludCByZXQ7CkBAIC03MzMsNyArNzMzLDcgQEAgc3RhdGljIGlu
dCBfaW50ZWxfaGRjcF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikK
IAogCWhkY3AtPmhkY3BfZW5jcnlwdGVkID0gZmFsc2U7CiAJSTkxNV9XUklURShQT1JUX0hEQ1Bf
Q09ORihwb3J0KSwgMCk7Ci0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+
dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJ
CSAgICBQT1JUX0hEQ1BfU1RBVFVTKHBvcnQpLCB+MCwgMCwKIAkJCQkgICAgRU5DUllQVF9TVEFU
VVNfQ0hBTkdFX1RJTUVPVVRfTVMpKSB7CiAJCURSTV9FUlJPUigiRmFpbGVkIHRvIGRpc2FibGUg
SERDUCwgdGltZW91dCBjbGVhcmluZyBzdGF0dXNcbiIpOwpAQCAtNzUzLDIyICs3NTMsMjIgQEAg
c3RhdGljIGludCBfaW50ZWxfaGRjcF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNv
bm5lY3RvcikKIHN0YXRpYyBpbnQgX2ludGVsX2hkY3BfZW5hYmxlKHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgaW50ZWxfaGRjcCAqaGRjcCA9ICZjb25uZWN0
b3ItPmhkY3A7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY29ubmVjdG9y
LT5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBjb25uZWN0b3ItPmJhc2UuZGV2LT5kZXZfcHJpdmF0ZTsKIAlpbnQgaSwgcmV0LCB0cmllcyA9
IDM7CiAKIAlEUk1fREVCVUdfS01TKCJbJXM6JWRdIEhEQ1AgaXMgYmVpbmcgZW5hYmxlZC4uLlxu
IiwKIAkJICAgICAgY29ubmVjdG9yLT5iYXNlLm5hbWUsIGNvbm5lY3Rvci0+YmFzZS5iYXNlLmlk
KTsKIAotCWlmICghaGRjcF9rZXlfbG9hZGFibGUoZGV2X3ByaXYpKSB7CisJaWYgKCFoZGNwX2tl
eV9sb2FkYWJsZShpOTE1KSkgewogCQlEUk1fRVJST1IoIkhEQ1Aga2V5IExvYWQgaXMgbm90IHBv
c3NpYmxlXG4iKTsKIAkJcmV0dXJuIC1FTlhJTzsKIAl9CiAKIAlmb3IgKGkgPSAwOyBpIDwgS0VZ
X0xPQURfVFJJRVM7IGkrKykgewotCQlyZXQgPSBpbnRlbF9oZGNwX2xvYWRfa2V5cyhkZXZfcHJp
dik7CisJCXJldCA9IGludGVsX2hkY3BfbG9hZF9rZXlzKGk5MTUpOwogCQlpZiAoIXJldCkKIAkJ
CWJyZWFrOwotCQlpbnRlbF9oZGNwX2NsZWFyX2tleXMoZGV2X3ByaXYpOworCQlpbnRlbF9oZGNw
X2NsZWFyX2tleXMoaTkxNSk7CiAJfQogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJDb3VsZCBu
b3QgbG9hZCBIRENQIGtleXMsICglZClcbiIsIHJldCk7CkBAIC04MDMsNyArODAzLDcgQEAgc3Ry
dWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfaGRjcF90b19jb25uZWN0b3Ioc3RydWN0IGludGVs
X2hkY3AgKmhkY3ApCiBzdGF0aWMgaW50IGludGVsX2hkY3BfY2hlY2tfbGluayhzdHJ1Y3QgaW50
ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0IGludGVsX2hkY3AgKmhkY3AgPSAm
Y29ubmVjdG9yLT5oZGNwOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGNv
bm5lY3Rvci0+YmFzZS5kZXYtPmRldl9wcml2YXRlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gY29ubmVjdG9yLT5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CiAJc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBjb25uX3RvX2RpZ19wb3J0KGNvbm5lY3Rv
cik7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9kaWdfcG9ydC0+YmFzZS5wb3J0OwogCWludCBy
ZXQgPSAwOwpAQCAtODg0LDEwICs4ODQsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfaGRjcF9wcm9w
X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWRybV9tb2Rlc2V0X3VubG9jaygmZGV2
LT5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4KTsKIH0KIAotYm9vbCBpc19oZGNwX3N1cHBv
cnRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQor
Ym9vbCBpc19oZGNwX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51
bSBwb3J0IHBvcnQpCiB7CiAJLyogUE9SVCBFIGRvZXNuJ3QgaGF2ZSBIRENQLCBhbmQgUE9SVCBG
IGlzIGRpc2FibGVkICovCi0JcmV0dXJuIElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSAmJiBwb3J0
IDwgUE9SVF9FOworCXJldHVybiBJTlRFTF9HRU4oaTkxNSkgPj0gOSAmJiBwb3J0IDwgUE9SVF9F
OwogfQogCiBzdGF0aWMgaW50CkBAIC04OTUsMjIgKzg5NSwyMiBAQCBoZGNwMl9wcmVwYXJlX2Fr
ZV9pbml0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJICAgICAgIHN0cnVj
dCBoZGNwMl9ha2VfaW5pdCAqYWtlX2RhdGEpCiB7CiAJc3RydWN0IGhkY3BfcG9ydF9kYXRhICpk
YXRhID0gJmNvbm5lY3Rvci0+aGRjcC5wb3J0X2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGk5MTVfaGRjcF9jb21wX21hc3RlciAqY29tcDsKIAlpbnQgcmV0OwogCi0JbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7Ci0JY29tcCA9IGRldl9wcml2LT5oZGNwX21h
c3RlcjsKKwltdXRleF9sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOworCWNvbXAgPSBpOTE1
LT5oZGNwX21hc3RlcjsKIAogCWlmICghY29tcCB8fCAhY29tcC0+b3BzKSB7Ci0JCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7CisJCW11dGV4X3VubG9jaygmaTkxNS0+
aGRjcF9jb21wX211dGV4KTsKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCiAJcmV0ID0gY29tcC0+
b3BzLT5pbml0aWF0ZV9oZGNwMl9zZXNzaW9uKGNvbXAtPm1laV9kZXYsIGRhdGEsIGFrZV9kYXRh
KTsKIAlpZiAocmV0KQogCQlEUk1fREVCVUdfS01TKCJQcmVwYXJlX2FrZV9pbml0IGZhaWxlZC4g
JWRcbiIsIHJldCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+aGRjcF9jb21wX211dGV4KTsK
KwltdXRleF91bmxvY2soJmk5MTUtPmhkY3BfY29tcF9tdXRleCk7CiAKIAlyZXR1cm4gcmV0Owog
fQpAQCAtOTIzLDE1ICs5MjMsMTUgQEAgaGRjcDJfdmVyaWZ5X3J4X2NlcnRfcHJlcGFyZV9rbShz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCQkJc2l6ZV90ICptc2dfc3opCiB7
CiAJc3RydWN0IGhkY3BfcG9ydF9kYXRhICpkYXRhID0gJmNvbm5lY3Rvci0+aGRjcC5wb3J0X2Rh
dGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0
b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
Y29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGk5MTVfaGRjcF9jb21wX21hc3RlciAqY29t
cDsKIAlpbnQgcmV0OwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7
Ci0JY29tcCA9IGRldl9wcml2LT5oZGNwX21hc3RlcjsKKwltdXRleF9sb2NrKCZpOTE1LT5oZGNw
X2NvbXBfbXV0ZXgpOworCWNvbXAgPSBpOTE1LT5oZGNwX21hc3RlcjsKIAogCWlmICghY29tcCB8
fCAhY29tcC0+b3BzKSB7Ci0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRl
eCk7CisJCW11dGV4X3VubG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKIAkJcmV0dXJuIC1F
SU5WQUw7CiAJfQogCkBAIC05NDAsNyArOTQwLDcgQEAgaGRjcDJfdmVyaWZ5X3J4X2NlcnRfcHJl
cGFyZV9rbShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCQkJCQkJIGVrX3B1
Yl9rbSwgbXNnX3N6KTsKIAlpZiAocmV0IDwgMCkKIAkJRFJNX0RFQlVHX0tNUygiVmVyaWZ5IHJ4
X2NlcnQgZmFpbGVkLiAlZFxuIiwgcmV0KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5oZGNw
X2NvbXBfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKIAog
CXJldHVybiByZXQ7CiB9CkBAIC05NDksMjIgKzk0OSwyMiBAQCBzdGF0aWMgaW50IGhkY3AyX3Zl
cmlmeV9ocHJpbWUoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJICAgICAg
IHN0cnVjdCBoZGNwMl9ha2Vfc2VuZF9ocHJpbWUgKnJ4X2hwcmltZSkKIHsKIAlzdHJ1Y3QgaGRj
cF9wb3J0X2RhdGEgKmRhdGEgPSAmY29ubmVjdG9yLT5oZGNwLnBvcnRfZGF0YTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgaTkxNV9oZGNwX2NvbXBfbWFzdGVyICpjb21wOwogCWludCByZXQ7
CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+aGRjcF9jb21wX211dGV4KTsKLQljb21wID0gZGV2
X3ByaXYtPmhkY3BfbWFzdGVyOworCW11dGV4X2xvY2soJmk5MTUtPmhkY3BfY29tcF9tdXRleCk7
CisJY29tcCA9IGk5MTUtPmhkY3BfbWFzdGVyOwogCiAJaWYgKCFjb21wIHx8ICFjb21wLT5vcHMp
IHsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+aGRjcF9jb21wX211dGV4KTsKKwkJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAK
IAlyZXQgPSBjb21wLT5vcHMtPnZlcmlmeV9ocHJpbWUoY29tcC0+bWVpX2RldiwgZGF0YSwgcnhf
aHByaW1lKTsKIAlpZiAocmV0IDwgMCkKIAkJRFJNX0RFQlVHX0tNUygiVmVyaWZ5IGhwcmltZSBm
YWlsZWQuICVkXG4iLCByZXQpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9t
dXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCiAJcmV0dXJu
IHJldDsKIH0KQEAgLTk3NCwyMiArOTc0LDIyIEBAIGhkY3AyX3N0b3JlX3BhaXJpbmdfaW5mbyhz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCQkgc3RydWN0IGhkY3AyX2FrZV9z
ZW5kX3BhaXJpbmdfaW5mbyAqcGFpcmluZ19pbmZvKQogewogCXN0cnVjdCBoZGNwX3BvcnRfZGF0
YSAqZGF0YSA9ICZjb25uZWN0b3ItPmhkY3AucG9ydF9kYXRhOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwog
CXN0cnVjdCBpOTE1X2hkY3BfY29tcF9tYXN0ZXIgKmNvbXA7CiAJaW50IHJldDsKIAotCW11dGV4
X2xvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOwotCWNvbXAgPSBkZXZfcHJpdi0+aGRj
cF9tYXN0ZXI7CisJbXV0ZXhfbG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKKwljb21wID0g
aTkxNS0+aGRjcF9tYXN0ZXI7CiAKIAlpZiAoIWNvbXAgfHwgIWNvbXAtPm9wcykgewotCQltdXRl
eF91bmxvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCQltdXRleF91bmxvY2soJmk5
MTUtPmhkY3BfY29tcF9tdXRleCk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAogCXJldCA9IGNv
bXAtPm9wcy0+c3RvcmVfcGFpcmluZ19pbmZvKGNvbXAtPm1laV9kZXYsIGRhdGEsIHBhaXJpbmdf
aW5mbyk7CiAJaWYgKHJldCA8IDApCiAJCURSTV9ERUJVR19LTVMoIlN0b3JlIHBhaXJpbmcgaW5m
byBmYWlsZWQuICVkXG4iLCByZXQpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29t
cF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCiAJcmV0
dXJuIHJldDsKIH0KQEAgLTk5OSwyMiArOTk5LDIyIEBAIGhkY3AyX3ByZXBhcmVfbGNfaW5pdChz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCSAgICAgIHN0cnVjdCBoZGNwMl9s
Y19pbml0ICpsY19pbml0KQogewogCXN0cnVjdCBoZGNwX3BvcnRfZGF0YSAqZGF0YSA9ICZjb25u
ZWN0b3ItPmhkY3AucG9ydF9kYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpOTE1X2hk
Y3BfY29tcF9tYXN0ZXIgKmNvbXA7CiAJaW50IHJldDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2
LT5oZGNwX2NvbXBfbXV0ZXgpOwotCWNvbXAgPSBkZXZfcHJpdi0+aGRjcF9tYXN0ZXI7CisJbXV0
ZXhfbG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKKwljb21wID0gaTkxNS0+aGRjcF9tYXN0
ZXI7CiAKIAlpZiAoIWNvbXAgfHwgIWNvbXAtPm9wcykgewotCQltdXRleF91bmxvY2soJmRldl9w
cml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCQltdXRleF91bmxvY2soJmk5MTUtPmhkY3BfY29tcF9t
dXRleCk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAogCXJldCA9IGNvbXAtPm9wcy0+aW5pdGlh
dGVfbG9jYWxpdHlfY2hlY2soY29tcC0+bWVpX2RldiwgZGF0YSwgbGNfaW5pdCk7CiAJaWYgKHJl
dCA8IDApCiAJCURSTV9ERUJVR19LTVMoIlByZXBhcmUgbGNfaW5pdCBmYWlsZWQuICVkXG4iLCBy
ZXQpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7CisJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTEw
MjQsMjIgKzEwMjQsMjIgQEAgaGRjcDJfdmVyaWZ5X2xwcmltZShzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IsCiAJCSAgICBzdHJ1Y3QgaGRjcDJfbGNfc2VuZF9scHJpbWUgKnJ4X2xw
cmltZSkKIHsKIAlzdHJ1Y3QgaGRjcF9wb3J0X2RhdGEgKmRhdGEgPSAmY29ubmVjdG9yLT5oZGNw
LnBvcnRfZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaTkxNV9oZGNwX2NvbXBfbWFz
dGVyICpjb21wOwogCWludCByZXQ7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+aGRjcF9jb21w
X211dGV4KTsKLQljb21wID0gZGV2X3ByaXYtPmhkY3BfbWFzdGVyOworCW11dGV4X2xvY2soJmk5
MTUtPmhkY3BfY29tcF9tdXRleCk7CisJY29tcCA9IGk5MTUtPmhkY3BfbWFzdGVyOwogCiAJaWYg
KCFjb21wIHx8ICFjb21wLT5vcHMpIHsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+aGRjcF9j
b21wX211dGV4KTsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCQly
ZXR1cm4gLUVJTlZBTDsKIAl9CiAKIAlyZXQgPSBjb21wLT5vcHMtPnZlcmlmeV9scHJpbWUoY29t
cC0+bWVpX2RldiwgZGF0YSwgcnhfbHByaW1lKTsKIAlpZiAocmV0IDwgMCkKIAkJRFJNX0RFQlVH
X0tNUygiVmVyaWZ5IExfUHJpbWUgZmFpbGVkLiAlZFxuIiwgcmV0KTsKLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+aGRjcF9j
b21wX211dGV4KTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC0xMDQ4LDIyICsxMDQ4LDIyIEBAIHN0
YXRpYyBpbnQgaGRjcDJfcHJlcGFyZV9za2V5KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3RvciwKIAkJCSAgICAgIHN0cnVjdCBoZGNwMl9za2Vfc2VuZF9la3MgKnNrZV9kYXRhKQogewog
CXN0cnVjdCBoZGNwX3BvcnRfZGF0YSAqZGF0YSA9ICZjb25uZWN0b3ItPmhkY3AucG9ydF9kYXRh
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNv
bm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpOTE1X2hkY3BfY29tcF9tYXN0ZXIgKmNvbXA7
CiAJaW50IHJldDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOwot
CWNvbXAgPSBkZXZfcHJpdi0+aGRjcF9tYXN0ZXI7CisJbXV0ZXhfbG9jaygmaTkxNS0+aGRjcF9j
b21wX211dGV4KTsKKwljb21wID0gaTkxNS0+aGRjcF9tYXN0ZXI7CiAKIAlpZiAoIWNvbXAgfHwg
IWNvbXAtPm9wcykgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgp
OworCQltdXRleF91bmxvY2soJmk5MTUtPmhkY3BfY29tcF9tdXRleCk7CiAJCXJldHVybiAtRUlO
VkFMOwogCX0KIAogCXJldCA9IGNvbXAtPm9wcy0+Z2V0X3Nlc3Npb25fa2V5KGNvbXAtPm1laV9k
ZXYsIGRhdGEsIHNrZV9kYXRhKTsKIAlpZiAocmV0IDwgMCkKIAkJRFJNX0RFQlVHX0tNUygiR2V0
IHNlc3Npb24ga2V5IGZhaWxlZC4gJWRcbiIsIHJldCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+aGRjcF9jb21wX211dGV4KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmhkY3BfY29tcF9tdXRl
eCk7CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtMTA3NSwxNSArMTA3NSwxNSBAQCBoZGNwMl92ZXJp
ZnlfcmVwX3RvcG9sb2d5X3ByZXBhcmVfYWNrKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3RvciwKIAkJCQkgICAgICBzdHJ1Y3QgaGRjcDJfcmVwX3NlbmRfYWNrICpyZXBfc2VuZF9hY2sp
CiB7CiAJc3RydWN0IGhkY3BfcG9ydF9kYXRhICpkYXRhID0gJmNvbm5lY3Rvci0+aGRjcC5wb3J0
X2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25u
ZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGk5MTVfaGRjcF9jb21wX21hc3RlciAq
Y29tcDsKIAlpbnQgcmV0OwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRl
eCk7Ci0JY29tcCA9IGRldl9wcml2LT5oZGNwX21hc3RlcjsKKwltdXRleF9sb2NrKCZpOTE1LT5o
ZGNwX2NvbXBfbXV0ZXgpOworCWNvbXAgPSBpOTE1LT5oZGNwX21hc3RlcjsKIAogCWlmICghY29t
cCB8fCAhY29tcC0+b3BzKSB7Ci0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9t
dXRleCk7CisJCW11dGV4X3VubG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKIAkJcmV0dXJu
IC1FSU5WQUw7CiAJfQogCkBAIC0xMDkyLDcgKzEwOTIsNyBAQCBoZGNwMl92ZXJpZnlfcmVwX3Rv
cG9sb2d5X3ByZXBhcmVfYWNrKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJ
CQkJCQkgcmVwX3NlbmRfYWNrKTsKIAlpZiAocmV0IDwgMCkKIAkJRFJNX0RFQlVHX0tNUygiVmVy
aWZ5IHJlcCB0b3BvbG9neSBmYWlsZWQuICVkXG4iLCByZXQpOwotCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBf
bXV0ZXgpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTExMDIsMjIgKzExMDIsMjIgQEAgaGRjcDJf
dmVyaWZ5X21wcmltZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCSAgICBz
dHJ1Y3QgaGRjcDJfcmVwX3N0cmVhbV9yZWFkeSAqc3RyZWFtX3JlYWR5KQogewogCXN0cnVjdCBo
ZGNwX3BvcnRfZGF0YSAqZGF0YSA9ICZjb25uZWN0b3ItPmhkY3AucG9ydF9kYXRhOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+
YmFzZS5kZXYpOwogCXN0cnVjdCBpOTE1X2hkY3BfY29tcF9tYXN0ZXIgKmNvbXA7CiAJaW50IHJl
dDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOwotCWNvbXAgPSBk
ZXZfcHJpdi0+aGRjcF9tYXN0ZXI7CisJbXV0ZXhfbG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4
KTsKKwljb21wID0gaTkxNS0+aGRjcF9tYXN0ZXI7CiAKIAlpZiAoIWNvbXAgfHwgIWNvbXAtPm9w
cykgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCQltdXRl
eF91bmxvY2soJmk5MTUtPmhkY3BfY29tcF9tdXRleCk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0K
IAogCXJldCA9IGNvbXAtPm9wcy0+dmVyaWZ5X21wcmltZShjb21wLT5tZWlfZGV2LCBkYXRhLCBz
dHJlYW1fcmVhZHkpOwogCWlmIChyZXQgPCAwKQogCQlEUk1fREVCVUdfS01TKCJWZXJpZnkgbXBy
aW1lIGZhaWxlZC4gJWRcbiIsIHJldCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+aGRjcF9j
b21wX211dGV4KTsKKwltdXRleF91bmxvY2soJmk5MTUtPmhkY3BfY29tcF9tdXRleCk7CiAKIAly
ZXR1cm4gcmV0OwogfQpAQCAtMTEyNSw0MyArMTEyNSw0MyBAQCBoZGNwMl92ZXJpZnlfbXByaW1l
KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwKIHN0YXRpYyBpbnQgaGRjcDJfYXV0
aGVudGljYXRlX3BvcnQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewogCXN0
cnVjdCBoZGNwX3BvcnRfZGF0YSAqZGF0YSA9ICZjb25uZWN0b3ItPmhkY3AucG9ydF9kYXRhOwot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5l
Y3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpOTE1X2hkY3BfY29tcF9tYXN0ZXIgKmNvbXA7CiAJ
aW50IHJldDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOwotCWNv
bXAgPSBkZXZfcHJpdi0+aGRjcF9tYXN0ZXI7CisJbXV0ZXhfbG9jaygmaTkxNS0+aGRjcF9jb21w
X211dGV4KTsKKwljb21wID0gaTkxNS0+aGRjcF9tYXN0ZXI7CiAKIAlpZiAoIWNvbXAgfHwgIWNv
bXAtPm9wcykgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOwor
CQltdXRleF91bmxvY2soJmk5MTUtPmhkY3BfY29tcF9tdXRleCk7CiAJCXJldHVybiAtRUlOVkFM
OwogCX0KIAogCXJldCA9IGNvbXAtPm9wcy0+ZW5hYmxlX2hkY3BfYXV0aGVudGljYXRpb24oY29t
cC0+bWVpX2RldiwgZGF0YSk7CiAJaWYgKHJldCA8IDApCiAJCURSTV9ERUJVR19LTVMoIkVuYWJs
ZSBoZGNwIGF1dGggZmFpbGVkLiAlZFxuIiwgcmV0KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5oZGNwX2NvbXBfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4
KTsKIAogCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyBpbnQgaGRjcDJfY2xvc2VfbWVpX3Nlc3Np
b24oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYp
OwogCXN0cnVjdCBpOTE1X2hkY3BfY29tcF9tYXN0ZXIgKmNvbXA7CiAJaW50IHJldDsKIAotCW11
dGV4X2xvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOwotCWNvbXAgPSBkZXZfcHJpdi0+
aGRjcF9tYXN0ZXI7CisJbXV0ZXhfbG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKKwljb21w
ID0gaTkxNS0+aGRjcF9tYXN0ZXI7CiAKIAlpZiAoIWNvbXAgfHwgIWNvbXAtPm9wcykgewotCQlt
dXRleF91bmxvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCQltdXRleF91bmxvY2so
Jmk5MTUtPmhkY3BfY29tcF9tdXRleCk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAogCXJldCA9
IGNvbXAtPm9wcy0+Y2xvc2VfaGRjcF9zZXNzaW9uKGNvbXAtPm1laV9kZXYsCiAJCQkJCSAgICAg
JmNvbm5lY3Rvci0+aGRjcC5wb3J0X2RhdGEpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhk
Y3BfY29tcF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwog
CiAJcmV0dXJuIHJldDsKIH0KQEAgLTE0ODgsNyArMTQ4OCw3IEBAIHN0YXRpYyBpbnQgaGRjcDJf
YXV0aGVudGljYXRlX3Npbmsoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogc3Rh
dGljIGludCBoZGNwMl9lbmFibGVfZW5jcnlwdGlvbihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IpCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQg
PSBjb25uX3RvX2RpZ19wb3J0KGNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0
IGludGVsX2hkY3AgKmhkY3AgPSAmY29ubmVjdG9yLT5oZGNwOwogCWVudW0gcG9ydCBwb3J0ID0g
Y29ubmVjdG9yLT5lbmNvZGVyLT5wb3J0OwogCWludCByZXQ7CkBAIC0xNTExLDcgKzE1MTEsNyBA
QCBzdGF0aWMgaW50IGhkY3AyX2VuYWJsZV9lbmNyeXB0aW9uKHN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIAkJCSAgIENUTF9MSU5LX0VOQ1JZUFRJT05fUkVRKTsKIAl9CiAKLQly
ZXQgPSBpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgSERDUDJfU1RB
VFVTX0RESShwb3J0KSwKKwlyZXQgPSBpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5j
b3JlLCBIRENQMl9TVEFUVVNfRERJKHBvcnQpLAogCQkJCSAgICAgIExJTktfRU5DUllQVElPTl9T
VEFUVVMsCiAJCQkJICAgICAgTElOS19FTkNSWVBUSU9OX1NUQVRVUywKIAkJCQkgICAgICBFTkNS
WVBUX1NUQVRVU19DSEFOR0VfVElNRU9VVF9NUyk7CkBAIC0xNTIyLDcgKzE1MjIsNyBAQCBzdGF0
aWMgaW50IGhkY3AyX2VuYWJsZV9lbmNyeXB0aW9uKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNv
bm5lY3RvcikKIHN0YXRpYyBpbnQgaGRjcDJfZGlzYWJsZV9lbmNyeXB0aW9uKHN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpp
bnRlbF9kaWdfcG9ydCA9IGNvbm5fdG9fZGlnX3BvcnQoY29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2Uu
ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfaGRjcCAqaGRjcCA9ICZjb25uZWN0b3ItPmhkY3A7CiAJZW51
bSBwb3J0IHBvcnQgPSBjb25uZWN0b3ItPmVuY29kZXItPnBvcnQ7CiAJaW50IHJldDsKQEAgLTE1
MzIsNyArMTUzMiw3IEBAIHN0YXRpYyBpbnQgaGRjcDJfZGlzYWJsZV9lbmNyeXB0aW9uKHN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAlJOTE1X1dSSVRFKEhEQ1AyX0NUTF9EREko
cG9ydCksCiAJCSAgIEk5MTVfUkVBRChIRENQMl9DVExfRERJKHBvcnQpKSAmIH5DVExfTElOS19F
TkNSWVBUSU9OX1JFUSk7CiAKLQlyZXQgPSBpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3By
aXYtPnVuY29yZSwgSERDUDJfU1RBVFVTX0RESShwb3J0KSwKKwlyZXQgPSBpbnRlbF93YWl0X2Zv
cl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLCBIRENQMl9TVEFUVVNfRERJKHBvcnQpLAogCQkJCSAg
ICAgIExJTktfRU5DUllQVElPTl9TVEFUVVMsIDB4MCwKIAkJCQkgICAgICBFTkNSWVBUX1NUQVRV
U19DSEFOR0VfVElNRU9VVF9NUyk7CiAJaWYgKHJldCA9PSAtRVRJTUVET1VUKQpAQCAtMTYyOCw3
ICsxNjI4LDcgQEAgc3RhdGljIGludCBfaW50ZWxfaGRjcDJfZGlzYWJsZShzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IpCiBzdGF0aWMgaW50IGludGVsX2hkY3AyX2NoZWNrX2xpbmso
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewogCXN0cnVjdCBpbnRlbF9kaWdp
dGFsX3BvcnQgKmludGVsX2RpZ19wb3J0ID0gY29ubl90b19kaWdfcG9ydChjb25uZWN0b3IpOwot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5l
Y3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9oZGNwICpoZGNwID0gJmNvbm5lY3Rvci0+
aGRjcDsKIAllbnVtIHBvcnQgcG9ydCA9IGNvbm5lY3Rvci0+ZW5jb2Rlci0+cG9ydDsKIAlpbnQg
cmV0ID0gMDsKQEAgLTE3MjEsMTMgKzE3MjEsMTMgQEAgc3RhdGljIHZvaWQgaW50ZWxfaGRjcF9j
aGVja193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHN0YXRpYyBpbnQgaTkxNV9oZGNw
X2NvbXBvbmVudF9iaW5kKHN0cnVjdCBkZXZpY2UgKmk5MTVfa2RldiwKIAkJCQkgICAgc3RydWN0
IGRldmljZSAqbWVpX2tkZXYsIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0ga2Rldl90b19pOTE1KGk5MTVfa2Rldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBrZGV2X3RvX2k5MTUoaTkxNV9rZGV2KTsKIAogCURSTV9ERUJVRygi
STkxNSBIRENQIGNvbXAgYmluZFxuIik7Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmhkY3BfY29t
cF9tdXRleCk7Ci0JZGV2X3ByaXYtPmhkY3BfbWFzdGVyID0gKHN0cnVjdCBpOTE1X2hkY3BfY29t
cF9tYXN0ZXIgKilkYXRhOwotCWRldl9wcml2LT5oZGNwX21hc3Rlci0+bWVpX2RldiA9IG1laV9r
ZGV2OwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7CisJbXV0ZXhf
bG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKKwlpOTE1LT5oZGNwX21hc3RlciA9IChzdHJ1
Y3QgaTkxNV9oZGNwX2NvbXBfbWFzdGVyICopZGF0YTsKKwlpOTE1LT5oZGNwX21hc3Rlci0+bWVp
X2RldiA9IG1laV9rZGV2OworCW11dGV4X3VubG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsK
IAogCXJldHVybiAwOwogfQpAQCAtMTczNSwxMiArMTczNSwxMiBAQCBzdGF0aWMgaW50IGk5MTVf
aGRjcF9jb21wb25lbnRfYmluZChzdHJ1Y3QgZGV2aWNlICppOTE1X2tkZXYsCiBzdGF0aWMgdm9p
ZCBpOTE1X2hkY3BfY29tcG9uZW50X3VuYmluZChzdHJ1Y3QgZGV2aWNlICppOTE1X2tkZXYsCiAJ
CQkJICAgICAgIHN0cnVjdCBkZXZpY2UgKm1laV9rZGV2LCB2b2lkICpkYXRhKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfdG9faTkxNShpOTE1X2tkZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl90b19pOTE1KGk5MTVfa2Rldik7
CiAKIAlEUk1fREVCVUcoIkk5MTUgSERDUCBjb21wIHVuYmluZFxuIik7Ci0JbXV0ZXhfbG9jaygm
ZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7Ci0JZGV2X3ByaXYtPmhkY3BfbWFzdGVyID0gTlVM
TDsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCW11dGV4X2xv
Y2soJmk5MTUtPmhkY3BfY29tcF9tdXRleCk7CisJaTkxNS0+aGRjcF9tYXN0ZXIgPSBOVUxMOwor
CW11dGV4X3VubG9jaygmaTkxNS0+aGRjcF9jb21wX211dGV4KTsKIH0KIAogc3RhdGljIGNvbnN0
IHN0cnVjdCBjb21wb25lbnRfb3BzIGk5MTVfaGRjcF9jb21wb25lbnRfb3BzID0gewpAQCAtMTc3
MywzNCArMTc3MywzNCBAQCBzdGF0aWMgaW5saW5lIGludCBpbml0aWFsaXplX2hkY3BfcG9ydF9k
YXRhKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAlyZXR1cm4gMDsKIH0KIAot
c3RhdGljIGJvb2wgaXNfaGRjcDJfc3VwcG9ydGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyBib29sIGlzX2hkY3AyX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAlpZiAoIUlTX0VOQUJMRUQoQ09ORklHX0lOVEVMX01FSV9IRENQ
KSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JcmV0dXJuIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEw
IHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpIHx8Ci0JCUlTX0tBQllMQUtFKGRldl9wcml2KSk7
CisJcmV0dXJuIChJTlRFTF9HRU4oaTkxNSkgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShpOTE1KSB8
fAorCQlJU19LQUJZTEFLRShpOTE1KSk7CiB9CiAKLXZvaWQgaW50ZWxfaGRjcF9jb21wb25lbnRf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2hkY3Bf
Y29tcG9uZW50X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IHJl
dDsKIAotCWlmICghaXNfaGRjcDJfc3VwcG9ydGVkKGRldl9wcml2KSkKKwlpZiAoIWlzX2hkY3Ay
X3N1cHBvcnRlZChpOTE1KSkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmhk
Y3BfY29tcF9tdXRleCk7Ci0JV0FSTl9PTihkZXZfcHJpdi0+aGRjcF9jb21wX2FkZGVkKTsKKwlt
dXRleF9sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOworCVdBUk5fT04oaTkxNS0+aGRjcF9j
b21wX2FkZGVkKTsKIAotCWRldl9wcml2LT5oZGNwX2NvbXBfYWRkZWQgPSB0cnVlOwotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmhkY3BfY29tcF9tdXRleCk7Ci0JcmV0ID0gY29tcG9uZW50X2Fk
ZF90eXBlZChkZXZfcHJpdi0+ZHJtLmRldiwgJmk5MTVfaGRjcF9jb21wb25lbnRfb3BzLAorCWk5
MTUtPmhkY3BfY29tcF9hZGRlZCA9IHRydWU7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5oZGNwX2Nv
bXBfbXV0ZXgpOworCXJldCA9IGNvbXBvbmVudF9hZGRfdHlwZWQoaTkxNS0+ZHJtLmRldiwgJmk5
MTVfaGRjcF9jb21wb25lbnRfb3BzLAogCQkJCSAgSTkxNV9DT01QT05FTlRfSERDUCk7CiAJaWYg
KHJldCA8IDApIHsKIAkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIGF0IGNvbXBvbmVudCBhZGQoJWQp
XG4iLCByZXQpOwotCQltdXRleF9sb2NrKCZkZXZfcHJpdi0+aGRjcF9jb21wX211dGV4KTsKLQkJ
ZGV2X3ByaXYtPmhkY3BfY29tcF9hZGRlZCA9IGZhbHNlOwotCQltdXRleF91bmxvY2soJmRldl9w
cml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCQltdXRleF9sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0
ZXgpOworCQlpOTE1LT5oZGNwX2NvbXBfYWRkZWQgPSBmYWxzZTsKKwkJbXV0ZXhfdW5sb2NrKCZp
OTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCQlyZXR1cm47CiAJfQogfQpAQCAtMTgyMiw3ICsxODIy
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfaGRjcDJfaW5pdChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uZWN0b3IpCiBpbnQgaW50ZWxfaGRjcF9pbml0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmNvbm5lY3RvciwKIAkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9oZGNwX3NoaW0gKnNoaW0pCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3It
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29u
bmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2hkY3AgKmhkY3AgPSAmY29ubmVjdG9y
LT5oZGNwOwogCWludCByZXQ7CiAKQEAgLTE4MzgsNyArMTgzOCw3IEBAIGludCBpbnRlbF9oZGNw
X2luaXQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCUlOSVRfREVMQVlFRF9X
T1JLKCZoZGNwLT5jaGVja193b3JrLCBpbnRlbF9oZGNwX2NoZWNrX3dvcmspOwogCUlOSVRfV09S
SygmaGRjcC0+cHJvcF93b3JrLCBpbnRlbF9oZGNwX3Byb3Bfd29yayk7CiAKLQlpZiAoaXNfaGRj
cDJfc3VwcG9ydGVkKGRldl9wcml2KSkKKwlpZiAoaXNfaGRjcDJfc3VwcG9ydGVkKGk5MTUpKQog
CQlpbnRlbF9oZGNwMl9pbml0KGNvbm5lY3Rvcik7CiAJaW5pdF93YWl0cXVldWVfaGVhZCgmaGRj
cC0+Y3BfaXJxX3F1ZXVlKTsKIApAQCAtMTkwNSwxOCArMTkwNSwxOCBAQCBpbnQgaW50ZWxfaGRj
cF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAlyZXR1cm4gcmV0
OwogfQogCi12b2lkIGludGVsX2hkY3BfY29tcG9uZW50X2Zpbmkoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9oZGNwX2NvbXBvbmVudF9maW5pKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewotCW11dGV4X2xvY2soJmRldl9wcml2LT5oZGNwX2Nv
bXBfbXV0ZXgpOwotCWlmICghZGV2X3ByaXYtPmhkY3BfY29tcF9hZGRlZCkgewotCQltdXRleF91
bmxvY2soJmRldl9wcml2LT5oZGNwX2NvbXBfbXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPmhk
Y3BfY29tcF9tdXRleCk7CisJaWYgKCFpOTE1LT5oZGNwX2NvbXBfYWRkZWQpIHsKKwkJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCQlyZXR1cm47CiAJfQogCi0JZGV2X3By
aXYtPmhkY3BfY29tcF9hZGRlZCA9IGZhbHNlOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmhk
Y3BfY29tcF9tdXRleCk7CisJaTkxNS0+aGRjcF9jb21wX2FkZGVkID0gZmFsc2U7CisJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5oZGNwX2NvbXBfbXV0ZXgpOwogCi0JY29tcG9uZW50X2RlbChkZXZfcHJp
di0+ZHJtLmRldiwgJmk5MTVfaGRjcF9jb21wb25lbnRfb3BzKTsKKwljb21wb25lbnRfZGVsKGk5
MTUtPmRybS5kZXYsICZpOTE1X2hkY3BfY29tcG9uZW50X29wcyk7CiB9CiAKIHZvaWQgaW50ZWxf
aGRjcF9jbGVhbnVwKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2hkY3AuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2hkY3AuaAppbmRleCBiZThkYTg1Yzg2NmEuLjI0MDc5ZGRhMWFjNCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaGRjcC5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2hkY3AuaApAQCAtMjMsMTEgKzIzLDExIEBAIGludCBpbnRlbF9oZGNw
X2luaXQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkgICAgY29uc3Qgc3Ry
dWN0IGludGVsX2hkY3Bfc2hpbSAqaGRjcF9zaGltKTsKIGludCBpbnRlbF9oZGNwX2VuYWJsZShz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpOwogaW50IGludGVsX2hkY3BfZGlzYWJs
ZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpOwotYm9vbCBpc19oZGNwX3N1cHBv
cnRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KTsK
K2Jvb2wgaXNfaGRjcF9zdXBwb3J0ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVu
dW0gcG9ydCBwb3J0KTsKIGJvb2wgaW50ZWxfaGRjcF9jYXBhYmxlKHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3Rvcik7CiBib29sIGludGVsX2hkY3AyX2NhcGFibGUoc3RydWN0IGludGVs
X2Nvbm5lY3RvciAqY29ubmVjdG9yKTsKLXZvaWQgaW50ZWxfaGRjcF9jb21wb25lbnRfaW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9oZGNwX2NvbXBv
bmVudF9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVs
X2hkY3BfY29tcG9uZW50X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9p
ZCBpbnRlbF9oZGNwX2NvbXBvbmVudF9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KTsKIHZvaWQgaW50ZWxfaGRjcF9jbGVhbnVwKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3Rvcik7CiB2b2lkIGludGVsX2hkY3BfaGFuZGxlX2NwX2lycShzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9oZG1pLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9oZG1pLmMKaW5kZXggMTg3YTJi
ODI4Yjk3Li5jNWJlNDFiYTM2ZGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2hkbWkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9oZG1pLmMKQEAgLTY3
LDE3ICs2NywxNyBAQCBzdGF0aWMgdm9pZAogYXNzZXJ0X2hkbWlfcG9ydF9kaXNhYmxlZChzdHJ1
Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
aW50ZWxfaGRtaV90b19kZXYoaW50ZWxfaGRtaSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShkZXYpOwogCXUzMiBlbmFibGVkX2JpdHM7CiAKLQllbmFibGVkX2JpdHMgPSBI
QVNfRERJKGRldl9wcml2KSA/IERESV9CVUZfQ1RMX0VOQUJMRSA6IFNEVk9fRU5BQkxFOworCWVu
YWJsZWRfYml0cyA9IEhBU19EREkoaTkxNSkgPyBERElfQlVGX0NUTF9FTkFCTEUgOiBTRFZPX0VO
QUJMRTsKIAogCVdBUk4oSTkxNV9SRUFEKGludGVsX2hkbWktPmhkbWlfcmVnKSAmIGVuYWJsZWRf
Yml0cywKIAkgICAgICJIRE1JIHBvcnQgZW5hYmxlZCwgZXhwZWN0aW5nIGRpc2FibGVkXG4iKTsK
IH0KIAogc3RhdGljIHZvaWQKLWFzc2VydF9oZG1pX3RyYW5zY29kZXJfZnVuY19kaXNhYmxlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCithc3NlcnRfaGRtaV90cmFuc2NvZGVy
X2Z1bmNfZGlzYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICBl
bnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIpCiB7CiAJV0FSTihJOTE1X1JFQUQoVFJBTlNf
RERJX0ZVTkNfQ1RMKGNwdV90cmFuc2NvZGVyKSkgJgpAQCAtMTYzLDcgKzE2Myw3IEBAIHN0YXRp
YyB1MzIgaHN3X2luZm9mcmFtZV9lbmFibGUodW5zaWduZWQgaW50IHR5cGUpCiB9CiAKIHN0YXRp
YyBpOTE1X3JlZ190Ci1oc3dfZGlwX2RhdGFfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK2hzd19kaXBfZGF0YV9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCSBlbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIsCiAJCSB1bnNpZ25lZCBpbnQgdHlw
ZSwKIAkJIGludCBpKQpAQCAtMjA3LDcgKzIwNyw3IEBAIHN0YXRpYyB2b2lkIGc0eF93cml0ZV9p
bmZvZnJhbWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJY29uc3Qgdm9pZCAq
ZnJhbWUsIHNzaXplX3QgbGVuKQogewogCWNvbnN0IHUzMiAqZGF0YSA9IGZyYW1lOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChWSURFT19ESVBfQ1RMKTsKIAlpbnQgaTsKIApA
QCAtMjQxLDcgKzI0MSw3IEBAIHN0YXRpYyB2b2lkIGc0eF9yZWFkX2luZm9mcmFtZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgdHlwZSwKIAkJ
CSAgICAgICB2b2lkICpmcmFtZSwgc3NpemVfdCBsZW4pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAl1MzIg
dmFsLCAqZGF0YSA9IGZyYW1lOwogCWludCBpOwogCkBAIC0yNTksNyArMjU5LDcgQEAgc3RhdGlj
IHZvaWQgZzR4X3JlYWRfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
c3RhdGljIHUzMiBnNHhfaW5mb2ZyYW1lc19lbmFibGVkKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmln
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChWSURFT19ESVBfQ1RMKTsK
IAogCWlmICgodmFsICYgVklERU9fRElQX0VOQUJMRSkgPT0gMCkKQEAgLTI3OCw3ICsyNzgsNyBA
QCBzdGF0aWMgdm9pZCBpYnhfd3JpdGVfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQkJCWNvbnN0IHZvaWQgKmZyYW1lLCBzc2l6ZV90IGxlbikKIHsKIAljb25zdCB1
MzIgKmRhdGEgPSBmcmFtZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRl
bF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCWk5MTVfcmVn
X3QgcmVnID0gVFZJREVPX0RJUF9DVEwoaW50ZWxfY3J0Yy0+cGlwZSk7CiAJdTMyIHZhbCA9IEk5
MTVfUkVBRChyZWcpOwpAQCAtMzE0LDcgKzMxNCw3IEBAIHN0YXRpYyB2b2lkIGlieF9yZWFkX2lu
Zm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgICB1bnNpZ25l
ZCBpbnQgdHlwZSwKIAkJCSAgICAgICB2b2lkICpmcmFtZSwgc3NpemVfdCBsZW4pCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKIAl1MzIgdmFsLCAqZGF0YSA9IGZyYW1lOwogCWludCBpOwpAQCAt
MzMzLDcgKzMzMyw3IEBAIHN0YXRpYyB2b2lkIGlieF9yZWFkX2luZm9mcmFtZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRpYyB1MzIgaWJ4X2luZm9mcmFtZXNfZW5hYmxlZChz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBl
ID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKS0+cGlwZTsKIAlpOTE1X3Jl
Z190IHJlZyA9IFRWSURFT19ESVBfQ1RMKHBpcGUpOwogCXUzMiB2YWwgPSBJOTE1X1JFQUQocmVn
KTsKQEAgLTM1NSw3ICszNTUsNyBAQCBzdGF0aWMgdm9pZCBjcHRfd3JpdGVfaW5mb2ZyYW1lKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCWNvbnN0IHZvaWQgKmZyYW1lLCBzc2l6
ZV90IGxlbikKIHsKIAljb25zdCB1MzIgKmRhdGEgPSBmcmFtZTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5i
YXNlLmNydGMpOwogCWk5MTVfcmVnX3QgcmVnID0gVFZJREVPX0RJUF9DVEwoaW50ZWxfY3J0Yy0+
cGlwZSk7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChyZWcpOwpAQCAtMzk0LDcgKzM5NCw3IEBAIHN0
YXRpYyB2b2lkIGNwdF9yZWFkX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgdHlwZSwKIAkJCSAgICAgICB2b2lkICpmcmFtZSwg
c3NpemVfdCBsZW4pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAl1MzIgdmFsLCAqZGF0YSA9
IGZyYW1lOwogCWludCBpOwpAQCAtNDEzLDcgKzQxMyw3IEBAIHN0YXRpYyB2b2lkIGNwdF9yZWFk
X2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRpYyB1MzIgY3B0
X2luZm9mcmFtZXNfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5k
ZXYpOwogCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5j
cnRjKS0+cGlwZTsKIAl1MzIgdmFsID0gSTkxNV9SRUFEKFRWSURFT19ESVBfQ1RMKHBpcGUpKTsK
IApAQCAtNDMxLDcgKzQzMSw3IEBAIHN0YXRpYyB2b2lkIHZsdl93cml0ZV9pbmZvZnJhbWUoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJY29uc3Qgdm9pZCAqZnJhbWUsIHNzaXpl
X3QgbGVuKQogewogCWNvbnN0IHUzMiAqZGF0YSA9IGZyYW1lOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJh
c2UuY3J0Yyk7CiAJaTkxNV9yZWdfdCByZWcgPSBWTFZfVFZJREVPX0RJUF9DVEwoaW50ZWxfY3J0
Yy0+cGlwZSk7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChyZWcpOwpAQCAtNDY3LDcgKzQ2Nyw3IEBA
IHN0YXRpYyB2b2lkIHZsdl9yZWFkX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgdHlwZSwKIAkJCSAgICAgICB2b2lkICpmcmFt
ZSwgc3NpemVfdCBsZW4pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAl1MzIgdmFsLCAqZGF0
YSA9IGZyYW1lOwogCWludCBpOwpAQCAtNDg2LDcgKzQ4Niw3IEBAIHN0YXRpYyB2b2lkIHZsdl9y
ZWFkX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRpYyB1MzIg
dmx2X2luZm9mcmFtZXNfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJ
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFz
ZS5jcnRjKS0+cGlwZTsKIAl1MzIgdmFsID0gSTkxNV9SRUFEKFZMVl9UVklERU9fRElQX0NUTChw
aXBlKSk7CiAKQEAgLTUwNyw3ICs1MDcsNyBAQCBzdGF0aWMgdm9pZCBoc3dfd3JpdGVfaW5mb2Zy
YW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCWNvbnN0IHZvaWQgKmZyYW1l
LCBzc2l6ZV90IGxlbikKIHsKIAljb25zdCB1MzIgKmRhdGEgPSBmcmFtZTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFu
c2NvZGVyOwogCWk5MTVfcmVnX3QgY3RsX3JlZyA9IEhTV19UVklERU9fRElQX0NUTChjcHVfdHJh
bnNjb2Rlcik7CiAJaW50IGRhdGFfc2l6ZTsKQEAgLTUyMCwxMyArNTIwLDEzIEBAIHN0YXRpYyB2
b2lkIGhzd193cml0ZV9pbmZvZnJhbWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
STkxNV9XUklURShjdGxfcmVnLCB2YWwpOwogCiAJZm9yIChpID0gMDsgaSA8IGxlbjsgaSArPSA0
KSB7Ci0JCUk5MTVfV1JJVEUoaHN3X2RpcF9kYXRhX3JlZyhkZXZfcHJpdiwgY3B1X3RyYW5zY29k
ZXIsCisJCUk5MTVfV1JJVEUoaHN3X2RpcF9kYXRhX3JlZyhpOTE1LCBjcHVfdHJhbnNjb2RlciwK
IAkJCQkJICAgIHR5cGUsIGkgPj4gMiksICpkYXRhKTsKIAkJZGF0YSsrOwogCX0KIAkvKiBXcml0
ZSBldmVyeSBwb3NzaWJsZSBkYXRhIGJ5dGUgdG8gZm9yY2UgY29ycmVjdCBFQ0MgY2FsY3VsYXRp
b24uICovCiAJZm9yICg7IGkgPCBkYXRhX3NpemU7IGkgKz0gNCkKLQkJSTkxNV9XUklURShoc3df
ZGlwX2RhdGFfcmVnKGRldl9wcml2LCBjcHVfdHJhbnNjb2RlciwKKwkJSTkxNV9XUklURShoc3df
ZGlwX2RhdGFfcmVnKGk5MTUsIGNwdV90cmFuc2NvZGVyLAogCQkJCQkgICAgdHlwZSwgaSA+PiAy
KSwgMCk7CiAKIAl2YWwgfD0gaHN3X2luZm9mcmFtZV9lbmFibGUodHlwZSk7CkBAIC01MzksNyAr
NTM5LDcgQEAgc3RhdGljIHZvaWQgaHN3X3JlYWRfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJICAgICAgIHVuc2lnbmVkIGludCB0eXBlLAogCQkJICAgICAgIHZv
aWQgKmZyYW1lLCBzc2l6ZV90IGxlbikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0gdHJhbnNjb2Rl
ciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCXUzMiB2YWws
ICpkYXRhID0gZnJhbWU7CiAJaW50IGk7CkBAIC01NDcsMTQgKzU0NywxNCBAQCBzdGF0aWMgdm9p
ZCBoc3dfcmVhZF9pbmZvZnJhbWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJdmFs
ID0gSTkxNV9SRUFEKEhTV19UVklERU9fRElQX0NUTChjcHVfdHJhbnNjb2RlcikpOwogCiAJZm9y
IChpID0gMDsgaSA8IGxlbjsgaSArPSA0KQotCQkqZGF0YSsrID0gSTkxNV9SRUFEKGhzd19kaXBf
ZGF0YV9yZWcoZGV2X3ByaXYsIGNwdV90cmFuc2NvZGVyLAorCQkqZGF0YSsrID0gSTkxNV9SRUFE
KGhzd19kaXBfZGF0YV9yZWcoaTkxNSwgY3B1X3RyYW5zY29kZXIsCiAJCQkJCQkgICAgIHR5cGUs
IGkgPj4gMikpOwogfQogCiBzdGF0aWMgdTMyIGhzd19pbmZvZnJhbWVzX2VuYWJsZWQoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAl1MzIgdmFsID0gSTkxNV9SRUFE
KEhTV19UVklERU9fRElQX0NUTChwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpKTsKIAl1MzIg
bWFzazsKIApAQCAtNTYyLDcgKzU2Miw3IEBAIHN0YXRpYyB1MzIgaHN3X2luZm9mcmFtZXNfZW5h
YmxlZChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJVklERU9fRElQX0VOQUJMRV9H
Q1BfSFNXIHwgVklERU9fRElQX0VOQUJMRV9WU19IU1cgfAogCQlWSURFT19ESVBfRU5BQkxFX0dN
UF9IU1cgfCBWSURFT19ESVBfRU5BQkxFX1NQRF9IU1cpOwogCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihp
OTE1KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGk5MTUpKQogCQltYXNrIHw9IFZJREVPX0RJUF9F
TkFCTEVfRFJNX0dMSzsKIAogCXJldHVybiB2YWwgJiBtYXNrOwpAQCAtNTkzLDcgKzU5Myw3IEBA
IHUzMiBpbnRlbF9oZG1pX2luZm9mcmFtZV9lbmFibGUodW5zaWduZWQgaW50IHR5cGUpCiB1MzIg
aW50ZWxfaGRtaV9pbmZvZnJhbWVzX2VuYWJsZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZW5j
X3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKIAl1MzIgdmFsLCByZXQgPSAwOwogCWludCBp
OwpAQCAtNjA0LDcgKzYwNCw3IEBAIHUzMiBpbnRlbF9oZG1pX2luZm9mcmFtZXNfZW5hYmxlZChz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0la
RShpbmZvZnJhbWVfdHlwZV90b19pZHgpOyBpKyspIHsKIAkJdW5zaWduZWQgaW50IHR5cGUgPSBp
bmZvZnJhbWVfdHlwZV90b19pZHhbaV07CiAKLQkJaWYgKEhBU19EREkoZGV2X3ByaXYpKSB7CisJ
CWlmIChIQVNfRERJKGk5MTUpKSB7CiAJCQlpZiAodmFsICYgaHN3X2luZm9mcmFtZV9lbmFibGUo
dHlwZSkpCiAJCQkJcmV0IHw9IEJJVChpKTsKIAkJfSBlbHNlIHsKQEAgLTgwNCwxMCArODA0LDEw
IEBAIGludGVsX2hkbWlfY29tcHV0ZV9kcm1faW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkJCSBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkK
IHsKIAlzdHJ1Y3QgaGRtaV9kcm1faW5mb2ZyYW1lICpmcmFtZSA9ICZjcnRjX3N0YXRlLT5pbmZv
ZnJhbWVzLmRybS5kcm07Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlpbnQgcmV0OwogCi0JaWYgKCEoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkpCisJaWYgKCEo
SU5URUxfR0VOKGk5MTUpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoaTkxNSkpKQogCQlyZXR1cm4g
dHJ1ZTsKIAogCWlmICghY3J0Y19zdGF0ZS0+aGFzX2luZm9mcmFtZSkKQEAgLTgzNyw3ICs4Mzcs
NyBAQCBzdGF0aWMgdm9pZCBnNHhfc2V0X2luZm9mcmFtZXMoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5f
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRl
bF9kaWdfcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGlu
dGVsX2hkbWkgKmludGVsX2hkbWkgPSAmaW50ZWxfZGlnX3BvcnQtPmhkbWk7CiAJaTkxNV9yZWdf
dCByZWcgPSBWSURFT19ESVBfQ1RMOwpAQCAtOTQ3LDcgKzk0Nyw3IEBAIHN0YXRpYyBib29sIGlu
dGVsX2hkbWlfc2V0X2djcF9pbmZvZnJhbWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkJ
IGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7CiAJaTkxNV9yZWdfdCByZWc7CiAKQEAgLTk1NSwxMSArOTU1LDExIEBA
IHN0YXRpYyBib29sIGludGVsX2hkbWlfc2V0X2djcF9pbmZvZnJhbWUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJICAgICBpbnRlbF9oZG1pX2luZm9mcmFtZV9lbmFibGUoSERNSV9Q
QUNLRVRfVFlQRV9HRU5FUkFMX0NPTlRST0wpKSA9PSAwKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlp
ZiAoSEFTX0RESShkZXZfcHJpdikpCisJaWYgKEhBU19EREkoaTkxNSkpCiAJCXJlZyA9IEhTV19U
VklERU9fRElQX0dDUChjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2Rlcik7Ci0JZWxzZSBpZiAoSVNf
VkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJZWxzZSBp
ZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQogCQlyZWcgPSBW
TFZfVFZJREVPX0RJUF9HQ1AoY3J0Yy0+cGlwZSk7Ci0JZWxzZSBpZiAoSEFTX1BDSF9TUExJVChk
ZXZfcHJpdikpCisJZWxzZSBpZiAoSEFTX1BDSF9TUExJVChpOTE1KSkKIAkJcmVnID0gVFZJREVP
X0RJUF9HQ1AoY3J0Yy0+cGlwZSk7CiAJZWxzZQogCQlyZXR1cm4gZmFsc2U7CkBAIC05NzIsNyAr
OTcyLDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfaGRtaV9zZXRfZ2NwX2luZm9mcmFtZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHZvaWQgaW50ZWxfaGRtaV9yZWFkX2djcF9pbmZvZnJh
bWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlpOTE1X3Jl
Z190IHJlZzsKIApAQCAtOTgwLDExICs5ODAsMTEgQEAgdm9pZCBpbnRlbF9oZG1pX3JlYWRfZ2Nw
X2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkgICAgIGludGVsX2hk
bWlfaW5mb2ZyYW1lX2VuYWJsZShIRE1JX1BBQ0tFVF9UWVBFX0dFTkVSQUxfQ09OVFJPTCkpID09
IDApCiAJCXJldHVybjsKIAotCWlmIChIQVNfRERJKGRldl9wcml2KSkKKwlpZiAoSEFTX0RESShp
OTE1KSkKIAkJcmVnID0gSFNXX1RWSURFT19ESVBfR0NQKGNydGNfc3RhdGUtPmNwdV90cmFuc2Nv
ZGVyKTsKLQllbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVX
KGRldl9wcml2KSkKKwllbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJ
RVcoaTkxNSkpCiAJCXJlZyA9IFZMVl9UVklERU9fRElQX0dDUChjcnRjLT5waXBlKTsKLQllbHNl
IGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkKKwllbHNlIGlmIChIQVNfUENIX1NQTElUKGk5
MTUpKQogCQlyZWcgPSBUVklERU9fRElQX0dDUChjcnRjLT5waXBlKTsKIAllbHNlCiAJCXJldHVy
bjsKQEAgLTk5Niw5ICs5OTYsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX2NvbXB1dGVfZ2Nw
X2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJICAgICBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkJICAgICBzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCi0JaWYgKElTX0c0
WChkZXZfcHJpdikgfHwgIWNydGNfc3RhdGUtPmhhc19pbmZvZnJhbWUpCisJaWYgKElTX0c0WChp
OTE1KSB8fCAhY3J0Y19zdGF0ZS0+aGFzX2luZm9mcmFtZSkKIAkJcmV0dXJuOwogCiAJY3J0Y19z
dGF0ZS0+aW5mb2ZyYW1lcy5lbmFibGUgfD0KQEAgLTEwMTksNyArMTAxOSw3IEBAIHN0YXRpYyB2
b2lkIGlieF9zZXRfaW5mb2ZyYW1lcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJ
CSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAg
ICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmlu
dGVsX2RpZ19wb3J0ID0gZW5jX3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3Qg
aW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9ICZpbnRlbF9kaWdfcG9ydC0+aGRtaTsKQEAgLTEwNzgs
NyArMTA3OCw3IEBAIHN0YXRpYyB2b2lkIGNwdF9zZXRfaW5mb2ZyYW1lcyhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0
ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRl
bF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBp
bnRlbF9oZG1pICppbnRlbF9oZG1pID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2Up
OwogCWk5MTVfcmVnX3QgcmVnID0gVFZJREVPX0RJUF9DVEwoaW50ZWxfY3J0Yy0+cGlwZSk7CkBA
IC0xMTI3LDcgKzExMjcsNyBAQCBzdGF0aWMgdm9pZCB2bHZfc2V0X2luZm9mcmFtZXMoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlz
dHJ1Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVy
LT5iYXNlKTsKIAlpOTE1X3JlZ190IHJlZyA9IFZMVl9UVklERU9fRElQX0NUTChpbnRlbF9jcnRj
LT5waXBlKTsKQEAgLTExODUsMTEgKzExODUsMTEgQEAgc3RhdGljIHZvaWQgaHN3X3NldF9pbmZv
ZnJhbWVzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgIGNvbnN0IHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJaTkx
NV9yZWdfdCByZWcgPSBIU1dfVFZJREVPX0RJUF9DVEwoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29k
ZXIpOwogCXUzMiB2YWwgPSBJOTE1X1JFQUQocmVnKTsKIAotCWFzc2VydF9oZG1pX3RyYW5zY29k
ZXJfZnVuY19kaXNhYmxlZChkZXZfcHJpdiwKKwlhc3NlcnRfaGRtaV90cmFuc2NvZGVyX2Z1bmNf
ZGlzYWJsZWQoaTkxNSwKIAkJCQkJICAgICBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2Rlcik7CiAK
IAl2YWwgJj0gfihWSURFT19ESVBfRU5BQkxFX1ZTQ19IU1cgfCBWSURFT19ESVBfRU5BQkxFX0FW
SV9IU1cgfApAQCAtMTIyNSw5ICsxMjI1LDkgQEAgc3RhdGljIHZvaWQgaHN3X3NldF9pbmZvZnJh
bWVzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiB2b2lkIGludGVsX2RwX2R1YWxf
bW9kZV9zZXRfdG1kc19vdXRwdXQoc3RydWN0IGludGVsX2hkbWkgKmhkbWksIGJvb2wgZW5hYmxl
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxf
aGRtaV90b19kZXYoaGRtaSkpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShpbnRlbF9oZG1pX3RvX2RldihoZG1pKSk7CiAJc3RydWN0IGkyY19hZGFwdGVyICphZGFw
dGVyID0KLQkJaW50ZWxfZ21idXNfZ2V0X2FkYXB0ZXIoZGV2X3ByaXYsIGhkbWktPmRkY19idXMp
OworCQlpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihpOTE1LCBoZG1pLT5kZGNfYnVzKTsKIAogCWlm
IChoZG1pLT5kcF9kdWFsX21vZGUudHlwZSA8IERSTV9EUF9EVUFMX01PREVfVFlQRTJfRFZJKQog
CQlyZXR1cm47CkBAIC0xMjQzLDkgKzEyNDMsOSBAQCBzdGF0aWMgaW50IGludGVsX2hkbWlfaGRj
cF9yZWFkKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogCQkJCXVu
c2lnbmVkIGludCBvZmZzZXQsIHZvaWQgKmJ1ZmZlciwgc2l6ZV90IHNpemUpCiB7CiAJc3RydWN0
IGludGVsX2hkbWkgKmhkbWkgPSAmaW50ZWxfZGlnX3BvcnQtPmhkbWk7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
CiAJCWludGVsX2RpZ19wb3J0LT5iYXNlLmJhc2UuZGV2LT5kZXZfcHJpdmF0ZTsKLQlzdHJ1Y3Qg
aTJjX2FkYXB0ZXIgKmFkYXB0ZXIgPSBpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihkZXZfcHJpdiwK
KwlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIgPSBpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihp
OTE1LAogCQkJCQkJCSAgICAgIGhkbWktPmRkY19idXMpOwogCWludCByZXQ7CiAJdTggc3RhcnQg
PSBvZmZzZXQgJiAweGZmOwpAQCAtMTI3Myw5ICsxMjczLDkgQEAgc3RhdGljIGludCBpbnRlbF9o
ZG1pX2hkY3Bfd3JpdGUoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQs
CiAJCQkJIHVuc2lnbmVkIGludCBvZmZzZXQsIHZvaWQgKmJ1ZmZlciwgc2l6ZV90IHNpemUpCiB7
CiAJc3RydWN0IGludGVsX2hkbWkgKmhkbWkgPSAmaW50ZWxfZGlnX3BvcnQtPmhkbWk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9CiAJCWludGVsX2RpZ19wb3J0LT5iYXNlLmJhc2UuZGV2LT5kZXZfcHJpdmF0ZTsK
LQlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIgPSBpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihk
ZXZfcHJpdiwKKwlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmFkYXB0ZXIgPSBpbnRlbF9nbWJ1c19nZXRf
YWRhcHRlcihpOTE1LAogCQkJCQkJCSAgICAgIGhkbWktPmRkY19idXMpOwogCWludCByZXQ7CiAJ
dTggKndyaXRlX2J1ZjsKQEAgLTEzMDgsOSArMTMwOCw5IEBAIGludCBpbnRlbF9oZG1pX2hkY3Bf
d3JpdGVfYW5fYWtzdihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwK
IAkJCQkgIHU4ICphbikKIHsKIAlzdHJ1Y3QgaW50ZWxfaGRtaSAqaGRtaSA9ICZpbnRlbF9kaWdf
cG9ydC0+aGRtaTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJaW50ZWxfZGlnX3BvcnQtPmJhc2UuYmFzZS5k
ZXYtPmRldl9wcml2YXRlOwotCXN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlciA9IGludGVsX2dt
YnVzX2dldF9hZGFwdGVyKGRldl9wcml2LAorCXN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlciA9
IGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGk5MTUsCiAJCQkJCQkJICAgICAgaGRtaS0+ZGRjX2J1
cyk7CiAJaW50IHJldDsKIApAQCAtMTQyOCw3ICsxNDI4LDcgQEAgaW50IGludGVsX2hkbWlfaGRj
cF9yZWFkX3ZfcHJpbWVfcGFydChzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdf
cG9ydCwKIAogc3RhdGljIGludCBrYmxfcmVwb3NpdGlvbmluZ19lbmNfZW5fc2lnbmFsKHN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9IGNvbm5fdG9fZGlnX3BvcnQo
Y29ubmVjdG9yKTsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBjb25uZWN0b3ItPmJhc2Uuc3Rh
dGUtPmNydGM7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSBjb250YWluZXJfb2Yo
Y3J0YywKQEAgLTE0NjMsNyArMTQ2Myw3IEBAIGludCBpbnRlbF9oZG1pX2hkY3BfdG9nZ2xlX3Np
Z25hbGxpbmcoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiB7CiAJ
c3RydWN0IGludGVsX2hkbWkgKmhkbWkgPSAmaW50ZWxfZGlnX3BvcnQtPmhkbWk7CiAJc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gaGRtaS0+YXR0YWNoZWRfY29ubmVjdG9yOwot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5l
Y3Rvci0+YmFzZS5kZXYpOwogCWludCByZXQ7CiAKIAlpZiAoIWVuYWJsZSkKQEAgLTE0ODAsNyAr
MTQ4MCw3IEBAIGludCBpbnRlbF9oZG1pX2hkY3BfdG9nZ2xlX3NpZ25hbGxpbmcoc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiAJICogV0E6IFRvIGZpeCBpbmNvcnJl
Y3QgcG9zaXRpb25pbmcgb2YgdGhlIHdpbmRvdyBvZgogCSAqIG9wcG9ydHVuaXR5IGFuZCBlbmNf
ZW4gc2lnbmFsbGluZyBpbiBLQUJZTEFLRS4KIAkgKi8KLQlpZiAoSVNfS0FCWUxBS0UoZGV2X3By
aXYpICYmIGVuYWJsZSkKKwlpZiAoSVNfS0FCWUxBS0UoaTkxNSkgJiYgZW5hYmxlKQogCQlyZXR1
cm4ga2JsX3JlcG9zaXRpb25pbmdfZW5jX2VuX3NpZ25hbChjb25uZWN0b3IpOwogCiAJcmV0dXJu
IDA7CkBAIC0xNDg5LDcgKzE0ODksNyBAQCBpbnQgaW50ZWxfaGRtaV9oZGNwX3RvZ2dsZV9zaWdu
YWxsaW5nKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0LAogc3RhdGlj
CiBib29sIGludGVsX2hkbWlfaGRjcF9jaGVja19saW5rKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3Bv
cnQgKmludGVsX2RpZ19wb3J0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQlpbnRlbF9kaWdfcG9ydC0+
YmFzZS5iYXNlLmRldi0+ZGV2X3ByaXZhdGU7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9kaWdf
cG9ydC0+YmFzZS5wb3J0OwogCWludCByZXQ7CkBAIC0xNzIwLDcgKzE3MjAsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9oZG1pX3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfaGRt
aSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsKIAljb25z
dCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5i
YXNlLmFkanVzdGVkX21vZGU7CkBAIC0xNzI5LDcgKzE3MjksNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9oZG1pX3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaW50ZWxfZHBf
ZHVhbF9tb2RlX3NldF90bWRzX291dHB1dChpbnRlbF9oZG1pLCB0cnVlKTsKIAogCWhkbWlfdmFs
ID0gU0RWT19FTkNPRElOR19IRE1JOwotCWlmICghSEFTX1BDSF9TUExJVChkZXZfcHJpdikgJiYg
Y3J0Y19zdGF0ZS0+bGltaXRlZF9jb2xvcl9yYW5nZSkKKwlpZiAoIUhBU19QQ0hfU1BMSVQoaTkx
NSkgJiYgY3J0Y19zdGF0ZS0+bGltaXRlZF9jb2xvcl9yYW5nZSkKIAkJaGRtaV92YWwgfD0gSERN
SV9DT0xPUl9SQU5HRV8xNl8yMzU7CiAJaWYgKGFkanVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01P
REVfRkxBR19QVlNZTkMpCiAJCWhkbWlfdmFsIHw9IFNEVk9fVlNZTkNfQUNUSVZFX0hJR0g7CkBA
IC0xNzQ0LDkgKzE3NDQsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX3ByZXBhcmUoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaWYgKGNydGNfc3RhdGUtPmhhc19oZG1pX3Npbmsp
CiAJCWhkbWlfdmFsIHw9IEhETUlfTU9ERV9TRUxFQ1RfSERNSTsKIAotCWlmIChIQVNfUENIX0NQ
VChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfQ1BUKGk5MTUpKQogCQloZG1pX3ZhbCB8PSBTRFZP
X1BJUEVfU0VMX0NQVChjcnRjLT5waXBlKTsKLQllbHNlIGlmIChJU19DSEVSUllWSUVXKGRldl9w
cml2KSkKKwllbHNlIGlmIChJU19DSEVSUllWSUVXKGk5MTUpKQogCQloZG1pX3ZhbCB8PSBTRFZP
X1BJUEVfU0VMX0NIVihjcnRjLT5waXBlKTsKIAllbHNlCiAJCWhkbWlfdmFsIHw9IFNEVk9fUElQ
RV9TRUwoY3J0Yy0+cGlwZSk7CkBAIC0xNzU4LDE5ICsxNzU4LDE5IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX2hkbWlfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRpYyBi
b29sIGludGVsX2hkbWlfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJCSAgICBlbnVtIHBpcGUgKnBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsK
IAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlib29sIHJldDsKIAotCXdha2VyZWYgPSBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGRldl9wcml2LAorCXdha2VyZWYgPSBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsCiAJCQkJCQkgICAgIGVuY29kZXIt
PnBvd2VyX2RvbWFpbik7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlyZXQg
PSBpbnRlbF9zZHZvX3BvcnRfZW5hYmxlZChkZXZfcHJpdiwgaW50ZWxfaGRtaS0+aGRtaV9yZWcs
IHBpcGUpOworCXJldCA9IGludGVsX3Nkdm9fcG9ydF9lbmFibGVkKGk5MTUsIGludGVsX2hkbWkt
PmhkbWlfcmVnLCBwaXBlKTsKIAotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBl
bmNvZGVyLT5wb3dlcl9kb21haW4sIHdha2VyZWYpOworCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0
KGk5MTUsIGVuY29kZXItPnBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CiAKIAlyZXR1cm4gcmV0Owog
fQpAQCAtMTc4MCw3ICsxNzgwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfaGRtaV9nZXRfY29uZmln
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBpbnRlbF9oZG1pICpp
bnRlbF9oZG1pID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSBlbmNvZGVyLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGRldik7CiAJdTMyIHRtcCwgZmxhZ3MgPSAwOwogCWludCBkb3RjbG9j
azsKIApAQCAtMTgxMCw3ICsxODEwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfaGRtaV9nZXRfY29u
ZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWlmICh0bXAgJiBIRE1JX0FVRElP
X0VOQUJMRSkKIAkJcGlwZV9jb25maWctPmhhc19hdWRpbyA9IHRydWU7CiAKLQlpZiAoIUhBU19Q
Q0hfU1BMSVQoZGV2X3ByaXYpICYmCisJaWYgKCFIQVNfUENIX1NQTElUKGk5MTUpICYmCiAJICAg
IHRtcCAmIEhETUlfQ09MT1JfUkFOR0VfMTZfMjM1KQogCQlwaXBlX2NvbmZpZy0+bGltaXRlZF9j
b2xvcl9yYW5nZSA9IHRydWU7CiAKQEAgLTE4NTgsNyArMTg1OCw3IEBAIHN0YXRpYyB2b2lkIGc0
eF9lbmFibGVfaGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICBjb25z
dCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gZW5jb2Rlci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1pID0gZW5j
X3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwogCXUzMiB0ZW1wOwogCkBAIC0xODgwLDcg
KzE4ODAsNyBAQCBzdGF0aWMgdm9pZCBpYnhfZW5hYmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQkgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNv
bm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmJhc2UuZGV2
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsK
IAl1MzIgdGVtcDsKIApAQCAtMTkzMCw3ICsxOTMwLDcgQEAgc3RhdGljIHZvaWQgY3B0X2VuYWJs
ZV9oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgIGNvbnN0IHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBlbmNvZGVyLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBp
cGVfY29uZmlnLT5iYXNlLmNydGMpOwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1pID0g
ZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKQEAgLTE5OTEsNyArMTk5MSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVf
aGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgICBjb25zdCBzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9IGVuY29kZXItPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190
b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0
ICppbnRlbF9kaWdfcG9ydCA9CiAJCWhkbWlfdG9fZGlnX3BvcnQoaW50ZWxfaGRtaSk7CkBAIC0y
MDA5LDEzICsyMDA5LDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVfaGRtaShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkgKiB0byB0cmFuc2NvZGVyIEEgYWZ0ZXIgZGlzYWJs
aW5nIGl0IHRvIGFsbG93IHRoZQogCSAqIG1hdGNoaW5nIERQIHBvcnQgdG8gYmUgZW5hYmxlZCBv
biB0cmFuc2NvZGVyIEEuCiAJICovCi0JaWYgKEhBU19QQ0hfSUJYKGRldl9wcml2KSAmJiBjcnRj
LT5waXBlID09IFBJUEVfQikgeworCWlmIChIQVNfUENIX0lCWChpOTE1KSAmJiBjcnRjLT5waXBl
ID09IFBJUEVfQikgewogCQkvKgogCQkgKiBXZSBnZXQgQ1BVL1BDSCBGSUZPIHVuZGVycnVucyBv
biB0aGUgb3RoZXIgcGlwZSB3aGVuCiAJCSAqIGRvaW5nIHRoZSB3b3JrYXJvdW5kLiBTd2VlcCB0
aGVtIHVuZGVyIHRoZSBydWcuCiAJCSAqLwotCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5f
cmVwb3J0aW5nKGRldl9wcml2LCBQSVBFX0EsIGZhbHNlKTsKLQkJaW50ZWxfc2V0X3BjaF9maWZv
X3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgUElQRV9BLCBmYWxzZSk7CisJCWludGVsX3Nl
dF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgUElQRV9BLCBmYWxzZSk7CisJCWlu
dGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgUElQRV9BLCBmYWxzZSk7
CiAKIAkJdGVtcCAmPSB+U0RWT19QSVBFX1NFTF9NQVNLOwogCQl0ZW1wIHw9IFNEVk9fRU5BQkxF
IHwgU0RWT19QSVBFX1NFTChQSVBFX0EpOwpAQCAtMjAzMiw5ICsyMDMyLDkgQEAgc3RhdGljIHZv
aWQgaW50ZWxfZGlzYWJsZV9oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlJ
OTE1X1dSSVRFKGludGVsX2hkbWktPmhkbWlfcmVnLCB0ZW1wKTsKIAkJUE9TVElOR19SRUFEKGlu
dGVsX2hkbWktPmhkbWlfcmVnKTsKIAotCQlpbnRlbF93YWl0X2Zvcl92YmxhbmtfaWZfYWN0aXZl
KGRldl9wcml2LCBQSVBFX0EpOwotCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0
aW5nKGRldl9wcml2LCBQSVBFX0EsIHRydWUpOwotCQlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJy
dW5fcmVwb3J0aW5nKGRldl9wcml2LCBQSVBFX0EsIHRydWUpOworCQlpbnRlbF93YWl0X2Zvcl92
YmxhbmtfaWZfYWN0aXZlKGk5MTUsIFBJUEVfQSk7CisJCWludGVsX3NldF9jcHVfZmlmb191bmRl
cnJ1bl9yZXBvcnRpbmcoaTkxNSwgUElQRV9BLCB0cnVlKTsKKwkJaW50ZWxfc2V0X3BjaF9maWZv
X3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBQSVBFX0EsIHRydWUpOwogCX0KIAogCWludGVsX2Rp
Z19wb3J0LT5zZXRfaW5mb2ZyYW1lcyhlbmNvZGVyLApAQCAtMjA3MywxNiArMjA3MywxNiBAQCBz
dGF0aWMgdm9pZCBwY2hfcG9zdF9kaXNhYmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAKIHN0YXRpYyBpbnQgaW50ZWxfaGRtaV9zb3VyY2VfbWF4X3RtZHNfY2xvY2soc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1
Y3QgZGRpX3ZidF9wb3J0X2luZm8gKmluZm8gPQotCQkmZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9p
bmZvW2VuY29kZXItPnBvcnRdOworCQkmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bZW5jb2Rlci0+
cG9ydF07CiAJaW50IG1heF90bWRzX2Nsb2NrOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+
PSAxMCB8fCBJU19HRU1JTklMQUtFKGk5MTUpKQogCQltYXhfdG1kc19jbG9jayA9IDU5NDAwMDsK
LQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDggfHwgSVNfSEFTV0VMTChkZXZfcHJp
dikpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDggfHwgSVNfSEFTV0VMTChpOTE1KSkK
IAkJbWF4X3RtZHNfY2xvY2sgPSAzMDAwMDA7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA1KQorCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA1KQogCQltYXhfdG1kc19jbG9j
ayA9IDIyNTAwMDsKIAllbHNlCiAJCW1heF90bWRzX2Nsb2NrID0gMTY1MDAwOwpAQCAtMjEyMyw3
ICsyMTIzLDcgQEAgaGRtaV9wb3J0X2Nsb2NrX3ZhbGlkKHN0cnVjdCBpbnRlbF9oZG1pICpoZG1p
LAogCQkgICAgICBpbnQgY2xvY2ssIGJvb2wgcmVzcGVjdF9kb3duc3RyZWFtX2xpbWl0cywKIAkJ
ICAgICAgYm9vbCBmb3JjZV9kdmkpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShpbnRlbF9oZG1pX3RvX2RldihoZG1pKSk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGludGVsX2hkbWlfdG9fZGV2KGhkbWkpKTsKIAogCWlm
IChjbG9jayA8IDI1MDAwKQogCQlyZXR1cm4gTU9ERV9DTE9DS19MT1c7CkBAIC0yMTMxLDExICsy
MTMxLDExIEBAIGhkbWlfcG9ydF9jbG9ja192YWxpZChzdHJ1Y3QgaW50ZWxfaGRtaSAqaGRtaSwK
IAkJcmV0dXJuIE1PREVfQ0xPQ0tfSElHSDsKIAogCS8qIEJYVCBEUExMIGNhbid0IGdlbmVyYXRl
IDIyMy0yNDAgTUh6ICovCi0JaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpICYmIGNsb2NrID4gMjIz
MzMzICYmIGNsb2NrIDwgMjQwMDAwKQorCWlmIChJU19HRU45X0xQKGk5MTUpICYmIGNsb2NrID4g
MjIzMzMzICYmIGNsb2NrIDwgMjQwMDAwKQogCQlyZXR1cm4gTU9ERV9DTE9DS19SQU5HRTsKIAog
CS8qIENIViBEUExMIGNhbid0IGdlbmVyYXRlIDIxNi0yNDAgTUh6ICovCi0JaWYgKElTX0NIRVJS
WVZJRVcoZGV2X3ByaXYpICYmIGNsb2NrID4gMjE2MDAwICYmIGNsb2NrIDwgMjQwMDAwKQorCWlm
IChJU19DSEVSUllWSUVXKGk5MTUpICYmIGNsb2NrID4gMjE2MDAwICYmIGNsb2NrIDwgMjQwMDAw
KQogCQlyZXR1cm4gTU9ERV9DTE9DS19SQU5HRTsKIAogCXJldHVybiBNT0RFX09LOwpAQCAtMjE0
Nyw3ICsyMTQ3LDcgQEAgaW50ZWxfaGRtaV9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IsCiB7CiAJc3RydWN0IGludGVsX2hkbWkgKmhkbWkgPSBpbnRlbF9hdHRhY2hl
ZF9oZG1pKGNvbm5lY3Rvcik7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGludGVsX2hkbWlf
dG9fZGV2KGhkbWkpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsK
IAllbnVtIGRybV9tb2RlX3N0YXR1cyBzdGF0dXM7CiAJaW50IGNsb2NrOwogCWludCBtYXhfZG90
Y2xrID0gdG9faTkxNShjb25uZWN0b3ItPmRldiktPm1heF9kb3RjbGtfZnJlcTsKQEAgLTIxNzYs
MTIgKzIxNzYsMTIgQEAgaW50ZWxfaGRtaV9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IsCiAKIAlpZiAoaGRtaS0+aGFzX2hkbWlfc2luayAmJiAhZm9yY2VfZHZpKSB7
CiAJCS8qIGlmIHdlIGNhbid0IGRvIDhicGMgd2UgbWF5IHN0aWxsIGJlIGFibGUgdG8gZG8gMTJi
cGMgKi8KLQkJaWYgKHN0YXR1cyAhPSBNT0RFX09LICYmICFIQVNfR01DSChkZXZfcHJpdikpCisJ
CWlmIChzdGF0dXMgIT0gTU9ERV9PSyAmJiAhSEFTX0dNQ0goaTkxNSkpCiAJCQlzdGF0dXMgPSBo
ZG1pX3BvcnRfY2xvY2tfdmFsaWQoaGRtaSwgY2xvY2sgKiAzIC8gMiwKIAkJCQkJCSAgICAgICB0
cnVlLCBmb3JjZV9kdmkpOwogCiAJCS8qIGlmIHdlIGNhbid0IGRvIDgsMTJicGMgd2UgbWF5IHN0
aWxsIGJlIGFibGUgdG8gZG8gMTBicGMgKi8KLQkJaWYgKHN0YXR1cyAhPSBNT0RFX09LICYmIElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJCWlmIChzdGF0dXMgIT0gTU9ERV9PSyAmJiBJTlRF
TF9HRU4oaTkxNSkgPj0gMTEpCiAJCQlzdGF0dXMgPSBoZG1pX3BvcnRfY2xvY2tfdmFsaWQoaGRt
aSwgY2xvY2sgKiA1IC8gNCwKIAkJCQkJCSAgICAgICB0cnVlLCBmb3JjZV9kdmkpOwogCX0KQEAg
LTIxOTIsNyArMjE5Miw3IEBAIGludGVsX2hkbWlfbW9kZV92YWxpZChzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yLAogc3RhdGljIGJvb2wgaGRtaV9kZWVwX2NvbG9yX3Bvc3NpYmxlKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICAgaW50IGJw
YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0KIAkJdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRl
dik7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3J0Y19zdGF0ZS0+YmFzZS5z
dGF0ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlOwpAQCAt
MjIwMSwxMCArMjIwMSwxMCBAQCBzdGF0aWMgYm9vbCBoZG1pX2RlZXBfY29sb3JfcG9zc2libGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSZjcnRjX3N0YXRl
LT5iYXNlLmFkanVzdGVkX21vZGU7CiAJaW50IGk7CiAKLQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYp
KQorCWlmIChIQVNfR01DSChpOTE1KSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKGJwYyA9PSAx
MCAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCisJaWYgKGJwYyA9PSAxMCAmJiBJTlRFTF9H
RU4oaTkxNSkgPCAxMSkKIAkJcmV0dXJuIGZhbHNlOwogCiAJaWYgKGNydGNfc3RhdGUtPnBpcGVf
YnBwIDwgYnBjICogMykKQEAgLTIyNDYsMTMgKzIyNDYsMTMgQEAgc3RhdGljIGJvb2wgaGRtaV9k
ZWVwX2NvbG9yX3Bvc3NpYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCX0KIAogCS8qIERpc3BsYXkgV0EgIzExMzk6IGdsayAqLwotCWlmIChicGMgPT0gMTIg
JiYgSVNfR0xLX1JFVklEKGRldl9wcml2LCAwLCBHTEtfUkVWSURfQTEpICYmCisJaWYgKGJwYyA9
PSAxMiAmJiBJU19HTEtfUkVWSUQoaTkxNSwgMCwgR0xLX1JFVklEX0ExKSAmJgogCSAgICBhZGp1
c3RlZF9tb2RlLT5odG90YWwgPiA1NDYwKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKiBEaXNwbGF5
IFdhXzE0MDU1MTAwNTc6aWNsICovCiAJaWYgKGNydGNfc3RhdGUtPm91dHB1dF9mb3JtYXQgPT0g
SU5URUxfT1VUUFVUX0ZPUk1BVF9ZQ0JDUjQyMCAmJgotCSAgICBicGMgPT0gMTAgJiYgSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMSAmJgorCSAgICBicGMgPT0gMTAgJiYgSU5URUxfR0VOKGk5MTUp
ID49IDExICYmCiAJICAgIChhZGp1c3RlZF9tb2RlLT5jcnRjX2hibGFua19lbmQgLQogCSAgICAg
YWRqdXN0ZWRfbW9kZS0+Y3J0Y19oYmxhbmtfc3RhcnQpICUgOCA9PSAyKQogCQlyZXR1cm4gZmFs
c2U7CkBAIC0yMjk3LDcgKzIyOTcsNyBAQCBpbnQgaW50ZWxfaGRtaV9jb21wdXRlX2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgIHN0cnVjdCBkcm1fY29ubmVj
dG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1p
ID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gY29ubl9z
dGF0ZS0+Y29ubmVjdG9yOwogCXN0cnVjdCBkcm1fc2NkYyAqc2NkYyA9ICZjb25uZWN0b3ItPmRp
c3BsYXlfaW5mby5oZG1pLnNjZGM7CkBAIC0yMzQ1LDcgKzIzNDUsNyBAQCBpbnQgaW50ZWxfaGRt
aV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJfQogCX0K
IAotCWlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSAmJiAhSEFTX0RESShkZXZfcHJpdikpCisJ
aWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkgJiYgIUhBU19EREkoaTkxNSkpCiAJCXBpcGVfY29uZmln
LT5oYXNfcGNoX2VuY29kZXIgPSB0cnVlOwogCiAJaWYgKHBpcGVfY29uZmlnLT5oYXNfaGRtaV9z
aW5rKSB7CkBAIC0yMzk5LDggKzIzOTksOCBAQCBpbnQgaW50ZWxfaGRtaV9jb21wdXRlX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCXBpcGVfY29uZmlnLT5sYW5lX2Nv
dW50ID0gNDsKIAotCWlmIChzY2RjLT5zY3JhbWJsaW5nLnN1cHBvcnRlZCAmJiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMCB8fAotCQkJCQkgICBJU19HRU1JTklMQUtFKGRldl9wcml2KSkpIHsK
KwlpZiAoc2NkYy0+c2NyYW1ibGluZy5zdXBwb3J0ZWQgJiYgKElOVEVMX0dFTihpOTE1KSA+PSAx
MCB8fAorCQkJCQkgICBJU19HRU1JTklMQUtFKGk5MTUpKSkgewogCQlpZiAoc2NkYy0+c2NyYW1i
bGluZy5sb3dfcmF0ZXMpCiAJCQlwaXBlX2NvbmZpZy0+aGRtaV9zY3JhbWJsaW5nID0gdHJ1ZTsK
IApAQCAtMjQ1MywxMSArMjQ1MywxMSBAQCBpbnRlbF9oZG1pX3Vuc2V0X2VkaWQoc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHN0YXRpYyB2b2lkCiBpbnRlbF9oZG1pX2RwX2R1YWxf
bW9kZV9kZXRlY3Qoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwgYm9vbCBoYXNfZWRp
ZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5l
Y3Rvci0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29u
bmVjdG9yLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9oZG1pICpoZG1pID0gaW50ZWxfYXR0YWNoZWRf
aGRtaShjb25uZWN0b3IpOwogCWVudW0gcG9ydCBwb3J0ID0gaGRtaV90b19kaWdfcG9ydChoZG1p
KS0+YmFzZS5wb3J0OwogCXN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlciA9Ci0JCWludGVsX2dt
YnVzX2dldF9hZGFwdGVyKGRldl9wcml2LCBoZG1pLT5kZGNfYnVzKTsKKwkJaW50ZWxfZ21idXNf
Z2V0X2FkYXB0ZXIoaTkxNSwgaGRtaS0+ZGRjX2J1cyk7CiAJZW51bSBkcm1fZHBfZHVhbF9tb2Rl
X3R5cGUgdHlwZSA9IGRybV9kcF9kdWFsX21vZGVfZGV0ZWN0KGFkYXB0ZXIpOwogCiAJLyoKQEAg
LTI0NzcsNyArMjQ3Nyw3IEBAIGludGVsX2hkbWlfZHBfZHVhbF9tb2RlX2RldGVjdChzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBib29sIGhhc19lZGlkKQogCQkgKiBNYWtlIHN1cmUg
bm90IHRvIHNldCBsaW1pdHMgZm9yIHRoYXQgcG9ydC4KIAkJICovCiAJCWlmIChoYXNfZWRpZCAm
JiAhY29ubmVjdG9yLT5vdmVycmlkZV9lZGlkICYmCi0JCSAgICBpbnRlbF9iaW9zX2lzX3BvcnRf
ZHBfZHVhbF9tb2RlKGRldl9wcml2LCBwb3J0KSkgeworCQkgICAgaW50ZWxfYmlvc19pc19wb3J0
X2RwX2R1YWxfbW9kZShpOTE1LCBwb3J0KSkgewogCQkJRFJNX0RFQlVHX0tNUygiQXNzdW1pbmcg
RFAgZHVhbCBtb2RlIGFkYXB0b3IgcHJlc2VuY2UgYmFzZWQgb24gVkJUXG4iKTsKIAkJCXR5cGUg
PSBEUk1fRFBfRFVBTF9NT0RFX1RZUEUxX0RWSTsKIAkJfSBlbHNlIHsKQEAgLTI1MDAsMTYgKzI1
MDAsMTYgQEAgaW50ZWxfaGRtaV9kcF9kdWFsX21vZGVfZGV0ZWN0KHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IsIGJvb2wgaGFzX2VkaWQpCiBzdGF0aWMgYm9vbAogaW50ZWxfaGRtaV9z
ZXRfZWRpZChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7CiAJc3Ry
dWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBpbnRlbF9hdHRhY2hlZF9oZG1pKGNvbm5lY3Rv
cik7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGVkaWQgKmVkaWQ7CiAJYm9v
bCBjb25uZWN0ZWQgPSBmYWxzZTsKIAlzdHJ1Y3QgaTJjX2FkYXB0ZXIgKmkyYzsKIAotCXdha2Vy
ZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0dNQlVT
KTsKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoaTkxNSwgUE9XRVJfRE9NQUlO
X0dNQlVTKTsKIAotCWkyYyA9IGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGRldl9wcml2LCBpbnRl
bF9oZG1pLT5kZGNfYnVzKTsKKwlpMmMgPSBpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihpOTE1LCBp
bnRlbF9oZG1pLT5kZGNfYnVzKTsKIAogCWVkaWQgPSBkcm1fZ2V0X2VkaWQoY29ubmVjdG9yLCBp
MmMpOwogCkBAIC0yNTIyLDcgKzI1MjIsNyBAQCBpbnRlbF9oZG1pX3NldF9lZGlkKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAKIAlpbnRlbF9oZG1pX2RwX2R1YWxfbW9kZV9kZXRl
Y3QoY29ubmVjdG9yLCBlZGlkICE9IE5VTEwpOwogCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQo
ZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9HTUJVUywgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9w
b3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlOX0dNQlVTLCB3YWtlcmVmKTsKIAogCXRvX2ludGVs
X2Nvbm5lY3Rvcihjb25uZWN0b3IpLT5kZXRlY3RfZWRpZCA9IGVkaWQ7CiAJaWYgKGVkaWQgJiYg
ZWRpZC0+aW5wdXQgJiBEUk1fRURJRF9JTlBVVF9ESUdJVEFMKSB7CkBAIC0yNTQxLDcgKzI1NDEs
NyBAQCBzdGF0aWMgZW51bSBkcm1fY29ubmVjdG9yX3N0YXR1cwogaW50ZWxfaGRtaV9kZXRlY3Qo
c3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwgYm9vbCBmb3JjZSkKIHsKIAllbnVtIGRy
bV9jb25uZWN0b3Jfc3RhdHVzIHN0YXR1cyA9IGNvbm5lY3Rvcl9zdGF0dXNfZGlzY29ubmVjdGVk
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9y
LT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0
b3ItPmRldik7CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBpbnRlbF9hdHRhY2hl
ZF9oZG1pKGNvbm5lY3Rvcik7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmaGRt
aV90b19kaWdfcG9ydChpbnRlbF9oZG1pKS0+YmFzZTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJl
ZjsKQEAgLTI1NDksOSArMjU0OSw5IEBAIGludGVsX2hkbWlfZGV0ZWN0KHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsIGJvb2wgZm9yY2UpCiAJRFJNX0RFQlVHX0tNUygiW0NPTk5FQ1RP
UjolZDolc11cbiIsCiAJCSAgICAgIGNvbm5lY3Rvci0+YmFzZS5pZCwgY29ubmVjdG9yLT5uYW1l
KTsKIAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgUE9XRVJf
RE9NQUlOX0dNQlVTKTsKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoaTkxNSwg
UE9XRVJfRE9NQUlOX0dNQlVTKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYm
CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSAmJgogCSAgICAhaW50ZWxfZGlnaXRhbF9wb3J0
X2Nvbm5lY3RlZChlbmNvZGVyKSkKIAkJZ290byBvdXQ7CiAKQEAgLTI1NjEsNyArMjU2MSw3IEBA
IGludGVsX2hkbWlfZGV0ZWN0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsIGJvb2wg
Zm9yY2UpCiAJCXN0YXR1cyA9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkOwogCiBvdXQ6Ci0J
aW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9HTUJVUywgd2Fr
ZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgUE9XRVJfRE9NQUlOX0dNQlVT
LCB3YWtlcmVmKTsKIAogCWlmIChzdGF0dXMgIT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQp
CiAJCWNlY19ub3RpZmllcl9waHlzX2FkZHJfaW52YWxpZGF0ZShpbnRlbF9oZG1pLT5jZWNfbm90
aWZpZXIpOwpAQCAtMjYxMyw3ICsyNjEzLDcgQEAgc3RhdGljIHZvaWQgdmx2X2hkbWlfcHJlX2Vu
YWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQljb25zdCBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9w
b3J0ICpkcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKIAogCXZsdl9waHlfcHJlX2VuY29kZXJfZW5hYmxlKGVuY29kZXIsIHBpcGVfY29uZmlnKTsK
IApAQCAtMjYyNyw3ICsyNjI3LDcgQEAgc3RhdGljIHZvaWQgdmx2X2hkbWlfcHJlX2VuYWJsZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCWc0eF9lbmFibGVfaGRtaShlbmNvZGVy
LCBwaXBlX2NvbmZpZywgY29ubl9zdGF0ZSk7CiAKLQl2bHZfd2FpdF9wb3J0X3JlYWR5KGRldl9w
cml2LCBkcG9ydCwgMHgwKTsKKwl2bHZfd2FpdF9wb3J0X3JlYWR5KGk5MTUsIGRwb3J0LCAweDAp
OwogfQogCiBzdGF0aWMgdm9pZCB2bHZfaGRtaV9wcmVfcGxsX2VuYWJsZShzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKQEAgLTI2NjgsMTQgKzI2NjgsMTQgQEAgc3RhdGljIHZvaWQgY2h2
X2hkbWlfcG9zdF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAg
Y29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlKQogewogCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBlbmNvZGVyLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAKLQl2bHZfZHBpb19nZXQoZGV2X3ByaXYpOwor
CXZsdl9kcGlvX2dldChpOTE1KTsKIAogCS8qIEFzc2VydCBkYXRhIGxhbmUgcmVzZXQgKi8KIAlj
aHZfZGF0YV9sYW5lX3NvZnRfcmVzZXQoZW5jb2Rlciwgb2xkX2NydGNfc3RhdGUsIHRydWUpOwog
Ci0Jdmx2X2RwaW9fcHV0KGRldl9wcml2KTsKKwl2bHZfZHBpb19wdXQoaTkxNSk7CiB9CiAKIHN0
YXRpYyB2b2lkIGNodl9oZG1pX3ByZV9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCkBAIC0yNjg0LDcgKzI2ODQsNyBAQCBzdGF0aWMgdm9pZCBjaHZfaGRtaV9wcmVfZW5hYmxl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFs
X3BvcnQgKmRwb3J0ID0gZW5jX3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gZW5jb2Rlci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShkZXYpOwogCiAJY2h2X3BoeV9wcmVfZW5jb2Rlcl9lbmFibGUoZW5j
b2RlciwgcGlwZV9jb25maWcpOwogCkBAIC0yNjk4LDcgKzI2OTgsNyBAQCBzdGF0aWMgdm9pZCBj
aHZfaGRtaV9wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJZzR4
X2VuYWJsZV9oZG1pKGVuY29kZXIsIHBpcGVfY29uZmlnLCBjb25uX3N0YXRlKTsKIAotCXZsdl93
YWl0X3BvcnRfcmVhZHkoZGV2X3ByaXYsIGRwb3J0LCAweDApOworCXZsdl93YWl0X3BvcnRfcmVh
ZHkoaTkxNSwgZHBvcnQsIDB4MCk7CiAKIAkvKiBTZWNvbmQgY29tbW9uIGxhbmUgd2lsbCBzdGF5
IGFsaXZlIG9uIGl0cyBvd24gbm93ICovCiAJY2h2X3BoeV9yZWxlYXNlX2NsMl9vdmVycmlkZShl
bmNvZGVyKTsKQEAgLTI3MDcsMTAgKzI3MDcsMTAgQEAgc3RhdGljIHZvaWQgY2h2X2hkbWlfcHJl
X2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRpYyBzdHJ1Y3QgaTJj
X2FkYXB0ZXIgKgogaW50ZWxfaGRtaV9nZXRfaTJjX2FkYXB0ZXIoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1p
ID0gaW50ZWxfYXR0YWNoZWRfaGRtaShjb25uZWN0b3IpOwogCi0JcmV0dXJuIGludGVsX2dtYnVz
X2dldF9hZGFwdGVyKGRldl9wcml2LCBpbnRlbF9oZG1pLT5kZGNfYnVzKTsKKwlyZXR1cm4gaW50
ZWxfZ21idXNfZ2V0X2FkYXB0ZXIoaTkxNSwgaW50ZWxfaGRtaS0+ZGRjX2J1cyk7CiB9CiAKIHN0
YXRpYyB2b2lkIGludGVsX2hkbWlfY3JlYXRlX2kyY19zeW1saW5rKHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IpCkBAIC0yNzkxLDcgKzI3OTEsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IGRybV9lbmNvZGVyX2Z1bmNzIGludGVsX2hkbWlfZW5jX2Z1bmNzID0gewogc3RhdGljIHZvaWQK
IGludGVsX2hkbWlfYWRkX3Byb3BlcnRpZXMoc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWks
IHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9CiAJCQkJaGRtaV90b19kaWdfcG9ydChp
bnRlbF9oZG1pKTsKIApAQCAtMjgxMCwxMSArMjgxMCwxMSBAQCBpbnRlbF9oZG1pX2FkZF9wcm9w
ZXJ0aWVzKHN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1pLCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqYwogCWRybV9jb25uZWN0b3JfYXR0YWNoX2NvbnRlbnRfdHlwZV9wcm9wZXJ0eShjb25uZWN0
b3IpOwogCWNvbm5lY3Rvci0+c3RhdGUtPnBpY3R1cmVfYXNwZWN0X3JhdGlvID0gSERNSV9QSUNU
VVJFX0FTUEVDVF9OT05FOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNf
R0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMCB8fCBJU19H
RU1JTklMQUtFKGk5MTUpKQogCQlkcm1fb2JqZWN0X2F0dGFjaF9wcm9wZXJ0eSgmY29ubmVjdG9y
LT5iYXNlLAogCQkJY29ubmVjdG9yLT5kZXYtPm1vZGVfY29uZmlnLmhkcl9vdXRwdXRfbWV0YWRh
dGFfcHJvcGVydHksIDApOwogCi0JaWYgKCFIQVNfR01DSChkZXZfcHJpdikpCisJaWYgKCFIQVNf
R01DSChpOTE1KSkKIAkJZHJtX2Nvbm5lY3Rvcl9hdHRhY2hfbWF4X2JwY19wcm9wZXJ0eShjb25u
ZWN0b3IsIDgsIDEyKTsKIH0KIApAQCAtMjg0MSwxMiArMjg0MSwxMiBAQCBib29sIGludGVsX2hk
bWlfaGFuZGxlX3Npbmtfc2NyYW1ibGluZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAkJCQkgICAgICAgYm9vbCBoaWdoX3RtZHNfY2xvY2tfcmF0aW8sCiAJCQkJICAgICAgIGJvb2wg
c2NyYW1ibGluZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9o
ZG1pID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBkcm1fc2Ny
YW1ibGluZyAqc2lua19zY3JhbWJsaW5nID0KIAkJJmNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLmhk
bWkuc2NkYy5zY3JhbWJsaW5nOwogCXN0cnVjdCBpMmNfYWRhcHRlciAqYWRhcHRlciA9Ci0JCWlu
dGVsX2dtYnVzX2dldF9hZGFwdGVyKGRldl9wcml2LCBpbnRlbF9oZG1pLT5kZGNfYnVzKTsKKwkJ
aW50ZWxfZ21idXNfZ2V0X2FkYXB0ZXIoaTkxNSwgaW50ZWxfaGRtaS0+ZGRjX2J1cyk7CiAKIAlp
ZiAoIXNpbmtfc2NyYW1ibGluZy0+c3VwcG9ydGVkKQogCQlyZXR1cm4gdHJ1ZTsKQEAgLTI4NjEs
NyArMjg2MSw3IEBAIGJvb2wgaW50ZWxfaGRtaV9oYW5kbGVfc2lua19zY3JhbWJsaW5nKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlkcm1fc2NkY19zZXRfc2NyYW1ibGluZyhhZGFw
dGVyLCBzY3JhbWJsaW5nKTsKIH0KIAotc3RhdGljIHU4IGNodl9wb3J0X3RvX2RkY19waW4oc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKK3N0YXRpYyB1
OCBjaHZfcG9ydF90b19kZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVt
IHBvcnQgcG9ydCkKIHsKIAl1OCBkZGNfcGluOwogCkBAIC0yODgzLDcgKzI4ODMsNyBAQCBzdGF0
aWMgdTggY2h2X3BvcnRfdG9fZGRjX3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIGVudW0gcG9ydCBwb3J0KQogCXJldHVybiBkZGNfcGluOwogfQogCi1zdGF0aWMgdTggYnh0
X3BvcnRfdG9fZGRjX3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0g
cG9ydCBwb3J0KQorc3RhdGljIHU4IGJ4dF9wb3J0X3RvX2RkY19waW4oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9ydCBwb3J0KQogewogCXU4IGRkY19waW47CiAKQEAgLTI5
MDIsNyArMjkwMiw3IEBAIHN0YXRpYyB1OCBieHRfcG9ydF90b19kZGNfcGluKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCiAJcmV0dXJuIGRkY19waW47
CiB9CiAKLXN0YXRpYyB1OCBjbnBfcG9ydF90b19kZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB1OCBjbnBfcG9ydF90b19kZGNfcGluKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgZW51bSBwb3J0IHBvcnQpCiB7CiAJdTggZGRj
X3BpbjsKQEAgLTI5MjgsNyArMjkyOCw3IEBAIHN0YXRpYyB1OCBjbnBfcG9ydF90b19kZGNfcGlu
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gZGRjX3BpbjsKIH0K
IAotc3RhdGljIHU4IGljbF9wb3J0X3RvX2RkY19waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKK3N0YXRpYyB1OCBpY2xfcG9ydF90b19kZGNfcGlu
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9ydCkKIHsKIAl1OCBk
ZGNfcGluOwogCkBAIC0yOTU5LDcgKzI5NTksNyBAQCBzdGF0aWMgdTggaWNsX3BvcnRfdG9fZGRj
X3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQog
CXJldHVybiBkZGNfcGluOwogfQogCi1zdGF0aWMgdTggZzR4X3BvcnRfdG9fZGRjX3BpbihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdTggZzR4X3BvcnRfdG9fZGRj
X3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIGVudW0gcG9ydCBw
b3J0KQogewogCXU4IGRkY19waW47CkBAIC0yOTgyLDExICsyOTgyLDExIEBAIHN0YXRpYyB1OCBn
NHhfcG9ydF90b19kZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAly
ZXR1cm4gZGRjX3BpbjsKIH0KIAotc3RhdGljIHU4IGludGVsX2hkbWlfZGRjX3BpbihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdTggaW50ZWxfaGRtaV9kZGNfcGlu
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICBlbnVtIHBvcnQgcG9ydCkK
IHsKIAljb25zdCBzdHJ1Y3QgZGRpX3ZidF9wb3J0X2luZm8gKmluZm8gPQotCQkmZGV2X3ByaXYt
PnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOworCQkmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9y
dF07CiAJdTggZGRjX3BpbjsKIAogCWlmIChpbmZvLT5hbHRlcm5hdGVfZGRjX3BpbikgewpAQCAt
Mjk5NSwxNiArMjk5NSwxNiBAQCBzdGF0aWMgdTggaW50ZWxfaGRtaV9kZGNfcGluKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuIGluZm8tPmFsdGVybmF0ZV9kZGNf
cGluOwogCX0KIAotCWlmIChIQVNfUENIX0lDUChkZXZfcHJpdikpCi0JCWRkY19waW4gPSBpY2xf
cG9ydF90b19kZGNfcGluKGRldl9wcml2LCBwb3J0KTsKLQllbHNlIGlmIChIQVNfUENIX0NOUChk
ZXZfcHJpdikpCi0JCWRkY19waW4gPSBjbnBfcG9ydF90b19kZGNfcGluKGRldl9wcml2LCBwb3J0
KTsKLQllbHNlIGlmIChJU19HRU45X0xQKGRldl9wcml2KSkKLQkJZGRjX3BpbiA9IGJ4dF9wb3J0
X3RvX2RkY19waW4oZGV2X3ByaXYsIHBvcnQpOwotCWVsc2UgaWYgKElTX0NIRVJSWVZJRVcoZGV2
X3ByaXYpKQotCQlkZGNfcGluID0gY2h2X3BvcnRfdG9fZGRjX3BpbihkZXZfcHJpdiwgcG9ydCk7
CisJaWYgKEhBU19QQ0hfSUNQKGk5MTUpKQorCQlkZGNfcGluID0gaWNsX3BvcnRfdG9fZGRjX3Bp
bihpOTE1LCBwb3J0KTsKKwllbHNlIGlmIChIQVNfUENIX0NOUChpOTE1KSkKKwkJZGRjX3BpbiA9
IGNucF9wb3J0X3RvX2RkY19waW4oaTkxNSwgcG9ydCk7CisJZWxzZSBpZiAoSVNfR0VOOV9MUChp
OTE1KSkKKwkJZGRjX3BpbiA9IGJ4dF9wb3J0X3RvX2RkY19waW4oaTkxNSwgcG9ydCk7CisJZWxz
ZSBpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkKKwkJZGRjX3BpbiA9IGNodl9wb3J0X3RvX2RkY19w
aW4oaTkxNSwgcG9ydCk7CiAJZWxzZQotCQlkZGNfcGluID0gZzR4X3BvcnRfdG9fZGRjX3Bpbihk
ZXZfcHJpdiwgcG9ydCk7CisJCWRkY19waW4gPSBnNHhfcG9ydF90b19kZGNfcGluKGk5MTUsIHBv
cnQpOwogCiAJRFJNX0RFQlVHX0tNUygiVXNpbmcgRERDIHBpbiAweCV4IGZvciBwb3J0ICVjIChw
bGF0Zm9ybSBkZWZhdWx0KVxuIiwKIAkJICAgICAgZGRjX3BpbiwgcG9ydF9uYW1lKHBvcnQpKTsK
QEAgLTMwMTQsMjAgKzMwMTQsMjAgQEAgc3RhdGljIHU4IGludGVsX2hkbWlfZGRjX3BpbihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIHZvaWQgaW50ZWxfaW5mb2ZyYW1lX2lu
aXQoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9CiAJCXRvX2k5MTUoaW50ZWxfZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwogCi0JaWYg
KElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJ
aWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkgewogCQlpbnRl
bF9kaWdfcG9ydC0+d3JpdGVfaW5mb2ZyYW1lID0gdmx2X3dyaXRlX2luZm9mcmFtZTsKIAkJaW50
ZWxfZGlnX3BvcnQtPnJlYWRfaW5mb2ZyYW1lID0gdmx2X3JlYWRfaW5mb2ZyYW1lOwogCQlpbnRl
bF9kaWdfcG9ydC0+c2V0X2luZm9mcmFtZXMgPSB2bHZfc2V0X2luZm9mcmFtZXM7CiAJCWludGVs
X2RpZ19wb3J0LT5pbmZvZnJhbWVzX2VuYWJsZWQgPSB2bHZfaW5mb2ZyYW1lc19lbmFibGVkOwot
CX0gZWxzZSBpZiAoSVNfRzRYKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNfRzRYKGk5MTUp
KSB7CiAJCWludGVsX2RpZ19wb3J0LT53cml0ZV9pbmZvZnJhbWUgPSBnNHhfd3JpdGVfaW5mb2Zy
YW1lOwogCQlpbnRlbF9kaWdfcG9ydC0+cmVhZF9pbmZvZnJhbWUgPSBnNHhfcmVhZF9pbmZvZnJh
bWU7CiAJCWludGVsX2RpZ19wb3J0LT5zZXRfaW5mb2ZyYW1lcyA9IGc0eF9zZXRfaW5mb2ZyYW1l
czsKIAkJaW50ZWxfZGlnX3BvcnQtPmluZm9mcmFtZXNfZW5hYmxlZCA9IGc0eF9pbmZvZnJhbWVz
X2VuYWJsZWQ7Ci0JfSBlbHNlIGlmIChIQVNfRERJKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAo
SEFTX0RESShpOTE1KSkgewogCQlpZiAoaW50ZWxfZGlnX3BvcnQtPmxzcGNvbi5hY3RpdmUpIHsK
IAkJCWludGVsX2RpZ19wb3J0LT53cml0ZV9pbmZvZnJhbWUgPSBsc3Bjb25fd3JpdGVfaW5mb2Zy
YW1lOwogCQkJaW50ZWxfZGlnX3BvcnQtPnJlYWRfaW5mb2ZyYW1lID0gbHNwY29uX3JlYWRfaW5m
b2ZyYW1lOwpAQCAtMzAzOSw3ICszMDM5LDcgQEAgdm9pZCBpbnRlbF9pbmZvZnJhbWVfaW5pdChz
dHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCkKIAkJCWludGVsX2RpZ19w
b3J0LT5zZXRfaW5mb2ZyYW1lcyA9IGhzd19zZXRfaW5mb2ZyYW1lczsKIAkJCWludGVsX2RpZ19w
b3J0LT5pbmZvZnJhbWVzX2VuYWJsZWQgPSBoc3dfaW5mb2ZyYW1lc19lbmFibGVkOwogCQl9Ci0J
fSBlbHNlIGlmIChIQVNfUENIX0lCWChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKEhBU19QQ0hf
SUJYKGk5MTUpKSB7CiAJCWludGVsX2RpZ19wb3J0LT53cml0ZV9pbmZvZnJhbWUgPSBpYnhfd3Jp
dGVfaW5mb2ZyYW1lOwogCQlpbnRlbF9kaWdfcG9ydC0+cmVhZF9pbmZvZnJhbWUgPSBpYnhfcmVh
ZF9pbmZvZnJhbWU7CiAJCWludGVsX2RpZ19wb3J0LT5zZXRfaW5mb2ZyYW1lcyA9IGlieF9zZXRf
aW5mb2ZyYW1lczsKQEAgLTMwNTksNyArMzA1OSw3IEBAIHZvaWQgaW50ZWxfaGRtaV9pbml0X2Nv
bm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKIAlzdHJ1
Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9ICZpbnRlbF9kaWdfcG9ydC0+aGRtaTsKIAlzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlciA9ICZpbnRlbF9kaWdfcG9ydC0+YmFzZTsK
IAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50ZWxfZW5jb2Rlci0+YmFzZS5kZXY7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCWVudW0gcG9ydCBwb3J0ID0g
aW50ZWxfZW5jb2Rlci0+cG9ydDsKIAogCURSTV9ERUJVR19LTVMoIkFkZGluZyBIRE1JIGNvbm5l
Y3RvciBvbiBwb3J0ICVjXG4iLApAQCAtMzA3OCwxNiArMzA3OCwxNiBAQCB2b2lkIGludGVsX2hk
bWlfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3Bv
cnQsCiAJY29ubmVjdG9yLT5kb3VibGVzY2FuX2FsbG93ZWQgPSAwOwogCWNvbm5lY3Rvci0+c3Rl
cmVvX2FsbG93ZWQgPSAxOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNf
R0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMCB8fCBJU19H
RU1JTklMQUtFKGk5MTUpKQogCQljb25uZWN0b3ItPnljYmNyXzQyMF9hbGxvd2VkID0gdHJ1ZTsK
IAotCWludGVsX2hkbWktPmRkY19idXMgPSBpbnRlbF9oZG1pX2RkY19waW4oZGV2X3ByaXYsIHBv
cnQpOworCWludGVsX2hkbWktPmRkY19idXMgPSBpbnRlbF9oZG1pX2RkY19waW4oaTkxNSwgcG9y
dCk7CiAKIAlpZiAoV0FSTl9PTihwb3J0ID09IFBPUlRfQSkpCiAJCXJldHVybjsKLQlpbnRlbF9l
bmNvZGVyLT5ocGRfcGluID0gaW50ZWxfaHBkX3Bpbl9kZWZhdWx0KGRldl9wcml2LCBwb3J0KTsK
KwlpbnRlbF9lbmNvZGVyLT5ocGRfcGluID0gaW50ZWxfaHBkX3Bpbl9kZWZhdWx0KGk5MTUsIHBv
cnQpOwogCi0JaWYgKEhBU19EREkoZGV2X3ByaXYpKQorCWlmIChIQVNfRERJKGk5MTUpKQogCQlp
bnRlbF9jb25uZWN0b3ItPmdldF9od19zdGF0ZSA9IGludGVsX2RkaV9jb25uZWN0b3JfZ2V0X2h3
X3N0YXRlOwogCWVsc2UKIAkJaW50ZWxfY29ubmVjdG9yLT5nZXRfaHdfc3RhdGUgPSBpbnRlbF9j
b25uZWN0b3JfZ2V0X2h3X3N0YXRlOwpAQCAtMzA5Nyw3ICszMDk3LDcgQEAgdm9pZCBpbnRlbF9o
ZG1pX2luaXRfY29ubmVjdG9yKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19w
b3J0LAogCWludGVsX2Nvbm5lY3Rvcl9hdHRhY2hfZW5jb2RlcihpbnRlbF9jb25uZWN0b3IsIGlu
dGVsX2VuY29kZXIpOwogCWludGVsX2hkbWktPmF0dGFjaGVkX2Nvbm5lY3RvciA9IGludGVsX2Nv
bm5lY3RvcjsKIAotCWlmIChpc19oZGNwX3N1cHBvcnRlZChkZXZfcHJpdiwgcG9ydCkpIHsKKwlp
ZiAoaXNfaGRjcF9zdXBwb3J0ZWQoaTkxNSwgcG9ydCkpIHsKIAkJaW50IHJldCA9IGludGVsX2hk
Y3BfaW5pdChpbnRlbF9jb25uZWN0b3IsCiAJCQkJCSAgJmludGVsX2hkbWlfaGRjcF9zaGltKTsK
IAkJaWYgKHJldCkKQEAgLTMxMDgsNyArMzEwOCw3IEBAIHZvaWQgaW50ZWxfaGRtaV9pbml0X2Nv
bm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCwKIAkgKiAw
eGQuICBGYWlsdXJlIHRvIGRvIHNvIHdpbGwgcmVzdWx0IGluIHNwdXJpb3VzIGludGVycnVwdHMg
YmVpbmcKIAkgKiBnZW5lcmF0ZWQgb24gdGhlIHBvcnQgd2hlbiBhIGNhYmxlIGlzIG5vdCBhdHRh
Y2hlZC4KIAkgKi8KLQlpZiAoSVNfRzQ1KGRldl9wcml2KSkgeworCWlmIChJU19HNDUoaTkxNSkp
IHsKIAkJdTMyIHRlbXAgPSBJOTE1X1JFQUQoUEVHX0JBTkRfR0FQX0RBVEEpOwogCQlJOTE1X1dS
SVRFKFBFR19CQU5EX0dBUF9EQVRBLCAodGVtcCAmIH4weGYpIHwgMHhkKTsKIAl9CkBAIC0zMTE5
LDcgKzMxMTksNyBAQCB2b2lkIGludGVsX2hkbWlfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiAJCURSTV9ERUJVR19LTVMoIkNFQyBub3Rp
ZmllciBnZXQgZmFpbGVkXG4iKTsKIH0KIAotdm9pZCBpbnRlbF9oZG1pX2luaXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9oZG1pX2luaXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAgaTkxNV9yZWdfdCBoZG1pX3JlZywgZW51bSBw
b3J0IHBvcnQpCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQ7
CkBAIC0zMTM4LDEzICszMTM4LDEzIEBAIHZvaWQgaW50ZWxfaGRtaV9pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCWludGVsX2VuY29kZXIgPSAmaW50ZWxfZGlnX3Bv
cnQtPmJhc2U7CiAKLQlkcm1fZW5jb2Rlcl9pbml0KCZkZXZfcHJpdi0+ZHJtLCAmaW50ZWxfZW5j
b2Rlci0+YmFzZSwKKwlkcm1fZW5jb2Rlcl9pbml0KCZpOTE1LT5kcm0sICZpbnRlbF9lbmNvZGVy
LT5iYXNlLAogCQkJICZpbnRlbF9oZG1pX2VuY19mdW5jcywgRFJNX01PREVfRU5DT0RFUl9UTURT
LAogCQkJICJIRE1JICVjIiwgcG9ydF9uYW1lKHBvcnQpKTsKIAogCWludGVsX2VuY29kZXItPmhv
dHBsdWcgPSBpbnRlbF9lbmNvZGVyX2hvdHBsdWc7CiAJaW50ZWxfZW5jb2Rlci0+Y29tcHV0ZV9j
b25maWcgPSBpbnRlbF9oZG1pX2NvbXB1dGVfY29uZmlnOwotCWlmIChIQVNfUENIX1NQTElUKGRl
dl9wcml2KSkgeworCWlmIChIQVNfUENIX1NQTElUKGk5MTUpKSB7CiAJCWludGVsX2VuY29kZXIt
PmRpc2FibGUgPSBwY2hfZGlzYWJsZV9oZG1pOwogCQlpbnRlbF9lbmNvZGVyLT5wb3N0X2Rpc2Fi
bGUgPSBwY2hfcG9zdF9kaXNhYmxlX2hkbWk7CiAJfSBlbHNlIHsKQEAgLTMxNTIsMjIgKzMxNTIs
MjIgQEAgdm9pZCBpbnRlbF9oZG1pX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCX0KIAlpbnRlbF9lbmNvZGVyLT5nZXRfaHdfc3RhdGUgPSBpbnRlbF9oZG1pX2dldF9o
d19zdGF0ZTsKIAlpbnRlbF9lbmNvZGVyLT5nZXRfY29uZmlnID0gaW50ZWxfaGRtaV9nZXRfY29u
ZmlnOwotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19DSEVSUllWSUVX
KGk5MTUpKSB7CiAJCWludGVsX2VuY29kZXItPnByZV9wbGxfZW5hYmxlID0gY2h2X2hkbWlfcHJl
X3BsbF9lbmFibGU7CiAJCWludGVsX2VuY29kZXItPnByZV9lbmFibGUgPSBjaHZfaGRtaV9wcmVf
ZW5hYmxlOwogCQlpbnRlbF9lbmNvZGVyLT5lbmFibGUgPSB2bHZfZW5hYmxlX2hkbWk7CiAJCWlu
dGVsX2VuY29kZXItPnBvc3RfZGlzYWJsZSA9IGNodl9oZG1pX3Bvc3RfZGlzYWJsZTsKIAkJaW50
ZWxfZW5jb2Rlci0+cG9zdF9wbGxfZGlzYWJsZSA9IGNodl9oZG1pX3Bvc3RfcGxsX2Rpc2FibGU7
Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkgeworCX0gZWxzZSBpZiAoSVNf
VkFMTEVZVklFVyhpOTE1KSkgewogCQlpbnRlbF9lbmNvZGVyLT5wcmVfcGxsX2VuYWJsZSA9IHZs
dl9oZG1pX3ByZV9wbGxfZW5hYmxlOwogCQlpbnRlbF9lbmNvZGVyLT5wcmVfZW5hYmxlID0gdmx2
X2hkbWlfcHJlX2VuYWJsZTsKIAkJaW50ZWxfZW5jb2Rlci0+ZW5hYmxlID0gdmx2X2VuYWJsZV9o
ZG1pOwogCQlpbnRlbF9lbmNvZGVyLT5wb3N0X2Rpc2FibGUgPSB2bHZfaGRtaV9wb3N0X2Rpc2Fi
bGU7CiAJfSBlbHNlIHsKIAkJaW50ZWxfZW5jb2Rlci0+cHJlX2VuYWJsZSA9IGludGVsX2hkbWlf
cHJlX2VuYWJsZTsKLQkJaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSkKKwkJaWYgKEhBU19QQ0hf
Q1BUKGk5MTUpKQogCQkJaW50ZWxfZW5jb2Rlci0+ZW5hYmxlID0gY3B0X2VuYWJsZV9oZG1pOwot
CQllbHNlIGlmIChIQVNfUENIX0lCWChkZXZfcHJpdikpCisJCWVsc2UgaWYgKEhBU19QQ0hfSUJY
KGk5MTUpKQogCQkJaW50ZWxfZW5jb2Rlci0+ZW5hYmxlID0gaWJ4X2VuYWJsZV9oZG1pOwogCQll
bHNlCiAJCQlpbnRlbF9lbmNvZGVyLT5lbmFibGUgPSBnNHhfZW5hYmxlX2hkbWk7CkBAIC0zMTc2
LDcgKzMxNzYsNyBAQCB2b2lkIGludGVsX2hkbWlfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJaW50ZWxfZW5jb2Rlci0+dHlwZSA9IElOVEVMX09VVFBVVF9IRE1JOwog
CWludGVsX2VuY29kZXItPnBvd2VyX2RvbWFpbiA9IGludGVsX3BvcnRfdG9fcG93ZXJfZG9tYWlu
KHBvcnQpOwogCWludGVsX2VuY29kZXItPnBvcnQgPSBwb3J0OwotCWlmIChJU19DSEVSUllWSUVX
KGRldl9wcml2KSkgeworCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKSB7CiAJCWlmIChwb3J0ID09
IFBPUlRfRCkKIAkJCWludGVsX2VuY29kZXItPmNydGNfbWFzayA9IDEgPDwgMjsKIAkJZWxzZQpA
QCAtMzE5MCw3ICszMTkwLDcgQEAgdm9pZCBpbnRlbF9oZG1pX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIHRvIHdvcmsgb24gcmVhbCBoYXJkd2FyZS4gQW5kIHNp
bmNlIGc0eCBjYW4gc2VuZCBpbmZvZnJhbWVzIHRvCiAJICogb25seSBvbmUgcG9ydCBhbnl3YXks
IG5vdGhpbmcgaXMgbG9zdCBieSBhbGxvd2luZyBpdC4KIAkgKi8KLQlpZiAoSVNfRzRYKGRldl9w
cml2KSkKKwlpZiAoSVNfRzRYKGk5MTUpKQogCQlpbnRlbF9lbmNvZGVyLT5jbG9uZWFibGUgfD0g
MSA8PCBJTlRFTF9PVVRQVVRfSERNSTsKIAogCWludGVsX2RpZ19wb3J0LT5oZG1pLmhkbWlfcmVn
ID0gaGRtaV9yZWc7CkBAIC0zMTk5LDYgKzMxOTksNiBAQCB2b2lkIGludGVsX2hkbWlfaW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAlpbnRlbF9pbmZvZnJhbWVfaW5p
dChpbnRlbF9kaWdfcG9ydCk7CiAKLQlpbnRlbF9kaWdfcG9ydC0+YXV4X2NoID0gaW50ZWxfYmlv
c19wb3J0X2F1eF9jaChkZXZfcHJpdiwgcG9ydCk7CisJaW50ZWxfZGlnX3BvcnQtPmF1eF9jaCA9
IGludGVsX2Jpb3NfcG9ydF9hdXhfY2goaTkxNSwgcG9ydCk7CiAJaW50ZWxfaGRtaV9pbml0X2Nv
bm5lY3RvcihpbnRlbF9kaWdfcG9ydCwgaW50ZWxfY29ubmVjdG9yKTsKIH0KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2hkbWkuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2hkbWkuaAppbmRleCAxMDZjMmUwYmMzYzkuLjQ2ZjAzMzU2YjU0YiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaGRtaS5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2hkbWkuaApAQCAtMjQsNyArMjQsNyBAQCBzdHJ1Y3QgaW50ZWxfaGRtaTsK
IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlOwogdW5pb24gaGRtaV9pbmZvZnJhbWU7CiAKLXZv
aWQgaW50ZWxfaGRtaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaTkx
NV9yZWdfdCBoZG1pX3JlZywKK3ZvaWQgaW50ZWxfaGRtaV9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LCBpOTE1X3JlZ190IGhkbWlfcmVnLAogCQkgICAgIGVudW0gcG9ydCBwb3J0
KTsKIHZvaWQgaW50ZWxfaGRtaV9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9w
b3J0ICppbnRlbF9kaWdfcG9ydCwKIAkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpp
bnRlbF9jb25uZWN0b3IpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
aG90cGx1Zy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaG90cGx1Zy5jCmluZGV4IGZm
OWViM2M4NTVkMy4uYTU1MWI5YWIyZTE3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9ob3RwbHVnLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfaG90cGx1
Zy5jCkBAIC03OCw3ICs3OCw3IEBACiAKIC8qKgogICogaW50ZWxfaHBkX3Bpbl9kZWZhdWx0IC0g
cmV0dXJuIGRlZmF1bHQgcGluIGFzc29jaWF0ZWQgd2l0aCBjZXJ0YWluIHBvcnQuCi0gKiBAZGV2
X3ByaXY6IHByaXZhdGUgZHJpdmVyIGRhdGEgcG9pbnRlcgorICogQGk5MTU6IHByaXZhdGUgZHJp
dmVyIGRhdGEgcG9pbnRlcgogICogQHBvcnQ6IHRoZSBocGQgcG9ydCB0byBnZXQgYXNzb2NpYXRl
ZCBwaW4KICAqCiAgKiBJdCBpcyBvbmx5IHZhbGlkIGFuZCB1c2VkIGJ5IGRpZ2l0YWwgcG9ydCBl
bmNvZGVyLgpAQCAtODYsNyArODYsNyBAQAogICogUmV0dXJuIHBpbiB0aGF0IGlzIGFzc29jaWF0
YWRlIHdpdGggQHBvcnQgYW5kIEhEUF9OT05FIGlmIG5vIHBpbiBpcwogICogaGFyZCBhc3NvY2lh
dGVkIHdpdGggdGhhdCBAcG9ydC4KICAqLwotZW51bSBocGRfcGluIGludGVsX2hwZF9waW5fZGVm
YXVsdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitlbnVtIGhwZF9waW4gaW50
ZWxfaHBkX3Bpbl9kZWZhdWx0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAg
IGVudW0gcG9ydCBwb3J0KQogewogCXN3aXRjaCAocG9ydCkgewpAQCAtMTAxLDcgKzEwMSw3IEBA
IGVudW0gaHBkX3BpbiBpbnRlbF9ocGRfcGluX2RlZmF1bHQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCWNhc2UgUE9SVF9FOgogCQlyZXR1cm4gSFBEX1BPUlRfRTsKIAljYXNl
IFBPUlRfRjoKLQkJaWYgKElTX0NOTF9XSVRIX1BPUlRfRihkZXZfcHJpdikpCisJCWlmIChJU19D
TkxfV0lUSF9QT1JUX0YoaTkxNSkpCiAJCQlyZXR1cm4gSFBEX1BPUlRfRTsKIAkJcmV0dXJuIEhQ
RF9QT1JUX0Y7CiAJZGVmYXVsdDoKQEAgLTExNSw3ICsxMTUsNyBAQCBlbnVtIGhwZF9waW4gaW50
ZWxfaHBkX3Bpbl9kZWZhdWx0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAog
LyoqCiAgKiBpbnRlbF9ocGRfaXJxX3N0b3JtX2RldGVjdCAtIGdhdGhlciBzdGF0cyBhbmQgZGV0
ZWN0IEhQRCBJUlEgc3Rvcm0gb24gYSBwaW4KLSAqIEBkZXZfcHJpdjogcHJpdmF0ZSBkcml2ZXIg
ZGF0YSBwb2ludGVyCisgKiBAaTkxNTogcHJpdmF0ZSBkcml2ZXIgZGF0YSBwb2ludGVyCiAgKiBA
cGluOiB0aGUgcGluIHRvIGdhdGhlciBzdGF0cyBvbgogICogQGxvbmdfaHBkOiB3aGV0aGVyIHRo
ZSBIUEQgSVJRIHdhcyBsb25nIG9yIHNob3J0CiAgKgpAQCAtMTI0LDEzICsxMjQsMTMgQEAgZW51
bSBocGRfcGluIGludGVsX2hwZF9waW5fZGVmYXVsdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAgKiByZXNwb25zaWJsZSBmb3IgZnVydGhlciBhY3Rpb24uCiAgKgogICogVGhl
IG51bWJlciBvZiBJUlFzIHRoYXQgYXJlIGFsbG93ZWQgd2l0aGluIEBIUERfU1RPUk1fREVURUNU
X1BFUklPRCBpcwotICogc3RvcmVkIGluIEBkZXZfcHJpdi0+aG90cGx1Zy5ocGRfc3Rvcm1fdGhy
ZXNob2xkIHdoaWNoIGRlZmF1bHRzIHRvCisgKiBzdG9yZWQgaW4gQGk5MTUtPmhvdHBsdWcuaHBk
X3N0b3JtX3RocmVzaG9sZCB3aGljaCBkZWZhdWx0cyB0bwogICogQEhQRF9TVE9STV9ERUZBVUxU
X1RIUkVTSE9MRC4gTG9uZyBJUlFzIGNvdW50IGFzICsxMCB0byB0aGlzIHRocmVzaG9sZCwgYW5k
CiAgKiBzaG9ydCBJUlFzIGNvdW50IGFzICsxLiBJZiB0aGlzIHRocmVzaG9sZCBpcyBleGNlZWRl
ZCwgaXQncyBjb25zaWRlcmVkIGFuCiAgKiBJUlEgc3Rvcm0gYW5kIHRoZSBJUlEgc3RhdGUgaXMg
c2V0IHRvIEBIUERfTUFSS19ESVNBQkxFRC4KICAqCiAgKiBCeSBkZWZhdWx0LCBtb3N0IHN5c3Rl
bXMgd2lsbCBvbmx5IGNvdW50IGxvbmcgSVJRcyB0b3dhcmRzCi0gKiAmZGV2X3ByaXYtPmhvdHBs
dWcuaHBkX3N0b3JtX3RocmVzaG9sZC4gSG93ZXZlciwgc29tZSBvbGRlciBzeXN0ZW1zIGFsc28K
KyAqICZpOTE1LT5ob3RwbHVnLmhwZF9zdG9ybV90aHJlc2hvbGQuIEhvd2V2ZXIsIHNvbWUgb2xk
ZXIgc3lzdGVtcyBhbHNvCiAgKiBzdWZmZXIgZnJvbSBzaG9ydCBJUlEgc3Rvcm1zIGFuZCBtdXN0
IGFsc28gdHJhY2sgdGhlc2UuIEJlY2F1c2Ugc2hvcnQgSVJRCiAgKiBzdG9ybXMgYXJlIG5hdHVy
YWxseSBjYXVzZWQgYnkgc2lkZWJhbmQgaW50ZXJhY3Rpb25zIHdpdGggRFAgTVNUIGRldmljZXMs
CiAgKiBzaG9ydCBJUlEgZGV0ZWN0aW9uIGlzIG9ubHkgZW5hYmxlZCBmb3Igc3lzdGVtcyB3aXRo
b3V0IERQIE1TVCBzdXBwb3J0LgpAQCAtMTQyLDEwICsxNDIsMTAgQEAgZW51bSBocGRfcGluIGlu
dGVsX2hwZF9waW5fZGVmYXVsdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAg
KgogICogUmV0dXJuIHRydWUgaWYgYW4gSVJRIHN0b3JtIHdhcyBkZXRlY3RlZCBvbiBAcGluLgog
ICovCi1zdGF0aWMgYm9vbCBpbnRlbF9ocGRfaXJxX3N0b3JtX2RldGVjdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBpbnRlbF9ocGRfaXJxX3N0b3JtX2Rl
dGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICAgZW51bSBocGRf
cGluIHBpbiwgYm9vbCBsb25nX2hwZCkKIHsKLQlzdHJ1Y3QgaTkxNV9ob3RwbHVnICpocGQgPSAm
ZGV2X3ByaXYtPmhvdHBsdWc7CisJc3RydWN0IGk5MTVfaG90cGx1ZyAqaHBkID0gJmk5MTUtPmhv
dHBsdWc7CiAJdW5zaWduZWQgbG9uZyBzdGFydCA9IGhwZC0+c3RhdHNbcGluXS5sYXN0X2ppZmZp
ZXM7CiAJdW5zaWduZWQgbG9uZyBlbmQgPSBzdGFydCArIG1zZWNzX3RvX2ppZmZpZXMoSFBEX1NU
T1JNX0RFVEVDVF9QRVJJT0QpOwogCWNvbnN0IGludCBpbmNyZW1lbnQgPSBsb25nX2hwZCA/IDEw
IDogMTsKQEAgLTE1Myw3ICsxNTMsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9ocGRfaXJxX3N0b3Jt
X2RldGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJYm9vbCBzdG9ybSA9
IGZhbHNlOwogCiAJaWYgKCF0aHJlc2hvbGQgfHwKLQkgICAgKCFsb25nX2hwZCAmJiAhZGV2X3By
aXYtPmhvdHBsdWcuaHBkX3Nob3J0X3N0b3JtX2VuYWJsZWQpKQorCSAgICAoIWxvbmdfaHBkICYm
ICFpOTE1LT5ob3RwbHVnLmhwZF9zaG9ydF9zdG9ybV9lbmFibGVkKSkKIAkJcmV0dXJuIGZhbHNl
OwogCiAJaWYgKCF0aW1lX2luX3JhbmdlKGppZmZpZXMsIHN0YXJ0LCBlbmQpKSB7CkBAIC0xNzUs
OSArMTc1LDkgQEAgc3RhdGljIGJvb2wgaW50ZWxfaHBkX2lycV9zdG9ybV9kZXRlY3Qoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdGF0aWMgdm9pZAotaW50ZWxfaHBk
X2lycV9zdG9ybV9zd2l0Y2hfdG9fcG9sbGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitpbnRlbF9ocGRfaXJxX3N0b3JtX3N3aXRjaF90b19wb2xsaW5nKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3By
aXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3Qg
aW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3I7CiAJc3RydWN0IGludGVsX2VuY29kZXIg
KmludGVsX2VuY29kZXI7CiAJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKQEAgLTE4
NSw3ICsxODUsNyBAQCBpbnRlbF9ocGRfaXJxX3N0b3JtX3N3aXRjaF90b19wb2xsaW5nKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAllbnVtIGhwZF9waW4gcGluOwogCWJvb2wg
aHBkX2Rpc2FibGVkID0gZmFsc2U7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+
aXJxX2xvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsKIAogCWRy
bV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRlcik7CiAJZHJtX2Zvcl9l
YWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5faXRlcikgewpAQCAtMTk5LDE0ICsx
OTksMTQgQEAgaW50ZWxfaHBkX2lycV9zdG9ybV9zd2l0Y2hfdG9fcG9sbGluZyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAkJcGluID0gaW50ZWxfZW5jb2Rlci0+aHBkX3Bp
bjsKIAkJaWYgKHBpbiA9PSBIUERfTk9ORSB8fAotCQkgICAgZGV2X3ByaXYtPmhvdHBsdWcuc3Rh
dHNbcGluXS5zdGF0ZSAhPSBIUERfTUFSS19ESVNBQkxFRCkKKwkJICAgIGk5MTUtPmhvdHBsdWcu
c3RhdHNbcGluXS5zdGF0ZSAhPSBIUERfTUFSS19ESVNBQkxFRCkKIAkJCWNvbnRpbnVlOwogCiAJ
CURSTV9JTkZPKCJIUEQgaW50ZXJydXB0IHN0b3JtIGRldGVjdGVkIG9uIGNvbm5lY3RvciAlczog
IgogCQkJICJzd2l0Y2hpbmcgZnJvbSBob3RwbHVnIGRldGVjdGlvbiB0byBwb2xsaW5nXG4iLAog
CQkJIGNvbm5lY3Rvci0+bmFtZSk7CiAKLQkJZGV2X3ByaXYtPmhvdHBsdWcuc3RhdHNbcGluXS5z
dGF0ZSA9IEhQRF9ESVNBQkxFRDsKKwkJaTkxNS0+aG90cGx1Zy5zdGF0c1twaW5dLnN0YXRlID0g
SFBEX0RJU0FCTEVEOwogCQljb25uZWN0b3ItPnBvbGxlZCA9IERSTV9DT05ORUNUT1JfUE9MTF9D
T05ORUNUCiAJCQl8IERSTV9DT05ORUNUT1JfUE9MTF9ESVNDT05ORUNUOwogCQlocGRfZGlzYWJs
ZWQgPSB0cnVlOwpAQCAtMjE2LDMxICsyMTYsMzEgQEAgaW50ZWxfaHBkX2lycV9zdG9ybV9zd2l0
Y2hfdG9fcG9sbGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJLyogRW5h
YmxlIHBvbGxpbmcgYW5kIHF1ZXVlIGhvdHBsdWcgcmUtZW5hYmxpbmcuICovCiAJaWYgKGhwZF9k
aXNhYmxlZCkgewogCQlkcm1fa21zX2hlbHBlcl9wb2xsX2VuYWJsZShkZXYpOwotCQltb2RfZGVs
YXllZF93b3JrKHN5c3RlbV93cSwgJmRldl9wcml2LT5ob3RwbHVnLnJlZW5hYmxlX3dvcmssCisJ
CW1vZF9kZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmaTkxNS0+aG90cGx1Zy5yZWVuYWJsZV93b3Jr
LAogCQkJCSBtc2Vjc190b19qaWZmaWVzKEhQRF9TVE9STV9SRUVOQUJMRV9ERUxBWSkpOwogCX0K
IH0KIAogc3RhdGljIHZvaWQgaW50ZWxfaHBkX2lycV9zdG9ybV9yZWVuYWJsZV93b3JrKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPQotCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpkZXZfcHJpdiksCisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPQorCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1
KSwKIAkJCSAgICAgaG90cGx1Zy5yZWVuYWJsZV93b3JrLndvcmspOwotCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmk5
MTUtPmRybTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAllbnVtIGhwZF9waW4gcGluOwog
Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsKKwl3YWtlcmVmID0g
aW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CiAKLQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+
aXJxX2xvY2spOworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAlmb3JfZWFjaF9o
cGRfcGluKHBpbikgewogCQlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwogCQlzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOwogCi0JCWlmIChkZXZfcHJpdi0+
aG90cGx1Zy5zdGF0c1twaW5dLnN0YXRlICE9IEhQRF9ESVNBQkxFRCkKKwkJaWYgKGk5MTUtPmhv
dHBsdWcuc3RhdHNbcGluXS5zdGF0ZSAhPSBIUERfRElTQUJMRUQpCiAJCQljb250aW51ZTsKIAot
CQlkZXZfcHJpdi0+aG90cGx1Zy5zdGF0c1twaW5dLnN0YXRlID0gSFBEX0VOQUJMRUQ7CisJCWk5
MTUtPmhvdHBsdWcuc3RhdHNbcGluXS5zdGF0ZSA9IEhQRF9FTkFCTEVEOwogCiAJCWRybV9jb25u
ZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRlcik7CiAJCWRybV9mb3JfZWFjaF9j
b25uZWN0b3JfaXRlcihjb25uZWN0b3IsICZjb25uX2l0ZXIpIHsKQEAgLTI1OSwxMSArMjU5LDEx
IEBAIHN0YXRpYyB2b2lkIGludGVsX2hwZF9pcnFfc3Rvcm1fcmVlbmFibGVfd29yayhzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspCiAJCX0KIAkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZj
b25uX2l0ZXIpOwogCX0KLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXlfaXJxc19lbmFibGVkICYmIGRl
dl9wcml2LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXApCi0JCWRldl9wcml2LT5kaXNwbGF5LmhwZF9p
cnFfc2V0dXAoZGV2X3ByaXYpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2Nr
KTsKKwlpZiAoaTkxNS0+ZGlzcGxheV9pcnFzX2VuYWJsZWQgJiYgaTkxNS0+ZGlzcGxheS5ocGRf
aXJxX3NldHVwKQorCQlpOTE1LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXAoaTkxNSk7CisJc3Bpbl91
bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZf
cHJpdiwgd2FrZXJlZik7CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CiB9
CiAKIGJvb2wgaW50ZWxfZW5jb2Rlcl9ob3RwbHVnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLApAQCAtMjk4LDIwICsyOTgsMjAgQEAgc3RhdGljIGJvb2wgaW50ZWxfZW5jb2Rlcl9oYXNf
aHBkX3B1bHNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiBzdGF0aWMgdm9pZCBp
OTE1X2RpZ3BvcnRfd29ya19mdW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0KIAkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBo
b3RwbHVnLmRpZ19wb3J0X3dvcmspOwogCXUzMiBsb25nX3BvcnRfbWFzaywgc2hvcnRfcG9ydF9t
YXNrOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCXUzMiBvbGRfYml0cyA9IDA7
CiAKLQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOwotCWxvbmdfcG9ydF9tYXNr
ID0gZGV2X3ByaXYtPmhvdHBsdWcubG9uZ19wb3J0X21hc2s7Ci0JZGV2X3ByaXYtPmhvdHBsdWcu
bG9uZ19wb3J0X21hc2sgPSAwOwotCXNob3J0X3BvcnRfbWFzayA9IGRldl9wcml2LT5ob3RwbHVn
LnNob3J0X3BvcnRfbWFzazsKLQlkZXZfcHJpdi0+aG90cGx1Zy5zaG9ydF9wb3J0X21hc2sgPSAw
OwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJx
KCZpOTE1LT5pcnFfbG9jayk7CisJbG9uZ19wb3J0X21hc2sgPSBpOTE1LT5ob3RwbHVnLmxvbmdf
cG9ydF9tYXNrOworCWk5MTUtPmhvdHBsdWcubG9uZ19wb3J0X21hc2sgPSAwOworCXNob3J0X3Bv
cnRfbWFzayA9IGk5MTUtPmhvdHBsdWcuc2hvcnRfcG9ydF9tYXNrOworCWk5MTUtPmhvdHBsdWcu
c2hvcnRfcG9ydF9tYXNrID0gMDsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsK
IAotCWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwlm
b3JfZWFjaF9pbnRlbF9lbmNvZGVyKCZpOTE1LT5kcm0sIGVuY29kZXIpIHsKIAkJc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQ7CiAJCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+
cG9ydDsKIAkJYm9vbCBsb25nX2hwZCwgc2hvcnRfaHBkOwpAQCAtMzM2LDEwICszMzYsMTAgQEAg
c3RhdGljIHZvaWQgaTkxNV9kaWdwb3J0X3dvcmtfZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndv
cmspCiAJfQogCiAJaWYgKG9sZF9iaXRzKSB7Ci0JCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5p
cnFfbG9jayk7Ci0JCWRldl9wcml2LT5ob3RwbHVnLmV2ZW50X2JpdHMgfD0gb2xkX2JpdHM7Ci0J
CXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQkJc2NoZWR1bGVfd29yaygm
ZGV2X3ByaXYtPmhvdHBsdWcuaG90cGx1Z193b3JrKTsKKwkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+
aXJxX2xvY2spOworCQlpOTE1LT5ob3RwbHVnLmV2ZW50X2JpdHMgfD0gb2xkX2JpdHM7CisJCXNw
aW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCQlzY2hlZHVsZV93b3JrKCZpOTE1LT5o
b3RwbHVnLmhvdHBsdWdfd29yayk7CiAJfQogfQogCkBAIC0zNDgsOSArMzQ4LDkgQEAgc3RhdGlj
IHZvaWQgaTkxNV9kaWdwb3J0X3dvcmtfZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAg
Ki8KIHN0YXRpYyB2b2lkIGk5MTVfaG90cGx1Z193b3JrX2Z1bmMoc3RydWN0IHdvcmtfc3RydWN0
ICp3b3JrKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUsIGhvdHBsdWcuaG90cGx1Z193b3JrKTsKLQlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZpOTE1
LT5kcm07CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yOwogCXN0cnVj
dCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3I7CkBAIC0zNjEsMTUgKzM2MSwxNSBAQCBzdGF0aWMgdm9pZCBpOTE1X2hvdHBsdWdf
d29ya19mdW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAltdXRleF9sb2NrKCZkZXYtPm1v
ZGVfY29uZmlnLm11dGV4KTsKIAlEUk1fREVCVUdfS01TKCJydW5uaW5nIGVuY29kZXIgaG90cGx1
ZyBmdW5jdGlvbnNcbiIpOwogCi0Jc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsK
KwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CiAKLQlocGRfZXZlbnRfYml0cyA9IGRl
dl9wcml2LT5ob3RwbHVnLmV2ZW50X2JpdHM7Ci0JZGV2X3ByaXYtPmhvdHBsdWcuZXZlbnRfYml0
cyA9IDA7CisJaHBkX2V2ZW50X2JpdHMgPSBpOTE1LT5ob3RwbHVnLmV2ZW50X2JpdHM7CisJaTkx
NS0+aG90cGx1Zy5ldmVudF9iaXRzID0gMDsKIAogCS8qIEVuYWJsZSBwb2xsaW5nIGZvciBjb25u
ZWN0b3JzIHdoaWNoIGhhZCBIUEQgSVJRIHN0b3JtcyAqLwotCWludGVsX2hwZF9pcnFfc3Rvcm1f
c3dpdGNoX3RvX3BvbGxpbmcoZGV2X3ByaXYpOworCWludGVsX2hwZF9pcnFfc3Rvcm1fc3dpdGNo
X3RvX3BvbGxpbmcoaTkxNSk7CiAKLQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9j
ayk7CisJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CiAKIAlkcm1fY29ubmVjdG9y
X2xpc3RfaXRlcl9iZWdpbihkZXYsICZjb25uX2l0ZXIpOwogCWRybV9mb3JfZWFjaF9jb25uZWN0
b3JfaXRlcihjb25uZWN0b3IsICZjb25uX2l0ZXIpIHsKQEAgLTM5NSw3ICszOTUsNyBAQCBzdGF0
aWMgdm9pZCBpOTE1X2hvdHBsdWdfd29ya19mdW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykK
IAogLyoqCiAgKiBpbnRlbF9ocGRfaXJxX2hhbmRsZXIgLSBtYWluIGhvdHBsdWcgaXJxIGhhbmRs
ZXIKLSAqIEBkZXZfcHJpdjogZHJtX2k5MTVfcHJpdmF0ZQorICogQGk5MTU6IGRybV9pOTE1X3By
aXZhdGUKICAqIEBwaW5fbWFzazogYSBtYXNrIG9mIGhwZCBwaW5zIHRoYXQgaGF2ZSB0cmlnZ2Vy
ZWQgdGhlIGlycQogICogQGxvbmdfbWFzazogYSBtYXNrIG9mIGhwZCBwaW5zIHRoYXQgbWF5IGJl
IGxvbmcgaHBkIHB1bHNlcwogICoKQEAgLTQwOSw3ICs0MDksNyBAQCBzdGF0aWMgdm9pZCBpOTE1
X2hvdHBsdWdfd29ya19mdW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKICAqIEhlcmUsIHdl
IGRvIGhvdHBsdWcgaXJxIHN0b3JtIGRldGVjdGlvbiBhbmQgbWl0aWdhdGlvbiwgYW5kIHBhc3Mg
ZnVydGhlcgogICogcHJvY2Vzc2luZyB0byBhcHByb3ByaWF0ZSBib3R0b20gaGFsdmVzLgogICov
Ci12b2lkIGludGVsX2hwZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCit2b2lkIGludGVsX2hwZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCSAgIHUzMiBwaW5fbWFzaywgdTMyIGxvbmdfbWFzaykKIHsKIAlzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKQEAgLTQyMiw3ICs0MjIsNyBAQCB2b2lkIGludGVsX2hw
ZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKCFw
aW5fbWFzaykKIAkJcmV0dXJuOwogCi0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+aXJxX2xvY2spOwor
CXNwaW5fbG9jaygmaTkxNS0+aXJxX2xvY2spOwogCiAJLyoKIAkgKiBEZXRlcm1pbmUgd2hldGhl
ciAtPmhwZF9wdWxzZSgpIGV4aXN0cyBmb3IgZWFjaCBwaW4sIGFuZApAQCAtNDMwLDcgKzQzMCw3
IEBAIHZvaWQgaW50ZWxfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkgKiBhcyBlYWNoIHBpbiBtYXkgaGF2ZSB1cCB0byB0d28gZW5jb2RlcnMgKEhE
TUkgYW5kIERQKSBhbmQKIAkgKiBvbmx5IHRoZSBvbmUgb2YgdGhlbSAoRFApIHdpbGwgaGF2ZSAt
PmhwZF9wdWxzZSgpLgogCSAqLwotCWZvcl9lYWNoX2ludGVsX2VuY29kZXIoJmRldl9wcml2LT5k
cm0sIGVuY29kZXIpIHsKKwlmb3JfZWFjaF9pbnRlbF9lbmNvZGVyKCZpOTE1LT5kcm0sIGVuY29k
ZXIpIHsKIAkJYm9vbCBoYXNfaHBkX3B1bHNlID0gaW50ZWxfZW5jb2Rlcl9oYXNfaHBkX3B1bHNl
KGVuY29kZXIpOwogCQllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJCWJvb2wgbG9u
Z19ocGQ7CkBAIC00NTAsMTAgKzQ1MCwxMCBAQCB2b2lkIGludGVsX2hwZF9pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAkJaWYgKGxvbmdfaHBkKSB7CiAJ
CQlsb25nX2hwZF9wdWxzZV9tYXNrIHw9IEJJVChwaW4pOwotCQkJZGV2X3ByaXYtPmhvdHBsdWcu
bG9uZ19wb3J0X21hc2sgfD0gQklUKHBvcnQpOworCQkJaTkxNS0+aG90cGx1Zy5sb25nX3BvcnRf
bWFzayB8PSBCSVQocG9ydCk7CiAJCX0gZWxzZSB7CiAJCQlzaG9ydF9ocGRfcHVsc2VfbWFzayB8
PSBCSVQocGluKTsKLQkJCWRldl9wcml2LT5ob3RwbHVnLnNob3J0X3BvcnRfbWFzayB8PSBCSVQo
cG9ydCk7CisJCQlpOTE1LT5ob3RwbHVnLnNob3J0X3BvcnRfbWFzayB8PSBCSVQocG9ydCk7CiAJ
CX0KIAl9CiAKQEAgLTQ2NCwxOSArNDY0LDE5IEBAIHZvaWQgaW50ZWxfaHBkX2lycV9oYW5kbGVy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaWYgKCEoQklUKHBpbikgJiBw
aW5fbWFzaykpCiAJCQljb250aW51ZTsKIAotCQlpZiAoZGV2X3ByaXYtPmhvdHBsdWcuc3RhdHNb
cGluXS5zdGF0ZSA9PSBIUERfRElTQUJMRUQpIHsKKwkJaWYgKGk5MTUtPmhvdHBsdWcuc3RhdHNb
cGluXS5zdGF0ZSA9PSBIUERfRElTQUJMRUQpIHsKIAkJCS8qCiAJCQkgKiBPbiBHTUNIIHBsYXRm
b3JtcyB0aGUgaW50ZXJydXB0IG1hc2sgYml0cyBvbmx5CiAJCQkgKiBwcmV2ZW50IGlycSBnZW5l
cmF0aW9uLCBub3QgdGhlIHNldHRpbmcgb2YgdGhlCiAJCQkgKiBob3RwbHVnIGJpdHMgaXRzZWxm
LiBTbyBvbmx5IFdBUk4gYWJvdXQgdW5leHBlY3RlZAogCQkJICogaW50ZXJydXB0cyBvbiBzYW5l
ciBwbGF0Zm9ybXMuCiAJCQkgKi8KLQkJCVdBUk5fT05DRSghSEFTX0dNQ0goZGV2X3ByaXYpLAor
CQkJV0FSTl9PTkNFKCFIQVNfR01DSChpOTE1KSwKIAkJCQkgICJSZWNlaXZlZCBIUEQgaW50ZXJy
dXB0IG9uIHBpbiAlZCBhbHRob3VnaCBkaXNhYmxlZFxuIiwgcGluKTsKIAkJCWNvbnRpbnVlOwog
CQl9CiAKLQkJaWYgKGRldl9wcml2LT5ob3RwbHVnLnN0YXRzW3Bpbl0uc3RhdGUgIT0gSFBEX0VO
QUJMRUQpCisJCWlmIChpOTE1LT5ob3RwbHVnLnN0YXRzW3Bpbl0uc3RhdGUgIT0gSFBEX0VOQUJM
RUQpCiAJCQljb250aW51ZTsKIAogCQkvKgpAQCAtNDg3LDEzICs0ODcsMTMgQEAgdm9pZCBpbnRl
bF9ocGRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlp
ZiAoKChzaG9ydF9ocGRfcHVsc2VfbWFzayB8IGxvbmdfaHBkX3B1bHNlX21hc2spICYgQklUKHBp
bikpKSB7CiAJCQlsb25nX2hwZCA9IGxvbmdfaHBkX3B1bHNlX21hc2sgJiBCSVQocGluKTsKIAkJ
fSBlbHNlIHsKLQkJCWRldl9wcml2LT5ob3RwbHVnLmV2ZW50X2JpdHMgfD0gQklUKHBpbik7CisJ
CQlpOTE1LT5ob3RwbHVnLmV2ZW50X2JpdHMgfD0gQklUKHBpbik7CiAJCQlsb25nX2hwZCA9IHRy
dWU7CiAJCQlxdWV1ZV9ocCA9IHRydWU7CiAJCX0KIAotCQlpZiAoaW50ZWxfaHBkX2lycV9zdG9y
bV9kZXRlY3QoZGV2X3ByaXYsIHBpbiwgbG9uZ19ocGQpKSB7Ci0JCQlkZXZfcHJpdi0+aG90cGx1
Zy5ldmVudF9iaXRzICY9IH5CSVQocGluKTsKKwkJaWYgKGludGVsX2hwZF9pcnFfc3Rvcm1fZGV0
ZWN0KGk5MTUsIHBpbiwgbG9uZ19ocGQpKSB7CisJCQlpOTE1LT5ob3RwbHVnLmV2ZW50X2JpdHMg
Jj0gfkJJVChwaW4pOwogCQkJc3Rvcm1fZGV0ZWN0ZWQgPSB0cnVlOwogCQkJcXVldWVfaHAgPSB0
cnVlOwogCQl9CkBAIC01MDMsOSArNTAzLDkgQEAgdm9pZCBpbnRlbF9ocGRfaXJxX2hhbmRsZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIERpc2FibGUgYW55IElSUXMg
dGhhdCBzdG9ybXMgd2VyZSBkZXRlY3RlZCBvbi4gUG9sbGluZyBlbmFibGVtZW50CiAJICogaGFw
cGVucyBsYXRlciBpbiBvdXIgaG90cGx1ZyB3b3JrLgogCSAqLwotCWlmIChzdG9ybV9kZXRlY3Rl
ZCAmJiBkZXZfcHJpdi0+ZGlzcGxheV9pcnFzX2VuYWJsZWQpCi0JCWRldl9wcml2LT5kaXNwbGF5
LmhwZF9pcnFfc2V0dXAoZGV2X3ByaXYpOwotCXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+aXJxX2xv
Y2spOworCWlmIChzdG9ybV9kZXRlY3RlZCAmJiBpOTE1LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkK
KwkJaTkxNS0+ZGlzcGxheS5ocGRfaXJxX3NldHVwKGk5MTUpOworCXNwaW5fdW5sb2NrKCZpOTE1
LT5pcnFfbG9jayk7CiAKIAkvKgogCSAqIE91ciBob3RwbHVnIGhhbmRsZXIgY2FuIGdyYWIgbW9k
ZXNldCBsb2NrcyAoYnkgY2FsbGluZyBkb3duIGludG8gdGhlCkBAIC01MTQsMTQgKzUxNCwxNCBA
QCB2b2lkIGludGVsX2hwZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJICogZGVhZGxvY2suCiAJICovCiAJaWYgKHF1ZXVlX2RpZykKLQkJcXVldWVfd29y
ayhkZXZfcHJpdi0+aG90cGx1Zy5kcF93cSwgJmRldl9wcml2LT5ob3RwbHVnLmRpZ19wb3J0X3dv
cmspOworCQlxdWV1ZV93b3JrKGk5MTUtPmhvdHBsdWcuZHBfd3EsICZpOTE1LT5ob3RwbHVnLmRp
Z19wb3J0X3dvcmspOwogCWlmIChxdWV1ZV9ocCkKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYt
PmhvdHBsdWcuaG90cGx1Z193b3JrKTsKKwkJc2NoZWR1bGVfd29yaygmaTkxNS0+aG90cGx1Zy5o
b3RwbHVnX3dvcmspOwogfQogCiAvKioKICAqIGludGVsX2hwZF9pbml0IC0gaW5pdGlhbGl6ZXMg
YW5kIGVuYWJsZXMgaHBkIHN1cHBvcnQKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFu
Y2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICoKICAqIFRoaXMgZnVuY3Rpb24g
ZW5hYmxlcyB0aGUgaG90cGx1ZyBzdXBwb3J0LiBJdCByZXF1aXJlcyB0aGF0IGludGVycnVwdHMg
aGF2ZQogICogYWxyZWFkeSBiZWVuIGVuYWJsZWQgd2l0aCBpbnRlbF9pcnFfaW5pdF9odygpLiBG
cm9tIHRoaXMgcG9pbnQgb24gaG90cGx1ZyBhbmQKQEAgLTUzMyw0MyArNTMzLDQzIEBAIHZvaWQg
aW50ZWxfaHBkX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
ICAqCiAgKiBBbHNvIHNlZTogaW50ZWxfaHBkX3BvbGxfaW5pdCgpLCB3aGljaCBlbmFibGVzIGNv
bm5lY3RvciBwb2xsaW5nCiAgKi8KLXZvaWQgaW50ZWxfaHBkX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9ocGRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgaTsKIAogCWZvcl9lYWNoX2hwZF9waW4oaSkgewotCQlk
ZXZfcHJpdi0+aG90cGx1Zy5zdGF0c1tpXS5jb3VudCA9IDA7Ci0JCWRldl9wcml2LT5ob3RwbHVn
LnN0YXRzW2ldLnN0YXRlID0gSFBEX0VOQUJMRUQ7CisJCWk5MTUtPmhvdHBsdWcuc3RhdHNbaV0u
Y291bnQgPSAwOworCQlpOTE1LT5ob3RwbHVnLnN0YXRzW2ldLnN0YXRlID0gSFBEX0VOQUJMRUQ7
CiAJfQogCi0JV1JJVEVfT05DRShkZXZfcHJpdi0+aG90cGx1Zy5wb2xsX2VuYWJsZWQsIGZhbHNl
KTsKLQlzY2hlZHVsZV93b3JrKCZkZXZfcHJpdi0+aG90cGx1Zy5wb2xsX2luaXRfd29yayk7CisJ
V1JJVEVfT05DRShpOTE1LT5ob3RwbHVnLnBvbGxfZW5hYmxlZCwgZmFsc2UpOworCXNjaGVkdWxl
X3dvcmsoJmk5MTUtPmhvdHBsdWcucG9sbF9pbml0X3dvcmspOwogCiAJLyoKIAkgKiBJbnRlcnJ1
cHQgc2V0dXAgaXMgYWxyZWFkeSBndWFyYW50ZWVkIHRvIGJlIHNpbmdsZS10aHJlYWRlZCwgdGhp
cyBpcwogCSAqIGp1c3QgdG8gbWFrZSB0aGUgYXNzZXJ0X3NwaW5fbG9ja2VkIGNoZWNrcyBoYXBw
eS4KIAkgKi8KLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXlfaXJxc19lbmFibGVkICYmIGRldl9wcml2
LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXApIHsKLQkJc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmly
cV9sb2NrKTsKLQkJaWYgKGRldl9wcml2LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkKLQkJCWRldl9w
cml2LT5kaXNwbGF5LmhwZF9pcnFfc2V0dXAoZGV2X3ByaXYpOwotCQlzcGluX3VubG9ja19pcnEo
JmRldl9wcml2LT5pcnFfbG9jayk7CisJaWYgKGk5MTUtPmRpc3BsYXlfaXJxc19lbmFibGVkICYm
IGk5MTUtPmRpc3BsYXkuaHBkX2lycV9zZXR1cCkgeworCQlzcGluX2xvY2tfaXJxKCZpOTE1LT5p
cnFfbG9jayk7CisJCWlmIChpOTE1LT5kaXNwbGF5X2lycXNfZW5hYmxlZCkKKwkJCWk5MTUtPmRp
c3BsYXkuaHBkX2lycV9zZXR1cChpOTE1KTsKKwkJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFf
bG9jayk7CiAJfQogfQogCiBzdGF0aWMgdm9pZCBpOTE1X2hwZF9wb2xsX2luaXRfd29yayhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNvbnRhaW5lcl9vZih3
b3JrLCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSwKIAkJCSAgICAgaG90cGx1Zy5wb2xsX2luaXRf
d29yayk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXYgPSAmaTkxNS0+ZHJtOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNvbm5faXRlcjsKIAli
b29sIGVuYWJsZWQ7CiAKIAltdXRleF9sb2NrKCZkZXYtPm1vZGVfY29uZmlnLm11dGV4KTsKIAot
CWVuYWJsZWQgPSBSRUFEX09OQ0UoZGV2X3ByaXYtPmhvdHBsdWcucG9sbF9lbmFibGVkKTsKKwll
bmFibGVkID0gUkVBRF9PTkNFKGk5MTUtPmhvdHBsdWcucG9sbF9lbmFibGVkKTsKIAogCWRybV9j
b25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRlcik7CiAJZHJtX2Zvcl9lYWNo
X2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5faXRlcikgewpAQCAtNTgyLDcgKzU4Miw3
IEBAIHN0YXRpYyB2b2lkIGk5MTVfaHBkX3BvbGxfaW5pdF93b3JrKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yaykKIAkJaWYgKGludGVsX2Nvbm5lY3Rvci0+bXN0X3BvcnQpCiAJCQljb250aW51ZTsK
IAotCQlpZiAoIWNvbm5lY3Rvci0+cG9sbGVkICYmIEk5MTVfSEFTX0hPVFBMVUcoZGV2X3ByaXYp
ICYmCisJCWlmICghY29ubmVjdG9yLT5wb2xsZWQgJiYgSTkxNV9IQVNfSE9UUExVRyhpOTE1KSAm
JgogCQkgICAgaW50ZWxfY29ubmVjdG9yLT5lbmNvZGVyLT5ocGRfcGluID4gSFBEX05PTkUpIHsK
IAkJCWNvbm5lY3Rvci0+cG9sbGVkID0gZW5hYmxlZCA/CiAJCQkJRFJNX0NPTk5FQ1RPUl9QT0xM
X0NPTk5FQ1QgfApAQCAtNjA3LDcgKzYwNyw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfaHBkX3BvbGxf
aW5pdF93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogLyoqCiAgKiBpbnRlbF9ocGRf
cG9sbF9pbml0IC0gZW5hYmxlcy9kaXNhYmxlcyBwb2xsaW5nIGZvciBjb25uZWN0b3JzIHdpdGgg
aHBkCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBk
ZXZpY2UgaW5zdGFuY2UKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGVuYWJsZXMgcG9sbGluZyBmb3Ig
YWxsIGNvbm5lY3RvcnMsIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciBvcgogICogbm90IHRoZXkgc3Vw
cG9ydCBob3RwbHVnIGRldGVjdGlvbi4gVW5kZXIgY2VydGFpbiBjb25kaXRpb25zIEhQRCBtYXkg
bm90IGJlCkBAIC02MjEsOSArNjIxLDkgQEAgc3RhdGljIHZvaWQgaTkxNV9ocGRfcG9sbF9pbml0
X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogICoKICAqIEFsc28gc2VlOiBpbnRlbF9o
cGRfaW5pdCgpLCB3aGljaCByZXN0b3JlcyBocGQgaGFuZGxpbmcuCiAgKi8KLXZvaWQgaW50ZWxf
aHBkX3BvbGxfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGlu
dGVsX2hwZF9wb2xsX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JV1JJ
VEVfT05DRShkZXZfcHJpdi0+aG90cGx1Zy5wb2xsX2VuYWJsZWQsIHRydWUpOworCVdSSVRFX09O
Q0UoaTkxNS0+aG90cGx1Zy5wb2xsX2VuYWJsZWQsIHRydWUpOwogCiAJLyoKIAkgKiBXZSBtaWdo
dCBhbHJlYWR5IGJlIGhvbGRpbmcgZGV2LT5tb2RlX2NvbmZpZy5tdXRleCwgc28gZG8gdGhpcyBp
biBhCkBAIC02MzEsNTcgKzYzMSw1NyBAQCB2b2lkIGludGVsX2hwZF9wb2xsX2luaXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIEFzIHdlbGwsIHRoZXJlJ3Mgbm8gaXNz
dWUgaWYgd2UgcmFjZSBoZXJlIHNpbmNlIHdlIGFsd2F5cyByZXNjaGVkdWxlCiAJICogdGhpcyB3
b3JrZXIgYW55d2F5CiAJICovCi0Jc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPmhvdHBsdWcucG9s
bF9pbml0X3dvcmspOworCXNjaGVkdWxlX3dvcmsoJmk5MTUtPmhvdHBsdWcucG9sbF9pbml0X3dv
cmspOwogfQogCi12b2lkIGludGVsX2hwZF9pbml0X3dvcmsoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9ocGRfaW5pdF93b3JrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewotCUlOSVRfV09SSygmZGV2X3ByaXYtPmhvdHBsdWcuaG90cGx1Z193
b3JrLCBpOTE1X2hvdHBsdWdfd29ya19mdW5jKTsKLQlJTklUX1dPUksoJmRldl9wcml2LT5ob3Rw
bHVnLmRpZ19wb3J0X3dvcmssIGk5MTVfZGlncG9ydF93b3JrX2Z1bmMpOwotCUlOSVRfV09SSygm
ZGV2X3ByaXYtPmhvdHBsdWcucG9sbF9pbml0X3dvcmssIGk5MTVfaHBkX3BvbGxfaW5pdF93b3Jr
KTsKLQlJTklUX0RFTEFZRURfV09SSygmZGV2X3ByaXYtPmhvdHBsdWcucmVlbmFibGVfd29yaywK
KwlJTklUX1dPUksoJmk5MTUtPmhvdHBsdWcuaG90cGx1Z193b3JrLCBpOTE1X2hvdHBsdWdfd29y
a19mdW5jKTsKKwlJTklUX1dPUksoJmk5MTUtPmhvdHBsdWcuZGlnX3BvcnRfd29yaywgaTkxNV9k
aWdwb3J0X3dvcmtfZnVuYyk7CisJSU5JVF9XT1JLKCZpOTE1LT5ob3RwbHVnLnBvbGxfaW5pdF93
b3JrLCBpOTE1X2hwZF9wb2xsX2luaXRfd29yayk7CisJSU5JVF9ERUxBWUVEX1dPUksoJmk5MTUt
PmhvdHBsdWcucmVlbmFibGVfd29yaywKIAkJCSAgaW50ZWxfaHBkX2lycV9zdG9ybV9yZWVuYWJs
ZV93b3JrKTsKIH0KIAotdm9pZCBpbnRlbF9ocGRfY2FuY2VsX3dvcmsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9ocGRfY2FuY2VsX3dvcmsoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9s
b2NrKTsKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CiAKLQlkZXZfcHJpdi0+aG90
cGx1Zy5sb25nX3BvcnRfbWFzayA9IDA7Ci0JZGV2X3ByaXYtPmhvdHBsdWcuc2hvcnRfcG9ydF9t
YXNrID0gMDsKLQlkZXZfcHJpdi0+aG90cGx1Zy5ldmVudF9iaXRzID0gMDsKKwlpOTE1LT5ob3Rw
bHVnLmxvbmdfcG9ydF9tYXNrID0gMDsKKwlpOTE1LT5ob3RwbHVnLnNob3J0X3BvcnRfbWFzayA9
IDA7CisJaTkxNS0+aG90cGx1Zy5ldmVudF9iaXRzID0gMDsKIAotCXNwaW5fdW5sb2NrX2lycSgm
ZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsK
IAotCWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5ob3RwbHVnLmRpZ19wb3J0X3dvcmspOwot
CWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5ob3RwbHVnLmhvdHBsdWdfd29yayk7Ci0JY2Fu
Y2VsX3dvcmtfc3luYygmZGV2X3ByaXYtPmhvdHBsdWcucG9sbF9pbml0X3dvcmspOwotCWNhbmNl
bF9kZWxheWVkX3dvcmtfc3luYygmZGV2X3ByaXYtPmhvdHBsdWcucmVlbmFibGVfd29yayk7CisJ
Y2FuY2VsX3dvcmtfc3luYygmaTkxNS0+aG90cGx1Zy5kaWdfcG9ydF93b3JrKTsKKwljYW5jZWxf
d29ya19zeW5jKCZpOTE1LT5ob3RwbHVnLmhvdHBsdWdfd29yayk7CisJY2FuY2VsX3dvcmtfc3lu
YygmaTkxNS0+aG90cGx1Zy5wb2xsX2luaXRfd29yayk7CisJY2FuY2VsX2RlbGF5ZWRfd29ya19z
eW5jKCZpOTE1LT5ob3RwbHVnLnJlZW5hYmxlX3dvcmspOwogfQogCi1ib29sIGludGVsX2hwZF9k
aXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBocGRfcGluIHBp
bikKK2Jvb2wgaW50ZWxfaHBkX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IGVudW0gaHBkX3BpbiBwaW4pCiB7CiAJYm9vbCByZXQgPSBmYWxzZTsKIAogCWlmIChwaW4gPT0g
SFBEX05PTkUpCiAJCXJldHVybiBmYWxzZTsKIAotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5p
cnFfbG9jayk7Ci0JaWYgKGRldl9wcml2LT5ob3RwbHVnLnN0YXRzW3Bpbl0uc3RhdGUgPT0gSFBE
X0VOQUJMRUQpIHsKLQkJZGV2X3ByaXYtPmhvdHBsdWcuc3RhdHNbcGluXS5zdGF0ZSA9IEhQRF9E
SVNBQkxFRDsKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJaWYgKGk5MTUtPmhv
dHBsdWcuc3RhdHNbcGluXS5zdGF0ZSA9PSBIUERfRU5BQkxFRCkgeworCQlpOTE1LT5ob3RwbHVn
LnN0YXRzW3Bpbl0uc3RhdGUgPSBIUERfRElTQUJMRUQ7CiAJCXJldCA9IHRydWU7CiAJfQotCXNw
aW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX3VubG9ja19pcnEoJmk5
MTUtPmlycV9sb2NrKTsKIAogCXJldHVybiByZXQ7CiB9CiAKLXZvaWQgaW50ZWxfaHBkX2VuYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gaHBkX3BpbiBwaW4pCit2
b2lkIGludGVsX2hwZF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0g
aHBkX3BpbiBwaW4pCiB7CiAJaWYgKHBpbiA9PSBIUERfTk9ORSkKIAkJcmV0dXJuOwogCi0Jc3Bp
bl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlkZXZfcHJpdi0+aG90cGx1Zy5zdGF0
c1twaW5dLnN0YXRlID0gSFBEX0VOQUJMRUQ7Ci0Jc3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+
aXJxX2xvY2spOworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKKwlpOTE1LT5ob3Rw
bHVnLnN0YXRzW3Bpbl0uc3RhdGUgPSBIUERfRU5BQkxFRDsKKwlzcGluX3VubG9ja19pcnEoJmk5
MTUtPmlycV9sb2NrKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2hvdHBsdWcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2hvdHBsdWcuaAppbmRleCA4
MDVmODk3ZGJiN2EuLjJmY2MzMTQ4YjM2OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfaG90cGx1Zy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2hvdHBs
dWcuaApAQCAtMTQsMTcgKzE0LDE3IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogc3RydWN0
IGludGVsX2Nvbm5lY3RvcjsKIHN0cnVjdCBpbnRlbF9lbmNvZGVyOwogCi12b2lkIGludGVsX2hw
ZF9wb2xsX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50
ZWxfaHBkX3BvbGxfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBib29sIGlu
dGVsX2VuY29kZXJfaG90cGx1ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAg
IHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rvcik7Ci12b2lkIGludGVsX2hwZF9pcnFf
aGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2hw
ZF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgIHUzMiBw
aW5fbWFzaywgdTMyIGxvbmdfbWFzayk7Ci12b2lkIGludGVsX2hwZF9pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX2hwZF9pbml0X3dvcmsoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfaHBkX2NhbmNlbF93b3Jr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1lbnVtIGhwZF9waW4gaW50ZWxf
aHBkX3Bpbl9kZWZhdWx0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQg
aW50ZWxfaHBkX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpbnRl
bF9ocGRfaW5pdF93b3JrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50
ZWxfaHBkX2NhbmNlbF93b3JrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK2VudW0g
aHBkX3BpbiBpbnRlbF9ocGRfcGluX2RlZmF1bHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICAgZW51bSBwb3J0IHBvcnQpOwotYm9vbCBpbnRlbF9ocGRfZGlzYWJsZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gaHBkX3BpbiBwaW4pOwotdm9pZCBp
bnRlbF9ocGRfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBo
cGRfcGluIHBpbik7Citib29sIGludGVsX2hwZF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCBlbnVtIGhwZF9waW4gcGluKTsKK3ZvaWQgaW50ZWxfaHBkX2VuYWJsZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBocGRfcGluIHBpbik7CiAKICNlbmRpZiAv
KiBfX0lOVEVMX0hPVFBMVUdfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9odWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2h1Yy5jCmluZGV4IDg1
NzJhMDU4OGVmYy4uMmIyMzY2MjY5OGE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9odWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9odWMuYwpAQCAt
MTY3LDE0ICsxNjcsMTQgQEAgaW50IGludGVsX2h1Y19hdXRoKHN0cnVjdCBpbnRlbF9odWMgKmh1
YykKICAqLwogaW50IGludGVsX2h1Y19jaGVja19zdGF0dXMoc3RydWN0IGludGVsX2h1YyAqaHVj
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGh1Y190b19pOTE1KGh1
Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBodWNfdG9faTkxNShodWMpOwog
CWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWJvb2wgc3RhdHVzID0gZmFsc2U7CiAKLQlpZiAo
IUhBU19IVUMoZGV2X3ByaXYpKQorCWlmICghSEFTX0hVQyhpOTE1KSkKIAkJcmV0dXJuIC1FTk9E
RVY7CiAKLQl3aXRoX2ludGVsX3J1bnRpbWVfcG0oZGV2X3ByaXYsIHdha2VyZWYpCisJd2l0aF9p
bnRlbF9ydW50aW1lX3BtKGk5MTUsIHdha2VyZWYpCiAJCXN0YXR1cyA9IChJOTE1X1JFQUQoaHVj
LT5zdGF0dXMucmVnKSAmIGh1Yy0+c3RhdHVzLm1hc2spID09CiAJCQkgIGh1Yy0+c3RhdHVzLnZh
bHVlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9odWNfZncuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2h1Y19mdy5jCmluZGV4IDA1Y2JmODMzOGY1My4u
MDNhZWQwNjY0NzI2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9odWNf
ZncuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9odWNfZncuYwpAQCAtNjksMzQg
KzY5LDM0IEBAIE1PRFVMRV9GSVJNV0FSRShJOTE1X0lDTF9IVUNfVUNPREUpOwogc3RhdGljIHZv
aWQgaHVjX2Z3X3NlbGVjdChzdHJ1Y3QgaW50ZWxfdWNfZncgKmh1Y19mdykKIHsKIAlzdHJ1Y3Qg
aW50ZWxfaHVjICpodWMgPSBjb250YWluZXJfb2YoaHVjX2Z3LCBzdHJ1Y3QgaW50ZWxfaHVjLCBm
dyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gaHVjX3RvX2k5MTUoaHVj
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGh1Y190b19pOTE1KGh1Yyk7CiAK
IAlHRU1fQlVHX09OKGh1Y19mdy0+dHlwZSAhPSBJTlRFTF9VQ19GV19UWVBFX0hVQyk7CiAKLQlp
ZiAoIUhBU19IVUMoZGV2X3ByaXYpKQorCWlmICghSEFTX0hVQyhpOTE1KSkKIAkJcmV0dXJuOwog
CiAJaWYgKGk5MTVfbW9kcGFyYW1zLmh1Y19maXJtd2FyZV9wYXRoKSB7CiAJCWh1Y19mdy0+cGF0
aCA9IGk5MTVfbW9kcGFyYW1zLmh1Y19maXJtd2FyZV9wYXRoOwogCQlodWNfZnctPm1ham9yX3Zl
cl93YW50ZWQgPSAwOwogCQlodWNfZnctPm1pbm9yX3Zlcl93YW50ZWQgPSAwOwotCX0gZWxzZSBp
ZiAoSVNfU0tZTEFLRShkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1NLWUxBS0UoaTkxNSkp
IHsKIAkJaHVjX2Z3LT5wYXRoID0gSTkxNV9TS0xfSFVDX1VDT0RFOwogCQlodWNfZnctPm1ham9y
X3Zlcl93YW50ZWQgPSBTS0xfSFVDX0ZXX01BSk9SOwogCQlodWNfZnctPm1pbm9yX3Zlcl93YW50
ZWQgPSBTS0xfSFVDX0ZXX01JTk9SOwotCX0gZWxzZSBpZiAoSVNfQlJPWFRPTihkZXZfcHJpdikp
IHsKKwl9IGVsc2UgaWYgKElTX0JST1hUT04oaTkxNSkpIHsKIAkJaHVjX2Z3LT5wYXRoID0gSTkx
NV9CWFRfSFVDX1VDT0RFOwogCQlodWNfZnctPm1ham9yX3Zlcl93YW50ZWQgPSBCWFRfSFVDX0ZX
X01BSk9SOwogCQlodWNfZnctPm1pbm9yX3Zlcl93YW50ZWQgPSBCWFRfSFVDX0ZXX01JTk9SOwot
CX0gZWxzZSBpZiAoSVNfS0FCWUxBS0UoZGV2X3ByaXYpIHx8IElTX0NPRkZFRUxBS0UoZGV2X3By
aXYpKSB7CisJfSBlbHNlIGlmIChJU19LQUJZTEFLRShpOTE1KSB8fCBJU19DT0ZGRUVMQUtFKGk5
MTUpKSB7CiAJCWh1Y19mdy0+cGF0aCA9IEk5MTVfS0JMX0hVQ19VQ09ERTsKIAkJaHVjX2Z3LT5t
YWpvcl92ZXJfd2FudGVkID0gS0JMX0hVQ19GV19NQUpPUjsKIAkJaHVjX2Z3LT5taW5vcl92ZXJf
d2FudGVkID0gS0JMX0hVQ19GV19NSU5PUjsKLQl9IGVsc2UgaWYgKElTX0dFTUlOSUxBS0UoZGV2
X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19HRU1JTklMQUtFKGk5MTUpKSB7CiAJCWh1Y19mdy0+
cGF0aCA9IEk5MTVfR0xLX0hVQ19VQ09ERTsKIAkJaHVjX2Z3LT5tYWpvcl92ZXJfd2FudGVkID0g
R0xLX0hVQ19GV19NQUpPUjsKIAkJaHVjX2Z3LT5taW5vcl92ZXJfd2FudGVkID0gR0xLX0hVQ19G
V19NSU5PUjsKLQl9IGVsc2UgaWYgKElTX0lDRUxBS0UoZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlm
IChJU19JQ0VMQUtFKGk5MTUpKSB7CiAJCWh1Y19mdy0+cGF0aCA9IEk5MTVfSUNMX0hVQ19VQ09E
RTsKIAkJaHVjX2Z3LT5tYWpvcl92ZXJfd2FudGVkID0gSUNMX0hVQ19GV19NQUpPUjsKIAkJaHVj
X2Z3LT5taW5vcl92ZXJfd2FudGVkID0gSUNMX0hVQ19GV19NSU5PUjsKQEAgLTEzNSw4ICsxMzUs
OCBAQCBzdGF0aWMgdm9pZCBodWNfeGZlcl9yc2Eoc3RydWN0IGludGVsX2h1YyAqaHVjKQogc3Rh
dGljIGludCBodWNfeGZlcl91Y29kZShzdHJ1Y3QgaW50ZWxfaHVjICpodWMpCiB7CiAJc3RydWN0
IGludGVsX3VjX2Z3ICpodWNfZncgPSAmaHVjLT5mdzsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBodWNfdG9faTkxNShodWMpOwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gaHVjX3RvX2k5MTUoaHVjKTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkx
NS0+dW5jb3JlOwogCXVuc2lnbmVkIGxvbmcgb2Zmc2V0ID0gMDsKIAl1MzIgc2l6ZTsKIAlpbnQg
cmV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHBlX2F1ZGlvLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9scGVfYXVkaW8uYwppbmRleCBiMTk4MDBiNTg0
NDIuLmQ5NWFlMDVjY2ViYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
bHBlX2F1ZGlvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHBlX2F1ZGlvLmMK
QEAgLTczLDEyICs3MywxMiBAQAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaW50
ZWxfbHBlX2F1ZGlvLmgiCiAKLSNkZWZpbmUgSEFTX0xQRV9BVURJTyhkZXZfcHJpdikgKChkZXZf
cHJpdiktPmxwZV9hdWRpby5wbGF0ZGV2ICE9IE5VTEwpCisjZGVmaW5lIEhBU19MUEVfQVVESU8o
aTkxNSkgKChpOTE1KS0+bHBlX2F1ZGlvLnBsYXRkZXYgIT0gTlVMTCkKIAogc3RhdGljIHN0cnVj
dCBwbGF0Zm9ybV9kZXZpY2UgKgotbHBlX2F1ZGlvX3BsYXRkZXZfY3JlYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2xwZV9hdWRpb19wbGF0ZGV2X2NyZWF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRl
dl9wcml2LT5kcm07CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZpOTE1LT5kcm07CiAJc3Ry
dWN0IHBsYXRmb3JtX2RldmljZV9pbmZvIHBpbmZvID0ge307CiAJc3RydWN0IHJlc291cmNlICpy
c2M7CiAJc3RydWN0IHBsYXRmb3JtX2RldmljZSAqcGxhdGRldjsKQEAgLTk0LDcgKzk0LDcgQEAg
bHBlX2F1ZGlvX3BsYXRkZXZfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAJfQogCi0JcnNjWzBdLnN0YXJ0ICAgID0g
cnNjWzBdLmVuZCA9IGRldl9wcml2LT5scGVfYXVkaW8uaXJxOworCXJzY1swXS5zdGFydCAgICA9
IHJzY1swXS5lbmQgPSBpOTE1LT5scGVfYXVkaW8uaXJxOwogCXJzY1swXS5mbGFncyAgICA9IElP
UkVTT1VSQ0VfSVJROwogCXJzY1swXS5uYW1lICAgICA9ICJoZG1pLWxwZS1hdWRpby1pcnEiOwog
CkBAIC0xMTQsOCArMTE0LDggQEAgbHBlX2F1ZGlvX3BsYXRkZXZfY3JlYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlwaW5mby5zaXplX2RhdGEgPSBzaXplb2YoKnBkYXRh
KTsKIAlwaW5mby5kbWFfbWFzayA9IERNQV9CSVRfTUFTSygzMik7CiAKLQlwZGF0YS0+bnVtX3Bp
cGVzID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPm51bV9waXBlczsKLQlwZGF0YS0+bnVtX3BvcnRz
ID0gSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgPyAzIDogMjsgLyogQixDLEQgb3IgQixDICovCisJ
cGRhdGEtPm51bV9waXBlcyA9IElOVEVMX0lORk8oaTkxNSktPm51bV9waXBlczsKKwlwZGF0YS0+
bnVtX3BvcnRzID0gSVNfQ0hFUlJZVklFVyhpOTE1KSA/IDMgOiAyOyAvKiBCLEMsRCBvciBCLEMg
Ki8KIAlwZGF0YS0+cG9ydFswXS5waXBlID0gLTE7CiAJcGRhdGEtPnBvcnRbMV0ucGlwZSA9IC0x
OwogCXBkYXRhLT5wb3J0WzJdLnBpcGUgPSAtMTsKQEAgLTEzNSw3ICsxMzUsNyBAQCBscGVfYXVk
aW9fcGxhdGRldl9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJl
dHVybiBwbGF0ZGV2OwogfQogCi1zdGF0aWMgdm9pZCBscGVfYXVkaW9fcGxhdGRldl9kZXN0cm95
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGxwZV9hdWRp
b19wbGF0ZGV2X2Rlc3Ryb3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyog
WFhYIE5vdGUgdGhhdCBwbGF0Zm9ybV9kZXZpY2VfcmVnaXN0ZXJfZnVsbCgpIGFsbG9jYXRlcyBh
IGRtYV9tYXNrCiAJICogYW5kIG5ldmVyIGZyZWVzIGl0LiBXZSBjYW4ndCBmcmVlIGl0IGhlcmUg
YXMgd2UgY2Fubm90IGd1YXJhbnRlZQpAQCAtMTQ1LDcgKzE0NSw3IEBAIHN0YXRpYyB2b2lkIGxw
ZV9hdWRpb19wbGF0ZGV2X2Rlc3Ryb3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCSAqIHRoYW4gdXMgZmlkZGxlIHdpdGggaXRzIGludGVybmFscy4KIAkgKi8KIAotCXBsYXRm
b3JtX2RldmljZV91bnJlZ2lzdGVyKGRldl9wcml2LT5scGVfYXVkaW8ucGxhdGRldik7CisJcGxh
dGZvcm1fZGV2aWNlX3VucmVnaXN0ZXIoaTkxNS0+bHBlX2F1ZGlvLnBsYXRkZXYpOwogfQogCiBz
dGF0aWMgdm9pZCBscGVfYXVkaW9faXJxX3VubWFzayhzdHJ1Y3QgaXJxX2RhdGEgKmQpCkBAIC0x
NjIsMjQgKzE2MiwyNCBAQCBzdGF0aWMgc3RydWN0IGlycV9jaGlwIGxwZV9hdWRpb19pcnFjaGlw
ID0gewogCS5pcnFfdW5tYXNrID0gbHBlX2F1ZGlvX2lycV91bm1hc2ssCiB9OwogCi1zdGF0aWMg
aW50IGxwZV9hdWRpb19pcnFfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgaW50IGxwZV9hdWRpb19pcnFfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlpbnQgaXJxID0gZGV2X3ByaXYtPmxwZV9hdWRpby5pcnE7CisJaW50IGlycSA9
IGk5MTUtPmxwZV9hdWRpby5pcnE7CiAKLQlXQVJOX09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoZGV2
X3ByaXYpKTsKKwlXQVJOX09OKCFpbnRlbF9pcnFzX2VuYWJsZWQoaTkxNSkpOwogCWlycV9zZXRf
Y2hpcF9hbmRfaGFuZGxlcl9uYW1lKGlycSwKIAkJCQkmbHBlX2F1ZGlvX2lycWNoaXAsCiAJCQkJ
aGFuZGxlX3NpbXBsZV9pcnEsCiAJCQkJImhkbWlfbHBlX2F1ZGlvX2lycV9oYW5kbGVyIik7CiAK
LQlyZXR1cm4gaXJxX3NldF9jaGlwX2RhdGEoaXJxLCBkZXZfcHJpdik7CisJcmV0dXJuIGlycV9z
ZXRfY2hpcF9kYXRhKGlycSwgaTkxNSk7CiB9CiAKLXN0YXRpYyBib29sIGxwZV9hdWRpb19kZXRl
Y3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGJvb2wgbHBlX2F1
ZGlvX2RldGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgbHBlX3By
ZXNlbnQgPSBmYWxzZTsKIAotCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVS
UllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJS
WVZJRVcoaTkxNSkpIHsKIAkJc3RhdGljIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkIGF0b21f
aGRhdWRpb19pZHNbXSA9IHsKIAkJCS8qIEJheXRyYWlsICovCiAJCQl7UENJX0RFVklDRShQQ0lf
VkVORE9SX0lEX0lOVEVMLCAweDBmMDQpfSwKQEAgLTE5NiwyMSArMTk2LDIxIEBAIHN0YXRpYyBi
b29sIGxwZV9hdWRpb19kZXRlY3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CXJldHVybiBscGVfcHJlc2VudDsKIH0KIAotc3RhdGljIGludCBscGVfYXVkaW9fc2V0dXAoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCBscGVfYXVkaW9fc2V0
dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IHJldDsKIAotCWRldl9w
cml2LT5scGVfYXVkaW8uaXJxID0gaXJxX2FsbG9jX2Rlc2MoMCk7Ci0JaWYgKGRldl9wcml2LT5s
cGVfYXVkaW8uaXJxIDwgMCkgeworCWk5MTUtPmxwZV9hdWRpby5pcnEgPSBpcnFfYWxsb2NfZGVz
YygwKTsKKwlpZiAoaTkxNS0+bHBlX2F1ZGlvLmlycSA8IDApIHsKIAkJRFJNX0VSUk9SKCJGYWls
ZWQgdG8gYWxsb2NhdGUgSVJRIGRlc2M6ICVkXG4iLAotCQkJZGV2X3ByaXYtPmxwZV9hdWRpby5p
cnEpOwotCQlyZXQgPSBkZXZfcHJpdi0+bHBlX2F1ZGlvLmlycTsKKwkJCWk5MTUtPmxwZV9hdWRp
by5pcnEpOworCQlyZXQgPSBpOTE1LT5scGVfYXVkaW8uaXJxOwogCQlnb3RvIGVycjsKIAl9CiAK
LQlEUk1fREVCVUcoImlycSA9ICVkXG4iLCBkZXZfcHJpdi0+bHBlX2F1ZGlvLmlycSk7CisJRFJN
X0RFQlVHKCJpcnEgPSAlZFxuIiwgaTkxNS0+bHBlX2F1ZGlvLmlycSk7CiAKLQlyZXQgPSBscGVf
YXVkaW9faXJxX2luaXQoZGV2X3ByaXYpOworCXJldCA9IGxwZV9hdWRpb19pcnFfaW5pdChpOTE1
KTsKIAogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBpcnFj
aGlwIGZvciBscGUgYXVkaW86ICVkXG4iLApAQCAtMjE4LDEwICsyMTgsMTAgQEAgc3RhdGljIGlu
dCBscGVfYXVkaW9fc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQln
b3RvIGVycl9mcmVlX2lycTsKIAl9CiAKLQlkZXZfcHJpdi0+bHBlX2F1ZGlvLnBsYXRkZXYgPSBs
cGVfYXVkaW9fcGxhdGRldl9jcmVhdGUoZGV2X3ByaXYpOworCWk5MTUtPmxwZV9hdWRpby5wbGF0
ZGV2ID0gbHBlX2F1ZGlvX3BsYXRkZXZfY3JlYXRlKGk5MTUpOwogCi0JaWYgKElTX0VSUihkZXZf
cHJpdi0+bHBlX2F1ZGlvLnBsYXRkZXYpKSB7Ci0JCXJldCA9IFBUUl9FUlIoZGV2X3ByaXYtPmxw
ZV9hdWRpby5wbGF0ZGV2KTsKKwlpZiAoSVNfRVJSKGk5MTUtPmxwZV9hdWRpby5wbGF0ZGV2KSkg
eworCQlyZXQgPSBQVFJfRVJSKGk5MTUtPmxwZV9hdWRpby5wbGF0ZGV2KTsKIAkJRFJNX0VSUk9S
KCJGYWlsZWQgdG8gY3JlYXRlIGxwZSBhdWRpbyBwbGF0Zm9ybSBkZXZpY2U6ICVkXG4iLAogCQkJ
cmV0KTsKIAkJZ290byBlcnJfZnJlZV9pcnE7CkBAIC0yMzQsMjggKzIzNCwyOCBAQCBzdGF0aWMg
aW50IGxwZV9hdWRpb19zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAK
IAlyZXR1cm4gMDsKIGVycl9mcmVlX2lycToKLQlpcnFfZnJlZV9kZXNjKGRldl9wcml2LT5scGVf
YXVkaW8uaXJxKTsKKwlpcnFfZnJlZV9kZXNjKGk5MTUtPmxwZV9hdWRpby5pcnEpOwogZXJyOgot
CWRldl9wcml2LT5scGVfYXVkaW8uaXJxID0gLTE7Ci0JZGV2X3ByaXYtPmxwZV9hdWRpby5wbGF0
ZGV2ID0gTlVMTDsKKwlpOTE1LT5scGVfYXVkaW8uaXJxID0gLTE7CisJaTkxNS0+bHBlX2F1ZGlv
LnBsYXRkZXYgPSBOVUxMOwogCXJldHVybiByZXQ7CiB9CiAKIC8qKgogICogaW50ZWxfbHBlX2F1
ZGlvX2lycV9oYW5kbGVyKCkgLSBmb3J3YXJkcyB0aGUgTFBFIGF1ZGlvIGlycQotICogQGRldl9w
cml2OiB0aGUgaTkxNSBkcm0gZGV2aWNlIHByaXZhdGUgZGF0YQorICogQGk5MTU6IHRoZSBpOTE1
IGRybSBkZXZpY2UgcHJpdmF0ZSBkYXRhCiAgKgogICogdGhlIExQRSBBdWRpbyBpcnEgaXMgZm9y
d2FyZGVkIHRvIHRoZSBpcnEgaGFuZGxlciByZWdpc3RlcmVkIGJ5IExQRSBhdWRpbwogICogZHJp
dmVyLgogICovCi12b2lkIGludGVsX2xwZV9hdWRpb19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2xwZV9hdWRpb19pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgcmV0OwogCi0JaWYgKCFIQVNf
TFBFX0FVRElPKGRldl9wcml2KSkKKwlpZiAoIUhBU19MUEVfQVVESU8oaTkxNSkpCiAJCXJldHVy
bjsKIAotCXJldCA9IGdlbmVyaWNfaGFuZGxlX2lycShkZXZfcHJpdi0+bHBlX2F1ZGlvLmlycSk7
CisJcmV0ID0gZ2VuZXJpY19oYW5kbGVfaXJxKGk5MTUtPmxwZV9hdWRpby5pcnEpOwogCWlmIChy
ZXQpCiAJCURSTV9FUlJPUl9SQVRFTElNSVRFRCgiZXJyb3IgaGFuZGxpbmcgTFBFIGF1ZGlvIGly
cTogJWRcbiIsCiAJCQkJcmV0KTsKQEAgLTI2NCwxNyArMjY0LDE3IEBAIHZvaWQgaW50ZWxfbHBl
X2F1ZGlvX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIC8q
KgogICogaW50ZWxfbHBlX2F1ZGlvX2luaXQoKSAtIGRldGVjdCBhbmQgc2V0dXAgdGhlIGJyaWRn
ZSBiZXR3ZWVuIEhETUkgTFBFIEF1ZGlvCiAgKiBkcml2ZXIgYW5kIGk5MTUKLSAqIEBkZXZfcHJp
djogdGhlIGk5MTUgZHJtIGRldmljZSBwcml2YXRlIGRhdGEKKyAqIEBpOTE1OiB0aGUgaTkxNSBk
cm0gZGV2aWNlIHByaXZhdGUgZGF0YQogICoKICAqIFJldHVybjogMCBpZiBzdWNjZXNzZnVsLiBu
b24temVybyBpZiBkZXRlY3Rpb24gb3IKICAqIGxsb2NhdGlvbi9pbml0aWFsaXphdGlvbiBmYWls
cwogICovCi1pbnQgaW50ZWxfbHBlX2F1ZGlvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQoraW50IGludGVsX2xwZV9hdWRpb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCWludCByZXQgPSAtRU5PREVWOwogCi0JaWYgKGxwZV9hdWRpb19kZXRl
Y3QoZGV2X3ByaXYpKSB7Ci0JCXJldCA9IGxwZV9hdWRpb19zZXR1cChkZXZfcHJpdik7CisJaWYg
KGxwZV9hdWRpb19kZXRlY3QoaTkxNSkpIHsKKwkJcmV0ID0gbHBlX2F1ZGlvX3NldHVwKGk5MTUp
OwogCQlpZiAocmV0IDwgMCkKIAkJCURSTV9FUlJPUigiZmFpbGVkIHRvIHNldHVwIExQRSBBdWRp
byBicmlkZ2VcbiIpOwogCX0KQEAgLTI4NCwzMSArMjg0LDMxIEBAIGludCBpbnRlbF9scGVfYXVk
aW9faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAvKioKICAqIGludGVs
X2xwZV9hdWRpb190ZWFyZG93bigpIC0gZGVzdHJveSB0aGUgYnJpZGdlIGJldHdlZW4gSERNSSBM
UEUKICAqIGF1ZGlvIGRyaXZlciBhbmQgaTkxNQotICogQGRldl9wcml2OiB0aGUgaTkxNSBkcm0g
ZGV2aWNlIHByaXZhdGUgZGF0YQorICogQGk5MTU6IHRoZSBpOTE1IGRybSBkZXZpY2UgcHJpdmF0
ZSBkYXRhCiAgKgogICogcmVsZWFzZSBhbGwgdGhlIHJlc291cmNlcyBmb3IgTFBFIGF1ZGlvIDwt
PiBpOTE1IGJyaWRnZS4KICAqLwotdm9pZCBpbnRlbF9scGVfYXVkaW9fdGVhcmRvd24oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9scGVfYXVkaW9fdGVhcmRv
d24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGlycV9kZXNjICpk
ZXNjOwogCi0JaWYgKCFIQVNfTFBFX0FVRElPKGRldl9wcml2KSkKKwlpZiAoIUhBU19MUEVfQVVE
SU8oaTkxNSkpCiAJCXJldHVybjsKIAotCWRlc2MgPSBpcnFfdG9fZGVzYyhkZXZfcHJpdi0+bHBl
X2F1ZGlvLmlycSk7CisJZGVzYyA9IGlycV90b19kZXNjKGk5MTUtPmxwZV9hdWRpby5pcnEpOwog
Ci0JbHBlX2F1ZGlvX3BsYXRkZXZfZGVzdHJveShkZXZfcHJpdik7CisJbHBlX2F1ZGlvX3BsYXRk
ZXZfZGVzdHJveShpOTE1KTsKIAotCWlycV9mcmVlX2Rlc2MoZGV2X3ByaXYtPmxwZV9hdWRpby5p
cnEpOworCWlycV9mcmVlX2Rlc2MoaTkxNS0+bHBlX2F1ZGlvLmlycSk7CiAKLQlkZXZfcHJpdi0+
bHBlX2F1ZGlvLmlycSA9IC0xOwotCWRldl9wcml2LT5scGVfYXVkaW8ucGxhdGRldiA9IE5VTEw7
CisJaTkxNS0+bHBlX2F1ZGlvLmlycSA9IC0xOworCWk5MTUtPmxwZV9hdWRpby5wbGF0ZGV2ID0g
TlVMTDsKIH0KIAogLyoqCiAgKiBpbnRlbF9scGVfYXVkaW9fbm90aWZ5KCkgLSBub3RpZnkgbHBl
IGF1ZGlvIGV2ZW50CiAgKiBhdWRpbyBkcml2ZXIgYW5kIGk5MTUKLSAqIEBkZXZfcHJpdjogdGhl
IGk5MTUgZHJtIGRldmljZSBwcml2YXRlIGRhdGEKKyAqIEBpOTE1OiB0aGUgaTkxNSBkcm0gZGV2
aWNlIHByaXZhdGUgZGF0YQogICogQHBpcGU6IHBpcGUKICAqIEBwb3J0OiBwb3J0CiAgKiBAZWxk
IDogRUxEIGRhdGEKQEAgLTMxNyw3ICszMTcsNyBAQCB2b2lkIGludGVsX2xwZV9hdWRpb190ZWFy
ZG93bihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKgogICogTm90aWZ5IGxw
ZSBhdWRpbyBkcml2ZXIgb2YgZWxkIGNoYW5nZS4KICAqLwotdm9pZCBpbnRlbF9scGVfYXVkaW9f
bm90aWZ5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfbHBl
X2F1ZGlvX25vdGlmeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBlbnVt
IHBpcGUgcGlwZSwgZW51bSBwb3J0IHBvcnQsCiAJCQkgICAgY29uc3Qgdm9pZCAqZWxkLCBpbnQg
bHNfY2xvY2ssIGJvb2wgZHBfb3V0cHV0KQogewpAQCAtMzI2LDEwICszMjYsMTAgQEAgdm9pZCBp
bnRlbF9scGVfYXVkaW9fbm90aWZ5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAlzdHJ1Y3QgaW50ZWxfaGRtaV9scGVfYXVkaW9fcG9ydF9wZGF0YSAqcHBkYXRhOwogCXUzMiBh
dWRpb19lbmFibGU7CiAKLQlpZiAoIUhBU19MUEVfQVVESU8oZGV2X3ByaXYpKQorCWlmICghSEFT
X0xQRV9BVURJTyhpOTE1KSkKIAkJcmV0dXJuOwogCi0JcGRhdGEgPSBkZXZfZ2V0X3BsYXRkYXRh
KCZkZXZfcHJpdi0+bHBlX2F1ZGlvLnBsYXRkZXYtPmRldik7CisJcGRhdGEgPSBkZXZfZ2V0X3Bs
YXRkYXRhKCZpOTE1LT5scGVfYXVkaW8ucGxhdGRldi0+ZGV2KTsKIAlwcGRhdGEgPSAmcGRhdGEt
PnBvcnRbcG9ydCAtIFBPUlRfQl07CiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmcGRhdGEtPmxwZV9h
dWRpb19zbG9jaywgaXJxZmxhZ3MpOwpAQCAtMzU3LDcgKzM1Nyw3IEBAIHZvaWQgaW50ZWxfbHBl
X2F1ZGlvX25vdGlmeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogCiAJ
aWYgKHBkYXRhLT5ub3RpZnlfYXVkaW9fbHBlKQotCQlwZGF0YS0+bm90aWZ5X2F1ZGlvX2xwZShk
ZXZfcHJpdi0+bHBlX2F1ZGlvLnBsYXRkZXYsIHBvcnQgLSBQT1JUX0IpOworCQlwZGF0YS0+bm90
aWZ5X2F1ZGlvX2xwZShpOTE1LT5scGVfYXVkaW8ucGxhdGRldiwgcG9ydCAtIFBPUlRfQik7CiAK
IAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwZGF0YS0+bHBlX2F1ZGlvX3Nsb2NrLCBpcnFmbGFn
cyk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9scGVfYXVkaW8u
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2xwZV9hdWRpby5oCmluZGV4IGY4NDhjNTAz
ODcxNC4uZGY0M2FiY2UzYzk1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9scGVfYXVkaW8uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9scGVfYXVkaW8u
aApAQCAtMTIsMTAgKzEyLDEwIEBAIGVudW0gcGlwZTsKIGVudW0gcG9ydDsKIHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlOwogCi1pbnQgIGludGVsX2xwZV9hdWRpb19pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX2xwZV9hdWRpb190ZWFyZG93bihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9scGVfYXVkaW9faXJx
X2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxf
bHBlX2F1ZGlvX25vdGlmeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnQg
IGludGVsX2xwZV9hdWRpb19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3Zv
aWQgaW50ZWxfbHBlX2F1ZGlvX3RlYXJkb3duKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KTsKK3ZvaWQgaW50ZWxfbHBlX2F1ZGlvX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfbHBlX2F1ZGlvX25vdGlmeShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCSAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwb3J0IHBvcnQsCiAJ
CQkgICAgY29uc3Qgdm9pZCAqZWxkLCBpbnQgbHNfY2xvY2ssIGJvb2wgZHBfb3V0cHV0KTsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHNwY29uLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9sc3Bjb24uYwppbmRleCA3MDI4ZDBjZjNiYjEuLjY5NTQ2NWY5
NzE5NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHNwY29uLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbHNwY29uLmMKQEAgLTU1NSwxMCArNTU1LDEw
IEBAIGJvb2wgbHNwY29uX2luaXQoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGln
X3BvcnQpCiAJc3RydWN0IGludGVsX2RwICpkcCA9ICZpbnRlbF9kaWdfcG9ydC0+ZHA7CiAJc3Ry
dWN0IGludGVsX2xzcGNvbiAqbHNwY29uID0gJmludGVsX2RpZ19wb3J0LT5sc3Bjb247CiAJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IGludGVsX2RpZ19wb3J0LT5iYXNlLmJhc2UuZGV2OwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yID0gJmRwLT5hdHRhY2hlZF9jb25uZWN0b3ItPmJhc2U7CiAKLQlpZiAo
IUhBU19MU1BDT04oZGV2X3ByaXYpKSB7CisJaWYgKCFIQVNfTFNQQ09OKGk5MTUpKSB7CiAJCURS
TV9FUlJPUigiTFNQQ09OIGlzIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBwbGF0Zm9ybVxuIik7CiAJ
CXJldHVybiBmYWxzZTsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9sdmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9sdmRzLmMKaW5kZXggZWZlZmVk
NjJhN2Y4Li4wNDA1Zjk4MzQ4MjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2x2ZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9sdmRzLmMKQEAgLTgw
LDcgKzgwLDcgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9sdmRzX2VuY29kZXIgKnRvX2x2ZHNfZW5j
b2RlcihzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIpCiAJcmV0dXJuIGNvbnRhaW5lcl9vZihl
bmNvZGVyLCBzdHJ1Y3QgaW50ZWxfbHZkc19lbmNvZGVyLCBiYXNlLmJhc2UpOwogfQogCi1ib29s
IGludGVsX2x2ZHNfcG9ydF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK2Jvb2wgaW50ZWxfbHZkc19wb3J0X2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkgICAgIGk5MTVfcmVnX3QgbHZkc19yZWcsIGVudW0gcGlwZSAqcGlwZSkKIHsK
IAl1MzIgdmFsOwpAQCAtODgsNyArODgsNyBAQCBib29sIGludGVsX2x2ZHNfcG9ydF9lbmFibGVk
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl2YWwgPSBJOTE1X1JFQUQobHZk
c19yZWcpOwogCiAJLyogYXNzZXJ0cyB3YW50IHRvIGtub3cgdGhlIHBpcGUgZXZlbiBpZiB0aGUg
cG9ydCBpcyBkaXNhYmxlZCAqLwotCWlmIChIQVNfUENIX0NQVChkZXZfcHJpdikpCisJaWYgKEhB
U19QQ0hfQ1BUKGk5MTUpKQogCQkqcGlwZSA9ICh2YWwgJiBMVkRTX1BJUEVfU0VMX01BU0tfQ1BU
KSA+PiBMVkRTX1BJUEVfU0VMX1NISUZUX0NQVDsKIAllbHNlCiAJCSpwaXBlID0gKHZhbCAmIExW
RFNfUElQRV9TRUxfTUFTSykgPj4gTFZEU19QSVBFX1NFTF9TSElGVDsKQEAgLTk5LDE5ICs5OSwx
OSBAQCBib29sIGludGVsX2x2ZHNfcG9ydF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIHN0YXRpYyBib29sIGludGVsX2x2ZHNfZ2V0X2h3X3N0YXRlKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgICBlbnVtIHBpcGUgKnBpcGUpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfbHZkc19lbmNvZGVyICpsdmRzX2VuY29kZXIgPSB0b19s
dmRzX2VuY29kZXIoJmVuY29kZXItPmJhc2UpOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwog
CWJvb2wgcmV0OwogCi0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJs
ZWQoZGV2X3ByaXYsCisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJs
ZWQoaTkxNSwKIAkJCQkJCSAgICAgZW5jb2Rlci0+cG93ZXJfZG9tYWluKTsKIAlpZiAoIXdha2Vy
ZWYpCiAJCXJldHVybiBmYWxzZTsKIAotCXJldCA9IGludGVsX2x2ZHNfcG9ydF9lbmFibGVkKGRl
dl9wcml2LCBsdmRzX2VuY29kZXItPnJlZywgcGlwZSk7CisJcmV0ID0gaW50ZWxfbHZkc19wb3J0
X2VuYWJsZWQoaTkxNSwgbHZkc19lbmNvZGVyLT5yZWcsIHBpcGUpOwogCi0JaW50ZWxfZGlzcGxh
eV9wb3dlcl9wdXQoZGV2X3ByaXYsIGVuY29kZXItPnBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CisJ
aW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgZW5jb2Rlci0+cG93ZXJfZG9tYWluLCB3YWtl
cmVmKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC0xMTksNyArMTE5LDcgQEAgc3RhdGljIGJvb2wg
aW50ZWxfbHZkc19nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiBz
dGF0aWMgdm9pZCBpbnRlbF9sdmRzX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfbHZkc19lbmNvZGVyICpsdmRzX2VuY29kZXIgPSB0
b19sdmRzX2VuY29kZXIoJmVuY29kZXItPmJhc2UpOwogCXUzMiB0bXAsIGZsYWdzID0gMDsKIApA
QCAtMTM3LDEyICsxMzcsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfbHZkc19nZXRfY29uZmlnKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNSkK
KwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNSkKIAkJcGlwZV9jb25maWctPmdtY2hfcGZpdC5sdmRz
X2JvcmRlcl9iaXRzID0KIAkJCXRtcCAmIExWRFNfQk9SREVSX0VOQUJMRTsKIAogCS8qIGdlbjIv
MyBzdG9yZSBkaXRoZXIgc3RhdGUgaW4gcGZpdCBjb250cm9sLCBuZWVkcyB0byBtYXRjaCAqLwot
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA0
KSB7CiAJCXRtcCA9IEk5MTVfUkVBRChQRklUX0NPTlRST0wpOwogCiAJCXBpcGVfY29uZmlnLT5n
bWNoX3BmaXQuY29udHJvbCB8PSB0bXAgJiBQQU5FTF84VE82X0RJVEhFUl9FTkFCTEU7CkBAIC0x
NTEsNyArMTUxLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbHZkc19nZXRfY29uZmlnKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUu
Y3J0Y19jbG9jayA9IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOwogfQogCi1zdGF0aWMgdm9pZCBp
bnRlbF9sdmRzX3Bwc19nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAorc3RhdGljIHZvaWQgaW50ZWxfbHZkc19wcHNfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCQlzdHJ1Y3QgaW50ZWxfbHZkc19wcHMgKnBwcykKIHsK
IAl1MzIgdmFsOwpAQCAtMTgwLDcgKzE4MCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2x2ZHNfcHBz
X2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJLyogQ29u
dmVydCBmcm9tIDEwMG1zIHRvIDEwMHVzIHVuaXRzICovCiAJcHBzLT50NCA9IHZhbCAqIDEwMDA7
CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8PSA0ICYmCisJaWYgKElOVEVMX0dFTihpOTE1
KSA8PSA0ICYmCiAJICAgIHBwcy0+dDFfdDIgPT0gMCAmJiBwcHMtPnQ1ID09IDAgJiYgcHBzLT50
MyA9PSAwICYmIHBwcy0+dHggPT0gMCkgewogCQlEUk1fREVCVUdfS01TKCJQYW5lbCBwb3dlciB0
aW1pbmdzIHVuaW5pdGlhbGl6ZWQsICIKIAkJCSAgICAgICJzZXR0aW5nIGRlZmF1bHRzXG4iKTsK
QEAgLTE5OCw3ICsxOTgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9sdmRzX3Bwc19nZXRfaHdfc3Rh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJIHBwcy0+ZGl2aWRlciwg
cHBzLT5wb3J0LCBwcHMtPnBvd2VyZG93bl9vbl9yZXNldCk7CiB9CiAKLXN0YXRpYyB2b2lkIGlu
dGVsX2x2ZHNfcHBzX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgaW50ZWxfbHZkc19wcHNfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfbHZkc19wcHMgKnBwcykKIHsKIAl1MzIgdmFs
OwpAQCAtMjI5LDI2ICsyMjksMjYgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJlX2VuYWJsZV9sdmRz
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2x2ZHNfZW5jb2Rl
ciAqbHZkc19lbmNvZGVyID0gdG9fbHZkc19lbmNvZGVyKCZlbmNvZGVyLT5iYXNlKTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2Nv
bmZpZy0+YmFzZS5jcnRjKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0
ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOwogCWludCBwaXBlID0g
Y3J0Yy0+cGlwZTsKIAl1MzIgdGVtcDsKIAotCWlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkg
ewotCQlhc3NlcnRfZmRpX3J4X3BsbF9kaXNhYmxlZChkZXZfcHJpdiwgcGlwZSk7Ci0JCWFzc2Vy
dF9zaGFyZWRfZHBsbF9kaXNhYmxlZChkZXZfcHJpdiwKKwlpZiAoSEFTX1BDSF9TUExJVChpOTE1
KSkgeworCQlhc3NlcnRfZmRpX3J4X3BsbF9kaXNhYmxlZChpOTE1LCBwaXBlKTsKKwkJYXNzZXJ0
X3NoYXJlZF9kcGxsX2Rpc2FibGVkKGk5MTUsCiAJCQkJCSAgICBwaXBlX2NvbmZpZy0+c2hhcmVk
X2RwbGwpOwogCX0gZWxzZSB7Ci0JCWFzc2VydF9wbGxfZGlzYWJsZWQoZGV2X3ByaXYsIHBpcGUp
OworCQlhc3NlcnRfcGxsX2Rpc2FibGVkKGk5MTUsIHBpcGUpOwogCX0KIAotCWludGVsX2x2ZHNf
cHBzX2luaXRfaHcoZGV2X3ByaXYsICZsdmRzX2VuY29kZXItPmluaXRfcHBzKTsKKwlpbnRlbF9s
dmRzX3Bwc19pbml0X2h3KGk5MTUsICZsdmRzX2VuY29kZXItPmluaXRfcHBzKTsKIAogCXRlbXAg
PSBsdmRzX2VuY29kZXItPmluaXRfbHZkc192YWw7CiAJdGVtcCB8PSBMVkRTX1BPUlRfRU4gfCBM
VkRTX0EwQTJfQ0xLQV9QT1dFUl9VUDsKIAotCWlmIChIQVNfUENIX0NQVChkZXZfcHJpdikpIHsK
KwlpZiAoSEFTX1BDSF9DUFQoaTkxNSkpIHsKIAkJdGVtcCAmPSB+TFZEU19QSVBFX1NFTF9NQVNL
X0NQVDsKIAkJdGVtcCB8PSBMVkRTX1BJUEVfU0VMX0NQVChwaXBlKTsKIAl9IGVsc2UgewpAQCAt
MjgzLDcgKzI4Myw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByZV9lbmFibGVfbHZkcyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkgKiBzcGVjaWFsIGx2ZHMgZGl0aGVyIGNvbnRyb2wg
Yml0IG9uIHBjaC1zcGxpdCBwbGF0Zm9ybXMsIGRpdGhlcmluZyBpcwogCSAqIG9ubHkgY29udHJv
bGxlZCB0aHJvdWdoIHRoZSBQSVBFQ09ORiByZWcuCiAJICovCi0JaWYgKElTX0dFTihkZXZfcHJp
diwgNCkpIHsKKwlpZiAoSVNfR0VOKGk5MTUsIDQpKSB7CiAJCS8qCiAJCSAqIEJzcGVjIHdvcmRp
bmcgc3VnZ2VzdHMgdGhhdCBMVkRTIHBvcnQgZGl0aGVyaW5nIG9ubHkgZXhpc3RzCiAJCSAqIGZv
ciAxOGJwcCBwYW5lbHMuCkBAIC0zMTEsMTQgKzMxMSwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9l
bmFibGVfbHZkcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gZW5jb2Rlci0+YmFzZS5kZXY7CiAJc3RydWN0IGludGVsX2x2ZHNfZW5j
b2RlciAqbHZkc19lbmNvZGVyID0gdG9fbHZkc19lbmNvZGVyKCZlbmNvZGVyLT5iYXNlKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAKIAlJOTE1X1dSSVRFKGx2
ZHNfZW5jb2Rlci0+cmVnLCBJOTE1X1JFQUQobHZkc19lbmNvZGVyLT5yZWcpIHwgTFZEU19QT1JU
X0VOKTsKIAogCUk5MTVfV1JJVEUoUFBfQ09OVFJPTCgwKSwgSTkxNV9SRUFEKFBQX0NPTlRST0wo
MCkpIHwgUEFORUxfUE9XRVJfT04pOwogCVBPU1RJTkdfUkVBRChsdmRzX2VuY29kZXItPnJlZyk7
CiAKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYg
KGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIFBQX1NUQVRV
UygwKSwgUFBfT04sIFBQX09OLCA1MDAwKSkKIAkJRFJNX0VSUk9SKCJ0aW1lZCBvdXQgd2FpdGlu
ZyBmb3IgcGFuZWwgdG8gcG93ZXIgb25cbiIpOwogCkBAIC0zMzAsMTAgKzMzMCwxMCBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9kaXNhYmxlX2x2ZHMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0
YXRlKQogewogCXN0cnVjdCBpbnRlbF9sdmRzX2VuY29kZXIgKmx2ZHNfZW5jb2RlciA9IHRvX2x2
ZHNfZW5jb2RlcigmZW5jb2Rlci0+YmFzZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAogCUk5MTVfV1JJVEUo
UFBfQ09OVFJPTCgwKSwgSTkxNV9SRUFEKFBQX0NPTlRST0woMCkpICYgflBBTkVMX1BPV0VSX09O
KTsKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYg
KGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIFBQX1NUQVRV
UygwKSwgUFBfT04sIDAsIDEwMDApKQogCQlEUk1fRVJST1IoInRpbWVkIG91dCB3YWl0aW5nIGZv
ciBwYW5lbCB0byBwb3dlciBvZmZcbiIpOwogCkBAIC0zODksNyArMzg5LDcgQEAgc3RhdGljIGlu
dCBpbnRlbF9sdmRzX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9l
bmNvZGVyLAogCQkJCSAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAog
CQkJCSAgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9lbmNvZGVyLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGludGVs
X2VuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfbHZkc19lbmNvZGVyICpsdmRzX2Vu
Y29kZXIgPQogCQl0b19sdmRzX2VuY29kZXIoJmludGVsX2VuY29kZXItPmJhc2UpOwogCXN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5lY3RvciA9CkBAIC0zOTksNyArMzk5LDcgQEAg
c3RhdGljIGludCBpbnRlbF9sdmRzX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICppbnRlbF9lbmNvZGVyLAogCXVuc2lnbmVkIGludCBsdmRzX2JwcDsKIAogCS8qIFNob3VsZCBu
ZXZlciBoYXBwZW4hISAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCAmJiBpbnRlbF9j
cnRjLT5waXBlID09IDApIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNCAmJiBpbnRlbF9jcnRj
LT5waXBlID09IDApIHsKIAkJRFJNX0VSUk9SKCJDYW4ndCBzdXBwb3J0IExWRFMgb24gcGlwZSBB
XG4iKTsKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQpAQCAtNDI5LDcgKzQyOSw3IEBAIHN0YXRpYyBp
bnQgaW50ZWxfbHZkc19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxf
ZW5jb2RlciwKIAlpZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0RCTFND
QU4pCiAJCXJldHVybiAtRUlOVkFMOwogCi0JaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKSB7
CisJaWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkpIHsKIAkJcGlwZV9jb25maWctPmhhc19wY2hfZW5j
b2RlciA9IHRydWU7CiAKIAkJaW50ZWxfcGNoX3BhbmVsX2ZpdHRpbmcoaW50ZWxfY3J0YywgcGlw
ZV9jb25maWcsCkBAIC03NTEsMTEgKzc1MSwxMSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRtaV9z
eXN0ZW1faWQgaW50ZWxfZHVhbF9saW5rX2x2ZHNbXSA9IHsKIAl7IH0JLyogdGVybWluYXRpbmcg
ZW50cnkgKi8KIH07CiAKLXN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9nZXRfbHZkc19lbmNv
ZGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0cnVjdCBpbnRlbF9lbmNv
ZGVyICppbnRlbF9nZXRfbHZkc19lbmNvZGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCi0JZm9yX2VhY2hfaW50ZWxf
ZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgeworCWZvcl9lYWNoX2ludGVsX2VuY29k
ZXIoJmk5MTUtPmRybSwgZW5jb2RlcikgewogCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9P
VVRQVVRfTFZEUykKIAkJCXJldHVybiBlbmNvZGVyOwogCX0KQEAgLTc2Myw5ICs3NjMsOSBAQCBz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZ2V0X2x2ZHNfZW5jb2RlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIE5VTEw7CiB9CiAKLWJvb2wgaW50ZWxfaXNf
ZHVhbF9saW5rX2x2ZHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorYm9vbCBp
bnRlbF9pc19kdWFsX2xpbmtfbHZkcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9IGludGVsX2dldF9sdmRzX2VuY29kZXIo
ZGV2X3ByaXYpOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0gaW50ZWxfZ2V0X2x2
ZHNfZW5jb2RlcihpOTE1KTsKIAogCXJldHVybiBlbmNvZGVyICYmIHRvX2x2ZHNfZW5jb2Rlcigm
ZW5jb2Rlci0+YmFzZSktPmlzX2R1YWxfbGluazsKIH0KQEAgLTc3NCw3ICs3NzQsNyBAQCBzdGF0
aWMgYm9vbCBjb21wdXRlX2lzX2R1YWxfbGlua19sdmRzKHN0cnVjdCBpbnRlbF9sdmRzX2VuY29k
ZXIgKmx2ZHNfZW5jb2RlcikKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gbHZkc19lbmNv
ZGVyLT5iYXNlLmJhc2UuZGV2OwogCXVuc2lnbmVkIGludCB2YWw7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCiAJLyogdXNlIHRoZSBtb2R1bGUgb3B0aW9uIHZh
bHVlIGlmIHNwZWNpZmllZCAqLwogCWlmIChpOTE1X21vZHBhcmFtcy5sdmRzX2NoYW5uZWxfbW9k
ZSA+IDApCkBAIC03OTQsMjYgKzc5NCwyNiBAQCBzdGF0aWMgYm9vbCBjb21wdXRlX2lzX2R1YWxf
bGlua19sdmRzKHN0cnVjdCBpbnRlbF9sdmRzX2VuY29kZXIgKmx2ZHNfZW5jb2RlcikKIAkgKiBy
ZWdpc3RlciBpcyB1bmluaXRpYWxpemVkLgogCSAqLwogCXZhbCA9IEk5MTVfUkVBRChsdmRzX2Vu
Y29kZXItPnJlZyk7Ci0JaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSkKKwlpZiAoSEFTX1BDSF9D
UFQoaTkxNSkpCiAJCXZhbCAmPSB+KExWRFNfREVURUNURUQgfCBMVkRTX1BJUEVfU0VMX01BU0tf
Q1BUKTsKIAllbHNlCiAJCXZhbCAmPSB+KExWRFNfREVURUNURUQgfCBMVkRTX1BJUEVfU0VMX01B
U0spOwogCWlmICh2YWwgPT0gMCkKLQkJdmFsID0gZGV2X3ByaXYtPnZidC5iaW9zX2x2ZHNfdmFs
OworCQl2YWwgPSBpOTE1LT52YnQuYmlvc19sdmRzX3ZhbDsKIAogCXJldHVybiAodmFsICYgTFZE
U19DTEtCX1BPV0VSX01BU0spID09IExWRFNfQ0xLQl9QT1dFUl9VUDsKIH0KIAogLyoqCiAgKiBp
bnRlbF9sdmRzX2luaXQgLSBzZXR1cCBMVkRTIGNvbm5lY3RvcnMgb24gdGhpcyBkZXZpY2UKLSAq
IEBkZXZfcHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICoKICAqIENy
ZWF0ZSB0aGUgY29ubmVjdG9yLCByZWdpc3RlciB0aGUgTFZEUyBEREMgYnVzLCBhbmQgdHJ5IHRv
IGZpZ3VyZSBvdXQgd2hhdAogICogbW9kZXMgd2UgY2FuIGRpc3BsYXkgb24gdGhlIExWRFMgcGFu
ZWwgKGlmIHByZXNlbnQpLgogICovCi12b2lkIGludGVsX2x2ZHNfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2x2ZHNfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2
LT5kcm07CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZpOTE1LT5kcm07CiAJc3RydWN0IGlu
dGVsX2x2ZHNfZW5jb2RlciAqbHZkc19lbmNvZGVyOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICpp
bnRlbF9lbmNvZGVyOwogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcjsK
QEAgLTgyOSwzMCArODI5LDMwIEBAIHZvaWQgaW50ZWxfbHZkc19pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAogCS8qIFNraXAgaW5pdCBvbiBtYWNoaW5lcyB3ZSBrbm93
IGZhbHNlbHkgcmVwb3J0IExWRFMgKi8KIAlpZiAoZG1pX2NoZWNrX3N5c3RlbShpbnRlbF9ub19s
dmRzKSkgewotCQlXQVJOKCFkZXZfcHJpdi0+dmJ0LmludF9sdmRzX3N1cHBvcnQsCisJCVdBUk4o
IWk5MTUtPnZidC5pbnRfbHZkc19zdXBwb3J0LAogCQkgICAgICJVc2VsZXNzIERNSSBtYXRjaC4g
SW50ZXJuYWwgTFZEUyBzdXBwb3J0IGRpc2FibGVkIGJ5IFZCVFxuIik7CiAJCXJldHVybjsKIAl9
CiAKLQlpZiAoIWRldl9wcml2LT52YnQuaW50X2x2ZHNfc3VwcG9ydCkgeworCWlmICghaTkxNS0+
dmJ0LmludF9sdmRzX3N1cHBvcnQpIHsKIAkJRFJNX0RFQlVHX0tNUygiSW50ZXJuYWwgTFZEUyBz
dXBwb3J0IGRpc2FibGVkIGJ5IFZCVFxuIik7CiAJCXJldHVybjsKIAl9CiAKLQlpZiAoSEFTX1BD
SF9TUExJVChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkpCiAJCWx2ZHNfcmVn
ID0gUENIX0xWRFM7CiAJZWxzZQogCQlsdmRzX3JlZyA9IExWRFM7CiAKIAlsdmRzID0gSTkxNV9S
RUFEKGx2ZHNfcmVnKTsKIAotCWlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgeworCWlmIChI
QVNfUENIX1NQTElUKGk5MTUpKSB7CiAJCWlmICgobHZkcyAmIExWRFNfREVURUNURUQpID09IDAp
CiAJCQlyZXR1cm47CiAJfQogCiAJcGluID0gR01CVVNfUElOX1BBTkVMOwotCWlmICghaW50ZWxf
Ymlvc19pc19sdmRzX3ByZXNlbnQoZGV2X3ByaXYsICZwaW4pKSB7CisJaWYgKCFpbnRlbF9iaW9z
X2lzX2x2ZHNfcHJlc2VudChpOTE1LCAmcGluKSkgewogCQlpZiAoKGx2ZHMgJiBMVkRTX1BPUlRf
RU4pID09IDApIHsKIAkJCURSTV9ERUJVR19LTVMoIkxWRFMgaXMgbm90IHByZXNlbnQgaW4gVkJU
XG4iKTsKIAkJCXJldHVybjsKQEAgLTg4NCw3ICs4ODQsNyBAQCB2b2lkIGludGVsX2x2ZHNfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaW50ZWxfZW5jb2Rlci0+ZW5h
YmxlID0gaW50ZWxfZW5hYmxlX2x2ZHM7CiAJaW50ZWxfZW5jb2Rlci0+cHJlX2VuYWJsZSA9IGlu
dGVsX3ByZV9lbmFibGVfbHZkczsKIAlpbnRlbF9lbmNvZGVyLT5jb21wdXRlX2NvbmZpZyA9IGlu
dGVsX2x2ZHNfY29tcHV0ZV9jb25maWc7Ci0JaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKSB7
CisJaWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkpIHsKIAkJaW50ZWxfZW5jb2Rlci0+ZGlzYWJsZSA9
IHBjaF9kaXNhYmxlX2x2ZHM7CiAJCWludGVsX2VuY29kZXItPnBvc3RfZGlzYWJsZSA9IHBjaF9w
b3N0X2Rpc2FibGVfbHZkczsKIAl9IGVsc2UgewpAQCAtOTAxLDkgKzkwMSw5IEBAIHZvaWQgaW50
ZWxfbHZkc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpbnRlbF9l
bmNvZGVyLT5wb3dlcl9kb21haW4gPSBQT1dFUl9ET01BSU5fUE9SVF9PVEhFUjsKIAlpbnRlbF9l
bmNvZGVyLT5wb3J0ID0gUE9SVF9OT05FOwogCWludGVsX2VuY29kZXItPmNsb25lYWJsZSA9IDA7
Ci0JaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKQorCWlmIChIQVNfUENIX1NQTElUKGk5MTUp
KQogCQlpbnRlbF9lbmNvZGVyLT5jcnRjX21hc2sgPSAoMSA8PCAwKSB8ICgxIDw8IDEpIHwgKDEg
PDwgMik7Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA0KSkKKwllbHNlIGlmIChJU19HRU4o
aTkxNSwgNCkpCiAJCWludGVsX2VuY29kZXItPmNydGNfbWFzayA9ICgxIDw8IDApIHwgKDEgPDwg
MSk7CiAJZWxzZQogCQlpbnRlbF9lbmNvZGVyLT5jcnRjX21hc2sgPSAoMSA8PCAxKTsKQEAgLTky
Miw3ICs5MjIsNyBAQCB2b2lkIGludGVsX2x2ZHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJZHJtX2Nvbm5lY3Rvcl9hdHRhY2hfc2NhbGluZ19tb2RlX3Byb3BlcnR5
KGNvbm5lY3RvciwgYWxsb3dlZF9zY2FsZXJzKTsKIAljb25uZWN0b3ItPnN0YXRlLT5zY2FsaW5n
X21vZGUgPSBEUk1fTU9ERV9TQ0FMRV9BU1BFQ1Q7CiAKLQlpbnRlbF9sdmRzX3Bwc19nZXRfaHdf
c3RhdGUoZGV2X3ByaXYsICZsdmRzX2VuY29kZXItPmluaXRfcHBzKTsKKwlpbnRlbF9sdmRzX3Bw
c19nZXRfaHdfc3RhdGUoaTkxNSwgJmx2ZHNfZW5jb2Rlci0+aW5pdF9wcHMpOwogCWx2ZHNfZW5j
b2Rlci0+aW5pdF9sdmRzX3ZhbCA9IGx2ZHM7CiAKIAkvKgpAQCAtOTQwLDEwICs5NDAsMTAgQEAg
dm9pZCBpbnRlbF9sdmRzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CW11dGV4X2xvY2soJmRldi0+bW9kZV9jb25maWcubXV0ZXgpOwogCWlmICh2Z2Ffc3dpdGNoZXJv
b19oYW5kbGVyX2ZsYWdzKCkgJiBWR0FfU1dJVENIRVJPT19DQU5fU1dJVENIX0REQykKIAkJZWRp
ZCA9IGRybV9nZXRfZWRpZF9zd2l0Y2hlcm9vKGNvbm5lY3RvciwKLQkJCQkgICAgaW50ZWxfZ21i
dXNfZ2V0X2FkYXB0ZXIoZGV2X3ByaXYsIHBpbikpOworCQkJCSAgICBpbnRlbF9nbWJ1c19nZXRf
YWRhcHRlcihpOTE1LCBwaW4pKTsKIAllbHNlCiAJCWVkaWQgPSBkcm1fZ2V0X2VkaWQoY29ubmVj
dG9yLAotCQkJCSAgICBpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihkZXZfcHJpdiwgcGluKSk7CisJ
CQkJICAgIGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGk5MTUsIHBpbikpOwogCWlmIChlZGlkKSB7
CiAJCWlmIChkcm1fYWRkX2VkaWRfbW9kZXMoY29ubmVjdG9yLCBlZGlkKSkgewogCQkJZHJtX2Nv
bm5lY3Rvcl91cGRhdGVfZWRpZF9wcm9wZXJ0eShjb25uZWN0b3IsCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9sdmRzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9sdmRzLmgKaW5kZXggYmM5YzhiODRiYTJmLi40YWZkY2I0ZDYzNTIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2x2ZHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9sdmRzLmgKQEAgLTEzLDEwICsxMywxMCBAQAogZW51bSBwaXBlOwogc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGU7CiAKLWJvb2wgaW50ZWxfbHZkc19wb3J0X2VuYWJsZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorYm9vbCBpbnRlbF9sdmRzX3BvcnRfZW5hYmxlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgaTkxNV9yZWdfdCBsdmRzX3Jl
ZywgZW51bSBwaXBlICpwaXBlKTsKLXZvaWQgaW50ZWxfbHZkc19pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Ci1zdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZ2V0X2x2
ZHNfZW5jb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotYm9vbCBpbnRl
bF9pc19kdWFsX2xpbmtfbHZkcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwor
dm9pZCBpbnRlbF9sdmRzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworc3Ry
dWN0IGludGVsX2VuY29kZXIgKmludGVsX2dldF9sdmRzX2VuY29kZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOworYm9vbCBpbnRlbF9pc19kdWFsX2xpbmtfbHZkcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZiAvKiBfX0lOVEVMX0xWRFNfSF9fICovCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9vcHJlZ2lvbi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ByZWdpb24uYwppbmRleCA4ZmExMTU5ZDA5N2YuLjZjYmU3
NzVkNzUzNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ByZWdpb24u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9vcHJlZ2lvbi5jCkBAIC0yNjYsMTEg
KzI2NiwxMSBAQCBzdHJ1Y3Qgb3ByZWdpb25fYXNsZV9leHQgewogCiAjZGVmaW5lIE1BWF9EU0xQ
CTE1MDAKIAotc3RhdGljIGludCBzd3NjaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitzdGF0aWMgaW50IHN3c2NpKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkg
dTMyIGZ1bmN0aW9uLCB1MzIgcGFybSwgdTMyICpwYXJtX291dCkKIHsKLQlzdHJ1Y3Qgb3ByZWdp
b25fc3dzY2kgKnN3c2NpID0gZGV2X3ByaXYtPm9wcmVnaW9uLnN3c2NpOwotCXN0cnVjdCBwY2lf
ZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBvcHJlZ2lvbl9zd3NjaSAq
c3dzY2kgPSBpOTE1LT5vcHJlZ2lvbi5zd3NjaTsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGk5
MTUtPmRybS5wZGV2OwogCXUzMiBtYWluX2Z1bmN0aW9uLCBzdWJfZnVuY3Rpb24sIHNjaWM7CiAJ
dTE2IHN3c2NpX3ZhbDsKIAl1MzIgZHNscDsKQEAgLTI4NSwxMSArMjg1LDExIEBAIHN0YXRpYyBp
bnQgc3dzY2koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJLyogQ2hlY2sg
aWYgd2UgY2FuIGNhbGwgdGhlIGZ1bmN0aW9uLiBTZWUgc3dzY2lfc2V0dXAgZm9yIGRldGFpbHMu
ICovCiAJaWYgKG1haW5fZnVuY3Rpb24gPT0gU1dTQ0lfU0JDQikgewotCQlpZiAoKGRldl9wcml2
LT5vcHJlZ2lvbi5zd3NjaV9zYmNiX3N1Yl9mdW5jdGlvbnMgJgorCQlpZiAoKGk5MTUtPm9wcmVn
aW9uLnN3c2NpX3NiY2Jfc3ViX2Z1bmN0aW9ucyAmCiAJCSAgICAgKDEgPDwgc3ViX2Z1bmN0aW9u
KSkgPT0gMCkKIAkJCXJldHVybiAtRUlOVkFMOwogCX0gZWxzZSBpZiAobWFpbl9mdW5jdGlvbiA9
PSBTV1NDSV9HQkRBKSB7Ci0JCWlmICgoZGV2X3ByaXYtPm9wcmVnaW9uLnN3c2NpX2diZGFfc3Vi
X2Z1bmN0aW9ucyAmCisJCWlmICgoaTkxNS0+b3ByZWdpb24uc3dzY2lfZ2JkYV9zdWJfZnVuY3Rp
b25zICYKIAkJICAgICAoMSA8PCBzdWJfZnVuY3Rpb24pKSA9PSAwKQogCQkJcmV0dXJuIC1FSU5W
QUw7CiAJfQpAQCAtMzYzLDEzICszNjMsMTMgQEAgc3RhdGljIGludCBzd3NjaShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBpbnQgaW50ZWxfb3ByZWdpb25fbm90aWZ5X2VuY29k
ZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAJCQkJICBib29sIGVuYWJs
ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGludGVs
X2VuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoaW50ZWxfZW5jb2Rlci0+YmFzZS5kZXYpOwogCXUzMiBwYXJtID0gMDsKIAl1MzIgdHlw
ZSA9IDA7CiAJdTMyIHBvcnQ7CiAKIAkvKiBkb24ndCBjYXJlIGFib3V0IG9sZCBzdHVmZiBmb3Ig
bm93ICovCi0JaWYgKCFIQVNfRERJKGRldl9wcml2KSkKKwlpZiAoIUhBU19EREkoaTkxNSkpCiAJ
CXJldHVybiAwOwogCiAJaWYgKGludGVsX2VuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0RT
SSkKQEAgLTQwOSw3ICs0MDksNyBAQCBpbnQgaW50ZWxfb3ByZWdpb25fbm90aWZ5X2VuY29kZXIo
c3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAKIAlwYXJtIHw9IHR5cGUgPDwg
KDE2ICsgcG9ydCAqIDMpOwogCi0JcmV0dXJuIHN3c2NpKGRldl9wcml2LCBTV1NDSV9TQkNCX0RJ
U1BMQVlfUE9XRVJfU1RBVEUsIHBhcm0sIE5VTEwpOworCXJldHVybiBzd3NjaShpOTE1LCBTV1ND
SV9TQkNCX0RJU1BMQVlfUE9XRVJfU1RBVEUsIHBhcm0sIE5VTEwpOwogfQogCiBzdGF0aWMgY29u
c3Qgc3RydWN0IHsKQEAgLTQyMywyOSArNDIzLDI5IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3Qgewog
CXsgUENJX0QzY29sZCwJMHgwNCB9LAogfTsKIAotaW50IGludGVsX29wcmVnaW9uX25vdGlmeV9h
ZGFwdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2ludCBpbnRlbF9vcHJl
Z2lvbl9ub3RpZnlfYWRhcHRlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
IHBjaV9wb3dlcl90IHN0YXRlKQogewogCWludCBpOwogCi0JaWYgKCFIQVNfRERJKGRldl9wcml2
KSkKKwlpZiAoIUhBU19EREkoaTkxNSkpCiAJCXJldHVybiAwOwogCiAJZm9yIChpID0gMDsgaSA8
IEFSUkFZX1NJWkUocG93ZXJfc3RhdGVfbWFwKTsgaSsrKSB7CiAJCWlmIChzdGF0ZSA9PSBwb3dl
cl9zdGF0ZV9tYXBbaV0ucGNpX3Bvd2VyX3N0YXRlKQotCQkJcmV0dXJuIHN3c2NpKGRldl9wcml2
LCBTV1NDSV9TQkNCX0FEQVBURVJfUE9XRVJfU1RBVEUsCisJCQlyZXR1cm4gc3dzY2koaTkxNSwg
U1dTQ0lfU0JDQl9BREFQVEVSX1BPV0VSX1NUQVRFLAogCQkJCSAgICAgcG93ZXJfc3RhdGVfbWFw
W2ldLnBhcm0sIE5VTEwpOwogCX0KIAogCXJldHVybiAtRUlOVkFMOwogfQogCi1zdGF0aWMgdTMy
IGFzbGVfc2V0X2JhY2tsaWdodChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUz
MiBiY2xwKQorc3RhdGljIHUzMiBhc2xlX3NldF9iYWNrbGlnaHQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIHUzMiBiY2xwKQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3RvcjsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOwotCXN0cnVj
dCBvcHJlZ2lvbl9hc2xlICphc2xlID0gZGV2X3ByaXYtPm9wcmVnaW9uLmFzbGU7Ci0Jc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBvcHJlZ2lvbl9hc2xl
ICphc2xlID0gaTkxNS0+b3ByZWdpb24uYXNsZTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
Jmk5MTUtPmRybTsKIAogCURSTV9ERUJVR19EUklWRVIoImJjbHAgPSAweCUwOHhcbiIsIGJjbHAp
OwogCkBAIC00ODAsNyArNDgwLDcgQEAgc3RhdGljIHUzMiBhc2xlX3NldF9iYWNrbGlnaHQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgYmNscCkKIAlyZXR1cm4gMDsKIH0K
IAotc3RhdGljIHUzMiBhc2xlX3NldF9hbHNfaWxsdW0oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LCB1MzIgYWxzaSkKK3N0YXRpYyB1MzIgYXNsZV9zZXRfYWxzX2lsbHVtKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgYWxzaSkKIHsKIAkvKiBhbHNpIGlzIHRoZSBj
dXJyZW50IEFMUyByZWFkaW5nIGluIGx1eC4gMCBpbmRpY2F0ZXMgYmVsb3cgc2Vuc29yCiAJICAg
cmFuZ2UsIDB4ZmZmZiBpbmRpY2F0ZXMgYWJvdmUgc2Vuc29yIHJhbmdlLiAxLTB4ZmZmZSBhcmUg
dmFsaWQgKi8KQEAgLTQ4OCwxMyArNDg4LDEzIEBAIHN0YXRpYyB1MzIgYXNsZV9zZXRfYWxzX2ls
bHVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGFsc2kpCiAJcmV0dXJu
IEFTTENfQUxTX0lMTFVNX0ZBSUxFRDsKIH0KIAotc3RhdGljIHUzMiBhc2xlX3NldF9wd21fZnJl
cShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwZm1iKQorc3RhdGljIHUz
MiBhc2xlX3NldF9wd21fZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHBm
bWIpCiB7CiAJRFJNX0RFQlVHX0RSSVZFUigiUFdNIGZyZXEgaXMgbm90IHN1cHBvcnRlZFxuIik7
CiAJcmV0dXJuIEFTTENfUFdNX0ZSRVFfRkFJTEVEOwogfQogCi1zdGF0aWMgdTMyIGFzbGVfc2V0
X3BmaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcGZpdCkKK3N0YXRp
YyB1MzIgYXNsZV9zZXRfcGZpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHBm
aXQpCiB7CiAJLyogUGFuZWwgZml0dGluZyBpcyBjdXJyZW50bHkgY29udHJvbGxlZCBieSB0aGUg
WCBjb2RlLCBzbyB0aGlzIGlzIGEKIAkgICBub29wIHVudGlsIG1vZGVzZXR0aW5nIHN1cHBvcnQg
d29ya3MgZnVsbHkgKi8KQEAgLTUwMiwxMyArNTAyLDEzIEBAIHN0YXRpYyB1MzIgYXNsZV9zZXRf
cGZpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwZml0KQogCXJldHVy
biBBU0xDX1BGSVRfRkFJTEVEOwogfQogCi1zdGF0aWMgdTMyIGFzbGVfc2V0X3N1cHBvcnRlZF9y
b3RhdGlvbl9hbmdsZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgc3Jv
dCkKK3N0YXRpYyB1MzIgYXNsZV9zZXRfc3VwcG9ydGVkX3JvdGF0aW9uX2FuZ2xlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHNyb3QpCiB7CiAJRFJNX0RFQlVHX0RSSVZFUigi
U1JPVCBpcyBub3Qgc3VwcG9ydGVkXG4iKTsKIAlyZXR1cm4gQVNMQ19ST1RBVElPTl9BTkdMRVNf
RkFJTEVEOwogfQogCi1zdGF0aWMgdTMyIGFzbGVfc2V0X2J1dHRvbl9hcnJheShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBpdWVyKQorc3RhdGljIHUzMiBhc2xlX3NldF9i
dXR0b25fYXJyYXkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBpdWVyKQogewog
CWlmICghaXVlcikKIAkJRFJNX0RFQlVHX0RSSVZFUigiQnV0dG9uIGFycmF5IGV2ZW50IGlzIG5v
dCBzdXBwb3J0ZWQgKG5vdGhpbmcpXG4iKTsKQEAgLTUyNiw3ICs1MjYsNyBAQCBzdGF0aWMgdTMy
IGFzbGVfc2V0X2J1dHRvbl9hcnJheShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IHUzMiBpdWVyKQogCXJldHVybiBBU0xDX0JVVFRPTl9BUlJBWV9GQUlMRUQ7CiB9CiAKLXN0YXRp
YyB1MzIgYXNsZV9zZXRfY29udmVydGlibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1MzIgaXVlcikKK3N0YXRpYyB1MzIgYXNsZV9zZXRfY29udmVydGlibGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBpdWVyKQogewogCWlmIChpdWVyICYgQVNMRV9JVUVS
X0NPTlZFUlRJQkxFKQogCQlEUk1fREVCVUdfRFJJVkVSKCJDb252ZXJ0aWJsZSBpcyBub3Qgc3Vw
cG9ydGVkIChjbGFtc2hlbGwpXG4iKTsKQEAgLTUzNiw3ICs1MzYsNyBAQCBzdGF0aWMgdTMyIGFz
bGVfc2V0X2NvbnZlcnRpYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMy
IGl1ZXIpCiAJcmV0dXJuIEFTTENfQ09OVkVSVElCTEVfRkFJTEVEOwogfQogCi1zdGF0aWMgdTMy
IGFzbGVfc2V0X2RvY2tpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIg
aXVlcikKK3N0YXRpYyB1MzIgYXNsZV9zZXRfZG9ja2luZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgdTMyIGl1ZXIpCiB7CiAJaWYgKGl1ZXIgJiBBU0xFX0lVRVJfRE9DS0lORykKIAkJ
RFJNX0RFQlVHX0RSSVZFUigiRG9ja2luZyBpcyBub3Qgc3VwcG9ydGVkIChkb2NrZWQpXG4iKTsK
QEAgLTU0Niw3ICs1NDYsNyBAQCBzdGF0aWMgdTMyIGFzbGVfc2V0X2RvY2tpbmcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgaXVlcikKIAlyZXR1cm4gQVNMQ19ET0NLSU5H
X0ZBSUxFRDsKIH0KIAotc3RhdGljIHUzMiBhc2xlX2lzY3Rfc3RhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHUzMiBhc2xlX2lzY3Rfc3RhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJRFJNX0RFQlVHX0RSSVZFUigiSVNDVCBpcyBub3Qg
c3VwcG9ydGVkXG4iKTsKIAlyZXR1cm4gQVNMQ19JU0NUX1NUQVRFX0ZBSUxFRDsKQEAgLTU1Niw5
ICs1NTYsOSBAQCBzdGF0aWMgdm9pZCBhc2xlX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQogewogCXN0cnVjdCBpbnRlbF9vcHJlZ2lvbiAqb3ByZWdpb24gPQogCQljb250YWluZXJfb2Yo
d29yaywgc3RydWN0IGludGVsX29wcmVnaW9uLCBhc2xlX3dvcmspOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQog
CQljb250YWluZXJfb2Yob3ByZWdpb24sIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBvcHJlZ2lv
bik7Ci0Jc3RydWN0IG9wcmVnaW9uX2FzbGUgKmFzbGUgPSBkZXZfcHJpdi0+b3ByZWdpb24uYXNs
ZTsKKwlzdHJ1Y3Qgb3ByZWdpb25fYXNsZSAqYXNsZSA9IGk5MTUtPm9wcmVnaW9uLmFzbGU7CiAJ
dTMyIGFzbGNfc3RhdCA9IDA7CiAJdTMyIGFzbGNfcmVxOwogCkBAIC01NzQsNDAgKzU3NCw0MCBA
QCBzdGF0aWMgdm9pZCBhc2xlX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCX0KIAog
CWlmIChhc2xjX3JlcSAmIEFTTENfU0VUX0FMU19JTExVTSkKLQkJYXNsY19zdGF0IHw9IGFzbGVf
c2V0X2Fsc19pbGx1bShkZXZfcHJpdiwgYXNsZS0+YWxzaSk7CisJCWFzbGNfc3RhdCB8PSBhc2xl
X3NldF9hbHNfaWxsdW0oaTkxNSwgYXNsZS0+YWxzaSk7CiAKIAlpZiAoYXNsY19yZXEgJiBBU0xD
X1NFVF9CQUNLTElHSFQpCi0JCWFzbGNfc3RhdCB8PSBhc2xlX3NldF9iYWNrbGlnaHQoZGV2X3By
aXYsIGFzbGUtPmJjbHApOworCQlhc2xjX3N0YXQgfD0gYXNsZV9zZXRfYmFja2xpZ2h0KGk5MTUs
IGFzbGUtPmJjbHApOwogCiAJaWYgKGFzbGNfcmVxICYgQVNMQ19TRVRfUEZJVCkKLQkJYXNsY19z
dGF0IHw9IGFzbGVfc2V0X3BmaXQoZGV2X3ByaXYsIGFzbGUtPnBmaXQpOworCQlhc2xjX3N0YXQg
fD0gYXNsZV9zZXRfcGZpdChpOTE1LCBhc2xlLT5wZml0KTsKIAogCWlmIChhc2xjX3JlcSAmIEFT
TENfU0VUX1BXTV9GUkVRKQotCQlhc2xjX3N0YXQgfD0gYXNsZV9zZXRfcHdtX2ZyZXEoZGV2X3By
aXYsIGFzbGUtPnBmbWIpOworCQlhc2xjX3N0YXQgfD0gYXNsZV9zZXRfcHdtX2ZyZXEoaTkxNSwg
YXNsZS0+cGZtYik7CiAKIAlpZiAoYXNsY19yZXEgJiBBU0xDX1NVUFBPUlRFRF9ST1RBVElPTl9B
TkdMRVMpCi0JCWFzbGNfc3RhdCB8PSBhc2xlX3NldF9zdXBwb3J0ZWRfcm90YXRpb25fYW5nbGVz
KGRldl9wcml2LAorCQlhc2xjX3N0YXQgfD0gYXNsZV9zZXRfc3VwcG9ydGVkX3JvdGF0aW9uX2Fu
Z2xlcyhpOTE1LAogCQkJCQkJCWFzbGUtPnNyb3QpOwogCiAJaWYgKGFzbGNfcmVxICYgQVNMQ19C
VVRUT05fQVJSQVkpCi0JCWFzbGNfc3RhdCB8PSBhc2xlX3NldF9idXR0b25fYXJyYXkoZGV2X3By
aXYsIGFzbGUtPml1ZXIpOworCQlhc2xjX3N0YXQgfD0gYXNsZV9zZXRfYnV0dG9uX2FycmF5KGk5
MTUsIGFzbGUtPml1ZXIpOwogCiAJaWYgKGFzbGNfcmVxICYgQVNMQ19DT05WRVJUSUJMRV9JTkRJ
Q0FUT1IpCi0JCWFzbGNfc3RhdCB8PSBhc2xlX3NldF9jb252ZXJ0aWJsZShkZXZfcHJpdiwgYXNs
ZS0+aXVlcik7CisJCWFzbGNfc3RhdCB8PSBhc2xlX3NldF9jb252ZXJ0aWJsZShpOTE1LCBhc2xl
LT5pdWVyKTsKIAogCWlmIChhc2xjX3JlcSAmIEFTTENfRE9DS0lOR19JTkRJQ0FUT1IpCi0JCWFz
bGNfc3RhdCB8PSBhc2xlX3NldF9kb2NraW5nKGRldl9wcml2LCBhc2xlLT5pdWVyKTsKKwkJYXNs
Y19zdGF0IHw9IGFzbGVfc2V0X2RvY2tpbmcoaTkxNSwgYXNsZS0+aXVlcik7CiAKIAlpZiAoYXNs
Y19yZXEgJiBBU0xDX0lTQ1RfU1RBVEVfQ0hBTkdFKQotCQlhc2xjX3N0YXQgfD0gYXNsZV9pc2N0
X3N0YXRlKGRldl9wcml2KTsKKwkJYXNsY19zdGF0IHw9IGFzbGVfaXNjdF9zdGF0ZShpOTE1KTsK
IAogCWFzbGUtPmFzbGMgPSBhc2xjX3N0YXQ7CiB9CiAKLXZvaWQgaW50ZWxfb3ByZWdpb25fYXNs
ZV9pbnRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfb3By
ZWdpb25fYXNsZV9pbnRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlmIChk
ZXZfcHJpdi0+b3ByZWdpb24uYXNsZSkKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPm9wcmVn
aW9uLmFzbGVfd29yayk7CisJaWYgKGk5MTUtPm9wcmVnaW9uLmFzbGUpCisJCXNjaGVkdWxlX3dv
cmsoJmk5MTUtPm9wcmVnaW9uLmFzbGVfd29yayk7CiB9CiAKICNkZWZpbmUgQUNQSV9FVl9ESVNQ
TEFZX1NXSVRDSCAoMTw8MCkKQEAgLTcwMiw5ICs3MDIsOSBAQCBzdGF0aWMgdTMyIGFjcGlfZGlz
cGxheV90eXBlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAlyZXR1cm4gZGlz
cGxheV90eXBlOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9kaWRsX291dHB1dHMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaW50ZWxfZGlkbF9vdXRwdXRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9vcHJlZ2lv
biAqb3ByZWdpb24gPSAmZGV2X3ByaXYtPm9wcmVnaW9uOworCXN0cnVjdCBpbnRlbF9vcHJlZ2lv
biAqb3ByZWdpb24gPSAmaTkxNS0+b3ByZWdpb247CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3RfaXRlciBjb25uX2l0ZXI7CiAJ
aW50IGkgPSAwLCBtYXhfb3V0cHV0czsKQEAgLTcyMCw3ICs3MjAsNyBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9kaWRsX291dHB1dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCW1h
eF9vdXRwdXRzID0gQVJSQVlfU0laRShvcHJlZ2lvbi0+YWNwaS0+ZGlkbCkgKwogCQlBUlJBWV9T
SVpFKG9wcmVnaW9uLT5hY3BpLT5kaWQyKTsKIAotCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2Jl
Z2luKCZkZXZfcHJpdi0+ZHJtLCAmY29ubl9pdGVyKTsKKwlkcm1fY29ubmVjdG9yX2xpc3RfaXRl
cl9iZWdpbigmaTkxNS0+ZHJtLCAmY29ubl9pdGVyKTsKIAlmb3JfZWFjaF9pbnRlbF9jb25uZWN0
b3JfaXRlcihjb25uZWN0b3IsICZjb25uX2l0ZXIpIHsKIAkJdTMyIGRldmljZV9pZCwgdHlwZTsK
IApAQCAtNzQ5LDkgKzc0OSw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2RpZGxfb3V0cHV0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCXNldF9kaWQob3ByZWdpb24sIGksIDAp
OwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9zZXR1cF9jYWRscyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbnRlbF9zZXR1cF9jYWRscyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfb3ByZWdpb24gKm9wcmVnaW9u
ID0gJmRldl9wcml2LT5vcHJlZ2lvbjsKKwlzdHJ1Y3QgaW50ZWxfb3ByZWdpb24gKm9wcmVnaW9u
ID0gJmk5MTUtPm9wcmVnaW9uOwogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcjsK
IAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOwogCWludCBpID0gMDsK
QEAgLTc2Niw3ICs3NjYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZXR1cF9jYWRscyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogTm90ZSB0aGF0IGludGVybmFsIHBhbmVs
cyBzaG91bGQgYmUgYXQgdGhlIGZyb250IG9mIHRoZSBjb25uZWN0b3IKIAkgKiBsaXN0IGFscmVh
ZHksIGVuc3VyaW5nIHRoZXkncmUgbm90IGxlZnQgb3V0LgogCSAqLwotCWRybV9jb25uZWN0b3Jf
bGlzdF9pdGVyX2JlZ2luKCZkZXZfcHJpdi0+ZHJtLCAmY29ubl9pdGVyKTsKKwlkcm1fY29ubmVj
dG9yX2xpc3RfaXRlcl9iZWdpbigmaTkxNS0+ZHJtLCAmY29ubl9pdGVyKTsKIAlmb3JfZWFjaF9p
bnRlbF9jb25uZWN0b3JfaXRlcihjb25uZWN0b3IsICZjb25uX2l0ZXIpIHsKIAkJaWYgKGkgPj0g
QVJSQVlfU0laRShvcHJlZ2lvbi0+YWNwaS0+Y2FkbCkpCiAJCQlicmVhazsKQEAgLTc3OSw5ICs3
NzksOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZXR1cF9jYWRscyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJCW9wcmVnaW9uLT5hY3BpLT5jYWRsW2ldID0gMDsKIH0KIAotc3Rh
dGljIHZvaWQgc3dzY2lfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIHZvaWQgc3dzY2lfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
Ci0Jc3RydWN0IGludGVsX29wcmVnaW9uICpvcHJlZ2lvbiA9ICZkZXZfcHJpdi0+b3ByZWdpb247
CisJc3RydWN0IGludGVsX29wcmVnaW9uICpvcHJlZ2lvbiA9ICZpOTE1LT5vcHJlZ2lvbjsKIAli
b29sIHJlcXVlc3RlZF9jYWxsYmFja3MgPSBmYWxzZTsKIAl1MzIgdG1wOwogCkBAIC03OTAsNyAr
NzkwLDcgQEAgc3RhdGljIHZvaWQgc3dzY2lfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCW9wcmVnaW9uLT5zd3NjaV9zYmNiX3N1Yl9mdW5jdGlvbnMgPSAxOwogCiAJ
LyogV2UgdXNlIEdCREEgdG8gYXNrIGZvciBzdXBwb3J0ZWQgR0JEQSBjYWxscy4gKi8KLQlpZiAo
c3dzY2koZGV2X3ByaXYsIFNXU0NJX0dCREFfU1VQUE9SVEVEX0NBTExTLCAwLCAmdG1wKSA9PSAw
KSB7CisJaWYgKHN3c2NpKGk5MTUsIFNXU0NJX0dCREFfU1VQUE9SVEVEX0NBTExTLCAwLCAmdG1w
KSA9PSAwKSB7CiAJCS8qIG1ha2UgdGhlIGJpdHMgbWF0Y2ggdGhlIHN1Yi1mdW5jdGlvbiBjb2Rl
cyAqLwogCQl0bXAgPDw9IDE7CiAJCW9wcmVnaW9uLT5zd3NjaV9nYmRhX3N1Yl9mdW5jdGlvbnMg
fD0gdG1wOwpAQCAtODAxLDcgKzgwMSw3IEBAIHN0YXRpYyB2b2lkIHN3c2NpX3NldHVwKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBtdXN0IG5vdCBjYWxsIGludGVyZmFj
ZXMgdGhhdCBhcmUgbm90IHNwZWNpZmljYWxseSByZXF1ZXN0ZWQgYnkgdGhlCiAJICogYmlvcy4K
IAkgKi8KLQlpZiAoc3dzY2koZGV2X3ByaXYsIFNXU0NJX0dCREFfUkVRVUVTVEVEX0NBTExCQUNL
UywgMCwgJnRtcCkgPT0gMCkgeworCWlmIChzd3NjaShpOTE1LCBTV1NDSV9HQkRBX1JFUVVFU1RF
RF9DQUxMQkFDS1MsIDAsICZ0bXApID09IDApIHsKIAkJLyogaGVyZSwgdGhlIGJpdHMgYWxyZWFk
eSBtYXRjaCBzdWItZnVuY3Rpb24gY29kZXMgKi8KIAkJb3ByZWdpb24tPnN3c2NpX3NiY2Jfc3Vi
X2Z1bmN0aW9ucyB8PSB0bXA7CiAJCXJlcXVlc3RlZF9jYWxsYmFja3MgPSB0cnVlOwpAQCAtODEy
LDcgKzgxMiw3IEBAIHN0YXRpYyB2b2lkIHN3c2NpX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAkgKiB0aGUgY2FsbGJhY2sgaXMgX3JlcXVlc3RlZF8uIEJ1dCB3ZSBz
dGlsbCBjYW4ndCBjYWxsIGludGVyZmFjZXMgdGhhdAogCSAqIGFyZSBub3QgcmVxdWVzdGVkLgog
CSAqLwotCWlmIChzd3NjaShkZXZfcHJpdiwgU1dTQ0lfU0JDQl9TVVBQT1JURURfQ0FMTEJBQ0tT
LCAwLCAmdG1wKSA9PSAwKSB7CisJaWYgKHN3c2NpKGk5MTUsIFNXU0NJX1NCQ0JfU1VQUE9SVEVE
X0NBTExCQUNLUywgMCwgJnRtcCkgPT0gMCkgewogCQkvKiBtYWtlIHRoZSBiaXRzIG1hdGNoIHRo
ZSBzdWItZnVuY3Rpb24gY29kZXMgKi8KIAkJdTMyIGxvdyA9IHRtcCAmIDB4N2ZmOwogCQl1MzIg
aGlnaCA9IHRtcCAmIH4weGZmZjsgLyogYml0IDExIGlzIHJlc2VydmVkICovCkBAIC04NTQsOSAr
ODU0LDkgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkbWlfc3lzdGVtX2lkIGludGVsX25vX29wcmVn
aW9uX3ZidFtdID0gewogCXsgfQogfTsKIAotc3RhdGljIGludCBpbnRlbF9sb2FkX3ZidF9maXJt
d2FyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW50IGludGVs
X2xvYWRfdmJ0X2Zpcm13YXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0
cnVjdCBpbnRlbF9vcHJlZ2lvbiAqb3ByZWdpb24gPSAmZGV2X3ByaXYtPm9wcmVnaW9uOworCXN0
cnVjdCBpbnRlbF9vcHJlZ2lvbiAqb3ByZWdpb24gPSAmaTkxNS0+b3ByZWdpb247CiAJY29uc3Qg
c3RydWN0IGZpcm13YXJlICpmdyA9IE5VTEw7CiAJY29uc3QgY2hhciAqbmFtZSA9IGk5MTVfbW9k
cGFyYW1zLnZidF9maXJtd2FyZTsKIAlpbnQgcmV0OwpAQCAtODY0LDcgKzg2NCw3IEBAIHN0YXRp
YyBpbnQgaW50ZWxfbG9hZF92YnRfZmlybXdhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCWlmICghbmFtZSB8fCAhKm5hbWUpCiAJCXJldHVybiAtRU5PRU5UOwogCi0JcmV0
ID0gcmVxdWVzdF9maXJtd2FyZSgmZncsIG5hbWUsICZkZXZfcHJpdi0+ZHJtLnBkZXYtPmRldik7
CisJcmV0ID0gcmVxdWVzdF9maXJtd2FyZSgmZncsIG5hbWUsICZpOTE1LT5kcm0ucGRldi0+ZGV2
KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiUmVxdWVzdGluZyBWQlQgZmlybXdhcmUgXCIl
c1wiIGZhaWxlZCAoJWQpXG4iLAogCQkJICBuYW1lLCByZXQpOwpAQCAtODkxLDEwICs4OTEsMTAg
QEAgc3RhdGljIGludCBpbnRlbF9sb2FkX3ZidF9maXJtd2FyZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIHJldDsKIH0KIAotaW50IGludGVsX29wcmVnaW9uX3Nl
dHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludCBpbnRlbF9vcHJlZ2lv
bl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxf
b3ByZWdpb24gKm9wcmVnaW9uID0gJmRldl9wcml2LT5vcHJlZ2lvbjsKLQlzdHJ1Y3QgcGNpX2Rl
diAqcGRldiA9IGRldl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3QgaW50ZWxfb3ByZWdpb24gKm9w
cmVnaW9uID0gJmk5MTUtPm9wcmVnaW9uOworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+
ZHJtLnBkZXY7CiAJdTMyIGFzbHMsIG1ib3hlczsKIAljaGFyIGJ1ZltzaXplb2YoT1BSRUdJT05f
U0lHTkFUVVJFKV07CiAJaW50IGVyciA9IDA7CkBAIC05NDUsNyArOTQ1LDcgQEAgaW50IGludGVs
X29wcmVnaW9uX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpZiAo
bWJveGVzICYgTUJPWF9TV1NDSSkgewogCQlEUk1fREVCVUdfRFJJVkVSKCJTV1NDSSBzdXBwb3J0
ZWRcbiIpOwogCQlvcHJlZ2lvbi0+c3dzY2kgPSBiYXNlICsgT1BSRUdJT05fU1dTQ0lfT0ZGU0VU
OwotCQlzd3NjaV9zZXR1cChkZXZfcHJpdik7CisJCXN3c2NpX3NldHVwKGk5MTUpOwogCX0KIAog
CWlmIChtYm94ZXMgJiBNQk9YX0FTTEUpIHsKQEAgLTk1OCw3ICs5NTgsNyBAQCBpbnQgaW50ZWxf
b3ByZWdpb25fc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWlmICht
Ym94ZXMgJiBNQk9YX0FTTEVfRVhUKQogCQlEUk1fREVCVUdfRFJJVkVSKCJBU0xFIGV4dGVuc2lv
biBzdXBwb3J0ZWRcbiIpOwogCi0JaWYgKGludGVsX2xvYWRfdmJ0X2Zpcm13YXJlKGRldl9wcml2
KSA9PSAwKQorCWlmIChpbnRlbF9sb2FkX3ZidF9maXJtd2FyZShpOTE1KSA9PSAwKQogCQlnb3Rv
IG91dDsKIAogCWlmIChkbWlfY2hlY2tfc3lzdGVtKGludGVsX25vX29wcmVnaW9uX3ZidCkpCkBA
IC0xMDQzLDEyICsxMDQzLDEyIEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZG1pX3N5c3RlbV9pZCBp
bnRlbF91c2Vfb3ByZWdpb25fcGFuZWxfdHlwZVtdID0gewogfTsKIAogaW50Ci1pbnRlbF9vcHJl
Z2lvbl9nZXRfcGFuZWxfdHlwZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitp
bnRlbF9vcHJlZ2lvbl9nZXRfcGFuZWxfdHlwZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAl1MzIgcGFuZWxfZGV0YWlsczsKIAlpbnQgcmV0OwogCi0JcmV0ID0gc3dzY2koZGV2
X3ByaXYsIFNXU0NJX0dCREFfUEFORUxfREVUQUlMUywgMHgwLCAmcGFuZWxfZGV0YWlscyk7CisJ
cmV0ID0gc3dzY2koaTkxNSwgU1dTQ0lfR0JEQV9QQU5FTF9ERVRBSUxTLCAweDAsICZwYW5lbF9k
ZXRhaWxzKTsKIAlpZiAocmV0KSB7CiAJCURSTV9ERUJVR19LTVMoIkZhaWxlZCB0byBnZXQgcGFu
ZWwgZGV0YWlscyBmcm9tIE9wUmVnaW9uICglZClcbiIsCiAJCQkgICAgICByZXQpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ByZWdpb24uaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX29wcmVnaW9uLmgKaW5kZXggNGFhNjhmZmJkMzBlLi44ZTBiN2JkZWNi
ZTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX29wcmVnaW9uLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ByZWdpb24uaApAQCAtNTYsNDcgKzU2LDQ3
IEBAIHN0cnVjdCBpbnRlbF9vcHJlZ2lvbiB7CiAKICNpZmRlZiBDT05GSUdfQUNQSQogCi1pbnQg
aW50ZWxfb3ByZWdpb25fc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsK
K2ludCBpbnRlbF9vcHJlZ2lvbl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7
CiAKLXZvaWQgaW50ZWxfb3ByZWdpb25fcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKLXZvaWQgaW50ZWxfb3ByZWdpb25fdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9vcHJlZ2lvbl9yZWdpc3RlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX29wcmVnaW9uX3VucmVnaXN0
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCi12b2lkIGludGVsX29wcmVnaW9u
X3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9v
cHJlZ2lvbl9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQg
aW50ZWxfb3ByZWdpb25fcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3Zv
aWQgaW50ZWxfb3ByZWdpb25fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgICBwY2lfcG93ZXJfdCBzdGF0ZSk7CiAKLXZvaWQgaW50ZWxfb3ByZWdpb25fYXNsZV9p
bnRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX29wcmVn
aW9uX2FzbGVfaW50cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBpbnQgaW50ZWxf
b3ByZWdpb25fbm90aWZ5X2VuY29kZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29k
ZXIsCiAJCQkJICBib29sIGVuYWJsZSk7Ci1pbnQgaW50ZWxfb3ByZWdpb25fbm90aWZ5X2FkYXB0
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAoraW50IGludGVsX29wcmVnaW9u
X25vdGlmeV9hZGFwdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgcGNp
X3Bvd2VyX3Qgc3RhdGUpOwotaW50IGludGVsX29wcmVnaW9uX2dldF9wYW5lbF90eXBlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CitpbnQgaW50ZWxfb3ByZWdpb25fZ2V0X3Bh
bmVsX3R5cGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiAjZWxzZSAvKiBDT05G
SUdfQUNQSSovCiAKLXN0YXRpYyBpbmxpbmUgaW50IGludGVsX29wcmVnaW9uX3NldHVwKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbmxpbmUgaW50IGludGVsX29w
cmVnaW9uX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXJldHVybiAw
OwogfQogCi1zdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfb3ByZWdpb25fcmVnaXN0ZXIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGlubGluZSB2b2lkIGludGVsX29w
cmVnaW9uX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogfQogCi1z
dGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfb3ByZWdpb25fdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfb3ByZWdpb25f
dW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIH0KIAotc3RhdGlj
IGlubGluZSB2b2lkIGludGVsX29wcmVnaW9uX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfb3ByZWdpb25fcmVzdW1lKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogfQogCi1zdGF0aWMgaW5saW5lIHZvaWQg
aW50ZWxfb3ByZWdpb25fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfb3ByZWdpb25fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICBwY2lfcG93ZXJfdCBzdGF0ZSkKIHsKIH0KIAotc3Rh
dGljIGlubGluZSB2b2lkIGludGVsX29wcmVnaW9uX2FzbGVfaW50cihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfb3ByZWdpb25fYXNs
ZV9pbnRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogfQogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9vdmVybGF5LmMKaW5kZXggYTJhYzA2YTA4NzE1Li44MDJiYzRjNzJlY2QgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9vdmVybGF5LmMKQEAgLTE5MywxMCArMTkzLDEwIEBAIHN0
cnVjdCBpbnRlbF9vdmVybGF5IHsKIAlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCBsYXN0X2Zs
aXA7CiB9OwogCi1zdGF0aWMgdm9pZCBpODMwX292ZXJsYXlfY2xvY2tfZ2F0aW5nKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGk4MzBfb3ZlcmxheV9jbG9j
a19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgYm9vbCBl
bmFibGUpCiB7Ci0Jc3RydWN0IHBjaV9kZXYgKnBkZXYgPSBkZXZfcHJpdi0+ZHJtLnBkZXY7CisJ
c3RydWN0IHBjaV9kZXYgKnBkZXYgPSBpOTE1LT5kcm0ucGRldjsKIAl1OCB2YWw7CiAKIAkvKiBX
QV9PVkVSTEFZX0NMS0dBVEU6YWxtICovCkBAIC0yNDcsNyArMjQ3LDcgQEAgc3RhdGljIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKmFsbG9jX3JlcXVlc3Qoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJs
YXkpCiAvKiBvdmVybGF5IG5lZWRzIHRvIGJlIGRpc2FibGUgaW4gT0NNRCByZWcgKi8KIHN0YXRp
YyBpbnQgaW50ZWxfb3ZlcmxheV9vbihzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBvdmVybGF5LT5pOTE1OworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gb3ZlcmxheS0+aTkxNTsKIAlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKIAl1MzIgKmNzOwogCkBAIC0yNjUsOCArMjY1LDggQEAgc3RhdGljIGlu
dCBpbnRlbF9vdmVybGF5X29uKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQogCiAJb3Zl
cmxheS0+YWN0aXZlID0gdHJ1ZTsKIAotCWlmIChJU19JODMwKGRldl9wcml2KSkKLQkJaTgzMF9v
dmVybGF5X2Nsb2NrX2dhdGluZyhkZXZfcHJpdiwgZmFsc2UpOworCWlmIChJU19JODMwKGk5MTUp
KQorCQlpODMwX292ZXJsYXlfY2xvY2tfZ2F0aW5nKGk5MTUsIGZhbHNlKTsKIAogCSpjcysrID0g
TUlfT1ZFUkxBWV9GTElQIHwgTUlfT1ZFUkxBWV9PTjsKIAkqY3MrKyA9IG92ZXJsYXktPmZsaXBf
YWRkciB8IE9GQ19VUERBVEU7CkBAIC0zMDMsNyArMzAzLDcgQEAgc3RhdGljIGludCBpbnRlbF9v
dmVybGF5X2NvbnRpbnVlKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCQkJCSAgc3Ry
dWN0IGk5MTVfdm1hICp2bWEsCiAJCQkJICBib29sIGxvYWRfcG9seXBoYXNlX2ZpbHRlcikKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBvdmVybGF5LT5pOTE1OworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gb3ZlcmxheS0+aTkxNTsKIAlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKIAl1MzIgZmxpcF9hZGRyID0gb3ZlcmxheS0+ZmxpcF9hZGRyOwogCXUz
MiB0bXAsICpjczsKQEAgLTM2OSw3ICszNjksNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9vdmVybGF5
X29mZl90YWlsKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiB7CiAJc3RydWN0
IGludGVsX292ZXJsYXkgKm92ZXJsYXkgPQogCQljb250YWluZXJfb2YoYWN0aXZlLCB0eXBlb2Yo
Km92ZXJsYXkpLCBsYXN0X2ZsaXApOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IG92ZXJsYXktPmk5MTU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBvdmVy
bGF5LT5pOTE1OwogCiAJaW50ZWxfb3ZlcmxheV9yZWxlYXNlX29sZF92bWEob3ZlcmxheSk7CiAK
QEAgLTM3Nyw4ICszNzcsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9vdmVybGF5X29mZl90YWlsKHN0
cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAJb3ZlcmxheS0+Y3J0YyA9IE5VTEw7
CiAJb3ZlcmxheS0+YWN0aXZlID0gZmFsc2U7CiAKLQlpZiAoSVNfSTgzMChkZXZfcHJpdikpCi0J
CWk4MzBfb3ZlcmxheV9jbG9ja19nYXRpbmcoZGV2X3ByaXYsIHRydWUpOworCWlmIChJU19JODMw
KGk5MTUpKQorCQlpODMwX292ZXJsYXlfY2xvY2tfZ2F0aW5nKGk5MTUsIHRydWUpOwogfQogCiAv
KiBvdmVybGF5IG5lZWRzIHRvIGJlIGRpc2FibGVkIGluIE9DTUQgcmVnICovCkBAIC00MzcsMTEg
KzQzNywxMSBAQCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfcmVjb3Zlcl9mcm9tX2ludGVycnVw
dChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSkKICAqLwogc3RhdGljIGludCBpbnRlbF9v
dmVybGF5X3JlbGVhc2Vfb2xkX3ZpZChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBvdmVybGF5LT5pOTE1OworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gb3ZlcmxheS0+aTkxNTsKIAl1MzIgKmNzOwog
CWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAK
IAkvKiBPbmx5IHdhaXQgaWYgdGhlcmUgaXMgYWN0dWFsbHkgYW4gb2xkIGZyYW1lIHRvIHJlbGVh
c2UgdG8KIAkgKiBndWFyYW50ZWUgZm9yd2FyZCBwcm9ncmVzcy4KQEAgLTQ3Nyw5ICs0NzcsOSBA
QCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfcmVsZWFzZV9vbGRfdmlkKHN0cnVjdCBpbnRlbF9v
dmVybGF5ICpvdmVybGF5KQogCXJldHVybiAwOwogfQogCi12b2lkIGludGVsX292ZXJsYXlfcmVz
ZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9vdmVybGF5
X3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9v
dmVybGF5ICpvdmVybGF5ID0gZGV2X3ByaXYtPm92ZXJsYXk7CisJc3RydWN0IGludGVsX292ZXJs
YXkgKm92ZXJsYXkgPSBpOTE1LT5vdmVybGF5OwogCiAJaWYgKCFvdmVybGF5KQogCQlyZXR1cm47
CkBAIC01NDAsMTEgKzU0MCwxMSBAQCBzdGF0aWMgaW50IHV2X3ZzdWJzYW1wbGluZyh1MzIgZm9y
bWF0KQogCX0KIH0KIAotc3RhdGljIHUzMiBjYWxjX3N3aWR0aHN3KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgdTMyIG9mZnNldCwgdTMyIHdpZHRoKQorc3RhdGljIHUzMiBjYWxj
X3N3aWR0aHN3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgb2Zmc2V0LCB1MzIg
d2lkdGgpCiB7CiAJdTMyIHN3OwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgMikpCisJaWYgKElT
X0dFTihpOTE1LCAyKSkKIAkJc3cgPSBBTElHTigob2Zmc2V0ICYgMzEpICsgd2lkdGgsIDMyKTsK
IAllbHNlCiAJCXN3ID0gQUxJR04oKG9mZnNldCAmIDYzKSArIHdpZHRoLCA2NCk7CkBAIC03NDks
MjEgKzc0OSwyMSBAQCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfZG9fcHV0X2ltYWdlKHN0cnVj
dCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCQkJCSAgICAgIHN0cnVjdCBkcm1faW50ZWxfb3Zl
cmxheV9wdXRfaW1hZ2UgKnBhcmFtcykKIHsKIAlzdHJ1Y3Qgb3ZlcmxheV9yZWdpc3RlcnMgX19p
b21lbSAqcmVncyA9IG92ZXJsYXktPnJlZ3M7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gb3ZlcmxheS0+aTkxNTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IG92ZXJsYXktPmk5MTU7CiAJdTMyIHN3aWR0aCwgc3dpZHRoc3csIHNoZWlnaHQsIG9zdHJpZGU7
CiAJZW51bSBwaXBlIHBpcGUgPSBvdmVybGF5LT5jcnRjLT5waXBlOwogCWJvb2wgc2NhbGVfY2hh
bmdlZCA9IGZhbHNlOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCByZXQsIHRtcF93aWR0
aDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsK
LQlXQVJOX09OKCFkcm1fbW9kZXNldF9pc19sb2NrZWQoJmRldl9wcml2LT5kcm0ubW9kZV9jb25m
aWcuY29ubmVjdGlvbl9tdXRleCkpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworCVdBUk5fT04oIWRybV9tb2Rlc2V0X2lzX2xvY2tlZCgmaTkxNS0+ZHJt
Lm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0ZXgpKTsKIAogCXJldCA9IGludGVsX292ZXJsYXlf
cmVsZWFzZV9vbGRfdmlkKG92ZXJsYXkpOwogCWlmIChyZXQgIT0gMCkKIAkJcmV0dXJuIHJldDsK
IAotCWF0b21pY19pbmMoJmRldl9wcml2LT5ncHVfZXJyb3IucGVuZGluZ19mYl9waW4pOworCWF0
b21pY19pbmMoJmk5MTUtPmdwdV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7CiAKIAlpOTE1X2dlbV9v
YmplY3RfbG9jayhuZXdfYm8pOwogCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlzcGxh
eV9wbGFuZShuZXdfYm8sCkBAIC03ODMsNyArNzgzLDcgQEAgc3RhdGljIGludCBpbnRlbF9vdmVy
bGF5X2RvX3B1dF9pbWFnZShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAkJdTMyIG9j
b25maWc7CiAKIAkJb2NvbmZpZyA9IE9DT05GX0NDX09VVF84QklUOwotCQlpZiAoSVNfR0VOKGRl
dl9wcml2LCA0KSkKKwkJaWYgKElTX0dFTihpOTE1LCA0KSkKIAkJCW9jb25maWcgfD0gT0NPTkZf
Q1NDX01PREVfQlQ3MDk7CiAJCW9jb25maWcgfD0gcGlwZSA9PSAwID8KIAkJCU9DT05GX1BJUEVf
QSA6IE9DT05GX1BJUEVfQjsKQEAgLTgwNCw3ICs4MDQsNyBAQCBzdGF0aWMgaW50IGludGVsX292
ZXJsYXlfZG9fcHV0X2ltYWdlKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCQl0bXBf
d2lkdGggPSBwYXJhbXMtPnNyY193aWR0aDsKIAogCXN3aWR0aCA9IHBhcmFtcy0+c3JjX3dpZHRo
OwotCXN3aWR0aHN3ID0gY2FsY19zd2lkdGhzdyhkZXZfcHJpdiwgcGFyYW1zLT5vZmZzZXRfWSwg
dG1wX3dpZHRoKTsKKwlzd2lkdGhzdyA9IGNhbGNfc3dpZHRoc3coaTkxNSwgcGFyYW1zLT5vZmZz
ZXRfWSwgdG1wX3dpZHRoKTsKIAlzaGVpZ2h0ID0gcGFyYW1zLT5zcmNfaGVpZ2h0OwogCWlvd3Jp
dGUzMihpOTE1X2dndHRfb2Zmc2V0KHZtYSkgKyBwYXJhbXMtPm9mZnNldF9ZLCAmcmVncy0+T0JV
Rl8wWSk7CiAJb3N0cmlkZSA9IHBhcmFtcy0+c3RyaWRlX1k7CkBAIC04MTcsOSArODE3LDkgQEAg
c3RhdGljIGludCBpbnRlbF9vdmVybGF5X2RvX3B1dF9pbWFnZShzdHJ1Y3QgaW50ZWxfb3Zlcmxh
eSAqb3ZlcmxheSwKIAkJc3dpZHRoIHw9IChwYXJhbXMtPnNyY193aWR0aCAvIHV2X2hzY2FsZSkg
PDwgMTY7CiAJCXNoZWlnaHQgfD0gKHBhcmFtcy0+c3JjX2hlaWdodCAvIHV2X3ZzY2FsZSkgPDwg
MTY7CiAKLQkJdG1wX1UgPSBjYWxjX3N3aWR0aHN3KGRldl9wcml2LCBwYXJhbXMtPm9mZnNldF9V
LAorCQl0bXBfVSA9IGNhbGNfc3dpZHRoc3coaTkxNSwgcGFyYW1zLT5vZmZzZXRfVSwKIAkJCQkg
ICAgICBwYXJhbXMtPnNyY193aWR0aCAvIHV2X2hzY2FsZSk7Ci0JCXRtcF9WID0gY2FsY19zd2lk
dGhzdyhkZXZfcHJpdiwgcGFyYW1zLT5vZmZzZXRfViwKKwkJdG1wX1YgPSBjYWxjX3N3aWR0aHN3
KGk5MTUsIHBhcmFtcy0+b2Zmc2V0X1YsCiAJCQkJICAgICAgcGFyYW1zLT5zcmNfd2lkdGggLyB1
dl9oc2NhbGUpOwogCQlzd2lkdGhzdyB8PSBtYXgodG1wX1UsIHRtcF9WKSA8PCAxNjsKIApAQCAt
ODUxLDE4ICs4NTEsMTggQEAgc3RhdGljIGludCBpbnRlbF9vdmVybGF5X2RvX3B1dF9pbWFnZShz
dHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIG91dF91bnBpbjoKIAlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fZnJvbV9kaXNwbGF5X3BsYW5lKHZtYSk7CiBvdXRfcGluX3NlY3Rpb246Ci0JYXRv
bWljX2RlYygmZGV2X3ByaXYtPmdwdV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7CisJYXRvbWljX2Rl
YygmaTkxNS0+Z3B1X2Vycm9yLnBlbmRpbmdfZmJfcGluKTsKIAogCXJldHVybiByZXQ7CiB9CiAK
IGludCBpbnRlbF9vdmVybGF5X3N3aXRjaF9vZmYoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJs
YXkpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gb3ZlcmxheS0+aTkx
NTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG92ZXJsYXktPmk5MTU7CiAJaW50
IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4
KTsKLQlXQVJOX09OKCFkcm1fbW9kZXNldF9pc19sb2NrZWQoJmRldl9wcml2LT5kcm0ubW9kZV9j
b25maWcuY29ubmVjdGlvbl9tdXRleCkpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCVdBUk5fT04oIWRybV9tb2Rlc2V0X2lzX2xvY2tlZCgmaTkxNS0+
ZHJtLm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0ZXgpKTsKIAogCXJldCA9IGludGVsX292ZXJs
YXlfcmVjb3Zlcl9mcm9tX2ludGVycnVwdChvdmVybGF5KTsKIAlpZiAocmV0ICE9IDApCkBAIC04
OTUsMTQgKzg5NSwxNCBAQCBzdGF0aWMgaW50IGNoZWNrX292ZXJsYXlfcG9zc2libGVfb25fY3J0
YyhzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAogc3RhdGljIHZvaWQgdXBkYXRlX3Bm
aXRfdnNjYWxlX3JhdGlvKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG92ZXJsYXktPmk5MTU7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBvdmVybGF5LT5pOTE1OwogCXUzMiBwZml0X2NvbnRyb2wg
PSBJOTE1X1JFQUQoUEZJVF9DT05UUk9MKTsKIAl1MzIgcmF0aW87CiAKIAkvKiBYWFg6IFRoaXMg
aXMgbm90IHRoZSBzYW1lIGxvZ2ljIGFzIGluIHRoZSB4b3JnIGRyaXZlciwgYnV0IG1vcmUgaW4K
IAkgKiBsaW5lIHdpdGggdGhlIGludGVsIGRvY3VtZW50YXRpb24gZm9yIHRoZSBpOTY1CiAJICov
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkg
Pj0gNCkgewogCQkvKiBvbiBpOTY1IHVzZSB0aGUgUEdNIHJlZyB0byByZWFkIG91dCB0aGUgYXV0
b3NjYWxlciB2YWx1ZXMgKi8KIAkJcmF0aW8gPSBJOTE1X1JFQUQoUEZJVF9QR01fUkFUSU9TKSA+
PiBQRklUX1ZFUlRfU0NBTEVfU0hJRlRfOTY1OwogCX0gZWxzZSB7CkBAIC05NDcsNyArOTQ3LDcg
QEAgc3RhdGljIGludCBjaGVja19vdmVybGF5X3NjYWxpbmcoc3RydWN0IGRybV9pbnRlbF9vdmVy
bGF5X3B1dF9pbWFnZSAqcmVjKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGNoZWNrX292
ZXJsYXlfc3JjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBpbnQg
Y2hlY2tfb3ZlcmxheV9zcmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAg
IHN0cnVjdCBkcm1faW50ZWxfb3ZlcmxheV9wdXRfaW1hZ2UgKnJlYywKIAkJCSAgICAgc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm5ld19ibykKIHsKQEAgLTk1OCw3ICs5NTgsNyBAQCBzdGF0
aWMgaW50IGNoZWNrX292ZXJsYXlfc3JjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAl1MzIgdG1wOwogCiAJLyogY2hlY2sgc3JjIGRpbWVuc2lvbnMgKi8KLQlpZiAoSVNfSTg0
NUcoZGV2X3ByaXYpIHx8IElTX0k4MzAoZGV2X3ByaXYpKSB7CisJaWYgKElTX0k4NDVHKGk5MTUp
IHx8IElTX0k4MzAoaTkxNSkpIHsKIAkJaWYgKHJlYy0+c3JjX2hlaWdodCA+IElNQUdFX01BWF9I
RUlHSFRfTEVHQUNZIHx8CiAJCSAgICByZWMtPnNyY193aWR0aCAgPiBJTUFHRV9NQVhfV0lEVEhf
TEVHQUNZKQogCQkJcmV0dXJuIC1FSU5WQUw7CkBAIC0xMDEwLDE0ICsxMDEwLDE0IEBAIHN0YXRp
YyBpbnQgY2hlY2tfb3ZlcmxheV9zcmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQlyZXR1cm4gLUVJTlZBTDsKIAogCS8qIHN0cmlkZSBjaGVja2luZyAqLwotCWlmIChJU19J
ODMwKGRldl9wcml2KSB8fCBJU19JODQ1RyhkZXZfcHJpdikpCisJaWYgKElTX0k4MzAoaTkxNSkg
fHwgSVNfSTg0NUcoaTkxNSkpCiAJCXN0cmlkZV9tYXNrID0gMjU1OwogCWVsc2UKIAkJc3RyaWRl
X21hc2sgPSA2MzsKIAogCWlmIChyZWMtPnN0cmlkZV9ZICYgc3RyaWRlX21hc2sgfHwgcmVjLT5z
dHJpZGVfVVYgJiBzdHJpZGVfbWFzaykKIAkJcmV0dXJuIC1FSU5WQUw7Ci0JaWYgKElTX0dFTihk
ZXZfcHJpdiwgNCkgJiYgcmVjLT5zdHJpZGVfWSA8IDUxMikKKwlpZiAoSVNfR0VOKGk5MTUsIDQp
ICYmIHJlYy0+c3RyaWRlX1kgPCA1MTIpCiAJCXJldHVybiAtRUlOVkFMOwogCiAJdG1wID0gKHJl
Yy0+ZmxhZ3MgJiBJOTE1X09WRVJMQVlfVFlQRV9NQVNLKSA9PSBJOTE1X09WRVJMQVlfWVVWX1BM
QU5BUiA/CkBAIC0xMDYyLDE0ICsxMDYyLDE0IEBAIGludCBpbnRlbF9vdmVybGF5X3B1dF9pbWFn
ZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQkJCSAgc3RydWN0
IGRybV9maWxlICpmaWxlX3ByaXYpCiB7CiAJc3RydWN0IGRybV9pbnRlbF9vdmVybGF5X3B1dF9p
bWFnZSAqcGFyYW1zID0gZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KGRldik7CiAJc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXk7CiAJc3RydWN0IGRybV9jcnRj
ICpkcm1tb2RlX2NydGM7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm5ld19ibzsKIAlpbnQgcmV0OwogCi0Jb3ZlcmxheSA9IGRldl9wcml2
LT5vdmVybGF5OworCW92ZXJsYXkgPSBpOTE1LT5vdmVybGF5OwogCWlmICghb3ZlcmxheSkgewog
CQlEUk1fREVCVUcoInVzZXJzcGFjZSBidWc6IG5vIG92ZXJsYXlcbiIpOwogCQlyZXR1cm4gLUVO
T0RFVjsKQEAgLTExNDgsNyArMTE0OCw3IEBAIGludCBpbnRlbF9vdmVybGF5X3B1dF9pbWFnZV9p
b2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQlnb3RvIG91dF91bmxv
Y2s7CiAJfQogCi0JcmV0ID0gY2hlY2tfb3ZlcmxheV9zcmMoZGV2X3ByaXYsIHBhcmFtcywgbmV3
X2JvKTsKKwlyZXQgPSBjaGVja19vdmVybGF5X3NyYyhpOTE1LCBwYXJhbXMsIG5ld19ibyk7CiAJ
aWYgKHJldCAhPSAwKQogCQlnb3RvIG91dF91bmxvY2s7CiAKQEAgLTEyMzEsMTEgKzEyMzEsMTEg
QEAgaW50IGludGVsX292ZXJsYXlfYXR0cnNfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
dm9pZCAqZGF0YSwKIAkJCSAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KQogewogCXN0
cnVjdCBkcm1faW50ZWxfb3ZlcmxheV9hdHRycyAqYXR0cnMgPSBkYXRhOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3Zl
cmxheTsKIAlpbnQgcmV0OwogCi0Jb3ZlcmxheSA9IGRldl9wcml2LT5vdmVybGF5OworCW92ZXJs
YXkgPSBpOTE1LT5vdmVybGF5OwogCWlmICghb3ZlcmxheSkgewogCQlEUk1fREVCVUcoInVzZXJz
cGFjZSBidWc6IG5vIG92ZXJsYXlcbiIpOwogCQlyZXR1cm4gLUVOT0RFVjsKQEAgLTEyNTEsNyAr
MTI1MSw3IEBAIGludCBpbnRlbF9vdmVybGF5X2F0dHJzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHZvaWQgKmRhdGEsCiAJCWF0dHJzLT5jb250cmFzdCAgID0gb3ZlcmxheS0+Y29udHJh
c3Q7CiAJCWF0dHJzLT5zYXR1cmF0aW9uID0gb3ZlcmxheS0+c2F0dXJhdGlvbjsKIAotCQlpZiAo
IUlTX0dFTihkZXZfcHJpdiwgMikpIHsKKwkJaWYgKCFJU19HRU4oaTkxNSwgMikpIHsKIAkJCWF0
dHJzLT5nYW1tYTAgPSBJOTE1X1JFQUQoT0dBTUMwKTsKIAkJCWF0dHJzLT5nYW1tYTEgPSBJOTE1
X1JFQUQoT0dBTUMxKTsKIAkJCWF0dHJzLT5nYW1tYTIgPSBJOTE1X1JFQUQoT0dBTUMyKTsKQEAg
LTEyNzUsNyArMTI3NSw3IEBAIGludCBpbnRlbF9vdmVybGF5X2F0dHJzX2lvY3RsKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXVwZGF0ZV9yZWdfYXR0cnMob3ZlcmxheSwg
b3ZlcmxheS0+cmVncyk7CiAKIAkJaWYgKGF0dHJzLT5mbGFncyAmIEk5MTVfT1ZFUkxBWV9VUERB
VEVfR0FNTUEpIHsKLQkJCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpKQorCQkJaWYgKElTX0dFTihp
OTE1LCAyKSkKIAkJCQlnb3RvIG91dF91bmxvY2s7CiAKIAkJCWlmIChvdmVybGF5LT5hY3RpdmUp
IHsKQEAgLTEzNTEsMTkgKzEzNTEsMTkgQEAgc3RhdGljIGludCBnZXRfcmVnaXN0ZXJzKHN0cnVj
dCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LCBib29sIHVzZV9waHlzKQogCXJldHVybiBlcnI7CiB9
CiAKLXZvaWQgaW50ZWxfb3ZlcmxheV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCit2b2lkIGludGVsX292ZXJsYXlfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXk7CiAJaW50IHJldDsKIAot
CWlmICghSEFTX09WRVJMQVkoZGV2X3ByaXYpKQorCWlmICghSEFTX09WRVJMQVkoaTkxNSkpCiAJ
CXJldHVybjsKIAogCW92ZXJsYXkgPSBremFsbG9jKHNpemVvZigqb3ZlcmxheSksIEdGUF9LRVJO
RUwpOwogCWlmICghb3ZlcmxheSkKIAkJcmV0dXJuOwogCi0Jb3ZlcmxheS0+aTkxNSA9IGRldl9w
cml2OworCW92ZXJsYXktPmk5MTUgPSBpOTE1OwogCiAJb3ZlcmxheS0+Y29sb3Jfa2V5ID0gMHgw
MTAxZmU7CiAJb3ZlcmxheS0+Y29sb3Jfa2V5X2VuYWJsZWQgPSB0cnVlOwpAQCAtMTM3Myw3ICsx
MzczLDcgQEAgdm9pZCBpbnRlbF9vdmVybGF5X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAogCUlOSVRfQUNUSVZFX1JFUVVFU1QoJm92ZXJsYXktPmxhc3RfZmxpcCk7
CiAKLQlyZXQgPSBnZXRfcmVnaXN0ZXJzKG92ZXJsYXksIE9WRVJMQVlfTkVFRFNfUEhZU0lDQUwo
ZGV2X3ByaXYpKTsKKwlyZXQgPSBnZXRfcmVnaXN0ZXJzKG92ZXJsYXksIE9WRVJMQVlfTkVFRFNf
UEhZU0lDQUwoaTkxNSkpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X2ZyZWU7CiAKQEAgLTEzODcs
NyArMTM4Nyw3IEBAIHZvaWQgaW50ZWxfb3ZlcmxheV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJdXBkYXRlX3BvbHlwaGFzZV9maWx0ZXIob3ZlcmxheS0+cmVncyk7
CiAJdXBkYXRlX3JlZ19hdHRycyhvdmVybGF5LCBvdmVybGF5LT5yZWdzKTsKIAotCWRldl9wcml2
LT5vdmVybGF5ID0gb3ZlcmxheTsKKwlpOTE1LT5vdmVybGF5ID0gb3ZlcmxheTsKIAlEUk1fSU5G
TygiSW5pdGlhbGl6ZWQgb3ZlcmxheSBzdXBwb3J0LlxuIik7CiAJcmV0dXJuOwogCkBAIC0xMzk3
LDExICsxMzk3LDExIEBAIHZvaWQgaW50ZWxfb3ZlcmxheV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAJa2ZyZWUob3ZlcmxheSk7CiB9CiAKLXZvaWQgaW50ZWxfb3Zl
cmxheV9jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50
ZWxfb3ZlcmxheV9jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0
cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5OwogCi0Jb3ZlcmxheSA9IGZldGNoX2FuZF96ZXJv
KCZkZXZfcHJpdi0+b3ZlcmxheSk7CisJb3ZlcmxheSA9IGZldGNoX2FuZF96ZXJvKCZpOTE1LT5v
dmVybGF5KTsKIAlpZiAoIW92ZXJsYXkpCiAJCXJldHVybjsKIApAQCAtMTQyNyw5ICsxNDI3LDkg
QEAgc3RydWN0IGludGVsX292ZXJsYXlfZXJyb3Jfc3RhdGUgewogfTsKIAogc3RydWN0IGludGVs
X292ZXJsYXlfZXJyb3Jfc3RhdGUgKgotaW50ZWxfb3ZlcmxheV9jYXB0dXJlX2Vycm9yX3N0YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludGVsX292ZXJsYXlfY2FwdHVy
ZV9lcnJvcl9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qg
aW50ZWxfb3ZlcmxheSAqb3ZlcmxheSA9IGRldl9wcml2LT5vdmVybGF5OworCXN0cnVjdCBpbnRl
bF9vdmVybGF5ICpvdmVybGF5ID0gaTkxNS0+b3ZlcmxheTsKIAlzdHJ1Y3QgaW50ZWxfb3Zlcmxh
eV9lcnJvcl9zdGF0ZSAqZXJyb3I7CiAKIAlpZiAoIW92ZXJsYXkgfHwgIW92ZXJsYXktPmFjdGl2
ZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX292ZXJsYXkuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX292ZXJsYXkuaAppbmRleCBhMTY3YzI4YWNkMjcuLjJl
ODc3MWNmZmVlOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zlcmxh
eS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX292ZXJsYXkuaApAQCAtMTMsMTYg
KzEzLDE2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogc3RydWN0IGludGVsX292ZXJsYXk7
CiBzdHJ1Y3QgaW50ZWxfb3ZlcmxheV9lcnJvcl9zdGF0ZTsKIAotdm9pZCBpbnRlbF9vdmVybGF5
X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX292
ZXJsYXlfY2xlYW51cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBp
bnRlbF9vdmVybGF5X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQg
aW50ZWxfb3ZlcmxheV9jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIGlu
dCBpbnRlbF9vdmVybGF5X3N3aXRjaF9vZmYoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkp
OwogaW50IGludGVsX292ZXJsYXlfcHV0X2ltYWdlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJCQkJICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdik7CiBpbnQg
aW50ZWxfb3ZlcmxheV9hdHRyc19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLAogCQkJICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOwotdm9pZCBpbnRlbF9v
dmVybGF5X3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGlu
dGVsX292ZXJsYXlfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogc3RydWN0
IGludGVsX292ZXJsYXlfZXJyb3Jfc3RhdGUgKgotaW50ZWxfb3ZlcmxheV9jYXB0dXJlX2Vycm9y
X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CitpbnRlbF9vdmVybGF5
X2NhcHR1cmVfZXJyb3Jfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9p
ZCBpbnRlbF9vdmVybGF5X3ByaW50X2Vycm9yX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9z
dGF0ZV9idWYgKmUsCiAJCQkJICAgICBzdHJ1Y3QgaW50ZWxfb3ZlcmxheV9lcnJvcl9zdGF0ZSAq
ZXJyb3IpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wYW5lbC5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcGFuZWwuYwppbmRleCA5Y2Q0ZTM3ZTM5MzQu
LmQ4MDExNTA4OTQ0NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcGFu
ZWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wYW5lbC5jCkBAIC02NSw3ICs2
NSw3IEBAIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICoKIGludGVsX3BhbmVsX2VkaWRfZG93bmNs
b2NrX21vZGUoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwog
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpzY2FuLCAqYmVzdF9tb2RlID0gTlVMTDsK
IAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZG93bmNsb2NrX21vZGU7CiAJaW50IGJlc3RfY2xv
Y2sgPSBmaXhlZF9tb2RlLT5jbG9jazsKQEAgLTkyLDcgKzkyLDcgQEAgaW50ZWxfcGFuZWxfZWRp
ZF9kb3duY2xvY2tfbW9kZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCiAJaWYg
KCFiZXN0X21vZGUpCiAJCXJldHVybiBOVUxMOwogCi0JZG93bmNsb2NrX21vZGUgPSBkcm1fbW9k
ZV9kdXBsaWNhdGUoJmRldl9wcml2LT5kcm0sIGJlc3RfbW9kZSk7CisJZG93bmNsb2NrX21vZGUg
PSBkcm1fbW9kZV9kdXBsaWNhdGUoJmk5MTUtPmRybSwgYmVzdF9tb2RlKTsKIAlpZiAoIWRvd25j
bG9ja19tb2RlKQogCQlyZXR1cm4gTlVMTDsKIApAQCAtMTA2LDcgKzEwNiw3IEBAIGludGVsX3Bh
bmVsX2VkaWRfZG93bmNsb2NrX21vZGUoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9y
LAogc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKgogaW50ZWxfcGFuZWxfZWRpZF9maXhlZF9tb2Rl
KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsK
IAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqc2NhbjsKIAlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqZml4ZWRfbW9kZTsKIApAQCAtMTE4LDcgKzExOCw3IEBAIGludGVsX3BhbmVsX2Vk
aWRfZml4ZWRfbW9kZShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiAJCWlmICgo
c2Nhbi0+dHlwZSAmIERSTV9NT0RFX1RZUEVfUFJFRkVSUkVEKSA9PSAwKQogCQkJY29udGludWU7
CiAKLQkJZml4ZWRfbW9kZSA9IGRybV9tb2RlX2R1cGxpY2F0ZSgmZGV2X3ByaXYtPmRybSwgc2Nh
bik7CisJCWZpeGVkX21vZGUgPSBkcm1fbW9kZV9kdXBsaWNhdGUoJmk5MTUtPmRybSwgc2Nhbik7
CiAJCWlmICghZml4ZWRfbW9kZSkKIAkJCXJldHVybiBOVUxMOwogCkBAIC0xMzIsNyArMTMyLDcg
QEAgaW50ZWxfcGFuZWxfZWRpZF9maXhlZF9tb2RlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNv
bm5lY3RvcikKIAlzY2FuID0gbGlzdF9maXJzdF9lbnRyeSgmY29ubmVjdG9yLT5iYXNlLnByb2Jl
ZF9tb2RlcywKIAkJCQl0eXBlb2YoKnNjYW4pLCBoZWFkKTsKIAotCWZpeGVkX21vZGUgPSBkcm1f
bW9kZV9kdXBsaWNhdGUoJmRldl9wcml2LT5kcm0sIHNjYW4pOworCWZpeGVkX21vZGUgPSBkcm1f
bW9kZV9kdXBsaWNhdGUoJmk5MTUtPmRybSwgc2Nhbik7CiAJaWYgKCFmaXhlZF9tb2RlKQogCQly
ZXR1cm4gTlVMTDsKIApAQCAtMTQ4LDE1ICsxNDgsMTUgQEAgaW50ZWxfcGFuZWxfZWRpZF9maXhl
ZF9tb2RlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICoKIGludGVsX3BhbmVsX3ZidF9maXhlZF9tb2RlKHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfaW5mbyAqaW5mbyA9ICZjb25uZWN0b3ItPmJhc2UuZGlzcGxheV9pbmZvOwogCXN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlOwogCi0JaWYgKCFkZXZfcHJpdi0+dmJ0LmxmcF9s
dmRzX3ZidF9tb2RlKQorCWlmICghaTkxNS0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlKQogCQlyZXR1
cm4gTlVMTDsKIAotCWZpeGVkX21vZGUgPSBkcm1fbW9kZV9kdXBsaWNhdGUoJmRldl9wcml2LT5k
cm0sCi0JCQkJCWRldl9wcml2LT52YnQubGZwX2x2ZHNfdmJ0X21vZGUpOworCWZpeGVkX21vZGUg
PSBkcm1fbW9kZV9kdXBsaWNhdGUoJmk5MTUtPmRybSwKKwkJCQkJaTkxNS0+dmJ0LmxmcF9sdmRz
X3ZidF9tb2RlKTsKIAlpZiAoIWZpeGVkX21vZGUpCiAJCXJldHVybiBOVUxMOwogCkBAIC0zNzgs
NyArMzc4LDcgQEAgdm9pZCBpbnRlbF9nbWNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGludGVsX2Ny
dGMgKmludGVsX2NydGMsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcsCiAJCQkgICAgICBpbnQgZml0dGluZ19tb2RlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7
CiAJdTMyIHBmaXRfY29udHJvbCA9IDAsIHBmaXRfcGdtX3JhdGlvcyA9IDAsIGJvcmRlciA9IDA7
CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZTsKIApAQCAtMzk5LDcgKzM5OSw3IEBAIHZvaWQgaW50ZWxfZ21j
aF9wYW5lbF9maXR0aW5nKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQlicmVhazsK
IAljYXNlIERSTV9NT0RFX1NDQUxFX0FTUEVDVDoKIAkJLyogU2NhbGUgYnV0IHByZXNlcnZlIHRo
ZSBhc3BlY3QgcmF0aW8gKi8KLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKKwkJaWYg
KElOVEVMX0dFTihpOTE1KSA+PSA0KQogCQkJaTk2NV9zY2FsZV9hc3BlY3QocGlwZV9jb25maWcs
ICZwZml0X2NvbnRyb2wpOwogCQllbHNlCiAJCQlpOXh4X3NjYWxlX2FzcGVjdChwaXBlX2NvbmZp
ZywgJnBmaXRfY29udHJvbCwKQEAgLTQxMyw3ICs0MTMsNyBAQCB2b2lkIGludGVsX2dtY2hfcGFu
ZWxfZml0dGluZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAkJaWYgKHBpcGVfY29u
ZmlnLT5waXBlX3NyY19oICE9IGFkanVzdGVkX21vZGUtPmNydGNfdmRpc3BsYXkgfHwKIAkJICAg
IHBpcGVfY29uZmlnLT5waXBlX3NyY193ICE9IGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXkp
IHsKIAkJCXBmaXRfY29udHJvbCB8PSBQRklUX0VOQUJMRTsKLQkJCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDQpCisJCQlpZiAoSU5URUxfR0VOKGk5MTUpID49IDQpCiAJCQkJcGZpdF9jb250
cm9sIHw9IFBGSVRfU0NBTElOR19BVVRPOwogCQkJZWxzZQogCQkJCXBmaXRfY29udHJvbCB8PSAo
VkVSVF9BVVRPX1NDQUxFIHwKQEAgLTQyOSw3ICs0MjksNyBAQCB2b2lkIGludGVsX2dtY2hfcGFu
ZWxfZml0dGluZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAogCS8qIDk2NSsgd2Fu
dHMgZnV6enkgZml0dGluZyAqLwogCS8qIEZJWE1FOiBoYW5kbGUgbXVsdGlwbGUgcGFuZWxzIGJ5
IGZhaWxpbmcgZ3JhY2VmdWxseSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpCisJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KQogCQlwZml0X2NvbnRyb2wgfD0gKChpbnRlbF9jcnRj
LT5waXBlIDw8IFBGSVRfUElQRV9TSElGVCkgfAogCQkJCSBQRklUX0ZJTFRFUl9GVVpaWSk7CiAK
QEAgLTQ0MCw3ICs0NDAsNyBAQCB2b2lkIGludGVsX2dtY2hfcGFuZWxfZml0dGluZyhzdHJ1Y3Qg
aW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAl9CiAKIAkvKiBNYWtlIHN1cmUgcHJlLTk2NSBzZXQg
ZGl0aGVyIGNvcnJlY3RseSBmb3IgMThicHAgcGFuZWxzLiAqLwotCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpIDwgNCAmJiBwaXBlX2NvbmZpZy0+cGlwZV9icHAgPT0gMTgpCisJaWYgKElOVEVMX0dF
TihpOTE1KSA8IDQgJiYgcGlwZV9jb25maWctPnBpcGVfYnBwID09IDE4KQogCQlwZml0X2NvbnRy
b2wgfD0gUEFORUxfOFRPNl9ESVRIRVJfRU5BQkxFOwogCiAJcGlwZV9jb25maWctPmdtY2hfcGZp
dC5jb250cm9sID0gcGZpdF9jb250cm9sOwpAQCAtNTE3LDcgKzUxNyw3IEBAIHN0YXRpYyBpbmxp
bmUgdTMyIHNjYWxlX2h3X3RvX3VzZXIoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9y
LAogc3RhdGljIHUzMiBpbnRlbF9wYW5lbF9jb21wdXRlX2JyaWdodG5lc3Moc3RydWN0IGludGVs
X2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJCQkgIHUzMiB2YWwpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRl
dik7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwogCiAJ
V0FSTl9PTihwYW5lbC0+YmFja2xpZ2h0Lm1heCA9PSAwKTsKQEAgLTUyNiw3ICs1MjYsNyBAQCBz
dGF0aWMgdTMyIGludGVsX3BhbmVsX2NvbXB1dGVfYnJpZ2h0bmVzcyhzdHJ1Y3QgaW50ZWxfY29u
bmVjdG9yICpjb25uZWN0b3IsCiAJCXJldHVybiB2YWw7CiAKIAlpZiAoaTkxNV9tb2RwYXJhbXMu
aW52ZXJ0X2JyaWdodG5lc3MgPiAwIHx8Ci0JICAgIGRldl9wcml2LT5xdWlya3MgJiBRVUlSS19J
TlZFUlRfQlJJR0hUTkVTUykgeworCSAgICBpOTE1LT5xdWlya3MgJiBRVUlSS19JTlZFUlRfQlJJ
R0hUTkVTUykgewogCQlyZXR1cm4gcGFuZWwtPmJhY2tsaWdodC5tYXggLSB2YWwgKyBwYW5lbC0+
YmFja2xpZ2h0Lm1pbjsKIAl9CiAKQEAgLTUzNSwzOSArNTM1LDM5IEBAIHN0YXRpYyB1MzIgaW50
ZWxfcGFuZWxfY29tcHV0ZV9icmlnaHRuZXNzKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3RvciwKIAogc3RhdGljIHUzMiBscHRfZ2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAKIAlyZXR1cm4gSTkxNV9SRUFE
KEJMQ19QV01fUENIX0NUTDIpICYgQkFDS0xJR0hUX0RVVFlfQ1lDTEVfTUFTSzsKIH0KIAogc3Rh
dGljIHUzMiBwY2hfZ2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25u
ZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAKIAlyZXR1cm4gSTkxNV9SRUFEKEJMQ19QV01fQ1BV
X0NUTCkgJiBCQUNLTElHSFRfRFVUWV9DWUNMRV9NQVNLOwogfQogCiBzdGF0aWMgdTMyIGk5eHhf
Z2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBh
bmVsOwogCXUzMiB2YWw7CiAKIAl2YWwgPSBJOTE1X1JFQUQoQkxDX1BXTV9DVEwpICYgQkFDS0xJ
R0hUX0RVVFlfQ1lDTEVfTUFTSzsKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDQpCisJaWYg
KElOVEVMX0dFTihpOTE1KSA8IDQpCiAJCXZhbCA+Pj0gMTsKIAogCWlmIChwYW5lbC0+YmFja2xp
Z2h0LmNvbWJpbmF0aW9uX21vZGUpIHsKIAkJdTggbGJwYzsKIAotCQlwY2lfcmVhZF9jb25maWdf
Ynl0ZShkZXZfcHJpdi0+ZHJtLnBkZXYsIExCUEMsICZsYnBjKTsKKwkJcGNpX3JlYWRfY29uZmln
X2J5dGUoaTkxNS0+ZHJtLnBkZXYsIExCUEMsICZsYnBjKTsKIAkJdmFsICo9IGxicGM7CiAJfQog
CiAJcmV0dXJuIHZhbDsKIH0KIAotc3RhdGljIHUzMiBfdmx2X2dldF9iYWNrbGlnaHQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKK3N0YXRpYyB1MzIg
X3Zsdl9nZXRfYmFja2xpZ2h0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBp
cGUgcGlwZSkKIHsKIAlpZiAoV0FSTl9PTihwaXBlICE9IFBJUEVfQSAmJiBwaXBlICE9IFBJUEVf
QikpCiAJCXJldHVybiAwOwpAQCAtNTc3LDE1ICs1NzcsMTUgQEAgc3RhdGljIHUzMiBfdmx2X2dl
dF9iYWNrbGlnaHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUg
cGlwZSkKIAogc3RhdGljIHUzMiB2bHZfZ2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBp
bnRlbF9jb25uZWN0b3JfZ2V0X3BpcGUoY29ubmVjdG9yKTsKIAotCXJldHVybiBfdmx2X2dldF9i
YWNrbGlnaHQoZGV2X3ByaXYsIHBpcGUpOworCXJldHVybiBfdmx2X2dldF9iYWNrbGlnaHQoaTkx
NSwgcGlwZSk7CiB9CiAKIHN0YXRpYyB1MzIgYnh0X2dldF9iYWNrbGlnaHQoc3RydWN0IGludGVs
X2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRl
bF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAogCXJldHVybiBJOTE1X1JFQUQo
QlhUX0JMQ19QV01fRFVUWShwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpKTsKQEAgLTYwMyw3
ICs2MDMsNyBAQCBzdGF0aWMgdTMyIHB3bV9nZXRfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvcikKIHN0YXRpYyB2b2lkIGxwdF9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0
cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCiB7CiAJc3Ry
dWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5f
c3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAKIAl1MzIgdmFsID0gSTkxNV9S
RUFEKEJMQ19QV01fUENIX0NUTDIpICYgfkJBQ0tMSUdIVF9EVVRZX0NZQ0xFX01BU0s7CiAJSTkx
NV9XUklURShCTENfUFdNX1BDSF9DVEwyLCB2YWwgfCBsZXZlbCk7CkBAIC02MTIsNyArNjEyLDcg
QEAgc3RhdGljIHZvaWQgbHB0X3NldF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMgogc3RhdGljIHZvaWQgcGNoX3NldF9iYWNrbGlnaHQo
Y29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkK
IHsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0
b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAl1MzIgdG1wOwog
CiAJdG1wID0gSTkxNV9SRUFEKEJMQ19QV01fQ1BVX0NUTCkgJiB+QkFDS0xJR0hUX0RVVFlfQ1lD
TEVfTUFTSzsKQEAgLTYyMiw3ICs2MjIsNyBAQCBzdGF0aWMgdm9pZCBwY2hfc2V0X2JhY2tsaWdo
dChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyCiBzdGF0
aWMgdm9pZCBpOXh4X3NldF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0
b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+
cGFuZWw7CiAJdTMyIHRtcCwgbWFzazsKIApAQCAtNjMzLDEwICs2MzMsMTAgQEAgc3RhdGljIHZv
aWQgaTl4eF9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpj
b25uX3N0YXRlLCB1MzIKIAogCQlsYnBjID0gbGV2ZWwgKiAweGZlIC8gcGFuZWwtPmJhY2tsaWdo
dC5tYXggKyAxOwogCQlsZXZlbCAvPSBsYnBjOwotCQlwY2lfd3JpdGVfY29uZmlnX2J5dGUoZGV2
X3ByaXYtPmRybS5wZGV2LCBMQlBDLCBsYnBjKTsKKwkJcGNpX3dyaXRlX2NvbmZpZ19ieXRlKGk5
MTUtPmRybS5wZGV2LCBMQlBDLCBsYnBjKTsKIAl9CiAKLQlpZiAoSVNfR0VOKGRldl9wcml2LCA0
KSkgeworCWlmIChJU19HRU4oaTkxNSwgNCkpIHsKIAkJbWFzayA9IEJBQ0tMSUdIVF9EVVRZX0NZ
Q0xFX01BU0s7CiAJfSBlbHNlIHsKIAkJbGV2ZWwgPDw9IDE7CkBAIC02NTAsNyArNjUwLDcgQEAg
c3RhdGljIHZvaWQgaTl4eF9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpjb25uX3N0YXRlLCB1MzIKIHN0YXRpYyB2b2lkIHZsdl9zZXRfYmFja2xpZ2h0KGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCiB7
CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9y
KGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBp
cGUgPSB0b19pbnRlbF9jcnRjKGNvbm5fc3RhdGUtPmNydGMpLT5waXBlOwogCXUzMiB0bXA7CiAK
QEAgLTY2MSw3ICs2NjEsNyBAQCBzdGF0aWMgdm9pZCB2bHZfc2V0X2JhY2tsaWdodChjb25zdCBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyCiBzdGF0aWMgdm9pZCBi
eHRfc2V0X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSwgdTMyIGxldmVsKQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9
IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5k
ZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAog
CUk5MTVfV1JJVEUoQlhUX0JMQ19QV01fRFVUWShwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIp
LCBsZXZlbCk7CkBAIC02OTQsNyArNjk0LDcgQEAgdm9pZCBpbnRlbF9wYW5lbF9zZXRfYmFja2xp
Z2h0X2FjcGkoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUKIAkJ
CQkgICAgdTMyIHVzZXJfbGV2ZWwsIHUzMiB1c2VyX21heCkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29u
bmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVj
dG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5l
Y3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNv
bm5lY3Rvci0+cGFuZWw7CiAJdTMyIGh3X2xldmVsOwogCkBAIC03MDcsNyArNzA3LDcgQEAgdm9p
ZCBpbnRlbF9wYW5lbF9zZXRfYmFja2xpZ2h0X2FjcGkoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKmNvbm5fc3RhdGUKIAlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHJlc2VudCB8fCAh
Y29ubl9zdGF0ZS0+Y3J0YykKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmJh
Y2tsaWdodF9sb2NrKTsKKwltdXRleF9sb2NrKCZpOTE1LT5iYWNrbGlnaHRfbG9jayk7CiAKIAlX
QVJOX09OKHBhbmVsLT5iYWNrbGlnaHQubWF4ID09IDApOwogCkBAIC03MjMsMTMgKzcyMywxMyBA
QCB2b2lkIGludGVsX3BhbmVsX3NldF9iYWNrbGlnaHRfYWNwaShjb25zdCBzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZQogCWlmIChwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZWQp
CiAJCWludGVsX3BhbmVsX2FjdHVhbGx5X3NldF9iYWNrbGlnaHQoY29ubl9zdGF0ZSwgaHdfbGV2
ZWwpOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOworCW11dGV4
X3VubG9jaygmaTkxNS0+YmFja2xpZ2h0X2xvY2spOwogfQogCiBzdGF0aWMgdm9pZCBscHRfZGlz
YWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25u
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVs
X2Nvbm5lY3RvcihvbGRfY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsK
IAl1MzIgdG1wOwogCiAJaW50ZWxfcGFuZWxfYWN0dWFsbHlfc2V0X2JhY2tsaWdodChvbGRfY29u
bl9zdGF0ZSwgMCk7CkBAIC03NTUsNyArNzU1LDcgQEAgc3RhdGljIHZvaWQgbHB0X2Rpc2FibGVf
YmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGEK
IHN0YXRpYyB2b2lkIHBjaF9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKG9sZF9jb25uX3N0YXRlLT5jb25uZWN0b3Ip
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNv
bm5lY3Rvci0+YmFzZS5kZXYpOwogCXUzMiB0bXA7CiAKIAlpbnRlbF9wYW5lbF9hY3R1YWxseV9z
ZXRfYmFja2xpZ2h0KG9sZF9jb25uX3N0YXRlLCAwKTsKQEAgLTc3NCw3ICs3NzQsNyBAQCBzdGF0
aWMgdm9pZCBpOXh4X2Rpc2FibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpvbGRfY29ubl9zdAogCiBzdGF0aWMgdm9pZCBpOTY1X2Rpc2FibGVfYmFja2xpZ2h0
KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG9sZF9jb25uX3N0YXRl
LT5jb25uZWN0b3ItPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KG9sZF9jb25uX3N0YXRlLT5jb25uZWN0b3ItPmRldik7CiAJdTMyIHRtcDsKIAogCWludGVs
X3BhbmVsX2FjdHVhbGx5X3NldF9iYWNrbGlnaHQob2xkX2Nvbm5fc3RhdGUsIDApOwpAQCAtNzg2
LDcgKzc4Niw3IEBAIHN0YXRpYyB2b2lkIGk5NjVfZGlzYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3Ry
dWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0CiBzdGF0aWMgdm9pZCB2bHZfZGlz
YWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25u
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVs
X2Nvbm5lY3RvcihvbGRfY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsK
IAllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2NydGMob2xkX2Nvbm5fc3RhdGUtPmNydGMpLT5w
aXBlOwogCXUzMiB0bXA7CiAKQEAgLTc5OSw3ICs3OTksNyBAQCBzdGF0aWMgdm9pZCB2bHZfZGlz
YWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25u
X3N0YQogc3RhdGljIHZvaWQgYnh0X2Rpc2FibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1f
Y29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3Iob2xkX2Nvbm5fc3RhdGUtPmNvbm5l
Y3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25u
ZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZj
b25uZWN0b3ItPnBhbmVsOwogCXUzMiB0bXAsIHZhbDsKIApAQCAtODE5LDcgKzgxOSw3IEBAIHN0
YXRpYyB2b2lkIGJ4dF9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqb2xkX2Nvbm5fc3RhCiBzdGF0aWMgdm9pZCBjbnBfZGlzYWJsZV9iYWNrbGlnaHQo
Y29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlKQogewogCXN0
cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3RvcihvbGRf
Y29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxf
cGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CiAJdTMyIHRtcDsKIApAQCAtODQ0LDcg
Kzg0NCw3IEBAIHN0YXRpYyB2b2lkIHB3bV9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhCiB2b2lkIGludGVsX3BhbmVsX2Rpc2Fi
bGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9z
dGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9j
b25uZWN0b3Iob2xkX2Nvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJ
c3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwogCiAJaWYgKCFw
YW5lbC0+YmFja2xpZ2h0LnByZXNlbnQpCkBAIC04NTYsMjYgKzg1NiwyNiBAQCB2b2lkIGludGVs
X3BhbmVsX2Rpc2FibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRl
ICpvbGRfY29ubl9zdAogCSAqIGJhY2tsaWdodC4gVGhpcyB3aWxsIGxlYXZlIHRoZSBiYWNrbGln
aHQgb24gdW5uZWNlc3NhcmlseSB3aGVuCiAJICogYW5vdGhlciBjbGllbnQgaXMgbm90IGFjdGl2
YXRlZC4KIAkgKi8KLQlpZiAoZGV2X3ByaXYtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUgPT0gRFJN
X1NXSVRDSF9QT1dFUl9DSEFOR0lORykgeworCWlmIChpOTE1LT5kcm0uc3dpdGNoX3Bvd2VyX3N0
YXRlID09IERSTV9TV0lUQ0hfUE9XRVJfQ0hBTkdJTkcpIHsKIAkJRFJNX0RFQlVHX0RSSVZFUigi
U2tpcHBpbmcgYmFja2xpZ2h0IGRpc2FibGUgb24gdmdhIHN3aXRjaFxuIik7CiAJCXJldHVybjsK
IAl9CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOworCW11dGV4X2xv
Y2soJmk5MTUtPmJhY2tsaWdodF9sb2NrKTsKIAogCWlmIChwYW5lbC0+YmFja2xpZ2h0LmRldmlj
ZSkKIAkJcGFuZWwtPmJhY2tsaWdodC5kZXZpY2UtPnByb3BzLnBvd2VyID0gRkJfQkxBTktfUE9X
RVJET1dOOwogCXBhbmVsLT5iYWNrbGlnaHQuZW5hYmxlZCA9IGZhbHNlOwogCXBhbmVsLT5iYWNr
bGlnaHQuZGlzYWJsZShvbGRfY29ubl9zdGF0ZSk7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5iYWNrbGlnaHRfbG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5iYWNrbGlnaHRfbG9jayk7
CiB9CiAKIHN0YXRpYyB2b2lkIGxwdF9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7
CiAJdTMyIHBjaF9jdGwxLCBwY2hfY3RsMiwgc2NoaWNrZW47CiAKQEAgLTg4Niw3ICs4ODYsNyBA
QCBzdGF0aWMgdm9pZCBscHRfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJSTkxNV9XUklURShCTENfUFdNX1BDSF9DVEwxLCBwY2hf
Y3RsMSk7CiAJfQogCi0JaWYgKEhBU19QQ0hfTFBUKGRldl9wcml2KSkgeworCWlmIChIQVNfUENI
X0xQVChpOTE1KSkgewogCQlzY2hpY2tlbiA9IEk5MTVfUkVBRChTT1VUSF9DSElDS0VOMik7CiAJ
CWlmIChwYW5lbC0+YmFja2xpZ2h0LmFsdGVybmF0ZV9wd21faW5jcmVtZW50KQogCQkJc2NoaWNr
ZW4gfD0gTFBUX1BXTV9HUkFOVUxBUklUWTsKQEAgLTkxMCw3ICs5MTAsNyBAQCBzdGF0aWMgdm9p
ZCBscHRfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIAkJcGNoX2N0bDEgfD0gQkxNX1BDSF9QT0xBUklUWTsKIAogCS8qIEFmdGVyIExQ
VCwgb3ZlcnJpZGUgaXMgdGhlIGRlZmF1bHQuICovCi0JaWYgKEhBU19QQ0hfTFBUKGRldl9wcml2
KSkKKwlpZiAoSEFTX1BDSF9MUFQoaTkxNSkpCiAJCXBjaF9jdGwxIHw9IEJMTV9QQ0hfT1ZFUlJJ
REVfRU5BQkxFOwogCiAJSTkxNV9XUklURShCTENfUFdNX1BDSF9DVEwxLCBwY2hfY3RsMSk7CkBA
IC05MjUsNyArOTI1LDcgQEAgc3RhdGljIHZvaWQgcGNoX2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJIGNvbnN0IHN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3Ip
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNv
bm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVj
dG9yLT5wYW5lbDsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRjX3N0YXRl
LT5jcHVfdHJhbnNjb2RlcjsKIAl1MzIgY3B1X2N0bDIsIHBjaF9jdGwxLCBwY2hfY3RsMjsKQEAg
LTk3MSw3ICs5NzEsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICBjb25zdCBzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9y
KTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rv
ci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShj
b25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5l
Y3Rvci0+cGFuZWw7CiAJdTMyIGN0bCwgZnJlcTsKIApAQCAtOTg4LDcgKzk4OCw3IEBAIHN0YXRp
YyB2b2lkIGk5eHhfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAljdGwgPSBmcmVxIDw8IDE3OwogCWlmIChwYW5lbC0+YmFja2xpZ2h0
LmNvbWJpbmF0aW9uX21vZGUpCiAJCWN0bCB8PSBCTE1fTEVHQUNZX01PREU7Ci0JaWYgKElTX1BJ
TkVWSUVXKGRldl9wcml2KSAmJiBwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtKQorCWlm
IChJU19QSU5FVklFVyhpOTE1KSAmJiBwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtKQog
CQljdGwgfD0gQkxNX1BPTEFSSVRZX1BOVjsKIAogCUk5MTVfV1JJVEUoQkxDX1BXTV9DVEwsIGN0
bCk7CkBAIC0xMDAyLDcgKzEwMDIsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2VuYWJsZV9iYWNrbGln
aHQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICogODU1Z20g
b25seSwgYnV0IGNoZWNraW5nIGZvciBnZW4yIGlzIHNhZmUsIGFzIDg1NWdtIGlzIHRoZSBvbmx5
IGdlbjIKIAkgKiB0aGF0IGhhcyBiYWNrbGlnaHQuCiAJICovCi0JaWYgKElTX0dFTihkZXZfcHJp
diwgMikpCisJaWYgKElTX0dFTihpOTE1LCAyKSkKIAkJSTkxNV9XUklURShCTENfSElTVF9DVEws
IEJMTV9ISVNUT0dSQU1fRU5BQkxFKTsKIH0KIApAQCAtMTAxMCw3ICsxMDEwLDcgQEAgc3RhdGlj
IHZvaWQgaTk2NV9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkJCSAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNv
bm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50
ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJ
c3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwogCWVudW0gcGlw
ZSBwaXBlID0gdG9faW50ZWxfY3J0Yyhjb25uX3N0YXRlLT5jcnRjKS0+cGlwZTsKIAl1MzIgY3Rs
LCBjdGwyLCBmcmVxOwpAQCAtMTA0NSw3ICsxMDQ1LDcgQEAgc3RhdGljIHZvaWQgdmx2X2VuYWJs
ZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CQkJIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0
cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25u
X3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5l
bCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKS0+cGlwZTsKIAl1MzIgY3RsLCBjdGwyOwpAQCAt
MTA3NSw3ICsxMDc1LDcgQEAgc3RhdGljIHZvaWQgYnh0X2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJIGNvbnN0IHN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3Ip
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNv
bm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVj
dG9yLT5wYW5lbDsKIAllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKS0+cGlwZTsKIAl1MzIgcHdtX2N0bCwgdmFsOwpAQCAtMTEyMyw3ICsxMTIzLDcg
QEAgc3RhdGljIHZvaWQgY25wX2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0
YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9
IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5k
ZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAl1
MzIgcHdtX2N0bDsKIApAQCAtMTE4Nyw3ICsxMTg3LDcgQEAgdm9pZCBpbnRlbF9wYW5lbF9lbmFi
bGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJCSAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJ
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNv
bm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3Bh
bmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwogCWVudW0gcGlwZSBwaXBlID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpLT5waXBlOwogCkBAIC0xMTk2LDI4ICsxMTk2
LDI4IEBAIHZvaWQgaW50ZWxfcGFuZWxfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogCURSTV9ERUJVR19LTVMoInBpcGUgJWNcbiIs
IHBpcGVfbmFtZShwaXBlKSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xv
Y2spOworCW11dGV4X2xvY2soJmk5MTUtPmJhY2tsaWdodF9sb2NrKTsKIAogCV9faW50ZWxfcGFu
ZWxfZW5hYmxlX2JhY2tsaWdodChjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKIAotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmJhY2tsaWdodF9sb2NrKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmJh
Y2tsaWdodF9sb2NrKTsKIH0KIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0JBQ0tMSUdIVF9DTEFT
U19ERVZJQ0UpCiBzdGF0aWMgdTMyIGludGVsX3BhbmVsX2dldF9iYWNrbGlnaHQoc3RydWN0IGlu
dGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBp
bnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAl1MzIgdmFsID0gMDsKIAot
CW11dGV4X2xvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisJbXV0ZXhfbG9jaygmaTkx
NS0+YmFja2xpZ2h0X2xvY2spOwogCiAJaWYgKHBhbmVsLT5iYWNrbGlnaHQuZW5hYmxlZCkgewog
CQl2YWwgPSBwYW5lbC0+YmFja2xpZ2h0LmdldChjb25uZWN0b3IpOwogCQl2YWwgPSBpbnRlbF9w
YW5lbF9jb21wdXRlX2JyaWdodG5lc3MoY29ubmVjdG9yLCB2YWwpOwogCX0KIAotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmJhY2tsaWdodF9sb2NrKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmJh
Y2tsaWdodF9sb2NrKTsKIAogCURSTV9ERUJVR19EUklWRVIoImdldCBiYWNrbGlnaHQgUFdNID0g
JWRcbiIsIHZhbCk7CiAJcmV0dXJuIHZhbDsKQEAgLTEyMjgsMTQgKzEyMjgsMTQgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfcGFuZWxfc2V0X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGEKIAkJCQkgICAgICB1MzIgdXNlcl9sZXZlbCwgdTMyIHVzZXJfbWF4
KQogewogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5l
Y3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBp
bnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAl1MzIgaHdfbGV2ZWw7CiAK
IAlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHJlc2VudCkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPmJhY2tsaWdodF9sb2NrKTsKKwltdXRleF9sb2NrKCZpOTE1LT5iYWNrbGln
aHRfbG9jayk7CiAKIAlXQVJOX09OKHBhbmVsLT5iYWNrbGlnaHQubWF4ID09IDApOwogCkBAIC0x
MjQ1LDcgKzEyNDUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wYW5lbF9zZXRfYmFja2xpZ2h0KGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YQogCWlmIChwYW5lbC0+YmFj
a2xpZ2h0LmVuYWJsZWQpCiAJCWludGVsX3BhbmVsX2FjdHVhbGx5X3NldF9iYWNrbGlnaHQoY29u
bl9zdGF0ZSwgaHdfbGV2ZWwpOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0
X2xvY2spOworCW11dGV4X3VubG9jaygmaTkxNS0+YmFja2xpZ2h0X2xvY2spOwogfQogCiBzdGF0
aWMgaW50IGludGVsX2JhY2tsaWdodF9kZXZpY2VfdXBkYXRlX3N0YXR1cyhzdHJ1Y3QgYmFja2xp
Z2h0X2RldmljZSAqYmQpCkBAIC0xMjg0LDExICsxMjg0LDExIEBAIHN0YXRpYyBpbnQgaW50ZWxf
YmFja2xpZ2h0X2RldmljZV9nZXRfYnJpZ2h0bmVzcyhzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAq
YmQpCiB7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gYmxfZ2V0X2RhdGEo
YmQpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjb25uZWN0b3ItPmJhc2UuZGV2OwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlpbnRlbF93YWtlcmVmX3Qg
d2FrZXJlZjsKIAlpbnQgcmV0ID0gMDsKIAotCXdpdGhfaW50ZWxfcnVudGltZV9wbShkZXZfcHJp
diwgd2FrZXJlZikgeworCXdpdGhfaW50ZWxfcnVudGltZV9wbShpOTE1LCB3YWtlcmVmKSB7CiAJ
CXUzMiBod19sZXZlbDsKIAogCQlkcm1fbW9kZXNldF9sb2NrKCZkZXYtPm1vZGVfY29uZmlnLmNv
bm5lY3Rpb25fbXV0ZXgsIE5VTEwpOwpAQCAtMTM3OCw5ICsxMzc4LDkgQEAgdm9pZCBpbnRlbF9i
YWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVj
dG9yKQogICovCiBzdGF0aWMgdTMyIGNucF9oel90b19wd20oc3RydWN0IGludGVsX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAKLQly
ZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoS0h6KGRldl9wcml2LT5yYXdjbGtfZnJlcSksIHB3bV9m
cmVxX2h6KTsKKwlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoS0h6KGk5MTUtPnJhd2Nsa19mcmVx
KSwgcHdtX2ZyZXFfaHopOwogfQogCiAvKgpAQCAtMTQxNiw3ICsxNDE2LDcgQEAgc3RhdGljIHUz
MiBzcHRfaHpfdG9fcHdtKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIHB3
bV9mcmVxX2h6KQogICovCiBzdGF0aWMgdTMyIGxwdF9oel90b19wd20oc3RydWN0IGludGVsX2Nv
bm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7
CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwogCXUzMiBt
dWwsIGNsb2NrOwogCkBAIC0xNDI1LDcgKzE0MjUsNyBAQCBzdGF0aWMgdTMyIGxwdF9oel90b19w
d20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiAJ
ZWxzZQogCQltdWwgPSAxMjg7CiAKLQlpZiAoSEFTX1BDSF9MUFRfSChkZXZfcHJpdikpCisJaWYg
KEhBU19QQ0hfTFBUX0goaTkxNSkpCiAJCWNsb2NrID0gTUh6KDEzNSk7IC8qIExQVDpIICovCiAJ
ZWxzZQogCQljbG9jayA9IE1IeigyNCk7IC8qIExQVDpMUCAqLwpAQCAtMTQzOSw5ICsxNDM5LDkg
QEAgc3RhdGljIHUzMiBscHRfaHpfdG9fcHdtKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3RvciwgdTMyIHB3bV9mcmVxX2h6KQogICovCiBzdGF0aWMgdTMyIHBjaF9oel90b19wd20oc3Ry
dWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7CiAKLQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoS0h6KGRldl9wcml2LT5y
YXdjbGtfZnJlcSksIHB3bV9mcmVxX2h6ICogMTI4KTsKKwlyZXR1cm4gRElWX1JPVU5EX0NMT1NF
U1QoS0h6KGk5MTUtPnJhd2Nsa19mcmVxKSwgcHdtX2ZyZXFfaHogKiAxMjgpOwogfQogCiAvKgpA
QCAtMTQ1NCwxMyArMTQ1NCwxMyBAQCBzdGF0aWMgdTMyIHBjaF9oel90b19wd20oc3RydWN0IGlu
dGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiAgKi8KIHN0YXRpYyB1
MzIgaTl4eF9oel90b19wd20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIg
cHdtX2ZyZXFfaHopCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJaW50IGNsb2NrOwogCi0JaWYgKElT
X1BJTkVWSUVXKGRldl9wcml2KSkKLQkJY2xvY2sgPSBLSHooZGV2X3ByaXYtPnJhd2Nsa19mcmVx
KTsKKwlpZiAoSVNfUElORVZJRVcoaTkxNSkpCisJCWNsb2NrID0gS0h6KGk5MTUtPnJhd2Nsa19m
cmVxKTsKIAllbHNlCi0JCWNsb2NrID0gS0h6KGRldl9wcml2LT5jZGNsay5ody5jZGNsayk7CisJ
CWNsb2NrID0gS0h6KGk5MTUtPmNkY2xrLmh3LmNkY2xrKTsKIAogCXJldHVybiBESVZfUk9VTkRf
Q0xPU0VTVChjbG9jaywgcHdtX2ZyZXFfaHogKiAzMik7CiB9CkBAIC0xNDcyLDEzICsxNDcyLDEz
IEBAIHN0YXRpYyB1MzIgaTl4eF9oel90b19wd20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29u
bmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiAgKi8KIHN0YXRpYyB1MzIgaTk2NV9oel90b19wd20o
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVj
dG9yLT5iYXNlLmRldik7CiAJaW50IGNsb2NrOwogCi0JaWYgKElTX0c0WChkZXZfcHJpdikpCi0J
CWNsb2NrID0gS0h6KGRldl9wcml2LT5yYXdjbGtfZnJlcSk7CisJaWYgKElTX0c0WChpOTE1KSkK
KwkJY2xvY2sgPSBLSHooaTkxNS0+cmF3Y2xrX2ZyZXEpOwogCWVsc2UKLQkJY2xvY2sgPSBLSHoo
ZGV2X3ByaXYtPmNkY2xrLmh3LmNkY2xrKTsKKwkJY2xvY2sgPSBLSHooaTkxNS0+Y2RjbGsuaHcu
Y2RjbGspOwogCiAJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKGNsb2NrLCBwd21fZnJlcV9oeiAq
IDEyOCk7CiB9CkBAIC0xNDkwLDE3ICsxNDkwLDE3IEBAIHN0YXRpYyB1MzIgaTk2NV9oel90b19w
d20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCiAg
Ki8KIHN0YXRpYyB1MzIgdmx2X2h6X3RvX3B3bShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25u
ZWN0b3IsIHUzMiBwd21fZnJlcV9oeikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlpbnQgbXVsLCBj
bG9jazsKIAogCWlmICgoSTkxNV9SRUFEKENCUjFfVkxWKSAmIENCUl9QV01fQ0xPQ0tfTVVYX1NF
TEVDVCkgPT0gMCkgewotCQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJCWlmIChJU19D
SEVSUllWSUVXKGk5MTUpKQogCQkJY2xvY2sgPSBLSHooMTkyMDApOwogCQllbHNlCiAJCQljbG9j
ayA9IE1IeigyNSk7CiAJCW11bCA9IDE2OwogCX0gZWxzZSB7Ci0JCWNsb2NrID0gS0h6KGRldl9w
cml2LT5yYXdjbGtfZnJlcSk7CisJCWNsb2NrID0gS0h6KGk5MTUtPnJhd2Nsa19mcmVxKTsKIAkJ
bXVsID0gMTI4OwogCX0KIApAQCAtMTUwOSw5ICsxNTA5LDkgQEAgc3RhdGljIHUzMiB2bHZfaHpf
dG9fcHdtKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIHB3bV9mcmVxX2h6
KQogCiBzdGF0aWMgdTMyIGdldF9iYWNrbGlnaHRfbWF4X3ZidChzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVs
ICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUxNiBwd21fZnJlcV9oeiA9IGRldl9wcml2
LT52YnQuYmFja2xpZ2h0LnB3bV9mcmVxX2h6OworCXUxNiBwd21fZnJlcV9oeiA9IGk5MTUtPnZi
dC5iYWNrbGlnaHQucHdtX2ZyZXFfaHo7CiAJdTMyIHB3bTsKIAogCWlmICghcGFuZWwtPmJhY2ts
aWdodC5oel90b19wd20pIHsKQEAgLTE1NDIsNyArMTU0Miw3IEBAIHN0YXRpYyB1MzIgZ2V0X2Jh
Y2tsaWdodF9tYXhfdmJ0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKICAqLwog
c3RhdGljIHUzMiBnZXRfYmFja2xpZ2h0X21pbl92YnQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFu
ZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAlpbnQgbWluOwogCkBAIC0xNTU1LDEwICsxNTU1LDEw
IEBAIHN0YXRpYyB1MzIgZ2V0X2JhY2tsaWdodF9taW5fdmJ0KHN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIAkgKiBhZ2FpbnN0IHRoaXMgYnkgbGV0dGluZyB0aGUgbWluaW11bSBi
ZSBhdCBtb3N0IChhcmJpdHJhcmlseSBjaG9zZW4pCiAJICogMjUlIG9mIHRoZSBtYXguCiAJICov
Ci0JbWluID0gY2xhbXBfdChpbnQsIGRldl9wcml2LT52YnQuYmFja2xpZ2h0Lm1pbl9icmlnaHRu
ZXNzLCAwLCA2NCk7Ci0JaWYgKG1pbiAhPSBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5taW5fYnJp
Z2h0bmVzcykgeworCW1pbiA9IGNsYW1wX3QoaW50LCBpOTE1LT52YnQuYmFja2xpZ2h0Lm1pbl9i
cmlnaHRuZXNzLCAwLCA2NCk7CisJaWYgKG1pbiAhPSBpOTE1LT52YnQuYmFja2xpZ2h0Lm1pbl9i
cmlnaHRuZXNzKSB7CiAJCURSTV9ERUJVR19LTVMoImNsYW1waW5nIFZCVCBtaW4gYmFja2xpZ2h0
ICVkLzI1NSB0byAlZC8yNTVcbiIsCi0JCQkgICAgICBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5t
aW5fYnJpZ2h0bmVzcywgbWluKTsKKwkJCSAgICAgIGk5MTUtPnZidC5iYWNrbGlnaHQubWluX2Jy
aWdodG5lc3MsIG1pbik7CiAJfQogCiAJLyogdmJ0IHZhbHVlIGlzIGEgY29lZmZpY2llbnQgaW4g
cmFuZ2UgWzAuLjI1NV0gKi8KQEAgLTE1NjcsMTIgKzE1NjcsMTIgQEAgc3RhdGljIHUzMiBnZXRf
YmFja2xpZ2h0X21pbl92YnQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCiBz
dGF0aWMgaW50IGxwdF9zZXR1cF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29u
bmVjdG9yLCBlbnVtIHBpcGUgdW51c2VkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBp
bnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKIAl1MzIgY3B1X2N0bDIsIHBj
aF9jdGwxLCBwY2hfY3RsMiwgdmFsOwogCWJvb2wgYWx0LCBjcHVfbW9kZTsKIAotCWlmIChIQVNf
UENIX0xQVChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfTFBUKGk5MTUpKQogCQlhbHQgPSBJOTE1
X1JFQUQoU09VVEhfQ0hJQ0tFTjIpICYgTFBUX1BXTV9HUkFOVUxBUklUWTsKIAllbHNlCiAJCWFs
dCA9IEk5MTVfUkVBRChTT1VUSF9DSElDS0VOMSkgJiBTUFRfUFdNX0dSQU5VTEFSSVRZOwpAQCAt
MTU5Niw3ICsxNTk2LDcgQEAgc3RhdGljIGludCBscHRfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBp
bnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHVudXMKIAogCXBhbmVsLT5iYWNr
bGlnaHQuZW5hYmxlZCA9IHBjaF9jdGwxICYgQkxNX1BDSF9QV01fRU5BQkxFOwogCi0JY3B1X21v
ZGUgPSBwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZWQgJiYgSEFTX1BDSF9MUFQoZGV2X3ByaXYpICYm
CisJY3B1X21vZGUgPSBwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZWQgJiYgSEFTX1BDSF9MUFQoaTkx
NSkgJiYKIAkJICAgIShwY2hfY3RsMSAmIEJMTV9QQ0hfT1ZFUlJJREVfRU5BQkxFKSAmJgogCQkg
ICAoY3B1X2N0bDIgJiBCTE1fUFdNX0VOQUJMRSk7CiAJaWYgKGNwdV9tb2RlKQpAQCAtMTYyMiw3
ICsxNjIyLDcgQEAgc3RhdGljIGludCBscHRfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHVudXMKIAogc3RhdGljIGludCBwY2hfc2V0
dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBl
IHVudXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVs
ID0gJmNvbm5lY3Rvci0+cGFuZWw7CiAJdTMyIGNwdV9jdGwyLCBwY2hfY3RsMSwgcGNoX2N0bDIs
IHZhbDsKIApAQCAtMTY1NCwxNiArMTY1NCwxNiBAQCBzdGF0aWMgaW50IHBjaF9zZXR1cF9iYWNr
bGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUgdW51cwog
CiBzdGF0aWMgaW50IGk5eHhfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmNvbm5lY3RvciwgZW51bSBwaXBlIHVudXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CiAJdTMyIGN0bCwgdmFs
OwogCiAJY3RsID0gSTkxNV9SRUFEKEJMQ19QV01fQ1RMKTsKIAotCWlmIChJU19HRU4oZGV2X3By
aXYsIDIpIHx8IElTX0k5MTVHTShkZXZfcHJpdikgfHwgSVNfSTk0NUdNKGRldl9wcml2KSkKKwlp
ZiAoSVNfR0VOKGk5MTUsIDIpIHx8IElTX0k5MTVHTShpOTE1KSB8fCBJU19JOTQ1R00oaTkxNSkp
CiAJCXBhbmVsLT5iYWNrbGlnaHQuY29tYmluYXRpb25fbW9kZSA9IGN0bCAmIEJMTV9MRUdBQ1lf
TU9ERTsKIAotCWlmIChJU19QSU5FVklFVyhkZXZfcHJpdikpCisJaWYgKElTX1BJTkVWSUVXKGk5
MTUpKQogCQlwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID0gY3RsICYgQkxNX1BPTEFS
SVRZX1BOVjsKIAogCXBhbmVsLT5iYWNrbGlnaHQubWF4ID0gY3RsID4+IDE3OwpAQCAtMTY5Myw3
ICsxNjkzLDcgQEAgc3RhdGljIGludCBpOXh4X3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSB1bnUKIAogc3RhdGljIGludCBpOTY1X3Nl
dHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlw
ZSB1bnVzZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5l
bCA9ICZjb25uZWN0b3ItPnBhbmVsOwogCXUzMiBjdGwsIGN0bDIsIHZhbDsKIApAQCAtMTcyNyw3
ICsxNzI3LDcgQEAgc3RhdGljIGludCBpOTY1X3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSB1bnUKIAogc3RhdGljIGludCB2bHZfc2V0
dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBl
IHBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
b25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9
ICZjb25uZWN0b3ItPnBhbmVsOwogCXUzMiBjdGwsIGN0bDIsIHZhbDsKIApAQCAtMTc0OCw3ICsx
NzQ4LDcgQEAgc3RhdGljIGludCB2bHZfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHBpcGUKIAogCXBhbmVsLT5iYWNrbGlnaHQubWlu
ID0gZ2V0X2JhY2tsaWdodF9taW5fdmJ0KGNvbm5lY3Rvcik7CiAKLQl2YWwgPSBfdmx2X2dldF9i
YWNrbGlnaHQoZGV2X3ByaXYsIHBpcGUpOworCXZhbCA9IF92bHZfZ2V0X2JhY2tsaWdodChpOTE1
LCBwaXBlKTsKIAl2YWwgPSBpbnRlbF9wYW5lbF9jb21wdXRlX2JyaWdodG5lc3MoY29ubmVjdG9y
LCB2YWwpOwogCXBhbmVsLT5iYWNrbGlnaHQubGV2ZWwgPSBjbGFtcCh2YWwsIHBhbmVsLT5iYWNr
bGlnaHQubWluLAogCQkJCSAgICAgICBwYW5lbC0+YmFja2xpZ2h0Lm1heCk7CkBAIC0xNzYxLDEx
ICsxNzYxLDExIEBAIHN0YXRpYyBpbnQgdmx2X3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSBwaXBlCiBzdGF0aWMgaW50CiBieHRfc2V0
dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBl
IHVudXNlZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVs
ID0gJmNvbm5lY3Rvci0+cGFuZWw7CiAJdTMyIHB3bV9jdGwsIHZhbDsKIAotCXBhbmVsLT5iYWNr
bGlnaHQuY29udHJvbGxlciA9IGRldl9wcml2LT52YnQuYmFja2xpZ2h0LmNvbnRyb2xsZXI7CisJ
cGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyID0gaTkxNS0+dmJ0LmJhY2tsaWdodC5jb250cm9s
bGVyOwogCiAJcHdtX2N0bCA9IEk5MTVfUkVBRChCWFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2ts
aWdodC5jb250cm9sbGVyKSk7CiAKQEAgLTE4MDEsNyArMTgwMSw3IEBAIGJ4dF9zZXR1cF9iYWNr
bGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUgdW51c2Vk
KQogc3RhdGljIGludAogY25wX3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uZWN0b3IsIGVudW0gcGlwZSB1bnVzZWQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3Ry
dWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwogCXUzMiBwd21fY3Rs
LCB2YWw7CiAKQEAgLTE4ODEsMjggKzE4ODEsMjggQEAgdm9pZCBpbnRlbF9wYW5lbF91cGRhdGVf
YmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgY29uc3Qgc3Ry
dWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2Nv
bm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5l
Y3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25u
ZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZj
b25uZWN0b3ItPnBhbmVsOwogCiAJaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnByZXNlbnQpCiAJCXJl
dHVybjsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisJbXV0ZXhf
bG9jaygmaTkxNS0+YmFja2xpZ2h0X2xvY2spOwogCWlmICghcGFuZWwtPmJhY2tsaWdodC5lbmFi
bGVkKQogCQlfX2ludGVsX3BhbmVsX2VuYWJsZV9iYWNrbGlnaHQoY3J0Y19zdGF0ZSwgY29ubl9z
dGF0ZSk7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5iYWNrbGlnaHRfbG9jayk7CiB9CiAKIGludCBpbnRlbF9wYW5lbF9z
ZXR1cF9iYWNrbGlnaHQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBl
IHBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
b25uZWN0b3ItPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KGNvbm5lY3Rvci0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0
b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwg
KnBhbmVsID0gJmludGVsX2Nvbm5lY3Rvci0+cGFuZWw7CiAJaW50IHJldDsKIAotCWlmICghZGV2
X3ByaXYtPnZidC5iYWNrbGlnaHQucHJlc2VudCkgewotCQlpZiAoZGV2X3ByaXYtPnF1aXJrcyAm
IFFVSVJLX0JBQ0tMSUdIVF9QUkVTRU5UKSB7CisJaWYgKCFpOTE1LT52YnQuYmFja2xpZ2h0LnBy
ZXNlbnQpIHsKKwkJaWYgKGk5MTUtPnF1aXJrcyAmIFFVSVJLX0JBQ0tMSUdIVF9QUkVTRU5UKSB7
CiAJCQlEUk1fREVCVUdfS01TKCJubyBiYWNrbGlnaHQgcHJlc2VudCBwZXIgVkJULCBidXQgcHJl
c2VudCBwZXIgcXVpcmtcbiIpOwogCQl9IGVsc2UgewogCQkJRFJNX0RFQlVHX0tNUygibm8gYmFj
a2xpZ2h0IHByZXNlbnQgcGVyIFZCVFxuIik7CkBAIC0xOTE1LDkgKzE5MTUsOSBAQCBpbnQgaW50
ZWxfcGFuZWxfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3Is
IGVudW0gcGlwZSBwaXBlKQogCQlyZXR1cm4gLUVOT0RFVjsKIAogCS8qIHNldCBsZXZlbCBhbmQg
bWF4IGluIHBhbmVsIHN0cnVjdCAqLwotCW11dGV4X2xvY2soJmRldl9wcml2LT5iYWNrbGlnaHRf
bG9jayk7CisJbXV0ZXhfbG9jaygmaTkxNS0+YmFja2xpZ2h0X2xvY2spOwogCXJldCA9IHBhbmVs
LT5iYWNrbGlnaHQuc2V0dXAoaW50ZWxfY29ubmVjdG9yLCBwaXBlKTsKLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5iYWNrbGln
aHRfbG9jayk7CiAKIAlpZiAocmV0KSB7CiAJCURSTV9ERUJVR19LTVMoImZhaWxlZCB0byBzZXR1
cCBiYWNrbGlnaHQgZm9yIGNvbm5lY3RvciAlc1xuIiwKQEAgLTE5NTAsNyArMTk1MCw3IEBAIGlu
dGVsX3BhbmVsX2luaXRfYmFja2xpZ2h0X2Z1bmNzKHN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwp
CiB7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0KIAkJY29udGFpbmVyX29m
KHBhbmVsLCBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yLCBwYW5lbCk7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7
CiAKIAlpZiAoY29ubmVjdG9yLT5iYXNlLmNvbm5lY3Rvcl90eXBlID09IERSTV9NT0RFX0NPTk5F
Q1RPUl9lRFAgJiYKIAkgICAgaW50ZWxfZHBfYXV4X2luaXRfYmFja2xpZ2h0X2Z1bmNzKGNvbm5l
Y3RvcikgPT0gMCkKQEAgLTE5NjAsMzggKzE5NjAsMzggQEAgaW50ZWxfcGFuZWxfaW5pdF9iYWNr
bGlnaHRfZnVuY3Moc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCkKIAkgICAgaW50ZWxfZHNpX2Rj
c19pbml0X2JhY2tsaWdodF9mdW5jcyhjb25uZWN0b3IpID09IDApCiAJCXJldHVybjsKIAotCWlm
IChJU19HRU45X0xQKGRldl9wcml2KSkgeworCWlmIChJU19HRU45X0xQKGk5MTUpKSB7CiAJCXBh
bmVsLT5iYWNrbGlnaHQuc2V0dXAgPSBieHRfc2V0dXBfYmFja2xpZ2h0OwogCQlwYW5lbC0+YmFj
a2xpZ2h0LmVuYWJsZSA9IGJ4dF9lbmFibGVfYmFja2xpZ2h0OwogCQlwYW5lbC0+YmFja2xpZ2h0
LmRpc2FibGUgPSBieHRfZGlzYWJsZV9iYWNrbGlnaHQ7CiAJCXBhbmVsLT5iYWNrbGlnaHQuc2V0
ID0gYnh0X3NldF9iYWNrbGlnaHQ7CiAJCXBhbmVsLT5iYWNrbGlnaHQuZ2V0ID0gYnh0X2dldF9i
YWNrbGlnaHQ7CiAJCXBhbmVsLT5iYWNrbGlnaHQuaHpfdG9fcHdtID0gYnh0X2h6X3RvX3B3bTsK
LQl9IGVsc2UgaWYgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQQ0hfQ05QKSB7CisJfSBl
bHNlIGlmIChJTlRFTF9QQ0hfVFlQRShpOTE1KSA+PSBQQ0hfQ05QKSB7CiAJCXBhbmVsLT5iYWNr
bGlnaHQuc2V0dXAgPSBjbnBfc2V0dXBfYmFja2xpZ2h0OwogCQlwYW5lbC0+YmFja2xpZ2h0LmVu
YWJsZSA9IGNucF9lbmFibGVfYmFja2xpZ2h0OwogCQlwYW5lbC0+YmFja2xpZ2h0LmRpc2FibGUg
PSBjbnBfZGlzYWJsZV9iYWNrbGlnaHQ7CiAJCXBhbmVsLT5iYWNrbGlnaHQuc2V0ID0gYnh0X3Nl
dF9iYWNrbGlnaHQ7CiAJCXBhbmVsLT5iYWNrbGlnaHQuZ2V0ID0gYnh0X2dldF9iYWNrbGlnaHQ7
CiAJCXBhbmVsLT5iYWNrbGlnaHQuaHpfdG9fcHdtID0gY25wX2h6X3RvX3B3bTsKLQl9IGVsc2Ug
aWYgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQQ0hfTFBUKSB7CisJfSBlbHNlIGlmIChJ
TlRFTF9QQ0hfVFlQRShpOTE1KSA+PSBQQ0hfTFBUKSB7CiAJCXBhbmVsLT5iYWNrbGlnaHQuc2V0
dXAgPSBscHRfc2V0dXBfYmFja2xpZ2h0OwogCQlwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZSA9IGxw
dF9lbmFibGVfYmFja2xpZ2h0OwogCQlwYW5lbC0+YmFja2xpZ2h0LmRpc2FibGUgPSBscHRfZGlz
YWJsZV9iYWNrbGlnaHQ7CiAJCXBhbmVsLT5iYWNrbGlnaHQuc2V0ID0gbHB0X3NldF9iYWNrbGln
aHQ7CiAJCXBhbmVsLT5iYWNrbGlnaHQuZ2V0ID0gbHB0X2dldF9iYWNrbGlnaHQ7Ci0JCWlmIChI
QVNfUENIX0xQVChkZXZfcHJpdikpCisJCWlmIChIQVNfUENIX0xQVChpOTE1KSkKIAkJCXBhbmVs
LT5iYWNrbGlnaHQuaHpfdG9fcHdtID0gbHB0X2h6X3RvX3B3bTsKIAkJZWxzZQogCQkJcGFuZWwt
PmJhY2tsaWdodC5oel90b19wd20gPSBzcHRfaHpfdG9fcHdtOwotCX0gZWxzZSBpZiAoSEFTX1BD
SF9TUExJVChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKEhBU19QQ0hfU1BMSVQoaTkxNSkpIHsK
IAkJcGFuZWwtPmJhY2tsaWdodC5zZXR1cCA9IHBjaF9zZXR1cF9iYWNrbGlnaHQ7CiAJCXBhbmVs
LT5iYWNrbGlnaHQuZW5hYmxlID0gcGNoX2VuYWJsZV9iYWNrbGlnaHQ7CiAJCXBhbmVsLT5iYWNr
bGlnaHQuZGlzYWJsZSA9IHBjaF9kaXNhYmxlX2JhY2tsaWdodDsKIAkJcGFuZWwtPmJhY2tsaWdo
dC5zZXQgPSBwY2hfc2V0X2JhY2tsaWdodDsKIAkJcGFuZWwtPmJhY2tsaWdodC5nZXQgPSBwY2hf
Z2V0X2JhY2tsaWdodDsKIAkJcGFuZWwtPmJhY2tsaWdodC5oel90b19wd20gPSBwY2hfaHpfdG9f
cHdtOwotCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklF
VyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hF
UlJZVklFVyhpOTE1KSkgewogCQlpZiAoY29ubmVjdG9yLT5iYXNlLmNvbm5lY3Rvcl90eXBlID09
IERSTV9NT0RFX0NPTk5FQ1RPUl9EU0kpIHsKIAkJCXBhbmVsLT5iYWNrbGlnaHQuc2V0dXAgPSBw
d21fc2V0dXBfYmFja2xpZ2h0OwogCQkJcGFuZWwtPmJhY2tsaWdodC5lbmFibGUgPSBwd21fZW5h
YmxlX2JhY2tsaWdodDsKQEAgLTIwMDYsNyArMjAwNiw3IEBAIGludGVsX3BhbmVsX2luaXRfYmFj
a2xpZ2h0X2Z1bmNzKHN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwpCiAJCQlwYW5lbC0+YmFja2xp
Z2h0LmdldCA9IHZsdl9nZXRfYmFja2xpZ2h0OwogCQkJcGFuZWwtPmJhY2tsaWdodC5oel90b19w
d20gPSB2bHZfaHpfdG9fcHdtOwogCQl9Ci0JfSBlbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDQp
KSB7CisJfSBlbHNlIGlmIChJU19HRU4oaTkxNSwgNCkpIHsKIAkJcGFuZWwtPmJhY2tsaWdodC5z
ZXR1cCA9IGk5NjVfc2V0dXBfYmFja2xpZ2h0OwogCQlwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZSA9
IGk5NjVfZW5hYmxlX2JhY2tsaWdodDsKIAkJcGFuZWwtPmJhY2tsaWdodC5kaXNhYmxlID0gaTk2
NV9kaXNhYmxlX2JhY2tsaWdodDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3BpcGVfY3JjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9waXBlX2NyYy5jCmlu
ZGV4IDFlMmM0MzA3ZDA1YS4uNGE0NDA5ZjQwNzZmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9waXBlX2NyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3BpcGVfY3JjLmMKQEAgLTcwLDExICs3MCwxMSBAQCBzdGF0aWMgaW50IGk4eHhfcGlwZV9jcmNf
Y3RsX3JlZyhlbnVtIGludGVsX3BpcGVfY3JjX3NvdXJjZSAqc291cmNlLAogCXJldHVybiAwOwog
fQogCi1zdGF0aWMgaW50IGk5eHhfcGlwZV9jcmNfYXV0b19zb3VyY2Uoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGludCBpOXh4X3BpcGVfY3JjX2F1dG9fc291cmNl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgZW51bSBwaXBlIHBpcGUs
CiAJCQkJICAgICBlbnVtIGludGVsX3BpcGVfY3JjX3NvdXJjZSAqc291cmNlKQogewotCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9y
dDsKQEAgLTEyNCw3ICsxMjQsNyBAQCBzdGF0aWMgaW50IGk5eHhfcGlwZV9jcmNfYXV0b19zb3Vy
Y2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiByZXQ7CiB9CiAK
LXN0YXRpYyBpbnQgdmx2X3BpcGVfY3JjX2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIGludCB2bHZfcGlwZV9jcmNfY3RsX3JlZyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQllbnVtIHBpcGUgcGlwZSwKIAkJCQllbnVtIGludGVsX3Bp
cGVfY3JjX3NvdXJjZSAqc291cmNlLAogCQkJCXUzMiAqdmFsKQpAQCAtMTMyLDcgKzEzMiw3IEBA
IHN0YXRpYyBpbnQgdmx2X3BpcGVfY3JjX2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCWJvb2wgbmVlZF9zdGFibGVfc3ltYm9scyA9IGZhbHNlOwogCiAJaWYgKCpz
b3VyY2UgPT0gSU5URUxfUElQRV9DUkNfU09VUkNFX0FVVE8pIHsKLQkJaW50IHJldCA9IGk5eHhf
cGlwZV9jcmNfYXV0b19zb3VyY2UoZGV2X3ByaXYsIHBpcGUsIHNvdXJjZSk7CisJCWludCByZXQg
PSBpOXh4X3BpcGVfY3JjX2F1dG9fc291cmNlKGk5MTUsIHBpcGUsIHNvdXJjZSk7CiAJCWlmIChy
ZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KQEAgLTE1MCw3ICsxNTAsNyBAQCBzdGF0aWMgaW50IHZs
dl9waXBlX2NyY19jdGxfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJ
bmVlZF9zdGFibGVfc3ltYm9scyA9IHRydWU7CiAJCWJyZWFrOwogCWNhc2UgSU5URUxfUElQRV9D
UkNfU09VUkNFX0RQX0Q6Ci0JCWlmICghSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJCWlmICgh
SVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJCXJldHVybiAtRUlOVkFMOwogCQkqdmFsID0gUElQRV9D
UkNfRU5BQkxFIHwgUElQRV9DUkNfU09VUkNFX0RQX0RfVkxWOwogCQluZWVkX3N0YWJsZV9zeW1i
b2xzID0gdHJ1ZTsKQEAgLTE5NCwxMyArMTk0LDEzIEBAIHN0YXRpYyBpbnQgdmx2X3BpcGVfY3Jj
X2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiAwOwog
fQogCi1zdGF0aWMgaW50IGk5eHhfcGlwZV9jcmNfY3RsX3JlZyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgaW50IGk5eHhfcGlwZV9jcmNfY3RsX3JlZyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgZW51bSBwaXBlIHBpcGUsCiAJCQkJIGVudW0g
aW50ZWxfcGlwZV9jcmNfc291cmNlICpzb3VyY2UsCiAJCQkJIHUzMiAqdmFsKQogewogCWlmICgq
c291cmNlID09IElOVEVMX1BJUEVfQ1JDX1NPVVJDRV9BVVRPKSB7Ci0JCWludCByZXQgPSBpOXh4
X3BpcGVfY3JjX2F1dG9fc291cmNlKGRldl9wcml2LCBwaXBlLCBzb3VyY2UpOworCQlpbnQgcmV0
ID0gaTl4eF9waXBlX2NyY19hdXRvX3NvdXJjZShpOTE1LCBwaXBlLCBzb3VyY2UpOwogCQlpZiAo
cmV0KQogCQkJcmV0dXJuIHJldDsKIAl9CkBAIC0yMTAsNyArMjEwLDcgQEAgc3RhdGljIGludCBp
OXh4X3BpcGVfY3JjX2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CQkqdmFsID0gUElQRV9DUkNfRU5BQkxFIHwgUElQRV9DUkNfU09VUkNFX1BJUEVfSTlYWDsKIAkJ
YnJlYWs7CiAJY2FzZSBJTlRFTF9QSVBFX0NSQ19TT1VSQ0VfVFY6Ci0JCWlmICghU1VQUE9SVFNf
VFYoZGV2X3ByaXYpKQorCQlpZiAoIVNVUFBPUlRTX1RWKGk5MTUpKQogCQkJcmV0dXJuIC1FSU5W
QUw7CiAJCSp2YWwgPSBQSVBFX0NSQ19FTkFCTEUgfCBQSVBFX0NSQ19TT1VSQ0VfVFZfUFJFOwog
CQlicmVhazsKQEAgLTIzNCw3ICsyMzQsNyBAQCBzdGF0aWMgaW50IGk5eHhfcGlwZV9jcmNfY3Rs
X3JlZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIDA7CiB9CiAK
LXN0YXRpYyB2b2lkIHZsdl91bmRvX3BpcGVfc2NyYW1ibGVfcmVzZXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgdmx2X3VuZG9fcGlwZV9zY3JhbWJsZV9y
ZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJIGVudW0gcGlwZSBwaXBl
KQogewogCXUzMiB0bXAgPSBJOTE1X1JFQUQoUE9SVF9ERlQyX0c0WCk7CkBAIC0yODYsNyArMjg2
LDcgQEAgc3RhdGljIGludCBpbGtfcGlwZV9jcmNfY3RsX3JlZyhlbnVtIGludGVsX3BpcGVfY3Jj
X3NvdXJjZSAqc291cmNlLAogc3RhdGljIHZvaWQKIGludGVsX2NydGNfY3JjX3NldHVwX3dvcmth
cm91bmRzKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLCBib29sIGVuYWJsZSkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwog
CXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZzsKIAlzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqc3RhdGU7CiAJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4IGN0eDsKQEAg
LTI5NCw3ICsyOTQsNyBAQCBpbnRlbF9jcnRjX2NyY19zZXR1cF93b3JrYXJvdW5kcyhzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywgYm9vbCBlbmFibGUpCiAKIAlkcm1fbW9kZXNldF9hY3F1aXJlX2lu
aXQoJmN0eCwgMCk7CiAKLQlzdGF0ZSA9IGRybV9hdG9taWNfc3RhdGVfYWxsb2MoJmRldl9wcml2
LT5kcm0pOworCXN0YXRlID0gZHJtX2F0b21pY19zdGF0ZV9hbGxvYygmaTkxNS0+ZHJtKTsKIAlp
ZiAoIXN0YXRlKSB7CiAJCXJldCA9IC1FTk9NRU07CiAJCWdvdG8gdW5sb2NrOwpAQCAtMzEyLDcg
KzMxMiw3IEBAIGludGVsX2NydGNfY3JjX3NldHVwX3dvcmthcm91bmRzKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLCBib29sIGVuYWJsZSkKIAlwaXBlX2NvbmZpZy0+YmFzZS5tb2RlX2NoYW5nZWQg
PSBwaXBlX2NvbmZpZy0+aGFzX3BzcjsKIAlwaXBlX2NvbmZpZy0+Y3JjX2VuYWJsZWQgPSBlbmFi
bGU7CiAKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgJiYKKwlpZiAoSVNfSEFTV0VMTChpOTE1
KSAmJgogCSAgICBwaXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUgJiYgY3J0Yy0+cGlwZSA9PSBQSVBF
X0EgJiYKIAkgICAgcGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09ERVJfRURQ
KQogCQlwaXBlX2NvbmZpZy0+YmFzZS5tb2RlX2NoYW5nZWQgPSB0cnVlOwpAQCAtMzMzLDcgKzMz
Myw3IEBAIGludGVsX2NydGNfY3JjX3NldHVwX3dvcmthcm91bmRzKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLCBib29sIGVuYWJsZSkKIAlkcm1fbW9kZXNldF9hY3F1aXJlX2ZpbmkoJmN0eCk7CiB9
CiAKLXN0YXRpYyBpbnQgaXZiX3BpcGVfY3JjX2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorc3RhdGljIGludCBpdmJfcGlwZV9jcmNfY3RsX3JlZyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQllbnVtIHBpcGUgcGlwZSwKIAkJCQllbnVtIGludGVs
X3BpcGVfY3JjX3NvdXJjZSAqc291cmNlLAogCQkJCXUzMiAqdmFsKQpAQCAtMzYxLDcgKzM2MSw3
IEBAIHN0YXRpYyBpbnQgaXZiX3BpcGVfY3JjX2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHNrbF9waXBlX2NyY19j
dGxfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBpbnQgc2ts
X3BpcGVfY3JjX2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJZW51
bSBwaXBlIHBpcGUsCiAJCQkJZW51bSBpbnRlbF9waXBlX2NyY19zb3VyY2UgKnNvdXJjZSwKIAkJ
CQl1MzIgKnZhbCkKQEAgLTQwNCwyMiArNDA0LDIyIEBAIHN0YXRpYyBpbnQgc2tsX3BpcGVfY3Jj
X2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiAwOwog
fQogCi1zdGF0aWMgaW50IGdldF9uZXdfY3JjX2N0bF9yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorc3RhdGljIGludCBnZXRfbmV3X2NyY19jdGxfcmVnKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgIGVudW0gcGlwZSBwaXBlLAogCQkJICAgICAg
IGVudW0gaW50ZWxfcGlwZV9jcmNfc291cmNlICpzb3VyY2UsIHUzMiAqdmFsKQogewotCWlmIChJ
U19HRU4oZGV2X3ByaXYsIDIpKQorCWlmIChJU19HRU4oaTkxNSwgMikpCiAJCXJldHVybiBpOHh4
X3BpcGVfY3JjX2N0bF9yZWcoc291cmNlLCB2YWwpOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPCA1KQotCQlyZXR1cm4gaTl4eF9waXBlX2NyY19jdGxfcmVnKGRldl9wcml2LCBwaXBl
LCBzb3VyY2UsIHZhbCk7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNf
Q0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCXJldHVybiB2bHZfcGlwZV9jcmNfY3RsX3JlZyhkZXZf
cHJpdiwgcGlwZSwgc291cmNlLCB2YWwpOwotCWVsc2UgaWYgKElTX0dFTl9SQU5HRShkZXZfcHJp
diwgNSwgNikpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpIDwgNSkKKwkJcmV0dXJuIGk5eHhf
cGlwZV9jcmNfY3RsX3JlZyhpOTE1LCBwaXBlLCBzb3VyY2UsIHZhbCk7CisJZWxzZSBpZiAoSVNf
VkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQorCQlyZXR1cm4gdmx2X3Bp
cGVfY3JjX2N0bF9yZWcoaTkxNSwgcGlwZSwgc291cmNlLCB2YWwpOworCWVsc2UgaWYgKElTX0dF
Tl9SQU5HRShpOTE1LCA1LCA2KSkKIAkJcmV0dXJuIGlsa19waXBlX2NyY19jdGxfcmVnKHNvdXJj
ZSwgdmFsKTsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSkKLQkJcmV0dXJuIGl2
Yl9waXBlX2NyY19jdGxfcmVnKGRldl9wcml2LCBwaXBlLCBzb3VyY2UsIHZhbCk7CisJZWxzZSBp
ZiAoSU5URUxfR0VOKGk5MTUpIDwgOSkKKwkJcmV0dXJuIGl2Yl9waXBlX2NyY19jdGxfcmVnKGk5
MTUsIHBpcGUsIHNvdXJjZSwgdmFsKTsKIAllbHNlCi0JCXJldHVybiBza2xfcGlwZV9jcmNfY3Rs
X3JlZyhkZXZfcHJpdiwgcGlwZSwgc291cmNlLCB2YWwpOworCQlyZXR1cm4gc2tsX3BpcGVfY3Jj
X2N0bF9yZWcoaTkxNSwgcGlwZSwgc291cmNlLCB2YWwpOwogfQogCiBzdGF0aWMgaW50CkBAIC00
NDAsMTggKzQ0MCwxOCBAQCBkaXNwbGF5X2NyY19jdGxfcGFyc2Vfc291cmNlKGNvbnN0IGNoYXIg
KmJ1ZiwgZW51bSBpbnRlbF9waXBlX2NyY19zb3VyY2UgKnMpCiAJcmV0dXJuIDA7CiB9CiAKLXZv
aWQgaW50ZWxfZGlzcGxheV9jcmNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCit2b2lkIGludGVsX2Rpc3BsYXlfY3JjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJZW51bSBwaXBlIHBpcGU7CiAKLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBw
aXBlKSB7Ci0JCXN0cnVjdCBpbnRlbF9waXBlX2NyYyAqcGlwZV9jcmMgPSAmZGV2X3ByaXYtPnBp
cGVfY3JjW3BpcGVdOworCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkgeworCQlzdHJ1Y3QgaW50
ZWxfcGlwZV9jcmMgKnBpcGVfY3JjID0gJmk5MTUtPnBpcGVfY3JjW3BpcGVdOwogCiAJCXNwaW5f
bG9ja19pbml0KCZwaXBlX2NyYy0+bG9jayk7CiAJfQogfQogCi1zdGF0aWMgaW50IGk4eHhfY3Jj
X3NvdXJjZV92YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
aW50IGk4eHhfY3JjX3NvdXJjZV92YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgY29uc3QgZW51bSBpbnRlbF9waXBlX2NyY19zb3VyY2Ugc291cmNlKQogewogCXN3aXRj
aCAoc291cmNlKSB7CkBAIC00NjMsNyArNDYzLDcgQEAgc3RhdGljIGludCBpOHh4X2NyY19zb3Vy
Y2VfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0KIAotc3Rh
dGljIGludCBpOXh4X2NyY19zb3VyY2VfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAorc3RhdGljIGludCBpOXh4X2NyY19zb3VyY2VfdmFsaWQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJIGNvbnN0IGVudW0gaW50ZWxfcGlwZV9jcmNfc291cmNlIHNv
dXJjZSkKIHsKIAlzd2l0Y2ggKHNvdXJjZSkgewpAQCAtNDc2LDcgKzQ3Niw3IEBAIHN0YXRpYyBp
bnQgaTl4eF9jcmNfc291cmNlX3ZhbGlkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAl9CiB9CiAKLXN0YXRpYyBpbnQgdmx2X2NyY19zb3VyY2VfdmFsaWQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGludCB2bHZfY3JjX3NvdXJjZV92YWxpZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQljb25zdCBlbnVtIGludGVsX3BpcGVf
Y3JjX3NvdXJjZSBzb3VyY2UpCiB7CiAJc3dpdGNoIChzb3VyY2UpIHsKQEAgLTQ5MSw3ICs0OTEs
NyBAQCBzdGF0aWMgaW50IHZsdl9jcmNfc291cmNlX3ZhbGlkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAl9CiB9CiAKLXN0YXRpYyBpbnQgaWxrX2NyY19zb3VyY2VfdmFsaWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGludCBpbGtfY3JjX3Nv
dXJjZV92YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQljb25zdCBlbnVt
IGludGVsX3BpcGVfY3JjX3NvdXJjZSBzb3VyY2UpCiB7CiAJc3dpdGNoIChzb3VyY2UpIHsKQEAg
LTUwNSw3ICs1MDUsNyBAQCBzdGF0aWMgaW50IGlsa19jcmNfc291cmNlX3ZhbGlkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl9CiB9CiAKLXN0YXRpYyBpbnQgaXZiX2NyY19z
b3VyY2VfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGlu
dCBpdmJfY3JjX3NvdXJjZV92YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQljb25zdCBlbnVtIGludGVsX3BpcGVfY3JjX3NvdXJjZSBzb3VyY2UpCiB7CiAJc3dpdGNoIChz
b3VyY2UpIHsKQEAgLTUxOSw3ICs1MTksNyBAQCBzdGF0aWMgaW50IGl2Yl9jcmNfc291cmNlX3Zh
bGlkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl9CiB9CiAKLXN0YXRpYyBp
bnQgc2tsX2NyY19zb3VyY2VfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIGludCBza2xfY3JjX3NvdXJjZV92YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQljb25zdCBlbnVtIGludGVsX3BpcGVfY3JjX3NvdXJjZSBzb3VyY2UpCiB7
CiAJc3dpdGNoIChzb3VyY2UpIHsKQEAgLTUzOSwyMSArNTM5LDIxIEBAIHN0YXRpYyBpbnQgc2ts
X2NyY19zb3VyY2VfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQog
CiBzdGF0aWMgaW50Ci1pbnRlbF9pc192YWxpZF9jcmNfc291cmNlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK2ludGVsX2lzX3ZhbGlkX2NyY19zb3VyY2Uoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIGNvbnN0IGVudW0gaW50ZWxfcGlwZV9jcmNfc291cmNl
IHNvdXJjZSkKIHsKLQlpZiAoSVNfR0VOKGRldl9wcml2LCAyKSkKLQkJcmV0dXJuIGk4eHhfY3Jj
X3NvdXJjZV92YWxpZChkZXZfcHJpdiwgc291cmNlKTsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpIDwgNSkKLQkJcmV0dXJuIGk5eHhfY3JjX3NvdXJjZV92YWxpZChkZXZfcHJpdiwgc291
cmNlKTsKLQllbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVX
KGRldl9wcml2KSkKLQkJcmV0dXJuIHZsdl9jcmNfc291cmNlX3ZhbGlkKGRldl9wcml2LCBzb3Vy
Y2UpOwotCWVsc2UgaWYgKElTX0dFTl9SQU5HRShkZXZfcHJpdiwgNSwgNikpCi0JCXJldHVybiBp
bGtfY3JjX3NvdXJjZV92YWxpZChkZXZfcHJpdiwgc291cmNlKTsKLQllbHNlIGlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpIDwgOSkKLQkJcmV0dXJuIGl2Yl9jcmNfc291cmNlX3ZhbGlkKGRldl9wcml2
LCBzb3VyY2UpOworCWlmIChJU19HRU4oaTkxNSwgMikpCisJCXJldHVybiBpOHh4X2NyY19zb3Vy
Y2VfdmFsaWQoaTkxNSwgc291cmNlKTsKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPCA1KQor
CQlyZXR1cm4gaTl4eF9jcmNfc291cmNlX3ZhbGlkKGk5MTUsIHNvdXJjZSk7CisJZWxzZSBpZiAo
SVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKQorCQlyZXR1cm4gdmx2
X2NyY19zb3VyY2VfdmFsaWQoaTkxNSwgc291cmNlKTsKKwllbHNlIGlmIChJU19HRU5fUkFOR0Uo
aTkxNSwgNSwgNikpCisJCXJldHVybiBpbGtfY3JjX3NvdXJjZV92YWxpZChpOTE1LCBzb3VyY2Up
OworCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA8IDkpCisJCXJldHVybiBpdmJfY3JjX3NvdXJj
ZV92YWxpZChpOTE1LCBzb3VyY2UpOwogCWVsc2UKLQkJcmV0dXJuIHNrbF9jcmNfc291cmNlX3Zh
bGlkKGRldl9wcml2LCBzb3VyY2UpOworCQlyZXR1cm4gc2tsX2NyY19zb3VyY2VfdmFsaWQoaTkx
NSwgc291cmNlKTsKIH0KIAogY29uc3QgY2hhciAqY29uc3QgKmludGVsX2NydGNfZ2V0X2NyY19z
b3VyY2VzKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKQEAgLTU2Niw3ICs1NjYsNyBAQCBjb25zdCBj
aGFyICpjb25zdCAqaW50ZWxfY3J0Y19nZXRfY3JjX3NvdXJjZXMoc3RydWN0IGRybV9jcnRjICpj
cnRjLAogaW50IGludGVsX2NydGNfdmVyaWZ5X2NyY19zb3VyY2Uoc3RydWN0IGRybV9jcnRjICpj
cnRjLCBjb25zdCBjaGFyICpzb3VyY2VfbmFtZSwKIAkJCQkgc2l6ZV90ICp2YWx1ZXNfY250KQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+ZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+ZGV2KTsK
IAllbnVtIGludGVsX3BpcGVfY3JjX3NvdXJjZSBzb3VyY2U7CiAKIAlpZiAoZGlzcGxheV9jcmNf
Y3RsX3BhcnNlX3NvdXJjZShzb3VyY2VfbmFtZSwgJnNvdXJjZSkgPCAwKSB7CkBAIC01NzUsNyAr
NTc1LDcgQEAgaW50IGludGVsX2NydGNfdmVyaWZ5X2NyY19zb3VyY2Uoc3RydWN0IGRybV9jcnRj
ICpjcnRjLCBjb25zdCBjaGFyICpzb3VyY2VfbmFtZSwKIAl9CiAKIAlpZiAoc291cmNlID09IElO
VEVMX1BJUEVfQ1JDX1NPVVJDRV9BVVRPIHx8Ci0JICAgIGludGVsX2lzX3ZhbGlkX2NyY19zb3Vy
Y2UoZGV2X3ByaXYsIHNvdXJjZSkgPT0gMCkgeworCSAgICBpbnRlbF9pc192YWxpZF9jcmNfc291
cmNlKGk5MTUsIHNvdXJjZSkgPT0gMCkgewogCQkqdmFsdWVzX2NudCA9IDU7CiAJCXJldHVybiAw
OwogCX0KQEAgLTU4NSw4ICs1ODUsOCBAQCBpbnQgaW50ZWxfY3J0Y192ZXJpZnlfY3JjX3NvdXJj
ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIGNvbnN0IGNoYXIgKnNvdXJjZV9uYW1lLAogCiBpbnQg
aW50ZWxfY3J0Y19zZXRfY3JjX3NvdXJjZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIGNvbnN0IGNo
YXIgKnNvdXJjZV9uYW1lKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGlwZV9jcmMgKnBpcGVfY3JjID0g
JmRldl9wcml2LT5waXBlX2NyY1tjcnRjLT5pbmRleF07CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmRldik7CisJc3RydWN0IGludGVsX3BpcGVfY3JjICpw
aXBlX2NyYyA9ICZpOTE1LT5waXBlX2NyY1tjcnRjLT5pbmRleF07CiAJZW51bSBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CiAJZW51bSBpbnRlbF9waXBlX2NyY19zb3Vy
Y2Ugc291cmNlOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwpAQCAtNjAwLDcgKzYwMCw3IEBA
IGludCBpbnRlbF9jcnRjX3NldF9jcmNfc291cmNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgY29u
c3QgY2hhciAqc291cmNlX25hbWUpCiAJfQogCiAJcG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlO
X1BJUEUoY3J0Yy0+aW5kZXgpOwotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9p
Zl9lbmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21haW4pOworCXdha2VyZWYgPSBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsIHBvd2VyX2RvbWFpbik7CiAJaWYgKCF3YWtl
cmVmKSB7CiAJCURSTV9ERUJVR19LTVMoIlRyeWluZyB0byBjYXB0dXJlIENSQyB3aGlsZSBwaXBl
IGlzIG9mZlxuIik7CiAJCXJldHVybiAtRUlPOwpAQCAtNjEwLDcgKzYxMCw3IEBAIGludCBpbnRl
bF9jcnRjX3NldF9jcmNfc291cmNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgY29uc3QgY2hhciAq
c291cmNlX25hbWUpCiAJaWYgKGVuYWJsZSkKIAkJaW50ZWxfY3J0Y19jcmNfc2V0dXBfd29ya2Fy
b3VuZHModG9faW50ZWxfY3J0YyhjcnRjKSwgdHJ1ZSk7CiAKLQlyZXQgPSBnZXRfbmV3X2NyY19j
dGxfcmVnKGRldl9wcml2LCBjcnRjLT5pbmRleCwgJnNvdXJjZSwgJnZhbCk7CisJcmV0ID0gZ2V0
X25ld19jcmNfY3RsX3JlZyhpOTE1LCBjcnRjLT5pbmRleCwgJnNvdXJjZSwgJnZhbCk7CiAJaWYg
KHJldCAhPSAwKQogCQlnb3RvIG91dDsKIApAQCAtNjE5LDggKzYxOSw4IEBAIGludCBpbnRlbF9j
cnRjX3NldF9jcmNfc291cmNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgY29uc3QgY2hhciAqc291
cmNlX25hbWUpCiAJUE9TVElOR19SRUFEKFBJUEVfQ1JDX0NUTChjcnRjLT5pbmRleCkpOwogCiAJ
aWYgKCFzb3VyY2UpIHsKLQkJaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJS
WVZJRVcoZGV2X3ByaXYpKQotCQkJdmx2X3VuZG9fcGlwZV9zY3JhbWJsZV9yZXNldChkZXZfcHJp
diwgY3J0Yy0+aW5kZXgpOworCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllW
SUVXKGk5MTUpKQorCQkJdmx2X3VuZG9fcGlwZV9zY3JhbWJsZV9yZXNldChpOTE1LCBjcnRjLT5p
bmRleCk7CiAJfQogCiAJcGlwZV9jcmMtPnNraXBwZWQgPSAwOwpAQCAtNjI5LDcgKzYyOSw3IEBA
IGludCBpbnRlbF9jcnRjX3NldF9jcmNfc291cmNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywgY29u
c3QgY2hhciAqc291cmNlX25hbWUpCiAJaWYgKCFlbmFibGUpCiAJCWludGVsX2NydGNfY3JjX3Nl
dHVwX3dvcmthcm91bmRzKHRvX2ludGVsX2NydGMoY3J0YyksIGZhbHNlKTsKIAotCWludGVsX2Rp
c3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBwb3dlcl9kb21haW4sIHdha2VyZWYpOworCWludGVs
X2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsIHBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CiAKIAlyZXR1
cm4gcmV0OwogfQpAQCAtNjM3LDE0ICs2MzcsMTQgQEAgaW50IGludGVsX2NydGNfc2V0X2NyY19z
b3VyY2Uoc3RydWN0IGRybV9jcnRjICpjcnRjLCBjb25zdCBjaGFyICpzb3VyY2VfbmFtZSkKIHZv
aWQgaW50ZWxfY3J0Y19lbmFibGVfcGlwZV9jcmMoc3RydWN0IGludGVsX2NydGMgKmludGVsX2Ny
dGMpCiB7CiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gJmludGVsX2NydGMtPmJhc2U7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5kZXYpOwotCXN0
cnVjdCBpbnRlbF9waXBlX2NyYyAqcGlwZV9jcmMgPSAmZGV2X3ByaXYtPnBpcGVfY3JjW2NydGMt
PmluZGV4XTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+
ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGlwZV9jcmMgKnBpcGVfY3JjID0gJmk5MTUtPnBpcGVfY3Jj
W2NydGMtPmluZGV4XTsKIAl1MzIgdmFsID0gMDsKIAogCWlmICghY3J0Yy0+Y3JjLm9wZW5lZCkK
IAkJcmV0dXJuOwogCi0JaWYgKGdldF9uZXdfY3JjX2N0bF9yZWcoZGV2X3ByaXYsIGNydGMtPmlu
ZGV4LCAmcGlwZV9jcmMtPnNvdXJjZSwgJnZhbCkgPCAwKQorCWlmIChnZXRfbmV3X2NyY19jdGxf
cmVnKGk5MTUsIGNydGMtPmluZGV4LCAmcGlwZV9jcmMtPnNvdXJjZSwgJnZhbCkgPCAwKQogCQly
ZXR1cm47CiAKIAkvKiBEb24ndCBuZWVkIHBpcGVfY3JjLT5sb2NrIGhlcmUsIElSUXMgYXJlIG5v
dCBnZW5lcmF0ZWQuICovCkBAIC02NTcsOCArNjU3LDggQEAgdm9pZCBpbnRlbF9jcnRjX2VuYWJs
ZV9waXBlX2NyYyhzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YykKIHZvaWQgaW50ZWxfY3J0
Y19kaXNhYmxlX3BpcGVfY3JjKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjKQogewogCXN0
cnVjdCBkcm1fY3J0YyAqY3J0YyA9ICZpbnRlbF9jcnRjLT5iYXNlOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxf
cGlwZV9jcmMgKnBpcGVfY3JjID0gJmRldl9wcml2LT5waXBlX2NyY1tjcnRjLT5pbmRleF07CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmRldik7CisJc3Ry
dWN0IGludGVsX3BpcGVfY3JjICpwaXBlX2NyYyA9ICZpOTE1LT5waXBlX2NyY1tjcnRjLT5pbmRl
eF07CiAKIAkvKiBTd2FsbG93IGNyYydzIHVudGlsIHdlIHN0b3AgZ2VuZXJhdGluZyB0aGVtLiAq
LwogCXNwaW5fbG9ja19pcnEoJnBpcGVfY3JjLT5sb2NrKTsKQEAgLTY2Nyw1ICs2NjcsNSBAQCB2
b2lkIGludGVsX2NydGNfZGlzYWJsZV9waXBlX2NyYyhzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxf
Y3J0YykKIAogCUk5MTVfV1JJVEUoUElQRV9DUkNfQ1RMKGNydGMtPmluZGV4KSwgMCk7CiAJUE9T
VElOR19SRUFEKFBJUEVfQ1JDX0NUTChjcnRjLT5pbmRleCkpOwotCXN5bmNocm9uaXplX2lycShk
ZXZfcHJpdi0+ZHJtLmlycSk7CisJc3luY2hyb25pemVfaXJxKGk5MTUtPmRybS5pcnEpOwogfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcGlwZV9jcmMuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3BpcGVfY3JjLmgKaW5kZXggZGIyNThhNzU2ZmM2Li40MjA0
OGFiMTM5MWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BpcGVfY3Jj
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcGlwZV9jcmMuaApAQCAtMTMsNyAr
MTMsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBpbnRlbF9jcnRjOwogCiAj
aWZkZWYgQ09ORklHX0RFQlVHX0ZTCi12b2lkIGludGVsX2Rpc3BsYXlfY3JjX2luaXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfZGlzcGxheV9jcmNfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBpbnQgaW50ZWxfY3J0Y19zZXRfY3Jj
X3NvdXJjZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsIGNvbnN0IGNoYXIgKnNvdXJjZV9uYW1lKTsK
IGludCBpbnRlbF9jcnRjX3ZlcmlmeV9jcmNfc291cmNlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
IAkJCQkgY29uc3QgY2hhciAqc291cmNlX25hbWUsIHNpemVfdCAqdmFsdWVzX2NudCk7CkBAIC0y
Miw3ICsyMiw3IEBAIGNvbnN0IGNoYXIgKmNvbnN0ICppbnRlbF9jcnRjX2dldF9jcmNfc291cmNl
cyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiB2b2lkIGludGVsX2NydGNfZGlzYWJsZV9waXBlX2Ny
YyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7CiB2b2lkIGludGVsX2NydGNfZW5hYmxlX3BpcGVf
Y3JjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKTsKICNlbHNlCi1zdGF0aWMgaW5saW5lIHZvaWQg
aW50ZWxfZGlzcGxheV9jcmNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
IHt9CitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZGlzcGxheV9jcmNfaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkge30KICNkZWZpbmUgaW50ZWxfY3J0Y19zZXRfY3JjX3NvdXJj
ZSBOVUxMCiAjZGVmaW5lIGludGVsX2NydGNfdmVyaWZ5X2NyY19zb3VyY2UgTlVMTAogI2RlZmlu
ZSBpbnRlbF9jcnRjX2dldF9jcmNfc291cmNlcyBOVUxMCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpp
bmRleCAyYzdmM2ViYzAxMTcuLjRiOTM5MTYwY2Q5NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5j
CkBAIC02Myw5ICs2Myw5IEBACiAgKiByZXF1aXJlIGhpZ2hlciBsYXRlbmN5IHRvIHN3aXRjaCB0
byBhbmQgd2FrZSB1cC4KICAqLwogCi1zdGF0aWMgdm9pZCBnZW45X2luaXRfY2xvY2tfZ2F0aW5n
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdlbjlfaW5p
dF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKEhB
U19MTEMoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19MTEMoaTkxNSkpIHsKIAkJLyoKIAkJICogV2FD
b21wcmVzc2VkUmVzb3VyY2VEaXNwbGF5TmV3SGFzaE1vZGU6c2tsLGtibAogCQkgKiBEaXNwbGF5
IFdBICMwMzkwOiBza2wsa2JsCkBAIC05NiwxNiArOTYsMTYgQEAgc3RhdGljIHZvaWQgZ2VuOV9p
bml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkx
NV9XUklURShJTEtfRFBGQ19DSElDS0VOLCBJOTE1X1JFQUQoSUxLX0RQRkNfQ0hJQ0tFTikgfAog
CQkgICBJTEtfRFBGQ19ESVNBQkxFX0RVTU1ZMCk7CiAKLQlpZiAoSVNfU0tZTEFLRShkZXZfcHJp
dikpIHsKKwlpZiAoSVNfU0tZTEFLRShpOTE1KSkgewogCQkvKiBXYURpc2FibGVEb3BDbG9ja0dh
dGluZyAqLwogCQlJOTE1X1dSSVRFKEdFTjdfTUlTQ0NQQ1RMLCBJOTE1X1JFQUQoR0VON19NSVND
Q1BDVEwpCiAJCQkgICAmIH5HRU43X0RPUF9DTE9DS19HQVRFX0VOQUJMRSk7CiAJfQogfQogCi1z
dGF0aWMgdm9pZCBieHRfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHZvaWQgYnh0X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewotCWdlbjlfaW5pdF9jbG9ja19nYXRpbmcoZGV2X3ByaXYp
OworCWdlbjlfaW5pdF9jbG9ja19nYXRpbmcoaTkxNSk7CiAKIAkvKiBXYURpc2FibGVTREVVbml0
Q2xvY2tHYXRpbmc6Ynh0ICovCiAJSTkxNV9XUklURShHRU44X1VDR0NUTDYsIEk5MTVfUkVBRChH
RU44X1VDR0NUTDYpIHwKQEAgLTEyNiw5ICsxMjYsOSBAQCBzdGF0aWMgdm9pZCBieHRfaW5pdF9j
bG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgICBQV00x
X0dBVElOR19ESVMgfCBQV00yX0dBVElOR19ESVMpOwogfQogCi1zdGF0aWMgdm9pZCBnbGtfaW5p
dF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgZ2xrX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewotCWdlbjlfaW5pdF9jbG9ja19nYXRpbmcoZGV2X3ByaXYpOworCWdlbjlfaW5pdF9jbG9j
a19nYXRpbmcoaTkxNSk7CiAKIAkvKgogCSAqIFdhRGlzYWJsZVBXTUNsb2NrR2F0aW5nOmdsawpA
QCAtMTM5LDcgKzEzOSw3IEBAIHN0YXRpYyB2b2lkIGdsa19pbml0X2Nsb2NrX2dhdGluZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAgIFBXTTFfR0FUSU5HX0RJUyB8IFBX
TTJfR0FUSU5HX0RJUyk7CiAKIAkvKiBXYURESUlPVGltZW91dDpnbGsgKi8KLQlpZiAoSVNfR0xL
X1JFVklEKGRldl9wcml2LCAwLCBHTEtfUkVWSURfQTEpKSB7CisJaWYgKElTX0dMS19SRVZJRChp
OTE1LCAwLCBHTEtfUkVWSURfQTEpKSB7CiAJCXUzMiB2YWwgPSBJOTE1X1JFQUQoQ0hJQ0tFTl9N
SVNDXzIpOwogCQl2YWwgJj0gfihHTEtfQ0wwX1BXUl9ET1dOIHwKIAkJCSBHTEtfQ0wxX1BXUl9E
T1dOIHwKQEAgLTE0OSw3ICsxNDksNyBAQCBzdGF0aWMgdm9pZCBnbGtfaW5pdF9jbG9ja19nYXRp
bmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiB9CiAKLXN0YXRpYyB2b2lk
IGk5MTVfcGluZXZpZXdfZ2V0X21lbV9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3N0YXRpYyB2b2lkIGk5MTVfcGluZXZpZXdfZ2V0X21lbV9mcmVxKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiB0bXA7CiAKQEAgLTE1NywxMDAgKzE1NywxMDAg
QEAgc3RhdGljIHZvaWQgaTkxNV9waW5ldmlld19nZXRfbWVtX2ZyZXEoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCiAJc3dpdGNoICh0bXAgJiBDTEtDRkdfRlNCX01BU0spIHsK
IAljYXNlIENMS0NGR19GU0JfNTMzOgotCQlkZXZfcHJpdi0+ZnNiX2ZyZXEgPSA1MzM7IC8qIDEz
Myo0ICovCisJCWk5MTUtPmZzYl9mcmVxID0gNTMzOyAvKiAxMzMqNCAqLwogCQlicmVhazsKIAlj
YXNlIENMS0NGR19GU0JfODAwOgotCQlkZXZfcHJpdi0+ZnNiX2ZyZXEgPSA4MDA7IC8qIDIwMCo0
ICovCisJCWk5MTUtPmZzYl9mcmVxID0gODAwOyAvKiAyMDAqNCAqLwogCQlicmVhazsKIAljYXNl
IENMS0NGR19GU0JfNjY3OgotCQlkZXZfcHJpdi0+ZnNiX2ZyZXEgPSAgNjY3OyAvKiAxNjcqNCAq
LworCQlpOTE1LT5mc2JfZnJlcSA9ICA2Njc7IC8qIDE2Nyo0ICovCiAJCWJyZWFrOwogCWNhc2Ug
Q0xLQ0ZHX0ZTQl80MDA6Ci0JCWRldl9wcml2LT5mc2JfZnJlcSA9IDQwMDsgLyogMTAwKjQgKi8K
KwkJaTkxNS0+ZnNiX2ZyZXEgPSA0MDA7IC8qIDEwMCo0ICovCiAJCWJyZWFrOwogCX0KIAogCXN3
aXRjaCAodG1wICYgQ0xLQ0ZHX01FTV9NQVNLKSB7CiAJY2FzZSBDTEtDRkdfTUVNXzUzMzoKLQkJ
ZGV2X3ByaXYtPm1lbV9mcmVxID0gNTMzOworCQlpOTE1LT5tZW1fZnJlcSA9IDUzMzsKIAkJYnJl
YWs7CiAJY2FzZSBDTEtDRkdfTUVNXzY2NzoKLQkJZGV2X3ByaXYtPm1lbV9mcmVxID0gNjY3Owor
CQlpOTE1LT5tZW1fZnJlcSA9IDY2NzsKIAkJYnJlYWs7CiAJY2FzZSBDTEtDRkdfTUVNXzgwMDoK
LQkJZGV2X3ByaXYtPm1lbV9mcmVxID0gODAwOworCQlpOTE1LT5tZW1fZnJlcSA9IDgwMDsKIAkJ
YnJlYWs7CiAJfQogCiAJLyogZGV0ZWN0IHBpbmV2aWV3IEREUjMgc2V0dGluZyAqLwogCXRtcCA9
IEk5MTVfUkVBRChDU0hSRERSM0NUTCk7Ci0JZGV2X3ByaXYtPmlzX2RkcjMgPSAodG1wICYgQ1NI
UkREUjNDVExfRERSMykgPyAxIDogMDsKKwlpOTE1LT5pc19kZHIzID0gKHRtcCAmIENTSFJERFIz
Q1RMX0REUjMpID8gMSA6IDA7CiB9CiAKLXN0YXRpYyB2b2lkIGk5MTVfaXJvbmxha2VfZ2V0X21l
bV9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGk5
MTVfaXJvbmxha2VfZ2V0X21lbV9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCXUxNiBkZHJwbGwsIGNzaXBsbDsKIAotCWRkcnBsbCA9IGludGVsX3VuY29yZV9yZWFkMTYo
JmRldl9wcml2LT51bmNvcmUsIEREUk1QTEwxKTsKLQljc2lwbGwgPSBpbnRlbF91bmNvcmVfcmVh
ZDE2KCZkZXZfcHJpdi0+dW5jb3JlLCBDU0lQTEwwKTsKKwlkZHJwbGwgPSBpbnRlbF91bmNvcmVf
cmVhZDE2KCZpOTE1LT51bmNvcmUsIEREUk1QTEwxKTsKKwljc2lwbGwgPSBpbnRlbF91bmNvcmVf
cmVhZDE2KCZpOTE1LT51bmNvcmUsIENTSVBMTDApOwogCiAJc3dpdGNoIChkZHJwbGwgJiAweGZm
KSB7CiAJY2FzZSAweGM6Ci0JCWRldl9wcml2LT5tZW1fZnJlcSA9IDgwMDsKKwkJaTkxNS0+bWVt
X2ZyZXEgPSA4MDA7CiAJCWJyZWFrOwogCWNhc2UgMHgxMDoKLQkJZGV2X3ByaXYtPm1lbV9mcmVx
ID0gMTA2NjsKKwkJaTkxNS0+bWVtX2ZyZXEgPSAxMDY2OwogCQlicmVhazsKIAljYXNlIDB4MTQ6
Ci0JCWRldl9wcml2LT5tZW1fZnJlcSA9IDEzMzM7CisJCWk5MTUtPm1lbV9mcmVxID0gMTMzMzsK
IAkJYnJlYWs7CiAJY2FzZSAweDE4OgotCQlkZXZfcHJpdi0+bWVtX2ZyZXEgPSAxNjAwOworCQlp
OTE1LT5tZW1fZnJlcSA9IDE2MDA7CiAJCWJyZWFrOwogCWRlZmF1bHQ6CiAJCURSTV9ERUJVR19E
UklWRVIoInVua25vd24gbWVtb3J5IGZyZXF1ZW5jeSAweCUwMnhcbiIsCiAJCQkJIGRkcnBsbCAm
IDB4ZmYpOwotCQlkZXZfcHJpdi0+bWVtX2ZyZXEgPSAwOworCQlpOTE1LT5tZW1fZnJlcSA9IDA7
CiAJCWJyZWFrOwogCX0KIAotCWRldl9wcml2LT5pcHMucl90ID0gZGV2X3ByaXYtPm1lbV9mcmVx
OworCWk5MTUtPmlwcy5yX3QgPSBpOTE1LT5tZW1fZnJlcTsKIAogCXN3aXRjaCAoY3NpcGxsICYg
MHgzZmYpIHsKIAljYXNlIDB4MDBjOgotCQlkZXZfcHJpdi0+ZnNiX2ZyZXEgPSAzMjAwOworCQlp
OTE1LT5mc2JfZnJlcSA9IDMyMDA7CiAJCWJyZWFrOwogCWNhc2UgMHgwMGU6Ci0JCWRldl9wcml2
LT5mc2JfZnJlcSA9IDM3MzM7CisJCWk5MTUtPmZzYl9mcmVxID0gMzczMzsKIAkJYnJlYWs7CiAJ
Y2FzZSAweDAxMDoKLQkJZGV2X3ByaXYtPmZzYl9mcmVxID0gNDI2NjsKKwkJaTkxNS0+ZnNiX2Zy
ZXEgPSA0MjY2OwogCQlicmVhazsKIAljYXNlIDB4MDEyOgotCQlkZXZfcHJpdi0+ZnNiX2ZyZXEg
PSA0ODAwOworCQlpOTE1LT5mc2JfZnJlcSA9IDQ4MDA7CiAJCWJyZWFrOwogCWNhc2UgMHgwMTQ6
Ci0JCWRldl9wcml2LT5mc2JfZnJlcSA9IDUzMzM7CisJCWk5MTUtPmZzYl9mcmVxID0gNTMzMzsK
IAkJYnJlYWs7CiAJY2FzZSAweDAxNjoKLQkJZGV2X3ByaXYtPmZzYl9mcmVxID0gNTg2NjsKKwkJ
aTkxNS0+ZnNiX2ZyZXEgPSA1ODY2OwogCQlicmVhazsKIAljYXNlIDB4MDE4OgotCQlkZXZfcHJp
di0+ZnNiX2ZyZXEgPSA2NDAwOworCQlpOTE1LT5mc2JfZnJlcSA9IDY0MDA7CiAJCWJyZWFrOwog
CWRlZmF1bHQ6CiAJCURSTV9ERUJVR19EUklWRVIoInVua25vd24gZnNiIGZyZXF1ZW5jeSAweCUw
NHhcbiIsCiAJCQkJIGNzaXBsbCAmIDB4M2ZmKTsKLQkJZGV2X3ByaXYtPmZzYl9mcmVxID0gMDsK
KwkJaTkxNS0+ZnNiX2ZyZXEgPSAwOwogCQlicmVhazsKIAl9CiAKLQlpZiAoZGV2X3ByaXYtPmZz
Yl9mcmVxID09IDMyMDApIHsKLQkJZGV2X3ByaXYtPmlwcy5jX20gPSAwOwotCX0gZWxzZSBpZiAo
ZGV2X3ByaXYtPmZzYl9mcmVxID4gMzIwMCAmJiBkZXZfcHJpdi0+ZnNiX2ZyZXEgPD0gNDgwMCkg
ewotCQlkZXZfcHJpdi0+aXBzLmNfbSA9IDE7CisJaWYgKGk5MTUtPmZzYl9mcmVxID09IDMyMDAp
IHsKKwkJaTkxNS0+aXBzLmNfbSA9IDA7CisJfSBlbHNlIGlmIChpOTE1LT5mc2JfZnJlcSA+IDMy
MDAgJiYgaTkxNS0+ZnNiX2ZyZXEgPD0gNDgwMCkgeworCQlpOTE1LT5pcHMuY19tID0gMTsKIAl9
IGVsc2UgewotCQlkZXZfcHJpdi0+aXBzLmNfbSA9IDI7CisJCWk5MTUtPmlwcy5jX20gPSAyOwog
CX0KIH0KIApAQCAtMzE2LDYxICszMTYsNjEgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBjeHNyX2xh
dGVuY3kgKmludGVsX2dldF9jeHNyX2xhdGVuY3koYm9vbCBpc19kZXNrdG9wLAogCXJldHVybiBO
VUxMOwogfQogCi1zdGF0aWMgdm9pZCBjaHZfc2V0X21lbW9yeV9kdmZzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBlbmFibGUpCitzdGF0aWMgdm9pZCBjaHZfc2V0X21l
bW9yeV9kdmZzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29sIGVuYWJsZSkKIHsK
IAl1MzIgdmFsOwogCi0Jdmx2X3B1bml0X2dldChkZXZfcHJpdik7CisJdmx2X3B1bml0X2dldChp
OTE1KTsKIAotCXZhbCA9IHZsdl9wdW5pdF9yZWFkKGRldl9wcml2LCBQVU5JVF9SRUdfRERSX1NF
VFVQMik7CisJdmFsID0gdmx2X3B1bml0X3JlYWQoaTkxNSwgUFVOSVRfUkVHX0REUl9TRVRVUDIp
OwogCWlmIChlbmFibGUpCiAJCXZhbCAmPSB+Rk9SQ0VfRERSX0hJR0hfRlJFUTsKIAllbHNlCiAJ
CXZhbCB8PSBGT1JDRV9ERFJfSElHSF9GUkVROwogCXZhbCAmPSB+Rk9SQ0VfRERSX0xPV19GUkVR
OwogCXZhbCB8PSBGT1JDRV9ERFJfRlJFUV9SRVFfQUNLOwotCXZsdl9wdW5pdF93cml0ZShkZXZf
cHJpdiwgUFVOSVRfUkVHX0REUl9TRVRVUDIsIHZhbCk7CisJdmx2X3B1bml0X3dyaXRlKGk5MTUs
IFBVTklUX1JFR19ERFJfU0VUVVAyLCB2YWwpOwogCi0JaWYgKHdhaXRfZm9yKCh2bHZfcHVuaXRf
cmVhZChkZXZfcHJpdiwgUFVOSVRfUkVHX0REUl9TRVRVUDIpICYKKwlpZiAod2FpdF9mb3IoKHZs
dl9wdW5pdF9yZWFkKGk5MTUsIFBVTklUX1JFR19ERFJfU0VUVVAyKSAmCiAJCSAgICAgIEZPUkNF
X0REUl9GUkVRX1JFUV9BQ0spID09IDAsIDMpKQogCQlEUk1fRVJST1IoInRpbWVkIG91dCB3YWl0
aW5nIGZvciBQdW5pdCBERFIgRFZGUyByZXF1ZXN0XG4iKTsKIAotCXZsdl9wdW5pdF9wdXQoZGV2
X3ByaXYpOworCXZsdl9wdW5pdF9wdXQoaTkxNSk7CiB9CiAKLXN0YXRpYyB2b2lkIGNodl9zZXRf
bWVtb3J5X3BtNShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgZW5hYmxl
KQorc3RhdGljIHZvaWQgY2h2X3NldF9tZW1vcnlfcG01KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCBib29sIGVuYWJsZSkKIHsKIAl1MzIgdmFsOwogCi0Jdmx2X3B1bml0X2dldChkZXZf
cHJpdik7CisJdmx2X3B1bml0X2dldChpOTE1KTsKIAotCXZhbCA9IHZsdl9wdW5pdF9yZWFkKGRl
dl9wcml2LCBQVU5JVF9SRUdfRFNQU1NQTSk7CisJdmFsID0gdmx2X3B1bml0X3JlYWQoaTkxNSwg
UFVOSVRfUkVHX0RTUFNTUE0pOwogCWlmIChlbmFibGUpCiAJCXZhbCB8PSBEU1BfTUFYRklGT19Q
TTVfRU5BQkxFOwogCWVsc2UKIAkJdmFsICY9IH5EU1BfTUFYRklGT19QTTVfRU5BQkxFOwotCXZs
dl9wdW5pdF93cml0ZShkZXZfcHJpdiwgUFVOSVRfUkVHX0RTUFNTUE0sIHZhbCk7CisJdmx2X3B1
bml0X3dyaXRlKGk5MTUsIFBVTklUX1JFR19EU1BTU1BNLCB2YWwpOwogCi0Jdmx2X3B1bml0X3B1
dChkZXZfcHJpdik7CisJdmx2X3B1bml0X3B1dChpOTE1KTsKIH0KIAogI2RlZmluZSBGV19XTSh2
YWx1ZSwgcGxhbmUpIFwKIAkoKCh2YWx1ZSkgPDwgRFNQRldfICMjIHBsYW5lICMjIF9TSElGVCkg
JiBEU1BGV18gIyMgcGxhbmUgIyMgX01BU0spCiAKLXN0YXRpYyBib29sIF9pbnRlbF9zZXRfbWVt
b3J5X2N4c3Ioc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIGVuYWJsZSkK
K3N0YXRpYyBib29sIF9pbnRlbF9zZXRfbWVtb3J5X2N4c3Ioc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIGJvb2wgZW5hYmxlKQogewogCWJvb2wgd2FzX2VuYWJsZWQ7CiAJdTMyIHZhbDsK
IAotCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2
KSkgeworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsK
IAkJd2FzX2VuYWJsZWQgPSBJOTE1X1JFQUQoRldfQkxDX1NFTEZfVkxWKSAmIEZXX0NTUFdSRFdO
RU47CiAJCUk5MTVfV1JJVEUoRldfQkxDX1NFTEZfVkxWLCBlbmFibGUgPyBGV19DU1BXUkRXTkVO
IDogMCk7CiAJCVBPU1RJTkdfUkVBRChGV19CTENfU0VMRl9WTFYpOwotCX0gZWxzZSBpZiAoSVNf
RzRYKGRldl9wcml2KSB8fCBJU19JOTY1R00oZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19H
NFgoaTkxNSkgfHwgSVNfSTk2NUdNKGk5MTUpKSB7CiAJCXdhc19lbmFibGVkID0gSTkxNV9SRUFE
KEZXX0JMQ19TRUxGKSAmIEZXX0JMQ19TRUxGX0VOOwogCQlJOTE1X1dSSVRFKEZXX0JMQ19TRUxG
LCBlbmFibGUgPyBGV19CTENfU0VMRl9FTiA6IDApOwogCQlQT1NUSU5HX1JFQUQoRldfQkxDX1NF
TEYpOwotCX0gZWxzZSBpZiAoSVNfUElORVZJRVcoZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJ
U19QSU5FVklFVyhpOTE1KSkgewogCQl2YWwgPSBJOTE1X1JFQUQoRFNQRlczKTsKIAkJd2FzX2Vu
YWJsZWQgPSB2YWwgJiBQSU5FVklFV19TRUxGX1JFRlJFU0hfRU47CiAJCWlmIChlbmFibGUpCkBA
IC0zNzksMTMgKzM3OSwxMyBAQCBzdGF0aWMgYm9vbCBfaW50ZWxfc2V0X21lbW9yeV9jeHNyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBlbmFibAogCQkJdmFsICY9IH5Q
SU5FVklFV19TRUxGX1JFRlJFU0hfRU47CiAJCUk5MTVfV1JJVEUoRFNQRlczLCB2YWwpOwogCQlQ
T1NUSU5HX1JFQUQoRFNQRlczKTsKLQl9IGVsc2UgaWYgKElTX0k5NDVHKGRldl9wcml2KSB8fCBJ
U19JOTQ1R00oZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19JOTQ1RyhpOTE1KSB8fCBJU19J
OTQ1R00oaTkxNSkpIHsKIAkJd2FzX2VuYWJsZWQgPSBJOTE1X1JFQUQoRldfQkxDX1NFTEYpICYg
RldfQkxDX1NFTEZfRU47CiAJCXZhbCA9IGVuYWJsZSA/IF9NQVNLRURfQklUX0VOQUJMRShGV19C
TENfU0VMRl9FTikgOgogCQkJICAgICAgIF9NQVNLRURfQklUX0RJU0FCTEUoRldfQkxDX1NFTEZf
RU4pOwogCQlJOTE1X1dSSVRFKEZXX0JMQ19TRUxGLCB2YWwpOwogCQlQT1NUSU5HX1JFQUQoRldf
QkxDX1NFTEYpOwotCX0gZWxzZSBpZiAoSVNfSTkxNUdNKGRldl9wcml2KSkgeworCX0gZWxzZSBp
ZiAoSVNfSTkxNUdNKGk5MTUpKSB7CiAJCS8qCiAJCSAqIEZJWE1FIGNhbid0IGZpbmQgYSBiaXQg
bGlrZSB0aGlzIGZvciA5MTVHLCBhbmQKIAkJICogYW5kIHlldCBpdCBkb2VzIGhhdmUgdGhlIHJl
bGF0ZWQgd2F0ZXJtYXJrIGluCkBAIC00MDAsNyArNDAwLDcgQEAgc3RhdGljIGJvb2wgX2ludGVs
X3NldF9tZW1vcnlfY3hzcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wg
ZW5hYmwKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAotCXRyYWNlX2ludGVsX21lbW9yeV9jeHNyKGRl
dl9wcml2LCB3YXNfZW5hYmxlZCwgZW5hYmxlKTsKKwl0cmFjZV9pbnRlbF9tZW1vcnlfY3hzcihp
OTE1LCB3YXNfZW5hYmxlZCwgZW5hYmxlKTsKIAogCURSTV9ERUJVR19LTVMoIm1lbW9yeSBzZWxm
LXJlZnJlc2ggaXMgJXMgKHdhcyAlcylcbiIsCiAJCSAgICAgIGVuYWJsZWRkaXNhYmxlZChlbmFi
bGUpLApAQCAtNDExLDcgKzQxMSw3IEBAIHN0YXRpYyBib29sIF9pbnRlbF9zZXRfbWVtb3J5X2N4
c3Ioc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIGVuYWJsCiAKIC8qKgog
ICogaW50ZWxfc2V0X21lbW9yeV9jeHNyIC0gQ29uZmlndXJlIEN4U1Igc3RhdGUKLSAqIEBkZXZf
cHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICogQGVuYWJsZTogQWxs
b3cgdnMuIGRpc2FsbG93IEN4U1IKICAqCiAgKiBBbGxvdyBvciBkaXNhbGxvdyB0aGUgc3lzdGVt
IHRvIGVudGVyIGEgc3BlY2lhbCBDeFNSCkBAIC00NDYsMTcgKzQ0NiwxNyBAQCBzdGF0aWMgYm9v
bCBfaW50ZWxfc2V0X21lbW9yeV9jeHNyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgYm9vbCBlbmFibAogICogdGhlIGhhcmR3YXJlIHcuci50LiBIUExMIFNSIHdoZW4gd3JpdGlu
ZyB0byBwbGFuZSByZWdpc3RlcnMuCiAgKiBEaXNhbGxvd2luZyBqdXN0IEN4U1IgaXMgc3VmZmlj
aWVudC4KICAqLwotYm9vbCBpbnRlbF9zZXRfbWVtb3J5X2N4c3Ioc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCBib29sIGVuYWJsZSkKK2Jvb2wgaW50ZWxfc2V0X21lbW9yeV9jeHNy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29sIGVuYWJsZSkKIHsKIAlib29sIHJl
dDsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7Ci0JcmV0ID0gX2ludGVs
X3NldF9tZW1vcnlfY3hzcihkZXZfcHJpdiwgZW5hYmxlKTsKLQlpZiAoSVNfVkFMTEVZVklFVyhk
ZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCWRldl9wcml2LT53bS52bHYu
Y3hzciA9IGVuYWJsZTsKLQllbHNlIGlmIChJU19HNFgoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+
d20uZzR4LmN4c3IgPSBlbmFibGU7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+d20ud21fbXV0
ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPndtLndtX211dGV4KTsKKwlyZXQgPSBfaW50ZWxfc2V0
X21lbW9yeV9jeHNyKGk5MTUsIGVuYWJsZSk7CisJaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwg
SVNfQ0hFUlJZVklFVyhpOTE1KSkKKwkJaTkxNS0+d20udmx2LmN4c3IgPSBlbmFibGU7CisJZWxz
ZSBpZiAoSVNfRzRYKGk5MTUpKQorCQlpOTE1LT53bS5nNHguY3hzciA9IGVuYWJsZTsKKwltdXRl
eF91bmxvY2soJmk5MTUtPndtLndtX211dGV4KTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC00ODMs
NyArNDgzLDcgQEAgc3RhdGljIGNvbnN0IGludCBwZXNzaW1hbF9sYXRlbmN5X25zID0gNTAwMDsK
IHN0YXRpYyB2b2lkIHZsdl9nZXRfZmlmb19zaXplKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IHZsdl9maWZvX3N0YXRlICpm
aWZvX3N0YXRlID0gJmNydGNfc3RhdGUtPndtLnZsdi5maWZvX3N0YXRlOwogCWVudW0gcGlwZSBw
aXBlID0gY3J0Yy0+cGlwZTsKIAlpbnQgc3ByaXRlMF9zdGFydCwgc3ByaXRlMV9zdGFydDsKQEAg
LTUxOSw3ICs1MTksNyBAQCBzdGF0aWMgdm9pZCB2bHZfZ2V0X2ZpZm9fc2l6ZShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlmaWZvX3N0YXRlLT5wbGFuZVtQTEFORV9DVVJT
T1JdID0gNjM7CiB9CiAKLXN0YXRpYyBpbnQgaTl4eF9nZXRfZmlmb19zaXplKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBpbnQgaTl4eF9nZXRfZmlmb19zaXplKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICAgZW51bSBpOXh4X3BsYW5lX2lk
IGk5eHhfcGxhbmUpCiB7CiAJdTMyIGRzcGFyYiA9IEk5MTVfUkVBRChEU1BBUkIpOwpAQCAtNTM1
LDcgKzUzNSw3IEBAIHN0YXRpYyBpbnQgaTl4eF9nZXRfZmlmb19zaXplKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gc2l6ZTsKIH0KIAotc3RhdGljIGludCBpODMw
X2dldF9maWZvX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGlj
IGludCBpODMwX2dldF9maWZvX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkgICAgICBlbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSkKIHsKIAl1MzIgZHNwYXJiID0g
STkxNV9SRUFEKERTUEFSQik7CkBAIC01NTIsNyArNTUyLDcgQEAgc3RhdGljIGludCBpODMwX2dl
dF9maWZvX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiBz
aXplOwogfQogCi1zdGF0aWMgaW50IGk4NDVfZ2V0X2ZpZm9fc2l6ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgaW50IGk4NDVfZ2V0X2ZpZm9fc2l6ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIGVudW0gaTl4eF9wbGFuZV9pZCBpOXh4
X3BsYW5lKQogewogCXUzMiBkc3BhcmIgPSBJOTE1X1JFQUQoRFNQQVJCKTsKQEAgLTgwNSw5ICs4
MDUsOSBAQCBzdGF0aWMgYm9vbCBpc19lbmFibGluZyhpbnQgb2xkLCBpbnQgbmV3LCBpbnQgdGhy
ZXNob2xkKQogCXJldHVybiBvbGQgPCB0aHJlc2hvbGQgJiYgbmV3ID49IHRocmVzaG9sZDsKIH0K
IAotc3RhdGljIGludCBpbnRlbF93bV9udW1fbGV2ZWxzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK3N0YXRpYyBpbnQgaW50ZWxfd21fbnVtX2xldmVscyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1cm4gZGV2X3ByaXYtPndtLm1heF9sZXZlbCArIDE7
CisJcmV0dXJuIGk5MTUtPndtLm1heF9sZXZlbCArIDE7CiB9CiAKIHN0YXRpYyBib29sIGludGVs
X3dtX3BsYW5lX3Zpc2libGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCkBAIC04MzMsMTEgKzgzMywxMSBAQCBzdGF0aWMgYm9vbCBpbnRlbF93bV9wbGFuZV92aXNp
YmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlyZXR1cm4g
cGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZTsKIH0KIAotc3RhdGljIHN0cnVjdCBpbnRlbF9jcnRj
ICpzaW5nbGVfZW5hYmxlZF9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3N0YXRpYyBzdHJ1Y3QgaW50ZWxfY3J0YyAqc2luZ2xlX2VuYWJsZWRfY3J0YyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywgKmVuYWJs
ZWQgPSBOVUxMOwogCi0JZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0Yykg
eworCWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRybSwgY3J0YykgewogCQlpZiAoaW50ZWxf
Y3J0Y19hY3RpdmUoY3J0YykpIHsKIAkJCWlmIChlbmFibGVkKQogCQkJCXJldHVybiBOVUxMOwpA
QCAtODUwLDIzICs4NTAsMjMgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9jcnRjICpzaW5nbGVfZW5h
YmxlZF9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogc3RhdGljIHZv
aWQgcGluZXZpZXdfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHVudXNlZF9jcnRj
LT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHVu
dXNlZF9jcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7CiAJY29uc3Qg
c3RydWN0IGN4c3JfbGF0ZW5jeSAqbGF0ZW5jeTsKIAl1MzIgcmVnOwogCXVuc2lnbmVkIGludCB3
bTsKIAotCWxhdGVuY3kgPSBpbnRlbF9nZXRfY3hzcl9sYXRlbmN5KCFJU19NT0JJTEUoZGV2X3By
aXYpLAotCQkJCQkgZGV2X3ByaXYtPmlzX2RkcjMsCi0JCQkJCSBkZXZfcHJpdi0+ZnNiX2ZyZXEs
Ci0JCQkJCSBkZXZfcHJpdi0+bWVtX2ZyZXEpOworCWxhdGVuY3kgPSBpbnRlbF9nZXRfY3hzcl9s
YXRlbmN5KCFJU19NT0JJTEUoaTkxNSksCisJCQkJCSBpOTE1LT5pc19kZHIzLAorCQkJCQkgaTkx
NS0+ZnNiX2ZyZXEsCisJCQkJCSBpOTE1LT5tZW1fZnJlcSk7CiAJaWYgKCFsYXRlbmN5KSB7CiAJ
CURSTV9ERUJVR19LTVMoIlVua25vd24gRlNCL01FTSBmb3VuZCwgZGlzYWJsZSBDeFNSXG4iKTsK
LQkJaW50ZWxfc2V0X21lbW9yeV9jeHNyKGRldl9wcml2LCBmYWxzZSk7CisJCWludGVsX3NldF9t
ZW1vcnlfY3hzcihpOTE1LCBmYWxzZSk7CiAJCXJldHVybjsKIAl9CiAKLQljcnRjID0gc2luZ2xl
X2VuYWJsZWRfY3J0YyhkZXZfcHJpdik7CisJY3J0YyA9IHNpbmdsZV9lbmFibGVkX2NydGMoaTkx
NSk7CiAJaWYgKGNydGMpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPQogCQkJJmNydGMtPmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOwpAQCAtOTEz
LDkgKzkxMyw5IEBAIHN0YXRpYyB2b2lkIHBpbmV2aWV3X3VwZGF0ZV93bShzdHJ1Y3QgaW50ZWxf
Y3J0YyAqdW51c2VkX2NydGMpCiAJCUk5MTVfV1JJVEUoRFNQRlczLCByZWcpOwogCQlEUk1fREVC
VUdfS01TKCJEU1BGVzMgcmVnaXN0ZXIgaXMgJXhcbiIsIHJlZyk7CiAKLQkJaW50ZWxfc2V0X21l
bW9yeV9jeHNyKGRldl9wcml2LCB0cnVlKTsKKwkJaW50ZWxfc2V0X21lbW9yeV9jeHNyKGk5MTUs
IHRydWUpOwogCX0gZWxzZSB7Ci0JCWludGVsX3NldF9tZW1vcnlfY3hzcihkZXZfcHJpdiwgZmFs
c2UpOworCQlpbnRlbF9zZXRfbWVtb3J5X2N4c3IoaTkxNSwgZmFsc2UpOwogCX0KIH0KIApAQCAt
OTM2LDEzICs5MzYsMTMgQEAgc3RhdGljIHVuc2lnbmVkIGludCBnNHhfdGxiX21pc3Nfd2EoaW50
IGZpZm9fc2l6ZSwgaW50IHdpZHRoLCBpbnQgY3BwKQogCXJldHVybiBtYXgoMCwgdGxiX21pc3Mp
OwogfQogCi1zdGF0aWMgdm9pZCBnNHhfd3JpdGVfd21fdmFsdWVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGc0eF93cml0ZV93bV92YWx1ZXMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJY29uc3Qgc3RydWN0IGc0eF93bV92YWx1ZXMg
KndtKQogewogCWVudW0gcGlwZSBwaXBlOwogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlw
ZSkKLQkJdHJhY2VfZzR4X3dtKGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBwaXBl
KSwgd20pOworCWZvcl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkKKwkJdHJhY2VfZzR4X3dtKGludGVs
X2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIHBpcGUpLCB3bSk7CiAKIAlJOTE1X1dSSVRFKERTUEZX
MSwKIAkJICAgRldfV00od20tPnNyLnBsYW5lLCBTUikgfApAQCAtOTY4LDEzICs5NjgsMTMgQEAg
c3RhdGljIHZvaWQgZzR4X3dyaXRlX3dtX3ZhbHVlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAjZGVmaW5lIEZXX1dNX1ZMVih2YWx1ZSwgcGxhbmUpIFwKIAkoKCh2YWx1ZSkg
PDwgRFNQRldfICMjIHBsYW5lICMjIF9TSElGVCkgJiBEU1BGV18gIyMgcGxhbmUgIyMgX01BU0tf
VkxWKQogCi1zdGF0aWMgdm9pZCB2bHZfd3JpdGVfd21fdmFsdWVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHZsdl93cml0ZV93bV92YWx1ZXMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJY29uc3Qgc3RydWN0IHZsdl93bV92YWx1ZXMg
KndtKQogewogCWVudW0gcGlwZSBwaXBlOwogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlw
ZSkgewotCQl0cmFjZV92bHZfd20oaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBp
cGUpLCB3bSk7CisJZm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKSB7CisJCXRyYWNlX3Zsdl93bShp
bnRlbF9nZXRfY3J0Y19mb3JfcGlwZShpOTE1LCBwaXBlKSwgd20pOwogCiAJCUk5MTVfV1JJVEUo
VkxWX0RETChwaXBlKSwKIAkJCSAgICh3bS0+ZGRsW3BpcGVdLnBsYW5lW1BMQU5FX0NVUlNPUl0g
PDwgRERMX0NVUlNPUl9TSElGVCkgfApAQCAtMTAwNiw3ICsxMDA2LDcgQEAgc3RhdGljIHZvaWQg
dmx2X3dyaXRlX3dtX3ZhbHVlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
STkxNV9XUklURShEU1BGVzMsCiAJCSAgIEZXX1dNKHdtLT5zci5jdXJzb3IsIENVUlNPUl9TUikp
OwogCi0JaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJaWYgKElTX0NIRVJSWVZJRVco
aTkxNSkpIHsKIAkJSTkxNV9XUklURShEU1BGVzdfQ0hWLAogCQkJICAgRldfV01fVkxWKHdtLT5w
aXBlW1BJUEVfQl0ucGxhbmVbUExBTkVfU1BSSVRFMV0sIFNQUklURUQpIHwKIAkJCSAgIEZXX1dN
X1ZMVih3bS0+cGlwZVtQSVBFX0JdLnBsYW5lW1BMQU5FX1NQUklURTBdLCBTUFJJVEVDKSk7CkBA
IC0xMDQ2LDE0ICsxMDQ2LDE0IEBAIHN0YXRpYyB2b2lkIHZsdl93cml0ZV93bV92YWx1ZXMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAjdW5kZWYgRldfV01fVkxWCiAKLXN0
YXRpYyB2b2lkIGc0eF9zZXR1cF93bV9sYXRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyB2b2lkIGc0eF9zZXR1cF93bV9sYXRlbmN5KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCS8qIGFsbCBsYXRlbmNpZXMgaW4gdXNlYyAqLwotCWRldl9w
cml2LT53bS5wcmlfbGF0ZW5jeVtHNFhfV01fTEVWRUxfTk9STUFMXSA9IDU7Ci0JZGV2X3ByaXYt
PndtLnByaV9sYXRlbmN5W0c0WF9XTV9MRVZFTF9TUl0gPSAxMjsKLQlkZXZfcHJpdi0+d20ucHJp
X2xhdGVuY3lbRzRYX1dNX0xFVkVMX0hQTExdID0gMzU7CisJaTkxNS0+d20ucHJpX2xhdGVuY3lb
RzRYX1dNX0xFVkVMX05PUk1BTF0gPSA1OworCWk5MTUtPndtLnByaV9sYXRlbmN5W0c0WF9XTV9M
RVZFTF9TUl0gPSAxMjsKKwlpOTE1LT53bS5wcmlfbGF0ZW5jeVtHNFhfV01fTEVWRUxfSFBMTF0g
PSAzNTsKIAotCWRldl9wcml2LT53bS5tYXhfbGV2ZWwgPSBHNFhfV01fTEVWRUxfSFBMTDsKKwlp
OTE1LT53bS5tYXhfbGV2ZWwgPSBHNFhfV01fTEVWRUxfSFBMTDsKIH0KIAogc3RhdGljIGludCBn
NHhfcGxhbmVfZmlmb19zaXplKGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsIGludCBsZXZlbCkKQEAg
LTExMDMsMTAgKzExMDMsMTAgQEAgc3RhdGljIHUxNiBnNHhfY29tcHV0ZV93bShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgaW50IGxldmVsKQogewogCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFz
ZS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShw
bGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0KIAkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKLQl1bnNpZ25l
ZCBpbnQgbGF0ZW5jeSA9IGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeVtsZXZlbF0gKiAxMDsKKwl1
bnNpZ25lZCBpbnQgbGF0ZW5jeSA9IGk5MTUtPndtLnByaV9sYXRlbmN5W2xldmVsXSAqIDEwOwog
CXVuc2lnbmVkIGludCBjbG9jaywgaHRvdGFsLCBjcHAsIHdpZHRoLCB3bTsKIAogCWlmIChsYXRl
bmN5ID09IDApCkBAIC0xMTI2LDcgKzExMjYsNyBAQCBzdGF0aWMgdTE2IGc0eF9jb21wdXRlX3dt
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAqIHRoZSBIUExM
IHdhdGVybWFyaywgd2hpY2ggc2VlbXMgYSBsaXR0bGUgc3RyYW5nZS4KIAkgKiBMZXQncyB1c2Ug
MzJicHAgZm9yIHRoZSBIUExMIHdhdGVybWFyayBhcyB3ZWxsLgogCSAqLwotCWlmIChJU19HTTQ1
KGRldl9wcml2KSAmJiBwbGFuZS0+aWQgPT0gUExBTkVfUFJJTUFSWSAmJgorCWlmIChJU19HTTQ1
KGk5MTUpICYmIHBsYW5lLT5pZCA9PSBQTEFORV9QUklNQVJZICYmCiAJICAgIGxldmVsICE9IEc0
WF9XTV9MRVZFTF9OT1JNQUwpCiAJCWNwcCA9IDQ7CiAJZWxzZQpAQCAtMTE2NSwxMCArMTE2NSwx
MCBAQCBzdGF0aWMgdTE2IGc0eF9jb21wdXRlX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIGJvb2wgZzR4X3Jhd19wbGFuZV93bV9zZXQoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJIGludCBsZXZlbCwgZW51bSBwbGFu
ZV9pZCBwbGFuZV9pZCwgdTE2IHZhbHVlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRl
dik7CiAJYm9vbCBkaXJ0eSA9IGZhbHNlOwogCi0JZm9yICg7IGxldmVsIDwgaW50ZWxfd21fbnVt
X2xldmVscyhkZXZfcHJpdik7IGxldmVsKyspIHsKKwlmb3IgKDsgbGV2ZWwgPCBpbnRlbF93bV9u
dW1fbGV2ZWxzKGk5MTUpOyBsZXZlbCsrKSB7CiAJCXN0cnVjdCBnNHhfcGlwZV93bSAqcmF3ID0g
JmNydGNfc3RhdGUtPndtLmc0eC5yYXdbbGV2ZWxdOwogCiAJCWRpcnR5IHw9IHJhdy0+cGxhbmVb
cGxhbmVfaWRdICE9IHZhbHVlOwpAQCAtMTE4MSwxMyArMTE4MSwxMyBAQCBzdGF0aWMgYm9vbCBn
NHhfcmF3X3BsYW5lX3dtX3NldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IHN0YXRpYyBib29sIGc0eF9yYXdfZmJjX3dtX3NldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAkJCSAgICAgICBpbnQgbGV2ZWwsIHUxNiB2YWx1ZSkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0
Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCWJvb2wgZGlydHkgPSBmYWxzZTsKIAogCS8qIE5PUk1B
TCBsZXZlbCBkb2Vzbid0IGhhdmUgYW4gRkJDIHdhdGVybWFyayAqLwogCWxldmVsID0gbWF4KGxl
dmVsLCBHNFhfV01fTEVWRUxfU1IpOwogCi0JZm9yICg7IGxldmVsIDwgaW50ZWxfd21fbnVtX2xl
dmVscyhkZXZfcHJpdik7IGxldmVsKyspIHsKKwlmb3IgKDsgbGV2ZWwgPCBpbnRlbF93bV9udW1f
bGV2ZWxzKGk5MTUpOyBsZXZlbCsrKSB7CiAJCXN0cnVjdCBnNHhfcGlwZV93bSAqcmF3ID0gJmNy
dGNfc3RhdGUtPndtLmc0eC5yYXdbbGV2ZWxdOwogCiAJCWRpcnR5IHw9IHJhdy0+ZmJjICE9IHZh
bHVlOwpAQCAtMTI4Myw5ICsxMjgzLDkgQEAgc3RhdGljIGJvb2wgZzR4X3Jhd19wbGFuZV93bV9p
c192YWxpZChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRp
YyBib29sIGc0eF9yYXdfY3J0Y193bV9pc192YWxpZChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgIGludCBsZXZlbCkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjLT5kZXYpOwogCi0JaWYgKGxldmVsID4gZGV2X3ByaXYtPndtLm1heF9sZXZlbCkK
KwlpZiAobGV2ZWwgPiBpOTE1LT53bS5tYXhfbGV2ZWwpCiAJCXJldHVybiBmYWxzZTsKIAogCXJl
dHVybiBnNHhfcmF3X3BsYW5lX3dtX2lzX3ZhbGlkKGNydGNfc3RhdGUsIFBMQU5FX1BSSU1BUlks
IGxldmVsKSAmJgpAQCAtMTQ4NCw3ICsxNDg0LDcgQEAgc3RhdGljIGludCBnNHhfY29tcHV0ZV9p
bnRlcm1lZGlhdGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQog
CXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBnNHhfbWVyZ2Vfd20oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgZzR4X21lcmdlX3dtKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJIHN0cnVjdCBnNHhfd21fdmFsdWVzICp3bSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKQEAgLTE0OTQsNyArMTQ5NCw3IEBAIHN0YXRpYyB2b2lk
IGc0eF9tZXJnZV93bShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJd20tPmhw
bGxfZW4gPSB0cnVlOwogCXdtLT5mYmNfZW4gPSB0cnVlOwogCi0JZm9yX2VhY2hfaW50ZWxfY3J0
YygmZGV2X3ByaXYtPmRybSwgY3J0YykgeworCWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRy
bSwgY3J0YykgewogCQljb25zdCBzdHJ1Y3QgZzR4X3dtX3N0YXRlICp3bV9zdGF0ZSA9ICZjcnRj
LT53bS5hY3RpdmUuZzR4OwogCiAJCWlmICghY3J0Yy0+YWN0aXZlKQpAQCAtMTUxNiw3ICsxNTE2
LDcgQEAgc3RhdGljIHZvaWQgZzR4X21lcmdlX3dtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJd20tPmZiY19lbiA9IGZhbHNlOwogCX0KIAotCWZvcl9lYWNoX2ludGVsX2Ny
dGMoJmRldl9wcml2LT5kcm0sIGNydGMpIHsKKwlmb3JfZWFjaF9pbnRlbF9jcnRjKCZpOTE1LT5k
cm0sIGNydGMpIHsKIAkJY29uc3Qgc3RydWN0IGc0eF93bV9zdGF0ZSAqd21fc3RhdGUgPSAmY3J0
Yy0+d20uYWN0aXZlLmc0eDsKIAkJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCkBAIC0x
NTI4LDIzICsxNTI4LDIzIEBAIHN0YXRpYyB2b2lkIGc0eF9tZXJnZV93bShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0aWMgdm9pZCBnNHhfcHJvZ3JhbV93
YXRlcm1hcmtzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lk
IGc0eF9wcm9ncmFtX3dhdGVybWFya3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
Ci0Jc3RydWN0IGc0eF93bV92YWx1ZXMgKm9sZF93bSA9ICZkZXZfcHJpdi0+d20uZzR4OworCXN0
cnVjdCBnNHhfd21fdmFsdWVzICpvbGRfd20gPSAmaTkxNS0+d20uZzR4OwogCXN0cnVjdCBnNHhf
d21fdmFsdWVzIG5ld193bSA9IHt9OwogCi0JZzR4X21lcmdlX3dtKGRldl9wcml2LCAmbmV3X3dt
KTsKKwlnNHhfbWVyZ2Vfd20oaTkxNSwgJm5ld193bSk7CiAKIAlpZiAobWVtY21wKG9sZF93bSwg
Jm5ld193bSwgc2l6ZW9mKG5ld193bSkpID09IDApCiAJCXJldHVybjsKIAogCWlmIChpc19kaXNh
Ymxpbmcob2xkX3dtLT5jeHNyLCBuZXdfd20uY3hzciwgdHJ1ZSkpCi0JCV9pbnRlbF9zZXRfbWVt
b3J5X2N4c3IoZGV2X3ByaXYsIGZhbHNlKTsKKwkJX2ludGVsX3NldF9tZW1vcnlfY3hzcihpOTE1
LCBmYWxzZSk7CiAKLQlnNHhfd3JpdGVfd21fdmFsdWVzKGRldl9wcml2LCAmbmV3X3dtKTsKKwln
NHhfd3JpdGVfd21fdmFsdWVzKGk5MTUsICZuZXdfd20pOwogCiAJaWYgKGlzX2VuYWJsaW5nKG9s
ZF93bS0+Y3hzciwgbmV3X3dtLmN4c3IsIHRydWUpKQotCQlfaW50ZWxfc2V0X21lbW9yeV9jeHNy
KGRldl9wcml2LCB0cnVlKTsKKwkJX2ludGVsX3NldF9tZW1vcnlfY3hzcihpOTE1LCB0cnVlKTsK
IAogCSpvbGRfd20gPSBuZXdfd207CiB9CkBAIC0xNTUyLDI4ICsxNTUyLDI4IEBAIHN0YXRpYyB2
b2lkIGc0eF9wcm9ncmFtX3dhdGVybWFya3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogc3RhdGljIHZvaWQgZzR4X2luaXRpYWxfd2F0ZXJtYXJrcyhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCi0JbXV0
ZXhfbG9jaygmZGV2X3ByaXYtPndtLndtX211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT53bS53
bV9tdXRleCk7CiAJY3J0Yy0+d20uYWN0aXZlLmc0eCA9IGNydGNfc3RhdGUtPndtLmc0eC5pbnRl
cm1lZGlhdGU7Ci0JZzR4X3Byb2dyYW1fd2F0ZXJtYXJrcyhkZXZfcHJpdik7Ci0JbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+d20ud21fbXV0ZXgpOworCWc0eF9wcm9ncmFtX3dhdGVybWFya3MoaTkx
NSk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT53bS53bV9tdXRleCk7CiB9CiAKIHN0YXRpYyB2b2lk
IGc0eF9vcHRpbWl6ZV93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
LAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCiAJaWYgKCFjcnRjX3N0
YXRlLT53bS5uZWVkX3Bvc3R2YmxfdXBkYXRlKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZk
ZXZfcHJpdi0+d20ud21fbXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPndtLndtX211dGV4KTsK
IAlpbnRlbF9jcnRjLT53bS5hY3RpdmUuZzR4ID0gY3J0Y19zdGF0ZS0+d20uZzR4Lm9wdGltYWw7
Ci0JZzR4X3Byb2dyYW1fd2F0ZXJtYXJrcyhkZXZfcHJpdik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+d20ud21fbXV0ZXgpOworCWc0eF9wcm9ncmFtX3dhdGVybWFya3MoaTkxNSk7CisJbXV0
ZXhfdW5sb2NrKCZpOTE1LT53bS53bV9tdXRleCk7CiB9CiAKIC8qIGxhdGVuY3kgbXVzdCBiZSBp
biAwLjF1cyB1bml0cy4gKi8KQEAgLTE1OTIsMTggKzE1OTIsMTggQEAgc3RhdGljIHVuc2lnbmVk
IGludCB2bHZfd21fbWV0aG9kMih1bnNpZ25lZCBpbnQgcGl4ZWxfcmF0ZSwKIAlyZXR1cm4gcmV0
OwogfQogCi1zdGF0aWMgdm9pZCB2bHZfc2V0dXBfd21fbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB2bHZfc2V0dXBfd21fbGF0ZW5jeShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAkvKiBhbGwgbGF0ZW5jaWVzIGluIHVzZWMg
Ki8KLQlkZXZfcHJpdi0+d20ucHJpX2xhdGVuY3lbVkxWX1dNX0xFVkVMX1BNMl0gPSAzOworCWk5
MTUtPndtLnByaV9sYXRlbmN5W1ZMVl9XTV9MRVZFTF9QTTJdID0gMzsKIAotCWRldl9wcml2LT53
bS5tYXhfbGV2ZWwgPSBWTFZfV01fTEVWRUxfUE0yOworCWk5MTUtPndtLm1heF9sZXZlbCA9IFZM
Vl9XTV9MRVZFTF9QTTI7CiAKLQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKLQkJZGV2
X3ByaXYtPndtLnByaV9sYXRlbmN5W1ZMVl9XTV9MRVZFTF9QTTVdID0gMTI7Ci0JCWRldl9wcml2
LT53bS5wcmlfbGF0ZW5jeVtWTFZfV01fTEVWRUxfRERSX0RWRlNdID0gMzM7CisJaWYgKElTX0NI
RVJSWVZJRVcoaTkxNSkpIHsKKwkJaTkxNS0+d20ucHJpX2xhdGVuY3lbVkxWX1dNX0xFVkVMX1BN
NV0gPSAxMjsKKwkJaTkxNS0+d20ucHJpX2xhdGVuY3lbVkxWX1dNX0xFVkVMX0REUl9EVkZTXSA9
IDMzOwogCi0JCWRldl9wcml2LT53bS5tYXhfbGV2ZWwgPSBWTFZfV01fTEVWRUxfRERSX0RWRlM7
CisJCWk5MTUtPndtLm1heF9sZXZlbCA9IFZMVl9XTV9MRVZFTF9ERFJfRFZGUzsKIAl9CiB9CiAK
QEAgLTE2MTIsMTIgKzE2MTIsMTIgQEAgc3RhdGljIHUxNiB2bHZfY29tcHV0ZV93bV9sZXZlbChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQlpbnQgbGV2ZWwp
CiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0
YXRlLT5iYXNlLnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPQogCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOwog
CXVuc2lnbmVkIGludCBjbG9jaywgaHRvdGFsLCBjcHAsIHdpZHRoLCB3bTsKIAotCWlmIChkZXZf
cHJpdi0+d20ucHJpX2xhdGVuY3lbbGV2ZWxdID09IDApCisJaWYgKGk5MTUtPndtLnByaV9sYXRl
bmN5W2xldmVsXSA9PSAwKQogCQlyZXR1cm4gVVNIUlRfTUFYOwogCiAJaWYgKCFpbnRlbF93bV9w
bGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKQEAgLTE2MzgsNyArMTYzOCw3
IEBAIHN0YXRpYyB1MTYgdmx2X2NvbXB1dGVfd21fbGV2ZWwoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXdtID0gNjM7CiAJfSBlbHNlIHsKIAkJd20gPSB2bHZf
d21fbWV0aG9kMihjbG9jaywgaHRvdGFsLCB3aWR0aCwgY3BwLAotCQkJCSAgICBkZXZfcHJpdi0+
d20ucHJpX2xhdGVuY3lbbGV2ZWxdICogMTApOworCQkJCSAgICBpOTE1LT53bS5wcmlfbGF0ZW5j
eVtsZXZlbF0gKiAxMCk7CiAJfQogCiAJcmV0dXJuIG1pbl90KHVuc2lnbmVkIGludCwgd20sIFVT
SFJUX01BWCk7CkBAIC0xNzM2LDkgKzE3MzYsOSBAQCBzdGF0aWMgaW50IHZsdl9jb21wdXRlX2Zp
Zm8oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0aWMgdm9pZCB2bHZf
aW52YWxpZGF0ZV93bXMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAgICAgc3RydWN0
IHZsdl93bV9zdGF0ZSAqd21fc3RhdGUsIGludCBsZXZlbCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCi0JZm9yICg7
IGxldmVsIDwgaW50ZWxfd21fbnVtX2xldmVscyhkZXZfcHJpdik7IGxldmVsKyspIHsKKwlmb3Ig
KDsgbGV2ZWwgPCBpbnRlbF93bV9udW1fbGV2ZWxzKGk5MTUpOyBsZXZlbCsrKSB7CiAJCWVudW0g
cGxhbmVfaWQgcGxhbmVfaWQ7CiAKIAkJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhjcnRjLCBw
bGFuZV9pZCkKQEAgLTE3NjQsOCArMTc2NCw4IEBAIHN0YXRpYyB1MTYgdmx2X2ludmVydF93bV92
YWx1ZSh1MTYgd20sIHUxNiBmaWZvX3NpemUpCiBzdGF0aWMgYm9vbCB2bHZfcmF3X3BsYW5lX3dt
X3NldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgaW50IGxldmVs
LCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkLCB1MTYgdmFsdWUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7
Ci0JaW50IG51bV9sZXZlbHMgPSBpbnRlbF93bV9udW1fbGV2ZWxzKGRldl9wcml2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
LT5kZXYpOworCWludCBudW1fbGV2ZWxzID0gaW50ZWxfd21fbnVtX2xldmVscyhpOTE1KTsKIAli
b29sIGRpcnR5ID0gZmFsc2U7CiAKIAlmb3IgKDsgbGV2ZWwgPCBudW1fbGV2ZWxzOyBsZXZlbCsr
KSB7CkBAIC0xODQwLDcgKzE4NDAsNyBAQCBzdGF0aWMgYm9vbCB2bHZfcmF3X2NydGNfd21faXNf
dmFsaWQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMg
aW50IHZsdl9jb21wdXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSA9CiAJCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKIAlz
dHJ1Y3Qgdmx2X3dtX3N0YXRlICp3bV9zdGF0ZSA9ICZjcnRjX3N0YXRlLT53bS52bHYub3B0aW1h
bDsKQEAgLTE4OTcsNyArMTg5Nyw3IEBAIHN0YXRpYyBpbnQgdmx2X2NvbXB1dGVfcGlwZV93bShz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAl9CiAKIAkvKiBpbml0aWFsbHkg
YWxsb3cgYWxsIGxldmVscyAqLwotCXdtX3N0YXRlLT5udW1fbGV2ZWxzID0gaW50ZWxfd21fbnVt
X2xldmVscyhkZXZfcHJpdik7CisJd21fc3RhdGUtPm51bV9sZXZlbHMgPSBpbnRlbF93bV9udW1f
bGV2ZWxzKGk5MTUpOwogCS8qCiAJICogTm90ZSB0aGF0IGVuYWJsaW5nIGN4c3Igd2l0aCBubyBw
cmltYXJ5L3Nwcml0ZSBwbGFuZXMKIAkgKiBlbmFibGVkIGNhbiB3ZWRnZSB0aGUgcGlwZS4gSGVu
Y2Ugd2Ugb25seSBhbGxvdyBjeHNyCkBAIC0xOTA3LDcgKzE5MDcsNyBAQCBzdGF0aWMgaW50IHZs
dl9jb21wdXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAK
IAlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPCB3bV9zdGF0ZS0+bnVtX2xldmVsczsgbGV2ZWwrKykg
ewogCQljb25zdCBzdHJ1Y3QgZzR4X3BpcGVfd20gKnJhdyA9ICZjcnRjX3N0YXRlLT53bS52bHYu
cmF3W2xldmVsXTsKLQkJY29uc3QgaW50IHNyX2ZpZm9fc2l6ZSA9IElOVEVMX0lORk8oZGV2X3By
aXYpLT5udW1fcGlwZXMgKiA1MTIgLSAxOworCQljb25zdCBpbnQgc3JfZmlmb19zaXplID0gSU5U
RUxfSU5GTyhpOTE1KS0+bnVtX3BpcGVzICogNTEyIC0gMTsKIAogCQlpZiAoIXZsdl9yYXdfY3J0
Y193bV9pc192YWxpZChjcnRjX3N0YXRlLCBsZXZlbCkpCiAJCQlicmVhazsKQEAgLTE5NDgsOCAr
MTk0OCw4IEBAIHN0YXRpYyB2b2lkIHZsdl9hdG9taWNfdXBkYXRlX2ZpZm8oc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3Jl
ID0gJmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAm
aTkxNS0+dW5jb3JlOwogCWNvbnN0IHN0cnVjdCB2bHZfZmlmb19zdGF0ZSAqZmlmb19zdGF0ZSA9
CiAJCSZjcnRjX3N0YXRlLT53bS52bHYuZmlmb19zdGF0ZTsKIAlpbnQgc3ByaXRlMF9zdGFydCwg
c3ByaXRlMV9zdGFydCwgZmlmb19zaXplOwpAQCAtMjA5MiwxNiArMjA5MiwxNiBAQCBzdGF0aWMg
aW50IHZsdl9jb21wdXRlX2ludGVybWVkaWF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
bmV3X2NydGNfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIHZsdl9tZXJnZV93
bShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCB2bHZfbWVy
Z2Vfd20oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgc3RydWN0IHZsdl93bV92
YWx1ZXMgKndtKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCWludCBudW1fYWN0aXZl
X2NydGNzID0gMDsKIAotCXdtLT5sZXZlbCA9IGRldl9wcml2LT53bS5tYXhfbGV2ZWw7CisJd20t
PmxldmVsID0gaTkxNS0+d20ubWF4X2xldmVsOwogCXdtLT5jeHNyID0gdHJ1ZTsKIAotCWZvcl9l
YWNoX2ludGVsX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMpIHsKKwlmb3JfZWFjaF9pbnRlbF9j
cnRjKCZpOTE1LT5kcm0sIGNydGMpIHsKIAkJY29uc3Qgc3RydWN0IHZsdl93bV9zdGF0ZSAqd21f
c3RhdGUgPSAmY3J0Yy0+d20uYWN0aXZlLnZsdjsKIAogCQlpZiAoIWNydGMtPmFjdGl2ZSkKQEAg
LTIxMjAsNyArMjEyMCw3IEBAIHN0YXRpYyB2b2lkIHZsdl9tZXJnZV93bShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKG51bV9hY3RpdmVfY3J0Y3MgPiAxKQogCQl3bS0+
bGV2ZWwgPSBWTFZfV01fTEVWRUxfUE0yOwogCi0JZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3By
aXYtPmRybSwgY3J0YykgeworCWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRybSwgY3J0Yykg
ewogCQljb25zdCBzdHJ1Y3Qgdmx2X3dtX3N0YXRlICp3bV9zdGF0ZSA9ICZjcnRjLT53bS5hY3Rp
dmUudmx2OwogCQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKQEAgLTIxMzUsMzUgKzIx
MzUsMzUgQEAgc3RhdGljIHZvaWQgdmx2X21lcmdlX3dtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIHZsdl9wcm9ncmFtX3dhdGVybWFya3Mo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmx2X3Byb2dy
YW1fd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qg
dmx2X3dtX3ZhbHVlcyAqb2xkX3dtID0gJmRldl9wcml2LT53bS52bHY7CisJc3RydWN0IHZsdl93
bV92YWx1ZXMgKm9sZF93bSA9ICZpOTE1LT53bS52bHY7CiAJc3RydWN0IHZsdl93bV92YWx1ZXMg
bmV3X3dtID0ge307CiAKLQl2bHZfbWVyZ2Vfd20oZGV2X3ByaXYsICZuZXdfd20pOworCXZsdl9t
ZXJnZV93bShpOTE1LCAmbmV3X3dtKTsKIAogCWlmIChtZW1jbXAob2xkX3dtLCAmbmV3X3dtLCBz
aXplb2YobmV3X3dtKSkgPT0gMCkKIAkJcmV0dXJuOwogCiAJaWYgKGlzX2Rpc2FibGluZyhvbGRf
d20tPmxldmVsLCBuZXdfd20ubGV2ZWwsIFZMVl9XTV9MRVZFTF9ERFJfRFZGUykpCi0JCWNodl9z
ZXRfbWVtb3J5X2R2ZnMoZGV2X3ByaXYsIGZhbHNlKTsKKwkJY2h2X3NldF9tZW1vcnlfZHZmcyhp
OTE1LCBmYWxzZSk7CiAKIAlpZiAoaXNfZGlzYWJsaW5nKG9sZF93bS0+bGV2ZWwsIG5ld193bS5s
ZXZlbCwgVkxWX1dNX0xFVkVMX1BNNSkpCi0JCWNodl9zZXRfbWVtb3J5X3BtNShkZXZfcHJpdiwg
ZmFsc2UpOworCQljaHZfc2V0X21lbW9yeV9wbTUoaTkxNSwgZmFsc2UpOwogCiAJaWYgKGlzX2Rp
c2FibGluZyhvbGRfd20tPmN4c3IsIG5ld193bS5jeHNyLCB0cnVlKSkKLQkJX2ludGVsX3NldF9t
ZW1vcnlfY3hzcihkZXZfcHJpdiwgZmFsc2UpOworCQlfaW50ZWxfc2V0X21lbW9yeV9jeHNyKGk5
MTUsIGZhbHNlKTsKIAotCXZsdl93cml0ZV93bV92YWx1ZXMoZGV2X3ByaXYsICZuZXdfd20pOwor
CXZsdl93cml0ZV93bV92YWx1ZXMoaTkxNSwgJm5ld193bSk7CiAKIAlpZiAoaXNfZW5hYmxpbmco
b2xkX3dtLT5jeHNyLCBuZXdfd20uY3hzciwgdHJ1ZSkpCi0JCV9pbnRlbF9zZXRfbWVtb3J5X2N4
c3IoZGV2X3ByaXYsIHRydWUpOworCQlfaW50ZWxfc2V0X21lbW9yeV9jeHNyKGk5MTUsIHRydWUp
OwogCiAJaWYgKGlzX2VuYWJsaW5nKG9sZF93bS0+bGV2ZWwsIG5ld193bS5sZXZlbCwgVkxWX1dN
X0xFVkVMX1BNNSkpCi0JCWNodl9zZXRfbWVtb3J5X3BtNShkZXZfcHJpdiwgdHJ1ZSk7CisJCWNo
dl9zZXRfbWVtb3J5X3BtNShpOTE1LCB0cnVlKTsKIAogCWlmIChpc19lbmFibGluZyhvbGRfd20t
PmxldmVsLCBuZXdfd20ubGV2ZWwsIFZMVl9XTV9MRVZFTF9ERFJfRFZGUykpCi0JCWNodl9zZXRf
bWVtb3J5X2R2ZnMoZGV2X3ByaXYsIHRydWUpOworCQljaHZfc2V0X21lbW9yeV9kdmZzKGk5MTUs
IHRydWUpOwogCiAJKm9sZF93bSA9IG5ld193bTsKIH0KQEAgLTIxNzEsNDAgKzIxNzEsNDAgQEAg
c3RhdGljIHZvaWQgdmx2X3Byb2dyYW1fd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiBzdGF0aWMgdm9pZCB2bHZfaW5pdGlhbF93YXRlcm1hcmtzKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7
CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+d20ud21fbXV0ZXgpOworCW11dGV4X2xvY2soJmk5
MTUtPndtLndtX211dGV4KTsKIAljcnRjLT53bS5hY3RpdmUudmx2ID0gY3J0Y19zdGF0ZS0+d20u
dmx2LmludGVybWVkaWF0ZTsKLQl2bHZfcHJvZ3JhbV93YXRlcm1hcmtzKGRldl9wcml2KTsKLQlt
dXRleF91bmxvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CisJdmx2X3Byb2dyYW1fd2F0ZXJt
YXJrcyhpOTE1KTsKKwltdXRleF91bmxvY2soJmk5MTUtPndtLndtX211dGV4KTsKIH0KIAogc3Rh
dGljIHZvaWQgdmx2X29wdGltaXplX3dhdGVybWFya3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0
ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAKIAlpZiAo
IWNydGNfc3RhdGUtPndtLm5lZWRfcG9zdHZibF91cGRhdGUpCiAJCXJldHVybjsKIAotCW11dGV4
X2xvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CisJbXV0ZXhfbG9jaygmaTkxNS0+d20ud21f
bXV0ZXgpOwogCWludGVsX2NydGMtPndtLmFjdGl2ZS52bHYgPSBjcnRjX3N0YXRlLT53bS52bHYu
b3B0aW1hbDsKLQl2bHZfcHJvZ3JhbV93YXRlcm1hcmtzKGRldl9wcml2KTsKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CisJdmx2X3Byb2dyYW1fd2F0ZXJtYXJrcyhpOTE1
KTsKKwltdXRleF91bmxvY2soJmk5MTUtPndtLndtX211dGV4KTsKIH0KIAogc3RhdGljIHZvaWQg
aTk2NV91cGRhdGVfd20oc3RydWN0IGludGVsX2NydGMgKnVudXNlZF9jcnRjKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUodW51c2VkX2NydGMtPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUodW51c2VkX2Ny
dGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlpbnQgc3J3bSA9IDE7
CiAJaW50IGN1cnNvcl9zciA9IDE2OwogCWJvb2wgY3hzcl9lbmFibGVkOwogCiAJLyogQ2FsYyBz
ciBlbnRyaWVzIGZvciBvbmUgcGxhbmUgY29uZmlncyAqLwotCWNydGMgPSBzaW5nbGVfZW5hYmxl
ZF9jcnRjKGRldl9wcml2KTsKKwljcnRjID0gc2luZ2xlX2VuYWJsZWRfY3J0YyhpOTE1KTsKIAlp
ZiAoY3J0YykgewogCQkvKiBzZWxmLXJlZnJlc2ggaGFzIG11Y2ggaGlnaGVyIGxhdGVuY3kgKi8K
IAkJc3RhdGljIGNvbnN0IGludCBzcl9sYXRlbmN5X25zID0gMTIwMDA7CkBAIC0yMjQ2LDcgKzIy
NDYsNyBAQCBzdGF0aWMgdm9pZCBpOTY1X3VwZGF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0YyAqdW51
c2VkX2NydGMpCiAJfSBlbHNlIHsKIAkJY3hzcl9lbmFibGVkID0gZmFsc2U7CiAJCS8qIFR1cm4g
b2ZmIHNlbGYgcmVmcmVzaCBpZiBib3RoIHBpcGVzIGFyZSBlbmFibGVkICovCi0JCWludGVsX3Nl
dF9tZW1vcnlfY3hzcihkZXZfcHJpdiwgZmFsc2UpOworCQlpbnRlbF9zZXRfbWVtb3J5X2N4c3Io
aTkxNSwgZmFsc2UpOwogCX0KIAogCURSTV9ERUJVR19LTVMoIlNldHRpbmcgRklGTyB3YXRlcm1h
cmtzIC0gQTogOCwgQjogOCwgQzogOCwgU1IgJWRcbiIsCkBAIC0yMjYzLDE0ICsyMjYzLDE0IEBA
IHN0YXRpYyB2b2lkIGk5NjVfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0
YykKIAlJOTE1X1dSSVRFKERTUEZXMywgRldfV00oY3Vyc29yX3NyLCBDVVJTT1JfU1IpKTsKIAog
CWlmIChjeHNyX2VuYWJsZWQpCi0JCWludGVsX3NldF9tZW1vcnlfY3hzcihkZXZfcHJpdiwgdHJ1
ZSk7CisJCWludGVsX3NldF9tZW1vcnlfY3hzcihpOTE1LCB0cnVlKTsKIH0KIAogI3VuZGVmIEZX
X1dNCiAKIHN0YXRpYyB2b2lkIGk5eHhfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVz
ZWRfY3J0YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KHVudXNlZF9jcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KHVudXNlZF9jcnRjLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGludGVsX3dh
dGVybWFya19wYXJhbXMgKndtX2luZm87CiAJdTMyIGZ3YXRlcl9sbzsKIAl1MzIgZndhdGVyX2hp
OwpAQCAtMjI3OSwxNSArMjI3OSwxNSBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV93bShzdHJ1
Y3QgaW50ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJaW50IHBsYW5lYV93bSwgcGxhbmViX3dtOwog
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLCAqZW5hYmxlZCA9IE5VTEw7CiAKLQlpZiAoSVNfSTk0
NUdNKGRldl9wcml2KSkKKwlpZiAoSVNfSTk0NUdNKGk5MTUpKQogCQl3bV9pbmZvID0gJmk5NDVf
d21faW5mbzsKLQllbHNlIGlmICghSVNfR0VOKGRldl9wcml2LCAyKSkKKwllbHNlIGlmICghSVNf
R0VOKGk5MTUsIDIpKQogCQl3bV9pbmZvID0gJmk5MTVfd21faW5mbzsKIAllbHNlCiAJCXdtX2lu
Zm8gPSAmaTgzMF9hX3dtX2luZm87CiAKLQlmaWZvX3NpemUgPSBkZXZfcHJpdi0+ZGlzcGxheS5n
ZXRfZmlmb19zaXplKGRldl9wcml2LCBQTEFORV9BKTsKLQljcnRjID0gaW50ZWxfZ2V0X2NydGNf
Zm9yX3BsYW5lKGRldl9wcml2LCBQTEFORV9BKTsKKwlmaWZvX3NpemUgPSBpOTE1LT5kaXNwbGF5
LmdldF9maWZvX3NpemUoaTkxNSwgUExBTkVfQSk7CisJY3J0YyA9IGludGVsX2dldF9jcnRjX2Zv
cl9wbGFuZShpOTE1LCBQTEFORV9BKTsKIAlpZiAoaW50ZWxfY3J0Y19hY3RpdmUoY3J0YykpIHsK
IAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQogCQkJJmNy
dGMtPmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOwpAQCAtMjI5NSw3ICsyMjk1LDcgQEAgc3Rh
dGljIHZvaWQgaTl4eF91cGRhdGVfd20oc3RydWN0IGludGVsX2NydGMgKnVudXNlZF9jcnRjKQog
CQkJY3J0Yy0+YmFzZS5wcmltYXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjcHA7CiAKLQkJaWYgKElT
X0dFTihkZXZfcHJpdiwgMikpCisJCWlmIChJU19HRU4oaTkxNSwgMikpCiAJCQljcHAgPSA0Owog
CQllbHNlCiAJCQljcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CkBAIC0yMzEwLDExICsyMzEwLDEx
IEBAIHN0YXRpYyB2b2lkIGk5eHhfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRf
Y3J0YykKIAkJCXBsYW5lYV93bSA9IHdtX2luZm8tPm1heF93bTsKIAl9CiAKLQlpZiAoSVNfR0VO
KGRldl9wcml2LCAyKSkKKwlpZiAoSVNfR0VOKGk5MTUsIDIpKQogCQl3bV9pbmZvID0gJmk4MzBf
YmNfd21faW5mbzsKIAotCWZpZm9fc2l6ZSA9IGRldl9wcml2LT5kaXNwbGF5LmdldF9maWZvX3Np
emUoZGV2X3ByaXYsIFBMQU5FX0IpOwotCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGxhbmUo
ZGV2X3ByaXYsIFBMQU5FX0IpOworCWZpZm9fc2l6ZSA9IGk5MTUtPmRpc3BsYXkuZ2V0X2ZpZm9f
c2l6ZShpOTE1LCBQTEFORV9CKTsKKwljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BsYW5lKGk5
MTUsIFBMQU5FX0IpOwogCWlmIChpbnRlbF9jcnRjX2FjdGl2ZShjcnRjKSkgewogCQljb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJCQkmY3J0Yy0+Y29uZmln
LT5iYXNlLmFkanVzdGVkX21vZGU7CkBAIC0yMzIyLDcgKzIzMjIsNyBAQCBzdGF0aWMgdm9pZCBp
OXh4X3VwZGF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJCQljcnRjLT5i
YXNlLnByaW1hcnktPnN0YXRlLT5mYjsKIAkJaW50IGNwcDsKIAotCQlpZiAoSVNfR0VOKGRldl9w
cml2LCAyKSkKKwkJaWYgKElTX0dFTihpOTE1LCAyKSkKIAkJCWNwcCA9IDQ7CiAJCWVsc2UKIAkJ
CWNwcCA9IGZiLT5mb3JtYXQtPmNwcFswXTsKQEAgLTIzNDIsNyArMjM0Miw3IEBAIHN0YXRpYyB2
b2lkIGk5eHhfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAogCURS
TV9ERUJVR19LTVMoIkZJRk8gd2F0ZXJtYXJrcyAtIEE6ICVkLCBCOiAlZFxuIiwgcGxhbmVhX3dt
LCBwbGFuZWJfd20pOwogCi0JaWYgKElTX0k5MTVHTShkZXZfcHJpdikgJiYgZW5hYmxlZCkgewor
CWlmIChJU19JOTE1R00oaTkxNSkgJiYgZW5hYmxlZCkgewogCQlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqOwogCiAJCW9iaiA9IGludGVsX2ZiX29iaihlbmFibGVkLT5iYXNlLnByaW1h
cnktPnN0YXRlLT5mYik7CkBAIC0yMzU4LDEwICsyMzU4LDEwIEBAIHN0YXRpYyB2b2lkIGk5eHhf
dXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAljd20gPSAyOwogCiAJ
LyogUGxheSBzYWZlIGFuZCBkaXNhYmxlIHNlbGYtcmVmcmVzaCBiZWZvcmUgYWRqdXN0aW5nIHdh
dGVybWFya3MuICovCi0JaW50ZWxfc2V0X21lbW9yeV9jeHNyKGRldl9wcml2LCBmYWxzZSk7CisJ
aW50ZWxfc2V0X21lbW9yeV9jeHNyKGk5MTUsIGZhbHNlKTsKIAogCS8qIENhbGMgc3IgZW50cmll
cyBmb3Igb25lIHBsYW5lIGNvbmZpZ3MgKi8KLQlpZiAoSEFTX0ZXX0JMQyhkZXZfcHJpdikgJiYg
ZW5hYmxlZCkgeworCWlmIChIQVNfRldfQkxDKGk5MTUpICYmIGVuYWJsZWQpIHsKIAkJLyogc2Vs
Zi1yZWZyZXNoIGhhcyBtdWNoIGhpZ2hlciBsYXRlbmN5ICovCiAJCXN0YXRpYyBjb25zdCBpbnQg
c3JfbGF0ZW5jeV9ucyA9IDYwMDA7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0KQEAgLTIzNzQsNyArMjM3NCw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfdXBk
YXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAkJaW50IGNwcDsKIAkJaW50
IGVudHJpZXM7CiAKLQkJaWYgKElTX0k5MTVHTShkZXZfcHJpdikgfHwgSVNfSTk0NUdNKGRldl9w
cml2KSkKKwkJaWYgKElTX0k5MTVHTShpOTE1KSB8fCBJU19JOTQ1R00oaTkxNSkpCiAJCQljcHAg
PSA0OwogCQllbHNlCiAJCQljcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CkBAIC0yMzg3LDcgKzIz
ODcsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0YyAqdW51
c2VkX2NydGMpCiAJCWlmIChzcndtIDwgMCkKIAkJCXNyd20gPSAxOwogCi0JCWlmIChJU19JOTQ1
RyhkZXZfcHJpdikgfHwgSVNfSTk0NUdNKGRldl9wcml2KSkKKwkJaWYgKElTX0k5NDVHKGk5MTUp
IHx8IElTX0k5NDVHTShpOTE1KSkKIAkJCUk5MTVfV1JJVEUoRldfQkxDX1NFTEYsCiAJCQkJICAg
RldfQkxDX1NFTEZfRklGT19NQVNLIHwgKHNyd20gJiAweGZmKSk7CiAJCWVsc2UKQEAgLTI0MDgs
MjUgKzI0MDgsMjUgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfd20oc3RydWN0IGludGVsX2Ny
dGMgKnVudXNlZF9jcnRjKQogCUk5MTVfV1JJVEUoRldfQkxDMiwgZndhdGVyX2hpKTsKIAogCWlm
IChlbmFibGVkKQotCQlpbnRlbF9zZXRfbWVtb3J5X2N4c3IoZGV2X3ByaXYsIHRydWUpOworCQlp
bnRlbF9zZXRfbWVtb3J5X2N4c3IoaTkxNSwgdHJ1ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGk4NDVf
dXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHVudXNlZF9jcnRjLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHVudXNlZF9jcnRjLT5i
YXNlLmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7CiAJY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGU7CiAJdTMyIGZ3YXRlcl9sbzsKIAlpbnQgcGxhbmVh
X3dtOwogCi0JY3J0YyA9IHNpbmdsZV9lbmFibGVkX2NydGMoZGV2X3ByaXYpOworCWNydGMgPSBz
aW5nbGVfZW5hYmxlZF9jcnRjKGk5MTUpOwogCWlmIChjcnRjID09IE5VTEwpCiAJCXJldHVybjsK
IAogCWFkanVzdGVkX21vZGUgPSAmY3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CiAJ
cGxhbmVhX3dtID0gaW50ZWxfY2FsY3VsYXRlX3dtKGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2ss
CiAJCQkJICAgICAgICZpODQ1X3dtX2luZm8sCi0JCQkJICAgICAgIGRldl9wcml2LT5kaXNwbGF5
LmdldF9maWZvX3NpemUoZGV2X3ByaXYsIFBMQU5FX0EpLAorCQkJCSAgICAgICBpOTE1LT5kaXNw
bGF5LmdldF9maWZvX3NpemUoaTkxNSwgUExBTkVfQSksCiAJCQkJICAgICAgIDQsIHBlc3NpbWFs
X2xhdGVuY3lfbnMpOwogCWZ3YXRlcl9sbyA9IEk5MTVfUkVBRChGV19CTEMpICYgfjB4ZmZmOwog
CWZ3YXRlcl9sbyB8PSAoMzw8OCkgfCBwbGFuZWFfd207CkBAIC0yNTg2LDI0ICsyNTg2LDI0IEBA
IHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfZmJjX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjc3RhdGUsCiB9CiAKIHN0YXRpYyB1bnNpZ25lZCBpbnQKLWlsa19kaXNwbGF5X2ZpZm9f
c2l6ZShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbGtfZGlzcGxh
eV9maWZvX3NpemUoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDgpCiAJ
CXJldHVybiAzMDcyOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNykKKwllbHNl
IGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNykKIAkJcmV0dXJuIDc2ODsKIAllbHNlCiAJCXJldHVy
biA1MTI7CiB9CiAKIHN0YXRpYyB1bnNpZ25lZCBpbnQKLWlsa19wbGFuZV93bV9yZWdfbWF4KGNv
bnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2lsa19wbGFuZV93bV9yZWdf
bWF4KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgIGludCBsZXZl
bCwgYm9vbCBpc19zcHJpdGUpCiB7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKKwlp
ZiAoSU5URUxfR0VOKGk5MTUpID49IDgpCiAJCS8qIEJEVyBwcmltYXJ5L3Nwcml0ZSBwbGFuZSB3
YXRlcm1hcmtzICovCiAJCXJldHVybiBsZXZlbCA9PSAwID8gMjU1IDogMjA0NzsKLQllbHNlIGlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDcpCisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49
IDcpCiAJCS8qIElWQi9IU1cgcHJpbWFyeS9zcHJpdGUgcGxhbmUgd2F0ZXJtYXJrcyAqLwogCQly
ZXR1cm4gbGV2ZWwgPT0gMCA/IDEyNyA6IDEwMjM7CiAJZWxzZSBpZiAoIWlzX3Nwcml0ZSkKQEAg
LTI2MTUsMzAgKzI2MTUsMzAgQEAgaWxrX3BsYW5lX3dtX3JlZ19tYXgoY29uc3Qgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdGF0aWMgdW5zaWduZWQgaW50Ci1pbGtf
Y3Vyc29yX3dtX3JlZ19tYXgoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBpbnQgbGV2ZWwpCitpbGtfY3Vyc29yX3dtX3JlZ19tYXgoY29uc3Qgc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIGludCBsZXZlbCkKIHsKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA3KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNykKIAkJcmV0dXJuIGxldmVsID09IDAgPyA2
MyA6IDI1NTsKIAllbHNlCiAJCXJldHVybiBsZXZlbCA9PSAwID8gMzEgOiA2MzsKIH0KIAotc3Rh
dGljIHVuc2lnbmVkIGludCBpbGtfZmJjX3dtX3JlZ19tYXgoY29uc3Qgc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHVuc2lnbmVkIGludCBpbGtfZmJjX3dtX3JlZ19t
YXgoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gOCkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDgpCiAJCXJldHVybiAz
MTsKIAllbHNlCiAJCXJldHVybiAxNTsKIH0KIAogLyogQ2FsY3VsYXRlIHRoZSBtYXhpbXVtIHBy
aW1hcnkvc3ByaXRlIHBsYW5lIHdhdGVybWFyayAqLwotc3RhdGljIHVuc2lnbmVkIGludCBpbGtf
cGxhbmVfd21fbWF4KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0
YXRpYyB1bnNpZ25lZCBpbnQgaWxrX3BsYW5lX3dtX21heChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIGludCBsZXZlbCwKIAkJCQkgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF93bV9jb25maWcgKmNvbmZpZywKIAkJCQkgICAgIGVudW0gaW50ZWxfZGRiX3BhcnRp
dGlvbmluZyBkZGJfcGFydGl0aW9uaW5nLAogCQkJCSAgICAgYm9vbCBpc19zcHJpdGUpCiB7Ci0J
dW5zaWduZWQgaW50IGZpZm9fc2l6ZSA9IGlsa19kaXNwbGF5X2ZpZm9fc2l6ZShkZXZfcHJpdik7
CisJdW5zaWduZWQgaW50IGZpZm9fc2l6ZSA9IGlsa19kaXNwbGF5X2ZpZm9fc2l6ZShpOTE1KTsK
IAogCS8qIGlmIHNwcml0ZXMgYXJlbid0IGVuYWJsZWQsIHNwcml0ZXMgZ2V0IG5vdGhpbmcgKi8K
IAlpZiAoaXNfc3ByaXRlICYmICFjb25maWctPnNwcml0ZXNfZW5hYmxlZCkKQEAgLTI2NDYsMTQg
KzI2NDYsMTQgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbGtfcGxhbmVfd21fbWF4KGNvbnN0IHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCS8qIEhTVyBhbGxvd3MgTFAxKyB3
YXRlcm1hcmtzIGV2ZW4gd2l0aCBtdWx0aXBsZSBwaXBlcyAqLwogCWlmIChsZXZlbCA9PSAwIHx8
IGNvbmZpZy0+bnVtX3BpcGVzX2FjdGl2ZSA+IDEpIHsKLQkJZmlmb19zaXplIC89IElOVEVMX0lO
Rk8oZGV2X3ByaXYpLT5udW1fcGlwZXM7CisJCWZpZm9fc2l6ZSAvPSBJTlRFTF9JTkZPKGk5MTUp
LT5udW1fcGlwZXM7CiAKIAkJLyoKIAkJICogRm9yIHNvbWUgcmVhc29uIHRoZSBub24gc2VsZiBy
ZWZyZXNoCiAJCSAqIEZJRk8gc2l6ZSBpcyBvbmx5IGhhbGYgb2YgdGhlIHNlbGYKIAkJICogcmVm
cmVzaCBGSUZPIHNpemUgb24gSUxLL1NOQi4KIAkJICovCi0JCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpIDw9IDYpCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPD0gNikKIAkJCWZpZm9fc2l6ZSAvPSAy
OwogCX0KIApAQCAtMjY2OSwxMSArMjY2OSwxMSBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGlsa19w
bGFuZV93bV9tYXgoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0K
IAogCS8qIGNsYW1wIHRvIG1heCB0aGF0IHRoZSByZWdpc3RlcnMgY2FuIGhvbGQgKi8KLQlyZXR1
cm4gbWluKGZpZm9fc2l6ZSwgaWxrX3BsYW5lX3dtX3JlZ19tYXgoZGV2X3ByaXYsIGxldmVsLCBp
c19zcHJpdGUpKTsKKwlyZXR1cm4gbWluKGZpZm9fc2l6ZSwgaWxrX3BsYW5lX3dtX3JlZ19tYXgo
aTkxNSwgbGV2ZWwsIGlzX3Nwcml0ZSkpOwogfQogCiAvKiBDYWxjdWxhdGUgdGhlIG1heGltdW0g
Y3Vyc29yIHBsYW5lIHdhdGVybWFyayAqLwotc3RhdGljIHVuc2lnbmVkIGludCBpbGtfY3Vyc29y
X3dtX21heChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
dW5zaWduZWQgaW50IGlsa19jdXJzb3Jfd21fbWF4KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJCSAgICAgIGludCBsZXZlbCwKIAkJCQkgICAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfd21fY29uZmlnICpjb25maWcpCiB7CkBAIC0yNjgyLDI5ICsyNjgyLDI5IEBAIHN0YXRp
YyB1bnNpZ25lZCBpbnQgaWxrX2N1cnNvcl93bV9tYXgoY29uc3Qgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm4gNjQ7CiAKIAkvKiBvdGhlcndpc2UganVzdCByZXBv
cnQgbWF4IHRoYXQgcmVnaXN0ZXJzIGNhbiBob2xkICovCi0JcmV0dXJuIGlsa19jdXJzb3Jfd21f
cmVnX21heChkZXZfcHJpdiwgbGV2ZWwpOworCXJldHVybiBpbGtfY3Vyc29yX3dtX3JlZ19tYXgo
aTkxNSwgbGV2ZWwpOwogfQogCi1zdGF0aWMgdm9pZCBpbGtfY29tcHV0ZV93bV9tYXhpbXVtcyhj
b25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbGtf
Y29tcHV0ZV93bV9tYXhpbXVtcyhjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgICAgaW50IGxldmVsLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfd21fY29uZmln
ICpjb25maWcsCiAJCQkJICAgIGVudW0gaW50ZWxfZGRiX3BhcnRpdGlvbmluZyBkZGJfcGFydGl0
aW9uaW5nLAogCQkJCSAgICBzdHJ1Y3QgaWxrX3dtX21heGltdW1zICptYXgpCiB7Ci0JbWF4LT5w
cmkgPSBpbGtfcGxhbmVfd21fbWF4KGRldl9wcml2LCBsZXZlbCwgY29uZmlnLCBkZGJfcGFydGl0
aW9uaW5nLCBmYWxzZSk7Ci0JbWF4LT5zcHIgPSBpbGtfcGxhbmVfd21fbWF4KGRldl9wcml2LCBs
ZXZlbCwgY29uZmlnLCBkZGJfcGFydGl0aW9uaW5nLCB0cnVlKTsKLQltYXgtPmN1ciA9IGlsa19j
dXJzb3Jfd21fbWF4KGRldl9wcml2LCBsZXZlbCwgY29uZmlnKTsKLQltYXgtPmZiYyA9IGlsa19m
YmNfd21fcmVnX21heChkZXZfcHJpdik7CisJbWF4LT5wcmkgPSBpbGtfcGxhbmVfd21fbWF4KGk5
MTUsIGxldmVsLCBjb25maWcsIGRkYl9wYXJ0aXRpb25pbmcsIGZhbHNlKTsKKwltYXgtPnNwciA9
IGlsa19wbGFuZV93bV9tYXgoaTkxNSwgbGV2ZWwsIGNvbmZpZywgZGRiX3BhcnRpdGlvbmluZywg
dHJ1ZSk7CisJbWF4LT5jdXIgPSBpbGtfY3Vyc29yX3dtX21heChpOTE1LCBsZXZlbCwgY29uZmln
KTsKKwltYXgtPmZiYyA9IGlsa19mYmNfd21fcmVnX21heChpOTE1KTsKIH0KIAotc3RhdGljIHZv
aWQgaWxrX2NvbXB1dGVfd21fcmVnX21heGltdW1zKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGlsa19jb21wdXRlX3dtX3JlZ19tYXhpbXVtcyhj
b25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJaW50IGxldmVsLAogCQkJ
CQlzdHJ1Y3QgaWxrX3dtX21heGltdW1zICptYXgpCiB7Ci0JbWF4LT5wcmkgPSBpbGtfcGxhbmVf
d21fcmVnX21heChkZXZfcHJpdiwgbGV2ZWwsIGZhbHNlKTsKLQltYXgtPnNwciA9IGlsa19wbGFu
ZV93bV9yZWdfbWF4KGRldl9wcml2LCBsZXZlbCwgdHJ1ZSk7Ci0JbWF4LT5jdXIgPSBpbGtfY3Vy
c29yX3dtX3JlZ19tYXgoZGV2X3ByaXYsIGxldmVsKTsKLQltYXgtPmZiYyA9IGlsa19mYmNfd21f
cmVnX21heChkZXZfcHJpdik7CisJbWF4LT5wcmkgPSBpbGtfcGxhbmVfd21fcmVnX21heChpOTE1
LCBsZXZlbCwgZmFsc2UpOworCW1heC0+c3ByID0gaWxrX3BsYW5lX3dtX3JlZ19tYXgoaTkxNSwg
bGV2ZWwsIHRydWUpOworCW1heC0+Y3VyID0gaWxrX2N1cnNvcl93bV9yZWdfbWF4KGk5MTUsIGxl
dmVsKTsKKwltYXgtPmZiYyA9IGlsa19mYmNfd21fcmVnX21heChpOTE1KTsKIH0KIAogc3RhdGlj
IGJvb2wgaWxrX3ZhbGlkYXRlX3dtX2xldmVsKGludCBsZXZlbCwKQEAgLTI3NDgsNyArMjc0OCw3
IEBAIHN0YXRpYyBib29sIGlsa192YWxpZGF0ZV93bV9sZXZlbChpbnQgbGV2ZWwsCiAJcmV0dXJu
IHJldDsKIH0KIAotc3RhdGljIHZvaWQgaWxrX2NvbXB1dGVfd21fbGV2ZWwoY29uc3Qgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaWxrX2NvbXB1dGVfd21f
bGV2ZWwoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJIGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkJCSBpbnQgbGV2ZWwsCiAJCQkJIHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCkBAIC0yNzU3LDkgKzI3NTcsOSBAQCBzdGF0aWMg
dm9pZCBpbGtfY29tcHV0ZV93bV9sZXZlbChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqY3Vyc3RhdGUs
CiAJCQkJIHN0cnVjdCBpbnRlbF93bV9sZXZlbCAqcmVzdWx0KQogewotCXUxNiBwcmlfbGF0ZW5j
eSA9IGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeVtsZXZlbF07Ci0JdTE2IHNwcl9sYXRlbmN5ID0g
ZGV2X3ByaXYtPndtLnNwcl9sYXRlbmN5W2xldmVsXTsKLQl1MTYgY3VyX2xhdGVuY3kgPSBkZXZf
cHJpdi0+d20uY3VyX2xhdGVuY3lbbGV2ZWxdOworCXUxNiBwcmlfbGF0ZW5jeSA9IGk5MTUtPndt
LnByaV9sYXRlbmN5W2xldmVsXTsKKwl1MTYgc3ByX2xhdGVuY3kgPSBpOTE1LT53bS5zcHJfbGF0
ZW5jeVtsZXZlbF07CisJdTE2IGN1cl9sYXRlbmN5ID0gaTkxNS0+d20uY3VyX2xhdGVuY3lbbGV2
ZWxdOwogCiAJLyogV00xKyBsYXRlbmN5IHZhbHVlcyBzdG9yZWQgaW4gMC41dXMgdW5pdHMgKi8K
IAlpZiAobGV2ZWwgPiAwKSB7CkBAIC0yODExLDE5ICsyODExLDE5IEBAIGhzd19jb21wdXRlX2xp
bmV0aW1lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiAJICAgICAg
IFBJUEVfV01fTElORVRJTUVfVElNRShsaW5ldGltZSk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVs
X3JlYWRfd21fbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdm9pZCBpbnRlbF9yZWFkX3dtX2xhdGVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICB1MTYgd21bOF0pCiB7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0g
JmRldl9wcml2LT51bmNvcmU7CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUt
PnVuY29yZTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpIHsKKwlpZiAoSU5URUxf
R0VOKGk5MTUpID49IDkpIHsKIAkJdTMyIHZhbDsKIAkJaW50IHJldCwgaTsKLQkJaW50IGxldmVs
LCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsKKwkJaW50IGxldmVsLCBt
YXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGk5MTUpOwogCiAJCS8qIHJlYWQgdGhlIGZpcnN0
IHNldCBvZiBtZW1vcnkgbGF0ZW5jaWVzWzA6M10gKi8KIAkJdmFsID0gMDsgLyogZGF0YTAgdG8g
YmUgcHJvZ3JhbW1lZCB0byAwIGZvciBmaXJzdCBzZXQgKi8KLQkJcmV0ID0gc2FuZHlicmlkZ2Vf
cGNvZGVfcmVhZChkZXZfcHJpdiwKKwkJcmV0ID0gc2FuZHlicmlkZ2VfcGNvZGVfcmVhZChpOTE1
LAogCQkJCQkgICAgIEdFTjlfUENPREVfUkVBRF9NRU1fTEFURU5DWSwKIAkJCQkJICAgICAmdmFs
LCBOVUxMKTsKIApAQCAtMjg0Miw3ICsyODQyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcmVhZF93
bV9sYXRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCQkvKiByZWFk
IHRoZSBzZWNvbmQgc2V0IG9mIG1lbW9yeSBsYXRlbmNpZXNbNDo3XSAqLwogCQl2YWwgPSAxOyAv
KiBkYXRhMCB0byBiZSBwcm9ncmFtbWVkIHRvIDEgZm9yIHNlY29uZCBzZXQgKi8KLQkJcmV0ID0g
c2FuZHlicmlkZ2VfcGNvZGVfcmVhZChkZXZfcHJpdiwKKwkJcmV0ID0gc2FuZHlicmlkZ2VfcGNv
ZGVfcmVhZChpOTE1LAogCQkJCQkgICAgIEdFTjlfUENPREVfUkVBRF9NRU1fTEFURU5DWSwKIAkJ
CQkJICAgICAmdmFsLCBOVUxMKTsKIAkJaWYgKHJldCkgewpAQCAtMjg5MywxMCArMjg5MywxMCBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9yZWFkX3dtX2xhdGVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQkgKiBhbnkgdW5kZXJydW4uIElmIG5vdCBhYmxlIHRvIGdldCBEaW1t
IGluZm8gYXNzdW1lIDE2R0IgZGltbQogCQkgKiB0byBhdm9pZCBhbnkgdW5kZXJydW4uCiAJCSAq
LwotCQlpZiAoZGV2X3ByaXYtPmRyYW1faW5mby5pc18xNmdiX2RpbW0pCisJCWlmIChpOTE1LT5k
cmFtX2luZm8uaXNfMTZnYl9kaW1tKQogCQkJd21bMF0gKz0gMTsKIAotCX0gZWxzZSBpZiAoSVNf
SEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkgeworCX0gZWxzZSBp
ZiAoSVNfSEFTV0VMTChpOTE1KSB8fCBJU19CUk9BRFdFTEwoaTkxNSkpIHsKIAkJdTY0IHNza3Bk
ID0gaW50ZWxfdW5jb3JlX3JlYWQ2NCh1bmNvcmUsIE1DSF9TU0tQRCk7CiAKIAkJd21bMF0gPSAo
c3NrcGQgPj4gNTYpICYgMHhGRjsKQEAgLTI5MDYsMTQgKzI5MDYsMTQgQEAgc3RhdGljIHZvaWQg
aW50ZWxfcmVhZF93bV9sYXRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAkJd21bMl0gPSAoc3NrcGQgPj4gMTIpICYgMHhGRjsKIAkJd21bM10gPSAoc3NrcGQgPj4gMjAp
ICYgMHgxRkY7CiAJCXdtWzRdID0gKHNza3BkID4+IDMyKSAmIDB4MUZGOwotCX0gZWxzZSBpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA2KSB7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkg
Pj0gNikgewogCQl1MzIgc3NrcGQgPSBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIE1DSF9TU0tQ
RCk7CiAKIAkJd21bMF0gPSAoc3NrcGQgPj4gU1NLUERfV00wX1NISUZUKSAmIFNTS1BEX1dNX01B
U0s7CiAJCXdtWzFdID0gKHNza3BkID4+IFNTS1BEX1dNMV9TSElGVCkgJiBTU0tQRF9XTV9NQVNL
OwogCQl3bVsyXSA9IChzc2twZCA+PiBTU0tQRF9XTTJfU0hJRlQpICYgU1NLUERfV01fTUFTSzsK
IAkJd21bM10gPSAoc3NrcGQgPj4gU1NLUERfV00zX1NISUZUKSAmIFNTS1BEX1dNX01BU0s7Ci0J
fSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDUpIHsKKwl9IGVsc2UgaWYgKElOVEVM
X0dFTihpOTE1KSA+PSA1KSB7CiAJCXUzMiBtbHRyID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3Jl
LCBNTFRSX0lMSyk7CiAKIAkJLyogSUxLIHByaW1hcnkgTFAwIGxhdGVuY3kgaXMgNzAwIG5zICov
CkBAIC0yOTIxLDQ0ICsyOTIxLDQ0IEBAIHN0YXRpYyB2b2lkIGludGVsX3JlYWRfd21fbGF0ZW5j
eShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXdtWzFdID0gKG1sdHIgPj4g
TUxUUl9XTTFfU0hJRlQpICYgSUxLX1NSTFRfTUFTSzsKIAkJd21bMl0gPSAobWx0ciA+PiBNTFRS
X1dNMl9TSElGVCkgJiBJTEtfU1JMVF9NQVNLOwogCX0gZWxzZSB7Ci0JCU1JU1NJTkdfQ0FTRShJ
TlRFTF9ERVZJRChkZXZfcHJpdikpOworCQlNSVNTSU5HX0NBU0UoSU5URUxfREVWSUQoaTkxNSkp
OwogCX0KIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfZml4dXBfc3ByX3dtX2xhdGVuY3koc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50ZWxfZml4dXBfc3By
X3dtX2xhdGVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgIHUx
NiB3bVs1XSkKIHsKIAkvKiBJTEsgc3ByaXRlIExQMCBsYXRlbmN5IGlzIDEzMDAgbnMgKi8KLQlp
ZiAoSVNfR0VOKGRldl9wcml2LCA1KSkKKwlpZiAoSVNfR0VOKGk5MTUsIDUpKQogCQl3bVswXSA9
IDEzOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9maXh1cF9jdXJfd21fbGF0ZW5jeShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRlbF9maXh1cF9jdXJf
d21fbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICAgdTE2
IHdtWzVdKQogewogCS8qIElMSyBjdXJzb3IgTFAwIGxhdGVuY3kgaXMgMTMwMCBucyAqLwotCWlm
IChJU19HRU4oZGV2X3ByaXYsIDUpKQorCWlmIChJU19HRU4oaTkxNSwgNSkpCiAJCXdtWzBdID0g
MTM7CiB9CiAKLWludCBpbGtfd21fbWF4X2xldmVsKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK2ludCBpbGtfd21fbWF4X2xldmVsKGNvbnN0IHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCS8qIGhvdyBtYW55IFdNIGxldmVscyBhcmUgd2UgZXhwZWN0
aW5nICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwlpZiAoSU5URUxfR0VOKGk5
MTUpID49IDkpCiAJCXJldHVybiA3OwotCWVsc2UgaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8
IElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfSEFTV0VMTChpOTE1KSB8fCBJ
U19CUk9BRFdFTEwoaTkxNSkpCiAJCXJldHVybiA0OwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gNikKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikKIAkJcmV0dXJuIDM7
CiAJZWxzZQogCQlyZXR1cm4gMjsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfcHJpbnRfd21fbGF0
ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRl
bF9wcmludF93bV9sYXRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAg
IGNvbnN0IGNoYXIgKm5hbWUsCiAJCQkJICAgY29uc3QgdTE2IHdtWzhdKQogewotCWludCBsZXZl
bCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9sZXZlbChkZXZfcHJpdik7CisJaW50IGxldmVsLCBt
YXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGk5MTUpOwogCiAJZm9yIChsZXZlbCA9IDA7IGxl
dmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwrKykgewogCQl1bnNpZ25lZCBpbnQgbGF0ZW5jeSA9IHdt
W2xldmVsXTsKQEAgLTI5NzMsNyArMjk3Myw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByaW50X3dt
X2xhdGVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkgKiAtIGxhdGVu
Y2llcyBhcmUgaW4gdXMgb24gZ2VuOS4KIAkJICogLSBiZWZvcmUgdGhlbiwgV00xKyBsYXRlbmN5
IHZhbHVlcyBhcmUgaW4gMC41dXMgdW5pdHMKIAkJICovCi0JCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDkpCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKIAkJCWxhdGVuY3kgKj0gMTA7
CiAJCWVsc2UgaWYgKGxldmVsID4gMCkKIAkJCWxhdGVuY3kgKj0gNTsKQEAgLTI5ODQsMTAgKzI5
ODQsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJpbnRfd21fbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0aWMgYm9vbCBpbGtfaW5jcmVhc2Vf
d21fbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9v
bCBpbGtfaW5jcmVhc2Vfd21fbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgICAgdTE2IHdtWzVdLCB1MTYgbWluKQogewotCWludCBsZXZlbCwgbWF4X2xldmVsID0g
aWxrX3dtX21heF9sZXZlbChkZXZfcHJpdik7CisJaW50IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtf
d21fbWF4X2xldmVsKGk5MTUpOwogCiAJaWYgKHdtWzBdID49IG1pbikKIAkJcmV0dXJuIGZhbHNl
OwpAQCAtMjk5OSw3ICsyOTk5LDcgQEAgc3RhdGljIGJvb2wgaWxrX2luY3JlYXNlX3dtX2xhdGVu
Y3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiB0cnVlOwogfQog
Ci1zdGF0aWMgdm9pZCBzbmJfd21fbGF0ZW5jeV9xdWlyayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBzbmJfd21fbGF0ZW5jeV9xdWlyayhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlib29sIGNoYW5nZWQ7CiAKQEAgLTMwMDcsMjAgKzMw
MDcsMjAgQEAgc3RhdGljIHZvaWQgc25iX3dtX2xhdGVuY3lfcXVpcmsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIFRoZSBCSU9TIHByb3ZpZGVkIFdNIG1lbW9yeSBsYXRl
bmN5IHZhbHVlcyBhcmUgb2Z0ZW4KIAkgKiBpbmFkZXF1YXRlIGZvciBoaWdoIHJlc29sdXRpb24g
ZGlzcGxheXMuIEFkanVzdCB0aGVtLgogCSAqLwotCWNoYW5nZWQgPSBpbGtfaW5jcmVhc2Vfd21f
bGF0ZW5jeShkZXZfcHJpdiwgZGV2X3ByaXYtPndtLnByaV9sYXRlbmN5LCAxMikgfAotCQlpbGtf
aW5jcmVhc2Vfd21fbGF0ZW5jeShkZXZfcHJpdiwgZGV2X3ByaXYtPndtLnNwcl9sYXRlbmN5LCAx
MikgfAotCQlpbGtfaW5jcmVhc2Vfd21fbGF0ZW5jeShkZXZfcHJpdiwgZGV2X3ByaXYtPndtLmN1
cl9sYXRlbmN5LCAxMik7CisJY2hhbmdlZCA9IGlsa19pbmNyZWFzZV93bV9sYXRlbmN5KGk5MTUs
IGk5MTUtPndtLnByaV9sYXRlbmN5LCAxMikgfAorCQlpbGtfaW5jcmVhc2Vfd21fbGF0ZW5jeShp
OTE1LCBpOTE1LT53bS5zcHJfbGF0ZW5jeSwgMTIpIHwKKwkJaWxrX2luY3JlYXNlX3dtX2xhdGVu
Y3koaTkxNSwgaTkxNS0+d20uY3VyX2xhdGVuY3ksIDEyKTsKIAogCWlmICghY2hhbmdlZCkKIAkJ
cmV0dXJuOwogCiAJRFJNX0RFQlVHX0tNUygiV00gbGF0ZW5jeSB2YWx1ZXMgaW5jcmVhc2VkIHRv
IGF2b2lkIHBvdGVudGlhbCB1bmRlcnJ1bnNcbiIpOwotCWludGVsX3ByaW50X3dtX2xhdGVuY3ko
ZGV2X3ByaXYsICJQcmltYXJ5IiwgZGV2X3ByaXYtPndtLnByaV9sYXRlbmN5KTsKLQlpbnRlbF9w
cmludF93bV9sYXRlbmN5KGRldl9wcml2LCAiU3ByaXRlIiwgZGV2X3ByaXYtPndtLnNwcl9sYXRl
bmN5KTsKLQlpbnRlbF9wcmludF93bV9sYXRlbmN5KGRldl9wcml2LCAiQ3Vyc29yIiwgZGV2X3By
aXYtPndtLmN1cl9sYXRlbmN5KTsKKwlpbnRlbF9wcmludF93bV9sYXRlbmN5KGk5MTUsICJQcmlt
YXJ5IiwgaTkxNS0+d20ucHJpX2xhdGVuY3kpOworCWludGVsX3ByaW50X3dtX2xhdGVuY3koaTkx
NSwgIlNwcml0ZSIsIGk5MTUtPndtLnNwcl9sYXRlbmN5KTsKKwlpbnRlbF9wcmludF93bV9sYXRl
bmN5KGk5MTUsICJDdXJzb3IiLCBpOTE1LT53bS5jdXJfbGF0ZW5jeSk7CiB9CiAKLXN0YXRpYyB2
b2lkIHNuYl93bV9scDNfaXJxX3F1aXJrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKK3N0YXRpYyB2b2lkIHNuYl93bV9scDNfaXJxX3F1aXJrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCS8qCiAJICogT24gc29tZSBTTkIgbWFjaGluZXMgKFRoaW5rcGFkIFgy
MjAgVGFibGV0IGF0IGxlYXN0KQpAQCAtMzAzMyw1MCArMzAzMyw1MCBAQCBzdGF0aWMgdm9pZCBz
bmJfd21fbHAzX2lycV9xdWlyayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
ICogaW50ZXJydXB0cyBvbmx5LiBUbyBwbGF5IGl0IHNhZmUgd2UgZGlzYWJsZSBMUDMKIAkgKiB3
YXRlcm1hcmtzIGVudGlyZWx5LgogCSAqLwotCWlmIChkZXZfcHJpdi0+d20ucHJpX2xhdGVuY3lb
M10gPT0gMCAmJgotCSAgICBkZXZfcHJpdi0+d20uc3ByX2xhdGVuY3lbM10gPT0gMCAmJgotCSAg
ICBkZXZfcHJpdi0+d20uY3VyX2xhdGVuY3lbM10gPT0gMCkKKwlpZiAoaTkxNS0+d20ucHJpX2xh
dGVuY3lbM10gPT0gMCAmJgorCSAgICBpOTE1LT53bS5zcHJfbGF0ZW5jeVszXSA9PSAwICYmCisJ
ICAgIGk5MTUtPndtLmN1cl9sYXRlbmN5WzNdID09IDApCiAJCXJldHVybjsKIAotCWRldl9wcml2
LT53bS5wcmlfbGF0ZW5jeVszXSA9IDA7Ci0JZGV2X3ByaXYtPndtLnNwcl9sYXRlbmN5WzNdID0g
MDsKLQlkZXZfcHJpdi0+d20uY3VyX2xhdGVuY3lbM10gPSAwOworCWk5MTUtPndtLnByaV9sYXRl
bmN5WzNdID0gMDsKKwlpOTE1LT53bS5zcHJfbGF0ZW5jeVszXSA9IDA7CisJaTkxNS0+d20uY3Vy
X2xhdGVuY3lbM10gPSAwOwogCiAJRFJNX0RFQlVHX0tNUygiTFAzIHdhdGVybWFya3MgZGlzYWJs
ZWQgZHVlIHRvIHBvdGVudGlhbCBmb3IgbG9zdCBpbnRlcnJ1cHRzXG4iKTsKLQlpbnRlbF9wcmlu
dF93bV9sYXRlbmN5KGRldl9wcml2LCAiUHJpbWFyeSIsIGRldl9wcml2LT53bS5wcmlfbGF0ZW5j
eSk7Ci0JaW50ZWxfcHJpbnRfd21fbGF0ZW5jeShkZXZfcHJpdiwgIlNwcml0ZSIsIGRldl9wcml2
LT53bS5zcHJfbGF0ZW5jeSk7Ci0JaW50ZWxfcHJpbnRfd21fbGF0ZW5jeShkZXZfcHJpdiwgIkN1
cnNvciIsIGRldl9wcml2LT53bS5jdXJfbGF0ZW5jeSk7CisJaW50ZWxfcHJpbnRfd21fbGF0ZW5j
eShpOTE1LCAiUHJpbWFyeSIsIGk5MTUtPndtLnByaV9sYXRlbmN5KTsKKwlpbnRlbF9wcmludF93
bV9sYXRlbmN5KGk5MTUsICJTcHJpdGUiLCBpOTE1LT53bS5zcHJfbGF0ZW5jeSk7CisJaW50ZWxf
cHJpbnRfd21fbGF0ZW5jeShpOTE1LCAiQ3Vyc29yIiwgaTkxNS0+d20uY3VyX2xhdGVuY3kpOwog
fQogCi1zdGF0aWMgdm9pZCBpbGtfc2V0dXBfd21fbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbGtfc2V0dXBfd21fbGF0ZW5jeShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnRlbF9yZWFkX3dtX2xhdGVuY3koZGV2X3By
aXYsIGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeSk7CisJaW50ZWxfcmVhZF93bV9sYXRlbmN5KGk5
MTUsIGk5MTUtPndtLnByaV9sYXRlbmN5KTsKIAotCW1lbWNweShkZXZfcHJpdi0+d20uc3ByX2xh
dGVuY3ksIGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeSwKLQkgICAgICAgc2l6ZW9mKGRldl9wcml2
LT53bS5wcmlfbGF0ZW5jeSkpOwotCW1lbWNweShkZXZfcHJpdi0+d20uY3VyX2xhdGVuY3ksIGRl
dl9wcml2LT53bS5wcmlfbGF0ZW5jeSwKLQkgICAgICAgc2l6ZW9mKGRldl9wcml2LT53bS5wcmlf
bGF0ZW5jeSkpOworCW1lbWNweShpOTE1LT53bS5zcHJfbGF0ZW5jeSwgaTkxNS0+d20ucHJpX2xh
dGVuY3ksCisJICAgICAgIHNpemVvZihpOTE1LT53bS5wcmlfbGF0ZW5jeSkpOworCW1lbWNweShp
OTE1LT53bS5jdXJfbGF0ZW5jeSwgaTkxNS0+d20ucHJpX2xhdGVuY3ksCisJICAgICAgIHNpemVv
ZihpOTE1LT53bS5wcmlfbGF0ZW5jeSkpOwogCi0JaW50ZWxfZml4dXBfc3ByX3dtX2xhdGVuY3ko
ZGV2X3ByaXYsIGRldl9wcml2LT53bS5zcHJfbGF0ZW5jeSk7Ci0JaW50ZWxfZml4dXBfY3VyX3dt
X2xhdGVuY3koZGV2X3ByaXYsIGRldl9wcml2LT53bS5jdXJfbGF0ZW5jeSk7CisJaW50ZWxfZml4
dXBfc3ByX3dtX2xhdGVuY3koaTkxNSwgaTkxNS0+d20uc3ByX2xhdGVuY3kpOworCWludGVsX2Zp
eHVwX2N1cl93bV9sYXRlbmN5KGk5MTUsIGk5MTUtPndtLmN1cl9sYXRlbmN5KTsKIAotCWludGVs
X3ByaW50X3dtX2xhdGVuY3koZGV2X3ByaXYsICJQcmltYXJ5IiwgZGV2X3ByaXYtPndtLnByaV9s
YXRlbmN5KTsKLQlpbnRlbF9wcmludF93bV9sYXRlbmN5KGRldl9wcml2LCAiU3ByaXRlIiwgZGV2
X3ByaXYtPndtLnNwcl9sYXRlbmN5KTsKLQlpbnRlbF9wcmludF93bV9sYXRlbmN5KGRldl9wcml2
LCAiQ3Vyc29yIiwgZGV2X3ByaXYtPndtLmN1cl9sYXRlbmN5KTsKKwlpbnRlbF9wcmludF93bV9s
YXRlbmN5KGk5MTUsICJQcmltYXJ5IiwgaTkxNS0+d20ucHJpX2xhdGVuY3kpOworCWludGVsX3By
aW50X3dtX2xhdGVuY3koaTkxNSwgIlNwcml0ZSIsIGk5MTUtPndtLnNwcl9sYXRlbmN5KTsKKwlp
bnRlbF9wcmludF93bV9sYXRlbmN5KGk5MTUsICJDdXJzb3IiLCBpOTE1LT53bS5jdXJfbGF0ZW5j
eSk7CiAKLQlpZiAoSVNfR0VOKGRldl9wcml2LCA2KSkgewotCQlzbmJfd21fbGF0ZW5jeV9xdWly
ayhkZXZfcHJpdik7Ci0JCXNuYl93bV9scDNfaXJxX3F1aXJrKGRldl9wcml2KTsKKwlpZiAoSVNf
R0VOKGk5MTUsIDYpKSB7CisJCXNuYl93bV9sYXRlbmN5X3F1aXJrKGk5MTUpOworCQlzbmJfd21f
bHAzX2lycV9xdWlyayhpOTE1KTsKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIHNrbF9zZXR1cF93bV9s
YXRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHNr
bF9zZXR1cF93bV9sYXRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlu
dGVsX3JlYWRfd21fbGF0ZW5jeShkZXZfcHJpdiwgZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5KTsK
LQlpbnRlbF9wcmludF93bV9sYXRlbmN5KGRldl9wcml2LCAiR2VuOSBQbGFuZSIsIGRldl9wcml2
LT53bS5za2xfbGF0ZW5jeSk7CisJaW50ZWxfcmVhZF93bV9sYXRlbmN5KGk5MTUsIGk5MTUtPndt
LnNrbF9sYXRlbmN5KTsKKwlpbnRlbF9wcmludF93bV9sYXRlbmN5KGk5MTUsICJHZW45IFBsYW5l
IiwgaTkxNS0+d20uc2tsX2xhdGVuY3kpOwogfQogCi1zdGF0aWMgYm9vbCBpbGtfdmFsaWRhdGVf
cGlwZV93bShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMg
Ym9vbCBpbGtfdmFsaWRhdGVfcGlwZV93bShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCQkgc3RydWN0IGludGVsX3BpcGVfd20gKnBpcGVfd20pCiB7CiAJLyogTFAwIHdh
dGVybWFyayBtYXhpbXVtcyBkZXBlbmQgb24gdGhpcyBwaXBlIGFsb25lICovCkBAIC0zMDg4LDcg
KzMwODgsNyBAQCBzdGF0aWMgYm9vbCBpbGtfdmFsaWRhdGVfcGlwZV93bShjb25zdCBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJc3RydWN0IGlsa193bV9tYXhpbXVtcyBtYXg7
CiAKIAkvKiBMUDAgd2F0ZXJtYXJrcyBhbHdheXMgdXNlIDEvMiBEREIgcGFydGl0aW9uaW5nICov
Ci0JaWxrX2NvbXB1dGVfd21fbWF4aW11bXMoZGV2X3ByaXYsIDAsICZjb25maWcsIElOVEVMX0RE
Ql9QQVJUXzFfMiwgJm1heCk7CisJaWxrX2NvbXB1dGVfd21fbWF4aW11bXMoaTkxNSwgMCwgJmNv
bmZpZywgSU5URUxfRERCX1BBUlRfMV8yLCAmbWF4KTsKIAogCS8qIEF0IGxlYXN0IExQMCBtdXN0
IGJlIHZhbGlkICovCiAJaWYgKCFpbGtfdmFsaWRhdGVfd21fbGV2ZWwoMCwgJm1heCwgJnBpcGVf
d20tPndtWzBdKSkgewpAQCAtMzEwNiwxMyArMzEwNiwxMyBAQCBzdGF0aWMgaW50IGlsa19jb21w
dXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3N0YXRlLT5iYXNlLmNydGMpOwog
CXN0cnVjdCBpbnRlbF9waXBlX3dtICpwaXBlX3dtOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBzdGF0ZS0+ZGV2OwotCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZTsKIAljb25zdCBzdHJ1Y3QgZHJt
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnByaXN0YXRlID0gTlVMTDsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnNw
cnN0YXRlID0gTlVMTDsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKmN1cnN0YXRl
ID0gTlVMTDsKLQlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3By
aXYpLCB1c2FibGVfbGV2ZWw7CisJaW50IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xl
dmVsKGk5MTUpLCB1c2FibGVfbGV2ZWw7CiAJc3RydWN0IGlsa193bV9tYXhpbXVtcyBtYXg7CiAK
IAlwaXBlX3dtID0gJmNzdGF0ZS0+d20uaWxrLm9wdGltYWw7CkBAIC0zMTM5LDcgKzMxMzksNyBA
QCBzdGF0aWMgaW50IGlsa19jb21wdXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNzdGF0ZSkKIAl1c2FibGVfbGV2ZWwgPSBtYXhfbGV2ZWw7CiAKIAkvKiBJTEsvU05COiBMUDIr
IHdhdGVybWFya3Mgb25seSB3L28gc3ByaXRlcyAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
IDw9IDYgJiYgcGlwZV93bS0+c3ByaXRlc19lbmFibGVkKQorCWlmIChJTlRFTF9HRU4oaTkxNSkg
PD0gNiAmJiBwaXBlX3dtLT5zcHJpdGVzX2VuYWJsZWQpCiAJCXVzYWJsZV9sZXZlbCA9IDE7CiAK
IAkvKiBJTEsvU05CL0lWQjogTFAxKyB3YXRlcm1hcmtzIG9ubHkgdy9vIHNjYWxpbmcgKi8KQEAg
LTMxNDcsMjEgKzMxNDcsMjEgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9waXBlX3dtKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiAJCXVzYWJsZV9sZXZlbCA9IDA7CiAKIAltZW1z
ZXQoJnBpcGVfd20tPndtLCAwLCBzaXplb2YocGlwZV93bS0+d20pKTsKLQlpbGtfY29tcHV0ZV93
bV9sZXZlbChkZXZfcHJpdiwgaW50ZWxfY3J0YywgMCwgY3N0YXRlLAorCWlsa19jb21wdXRlX3dt
X2xldmVsKGk5MTUsIGludGVsX2NydGMsIDAsIGNzdGF0ZSwKIAkJCSAgICAgcHJpc3RhdGUsIHNw
cnN0YXRlLCBjdXJzdGF0ZSwgJnBpcGVfd20tPndtWzBdKTsKIAotCWlmIChJU19IQVNXRUxMKGRl
dl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCWlmIChJU19IQVNXRUxMKGk5MTUp
IHx8IElTX0JST0FEV0VMTChpOTE1KSkKIAkJcGlwZV93bS0+bGluZXRpbWUgPSBoc3dfY29tcHV0
ZV9saW5ldGltZV93bShjc3RhdGUpOwogCi0JaWYgKCFpbGtfdmFsaWRhdGVfcGlwZV93bShkZXZf
cHJpdiwgcGlwZV93bSkpCisJaWYgKCFpbGtfdmFsaWRhdGVfcGlwZV93bShpOTE1LCBwaXBlX3dt
KSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlpbGtfY29tcHV0ZV93bV9yZWdfbWF4aW11bXMoZGV2
X3ByaXYsIDEsICZtYXgpOworCWlsa19jb21wdXRlX3dtX3JlZ19tYXhpbXVtcyhpOTE1LCAxLCAm
bWF4KTsKIAogCWZvciAobGV2ZWwgPSAxOyBsZXZlbCA8PSB1c2FibGVfbGV2ZWw7IGxldmVsKysp
IHsKIAkJc3RydWN0IGludGVsX3dtX2xldmVsICp3bSA9ICZwaXBlX3dtLT53bVtsZXZlbF07CiAK
LQkJaWxrX2NvbXB1dGVfd21fbGV2ZWwoZGV2X3ByaXYsIGludGVsX2NydGMsIGxldmVsLCBjc3Rh
dGUsCisJCWlsa19jb21wdXRlX3dtX2xldmVsKGk5MTUsIGludGVsX2NydGMsIGxldmVsLCBjc3Rh
dGUsCiAJCQkJICAgICBwcmlzdGF0ZSwgc3Byc3RhdGUsIGN1cnN0YXRlLCB3bSk7CiAKIAkJLyoK
QEAgLTMxODYsMTQgKzMxODYsMTQgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9waXBlX3dtKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiBzdGF0aWMgaW50IGlsa19jb21wdXRlX2lu
dGVybWVkaWF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3c3RhdGUpCiB7CiAJc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKG5ld3N0YXRlLT5iYXNl
LmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50
ZWxfY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BpcGVfd20gKmEgPSAm
bmV3c3RhdGUtPndtLmlsay5pbnRlcm1lZGlhdGU7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqaW50ZWxfc3RhdGUgPQogCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3c3RhdGUtPmJhc2Uu
c3RhdGUpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRzdGF0ZSA9CiAJCWlu
dGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3RhdGUoaW50ZWxfc3RhdGUsIGludGVsX2NydGMpOwog
CWNvbnN0IHN0cnVjdCBpbnRlbF9waXBlX3dtICpiID0gJm9sZHN0YXRlLT53bS5pbGsub3B0aW1h
bDsKLQlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOwor
CWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9sZXZlbChpOTE1KTsKIAogCS8qCiAJ
ICogU3RhcnQgd2l0aCB0aGUgZmluYWwsIHRhcmdldCB3YXRlcm1hcmtzLCB0aGVuIGNvbWJpbmUg
d2l0aCB0aGUKQEAgLTMyMjYsNyArMzIyNiw3IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfaW50
ZXJtZWRpYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdzdGF0ZSkKIAkgKiB0aGVy
ZSdzIG5vIHNhZmUgd2F5IHRvIHRyYW5zaXRpb24gZnJvbSB0aGUgb2xkIHN0YXRlIHRvCiAJICog
dGhlIG5ldyBzdGF0ZSwgc28gd2UgbmVlZCB0byBmYWlsIHRoZSBhdG9taWMgdHJhbnNhY3Rpb24u
CiAJICovCi0JaWYgKCFpbGtfdmFsaWRhdGVfcGlwZV93bShkZXZfcHJpdiwgYSkpCisJaWYgKCFp
bGtfdmFsaWRhdGVfcGlwZV93bShpOTE1LCBhKSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKIAkvKgpA
QCAtMzI0Miw3ICszMjQyLDcgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9pbnRlcm1lZGlhdGVf
d20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld3N0YXRlKQogLyoKICAqIE1lcmdlIHRoZSB3
YXRlcm1hcmtzIGZyb20gYWxsIGFjdGl2ZSBwaXBlcyBmb3IgYSBzcGVjaWZpYyBsZXZlbC4KICAq
Lwotc3RhdGljIHZvaWQgaWxrX21lcmdlX3dtX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGlsa19tZXJnZV93bV9sZXZlbChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgICBpbnQgbGV2ZWwsCiAJCQkgICAgICAgc3RydWN0
IGludGVsX3dtX2xldmVsICpyZXRfd20pCiB7CkBAIC0zMjUwLDcgKzMyNTAsNyBAQCBzdGF0aWMg
dm9pZCBpbGtfbWVyZ2Vfd21fbGV2ZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCiAJcmV0X3dtLT5lbmFibGUgPSB0cnVlOwogCi0JZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2
X3ByaXYtPmRybSwgaW50ZWxfY3J0YykgeworCWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRy
bSwgaW50ZWxfY3J0YykgewogCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGlwZV93bSAqYWN0aXZlID0g
JmludGVsX2NydGMtPndtLmFjdGl2ZS5pbGs7CiAJCWNvbnN0IHN0cnVjdCBpbnRlbF93bV9sZXZl
bCAqd20gPSAmYWN0aXZlLT53bVtsZXZlbF07CiAKQEAgLTMyNzUsMjcgKzMyNzUsMjcgQEAgc3Rh
dGljIHZvaWQgaWxrX21lcmdlX3dtX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIC8qCiAgKiBNZXJnZSBhbGwgbG93IHBvd2VyIHdhdGVybWFya3MgZm9yIGFsbCBhY3Rp
dmUgcGlwZXMuCiAgKi8KLXN0YXRpYyB2b2lkIGlsa193bV9tZXJnZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbGtfd21fbWVyZ2Uoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgY29uc3Qgc3RydWN0IGludGVsX3dtX2NvbmZpZyAqY29u
ZmlnLAogCQkJIGNvbnN0IHN0cnVjdCBpbGtfd21fbWF4aW11bXMgKm1heCwKIAkJCSBzdHJ1Y3Qg
aW50ZWxfcGlwZV93bSAqbWVyZ2VkKQogewotCWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dt
X21heF9sZXZlbChkZXZfcHJpdik7CisJaW50IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4
X2xldmVsKGk5MTUpOwogCWludCBsYXN0X2VuYWJsZWRfbGV2ZWwgPSBtYXhfbGV2ZWw7CiAKIAkv
KiBJTEsvU05CL0lWQjogTFAxKyB3YXRlcm1hcmtzIG9ubHkgdy8gc2luZ2xlIHBpcGUgKi8KLQlp
ZiAoKElOVEVMX0dFTihkZXZfcHJpdikgPD0gNiB8fCBJU19JVllCUklER0UoZGV2X3ByaXYpKSAm
JgorCWlmICgoSU5URUxfR0VOKGk5MTUpIDw9IDYgfHwgSVNfSVZZQlJJREdFKGk5MTUpKSAmJgog
CSAgICBjb25maWctPm51bV9waXBlc19hY3RpdmUgPiAxKQogCQlsYXN0X2VuYWJsZWRfbGV2ZWwg
PSAwOwogCiAJLyogSUxLOiBGQkMgV00gbXVzdCBiZSBkaXNhYmxlZCBhbHdheXMgKi8KLQltZXJn
ZWQtPmZiY193bV9lbmFibGVkID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSA2OworCW1lcmdlZC0+
ZmJjX3dtX2VuYWJsZWQgPSBJTlRFTF9HRU4oaTkxNSkgPj0gNjsKIAogCS8qIG1lcmdlIGVhY2gg
V00xKyBsZXZlbCAqLwogCWZvciAobGV2ZWwgPSAxOyBsZXZlbCA8PSBtYXhfbGV2ZWw7IGxldmVs
KyspIHsKIAkJc3RydWN0IGludGVsX3dtX2xldmVsICp3bSA9ICZtZXJnZWQtPndtW2xldmVsXTsK
IAotCQlpbGtfbWVyZ2Vfd21fbGV2ZWwoZGV2X3ByaXYsIGxldmVsLCB3bSk7CisJCWlsa19tZXJn
ZV93bV9sZXZlbChpOTE1LCBsZXZlbCwgd20pOwogCiAJCWlmIChsZXZlbCA+IGxhc3RfZW5hYmxl
ZF9sZXZlbCkKIAkJCXdtLT5lbmFibGUgPSBmYWxzZTsKQEAgLTMzMjAsOCArMzMyMCw4IEBAIHN0
YXRpYyB2b2lkIGlsa193bV9tZXJnZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJICogV2hhdCB3ZSBzaG91bGQgY2hlY2sgaGVyZSBpcyB3aGV0aGVyIEZCQyBjYW4gYmUKIAkg
KiBlbmFibGVkIHNvbWV0aW1lIGxhdGVyLgogCSAqLwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDUp
ICYmICFtZXJnZWQtPmZiY193bV9lbmFibGVkICYmCi0JICAgIGludGVsX2ZiY19pc19hY3RpdmUo
ZGV2X3ByaXYpKSB7CisJaWYgKElTX0dFTihpOTE1LCA1KSAmJiAhbWVyZ2VkLT5mYmNfd21fZW5h
YmxlZCAmJgorCSAgICBpbnRlbF9mYmNfaXNfYWN0aXZlKGk5MTUpKSB7CiAJCWZvciAobGV2ZWwg
PSAyOyBsZXZlbCA8PSBtYXhfbGV2ZWw7IGxldmVsKyspIHsKIAkJCXN0cnVjdCBpbnRlbF93bV9s
ZXZlbCAqd20gPSAmbWVyZ2VkLT53bVtsZXZlbF07CiAKQEAgLTMzMzcsMTYgKzMzMzcsMTYgQEAg
c3RhdGljIGludCBpbGtfd21fbHBfdG9fbGV2ZWwoaW50IHdtX2xwLCBjb25zdCBzdHJ1Y3QgaW50
ZWxfcGlwZV93bSAqcGlwZV93bSkKIH0KIAogLyogVGhlIHZhbHVlIHdlIG5lZWQgdG8gcHJvZ3Jh
bSBpbnRvIHRoZSBXTV9MUHggbGF0ZW5jeSBmaWVsZCAqLwotc3RhdGljIHVuc2lnbmVkIGludCBp
bGtfd21fbHBfbGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdW5zaWduZWQgaW50IGlsa193bV9scF9sYXRlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCSAgICAgIGludCBsZXZlbCkKIHsKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJp
dikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKKwlpZiAoSVNfSEFTV0VMTChpOTE1KSB8fCBJ
U19CUk9BRFdFTEwoaTkxNSkpCiAJCXJldHVybiAyICogbGV2ZWw7CiAJZWxzZQotCQlyZXR1cm4g
ZGV2X3ByaXYtPndtLnByaV9sYXRlbmN5W2xldmVsXTsKKwkJcmV0dXJuIGk5MTUtPndtLnByaV9s
YXRlbmN5W2xldmVsXTsKIH0KIAotc3RhdGljIHZvaWQgaWxrX2NvbXB1dGVfd21fcmVzdWx0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbGtfY29tcHV0
ZV93bV9yZXN1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9waXBlX3dtICptZXJnZWQsCiAJCQkJICAgZW51bSBpbnRlbF9kZGJfcGFy
dGl0aW9uaW5nIHBhcnRpdGlvbmluZywKIAkJCQkgICBzdHJ1Y3QgaWxrX3dtX3ZhbHVlcyAqcmVz
dWx0cykKQEAgLTMzNzAsMTQgKzMzNzAsMTQgQEAgc3RhdGljIHZvaWQgaWxrX2NvbXB1dGVfd21f
cmVzdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAqIGRpc2FibGVk
LiBEb2luZyBvdGhlcndpc2UgY291bGQgY2F1c2UgdW5kZXJydW5zLgogCQkgKi8KIAkJcmVzdWx0
cy0+d21fbHBbd21fbHAgLSAxXSA9Ci0JCQkoaWxrX3dtX2xwX2xhdGVuY3koZGV2X3ByaXYsIGxl
dmVsKSA8PCBXTTFfTFBfTEFURU5DWV9TSElGVCkgfAorCQkJKGlsa193bV9scF9sYXRlbmN5KGk5
MTUsIGxldmVsKSA8PCBXTTFfTFBfTEFURU5DWV9TSElGVCkgfAogCQkJKHItPnByaV92YWwgPDwg
V00xX0xQX1NSX1NISUZUKSB8CiAJCQlyLT5jdXJfdmFsOwogCiAJCWlmIChyLT5lbmFibGUpCiAJ
CQlyZXN1bHRzLT53bV9scFt3bV9scCAtIDFdIHw9IFdNMV9MUF9TUl9FTjsKIAotCQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA4KQorCQlpZiAoSU5URUxfR0VOKGk5MTUpID49IDgpCiAJCQly
ZXN1bHRzLT53bV9scFt3bV9scCAtIDFdIHw9CiAJCQkJci0+ZmJjX3ZhbCA8PCBXTTFfTFBfRkJD
X1NISUZUX0JEVzsKIAkJZWxzZQpAQCAtMzM4OCw3ICszMzg4LDcgQEAgc3RhdGljIHZvaWQgaWxr
X2NvbXB1dGVfd21fcmVzdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
CSAqIEFsd2F5cyBzZXQgV00xU19MUF9FTiB3aGVuIHNwcl92YWwgIT0gMCwgZXZlbiBpZiB0aGUK
IAkJICogbGV2ZWwgaXMgZGlzYWJsZWQuIERvaW5nIG90aGVyd2lzZSBjb3VsZCBjYXVzZSB1bmRl
cnJ1bnMuCiAJCSAqLwotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8PSA2ICYmIHItPnNwcl92
YWwpIHsKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA8PSA2ICYmIHItPnNwcl92YWwpIHsKIAkJCVdB
Uk5fT04od21fbHAgIT0gMSk7CiAJCQlyZXN1bHRzLT53bV9scF9zcHJbd21fbHAgLSAxXSA9IFdN
MVNfTFBfRU4gfCByLT5zcHJfdmFsOwogCQl9IGVsc2UKQEAgLTMzOTYsNyArMzM5Niw3IEBAIHN0
YXRpYyB2b2lkIGlsa19jb21wdXRlX3dtX3Jlc3VsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCX0KIAogCS8qIExQMCByZWdpc3RlciB2YWx1ZXMgKi8KLQlmb3JfZWFjaF9p
bnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBpbnRlbF9jcnRjKSB7CisJZm9yX2VhY2hfaW50ZWxf
Y3J0YygmaTkxNS0+ZHJtLCBpbnRlbF9jcnRjKSB7CiAJCWVudW0gcGlwZSBwaXBlID0gaW50ZWxf
Y3J0Yy0+cGlwZTsKIAkJY29uc3Qgc3RydWN0IGludGVsX3dtX2xldmVsICpyID0KIAkJCSZpbnRl
bF9jcnRjLT53bS5hY3RpdmUuaWxrLndtWzBdOwpAQCAtMzQxNiwxMSArMzQxNiwxMSBAQCBzdGF0
aWMgdm9pZCBpbGtfY29tcHV0ZV93bV9yZXN1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIC8qIEZpbmQgdGhlIHJlc3VsdCB3aXRoIHRoZSBoaWdoZXN0IGxldmVsIGVuYWJs
ZWQuIENoZWNrIGZvciBlbmFibGVfZmJjX3dtIGluCiAgKiBjYXNlIGJvdGggYXJlIGF0IHRoZSBz
YW1lIGxldmVsLiBQcmVmZXIgcjEgaW4gY2FzZSB0aGV5J3JlIHRoZSBzYW1lLiAqLwogc3RhdGlj
IHN0cnVjdCBpbnRlbF9waXBlX3dtICoKLWlsa19maW5kX2Jlc3RfcmVzdWx0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2lsa19maW5kX2Jlc3RfcmVzdWx0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgIHN0cnVjdCBpbnRlbF9waXBlX3dtICpyMSwKIAkJ
ICAgICBzdHJ1Y3QgaW50ZWxfcGlwZV93bSAqcjIpCiB7Ci0JaW50IGxldmVsLCBtYXhfbGV2ZWwg
PSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsKKwlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGls
a193bV9tYXhfbGV2ZWwoaTkxNSk7CiAJaW50IGxldmVsMSA9IDAsIGxldmVsMiA9IDA7CiAKIAlm
b3IgKGxldmVsID0gMTsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7CkBAIC0zNDUwLDcg
KzM0NTAsNyBAQCBpbGtfZmluZF9iZXN0X3Jlc3VsdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAjZGVmaW5lIFdNX0RJUlRZX0ZCQyAoMSA8PCAyNCkKICNkZWZpbmUgV01fRElS
VFlfRERCICgxIDw8IDI1KQogCi1zdGF0aWMgdW5zaWduZWQgaW50IGlsa19jb21wdXRlX3dtX2Rp
cnR5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB1bnNpZ25lZCBp
bnQgaWxrX2NvbXB1dGVfd21fZGlydHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkJCSBjb25zdCBzdHJ1Y3QgaWxrX3dtX3ZhbHVlcyAqb2xkLAogCQkJCQkgY29uc3Qgc3RydWN0
IGlsa193bV92YWx1ZXMgKm5ldykKIHsKQEAgLTM0NTgsNyArMzQ1OCw3IEBAIHN0YXRpYyB1bnNp
Z25lZCBpbnQgaWxrX2NvbXB1dGVfd21fZGlydHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCWVudW0gcGlwZSBwaXBlOwogCWludCB3bV9scDsKIAotCWZvcl9lYWNoX3BpcGUo
ZGV2X3ByaXYsIHBpcGUpIHsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJaWYgKG9s
ZC0+d21fbGluZXRpbWVbcGlwZV0gIT0gbmV3LT53bV9saW5ldGltZVtwaXBlXSkgewogCQkJZGly
dHkgfD0gV01fRElSVFlfTElORVRJTUUocGlwZSk7CiAJCQkvKiBNdXN0IGRpc2FibGUgTFAxKyB3
YXRlcm1hcmtzIHRvbyAqLwpAQCAtMzUwMiwxMCArMzUwMiwxMCBAQCBzdGF0aWMgdW5zaWduZWQg
aW50IGlsa19jb21wdXRlX3dtX2RpcnR5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAlyZXR1cm4gZGlydHk7CiB9CiAKLXN0YXRpYyBib29sIF9pbGtfZGlzYWJsZV9scF93bShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgYm9vbCBfaWxrX2Rpc2Fi
bGVfbHBfd20oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgdW5zaWdu
ZWQgaW50IGRpcnR5KQogewotCXN0cnVjdCBpbGtfd21fdmFsdWVzICpwcmV2aW91cyA9ICZkZXZf
cHJpdi0+d20uaHc7CisJc3RydWN0IGlsa193bV92YWx1ZXMgKnByZXZpb3VzID0gJmk5MTUtPndt
Lmh3OwogCWJvb2wgY2hhbmdlZCA9IGZhbHNlOwogCiAJaWYgKGRpcnR5ICYgV01fRElSVFlfTFAo
MykgJiYgcHJldmlvdXMtPndtX2xwWzJdICYgV00xX0xQX1NSX0VOKSB7CkBAIC0zNTM2LDE4ICsz
NTM2LDE4IEBAIHN0YXRpYyBib29sIF9pbGtfZGlzYWJsZV9scF93bShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBUaGUgc3BlYyBzYXlzIHdlIHNob3VsZG4ndCB3cml0ZSB3
aGVuIHdlIGRvbid0IG5lZWQsIGJlY2F1c2UgZXZlcnkgd3JpdGUKICAqIGNhdXNlcyBXTXMgdG8g
YmUgcmUtZXZhbHVhdGVkLCBleHBlbmRpbmcgc29tZSBwb3dlci4KICAqLwotc3RhdGljIHZvaWQg
aWxrX3dyaXRlX3dtX3ZhbHVlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdm9pZCBpbGtfd3JpdGVfd21fdmFsdWVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCXN0cnVjdCBpbGtfd21fdmFsdWVzICpyZXN1bHRzKQogewotCXN0cnVjdCBpbGtf
d21fdmFsdWVzICpwcmV2aW91cyA9ICZkZXZfcHJpdi0+d20uaHc7CisJc3RydWN0IGlsa193bV92
YWx1ZXMgKnByZXZpb3VzID0gJmk5MTUtPndtLmh3OwogCXVuc2lnbmVkIGludCBkaXJ0eTsKIAl1
MzIgdmFsOwogCi0JZGlydHkgPSBpbGtfY29tcHV0ZV93bV9kaXJ0eShkZXZfcHJpdiwgcHJldmlv
dXMsIHJlc3VsdHMpOworCWRpcnR5ID0gaWxrX2NvbXB1dGVfd21fZGlydHkoaTkxNSwgcHJldmlv
dXMsIHJlc3VsdHMpOwogCWlmICghZGlydHkpCiAJCXJldHVybjsKIAotCV9pbGtfZGlzYWJsZV9s
cF93bShkZXZfcHJpdiwgZGlydHkpOworCV9pbGtfZGlzYWJsZV9scF93bShpOTE1LCBkaXJ0eSk7
CiAKIAlpZiAoZGlydHkgJiBXTV9ESVJUWV9QSVBFKFBJUEVfQSkpCiAJCUk5MTVfV1JJVEUoV00w
X1BJUEVBX0lMSywgcmVzdWx0cy0+d21fcGlwZVswXSk7CkBAIC0zNTY0LDcgKzM1NjQsNyBAQCBz
dGF0aWMgdm9pZCBpbGtfd3JpdGVfd21fdmFsdWVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJSTkxNV9XUklURShQSVBFX1dNX0xJTkVUSU1FKFBJUEVfQyksIHJlc3VsdHMt
PndtX2xpbmV0aW1lWzJdKTsKIAogCWlmIChkaXJ0eSAmIFdNX0RJUlRZX0REQikgewotCQlpZiAo
SVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkgeworCQlpZiAo
SVNfSEFTV0VMTChpOTE1KSB8fCBJU19CUk9BRFdFTEwoaTkxNSkpIHsKIAkJCXZhbCA9IEk5MTVf
UkVBRChXTV9NSVNDKTsKIAkJCWlmIChyZXN1bHRzLT5wYXJ0aXRpb25pbmcgPT0gSU5URUxfRERC
X1BBUlRfMV8yKQogCQkJCXZhbCAmPSB+V01fTUlTQ19EQVRBX1BBUlRJVElPTl81XzY7CkBAIC0z
NTk0LDcgKzM1OTQsNyBAQCBzdGF0aWMgdm9pZCBpbGtfd3JpdGVfd21fdmFsdWVzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgICAgcHJldmlvdXMtPndtX2xwX3NwclswXSAh
PSByZXN1bHRzLT53bV9scF9zcHJbMF0pCiAJCUk5MTVfV1JJVEUoV00xU19MUF9JTEssIHJlc3Vs
dHMtPndtX2xwX3NwclswXSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA3KSB7CisJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA3KSB7CiAJCWlmIChkaXJ0eSAmIFdNX0RJUlRZX0xQKDIp
ICYmIHByZXZpb3VzLT53bV9scF9zcHJbMV0gIT0gcmVzdWx0cy0+d21fbHBfc3ByWzFdKQogCQkJ
STkxNV9XUklURShXTTJTX0xQX0lWQiwgcmVzdWx0cy0+d21fbHBfc3ByWzFdKTsKIAkJaWYgKGRp
cnR5ICYgV01fRElSVFlfTFAoMykgJiYgcHJldmlvdXMtPndtX2xwX3NwclsyXSAhPSByZXN1bHRz
LT53bV9scF9zcHJbMl0pCkBAIC0zNjA4LDE3ICszNjA4LDE3IEBAIHN0YXRpYyB2b2lkIGlsa193
cml0ZV93bV92YWx1ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlmIChk
aXJ0eSAmIFdNX0RJUlRZX0xQKDMpICYmIHByZXZpb3VzLT53bV9scFsyXSAhPSByZXN1bHRzLT53
bV9scFsyXSkKIAkJSTkxNV9XUklURShXTTNfTFBfSUxLLCByZXN1bHRzLT53bV9scFsyXSk7CiAK
LQlkZXZfcHJpdi0+d20uaHcgPSAqcmVzdWx0czsKKwlpOTE1LT53bS5odyA9ICpyZXN1bHRzOwog
fQogCiBib29sIGlsa19kaXNhYmxlX2xwX3dtKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCi0JcmV0dXJuIF9pbGtf
ZGlzYWJsZV9scF93bShkZXZfcHJpdiwgV01fRElSVFlfTFBfQUxMKTsKKwlyZXR1cm4gX2lsa19k
aXNhYmxlX2xwX3dtKGk5MTUsIFdNX0RJUlRZX0xQX0FMTCk7CiB9CiAKLXN0YXRpYyB1OCBpbnRl
bF9lbmFibGVkX2RidWZfc2xpY2VzX251bShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdTggaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19udW0oc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTggZW5hYmxlZF9zbGljZXM7CiAKQEAgLTM2MjYsNyAr
MzYyNiw3IEBAIHN0YXRpYyB1OCBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJZW5hYmxlZF9zbGljZXMgPSAxOwogCiAJLyog
R2VuIHByaW9yIHRvIEdFTjExIGhhdmUgb25seSBvbmUgREJ1ZiBzbGljZSAqLwotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpIDwgMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDExKQogCQlyZXR1
cm4gZW5hYmxlZF9zbGljZXM7CiAKIAkvKgpAQCAtMzY0NCwxNiArMzY0NCwxNiBAQCBzdGF0aWMg
dTggaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19udW0oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogICogRklYTUU6IFdlIHN0aWxsIGRvbid0IGhhdmUgdGhlIHByb3BlciBjb2Rl
IGRldGVjdCBpZiB3ZSBuZWVkIHRvIGFwcGx5IHRoZSBXQSwKICAqIHNvIGFzc3VtZSB3ZSdsbCBh
bHdheXMgbmVlZCBpdCBpbiBvcmRlciB0byBhdm9pZCB1bmRlcnJ1bnMuCiAgKi8KLXN0YXRpYyBi
b29sIHNrbF9uZWVkc19tZW1vcnlfYndfd2Eoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIGJvb2wgc2tsX25lZWRzX21lbW9yeV9id193YShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1cm4gSVNfR0VOOV9CQyhkZXZfcHJpdikgfHwgSVNfQlJP
WFRPTihkZXZfcHJpdik7CisJcmV0dXJuIElTX0dFTjlfQkMoaTkxNSkgfHwgSVNfQlJPWFRPTihp
OTE1KTsKIH0KIAogc3RhdGljIGJvb2wKLWludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK2ludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCXJldHVybiAoSVNfR0VOOV9CQyhkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMCkgJiYKLQkJZGV2X3ByaXYtPnNhZ3Zfc3RhdHVzICE9IEk5MTVfU0FHVl9O
T1RfQ09OVFJPTExFRDsKKwlyZXR1cm4gKElTX0dFTjlfQkMoaTkxNSkgfHwgSU5URUxfR0VOKGk5
MTUpID49IDEwKSAmJgorCQlpOTE1LT5zYWd2X3N0YXR1cyAhPSBJOTE1X1NBR1ZfTk9UX0NPTlRS
T0xMRUQ7CiB9CiAKIC8qCkBAIC0zNjY4LDE4ICszNjY4LDE4IEBAIGludGVsX2hhc19zYWd2KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKICAqICAtIFdlJ3JlIG5vdCB1c2luZyBh
biBpbnRlcmxhY2VkIGRpc3BsYXkgY29uZmlndXJhdGlvbgogICovCiBpbnQKLWludGVsX2VuYWJs
ZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludGVsX2VuYWJsZV9z
YWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWludCByZXQ7CiAKLQlpZiAo
IWludGVsX2hhc19zYWd2KGRldl9wcml2KSkKKwlpZiAoIWludGVsX2hhc19zYWd2KGk5MTUpKQog
CQlyZXR1cm4gMDsKIAotCWlmIChkZXZfcHJpdi0+c2Fndl9zdGF0dXMgPT0gSTkxNV9TQUdWX0VO
QUJMRUQpCisJaWYgKGk5MTUtPnNhZ3Zfc3RhdHVzID09IEk5MTVfU0FHVl9FTkFCTEVEKQogCQly
ZXR1cm4gMDsKIAogCURSTV9ERUJVR19LTVMoIkVuYWJsaW5nIFNBR1ZcbiIpOwotCXJldCA9IHNh
bmR5YnJpZGdlX3Bjb2RlX3dyaXRlKGRldl9wcml2LCBHRU45X1BDT0RFX1NBR1ZfQ09OVFJPTCwK
KwlyZXQgPSBzYW5keWJyaWRnZV9wY29kZV93cml0ZShpOTE1LCBHRU45X1BDT0RFX1NBR1ZfQ09O
VFJPTCwKIAkJCQkgICAgICBHRU45X1NBR1ZfRU5BQkxFKTsKIAogCS8qIFdlIGRvbid0IG5lZWQg
dG8gd2FpdCBmb3IgU0FHViB3aGVuIGVuYWJsaW5nICovCkBAIC0zNjg4LDMzICszNjg4LDMzIEBA
IGludGVsX2VuYWJsZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkg
KiBTb21lIHNrbCBzeXN0ZW1zLCBwcmUtcmVsZWFzZSBtYWNoaW5lcyBpbiBwYXJ0aWN1bGFyLAog
CSAqIGRvbid0IGFjdHVhbGx5IGhhdmUgU0FHVi4KIAkgKi8KLQlpZiAoSVNfU0tZTEFLRShkZXZf
cHJpdikgJiYgcmV0ID09IC1FTlhJTykgeworCWlmIChJU19TS1lMQUtFKGk5MTUpICYmIHJldCA9
PSAtRU5YSU8pIHsKIAkJRFJNX0RFQlVHX0RSSVZFUigiTm8gU0FHViBmb3VuZCBvbiBzeXN0ZW0s
IGlnbm9yaW5nXG4iKTsKLQkJZGV2X3ByaXYtPnNhZ3Zfc3RhdHVzID0gSTkxNV9TQUdWX05PVF9D
T05UUk9MTEVEOworCQlpOTE1LT5zYWd2X3N0YXR1cyA9IEk5MTVfU0FHVl9OT1RfQ09OVFJPTExF
RDsKIAkJcmV0dXJuIDA7CiAJfSBlbHNlIGlmIChyZXQgPCAwKSB7CiAJCURSTV9FUlJPUigiRmFp
bGVkIHRvIGVuYWJsZSBTQUdWXG4iKTsKIAkJcmV0dXJuIHJldDsKIAl9CiAKLQlkZXZfcHJpdi0+
c2Fndl9zdGF0dXMgPSBJOTE1X1NBR1ZfRU5BQkxFRDsKKwlpOTE1LT5zYWd2X3N0YXR1cyA9IEk5
MTVfU0FHVl9FTkFCTEVEOwogCXJldHVybiAwOwogfQogCiBpbnQKLWludGVsX2Rpc2FibGVfc2Fn
dihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnRlbF9kaXNhYmxlX3NhZ3Yo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IHJldDsKIAotCWlmICghaW50
ZWxfaGFzX3NhZ3YoZGV2X3ByaXYpKQorCWlmICghaW50ZWxfaGFzX3NhZ3YoaTkxNSkpCiAJCXJl
dHVybiAwOwogCi0JaWYgKGRldl9wcml2LT5zYWd2X3N0YXR1cyA9PSBJOTE1X1NBR1ZfRElTQUJM
RUQpCisJaWYgKGk5MTUtPnNhZ3Zfc3RhdHVzID09IEk5MTVfU0FHVl9ESVNBQkxFRCkKIAkJcmV0
dXJuIDA7CiAKIAlEUk1fREVCVUdfS01TKCJEaXNhYmxpbmcgU0FHVlxuIik7CiAJLyogYnNwZWMg
c2F5cyB0byBrZWVwIHJldHJ5aW5nIGZvciBhdCBsZWFzdCAxIG1zICovCi0JcmV0ID0gc2tsX3Bj
b2RlX3JlcXVlc3QoZGV2X3ByaXYsIEdFTjlfUENPREVfU0FHVl9DT05UUk9MLAorCXJldCA9IHNr
bF9wY29kZV9yZXF1ZXN0KGk5MTUsIEdFTjlfUENPREVfU0FHVl9DT05UUk9MLAogCQkJCUdFTjlf
U0FHVl9ESVNBQkxFLAogCQkJCUdFTjlfU0FHVl9JU19ESVNBQkxFRCwgR0VOOV9TQUdWX0lTX0RJ
U0FCTEVELAogCQkJCTEpOwpAQCAtMzcyMiwyMyArMzcyMiwyMyBAQCBpbnRlbF9kaXNhYmxlX3Nh
Z3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIFNvbWUgc2tsIHN5c3Rl
bXMsIHByZS1yZWxlYXNlIG1hY2hpbmVzIGluIHBhcnRpY3VsYXIsCiAJICogZG9uJ3QgYWN0dWFs
bHkgaGF2ZSBTQUdWLgogCSAqLwotCWlmIChJU19TS1lMQUtFKGRldl9wcml2KSAmJiByZXQgPT0g
LUVOWElPKSB7CisJaWYgKElTX1NLWUxBS0UoaTkxNSkgJiYgcmV0ID09IC1FTlhJTykgewogCQlE
Uk1fREVCVUdfRFJJVkVSKCJObyBTQUdWIGZvdW5kIG9uIHN5c3RlbSwgaWdub3JpbmdcbiIpOwot
CQlkZXZfcHJpdi0+c2Fndl9zdGF0dXMgPSBJOTE1X1NBR1ZfTk9UX0NPTlRST0xMRUQ7CisJCWk5
MTUtPnNhZ3Zfc3RhdHVzID0gSTkxNV9TQUdWX05PVF9DT05UUk9MTEVEOwogCQlyZXR1cm4gMDsK
IAl9IGVsc2UgaWYgKHJldCA8IDApIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gZGlzYWJsZSBT
QUdWICglZClcbiIsIHJldCk7CiAJCXJldHVybiByZXQ7CiAJfQogCi0JZGV2X3ByaXYtPnNhZ3Zf
c3RhdHVzID0gSTkxNV9TQUdWX0RJU0FCTEVEOworCWk5MTUtPnNhZ3Zfc3RhdHVzID0gSTkxNV9T
QUdWX0RJU0FCTEVEOwogCXJldHVybiAwOwogfQogCiBib29sIGludGVsX2Nhbl9lbmFibGVfc2Fn
dihzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IHN0YXRlLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShk
ZXYpOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0gdG9faW50ZWxf
YXRvbWljX3N0YXRlKHN0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lOwpAQCAtMzc0NywxMiArMzc0NywxMiBAQCBib29sIGludGVsX2Nh
bl9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaW50IGxldmVs
LCBsYXRlbmN5OwogCWludCBzYWd2X2Jsb2NrX3RpbWVfdXM7CiAKLQlpZiAoIWludGVsX2hhc19z
YWd2KGRldl9wcml2KSkKKwlpZiAoIWludGVsX2hhc19zYWd2KGk5MTUpKQogCQlyZXR1cm4gZmFs
c2U7CiAKLQlpZiAoSVNfR0VOKGRldl9wcml2LCA5KSkKKwlpZiAoSVNfR0VOKGk5MTUsIDkpKQog
CQlzYWd2X2Jsb2NrX3RpbWVfdXMgPSAzMDsKLQllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDEw
KSkKKwllbHNlIGlmIChJU19HRU4oaTkxNSwgMTApKQogCQlzYWd2X2Jsb2NrX3RpbWVfdXMgPSAy
MDsKIAllbHNlCiAJCXNhZ3ZfYmxvY2tfdGltZV91cyA9IDEwOwpAQCAtMzc3Miw3ICszNzcyLDcg
QEAgYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCiAJLyogU2luY2Ugd2UncmUgbm93IGd1YXJhbnRlZWQgdG8gb25seSBoYXZlIG9uZSBh
Y3RpdmUgQ1JUQy4uLiAqLwogCXBpcGUgPSBmZnMoaW50ZWxfc3RhdGUtPmFjdGl2ZV9jcnRjcykg
LSAxOwotCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJ
Y3J0YyA9IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGk5MTUsIHBpcGUpOwogCWNzdGF0ZSA9IHRv
X2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAKIAlpZiAoY3J0Yy0+YmFzZS5z
dGF0ZS0+YWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQpAQCAt
Mzc4NywxMyArMzc4NywxMyBAQCBib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgZHJt
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQljb250aW51ZTsKIAogCQkvKiBGaW5kIHRoZSBoaWdo
ZXN0IGVuYWJsZWQgd20gbGV2ZWwgZm9yIHRoaXMgcGxhbmUgKi8KLQkJZm9yIChsZXZlbCA9IGls
a193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOworCQlmb3IgKGxldmVsID0gaWxrX3dtX21heF9sZXZl
bChpOTE1KTsKIAkJICAgICAhd20tPndtW2xldmVsXS5wbGFuZV9lbjsgLS1sZXZlbCkKIAkJICAg
ICB7IH0KIAotCQlsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5W2xldmVsXTsKKwkJ
bGF0ZW5jeSA9IGk5MTUtPndtLnNrbF9sYXRlbmN5W2xldmVsXTsKIAotCQlpZiAoc2tsX25lZWRz
X21lbW9yeV9id193YShkZXZfcHJpdikgJiYKKwkJaWYgKHNrbF9uZWVkc19tZW1vcnlfYndfd2Eo
aTkxNSkgJiYKIAkJICAgIHBsYW5lLT5iYXNlLnN0YXRlLT5mYi0+bW9kaWZpZXIgPT0KIAkJICAg
IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEKQogCQkJbGF0ZW5jeSArPSAxNTsKQEAgLTM4MTAsNyAr
MzgxMCw3IEBAIGJvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBkcm1fYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRi
X3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHUxNiBpbnRl
bF9nZXRfZGRiX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogCQkJICAgICAgY29uc3QgdTY0
IHRvdGFsX2RhdGFfcmF0ZSwKIAkJCSAgICAgIGNvbnN0IGludCBudW1fYWN0aXZlLApAQCAtMzgx
OCwxMSArMzgxOCwxMSBAQCBzdGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGU7CiAJdTY0IHRvdGFsX2RhdGFfYnc7Ci0JdTE2IGRkYl9zaXplID0g
SU5URUxfSU5GTyhkZXZfcHJpdiktPmRkYl9zaXplOworCXUxNiBkZGJfc2l6ZSA9IElOVEVMX0lO
Rk8oaTkxNSktPmRkYl9zaXplOwogCiAJV0FSTl9PTihkZGJfc2l6ZSA9PSAwKTsKIAotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDExKQogCQly
ZXR1cm4gZGRiX3NpemUgLSA0OyAvKiA0IGJsb2NrcyBmb3IgYnlwYXNzIHBhdGggYWxsb2NhdGlv
biAqLwogCiAJYWRqdXN0ZWRfbW9kZSA9ICZjc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKQEAg
LTM4NDcsNyArMzg0Nyw3IEBAIHN0YXRpYyB1MTYgaW50ZWxfZ2V0X2RkYl9zaXplKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogc3RhdGljIHZvaWQKLXNrbF9kZGJfZ2V0
X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRl
LAogCQkJCSAgIGNvbnN0IHU2NCB0b3RhbF9kYXRhX3JhdGUsCiAJCQkJICAgc3RydWN0IHNrbF9k
ZGJfYWxsb2NhdGlvbiAqZGRiLApAQCAtMzg2NywxNiArMzg2NywxNiBAQCBza2xfZGRiX2dldF9w
aXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAlpZiAoV0FSTl9PTighc3RhdGUpIHx8ICFjc3RhdGUtPmJhc2UuYWN0aXZlKSB7CiAJCWFsbG9j
LT5zdGFydCA9IDA7CiAJCWFsbG9jLT5lbmQgPSAwOwotCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQz
MihkZXZfcHJpdi0+YWN0aXZlX2NydGNzKTsKKwkJKm51bV9hY3RpdmUgPSBod2VpZ2h0MzIoaTkx
NS0+YWN0aXZlX2NydGNzKTsKIAkJcmV0dXJuOwogCX0KIAogCWlmIChpbnRlbF9zdGF0ZS0+YWN0
aXZlX3BpcGVfY2hhbmdlcykKIAkJKm51bV9hY3RpdmUgPSBod2VpZ2h0MzIoaW50ZWxfc3RhdGUt
PmFjdGl2ZV9jcnRjcyk7CiAJZWxzZQotCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQzMihkZXZfcHJp
di0+YWN0aXZlX2NydGNzKTsKKwkJKm51bV9hY3RpdmUgPSBod2VpZ2h0MzIoaTkxNS0+YWN0aXZl
X2NydGNzKTsKIAotCWRkYl9zaXplID0gaW50ZWxfZ2V0X2RkYl9zaXplKGRldl9wcml2LCBjc3Rh
dGUsIHRvdGFsX2RhdGFfcmF0ZSwKKwlkZGJfc2l6ZSA9IGludGVsX2dldF9kZGJfc2l6ZShpOTE1
LCBjc3RhdGUsIHRvdGFsX2RhdGFfcmF0ZSwKIAkJCQkgICAgICAqbnVtX2FjdGl2ZSwgZGRiKTsK
IAogCS8qCkBAIC0zOTM5LDggKzM5MzksOCBAQCBzdGF0aWMgdW5zaWduZWQgaW50CiBza2xfY3Vy
c29yX2FsbG9jYXRpb24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCSAgICAgIGludCBudW1fYWN0aXZlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwotCWludCBsZXZl
bCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9sZXZlbChkZXZfcHJpdik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsK
KwlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoaTkxNSk7CiAJc3RydWN0
IHNrbF93bV9sZXZlbCB3bSA9IHt9OwogCWludCByZXQsIG1pbl9kZGJfYWxsb2MgPSAwOwogCXN0
cnVjdCBza2xfd21fcGFyYW1zIHdwOwpAQCAtMzk2Myw3ICszOTYzLDcgQEAgc2tsX2N1cnNvcl9h
bGxvY2F0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXJl
dHVybiBtYXgobnVtX2FjdGl2ZSA9PSAxID8gMzIgOiA4LCBtaW5fZGRiX2FsbG9jKTsKIH0KIAot
c3RhdGljIHZvaWQgc2tsX2RkYl9lbnRyeV9pbml0X2Zyb21faHcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgc2tsX2RkYl9lbnRyeV9pbml0X2Zyb21faHco
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgIHN0cnVjdCBza2xfZGRi
X2VudHJ5ICplbnRyeSwgdTMyIHJlZykKIHsKIApAQCAtMzk3NSw3ICszOTc1LDcgQEAgc3RhdGlj
IHZvaWQgc2tsX2RkYl9lbnRyeV9pbml0X2Zyb21faHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogfQogCiBzdGF0aWMgdm9pZAotc2tsX2RkYl9nZXRfaHdfcGxhbmVfc3RhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc2tsX2RkYl9nZXRfaHdfcGxhbmVf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBjb25zdCBlbnVtIHBp
cGUgcGlwZSwKIAkJCSAgIGNvbnN0IGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsCiAJCQkgICBzdHJ1
Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiX3ksCkBAIC0zOTg3LDcgKzM5ODcsNyBAQCBza2xfZGRiX2dl
dF9od19wbGFuZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJLyog
Q3Vyc29yIGRvZXNuJ3Qgc3VwcG9ydCBOVjEyL3BsYW5hciwgc28gbm8gZXh0cmEgY2FsY3VsYXRp
b24gbmVlZGVkICovCiAJaWYgKHBsYW5lX2lkID09IFBMQU5FX0NVUlNPUikgewogCQl2YWwgPSBJ
OTE1X1JFQUQoQ1VSX0JVRl9DRkcocGlwZSkpOwotCQlza2xfZGRiX2VudHJ5X2luaXRfZnJvbV9o
dyhkZXZfcHJpdiwgZGRiX3ksIHZhbCk7CisJCXNrbF9kZGJfZW50cnlfaW5pdF9mcm9tX2h3KGk5
MTUsIGRkYl95LCB2YWwpOwogCQlyZXR1cm47CiAJfQogCkBAIC0zOTk5LDkgKzM5OTksOSBAQCBz
a2xfZGRiX2dldF9od19wbGFuZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJCQkJCSAgICAgIHZhbCAmIFBMQU5FX0NUTF9PUkRFUl9SR0JYLAogCQkJCQkgICAgICB2
YWwgJiBQTEFORV9DVExfQUxQSEFfTUFTSyk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHsKIAkJdmFsID0gSTkxNV9SRUFE
KFBMQU5FX0JVRl9DRkcocGlwZSwgcGxhbmVfaWQpKTsKLQkJc2tsX2RkYl9lbnRyeV9pbml0X2Zy
b21faHcoZGV2X3ByaXYsIGRkYl95LCB2YWwpOworCQlza2xfZGRiX2VudHJ5X2luaXRfZnJvbV9o
dyhpOTE1LCBkZGJfeSwgdmFsKTsKIAl9IGVsc2UgewogCQl2YWwgPSBJOTE1X1JFQUQoUExBTkVf
QlVGX0NGRyhwaXBlLCBwbGFuZV9pZCkpOwogCQl2YWwyID0gSTkxNV9SRUFEKFBMQU5FX05WMTJf
QlVGX0NGRyhwaXBlLCBwbGFuZV9pZCkpOwpAQCAtNDAwOSw4ICs0MDA5LDggQEAgc2tsX2RkYl9n
ZXRfaHdfcGxhbmVfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlp
ZiAoaXNfcGxhbmFyX3l1dl9mb3JtYXQoZm91cmNjKSkKIAkJCXN3YXAodmFsLCB2YWwyKTsKIAot
CQlza2xfZGRiX2VudHJ5X2luaXRfZnJvbV9odyhkZXZfcHJpdiwgZGRiX3ksIHZhbCk7Ci0JCXNr
bF9kZGJfZW50cnlfaW5pdF9mcm9tX2h3KGRldl9wcml2LCBkZGJfdXYsIHZhbDIpOworCQlza2xf
ZGRiX2VudHJ5X2luaXRfZnJvbV9odyhpOTE1LCBkZGJfeSwgdmFsKTsKKwkJc2tsX2RkYl9lbnRy
eV9pbml0X2Zyb21faHcoaTkxNSwgZGRiX3V2LCB2YWwyKTsKIAl9CiB9CiAKQEAgLTQwMTgsMzAg
KzQwMTgsMzAgQEAgdm9pZCBza2xfcGlwZV9kZGJfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkJICAgICAgIHN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfeSwKIAkJCSAg
ICAgICBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiX3V2KQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CiAJZW51bSBwaXBlIHBpcGUgPSBj
cnRjLT5waXBlOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWVudW0gcGxhbmVfaWQgcGxh
bmVfaWQ7CiAKIAlwb3dlcl9kb21haW4gPSBQT1dFUl9ET01BSU5fUElQRShwaXBlKTsKLQl3YWtl
cmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZfcHJpdiwgcG93ZXJf
ZG9tYWluKTsKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChp
OTE1LCBwb3dlcl9kb21haW4pOwogCWlmICghd2FrZXJlZikKIAkJcmV0dXJuOwogCiAJZm9yX2Vh
Y2hfcGxhbmVfaWRfb25fY3J0YyhjcnRjLCBwbGFuZV9pZCkKLQkJc2tsX2RkYl9nZXRfaHdfcGxh
bmVfc3RhdGUoZGV2X3ByaXYsIHBpcGUsCisJCXNrbF9kZGJfZ2V0X2h3X3BsYW5lX3N0YXRlKGk5
MTUsIHBpcGUsCiAJCQkJCSAgIHBsYW5lX2lkLAogCQkJCQkgICAmZGRiX3lbcGxhbmVfaWRdLAog
CQkJCQkgICAmZGRiX3V2W3BsYW5lX2lkXSk7CiAKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChk
ZXZfcHJpdiwgcG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1
dChpOTE1LCBwb3dlcl9kb21haW4sIHdha2VyZWYpOwogfQogCi12b2lkIHNrbF9kZGJfZ2V0X2h3
X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgc2tsX2RkYl9n
ZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHN0cnVjdCBz
a2xfZGRiX2FsbG9jYXRpb24gKmRkYiAvKiBvdXQgKi8pCiB7Ci0JZGRiLT5lbmFibGVkX3NsaWNl
cyA9IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKGRldl9wcml2KTsKKwlkZGItPmVuYWJs
ZWRfc2xpY2VzID0gaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19udW0oaTkxNSk7CiB9CiAKIC8q
CkBAIC00MTM4LDcgKzQxMzgsNyBAQCBza2xfcGlwZV9kb3duc2NhbGVfYW1vdW50KGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogaW50IHNrbF9jaGVja19waXBlX21h
eF9waXhlbF9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkJCSAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2NydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoaW50ZWxfY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVj
dCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9ICZjc3RhdGUtPmJhc2U7CiAJc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3J0Y19zdGF0ZS0+c3RhdGU7CiAJc3RydWN0IGRybV9w
bGFuZSAqcGxhbmU7CkBAIC00MTgxLDcgKzQxODEsNyBAQCBpbnQgc2tsX2NoZWNrX3BpcGVfbWF4
X3BpeGVsX3JhdGUoc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJY3J0Y19jbG9jayA9
IGNydGNfc3RhdGUtPmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKIAlkb3RjbGsgPSB0b19pbnRl
bF9hdG9taWNfc3RhdGUoc3RhdGUpLT5jZGNsay5sb2dpY2FsLmNkY2xrOwogCi0JaWYgKElTX0dF
TUlOSUxBS0UoZGV2X3ByaXYpIHx8IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJaWYgKElT
X0dFTUlOSUxBS0UoaTkxNSkgfHwgSU5URUxfR0VOKGk5MTUpID49IDEwKQogCQlkb3RjbGsgKj0g
MjsKIAogCXBpcGVfbWF4X3BpeGVsX3JhdGUgPSBkaXZfcm91bmRfdXBfdTMyX2ZpeGVkMTYoZG90
Y2xrLCBwaXBlX2Rvd25zY2FsZSk7CkBAIC00MzQxLDcgKzQzNDEsNyBAQCBza2xfYWxsb2NhdGVf
cGlwZV9kZGIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSwKIHsKIAlzdHJ1Y3QgZHJt
X2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjc3RhdGUtPmJhc2Uuc3RhdGU7CiAJc3RydWN0IGRybV9j
cnRjICpjcnRjID0gY3N0YXRlLT5iYXNlLmNydGM7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShjcnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKIAlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqYWxsb2Mg
PSAmY3N0YXRlLT53bS5za2wuZGRiOwogCXUxNiBhbGxvY19zaXplLCBzdGFydCA9IDA7CkBAIC00
MzY3LDcgKzQzNjcsNyBAQCBza2xfYWxsb2NhdGVfcGlwZV9kZGIoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNzdGF0ZSwKIAkJcmV0dXJuIDA7CiAJfQogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJdG90YWxfZGF0YV9yYXRl
ID0KIAkJCWljbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKGNzdGF0ZSwKIAkJCQkJCQkg
cGxhbmVfZGF0YV9yYXRlKTsKQEAgLTQzNzgsNyArNDM3OCw3IEBAIHNrbF9hbGxvY2F0ZV9waXBl
X2RkYihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogCQkJCQkJCSB1dl9wbGFuZV9k
YXRhX3JhdGUpOwogCiAKLQlza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKGRldl9w
cml2LCBjc3RhdGUsIHRvdGFsX2RhdGFfcmF0ZSwKKwlza2xfZGRiX2dldF9waXBlX2FsbG9jYXRp
b25fbGltaXRzKGk5MTUsIGNzdGF0ZSwgdG90YWxfZGF0YV9yYXRlLAogCQkJCQkgICBkZGIsIGFs
bG9jLCAmbnVtX2FjdGl2ZSk7CiAJYWxsb2Nfc2l6ZSA9IHNrbF9kZGJfZW50cnlfc2l6ZShhbGxv
Yyk7CiAJaWYgKGFsbG9jX3NpemUgPT0gMCkKQEAgLTQzOTgsNyArNDM5OCw3IEBAIHNrbF9hbGxv
Y2F0ZV9waXBlX2RkYihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogCSAqIEZpbmQg
dGhlIGhpZ2hlc3Qgd2F0ZXJtYXJrIGxldmVsIGZvciB3aGljaCB3ZSBjYW4gc2F0aXNmeSB0aGUg
YmxvY2sKIAkgKiByZXF1aXJlbWVudCBvZiBhY3RpdmUgcGxhbmVzLgogCSAqLwotCWZvciAobGV2
ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsgbGV2ZWwgPj0gMDsgbGV2ZWwtLSkgewor
CWZvciAobGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGk5MTUpOyBsZXZlbCA+PSAwOyBsZXZlbC0t
KSB7CiAJCWJsb2NrcyA9IDA7CiAJCWZvcl9lYWNoX3BsYW5lX2lkX29uX2NydGMoaW50ZWxfY3J0
YywgcGxhbmVfaWQpIHsKIAkJCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKndtID0KQEAgLTQ0
ODQsNyArNDQ4NCw3IEBAIHNrbF9hbGxvY2F0ZV9waXBlX2RkYihzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3N0YXRlLAogCQkJY29udGludWU7CiAKIAkJLyogR2VuMTErIHVzZXMgYSBzZXBhcmF0
ZSBwbGFuZSBmb3IgVVYgd2F0ZXJtYXJrcyAqLwotCQlXQVJOX09OKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTEgJiYgdXZfdG90YWxbcGxhbmVfaWRdKTsKKwkJV0FSTl9PTihJTlRFTF9HRU4oaTkx
NSkgPj0gMTEgJiYgdXZfdG90YWxbcGxhbmVfaWRdKTsKIAogCQkvKiBMZWF2ZSBkaXNhYmxlZCBw
bGFuZXMgYXQgKDAsMCkgKi8KIAkJaWYgKHRvdGFsW3BsYW5lX2lkXSkgewpAQCAtNDUwNiw3ICs0
NTA2LDcgQEAgc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
c3RhdGUsCiAJICogYWxsIGxldmVscyBhcyAiZW5hYmxlZC4iICBHbyBiYWNrIG5vdyBhbmQgZGlz
YWJsZSB0aGUgb25lcwogCSAqIHRoYXQgYXJlbid0IGFjdHVhbGx5IHBvc3NpYmxlLgogCSAqLwot
CWZvciAobGV2ZWwrKzsgbGV2ZWwgPD0gaWxrX3dtX21heF9sZXZlbChkZXZfcHJpdik7IGxldmVs
KyspIHsKKwlmb3IgKGxldmVsKys7IGxldmVsIDw9IGlsa193bV9tYXhfbGV2ZWwoaTkxNSk7IGxl
dmVsKyspIHsKIAkJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhpbnRlbF9jcnRjLCBwbGFuZV9p
ZCkgewogCQkJc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQogCQkJCSZjc3RhdGUtPndtLnNrbC5v
cHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CkBAIC00NTMxLDcgKzQ1MzEsNyBAQCBza2xfYWxsb2Nh
dGVfcGlwZV9kZGIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSwKIAkJCSAqIFdhXzE0
MDg5NjEwMDg6aWNsLCBlaGwKIAkJCSAqIFVuZGVycnVucyB3aXRoIFdNMSsgZGlzYWJsZWQKIAkJ
CSAqLwotCQkJaWYgKElTX0dFTihkZXZfcHJpdiwgMTEpICYmCisJCQlpZiAoSVNfR0VOKGk5MTUs
IDExKSAmJgogCQkJICAgIGxldmVsID09IDEgJiYgd20tPndtWzBdLnBsYW5lX2VuKSB7CiAJCQkJ
d20tPndtW2xldmVsXS5wbGFuZV9yZXNfYiA9IHdtLT53bVswXS5wbGFuZV9yZXNfYjsKIAkJCQl3
bS0+d21bbGV2ZWxdLnBsYW5lX3Jlc19sID0gd20tPndtWzBdLnBsYW5lX3Jlc19sOwpAQCAtNDU2
Miw3ICs0NTYyLDcgQEAgc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjc3RhdGUsCiAgKiAyeGNkY2xrIGlzIDEzNTAgTUh6IGFuZCB0aGUgcGl4ZWwgcmF0ZSBz
aG91bGQgbmV2ZXIgZXhjZWVkIHRoYXQuCiAqLwogc3RhdGljIHVpbnRfZml4ZWRfMTZfMTZfdAot
c2tsX3dtX21ldGhvZDEoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1
MzIgcGl4ZWxfcmF0ZSwKK3NrbF93bV9tZXRob2QxKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCB1MzIgcGl4ZWxfcmF0ZSwKIAkgICAgICAgdTggY3BwLCB1MzIgbGF0ZW5jeSwg
dTMyIGRidWZfYmxvY2tfc2l6ZSkKIHsKIAl1MzIgd21faW50ZXJtZWRpYXRlX3ZhbDsKQEAgLTQ1
NzQsNyArNDU3NCw3IEBAIHNrbF93bV9tZXRob2QxKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgdTMyIHBpeGVsX3JhdGUsCiAJd21faW50ZXJtZWRpYXRlX3ZhbCA9IGxh
dGVuY3kgKiBwaXhlbF9yYXRlICogY3BwOwogCXJldCA9IGRpdl9maXhlZDE2KHdtX2ludGVybWVk
aWF0ZV92YWwsIDEwMDAgKiBkYnVmX2Jsb2NrX3NpemUpOwogCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTApCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMCkKIAkJcmV0ID0gYWRkX2Zp
eGVkMTZfdTMyKHJldCwgMSk7CiAKIAlyZXR1cm4gcmV0OwpAQCAtNDY0OCw3ICs0NjQ4LDcgQEAg
c2tsX2NvbXB1dGVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCQkgICAgICBpbnQgY29sb3JfcGxhbmUpCiB7CiAJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1
MzIgaW50ZXJtX3BicGw7CiAKIAkvKiBvbmx5IHBsYW5hciBmb3JtYXQgaGFzIHR3byBwbGFuZXMg
Ki8KQEAgLTQ2NzMsNyArNDY3Myw3IEBAIHNrbF9jb21wdXRlX3dtX3BhcmFtcyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAl3cC0+Y3BwID0gZm9ybWF0LT5jcHBb
Y29sb3JfcGxhbmVdOwogCXdwLT5wbGFuZV9waXhlbF9yYXRlID0gcGxhbmVfcGl4ZWxfcmF0ZTsK
IAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCisJaWYgKElOVEVMX0dFTihpOTE1
KSA+PSAxMSAmJgogCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQgICYm
IHdwLT5jcHAgPT0gMSkKIAkJd3AtPmRidWZfYmxvY2tfc2l6ZSA9IDI1NjsKIAllbHNlCkBAIC00
Njk4LDcgKzQ2OTgsNyBAQCBza2xfY29tcHV0ZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXdwLT55X21pbl9zY2FubGluZXMgPSA0OwogCX0K
IAotCWlmIChza2xfbmVlZHNfbWVtb3J5X2J3X3dhKGRldl9wcml2KSkKKwlpZiAoc2tsX25lZWRz
X21lbW9yeV9id193YShpOTE1KSkKIAkJd3AtPnlfbWluX3NjYW5saW5lcyAqPSAyOwogCiAJd3At
PnBsYW5lX2J5dGVzX3Blcl9saW5lID0gd3AtPndpZHRoICogd3AtPmNwcDsKQEAgLTQ3MDcsMTIg
KzQ3MDcsMTIgQEAgc2tsX2NvbXB1dGVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCQkgICB3cC0+eV9taW5fc2NhbmxpbmVzLAogCQkJCQkg
ICB3cC0+ZGJ1Zl9ibG9ja19zaXplKTsKIAotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MCkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMCkKIAkJCWludGVybV9wYnBsKys7CiAKIAkJ
d3AtPnBsYW5lX2Jsb2Nrc19wZXJfbGluZSA9IGRpdl9maXhlZDE2KGludGVybV9wYnBsLAogCQkJ
CQkJCXdwLT55X21pbl9zY2FubGluZXMpOwotCX0gZWxzZSBpZiAod3AtPnhfdGlsZWQgJiYgSVNf
R0VOKGRldl9wcml2LCA5KSkgeworCX0gZWxzZSBpZiAod3AtPnhfdGlsZWQgJiYgSVNfR0VOKGk5
MTUsIDkpKSB7CiAJCWludGVybV9wYnBsID0gRElWX1JPVU5EX1VQKHdwLT5wbGFuZV9ieXRlc19w
ZXJfbGluZSwKIAkJCQkJICAgd3AtPmRidWZfYmxvY2tfc2l6ZSk7CiAJCXdwLT5wbGFuZV9ibG9j
a3NfcGVyX2xpbmUgPSB1MzJfdG9fZml4ZWQxNihpbnRlcm1fcGJwbCk7CkBAIC00NzU4LDkgKzQ3
NTgsOSBAQCBza2xfY29tcHV0ZV9wbGFuZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgICB3cCwgY29sb3JfcGxhbmUpOwogfQogCi1z
dGF0aWMgYm9vbCBza2xfd21faGFzX2xpbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgaW50IGxldmVsKQorc3RhdGljIGJvb2wgc2tsX3dtX2hhc19saW5lcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IGxldmVsKQogewotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCWlmIChJTlRFTF9HRU4oaTkx
NSkgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShpOTE1KSkKIAkJcmV0dXJuIHRydWU7CiAKIAkvKiBU
aGUgbnVtYmVyIG9mIGxpbmVzIGFyZSBpZ25vcmVkIGZvciB0aGUgbGV2ZWwgMCB3YXRlcm1hcmsu
ICovCkBAIC00NzczLDggKzQ3NzMsOCBAQCBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV9wbGFuZV93
bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogCQkJCSBjb25zdCBzdHJ1
Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHRfcHJldiwKIAkJCQkgc3RydWN0IHNrbF93bV9sZXZlbCAq
cmVzdWx0IC8qIG91dCAqLykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNzdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwotCXUzMiBsYXRlbmN5ID0gZGV2X3By
aXYtPndtLnNrbF9sYXRlbmN5W2xldmVsXTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoY3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJdTMyIGxhdGVuY3kgPSBpOTE1
LT53bS5za2xfbGF0ZW5jeVtsZXZlbF07CiAJdWludF9maXhlZF8xNl8xNl90IG1ldGhvZDEsIG1l
dGhvZDI7CiAJdWludF9maXhlZF8xNl8xNl90IHNlbGVjdGVkX3Jlc3VsdDsKIAl1MzIgcmVzX2Js
b2NrcywgcmVzX2xpbmVzLCBtaW5fZGRiX2FsbG9jID0gMDsKQEAgLTQ3ODksMTQgKzQ3ODksMTQg
QEAgc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfcGxhbmVfd20oY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNzdGF0ZSwKIAkgKiBXYUluY3JlYXNlTGF0ZW5jeUlQQ0VuYWJsZWQ6IGtibCxj
ZmwKIAkgKiBEaXNwbGF5IFdBICMxMTQxOiBrYmwsY2ZsCiAJICovCi0JaWYgKChJU19LQUJZTEFL
RShkZXZfcHJpdikgfHwgSVNfQ09GRkVFTEFLRShkZXZfcHJpdikpIHx8Ci0JICAgIGRldl9wcml2
LT5pcGNfZW5hYmxlZCkKKwlpZiAoKElTX0tBQllMQUtFKGk5MTUpIHx8IElTX0NPRkZFRUxBS0Uo
aTkxNSkpIHx8CisJICAgIGk5MTUtPmlwY19lbmFibGVkKQogCQlsYXRlbmN5ICs9IDQ7CiAKLQlp
ZiAoc2tsX25lZWRzX21lbW9yeV9id193YShkZXZfcHJpdikgJiYgd3AtPnhfdGlsZWQpCisJaWYg
KHNrbF9uZWVkc19tZW1vcnlfYndfd2EoaTkxNSkgJiYgd3AtPnhfdGlsZWQpCiAJCWxhdGVuY3kg
Kz0gMTU7CiAKLQltZXRob2QxID0gc2tsX3dtX21ldGhvZDEoZGV2X3ByaXYsIHdwLT5wbGFuZV9w
aXhlbF9yYXRlLAorCW1ldGhvZDEgPSBza2xfd21fbWV0aG9kMShpOTE1LCB3cC0+cGxhbmVfcGl4
ZWxfcmF0ZSwKIAkJCQkgd3AtPmNwcCwgbGF0ZW5jeSwgd3AtPmRidWZfYmxvY2tfc2l6ZSk7CiAJ
bWV0aG9kMiA9IHNrbF93bV9tZXRob2QyKHdwLT5wbGFuZV9waXhlbF9yYXRlLAogCQkJCSBjc3Rh
dGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKQEAgLTQ4MTEsOCArNDgxMSw4IEBA
IHN0YXRpYyB2b2lkIHNrbF9jb21wdXRlX3BsYW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjc3RhdGUsCiAJCSAgICAgKHdwLT5wbGFuZV9ieXRlc19wZXJfbGluZSAvIHdwLT5k
YnVmX2Jsb2NrX3NpemUgPCAxKSkgewogCQkJc2VsZWN0ZWRfcmVzdWx0ID0gbWV0aG9kMjsKIAkJ
fSBlbHNlIGlmIChsYXRlbmN5ID49IHdwLT5saW5ldGltZV91cykgewotCQkJaWYgKElTX0dFTihk
ZXZfcHJpdiwgOSkgJiYKLQkJCSAgICAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJCQlpZiAo
SVNfR0VOKGk5MTUsIDkpICYmCisJCQkgICAgIUlTX0dFTUlOSUxBS0UoaTkxNSkpCiAJCQkJc2Vs
ZWN0ZWRfcmVzdWx0ID0gbWluX2ZpeGVkMTYobWV0aG9kMSwgbWV0aG9kMik7CiAJCQllbHNlCiAJ
CQkJc2VsZWN0ZWRfcmVzdWx0ID0gbWV0aG9kMjsKQEAgLTQ4MjUsNyArNDgyNSw3IEBAIHN0YXRp
YyB2b2lkIHNrbF9jb21wdXRlX3BsYW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjc3RhdGUsCiAJcmVzX2xpbmVzID0gZGl2X3JvdW5kX3VwX2ZpeGVkMTYoc2VsZWN0ZWRfcmVz
dWx0LAogCQkJCQkgd3AtPnBsYW5lX2Jsb2Nrc19wZXJfbGluZSk7CiAKLQlpZiAoSVNfR0VOOV9C
QyhkZXZfcHJpdikgfHwgSVNfQlJPWFRPTihkZXZfcHJpdikpIHsKKwlpZiAoSVNfR0VOOV9CQyhp
OTE1KSB8fCBJU19CUk9YVE9OKGk5MTUpKSB7CiAJCS8qIERpc3BsYXkgV0EgIzExMjU6IHNrbCxi
eHQsa2JsICovCiAJCWlmIChsZXZlbCA9PSAwICYmIHdwLT5yY19zdXJmYWNlKQogCQkJcmVzX2Js
b2NrcyArPQpAQCAtNDg1Miw3ICs0ODUyLDcgQEAgc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfcGxh
bmVfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSwKIAkJfQogCX0KIAot
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+
PSAxMSkgewogCQlpZiAod3AtPnlfdGlsZWQpIHsKIAkJCWludCBleHRyYV9saW5lczsKIApAQCAt
NDg3MCw3ICs0ODcwLDcgQEAgc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfcGxhbmVfd20oY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSwKIAkJfQogCX0KIAotCWlmICghc2tsX3dt
X2hhc19saW5lcyhkZXZfcHJpdiwgbGV2ZWwpKQorCWlmICghc2tsX3dtX2hhc19saW5lcyhpOTE1
LCBsZXZlbCkpCiAJCXJlc19saW5lcyA9IDA7CiAKIAlpZiAocmVzX2xpbmVzID4gMzEpIHsKQEAg
LTQ4OTcsOCArNDg5Nyw4IEBAIHNrbF9jb21wdXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogCQkgICAgICBjb25zdCBzdHJ1Y3Qgc2tsX3dtX3BhcmFt
cyAqd21fcGFyYW1zLAogCQkgICAgICBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpsZXZlbHMpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUtPmJhc2Uu
Y3J0Yy0+ZGV2KTsKLQlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2
X3ByaXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjc3RhdGUt
PmJhc2UuY3J0Yy0+ZGV2KTsKKwlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2
ZWwoaTkxNSk7CiAJc3RydWN0IHNrbF93bV9sZXZlbCAqcmVzdWx0X3ByZXYgPSAmbGV2ZWxzWzBd
OwogCiAJZm9yIChsZXZlbCA9IDA7IGxldmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwrKykgewpAQCAt
NDkxNSw3ICs0OTE1LDcgQEAgc3RhdGljIHUzMgogc2tsX2NvbXB1dGVfbGluZXRpbWVfd20oY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqc3RhdGUgPSBjc3RhdGUtPmJhc2Uuc3RhdGU7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoc3RhdGUtPmRldik7CiAJdWludF9maXhlZF8xNl8xNl90
IGxpbmV0aW1lX3VzOwogCXUzMiBsaW5ldGltZV93bTsKIApAQCAtNDkyMyw3ICs0OTIzLDcgQEAg
c2tsX2NvbXB1dGVfbGluZXRpbWVfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNz
dGF0ZSkKIAlsaW5ldGltZV93bSA9IGZpeGVkMTZfdG9fdTMyX3JvdW5kX3VwKG11bF91MzJfZml4
ZWQxNig4LCBsaW5ldGltZV91cykpOwogCiAJLyogRGlzcGxheSBXQSAjMTEzNTogQlhUOkFMTCBH
TEs6QUxMICovCi0JaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpICYmIGRldl9wcml2LT5pcGNfZW5h
YmxlZCkKKwlpZiAoSVNfR0VOOV9MUChpOTE1KSAmJiBpOTE1LT5pcGNfZW5hYmxlZCkKIAkJbGlu
ZXRpbWVfd20gLz0gMjsKIAogCXJldHVybiBsaW5ldGltZV93bTsKQEAgLTQ5MzQsMjEgKzQ5MzQs
MjEgQEAgc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfdHJhbnNpdGlvbl93bShjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogCQkJCSAgICAgIHN0cnVjdCBza2xfcGxhbmVfd20g
KndtKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2
OwotCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2
KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsK
IAl1MTYgdHJhbnNfbWluLCB0cmFuc195X3RpbGVfbWluOwogCWNvbnN0IHUxNiB0cmFuc19hbW91
bnQgPSAxMDsgLyogVGhpcyBpcyBjb25maWd1cmFibGUgYW1vdW50ICovCiAJdTE2IHdtMF9zZWxf
cmVzX2IsIHRyYW5zX29mZnNldF9iLCByZXNfYmxvY2tzOwogCiAJLyogVHJhbnNpdGlvbiBXTSBh
cmUgbm90IHJlY29tbWVuZGVkIGJ5IEhXIHRlYW0gZm9yIEdFTjkgKi8KLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA8PSA5KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPD0gOSkKIAkJcmV0dXJuOwog
CiAJLyogVHJhbnNpdGlvbiBXTSBkb24ndCBtYWtlIGFueSBzZW5zZSBpZiBpcGMgaXMgZGlzYWJs
ZWQgKi8KLQlpZiAoIWRldl9wcml2LT5pcGNfZW5hYmxlZCkKKwlpZiAoIWk5MTUtPmlwY19lbmFi
bGVkKQogCQlyZXR1cm47CiAKIAl0cmFuc19taW4gPSAxNDsKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQogCQl0cmFuc19taW4gPSA0
OwogCiAJdHJhbnNfb2Zmc2V0X2IgPSB0cmFuc19taW4gKyB0cmFuc19hbW91bnQ7CkBAIC00OTc0
LDcgKzQ5NzQsNyBAQCBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV90cmFuc2l0aW9uX3dtKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCiAJCXJlc19ibG9ja3MgPSB3bTBfc2Vs
X3Jlc19iICsgdHJhbnNfb2Zmc2V0X2I7CiAKIAkJLyogV0EgQlVHOjE5Mzg0NjYgYWRkIG9uZSBi
bG9jayBmb3Igbm9uIHktdGlsZSBwbGFuZXMgKi8KLQkJaWYgKElTX0NOTF9SRVZJRChkZXZfcHJp
diwgQ05MX1JFVklEX0EwLCBDTkxfUkVWSURfQTApKQorCQlpZiAoSVNfQ05MX1JFVklEKGk5MTUs
IENOTF9SRVZJRF9BMCwgQ05MX1JFVklEX0EwKSkKIAkJCXJlc19ibG9ja3MgKz0gMTsKIAogCX0K
QEAgLTUwOTMsNyArNTA5Myw3IEBAIHN0YXRpYyBpbnQgaWNsX2J1aWxkX3BsYW5lX3dtKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBzdGF0aWMgaW50IHNrbF9idWlsZF9w
aXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3N0YXRlLT5iYXNlLmNy
dGMtPmRldik7CiAJc3RydWN0IHNrbF9waXBlX3dtICpwaXBlX3dtID0gJmNzdGF0ZS0+d20uc2ts
Lm9wdGltYWw7CiAJc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gJmNzdGF0ZS0+
YmFzZTsKIAlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZTsKQEAgLTUxMTAsNyArNTExMCw3IEBAIHN0
YXRpYyBpbnQgc2tsX2J1aWxkX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0
ZSkKIAkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICppbnRlbF9wc3RhdGUgPQogCQkJ
CQkJdG9faW50ZWxfcGxhbmVfc3RhdGUocHN0YXRlKTsKIAotCQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJCXJldCA9IGljbF9i
dWlsZF9wbGFuZV93bShjc3RhdGUsIGludGVsX3BzdGF0ZSk7CiAJCWVsc2UKIAkJCXJldCA9IHNr
bF9idWlsZF9wbGFuZV93bShjc3RhdGUsIGludGVsX3BzdGF0ZSk7CkBAIC01MTIzLDcgKzUxMjMs
NyBAQCBzdGF0aWMgaW50IHNrbF9idWlsZF9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIHNrbF9kZGJfZW50cnlfd3Jp
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgc2tsX2Rk
Yl9lbnRyeV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQlpOTE1X3Jl
Z190IHJlZywKIAkJCQljb25zdCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZW50cnkpCiB7CkBAIC01
MTMzLDcgKzUxMzMsNyBAQCBzdGF0aWMgdm9pZCBza2xfZGRiX2VudHJ5X3dyaXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJSTkxNV9XUklURV9GVyhyZWcsIDApOwogfQog
Ci1zdGF0aWMgdm9pZCBza2xfd3JpdGVfd21fbGV2ZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIHZvaWQgc2tsX3dyaXRlX3dtX2xldmVsKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJICAgICAgIGk5MTVfcmVnX3QgcmVnLAogCQkJICAgICAgIGNv
bnN0IHN0cnVjdCBza2xfd21fbGV2ZWwgKmxldmVsKQogewpAQCAtNTE1Miw4ICs1MTUyLDggQEAg
c3RhdGljIHZvaWQgc2tsX3dyaXRlX3dtX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIHZvaWQgc2tsX3dyaXRlX3BsYW5lX3dtKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7Ci0JaW50IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2
KTsKKwlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoaTkxNSk7CiAJZW51
bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5l
LT5waXBlOwogCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKndtID0KQEAgLTUxNjQsMTQgKzUx
NjQsMTQgQEAgdm9pZCBza2xfd3JpdGVfcGxhbmVfd20oc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSwKIAkJJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfdXZbcGxhbmVfaWRdOwogCiAJZm9y
IChsZXZlbCA9IDA7IGxldmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwrKykgewotCQlza2xfd3JpdGVf
d21fbGV2ZWwoZGV2X3ByaXYsIFBMQU5FX1dNKHBpcGUsIHBsYW5lX2lkLCBsZXZlbCksCisJCXNr
bF93cml0ZV93bV9sZXZlbChpOTE1LCBQTEFORV9XTShwaXBlLCBwbGFuZV9pZCwgbGV2ZWwpLAog
CQkJCSAgICZ3bS0+d21bbGV2ZWxdKTsKIAl9Ci0Jc2tsX3dyaXRlX3dtX2xldmVsKGRldl9wcml2
LCBQTEFORV9XTV9UUkFOUyhwaXBlLCBwbGFuZV9pZCksCisJc2tsX3dyaXRlX3dtX2xldmVsKGk5
MTUsIFBMQU5FX1dNX1RSQU5TKHBpcGUsIHBsYW5lX2lkKSwKIAkJCSAgICZ3bS0+dHJhbnNfd20p
OwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKLQkJc2tsX2RkYl9lbnRyeV93
cml0ZShkZXZfcHJpdiwKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKSB7CisJCXNrbF9kZGJf
ZW50cnlfd3JpdGUoaTkxNSwKIAkJCQkgICAgUExBTkVfQlVGX0NGRyhwaXBlLCBwbGFuZV9pZCks
IGRkYl95KTsKIAkJcmV0dXJuOwogCX0KQEAgLTUxNzksMTcgKzUxNzksMTcgQEAgdm9pZCBza2xf
d3JpdGVfcGxhbmVfd20oc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlpZiAod20tPmlzX3Bs
YW5hcikKIAkJc3dhcChkZGJfeSwgZGRiX3V2KTsKIAotCXNrbF9kZGJfZW50cnlfd3JpdGUoZGV2
X3ByaXYsCisJc2tsX2RkYl9lbnRyeV93cml0ZShpOTE1LAogCQkJICAgIFBMQU5FX0JVRl9DRkco
cGlwZSwgcGxhbmVfaWQpLCBkZGJfeSk7Ci0Jc2tsX2RkYl9lbnRyeV93cml0ZShkZXZfcHJpdiwK
Kwlza2xfZGRiX2VudHJ5X3dyaXRlKGk5MTUsCiAJCQkgICAgUExBTkVfTlYxMl9CVUZfQ0ZHKHBp
cGUsIHBsYW5lX2lkKSwgZGRiX3V2KTsKIH0KIAogdm9pZCBza2xfd3JpdGVfY3Vyc29yX3dtKHN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dt
X21heF9sZXZlbChkZXZfcHJpdik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJaW50IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21f
bWF4X2xldmVsKGk5MTUpOwogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAljb25zdCBzdHJ1Y3Qgc2tsX3BsYW5lX3dt
ICp3bSA9CkBAIC01MTk4LDEyICs1MTk4LDEyIEBAIHZvaWQgc2tsX3dyaXRlX2N1cnNvcl93bShz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2Rk
Yl95W3BsYW5lX2lkXTsKIAogCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhfbGV2ZWw7IGxl
dmVsKyspIHsKLQkJc2tsX3dyaXRlX3dtX2xldmVsKGRldl9wcml2LCBDVVJfV00ocGlwZSwgbGV2
ZWwpLAorCQlza2xfd3JpdGVfd21fbGV2ZWwoaTkxNSwgQ1VSX1dNKHBpcGUsIGxldmVsKSwKIAkJ
CQkgICAmd20tPndtW2xldmVsXSk7CiAJfQotCXNrbF93cml0ZV93bV9sZXZlbChkZXZfcHJpdiwg
Q1VSX1dNX1RSQU5TKHBpcGUpLCAmd20tPnRyYW5zX3dtKTsKKwlza2xfd3JpdGVfd21fbGV2ZWwo
aTkxNSwgQ1VSX1dNX1RSQU5TKHBpcGUpLCAmd20tPnRyYW5zX3dtKTsKIAotCXNrbF9kZGJfZW50
cnlfd3JpdGUoZGV2X3ByaXYsIENVUl9CVUZfQ0ZHKHBpcGUpLCBkZGIpOworCXNrbF9kZGJfZW50
cnlfd3JpdGUoaTkxNSwgQ1VSX0JVRl9DRkcocGlwZSksIGRkYik7CiB9CiAKIGJvb2wgc2tsX3dt
X2xldmVsX2VxdWFscyhjb25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpsMSwKQEAgLTUyMTUsMTEg
KzUyMTUsMTEgQEAgYm9vbCBza2xfd21fbGV2ZWxfZXF1YWxzKGNvbnN0IHN0cnVjdCBza2xfd21f
bGV2ZWwgKmwxLAogCQlsMS0+cGxhbmVfcmVzX2IgPT0gbDItPnBsYW5lX3Jlc19iOwogfQogCi1z
dGF0aWMgYm9vbCBza2xfcGxhbmVfd21fZXF1YWxzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyBib29sIHNrbF9wbGFuZV93bV9lcXVhbHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20xLAogCQkJ
CWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKndtMikKIHsKLQlpbnQgbGV2ZWwsIG1heF9sZXZl
bCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOworCWludCBsZXZlbCwgbWF4X2xldmVsID0g
aWxrX3dtX21heF9sZXZlbChpOTE1KTsKIAogCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhf
bGV2ZWw7IGxldmVsKyspIHsKIAkJaWYgKCFza2xfd21fbGV2ZWxfZXF1YWxzKCZ3bTEtPndtW2xl
dmVsXSwgJndtMi0+d21bbGV2ZWxdKSB8fApAQCAtNTIzNCwxMSArNTIzNCwxMSBAQCBzdGF0aWMg
Ym9vbCBza2xfcGlwZV93bV9lcXVhbHMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAg
ICAgY29uc3Qgc3RydWN0IHNrbF9waXBlX3dtICp3bTEsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0
IHNrbF9waXBlX3dtICp3bTIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkOwog
CiAJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhjcnRjLCBwbGFuZV9pZCkgewotCQlpZiAoIXNr
bF9wbGFuZV93bV9lcXVhbHMoZGV2X3ByaXYsCisJCWlmICghc2tsX3BsYW5lX3dtX2VxdWFscyhp
OTE1LAogCQkJCQkgJndtMS0+cGxhbmVzW3BsYW5lX2lkXSwKIAkJCQkJICZ3bTItPnBsYW5lc1tw
bGFuZV9pZF0pKQogCQkJcmV0dXJuIGZhbHNlOwpAQCAtNTI4NywxMCArNTI4NywxMCBAQCBza2xf
ZGRiX2FkZF9hZmZlY3RlZF9wbGFuZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9s
ZF9jcnRjX3N0YXRlLAogewogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0gdG9f
aW50ZWxfYXRvbWljX3N0YXRlKG5ld19jcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0
Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCi0JZm9yX2VhY2hfaW50
ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YywgcGxhbmUpIHsKKwlmb3JfZWFj
aF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZpOTE1LT5kcm0sIGNydGMsIHBsYW5lKSB7CiAJCXN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CiAJCWVudW0gcGxhbmVfaWQgcGxhbmVf
aWQgPSBwbGFuZS0+aWQ7CiAKQEAgLTUzMTMsMTQgKzUzMTMsMTQgQEAgc2tsX2RkYl9hZGRfYWZm
ZWN0ZWRfcGxhbmVzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
ZSwKIHN0YXRpYyBpbnQKIHNrbF9jb21wdXRlX2RkYihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CiAJc3RydWN0IHNrbF9kZGJfYWxsb2Nh
dGlvbiAqZGRiID0gJnN0YXRlLT53bV9yZXN1bHRzLmRkYjsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGU7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRj
X3N0YXRlOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCWludCByZXQsIGk7CiAKLQltZW1j
cHkoZGRiLCAmZGV2X3ByaXYtPndtLnNrbF9ody5kZGIsIHNpemVvZigqZGRiKSk7CisJbWVtY3B5
KGRkYiwgJmk5MTUtPndtLnNrbF9ody5kZGIsIHNpemVvZigqZGRiKSk7CiAKIAlmb3JfZWFjaF9v
bGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsCiAJ
CQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgewpAQCAtNTM0NSw3ICs1MzQ1LDcgQEAgc3RhdGlj
IGNoYXIgZW5hc3QoYm9vbCBlbmFibGUpCiBzdGF0aWMgdm9pZAogc2tsX3ByaW50X3dtX2NoYW5n
ZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCWNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZTsKIAljb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CiAJc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZTsKQEAgLTUzNjIsNyArNTM2Miw3IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQlvbGRfcGlwZV93bSA9ICZvbGRfY3J0Y19zdGF0
ZS0+d20uc2tsLm9wdGltYWw7CiAJCW5ld19waXBlX3dtID0gJm5ld19jcnRjX3N0YXRlLT53bS5z
a2wub3B0aW1hbDsKIAotCQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+
ZHJtLCBjcnRjLCBwbGFuZSkgeworCQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZpOTE1
LT5kcm0sIGNydGMsIHBsYW5lKSB7CiAJCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUt
PmlkOwogCQkJY29uc3Qgc3RydWN0IHNrbF9kZGJfZW50cnkgKm9sZCwgKm5ldzsKIApAQCAtNTM3
OCwxNCArNTM3OCwxNCBAQCBza2xfcHJpbnRfd21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAkJCQkgICAgICBza2xfZGRiX2VudHJ5X3NpemUob2xkKSwgc2tsX2Rk
Yl9lbnRyeV9zaXplKG5ldykpOwogCQl9CiAKLQkJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0
YygmZGV2X3ByaXYtPmRybSwgY3J0YywgcGxhbmUpIHsKKwkJZm9yX2VhY2hfaW50ZWxfcGxhbmVf
b25fY3J0YygmaTkxNS0+ZHJtLCBjcnRjLCBwbGFuZSkgewogCQkJZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZCA9IHBsYW5lLT5pZDsKIAkJCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKm9sZF93bSwg
Km5ld193bTsKIAogCQkJb2xkX3dtID0gJm9sZF9waXBlX3dtLT5wbGFuZXNbcGxhbmVfaWRdOwog
CQkJbmV3X3dtID0gJm5ld19waXBlX3dtLT5wbGFuZXNbcGxhbmVfaWRdOwogCi0JCQlpZiAoc2ts
X3BsYW5lX3dtX2VxdWFscyhkZXZfcHJpdiwgb2xkX3dtLCBuZXdfd20pKQorCQkJaWYgKHNrbF9w
bGFuZV93bV9lcXVhbHMoaTkxNSwgb2xkX3dtLCBuZXdfd20pKQogCQkJCWNvbnRpbnVlOwogCiAJ
CQlEUk1fREVCVUdfS01TKCJbUExBTkU6JWQ6JXNdICAgbGV2ZWwgJWN3bTAsJWN3bTEsJWN3bTIs
JWN3bTMsJWN3bTQsJWN3bTUsJWN3bTYsJWN3bTcsJWN0d20iCkBAIC01NDYwLDcgKzU0NjAsNyBA
QCBzdGF0aWMgaW50CiBza2xfZGRiX2FkZF9hZmZlY3RlZF9waXBlcyhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwgYm9vbCAqY2hhbmdlZCkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gc3RhdGUtPmJhc2UuZGV2OwotCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKIAl1MzIgcmVhbGxvY19waXBlcyA9IHBpcGVz
X21vZGlmaWVkKHN0YXRlKTsKQEAgLTU0NzAsMTQgKzU0NzAsMTQgQEAgc2tsX2RkYl9hZGRfYWZm
ZWN0ZWRfcGlwZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsIGJvb2wgKmNoYW5n
ZWQpCiAJICogV2hlbiB3ZSBkaXN0cnVzdCBiaW9zIHdtIHdlIGFsd2F5cyBuZWVkIHRvIHJlY29t
cHV0ZSB0byBzZXQgdGhlCiAJICogZXhwZWN0ZWQgRERCIGFsbG9jYXRpb25zIGZvciBlYWNoIENS
VEMuCiAJICovCi0JaWYgKGRldl9wcml2LT53bS5kaXN0cnVzdF9iaW9zX3dtKQorCWlmIChpOTE1
LT53bS5kaXN0cnVzdF9iaW9zX3dtKQogCQkoKmNoYW5nZWQpID0gdHJ1ZTsKIAogCS8qCiAJICog
SWYgdGhpcyB0cmFuc2FjdGlvbiBpc24ndCBhY3R1YWxseSB0b3VjaGluZyBhbnkgQ1JUQydzLCBk
b24ndAogCSAqIGJvdGhlciB3aXRoIHdhdGVybWFyayBjYWxjdWxhdGlvbi4gIE5vdGUgdGhhdCBp
ZiB3ZSBwYXNzIHRoaXMKIAkgKiB0ZXN0LCB3ZSdyZSBndWFyYW50ZWVkIHRvIGhvbGQgYXQgbGVh
c3Qgb25lIENSVEMgc3RhdGUgbXV0ZXgsCi0JICogd2hpY2ggbWVhbnMgd2UgY2FuIHNhZmVseSB1
c2UgdmFsdWVzIGxpa2UgZGV2X3ByaXYtPmFjdGl2ZV9jcnRjcworCSAqIHdoaWNoIG1lYW5zIHdl
IGNhbiBzYWZlbHkgdXNlIHZhbHVlcyBsaWtlIGk5MTUtPmFjdGl2ZV9jcnRjcwogCSAqIHNpbmNl
IGFueSByYWNpbmcgY29tbWl0cyB0aGF0IHdhbnQgdG8gdXBkYXRlIHRoZW0gd291bGQgbmVlZCB0
bwogCSAqIGhvbGQgX2FsbF8gQ1JUQyBzdGF0ZSBtdXRleGVzLgogCSAqLwpAQCAtNTQ5Myw3ICs1
NDkzLDcgQEAgc2tsX2RkYl9hZGRfYWZmZWN0ZWRfcGlwZXMoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUsIGJvb2wgKmNoYW5nZWQpCiAJICogcHJldGVuZCB0aGF0IGFsbCBwaXBlcyBz
d2l0Y2hlZCBhY3RpdmUgc3RhdHVzIHNvIHRoYXQgd2UnbGwKIAkgKiBlbnN1cmUgYSBmdWxsIERE
QiByZWNvbXB1dGUuCiAJICovCi0JaWYgKGRldl9wcml2LT53bS5kaXN0cnVzdF9iaW9zX3dtKSB7
CisJaWYgKGk5MTUtPndtLmRpc3RydXN0X2Jpb3Nfd20pIHsKIAkJcmV0ID0gZHJtX21vZGVzZXRf
bG9jaygmZGV2LT5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4LAogCQkJCSAgICAgICBzdGF0
ZS0+YmFzZS5hY3F1aXJlX2N0eCk7CiAJCWlmIChyZXQpCkBAIC01NTA4LDcgKzU1MDgsNyBAQCBz
a2xfZGRiX2FkZF9hZmZlY3RlZF9waXBlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSwgYm9vbCAqY2hhbmdlZCkKIAkJICogb24gdGhlIGZpcnN0IGNvbW1pdCB0b28uCiAJCSAqLwog
CQlpZiAoIXN0YXRlLT5tb2Rlc2V0KQotCQkJc3RhdGUtPmFjdGl2ZV9jcnRjcyA9IGRldl9wcml2
LT5hY3RpdmVfY3J0Y3M7CisJCQlzdGF0ZS0+YWN0aXZlX2NydGNzID0gaTkxNS0+YWN0aXZlX2Ny
dGNzOwogCX0KIAogCS8qCkBAIC01NTY3LDE0ICs1NTY3LDE0IEBAIHNrbF9kZGJfYWRkX2FmZmVj
dGVkX3BpcGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLCBib29sICpjaGFuZ2Vk
KQogc3RhdGljIGludCBza2xfd21fYWRkX2FmZmVjdGVkX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9
CiAJCWludGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwogCXN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSA9CiAJCWludGVsX2F0b21pY19nZXRf
bmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7
CiAKLQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjLCBw
bGFuZSkgeworCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoJmk5MTUtPmRybSwgY3J0Yywg
cGxhbmUpIHsKIAkJc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKIAkJZW51
bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIApAQCAtNTU4Nyw3ICs1NTg3LDcgQEAg
c3RhdGljIGludCBza2xfd21fYWRkX2FmZmVjdGVkX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSwKIAkJICogd2l0aCB0aGUgc29mdHdhcmUgc3RhdGUuCiAJCSAqLwogCQlp
ZiAoIWRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdfY3J0Y19zdGF0ZS0+YmFzZSkg
JiYKLQkJICAgIHNrbF9wbGFuZV93bV9lcXVhbHMoZGV2X3ByaXYsCisJCSAgICBza2xfcGxhbmVf
d21fZXF1YWxzKGk5MTUsCiAJCQkJCSZvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxh
bmVzW3BsYW5lX2lkXSwKIAkJCQkJJm5ld19jcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbC5wbGFu
ZXNbcGxhbmVfaWRdKSkKIAkJCWNvbnRpbnVlOwpAQCAtNTY1NCw3ICs1NjU0LDcgQEAgc3RhdGlj
IHZvaWQgc2tsX2F0b21pY191cGRhdGVfY3J0Y193bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSwKIAkJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlKQogewog
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhjc3RhdGUtPmJhc2UuY3J0
Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+
YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShzdGF0
ZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBza2xfcGlwZV93bSAqcGlwZV93bSA9ICZjc3RhdGUtPndt
LnNrbC5vcHRpbWFsOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIApAQCAtNTY2OSwy
NyArNTY2OSwyNyBAQCBzdGF0aWMgdm9pZCBza2xfaW5pdGlhbF93bShzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRv
X2ludGVsX2NydGMoY3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGRldik7CiAJc3RydWN0IHNrbF9kZGJfdmFsdWVzICpyZXN1bHRzID0gJnN0YXRlLT53bV9y
ZXN1bHRzOwogCiAJaWYgKChyZXN1bHRzLT5kaXJ0eV9waXBlcyAmIGRybV9jcnRjX21hc2soJmlu
dGVsX2NydGMtPmJhc2UpKSA9PSAwKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZkZXZfcHJp
di0+d20ud21fbXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUtPndtLndtX211dGV4KTsKIAogCWlm
IChjc3RhdGUtPmJhc2UuYWN0aXZlX2NoYW5nZWQpCiAJCXNrbF9hdG9taWNfdXBkYXRlX2NydGNf
d20oc3RhdGUsIGNzdGF0ZSk7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT53bS53bV9tdXRl
eCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT53bS53bV9tdXRleCk7CiB9CiAKLXN0YXRpYyB2b2lk
IGlsa19jb21wdXRlX3dtX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitzdGF0aWMgdm9pZCBpbGtfY29tcHV0ZV93bV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfd21fY29uZmlnICpjb25maWcpCiB7CiAJc3Ry
dWN0IGludGVsX2NydGMgKmNydGM7CiAKIAkvKiBDb21wdXRlIHRoZSBjdXJyZW50bHkgX2FjdGl2
ZV8gY29uZmlnICovCi0JZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0Yykg
eworCWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRybSwgY3J0YykgewogCQljb25zdCBzdHJ1
Y3QgaW50ZWxfcGlwZV93bSAqd20gPSAmY3J0Yy0+d20uYWN0aXZlLmlsazsKIAogCQlpZiAoIXdt
LT5waXBlX2VuYWJsZWQpCkBAIC01NzAxLDcgKzU3MDEsNyBAQCBzdGF0aWMgdm9pZCBpbGtfY29t
cHV0ZV93bV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0K
IAotc3RhdGljIHZvaWQgaWxrX3Byb2dyYW1fd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbGtfcHJvZ3JhbV93YXRlcm1hcmtzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9waXBlX3dtIGxwX3dt
XzFfMiA9IHt9LCBscF93bV81XzYgPSB7fSwgKmJlc3RfbHBfd207CiAJc3RydWN0IGlsa193bV9t
YXhpbXVtcyBtYXg7CkBAIC01NzA5LDE4ICs1NzA5LDE4IEBAIHN0YXRpYyB2b2lkIGlsa19wcm9n
cmFtX3dhdGVybWFya3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXN0cnVj
dCBpbGtfd21fdmFsdWVzIHJlc3VsdHMgPSB7fTsKIAllbnVtIGludGVsX2RkYl9wYXJ0aXRpb25p
bmcgcGFydGl0aW9uaW5nOwogCi0JaWxrX2NvbXB1dGVfd21fY29uZmlnKGRldl9wcml2LCAmY29u
ZmlnKTsKKwlpbGtfY29tcHV0ZV93bV9jb25maWcoaTkxNSwgJmNvbmZpZyk7CiAKLQlpbGtfY29t
cHV0ZV93bV9tYXhpbXVtcyhkZXZfcHJpdiwgMSwgJmNvbmZpZywgSU5URUxfRERCX1BBUlRfMV8y
LCAmbWF4KTsKLQlpbGtfd21fbWVyZ2UoZGV2X3ByaXYsICZjb25maWcsICZtYXgsICZscF93bV8x
XzIpOworCWlsa19jb21wdXRlX3dtX21heGltdW1zKGk5MTUsIDEsICZjb25maWcsIElOVEVMX0RE
Ql9QQVJUXzFfMiwgJm1heCk7CisJaWxrX3dtX21lcmdlKGk5MTUsICZjb25maWcsICZtYXgsICZs
cF93bV8xXzIpOwogCiAJLyogNS82IHNwbGl0IG9ubHkgaW4gc2luZ2xlIHBpcGUgY29uZmlnIG9u
IElWQisgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA3ICYmCisJaWYgKElOVEVMX0dF
TihpOTE1KSA+PSA3ICYmCiAJICAgIGNvbmZpZy5udW1fcGlwZXNfYWN0aXZlID09IDEgJiYgY29u
ZmlnLnNwcml0ZXNfZW5hYmxlZCkgewotCQlpbGtfY29tcHV0ZV93bV9tYXhpbXVtcyhkZXZfcHJp
diwgMSwgJmNvbmZpZywgSU5URUxfRERCX1BBUlRfNV82LCAmbWF4KTsKLQkJaWxrX3dtX21lcmdl
KGRldl9wcml2LCAmY29uZmlnLCAmbWF4LCAmbHBfd21fNV82KTsKKwkJaWxrX2NvbXB1dGVfd21f
bWF4aW11bXMoaTkxNSwgMSwgJmNvbmZpZywgSU5URUxfRERCX1BBUlRfNV82LCAmbWF4KTsKKwkJ
aWxrX3dtX21lcmdlKGk5MTUsICZjb25maWcsICZtYXgsICZscF93bV81XzYpOwogCi0JCWJlc3Rf
bHBfd20gPSBpbGtfZmluZF9iZXN0X3Jlc3VsdChkZXZfcHJpdiwgJmxwX3dtXzFfMiwgJmxwX3dt
XzVfNik7CisJCWJlc3RfbHBfd20gPSBpbGtfZmluZF9iZXN0X3Jlc3VsdChpOTE1LCAmbHBfd21f
MV8yLCAmbHBfd21fNV82KTsKIAl9IGVsc2UgewogCQliZXN0X2xwX3dtID0gJmxwX3dtXzFfMjsK
IAl9CkBAIC01NzI4LDM1ICs1NzI4LDM1IEBAIHN0YXRpYyB2b2lkIGlsa19wcm9ncmFtX3dhdGVy
bWFya3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXBhcnRpdGlvbmluZyA9
IChiZXN0X2xwX3dtID09ICZscF93bV8xXzIpID8KIAkJICAgICAgIElOVEVMX0REQl9QQVJUXzFf
MiA6IElOVEVMX0REQl9QQVJUXzVfNjsKIAotCWlsa19jb21wdXRlX3dtX3Jlc3VsdHMoZGV2X3By
aXYsIGJlc3RfbHBfd20sIHBhcnRpdGlvbmluZywgJnJlc3VsdHMpOworCWlsa19jb21wdXRlX3dt
X3Jlc3VsdHMoaTkxNSwgYmVzdF9scF93bSwgcGFydGl0aW9uaW5nLCAmcmVzdWx0cyk7CiAKLQlp
bGtfd3JpdGVfd21fdmFsdWVzKGRldl9wcml2LCAmcmVzdWx0cyk7CisJaWxrX3dyaXRlX3dtX3Zh
bHVlcyhpOTE1LCAmcmVzdWx0cyk7CiB9CiAKIHN0YXRpYyB2b2lkIGlsa19pbml0aWFsX3dhdGVy
bWFya3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNzdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3N0YXRlLT5iYXNlLmNy
dGMpOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPndtLndtX211dGV4KTsKKwltdXRleF9sb2Nr
KCZpOTE1LT53bS53bV9tdXRleCk7CiAJaW50ZWxfY3J0Yy0+d20uYWN0aXZlLmlsayA9IGNzdGF0
ZS0+d20uaWxrLmludGVybWVkaWF0ZTsKLQlpbGtfcHJvZ3JhbV93YXRlcm1hcmtzKGRldl9wcml2
KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CisJaWxrX3Byb2dyYW1f
d2F0ZXJtYXJrcyhpOTE1KTsKKwltdXRleF91bmxvY2soJmk5MTUtPndtLndtX211dGV4KTsKIH0K
IAogc3RhdGljIHZvaWQgaWxrX29wdGltaXplX3dhdGVybWFya3Moc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUt
PmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoY3N0YXRlLT5iYXNlLmNydGMtPmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2Ny
dGMgPSB0b19pbnRlbF9jcnRjKGNzdGF0ZS0+YmFzZS5jcnRjKTsKIAotCW11dGV4X2xvY2soJmRl
dl9wcml2LT53bS53bV9tdXRleCk7CisJbXV0ZXhfbG9jaygmaTkxNS0+d20ud21fbXV0ZXgpOwog
CWlmIChjc3RhdGUtPndtLm5lZWRfcG9zdHZibF91cGRhdGUpIHsKIAkJaW50ZWxfY3J0Yy0+d20u
YWN0aXZlLmlsayA9IGNzdGF0ZS0+d20uaWxrLm9wdGltYWw7Ci0JCWlsa19wcm9ncmFtX3dhdGVy
bWFya3MoZGV2X3ByaXYpOworCQlpbGtfcHJvZ3JhbV93YXRlcm1hcmtzKGk5MTUpOwogCX0KLQlt
dXRleF91bmxvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1
LT53bS53bV9tdXRleCk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBza2xfd21fbGV2ZWxfZnJv
bV9yZWdfdmFsKHUzMiB2YWwsCkBAIC01NzcyLDEzICs1NzcyLDEzIEBAIHN0YXRpYyBpbmxpbmUg
dm9pZCBza2xfd21fbGV2ZWxfZnJvbV9yZWdfdmFsKHUzMiB2YWwsCiB2b2lkIHNrbF9waXBlX3dt
X2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgICAgIHN0cnVjdCBz
a2xfcGlwZV93bSAqb3V0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBl
OwogCWludCBsZXZlbCwgbWF4X2xldmVsOwogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQ7CiAJdTMy
IHZhbDsKIAotCW1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOworCW1heF9s
ZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoaTkxNSk7CiAKIAlmb3JfZWFjaF9wbGFuZV9pZF9vbl9j
cnRjKGNydGMsIHBsYW5lX2lkKSB7CiAJCXN0cnVjdCBza2xfcGxhbmVfd20gKndtID0gJm91dC0+
cGxhbmVzW3BsYW5lX2lkXTsKQEAgLTU4MDYsMTUgKzU4MDYsMTUgQEAgdm9pZCBza2xfcGlwZV93
bV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJb3V0LT5saW5ldGltZSA9
IEk5MTVfUkVBRChQSVBFX1dNX0xJTkVUSU1FKHBpcGUpKTsKIH0KIAotdm9pZCBza2xfd21fZ2V0
X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgc2tsX3dt
X2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qg
c2tsX2RkYl92YWx1ZXMgKmh3ID0gJmRldl9wcml2LT53bS5za2xfaHc7Ci0Jc3RydWN0IHNrbF9k
ZGJfYWxsb2NhdGlvbiAqZGRiID0gJmRldl9wcml2LT53bS5za2xfaHcuZGRiOworCXN0cnVjdCBz
a2xfZGRiX3ZhbHVlcyAqaHcgPSAmaTkxNS0+d20uc2tsX2h3OworCXN0cnVjdCBza2xfZGRiX2Fs
bG9jYXRpb24gKmRkYiA9ICZpOTE1LT53bS5za2xfaHcuZGRiOwogCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGU7CiAKLQlza2xfZGRiX2dl
dF9od19zdGF0ZShkZXZfcHJpdiwgZGRiKTsKLQlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJp
di0+ZHJtLCBjcnRjKSB7CisJc2tsX2RkYl9nZXRfaHdfc3RhdGUoaTkxNSwgZGRiKTsKKwlmb3Jf
ZWFjaF9pbnRlbF9jcnRjKCZpOTE1LT5kcm0sIGNydGMpIHsKIAkJY3N0YXRlID0gdG9faW50ZWxf
Y3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAogCQlza2xfcGlwZV93bV9nZXRfaHdfc3Rh
dGUoY3J0YywgJmNzdGF0ZS0+d20uc2tsLm9wdGltYWwpOwpAQCAtNTgyMywxNyArNTgyMywxNyBA
QCB2b2lkIHNrbF93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCQkJaHctPmRpcnR5X3BpcGVzIHw9IGRybV9jcnRjX21hc2soJmNydGMtPmJhc2UpOwog
CX0KIAotCWlmIChkZXZfcHJpdi0+YWN0aXZlX2NydGNzKSB7CisJaWYgKGk5MTUtPmFjdGl2ZV9j
cnRjcykgewogCQkvKiBGdWxseSByZWNvbXB1dGUgRERCIG9uIGZpcnN0IGF0b21pYyBjb21taXQg
Ki8KLQkJZGV2X3ByaXYtPndtLmRpc3RydXN0X2Jpb3Nfd20gPSB0cnVlOworCQlpOTE1LT53bS5k
aXN0cnVzdF9iaW9zX3dtID0gdHJ1ZTsKIAl9CiB9CiAKIHN0YXRpYyB2b2lkIGlsa19waXBlX3dt
X2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBpbGtfd21fdmFsdWVzICpodyA9ICZkZXZf
cHJpdi0+d20uaHc7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IGlsa193bV92YWx1ZXMgKmh3ID0gJmk5MTUtPndtLmh3OwogCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uu
c3RhdGUpOwogCXN0cnVjdCBpbnRlbF9waXBlX3dtICphY3RpdmUgPSAmY3N0YXRlLT53bS5pbGsu
b3B0aW1hbDsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CkBAIC01ODQ0LDcgKzU4NDQs
NyBAQCBzdGF0aWMgdm9pZCBpbGtfcGlwZV93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMpCiAJfTsKIAogCWh3LT53bV9waXBlW3BpcGVdID0gSTkxNV9SRUFEKHdtMF9waXBl
X3JlZ1twaXBlXSk7Ci0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChk
ZXZfcHJpdikpCisJaWYgKElTX0hBU1dFTEwoaTkxNSkgfHwgSVNfQlJPQURXRUxMKGk5MTUpKQog
CQlody0+d21fbGluZXRpbWVbcGlwZV0gPSBJOTE1X1JFQUQoUElQRV9XTV9MSU5FVElNRShwaXBl
KSk7CiAKIAltZW1zZXQoYWN0aXZlLCAwLCBzaXplb2YoKmFjdGl2ZSkpOwpAQCAtNTg2Niw3ICs1
ODY2LDcgQEAgc3RhdGljIHZvaWQgaWxrX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjKQogCQlhY3RpdmUtPndtWzBdLmN1cl92YWwgPSB0bXAgJiBXTTBfUElQRV9D
VVJTT1JfTUFTSzsKIAkJYWN0aXZlLT5saW5ldGltZSA9IGh3LT53bV9saW5ldGltZVtwaXBlXTsK
IAl9IGVsc2UgewotCQlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2
X3ByaXYpOworCQlpbnQgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoaTkxNSk7
CiAKIAkJLyoKIAkJICogRm9yIGluYWN0aXZlIHBpcGVzLCBhbGwgd2F0ZXJtYXJrIGxldmVscwpA
QCAtNTg4NSw3ICs1ODg1LDcgQEAgc3RhdGljIHZvaWQgaWxrX3BpcGVfd21fZ2V0X2h3X3N0YXRl
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogI2RlZmluZSBfRldfV01fVkxWKHZhbHVlLCBwbGFu
ZSkgXAogCSgoKHZhbHVlKSAmIERTUEZXXyAjIyBwbGFuZSAjIyBfTUFTS19WTFYpID4+IERTUEZX
XyAjIyBwbGFuZSAjIyBfU0hJRlQpCiAKLXN0YXRpYyB2b2lkIGc0eF9yZWFkX3dtX3ZhbHVlcyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBnNHhfcmVhZF93
bV92YWx1ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgc3RydWN0
IGc0eF93bV92YWx1ZXMgKndtKQogewogCXUzMiB0bXA7CkBAIC01OTExLDEzICs1OTExLDEzIEBA
IHN0YXRpYyB2b2lkIGc0eF9yZWFkX3dtX3ZhbHVlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAJd20tPmhwbGwucGxhbmUgPSBfRldfV00odG1wLCBIUExMX1NSKTsKIH0KIAot
c3RhdGljIHZvaWQgdmx2X3JlYWRfd21fdmFsdWVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHZsdl9yZWFkX3dtX3ZhbHVlcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgICBzdHJ1Y3Qgdmx2X3dtX3ZhbHVlcyAqd20pCiB7CiAJ
ZW51bSBwaXBlIHBpcGU7CiAJdTMyIHRtcDsKIAotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBp
cGUpIHsKKwlmb3JfZWFjaF9waXBlKGk5MTUsIHBpcGUpIHsKIAkJdG1wID0gSTkxNV9SRUFEKFZM
Vl9EREwocGlwZSkpOwogCiAJCXdtLT5kZGxbcGlwZV0ucGxhbmVbUExBTkVfUFJJTUFSWV0gPQpA
QCAtNTk0NCw3ICs1OTQ0LDcgQEAgc3RhdGljIHZvaWQgdmx2X3JlYWRfd21fdmFsdWVzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl0bXAgPSBJOTE1X1JFQUQoRFNQRlczKTsK
IAl3bS0+c3IuY3Vyc29yID0gX0ZXX1dNKHRtcCwgQ1VSU09SX1NSKTsKIAotCWlmIChJU19DSEVS
UllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKSB7CiAJCXRtcCA9
IEk5MTVfUkVBRChEU1BGVzdfQ0hWKTsKIAkJd20tPnBpcGVbUElQRV9CXS5wbGFuZVtQTEFORV9T
UFJJVEUxXSA9IF9GV19XTV9WTFYodG1wLCBTUFJJVEVEKTsKIAkJd20tPnBpcGVbUElQRV9CXS5w
bGFuZVtQTEFORV9TUFJJVEUwXSA9IF9GV19XTV9WTFYodG1wLCBTUFJJVEVDKTsKQEAgLTU5ODcs
MTYgKzU5ODcsMTYgQEAgc3RhdGljIHZvaWQgdmx2X3JlYWRfd21fdmFsdWVzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICN1bmRlZiBfRldfV00KICN1bmRlZiBfRldfV01fVkxW
CiAKLXZvaWQgZzR4X3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCit2b2lkIGc0eF93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7Ci0Jc3RydWN0IGc0eF93bV92YWx1ZXMgKndtID0gJmRldl9wcml2LT53bS5nNHg7
CisJc3RydWN0IGc0eF93bV92YWx1ZXMgKndtID0gJmk5MTUtPndtLmc0eDsKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YzsKIAotCWc0eF9yZWFkX3dtX3ZhbHVlcyhkZXZfcHJpdiwgd20pOworCWc0
eF9yZWFkX3dtX3ZhbHVlcyhpOTE1LCB3bSk7CiAKIAl3bS0+Y3hzciA9IEk5MTVfUkVBRChGV19C
TENfU0VMRikgJiBGV19CTENfU0VMRl9FTjsKIAotCWZvcl9lYWNoX2ludGVsX2NydGMoJmRldl9w
cml2LT5kcm0sIGNydGMpIHsKKwlmb3JfZWFjaF9pbnRlbF9jcnRjKCZpOTE1LT5kcm0sIGNydGMp
IHsKIAkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQogCQkJdG9faW50ZWxf
Y3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAkJc3RydWN0IGc0eF93bV9zdGF0ZSAqYWN0
aXZlID0gJmNydGMtPndtLmFjdGl2ZS5nNHg7CkBAIC02MDcxLDE2ICs2MDcxLDE2IEBAIHZvaWQg
ZzR4X3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
CSAgICAgIHllc25vKHdtLT5jeHNyKSwgeWVzbm8od20tPmhwbGxfZW4pLCB5ZXNubyh3bS0+ZmJj
X2VuKSk7CiB9CiAKLXZvaWQgZzR4X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK3ZvaWQgZzR4X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CiAJc3RydWN0IGludGVsX2Ny
dGMgKmNydGM7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+d20ud21fbXV0ZXgpOworCW11dGV4
X2xvY2soJmk5MTUtPndtLndtX211dGV4KTsKIAotCWZvcl9lYWNoX2ludGVsX3BsYW5lKCZkZXZf
cHJpdi0+ZHJtLCBwbGFuZSkgeworCWZvcl9lYWNoX2ludGVsX3BsYW5lKCZpOTE1LT5kcm0sIHBs
YW5lKSB7CiAJCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0KLQkJCWludGVsX2dldF9jcnRjX2Zv
cl9waXBlKGRldl9wcml2LCBwbGFuZS0+cGlwZSk7CisJCQlpbnRlbF9nZXRfY3J0Y19mb3JfcGlw
ZShpOTE1LCBwbGFuZS0+cGlwZSk7CiAJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlID0KIAkJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAJCXN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQpAQCAtNjExMyw3ICs2MTEzLDcgQEAg
dm9pZCBnNHhfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CQl9CiAJfQogCi0JZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0Yykgewor
CWZvcl9lYWNoX2ludGVsX2NydGMoJmk5MTUtPmRybSwgY3J0YykgewogCQlzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CiAJCQl0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJh
c2Uuc3RhdGUpOwogCkBAIC02MTIyLDI2ICs2MTIyLDI2IEBAIHZvaWQgZzR4X3dtX3Nhbml0aXpl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJY3J0Yy0+d20uYWN0aXZlLmc0
eCA9IGNydGNfc3RhdGUtPndtLmc0eC5vcHRpbWFsOwogCX0KIAotCWc0eF9wcm9ncmFtX3dhdGVy
bWFya3MoZGV2X3ByaXYpOworCWc0eF9wcm9ncmFtX3dhdGVybWFya3MoaTkxNSk7CiAKLQltdXRl
eF91bmxvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT53
bS53bV9tdXRleCk7CiB9CiAKLXZvaWQgdmx2X3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIHZsdl93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IHZsdl93bV92YWx1ZXMgKndtID0gJmRl
dl9wcml2LT53bS52bHY7CisJc3RydWN0IHZsdl93bV92YWx1ZXMgKndtID0gJmk5MTUtPndtLnZs
djsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAl1MzIgdmFsOwogCi0Jdmx2X3JlYWRfd21f
dmFsdWVzKGRldl9wcml2LCB3bSk7CisJdmx2X3JlYWRfd21fdmFsdWVzKGk5MTUsIHdtKTsKIAog
CXdtLT5jeHNyID0gSTkxNV9SRUFEKEZXX0JMQ19TRUxGX1ZMVikgJiBGV19DU1BXUkRXTkVOOwog
CXdtLT5sZXZlbCA9IFZMVl9XTV9MRVZFTF9QTTI7CiAKLQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZf
cHJpdikpIHsKLQkJdmx2X3B1bml0X2dldChkZXZfcHJpdik7CisJaWYgKElTX0NIRVJSWVZJRVco
aTkxNSkpIHsKKwkJdmx2X3B1bml0X2dldChpOTE1KTsKIAotCQl2YWwgPSB2bHZfcHVuaXRfcmVh
ZChkZXZfcHJpdiwgUFVOSVRfUkVHX0RTUFNTUE0pOworCQl2YWwgPSB2bHZfcHVuaXRfcmVhZChp
OTE1LCBQVU5JVF9SRUdfRFNQU1NQTSk7CiAJCWlmICh2YWwgJiBEU1BfTUFYRklGT19QTTVfRU5B
QkxFKQogCQkJd20tPmxldmVsID0gVkxWX1dNX0xFVkVMX1BNNTsKIApAQCAtNjE1NCwyNSArNjE1
NCwyNSBAQCB2b2lkIHZsdl93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCQkgKiBISUdIL0xPVyBiaXRzIHNvIHRoYXQgd2UgZG9uJ3QgYWN0dWFsbHkg
Y2hhbmdlCiAJCSAqIHRoZSBjdXJyZW50IHN0YXRlLgogCQkgKi8KLQkJdmFsID0gdmx2X3B1bml0
X3JlYWQoZGV2X3ByaXYsIFBVTklUX1JFR19ERFJfU0VUVVAyKTsKKwkJdmFsID0gdmx2X3B1bml0
X3JlYWQoaTkxNSwgUFVOSVRfUkVHX0REUl9TRVRVUDIpOwogCQl2YWwgfD0gRk9SQ0VfRERSX0ZS
RVFfUkVRX0FDSzsKLQkJdmx2X3B1bml0X3dyaXRlKGRldl9wcml2LCBQVU5JVF9SRUdfRERSX1NF
VFVQMiwgdmFsKTsKKwkJdmx2X3B1bml0X3dyaXRlKGk5MTUsIFBVTklUX1JFR19ERFJfU0VUVVAy
LCB2YWwpOwogCi0JCWlmICh3YWl0X2Zvcigodmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBVTklU
X1JFR19ERFJfU0VUVVAyKSAmCisJCWlmICh3YWl0X2Zvcigodmx2X3B1bml0X3JlYWQoaTkxNSwg
UFVOSVRfUkVHX0REUl9TRVRVUDIpICYKIAkJCSAgICAgIEZPUkNFX0REUl9GUkVRX1JFUV9BQ0sp
ID09IDAsIDMpKSB7CiAJCQlEUk1fREVCVUdfS01TKCJQdW5pdCBub3QgYWNraW5nIEREUiBEVkZT
IHJlcXVlc3QsICIKIAkJCQkgICAgICAiYXNzdW1pbmcgRERSIERWRlMgaXMgZGlzYWJsZWRcbiIp
OwotCQkJZGV2X3ByaXYtPndtLm1heF9sZXZlbCA9IFZMVl9XTV9MRVZFTF9QTTU7CisJCQlpOTE1
LT53bS5tYXhfbGV2ZWwgPSBWTFZfV01fTEVWRUxfUE01OwogCQl9IGVsc2UgewotCQkJdmFsID0g
dmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBVTklUX1JFR19ERFJfU0VUVVAyKTsKKwkJCXZhbCA9
IHZsdl9wdW5pdF9yZWFkKGk5MTUsIFBVTklUX1JFR19ERFJfU0VUVVAyKTsKIAkJCWlmICgodmFs
ICYgRk9SQ0VfRERSX0hJR0hfRlJFUSkgPT0gMCkKIAkJCQl3bS0+bGV2ZWwgPSBWTFZfV01fTEVW
RUxfRERSX0RWRlM7CiAJCX0KIAotCQl2bHZfcHVuaXRfcHV0KGRldl9wcml2KTsKKwkJdmx2X3B1
bml0X3B1dChpOTE1KTsKIAl9CiAKLQlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJt
LCBjcnRjKSB7CisJZm9yX2VhY2hfaW50ZWxfY3J0YygmaTkxNS0+ZHJtLCBjcnRjKSB7CiAJCXN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0KIAkJCXRvX2ludGVsX2NydGNfc3Rh
dGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAJCXN0cnVjdCB2bHZfd21fc3RhdGUgKmFjdGl2ZSA9ICZj
cnRjLT53bS5hY3RpdmUudmx2OwpAQCAtNjIyNCwxNiArNjIyNCwxNiBAQCB2b2lkIHZsdl93bV9n
ZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgICAgICB3
bS0+c3IucGxhbmUsIHdtLT5zci5jdXJzb3IsIHdtLT5sZXZlbCwgd20tPmN4c3IpOwogfQogCi12
b2lkIHZsdl93bV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2
b2lkIHZsdl93bV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCi0J
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPndtLndtX211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT53
bS53bV9tdXRleCk7CiAKLQlmb3JfZWFjaF9pbnRlbF9wbGFuZSgmZGV2X3ByaXYtPmRybSwgcGxh
bmUpIHsKKwlmb3JfZWFjaF9pbnRlbF9wbGFuZSgmaTkxNS0+ZHJtLCBwbGFuZSkgewogCQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9Ci0JCQlpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJp
diwgcGxhbmUtPnBpcGUpOworCQkJaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoaTkxNSwgcGxhbmUt
PnBpcGUpOwogCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CiAJCQl0b19p
bnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCQlzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlID0KQEAgLTYyNTksNyArNjI1OSw3IEBAIHZvaWQgdmx2X3dtX3Nh
bml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJfQogCX0KIAotCWZv
cl9lYWNoX2ludGVsX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMpIHsKKwlmb3JfZWFjaF9pbnRl
bF9jcnRjKCZpOTE1LT5kcm0sIGNydGMpIHsKIAkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUgPQogCQkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIApA
QCAtNjI2OCwxNiArNjI2OCwxNiBAQCB2b2lkIHZsdl93bV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWNydGMtPndtLmFjdGl2ZS52bHYgPSBjcnRjX3N0YXRl
LT53bS52bHYub3B0aW1hbDsKIAl9CiAKLQl2bHZfcHJvZ3JhbV93YXRlcm1hcmtzKGRldl9wcml2
KTsKKwl2bHZfcHJvZ3JhbV93YXRlcm1hcmtzKGk5MTUpOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+d20ud21fbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+d20ud21fbXV0ZXgpOwog
fQogCiAvKgogICogRklYTUUgc2hvdWxkIHByb2JhYmx5IGtpbGwgdGhpcyBhbmQgaW1wcm92ZQog
ICogdGhlIHJlYWwgd2F0ZXJtYXJrIHJlYWRvdXQvc2FuaXRhdGlvbiBpbnN0ZWFkCiAgKi8KLXN0
YXRpYyB2b2lkIGlsa19pbml0X2xwX3dhdGVybWFya3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHZvaWQgaWxrX2luaXRfbHBfd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlJOTE1X1dSSVRFKFdNM19MUF9JTEssIEk5MTVfUkVB
RChXTTNfTFBfSUxLKSAmIH5XTTFfTFBfU1JfRU4pOwogCUk5MTVfV1JJVEUoV00yX0xQX0lMSywg
STkxNV9SRUFEKFdNMl9MUF9JTEspICYgfldNMV9MUF9TUl9FTik7CkBAIC02Mjg5LDE0ICs2Mjg5
LDE0IEBAIHN0YXRpYyB2b2lkIGlsa19pbml0X2xwX3dhdGVybWFya3Moc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCSAqLwogfQogCi12b2lkIGlsa193bV9nZXRfaHdfc3RhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbGtfd21fZ2V0X2h3X3N0
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbGtfd21fdmFs
dWVzICpodyA9ICZkZXZfcHJpdi0+d20uaHc7CisJc3RydWN0IGlsa193bV92YWx1ZXMgKmh3ID0g
Jmk5MTUtPndtLmh3OwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCi0JaWxrX2luaXRfbHBf
d2F0ZXJtYXJrcyhkZXZfcHJpdik7CisJaWxrX2luaXRfbHBfd2F0ZXJtYXJrcyhpOTE1KTsKIAot
CWZvcl9lYWNoX2ludGVsX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMpCisJZm9yX2VhY2hfaW50
ZWxfY3J0YygmaTkxNS0+ZHJtLCBjcnRjKQogCQlpbGtfcGlwZV93bV9nZXRfaHdfc3RhdGUoY3J0
Yyk7CiAKIAlody0+d21fbHBbMF0gPSBJOTE1X1JFQUQoV00xX0xQX0lMSyk7CkBAIC02MzA0LDE1
ICs2MzA0LDE1IEBAIHZvaWQgaWxrX3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJaHctPndtX2xwWzJdID0gSTkxNV9SRUFEKFdNM19MUF9JTEspOwog
CiAJaHctPndtX2xwX3NwclswXSA9IEk5MTVfUkVBRChXTTFTX0xQX0lMSyk7Ci0JaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gNykgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNykgewogCQlo
dy0+d21fbHBfc3ByWzFdID0gSTkxNV9SRUFEKFdNMlNfTFBfSVZCKTsKIAkJaHctPndtX2xwX3Nw
clsyXSA9IEk5MTVfUkVBRChXTTNTX0xQX0lWQik7CiAJfQogCi0JaWYgKElTX0hBU1dFTEwoZGV2
X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJaWYgKElTX0hBU1dFTEwoaTkxNSkg
fHwgSVNfQlJPQURXRUxMKGk5MTUpKQogCQlody0+cGFydGl0aW9uaW5nID0gKEk5MTVfUkVBRChX
TV9NSVNDKSAmIFdNX01JU0NfREFUQV9QQVJUSVRJT05fNV82KSA/CiAJCQlJTlRFTF9EREJfUEFS
VF81XzYgOiBJTlRFTF9EREJfUEFSVF8xXzI7Ci0JZWxzZSBpZiAoSVNfSVZZQlJJREdFKGRldl9w
cml2KSkKKwllbHNlIGlmIChJU19JVllCUklER0UoaTkxNSkpCiAJCWh3LT5wYXJ0aXRpb25pbmcg
PSAoSTkxNV9SRUFEKERJU1BfQVJCX0NUTDIpICYgRElTUF9EQVRBX1BBUlRJVElPTl81XzYpID8K
IAkJCUlOVEVMX0REQl9QQVJUXzVfNiA6IElOVEVMX0REQl9QQVJUXzFfMjsKIApAQCAtNjM1NSwy
MiArNjM1NSwyMiBAQCB2b2lkIGlsa193bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogICovCiB2b2lkIGludGVsX3VwZGF0ZV93YXRlcm1hcmtzKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAKLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXku
dXBkYXRlX3dtKQotCQlkZXZfcHJpdi0+ZGlzcGxheS51cGRhdGVfd20oY3J0Yyk7CisJaWYgKGk5
MTUtPmRpc3BsYXkudXBkYXRlX3dtKQorCQlpOTE1LT5kaXNwbGF5LnVwZGF0ZV93bShjcnRjKTsK
IH0KIAotdm9pZCBpbnRlbF9lbmFibGVfaXBjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3ZvaWQgaW50ZWxfZW5hYmxlX2lwYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAl1MzIgdmFsOwogCi0JaWYgKCFIQVNfSVBDKGRldl9wcml2KSkKKwlpZiAoIUhBU19J
UEMoaTkxNSkpCiAJCXJldHVybjsKIAogCXZhbCA9IEk5MTVfUkVBRChESVNQX0FSQl9DVEwyKTsK
IAotCWlmIChkZXZfcHJpdi0+aXBjX2VuYWJsZWQpCisJaWYgKGk5MTUtPmlwY19lbmFibGVkKQog
CQl2YWwgfD0gRElTUF9JUENfRU5BQkxFOwogCWVsc2UKIAkJdmFsICY9IH5ESVNQX0lQQ19FTkFC
TEU7CkBAIC02Mzc4LDI3ICs2Mzc4LDI3IEBAIHZvaWQgaW50ZWxfZW5hYmxlX2lwYyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShESVNQX0FSQl9DVEwyLCB2
YWwpOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9jYW5fZW5hYmxlX2lwYyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBpbnRlbF9jYW5fZW5hYmxlX2lwYyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAkvKiBEaXNwbGF5IFdBICMwNDc3IFdh
RGlzYWJsZUlQQzogc2tsICovCi0JaWYgKElTX1NLWUxBS0UoZGV2X3ByaXYpKQorCWlmIChJU19T
S1lMQUtFKGk5MTUpKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKiBEaXNwbGF5IFdBICMxMTQxOiBT
S0w6YWxsIEtCTDphbGwgQ0ZMICovCi0JaWYgKElTX0tBQllMQUtFKGRldl9wcml2KSB8fCBJU19D
T0ZGRUVMQUtFKGRldl9wcml2KSkKLQkJcmV0dXJuIGRldl9wcml2LT5kcmFtX2luZm8uc3ltbWV0
cmljX21lbW9yeTsKKwlpZiAoSVNfS0FCWUxBS0UoaTkxNSkgfHwgSVNfQ09GRkVFTEFLRShpOTE1
KSkKKwkJcmV0dXJuIGk5MTUtPmRyYW1faW5mby5zeW1tZXRyaWNfbWVtb3J5OwogCiAJcmV0dXJu
IHRydWU7CiB9CiAKLXZvaWQgaW50ZWxfaW5pdF9pcGMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQordm9pZCBpbnRlbF9pbml0X2lwYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlpZiAoIUhBU19JUEMoZGV2X3ByaXYpKQorCWlmICghSEFTX0lQQyhpOTE1KSkK
IAkJcmV0dXJuOwogCi0JZGV2X3ByaXYtPmlwY19lbmFibGVkID0gaW50ZWxfY2FuX2VuYWJsZV9p
cGMoZGV2X3ByaXYpOworCWk5MTUtPmlwY19lbmFibGVkID0gaW50ZWxfY2FuX2VuYWJsZV9pcGMo
aTkxNSk7CiAKLQlpbnRlbF9lbmFibGVfaXBjKGRldl9wcml2KTsKKwlpbnRlbF9lbmFibGVfaXBj
KGk5MTUpOwogfQogCiAvKgpAQCAtNjQzMCw5ICs2NDMwLDkgQEAgYm9vbCBpcm9ubGFrZV9zZXRf
ZHJwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTggdmFsKQogCXJldHVybiB0cnVl
OwogfQogCi1zdGF0aWMgdm9pZCBpcm9ubGFrZV9lbmFibGVfZHJwcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpcm9ubGFrZV9lbmFibGVfZHJwcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNv
cmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAm
aTkxNS0+dW5jb3JlOwogCXUzMiByZ3Ztb2RlY3RsOwogCXU4IGZtYXgsIGZtaW4sIGZzdGFydCwg
dnN0YXJ0OwogCkBAIC02NDYzLDEyICs2NDYzLDEyIEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2Vu
YWJsZV9kcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl2c3RhcnQgPSAo
aW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBQWFZGUkVRKGZzdGFydCkpICYKIAkJICBQWFZGUkVR
X1BYX01BU0spID4+IFBYVkZSRVFfUFhfU0hJRlQ7CiAKLQlkZXZfcHJpdi0+aXBzLmZtYXggPSBm
bWF4OyAvKiBJUFMgY2FsbGJhY2sgd2lsbCBpbmNyZWFzZSB0aGlzICovCi0JZGV2X3ByaXYtPmlw
cy5mc3RhcnQgPSBmc3RhcnQ7CisJaTkxNS0+aXBzLmZtYXggPSBmbWF4OyAvKiBJUFMgY2FsbGJh
Y2sgd2lsbCBpbmNyZWFzZSB0aGlzICovCisJaTkxNS0+aXBzLmZzdGFydCA9IGZzdGFydDsKIAot
CWRldl9wcml2LT5pcHMubWF4X2RlbGF5ID0gZnN0YXJ0OwotCWRldl9wcml2LT5pcHMubWluX2Rl
bGF5ID0gZm1pbjsKLQlkZXZfcHJpdi0+aXBzLmN1cl9kZWxheSA9IGZzdGFydDsKKwlpOTE1LT5p
cHMubWF4X2RlbGF5ID0gZnN0YXJ0OworCWk5MTUtPmlwcy5taW5fZGVsYXkgPSBmbWluOworCWk5
MTUtPmlwcy5jdXJfZGVsYXkgPSBmc3RhcnQ7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCJmbWF4OiAl
ZCwgZm1pbjogJWQsIGZzdGFydDogJWRcbiIsCiAJCQkgZm1heCwgZm1pbiwgZnN0YXJ0KTsKQEAg
LTY0OTIsMTUgKzY0OTIsMTUgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfZW5hYmxlX2RycHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlEUk1fRVJST1IoInN0dWNrIHRyeWlu
ZyB0byBjaGFuZ2UgcGVyZiBtb2RlXG4iKTsKIAltZGVsYXkoMSk7CiAKLQlpcm9ubGFrZV9zZXRf
ZHJwcyhkZXZfcHJpdiwgZnN0YXJ0KTsKKwlpcm9ubGFrZV9zZXRfZHJwcyhpOTE1LCBmc3RhcnQp
OwogCi0JZGV2X3ByaXYtPmlwcy5sYXN0X2NvdW50MSA9CisJaTkxNS0+aXBzLmxhc3RfY291bnQx
ID0KIAkJaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBETUlFQykgKwogCQlpbnRlbF91bmNvcmVf
cmVhZCh1bmNvcmUsIEREUkVDKSArCiAJCWludGVsX3VuY29yZV9yZWFkKHVuY29yZSwgQ1NJRUMp
OwotCWRldl9wcml2LT5pcHMubGFzdF90aW1lMSA9IGppZmZpZXNfdG9fbXNlY3MoamlmZmllcyk7
Ci0JZGV2X3ByaXYtPmlwcy5sYXN0X2NvdW50MiA9IGludGVsX3VuY29yZV9yZWFkKHVuY29yZSwg
R0ZYRUMpOwotCWRldl9wcml2LT5pcHMubGFzdF90aW1lMiA9IGt0aW1lX2dldF9yYXdfbnMoKTsK
KwlpOTE1LT5pcHMubGFzdF90aW1lMSA9IGppZmZpZXNfdG9fbXNlY3MoamlmZmllcyk7CisJaTkx
NS0+aXBzLmxhc3RfY291bnQyID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBHRlhFQyk7CisJ
aTkxNS0+aXBzLmxhc3RfdGltZTIgPSBrdGltZV9nZXRfcmF3X25zKCk7CiAKIAlzcGluX3VubG9j
a19pcnEoJm1jaGRldl9sb2NrKTsKIH0KQEAgLTY1NDMsOSArNjU0Myw5IEBAIHN0YXRpYyB2b2lk
IGlyb25sYWtlX2Rpc2FibGVfZHJwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKICAq
IG91cnNlbHZlcywgaW5zdGVhZCBvZiBkb2luZyBhIHJtdyBjeWNsZSAod2hpY2ggbWlnaHQgcmVz
dWx0IGluIHVzIGNsZWFyaW5nCiAgKiBhbGwgbGltaXRzIGFuZCB0aGUgZ3B1IHN0dWNrIGF0IHdo
YXRldmVyIGZyZXF1ZW5jeSBpdCBpcyBhdCBhdG0pLgogICovCi1zdGF0aWMgdTMyIGludGVsX3Jw
c19saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCB2YWwpCitzdGF0
aWMgdTMyIGludGVsX3Jwc19saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU4
IHZhbCkKIHsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsK
KwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCXUzMiBsaW1pdHM7
CiAKIAkvKiBPbmx5IHNldCB0aGUgZG93biBsaW1pdCB3aGVuIHdlJ3ZlIHJlYWNoZWQgdGhlIGxv
d2VzdCBsZXZlbCB0byBhdm9pZApAQCAtNjU1NCw3ICs2NTU0LDcgQEAgc3RhdGljIHUzMiBpbnRl
bF9ycHNfbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggdmFsKQog
CSAqIHRoZSBodyBydW5zIGF0IHRoZSBtaW5pbWFsIGNsb2NrIGJlZm9yZSBzZWxlY3RpbmcgdGhl
IGRlc2lyZWQKIAkgKiBmcmVxdWVuY3ksIGlmIHRoZSBkb3duIHRocmVzaG9sZCBleHBpcmVzIGlu
IHRoYXQgd2luZG93IHdlIHdpbGwgbm90CiAJICogcmVjZWl2ZSBhIGRvd24gaW50ZXJydXB0LiAq
LwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDkpIHsKIAkJbGltaXRzID0gKHJwcy0+bWF4X2ZyZXFfc29mdGxpbWl0KSA8PCAyMzsKIAkJ
aWYgKHZhbCA8PSBycHMtPm1pbl9mcmVxX3NvZnRsaW1pdCkKIAkJCWxpbWl0cyB8PSAocnBzLT5t
aW5fZnJlcV9zb2Z0bGltaXQpIDw8IDE0OwpAQCAtNjU2Nyw5ICs2NTY3LDkgQEAgc3RhdGljIHUz
MiBpbnRlbF9ycHNfbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTgg
dmFsKQogCXJldHVybiBsaW1pdHM7CiB9CiAKLXN0YXRpYyB2b2lkIHJwc19zZXRfcG93ZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgbmV3X3Bvd2VyKQorc3RhdGljIHZv
aWQgcnBzX3NldF9wb3dlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IG5ld19w
b3dlcikKIHsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsK
KwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCXUzMiB0aHJlc2hv
bGRfdXAgPSAwLCB0aHJlc2hvbGRfZG93biA9IDA7IC8qIGluICUgKi8KIAl1MzIgZWlfdXAgPSAw
LCBlaV9kb3duID0gMDsKIApAQCAtNjYxNCwyMyArNjYxNCwyMyBAQCBzdGF0aWMgdm9pZCBycHNf
c2V0X3Bvd2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50IG5ld19wb3dl
cikKIAkvKiBXaGVuIGJ5dCBjYW4gc3Vydml2ZSB3aXRob3V0IHN5c3RlbSBoYW5nIHdpdGggZHlu
YW1pYwogCSAqIHN3IGZyZXEgYWRqdXN0bWVudHMsIHRoaXMgcmVzdHJpY3Rpb24gY2FuIGJlIGxp
ZnRlZC4KIAkgKi8KLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCisJaWYgKElTX1ZBTExF
WVZJRVcoaTkxNSkpCiAJCWdvdG8gc2tpcF9od193cml0ZTsKIAogCUk5MTVfV1JJVEUoR0VONl9S
UF9VUF9FSSwKLQkJICAgR1RfSU5URVJWQUxfRlJPTV9VUyhkZXZfcHJpdiwgZWlfdXApKTsKKwkJ
ICAgR1RfSU5URVJWQUxfRlJPTV9VUyhpOTE1LCBlaV91cCkpOwogCUk5MTVfV1JJVEUoR0VONl9S
UF9VUF9USFJFU0hPTEQsCi0JCSAgIEdUX0lOVEVSVkFMX0ZST01fVVMoZGV2X3ByaXYsCisJCSAg
IEdUX0lOVEVSVkFMX0ZST01fVVMoaTkxNSwKIAkJCQkgICAgICAgZWlfdXAgKiB0aHJlc2hvbGRf
dXAgLyAxMDApKTsKIAogCUk5MTVfV1JJVEUoR0VONl9SUF9ET1dOX0VJLAotCQkgICBHVF9JTlRF
UlZBTF9GUk9NX1VTKGRldl9wcml2LCBlaV9kb3duKSk7CisJCSAgIEdUX0lOVEVSVkFMX0ZST01f
VVMoaTkxNSwgZWlfZG93bikpOwogCUk5MTVfV1JJVEUoR0VONl9SUF9ET1dOX1RIUkVTSE9MRCwK
LQkJICAgR1RfSU5URVJWQUxfRlJPTV9VUyhkZXZfcHJpdiwKKwkJICAgR1RfSU5URVJWQUxfRlJP
TV9VUyhpOTE1LAogCQkJCSAgICAgICBlaV9kb3duICogdGhyZXNob2xkX2Rvd24gLyAxMDApKTsK
IAogCUk5MTVfV1JJVEUoR0VONl9SUF9DT05UUk9MLAotCQkgICAoSU5URUxfR0VOKGRldl9wcml2
KSA+IDkgPyAwIDogR0VONl9SUF9NRURJQV9UVVJCTykgfAorCQkgICAoSU5URUxfR0VOKGk5MTUp
ID4gOSA/IDAgOiBHRU42X1JQX01FRElBX1RVUkJPKSB8CiAJCSAgIEdFTjZfUlBfTUVESUFfSFdf
Tk9STUFMX01PREUgfAogCQkgICBHRU42X1JQX01FRElBX0lTX0dGWCB8CiAJCSAgIEdFTjZfUlBf
RU5BQkxFIHwKQEAgLTY2NDMsOSArNjY0Myw5IEBAIHN0YXRpYyB2b2lkIHJwc19zZXRfcG93ZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgbmV3X3Bvd2VyKQogCXJwcy0+
cG93ZXIuZG93bl90aHJlc2hvbGQgPSB0aHJlc2hvbGRfZG93bjsKIH0KIAotc3RhdGljIHZvaWQg
Z2VuNl9zZXRfcnBzX3RocmVzaG9sZHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCB1OCB2YWwpCitzdGF0aWMgdm9pZCBnZW42X3NldF9ycHNfdGhyZXNob2xkcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTggdmFsKQogewotCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9
ICZkZXZfcHJpdi0+Z3RfcG0ucnBzOworCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZpOTE1LT5n
dF9wbS5ycHM7CiAJaW50IG5ld19wb3dlcjsKIAogCW5ld19wb3dlciA9IHJwcy0+cG93ZXIubW9k
ZTsKQEAgLTY2ODAsNyArNjY4MCw3IEBAIHN0YXRpYyB2b2lkIGdlbjZfc2V0X3Jwc190aHJlc2hv
bGRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggdmFsKQogCW11dGV4X2xv
Y2soJnJwcy0+cG93ZXIubXV0ZXgpOwogCWlmIChycHMtPnBvd2VyLmludGVyYWN0aXZlKQogCQlu
ZXdfcG93ZXIgPSBISUdIX1BPV0VSOwotCXJwc19zZXRfcG93ZXIoZGV2X3ByaXYsIG5ld19wb3dl
cik7CisJcnBzX3NldF9wb3dlcihpOTE1LCBuZXdfcG93ZXIpOwogCW11dGV4X3VubG9jaygmcnBz
LT5wb3dlci5tdXRleCk7CiB9CiAKQEAgLTY3MDIsOSArNjcwMiw5IEBAIHZvaWQgaW50ZWxfcnBz
X21hcmtfaW50ZXJhY3RpdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGJvb2wgaW50
ZXJhY3RpdmUpCiAJbXV0ZXhfdW5sb2NrKCZycHMtPnBvd2VyLm11dGV4KTsKIH0KIAotc3RhdGlj
IHUzMiBnZW42X3Jwc19wbV9tYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dTggdmFsKQorc3RhdGljIHUzMiBnZW42X3Jwc19wbV9tYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCB1OCB2YWwpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2
LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsK
IAl1MzIgbWFzayA9IDA7CiAKIAkvKiBXZSB1c2UgVVBfRUlfRVhQSVJFRCBpbnRlcnVwdHMgZm9y
IGJvdGggdXAvZG93biBpbiBtYW51YWwgbW9kZSAqLwpAQCAtNjcxMywyOCArNjcxMywyOCBAQCBz
dGF0aWMgdTMyIGdlbjZfcnBzX3BtX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCB1OCB2YWwpCiAJaWYgKHZhbCA8IHJwcy0+bWF4X2ZyZXFfc29mdGxpbWl0KQogCQltYXNr
IHw9IEdFTjZfUE1fUlBfVVBfRUlfRVhQSVJFRCB8IEdFTjZfUE1fUlBfVVBfVEhSRVNIT0xEOwog
Ci0JbWFzayAmPSBkZXZfcHJpdi0+cG1fcnBzX2V2ZW50czsKKwltYXNrICY9IGk5MTUtPnBtX3Jw
c19ldmVudHM7CiAKLQlyZXR1cm4gZ2VuNl9zYW5pdGl6ZV9ycHNfcG1fbWFzayhkZXZfcHJpdiwg
fm1hc2spOworCXJldHVybiBnZW42X3Nhbml0aXplX3Jwc19wbV9tYXNrKGk5MTUsIH5tYXNrKTsK
IH0KIAogLyogZ2VuNl9zZXRfcnBzIGlzIGNhbGxlZCB0byB1cGRhdGUgdGhlIGZyZXF1ZW5jeSBy
ZXF1ZXN0LCBidXQgc2hvdWxkIGFsc28gYmUKICAqIGNhbGxlZCB3aGVuIHRoZSByYW5nZSAobWlu
X2RlbGF5IGFuZCBtYXhfZGVsYXkpIGlzIG1vZGlmaWVkIHNvIHRoYXQgd2UgY2FuCiAgKiB1cGRh
dGUgdGhlIEdFTjZfUlBfSU5URVJSVVBUX0xJTUlUUyByZWdpc3RlciBhY2NvcmRpbmdseS4gKi8K
LXN0YXRpYyBpbnQgZ2VuNl9zZXRfcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgdTggdmFsKQorc3RhdGljIGludCBnZW42X3NldF9ycHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIHU4IHZhbCkKIHsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYt
Pmd0X3BtLnJwczsKKwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwog
CiAJLyogbWluL21heCBkZWxheSBtYXkgc3RpbGwgaGF2ZSBiZWVuIG1vZGlmaWVkIHNvIGJlIHN1
cmUgdG8KIAkgKiB3cml0ZSB0aGUgbGltaXRzIHZhbHVlLgogCSAqLwogCWlmICh2YWwgIT0gcnBz
LT5jdXJfZnJlcSkgewotCQlnZW42X3NldF9ycHNfdGhyZXNob2xkcyhkZXZfcHJpdiwgdmFsKTsK
KwkJZ2VuNl9zZXRfcnBzX3RocmVzaG9sZHMoaTkxNSwgdmFsKTsKIAotCQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA5KQorCQlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpCiAJCQlJOTE1X1dS
SVRFKEdFTjZfUlBOU1dSRVEsCiAJCQkJICAgR0VOOV9GUkVRVUVOQ1kodmFsKSk7Ci0JCWVsc2Ug
aWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJCWVs
c2UgaWYgKElTX0hBU1dFTEwoaTkxNSkgfHwgSVNfQlJPQURXRUxMKGk5MTUpKQogCQkJSTkxNV9X
UklURShHRU42X1JQTlNXUkVRLAogCQkJCSAgIEhTV19GUkVRVUVOQ1kodmFsKSk7CiAJCWVsc2UK
QEAgLTY3NDcsMzcgKzY3NDcsMzcgQEAgc3RhdGljIGludCBnZW42X3NldF9ycHMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCB2YWwpCiAJLyogTWFrZSBzdXJlIHdlIGNvbnRp
bnVlIHRvIGdldCBpbnRlcnJ1cHRzCiAJICogdW50aWwgd2UgaGl0IHRoZSBtaW5pbXVtIG9yIG1h
eGltdW0gZnJlcXVlbmNpZXMuCiAJICovCi0JSTkxNV9XUklURShHRU42X1JQX0lOVEVSUlVQVF9M
SU1JVFMsIGludGVsX3Jwc19saW1pdHMoZGV2X3ByaXYsIHZhbCkpOwotCUk5MTVfV1JJVEUoR0VO
Nl9QTUlOVFJNU0ssIGdlbjZfcnBzX3BtX21hc2soZGV2X3ByaXYsIHZhbCkpOworCUk5MTVfV1JJ
VEUoR0VONl9SUF9JTlRFUlJVUFRfTElNSVRTLCBpbnRlbF9ycHNfbGltaXRzKGk5MTUsIHZhbCkp
OworCUk5MTVfV1JJVEUoR0VONl9QTUlOVFJNU0ssIGdlbjZfcnBzX3BtX21hc2soaTkxNSwgdmFs
KSk7CiAKIAlycHMtPmN1cl9mcmVxID0gdmFsOwotCXRyYWNlX2ludGVsX2dwdV9mcmVxX2NoYW5n
ZShpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwgdmFsKSk7CisJdHJhY2VfaW50ZWxfZ3B1X2ZyZXFf
Y2hhbmdlKGludGVsX2dwdV9mcmVxKGk5MTUsIHZhbCkpOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0
YXRpYyBpbnQgdmFsbGV5dmlld19zZXRfcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgdTggdmFsKQorc3RhdGljIGludCB2YWxsZXl2aWV3X3NldF9ycHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIHU4IHZhbCkKIHsKIAlpbnQgZXJyOwogCi0JaWYgKFdBUk5fT05D
RShJU19DSEVSUllWSUVXKGRldl9wcml2KSAmJiAodmFsICYgMSksCisJaWYgKFdBUk5fT05DRShJ
U19DSEVSUllWSUVXKGk5MTUpICYmICh2YWwgJiAxKSwKIAkJICAgICAgIk9kZCBHUFUgZnJlcSB2
YWx1ZVxuIikpCiAJCXZhbCAmPSB+MTsKIAotCUk5MTVfV1JJVEUoR0VONl9QTUlOVFJNU0ssIGdl
bjZfcnBzX3BtX21hc2soZGV2X3ByaXYsIHZhbCkpOworCUk5MTVfV1JJVEUoR0VONl9QTUlOVFJN
U0ssIGdlbjZfcnBzX3BtX21hc2soaTkxNSwgdmFsKSk7CiAKLQlpZiAodmFsICE9IGRldl9wcml2
LT5ndF9wbS5ycHMuY3VyX2ZyZXEpIHsKLQkJdmx2X3B1bml0X2dldChkZXZfcHJpdik7Ci0JCWVy
ciA9IHZsdl9wdW5pdF93cml0ZShkZXZfcHJpdiwgUFVOSVRfUkVHX0dQVV9GUkVRX1JFUSwgdmFs
KTsKLQkJdmx2X3B1bml0X3B1dChkZXZfcHJpdik7CisJaWYgKHZhbCAhPSBpOTE1LT5ndF9wbS5y
cHMuY3VyX2ZyZXEpIHsKKwkJdmx2X3B1bml0X2dldChpOTE1KTsKKwkJZXJyID0gdmx2X3B1bml0
X3dyaXRlKGk5MTUsIFBVTklUX1JFR19HUFVfRlJFUV9SRVEsIHZhbCk7CisJCXZsdl9wdW5pdF9w
dXQoaTkxNSk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOwogCi0JCWdlbjZfc2V0X3Jwc190
aHJlc2hvbGRzKGRldl9wcml2LCB2YWwpOworCQlnZW42X3NldF9ycHNfdGhyZXNob2xkcyhpOTE1
LCB2YWwpOwogCX0KIAotCWRldl9wcml2LT5ndF9wbS5ycHMuY3VyX2ZyZXEgPSB2YWw7Ci0JdHJh
Y2VfaW50ZWxfZ3B1X2ZyZXFfY2hhbmdlKGludGVsX2dwdV9mcmVxKGRldl9wcml2LCB2YWwpKTsK
KwlpOTE1LT5ndF9wbS5ycHMuY3VyX2ZyZXEgPSB2YWw7CisJdHJhY2VfaW50ZWxfZ3B1X2ZyZXFf
Y2hhbmdlKGludGVsX2dwdV9mcmVxKGk5MTUsIHZhbCkpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC02
Nzg5LDkgKzY3ODksOSBAQCBzdGF0aWMgaW50IHZhbGxleXZpZXdfc2V0X3JwcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4IHZhbCkKICAqIDIuIFJlcXVlc3QgaWRsZSBmcmVx
LgogICogMy4gUmVsZWFzZSBGb3JjZXdha2Ugb2YgTWVkaWEgd2VsbC4KICovCi1zdGF0aWMgdm9p
ZCB2bHZfc2V0X3Jwc19pZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0
YXRpYyB2b2lkIHZsdl9zZXRfcnBzX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3Ry
dWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAl1MzIgdmFsID0gcnBzLT5p
ZGxlX2ZyZXE7CiAJaW50IGVycjsKIApAQCAtNjgxMCwyOCArNjgxMCwyOCBAQCBzdGF0aWMgdm9p
ZCB2bHZfc2V0X3Jwc19pZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkg
KiBwdW5pdCBpbnRvIGNvbW1pdHRpbmcgdGhlIHZvbHRhZ2UgY2hhbmdlKSBhcyB0aGF0IHRha2Vz
IGEgbG90IGxlc3MKIAkgKiBwb3dlciB0aGFuIHRoZSByZW5kZXIgcG93ZXJ3ZWxsLgogCSAqLwot
CWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0Vf
TUVESUEpOwotCWVyciA9IHZhbGxleXZpZXdfc2V0X3JwcyhkZXZfcHJpdiwgdmFsKTsKLQlpbnRl
bF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX01FRElB
KTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0Vf
TUVESUEpOworCWVyciA9IHZhbGxleXZpZXdfc2V0X3JwcyhpOTE1LCB2YWwpOworCWludGVsX3Vu
Y29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9NRURJQSk7CiAKIAlp
ZiAoZXJyKQogCQlEUk1fRVJST1IoIkZhaWxlZCB0byBzZXQgUlBTIGZvciBpZGxlXG4iKTsKIH0K
IAotdm9pZCBnZW42X3Jwc19idXN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3ZvaWQgZ2VuNl9ycHNfYnVzeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsKKwlzdHJ1Y3QgaW50
ZWxfcnBzICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCiAJbXV0ZXhfbG9jaygmcnBzLT5sb2Nr
KTsKIAlpZiAocnBzLT5lbmFibGVkKSB7CiAJCXU4IGZyZXE7CiAKLQkJaWYgKGRldl9wcml2LT5w
bV9ycHNfZXZlbnRzICYgR0VONl9QTV9SUF9VUF9FSV9FWFBJUkVEKQotCQkJZ2VuNl9ycHNfcmVz
ZXRfZWkoZGV2X3ByaXYpOworCQlpZiAoaTkxNS0+cG1fcnBzX2V2ZW50cyAmIEdFTjZfUE1fUlBf
VVBfRUlfRVhQSVJFRCkKKwkJCWdlbjZfcnBzX3Jlc2V0X2VpKGk5MTUpOwogCQlJOTE1X1dSSVRF
KEdFTjZfUE1JTlRSTVNLLAotCQkJICAgZ2VuNl9ycHNfcG1fbWFzayhkZXZfcHJpdiwgcnBzLT5j
dXJfZnJlcSkpOworCQkJICAgZ2VuNl9ycHNfcG1fbWFzayhpOTE1LCBycHMtPmN1cl9mcmVxKSk7
CiAKLQkJZ2VuNl9lbmFibGVfcnBzX2ludGVycnVwdHMoZGV2X3ByaXYpOworCQlnZW42X2VuYWJs
ZV9ycHNfaW50ZXJydXB0cyhpOTE1KTsKIAogCQkvKiBVc2UgdGhlIHVzZXIncyBkZXNpcmVkIGZy
ZXF1ZW5jeSBhcyBhIGd1aWRlLCBidXQgZm9yIGJldHRlcgogCQkgKiBwZXJmb3JtYW5jZSwganVt
cCBkaXJlY3RseSB0byBSUGUgYXMgb3VyIHN0YXJ0aW5nIGZyZXF1ZW5jeS4KQEAgLTY4MzksNyAr
NjgzOSw3IEBAIHZvaWQgZ2VuNl9ycHNfYnVzeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJCWZyZXEgPSBtYXgocnBzLT5jdXJfZnJlcSwKIAkJCSAgIHJwcy0+ZWZmaWNpZW50
X2ZyZXEpOwogCi0JCWlmIChpbnRlbF9zZXRfcnBzKGRldl9wcml2LAorCQlpZiAoaW50ZWxfc2V0
X3JwcyhpOTE1LAogCQkJCSAgY2xhbXAoZnJlcSwKIAkJCQkJcnBzLT5taW5fZnJlcV9zb2Z0bGlt
aXQsCiAJCQkJCXJwcy0+bWF4X2ZyZXFfc29mdGxpbWl0KSkpCkBAIC02ODQ4LDI2ICs2ODQ4LDI2
IEBAIHZvaWQgZ2VuNl9ycHNfYnVzeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJbXV0ZXhfdW5sb2NrKCZycHMtPmxvY2spOwogfQogCi12b2lkIGdlbjZfcnBzX2lkbGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBnZW42X3Jwc19pZGxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZk
ZXZfcHJpdi0+Z3RfcG0ucnBzOworCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZpOTE1LT5ndF9w
bS5ycHM7CiAKIAkvKiBGbHVzaCBvdXIgYm90dG9tLWhhbGYgc28gdGhhdCBpdCBkb2VzIG5vdCBy
YWNlIHdpdGggdXMKIAkgKiBzZXR0aW5nIHRoZSBpZGxlIGZyZXF1ZW5jeSBhbmQgc28gdGhhdCBp
dCBpcyBib3VuZGVkIGJ5CiAJICogb3VyIHJwbSB3YWtlcmVmLiBBbmQgdGhlbiBkaXNhYmxlIHRo
ZSBpbnRlcnJ1cHRzIHRvIHN0b3AgYW55CiAJICogZnV0aGVyIFJQUyByZWNsb2NraW5nIHdoaWxz
dCB3ZSBhcmUgYXNsZWVwLgogCSAqLwotCWdlbjZfZGlzYWJsZV9ycHNfaW50ZXJydXB0cyhkZXZf
cHJpdik7CisJZ2VuNl9kaXNhYmxlX3Jwc19pbnRlcnJ1cHRzKGk5MTUpOwogCiAJbXV0ZXhfbG9j
aygmcnBzLT5sb2NrKTsKIAlpZiAocnBzLT5lbmFibGVkKSB7Ci0JCWlmIChJU19WQUxMRVlWSUVX
KGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJCXZsdl9zZXRfcnBzX2lk
bGUoZGV2X3ByaXYpOworCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVX
KGk5MTUpKQorCQkJdmx2X3NldF9ycHNfaWRsZShpOTE1KTsKIAkJZWxzZQotCQkJZ2VuNl9zZXRf
cnBzKGRldl9wcml2LCBycHMtPmlkbGVfZnJlcSk7CisJCQlnZW42X3NldF9ycHMoaTkxNSwgcnBz
LT5pZGxlX2ZyZXEpOwogCQlycHMtPmxhc3RfYWRqID0gMDsKIAkJSTkxNV9XUklURShHRU42X1BN
SU5UUk1TSywKLQkJCSAgIGdlbjZfc2FuaXRpemVfcnBzX3BtX21hc2soZGV2X3ByaXYsIH4wKSk7
CisJCQkgICBnZW42X3Nhbml0aXplX3Jwc19wbV9tYXNrKGk5MTUsIH4wKSk7CiAJfQogCW11dGV4
X3VubG9jaygmcnBzLT5sb2NrKTsKIH0KQEAgLTY5MDQsOSArNjkwNCw5IEBAIHZvaWQgZ2VuNl9y
cHNfYm9vc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJYXRvbWljX2luYygmcnBzLT5ib29z
dHMpOwogfQogCi1pbnQgaW50ZWxfc2V0X3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsIHU4IHZhbCkKK2ludCBpbnRlbF9zZXRfcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCB1OCB2YWwpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5n
dF9wbS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAlp
bnQgZXJyOwogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmcnBzLT5sb2NrKTsKQEAgLTY5MTgsNjMg
KzY5MTgsNjMgQEAgaW50IGludGVsX3NldF9ycHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCB1OCB2YWwpCiAJCXJldHVybiAwOwogCX0KIAotCWlmIChJU19WQUxMRVlWSUVXKGRl
dl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJZXJyID0gdmFsbGV5dmlld19z
ZXRfcnBzKGRldl9wcml2LCB2YWwpOworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NI
RVJSWVZJRVcoaTkxNSkpCisJCWVyciA9IHZhbGxleXZpZXdfc2V0X3JwcyhpOTE1LCB2YWwpOwog
CWVsc2UKLQkJZXJyID0gZ2VuNl9zZXRfcnBzKGRldl9wcml2LCB2YWwpOworCQllcnIgPSBnZW42
X3NldF9ycHMoaTkxNSwgdmFsKTsKIAogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyB2b2lkIGdl
bjlfZGlzYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgZ2VuOV9kaXNhYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAlJOTE1X1dSSVRFKEdFTjZfUkNfQ09OVFJPTCwgMCk7CiAJSTkxNV9XUklURShHRU45X1BHX0VO
QUJMRSwgMCk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjlfZGlzYWJsZV9ycHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuOV9kaXNhYmxlX3JwcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlJOTE1X1dSSVRFKEdFTjZfUlBfQ09OVFJP
TCwgMCk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjZfZGlzYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuNl9kaXNhYmxlX3JjNihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlJOTE1X1dSSVRFKEdFTjZfUkNfQ09OVFJPTCwg
MCk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjZfZGlzYWJsZV9ycHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuNl9kaXNhYmxlX3JwcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlJOTE1X1dSSVRFKEdFTjZfUlBOU1dSRVEsIDEgPDwg
MzEpOwogCUk5MTVfV1JJVEUoR0VONl9SUF9DT05UUk9MLCAwKTsKIH0KIAotc3RhdGljIHZvaWQg
Y2hlcnJ5dmlld19kaXNhYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCBjaGVycnl2aWV3X2Rpc2FibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCUk5MTVfV1JJVEUoR0VONl9SQ19DT05UUk9MLCAwKTsKIH0KIAotc3Rh
dGljIHZvaWQgY2hlcnJ5dmlld19kaXNhYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBjaGVycnl2aWV3X2Rpc2FibGVfcnBzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCUk5MTVfV1JJVEUoR0VONl9SUF9DT05UUk9MLCAwKTsK
IH0KIAotc3RhdGljIHZvaWQgdmFsbGV5dmlld19kaXNhYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB2YWxsZXl2aWV3X2Rpc2FibGVfcmM2KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIFdlJ3JlIGRvaW5nIGZvcmNld2Fr
ZSBiZWZvcmUgRGlzYWJsaW5nIFJDNiwKIAkgKiBUaGlzIHdoYXQgdGhlIEJJT1MgZXhwZWN0cyB3
aGVuIGdvaW5nIGludG8gc3VzcGVuZCAqLwotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZk
ZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtl
X2dldCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAogCUk5MTVfV1JJVEUoR0VONl9S
Q19DT05UUk9MLCAwKTsKIAotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZkZXZfcHJpdi0+
dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkx
NS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIH0KIAotc3RhdGljIHZvaWQgdmFsbGV5dmlld19k
aXNhYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCB2YWxsZXl2aWV3X2Rpc2FibGVfcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCUk5MTVfV1JJVEUoR0VONl9SUF9DT05UUk9MLCAwKTsKIH0KIAotc3RhdGljIGJvb2wgYnh0
X2NoZWNrX2Jpb3NfcmM2X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3N0YXRpYyBib29sIGJ4dF9jaGVja19iaW9zX3JjNl9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKIAlib29sIGVuYWJsZV9yYzYgPSB0cnVlOwogCXVuc2lnbmVkIGxvbmcg
cmM2X2N0eF9iYXNlOwpAQCAtNzAwMCw4ICs3MDAwLDggQEAgc3RhdGljIGJvb2wgYnh0X2NoZWNr
X2Jpb3NfcmM2X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBm
b3IgdGhpcyBjaGVjay4KIAkgKi8KIAlyYzZfY3R4X2Jhc2UgPSBJOTE1X1JFQUQoUkM2X0NUWF9C
QVNFKSAmIFJDNl9DVFhfQkFTRV9NQVNLOwotCWlmICghKChyYzZfY3R4X2Jhc2UgPj0gZGV2X3By
aXYtPmRzbV9yZXNlcnZlZC5zdGFydCkgJiYKLQkgICAgICAocmM2X2N0eF9iYXNlICsgUEFHRV9T
SVpFIDwgZGV2X3ByaXYtPmRzbV9yZXNlcnZlZC5lbmQpKSkgeworCWlmICghKChyYzZfY3R4X2Jh
c2UgPj0gaTkxNS0+ZHNtX3Jlc2VydmVkLnN0YXJ0KSAmJgorCSAgICAgIChyYzZfY3R4X2Jhc2Ug
KyBQQUdFX1NJWkUgPCBpOTE1LT5kc21fcmVzZXJ2ZWQuZW5kKSkpIHsKIAkJRFJNX0RFQlVHX0RS
SVZFUigiUkM2IEJhc2UgYWRkcmVzcyBub3QgYXMgZXhwZWN0ZWQuXG4iKTsKIAkJZW5hYmxlX3Jj
NiA9IGZhbHNlOwogCX0KQEAgLTcwNjIsMTQgKzcwNjIsMTQgQEAgc3RhdGljIGJvb2wgc2FuaXRp
emVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybiBpbmZvLT5oYXNf
cmM2OwogfQogCi1zdGF0aWMgdm9pZCBnZW42X2luaXRfcnBzX2ZyZXF1ZW5jaWVzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdlbjZfaW5pdF9ycHNfZnJl
cXVlbmNpZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVs
X3JwcyAqcnBzID0gJmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBz
ID0gJmk5MTUtPmd0X3BtLnJwczsKIAogCS8qIEFsbCBvZiB0aGVzZSB2YWx1ZXMgYXJlIGluIHVu
aXRzIG9mIDUwTUh6ICovCiAKIAkvKiBzdGF0aWMgdmFsdWVzIGZyb20gSFc6IFJQMCA+IFJQMSA+
IFJQbiAobWluX2ZyZXEpICovCi0JaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7CisJaWYgKElT
X0dFTjlfTFAoaTkxNSkpIHsKIAkJdTMyIHJwX3N0YXRlX2NhcCA9IEk5MTVfUkVBRChCWFRfUlBf
U1RBVEVfQ0FQKTsKIAkJcnBzLT5ycDBfZnJlcSA9IChycF9zdGF0ZV9jYXAgPj4gMTYpICYgMHhm
ZjsKIAkJcnBzLT5ycDFfZnJlcSA9IChycF9zdGF0ZV9jYXAgPj4gIDgpICYgMHhmZjsKQEAgLTcw
ODQsMTEgKzcwODQsMTEgQEAgc3RhdGljIHZvaWQgZ2VuNl9pbml0X3Jwc19mcmVxdWVuY2llcyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcnBzLT5tYXhfZnJlcSA9IHJwcy0+
cnAwX2ZyZXE7CiAKIAlycHMtPmVmZmljaWVudF9mcmVxID0gcnBzLT5ycDFfZnJlcTsKLQlpZiAo
SVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSB8fAotCSAgICBJ
U19HRU45X0JDKGRldl9wcml2KSB8fCBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKSB7CisJaWYg
KElTX0hBU1dFTEwoaTkxNSkgfHwgSVNfQlJPQURXRUxMKGk5MTUpIHx8CisJICAgIElTX0dFTjlf
QkMoaTkxNSkgfHwgSU5URUxfR0VOKGk5MTUpID49IDEwKSB7CiAJCXUzMiBkZGNjX3N0YXR1cyA9
IDA7CiAKLQkJaWYgKHNhbmR5YnJpZGdlX3Bjb2RlX3JlYWQoZGV2X3ByaXYsCisJCWlmIChzYW5k
eWJyaWRnZV9wY29kZV9yZWFkKGk5MTUsCiAJCQkJCSAgIEhTV19QQ09ERV9EWU5BTUlDX0RVVFlf
Q1lDTEVfQ09OVFJPTCwKIAkJCQkJICAgJmRkY2Nfc3RhdHVzLCBOVUxMKSA9PSAwKQogCQkJcnBz
LT5lZmZpY2llbnRfZnJlcSA9CkBAIC03MDk4LDcgKzcwOTgsNyBAQCBzdGF0aWMgdm9pZCBnZW42
X2luaXRfcnBzX2ZyZXF1ZW5jaWVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJCQkJcnBzLT5tYXhfZnJlcSk7CiAJfQogCi0JaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpIHx8
IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApIHsKKwlpZiAoSVNfR0VOOV9CQyhpOTE1KSB8fCBJ
TlRFTF9HRU4oaTkxNSkgPj0gMTApIHsKIAkJLyogU3RvcmUgdGhlIGZyZXF1ZW5jeSB2YWx1ZXMg
aW4gMTYuNjYgTUhaIHVuaXRzLCB3aGljaCBpcwogCQkgKiB0aGUgbmF0dXJhbCBoYXJkd2FyZSB1
bml0IGZvciBTS0wKIAkJICovCkBAIC03MTEwLDQ1ICs3MTEwLDQ1IEBAIHN0YXRpYyB2b2lkIGdl
bjZfaW5pdF9ycHNfZnJlcXVlbmNpZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCX0KIH0KIAotc3RhdGljIHZvaWQgcmVzZXRfcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHJlc2V0X3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJICAgICAgaW50ICgqc2V0KShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqLCB1
OCkpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5ndF9wbS5ycHM7CisJ
c3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAl1OCBmcmVxID0gcnBz
LT5jdXJfZnJlcTsKIAogCS8qIGZvcmNlIGEgcmVzZXQgKi8KIAlycHMtPnBvd2VyLm1vZGUgPSAt
MTsKIAlycHMtPmN1cl9mcmVxID0gLTE7CiAKLQlpZiAoc2V0KGRldl9wcml2LCBmcmVxKSkKKwlp
ZiAoc2V0KGk5MTUsIGZyZXEpKQogCQlEUk1fRVJST1IoIkZhaWxlZCB0byByZXNldCBSUFMgdG8g
aW5pdGlhbCB2YWx1ZXNcbiIpOwogfQogCiAvKiBTZWUgdGhlIEdlbjlfR1RfUE1fUHJvZ3JhbW1p
bmdfR3VpZGUgZG9jIGZvciB0aGUgYmVsb3cgKi8KLXN0YXRpYyB2b2lkIGdlbjlfZW5hYmxlX3Jw
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW45X2Vu
YWJsZV9ycHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaW50ZWxfdW5jb3Jl
X2ZvcmNld2FrZV9nZXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVs
X3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCiAJ
LyogUHJvZ3JhbSBkZWZhdWx0cyBhbmQgdGhyZXNob2xkcyBmb3IgUlBTICovCi0JaWYgKElTX0dF
TihkZXZfcHJpdiwgOSkpCisJaWYgKElTX0dFTihpOTE1LCA5KSkKIAkJSTkxNV9XUklURShHRU42
X1JDX1ZJREVPX0ZSRVEsCi0JCQlHRU45X0ZSRVFVRU5DWShkZXZfcHJpdi0+Z3RfcG0ucnBzLnJw
MV9mcmVxKSk7CisJCQlHRU45X0ZSRVFVRU5DWShpOTE1LT5ndF9wbS5ycHMucnAxX2ZyZXEpKTsK
IAogCS8qIDEgc2Vjb25kIHRpbWVvdXQqLwogCUk5MTVfV1JJVEUoR0VONl9SUF9ET1dOX1RJTUVP
VVQsCi0JCUdUX0lOVEVSVkFMX0ZST01fVVMoZGV2X3ByaXYsIDEwMDAwMDApKTsKKwkJR1RfSU5U
RVJWQUxfRlJPTV9VUyhpOTE1LCAxMDAwMDAwKSk7CiAKIAlJOTE1X1dSSVRFKEdFTjZfUlBfSURM
RV9IWVNURVJTSVMsIDB4YSk7CiAKIAkvKiBMZWFuaW5nIG9uIHRoZSBiZWxvdyBjYWxsIHRvIGdl
bjZfc2V0X3JwcyB0byBwcm9ncmFtL3NldHVwIHRoZQogCSAqIFVwL0Rvd24gRUkgJiB0aHJlc2hv
bGQgcmVnaXN0ZXJzLCBhcyB3ZWxsIGFzIHRoZSBSUF9DT05UUk9MLAogCSAqIFJQX0lOVEVSUlVQ
VF9MSU1JVFMgJiBSUE5TV1JFUSByZWdpc3RlcnMgKi8KLQlyZXNldF9ycHMoZGV2X3ByaXYsIGdl
bjZfc2V0X3Jwcyk7CisJcmVzZXRfcnBzKGk5MTUsIGdlbjZfc2V0X3Jwcyk7CiAKLQlpbnRlbF91
bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJ
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7
CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjExX2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuMTFfZW5hYmxlX3JjNihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJ
ZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CkBAIC03MTYwLDcgKzcxNjAsNyBAQCBzdGF0aWMgdm9p
ZCBnZW4xMV9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkg
KiAxYjogR2V0IGZvcmNld2FrZSBkdXJpbmcgcHJvZ3JhbSBzZXF1ZW5jZS4gQWx0aG91Z2ggdGhl
IGRyaXZlcgogCSAqIGhhc24ndCBlbmFibGVkIGEgc3RhdGUgeWV0IHdoZXJlIHdlIG5lZWQgZm9y
Y2V3YWtlLCBCSU9TIG1heSBoYXZlLgogCSAqLwotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0
KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3
YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAogCS8qIDJhOiBEaXNhYmxl
IFJDIHN0YXRlcy4gKi8KIAlJOTE1X1dSSVRFKEdFTjZfUkNfQ09OVFJPTCwgMCk7CkBAIC03MTcx
LDEwICs3MTcxLDEwIEBAIHN0YXRpYyB2b2lkIGdlbjExX2VuYWJsZV9yYzYoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJSTkxNV9XUklURShHRU42X1JDX0VWQUxVQVRJT05f
SU5URVJWQUwsIDEyNTAwMCk7IC8qIDEyNTAwICogMTI4MG5zICovCiAJSTkxNV9XUklURShHRU42
X1JDX0lETEVfSFlTVEVSU0lTLCAyNSk7IC8qIDI1ICogMTI4MG5zICovCi0JZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgZGV2X3ByaXYsIGlkKQorCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUs
IGlkKQogCQlJOTE1X1dSSVRFKFJJTkdfTUFYX0lETEUoZW5naW5lLT5tbWlvX2Jhc2UpLCAxMCk7
CiAKLQlpZiAoSEFTX0dVQyhkZXZfcHJpdikpCisJaWYgKEhBU19HVUMoaTkxNSkpCiAJCUk5MTVf
V1JJVEUoR1VDX01BWF9JRExFX0NPVU5ULCAweEEpOwogCiAJSTkxNV9XUklURShHRU42X1JDX1NM
RUVQLCAwKTsKQEAgLTcyMTcsMTAgKzcyMTcsMTAgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZW5hYmxl
X3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAgIEdFTjlfTUVESUFf
UEdfRU5BQkxFIHwKIAkJICAgR0VOMTFfTUVESUFfU0FNUExFUl9QR19FTkFCTEUpOwogCi0JaW50
ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwp
OworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOwogfQogCi1zdGF0aWMgdm9pZCBnZW45X2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuOV9lbmFibGVfcmM2KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
IAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKQEAgLTcyMzEsMTYgKzcyMzEsMTYgQEAgc3RhdGlj
IHZvaWQgZ2VuOV9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAogCS8qIDFiOiBHZXQgZm9yY2V3YWtlIGR1cmluZyBwcm9ncmFtIHNlcXVlbmNlLiBBbHRob3Vn
aCB0aGUgZHJpdmVyCiAJICogaGFzbid0IGVuYWJsZWQgYSBzdGF0ZSB5ZXQgd2hlcmUgd2UgbmVl
ZCBmb3JjZXdha2UsIEJJT1MgbWF5IGhhdmUuKi8KLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dl
dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNl
d2FrZV9nZXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKIAkvKiAyYTogRGlzYWJs
ZSBSQyBzdGF0ZXMuICovCiAJSTkxNV9XUklURShHRU42X1JDX0NPTlRST0wsIDApOwogCiAJLyog
MmI6IFByb2dyYW0gUkM2IHRocmVzaG9sZHMuKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTApIHsKIAkJSTkxNV9XUklURShHRU42
X1JDNl9XQUtFX1JBVEVfTElNSVQsIDU0IDw8IDE2IHwgODUpOwogCQlJOTE1X1dSSVRFKEdFTjEw
X01FRElBX1dBS0VfUkFURV9MSU1JVCwgMTUwKTsKLQl9IGVsc2UgaWYgKElTX1NLWUxBS0UoZGV2
X3ByaXYpKSB7CisJfSBlbHNlIGlmIChJU19TS1lMQUtFKGk5MTUpKSB7CiAJCS8qCiAJCSAqIFdh
UnNEb3VibGVSYzZXcmxXaXRoQ29hcnNlUG93ZXJHYXRpbmc6c2tsIERvdWJsaW5nIFdSTCBvbmx5
CiAJCSAqIHdoZW4gQ1BHIGlzIGVuYWJsZWQKQEAgLTcyNTIsMTAgKzcyNTIsMTAgQEAgc3RhdGlj
IHZvaWQgZ2VuOV9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAogCUk5MTVfV1JJVEUoR0VONl9SQ19FVkFMVUFUSU9OX0lOVEVSVkFMLCAxMjUwMDApOyAvKiAx
MjUwMCAqIDEyODBucyAqLwogCUk5MTVfV1JJVEUoR0VONl9SQ19JRExFX0hZU1RFUlNJUywgMjUp
OyAvKiAyNSAqIDEyODBucyAqLwotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBp
ZCkKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJSTkxNV9XUklURShSSU5H
X01BWF9JRExFKGVuZ2luZS0+bW1pb19iYXNlKSwgMTApOwogCi0JaWYgKEhBU19HVUMoZGV2X3By
aXYpKQorCWlmIChIQVNfR1VDKGk5MTUpKQogCQlJOTE1X1dSSVRFKEdVQ19NQVhfSURMRV9DT1VO
VCwgMHhBKTsKIAogCUk5MTVfV1JJVEUoR0VONl9SQ19TTEVFUCwgMCk7CkBAIC03Mjg4LDcgKzcy
ODgsNyBAQCBzdGF0aWMgdm9pZCBnZW45X2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCUk5MTVfV1JJVEUoR0VONl9SQzZfVEhSRVNIT0xELCAzNzUwMCk7IC8q
IDM3LjUvMTI1bXMgcGVyIEVJICovCiAKIAkvKiBXYVJzVXNlVGltZW91dE1vZGU6Y25sIChwcmUt
cHJvZCkgKi8KLQlpZiAoSVNfQ05MX1JFVklEKGRldl9wcml2LCBDTkxfUkVWSURfQTAsIENOTF9S
RVZJRF9DMCkpCisJaWYgKElTX0NOTF9SRVZJRChpOTE1LCBDTkxfUkVWSURfQTAsIENOTF9SRVZJ
RF9DMCkpCiAJCXJjNl9tb2RlID0gR0VON19SQ19DVExfVE9fTU9ERTsKIAllbHNlCiAJCXJjNl9t
b2RlID0gR0VONl9SQ19DVExfRUlfTU9ERSgxKTsKQEAgLTczMDIsMTYgKzczMDIsMTYgQEAgc3Rh
dGljIHZvaWQgZ2VuOV9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkgKiAzYjogRW5hYmxlIENvYXJzZSBQb3dlciBHYXRpbmcgb25seSB3aGVuIFJDNiBpcyBl
bmFibGVkLgogCSAqIFdhUnNEaXNhYmxlQ29hcnNlUG93ZXJHYXRpbmc6c2tsLGNubCAtIFJlbmRl
ci9NZWRpYSBQRyBuZWVkIHRvIGJlIGRpc2FibGVkIHdpdGggUkM2LgogCSAqLwotCWlmIChORUVE
U19XYVJzRGlzYWJsZUNvYXJzZVBvd2VyR2F0aW5nKGRldl9wcml2KSkKKwlpZiAoTkVFRFNfV2FS
c0Rpc2FibGVDb2Fyc2VQb3dlckdhdGluZyhpOTE1KSkKIAkJSTkxNV9XUklURShHRU45X1BHX0VO
QUJMRSwgMCk7CiAJZWxzZQogCQlJOTE1X1dSSVRFKEdFTjlfUEdfRU5BQkxFLAogCQkJICAgR0VO
OV9SRU5ERVJfUEdfRU5BQkxFIHwgR0VOOV9NRURJQV9QR19FTkFCTEUpOwogCi0JaW50ZWxfdW5j
b3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWlu
dGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwog
fQogCi1zdGF0aWMgdm9pZCBnZW44X2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuOF9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKQEAgLTczMjEsNyArNzMyMSw3IEBAIHN0YXRpYyB2b2lkIGdl
bjhfZW5hYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAkvKiAx
YjogR2V0IGZvcmNld2FrZSBkdXJpbmcgcHJvZ3JhbSBzZXF1ZW5jZS4gQWx0aG91Z2ggdGhlIGRy
aXZlcgogCSAqIGhhc24ndCBlbmFibGVkIGEgc3RhdGUgeWV0IHdoZXJlIHdlIG5lZWQgZm9yY2V3
YWtlLCBCSU9TIG1heSBoYXZlLiovCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9w
cml2LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0
KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCiAJLyogMmE6IERpc2FibGUgUkMgc3Rh
dGVzLiAqLwogCUk5MTVfV1JJVEUoR0VONl9SQ19DT05UUk9MLCAwKTsKQEAgLTczMzAsNyArNzMz
MCw3IEBAIHN0YXRpYyB2b2lkIGdlbjhfZW5hYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShHRU42X1JDNl9XQUtFX1JBVEVfTElNSVQsIDQwIDw8
IDE2KTsKIAlJOTE1X1dSSVRFKEdFTjZfUkNfRVZBTFVBVElPTl9JTlRFUlZBTCwgMTI1MDAwKTsg
LyogMTI1MDAgKiAxMjgwbnMgKi8KIAlJOTE1X1dSSVRFKEdFTjZfUkNfSURMRV9IWVNURVJTSVMs
IDI1KTsgLyogMjUgKiAxMjgwbnMgKi8KLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBkZXZfcHJp
diwgaWQpCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCUk5MTVfV1JJVEUo
UklOR19NQVhfSURMRShlbmdpbmUtPm1taW9fYmFzZSksIDEwKTsKIAlJOTE1X1dSSVRFKEdFTjZf
UkNfU0xFRVAsIDApOwogCUk5MTVfV1JJVEUoR0VONl9SQzZfVEhSRVNIT0xELCA2MjUpOyAvKiA4
MDB1cy8xLjI4IGZvciBUTyAqLwpAQCAtNzM0MiwxNCArNzM0MiwxNCBAQCBzdGF0aWMgdm9pZCBn
ZW44X2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgICBH
RU43X1JDX0NUTF9UT19NT0RFIHwKIAkJICAgR0VONl9SQ19DVExfUkM2X0VOQUJMRSk7CiAKLQlp
bnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FM
TCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtF
X0FMTCk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjhfZW5hYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW44X2VuYWJsZV9ycHMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9w
cml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJw
czsKIAotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JD
RVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBG
T1JDRVdBS0VfQUxMKTsKIAogCS8qIDEgUHJvZ3JhbSBkZWZhdWx0cyBhbmQgdGhyZXNob2xkcyBm
b3IgUlBTKi8KIAlJOTE1X1dSSVRFKEdFTjZfUlBOU1dSRVEsCkBAIC03MzgwLDEyICs3MzgwLDEy
IEBAIHN0YXRpYyB2b2lkIGdlbjhfZW5hYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJCSAgIEdFTjZfUlBfVVBfQlVTWV9BVkcgfAogCQkgICBHRU42X1JQX0RPV05f
SURMRV9BVkcpOwogCi0JcmVzZXRfcnBzKGRldl9wcml2LCBnZW42X3NldF9ycHMpOworCXJlc2V0
X3JwcyhpOTE1LCBnZW42X3NldF9ycHMpOwogCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQo
JmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdh
a2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogfQogCi1zdGF0aWMgdm9pZCBn
ZW42X2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgZ2VuNl9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewog
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBp
ZDsKQEAgLTc0MDIsNyArNzQwMiw3IEBAIHN0YXRpYyB2b2lkIGdlbjZfZW5hYmxlX3JjNihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCUk5MTVfV1JJVEUoR1RGSUZPREJHLCBn
dGZpZm9kYmcpOwogCX0KIAotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+
dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkx
NS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAogCS8qIGRpc2FibGUgdGhlIGNvdW50ZXJzIGFu
ZCBzZXQgZGV0ZXJtaW5pc3RpYyB0aHJlc2hvbGRzICovCiAJSTkxNV9XUklURShHRU42X1JDX0NP
TlRST0wsIDApOwpAQCAtNzQxMywxMiArNzQxMywxMiBAQCBzdGF0aWMgdm9pZCBnZW42X2VuYWJs
ZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJVEUoR0VO
Nl9SQ19FVkFMVUFUSU9OX0lOVEVSVkFMLCAxMjUwMDApOwogCUk5MTVfV1JJVEUoR0VONl9SQ19J
RExFX0hZU1RFUlNJUywgMjUpOwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZGV2X3ByaXYs
IGlkKQorCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQlJOTE1X1dSSVRFKFJJ
TkdfTUFYX0lETEUoZW5naW5lLT5tbWlvX2Jhc2UpLCAxMCk7CiAKIAlJOTE1X1dSSVRFKEdFTjZf
UkNfU0xFRVAsIDApOwogCUk5MTVfV1JJVEUoR0VONl9SQzFlX1RIUkVTSE9MRCwgMTAwMCk7Ci0J
aWYgKElTX0lWWUJSSURHRShkZXZfcHJpdikpCisJaWYgKElTX0lWWUJSSURHRShpOTE1KSkKIAkJ
STkxNV9XUklURShHRU42X1JDNl9USFJFU0hPTEQsIDEyNTAwMCk7CiAJZWxzZQogCQlJOTE1X1dS
SVRFKEdFTjZfUkM2X1RIUkVTSE9MRCwgNTAwMDApOwpAQCAtNzQyNyw5ICs3NDI3LDkgQEAgc3Rh
dGljIHZvaWQgZ2VuNl9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAogCS8qIFdlIGRvbid0IHVzZSB0aG9zZSBvbiBIYXN3ZWxsICovCiAJcmM2X21hc2sgPSBH
RU42X1JDX0NUTF9SQzZfRU5BQkxFOwotCWlmIChIQVNfUkM2cChkZXZfcHJpdikpCisJaWYgKEhB
U19SQzZwKGk5MTUpKQogCQlyYzZfbWFzayB8PSBHRU42X1JDX0NUTF9SQzZwX0VOQUJMRTsKLQlp
ZiAoSEFTX1JDNnBwKGRldl9wcml2KSkKKwlpZiAoSEFTX1JDNnBwKGk5MTUpKQogCQlyYzZfbWFz
ayB8PSBHRU42X1JDX0NUTF9SQzZwcF9FTkFCTEU7CiAJSTkxNV9XUklURShHRU42X1JDX0NPTlRS
T0wsCiAJCSAgIHJjNl9tYXNrIHwKQEAgLTc0MzcsMjQgKzc0MzcsMjQgQEAgc3RhdGljIHZvaWQg
Z2VuNl9lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICAg
R0VONl9SQ19DVExfSFdfRU5BQkxFKTsKIAogCXJjNnZpZHMgPSAwOwotCXJldCA9IHNhbmR5YnJp
ZGdlX3Bjb2RlX3JlYWQoZGV2X3ByaXYsIEdFTjZfUENPREVfUkVBRF9SQzZWSURTLAorCXJldCA9
IHNhbmR5YnJpZGdlX3Bjb2RlX3JlYWQoaTkxNSwgR0VONl9QQ09ERV9SRUFEX1JDNlZJRFMsCiAJ
CQkJICAgICAmcmM2dmlkcywgTlVMTCk7Ci0JaWYgKElTX0dFTihkZXZfcHJpdiwgNikgJiYgcmV0
KSB7CisJaWYgKElTX0dFTihpOTE1LCA2KSAmJiByZXQpIHsKIAkJRFJNX0RFQlVHX0RSSVZFUigi
Q291bGRuJ3QgY2hlY2sgZm9yIEJJT1Mgd29ya2Fyb3VuZFxuIik7Ci0JfSBlbHNlIGlmIChJU19H
RU4oZGV2X3ByaXYsIDYpICYmIChHRU42X0RFQ09ERV9SQzZfVklEKHJjNnZpZHMgJiAweGZmKSA8
IDQ1MCkpIHsKKwl9IGVsc2UgaWYgKElTX0dFTihpOTE1LCA2KSAmJiAoR0VONl9ERUNPREVfUkM2
X1ZJRChyYzZ2aWRzICYgMHhmZikgPCA0NTApKSB7CiAJCURSTV9ERUJVR19EUklWRVIoIllvdSBz
aG91bGQgdXBkYXRlIHlvdXIgQklPUy4gQ29ycmVjdGluZyBtaW5pbXVtIHJjNiB2b2x0YWdlICgl
ZG1WLT4lZG1WKVxuIiwKIAkJCSAgR0VONl9ERUNPREVfUkM2X1ZJRChyYzZ2aWRzICYgMHhmZiks
IDQ1MCk7CiAJCXJjNnZpZHMgJj0gMHhmZmZmMDA7CiAJCXJjNnZpZHMgfD0gR0VONl9FTkNPREVf
UkM2X1ZJRCg0NTApOwotCQlyZXQgPSBzYW5keWJyaWRnZV9wY29kZV93cml0ZShkZXZfcHJpdiwg
R0VONl9QQ09ERV9XUklURV9SQzZWSURTLCByYzZ2aWRzKTsKKwkJcmV0ID0gc2FuZHlicmlkZ2Vf
cGNvZGVfd3JpdGUoaTkxNSwgR0VONl9QQ09ERV9XUklURV9SQzZWSURTLCByYzZ2aWRzKTsKIAkJ
aWYgKHJldCkKIAkJCURSTV9FUlJPUigiQ291bGRuJ3QgZml4IGluY29ycmVjdCByYzYgdm9sdGFn
ZVxuIik7CiAJfQogCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNv
cmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51
bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogfQogCi1zdGF0aWMgdm9pZCBnZW42X2VuYWJsZV9ycHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZ2VuNl9lbmFi
bGVfcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIEhlcmUgYmVnaW5z
IGEgbWFnaWMgc2VxdWVuY2Ugb2YgcmVnaXN0ZXIgd3JpdGVzIHRvIGVuYWJsZQogCSAqIGF1dG8t
ZG93bmNsb2NraW5nLgpAQCAtNzQ2MiwyMCArNzQ2MiwyMCBAQCBzdGF0aWMgdm9pZCBnZW42X2Vu
YWJsZV9ycHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIFBlcmhhcHMg
dGhlcmUgbWlnaHQgYmUgc29tZSB2YWx1ZSBpbiBleHBvc2luZyB0aGVzZSB0bwogCSAqIHVzZXJz
cGFjZS4uLgogCSAqLwotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5j
b3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+
dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAogCS8qIFBvd2VyIGRvd24gaWYgY29tcGxldGVseSBp
ZGxlIGZvciBvdmVyIDUwbXMgKi8KIAlJOTE1X1dSSVRFKEdFTjZfUlBfRE9XTl9USU1FT1VULCA1
MDAwMCk7CiAJSTkxNV9XUklURShHRU42X1JQX0lETEVfSFlTVEVSU0lTLCAxMCk7CiAKLQlyZXNl
dF9ycHMoZGV2X3ByaXYsIGdlbjZfc2V0X3Jwcyk7CisJcmVzZXRfcnBzKGk5MTUsIGdlbjZfc2V0
X3Jwcyk7CiAKLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwg
Rk9SQ0VXQUtFX0FMTCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmk5MTUtPnVuY29y
ZSwgRk9SQ0VXQUtFX0FMTCk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjZfdXBkYXRlX3JpbmdfZnJl
cShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW42X3Vw
ZGF0ZV9yaW5nX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0
IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVsX3Jw
cyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAljb25zdCBpbnQgbWluX2ZyZXEgPSAxNTsKIAlj
b25zdCBpbnQgc2NhbGluZ19mYWN0b3IgPSAxODA7CiAJdW5zaWduZWQgaW50IGdwdV9mcmVxOwpA
QCAtNzUwOSw3ICs3NTA5LDcgQEAgc3RhdGljIHZvaWQgZ2VuNl91cGRhdGVfcmluZ19mcmVxKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCW1pbl9ncHVfZnJlcSA9IHJwcy0+
bWluX2ZyZXE7CiAJbWF4X2dwdV9mcmVxID0gcnBzLT5tYXhfZnJlcTsKLQlpZiAoSVNfR0VOOV9C
QyhkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkgeworCWlmIChJU19HRU45
X0JDKGk5MTUpIHx8IElOVEVMX0dFTihpOTE1KSA+PSAxMCkgewogCQkvKiBDb252ZXJ0IEdUIGZy
ZXF1ZW5jeSB0byA1MCBIWiB1bml0cyAqLwogCQltaW5fZ3B1X2ZyZXEgLz0gR0VOOV9GUkVRX1ND
QUxFUjsKIAkJbWF4X2dwdV9mcmVxIC89IEdFTjlfRlJFUV9TQ0FMRVI7CkBAIC03NTI0LDE2ICs3
NTI0LDE2IEBAIHN0YXRpYyB2b2lkIGdlbjZfdXBkYXRlX3JpbmdfZnJlcShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWNvbnN0IGludCBkaWZmID0gbWF4X2dwdV9mcmVxIC0g
Z3B1X2ZyZXE7CiAJCXVuc2lnbmVkIGludCBpYV9mcmVxID0gMCwgcmluZ19mcmVxID0gMDsKIAot
CQlpZiAoSVNfR0VOOV9CQyhkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkg
eworCQlpZiAoSVNfR0VOOV9CQyhpOTE1KSB8fCBJTlRFTF9HRU4oaTkxNSkgPj0gMTApIHsKIAkJ
CS8qCiAJCQkgKiByaW5nX2ZyZXEgPSAyICogR1QuIHJpbmdfZnJlcSBpcyBpbiAxMDBNSHogdW5p
dHMKIAkJCSAqIE5vIGZsb29yIHJlcXVpcmVkIGZvciByaW5nIGZyZXF1ZW5jeSBvbiBTS0wuCiAJ
CQkgKi8KIAkJCXJpbmdfZnJlcSA9IGdwdV9mcmVxOwotCQl9IGVsc2UgaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gOCkgeworCQl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KSB7CiAJ
CQkvKiBtYXgoMiAqIEdULCBERFIpLiBOQjogR1QgaXMgNTBNSHogdW5pdHMgKi8KIAkJCXJpbmdf
ZnJlcSA9IG1heChtaW5fcmluZ19mcmVxLCBncHVfZnJlcSk7Ci0JCX0gZWxzZSBpZiAoSVNfSEFT
V0VMTChkZXZfcHJpdikpIHsKKwkJfSBlbHNlIGlmIChJU19IQVNXRUxMKGk5MTUpKSB7CiAJCQly
aW5nX2ZyZXEgPSBtdWx0X2ZyYWMoZ3B1X2ZyZXEsIDUsIDQpOwogCQkJcmluZ19mcmVxID0gbWF4
KG1pbl9yaW5nX2ZyZXEsIHJpbmdfZnJlcSk7CiAJCQkvKiBsZWF2ZSBpYV9mcmVxIGFzIHRoZSBk
ZWZhdWx0LCBjaG9zZW4gYnkgY3B1ZnJlcSAqLwpAQCAtNzU1Miw3ICs3NTUyLDcgQEAgc3RhdGlj
IHZvaWQgZ2VuNl91cGRhdGVfcmluZ19mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJCWlhX2ZyZXEgPSBESVZfUk9VTkRfQ0xPU0VTVChpYV9mcmVxLCAxMDApOwogCQl9
CiAKLQkJc2FuZHlicmlkZ2VfcGNvZGVfd3JpdGUoZGV2X3ByaXYsCisJCXNhbmR5YnJpZGdlX3Bj
b2RlX3dyaXRlKGk5MTUsCiAJCQkJCUdFTjZfUENPREVfV1JJVEVfTUlOX0ZSRVFfVEFCTEUsCiAJ
CQkJCWlhX2ZyZXEgPDwgR0VONl9QQ09ERV9GUkVRX0lBX1JBVElPX1NISUZUIHwKIAkJCQkJcmlu
Z19mcmVxIDw8IEdFTjZfUENPREVfRlJFUV9SSU5HX1JBVElPX1NISUZUIHwKQEAgLTc1NjAsMTMg
Kzc1NjAsMTMgQEAgc3RhdGljIHZvaWQgZ2VuNl91cGRhdGVfcmluZ19mcmVxKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiB9CiAKLXN0YXRpYyBpbnQgY2hlcnJ5dmlld19y
cHNfbWF4X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGlu
dCBjaGVycnl2aWV3X3Jwc19tYXhfZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAl1MzIgdmFsLCBycDA7CiAKLQl2YWwgPSB2bHZfcHVuaXRfcmVhZChkZXZfcHJpdiwgRkJf
R0ZYX0ZNQVhfQVRfVk1BWF9GVVNFKTsKKwl2YWwgPSB2bHZfcHVuaXRfcmVhZChpOTE1LCBGQl9H
RlhfRk1BWF9BVF9WTUFYX0ZVU0UpOwogCi0Jc3dpdGNoIChSVU5USU1FX0lORk8oZGV2X3ByaXYp
LT5zc2V1LmV1X3RvdGFsKSB7CisJc3dpdGNoIChSVU5USU1FX0lORk8oaTkxNSktPnNzZXUuZXVf
dG90YWwpIHsKIAljYXNlIDg6CiAJCS8qICgyICogNCkgY29uZmlnICovCiAJCXJwMCA9ICh2YWwg
Pj4gRkJfR0ZYX0ZNQVhfQVRfVk1BWF8yU1M0RVVfRlVTRV9TSElGVCk7CkBAIC03NTg4LDUzICs3
NTg4LDUzIEBAIHN0YXRpYyBpbnQgY2hlcnJ5dmlld19ycHNfbWF4X2ZyZXEoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBycDA7CiB9CiAKLXN0YXRpYyBpbnQgY2hl
cnJ5dmlld19ycHNfcnBlX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIGludCBjaGVycnl2aWV3X3Jwc19ycGVfZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKIAl1MzIgdmFsLCBycGU7CiAKLQl2YWwgPSB2bHZfcHVuaXRfcmVhZChkZXZf
cHJpdiwgUFVOSVRfR1BVX0RVVFlDWUNMRV9SRUcpOworCXZhbCA9IHZsdl9wdW5pdF9yZWFkKGk5
MTUsIFBVTklUX0dQVV9EVVRZQ1lDTEVfUkVHKTsKIAlycGUgPSAodmFsID4+IFBVTklUX0dQVV9E
VVRZQ1lDTEVfUlBFX0ZSRVFfU0hJRlQpICYgUFVOSVRfR1BVX0RVVFlDWUNMRV9SUEVfRlJFUV9N
QVNLOwogCiAJcmV0dXJuIHJwZTsKIH0KIAotc3RhdGljIGludCBjaGVycnl2aWV3X3Jwc19ndWFy
X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCBjaGVy
cnl2aWV3X3Jwc19ndWFyX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJ
dTMyIHZhbCwgcnAxOwogCi0JdmFsID0gdmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIEZCX0dGWF9G
TUFYX0FUX1ZNQVhfRlVTRSk7CisJdmFsID0gdmx2X3B1bml0X3JlYWQoaTkxNSwgRkJfR0ZYX0ZN
QVhfQVRfVk1BWF9GVVNFKTsKIAlycDEgPSAodmFsICYgRkJfR0ZYX0ZSRVFfRlVTRV9NQVNLKTsK
IAogCXJldHVybiBycDE7CiB9CiAKLXN0YXRpYyB1MzIgY2hlcnJ5dmlld19ycHNfbWluX2ZyZXEo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHUzMiBjaGVycnl2aWV3
X3Jwc19taW5fZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFs
LCBycG47CiAKLQl2YWwgPSB2bHZfcHVuaXRfcmVhZChkZXZfcHJpdiwgRkJfR0ZYX0ZNSU5fQVRf
Vk1JTl9GVVNFKTsKKwl2YWwgPSB2bHZfcHVuaXRfcmVhZChpOTE1LCBGQl9HRlhfRk1JTl9BVF9W
TUlOX0ZVU0UpOwogCXJwbiA9ICgodmFsID4+IEZCX0dGWF9GTUlOX0FUX1ZNSU5fRlVTRV9TSElG
VCkgJgogCQkgICAgICAgRkJfR0ZYX0ZSRVFfRlVTRV9NQVNLKTsKIAogCXJldHVybiBycG47CiB9
CiAKLXN0YXRpYyBpbnQgdmFsbGV5dmlld19ycHNfZ3Vhcl9mcmVxKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbnQgdmFsbGV5dmlld19ycHNfZ3Vhcl9mcmVxKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiB2YWwsIHJwMTsKIAotCXZhbCA9
IHZsdl9uY19yZWFkKGRldl9wcml2LCBJT1NGX05DX0ZCX0dGWF9GUkVRX0ZVU0UpOworCXZhbCA9
IHZsdl9uY19yZWFkKGk5MTUsIElPU0ZfTkNfRkJfR0ZYX0ZSRVFfRlVTRSk7CiAKIAlycDEgPSAo
dmFsICYgRkJfR0ZYX0ZHVUFSQU5URUVEX0ZSRVFfRlVTRV9NQVNLKSA+PiBGQl9HRlhfRkdVQVJB
TlRFRURfRlJFUV9GVVNFX1NISUZUOwogCiAJcmV0dXJuIHJwMTsKIH0KIAotc3RhdGljIGludCB2
YWxsZXl2aWV3X3Jwc19tYXhfZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgaW50IHZhbGxleXZpZXdfcnBzX21heF9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCXUzMiB2YWwsIHJwMDsKIAotCXZhbCA9IHZsdl9uY19yZWFkKGRldl9w
cml2LCBJT1NGX05DX0ZCX0dGWF9GUkVRX0ZVU0UpOworCXZhbCA9IHZsdl9uY19yZWFkKGk5MTUs
IElPU0ZfTkNfRkJfR0ZYX0ZSRVFfRlVTRSk7CiAKIAlycDAgPSAodmFsICYgRkJfR0ZYX01BWF9G
UkVRX0ZVU0VfTUFTSykgPj4gRkJfR0ZYX01BWF9GUkVRX0ZVU0VfU0hJRlQ7CiAJLyogQ2xhbXAg
dG8gbWF4ICovCkBAIC03NjQzLDIzICs3NjQzLDIzIEBAIHN0YXRpYyBpbnQgdmFsbGV5dmlld19y
cHNfbWF4X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBy
cDA7CiB9CiAKLXN0YXRpYyBpbnQgdmFsbGV5dmlld19ycHNfcnBlX2ZyZXEoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCB2YWxsZXl2aWV3X3Jwc19ycGVfZnJl
cShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFsLCBycGU7CiAKLQl2
YWwgPSB2bHZfbmNfcmVhZChkZXZfcHJpdiwgSU9TRl9OQ19GQl9HRlhfRk1BWF9GVVNFX0xPKTsK
Kwl2YWwgPSB2bHZfbmNfcmVhZChpOTE1LCBJT1NGX05DX0ZCX0dGWF9GTUFYX0ZVU0VfTE8pOwog
CXJwZSA9ICh2YWwgJiBGQl9GTUFYX1ZNSU5fRlJFUV9MT19NQVNLKSA+PiBGQl9GTUFYX1ZNSU5f
RlJFUV9MT19TSElGVDsKLQl2YWwgPSB2bHZfbmNfcmVhZChkZXZfcHJpdiwgSU9TRl9OQ19GQl9H
RlhfRk1BWF9GVVNFX0hJKTsKKwl2YWwgPSB2bHZfbmNfcmVhZChpOTE1LCBJT1NGX05DX0ZCX0dG
WF9GTUFYX0ZVU0VfSEkpOwogCXJwZSB8PSAodmFsICYgRkJfRk1BWF9WTUlOX0ZSRVFfSElfTUFT
SykgPDwgNTsKIAogCXJldHVybiBycGU7CiB9CiAKLXN0YXRpYyBpbnQgdmFsbGV5dmlld19ycHNf
bWluX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCB2
YWxsZXl2aWV3X3Jwc19taW5fZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAl1MzIgdmFsOwogCi0JdmFsID0gdmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBVTklUX1JFR19H
UFVfTEZNKSAmIDB4ZmY7CisJdmFsID0gdmx2X3B1bml0X3JlYWQoaTkxNSwgUFVOSVRfUkVHX0dQ
VV9MRk0pICYgMHhmZjsKIAkvKgogCSAqIEFjY29yZGluZyB0byB0aGUgQllUIFB1bml0IEdQVSB0
dXJibyBIQVMgMS4xLjYuMyB0aGUgbWluaW11bSB2YWx1ZQogCSAqIGZvciB0aGUgbWluaW11bSBm
cmVxdWVuY3kgaW4gR1BMTCBtb2RlIGlzIDB4YzEuIENvbnRyYXJ5IHRvIHRoaXMgb24KQEAgLTc2
NzEsMjQgKzc2NzEsMjQgQEAgc3RhdGljIGludCB2YWxsZXl2aWV3X3Jwc19taW5fZnJlcShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB9CiAKIC8qIENoZWNrIHRoYXQgdGhlIHBj
dHggYnVmZmVyIHdhc24ndCBtb3ZlIHVuZGVyIHVzLiAqLwotc3RhdGljIHZvaWQgdmFsbGV5dmll
d19jaGVja19wY3R4KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIHZhbGxleXZpZXdfY2hlY2tfcGN0eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAl1bnNpZ25lZCBsb25nIHBjdHhfYWRkciA9IEk5MTVfUkVBRChWTFZfUENCUikgJiB+NDA5
NTsKIAotCVdBUk5fT04ocGN0eF9hZGRyICE9IGRldl9wcml2LT5kc20uc3RhcnQgKwotCQkJICAg
ICBkZXZfcHJpdi0+dmx2X3BjdHgtPnN0b2xlbi0+c3RhcnQpOworCVdBUk5fT04ocGN0eF9hZGRy
ICE9IGk5MTUtPmRzbS5zdGFydCArCisJCQkgICAgIGk5MTUtPnZsdl9wY3R4LT5zdG9sZW4tPnN0
YXJ0KTsKIH0KIAogCiAvKiBDaGVjayB0aGF0IHRoZSBwY2JyIGFkZHJlc3MgaXMgbm90IGVtcHR5
LiAqLwotc3RhdGljIHZvaWQgY2hlcnJ5dmlld19jaGVja19wY3R4KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGNoZXJyeXZpZXdfY2hlY2tfcGN0eChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1bnNpZ25lZCBsb25nIHBjdHhfYWRkciA9
IEk5MTVfUkVBRChWTFZfUENCUikgJiB+NDA5NTsKIAogCVdBUk5fT04oKHBjdHhfYWRkciA+PiBW
TFZfUENCUl9BRERSX1NISUZUKSA9PSAwKTsKIH0KIAotc3RhdGljIHZvaWQgY2hlcnJ5dmlld19z
ZXR1cF9wY3R4KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lk
IGNoZXJyeXZpZXdfc2V0dXBfcGN0eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAlyZXNvdXJjZV9zaXplX3QgcGN0eF9wYWRkciwgcGFkZHI7CiAJcmVzb3VyY2Vfc2l6ZV90IHBj
dHhfc2l6ZSA9IDMyKjEwMjQ7CkBAIC03Njk3LDcgKzc2OTcsNyBAQCBzdGF0aWMgdm9pZCBjaGVy
cnl2aWV3X3NldHVwX3BjdHgoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXBj
YnIgPSBJOTE1X1JFQUQoVkxWX1BDQlIpOwogCWlmICgocGNiciA+PiBWTFZfUENCUl9BRERSX1NI
SUZUKSA9PSAwKSB7CiAJCURSTV9ERUJVR19EUklWRVIoIkJJT1MgZGlkbid0IHNldCB1cCBQQ0JS
LCBmaXhpbmcgdXBcbiIpOwotCQlwYWRkciA9IGRldl9wcml2LT5kc20uZW5kICsgMSAtIHBjdHhf
c2l6ZTsKKwkJcGFkZHIgPSBpOTE1LT5kc20uZW5kICsgMSAtIHBjdHhfc2l6ZTsKIAkJR0VNX0JV
R19PTihwYWRkciA+IFUzMl9NQVgpOwogCiAJCXBjdHhfcGFkZHIgPSAocGFkZHIgJiAofjQwOTUp
KTsKQEAgLTc3MDcsNyArNzcwNyw3IEBAIHN0YXRpYyB2b2lkIGNoZXJyeXZpZXdfc2V0dXBfcGN0
eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJRFJNX0RFQlVHX0RSSVZFUigi
UENCUjogMHglMDh4XG4iLCBJOTE1X1JFQUQoVkxWX1BDQlIpKTsKIH0KIAotc3RhdGljIHZvaWQg
dmFsbGV5dmlld19zZXR1cF9wY3R4KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3N0YXRpYyB2b2lkIHZhbGxleXZpZXdfc2V0dXBfcGN0eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqcGN0eDsKIAlyZXNvdXJj
ZV9zaXplX3QgcGN0eF9wYWRkcjsKQEAgLTc3MTksOCArNzcxOSw4IEBAIHN0YXRpYyB2b2lkIHZh
bGxleXZpZXdfc2V0dXBfcGN0eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
CS8qIEJJT1Mgc2V0IGl0IHVwIGFscmVhZHksIGdyYWIgdGhlIHByZS1hbGxvYydkIHNwYWNlICov
CiAJCXJlc291cmNlX3NpemVfdCBwY2JyX29mZnNldDsKIAotCQlwY2JyX29mZnNldCA9IChwY2Jy
ICYgKH40MDk1KSkgLSBkZXZfcHJpdi0+ZHNtLnN0YXJ0OwotCQlwY3R4ID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChkZXZfcHJpdiwKKwkJcGNicl9vZmZz
ZXQgPSAocGNiciAmICh+NDA5NSkpIC0gaTkxNS0+ZHNtLnN0YXJ0OworCQlwY3R4ID0gaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChpOTE1LAogCQkJCQkJCQkg
ICAgICBwY2JyX29mZnNldCwKIAkJCQkJCQkJICAgICAgSTkxNV9HVFRfT0ZGU0VUX05PTkUsCiAJ
CQkJCQkJCSAgICAgIHBjdHhfc2l6ZSk7CkBAIC03NzM3LDE0OCArNzczNywxNDggQEAgc3RhdGlj
IHZvaWQgdmFsbGV5dmlld19zZXR1cF9wY3R4KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkgKiBvdmVybGFwIHdpdGggb3RoZXIgcmFuZ2VzLCBzdWNoIGFzIHRoZSBmcmFtZSBi
dWZmZXIsIHByb3RlY3RlZAogCSAqIG1lbW9yeSwgb3IgYW55IG90aGVyIHJlbGV2YW50IHJhbmdl
cy4KIAkgKi8KLQlwY3R4ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4oZGV2X3ByaXYs
IHBjdHhfc2l6ZSk7CisJcGN0eCA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGk5MTUs
IHBjdHhfc2l6ZSk7CiAJaWYgKCFwY3R4KSB7CiAJCURSTV9ERUJVRygibm90IGVub3VnaCBzdG9s
ZW4gc3BhY2UgZm9yIFBDVFgsIGRpc2FibGluZ1xuIik7CiAJCWdvdG8gb3V0OwogCX0KIAogCUdF
TV9CVUdfT04ocmFuZ2Vfb3ZlcmZsb3dzX3QodTY0LAotCQkJCSAgICAgZGV2X3ByaXYtPmRzbS5z
dGFydCwKKwkJCQkgICAgIGk5MTUtPmRzbS5zdGFydCwKIAkJCQkgICAgIHBjdHgtPnN0b2xlbi0+
c3RhcnQsCiAJCQkJICAgICBVMzJfTUFYKSk7Ci0JcGN0eF9wYWRkciA9IGRldl9wcml2LT5kc20u
c3RhcnQgKyBwY3R4LT5zdG9sZW4tPnN0YXJ0OworCXBjdHhfcGFkZHIgPSBpOTE1LT5kc20uc3Rh
cnQgKyBwY3R4LT5zdG9sZW4tPnN0YXJ0OwogCUk5MTVfV1JJVEUoVkxWX1BDQlIsIHBjdHhfcGFk
ZHIpOwogCiBvdXQ6CiAJRFJNX0RFQlVHX0RSSVZFUigiUENCUjogMHglMDh4XG4iLCBJOTE1X1JF
QUQoVkxWX1BDQlIpKTsKLQlkZXZfcHJpdi0+dmx2X3BjdHggPSBwY3R4OworCWk5MTUtPnZsdl9w
Y3R4ID0gcGN0eDsKIH0KIAotc3RhdGljIHZvaWQgdmFsbGV5dmlld19jbGVhbnVwX3BjdHgoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmFsbGV5dmlld19j
bGVhbnVwX3BjdHgoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKnBjdHg7CiAKLQlwY3R4ID0gZmV0Y2hfYW5kX3plcm8oJmRldl9w
cml2LT52bHZfcGN0eCk7CisJcGN0eCA9IGZldGNoX2FuZF96ZXJvKCZpOTE1LT52bHZfcGN0eCk7
CiAJaWYgKHBjdHgpCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQocGN0eCk7CiB9CiAKLXN0YXRpYyB2
b2lkIHZsdl9pbml0X2dwbGxfcmVmX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIHZvaWQgdmx2X2luaXRfZ3BsbF9yZWZfZnJlcShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKLQlkZXZfcHJpdi0+Z3RfcG0ucnBzLmdwbGxfcmVmX2ZyZXEgPQot
CQl2bHZfZ2V0X2Nja19jbG9jayhkZXZfcHJpdiwgIkdQTEwgcmVmIiwKKwlpOTE1LT5ndF9wbS5y
cHMuZ3BsbF9yZWZfZnJlcSA9CisJCXZsdl9nZXRfY2NrX2Nsb2NrKGk5MTUsICJHUExMIHJlZiIs
CiAJCQkJICBDQ0tfR1BMTF9DTE9DS19DT05UUk9MLAotCQkJCSAgZGV2X3ByaXYtPmN6Y2xrX2Zy
ZXEpOworCQkJCSAgaTkxNS0+Y3pjbGtfZnJlcSk7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCJHUExM
IHJlZmVyZW5jZSBmcmVxOiAlZCBrSHpcbiIsCi0JCQkgZGV2X3ByaXYtPmd0X3BtLnJwcy5ncGxs
X3JlZl9mcmVxKTsKKwkJCSBpOTE1LT5ndF9wbS5ycHMuZ3BsbF9yZWZfZnJlcSk7CiB9CiAKLXN0
YXRpYyB2b2lkIHZhbGxleXZpZXdfaW5pdF9ndF9wb3dlcnNhdmUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmFsbGV5dmlld19pbml0X2d0X3Bvd2Vyc2F2
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcnBzICpy
cHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsKKwlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAmaTkx
NS0+Z3RfcG0ucnBzOwogCXUzMiB2YWw7CiAKLQl2YWxsZXl2aWV3X3NldHVwX3BjdHgoZGV2X3By
aXYpOworCXZhbGxleXZpZXdfc2V0dXBfcGN0eChpOTE1KTsKIAotCXZsdl9pb3NmX3NiX2dldChk
ZXZfcHJpdiwKKwl2bHZfaW9zZl9zYl9nZXQoaTkxNSwKIAkJCUJJVChWTFZfSU9TRl9TQl9QVU5J
VCkgfAogCQkJQklUKFZMVl9JT1NGX1NCX05DKSB8CiAJCQlCSVQoVkxWX0lPU0ZfU0JfQ0NLKSk7
CiAKLQl2bHZfaW5pdF9ncGxsX3JlZl9mcmVxKGRldl9wcml2KTsKKwl2bHZfaW5pdF9ncGxsX3Jl
Zl9mcmVxKGk5MTUpOwogCi0JdmFsID0gdmx2X3B1bml0X3JlYWQoZGV2X3ByaXYsIFBVTklUX1JF
R19HUFVfRlJFUV9TVFMpOworCXZhbCA9IHZsdl9wdW5pdF9yZWFkKGk5MTUsIFBVTklUX1JFR19H
UFVfRlJFUV9TVFMpOwogCXN3aXRjaCAoKHZhbCA+PiA2KSAmIDMpIHsKIAljYXNlIDA6CiAJY2Fz
ZSAxOgotCQlkZXZfcHJpdi0+bWVtX2ZyZXEgPSA4MDA7CisJCWk5MTUtPm1lbV9mcmVxID0gODAw
OwogCQlicmVhazsKIAljYXNlIDI6Ci0JCWRldl9wcml2LT5tZW1fZnJlcSA9IDEwNjY7CisJCWk5
MTUtPm1lbV9mcmVxID0gMTA2NjsKIAkJYnJlYWs7CiAJY2FzZSAzOgotCQlkZXZfcHJpdi0+bWVt
X2ZyZXEgPSAxMzMzOworCQlpOTE1LT5tZW1fZnJlcSA9IDEzMzM7CiAJCWJyZWFrOwogCX0KLQlE
Uk1fREVCVUdfRFJJVkVSKCJERFIgc3BlZWQ6ICVkIE1IelxuIiwgZGV2X3ByaXYtPm1lbV9mcmVx
KTsKKwlEUk1fREVCVUdfRFJJVkVSKCJERFIgc3BlZWQ6ICVkIE1IelxuIiwgaTkxNS0+bWVtX2Zy
ZXEpOwogCi0JcnBzLT5tYXhfZnJlcSA9IHZhbGxleXZpZXdfcnBzX21heF9mcmVxKGRldl9wcml2
KTsKKwlycHMtPm1heF9mcmVxID0gdmFsbGV5dmlld19ycHNfbWF4X2ZyZXEoaTkxNSk7CiAJcnBz
LT5ycDBfZnJlcSA9IHJwcy0+bWF4X2ZyZXE7CiAJRFJNX0RFQlVHX0RSSVZFUigibWF4IEdQVSBm
cmVxOiAlZCBNSHogKCV1KVxuIiwKLQkJCSBpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwgcnBzLT5t
YXhfZnJlcSksCisJCQkgaW50ZWxfZ3B1X2ZyZXEoaTkxNSwgcnBzLT5tYXhfZnJlcSksCiAJCQkg
cnBzLT5tYXhfZnJlcSk7CiAKLQlycHMtPmVmZmljaWVudF9mcmVxID0gdmFsbGV5dmlld19ycHNf
cnBlX2ZyZXEoZGV2X3ByaXYpOworCXJwcy0+ZWZmaWNpZW50X2ZyZXEgPSB2YWxsZXl2aWV3X3Jw
c19ycGVfZnJlcShpOTE1KTsKIAlEUk1fREVCVUdfRFJJVkVSKCJSUGUgR1BVIGZyZXE6ICVkIE1I
eiAoJXUpXG4iLAotCQkJIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBycHMtPmVmZmljaWVudF9m
cmVxKSwKKwkJCSBpbnRlbF9ncHVfZnJlcShpOTE1LCBycHMtPmVmZmljaWVudF9mcmVxKSwKIAkJ
CSBycHMtPmVmZmljaWVudF9mcmVxKTsKIAotCXJwcy0+cnAxX2ZyZXEgPSB2YWxsZXl2aWV3X3Jw
c19ndWFyX2ZyZXEoZGV2X3ByaXYpOworCXJwcy0+cnAxX2ZyZXEgPSB2YWxsZXl2aWV3X3Jwc19n
dWFyX2ZyZXEoaTkxNSk7CiAJRFJNX0RFQlVHX0RSSVZFUigiUlAxKEd1YXIgRnJlcSkgR1BVIGZy
ZXE6ICVkIE1IeiAoJXUpXG4iLAotCQkJIGludGVsX2dwdV9mcmVxKGRldl9wcml2LCBycHMtPnJw
MV9mcmVxKSwKKwkJCSBpbnRlbF9ncHVfZnJlcShpOTE1LCBycHMtPnJwMV9mcmVxKSwKIAkJCSBy
cHMtPnJwMV9mcmVxKTsKIAotCXJwcy0+bWluX2ZyZXEgPSB2YWxsZXl2aWV3X3Jwc19taW5fZnJl
cShkZXZfcHJpdik7CisJcnBzLT5taW5fZnJlcSA9IHZhbGxleXZpZXdfcnBzX21pbl9mcmVxKGk5
MTUpOwogCURSTV9ERUJVR19EUklWRVIoIm1pbiBHUFUgZnJlcTogJWQgTUh6ICgldSlcbiIsCi0J
CQkgaW50ZWxfZ3B1X2ZyZXEoZGV2X3ByaXYsIHJwcy0+bWluX2ZyZXEpLAorCQkJIGludGVsX2dw
dV9mcmVxKGk5MTUsIHJwcy0+bWluX2ZyZXEpLAogCQkJIHJwcy0+bWluX2ZyZXEpOwogCi0Jdmx2
X2lvc2Zfc2JfcHV0KGRldl9wcml2LAorCXZsdl9pb3NmX3NiX3B1dChpOTE1LAogCQkJQklUKFZM
Vl9JT1NGX1NCX1BVTklUKSB8CiAJCQlCSVQoVkxWX0lPU0ZfU0JfTkMpIHwKIAkJCUJJVChWTFZf
SU9TRl9TQl9DQ0spKTsKIH0KIAotc3RhdGljIHZvaWQgY2hlcnJ5dmlld19pbml0X2d0X3Bvd2Vy
c2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBjaGVy
cnl2aWV3X2luaXRfZ3RfcG93ZXJzYXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZkZXZfcHJpdi0+Z3RfcG0ucnBzOworCXN0cnVj
dCBpbnRlbF9ycHMgKnJwcyA9ICZpOTE1LT5ndF9wbS5ycHM7CiAJdTMyIHZhbDsKIAotCWNoZXJy
eXZpZXdfc2V0dXBfcGN0eChkZXZfcHJpdik7CisJY2hlcnJ5dmlld19zZXR1cF9wY3R4KGk5MTUp
OwogCi0Jdmx2X2lvc2Zfc2JfZ2V0KGRldl9wcml2LAorCXZsdl9pb3NmX3NiX2dldChpOTE1LAog
CQkJQklUKFZMVl9JT1NGX1NCX1BVTklUKSB8CiAJCQlCSVQoVkxWX0lPU0ZfU0JfTkMpIHwKIAkJ
CUJJVChWTFZfSU9TRl9TQl9DQ0spKTsKIAotCXZsdl9pbml0X2dwbGxfcmVmX2ZyZXEoZGV2X3By
aXYpOworCXZsdl9pbml0X2dwbGxfcmVmX2ZyZXEoaTkxNSk7CiAKLQl2YWwgPSB2bHZfY2NrX3Jl
YWQoZGV2X3ByaXYsIENDS19GVVNFX1JFRyk7CisJdmFsID0gdmx2X2Nja19yZWFkKGk5MTUsIEND
S19GVVNFX1JFRyk7CiAKIAlzd2l0Y2ggKCh2YWwgPj4gMikgJiAweDcpIHsKIAljYXNlIDM6Ci0J
CWRldl9wcml2LT5tZW1fZnJlcSA9IDIwMDA7CisJCWk5MTUtPm1lbV9mcmVxID0gMjAwMDsKIAkJ
YnJlYWs7CiAJZGVmYXVsdDoKLQkJZGV2X3ByaXYtPm1lbV9mcmVxID0gMTYwMDsKKwkJaTkxNS0+
bWVtX2ZyZXEgPSAxNjAwOwogCQlicmVhazsKIAl9Ci0JRFJNX0RFQlVHX0RSSVZFUigiRERSIHNw
ZWVkOiAlZCBNSHpcbiIsIGRldl9wcml2LT5tZW1fZnJlcSk7CisJRFJNX0RFQlVHX0RSSVZFUigi
RERSIHNwZWVkOiAlZCBNSHpcbiIsIGk5MTUtPm1lbV9mcmVxKTsKIAotCXJwcy0+bWF4X2ZyZXEg
PSBjaGVycnl2aWV3X3Jwc19tYXhfZnJlcShkZXZfcHJpdik7CisJcnBzLT5tYXhfZnJlcSA9IGNo
ZXJyeXZpZXdfcnBzX21heF9mcmVxKGk5MTUpOwogCXJwcy0+cnAwX2ZyZXEgPSBycHMtPm1heF9m
cmVxOwogCURSTV9ERUJVR19EUklWRVIoIm1heCBHUFUgZnJlcTogJWQgTUh6ICgldSlcbiIsCi0J
CQkgaW50ZWxfZ3B1X2ZyZXEoZGV2X3ByaXYsIHJwcy0+bWF4X2ZyZXEpLAorCQkJIGludGVsX2dw
dV9mcmVxKGk5MTUsIHJwcy0+bWF4X2ZyZXEpLAogCQkJIHJwcy0+bWF4X2ZyZXEpOwogCi0JcnBz
LT5lZmZpY2llbnRfZnJlcSA9IGNoZXJyeXZpZXdfcnBzX3JwZV9mcmVxKGRldl9wcml2KTsKKwly
cHMtPmVmZmljaWVudF9mcmVxID0gY2hlcnJ5dmlld19ycHNfcnBlX2ZyZXEoaTkxNSk7CiAJRFJN
X0RFQlVHX0RSSVZFUigiUlBlIEdQVSBmcmVxOiAlZCBNSHogKCV1KVxuIiwKLQkJCSBpbnRlbF9n
cHVfZnJlcShkZXZfcHJpdiwgcnBzLT5lZmZpY2llbnRfZnJlcSksCisJCQkgaW50ZWxfZ3B1X2Zy
ZXEoaTkxNSwgcnBzLT5lZmZpY2llbnRfZnJlcSksCiAJCQkgcnBzLT5lZmZpY2llbnRfZnJlcSk7
CiAKLQlycHMtPnJwMV9mcmVxID0gY2hlcnJ5dmlld19ycHNfZ3Vhcl9mcmVxKGRldl9wcml2KTsK
KwlycHMtPnJwMV9mcmVxID0gY2hlcnJ5dmlld19ycHNfZ3Vhcl9mcmVxKGk5MTUpOwogCURSTV9E
RUJVR19EUklWRVIoIlJQMShHdWFyKSBHUFUgZnJlcTogJWQgTUh6ICgldSlcbiIsCi0JCQkgaW50
ZWxfZ3B1X2ZyZXEoZGV2X3ByaXYsIHJwcy0+cnAxX2ZyZXEpLAorCQkJIGludGVsX2dwdV9mcmVx
KGk5MTUsIHJwcy0+cnAxX2ZyZXEpLAogCQkJIHJwcy0+cnAxX2ZyZXEpOwogCi0JcnBzLT5taW5f
ZnJlcSA9IGNoZXJyeXZpZXdfcnBzX21pbl9mcmVxKGRldl9wcml2KTsKKwlycHMtPm1pbl9mcmVx
ID0gY2hlcnJ5dmlld19ycHNfbWluX2ZyZXEoaTkxNSk7CiAJRFJNX0RFQlVHX0RSSVZFUigibWlu
IEdQVSBmcmVxOiAlZCBNSHogKCV1KVxuIiwKLQkJCSBpbnRlbF9ncHVfZnJlcShkZXZfcHJpdiwg
cnBzLT5taW5fZnJlcSksCisJCQkgaW50ZWxfZ3B1X2ZyZXEoaTkxNSwgcnBzLT5taW5fZnJlcSks
CiAJCQkgcnBzLT5taW5fZnJlcSk7CiAKLQl2bHZfaW9zZl9zYl9wdXQoZGV2X3ByaXYsCisJdmx2
X2lvc2Zfc2JfcHV0KGk5MTUsCiAJCQlCSVQoVkxWX0lPU0ZfU0JfUFVOSVQpIHwKIAkJCUJJVChW
TFZfSU9TRl9TQl9OQykgfAogCQkJQklUKFZMVl9JT1NGX1NCX0NDSykpOwpAQCAtNzg4OCwxMiAr
Nzg4OCwxMiBAQCBzdGF0aWMgdm9pZCBjaGVycnl2aWV3X2luaXRfZ3RfcG93ZXJzYXZlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICAiT2RkIEdQVSBmcmVxIHZhbHVlc1xu
Iik7CiB9CiAKLXN0YXRpYyB2b2lkIHZhbGxleXZpZXdfY2xlYW51cF9ndF9wb3dlcnNhdmUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmFsbGV5dmlld19j
bGVhbnVwX2d0X3Bvd2Vyc2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQl2
YWxsZXl2aWV3X2NsZWFudXBfcGN0eChkZXZfcHJpdik7CisJdmFsbGV5dmlld19jbGVhbnVwX3Bj
dHgoaTkxNSk7CiB9CiAKLXN0YXRpYyB2b2lkIGNoZXJyeXZpZXdfZW5hYmxlX3JjNihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBjaGVycnl2aWV3X2VuYWJs
ZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwpAQCAtNzkwNywxMSAr
NzkwNywxMSBAQCBzdGF0aWMgdm9pZCBjaGVycnl2aWV3X2VuYWJsZV9yYzYoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlJOTE1X1dSSVRFKEdURklGT0RCRywgZ3RmaWZvZGJn
KTsKIAl9CiAKLQljaGVycnl2aWV3X2NoZWNrX3BjdHgoZGV2X3ByaXYpOworCWNoZXJyeXZpZXdf
Y2hlY2tfcGN0eChpOTE1KTsKIAogCS8qIDFhICYgMWI6IEdldCBmb3JjZXdha2UgZHVyaW5nIHBy
b2dyYW0gc2VxdWVuY2UuIEFsdGhvdWdoIHRoZSBkcml2ZXIKIAkgKiBoYXNuJ3QgZW5hYmxlZCBh
IHN0YXRlIHlldCB3aGVyZSB3ZSBuZWVkIGZvcmNld2FrZSwgQklPUyBtYXkgaGF2ZS4qLwotCWlu
dGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxM
KTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0Vf
QUxMKTsKIAogCS8qICBEaXNhYmxlIFJDIHN0YXRlcy4gKi8KIAlJOTE1X1dSSVRFKEdFTjZfUkNf
Q09OVFJPTCwgMCk7CkBAIC03OTIxLDcgKzc5MjEsNyBAQCBzdGF0aWMgdm9pZCBjaGVycnl2aWV3
X2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVfV1JJ
VEUoR0VONl9SQ19FVkFMVUFUSU9OX0lOVEVSVkFMLCAxMjUwMDApOyAvKiAxMjUwMCAqIDEyODBu
cyAqLwogCUk5MTVfV1JJVEUoR0VONl9SQ19JRExFX0hZU1RFUlNJUywgMjUpOyAvKiAyNSAqIDEy
ODBucyAqLwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZGV2X3ByaXYsIGlkKQorCWZvcl9l
YWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQlJOTE1X1dSSVRFKFJJTkdfTUFYX0lETEUo
ZW5naW5lLT5tbWlvX2Jhc2UpLCAxMCk7CiAJSTkxNV9XUklURShHRU42X1JDX1NMRUVQLCAwKTsK
IApAQCAtNzk0MywxNCArNzk0MywxNCBAQCBzdGF0aWMgdm9pZCBjaGVycnl2aWV3X2VuYWJsZV9y
YzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlyYzZfbW9kZSA9IEdFTjdf
UkNfQ1RMX1RPX01PREU7CiAJSTkxNV9XUklURShHRU42X1JDX0NPTlRST0wsIHJjNl9tb2RlKTsK
IAotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JD
RVdBS0VfQUxMKTsKIH0KIAotc3RhdGljIHZvaWQgY2hlcnJ5dmlld19lbmFibGVfcnBzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGNoZXJyeXZpZXdfZW5h
YmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFsOwogCi0J
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FL
RV9BTEwpOwogCiAJLyogMTogUHJvZ3JhbSBkZWZhdWx0cyBhbmQgdGhyZXNob2xkcyBmb3IgUlBT
Ki8KIAlJOTE1X1dSSVRFKEdFTjZfUlBfRE9XTl9USU1FT1VULCAxMDAwMDAwKTsKQEAgLTc5NzAs
MTQgKzc5NzAsMTQgQEAgc3RhdGljIHZvaWQgY2hlcnJ5dmlld19lbmFibGVfcnBzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICAgR0VONl9SUF9ET1dOX0lETEVfQVZHKTsK
IAogCS8qIFNldHRpbmcgRml4ZWQgQmlhcyAqLwotCXZsdl9wdW5pdF9nZXQoZGV2X3ByaXYpOwor
CXZsdl9wdW5pdF9nZXQoaTkxNSk7CiAKIAl2YWwgPSBWTFZfT1ZFUlJJREVfRU4gfCBWTFZfU09D
X1REUF9FTiB8IENIVl9CSUFTX0NQVV81MF9TT0NfNTA7Ci0Jdmx2X3B1bml0X3dyaXRlKGRldl9w
cml2LCBWTFZfVFVSQk9fU09DX09WRVJSSURFLCB2YWwpOworCXZsdl9wdW5pdF93cml0ZShpOTE1
LCBWTFZfVFVSQk9fU09DX09WRVJSSURFLCB2YWwpOwogCi0JdmFsID0gdmx2X3B1bml0X3JlYWQo
ZGV2X3ByaXYsIFBVTklUX1JFR19HUFVfRlJFUV9TVFMpOworCXZhbCA9IHZsdl9wdW5pdF9yZWFk
KGk5MTUsIFBVTklUX1JFR19HUFVfRlJFUV9TVFMpOwogCi0Jdmx2X3B1bml0X3B1dChkZXZfcHJp
dik7CisJdmx2X3B1bml0X3B1dChpOTE1KTsKIAogCS8qIFJQUyBjb2RlIGFzc3VtZXMgR1BMTCBp
cyB1c2VkICovCiAJV0FSTl9PTkNFKCh2YWwgJiBHUExMRU5BQkxFKSA9PSAwLCAiR1BMTCBub3Qg
ZW5hYmxlZFxuIik7CkBAIC03OTg1LDE4ICs3OTg1LDE4IEBAIHN0YXRpYyB2b2lkIGNoZXJyeXZp
ZXdfZW5hYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJRFJNX0RF
QlVHX0RSSVZFUigiR1BMTCBlbmFibGVkPyAlc1xuIiwgeWVzbm8odmFsICYgR1BMTEVOQUJMRSkp
OwogCURSTV9ERUJVR19EUklWRVIoIkdQVSBzdGF0dXM6IDB4JTA4eFxuIiwgdmFsKTsKIAotCXJl
c2V0X3JwcyhkZXZfcHJpdiwgdmFsbGV5dmlld19zZXRfcnBzKTsKKwlyZXNldF9ycHMoaTkxNSwg
dmFsbGV5dmlld19zZXRfcnBzKTsKIAotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZkZXZf
cHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1
dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIH0KIAotc3RhdGljIHZvaWQgdmFsbGV5
dmlld19lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRp
YyB2b2lkIHZhbGxleXZpZXdfZW5hYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdp
bmVfaWQgaWQ7CiAJdTMyIGd0Zmlmb2RiZzsKIAotCXZhbGxleXZpZXdfY2hlY2tfcGN0eChkZXZf
cHJpdik7CisJdmFsbGV5dmlld19jaGVja19wY3R4KGk5MTUpOwogCiAJZ3RmaWZvZGJnID0gSTkx
NV9SRUFEKEdURklGT0RCRyk7CiAJaWYgKGd0Zmlmb2RiZykgewpAQCAtODAwNSw3ICs4MDA1LDcg
QEAgc3RhdGljIHZvaWQgdmFsbGV5dmlld19lbmFibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAkJSTkxNV9XUklURShHVEZJRk9EQkcsIGd0Zmlmb2RiZyk7CiAJfQog
Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FL
RV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNF
V0FLRV9BTEwpOwogCiAJLyogIERpc2FibGUgUkMgc3RhdGVzLiAqLwogCUk5MTVfV1JJVEUoR0VO
Nl9SQ19DT05UUk9MLCAwKTsKQEAgLTgwMTQsNyArODAxNCw3IEBAIHN0YXRpYyB2b2lkIHZhbGxl
eXZpZXdfZW5hYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkx
NV9XUklURShHRU42X1JDX0VWQUxVQVRJT05fSU5URVJWQUwsIDEyNTAwMCk7CiAJSTkxNV9XUklU
RShHRU42X1JDX0lETEVfSFlTVEVSU0lTLCAyNSk7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBkZXZfcHJpdiwgaWQpCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCUk5
MTVfV1JJVEUoUklOR19NQVhfSURMRShlbmdpbmUtPm1taW9fYmFzZSksIDEwKTsKIAogCUk5MTVf
V1JJVEUoR0VONl9SQzZfVEhSRVNIT0xELCAweDU1Nyk7CkBAIC04MDMwLDE0ICs4MDMwLDE0IEBA
IHN0YXRpYyB2b2lkIHZhbGxleXZpZXdfZW5hYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShHRU42X1JDX0NPTlRST0wsCiAJCSAgIEdFTjdfUkNf
Q1RMX1RPX01PREUgfCBWTFZfUkNfQ1RMX0NUWF9SU1RfUEFSQUxMRUwpOwogCi0JaW50ZWxfdW5j
b3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWlu
dGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwog
fQogCi1zdGF0aWMgdm9pZCB2YWxsZXl2aWV3X2VuYWJsZV9ycHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmFsbGV5dmlld19lbmFibGVfcnBzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXUzMiB2YWw7CiAKLQlpbnRlbF91bmNvcmVf
Zm9yY2V3YWtlX2dldCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJaW50ZWxf
dW5jb3JlX2ZvcmNld2FrZV9nZXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKIAlJ
OTE1X1dSSVRFKEdFTjZfUlBfRE9XTl9USU1FT1VULCAxMDAwMDAwKTsKIAlJOTE1X1dSSVRFKEdF
TjZfUlBfVVBfVEhSRVNIT0xELCA1OTQwMCk7CkBAIC04MDU1LDE1ICs4MDU1LDE1IEBAIHN0YXRp
YyB2b2lkIHZhbGxleXZpZXdfZW5hYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJCSAgIEdFTjZfUlBfVVBfQlVTWV9BVkcgfAogCQkgICBHRU42X1JQX0RPV05fSURM
RV9DT05UKTsKIAotCXZsdl9wdW5pdF9nZXQoZGV2X3ByaXYpOworCXZsdl9wdW5pdF9nZXQoaTkx
NSk7CiAKIAkvKiBTZXR0aW5nIEZpeGVkIEJpYXMgKi8KIAl2YWwgPSBWTFZfT1ZFUlJJREVfRU4g
fCBWTFZfU09DX1REUF9FTiB8IFZMVl9CSUFTX0NQVV8xMjVfU09DXzg3NTsKLQl2bHZfcHVuaXRf
d3JpdGUoZGV2X3ByaXYsIFZMVl9UVVJCT19TT0NfT1ZFUlJJREUsIHZhbCk7CisJdmx2X3B1bml0
X3dyaXRlKGk5MTUsIFZMVl9UVVJCT19TT0NfT1ZFUlJJREUsIHZhbCk7CiAKLQl2YWwgPSB2bHZf
cHVuaXRfcmVhZChkZXZfcHJpdiwgUFVOSVRfUkVHX0dQVV9GUkVRX1NUUyk7CisJdmFsID0gdmx2
X3B1bml0X3JlYWQoaTkxNSwgUFVOSVRfUkVHX0dQVV9GUkVRX1NUUyk7CiAKLQl2bHZfcHVuaXRf
cHV0KGRldl9wcml2KTsKKwl2bHZfcHVuaXRfcHV0KGk5MTUpOwogCiAJLyogUlBTIGNvZGUgYXNz
dW1lcyBHUExMIGlzIHVzZWQgKi8KIAlXQVJOX09OQ0UoKHZhbCAmIEdQTExFTkFCTEUpID09IDAs
ICJHUExMIG5vdCBlbmFibGVkXG4iKTsKQEAgLTgwNzEsOSArODA3MSw5IEBAIHN0YXRpYyB2b2lk
IHZhbGxleXZpZXdfZW5hYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJRFJNX0RFQlVHX0RSSVZFUigiR1BMTCBlbmFibGVkPyAlc1xuIiwgeWVzbm8odmFsICYgR1BM
TEVOQUJMRSkpOwogCURSTV9ERUJVR19EUklWRVIoIkdQVSBzdGF0dXM6IDB4JTA4eFxuIiwgdmFs
KTsKIAotCXJlc2V0X3JwcyhkZXZfcHJpdiwgdmFsbGV5dmlld19zZXRfcnBzKTsKKwlyZXNldF9y
cHMoaTkxNSwgdmFsbGV5dmlld19zZXRfcnBzKTsKIAotCWludGVsX3VuY29yZV9mb3JjZXdha2Vf
cHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9y
Y2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIH0KIAogc3RhdGljIHVu
c2lnbmVkIGxvbmcgaW50ZWxfcHhmcmVxKHUzMiB2aWRmcmVxKQpAQCAtODEwNSw3ICs4MTA1LDcg
QEAgc3RhdGljIGNvbnN0IHN0cnVjdCBjcGFyYW1zIHsKIAl7IDAsIDgwMCwgMjMxLCAyMzc4NCB9
LAogfTsKIAotc3RhdGljIHVuc2lnbmVkIGxvbmcgX19pOTE1X2NoaXBzZXRfdmFsKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB1bnNpZ25lZCBsb25nIF9faTkxNV9j
aGlwc2V0X3ZhbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1NjQgdG90YWxf
Y291bnQsIGRpZmYsIHJldDsKIAl1MzIgY291bnQxLCBjb3VudDIsIGNvdW50MywgbSA9IDAsIGMg
PSAwOwpAQCAtODExNCw3ICs4MTE0LDcgQEAgc3RhdGljIHVuc2lnbmVkIGxvbmcgX19pOTE1X2No
aXBzZXRfdmFsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJm1jaGRldl9sb2NrKTsKIAotCWRpZmYxID0gbm93IC0gZGV2X3ByaXYtPmlw
cy5sYXN0X3RpbWUxOworCWRpZmYxID0gbm93IC0gaTkxNS0+aXBzLmxhc3RfdGltZTE7CiAKIAkv
KiBQcmV2ZW50IGRpdmlzaW9uLWJ5LXplcm8gaWYgd2UgYXJlIGFza2luZyB0b28gZmFzdC4KIAkg
KiBBbHNvLCB3ZSBkb24ndCBnZXQgaW50ZXJlc3RpbmcgcmVzdWx0cyBpZiB3ZSBhcmUgcG9sbGlu
ZwpAQCAtODEyMiw3ICs4MTIyLDcgQEAgc3RhdGljIHVuc2lnbmVkIGxvbmcgX19pOTE1X2NoaXBz
ZXRfdmFsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBpbiBzdWNoIGNh
c2VzLgogCSAqLwogCWlmIChkaWZmMSA8PSAxMCkKLQkJcmV0dXJuIGRldl9wcml2LT5pcHMuY2hp
cHNldF9wb3dlcjsKKwkJcmV0dXJuIGk5MTUtPmlwcy5jaGlwc2V0X3Bvd2VyOwogCiAJY291bnQx
ID0gSTkxNV9SRUFEKERNSUVDKTsKIAljb3VudDIgPSBJOTE1X1JFQUQoRERSRUMpOwpAQCAtODEz
MSwxNiArODEzMSwxNiBAQCBzdGF0aWMgdW5zaWduZWQgbG9uZyBfX2k5MTVfY2hpcHNldF92YWwo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXRvdGFsX2NvdW50ID0gY291bnQx
ICsgY291bnQyICsgY291bnQzOwogCiAJLyogRklYTUU6IGhhbmRsZSBwZXItY291bnRlciBvdmVy
ZmxvdyAqLwotCWlmICh0b3RhbF9jb3VudCA8IGRldl9wcml2LT5pcHMubGFzdF9jb3VudDEpIHsK
LQkJZGlmZiA9IH4wVUwgLSBkZXZfcHJpdi0+aXBzLmxhc3RfY291bnQxOworCWlmICh0b3RhbF9j
b3VudCA8IGk5MTUtPmlwcy5sYXN0X2NvdW50MSkgeworCQlkaWZmID0gfjBVTCAtIGk5MTUtPmlw
cy5sYXN0X2NvdW50MTsKIAkJZGlmZiArPSB0b3RhbF9jb3VudDsKIAl9IGVsc2UgewotCQlkaWZm
ID0gdG90YWxfY291bnQgLSBkZXZfcHJpdi0+aXBzLmxhc3RfY291bnQxOworCQlkaWZmID0gdG90
YWxfY291bnQgLSBpOTE1LT5pcHMubGFzdF9jb3VudDE7CiAJfQogCiAJZm9yIChpID0gMDsgaSA8
IEFSUkFZX1NJWkUoY3BhcmFtcyk7IGkrKykgewotCQlpZiAoY3BhcmFtc1tpXS5pID09IGRldl9w
cml2LT5pcHMuY19tICYmCi0JCSAgICBjcGFyYW1zW2ldLnQgPT0gZGV2X3ByaXYtPmlwcy5yX3Qp
IHsKKwkJaWYgKGNwYXJhbXNbaV0uaSA9PSBpOTE1LT5pcHMuY19tICYmCisJCSAgICBjcGFyYW1z
W2ldLnQgPT0gaTkxNS0+aXBzLnJfdCkgewogCQkJbSA9IGNwYXJhbXNbaV0ubTsKIAkJCWMgPSBj
cGFyYW1zW2ldLmM7CiAJCQlicmVhazsKQEAgLTgxNTEsMjUgKzgxNTEsMjUgQEAgc3RhdGljIHVu
c2lnbmVkIGxvbmcgX19pOTE1X2NoaXBzZXRfdmFsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAlyZXQgPSAoKG0gKiBkaWZmKSArIGMpOwogCXJldCA9IGRpdl91NjQocmV0LCAx
MCk7CiAKLQlkZXZfcHJpdi0+aXBzLmxhc3RfY291bnQxID0gdG90YWxfY291bnQ7Ci0JZGV2X3By
aXYtPmlwcy5sYXN0X3RpbWUxID0gbm93OworCWk5MTUtPmlwcy5sYXN0X2NvdW50MSA9IHRvdGFs
X2NvdW50OworCWk5MTUtPmlwcy5sYXN0X3RpbWUxID0gbm93OwogCi0JZGV2X3ByaXYtPmlwcy5j
aGlwc2V0X3Bvd2VyID0gcmV0OworCWk5MTUtPmlwcy5jaGlwc2V0X3Bvd2VyID0gcmV0OwogCiAJ
cmV0dXJuIHJldDsKIH0KIAotdW5zaWduZWQgbG9uZyBpOTE1X2NoaXBzZXRfdmFsKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3Vuc2lnbmVkIGxvbmcgaTkxNV9jaGlwc2V0X3Zh
bChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZjsKIAl1bnNpZ25lZCBsb25nIHZhbCA9IDA7CiAKLQlpZiAoIUlTX0dFTihkZXZfcHJpdiwg
NSkpCisJaWYgKCFJU19HRU4oaTkxNSwgNSkpCiAJCXJldHVybiAwOwogCi0Jd2l0aF9pbnRlbF9y
dW50aW1lX3BtKGRldl9wcml2LCB3YWtlcmVmKSB7CisJd2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5
MTUsIHdha2VyZWYpIHsKIAkJc3Bpbl9sb2NrX2lycSgmbWNoZGV2X2xvY2spOwotCQl2YWwgPSBf
X2k5MTVfY2hpcHNldF92YWwoZGV2X3ByaXYpOworCQl2YWwgPSBfX2k5MTVfY2hpcHNldF92YWwo
aTkxNSk7CiAJCXNwaW5fdW5sb2NrX2lycSgmbWNoZGV2X2xvY2spOwogCX0KIApAQCAtODIwMiwx
OCArODIwMiwxOCBAQCBzdGF0aWMgaW50IF9weHZpZF90b192ZCh1OCBweHZpZCkKIAlyZXR1cm4g
KHB4dmlkICsgMikgKiAxMjU7CiB9CiAKLXN0YXRpYyB1MzIgcHZpZF90b19leHR2aWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBweHZpZCkKK3N0YXRpYyB1MzIgcHZpZF90
b19leHR2aWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU4IHB4dmlkKQogewogCWNv
bnN0IGludCB2ZCA9IF9weHZpZF90b192ZChweHZpZCk7CiAJY29uc3QgaW50IHZtID0gdmQgLSAx
MTI1OwogCi0JaWYgKElOVEVMX0lORk8oZGV2X3ByaXYpLT5pc19tb2JpbGUpCisJaWYgKElOVEVM
X0lORk8oaTkxNSktPmlzX21vYmlsZSkKIAkJcmV0dXJuIHZtID4gMCA/IHZtIDogMDsKIAogCXJl
dHVybiB2ZDsKIH0KIAotc3RhdGljIHZvaWQgX19pOTE1X3VwZGF0ZV9nZnhfdmFsKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIF9faTkxNV91cGRhdGVfZ2Z4
X3ZhbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1NjQgbm93LCBkaWZmLCBk
aWZmbXM7CiAJdTMyIGNvdW50OwpAQCAtODIyMSw3ICs4MjIxLDcgQEAgc3RhdGljIHZvaWQgX19p
OTE1X3VwZGF0ZV9nZnhfdmFsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAls
b2NrZGVwX2Fzc2VydF9oZWxkKCZtY2hkZXZfbG9jayk7CiAKIAlub3cgPSBrdGltZV9nZXRfcmF3
X25zKCk7Ci0JZGlmZm1zID0gbm93IC0gZGV2X3ByaXYtPmlwcy5sYXN0X3RpbWUyOworCWRpZmZt
cyA9IG5vdyAtIGk5MTUtPmlwcy5sYXN0X3RpbWUyOwogCWRvX2RpdihkaWZmbXMsIE5TRUNfUEVS
X01TRUMpOwogCiAJLyogRG9uJ3QgZGl2aWRlIGJ5IDAgKi8KQEAgLTgyMzAsNTAgKzgyMzAsNTAg
QEAgc3RhdGljIHZvaWQgX19pOTE1X3VwZGF0ZV9nZnhfdmFsKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAogCWNvdW50ID0gSTkxNV9SRUFEKEdGWEVDKTsKIAotCWlmIChjb3Vu
dCA8IGRldl9wcml2LT5pcHMubGFzdF9jb3VudDIpIHsKLQkJZGlmZiA9IH4wVUwgLSBkZXZfcHJp
di0+aXBzLmxhc3RfY291bnQyOworCWlmIChjb3VudCA8IGk5MTUtPmlwcy5sYXN0X2NvdW50Mikg
eworCQlkaWZmID0gfjBVTCAtIGk5MTUtPmlwcy5sYXN0X2NvdW50MjsKIAkJZGlmZiArPSBjb3Vu
dDsKIAl9IGVsc2UgewotCQlkaWZmID0gY291bnQgLSBkZXZfcHJpdi0+aXBzLmxhc3RfY291bnQy
OworCQlkaWZmID0gY291bnQgLSBpOTE1LT5pcHMubGFzdF9jb3VudDI7CiAJfQogCi0JZGV2X3By
aXYtPmlwcy5sYXN0X2NvdW50MiA9IGNvdW50OwotCWRldl9wcml2LT5pcHMubGFzdF90aW1lMiA9
IG5vdzsKKwlpOTE1LT5pcHMubGFzdF9jb3VudDIgPSBjb3VudDsKKwlpOTE1LT5pcHMubGFzdF90
aW1lMiA9IG5vdzsKIAogCS8qIE1vcmUgbWFnaWMgY29uc3RhbnRzLi4uICovCiAJZGlmZiA9IGRp
ZmYgKiAxMTgxOwogCWRpZmYgPSBkaXZfdTY0KGRpZmYsIGRpZmZtcyAqIDEwKTsKLQlkZXZfcHJp
di0+aXBzLmdmeF9wb3dlciA9IGRpZmY7CisJaTkxNS0+aXBzLmdmeF9wb3dlciA9IGRpZmY7CiB9
CiAKLXZvaWQgaTkxNV91cGRhdGVfZ2Z4X3ZhbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCit2b2lkIGk5MTVfdXBkYXRlX2dmeF92YWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAKLQlpZiAoIUlTX0dFTihkZXZf
cHJpdiwgNSkpCisJaWYgKCFJU19HRU4oaTkxNSwgNSkpCiAJCXJldHVybjsKIAotCXdpdGhfaW50
ZWxfcnVudGltZV9wbShkZXZfcHJpdiwgd2FrZXJlZikgeworCXdpdGhfaW50ZWxfcnVudGltZV9w
bShpOTE1LCB3YWtlcmVmKSB7CiAJCXNwaW5fbG9ja19pcnEoJm1jaGRldl9sb2NrKTsKLQkJX19p
OTE1X3VwZGF0ZV9nZnhfdmFsKGRldl9wcml2KTsKKwkJX19pOTE1X3VwZGF0ZV9nZnhfdmFsKGk5
MTUpOwogCQlzcGluX3VubG9ja19pcnEoJm1jaGRldl9sb2NrKTsKIAl9CiB9CiAKLXN0YXRpYyB1
bnNpZ25lZCBsb25nIF9faTkxNV9nZnhfdmFsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3N0YXRpYyB1bnNpZ25lZCBsb25nIF9faTkxNV9nZnhfdmFsKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCXVuc2lnbmVkIGxvbmcgdCwgY29yciwgc3RhdGUxLCBjb3Jy
Miwgc3RhdGUyOwogCXUzMiBweHZpZCwgZXh0X3Y7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZt
Y2hkZXZfbG9jayk7CiAKLQlweHZpZCA9IEk5MTVfUkVBRChQWFZGUkVRKGRldl9wcml2LT5ndF9w
bS5ycHMuY3VyX2ZyZXEpKTsKKwlweHZpZCA9IEk5MTVfUkVBRChQWFZGUkVRKGk5MTUtPmd0X3Bt
LnJwcy5jdXJfZnJlcSkpOwogCXB4dmlkID0gKHB4dmlkID4+IDI0KSAmIDB4N2Y7Ci0JZXh0X3Yg
PSBwdmlkX3RvX2V4dHZpZChkZXZfcHJpdiwgcHh2aWQpOworCWV4dF92ID0gcHZpZF90b19leHR2
aWQoaTkxNSwgcHh2aWQpOwogCiAJc3RhdGUxID0gZXh0X3Y7CiAKLQl0ID0gaTkxNV9tY2hfdmFs
KGRldl9wcml2KTsKKwl0ID0gaTkxNV9tY2hfdmFsKGk5MTUpOwogCiAJLyogUmV2ZWwgaW4gdGhl
IGVtcGlyaWNhbGx5IGRlcml2ZWQgY29uc3RhbnRzICovCiAKQEAgLTgyODcsMjcgKzgyODcsMjcg
QEAgc3RhdGljIHVuc2lnbmVkIGxvbmcgX19pOTE1X2dmeF92YWwoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCiAJY29yciA9IGNvcnIgKiAoKDE1MDE0MiAqIHN0YXRlMSkgLyAx
MDAwMCAtIDc4NjQyKTsKIAljb3JyIC89IDEwMDAwMDsKLQljb3JyMiA9IChjb3JyICogZGV2X3By
aXYtPmlwcy5jb3JyKTsKKwljb3JyMiA9IChjb3JyICogaTkxNS0+aXBzLmNvcnIpOwogCiAJc3Rh
dGUyID0gKGNvcnIyICogc3RhdGUxKSAvIDEwMDAwOwogCXN0YXRlMiAvPSAxMDA7IC8qIGNvbnZl
cnQgdG8gbVcgKi8KIAotCV9faTkxNV91cGRhdGVfZ2Z4X3ZhbChkZXZfcHJpdik7CisJX19pOTE1
X3VwZGF0ZV9nZnhfdmFsKGk5MTUpOwogCi0JcmV0dXJuIGRldl9wcml2LT5pcHMuZ2Z4X3Bvd2Vy
ICsgc3RhdGUyOworCXJldHVybiBpOTE1LT5pcHMuZ2Z4X3Bvd2VyICsgc3RhdGUyOwogfQogCi11
bnNpZ25lZCBsb25nIGk5MTVfZ2Z4X3ZhbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCit1bnNpZ25lZCBsb25nIGk5MTVfZ2Z4X3ZhbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1bnNpZ25lZCBsb25nIHZhbCA9
IDA7CiAKLQlpZiAoIUlTX0dFTihkZXZfcHJpdiwgNSkpCisJaWYgKCFJU19HRU4oaTkxNSwgNSkp
CiAJCXJldHVybiAwOwogCi0Jd2l0aF9pbnRlbF9ydW50aW1lX3BtKGRldl9wcml2LCB3YWtlcmVm
KSB7CisJd2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5MTUsIHdha2VyZWYpIHsKIAkJc3Bpbl9sb2Nr
X2lycSgmbWNoZGV2X2xvY2spOwotCQl2YWwgPSBfX2k5MTVfZ2Z4X3ZhbChkZXZfcHJpdik7CisJ
CXZhbCA9IF9faTkxNV9nZnhfdmFsKGk5MTUpOwogCQlzcGluX3VubG9ja19pcnEoJm1jaGRldl9s
b2NrKTsKIAl9CiAKQEAgLTg0NzEsMTEgKzg0NzEsMTEgQEAgaXBzX3BpbmdfZm9yX2k5MTVfbG9h
ZCh2b2lkKQogCX0KIH0KIAotdm9pZCBpbnRlbF9ncHVfaXBzX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9ncHVfaXBzX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyogV2Ugb25seSByZWdpc3RlciB0aGUgaTkxNSBpcHMg
cGFydCB3aXRoIGludGVsLWlwcyBvbmNlIGV2ZXJ5dGhpbmcgaXMKIAkgKiBzZXQgdXAsIHRvIGF2
b2lkIGludGVsLWlwcyBzbmVha2luZyBpbiBhbmQgcmVhZGluZyBib2d1cyB2YWx1ZXMuICovCi0J
cmN1X2Fzc2lnbl9wb2ludGVyKGk5MTVfbWNoX2RldiwgZGV2X3ByaXYpOworCXJjdV9hc3NpZ25f
cG9pbnRlcihpOTE1X21jaF9kZXYsIGk5MTUpOwogCiAJaXBzX3BpbmdfZm9yX2k5MTVfbG9hZCgp
OwogfQpAQCAtODQ4NSw3ICs4NDg1LDcgQEAgdm9pZCBpbnRlbF9ncHVfaXBzX3RlYXJkb3duKHZv
aWQpCiAJcmN1X2Fzc2lnbl9wb2ludGVyKGk5MTVfbWNoX2RldiwgTlVMTCk7CiB9CiAKLXN0YXRp
YyB2b2lkIGludGVsX2luaXRfZW1vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCBpbnRlbF9pbml0X2Vtb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7CiAJdTMyIGxjZnVzZTsKIAl1OCBweHdbMTZdOwpAQCAtODU1Miw0MCArODU1Miw0MCBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9pbml0X2Vtb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCiAJbGNmdXNlID0gSTkxNV9SRUFEKExDRlVTRTAyKTsKIAotCWRldl9wcml2LT5p
cHMuY29yciA9IChsY2Z1c2UgJiBMQ0ZVU0VfSElWX01BU0spOworCWk5MTUtPmlwcy5jb3JyID0g
KGxjZnVzZSAmIExDRlVTRV9ISVZfTUFTSyk7CiB9CiAKLXZvaWQgaW50ZWxfaW5pdF9ndF9wb3dl
cnNhdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9pbml0
X2d0X3Bvd2Vyc2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qg
aW50ZWxfcnBzICpycHMgPSAmZGV2X3ByaXYtPmd0X3BtLnJwczsKKwlzdHJ1Y3QgaW50ZWxfcnBz
ICpycHMgPSAmaTkxNS0+Z3RfcG0ucnBzOwogCiAJLyoKIAkgKiBSUE0gZGVwZW5kcyBvbiBSQzYg
dG8gc2F2ZSByZXN0b3JlIHRoZSBHVCBIVyBjb250ZXh0LCBzbyBtYWtlIFJDNiBhCiAJICogcmVx
dWlyZW1lbnQuCiAJICovCi0JaWYgKCFzYW5pdGl6ZV9yYzYoZGV2X3ByaXYpKSB7CisJaWYgKCFz
YW5pdGl6ZV9yYzYoaTkxNSkpIHsKIAkJRFJNX0lORk8oIlJDNiBkaXNhYmxlZCwgZGlzYWJsaW5n
IHJ1bnRpbWUgUE0gc3VwcG9ydFxuIik7Ci0JCXBtX3J1bnRpbWVfZ2V0KCZkZXZfcHJpdi0+ZHJt
LnBkZXYtPmRldik7CisJCXBtX3J1bnRpbWVfZ2V0KCZpOTE1LT5kcm0ucGRldi0+ZGV2KTsKIAl9
CiAKIAkvKiBJbml0aWFsaXplIFJQUyBsaW1pdHMgKGZvciB1c2Vyc3BhY2UpICovCi0JaWYgKElT
X0NIRVJSWVZJRVcoZGV2X3ByaXYpKQotCQljaGVycnl2aWV3X2luaXRfZ3RfcG93ZXJzYXZlKGRl
dl9wcml2KTsKLQllbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKLQkJdmFsbGV5dmll
d19pbml0X2d0X3Bvd2Vyc2F2ZShkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA2KQotCQlnZW42X2luaXRfcnBzX2ZyZXF1ZW5jaWVzKGRldl9wcml2KTsKKwlpZiAo
SVNfQ0hFUlJZVklFVyhpOTE1KSkKKwkJY2hlcnJ5dmlld19pbml0X2d0X3Bvd2Vyc2F2ZShpOTE1
KTsKKwllbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpKQorCQl2YWxsZXl2aWV3X2luaXRfZ3Rf
cG93ZXJzYXZlKGk5MTUpOworCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KQorCQlnZW42
X2luaXRfcnBzX2ZyZXF1ZW5jaWVzKGk5MTUpOwogCiAJLyogRGVyaXZlIGluaXRpYWwgdXNlciBw
cmVmZXJlbmNlcy9saW1pdHMgZnJvbSB0aGUgaGFyZHdhcmUgbGltaXRzICovCiAJcnBzLT5tYXhf
ZnJlcV9zb2Z0bGltaXQgPSBycHMtPm1heF9mcmVxOwogCXJwcy0+bWluX2ZyZXFfc29mdGxpbWl0
ID0gcnBzLT5taW5fZnJlcTsKIAogCS8qIEFmdGVyIHNldHRpbmcgbWF4LXNvZnRsaW1pdCwgZmlu
ZCB0aGUgb3ZlcmNsb2NrIG1heCBmcmVxICovCi0JaWYgKElTX0dFTihkZXZfcHJpdiwgNikgfHwK
LQkgICAgSVNfSVZZQlJJREdFKGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSkgewor
CWlmIChJU19HRU4oaTkxNSwgNikgfHwKKwkgICAgSVNfSVZZQlJJREdFKGk5MTUpIHx8IElTX0hB
U1dFTEwoaTkxNSkpIHsKIAkJdTMyIHBhcmFtcyA9IDA7CiAKLQkJc2FuZHlicmlkZ2VfcGNvZGVf
cmVhZChkZXZfcHJpdiwgR0VONl9SRUFEX09DX1BBUkFNUywKKwkJc2FuZHlicmlkZ2VfcGNvZGVf
cmVhZChpOTE1LCBHRU42X1JFQURfT0NfUEFSQU1TLAogCQkJCSAgICAgICAmcGFyYW1zLCBOVUxM
KTsKIAkJaWYgKHBhcmFtcyAmIEJJVCgzMSkpIHsgLyogT0Mgc3VwcG9ydGVkICovCiAJCQlEUk1f
REVCVUdfRFJJVkVSKCJPdmVyY2xvY2tpbmcgc3VwcG9ydGVkLCBtYXg6ICVkTUh6LCBvdmVyY2xv
Y2s6ICVkTUh6XG4iLApAQCAtODYwMSwyNSArODYwMSwyNSBAQCB2b2lkIGludGVsX2luaXRfZ3Rf
cG93ZXJzYXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlycHMtPmN1cl9m
cmVxID0gcnBzLT5pZGxlX2ZyZXE7CiB9CiAKLXZvaWQgaW50ZWxfY2xlYW51cF9ndF9wb3dlcnNh
dmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9jbGVhbnVw
X2d0X3Bvd2Vyc2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpZiAoSVNf
VkFMTEVZVklFVyhkZXZfcHJpdikpCi0JCXZhbGxleXZpZXdfY2xlYW51cF9ndF9wb3dlcnNhdmUo
ZGV2X3ByaXYpOworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpKQorCQl2YWxsZXl2aWV3X2NsZWFu
dXBfZ3RfcG93ZXJzYXZlKGk5MTUpOwogCi0JaWYgKCFIQVNfUkM2KGRldl9wcml2KSkKLQkJcG1f
cnVudGltZV9wdXQoJmRldl9wcml2LT5kcm0ucGRldi0+ZGV2KTsKKwlpZiAoIUhBU19SQzYoaTkx
NSkpCisJCXBtX3J1bnRpbWVfcHV0KCZpOTE1LT5kcm0ucGRldi0+ZGV2KTsKIH0KIAotdm9pZCBp
bnRlbF9zYW5pdGl6ZV9ndF9wb3dlcnNhdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQordm9pZCBpbnRlbF9zYW5pdGl6ZV9ndF9wb3dlcnNhdmUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7Ci0JZGV2X3ByaXYtPmd0X3BtLnJwcy5lbmFibGVkID0gdHJ1ZTsgLyog
Zm9yY2UgUlBTIGRpc2FibGluZyAqLwotCWRldl9wcml2LT5ndF9wbS5yYzYuZW5hYmxlZCA9IHRy
dWU7IC8qIGZvcmNlIFJDNiBkaXNhYmxpbmcgKi8KLQlpbnRlbF9kaXNhYmxlX2d0X3Bvd2Vyc2F2
ZShkZXZfcHJpdik7CisJaTkxNS0+Z3RfcG0ucnBzLmVuYWJsZWQgPSB0cnVlOyAvKiBmb3JjZSBS
UFMgZGlzYWJsaW5nICovCisJaTkxNS0+Z3RfcG0ucmM2LmVuYWJsZWQgPSB0cnVlOyAvKiBmb3Jj
ZSBSQzYgZGlzYWJsaW5nICovCisJaW50ZWxfZGlzYWJsZV9ndF9wb3dlcnNhdmUoaTkxNSk7CiAK
LQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKLQkJZ2VuMTFfcmVzZXRfcnBzX2ludGVy
cnVwdHMoZGV2X3ByaXYpOwotCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNikKLQkJ
Z2VuNl9yZXNldF9ycHNfaW50ZXJydXB0cyhkZXZfcHJpdik7CisJaWYgKElOVEVMX0dFTihpOTE1
KSA+PSAxMSkKKwkJZ2VuMTFfcmVzZXRfcnBzX2ludGVycnVwdHMoaTkxNSk7CisJZWxzZSBpZiAo
SU5URUxfR0VOKGk5MTUpID49IDYpCisJCWdlbjZfcmVzZXRfcnBzX2ludGVycnVwdHMoaTkxNSk7
CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9kaXNhYmxlX2xsY19wc3RhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCkBAIC04NjM0LDU2ICs4NjM0LDU2IEBAIHN0YXRpYyBp
bmxpbmUgdm9pZCBpbnRlbF9kaXNhYmxlX2xsY19wc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiAJaTkxNS0+Z3RfcG0ubGxjX3BzdGF0ZS5lbmFibGVkID0gZmFsc2U7CiB9CiAK
LXN0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVfcmM2KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5ndF9wbS5y
cHMubG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+Z3RfcG0ucnBzLmxvY2spOwog
Ci0JaWYgKCFkZXZfcHJpdi0+Z3RfcG0ucmM2LmVuYWJsZWQpCisJaWYgKCFpOTE1LT5ndF9wbS5y
YzYuZW5hYmxlZCkKIAkJcmV0dXJuOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkK
LQkJZ2VuOV9kaXNhYmxlX3JjNihkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhk
ZXZfcHJpdikpCi0JCWNoZXJyeXZpZXdfZGlzYWJsZV9yYzYoZGV2X3ByaXYpOwotCWVsc2UgaWYg
KElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQotCQl2YWxsZXl2aWV3X2Rpc2FibGVfcmM2KGRldl9w
cml2KTsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDYpCi0JCWdlbjZfZGlzYWJs
ZV9yYzYoZGV2X3ByaXYpOworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSkKKwkJZ2VuOV9kaXNh
YmxlX3JjNihpOTE1KTsKKwllbHNlIGlmIChJU19DSEVSUllWSUVXKGk5MTUpKQorCQljaGVycnl2
aWV3X2Rpc2FibGVfcmM2KGk5MTUpOworCWVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkpCisJ
CXZhbGxleXZpZXdfZGlzYWJsZV9yYzYoaTkxNSk7CisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDYpCisJCWdlbjZfZGlzYWJsZV9yYzYoaTkxNSk7CiAKLQlkZXZfcHJpdi0+Z3RfcG0ucmM2
LmVuYWJsZWQgPSBmYWxzZTsKKwlpOTE1LT5ndF9wbS5yYzYuZW5hYmxlZCA9IGZhbHNlOwogfQog
Ci1zdGF0aWMgdm9pZCBpbnRlbF9kaXNhYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbnRlbF9kaXNhYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+Z3RfcG0u
cnBzLmxvY2spOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmd0X3BtLnJwcy5sb2NrKTsK
IAotCWlmICghZGV2X3ByaXYtPmd0X3BtLnJwcy5lbmFibGVkKQorCWlmICghaTkxNS0+Z3RfcG0u
cnBzLmVuYWJsZWQpCiAJCXJldHVybjsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkp
Ci0JCWdlbjlfZGlzYWJsZV9ycHMoZGV2X3ByaXYpOwotCWVsc2UgaWYgKElTX0NIRVJSWVZJRVco
ZGV2X3ByaXYpKQotCQljaGVycnl2aWV3X2Rpc2FibGVfcnBzKGRldl9wcml2KTsKLQllbHNlIGlm
IChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKLQkJdmFsbGV5dmlld19kaXNhYmxlX3JwcyhkZXZf
cHJpdik7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA2KQotCQlnZW42X2Rpc2Fi
bGVfcnBzKGRldl9wcml2KTsKLQllbHNlIGlmIChJU19JUk9OTEFLRV9NKGRldl9wcml2KSkKLQkJ
aXJvbmxha2VfZGlzYWJsZV9kcnBzKGRldl9wcml2KTsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDkpCisJCWdlbjlfZGlzYWJsZV9ycHMoaTkxNSk7CisJZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhp
OTE1KSkKKwkJY2hlcnJ5dmlld19kaXNhYmxlX3JwcyhpOTE1KTsKKwllbHNlIGlmIChJU19WQUxM
RVlWSUVXKGk5MTUpKQorCQl2YWxsZXl2aWV3X2Rpc2FibGVfcnBzKGk5MTUpOworCWVsc2UgaWYg
KElOVEVMX0dFTihpOTE1KSA+PSA2KQorCQlnZW42X2Rpc2FibGVfcnBzKGk5MTUpOworCWVsc2Ug
aWYgKElTX0lST05MQUtFX00oaTkxNSkpCisJCWlyb25sYWtlX2Rpc2FibGVfZHJwcyhpOTE1KTsK
IAotCWRldl9wcml2LT5ndF9wbS5ycHMuZW5hYmxlZCA9IGZhbHNlOworCWk5MTUtPmd0X3BtLnJw
cy5lbmFibGVkID0gZmFsc2U7CiB9CiAKLXZvaWQgaW50ZWxfZGlzYWJsZV9ndF9wb3dlcnNhdmUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9kaXNhYmxlX2d0
X3Bvd2Vyc2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+Z3RfcG0ucnBzLmxvY2spOworCW11dGV4X2xvY2soJmk5MTUtPmd0X3BtLnJw
cy5sb2NrKTsKIAotCWludGVsX2Rpc2FibGVfcmM2KGRldl9wcml2KTsKLQlpbnRlbF9kaXNhYmxl
X3JwcyhkZXZfcHJpdik7Ci0JaWYgKEhBU19MTEMoZGV2X3ByaXYpKQotCQlpbnRlbF9kaXNhYmxl
X2xsY19wc3RhdGUoZGV2X3ByaXYpOworCWludGVsX2Rpc2FibGVfcmM2KGk5MTUpOworCWludGVs
X2Rpc2FibGVfcnBzKGk5MTUpOworCWlmIChIQVNfTExDKGk5MTUpKQorCQlpbnRlbF9kaXNhYmxl
X2xsY19wc3RhdGUoaTkxNSk7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5ndF9wbS5ycHMu
bG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5ndF9wbS5ycHMubG9jayk7CiB9CiAKIHN0YXRp
YyBpbmxpbmUgdm9pZCBpbnRlbF9lbmFibGVfbGxjX3BzdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKQEAgLTg2OTgsNTEgKzg2OTgsNTEgQEAgc3RhdGljIGlubGluZSB2b2lkIGlu
dGVsX2VuYWJsZV9sbGNfcHN0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWk5
MTUtPmd0X3BtLmxsY19wc3RhdGUuZW5hYmxlZCA9IHRydWU7CiB9CiAKLXN0YXRpYyB2b2lkIGlu
dGVsX2VuYWJsZV9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGlj
IHZvaWQgaW50ZWxfZW5hYmxlX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+Z3RfcG0ucnBzLmxvY2spOworCWxvY2tk
ZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmd0X3BtLnJwcy5sb2NrKTsKIAotCWlmIChkZXZfcHJpdi0+
Z3RfcG0ucmM2LmVuYWJsZWQpCisJaWYgKGk5MTUtPmd0X3BtLnJjNi5lbmFibGVkKQogCQlyZXR1
cm47CiAKLQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCWNoZXJyeXZpZXdfZW5hYmxl
X3JjNihkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCi0JCXZh
bGxleXZpZXdfZW5hYmxlX3JjNihkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkKLQkJZ2VuMTFfZW5hYmxlX3JjNihkZXZfcHJpdik7Ci0JZWxzZSBpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA5KQotCQlnZW45X2VuYWJsZV9yYzYoZGV2X3ByaXYpOwotCWVs
c2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpCi0JCWdlbjhfZW5hYmxlX3JjNihkZXZfcHJp
dik7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA2KQotCQlnZW42X2VuYWJsZV9y
YzYoZGV2X3ByaXYpOworCWlmIChJU19DSEVSUllWSUVXKGk5MTUpKQorCQljaGVycnl2aWV3X2Vu
YWJsZV9yYzYoaTkxNSk7CisJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkKKwkJdmFsbGV5
dmlld19lbmFibGVfcmM2KGk5MTUpOworCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkK
KwkJZ2VuMTFfZW5hYmxlX3JjNihpOTE1KTsKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0g
OSkKKwkJZ2VuOV9lbmFibGVfcmM2KGk5MTUpOworCWVsc2UgaWYgKElTX0JST0FEV0VMTChpOTE1
KSkKKwkJZ2VuOF9lbmFibGVfcmM2KGk5MTUpOworCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+
PSA2KQorCQlnZW42X2VuYWJsZV9yYzYoaTkxNSk7CiAKLQlkZXZfcHJpdi0+Z3RfcG0ucmM2LmVu
YWJsZWQgPSB0cnVlOworCWk5MTUtPmd0X3BtLnJjNi5lbmFibGVkID0gdHJ1ZTsKIH0KIAotc3Rh
dGljIHZvaWQgaW50ZWxfZW5hYmxlX3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdm9pZCBpbnRlbF9lbmFibGVfcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZkZXZfcHJpdi0+Z3RfcG0ucnBz
OworCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZpOTE1LT5ndF9wbS5ycHM7CiAKIAlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZycHMtPmxvY2spOwogCiAJaWYgKHJwcy0+ZW5hYmxlZCkKIAkJcmV0dXJu
OwogCi0JaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7Ci0JCWNoZXJyeXZpZXdfZW5hYmxl
X3JwcyhkZXZfcHJpdik7Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkgewot
CQl2YWxsZXl2aWV3X2VuYWJsZV9ycHMoZGV2X3ByaXYpOwotCX0gZWxzZSBpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA5KSB7Ci0JCWdlbjlfZW5hYmxlX3JwcyhkZXZfcHJpdik7Ci0JfSBlbHNl
IGlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7Ci0JCWdlbjhfZW5hYmxlX3JwcyhkZXZfcHJp
dik7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDYpIHsKLQkJZ2VuNl9lbmFi
bGVfcnBzKGRldl9wcml2KTsKLQl9IGVsc2UgaWYgKElTX0lST05MQUtFX00oZGV2X3ByaXYpKSB7
Ci0JCWlyb25sYWtlX2VuYWJsZV9kcnBzKGRldl9wcml2KTsKLQkJaW50ZWxfaW5pdF9lbW9uKGRl
dl9wcml2KTsKKwlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSkgeworCQljaGVycnl2aWV3X2VuYWJs
ZV9ycHMoaTkxNSk7CisJfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGk5MTUpKSB7CisJCXZhbGxl
eXZpZXdfZW5hYmxlX3JwcyhpOTE1KTsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5
KSB7CisJCWdlbjlfZW5hYmxlX3JwcyhpOTE1KTsKKwl9IGVsc2UgaWYgKElTX0JST0FEV0VMTChp
OTE1KSkgeworCQlnZW44X2VuYWJsZV9ycHMoaTkxNSk7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4o
aTkxNSkgPj0gNikgeworCQlnZW42X2VuYWJsZV9ycHMoaTkxNSk7CisJfSBlbHNlIGlmIChJU19J
Uk9OTEFLRV9NKGk5MTUpKSB7CisJCWlyb25sYWtlX2VuYWJsZV9kcnBzKGk5MTUpOworCQlpbnRl
bF9pbml0X2Vtb24oaTkxNSk7CiAJfQogCiAJV0FSTl9PTihycHMtPm1heF9mcmVxIDwgcnBzLT5t
aW5fZnJlcSk7CkBAIC04NzU0LDI1ICs4NzU0LDI1IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJs
ZV9ycHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJwcy0+ZW5hYmxlZCA9
IHRydWU7CiB9CiAKLXZvaWQgaW50ZWxfZW5hYmxlX2d0X3Bvd2Vyc2F2ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2VuYWJsZV9ndF9wb3dlcnNhdmUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyogUG93ZXJzYXZpbmcgaXMgY29udHJv
bGxlZCBieSB0aGUgaG9zdCB3aGVuIGluc2lkZSBhIFZNICovCi0JaWYgKGludGVsX3ZncHVfYWN0
aXZlKGRldl9wcml2KSkKKwlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkpCiAJCXJldHVybjsK
IAotCW11dGV4X2xvY2soJmRldl9wcml2LT5ndF9wbS5ycHMubG9jayk7CisJbXV0ZXhfbG9jaygm
aTkxNS0+Z3RfcG0ucnBzLmxvY2spOwogCi0JaWYgKEhBU19SQzYoZGV2X3ByaXYpKQotCQlpbnRl
bF9lbmFibGVfcmM2KGRldl9wcml2KTsKLQlpZiAoSEFTX1JQUyhkZXZfcHJpdikpCi0JCWludGVs
X2VuYWJsZV9ycHMoZGV2X3ByaXYpOwotCWlmIChIQVNfTExDKGRldl9wcml2KSkKLQkJaW50ZWxf
ZW5hYmxlX2xsY19wc3RhdGUoZGV2X3ByaXYpOworCWlmIChIQVNfUkM2KGk5MTUpKQorCQlpbnRl
bF9lbmFibGVfcmM2KGk5MTUpOworCWlmIChIQVNfUlBTKGk5MTUpKQorCQlpbnRlbF9lbmFibGVf
cnBzKGk5MTUpOworCWlmIChIQVNfTExDKGk5MTUpKQorCQlpbnRlbF9lbmFibGVfbGxjX3BzdGF0
ZShpOTE1KTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmd0X3BtLnJwcy5sb2NrKTsKKwlt
dXRleF91bmxvY2soJmk5MTUtPmd0X3BtLnJwcy5sb2NrKTsKIH0KIAotc3RhdGljIHZvaWQgaWJ4
X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0
YXRpYyB2b2lkIGlieF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAkvKgogCSAqIE9uIEliZXggUGVhayBhbmQgQ291Z2FyIFBvaW50LCB3ZSBuZWVk
IHRvIGRpc2FibGUgY2xvY2sKQEAgLTg3ODIsMTEgKzg3ODIsMTEgQEAgc3RhdGljIHZvaWQgaWJ4
X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlJ
OTE1X1dSSVRFKFNPVVRIX0RTUENMS19HQVRFX0QsIFBDSF9EUExTVU5JVF9DTE9DS19HQVRFX0RJ
U0FCTEUpOwogfQogCi1zdGF0aWMgdm9pZCBnNHhfZGlzYWJsZV90cmlja2xlX2ZlZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZzR4X2Rpc2FibGVfdHJp
Y2tsZV9mZWVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWVudW0gcGlwZSBw
aXBlOwogCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCWZvcl9lYWNoX3BpcGUo
aTkxNSwgcGlwZSkgewogCQlJOTE1X1dSSVRFKERTUENOVFIocGlwZSksCiAJCQkgICBJOTE1X1JF
QUQoRFNQQ05UUihwaXBlKSkgfAogCQkJICAgRElTUFBMQU5FX1RSSUNLTEVfRkVFRF9ESVNBQkxF
KTsKQEAgLTg3OTYsNyArODc5Niw3IEBAIHN0YXRpYyB2b2lkIGc0eF9kaXNhYmxlX3RyaWNrbGVf
ZmVlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMg
dm9pZCBpbGtfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIHZvaWQgaWxrX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCXUzMiBkc3BjbGtfZ2F0ZSA9IElMS19WUkhVTklUX0NMT0NLX0dB
VEVfRElTQUJMRTsKIApAQCAtODgzNiw3ICs4ODM2LDcgQEAgc3RhdGljIHZvaWQgaWxrX2luaXRf
Y2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiBUaGUg
Yml0IDIyIG9mIDB4NDIwMDQKIAkgKiBUaGUgYml0IDcsOCw5IG9mIDB4NDIwMjAuCiAJICovCi0J
aWYgKElTX0lST05MQUtFX00oZGV2X3ByaXYpKSB7CisJaWYgKElTX0lST05MQUtFX00oaTkxNSkp
IHsKIAkJLyogV2FGYmNBc3luY2hGbGlwRGlzYWJsZUZiY1F1ZXVlOmlsayAqLwogCQlJOTE1X1dS
SVRFKElMS19ESVNQTEFZX0NISUNLRU4xLAogCQkJICAgSTkxNV9SRUFEKElMS19ESVNQTEFZX0NI
SUNLRU4xKSB8CkBAIC04ODYyLDEyICs4ODYyLDEyIEBAIHN0YXRpYyB2b2lkIGlsa19pbml0X2Ns
b2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJLyogV2FEaXNh
YmxlX1JlbmRlckNhY2hlX09wZXJhdGlvbmFsRmx1c2g6aWxrICovCiAJSTkxNV9XUklURShDQUNI
RV9NT0RFXzAsIF9NQVNLRURfQklUX0RJU0FCTEUoUkNfT1BfRkxVU0hfRU5BQkxFKSk7CiAKLQln
NHhfZGlzYWJsZV90cmlja2xlX2ZlZWQoZGV2X3ByaXYpOworCWc0eF9kaXNhYmxlX3RyaWNrbGVf
ZmVlZChpOTE1KTsKIAotCWlieF9pbml0X2Nsb2NrX2dhdGluZyhkZXZfcHJpdik7CisJaWJ4X2lu
aXRfY2xvY2tfZ2F0aW5nKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBjcHRfaW5pdF9jbG9ja19n
YXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgY3B0
X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWlu
dCBwaXBlOwogCXUzMiB2YWw7CkBAIC04ODg1LDExICs4ODg1LDExIEBAIHN0YXRpYyB2b2lkIGNw
dF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
LyogVGhlIGJlbG93IGZpeGVzIHRoZSB3ZWlyZCBkaXNwbGF5IGNvcnJ1cHRpb24sIGEgZmV3IHBp
eGVscyBzaGlmdGVkCiAJICogZG93bndhcmQsIG9uIChvbmx5KSBMVkRTIG9mIHNvbWUgSFAgbGFw
dG9wcyB3aXRoIElWWS4KIAkgKi8KLQlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBwaXBlKSB7CisJ
Zm9yX2VhY2hfcGlwZShpOTE1LCBwaXBlKSB7CiAJCXZhbCA9IEk5MTVfUkVBRChUUkFOU19DSElD
S0VOMihwaXBlKSk7CiAJCXZhbCB8PSBUUkFOU19DSElDS0VOMl9USU1JTkdfT1ZFUlJJREU7CiAJ
CXZhbCAmPSB+VFJBTlNfQ0hJQ0tFTjJfRkRJX1BPTEFSSVRZX1JFVkVSU0VEOwotCQlpZiAoZGV2
X3ByaXYtPnZidC5mZGlfcnhfcG9sYXJpdHlfaW52ZXJ0ZWQpCisJCWlmIChpOTE1LT52YnQuZmRp
X3J4X3BvbGFyaXR5X2ludmVydGVkKQogCQkJdmFsIHw9IFRSQU5TX0NISUNLRU4yX0ZESV9QT0xB
UklUWV9SRVZFUlNFRDsKIAkJdmFsICY9IH5UUkFOU19DSElDS0VOMl9GUkFNRV9TVEFSVF9ERUxB
WV9NQVNLOwogCQl2YWwgJj0gflRSQU5TX0NISUNLRU4yX0RJU0FCTEVfREVFUF9DT0xPUl9DT1VO
VEVSOwpAQCAtODg5NywxMyArODg5NywxMyBAQCBzdGF0aWMgdm9pZCBjcHRfaW5pdF9jbG9ja19n
YXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlJOTE1X1dSSVRFKFRS
QU5TX0NISUNLRU4yKHBpcGUpLCB2YWwpOwogCX0KIAkvKiBXQURQMENsb2NrR2F0aW5nRGlzYWJs
ZSAqLwotCWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpIHsKKwlmb3JfZWFjaF9waXBlKGk5
MTUsIHBpcGUpIHsKIAkJSTkxNV9XUklURShUUkFOU19DSElDS0VOMShwaXBlKSwKIAkJCSAgIFRS
QU5TX0NISUNLRU4xX0RQMFVOSVRfR0NfRElTQUJMRSk7CiAJfQogfQogCi1zdGF0aWMgdm9pZCBn
ZW42X2NoZWNrX21jaF9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitz
dGF0aWMgdm9pZCBnZW42X2NoZWNrX21jaF9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAl1MzIgdG1wOwogCkBAIC04OTEzLDcgKzg5MTMsNyBAQCBzdGF0aWMgdm9pZCBn
ZW42X2NoZWNrX21jaF9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
CQkgICAgICB0bXApOwogfQogCi1zdGF0aWMgdm9pZCBnZW42X2luaXRfY2xvY2tfZ2F0aW5nKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdlbjZfaW5pdF9j
bG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIGRzcGNs
a19nYXRlID0gSUxLX1ZSSFVOSVRfQ0xPQ0tfR0FURV9ESVNBQkxFOwogCkBAIC05MDAwLDE0ICs5
MDAwLDE0IEBAIHN0YXRpYyB2b2lkIGdlbjZfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgICBJTEtfRFBBUkJVTklUX0NMT0NLX0dBVEVfRU5B
QkxFICB8CiAJCSAgIElMS19EUEZEVU5JVF9DTE9DS19HQVRFX0VOQUJMRSk7CiAKLQlnNHhfZGlz
YWJsZV90cmlja2xlX2ZlZWQoZGV2X3ByaXYpOworCWc0eF9kaXNhYmxlX3RyaWNrbGVfZmVlZChp
OTE1KTsKIAotCWNwdF9pbml0X2Nsb2NrX2dhdGluZyhkZXZfcHJpdik7CisJY3B0X2luaXRfY2xv
Y2tfZ2F0aW5nKGk5MTUpOwogCi0JZ2VuNl9jaGVja19tY2hfc2V0dXAoZGV2X3ByaXYpOworCWdl
bjZfY2hlY2tfbWNoX3NldHVwKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBnZW43X3NldHVwX2Zp
eGVkX2Z1bmNfc2NoZWR1bGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0
YXRpYyB2b2lkIGdlbjdfc2V0dXBfZml4ZWRfZnVuY19zY2hlZHVsZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTMyIHJlZyA9IEk5MTVfUkVBRChHRU43X0ZGX1RIUkVBRF9N
T0RFKTsKIApAQCAtOTAyNSwxMyArOTAyNSwxMyBAQCBzdGF0aWMgdm9pZCBnZW43X3NldHVwX2Zp
eGVkX2Z1bmNfc2NoZWR1bGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlJ
OTE1X1dSSVRFKEdFTjdfRkZfVEhSRUFEX01PREUsIHJlZyk7CiB9CiAKLXN0YXRpYyB2b2lkIGxw
dF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitz
dGF0aWMgdm9pZCBscHRfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJLyoKIAkgKiBUT0RPOiB0aGlzIGJpdCBzaG91bGQgb25seSBiZSBlbmFibGVk
IHdoZW4gcmVhbGx5IG5lZWRlZCwgdGhlbgogCSAqIGRpc2FibGVkIHdoZW4gbm90IG5lZWRlZCBh
bnltb3JlIGluIG9yZGVyIHRvIHNhdmUgcG93ZXIuCiAJICovCi0JaWYgKEhBU19QQ0hfTFBUX0xQ
KGRldl9wcml2KSkKKwlpZiAoSEFTX1BDSF9MUFRfTFAoaTkxNSkpCiAJCUk5MTVfV1JJVEUoU09V
VEhfRFNQQ0xLX0dBVEVfRCwKIAkJCSAgIEk5MTVfUkVBRChTT1VUSF9EU1BDTEtfR0FURV9EKSB8
CiAJCQkgICBQQ0hfTFBfUEFSVElUSU9OX0xFVkVMX0RJU0FCTEUpOwpAQCAtOTA0Miw5ICs5MDQy
LDkgQEAgc3RhdGljIHZvaWQgbHB0X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAkJICAgVFJBTlNfQ0hJQ0tFTjFfRFAwVU5JVF9HQ19ESVNBQkxF
KTsKIH0KIAotc3RhdGljIHZvaWQgbHB0X3N1c3BlbmRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgbHB0X3N1c3BlbmRfaHcoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaWYgKEhBU19QQ0hfTFBUX0xQKGRldl9wcml2KSkgeworCWlm
IChIQVNfUENIX0xQVF9MUChpOTE1KSkgewogCQl1MzIgdmFsID0gSTkxNV9SRUFEKFNPVVRIX0RT
UENMS19HQVRFX0QpOwogCiAJCXZhbCAmPSB+UENIX0xQX1BBUlRJVElPTl9MRVZFTF9ESVNBQkxF
OwpAQCAtOTA1Miw3ICs5MDUyLDcgQEAgc3RhdGljIHZvaWQgbHB0X3N1c3BlbmRfaHcoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIH0KIAotc3RhdGljIHZvaWQgZ2VuOF9z
ZXRfbDNzcWNfY3JlZGl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0
aWMgdm9pZCBnZW44X3NldF9sM3NxY19jcmVkaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCSAgIGludCBnZW5lcmFsX3ByaW9fY3JlZGl0cywKIAkJCQkgICBpbnQgaGlnaF9w
cmlvX2NyZWRpdHMpCiB7CkBAIC05MDc4LDcgKzkwNzgsNyBAQCBzdGF0aWMgdm9pZCBnZW44X3Nl
dF9sM3NxY19jcmVkaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlJOTE1
X1dSSVRFKEdFTjdfTUlTQ0NQQ1RMLCBtaXNjY3BjdGwpOwogfQogCi1zdGF0aWMgdm9pZCBpY2xf
aW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgaWNsX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewogCS8qIFRoaXMgaXMgbm90IGFuIFdhLiBFbmFibGUgdG8gcmVkdWNlIFNhbXBsZXIg
cG93ZXIgKi8KIAlJOTE1X1dSSVRFKEdFTjEwX0RGUl9SQVRJT19FTl9BTkRfQ0hJQ0tFTiwKQEAg
LTkwODksOSArOTA4OSw5IEBAIHN0YXRpYyB2b2lkIGljbF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAgIF9NQVNLRURfQklUX0VOQUJMRShH
RU4xMV9FTkFCTEVfMzJfUExBTkVfTU9ERSkpOwogfQogCi1zdGF0aWMgdm9pZCBjbnBfaW5pdF9j
bG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZv
aWQgY25wX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCWlmICghSEFTX1BDSF9DTlAoZGV2X3ByaXYpKQorCWlmICghSEFTX1BDSF9DTlAoaTkxNSkp
CiAJCXJldHVybjsKIAogCS8qIERpc3BsYXkgV0EgIzExODEgV2FTb3V0aERpc3BsYXlEaXNhYmxl
UFdNQ0dFR2F0aW5nOiBjbnAgKi8KQEAgLTkwOTksMTAgKzkwOTksMTAgQEAgc3RhdGljIHZvaWQg
Y25wX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJICAgQ05QX1BXTV9DR0VfR0FUSU5HX0RJU0FCTEUpOwogfQogCi1zdGF0aWMgdm9pZCBjbmxf
aW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgY25sX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewogCXUzMiB2YWw7Ci0JY25wX2luaXRfY2xvY2tfZ2F0aW5nKGRldl9wcml2KTsKKwlj
bnBfaW5pdF9jbG9ja19nYXRpbmcoaTkxNSk7CiAKIAkvKiBUaGlzIGlzIG5vdCBhbiBXYS4gRW5h
YmxlIGZvciBiZXR0ZXIgaW1hZ2UgcXVhbGl0eSAqLwogCUk5MTVfV1JJVEUoXzNEX0NISUNLRU4z
LApAQCAtOTEyMCw3ICs5MTIwLDcgQEAgc3RhdGljIHZvaWQgY25sX2luaXRfY2xvY2tfZ2F0aW5n
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkvKiBSZWFkSGl0V3JpdGVPbmx5
RGlzYWJsZTpjbmwgKi8KIAl2YWwgfD0gUkNDVU5JVF9DTEtHQVRFX0RJUzsKIAkvKiBXYVNhcmJV
bml0Q2xvY2tHYXRpbmdEaXNhYmxlOmNubCAocHJlLXByb2QpICovCi0JaWYgKElTX0NOTF9SRVZJ
RChkZXZfcHJpdiwgQ05MX1JFVklEX0EwLCBDTkxfUkVWSURfQjApKQorCWlmIChJU19DTkxfUkVW
SUQoaTkxNSwgQ05MX1JFVklEX0EwLCBDTkxfUkVWSURfQjApKQogCQl2YWwgfD0gU0FSQlVOSVRf
Q0xLR0FURV9ESVM7CiAJSTkxNV9XUklURShTTElDRV9VTklUX0xFVkVMX0NMS0dBVEUsIHZhbCk7
CiAKQEAgLTkxMzYsMjcgKzkxMzYsMjcgQEAgc3RhdGljIHZvaWQgY25sX2luaXRfY2xvY2tfZ2F0
aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlJOTE1X1dSSVRFKFVOU0xJ
Q0VfVU5JVF9MRVZFTF9DTEtHQVRFLCB2YWwpOwogfQogCi1zdGF0aWMgdm9pZCBjZmxfaW5pdF9j
bG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZv
aWQgY2ZsX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCWNucF9pbml0X2Nsb2NrX2dhdGluZyhkZXZfcHJpdik7Ci0JZ2VuOV9pbml0X2Nsb2NrX2dh
dGluZyhkZXZfcHJpdik7CisJY25wX2luaXRfY2xvY2tfZ2F0aW5nKGk5MTUpOworCWdlbjlfaW5p
dF9jbG9ja19nYXRpbmcoaTkxNSk7CiAKIAkvKiBXYUZiY051a2VPbkhvc3RNb2RpZnk6Y2ZsICov
CiAJSTkxNV9XUklURShJTEtfRFBGQ19DSElDS0VOLCBJOTE1X1JFQUQoSUxLX0RQRkNfQ0hJQ0tF
TikgfAogCQkgICBJTEtfRFBGQ19OVUtFX09OX0FOWV9NT0RJRklDQVRJT04pOwogfQogCi1zdGF0
aWMgdm9pZCBrYmxfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIHZvaWQga2JsX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCWdlbjlfaW5pdF9jbG9ja19nYXRpbmcoZGV2X3ByaXYpOwor
CWdlbjlfaW5pdF9jbG9ja19nYXRpbmcoaTkxNSk7CiAKIAkvKiBXYURpc2FibGVTREVVbml0Q2xv
Y2tHYXRpbmc6a2JsICovCi0JaWYgKElTX0tCTF9SRVZJRChkZXZfcHJpdiwgMCwgS0JMX1JFVklE
X0IwKSkKKwlpZiAoSVNfS0JMX1JFVklEKGk5MTUsIDAsIEtCTF9SRVZJRF9CMCkpCiAJCUk5MTVf
V1JJVEUoR0VOOF9VQ0dDVEw2LCBJOTE1X1JFQUQoR0VOOF9VQ0dDVEw2KSB8CiAJCQkgICBHRU44
X1NERVVOSVRfQ0xPQ0tfR0FURV9ESVNBQkxFKTsKIAogCS8qIFdhRGlzYWJsZUdhbUNsb2NrR2F0
aW5nOmtibCAqLwotCWlmIChJU19LQkxfUkVWSUQoZGV2X3ByaXYsIDAsIEtCTF9SRVZJRF9CMCkp
CisJaWYgKElTX0tCTF9SRVZJRChpOTE1LCAwLCBLQkxfUkVWSURfQjApKQogCQlJOTE1X1dSSVRF
KEdFTjZfVUNHQ1RMMSwgSTkxNV9SRUFEKEdFTjZfVUNHQ1RMMSkgfAogCQkJICAgR0VONl9HQU1V
TklUX0NMT0NLX0dBVEVfRElTQUJMRSk7CiAKQEAgLTkxNjUsOSArOTE2NSw5IEBAIHN0YXRpYyB2
b2lkIGtibF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJCSAgIElMS19EUEZDX05VS0VfT05fQU5ZX01PRElGSUNBVElPTik7CiB9CiAKLXN0YXRp
YyB2b2lkIHNrbF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitzdGF0aWMgdm9pZCBza2xfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7Ci0JZ2VuOV9pbml0X2Nsb2NrX2dhdGluZyhkZXZfcHJpdik7CisJ
Z2VuOV9pbml0X2Nsb2NrX2dhdGluZyhpOTE1KTsKIAogCS8qIFdBQzZlbnRyeWxhdGVuY3k6c2ts
ICovCiAJSTkxNV9XUklURShGQkNfTExDX1JFQURfQ1RSTCwgSTkxNV9SRUFEKEZCQ19MTENfUkVB
RF9DVFJMKSB8CkBAIC05MTc4LDEwICs5MTc4LDEwIEBAIHN0YXRpYyB2b2lkIHNrbF9pbml0X2Ns
b2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAgIElMS19E
UEZDX05VS0VfT05fQU5ZX01PRElGSUNBVElPTik7CiB9CiAKLXN0YXRpYyB2b2lkIGJkd19pbml0
X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
dm9pZCBiZHdfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiB7CiAJLyogVGhlIEdUVCBjYWNoZSBtdXN0IGJlIGRpc2FibGVkIGlmIHRoZSBzeXN0ZW0gaXMg
dXNpbmcgMk0gcGFnZXMuICovCi0JYm9vbCBjYW5fdXNlX2d0dF9jYWNoZSA9ICFIQVNfUEFHRV9T
SVpFUyhkZXZfcHJpdiwKKwlib29sIGNhbl91c2VfZ3R0X2NhY2hlID0gIUhBU19QQUdFX1NJWkVT
KGk5MTUsCiAJCQkJCQkgSTkxNV9HVFRfUEFHRV9TSVpFXzJNKTsKIAllbnVtIHBpcGUgcGlwZTsK
IApAQCAtOTE5Myw3ICs5MTkzLDcgQEAgc3RhdGljIHZvaWQgYmR3X2luaXRfY2xvY2tfZ2F0aW5n
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICAgSTkxNV9SRUFEKENISUNL
RU5fUEFSMV8xKSB8IERQQV9NQVNLX1ZCTEFOS19TUkQpOwogCiAJLyogV2FQc3JEUFJTVW5tYXNr
VkJsYW5rSW5TUkQ6YmR3ICovCi0JZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCWZv
cl9lYWNoX3BpcGUoaTkxNSwgcGlwZSkgewogCQlJOTE1X1dSSVRFKENISUNLRU5fUElQRVNMXzEo
cGlwZSksCiAJCQkgICBJOTE1X1JFQUQoQ0hJQ0tFTl9QSVBFU0xfMShwaXBlKSkgfAogCQkJICAg
QkRXX0RQUlNfTUFTS19WQkxBTktfU1JEKTsKQEAgLTkyMTMsNyArOTIxMyw3IEBAIHN0YXRpYyB2
b2lkIGJkd19pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJCSAgIEdFTjhfU0RFVU5JVF9DTE9DS19HQVRFX0RJU0FCTEUpOwogCiAJLyogV2FQcm9n
cmFtTDNTcWNSZWcxRGVmYXVsdDpiZHcgKi8KLQlnZW44X3NldF9sM3NxY19jcmVkaXRzKGRldl9w
cml2LCAzMCwgMik7CisJZ2VuOF9zZXRfbDNzcWNfY3JlZGl0cyhpOTE1LCAzMCwgMik7CiAKIAkv
KiBXYUd0dENhY2hpbmdPZmZCeURlZmF1bHQ6YmR3ICovCiAJSTkxNV9XUklURShIU1dfR1RUX0NB
Q0hFX0VOLCBjYW5fdXNlX2d0dF9jYWNoZSA/IEdUVF9DQUNIRV9FTl9BTEwgOiAwKTsKQEAgLTky
MjIsNyArOTIyMiw3IEBAIHN0YXRpYyB2b2lkIGJkd19pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShDSElDS0VOX1BBUjJfMSwg
STkxNV9SRUFEKENISUNLRU5fUEFSMl8xKQogCQkgICB8IEtWTV9DT05GSUdfQ0hBTkdFX05PVElG
SUNBVElPTl9TRUxFQ1QpOwogCi0JbHB0X2luaXRfY2xvY2tfZ2F0aW5nKGRldl9wcml2KTsKKwls
cHRfaW5pdF9jbG9ja19nYXRpbmcoaTkxNSk7CiAKIAkvKiBXYURpc2FibGVEb3BDbG9ja0dhdGlu
ZzpiZHcKIAkgKgpAQCAtOTIzMyw3ICs5MjMzLDcgQEAgc3RhdGljIHZvaWQgYmR3X2luaXRfY2xv
Y2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICAgSTkxNV9S
RUFEKEdFTjZfVUNHQ1RMMSkgfCBHRU42X0VVX1RDVU5JVF9DTE9DS19HQVRFX0RJU0FCTEUpOwog
fQogCi1zdGF0aWMgdm9pZCBoc3dfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgaHN3X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIEwzIGNhY2hpbmcgb2YgZGF0YSBhdG9t
aWNzIGRvZXNuJ3Qgd29yayAtLSBkaXNhYmxlIGl0LiAqLwogCUk5MTVfV1JJVEUoSFNXX1NDUkFU
Q0gxLCBIU1dfU0NSQVRDSDFfTDNfREFUQV9BVE9NSUNTX0RJU0FCTEUpOwpAQCAtOTI3OCwxMCAr
OTI3OCwxMCBAQCBzdGF0aWMgdm9pZCBoc3dfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCS8qIFdhU3dpdGNoU29sVmZGQXJiaXRyYXRpb25Qcmlv
cml0eTpoc3cgKi8KIAlJOTE1X1dSSVRFKEdBTV9FQ09DSEssIEk5MTVfUkVBRChHQU1fRUNPQ0hL
KSB8IEhTV19FQ09DSEtfQVJCX1BSSU9fU09MKTsKIAotCWxwdF9pbml0X2Nsb2NrX2dhdGluZyhk
ZXZfcHJpdik7CisJbHB0X2luaXRfY2xvY2tfZ2F0aW5nKGk5MTUpOwogfQogCi1zdGF0aWMgdm9p
ZCBpdmJfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgaXZiX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCXUzMiBzbnBjcjsKIApAQCAtOTI5Nyw3ICs5Mjk3LDcgQEAgc3RhdGlj
IHZvaWQgaXZiX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJICAgQ0hJQ0tFTjNfREdNR19ET05FX0ZJWF9ESVNBQkxFKTsKIAogCS8qIFdhRGlz
YWJsZVBTRER1YWxEaXNwYXRjaEVuYWJsZTppdmIgKi8KLQlpZiAoSVNfSVZCX0dUMShkZXZfcHJp
dikpCisJaWYgKElTX0lWQl9HVDEoaTkxNSkpCiAJCUk5MTVfV1JJVEUoR0VON19IQUxGX1NMSUNF
X0NISUNLRU4xLAogCQkJICAgX01BU0tFRF9CSVRfRU5BQkxFKEdFTjdfUFNEX1NJTkdMRV9QT1JU
X0RJU1BBVENIX0VOQUJMRSkpOwogCkBAIC05MzEzLDcgKzkzMTMsNyBAQCBzdGF0aWMgdm9pZCBp
dmJfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CQkJR0VON19XQV9GT1JfR0VON19MM19DT05UUk9MKTsKIAlJOTE1X1dSSVRFKEdFTjdfTDNfQ0hJ
Q0tFTl9NT0RFX1JFR0lTVEVSLAogCQkgICBHRU43X1dBX0wzX0NISUNLRU5fTU9ERSk7Ci0JaWYg
KElTX0lWQl9HVDEoZGV2X3ByaXYpKQorCWlmIChJU19JVkJfR1QxKGk5MTUpKQogCQlJOTE1X1dS
SVRFKEdFTjdfUk9XX0NISUNLRU4yLAogCQkJICAgX01BU0tFRF9CSVRfRU5BQkxFKERPUF9DTE9D
S19HQVRJTkdfRElTQUJMRSkpOwogCWVsc2UgewpAQCAtOTM0MCw5ICs5MzQwLDkgQEAgc3RhdGlj
IHZvaWQgaXZiX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJCUk5MTVfUkVBRChHRU43X1NRX0NISUNLRU5fTUJDVU5JVF9DT05GSUcpIHwKIAkJ
CUdFTjdfU1FfQ0hJQ0tFTl9NQkNVTklUX1NRSU5UTU9CKTsKIAotCWc0eF9kaXNhYmxlX3RyaWNr
bGVfZmVlZChkZXZfcHJpdik7CisJZzR4X2Rpc2FibGVfdHJpY2tsZV9mZWVkKGk5MTUpOwogCi0J
Z2VuN19zZXR1cF9maXhlZF9mdW5jX3NjaGVkdWxlcihkZXZfcHJpdik7CisJZ2VuN19zZXR1cF9m
aXhlZF9mdW5jX3NjaGVkdWxlcihpOTE1KTsKIAogCWlmICgwKSB7IC8qIGNhdXNlcyBIaVogY29y
cnVwdGlvbiBvbiBpdmI6Z3QxICovCiAJCS8qIGVuYWJsZSBIaVogUmF3IFN0YWxsIE9wdGltaXph
dGlvbiAqLwpAQCAtOTM3MCwxMyArOTM3MCwxMyBAQCBzdGF0aWMgdm9pZCBpdmJfaW5pdF9jbG9j
a19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXNucGNyIHw9IEdF
TjZfTUJDX1NOUENSX01FRDsKIAlJOTE1X1dSSVRFKEdFTjZfTUJDVU5JVF9TTlBDUiwgc25wY3Ip
OwogCi0JaWYgKCFIQVNfUENIX05PUChkZXZfcHJpdikpCi0JCWNwdF9pbml0X2Nsb2NrX2dhdGlu
ZyhkZXZfcHJpdik7CisJaWYgKCFIQVNfUENIX05PUChpOTE1KSkKKwkJY3B0X2luaXRfY2xvY2tf
Z2F0aW5nKGk5MTUpOwogCi0JZ2VuNl9jaGVja19tY2hfc2V0dXAoZGV2X3ByaXYpOworCWdlbjZf
Y2hlY2tfbWNoX3NldHVwKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfaW5pdF9jbG9ja19n
YXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdmx2
X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8q
IFdhRGlzYWJsZUVhcmx5Q3VsbDp2bHYgKi8KIAlJOTE1X1dSSVRFKF8zRF9DSElDS0VOMywKQEAg
LTk0MDksNyArOTQwOSw3IEBAIHN0YXRpYyB2b2lkIHZsdl9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAgIEk5MTVfUkVBRChHRU43X1NRX0NI
SUNLRU5fTUJDVU5JVF9DT05GSUcpIHwKIAkJICAgR0VON19TUV9DSElDS0VOX01CQ1VOSVRfU1FJ
TlRNT0IpOwogCi0JZ2VuN19zZXR1cF9maXhlZF9mdW5jX3NjaGVkdWxlcihkZXZfcHJpdik7CisJ
Z2VuN19zZXR1cF9maXhlZF9mdW5jX3NjaGVkdWxlcihpOTE1KTsKIAogCS8qCiAJICogQWNjb3Jk
aW5nIHRvIHRoZSBzcGVjLCBiaXQgMTMgKFJDWlVOSVQpIG11c3QgYmUgc2V0IG9uIElWQi4KQEAg
LTk0NTYsNyArOTQ1Niw3IEBAIHN0YXRpYyB2b2lkIHZsdl9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJSTkxNV9XUklURShWTFZfR1VOSVRfQ0xP
Q0tfR0FURSwgR0NGR19ESVMpOwogfQogCi1zdGF0aWMgdm9pZCBjaHZfaW5pdF9jbG9ja19nYXRp
bmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgY2h2X2lu
aXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIFdh
VlNSZWZDb3VudEZ1bGxmb3JjZU1pc3NEaXNhYmxlOmNodiAqLwogCS8qIFdhRFNSZWZDb3VudEZ1
bGxmb3JjZU1pc3NEaXNhYmxlOmNodiAqLwpAQCAtOTQ4MSw3ICs5NDgxLDcgQEAgc3RhdGljIHZv
aWQgY2h2X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkgKiBTZWUgZ2Z4c3BlY3MvUmVsYXRlZCBEb2N1bWVudHMvUGVyZm9ybWFuY2UgR3VpZGUv
CiAJICogTFNRQyBTZXR0aW5nIFJlY29tbWVuZGF0aW9ucy4KIAkgKi8KLQlnZW44X3NldF9sM3Nx
Y19jcmVkaXRzKGRldl9wcml2LCAzOCwgMik7CisJZ2VuOF9zZXRfbDNzcWNfY3JlZGl0cyhpOTE1
LCAzOCwgMik7CiAKIAkvKgogCSAqIEdUVCBjYWNoZSBtYXkgbm90IHdvcmsgd2l0aCBiaWcgcGFn
ZXMsIHNvIGlmIHRob3NlCkBAIC05NDkwLDcgKzk0OTAsNyBAQCBzdGF0aWMgdm9pZCBjaHZfaW5p
dF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVf
V1JJVEUoSFNXX0dUVF9DQUNIRV9FTiwgR1RUX0NBQ0hFX0VOX0FMTCk7CiB9CiAKLXN0YXRpYyB2
b2lkIGc0eF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdm9pZCBnNHhfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7CiAJdTMyIGRzcGNsa19nYXRlOwogCkBAIC05NTAyLDcgKzk1MDIsNyBA
QCBzdGF0aWMgdm9pZCBnNHhfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCWRzcGNsa19nYXRlID0gVlJIVU5JVF9DTE9DS19HQVRFX0RJU0FCTEUg
fAogCQlPVlJVTklUX0NMT0NLX0dBVEVfRElTQUJMRSB8CiAJCU9WQ1VOSVRfQ0xPQ0tfR0FURV9E
SVNBQkxFOwotCWlmIChJU19HTTQ1KGRldl9wcml2KSkKKwlpZiAoSVNfR000NShpOTE1KSkKIAkJ
ZHNwY2xrX2dhdGUgfD0gRFNTVU5JVF9DTE9DS19HQVRFX0RJU0FCTEU7CiAJSTkxNV9XUklURShE
U1BDTEtfR0FURV9ELCBkc3BjbGtfZ2F0ZSk7CiAKQEAgLTk1MTMsMTIgKzk1MTMsMTIgQEAgc3Rh
dGljIHZvaWQgZzR4X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAkvKiBXYURpc2FibGVfUmVuZGVyQ2FjaGVfT3BlcmF0aW9uYWxGbHVzaDpnNHgg
Ki8KIAlJOTE1X1dSSVRFKENBQ0hFX01PREVfMCwgX01BU0tFRF9CSVRfRElTQUJMRShSQ19PUF9G
TFVTSF9FTkFCTEUpKTsKIAotCWc0eF9kaXNhYmxlX3RyaWNrbGVfZmVlZChkZXZfcHJpdik7CisJ
ZzR4X2Rpc2FibGVfdHJpY2tsZV9mZWVkKGk5MTUpOwogfQogCi1zdGF0aWMgdm9pZCBpOTY1Z21f
aW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgaTk2NWdtX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5j
b3JlOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1LT51bmNvcmU7CiAKIAlp
bnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBSRU5DTEtfR0FURV9EMSwgSTk2NV9SQ0NfQ0xPQ0tf
R0FURV9ESVNBQkxFKTsKIAlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBSRU5DTEtfR0FURV9E
MiwgMCk7CkBAIC05NTM1LDcgKzk1MzUsNyBAQCBzdGF0aWMgdm9pZCBpOTY1Z21faW5pdF9jbG9j
a19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJICAgX01BU0tF
RF9CSVRfRElTQUJMRShSQ19PUF9GTFVTSF9FTkFCTEUpKTsKIH0KIAotc3RhdGljIHZvaWQgaTk2
NWdfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIHZvaWQgaTk2NWdfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7CiAJSTkxNV9XUklURShSRU5DTEtfR0FURV9EMSwgSTk2NV9SQ1pfQ0xPQ0tf
R0FURV9ESVNBQkxFIHwKIAkJICAgSTk2NV9SQ0NfQ0xPQ0tfR0FURV9ESVNBQkxFIHwKQEAgLTk1
NTAsNyArOTU1MCw3IEBAIHN0YXRpYyB2b2lkIGk5NjVnX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlJOTE1X1dSSVRFKENBQ0hFX01PREVfMCwg
X01BU0tFRF9CSVRfRElTQUJMRShSQ19PUF9GTFVTSF9FTkFCTEUpKTsKIH0KIAotc3RhdGljIHZv
aWQgZ2VuM19pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdm9pZCBnZW4zX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCXUzMiBkc3RhdGUgPSBJOTE1X1JFQUQoRF9TVEFURSk7CiAKQEAg
LTk1NTgsNyArOTU1OCw3IEBAIHN0YXRpYyB2b2lkIGdlbjNfaW5pdF9jbG9ja19nYXRpbmcoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlEU1RBVEVfRE9UX0NMT0NLX0dBVElO
RzsKIAlJOTE1X1dSSVRFKERfU1RBVEUsIGRzdGF0ZSk7CiAKLQlpZiAoSVNfUElORVZJRVcoZGV2
X3ByaXYpKQorCWlmIChJU19QSU5FVklFVyhpOTE1KSkKIAkJSTkxNV9XUklURShFQ09TS1BELCBf
TUFTS0VEX0JJVF9FTkFCTEUoRUNPX0dBVElOR19DWF9PTkxZKSk7CiAKIAkvKiBJSVIgImZsaXAg
cGVuZGluZyIgbWVhbnMgZG9uZSBpZiB0aGlzIGJpdCBpcyBzZXQgKi8KQEAgLTk1NzQsNyArOTU3
NCw3IEBAIHN0YXRpYyB2b2lkIGdlbjNfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCQkgICBfTUFTS0VEX0JJVF9FTkFCTEUoTUlfQVJCX0RJU1BM
QVlfVFJJQ0tMRV9GRUVEX0RJU0FCTEUpKTsKIH0KIAotc3RhdGljIHZvaWQgaTg1eF9pbml0X2Ns
b2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCBpODV4X2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCUk5MTVfV1JJVEUoUkVOQ0xLX0dBVEVfRDEsIFNWX0NMT0NLX0dBVEVfRElTQUJMRSk7CiAK
QEAgLTk1ODYsMTY4ICs5NTg2LDE2OCBAQCBzdGF0aWMgdm9pZCBpODV4X2luaXRfY2xvY2tfZ2F0
aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICAgX01BU0tFRF9CSVRf
RU5BQkxFKE1FTV9ESVNQTEFZX1RSSUNLTEVfRkVFRF9ESVNBQkxFKSk7CiB9CiAKLXN0YXRpYyB2
b2lkIGk4MzBfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQorc3RhdGljIHZvaWQgaTgzMF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKIAlJOTE1X1dSSVRFKE1FTV9NT0RFLAogCQkgICBfTUFTS0VEX0JJ
VF9FTkFCTEUoTUVNX0RJU1BMQVlfQV9UUklDS0xFX0ZFRURfRElTQUJMRSkgfAogCQkgICBfTUFT
S0VEX0JJVF9FTkFCTEUoTUVNX0RJU1BMQVlfQl9UUklDS0xFX0ZFRURfRElTQUJMRSkpOwogfQog
Ci12b2lkIGludGVsX2luaXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3ZvaWQgaW50ZWxfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7Ci0JZGV2X3ByaXYtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcoZGV2
X3ByaXYpOworCWk5MTUtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcoaTkxNSk7CiB9CiAKLXZv
aWQgaW50ZWxfc3VzcGVuZF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2
b2lkIGludGVsX3N1c3BlbmRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0J
aWYgKEhBU19QQ0hfTFBUKGRldl9wcml2KSkKLQkJbHB0X3N1c3BlbmRfaHcoZGV2X3ByaXYpOwor
CWlmIChIQVNfUENIX0xQVChpOTE1KSkKKwkJbHB0X3N1c3BlbmRfaHcoaTkxNSk7CiB9CiAKLXN0
YXRpYyB2b2lkIG5vcF9pbml0X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBub3BfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJRFJNX0RFQlVHX0tNUygiTm8gY2xvY2sgZ2F0aW5nIHNl
dHRpbmdzIG9yIHdvcmthcm91bmRzIGFwcGxpZWQuXG4iKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9p
bml0X2Nsb2NrX2dhdGluZ19ob29rcyAtIHNldHVwIHRoZSBjbG9jayBnYXRpbmcgaG9va3MKLSAq
IEBkZXZfcHJpdjogZGV2aWNlIHByaXZhdGUKKyAqIEBpOTE1OiBkZXZpY2UgcHJpdmF0ZQogICoK
ICAqIFNldHVwIHRoZSBob29rcyB0aGF0IGNvbmZpZ3VyZSB3aGljaCBjbG9ja3Mgb2YgYSBnaXZl
biBwbGF0Zm9ybSBjYW4gYmUKICAqIGdhdGVkIGFuZCBhbHNvIGFwcGx5IHZhcmlvdXMgR1QgYW5k
IGRpc3BsYXkgc3BlY2lmaWMgd29ya2Fyb3VuZHMgZm9yIHRoZXNlCiAgKiBwbGF0Zm9ybXMuIE5v
dGUgdGhhdCBzb21lIEdUIHNwZWNpZmljIHdvcmthcm91bmRzIGFyZSBhcHBsaWVkIHNlcGFyYXRl
bHkKICAqIHdoZW4gR1BVIGNvbnRleHRzIG9yIGJhdGNoYnVmZmVycyBzdGFydCB0aGVpciBleGVj
dXRpb24uCiAgKi8KLXZvaWQgaW50ZWxfaW5pdF9jbG9ja19nYXRpbmdfaG9va3Moc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQotewotCWlmIChJU19HRU4oZGV2X3ByaXYsIDExKSkK
LQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcgPSBpY2xfaW5pdF9jbG9ja19n
YXRpbmc7Ci0JZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpCi0JCWRldl9wcml2LT5k
aXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gY25sX2luaXRfY2xvY2tfZ2F0aW5nOwotCWVsc2Ug
aWYgKElTX0NPRkZFRUxBS0UoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0X2Ns
b2NrX2dhdGluZyA9IGNmbF9pbml0X2Nsb2NrX2dhdGluZzsKLQllbHNlIGlmIChJU19TS1lMQUtF
KGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcgPSBza2xf
aW5pdF9jbG9ja19nYXRpbmc7Ci0JZWxzZSBpZiAoSVNfS0FCWUxBS0UoZGV2X3ByaXYpKQotCQlk
ZXZfcHJpdi0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGluZyA9IGtibF9pbml0X2Nsb2NrX2dhdGlu
ZzsKLQllbHNlIGlmIChJU19CUk9YVE9OKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXku
aW5pdF9jbG9ja19nYXRpbmcgPSBieHRfaW5pdF9jbG9ja19nYXRpbmc7Ci0JZWxzZSBpZiAoSVNf
R0VNSU5JTEFLRShkZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0
aW5nID0gZ2xrX2luaXRfY2xvY2tfZ2F0aW5nOwotCWVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZf
cHJpdikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gYmR3X2luaXRf
Y2xvY2tfZ2F0aW5nOwotCWVsc2UgaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQotCQlkZXZf
cHJpdi0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGluZyA9IGNodl9pbml0X2Nsb2NrX2dhdGluZzsK
LQllbHNlIGlmIChJU19IQVNXRUxMKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5p
dF9jbG9ja19nYXRpbmcgPSBoc3dfaW5pdF9jbG9ja19nYXRpbmc7Ci0JZWxzZSBpZiAoSVNfSVZZ
QlJJREdFKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcg
PSBpdmJfaW5pdF9jbG9ja19nYXRpbmc7Ci0JZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJp
dikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gdmx2X2luaXRfY2xv
Y2tfZ2F0aW5nOwotCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgNikpCi0JCWRldl9wcml2LT5k
aXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gZ2VuNl9pbml0X2Nsb2NrX2dhdGluZzsKLQllbHNl
IGlmIChJU19HRU4oZGV2X3ByaXYsIDUpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0X2Nsb2Nr
X2dhdGluZyA9IGlsa19pbml0X2Nsb2NrX2dhdGluZzsKLQllbHNlIGlmIChJU19HNFgoZGV2X3By
aXYpKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGluZyA9IGc0eF9pbml0X2Ns
b2NrX2dhdGluZzsKLQllbHNlIGlmIChJU19JOTY1R00oZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+
ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGluZyA9IGk5NjVnbV9pbml0X2Nsb2NrX2dhdGluZzsKLQll
bHNlIGlmIChJU19JOTY1RyhkZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRfY2xv
Y2tfZ2F0aW5nID0gaTk2NWdfaW5pdF9jbG9ja19nYXRpbmc7Ci0JZWxzZSBpZiAoSVNfR0VOKGRl
dl9wcml2LCAzKSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcgPSBnZW4z
X2luaXRfY2xvY2tfZ2F0aW5nOwotCWVsc2UgaWYgKElTX0k4NVgoZGV2X3ByaXYpIHx8IElTX0k4
NjVHKGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcgPSBp
ODV4X2luaXRfY2xvY2tfZ2F0aW5nOwotCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgMikpCi0J
CWRldl9wcml2LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gaTgzMF9pbml0X2Nsb2NrX2dh
dGluZzsKK3ZvaWQgaW50ZWxfaW5pdF9jbG9ja19nYXRpbmdfaG9va3Moc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCit7CisJaWYgKElTX0dFTihpOTE1LCAxMSkpCisJCWk5MTUtPmRpc3Bs
YXkuaW5pdF9jbG9ja19nYXRpbmcgPSBpY2xfaW5pdF9jbG9ja19nYXRpbmc7CisJZWxzZSBpZiAo
SVNfQ0FOTk9OTEFLRShpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGluZyA9
IGNubF9pbml0X2Nsb2NrX2dhdGluZzsKKwllbHNlIGlmIChJU19DT0ZGRUVMQUtFKGk5MTUpKQor
CQlpOTE1LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gY2ZsX2luaXRfY2xvY2tfZ2F0aW5n
OworCWVsc2UgaWYgKElTX1NLWUxBS0UoaTkxNSkpCisJCWk5MTUtPmRpc3BsYXkuaW5pdF9jbG9j
a19nYXRpbmcgPSBza2xfaW5pdF9jbG9ja19nYXRpbmc7CisJZWxzZSBpZiAoSVNfS0FCWUxBS0Uo
aTkxNSkpCisJCWk5MTUtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcgPSBrYmxfaW5pdF9jbG9j
a19nYXRpbmc7CisJZWxzZSBpZiAoSVNfQlJPWFRPTihpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5p
bml0X2Nsb2NrX2dhdGluZyA9IGJ4dF9pbml0X2Nsb2NrX2dhdGluZzsKKwllbHNlIGlmIChJU19H
RU1JTklMQUtFKGk5MTUpKQorCQlpOTE1LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gZ2xr
X2luaXRfY2xvY2tfZ2F0aW5nOworCWVsc2UgaWYgKElTX0JST0FEV0VMTChpOTE1KSkKKwkJaTkx
NS0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGluZyA9IGJkd19pbml0X2Nsb2NrX2dhdGluZzsKKwll
bHNlIGlmIChJU19DSEVSUllWSUVXKGk5MTUpKQorCQlpOTE1LT5kaXNwbGF5LmluaXRfY2xvY2tf
Z2F0aW5nID0gY2h2X2luaXRfY2xvY2tfZ2F0aW5nOworCWVsc2UgaWYgKElTX0hBU1dFTEwoaTkx
NSkpCisJCWk5MTUtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcgPSBoc3dfaW5pdF9jbG9ja19n
YXRpbmc7CisJZWxzZSBpZiAoSVNfSVZZQlJJREdFKGk5MTUpKQorCQlpOTE1LT5kaXNwbGF5Lmlu
aXRfY2xvY2tfZ2F0aW5nID0gaXZiX2luaXRfY2xvY2tfZ2F0aW5nOworCWVsc2UgaWYgKElTX1ZB
TExFWVZJRVcoaTkxNSkpCisJCWk5MTUtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcgPSB2bHZf
aW5pdF9jbG9ja19nYXRpbmc7CisJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDYpKQorCQlpOTE1LT5k
aXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gZ2VuNl9pbml0X2Nsb2NrX2dhdGluZzsKKwllbHNl
IGlmIChJU19HRU4oaTkxNSwgNSkpCisJCWk5MTUtPmRpc3BsYXkuaW5pdF9jbG9ja19nYXRpbmcg
PSBpbGtfaW5pdF9jbG9ja19nYXRpbmc7CisJZWxzZSBpZiAoSVNfRzRYKGk5MTUpKQorCQlpOTE1
LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gZzR4X2luaXRfY2xvY2tfZ2F0aW5nOworCWVs
c2UgaWYgKElTX0k5NjVHTShpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGlu
ZyA9IGk5NjVnbV9pbml0X2Nsb2NrX2dhdGluZzsKKwllbHNlIGlmIChJU19JOTY1RyhpOTE1KSkK
KwkJaTkxNS0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGluZyA9IGk5NjVnX2luaXRfY2xvY2tfZ2F0
aW5nOworCWVsc2UgaWYgKElTX0dFTihpOTE1LCAzKSkKKwkJaTkxNS0+ZGlzcGxheS5pbml0X2Ns
b2NrX2dhdGluZyA9IGdlbjNfaW5pdF9jbG9ja19nYXRpbmc7CisJZWxzZSBpZiAoSVNfSTg1WChp
OTE1KSB8fCBJU19JODY1RyhpOTE1KSkKKwkJaTkxNS0+ZGlzcGxheS5pbml0X2Nsb2NrX2dhdGlu
ZyA9IGk4NXhfaW5pdF9jbG9ja19nYXRpbmc7CisJZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDIpKQor
CQlpOTE1LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gaTgzMF9pbml0X2Nsb2NrX2dhdGlu
ZzsKIAllbHNlIHsKLQkJTUlTU0lOR19DQVNFKElOVEVMX0RFVklEKGRldl9wcml2KSk7Ci0JCWRl
dl9wcml2LT5kaXNwbGF5LmluaXRfY2xvY2tfZ2F0aW5nID0gbm9wX2luaXRfY2xvY2tfZ2F0aW5n
OworCQlNSVNTSU5HX0NBU0UoSU5URUxfREVWSUQoaTkxNSkpOworCQlpOTE1LT5kaXNwbGF5Lmlu
aXRfY2xvY2tfZ2F0aW5nID0gbm9wX2luaXRfY2xvY2tfZ2F0aW5nOwogCX0KIH0KIAogLyogU2V0
IHVwIGNoaXAgc3BlY2lmaWMgcG93ZXIgbWFuYWdlbWVudC1yZWxhdGVkIGZ1bmN0aW9ucyAqLwot
dm9pZCBpbnRlbF9pbml0X3BtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3Zv
aWQgaW50ZWxfaW5pdF9wbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAkvKiBG
b3IgY3hzciAqLwotCWlmIChJU19QSU5FVklFVyhkZXZfcHJpdikpCi0JCWk5MTVfcGluZXZpZXdf
Z2V0X21lbV9mcmVxKGRldl9wcml2KTsKLQllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDUpKQot
CQlpOTE1X2lyb25sYWtlX2dldF9tZW1fZnJlcShkZXZfcHJpdik7CisJaWYgKElTX1BJTkVWSUVX
KGk5MTUpKQorCQlpOTE1X3BpbmV2aWV3X2dldF9tZW1fZnJlcShpOTE1KTsKKwllbHNlIGlmIChJ
U19HRU4oaTkxNSwgNSkpCisJCWk5MTVfaXJvbmxha2VfZ2V0X21lbV9mcmVxKGk5MTUpOwogCiAJ
LyogRm9yIEZJRk8gd2F0ZXJtYXJrIHVwZGF0ZXMgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA5KSB7Ci0JCXNrbF9zZXR1cF93bV9sYXRlbmN5KGRldl9wcml2KTsKLQkJZGV2X3ByaXYt
PmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzID0gc2tsX2luaXRpYWxfd207Ci0JCWRldl9wcml2
LT5kaXNwbGF5LmF0b21pY191cGRhdGVfd2F0ZXJtYXJrcyA9IHNrbF9hdG9taWNfdXBkYXRlX2Ny
dGNfd207Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNvbXB1dGVfZ2xvYmFsX3dhdGVybWFya3MgPSBz
a2xfY29tcHV0ZV93bTsKLQl9IGVsc2UgaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKSB7Ci0J
CWlsa19zZXR1cF93bV9sYXRlbmN5KGRldl9wcml2KTsKLQotCQlpZiAoKElTX0dFTihkZXZfcHJp
diwgNSkgJiYgZGV2X3ByaXYtPndtLnByaV9sYXRlbmN5WzFdICYmCi0JCSAgICAgZGV2X3ByaXYt
PndtLnNwcl9sYXRlbmN5WzFdICYmIGRldl9wcml2LT53bS5jdXJfbGF0ZW5jeVsxXSkgfHwKLQkJ
ICAgICghSVNfR0VOKGRldl9wcml2LCA1KSAmJiBkZXZfcHJpdi0+d20ucHJpX2xhdGVuY3lbMF0g
JiYKLQkJICAgICBkZXZfcHJpdi0+d20uc3ByX2xhdGVuY3lbMF0gJiYgZGV2X3ByaXYtPndtLmN1
cl9sYXRlbmN5WzBdKSkgewotCQkJZGV2X3ByaXYtPmRpc3BsYXkuY29tcHV0ZV9waXBlX3dtID0g
aWxrX2NvbXB1dGVfcGlwZV93bTsKLQkJCWRldl9wcml2LT5kaXNwbGF5LmNvbXB1dGVfaW50ZXJt
ZWRpYXRlX3dtID0KKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsKKwkJc2tsX3NldHVwX3dt
X2xhdGVuY3koaTkxNSk7CisJCWk5MTUtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzID0gc2ts
X2luaXRpYWxfd207CisJCWk5MTUtPmRpc3BsYXkuYXRvbWljX3VwZGF0ZV93YXRlcm1hcmtzID0g
c2tsX2F0b21pY191cGRhdGVfY3J0Y193bTsKKwkJaTkxNS0+ZGlzcGxheS5jb21wdXRlX2dsb2Jh
bF93YXRlcm1hcmtzID0gc2tsX2NvbXB1dGVfd207CisJfSBlbHNlIGlmIChIQVNfUENIX1NQTElU
KGk5MTUpKSB7CisJCWlsa19zZXR1cF93bV9sYXRlbmN5KGk5MTUpOworCisJCWlmICgoSVNfR0VO
KGk5MTUsIDUpICYmIGk5MTUtPndtLnByaV9sYXRlbmN5WzFdICYmCisJCSAgICAgaTkxNS0+d20u
c3ByX2xhdGVuY3lbMV0gJiYgaTkxNS0+d20uY3VyX2xhdGVuY3lbMV0pIHx8CisJCSAgICAoIUlT
X0dFTihpOTE1LCA1KSAmJiBpOTE1LT53bS5wcmlfbGF0ZW5jeVswXSAmJgorCQkgICAgIGk5MTUt
PndtLnNwcl9sYXRlbmN5WzBdICYmIGk5MTUtPndtLmN1cl9sYXRlbmN5WzBdKSkgeworCQkJaTkx
NS0+ZGlzcGxheS5jb21wdXRlX3BpcGVfd20gPSBpbGtfY29tcHV0ZV9waXBlX3dtOworCQkJaTkx
NS0+ZGlzcGxheS5jb21wdXRlX2ludGVybWVkaWF0ZV93bSA9CiAJCQkJaWxrX2NvbXB1dGVfaW50
ZXJtZWRpYXRlX3dtOwotCQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzID0K
KwkJCWk5MTUtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzID0KIAkJCQlpbGtfaW5pdGlhbF93
YXRlcm1hcmtzOwotCQkJZGV2X3ByaXYtPmRpc3BsYXkub3B0aW1pemVfd2F0ZXJtYXJrcyA9CisJ
CQlpOTE1LT5kaXNwbGF5Lm9wdGltaXplX3dhdGVybWFya3MgPQogCQkJCWlsa19vcHRpbWl6ZV93
YXRlcm1hcmtzOwogCQl9IGVsc2UgewogCQkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIHJlYWQg
ZGlzcGxheSBwbGFuZSBsYXRlbmN5LiAiCiAJCQkJICAgICAgIkRpc2FibGUgQ3hTUlxuIik7CiAJ
CX0KLQl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVco
ZGV2X3ByaXYpKSB7Ci0JCXZsdl9zZXR1cF93bV9sYXRlbmN5KGRldl9wcml2KTsKLQkJZGV2X3By
aXYtPmRpc3BsYXkuY29tcHV0ZV9waXBlX3dtID0gdmx2X2NvbXB1dGVfcGlwZV93bTsKLQkJZGV2
X3ByaXYtPmRpc3BsYXkuY29tcHV0ZV9pbnRlcm1lZGlhdGVfd20gPSB2bHZfY29tcHV0ZV9pbnRl
cm1lZGlhdGVfd207Ci0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyA9IHZs
dl9pbml0aWFsX3dhdGVybWFya3M7Ci0JCWRldl9wcml2LT5kaXNwbGF5Lm9wdGltaXplX3dhdGVy
bWFya3MgPSB2bHZfb3B0aW1pemVfd2F0ZXJtYXJrczsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuYXRv
bWljX3VwZGF0ZV93YXRlcm1hcmtzID0gdmx2X2F0b21pY191cGRhdGVfZmlmbzsKLQl9IGVsc2Ug
aWYgKElTX0c0WChkZXZfcHJpdikpIHsKLQkJZzR4X3NldHVwX3dtX2xhdGVuY3koZGV2X3ByaXYp
OwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jb21wdXRlX3BpcGVfd20gPSBnNHhfY29tcHV0ZV9waXBl
X3dtOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jb21wdXRlX2ludGVybWVkaWF0ZV93bSA9IGc0eF9j
b21wdXRlX2ludGVybWVkaWF0ZV93bTsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRl
cm1hcmtzID0gZzR4X2luaXRpYWxfd2F0ZXJtYXJrczsKLQkJZGV2X3ByaXYtPmRpc3BsYXkub3B0
aW1pemVfd2F0ZXJtYXJrcyA9IGc0eF9vcHRpbWl6ZV93YXRlcm1hcmtzOwotCX0gZWxzZSBpZiAo
SVNfUElORVZJRVcoZGV2X3ByaXYpKSB7Ci0JCWlmICghaW50ZWxfZ2V0X2N4c3JfbGF0ZW5jeSgh
SVNfTU9CSUxFKGRldl9wcml2KSwKLQkJCQkJICAgIGRldl9wcml2LT5pc19kZHIzLAotCQkJCQkg
ICAgZGV2X3ByaXYtPmZzYl9mcmVxLAotCQkJCQkgICAgZGV2X3ByaXYtPm1lbV9mcmVxKSkgewor
CX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSB7
CisJCXZsdl9zZXR1cF93bV9sYXRlbmN5KGk5MTUpOworCQlpOTE1LT5kaXNwbGF5LmNvbXB1dGVf
cGlwZV93bSA9IHZsdl9jb21wdXRlX3BpcGVfd207CisJCWk5MTUtPmRpc3BsYXkuY29tcHV0ZV9p
bnRlcm1lZGlhdGVfd20gPSB2bHZfY29tcHV0ZV9pbnRlcm1lZGlhdGVfd207CisJCWk5MTUtPmRp
c3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzID0gdmx2X2luaXRpYWxfd2F0ZXJtYXJrczsKKwkJaTkx
NS0+ZGlzcGxheS5vcHRpbWl6ZV93YXRlcm1hcmtzID0gdmx2X29wdGltaXplX3dhdGVybWFya3M7
CisJCWk5MTUtPmRpc3BsYXkuYXRvbWljX3VwZGF0ZV93YXRlcm1hcmtzID0gdmx2X2F0b21pY191
cGRhdGVfZmlmbzsKKwl9IGVsc2UgaWYgKElTX0c0WChpOTE1KSkgeworCQlnNHhfc2V0dXBfd21f
bGF0ZW5jeShpOTE1KTsKKwkJaTkxNS0+ZGlzcGxheS5jb21wdXRlX3BpcGVfd20gPSBnNHhfY29t
cHV0ZV9waXBlX3dtOworCQlpOTE1LT5kaXNwbGF5LmNvbXB1dGVfaW50ZXJtZWRpYXRlX3dtID0g
ZzR4X2NvbXB1dGVfaW50ZXJtZWRpYXRlX3dtOworCQlpOTE1LT5kaXNwbGF5LmluaXRpYWxfd2F0
ZXJtYXJrcyA9IGc0eF9pbml0aWFsX3dhdGVybWFya3M7CisJCWk5MTUtPmRpc3BsYXkub3B0aW1p
emVfd2F0ZXJtYXJrcyA9IGc0eF9vcHRpbWl6ZV93YXRlcm1hcmtzOworCX0gZWxzZSBpZiAoSVNf
UElORVZJRVcoaTkxNSkpIHsKKwkJaWYgKCFpbnRlbF9nZXRfY3hzcl9sYXRlbmN5KCFJU19NT0JJ
TEUoaTkxNSksCisJCQkJCSAgICBpOTE1LT5pc19kZHIzLAorCQkJCQkgICAgaTkxNS0+ZnNiX2Zy
ZXEsCisJCQkJCSAgICBpOTE1LT5tZW1fZnJlcSkpIHsKIAkJCURSTV9JTkZPKCJmYWlsZWQgdG8g
ZmluZCBrbm93biBDeFNSIGxhdGVuY3kgIgogCQkJCSAiKGZvdW5kIGRkciVzIGZzYiBmcmVxICVk
LCBtZW0gZnJlcSAlZCksICIKIAkJCQkgImRpc2FibGluZyBDeFNSXG4iLAotCQkJCSAoZGV2X3By
aXYtPmlzX2RkcjMgPT0gMSkgPyAiMyIgOiAiMiIsCi0JCQkJIGRldl9wcml2LT5mc2JfZnJlcSwg
ZGV2X3ByaXYtPm1lbV9mcmVxKTsKKwkJCQkgKGk5MTUtPmlzX2RkcjMgPT0gMSkgPyAiMyIgOiAi
MiIsCisJCQkJIGk5MTUtPmZzYl9mcmVxLCBpOTE1LT5tZW1fZnJlcSk7CiAJCQkvKiBEaXNhYmxl
IEN4U1IgYW5kIG5ldmVyIHVwZGF0ZSBpdHMgd2F0ZXJtYXJrIGFnYWluICovCi0JCQlpbnRlbF9z
ZXRfbWVtb3J5X2N4c3IoZGV2X3ByaXYsIGZhbHNlKTsKLQkJCWRldl9wcml2LT5kaXNwbGF5LnVw
ZGF0ZV93bSA9IE5VTEw7CisJCQlpbnRlbF9zZXRfbWVtb3J5X2N4c3IoaTkxNSwgZmFsc2UpOwor
CQkJaTkxNS0+ZGlzcGxheS51cGRhdGVfd20gPSBOVUxMOwogCQl9IGVsc2UKLQkJCWRldl9wcml2
LT5kaXNwbGF5LnVwZGF0ZV93bSA9IHBpbmV2aWV3X3VwZGF0ZV93bTsKLQl9IGVsc2UgaWYgKElT
X0dFTihkZXZfcHJpdiwgNCkpIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkudXBkYXRlX3dtID0gaTk2
NV91cGRhdGVfd207Ci0JfSBlbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDMpKSB7Ci0JCWRldl9w
cml2LT5kaXNwbGF5LnVwZGF0ZV93bSA9IGk5eHhfdXBkYXRlX3dtOwotCQlkZXZfcHJpdi0+ZGlz
cGxheS5nZXRfZmlmb19zaXplID0gaTl4eF9nZXRfZmlmb19zaXplOwotCX0gZWxzZSBpZiAoSVNf
R0VOKGRldl9wcml2LCAyKSkgewotCQlpZiAoSU5URUxfSU5GTyhkZXZfcHJpdiktPm51bV9waXBl
cyA9PSAxKSB7Ci0JCQlkZXZfcHJpdi0+ZGlzcGxheS51cGRhdGVfd20gPSBpODQ1X3VwZGF0ZV93
bTsKLQkJCWRldl9wcml2LT5kaXNwbGF5LmdldF9maWZvX3NpemUgPSBpODQ1X2dldF9maWZvX3Np
emU7CisJCQlpOTE1LT5kaXNwbGF5LnVwZGF0ZV93bSA9IHBpbmV2aWV3X3VwZGF0ZV93bTsKKwl9
IGVsc2UgaWYgKElTX0dFTihpOTE1LCA0KSkgeworCQlpOTE1LT5kaXNwbGF5LnVwZGF0ZV93bSA9
IGk5NjVfdXBkYXRlX3dtOworCX0gZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDMpKSB7CisJCWk5MTUt
PmRpc3BsYXkudXBkYXRlX3dtID0gaTl4eF91cGRhdGVfd207CisJCWk5MTUtPmRpc3BsYXkuZ2V0
X2ZpZm9fc2l6ZSA9IGk5eHhfZ2V0X2ZpZm9fc2l6ZTsKKwl9IGVsc2UgaWYgKElTX0dFTihpOTE1
LCAyKSkgeworCQlpZiAoSU5URUxfSU5GTyhpOTE1KS0+bnVtX3BpcGVzID09IDEpIHsKKwkJCWk5
MTUtPmRpc3BsYXkudXBkYXRlX3dtID0gaTg0NV91cGRhdGVfd207CisJCQlpOTE1LT5kaXNwbGF5
LmdldF9maWZvX3NpemUgPSBpODQ1X2dldF9maWZvX3NpemU7CiAJCX0gZWxzZSB7Ci0JCQlkZXZf
cHJpdi0+ZGlzcGxheS51cGRhdGVfd20gPSBpOXh4X3VwZGF0ZV93bTsKLQkJCWRldl9wcml2LT5k
aXNwbGF5LmdldF9maWZvX3NpemUgPSBpODMwX2dldF9maWZvX3NpemU7CisJCQlpOTE1LT5kaXNw
bGF5LnVwZGF0ZV93bSA9IGk5eHhfdXBkYXRlX3dtOworCQkJaTkxNS0+ZGlzcGxheS5nZXRfZmlm
b19zaXplID0gaTgzMF9nZXRfZmlmb19zaXplOwogCQl9CiAJfSBlbHNlIHsKIAkJRFJNX0VSUk9S
KCJ1bmV4cGVjdGVkIGZhbGwtdGhyb3VnaCBpbiBpbnRlbF9pbml0X3BtXG4iKTsKIAl9CiB9CiAK
LXN0YXRpYyBpbnQgYnl0X2dwdV9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgaW50IHZhbCkKK3N0YXRpYyBpbnQgYnl0X2dwdV9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCBpbnQgdmFsKQogewotCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZkZXZfcHJp
di0+Z3RfcG0ucnBzOworCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZpOTE1LT5ndF9wbS5ycHM7
CiAKIAkvKgogCSAqIE4gPSB2YWwgLSAweGI3CkBAIC05NzU2LDE2ICs5NzU2LDE2IEBAIHN0YXRp
YyBpbnQgYnl0X2dwdV9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50
IHZhbCkKIAlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QocnBzLT5ncGxsX3JlZl9mcmVxICogKHZh
bCAtIDB4YjcpLCAxMDAwKTsKIH0KIAotc3RhdGljIGludCBieXRfZnJlcV9vcGNvZGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgdmFsKQorc3RhdGljIGludCBieXRfZnJl
cV9vcGNvZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCB2YWwpCiB7Ci0Jc3Ry
dWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5ndF9wbS5ycHM7CisJc3RydWN0IGludGVs
X3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAogCXJldHVybiBESVZfUk9VTkRfQ0xPU0VT
VCgxMDAwICogdmFsLCBycHMtPmdwbGxfcmVmX2ZyZXEpICsgMHhiNzsKIH0KIAotc3RhdGljIGlu
dCBjaHZfZ3B1X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgdmFs
KQorc3RhdGljIGludCBjaHZfZ3B1X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IGludCB2YWwpCiB7Ci0Jc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5ndF9wbS5y
cHM7CisJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAogCS8qCiAJ
ICogTiA9IHZhbCAvIDIKQEAgLTk3NzQsNTIgKzk3NzQsNTIgQEAgc3RhdGljIGludCBjaHZfZ3B1
X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgdmFsKQogCXJldHVy
biBESVZfUk9VTkRfQ0xPU0VTVChycHMtPmdwbGxfcmVmX2ZyZXEgKiB2YWwsIDIgKiAyICogMTAw
MCk7CiB9CiAKLXN0YXRpYyBpbnQgY2h2X2ZyZXFfb3Bjb2RlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgaW50IHZhbCkKK3N0YXRpYyBpbnQgY2h2X2ZyZXFfb3Bjb2RlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgdmFsKQogewotCXN0cnVjdCBpbnRlbF9ycHMg
KnJwcyA9ICZkZXZfcHJpdi0+Z3RfcG0ucnBzOworCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZp
OTE1LT5ndF9wbS5ycHM7CiAKIAkvKiBDSFYgbmVlZHMgZXZlbiB2YWx1ZXMgKi8KIAlyZXR1cm4g
RElWX1JPVU5EX0NMT1NFU1QoMiAqIDEwMDAgKiB2YWwsIHJwcy0+Z3BsbF9yZWZfZnJlcSkgKiAy
OwogfQogCi1pbnQgaW50ZWxfZ3B1X2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCBpbnQgdmFsKQoraW50IGludGVsX2dwdV9mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCBpbnQgdmFsKQogewotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYg
KElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QodmFsICog
R1RfRlJFUVVFTkNZX01VTFRJUExJRVIsCiAJCQkJCSBHRU45X0ZSRVFfU0NBTEVSKTsKLQllbHNl
IGlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJcmV0dXJuIGNodl9ncHVfZnJlcShkZXZf
cHJpdiwgdmFsKTsKLQllbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKLQkJcmV0dXJu
IGJ5dF9ncHVfZnJlcShkZXZfcHJpdiwgdmFsKTsKKwllbHNlIGlmIChJU19DSEVSUllWSUVXKGk5
MTUpKQorCQlyZXR1cm4gY2h2X2dwdV9mcmVxKGk5MTUsIHZhbCk7CisJZWxzZSBpZiAoSVNfVkFM
TEVZVklFVyhpOTE1KSkKKwkJcmV0dXJuIGJ5dF9ncHVfZnJlcShpOTE1LCB2YWwpOwogCWVsc2UK
IAkJcmV0dXJuIHZhbCAqIEdUX0ZSRVFVRU5DWV9NVUxUSVBMSUVSOwogfQogCi1pbnQgaW50ZWxf
ZnJlcV9vcGNvZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgdmFsKQor
aW50IGludGVsX2ZyZXFfb3Bjb2RlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQg
dmFsKQogewotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYgKElOVEVMX0dFTihp
OTE1KSA+PSA5KQogCQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QodmFsICogR0VOOV9GUkVRX1ND
QUxFUiwKIAkJCQkJIEdUX0ZSRVFVRU5DWV9NVUxUSVBMSUVSKTsKLQllbHNlIGlmIChJU19DSEVS
UllWSUVXKGRldl9wcml2KSkKLQkJcmV0dXJuIGNodl9mcmVxX29wY29kZShkZXZfcHJpdiwgdmFs
KTsKLQllbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkKLQkJcmV0dXJuIGJ5dF9mcmVx
X29wY29kZShkZXZfcHJpdiwgdmFsKTsKKwllbHNlIGlmIChJU19DSEVSUllWSUVXKGk5MTUpKQor
CQlyZXR1cm4gY2h2X2ZyZXFfb3Bjb2RlKGk5MTUsIHZhbCk7CisJZWxzZSBpZiAoSVNfVkFMTEVZ
VklFVyhpOTE1KSkKKwkJcmV0dXJuIGJ5dF9mcmVxX29wY29kZShpOTE1LCB2YWwpOwogCWVsc2UK
IAkJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKHZhbCwgR1RfRlJFUVVFTkNZX01VTFRJUExJRVIp
OwogfQogCi12b2lkIGludGVsX3BtX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3ZvaWQgaW50ZWxfcG1fc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiB7Ci0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPmd0X3BtLnJwcy5sb2NrKTsKLQltdXRleF9pbml0
KCZkZXZfcHJpdi0+Z3RfcG0ucnBzLnBvd2VyLm11dGV4KTsKKwltdXRleF9pbml0KCZpOTE1LT5n
dF9wbS5ycHMubG9jayk7CisJbXV0ZXhfaW5pdCgmaTkxNS0+Z3RfcG0ucnBzLnBvd2VyLm11dGV4
KTsKIAotCWF0b21pY19zZXQoJmRldl9wcml2LT5ndF9wbS5ycHMubnVtX3dhaXRlcnMsIDApOwor
CWF0b21pY19zZXQoJmk5MTUtPmd0X3BtLnJwcy5udW1fd2FpdGVycywgMCk7CiAKLQlkZXZfcHJp
di0+cnVudGltZV9wbS5zdXNwZW5kZWQgPSBmYWxzZTsKLQlhdG9taWNfc2V0KCZkZXZfcHJpdi0+
cnVudGltZV9wbS53YWtlcmVmX2NvdW50LCAwKTsKKwlpOTE1LT5ydW50aW1lX3BtLnN1c3BlbmRl
ZCA9IGZhbHNlOworCWF0b21pY19zZXQoJmk5MTUtPnJ1bnRpbWVfcG0ud2FrZXJlZl9jb3VudCwg
MCk7CiB9CiAKLXN0YXRpYyB1NjQgdmx2X3Jlc2lkZW5jeV9yYXcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHU2NCB2bHZfcmVzaWRlbmN5X3JhdyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgY29uc3QgaTkxNV9yZWdfdCByZWcpCiB7CiAJ
dTMyIGxvd2VyLCB1cHBlciwgdG1wOwpAQCAtOTgyOSw3ICs5ODI5LDcgQEAgc3RhdGljIHU2NCB2
bHZfcmVzaWRlbmN5X3JhdyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICog
VGhlIHJlZ2lzdGVyIGFjY2Vzc2VkIGRvIG5vdCBuZWVkIGZvcmNld2FrZS4gV2UgYm9ycm93CiAJ
ICogdW5jb3JlIGxvY2sgdG8gcHJldmVudCBjb25jdXJyZW50IGFjY2VzcyB0byByYW5nZSByZWcu
CiAJICovCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnVuY29yZS5sb2NrKTsKKwls
b2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT51bmNvcmUubG9jayk7CiAKIAkvKgogCSAqIHZsdiBh
bmQgY2h2IHJlc2lkZW5jeSBjb3VudGVycyBhcmUgNDAgYml0cyBpbiB3aWR0aC4KQEAgLTk4NjUs
MTcgKzk4NjUsMTcgQEAgc3RhdGljIHU2NCB2bHZfcmVzaWRlbmN5X3JhdyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIGxvd2VyIHwgKHU2NCl1cHBlciA8PCA4Owog
fQogCi11NjQgaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCit1NjQgaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCSAgIGNvbnN0IGk5MTVfcmVnX3QgcmVnKQogewotCXN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBpbnRlbF91bmNv
cmUgKnVuY29yZSA9ICZpOTE1LT51bmNvcmU7CiAJdTY0IHRpbWVfaHcsIHByZXZfaHcsIG92ZXJm
bG93X2h3OwogCXVuc2lnbmVkIGludCBmd19kb21haW5zOwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7
CiAJdW5zaWduZWQgaW50IGk7CiAJdTMyIG11bCwgZGl2OwogCi0JaWYgKCFIQVNfUkM2KGRldl9w
cml2KSkKKwlpZiAoIUhBU19SQzYoaTkxNSkpCiAJCXJldHVybiAwOwogCiAJLyoKQEAgLTk4ODcs
NyArOTg4Nyw3IEBAIHU2NCBpbnRlbF9yYzZfcmVzaWRlbmN5X25zKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkgKi8KIAlpID0gKGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZykg
LQogCSAgICAgaTkxNV9tbWlvX3JlZ19vZmZzZXQoR0VONl9HVF9HRlhfUkM2X0xPQ0tFRCkpIC8g
c2l6ZW9mKHUzMik7Ci0JaWYgKFdBUk5fT05fT05DRShpID49IEFSUkFZX1NJWkUoZGV2X3ByaXYt
Pmd0X3BtLnJjNi5jdXJfcmVzaWRlbmN5KSkpCisJaWYgKFdBUk5fT05fT05DRShpID49IEFSUkFZ
X1NJWkUoaTkxNS0+Z3RfcG0ucmM2LmN1cl9yZXNpZGVuY3kpKSkKIAkJcmV0dXJuIDA7CiAKIAlm
d19kb21haW5zID0gaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9mb3JfcmVnKHVuY29yZSwgcmVnLCBG
V19SRUdfUkVBRCk7CkBAIC05ODk2LDE0ICs5ODk2LDE0IEBAIHU2NCBpbnRlbF9yYzZfcmVzaWRl
bmN5X25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpbnRlbF91bmNvcmVf
Zm9yY2V3YWtlX2dldF9fbG9ja2VkKHVuY29yZSwgZndfZG9tYWlucyk7CiAKIAkvKiBPbiBWTFYg
YW5kIENIViwgcmVzaWRlbmN5IHRpbWUgaXMgaW4gQ1ogdW5pdHMgcmF0aGVyIHRoYW4gMS4yOHVz
ICovCi0JaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3By
aXYpKSB7CisJaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkg
ewogCQltdWwgPSAxMDAwMDAwOwotCQlkaXYgPSBkZXZfcHJpdi0+Y3pjbGtfZnJlcTsKKwkJZGl2
ID0gaTkxNS0+Y3pjbGtfZnJlcTsKIAkJb3ZlcmZsb3dfaHcgPSBCSVRfVUxMKDQwKTsKLQkJdGlt
ZV9odyA9IHZsdl9yZXNpZGVuY3lfcmF3KGRldl9wcml2LCByZWcpOworCQl0aW1lX2h3ID0gdmx2
X3Jlc2lkZW5jeV9yYXcoaTkxNSwgcmVnKTsKIAl9IGVsc2UgewogCQkvKiA4MzMuMzNucyB1bml0
cyBvbiBHZW45TFAsIDEuMjh1cyBlbHNld2hlcmUuICovCi0JCWlmIChJU19HRU45X0xQKGRldl9w
cml2KSkgeworCQlpZiAoSVNfR0VOOV9MUChpOTE1KSkgewogCQkJbXVsID0gMTAwMDA7CiAJCQlk
aXYgPSAxMjsKIAkJfSBlbHNlIHsKQEAgLTk5MjEsOCArOTkyMSw4IEBAIHU2NCBpbnRlbF9yYzZf
cmVzaWRlbmN5X25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiBCdXQg
cmVseWluZyBvbiBhIHN1ZmZpY2llbnQgZnJlcXVlbmN5IG9mIHF1ZXJpZXMgb3RoZXJ3aXNlIGNv
dW50ZXJzCiAJICogY2FuIHN0aWxsIHdyYXAuCiAJICovCi0JcHJldl9odyA9IGRldl9wcml2LT5n
dF9wbS5yYzYucHJldl9od19yZXNpZGVuY3lbaV07Ci0JZGV2X3ByaXYtPmd0X3BtLnJjNi5wcmV2
X2h3X3Jlc2lkZW5jeVtpXSA9IHRpbWVfaHc7CisJcHJldl9odyA9IGk5MTUtPmd0X3BtLnJjNi5w
cmV2X2h3X3Jlc2lkZW5jeVtpXTsKKwlpOTE1LT5ndF9wbS5yYzYucHJldl9od19yZXNpZGVuY3lb
aV0gPSB0aW1lX2h3OwogCiAJLyogUkM2IGRlbHRhIGZyb20gbGFzdCBzYW1wbGUuICovCiAJaWYg
KHRpbWVfaHcgPj0gcHJldl9odykKQEAgLTk5MzEsOCArOTkzMSw4IEBAIHU2NCBpbnRlbF9yYzZf
cmVzaWRlbmN5X25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJdGltZV9o
dyArPSBvdmVyZmxvd19odyAtIHByZXZfaHc7CiAKIAkvKiBBZGQgZGVsdGEgdG8gUkM2IGV4dGVu
ZGVkIHJhdyBkcml2ZXIgY29weS4gKi8KLQl0aW1lX2h3ICs9IGRldl9wcml2LT5ndF9wbS5yYzYu
Y3VyX3Jlc2lkZW5jeVtpXTsKLQlkZXZfcHJpdi0+Z3RfcG0ucmM2LmN1cl9yZXNpZGVuY3lbaV0g
PSB0aW1lX2h3OworCXRpbWVfaHcgKz0gaTkxNS0+Z3RfcG0ucmM2LmN1cl9yZXNpZGVuY3lbaV07
CisJaTkxNS0+Z3RfcG0ucmM2LmN1cl9yZXNpZGVuY3lbaV0gPSB0aW1lX2h3OwogCiAJaW50ZWxf
dW5jb3JlX2ZvcmNld2FrZV9wdXRfX2xvY2tlZCh1bmNvcmUsIGZ3X2RvbWFpbnMpOwogCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJnVuY29yZS0+bG9jaywgZmxhZ3MpOwpAQCAtOTk0MCwxOSArOTk0
MCwxOSBAQCB1NjQgaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIG11bF91NjRfdTMyX2Rpdih0aW1lX2h3LCBtdWwsIGRpdik7
CiB9CiAKLXU2NCBpbnRlbF9yYzZfcmVzaWRlbmN5X3VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3U2NCBpbnRlbF9yYzZfcmVzaWRlbmN5X3VzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICAgaTkxNV9yZWdfdCByZWcpCiB7Ci0JcmV0dXJuIERJVl9ST1VO
RF9VUF9VTEwoaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhkZXZfcHJpdiwgcmVnKSwgMTAwMCk7CisJ
cmV0dXJuIERJVl9ST1VORF9VUF9VTEwoaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhpOTE1LCByZWcp
LCAxMDAwKTsKIH0KIAotdTMyIGludGVsX2dldF9jYWdmKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgdTMyIHJwc3RhdCkKK3UzMiBpbnRlbF9nZXRfY2FnZihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHJwc3RhdCkKIHsKIAl1MzIgY2FnZjsKIAotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQljYWdm
ID0gKHJwc3RhdCAmIEdFTjlfQ0FHRl9NQVNLKSA+PiBHRU45X0NBR0ZfU0hJRlQ7Ci0JZWxzZSBp
ZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKKwllbHNl
IGlmIChJU19IQVNXRUxMKGk5MTUpIHx8IElTX0JST0FEV0VMTChpOTE1KSkKIAkJY2FnZiA9IChy
cHN0YXQgJiBIU1dfQ0FHRl9NQVNLKSA+PiBIU1dfQ0FHRl9TSElGVDsKIAllbHNlCiAJCWNhZ2Yg
PSAocnBzdGF0ICYgR0VONl9DQUdGX01BU0spID4+IEdFTjZfQ0FHRl9TSElGVDsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9wbS5oCmluZGV4IDFiNDg5ZmEzOTllMS4uZTJjNGVkZjI2M2Y3IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3BtLmgKQEAgLTIyLDM5ICsyMiwzOSBAQCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeTsK
IHN0cnVjdCBza2xfcGlwZV93bTsKIHN0cnVjdCBza2xfd21fbGV2ZWw7CiAKLXZvaWQgaW50ZWxf
aW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZv
aWQgaW50ZWxfc3VzcGVuZF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwot
aW50IGlsa193bV9tYXhfbGV2ZWwoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KTsKK3ZvaWQgaW50ZWxfaW5pdF9jbG9ja19nYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwordm9pZCBpbnRlbF9zdXNwZW5kX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKK2ludCBpbGtfd21fbWF4X2xldmVsKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KTsKIHZvaWQgaW50ZWxfdXBkYXRlX3dhdGVybWFya3Moc3RydWN0IGludGVsX2Ny
dGMgKmNydGMpOwotdm9pZCBpbnRlbF9pbml0X3BtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7Ci12b2lkIGludGVsX2luaXRfY2xvY2tfZ2F0aW5nX2hvb2tzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX3BtX3NldHVwKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX2dwdV9pcHNfaW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9pbml0X3BtKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfaW5pdF9jbG9ja19nYXRpbmdfaG9v
a3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpbnRlbF9wbV9zZXR1cChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2dwdV9pcHNfaW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGludGVsX2dwdV9pcHNfdGVhcmRv
d24odm9pZCk7Ci12b2lkIGludGVsX2luaXRfZ3RfcG93ZXJzYXZlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX2NsZWFudXBfZ3RfcG93ZXJzYXZlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX3Nhbml0aXplX2d0X3Bv
d2Vyc2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF9l
bmFibGVfZ3RfcG93ZXJzYXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12
b2lkIGludGVsX2Rpc2FibGVfZ3RfcG93ZXJzYXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7Ci12b2lkIGdlbjZfcnBzX2J1c3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KTsKLXZvaWQgZ2VuNl9ycHNfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwordm9pZCBpbnRlbF9pbml0X2d0X3Bvd2Vyc2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2NsZWFudXBfZ3RfcG93ZXJzYXZlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfc2FuaXRpemVfZ3RfcG93ZXJzYXZlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfZW5hYmxlX2d0X3Bvd2Vy
c2F2ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2Rpc2FibGVf
Z3RfcG93ZXJzYXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgZ2VuNl9y
cHNfYnVzeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGdlbjZfcnBzX2lk
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBnZW42X3Jwc19ib29zdChz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7Ci12b2lkIGc0eF93bV9nZXRfaHdfc3RhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgdmx2X3dtX2dldF9od19zdGF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbGtfd21fZ2V0X2h3X3N0
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIHNrbF93bV9nZXRf
aHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgZzR4X3dt
X2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIHZsdl93
bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpbGtf
d21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgc2ts
X3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIHNr
bF9waXBlX2RkYl9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAg
ICAgc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYl95LAogCQkJICAgICAgIHN0cnVjdCBza2xfZGRi
X2VudHJ5ICpkZGJfdXYpOwotdm9pZCBza2xfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIHNrbF9kZGJfZ2V0X2h3X3N0YXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBzdHJ1Y3Qgc2tsX2RkYl9hbGxvY2F0aW9uICpk
ZGIgLyogb3V0ICovKTsKIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCQkJICAgICAgc3RydWN0IHNrbF9waXBlX3dtICpvdXQpOwotdm9pZCBn
NHhfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQg
dmx2X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lk
IGc0eF93bV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIHZs
dl93bV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBib29sIGludGVs
X2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwotaW50IGlu
dGVsX2VuYWJsZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1pbnQg
aW50ZWxfZGlzYWJsZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Citp
bnQgaW50ZWxfZW5hYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworaW50
IGludGVsX2Rpc2FibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBib29s
IHNrbF93bV9sZXZlbF9lcXVhbHMoY29uc3Qgc3RydWN0IHNrbF93bV9sZXZlbCAqbDEsCiAJCQkg
Y29uc3Qgc3RydWN0IHNrbF93bV9sZXZlbCAqbDIpOwogYm9vbCBza2xfZGRiX2FsbG9jYXRpb25f
b3ZlcmxhcHMoY29uc3Qgc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYiwKQEAgLTY3LDI0ICs2Nywy
NCBAQCB2b2lkIHNrbF93cml0ZV9jdXJzb3Jfd20oc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwK
IGJvb2wgaWxrX2Rpc2FibGVfbHBfd20oc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiBpbnQgc2ts
X2NoZWNrX3BpcGVfbWF4X3BpeGVsX3JhdGUoc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMs
CiAJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlKTsKLXZvaWQgaW50ZWxfaW5p
dF9pcGMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfZW5h
YmxlX2lwYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9p
bml0X2lwYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2VuYWJs
ZV9pcGMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCi1pbnQgaW50ZWxfZ3B1X2Zy
ZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgdmFsKTsKLWludCBpbnRl
bF9mcmVxX29wY29kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCB2YWwp
OwotdTY0IGludGVsX3JjNl9yZXNpZGVuY3lfbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBpOTE1X3JlZ190IHJlZyk7Ci11NjQgaW50ZWxfcmM2X3Jlc2lkZW5jeV91cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGk5MTVfcmVnX3QgcmVnKTsKK2ludCBpbnRl
bF9ncHVfZnJlcShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHZhbCk7CitpbnQg
aW50ZWxfZnJlcV9vcGNvZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCB2YWwp
OwordTY0IGludGVsX3JjNl9yZXNpZGVuY3lfbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsIGk5MTVfcmVnX3QgcmVnKTsKK3U2NCBpbnRlbF9yYzZfcmVzaWRlbmN5X3VzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LCBpOTE1X3JlZ190IHJlZyk7CiAKLXUzMiBpbnRlbF9nZXRf
Y2FnZihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBycHN0YXQxKTsKK3Uz
MiBpbnRlbF9nZXRfY2FnZihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHJwc3Rh
dDEpOwogCi11bnNpZ25lZCBsb25nIGk5MTVfY2hpcHNldF92YWwoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKLXVuc2lnbmVkIGxvbmcgaTkxNV9tY2hfdmFsKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci11bnNpZ25lZCBsb25nIGk5MTVfZ2Z4X3ZhbChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X3VwZGF0ZV9nZnhfdmFs
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit1bnNpZ25lZCBsb25nIGk5MTVf
Y2hpcHNldF92YWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordW5zaWduZWQgbG9u
ZyBpOTE1X21jaF92YWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordW5zaWduZWQg
bG9uZyBpOTE1X2dmeF92YWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBp
OTE1X3VwZGF0ZV9nZnhfdmFsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAotYm9v
bCBpcm9ubGFrZV9zZXRfZHJwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4
IHZhbCk7Ci1pbnQgaW50ZWxfc2V0X3JwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHU4IHZhbCk7Citib29sIGlyb25sYWtlX3NldF9kcnBzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCB1OCB2YWwpOworaW50IGludGVsX3NldF9ycHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIHU4IHZhbCk7CiB2b2lkIGludGVsX3Jwc19tYXJrX2ludGVyYWN0aXZlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29sIGludGVyYWN0aXZlKTsKLWJvb2wgaW50
ZWxfc2V0X21lbW9yeV9jeHNyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9v
bCBlbmFibGUpOworYm9vbCBpbnRlbF9zZXRfbWVtb3J5X2N4c3Ioc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIGJvb2wgZW5hYmxlKTsKIAogI2VuZGlmIC8qIF9fSU5URUxfUE1fSF9fICov
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3Bzci5jCmluZGV4IDAxY2E1MDIwOTlkZi4uMDcyZWVhMDBiMTdh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wc3IuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wc3IuYwpAQCAtNzEsMTQgKzcxLDE0IEBAIHN0YXRpYyBi
b29sIHBzcl9nbG9iYWxfZW5hYmxlZCh1MzIgZGVidWcpCiAJfQogfQogCi1zdGF0aWMgYm9vbCBp
bnRlbF9wc3IyX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIGJvb2wgaW50ZWxfcHNyMl9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewogCS8qIENhbm5vdCBlbmFibGUgRFNDIGFuZCBQU1IyIHNpbXVsdGFuZW91c2x5ICovCiAJV0FS
Tl9PTihjcnRjX3N0YXRlLT5kc2NfcGFyYW1zLmNvbXByZXNzaW9uX2VuYWJsZSAmJgogCQljcnRj
X3N0YXRlLT5oYXNfcHNyMik7CiAKLQlzd2l0Y2ggKGRldl9wcml2LT5wc3IuZGVidWcgJiBJOTE1
X1BTUl9ERUJVR19NT0RFX01BU0spIHsKKwlzd2l0Y2ggKGk5MTUtPnBzci5kZWJ1ZyAmIEk5MTVf
UFNSX0RFQlVHX01PREVfTUFTSykgewogCWNhc2UgSTkxNV9QU1JfREVCVUdfRElTQUJMRToKIAlj
YXNlIEk5MTVfUFNSX0RFQlVHX0ZPUkNFX1BTUjE6CiAJCXJldHVybiBmYWxzZTsKQEAgLTEwNCwy
MCArMTA0LDIwIEBAIHN0YXRpYyBpbnQgZWRwX3Bzcl9zaGlmdChlbnVtIHRyYW5zY29kZXIgY3B1
X3RyYW5zY29kZXIpCiAJfQogfQogCi12b2lkIGludGVsX3Bzcl9pcnFfY29udHJvbChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBkZWJ1ZykKK3ZvaWQgaW50ZWxfcHNyX2ly
cV9jb250cm9sKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgZGVidWcpCiB7CiAJ
dTMyIGRlYnVnX21hc2ssIG1hc2s7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyOwog
CXUzMiB0cmFuc2NvZGVycyA9IEJJVChUUkFOU0NPREVSX0VEUCk7CiAKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA4KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCkKIAkJdHJhbnNjb2Rl
cnMgfD0gQklUKFRSQU5TQ09ERVJfQSkgfAogCQkJICAgICAgIEJJVChUUkFOU0NPREVSX0IpIHwK
IAkJCSAgICAgICBCSVQoVFJBTlNDT0RFUl9DKTsKIAogCWRlYnVnX21hc2sgPSAwOwogCW1hc2sg
PSAwOwotCWZvcl9lYWNoX2NwdV90cmFuc2NvZGVyX21hc2tlZChkZXZfcHJpdiwgY3B1X3RyYW5z
Y29kZXIsIHRyYW5zY29kZXJzKSB7CisJZm9yX2VhY2hfY3B1X3RyYW5zY29kZXJfbWFza2VkKGk5
MTUsIGNwdV90cmFuc2NvZGVyLCB0cmFuc2NvZGVycykgewogCQlpbnQgc2hpZnQgPSBlZHBfcHNy
X3NoaWZ0KGNwdV90cmFuc2NvZGVyKTsKIAogCQltYXNrIHw9IEVEUF9QU1JfRVJST1Ioc2hpZnQp
OwpAQCAtMTY4LDI2ICsxNjgsMjYgQEAgc3RhdGljIHZvaWQgcHNyX2V2ZW50X3ByaW50KHUzMiB2
YWwsIGJvb2wgcHNyMl9lbmFibGVkKQogCQlEUk1fREVCVUdfS01TKCJcdFBTUiBkaXNhYmxlZFxu
Iik7CiB9CiAKLXZvaWQgaW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIpCit2b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHBzcl9paXIpCiB7CiAJdTMyIHRyYW5z
Y29kZXJzID0gQklUKFRSQU5TQ09ERVJfRURQKTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5z
Y29kZXI7CiAJa3RpbWVfdCB0aW1lX25zID0gIGt0aW1lX2dldCgpOwogCXUzMiBtYXNrID0gMDsK
IAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+
PSA4KQogCQl0cmFuc2NvZGVycyB8PSBCSVQoVFJBTlNDT0RFUl9BKSB8CiAJCQkgICAgICAgQklU
KFRSQU5TQ09ERVJfQikgfAogCQkJICAgICAgIEJJVChUUkFOU0NPREVSX0MpOwogCi0JZm9yX2Vh
Y2hfY3B1X3RyYW5zY29kZXJfbWFza2VkKGRldl9wcml2LCBjcHVfdHJhbnNjb2RlciwgdHJhbnNj
b2RlcnMpIHsKKwlmb3JfZWFjaF9jcHVfdHJhbnNjb2Rlcl9tYXNrZWQoaTkxNSwgY3B1X3RyYW5z
Y29kZXIsIHRyYW5zY29kZXJzKSB7CiAJCWludCBzaGlmdCA9IGVkcF9wc3Jfc2hpZnQoY3B1X3Ry
YW5zY29kZXIpOwogCiAJCWlmIChwc3JfaWlyICYgRURQX1BTUl9FUlJPUihzaGlmdCkpIHsKIAkJ
CURSTV9XQVJOKCJbdHJhbnNjb2RlciAlc10gUFNSIGF1eCBlcnJvclxuIiwKIAkJCQkgdHJhbnNj
b2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CiAKLQkJCWRldl9wcml2LT5wc3IuaXJxX2F1eF9l
cnJvciA9IHRydWU7CisJCQlpOTE1LT5wc3IuaXJxX2F1eF9lcnJvciA9IHRydWU7CiAKIAkJCS8q
CiAJCQkgKiBJZiB0aGlzIGludGVycnVwdGlvbiBpcyBub3QgbWFza2VkIGl0IHdpbGwga2VlcApA
QCAtMjAxLDE5ICsyMDEsMTkgQEAgdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKIAkJfQogCiAJCWlmIChwc3Jf
aWlyICYgRURQX1BTUl9QUkVfRU5UUlkoc2hpZnQpKSB7Ci0JCQlkZXZfcHJpdi0+cHNyLmxhc3Rf
ZW50cnlfYXR0ZW1wdCA9IHRpbWVfbnM7CisJCQlpOTE1LT5wc3IubGFzdF9lbnRyeV9hdHRlbXB0
ID0gdGltZV9uczsKIAkJCURSTV9ERUJVR19LTVMoIlt0cmFuc2NvZGVyICVzXSBQU1IgZW50cnkg
YXR0ZW1wdCBpbiAyIHZibGFua3NcbiIsCiAJCQkJICAgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90
cmFuc2NvZGVyKSk7CiAJCX0KIAogCQlpZiAocHNyX2lpciAmIEVEUF9QU1JfUE9TVF9FWElUKHNo
aWZ0KSkgewotCQkJZGV2X3ByaXYtPnBzci5sYXN0X2V4aXQgPSB0aW1lX25zOworCQkJaTkxNS0+
cHNyLmxhc3RfZXhpdCA9IHRpbWVfbnM7CiAJCQlEUk1fREVCVUdfS01TKCJbdHJhbnNjb2RlciAl
c10gUFNSIGV4aXQgY29tcGxldGVkXG4iLAogCQkJCSAgICAgIHRyYW5zY29kZXJfbmFtZShjcHVf
dHJhbnNjb2RlcikpOwogCi0JCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KSB7CisJCQlp
ZiAoSU5URUxfR0VOKGk5MTUpID49IDkpIHsKIAkJCQl1MzIgdmFsID0gSTkxNV9SRUFEKFBTUl9F
VkVOVChjcHVfdHJhbnNjb2RlcikpOwotCQkJCWJvb2wgcHNyMl9lbmFibGVkID0gZGV2X3ByaXYt
PnBzci5wc3IyX2VuYWJsZWQ7CisJCQkJYm9vbCBwc3IyX2VuYWJsZWQgPSBpOTE1LT5wc3IucHNy
Ml9lbmFibGVkOwogCiAJCQkJSTkxNV9XUklURShQU1JfRVZFTlQoY3B1X3RyYW5zY29kZXIpLCB2
YWwpOwogCQkJCXBzcl9ldmVudF9wcmludCh2YWwsIHBzcjJfZW5hYmxlZCk7CkBAIC0yMjUsNyAr
MjI1LDcgQEAgdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKIAkJbWFzayB8PSBJOTE1X1JFQUQoRURQX1BTUl9J
TVIpOwogCQlJOTE1X1dSSVRFKEVEUF9QU1JfSU1SLCBtYXNrKTsKIAotCQlzY2hlZHVsZV93b3Jr
KCZkZXZfcHJpdi0+cHNyLndvcmspOworCQlzY2hlZHVsZV93b3JrKCZpOTE1LT5wc3Iud29yayk7
CiAJfQogfQogCkBAIC0yNzksNyArMjc5LDcgQEAgc3RhdGljIHUxNiBpbnRlbF9kcF9nZXRfc3Vf
eF9ncmFudWxhcnRpeShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCiB2b2lkIGludGVsX3Bz
cl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0K
IAkJdG9faTkxNShkcF90b19kaWdfcG9ydChpbnRlbF9kcCktPmJhc2UuYmFzZS5kZXYpOwogCiAJ
ZHJtX2RwX2RwY2RfcmVhZCgmaW50ZWxfZHAtPmF1eCwgRFBfUFNSX1NVUFBPUlQsIGludGVsX2Rw
LT5wc3JfZHBjZCwKQEAgLTMwMCwxNCArMzAwLDE0IEBAIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBj
ZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQlyZXR1cm47CiAJfQogCi0JZGV2X3ByaXYt
PnBzci5zaW5rX3N1cHBvcnQgPSB0cnVlOwotCWRldl9wcml2LT5wc3Iuc2lua19zeW5jX2xhdGVu
Y3kgPQorCWk5MTUtPnBzci5zaW5rX3N1cHBvcnQgPSB0cnVlOworCWk5MTUtPnBzci5zaW5rX3N5
bmNfbGF0ZW5jeSA9CiAJCWludGVsX2RwX2dldF9zaW5rX3N5bmNfbGF0ZW5jeShpbnRlbF9kcCk7
CiAKLQlXQVJOX09OKGRldl9wcml2LT5wc3IuZHApOwotCWRldl9wcml2LT5wc3IuZHAgPSBpbnRl
bF9kcDsKKwlXQVJOX09OKGk5MTUtPnBzci5kcCk7CisJaTkxNS0+cHNyLmRwID0gaW50ZWxfZHA7
CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5ICYmCisJaWYgKElOVEVMX0dFTihpOTE1
KSA+PSA5ICYmCiAJICAgIChpbnRlbF9kcC0+cHNyX2RwY2RbMF0gPT0gRFBfUFNSMl9XSVRIX1lf
Q09PUkRfSVNfU1VQUE9SVEVEKSkgewogCQlib29sIHlfcmVxID0gaW50ZWxfZHAtPnBzcl9kcGNk
WzFdICYKIAkJCSAgICAgRFBfUFNSMl9TVV9ZX0NPT1JESU5BVEVfUkVRVUlSRUQ7CkBAIC0zMjQs
MTQgKzMyNCwxNCBAQCB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIAkJICogWS1jb29yZGluYXRlIHJlcXVpcmVtZW50IHBhbmVscyB3ZSB3b3VsZCBu
ZWVkIHRvIGVuYWJsZQogCQkgKiBHVEMgZmlyc3QuCiAJCSAqLwotCQlkZXZfcHJpdi0+cHNyLnNp
bmtfcHNyMl9zdXBwb3J0ID0geV9yZXEgJiYgYWxwbTsKKwkJaTkxNS0+cHNyLnNpbmtfcHNyMl9z
dXBwb3J0ID0geV9yZXEgJiYgYWxwbTsKIAkJRFJNX0RFQlVHX0tNUygiUFNSMiAlc3N1cHBvcnRl
ZFxuIiwKLQkJCSAgICAgIGRldl9wcml2LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQgPyAiIiA6ICJu
b3QgIik7CisJCQkgICAgICBpOTE1LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQgPyAiIiA6ICJub3Qg
Iik7CiAKLQkJaWYgKGRldl9wcml2LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpIHsKLQkJCWRldl9w
cml2LT5wc3IuY29sb3JpbWV0cnlfc3VwcG9ydCA9CisJCWlmIChpOTE1LT5wc3Iuc2lua19wc3Iy
X3N1cHBvcnQpIHsKKwkJCWk5MTUtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0ID0KIAkJCQlpbnRl
bF9kcF9nZXRfY29sb3JpbWV0cnlfc3RhdHVzKGludGVsX2RwKTsKLQkJCWRldl9wcml2LT5wc3Iu
c3VfeF9ncmFudWxhcml0eSA9CisJCQlpOTE1LT5wc3Iuc3VfeF9ncmFudWxhcml0eSA9CiAJCQkJ
aW50ZWxfZHBfZ2V0X3N1X3hfZ3JhbnVsYXJ0aXkoaW50ZWxfZHApOwogCQl9CiAJfQpAQCAtMzQx
LDE1ICszNDEsMTUgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX3NldHVwX3ZzYyhzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAogCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0ID0g
ZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGRwX3NkcCBwc3JfdnNjOwogCi0J
aWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSB7CisJaWYgKGk5MTUtPnBzci5wc3IyX2Vu
YWJsZWQpIHsKIAkJLyogUHJlcGFyZSBWU0MgSGVhZGVyIGZvciBTVSBhcyBwZXIgRURQIDEuNCBz
cGVjLCBUYWJsZSA2LjExICovCiAJCW1lbXNldCgmcHNyX3ZzYywgMCwgc2l6ZW9mKHBzcl92c2Mp
KTsKIAkJcHNyX3ZzYy5zZHBfaGVhZGVyLkhCMCA9IDA7CiAJCXBzcl92c2Muc2RwX2hlYWRlci5I
QjEgPSAweDc7Ci0JCWlmIChkZXZfcHJpdi0+cHNyLmNvbG9yaW1ldHJ5X3N1cHBvcnQpIHsKKwkJ
aWYgKGk5MTUtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0KSB7CiAJCQlwc3JfdnNjLnNkcF9oZWFk
ZXIuSEIyID0gMHg1OwogCQkJcHNyX3ZzYy5zZHBfaGVhZGVyLkhCMyA9IDB4MTM7CiAJCX0gZWxz
ZSB7CkBAIC0zNzIsNyArMzcyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX3NldHVwX3ZzYyhz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCiBzdGF0aWMgdm9pZCBoc3dfcHNyX3NldHVwX2F1
eChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTMyIGF1eF9jbG9ja19kaXZpZGVy
LCBhdXhfY3RsOwogCWludCBpOwogCXN0YXRpYyBjb25zdCB1OCBhdXhfbXNnW10gPSB7CkBAIC00
MDUsMTkgKzQwNSwxOSBAQCBzdGF0aWMgdm9pZCBoc3dfcHNyX3NldHVwX2F1eChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQogCiBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3Npbmsoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXU4IGRwY2RfdmFsID0gRFBfUFNSX0VOQUJM
RTsKIAogCS8qIEVuYWJsZSBBTFBNIGF0IHNpbmsgZm9yIHBzcjIgKi8KLQlpZiAoZGV2X3ByaXYt
PnBzci5wc3IyX2VuYWJsZWQpIHsKKwlpZiAoaTkxNS0+cHNyLnBzcjJfZW5hYmxlZCkgewogCQlk
cm1fZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsIERQX1JFQ0VJVkVSX0FMUE1fQ09ORklH
LAogCQkJCSAgIERQX0FMUE1fRU5BQkxFKTsKIAkJZHBjZF92YWwgfD0gRFBfUFNSX0VOQUJMRV9Q
U1IyIHwgRFBfUFNSX0lSUV9IUERfV0lUSF9DUkNfRVJST1JTOwogCX0gZWxzZSB7Ci0JCWlmIChk
ZXZfcHJpdi0+cHNyLmxpbmtfc3RhbmRieSkKKwkJaWYgKGk5MTUtPnBzci5saW5rX3N0YW5kYnkp
CiAJCQlkcGNkX3ZhbCB8PSBEUF9QU1JfTUFJTl9MSU5LX0FDVElWRTsKIAotCQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA4KQorCQlpZiAoSU5URUxfR0VOKGk5MTUpID49IDgpCiAJCQlkcGNk
X3ZhbCB8PSBEUF9QU1JfQ1JDX1ZFUklGSUNBVElPTjsKIAl9CiAKQEAgLTQyOCwyNiArNDI4LDI2
IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc2luayhzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwKQogCiBzdGF0aWMgdTMyIGludGVsX3BzcjFfZ2V0X3RwX3RpbWUoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBk
cF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOwogCXUzMiB2YWwgPSAwOwogCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkKIAkJdmFsIHw9IEVEUF9Q
U1JfVFA0X1RJTUVfMFVTOwogCi0JaWYgKGRldl9wcml2LT52YnQucHNyLnRwMV93YWtldXBfdGlt
ZV91cyA9PSAwKQorCWlmIChpOTE1LT52YnQucHNyLnRwMV93YWtldXBfdGltZV91cyA9PSAwKQog
CQl2YWwgfD0gRURQX1BTUl9UUDFfVElNRV8wdXM7Ci0JZWxzZSBpZiAoZGV2X3ByaXYtPnZidC5w
c3IudHAxX3dha2V1cF90aW1lX3VzIDw9IDEwMCkKKwllbHNlIGlmIChpOTE1LT52YnQucHNyLnRw
MV93YWtldXBfdGltZV91cyA8PSAxMDApCiAJCXZhbCB8PSBFRFBfUFNSX1RQMV9USU1FXzEwMHVz
OwotCWVsc2UgaWYgKGRldl9wcml2LT52YnQucHNyLnRwMV93YWtldXBfdGltZV91cyA8PSA1MDAp
CisJZWxzZSBpZiAoaTkxNS0+dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMgPD0gNTAwKQogCQl2
YWwgfD0gRURQX1BTUl9UUDFfVElNRV81MDB1czsKIAllbHNlCiAJCXZhbCB8PSBFRFBfUFNSX1RQ
MV9USU1FXzI1MDB1czsKIAotCWlmIChkZXZfcHJpdi0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90
aW1lX3VzID09IDApCisJaWYgKGk5MTUtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9
PSAwKQogCQl2YWwgfD0gRURQX1BTUl9UUDJfVFAzX1RJTUVfMHVzOwotCWVsc2UgaWYgKGRldl9w
cml2LT52YnQucHNyLnRwMl90cDNfd2FrZXVwX3RpbWVfdXMgPD0gMTAwKQorCWVsc2UgaWYgKGk5
MTUtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA8PSAxMDApCiAJCXZhbCB8PSBFRFBf
UFNSX1RQMl9UUDNfVElNRV8xMDB1czsKLQllbHNlIGlmIChkZXZfcHJpdi0+dmJ0LnBzci50cDJf
dHAzX3dha2V1cF90aW1lX3VzIDw9IDUwMCkKKwllbHNlIGlmIChpOTE1LT52YnQucHNyLnRwMl90
cDNfd2FrZXVwX3RpbWVfdXMgPD0gNTAwKQogCQl2YWwgfD0gRURQX1BTUl9UUDJfVFAzX1RJTUVf
NTAwdXM7CiAJZWxzZQogCQl2YWwgfD0gRURQX1BTUl9UUDJfVFAzX1RJTUVfMjUwMHVzOwpAQCAt
NDYzLDMxICs0NjMsMzEgQEAgc3RhdGljIHUzMiBpbnRlbF9wc3IxX2dldF90cF90aW1lKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IxKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1MzIgbWF4X3NsZWVwX3RpbWUgPSAweDFm
OwogCXUzMiB2YWwgPSBFRFBfUFNSX0VOQUJMRTsKIAogCS8qIExldCdzIHVzZSA2IGFzIHRoZSBt
aW5pbXVtIHRvIGNvdmVyIGFsbCBrbm93biBjYXNlcyBpbmNsdWRpbmcgdGhlCiAJICogb2ZmLWJ5
LW9uZSBpc3N1ZSB0aGF0IEhXIGhhcyBpbiBzb21lIGNhc2VzLgogCSAqLwotCWludCBpZGxlX2Zy
YW1lcyA9IG1heCg2LCBkZXZfcHJpdi0+dmJ0LnBzci5pZGxlX2ZyYW1lcyk7CisJaW50IGlkbGVf
ZnJhbWVzID0gbWF4KDYsIGk5MTUtPnZidC5wc3IuaWRsZV9mcmFtZXMpOwogCiAJLyogc2lua19z
eW5jX2xhdGVuY3kgb2YgOCBtZWFucyBzb3VyY2UgaGFzIHRvIHdhaXQgZm9yIG1vcmUgdGhhbiA4
CiAJICogZnJhbWVzLCB3ZSdsbCBnbyB3aXRoIDkgZnJhbWVzIGZvciBub3cKIAkgKi8KLQlpZGxl
X2ZyYW1lcyA9IG1heChpZGxlX2ZyYW1lcywgZGV2X3ByaXYtPnBzci5zaW5rX3N5bmNfbGF0ZW5j
eSArIDEpOworCWlkbGVfZnJhbWVzID0gbWF4KGlkbGVfZnJhbWVzLCBpOTE1LT5wc3Iuc2lua19z
eW5jX2xhdGVuY3kgKyAxKTsKIAl2YWwgfD0gaWRsZV9mcmFtZXMgPDwgRURQX1BTUl9JRExFX0ZS
QU1FX1NISUZUOwogCiAJdmFsIHw9IG1heF9zbGVlcF90aW1lIDw8IEVEUF9QU1JfTUFYX1NMRUVQ
X1RJTUVfU0hJRlQ7Ci0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQorCWlmIChJU19IQVNXRUxM
KGk5MTUpKQogCQl2YWwgfD0gRURQX1BTUl9NSU5fTElOS19FTlRSWV9USU1FXzhfTElORVM7CiAK
LQlpZiAoZGV2X3ByaXYtPnBzci5saW5rX3N0YW5kYnkpCisJaWYgKGk5MTUtPnBzci5saW5rX3N0
YW5kYnkpCiAJCXZhbCB8PSBFRFBfUFNSX0xJTktfU1RBTkRCWTsKIAogCXZhbCB8PSBpbnRlbF9w
c3IxX2dldF90cF90aW1lKGludGVsX2RwKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDgpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KQogCQl2YWwgfD0gRURQX1BTUl9DUkNfRU5B
QkxFOwogCiAJdmFsIHw9IEk5MTVfUkVBRChFRFBfUFNSX0NUTCkgJiBFRFBfUFNSX1JFU1RPUkVf
UFNSX0FDVElWRV9DVFhfTUFTSzsKQEAgLTQ5NiwyOSArNDk2LDI5IEBAIHN0YXRpYyB2b2lkIGhz
d19hY3RpdmF0ZV9wc3IxKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIHN0YXRpYyB2b2lk
IGhzd19hY3RpdmF0ZV9wc3IyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1MzIg
dmFsOwogCiAJLyogTGV0J3MgdXNlIDYgYXMgdGhlIG1pbmltdW0gdG8gY292ZXIgYWxsIGtub3du
IGNhc2VzIGluY2x1ZGluZyB0aGUKIAkgKiBvZmYtYnktb25lIGlzc3VlIHRoYXQgSFcgaGFzIGlu
IHNvbWUgY2FzZXMuCiAJICovCi0JaW50IGlkbGVfZnJhbWVzID0gbWF4KDYsIGRldl9wcml2LT52
YnQucHNyLmlkbGVfZnJhbWVzKTsKKwlpbnQgaWRsZV9mcmFtZXMgPSBtYXgoNiwgaTkxNS0+dmJ0
LnBzci5pZGxlX2ZyYW1lcyk7CiAKLQlpZGxlX2ZyYW1lcyA9IG1heChpZGxlX2ZyYW1lcywgZGV2
X3ByaXYtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOworCWlkbGVfZnJhbWVzID0gbWF4KGlk
bGVfZnJhbWVzLCBpOTE1LT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgKyAxKTsKIAl2YWwgPSBpZGxl
X2ZyYW1lcyA8PCBFRFBfUFNSMl9JRExFX0ZSQU1FX1NISUZUOwogCiAJdmFsIHw9IEVEUF9QU1Iy
X0VOQUJMRSB8IEVEUF9TVV9UUkFDS19FTkFCTEU7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+
PSAxMCB8fCBJU19HRU1JTklMQUtFKGk5MTUpKQogCQl2YWwgfD0gRURQX1lfQ09PUkRJTkFURV9F
TkFCTEU7CiAKLQl2YWwgfD0gRURQX1BTUjJfRlJBTUVfQkVGT1JFX1NVKGRldl9wcml2LT5wc3Iu
c2lua19zeW5jX2xhdGVuY3kgKyAxKTsKKwl2YWwgfD0gRURQX1BTUjJfRlJBTUVfQkVGT1JFX1NV
KGk5MTUtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOwogCi0JaWYgKGRldl9wcml2LT52YnQu
cHNyLnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA+PSAwICYmCi0JICAgIGRldl9wcml2LT52
YnQucHNyLnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA8PSA1MCkKKwlpZiAoaTkxNS0+dmJ0
LnBzci5wc3IyX3RwMl90cDNfd2FrZXVwX3RpbWVfdXMgPj0gMCAmJgorCSAgICBpOTE1LT52YnQu
cHNyLnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA8PSA1MCkKIAkJdmFsIHw9IEVEUF9QU1Iy
X1RQMl9USU1FXzUwdXM7Ci0JZWxzZSBpZiAoZGV2X3ByaXYtPnZidC5wc3IucHNyMl90cDJfdHAz
X3dha2V1cF90aW1lX3VzIDw9IDEwMCkKKwllbHNlIGlmIChpOTE1LT52YnQucHNyLnBzcjJfdHAy
X3RwM193YWtldXBfdGltZV91cyA8PSAxMDApCiAJCXZhbCB8PSBFRFBfUFNSMl9UUDJfVElNRV8x
MDB1czsKLQllbHNlIGlmIChkZXZfcHJpdi0+dmJ0LnBzci5wc3IyX3RwMl90cDNfd2FrZXVwX3Rp
bWVfdXMgPD0gNTAwKQorCWVsc2UgaWYgKGk5MTUtPnZidC5wc3IucHNyMl90cDJfdHAzX3dha2V1
cF90aW1lX3VzIDw9IDUwMCkKIAkJdmFsIHw9IEVEUF9QU1IyX1RQMl9USU1FXzUwMHVzOwogCWVs
c2UKIAkJdmFsIHw9IEVEUF9QU1IyX1RQMl9USU1FXzI1MDB1czsKQEAgLTUzNSwxMiArNTM1LDEy
IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiBzdGF0aWMgYm9vbCBpbnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVs
X2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxf
ZHApOwogCWludCBjcnRjX2hkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2Rl
LmNydGNfaGRpc3BsYXk7CiAJaW50IGNydGNfdmRpc3BsYXkgPSBjcnRjX3N0YXRlLT5iYXNlLmFk
anVzdGVkX21vZGUuY3J0Y192ZGlzcGxheTsKIAlpbnQgcHNyX21heF9oID0gMCwgcHNyX21heF92
ID0gMDsKIAotCWlmICghZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkKKwlpZiAoIWk5
MTUtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkKIAkJcmV0dXJuIGZhbHNlOwogCiAJLyoKQEAgLTU1
MywxMCArNTUzLDEwIEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCWlmIChJ
TlRFTF9HRU4oaTkxNSkgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShpOTE1KSkgewogCQlwc3JfbWF4
X2ggPSA0MDk2OwogCQlwc3JfbWF4X3YgPSAyMzA0OwotCX0gZWxzZSBpZiAoSVNfR0VOKGRldl9w
cml2LCA5KSkgeworCX0gZWxzZSBpZiAoSVNfR0VOKGk5MTUsIDkpKSB7CiAJCXBzcl9tYXhfaCA9
IDM2NDA7CiAJCXBzcl9tYXhfdiA9IDIzMDQ7CiAJfQpAQCAtNTc0LDkgKzU3NCw5IEBAIHN0YXRp
YyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAs
CiAJICogb25seSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBTVSBibG9jayB3aWR0aCBpcyBhIG11bHRp
cGxlIG9mCiAJICogeCBncmFudWxhcml0eS4KIAkgKi8KLQlpZiAoY3J0Y19oZGlzcGxheSAlIGRl
dl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSkgeworCWlmIChjcnRjX2hkaXNwbGF5ICUgaTkx
NS0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkpIHsKIAkJRFJNX0RFQlVHX0tNUygiUFNSMiBub3QgZW5h
YmxlZCwgaGRpc3BsYXkoJWQpIG5vdCBtdWx0aXBsZSBvZiAlZFxuIiwKLQkJCSAgICAgIGNydGNf
aGRpc3BsYXksIGRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSk7CisJCQkgICAgICBjcnRj
X2hkaXNwbGF5LCBpOTE1LT5wc3Iuc3VfeF9ncmFudWxhcml0eSk7CiAJCXJldHVybiBmYWxzZTsK
IAl9CiAKQEAgLTU5MiwxNSArNTkyLDE1IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmln
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9y
dCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0KIAkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9k
ZTsKIAlpbnQgcHNyX3NldHVwX3RpbWU7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKQorCWlm
ICghQ0FOX1BTUihpOTE1KSkKIAkJcmV0dXJuOwogCi0JaWYgKGludGVsX2RwICE9IGRldl9wcml2
LT5wc3IuZHApCisJaWYgKGludGVsX2RwICE9IGk5MTUtPnBzci5kcCkKIAkJcmV0dXJuOwogCiAJ
LyoKQEAgLTYxNSw3ICs2MTUsNyBAQCB2b2lkIGludGVsX3Bzcl9jb21wdXRlX2NvbmZpZyhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQlyZXR1cm47CiAJfQogCi0JaWYgKGRldl9wcml2LT5w
c3Iuc2lua19ub3RfcmVsaWFibGUpIHsKKwlpZiAoaTkxNS0+cHNyLnNpbmtfbm90X3JlbGlhYmxl
KSB7CiAJCURSTV9ERUJVR19LTVMoIlBTUiBzaW5rIGltcGxlbWVudGF0aW9uIGlzIG5vdCByZWxp
YWJsZVxuIik7CiAJCXJldHVybjsKIAl9CkBAIC02NDUsMjQgKzY0NSwyNCBAQCB2b2lkIGludGVs
X3Bzcl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCiBzdGF0aWMg
dm9pZCBpbnRlbF9wc3JfYWN0aXZhdGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDkpCiAJCVdBUk5fT04oSTkxNV9SRUFEKEVEUF9QU1IyX0NUTCkgJiBFRFBfUFNSMl9FTkFCTEUp
OwogCVdBUk5fT04oSTkxNV9SRUFEKEVEUF9QU1JfQ1RMKSAmIEVEUF9QU1JfRU5BQkxFKTsKLQlX
QVJOX09OKGRldl9wcml2LT5wc3IuYWN0aXZlKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZf
cHJpdi0+cHNyLmxvY2spOworCVdBUk5fT04oaTkxNS0+cHNyLmFjdGl2ZSk7CisJbG9ja2RlcF9h
c3NlcnRfaGVsZCgmaTkxNS0+cHNyLmxvY2spOwogCiAJLyogcHNyMSBhbmQgcHNyMiBhcmUgbXV0
dWFsbHkgZXhjbHVzaXZlLiovCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKQorCWlm
IChpOTE1LT5wc3IucHNyMl9lbmFibGVkKQogCQloc3dfYWN0aXZhdGVfcHNyMihpbnRlbF9kcCk7
CiAJZWxzZQogCQloc3dfYWN0aXZhdGVfcHNyMShpbnRlbF9kcCk7CiAKLQlkZXZfcHJpdi0+cHNy
LmFjdGl2ZSA9IHRydWU7CisJaTkxNS0+cHNyLmFjdGl2ZSA9IHRydWU7CiB9CiAKLXN0YXRpYyBp
OTE1X3JlZ190IGdlbjlfY2hpY2tlbl90cmFuc19yZWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIGk5MTVfcmVnX3QgZ2VuOV9jaGlja2VuX3RyYW5zX3JlZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJIGVudW0gdHJhbnNjb2RlciBjcHVfdHJh
bnNjb2RlcikKIHsKIAlzdGF0aWMgY29uc3QgaTkxNV9yZWdfdCByZWdzW10gPSB7CkBAIC02NzIs
NyArNjcyLDcgQEAgc3RhdGljIGk5MTVfcmVnX3QgZ2VuOV9jaGlja2VuX3RyYW5zX3JlZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCVtUUkFOU0NPREVSX0VEUF0gPSBDSElD
S0VOX1RSQU5TX0VEUCwKIAl9OwogCi0JV0FSTl9PTihJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSk7
CisJV0FSTl9PTihJTlRFTF9HRU4oaTkxNSkgPCA5KTsKIAogCWlmIChXQVJOX09OKGNwdV90cmFu
c2NvZGVyID49IEFSUkFZX1NJWkUocmVncykgfHwKIAkJICAgICFyZWdzW2NwdV90cmFuc2NvZGVy
XS5yZWcpKQpAQCAtNjg0LDE5ICs2ODQsMTkgQEAgc3RhdGljIGk5MTVfcmVnX3QgZ2VuOV9jaGlj
a2VuX3RyYW5zX3JlZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMg
dm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
CQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwog
CWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2Nv
ZGVyOwogCXUzMiBtYXNrOwogCiAJLyogT25seSBIU1cgYW5kIEJEVyBoYXZlIFBTUiBBVVggcmVn
aXN0ZXJzIHRoYXQgbmVlZCB0byBiZSBzZXR1cC4gU0tMKwogCSAqIHVzZSBoYXJkY29kZWQgdmFs
dWVzIFBTUiBBVVggdHJhbnNhY3Rpb25zCiAJICovCi0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYp
IHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJaWYgKElTX0hBU1dFTEwoaTkxNSkgfHwgSVNf
QlJPQURXRUxMKGk5MTUpKQogCQloc3dfcHNyX3NldHVwX2F1eChpbnRlbF9kcCk7CiAKLQlpZiAo
ZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgJiYgKElTX0dFTihkZXZfcHJpdiwgOSkgJiYKLQkJ
CQkJICAgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSkgewotCQlpOTE1X3JlZ190IHJlZyA9IGdl
bjlfY2hpY2tlbl90cmFuc19yZWcoZGV2X3ByaXYsCisJaWYgKGk5MTUtPnBzci5wc3IyX2VuYWJs
ZWQgJiYgKElTX0dFTihpOTE1LCA5KSAmJgorCQkJCQkgICAhSVNfR0VNSU5JTEFLRShpOTE1KSkp
IHsKKwkJaTkxNV9yZWdfdCByZWcgPSBnZW45X2NoaWNrZW5fdHJhbnNfcmVnKGk5MTUsCiAJCQkJ
CQkJY3B1X3RyYW5zY29kZXIpOwogCQl1MzIgY2hpY2tlbiA9IEk5MTVfUkVBRChyZWcpOwogCkBA
IC03MTYsMjkgKzcxNiwyOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCSAgICAgICBFRFBfUFNSX0RFQlVHX01BU0tfTFBT
UCB8CiAJICAgICAgIEVEUF9QU1JfREVCVUdfTUFTS19NQVhfU0xFRVA7CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA8IDExKQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPCAxMSkKIAkJbWFzayB8
PSBFRFBfUFNSX0RFQlVHX01BU0tfRElTUF9SRUdfV1JJVEU7CiAKIAlJOTE1X1dSSVRFKEVEUF9Q
U1JfREVCVUcsIG1hc2spOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX2xvY2tl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRlbF9w
c3JfZW5hYmxlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCA9IGRldl9wcml2LT5wc3IuZHA7CisJc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCA9IGk5MTUtPnBzci5kcDsKIAotCVdBUk5fT04oZGV2X3ByaXYtPnBzci5lbmFibGVk
KTsKKwlXQVJOX09OKGk5MTUtPnBzci5lbmFibGVkKTsKIAotCWRldl9wcml2LT5wc3IucHNyMl9l
bmFibGVkID0gaW50ZWxfcHNyMl9lbmFibGVkKGRldl9wcml2LCBjcnRjX3N0YXRlKTsKLQlkZXZf
cHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyA9IDA7Ci0JZGV2X3ByaXYtPnBzci5waXBl
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpLT5waXBlOworCWk5MTUtPnBz
ci5wc3IyX2VuYWJsZWQgPSBpbnRlbF9wc3IyX2VuYWJsZWQoaTkxNSwgY3J0Y19zdGF0ZSk7CisJ
aTkxNS0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyA9IDA7CisJaTkxNS0+cHNyLnBpcGUgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0YyktPnBpcGU7CiAKIAlEUk1fREVCVUdf
S01TKCJFbmFibGluZyBQU1Ilc1xuIiwKLQkJICAgICAgZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJs
ZWQgPyAiMiIgOiAiMSIpOworCQkgICAgICBpOTE1LT5wc3IucHNyMl9lbmFibGVkID8gIjIiIDog
IjEiKTsKIAlpbnRlbF9wc3Jfc2V0dXBfdnNjKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKIAlpbnRl
bF9wc3JfZW5hYmxlX3NpbmsoaW50ZWxfZHApOwogCWludGVsX3Bzcl9lbmFibGVfc291cmNlKGlu
dGVsX2RwLCBjcnRjX3N0YXRlKTsKLQlkZXZfcHJpdi0+cHNyLmVuYWJsZWQgPSB0cnVlOworCWk5
MTUtPnBzci5lbmFibGVkID0gdHJ1ZTsKIAogCWludGVsX3Bzcl9hY3RpdmF0ZShpbnRlbF9kcCk7
CiB9CkBAIC03NTMsNDEgKzc1Myw0MSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX2xv
Y2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB2b2lkIGludGVsX3Bzcl9l
bmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAgICAgY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAogCWlmICghY3J0Y19zdGF0ZS0+aGFz
X3BzcikKIAkJcmV0dXJuOwogCi0JaWYgKFdBUk5fT04oIUNBTl9QU1IoZGV2X3ByaXYpKSkKKwlp
ZiAoV0FSTl9PTighQ0FOX1BTUihpOTE1KSkpCiAJCXJldHVybjsKIAotCVdBUk5fT04oZGV2X3By
aXYtPmRycnMuZHApOworCVdBUk5fT04oaTkxNS0+ZHJycy5kcCk7CiAKLQltdXRleF9sb2NrKCZk
ZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmk5MTUtPnBzci5sb2NrKTsKIAotCWlm
ICghcHNyX2dsb2JhbF9lbmFibGVkKGRldl9wcml2LT5wc3IuZGVidWcpKSB7CisJaWYgKCFwc3Jf
Z2xvYmFsX2VuYWJsZWQoaTkxNS0+cHNyLmRlYnVnKSkgewogCQlEUk1fREVCVUdfS01TKCJQU1Ig
ZGlzYWJsZWQgYnkgZmxhZ1xuIik7CiAJCWdvdG8gdW5sb2NrOwogCX0KIAotCWludGVsX3Bzcl9l
bmFibGVfbG9ja2VkKGRldl9wcml2LCBjcnRjX3N0YXRlKTsKKwlpbnRlbF9wc3JfZW5hYmxlX2xv
Y2tlZChpOTE1LCBjcnRjX3N0YXRlKTsKIAogdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmk5MTUtPnBzci5sb2NrKTsKIH0KIAotc3Rh
dGljIHZvaWQgaW50ZWxfcHNyX2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQorc3RhdGljIHZvaWQgaW50ZWxfcHNyX2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7CiAJdTMyIHZhbDsKIAotCWlmICghZGV2X3ByaXYtPnBzci5hY3RpdmUpIHsKLQkJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwlpZiAoIWk5MTUtPnBzci5hY3RpdmUpIHsKKwkJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KQogCQkJV0FSTl9PTihJOTE1X1JFQUQoRURQX1BTUjJf
Q1RMKSAmIEVEUF9QU1IyX0VOQUJMRSk7CiAJCVdBUk5fT04oSTkxNV9SRUFEKEVEUF9QU1JfQ1RM
KSAmIEVEUF9QU1JfRU5BQkxFKTsKIAkJcmV0dXJuOwogCX0KIAotCWlmIChkZXZfcHJpdi0+cHNy
LnBzcjJfZW5hYmxlZCkgeworCWlmIChpOTE1LT5wc3IucHNyMl9lbmFibGVkKSB7CiAJCXZhbCA9
IEk5MTVfUkVBRChFRFBfUFNSMl9DVEwpOwogCQlXQVJOX09OKCEodmFsICYgRURQX1BTUjJfRU5B
QkxFKSk7CiAJCUk5MTVfV1JJVEUoRURQX1BTUjJfQ1RMLCB2YWwgJiB+RURQX1BTUjJfRU5BQkxF
KTsKQEAgLTc5NiwyNiArNzk2LDI2IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9leGl0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJV0FSTl9PTighKHZhbCAmIEVEUF9QU1Jf
RU5BQkxFKSk7CiAJCUk5MTVfV1JJVEUoRURQX1BTUl9DVEwsIHZhbCAmIH5FRFBfUFNSX0VOQUJM
RSk7CiAJfQotCWRldl9wcml2LT5wc3IuYWN0aXZlID0gZmFsc2U7CisJaTkxNS0+cHNyLmFjdGl2
ZSA9IGZhbHNlOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWk5MTVfcmVnX3QgcHNyX3N0YXR1czsKIAl1
MzIgcHNyX3N0YXR1c19tYXNrOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBz
ci5sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5wc3IubG9jayk7CiAKLQlpZiAo
IWRldl9wcml2LT5wc3IuZW5hYmxlZCkKKwlpZiAoIWk5MTUtPnBzci5lbmFibGVkKQogCQlyZXR1
cm47CiAKIAlEUk1fREVCVUdfS01TKCJEaXNhYmxpbmcgUFNSJXNcbiIsCi0JCSAgICAgIGRldl9w
cml2LT5wc3IucHNyMl9lbmFibGVkID8gIjIiIDogIjEiKTsKKwkJICAgICAgaTkxNS0+cHNyLnBz
cjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CiAKLQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7CisJ
aW50ZWxfcHNyX2V4aXQoaTkxNSk7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQp
IHsKKwlpZiAoaTkxNS0+cHNyLnBzcjJfZW5hYmxlZCkgewogCQlwc3Jfc3RhdHVzID0gRURQX1BT
UjJfU1RBVFVTOwogCQlwc3Jfc3RhdHVzX21hc2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfTUFT
SzsKIAl9IGVsc2UgewpAQCAtODI0LDE0ICs4MjQsMTQgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNy
X2Rpc2FibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJfQogCiAJLyogV2Fp
dCB0aWxsIFBTUiBpcyBpZGxlICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZf
cHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3Jl
LAogCQkJCSAgICBwc3Jfc3RhdHVzLCBwc3Jfc3RhdHVzX21hc2ssIDAsIDIwMDApKQogCQlEUk1f
RVJST1IoIlRpbWVkIG91dCB3YWl0aW5nIFBTUiBpZGxlIHN0YXRlXG4iKTsKIAogCS8qIERpc2Fi
bGUgUFNSIG9uIFNpbmsgKi8KIAlkcm1fZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsIERQ
X1BTUl9FTl9DRkcsIDApOwogCi0JZGV2X3ByaXYtPnBzci5lbmFibGVkID0gZmFsc2U7CisJaTkx
NS0+cHNyLmVuYWJsZWQgPSBmYWxzZTsKIH0KIAogLyoqCkBAIC04NDQsMjMgKzg0NCwyMyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCkKIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IAkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVs
X2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxf
ZHApOwogCiAJaWYgKCFvbGRfY3J0Y19zdGF0ZS0+aGFzX3BzcikKIAkJcmV0dXJuOwogCi0JaWYg
KFdBUk5fT04oIUNBTl9QU1IoZGV2X3ByaXYpKSkKKwlpZiAoV0FSTl9PTighQ0FOX1BTUihpOTE1
KSkpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0
ZXhfbG9jaygmaTkxNS0+cHNyLmxvY2spOwogCiAJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKGlu
dGVsX2RwKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQljYW5jZWxf
d29ya19zeW5jKCZkZXZfcHJpdi0+cHNyLndvcmspOworCW11dGV4X3VubG9jaygmaTkxNS0+cHNy
LmxvY2spOworCWNhbmNlbF93b3JrX3N5bmMoJmk5MTUtPnBzci53b3JrKTsKIH0KIAotc3RhdGlj
IHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyoKIAkgKiBEaXNwbGF5IFdBICMwODg0OiBh
bGwKQEAgLTg3MSw3ICs4NzEsNyBAQCBzdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdf
ZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogYnV0IGl0IG1ha2Vz
IG1vcmUgc2Vuc2Ugd3JpdGUgdG8gdGhlIGN1cnJlbnQgYWN0aXZlCiAJICogcGlwZS4KIAkgKi8K
LQlJOTE1X1dSSVRFKENVUlNVUkZMSVZFKGRldl9wcml2LT5wc3IucGlwZSksIDApOworCUk5MTVf
V1JJVEUoQ1VSU1VSRkxJVkUoaTkxNS0+cHNyLnBpcGUpLCAwKTsKIH0KIAogLyoqCkBAIC04ODYs
MjIgKzg4NiwyMiBAQCBzdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3By
aXYtPnBzcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50
ZWxfZHApOworCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmk5MTUtPnBzcjsKIAlib29sIGVuYWJs
ZSwgcHNyMl9lbmFibGU7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpIHx8IFJFQURfT05DRShw
c3ItPmRwKSAhPSBpbnRlbF9kcCkKKwlpZiAoIUNBTl9QU1IoaTkxNSkgfHwgUkVBRF9PTkNFKHBz
ci0+ZHApICE9IGludGVsX2RwKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+
cHNyLmxvY2spOworCW11dGV4X2xvY2soJmk5MTUtPnBzci5sb2NrKTsKIAogCWVuYWJsZSA9IGNy
dGNfc3RhdGUtPmhhc19wc3IgJiYgcHNyX2dsb2JhbF9lbmFibGVkKHBzci0+ZGVidWcpOwotCXBz
cjJfZW5hYmxlID0gaW50ZWxfcHNyMl9lbmFibGVkKGRldl9wcml2LCBjcnRjX3N0YXRlKTsKKwlw
c3IyX2VuYWJsZSA9IGludGVsX3BzcjJfZW5hYmxlZChpOTE1LCBjcnRjX3N0YXRlKTsKIAogCWlm
IChlbmFibGUgPT0gcHNyLT5lbmFibGVkICYmIHBzcjJfZW5hYmxlID09IHBzci0+cHNyMl9lbmFi
bGVkKSB7CiAJCS8qIEZvcmNlIGEgUFNSIGV4aXQgd2hlbiBlbmFibGluZyBDUkMgdG8gYXZvaWQg
Q1JDIHRpbWVvdXRzICovCiAJCWlmIChjcnRjX3N0YXRlLT5jcmNfZW5hYmxlZCAmJiBwc3ItPmVu
YWJsZWQpCi0JCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChkZXZfcHJpdik7CisJCQlwc3Jf
Zm9yY2VfaHdfdHJhY2tpbmdfZXhpdChpOTE1KTsKIAogCQlnb3RvIHVubG9jazsKIAl9CkBAIC05
MTAsMTAgKzkxMCwxMCBAQCB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKIAkJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAogCWlmIChl
bmFibGUpCi0JCWludGVsX3Bzcl9lbmFibGVfbG9ja2VkKGRldl9wcml2LCBjcnRjX3N0YXRlKTsK
KwkJaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoaTkxNSwgY3J0Y19zdGF0ZSk7CiAKIHVubG9jazoK
LQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5wc3IubG9jayk7CiB9CiAKIC8qKgpAQCAtOTMwLDEzICs5MzAsMTMgQEAgaW50IGludGVsX3Bz
cl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19z
dGF0ZSwKIAkJCSAgICB1MzIgKm91dF92YWx1ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAot
CWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkIHx8ICFuZXdfY3J0Y19zdGF0ZS0+aGFzX3BzcikK
KwlpZiAoIWk5MTUtPnBzci5lbmFibGVkIHx8ICFuZXdfY3J0Y19zdGF0ZS0+aGFzX3BzcikKIAkJ
cmV0dXJuIDA7CiAKIAkvKiBGSVhNRTogVXBkYXRlIHRoaXMgZm9yIFBTUjIgaWYgd2UgbmVlZCB0
byB3YWl0IGZvciBpZGxlICovCi0JaWYgKFJFQURfT05DRShkZXZfcHJpdi0+cHNyLnBzcjJfZW5h
YmxlZCkpCisJaWYgKFJFQURfT05DRShpOTE1LT5wc3IucHNyMl9lbmFibGVkKSkKIAkJcmV0dXJu
IDA7CiAKIAkvKgpAQCAtOTQ2LDIyICs5NDYsMjIgQEAgaW50IGludGVsX3Bzcl93YWl0X2Zvcl9p
ZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwKIAkgKiBk
ZWZlbnNpdmUgZW5vdWdoIHRvIGNvdmVyIGV2ZXJ5dGhpbmcuCiAJICovCiAKLQlyZXR1cm4gX19p
bnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgRURQX1BTUl9TVEFUVVMs
CisJcmV0dXJuIF9faW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwgRURQX1BT
Ul9TVEFUVVMsCiAJCQkJCSBFRFBfUFNSX1NUQVRVU19TVEFURV9NQVNLLAogCQkJCQkgRURQX1BT
Ul9TVEFUVVNfU1RBVEVfSURMRSwgMiwgNTAsCiAJCQkJCSBvdXRfdmFsdWUpOwogfQogCi1zdGF0
aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpOTE1X3JlZ190IHJlZzsKIAl1MzIgbWFz
azsKIAlpbnQgZXJyOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCisJaWYgKCFpOTE1
LT5wc3IuZW5hYmxlZCkKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNy
Ml9lbmFibGVkKSB7CisJaWYgKGk5MTUtPnBzci5wc3IyX2VuYWJsZWQpIHsKIAkJcmVnID0gRURQ
X1BTUjJfU1RBVFVTOwogCQltYXNrID0gRURQX1BTUjJfU1RBVFVTX1NUQVRFX01BU0s7CiAJfSBl
bHNlIHsKQEAgLTk2OSwyMCArOTY5LDIwIEBAIHN0YXRpYyBib29sIF9fcHNyX3dhaXRfZm9yX2lk
bGVfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJbWFzayA9IEVE
UF9QU1JfU1RBVFVTX1NUQVRFX01BU0s7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaTkxNS0+cHNyLmxvY2spOwogCi0JZXJyID0gaW50
ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsIHJlZywgbWFzaywgMCwgNTAp
OworCWVyciA9IGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsIHJlZywgbWFz
aywgMCwgNTApOwogCWlmIChlcnIpCiAJCURSTV9FUlJPUigiVGltZWQgb3V0IHdhaXRpbmcgZm9y
IFBTUiBJZGxlIGZvciByZS1lbmFibGVcbiIpOwogCiAJLyogQWZ0ZXIgdGhlIHVubG9ja2VkIHdh
aXQsIHZlcmlmeSB0aGF0IFBTUiBpcyBzdGlsbCB3YW50ZWQhICovCi0JbXV0ZXhfbG9jaygmZGV2
X3ByaXYtPnBzci5sb2NrKTsKLQlyZXR1cm4gZXJyID09IDAgJiYgZGV2X3ByaXYtPnBzci5lbmFi
bGVkOworCW11dGV4X2xvY2soJmk5MTUtPnBzci5sb2NrKTsKKwlyZXR1cm4gZXJyID09IDAgJiYg
aTkxNS0+cHNyLmVuYWJsZWQ7CiB9CiAKLXN0YXRpYyBpbnQgaW50ZWxfcHNyX2Zhc3RzZXRfZm9y
Y2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCBpbnRlbF9w
c3JfZmFzdHNldF9mb3JjZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9ICZpOTE1LT5kcm07CiAJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4IGN0eDsK
IAlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGU7CiAJc3RydWN0IGRybV9jcnRjICpjcnRj
OwpAQCAtMTAzMiw3ICsxMDMyLDcgQEAgc3RhdGljIGludCBpbnRlbF9wc3JfZmFzdHNldF9mb3Jj
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIGVycjsKIH0KIAot
aW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCB1NjQgdmFsKQoraW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIHU2NCB2YWwpCiB7CiAJY29uc3QgdTMyIG1vZGUgPSB2YWwgJiBJOTE1X1BTUl9E
RUJVR19NT0RFX01BU0s7CiAJdTMyIG9sZF9tb2RlOwpAQCAtMTA0NCwyNSArMTA0NCwyNSBAQCBp
bnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IHU2NCB2YWwpCiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCXJldCA9IG11dGV4X2xvY2tfaW50
ZXJydXB0aWJsZSgmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmk5MTUtPnBzci5sb2NrKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0J
b2xkX21vZGUgPSBkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNL
OwotCWRldl9wcml2LT5wc3IuZGVidWcgPSB2YWw7Ci0JaW50ZWxfcHNyX2lycV9jb250cm9sKGRl
dl9wcml2LCBkZXZfcHJpdi0+cHNyLmRlYnVnKTsKKwlvbGRfbW9kZSA9IGk5MTUtPnBzci5kZWJ1
ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSzsKKwlpOTE1LT5wc3IuZGVidWcgPSB2YWw7CisJ
aW50ZWxfcHNyX2lycV9jb250cm9sKGk5MTUsIGk5MTUtPnBzci5kZWJ1Zyk7CiAKLQltdXRleF91
bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wc3IubG9j
ayk7CiAKIAlpZiAob2xkX21vZGUgIT0gbW9kZSkKLQkJcmV0ID0gaW50ZWxfcHNyX2Zhc3RzZXRf
Zm9yY2UoZGV2X3ByaXYpOworCQlyZXQgPSBpbnRlbF9wc3JfZmFzdHNldF9mb3JjZShpOTE1KTsK
IAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3Bzcl9oYW5kbGVfaXJxKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX3Bzcl9o
YW5kbGVfaXJxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1
X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmaTkx
NS0+cHNyOwogCiAJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKHBzci0+ZHApOwogCXBzci0+c2lu
a19ub3RfcmVsaWFibGUgPSB0cnVlOwpAQCAtMTA3MiwxNiArMTA3MiwxNiBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9wc3JfaGFuZGxlX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAKIHN0YXRpYyB2b2lkIGludGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yo
d29yaywgdHlwZW9mKCpkZXZfcHJpdiksIHBzci53b3JrKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9CisJCWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBwc3Iud29y
ayk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmk5
MTUtPnBzci5sb2NrKTsKIAotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKQorCWlmICghaTkx
NS0+cHNyLmVuYWJsZWQpCiAJCWdvdG8gdW5sb2NrOwogCi0JaWYgKFJFQURfT05DRShkZXZfcHJp
di0+cHNyLmlycV9hdXhfZXJyb3IpKQotCQlpbnRlbF9wc3JfaGFuZGxlX2lycShkZXZfcHJpdik7
CisJaWYgKFJFQURfT05DRShpOTE1LT5wc3IuaXJxX2F1eF9lcnJvcikpCisJCWludGVsX3Bzcl9o
YW5kbGVfaXJxKGk5MTUpOwogCiAJLyoKIAkgKiBXZSBoYXZlIHRvIG1ha2Ugc3VyZSBQU1IgaXMg
cmVhZHkgZm9yIHJlLWVuYWJsZQpAQCAtMTA4OSw3ICsxMDg5LDcgQEAgc3RhdGljIHZvaWQgaW50
ZWxfcHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCSAqIFBTUiBtaWdodCB0YWtl
IHNvbWUgdGltZSB0byBnZXQgZnVsbHkgZGlzYWJsZWQKIAkgKiBhbmQgYmUgcmVhZHkgZm9yIHJl
LWVuYWJsZS4KIAkgKi8KLQlpZiAoIV9fcHNyX3dhaXRfZm9yX2lkbGVfbG9ja2VkKGRldl9wcml2
KSkKKwlpZiAoIV9fcHNyX3dhaXRfZm9yX2lkbGVfbG9ja2VkKGk5MTUpKQogCQlnb3RvIHVubG9j
azsKIAogCS8qCkBAIC0xMDk3LDE3ICsxMDk3LDE3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl93
b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiByZWNoZWNrLiBTaW5jZSBwc3JfZmx1
c2ggZmlyc3QgY2xlYXJzIHRoaXMgYW5kIHRoZW4gcmVzY2hlZHVsZXMgd2UKIAkgKiB3b24ndCBl
dmVyIG1pc3MgYSBmbHVzaCB3aGVuIGJhaWxpbmcgb3V0IGhlcmUuCiAJICovCi0JaWYgKGRldl9w
cml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHx8IGRldl9wcml2LT5wc3IuYWN0aXZlKQor
CWlmIChpOTE1LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHx8IGk5MTUtPnBzci5hY3RpdmUp
CiAJCWdvdG8gdW5sb2NrOwogCi0JaW50ZWxfcHNyX2FjdGl2YXRlKGRldl9wcml2LT5wc3IuZHAp
OworCWludGVsX3Bzcl9hY3RpdmF0ZShpOTE1LT5wc3IuZHApOwogdW5sb2NrOgotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmk5MTUtPnBzci5sb2Nr
KTsKIH0KIAogLyoqCiAgKiBpbnRlbF9wc3JfaW52YWxpZGF0ZSAtIEludmFsaWRhZGUgUFNSCi0g
KiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UKICAqIEBmcm9u
dGJ1ZmZlcl9iaXRzOiBmcm9udGJ1ZmZlciBwbGFuZSB0cmFja2luZyBiaXRzCiAgKiBAb3JpZ2lu
OiB3aGljaCBvcGVyYXRpb24gY2F1c2VkIHRoZSBpbnZhbGlkYXRlCiAgKgpAQCAtMTExOCwzMyAr
MTExOCwzMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3Qg
KndvcmspCiAgKgogICogRGlydHkgZnJvbnRidWZmZXJzIHJlbGV2YW50IHRvIFBTUiBhcmUgdHJh
Y2tlZCBpbiBidXN5X2Zyb250YnVmZmVyX2JpdHMuIgogICovCi12b2lkIGludGVsX3Bzcl9pbnZh
bGlkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfcHNy
X2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHVuc2lnbmVk
IGZyb250YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQlpZiAoIUNB
Tl9QU1IoZGV2X3ByaXYpKQorCWlmICghQ0FOX1BTUihpOTE1KSkKIAkJcmV0dXJuOwogCiAJaWYg
KG9yaWdpbiA9PSBPUklHSU5fRkxJUCkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3By
aXYtPnBzci5sb2NrKTsKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCkgewotCQltdXRleF91
bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaTkxNS0+cHNyLmxvY2sp
OworCWlmICghaTkxNS0+cHNyLmVuYWJsZWQpIHsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wc3Iu
bG9jayk7CiAJCXJldHVybjsKIAl9CiAKLQlmcm9udGJ1ZmZlcl9iaXRzICY9IElOVEVMX0ZST05U
QlVGRkVSX0FMTF9NQVNLKGRldl9wcml2LT5wc3IucGlwZSk7Ci0JZGV2X3ByaXYtPnBzci5idXN5
X2Zyb250YnVmZmVyX2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKKwlmcm9udGJ1ZmZlcl9iaXRz
ICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGk5MTUtPnBzci5waXBlKTsKKwlpOTE1LT5w
c3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHw9IGZyb250YnVmZmVyX2JpdHM7CiAKIAlpZiAoZnJv
bnRidWZmZXJfYml0cykKLQkJaW50ZWxfcHNyX2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9wc3Jf
ZXhpdChpOTE1KTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRl
eF91bmxvY2soJmk5MTUtPnBzci5sb2NrKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9wc3JfZmx1c2gg
LSBGbHVzaCBQU1IKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRl
dmljZQogICogQGZyb250YnVmZmVyX2JpdHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJp
dHMKICAqIEBvcmlnaW46IHdoaWNoIG9wZXJhdGlvbiBjYXVzZWQgdGhlIGZsdXNoCiAgKgpAQCAt
MTE1NSw1NSArMTE1NSw1NSBAQCB2b2lkIGludGVsX3Bzcl9pbnZhbGlkYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqCiAgKiBEaXJ0eSBmcm9udGJ1ZmZlcnMgcmVsZXZh
bnQgdG8gUFNSIGFyZSB0cmFja2VkIGluIGJ1c3lfZnJvbnRidWZmZXJfYml0cy4KICAqLwotdm9p
ZCBpbnRlbF9wc3JfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9p
ZCBpbnRlbF9wc3JfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAg
dW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewot
CWlmICghQ0FOX1BTUihkZXZfcHJpdikpCisJaWYgKCFDQU5fUFNSKGk5MTUpKQogCQlyZXR1cm47
CiAKIAlpZiAob3JpZ2luID09IE9SSUdJTl9GTElQKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKSB7Ci0J
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpOTE1LT5w
c3IubG9jayk7CisJaWYgKCFpOTE1LT5wc3IuZW5hYmxlZCkgeworCQltdXRleF91bmxvY2soJmk5
MTUtPnBzci5sb2NrKTsKIAkJcmV0dXJuOwogCX0KIAotCWZyb250YnVmZmVyX2JpdHMgJj0gSU5U
RUxfRlJPTlRCVUZGRVJfQUxMX01BU0soZGV2X3ByaXYtPnBzci5waXBlKTsKLQlkZXZfcHJpdi0+
cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKKwlmcm9udGJ1
ZmZlcl9iaXRzICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGk5MTUtPnBzci5waXBlKTsK
KwlpOTE1LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwog
CiAJLyogQnkgZGVmaW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUgKyBmbHVzaCAqLwogCWlmIChm
cm9udGJ1ZmZlcl9iaXRzKQotCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChkZXZfcHJpdik7
CisJCXBzcl9mb3JjZV9od190cmFja2luZ19leGl0KGk5MTUpOwogCi0JaWYgKCFkZXZfcHJpdi0+
cHNyLmFjdGl2ZSAmJiAhZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMpCi0JCXNj
aGVkdWxlX3dvcmsoJmRldl9wcml2LT5wc3Iud29yayk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+cHNyLmxvY2spOworCWlmICghaTkxNS0+cHNyLmFjdGl2ZSAmJiAhaTkxNS0+cHNyLmJ1c3lf
ZnJvbnRidWZmZXJfYml0cykKKwkJc2NoZWR1bGVfd29yaygmaTkxNS0+cHNyLndvcmspOworCW11
dGV4X3VubG9jaygmaTkxNS0+cHNyLmxvY2spOwogfQogCiAvKioKICAqIGludGVsX3Bzcl9pbml0
IC0gSW5pdCBiYXNpYyBQU1Igd29yayBhbmQgbXV0ZXguCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2
aWNlIHByaXZhdGUKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBwcml2YXRlCiAgKgogICogVGhpcyBm
dW5jdGlvbiBpcyAgY2FsbGVkIG9ubHkgb25jZSBhdCBkcml2ZXIgbG9hZCB0byBpbml0aWFsaXpl
IGJhc2ljCiAgKiBQU1Igc3R1ZmYuCiAgKi8KLXZvaWQgaW50ZWxfcHNyX2luaXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAl1MzIgdmFsOwogCi0JaWYgKCFIQVNfUFNSKGRldl9w
cml2KSkKKwlpZiAoIUhBU19QU1IoaTkxNSkpCiAJCXJldHVybjsKIAotCWRldl9wcml2LT5wc3Jf
bW1pb19iYXNlID0gSVNfSEFTV0VMTChkZXZfcHJpdikgPworCWk5MTUtPnBzcl9tbWlvX2Jhc2Ug
PSBJU19IQVNXRUxMKGk5MTUpID8KIAkJSFNXX0VEUF9QU1JfQkFTRSA6IEJEV19FRFBfUFNSX0JB
U0U7CiAKLQlpZiAoIWRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0KQorCWlmICghaTkxNS0+cHNy
LnNpbmtfc3VwcG9ydCkKIAkJcmV0dXJuOwogCiAJaWYgKGk5MTVfbW9kcGFyYW1zLmVuYWJsZV9w
c3IgPT0gLTEpCi0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSB8fCAhZGV2X3ByaXYtPnZi
dC5wc3IuZW5hYmxlKQorCQlpZiAoSU5URUxfR0VOKGk5MTUpIDwgOSB8fCAhaTkxNS0+dmJ0LnBz
ci5lbmFibGUpCiAJCQlpOTE1X21vZHBhcmFtcy5lbmFibGVfcHNyID0gMDsKIAogCS8qCkBAIC0x
MjE4LDMxICsxMjE4LDMxIEBAIHZvaWQgaW50ZWxfcHNyX2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCXZhbCAmPSBFRFBfUFNSX0VSUk9SKGVkcF9wc3Jfc2hpZnQoVFJB
TlNDT0RFUl9FRFApKTsKIAlpZiAodmFsKSB7CiAJCURSTV9ERUJVR19LTVMoIlBTUiBpbnRlcnJ1
cHRpb24gZXJyb3Igc2V0XG4iKTsKLQkJZGV2X3ByaXYtPnBzci5zaW5rX25vdF9yZWxpYWJsZSA9
IHRydWU7CisJCWk5MTUtPnBzci5zaW5rX25vdF9yZWxpYWJsZSA9IHRydWU7CiAJfQogCiAJLyog
U2V0IGxpbmtfc3RhbmRieSB4IGxpbmtfb2ZmIGRlZmF1bHRzICovCi0JaWYgKElTX0hBU1dFTEwo
ZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCisJaWYgKElTX0hBU1dFTEwoaTkx
NSkgfHwgSVNfQlJPQURXRUxMKGk5MTUpKQogCQkvKiBIU1cgYW5kIEJEVyByZXF1aXJlIHdvcmth
cm91bmRzIHRoYXQgd2UgZG9uJ3QgaW1wbGVtZW50LiAqLwotCQlkZXZfcHJpdi0+cHNyLmxpbmtf
c3RhbmRieSA9IGZhbHNlOworCQlpOTE1LT5wc3IubGlua19zdGFuZGJ5ID0gZmFsc2U7CiAJZWxz
ZQogCQkvKiBGb3IgbmV3IHBsYXRmb3JtcyBsZXQncyByZXNwZWN0IFZCVCBiYWNrIGFnYWluICov
Ci0JCWRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5ID0gZGV2X3ByaXYtPnZidC5wc3IuZnVsbF9s
aW5rOworCQlpOTE1LT5wc3IubGlua19zdGFuZGJ5ID0gaTkxNS0+dmJ0LnBzci5mdWxsX2xpbms7
CiAKLQlJTklUX1dPUksoJmRldl9wcml2LT5wc3Iud29yaywgaW50ZWxfcHNyX3dvcmspOwotCW11
dGV4X2luaXQoJmRldl9wcml2LT5wc3IubG9jayk7CisJSU5JVF9XT1JLKCZpOTE1LT5wc3Iud29y
aywgaW50ZWxfcHNyX3dvcmspOworCW11dGV4X2luaXQoJmk5MTUtPnBzci5sb2NrKTsKIH0KIAog
dm9pZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2Rw
KTsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGk5MTVf
cHNyICpwc3IgPSAmaTkxNS0+cHNyOwogCXU4IHZhbDsKIAljb25zdCB1OCBlcnJvcnMgPSBEUF9Q
U1JfUkZCX1NUT1JBR0VfRVJST1IgfAogCQkJICBEUF9QU1JfVlNDX1NEUF9VTkNPUlJFQ1RBQkxF
X0VSUk9SIHwKIAkJCSAgRFBfUFNSX0xJTktfQ1JDX0VSUk9SOwogCi0JaWYgKCFDQU5fUFNSKGRl
dl9wcml2KSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKKwlpZiAoIUNBTl9QU1IoaTkx
NSkgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCiAJCXJldHVybjsKIAogCW11dGV4X2xv
Y2soJnBzci0+bG9jayk7CkBAIC0xMjg4LDE1ICsxMjg4LDE1IEBAIHZvaWQgaW50ZWxfcHNyX3No
b3J0X3B1bHNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIGJvb2wgaW50ZWxfcHNyX2Vu
YWJsZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWJvb2wgcmV0OwogCi0JaWYg
KCFDQU5fUFNSKGRldl9wcml2KSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKKwlpZiAo
IUNBTl9QU1IoaTkxNSkgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCiAJCXJldHVybiBm
YWxzZTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7Ci0JcmV0ID0gKGRldl9w
cml2LT5wc3IuZHAgPT0gaW50ZWxfZHAgJiYgZGV2X3ByaXYtPnBzci5lbmFibGVkKTsKLQltdXRl
eF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaTkxNS0+cHNyLmxv
Y2spOworCXJldCA9IChpOTE1LT5wc3IuZHAgPT0gaW50ZWxfZHAgJiYgaTkxNS0+cHNyLmVuYWJs
ZWQpOworCW11dGV4X3VubG9jaygmaTkxNS0+cHNyLmxvY2spOwogCiAJcmV0dXJuIHJldDsKIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Bzci5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfcHNyLmgKaW5kZXggZGM4MTg4MjZmMzZkLi44YTNkZGM0YWU0NGQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Bzci5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3Bzci5oCkBAIC0xMiw3ICsxMiw3IEBAIHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlOwogc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfZHA7
CiAKLSNkZWZpbmUgQ0FOX1BTUihkZXZfcHJpdikgKEhBU19QU1IoZGV2X3ByaXYpICYmIGRldl9w
cml2LT5wc3Iuc2lua19zdXBwb3J0KQorI2RlZmluZSBDQU5fUFNSKGk5MTUpIChIQVNfUFNSKGk5
MTUpICYmIGk5MTUtPnBzci5zaW5rX3N1cHBvcnQpCiB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7CiB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpOwpAQCAtMjAsMTggKzIwLDE4IEBAIHZvaWQgaW50ZWxfcHNyX2Rpc2Fi
bGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSk7CiB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpOwotaW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCB1NjQgdmFsdWUpOwotdm9pZCBpbnRlbF9wc3JfaW52YWxp
ZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnQgaW50ZWxfcHNyX2Rl
YnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTY0IHZhbHVlKTsKK3ZvaWQg
aW50ZWxfcHNyX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkg
IHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMsCiAJCQkgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdp
bik7Ci12b2lkIGludGVsX3Bzcl9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCit2b2lkIGludGVsX3Bzcl9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJICAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzLAogCQkgICAgIGVudW0gZmJfb3Bfb3Jp
Z2luIG9yaWdpbik7Ci12b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7Cit2b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7
Ci12b2lkIGludGVsX3Bzcl9pcnFfY29udHJvbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsIHUzMiBkZWJ1Zyk7Ci12b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKTsKK3ZvaWQgaW50ZWxfcHNyX2ly
cV9jb250cm9sKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgZGVidWcpOwordm9p
ZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUz
MiBwc3JfaWlyKTsKIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApOwogaW50IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwKIAkJCSAgICB1MzIgKm91dF92YWx1ZSk7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9xdWlya3MuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3F1aXJrcy5oCmluZGV4IGIwZmNmZjE0MmE1Ni4uYjYxN2NhMDQ3
Njk1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9xdWlya3MuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9xdWlya3MuaApAQCAtOCw2ICs4LDYgQEAKIAog
c3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CiAKLXZvaWQgaW50ZWxfaW5pdF9xdWlya3Moc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfaW5pdF9xdWlya3Moc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiAjZW5kaWYgLyogX19JTlRFTF9RVUlSS1Nf
SF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ydW50aW1lX3Bt
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ydW50aW1lX3BtLmgKaW5kZXggYTdhY2Nl
YjEzNDczLi4xMDQyZjFjMGIxMjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3J1bnRpbWVfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ydW50aW1l
X3BtLmgKQEAgLTIwLDEwICsyMCwxMCBAQCBlbnVtIGk5MTVfZHJtX3N1c3BlbmRfbW9kZSB7CiAJ
STkxNV9EUk1fU1VTUEVORF9ISUJFUk5BVEUsCiB9OwogCi12b2lkIGludGVsX3J1bnRpbWVfcG1f
aW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRl
bF9ydW50aW1lX3BtX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwot
dm9pZCBpbnRlbF9ydW50aW1lX3BtX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KTsKLXZvaWQgaW50ZWxfcnVudGltZV9wbV9jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX3J1bnRpbWVfcG1faW5pdF9lYXJseShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX3J1bnRpbWVfcG1fZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfcnVudGltZV9wbV9k
aXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfcnVudGlt
ZV9wbV9jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogaW50ZWxfd2Fr
ZXJlZl90IGludGVsX3J1bnRpbWVfcG1fZ2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KTsKIGludGVsX3dha2VyZWZfdCBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9pbl91c2Uoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfc2R2by5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc2R2by5jCmluZGV4
IDA4NjBhZTM2YmI4Ny4uYjkxNmM3OWQ2YjMxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9zZHZvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc2R2by5j
CkBAIC0yMTIsMTggKzIxMiwxOCBAQCBpbnRlbF9zZHZvX2NyZWF0ZV9lbmhhbmNlX3Byb3BlcnR5
KHN0cnVjdCBpbnRlbF9zZHZvICppbnRlbF9zZHZvLAogc3RhdGljIHZvaWQgaW50ZWxfc2R2b193
cml0ZV9zZHZveChzdHJ1Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2bywgdTMyIHZhbCkKIHsKIAlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50ZWxfc2R2by0+YmFzZS5iYXNlLmRldjsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJdTMyIGJ2YWwgPSB2YWwsIGN2
YWwgPSB2YWw7CiAJaW50IGk7CiAKLQlpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpIHsKKwlp
ZiAoSEFTX1BDSF9TUExJVChpOTE1KSkgewogCQlJOTE1X1dSSVRFKGludGVsX3Nkdm8tPnNkdm9f
cmVnLCB2YWwpOwogCQlQT1NUSU5HX1JFQUQoaW50ZWxfc2R2by0+c2R2b19yZWcpOwogCQkvKgog
CQkgKiBIVyB3b3JrYXJvdW5kLCBuZWVkIHRvIHdyaXRlIHRoaXMgdHdpY2UgZm9yIGlzc3VlCiAJ
CSAqIHRoYXQgbWF5IHJlc3VsdCBpbiBmaXJzdCB3cml0ZSBnZXR0aW5nIG1hc2tlZC4KIAkJICov
Ci0JCWlmIChIQVNfUENIX0lCWChkZXZfcHJpdikpIHsKKwkJaWYgKEhBU19QQ0hfSUJYKGk5MTUp
KSB7CiAJCQlJOTE1X1dSSVRFKGludGVsX3Nkdm8tPnNkdm9fcmVnLCB2YWwpOwogCQkJUE9TVElO
R19SRUFEKGludGVsX3Nkdm8tPnNkdm9fcmVnKTsKIAkJfQpAQCAtMTQwMCw3ICsxNDAwLDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfc2R2b19wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpp
bnRlbF9lbmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0
ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGludGVs
X2VuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoaW50ZWxfZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0
ZWRfbW9kZTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfc2R2b19jb25uZWN0b3Jfc3RhdGUgKnNkdm9f
c3RhdGUgPQpAQCAtMTQ4MSwxMyArMTQ4MSwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX3By
ZV9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAJCXJldHVybjsK
IAogCS8qIFNldCB0aGUgU0RWTyBjb250cm9sIHJlZ3MuICovCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gNCkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkgewogCQkvKiBUaGUgcmVh
bCBtb2RlIHBvbGFyaXR5IGlzIHNldCBieSB0aGUgU0RWTyBjb21tYW5kcywgdXNpbmcKIAkJICog
c3RydWN0IGludGVsX3Nkdm9fZHRkLiAqLwogCQlzZHZveCA9IFNEVk9fVlNZTkNfQUNUSVZFX0hJ
R0ggfCBTRFZPX0hTWU5DX0FDVElWRV9ISUdIOwotCQlpZiAoIUhBU19QQ0hfU1BMSVQoZGV2X3By
aXYpICYmIGNydGNfc3RhdGUtPmxpbWl0ZWRfY29sb3JfcmFuZ2UpCisJCWlmICghSEFTX1BDSF9T
UExJVChpOTE1KSAmJiBjcnRjX3N0YXRlLT5saW1pdGVkX2NvbG9yX3JhbmdlKQogCQkJc2R2b3gg
fD0gSERNSV9DT0xPUl9SQU5HRV8xNl8yMzU7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwg
NSkKKwkJaWYgKElOVEVMX0dFTihpOTE1KSA8IDUpCiAJCQlzZHZveCB8PSBTRFZPX0JPUkRFUl9F
TkFCTEU7CiAJfSBlbHNlIHsKIAkJc2R2b3ggPSBJOTE1X1JFQUQoaW50ZWxfc2R2by0+c2R2b19y
ZWcpOwpAQCAtMTQ5OCwxNSArMTQ5OCwxNSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX3ByZV9l
bmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAJCXNkdm94IHw9ICg5
IDw8IDE5KSB8IFNEVk9fQk9SREVSX0VOQUJMRTsKIAl9CiAKLQlpZiAoSEFTX1BDSF9DUFQoZGV2
X3ByaXYpKQorCWlmIChIQVNfUENIX0NQVChpOTE1KSkKIAkJc2R2b3ggfD0gU0RWT19QSVBFX1NF
TF9DUFQoY3J0Yy0+cGlwZSk7CiAJZWxzZQogCQlzZHZveCB8PSBTRFZPX1BJUEVfU0VMKGNydGMt
PnBpcGUpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkgeworCWlmIChJTlRFTF9H
RU4oaTkxNSkgPj0gNCkgewogCQkvKiBkb25lIGluIGNydGNfbW9kZV9zZXQgYXMgdGhlIGRwbGxf
bWQgcmVnIG11c3QgYmUgd3JpdHRlbiBlYXJseSAqLwotCX0gZWxzZSBpZiAoSVNfSTk0NUcoZGV2
X3ByaXYpIHx8IElTX0k5NDVHTShkZXZfcHJpdikgfHwKLQkJICAgSVNfRzMzKGRldl9wcml2KSB8
fCBJU19QSU5FVklFVyhkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKElTX0k5NDVHKGk5MTUpIHx8
IElTX0k5NDVHTShpOTE1KSB8fAorCQkgICBJU19HMzMoaTkxNSkgfHwgSVNfUElORVZJRVcoaTkx
NSkpIHsKIAkJLyogZG9uZSBpbiBjcnRjX21vZGVfc2V0IGFzIGl0IGxpdmVzIGluc2lkZSB0aGUg
ZHBsbCByZWdpc3RlciAqLwogCX0gZWxzZSB7CiAJCXNkdm94IHw9IChjcnRjX3N0YXRlLT5waXhl
bF9tdWx0aXBsaWVyIC0gMSkKQEAgLTE1MTQsNyArMTUxNCw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X3Nkdm9fcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlciwKIAl9
CiAKIAlpZiAoaW5wdXRfZHRkLnBhcnQyLnNkdm9fZmxhZ3MgJiBTRFZPX05FRURfVE9fU1RBTEwg
JiYKLQkgICAgSU5URUxfR0VOKGRldl9wcml2KSA8IDUpCisJICAgIElOVEVMX0dFTihpOTE1KSA8
IDUpCiAJCXNkdm94IHw9IFNEVk9fU1RBTExfU0VMRUNUOwogCWludGVsX3Nkdm9fd3JpdGVfc2R2
b3goaW50ZWxfc2R2bywgc2R2b3gpOwogfQpAQCAtMTUzMSw3ICsxNTMxLDcgQEAgc3RhdGljIGJv
b2wgaW50ZWxfc2R2b19jb25uZWN0b3JfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIAlyZXR1cm4gYWN0aXZlX291dHB1dHMgJiBpbnRlbF9zZHZvX2Nvbm5l
Y3Rvci0+b3V0cHV0X2ZsYWc7CiB9CiAKLWJvb2wgaW50ZWxfc2R2b19wb3J0X2VuYWJsZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorYm9vbCBpbnRlbF9zZHZvX3BvcnRfZW5h
YmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgaTkxNV9yZWdfdCBz
ZHZvX3JlZywgZW51bSBwaXBlICpwaXBlKQogewogCXUzMiB2YWw7CkBAIC0xNTM5LDkgKzE1Mzks
OSBAQCBib29sIGludGVsX3Nkdm9fcG9ydF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAl2YWwgPSBJOTE1X1JFQUQoc2R2b19yZWcpOwogCiAJLyogYXNzZXJ0cyB3
YW50IHRvIGtub3cgdGhlIHBpcGUgZXZlbiBpZiB0aGUgcG9ydCBpcyBkaXNhYmxlZCAqLwotCWlm
IChIQVNfUENIX0NQVChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfQ1BUKGk5MTUpKQogCQkqcGlw
ZSA9ICh2YWwgJiBTRFZPX1BJUEVfU0VMX01BU0tfQ1BUKSA+PiBTRFZPX1BJUEVfU0VMX1NISUZU
X0NQVDsKLQllbHNlIGlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKKwllbHNlIGlmIChJU19D
SEVSUllWSUVXKGk5MTUpKQogCQkqcGlwZSA9ICh2YWwgJiBTRFZPX1BJUEVfU0VMX01BU0tfQ0hW
KSA+PiBTRFZPX1BJUEVfU0VMX1NISUZUX0NIVjsKIAllbHNlCiAJCSpwaXBlID0gKHZhbCAmIFNE
Vk9fUElQRV9TRUxfTUFTSykgPj4gU0RWT19QSVBFX1NFTF9TSElGVDsKQEAgLTE1NTIsMTQgKzE1
NTIsMTQgQEAgYm9vbCBpbnRlbF9zZHZvX3BvcnRfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiBzdGF0aWMgYm9vbCBpbnRlbF9zZHZvX2dldF9od19zdGF0ZShzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICAgZW51bSBwaXBlICpwaXBlKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3Nkdm8gKmludGVsX3Nkdm8gPSB0b19zZHZvKGVu
Y29kZXIpOwogCXUxNiBhY3RpdmVfb3V0cHV0cyA9IDA7CiAJYm9vbCByZXQ7CiAKIAlpbnRlbF9z
ZHZvX2dldF9hY3RpdmVfb3V0cHV0cyhpbnRlbF9zZHZvLCAmYWN0aXZlX291dHB1dHMpOwogCi0J
cmV0ID0gaW50ZWxfc2R2b19wb3J0X2VuYWJsZWQoZGV2X3ByaXYsIGludGVsX3Nkdm8tPnNkdm9f
cmVnLCBwaXBlKTsKKwlyZXQgPSBpbnRlbF9zZHZvX3BvcnRfZW5hYmxlZChpOTE1LCBpbnRlbF9z
ZHZvLT5zZHZvX3JlZywgcGlwZSk7CiAKIAlyZXR1cm4gcmV0IHx8IGFjdGl2ZV9vdXRwdXRzOwog
fQpAQCAtMTU2OCw3ICsxNTY4LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2b19nZXRfY29uZmln
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKnBpcGVfY29uZmlnKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBlbmNvZGVy
LT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJ
c3RydWN0IGludGVsX3Nkdm8gKmludGVsX3Nkdm8gPSB0b19zZHZvKGVuY29kZXIpOwogCXN0cnVj
dCBpbnRlbF9zZHZvX2R0ZCBkdGQ7CiAJaW50IGVuY29kZXJfcGl4ZWxfbXVsdGlwbGllciA9IDA7
CkBAIC0xNjEwLDcgKzE2MTAsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX2dldF9jb25maWco
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICogZW5jb2Rlci0+Z2V0X2NvbmZpZyB3
ZSBzbyBhbHJlYWR5IGhhdmUgYSB2YWxpZCBwaXhlbCBtdWx0cGxpZXIgb24gYWxsCiAJICogb3Ro
ZXIgcGxhdGZyb21zLgogCSAqLwotCWlmIChJU19JOTE1RyhkZXZfcHJpdikgfHwgSVNfSTkxNUdN
KGRldl9wcml2KSkgeworCWlmIChJU19JOTE1RyhpOTE1KSB8fCBJU19JOTE1R00oaTkxNSkpIHsK
IAkJcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIgPQogCQkJKChzZHZveCAmIFNEVk9fUE9S
VF9NVUxUSVBMWV9NQVNLKQogCQkJID4+IFNEVk9fUE9SVF9NVUxUSVBMWV9TSElGVCkgKyAxOwpA
QCAtMTY5Myw3ICsxNjkzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9zZHZvKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRl
bF9zZHZvICppbnRlbF9zZHZvID0gdG9fc2R2byhlbmNvZGVyKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJdTMy
IHRlbXA7CkBAIC0xNzE2LDEzICsxNzE2LDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVf
c2R2byhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkgKiB0byB0cmFuc2NvZGVyIEEg
YWZ0ZXIgZGlzYWJsaW5nIGl0IHRvIGFsbG93IHRoZQogCSAqIG1hdGNoaW5nIERQIHBvcnQgdG8g
YmUgZW5hYmxlZCBvbiB0cmFuc2NvZGVyIEEuCiAJICovCi0JaWYgKEhBU19QQ0hfSUJYKGRldl9w
cml2KSAmJiBjcnRjLT5waXBlID09IFBJUEVfQikgeworCWlmIChIQVNfUENIX0lCWChpOTE1KSAm
JiBjcnRjLT5waXBlID09IFBJUEVfQikgewogCQkvKgogCQkgKiBXZSBnZXQgQ1BVL1BDSCBGSUZP
IHVuZGVycnVucyBvbiB0aGUgb3RoZXIgcGlwZSB3aGVuCiAJCSAqIGRvaW5nIHRoZSB3b3JrYXJv
dW5kLiBTd2VlcCB0aGVtIHVuZGVyIHRoZSBydWcuCiAJCSAqLwotCQlpbnRlbF9zZXRfY3B1X2Zp
Zm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBQSVBFX0EsIGZhbHNlKTsKLQkJaW50ZWxf
c2V0X3BjaF9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgUElQRV9BLCBmYWxzZSk7
CisJCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgUElQRV9BLCBm
YWxzZSk7CisJCWludGVsX3NldF9wY2hfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoaTkxNSwgUElQ
RV9BLCBmYWxzZSk7CiAKIAkJdGVtcCAmPSB+U0RWT19QSVBFX1NFTF9NQVNLOwogCQl0ZW1wIHw9
IFNEVk9fRU5BQkxFIHwgU0RWT19QSVBFX1NFTChQSVBFX0EpOwpAQCAtMTczMSw5ICsxNzMxLDkg
QEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9zZHZvKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQl0ZW1wICY9IH5TRFZPX0VOQUJMRTsKIAkJaW50ZWxfc2R2b193cml0ZV9zZHZv
eChpbnRlbF9zZHZvLCB0ZW1wKTsKIAotCQlpbnRlbF93YWl0X2Zvcl92YmxhbmtfaWZfYWN0aXZl
KGRldl9wcml2LCBQSVBFX0EpOwotCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0
aW5nKGRldl9wcml2LCBQSVBFX0EsIHRydWUpOwotCQlpbnRlbF9zZXRfcGNoX2ZpZm9fdW5kZXJy
dW5fcmVwb3J0aW5nKGRldl9wcml2LCBQSVBFX0EsIHRydWUpOworCQlpbnRlbF93YWl0X2Zvcl92
YmxhbmtfaWZfYWN0aXZlKGk5MTUsIFBJUEVfQSk7CisJCWludGVsX3NldF9jcHVfZmlmb191bmRl
cnJ1bl9yZXBvcnRpbmcoaTkxNSwgUElQRV9BLCB0cnVlKTsKKwkJaW50ZWxfc2V0X3BjaF9maWZv
X3VuZGVycnVuX3JlcG9ydGluZyhpOTE1LCBQSVBFX0EsIHRydWUpOwogCX0KIH0KIApAQCAtMTc1
NSw3ICsxNzU1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX3Nkdm8oc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9z
dGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gZW5jb2Rlci0+
YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShk
ZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0
cnVjdCBpbnRlbF9zZHZvICppbnRlbF9zZHZvID0gdG9fc2R2byhlbmNvZGVyKTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2Uu
Y3J0Yyk7CiAJdTMyIHRlbXA7CkBAIC0xNzY4LDcgKzE3NjgsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9lbmFibGVfc2R2byhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlpbnRlbF9zZHZv
X3dyaXRlX3Nkdm94KGludGVsX3Nkdm8sIHRlbXApOwogCiAJZm9yIChpID0gMDsgaSA8IDI7IGkr
KykKLQkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LCBpbnRlbF9jcnRjLT5waXBlKTsK
KwkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGk5MTUsIGludGVsX2NydGMtPnBpcGUpOwogCiAJc3Vj
Y2VzcyA9IGludGVsX3Nkdm9fZ2V0X3RyYWluZWRfaW5wdXRzKGludGVsX3Nkdm8sICZpbnB1dDEs
ICZpbnB1dDIpOwogCS8qCkBAIC0xODY1LDE3ICsxODY1LDE3IEBAIHN0YXRpYyBib29sIGludGVs
X3Nkdm9fZ2V0X2NhcGFiaWxpdGllcyhzdHJ1Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2bywgc3Ry
dWN0IGluCiAKIHN0YXRpYyB1MTYgaW50ZWxfc2R2b19nZXRfaG90cGx1Z19zdXBwb3J0KHN0cnVj
dCBpbnRlbF9zZHZvICppbnRlbF9zZHZvKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfc2R2by0+YmFzZS5iYXNlLmRldik7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGludGVsX3Nkdm8tPmJhc2UuYmFzZS5kZXYp
OwogCXUxNiBob3RwbHVnOwogCi0JaWYgKCFJOTE1X0hBU19IT1RQTFVHKGRldl9wcml2KSkKKwlp
ZiAoIUk5MTVfSEFTX0hPVFBMVUcoaTkxNSkpCiAJCXJldHVybiAwOwogCiAJLyoKIAkgKiBIVyBF
cnJhdHVtOiBTRFZPIEhvdHBsdWcgaXMgYnJva2VuIG9uIGFsbCBpOTQ1RyBjaGlwcywgdGhlcmUn
cyBub2lzZQogCSAqIG9uIHRoZSBsaW5lLgogCSAqLwotCWlmIChJU19JOTQ1RyhkZXZfcHJpdikg
fHwgSVNfSTk0NUdNKGRldl9wcml2KSkKKwlpZiAoSVNfSTk0NUcoaTkxNSkgfHwgSVNfSTk0NUdN
KGk5MTUpKQogCQlyZXR1cm4gMDsKIAogCWlmICghaW50ZWxfc2R2b19nZXRfdmFsdWUoaW50ZWxf
c2R2bywgU0RWT19DTURfR0VUX0hPVF9QTFVHX1NVUFBPUlQsCkBAIC0xOTE5LDExICsxOTE5LDEx
IEBAIGludGVsX3Nkdm9fZ2V0X2VkaWQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikK
IHN0YXRpYyBzdHJ1Y3QgZWRpZCAqCiBpbnRlbF9zZHZvX2dldF9hbmFsb2dfZWRpZChzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7CiAKIAlyZXR1cm4gZHJtX2dldF9l
ZGlkKGNvbm5lY3RvciwKLQkJCSAgICBpbnRlbF9nbWJ1c19nZXRfYWRhcHRlcihkZXZfcHJpdiwK
LQkJCQkJCSAgICBkZXZfcHJpdi0+dmJ0LmNydF9kZGNfcGluKSk7CisJCQkgICAgaW50ZWxfZ21i
dXNfZ2V0X2FkYXB0ZXIoaTkxNSwKKwkJCQkJCSAgICBpOTE1LT52YnQuY3J0X2RkY19waW4pKTsK
IH0KIAogc3RhdGljIGVudW0gZHJtX2Nvbm5lY3Rvcl9zdGF0dXMKQEAgLTIxODYsNyArMjE4Niw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nkdm9fZ2V0X3R2X21vZGVzKHN0cnVjdCBkcm1fY29ubmVj
dG9yICpjb25uZWN0b3IpCiBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX2dldF9sdmRzX21vZGVzKHN0
cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CiAJc3RydWN0IGludGVsX3Nkdm8gKmlu
dGVsX3Nkdm8gPSBpbnRlbF9hdHRhY2hlZF9zZHZvKGNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKIAlzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbmV3bW9kZTsKIAogCURSTV9ERUJVR19LTVMoIltDT05ORUNU
T1I6JWQ6JXNdXG4iLApAQCAtMjE5Niw5ICsyMTk2LDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2
b19nZXRfbHZkc19tb2RlcyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCSAqIEZl
dGNoIG1vZGVzIGZyb20gVkJULiBGb3IgU0RWTyBwcmVmZXIgdGhlIFZCVCBtb2RlIHNpbmNlIHNv
bWUKIAkgKiBTRFZPLT5MVkRTIHRyYW5zY29kZXJzIGNhbid0IGNvcGUgd2l0aCB0aGUgRURJRCBt
b2RlLgogCSAqLwotCWlmIChkZXZfcHJpdi0+dmJ0LnNkdm9fbHZkc192YnRfbW9kZSAhPSBOVUxM
KSB7CisJaWYgKGk5MTUtPnZidC5zZHZvX2x2ZHNfdmJ0X21vZGUgIT0gTlVMTCkgewogCQluZXdt
b2RlID0gZHJtX21vZGVfZHVwbGljYXRlKGNvbm5lY3Rvci0+ZGV2LAotCQkJCQkgICAgIGRldl9w
cml2LT52YnQuc2R2b19sdmRzX3ZidF9tb2RlKTsKKwkJCQkJICAgICBpOTE1LT52YnQuc2R2b19s
dmRzX3ZidF9tb2RlKTsKIAkJaWYgKG5ld21vZGUgIT0gTlVMTCkgewogCQkJLyogR3VhcmFudGVl
IHRoZSBtb2RlIGlzIHByZWZlcnJlZCAqLwogCQkJbmV3bW9kZS0+dHlwZSA9IChEUk1fTU9ERV9U
WVBFX1BSRUZFUlJFRCB8CkBAIC0yNDg4LDE1ICsyNDg4LDE1IEBAIGludGVsX3Nkdm9fZ3Vlc3Nf
ZGRjX2J1cyhzdHJ1Y3QgaW50ZWxfc2R2byAqc2R2bykKICAqIG91dHB1dHMsIHRoZW4gTFZEUyBv
dXRwdXRzLgogICovCiBzdGF0aWMgdm9pZAotaW50ZWxfc2R2b19zZWxlY3RfZGRjX2J1cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitpbnRlbF9zZHZvX3NlbGVjdF9kZGNfYnVz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBzdHJ1Y3QgaW50ZWxfc2R2byAq
c2R2bykKIHsKIAlzdHJ1Y3Qgc2R2b19kZXZpY2VfbWFwcGluZyAqbWFwcGluZzsKIAogCWlmIChz
ZHZvLT5wb3J0ID09IFBPUlRfQikKLQkJbWFwcGluZyA9ICZkZXZfcHJpdi0+dmJ0LnNkdm9fbWFw
cGluZ3NbMF07CisJCW1hcHBpbmcgPSAmaTkxNS0+dmJ0LnNkdm9fbWFwcGluZ3NbMF07CiAJZWxz
ZQotCQltYXBwaW5nID0gJmRldl9wcml2LT52YnQuc2R2b19tYXBwaW5nc1sxXTsKKwkJbWFwcGlu
ZyA9ICZpOTE1LT52YnQuc2R2b19tYXBwaW5nc1sxXTsKIAogCWlmIChtYXBwaW5nLT5pbml0aWFs
aXplZCkKIAkJc2R2by0+ZGRjX2J1cyA9IDEgPDwgKChtYXBwaW5nLT5kZGNfcGluICYgMHhmMCkg
Pj4gNCk7CkBAIC0yNTA1LDI0ICsyNTA1LDI0IEBAIGludGVsX3Nkdm9fc2VsZWN0X2RkY19idXMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdGF0aWMgdm9pZAotaW50
ZWxfc2R2b19zZWxlY3RfaTJjX2J1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CitpbnRlbF9zZHZvX3NlbGVjdF9pMmNfYnVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQkJICBzdHJ1Y3QgaW50ZWxfc2R2byAqc2R2bykKIHsKIAlzdHJ1Y3Qgc2R2b19kZXZpY2Vf
bWFwcGluZyAqbWFwcGluZzsKIAl1OCBwaW47CiAKIAlpZiAoc2R2by0+cG9ydCA9PSBQT1JUX0Ip
Ci0JCW1hcHBpbmcgPSAmZGV2X3ByaXYtPnZidC5zZHZvX21hcHBpbmdzWzBdOworCQltYXBwaW5n
ID0gJmk5MTUtPnZidC5zZHZvX21hcHBpbmdzWzBdOwogCWVsc2UKLQkJbWFwcGluZyA9ICZkZXZf
cHJpdi0+dmJ0LnNkdm9fbWFwcGluZ3NbMV07CisJCW1hcHBpbmcgPSAmaTkxNS0+dmJ0LnNkdm9f
bWFwcGluZ3NbMV07CiAKIAlpZiAobWFwcGluZy0+aW5pdGlhbGl6ZWQgJiYKLQkgICAgaW50ZWxf
Z21idXNfaXNfdmFsaWRfcGluKGRldl9wcml2LCBtYXBwaW5nLT5pMmNfcGluKSkKKwkgICAgaW50
ZWxfZ21idXNfaXNfdmFsaWRfcGluKGk5MTUsIG1hcHBpbmctPmkyY19waW4pKQogCQlwaW4gPSBt
YXBwaW5nLT5pMmNfcGluOwogCWVsc2UKIAkJcGluID0gR01CVVNfUElOX0RQQjsKIAotCXNkdm8t
PmkyYyA9IGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGRldl9wcml2LCBwaW4pOworCXNkdm8tPmky
YyA9IGludGVsX2dtYnVzX2dldF9hZGFwdGVyKGk5MTUsIHBpbik7CiAKIAkvKgogCSAqIFdpdGgg
Z21idXMgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZHJpdmUgc2R2byBpMmMgYXQgMk1IeiwgYnV0IHNv
bWVob3cKQEAgLTI1NDYsMTcgKzI1NDYsMTcgQEAgaW50ZWxfc2R2b19pc19oZG1pX2Nvbm5lY3Rv
cihzdHJ1Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2bywgaW50IGRldmljZSkKIH0KIAogc3RhdGlj
IHU4Ci1pbnRlbF9zZHZvX2dldF9zbGF2ZV9hZGRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKK2ludGVsX3Nkdm9fZ2V0X3NsYXZlX2FkZHIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkgIHN0cnVjdCBpbnRlbF9zZHZvICpzZHZvKQogewogCXN0cnVjdCBzZHZv
X2RldmljZV9tYXBwaW5nICpteV9tYXBwaW5nLCAqb3RoZXJfbWFwcGluZzsKIAogCWlmIChzZHZv
LT5wb3J0ID09IFBPUlRfQikgewotCQlteV9tYXBwaW5nID0gJmRldl9wcml2LT52YnQuc2R2b19t
YXBwaW5nc1swXTsKLQkJb3RoZXJfbWFwcGluZyA9ICZkZXZfcHJpdi0+dmJ0LnNkdm9fbWFwcGlu
Z3NbMV07CisJCW15X21hcHBpbmcgPSAmaTkxNS0+dmJ0LnNkdm9fbWFwcGluZ3NbMF07CisJCW90
aGVyX21hcHBpbmcgPSAmaTkxNS0+dmJ0LnNkdm9fbWFwcGluZ3NbMV07CiAJfSBlbHNlIHsKLQkJ
bXlfbWFwcGluZyA9ICZkZXZfcHJpdi0+dmJ0LnNkdm9fbWFwcGluZ3NbMV07Ci0JCW90aGVyX21h
cHBpbmcgPSAmZGV2X3ByaXYtPnZidC5zZHZvX21hcHBpbmdzWzBdOworCQlteV9tYXBwaW5nID0g
Jmk5MTUtPnZidC5zZHZvX21hcHBpbmdzWzFdOworCQlvdGhlcl9tYXBwaW5nID0gJmk5MTUtPnZi
dC5zZHZvX21hcHBpbmdzWzBdOwogCX0KIAogCS8qIElmIHRoZSBCSU9TIGRlc2NyaWJlZCBvdXIg
U0RWTyBkZXZpY2UsIHRha2UgYWR2YW50YWdlIG9mIGl0LiAqLwpAQCAtMjYxNiwxMCArMjYxNiwx
MCBAQCBzdGF0aWMgdm9pZAogaW50ZWxfc2R2b19hZGRfaGRtaV9wcm9wZXJ0aWVzKHN0cnVjdCBp
bnRlbF9zZHZvICppbnRlbF9zZHZvLAogCQkJICAgICAgIHN0cnVjdCBpbnRlbF9zZHZvX2Nvbm5l
Y3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmJhc2UuZGV2KTsKIAogCWludGVs
X2F0dGFjaF9mb3JjZV9hdWRpb19wcm9wZXJ0eSgmY29ubmVjdG9yLT5iYXNlLmJhc2UpOwotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQgJiYgSVNfTU9CSUxFKGRldl9wcml2KSkgeworCWlm
IChJTlRFTF9HRU4oaTkxNSkgPj0gNCAmJiBJU19NT0JJTEUoaTkxNSkpIHsKIAkJaW50ZWxfYXR0
YWNoX2Jyb2FkY2FzdF9yZ2JfcHJvcGVydHkoJmNvbm5lY3Rvci0+YmFzZS5iYXNlKTsKIAl9CiAJ
aW50ZWxfYXR0YWNoX2FzcGVjdF9yYXRpb19wcm9wZXJ0eSgmY29ubmVjdG9yLT5iYXNlLmJhc2Up
OwpAQCAtMzE4MCw5ICszMTgwLDkgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpMmNfbG9ja19vcGVy
YXRpb25zIHByb3h5X2xvY2tfb3BzID0gewogCiBzdGF0aWMgYm9vbAogaW50ZWxfc2R2b19pbml0
X2RkY19wcm94eShzdHJ1Y3QgaW50ZWxfc2R2byAqc2R2bywKLQkJCSAgc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorCQkJICBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKLQlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGRldl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3Qg
cGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5wZGV2OwogCiAJc2R2by0+ZGRjLm93bmVyID0gVEhJ
U19NT0RVTEU7CiAJc2R2by0+ZGRjLmNsYXNzID0gSTJDX0NMQVNTX0REQzsKQEAgLTMxOTUsMjMg
KzMxOTUsMjMgQEAgaW50ZWxfc2R2b19pbml0X2RkY19wcm94eShzdHJ1Y3QgaW50ZWxfc2R2byAq
c2R2bywKIAlyZXR1cm4gaTJjX2FkZF9hZGFwdGVyKCZzZHZvLT5kZGMpID09IDA7CiB9CiAKLXN0
YXRpYyB2b2lkIGFzc2VydF9zZHZvX3BvcnRfdmFsaWQoY29uc3Qgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgYXNzZXJ0X3Nkdm9fcG9ydF92YWxpZChjb25z
dCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBlbnVtIHBvcnQgcG9ydCkK
IHsKLQlpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpCisJaWYgKEhBU19QQ0hfU1BMSVQoaTkx
NSkpCiAJCVdBUk5fT04ocG9ydCAhPSBQT1JUX0IpOwogCWVsc2UKIAkJV0FSTl9PTihwb3J0ICE9
IFBPUlRfQiAmJiBwb3J0ICE9IFBPUlRfQyk7CiB9CiAKLWJvb2wgaW50ZWxfc2R2b19pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2Jvb2wgaW50ZWxfc2R2b19pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgIGk5MTVfcmVnX3Qgc2R2b19yZWcs
IGVudW0gcG9ydCBwb3J0KQogewogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVy
OwogCXN0cnVjdCBpbnRlbF9zZHZvICppbnRlbF9zZHZvOwogCWludCBpOwogCi0JYXNzZXJ0X3Nk
dm9fcG9ydF92YWxpZChkZXZfcHJpdiwgcG9ydCk7CisJYXNzZXJ0X3Nkdm9fcG9ydF92YWxpZChp
OTE1LCBwb3J0KTsKIAogCWludGVsX3Nkdm8gPSBremFsbG9jKHNpemVvZigqaW50ZWxfc2R2byks
IEdGUF9LRVJORUwpOwogCWlmICghaW50ZWxfc2R2bykKQEAgLTMyMjAsOSArMzIyMCw5IEBAIGJv
b2wgaW50ZWxfc2R2b19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlp
bnRlbF9zZHZvLT5zZHZvX3JlZyA9IHNkdm9fcmVnOwogCWludGVsX3Nkdm8tPnBvcnQgPSBwb3J0
OwogCWludGVsX3Nkdm8tPnNsYXZlX2FkZHIgPQotCQlpbnRlbF9zZHZvX2dldF9zbGF2ZV9hZGRy
KGRldl9wcml2LCBpbnRlbF9zZHZvKSA+PiAxOwotCWludGVsX3Nkdm9fc2VsZWN0X2kyY19idXMo
ZGV2X3ByaXYsIGludGVsX3Nkdm8pOwotCWlmICghaW50ZWxfc2R2b19pbml0X2RkY19wcm94eShp
bnRlbF9zZHZvLCBkZXZfcHJpdikpCisJCWludGVsX3Nkdm9fZ2V0X3NsYXZlX2FkZHIoaTkxNSwg
aW50ZWxfc2R2bykgPj4gMTsKKwlpbnRlbF9zZHZvX3NlbGVjdF9pMmNfYnVzKGk5MTUsIGludGVs
X3Nkdm8pOworCWlmICghaW50ZWxfc2R2b19pbml0X2RkY19wcm94eShpbnRlbF9zZHZvLCBpOTE1
KSkKIAkJZ290byBlcnJfaTJjX2J1czsKIAogCS8qIGVuY29kZXIgdHlwZSB3aWxsIGJlIGRlY2lk
ZWQgbGF0ZXIgKi8KQEAgLTMyMzAsNyArMzIzMCw3IEBAIGJvb2wgaW50ZWxfc2R2b19pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpbnRlbF9lbmNvZGVyLT50eXBlID0g
SU5URUxfT1VUUFVUX1NEVk87CiAJaW50ZWxfZW5jb2Rlci0+cG93ZXJfZG9tYWluID0gUE9XRVJf
RE9NQUlOX1BPUlRfT1RIRVI7CiAJaW50ZWxfZW5jb2Rlci0+cG9ydCA9IHBvcnQ7Ci0JZHJtX2Vu
Y29kZXJfaW5pdCgmZGV2X3ByaXYtPmRybSwgJmludGVsX2VuY29kZXItPmJhc2UsCisJZHJtX2Vu
Y29kZXJfaW5pdCgmaTkxNS0+ZHJtLCAmaW50ZWxfZW5jb2Rlci0+YmFzZSwKIAkJCSAmaW50ZWxf
c2R2b19lbmNfZnVuY3MsIDAsCiAJCQkgIlNEVk8gJWMiLCBwb3J0X25hbWUocG9ydCkpOwogCkBA
IC0zMjQ2LDcgKzMyNDYsNyBAQCBib29sIGludGVsX3Nkdm9faW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogCiAJaW50ZWxfZW5jb2Rlci0+Y29tcHV0ZV9jb25maWcg
PSBpbnRlbF9zZHZvX2NvbXB1dGVfY29uZmlnOwotCWlmIChIQVNfUENIX1NQTElUKGRldl9wcml2
KSkgeworCWlmIChIQVNfUENIX1NQTElUKGk5MTUpKSB7CiAJCWludGVsX2VuY29kZXItPmRpc2Fi
bGUgPSBwY2hfZGlzYWJsZV9zZHZvOwogCQlpbnRlbF9lbmNvZGVyLT5wb3N0X2Rpc2FibGUgPSBw
Y2hfcG9zdF9kaXNhYmxlX3Nkdm87CiAJfSBlbHNlIHsKQEAgLTMyOTAsNyArMzI5MCw3IEBAIGJv
b2wgaW50ZWxfc2R2b19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkg
Ki8KIAlpbnRlbF9zZHZvLT5iYXNlLmNsb25lYWJsZSA9IDA7CiAKLQlpbnRlbF9zZHZvX3NlbGVj
dF9kZGNfYnVzKGRldl9wcml2LCBpbnRlbF9zZHZvKTsKKwlpbnRlbF9zZHZvX3NlbGVjdF9kZGNf
YnVzKGk5MTUsIGludGVsX3Nkdm8pOwogCiAJLyogU2V0IHRoZSBpbnB1dCB0aW1pbmcgdG8gdGhl
IHNjcmVlbi4gQXNzdW1lIGFsd2F5cyBpbnB1dCAwLiAqLwogCWlmICghaW50ZWxfc2R2b19zZXRf
dGFyZ2V0X2lucHV0KGludGVsX3Nkdm8pKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfc2R2by5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc2R2by5oCmluZGV4
IGM5ZTA1YmNkZDE0MS4uMWVjNjc2NmM1YWUxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9zZHZvLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc2R2by5o
CkBAIC0xNSw5ICsxNSw5IEBACiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIGVudW0gcGlwZTsK
IAotYm9vbCBpbnRlbF9zZHZvX3BvcnRfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCitib29sIGludGVsX3Nkdm9fcG9ydF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICAgICBpOTE1X3JlZ190IHNkdm9fcmVnLCBlbnVtIHBpcGUgKnBp
cGUpOwotYm9vbCBpbnRlbF9zZHZvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAorYm9vbCBpbnRlbF9zZHZvX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCSAgICAgaTkxNV9yZWdfdCByZWcsIGVudW0gcG9ydCBwb3J0KTsKIAogI2VuZGlmIC8qIF9f
SU5URUxfU0RWT19IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfc3ByaXRlLmMKaW5kZXggYzE4
MDgxNWZhYWJkLi43Mzg3MWU1ZThlMTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Nwcml0ZS5j
CkBAIC05NCwxMiArOTQsMTIgQEAgaW50IGludGVsX3VzZWNzX3RvX3NjYW5saW5lcyhjb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSwKIHZvaWQgaW50ZWxfcGlwZV91
cGRhdGVfc3RhcnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRl
KQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlID0gJm5ld19jcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CiAJ
bG9uZyB0aW1lb3V0ID0gbXNlY3NfdG9famlmZmllc190aW1lb3V0KDEpOwogCWludCBzY2FubGlu
ZSwgbWluLCBtYXgsIHZibGFua19zdGFydDsKIAl3YWl0X3F1ZXVlX2hlYWRfdCAqd3EgPSBkcm1f
Y3J0Y192Ymxhbmtfd2FpdHF1ZXVlKCZjcnRjLT5iYXNlKTsKLQlib29sIG5lZWRfdmx2X2RzaV93
YSA9IChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkg
JiYKKwlib29sIG5lZWRfdmx2X2RzaV93YSA9IChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NI
RVJSWVZJRVcoaTkxNSkpICYmCiAJCWludGVsX2NydGNfaGFzX3R5cGUobmV3X2NydGNfc3RhdGUs
IElOVEVMX09VVFBVVF9EU0kpOwogCURFRklORV9XQUlUKHdhaXQpOwogCXUzMiBwc3Jfc3RhdHVz
OwpAQCAtMjA3LDcgKzIwNyw3IEBAIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfZW5kKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIAlpbnQgc2NhbmxpbmVfZW5kID0gaW50
ZWxfZ2V0X2NydGNfc2NhbmxpbmUoY3J0Yyk7CiAJdTMyIGVuZF92YmxfY291bnQgPSBpbnRlbF9j
cnRjX2dldF92YmxhbmtfY291bnRlcihjcnRjKTsKIAlrdGltZV90IGVuZF92YmxfdGltZSA9IGt0
aW1lX2dldCgpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CiAKIAl0cmFjZV9pOTE1X3BpcGVfdXBkYXRlX2VuZChjcnRjLCBl
bmRfdmJsX2NvdW50LCBzY2FubGluZV9lbmQpOwogCkBAIC0yMjcsNyArMjI3LDcgQEAgdm9pZCBp
bnRlbF9waXBlX3VwZGF0ZV9lbmQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0
YXRlKQogCiAJbG9jYWxfaXJxX2VuYWJsZSgpOwogCi0JaWYgKGludGVsX3ZncHVfYWN0aXZlKGRl
dl9wcml2KSkKKwlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkpCiAJCXJldHVybjsKIAogCWlm
IChjcnRjLT5kZWJ1Zy5zdGFydF92YmxfY291bnQgJiYKQEAgLTM1Myw3ICszNTMsNyBAQCBza2xf
cHJvZ3JhbV9zY2FsZXIoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJICAgY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBl
ID0gcGxhbmUtPnBpcGU7CiAJaW50IHNjYWxlcl9pZCA9IHBsYW5lX3N0YXRlLT5zY2FsZXJfaWQ7
CiAJY29uc3Qgc3RydWN0IGludGVsX3NjYWxlciAqc2NhbGVyID0KQEAgLTM3NSw3ICszNzUsNyBA
QCBza2xfcHJvZ3JhbV9zY2FsZXIoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAogCS8qIFRP
RE86IGhhbmRsZSBzdWItcGl4ZWwgY29vcmRpbmF0ZXMgKi8KIAlpZiAoaXNfcGxhbmFyX3l1dl9m
b3JtYXQocGxhbmVfc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+Zm9ybWF0KSAmJgotCSAgICAhaWNs
X2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmUtPmlkKSkgeworCSAgICAhaWNsX2lzX2hkcl9w
bGFuZShpOTE1LCBwbGFuZS0+aWQpKSB7CiAJCXlfaHBoYXNlID0gc2tsX3NjYWxlcl9jYWxjX3Bo
YXNlKDEsIGhzY2FsZSwgZmFsc2UpOwogCQl5X3ZwaGFzZSA9IHNrbF9zY2FsZXJfY2FsY19waGFz
ZSgxLCB2c2NhbGUsIGZhbHNlKTsKIApAQCAtNDE1LDcgKzQxNSw3IEBAIGljbF9wcm9ncmFtX2lu
cHV0X2NzYyhzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkgICAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJICAgICAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUg
PSBwbGFuZS0+cGlwZTsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCkBA
IC01MDcsNyArNTA3LDcgQEAgc2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSwKIAkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAog
CQkgIGludCBjb2xvcl9wbGFuZSwgYm9vbCBzbGF2ZSwgdTMyIHBsYW5lX2N0bCkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAllbnVtIHBpcGUgcGlw
ZSA9IHBsYW5lLT5waXBlOwogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5
ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CkBAIC01MjksNyArNTI5LDcgQEAgc2tsX3Byb2dy
YW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAogCXBsYW5lX2N0bCB8PSBza2xf
cGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDEwIHx8IElTX0dFTUlOSUxBS0UoaTkxNSkpCiAJCXBsYW5lX2NvbG9yX2N0bCA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9jdGwgfAogCQkJZ2xrX3BsYW5lX2NvbG9yX2N0bF9jcnRjKGNydGNfc3RhdGUp
OwogCkBAIC01NDksNyArNTQ5LDcgQEAgc2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKIAkJY3J0Y195ID0gMDsKIAl9CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2
X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUt
PnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiAKIAlJOTE1X1dSSVRFX0ZXKFBMQU5FX1NUUklERShw
aXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7CiAJSTkxNV9XUklURV9GVyhQTEFORV9QT1MocGlwZSwg
cGxhbmVfaWQpLCAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CkBAIC01NTcsNyArNTU3LDcgQEAg
c2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlJOTE1X1dSSVRF
X0ZXKFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwKIAkJICAgICAgKHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVsxXS5vZmZzZXQgLSBzdXJmX2FkZHIpIHwgYXV4X3N0cmlkZSk7CiAKLQlp
ZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7CisJaWYgKGljbF9pc19o
ZHJfcGxhbmUoaTkxNSwgcGxhbmVfaWQpKSB7CiAJCXUzMiBjdXNfY3RsID0gMDsKIAogCQlpZiAo
bGlua2VkKSB7CkBAIC01NzgsMTAgKzU3OCwxMCBAQCBza2xfcHJvZ3JhbV9wbGFuZShzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lLAogCQlJOTE1X1dSSVRFX0ZXKFBMQU5FX0NVU19DVEwocGlwZSwg
cGxhbmVfaWQpLCBjdXNfY3RsKTsKIAl9CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDEw
IHx8IElTX0dFTUlOSUxBS0UoaTkxNSkpCiAJCUk5MTVfV1JJVEVfRlcoUExBTkVfQ09MT1JfQ1RM
KHBpcGUsIHBsYW5lX2lkKSwgcGxhbmVfY29sb3JfY3RsKTsKIAotCWlmIChmYi0+Zm9ybWF0LT5p
c195dXYgJiYgaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQorCWlmIChmYi0+
Zm9ybWF0LT5pc195dXYgJiYgaWNsX2lzX2hkcl9wbGFuZShpOTE1LCBwbGFuZV9pZCkpCiAJCWlj
bF9wcm9ncmFtX2lucHV0X2NzYyhwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwogCiAJ
c2tsX3dyaXRlX3BsYW5lX3dtKHBsYW5lLCBjcnRjX3N0YXRlKTsKQEAgLTU5Miw3ICs1OTIsNyBA
QCBza2xfcHJvZ3JhbV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCiAJSTkxNV9X
UklURV9GVyhQTEFORV9PRkZTRVQocGlwZSwgcGxhbmVfaWQpLCAoeSA8PCAxNikgfCB4KTsKIAot
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCisJaWYgKElOVEVMX0dFTihpOTE1KSA8IDEx
KQogCQlJOTE1X1dSSVRFX0ZXKFBMQU5FX0FVWF9PRkZTRVQocGlwZSwgcGxhbmVfaWQpLAogCQkJ
ICAgICAgKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS55IDw8IDE2KSB8CiAJCQkgICAgICBw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ueCk7CkBAIC02MDksNyArNjA5LDcgQEAgc2tsX3By
b2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlpZiAoIXNsYXZlICYmIHBs
YW5lX3N0YXRlLT5zY2FsZXJfaWQgPj0gMCkKIAkJc2tsX3Byb2dyYW1fc2NhbGVyKHBsYW5lLCBj
cnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZf
cHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZp
OTE1LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtNjQxLDE0
ICs2NDEsMTQgQEAgc3RhdGljIHZvaWQKIHNrbF9kaXNhYmxlX3BsYW5lKHN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUsCiAJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFu
ZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShw
bGFuZS0+YmFzZS5kZXYpOwogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwog
Ci0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwor
CXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogCi0JaWYg
KGljbF9pc19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5lX2lkKSkKKwlpZiAoaWNsX2lzX2hkcl9w
bGFuZShpOTE1LCBwbGFuZV9pZCkpCiAJCUk5MTVfV1JJVEVfRlcoUExBTkVfQ1VTX0NUTChwaXBl
LCBwbGFuZV9pZCksIDApOwogCiAJc2tsX3dyaXRlX3BsYW5lX3dtKHBsYW5lLCBjcnRjX3N0YXRl
KTsKQEAgLTY1NiwyMSArNjU2LDIxIEBAIHNrbF9kaXNhYmxlX3BsYW5lKHN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUsCiAJSTkxNV9XUklURV9GVyhQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpLCAw
KTsKIAlJOTE1X1dSSVRFX0ZXKFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQpLCAwKTsKIAotCXNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwor
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiB9
CiAKIHN0YXRpYyBib29sCiBza2xfcGxhbmVfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUsCiAJCSAgICAgICBlbnVtIHBpcGUgKnBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWVudW0g
aW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gcG93ZXJfZG9tYWluOwogCWVudW0gcGxhbmVfaWQg
cGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJYm9vbCBy
ZXQ7CiAKIAlwb3dlcl9kb21haW4gPSBQT1dFUl9ET01BSU5fUElQRShwbGFuZS0+cGlwZSk7Ci0J
d2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsIHBv
d2VyX2RvbWFpbik7CisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJs
ZWQoaTkxNSwgcG93ZXJfZG9tYWluKTsKIAlpZiAoIXdha2VyZWYpCiAJCXJldHVybiBmYWxzZTsK
IApAQCAtNjc4LDcgKzY3OCw3IEBAIHNrbF9wbGFuZV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSwKIAogCSpwaXBlID0gcGxhbmUtPnBpcGU7CiAKLQlpbnRlbF9kaXNwbGF5
X3Bvd2VyX3B1dChkZXZfcHJpdiwgcG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNw
bGF5X3Bvd2VyX3B1dChpOTE1LCBwb3dlcl9kb21haW4sIHdha2VyZWYpOwogCiAJcmV0dXJuIHJl
dDsKIH0KQEAgLTY4Nyw3ICs2ODcsNyBAQCBzdGF0aWMgdm9pZAogY2h2X3VwZGF0ZV9jc2MoY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUp
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUt
PmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5iYXNlLmZiOwogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJLyoK
QEAgLTc0Niw3ICs3NDYsNyBAQCBzdGF0aWMgdm9pZAogdmx2X3VwZGF0ZV9jbHJjKGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNl
LmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
YmFzZS5mYjsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwogCWVudW0gcGxhbmVfaWQg
cGxhbmVfaWQgPSBwbGFuZS0+aWQ7CkBAIC04NjMsNyArODYzLDcgQEAgdmx2X3VwZGF0ZV9wbGFu
ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUocGxhbmUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwog
CWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJdTMyIHNwcnN1cmZfb2Zmc2V0
ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKQEAgLTg4Niw3ICs4ODYsNyBA
QCB2bHZfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAKIAlsaW5lYXJf
b2Zmc2V0ID0gaW50ZWxfZmJfeHlfdG9fbGluZWFyKHgsIHksIHBsYW5lX3N0YXRlLCAwKTsKIAot
CXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKwlz
cGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKIAogCUk5MTVf
V1JJVEVfRlcoU1BTVFJJREUocGlwZSwgcGxhbmVfaWQpLAogCQkgICAgICBwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMF0uc3RyaWRlKTsKQEAgLTg5NCw3ICs4OTQsNyBAQCB2bHZfdXBkYXRlX3Bs
YW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJSTkxNV9XUklURV9GVyhTUFNJWkUocGlw
ZSwgcGxhbmVfaWQpLCAoY3J0Y19oIDw8IDE2KSB8IGNydGNfdyk7CiAJSTkxNV9XUklURV9GVyhT
UENPTlNUQUxQSEEocGlwZSwgcGxhbmVfaWQpLCAwKTsKIAotCWlmIChJU19DSEVSUllWSUVXKGRl
dl9wcml2KSAmJiBwaXBlID09IFBJUEVfQikKKwlpZiAoSVNfQ0hFUlJZVklFVyhpOTE1KSAmJiBw
aXBlID09IFBJUEVfQikKIAkJY2h2X3VwZGF0ZV9jc2MocGxhbmVfc3RhdGUpOwogCiAJaWYgKGtl
eS0+ZmxhZ3MpIHsKQEAgLTkxNywzOCArOTE3LDM4IEBAIHZsdl91cGRhdGVfcGxhbmUoc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwKIAogCXZsdl91cGRhdGVfY2xyYyhwbGFuZV9zdGF0ZSk7CiAK
LQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdz
KTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT51bmNvcmUubG9jaywgaXJxZmxhZ3Mp
OwogfQogCiBzdGF0aWMgdm9pZAogdmx2X2Rpc2FibGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSwKIAkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5l
LT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAllbnVtIHBsYW5l
X2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CiAKLQlz
cGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisJc3Bp
bl9sb2NrX2lycXNhdmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiAKIAlJOTE1X1dS
SVRFX0ZXKFNQQ05UUihwaXBlLCBwbGFuZV9pZCksIDApOwogCUk5MTVfV1JJVEVfRlcoU1BTVVJG
KHBpcGUsIHBsYW5lX2lkKSwgMCk7CiAKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJp
di0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1
LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogfQogCiBzdGF0aWMgYm9vbAogdmx2X3BsYW5lX2dl
dF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkgICAgICAgZW51bSBwaXBl
ICpwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
cGxhbmUtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUocGxhbmUtPmJhc2UuZGV2KTsKIAllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIHBv
d2VyX2RvbWFpbjsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCWludGVs
X3dha2VyZWZfdCB3YWtlcmVmOwogCWJvb2wgcmV0OwogCiAJcG93ZXJfZG9tYWluID0gUE9XRVJf
RE9NQUlOX1BJUEUocGxhbmUtPnBpcGUpOwotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2Vy
X2dldF9pZl9lbmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21haW4pOworCXdha2VyZWYgPSBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsIHBvd2VyX2RvbWFpbik7CiAJaWYg
KCF3YWtlcmVmKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTk1Niw3ICs5NTYsNyBAQCB2bHZfcGxh
bmVfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAKIAkqcGlwZSA9IHBs
YW5lLT5waXBlOwogCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2Rv
bWFpbiwgd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoaTkxNSwgcG93ZXJfZG9t
YWluLCB3YWtlcmVmKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC05NzcsNyArOTc3LDcgQEAgc3Rh
dGljIHUzMiBpdmJfc3ByaXRlX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogc3RhdGljIHUzMiBpdmJfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPQorCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJdG9faTkxNShwbGFuZV9z
dGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5l
X3N0YXRlLT5iYXNlLnJvdGF0aW9uOwpAQCAtOTg2LDcgKzk4Niw3IEBAIHN0YXRpYyB1MzIgaXZi
X3Nwcml0ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAK
IAlzcHJjdGwgPSBTUFJJVEVfRU5BQkxFOwogCi0JaWYgKElTX0lWWUJSSURHRShkZXZfcHJpdikp
CisJaWYgKElTX0lWWUJSSURHRShpOTE1KSkKIAkJc3ByY3RsIHw9IFNQUklURV9UUklDS0xFX0ZF
RURfRElTQUJMRTsKIAogCXN3aXRjaCAoZmItPmZvcm1hdC0+Zm9ybWF0KSB7CkBAIC0xMDM4LDcg
KzEwMzgsNyBAQCBpdmJfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJ
CSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJIGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWVudW0g
cGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CiAJdTMyIHNwcnN1cmZfb2Zmc2V0ID0gcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKIAl1MzIgbGluZWFyX29mZnNldDsKQEAgLTEwNjcs
MTIgKzEwNjcsMTIgQEAgaXZiX3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
LAogCiAJbGluZWFyX29mZnNldCA9IGludGVsX2ZiX3h5X3RvX2xpbmVhcih4LCB5LCBwbGFuZV9z
dGF0ZSwgMCk7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBp
cnFmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFn
cyk7CiAKIAlJOTE1X1dSSVRFX0ZXKFNQUlNUUklERShwaXBlKSwgcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lWzBdLnN0cmlkZSk7CiAJSTkxNV9XUklURV9GVyhTUFJQT1MocGlwZSksIChjcnRjX3kg
PDwgMTYpIHwgY3J0Y194KTsKIAlJOTE1X1dSSVRFX0ZXKFNQUlNJWkUocGlwZSksIChjcnRjX2gg
PDwgMTYpIHwgY3J0Y193KTsKLQlpZiAoSVNfSVZZQlJJREdFKGRldl9wcml2KSkKKwlpZiAoSVNf
SVZZQlJJREdFKGk5MTUpKQogCQlJOTE1X1dSSVRFX0ZXKFNQUlNDQUxFKHBpcGUpLCBzcHJzY2Fs
ZSk7CiAKIAlpZiAoa2V5LT5mbGFncykgewpAQCAtMTA4Myw3ICsxMDgzLDcgQEAgaXZiX3VwZGF0
ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCiAJLyogSFNXIGNvbnNvbGlkYXRl
cyBTUFJUSUxFT0ZGIGFuZCBTUFJMSU5PRkYgaW50byBhIHNpbmdsZSBTUFJPRkZTRVQKIAkgKiBy
ZWdpc3RlciAqLwotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2
X3ByaXYpKSB7CisJaWYgKElTX0hBU1dFTEwoaTkxNSkgfHwgSVNfQlJPQURXRUxMKGk5MTUpKSB7
CiAJCUk5MTVfV1JJVEVfRlcoU1BST0ZGU0VUKHBpcGUpLCAoeSA8PCAxNikgfCB4KTsKIAl9IGVs
c2UgewogCQlJOTE1X1dSSVRFX0ZXKFNQUkxJTk9GRihwaXBlKSwgbGluZWFyX29mZnNldCk7CkBA
IC0xMDk5LDM5ICsxMDk5LDM5IEBAIGl2Yl91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSwKIAlJOTE1X1dSSVRFX0ZXKFNQUlNVUkYocGlwZSksCiAJCSAgICAgIGludGVsX3Bs
YW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSArIHNwcnN1cmZfb2Zmc2V0KTsKIAotCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCXNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiB9CiAK
IHN0YXRpYyB2b2lkCiBpdmJfZGlzYWJsZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
LAogCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2Uu
ZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwogCXVuc2lnbmVkIGxvbmcgaXJx
ZmxhZ3M7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFm
bGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7
CiAKIAlJOTE1X1dSSVRFX0ZXKFNQUkNUTChwaXBlKSwgMCk7CiAJLyogRGlzYWJsZSB0aGUgc2Nh
bGVyICovCi0JaWYgKElTX0lWWUJSSURHRShkZXZfcHJpdikpCisJaWYgKElTX0lWWUJSSURHRShp
OTE1KSkKIAkJSTkxNV9XUklURV9GVyhTUFJTQ0FMRShwaXBlKSwgMCk7CiAJSTkxNV9XUklURV9G
VyhTUFJTVVJGKHBpcGUpLCAwKTsKIAotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2
LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUt
PnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CiB9CiAKIHN0YXRpYyBib29sCiBpdmJfcGxhbmVfZ2V0
X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCSAgICAgICBlbnVtIHBpcGUg
KnBpcGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShw
bGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShwbGFuZS0+YmFzZS5kZXYpOwogCWVudW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gcG93
ZXJfZG9tYWluOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWJvb2wgcmV0OwogCiAJcG93
ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlOX1BJUEUocGxhbmUtPnBpcGUpOwotCXdha2VyZWYgPSBp
bnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21haW4p
OworCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsIHBv
d2VyX2RvbWFpbik7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTExMzks
NyArMTEzOSw3IEBAIGl2Yl9wbGFuZV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSwKIAogCSpwaXBlID0gcGxhbmUtPnBpcGU7CiAKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1
dChkZXZfcHJpdiwgcG93ZXJfZG9tYWluLCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2Vy
X3B1dChpOTE1LCBwb3dlcl9kb21haW4sIHdha2VyZWYpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAg
LTExNjgsNyArMTE2OCw3IEBAIHN0YXRpYyB1MzIgZzR4X3Nwcml0ZV9jdGxfY3J0Yyhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB1MzIgZzR4X3Nwcml0
ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7CiAJY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAl1bnNpZ25l
ZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKQEAgLTExNzcsNyAr
MTE3Nyw3IEBAIHN0YXRpYyB1MzIgZzR4X3Nwcml0ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIAlkdnNjbnRyID0gRFZTX0VOQUJMRTsKIAotCWlmIChJ
U19HRU4oZGV2X3ByaXYsIDYpKQorCWlmIChJU19HRU4oaTkxNSwgNikpCiAJCWR2c2NudHIgfD0g
RFZTX1RSSUNLTEVfRkVFRF9ESVNBQkxFOwogCiAJc3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQp
IHsKQEAgLTEyMjksNyArMTIyOSw3IEBAIGc0eF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKIAkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQkgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNl
LmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAl1MzIgZHZzc3VyZl9vZmZz
ZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0OwogCXUzMiBsaW5lYXJfb2Zm
c2V0OwpAQCAtMTI1OCw3ICsxMjU4LDcgQEAgZzR4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lLAogCiAJbGluZWFyX29mZnNldCA9IGludGVsX2ZiX3h5X3RvX2xpbmVhcih4
LCB5LCBwbGFuZV9zdGF0ZSwgMCk7CiAKLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVu
Y29yZS5sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPnVuY29yZS5s
b2NrLCBpcnFmbGFncyk7CiAKIAlJOTE1X1dSSVRFX0ZXKERWU1NUUklERShwaXBlKSwgcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lWzBdLnN0cmlkZSk7CiAJSTkxNV9XUklURV9GVyhEVlNQT1MocGlw
ZSksIChjcnRjX3kgPDwgMTYpIHwgY3J0Y194KTsKQEAgLTEyODMsMzggKzEyODMsMzggQEAgZzR4
X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCUk5MTVfV1JJVEVfRlco
RFZTU1VSRihwaXBlKSwKIAkJICAgICAgaW50ZWxfcGxhbmVfZ2d0dF9vZmZzZXQocGxhbmVfc3Rh
dGUpICsgZHZzc3VyZl9vZmZzZXQpOwogCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3By
aXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkx
NS0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKIH0KIAogc3RhdGljIHZvaWQKIGc0eF9kaXNhYmxl
X3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCSAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0g
cGxhbmUtPnBpcGU7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsKIAotCXNwaW5fbG9ja19pcnFz
YXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKwlzcGluX2xvY2tfaXJxc2F2
ZSgmaTkxNS0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKIAogCUk5MTVfV1JJVEVfRlcoRFZTQ05U
UihwaXBlKSwgMCk7CiAJLyogRGlzYWJsZSB0aGUgc2NhbGVyICovCiAJSTkxNV9XUklURV9GVyhE
VlNTQ0FMRShwaXBlKSwgMCk7CiAJSTkxNV9XUklURV9GVyhEVlNTVVJGKHBpcGUpLCAwKTsKIAot
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3Mp
OworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7
CiB9CiAKIHN0YXRpYyBib29sCiBnNHhfcGxhbmVfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUsCiAJCSAgICAgICBlbnVtIHBpcGUgKnBpcGUpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWVu
dW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gcG93ZXJfZG9tYWluOwogCWludGVsX3dha2Vy
ZWZfdCB3YWtlcmVmOwogCWJvb2wgcmV0OwogCiAJcG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlO
X1BJUEUocGxhbmUtPnBpcGUpOwotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9p
Zl9lbmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21haW4pOworCXdha2VyZWYgPSBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUsIHBvd2VyX2RvbWFpbik7CiAJaWYgKCF3YWtl
cmVmKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTEzMjIsNyArMTMyMiw3IEBAIGc0eF9wbGFuZV9n
ZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAogCSpwaXBlID0gcGxhbmUt
PnBpcGU7CiAKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgcG93ZXJfZG9tYWlu
LCB3YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBwb3dlcl9kb21haW4s
IHdha2VyZWYpOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTE0MDYsMTYgKzE0MDYsMTYgQEAgZzR4
X3Nwcml0ZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJIHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNl
LmRldik7CiAJaW50IG1pbl9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKIAlp
bnQgbWF4X3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOwogCWludCByZXQ7CiAK
IAlpZiAoaW50ZWxfZmJfc2NhbGFibGUocGxhbmVfc3RhdGUtPmJhc2UuZmIpKSB7Ci0JCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpIDwgNykgeworCQlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNykgewog
CQkJbWluX3NjYWxlID0gMTsKIAkJCW1heF9zY2FsZSA9IDE2IDw8IDE2OwotCQl9IGVsc2UgaWYg
KElTX0lWWUJSSURHRShkZXZfcHJpdikpIHsKKwkJfSBlbHNlIGlmIChJU19JVllCUklER0UoaTkx
NSkpIHsKIAkJCW1pbl9zY2FsZSA9IDE7CiAJCQltYXhfc2NhbGUgPSAyIDw8IDE2OwogCQl9CkBA
IC0xNDQzLDcgKzE0NDMsNyBAQCBnNHhfc3ByaXRlX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA3KQorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNykKIAkJcGxhbmVf
c3RhdGUtPmN0bCA9IGl2Yl9zcHJpdGVfY3RsKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKIAll
bHNlCiAJCXBsYW5lX3N0YXRlLT5jdGwgPSBnNHhfc3ByaXRlX2N0bChjcnRjX3N0YXRlLCBwbGFu
ZV9zdGF0ZSk7CkBAIC0xNDU0LDExICsxNDU0LDExIEBAIGc0eF9zcHJpdGVfY2hlY2soc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBpbnQgY2h2X3BsYW5lX2NoZWNrX3JvdGF0
aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNl
LnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBs
YW5lLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KHBsYW5lLT5iYXNlLmRldik7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUt
PmJhc2Uucm90YXRpb247CiAKIAkvKiBDSFYgaWdub3JlcyB0aGUgbWlycm9yIGJpdCB3aGVuIHRo
ZSByb3RhdGUgYml0IGlzIHNldCA6KCAqLwotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSAm
JgorCWlmIChJU19DSEVSUllWSUVXKGk5MTUpICYmCiAJICAgIHJvdGF0aW9uICYgRFJNX01PREVf
Uk9UQVRFXzE4MCAmJgogCSAgICByb3RhdGlvbiAmIERSTV9NT0RFX1JFRkxFQ1RfWCkgewogCQlE
Uk1fREVCVUdfS01TKCJDYW5ub3Qgcm90YXRlIGFuZCByZWZsZWN0IGF0IHRoZSBzYW1lIHRpbWVc
biIpOwpAQCAtMTUwNiw3ICsxNTA2LDcgQEAgc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfZmIo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+
YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uu
cm90YXRpb247CiAJc3RydWN0IGRybV9mb3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7CkBAIC0x
NTQwLDcgKzE1NDAsNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJICovCiAJCXN3aXRjaCAoZmItPmZv
cm1hdC0+Zm9ybWF0KSB7CiAJCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0JCQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMSkKKwkJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpCiAJCQkJ
YnJlYWs7CiAJCQkvKiBmYWxsIHRocm91Z2ggKi8KIAkJY2FzZSBEUk1fRk9STUFUX0M4OgpAQCAt
MTU3OSw3ICsxNTc5LDcgQEAgc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfZmIoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgaW50IHNrbF9wbGFuZV9j
aGVja19kc3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUt
PmRldik7CiAJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC54MTsKIAlpbnQgY3J0
Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7CkBAIC0xNTk0LDcg
KzE1OTQsNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19kc3RfY29vcmRpbmF0ZXMoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfcwogCSAqIHRoYW4gdGhlIGN1cnNvciBl
bmRpbmcgbGVzcyB0aGFuIDQgcGl4ZWxzIGZyb20gdGhlIGxlZnQgZWRnZSBvZiB0aGUKIAkgKiBz
Y3JlZW4gbWF5IGNhdXNlIEZJRk8gdW5kZXJmbG93IGFuZCBkaXNwbGF5IGNvcnJ1cHRpb24uCiAJ
ICovCi0JaWYgKChJU19HRU1JTklMQUtFKGRldl9wcml2KSB8fCBJU19DQU5OT05MQUtFKGRldl9w
cml2KSkgJiYKKwlpZiAoKElTX0dFTUlOSUxBS0UoaTkxNSkgfHwgSVNfQ0FOTk9OTEFLRShpOTE1
KSkgJiYKIAkgICAgKGNydGNfeCArIGNydGNfdyA8IDQgfHwgY3J0Y194ID4gcGlwZV9zcmNfdyAt
IDQpKSB7CiAJCURSTV9ERUJVR19LTVMoInJlcXVlc3RlZCBwbGFuZSBYICVzIHBvc2l0aW9uICVk
IGludmFsaWQgKHZhbGlkIHJhbmdlICVkLSVkKVxuIiwKIAkJCSAgICAgIGNydGNfeCArIGNydGNf
dyA8IDQgPyAiZW5kIiA6ICJzdGFydCIsCkBAIC0xNjI3LDcgKzE2MjcsNyBAQCBzdGF0aWMgaW50
IHNrbF9wbGFuZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
CSAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5l
KTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5l
LT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+YmFzZS5mYjsKIAlpbnQgbWluX3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FM
SU5HOwogCWludCBtYXhfc2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkc7CkBAIC0x
Njc1LDIzICsxNjc1LDIzIEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJcGxhbmVfc3RhdGUtPmN0bCA9IHNrbF9wbGFu
ZV9jdGwoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElOVEVMX0dFTihpOTE1
KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGk5MTUpKQogCQlwbGFuZV9zdGF0ZS0+Y29sb3JfY3Rs
ID0gZ2xrX3BsYW5lX2NvbG9yX2N0bChjcnRjX3N0YXRlLAogCQkJCQkJCSAgICAgcGxhbmVfc3Rh
dGUpOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBib29sIGhhc19kc3Rfa2V5X2luX3ByaW1h
cnlfcGxhbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGJvb2wg
aGFzX2RzdF9rZXlfaW5fcHJpbWFyeV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKLQlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSA5OworCXJldHVybiBJTlRFTF9H
RU4oaTkxNSkgPj0gOTsKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfc2V0X2NrZXkoc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCQkgY29uc3Qgc3RydWN0IGRy
bV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKnNldCkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsK
IAlzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5j
a2V5OwogCiAJKmtleSA9ICpzZXQ7CkBAIC0xNzA4LDcgKzE3MDgsNyBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9wbGFuZV9zZXRfY2tleShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
LAogCSAqIE9uIFNLTCsgd2Ugd2FudCBkc3Qga2V5IGVuYWJsZWQgb24KIAkgKiB0aGUgcHJpbWFy
eSBhbmQgbm90IG9uIHRoZSBzcHJpdGUuCiAJICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gOSAmJiBwbGFuZS0+aWQgIT0gUExBTkVfUFJJTUFSWSAmJgorCWlmIChJTlRFTF9HRU4oaTkx
NSkgPj0gOSAmJiBwbGFuZS0+aWQgIT0gUExBTkVfUFJJTUFSWSAmJgogCSAgICBzZXQtPmZsYWdz
ICYgSTkxNV9TRVRfQ09MT1JLRVlfREVTVElOQVRJT04pCiAJCWtleS0+ZmxhZ3MgPSAwOwogfQpA
QCAtMTcxNiw3ICsxNzE2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfc2V0X2NrZXkoc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIGludCBpbnRlbF9zcHJpdGVfc2V0
X2NvbG9ya2V5X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkJ
ICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAq
c2V0ID0gZGF0YTsKIAlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZTsKIAlzdHJ1Y3QgZHJtX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZTsKQEAgLTE3MzQsNyArMTczNCw3IEBAIGludCBpbnRlbF9zcHJp
dGVfc2V0X2NvbG9ya2V5X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEs
CiAJaWYgKChzZXQtPmZsYWdzICYgKEk5MTVfU0VUX0NPTE9SS0VZX0RFU1RJTkFUSU9OIHwgSTkx
NV9TRVRfQ09MT1JLRVlfU09VUkNFKSkgPT0gKEk5MTVfU0VUX0NPTE9SS0VZX0RFU1RJTkFUSU9O
IHwgSTkxNV9TRVRfQ09MT1JLRVlfU09VUkNFKSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlpZiAo
KElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSAmJgor
CWlmICgoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSAmJgogCSAg
ICBzZXQtPmZsYWdzICYgSTkxNV9TRVRfQ09MT1JLRVlfREVTVElOQVRJT04pCiAJCXJldHVybiAt
RUlOVkFMOwogCkBAIC0xNzQ3LDcgKzE3NDcsNyBAQCBpbnQgaW50ZWxfc3ByaXRlX3NldF9jb2xv
cmtleV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCSAqIEFsc28g
bXVsdGlwbGUgcGxhbmVzIGNhbid0IGRvIGRlc3RpbmF0aW9uIGtleWluZyBvbiB0aGUgc2FtZQog
CSAqIHBpcGUgc2ltdWx0YW5lb3VzbHkuCiAJICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gOSAmJgorCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOSAmJgogCSAgICB0b19pbnRlbF9wbGFu
ZShwbGFuZSktPmlkID49IFBMQU5FX1NQUklURTEgJiYKIAkgICAgc2V0LT5mbGFncyAmIEk5MTVf
U0VUX0NPTE9SS0VZX0RFU1RJTkFUSU9OKQogCQlyZXR1cm4gLUVJTlZBTDsKQEAgLTE3NzEsOSAr
MTc3MSw5IEBAIGludCBpbnRlbF9zcHJpdGVfc2V0X2NvbG9ya2V5X2lvY3RsKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCSAqIE9uIHNvbWUgcGxhdGZvcm1zIHdlIGhhdmUg
dG8gY29uZmlndXJlCiAJCSAqIHRoZSBkc3QgY29sb3JrZXkgb24gdGhlIHByaW1hcnkgcGxhbmUu
CiAJCSAqLwotCQlpZiAoIXJldCAmJiBoYXNfZHN0X2tleV9pbl9wcmltYXJ5X3BsYW5lKGRldl9w
cml2KSkgeworCQlpZiAoIXJldCAmJiBoYXNfZHN0X2tleV9pbl9wcmltYXJ5X3BsYW5lKGk5MTUp
KSB7CiAJCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9Ci0JCQkJaW50ZWxfZ2V0X2NydGNfZm9y
X3BpcGUoZGV2X3ByaXYsCisJCQkJaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoaTkxNSwKIAkJCQkJ
CQl0b19pbnRlbF9wbGFuZShwbGFuZSktPnBpcGUpOwogCiAJCQlwbGFuZV9zdGF0ZSA9IGRybV9h
dG9taWNfZ2V0X3BsYW5lX3N0YXRlKHN0YXRlLApAQCAtMjE5NywyNiArMjE5NywyNiBAQCBzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBza2xfcGxhbmVfZnVuY3MgPSB7CiAJLmZv
cm1hdF9tb2Rfc3VwcG9ydGVkID0gc2tsX3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkLAogfTsK
IAotc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19mYmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19mYmMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCkKIHsKLQlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQorCWlmICghSEFTX0ZCQyhpOTE1
KSkKIAkJcmV0dXJuIGZhbHNlOwogCiAJcmV0dXJuIHBpcGUgPT0gUElQRV9BICYmIHBsYW5lX2lk
ID09IFBMQU5FX1BSSU1BUlk7CiB9CiAKLXN0YXRpYyBib29sIHNrbF9wbGFuZV9oYXNfcGxhbmFy
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyBib29sIHNrbF9wbGFu
ZV9oYXNfcGxhbmFyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSBlbnVtIHBp
cGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKIHsKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQogCQlyZXR1cm4gcGxhbmVf
aWQgPD0gUExBTkVfU1BSSVRFMzsKIAogCS8qIERpc3BsYXkgV0EgIzA4NzA6IHNrbCwgYnh0ICov
Ci0JaWYgKElTX1NLWUxBS0UoZGV2X3ByaXYpIHx8IElTX0JST1hUT04oZGV2X3ByaXYpKQorCWlm
IChJU19TS1lMQUtFKGk5MTUpIHx8IElTX0JST1hUT04oaTkxNSkpCiAJCXJldHVybiBmYWxzZTsK
IAotCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmICFJU19HRU1JTklMQUtFKGRldl9wcml2KSAm
JiBwaXBlID09IFBJUEVfQykKKwlpZiAoSVNfR0VOKGk5MTUsIDkpICYmICFJU19HRU1JTklMQUtF
KGk5MTUpICYmIHBpcGUgPT0gUElQRV9DKQogCQlyZXR1cm4gZmFsc2U7CiAKIAlpZiAocGxhbmVf
aWQgIT0gUExBTkVfUFJJTUFSWSAmJiBwbGFuZV9pZCAhPSBQTEFORV9TUFJJVEUwKQpAQCAtMjIy
NSwxNiArMjIyNSwxNiBAQCBzdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX3BsYW5hcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmV0dXJuIHRydWU7CiB9CiAKLXN0YXRpYyBi
b29sIHNrbF9wbGFuZV9oYXNfY2NzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K3N0YXRpYyBib29sIHNrbF9wbGFuZV9oYXNfY2NzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJICAgICAgZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQpCiB7
CiAJaWYgKHBsYW5lX2lkID09IFBMQU5FX0NVUlNPUikKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMCkK
IAkJcmV0dXJuIHRydWU7CiAKLQlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElT
X0dFTUlOSUxBS0UoaTkxNSkpCiAJCXJldHVybiBwaXBlICE9IFBJUEVfQzsKIAogCXJldHVybiBw
aXBlICE9IFBJUEVfQyAmJgpAQCAtMjI0Myw3ICsyMjQzLDcgQEAgc3RhdGljIGJvb2wgc2tsX3Bs
YW5lX2hhc19jY3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogfQogCiBzdHJ1
Y3QgaW50ZWxfcGxhbmUgKgotc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFu
ZV9pZCBwbGFuZV9pZCkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwpAQCAtMjI2Myw5
ICsyMjYzLDkgQEAgc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCXBsYW5lLT5pZCA9IHBsYW5lX2lkOwogCXBsYW5lLT5mcm9udGJ1
ZmZlcl9iaXQgPSBJTlRFTF9GUk9OVEJVRkZFUihwaXBlLCBwbGFuZV9pZCk7CiAKLQlwbGFuZS0+
aGFzX2ZiYyA9IHNrbF9wbGFuZV9oYXNfZmJjKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCk7CisJ
cGxhbmUtPmhhc19mYmMgPSBza2xfcGxhbmVfaGFzX2ZiYyhpOTE1LCBwaXBlLCBwbGFuZV9pZCk7
CiAJaWYgKHBsYW5lLT5oYXNfZmJjKSB7Ci0JCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZf
cHJpdi0+ZmJjOworCQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmaTkxNS0+ZmJjOwogCiAJCWZi
Yy0+cG9zc2libGVfZnJhbWVidWZmZXJfYml0cyB8PSBwbGFuZS0+ZnJvbnRidWZmZXJfYml0Owog
CX0KQEAgLTIyNzgsMjQgKzIyNzgsMjQgQEAgc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlmIChpY2xfaXNfbnYxMl95X3BsYW5l
KHBsYW5lX2lkKSkKIAkJcGxhbmUtPnVwZGF0ZV9zbGF2ZSA9IGljbF91cGRhdGVfc2xhdmU7CiAK
LQlpZiAoc2tsX3BsYW5lX2hhc19wbGFuYXIoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKSkgewot
CQlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7CisJaWYgKHNrbF9w
bGFuZV9oYXNfcGxhbmFyKGk5MTUsIHBpcGUsIHBsYW5lX2lkKSkgeworCQlpZiAoaWNsX2lzX2hk
cl9wbGFuZShpOTE1LCBwbGFuZV9pZCkpIHsKIAkJCWZvcm1hdHMgPSBpY2xfaGRyX3BsYW5hcl9m
b3JtYXRzOwogCQkJbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKGljbF9oZHJfcGxhbmFyX2Zvcm1h
dHMpOwotCQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwkJfSBlbHNl
IGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHsKIAkJCWZvcm1hdHMgPSBpY2xfcGxhbmFyX2Zv
cm1hdHM7CiAJCQludW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoaWNsX3BsYW5hcl9mb3JtYXRzKTsK
LQkJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDEwIHx8IElTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpKSB7CisJCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID09IDEwIHx8IElTX0dF
TUlOSUxBS0UoaTkxNSkpIHsKIAkJCWZvcm1hdHMgPSBnbGtfcGxhbmFyX2Zvcm1hdHM7CiAJCQlu
dW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoZ2xrX3BsYW5hcl9mb3JtYXRzKTsKIAkJfSBlbHNlIHsK
IAkJCWZvcm1hdHMgPSBza2xfcGxhbmFyX2Zvcm1hdHM7CiAJCQludW1fZm9ybWF0cyA9IEFSUkFZ
X1NJWkUoc2tsX3BsYW5hcl9mb3JtYXRzKTsKIAkJfQotCX0gZWxzZSBpZiAoaWNsX2lzX2hkcl9w
bGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7CisJfSBlbHNlIGlmIChpY2xfaXNfaGRyX3BsYW5l
KGk5MTUsIHBsYW5lX2lkKSkgewogCQlmb3JtYXRzID0gaWNsX2hkcl9wbGFuZV9mb3JtYXRzOwog
CQludW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoaWNsX2hkcl9wbGFuZV9mb3JtYXRzKTsKLQl9IGVs
c2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwl9IGVsc2UgaWYgKElOVEVMX0dF
TihpOTE1KSA+PSAxMSkgewogCQlmb3JtYXRzID0gaWNsX3BsYW5lX2Zvcm1hdHM7CiAJCW51bV9m
b3JtYXRzID0gQVJSQVlfU0laRShpY2xfcGxhbmVfZm9ybWF0cyk7CiAJfSBlbHNlIHsKQEAgLTIz
MDMsNyArMjMwMyw3IEBAIHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkJbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKHNrbF9wbGFu
ZV9mb3JtYXRzKTsKIAl9CiAKLQlwbGFuZS0+aGFzX2NjcyA9IHNrbF9wbGFuZV9oYXNfY2NzKGRl
dl9wcml2LCBwaXBlLCBwbGFuZV9pZCk7CisJcGxhbmUtPmhhc19jY3MgPSBza2xfcGxhbmVfaGFz
X2NjcyhpOTE1LCBwaXBlLCBwbGFuZV9pZCk7CiAJaWYgKHBsYW5lLT5oYXNfY2NzKQogCQltb2Rp
ZmllcnMgPSBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3M7CiAJZWxzZQpAQCAtMjMxNiw3
ICsyMzE2LDcgQEAgc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCiAJcG9zc2libGVfY3J0Y3MgPSBCSVQocGlwZSk7CiAKLQlyZXQg
PSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoJmRldl9wcml2LT5kcm0sICZwbGFuZS0+YmFzZSwK
KwlyZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoJmk5MTUtPmRybSwgJnBsYW5lLT5iYXNl
LAogCQkJCSAgICAgICBwb3NzaWJsZV9jcnRjcywgJnNrbF9wbGFuZV9mdW5jcywKIAkJCQkgICAg
ICAgZm9ybWF0cywgbnVtX2Zvcm1hdHMsIG1vZGlmaWVycywKIAkJCQkgICAgICAgcGxhbmVfdHlw
ZSwKQEAgLTIzMjksNyArMjMyOSw3IEBAIHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJRFJNX01PREVfUk9UQVRFXzAgfCBEUk1f
TU9ERV9ST1RBVEVfOTAgfAogCQlEUk1fTU9ERV9ST1RBVEVfMTgwIHwgRFJNX01PREVfUk9UQVRF
XzI3MDsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQorCWlmIChJTlRFTF9HRU4o
aTkxNSkgPj0gMTApCiAJCXN1cHBvcnRlZF9yb3RhdGlvbnMgfD0gRFJNX01PREVfUkVGTEVDVF9Y
OwogCiAJZHJtX3BsYW5lX2NyZWF0ZV9yb3RhdGlvbl9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UsCkBA
IC0yMzYxLDcgKzIzNjEsNyBAQCBza2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAKIHN0cnVjdCBpbnRlbF9wbGFuZSAqCi1pbnRl
bF9zcHJpdGVfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
K2ludGVsX3Nwcml0ZV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkgIGVudW0gcGlwZSBwaXBlLCBpbnQgc3ByaXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmU7CkBAIC0yMzczLDE1ICsyMzczLDE1IEBAIGludGVsX3Nwcml0ZV9wbGFuZV9jcmVh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWludCBudW1fZm9ybWF0czsK
IAlpbnQgcmV0OwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKLQkJcmV0dXJuIHNr
bF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlLAorCWlmIChJTlRFTF9HRU4o
aTkxNSkgPj0gOSkKKwkJcmV0dXJuIHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKGk5MTUsIHBp
cGUsCiAJCQkJCQkgIFBMQU5FX1NQUklURTAgKyBzcHJpdGUpOwogCiAJcGxhbmUgPSBpbnRlbF9w
bGFuZV9hbGxvYygpOwogCWlmIChJU19FUlIocGxhbmUpKQogCQlyZXR1cm4gcGxhbmU7CiAKLQlp
ZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsK
KwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSB7CiAJCXBs
YW5lLT5tYXhfc3RyaWRlID0gaTl4eF9wbGFuZV9tYXhfc3RyaWRlOwogCQlwbGFuZS0+dXBkYXRl
X3BsYW5lID0gdmx2X3VwZGF0ZV9wbGFuZTsKIAkJcGxhbmUtPmRpc2FibGVfcGxhbmUgPSB2bHZf
ZGlzYWJsZV9wbGFuZTsKQEAgLTIzOTMsNyArMjM5Myw3IEBAIGludGVsX3Nwcml0ZV9wbGFuZV9j
cmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQltb2RpZmllcnMgPSBp
OXh4X3BsYW5lX2Zvcm1hdF9tb2RpZmllcnM7CiAKIAkJcGxhbmVfZnVuY3MgPSAmdmx2X3Nwcml0
ZV9mdW5jczsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNykgeworCX0gZWxz
ZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDcpIHsKIAkJcGxhbmUtPm1heF9zdHJpZGUgPSBnNHhf
c3ByaXRlX21heF9zdHJpZGU7CiAJCXBsYW5lLT51cGRhdGVfcGxhbmUgPSBpdmJfdXBkYXRlX3Bs
YW5lOwogCQlwbGFuZS0+ZGlzYWJsZV9wbGFuZSA9IGl2Yl9kaXNhYmxlX3BsYW5lOwpAQCAtMjQx
Myw3ICsyNDEzLDcgQEAgaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXBsYW5lLT5jaGVja19wbGFuZSA9IGc0eF9zcHJpdGVfY2hl
Y2s7CiAKIAkJbW9kaWZpZXJzID0gaTl4eF9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzOwotCQlpZiAo
SVNfR0VOKGRldl9wcml2LCA2KSkgeworCQlpZiAoSVNfR0VOKGk5MTUsIDYpKSB7CiAJCQlmb3Jt
YXRzID0gc25iX3BsYW5lX2Zvcm1hdHM7CiAJCQludW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoc25i
X3BsYW5lX2Zvcm1hdHMpOwogCkBAIC0yNDI2LDcgKzI0MjYsNyBAQCBpbnRlbF9zcHJpdGVfcGxh
bmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJfQogCX0KIAot
CWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSAmJiBwaXBlID09IFBJUEVfQikgeworCWlmIChJ
U19DSEVSUllWSUVXKGk5MTUpICYmIHBpcGUgPT0gUElQRV9CKSB7CiAJCXN1cHBvcnRlZF9yb3Rh
dGlvbnMgPQogCQkJRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfMTgwIHwKIAkJ
CURSTV9NT0RFX1JFRkxFQ1RfWDsKQEAgLTI0NDEsNyArMjQ0MSw3IEBAIGludGVsX3Nwcml0ZV9w
bGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJcG9zc2li
bGVfY3J0Y3MgPSBCSVQocGlwZSk7CiAKLQlyZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQo
JmRldl9wcml2LT5kcm0sICZwbGFuZS0+YmFzZSwKKwlyZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5l
X2luaXQoJmk5MTUtPmRybSwgJnBsYW5lLT5iYXNlLAogCQkJCSAgICAgICBwb3NzaWJsZV9jcnRj
cywgcGxhbmVfZnVuY3MsCiAJCQkJICAgICAgIGZvcm1hdHMsIG51bV9mb3JtYXRzLCBtb2RpZmll
cnMsCiAJCQkJICAgICAgIERSTV9QTEFORV9UWVBFX09WRVJMQVksCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9zcHJpdGUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3Nwcml0ZS5oCmluZGV4IDUwMGY2YmZmYjEzOS4uNDAxMjk1ZTA1MTE2IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9zcHJpdGUuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9zcHJpdGUuaApAQCAtMjEsNyArMjEsNyBAQCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGU7CiBib29sIGlzX3BsYW5hcl95dXZfZm9ybWF0KHUzMiBwaXhlbGZvcm1hdCk7CiBp
bnQgaW50ZWxfdXNlY3NfdG9fc2NhbmxpbmVzKGNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlLAogCQkJICAgICBpbnQgdXNlY3MpOwotc3RydWN0IGludGVsX3BsYW5l
ICppbnRlbF9zcHJpdGVfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICAgICAgZW51bSBwaXBlIHBpcGUsIGlu
dCBwbGFuZSk7CiBpbnQgaW50ZWxfc3ByaXRlX3NldF9jb2xvcmtleV9pb2N0bChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQkJCSAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVf
cHJpdik7CkBAIC0zMSw3ICszMSw3IEBAIGludCBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUoY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiBpbnQgaW50ZWxfcGxh
bmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpOwogaW50IGNodl9wbGFuZV9jaGVja19yb3RhdGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKIHN0cnVjdCBpbnRlbF9wbGFuZSAqCi1za2xfdW5p
dmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
a2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgIGVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKTsKIAogc3RhdGlj
IGlubGluZSBib29sIGljbF9pc19udjEyX3lfcGxhbmUoZW51bSBwbGFuZV9pZCBpZCkKQEAgLTQ5
LDEwICs0OSwxMCBAQCBzdGF0aWMgaW5saW5lIHU4IGljbF9oZHJfcGxhbmVfbWFzayh2b2lkKQog
CQlCSVQoUExBTkVfU1BSSVRFMCkgfCBCSVQoUExBTkVfU1BSSVRFMSk7CiB9CiAKLXN0YXRpYyBp
bmxpbmUgYm9vbCBpY2xfaXNfaGRyX3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3N0YXRpYyBpbmxpbmUgYm9vbCBpY2xfaXNfaGRyX3BsYW5lKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJCSAgICBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQogewotCXJl
dHVybiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCisJcmV0dXJuIElOVEVMX0dFTihpOTE1
KSA+PSAxMSAmJgogCQlpY2xfaGRyX3BsYW5lX21hc2soKSAmIEJJVChwbGFuZV9pZCk7CiB9CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3R2LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF90di5jCmluZGV4IDVkYzU5NGVhZmFmMi4uNGU2NjI2MWJmNWFmIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF90di5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3R2LmMKQEAgLTkwNiw3ICs5MDYsNyBAQCBzdGF0aWMgc3RydWN0
IGludGVsX3R2ICppbnRlbF9hdHRhY2hlZF90dihzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVj
dG9yKQogc3RhdGljIGJvb2wKIGludGVsX3R2X2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwgZW51bSBwaXBlICpwaXBlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIHRt
cCA9IEk5MTVfUkVBRChUVl9DVEwpOwogCiAJKnBpcGUgPSAodG1wICYgVFZfRU5DX1BJUEVfU0VM
X01BU0spID4+IFRWX0VOQ19QSVBFX1NFTF9TSElGVDsKQEAgLTkyMCwxMCArOTIwLDEwIEBAIGlu
dGVsX2VuYWJsZV90dihzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJY29uc3Qgc3Ry
dWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9kZXZp
Y2UgKmRldiA9IGVuY29kZXItPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoZGV2KTsKIAogCS8qIFByZXZlbnRzIHZibGFuayB3YWl0cyBmcm9tIHRpbWluZyBv
dXQgaW4gaW50ZWxfdHZfZGV0ZWN0X3R5cGUoKSAqLwotCWludGVsX3dhaXRfZm9yX3ZibGFuayhk
ZXZfcHJpdiwKKwlpbnRlbF93YWl0X2Zvcl92YmxhbmsoaTkxNSwKIAkJCSAgICAgIHRvX2ludGVs
X2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0YyktPnBpcGUpOwogCiAJSTkxNV9XUklURShUVl9D
VEwsIEk5MTVfUkVBRChUVl9DVEwpIHwgVFZfRU5DX0VOQUJMRSk7CkBAIC05MzUsNyArOTM1LDcg
QEAgaW50ZWxfZGlzYWJsZV90dihzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJIGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSkKIHsKIAlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gZW5jb2Rlci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCiAJSTkxNV9XUklURShUVl9DVEwsIEk5MTVfUkVB
RChUVl9DVEwpICYgflRWX0VOQ19FTkFCTEUpOwogfQpAQCAtMTA4NCw3ICsxMDg0LDcgQEAgc3Rh
dGljIHZvaWQKIGludGVsX3R2X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJCSZw
aXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
IG1vZGUgPSB7fTsKQEAgLTExNTgsMTUgKzExNTgsMTUgQEAgaW50ZWxfdHZfZ2V0X2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9j
ayAvPSAyOwogCiAJLyogcGl4ZWwgY291bnRlciBkb2Vzbid0IHdvcmsgb24gaTk2NWdtIFRWIG91
dHB1dCAqLwotCWlmIChJU19JOTY1R00oZGV2X3ByaXYpKQorCWlmIChJU19JOTY1R00oaTkxNSkp
CiAJCWFkanVzdGVkX21vZGUtPnByaXZhdGVfZmxhZ3MgfD0KIAkJCUk5MTVfTU9ERV9GTEFHX1VT
RV9TQ0FOTElORV9DT1VOVEVSOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF90dl9zb3VyY2VfdG9v
X3dpZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGJvb2wgaW50
ZWxfdHZfc291cmNlX3Rvb193aWRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
CSAgICAgaW50IGhkaXNwbGF5KQogewotCXJldHVybiBJU19HRU4oZGV2X3ByaXYsIDMpICYmIGhk
aXNwbGF5ID4gMTAyNDsKKwlyZXR1cm4gSVNfR0VOKGk5MTUsIDMpICYmIGhkaXNwbGF5ID4gMTAy
NDsKIH0KIAogc3RhdGljIGJvb2wgaW50ZWxfdHZfdmVydF9zY2FsaW5nKGNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICp0dl9tb2RlLApAQCAtMTE4NCw3ICsxMTg0LDcgQEAgaW50ZWxfdHZf
Y29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9z
dGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF90dl9jb25u
ZWN0b3Jfc3RhdGUgKnR2X2Nvbm5fc3RhdGUgPQogCQl0b19pbnRlbF90dl9jb25uZWN0b3Jfc3Rh
dGUoY29ubl9zdGF0ZSk7CiAJY29uc3Qgc3RydWN0IHR2X21vZGUgKnR2X21vZGUgPSBpbnRlbF90
dl9tb2RlX2ZpbmQoY29ubl9zdGF0ZSk7CkBAIC0xMjA5LDcgKzEyMDksNyBAQCBpbnRlbF90dl9j
b21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlpbnRlbF90dl9t
b2RlX3RvX21vZGUoYWRqdXN0ZWRfbW9kZSwgdHZfbW9kZSk7CiAJZHJtX21vZGVfc2V0X2NydGNp
bmZvKGFkanVzdGVkX21vZGUsIDApOwogCi0JaWYgKGludGVsX3R2X3NvdXJjZV90b29fd2lkZShk
ZXZfcHJpdiwgaGRpc3BsYXkpIHx8CisJaWYgKGludGVsX3R2X3NvdXJjZV90b29fd2lkZShpOTE1
LCBoZGlzcGxheSkgfHwKIAkgICAgIWludGVsX3R2X3ZlcnRfc2NhbGluZyhhZGp1c3RlZF9tb2Rl
LCBjb25uX3N0YXRlLCB2ZGlzcGxheSkpIHsKIAkJaW50IGV4dHJhLCB0b3AsIGJvdHRvbTsKIApA
QCAtMTMwNiw3ICsxMzA2LDcgQEAgaW50ZWxfdHZfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJICogdGhlIGFjdGl2ZSBwb3J0aW9uLiBIZW5jZSBmb2xsb3dp
bmcgdGhpcyBmb3JtdWxhIHNlZW1zCiAJICogbW9yZSB0cm91YmxlIHRoYXQgaXQncyB3b3J0aC4K
IAkgKgotCSAqIGlmIChJU19HRU4oZGV2X3ByaXYsIDQpKSB7CisJICogaWYgKElTX0dFTihpOTE1
LCA0KSkgewogCSAqCW51bSA9IGNkY2xrICogKHR2X21vZGUtPm92ZXJzYW1wbGUgPj4gIXR2X21v
ZGUtPnByb2dyZXNzaXZlKTsKIAkgKglkZW4gPSB0dl9tb2RlLT5jbG9jazsKIAkgKiB9IGVsc2Ug
ewpAQCAtMTMyNyw3ICsxMzI3LDcgQEAgaW50ZWxfdHZfY29tcHV0ZV9jb25maWcoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJYWRqdXN0ZWRfbW9kZS0+bmFtZVswXSA9ICdcMCc7CiAK
IAkvKiBwaXhlbCBjb3VudGVyIGRvZXNuJ3Qgd29yayBvbiBpOTY1Z20gVFYgb3V0cHV0ICovCi0J
aWYgKElTX0k5NjVHTShkZXZfcHJpdikpCisJaWYgKElTX0k5NjVHTShpOTE1KSkKIAkJYWRqdXN0
ZWRfbW9kZS0+cHJpdmF0ZV9mbGFncyB8PQogCQkJSTkxNV9NT0RFX0ZMQUdfVVNFX1NDQU5MSU5F
X0NPVU5URVI7CiAKQEAgLTEzMzUsNyArMTMzNSw3IEBAIGludGVsX3R2X2NvbXB1dGVfY29uZmln
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogfQogCiBzdGF0aWMgdm9pZAotc2V0X3R2
X21vZGVfdGltaW5ncyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzZXRfdHZf
bW9kZV90aW1pbmdzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgY29uc3Qg
c3RydWN0IHR2X21vZGUgKnR2X21vZGUsCiAJCSAgICBib29sIGJ1cnN0X2VuYSkKIHsKQEAgLTEz
OTMsNyArMTM5Myw3IEBAIHNldF90dl9tb2RlX3RpbWluZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoVFZfVl9DVExfNywgdmN0bDcpOwogfQogCi1zdGF0
aWMgdm9pZCBzZXRfY29sb3JfY29udmVyc2lvbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBzZXRfY29sb3JfY29udmVyc2lvbihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQkgY29uc3Qgc3RydWN0IGNvbG9yX2NvbnZlcnNpb24gKmNvbG9y
X2NvbnZlcnNpb24pCiB7CiAJaWYgKCFjb2xvcl9jb252ZXJzaW9uKQpAQCAtMTQxNyw3ICsxNDE3
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdHZfcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25m
aWcsCiAJCQkJY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVs
X2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CiAJc3RydWN0IGludGVsX3R2ICppbnRlbF90
diA9IGVuY190b190dihlbmNvZGVyKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfdHZfY29ubmVjdG9y
X3N0YXRlICp0dl9jb25uX3N0YXRlID0KQEAgLTE1MDcsMTggKzE1MDcsMTggQEAgc3RhdGljIHZv
aWQgaW50ZWxfdHZfcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJ
dHZfbW9kZS0+ZGRhM19pbmMgPDwgVFZfU0NEREEzX0lOQ19TSElGVDsKIAogCS8qIEVuYWJsZSB0
d28gZml4ZXMgZm9yIHRoZSBjaGlwcyB0aGF0IG5lZWQgdGhlbS4gKi8KLQlpZiAoSVNfSTkxNUdN
KGRldl9wcml2KSkKKwlpZiAoSVNfSTkxNUdNKGk5MTUpKQogCQl0dl9jdGwgfD0gVFZfRU5DX0Mw
X0ZJWCB8IFRWX0VOQ19TRFBfRklYOwogCi0Jc2V0X3R2X21vZGVfdGltaW5ncyhkZXZfcHJpdiwg
dHZfbW9kZSwgYnVyc3RfZW5hKTsKKwlzZXRfdHZfbW9kZV90aW1pbmdzKGk5MTUsIHR2X21vZGUs
IGJ1cnN0X2VuYSk7CiAKIAlJOTE1X1dSSVRFKFRWX1NDX0NUTF8xLCBzY2N0bDEpOwogCUk5MTVf
V1JJVEUoVFZfU0NfQ1RMXzIsIHNjY3RsMik7CiAJSTkxNV9XUklURShUVl9TQ19DVExfMywgc2Nj
dGwzKTsKIAotCXNldF9jb2xvcl9jb252ZXJzaW9uKGRldl9wcml2LCBjb2xvcl9jb252ZXJzaW9u
KTsKKwlzZXRfY29sb3JfY29udmVyc2lvbihpOTE1LCBjb2xvcl9jb252ZXJzaW9uKTsKIAotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpCisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KQog
CQlJOTE1X1dSSVRFKFRWX0NMUl9LTk9CUywgMHgwMDQwNDAwMCk7CiAJZWxzZQogCQlJOTE1X1dS
SVRFKFRWX0NMUl9LTk9CUywgMHgwMDYwNjAwMCk7CkBAIC0xNTI4LDcgKzE1MjgsNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF90dl9wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJICAgKCh2aWRlb19sZXZlbHMtPmJsYWNrIDw8IFRWX0JMQUNLX0xFVkVMX1NISUZUKSB8
CiAJCQkgICAgKHZpZGVvX2xldmVscy0+YmxhbmsgPDwgVFZfQkxBTktfTEVWRUxfU0hJRlQpKSk7
CiAKLQlhc3NlcnRfcGlwZV9kaXNhYmxlZChkZXZfcHJpdiwgaW50ZWxfY3J0Yy0+cGlwZSk7CisJ
YXNzZXJ0X3BpcGVfZGlzYWJsZWQoaTkxNSwgaW50ZWxfY3J0Yy0+cGlwZSk7CiAKIAkvKiBGaWx0
ZXIgY3RsIG11c3QgYmUgc2V0IGJlZm9yZSBUVl9XSU5fU0laRSAqLwogCXR2X2ZpbHRlcl9jdGwg
PSBUVl9BVVRPX1NDQUxFOwpAQCAtMTU2OCwxOCArMTU2OCwxOCBAQCBpbnRlbF90dl9kZXRlY3Rf
dHlwZShzdHJ1Y3QgaW50ZWxfdHYgKmludGVsX3R2LAogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9
IGNvbm5lY3Rvci0+c3RhdGUtPmNydGM7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMg
PSB0b19pbnRlbF9jcnRjKGNydGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjb25uZWN0
b3ItPmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJdTMy
IHR2X2N0bCwgc2F2ZV90dl9jdGw7CiAJdTMyIHR2X2RhYywgc2F2ZV90dl9kYWM7CiAJaW50IHR5
cGU7CiAKIAkvKiBEaXNhYmxlIFRWIGludGVycnVwdHMgYXJvdW5kIGxvYWQgZGV0ZWN0IG9yIHdl
J2xsIHJlY3Vyc2UgKi8KIAlpZiAoY29ubmVjdG9yLT5wb2xsZWQgJiBEUk1fQ09OTkVDVE9SX1BP
TExfSFBEKSB7Ci0JCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JCWk5MTVf
ZGlzYWJsZV9waXBlc3RhdChkZXZfcHJpdiwgMCwKKwkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJx
X2xvY2spOworCQlpOTE1X2Rpc2FibGVfcGlwZXN0YXQoaTkxNSwgMCwKIAkJCQkgICAgICBQSVBF
X0hPVFBMVUdfSU5URVJSVVBUX1NUQVRVUyB8CiAJCQkJICAgICAgUElQRV9IT1RQTFVHX1RWX0lO
VEVSUlVQVF9TVEFUVVMpOwotCQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7
CisJCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwogCX0KIAogCXNhdmVfdHZfZGFj
ID0gdHZfZGFjID0gSTkxNV9SRUFEKFRWX0RBQyk7CkBAIC0xNjA1LDcgKzE2MDUsNyBAQCBpbnRl
bF90dl9kZXRlY3RfdHlwZShzdHJ1Y3QgaW50ZWxfdHYgKmludGVsX3R2LAogCSAqIFRoZSBUViBz
ZW5zZSBzdGF0ZSBzaG91bGQgYmUgY2xlYXJlZCB0byB6ZXJvIG9uIGNhbnRpZ2EgcGxhdGZvcm0u
IE90aGVyd2lzZQogCSAqIHRoZSBUViBpcyBtaXNkZXRlY3RlZC4gVGhpcyBpcyBoYXJkd2FyZSBy
ZXF1aXJlbWVudC4KIAkgKi8KLQlpZiAoSVNfR000NShkZXZfcHJpdikpCisJaWYgKElTX0dNNDUo
aTkxNSkpCiAJCXR2X2RhYyAmPSB+KFRWREFDX1NUQVRFX0NIR19FTiB8IFRWREFDX0FfU0VOU0Vf
Q1RMIHwKIAkJCSAgICBUVkRBQ19CX1NFTlNFX0NUTCB8IFRWREFDX0NfU0VOU0VfQ1RMKTsKIApA
QCAtMTYxMyw3ICsxNjEzLDcgQEAgaW50ZWxfdHZfZGV0ZWN0X3R5cGUoc3RydWN0IGludGVsX3R2
ICppbnRlbF90diwKIAlJOTE1X1dSSVRFKFRWX0RBQywgdHZfZGFjKTsKIAlQT1NUSU5HX1JFQUQo
VFZfREFDKTsKIAotCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgaW50ZWxfY3J0Yy0+
cGlwZSk7CisJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGk5MTUsIGludGVsX2NydGMtPnBpcGUpOwog
CiAJdHlwZSA9IC0xOwogCXR2X2RhYyA9IEk5MTVfUkVBRChUVl9EQUMpOwpAQCAtMTY0MywxNSAr
MTY0MywxNSBAQCBpbnRlbF90dl9kZXRlY3RfdHlwZShzdHJ1Y3QgaW50ZWxfdHYgKmludGVsX3R2
LAogCVBPU1RJTkdfUkVBRChUVl9DVEwpOwogCiAJLyogRm9yIHVua25vd24gcmVhc29ucyB0aGUg
aHcgYmFyZnMgaWYgd2UgZG9uJ3QgZG8gdGhpcyB2Ymxhbmsgd2FpdC4gKi8KLQlpbnRlbF93YWl0
X2Zvcl92YmxhbmsoZGV2X3ByaXYsIGludGVsX2NydGMtPnBpcGUpOworCWludGVsX3dhaXRfZm9y
X3ZibGFuayhpOTE1LCBpbnRlbF9jcnRjLT5waXBlKTsKIAogCS8qIFJlc3RvcmUgaW50ZXJydXB0
IGNvbmZpZyAqLwogCWlmIChjb25uZWN0b3ItPnBvbGxlZCAmIERSTV9DT05ORUNUT1JfUE9MTF9I
UEQpIHsKLQkJc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQkJaTkxNV9lbmFi
bGVfcGlwZXN0YXQoZGV2X3ByaXYsIDAsCisJCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2Nr
KTsKKwkJaTkxNV9lbmFibGVfcGlwZXN0YXQoaTkxNSwgMCwKIAkJCQkgICAgIFBJUEVfSE9UUExV
R19JTlRFUlJVUFRfU1RBVFVTIHwKIAkJCQkgICAgIFBJUEVfSE9UUExVR19UVl9JTlRFUlJVUFRf
U1RBVFVTKTsKLQkJc3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCQlzcGlu
X3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKIAl9CiAKIAlyZXR1cm4gdHlwZTsKQEAgLTE3
NjQsNyArMTc2NCw3IEBAIGludGVsX3R2X3NldF9tb2RlX3R5cGUoc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKm1vZGUsCiBzdGF0aWMgaW50CiBpbnRlbF90dl9nZXRfbW9kZXMoc3RydWN0IGRybV9j
b25uZWN0b3IgKmNvbm5lY3RvcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOwogCWNvbnN0IHN0cnVjdCB0dl9tb2RlICp0
dl9tb2RlID0gaW50ZWxfdHZfbW9kZV9maW5kKGNvbm5lY3Rvci0+c3RhdGUpOwogCWludCBpLCBj
b3VudCA9IDA7CiAKQEAgLTE3NzgsNyArMTc3OCw3IEBAIGludGVsX3R2X2dldF9tb2RlcyhzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCQkJY29udGludWU7CiAKIAkJLyogbm8gdmVy
dGljYWwgc2NhbGluZyB3aXRoIHdpZGUgc291cmNlcyBvbiBnZW4zICovCi0JCWlmIChJU19HRU4o
ZGV2X3ByaXYsIDMpICYmIGlucHV0LT53ID4gMTAyNCAmJgorCQlpZiAoSVNfR0VOKGk5MTUsIDMp
ICYmIGlucHV0LT53ID4gMTAyNCAmJgogCQkgICAgaW5wdXQtPmggPiBpbnRlbF90dl9tb2RlX3Zk
aXNwbGF5KHR2X21vZGUpKQogCQkJY29udGludWU7CiAKQEAgLTE4NTcsOSArMTg1Nyw5IEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2VuY29kZXJfZnVuY3MgaW50ZWxfdHZfZW5jX2Z1bmNzID0g
ewogfTsKIAogdm9pZAotaW50ZWxfdHZfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitpbnRlbF90dl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
OwogCXN0cnVjdCBpbnRlbF90diAqaW50ZWxfdHY7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmlu
dGVsX2VuY29kZXI7CkBAIC0xODcyLDcgKzE4NzIsNyBAQCBpbnRlbF90dl9pbml0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpZiAoKEk5MTVfUkVBRChUVl9DVEwpICYgVFZf
RlVTRV9TVEFURV9NQVNLKSA9PSBUVl9GVVNFX1NUQVRFX0RJU0FCTEVEKQogCQlyZXR1cm47CiAK
LQlpZiAoIWludGVsX2Jpb3NfaXNfdHZfcHJlc2VudChkZXZfcHJpdikpIHsKKwlpZiAoIWludGVs
X2Jpb3NfaXNfdHZfcHJlc2VudChpOTE1KSkgewogCQlEUk1fREVCVUdfS01TKCJJbnRlZ3JhdGVk
IFRWIGlzIG5vdCBwcmVzZW50LlxuIik7CiAJCXJldHVybjsKIAl9CkBAIC0xOTY2LDcgKzE5NjYs
NyBAQCBpbnRlbF90dl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkv
KiBDcmVhdGUgVFYgcHJvcGVydGllcyB0aGVuIGF0dGFjaCBjdXJyZW50IHZhbHVlcyAqLwogCWZv
ciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHR2X21vZGVzKTsgaSsrKSB7CiAJCS8qIDEwODBwNTAv
MTA4MHA2MCBub3Qgc3VwcG9ydGVkIG9uIGdlbjMgKi8KLQkJaWYgKElTX0dFTihkZXZfcHJpdiwg
MykgJiYKKwkJaWYgKElTX0dFTihpOTE1LCAzKSAmJgogCQkgICAgdHZfbW9kZXNbaV0ub3ZlcnNh
bXBsZSA9PSAxKQogCQkJYnJlYWs7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3R2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF90di5oCmluZGV4IDQ0NTE4
NTc1ZWM1Yy4uZmMwYjg5NTYzYjRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF90di5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3R2LmgKQEAgLTgsNiAr
OCw2IEBACiAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogCi12b2lkIGludGVsX3R2X2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfdHZfaW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKICNlbmRpZiAvKiBfX0lOVEVMX1RWX0hf
XyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjLmMKaW5kZXggYThlN2YwYmE3YzNiLi4xMWUyZGNmNmI5
MTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuYwpAQCAtMzMsMTIgKzMzLDEyIEBAIHN0YXRpYyB2
b2lkIGd1Y19mcmVlX2xvYWRfZXJyX2xvZyhzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpOwogCiAvKiBS
ZXNldCBHdUMgcHJvdmlkaW5nIHVzIHdpdGggZnJlc2ggc3RhdGUgZm9yIGJvdGggR3VDIGFuZCBI
dUMuCiAgKi8KLXN0YXRpYyBpbnQgX19pbnRlbF91Y19yZXNldF9odyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgaW50IF9faW50ZWxfdWNfcmVzZXRfaHcoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IHJldDsKIAl1MzIgZ3VjX3N0YXR1czsK
IAotCXJldCA9IGludGVsX3Jlc2V0X2d1YyhkZXZfcHJpdik7CisJcmV0ID0gaW50ZWxfcmVzZXRf
Z3VjKGk5MTUpOwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gcmVzZXQgR3VD
LCByZXQgPSAlZFxuIiwgcmV0KTsKIAkJcmV0dXJuIHJldDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3VjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91Yy5o
CmluZGV4IDNlYTA2Yzg3ZGZjZC4uNGRkZDUwZDk5MGIzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF91Yy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Vj
LmgKQEAgLTI4LDIwICsyOCwyMCBAQAogI2luY2x1ZGUgImludGVsX2h1Yy5oIgogI2luY2x1ZGUg
Imk5MTVfcGFyYW1zLmgiCiAKLXZvaWQgaW50ZWxfdWNfaW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF91Y19jbGVhbnVwX2Vhcmx5KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVsX3VjX2luaXRfbW1pbyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotaW50IGludGVsX3VjX2luaXRfbWlz
YyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpbnRlbF91Y19maW5p
X21pc2Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaW50ZWxfdWNf
c2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLWludCBpbnRlbF91
Y19pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVs
X3VjX2ZpbmlfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLWludCBpbnRl
bF91Y19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGludGVs
X3VjX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxf
dWNfaW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVs
X3VjX2NsZWFudXBfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBp
bnRlbF91Y19pbml0X21taW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworaW50IGlu
dGVsX3VjX2luaXRfbWlzYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGlu
dGVsX3VjX2ZpbmlfbWlzYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGlu
dGVsX3VjX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK2ludCBpbnRl
bF91Y19pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxf
dWNfZmluaV9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitpbnQgaW50ZWxfdWNf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX3VjX2Zpbmko
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBpbnRlbF91Y19yZXNldF9wcmVw
YXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHZvaWQgaW50ZWxfdWNfc3VzcGVu
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGludGVsX3VjX3J1bnRpbWVf
c3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Ci1pbnQgaW50ZWxfdWNfcmVz
dW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CitpbnQgaW50ZWxfdWNfcmVz
dW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogc3RhdGljIGlubGluZSBib29s
IGludGVsX3VjX2lzX3VzaW5nX2d1YyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjX2Z3LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF91Y19mdy5jCmluZGV4IGYzNDJkZGQ0N2RmOC4uZDE1NjkxMWQx
NTYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91Y19mdy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjX2Z3LmMKQEAgLTMyLDE1ICszMiwxNSBAQAog
LyoqCiAgKiBpbnRlbF91Y19md19mZXRjaCAtIGZldGNoIHVDIGZpcm13YXJlCiAgKgotICogQGRl
dl9wcml2OiBkZXZpY2UgcHJpdmF0ZQorICogQGk5MTU6IGRldmljZSBwcml2YXRlCiAgKiBAdWNf
Znc6IHVDIGZpcm13YXJlCiAgKgogICogRmV0Y2ggdUMgZmlybXdhcmUgaW50byBHRU0gb2JqLgog
ICovCi12b2lkIGludGVsX3VjX2Z3X2ZldGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3ZvaWQgaW50ZWxfdWNfZndfZmV0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCSAgICAgICBzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KQogewotCXN0cnVjdCBwY2lf
ZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0g
aTkxNS0+ZHJtLnBkZXY7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25z
dCBzdHJ1Y3QgZmlybXdhcmUgKmZ3ID0gTlVMTDsKIAlzdHJ1Y3QgdWNfY3NzX2hlYWRlciAqY3Nz
OwpAQCAtNDgsMTAgKzQ4LDEwIEBAIHZvaWQgaW50ZWxfdWNfZndfZmV0Y2goc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWludCBlcnI7CiAKIAlpZiAoIXVjX2Z3LT5wYXRoKSB7
Ci0JCWRldl9pbmZvKGRldl9wcml2LT5kcm0uZGV2LAorCQlkZXZfaW5mbyhpOTE1LT5kcm0uZGV2
LAogCQkJICIlczogTm8gZmlybXdhcmUgd2FzIGRlZmluZWQgZm9yICVzIVxuIiwKIAkJCSBpbnRl
bF91Y19md190eXBlX3JlcHIodWNfZnctPnR5cGUpLAotCQkJIGludGVsX3BsYXRmb3JtX25hbWUo
SU5URUxfSU5GTyhkZXZfcHJpdiktPnBsYXRmb3JtKSk7CisJCQkgaW50ZWxfcGxhdGZvcm1fbmFt
ZShJTlRFTF9JTkZPKGk5MTUpLT5wbGF0Zm9ybSkpOwogCQlyZXR1cm47CiAJfQogCkBAIC0xNTks
NyArMTU5LDcgQEAgdm9pZCBpbnRlbF91Y19md19mZXRjaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCWdvdG8gZmFpbDsKIAl9CiAKLQlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX3NobWVtX2Zyb21fZGF0YShkZXZfcHJpdiwKKwlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX3NobWVtX2Zyb21fZGF0YShpOTE1LAogCQkJCQkJICAgICBmdy0+ZGF0YSwgZnctPnNp
emUpOwogCWlmIChJU19FUlIob2JqKSkgewogCQllcnIgPSBQVFJfRVJSKG9iaik7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91Y19mdy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfdWNfZncuaAppbmRleCBmZjk4Zjg2NjFkNzIuLjg4MWMzYWVmMDc0YyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF91Y19mdy5oCkBAIC0xNDIsNyArMTQyLDcgQEAgc3RhdGljIGlu
bGluZSB1MzIgaW50ZWxfdWNfZndfZ2V0X3VwbG9hZF9zaXplKHN0cnVjdCBpbnRlbF91Y19mdyAq
dWNfZncpCiAJcmV0dXJuIHVjX2Z3LT5oZWFkZXJfc2l6ZSArIHVjX2Z3LT51Y29kZV9zaXplOwog
fQogCi12b2lkIGludGVsX3VjX2Z3X2ZldGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKK3ZvaWQgaW50ZWxfdWNfZndfZmV0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCSAgICAgICBzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KTsKIHZvaWQgaW50ZWxfdWNf
ZndfY2xlYW51cF9mZXRjaChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KTsKIGludCBpbnRlbF91
Y19md191cGxvYWQoc3RydWN0IGludGVsX3VjX2Z3ICp1Y19mdywKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfdW5jb3JlLmMKaW5kZXggODUxNzFhOGI4NjZhLi44N2RlYzAwNTE2NWQgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3VuY29yZS5jCkBAIC01MzcsMTAgKzUzNywxMCBAQCB2b2lkIGludGVsX3Vu
Y29yZV9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJaW9zZl9t
YmlfcmVnaXN0ZXJfcG1pY19idXNfYWNjZXNzX25vdGlmaWVyKCZ1bmNvcmUtPnBtaWNfYnVzX2Fj
Y2Vzc19uYik7CiB9CiAKLXZvaWQgaW50ZWxfdW5jb3JlX3Nhbml0aXplKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfdW5jb3JlX3Nhbml0aXplKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCS8qIEJJT1Mgb2Z0ZW4gbGVhdmVzIFJDNiBlbmFi
bGVkLCBidXQgZGlzYWJsZSBpdCBmb3IgaHcgaW5pdCAqLwotCWludGVsX3Nhbml0aXplX2d0X3Bv
d2Vyc2F2ZShkZXZfcHJpdik7CisJaW50ZWxfc2FuaXRpemVfZ3RfcG93ZXJzYXZlKGk5MTUpOwog
fQogCiBzdGF0aWMgdm9pZCBfX2ludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KHN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSwKQEAgLTY0Nyw3ICs2NDcsNyBAQCB2b2lkIGludGVsX3VuY29yZV9m
b3JjZXdha2VfdXNlcl9wdXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogICogQGZ3X2Rv
bWFpbnM6IGZvcmNld2FrZSBkb21haW5zIHRvIGdldCByZWZlcmVuY2Ugb24KICAqCiAgKiBTZWUg
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoKS4gVGhpcyB2YXJpYW50IHBsYWNlcyB0aGUgb251
cwotICogb24gdGhlIGNhbGxlciB0byBleHBsaWNpdGx5IGhhbmRsZSB0aGUgZGV2X3ByaXYtPnVu
Y29yZS5sb2NrIHNwaW5sb2NrLgorICogb24gdGhlIGNhbGxlciB0byBleHBsaWNpdGx5IGhhbmRs
ZSB0aGUgaTkxNS0+dW5jb3JlLmxvY2sgc3BpbmxvY2suCiAgKi8KIHZvaWQgaW50ZWxfdW5jb3Jl
X2ZvcmNld2FrZV9nZXRfX2xvY2tlZChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCiAJCQkJ
CWVudW0gZm9yY2V3YWtlX2RvbWFpbnMgZndfZG9tYWlucykKQEAgLTcwOCw3ICs3MDgsNyBAQCB2
b2lkIGludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSwKICAqIEBmd19kb21haW5zOiBmb3JjZXdha2UgZG9tYWlucyB0byBnZXQgcmVmZXJlbmNlIG9u
CiAgKgogICogU2VlIGludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCkuIFRoaXMgdmFyaWFudCBw
bGFjZXMgdGhlIG9udXMKLSAqIG9uIHRoZSBjYWxsZXIgdG8gZXhwbGljaXRseSBoYW5kbGUgdGhl
IGRldl9wcml2LT51bmNvcmUubG9jayBzcGlubG9jay4KKyAqIG9uIHRoZSBjYWxsZXIgdG8gZXhw
bGljaXRseSBoYW5kbGUgdGhlIGk5MTUtPnVuY29yZS5sb2NrIHNwaW5sb2NrLgogICovCiB2b2lk
IGludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0X19sb2NrZWQoc3RydWN0IGludGVsX3VuY29yZSAq
dW5jb3JlLAogCQkJCQllbnVtIGZvcmNld2FrZV9kb21haW5zIGZ3X2RvbWFpbnMpCkBAIC04MjEs
MTAgKzgyMSwxMCBAQCBmaW5kX2Z3X2RvbWFpbihzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUs
IHUzMiBvZmZzZXQpCiAjZGVmaW5lIEdFTl9GV19SQU5HRShzLCBlLCBkKSBcCiAJeyAuc3RhcnQg
PSAocyksIC5lbmQgPSAoZSksIC5kb21haW5zID0gKGQpIH0KIAotI2RlZmluZSBIQVNfRldUQUJM
RShkZXZfcHJpdikgXAotCShJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkgfHwgXAotCSBJU19DSEVS
UllWSUVXKGRldl9wcml2KSB8fCBcCi0JIElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQorI2RlZmlu
ZSBIQVNfRldUQUJMRShpOTE1KSBcCisJKElOVEVMX0dFTihpOTE1KSA+PSA5IHx8IFwKKwkgSVNf
Q0hFUlJZVklFVyhpOTE1KSB8fCBcCisJIElTX1ZBTExFWVZJRVcoaTkxNSkpCiAKIC8qICpNdXN0
KiBiZSBzb3J0ZWQgYnkgb2Zmc2V0IHJhbmdlcyEgU2VlIGludGVsX2Z3X3RhYmxlX2NoZWNrKCku
ICovCiBzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2ZvcmNld2FrZV9yYW5nZSBfX3Zsdl9md19y
YW5nZXNbXSA9IHsKQEAgLTE0NjEsNyArMTQ2MSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3VuY29y
ZV9md19kb21haW5zX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogc3RhdGljIGlu
dCBpOTE1X3BtaWNfYnVzX2FjY2Vzc19ub3RpZmllcihzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5i
LAogCQkJCQkgdW5zaWduZWQgbG9uZyBhY3Rpb24sIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY29udGFpbmVyX29mKG5iLAorCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gY29udGFpbmVyX29mKG5iLAogCQkJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUsIHVuY29yZS5wbWljX2J1c19hY2Nlc3NfbmIpOwogCiAJc3dpdGNoIChhY3Rpb24p
IHsKQEAgLTE0NzksMTIgKzE0NzksMTIgQEAgc3RhdGljIGludCBpOTE1X3BtaWNfYnVzX2FjY2Vz
c19ub3RpZmllcihzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLAogCQkgKiB3YWtlIHJlZmVyZW5j
ZSAtPiBkaXNhYmxlIHdha2VyZWYgYXNzZXJ0cyBmb3IgdGhlIHRpbWUgb2YKIAkJICogdGhlIGFj
Y2Vzcy4KIAkJICovCi0JCWRpc2FibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7Ci0J
CWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0Vf
QUxMKTsKLQkJZW5hYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoZGV2X3ByaXYpOworCQlkaXNhYmxl
X3JwbV93YWtlcmVmX2Fzc2VydHMoaTkxNSk7CisJCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0
KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCQllbmFibGVfcnBtX3dha2VyZWZfYXNz
ZXJ0cyhpOTE1KTsKIAkJYnJlYWs7CiAJY2FzZSBNQklfUE1JQ19CVVNfQUNDRVNTX0VORDoKLQkJ
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOworCQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKIAkJYnJlYWs7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF91bmNvcmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oCmlu
ZGV4IGQ2YWYzZGU3MDEyMS4uZDMwYmRhMmMzNDQ0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF91bmNvcmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91
bmNvcmUuaApAQCAtMTc3LDcgKzE3Nyw3IEBAIGludGVsX3VuY29yZV9oYXNfZmlmbyhjb25zdCBz
dHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJcmV0dXJuIHVuY29yZS0+ZmxhZ3MgJiBVTkNP
UkVfSEFTX0ZJRk87CiB9CiAKLXZvaWQgaW50ZWxfdW5jb3JlX3Nhbml0aXplKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit2b2lkIGludGVsX3VuY29yZV9zYW5pdGl6ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGludGVsX3VuY29yZV9pbml0X2Vhcmx5
KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSk7CiBpbnQgaW50ZWxfdW5jb3JlX2luaXRfbW1p
byhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpOwogdm9pZCBpbnRlbF91bmNvcmVfcHJ1bmVf
bW1pb19kb21haW5zKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSk7CkBAIC0zNjEsNyArMzYx
LDcgQEAgaW50ZWxfdW5jb3JlX3JlYWQ2NF8yeDMyKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSwKICAqCiAgKiBDZXJ0YWluIGFyY2hpdGVjdHVyZXMgd2lsbCBkaWUgaWYgdGhlIHNhbWUgY2Fj
aGVsaW5lIGlzIGNvbmN1cnJlbnRseSBhY2Nlc3NlZAogICogYnkgZGlmZmVyZW50IGNsaWVudHMg
KGUuZy4gb24gSXZ5YnJpZGdlKS4gQWNjZXNzIHRvIHJlZ2lzdGVycyBzaG91bGQKLSAqIHRoZXJl
Zm9yZSBnZW5lcmFsbHkgYmUgc2VyaWFsaXNlZCwgYnkgZWl0aGVyIHRoZSBkZXZfcHJpdi0+dW5j
b3JlLmxvY2sgb3IKKyAqIHRoZXJlZm9yZSBnZW5lcmFsbHkgYmUgc2VyaWFsaXNlZCwgYnkgZWl0
aGVyIHRoZSBpOTE1LT51bmNvcmUubG9jayBvcgogICogYSBtb3JlIGxvY2FsaXNlZCBsb2NrIGd1
YXJkaW5nIGFsbCBhY2Nlc3MgdG8gdGhhdCBiYW5rIG9mIHJlZ2lzdGVycy4KICAqLwogI2RlZmlu
ZSBpbnRlbF91bmNvcmVfcmVhZF9mdyguLi4pIF9fcmF3X3VuY29yZV9yZWFkMzIoX19WQV9BUkdT
X18pCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF92YnRfZGVmcy5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdmJ0X2RlZnMuaAppbmRleCA4OWVmMTRjYWZiNmIu
LmUyZTk4ODNkNmIyOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdmJ0
X2RlZnMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF92YnRfZGVmcy5oCkBAIC0z
MzcsNyArMzM3LDcgQEAgZW51bSB2YnRfZ21idXNfZGRpIHsKICAqIGJhc2ljYWxseSBhbnkgb2Yg
dGhlIGZpZWxkcyB0byBlbnN1cmUgdGhlIGNvcnJlY3QgaW50ZXJwcmV0YXRpb24gZm9yIHRoZSBC
REIKICAqIHZlcnNpb24gaW4gcXVlc3Rpb24uCiAgKgotICogV2hlbiB3ZSBjb3B5IHRoZSBjaGls
ZCBkZXZpY2UgY29uZmlncyB0byBkZXZfcHJpdi0+dmJ0LmNoaWxkX2Rldiwgd2UgcmVzZXJ2ZQor
ICogV2hlbiB3ZSBjb3B5IHRoZSBjaGlsZCBkZXZpY2UgY29uZmlncyB0byBpOTE1LT52YnQuY2hp
bGRfZGV2LCB3ZSByZXNlcnZlCiAgKiBzcGFjZSBmb3IgdGhlIGZ1bGwgc3RydWN0dXJlIGJlbG93
LCBhbmQgaW5pdGlhbGl6ZSB0aGUgdGFpbCBub3QgYWN0dWFsbHkKICAqIHByZXNlbnQgaW4gVkJU
IHRvIHplcm9zLiBBY2Nlc3NpbmcgdGhvc2UgZmllbGRzIGlzIGZpbmUsIGFzIGxvbmcgYXMgdGhl
CiAgKiBkZWZhdWx0IHplcm8gaXMgdGFrZW4gaW50byBhY2NvdW50LCBhZ2FpbiBhY2NvcmRpbmcg
dG8gdGhlIEJEQiB2ZXJzaW9uLgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfdmRzYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdmRzYy5jCmluZGV4IGZmZWM4
MDdiODk2MC4uMTY0ZmQ0YjU2MTEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF92ZHNjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdmRzYy5jCkBAIC00
NzgsNyArNDc4LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29uZmlndXJlX3Bwc19mb3JfZHNjX2Vu
Y29kZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CWNvbnN0IHN0cnVjdCBkcm1fZHNjX2NvbmZpZyAqdmRzY19jZmcgPSAmY3J0Y19zdGF0ZS0+ZHBf
ZHNjX2NmZzsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJZW51bSB0cmFuc2NvZGVy
IGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CkBAIC04OTcsNyAr
ODk3LDcgQEAgdm9pZCBpbnRlbF9kc2NfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsK
IAlpOTE1X3JlZ190IGRzc19jdGwxX3JlZywgZHNzX2N0bDJfcmVnOwogCXUzMiBkc3NfY3RsMV92
YWwgPSAwOwpAQCAtOTA3LDcgKzkwNyw3IEBAIHZvaWQgaW50ZWxfZHNjX2VuYWJsZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJcmV0dXJuOwogCiAJLyogRW5hYmxlIFBvd2VyIHdl
bGxzIGZvciBWRFNDL2pvaW5pbmcgKi8KLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJp
diwKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChpOTE1LAogCQkJCWludGVsX2RzY19wb3dlcl9k
b21haW4oY3J0Y19zdGF0ZSkpOwogCiAJaW50ZWxfY29uZmlndXJlX3Bwc19mb3JfZHNjX2VuY29k
ZXIoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CkBAIC05MzMsNyArOTMzLDcgQEAgdm9pZCBpbnRlbF9k
c2NfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogdm9pZCBpbnRlbF9kc2Nf
ZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7
CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRl
LT5iYXNlLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWk5
MTVfcmVnX3QgZHNzX2N0bDFfcmVnLCBkc3NfY3RsMl9yZWc7CiAJdTMyIGRzc19jdGwxX3ZhbCA9
IDAsIGRzc19jdGwyX3ZhbCA9IDA7CkBAIC05NjEsNiArOTYxLDYgQEAgdm9pZCBpbnRlbF9kc2Nf
ZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCiAJ
STkxNV9XUklURShkc3NfY3RsMl9yZWcsIGRzc19jdGwyX3ZhbCk7CiAKIAkvKiBEaXNhYmxlIFBv
d2VyIHdlbGxzIGZvciBWRFNDL2pvaW5pbmcgKi8KLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF91
bmNoZWNrZWQoZGV2X3ByaXYsCisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfdW5jaGVja2VkKGk5
MTUsCiAJCQkJCSAgaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihvbGRfY3J0Y19zdGF0ZSkpOwogfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMKaW5kZXggN2I0YmE4NGI5ZmI4Li42NDY1NDBiOTcy
NjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYwpAQCAtMjI1LDcgKzIyNSw3IEBAIGlu
dCBpbnRlbF93b3BjbV9pbml0KHN0cnVjdCBpbnRlbF93b3BjbSAqd29wY20pCiAJcmV0dXJuIDA7
CiB9CiAKLXN0YXRpYyBpbmxpbmUgaW50IHdyaXRlX2FuZF92ZXJpZnkoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGlubGluZSBpbnQgd3JpdGVfYW5kX3ZlcmlmeShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICBpOTE1X3JlZ190IHJlZywgdTMy
IHZhbCwgdTMyIG1hc2ssCiAJCQkJICAgdTMyIGxvY2tlZF9iaXQpCiB7CkBAIC0yNTIsMjcgKzI1
MiwyNyBAQCBzdGF0aWMgaW5saW5lIGludCB3cml0ZV9hbmRfdmVyaWZ5KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKICAqLwogaW50IGludGVsX3dvcGNtX2luaXRfaHcoc3RydWN0
IGludGVsX3dvcGNtICp3b3BjbSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB3b3BjbV90b19pOTE1KHdvcGNtKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHdvcGNtX3RvX2k5MTUod29wY20pOwogCXUzMiBodWNfYWdlbnQ7CiAJdTMyIG1hc2s7CiAJ
aW50IGVycjsKIAotCWlmICghVVNFU19HVUMoZGV2X3ByaXYpKQorCWlmICghVVNFU19HVUMoaTkx
NSkpCiAJCXJldHVybiAwOwogCi0JR0VNX0JVR19PTighSEFTX0dVQyhkZXZfcHJpdikpOworCUdF
TV9CVUdfT04oIUhBU19HVUMoaTkxNSkpOwogCUdFTV9CVUdfT04oIXdvcGNtLT5ndWMuc2l6ZSk7
CiAJR0VNX0JVR19PTighd29wY20tPmd1Yy5iYXNlKTsKIAotCWVyciA9IHdyaXRlX2FuZF92ZXJp
ZnkoZGV2X3ByaXYsIEdVQ19XT1BDTV9TSVpFLCB3b3BjbS0+Z3VjLnNpemUsCisJZXJyID0gd3Jp
dGVfYW5kX3ZlcmlmeShpOTE1LCBHVUNfV09QQ01fU0laRSwgd29wY20tPmd1Yy5zaXplLAogCQkJ
ICAgICAgIEdVQ19XT1BDTV9TSVpFX01BU0sgfCBHVUNfV09QQ01fU0laRV9MT0NLRUQsCiAJCQkg
ICAgICAgR1VDX1dPUENNX1NJWkVfTE9DS0VEKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9vdXQ7
CiAKLQlodWNfYWdlbnQgPSBVU0VTX0hVQyhkZXZfcHJpdikgPyBIVUNfTE9BRElOR19BR0VOVF9H
VUMgOiAwOworCWh1Y19hZ2VudCA9IFVTRVNfSFVDKGk5MTUpID8gSFVDX0xPQURJTkdfQUdFTlRf
R1VDIDogMDsKIAltYXNrID0gR1VDX1dPUENNX09GRlNFVF9NQVNLIHwgR1VDX1dPUENNX09GRlNF
VF9WQUxJRCB8IGh1Y19hZ2VudDsKLQllcnIgPSB3cml0ZV9hbmRfdmVyaWZ5KGRldl9wcml2LCBE
TUFfR1VDX1dPUENNX09GRlNFVCwKKwllcnIgPSB3cml0ZV9hbmRfdmVyaWZ5KGk5MTUsIERNQV9H
VUNfV09QQ01fT0ZGU0VULAogCQkJICAgICAgIHdvcGNtLT5ndWMuYmFzZSB8IGh1Y19hZ2VudCwg
bWFzaywKIAkJCSAgICAgICBHVUNfV09QQ01fT0ZGU0VUX1ZBTElEKTsKIAlpZiAoZXJyKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCmluZGV4IDIwOTNk
MDhhNzU2OS4uMjUxNDg0MjIzNmY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtX2d0dC5jCkBAIC0xNDcsMTcgKzE0NywxNyBAQCBmYWtlX2RtYV9vYmplY3Qo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU2NCBzaXplKQogCiBzdGF0aWMgaW50IGln
dF9wcGd0dF9hbGxvYyh2b2lkICphcmcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gYXJnOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0
cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAl1NjQgc2l6ZSwgbGFzdCwgbGltaXQ7CiAJaW50IGVy
ciA9IDA7CiAKIAkvKiBBbGxvY2F0ZSBhIHBwZ2d0IGFuZCB0cnkgdG8gZmlsbCB0aGUgZW50aXJl
IHJhbmdlICovCiAKLQlpZiAoIUhBU19QUEdUVChkZXZfcHJpdikpCisJaWYgKCFIQVNfUFBHVFQo
aTkxNSkpCiAJCXJldHVybiAwOwogCi0JcHBndHQgPSBfX3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7
CisJcHBndHQgPSBfX3BwZ3R0X2NyZWF0ZShpOTE1KTsKIAlpZiAoSVNfRVJSKHBwZ3R0KSkKIAkJ
cmV0dXJuIFBUUl9FUlIocHBndHQpOwogCkBAIC0yMDgsOSArMjA4LDkgQEAgc3RhdGljIGludCBp
Z3RfcHBndHRfYWxsb2Modm9pZCAqYXJnKQogCX0KIAogZXJyX3BwZ3R0X2NsZWFudXA6Ci0JbXV0
ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtOTkyLDcgKzk5Miw3IEBA
IHN0YXRpYyBpbnQgc2hyaW5rX2Jvb20oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
cmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBleGVyY2lzZV9wcGd0dChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgaW50IGV4ZXJjaXNlX3BwZ3R0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBpbnQgKCpmdW5jKShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgICBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwK
IAkJCQkgICAgICB1NjQgaG9sZV9zdGFydCwgdTY0IGhvbGVfZW5kLApAQCAtMTAwMywxNSArMTAw
MywxNSBAQCBzdGF0aWMgaW50IGV4ZXJjaXNlX3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAJaW50IGVycjsKIAotCWlmICgh
SEFTX0ZVTExfUFBHVFQoZGV2X3ByaXYpKQorCWlmICghSEFTX0ZVTExfUFBHVFQoaTkxNSkpCiAJ
CXJldHVybiAwOwogCi0JZmlsZSA9IG1vY2tfZmlsZShkZXZfcHJpdik7CisJZmlsZSA9IG1vY2tf
ZmlsZShpOTE1KTsKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsK
IAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlwcGd0dCA9IGk5
MTVfcHBndHRfY3JlYXRlKGRldl9wcml2KTsKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKKwlwcGd0dCA9IGk5MTVfcHBndHRfY3JlYXRlKGk5MTUpOwogCWlmIChJU19FUlIo
cHBndHQpKSB7CiAJCWVyciA9IFBUUl9FUlIocHBndHQpOwogCQlnb3RvIG91dF91bmxvY2s7CkBA
IC0xMDE5LDEzICsxMDE5LDEzIEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfcHBndHQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUdFTV9CVUdfT04ob2Zmc2V0X2luX3BhZ2UocHBn
dHQtPnZtLnRvdGFsKSk7CiAJR0VNX0JVR19PTihwcGd0dC0+dm0uY2xvc2VkKTsKIAotCWVyciA9
IGZ1bmMoZGV2X3ByaXYsICZwcGd0dC0+dm0sIDAsIHBwZ3R0LT52bS50b3RhbCwgZW5kX3RpbWUp
OworCWVyciA9IGZ1bmMoaTkxNSwgJnBwZ3R0LT52bSwgMCwgcHBndHQtPnZtLnRvdGFsLCBlbmRf
dGltZSk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIG91dF91bmxvY2s6Ci0JbXV0ZXhf
dW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAotCW1vY2tfZmlsZV9mcmVlKGRldl9wcml2LCBmaWxlKTsK
Kwltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfZ3VjLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfZ3VjLmMKaW5kZXggN2ZkMDMyMWUwOTQ3Li5h
YjNlNzFjOTU3ZGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
bnRlbF9ndWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfZ3Vj
LmMKQEAgLTEwNywxMiArMTA3LDEyIEBAIHN0YXRpYyBpbnQgdmFsaWRhdGVfY2xpZW50KHN0cnVj
dCBpbnRlbF9ndWNfY2xpZW50ICpjbGllbnQsCiAJCQkgICBpbnQgY2xpZW50X3ByaW9yaXR5LAog
CQkJICAgYm9vbCBpc19wcmVlbXB0X2NsaWVudCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShjbGllbnQtPmd1Yyk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBndWNfdG9faTkxNShjbGllbnQtPmd1Yyk7CiAJc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eF9vd25lciA9IGlzX3ByZWVtcHRfY2xpZW50ID8KLQkJCWRldl9wcml2
LT5wcmVlbXB0X2NvbnRleHQgOiBkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQ7CisJCQlpOTE1LT5w
cmVlbXB0X2NvbnRleHQgOiBpOTE1LT5rZXJuZWxfY29udGV4dDsKIAogCWlmIChjbGllbnQtPm93
bmVyICE9IGN0eF9vd25lciB8fAotCSAgICBjbGllbnQtPmVuZ2luZXMgIT0gSU5URUxfSU5GTyhk
ZXZfcHJpdiktPmVuZ2luZV9tYXNrIHx8CisJICAgIGNsaWVudC0+ZW5naW5lcyAhPSBJTlRFTF9J
TkZPKGk5MTUpLT5lbmdpbmVfbWFzayB8fAogCSAgICBjbGllbnQtPnByaW9yaXR5ICE9IGNsaWVu
dF9wcmlvcml0eSB8fAogCSAgICBjbGllbnQtPmRvb3JiZWxsX2lkID09IEdVQ19ET09SQkVMTF9J
TlZBTElEKQogCQlyZXR1cm4gLUVJTlZBTDsKQEAgLTEzNywxNiArMTM3LDE2IEBAIHN0YXRpYyBi
b29sIGNsaWVudF9kb29yYmVsbF9pbl9zeW5jKHN0cnVjdCBpbnRlbF9ndWNfY2xpZW50ICpjbGll
bnQpCiAgKi8KIHN0YXRpYyBpbnQgaWd0X2d1Y19jbGllbnRzKHZvaWQgKmFyZ3MpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gYXJnczsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGFyZ3M7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0
IGludGVsX2d1YyAqZ3VjOwogCWludCBlcnIgPSAwOwogCi0JR0VNX0JVR19PTighSEFTX0dVQyhk
ZXZfcHJpdikpOwotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOworCUdFTV9CVUdfT04oIUhB
U19HVUMoaTkxNSkpOworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCXdh
a2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChpOTE1KTsKIAotCWd1YyA9ICZkZXZfcHJpdi0+
Z3VjOworCWd1YyA9ICZpOTE1LT5ndWM7CiAJaWYgKCFndWMpIHsKIAkJcHJfZXJyKCJObyBndWMg
b2JqZWN0IVxuIik7CiAJCWVyciA9IC1FSU5WQUw7CkBAIC0yMjcsOCArMjI3LDggQEAgc3RhdGlj
IGludCBpZ3RfZ3VjX2NsaWVudHModm9pZCAqYXJncykKIAlndWNfY2xpZW50c19jcmVhdGUoZ3Vj
KTsKIAlndWNfY2xpZW50c19lbmFibGUoZ3VjKTsKIHVubG9jazoKLQlpbnRlbF9ydW50aW1lX3Bt
X3B1dChkZXZfcHJpdiwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CisJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBA
IC0yMzksMTcgKzIzOSwxNyBAQCBzdGF0aWMgaW50IGlndF9ndWNfY2xpZW50cyh2b2lkICphcmdz
KQogICovCiBzdGF0aWMgaW50IGlndF9ndWNfZG9vcmJlbGxzKHZvaWQgKmFyZykKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBhcmc7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBhcmc7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGlu
dGVsX2d1YyAqZ3VjOwogCWludCBpLCBlcnIgPSAwOwogCXUxNiBkYl9pZDsKIAotCUdFTV9CVUdf
T04oIUhBU19HVUMoZGV2X3ByaXYpKTsKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsKKwlH
RU1fQlVHX09OKCFIQVNfR1VDKGk5MTUpKTsKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CiAKLQlndWMg
PSAmZGV2X3ByaXYtPmd1YzsKKwlndWMgPSAmaTkxNS0+Z3VjOwogCWlmICghZ3VjKSB7CiAJCXBy
X2VycigiTm8gZ3VjIG9iamVjdCFcbiIpOwogCQllcnIgPSAtRUlOVkFMOwpAQCAtMjYxLDEwICsy
NjEsMTAgQEAgc3RhdGljIGludCBpZ3RfZ3VjX2Rvb3JiZWxscyh2b2lkICphcmcpCiAJCWdvdG8g
dW5sb2NrOwogCiAJZm9yIChpID0gMDsgaSA8IEFUVEVNUFRTOyBpKyspIHsKLQkJY2xpZW50c1tp
XSA9IGd1Y19jbGllbnRfYWxsb2MoZGV2X3ByaXYsCi0JCQkJCSAgICAgIElOVEVMX0lORk8oZGV2
X3ByaXYpLT5lbmdpbmVfbWFzaywKKwkJY2xpZW50c1tpXSA9IGd1Y19jbGllbnRfYWxsb2MoaTkx
NSwKKwkJCQkJICAgICAgSU5URUxfSU5GTyhpOTE1KS0+ZW5naW5lX21hc2ssCiAJCQkJCSAgICAg
IGkgJSBHVUNfQ0xJRU5UX1BSSU9SSVRZX05VTSwKLQkJCQkJICAgICAgZGV2X3ByaXYtPmtlcm5l
bF9jb250ZXh0KTsKKwkJCQkJICAgICAgaTkxNS0+a2VybmVsX2NvbnRleHQpOwogCiAJCWlmICgh
Y2xpZW50c1tpXSkgewogCQkJcHJfZXJyKCJbJWRdIE5vIGd1YyBjbGllbnRcbiIsIGkpOwpAQCAt
MzQwLDIwICszNDAsMjAgQEAgc3RhdGljIGludCBpZ3RfZ3VjX2Rvb3JiZWxscyh2b2lkICphcmcp
CiAJCQlndWNfY2xpZW50X2ZyZWUoY2xpZW50c1tpXSk7CiAJCX0KIHVubG9jazoKLQlpbnRlbF9y
dW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJl
Zik7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJy
OwogfQogCi1pbnQgaW50ZWxfZ3VjX2xpdmVfc2VsZnRlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQoraW50IGludGVsX2d1Y19saXZlX3NlbGZ0ZXN0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRl
c3RzW10gPSB7CiAJCVNVQlRFU1QoaWd0X2d1Y19jbGllbnRzKSwKIAkJU1VCVEVTVChpZ3RfZ3Vj
X2Rvb3JiZWxscyksCiAJfTsKIAotCWlmICghVVNFU19HVUNfU1VCTUlTU0lPTihkZXZfcHJpdikp
CisJaWYgKCFVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCXJldHVy
biBpOTE1X3N1YnRlc3RzKHRlc3RzLCBkZXZfcHJpdik7CisJcmV0dXJuIGk5MTVfc3VidGVzdHMo
dGVzdHMsIGk5MTUpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2ludGVsX3VuY29yZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVs
X3VuY29yZS5jCmluZGV4IGUwZDdlYmVjYjIxNS4uYjUzMDRjZmVkYTIxIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfdW5jb3JlLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVsX3VuY29yZS5jCkBAIC0yNTQsMTUgKzI1NCwx
NSBAQCBzdGF0aWMgaW50IGxpdmVfZm9yY2V3YWtlX29wcyh2b2lkICphcmcpCiBzdGF0aWMgaW50
IGxpdmVfZm9yY2V3YWtlX2RvbWFpbnModm9pZCAqYXJnKQogewogI2RlZmluZSBGV19SQU5HRSAw
eDQwMDAwCi0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gYXJnOwotCXN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9
ICZpOTE1LT51bmNvcmU7CiAJdW5zaWduZWQgbG9uZyAqdmFsaWQ7CiAJdTMyIG9mZnNldDsKIAlp
bnQgZXJyOwogCi0JaWYgKCFIQVNfRlBHQV9EQkdfVU5DTEFJTUVEKGRldl9wcml2KSAmJgotCSAg
ICAhSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgJiYKLQkgICAgIUlTX0NIRVJSWVZJRVcoZGV2X3By
aXYpKQorCWlmICghSEFTX0ZQR0FfREJHX1VOQ0xBSU1FRChpOTE1KSAmJgorCSAgICAhSVNfVkFM
TEVZVklFVyhpOTE1KSAmJgorCSAgICAhSVNfQ0hFUlJZVklFVyhpOTE1KSkKIAkJcmV0dXJuIDA7
CiAKIAkvKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvdmx2X2RzaS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvdmx2X2RzaS5jCmluZGV4IGUyNzJkODI2MjEwYS4uMDE3OGJkZjBj
NWE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS92bHZfZHNpLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvdmx2X2RzaS5jCkBAIC03OCwxOSArNzgsMTkgQEAgdm9pZCB2bHZf
ZHNpX3dhaXRfZm9yX2ZpZm9fZW1wdHkoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpLCBlbnVt
IHBvcnQgcG9ydCkKIHsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXIgPSAmaW50ZWxfZHNp
LT5iYXNlLmJhc2U7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmRldjsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJdTMyIG1hc2s7CiAKIAlt
YXNrID0gTFBfQ1RSTF9GSUZPX0VNUFRZIHwgSFNfQ1RSTF9GSUZPX0VNUFRZIHwKIAkJTFBfREFU
QV9GSUZPX0VNUFRZIHwgSFNfREFUQV9GSUZPX0VNUFRZOwogCi0JaWYgKGludGVsX3dhaXRfZm9y
X3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3Rl
cigmaTkxNS0+dW5jb3JlLAogCQkJCSAgICBNSVBJX0dFTl9GSUZPX1NUQVQocG9ydCksIG1hc2ss
IG1hc2ssCiAJCQkJICAgIDEwMCkpCiAJCURSTV9FUlJPUigiRFBJIEZJRk9zIGFyZSBub3QgZW1w
dHlcbiIpOwogfQogCi1zdGF0aWMgdm9pZCB3cml0ZV9kYXRhKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHdyaXRlX2RhdGEoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCSAgICAgICBpOTE1X3JlZ190IHJlZywKIAkJICAgICAgIGNvbnN0IHU4
ICpkYXRhLCB1MzIgbGVuKQogewpAQCAtMTA2LDcgKzEwNiw3IEBAIHN0YXRpYyB2b2lkIHdyaXRl
X2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0KIAotc3RhdGlj
IHZvaWQgcmVhZF9kYXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRp
YyB2b2lkIHJlYWRfZGF0YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgICAg
aTkxNV9yZWdfdCByZWcsCiAJCSAgICAgIHU4ICpkYXRhLCB1MzIgbGVuKQogewpAQCAtMTI1LDcg
KzEyNSw3IEBAIHN0YXRpYyBzc2l6ZV90IGludGVsX2RzaV9ob3N0X3RyYW5zZmVyKHN0cnVjdCBt
aXBpX2RzaV9ob3N0ICpob3N0LAogewogCXN0cnVjdCBpbnRlbF9kc2lfaG9zdCAqaW50ZWxfZHNp
X2hvc3QgPSB0b19pbnRlbF9kc2lfaG9zdChob3N0KTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gaW50ZWxfZHNpX2hvc3QtPmludGVsX2RzaS0+YmFzZS5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9k
c2lfaG9zdC0+cG9ydDsKIAlzdHJ1Y3QgbWlwaV9kc2lfcGFja2V0IHBhY2tldDsKIAlzc2l6ZV90
IHJldDsKQEAgLTE1NCwxMyArMTU0LDEzIEBAIHN0YXRpYyBzc2l6ZV90IGludGVsX2RzaV9ob3N0
X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAogCiAJLyogbm90ZTogdGhpcyBp
cyBuZXZlciB0cnVlIGZvciByZWFkcyAqLwogCWlmIChwYWNrZXQucGF5bG9hZF9sZW5ndGgpIHsK
LQkJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCQlpZiAo
aW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkJICAgIE1JUElfR0VO
X0ZJRk9fU1RBVChwb3J0KSwKIAkJCQkJICAgIGRhdGFfbWFzaywgMCwKIAkJCQkJICAgIDUwKSkK
IAkJCURSTV9FUlJPUigiVGltZW91dCB3YWl0aW5nIGZvciBIUy9MUCBEQVRBIEZJRk8gIWZ1bGxc
biIpOwogCi0JCXdyaXRlX2RhdGEoZGV2X3ByaXYsIGRhdGFfcmVnLCBwYWNrZXQucGF5bG9hZCwK
KwkJd3JpdGVfZGF0YShpOTE1LCBkYXRhX3JlZywgcGFja2V0LnBheWxvYWQsCiAJCQkgICBwYWNr
ZXQucGF5bG9hZF9sZW5ndGgpOwogCX0KIApAQCAtMTY4LDcgKzE2OCw3IEBAIHN0YXRpYyBzc2l6
ZV90IGludGVsX2RzaV9ob3N0X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAog
CQlJOTE1X1dSSVRFKE1JUElfSU5UUl9TVEFUKHBvcnQpLCBHRU5fUkVBRF9EQVRBX0FWQUlMKTsK
IAl9CiAKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJ
aWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIE1JUElf
R0VOX0ZJRk9fU1RBVChwb3J0KSwKIAkJCQkgICAgY3RybF9tYXNrLCAwLAogCQkJCSAgICA1MCkp
IHsKQEAgLTE4MCwxMyArMTgwLDEzIEBAIHN0YXRpYyBzc2l6ZV90IGludGVsX2RzaV9ob3N0X3Ry
YW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAogCS8qIC0+cnhfbGVuIGlzIHNldCBv
bmx5IGZvciByZWFkcyAqLwogCWlmIChtc2ctPnJ4X2xlbikgewogCQlkYXRhX21hc2sgPSBHRU5f
UkVBRF9EQVRBX0FWQUlMOwotCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2
LT51bmNvcmUsCisJCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAog
CQkJCQkgICAgTUlQSV9JTlRSX1NUQVQocG9ydCksCiAJCQkJCSAgICBkYXRhX21hc2ssIGRhdGFf
bWFzaywKIAkJCQkJICAgIDUwKSkKIAkJCURSTV9FUlJPUigiVGltZW91dCB3YWl0aW5nIGZvciBy
ZWFkIGRhdGEuXG4iKTsKIAotCQlyZWFkX2RhdGEoZGV2X3ByaXYsIGRhdGFfcmVnLCBtc2ctPnJ4
X2J1ZiwgbXNnLT5yeF9sZW4pOworCQlyZWFkX2RhdGEoaTkxNSwgZGF0YV9yZWcsIG1zZy0+cnhf
YnVmLCBtc2ctPnJ4X2xlbik7CiAJfQogCiAJLyogWFhYOiBmaXggZm9yIHJlYWRzIGFuZCB3cml0
ZXMgKi8KQEAgLTIyMSw3ICsyMjEsNyBAQCBzdGF0aWMgaW50IGRwaV9zZW5kX2NtZChzdHJ1Y3Qg
aW50ZWxfZHNpICppbnRlbF9kc2ksIHUzMiBjbWQsIGJvb2wgaHMsCiB7CiAJc3RydWN0IGRybV9l
bmNvZGVyICplbmNvZGVyID0gJmludGVsX2RzaS0+YmFzZS5iYXNlOwogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBlbmNvZGVyLT5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShkZXYpOwogCXUzMiBtYXNrOwogCiAJLyogWFhYOiBwaXBlLCBocyAqLwpAQCAtMjQwLDcg
KzI0MCw3IEBAIHN0YXRpYyBpbnQgZHBpX3NlbmRfY21kKHN0cnVjdCBpbnRlbF9kc2kgKmludGVs
X2RzaSwgdTMyIGNtZCwgYm9vbCBocywKIAlJOTE1X1dSSVRFKE1JUElfRFBJX0NPTlRST0wocG9y
dCksIGNtZCk7CiAKIAltYXNrID0gU1BMX1BLVF9TRU5UX0lOVEVSUlVQVDsKLQlpZiAoaW50ZWxf
d2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJaWYgKGludGVsX3dhaXRfZm9y
X3JlZ2lzdGVyKCZpOTE1LT51bmNvcmUsCiAJCQkJICAgIE1JUElfSU5UUl9TVEFUKHBvcnQpLCBt
YXNrLCBtYXNrLAogCQkJCSAgICAxMDApKQogCQlEUk1fRVJST1IoIlZpZGVvIG1vZGUgY29tbWFu
ZCAweCUwOHggc2VuZCBmYWlsZWQuXG4iLCBjbWQpOwpAQCAtMjQ4LDI1ICsyNDgsMjUgQEAgc3Rh
dGljIGludCBkcGlfc2VuZF9jbWQoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpLCB1MzIgY21k
LCBib29sIGhzLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBiYW5kX2dhcF9yZXNldChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBiYW5kX2dhcF9y
ZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQl2bHZfZmxpc2RzaV9nZXQo
ZGV2X3ByaXYpOworCXZsdl9mbGlzZHNpX2dldChpOTE1KTsKIAotCXZsdl9mbGlzZHNpX3dyaXRl
KGRldl9wcml2LCAweDA4LCAweDAwMDEpOwotCXZsdl9mbGlzZHNpX3dyaXRlKGRldl9wcml2LCAw
eDBGLCAweDAwMDUpOwotCXZsdl9mbGlzZHNpX3dyaXRlKGRldl9wcml2LCAweDBGLCAweDAwMjUp
OworCXZsdl9mbGlzZHNpX3dyaXRlKGk5MTUsIDB4MDgsIDB4MDAwMSk7CisJdmx2X2ZsaXNkc2lf
d3JpdGUoaTkxNSwgMHgwRiwgMHgwMDA1KTsKKwl2bHZfZmxpc2RzaV93cml0ZShpOTE1LCAweDBG
LCAweDAwMjUpOwogCXVkZWxheSgxNTApOwotCXZsdl9mbGlzZHNpX3dyaXRlKGRldl9wcml2LCAw
eDBGLCAweDAwMDApOwotCXZsdl9mbGlzZHNpX3dyaXRlKGRldl9wcml2LCAweDA4LCAweDAwMDAp
OworCXZsdl9mbGlzZHNpX3dyaXRlKGk5MTUsIDB4MEYsIDB4MDAwMCk7CisJdmx2X2ZsaXNkc2lf
d3JpdGUoaTkxNSwgMHgwOCwgMHgwMDAwKTsKIAotCXZsdl9mbGlzZHNpX3B1dChkZXZfcHJpdik7
CisJdmx2X2ZsaXNkc2lfcHV0KGk5MTUpOwogfQogCiBzdGF0aWMgaW50IGludGVsX2RzaV9jb21w
dXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCSAgICBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9k
c2kgKmludGVsX2RzaSA9IGNvbnRhaW5lcl9vZihlbmNvZGVyLCBzdHJ1Y3QgaW50ZWxfZHNpLAog
CQkJCQkJICAgYmFzZSk7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9y
ID0gaW50ZWxfZHNpLT5hdHRhY2hlZF9jb25uZWN0b3I7CkBAIC0yODEsNyArMjgxLDcgQEAgc3Rh
dGljIGludCBpbnRlbF9kc2lfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJaWYgKGZpeGVkX21vZGUpIHsKIAkJaW50ZWxfZml4ZWRfcGFuZWxfbW9kZShmaXhl
ZF9tb2RlLCBhZGp1c3RlZF9tb2RlKTsKIAotCQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpKQorCQlp
ZiAoSEFTX0dNQ0goaTkxNSkpCiAJCQlpbnRlbF9nbWNoX3BhbmVsX2ZpdHRpbmcoY3J0YywgcGlw
ZV9jb25maWcsCiAJCQkJCQkgY29ubl9zdGF0ZS0+c2NhbGluZ19tb2RlKTsKIAkJZWxzZQpAQCAt
MzAwLDcgKzMwMCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHNpX2NvbXB1dGVfY29uZmlnKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWVsc2UKIAkJcGlwZV9jb25maWctPnBpcGVfYnBw
ID0gMTg7CiAKLQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKKwlpZiAoSVNfR0VOOV9MUChp
OTE1KSkgewogCQkvKiBFbmFibGUgRnJhbWUgdGltZSBzdGFtcCBiYXNlZCBzY2FubGluZSByZXBv
cnRpbmcgKi8KIAkJYWRqdXN0ZWRfbW9kZS0+cHJpdmF0ZV9mbGFncyB8PQogCQkJSTkxNV9NT0RF
X0ZMQUdfR0VUX1NDQU5MSU5FX0ZST01fVElNRVNUQU1QOwpAQCAtMzI3LDcgKzMyNyw3IEBAIHN0
YXRpYyBpbnQgaW50ZWxfZHNpX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCiBzdGF0aWMgYm9vbCBnbGtfZHNpX2VuYWJsZV9pbyhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVs
X2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBwb3J0
OwogCXUzMiB0bXA7CkBAIC0zNTksNyArMzU5LDcgQEAgc3RhdGljIGJvb2wgZ2xrX2RzaV9lbmFi
bGVfaW8oc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIAkvKiBXYWl0IGZvciBQd3Ig
QUNLICovCiAJZm9yX2VhY2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewotCQlp
ZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJCWlmIChpbnRl
bF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAgTUlQSV9DVFJMKHBv
cnQpLAogCQkJCQkgICAgR0xLX01JUElJT19QT1JUX1BPV0VSRUQsCiAJCQkJCSAgICBHTEtfTUlQ
SUlPX1BPUlRfUE9XRVJFRCwKQEAgLTM3OCwxNCArMzc4LDE0IEBAIHN0YXRpYyBib29sIGdsa19k
c2lfZW5hYmxlX2lvKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiBzdGF0aWMgdm9p
ZCBnbGtfZHNpX2RldmljZV9yZWFkeShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRl
bF9kc2koJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBwb3J0OwogCXUzMiB2YWw7CiAKIAkv
KiBXYWl0IGZvciBNSVBJIFBIWSBzdGF0dXMgYml0IHRvIHNldCAqLwogCWZvcl9lYWNoX2RzaV9w
b3J0KHBvcnQsIGludGVsX2RzaS0+cG9ydHMpIHsKLQkJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lz
dGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5
MTUtPnVuY29yZSwKIAkJCQkJICAgIE1JUElfQ1RSTChwb3J0KSwKIAkJCQkJICAgIEdMS19QSFlf
U1RBVFVTX1BPUlRfUkVBRFksCiAJCQkJCSAgICBHTEtfUEhZX1NUQVRVU19QT1JUX1JFQURZLApA
QCAtNDEzLDcgKzQxMyw3IEBAIHN0YXRpYyB2b2lkIGdsa19kc2lfZGV2aWNlX3JlYWR5KHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCQkJSTkxNV9XUklURShNSVBJX0RFVklDRV9SRUFE
WShwb3J0KSwgdmFsKTsKIAogCQkJLyogV2FpdCBmb3IgVUxQUyBhY3RpdmUgKi8KLQkJCWlmIChp
bnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKKwkJCWlmIChpbnRlbF93
YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkJICAgIE1JUElfQ1RSTChwb3J0
KSwKIAkJCQkJCSAgICBHTEtfVUxQU19OT1RfQUNUSVZFLAogCQkJCQkJICAgIDAsCkBAIC00NDAs
NyArNDQwLDcgQEAgc3RhdGljIHZvaWQgZ2xrX2RzaV9kZXZpY2VfcmVhZHkoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIpCiAKIAkvKiBXYWl0IGZvciBTdG9wIHN0YXRlICovCiAJZm9yX2Vh
Y2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewotCQlpZiAoaW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdp
c3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAgTUlQSV9DVFJMKHBvcnQpLAogCQkJCQkgICAg
R0xLX0RBVEFfTEFORV9TVE9QX1NUQVRFLAogCQkJCQkgICAgR0xLX0RBVEFfTEFORV9TVE9QX1NU
QVRFLApAQCAtNDUwLDcgKzQ1MCw3IEBAIHN0YXRpYyB2b2lkIGdsa19kc2lfZGV2aWNlX3JlYWR5
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiAJLyogV2FpdCBmb3IgQUZFIExBVENI
ICovCiAJZm9yX2VhY2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewotCQlpZiAo
aW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJCWlmIChpbnRlbF93
YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAgQlhUX01JUElfUE9SVF9D
VFJMKHBvcnQpLAogCQkJCQkgICAgQUZFX0xBVENIT1VULAogCQkJCQkgICAgQUZFX0xBVENIT1VU
LApAQCAtNDYxLDcgKzQ2MSw3IEBAIHN0YXRpYyB2b2lkIGdsa19kc2lfZGV2aWNlX3JlYWR5KHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiBzdGF0aWMgdm9pZCBieHRfZHNpX2Rldmlj
ZV9yZWFkeShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXIt
PmJhc2UpOwogCWVudW0gcG9ydCBwb3J0OwogCXUzMiB2YWw7CkBAIC00ODgsMjEgKzQ4OCwyMSBA
QCBzdGF0aWMgdm9pZCBieHRfZHNpX2RldmljZV9yZWFkeShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlcikKIAogc3RhdGljIHZvaWQgdmx2X2RzaV9kZXZpY2VfcmVhZHkoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICpp
bnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQg
cG9ydDsKIAl1MzIgdmFsOwogCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKIAotCXZsdl9mbGlzZHNp
X2dldChkZXZfcHJpdik7CisJdmx2X2ZsaXNkc2lfZ2V0KGk5MTUpOwogCS8qIHByb2dyYW0gcmNv
bXAgZm9yIGNvbXBsaWFuY2UsIHJlZHVjZSBmcm9tIDUwIG9obXMgdG8gNDUgb2htcwogCSAqIG5l
ZWRlZCBldmVyeXRpbWUgYWZ0ZXIgcG93ZXIgZ2F0ZSAqLwotCXZsdl9mbGlzZHNpX3dyaXRlKGRl
dl9wcml2LCAweDA0LCAweDAwMDQpOwotCXZsdl9mbGlzZHNpX3B1dChkZXZfcHJpdik7CisJdmx2
X2ZsaXNkc2lfd3JpdGUoaTkxNSwgMHgwNCwgMHgwMDA0KTsKKwl2bHZfZmxpc2RzaV9wdXQoaTkx
NSk7CiAKIAkvKiBiYW5kZ2FwIHJlc2V0IGlzIG5lZWRlZCBhZnRlciBldmVyeXRpbWUgd2UgZG8g
cG93ZXIgZ2F0ZSAqLwotCWJhbmRfZ2FwX3Jlc2V0KGRldl9wcml2KTsKKwliYW5kX2dhcF9yZXNl
dChpOTE1KTsKIAogCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+cG9ydHMpIHsK
IApAQCAtNTI3LDExICs1MjcsMTEgQEAgc3RhdGljIHZvaWQgdmx2X2RzaV9kZXZpY2VfcmVhZHko
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIHN0YXRpYyB2b2lkIGludGVsX2RzaV9k
ZXZpY2VfcmVhZHkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKIAotCWlmIChJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwlpZiAoSVNfR0VNSU5JTEFLRShp
OTE1KSkKIAkJZ2xrX2RzaV9kZXZpY2VfcmVhZHkoZW5jb2Rlcik7Ci0JZWxzZSBpZiAoSVNfR0VO
OV9MUChkZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfR0VOOV9MUChpOTE1KSkKIAkJYnh0X2RzaV9k
ZXZpY2VfcmVhZHkoZW5jb2Rlcik7CiAJZWxzZQogCQl2bHZfZHNpX2RldmljZV9yZWFkeShlbmNv
ZGVyKTsKQEAgLTUzOSw3ICs1MzksNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfZGV2aWNlX3Jl
YWR5KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiBzdGF0aWMgdm9pZCBnbGtfZHNp
X2VudGVyX2xvd19wb3dlcl9tb2RlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpID0gZW5jX3RvX2ludGVs
X2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJZW51bSBwb3J0IHBvcnQ7CiAJdTMyIHZhbDsKQEAgLTU1
NCw3ICs1NTQsNyBAQCBzdGF0aWMgdm9pZCBnbGtfZHNpX2VudGVyX2xvd19wb3dlcl9tb2RlKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiAJLyogV2FpdCBmb3IgTUlQSSBQSFkgc3Rh
dHVzIGJpdCB0byB1bnNldCAqLwogCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+
cG9ydHMpIHsKLQkJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3Jl
LAorCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmk5MTUtPnVuY29yZSwKIAkJCQkJICAg
IE1JUElfQ1RSTChwb3J0KSwKIAkJCQkJICAgIEdMS19QSFlfU1RBVFVTX1BPUlRfUkVBRFksIDAs
IDIwKSkKIAkJCURSTV9FUlJPUigiUEhZIGlzIG5vdCB0dXJuaW5nIE9GRlxuIik7CkBAIC01NjIs
NyArNTYyLDcgQEAgc3RhdGljIHZvaWQgZ2xrX2RzaV9lbnRlcl9sb3dfcG93ZXJfbW9kZShzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAogCS8qIFdhaXQgZm9yIFB3ciBBQ0sgYml0IHRv
IHVuc2V0ICovCiAJZm9yX2VhY2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewot
CQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJCWlmIChp
bnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAgTUlQSV9DVFJM
KHBvcnQpLAogCQkJCQkgICAgR0xLX01JUElJT19QT1JUX1BPV0VSRUQsIDAsIDIwKSkKIAkJCURS
TV9FUlJPUigiTUlQSSBJTyBQb3J0IGlzIG5vdCBwb3dlcmdhdGVkXG4iKTsKQEAgLTU3MSw3ICs1
NzEsNyBAQCBzdGF0aWMgdm9pZCBnbGtfZHNpX2VudGVyX2xvd19wb3dlcl9tb2RlKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyKQogCiBzdGF0aWMgdm9pZCBnbGtfZHNpX2Rpc2FibGVfbWlw
aV9pbyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0
cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJh
c2UpOwogCWVudW0gcG9ydCBwb3J0OwogCXUzMiB0bXA7CkBAIC01ODMsNyArNTgzLDcgQEAgc3Rh
dGljIHZvaWQgZ2xrX2RzaV9kaXNhYmxlX21pcGlfaW8oc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIpCiAKIAkvKiBXYWl0IGZvciBNSVBJIFBIWSBzdGF0dXMgYml0IHRvIHVuc2V0ICovCiAJ
Zm9yX2VhY2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewotCQlpZiAoaW50ZWxf
d2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCisJCWlmIChpbnRlbF93YWl0X2Zv
cl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAgTUlQSV9DVFJMKHBvcnQpLAogCQkJ
CQkgICAgR0xLX1BIWV9TVEFUVVNfUE9SVF9SRUFEWSwgMCwgMjApKQogCQkJRFJNX0VSUk9SKCJQ
SFkgaXMgbm90IHR1cm5pbmcgT0ZGXG4iKTsKQEAgLTYwNSwxNCArNjA1LDE0IEBAIHN0YXRpYyB2
b2lkIGdsa19kc2lfY2xlYXJfZGV2aWNlX3JlYWR5KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyKQogCiBzdGF0aWMgdm9pZCB2bHZfZHNpX2NsZWFyX2RldmljZV9yZWFkeShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kg
KmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9y
dCBwb3J0OwogCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKIAlmb3JfZWFjaF9kc2lfcG9ydChwb3J0
LCBpbnRlbF9kc2ktPnBvcnRzKSB7CiAJCS8qIENvbW1vbiBiaXQgZm9yIGJvdGggTUlQSSBQb3J0
IEEgJiBNSVBJIFBvcnQgQyBvbiBWTFYvQ0hWICovCi0JCWk5MTVfcmVnX3QgcG9ydF9jdHJsID0g
SVNfR0VOOV9MUChkZXZfcHJpdikgPworCQlpOTE1X3JlZ190IHBvcnRfY3RybCA9IElTX0dFTjlf
TFAoaTkxNSkgPwogCQkJQlhUX01JUElfUE9SVF9DVFJMKHBvcnQpIDogTUlQSV9QT1JUX0NUUkwo
UE9SVF9BKTsKIAkJdTMyIHZhbDsKIApAQCAtNjMyLDggKzYzMiw4IEBAIHN0YXRpYyB2b2lkIHZs
dl9kc2lfY2xlYXJfZGV2aWNlX3JlYWR5KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQog
CQkgKiBPbiBWTFYvQ0hWLCB3YWl0IHRpbGwgQ2xvY2sgbGFuZXMgYXJlIGluIExQLTAwIHN0YXRl
IGZvciBNSVBJCiAJCSAqIFBvcnQgQSBvbmx5LiBNSVBJIFBvcnQgQyBoYXMgbm8gc2ltaWxhciBi
aXQgZm9yIGNoZWNraW5nLgogCQkgKi8KLQkJaWYgKChJU19HRU45X0xQKGRldl9wcml2KSB8fCBw
b3J0ID09IFBPUlRfQSkgJiYKLQkJICAgIGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJp
di0+dW5jb3JlLAorCQlpZiAoKElTX0dFTjlfTFAoaTkxNSkgfHwgcG9ydCA9PSBQT1JUX0EpICYm
CisJCSAgICBpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAogCQkJCQkgICAg
cG9ydF9jdHJsLCBBRkVfTEFUQ0hPVVQsIDAsCiAJCQkJCSAgICAzMCkpCiAJCQlEUk1fRVJST1Io
IkRTSSBMUCBub3QgZ29pbmcgTG93XG4iKTsKQEAgLTY1MSwxNCArNjUxLDE0IEBAIHN0YXRpYyB2
b2lkIHZsdl9kc2lfY2xlYXJfZGV2aWNlX3JlYWR5KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyKQogc3RhdGljIHZvaWQgaW50ZWxfZHNpX3BvcnRfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRl
bF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9y
dDsKIAogCWlmIChpbnRlbF9kc2ktPmR1YWxfbGluayA9PSBEU0lfRFVBTF9MSU5LX0ZST05UX0JB
Q0spIHsKIAkJdTMyIHRlbXA7Ci0JCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkgeworCQlpZiAo
SVNfR0VOOV9MUChpOTE1KSkgewogCQkJZm9yX2VhY2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNp
LT5wb3J0cykgewogCQkJCXRlbXAgPSBJOTE1X1JFQUQoTUlQSV9DVFJMKHBvcnQpKTsKIAkJCQl0
ZW1wICY9IH5CWFRfUElYRUxfT1ZFUkxBUF9DTlRfTUFTSyB8CkBAIC02NzYsNyArNjc2LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZHNpX3BvcnRfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCX0KIAogCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+cG9ydHMp
IHsKLQkJaTkxNV9yZWdfdCBwb3J0X2N0cmwgPSBJU19HRU45X0xQKGRldl9wcml2KSA/CisJCWk5
MTVfcmVnX3QgcG9ydF9jdHJsID0gSVNfR0VOOV9MUChpOTE1KSA/CiAJCQlCWFRfTUlQSV9QT1JU
X0NUUkwocG9ydCkgOiBNSVBJX1BPUlRfQ1RSTChwb3J0KTsKIAkJdTMyIHRlbXA7CiAKQEAgLTY4
OCw3ICs2ODgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcG9ydF9lbmFibGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCWlmIChpbnRlbF9kc2ktPnBvcnRzID09IChCSVQoUE9S
VF9BKSB8IEJJVChQT1JUX0MpKSkgewogCQkJdGVtcCB8PSAoaW50ZWxfZHNpLT5kdWFsX2xpbmsg
LSAxKQogCQkJCQkJPDwgRFVBTF9MSU5LX01PREVfU0hJRlQ7Ci0JCQlpZiAoSVNfQlJPWFRPTihk
ZXZfcHJpdikpCisJCQlpZiAoSVNfQlJPWFRPTihpOTE1KSkKIAkJCQl0ZW1wIHw9IExBTkVfQ09O
RklHVVJBVElPTl9EVUFMX0xJTktfQTsKIAkJCWVsc2UKIAkJCQl0ZW1wIHw9IGNydGMtPnBpcGUg
PwpAQCAtNzA4LDEyICs3MDgsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX3BvcnRfZW5hYmxl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogc3RhdGljIHZvaWQgaW50ZWxfZHNpX3Bv
cnRfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKIAlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gZW5jb2Rlci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190
b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBwb3J0OwogCiAJZm9yX2Vh
Y2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewotCQlpOTE1X3JlZ190IHBvcnRf
Y3RybCA9IElTX0dFTjlfTFAoZGV2X3ByaXYpID8KKwkJaTkxNV9yZWdfdCBwb3J0X2N0cmwgPSBJ
U19HRU45X0xQKGk5MTUpID8KIAkJCUJYVF9NSVBJX1BPUlRfQ1RSTChwb3J0KSA6IE1JUElfUE9S
VF9DVFJMKHBvcnQpOwogCQl1MzIgdGVtcDsKIApAQCAtNzc1LDcgKzc3NSw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX2RzaV9wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
ewogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29k
ZXItPmJhc2UpOwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmlnLT5iYXNlLmNy
dGM7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5k
ZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5kZXYp
OwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsK
IAlpbnQgcGlwZSA9IGludGVsX2NydGMtPnBpcGU7CiAJZW51bSBwb3J0IHBvcnQ7CkBAIC03ODQs
MTMgKzc4NCwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcHJlX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCURSTV9ERUJVR19LTVMoIlxuIik7CiAKLQlpbnRlbF9z
ZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBwaXBlLCB0cnVlKTsKKwlp
bnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGk5MTUsIHBpcGUsIHRydWUpOwog
CiAJLyoKIAkgKiBUaGUgQklPUyBtYXkgbGVhdmUgdGhlIFBMTCBpbiBhIHdvbmt5IHN0YXRlIHdo
ZXJlIGl0IGRvZXNuJ3QKIAkgKiBsb2NrLiBJdCBuZWVkcyB0byBiZSBmdWxseSBwb3dlcmVkIGRv
d24gdG8gZml4IGl0LgogCSAqLwotCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkgeworCWlmIChJ
U19HRU45X0xQKGk5MTUpKSB7CiAJCWJ4dF9kc2lfcGxsX2Rpc2FibGUoZW5jb2Rlcik7CiAJCWJ4
dF9kc2lfcGxsX2VuYWJsZShlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CiAJfSBlbHNlIHsKQEAgLTc5
OCw3ICs3OTgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcHJlX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJdmx2X2RzaV9wbGxfZW5hYmxlKGVuY29kZXIsIHBpcGVf
Y29uZmlnKTsKIAl9CiAKLQlpZiAoSVNfQlJPWFRPTihkZXZfcHJpdikpIHsKKwlpZiAoSVNfQlJP
WFRPTihpOTE1KSkgewogCQkvKiBBZGQgTUlQSSBJTyByZXNldCBwcm9ncmFtbWluZyBmb3IgbW9k
ZXNldCAqLwogCQl2YWwgPSBJOTE1X1JFQUQoQlhUX1BfQ1JfR1RfRElTUF9QV1JPTik7CiAJCUk5
MTVfV1JJVEUoQlhUX1BfQ1JfR1RfRElTUF9QV1JPTiwKQEAgLTgwOSw3ICs4MDksNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9kc2lfcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAkJSTkxNV9XUklURShCWFRfUF9EU0lfUkVHVUxBVE9SX1RYX0NUUkwsIDApOwogCX0KIAot
CWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkg
eworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJ
dTMyIHZhbDsKIAogCQkvKiBEaXNhYmxlIERQT3VuaXQgY2xvY2sgZ2F0aW5nLCBjYW4gc3RhbGwg
cGlwZSAqLwpAQCAtODE4LDcgKzgxOCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9wcmVfZW5h
YmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlJOTE1X1dSSVRFKERTUENMS19H
QVRFX0QsIHZhbCk7CiAJfQogCi0JaWYgKCFJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwlpZiAo
IUlTX0dFTUlOSUxBS0UoaTkxNSkpCiAJCWludGVsX2RzaV9wcmVwYXJlKGVuY29kZXIsIHBpcGVf
Y29uZmlnKTsKIAogCS8qIFBvd2VyIG9uLCB0cnkgYm90aCBDUkMgcG1pYyBncGlvIGFuZCBWQlQg
Ki8KQEAgLTgzMCw3ICs4MzAsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcHJlX2VuYWJsZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkvKiBEZWFzc2VydCByZXNldCAqLwogCWlu
dGVsX2RzaV92YnRfZXhlY19zZXF1ZW5jZShpbnRlbF9kc2ksIE1JUElfU0VRX0RFQVNTRVJUX1JF
U0VUKTsKIAotCWlmIChJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCWlmIChJU19HRU1JTklM
QUtFKGk5MTUpKSB7CiAJCWdsa19jb2xkX2Jvb3QgPSBnbGtfZHNpX2VuYWJsZV9pbyhlbmNvZGVy
KTsKIAogCQkvKiBQcmVwYXJlIHBvcnQgaW4gY29sZCBib290KHMzL3M0KSBzY2VuYXJpbyAqLwpA
QCAtODQyLDcgKzg0Miw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9wcmVfZW5hYmxlKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWludGVsX2RzaV9kZXZpY2VfcmVhZHkoZW5jb2Rl
cik7CiAKIAkvKiBQcmVwYXJlIHBvcnQgaW4gbm9ybWFsIGJvb3Qgc2NlbmFyaW8gKi8KLQlpZiAo
SVNfR0VNSU5JTEFLRShkZXZfcHJpdikgJiYgIWdsa19jb2xkX2Jvb3QpCisJaWYgKElTX0dFTUlO
SUxBS0UoaTkxNSkgJiYgIWdsa19jb2xkX2Jvb3QpCiAJCWludGVsX2RzaV9wcmVwYXJlKGVuY29k
ZXIsIHBpcGVfY29uZmlnKTsKIAogCS8qIFNlbmQgaW5pdGlhbGl6YXRpb24gY29tbWFuZHMgaW4g
TFAgbW9kZSAqLwpAQCAtOTAxLDkgKzkwMSw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9kaXNh
YmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiBzdGF0aWMgdm9pZCBpbnRlbF9k
c2lfY2xlYXJfZGV2aWNlX3JlYWR5KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAKLQlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJaWYgKElTX0dF
TUlOSUxBS0UoaTkxNSkpCiAJCWdsa19kc2lfY2xlYXJfZGV2aWNlX3JlYWR5KGVuY29kZXIpOwog
CWVsc2UKIAkJdmx2X2RzaV9jbGVhcl9kZXZpY2VfcmVhZHkoZW5jb2Rlcik7CkBAIC05MTMsNyAr
OTEzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX3Bvc3RfZGlzYWJsZShzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcsCiAJCQkJICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNv
bm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kg
PSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9ydDsKIAl1
MzIgdmFsOwpAQCAtOTQxLDcgKzk0MSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9wb3N0X2Rp
c2FibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJLyogVHJhbnNpdGlvbiB0byBM
UC0wMCAqLwogCWludGVsX2RzaV9jbGVhcl9kZXZpY2VfcmVhZHkoZW5jb2Rlcik7CiAKLQlpZiAo
SVNfQlJPWFRPTihkZXZfcHJpdikpIHsKKwlpZiAoSVNfQlJPWFRPTihpOTE1KSkgewogCQkvKiBQ
b3dlciBkb3duIERTSSByZWd1bGF0b3IgdG8gc2F2ZSBwb3dlciAqLwogCQlJOTE1X1dSSVRFKEJY
VF9QX0RTSV9SRUdVTEFUT1JfQ0ZHLCBTVEFQX1NFTEVDVCk7CiAJCUk5MTVfV1JJVEUoQlhUX1Bf
RFNJX1JFR1VMQVRPUl9UWF9DVFJMLCBIU19JT19DVFJMX1NFTEVDVCk7CkBAIC05NTIsNyArOTUy
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX3Bvc3RfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIAkJCQl2YWwgJiB+TUlQSU9fUlNUX0NUUkwpOwogCX0KIAotCWlmIChJ
U19HRU45X0xQKGRldl9wcml2KSkgeworCWlmIChJU19HRU45X0xQKGk5MTUpKSB7CiAJCWJ4dF9k
c2lfcGxsX2Rpc2FibGUoZW5jb2Rlcik7CiAJfSBlbHNlIHsKIAkJdTMyIHZhbDsKQEAgLTk4Myw3
ICs5ODMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcG9zdF9kaXNhYmxlKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogc3RhdGljIGJvb2wgaW50ZWxfZHNpX2dldF9od19zdGF0ZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgICBlbnVtIHBpcGUgKnBpcGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5i
YXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50
ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAllbnVt
IHBvcnQgcG9ydDsKQEAgLTk5MSw3ICs5OTEsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kc2lfZ2V0
X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJRFJNX0RFQlVHX0tN
UygiXG4iKTsKIAotCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVk
KGRldl9wcml2LAorCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVk
KGk5MTUsCiAJCQkJCQkgICAgIGVuY29kZXItPnBvd2VyX2RvbWFpbik7CiAJaWYgKCF3YWtlcmVm
KQogCQlyZXR1cm4gZmFsc2U7CkBAIC0xMDAxLDEyICsxMDAxLDEyIEBAIHN0YXRpYyBib29sIGlu
dGVsX2RzaV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICog
Y29uZmlndXJhdGlvbiwgb3RoZXJ3aXNlIGFjY2Vzc2luZyBEU0kgcmVnaXN0ZXJzIHdpbGwgaGFu
ZyB0aGUKIAkgKiBtYWNoaW5lLiBTZWUgQlNwZWMgTm9ydGggRGlzcGxheSBFbmdpbmUgcmVnaXN0
ZXJzL01JUElbQlhUXS4KIAkgKi8KLQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikgJiYgIWJ4dF9k
c2lfcGxsX2lzX2VuYWJsZWQoZGV2X3ByaXYpKQorCWlmIChJU19HRU45X0xQKGk5MTUpICYmICFi
eHRfZHNpX3BsbF9pc19lbmFibGVkKGk5MTUpKQogCQlnb3RvIG91dF9wdXRfcG93ZXI7CiAKIAkv
KiBYWFg6IHRoaXMgb25seSB3b3JrcyBmb3Igb25lIERTSSBvdXRwdXQgKi8KIAlmb3JfZWFjaF9k
c2lfcG9ydChwb3J0LCBpbnRlbF9kc2ktPnBvcnRzKSB7Ci0JCWk5MTVfcmVnX3QgY3RybF9yZWcg
PSBJU19HRU45X0xQKGRldl9wcml2KSA/CisJCWk5MTVfcmVnX3QgY3RybF9yZWcgPSBJU19HRU45
X0xQKGk5MTUpID8KIAkJCUJYVF9NSVBJX1BPUlRfQ1RSTChwb3J0KSA6IE1JUElfUE9SVF9DVFJM
KHBvcnQpOwogCQlib29sIGVuYWJsZWQgPSBJOTE1X1JFQUQoY3RybF9yZWcpICYgRFBJX0VOQUJM
RTsKIApAQCAtMTAxNSw3ICsxMDE1LDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfZHNpX2dldF9od19z
dGF0ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJICogYml0IGluIHBvcnQgQyBj
b250cm9sIHJlZ2lzdGVyIGRvZXMgbm90IGdldCBzZXQuIEFzIGEKIAkJICogd29ya2Fyb3VuZCwg
Y2hlY2sgcGlwZSBCIGNvbmYgaW5zdGVhZC4KIAkJICovCi0JCWlmICgoSVNfVkFMTEVZVklFVyhk
ZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpICYmCisJCWlmICgoSVNfVkFMTEVZ
VklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSAmJgogCQkgICAgcG9ydCA9PSBQT1JU
X0MpCiAJCQllbmFibGVkID0gSTkxNV9SRUFEKFBJUEVDT05GKFBJUEVfQikpICYgUElQRUNPTkZf
RU5BQkxFOwogCkBAIC0xMDMxLDcgKzEwMzEsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kc2lfZ2V0
X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlpZiAoIShJOTE1X1JF
QUQoTUlQSV9ERVZJQ0VfUkVBRFkocG9ydCkpICYgREVWSUNFX1JFQURZKSkKIAkJCWNvbnRpbnVl
OwogCi0JCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkgeworCQlpZiAoSVNfR0VOOV9MUChpOTE1
KSkgewogCQkJdTMyIHRtcCA9IEk5MTVfUkVBRChNSVBJX0NUUkwocG9ydCkpOwogCQkJdG1wICY9
IEJYVF9QSVBFX1NFTEVDVF9NQVNLOwogCQkJdG1wID4+PSBCWFRfUElQRV9TRUxFQ1RfU0hJRlQ7
CkBAIC0xMDQ5LDcgKzEwNDksNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kc2lfZ2V0X2h3X3N0YXRl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCX0KIAogb3V0X3B1dF9wb3dlcjoKLQlp
bnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgZW5jb2Rlci0+cG93ZXJfZG9tYWluLCB3
YWtlcmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBlbmNvZGVyLT5wb3dlcl9k
b21haW4sIHdha2VyZWYpOwogCiAJcmV0dXJuIGFjdGl2ZTsKIH0KQEAgLTEwNTgsNyArMTA1OCw3
IEBAIHN0YXRpYyB2b2lkIGJ4dF9kc2lfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25m
aWcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmJhc2UuZGV2OwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJCQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3Rl
ZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlX3N3OwpAQCAt
MTIxOCwxMyArMTIxOCwxMyBAQCBzdGF0aWMgdm9pZCBieHRfZHNpX2dldF9waXBlX2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHN0YXRpYyB2b2lkIGludGVsX2RzaV9nZXRf
Y29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAl1MzIgcGNsazsKIAlE
Uk1fREVCVUdfS01TKCJcbiIpOwogCiAJcGlwZV9jb25maWctPm91dHB1dF90eXBlcyB8PSBCSVQo
SU5URUxfT1VUUFVUX0RTSSk7CiAKLQlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKKwlpZiAo
SVNfR0VOOV9MUChpOTE1KSkgewogCQlieHRfZHNpX2dldF9waXBlX2NvbmZpZyhlbmNvZGVyLCBw
aXBlX2NvbmZpZyk7CiAJCXBjbGsgPSBieHRfZHNpX2dldF9wY2xrKGVuY29kZXIsIHBpcGVfY29u
ZmlnKTsKIAl9IGVsc2UgewpAQCAtMTI1NSw3ICsxMjU1LDcgQEAgc3RhdGljIHZvaWQgc2V0X2Rz
aV90aW1pbmdzKHN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICBjb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSkKIHsKIAlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gZW5jb2Rlci0+ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNp
KGVuY29kZXIpOwogCWVudW0gcG9ydCBwb3J0OwogCXVuc2lnbmVkIGludCBicHAgPSBtaXBpX2Rz
aV9waXhlbF9mb3JtYXRfdG9fYnBwKGludGVsX2RzaS0+cGl4ZWxfZm9ybWF0KTsKQEAgLTEyOTAs
NyArMTI5MCw3IEBAIHN0YXRpYyB2b2lkIHNldF9kc2lfdGltaW5ncyhzdHJ1Y3QgZHJtX2VuY29k
ZXIgKmVuY29kZXIsCiAJaGJwID0gdHhieXRlY2xraHMoaGJwLCBicHAsIGxhbmVfY291bnQsIGlu
dGVsX2RzaS0+YnVyc3RfbW9kZV9yYXRpbyk7CiAKIAlmb3JfZWFjaF9kc2lfcG9ydChwb3J0LCBp
bnRlbF9kc2ktPnBvcnRzKSB7Ci0JCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkgeworCQlpZiAo
SVNfR0VOOV9MUChpOTE1KSkgewogCQkJLyoKIAkJCSAqIFByb2dyYW0gaGRpc3BsYXkgYW5kIHZk
aXNwbGF5IG9uIE1JUEkgdHJhbnNjb2Rlci4KIAkJCSAqIFRoaXMgaXMgZGlmZmVyZW50IGZyb20g
Y2FsY3VsYXRlZCBoYWN0aXZlIGFuZApAQCAtMTM0Miw3ICsxMzQyLDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHNpX3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiB7
CiAJc3RydWN0IGRybV9lbmNvZGVyICplbmNvZGVyID0gJmludGVsX2VuY29kZXItPmJhc2U7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMg
PSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOwogCXN0cnVjdCBpbnRlbF9k
c2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koZW5jb2Rlcik7CiAJY29uc3Qgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRq
dXN0ZWRfbW9kZTsKQEAgLTEzNjIsNyArMTM2Miw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9w
cmVwYXJlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyLAogCX0KIAogCWZvcl9l
YWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+cG9ydHMpIHsKLQkJaWYgKElTX1ZBTExFWVZJ
RVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CisJCWlmIChJU19WQUxM
RVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkpIHsKIAkJCS8qCiAJCQkgKiBlc2Nh
cGUgY2xvY2sgZGl2aWRlciwgMjBNSHosIHNoYXJlZCBmb3IgQSBhbmQgQy4KIAkJCSAqIGRldmlj
ZSByZWFkeSBtdXN0IGJlIG9mZiB3aGVuIGRvaW5nIHRoaXMhIHR4Y2xrZXNjPwpAQCAtMTM3Nyw3
ICsxMzc3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX3ByZXBhcmUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmludGVsX2VuY29kZXIsCiAJCQl0bXAgJj0gflJFQURfUkVRVUVTVF9QUklPUklUWV9N
QVNLOwogCQkJSTkxNV9XUklURShNSVBJX0NUUkwocG9ydCksIHRtcCB8CiAJCQkJCVJFQURfUkVR
VUVTVF9QUklPUklUWV9ISUdIKTsKLQkJfSBlbHNlIGlmIChJU19HRU45X0xQKGRldl9wcml2KSkg
eworCQl9IGVsc2UgaWYgKElTX0dFTjlfTFAoaTkxNSkpIHsKIAkJCWVudW0gcGlwZSBwaXBlID0g
aW50ZWxfY3J0Yy0+cGlwZTsKIAogCQkJdG1wID0gSTkxNV9SRUFEKE1JUElfQ1RSTChwb3J0KSk7
CkBAIC0xNDE1LDcgKzE0MTUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcHJlcGFyZShzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlciwKIAlpZiAoaW50ZWxfZHNpLT5jbG9ja19z
dG9wKQogCQl0bXAgfD0gQ0xPQ0tTVE9QOwogCi0JaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKSB7
CisJaWYgKElTX0dFTjlfTFAoaTkxNSkpIHsKIAkJdG1wIHw9IEJYVF9EUEhZX0RFRkVBVFVSRV9F
TjsKIAkJaWYgKCFpc19jbWRfbW9kZShpbnRlbF9kc2kpKQogCQkJdG1wIHw9IEJYVF9ERUZFQVRV
UkVfRFBJX0ZJRk9fQ1RSOwpAQCAtMTQ2Niw3ICsxNDY2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
ZHNpX3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAJCUk5MTVf
V1JJVEUoTUlQSV9JTklUX0NPVU5UKHBvcnQpLAogCQkJCXR4Y2xrZXNjKGludGVsX2RzaS0+ZXNj
YXBlX2Nsa19kaXYsIDEwMCkpOwogCi0JCWlmIChJU19HRU45X0xQKGRldl9wcml2KSAmJiAoIWlu
dGVsX2RzaS0+ZHVhbF9saW5rKSkgeworCQlpZiAoSVNfR0VOOV9MUChpOTE1KSAmJiAoIWludGVs
X2RzaS0+ZHVhbF9saW5rKSkgewogCQkJLyoKIAkJCSAqIEJYVCBzcGVjIHNheXMgd3JpdGUgTUlQ
SV9JTklUX0NPVU5UIGZvcgogCQkJICogYm90aCB0aGUgcG9ydHMsIGV2ZW4gaWYgb25seSBvbmUg
aXMKQEAgLTE1MDAsNyArMTUwMCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9wcmVwYXJlKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyLAogCQkgKi8KIAkJSTkxNV9XUklURShN
SVBJX0xQX0JZVEVDTEsocG9ydCksIGludGVsX2RzaS0+bHBfYnl0ZV9jbGspOwogCi0JCWlmIChJ
U19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCQlpZiAoSVNfR0VNSU5JTEFLRShpOTE1KSkgewog
CQkJSTkxNV9XUklURShNSVBJX1RMUFhfVElNRV9DT1VOVChwb3J0KSwKIAkJCQkJaW50ZWxfZHNp
LT5scF9ieXRlX2Nsayk7CiAJCQkvKiBTaGFkb3cgb2YgRFBIWSByZWcgKi8KQEAgLTE1MzMsMTkg
KzE1MzMsMTkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX3ByZXBhcmUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmludGVsX2VuY29kZXIsCiAKIHN0YXRpYyB2b2lkIGludGVsX2RzaV91bnByZXBhcmUo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3Qg
aW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsK
IAllbnVtIHBvcnQgcG9ydDsKIAl1MzIgdmFsOwogCi0JaWYgKElTX0dFTUlOSUxBS0UoZGV2X3By
aXYpKQorCWlmIChJU19HRU1JTklMQUtFKGk5MTUpKQogCQlyZXR1cm47CiAKIAlmb3JfZWFjaF9k
c2lfcG9ydChwb3J0LCBpbnRlbF9kc2ktPnBvcnRzKSB7CiAJCS8qIFBhbmVsIGNvbW1hbmRzIGNh
biBiZSBzZW50IHdoZW4gY2xvY2sgaXMgaW4gTFAxMSAqLwogCQlJOTE1X1dSSVRFKE1JUElfREVW
SUNFX1JFQURZKHBvcnQpLCAweDApOwogCi0JCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKKwkJ
aWYgKElTX0dFTjlfTFAoaTkxNSkpCiAJCQlieHRfZHNpX3Jlc2V0X2Nsb2NrcyhlbmNvZGVyLCBw
b3J0KTsKIAkJZWxzZQogCQkJdmx2X2RzaV9yZXNldF9jbG9ja3MoZW5jb2RlciwgcG9ydCk7CkBA
IC0xNTk0LDcgKzE1OTQsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3JfZnVu
Y3MgaW50ZWxfZHNpX2Nvbm5lY3Rvcl9mdW5jcyA9IHsKIHN0YXRpYyBlbnVtIGRybV9wYW5lbF9v
cmllbnRhdGlvbgogdmx2X2RzaV9nZXRfaHdfcGFuZWxfb3JpZW50YXRpb24oc3RydWN0IGludGVs
X2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyID0gY29ubmVjdG9yLT5lbmNvZGVyOwogCWVudW0gaW50ZWxfZGlz
cGxheV9wb3dlcl9kb21haW4gcG93ZXJfZG9tYWluOwogCWVudW0gZHJtX3BhbmVsX29yaWVudGF0
aW9uIG9yaWVudGF0aW9uOwpAQCAtMTYwNywxMSArMTYwNywxMSBAQCB2bHZfZHNpX2dldF9od19w
YW5lbF9vcmllbnRhdGlvbihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiAJaWYg
KCFlbmNvZGVyLT5nZXRfaHdfc3RhdGUoZW5jb2RlciwgJnBpcGUpKQogCQlyZXR1cm4gRFJNX01P
REVfUEFORUxfT1JJRU5UQVRJT05fVU5LTk9XTjsKIAotCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19m
b3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJY3J0YyA9IGludGVsX2dldF9jcnRjX2Zvcl9waXBl
KGk5MTUsIHBpcGUpOwogCXBsYW5lID0gdG9faW50ZWxfcGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5
KTsKIAogCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9QSVBFKHBpcGUpOwotCXdha2VyZWYg
PSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGRldl9wcml2LCBwb3dlcl9kb21h
aW4pOworCXdha2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGk5MTUs
IHBvd2VyX2RvbWFpbik7CiAJaWYgKCF3YWtlcmVmKQogCQlyZXR1cm4gRFJNX01PREVfUEFORUxf
T1JJRU5UQVRJT05fVU5LTk9XTjsKIApAQCAtMTYyNCw3ICsxNjI0LDcgQEAgdmx2X2RzaV9nZXRf
aHdfcGFuZWxfb3JpZW50YXRpb24oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQog
CWVsc2UKIAkJb3JpZW50YXRpb24gPSBEUk1fTU9ERV9QQU5FTF9PUklFTlRBVElPTl9OT1JNQUw7
CiAKLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgcG93ZXJfZG9tYWluLCB3YWtl
cmVmKTsKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBwb3dlcl9kb21haW4sIHdha2Vy
ZWYpOwogCiAJcmV0dXJuIG9yaWVudGF0aW9uOwogfQpAQCAtMTYzMiwxMCArMTYzMiwxMCBAQCB2
bHZfZHNpX2dldF9od19wYW5lbF9vcmllbnRhdGlvbihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IpCiBzdGF0aWMgZW51bSBkcm1fcGFuZWxfb3JpZW50YXRpb24KIHZsdl9kc2lfZ2V0
X3BhbmVsX29yaWVudGF0aW9uKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+
YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25u
ZWN0b3ItPmJhc2UuZGV2KTsKIAllbnVtIGRybV9wYW5lbF9vcmllbnRhdGlvbiBvcmllbnRhdGlv
bjsKIAotCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9w
cml2KSkgeworCWlmIChJU19WQUxMRVlWSUVXKGk5MTUpIHx8IElTX0NIRVJSWVZJRVcoaTkxNSkp
IHsKIAkJb3JpZW50YXRpb24gPSB2bHZfZHNpX2dldF9od19wYW5lbF9vcmllbnRhdGlvbihjb25u
ZWN0b3IpOwogCQlpZiAob3JpZW50YXRpb24gIT0gRFJNX01PREVfUEFORUxfT1JJRU5UQVRJT05f
VU5LTk9XTikKIAkJCXJldHVybiBvcmllbnRhdGlvbjsKQEAgLTE2NDYsMTMgKzE2NDYsMTMgQEAg
dmx2X2RzaV9nZXRfcGFuZWxfb3JpZW50YXRpb24oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29u
bmVjdG9yKQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfYWRkX3Byb3BlcnRpZXMoc3RydWN0IGlu
dGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCiAJaWYgKGNv
bm5lY3Rvci0+cGFuZWwuZml4ZWRfbW9kZSkgewogCQl1MzIgYWxsb3dlZF9zY2FsZXJzOwogCiAJ
CWFsbG93ZWRfc2NhbGVycyA9IEJJVChEUk1fTU9ERV9TQ0FMRV9BU1BFQ1QpIHwgQklUKERSTV9N
T0RFX1NDQUxFX0ZVTExTQ1JFRU4pOwotCQlpZiAoIUhBU19HTUNIKGRldl9wcml2KSkKKwkJaWYg
KCFIQVNfR01DSChpOTE1KSkKIAkJCWFsbG93ZWRfc2NhbGVycyB8PSBCSVQoRFJNX01PREVfU0NB
TEVfQ0VOVEVSKTsKIAogCQlkcm1fY29ubmVjdG9yX2F0dGFjaF9zY2FsaW5nX21vZGVfcHJvcGVy
dHkoJmNvbm5lY3Rvci0+YmFzZSwKQEAgLTE2NzksOCArMTY3OSw4IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX2RzaV9hZGRfcHJvcGVydGllcyhzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3Ip
CiBzdGF0aWMgdm9pZCB2bHZfZHBoeV9wYXJhbV9pbml0KHN0cnVjdCBpbnRlbF9kc2kgKmludGVs
X2RzaSkKIHsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50ZWxfZHNpLT5iYXNlLmJhc2Uu
ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsK
LQlzdHJ1Y3QgbWlwaV9jb25maWcgKm1pcGlfY29uZmlnID0gZGV2X3ByaXYtPnZidC5kc2kuY29u
ZmlnOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOworCXN0
cnVjdCBtaXBpX2NvbmZpZyAqbWlwaV9jb25maWcgPSBpOTE1LT52YnQuZHNpLmNvbmZpZzsKIAl1
MzIgdGxweF9ucywgZXh0cmFfYnl0ZV9jb3VudCwgdGxweF91aTsKIAl1MzIgdWlfbnVtLCB1aV9k
ZW47CiAJdTMyIHByZXBhcmVfY250LCBleGl0X3plcm9fY250LCBjbGtfemVyb19jbnQsIHRyYWls
X2NudDsKQEAgLTE3MjcsNyArMTcyNyw3IEBAIHN0YXRpYyB2b2lkIHZsdl9kcGh5X3BhcmFtX2lu
aXQoc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpKQogCSAqIEZvciBHRU1JTklMQUtFIGRwaHlf
cGFyYW1fcmVnIHdpbGwgYmUgcHJvZ3JhbW1lZCBpbiB0ZXJtcyBvZgogCSAqIEhTIGJ5dGUgY2xv
Y2sgY291bnQgZm9yIG90aGVyIHBsYXRmb3JtIGluIEhTIGRkciBjbG9jayBjb3VudAogCSAqLwot
CW11bCA9IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpID8gOCA6IDI7CisJbXVsID0gSVNfR0VNSU5J
TEFLRShpOTE1KSA/IDggOiAyOwogCXRoc19wcmVwYXJlX25zID0gbWF4KG1pcGlfY29uZmlnLT50
aHNfcHJlcGFyZSwKIAkJCSAgICAgbWlwaV9jb25maWctPnRjbGtfcHJlcGFyZSk7CiAKQEAgLTE4
MzcsOSArMTgzNyw5IEBAIHN0YXRpYyB2b2lkIHZsdl9kcGh5X3BhcmFtX2luaXQoc3RydWN0IGlu
dGVsX2RzaSAqaW50ZWxfZHNpKQogCWludGVsX2RzaV9sb2dfcGFyYW1zKGludGVsX2RzaSk7CiB9
CiAKLXZvaWQgdmx2X2RzaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
K3ZvaWQgdmx2X2RzaV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gJmk5MTUtPmRybTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2k7CiAJc3Ry
dWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXI7CiAJc3RydWN0IGRybV9lbmNvZGVyICpl
bmNvZGVyOwpAQCAtMTg1MSwxMyArMTg1MSwxMyBAQCB2b2lkIHZsdl9kc2lfaW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJRFJNX0RFQlVHX0tNUygiXG4iKTsKIAogCS8q
IFRoZXJlIGlzIG5vIGRldGVjdGlvbiBtZXRob2QgZm9yIE1JUEkgc28gcmVseSBvbiBWQlQgKi8K
LQlpZiAoIWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoZGV2X3ByaXYsICZwb3J0KSkKKwlpZiAo
IWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoaTkxNSwgJnBvcnQpKQogCQlyZXR1cm47CiAKLQlp
ZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCi0JCWRldl9wcml2LT5taXBpX21taW9fYmFzZSA9IEJY
VF9NSVBJX0JBU0U7CisJaWYgKElTX0dFTjlfTFAoaTkxNSkpCisJCWk5MTUtPm1pcGlfbW1pb19i
YXNlID0gQlhUX01JUElfQkFTRTsKIAllbHNlCi0JCWRldl9wcml2LT5taXBpX21taW9fYmFzZSA9
IFZMVl9NSVBJX0JBU0U7CisJCWk5MTUtPm1pcGlfbW1pb19iYXNlID0gVkxWX01JUElfQkFTRTsK
IAogCWludGVsX2RzaSA9IGt6YWxsb2Moc2l6ZW9mKCppbnRlbF9kc2kpLCBHRlBfS0VSTkVMKTsK
IAlpZiAoIWludGVsX2RzaSkKQEAgLTE4OTcsMjAgKzE4OTcsMjAgQEAgdm9pZCB2bHZfZHNpX2lu
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIE9uIEJZVC9DSFYsIHBp
cGUgQSBtYXBzIHRvIE1JUEkgRFNJIHBvcnQgQSwgcGlwZSBCIG1hcHMgdG8gTUlQSSBEU0kKIAkg
KiBwb3J0IEMuIEJYVCBpc24ndCBsaW1pdGVkIGxpa2UgdGhpcy4KIAkgKi8KLQlpZiAoSVNfR0VO
OV9MUChkZXZfcHJpdikpCisJaWYgKElTX0dFTjlfTFAoaTkxNSkpCiAJCWludGVsX2VuY29kZXIt
PmNydGNfbWFzayA9IEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKTsKIAll
bHNlIGlmIChwb3J0ID09IFBPUlRfQSkKIAkJaW50ZWxfZW5jb2Rlci0+Y3J0Y19tYXNrID0gQklU
KFBJUEVfQSk7CiAJZWxzZQogCQlpbnRlbF9lbmNvZGVyLT5jcnRjX21hc2sgPSBCSVQoUElQRV9C
KTsKIAotCWlmIChkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPmR1YWxfbGluaykKKwlpZiAoaTkx
NS0+dmJ0LmRzaS5jb25maWctPmR1YWxfbGluaykKIAkJaW50ZWxfZHNpLT5wb3J0cyA9IEJJVChQ
T1JUX0EpIHwgQklUKFBPUlRfQyk7CiAJZWxzZQogCQlpbnRlbF9kc2ktPnBvcnRzID0gQklUKHBv
cnQpOwogCi0JaW50ZWxfZHNpLT5kY3NfYmFja2xpZ2h0X3BvcnRzID0gZGV2X3ByaXYtPnZidC5k
c2kuYmxfcG9ydHM7Ci0JaW50ZWxfZHNpLT5kY3NfY2FiY19wb3J0cyA9IGRldl9wcml2LT52YnQu
ZHNpLmNhYmNfcG9ydHM7CisJaW50ZWxfZHNpLT5kY3NfYmFja2xpZ2h0X3BvcnRzID0gaTkxNS0+
dmJ0LmRzaS5ibF9wb3J0czsKKwlpbnRlbF9kc2ktPmRjc19jYWJjX3BvcnRzID0gaTkxNS0+dmJ0
LmRzaS5jYWJjX3BvcnRzOwogCiAJLyogQ3JlYXRlIGEgRFNJIGhvc3QgKGFuZCBhIGRldmljZSkg
Zm9yIGVhY2ggcG9ydC4gKi8KIAlmb3JfZWFjaF9kc2lfcG9ydChwb3J0LCBpbnRlbF9kc2ktPnBv
cnRzKSB7CkBAIC0xOTQ5LDggKzE5NDksOCBAQCB2b2lkIHZsdl9kc2lfaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICogSW4gY2FzZSBvZiBCWVQgd2l0aCBDUkMgUE1J
Qywgd2UgbmVlZCB0byB1c2UgR1BJTyBmb3IKIAkgKiBQYW5lbCBjb250cm9sLgogCSAqLwotCWlm
ICgoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpICYm
Ci0JICAgIChkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPnB3bV9ibGMgPT0gUFBTX0JMQ19QTUlD
KSkgeworCWlmICgoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUpKSAm
JgorCSAgICAoaTkxNS0+dmJ0LmRzaS5jb25maWctPnB3bV9ibGMgPT0gUFBTX0JMQ19QTUlDKSkg
ewogCQlpbnRlbF9kc2ktPmdwaW9fcGFuZWwgPQogCQkJZ3Bpb2RfZ2V0KGRldi0+ZGV2LCAicGFu
ZWwiLCBHUElPRF9PVVRfSElHSCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3Zsdl9kc2lfcGxsLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS92bHZfZHNpX3BsbC5jCmluZGV4
IDk5Y2MzZTJlOWMyYy4uMjY2NTVkNTQ3MmI0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS92bHZfZHNpX3BsbC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Zsdl9kc2lfcGxs
LmMKQEAgLTUzLDcgKzUzLDcgQEAgc3RhdGljIHUzMiBkc2lfY2xrX2Zyb21fcGNsayh1MzIgcGNs
aywgZW51bSBtaXBpX2RzaV9waXhlbF9mb3JtYXQgZm10LAogCXJldHVybiBkc2lfY2xrX2toejsK
IH0KIAotc3RhdGljIGludCBkc2lfY2FsY19tbnAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAorc3RhdGljIGludCBkc2lfY2FsY19tbnAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY29uZmlnLAogCQkJaW50IHRhcmdl
dF9kc2lfY2xrKQogewpAQCAtNjgsNyArNjgsNyBAQCBzdGF0aWMgaW50IGRzaV9jYWxjX21ucChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybiAtRUNIUk5HOwogCX0K
IAotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCWlmIChJU19DSEVSUllWSUVXKGk5
MTUpKSB7CiAJCXJlZl9jbGsgPSAxMDAwMDA7CiAJCW4gPSA0OwogCQltX21pbiA9IDcwOwpAQCAt
MTE2LDcgKzExNiw3IEBAIHN0YXRpYyBpbnQgZHNpX2NhbGNfbW5wKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIGludCB2bHZfZHNpX3BsbF9jb21wdXRlKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNvbmZpZykKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRl
bF9kc2koJmVuY29kZXItPmJhc2UpOwogCWludCByZXQ7CiAJdTMyIGRzaV9jbGs7CkBAIC0xMjQs
NyArMTI0LDcgQEAgaW50IHZsdl9kc2lfcGxsX2NvbXB1dGUoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJZHNpX2NsayA9IGRzaV9jbGtfZnJvbV9wY2xrKGludGVsX2RzaS0+cGNsaywg
aW50ZWxfZHNpLT5waXhlbF9mb3JtYXQsCiAJCQkJICAgIGludGVsX2RzaS0+bGFuZV9jb3VudCk7
CiAKLQlyZXQgPSBkc2lfY2FsY19tbnAoZGV2X3ByaXYsIGNvbmZpZywgZHNpX2Nsayk7CisJcmV0
ID0gZHNpX2NhbGNfbW5wKGk5MTUsIGNvbmZpZywgZHNpX2Nsayk7CiAJaWYgKHJldCkgewogCQlE
Uk1fREVCVUdfS01TKCJkc2lfY2FsY19tbnAgZmFpbGVkXG4iKTsKIAkJcmV0dXJuIHJldDsKQEAg
LTE0NywxNSArMTQ3LDE1IEBAIGludCB2bHZfZHNpX3BsbF9jb21wdXRlKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogdm9pZCB2bHZfZHNpX3BsbF9lbmFibGUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY29uZmln
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CiAKIAlEUk1fREVCVUdfS01TKCJcbiIpOwogCi0Jdmx2X2Nja19n
ZXQoZGV2X3ByaXYpOworCXZsdl9jY2tfZ2V0KGk5MTUpOwogCi0Jdmx2X2Nja193cml0ZShkZXZf
cHJpdiwgQ0NLX1JFR19EU0lfUExMX0NPTlRST0wsIDApOwotCXZsdl9jY2tfd3JpdGUoZGV2X3By
aXYsIENDS19SRUdfRFNJX1BMTF9ESVZJREVSLCBjb25maWctPmRzaV9wbGwuZGl2KTsKLQl2bHZf
Y2NrX3dyaXRlKGRldl9wcml2LCBDQ0tfUkVHX0RTSV9QTExfQ09OVFJPTCwKKwl2bHZfY2NrX3dy
aXRlKGk5MTUsIENDS19SRUdfRFNJX1BMTF9DT05UUk9MLCAwKTsKKwl2bHZfY2NrX3dyaXRlKGk5
MTUsIENDS19SRUdfRFNJX1BMTF9ESVZJREVSLCBjb25maWctPmRzaV9wbGwuZGl2KTsKKwl2bHZf
Y2NrX3dyaXRlKGk5MTUsIENDS19SRUdfRFNJX1BMTF9DT05UUk9MLAogCQkgICAgICBjb25maWct
PmRzaV9wbGwuY3RybCAmIH5EU0lfUExMX1ZDT19FTik7CiAKIAkvKiB3YWl0IGF0IGxlYXN0IDAu
NSB1cyBhZnRlciB1bmdhdGluZyBiZWZvcmUgZW5hYmxpbmcgVkNPLApAQCAtMTYzLDM4ICsxNjMs
MzggQEAgdm9pZCB2bHZfZHNpX3BsbF9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAJICovCiAJdXNsZWVwX3JhbmdlKDEwLCA1MCk7CiAKLQl2bHZfY2NrX3dyaXRlKGRldl9w
cml2LCBDQ0tfUkVHX0RTSV9QTExfQ09OVFJPTCwgY29uZmlnLT5kc2lfcGxsLmN0cmwpOworCXZs
dl9jY2tfd3JpdGUoaTkxNSwgQ0NLX1JFR19EU0lfUExMX0NPTlRST0wsIGNvbmZpZy0+ZHNpX3Bs
bC5jdHJsKTsKIAotCWlmICh3YWl0X2Zvcih2bHZfY2NrX3JlYWQoZGV2X3ByaXYsIENDS19SRUdf
RFNJX1BMTF9DT05UUk9MKSAmCisJaWYgKHdhaXRfZm9yKHZsdl9jY2tfcmVhZChpOTE1LCBDQ0tf
UkVHX0RTSV9QTExfQ09OVFJPTCkgJgogCQkJCQkJRFNJX1BMTF9MT0NLLCAyMCkpIHsKIAotCQl2
bHZfY2NrX3B1dChkZXZfcHJpdik7CisJCXZsdl9jY2tfcHV0KGk5MTUpOwogCQlEUk1fRVJST1Io
IkRTSSBQTEwgbG9jayBmYWlsZWRcbiIpOwogCQlyZXR1cm47CiAJfQotCXZsdl9jY2tfcHV0KGRl
dl9wcml2KTsKKwl2bHZfY2NrX3B1dChpOTE1KTsKIAogCURSTV9ERUJVR19LTVMoIkRTSSBQTEwg
bG9ja2VkXG4iKTsKIH0KIAogdm9pZCB2bHZfZHNpX3BsbF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTMyIHRtcDsKIAogCURSTV9ERUJV
R19LTVMoIlxuIik7CiAKLQl2bHZfY2NrX2dldChkZXZfcHJpdik7CisJdmx2X2Nja19nZXQoaTkx
NSk7CiAKLQl0bXAgPSB2bHZfY2NrX3JlYWQoZGV2X3ByaXYsIENDS19SRUdfRFNJX1BMTF9DT05U
Uk9MKTsKKwl0bXAgPSB2bHZfY2NrX3JlYWQoaTkxNSwgQ0NLX1JFR19EU0lfUExMX0NPTlRST0wp
OwogCXRtcCAmPSB+RFNJX1BMTF9WQ09fRU47CiAJdG1wIHw9IERTSV9QTExfTERPX0dBVEU7Ci0J
dmx2X2Nja193cml0ZShkZXZfcHJpdiwgQ0NLX1JFR19EU0lfUExMX0NPTlRST0wsIHRtcCk7CisJ
dmx2X2Nja193cml0ZShpOTE1LCBDQ0tfUkVHX0RTSV9QTExfQ09OVFJPTCwgdG1wKTsKIAotCXZs
dl9jY2tfcHV0KGRldl9wcml2KTsKKwl2bHZfY2NrX3B1dChpOTE1KTsKIH0KIAotYm9vbCBieHRf
ZHNpX3BsbF9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2Jv
b2wgYnh0X2RzaV9wbGxfaXNfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKIAlib29sIGVuYWJsZWQ7CiAJdTMyIHZhbDsKQEAgLTIxNiw3ICsyMTYsNyBAQCBib29sIGJ4
dF9kc2lfcGxsX2lzX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CSAqIGNhdXNlcyBhIHN5c3RlbSBoYW5nLgogCSAqLwogCXZhbCA9IEk5MTVfUkVBRChCWFRfRFNJ
X1BMTF9DVEwpOwotCWlmIChJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCWlmIChJU19HRU1J
TklMQUtFKGk5MTUpKSB7CiAJCWlmICghKHZhbCAmIEJYVF9EU0lBXzE2WF9NQVNLKSkgewogCQkJ
RFJNX0RFQlVHX0RSSVZFUigiSW52YWxpZCBQTEwgZGl2aWRlciAoJTA4eClcbiIsIHZhbCk7CiAJ
CQllbmFibGVkID0gZmFsc2U7CkBAIC0yMzMsNyArMjMzLDcgQEAgYm9vbCBieHRfZHNpX3BsbF9p
c19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogdm9pZCBieHRf
ZHNpX3BsbF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CiAJdTMyIHZhbDsKIAogCURSTV9ERUJVR19LTVMoIlxuIik7CkBAIC0yNDYsNyArMjQ2
LDcgQEAgdm9pZCBieHRfZHNpX3BsbF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyKQogCSAqIFBMTCBsb2NrIHNob3VsZCBkZWFzc2VydCB3aXRoaW4gMjAwdXMuCiAJICogV2Fp
dCB1cCB0byAxbXMgYmVmb3JlIHRpbWluZyBvdXQuCiAJICovCi0JaWYgKGludGVsX3dhaXRfZm9y
X3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3Rl
cigmaTkxNS0+dW5jb3JlLAogCQkJCSAgICBCWFRfRFNJX1BMTF9FTkFCTEUsCiAJCQkJICAgIEJY
VF9EU0lfUExMX0xPQ0tFRCwKIAkJCQkgICAgMCwKQEAgLTI1NywyMSArMjU3LDIxIEBAIHZvaWQg
Ynh0X2RzaV9wbGxfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHUzMiB2
bHZfZHNpX2dldF9wY2xrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkgICAgIHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjb25maWcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3Qg
aW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsK
IAlpbnQgYnBwID0gbWlwaV9kc2lfcGl4ZWxfZm9ybWF0X3RvX2JwcChpbnRlbF9kc2ktPnBpeGVs
X2Zvcm1hdCk7CiAJdTMyIGRzaV9jbG9jaywgcGNsazsKIAl1MzIgcGxsX2N0bCwgcGxsX2RpdjsK
IAl1MzIgbSA9IDAsIHAgPSAwLCBuOwotCWludCByZWZjbGsgPSBJU19DSEVSUllWSUVXKGRldl9w
cml2KSA/IDEwMDAwMCA6IDI1MDAwOworCWludCByZWZjbGsgPSBJU19DSEVSUllWSUVXKGk5MTUp
ID8gMTAwMDAwIDogMjUwMDA7CiAJaW50IGk7CiAKIAlEUk1fREVCVUdfS01TKCJcbiIpOwogCi0J
dmx2X2Nja19nZXQoZGV2X3ByaXYpOwotCXBsbF9jdGwgPSB2bHZfY2NrX3JlYWQoZGV2X3ByaXYs
IENDS19SRUdfRFNJX1BMTF9DT05UUk9MKTsKLQlwbGxfZGl2ID0gdmx2X2Nja19yZWFkKGRldl9w
cml2LCBDQ0tfUkVHX0RTSV9QTExfRElWSURFUik7Ci0Jdmx2X2Nja19wdXQoZGV2X3ByaXYpOwor
CXZsdl9jY2tfZ2V0KGk5MTUpOworCXBsbF9jdGwgPSB2bHZfY2NrX3JlYWQoaTkxNSwgQ0NLX1JF
R19EU0lfUExMX0NPTlRST0wpOworCXBsbF9kaXYgPSB2bHZfY2NrX3JlYWQoaTkxNSwgQ0NLX1JF
R19EU0lfUExMX0RJVklERVIpOworCXZsdl9jY2tfcHV0KGk5MTUpOwogCiAJY29uZmlnLT5kc2lf
cGxsLmN0cmwgPSBwbGxfY3RsICYgfkRTSV9QTExfTE9DSzsKIAljb25maWctPmRzaV9wbGwuZGl2
ID0gcGxsX2RpdjsKQEAgLTMyNSw3ICszMjUsNyBAQCB1MzIgYnh0X2RzaV9nZXRfcGNsayhzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAl1MzIgZHNpX2NsazsKIAl1MzIgZHNpX3JhdGlv
OwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29k
ZXItPmJhc2UpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJaW50IGJwcCA9IG1pcGlfZHNpX3BpeGVsX2Zvcm1h
dF90b19icHAoaW50ZWxfZHNpLT5waXhlbF9mb3JtYXQpOwogCiAJY29uZmlnLT5kc2lfcGxsLmN0
cmwgPSBJOTE1X1JFQUQoQlhUX0RTSV9QTExfQ1RMKTsKQEAgLTM0Myw3ICszNDMsNyBAQCB1MzIg
Ynh0X2RzaV9nZXRfcGNsayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHZvaWQgdmx2
X2RzaV9yZXNldF9jbG9ja3Moc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGVudW0gcG9y
dCBwb3J0KQogewogCXUzMiB0ZW1wOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAq
aW50ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAKIAl0ZW1wID0g
STkxNV9SRUFEKE1JUElfQ1RSTChwb3J0KSk7CkBAIC0zNTYsNyArMzU2LDcgQEAgdm9pZCB2bHZf
ZHNpX3Jlc2V0X2Nsb2NrcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgZW51bSBwb3J0
IHBvcnQpCiBzdGF0aWMgdm9pZCBnbGtfZHNpX3Byb2dyYW1fZXNjX2Nsb2NrKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsCiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNvbmZp
ZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJdTMyIGRz
aV9yYXRlID0gMDsKIAl1MzIgcGxsX3JhdGlvID0gMDsKIAl1MzIgZGRyX2NsayA9IDA7CkBAIC00
MDQsNyArNDA0LDcgQEAgc3RhdGljIHZvaWQgZ2xrX2RzaV9wcm9ncmFtX2VzY19jbG9jayhzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LAogc3RhdGljIHZvaWQgYnh0X2RzaV9wcm9ncmFtX2Nsb2Nrcyhz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBlbnVtIHBvcnQgcG9ydCwKIAkJCQkgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY29uZmlnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZGV2KTsKIAl1MzIgdG1wOwogCXUzMiBkc2lfcmF0ZSA9IDA7CiAJdTMyIHBs
bF9yYXRpbyA9IDA7CkBAIC00NTcsNyArNDU3LDcgQEAgc3RhdGljIHZvaWQgYnh0X2RzaV9wcm9n
cmFtX2Nsb2NrcyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBlbnVtIHBvcnQgcG9ydCwKIGludCBi
eHRfZHNpX3BsbF9jb21wdXRlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNvbmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBp
bnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwog
CXU4IGRzaV9yYXRpbywgZHNpX3JhdGlvX21pbiwgZHNpX3JhdGlvX21heDsKIAl1MzIgZHNpX2Ns
azsKQEAgLTQ3Miw3ICs0NzIsNyBAQCBpbnQgYnh0X2RzaV9wbGxfY29tcHV0ZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkgKi8KIAlkc2lfcmF0aW8gPSBESVZfUk9VTkRfVVAoZHNp
X2NsayAqIDIsIEJYVF9SRUZfQ0xPQ0tfS0haKTsKIAotCWlmIChJU19CUk9YVE9OKGRldl9wcml2
KSkgeworCWlmIChJU19CUk9YVE9OKGk5MTUpKSB7CiAJCWRzaV9yYXRpb19taW4gPSBCWFRfRFNJ
X1BMTF9SQVRJT19NSU47CiAJCWRzaV9yYXRpb19tYXggPSBCWFRfRFNJX1BMTF9SQVRJT19NQVg7
CiAJfSBlbHNlIHsKQEAgLTQ5Niw3ICs0OTYsNyBAQCBpbnQgYnh0X2RzaV9wbGxfY29tcHV0ZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkvKiBBcyBwZXIgcmVjb21tZW5kYXRpb24g
ZnJvbSBoYXJkd2FyZSB0ZWFtLAogCSAqIFByb2cgUFZEIHJhdGlvID0xIGlmIGRzaSByYXRpbyA8
PSA1MAogCSAqLwotCWlmIChJU19CUk9YVE9OKGRldl9wcml2KSAmJiBkc2lfcmF0aW8gPD0gNTAp
CisJaWYgKElTX0JST1hUT04oaTkxNSkgJiYgZHNpX3JhdGlvIDw9IDUwKQogCQljb25maWctPmRz
aV9wbGwuY3RybCB8PSBCWFRfRFNJX1BMTF9QVkRfUkFUSU9fMTsKIAogCXJldHVybiAwOwpAQCAt
NTA1LDcgKzUwNSw3IEBAIGludCBieHRfZHNpX3BsbF9jb21wdXRlKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogdm9pZCBieHRfZHNpX3BsbF9lbmFibGUoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY29uZmlnKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNv
ZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpID0gZW5jX3RvX2lu
dGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJZW51bSBwb3J0IHBvcnQ7CiAJdTMyIHZhbDsKQEAg
LTUxNyw3ICs1MTcsNyBAQCB2b2lkIGJ4dF9kc2lfcGxsX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIAlQT1NUSU5HX1JFQUQoQlhUX0RTSV9QTExfQ1RMKTsKIAogCS8qIFBy
b2dyYW0gVFgsIFJYLCBEcGh5IGNsb2NrcyAqLwotCWlmIChJU19CUk9YVE9OKGRldl9wcml2KSkg
eworCWlmIChJU19CUk9YVE9OKGk5MTUpKSB7CiAJCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGlu
dGVsX2RzaS0+cG9ydHMpCiAJCQlieHRfZHNpX3Byb2dyYW1fY2xvY2tzKGVuY29kZXItPmJhc2Uu
ZGV2LCBwb3J0LCBjb25maWcpOwogCX0gZWxzZSB7CkBAIC01MzAsNyArNTMwLDcgQEAgdm9pZCBi
eHRfZHNpX3BsbF9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJSTkxNV9X
UklURShCWFRfRFNJX1BMTF9FTkFCTEUsIHZhbCk7CiAKIAkvKiBUaW1lb3V0IGFuZCBmYWlsIGlm
IFBMTCBub3QgbG9ja2VkICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJp
di0+dW5jb3JlLAorCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmaTkxNS0+dW5jb3JlLAog
CQkJCSAgICBCWFRfRFNJX1BMTF9FTkFCTEUsCiAJCQkJICAgIEJYVF9EU0lfUExMX0xPQ0tFRCwK
IAkJCQkgICAgQlhUX0RTSV9QTExfTE9DS0VELApAQCAtNTQ2LDEwICs1NDYsMTAgQEAgdm9pZCBi
eHRfZHNpX3Jlc2V0X2Nsb2NrcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgZW51bSBw
b3J0IHBvcnQpCiB7CiAJdTMyIHRtcDsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gZW5jb2Rl
ci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwog
CiAJLyogQ2xlYXIgb2xkIGNvbmZpZ3VyYXRpb25zICovCi0JaWYgKElTX0JST1hUT04oZGV2X3By
aXYpKSB7CisJaWYgKElTX0JST1hUT04oaTkxNSkpIHsKIAkJdG1wID0gSTkxNV9SRUFEKEJYVF9N
SVBJX0NMT0NLX0NUTCk7CiAJCXRtcCAmPSB+KEJYVF9NSVBJX1RYX0VTQ0xLX0ZJWERJVl9NQVNL
KHBvcnQpKTsKIAkJdG1wICY9IH4oQlhUX01JUElfUlhfRVNDTEtfVVBQRVJfRklYRElWX01BU0so
cG9ydCkpOwotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B50CF348B
	for <lists+intel-gfx@lfdr.de>; Thu,  7 Nov 2019 17:21:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C1FA16F73A;
	Thu,  7 Nov 2019 16:21:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E9C356F73A
 for <intel-gfx@lists.freedesktop.org>; Thu,  7 Nov 2019 16:21:47 +0000 (UTC)
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 07 Nov 2019 08:21:47 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,278,1569308400"; d="scan'208";a="206191744"
Received: from nvishwa1-desk.sc.intel.com ([10.3.160.185])
 by orsmga006.jf.intel.com with ESMTP; 07 Nov 2019 08:21:46 -0800
Date: Thu, 7 Nov 2019 08:09:31 -0800
From: Niranjan Vishwanathapura <niranjana.vishwanathapura@intel.com>
To: Chris Wilson <chris@chris-wilson.co.uk>
Message-ID: <20191107160930.GH19940@nvishwa1-DESK.sc.intel.com>
References: <20191106091312.12921-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20191106091312.12921-1-chris@chris-wilson.co.uk>
User-Agent: Mutt/1.5.24 (2015-08-30)
Subject: Re: [Intel-gfx] [PATCH] drm/i915/gem: Safely acquire the ctx->vm
 when copying
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gV2VkLCBOb3YgMDYsIDIwMTkgYXQgMDk6MTM6MTJBTSArMDAwMCwgQ2hyaXMgV2lsc29uIHdy
b3RlOgo+QXMgd2UgcmVhZCB0aGUgY3R4LT52bSB1bmxvY2tlZCBiZWZvcmUgY2xvbmluZy9leHBv
cnRpbmcsIHdlIHNob3VsZAo+dmFsaWRhdGUgb3VyIHJlZmVyZW5jZSBpcyBjb3JyZWN0IGJlZm9y
ZSByZXR1cm5pbmcgaXQuIFdlIGFscmVhZHkgZG8gZm9yCj5jbG9uZV92bSgpIGJ1dCB3ZXJlIG5v
dCBzbyBzdHJpY3QgYXJvdW5kIGdldF9wcGd0dCgpLgo+Cj5TaWduZWQtb2ZmLWJ5OiBDaHJpcyBX
aWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KPi0tLQo+IGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgfCA4MCArKysrKysrKysrKy0tLS0tLS0tLS0KPiAx
IGZpbGUgY2hhbmdlZCwgNDMgaW5zZXJ0aW9ucygrKSwgMzcgZGVsZXRpb25zKC0pCj4KPmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwo+aW5kZXggZGU2ZTU1YWY4
MmNmLi5hMDZjYzhlNjMyODEgMTAwNjQ0Cj4tLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5jCj4rKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jCj5AQCAtOTk1LDYgKzk5NSwzOCBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFy
cmllcl90YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCj4gCXJldHVybiBlcnI7Cj4g
fQo+Cj4rc3RhdGljIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgo+K2NvbnRleHRfZ2V0X3Zt
X3JjdShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQo+K3sKPisJZG8gewo+KwkJc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07Cj4rCj4rCQl2bSA9IHJjdV9kZXJlZmVyZW5jZShjdHgt
PnZtKTsKPisJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJnZtLT5yZWYpKQo+KwkJCWNvbnRp
bnVlOwoKQnV0IHNob3VsZCB3ZSBjaGVjayBmb3IgTlVMTCB2bT8KSSBrbm93IHRoZSBjYWxsZXJz
IGFyZSBlbnN1cmluZyBjdHgtPnZtIHdpbGwgbm90IGJlIE5VTEwsIGJ1dCBqdXN0IHdvbmRlcmlu
Zy4KCj4rCj4rCQkvKgo+KwkJICogVGhpcyBwcGd0dCBtYXkgaGF2ZSBiZSByZWFsbG9jYXRlZCBi
ZXR3ZWVuCj4rCQkgKiB0aGUgcmVhZCBhbmQgdGhlIGtyZWYsIGFuZCByZWFzc2lnbmVkIHRvIGEg
dGhpcmQKPisJCSAqIGNvbnRleHQuIEluIG9yZGVyIHRvIGF2b2lkIGluYWR2ZXJ0ZW50IHNoYXJp
bmcKPisJCSAqIG9mIHRoaXMgcHBndHQgd2l0aCB0aGF0IHRoaXJkIGNvbnRleHQgKGFuZCBub3QK
PisJCSAqIHNyYyksIHdlIGhhdmUgdG8gY29uZmlybSB0aGF0IHdlIGhhdmUgdGhlIHNhbWUKPisJ
CSAqIHBwZ3R0IGFmdGVyIHBhc3NpbmcgdGhyb3VnaCB0aGUgc3Ryb25nIG1lbW9yeQo+KwkJICog
YmFycmllciBpbXBsaWVkIGJ5IGEgc3VjY2Vzc2Z1bAo+KwkJICoga3JlZl9nZXRfdW5sZXNzX3pl
cm8oKS4KPisJCSAqCj4rCQkgKiBPbmNlIHdlIGhhdmUgYWNxdWlyZWQgdGhlIGN1cnJlbnQgcHBn
dHQgb2Ygc3JjLAo+KwkJICogd2Ugbm8gbG9uZ2VyIGNhcmUgaWYgaXQgaXMgcmVsZWFzZWQgZnJv
bSBzcmMsIGFzCj4rCQkgKiBpdCBjYW5ub3QgYmUgcmVhbGxvY2F0ZWQgZWxzZXdoZXJlLgo+KwkJ
ICovCgpDb21tZW50IHNob3VsZCBiZSBtYWRlIGdlbmVyaWM/IEl0IGlzIHRvbyBzcGVjaWZpYyB0
byBjbG9uaW5nIGNhc2UuCgpPdGhlciB0aGFuIHRoYXQsIHBhdGNoIGxvb2tzIGdvb2QgdG8gbWUu
ClJldmlld2VkLWJ5OiBOaXJhbmphbmEgVmlzaHdhbmF0aGFwdXJhIDxuaXJhbmphbmEudmlzaHdh
bmF0aGFwdXJhQGludGVsLmNvbT4KCj4rCj4rCQlpZiAodm0gPT0gcmN1X2FjY2Vzc19wb2ludGVy
KGN0eC0+dm0pKQo+KwkJCXJldHVybiByY3VfcG9pbnRlcl9oYW5kb2ZmKHZtKTsKPisKPisJCWk5
MTVfdm1fcHV0KHZtKTsKPisJfSB3aGlsZSAoMSk7Cj4rfQo+Kwo+IHN0YXRpYyBpbnQgZ2V0X3Bw
Z3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKPiAJCSAgICAgc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKPiAJCSAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9j
b250ZXh0X3BhcmFtICphcmdzKQo+QEAgLTEwMDYsNyArMTAzOCw3IEBAIHN0YXRpYyBpbnQgZ2V0
X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKPiAJCXJldHVy
biAtRU5PREVWOwo+Cj4gCXJjdV9yZWFkX2xvY2soKTsKPi0Jdm0gPSBpOTE1X3ZtX2dldChjdHgt
PnZtKTsKPisJdm0gPSBjb250ZXh0X2dldF92bV9yY3UoY3R4KTsKPiAJcmN1X3JlYWRfdW5sb2Nr
KCk7Cj4KPiAJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZmaWxlX3ByaXYtPnZtX2lk
cl9sb2NrKTsKPkBAIC0yMDM1LDQ3ICsyMDY3LDIxIEBAIHN0YXRpYyBpbnQgY2xvbmVfdm0oc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwKPiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm07Cj4gCWludCBlcnIgPSAwOwo+Cj4tCXJjdV9yZWFkX2xvY2soKTsKPi0JZG8gewo+LQkJdm0g
PSByY3VfZGVyZWZlcmVuY2Uoc3JjLT52bSk7Cj4tCQlpZiAoIXZtKQo+LQkJCWJyZWFrOwo+LQo+
LQkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmdm0tPnJlZikpCj4tCQkJY29udGludWU7Cj4t
Cj4tCQkvKgo+LQkJICogVGhpcyBwcGd0dCBtYXkgaGF2ZSBiZSByZWFsbG9jYXRlZCBiZXR3ZWVu
Cj4tCQkgKiB0aGUgcmVhZCBhbmQgdGhlIGtyZWYsIGFuZCByZWFzc2lnbmVkIHRvIGEgdGhpcmQK
Pi0JCSAqIGNvbnRleHQuIEluIG9yZGVyIHRvIGF2b2lkIGluYWR2ZXJ0ZW50IHNoYXJpbmcKPi0J
CSAqIG9mIHRoaXMgcHBndHQgd2l0aCB0aGF0IHRoaXJkIGNvbnRleHQgKGFuZCBub3QKPi0JCSAq
IHNyYyksIHdlIGhhdmUgdG8gY29uZmlybSB0aGF0IHdlIGhhdmUgdGhlIHNhbWUKPi0JCSAqIHBw
Z3R0IGFmdGVyIHBhc3NpbmcgdGhyb3VnaCB0aGUgc3Ryb25nIG1lbW9yeQo+LQkJICogYmFycmll
ciBpbXBsaWVkIGJ5IGEgc3VjY2Vzc2Z1bAo+LQkJICoga3JlZl9nZXRfdW5sZXNzX3plcm8oKS4K
Pi0JCSAqCj4tCQkgKiBPbmNlIHdlIGhhdmUgYWNxdWlyZWQgdGhlIGN1cnJlbnQgcHBndHQgb2Yg
c3JjLAo+LQkJICogd2Ugbm8gbG9uZ2VyIGNhcmUgaWYgaXQgaXMgcmVsZWFzZWQgZnJvbSBzcmMs
IGFzCj4tCQkgKiBpdCBjYW5ub3QgYmUgcmVhbGxvY2F0ZWQgZWxzZXdoZXJlLgo+LQkJICovCj4t
Cj4tCQlpZiAodm0gPT0gcmN1X2FjY2Vzc19wb2ludGVyKHNyYy0+dm0pKQo+LQkJCWJyZWFrOwo+
KwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihzcmMtPnZtKSkKPisJCXJldHVybiAwOwo+Cj4tCQlp
OTE1X3ZtX3B1dCh2bSk7Cj4tCX0gd2hpbGUgKDEpOwo+KwlyY3VfcmVhZF9sb2NrKCk7Cj4rCXZt
ID0gY29udGV4dF9nZXRfdm1fcmN1KHNyYyk7Cj4gCXJjdV9yZWFkX3VubG9jaygpOwo+Cj4tCWlm
ICh2bSkgewo+LQkJaWYgKCFtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRzdC0+bXV0ZXgpKSB7
Cj4tCQkJX19hc3NpZ25fcHBndHQoZHN0LCB2bSk7Cj4tCQkJbXV0ZXhfdW5sb2NrKCZkc3QtPm11
dGV4KTsKPi0JCX0gZWxzZSB7Cj4tCQkJZXJyID0gLUVJTlRSOwo+LQkJfQo+LQkJaTkxNV92bV9w
dXQodm0pOwo+KwlpZiAoIW11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZHN0LT5tdXRleCkpIHsK
PisJCV9fYXNzaWduX3BwZ3R0KGRzdCwgdm0pOwo+KwkJbXV0ZXhfdW5sb2NrKCZkc3QtPm11dGV4
KTsKPisJfSBlbHNlIHsKPisJCWVyciA9IC1FSU5UUjsKPiAJfQo+Cj4rCWk5MTVfdm1fcHV0KHZt
KTsKPiAJcmV0dXJuIGVycjsKPiB9Cj4KPi0tIAo+Mi4yNC4wCj4KPl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCj5JbnRlbC1nZnggbWFpbGluZyBsaXN0Cj5J
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCj5odHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeApfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B6D9E82E5C
	for <lists+intel-gfx@lfdr.de>; Tue,  6 Aug 2019 11:06:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9AA896E348;
	Tue,  6 Aug 2019 09:06:07 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1D9846E347
 for <intel-gfx@lists.freedesktop.org>; Tue,  6 Aug 2019 09:06:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17901466-1500050 
 for multiple; Tue, 06 Aug 2019 10:05:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  6 Aug 2019 10:05:22 +0100
Message-Id: <20190806090535.14807-9-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190806090535.14807-1-chris@chris-wilson.co.uk>
References: <20190806090535.14807-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 09/22] drm/i915: Lift timeline into intel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW92ZSB0aGUgdGltZWxpbmUgZnJvbSBiZWluZyBpbnNpZGUgdGhlIGludGVsX3JpbmcgdG8gaW50
ZWxfY29udGV4dAppdHNlbGYuIFRoaXMgc2F2ZXMgbXVjaCBwb2ludGVyIGRhbmNpbmcgYW5kIG1h
a2VzIHRoZSByZWxhdGlvbnMgb2YgdGhlCmNvbnRleHQgdG8gaXRzIHRpbWVsaW5lIG11Y2ggY2xl
YXJlci4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8
IDM1ICsrKysrKystLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YyAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgICAg
ICAgfCAyMSArKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaCAg
ICAgICB8ICA4ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBl
cy5oIHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmggICAgICAg
IHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jICAgICB8
ICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oICB8ICA4
ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgIHwgMzMg
KysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jICAg
IHwgNjMgKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2Vu
Z2luZS5jICAgICAgICAgfCA2NCArKysrKysrKy0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmUuYyAgICAgICAgICAgIHwgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcmVxdWVzdC5jICAgICAgICAgICB8IDEwICstLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW1fZXZpY3QuYyAgIHwgMTkgKysrLS0tCiAxNSBmaWxlcyBjaGFuZ2VkLCAx
NDIgaW5zZXJ0aW9ucygrKSwgMTM1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDYyNzRjZmUzYWQzYy4uZjI2YzIxZTc0ZWRh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTQ4
OCw2ICs0ODgsMjkgQEAgc3RhdGljIHZvaWQgX19hc3NpZ25fcHBndHQoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwKIAkJaTkxNV92bV9wdXQodm0pOwogfQogCitzdGF0aWMgdm9pZCBfX3Nl
dF90aW1lbGluZShzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKipkc3QsCisJCQkgICBzdHJ1Y3QgaW50
ZWxfdGltZWxpbmUgKnNyYykKK3sKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKm9sZCA9ICpkc3Q7
CisKKwkqZHN0ID0gc3JjID8gaW50ZWxfdGltZWxpbmVfZ2V0KHNyYykgOiBOVUxMOworCisJaWYg
KG9sZCkKKwkJaW50ZWxfdGltZWxpbmVfcHV0KG9sZCk7Cit9CisKK3N0YXRpYyB2b2lkIF9fYXBw
bHlfdGltZWxpbmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB2b2lkICp0aW1lbGluZSkKK3sK
KwlfX3NldF90aW1lbGluZSgmY2UtPnRpbWVsaW5lLCB0aW1lbGluZSk7Cit9CisKK3N0YXRpYyB2
b2lkIF9fYXNzaWduX3RpbWVsaW5lKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCisJCQkg
ICAgICBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lKQoreworCV9fc2V0X3RpbWVsaW5l
KCZjdHgtPnRpbWVsaW5lLCB0aW1lbGluZSk7CisJY29udGV4dF9hcHBseV9hbGwoY3R4LCBfX2Fw
cGx5X3RpbWVsaW5lLCB0aW1lbGluZSk7Cit9CisKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqCiBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIHVuc2lnbmVkIGludCBmbGFncykKIHsKQEAgLTUzMCw3ICs1NTMsOCBAQCBpOTE1
X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHVu
c2lnbmVkIGludCBmbGFncykKIAkJCXJldHVybiBFUlJfQ0FTVCh0aW1lbGluZSk7CiAJCX0KIAot
CQljdHgtPnRpbWVsaW5lID0gdGltZWxpbmU7CisJCV9fYXNzaWduX3RpbWVsaW5lKGN0eCwgdGlt
ZWxpbmUpOworCQlpbnRlbF90aW1lbGluZV9wdXQodGltZWxpbmUpOwogCX0KIAogCXRyYWNlX2k5
MTVfY29udGV4dF9jcmVhdGUoY3R4KTsKQEAgLTE5ODksMTMgKzIwMTMsOCBAQCBzdGF0aWMgaW50
IGNsb25lX3NzZXUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwKIHN0YXRpYyBpbnQgY2xv
bmVfdGltZWxpbmUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwKIAkJCSAgc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKnNyYykKIHsKLQlpZiAoc3JjLT50aW1lbGluZSkgewotCQlHRU1fQlVH
X09OKHNyYy0+dGltZWxpbmUgPT0gZHN0LT50aW1lbGluZSk7Ci0KLQkJaWYgKGRzdC0+dGltZWxp
bmUpCi0JCQlpbnRlbF90aW1lbGluZV9wdXQoZHN0LT50aW1lbGluZSk7Ci0JCWRzdC0+dGltZWxp
bmUgPSBpbnRlbF90aW1lbGluZV9nZXQoc3JjLT50aW1lbGluZSk7Ci0JfQorCWlmIChzcmMtPnRp
bWVsaW5lKQorCQlfX2Fzc2lnbl90aW1lbGluZShkc3QsIHNyYy0+dGltZWxpbmUpOwogCiAJcmV0
dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZm
ZXIuYwppbmRleCAwYzhjOTA5NzQzZjEuLmNlZTM3MzIyYjk1MyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC0yMTc2LDcgKzIxNzYsNyBA
QCBzdGF0aWMgaW50IGViX3Bpbl9jb250ZXh0KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLCBz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiBzdGF0aWMgdm9pZCBlYl91bnBpbl9jb250ZXh0KHN0
cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9
IGViLT5jb250ZXh0OwotCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwgPSBjZS0+cmluZy0+dGlt
ZWxpbmU7CisJc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNlLT50aW1lbGluZTsKIAogCW11
dGV4X2xvY2soJnRsLT5tdXRleCk7CiAJaW50ZWxfY29udGV4dF9leGl0KGNlKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCA2ZDFkNGU4ZGJmYzkuLjc3ODMzZjE1
NThhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpAQCAtNjgsNyAr
NjgsNyBAQCBpbnQgX19pbnRlbF9jb250ZXh0X2RvX3BpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UpCiAJCQlnb3RvIGVycjsKIAogCQlHRU1fVFJBQ0UoIiVzIGNvbnRleHQ6JWxseCBwaW4gcmlu
Zzp7aGVhZDolMDR4LCB0YWlsOiUwNHh9XG4iLAotCQkJICBjZS0+ZW5naW5lLT5uYW1lLCBjZS0+
cmluZy0+dGltZWxpbmUtPmZlbmNlX2NvbnRleHQsCisJCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNl
LT50aW1lbGluZS0+ZmVuY2VfY29udGV4dCwKIAkJCSAgY2UtPnJpbmctPmhlYWQsIGNlLT5yaW5n
LT50YWlsKTsKIAogCQlpOTE1X2dlbV9jb250ZXh0X2dldChjZS0+Z2VtX2NvbnRleHQpOyAvKiBm
b3IgY3R4LT5wcGd0dCAqLwpAQCAtOTgsNyArOTgsNyBAQCB2b2lkIGludGVsX2NvbnRleHRfdW5w
aW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCiAJaWYgKGxpa2VseShhdG9taWNfZGVjX2Fu
ZF90ZXN0KCZjZS0+cGluX2NvdW50KSkpIHsKIAkJR0VNX1RSQUNFKCIlcyBjb250ZXh0OiVsbHgg
cmV0aXJlXG4iLAotCQkJICBjZS0+ZW5naW5lLT5uYW1lLCBjZS0+cmluZy0+dGltZWxpbmUtPmZl
bmNlX2NvbnRleHQpOworCQkJICBjZS0+ZW5naW5lLT5uYW1lLCBjZS0+dGltZWxpbmUtPmZlbmNl
X2NvbnRleHQpOwogCiAJCWNlLT5vcHMtPnVucGluKGNlKTsKIApAQCAtMTQzLDExICsxNDMsMTIg
QEAgc3RhdGljIHZvaWQgX19pbnRlbF9jb250ZXh0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KmFjdGl2ZSkKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBjb250YWluZXJfb2YoYWN0aXZl
LCB0eXBlb2YoKmNlKSwgYWN0aXZlKTsKIAogCUdFTV9UUkFDRSgiJXMgY29udGV4dDolbGx4IHJl
dGlyZVxuIiwKLQkJICBjZS0+ZW5naW5lLT5uYW1lLCBjZS0+cmluZy0+dGltZWxpbmUtPmZlbmNl
X2NvbnRleHQpOworCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT50aW1lbGluZS0+ZmVuY2VfY29u
dGV4dCk7CiAKIAlpZiAoY2UtPnN0YXRlKQogCQlfX2NvbnRleHRfdW5waW5fc3RhdGUoY2UtPnN0
YXRlKTsKIAorCWludGVsX3RpbWVsaW5lX3VucGluKGNlLT50aW1lbGluZSk7CiAJaW50ZWxfcmlu
Z191bnBpbihjZS0+cmluZyk7CiAJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogfQpAQCAtMTYzLDE1
ICsxNjQsMjEgQEAgc3RhdGljIGludCBfX2ludGVsX2NvbnRleHRfYWN0aXZlKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqYWN0aXZlKQogCWlmIChlcnIpCiAJCWdvdG8gZXJyX3B1dDsKIAorCWVyciA9IGlu
dGVsX3RpbWVsaW5lX3BpbihjZS0+dGltZWxpbmUpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX3Jp
bmc7CisKIAlpZiAoIWNlLT5zdGF0ZSkKIAkJcmV0dXJuIDA7CiAKIAllcnIgPSBfX2NvbnRleHRf
cGluX3N0YXRlKGNlLT5zdGF0ZSk7CiAJaWYgKGVycikKLQkJZ290byBlcnJfcmluZzsKKwkJZ290
byBlcnJfdGltZWxpbmU7CiAKIAlyZXR1cm4gMDsKIAorZXJyX3RpbWVsaW5lOgorCWludGVsX3Rp
bWVsaW5lX3VucGluKGNlLT50aW1lbGluZSk7CiBlcnJfcmluZzoKIAlpbnRlbF9yaW5nX3VucGlu
KGNlLT5yaW5nKTsKIGVycl9wdXQ6CkBAIC0yMTgsNiArMjI1LDggQEAgaW50ZWxfY29udGV4dF9p
bml0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAogCWNlLT5nZW1fY29udGV4dCA9IGN0eDsK
IAljZS0+dm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtID86ICZlbmdpbmUtPmd0LT5nZ3R0LT52bSk7
CisJaWYgKGN0eC0+dGltZWxpbmUpCisJCWNlLT50aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2dl
dChjdHgtPnRpbWVsaW5lKTsKIAogCWNlLT5lbmdpbmUgPSBlbmdpbmU7CiAJY2UtPm9wcyA9IGVu
Z2luZS0+Y29wczsKQEAgLTIzNSw2ICsyNDQsOCBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAogCiB2b2lkIGludGVsX2NvbnRleHRfZmluaShzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UpCiB7CisJaWYgKGNlLT50aW1lbGluZSkKKwkJaW50ZWxfdGltZWxpbmVf
cHV0KGNlLT50aW1lbGluZSk7CiAJaTkxNV92bV9wdXQoY2UtPnZtKTsKIAogCW11dGV4X2Rlc3Ry
b3koJmNlLT5waW5fbXV0ZXgpOwpAQCAtMjc5LDcgKzI5MCw3IEBAIHZvaWQgaW50ZWxfY29udGV4
dF9leGl0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiBpbnQgaW50ZWxfY29udGV4
dF9wcmVwYXJlX3JlbW90ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCQkJ
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwg
PSBjZS0+cmluZy0+dGltZWxpbmU7CisJc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNlLT50
aW1lbGluZTsKIAlpbnQgZXJyOwogCiAJLyogT25seSBzdWl0YWJsZSBmb3IgdXNlIGluIHJlbW90
ZWx5IG1vZGlmeWluZyB0aGlzIGNvbnRleHQgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2NvbnRleHQuaAppbmRleCAxM2YyOGRkMzE2YmMuLjlmYThiNTg4ZjE4ZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaApAQCAtMTIwLDE1ICsxMjAsMTUgQEAgc3RhdGlj
IGlubGluZSB2b2lkIGludGVsX2NvbnRleHRfcHV0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
IAogc3RhdGljIGlubGluZSBpbnQgX19tdXN0X2NoZWNrCiBpbnRlbF9jb250ZXh0X3RpbWVsaW5l
X2xvY2soc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQotCV9fYWNxdWlyZXMoJmNlLT5yaW5nLT50
aW1lbGluZS0+bXV0ZXgpCisJX19hY3F1aXJlcygmY2UtPnRpbWVsaW5lLT5tdXRleCkKIHsKLQly
ZXR1cm4gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjZS0+cmluZy0+dGltZWxpbmUtPm11dGV4
KTsKKwlyZXR1cm4gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjZS0+dGltZWxpbmUtPm11dGV4
KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIGludGVsX2NvbnRleHRfdGltZWxpbmVfdW5sb2Nr
KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKLQlfX3JlbGVhc2VzKCZjZS0+cmluZy0+dGltZWxp
bmUtPm11dGV4KQorCV9fcmVsZWFzZXMoJmNlLT50aW1lbGluZS0+bXV0ZXgpCiB7Ci0JbXV0ZXhf
dW5sb2NrKCZjZS0+cmluZy0+dGltZWxpbmUtPm11dGV4KTsKKwltdXRleF91bmxvY2soJmNlLT50
aW1lbGluZS0+bXV0ZXgpOwogfQogCiBpbnQgaW50ZWxfY29udGV4dF9wcmVwYXJlX3JlbW90ZV9y
ZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaAppbmRleCBjZmY2MjM4YzIxM2EuLmE2MzJiMjBlYzRk
OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBl
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaApA
QCAtNTMsNiArNTMsNyBAQCBzdHJ1Y3QgaW50ZWxfY29udGV4dCB7CiAKIAlzdHJ1Y3QgaTkxNV92
bWEgKnN0YXRlOwogCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nOworCXN0cnVjdCBpbnRlbF90aW1l
bGluZSAqdGltZWxpbmU7CiAKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogI2RlZmluZSBDT05URVhU
X0FMTE9DX0JJVCAwCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCmluZGV4IDM3
YzM5MWNlZTQ0MS4uZTEyMjhiMGU1NzdmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmUuaApAQCAtMTk2LDkgKzE5Niw3IEBAIGludGVsX3dyaXRlX3N0YXR1c19wYWdlKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IHJlZywgdTMyIHZhbHVlKQogI2RlZmluZSBD
TkxfSFdTX0NTQl9XUklURV9JTkRFWAkJMHgyZgogCiBzdHJ1Y3QgaW50ZWxfcmluZyAqCi1pbnRl
bF9lbmdpbmVfY3JlYXRlX3Jpbmcoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJ
IHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUsCi0JCQkgaW50IHNpemUpOworaW50ZWxf
ZW5naW5lX2NyZWF0ZV9yaW5nKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IHNp
emUpOwogaW50IGludGVsX3JpbmdfcGluKHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKTsKIHZvaWQg
aW50ZWxfcmluZ19yZXNldChzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZywgdTMyIHRhaWwpOwogdW5z
aWduZWQgaW50IGludGVsX3JpbmdfdXBkYXRlX3NwYWNlKHN0cnVjdCBpbnRlbF9yaW5nICpyaW5n
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKaW5kZXggOWIxM2Nl
MTFlOTljLi4wZjg0MWUxZTUwY2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9jcy5jCkBAIC03MDAsNyArNzAwLDYgQEAgc3RhdGljIGludCBtZWFzdXJlX2JyZWFkY3J1
bWJfZHcoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQlnb3RvIG91dF9mcmFtZTsK
IAogCUlOSVRfTElTVF9IRUFEKCZmcmFtZS0+cmluZy5yZXF1ZXN0X2xpc3QpOwotCWZyYW1lLT5y
aW5nLnRpbWVsaW5lID0gJmZyYW1lLT50aW1lbGluZTsKIAlmcmFtZS0+cmluZy52YWRkciA9IGZy
YW1lLT5jczsKIAlmcmFtZS0+cmluZy5zaXplID0gc2l6ZW9mKGZyYW1lLT5jcyk7CiAJZnJhbWUt
PnJpbmcuZWZmZWN0aXZlX3NpemUgPSBmcmFtZS0+cmluZy5zaXplOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRleCBkYWNhYTcwN2M3OTcuLmViYTMx
MTEwMzhhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVz
LmgKQEAgLTY5LDcgKzY5LDYgQEAgc3RydWN0IGludGVsX3JpbmcgewogCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwogCXZvaWQgKnZhZGRyOwogCi0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGlu
ZTsKIAlzdHJ1Y3QgbGlzdF9oZWFkIHJlcXVlc3RfbGlzdDsKIAlzdHJ1Y3QgbGlzdF9oZWFkIGFj
dGl2ZV9saW5rOwogCkBAIC0yODMsOCArMjgyLDYgQEAgc3RydWN0IGludGVsX2VuZ2luZV9jcyB7
CiAKIAlzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1OwogCi0Jc3RydWN0IGludGVsX3JpbmcgKmJ1ZmZl
cjsKLQogCXN0cnVjdCB7CiAJCXNwaW5sb2NrX3QgbG9jazsKIAkJc3RydWN0IGxpc3RfaGVhZCBy
ZXF1ZXN0czsKQEAgLTMwMyw2ICszMDAsMTEgQEAgc3RydWN0IGludGVsX2VuZ2luZV9jcyB7CiAJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmRlZmF1bHRfc3RhdGU7CiAJdm9pZCAqcGlubmVk
X2RlZmF1bHRfc3RhdGU7CiAKKwlzdHJ1Y3QgeworCQlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZzsK
KwkJc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZTsKKwl9IGxlZ2FjeTsKKwogCS8qIFJh
dGhlciB0aGFuIGhhdmUgZXZlcnkgY2xpZW50IHdhaXQgdXBvbiBhbGwgdXNlciBpbnRlcnJ1cHRz
LAogCSAqIHdpdGggdGhlIGhlcmQgd2FraW5nIGFmdGVyIGV2ZXJ5IGludGVycnVwdCBhbmQgZWFj
aCBkb2luZyB0aGUKIAkgKiBoZWF2eXdlaWdodCBzZXFubyBkYW5jZSwgd2UgZGVsZWdhdGUgdGhl
IHRhc2sgKG9mIGJlaW5nIHRoZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCA0
OTFmMGNiMzRmNTEuLjZkYmM5NDE4ZGRjZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJj
LmMKQEAgLTI4MTksOSArMjgxOSw2IEBAIGxvZ2ljYWxfcmluZ19kZWZhdWx0X2lycXMoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiBpbnQgaW50ZWxfZXhlY2xpc3RzX3N1Ym1pc3Np
b25fc2V0dXAoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCS8qIEludGVudGlv
bmFsbHkgbGVmdCBibGFuay4gKi8KLQllbmdpbmUtPmJ1ZmZlciA9IE5VTEw7Ci0KIAl0YXNrbGV0
X2luaXQoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQsCiAJCSAgICAgZXhlY2xpc3RzX3N1Ym1p
c3Npb25fdGFza2xldCwgKHVuc2lnbmVkIGxvbmcpZW5naW5lKTsKIAl0aW1lcl9zZXR1cCgmZW5n
aW5lLT5leGVjbGlzdHMudGltZXIsIGV4ZWNsaXN0c19zdWJtaXNzaW9uX3RpbWVyLCAwKTsKQEAg
LTMwNjksMjMgKzMwNjYsMTMgQEAgcG9wdWxhdGVfbHJfY29udGV4dChzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHN0cnVjdCBpbnRlbF90aW1lbGlu
ZSAqCi1nZXRfdGltZWxpbmUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGlu
dGVsX2d0ICpndCkKLXsKLQlpZiAoY3R4LT50aW1lbGluZSkKLQkJcmV0dXJuIGludGVsX3RpbWVs
aW5lX2dldChjdHgtPnRpbWVsaW5lKTsKLQllbHNlCi0JCXJldHVybiBpbnRlbF90aW1lbGluZV9j
cmVhdGUoZ3QsIE5VTEwpOwotfQotCiBzdGF0aWMgaW50IF9fZXhlY2xpc3RzX2NvbnRleHRfYWxs
b2Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJCSAgICAgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpjdHhfb2JqOwor
CXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUzMiBj
b250ZXh0X3NpemU7Ci0Jc3RydWN0IGludGVsX3JpbmcgKnJpbmc7Ci0Jc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0aW1lbGluZTsKIAlpbnQgcmV0OwogCiAJaWYgKGNlLT5zdGF0ZSkKQEAgLTMxMDks
MTUgKzMwOTYsMTkgQEAgc3RhdGljIGludCBfX2V4ZWNsaXN0c19jb250ZXh0X2FsbG9jKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJZ290byBlcnJvcl9kZXJlZl9vYmo7CiAJfQogCi0JdGlt
ZWxpbmUgPSBnZXRfdGltZWxpbmUoY2UtPmdlbV9jb250ZXh0LCBlbmdpbmUtPmd0KTsKLQlpZiAo
SVNfRVJSKHRpbWVsaW5lKSkgewotCQlyZXQgPSBQVFJfRVJSKHRpbWVsaW5lKTsKLQkJZ290byBl
cnJvcl9kZXJlZl9vYmo7CisJaWYgKCFjZS0+dGltZWxpbmUpIHsKKwkJc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0bDsKKworCQl0bCA9IGludGVsX3RpbWVsaW5lX2NyZWF0ZShlbmdpbmUtPmd0LCBO
VUxMKTsKKwkJaWYgKElTX0VSUih0bCkpIHsKKwkJCXJldCA9IFBUUl9FUlIodGwpOworCQkJZ290
byBlcnJvcl9kZXJlZl9vYmo7CisJCX0KKworCQljZS0+dGltZWxpbmUgPSB0bDsKIAl9CiAKLQly
aW5nID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKGVuZ2luZSwgdGltZWxpbmUsCi0JCQkJCSh1
bnNpZ25lZCBsb25nKWNlLT5yaW5nKTsKLQlpbnRlbF90aW1lbGluZV9wdXQodGltZWxpbmUpOwor
CXJpbmcgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX3JpbmcoZW5naW5lLCAodW5zaWduZWQgbG9uZylj
ZS0+cmluZyk7CiAJaWYgKElTX0VSUihyaW5nKSkgewogCQlyZXQgPSBQVFJfRVJSKHJpbmcpOwog
CQlnb3RvIGVycm9yX2RlcmVmX29iajsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jp
bmdidWZmZXIuYwppbmRleCBiYjY5ZjUxY2NiZmEuLmU0ZmM0MGMzYzRkOSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtNjM2LDcgKzYzNiw3IEBAIHN0
YXRpYyBib29sIHN0b3BfcmluZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiBzdGF0
aWMgaW50IHhjc19yZXN1bWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGVuZ2luZS0+aTkxNTsKLQlzdHJ1Y3Qg
aW50ZWxfcmluZyAqcmluZyA9IGVuZ2luZS0+YnVmZmVyOworCXN0cnVjdCBpbnRlbF9yaW5nICpy
aW5nID0gZW5naW5lLT5sZWdhY3kucmluZzsKIAlpbnQgcmV0ID0gMDsKIAogCUdFTV9UUkFDRSgi
JXM6IHJpbmc6e0hFQUQ6JTA0eCwgVEFJTDolMDR4fVxuIiwKQEAgLTgzMiwxMiArODMyLDEyIEBA
IHN0YXRpYyB2b2lkIHJlc2V0X3Jpbmcoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBi
b29sIHN0YWxsZWQpCiAJCSAqLwogCQlfX2k5MTVfcmVxdWVzdF9yZXNldChycSwgc3RhbGxlZCk7
CiAKLQkJR0VNX0JVR19PTihycS0+cmluZyAhPSBlbmdpbmUtPmJ1ZmZlcik7CisJCUdFTV9CVUdf
T04ocnEtPnJpbmcgIT0gZW5naW5lLT5sZWdhY3kucmluZyk7CiAJCWhlYWQgPSBycS0+aGVhZDsK
IAl9IGVsc2UgewotCQloZWFkID0gZW5naW5lLT5idWZmZXItPnRhaWw7CisJCWhlYWQgPSBlbmdp
bmUtPmxlZ2FjeS5yaW5nLT50YWlsOwogCX0KLQllbmdpbmUtPmJ1ZmZlci0+aGVhZCA9IGludGVs
X3Jpbmdfd3JhcChlbmdpbmUtPmJ1ZmZlciwgaGVhZCk7CisJZW5naW5lLT5sZWdhY3kucmluZy0+
aGVhZCA9IGludGVsX3Jpbmdfd3JhcChlbmdpbmUtPmxlZ2FjeS5yaW5nLCBoZWFkKTsKIAogCXNw
aW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIH0KQEAg
LTExOTIsMTAgKzExOTIsNiBAQCBpbnQgaW50ZWxfcmluZ19waW4oc3RydWN0IGludGVsX3Jpbmcg
KnJpbmcpCiAJaWYgKGF0b21pY19mZXRjaF9pbmMoJnJpbmctPnBpbl9jb3VudCkpCiAJCXJldHVy
biAwOwogCi0JcmV0ID0gaW50ZWxfdGltZWxpbmVfcGluKHJpbmctPnRpbWVsaW5lKTsKLQlpZiAo
cmV0KQotCQlnb3RvIGVycl91bnBpbjsKLQogCWZsYWdzID0gUElOX0dMT0JBTDsKIAogCS8qIFJp
bmcgd3JhcGFyb3VuZCBhdCBvZmZzZXQgMCBzb21ldGltZXMgaGFuZ3MuIE5vIGlkZWEgd2h5LiAq
LwpAQCAtMTIwOCw3ICsxMjA0LDcgQEAgaW50IGludGVsX3JpbmdfcGluKHN0cnVjdCBpbnRlbF9y
aW5nICpyaW5nKQogCiAJcmV0ID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgZmxhZ3MpOwogCWlm
ICh1bmxpa2VseShyZXQpKQotCQlnb3RvIGVycl90aW1lbGluZTsKKwkJZ290byBlcnJfdW5waW47
CiAKIAlpZiAoaTkxNV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUodm1hKSkKIAkJYWRkciA9ICh2
b2lkIF9fZm9yY2UgKilpOTE1X3ZtYV9waW5faW9tYXAodm1hKTsKQEAgLTEyMjUsMTMgKzEyMjEs
MTAgQEAgaW50IGludGVsX3JpbmdfcGluKHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKQogCUdFTV9C
VUdfT04ocmluZy0+dmFkZHIpOwogCXJpbmctPnZhZGRyID0gYWRkcjsKIAotCUdFTV9UUkFDRSgi
cmluZzolbGx4IHBpblxuIiwgcmluZy0+dGltZWxpbmUtPmZlbmNlX2NvbnRleHQpOwogCXJldHVy
biAwOwogCiBlcnJfcmluZzoKIAlpOTE1X3ZtYV91bnBpbih2bWEpOwotZXJyX3RpbWVsaW5lOgot
CWludGVsX3RpbWVsaW5lX3VucGluKHJpbmctPnRpbWVsaW5lKTsKIGVycl91bnBpbjoKIAlhdG9t
aWNfZGVjKCZyaW5nLT5waW5fY291bnQpOwogCXJldHVybiByZXQ7CkBAIC0xMjU0LDggKzEyNDcs
NiBAQCB2b2lkIGludGVsX3JpbmdfdW5waW4oc3RydWN0IGludGVsX3JpbmcgKnJpbmcpCiAJaWYg
KCFhdG9taWNfZGVjX2FuZF90ZXN0KCZyaW5nLT5waW5fY291bnQpKQogCQlyZXR1cm47CiAKLQlH
RU1fVFJBQ0UoInJpbmc6JWxseCB1bnBpblxuIiwgcmluZy0+dGltZWxpbmUtPmZlbmNlX2NvbnRl
eHQpOwotCiAJLyogRGlzY2FyZCBhbnkgdW51c2VkIGJ5dGVzIGJleW9uZCB0aGF0IHN1Ym1pdHRl
ZCB0byBody4gKi8KIAlpbnRlbF9yaW5nX3Jlc2V0KHJpbmcsIHJpbmctPnRhaWwpOwogCkBAIC0x
MjcwLDggKzEyNjEsNiBAQCB2b2lkIGludGVsX3JpbmdfdW5waW4oc3RydWN0IGludGVsX3Jpbmcg
KnJpbmcpCiAKIAlpOTE1X3ZtYV91bnBpbih2bWEpOwogCWk5MTVfdm1hX21ha2VfcHVyZ2VhYmxl
KHZtYSk7Ci0KLQlpbnRlbF90aW1lbGluZV91bnBpbihyaW5nLT50aW1lbGluZSk7CiB9CiAKIHN0
YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9yaW5nX3ZtYShzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0LCBpbnQgc2l6ZSkKQEAgLTEzMDYsOSArMTI5NSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92
bWEgKmNyZWF0ZV9yaW5nX3ZtYShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LCBpbnQgc2l6ZSkKIH0K
IAogc3RydWN0IGludGVsX3JpbmcgKgotaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCSBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVs
aW5lLAotCQkJIGludCBzaXplKQoraW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IHNpemUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CiAJc3RydWN0IGludGVsX3JpbmcgKnJpbmc7CkBAIC0x
MzIzLDcgKzEzMTAsNiBAQCBpbnRlbF9lbmdpbmVfY3JlYXRlX3Jpbmcoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lLAogCiAJa3JlZl9pbml0KCZyaW5nLT5yZWYpOwogCUlOSVRfTElTVF9I
RUFEKCZyaW5nLT5yZXF1ZXN0X2xpc3QpOwotCXJpbmctPnRpbWVsaW5lID0gaW50ZWxfdGltZWxp
bmVfZ2V0KHRpbWVsaW5lKTsKIAogCXJpbmctPnNpemUgPSBzaXplOwogCS8qIFdvcmthcm91bmQg
YW4gZXJyYXR1bSBvbiB0aGUgaTgzMCB3aGljaCBjYXVzZXMgYSBoYW5nIGlmCkBAIC0xMzUzLDcg
KzEzMzksNiBAQCB2b2lkIGludGVsX3JpbmdfZnJlZShzdHJ1Y3Qga3JlZiAqcmVmKQogCWk5MTVf
dm1hX2Nsb3NlKHJpbmctPnZtYSk7CiAJaTkxNV92bWFfcHV0KHJpbmctPnZtYSk7CiAKLQlpbnRl
bF90aW1lbGluZV9wdXQocmluZy0+dGltZWxpbmUpOwogCWtmcmVlKHJpbmcpOwogfQogCkBAIC0x
NDg1LDggKzE0NzAsOSBAQCBzdGF0aWMgaW50IHJpbmdfY29udGV4dF9hbGxvYyhzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gY2UtPmVu
Z2luZTsKIAogCS8qIE9uZSByaW5nYnVmZmVyIHRvIHJ1bGUgdGhlbSBhbGwgKi8KLQlHRU1fQlVH
X09OKCFlbmdpbmUtPmJ1ZmZlcik7Ci0JY2UtPnJpbmcgPSBlbmdpbmUtPmJ1ZmZlcjsKKwlHRU1f
QlVHX09OKCFlbmdpbmUtPmxlZ2FjeS5yaW5nKTsKKwljZS0+cmluZyA9IGVuZ2luZS0+bGVnYWN5
LnJpbmc7CisJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfZ2V0KGVuZ2luZS0+bGVnYWN5
LnRpbWVsaW5lKTsKIAogCWlmIChlbmdpbmUtPmNvbnRleHRfc2l6ZSkgewogCQlzdHJ1Y3QgaTkx
NV92bWEgKnZtYTsKQEAgLTIxNjQsOCArMjE1MCwxMSBAQCBzdGF0aWMgdm9pZCByaW5nX2Rlc3Ry
b3koc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJaW50ZWxfZW5naW5lX2NsZWFu
dXBfY29tbW9uKGVuZ2luZSk7CiAKLQlpbnRlbF9yaW5nX3VucGluKGVuZ2luZS0+YnVmZmVyKTsK
LQlpbnRlbF9yaW5nX3B1dChlbmdpbmUtPmJ1ZmZlcik7CisJaW50ZWxfcmluZ191bnBpbihlbmdp
bmUtPmxlZ2FjeS5yaW5nKTsKKwlpbnRlbF9yaW5nX3B1dChlbmdpbmUtPmxlZ2FjeS5yaW5nKTsK
KworCWludGVsX3RpbWVsaW5lX3VucGluKGVuZ2luZS0+bGVnYWN5LnRpbWVsaW5lKTsKKwlpbnRl
bF90aW1lbGluZV9wdXQoZW5naW5lLT5sZWdhY3kudGltZWxpbmUpOwogCiAJa2ZyZWUoZW5naW5l
KTsKIH0KQEAgLTIzNDksMzIgKzIzMzgsNDAgQEAgaW50IGludGVsX3Jpbmdfc3VibWlzc2lvbl9p
bml0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAl9CiAJR0VNX0JVR19PTih0aW1l
bGluZS0+aGFzX2luaXRpYWxfYnJlYWRjcnVtYik7CiAKLQlyaW5nID0gaW50ZWxfZW5naW5lX2Ny
ZWF0ZV9yaW5nKGVuZ2luZSwgdGltZWxpbmUsIFNaXzE2Syk7Ci0JaW50ZWxfdGltZWxpbmVfcHV0
KHRpbWVsaW5lKTsKKwllcnIgPSBpbnRlbF90aW1lbGluZV9waW4odGltZWxpbmUpOworCWlmIChl
cnIpCisJCWdvdG8gZXJyX3RpbWVsaW5lOworCisJcmluZyA9IGludGVsX2VuZ2luZV9jcmVhdGVf
cmluZyhlbmdpbmUsIFNaXzE2Syk7CiAJaWYgKElTX0VSUihyaW5nKSkgewogCQllcnIgPSBQVFJf
RVJSKHJpbmcpOwotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdGltZWxpbmVfdW5waW47CiAJfQog
CiAJZXJyID0gaW50ZWxfcmluZ19waW4ocmluZyk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfcmlu
ZzsKIAotCUdFTV9CVUdfT04oZW5naW5lLT5idWZmZXIpOwotCWVuZ2luZS0+YnVmZmVyID0gcmlu
ZzsKKwlHRU1fQlVHX09OKGVuZ2luZS0+bGVnYWN5LnJpbmcpOworCWVuZ2luZS0+bGVnYWN5LnJp
bmcgPSByaW5nOworCWVuZ2luZS0+bGVnYWN5LnRpbWVsaW5lID0gdGltZWxpbmU7CiAKIAllcnIg
PSBpbnRlbF9lbmdpbmVfaW5pdF9jb21tb24oZW5naW5lKTsKIAlpZiAoZXJyKQotCQlnb3RvIGVy
cl91bnBpbjsKKwkJZ290byBlcnJfcmluZ191bnBpbjsKIAotCUdFTV9CVUdfT04ocmluZy0+dGlt
ZWxpbmUtPmh3c3BfZ2d0dCAhPSBlbmdpbmUtPnN0YXR1c19wYWdlLnZtYSk7CisJR0VNX0JVR19P
Tih0aW1lbGluZS0+aHdzcF9nZ3R0ICE9IGVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKTsKIAogCXJl
dHVybiAwOwogCi1lcnJfdW5waW46CitlcnJfcmluZ191bnBpbjoKIAlpbnRlbF9yaW5nX3VucGlu
KHJpbmcpOwogZXJyX3Jpbmc6CiAJaW50ZWxfcmluZ19wdXQocmluZyk7CitlcnJfdGltZWxpbmVf
dW5waW46CisJaW50ZWxfdGltZWxpbmVfdW5waW4odGltZWxpbmUpOworZXJyX3RpbWVsaW5lOgor
CWludGVsX3RpbWVsaW5lX3B1dCh0aW1lbGluZSk7CiBlcnI6CiAJaW50ZWxfZW5naW5lX2NsZWFu
dXBfY29tbW9uKGVuZ2luZSk7CiAJcmV0dXJuIGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2Nr
X2VuZ2luZS5jCmluZGV4IDNhY2E4ODYwNGQyZC4uMTZiMDkyN2UzOTQ4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L21vY2tfZW5naW5lLmMKQEAgLTMyLDExICszMiw2IEBACiAjaW5jbHVkZSAibW9j
a19lbmdpbmUuaCIKICNpbmNsdWRlICJzZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmgiCiAKLXN0cnVj
dCBtb2NrX3JpbmcgewotCXN0cnVjdCBpbnRlbF9yaW5nIGJhc2U7Ci0Jc3RydWN0IGludGVsX3Rp
bWVsaW5lIHRpbWVsaW5lOwotfTsKLQogc3RhdGljIHZvaWQgbW9ja190aW1lbGluZV9waW4oc3Ry
dWN0IGludGVsX3RpbWVsaW5lICp0bCkKIHsKIAl0bC0+cGluX2NvdW50Kys7CkBAIC01MSwzNiAr
NDYsMjIgQEAgc3RhdGljIHZvaWQgbW9ja190aW1lbGluZV91bnBpbihzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKnRsKQogc3RhdGljIHN0cnVjdCBpbnRlbF9yaW5nICptb2NrX3Jpbmcoc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCWNvbnN0IHVuc2lnbmVkIGxvbmcgc3ogPSBQQUdF
X1NJWkUgLyAyOwotCXN0cnVjdCBtb2NrX3JpbmcgKnJpbmc7CisJc3RydWN0IGludGVsX3Jpbmcg
KnJpbmc7CiAKIAlyaW5nID0ga3phbGxvYyhzaXplb2YoKnJpbmcpICsgc3osIEdGUF9LRVJORUwp
OwogCWlmICghcmluZykKIAkJcmV0dXJuIE5VTEw7CiAKLQlpZiAoaW50ZWxfdGltZWxpbmVfaW5p
dCgmcmluZy0+dGltZWxpbmUsIGVuZ2luZS0+Z3QsIE5VTEwpKSB7Ci0JCWtmcmVlKHJpbmcpOwot
CQlyZXR1cm4gTlVMTDsKLQl9Ci0KLQlrcmVmX2luaXQoJnJpbmctPmJhc2UucmVmKTsKLQlyaW5n
LT5iYXNlLnNpemUgPSBzejsKLQlyaW5nLT5iYXNlLmVmZmVjdGl2ZV9zaXplID0gc3o7Ci0Jcmlu
Zy0+YmFzZS52YWRkciA9ICh2b2lkICopKHJpbmcgKyAxKTsKLQlyaW5nLT5iYXNlLnRpbWVsaW5l
ID0gJnJpbmctPnRpbWVsaW5lOwotCWF0b21pY19zZXQoJnJpbmctPmJhc2UucGluX2NvdW50LCAx
KTsKKwlrcmVmX2luaXQoJnJpbmctPnJlZik7CisJcmluZy0+c2l6ZSA9IHN6OworCXJpbmctPmVm
ZmVjdGl2ZV9zaXplID0gc3o7CisJcmluZy0+dmFkZHIgPSAodm9pZCAqKShyaW5nICsgMSk7CisJ
YXRvbWljX3NldCgmcmluZy0+cGluX2NvdW50LCAxKTsKIAotCUlOSVRfTElTVF9IRUFEKCZyaW5n
LT5iYXNlLnJlcXVlc3RfbGlzdCk7Ci0JaW50ZWxfcmluZ191cGRhdGVfc3BhY2UoJnJpbmctPmJh
c2UpOwotCi0JcmV0dXJuICZyaW5nLT5iYXNlOwotfQotCi1zdGF0aWMgdm9pZCBtb2NrX3Jpbmdf
ZnJlZShzdHJ1Y3QgaW50ZWxfcmluZyAqYmFzZSkKLXsKLQlzdHJ1Y3QgbW9ja19yaW5nICpyaW5n
ID0gY29udGFpbmVyX29mKGJhc2UsIHR5cGVvZigqcmluZyksIGJhc2UpOworCUlOSVRfTElTVF9I
RUFEKCZyaW5nLT5yZXF1ZXN0X2xpc3QpOworCWludGVsX3JpbmdfdXBkYXRlX3NwYWNlKHJpbmcp
OwogCi0JaW50ZWxfdGltZWxpbmVfZmluaSgmcmluZy0+dGltZWxpbmUpOwotCWtmcmVlKHJpbmcp
OworCXJldHVybiByaW5nOwogfQogCiBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqZmlyc3Rf
cmVxdWVzdChzdHJ1Y3QgbW9ja19lbmdpbmUgKmVuZ2luZSkKQEAgLTEzMSw3ICsxMTIsNiBAQCBz
dGF0aWMgdm9pZCBod19kZWxheV9jb21wbGV0ZShzdHJ1Y3QgdGltZXJfbGlzdCAqdCkKIAogc3Rh
dGljIHZvaWQgbW9ja19jb250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsK
LQltb2NrX3RpbWVsaW5lX3VucGluKGNlLT5yaW5nLT50aW1lbGluZSk7CiB9CiAKIHN0YXRpYyB2
b2lkIG1vY2tfY29udGV4dF9kZXN0cm95KHN0cnVjdCBrcmVmICpyZWYpCkBAIC0xNDAsOCArMTIw
LDEyIEBAIHN0YXRpYyB2b2lkIG1vY2tfY29udGV4dF9kZXN0cm95KHN0cnVjdCBrcmVmICpyZWYp
CiAKIAlHRU1fQlVHX09OKGludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSk7CiAKLQlpZiAodGVz
dF9iaXQoQ09OVEVYVF9BTExPQ19CSVQsICZjZS0+ZmxhZ3MpKQotCQltb2NrX3JpbmdfZnJlZShj
ZS0+cmluZyk7CisJaWYgKHRlc3RfYml0KENPTlRFWFRfQUxMT0NfQklULCAmY2UtPmZsYWdzKSkg
eworCQlrZnJlZShjZS0+cmluZyk7CisKKwkJbW9ja190aW1lbGluZV91bnBpbihjZS0+dGltZWxp
bmUpOworCQlpbnRlbF90aW1lbGluZV9wdXQoY2UtPnRpbWVsaW5lKTsKKwl9CiAKIAlpbnRlbF9j
b250ZXh0X2ZpbmkoY2UpOwogCWludGVsX2NvbnRleHRfZnJlZShjZSk7CkBAIC0xNTMsMTkgKzEz
NywyMSBAQCBzdGF0aWMgaW50IG1vY2tfY29udGV4dF9hbGxvYyhzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UpCiAJaWYgKCFjZS0+cmluZykKIAkJcmV0dXJuIC1FTk9NRU07CiAKKwlHRU1fQlVHX09O
KGNlLT50aW1lbGluZSk7CisJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKGNl
LT5lbmdpbmUtPmd0LCBOVUxMKTsKKwlpZiAoSVNfRVJSKGNlLT50aW1lbGluZSkpIHsKKwkJa2Zy
ZWUoY2UtPmVuZ2luZSk7CisJCXJldHVybiBQVFJfRVJSKGNlLT50aW1lbGluZSk7CisJfQorCisJ
bW9ja190aW1lbGluZV9waW4oY2UtPnRpbWVsaW5lKTsKKwogCXJldHVybiAwOwogfQogCiBzdGF0
aWMgaW50IG1vY2tfY29udGV4dF9waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogewotCWlu
dCByZXQ7Ci0KLQlyZXQgPSBpbnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKGNlKTsKLQlpZiAo
cmV0KQotCQlyZXR1cm4gcmV0OwotCi0JbW9ja190aW1lbGluZV9waW4oY2UtPnJpbmctPnRpbWVs
aW5lKTsKLQlyZXR1cm4gMDsKKwlyZXR1cm4gaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShj
ZSk7CiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dF9vcHMgbW9ja19jb250
ZXh0X29wcyA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpp
bmRleCBkMzliNTU5NGNiMDIuLjlkM2NkY2M2N2I0ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAtMzIsNyArMzIsNyBAQCBzdGF0aWMgaW50IHJlcXVl
c3Rfc3luYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogc3RhdGljIGludCBjb250ZXh0X3N5
bmMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogewotCXN0cnVjdCBpbnRlbF90aW1lbGluZSAq
dGwgPSBjZS0+cmluZy0+dGltZWxpbmU7CisJc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNl
LT50aW1lbGluZTsKIAlpbnQgZXJyID0gMDsKIAogCWRvIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Fj
dGl2ZS5jCmluZGV4IDFlMDk3MjJiNTMxNy4uNzY5OGZjYWE2NDhhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlLmMKQEAgLTI0Niw3ICsyNDYsNyBAQCBzdGF0aWMgYm9vbCBfX2FjdGl2ZV9k
ZWxfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAlzdHJ1Y3QgbGxpc3Rfbm9kZSAq
aGVhZCA9IE5VTEwsICp0YWlsID0gTlVMTDsKIAlzdHJ1Y3QgbGxpc3Rfbm9kZSAqcG9zLCAqbmV4
dDsKIAotCUdFTV9CVUdfT04obm9kZS0+dGltZWxpbmUgIT0gZW5naW5lLT5rZXJuZWxfY29udGV4
dC0+cmluZy0+dGltZWxpbmUtPmZlbmNlX2NvbnRleHQpOworCUdFTV9CVUdfT04obm9kZS0+dGlt
ZWxpbmUgIT0gZW5naW5lLT5rZXJuZWxfY29udGV4dC0+dGltZWxpbmUtPmZlbmNlX2NvbnRleHQp
OwogCiAJLyoKIAkgKiBSZWJ1aWxkIHRoZSBsbGlzdCBleGNsdWRpbmcgb3VyIG5vZGUuIFdlIG1h
eSBwZXJmb3JtIHRoaXMKQEAgLTU2OCw3ICs1NjgsNyBAQCBpbnQgaTkxNV9hY3RpdmVfYWNxdWly
ZV9wcmVhbGxvY2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCSAqIGk5MTVf
YWN0aXZlX2FjcXVpcmVfYmFycmllcigpCiAJICovCiAJZm9yX2VhY2hfZW5naW5lX21hc2tlZChl
bmdpbmUsIGk5MTUsIG1hc2ssIHRtcCkgewotCQl1NjQgaWR4ID0gZW5naW5lLT5rZXJuZWxfY29u
dGV4dC0+cmluZy0+dGltZWxpbmUtPmZlbmNlX2NvbnRleHQ7CisJCXU2NCBpZHggPSBlbmdpbmUt
Pmtlcm5lbF9jb250ZXh0LT50aW1lbGluZS0+ZmVuY2VfY29udGV4dDsKIAkJc3RydWN0IGFjdGl2
ZV9ub2RlICpub2RlOwogCiAJCW5vZGUgPSByZXVzZV9pZGxlX2JhcnJpZXIocmVmLCBpZHgpOwpA
QCAtNjY1LDcgKzY2NSw3IEBAIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZF9hY3RpdmVfYmFycmllcnMo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJc3RydWN0IGxsaXN0X25vZGUgKm5vZGUsICpuZXh0
OwogCiAJR0VNX0JVR19PTihpbnRlbF9lbmdpbmVfaXNfdmlydHVhbChlbmdpbmUpKTsKLQlHRU1f
QlVHX09OKHJxLT50aW1lbGluZSAhPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5yaW5nLT50aW1l
bGluZSk7CisJR0VNX0JVR19PTihycS0+dGltZWxpbmUgIT0gZW5naW5lLT5rZXJuZWxfY29udGV4
dC0+dGltZWxpbmUpOwogCiAJLyoKIAkgKiBBdHRhY2ggdGhlIGxpc3Qgb2YgcHJvdG8tZmVuY2Vz
IHRvIHRoZSBpbi1mbGlnaHQgcmVxdWVzdCBzdWNoCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVz
dC5jCmluZGV4IDgxMDk0ZjI1MGJkYi4uMzBhZTJkNjMwMDIyIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuYwpAQCAtMzA1LDEyICszMDUsMTIgQEAgc3RhdGljIGJvb2wgaTkxNV9yZXF1
ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogCWxvY2FsX2lycV9lbmFibGUo
KTsKIAotCWludGVsX2NvbnRleHRfZXhpdChycS0+aHdfY29udGV4dCk7Ci0JaW50ZWxfY29udGV4
dF91bnBpbihycS0+aHdfY29udGV4dCk7Ci0KIAlpOTE1X3JlcXVlc3RfcmVtb3ZlX2Zyb21fY2xp
ZW50KHJxKTsKIAlsaXN0X2RlbCgmcnEtPmxpbmspOwogCisJaW50ZWxfY29udGV4dF9leGl0KHJx
LT5od19jb250ZXh0KTsKKwlpbnRlbF9jb250ZXh0X3VucGluKHJxLT5od19jb250ZXh0KTsKKwog
CWZyZWVfY2FwdHVyZV9saXN0KHJxKTsKIAlpOTE1X3NjaGVkX25vZGVfZmluaSgmcnEtPnNjaGVk
KTsKIAlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKQEAgLTYwNyw3ICs2MDcsNyBAQCByZXF1ZXN0X2Fs
bG9jX3Nsb3coc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBnZnBfdCBnZnApCiBzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICoKIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UsIGdmcF90IGdmcCkKIHsKLQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsID0gY2UtPnJpbmct
PnRpbWVsaW5lOworCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwgPSBjZS0+dGltZWxpbmU7CiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJdTMyIHNlcW5vOwogCWludCByZXQ7CkBAIC03NTks
NyArNzU5LDcgQEAgaTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Up
CiAJCWdvdG8gZXJyX3VubG9jazsKIAogCS8qIENoZWNrIHRoYXQgd2UgZG8gbm90IGludGVycnVw
dCBvdXJzZWx2ZXMgd2l0aCBhIG5ldyByZXF1ZXN0ICovCi0JcnEtPmNvb2tpZSA9IGxvY2tkZXBf
cGluX2xvY2soJmNlLT5yaW5nLT50aW1lbGluZS0+bXV0ZXgpOworCXJxLT5jb29raWUgPSBsb2Nr
ZGVwX3Bpbl9sb2NrKCZjZS0+dGltZWxpbmUtPm11dGV4KTsKIAogCXJldHVybiBycTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwppbmRleCBi
NjQ0OWQwYThjMTcuLmNiMzBjNjY5YjFiNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ4LDI2ICs0OCwyOSBAQCBzdGF0aWMgaW50
IHBvcHVsYXRlX2dndHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiB7CiAJdW5zaWdu
ZWQgbG9uZyB1bmJvdW5kLCBib3VuZCwgY291bnQ7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKLQl1NjQgc2l6ZTsKIAogCWNvdW50ID0gMDsKLQlmb3IgKHNpemUgPSAwOwotCSAg
ICAgc2l6ZSArIEk5MTVfR1RUX1BBR0VfU0laRSA8PSBpOTE1LT5nZ3R0LnZtLnRvdGFsOwotCSAg
ICAgc2l6ZSArPSBJOTE1X0dUVF9QQUdFX1NJWkUpIHsKKwlkbyB7CiAJCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwogCiAJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwg
STkxNV9HVFRfUEFHRV9TSVpFKTsKIAkJaWYgKElTX0VSUihvYmopKQogCQkJcmV0dXJuIFBUUl9F
UlIob2JqKTsKIAotCQlxdWlya19hZGQob2JqLCBvYmplY3RzKTsKLQogCQl2bWEgPSBpOTE1X2dl
bV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLCAwKTsKLQkJaWYgKElTX0VSUih2bWEp
KQorCQlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJ
CWlmICh2bWEgPT0gRVJSX1BUUigtRU5PU1BDKSkKKwkJCQlicmVhazsKKwogCQkJcmV0dXJuIFBU
Ul9FUlIodm1hKTsKKwkJfQogCisJCXF1aXJrX2FkZChvYmosIG9iamVjdHMpOwogCQljb3VudCsr
OwotCX0KKwl9IHdoaWxlICgxKTsKKwlwcl9kZWJ1ZygiRmlsbGVkIEdHVFQgd2l0aCAlbHUgcGFn
ZXMgWyVsbHUgdG90YWxdXG4iLAorCQkgY291bnQsIGk5MTUtPmdndHQudm0udG90YWwgLyBQQUdF
X1NJWkUpOwogCiAJYm91bmQgPSAwOwogCXVuYm91bmQgPSAwOwotLSAKMi4yMy4wLnJjMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

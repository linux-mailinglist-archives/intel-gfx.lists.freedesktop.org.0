Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 59E47EAEDA
	for <lists+intel-gfx@lfdr.de>; Thu, 31 Oct 2019 12:26:19 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 95E8E6EC16;
	Thu, 31 Oct 2019 11:26:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 672D46EC06
 for <intel-gfx@lists.freedesktop.org>; Thu, 31 Oct 2019 11:26:15 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 31 Oct 2019 12:26:02 +0100
Message-Id: <20191031112610.27608-4-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
References: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 04/12] drm/i915: Perform automated conversions
 for crtc uapi/hw split, base -> hw.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgY3J0Y19zdGF0ZS0+YmFzZSB0byBodyB3aGVyZSBhcHByb3ByaWF0ZS4gVGhpcyBp
cyBkb25lIHVzaW5nIHRoZSBmb2xsb3dpbmcgcGF0Y2g6CgpAQApzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqVDsKaWRlbnRpZmllciB4ID1+ICJeKGFjdGl2ZXxlbmFibGV8ZGVnYW1tYV9sdXR8Z2Ft
bWFfbHV0fGN0bXxtb2RlfGFkanVzdGVkX21vZGUpJCI7CkBACi1ULT5iYXNlLngKK1QtPmh3LngK
CkBACnN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqVDsKaWRlbnRpZmllciB4ID1+ICJeKGFjdGl2ZXxl
bmFibGV8ZGVnYW1tYV9sdXR8Z2FtbWFfbHV0fGN0bXxtb2RlfGFkanVzdGVkX21vZGUpJCI7CkBA
Ci10b19pbnRlbF9jcnRjX3N0YXRlKFQpLT5iYXNlLngKK3RvX2ludGVsX2NydGNfc3RhdGUoVCkt
Pmh3LngKClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3Jz
dEBsaW51eC5pbnRlbC5jb20+ClJldmlld2VkLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5
cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9kcm1fZHBfbXN0X3Rv
cG9sb2d5LmMgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lj
bF9kc2kuYyAgICAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfYXVkaW8uYyAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9jZGNsay5jICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2NvbG9yLmMgICAgfCAxMDggKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfY3J0LmMgICAgICB8ICAxOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kZGkuYyAgICAgIHwgIDE4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYyAgfCAyNTkgKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCAgMjIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kdm8uYyAgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2ZiYy5jICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfaGRtaS5jICAgICB8ICAyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9sc3Bjb24uYyAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2x2ZHMuYyAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcGFuZWwuYyAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9waXBlX2NyYy5jIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX3Bzci5jICAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfc2R2by5jICAgICB8ICAxNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9zcHJpdGUuYyAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3R2LmMgICAgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfdmRzYy5jICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS92
bHZfZHNpLmMgICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMg
ICAgICAgICAgICAgICB8ICA1NiArKy0tCiAyNSBmaWxlcyBjaGFuZ2VkLCAzMTcgaW5zZXJ0aW9u
cygrKSwgMzEzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1f
ZHBfbXN0X3RvcG9sb2d5LmMgYi9kcml2ZXJzL2dwdS9kcm0vZHJtX2RwX21zdF90b3BvbG9neS5j
CmluZGV4IDg1YmVmNzNhNjc2My4uZmRkZWE3YWNmN2Q4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vZHJtX2RwX21zdF90b3BvbG9neS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9kcm1fZHBf
bXN0X3RvcG9sb2d5LmMKQEAgLTMzLDYgKzMzLDcgQEAKICNpbmNsdWRlIDxsaW51eC9zb3J0Lmg+
CiAjaW5jbHVkZSA8bGludXgvdGltZWtlZXBpbmcuaD4KICNpbmNsdWRlIDxsaW51eC9tYXRoNjQu
aD4KKyNpbmNsdWRlIDxsaW51eC9zdGFja3RyYWNlLmg+CiAjZW5kaWYKIAogI2luY2x1ZGUgPGRy
bS9kcm1fYXRvbWljLmg+CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ljbF9kc2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jCmluZGV4
IDZlMzk4YzMzYTUyNC4uNGVjNDkzZTQ3NTViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ljbF9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ljbF9kc2kuYwpAQCAtMjc2LDcgKzI3Niw3IEBAIHN0YXRpYyB2b2lkIGNvbmZpZ3VyZV9kdWFs
X2xpbmtfbW9kZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCWlmIChpbnRlbF9k
c2ktPmR1YWxfbGluayA9PSBEU0lfRFVBTF9MSU5LX0ZST05UX0JBQ0spIHsKIAkJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJCQkmcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCQkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2Rl
OwogCQl1MzIgZHNzX2N0bDI7CiAJCXUxNiBoYWN0aXZlID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19o
ZGlzcGxheTsKIAkJdTE2IGRsX2J1ZmZlcl9kZXB0aDsKQEAgLTc2OCw3ICs3NjgsNyBAQCBnZW4x
MV9kc2lfc2V0X3RyYW5zY29kZXJfdGltaW5ncyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxf
ZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9Ci0JCQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJ
CQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJZW51bSBwb3J0IHBvcnQ7CiAJZW51
bSB0cmFuc2NvZGVyIGRzaV90cmFuczsKIAkvKiBob3Jpem9udGFsIHRpbWluZ3MgKi8KQEAgLTEy
MTYsNyArMTIxNiw3IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9nZXRfdGltaW5ncyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kg
PSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlOworCQkJCQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoaW50ZWxf
ZHNpLT5kdWFsX2xpbmspIHsKIAkJYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheSAqPSAyOwpA
QCAtMTI0OSw5ICsxMjQ5LDkgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dldF9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJcGlwZV9jb25maWctPnBvcnRfY2xvY2sgPQog
CQljbmxfY2FsY193cnBsbF9saW5rKGRldl9wcml2LCAmcGlwZV9jb25maWctPmRwbGxfaHdfc3Rh
dGUpOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gaW50
ZWxfZHNpLT5wY2xrOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sg
PSBpbnRlbF9kc2ktPnBjbGs7CiAJaWYgKGludGVsX2RzaS0+ZHVhbF9saW5rKQotCQlwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgKj0gMjsKKwkJcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayAqPSAyOwogCiAJZ2VuMTFfZHNpX2dldF90aW1p
bmdzKGVuY29kZXIsIHBpcGVfY29uZmlnKTsKIAlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzIHw9
IEJJVChJTlRFTF9PVVRQVVRfRFNJKTsKQEAgLTEyNjksNyArMTI2OSw3IEBAIHN0YXRpYyBpbnQg
Z2VuMTFfZHNpX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlID0KIAkJCQkJaW50ZWxf
Y29ubmVjdG9yLT5wYW5lbC5maXhlZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0KLQkJCQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
CQkJCSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCXBpcGVfY29uZmlnLT5vdXRw
dXRfZm9ybWF0ID0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0I7CiAJaW50ZWxfZml4ZWRfcGFuZWxf
bW9kZShmaXhlZF9tb2RlLCBhZGp1c3RlZF9tb2RlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfYXVkaW8uYwppbmRleCA4NWU2YjJiYmIzNGYuLjY3NDAxOTFkMzU1NyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdWRpby5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYwpAQCAtMjM0LDcgKzIz
NCw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaGRtaV9hdWRfbmN0cyBoZG1pX2F1ZF9uY3RzXzM2
YnBwW10gPSB7CiBzdGF0aWMgdTMyIGF1ZGlvX2NvbmZpZ19oZG1pX3BpeGVsX2Nsb2NrKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRq
dXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IGk7CiAK
IAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShoZG1pX2F1ZGlvX2Nsb2NrKTsgaSsrKSB7CkBA
IC02OTUsNyArNjk1LDcgQEAgdm9pZCBpbnRlbF9hdWRpb19jb2RlY19lbmFibGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3RydWN0IGRybV9jb25uZWN0b3IgKmNv
bm5lY3RvciA9IGNvbm5fc3RhdGUtPmNvbm5lY3RvcjsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21v
ZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWVudW0gcG9ydCBwb3J0ID0g
ZW5jb2Rlci0+cG9ydDsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYwppbmRleCAwY2FlZjI1OTJhN2UuLjMw
NGZkNjUwYTc0YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9jZGNsay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsu
YwpAQCAtMTkzNyw3ICsxOTM3LDcgQEAgaW50IGludGVsX2NydGNfY29tcHV0ZV9taW5fY2RjbGso
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXRvX2k5MTUoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCWludCBtaW5fY2RjbGs7CiAKLQlpZiAoIWNydGNf
c3RhdGUtPmJhc2UuZW5hYmxlKQorCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQogCQlyZXR1
cm4gMDsKIAogCW1pbl9jZGNsayA9IGludGVsX3BpeGVsX3JhdGVfdG9fY2RjbGsoY3J0Y19zdGF0
ZSk7CkBAIC0yMDc0LDcgKzIwNzQsNyBAQCBzdGF0aWMgaW50IGJ4dF9jb21wdXRlX21pbl92b2x0
YWdlX2xldmVsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWZvcl9lYWNoX25l
d19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7CiAJCWlu
dCByZXQ7CiAKLQkJaWYgKGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCQlpZiAoY3J0Y19zdGF0
ZS0+aHcuZW5hYmxlKQogCQkJbWluX3ZvbHRhZ2VfbGV2ZWwgPSBjcnRjX3N0YXRlLT5taW5fdm9s
dGFnZV9sZXZlbDsKIAkJZWxzZQogCQkJbWluX3ZvbHRhZ2VfbGV2ZWwgPSAwOwpAQCAtMjE2OCw3
ICsyMTY4LDcgQEAgc3RhdGljIGludCBza2xfZHBsbDBfdmNvKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogCQl2Y28gPSBkZXZfcHJpdi0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcTsK
IAogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0
YXRlLCBpKSB7Ci0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJCWlmICghY3J0Y19z
dGF0ZS0+aHcuZW5hYmxlKQogCQkJY29udGludWU7CiAKIAkJaWYgKCFpbnRlbF9jcnRjX2hhc190
eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9FRFApKQpAQCAtMjI4MSw3ICsyMjgxLDcgQEAg
c3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2FsbF9waXBlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAkJaWYgKElTX0VSUihjcnRjX3N0YXRlKSkKIAkJCXJldHVybiBQVFJfRVJS
KGNydGNfc3RhdGUpOwogCi0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwKKwkJaWYg
KCFjcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKIAkJICAgIGRybV9hdG9taWNfY3J0Y19uZWVkc19t
b2Rlc2V0KCZjcnRjX3N0YXRlLT5iYXNlKSkKIAkJCWNvbnRpbnVlOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKaW5kZXggZmE0NGViNzNkMDg4Li42MmNjMmQ5
ZGYzOWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29s
b3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKQEAg
LTExNywxMCArMTE3LDEwIEBAIHN0YXRpYyBib29sIGx1dF9pc19sZWdhY3koY29uc3Qgc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpsdXQpCiAKIHN0YXRpYyBib29sIGNydGNfc3RhdGVfaXNfbGVn
YWN5X2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewot
CXJldHVybiAhY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dCAmJgotCQkhY3J0Y19zdGF0ZS0+
YmFzZS5jdG0gJiYKLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgJiYKLQkJbHV0X2lzX2xl
Z2FjeShjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCk7CisJcmV0dXJuICFjcnRjX3N0YXRlLT5o
dy5kZWdhbW1hX2x1dCAmJgorCQkhY3J0Y19zdGF0ZS0+aHcuY3RtICYmCisJCWNydGNfc3RhdGUt
Pmh3LmdhbW1hX2x1dCAmJgorCQlsdXRfaXNfbGVnYWN5KGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1
dCk7CiB9CiAKIC8qCkBAIC0yMTksNyArMjE5LDcgQEAgc3RhdGljIGJvb2wgaWxrX2NzY19saW1p
dGVkX3JhbmdlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3Rh
dGljIHZvaWQgaWxrX2NzY19jb252ZXJ0X2N0bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCQl1MTYgY29lZmZzWzldKQogewotCWNvbnN0IHN0cnVjdCBkcm1f
Y29sb3JfY3RtICpjdG0gPSBjcnRjX3N0YXRlLT5iYXNlLmN0bS0+ZGF0YTsKKwljb25zdCBzdHJ1
Y3QgZHJtX2NvbG9yX2N0bSAqY3RtID0gY3J0Y19zdGF0ZS0+aHcuY3RtLT5kYXRhOwogCWNvbnN0
IHU2NCAqaW5wdXQ7CiAJdTY0IHRlbXBbOV07CiAJaW50IGk7CkBAIC0yNzQsNyArMjc0LDcgQEAg
c3RhdGljIHZvaWQgaWxrX2xvYWRfY3NjX21hdHJpeChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlib29sIGxpbWl0ZWRfY29sb3JfcmFuZ2UgPSBpbGtf
Y3NjX2xpbWl0ZWRfcmFuZ2UoY3J0Y19zdGF0ZSk7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5j
dG0pIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuY3RtKSB7CiAJCXUxNiBjb2VmZls5XTsKIAogCQlp
bGtfY3NjX2NvbnZlcnRfY3RtKGNydGNfc3RhdGUsIGNvZWZmKTsKQEAgLTMxMiw3ICszMTIsNyBA
QCBzdGF0aWMgdm9pZCBpY2xfbG9hZF9jc2NfbWF0cml4KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCi0JaWYgKGNydGNfc3RhdGUtPmJh
c2UuY3RtKSB7CisJaWYgKGNydGNfc3RhdGUtPmh3LmN0bSkgewogCQl1MTYgY29lZmZbOV07CiAK
IAkJaWxrX2NzY19jb252ZXJ0X2N0bShjcnRjX3N0YXRlLCBjb2VmZik7CkBAIC0zNDIsOCArMzQy
LDggQEAgc3RhdGljIHZvaWQgY2hlcnJ5dmlld19sb2FkX2NzY19tYXRyaXgoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNy
dGMtPnBpcGU7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5jdG0pIHsKLQkJY29uc3Qgc3RydWN0
IGRybV9jb2xvcl9jdG0gKmN0bSA9IGNydGNfc3RhdGUtPmJhc2UuY3RtLT5kYXRhOworCWlmIChj
cnRjX3N0YXRlLT5ody5jdG0pIHsKKwkJY29uc3Qgc3RydWN0IGRybV9jb2xvcl9jdG0gKmN0bSA9
IGNydGNfc3RhdGUtPmh3LmN0bS0+ZGF0YTsKIAkJdTE2IGNvZWZmc1s5XSA9IHt9OwogCQlpbnQg
aTsKIApAQCAtNDM1LDcgKzQzNSw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfbG9hZF9sdXRzX2ludGVy
bmFsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBzdGF0aWMg
dm9pZCBpOXh4X2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKLQlpOXh4X2xvYWRfbHV0c19pbnRlcm5hbChjcnRjX3N0YXRlLCBjcnRjX3N0YXRl
LT5iYXNlLmdhbW1hX2x1dCk7CisJaTl4eF9sb2FkX2x1dHNfaW50ZXJuYWwoY3J0Y19zdGF0ZSwg
Y3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0KTsKIH0KIAogc3RhdGljIHZvaWQgaTl4eF9jb2xvcl9j
b21taXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCkBAIC01MjUs
NyArNTI1LDcgQEAgc3RhdGljIHZvaWQgaTk2NV9sb2FkX2x1dF8xMHA2KHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogc3RhdGljIHZvaWQgaTk2NV9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKKwlj
b25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3
LmdhbW1hX2x1dDsKIAogCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlID09IEdBTU1BX01PREVf
TU9ERV84QklUKQogCQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0YXRlKTsKQEAgLTU0OCw3ICs1NDgs
NyBAQCBzdGF0aWMgdm9pZCBpbGtfbG9hZF9sdXRfMTAoc3RydWN0IGludGVsX2NydGMgKmNydGMs
CiBzdGF0aWMgdm9pZCBpbGtfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxv
YiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7
CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkK
IAkJaTl4eF9sb2FkX2x1dHMoY3J0Y19zdGF0ZSk7CkBAIC02NTUsOCArNjU1LDggQEAgc3RhdGlj
IHZvaWQgaXZiX2xvYWRfbHV0X2V4dF9tYXgoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiBzdGF0
aWMgdm9pZCBpdmJfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2Ft
bWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7Ci0JY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQ7
CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRl
LT5ody5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpkZWdhbW1h
X2x1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0OwogCiAJaWYgKGNydGNfc3RhdGUtPmdh
bW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFXzhCSVQpIHsKIAkJaTl4eF9sb2FkX2x1dHMoY3J0
Y19zdGF0ZSk7CkBAIC02NzgsOCArNjc4LDggQEAgc3RhdGljIHZvaWQgaXZiX2xvYWRfbHV0cyhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGJk
d19sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJh
c2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBj
cnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKLQljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Js
b2IgKmRlZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dDsKKwljb25zdCBz
dHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1h
X2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0ID0gY3J0
Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQ7CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9
PSBHQU1NQV9NT0RFX01PREVfOEJJVCkgewogCQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0YXRlKTsK
QEAgLTcwNCw3ICs3MDQsNyBAQCBzdGF0aWMgdm9pZCBnbGtfbG9hZF9kZWdhbW1hX2x1dChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUg
cGlwZSA9IGNydGMtPnBpcGU7CiAJY29uc3QgdTMyIGx1dF9zaXplID0gSU5URUxfSU5GTyhkZXZf
cHJpdiktPmNvbG9yLmRlZ2FtbWFfbHV0X3NpemU7Ci0JY29uc3Qgc3RydWN0IGRybV9jb2xvcl9s
dXQgKmx1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQtPmRhdGE7CisJY29uc3Qgc3Ry
dWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0LT5kYXRh
OwogCXUzMiBpOwogCiAJLyoKQEAgLTc2Niw3ICs3NjYsNyBAQCBzdGF0aWMgdm9pZCBnbGtfbG9h
ZF9kZWdhbW1hX2x1dF9saW5lYXIoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdAogCiBzdGF0aWMgdm9pZCBnbGtfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAq
Z2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRy
bV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CiAKIAkvKgpAQCAtNzc3LDcgKzc3Nyw3IEBAIHN0YXRpYyB2b2lkIGdsa19sb2FkX2x1
dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICogdGhlIGRl
Z2FtYSBMVVQgc28gdGhhdCB3ZSBkb24ndCBoYXZlIHRvIHJlbG9hZAogCSAqIGl0IGV2ZXJ5IHRp
bWUgdGhlIHBpcGUgQ1NDIGlzIGJlaW5nIGVuYWJsZWQuCiAJICovCi0JaWYgKGNydGNfc3RhdGUt
PmJhc2UuZGVnYW1tYV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQln
bGtfbG9hZF9kZWdhbW1hX2x1dChjcnRjX3N0YXRlKTsKIAllbHNlCiAJCWdsa19sb2FkX2RlZ2Ft
bWFfbHV0X2xpbmVhcihjcnRjX3N0YXRlKTsKQEAgLTgyMyw3ICs4MjMsNyBAQCBzdGF0aWMgdm9p
ZAogaWNsX3Byb2dyYW1fZ2FtbWFfc3VwZXJmaW5lX3NlZ21lbnQoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CisJY29uc3Qg
c3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0
OwogCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9iLT5kYXRhOwogCXN0cnVj
dCBpbnRlbF9kc2IgKmRzYiA9IGludGVsX2RzYl9nZXQoY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUg
PSBjcnRjLT5waXBlOwpAQCAtODU1LDcgKzg1NSw3IEBAIHN0YXRpYyB2b2lkCiBpY2xfcHJvZ3Jh
bV9nYW1tYV9tdWx0aV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxv
YiA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVy
dHlfYmxvYiAqYmxvYiA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0YTsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9y
X2x1dCAqZW50cnk7CiAJc3RydWN0IGludGVsX2RzYiAqZHNiID0gaW50ZWxfZHNiX2dldChjcnRj
KTsKQEAgLTkxMCwxMSArOTEwLDExIEBAIGljbF9wcm9ncmFtX2dhbW1hX211bHRpX3NlZ21lbnQo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lk
IGljbF9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0
YXRlLT5iYXNlLmdhbW1hX2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdh
bW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50
ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCi0JaWYgKGNydGNfc3RhdGUtPmJh
c2UuZGVnYW1tYV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQlnbGtf
bG9hZF9kZWdhbW1hX2x1dChjcnRjX3N0YXRlKTsKIAogCXN3aXRjaCAoY3J0Y19zdGF0ZS0+Z2Ft
bWFfbW9kZSAmIEdBTU1BX01PREVfTU9ERV9NQVNLKSB7CkBAIC05OTEsOCArOTkxLDggQEAgc3Rh
dGljIHZvaWQgY2h2X2xvYWRfY2dtX2dhbW1hKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogc3Rh
dGljIHZvaWQgY2h2X2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdh
bW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OwotCWNvbnN0IHN0cnVjdCBkcm1f
cHJvcGVydHlfYmxvYiAqZGVnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0
OworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0
ZS0+aHcuZ2FtbWFfbHV0OworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZGVnYW1t
YV9sdXQgPSBjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dDsKIAogCWNoZXJyeXZpZXdfbG9hZF9j
c2NfbWF0cml4KGNydGNfc3RhdGUpOwogCkBAIC0xMDYzLDcgKzEwNjMsNyBAQCBpbnRlbF9jb2xv
cl9hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19z
dGF0ZSkKIAkJaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CiAJ
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKIAotCWlmICghbmV3X2NydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlIHx8CisJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlIHx8CiAJICAgIGRybV9h
dG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdfY3J0Y19zdGF0ZS0+YmFzZSkpCiAJCXJldHVy
biAwOwogCkBAIC0xMTA3LDggKzExMDcsOCBAQCBzdGF0aWMgaW50IGNoZWNrX2x1dF9zaXplKGNv
bnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqbHV0LCBpbnQgZXhwZWN0ZWQpCiBzdGF0aWMg
aW50IGNoZWNrX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0
YXRlLT5iYXNlLmNydGMtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpn
YW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKLQljb25zdCBzdHJ1Y3QgZHJt
X3Byb3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1
dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3Rh
dGUtPmh3LmdhbW1hX2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmRlZ2Ft
bWFfbHV0ID0gY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQ7CiAJaW50IGdhbW1hX2xlbmd0aCwg
ZGVnYW1tYV9sZW5ndGg7CiAJdTMyIGdhbW1hX3Rlc3RzLCBkZWdhbW1hX3Rlc3RzOwogCkBAIC0x
MTU2LDcgKzExNTYsNyBAQCBzdGF0aWMgaW50IGk5eHhfY29sb3JfY2hlY2soc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXJldHVybiByZXQ7CiAKIAljcnRjX3N0YXRlLT5n
YW1tYV9lbmFibGUgPQotCQljcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCAmJgorCQljcnRjX3N0
YXRlLT5ody5nYW1tYV9sdXQgJiYKIAkJIWNydGNfc3RhdGUtPmM4X3BsYW5lczsKIAogCWNydGNf
c3RhdGUtPmdhbW1hX21vZGUgPSBpOXh4X2dhbW1hX21vZGUoY3J0Y19zdGF0ZSk7CkBAIC0xMTc1
LDExICsxMTc1LDExIEBAIHN0YXRpYyB1MzIgY2h2X2NnbV9tb2RlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChjcnRjX3N0YXRlX2lzX2xlZ2FjeV9nYW1t
YShjcnRjX3N0YXRlKSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5kZWdh
bW1hX2x1dCkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQpCiAJCWNnbV9tb2RlIHw9
IENHTV9QSVBFX01PREVfREVHQU1NQTsKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5jdG0pCisJaWYg
KGNydGNfc3RhdGUtPmh3LmN0bSkKIAkJY2dtX21vZGUgfD0gQ0dNX1BJUEVfTU9ERV9DU0M7Ci0J
aWYgKGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0KQorCWlmIChjcnRjX3N0YXRlLT5ody5nYW1t
YV9sdXQpCiAJCWNnbV9tb2RlIHw9IENHTV9QSVBFX01PREVfR0FNTUE7CiAKIAlyZXR1cm4gY2dt
X21vZGU7CkBAIC0xMjUzLDcgKzEyNTMsNyBAQCBzdGF0aWMgaW50IGlsa19jb2xvcl9jaGVjayhz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJcmV0dXJuIHJldDsKIAogCWNy
dGNfc3RhdGUtPmdhbW1hX2VuYWJsZSA9Ci0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ICYm
CisJCWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCAmJgogCQkhY3J0Y19zdGF0ZS0+YzhfcGxhbmVz
OwogCiAJLyoKQEAgLTEyNzksOCArMTI3OSw4IEBAIHN0YXRpYyB1MzIgaXZiX2dhbW1hX21vZGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJaWYgKCFjcnRjX3N0
YXRlLT5nYW1tYV9lbmFibGUgfHwKIAkgICAgY3J0Y19zdGF0ZV9pc19sZWdhY3lfZ2FtbWEoY3J0
Y19zdGF0ZSkpCiAJCXJldHVybiBHQU1NQV9NT0RFX01PREVfOEJJVDsKLQllbHNlIGlmIChjcnRj
X3N0YXRlLT5iYXNlLmdhbW1hX2x1dCAmJgotCQkgY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1
dCkKKwllbHNlIGlmIChjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKKwkJIGNydGNfc3RhdGUt
Pmh3LmRlZ2FtbWFfbHV0KQogCQlyZXR1cm4gR0FNTUFfTU9ERV9NT0RFX1NQTElUOwogCWVsc2UK
IAkJcmV0dXJuIEdBTU1BX01PREVfTU9ERV8xMEJJVDsKQEAgLTEyOTQsNyArMTI5NCw3IEBAIHN0
YXRpYyB1MzIgaXZiX2NzY19tb2RlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCSAqIENTQyBjb21lcyBhZnRlciB0aGUgTFVUIGluIGRlZ2FtbWEsIFJHQi0+WUNi
Q3IsCiAJICogYW5kIFJHQiBmdWxsLT5saW1pdGVkIHJhbmdlIG1vZGUuCiAJICovCi0JaWYgKGNy
dGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQgfHwKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZGVnYW1t
YV9sdXQgfHwKIAkgICAgY3J0Y19zdGF0ZS0+b3V0cHV0X2Zvcm1hdCAhPSBJTlRFTF9PVVRQVVRf
Rk9STUFUX1JHQiB8fAogCSAgICBsaW1pdGVkX2NvbG9yX3JhbmdlKQogCQlyZXR1cm4gMDsKQEAg
LTEzMTIsMTMgKzEzMTIsMTMgQEAgc3RhdGljIGludCBpdmJfY29sb3JfY2hlY2soc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXJldHVybiByZXQ7CiAKIAljcnRjX3N0YXRl
LT5nYW1tYV9lbmFibGUgPQotCQkoY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgfHwKLQkJIGNy
dGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQpICYmCisJCShjcnRjX3N0YXRlLT5ody5nYW1tYV9s
dXQgfHwKKwkJIGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KSAmJgogCQkhY3J0Y19zdGF0ZS0+
YzhfcGxhbmVzOwogCiAJY3J0Y19zdGF0ZS0+Y3NjX2VuYWJsZSA9CiAJCWNydGNfc3RhdGUtPm91
dHB1dF9mb3JtYXQgIT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0IgfHwKLQkJY3J0Y19zdGF0ZS0+
YmFzZS5jdG0gfHwgbGltaXRlZF9jb2xvcl9yYW5nZTsKKwkJY3J0Y19zdGF0ZS0+aHcuY3RtIHx8
IGxpbWl0ZWRfY29sb3JfcmFuZ2U7CiAKIAljcnRjX3N0YXRlLT5nYW1tYV9tb2RlID0gaXZiX2dh
bW1hX21vZGUoY3J0Y19zdGF0ZSk7CiAKQEAgLTEzNDksMTQgKzEzNDksMTQgQEAgc3RhdGljIGlu
dCBnbGtfY29sb3JfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJ
CXJldHVybiByZXQ7CiAKIAljcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUgPQotCQljcnRjX3N0YXRl
LT5iYXNlLmdhbW1hX2x1dCAmJgorCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKIAkJIWNy
dGNfc3RhdGUtPmM4X3BsYW5lczsKIAogCS8qIE9uIEdMSysgZGVnYW1tYSBMVVQgaXMgY29udHJv
bGxlZCBieSBjc2NfZW5hYmxlICovCiAJY3J0Y19zdGF0ZS0+Y3NjX2VuYWJsZSA9Ci0JCWNydGNf
c3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQgfHwKKwkJY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQg
fHwKIAkJY3J0Y19zdGF0ZS0+b3V0cHV0X2Zvcm1hdCAhPSBJTlRFTF9PVVRQVVRfRk9STUFUX1JH
QiB8fAotCQljcnRjX3N0YXRlLT5iYXNlLmN0bSB8fCBjcnRjX3N0YXRlLT5saW1pdGVkX2NvbG9y
X3JhbmdlOworCQljcnRjX3N0YXRlLT5ody5jdG0gfHwgY3J0Y19zdGF0ZS0+bGltaXRlZF9jb2xv
cl9yYW5nZTsKIAogCWNydGNfc3RhdGUtPmdhbW1hX21vZGUgPSBnbGtfZ2FtbWFfbW9kZShjcnRj
X3N0YXRlKTsKIApAQCAtMTM3MywxNCArMTM3MywxNCBAQCBzdGF0aWMgdTMyIGljbF9nYW1tYV9t
b2RlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXUzMiBn
YW1tYV9tb2RlID0gMDsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0KQorCWlm
IChjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCkKIAkJZ2FtbWFfbW9kZSB8PSBQUkVfQ1NDX0dB
TU1BX0VOQUJMRTsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCAmJgorCWlmIChj
cnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKIAkgICAgIWNydGNfc3RhdGUtPmM4X3BsYW5lcykK
IAkJZ2FtbWFfbW9kZSB8PSBQT1NUX0NTQ19HQU1NQV9FTkFCTEU7CiAKLQlpZiAoIWNydGNfc3Rh
dGUtPmJhc2UuZ2FtbWFfbHV0IHx8CisJaWYgKCFjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgfHwK
IAkgICAgY3J0Y19zdGF0ZV9pc19sZWdhY3lfZ2FtbWEoY3J0Y19zdGF0ZSkpCiAJCWdhbW1hX21v
ZGUgfD0gR0FNTUFfTU9ERV9NT0RFXzhCSVQ7CiAJZWxzZQpAQCAtMTM5Myw3ICsxMzkzLDcgQEAg
c3RhdGljIHUzMiBpY2xfY3NjX21vZGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7CiAJdTMyIGNzY19tb2RlID0gMDsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNl
LmN0bSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuY3RtKQogCQljc2NfbW9kZSB8PSBJQ0xfQ1NDX0VO
QUJMRTsKIAogCWlmIChjcnRjX3N0YXRlLT5vdXRwdXRfZm9ybWF0ICE9IElOVEVMX09VVFBVVF9G
T1JNQVRfUkdCIHx8CkBAIC0xNjIyLDcgKzE2MjIsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3JlYWRf
bHV0cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoIWNydGNfc3Rh
dGUtPmdhbW1hX2VuYWJsZSkKIAkJcmV0dXJuOwogCi0JY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9s
dXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0ZSk7CisJY3J0Y19zdGF0ZS0+aHcuZ2FtbWFf
bHV0ID0gaTl4eF9yZWFkX2x1dF84KGNydGNfc3RhdGUpOwogfQogCiBzdGF0aWMgc3RydWN0IGRy
bV9wcm9wZXJ0eV9ibG9iICoKQEAgLTE2NzIsOSArMTY3Miw5IEBAIHN0YXRpYyB2b2lkIGk5NjVf
cmVhZF9sdXRzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlyZXR1cm47
CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkK
LQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0
ZSk7CisJCWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCA9IGk5eHhfcmVhZF9sdXRfOChjcnRjX3N0
YXRlKTsKIAllbHNlCi0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTk2NV9yZWFkX2x1
dF8xMHA2KGNydGNfc3RhdGUpOworCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgPSBpOTY1X3Jl
YWRfbHV0XzEwcDYoY3J0Y19zdGF0ZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX3Byb3BlcnR5
X2Jsb2IgKgpAQCAtMTcxNCw3ICsxNzE0LDcgQEAgY2h2X3JlYWRfY2dtX2x1dChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGNodl9yZWFkX2x1
dHMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJaWYgKGNydGNfc3Rh
dGUtPmNnbV9tb2RlICYgQ0dNX1BJUEVfTU9ERV9HQU1NQSkKLQkJY3J0Y19zdGF0ZS0+YmFzZS5n
YW1tYV9sdXQgPSBjaHZfcmVhZF9jZ21fbHV0KGNydGNfc3RhdGUpOworCQljcnRjX3N0YXRlLT5o
dy5nYW1tYV9sdXQgPSBjaHZfcmVhZF9jZ21fbHV0KGNydGNfc3RhdGUpOwogCWVsc2UKIAkJaTk2
NV9yZWFkX2x1dHMoY3J0Y19zdGF0ZSk7CiB9CkBAIC0xNzYxLDkgKzE3NjEsOSBAQCBzdGF0aWMg
dm9pZCBpbGtfcmVhZF9sdXRzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CQlyZXR1cm47CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01P
REVfOEJJVCkKLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0Xzgo
Y3J0Y19zdGF0ZSk7CisJCWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCA9IGk5eHhfcmVhZF9sdXRf
OChjcnRjX3N0YXRlKTsKIAllbHNlCi0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaWxr
X3JlYWRfbHV0XzEwKGNydGNfc3RhdGUpOworCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgPSBp
bGtfcmVhZF9sdXRfMTAoY3J0Y19zdGF0ZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX3Byb3Bl
cnR5X2Jsb2IgKgpAQCAtMTgxMCw5ICsxODEwLDkgQEAgc3RhdGljIHZvaWQgZ2xrX3JlYWRfbHV0
cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJcmV0dXJuOwogCiAJaWYg
KGNydGNfc3RhdGUtPmdhbW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFXzhCSVQpCi0JCWNydGNf
c3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1dF84KGNydGNfc3RhdGUpOworCQlj
cnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0ZSk7CiAJ
ZWxzZQotCQljcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCA9IGdsa19yZWFkX2x1dF8xMChjcnRj
X3N0YXRlLCBQQUxfUFJFQ19JTkRFWF9WQUxVRSgwKSk7CisJCWNydGNfc3RhdGUtPmh3LmdhbW1h
X2x1dCA9IGdsa19yZWFkX2x1dF8xMChjcnRjX3N0YXRlLCBQQUxfUFJFQ19JTkRFWF9WQUxVRSgw
KSk7CiB9CiAKIHZvaWQgaW50ZWxfY29sb3JfaW5pdChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5jCmluZGV4IGJmNTc2YjFlNTZh
ZS4uZWRkNzU0MzdiMmRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2NydC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0
LmMKQEAgLTEzMiw5ICsxMzIsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRfZ2V0X2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5
cGVzIHw9IEJJVChJTlRFTF9PVVRQVVRfQU5BTE9HKTsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFk
anVzdGVkX21vZGUuZmxhZ3MgfD0gaW50ZWxfY3J0X2dldF9mbGFncyhlbmNvZGVyKTsKKwlwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBpbnRlbF9jcnRfZ2V0X2ZsYWdzKGVu
Y29kZXIpOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0g
cGlwZV9jb25maWctPnBvcnRfY2xvY2s7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUu
Y3J0Y19jbG9jayA9IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOwogfQogCiBzdGF0aWMgdm9pZCBo
c3dfY3J0X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCkBAIC0xNDQs
MTMgKzE0NCwxMyBAQCBzdGF0aWMgdm9pZCBoc3dfY3J0X2dldF9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAKIAlpbnRlbF9kZGlfZ2V0X2NvbmZpZyhlbmNvZGVyLCBwaXBl
X2NvbmZpZyk7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICY9IH4o
RFJNX01PREVfRkxBR19QSFNZTkMgfAorCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZs
YWdzICY9IH4oRFJNX01PREVfRkxBR19QSFNZTkMgfAogCQkJCQkgICAgICBEUk1fTU9ERV9GTEFH
X05IU1lOQyB8CiAJCQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfUFZTWU5DIHwKIAkJCQkJICAgICAg
RFJNX01PREVfRkxBR19OVlNZTkMpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUu
ZmxhZ3MgfD0gaW50ZWxfY3J0X2dldF9mbGFncyhlbmNvZGVyKTsKKwlwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBpbnRlbF9jcnRfZ2V0X2ZsYWdzKGVuY29kZXIpOwogCi0J
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gbHB0X2dldF9pY2xr
aXAoZGV2X3ByaXYpOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sg
PSBscHRfZ2V0X2ljbGtpcChkZXZfcHJpdik7CiB9CiAKIC8qIE5vdGU6IFRoZSBjYWxsZXIgaXMg
cmVxdWlyZWQgdG8gZmlsdGVyIG91dCBkcG1zIG1vZGVzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlCkBA
IC0xNjIsNyArMTYyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0X3NldF9kcG1zKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnQgKmNydCA9
IGludGVsX2VuY29kZXJfdG9fY3J0KGVuY29kZXIpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0
ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBhZHBhOwogCiAJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gNSkKQEAgLTM1OCw3ICszNTgsNyBAQCBzdGF0aWMgaW50IGludGVs
X2NydF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkg
ICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmcGlwZV9jb25maWctPmJhc2UuYWRq
dXN0ZWRfbW9kZTsKKwkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYgKGFk
anVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19EQkxTQ0FOKQogCQlyZXR1cm4gLUVJ
TlZBTDsKQEAgLTM3Myw3ICszNzMsNyBAQCBzdGF0aWMgaW50IHBjaF9jcnRfY29tcHV0ZV9jb25m
aWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3Mg
JiBEUk1fTU9ERV9GTEFHX0RCTFNDQU4pCiAJCXJldHVybiAtRUlOVkFMOwpAQCAtMzkwLDcgKzM5
MCw3IEBAIHN0YXRpYyBpbnQgaHN3X2NydF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3Mg
JiBEUk1fTU9ERV9GTEFHX0RCTFNDQU4pCiAJCXJldHVybiAtRUlOVkFMOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKaW5kZXggZmVkN2ZjNTZkZDkyLi4xNDJhYjJjYmEy
NDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtMTUyOCw3
ICsxNTI4LDcgQEAgc3RhdGljIHZvaWQgZGRpX2RvdGNsb2NrX2dldChzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJaWYgKHBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVy
KQogCQlkb3RjbG9jayAvPSBwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcjsKIAotCXBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IGRvdGNsb2NrOworCXBpcGVf
Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9jazsKIH0KIAogc3Rh
dGljIHZvaWQgaWNsX2RkaV9jbG9ja19nZXQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CkBAIC0xODYwLDkgKzE4NjAsOSBAQCBpbnRlbF9kZGlfdHJhbnNjb2Rlcl9mdW5jX3JlZ192YWxf
Z2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlCVUcoKTsK
IAl9CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01P
REVfRkxBR19QVlNZTkMpCisJaWYgKGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3Mg
JiBEUk1fTU9ERV9GTEFHX1BWU1lOQykKIAkJdGVtcCB8PSBUUkFOU19ERElfUFZTWU5DOwotCWlm
IChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX1BI
U1lOQykKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RF
X0ZMQUdfUEhTWU5DKQogCQl0ZW1wIHw9IFRSQU5TX0RESV9QSFNZTkM7CiAKIAlpZiAoY3B1X3Ry
YW5zY29kZXIgPT0gVFJBTlNDT0RFUl9FRFApIHsKQEAgLTMzNzYsNyArMzM3Niw3IEBAIHN0YXRp
YyB2b2lkIHRnbF9kYzNjb19leGl0bGluZV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIHsKIAl1MzIgZXhpdF9zY2FubGluZXM7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKLQl1
MzIgY3J0Y192ZGlzcGxheSA9IGNzdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3Bs
YXk7CisJdTMyIGNydGNfdmRpc3BsYXkgPSBjc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y192
ZGlzcGxheTsKIAogCWNzdGF0ZS0+ZGMzY29fZXhpdGxpbmUgPSAwOwogCkBAIC0zMzg4LDcgKzMz
ODgsNyBAQCBzdGF0aWMgdm9pZCB0Z2xfZGMzY29fZXhpdGxpbmVfY29tcHV0ZV9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICAgIGVuY29kZXItPnBvcnQgIT0gUE9SVF9B
KQogCQlyZXR1cm47CiAKLQlpZiAoIWNzdGF0ZS0+aGFzX3BzcjIgfHwgIWNzdGF0ZS0+YmFzZS5h
Y3RpdmUpCisJaWYgKCFjc3RhdGUtPmhhc19wc3IyIHx8ICFjc3RhdGUtPmh3LmFjdGl2ZSkKIAkJ
cmV0dXJuOwogCiAJLyoKQEAgLTMzOTYsNyArMzM5Niw3IEBAIHN0YXRpYyB2b2lkIHRnbF9kYzNj
b19leGl0bGluZV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAkgKiBQU1IyIHRyYW5zY29kZXIgRWFybHkgRXhpdCBzY2FubGluZXMgPSBST1VORFVQKDIwMCAv
IGxpbmUgdGltZSkgKyAxCiAJICovCiAJZXhpdF9zY2FubGluZXMgPQotCQlpbnRlbF91c2Vjc190
b19zY2FubGluZXMoJmNzdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLCAyMDApICsgMTsKKwkJaW50
ZWxfdXNlY3NfdG9fc2NhbmxpbmVzKCZjc3RhdGUtPmh3LmFkanVzdGVkX21vZGUsIDIwMCkgKyAx
OwogCiAJaWYgKFdBUk5fT04oZXhpdF9zY2FubGluZXMgPiBjcnRjX3ZkaXNwbGF5KSkKIAkJcmV0
dXJuOwpAQCAtNDA4Myw3ICs0MDgzLDcgQEAgaW50ZWxfZGRpX3VwZGF0ZV9wcmVwYXJlKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCVdBUk5fT04oY3J0YyAmJiBjcnRjLT5hY3Rp
dmUpOwogCiAJaW50ZWxfdGNfcG9ydF9nZXRfbGluayhlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXIt
PmJhc2UpLCByZXF1aXJlZF9sYW5lcyk7Ci0JaWYgKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+
YmFzZS5hY3RpdmUpCisJaWYgKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQog
CQlpbnRlbF91cGRhdGVfYWN0aXZlX2RwbGwoc3RhdGUsIGNydGMsIGVuY29kZXIpOwogfQogCkBA
IC00MjMxLDcgKzQyMzEsNyBAQCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCWVsc2UKIAkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OVlNZ
TkM7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwor
CXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJc3dpdGNo
ICh0ZW1wICYgVFJBTlNfRERJX0JQQ19NQVNLKSB7CiAJY2FzZSBUUkFOU19ERElfQlBDXzY6CkBA
IC00NTE0LDcgKzQ1MTQsNyBAQCBzdGF0aWMgaW50IGludGVsX2hkbWlfcmVzZXRfbGluayhzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCVdBUk5fT04oIWludGVsX2NydGNfaGFzX3R5
cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0hETUkpKTsKIAotCWlmICghY3J0Y19zdGF0ZS0+
YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCXJldHVybiAwOwog
CiAJaWYgKCFjcnRjX3N0YXRlLT5oZG1pX2hpZ2hfdG1kc19jbG9ja19yYXRpbyAmJgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCAxODI3ZDFkNzI4
YzQuLjkxODgwNmMxYzUwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKQEAgLTEwNDAsNyArMTA0MCw3IEBAIGJvb2wgaW50ZWxfY3J0Y19hY3RpdmUo
c3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJICogZm9yIGF0b21pYy4KIAkgKi8KIAlyZXR1cm4g
Y3J0Yy0+YWN0aXZlICYmIGNydGMtPmJhc2UucHJpbWFyeS0+c3RhdGUtPmZiICYmCi0JCWNydGMt
PmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJCWNydGMtPmNvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogfQogCiBlbnVtIHRyYW5zY29kZXIgaW50ZWxf
cGlwZV90b19jcHVfdHJhbnNjb2RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CkBAIC01MDg2LDcgKzUwODYsNyBAQCBzdGF0aWMgdm9pZCBscHRfcHJvZ3JhbV9pY2xraXAoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
Ci0JaW50IGNsb2NrID0gY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7
CisJaW50IGNsb2NrID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwog
CXUzMiBkaXZzZWwsIHBoYXNlaW5jLCBhdXhkaXYsIHBoYXNlZGlyID0gMDsKIAl1MzIgdGVtcDsK
IApAQCAtNTM1OSw3ICs1MzU5LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX2VuYWJsZShj
b25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlpZiAoSEFTX1BDSF9DUFQo
ZGV2X3ByaXYpICYmCiAJICAgIGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIoY3J0Y19zdGF0ZSkp
IHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJ
JmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlOwogCQl1MzIgYnBjID0gKEk5MTVfUkVBRChQSVBFQ09ORihwaXBlKSkgJiBQSVBF
Q09ORl9CUENfTUFTSykgPj4gNTsKIAkJaTkxNV9yZWdfdCByZWcgPSBUUkFOU19EUF9DVEwocGlw
ZSk7CiAJCWVudW0gcG9ydCBwb3J0OwpAQCAtNTUwOSw3ICs1NTA5LDcgQEAgc2tsX3VwZGF0ZV9z
Y2FsZXIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsIGJvb2wgZm9yY2VfZGV0
YWNoLAogCQl0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7
CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0
Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAogCS8qCiAJICogU3JjIGNvb3JkaW5hdGVzIGFyZSBhbHJlYWR5IHJvdGF0ZWQgYnkg
MjcwIGRlZ3JlZXMgZm9yCkBAIC01NTI1LDcgKzU1MjUsNyBAQCBza2xfdXBkYXRlX3NjYWxlcihz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwgYm9vbCBmb3JjZV9kZXRhY2gsCiAJ
ICogT25jZSBOVjEyIGlzIGVuYWJsZWQsIGhhbmRsZSBpdCBoZXJlIHdoaWxlIGFsbG9jYXRpbmcg
c2NhbGVyCiAJICogZm9yIE5WMTIuCiAJICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSAmJiBjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJgorCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDkgJiYgY3J0Y19zdGF0ZS0+aHcuZW5hYmxlICYmCiAJICAgIG5lZWRfc2NhbGVyICYmIGFk
anVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpIHsKIAkJRFJNX0RF
QlVHX0tNUygiUGlwZS9QbGFuZSBzY2FsaW5nIG5vdCBzdXBwb3J0ZWQgd2l0aCBJRi1JRCBtb2Rl
XG4iKTsKIAkJcmV0dXJuIC1FSU5WQUw7CkBAIC01NTk3LDEzICs1NTk3LDEzIEBAIHNrbF91cGRh
dGVfc2NhbGVyKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLCBib29sIGZvcmNl
X2RldGFjaCwKICAqLwogaW50IHNrbF91cGRhdGVfc2NhbGVyX2NydGMoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnN0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0gJnN0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7
CiAJYm9vbCBuZWVkX3NjYWxlciA9IGZhbHNlOwogCiAJaWYgKHN0YXRlLT5vdXRwdXRfZm9ybWF0
ID09IElOVEVMX09VVFBVVF9GT1JNQVRfWUNCQ1I0MjApCiAJCW5lZWRfc2NhbGVyID0gdHJ1ZTsK
IAotCXJldHVybiBza2xfdXBkYXRlX3NjYWxlcihzdGF0ZSwgIXN0YXRlLT5iYXNlLmFjdGl2ZSwg
U0tMX0NSVENfSU5ERVgsCisJcmV0dXJuIHNrbF91cGRhdGVfc2NhbGVyKHN0YXRlLCAhc3RhdGUt
Pmh3LmFjdGl2ZSwgU0tMX0NSVENfSU5ERVgsCiAJCQkJICZzdGF0ZS0+c2NhbGVyX3N0YXRlLnNj
YWxlcl9pZCwKIAkJCQkgc3RhdGUtPnBpcGVfc3JjX3csIHN0YXRlLT5waXBlX3NyY19oLAogCQkJ
CSBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5LApAQCAtNTk1OCw3ICs1OTU4LDcgQEAgc3Rh
dGljIGJvb2wgaHN3X3Bvc3RfdXBkYXRlX2VuYWJsZV9pcHMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKm9sZF9jcnRjX3MKIAkgKiBmb3JjaWJseSBlbmFibGUgSVBTIG9uIHRoZSBmaXJz
dCBmYXN0c2V0LgogCSAqLwogCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgJiYKLQkg
ICAgb2xkX2NydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5wcml2YXRlX2ZsYWdzICYgSTkx
NV9NT0RFX0ZMQUdfSU5IRVJJVEVEKQorCSAgICBvbGRfY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKQogCQlyZXR1cm4g
dHJ1ZTsKIAogCXJldHVybiAhb2xkX2NydGNfc3RhdGUtPmlwc19lbmFibGVkOwpAQCAtNjAwMiw3
ICs2MDAyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9zdF9wbGFuZV91cGRhdGUoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogCiAJaW50ZWxfZnJvbnRidWZmZXJfZmxp
cCh0b19pOTE1KGNydGMtPmJhc2UuZGV2KSwgcGlwZV9jb25maWctPmZiX2JpdHMpOwogCi0JaWYg
KHBpcGVfY29uZmlnLT51cGRhdGVfd21fcG9zdCAmJiBwaXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUp
CisJaWYgKHBpcGVfY29uZmlnLT51cGRhdGVfd21fcG9zdCAmJiBwaXBlX2NvbmZpZy0+aHcuYWN0
aXZlKQogCQlpbnRlbF91cGRhdGVfd2F0ZXJtYXJrcyhjcnRjKTsKIAogCWlmIChoc3dfcG9zdF91
cGRhdGVfZW5hYmxlX2lwcyhvbGRfY3J0Y19zdGF0ZSwgcGlwZV9jb25maWcpKQpAQCAtNjA4MCw3
ICs2MDgwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJICogZXZlbnQgd2hpY2ggaXMgYWZ0ZXIg
dGhlIHZibGFuayBzdGFydCBldmVudCwgc28gd2UgbmVlZCB0byBoYXZlIGEKIAkgKiB3YWl0LWZv
ci12YmxhbmsgYmV0d2VlbiBkaXNhYmxpbmcgdGhlIHBsYW5lIGFuZCB0aGUgcGlwZS4KIAkgKi8K
LQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmIG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAm
JgorCWlmIChIQVNfR01DSChkZXZfcHJpdikgJiYgb2xkX2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAm
JgogCSAgICBwaXBlX2NvbmZpZy0+ZGlzYWJsZV9jeHNyICYmIGludGVsX3NldF9tZW1vcnlfY3hz
cihkZXZfcHJpdiwgZmFsc2UpKQogCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIGNy
dGMtPnBpcGUpOwogCkBAIC02MDkyLDcgKzYwOTIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVf
cGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkg
KiBXYUN4U1JEaXNhYmxlZEZvclNwcml0ZVNjYWxpbmc6aXZiCiAJICovCiAJaWYgKHBpcGVfY29u
ZmlnLT5kaXNhYmxlX2xwX3dtICYmIGlsa19kaXNhYmxlX2xwX3dtKGRldikgJiYKLQkgICAgb2xk
X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCSAgICBvbGRfY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
KQogCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIGNydGMtPnBpcGUpOwogCiAJLyoK
QEAgLTY4OTYsNyArNjg5Niw3IEBAIHN0YXRpYyB1NjQgZ2V0X2NydGNfcG93ZXJfZG9tYWlucyhz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAl1NjQgbWFzazsKIAllbnVtIHRy
YW5zY29kZXIgdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCi0JaWYg
KCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkK
IAkJcmV0dXJuIDA7CiAKIAltYXNrID0gQklUX1VMTChQT1dFUl9ET01BSU5fUElQRShwaXBlKSk7
CkBAIC03MjUzLDggKzcyNTMsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jb25uZWN0b3JfdmVyaWZ5
X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlpZiAoIWNydGNf
c3RhdGUpCiAJCQlyZXR1cm47CiAKLQkJSTkxNV9TVEFURV9XQVJOKCFjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSwKLQkJICAgICAgImNvbm5lY3RvciBpcyBhY3RpdmUsIGJ1dCBhdHRhY2hlZCBjcnRj
IGlzbid0XG4iKTsKKwkJSTkxNV9TVEFURV9XQVJOKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUsCisJ
CQkJImNvbm5lY3RvciBpcyBhY3RpdmUsIGJ1dCBhdHRhY2hlZCBjcnRjIGlzbid0XG4iKTsKIAog
CQlpZiAoIWVuY29kZXIgfHwgZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRFBfTVNUKQog
CQkJcmV0dXJuOwpAQCAtNzI2NSw4ICs3MjY1LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfY29ubmVj
dG9yX3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
STkxNV9TVEFURV9XQVJOKGNvbm5fc3RhdGUtPmNydGMgIT0gZW5jb2Rlci0+YmFzZS5jcnRjLAog
CQkJImF0dGFjaGVkIGVuY29kZXIgY3J0YyBkaWZmZXJzIGZyb20gY29ubmVjdG9yIGNydGNcbiIp
OwogCX0gZWxzZSB7Ci0JCUk5MTVfU1RBVEVfV0FSTihjcnRjX3N0YXRlICYmIGNydGNfc3RhdGUt
PmJhc2UuYWN0aXZlLAotCQkJImF0dGFjaGVkIGNydGMgaXMgYWN0aXZlLCBidXQgY29ubmVjdG9y
IGlzbid0XG4iKTsKKwkJSTkxNV9TVEFURV9XQVJOKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+
aHcuYWN0aXZlLAorCQkJCSJhdHRhY2hlZCBjcnRjIGlzIGFjdGl2ZSwgYnV0IGNvbm5lY3RvciBp
c24ndFxuIik7CiAJCUk5MTVfU1RBVEVfV0FSTighY3J0Y19zdGF0ZSAmJiBjb25uX3N0YXRlLT5i
ZXN0X2VuY29kZXIsCiAJCQkiYmVzdCBlbmNvZGVyIHNldCB3aXRob3V0IGNydGMhXG4iKTsKIAl9
CkBAIC03Mjc0LDcgKzcyNzQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jb25uZWN0b3JfdmVyaWZ5
X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBzdGF0aWMgaW50
IHBpcGVfcmVxdWlyZWRfZmRpX2xhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJiBjcnRjX3N0YXRlLT5oYXNf
cGNoX2VuY29kZXIpCisJaWYgKGNydGNfc3RhdGUtPmh3LmVuYWJsZSAmJiBjcnRjX3N0YXRlLT5o
YXNfcGNoX2VuY29kZXIpCiAJCXJldHVybiBjcnRjX3N0YXRlLT5mZGlfbGFuZXM7CiAKIAlyZXR1
cm4gMDsKQEAgLTczNTcsNyArNzM1Nyw3IEBAIHN0YXRpYyBpbnQgaXJvbmxha2VfZmRpX2NvbXB1
dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkJCSAgICAgICBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IGludGVsX2NydGMtPmJhc2UuZGV2OwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IGxhbmUsIGxpbmtfYncsIGZkaV9kb3RjbG9jaywg
cmV0OwogCWJvb2wgbmVlZHNfcmVjb21wdXRlID0gZmFsc2U7CiAKQEAgLTc0NzQsNyArNzQ3NCw3
IEBAIHN0YXRpYyB1MzIgaWxrX3BpcGVfcGl4ZWxfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJdTMyIHBpeGVsX3JhdGU7CiAKLQlwaXhlbF9yYXRl
ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCXBpeGVsX3Jh
dGUgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCiAJLyoKIAkg
KiBXZSBvbmx5IHVzZSBJRi1JRCBpbnRlcmxhY2luZy4gSWYgd2UgZXZlciB1c2UKQEAgLTc1MTIs
NyArNzUxMiw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfY29tcHV0ZV9waXhlbF9yYXRlKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChIQVNfR01DSChkZXZfcHJp
dikpCiAJCS8qIEZJWE1FIGNhbGN1bGF0ZSBwcm9wZXIgcGlwZSBwaXhlbCByYXRlIGZvciBHTUNI
IHBmaXQgKi8KIAkJY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSA9Ci0JCQljcnRjX3N0YXRlLT5iYXNl
LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKwkJCWNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y19jbG9jazsKIAllbHNlCiAJCWNydGNfc3RhdGUtPnBpeGVsX3JhdGUgPQogCQkJaWxr
X3BpcGVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlKTsKQEAgLTc1MjIsNyArNzUyMiw3IEBAIHN0YXRp
YyBpbnQgaW50ZWxfY3J0Y19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywK
IAkJCQkgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
LQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCWludCBj
bG9ja19saW1pdCA9IGRldl9wcml2LT5tYXhfZG90Y2xrX2ZyZXE7CiAKIAlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA8IDQpIHsKQEAgLTc1NDgsNyArNzU0OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
Y3J0Y19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCWlmICgocGlw
ZV9jb25maWctPm91dHB1dF9mb3JtYXQgPT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9ZQ0JDUjQyMCB8
fAogCSAgICAgcGlwZV9jb25maWctPm91dHB1dF9mb3JtYXQgPT0gSU5URUxfT1VUUFVUX0ZPUk1B
VF9ZQ0JDUjQ0NCkgJiYKLQkgICAgIHBpcGVfY29uZmlnLT5iYXNlLmN0bSkgeworCSAgICAgcGlw
ZV9jb25maWctPmh3LmN0bSkgewogCQkvKgogCQkgKiBUaGVyZSBpcyBvbmx5IG9uZSBwaXBlIENT
QyB1bml0IHBlciBwaXBlLCBhbmQgd2UgbmVlZCB0aGF0CiAJCSAqIGZvciBvdXRwdXQgY29udmVy
c2lvbiBmcm9tIFJHQi0+WUNCQ1IuIFNvIGlmIENUTSBpcyBhbHJlYWR5CkBAIC04MjQ2LDcgKzgy
NDYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZXRfcGlwZV90aW1pbmdzKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5j
cHVfdHJhbnNjb2RlcjsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSA9ICZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAl1MzIgY3J0Y192dG90YWwsIGNydGNfdmJsYW5rX2VuZDsKIAlpbnQgdnN5bmNzaGlm
dCA9IDA7CiAKQEAgLTgzNDAsMzkgKzgzNDAsMzkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZ2V0X3Bp
cGVfdGltaW5ncyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAl1MzIgdG1wOwogCiAJdG1wID0g
STkxNV9SRUFEKEhUT1RBTChjcHVfdHJhbnNjb2RlcikpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFk
anVzdGVkX21vZGUuY3J0Y19oZGlzcGxheSA9ICh0bXAgJiAweGZmZmYpICsgMTsKLQlwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsID0gKCh0bXAgPj4gMTYpICYgMHhm
ZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxheSA9
ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X2h0b3RhbCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCiAJaWYgKCF0cmFuc2NvZGVy
X2lzX2RzaShjcHVfdHJhbnNjb2RlcikpIHsKIAkJdG1wID0gSTkxNV9SRUFEKEhCTEFOSyhjcHVf
dHJhbnNjb2RlcikpOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGJs
YW5rX3N0YXJ0ID0KKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtf
c3RhcnQgPQogCQkJCQkJCSh0bXAgJiAweGZmZmYpICsgMTsKLQkJcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZS5jcnRjX2hibGFua19lbmQgPQorCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX2hibGFua19lbmQgPQogCQkJCQkJKCh0bXAgPj4gMTYpICYgMHhmZmZmKSAr
IDE7CiAJfQogCXRtcCA9IEk5MTVfUkVBRChIU1lOQyhjcHVfdHJhbnNjb2RlcikpOwotCXBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19zdGFydCA9ICh0bXAgJiAweGZm
ZmYpICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfZW5k
ID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y19oc3luY19zdGFydCA9ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX2VuZCA9ICgodG1wID4+IDE2KSAmIDB4ZmZm
ZikgKyAxOwogCiAJdG1wID0gSTkxNV9SRUFEKFZUT1RBTChjcHVfdHJhbnNjb2RlcikpOwotCXBp
cGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheSA9ICh0bXAgJiAweGZm
ZmYpICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsID0g
KCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y192ZGlzcGxheSA9ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwog
CiAJaWYgKCF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpIHsKIAkJdG1wID0gSTkx
NV9SRUFEKFZCTEFOSyhjcHVfdHJhbnNjb2RlcikpOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1
c3RlZF9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0ID0KKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y192Ymxhbmtfc3RhcnQgPQogCQkJCQkJCSh0bXAgJiAweGZmZmYpICsgMTsKLQkJ
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZibGFua19lbmQgPQorCQlwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZibGFua19lbmQgPQogCQkJCQkJKCh0bXAg
Pj4gMTYpICYgMHhmZmZmKSArIDE7CiAJfQogCXRtcCA9IEk5MTVfUkVBRChWU1lOQyhjcHVfdHJh
bnNjb2RlcikpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192c3luY19z
dGFydCA9ICh0bXAgJiAweGZmZmYpICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfdnN5bmNfZW5kID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192c3luY19zdGFydCA9ICh0bXAgJiAweGZmZmYp
ICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZCA9ICgo
dG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCiAJaWYgKGludGVsX3BpcGVfaXNfaW50ZXJsYWNl
ZChwaXBlX2NvbmZpZykpIHsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFn
cyB8PSBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRTsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5jcnRjX3Z0b3RhbCArPSAxOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfdmJsYW5rX2VuZCArPSAxOworCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9k
ZS5mbGFncyB8PSBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRTsKKwkJcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGUuY3J0Y192dG90YWwgKz0gMTsKKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y192YmxhbmtfZW5kICs9IDE7CiAJfQogfQogCkBAIC04Mzg3LDI3ICs4Mzg3LDI3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2dldF9waXBlX3NyY19zaXplKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCXBpcGVfY29uZmlnLT5waXBlX3NyY19oID0gKHRtcCAmIDB4ZmZmZikgKyAxOwog
CXBpcGVfY29uZmlnLT5waXBlX3NyY193ID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CiAK
LQlwaXBlX2NvbmZpZy0+YmFzZS5tb2RlLnZkaXNwbGF5ID0gcGlwZV9jb25maWctPnBpcGVfc3Jj
X2g7Ci0JcGlwZV9jb25maWctPmJhc2UubW9kZS5oZGlzcGxheSA9IHBpcGVfY29uZmlnLT5waXBl
X3NyY193OworCXBpcGVfY29uZmlnLT5ody5tb2RlLnZkaXNwbGF5ID0gcGlwZV9jb25maWctPnBp
cGVfc3JjX2g7CisJcGlwZV9jb25maWctPmh3Lm1vZGUuaGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+
cGlwZV9zcmNfdzsKIH0KIAogdm9pZCBpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25maWcoc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKm1vZGUsCiAJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpw
aXBlX2NvbmZpZykKIHsKLQltb2RlLT5oZGlzcGxheSA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVz
dGVkX21vZGUuY3J0Y19oZGlzcGxheTsKLQltb2RlLT5odG90YWwgPSBwaXBlX2NvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsOwotCW1vZGUtPmhzeW5jX3N0YXJ0ID0gcGlwZV9j
b25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX3N0YXJ0OwotCW1vZGUtPmhzeW5j
X2VuZCA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQ7CisJ
bW9kZS0+aGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNw
bGF5OworCW1vZGUtPmh0b3RhbCA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNf
aHRvdGFsOworCW1vZGUtPmhzeW5jX3N0YXJ0ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y19oc3luY19zdGFydDsKKwltb2RlLT5oc3luY19lbmQgPSBwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX2VuZDsKIAotCW1vZGUtPnZkaXNwbGF5ID0gcGlwZV9j
b25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwotCW1vZGUtPnZ0b3RhbCA9
IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192dG90YWw7Ci0JbW9kZS0+dnN5
bmNfc3RhcnQgPSBwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfc3Rh
cnQ7Ci0JbW9kZS0+dnN5bmNfZW5kID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5j
cnRjX3ZzeW5jX2VuZDsKKwltb2RlLT52ZGlzcGxheSA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlLmNydGNfdmRpc3BsYXk7CisJbW9kZS0+dnRvdGFsID0gcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGUuY3J0Y192dG90YWw7CisJbW9kZS0+dnN5bmNfc3RhcnQgPSBwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0OworCW1vZGUtPnZzeW5jX2VuZCA9
IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfZW5kOwogCi0JbW9kZS0+
ZmxhZ3MgPSBwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzOworCW1vZGUtPmZs
YWdzID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3M7CiAJbW9kZS0+dHlwZSA9
IERSTV9NT0RFX1RZUEVfRFJJVkVSOwogCi0JbW9kZS0+Y2xvY2sgPSBwaXBlX2NvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJbW9kZS0+Y2xvY2sgPSBwaXBlX2NvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCiAJbW9kZS0+aHN5bmMgPSBkcm1fbW9kZV9o
c3luYyhtb2RlKTsKIAltb2RlLT52cmVmcmVzaCA9IGRybV9tb2RlX3ZyZWZyZXNoKG1vZGUpOwpA
QCAtODQ1Myw3ICs4NDUzLDcgQEAgc3RhdGljIHZvaWQgaTl4eF9zZXRfcGlwZWNvbmYoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCX0KIAl9CiAKLQlpZiAoY3J0
Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxB
Q0UpIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RF
X0ZMQUdfSU5URVJMQUNFKSB7CiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCB8fAogCQkg
ICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfU0RWTykpCiAJ
CQlwaXBlY29uZiB8PSBQSVBFQ09ORl9JTlRFUkxBQ0VfV19GSUVMRF9JTkRJQ0FUSU9OOwpAQCAt
ODk4Niw3ICs4OTg2LDcgQEAgc3RhdGljIGJvb2wgaTl4eF9nZXRfcGlwZV9jb25maWcoc3RydWN0
IGludGVsX2NydGMgKmNydGMsCiAJICogYnV0IGluIGNhc2UgdGhlIHBpcGUgaXMgZW5hYmxlZCB3
L28gYW55IHBvcnRzIHdlIG5lZWQgYSBzYW5lCiAJICogZGVmYXVsdC4KIAkgKi8KLQlwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPQorCXBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPQogCQlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayAvIHBp
cGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyOwogCiAJcmV0ID0gdHJ1ZTsKQEAgLTk1MzAsNyAr
OTUzMCw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoY3J0Y19zdGF0ZS0+ZGl0aGVyKQog
CQl2YWwgfD0gKFBJUEVDT05GX0RJVEhFUl9FTiB8IFBJUEVDT05GX0RJVEhFUl9UWVBFX1NQKTsK
IAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQl2YWwgfD0gUElQRUNPTkZfSU5URVJMQUNFRF9J
TEs7CiAJZWxzZQogCQl2YWwgfD0gUElQRUNPTkZfUFJPR1JFU1NJVkU7CkBAIC05NTY0LDcgKzk1
NjQsNyBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgJiYg
Y3J0Y19zdGF0ZS0+ZGl0aGVyKQogCQl2YWwgfD0gKFBJUEVDT05GX0RJVEhFUl9FTiB8IFBJUEVD
T05GX0RJVEhFUl9UWVBFX1NQKTsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21v
ZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQl2YWwgfD0g
UElQRUNPTkZfSU5URVJMQUNFRF9JTEs7CiAJZWxzZQogCQl2YWwgfD0gUElQRUNPTkZfUFJPR1JF
U1NJVkU7CkBAIC0xMTY0Myw3ICsxMTY0Myw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3BjaF9j
bG9ja19nZXQoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJICogd2UgbWF5IG5lZWQgc29tZSBp
ZGVhIGZvciB0aGUgZG90Y2xvY2sgYW55d2F5LgogCSAqIENhbGN1bGF0ZSBvbmUgYmFzZWQgb24g
dGhlIEZESSBjb25maWd1cmF0aW9uLgogCSAqLwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVk
X21vZGUuY3J0Y19jbG9jayA9CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19j
bG9jayA9CiAJCWludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShpbnRlbF9mZGlfbGlua19mcmVxKGRl
dl9wcml2LCBwaXBlX2NvbmZpZyksCiAJCQkJCSAmcGlwZV9jb25maWctPmZkaV9tX24pOwogfQpA
QCAtMTE3NDgsOCArMTE3NDgsOCBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdl
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJYm9vbCBtb2RlX2NoYW5nZWQgPSBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUp
OwotCWJvb2wgd2FzX2NydGNfZW5hYmxlZCA9IG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZTsK
LQlib29sIGlzX2NydGNfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlOworCWJvb2wg
d2FzX2NydGNfZW5hYmxlZCA9IG9sZF9jcnRjX3N0YXRlLT5ody5hY3RpdmU7CisJYm9vbCBpc19j
cnRjX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5ody5hY3RpdmU7CiAJYm9vbCB0dXJuX29mZiwgdHVy
bl9vbiwgdmlzaWJsZSwgd2FzX3Zpc2libGU7CiAJaW50IHJldDsKIApAQCAtMTIwMjYsOCArMTIw
MjYsOCBAQCBzdGF0aWMgaW50IGljbF9hZGRfc3luY19tb2RlX2NydGNzKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQkJY29udGludWU7CiAJCWlmICghY29ubmVjdG9yLT5o
YXNfdGlsZSkKIAkJCWNvbnRpbnVlOwotCQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5tb2RlLmhkaXNw
bGF5ICE9IGNvbm5lY3Rvci0+dGlsZV9oX3NpemUgfHwKLQkJICAgIGNydGNfc3RhdGUtPmJhc2Uu
bW9kZS52ZGlzcGxheSAhPSBjb25uZWN0b3ItPnRpbGVfdl9zaXplKQorCQlpZiAoY3J0Y19zdGF0
ZS0+aHcubW9kZS5oZGlzcGxheSAhPSBjb25uZWN0b3ItPnRpbGVfaF9zaXplIHx8CisJCSAgICBj
cnRjX3N0YXRlLT5ody5tb2RlLnZkaXNwbGF5ICE9IGNvbm5lY3Rvci0+dGlsZV92X3NpemUpCiAJ
CQlyZXR1cm4gMDsKIAkJaWYgKGNvbm5lY3Rvci0+dGlsZV9oX2xvYyA9PSBjb25uZWN0b3ItPm51
bV9oX3RpbGUgLSAxICYmCiAJCSAgICBjb25uZWN0b3ItPnRpbGVfdl9sb2MgPT0gY29ubmVjdG9y
LT5udW1fdl90aWxlIC0gMSkKQEAgLTEyMDkzLDEwICsxMjA5MywxMCBAQCBzdGF0aWMgaW50IGlu
dGVsX2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAog
CWludCByZXQ7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDUgJiYgIUlTX0c0WChkZXZf
cHJpdikgJiYKLQkgICAgbW9kZV9jaGFuZ2VkICYmICFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkK
KwkgICAgbW9kZV9jaGFuZ2VkICYmICFjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCWNydGNfc3Rh
dGUtPnVwZGF0ZV93bV9wb3N0ID0gdHJ1ZTsKIAotCWlmIChtb2RlX2NoYW5nZWQgJiYgY3J0Y19z
dGF0ZS0+YmFzZS5lbmFibGUgJiYKKwlpZiAobW9kZV9jaGFuZ2VkICYmIGNydGNfc3RhdGUtPmh3
LmVuYWJsZSAmJgogCSAgICBkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sgJiYK
IAkgICAgIVdBUk5fT04oY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwpKSB7CiAJCXJldCA9IGRldl9w
cml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jayhjcnRjLCBjcnRjX3N0YXRlKTsKQEAgLTEy
Mzg3LDE0ICsxMjM4NywxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kdW1wX3BpcGVfY29uZmlnKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAogCURSTV9ERUJVR19L
TVMoIltDUlRDOiVkOiVzXSBlbmFibGU6ICVzICVzXG4iLAogCQkgICAgICBjcnRjLT5iYXNlLmJh
c2UuaWQsIGNydGMtPmJhc2UubmFtZSwKLQkJICAgICAgeWVzbm8ocGlwZV9jb25maWctPmJhc2Uu
ZW5hYmxlKSwgY29udGV4dCk7CisJCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5ody5lbmFibGUp
LCBjb250ZXh0KTsKIAotCWlmICghcGlwZV9jb25maWctPmJhc2UuZW5hYmxlKQorCWlmICghcGlw
ZV9jb25maWctPmh3LmVuYWJsZSkKIAkJZ290byBkdW1wX3BsYW5lczsKIAogCXNucHJpbnRmX291
dHB1dF90eXBlcyhidWYsIHNpemVvZihidWYpLCBwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzKTsK
IAlEUk1fREVCVUdfS01TKCJhY3RpdmU6ICVzLCBvdXRwdXRfdHlwZXM6ICVzICgweCV4KSwgb3V0
cHV0IGZvcm1hdDogJXNcbiIsCi0JCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5iYXNlLmFjdGl2
ZSksCisJCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5ody5hY3RpdmUpLAogCQkgICAgICBidWYs
IHBpcGVfY29uZmlnLT5vdXRwdXRfdHlwZXMsCiAJCSAgICAgIG91dHB1dF9mb3JtYXRzKHBpcGVf
Y29uZmlnLT5vdXRwdXRfZm9ybWF0KSk7CiAKQEAgLTEyNDM0LDEwICsxMjQzNCwxMCBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9kdW1wX3BpcGVfY29uZmlnKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpwaXBlX2NvbmZpZywKIAkJaW50ZWxfZHVtcF9pbmZvZnJhbWUoZGV2X3ByaXYsICZwaXBl
X2NvbmZpZy0+aW5mb2ZyYW1lcy5oZG1pKTsKIAogCURSTV9ERUJVR19LTVMoInJlcXVlc3RlZCBt
b2RlOlxuIik7Ci0JZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZSgmcGlwZV9jb25maWctPmJh
c2UubW9kZSk7CisJZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZSgmcGlwZV9jb25maWctPmh3
Lm1vZGUpOwogCURSTV9ERUJVR19LTVMoImFkanVzdGVkIG1vZGU6XG4iKTsKLQlkcm1fbW9kZV9k
ZWJ1Z19wcmludG1vZGVsaW5lKCZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlKTsKLQlp
bnRlbF9kdW1wX2NydGNfdGltaW5ncygmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZSk7
CisJZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZSgmcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUpOworCWludGVsX2R1bXBfY3J0Y190aW1pbmdzKCZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZSk7CiAJRFJNX0RFQlVHX0tNUygicG9ydCBjbG9jazogJWQsIHBpcGUgc3JjIHNpemU6
ICVkeCVkLCBwaXhlbCByYXRlICVkXG4iLAogCQkgICAgICBwaXBlX2NvbmZpZy0+cG9ydF9jbG9j
aywKIAkJICAgICAgcGlwZV9jb25maWctPnBpcGVfc3JjX3csIHBpcGVfY29uZmlnLT5waXBlX3Ny
Y19oLApAQCAtMTI2MjUsMTMgKzEyNjI1LDEzIEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWco
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCSAqIHBvc2l0aXZlIG9yIG5l
Z2F0aXZlIHBvbGFyaXR5IGlzIHJlcXVlc3RlZCwgdHJlYXQgdGhpcyBhcyBtZWFuaW5nCiAJICog
bmVnYXRpdmUgcG9sYXJpdHkuCiAJICovCi0JaWYgKCEocGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5mbGFncyAmCisJaWYgKCEocGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxh
Z3MgJgogCSAgICAgIChEUk1fTU9ERV9GTEFHX1BIU1lOQyB8IERSTV9NT0RFX0ZMQUdfTkhTWU5D
KSkpCi0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gRFJNX01PREVf
RkxBR19OSFNZTkM7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IERS
TV9NT0RFX0ZMQUdfTkhTWU5DOwogCi0JaWYgKCEocGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5mbGFncyAmCisJaWYgKCEocGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3Mg
JgogCSAgICAgIChEUk1fTU9ERV9GTEFHX1BWU1lOQyB8IERSTV9NT0RFX0ZMQUdfTlZTWU5DKSkp
Ci0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gRFJNX01PREVfRkxB
R19OVlNZTkM7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IERSTV9N
T0RFX0ZMQUdfTlZTWU5DOwogCiAJcmV0ID0gY29tcHV0ZV9iYXNlbGluZV9waXBlX2JwcCh0b19p
bnRlbF9jcnRjKGNydGMpLAogCQkJCQlwaXBlX2NvbmZpZyk7CkBAIC0xMjY0OCw3ICsxMjY0OCw3
IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBp
cGVfY29uZmlnKQogCSAqIGNvbXB1dGF0aW9uIHRvIGNsZWFybHkgZGlzdGluZ3Vpc2ggaXQgZnJv
bSB0aGUgYWRqdXN0ZWQgbW9kZSwgd2hpY2gKIAkgKiBjYW4gYmUgY2hhbmdlZCBieSB0aGUgY29u
bmVjdG9ycyBpbiB0aGUgYmVsb3cgcmV0cnkgbG9vcC4KIAkgKi8KLQlkcm1fbW9kZV9nZXRfaHZf
dGltaW5nKCZwaXBlX2NvbmZpZy0+YmFzZS5tb2RlLAorCWRybV9tb2RlX2dldF9odl90aW1pbmco
JnBpcGVfY29uZmlnLT5ody5tb2RlLAogCQkJICAgICAgICZwaXBlX2NvbmZpZy0+cGlwZV9zcmNf
dywKIAkJCSAgICAgICAmcGlwZV9jb25maWctPnBpcGVfc3JjX2gpOwogCkBAIC0xMjY4MSw3ICsx
MjY4MSw3IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKnBpcGVfY29uZmlnKQogCXBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyID0gMTsKIAog
CS8qIEZpbGwgaW4gZGVmYXVsdCBjcnRjIHRpbWluZ3MsIGFsbG93IGVuY29kZXJzIHRvIG92ZXJ3
cml0ZSB0aGVtLiAqLwotCWRybV9tb2RlX3NldF9jcnRjaW5mbygmcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZSwKKwlkcm1fbW9kZV9zZXRfY3J0Y2luZm8oJnBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLAogCQkJICAgICAgQ1JUQ19TVEVSRU9fRE9VQkxFKTsKIAogCS8qIFNldCB0
aGUgY3J0Y19zdGF0ZSBkZWZhdWx0cyBmb3IgdHJhbnNfcG9ydF9zeW5jICovCkBAIC0xMjcxNSw3
ICsxMjcxNSw3IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKnBpcGVfY29uZmlnKQogCS8qIFNldCBkZWZhdWx0IHBvcnQgY2xvY2sgaWYgbm90IG92
ZXJ3cml0dGVuIGJ5IHRoZSBlbmNvZGVyLiBOZWVkcyB0byBiZQogCSAqIGRvbmUgYWZ0ZXJ3YXJk
cyBpbiBjYXNlIHRoZSBlbmNvZGVyIGFkanVzdHMgdGhlIG1vZGUuICovCiAJaWYgKCFwaXBlX2Nv
bmZpZy0+cG9ydF9jbG9jaykKLQkJcGlwZV9jb25maWctPnBvcnRfY2xvY2sgPSBwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sKKwkJcGlwZV9jb25maWctPnBvcnRfY2xv
Y2sgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrCiAJCQkqIHBpcGVf
Y29uZmlnLT5waXhlbF9tdWx0aXBsaWVyOwogCiAJcmV0ID0gaW50ZWxfY3J0Y19jb21wdXRlX2Nv
bmZpZyh0b19pbnRlbF9jcnRjKGNydGMpLCBwaXBlX2NvbmZpZyk7CkBAIC0xMjg4Nyw4ICsxMjg4
Nyw4IEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmN1cnJlbnRfY29uZmlnLAogCWJvb2wgcmV0ID0gdHJ1ZTsKIAl1MzIgYnBfZ2FtbWEg
PSAwOwogCWJvb2wgZml4dXBfaW5oZXJpdGVkID0gZmFzdHNldCAmJgotCQkoY3VycmVudF9jb25m
aWctPmJhc2UubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKSAm
JgotCQkhKHBpcGVfY29uZmlnLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9G
TEFHX0lOSEVSSVRFRCk7CisJCShjdXJyZW50X2NvbmZpZy0+aHcubW9kZS5wcml2YXRlX2ZsYWdz
ICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKSAmJgorCQkhKHBpcGVfY29uZmlnLT5ody5tb2Rl
LnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklURUQpOwogCiAJaWYgKGZpeHVw
X2luaGVyaXRlZCAmJiAhZmFzdGJvb3RfZW5hYmxlZChkZXZfcHJpdikpIHsKIAkJRFJNX0RFQlVH
X0tNUygiaW5pdGlhbCBtb2Rlc2V0IGFuZCBmYXN0Ym9vdCBub3Qgc2V0XG4iKTsKQEAgLTEzMjM0
LDcgKzEzMjM0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcGlwZV9jb25maWdfc2FuaXR5X2NoZWNr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAocGlwZV9jb25maWctPmhh
c19wY2hfZW5jb2RlcikgewogCQlpbnQgZmRpX2RvdGNsb2NrID0gaW50ZWxfZG90Y2xvY2tfY2Fs
Y3VsYXRlKGludGVsX2ZkaV9saW5rX2ZyZXEoZGV2X3ByaXYsIHBpcGVfY29uZmlnKSwKIAkJCQkJ
CQkgICAgJnBpcGVfY29uZmlnLT5mZGlfbV9uKTsKLQkJaW50IGRvdGNsb2NrID0gcGlwZV9jb25m
aWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCQlpbnQgZG90Y2xvY2sgPSBwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCiAJCS8qCiAJCSAqIEZESSBh
bHJlYWR5IHByb3ZpZGVkIG9uZSBpZGVhIGZvciB0aGUgZG90Y2xvY2suCkBAIC0xMzI2Miw3ICsx
MzI2Miw3IEBAIHN0YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAljb25zdCBlbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJaW50IHBsYW5lLCBs
ZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9sZXZlbChkZXZfcHJpdik7CiAKLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA8IDkgfHwgIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkgfHwgIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUp
CiAJCXJldHVybjsKIAogCWh3ID0ga3phbGxvYyhzaXplb2YoKmh3KSwgR0ZQX0tFUk5FTCk7CkBA
IC0xMzQ4NCwyMyArMTM0ODQsMjYgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAKIAkvKiB3ZSBrZWVwIGJvdGggcGlwZXMgZW5hYmxlZCBvbiA4MzAgKi8KIAlp
ZiAoSVNfSTgzMChkZXZfcHJpdikpCi0JCWFjdGl2ZSA9IG5ld19jcnRjX3N0YXRlLT5iYXNlLmFj
dGl2ZTsKKwkJYWN0aXZlID0gbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZTsKIAotCUk5MTVfU1RB
VEVfV0FSTihuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgIT0gYWN0aXZlLAotCSAgICAgImNy
dGMgYWN0aXZlIHN0YXRlIGRvZXNuJ3QgbWF0Y2ggd2l0aCBodyBzdGF0ZSAiCi0JICAgICAiKGV4
cGVjdGVkICVpLCBmb3VuZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgYWN0
aXZlKTsKKwlJOTE1X1NUQVRFX1dBUk4obmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAhPSBhY3Rp
dmUsCisJCQkiY3J0YyBhY3RpdmUgc3RhdGUgZG9lc24ndCBtYXRjaCB3aXRoIGh3IHN0YXRlICIK
KwkJCSIoZXhwZWN0ZWQgJWksIGZvdW5kICVpKVxuIiwKKwkJCW5ld19jcnRjX3N0YXRlLT5ody5h
Y3RpdmUsIGFjdGl2ZSk7CiAKLQlJOTE1X1NUQVRFX1dBUk4oY3J0Yy0+YWN0aXZlICE9IG5ld19j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwKLQkgICAgICJ0cmFuc2l0aW9uYWwgYWN0aXZlIHN0YXRl
IGRvZXMgbm90IG1hdGNoIGF0b21pYyBodyBzdGF0ZSAiCi0JICAgICAiKGV4cGVjdGVkICVpLCBm
b3VuZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgY3J0Yy0+YWN0aXZlKTsK
KwlJOTE1X1NUQVRFX1dBUk4oY3J0Yy0+YWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5ody5hY3Rp
dmUsCisJCQkidHJhbnNpdGlvbmFsIGFjdGl2ZSBzdGF0ZSBkb2VzIG5vdCBtYXRjaCBhdG9taWMg
aHcgc3RhdGUgIgorCQkJIihleHBlY3RlZCAlaSwgZm91bmQgJWkpXG4iLAorCQkJbmV3X2NydGNf
c3RhdGUtPmh3LmFjdGl2ZSwgY3J0Yy0+YWN0aXZlKTsKIAogCWZvcl9lYWNoX2VuY29kZXJfb25f
Y3J0YyhkZXYsICZjcnRjLT5iYXNlLCBlbmNvZGVyKSB7CiAJCWVudW0gcGlwZSBwaXBlOwogCiAJ
CWFjdGl2ZSA9IGVuY29kZXItPmdldF9od19zdGF0ZShlbmNvZGVyLCAmcGlwZSk7Ci0JCUk5MTVf
U1RBVEVfV0FSTihhY3RpdmUgIT0gbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlLAotCQkJIltF
TkNPREVSOiVpXSBhY3RpdmUgJWkgd2l0aCBjcnRjIGFjdGl2ZSAlaVxuIiwKLQkJCWVuY29kZXIt
PmJhc2UuYmFzZS5pZCwgYWN0aXZlLCBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpOworCQlJ
OTE1X1NUQVRFX1dBUk4oYWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUsCisJCQkJ
IltFTkNPREVSOiVpXSBhY3RpdmUgJWkgd2l0aCBjcnRjIGFjdGl2ZSAlaVxuIiwKKwkJCQllbmNv
ZGVyLT5iYXNlLmJhc2UuaWQsIGFjdGl2ZSwKKwkJCQluZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
KTsKIAogCQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICYmIGNydGMtPnBpcGUgIT0gcGlwZSwKIAkJ
CQkiRW5jb2RlciBjb25uZWN0ZWQgdG8gd3JvbmcgcGlwZSAlY1xuIiwKQEAgLTEzNTEyLDcgKzEz
NTE1LDcgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAlp
bnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShwaXBlX2NvbmZpZyk7CiAKLQlpZiAoIW5ld19j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUp
CiAJCXJldHVybjsKIAogCWludGVsX3BpcGVfY29uZmlnX3Nhbml0eV9jaGVjayhkZXZfcHJpdiwg
cGlwZV9jb25maWcpOwpAQCAtMTM1NzQsNyArMTM1NzcsNyBAQCB2ZXJpZnlfc2luZ2xlX2RwbGxf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJY3J0Y19tYXNrID0g
ZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CiAKLQlpZiAobmV3X2NydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlKQorCWlmIChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlJOTE1X1NUQVRFX1dB
Uk4oIShwbGwtPmFjdGl2ZV9tYXNrICYgY3J0Y19tYXNrKSwKIAkJCQkicGxsIGFjdGl2ZSBtaXNt
YXRjaCAoZXhwZWN0ZWQgcGlwZSAlYyBpbiBhY3RpdmUgbWFzayAweCUwMngpXG4iLAogCQkJCXBp
cGVfbmFtZShkcm1fY3J0Y19pbmRleCgmY3J0Yy0+YmFzZSkpLCBwbGwtPmFjdGl2ZV9tYXNrKTsK
QEAgLTEzNjU2LDcgKzEzNjU5LDcgQEAgaW50ZWxfY3J0Y191cGRhdGVfYWN0aXZlX3RpbWluZ3Mo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0
Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAogCWRybV9jYWxjX3RpbWVzdGFtcGluZ19jb25zdGFudHMoJmNydGMtPmJhc2UsIGFk
anVzdGVkX21vZGUpOwogCkBAIC0xMzczOCw3ICsxMzc0MSw3IEBAIHN0YXRpYyBpbnQgaGFzd2Vs
bF9tb2RlX3NldF9wbGFuZXNfd29ya2Fyb3VuZChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAogCS8qIGxvb2sgYXQgYWxsIGNydGMncyB0aGF0IGFyZSBnb2luZyB0byBiZSBlbmFi
bGVkIGluIGR1cmluZyBtb2Rlc2V0ICovCiAJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3Rh
dGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsKLQkJaWYgKCFjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSB8fAorCQlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fAogCQkgICAgIW5lZWRz
X21vZGVzZXQoY3J0Y19zdGF0ZSkpCiAJCQljb250aW51ZTsKIApAQCAtMTM3NjMsNyArMTM3NjYs
NyBAQCBzdGF0aWMgaW50IGhhc3dlbGxfbW9kZV9zZXRfcGxhbmVzX3dvcmthcm91bmQoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAkJY3J0Y19zdGF0ZS0+aHN3X3dvcmthcm91
bmRfcGlwZSA9IElOVkFMSURfUElQRTsKIAotCQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZl
IHx8CisJCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlIHx8CiAJCSAgICBuZWVkc19tb2Rlc2V0
KGNydGNfc3RhdGUpKQogCQkJY29udGludWU7CiAKQEAgLTEzODAwLDEyICsxMzgwMywxMiBAQCBz
dGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNy
dGMsIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaWYg
KG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkJaWYgKG5ld19jcnRjX3N0YXRlLT5ody5h
Y3RpdmUpCiAJCQlzdGF0ZS0+YWN0aXZlX3BpcGVzIHw9IEJJVChjcnRjLT5waXBlKTsKIAkJZWxz
ZQogCQkJc3RhdGUtPmFjdGl2ZV9waXBlcyAmPSB+QklUKGNydGMtPnBpcGUpOwogCi0JCWlmIChv
bGRfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgIT0gbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZl
KQorCQlpZiAob2xkX2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAhPSBuZXdfY3J0Y19zdGF0ZS0+aHcu
YWN0aXZlKQogCQkJc3RhdGUtPmFjdGl2ZV9waXBlX2NoYW5nZXMgfD0gQklUKGNydGMtPnBpcGUp
OwogCX0KIApAQCAtMTM5OTMsOCArMTM5OTYsOCBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19j
aGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCS8qIENhdGNoIEk5MTVfTU9ERV9GTEFHX0lO
SEVSSVRFRCAqLwogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBj
cnRjLCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0YXRlLCBpKSB7Ci0JCWlm
IChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5tb2RlLnByaXZhdGVfZmxhZ3MgIT0KLQkJICAgIG9sZF9j
cnRjX3N0YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncykKKwkJaWYgKG5ld19jcnRjX3N0YXRl
LT5ody5tb2RlLnByaXZhdGVfZmxhZ3MgIT0KKwkJICAgIG9sZF9jcnRjX3N0YXRlLT5ody5tb2Rl
LnByaXZhdGVfZmxhZ3MpCiAJCQluZXdfY3J0Y19zdGF0ZS0+YmFzZS5tb2RlX2NoYW5nZWQgPSB0
cnVlOwogCX0KIApAQCAtMTQyMzMsNyArMTQyMzYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF91cGRh
dGVfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkgKiBvZiBlbmFibGluZyB0aGVtIG9u
IHRoZSBDUlRDJ3MgZmlyc3QgZmFzdHNldC4KIAkgKi8KIAlpZiAobmV3X2NydGNfc3RhdGUtPnVw
ZGF0ZV9waXBlICYmICFtb2Rlc2V0ICYmCi0JICAgIG9sZF9jcnRjX3N0YXRlLT5iYXNlLm1vZGUu
cHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkKKwkgICAgb2xkX2NydGNf
c3RhdGUtPmh3Lm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkK
IAkJaW50ZWxfY3J0Y19hcm1fZmlmb191bmRlcnJ1bihjcnRjLCBuZXdfY3J0Y19zdGF0ZSk7CiB9
CiAKQEAgLTE0Mjc3LDcgKzE0MjgwLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfb2xkX2NydGNfc3Rh
dGVfZGlzYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJaW50ZWxfY2hl
Y2tfcGNoX2ZpZm9fdW5kZXJydW5zKGRldl9wcml2KTsKIAogCS8qIEZJWE1FIHVuaWZ5IHRoaXMg
Zm9yIGFsbCBwbGF0Zm9ybXMgKi8KLQlpZiAoIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAm
JgorCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJgogCSAgICAhSEFTX0dNQ0goZGV2
X3ByaXYpICYmCiAJICAgIGRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcykKIAkJ
ZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKHN0YXRlLApAQCAtMTQzMDAsNyAr
MTQzMDMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF90cmFuc19wb3J0X3N5bmNfbW9kZXNldF9kaXNh
YmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdAogCiAJLyogRGlzYWJsZSBTbGF2ZSBm
aXJzdCAqLwogCWludGVsX3ByZV9wbGFuZV91cGRhdGUob2xkX3NsYXZlX2NydGNfc3RhdGUsIG5l
d19zbGF2ZV9jcnRjX3N0YXRlKTsKLQlpZiAob2xkX3NsYXZlX2NydGNfc3RhdGUtPmJhc2UuYWN0
aXZlKQorCWlmIChvbGRfc2xhdmVfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlpbnRlbF9vbGRf
Y3J0Y19zdGF0ZV9kaXNhYmxlcyhzdGF0ZSwKIAkJCQkJICAgICAgb2xkX3NsYXZlX2NydGNfc3Rh
dGUsCiAJCQkJCSAgICAgIG5ld19zbGF2ZV9jcnRjX3N0YXRlLApAQCAtMTQzMDgsNyArMTQzMTEs
NyBAQCBzdGF0aWMgdm9pZCBpbnRlbF90cmFuc19wb3J0X3N5bmNfbW9kZXNldF9kaXNhYmxlcyhz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdAogCiAJLyogRGlzYWJsZSBNYXN0ZXIgKi8KIAlp
bnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSk7Ci0J
aWYgKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAob2xkX2NydGNfc3RhdGUtPmh3
LmFjdGl2ZSkKIAkJaW50ZWxfb2xkX2NydGNfc3RhdGVfZGlzYWJsZXMoc3RhdGUsCiAJCQkJCSAg
ICAgIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgICBuZXdfY3J0Y19zdGF0ZSwKQEAgLTE0MzQ5
LDcgKzE0MzUyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCX0gZWxzZSB7CiAJCQlpbnRlbF9w
cmVfcGxhbmVfdXBkYXRlKG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSk7CiAKLQkJCWlm
IChvbGRfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCQlpZiAob2xkX2NydGNfc3RhdGUtPmh3
LmFjdGl2ZSkKIAkJCQlpbnRlbF9vbGRfY3J0Y19zdGF0ZV9kaXNhYmxlcyhzdGF0ZSwKIAkJCQkJ
CQkgICAgICBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJCQkgICAgICBuZXdfY3J0Y19zdGF0ZSwKQEAg
LTE0MzY1LDcgKzE0MzY4LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZW5h
YmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlpbnQgaTsKIAogCWZvcl9l
YWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0
ZSwgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3Rp
dmUpCisJCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCWNvbnRpbnVlOwogCiAJ
CWludGVsX3VwZGF0ZV9jcnRjKGNydGMsIHN0YXRlLCBvbGRfY3J0Y19zdGF0ZSwKQEAgLTE0NDMw
LDcgKzE0NDMzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9zdF9jcnRjX2VuYWJsZV91cGRhdGVz
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCSAqIG9mIGVuYWJsaW5nIHRoZW0gb24gdGhlIENS
VEMncyBmaXJzdCBmYXN0c2V0LgogCSAqLwogCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3Bp
cGUgJiYgIW1vZGVzZXQgJiYKLQkgICAgb2xkX2NydGNfc3RhdGUtPmJhc2UubW9kZS5wcml2YXRl
X2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKQorCSAgICBvbGRfY3J0Y19zdGF0ZS0+
aHcubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKQogCQlpbnRl
bF9jcnRjX2FybV9maWZvX3VuZGVycnVuKGNydGMsIG5ld19jcnRjX3N0YXRlKTsKIH0KIApAQCAt
MTQ0OTQsNyArMTQ0OTcsNyBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxl
cyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAogCWZvcl9lYWNoX29sZG5ld19p
bnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNf
c3RhdGUsIGkpCiAJCS8qIGlnbm9yZSBhbGxvY2F0aW9ucyBmb3IgY3J0YydzIHRoYXQgaGF2ZSBi
ZWVuIHR1cm5lZCBvZmYuICovCi0JCWlmIChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJ
CWlmIChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJZW50cmllc1tpXSA9IG9sZF9jcnRj
X3N0YXRlLT53bS5za2wuZGRiOwogCiAJLyogSWYgMm5kIERCdWYgc2xpY2UgcmVxdWlyZWQsIGVu
YWJsZSBpdCBoZXJlICovCkBAIC0xNDUxNSw3ICsxNDUxOCw3IEBAIHN0YXRpYyB2b2lkIHNrbF9j
b21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQog
CQkJYm9vbCB2Ymxfd2FpdCA9IGZhbHNlOwogCQkJYm9vbCBtb2Rlc2V0ID0gbmVlZHNfbW9kZXNl
dChuZXdfY3J0Y19zdGF0ZSk7CiAKLQkJCWlmICh1cGRhdGVkICYgQklUKGNydGMtPnBpcGUpIHx8
ICFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCQlpZiAodXBkYXRlZCAmIEJJVChjcnRj
LT5waXBlKSB8fCAhbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCQljb250aW51ZTsKIAog
CQkJaWYgKHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcygmbmV3X2NydGNfc3RhdGUtPndtLnNr
bC5kZGIsCkBAIC0xNDY3Nyw3ICsxNDY4MCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19j
b21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJYm9vbCBtb2Rl
c2V0ID0gbmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSk7CiAKIAkJLyogQ29tcGxldGUgZXZl
bnRzIGZvciBub3cgZGlzYWJsZSBwaXBlcyBoZXJlLiAqLwotCQlpZiAobW9kZXNldCAmJiAhbmV3
X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlICYmIG5ld19jcnRjX3N0YXRlLT5iYXNlLmV2ZW50KSB7
CisJCWlmIChtb2Rlc2V0ICYmICFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlICYmIG5ld19jcnRj
X3N0YXRlLT5iYXNlLmV2ZW50KSB7CiAJCQlzcGluX2xvY2tfaXJxKCZkZXYtPmV2ZW50X2xvY2sp
OwogCQkJZHJtX2NydGNfc2VuZF92YmxhbmtfZXZlbnQoJmNydGMtPmJhc2UsIG5ld19jcnRjX3N0
YXRlLT5iYXNlLmV2ZW50KTsKIAkJCXNwaW5fdW5sb2NrX2lycSgmZGV2LT5ldmVudF9sb2NrKTsK
QEAgLTE0NzEzLDcgKzE0NzE2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90
YWlsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWRybV9hdG9taWNfaGVscGVy
X3dhaXRfZm9yX2ZsaXBfZG9uZShkZXYsICZzdGF0ZS0+YmFzZSk7CiAKIAlmb3JfZWFjaF9uZXdf
aW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJ
aWYgKG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCQlpZiAobmV3X2NydGNfc3RhdGUt
Pmh3LmFjdGl2ZSAmJgogCQkgICAgIW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpICYmCiAJ
CSAgICAobmV3X2NydGNfc3RhdGUtPmJhc2UuY29sb3JfbWdtdF9jaGFuZ2VkIHx8CiAJCSAgICAg
bmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9waXBlKSkKQEAgLTE1MjgwLDcgKzE1MjgzLDcgQEAgaW50
ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCSAqIFdo
ZW4gY3J0YyBpcyBpbmFjdGl2ZSBvciB0aGVyZSBpcyBhIG1vZGVzZXQgcGVuZGluZywKIAkgKiB3
YWl0IGZvciBpdCB0byBjb21wbGV0ZSBpbiB0aGUgc2xvd3BhdGgKIAkgKi8KLQlpZiAoIWNydGNf
c3RhdGUtPmJhc2UuYWN0aXZlIHx8IG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSkgfHwKKwlpZiAo
IWNydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fCBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpIHx8CiAJ
ICAgIGNydGNfc3RhdGUtPnVwZGF0ZV9waXBlKQogCQlnb3RvIHNsb3c7CiAKQEAgLTE2NzM3LDcg
KzE2NzQwLDcgQEAgc3RhdGljIGludCBpbnRlbF9pbml0aWFsX2NvbW1pdChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2KQogCQkJZ290byBvdXQ7CiAJCX0KIAotCQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5h
Y3RpdmUpIHsKKwkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQkJcmV0ID0gZHJtX2F0
b21pY19hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0YXRlLCAmY3J0Yy0+YmFzZSk7CiAJCQlpZiAocmV0
KQogCQkJCWdvdG8gb3V0OwpAQCAtMTcwODcsNyArMTcwOTAsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9zYW5pdGl6ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgSTkxNV9SRUFE
KHJlZykgJiB+UElQRUNPTkZfRlJBTUVfU1RBUlRfREVMQVlfTUFTSyk7CiAJfQogCi0JaWYgKGNy
dGNfc3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewog
CQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCiAJCS8qIERpc2FibGUgZXZlcnl0aGluZyBi
dXQgdGhlIHByaW1hcnkgcGxhbmUgKi8KQEAgLTE3MTEyLDEwICsxNzExNSwxMCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9zYW5pdGl6ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJLyog
QWRqdXN0IHRoZSBzdGF0ZSBvZiB0aGUgb3V0cHV0IHBpcGUgYWNjb3JkaW5nIHRvIHdoZXRoZXIg
d2UKIAkgKiBoYXZlIGFjdGl2ZSBjb25uZWN0b3JzL2VuY29kZXJzLiAqLwotCWlmIChjcnRjX3N0
YXRlLT5iYXNlLmFjdGl2ZSAmJiAhaW50ZWxfY3J0Y19oYXNfZW5jb2RlcnMoY3J0YykpCisJaWYg
KGNydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJiAhaW50ZWxfY3J0Y19oYXNfZW5jb2RlcnMoY3J0Yykp
CiAJCWludGVsX2NydGNfZGlzYWJsZV9ub2F0b21pYygmY3J0Yy0+YmFzZSwgY3R4KTsKIAotCWlm
IChjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSB8fCBIQVNfR01DSChkZXZfcHJpdikpIHsKKwlpZiAo
Y3J0Y19zdGF0ZS0+aHcuYWN0aXZlIHx8IEhBU19HTUNIKGRldl9wcml2KSkgewogCQkvKgogCQkg
KiBXZSBzdGFydCBvdXQgd2l0aCB1bmRlcnJ1biByZXBvcnRpbmcgZGlzYWJsZWQgdG8gYXZvaWQg
cmFjZXMuCiAJCSAqIEZvciBjb3JyZWN0IGJvb2trZWVwaW5nIG1hcmsgdGhpcyBvbiBhY3RpdmUg
Y3J0Y3MuCkBAIC0xNzE1OSw3ICsxNzE2Miw3IEBAIHN0YXRpYyBib29sIGhhc19ib2d1c19kcGxs
X2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKiBy
b2FkLgogCSAqLwogCXJldHVybiBJU19HRU4oZGV2X3ByaXYsIDYpICYmCi0JCWNydGNfc3RhdGUt
PmJhc2UuYWN0aXZlICYmCisJCWNydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJgogCQljcnRjX3N0YXRl
LT5zaGFyZWRfZHBsbCAmJgogCQljcnRjX3N0YXRlLT5wb3J0X2Nsb2NrID09IDA7CiB9CkBAIC0x
NzE3Niw3ICsxNzE3OSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nhbml0aXplX2VuY29kZXIoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJICogZW5jb2RlciBpcyBhY3RpdmUgYW5kIHRy
eWluZyB0byByZWFkIGZyb20gYSBwaXBlKSBhbmQgdGhlCiAJICogcGlwZSBpdHNlbGYgYmVpbmcg
YWN0aXZlLiAqLwogCWJvb2wgaGFzX2FjdGl2ZV9jcnRjID0gY3J0Y19zdGF0ZSAmJgotCQljcnRj
X3N0YXRlLT5iYXNlLmFjdGl2ZTsKKwkJY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwogCiAJaWYgKGNy
dGNfc3RhdGUgJiYgaGFzX2JvZ3VzX2RwbGxfY29uZmlnKGNydGNfc3RhdGUpKSB7CiAJCURSTV9E
RUJVR19LTVMoIkJJT1MgaGFzIG1pc3Byb2dyYW1tZWQgdGhlIGhhcmR3YXJlLiBEaXNhYmxpbmcg
cGlwZSAlY1xuIiwKQEAgLTE3Mjg0LDE4ICsxNzI4NywxOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9t
b2Rlc2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJbWVtc2V0
KGNydGNfc3RhdGUsIDAsIHNpemVvZigqY3J0Y19zdGF0ZSkpOwogCQlfX2RybV9hdG9taWNfaGVs
cGVyX2NydGNfcmVzZXQoJmNydGMtPmJhc2UsICZjcnRjX3N0YXRlLT5iYXNlKTsKIAotCQljcnRj
X3N0YXRlLT5iYXNlLmFjdGl2ZSA9IGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlID0KKwkJY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlID0gY3J0Y19zdGF0ZS0+aHcuZW5hYmxlID0KIAkJCWRldl9wcml2LT5k
aXNwbGF5LmdldF9waXBlX2NvbmZpZyhjcnRjLCBjcnRjX3N0YXRlKTsKIAotCQljcnRjLT5iYXNl
LmVuYWJsZWQgPSBjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZTsKLQkJY3J0Yy0+YWN0aXZlID0gY3J0
Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJCWNydGMtPmJhc2UuZW5hYmxlZCA9IGNydGNfc3RhdGUt
Pmh3LmVuYWJsZTsKKwkJY3J0Yy0+YWN0aXZlID0gY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwogCi0J
CWlmIChjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2
ZSkKIAkJCWRldl9wcml2LT5hY3RpdmVfcGlwZXMgfD0gQklUKGNydGMtPnBpcGUpOwogCiAJCURS
TV9ERUJVR19LTVMoIltDUlRDOiVkOiVzXSBodyBzdGF0ZSByZWFkb3V0OiAlc1xuIiwKIAkJCSAg
ICAgIGNydGMtPmJhc2UuYmFzZS5pZCwgY3J0Yy0+YmFzZS5uYW1lLAotCQkJICAgICAgZW5hYmxl
ZGRpc2FibGVkKGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKSk7CisJCQkgICAgICBlbmFibGVkZGlz
YWJsZWQoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSk7CiAJfQogCiAJcmVhZG91dF9wbGFuZV9zdGF0
ZShkZXZfcHJpdik7CkBAIC0xNzMxNyw3ICsxNzMyMCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX21v
ZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQkJc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQogCQkJCXRvX2ludGVsX2NydGNfc3RhdGUo
Y3J0Yy0+YmFzZS5zdGF0ZSk7CiAKLQkJCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgor
CQkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJgogCQkJICAgIGNydGNfc3RhdGUtPnNoYXJl
ZF9kcGxsID09IHBsbCkKIAkJCQlwbGwtPnN0YXRlLmNydGNfbWFzayB8PSAxIDw8IGNydGMtPnBp
cGU7CiAJCX0KQEAgLTE3MzYyLDcgKzE3MzY1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNl
dF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCQljcnRjID0gdG9f
aW50ZWxfY3J0YyhlbmNvZGVyLT5iYXNlLmNydGMpOwogCQkJY3J0Y19zdGF0ZSA9IGNydGMgPyB0
b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpIDogTlVMTDsKIAotCQkJaWYgKGNy
dGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpIHsKKwkJCWlmIChjcnRjX3N0YXRl
ICYmIGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQkJCS8qCiAJCQkJICogVGhpcyBoYXMgdG8g
YmUgZG9uZSBkdXJpbmcgaGFyZHdhcmUgcmVhZG91dAogCQkJCSAqIGJlY2F1c2UgYW55dGhpbmcg
Y2FsbGluZyAuY3J0Y19kaXNhYmxlIG1heQpAQCAtMTczOTEsMTMgKzE3Mzk0LDEzIEBAIHN0YXRp
YyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2KQogCQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCQlpbnQgbWluX2NkY2xrID0gMDsK
IAotCQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpIHsKKwkJaWYgKGNydGNfc3RhdGUtPmh3
LmFjdGl2ZSkgewogCQkJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgbW9kZTsKIAotCQkJaW50ZWxf
bW9kZV9mcm9tX3BpcGVfY29uZmlnKCZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUsCisJ
CQlpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25maWcoJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGUsCiAJCQkJCQkgICAgY3J0Y19zdGF0ZSk7CiAKLQkJCW1vZGUgPSBjcnRjX3N0YXRlLT5iYXNl
LmFkanVzdGVkX21vZGU7CisJCQltb2RlID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsK
IAkJCW1vZGUuaGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY193OwogCQkJbW9kZS52ZGlz
cGxheSA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX2g7CiAJCQlXQVJOX09OKGRybV9hdG9taWNfc2V0
X21vZGVfZm9yX2NydGMoJmNydGNfc3RhdGUtPmJhc2UsICZtb2RlKSk7CkBAIC0xNzQxMSw3ICsx
NzQxNCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2KQogCQkJICogc2V0IGEgZmxhZyB0byBpbmRpY2F0ZSB0aGF0IGEg
ZnVsbCByZWNhbGN1bGF0aW9uIGlzCiAJCQkgKiBuZWVkZWQgb24gdGhlIG5leHQgY29tbWl0Lgog
CQkJICovCi0JCQljcnRjX3N0YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncyA9IEk5MTVfTU9E
RV9GTEFHX0lOSEVSSVRFRDsKKwkJCWNydGNfc3RhdGUtPmh3Lm1vZGUucHJpdmF0ZV9mbGFncyA9
IEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRDsKIAogCQkJaW50ZWxfY3J0Y19jb21wdXRlX3BpeGVs
X3JhdGUoY3J0Y19zdGF0ZSk7CiAKQEAgLTE3NDQ3LDcgKzE3NDUwLDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJ
CQkJICAgICAgY3J0Y19zdGF0ZS0+bWluX2NkY2xrW3BsYW5lLT5pZF0pOwogCQl9CiAKLQkJaWYg
KGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJCWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUp
IHsKIAkJCW1pbl9jZGNsayA9IGludGVsX2NydGNfY29tcHV0ZV9taW5fY2RjbGsoY3J0Y19zdGF0
ZSk7CiAJCQlpZiAoV0FSTl9PTihtaW5fY2RjbGsgPCAwKSkKIAkJCQltaW5fY2RjbGsgPSAwOwpA
QCAtMTc2MDcsNyArMTc2MTAsNyBAQCBpbnRlbF9tb2Rlc2V0X3NldHVwX2h3X3N0YXRlKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsCiAKIAkJZHJtX2NydGNfdmJsYW5rX3Jlc2V0KCZjcnRjLT5iYXNl
KTsKIAotCQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCWlmIChjcnRjX3N0YXRlLT5o
dy5hY3RpdmUpCiAJCQlpbnRlbF9jcnRjX3ZibGFua19vbihjcnRjX3N0YXRlKTsKIAl9CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwppbmRleCAxYjk4NjA3YzdiMmUuLjA1
NzU5Nzg1YWU5YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAt
MTk5NSw3ICsxOTk1LDcgQEAgaW50ZWxfZHBfY29tcHV0ZV9saW5rX2NvbmZpZ193aWRlKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcsCiAJCQkJICBjb25zdCBzdHJ1Y3QgbGlua19jb25maWdfbGltaXRzICpsaW1pdHMp
CiB7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25m
aWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0
ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgYnBwLCBjbG9j
aywgbGFuZV9jb3VudDsKIAlpbnQgbW9kZV9yYXRlLCBsaW5rX2Nsb2NrLCBsaW5rX2F2YWlsOwog
CkBAIC0yMDQ5LDcgKzIwNDksNyBAQCBzdGF0aWMgaW50IGludGVsX2RwX2RzY19jb21wdXRlX2Nv
bmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFs
X3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYp
OwotCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmln
LT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVk
X21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJdTggZHNjX21heF9icGM7
CiAJaW50IHBpcGVfYnBwOwogCWludCByZXQ7CkBAIC0yMTYwLDcgKzIxNjAsNyBAQCBpbnRlbF9k
cF9jb21wdXRlX2xpbmtfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJ
ICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgIHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7
CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGU7CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19p
bnRlbF9kcCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGxpbmtfY29uZmlnX2xpbWl0cyBsaW1p
dHM7CiAJaW50IGNvbW1vbl9sZW47CkBAIC0yMjQ4LDcgKzIyNDgsNyBAQCBpbnRlbF9kcF95Y2Jj
cjQyMF9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIHsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfaW5mbyAqaW5mbyA9ICZjb25uZWN0b3ItPmRpc3BsYXlfaW5mbzsKIAljb25z
dCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRl
LT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwog
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNl
LmNydGMpOwogCWludCByZXQ7CiAKQEAgLTIyNzcsNyArMjI3Nyw3IEBAIGJvb2wgaW50ZWxfZHBf
bGltaXRlZF9jb2xvcl9yYW5nZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAljb25zdCBzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmludGVs
X2Nvbm5fc3RhdGUgPQogCQl0b19pbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0
YXRlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0J
CSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlOwogCiAJLyoKIAkgKiBPdXIgWUNiQ3Igb3V0cHV0IGlzIGFsd2F5cyBsaW1pdGVk
IHJhbmdlLgpAQCAtMjMxMCw3ICsyMzEwLDcgQEAgaW50ZWxfZHBfY29tcHV0ZV9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0
ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoJmVu
Y29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9sc3Bjb24gKmxzcGNvbiA9IGVuY190b19pbnRl
bF9sc3Bjb24oJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9y
dDsKQEAgLTI0MzMsNyArMjQzMyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX3ByZXBhcmUoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9
IGVuY190b19pbnRlbF9kcCgmZW5jb2Rlci0+YmFzZSk7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNv
ZGVyLT5wb3J0OwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBl
X2NvbmZpZy0+YmFzZS5jcnRjKTsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlOwogCiAJaW50ZWxfZHBfc2V0X2xpbmtfcGFyYW1zKGludGVsX2RwLCBwaXBl
X2NvbmZpZy0+cG9ydF9jbG9jaywKIAkJCQkgcGlwZV9jb25maWctPmxhbmVfY291bnQsCkBAIC0z
MjY1LDcgKzMyNjUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9nZXRfY29uZmlnKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OVlNZTkM7
CiAJfQogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsK
KwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKIAogCWlmIChJ
U19HNFgoZGV2X3ByaXYpICYmIHRtcCAmIERQX0NPTE9SX1JBTkdFXzE2XzIzNSkKIAkJcGlwZV9j
b25maWctPmxpbWl0ZWRfY29sb3JfcmFuZ2UgPSB0cnVlOwpAQCAtMzI4Miw3ICszMjgyLDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZHBfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJCXBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrID0gMjcwMDAwOwogCX0KIAotCXBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9CisJcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9CiAJCWludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShw
aXBlX2NvbmZpZy0+cG9ydF9jbG9jaywKIAkJCQkJICZwaXBlX2NvbmZpZy0+ZHBfbV9uKTsKIApA
QCAtNTA3NSw3ICs1MDc1LDcgQEAgaW50IGludGVsX2RwX3JldHJhaW5fbGluayhzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCVdBUk5fT04oIWludGVsX2NydGNfaGFzX2RwX2VuY29k
ZXIoY3J0Y19zdGF0ZSkpOwogCi0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAo
IWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoY29ubl9zdGF0ZS0+
Y29tbWl0ICYmCkBAIC02OTQzLDcgKzY5NDMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9zZXRf
ZHJyc19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsK
IAl9CiAKLQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJaWYgKCFjcnRjX3N0YXRl
LT5ody5hY3RpdmUpIHsKIAkJRFJNX0RFQlVHX0tNUygiZURQIGVuY29kZXIgZGlzYWJsZWQuIENS
VEMgbm90IEFjdGl2ZVxuIik7CiAJCXJldHVybjsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcF9tc3QuYwppbmRleCA0MmQyNjIxNGZiMjMuLjMwNzAyOTIwODc1ZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5jCkBAIC00OCw3
ICs0OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfbGlua19jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29u
bmVjdG9yID0KIAkJdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CiAJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19z
dGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9k
ZTsKIAl2b2lkICpwb3J0ID0gY29ubmVjdG9yLT5wb3J0OwogCWJvb2wgY29uc3RhbnRfbiA9IGRy
bV9kcF9oYXNfcXVpcmsoJmludGVsX2RwLT5kZXNjLAogCQkJCQkgICBEUF9EUENEX1FVSVJLX0NP
TlNUQU5UX04pOwpAQCAtOTksNyArOTksNyBAQCBzdGF0aWMgaW50IGludGVsX2RwX21zdF9jb21w
dXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxf
ZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQogCQl0b19pbnRlbF9k
aWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3Rl
ZF9tb2RlOworCQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJdm9pZCAqcG9ydCA9
IGNvbm5lY3Rvci0+cG9ydDsKIAlzdHJ1Y3QgbGlua19jb25maWdfbGltaXRzIGxpbWl0czsKIAlp
bnQgcmV0OwpAQCAtMTkxLDcgKzE5MSw3IEBAIGludGVsX2RwX21zdF9hdG9taWNfY2hlY2soc3Ry
dWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAogCQlpZiAoIWNydGNfc3RhdGUgfHwKIAkJ
ICAgICFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+YmFzZSkgfHwK
LQkJICAgIGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCQkgICAgY3J0Y19zdGF0ZS0+aHcuZW5h
YmxlKQogCQkJcmV0dXJuIDA7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2R2by5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kdm8uYwppbmRleCA5ODI3Zjk5NDkxZDEuLmE2OGU1YzViOTFiNCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kdm8uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2R2by5jCkBAIC0xNzgsOSArMTc4LDkgQEAgc3RhdGljIHZv
aWQgaW50ZWxfZHZvX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
ZWxzZQogCQlmbGFncyB8PSBEUk1fTU9ERV9GTEFHX05WU1lOQzsKIAotCXBpcGVfY29uZmlnLT5i
YXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gZmxhZ3M7CisJcGlwZV9jb25maWctPmh3LmFkanVz
dGVkX21vZGUuZmxhZ3MgfD0gZmxhZ3M7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfY2xvY2sgPSBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jazsKKwlwaXBlX2NvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gcGlwZV9jb25maWctPnBvcnRfY2xvY2s7CiB9
CiAKIHN0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVfZHZvKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLApAQCAtMjA3LDggKzIwNyw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9kdm8o
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJdTMyIHRlbXAgPSBJOTE1X1JFQUQoZHZv
X3JlZyk7CiAKIAlpbnRlbF9kdm8tPmRldi5kZXZfb3BzLT5tb2RlX3NldCgmaW50ZWxfZHZvLT5k
ZXYsCi0JCQkJCSAmcGlwZV9jb25maWctPmJhc2UubW9kZSwKLQkJCQkJICZwaXBlX2NvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlKTsKKwkJCQkJICZwaXBlX2NvbmZpZy0+aHcubW9kZSwKKwkJCQkJ
ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZSk7CiAKIAlJOTE1X1dSSVRFKGR2b19yZWcs
IHRlbXAgfCBEVk9fRU5BQkxFKTsKIAlJOTE1X1JFQUQoZHZvX3JlZyk7CkBAIC0yNTMsNyArMjUz
LDcgQEAgc3RhdGljIGludCBpbnRlbF9kdm9fY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2R2byAqaW50ZWxfZHZvID0gZW5jX3RvX2R2
byhlbmNvZGVyKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZml4ZWRfbW9kZSA9
CiAJCWludGVsX2R2by0+YXR0YWNoZWRfY29ubmVjdG9yLT5wYW5lbC5maXhlZF9tb2RlOwotCXN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNl
LmFkanVzdGVkX21vZGU7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAkvKgogCSAqIElmIHdlIGhhdmUg
dGltaW5ncyBmcm9tIHRoZSBCSU9TIGZvciB0aGUgcGFuZWwsIHB1dCB0aGVtIGluCkBAIC0yNzgs
NyArMjc4LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHZvX3ByZV9lbmFibGUoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVz
dGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJc3RydWN0IGludGVsX2R2byAqaW50
ZWxfZHZvID0gZW5jX3RvX2R2byhlbmNvZGVyKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBp
cGU7CiAJdTMyIGR2b192YWw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2ZiYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMu
YwppbmRleCAzMTExZWNhZWFiZDAuLmM2Y2MzNzc1ZjNiOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2ZiYy5jCkBAIC02NjcsNyArNjY3LDcgQEAgc3RhdGljIHZvaWQgaW50
ZWxfZmJjX3VwZGF0ZV9zdGF0ZV9jYWNoZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAljYWNo
ZS0+dm1hID0gTlVMTDsKIAljYWNoZS0+ZmxhZ3MgPSAwOwogCi0JY2FjaGUtPmNydGMubW9kZV9m
bGFncyA9IGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFnczsKKwljYWNoZS0+Y3J0
Yy5tb2RlX2ZsYWdzID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFnczsKIAlpZiAo
SVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKIAkJY2FjaGUt
PmNydGMuaHN3X2Jkd19waXhlbF9yYXRlID0gY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2hkbWkuYwppbmRleCBmZjcxYTRkYTNkMDAu
LjQxMTZkZWQyNDNhNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9oZG1pLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1p
LmMKQEAgLTcwOCw3ICs3MDgsNyBAQCBpbnRlbF9oZG1pX2NvbXB1dGVfYXZpX2luZm9mcmFtZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaGRtaV9hdmlfaW5mb2Zy
YW1lICpmcmFtZSA9ICZjcnRjX3N0YXRlLT5pbmZvZnJhbWVzLmF2aS5hdmk7CiAJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFz
ZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gY29ubl9zdGF0ZS0+Y29ubmVjdG9yOwogCWlu
dCByZXQ7CiAKQEAgLTgwNCw3ICs4MDQsNyBAQCBpbnRlbF9oZG1pX2NvbXB1dGVfaGRtaV9pbmZv
ZnJhbWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlyZXQgPSBkcm1faGRtaV92
ZW5kb3JfaW5mb2ZyYW1lX2Zyb21fZGlzcGxheV9tb2RlKGZyYW1lLAogCQkJCQkJCSAgY29ubl9z
dGF0ZS0+Y29ubmVjdG9yLAotCQkJCQkJCSAgJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9k
ZSk7CisJCQkJCQkJICAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSk7CiAJaWYgKFdBUk5f
T04ocmV0KSkKIAkJcmV0dXJuIGZhbHNlOwogCkBAIC0xMDI3LDcgKzEwMjcsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9oZG1pX2NvbXB1dGVfZ2NwX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAogCS8qIEVuYWJsZSBkZWZhdWx0X3BoYXNlIHdoZW5ldmVyIHRoZSBkaXNw
bGF5IG1vZGUgaXMgc3VpdGFibHkgYWxpZ25lZCAqLwogCWlmIChnY3BfZGVmYXVsdF9waGFzZV9w
b3NzaWJsZShjcnRjX3N0YXRlLT5waXBlX2JwcCwKLQkJCQkgICAgICAgJmNydGNfc3RhdGUtPmJh
c2UuYWRqdXN0ZWRfbW9kZSkpCisJCQkJICAgICAgICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9t
b2RlKSkKIAkJY3J0Y19zdGF0ZS0+aW5mb2ZyYW1lcy5nY3AgfD0gR0NQX0RFRkFVTFRfUEhBU0Vf
RU5BQkxFOwogfQogCkBAIC0xNzM4LDcgKzE3MzgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1p
X3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVjdCBpbnRl
bF9oZG1pICppbnRlbF9oZG1pID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwot
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3Rh
dGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBoZG1p
X3ZhbDsKIAogCWludGVsX2RwX2R1YWxfbW9kZV9zZXRfdG1kc19vdXRwdXQoaW50ZWxfaGRtaSwg
dHJ1ZSk7CkBAIC0xODI5LDcgKzE4MjksNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX2dldF9j
b25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICAgIHRtcCAmIEhETUlfQ09M
T1JfUkFOR0VfMTZfMjM1KQogCQlwaXBlX2NvbmZpZy0+bGltaXRlZF9jb2xvcl9yYW5nZSA9IHRy
dWU7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwor
CXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJaWYgKCh0
bXAgJiBTRFZPX0NPTE9SX0ZPUk1BVF9NQVNLKSA9PSBIRE1JX0NPTE9SX0ZPUk1BVF8xMmJwYykK
IAkJZG90Y2xvY2sgPSBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayAqIDIgLyAzOwpAQCAtMTgzOSw3
ICsxODM5LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfaGRtaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCWlmIChwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcikK
IAkJZG90Y2xvY2sgLz0gcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXI7CiAKLQlwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9jazsKKwlwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gZG90Y2xvY2s7CiAKIAlwaXBlX2Nv
bmZpZy0+bGFuZV9jb3VudCA9IDQ7CiAKQEAgLTIyMTUsNyArMjIxNSw3IEBAIHN0YXRpYyBib29s
IGhkbWlfZGVlcF9jb2xvcl9wb3NzaWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRl
OwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CiAJY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3Rl
ZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgaTsKIAogCWlm
IChIQVNfR01DSChkZXZfcHJpdikpCkBAIC0yMzM2LDcgKzIzMzYsNyBAQCBzdGF0aWMgaW50IGlu
dGVsX2hkbWlfY29tcHV0ZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsK
IAlzdHJ1Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNv
ZGVyLT5iYXNlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9k
ZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5o
dy5hZGp1c3RlZF9tb2RlOwogCWludCBicGMsIGNsb2NrID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19j
bG9jazsKIAogCWlmIChhZGp1c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfREJMQ0xL
KQpAQCAtMjM3OCw3ICsyMzc4LDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfaGRtaV9saW1pdGVkX2Nv
bG9yX3JhbmdlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3MKIAljb25zdCBz
dHJ1Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQog
CQl0b19pbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5i
YXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJ
LyoKIAkgKiBPdXIgWUNiQ3Igb3V0cHV0IGlzIGFsd2F5cyBsaW1pdGVkIHJhbmdlLgpAQCAtMjQw
Niw3ICsyNDA2LDcgQEAgaW50IGludGVsX2hkbWlfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBl
bmNfdG9faW50ZWxfaGRtaSgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
ID0gY29ubl9zdGF0ZS0+Y29ubmVjdG9yOwogCXN0cnVjdCBkcm1fc2NkYyAqc2NkYyA9ICZjb25u
ZWN0b3ItPmRpc3BsYXlfaW5mby5oZG1pLnNjZGM7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfY29u
bmVjdG9yX3N0YXRlICppbnRlbF9jb25uX3N0YXRlID0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHNwY29uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2xzcGNvbi5jCmluZGV4IGY4ZjEzMDg2NDNhOS4uNTE0NWZmOGI5NjJiIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2xzcGNvbi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHNwY29uLmMKQEAgLTE4OSw3
ICsxODksNyBAQCB2b2lkIGxzcGNvbl95Y2JjcjQyMF9jb25maWcoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvciwKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfaW5mbyAqaW5mbyA9
ICZjb25uZWN0b3ItPmRpc3BsYXlfaW5mbzsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCQkJCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7
CisJCQkJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYgKGRybV9tb2RlX2lz
XzQyMF9vbmx5KGluZm8sIGFkanVzdGVkX21vZGUpICYmCiAJICAgIGNvbm5lY3Rvci0+eWNiY3Jf
NDIwX2FsbG93ZWQpIHsKQEAgLTQ3NSw3ICs0NzUsNyBAQCB2b2lkIGxzcGNvbl9zZXRfaW5mb2Zy
YW1lcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICpkaWdfcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7CiAJc3Ry
dWN0IGludGVsX2xzcGNvbiAqbHNwY29uID0gJmRpZ19wb3J0LT5sc3Bjb247CiAJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFz
ZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCWlm
ICghbHNwY29uLT5hY3RpdmUpIHsKIAkJRFJNX0VSUk9SKCJXcml0aW5nIGluZm9mcmFtZXMgd2hp
bGUgTFNQQ09OIGRpc2FibGVkID9cbiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9sdmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2x2ZHMuYwppbmRleCAxMzg0MWQ3YzQ1NWIuLmYxN2Q2ZTAyNDYwZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9sdmRzLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9sdmRzLmMKQEAgLTEzNSw3ICsxMzUsNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9sdmRzX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAJZWxzZQogCQlmbGFncyB8PSBEUk1fTU9ERV9GTEFHX1BWU1lOQzsKIAotCXBpcGVfY29u
ZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gZmxhZ3M7CisJcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gZmxhZ3M7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA8IDUpCiAJCXBpcGVfY29uZmlnLT5nbWNoX3BmaXQubHZkc19ib3JkZXJfYml0cyA9CkBAIC0x
NDgsNyArMTQ4LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbHZkc19nZXRfY29uZmlnKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlwaXBlX2NvbmZpZy0+Z21jaF9wZml0LmNvbnRyb2wg
fD0gdG1wICYgUEFORUxfOFRPNl9ESVRIRVJfRU5BQkxFOwogCX0KIAotCXBpcGVfY29uZmlnLT5i
YXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOwor
CXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBwaXBlX2NvbmZpZy0+
cG9ydF9jbG9jazsKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfbHZkc19wcHNfZ2V0X2h3X3N0YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKQEAgLTIzMSw3ICsyMzEsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9wcmVfZW5hYmxlX2x2ZHMoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJc3RydWN0IGludGVsX2x2ZHNfZW5jb2RlciAqbHZkc19lbmNvZGVyID0gdG9fbHZk
c19lbmNvZGVyKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAllbnVtIHBpcGUgcGlwZSA9
IGNydGMtPnBpcGU7CiAJdTMyIHRlbXA7CiAKQEAgLTM5Miw3ICszOTIsNyBAQCBzdGF0aWMgaW50
IGludGVsX2x2ZHNfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2Vu
Y29kZXIsCiAJCXRvX2x2ZHNfZW5jb2RlcigmaW50ZWxfZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yID0KIAkJbHZkc19lbmNvZGVyLT5hdHRh
Y2hlZF9jb25uZWN0b3I7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlz
dHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWct
PmJhc2UuY3J0Yyk7CiAJdW5zaWduZWQgaW50IGx2ZHNfYnBwOwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMKaW5kZXggYmMxNGU5YzAyODVhLi41ZTNmZDM3ZDk0
NzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGFuZWwu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMKQEAgLTE3
OCw3ICsxNzgsNyBAQCBpbnRlbF9wY2hfcGFuZWxfZml0dGluZyhzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YywKIAkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJ
CWludCBmaXR0aW5nX21vZGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFk
anVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZTsKIAlpbnQgeCA9IDAsIHkgPSAwLCB3aWR0aCA9IDAsIGhlaWdodCA9IDA7
CiAKIAkvKiBOYXRpdmUgbW9kZXMgZG9uJ3QgbmVlZCBmaXR0aW5nICovCkBAIC0zMDAsNyArMzAw
LDcgQEAgc3RhdGljIGlubGluZSB1MzIgcGFuZWxfZml0dGVyX3NjYWxpbmcodTMyIHNvdXJjZSwg
dTMyIHRhcmdldCkKIHN0YXRpYyB2b2lkIGk5NjVfc2NhbGVfYXNwZWN0KHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCSAgICAgIHUzMiAqcGZpdF9jb250cm9sKQogewot
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29u
ZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
KmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJdTMyIHNj
YWxlZF93aWR0aCA9IGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXkgKgogCQlwaXBlX2NvbmZp
Zy0+cGlwZV9zcmNfaDsKIAl1MzIgc2NhbGVkX2hlaWdodCA9IHBpcGVfY29uZmlnLT5waXBlX3Ny
Y193ICoKQEAgLTMyMSw3ICszMjEsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3NjYWxlX2FzcGVjdChz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgICB1MzIgKnBmaXRf
Y29udHJvbCwgdTMyICpwZml0X3BnbV9yYXRpb3MsCiAJCQkgICAgICB1MzIgKmJvcmRlcikKIHsK
LQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9t
b2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBzY2FsZWRfd2lkdGgg
PSBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5ICoKIAkJcGlwZV9jb25maWctPnBpcGVfc3Jj
X2g7CiAJdTMyIHNjYWxlZF9oZWlnaHQgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdyAqCkBAIC0z
ODAsNyArMzgwLDcgQEAgdm9pZCBpbnRlbF9nbWNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGludGVs
X2NydGMgKmludGVsX2NydGMsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7CiAJdTMyIHBmaXRfY29udHJvbCA9IDAs
IHBmaXRfcGdtX3JhdGlvcyA9IDAsIGJvcmRlciA9IDA7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZTsKIAogCS8qIE5hdGl2ZSBtb2RlcyBkb24ndCBuZWVkIGZpdHRpbmcgKi8K
IAlpZiAoYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheSA9PSBwaXBlX2NvbmZpZy0+cGlwZV9z
cmNfdyAmJgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9w
aXBlX2NyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9waXBlX2NyYy5j
CmluZGV4IDYyNjBhMjA4MjcxOS4uZmM2MDI1MzNhNjAyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BpcGVfY3JjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9waXBlX2NyYy5jCkBAIC0zMTMsNyArMzEzLDcgQEAgaW50ZWxf
Y3J0Y19jcmNfc2V0dXBfd29ya2Fyb3VuZHMoc3RydWN0IGludGVsX2NydGMgKmNydGMsIGJvb2wg
ZW5hYmxlKQogCXBpcGVfY29uZmlnLT5jcmNfZW5hYmxlZCA9IGVuYWJsZTsKIAogCWlmIChJU19I
QVNXRUxMKGRldl9wcml2KSAmJgotCSAgICBwaXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUgJiYgY3J0
Yy0+cGlwZSA9PSBQSVBFX0EgJiYKKwkgICAgcGlwZV9jb25maWctPmh3LmFjdGl2ZSAmJiBjcnRj
LT5waXBlID09IFBJUEVfQSAmJgogCSAgICBwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIgPT0g
VFJBTlNDT0RFUl9FRFApCiAJCXBpcGVfY29uZmlnLT5iYXNlLm1vZGVfY2hhbmdlZCA9IHRydWU7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCmluZGV4IDM1OWE2MDc2
MmI0OS4uZjc1Zjc1OWFkNmVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX3Bzci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
cHNyLmMKQEAgLTUzNywxMSArNTM3LDExIEBAIHRyYW5zY29kZXJfaGFzX3BzcjIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHRyYW5zY29kZXIgdHJhbnMpCiAKIHN0YXRp
YyB1MzIgaW50ZWxfZ2V0X2ZyYW1lX3RpbWVfdXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNzdGF0ZSkKIHsKLQlpZiAoIWNzdGF0ZSB8fCAhY3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlp
ZiAoIWNzdGF0ZSB8fCAhY3N0YXRlLT5ody5hY3RpdmUpCiAJCXJldHVybiAwOwogCiAJcmV0dXJu
IERJVl9ST1VORF9VUCgxMDAwICogMTAwMCwKLQkJCSAgICBkcm1fbW9kZV92cmVmcmVzaCgmY3N0
YXRlLT5iYXNlLmFkanVzdGVkX21vZGUpKTsKKwkJCSAgICBkcm1fbW9kZV92cmVmcmVzaCgmY3N0
YXRlLT5ody5hZGp1c3RlZF9tb2RlKSk7CiB9CiAKIHN0YXRpYyB2b2lkIHBzcjJfcHJvZ3JhbV9p
ZGxlX2ZyYW1lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC02MDYsOCAr
NjA2LDggQEAgc3RhdGljIGJvb2wgaW50ZWxfcHNyMl9jb25maWdfdmFsaWQoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwKIAkJCQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShp
bnRlbF9kcCk7Ci0JaW50IGNydGNfaGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVk
X21vZGUuY3J0Y19oZGlzcGxheTsKLQlpbnQgY3J0Y192ZGlzcGxheSA9IGNydGNfc3RhdGUtPmJh
c2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OworCWludCBjcnRjX2hkaXNwbGF5ID0gY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OworCWludCBjcnRjX3ZkaXNw
bGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwogCWludCBw
c3JfbWF4X2ggPSAwLCBwc3JfbWF4X3YgPSAwOwogCiAJaWYgKCFkZXZfcHJpdi0+cHNyLnNpbmtf
cHNyMl9zdXBwb3J0KQpAQCAtNjczLDcgKzY3Myw3IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVf
Y29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJc3RydWN0IGludGVsX2RpZ2l0YWxf
cG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFz
ZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQg
cHNyX3NldHVwX3RpbWU7CiAKIAlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKQpAQCAtMTExNyw3ICsx
MTE3LDcgQEAgc3RhdGljIGludCBpbnRlbF9wc3JfZmFzdHNldF9mb3JjZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCQlnb3RvIGVycm9yOwogCQl9CiAKLQkJaWYgKGNydGNf
c3RhdGUtPmJhc2UuYWN0aXZlICYmIGNydGNfc3RhdGUtPmhhc19wc3IpIHsKKwkJaWYgKGNydGNf
c3RhdGUtPmh3LmFjdGl2ZSAmJiBjcnRjX3N0YXRlLT5oYXNfcHNyKSB7CiAJCQkvKiBNYXJrIG1v
ZGUgYXMgY2hhbmdlZCB0byB0cmlnZ2VyIGEgcGlwZS0+dXBkYXRlKCkgKi8KIAkJCWNydGNfc3Rh
dGUtPmJhc2UubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKIAkJCWJyZWFrOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Nkdm8uYwppbmRleCA0N2Y1ZDg3YTkzOGEuLjk3YWU4Y2MxMzE0
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMKQEAgLTEwODcs
NyArMTA4Nyw3IEBAIHN0YXRpYyBib29sIGludGVsX3Nkdm9fY29tcHV0ZV9hdmlfaW5mb2ZyYW1l
KHN0cnVjdCBpbnRlbF9zZHZvICppbnRlbF9zZHZvLAogewogCXN0cnVjdCBoZG1pX2F2aV9pbmZv
ZnJhbWUgKmZyYW1lID0gJmNydGNfc3RhdGUtPmluZm9mcmFtZXMuYXZpLmF2aTsKIAljb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5i
YXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWlu
dCByZXQ7CiAKIAlpZiAoIWNydGNfc3RhdGUtPmhhc19oZG1pX3NpbmspCkBAIC0xMjc2LDggKzEy
NzYsOCBAQCBzdGF0aWMgaW50IGludGVsX3Nkdm9fY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCXRvX2ludGVsX3Nkdm9fY29ubmVjdG9yX3N0YXRlKGNvbm5f
c3RhdGUpOwogCXN0cnVjdCBpbnRlbF9zZHZvX2Nvbm5lY3RvciAqaW50ZWxfc2R2b19jb25uZWN0
b3IgPQogCQl0b19pbnRlbF9zZHZvX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwot
CXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5i
YXNlLmFkanVzdGVkX21vZGU7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPSAmcGlw
ZV9jb25maWctPmJhc2UubW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcubW9kZTsKIAogCURSTV9ERUJVR19LTVMo
ImZvcmNpbmcgYnBjIHRvIDggZm9yIFNEVk9cbiIpOwogCXBpcGVfY29uZmlnLT5waXBlX2JwcCA9
IDgqMzsKQEAgLTE0MzAsMTIgKzE0MzAsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2b19wcmVf
ZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyLAogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfZW5jb2Rlci0+YmFzZS5k
ZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9t
b2RlID0gJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9t
b2RlOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9zZHZvX2Nvbm5lY3Rvcl9zdGF0ZSAqc2R2b19zdGF0
ZSA9CiAJCXRvX2ludGVsX3Nkdm9fY29ubmVjdG9yX3N0YXRlKGNvbm5fc3RhdGUpOwogCWNvbnN0
IHN0cnVjdCBpbnRlbF9zZHZvX2Nvbm5lY3RvciAqaW50ZWxfc2R2b19jb25uZWN0b3IgPQogCQl0
b19pbnRlbF9zZHZvX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJmNydGNfc3RhdGUtPmJhc2UubW9kZTsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5tb2Rl
OwogCXN0cnVjdCBpbnRlbF9zZHZvICppbnRlbF9zZHZvID0gdG9fc2R2byhpbnRlbF9lbmNvZGVy
KTsKIAl1MzIgc2R2b3g7CiAJc3RydWN0IGludGVsX3Nkdm9faW5fb3V0X21hcCBpbl9vdXQ7CkBA
IC0xNjI5LDcgKzE2MjksNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX2dldF9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQlmbGFncyB8PSBEUk1fTU9ERV9GTEFHX05W
U1lOQzsKIAl9CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZs
YWdzOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJ
LyoKIAkgKiBwaXhlbCBtdWx0aXBsaWVyIHJlYWRvdXQgaXMgdHJpY2t5OiBPbmx5IG9uIGk5MTVn
L2dtIGl0IGlzIHN0b3JlZCBpbgpAQCAtMTY0OSw3ICsxNjQ5LDcgQEAgc3RhdGljIHZvaWQgaW50
ZWxfc2R2b19nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWlmIChw
aXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcikKIAkJZG90Y2xvY2sgLz0gcGlwZV9jb25maWct
PnBpeGVsX211bHRpcGxpZXI7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNy
dGNfY2xvY2sgPSBkb3RjbG9jazsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X2Nsb2NrID0gZG90Y2xvY2s7CiAKIAkvKiBDcm9zcyBjaGVjayB0aGUgcG9ydCBwaXhlbCBtdWx0
aXBsaWVyIHdpdGggdGhlIHNkdm8gZW5jb2RlciBzdGF0ZS4gKi8KIAlpZiAoaW50ZWxfc2R2b19n
ZXRfdmFsdWUoaW50ZWxfc2R2bywgU0RWT19DTURfR0VUX0NMT0NLX1JBVEVfTVVMVCwKQEAgLTE3
MDEsNyArMTcwMSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nkdm9fZW5hYmxlX2F1ZGlvKHN0cnVj
dCBpbnRlbF9zZHZvICppbnRlbF9zZHZvLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
CSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IgPSBjb25uX3N0YXRlLT5jb25uZWN0b3I7CiAJdTggKmVsZCA9IGNvbm5lY3Rvci0+
ZWxkOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nw
cml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwppbmRl
eCBlZGM0MWZjNDA3MjYuLmZjZDczNTVlYWEzNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC04Myw3ICs4Myw3IEBAIHZvaWQgaW50ZWxfcGlwZV91
cGRhdGVfc3RhcnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRl
KQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9ICZuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJm5ld19jcnRjX3N0
YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWxvbmcgdGltZW91dCA9IG1zZWNzX3RvX2ppZmZpZXNf
dGltZW91dCgxKTsKIAlpbnQgc2NhbmxpbmUsIG1pbiwgbWF4LCB2Ymxhbmtfc3RhcnQ7CiAJd2Fp
dF9xdWV1ZV9oZWFkX3QgKndxID0gZHJtX2NydGNfdmJsYW5rX3dhaXRxdWV1ZSgmY3J0Yy0+YmFz
ZSk7CkBAIC0xODkxLDcgKzE4OTEsNyBAQCBnNHhfc3ByaXRlX2NoZWNrX3NjYWxpbmcoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpk
c3QgPSAmcGxhbmVfc3RhdGUtPmJhc2UuZHN0OwogCWludCBzcmNfeCwgc3JjX3csIHNyY19oLCBj
cnRjX3csIGNydGNfaDsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRl
LT5ody5hZGp1c3RlZF9tb2RlOwogCXVuc2lnbmVkIGludCBzdHJpZGUgPSBwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMF0uc3RyaWRlOwogCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5j
cHBbMF07CiAJdW5zaWduZWQgaW50IHdpZHRoX2J5dGVzOwpAQCAtMjEwNSw4ICsyMTA1LDggQEAg
c3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfZmIoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJfQogCiAJLyogWS10aWxpbmcgaXMgbm90IHN1cHBvcnRlZCBpbiBJ
Ri1JRCBJbnRlcmxhY2UgbW9kZSAqLwotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSAmJgot
CSAgICBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFH
X0lOVEVSTEFDRSAmJgorCWlmIChjcnRjX3N0YXRlLT5ody5lbmFibGUgJiYKKwkgICAgY3J0Y19z
dGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFICYm
CiAJICAgIChmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQgfHwKIAkgICAg
IGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQgfHwKIAkgICAgIGZiLT5t
b2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1MgfHwKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdHYuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfdHYuYwppbmRleCA1NTU2ZDgzMDBhODguLjAyNTI5ZjExOWU0YSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF90di5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdHYuYwpAQCAtMTA4NSw3ICsxMDg1
LDcgQEAgaW50ZWxfdHZfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0J
CSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGU7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgbW9kZSA9IHt9OwogCXUzMiB0
dl9jdGwsIGhjdGwxLCBoY3RsMywgdmN0bDEsIHZjdGwyLCB0bXA7CiAJc3RydWN0IHR2X21vZGUg
dHZfbW9kZSA9IHt9OwpAQCAtMTE4OCw3ICsxMTg4LDcgQEAgaW50ZWxfdHZfY29tcHV0ZV9jb25m
aWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCXRvX2ludGVsX3R2X2Nvbm5lY3Rv
cl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3QgdHZfbW9kZSAqdHZfbW9kZSA9IGlu
dGVsX3R2X21vZGVfZmluZChjb25uX3N0YXRlKTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkm
cGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IGhkaXNwbGF5ID0gYWRqdXN0ZWRf
bW9kZS0+Y3J0Y19oZGlzcGxheTsKIAlpbnQgdmRpc3BsYXkgPSBhZGp1c3RlZF9tb2RlLT5jcnRj
X3ZkaXNwbGF5OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3Zkc2MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmRzYy5jCmlu
ZGV4IDg5NmIwYzMzNGY1ZS4uNzU3YjI3NmViM2ZjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Zkc2MuYwpAQCAtMzI5LDggKzMyOSw4IEBAIGludCBpbnRlbF9kcF9jb21w
dXRlX2RzY19wYXJhbXMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpbnQgY29sdW1uX2lu
ZGV4ID0gMDsKIAl1OCBsaW5lX2J1Zl9kZXB0aCA9IDA7CiAKLQl2ZHNjX2NmZy0+cGljX3dpZHRo
ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OwotCXZkc2Nf
Y2ZnLT5waWNfaGVpZ2h0ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3Zk
aXNwbGF5OworCXZkc2NfY2ZnLT5waWNfd2lkdGggPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZS5jcnRjX2hkaXNwbGF5OworCXZkc2NfY2ZnLT5waWNfaGVpZ2h0ID0gcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheTsKIAl2ZHNjX2NmZy0+c2xpY2Vfd2lkdGgg
PSBESVZfUk9VTkRfVVAodmRzY19jZmctPnBpY193aWR0aCwKIAkJCQkJICAgICBwaXBlX2NvbmZp
Zy0+ZHNjLnNsaWNlX2NvdW50KTsKIAkvKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS92bHZfZHNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9k
c2kuYwppbmRleCA1MDA2NGNkZTA3MjQuLjNiZjgzODI3OWZjMiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS92bHZfZHNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS92bHZfZHNpLmMKQEAgLTI2Myw3ICsyNjMsNyBAQCBzdGF0aWMgaW50IGludGVs
X2RzaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1
Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IgPSBpbnRlbF9kc2ktPmF0dGFjaGVk
X2Nvbm5lY3RvcjsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlw
ZV9jb25maWctPmJhc2UuY3J0Yyk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmZp
eGVkX21vZGUgPSBpbnRlbF9jb25uZWN0b3ItPnBhbmVsLmZpeGVkX21vZGU7Ci0Jc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgcmV0OwogCiAJRFJNX0RFQlVHX0tNUygi
XG4iKTsKQEAgLTEwMzIsNyArMTAzMiw3IEBAIHN0YXRpYyB2b2lkIGJ4dF9kc2lfZ2V0X3BpcGVf
Y29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBlbmNvZGVyLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVk
X21vZGUgPQotCQkJCQkmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCQkJJnBp
cGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlX3N3OwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kg
PSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKQEAgLTEwNDUsNyArMTA0NSw3IEBA
IHN0YXRpYyB2b2lkIGJ4dF9kc2lfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkJCWNydGNfaGJsYW5rX3N0YXJ0X3N3LCBjcnRjX2hibGFua19lbmRfc3c7
CiAKIAkvKiBGSVhNRTogaHcgcmVhZG91dCBzaG91bGQgbm90IGRlcGVuZCBvbiBTVyBzdGF0ZSAq
LwotCWFkanVzdGVkX21vZGVfc3cgPSAmY3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7
CisJYWRqdXN0ZWRfbW9kZV9zdyA9ICZjcnRjLT5jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAK
IAkvKgogCSAqIEF0bGVhc3Qgb25lIHBvcnQgaXMgYWN0aXZlIGFzIGVuY29kZXItPmdldF9jb25m
aWcgY2FsbGVkIG9ubHkgaWYKQEAgLTEyMDQsNyArMTIwNCw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2RzaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCX0KIAogCWlm
IChwY2xrKSB7Ci0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9
IHBjbGs7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBwY2xr
OwogCQlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayA9IHBjbGs7CiAJfQogfQpAQCAtMTMxNyw3ICsx
MzE3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX3ByZXBhcmUoc3RydWN0IGludGVsX2VuY29k
ZXIgKmludGVsX2VuY29kZXIsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxf
Y3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9k
c2kgPSBlbmNfdG9faW50ZWxfZHNpKGVuY29kZXIpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7
CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJZW51bSBwb3J0IHBvcnQ7CiAJdW5zaWduZWQgaW50
IGJwcCA9IG1pcGlfZHNpX3BpeGVsX2Zvcm1hdF90b19icHAoaW50ZWxfZHNpLT5waXhlbF9mb3Jt
YXQpOwogCXUzMiB2YWwsIHRtcDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXgg
ODAxNjQ4NGViY2QzLi43MzgwOGZkMjY2MjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jCkBAIC0yNjg0LDExICsyNjg0LDExIEBAIHN0YXRpYyBpbnQgaTkxNV9kaXNwbGF5X2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAKIAkJc2VxX3ByaW50ZihtLCAiQ1JU
QyAlZDogcGlwZTogJWMsIGFjdGl2ZT0lcywgKHNpemU9JWR4JWQpLCBkaXRoZXI9JXMsIGJwcD0l
ZFxuIiwKIAkJCSAgIGNydGMtPmJhc2UuYmFzZS5pZCwgcGlwZV9uYW1lKGNydGMtPnBpcGUpLAot
CQkJICAgeWVzbm8ocGlwZV9jb25maWctPmJhc2UuYWN0aXZlKSwKKwkJCSAgIHllc25vKHBpcGVf
Y29uZmlnLT5ody5hY3RpdmUpLAogCQkJICAgcGlwZV9jb25maWctPnBpcGVfc3JjX3csIHBpcGVf
Y29uZmlnLT5waXBlX3NyY19oLAogCQkJICAgeWVzbm8ocGlwZV9jb25maWctPmRpdGhlciksIHBp
cGVfY29uZmlnLT5waXBlX2JwcCk7CiAKLQkJaWYgKHBpcGVfY29uZmlnLT5iYXNlLmFjdGl2ZSkg
eworCQlpZiAocGlwZV9jb25maWctPmh3LmFjdGl2ZSkgewogCQkJc3RydWN0IGludGVsX3BsYW5l
ICpjdXJzb3IgPQogCQkJCXRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UuY3Vyc29yKTsKIApAQCAt
NDE2MSw3ICs0MTYxLDcgQEAgc3RhdGljIGludCBpOTE1X2RycnNfY3RsX3NldCh2b2lkICpkYXRh
LCB1NjQgdmFsKQogCiAJCWNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJh
c2Uuc3RhdGUpOwogCi0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwKKwkJaWYgKCFj
cnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKIAkJICAgICFjcnRjX3N0YXRlLT5oYXNfZHJycykKIAkJ
CWdvdG8gb3V0OwogCkBAIC00MjQzLDcgKzQyNDMsNyBAQCBpOTE1X2ZpZm9fdW5kZXJydW5fcmVz
ZXRfd3JpdGUoc3RydWN0IGZpbGUgKmZpbHAsCiAJCQkJcmV0ID0gd2FpdF9mb3JfY29tcGxldGlv
bl9pbnRlcnJ1cHRpYmxlKCZjb21taXQtPmZsaXBfZG9uZSk7CiAJCX0KIAotCQlpZiAoIXJldCAm
JiBjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkgeworCQlpZiAoIXJldCAmJiBjcnRjX3N0YXRlLT5o
dy5hY3RpdmUpIHsKIAkJCURSTV9ERUJVR19LTVMoIlJlLWFybWluZyBGSUZPIHVuZGVycnVucyBv
biBwaXBlICVjXG4iLAogCQkJCSAgICAgIHBpcGVfbmFtZShpbnRlbF9jcnRjLT5waXBlKSk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IGQ2YWVkODg2MGRiNy4uZWIwYzI5YjBmOGM1IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTc4OSw3ICs3ODksNyBAQCBzdGF0aWMgYm9vbCBp
bnRlbF93bV9wbGFuZV92aXNpYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFu
ZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAKIAkvKiBGSVhNRSBjaGVjayB0aGUgJ2VuYWJsZScgaW5z
dGVhZCAqLwotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRl
LT5ody5hY3RpdmUpCiAJCXJldHVybiBmYWxzZTsKIAogCS8qCkBAIC04NDIsNyArODQyLDcgQEAg
c3RhdGljIHZvaWQgcGluZXZpZXdfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRf
Y3J0YykKIAljcnRjID0gc2luZ2xlX2VuYWJsZWRfY3J0YyhkZXZfcHJpdik7CiAJaWYgKGNydGMp
IHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJ
JmNydGMtPmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGMtPmNvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZTsKIAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJ
Y3J0Yy0+YmFzZS5wcmltYXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5j
cHBbMF07CkBAIC0xMDc4LDcgKzEwNzgsNyBAQCBzdGF0aWMgdTE2IGc0eF9jb21wdXRlX3dtKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5k
ZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJ
JmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVz
dGVkX21vZGU7CiAJdW5zaWduZWQgaW50IGxhdGVuY3kgPSBkZXZfcHJpdi0+d20ucHJpX2xhdGVu
Y3lbbGV2ZWxdICogMTA7CiAJdW5zaWduZWQgaW50IGNsb2NrLCBodG90YWwsIGNwcCwgd2lkdGgs
IHdtOwogCkBAIC0xMzkwLDcgKzEzOTAsNyBAQCBzdGF0aWMgaW50IGc0eF9jb21wdXRlX2ludGVy
bWVkaWF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJY29u
c3Qgc3RydWN0IGc0eF93bV9zdGF0ZSAqYWN0aXZlID0gJm9sZF9jcnRjX3N0YXRlLT53bS5nNHgu
b3B0aW1hbDsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkOwogCi0JaWYgKCFuZXdfY3J0Y19zdGF0
ZS0+YmFzZS5hY3RpdmUgfHwgZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJm5ld19jcnRj
X3N0YXRlLT5iYXNlKSkgeworCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fCBkcm1f
YXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPmJhc2UpKSB7CiAJCSpp
bnRlcm1lZGlhdGUgPSAqb3B0aW1hbDsKIAogCQlpbnRlcm1lZGlhdGUtPmN4c3IgPSBmYWxzZTsK
QEAgLTE1ODQsNyArMTU4NCw3IEBAIHN0YXRpYyB1MTYgdmx2X2NvbXB1dGVfd21fbGV2ZWwoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkm
Y3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZTsKIAl1bnNpZ25lZCBpbnQgY2xvY2ssIGh0b3RhbCwgY3BwLCB3aWR0aCwgd207CiAK
IAlpZiAoZGV2X3ByaXYtPndtLnByaV9sYXRlbmN5W2xldmVsXSA9PSAwKQpAQCAtMjAyMyw3ICsy
MDIzLDcgQEAgc3RhdGljIGludCB2bHZfY29tcHV0ZV9pbnRlcm1lZGlhdGVfd20oc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogCWNvbnN0IHN0cnVjdCB2bHZfd21fc3Rh
dGUgKmFjdGl2ZSA9ICZvbGRfY3J0Y19zdGF0ZS0+d20udmx2Lm9wdGltYWw7CiAJaW50IGxldmVs
OwogCi0JaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwgZHJtX2F0b21pY19jcnRj
X25lZWRzX21vZGVzZXQoJm5ld19jcnRjX3N0YXRlLT5iYXNlKSkgeworCWlmICghbmV3X2NydGNf
c3RhdGUtPmh3LmFjdGl2ZSB8fCBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2Ny
dGNfc3RhdGUtPmJhc2UpKSB7CiAJCSppbnRlcm1lZGlhdGUgPSAqb3B0aW1hbDsKIAogCQlpbnRl
cm1lZGlhdGUtPmN4c3IgPSBmYWxzZTsKQEAgLTIxNzksNyArMjE3OSw3IEBAIHN0YXRpYyB2b2lk
IGk5NjVfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAkJLyogc2Vs
Zi1yZWZyZXNoIGhhcyBtdWNoIGhpZ2hlciBsYXRlbmN5ICovCiAJCXN0YXRpYyBjb25zdCBpbnQg
c3JfbGF0ZW5jeV9ucyA9IDEyMDAwOwogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9Ci0JCQkmY3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
CQkmY3J0Yy0+Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCQljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9CiAJCQljcnRjLT5iYXNlLnByaW1hcnktPnN0YXRlLT5mYjsKIAkJaW50
IGNsb2NrID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jazsKQEAgLTIyNjAsNyArMjI2MCw3IEBA
IHN0YXRpYyB2b2lkIGk5eHhfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0
YykKIAljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BsYW5lKGRldl9wcml2LCBQTEFORV9BKTsK
IAlpZiAoaW50ZWxfY3J0Y19hY3RpdmUoY3J0YykpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmNydGMtPmNvbmZpZy0+YmFzZS5hZGp1c3Rl
ZF9tb2RlOworCQkJJmNydGMtPmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJY3J0Yy0+YmFzZS5wcmltYXJ5LT5zdGF0ZS0+
ZmI7CiAJCWludCBjcHA7CkBAIC0yMjg3LDcgKzIyODcsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3Vw
ZGF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJY3J0YyA9IGludGVsX2dl
dF9jcnRjX2Zvcl9wbGFuZShkZXZfcHJpdiwgUExBTkVfQik7CiAJaWYgKGludGVsX2NydGNfYWN0
aXZlKGNydGMpKSB7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9t
b2RlID0KLQkJCSZjcnRjLT5jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRjLT5j
b25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0KIAkJCWNydGMtPmJhc2UucHJpbWFyeS0+c3RhdGUtPmZiOwogCQlpbnQgY3BwOwpAQCAt
MjMzNSw3ICsyMzM1LDcgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfd20oc3RydWN0IGludGVs
X2NydGMgKnVudXNlZF9jcnRjKQogCQkvKiBzZWxmLXJlZnJlc2ggaGFzIG11Y2ggaGlnaGVyIGxh
dGVuY3kgKi8KIAkJc3RhdGljIGNvbnN0IGludCBzcl9sYXRlbmN5X25zID0gNjAwMDsKIAkJY29u
c3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmVuYWJsZWQt
PmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmVuYWJsZWQtPmNvbmZpZy0+aHcuYWRq
dXN0ZWRfbW9kZTsKIAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJZW5h
YmxlZC0+YmFzZS5wcmltYXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjbG9jayA9IGFkanVzdGVkX21v
ZGUtPmNydGNfY2xvY2s7CkBAIC0yMzkzLDcgKzIzOTMsNyBAQCBzdGF0aWMgdm9pZCBpODQ1X3Vw
ZGF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJaWYgKGNydGMgPT0gTlVM
TCkKIAkJcmV0dXJuOwogCi0JYWRqdXN0ZWRfbW9kZSA9ICZjcnRjLT5jb25maWctPmJhc2UuYWRq
dXN0ZWRfbW9kZTsKKwlhZGp1c3RlZF9tb2RlID0gJmNydGMtPmNvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAlwbGFuZWFfd20gPSBpbnRlbF9jYWxjdWxhdGVfd20oYWRqdXN0ZWRfbW9kZS0+Y3J0
Y19jbG9jaywKIAkJCQkgICAgICAgJmk4NDVfd21faW5mbywKIAkJCQkgICAgICAgZGV2X3ByaXYt
PmRpc3BsYXkuZ2V0X2ZpZm9fc2l6ZShkZXZfcHJpdiwgUExBTkVfQSksCkBAIC0yNDgzLDcgKzI0
ODMsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX3ByaV93bShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIG1ldGhvZDE7CiAKIAltZXRob2QyID0g
aWxrX3dtX21ldGhvZDIoY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwKLQkJCQkgY3J0Y19zdGF0ZS0+
YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsLAorCQkJCSBjcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlLmNydGNfaHRvdGFsLAogCQkJCSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUt
PmJhc2UuZHN0KSwKIAkJCQkgY3BwLCBtZW1fdmFsdWUpOwogCkBAIC0yNTExLDcgKzI1MTEsNyBA
QCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX3Nwcl93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAogCW1ldGhvZDEgPSBpbGtfd21fbWV0aG9kMShjcnRjX3N0YXRl
LT5waXhlbF9yYXRlLCBjcHAsIG1lbV92YWx1ZSk7CiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2Qy
KGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCi0JCQkJIGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX2h0b3RhbCwKKwkJCQkgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X2h0b3RhbCwKIAkJCQkgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksCiAJ
CQkJIGNwcCwgbWVtX3ZhbHVlKTsKIAlyZXR1cm4gbWluKG1ldGhvZDEsIG1ldGhvZDIpOwpAQCAt
MjUzNiw3ICsyNTM2LDcgQEAgc3RhdGljIHUzMiBpbGtfY29tcHV0ZV9jdXJfd20oY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY3BwID0gcGxhbmVfc3RhdGUtPmJh
c2UuZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJcmV0dXJuIGlsa193bV9tZXRob2QyKGNydGNfc3Rh
dGUtPnBpeGVsX3JhdGUsCi0JCQkgICAgICBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUu
Y3J0Y19odG90YWwsCisJCQkgICAgICBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNf
aHRvdGFsLAogCQkJICAgICAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCks
CiAJCQkgICAgICBjcHAsIG1lbV92YWx1ZSk7CiB9CkBAIC0yNzYwLDEwICsyNzYwLDEwIEBAIGhz
d19jb21wdXRlX2xpbmV0aW1lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCWNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0K
IAkJdG9faW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOwogCWNvbnN0
IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUt
PmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJ
dTMyIGxpbmV0aW1lLCBpcHNfbGluZXRpbWU7CiAKLQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0
aXZlKQorCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1cm4gMDsKIAlpZiAoV0FS
Tl9PTihhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrID09IDApKQogCQlyZXR1cm4gMDsKQEAgLTMw
OTUsNyArMzA5NSw3IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJCWN1cnN0YXRlID0gcGxhbmVfc3RhdGU7CiAJ
fQogCi0JcGlwZV93bS0+cGlwZV9lbmFibGVkID0gY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJ
cGlwZV93bS0+cGlwZV9lbmFibGVkID0gY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwogCWlmIChzcHJz
dGF0ZSkgewogCQlwaXBlX3dtLT5zcHJpdGVzX2VuYWJsZWQgPSBzcHJzdGF0ZS0+YmFzZS52aXNp
YmxlOwogCQlwaXBlX3dtLT5zcHJpdGVzX3NjYWxlZCA9IHNwcnN0YXRlLT5iYXNlLnZpc2libGUg
JiYKQEAgLTMxNjgsNyArMzE2OCw3IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfaW50ZXJtZWRp
YXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdzdGF0ZSkKIAkgKiBhbmQgYWZ0ZXIg
dGhlIHZibGFuay4KIAkgKi8KIAkqYSA9IG5ld3N0YXRlLT53bS5pbGsub3B0aW1hbDsKLQlpZiAo
IW5ld3N0YXRlLT5iYXNlLmFjdGl2ZSB8fCBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgm
bmV3c3RhdGUtPmJhc2UpIHx8CisJaWYgKCFuZXdzdGF0ZS0+aHcuYWN0aXZlIHx8IGRybV9hdG9t
aWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdzdGF0ZS0+YmFzZSkgfHwKIAkgICAgaW50ZWxfc3Rh
dGUtPnNraXBfaW50ZXJtZWRpYXRlX3dtKQogCQlyZXR1cm4gMDsKIApAQCAtMzc3MCw3ICszNzcw
LDcgQEAgYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiAJY3J0YyA9IGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBwaXBl
KTsKIAljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsK
IAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQlyZXR1cm4gZmFsc2U7CiAKIAlmb3JfZWFjaF9p
bnRlbF9wbGFuZV9vbl9jcnRjKGRldiwgY3J0YywgcGxhbmUpIHsKQEAgLTM4MjAsNyArMzgyMCw3
IEBAIHN0YXRpYyB1MTYgaW50ZWxfZ2V0X2RkYl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQogCQlyZXR1cm4gZGRi
X3NpemUgLSA0OyAvKiA0IGJsb2NrcyBmb3IgYnlwYXNzIHBhdGggYWxsb2NhdGlvbiAqLwogCi0J
YWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJYWRqdXN0
ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXRvdGFsX2RhdGFfYncg
PSB0b3RhbF9kYXRhX3JhdGUgKiBkcm1fbW9kZV92cmVmcmVzaChhZGp1c3RlZF9tb2RlKTsKIAog
CS8qCkBAIC0zODU4LDcgKzM4NTgsNyBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGlt
aXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl1MTYgZGRiX3NpemU7CiAJ
dTMyIGk7CiAKLQlpZiAoV0FSTl9PTighc3RhdGUpIHx8ICFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2
ZSkgeworCWlmIChXQVJOX09OKCFzdGF0ZSkgfHwgIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewog
CQlhbGxvYy0+c3RhcnQgPSAwOwogCQlhbGxvYy0+ZW5kID0gMDsKIAkJKm51bV9hY3RpdmUgPSBo
d2VpZ2h0OChkZXZfcHJpdi0+YWN0aXZlX3BpcGVzKTsKQEAgLTM4OTcsMTEgKzM4OTcsMTEgQEAg
c2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJICovCiAJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoaW50
ZWxfc3RhdGUsIGNydGMsIGNydGNfc3RhdGUsIGkpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKKwkJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCQllbnVtIHBpcGUgcGlw
ZSA9IGNydGMtPnBpcGU7CiAJCWludCBoZGlzcGxheSwgdmRpc3BsYXk7CiAKLQkJaWYgKCFjcnRj
X3N0YXRlLT5iYXNlLmVuYWJsZSkKKwkJaWYgKCFjcnRjX3N0YXRlLT5ody5lbmFibGUpCiAJCQlj
b250aW51ZTsKIAogCQlkcm1fbW9kZV9nZXRfaHZfdGltaW5nKGFkanVzdGVkX21vZGUsICZoZGlz
cGxheSwgJnZkaXNwbGF5KTsKQEAgLTQyMzgsNyArNDIzOCw3IEBAIHNrbF9hbGxvY2F0ZV9waXBl
X2RkYihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoV0FSTl9PTigh
c3RhdGUpKQogCQlyZXR1cm4gMDsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpIHsK
KwlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQlhbGxvYy0+c3RhcnQgPSBhbGxvYy0+
ZW5kID0gMDsKIAkJcmV0dXJuIDA7CiAJfQpAQCAtNDQ4MCw3ICs0NDgwLDcgQEAgaW50ZWxfZ2V0
X2xpbmV0aW1lX3VzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CXUzMiBjcnRjX2h0b3RhbDsKIAl1aW50X2ZpeGVkXzE2XzE2X3QgbGluZXRpbWVfdXM7CiAKLQlp
ZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
KQogCQlyZXR1cm4gdTMyX3RvX2ZpeGVkMTYoMCk7CiAKIAlwaXhlbF9yYXRlID0gY3J0Y19zdGF0
ZS0+cGl4ZWxfcmF0ZTsKQEAgLTQ0ODgsNyArNDQ4OCw3IEBAIGludGVsX2dldF9saW5ldGltZV91
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoV0FSTl9P
TihwaXhlbF9yYXRlID09IDApKQogCQlyZXR1cm4gdTMyX3RvX2ZpeGVkMTYoMCk7CiAKLQljcnRj
X2h0b3RhbCA9IGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbDsKKwlj
cnRjX2h0b3RhbCA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWw7CiAJ
bGluZXRpbWVfdXMgPSBkaXZfZml4ZWQxNihjcnRjX2h0b3RhbCAqIDEwMDAsIHBpeGVsX3JhdGUp
OwogCiAJcmV0dXJuIGxpbmV0aW1lX3VzOwpAQCAtNDY3MCwxNCArNDY3MCwxNCBAQCBzdGF0aWMg
dm9pZCBza2xfY29tcHV0ZV9wbGFuZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAltZXRob2QxID0gc2tsX3dtX21ldGhvZDEoZGV2X3ByaXYsIHdwLT5wbGFu
ZV9waXhlbF9yYXRlLAogCQkJCSB3cC0+Y3BwLCBsYXRlbmN5LCB3cC0+ZGJ1Zl9ibG9ja19zaXpl
KTsKIAltZXRob2QyID0gc2tsX3dtX21ldGhvZDIod3AtPnBsYW5lX3BpeGVsX3JhdGUsCi0JCQkJ
IGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKKwkJCQkgY3J0Y19z
dGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKIAkJCQkgbGF0ZW5jeSwKIAkJCQkg
d3AtPnBsYW5lX2Jsb2Nrc19wZXJfbGluZSk7CiAKIAlpZiAod3AtPnlfdGlsZWQpIHsKIAkJc2Vs
ZWN0ZWRfcmVzdWx0ID0gbWF4X2ZpeGVkMTYobWV0aG9kMiwgd3AtPnlfdGlsZV9taW5pbXVtKTsK
IAl9IGVsc2UgewotCQlpZiAoKHdwLT5jcHAgKiBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21v
ZGUuY3J0Y19odG90YWwgLworCQlpZiAoKHdwLT5jcHAgKiBjcnRjX3N0YXRlLT5ody5hZGp1c3Rl
ZF9tb2RlLmNydGNfaHRvdGFsIC8KIAkJICAgICB3cC0+ZGJ1Zl9ibG9ja19zaXplIDwgMSkgJiYK
IAkJICAgICAod3AtPnBsYW5lX2J5dGVzX3Blcl9saW5lIC8gd3AtPmRidWZfYmxvY2tfc2l6ZSA8
IDEpKSB7CiAJCQlzZWxlY3RlZF9yZXN1bHQgPSBtZXRob2QyOwotLSAKMi4yNC4wLnJjMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 105B66521B
	for <lists+intel-gfx@lfdr.de>; Thu, 11 Jul 2019 08:55:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6379989F2E;
	Thu, 11 Jul 2019 06:55:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9D6DC89F2E
 for <intel-gfx@lists.freedesktop.org>; Thu, 11 Jul 2019 06:55:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17214632-1500050 
 for multiple; Thu, 11 Jul 2019 07:52:17 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 11 Jul 2019 07:52:00 +0100
Message-Id: <20190711065215.4004-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190711065215.4004-1-chris@chris-wilson.co.uk>
References: <20190711065215.4004-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 03/18] drm/i915: Lock the engine while dumping
 the active request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Alex Shumsky <alexthreed@gmail.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY2Fubm90IGxldCB0aGUgcmVxdWVzdCBiZSByZXRpcmVkIGFuZCBmcmVlZCB3aGlsZSB3ZSBh
cmUgdHJ5aW5nIHRvCmR1bXAgaXQgZHVyaW5nIGVycm9yIGNhcHR1cmUuIEl0IGlzIG5vdCBzdWZm
aWNpZW50IGp1c3QgdG8gZ3JhYiBhCnJlZmVyZW5jZSB0byB0aGUgcmVxdWVzdCwgYXMgZHVyaW5n
IHJldGlyZW1lbnQgd2UgbWF5IGZyZWUgdGhlIHJpbmcKd2hpY2ggd2UgYXJlIGFsc28gZHVtcGlu
Zy4gU28gdGFrZSB0aGUgZW5naW5lIGxvY2sgdG8gcHJldmVudCByZXRpcmluZwphbmQgZnJlZWlu
ZyBvZiB0aGUgcmVxdWVzdC4KClJlcG9ydGVkLWJ5OiBBbGV4IFNodW1za3kgPGFsZXh0aHJlZWRA
Z21haWwuY29tPgpGaXhlczogODNjMzE3ODMyZWIxICgiZHJtL2k5MTU6IER1bXAgdGhlIHJpbmdi
dWZmZXIgb2YgdGhlIGFjdGl2ZSByZXF1ZXN0IGZvciBkZWJ1Z2dpbmciKQpTaWduZWQtb2ZmLWJ5
OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1
bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+CkNjOiBKb29uYXMgTGFodGluZW4gPGpvb25h
cy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBBbGV4IFNodW1za3kgPGFsZXh0aHJlZWRA
Z21haWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5j
IHwgMTEgKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMg
ICAgIHwgIDYgKysrKy0tCiAyIGZpbGVzIGNoYW5nZWQsIDggaW5zZXJ0aW9ucygrKSwgOSBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4
IGJkZjI3OWZhM2IyZS4uMGEyZTdhNDA0Yzc0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfY3MuYwpAQCAtMTQ4NCw2ICsxNDg0LDcgQEAgdm9pZCBpbnRlbF9lbmdpbmVf
ZHVtcChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJc3RydWN0IGk5MTVfZ3B1X2Vy
cm9yICogY29uc3QgZXJyb3IgPSAmZW5naW5lLT5pOTE1LT5ncHVfZXJyb3I7CiAJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisJdW5zaWduZWQgbG9u
ZyBmbGFnczsKIAogCWlmIChoZWFkZXIpIHsKIAkJdmFfbGlzdCBhcDsKQEAgLTE1MDMsMTAgKzE1
MDQsOSBAQCB2b2lkIGludGVsX2VuZ2luZV9kdW1wKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKIAkJICAgaTkxNV9yZXNldF9lbmdpbmVfY291bnQoZXJyb3IsIGVuZ2luZSksCiAJCSAg
IGk5MTVfcmVzZXRfY291bnQoZXJyb3IpKTsKIAotCXJjdV9yZWFkX2xvY2soKTsKLQogCWRybV9w
cmludGYobSwgIlx0UmVxdWVzdHM6XG4iKTsKIAorCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUt
PmFjdGl2ZS5sb2NrLCBmbGFncyk7CiAJcnEgPSBpbnRlbF9lbmdpbmVfZmluZF9hY3RpdmVfcmVx
dWVzdChlbmdpbmUpOwogCWlmIChycSkgewogCQlwcmludF9yZXF1ZXN0KG0sIHJxLCAiXHRcdGFj
dGl2ZSAiKTsKQEAgLTE1MjYsOCArMTUyNiw3IEBAIHZvaWQgaW50ZWxfZW5naW5lX2R1bXAoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCiAJCXByaW50X3JlcXVlc3RfcmluZyhtLCBy
cSk7CiAJfQotCi0JcmN1X3JlYWRfdW5sb2NrKCk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
ZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0X2lmX2luX3VzZSgmZW5naW5lLT5pOTE1LT5ydW50aW1lX3BtKTsKIAlpZiAod2FrZXJl
ZikgewpAQCAtMTY4OSw3ICsxNjg4LDYgQEAgc3RydWN0IGk5MTVfcmVxdWVzdCAqCiBpbnRlbF9l
bmdpbmVfZmluZF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
CiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCwgKmFjdGl2ZSA9IE5VTEw7Ci0JdW5z
aWduZWQgbG9uZyBmbGFnczsKIAogCS8qCiAJICogV2UgYXJlIGNhbGxlZCBieSB0aGUgZXJyb3Ig
Y2FwdHVyZSwgcmVzZXQgYW5kIHRvIGR1bXAgZW5naW5lCkBAIC0xNzAyLDcgKzE3MDAsNyBAQCBp
bnRlbF9lbmdpbmVfZmluZF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiAJICogQXQgYWxsIG90aGVyIHRpbWVzLCB3ZSBtdXN0IGFzc3VtZSB0aGUgR1BVIGlz
IHN0aWxsIHJ1bm5pbmcsIGJ1dAogCSAqIHdlIG9ubHkgY2FyZSBhYm91dCB0aGUgc25hcHNob3Qg
b2YgdGhpcyBtb21lbnQuCiAJICovCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0aXZl
LmxvY2ssIGZsYWdzKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPmFjdGl2ZS5sb2Nr
KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHJlcXVlc3QsICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0
cywgc2NoZWQubGluaykgewogCQlpZiAoaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChyZXF1ZXN0KSkK
IAkJCWNvbnRpbnVlOwpAQCAtMTcxNyw3ICsxNzE1LDYgQEAgaW50ZWxfZW5naW5lX2ZpbmRfYWN0
aXZlX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQlhY3RpdmUgPSBy
ZXF1ZXN0OwogCQlicmVhazsKIAl9Ci0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5h
Y3RpdmUubG9jaywgZmxhZ3MpOwogCiAJcmV0dXJuIGFjdGl2ZTsKIH0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dwdV9lcnJvci5jCmluZGV4IDU0ODljZDg3OTMxNS4uZjI5N2E0M2RmMWU5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKQEAgLTE0MTEsNiArMTQxMSw3IEBAIHN0
YXRpYyB2b2lkIGdlbV9yZWNvcmRfcmluZ3Moc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikK
IAkJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gaTkxNS0+ZW5naW5lW2ldOwogCQlz
dHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5lICplZSA9ICZlcnJvci0+ZW5naW5lW2ldOwogCQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OworCQl1bnNpZ25lZCBsb25nIGZsYWdzOwogCiAJ
CWVlLT5lbmdpbmVfaWQgPSAtMTsKIApAQCAtMTQyMiwxMCArMTQyMywxMSBAQCBzdGF0aWMgdm9p
ZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiAJCWVycm9y
X3JlY29yZF9lbmdpbmVfcmVnaXN0ZXJzKGVycm9yLCBlbmdpbmUsIGVlKTsKIAkJZXJyb3JfcmVj
b3JkX2VuZ2luZV9leGVjbGlzdHMoZW5naW5lLCBlZSk7CiAKKwkJc3Bpbl9sb2NrX2lycXNhdmUo
JmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIAkJcmVxdWVzdCA9IGludGVsX2VuZ2luZV9m
aW5kX2FjdGl2ZV9yZXF1ZXN0KGVuZ2luZSk7CiAJCWlmIChyZXF1ZXN0KSB7CiAJCQlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4ID0gcmVxdWVzdC0+Z2VtX2NvbnRleHQ7Ci0JCQlzdHJ1Y3Qg
aW50ZWxfcmluZyAqcmluZzsKKwkJCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nID0gcmVxdWVzdC0+
cmluZzsKIAogCQkJZWUtPnZtID0gY3R4LT52bSA/OiAmZW5naW5lLT5ndC0+Z2d0dC0+dm07CiAK
QEAgLTE0NTUsNyArMTQ1Nyw2IEBAIHN0YXRpYyB2b2lkIGdlbV9yZWNvcmRfcmluZ3Moc3RydWN0
IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKIAkJCWVlLT5ycV9wb3N0ID0gcmVxdWVzdC0+cG9zdGZp
eDsKIAkJCWVlLT5ycV90YWlsID0gcmVxdWVzdC0+dGFpbDsKIAotCQkJcmluZyA9IHJlcXVlc3Qt
PnJpbmc7CiAJCQllZS0+Y3B1X3JpbmdfaGVhZCA9IHJpbmctPmhlYWQ7CiAJCQllZS0+Y3B1X3Jp
bmdfdGFpbCA9IHJpbmctPnRhaWw7CiAJCQllZS0+cmluZ2J1ZmZlciA9CkBAIC0xNDYzLDYgKzE0
NjQsNyBAQCBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0
ZSAqZXJyb3IpCiAKIAkJCWVuZ2luZV9yZWNvcmRfcmVxdWVzdHMoZW5naW5lLCByZXF1ZXN0LCBl
ZSk7CiAJCX0KKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywg
ZmxhZ3MpOwogCiAJCWVlLT5od3NfcGFnZSA9CiAJCQlpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUo
aTkxNSwKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

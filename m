Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 816F0107C31
	for <lists+intel-gfx@lfdr.de>; Sat, 23 Nov 2019 01:55:10 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B08DE6F59F;
	Sat, 23 Nov 2019 00:55:07 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8A57B6F598
 for <intel-gfx@lists.freedesktop.org>; Sat, 23 Nov 2019 00:55:03 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Nov 2019 16:55:02 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,231,1571727600"; d="scan'208";a="219643995"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.98.40.73])
 by orsmga002.jf.intel.com with ESMTP; 22 Nov 2019 16:55:02 -0800
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 22 Nov 2019 16:54:55 -0800
Message-Id: <20191123005459.155383-3-jose.souza@intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191123005459.155383-1-jose.souza@intel.com>
References: <20191123005459.155383-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/7] drm/i915/tgl: Select master trasconder for
 MST stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gVEdMIHRoZSBibGVuZGluZyBvZiBhbGwgdGhlIHN0cmVhbXMgaGF2ZSBtb3ZlZCBmcm9tIERE
SSB0bwp0cmFuc2NvZGVyLCBzbyBub3cgZXZlcnkgdHJhbnNjb2RlciB3b3JraW5nIG92ZXIgdGhl
IHNhbWUgTVNUIHBvcnQgbXVzdApzZW5kIGl0cyBzdHJlYW0gdG8gYSBtYXN0ZXIgdHJhbnNjb2Rl
ciBhbmQgbWFzdGVyIHdpbGwgc2VuZCB0byBEREkKcmVzcGVjdGluZyB0aGUgdGltZSBzbG90cy4K
CkEgcHJldmlvdXMgYXBwcm9hY2ggd2FzIHVzaW5nIHRoZSBsb3dlc3QgcGlwZS90cmFuc2NvZGVy
IGFzIG1hc3Rlcgp0cmFuc2NvZGVyIGJ1dCBhcyB0aGUgY29tbWVudCBpbiBza2xfY29tbWl0X21v
ZGVzZXRfZW5hYmxlcygpIHN0YXRlcywKdGhhdCBpcyBub3QgYWx3YXlzIHRydWUuCgpTbyBoZXJl
IHByb21vdGluZyB0aGUgZmlyc3QgcGlwZS90cmFuc2NvZGVyIG9mIHRoZSBzdHJlYW0gYXMgbWFz
dGVyLgpUaGF0IGNhdXNlZCBzZXZlcmFsIG90aGVyIHByb2JsZW1zIGFzIGR1cmluZyB0aGUgY29t
bWl0IHBoYXNlIHRoZQpzdGF0ZSBjb21wdXRlZCBzaG91bGQgbm90IGJlIGNoYW5nZWQuCgpTbyB0
aGUgbWFzdGVyIHRyYW5zY29kZXIgaXMgc3RvcmUgaW50byBpbnRlbF9kcCBhbmQgdGhlIG1vZGVz
ZXQgaW4Kc2xhdmUgcGlwZXMvdHJhbnNjb2RlcnMgaXMgZm9yY2VkIHVzaW5nIG1zdF9tYXN0ZXJf
dHJhbnNfcGVuZGluZy4KCnYyOgotIGFkZGVkIG1pc3NpbmcgY29uZmlnIGNvbXB1dGUgdG8gdHJp
Z2dlciBmdWxsbW9kZXNldCBpbiBzbGF2ZQp0cmFuc2NvZGVycwoKQlNwZWM6IDUwNDkzCkJTcGVj
OiA0OTE5MApDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNv
bT4KQ2M6IEx1Y2FzIERlIE1hcmNoaSA8bHVjYXMuZGVtYXJjaGlAaW50ZWwuY29tPgpTaWduZWQt
b2ZmLWJ5OiBKb3PDqSBSb2JlcnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAgfCAgMTAgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICA1OCArKysr
KystCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDMg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgIHwgICAxICsK
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMgICB8IDE0OSArKysr
KysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0
LmggICB8ICAgMiArCiA2IGZpbGVzIGNoYW5nZWQsIDIxNiBpbnNlcnRpb25zKCspLCA3IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IGE5
NzY2MDZkMjFjNy4uZDJmMGQzOTNkM2VlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGRpLmMKQEAgLTM1LDYgKzM1LDcgQEAKICNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5
cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxfZHAuaCIKICNpbmNsdWRlICJpbnRlbF9kcF9saW5rX3Ry
YWluaW5nLmgiCisjaW5jbHVkZSAiaW50ZWxfZHBfbXN0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZHBp
b19waHkuaCIKICNpbmNsdWRlICJpbnRlbF9kc2kuaCIKICNpbmNsdWRlICJpbnRlbF9maWZvX3Vu
ZGVycnVuLmgiCkBAIC0xOTAzLDggKzE5MDQsMTMgQEAgaW50ZWxfZGRpX3RyYW5zY29kZXJfZnVu
Y19yZWdfdmFsX2dldChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IAkJdGVtcCB8PSBUUkFOU19ERElfTU9ERV9TRUxFQ1RfRFBfTVNUOwogCQl0ZW1wIHw9IERESV9Q
T1JUX1dJRFRIKGNydGNfc3RhdGUtPmxhbmVfY291bnQpOwogCi0JCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEyKQotCQkJdGVtcCB8PSBUUkFOU19ERElfTVNUX1RSQU5TUE9SVF9TRUxFQ1Qo
Y3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIpOworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMikgeworCQkJZW51bSB0cmFuc2NvZGVyIG1hc3RlcjsKKworCQkJbWFzdGVyID0gaW50ZWxf
ZHBfbXN0X21hc3Rlcl90cmFuc19nZXQoZW5jb2Rlcik7CisJCQlXQVJOX09OKG1hc3RlciA9PSBJ
TlZBTElEX1RSQU5TQ09ERVIpOworCQkJdGVtcCB8PSBUUkFOU19ERElfTVNUX1RSQU5TUE9SVF9T
RUxFQ1QobWFzdGVyKTsKKwkJfQogCX0gZWxzZSB7CiAJCXRlbXAgfD0gVFJBTlNfRERJX01PREVf
U0VMRUNUX0RQX1NTVDsKIAkJdGVtcCB8PSBERElfUE9SVF9XSURUSChjcnRjX3N0YXRlLT5sYW5l
X2NvdW50KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
aW5kZXggODAxYjk3NWM3ZDM5Li4zNWE1OTEwODE5NGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC00Niw2ICs0Niw3IEBACiAjaW5jbHVkZSAi
ZGlzcGxheS9pbnRlbF9jcnQuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2RkaS5oIgogI2lu
Y2x1ZGUgImRpc3BsYXkvaW50ZWxfZHAuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2RwX21z
dC5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHNpLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9p
bnRlbF9kdm8uaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2dtYnVzLmgiCkBAIC01MzY1LDYg
KzUzNjYsMzYgQEAgaW50ZWxfZ2V0X2NydGNfbmV3X2VuY29kZXIoY29uc3Qgc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJcmV0dXJuIGVuY29kZXI7CiB9CiAKKy8qCisgKiBGaW5k
cyB0aGUgZW5jb2RlciBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIENSVEMuIFRoaXMgY2FuIG9u
bHkgYmUKKyAqIHVzZWQgd2hlbiB3ZSBrbm93IHRoYXQgdGhlIENSVEMgaXNuJ3QgZmVlZGluZyBt
dWx0aXBsZSBlbmNvZGVycyEKKyAqLworc3RhdGljIHN0cnVjdCBpbnRlbF9lbmNvZGVyICoKK2lu
dGVsX2dldF9jcnRjX29sZF9lbmNvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlLAorCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
Cit7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CisJY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rv
cl9zdGF0ZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOworCXN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0gTlVMTDsKKwlpbnQgbnVtX2VuY29kZXJzID0gMDsK
KwlpbnQgaTsKKworCWZvcl9lYWNoX29sZF9jb25uZWN0b3JfaW5fc3RhdGUoJnN0YXRlLT5iYXNl
LCBjb25uZWN0b3IsCisJCQkJCWNvbm5lY3Rvcl9zdGF0ZSwgaSkgeworCQlpZiAoY29ubmVjdG9y
X3N0YXRlLT5jcnRjICE9ICZjcnRjLT5iYXNlKQorCQkJY29udGludWU7CisKKwkJZW5jb2RlciA9
IHRvX2ludGVsX2VuY29kZXIoY29ubmVjdG9yX3N0YXRlLT5iZXN0X2VuY29kZXIpOworCQludW1f
ZW5jb2RlcnMrKzsKKwl9CisKKwlXQVJOKG51bV9lbmNvZGVycyAhPSAxLCAiJWQgZW5jb2RlcnMg
Zm9yIHBpcGUgJWNcbiIsCisJICAgICBudW1fZW5jb2RlcnMsIHBpcGVfbmFtZShjcnRjLT5waXBl
KSk7CisKKwlyZXR1cm4gZW5jb2RlcjsKK30KKwogLyoKICAqIEVuYWJsZSBQQ0ggcmVzb3VyY2Vz
IHJlcXVpcmVkIGZvciBQQ0ggcG9ydHM6CiAgKiAgIC0gUENIIFBMTHMKQEAgLTEzMzY1LDYgKzEz
Mzk2LDEyIEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmN1cnJlbnRfY29uZmlnLAogI3VuZGVmIFBJUEVfQ09ORl9DSEVDS19DT0xPUl9M
VVQKICN1bmRlZiBQSVBFX0NPTkZfUVVJUksKIAorCWlmIChmYXN0c2V0ICYmIHBpcGVfY29uZmln
LT5tc3RfbWFzdGVyX3RyYW5zX3BlbmRpbmcpIHsKKwkJRFJNX0RFQlVHX0tNUygiW0NSVEM6JWQ6
JXNdIGZhc3RzZXQgbWlzbWF0Y2ggaW4gbXN0X21hc3Rlcl90cmFuc1xuIiwKKwkJCSAgICAgIGNy
dGMtPmJhc2UuYmFzZS5pZCwgY3J0Yy0+YmFzZS5uYW1lKTsKKwkJcmV0ID0gZmFsc2U7CisJfQor
CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTQ0NDksMjIgKzE0NDg2LDM1IEBAIHN0YXRpYyB2b2lk
IGludGVsX2NvbW1pdF9tb2Rlc2V0X2Rpc2FibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCWludCBpOwogCi0JLyogT25seSBk
aXNhYmxlIHBvcnQgc3luYyBzbGF2ZXMgKi8KKwkvKiBPbmx5IGRpc2FibGUgcG9ydCBzeW5jIGFu
ZCBNU1Qgc2xhdmVzICovCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3Rh
dGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsK
IAkJaWYgKCFuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSB8fCAhY3J0Yy0+YWN0aXZlKQog
CQkJY29udGludWU7CiAKKwkJaWYgKCFpc190cmFuc19wb3J0X3N5bmNfbW9kZShuZXdfY3J0Y19z
dGF0ZSkgJiYKKwkJICAgICFpbnRlbF9jcnRjX2hhc190eXBlKG9sZF9jcnRjX3N0YXRlLCBJTlRF
TF9PVVRQVVRfRFBfTVNUKSkKKwkJCWNvbnRpbnVlOworCiAJCS8qIEluIGNhc2Ugb2YgVHJhbnNj
b2RlciBwb3J0IFN5bmMgbWFzdGVyIHNsYXZlIENSVENzIGNhbiBiZQogCQkgKiBhc3NpZ25lZCBp
biBhbnkgb3JkZXIgYW5kIHdlIG5lZWQgdG8gbWFrZSBzdXJlIHRoYXQKIAkJICogc2xhdmUgQ1JU
Q3MgYXJlIGRpc2FibGVkIGZpcnN0IGFuZCB0aGVuIG1hc3RlciBDUlRDIHNpbmNlCiAJCSAqIFNs
YXZlIHZibGFua3MgYXJlIG1hc2tlZCB0aWxsIE1hc3RlciBWYmxhbmtzLgogCQkgKi8KLQkJaWYg
KCFpc190cmFuc19wb3J0X3N5bmNfbW9kZShvbGRfY3J0Y19zdGF0ZSkpCi0JCQljb250aW51ZTsK
LQkJaWYgKGlzX3RyYW5zX3BvcnRfc3luY19tYXN0ZXIob2xkX2NydGNfc3RhdGUpKQorCQlpZiAo
aXNfdHJhbnNfcG9ydF9zeW5jX21vZGUobmV3X2NydGNfc3RhdGUpICYmCisJCSAgICBpc190cmFu
c19wb3J0X3N5bmNfbWFzdGVyKG5ld19jcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCisJCWlm
IChpbnRlbF9jcnRjX2hhc190eXBlKG9sZF9jcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFBfTVNU
KSkgeworCQkJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CisKKwkJCWVuY29kZXIgPSBp
bnRlbF9nZXRfY3J0Y19vbGRfZW5jb2RlcihzdGF0ZSwKKwkJCQkJCQkgICAgIG9sZF9jcnRjX3N0
YXRlKTsKKwkJCWlmIChpbnRlbF9kcF9tc3RfbWFzdGVyX3RyYW5zX2dldChlbmNvZGVyKSA9PQor
CQkJICAgIG9sZF9jcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcikKKwkJCQljb250aW51ZTsKKwkJ
fQorCiAJCWludGVsX3ByZV9wbGFuZV91cGRhdGUob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0
YXRlKTsKIAkJaW50ZWxfb2xkX2NydGNfc3RhdGVfZGlzYWJsZXMoc3RhdGUsIG9sZF9jcnRjX3N0
YXRlLAogCQkJCQkgICAgICBuZXdfY3J0Y19zdGF0ZSwgY3J0Yyk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IDgzZWEwNDE0
OWI3Ny4uMjNkNzQ3Y2RjYTY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApAQCAtMTA1Miw2ICsxMDUyLDggQEAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgewogCS8qIFBvaW50ZXIgdG8gbWFzdGVyIHRyYW5zY29kZXIgaW4gY2Fz
ZSBvZiB0aWxlZCBkaXNwbGF5cyAqLwogCWVudW0gdHJhbnNjb2RlciBtYXN0ZXJfdHJhbnNjb2Rl
cjsKIAorCWJvb2wgbXN0X21hc3Rlcl90cmFuc19wZW5kaW5nOworCiAJLyogQml0bWFzayB0byBp
bmRpY2F0ZSBzbGF2ZXMgYXR0YWNoZWQgKi8KIAl1OCBzeW5jX21vZGVfc2xhdmVzX21hc2s7CiB9
OwpAQCAtMTI4NCw2ICsxMjg2LDcgQEAgc3RydWN0IGludGVsX2RwIHsKIAlib29sIGNhbl9tc3Q7
IC8qIHRoaXMgcG9ydCBzdXBwb3J0cyBtc3QgKi8KIAlib29sIGlzX21zdDsKIAlpbnQgYWN0aXZl
X21zdF9saW5rczsKKwllbnVtIHRyYW5zY29kZXIgbXN0X21hc3Rlcl90cmFuc2NvZGVyOyAvKiBP
bmx5IHVzZWQgaW4gVEdMKyAqLwogCiAJLyoKIAkgKiBEUF9UUF8qIHJlZ2lzdGVycyBtYXkgYmUg
ZWl0aGVyIG9uIHBvcnQgb3IgdHJhbnNjb2RlciByZWdpc3RlciBzcGFjZS4KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwppbmRleCAzMTIzOTU4ZTIwODEuLmNlZmY2OTAxNDUx
YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtNzQyNCw2ICs3
NDI0LDcgQEAgaW50ZWxfZHBfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RpZ2l0YWxfcG9y
dCAqaW50ZWxfZGlnX3BvcnQsCiAJaW50ZWxfZHAtPnJlc2V0X2xpbmtfcGFyYW1zID0gdHJ1ZTsK
IAlpbnRlbF9kcC0+cHBzX3BpcGUgPSBJTlZBTElEX1BJUEU7CiAJaW50ZWxfZHAtPmFjdGl2ZV9w
aXBlID0gSU5WQUxJRF9QSVBFOworCWludGVsX2RwLT5tc3RfbWFzdGVyX3RyYW5zY29kZXIgPSBJ
TlZBTElEX1RSQU5TQ09ERVI7CiAKIAkvKiBQcmVzZXJ2ZSB0aGUgY3VycmVudCBodyBzdGF0ZS4g
Ki8KIAlpbnRlbF9kcC0+RFAgPSBJOTE1X1JFQUQoaW50ZWxfZHAtPm91dHB1dF9yZWcpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMKaW5kZXggZjhhMzUwMzU5
MzQ2Li45NzMxYzNjMWQzZjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHBfbXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcF9tc3QuYwpAQCAtODcsNiArODcsNDcgQEAgc3RhdGljIGludCBpbnRlbF9kcF9tc3RfY29t
cHV0ZV9saW5rX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlyZXR1cm4g
MDsKIH0KIAorc3RhdGljIGludAoraW50ZWxfZHBfbXN0X21hc3Rlcl90cmFuc19jb21wdXRlKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKnBpcGVfY29uZmlnLAorCQkJCSAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5f
c3RhdGUpCit7CisJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPSB0b19pbnRlbF9h
dG9taWNfc3RhdGUocGlwZV9jb25maWctPnVhcGkuc3RhdGUpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YzsKKwllbnVtIHRyYW5zY29kZXIgbWFzdGVyOworCWludCBpOworCisJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPCAxMikKKwkJcmV0dXJuIDA7CisKKwlpZiAoIWNvbm5fc3RhdGUtPmNydGMpCisJ
CXJldHVybiAwOworCisJbWFzdGVyID0gaW50ZWxfZHBfbXN0X21hc3Rlcl90cmFuc19nZXQoZW5j
b2Rlcik7CisJaWYgKG1hc3RlciA9PSBJTlZBTElEX1RSQU5TQ09ERVIpCisJCXJldHVybiAwOwor
CisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG5ld19jcnRj
X3N0YXRlLCBpKSB7CisJCS8qCisJCSAqIGNwdV90cmFuc2NvZGVyIGlzIHNldCB3aGVuIGNvbXB1
dGluZyBDUlRDIHN0YXRlIGlmIGl0IHdpbGwKKwkJICogYmUgZGlzYWJsZWQgaXQgd2lsbCBub3Qg
aGFwcGVuLCBzbyBjaGVja2luZyBwaXBlIGluc3RlYWQKKwkJICovCisJCWlmIChjcnRjLT5waXBl
ICE9IChlbnVtIHBpcGUpbWFzdGVyKQorCQkJY29udGludWU7CisKKwkJaWYgKCFkcm1fYXRvbWlj
X2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPnVhcGkpICYmCisJCSAgICBuZXdf
Y3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUpCisJCQljb250aW51ZTsKKworCQlwaXBlX2NvbmZpZy0+
bXN0X21hc3Rlcl90cmFuc19wZW5kaW5nID0gdHJ1ZTsKKwkJYnJlYWs7CisJfQorCisJcmV0dXJu
IDA7Cit9CisKIHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqcGlwZV9jb25maWcsCiAJCQkJICAgICAgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpj
b25uX3N0YXRlKQpAQCAtMTU0LDYgKzE5NSw5NSBAQCBzdGF0aWMgaW50IGludGVsX2RwX21zdF9j
b21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCWludGVsX2Rk
aV9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKGRldl9wcml2LCBwaXBlX2NvbmZpZyk7CiAKKwly
ZXQgPSBpbnRlbF9kcF9tc3RfbWFzdGVyX3RyYW5zX2NvbXB1dGUoZW5jb2RlciwgcGlwZV9jb25m
aWcsCisJCQkJCQljb25uX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQKK2ludGVsX2RwX21zdF9hdG9taWNfbWFzdGVyX3RyYW5z
X2NoZWNrKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgICAgIHN0cnVj
dCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICppbnRlbF9jb25uID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3Rvcik7CisJc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKm5ld19jb25uX3N0YXRlLCAqb2xkX2Nvbm5fc3RhdGU7CisJ
c3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNvbm5fbGlzdF9pdGVyOworCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICppbnRlbF9jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubl9pdGVyOworCisJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPCAxMikKKwkJcmV0dXJuIDA7CisKKwluZXdfY29ubl9zdGF0
ZSA9IGRybV9hdG9taWNfZ2V0X25ld19jb25uZWN0b3Jfc3RhdGUoc3RhdGUsIGNvbm5lY3Rvcik7
CisJb2xkX2Nvbm5fc3RhdGUgPSBkcm1fYXRvbWljX2dldF9vbGRfY29ubmVjdG9yX3N0YXRlKHN0
YXRlLCBjb25uZWN0b3IpOworCisJaWYgKCFvbGRfY29ubl9zdGF0ZS0+Y3J0YyAmJiAhbmV3X2Nv
bm5fc3RhdGUtPmNydGMpCisJCXJldHVybiAwOworCisJLyoKKwkgKiAzIGNhc2VzIHRoYXQgbmVl
ZHMgYmUgaGFuZGxlZCBoZXJlOgorCSAqIC0gY29ubmVjdG9yIGdvaW5nIGZyb20gZGlzYWJsZWQg
dG8gZW5hYmxlZAorCSAqIC0gY29ubmVjdG9yIGdvaW5nIGZyb20gZW5hYmxlZCB0byBkaXNhYmxl
ZDoKKwkgKiBpZiB0aGlzIHRyYW5zY29kZXIgd2FzIHRoZSBtYXN0ZXIsIGFsbCBzbGF2ZXMgbmVl
ZHMgYSBtb2Rlc2V0CisJICogLSBjb25uZWN0b3IgZ29pbmcgZnJvbSBlbmFibGVkIHRvIGVuYWJs
ZWQgYnV0IGl0IG5lZWRzIGEgbW9kZXNldDoKKwkgKiBpZiB0aGlzIHRyYW5zY29kZXIgd2FzIHRo
ZSBtYXN0ZXIsIGFsbCBzbGF2ZXMgYWxzbyBuZWVkcyBhIG1vZGVzZXQKKwkgKi8KKworCS8qIGRp
c2FibGVkIC0+IGVuYWJsZWQgKi8KKwlpZiAoIW9sZF9jb25uX3N0YXRlLT5jcnRjICYmIG5ld19j
b25uX3N0YXRlLT5jcnRjKQorCQlyZXR1cm4gMDsKKworCS8qIGVuYWJsZWQgLT4gZW5hYmxlZCht
b2Rlc2V0KT8gKi8KKwlpZiAobmV3X2Nvbm5fc3RhdGUtPmNydGMpIHsKKwkJY3J0Y19zdGF0ZSA9
IGRybV9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBuZXdfY29ubl9zdGF0ZS0+Y3J0
Yyk7CisJCWlmICghZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSkpCisJ
CQlyZXR1cm4gMDsKKwl9CisKKwkvKiBoYW5kbGluZyBlbmFibGVkIC0+IGVuYWJsZWQobW9kZXNl
dCkgYW5kIGVuYWJsZWQgLT4gZGlzYWJsZWQgKi8KKwljcnRjX3N0YXRlID0gZHJtX2F0b21pY19n
ZXRfb2xkX2NydGNfc3RhdGUoc3RhdGUsIG9sZF9jb25uX3N0YXRlLT5jcnRjKTsKKwlpbnRlbF9j
cnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjX3N0YXRlKTsKKworCS8qIElmIG5v
dCBtYXN0ZXIsIG5vdGhpbmcgZWxzZSBuZWVkcyB0byBiZSBoYW5kbGVkICovCisJaWYgKGludGVs
X2Nvbm4tPm1zdF9wb3J0LT5tc3RfbWFzdGVyX3RyYW5zY29kZXIgIT0KKwkgICAgaW50ZWxfY3J0
Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIpCisJCXJldHVybiAwOworCisJLyogSXMgbWFzdGVyLCBt
YXJrIGFsbCBvdGhlciBDUlRDcyBhcyBuZWVkaW5nIGEgbW9kZXNldCAqLworCWRybV9jb25uZWN0
b3JfbGlzdF9pdGVyX2JlZ2luKHN0YXRlLT5kZXYsICZjb25uX2xpc3RfaXRlcik7CisJZHJtX2Zv
cl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5faXRlciwgJmNvbm5fbGlzdF9pdGVyKSB7CisJCXN0
cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5faXRlcjsKKwkJc3RydWN0IGRybV9jb25u
ZWN0b3Jfc3RhdGUgKmNvbm5faXRlcl9zdGF0ZTsKKworCQlpbnRlbF9jb25uX2l0ZXIgPSB0b19p
bnRlbF9jb25uZWN0b3IoY29ubl9pdGVyKTsKKwkJaWYgKGludGVsX2Nvbm5faXRlci0+bXN0X3Bv
cnQgIT0gaW50ZWxfY29ubi0+bXN0X3BvcnQpCisJCQljb250aW51ZTsKKworCQljb25uX2l0ZXJf
c3RhdGUgPSBkcm1fYXRvbWljX2dldF9jb25uZWN0b3Jfc3RhdGUoc3RhdGUsCisJCQkJCQkJCSBj
b25uX2l0ZXIpOworCQlpZiAoSVNfRVJSKGNvbm5faXRlcl9zdGF0ZSkpIHsKKwkJCWRybV9jb25u
ZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9saXN0X2l0ZXIpOworCQkJcmV0dXJuIFBUUl9FUlIo
Y29ubl9pdGVyX3N0YXRlKTsKKwkJfQorCisJCWlmICghY29ubl9pdGVyX3N0YXRlLT5jcnRjKQor
CQkJY29udGludWU7CisKKwkJY3J0Y19zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2NydGNfc3RhdGUo
c3RhdGUsIGNvbm5faXRlcl9zdGF0ZS0+Y3J0Yyk7CisJCWlmIChJU19FUlIoY3J0Y19zdGF0ZSkp
IHsKKwkJCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9saXN0X2l0ZXIpOworCQkJ
cmV0dXJuIFBUUl9FUlIoY29ubl9pdGVyX3N0YXRlKTsKKwkJfQorCisJCWludGVsX2NydGNfc3Rh
dGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGNfc3RhdGUpOworCQljcnRjX3N0YXRlLT5tb2Rl
X2NoYW5nZWQgPSB0cnVlOworCX0KKwlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5f
bGlzdF9pdGVyKTsKKwogCXJldHVybiAwOwogfQogCkBAIC0xNzUsNiArMzA1LDEwIEBAIGludGVs
X2RwX21zdF9hdG9taWNfY2hlY2soc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAlp
ZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCisJcmV0ID0gaW50ZWxfZHBfbXN0X2F0b21pY19tYXN0
ZXJfdHJhbnNfY2hlY2soY29ubmVjdG9yLCBzdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKKwogCWlmICghb2xkX2Nvbm5fc3RhdGUtPmNydGMpCiAJCXJldHVybiAwOwogCkBAIC0yNTks
NiArMzkzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbXN0X3Bvc3RfZGlzYWJsZV9kcChzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJaW50ZWxfZHBfc2lua19kcG1zKGludGVsX2RwLCBE
Uk1fTU9ERV9EUE1TX09GRik7CiAJCWludGVsX2RpZ19wb3J0LT5iYXNlLnBvc3RfZGlzYWJsZSgm
aW50ZWxfZGlnX3BvcnQtPmJhc2UsCiAJCQkJCQkgIG9sZF9jcnRjX3N0YXRlLCBOVUxMKTsKKwkJ
aW50ZWxfZHAtPm1zdF9tYXN0ZXJfdHJhbnNjb2RlciA9IElOVkFMSURfVFJBTlNDT0RFUjsKIAl9
CiAKIAlEUk1fREVCVUdfS01TKCJhY3RpdmUgbGlua3MgJWRcbiIsIGludGVsX2RwLT5hY3RpdmVf
bXN0X2xpbmtzKTsKQEAgLTMxNCw4ICs0NDksMTEgQEAgc3RhdGljIHZvaWQgaW50ZWxfbXN0X3By
ZV9lbmFibGVfZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlEUk1fREVCVUdf
S01TKCJhY3RpdmUgbGlua3MgJWRcbiIsIGludGVsX2RwLT5hY3RpdmVfbXN0X2xpbmtzKTsKIAot
CWlmIChmaXJzdF9tc3Rfc3RyZWFtKQorCWlmIChmaXJzdF9tc3Rfc3RyZWFtKSB7CisJCVdBUk5f
T04oaW50ZWxfZHAtPm1zdF9tYXN0ZXJfdHJhbnNjb2RlciAhPSBJTlZBTElEX1RSQU5TQ09ERVIp
OworCQlpbnRlbF9kcC0+bXN0X21hc3Rlcl90cmFuc2NvZGVyID0gcGlwZV9jb25maWctPmNwdV90
cmFuc2NvZGVyOwogCQlpbnRlbF9kcF9zaW5rX2RwbXMoaW50ZWxfZHAsIERSTV9NT0RFX0RQTVNf
T04pOworCX0KIAogCWRybV9kcF9zZW5kX3Bvd2VyX3VwZG93bl9waHkoJmludGVsX2RwLT5tc3Rf
bWdyLCBjb25uZWN0b3ItPnBvcnQsIHRydWUpOwogCkBAIC03MTcsMyArODU1LDEyIEBAIGludGVs
X2RwX21zdF9lbmNvZGVyX2NsZWFudXAoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxf
ZGlnX3BvcnQpCiAJZHJtX2RwX21zdF90b3BvbG9neV9tZ3JfZGVzdHJveSgmaW50ZWxfZHAtPm1z
dF9tZ3IpOwogCS8qIGVuY29kZXJzIHdpbGwgZ2V0IGtpbGxlZCBieSBub3JtYWwgY2xlYW51cCAq
LwogfQorCitlbnVtIHRyYW5zY29kZXIKK2ludGVsX2RwX21zdF9tYXN0ZXJfdHJhbnNfZ2V0KHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQoreworCXN0cnVjdCBpbnRlbF9kcF9tc3RfZW5j
b2RlciAqaW50ZWxfbXN0ID0gZW5jX3RvX21zdCgmZW5jb2Rlci0+YmFzZSk7CisJc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCA9ICZpbnRlbF9tc3QtPnByaW1hcnktPmRwOworCisJcmV0dXJuIGlu
dGVsX2RwLT5tc3RfbWFzdGVyX3RyYW5zY29kZXI7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcF9tc3QuaAppbmRleCBmNjYwYWQ4MGRiMDQuLmU2ZjI4YTUxNzE4MiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5oCkBAIC03LDkg
KzcsMTEgQEAKICNkZWZpbmUgX19JTlRFTF9EUF9NU1RfSF9fCiAKIHN0cnVjdCBpbnRlbF9kaWdp
dGFsX3BvcnQ7CitzdHJ1Y3QgaW50ZWxfZW5jb2RlcjsKIAogaW50IGludGVsX2RwX21zdF9lbmNv
ZGVyX2luaXQoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsIGludCBj
b25uX2lkKTsKIHZvaWQgaW50ZWxfZHBfbXN0X2VuY29kZXJfY2xlYW51cChzdHJ1Y3QgaW50ZWxf
ZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCk7CiBpbnQgaW50ZWxfZHBfbXN0X2VuY29kZXJf
YWN0aXZlX2xpbmtzKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0KTsK
K2VudW0gdHJhbnNjb2RlciBpbnRlbF9kcF9tc3RfbWFzdGVyX3RyYW5zX2dldChzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2Rlcik7CiAKICNlbmRpZiAvKiBfX0lOVEVMX0RQX01TVF9IX18gKi8K
LS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

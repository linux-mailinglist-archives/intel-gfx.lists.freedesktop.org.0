Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1901B310CAB
	for <lists+intel-gfx@lfdr.de>; Fri,  5 Feb 2021 15:49:04 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6EC736F454;
	Fri,  5 Feb 2021 14:49:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A317F6F454
 for <intel-gfx@lists.freedesktop.org>; Fri,  5 Feb 2021 14:49:00 +0000 (UTC)
IronPort-SDR: UZR3LR3SIQFMwLkExuI78FVLtyHsKZ3LRPvfXFjp0WWmhW2kDK3Kho1a1VA/LsTP+j3VKe4+eC
 ZbaG8KX3mYRg==
X-IronPort-AV: E=McAfee;i="6000,8403,9885"; a="169116196"
X-IronPort-AV: E=Sophos;i="5.81,155,1610438400"; d="scan'208";a="169116196"
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga106.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 05 Feb 2021 06:48:59 -0800
IronPort-SDR: +9yqWQyJT2hukGKqNb8Y9sDnbPbUN/m1G5xx1gVXmvr26lEaBmkDBV9SJ4eaeyIQWkX+L6n4I/
 nZzLbesEmPSw==
X-IronPort-AV: E=Sophos;i="5.81,155,1610438400"; d="scan'208";a="393895627"
Received: from fuhrberg-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.252.33.102])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 05 Feb 2021 06:48:54 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  5 Feb 2021 16:48:36 +0200
Message-Id: <4e88a5c6b9ab3b93cc2b6c7d78c26ae86f6abbd0.1612536383.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1612536383.git.jani.nikula@intel.com>
References: <cover.1612536383.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v12 1/8] drm/i915: migrate skl planes code new
 file (v5)
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Dave Airlie <airlied@redhat.com>,
 Dan Carpenter <dan.carpenter@oracle.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClJld29yayB0aGUgcGxhbmUg
aW5pdCBjYWxscyB0byBkbyB0aGUgZ2VuIHRlc3Qgb25lIGxldmVsIGhpZ2hlci4KClJld29yayBz
b21lIG9mIHRoZSBwbGFuZSBoZWxwZXJzIHNvIHRoZXkgY2FuIGxpdmUgaW4gbmV3IGZpbGUsCnRo
ZXJlIGlzIHN0aWxsIHNvbWUgc2NvcGUgdG8gY2xlYW4gdXAgdGhlIHBsYW5lL2ZiIGludGVyYWN0
aW9ucwpsYXRlci4KCnYyOiBkcm9wIGF0b21pYyBjb2RlIGJhY2ssIHJlbmFtZSBmaWxlIHRvIFZp
bGxlIHN1Z2dlc3Rpb25zLAphZGQgaGVhZGVyIGZpbGUuCnYzOiBtb3ZlIHNjYWxlciBiaXRzIGJh
Y2sKdjQ6IGRyb3Agd3JvbmcgbmV3IGluY2x1ZGVzIChWaWxsZSkKdjU6IGludGVncmF0ZSB0aGUg
Y2NzIGdlbjEyIGNoYW5nZXMKdjY6IGZpeCB1bnJlbGF0ZWQgY29kZSBtb3ZlbWVudCAoVmlsbGUp
CgpTaWduZWQtb2ZmLWJ5OiBEYXZlIEFpcmxpZSA8YWlybGllZEByZWRoYXQuY29tPgpbSmFuaTog
Zml4ZWQgdXAgc3BhcnNlIHdhcm5pbmdzLl0KU2lnbmVkLW9mZi1ieTogSmFuaSBOaWt1bGEgPGph
bmkubmlrdWxhQGludGVsLmNvbT4KUmVwb3J0ZWQtYnk6IGtlcm5lbCB0ZXN0IHJvYm90IDxsa3BA
aW50ZWwuY29tPgpSZXBvcnRlZC1ieTogRGFuIENhcnBlbnRlciA8ZGFuLmNhcnBlbnRlckBvcmFj
bGUuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgICAg
ICB8ICAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9wbGFuZS5jICAg
ICB8ICAgIDQgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMgICAgICAg
IHwgICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydGMuYyAgICAg
fCAgIDEzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAg
fCAgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8
ICA5NDggKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmggIHwgICAyNyArLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5o
ICAgIHwgICAyNyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jICAg
ICAgfCAgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMg
ICB8IDEzNDMgKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9z
cHJpdGUuaCAgIHwgICAgNiArLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9w
bGFuZS5jICAgIHwgMjI2NSArKysrKysrKysrKysrKysrKwogLi4uL2RybS9pOTE1L2Rpc3BsYXkv
c2tsX3VuaXZlcnNhbF9wbGFuZS5oICAgIHwgICAzMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jICAgICAgICAgICAgICAgfCAgICAxICsKIDE0IGZpbGVzIGNoYW5nZWQsIDIzODAg
aW5zZXJ0aW9ucygrKSwgMjI5MyBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuYwogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFu
ZS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCBkNTcxZTg3NDE2ZGMuLjkzODhlMDkxODRmZSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTIyNSw3ICsyMjUsOCBAQCBpOTE1LXkgKz0gXAogCWRp
c3BsYXkvaW50ZWxfc3ByaXRlLm8gXAogCWRpc3BsYXkvaW50ZWxfdGMubyBcCiAJZGlzcGxheS9p
bnRlbF92Z2EubyBcCi0JZGlzcGxheS9pOXh4X3BsYW5lLm8KKwlkaXNwbGF5L2k5eHhfcGxhbmUu
byBcCisJZGlzcGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLm8KIGk5MTUtJChDT05GSUdfQUNQSSkg
Kz0gXAogCWRpc3BsYXkvaW50ZWxfYWNwaS5vIFwKIAlkaXNwbGF5L2ludGVsX29wcmVnaW9uLm8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9wbGFuZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pOXh4X3BsYW5lLmMKaW5kZXggZDMwMzc0ZGY2
N2YwLi5kMTE2ZGVlMjAxYWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaTl4eF9wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9w
bGFuZS5jCkBAIC03NDMsMTAgKzc0Myw2IEBAIGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJaW50IG51
bV9mb3JtYXRzOwogCWludCByZXQsIHpwb3M7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA5KQotCQlyZXR1cm4gc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoZGV2X3ByaXYsIHBpcGUs
Ci0JCQkJCQkgIFBMQU5FX1BSSU1BUlkpOwotCiAJcGxhbmUgPSBpbnRlbF9wbGFuZV9hbGxvYygp
OwogCWlmIChJU19FUlIocGxhbmUpKQogCQlyZXR1cm4gcGxhbmU7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaWNsX2RzaS5jCmluZGV4IDlkMjQ1YTY4OTMyMy4uOWVlZWM2ZmFkZWM3IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYwpAQCAtMzUsNiArMzUsNyBAQAogI2lu
Y2x1ZGUgImludGVsX2RzaS5oIgogI2luY2x1ZGUgImludGVsX3BhbmVsLmgiCiAjaW5jbHVkZSAi
aW50ZWxfdmRzYy5oIgorI2luY2x1ZGUgInNrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogc3RhdGlj
IGludCBoZWFkZXJfY3JlZGl0c19hdmFpbGFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCQkJCSAgICBlbnVtIHRyYW5zY29kZXIgZHNpX3RyYW5zKQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnRjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydGMuYwppbmRleCA1N2IwYTNlYmU5MDguLmViNDc4NzEy
YzM4MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnRj
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnRjLmMKQEAgLTIw
LDYgKzIwLDcgQEAKICNpbmNsdWRlICJpbnRlbF9waXBlX2NyYy5oIgogI2luY2x1ZGUgImludGVs
X3Nwcml0ZS5oIgogI2luY2x1ZGUgImk5eHhfcGxhbmUuaCIKKyNpbmNsdWRlICJza2xfdW5pdmVy
c2FsX3BsYW5lLmgiCiAKIHN0YXRpYyB2b2lkIGFzc2VydF92YmxhbmtfZGlzYWJsZWQoc3RydWN0
IGRybV9jcnRjICpjcnRjKQogewpAQCAtMjQzLDcgKzI0NCwxMSBAQCBpbnQgaW50ZWxfY3J0Y19p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJ
Y3J0Yy0+cGlwZSA9IHBpcGU7CiAJY3J0Yy0+bnVtX3NjYWxlcnMgPSBSVU5USU1FX0lORk8oZGV2
X3ByaXYpLT5udW1fc2NhbGVyc1twaXBlXTsKIAotCXByaW1hcnkgPSBpbnRlbF9wcmltYXJ5X3Bs
YW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSk7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSkKKwkJcHJpbWFyeSA9IHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBl
LAorCQkJCQkJICAgICBQTEFORV9QUklNQVJZKTsKKwllbHNlCisJCXByaW1hcnkgPSBpbnRlbF9w
cmltYXJ5X3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSk7CiAJaWYgKElTX0VSUihwcmltYXJ5
KSkgewogCQlyZXQgPSBQVFJfRVJSKHByaW1hcnkpOwogCQlnb3RvIGZhaWw7CkBAIC0yNTMsNyAr
MjU4LDExIEBAIGludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKIAlmb3JfZWFjaF9zcHJpdGUoZGV2X3ByaXYsIHBpcGUs
IHNwcml0ZSkgewogCQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCi0JCXBsYW5lID0gaW50
ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSwgc3ByaXRlKTsKKwkJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwkJCXBsYW5lID0gc2tsX3VuaXZlcnNhbF9wbGFuZV9j
cmVhdGUoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQkJICAgUExBTkVfU1BSSVRFMCArIHNwcml0ZSk7
CisJCWVsc2UKKwkJCXBsYW5lID0gaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwg
cGlwZSwgc3ByaXRlKTsKIAkJaWYgKElTX0VSUihwbGFuZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIo
cGxhbmUpOwogCQkJZ290byBmYWlsOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMKaW5kZXggMjg4NzdhMzFhZGMwLi5mNDc0NmMxZWRhYmUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtNTQsNiArNTQsNyBAQAogI2luY2x1ZGUgImlu
dGVsX3RjLmgiCiAjaW5jbHVkZSAiaW50ZWxfdmRzYy5oIgogI2luY2x1ZGUgImludGVsX3Zyci5o
IgorI2luY2x1ZGUgInNrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogc3RhdGljIGNvbnN0IHU4IGlu
ZGV4X3RvX2RwX3NpZ25hbF9sZXZlbHNbXSA9IHsKIAlbMF0gPSBEUF9UUkFJTl9WT0xUQUdFX1NX
SU5HX0xFVkVMXzAgfCBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8wLApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA5MmMxNGYzZjBhYmYuLmEyNTlj
YTU0MzNmNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMKQEAgLTk0LDYgKzk0LDcgQEAKICNpbmNsdWRlICJpbnRlbF90Yy5oIgogI2luY2x1ZGUgImlu
dGVsX3ZnYS5oIgogI2luY2x1ZGUgImk5eHhfcGxhbmUuaCIKKyNpbmNsdWRlICJza2xfdW5pdmVy
c2FsX3BsYW5lLmgiCiAKIHN0YXRpYyB2b2lkIGk5eHhfY3J0Y19jbG9ja19nZXQoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiAJCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmln
KTsKQEAgLTExNiw3ICsxMTcsNiBAQCBzdGF0aWMgdm9pZCB2bHZfcHJlcGFyZV9wbGwoc3RydWN0
IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnKTsKIHN0YXRpYyB2b2lkIGNodl9wcmVwYXJlX3BsbChzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIAkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcpOwotc3RhdGljIHZvaWQgc2tsX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHN0YXRpYyB2b2lkIGlsa19wZml0X2VuYWJsZShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiBzdGF0aWMgdm9pZCBpbnRl
bF9tb2Rlc2V0X3NldHVwX2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSBz
dHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCk7CkBAIC0xMDgyLDMyICsxMDgyLDYg
QEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF90aWxlX3NpemUoY29uc3Qgc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBJU19HRU4oZGV2X3ByaXYsIDIpID8gMjA0
OCA6IDQwOTY7CiB9CiAKLXN0YXRpYyBib29sIGlzX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQotewotCWlmICghaXNfY2NzX21vZGlmaWVyKGZi
LT5tb2RpZmllcikpCi0JCXJldHVybiBmYWxzZTsKLQotCXJldHVybiBwbGFuZSA+PSBmYi0+Zm9y
bWF0LT5udW1fcGxhbmVzIC8gMjsKLX0KLQotc3RhdGljIGJvb2wgaXNfZ2VuMTJfY2NzX21vZGlm
aWVyKHU2NCBtb2RpZmllcikKLXsKLQlyZXR1cm4gbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9E
X1lfVElMRURfR0VOMTJfUkNfQ0NTIHx8Ci0JICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQyB8fAotCSAgICAgICBtb2RpZmllciA9PSBJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M7Ci19Ci0KLXN0YXRpYyBib29sIGlzX2dl
bjEyX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5l
KQotewotCXJldHVybiBpc19nZW4xMl9jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAmJiBpc19j
Y3NfcGxhbmUoZmIsIHBsYW5lKTsKLX0KLQotc3RhdGljIGJvb2wgaXNfZ2VuMTJfY2NzX2NjX3Bs
YW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCi17Ci0JcmV0
dXJuIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1Nf
Q0MgJiYKLQkgICAgICAgcGxhbmUgPT0gMjsKLX0KLQogc3RhdGljIGJvb2wgaXNfYXV4X3BsYW5l
KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCiB7CiAJaWYgKGlz
X2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQpAQCAtMTExNiwzOCArMTA5MCw2IEBAIHN0YXRp
YyBib29sIGlzX2F1eF9wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50
IHBsYW5lKQogCXJldHVybiBwbGFuZSA9PSAxOwogfQogCi1zdGF0aWMgaW50IG1haW5fdG9fY2Nz
X3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkK
LXsKLQlkcm1fV0FSTl9PTihmYi0+ZGV2LCAhaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikg
fHwKLQkJICAgIChtYWluX3BsYW5lICYmIG1haW5fcGxhbmUgPj0gZmItPmZvcm1hdC0+bnVtX3Bs
YW5lcyAvIDIpKTsKLQotCXJldHVybiBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMiArIG1haW5f
cGxhbmU7Ci19Ci0KLXN0YXRpYyBpbnQgY2NzX3RvX21haW5fcGxhbmUoY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUpCi17Ci0JZHJtX1dBUk5fT04oZmItPmRl
diwgIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpIHx8Ci0JCSAgICBjY3NfcGxhbmUgPCBm
Yi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMik7Ci0KLQlpZiAoaXNfZ2VuMTJfY2NzX2NjX3BsYW5l
KGZiLCBjY3NfcGxhbmUpKQotCQlyZXR1cm4gMDsKLQotCXJldHVybiBjY3NfcGxhbmUgLSBmYi0+
Zm9ybWF0LT5udW1fcGxhbmVzIC8gMjsKLX0KLQotaW50IGludGVsX21haW5fdG9fYXV4X3BsYW5l
KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkKLXsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZmItPmRldik7Ci0KLQlpZiAo
aXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCi0JCXJldHVybiBtYWluX3RvX2Njc19wbGFu
ZShmYiwgbWFpbl9wbGFuZSk7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpIDwgMTEgJiYKLQkJ
IGludGVsX2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQsIGZiLT5tb2Rp
ZmllcikpCi0JCXJldHVybiAxOwotCWVsc2UKLQkJcmV0dXJuIDA7Ci19Ci0KIGJvb2wKIGludGVs
X2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2lu
Zm8gKmluZm8sCiAJCQkJICAgIHU2NCBtb2RpZmllcikKQEAgLTExNjMsNyArMTEwNSw3IEBAIHN0
YXRpYyBib29sIGlzX3NlbWlwbGFuYXJfdXZfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsCiAJICAgICAgIGNvbG9yX3BsYW5lID09IDE7CiB9CiAKLXN0YXRpYyB1bnNpZ25l
ZCBpbnQKK3Vuc2lnbmVkIGludAogaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZmItPmRldik7CkBAIC0xMjE3LDcgKzExNTks
NyBAQCBpbnRlbF90aWxlX3dpZHRoX2J5dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLCBpbnQgY29sb3JfcGxhbmUpCiAJfQogfQogCi1zdGF0aWMgdW5zaWduZWQgaW50Cit1bnNp
Z25lZCBpbnQKIGludGVsX3RpbGVfaGVpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLCBpbnQgY29sb3JfcGxhbmUpCiB7CiAJaWYgKGlzX2dlbjEyX2Njc19wbGFuZShmYiwgY29s
b3JfcGxhbmUpKQpAQCAtMTMyMiw4ICsxMjY0LDggQEAgc3RhdGljIGJvb2wgaGFzX2FzeW5jX2Zs
aXBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybiBJTlRFTF9HRU4oaTkx
NSkgPj0gNTsKIH0KIAotc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9zdXJmX2FsaWdubWVudChj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkJIGludCBjb2xvcl9wbGFuZSkK
K3Vuc2lnbmVkIGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwKKwkJCQkgIGludCBjb2xvcl9wbGFuZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGZiLT5kZXYpOwogCkBAIC0xNTkwLDEwICsxNTMy
LDEwIEBAIHN0YXRpYyB1MzIgaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50
ICp5LAogICogQWRqdXN0IHRoZSB0aWxlIG9mZnNldCBieSBtb3ZpbmcgdGhlIGRpZmZlcmVuY2Ug
aW50bwogICogdGhlIHgveSBvZmZzZXRzLgogICovCi1zdGF0aWMgdTMyIGludGVsX3BsYW5lX2Fk
anVzdF9hbGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKLQkJCQkJICAgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnN0YXRlLAotCQkJCQkgICAgIGludCBjb2xvcl9wbGFuZSwK
LQkJCQkJICAgICB1MzIgb2xkX29mZnNldCwgdTMyIG5ld19vZmZzZXQpCit1MzIgaW50ZWxfcGxh
bmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAorCQkJCSAgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsCisJCQkJICAgICAgaW50IGNvbG9yX3Bs
YW5lLAorCQkJCSAgICAgIHUzMiBvbGRfb2Zmc2V0LCB1MzIgbmV3X29mZnNldCkKIHsKIAlyZXR1
cm4gaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KHgsIHksIHN0YXRlLT5ody5mYiwgY29sb3Jf
cGxhbmUsCiAJCQkJCSAgIHN0YXRlLT5ody5yb3RhdGlvbiwKQEAgLTE4OTIsNyArMTgzNCw3IEBA
IGJvb2wgaXNfY2NzX21vZGlmaWVyKHU2NCBtb2RpZmllcikKIAogc3RhdGljIGludCBnZW4xMl9j
Y3NfYXV4X3N0cmlkZShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFuZSkK
IHsKLQlyZXR1cm4gRElWX1JPVU5EX1VQKGZiLT5waXRjaGVzW2Njc190b19tYWluX3BsYW5lKGZi
LCBjY3NfcGxhbmUpXSwKKwlyZXR1cm4gRElWX1JPVU5EX1VQKGZiLT5waXRjaGVzW3NrbF9jY3Nf
dG9fbWFpbl9wbGFuZShmYiwgY2NzX3BsYW5lKV0sCiAJCQkgICAgNTEyKSAqIDY0OwogfQogCkBA
IC0yMDUwLDcgKzE5OTIsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9uZWVkc19yZW1hcChj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXJldHVybiBzdHJp
ZGUgPiBtYXhfc3RyaWRlOwogfQogCi1zdGF0aWMgdm9pZAordm9pZAogaW50ZWxfZmJfcGxhbmVf
Z2V0X3N1YnNhbXBsaW5nKGludCAqaHN1YiwgaW50ICp2c3ViLAogCQkJICAgICAgIGNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSkKQEAg
LTIwNzUsNyArMjAxNyw3IEBAIGludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1wbGluZyhpbnQgKmhz
dWIsIGludCAqdnN1YiwKIAkJcmV0dXJuOwogCX0KIAotCW1haW5fcGxhbmUgPSBjY3NfdG9fbWFp
bl9wbGFuZShmYiwgY29sb3JfcGxhbmUpOworCW1haW5fcGxhbmUgPSBza2xfY2NzX3RvX21haW5f
cGxhbmUoZmIsIGNvbG9yX3BsYW5lKTsKIAkqaHN1YiA9IGRybV9mb3JtYXRfaW5mb19ibG9ja193
aWR0aChmYi0+Zm9ybWF0LCBjb2xvcl9wbGFuZSkgLwogCQlkcm1fZm9ybWF0X2luZm9fYmxvY2tf
d2lkdGgoZmItPmZvcm1hdCwgbWFpbl9wbGFuZSk7CiAKQEAgLTIxMTUsNyArMjA1Nyw3IEBAIGlu
dGVsX2ZiX2NoZWNrX2Njc194eShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19w
bGFuZSwgaW50IHgsIGludCB5KQogCWNjc194ID0gKHggKiBoc3ViKSAlIHRpbGVfd2lkdGg7CiAJ
Y2NzX3kgPSAoeSAqIHZzdWIpICUgdGlsZV9oZWlnaHQ7CiAKLQltYWluX3BsYW5lID0gY2NzX3Rv
X21haW5fcGxhbmUoZmIsIGNjc19wbGFuZSk7CisJbWFpbl9wbGFuZSA9IHNrbF9jY3NfdG9fbWFp
bl9wbGFuZShmYiwgY2NzX3BsYW5lKTsKIAltYWluX3ggPSBpbnRlbF9mYi0+bm9ybWFsW21haW5f
cGxhbmVdLnggJSB0aWxlX3dpZHRoOwogCW1haW5feSA9IGludGVsX2ZiLT5ub3JtYWxbbWFpbl9w
bGFuZV0ueSAlIHRpbGVfaGVpZ2h0OwogCkBAIC0yMTQxLDcgKzIwODMsNyBAQCBzdGF0aWMgdm9p
ZAogaW50ZWxfZmJfcGxhbmVfZGltcyhpbnQgKncsIGludCAqaCwgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIHsKIAlpbnQgbWFpbl9wbGFuZSA9IGlzX2Njc19w
bGFuZShmYiwgY29sb3JfcGxhbmUpID8KLQkJCSBjY3NfdG9fbWFpbl9wbGFuZShmYiwgY29sb3Jf
cGxhbmUpIDogMDsKKwkJCSBza2xfY2NzX3RvX21haW5fcGxhbmUoZmIsIGNvbG9yX3BsYW5lKSA6
IDA7CiAJaW50IG1haW5faHN1YiwgbWFpbl92c3ViOwogCWludCBoc3ViLCB2c3ViOwogCkBAIC0y
NTI4LDczICsyNDcwLDYgQEAgc3RhdGljIGludCBpOXh4X2Zvcm1hdF90b19mb3VyY2MoaW50IGZv
cm1hdCkKIAl9CiB9CiAKLWludCBza2xfZm9ybWF0X3RvX2ZvdXJjYyhpbnQgZm9ybWF0LCBib29s
IHJnYl9vcmRlciwgYm9vbCBhbHBoYSkKLXsKLQlzd2l0Y2ggKGZvcm1hdCkgewotCWNhc2UgUExB
TkVfQ1RMX0ZPUk1BVF9SR0JfNTY1OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9SR0I1NjU7Ci0JY2Fz
ZSBQTEFORV9DVExfRk9STUFUX05WMTI6Ci0JCXJldHVybiBEUk1fRk9STUFUX05WMTI7Ci0JY2Fz
ZSBQTEFORV9DVExfRk9STUFUX1hZVVY6Ci0JCXJldHVybiBEUk1fRk9STUFUX1hZVVY4ODg4Owot
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEwOwot
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDEyOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEyOwot
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDE2OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDE2Owot
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEwOwot
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjEyOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEyOwot
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjE2OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjE2Owot
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9YVllVMjEw
MTAxMDsKLQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWTQxMjoKLQkJcmV0dXJuIERSTV9GT1JNQVRf
WFZZVTEyXzE2MTYxNjE2OwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OgotCQlyZXR1cm4g
RFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY7Ci0JZGVmYXVsdDoKLQljYXNlIFBMQU5FX0NUTF9GT1JN
QVRfWFJHQl84ODg4OgotCQlpZiAocmdiX29yZGVyKSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0
dXJuIERSTV9GT1JNQVRfQUJHUjg4ODg7Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRf
WEJHUjg4ODg7Ci0JCX0gZWxzZSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JN
QVRfQVJHQjg4ODg7Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjg4ODg7Ci0J
CX0KLQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwOgotCQlpZiAocmdiX29yZGVy
KSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA7Ci0J
CQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA7Ci0JCX0gZWxzZSB7Ci0J
CQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA7Ci0JCQllbHNl
Ci0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA7Ci0JCX0KLQljYXNlIFBMQU5FX0NU
TF9GT1JNQVRfWFJHQl8xNjE2MTYxNkY6Ci0JCWlmIChyZ2Jfb3JkZXIpIHsKLQkJCWlmIChhbHBo
YSkKLQkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOwotCQkJZWxzZQotCQkJCXJl
dHVybiBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY7Ci0JCX0gZWxzZSB7Ci0JCQlpZiAoYWxwaGEp
Ci0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjsKLQkJCWVsc2UKLQkJCQlyZXR1
cm4gRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGOwotCQl9Ci0JfQotfQotCiBzdGF0aWMgc3RydWN0
IGk5MTVfdm1hICoKIGluaXRpYWxfcGxhbmVfdm1hKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkgIHN0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyAqcGxhbmVfY29uZmln
KQpAQCAtMjg5OSw1MiArMjc3NCw2IEBAIGludGVsX2ZpbmRfaW5pdGlhbF9wbGFuZV9vYmooc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJCSAgJnRvX2ludGVsX2Zyb250YnVmZmVyKGZi
KS0+Yml0cyk7CiB9CiAKLQotc3RhdGljIGJvb2wKLXNrbF9jaGVja19tYWluX2Njc19jb29yZGlu
YXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAotCQkJICAgICAgIGlu
dCBtYWluX3gsIGludCBtYWluX3ksIHUzMiBtYWluX29mZnNldCwKLQkJCSAgICAgICBpbnQgY2Nz
X3BsYW5lKQotewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmh3LmZiOwotCWludCBhdXhfeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxh
bmVdLng7Ci0JaW50IGF1eF95ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0u
eTsKLQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVd
Lm9mZnNldDsKLQl1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIGNjc19w
bGFuZSk7Ci0JaW50IGhzdWI7Ci0JaW50IHZzdWI7Ci0KLQlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vi
c2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3BsYW5lKTsKLQl3aGlsZSAoYXV4X29mZnNl
dCA+PSBtYWluX29mZnNldCAmJiBhdXhfeSA8PSBtYWluX3kpIHsKLQkJaW50IHgsIHk7Ci0KLQkJ
aWYgKGF1eF94ID09IG1haW5feCAmJiBhdXhfeSA9PSBtYWluX3kpCi0JCQlicmVhazsKLQotCQlp
ZiAoYXV4X29mZnNldCA9PSAwKQotCQkJYnJlYWs7Ci0KLQkJeCA9IGF1eF94IC8gaHN1YjsKLQkJ
eSA9IGF1eF95IC8gdnN1YjsKLQkJYXV4X29mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGln
bmVkX29mZnNldCgmeCwgJnksCi0JCQkJCQkJICAgICAgIHBsYW5lX3N0YXRlLAotCQkJCQkJCSAg
ICAgICBjY3NfcGxhbmUsCi0JCQkJCQkJICAgICAgIGF1eF9vZmZzZXQsCi0JCQkJCQkJICAgICAg
IGF1eF9vZmZzZXQgLQotCQkJCQkJCQlhbGlnbm1lbnQpOwotCQlhdXhfeCA9IHggKiBoc3ViICsg
YXV4X3ggJSBoc3ViOwotCQlhdXhfeSA9IHkgKiB2c3ViICsgYXV4X3kgJSB2c3ViOwotCX0KLQot
CWlmIChhdXhfeCAhPSBtYWluX3ggfHwgYXV4X3kgIT0gbWFpbl95KQotCQlyZXR1cm4gZmFsc2U7
Ci0KLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQgPSBhdXhfb2Zm
c2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggPSBhdXhfeDsKLQlw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0gYXV4X3k7Ci0KLQlyZXR1cm4g
dHJ1ZTsKLX0KLQogdW5zaWduZWQgaW50CiBpbnRlbF9wbGFuZV9mZW5jZV95X29mZnNldChjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewpAQCAtMjk1NiwzMTAg
KzI3ODUsNiBAQCBpbnRlbF9wbGFuZV9mZW5jZV95X29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXJldHVybiB5OwogfQogCi1zdGF0aWMgaW50IGlu
dGVsX3BsYW5lX21pbl93aWR0aChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkJCSBjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkgaW50IGNvbG9yX3BsYW5lLAotCQkJ
CSB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JaWYgKHBsYW5lLT5taW5fd2lkdGgpCi0JCXJl
dHVybiBwbGFuZS0+bWluX3dpZHRoKGZiLCBjb2xvcl9wbGFuZSwgcm90YXRpb24pOwotCWVsc2UK
LQkJcmV0dXJuIDE7Ci19Ci0KLXN0YXRpYyBpbnQgaW50ZWxfcGxhbmVfbWF4X3dpZHRoKHN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCQkJIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLAotCQkJCSBpbnQgY29sb3JfcGxhbmUsCi0JCQkJIHVuc2lnbmVkIGludCByb3RhdGlvbikK
LXsKLQlpZiAocGxhbmUtPm1heF93aWR0aCkKLQkJcmV0dXJuIHBsYW5lLT5tYXhfd2lkdGgoZmIs
IGNvbG9yX3BsYW5lLCByb3RhdGlvbik7Ci0JZWxzZQotCQlyZXR1cm4gSU5UX01BWDsKLX0KLQot
c3RhdGljIGludCBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCi0JCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkgIGludCBj
b2xvcl9wbGFuZSwKLQkJCQkgIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlpZiAocGxhbmUt
Pm1heF9oZWlnaHQpCi0JCXJldHVybiBwbGFuZS0+bWF4X2hlaWdodChmYiwgY29sb3JfcGxhbmUs
IHJvdGF0aW9uKTsKLQllbHNlCi0JCXJldHVybiBJTlRfTUFYOwotfQotCi1pbnQgc2tsX2NhbGNf
bWFpbl9zdXJmYWNlX29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlLAotCQkJCSBpbnQgKngsIGludCAqeSwgdTMyICpvZmZzZXQpCi17Ci0Jc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5l
KTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5i
YXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7Ci0JY29uc3QgaW50IGF1eF9wbGFuZSA9IGludGVsX21haW5fdG9fYXV4X3BsYW5l
KGZiLCAwKTsKLQljb25zdCB1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVthdXhfcGxhbmVdLm9mZnNldDsKLQljb25zdCB1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9h
bGlnbm1lbnQoZmIsIDApOwotCWNvbnN0IGludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0
YXRlLT51YXBpLnNyYykgPj4gMTY7Ci0KLQlpbnRlbF9hZGRfZmJfb2Zmc2V0cyh4LCB5LCBwbGFu
ZV9zdGF0ZSwgMCk7Ci0JKm9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZz
ZXQoeCwgeSwgcGxhbmVfc3RhdGUsIDApOwotCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRy
bSwgYWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdubWVudCkpKQotCQlyZXR1cm4gLUVJ
TlZBTDsKLQotCS8qCi0JICogQVVYIHN1cmZhY2Ugb2Zmc2V0IGlzIHNwZWNpZmllZCBhcyB0aGUg
ZGlzdGFuY2UgZnJvbSB0aGUKLQkgKiBtYWluIHN1cmZhY2Ugb2Zmc2V0LCBhbmQgaXQgbXVzdCBi
ZSBub24tbmVnYXRpdmUuIE1ha2UKLQkgKiBzdXJlIHRoYXQgaXMgd2hhdCB3ZSB3aWxsIGdldC4K
LQkgKi8KLQlpZiAoYXV4X3BsYW5lICYmICpvZmZzZXQgPiBhdXhfb2Zmc2V0KQotCQkqb2Zmc2V0
ID0gaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAw
LAotCQkJCQkJCSAgICAqb2Zmc2V0LAotCQkJCQkJCSAgICBhdXhfb2Zmc2V0ICYgfihhbGlnbm1l
bnQgLSAxKSk7Ci0KLQkvKgotCSAqIFdoZW4gdXNpbmcgYW4gWC10aWxlZCBzdXJmYWNlLCB0aGUg
cGxhbmUgYmxvd3MgdXAKLQkgKiBpZiB0aGUgeCBvZmZzZXQgKyB3aWR0aCBleGNlZWQgdGhlIHN0
cmlkZS4KLQkgKgotCSAqIFRPRE86IGxpbmVhciBhbmQgWS10aWxlZCBzZWVtIGZpbmUsIFlmIHVu
dGVzdGVkLAotCSAqLwotCWlmIChmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1hfVElM
RUQpIHsKLQkJaW50IGNwcCA9IGZiLT5mb3JtYXQtPmNwcFswXTsKLQotCQl3aGlsZSAoKCp4ICsg
dykgKiBjcHAgPiBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlKSB7Ci0JCQlpZiAo
Km9mZnNldCA9PSAwKSB7Ci0JCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkJCSAg
ICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8g
WC10aWxpbmdcbiIpOwotCQkJCXJldHVybiAtRUlOVkFMOwotCQkJfQotCi0JCQkqb2Zmc2V0ID0g
aW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwLAot
CQkJCQkJCQkgICAgKm9mZnNldCwKLQkJCQkJCQkJICAgICpvZmZzZXQgLSBhbGlnbm1lbnQpOwot
CQl9Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX2NoZWNrX21haW5fc3Vy
ZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFu
ZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+
YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmh3LmZiOwotCWNvbnN0IHVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5o
dy5yb3RhdGlvbjsKLQlpbnQgeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKLQlp
bnQgeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKLQljb25zdCBpbnQgdyA9IGRy
bV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCWNvbnN0IGludCBo
ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCWNvbnN0
IGludCBtaW5fd2lkdGggPSBpbnRlbF9wbGFuZV9taW5fd2lkdGgocGxhbmUsIGZiLCAwLCByb3Rh
dGlvbik7Ci0JY29uc3QgaW50IG1heF93aWR0aCA9IGludGVsX3BsYW5lX21heF93aWR0aChwbGFu
ZSwgZmIsIDAsIHJvdGF0aW9uKTsKLQljb25zdCBpbnQgbWF4X2hlaWdodCA9IGludGVsX3BsYW5l
X21heF9oZWlnaHQocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7Ci0JY29uc3QgaW50IGF1eF9wbGFu
ZSA9IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGZiLCAwKTsKLQljb25zdCB1MzIgYWxpZ25tZW50
ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIDApOwotCXUzMiBvZmZzZXQ7Ci0JaW50IHJldDsK
LQotCWlmICh3ID4gbWF4X3dpZHRoIHx8IHcgPCBtaW5fd2lkdGggfHwgaCA+IG1heF9oZWlnaHQp
IHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgInJlcXVlc3RlZCBZL1JH
QiBzb3VyY2Ugc2l6ZSAlZHglZCBvdXRzaWRlIGxpbWl0cyAobWluOiAlZHgxIG1heDogJWR4JWQp
XG4iLAotCQkJICAgIHcsIGgsIG1pbl93aWR0aCwgbWF4X3dpZHRoLCBtYXhfaGVpZ2h0KTsKLQkJ
cmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JcmV0ID0gc2tsX2NhbGNfbWFpbl9zdXJmYWNlX29mZnNl
dChwbGFuZV9zdGF0ZSwgJngsICZ5LCAmb2Zmc2V0KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0
OwotCi0JLyoKLQkgKiBDQ1MgQVVYIHN1cmZhY2UgZG9lc24ndCBoYXZlIGl0cyBvd24geC95IG9m
ZnNldHMsIHdlIG11c3QgbWFrZSBzdXJlCi0JICogdGhleSBtYXRjaCB3aXRoIHRoZSBtYWluIHN1
cmZhY2UgeC95IG9mZnNldHMuCi0JICovCi0JaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZp
ZXIpKSB7Ci0JCXdoaWxlICghc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0
YXRlLCB4LCB5LAotCQkJCQkJICAgICAgIG9mZnNldCwgYXV4X3BsYW5lKSkgewotCQkJaWYgKG9m
ZnNldCA9PSAwKQotCQkJCWJyZWFrOwotCi0JCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3Rf
YWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKLQkJCQkJCQkJICAgb2Zmc2V0
LCBvZmZzZXQgLSBhbGlnbm1lbnQpOwotCQl9Ci0KLQkJaWYgKHggIT0gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2F1eF9wbGFuZV0ueCB8fAotCQkgICAgeSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbYXV4X3BsYW5lXS55KSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJ
CQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRpc3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVl
IHRvIENDU1xuIik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsKLQkJfQotCX0KLQotCWRybV9XQVJOX09O
KCZkZXZfcHJpdi0+ZHJtLCB4ID4gODE5MSB8fCB5ID4gODE5MSk7Ci0KLQlwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMF0ub2Zmc2V0ID0gb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVswXS54ID0geDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueSA9IHk7Ci0KLQkvKgot
CSAqIFB1dCB0aGUgZmluYWwgY29vcmRpbmF0ZXMgYmFjayBzbyB0aGF0IHRoZSBzcmMKLQkgKiBj
b29yZGluYXRlIGNoZWNrcyB3aWxsIHNlZSB0aGUgcmlnaHQgdmFsdWVzLgotCSAqLwotCWRybV9y
ZWN0X3RyYW5zbGF0ZV90bygmcGxhbmVfc3RhdGUtPnVhcGkuc3JjLAotCQkJICAgICAgeCA8PCAx
NiwgeSA8PCAxNik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBza2xfY2hlY2tfbnYx
Ml9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewot
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBs
YW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3
LnJvdGF0aW9uOwotCWludCB1dl9wbGFuZSA9IDE7Ci0JaW50IG1heF93aWR0aCA9IGludGVsX3Bs
YW5lX21heF93aWR0aChwbGFuZSwgZmIsIHV2X3BsYW5lLCByb3RhdGlvbik7Ci0JaW50IG1heF9o
ZWlnaHQgPSBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgdXZfcGxhbmUsIHJvdGF0
aW9uKTsKLQlpbnQgeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNzsKLQlpbnQgeSA9
IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNzsKLQlpbnQgdyA9IGRybV9yZWN0X3dpZHRo
KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE3OwotCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE3OwotCXUzMiBvZmZzZXQ7Ci0KLQkvKiBGSVhN
RSBub3QgcXVpdGUgc3VyZSBob3cvaWYgdGhlc2UgYXBwbHkgdG8gdGhlIGNocm9tYSBwbGFuZSAq
LwotCWlmICh3ID4gbWF4X3dpZHRoIHx8IGggPiBtYXhfaGVpZ2h0KSB7Ci0JCWRybV9kYmdfa21z
KCZpOTE1LT5kcm0sCi0JCQkgICAgIkNiQ3Igc291cmNlIHNpemUgJWR4JWQgdG9vIGJpZyAobGlt
aXQgJWR4JWQpXG4iLAotCQkJICAgIHcsIGgsIG1heF93aWR0aCwgbWF4X2hlaWdodCk7Ci0JCXJl
dHVybiAtRUlOVkFMOwotCX0KLQotCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVf
c3RhdGUsIHV2X3BsYW5lKTsKLQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRf
b2Zmc2V0KCZ4LCAmeSwKLQkJCQkJCSAgICBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOwotCi0JaWYg
KGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7Ci0JCWludCBjY3NfcGxhbmUgPSBtYWlu
X3RvX2Njc19wbGFuZShmYiwgdXZfcGxhbmUpOwotCQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKLQkJdTMyIGFsaWdubWVudCA9IGlu
dGVsX3N1cmZfYWxpZ25tZW50KGZiLCB1dl9wbGFuZSk7Ci0KLQkJaWYgKG9mZnNldCA+IGF1eF9v
ZmZzZXQpCi0JCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngs
ICZ5LAotCQkJCQkJCQkgICBwbGFuZV9zdGF0ZSwKLQkJCQkJCQkJICAgdXZfcGxhbmUsCi0JCQkJ
CQkJCSAgIG9mZnNldCwKLQkJCQkJCQkJICAgYXV4X29mZnNldCAmIH4oYWxpZ25tZW50IC0gMSkp
OwotCi0JCXdoaWxlICghc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRl
LCB4LCB5LAotCQkJCQkJICAgICAgIG9mZnNldCwgY2NzX3BsYW5lKSkgewotCQkJaWYgKG9mZnNl
dCA9PSAwKQotCQkJCWJyZWFrOwotCi0JCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxp
Z25lZF9vZmZzZXQoJngsICZ5LAotCQkJCQkJCQkgICBwbGFuZV9zdGF0ZSwKLQkJCQkJCQkJICAg
dXZfcGxhbmUsCi0JCQkJCQkJCSAgIG9mZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50KTsKLQkJfQot
Ci0JCWlmICh4ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggfHwKLQkJ
ICAgIHkgIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSkgewotCQkJZHJt
X2RiZ19rbXMoJmk5MTUtPmRybSwKLQkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRp
c3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIENDU1xuIik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsK
LQkJfQotCX0KLQotCWRybV9XQVJOX09OKCZpOTE1LT5kcm0sIHggPiA4MTkxIHx8IHkgPiA4MTkx
KTsKLQotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ub2Zmc2V0ID0gb2Zmc2V0
OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ueCA9IHg7Ci0JcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lW3V2X3BsYW5lXS55ID0geTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0
aWMgaW50IHNrbF9jaGVja19jY3NfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKLQlpbnQgc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEg
Pj4gMTY7Ci0JaW50IHNyY195ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OwotCXUz
MiBvZmZzZXQ7Ci0JaW50IGNjc19wbGFuZTsKLQotCWZvciAoY2NzX3BsYW5lID0gMDsgY2NzX3Bs
YW5lIDwgZmItPmZvcm1hdC0+bnVtX3BsYW5lczsgY2NzX3BsYW5lKyspIHsKLQkJaW50IG1haW5f
aHN1YiwgbWFpbl92c3ViOwotCQlpbnQgaHN1YiwgdnN1YjsKLQkJaW50IHgsIHk7Ci0KLQkJaWYg
KCFpc19jY3NfcGxhbmUoZmIsIGNjc19wbGFuZSkgfHwKLQkJICAgIGlzX2dlbjEyX2Njc19jY19w
bGFuZShmYiwgY2NzX3BsYW5lKSkKLQkJCWNvbnRpbnVlOwotCi0JCWludGVsX2ZiX3BsYW5lX2dl
dF9zdWJzYW1wbGluZygmbWFpbl9oc3ViLCAmbWFpbl92c3ViLCBmYiwKLQkJCQkJICAgICAgIGNj
c190b19tYWluX3BsYW5lKGZiLCBjY3NfcGxhbmUpKTsKLQkJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1
YnNhbXBsaW5nKCZoc3ViLCAmdnN1YiwgZmIsIGNjc19wbGFuZSk7Ci0KLQkJaHN1YiAqPSBtYWlu
X2hzdWI7Ci0JCXZzdWIgKj0gbWFpbl92c3ViOwotCQl4ID0gc3JjX3ggLyBoc3ViOwotCQl5ID0g
c3JjX3kgLyB2c3ViOwotCi0JCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3Rh
dGUsIGNjc19wbGFuZSk7Ci0KLQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVk
X29mZnNldCgmeCwgJnksCi0JCQkJCQkJICAgIHBsYW5lX3N0YXRlLAotCQkJCQkJCSAgICBjY3Nf
cGxhbmUpOwotCi0JCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldCA9
IG9mZnNldDsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueCA9ICh4ICog
aHN1YiArCi0JCQkJCQkJIHNyY194ICUgaHN1YikgLwotCQkJCQkJCW1haW5faHN1YjsKLQkJcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSA9ICh5ICogdnN1YiArCi0JCQkJCQkJ
IHNyY195ICUgdnN1YikgLwotCQkJCQkJCW1haW5fdnN1YjsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0K
LQotaW50IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCi17Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7Ci0JaW50IHJldCwgaTsKLQotCXJldCA9IGludGVsX3BsYW5lX2NvbXB1
dGVfZ3R0KHBsYW5lX3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKCFw
bGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQotCQlyZXR1cm4gMDsKLQotCS8qCi0JICogSGFuZGxl
IHRoZSBBVVggc3VyZmFjZSBmaXJzdCBzaW5jZSB0aGUgbWFpbiBzdXJmYWNlIHNldHVwIGRlcGVu
ZHMgb24KLQkgKiBpdC4KLQkgKi8KLQlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikp
IHsKLQkJcmV0ID0gc2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JCWlm
IChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195
dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0LAotCQkJCQkJZmItPm1vZGlmaWVyKSkgewotCQlyZXQg
PSBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JCWlmIChyZXQpCi0J
CQlyZXR1cm4gcmV0OwotCX0KLQotCWZvciAoaSA9IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7IGkg
PCBBUlJBWV9TSVpFKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZSk7IGkrKykgewotCQlwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbaV0ub2Zmc2V0ID0gMDsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW2ldLnggPSAwOwotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ueSA9IDA7Ci0JfQot
Ci0JcmV0ID0gc2tsX2NoZWNrX21haW5fc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkK
LQkJcmV0dXJuIHJldDsKLQotCXJldHVybiAwOwotfQotCiBzdGF0aWMgdm9pZCBza2xfZGV0YWNo
X3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywgaW50IGlkKQogewogCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXYgPSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKQEAgLTMyOTIsMzA3ICsy
ODE3LDYgQEAgc3RhdGljIHZvaWQgc2tsX2RldGFjaF9zY2FsZXJzKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCX0KIH0KIAotc3RhdGljIHVuc2lnbmVkIGludCBz
a2xfcGxhbmVfc3RyaWRlX211bHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0J
CQkJCSAgaW50IGNvbG9yX3BsYW5lLCB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JLyoKLQkg
KiBUaGUgc3RyaWRlIGlzIGVpdGhlciBleHByZXNzZWQgYXMgYSBtdWx0aXBsZSBvZiA2NCBieXRl
cyBjaHVua3MgZm9yCi0JICogbGluZWFyIGJ1ZmZlcnMgb3IgaW4gbnVtYmVyIG9mIHRpbGVzIGZv
ciB0aWxlZCBidWZmZXJzLgotCSAqLwotCWlmIChpc19zdXJmYWNlX2xpbmVhcihmYiwgY29sb3Jf
cGxhbmUpKQotCQlyZXR1cm4gNjQ7Ci0JZWxzZSBpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChy
b3RhdGlvbikpCi0JCXJldHVybiBpbnRlbF90aWxlX2hlaWdodChmYiwgY29sb3JfcGxhbmUpOwot
CWVsc2UKLQkJcmV0dXJuIGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoZmIsIGNvbG9yX3BsYW5lKTsK
LX0KLQotdTMyIHNrbF9wbGFuZV9zdHJpZGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSwKLQkJICAgICBpbnQgY29sb3JfcGxhbmUpCi17Ci0JY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JdW5zaWduZWQgaW50
IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwotCXUzMiBzdHJpZGUgPSBwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnN0cmlkZTsKLQotCWlmIChjb2xvcl9w
bGFuZSA+PSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzKQotCQlyZXR1cm4gMDsKLQotCXJldHVybiBz
dHJpZGUgLyBza2xfcGxhbmVfc3RyaWRlX211bHQoZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7
Ci19Ci0KLXN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bF9mb3JtYXQodTMyIHBpeGVsX2Zvcm1hdCkK
LXsKLQlzd2l0Y2ggKHBpeGVsX2Zvcm1hdCkgewotCWNhc2UgRFJNX0ZPUk1BVF9DODoKLQkJcmV0
dXJuIFBMQU5FX0NUTF9GT1JNQVRfSU5ERVhFRDsKLQljYXNlIERSTV9GT1JNQVRfUkdCNTY1Ogot
CQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9SR0JfNTY1OwotCWNhc2UgRFJNX0ZPUk1BVF9YQkdS
ODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjg4ODg6Ci0JCXJldHVybiBQTEFORV9DVExfRk9S
TUFUX1hSR0JfODg4OCB8IFBMQU5FX0NUTF9PUkRFUl9SR0JYOwotCWNhc2UgRFJNX0ZPUk1BVF9Y
UkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6Ci0JCXJldHVybiBQTEFORV9DVExf
Rk9STUFUX1hSR0JfODg4ODsKLQljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6Ci0JY2FzZSBE
Uk1fRk9STUFUX0FCR1IyMTAxMDEwOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzIx
MDEwMTAgfCBQTEFORV9DVExfT1JERVJfUkdCWDsKLQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEw
MTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZP
Uk1BVF9YUkdCXzIxMDEwMTA7Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6Ci0JY2Fz
ZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hS
R0JfMTYxNjE2MTZGIHwgUExBTkVfQ1RMX09SREVSX1JHQlg7Ci0JY2FzZSBEUk1fRk9STUFUX1hS
R0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6Ci0JCXJldHVybiBQ
TEFORV9DVExfRk9STUFUX1hSR0JfMTYxNjE2MTZGOwotCWNhc2UgRFJNX0ZPUk1BVF9YWVVWODg4
ODoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFlVVjsKLQljYXNlIERSTV9GT1JNQVRfWVVZ
VjoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWVVWNDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9Z
VVlWOwotCWNhc2UgRFJNX0ZPUk1BVF9ZVllVOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9Z
VVY0MjIgfCBQTEFORV9DVExfWVVWNDIyX1lWWVU7Ci0JY2FzZSBEUk1fRk9STUFUX1VZVlk6Ci0J
CXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQyMiB8IFBMQU5FX0NUTF9ZVVY0MjJfVVlWWTsK
LQljYXNlIERSTV9GT1JNQVRfVllVWToKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWVVWNDIy
IHwgUExBTkVfQ1RMX1lVVjQyMl9WWVVZOwotCWNhc2UgRFJNX0ZPUk1BVF9OVjEyOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9OVjEyOwotCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9QMDEwOwotCWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9QMDEyOwotCWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9QMDE2OwotCWNhc2UgRFJNX0ZPUk1BVF9ZMjEwOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZMjEwOwotCWNhc2UgRFJNX0ZPUk1BVF9ZMjEyOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZMjEyOwotCWNhc2UgRFJNX0ZPUk1BVF9ZMjE2OgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZMjE2OwotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoK
LQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTQxMDsKLQljYXNlIERSTV9GT1JNQVRfWFZZVTEy
XzE2MTYxNjE2OgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZNDEyOwotCWNhc2UgRFJNX0ZP
Uk1BVF9YVllVMTYxNjE2MTY6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1k0MTY7Ci0JZGVm
YXVsdDoKLQkJTUlTU0lOR19DQVNFKHBpeGVsX2Zvcm1hdCk7Ci0JfQotCi0JcmV0dXJuIDA7Ci19
Ci0KLXN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bF9hbHBoYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCWlmICghcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3Jt
YXQtPmhhc19hbHBoYSkKLQkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9ESVNBQkxFOwotCi0Jc3dp
dGNoIChwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9kZSkgewotCWNhc2UgRFJNX01PREVf
QkxFTkRfUElYRUxfTk9ORToKLQkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9ESVNBQkxFOwotCWNh
c2UgRFJNX01PREVfQkxFTkRfUFJFTVVMVEk6Ci0JCXJldHVybiBQTEFORV9DVExfQUxQSEFfU1df
UFJFTVVMVElQTFk7Ci0JY2FzZSBEUk1fTU9ERV9CTEVORF9DT1ZFUkFHRToKLQkJcmV0dXJuIFBM
QU5FX0NUTF9BTFBIQV9IV19QUkVNVUxUSVBMWTsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0Uo
cGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpOwotCQlyZXR1cm4gUExBTkVfQ1RMX0FM
UEhBX0RJU0FCTEU7Ci0JfQotfQotCi1zdGF0aWMgdTMyIGdsa19wbGFuZV9jb2xvcl9jdGxfYWxw
aGEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlpZiAo
IXBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5oYXNfYWxwaGEpCi0JCXJldHVybiBQTEFORV9D
T0xPUl9BTFBIQV9ESVNBQkxFOwotCi0Jc3dpdGNoIChwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxl
bmRfbW9kZSkgewotCWNhc2UgRFJNX01PREVfQkxFTkRfUElYRUxfTk9ORToKLQkJcmV0dXJuIFBM
QU5FX0NPTE9SX0FMUEhBX0RJU0FCTEU7Ci0JY2FzZSBEUk1fTU9ERV9CTEVORF9QUkVNVUxUSToK
LQkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX1NXX1BSRU1VTFRJUExZOwotCWNhc2UgRFJNX01P
REVfQkxFTkRfQ09WRVJBR0U6Ci0JCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9IV19QUkVNVUxU
SVBMWTsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2Js
ZW5kX21vZGUpOwotCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfRElTQUJMRTsKLQl9Ci19Ci0K
LXN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bF90aWxpbmcodTY0IGZiX21vZGlmaWVyKQotewotCXN3
aXRjaCAoZmJfbW9kaWZpZXIpIHsKLQljYXNlIERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKLQkJYnJl
YWs7Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9U
SUxFRF9YOwotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6Ci0JCXJldHVybiBQTEFORV9D
VExfVElMRURfWTsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKLQljYXNlIEk5
MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQzoKLQkJcmV0dXJuIFBMQU5FX0NU
TF9USUxFRF9ZIHwgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKLQljYXNl
IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKLQkJcmV0dXJuIFBMQU5FX0NU
TF9USUxFRF9ZIHwKLQkJICAgICAgIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFC
TEUgfAotCQkgICAgICAgUExBTkVfQ1RMX0NMRUFSX0NPTE9SX0RJU0FCTEU7Ci0JY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6Ci0JCXJldHVybiBQTEFORV9DVExfVElM
RURfWSB8IFBMQU5FX0NUTF9NRURJQV9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKLQljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZZl9USUxFRDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZRjsKLQljYXNl
IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6Ci0JCXJldHVybiBQTEFORV9DVExfVElMRURf
WUYgfCBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFOwotCWRlZmF1bHQ6Ci0J
CU1JU1NJTkdfQ0FTRShmYl9tb2RpZmllcik7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRp
YyB1MzIgc2tsX3BsYW5lX2N0bF9yb3RhdGUodW5zaWduZWQgaW50IHJvdGF0ZSkKLXsKLQlzd2l0
Y2ggKHJvdGF0ZSkgewotCWNhc2UgRFJNX01PREVfUk9UQVRFXzA6Ci0JCWJyZWFrOwotCS8qCi0J
ICogRFJNX01PREVfUk9UQVRFXyBpcyBjb3VudGVyIGNsb2Nrd2lzZSB0byBzdGF5IGNvbXBhdGli
bGUgd2l0aCBYcmFuZHIKLQkgKiB3aGlsZSBpOTE1IEhXIHJvdGF0aW9uIGlzIGNsb2Nrd2lzZSwg
dGhhdHMgd2h5IHRoaXMgc3dhcHBpbmcuCi0JICovCi0JY2FzZSBEUk1fTU9ERV9ST1RBVEVfOTA6
Ci0JCXJldHVybiBQTEFORV9DVExfUk9UQVRFXzI3MDsKLQljYXNlIERSTV9NT0RFX1JPVEFURV8x
ODA6Ci0JCXJldHVybiBQTEFORV9DVExfUk9UQVRFXzE4MDsKLQljYXNlIERSTV9NT0RFX1JPVEFU
RV8yNzA6Ci0JCXJldHVybiBQTEFORV9DVExfUk9UQVRFXzkwOwotCWRlZmF1bHQ6Ci0JCU1JU1NJ
TkdfQ0FTRShyb3RhdGUpOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgdTMyIGNubF9w
bGFuZV9jdGxfZmxpcCh1bnNpZ25lZCBpbnQgcmVmbGVjdCkKLXsKLQlzd2l0Y2ggKHJlZmxlY3Qp
IHsKLQljYXNlIDA6Ci0JCWJyZWFrOwotCWNhc2UgRFJNX01PREVfUkVGTEVDVF9YOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZMSVBfSE9SSVpPTlRBTDsKLQljYXNlIERSTV9NT0RFX1JFRkxFQ1RfWToK
LQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UocmVmbGVjdCk7Ci0JfQotCi0JcmV0dXJuIDA7Ci19
Ci0KLXUzMiBza2xfcGxhbmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7Ci0JdTMyIHBsYW5lX2N0bCA9IDA7Ci0K
LQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2
KSkKLQkJcmV0dXJuIHBsYW5lX2N0bDsKLQotCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUp
Ci0JCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUElQRV9HQU1NQV9FTkFCTEU7Ci0KLQlpZiAoY3J0
Y19zdGF0ZS0+Y3NjX2VuYWJsZSkKLQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9QSVBFX0NTQ19F
TkFCTEU7Ci0KLQlyZXR1cm4gcGxhbmVfY3RsOwotfQotCi11MzIgc2tsX3BsYW5lX2N0bChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7
Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7
Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwotCWNv
bnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUt
PmNrZXk7Ci0JdTMyIHBsYW5lX2N0bDsKLQotCXBsYW5lX2N0bCA9IFBMQU5FX0NUTF9FTkFCTEU7
Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEwICYmICFJU19HRU1JTklMQUtFKGRldl9w
cml2KSkgewotCQlwbGFuZV9jdGwgfD0gc2tsX3BsYW5lX2N0bF9hbHBoYShwbGFuZV9zdGF0ZSk7
Ci0JCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUExBTkVfR0FNTUFfRElTQUJMRTsKLQotCQlpZiAo
cGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkK
LQkJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfWVVWX1RPX1JHQl9DU0NfRk9STUFUX0JUNzA5Owot
Ci0JCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZV
TExfUkFOR0UpCi0JCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1lVVl9SQU5HRV9DT1JSRUNUSU9O
X0RJU0FCTEU7Ci0JfQotCi0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfZm9ybWF0KGZiLT5m
b3JtYXQtPmZvcm1hdCk7Ci0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfdGlsaW5nKGZiLT5t
b2RpZmllcik7Ci0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfcm90YXRlKHJvdGF0aW9uICYg
RFJNX01PREVfUk9UQVRFX01BU0spOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAp
Ci0JCXBsYW5lX2N0bCB8PSBjbmxfcGxhbmVfY3RsX2ZsaXAocm90YXRpb24gJgotCQkJCQkJRFJN
X01PREVfUkVGTEVDVF9NQVNLKTsKLQotCWlmIChrZXktPmZsYWdzICYgSTkxNV9TRVRfQ09MT1JL
RVlfREVTVElOQVRJT04pCi0JCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfS0VZX0VOQUJMRV9ERVNU
SU5BVElPTjsKLQllbHNlIGlmIChrZXktPmZsYWdzICYgSTkxNV9TRVRfQ09MT1JLRVlfU09VUkNF
KQotCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0tFWV9FTkFCTEVfU09VUkNFOwotCi0JcmV0dXJu
IHBsYW5lX2N0bDsKLX0KLQotdTMyIGdsa19wbGFuZV9jb2xvcl9jdGxfY3J0Yyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKLQl1
MzIgcGxhbmVfY29sb3JfY3RsID0gMDsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEx
KQotCQlyZXR1cm4gcGxhbmVfY29sb3JfY3RsOwotCi0JaWYgKGNydGNfc3RhdGUtPmdhbW1hX2Vu
YWJsZSkKLQkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BJUEVfR0FNTUFfRU5BQkxF
OwotCi0JaWYgKGNydGNfc3RhdGUtPmNzY19lbmFibGUpCi0JCXBsYW5lX2NvbG9yX2N0bCB8PSBQ
TEFORV9DT0xPUl9QSVBFX0NTQ19FTkFCTEU7Ci0KLQlyZXR1cm4gcGxhbmVfY29sb3JfY3RsOwot
fQotCi11MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKLQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkx
NShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwotCXUzMiBwbGFu
ZV9jb2xvcl9jdGwgPSAwOwotCi0JcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5F
X0dBTU1BX0RJU0FCTEU7Ci0JcGxhbmVfY29sb3JfY3RsIHw9IGdsa19wbGFuZV9jb2xvcl9jdGxf
YWxwaGEocGxhbmVfc3RhdGUpOwotCi0JaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiAhaWNsX2lz
X2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmUtPmlkKSkgewotCQlzd2l0Y2ggKHBsYW5lX3N0YXRl
LT5ody5jb2xvcl9lbmNvZGluZykgewotCQljYXNlIERSTV9DT0xPUl9ZQ0JDUl9CVDcwOToKLQkJ
CXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9DU0NfTU9ERV9ZVVY3MDlfVE9fUkdCNzA5
OwotCQkJYnJlYWs7Ci0JCWNhc2UgRFJNX0NPTE9SX1lDQkNSX0JUMjAyMDoKLQkJCXBsYW5lX2Nv
bG9yX2N0bCB8PQotCQkJCVBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjIwMjBfVE9fUkdCMjAyMDsK
LQkJCWJyZWFrOwotCQlkZWZhdWx0OgotCQkJcGxhbmVfY29sb3JfY3RsIHw9Ci0JCQkJUExBTkVf
Q09MT1JfQ1NDX01PREVfWVVWNjAxX1RPX1JHQjYwMTsKLQkJfQotCQlpZiAocGxhbmVfc3RhdGUt
Pmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQotCQkJcGxhbmVf
Y29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7Ci0J
fSBlbHNlIGlmIChmYi0+Zm9ybWF0LT5pc195dXYpIHsKLQkJcGxhbmVfY29sb3JfY3RsIHw9IFBM
QU5FX0NPTE9SX0lOUFVUX0NTQ19FTkFCTEU7Ci0JCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3Jf
cmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCi0JCQlwbGFuZV9jb2xvcl9jdGwg
fD0gUExBTkVfQ09MT1JfWVVWX1JBTkdFX0NPUlJFQ1RJT05fRElTQUJMRTsKLQl9Ci0KLQlyZXR1
cm4gcGxhbmVfY29sb3JfY3RsOwotfQotCiBzdGF0aWMgaW50CiBfX2ludGVsX2Rpc3BsYXlfcmVz
dW1lKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCSAgICAgICBzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3RhdGUsCkBAIC04Mjc2LDE1MCArNzUwMCw2IEBAIHN0YXRpYyB2b2lkIHNrbF9nZXRf
cGZpdF9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXNjYWxl
cl9zdGF0ZS0+c2NhbGVyX3VzZXJzICY9IH4oMSA8PCBTS0xfQ1JUQ19JTkRFWCk7CiB9CiAKLXN0
YXRpYyB2b2lkCi1za2xfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAotCQkJICAgICBzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFuZV9jb25maWcgKnBsYW5l
X2NvbmZpZykKLXsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IHRvX2lu
dGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxh
bmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUt
PmlkOwotCWVudW0gcGlwZSBwaXBlOwotCXUzMiB2YWwsIGJhc2UsIG9mZnNldCwgc3RyaWRlX211
bHQsIHRpbGluZywgYWxwaGE7Ci0JaW50IGZvdXJjYywgcGl4ZWxfZm9ybWF0OwotCXVuc2lnbmVk
IGludCBhbGlnbmVkX2hlaWdodDsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKLQlzdHJ1
Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiOwotCi0JaWYgKCFwbGFuZS0+Z2V0X2h3X3N0
YXRlKHBsYW5lLCAmcGlwZSkpCi0JCXJldHVybjsKLQotCWRybV9XQVJOX09OKGRldiwgcGlwZSAh
PSBjcnRjLT5waXBlKTsKLQotCWlmIChjcnRjX3N0YXRlLT5iaWdqb2luZXIpIHsKLQkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlVuc3VwcG9ydGVkIGJpZ2pvaW5lciBjb25m
aWd1cmF0aW9uIGZvciBpbml0aWFsIEZCXG4iKTsKLQkJcmV0dXJuOwotCX0KLQotCWludGVsX2Zi
ID0ga3phbGxvYyhzaXplb2YoKmludGVsX2ZiKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFpbnRlbF9m
YikgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgImZhaWxlZCB0byBhbGxvYyBmYlxu
Iik7Ci0JCXJldHVybjsKLQl9Ci0KLQlmYiA9ICZpbnRlbF9mYi0+YmFzZTsKLQotCWZiLT5kZXYg
PSBkZXY7Ci0KLQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQTEFORV9DVEwocGlwZSwg
cGxhbmVfaWQpKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlwaXhlbF9m
b3JtYXQgPSB2YWwgJiBJQ0xfUExBTkVfQ1RMX0ZPUk1BVF9NQVNLOwotCWVsc2UKLQkJcGl4ZWxf
Zm9ybWF0ID0gdmFsICYgUExBTkVfQ1RMX0ZPUk1BVF9NQVNLOwotCi0JaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKLQkJYWxwaGEgPSBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAgICAgIFBMQU5FX0NPTE9SX0NUTChwaXBlLCBw
bGFuZV9pZCkpOwotCQlhbHBoYSAmPSBQTEFORV9DT0xPUl9BTFBIQV9NQVNLOwotCX0gZWxzZSB7
Ci0JCWFscGhhID0gdmFsICYgUExBTkVfQ1RMX0FMUEhBX01BU0s7Ci0JfQotCi0JZm91cmNjID0g
c2tsX2Zvcm1hdF90b19mb3VyY2MocGl4ZWxfZm9ybWF0LAotCQkJCSAgICAgIHZhbCAmIFBMQU5F
X0NUTF9PUkRFUl9SR0JYLCBhbHBoYSk7Ci0JZmItPmZvcm1hdCA9IGRybV9mb3JtYXRfaW5mbyhm
b3VyY2MpOwotCi0JdGlsaW5nID0gdmFsICYgUExBTkVfQ1RMX1RJTEVEX01BU0s7Ci0Jc3dpdGNo
ICh0aWxpbmcpIHsKLQljYXNlIFBMQU5FX0NUTF9USUxFRF9MSU5FQVI6Ci0JCWZiLT5tb2RpZmll
ciA9IERSTV9GT1JNQVRfTU9EX0xJTkVBUjsKLQkJYnJlYWs7Ci0JY2FzZSBQTEFORV9DVExfVElM
RURfWDoKLQkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1X1RJTElOR19YOwotCQlmYi0+bW9k
aWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDsKLQkJYnJlYWs7Ci0JY2FzZSBQTEFORV9D
VExfVElMRURfWToKLQkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1X1RJTElOR19ZOwotCQlp
ZiAodmFsICYgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRSkKLQkJCWZiLT5t
b2RpZmllciA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIgPwotCQkJCUk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyA6Ci0JCQkJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NT
OwotCQllbHNlIGlmICh2YWwgJiBQTEFORV9DVExfTUVESUFfREVDT01QUkVTU0lPTl9FTkFCTEUp
Ci0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M7
Ci0JCWVsc2UKLQkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOwotCQli
cmVhazsKLQljYXNlIFBMQU5FX0NUTF9USUxFRF9ZRjoKLQkJaWYgKHZhbCAmIFBMQU5FX0NUTF9S
RU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUpCi0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1B
VF9NT0RfWWZfVElMRURfQ0NTOwotCQllbHNlCi0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1B
VF9NT0RfWWZfVElMRUQ7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRSh0aWxp
bmcpOwotCQlnb3RvIGVycm9yOwotCX0KLQotCS8qCi0JICogRFJNX01PREVfUk9UQVRFXyBpcyBj
b3VudGVyIGNsb2Nrd2lzZSB0byBzdGF5IGNvbXBhdGlibGUgd2l0aCBYcmFuZHIKLQkgKiB3aGls
ZSBpOTE1IEhXIHJvdGF0aW9uIGlzIGNsb2Nrd2lzZSwgdGhhdHMgd2h5IHRoaXMgc3dhcHBpbmcu
Ci0JICovCi0Jc3dpdGNoICh2YWwgJiBQTEFORV9DVExfUk9UQVRFX01BU0spIHsKLQljYXNlIFBM
QU5FX0NUTF9ST1RBVEVfMDoKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JP
VEFURV8wOwotCQlicmVhazsKLQljYXNlIFBMQU5FX0NUTF9ST1RBVEVfOTA6Ci0JCXBsYW5lX2Nv
bmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMjcwOwotCQlicmVhazsKLQljYXNlIFBM
QU5FX0NUTF9ST1RBVEVfMTgwOgotCQlwbGFuZV9jb25maWctPnJvdGF0aW9uID0gRFJNX01PREVf
Uk9UQVRFXzE4MDsKLQkJYnJlYWs7Ci0JY2FzZSBQTEFORV9DVExfUk9UQVRFXzI3MDoKLQkJcGxh
bmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV85MDsKLQkJYnJlYWs7Ci0JfQot
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgJiYKLQkgICAgdmFsICYgUExBTkVfQ1RM
X0ZMSVBfSE9SSVpPTlRBTCkKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiB8PSBEUk1fTU9ERV9S
RUZMRUNUX1g7Ci0KLQkvKiA5MC8yNzAgZGVncmVlIHJvdGF0aW9uIHdvdWxkIHJlcXVpcmUgZXh0
cmEgd29yayAqLwotCWlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHBsYW5lX2NvbmZpZy0+cm90
YXRpb24pKQotCQlnb3RvIGVycm9yOwotCi0JYmFzZSA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYs
IFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQpKSAmIDB4ZmZmZmYwMDA7Ci0JcGxhbmVfY29uZmln
LT5iYXNlID0gYmFzZTsKLQotCW9mZnNldCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5F
X09GRlNFVChwaXBlLCBwbGFuZV9pZCkpOwotCi0JdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJp
diwgUExBTkVfU0laRShwaXBlLCBwbGFuZV9pZCkpOwotCWZiLT5oZWlnaHQgPSAoKHZhbCA+PiAx
NikgJiAweGZmZmYpICsgMTsKLQlmYi0+d2lkdGggPSAoKHZhbCA+PiAwKSAmIDB4ZmZmZikgKyAx
OwotCi0JdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgUExBTkVfU1RSSURFKHBpcGUsIHBs
YW5lX2lkKSk7Ci0Jc3RyaWRlX211bHQgPSBza2xfcGxhbmVfc3RyaWRlX211bHQoZmIsIDAsIERS
TV9NT0RFX1JPVEFURV8wKTsKLQlmYi0+cGl0Y2hlc1swXSA9ICh2YWwgJiAweDNmZikgKiBzdHJp
ZGVfbXVsdDsKLQotCWFsaWduZWRfaGVpZ2h0ID0gaW50ZWxfZmJfYWxpZ25faGVpZ2h0KGZiLCAw
LCBmYi0+aGVpZ2h0KTsKLQotCXBsYW5lX2NvbmZpZy0+c2l6ZSA9IGZiLT5waXRjaGVzWzBdICog
YWxpZ25lZF9oZWlnaHQ7Ci0KLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJICAgICIl
cy8lcyB3aXRoIGZiOiBzaXplPSVkeCVkQCVkLCBvZmZzZXQ9JXgsIHBpdGNoICVkLCBzaXplIDB4
JXhcbiIsCi0JCSAgICBjcnRjLT5iYXNlLm5hbWUsIHBsYW5lLT5iYXNlLm5hbWUsIGZiLT53aWR0
aCwgZmItPmhlaWdodCwKLQkJICAgIGZiLT5mb3JtYXQtPmNwcFswXSAqIDgsIGJhc2UsIGZiLT5w
aXRjaGVzWzBdLAotCQkgICAgcGxhbmVfY29uZmlnLT5zaXplKTsKLQotCXBsYW5lX2NvbmZpZy0+
ZmIgPSBpbnRlbF9mYjsKLQlyZXR1cm47Ci0KLWVycm9yOgotCWtmcmVlKGludGVsX2ZiKTsKLX0K
LQogc3RhdGljIHZvaWQgaWxrX2dldF9wZml0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmgKaW5kZXggYzcyZTQxYjYxMzQ5Li4zYzE1M2ViNzgwOTIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCkBAIC01Miw2ICs1
Miw3IEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOwogc3RydWN0IGludGVsX2RpZ2l0YWxfcG9y
dDsKIHN0cnVjdCBpbnRlbF9kcDsKIHN0cnVjdCBpbnRlbF9lbmNvZGVyOworc3RydWN0IGludGVs
X2luaXRpYWxfcGxhbmVfY29uZmlnOwogc3RydWN0IGludGVsX2xvYWRfZGV0ZWN0X3BpcGU7CiBz
dHJ1Y3QgaW50ZWxfcGxhbmU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGU7CkBAIC01MTcsNyAr
NTE4LDYgQEAgdm9pZCBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBicHAsIGludCBubGFuZXMs
CiAJCQkgICAgc3RydWN0IGludGVsX2xpbmtfbV9uICptX24sCiAJCQkgICAgYm9vbCBjb25zdGFu
dF9uLCBib29sIGZlY19lbmFibGUpOwogYm9vbCBpc19jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVy
KTsKLWludCBpbnRlbF9tYWluX3RvX2F1eF9wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiwgaW50IG1haW5fcGxhbmUpOwogdm9pZCBscHRfZGlzYWJsZV9jbGtvdXRfZHAoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHUzMiBpbnRlbF9wbGFuZV9mYl9tYXhf
c3RyaWRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgICAgIHUzMiBw
aXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllcik7CkBAIC02MjksMTggKzYyOSw3IEBAIHUzMiBza2xf
c2NhbGVyX2dldF9maWx0ZXJfc2VsZWN0KGVudW0gZHJtX3NjYWxpbmdfZmlsdGVyIGZpbHRlciwg
aW50IHNldCk7CiB2b2lkIHNrbF9zY2FsZXJfc2V0dXBfZmlsdGVyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUsCiAJCQkgICAgIGludCBpZCwgaW50IHNl
dCwgZW51bSBkcm1fc2NhbGluZ19maWx0ZXIgZmlsdGVyKTsKIHZvaWQgaWxrX3BmaXRfZGlzYWJs
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpOwotdTMyIGds
a19wbGFuZV9jb2xvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCi0JCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKLXUz
MiBnbGtfcGxhbmVfY29sb3JfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpOwotdTMyIHNrbF9wbGFuZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCi0JCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSk7Ci11MzIgc2tsX3BsYW5lX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKLXUzMiBza2xfcGxhbmVfc3RyaWRlKGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCSAgICAgaW50IHBsYW5lKTsKLWlu
dCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKTsKLWludCBza2xfY2FsY19tYWluX3N1cmZhY2Vfb2Zmc2V0KGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCQkJIGludCAqeCwgaW50ICp5LCB1MzIg
Km9mZnNldCk7Ci1pbnQgc2tsX2Zvcm1hdF90b19mb3VyY2MoaW50IGZvcm1hdCwgYm9vbCByZ2Jf
b3JkZXIsIGJvb2wgYWxwaGEpOworCiBpbnQgYmR3X2dldF9waXBlbWlzY19icHAoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMpOwogdW5zaWduZWQgaW50IGludGVsX3BsYW5lX2ZlbmNlX3lfb2Zmc2V0
KGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogCkBAIC02NjMs
NiArNjUyLDE4IEBAIHN0cnVjdCBpbnRlbF9lbmNvZGVyICoKIGludGVsX2dldF9jcnRjX25ld19l
bmNvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJICAgY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCit1bnNpZ25lZCBpbnQg
aW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJ
CQkJICBpbnQgY29sb3JfcGxhbmUpOwordm9pZCBpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxp
bmcoaW50ICpoc3ViLCBpbnQgKnZzdWIsCisJCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLAorCQkJCSAgICBpbnQgY29sb3JfcGxhbmUpOwordTMyIGludGVsX3BsYW5lX2Fk
anVzdF9hbGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKKwkJCQkgICAgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnN0YXRlLAorCQkJCSAgICAgIGludCBjb2xvcl9wbGFuZSwK
KwkJCQkgICAgICB1MzIgb2xkX29mZnNldCwgdTMyIG5ld19vZmZzZXQpOwordW5zaWduZWQgaW50
IGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
IGludCBjb2xvcl9wbGFuZSk7Cit1bnNpZ25lZCBpbnQgaW50ZWxfdGlsZV9oZWlnaHQoY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSk7CisKIC8qIG1vZGVz
ZXR0aW5nICovCiB2b2lkIGludGVsX21vZGVzZXRfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSk7CiBpbnQgaW50ZWxfbW9kZXNldF9pbml0X25vaXJxKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggMzA3ZmY0Yjc3MWY0Li42MTgzZjJmMDQyNGIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBl
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBl
cy5oCkBAIC0zNyw2ICszNyw3IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9kcF9tc3RfaGVscGVyLmg+
CiAjaW5jbHVkZSA8ZHJtL2RybV9lbmNvZGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9mYl9oZWxw
ZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPgogI2luY2x1ZGUgPGRybS9kcm1fcHJv
YmVfaGVscGVyLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9yZWN0Lmg+CiAjaW5jbHVkZSA8ZHJtL2Ry
bV92YmxhbmsuaD4KQEAgLTE5NDUsNCArMTk0NiwzMCBAQCBzdGF0aWMgaW5saW5lIHUzMiBpbnRl
bF9mZGlfbGlua19mcmVxKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0
dXJuIGRldl9wcml2LT5mZGlfcGxsX2ZyZXE7CiB9CiAKK3N0YXRpYyBpbmxpbmUgYm9vbCBpc19j
Y3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFuZSkKK3sK
KwlpZiAoIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQorCQlyZXR1cm4gZmFsc2U7CisK
KwlyZXR1cm4gcGxhbmUgPj0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDI7Cit9CisKK3N0YXRp
YyBpbmxpbmUgYm9vbCBpc19nZW4xMl9jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQoreworCXJl
dHVybiBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgfHwK
KwkgICAgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NT
X0NDIHx8CisJICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEy
X01DX0NDUzsKK30KKworc3RhdGljIGlubGluZSBib29sIGlzX2dlbjEyX2Njc19wbGFuZShjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQoreworCXJldHVybiBpc19n
ZW4xMl9jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAmJiBpc19jY3NfcGxhbmUoZmIsIHBsYW5l
KTsKK30KKworc3RhdGljIGlubGluZSBib29sIGlzX2dlbjEyX2Njc19jY19wbGFuZShjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQoreworCXJldHVybiBmYi0+bW9k
aWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTX0NDICYmCisJICAg
ICAgIHBsYW5lID09IDI7Cit9CisKICNlbmRpZiAvKiAgX19JTlRFTF9ESVNQTEFZX1RZUEVTX0hf
XyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3Iu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKaW5kZXggMjg0MjMz
NTZkNTNiLi5iZjIxNGQwZTJkZWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcHNyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9wc3IuYwpAQCAtMzIsNiArMzIsNyBAQAogI2luY2x1ZGUgImludGVsX2hkbWkuaCIKICNpbmNs
dWRlICJpbnRlbF9wc3IuaCIKICNpbmNsdWRlICJpbnRlbF9zcHJpdGUuaCIKKyNpbmNsdWRlICJz
a2xfdW5pdmVyc2FsX3BsYW5lLmgiCiAKIC8qKgogICogRE9DOiBQYW5lbCBTZWxmIFJlZnJlc2gg
KFBTUi9TUkQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwpp
bmRleCAyNjAyNTI1MWIwMzguLjkzZjNhZmMyNDViOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC0zNzYsMjEyICszNzYsNyBAQCBpbnQgaW50ZWxf
cGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB1OCBpY2xfbnYxMl95X3BsYW5lX21h
c2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCi17Ci0JaWYgKEhBU19EMTJfUExBTkVf
TUlOSU1JWkFUSU9OKGk5MTUpKQotCQlyZXR1cm4gQklUKFBMQU5FX1NQUklURTIpIHwgQklUKFBM
QU5FX1NQUklURTMpOwotCWVsc2UKLQkJcmV0dXJuIEJJVChQTEFORV9TUFJJVEU0KSB8IEJJVChQ
TEFORV9TUFJJVEU1KTsKLX0KLQotYm9vbCBpY2xfaXNfbnYxMl95X3BsYW5lKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQotewot
CXJldHVybiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCi0JCWljbF9udjEyX3lfcGxhbmVf
bWFzayhkZXZfcHJpdikgJiBCSVQocGxhbmVfaWQpOwotfQotCi1ib29sIGljbF9pc19oZHJfcGxh
bmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBsYW5lX2lkIHBsYW5l
X2lkKQotewotCXJldHVybiBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCi0JCWljbF9oZHJf
cGxhbmVfbWFzaygpICYgQklUKHBsYW5lX2lkKTsKLX0KLQotc3RhdGljIHZvaWQKLXNrbF9wbGFu
ZV9yYXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJdW5zaWduZWQgaW50
ICpudW0sIHVuc2lnbmVkIGludCAqZGVuKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7Ci0JY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0KLQlpZiAo
ZmItPmZvcm1hdC0+Y3BwWzBdID09IDgpIHsKLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKLQkJCSpudW0gPSAxMDsKLQkJCSpkZW4g
PSA4OwotCQl9IGVsc2UgewotCQkJKm51bSA9IDk7Ci0JCQkqZGVuID0gODsKLQkJfQotCX0gZWxz
ZSB7Ci0JCSpudW0gPSAxOwotCQkqZGVuID0gMTsKLQl9Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3Bs
YW5lX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
LQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQot
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUtPmRldik7Ci0JdW5zaWduZWQgaW50IG51bSwgZGVuOwotCXVuc2lnbmVk
IGludCBwaXhlbF9yYXRlID0gaW50ZWxfcGxhbmVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlLCBwbGFu
ZV9zdGF0ZSk7Ci0KLQlza2xfcGxhbmVfcmF0aW8oY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsICZu
dW0sICZkZW4pOwotCi0JLyogdHdvIHBpeGVscyBwZXIgY2xvY2sgb24gZ2xrKyAqLwotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQotCQlk
ZW4gKj0gMjsKLQotCXJldHVybiBESVZfUk9VTkRfVVAocGl4ZWxfcmF0ZSAqIG51bSwgZGVuKTsK
LX0KLQotc3RhdGljIGludCBza2xfcGxhbmVfbWF4X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiLAotCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwKLQkJCSAgICAgICB1bnNp
Z25lZCBpbnQgcm90YXRpb24pCi17Ci0JaW50IGNwcCA9IGZiLT5mb3JtYXQtPmNwcFtjb2xvcl9w
bGFuZV07Ci0KLQlzd2l0Y2ggKGZiLT5tb2RpZmllcikgewotCWNhc2UgRFJNX0ZPUk1BVF9NT0Rf
TElORUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6Ci0JCS8qCi0JCSAqIFZhbGlk
YXRlZCBsaW1pdCBpcyA0aywgYnV0IGhhcyA1ayBzaG91bGQKLQkJICogd29yayBhcGFydCBmcm9t
IHRoZSBmb2xsb3dpbmcgZmVhdHVyZXM6Ci0JCSAqIC0gWXRpbGUgKGFscmVhZHkgbGltaXRlZCB0
byA0aykKLQkJICogLSBGUDE2IChhbHJlYWR5IGxpbWl0ZWQgdG8gNGspCi0JCSAqIC0gcmVuZGVy
IGNvbXByZXNzaW9uIChhbHJlYWR5IGxpbWl0ZWQgdG8gNGspCi0JCSAqIC0gS1ZNUiBzcHJpdGUg
YW5kIGN1cnNvciAoZG9uJ3QgY2FyZSkKLQkJICogLSBob3Jpem9udGFsIHBhbm5pbmcgKFRPRE8g
dmVyaWZ5IHRoaXMpCi0JCSAqIC0gcGlwZSBhbmQgcGxhbmUgc2NhbGluZyAoVE9ETyB2ZXJpZnkg
dGhpcykKLQkJICovCi0JCWlmIChjcHAgPT0gOCkKLQkJCXJldHVybiA0MDk2OwotCQllbHNlCi0J
CQlyZXR1cm4gNTEyMDsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKLQljYXNl
IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9HRU4xMl9NQ19DQ1M6Ci0JCS8qIEZJWE1FIEFVWCBwbGFuZT8gKi8KLQljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgotCQlp
ZiAoY3BwID09IDgpCi0JCQlyZXR1cm4gMjA0ODsKLQkJZWxzZQotCQkJcmV0dXJuIDQwOTY7Ci0J
ZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGZiLT5tb2RpZmllcik7Ci0JCXJldHVybiAyMDQ4Owot
CX0KLX0KLQotc3RhdGljIGludCBnbGtfcGxhbmVfbWF4X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLAotCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwKLQkJCSAgICAgICB1
bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JaW50IGNwcCA9IGZiLT5mb3JtYXQtPmNwcFtjb2xv
cl9wbGFuZV07Ci0KLQlzd2l0Y2ggKGZiLT5tb2RpZmllcikgewotCWNhc2UgRFJNX0ZPUk1BVF9N
T0RfTElORUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6Ci0JCWlmIChjcHAgPT0g
OCkKLQkJCXJldHVybiA0MDk2OwotCQllbHNlCi0JCQlyZXR1cm4gNTEyMDsKLQljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9D
Q1M6Ci0JCS8qIEZJWE1FIEFVWCBwbGFuZT8gKi8KLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgotCQlpZiAoY3BwID09IDgpCi0J
CQlyZXR1cm4gMjA0ODsKLQkJZWxzZQotCQkJcmV0dXJuIDUxMjA7Ci0JZGVmYXVsdDoKLQkJTUlT
U0lOR19DQVNFKGZiLT5tb2RpZmllcik7Ci0JCXJldHVybiAyMDQ4OwotCX0KLX0KLQotc3RhdGlj
IGludCBpY2xfcGxhbmVfbWluX3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LAotCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwKLQkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90
YXRpb24pCi17Ci0JLyogV2FfMTQwMTEyNjQ2NTcsIFdhXzE0MDExMDUwNTYzOiBnZW4xMSsgKi8K
LQlzd2l0Y2ggKGZiLT5mb3JtYXQtPmZvcm1hdCkgewotCWNhc2UgRFJNX0ZPUk1BVF9DODoKLQkJ
cmV0dXJuIDE4OwotCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0JCXJldHVybiAxMDsKLQljYXNl
IERSTV9GT1JNQVRfWFJHQjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4OgotCWNhc2Ug
RFJNX0ZPUk1BVF9BUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjg4ODg6Ci0JY2FzZSBE
Uk1fRk9STUFUX1hSR0IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMDoKLQlj
YXNlIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1IyMTAxMDEw
OgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfWTIxMjoK
LQljYXNlIERSTV9GT1JNQVRfWTIxNjoKLQkJcmV0dXJuIDY7Ci0JY2FzZSBEUk1fRk9STUFUX05W
MTI6Ci0JCXJldHVybiAyMDsKLQljYXNlIERSTV9GT1JNQVRfUDAxMDoKLQljYXNlIERSTV9GT1JN
QVRfUDAxMjoKLQljYXNlIERSTV9GT1JNQVRfUDAxNjoKLQkJcmV0dXJuIDEyOwotCWNhc2UgRFJN
X0ZPUk1BVF9YUkdCMTYxNjE2MTZGOgotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgot
CWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYx
NjE2MTZGOgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTY6Ci0JY2FzZSBEUk1fRk9S
TUFUX1hWWVUxNjE2MTYxNjoKLQkJcmV0dXJuIDQ7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIDE7Ci0J
fQotfQotCi1zdGF0aWMgaW50IGljbF9wbGFuZV9tYXhfd2lkdGgoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsCi0JCQkgICAgICAgaW50IGNvbG9yX3BsYW5lLAotCQkJICAgICAgIHVu
c2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlyZXR1cm4gNTEyMDsKLX0KLQotc3RhdGljIGludCBz
a2xfcGxhbmVfbWF4X2hlaWdodChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJ
CQlpbnQgY29sb3JfcGxhbmUsCi0JCQkJdW5zaWduZWQgaW50IHJvdGF0aW9uKQotewotCXJldHVy
biA0MDk2OwotfQotCi1zdGF0aWMgaW50IGljbF9wbGFuZV9tYXhfaGVpZ2h0KGNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJCWludCBjb2xvcl9wbGFuZSwKLQkJCQl1bnNpZ25l
ZCBpbnQgcm90YXRpb24pCi17Ci0JcmV0dXJuIDQzMjA7Ci19Ci0KLXN0YXRpYyB1bnNpZ25lZCBp
bnQKLXNrbF9wbGFuZV9tYXhfc3RyaWRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAg
ICAgdTMyIHBpeGVsX2Zvcm1hdCwgdTY0IG1vZGlmaWVyLAotCQkgICAgIHVuc2lnbmVkIGludCBy
b3RhdGlvbikKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICppbmZvID0gZHJtX2Zv
cm1hdF9pbmZvKHBpeGVsX2Zvcm1hdCk7Ci0JaW50IGNwcCA9IGluZm8tPmNwcFswXTsKLQotCS8q
Ci0JICogIlRoZSBzdHJpZGUgaW4gYnl0ZXMgbXVzdCBub3QgZXhjZWVkIHRoZQotCSAqIG9mIHRo
ZSBzaXplIG9mIDhLIHBpeGVscyBhbmQgMzJLIGJ5dGVzLiIKLQkgKi8KLQlpZiAoZHJtX3JvdGF0
aW9uXzkwX29yXzI3MChyb3RhdGlvbikpCi0JCXJldHVybiBtaW4oODE5MiwgMzI3NjggLyBjcHAp
OwotCWVsc2UKLQkJcmV0dXJuIG1pbig4MTkyICogY3BwLCAzMjc2OCk7Ci19Ci0KLXN0YXRpYyB2
b2lkCit2b2lkCiBza2xfcHJvZ3JhbV9zY2FsZXIoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwK
IAkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCkBAIC02NDMsMzE3ICs0
MzgsNiBAQCBza2xfcHJvZ3JhbV9zY2FsZXIoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJ
CSAgKGNydGNfdyA8PCAxNikgfCBjcnRjX2gpOwogfQogCi0vKiBQcmVvZmZzZXQgdmFsdWVzIGZv
ciBZVVYgdG8gUkdCIENvbnZlcnNpb24gKi8KLSNkZWZpbmUgUFJFT0ZGX1lVVl9UT19SR0JfSEkJ
CTB4MTgwMAotI2RlZmluZSBQUkVPRkZfWVVWX1RPX1JHQl9NRQkJMHgwMDAwCi0jZGVmaW5lIFBS
RU9GRl9ZVVZfVE9fUkdCX0xPCQkweDE4MDAKLQotI2RlZmluZSAgUk9GRih4KSAgICAgICAgICAo
KCh4KSAmIDB4ZmZmZikgPDwgMTYpCi0jZGVmaW5lICBHT0ZGKHgpICAgICAgICAgICgoKHgpICYg
MHhmZmZmKSA8PCAwKQotI2RlZmluZSAgQk9GRih4KSAgICAgICAgICAoKCh4KSAmIDB4ZmZmZikg
PDwgMTYpCi0KLS8qCi0gKiBQcm9ncmFtcyB0aGUgaW5wdXQgY29sb3Igc3BhY2UgY29udmVyc2lv
biBzdGFnZSBmb3IgSUNMIEhEUiBwbGFuZXMuCi0gKiBOb3RlIHRoYXQgaXQgaXMgYXNzdW1lZCB0
aGF0IHRoaXMgc3RhZ2UgYWx3YXlzIGhhcHBlbnMgYWZ0ZXIgWVVWCi0gKiByYW5nZSBjb3JyZWN0
aW9uLiBUaHVzLCB0aGUgaW5wdXQgdG8gdGhpcyBzdGFnZSBpcyBhc3N1bWVkIHRvIGJlCi0gKiBp
biBmdWxsLXJhbmdlIFlDYkNyLgotICovCi1zdGF0aWMgdm9pZAotaWNsX3Byb2dyYW1faW5wdXRf
Y3NjKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9IHBsYW5l
LT5waXBlOwotCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7Ci0KLQlzdGF0aWMg
Y29uc3QgdTE2IGlucHV0X2NzY19tYXRyaXhbXVs5XSA9IHsKLQkJLyoKLQkJICogQlQuNjAxIGZ1
bGwgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKLQkJICogVGhlIG1hdHJpeCByZXF1aXJl
ZCBpcyA6Ci0JCSAqIFsxLjAwMCwgMC4wMDAsIDEuMzcxLAotCQkgKiAgMS4wMDAsIC0wLjMzNiwg
LTAuNjk4LAotCQkgKiAgMS4wMDAsIDEuNzMyLCAwLjAwMDBdCi0JCSAqLwotCQlbRFJNX0NPTE9S
X1lDQkNSX0JUNjAxXSA9IHsKLQkJCTB4N0FGOCwgMHg3ODAwLCAweDAsCi0JCQkweDhCMjgsIDB4
NzgwMCwgMHg5QUMwLAotCQkJMHgwLCAweDc4MDAsIDB4N0REOCwKLQkJfSwKLQkJLyoKLQkJICog
QlQuNzA5IGZ1bGwgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKLQkJICogVGhlIG1hdHJp
eCByZXF1aXJlZCBpcyA6Ci0JCSAqIFsxLjAwMCwgMC4wMDAsIDEuNTc0LAotCQkgKiAgMS4wMDAs
IC0wLjE4NywgLTAuNDY4LAotCQkgKiAgMS4wMDAsIDEuODU1LCAwLjAwMDBdCi0JCSAqLwotCQlb
RFJNX0NPTE9SX1lDQkNSX0JUNzA5XSA9IHsKLQkJCTB4N0M5OCwgMHg3ODAwLCAweDAsCi0JCQkw
eDlFRjgsIDB4NzgwMCwgMHhBQzAwLAotCQkJMHgwLCAweDc4MDAsICAweDdFRDgsCi0JCX0sCi0J
CS8qCi0JCSAqIEJULjIwMjAgZnVsbCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdlIFJHQgotCQkg
KiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKLQkJICogWzEuMDAwLCAwLjAwMCwgMS40NzQsCi0J
CSAqICAxLjAwMCwgLTAuMTY0NSwgLTAuNTcxMywKLQkJICogIDEuMDAwLCAxLjg4MTQsIDAuMDAw
MF0KLQkJICovCi0JCVtEUk1fQ09MT1JfWUNCQ1JfQlQyMDIwXSA9IHsKLQkJCTB4N0JDOCwgMHg3
ODAwLCAweDAsCi0JCQkweDg5MjgsIDB4NzgwMCwgMHhBQTg4LAotCQkJMHgwLCAweDc4MDAsIDB4
N0YxMCwKLQkJfSwKLQl9OwotCWNvbnN0IHUxNiAqY3NjID0gaW5wdXRfY3NjX21hdHJpeFtwbGFu
ZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmddOwotCi0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMCksCi0JCQkgIFJPRkYo
Y3NjWzBdKSB8IEdPRkYoY3NjWzFdKSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBM
QU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMSksCi0JCQkgIEJPRkYoY3NjWzJd
KSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihw
aXBlLCBwbGFuZV9pZCwgMiksCi0JCQkgIFJPRkYoY3NjWzNdKSB8IEdPRkYoY3NjWzRdKSk7Ci0J
aW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBw
bGFuZV9pZCwgMyksCi0JCQkgIEJPRkYoY3NjWzVdKSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgNCksCi0JCQkgIFJP
RkYoY3NjWzZdKSB8IEdPRkYoY3NjWzddKSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYs
IFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgNSksCi0JCQkgIEJPRkYoY3Nj
WzhdKSk7Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX1BS
RU9GRihwaXBlLCBwbGFuZV9pZCwgMCksCi0JCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX0hJKTsKLQlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBw
bGFuZV9pZCwgMSksCi0JCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX01FKTsKLQlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBwbGFuZV9pZCwgMiks
Ci0JCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX0xPKTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwKLQkJCSAgUExBTkVfSU5QVVRfQ1NDX1BPU1RPRkYocGlwZSwgcGxhbmVfaWQsIDApLCAweDAp
OwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LAotCQkJICBQTEFORV9JTlBVVF9DU0NfUE9T
VE9GRihwaXBlLCBwbGFuZV9pZCwgMSksIDB4MCk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsCi0JCQkgIFBMQU5FX0lOUFVUX0NTQ19QT1NUT0ZGKHBpcGUsIHBsYW5lX2lkLCAyKSwgMHgw
KTsKLX0KLQotc3RhdGljIHZvaWQKLXNrbF9wbGFuZV9hc3luY19mbGlwKHN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUsCi0JCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCi0JCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSwKLQkJICAgICBib29sIGFzeW5jX2ZsaXApCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCXVuc2lnbmVkIGxvbmcgaXJx
ZmxhZ3M7Ci0JZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKLQllbnVtIHBpcGUg
cGlwZSA9IHBsYW5lLT5waXBlOwotCXUzMiBzdXJmX2FkZHIgPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbMF0ub2Zmc2V0OwotCXUzMiBwbGFuZV9jdGwgPSBwbGFuZV9zdGF0ZS0+Y3RsOwotCi0J
cGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfY3J0YyhjcnRjX3N0YXRlKTsKLQotCWlmIChhc3lu
Y19mbGlwKQotCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0FTWU5DX0ZMSVA7Ci0KLQlzcGluX2xv
Y2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci0KLQlpbnRlbF9k
ZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1RMKHBpcGUsIHBsYW5lX2lkKSwgcGxhbmVfY3Rs
KTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9p
ZCksCi0JCQkgIGludGVsX3BsYW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSArIHN1cmZfYWRk
cik7Ci0KLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGly
cWZsYWdzKTsKLX0KLQotc3RhdGljIHZvaWQKLXNrbF9wcm9ncmFtX3BsYW5lKHN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUsCi0JCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCi0JCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwK
LQkJICBpbnQgY29sb3JfcGxhbmUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQg
PSBwbGFuZS0+aWQ7Ci0JZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5Owot
CXUzMiBzdXJmX2FkZHIgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLm9m
ZnNldDsKLQl1MzIgc3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgY29sb3Jf
cGxhbmUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
Pmh3LmZiOwotCWludCBhdXhfcGxhbmUgPSBpbnRlbF9tYWluX3RvX2F1eF9wbGFuZShmYiwgY29s
b3JfcGxhbmUpOwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7Ci0JaW50
IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKLQl1MzIgeCA9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueDsKLQl1MzIgeSA9IHBsYW5lX3N0YXRlLT5jb2xv
cl9wbGFuZVtjb2xvcl9wbGFuZV0ueTsKLQl1MzIgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxh
bmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKLQl1MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQo
JnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7Ci0JdTggYWxwaGEgPSBwbGFuZV9zdGF0ZS0+
aHcuYWxwaGEgPj4gODsKLQl1MzIgcGxhbmVfY29sb3JfY3RsID0gMCwgYXV4X2Rpc3QgPSAwOwot
CXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7Ci0JdTMyIGtleW1zaywga2V5bWF4OwotCXUzMiBwbGFu
ZV9jdGwgPSBwbGFuZV9zdGF0ZS0+Y3RsOwotCi0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxf
Y3J0YyhjcnRjX3N0YXRlKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElT
X0dFTUlOSUxBS0UoZGV2X3ByaXYpKQotCQlwbGFuZV9jb2xvcl9jdGwgPSBwbGFuZV9zdGF0ZS0+
Y29sb3JfY3RsIHwKLQkJCWdsa19wbGFuZV9jb2xvcl9jdGxfY3J0YyhjcnRjX3N0YXRlKTsKLQot
CS8qIFNpemVzIGFyZSAwIGJhc2VkICovCi0Jc3JjX3ctLTsKLQlzcmNfaC0tOwotCi0Ja2V5bWF4
ID0gKGtleS0+bWF4X3ZhbHVlICYgMHhmZmZmZmYpIHwgUExBTkVfS0VZTUFYX0FMUEhBKGFscGhh
KTsKLQotCWtleW1zayA9IGtleS0+Y2hhbm5lbF9tYXNrICYgMHg3ZmZmZmZmOwotCWlmIChhbHBo
YSA8IDB4ZmYpCi0JCWtleW1zayB8PSBQTEFORV9LRVlNU0tfQUxQSEFfRU5BQkxFOwotCi0JLyog
VGhlIHNjYWxlciB3aWxsIGhhbmRsZSB0aGUgb3V0cHV0IHBvc2l0aW9uICovCi0JaWYgKHBsYW5l
X3N0YXRlLT5zY2FsZXJfaWQgPj0gMCkgewotCQljcnRjX3ggPSAwOwotCQljcnRjX3kgPSAwOwot
CX0KLQotCWlmIChhdXhfcGxhbmUpIHsKLQkJYXV4X2Rpc3QgPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQgLSBzdXJmX2FkZHI7Ci0KLQkJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPCAxMikKLQkJCWF1eF9kaXN0IHw9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3Rh
dGUsIGF1eF9wbGFuZSk7Ci0JfQotCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNv
cmUubG9jaywgaXJxZmxhZ3MpOwotCi0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5F
X1NUUklERShwaXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFBMQU5FX1BPUyhwaXBlLCBwbGFuZV9pZCksCi0JCQkgIChjcnRjX3kgPDwgMTYpIHwg
Y3J0Y194KTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU0laRShwaXBlLCBw
bGFuZV9pZCksCi0JCQkgIChzcmNfaCA8PCAxNikgfCBzcmNfdyk7Ci0KLQlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX0RJU1QocGlwZSwgcGxhbmVfaWQpLCBhdXhfZGlzdCk7
Ci0KLQlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQotCQlpbnRlbF9k
ZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1VTX0NUTChwaXBlLCBwbGFuZV9pZCksCi0JCQkJ
ICBwbGFuZV9zdGF0ZS0+Y3VzX2N0bCk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKLQkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsIFBMQU5FX0NPTE9SX0NUTChwaXBlLCBwbGFuZV9pZCksCi0JCQkJICBwbGFuZV9jb2xvcl9j
dGwpOwotCi0JaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiBpY2xfaXNfaGRyX3BsYW5lKGRldl9w
cml2LCBwbGFuZV9pZCkpCi0JCWljbF9wcm9ncmFtX2lucHV0X2NzYyhwbGFuZSwgY3J0Y19zdGF0
ZSwgcGxhbmVfc3RhdGUpOwotCi0JaWYgKGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0MpCi0JCWludGVsX3VuY29yZV93cml0ZTY0X2Z3KCZkZXZf
cHJpdi0+dW5jb3JlLAotCQkJCQlQTEFORV9DQ19WQUwocGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9z
dGF0ZS0+Y2N2YWwpOwotCi0Jc2tsX3dyaXRlX3BsYW5lX3dtKHBsYW5lLCBjcnRjX3N0YXRlKTsK
LQotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9LRVlWQUwocGlwZSwgcGxhbmVf
aWQpLAotCQkJICBrZXktPm1pbl92YWx1ZSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYs
IFBMQU5FX0tFWU1TSyhwaXBlLCBwbGFuZV9pZCksIGtleW1zayk7Ci0JaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsIFBMQU5FX0tFWU1BWChwaXBlLCBwbGFuZV9pZCksIGtleW1heCk7Ci0KLQlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfT0ZGU0VUKHBpcGUsIHBsYW5lX2lkKSwK
LQkJCSAgKHkgPDwgMTYpIHwgeCk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQot
CQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX09GRlNFVChwaXBlLCBwbGFu
ZV9pZCksCi0JCQkJICAocGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLnkgPDwgMTYpIHwgcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLngpOwotCi0JaWYgKCFkcm1fYXRvbWljX2NydGNfbmVl
ZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSkpCi0JCWludGVsX3BzcjJfcHJvZ3JhbV9wbGFu
ZV9zZWxfZmV0Y2gocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7
Ci0KLQkvKgotCSAqIFRoZSBjb250cm9sIHJlZ2lzdGVyIHNlbGYtYXJtcyBpZiB0aGUgcGxhbmUg
d2FzIHByZXZpb3VzbHkKLQkgKiBkaXNhYmxlZC4gVHJ5IHRvIG1ha2UgdGhlIHBsYW5lIGVuYWJs
ZSBhdG9taWMgYnkgd3JpdGluZwotCSAqIHRoZSBjb250cm9sIHJlZ2lzdGVyIGp1c3QgYmVmb3Jl
IHRoZSBzdXJmYWNlIHJlZ2lzdGVyLgotCSAqLwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9jdGwpOwotCWludGVsX2RlX3dyaXRl
X2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSwKLQkJCSAgaW50ZWxfcGxh
bmVfZ2d0dF9vZmZzZXQocGxhbmVfc3RhdGUpICsgc3VyZl9hZGRyKTsKLQotCWlmIChwbGFuZV9z
dGF0ZS0+c2NhbGVyX2lkID49IDApCi0JCXNrbF9wcm9ncmFtX3NjYWxlcihwbGFuZSwgY3J0Y19z
dGF0ZSwgcGxhbmVfc3RhdGUpOwotCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYt
PnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci19Ci0KLXN0YXRpYyB2b2lkCi1za2xfdXBkYXRlX3Bs
YW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCi17Ci0JaW50IGNvbG9yX3BsYW5lID0gMDsKLQotCWlmIChwbGFuZV9zdGF0
ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZSAmJiAhcGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSkKLQkJ
LyogUHJvZ3JhbSB0aGUgVVYgcGxhbmUgb24gcGxhbmFyIG1hc3RlciAqLwotCQljb2xvcl9wbGFu
ZSA9IDE7Ci0KLQlza2xfcHJvZ3JhbV9wbGFuZShwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3Rh
dGUsIGNvbG9yX3BsYW5lKTsKLX0KLXN0YXRpYyB2b2lkCi1za2xfZGlzYWJsZV9wbGFuZShzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUt
PmlkOwotCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7Ci0JdW5zaWduZWQgbG9uZyBpcnFm
bGFnczsKLQotCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZs
YWdzKTsKLQotCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkpCi0JCWlu
dGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVVNfQ1RMKHBpcGUsIHBsYW5lX2lkKSwg
MCk7Ci0KLQlza2xfd3JpdGVfcGxhbmVfd20ocGxhbmUsIGNydGNfc3RhdGUpOwotCi0JaW50ZWxf
ZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBwbGFuZV9pZCksIDApOwotCWlu
dGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSwgMCk7
Ci0KLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZs
YWdzKTsKLX0KLQotc3RhdGljIGJvb2wKLXNrbF9wbGFuZV9nZXRfaHdfc3RhdGUoc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSwKLQkJICAgICAgIGVudW0gcGlwZSAqcGlwZSkKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0J
ZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47Ci0JZW51bSBwbGFu
ZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQli
b29sIHJldDsKLQotCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9QSVBFKHBsYW5lLT5waXBl
KTsKLQl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZfcHJp
diwgcG93ZXJfZG9tYWluKTsKLQlpZiAoIXdha2VyZWYpCi0JCXJldHVybiBmYWxzZTsKLQotCXJl
dCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX0NUTChwbGFuZS0+cGlwZSwgcGxhbmVf
aWQpKSAmIFBMQU5FX0NUTF9FTkFCTEU7Ci0KLQkqcGlwZSA9IHBsYW5lLT5waXBlOwotCi0JaW50
ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbiwgd2FrZXJlZik7Ci0K
LQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgdm9pZAotc2tsX3BsYW5lX2VuYWJsZV9mbGlwX2Rv
bmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9IHBs
YW5lLT5waXBlOwotCi0Jc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwotCWJkd19lbmFi
bGVfcGlwZV9pcnEoaTkxNSwgcGlwZSwgR0VOOV9QSVBFX1BMQU5FX0ZMSVBfRE9ORShwbGFuZS0+
aWQpKTsKLQlzcGluX3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKLX0KLQotc3RhdGljIHZv
aWQKLXNrbF9wbGFuZV9kaXNhYmxlX2ZsaXBfZG9uZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShwbGFuZS0+YmFz
ZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7Ci0KLQlzcGluX2xvY2tfaXJx
KCZpOTE1LT5pcnFfbG9jayk7Ci0JYmR3X2Rpc2FibGVfcGlwZV9pcnEoaTkxNSwgcGlwZSwgR0VO
OV9QSVBFX1BMQU5FX0ZMSVBfRE9ORShwbGFuZS0+aWQpKTsKLQlzcGluX3VubG9ja19pcnEoJmk5
MTUtPmlycV9sb2NrKTsKLX0KLQogc3RhdGljIHZvaWQgaTl4eF9wbGFuZV9saW5lYXJfZ2FtbWEo
dTE2IGdhbW1hWzhdKQogewogCS8qIFRoZSBwb2ludHMgYXJlIG5vdCBldmVubHkgc3BhY2VkLiAq
LwpAQCAtMjI5NywyNTMgKzE3ODEsMTkgQEAgdmx2X3Nwcml0ZV9jaGVjayhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGJvb2wgaW50
ZWxfZm9ybWF0X2lzX3AwMXgodTMyIGZvcm1hdCkKK3N0YXRpYyBib29sIGhhc19kc3Rfa2V5X2lu
X3ByaW1hcnlfcGxhbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCXN3
aXRjaCAoZm9ybWF0KSB7Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFU
X1AwMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTY6Ci0JCXJldHVybiB0cnVlOwotCWRlZmF1bHQ6
Ci0JCXJldHVybiBmYWxzZTsKLQl9CisJcmV0dXJuIElOVEVMX0dFTihkZXZfcHJpdikgPj0gOTsK
IH0KIAotc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfZmIoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQorc3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfc2V0X2NrZXkoc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJCQkgY29uc3Qgc3RydWN0IGRy
bV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKnNldCkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQl1
bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0Jc3RydWN0
IGRybV9mb3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7CisJc3RydWN0IGRybV9pbnRlbF9zcHJp
dGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAotCWlmICghZmIpCi0JCXJl
dHVybiAwOwotCi0JaWYgKHJvdGF0aW9uICYgfihEUk1fTU9ERV9ST1RBVEVfMCB8IERSTV9NT0RF
X1JPVEFURV8xODApICYmCi0JICAgIGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7Ci0J
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJSQyBzdXBwb3J0IG9ubHkgd2l0
aCAwLzE4MCBkZWdyZWUgcm90YXRpb24gKCV4KVxuIiwKLQkJCSAgICByb3RhdGlvbik7Ci0JCXJl
dHVybiAtRUlOVkFMOwotCX0KLQotCWlmIChyb3RhdGlvbiAmIERSTV9NT0RFX1JFRkxFQ1RfWCAm
JgotCSAgICBmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSKSB7Ci0JCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJob3Jpem9udGFsIGZsaXAgaXMgbm90IHN1
cHBvcnRlZCB3aXRoIGxpbmVhciBzdXJmYWNlIGZvcm1hdHNcbiIpOwotCQlyZXR1cm4gLUVJTlZB
TDsKLQl9Ci0KLQlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikpIHsKLQkJaWYg
KGZiLT5tb2RpZmllciAhPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCAmJgotCQkgICAgZmItPm1v
ZGlmaWVyICE9IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCkgewotCQkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sCi0JCQkJICAgICJZL1lmIHRpbGluZyByZXF1aXJlZCBmb3IgOTAvMjcwIVxu
Iik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsKLQkJfQotCi0JCS8qCi0JCSAqIDkwLzI3MCBpcyBub3Qg
YWxsb3dlZCB3aXRoIFJHQjY0IDE2OjE2OjE2OjE2IGFuZAotCQkgKiBJbmRleGVkIDgtYml0LiBS
R0IgMTYtYml0IDU6Njo1IGlzIGFsbG93ZWQgZ2VuMTEgb253YXJkcy4KLQkJICovCi0JCXN3aXRj
aCAoZmItPmZvcm1hdC0+Zm9ybWF0KSB7Ci0JCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0JCQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKLQkJCQlicmVhazsKLQkJCWZhbGx0aHJvdWdo
OwotCQljYXNlIERSTV9GT1JNQVRfQzg6Ci0JCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZG
OgotCQljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKLQkJY2FzZSBEUk1fRk9STUFUX0FS
R0IxNjE2MTYxNkY6Ci0JCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOgotCQljYXNlIERS
TV9GT1JNQVRfWTIxMDoKLQkJY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0JCWNhc2UgRFJNX0ZPUk1B
VF9ZMjE2OgotCQljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2OgotCQljYXNlIERSTV9G
T1JNQVRfWFZZVTE2MTYxNjE2OgotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkJ
ICAgICJVbnN1cHBvcnRlZCBwaXhlbCBmb3JtYXQgJXMgZm9yIDkwLzI3MCFcbiIsCi0JCQkJICAg
IGRybV9nZXRfZm9ybWF0X25hbWUoZmItPmZvcm1hdC0+Zm9ybWF0LAotCQkJCQkJCSZmb3JtYXRf
bmFtZSkpOwotCQkJcmV0dXJuIC1FSU5WQUw7Ci0JCWRlZmF1bHQ6Ci0JCQlicmVhazsKLQkJfQot
CX0KLQotCS8qIFktdGlsaW5nIGlzIG5vdCBzdXBwb3J0ZWQgaW4gSUYtSUQgSW50ZXJsYWNlIG1v
ZGUgKi8KLQlpZiAoY3J0Y19zdGF0ZS0+aHcuZW5hYmxlICYmCi0JICAgIGNydGNfc3RhdGUtPmh3
LmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSAmJgotCSAgICAo
ZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEIHx8Ci0JICAgICBmYi0+bW9k
aWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEIHx8Ci0JICAgICBmYi0+bW9kaWZpZXIg
PT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTIHx8Ci0JICAgICBmYi0+bW9kaWZpZXIgPT0g
STkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUyB8fAotCSAgICAgZmItPm1vZGlmaWVyID09IEk5
MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyB8fAotCSAgICAgZmItPm1vZGlmaWVy
ID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUyB8fAotCSAgICAgZmItPm1v
ZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQykpIHsKLQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlkvWWYgdGlsaW5nIG5vdCBzdXBw
b3J0ZWQgaW4gSUYtSUQgbW9kZVxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCS8qIFdh
XzE2MDYwNTQxODg6dGdsLGFkbC1zICovCi0JaWYgKChJU19BTERFUkxBS0VfUyhkZXZfcHJpdikg
fHwgSVNfVElHRVJMQUtFKGRldl9wcml2KSkgJiYKLQkgICAgcGxhbmVfc3RhdGUtPmNrZXkuZmxh
Z3MgJiBJOTE1X1NFVF9DT0xPUktFWV9TT1VSQ0UgJiYKLQkgICAgaW50ZWxfZm9ybWF0X2lzX3Aw
MXgoZmItPmZvcm1hdC0+Zm9ybWF0KSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwK
LQkJCSAgICAiU291cmNlIGNvbG9yIGtleWluZyBub3Qgc3VwcG9ydGVkIHdpdGggUDAxeCBmb3Jt
YXRzXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRp
YyBpbnQgc2tsX3BsYW5lX2NoZWNrX2RzdF9jb29yZGluYXRlcyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwotCWludCBjcnRj
X3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7Ci0JaW50IGNydGNfdyA9IGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwotCWludCBwaXBlX3NyY193ID0gY3J0Y19zdGF0
ZS0+cGlwZV9zcmNfdzsKLQotCS8qCi0JICogRGlzcGxheSBXQSAjMTE3NTogY25sLGdsawotCSAq
IFBsYW5lcyBvdGhlciB0aGFuIHRoZSBjdXJzb3IgbWF5IGNhdXNlIEZJRk8gdW5kZXJmbG93IGFu
ZCBkaXNwbGF5Ci0JICogY29ycnVwdGlvbiBpZiBzdGFydGluZyBsZXNzIHRoYW4gNCBwaXhlbHMg
ZnJvbSB0aGUgcmlnaHQgZWRnZSBvZgotCSAqIHRoZSBzY3JlZW4uCi0JICogQmVzaWRlcyB0aGUg
YWJvdmUgV0EgZml4IHRoZSBzaW1pbGFyIHByb2JsZW0sIHdoZXJlIHBsYW5lcyBvdGhlcgotCSAq
IHRoYW4gdGhlIGN1cnNvciBlbmRpbmcgbGVzcyB0aGFuIDQgcGl4ZWxzIGZyb20gdGhlIGxlZnQg
ZWRnZSBvZiB0aGUKLQkgKiBzY3JlZW4gbWF5IGNhdXNlIEZJRk8gdW5kZXJmbG93IGFuZCBkaXNw
bGF5IGNvcnJ1cHRpb24uCi0JICovCi0JaWYgKChJU19HRU1JTklMQUtFKGRldl9wcml2KSB8fCBJ
U19DQU5OT05MQUtFKGRldl9wcml2KSkgJiYKLQkgICAgKGNydGNfeCArIGNydGNfdyA8IDQgfHwg
Y3J0Y194ID4gcGlwZV9zcmNfdyAtIDQpKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJt
LAotCQkJICAgICJyZXF1ZXN0ZWQgcGxhbmUgWCAlcyBwb3NpdGlvbiAlZCBpbnZhbGlkICh2YWxp
ZCByYW5nZSAlZC0lZClcbiIsCi0JCQkgICAgY3J0Y194ICsgY3J0Y193IDwgNCA/ICJlbmQiIDog
InN0YXJ0IiwKLQkJCSAgICBjcnRjX3ggKyBjcnRjX3cgPCA0ID8gY3J0Y194ICsgY3J0Y193IDog
Y3J0Y194LAotCQkJICAgIDQsIHBpcGVfc3JjX3cgLSA0KTsKLQkJcmV0dXJuIC1FUkFOR0U7Ci0J
fQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrX252MTJfcm90
YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQl1
bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JaW50IHNy
Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7Ci0KLQkv
KiBEaXNwbGF5IFdBICMxMTA2ICovCi0JaWYgKGludGVsX2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1p
cGxhbmFyKGZiLT5mb3JtYXQsIGZiLT5tb2RpZmllcikgJiYKLQkgICAgc3JjX3cgJiAzICYmCi0J
ICAgIChyb3RhdGlvbiA9PSBEUk1fTU9ERV9ST1RBVEVfMjcwIHx8Ci0JICAgICByb3RhdGlvbiA9
PSAoRFJNX01PREVfUkVGTEVDVF9YIHwgRFJNX01PREVfUk9UQVRFXzkwKSkpIHsKLQkJRFJNX0RF
QlVHX0tNUygic3JjIHdpZHRoIG11c3QgYmUgbXVsdGlwbGUgb2YgNCBmb3Igcm90YXRlZCBwbGFu
YXIgWVVWXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0
YXRpYyBpbnQgc2tsX3BsYW5lX21heF9zY2FsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCi17Ci0J
LyoKLQkgKiBXZSBkb24ndCB5ZXQga25vdyB0aGUgZmluYWwgc291cmNlIHdpZHRoIG5vcgotCSAq
IHdoZXRoZXIgd2UgY2FuIHVzZSB0aGUgSFEgc2NhbGVyIG1vZGUuIEFzc3VtZQotCSAqIHRoZSBi
ZXN0IGNhc2UuCi0JICogRklYTUUgbmVlZCB0byBwcm9wZXJseSBjaGVjayB0aGlzIGxhdGVyLgot
CSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2
X3ByaXYpIHx8Ci0JICAgICFpbnRlbF9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+
Zm9ybWF0LCBmYi0+bW9kaWZpZXIpKQotCQlyZXR1cm4gMHgzMDAwMCAtIDE7Ci0JZWxzZQotCQly
ZXR1cm4gMHgyMDAwMCAtIDE7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJICAgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQlpbnQgbWluX3Nj
YWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOwotCWludCBtYXhfc2NhbGUgPSBEUk1f
UExBTkVfSEVMUEVSX05PX1NDQUxJTkc7Ci0JaW50IHJldDsKLQotCXJldCA9IHNrbF9wbGFuZV9j
aGVja19mYihjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJl
dDsKLQotCS8qIHVzZSBzY2FsZXIgd2hlbiBjb2xvcmtleSBpcyBub3QgcmVxdWlyZWQgKi8KLQlp
ZiAoIXBsYW5lX3N0YXRlLT5ja2V5LmZsYWdzICYmIGludGVsX2ZiX3NjYWxhYmxlKGZiKSkgewot
CQltaW5fc2NhbGUgPSAxOwotCQltYXhfc2NhbGUgPSBza2xfcGxhbmVfbWF4X3NjYWxlKGRldl9w
cml2LCBmYik7Ci0JfQotCi0JcmV0ID0gaW50ZWxfYXRvbWljX3BsYW5lX2NoZWNrX2NsaXBwaW5n
KHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlLAotCQkJCQkJbWluX3NjYWxlLCBtYXhfc2NhbGUsIHRy
dWUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBza2xfY2hlY2tfcGxhbmVf
c3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWlmICgh
cGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKLQkJcmV0dXJuIDA7Ci0KLQlyZXQgPSBza2xfcGxh
bmVfY2hlY2tfZHN0X2Nvb3JkaW5hdGVzKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKLQlpZiAo
cmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3Jk
aW5hdGVzKHBsYW5lX3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0g
c2tsX3BsYW5lX2NoZWNrX252MTJfcm90YXRpb24ocGxhbmVfc3RhdGUpOwotCWlmIChyZXQpCi0J
CXJldHVybiByZXQ7Ci0KLQkvKiBIVyBvbmx5IGhhcyA4IGJpdHMgcGl4ZWwgcHJlY2lzaW9uLCBk
aXNhYmxlIHBsYW5lIGlmIGludmlzaWJsZSAqLwotCWlmICghKHBsYW5lX3N0YXRlLT5ody5hbHBo
YSA+PiA4KSkKLQkJcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSA9IGZhbHNlOwotCi0JcGxhbmVf
c3RhdGUtPmN0bCA9IHNrbF9wbGFuZV9jdGwoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwotCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikp
Ci0JCXBsYW5lX3N0YXRlLT5jb2xvcl9jdGwgPSBnbGtfcGxhbmVfY29sb3JfY3RsKGNydGNfc3Rh
dGUsCi0JCQkJCQkJICAgICBwbGFuZV9zdGF0ZSk7Ci0KLQlpZiAoaW50ZWxfZm9ybWF0X2luZm9f
aXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyKSAmJgotCSAgICBpY2xf
aXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZS0+aWQpKQotCQkvKiBFbmFibGUgYW5kIHVzZSBN
UEVHLTIgY2hyb21hIHNpdGluZyAqLwotCQlwbGFuZV9zdGF0ZS0+Y3VzX2N0bCA9IFBMQU5FX0NV
U19FTkFCTEUgfAotCQkJUExBTkVfQ1VTX0hQSEFTRV8wIHwKLQkJCVBMQU5FX0NVU19WUEhBU0Vf
U0lHTl9ORUdBVElWRSB8IFBMQU5FX0NVU19WUEhBU0VfMF8yNTsKLQllbHNlCi0JCXBsYW5lX3N0
YXRlLT5jdXNfY3RsID0gMDsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgYm9vbCBoYXNfZHN0
X2tleV9pbl9wcmltYXJ5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
LXsKLQlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSA5OwotfQotCi1zdGF0aWMgdm9pZCBp
bnRlbF9wbGFuZV9zZXRfY2tleShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
LAotCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqc2V0KQotewot
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShwbGFuZS0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICpr
ZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7Ci0KLQkqa2V5ID0gKnNldDsKKwkqa2V5ID0gKnNldDsK
IAogCS8qCiAJICogV2Ugd2FudCBzcmMga2V5IGVuYWJsZWQgb24gdGhlCkBAIC0yNzA4LDE4NiAr
MTk1OCw2IEBAIHN0YXRpYyBjb25zdCB1MzIgY2h2X3BpcGVfYl9zcHJpdGVfZm9ybWF0c1tdID0g
ewogCURSTV9GT1JNQVRfVllVWSwKIH07CiAKLXN0YXRpYyBjb25zdCB1MzIgc2tsX3BsYW5lX2Zv
cm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAotCURSTV9GT1JNQVRfUkdCNTY1LAotCURSTV9G
T1JNQVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9YQkdSODg4OCwKLQlEUk1fRk9STUFUX0FSR0I4
ODg4LAotCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKLQlE
Uk1fRk9STUFUX1hCR1IyMTAxMDEwLAotCURSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RiwKLQlEUk1f
Rk9STUFUX1hCR1IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9ZVVlWLAotCURSTV9GT1JNQVRfWVZZ
VSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9WWVVZLAotCURSTV9GT1JNQVRfWFlV
Vjg4ODgsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIHNrbF9wbGFuYXJfZm9ybWF0c1tdID0gewot
CURSTV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9YUkdCODg4
OCwKLQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgsCi0JRFJNX0ZP
Uk1BVF9BQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9GT1JNQVRfWEJH
UjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAotCURSTV9GT1JNQVRfWEJHUjE2
MTYxNjE2RiwKLQlEUk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZPUk1BVF9ZVllVLAotCURSTV9GT1JN
QVRfVVlWWSwKLQlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9OVjEyLAotCURSTV9GT1JN
QVRfWFlVVjg4ODgsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIGdsa19wbGFuYXJfZm9ybWF0c1td
ID0gewotCURSTV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9Y
UkdCODg4OCwKLQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgsCi0J
RFJNX0ZPUk1BVF9BQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9GT1JN
QVRfWEJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAotCURSTV9GT1JNQVRf
WEJHUjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZPUk1BVF9ZVllVLAotCURS
TV9GT1JNQVRfVVlWWSwKLQlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9OVjEyLAotCURS
TV9GT1JNQVRfWFlVVjg4ODgsCi0JRFJNX0ZPUk1BVF9QMDEwLAotCURSTV9GT1JNQVRfUDAxMiwK
LQlEUk1fRk9STUFUX1AwMTYsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIGljbF9zZHJfeV9wbGFu
ZV9mb3JtYXRzW10gPSB7Ci0JRFJNX0ZPUk1BVF9DOCwKLQlEUk1fRk9STUFUX1JHQjU2NSwKLQlE
Uk1fRk9STUFUX1hSR0I4ODg4LAotCURSTV9GT1JNQVRfWEJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9B
UkdCODg4OCwKLQlEUk1fRk9STUFUX0FCR1I4ODg4LAotCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAs
Ci0JRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKLQlEUk1fRk9STUFUX0FSR0IyMTAxMDEwLAotCURS
TV9GT1JNQVRfQUJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9ZVVlWLAotCURSTV9GT1JNQVRfWVZZ
VSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9WWVVZLAotCURSTV9GT1JNQVRfWTIx
MCwKLQlEUk1fRk9STUFUX1kyMTIsCi0JRFJNX0ZPUk1BVF9ZMjE2LAotCURSTV9GT1JNQVRfWFlV
Vjg4ODgsCi0JRFJNX0ZPUk1BVF9YVllVMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hWWVUxMl8xNjE2
MTYxNiwKLQlEUk1fRk9STUFUX1hWWVUxNjE2MTYxNiwKLX07Ci0KLXN0YXRpYyBjb25zdCB1MzIg
aWNsX3Nkcl91dl9wbGFuZV9mb3JtYXRzW10gPSB7Ci0JRFJNX0ZPUk1BVF9DOCwKLQlEUk1fRk9S
TUFUX1JHQjU2NSwKLQlEUk1fRk9STUFUX1hSR0I4ODg4LAotCURSTV9GT1JNQVRfWEJHUjg4ODgs
Ci0JRFJNX0ZPUk1BVF9BUkdCODg4OCwKLQlEUk1fRk9STUFUX0FCR1I4ODg4LAotCURSTV9GT1JN
QVRfWFJHQjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKLQlEUk1fRk9STUFUX0FS
R0IyMTAxMDEwLAotCURSTV9GT1JNQVRfQUJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9ZVVlWLAot
CURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9WWVVZLAot
CURSTV9GT1JNQVRfTlYxMiwKLQlEUk1fRk9STUFUX1AwMTAsCi0JRFJNX0ZPUk1BVF9QMDEyLAot
CURSTV9GT1JNQVRfUDAxNiwKLQlEUk1fRk9STUFUX1kyMTAsCi0JRFJNX0ZPUk1BVF9ZMjEyLAot
CURSTV9GT1JNQVRfWTIxNiwKLQlEUk1fRk9STUFUX1hZVVY4ODg4LAotCURSTV9GT1JNQVRfWFZZ
VTIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTYsCi0JRFJNX0ZPUk1BVF9YVllV
MTYxNjE2MTYsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIGljbF9oZHJfcGxhbmVfZm9ybWF0c1td
ID0gewotCURSTV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9Y
UkdCODg4OCwKLQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgsCi0J
RFJNX0ZPUk1BVF9BQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9GT1JN
QVRfWEJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX0FC
R1IyMTAxMDEwLAotCURSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1hCR1Ix
NjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGLAotCURSTV9GT1JNQVRfQUJHUjE2
MTYxNjE2RiwKLQlEUk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZPUk1BVF9ZVllVLAotCURSTV9GT1JN
QVRfVVlWWSwKLQlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9OVjEyLAotCURSTV9GT1JN
QVRfUDAxMCwKLQlEUk1fRk9STUFUX1AwMTIsCi0JRFJNX0ZPUk1BVF9QMDE2LAotCURSTV9GT1JN
QVRfWTIxMCwKLQlEUk1fRk9STUFUX1kyMTIsCi0JRFJNX0ZPUk1BVF9ZMjE2LAotCURSTV9GT1JN
QVRfWFlVVjg4ODgsCi0JRFJNX0ZPUk1BVF9YVllVMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hWWVUx
Ml8xNjE2MTYxNiwKLQlEUk1fRk9STUFUX1hWWVUxNjE2MTYxNiwKLX07Ci0KLXN0YXRpYyBjb25z
dCB1NjQgc2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbm9jY3NbXSA9IHsKLQlJOTE1X0ZPUk1B
VF9NT0RfWWZfVElMRUQsCi0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCi0JSTkxNV9GT1JNQVRf
TU9EX1hfVElMRUQsCi0JRFJNX0ZPUk1BVF9NT0RfTElORUFSLAotCURSTV9GT1JNQVRfTU9EX0lO
VkFMSUQKLX07Ci0KLXN0YXRpYyBjb25zdCB1NjQgc2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNf
Y2NzW10gPSB7Ci0JSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUywKLQlJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRF9DQ1MsCi0JSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVELAotCUk5MTVfRk9STUFU
X01PRF9ZX1RJTEVELAotCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAotCURSTV9GT1JNQVRfTU9E
X0xJTkVBUiwKLQlEUk1fRk9STUFUX01PRF9JTlZBTElECi19OwotCi1zdGF0aWMgY29uc3QgdTY0
IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbWNfY2NzW10gPSB7Ci0JSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTLAotCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEy
X1JDX0NDUywKLQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0MsCi0JSTkx
NV9GT1JNQVRfTU9EX1lfVElMRUQsCi0JSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCi0JRFJNX0ZP
Uk1BVF9NT0RfTElORUFSLAotCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKLX07Ci0KLXN0YXRpYyBj
b25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19yY19jY3NbXSA9IHsKLQlJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCi0JSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfR0VOMTJfUkNfQ0NTX0NDLAotCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVELAotCUk5MTVfRk9S
TUFUX01PRF9YX1RJTEVELAotCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwKLQlEUk1fRk9STUFUX01P
RF9JTlZBTElECi19OwotCiBzdGF0aWMgYm9vbCBnNHhfc3ByaXRlX2Zvcm1hdF9tb2Rfc3VwcG9y
dGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAkJCQkJICAgIHUzMiBmb3JtYXQsIHU2NCBt
b2RpZmllcikKIHsKQEAgLTI5ODAsMTUwICsyMDUwLDYgQEAgc3RhdGljIGJvb2wgdmx2X3Nwcml0
ZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJfQogfQog
Ci1zdGF0aWMgYm9vbCBza2xfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9w
bGFuZSAqX3BsYW5lLAotCQkJCQkgICB1MzIgZm9ybWF0LCB1NjQgbW9kaWZpZXIpCi17Ci0Jc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9wbGFuZSk7Ci0KLQlzd2l0
Y2ggKG1vZGlmaWVyKSB7Ci0JY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6Ci0JY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWF9USUxFRDoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgotCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgotCQlicmVhazsKLQljYXNlIEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0NDUzoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6Ci0J
CWlmICghcGxhbmUtPmhhc19jY3MpCi0JCQlyZXR1cm4gZmFsc2U7Ci0JCWJyZWFrOwotCWRlZmF1
bHQ6Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci0KLQlzd2l0Y2ggKGZvcm1hdCkgewotCWNhc2UgRFJN
X0ZPUk1BVF9YUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6Ci0JY2FzZSBEUk1f
Rk9STUFUX0FSR0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKLQkJaWYgKGlzX2Nj
c19tb2RpZmllcihtb2RpZmllcikpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7Ci0J
Y2FzZSBEUk1fRk9STUFUX1JHQjU2NToKLQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6Ci0J
Y2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAx
MDoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1lVWVY6
Ci0JY2FzZSBEUk1fRk9STUFUX1lWWVU6Ci0JY2FzZSBEUk1fRk9STUFUX1VZVlk6Ci0JY2FzZSBE
Uk1fRk9STUFUX1ZZVVk6Ci0JY2FzZSBEUk1fRk9STUFUX05WMTI6Ci0JY2FzZSBEUk1fRk9STUFU
X1hZVVY4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9QMDEy
OgotCWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoK
LQkJaWYgKG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCkKLQkJCXJldHVybiB0
cnVlOwotCQlmYWxsdGhyb3VnaDsKLQljYXNlIERSTV9GT1JNQVRfQzg6Ci0JY2FzZSBEUk1fRk9S
TUFUX1hCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6Ci0JY2Fz
ZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYx
NkY6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0JY2Fz
ZSBEUk1fRk9STUFUX1kyMTY6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKLQlj
YXNlIERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgotCQlpZiAobW9kaWZpZXIgPT0gRFJNX0ZPUk1B
VF9NT0RfTElORUFSIHx8Ci0JCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxF
RCB8fAotCQkgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQpCi0JCQlyZXR1
cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIGZhbHNlOwotCX0K
LX0KLQotc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsK
LQkvKiBXYV8xNDAxMDQ3NzAwODp0Z2xbYTAuLmMwXSxya2xbYWxsXSxkZzFbYWxsXSAqLwotCWlm
IChJU19ERzEoZGV2X3ByaXYpIHx8IElTX1JPQ0tFVExBS0UoZGV2X3ByaXYpIHx8Ci0JICAgIElT
X1RHTF9ESVNQX1NURVBQSU5HKGRldl9wcml2LCBTVEVQX0EwLCBTVEVQX0MwKSkKLQkJcmV0dXJu
IGZhbHNlOwotCi0JcmV0dXJuIHBsYW5lX2lkIDwgUExBTkVfU1BSSVRFNDsKLX0KLQotc3RhdGlj
IGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAq
X3BsYW5lLAotCQkJCQkgICAgIHUzMiBmb3JtYXQsIHU2NCBtb2RpZmllcikKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KF9wbGFuZS0+ZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUoX3BsYW5lKTsKLQotCXN3aXRj
aCAobW9kaWZpZXIpIHsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0ND
UzoKLQkJaWYgKCFnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3ByaXYsIHBsYW5lLT5p
ZCkpCi0JCQlyZXR1cm4gZmFsc2U7Ci0JCWZhbGx0aHJvdWdoOwotCWNhc2UgRFJNX0ZPUk1BVF9N
T0RfTElORUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6Ci0JY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRDoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JD
X0NDUzoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQzoKLQkJ
YnJlYWs7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIGZhbHNlOwotCX0KLQotCXN3aXRjaCAoZm9ybWF0
KSB7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4
ODoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4
OgotCQlpZiAoaXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKLQkJCXJldHVybiB0cnVlOwotCQlm
YWxsdGhyb3VnaDsKLQljYXNlIERSTV9GT1JNQVRfWVVZVjoKLQljYXNlIERSTV9GT1JNQVRfWVZZ
VToKLQljYXNlIERSTV9GT1JNQVRfVVlWWToKLQljYXNlIERSTV9GT1JNQVRfVllVWToKLQljYXNl
IERSTV9GT1JNQVRfTlYxMjoKLQljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6Ci0JY2FzZSBEUk1f
Rk9STUFUX1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1Aw
MTY6Ci0JCWlmIChtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19D
Q1MpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7Ci0JY2FzZSBEUk1fRk9STUFUX1JH
QjU2NToKLQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1hC
R1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKLQljYXNlIERSTV9GT1JN
QVRfQUJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgotCWNhc2UgRFJN
X0ZPUk1BVF9DODoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9G
T1JNQVRfQUJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKLQlj
YXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfWTIxMDoKLQlj
YXNlIERSTV9GT1JNQVRfWTIxMjoKLQljYXNlIERSTV9GT1JNQVRfWTIxNjoKLQljYXNlIERSTV9G
T1JNQVRfWFZZVTEyXzE2MTYxNjE2OgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6Ci0J
CWlmIChtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIgfHwKLQkJICAgIG1vZGlmaWVy
ID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEIHx8Ci0JCSAgICBtb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRCkKLQkJCXJldHVybiB0cnVlOwotCQlmYWxsdGhyb3VnaDsKLQlkZWZh
dWx0OgotCQlyZXR1cm4gZmFsc2U7Ci0JfQotfQotCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9w
bGFuZV9mdW5jcyBnNHhfc3ByaXRlX2Z1bmNzID0gewogCS51cGRhdGVfcGxhbmUgPSBkcm1fYXRv
bWljX2hlbHBlcl91cGRhdGVfcGxhbmUsCiAJLmRpc2FibGVfcGxhbmUgPSBkcm1fYXRvbWljX2hl
bHBlcl9kaXNhYmxlX3BsYW5lLApAQCAtMzE1MSwyNTcgKzIwNzcsNiBAQCBzdGF0aWMgY29uc3Qg
c3RydWN0IGRybV9wbGFuZV9mdW5jcyB2bHZfc3ByaXRlX2Z1bmNzID0gewogCS5mb3JtYXRfbW9k
X3N1cHBvcnRlZCA9IHZsdl9zcHJpdGVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCiB9OwogCi1zdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBza2xfcGxhbmVfZnVuY3MgPSB7Ci0JLnVw
ZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwKLQkuZGlzYWJsZV9w
bGFuZSA9IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsCi0JLmRlc3Ryb3kgPSBpbnRl
bF9wbGFuZV9kZXN0cm95LAotCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gaW50ZWxfcGxhbmVf
ZHVwbGljYXRlX3N0YXRlLAotCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGludGVsX3BsYW5lX2Rl
c3Ryb3lfc3RhdGUsCi0JLmZvcm1hdF9tb2Rfc3VwcG9ydGVkID0gc2tsX3BsYW5lX2Zvcm1hdF9t
b2Rfc3VwcG9ydGVkLAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3Mg
Z2VuMTJfcGxhbmVfZnVuY3MgPSB7Ci0JLnVwZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVy
X3VwZGF0ZV9wbGFuZSwKLQkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX2Rpc2Fi
bGVfcGxhbmUsCi0JLmRlc3Ryb3kgPSBpbnRlbF9wbGFuZV9kZXN0cm95LAotCS5hdG9taWNfZHVw
bGljYXRlX3N0YXRlID0gaW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRlLAotCS5hdG9taWNfZGVz
dHJveV9zdGF0ZSA9IGludGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCi0JLmZvcm1hdF9tb2Rfc3Vw
cG9ydGVkID0gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCi19OwotCi1zdGF0aWMg
Ym9vbCBza2xfcGxhbmVfaGFzX2ZiYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Ci0JCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsKLQlp
ZiAoIUhBU19GQkMoZGV2X3ByaXYpKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlyZXR1cm4gcGlwZSA9
PSBQSVBFX0EgJiYgcGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWTsKLX0KLQotc3RhdGljIGJvb2wg
c2tsX3BsYW5lX2hhc19wbGFuYXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAot
CQkJCSBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsKLQkvKiBEaXNw
bGF5IFdBICMwODcwOiBza2wsIGJ4dCAqLwotCWlmIChJU19TS1lMQUtFKGRldl9wcml2KSB8fCBJ
U19CUk9YVE9OKGRldl9wcml2KSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JaWYgKElTX0dFTihkZXZf
cHJpdiwgOSkgJiYgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpICYmIHBpcGUgPT0gUElQRV9DKQot
CQlyZXR1cm4gZmFsc2U7Ci0KLQlpZiAocGxhbmVfaWQgIT0gUExBTkVfUFJJTUFSWSAmJiBwbGFu
ZV9pZCAhPSBQTEFORV9TUFJJVEUwKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlyZXR1cm4gdHJ1ZTsK
LX0KLQotc3RhdGljIGNvbnN0IHUzMiAqc2tsX2dldF9wbGFuZV9mb3JtYXRzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVf
aWQgcGxhbmVfaWQsCi0JCQkJCWludCAqbnVtX2Zvcm1hdHMpCi17Ci0JaWYgKHNrbF9wbGFuZV9o
YXNfcGxhbmFyKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCkpIHsKLQkJKm51bV9mb3JtYXRzID0g
QVJSQVlfU0laRShza2xfcGxhbmFyX2Zvcm1hdHMpOwotCQlyZXR1cm4gc2tsX3BsYW5hcl9mb3Jt
YXRzOwotCX0gZWxzZSB7Ci0JCSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoc2tsX3BsYW5lX2Zv
cm1hdHMpOwotCQlyZXR1cm4gc2tsX3BsYW5lX2Zvcm1hdHM7Ci0JfQotfQotCi1zdGF0aWMgY29u
c3QgdTMyICpnbGtfZ2V0X3BsYW5lX2Zvcm1hdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAotCQkJCQllbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCwKLQkJ
CQkJaW50ICpudW1fZm9ybWF0cykKLXsKLQlpZiAoc2tsX3BsYW5lX2hhc19wbGFuYXIoZGV2X3By
aXYsIHBpcGUsIHBsYW5lX2lkKSkgewotCQkqbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKGdsa19w
bGFuYXJfZm9ybWF0cyk7Ci0JCXJldHVybiBnbGtfcGxhbmFyX2Zvcm1hdHM7Ci0JfSBlbHNlIHsK
LQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmVfZm9ybWF0cyk7Ci0JCXJldHVy
biBza2xfcGxhbmVfZm9ybWF0czsKLQl9Ci19Ci0KLXN0YXRpYyBjb25zdCB1MzIgKmljbF9nZXRf
cGxhbmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJCWVu
dW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkLAotCQkJCQlpbnQgKm51bV9mb3Jt
YXRzKQotewotCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkpIHsKLQkJ
Km51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfaGRyX3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1
cm4gaWNsX2hkcl9wbGFuZV9mb3JtYXRzOwotCX0gZWxzZSBpZiAoaWNsX2lzX252MTJfeV9wbGFu
ZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7Ci0JCSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoaWNs
X3Nkcl95X3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1cm4gaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHM7
Ci0JfSBlbHNlIHsKLQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfc2RyX3V2X3BsYW5l
X2Zvcm1hdHMpOwotCQlyZXR1cm4gaWNsX3Nkcl91dl9wbGFuZV9mb3JtYXRzOwotCX0KLX0KLQot
c3RhdGljIGNvbnN0IHU2NCAqZ2VuMTJfZ2V0X3BsYW5lX21vZGlmaWVycyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJCSAgICBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQot
ewotCWlmIChnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3ByaXYsIHBsYW5lX2lkKSkK
LQkJcmV0dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbWNfY2NzOwotCWVsc2UKLQkJ
cmV0dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfcmNfY2NzOwotfQotCi1zdGF0aWMg
Ym9vbCBza2xfcGxhbmVfaGFzX2NjcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Ci0JCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsKLQlp
ZiAocGxhbmVfaWQgPT0gUExBTkVfQ1VSU09SKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMCkKLQkJcmV0dXJuIHRydWU7Ci0KLQlpZiAoSVNfR0VNSU5J
TEFLRShkZXZfcHJpdikpCi0JCXJldHVybiBwaXBlICE9IFBJUEVfQzsKLQotCXJldHVybiBwaXBl
ICE9IFBJUEVfQyAmJgotCQkocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSB8fAotCQkgcGxhbmVf
aWQgPT0gUExBTkVfU1BSSVRFMCk7Ci19Ci0KLXN0cnVjdCBpbnRlbF9wbGFuZSAqCi1za2xfdW5p
dmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0J
CQkgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsKLQljb25zdCBz
dHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzICpwbGFuZV9mdW5jczsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lOwotCWVudW0gZHJtX3BsYW5lX3R5cGUgcGxhbmVfdHlwZTsKLQl1bnNpZ25lZCBpbnQg
c3VwcG9ydGVkX3JvdGF0aW9uczsKLQl1bnNpZ25lZCBpbnQgc3VwcG9ydGVkX2NzYzsKLQljb25z
dCB1NjQgKm1vZGlmaWVyczsKLQljb25zdCB1MzIgKmZvcm1hdHM7Ci0JaW50IG51bV9mb3JtYXRz
OwotCWludCByZXQ7Ci0KLQlwbGFuZSA9IGludGVsX3BsYW5lX2FsbG9jKCk7Ci0JaWYgKElTX0VS
UihwbGFuZSkpCi0JCXJldHVybiBwbGFuZTsKLQotCXBsYW5lLT5waXBlID0gcGlwZTsKLQlwbGFu
ZS0+aWQgPSBwbGFuZV9pZDsKLQlwbGFuZS0+ZnJvbnRidWZmZXJfYml0ID0gSU5URUxfRlJPTlRC
VUZGRVIocGlwZSwgcGxhbmVfaWQpOwotCi0JcGxhbmUtPmhhc19mYmMgPSBza2xfcGxhbmVfaGFz
X2ZiYyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwotCWlmIChwbGFuZS0+aGFzX2ZiYykgewot
CQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKLQotCQlmYmMtPnBvc3Np
YmxlX2ZyYW1lYnVmZmVyX2JpdHMgfD0gcGxhbmUtPmZyb250YnVmZmVyX2JpdDsKLQl9Ci0KLQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlwbGFuZS0+bWluX3dpZHRoID0gaWNs
X3BsYW5lX21pbl93aWR0aDsKLQkJcGxhbmUtPm1heF93aWR0aCA9IGljbF9wbGFuZV9tYXhfd2lk
dGg7Ci0JCXBsYW5lLT5tYXhfaGVpZ2h0ID0gaWNsX3BsYW5lX21heF9oZWlnaHQ7Ci0JfSBlbHNl
IGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYp
KSB7Ci0JCXBsYW5lLT5tYXhfd2lkdGggPSBnbGtfcGxhbmVfbWF4X3dpZHRoOwotCQlwbGFuZS0+
bWF4X2hlaWdodCA9IHNrbF9wbGFuZV9tYXhfaGVpZ2h0OwotCX0gZWxzZSB7Ci0JCXBsYW5lLT5t
YXhfd2lkdGggPSBza2xfcGxhbmVfbWF4X3dpZHRoOwotCQlwbGFuZS0+bWF4X2hlaWdodCA9IHNr
bF9wbGFuZV9tYXhfaGVpZ2h0OwotCX0KLQotCXBsYW5lLT5tYXhfc3RyaWRlID0gc2tsX3BsYW5l
X21heF9zdHJpZGU7Ci0JcGxhbmUtPnVwZGF0ZV9wbGFuZSA9IHNrbF91cGRhdGVfcGxhbmU7Ci0J
cGxhbmUtPmRpc2FibGVfcGxhbmUgPSBza2xfZGlzYWJsZV9wbGFuZTsKLQlwbGFuZS0+Z2V0X2h3
X3N0YXRlID0gc2tsX3BsYW5lX2dldF9od19zdGF0ZTsKLQlwbGFuZS0+Y2hlY2tfcGxhbmUgPSBz
a2xfcGxhbmVfY2hlY2s7Ci0JcGxhbmUtPm1pbl9jZGNsayA9IHNrbF9wbGFuZV9taW5fY2RjbGs7
Ci0KLQlpZiAocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSkgewotCQlwbGFuZS0+bmVlZF9hc3lu
Y19mbGlwX2Rpc2FibGVfd2EgPSBJU19HRU5fUkFOR0UoZGV2X3ByaXYsIDksIDEwKTsKLQkJcGxh
bmUtPmFzeW5jX2ZsaXAgPSBza2xfcGxhbmVfYXN5bmNfZmxpcDsKLQkJcGxhbmUtPmVuYWJsZV9m
bGlwX2RvbmUgPSBza2xfcGxhbmVfZW5hYmxlX2ZsaXBfZG9uZTsKLQkJcGxhbmUtPmRpc2FibGVf
ZmxpcF9kb25lID0gc2tsX3BsYW5lX2Rpc2FibGVfZmxpcF9kb25lOwotCX0KLQotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlmb3JtYXRzID0gaWNsX2dldF9wbGFuZV9mb3JtYXRz
KGRldl9wcml2LCBwaXBlLAotCQkJCQkJcGxhbmVfaWQsICZudW1fZm9ybWF0cyk7Ci0JZWxzZSBp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkK
LQkJZm9ybWF0cyA9IGdsa19nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKLQkJCQkJ
CXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOwotCWVsc2UKLQkJZm9ybWF0cyA9IHNrbF9nZXRfcGxh
bmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKLQkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMp
OwotCi0JcGxhbmUtPmhhc19jY3MgPSBza2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwg
cGxhbmVfaWQpOwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7Ci0JCW1vZGlmaWVy
cyA9IGdlbjEyX2dldF9wbGFuZV9tb2RpZmllcnMoZGV2X3ByaXYsIHBsYW5lX2lkKTsKLQkJcGxh
bmVfZnVuY3MgPSAmZ2VuMTJfcGxhbmVfZnVuY3M7Ci0JfSBlbHNlIHsKLQkJaWYgKHBsYW5lLT5o
YXNfY2NzKQotCQkJbW9kaWZpZXJzID0gc2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfY2NzOwot
CQllbHNlCi0JCQltb2RpZmllcnMgPSBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19ub2NjczsK
LQkJcGxhbmVfZnVuY3MgPSAmc2tsX3BsYW5lX2Z1bmNzOwotCX0KLQotCWlmIChwbGFuZV9pZCA9
PSBQTEFORV9QUklNQVJZKQotCQlwbGFuZV90eXBlID0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWTsK
LQllbHNlCi0JCXBsYW5lX3R5cGUgPSBEUk1fUExBTkVfVFlQRV9PVkVSTEFZOwotCi0JcmV0ID0g
ZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KCZkZXZfcHJpdi0+ZHJtLCAmcGxhbmUtPmJhc2UsCi0J
CQkJICAgICAgIDAsIHBsYW5lX2Z1bmNzLAotCQkJCSAgICAgICBmb3JtYXRzLCBudW1fZm9ybWF0
cywgbW9kaWZpZXJzLAotCQkJCSAgICAgICBwbGFuZV90eXBlLAotCQkJCSAgICAgICAicGxhbmUg
JWQlYyIsIHBsYW5lX2lkICsgMSwKLQkJCQkgICAgICAgcGlwZV9uYW1lKHBpcGUpKTsKLQlpZiAo
cmV0KQotCQlnb3RvIGZhaWw7Ci0KLQlzdXBwb3J0ZWRfcm90YXRpb25zID0KLQkJRFJNX01PREVf
Uk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfOTAgfAotCQlEUk1fTU9ERV9ST1RBVEVfMTgwIHwg
RFJNX01PREVfUk9UQVRFXzI3MDsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQot
CQlzdXBwb3J0ZWRfcm90YXRpb25zIHw9IERSTV9NT0RFX1JFRkxFQ1RfWDsKLQotCWRybV9wbGFu
ZV9jcmVhdGVfcm90YXRpb25fcHJvcGVydHkoJnBsYW5lLT5iYXNlLAotCQkJCQkgICBEUk1fTU9E
RV9ST1RBVEVfMCwKLQkJCQkJICAgc3VwcG9ydGVkX3JvdGF0aW9ucyk7Ci0KLQlzdXBwb3J0ZWRf
Y3NjID0gQklUKERSTV9DT0xPUl9ZQ0JDUl9CVDYwMSkgfCBCSVQoRFJNX0NPTE9SX1lDQkNSX0JU
NzA5KTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpKQotCQlzdXBwb3J0ZWRfY3NjIHw9IEJJVChEUk1fQ09MT1JfWUNCQ1JfQlQyMDIw
KTsKLQotCWRybV9wbGFuZV9jcmVhdGVfY29sb3JfcHJvcGVydGllcygmcGxhbmUtPmJhc2UsCi0J
CQkJCSAgc3VwcG9ydGVkX2NzYywKLQkJCQkJICBCSVQoRFJNX0NPTE9SX1lDQkNSX0xJTUlURURf
UkFOR0UpIHwKLQkJCQkJICBCSVQoRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpLAotCQkJCQkg
IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSwKLQkJCQkJICBEUk1fQ09MT1JfWUNCQ1JfTElNSVRFRF9S
QU5HRSk7Ci0KLQlkcm1fcGxhbmVfY3JlYXRlX2FscGhhX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSk7
Ci0JZHJtX3BsYW5lX2NyZWF0ZV9ibGVuZF9tb2RlX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwKLQkJ
CQkJICAgICBCSVQoRFJNX01PREVfQkxFTkRfUElYRUxfTk9ORSkgfAotCQkJCQkgICAgIEJJVChE
Uk1fTU9ERV9CTEVORF9QUkVNVUxUSSkgfAotCQkJCQkgICAgIEJJVChEUk1fTU9ERV9CTEVORF9D
T1ZFUkFHRSkpOwotCi0JZHJtX3BsYW5lX2NyZWF0ZV96cG9zX2ltbXV0YWJsZV9wcm9wZXJ0eSgm
cGxhbmUtPmJhc2UsIHBsYW5lX2lkKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEy
KQotCQlkcm1fcGxhbmVfZW5hYmxlX2ZiX2RhbWFnZV9jbGlwcygmcGxhbmUtPmJhc2UpOwotCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCi0JCWRybV9wbGFuZV9jcmVhdGVfc2NhbGlu
Z19maWx0ZXJfcHJvcGVydHkoJnBsYW5lLT5iYXNlLAotCQkJCQkJQklUKERSTV9TQ0FMSU5HX0ZJ
TFRFUl9ERUZBVUxUKSB8Ci0JCQkJCQlCSVQoRFJNX1NDQUxJTkdfRklMVEVSX05FQVJFU1RfTkVJ
R0hCT1IpKTsKLQotCWRybV9wbGFuZV9oZWxwZXJfYWRkKCZwbGFuZS0+YmFzZSwgJmludGVsX3Bs
YW5lX2hlbHBlcl9mdW5jcyk7Ci0KLQlyZXR1cm4gcGxhbmU7Ci0KLWZhaWw6Ci0JaW50ZWxfcGxh
bmVfZnJlZShwbGFuZSk7Ci0KLQlyZXR1cm4gRVJSX1BUUihyZXQpOwotfQotCiBzdHJ1Y3QgaW50
ZWxfcGxhbmUgKgogaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJCQkgIGVudW0gcGlwZSBwaXBlLCBpbnQgc3ByaXRlKQpAQCAtMzQx
NCwxMCArMjA4OSw2IEBAIGludGVsX3Nwcml0ZV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCWludCBudW1fZm9ybWF0czsKIAlpbnQgcmV0LCB6cG9zOwog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKLQkJcmV0dXJuIHNrbF91bml2ZXJzYWxf
cGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlLAotCQkJCQkJICBQTEFORV9TUFJJVEUwICsgc3By
aXRlKTsKLQogCXBsYW5lID0gaW50ZWxfcGxhbmVfYWxsb2MoKTsKIAlpZiAoSVNfRVJSKHBsYW5l
KSkKIAkJcmV0dXJuIHBsYW5lOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9zcHJpdGUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
c3ByaXRlLmgKaW5kZXggNzYxMjZkZDhkNTg0Li40MTg4OTdmOTUzZmMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuaApAQCAtMzgsOSArMzgsNiBAQCB2b2lk
IGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNf
c3RhdGUpOwogaW50IGludGVsX3BsYW5lX2NoZWNrX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKIGludCBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29v
cmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiBpbnQgY2h2
X3BsYW5lX2NoZWNrX3JvdGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpOwotc3RydWN0IGludGVsX3BsYW5lICoKLXNrbF91bml2ZXJzYWxfcGxhbmVfY3Jl
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAgIGVudW0gcGlwZSBw
aXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKTsKIAogc3RhdGljIGlubGluZSB1OCBpY2xfaGRy
X3BsYW5lX21hc2sodm9pZCkKIHsKQEAgLTU5LDQgKzU2LDcgQEAgaW50IGhzd19wbGFuZV9taW5f
Y2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBpbnQgdmx2
X3BsYW5lX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogCit2
b2lkIHNrbF9wcm9ncmFtX3NjYWxlcihzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkJY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKICNlbmRpZiAvKiBfX0lOVEVMX1NQUklU
RV9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3Vu
aXZlcnNhbF9wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9za2xfdW5pdmVy
c2FsX3BsYW5lLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4yOWMy
ZTM2OTNlOGIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L3NrbF91bml2ZXJzYWxfcGxhbmUuYwpAQCAtMCwwICsxLDIyNjUgQEAKKy8vIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAyMCBJbnRlbCBDb3Jwb3Jh
dGlvbgorICovCisKKyNpbmNsdWRlIDxkcm0vZHJtX2F0b21pY19oZWxwZXIuaD4KKyNpbmNsdWRl
IDxkcm0vZHJtX2RhbWFnZV9oZWxwZXIuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJjYy5oPgor
I2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+CisKKyNpbmNsdWRlICJpOTE1X2Rydi5o
IgorI2luY2x1ZGUgImludGVsX2F0b21pY19wbGFuZS5oIgorI2luY2x1ZGUgImludGVsX2Rpc3Bs
YXlfdHlwZXMuaCIKKyNpbmNsdWRlICJpbnRlbF9wbS5oIgorI2luY2x1ZGUgImludGVsX3Bzci5o
IgorI2luY2x1ZGUgImludGVsX3Nwcml0ZS5oIgorI2luY2x1ZGUgInNrbF91bml2ZXJzYWxfcGxh
bmUuaCIKKworc3RhdGljIGNvbnN0IHUzMiBza2xfcGxhbmVfZm9ybWF0c1tdID0geworCURSTV9G
T1JNQVRfQzgsCisJRFJNX0ZPUk1BVF9SR0I1NjUsCisJRFJNX0ZPUk1BVF9YUkdCODg4OCwKKwlE
Uk1fRk9STUFUX1hCR1I4ODg4LAorCURSTV9GT1JNQVRfQVJHQjg4ODgsCisJRFJNX0ZPUk1BVF9B
QkdSODg4OCwKKwlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAorCURSTV9GT1JNQVRfWEJHUjIxMDEw
MTAsCisJRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2
RiwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAorCURSTV9GT1JNQVRfVVlW
WSwKKwlEUk1fRk9STUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKK307CisKK3N0YXRp
YyBjb25zdCB1MzIgc2tsX3BsYW5hcl9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9DOCwKKwlE
Uk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JNQVRfWEJH
Ujg4ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1fRk9STUFUX0FCR1I4ODg4LAorCURS
TV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlEUk1fRk9S
TUFUX1hSR0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGLAorCURSTV9GT1JN
QVRfWVVZViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JN
QVRfVllVWSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKK307CisK
K3N0YXRpYyBjb25zdCB1MzIgZ2xrX3BsYW5hcl9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9D
OCwKKwlEUk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JN
QVRfWEJHUjg4ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1fRk9STUFUX0FCR1I4ODg4
LAorCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlE
Uk1fRk9STUFUX1hSR0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGLAorCURS
TV9GT1JNQVRfWVVZViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURS
TV9GT1JNQVRfVllVWSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwK
KwlEUk1fRk9STUFUX1AwMTAsCisJRFJNX0ZPUk1BVF9QMDEyLAorCURSTV9GT1JNQVRfUDAxNiwK
K307CisKK3N0YXRpYyBjb25zdCB1MzIgaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHNbXSA9IHsKKwlE
Uk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9GT1JNQVRfWFJHQjg4ODgs
CisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4ODg4LAorCURSTV9GT1JN
QVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hCR1Iy
MTAxMDEwLAorCURSTV9GT1JNQVRfQVJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9BQkdSMjEwMTAx
MCwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAorCURSTV9GT1JNQVRfVVlW
WSwKKwlEUk1fRk9STUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9ZMjEwLAorCURSTV9GT1JNQVRfWTIx
MiwKKwlEUk1fRk9STUFUX1kyMTYsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKKwlEUk1fRk9STUFU
X1hWWVUyMTAxMDEwLAorCURSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2LAorCURSTV9GT1JNQVRf
WFZZVTE2MTYxNjE2LAorfTsKKworc3RhdGljIGNvbnN0IHUzMiBpY2xfc2RyX3V2X3BsYW5lX2Zv
cm1hdHNbXSA9IHsKKwlEUk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9G
T1JNQVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4
ODg4LAorCURSTV9GT1JNQVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlE
Uk1fRk9STUFUX1hCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfQVJHQjIxMDEwMTAsCisJRFJNX0ZP
Uk1BVF9BQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAor
CURSTV9GT1JNQVRfVVlWWSwKKwlEUk1fRk9STUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9OVjEyLAor
CURSTV9GT1JNQVRfUDAxMCwKKwlEUk1fRk9STUFUX1AwMTIsCisJRFJNX0ZPUk1BVF9QMDE2LAor
CURSTV9GT1JNQVRfWTIxMCwKKwlEUk1fRk9STUFUX1kyMTIsCisJRFJNX0ZPUk1BVF9ZMjE2LAor
CURSTV9GT1JNQVRfWFlVVjg4ODgsCisJRFJNX0ZPUk1BVF9YVllVMjEwMTAxMCwKKwlEUk1fRk9S
TUFUX1hWWVUxMl8xNjE2MTYxNiwKKwlEUk1fRk9STUFUX1hWWVUxNjE2MTYxNiwKK307CisKK3N0
YXRpYyBjb25zdCB1MzIgaWNsX2hkcl9wbGFuZV9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9D
OCwKKwlEUk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JN
QVRfWEJHUjg4ODgsCisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1fRk9STUFUX0FCR1I4ODg4
LAorCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlE
Uk1fRk9STUFUX0FSR0IyMTAxMDEwLAorCURSTV9GT1JNQVRfQUJHUjIxMDEwMTAsCisJRFJNX0ZP
Uk1BVF9YUkdCMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RiwKKwlEUk1fRk9S
TUFUX0FSR0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGLAorCURSTV9GT1JN
QVRfWVVZViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JN
QVRfVllVWSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9QMDEwLAorCURSTV9GT1JN
QVRfUDAxMiwKKwlEUk1fRk9STUFUX1AwMTYsCisJRFJNX0ZPUk1BVF9ZMjEwLAorCURSTV9GT1JN
QVRfWTIxMiwKKwlEUk1fRk9STUFUX1kyMTYsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKKwlEUk1f
Rk9STUFUX1hWWVUyMTAxMDEwLAorCURSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2LAorCURSTV9G
T1JNQVRfWFZZVTE2MTYxNjE2LAorfTsKKworc3RhdGljIGNvbnN0IHU2NCBza2xfcGxhbmVfZm9y
bWF0X21vZGlmaWVyc19ub2Njc1tdID0geworCUk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCwKKwlJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRCwKKwlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKKwlEUk1f
Rk9STUFUX01PRF9MSU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAorfTsKKworc3RhdGlj
IGNvbnN0IHU2NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3NbXSA9IHsKKwlJOTE1X0ZP
Uk1BVF9NT0RfWWZfVElMRURfQ0NTLAorCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUywKKwlJ
OTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQsCisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCisJSTkx
NV9GT1JNQVRfTU9EX1hfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JN
QVRfTU9EX0lOVkFMSUQKK307CisKK3N0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0
X21vZGlmaWVyc19tY19jY3NbXSA9IHsKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9N
Q19DQ1MsCisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTLAorCUk5MTVfRk9S
TUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQywKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RCwKKwlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKKwlEUk1fRk9STUFUX01PRF9MSU5FQVIsCisJ
RFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAorfTsKKworc3RhdGljIGNvbnN0IHU2NCBnZW4xMl9wbGFu
ZV9mb3JtYXRfbW9kaWZpZXJzX3JjX2Njc1tdID0geworCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
X0dFTjEyX1JDX0NDUywKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0Ms
CisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCisJSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCisJ
RFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKK307CisKK2lu
dCBza2xfZm9ybWF0X3RvX2ZvdXJjYyhpbnQgZm9ybWF0LCBib29sIHJnYl9vcmRlciwgYm9vbCBh
bHBoYSkKK3sKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9SR0Jf
NTY1OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9SR0I1NjU7CisJY2FzZSBQTEFORV9DVExfRk9STUFU
X05WMTI6CisJCXJldHVybiBEUk1fRk9STUFUX05WMTI7CisJY2FzZSBQTEFORV9DVExfRk9STUFU
X1hZVVY6CisJCXJldHVybiBEUk1fRk9STUFUX1hZVVY4ODg4OworCWNhc2UgUExBTkVfQ1RMX0ZP
Uk1BVF9QMDEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEwOworCWNhc2UgUExBTkVfQ1RMX0ZP
Uk1BVF9QMDEyOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEyOworCWNhc2UgUExBTkVfQ1RMX0ZP
Uk1BVF9QMDE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDE2OworCWNhc2UgUExBTkVfQ1RMX0ZP
Uk1BVF9ZMjEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEwOworCWNhc2UgUExBTkVfQ1RMX0ZP
Uk1BVF9ZMjEyOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEyOworCWNhc2UgUExBTkVfQ1RMX0ZP
Uk1BVF9ZMjE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjE2OworCWNhc2UgUExBTkVfQ1RMX0ZP
Uk1BVF9ZNDEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDsKKwljYXNlIFBMQU5F
X0NUTF9GT1JNQVRfWTQxMjoKKwkJcmV0dXJuIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2Owor
CWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9YVllVMTYx
NjE2MTY7CisJZGVmYXVsdDoKKwljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl84ODg4OgorCQlp
ZiAocmdiX29yZGVyKSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJH
Ujg4ODg7CisJCQllbHNlCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjg4ODg7CisJCX0gZWxz
ZSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjg4ODg7CisJCQll
bHNlCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjg4ODg7CisJCX0KKwljYXNlIFBMQU5FX0NU
TF9GT1JNQVRfWFJHQl8yMTAxMDEwOgorCQlpZiAocmdiX29yZGVyKSB7CisJCQlpZiAoYWxwaGEp
CisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA7CisJCQllbHNlCisJCQkJcmV0dXJu
IERSTV9GT1JNQVRfWEJHUjIxMDEwMTA7CisJCX0gZWxzZSB7CisJCQlpZiAoYWxwaGEpCisJCQkJ
cmV0dXJuIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA7CisJCQllbHNlCisJCQkJcmV0dXJuIERSTV9G
T1JNQVRfWFJHQjIxMDEwMTA7CisJCX0KKwljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8xNjE2
MTYxNkY6CisJCWlmIChyZ2Jfb3JkZXIpIHsKKwkJCWlmIChhbHBoYSkKKwkJCQlyZXR1cm4gRFJN
X0ZPUk1BVF9BQkdSMTYxNjE2MTZGOworCQkJZWxzZQorCQkJCXJldHVybiBEUk1fRk9STUFUX1hC
R1IxNjE2MTYxNkY7CisJCX0gZWxzZSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9G
T1JNQVRfQVJHQjE2MTYxNjE2RjsKKwkJCWVsc2UKKwkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9YUkdC
MTYxNjE2MTZGOworCQl9CisJfQorfQorCitzdGF0aWMgdTggaWNsX252MTJfeV9wbGFuZV9tYXNr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCWlmIChIQVNfRDEyX1BMQU5FX01J
TklNSVpBVElPTihpOTE1KSkKKwkJcmV0dXJuIEJJVChQTEFORV9TUFJJVEUyKSB8IEJJVChQTEFO
RV9TUFJJVEUzKTsKKwllbHNlCisJCXJldHVybiBCSVQoUExBTkVfU1BSSVRFNCkgfCBCSVQoUExB
TkVfU1BSSVRFNSk7Cit9CisKK2Jvb2wgaWNsX2lzX252MTJfeV9wbGFuZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sKKwly
ZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCQlpY2xfbnYxMl95X3BsYW5lX21h
c2soZGV2X3ByaXYpICYgQklUKHBsYW5lX2lkKTsKK30KKworYm9vbCBpY2xfaXNfaGRyX3BsYW5l
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZCkKK3sKKwlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCQlpY2xfaGRyX3Bs
YW5lX21hc2soKSAmIEJJVChwbGFuZV9pZCk7Cit9CisKK3N0YXRpYyB2b2lkCitza2xfcGxhbmVf
cmF0aW8oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCWNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCXVuc2lnbmVkIGludCAq
bnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOworCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCisJaWYgKGZi
LT5mb3JtYXQtPmNwcFswXSA9PSA4KSB7CisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEw
IHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJCQkqbnVtID0gMTA7CisJCQkqZGVuID0g
ODsKKwkJfSBlbHNlIHsKKwkJCSpudW0gPSA5OworCQkJKmRlbiA9IDg7CisJCX0KKwl9IGVsc2Ug
eworCQkqbnVtID0gMTsKKwkJKmRlbiA9IDE7CisJfQorfQorCitzdGF0aWMgaW50IHNrbF9wbGFu
ZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJ
CQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lLT5kZXYpOworCXVuc2lnbmVkIGludCBudW0sIGRlbjsKKwl1bnNpZ25lZCBp
bnQgcGl4ZWxfcmF0ZSA9IGludGVsX3BsYW5lX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVf
c3RhdGUpOworCisJc2tsX3BsYW5lX3JhdGlvKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCAmbnVt
LCAmZGVuKTsKKworCS8qIHR3byBwaXhlbHMgcGVyIGNsb2NrIG9uIGdsaysgKi8KKwlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJZGVu
ICo9IDI7CisKKwlyZXR1cm4gRElWX1JPVU5EX1VQKHBpeGVsX3JhdGUgKiBudW0sIGRlbik7Cit9
CisKK3N0YXRpYyBpbnQgc2tsX3BsYW5lX21heF93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkgICAgICAgdW5zaWdu
ZWQgaW50IHJvdGF0aW9uKQoreworCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbY29sb3JfcGxh
bmVdOworCisJc3dpdGNoIChmYi0+bW9kaWZpZXIpIHsKKwljYXNlIERSTV9GT1JNQVRfTU9EX0xJ
TkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgorCQkvKgorCQkgKiBWYWxpZGF0
ZWQgbGltaXQgaXMgNGssIGJ1dCBoYXMgNWsgc2hvdWxkCisJCSAqIHdvcmsgYXBhcnQgZnJvbSB0
aGUgZm9sbG93aW5nIGZlYXR1cmVzOgorCQkgKiAtIFl0aWxlIChhbHJlYWR5IGxpbWl0ZWQgdG8g
NGspCisJCSAqIC0gRlAxNiAoYWxyZWFkeSBsaW1pdGVkIHRvIDRrKQorCQkgKiAtIHJlbmRlciBj
b21wcmVzc2lvbiAoYWxyZWFkeSBsaW1pdGVkIHRvIDRrKQorCQkgKiAtIEtWTVIgc3ByaXRlIGFu
ZCBjdXJzb3IgKGRvbid0IGNhcmUpCisJCSAqIC0gaG9yaXpvbnRhbCBwYW5uaW5nIChUT0RPIHZl
cmlmeSB0aGlzKQorCQkgKiAtIHBpcGUgYW5kIHBsYW5lIHNjYWxpbmcgKFRPRE8gdmVyaWZ5IHRo
aXMpCisJCSAqLworCQlpZiAoY3BwID09IDgpCisJCQlyZXR1cm4gNDA5NjsKKwkJZWxzZQorCQkJ
cmV0dXJuIDUxMjA7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CisJY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgorCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfR0VOMTJfTUNfQ0NTOgorCQkvKiBGSVhNRSBBVVggcGxhbmU/ICovCisJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKKwkJaWYg
KGNwcCA9PSA4KQorCQkJcmV0dXJuIDIwNDg7CisJCWVsc2UKKwkJCXJldHVybiA0MDk2OworCWRl
ZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShmYi0+bW9kaWZpZXIpOworCQlyZXR1cm4gMjA0ODsKKwl9
Cit9CisKK3N0YXRpYyBpbnQgZ2xrX3BsYW5lX21heF93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkgICAgICAgdW5z
aWduZWQgaW50IHJvdGF0aW9uKQoreworCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbY29sb3Jf
cGxhbmVdOworCisJc3dpdGNoIChmYi0+bW9kaWZpZXIpIHsKKwljYXNlIERSTV9GT1JNQVRfTU9E
X0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgorCQlpZiAoY3BwID09IDgp
CisJCQlyZXR1cm4gNDA5NjsKKwkJZWxzZQorCQkJcmV0dXJuIDUxMjA7CisJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NT
OgorCQkvKiBGSVhNRSBBVVggcGxhbmU/ICovCisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKKwkJaWYgKGNwcCA9PSA4KQorCQkJ
cmV0dXJuIDIwNDg7CisJCWVsc2UKKwkJCXJldHVybiA1MTIwOworCWRlZmF1bHQ6CisJCU1JU1NJ
TkdfQ0FTRShmYi0+bW9kaWZpZXIpOworCQlyZXR1cm4gMjA0ODsKKwl9Cit9CisKK3N0YXRpYyBp
bnQgaWNsX3BsYW5lX21pbl93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwK
KwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkgICAgICAgdW5zaWduZWQgaW50IHJvdGF0
aW9uKQoreworCS8qIFdhXzE0MDExMjY0NjU3LCBXYV8xNDAxMTA1MDU2MzogZ2VuMTErICovCisJ
c3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJCXJl
dHVybiAxODsKKwljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCQlyZXR1cm4gMTA7CisJY2FzZSBE
Uk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKKwljYXNlIERS
TV9GT1JNQVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgorCWNhc2UgRFJN
X0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CisJY2Fz
ZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoK
KwljYXNlIERSTV9GT1JNQVRfWFZZVTIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1kyMTI6CisJ
Y2FzZSBEUk1fRk9STUFUX1kyMTY6CisJCXJldHVybiA2OworCWNhc2UgRFJNX0ZPUk1BVF9OVjEy
OgorCQlyZXR1cm4gMjA7CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6CisJY2FzZSBEUk1fRk9STUFU
X1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJCXJldHVybiAxMjsKKwljYXNlIERSTV9G
T1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwlj
YXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYx
NjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2OgorCWNhc2UgRFJNX0ZPUk1B
VF9YVllVMTYxNjE2MTY6CisJCXJldHVybiA0OworCWRlZmF1bHQ6CisJCXJldHVybiAxOworCX0K
K30KKworc3RhdGljIGludCBpY2xfcGxhbmVfbWF4X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiLAorCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwKKwkJCSAgICAgICB1bnNp
Z25lZCBpbnQgcm90YXRpb24pCit7CisJcmV0dXJuIDUxMjA7Cit9CisKK3N0YXRpYyBpbnQgc2ts
X3BsYW5lX21heF9oZWlnaHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJ
aW50IGNvbG9yX3BsYW5lLAorCQkJCXVuc2lnbmVkIGludCByb3RhdGlvbikKK3sKKwlyZXR1cm4g
NDA5NjsKK30KKworc3RhdGljIGludCBpY2xfcGxhbmVfbWF4X2hlaWdodChjb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQlpbnQgY29sb3JfcGxhbmUsCisJCQkJdW5zaWduZWQg
aW50IHJvdGF0aW9uKQoreworCXJldHVybiA0MzIwOworfQorCitzdGF0aWMgdW5zaWduZWQgaW50
Citza2xfcGxhbmVfbWF4X3N0cmlkZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkgICAg
IHUzMiBwaXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllciwKKwkJICAgICB1bnNpZ25lZCBpbnQgcm90
YXRpb24pCit7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbyA9IGRybV9mb3Jt
YXRfaW5mbyhwaXhlbF9mb3JtYXQpOworCWludCBjcHAgPSBpbmZvLT5jcHBbMF07CisKKwkvKgor
CSAqICJUaGUgc3RyaWRlIGluIGJ5dGVzIG11c3Qgbm90IGV4Y2VlZCB0aGUKKwkgKiBvZiB0aGUg
c2l6ZSBvZiA4SyBwaXhlbHMgYW5kIDMySyBieXRlcy4iCisJICovCisJaWYgKGRybV9yb3RhdGlv
bl85MF9vcl8yNzAocm90YXRpb24pKQorCQlyZXR1cm4gbWluKDgxOTIsIDMyNzY4IC8gY3BwKTsK
KwllbHNlCisJCXJldHVybiBtaW4oODE5MiAqIGNwcCwgMzI3NjgpOworfQorCisKKy8qIFByZW9m
ZnNldCB2YWx1ZXMgZm9yIFlVViB0byBSR0IgQ29udmVyc2lvbiAqLworI2RlZmluZSBQUkVPRkZf
WVVWX1RPX1JHQl9ISQkJMHgxODAwCisjZGVmaW5lIFBSRU9GRl9ZVVZfVE9fUkdCX01FCQkweDAw
MDAKKyNkZWZpbmUgUFJFT0ZGX1lVVl9UT19SR0JfTE8JCTB4MTgwMAorCisjZGVmaW5lICBST0ZG
KHgpICAgICAgICAgICgoKHgpICYgMHhmZmZmKSA8PCAxNikKKyNkZWZpbmUgIEdPRkYoeCkgICAg
ICAgICAgKCgoeCkgJiAweGZmZmYpIDw8IDApCisjZGVmaW5lICBCT0ZGKHgpICAgICAgICAgICgo
KHgpICYgMHhmZmZmKSA8PCAxNikKKworLyoKKyAqIFByb2dyYW1zIHRoZSBpbnB1dCBjb2xvciBz
cGFjZSBjb252ZXJzaW9uIHN0YWdlIGZvciBJQ0wgSERSIHBsYW5lcy4KKyAqIE5vdGUgdGhhdCBp
dCBpcyBhc3N1bWVkIHRoYXQgdGhpcyBzdGFnZSBhbHdheXMgaGFwcGVucyBhZnRlciBZVVYKKyAq
IHJhbmdlIGNvcnJlY3Rpb24uIFRodXMsIHRoZSBpbnB1dCB0byB0aGlzIHN0YWdlIGlzIGFzc3Vt
ZWQgdG8gYmUKKyAqIGluIGZ1bGwtcmFuZ2UgWUNiQ3IuCisgKi8KK3N0YXRpYyB2b2lkCitpY2xf
cHJvZ3JhbV9pbnB1dF9jc2Moc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJICAgICAgY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCSAgICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCWVudW0gcGlw
ZSBwaXBlID0gcGxhbmUtPnBpcGU7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5p
ZDsKKworCXN0YXRpYyBjb25zdCB1MTYgaW5wdXRfY3NjX21hdHJpeFtdWzldID0geworCQkvKgor
CQkgKiBCVC42MDEgZnVsbCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdlIFJHQgorCQkgKiBUaGUg
bWF0cml4IHJlcXVpcmVkIGlzIDoKKwkJICogWzEuMDAwLCAwLjAwMCwgMS4zNzEsCisJCSAqICAx
LjAwMCwgLTAuMzM2LCAtMC42OTgsCisJCSAqICAxLjAwMCwgMS43MzIsIDAuMDAwMF0KKwkJICov
CisJCVtEUk1fQ09MT1JfWUNCQ1JfQlQ2MDFdID0geworCQkJMHg3QUY4LCAweDc4MDAsIDB4MCwK
KwkJCTB4OEIyOCwgMHg3ODAwLCAweDlBQzAsCisJCQkweDAsIDB4NzgwMCwgMHg3REQ4LAorCQl9
LAorCQkvKgorCQkgKiBCVC43MDkgZnVsbCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdlIFJHQgor
CQkgKiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKKwkJICogWzEuMDAwLCAwLjAwMCwgMS41NzQs
CisJCSAqICAxLjAwMCwgLTAuMTg3LCAtMC40NjgsCisJCSAqICAxLjAwMCwgMS44NTUsIDAuMDAw
MF0KKwkJICovCisJCVtEUk1fQ09MT1JfWUNCQ1JfQlQ3MDldID0geworCQkJMHg3Qzk4LCAweDc4
MDAsIDB4MCwKKwkJCTB4OUVGOCwgMHg3ODAwLCAweEFDMDAsCisJCQkweDAsIDB4NzgwMCwgIDB4
N0VEOCwKKwkJfSwKKwkJLyoKKwkJICogQlQuMjAyMCBmdWxsIHJhbmdlIFlDYkNyIC0+IGZ1bGwg
cmFuZ2UgUkdCCisJCSAqIFRoZSBtYXRyaXggcmVxdWlyZWQgaXMgOgorCQkgKiBbMS4wMDAsIDAu
MDAwLCAxLjQ3NCwKKwkJICogIDEuMDAwLCAtMC4xNjQ1LCAtMC41NzEzLAorCQkgKiAgMS4wMDAs
IDEuODgxNCwgMC4wMDAwXQorCQkgKi8KKwkJW0RSTV9DT0xPUl9ZQ0JDUl9CVDIwMjBdID0gewor
CQkJMHg3QkM4LCAweDc4MDAsIDB4MCwKKwkJCTB4ODkyOCwgMHg3ODAwLCAweEFBODgsCisJCQkw
eDAsIDB4NzgwMCwgMHg3RjEwLAorCQl9LAorCX07CisJY29uc3QgdTE2ICpjc2MgPSBpbnB1dF9j
c2NfbWF0cml4W3BsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZ107CisKKwlpbnRlbF9kZV93
cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUsIHBsYW5lX2lkLCAw
KSwKKwkJCSAgUk9GRihjc2NbMF0pIHwgR09GRihjc2NbMV0pKTsKKwlpbnRlbF9kZV93cml0ZV9m
dyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUsIHBsYW5lX2lkLCAxKSwKKwkJ
CSAgQk9GRihjc2NbMl0pKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5Q
VVRfQ1NDX0NPRUZGKHBpcGUsIHBsYW5lX2lkLCAyKSwKKwkJCSAgUk9GRihjc2NbM10pIHwgR09G
Rihjc2NbNF0pKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1ND
X0NPRUZGKHBpcGUsIHBsYW5lX2lkLCAzKSwKKwkJCSAgQk9GRihjc2NbNV0pKTsKKwlpbnRlbF9k
ZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUsIHBsYW5lX2lk
LCA0KSwKKwkJCSAgUk9GRihjc2NbNl0pIHwgR09GRihjc2NbN10pKTsKKwlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX0NPRUZGKHBpcGUsIHBsYW5lX2lkLCA1KSwK
KwkJCSAgQk9GRihjc2NbOF0pKTsKKworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFO
RV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAwKSwKKwkJCSAgUFJFT0ZGX1lVVl9U
T19SR0JfSEkpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0Nf
UFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwKKwkJCSAgUFJFT0ZGX1lVVl9UT19SR0JfTUUpOwor
CWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUs
IHBsYW5lX2lkLCAyKSwKKwkJCSAgUFJFT0ZGX1lVVl9UT19SR0JfTE8pOworCWludGVsX2RlX3dy
aXRlX2Z3KGRldl9wcml2LAorCQkJICBQTEFORV9JTlBVVF9DU0NfUE9TVE9GRihwaXBlLCBwbGFu
ZV9pZCwgMCksIDB4MCk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsCisJCQkgIFBMQU5F
X0lOUFVUX0NTQ19QT1NUT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwgMHgwKTsKKwlpbnRlbF9kZV93
cml0ZV9mdyhkZXZfcHJpdiwKKwkJCSAgUExBTkVfSU5QVVRfQ1NDX1BPU1RPRkYocGlwZSwgcGxh
bmVfaWQsIDIpLCAweDApOworfQorCitzdGF0aWMgYm9vbCBpc19zdXJmYWNlX2xpbmVhcihjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQoreworCXJldHVy
biBmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8CisJICAgICAgIGlzX2dl
bjEyX2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpOworfQorCitzdGF0aWMgdW5zaWduZWQgaW50
IHNrbF9wbGFuZV9zdHJpZGVfbXVsdChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwK
KwkJCQkJICBpbnQgY29sb3JfcGxhbmUsIHVuc2lnbmVkIGludCByb3RhdGlvbikKK3sKKwkvKgor
CSAqIFRoZSBzdHJpZGUgaXMgZWl0aGVyIGV4cHJlc3NlZCBhcyBhIG11bHRpcGxlIG9mIDY0IGJ5
dGVzIGNodW5rcyBmb3IKKwkgKiBsaW5lYXIgYnVmZmVycyBvciBpbiBudW1iZXIgb2YgdGlsZXMg
Zm9yIHRpbGVkIGJ1ZmZlcnMuCisJICovCisJaWYgKGlzX3N1cmZhY2VfbGluZWFyKGZiLCBjb2xv
cl9wbGFuZSkpCisJCXJldHVybiA2NDsKKwllbHNlIGlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcw
KHJvdGF0aW9uKSkKKwkJcmV0dXJuIGludGVsX3RpbGVfaGVpZ2h0KGZiLCBjb2xvcl9wbGFuZSk7
CisJZWxzZQorCQlyZXR1cm4gaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhmYiwgY29sb3JfcGxhbmUp
OworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9zdHJpZGUoY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJCSAgICBpbnQgY29sb3JfcGxhbmUpCit7CisJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5z
aWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOworCXUzMiBzdHJp
ZGUgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnN0cmlkZTsKKworCWlm
IChjb2xvcl9wbGFuZSA+PSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzKQorCQlyZXR1cm4gMDsKKwor
CXJldHVybiBzdHJpZGUgLyBza2xfcGxhbmVfc3RyaWRlX211bHQoZmIsIGNvbG9yX3BsYW5lLCBy
b3RhdGlvbik7Cit9CisKK3N0YXRpYyB2b2lkCitza2xfZGlzYWJsZV9wbGFuZShzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lLAorCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
cGxhbmUtPmJhc2UuZGV2KTsKKwllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwor
CWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CisJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsK
KworCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsK
KworCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkpCisJCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVVNfQ1RMKHBpcGUsIHBsYW5lX2lkKSwgMCk7CisK
Kwlza2xfd3JpdGVfcGxhbmVfd20ocGxhbmUsIGNydGNfc3RhdGUpOworCisJaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBwbGFuZV9pZCksIDApOworCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSwgMCk7CisKKwlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsK
K30KKworc3RhdGljIGJvb2wKK3NrbF9wbGFuZV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKKwkJICAgICAgIGVudW0gcGlwZSAqcGlwZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJZW51bSBp
bnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CisJZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCA9IHBsYW5lLT5pZDsKKwlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKKwlib29sIHJl
dDsKKworCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9QSVBFKHBsYW5lLT5waXBlKTsKKwl3
YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZfcHJpdiwgcG93
ZXJfZG9tYWluKTsKKwlpZiAoIXdha2VyZWYpCisJCXJldHVybiBmYWxzZTsKKworCXJldCA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX0NUTChwbGFuZS0+cGlwZSwgcGxhbmVfaWQpKSAm
IFBMQU5FX0NUTF9FTkFCTEU7CisKKwkqcGlwZSA9IHBsYW5lLT5waXBlOworCisJaW50ZWxfZGlz
cGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CisKKwlyZXR1
cm4gcmV0OworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfZm9ybWF0KHUzMiBwaXhlbF9m
b3JtYXQpCit7CisJc3dpdGNoIChwaXhlbF9mb3JtYXQpIHsKKwljYXNlIERSTV9GT1JNQVRfQzg6
CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX0lOREVYRUQ7CisJY2FzZSBEUk1fRk9STUFUX1JH
QjU2NToKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUkdCXzU2NTsKKwljYXNlIERSTV9GT1JN
QVRfWEJHUjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgorCQlyZXR1cm4gUExBTkVf
Q1RMX0ZPUk1BVF9YUkdCXzg4ODggfCBQTEFORV9DVExfT1JERVJfUkdCWDsKKwljYXNlIERSTV9G
T1JNQVRfWFJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgorCQlyZXR1cm4gUExB
TkVfQ1RMX0ZPUk1BVF9YUkdCXzg4ODg7CisJY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgor
CWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRf
WFJHQl8yMTAxMDEwIHwgUExBTkVfQ1RMX09SREVSX1JHQlg7CisJY2FzZSBEUk1fRk9STUFUX1hS
R0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKKwkJcmV0dXJuIFBMQU5F
X0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwOworCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZG
OgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZP
Uk1BVF9YUkdCXzE2MTYxNjE2RiB8IFBMQU5FX0NUTF9PUkRFUl9SR0JYOworCWNhc2UgRFJNX0ZP
Uk1BVF9YUkdCMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOgorCQly
ZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzE2MTYxNjE2RjsKKwljYXNlIERSTV9GT1JNQVRf
WFlVVjg4ODg6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hZVVY7CisJY2FzZSBEUk1fRk9S
TUFUX1lVWVY6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQyMiB8IFBMQU5FX0NUTF9Z
VVY0MjJfWVVZVjsKKwljYXNlIERSTV9GT1JNQVRfWVZZVToKKwkJcmV0dXJuIFBMQU5FX0NUTF9G
T1JNQVRfWVVWNDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9ZVllVOworCWNhc2UgRFJNX0ZPUk1BVF9V
WVZZOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZVVY0MjIgfCBQTEFORV9DVExfWVVWNDIy
X1VZVlk7CisJY2FzZSBEUk1fRk9STUFUX1ZZVVk6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFU
X1lVVjQyMiB8IFBMQU5FX0NUTF9ZVVY0MjJfVllVWTsKKwljYXNlIERSTV9GT1JNQVRfTlYxMjoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfTlYxMjsKKwljYXNlIERSTV9GT1JNQVRfUDAxMDoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxMDsKKwljYXNlIERSTV9GT1JNQVRfUDAxMjoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxMjsKKwljYXNlIERSTV9GT1JNQVRfUDAxNjoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxNjsKKwljYXNlIERSTV9GT1JNQVRfWTIxMDoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxMDsKKwljYXNlIERSTV9GT1JNQVRfWTIxMjoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxMjsKKwljYXNlIERSTV9GT1JNQVRfWTIxNjoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxNjsKKwljYXNlIERSTV9GT1JNQVRfWFZZVTIx
MDEwMTA6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1k0MTA7CisJY2FzZSBEUk1fRk9STUFU
X1hWWVUxMl8xNjE2MTYxNjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTQxMjsKKwljYXNl
IERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2
OworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShwaXhlbF9mb3JtYXQpOworCX0KKworCXJldHVy
biAwOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfYWxwaGEoY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlpZiAoIXBsYW5lX3N0YXRlLT5ody5m
Yi0+Zm9ybWF0LT5oYXNfYWxwaGEpCisJCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsK
KworCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsKKwljYXNlIERS
TV9NT0RFX0JMRU5EX1BJWEVMX05PTkU6CisJCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJM
RTsKKwljYXNlIERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJOgorCQlyZXR1cm4gUExBTkVfQ1RMX0FM
UEhBX1NXX1BSRU1VTFRJUExZOworCWNhc2UgRFJNX01PREVfQkxFTkRfQ09WRVJBR0U6CisJCXJl
dHVybiBQTEFORV9DVExfQUxQSEFfSFdfUFJFTVVMVElQTFk7CisJZGVmYXVsdDoKKwkJTUlTU0lO
R19DQVNFKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKTsKKwkJcmV0dXJuIFBMQU5F
X0NUTF9BTFBIQV9ESVNBQkxFOworCX0KK30KKworc3RhdGljIHUzMiBnbGtfcGxhbmVfY29sb3Jf
Y3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7
CisJaWYgKCFwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aGFzX2FscGhhKQorCQlyZXR1cm4g
UExBTkVfQ09MT1JfQUxQSEFfRElTQUJMRTsKKworCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBp
eGVsX2JsZW5kX21vZGUpIHsKKwljYXNlIERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkU6CisJCXJl
dHVybiBQTEFORV9DT0xPUl9BTFBIQV9ESVNBQkxFOworCWNhc2UgRFJNX01PREVfQkxFTkRfUFJF
TVVMVEk6CisJCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9TV19QUkVNVUxUSVBMWTsKKwljYXNl
IERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFOgorCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfSFdf
UFJFTVVMVElQTFk7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKHBsYW5lX3N0YXRlLT5ody5w
aXhlbF9ibGVuZF9tb2RlKTsKKwkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX0RJU0FCTEU7CisJ
fQorfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfdGlsaW5nKHU2NCBmYl9tb2RpZmllcikK
K3sKKwlzd2l0Y2ggKGZiX21vZGlmaWVyKSB7CisJY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6
CisJCWJyZWFrOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6CisJCXJldHVybiBQTEFO
RV9DVExfVElMRURfWDsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgorCQlyZXR1cm4g
UExBTkVfQ1RMX1RJTEVEX1k7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CisJ
Y2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0M6CisJCXJldHVybiBQ
TEFORV9DVExfVElMRURfWSB8IFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEU7
CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJCXJldHVybiBQ
TEFORV9DVExfVElMRURfWSB8CisJCSAgICAgICBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJ
T05fRU5BQkxFIHwKKwkJICAgICAgIFBMQU5FX0NUTF9DTEVBUl9DT0xPUl9ESVNBQkxFOworCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOgorCQlyZXR1cm4gUExBTkVf
Q1RMX1RJTEVEX1kgfCBQTEFORV9DVExfTUVESUFfREVDT01QUkVTU0lPTl9FTkFCTEU7CisJY2Fz
ZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ6CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWUY7
CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgorCQlyZXR1cm4gUExBTkVfQ1RM
X1RJTEVEX1lGIHwgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKKwlkZWZh
dWx0OgorCQlNSVNTSU5HX0NBU0UoZmJfbW9kaWZpZXIpOworCX0KKworCXJldHVybiAwOworfQor
CitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfcm90YXRlKHVuc2lnbmVkIGludCByb3RhdGUpCit7
CisJc3dpdGNoIChyb3RhdGUpIHsKKwljYXNlIERSTV9NT0RFX1JPVEFURV8wOgorCQlicmVhazsK
KwkvKgorCSAqIERSTV9NT0RFX1JPVEFURV8gaXMgY291bnRlciBjbG9ja3dpc2UgdG8gc3RheSBj
b21wYXRpYmxlIHdpdGggWHJhbmRyCisJICogd2hpbGUgaTkxNSBIVyByb3RhdGlvbiBpcyBjbG9j
a3dpc2UsIHRoYXRzIHdoeSB0aGlzIHN3YXBwaW5nLgorCSAqLworCWNhc2UgRFJNX01PREVfUk9U
QVRFXzkwOgorCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV8yNzA7CisJY2FzZSBEUk1fTU9ERV9S
T1RBVEVfMTgwOgorCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV8xODA7CisJY2FzZSBEUk1fTU9E
RV9ST1RBVEVfMjcwOgorCQlyZXR1cm4gUExBTkVfQ1RMX1JPVEFURV85MDsKKwlkZWZhdWx0Ogor
CQlNSVNTSU5HX0NBU0Uocm90YXRlKTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHUz
MiBjbmxfcGxhbmVfY3RsX2ZsaXAodW5zaWduZWQgaW50IHJlZmxlY3QpCit7CisJc3dpdGNoIChy
ZWZsZWN0KSB7CisJY2FzZSAwOgorCQlicmVhazsKKwljYXNlIERSTV9NT0RFX1JFRkxFQ1RfWDoK
KwkJcmV0dXJuIFBMQU5FX0NUTF9GTElQX0hPUklaT05UQUw7CisJY2FzZSBEUk1fTU9ERV9SRUZM
RUNUX1k6CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKHJlZmxlY3QpOworCX0KKworCXJldHVy
biAwOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwl1MzIgcGxh
bmVfY3RsID0gMDsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlO
SUxBS0UoZGV2X3ByaXYpKQorCQlyZXR1cm4gcGxhbmVfY3RsOworCisJaWYgKGNydGNfc3RhdGUt
PmdhbW1hX2VuYWJsZSkKKwkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9QSVBFX0dBTU1BX0VOQUJM
RTsKKworCWlmIChjcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQorCQlwbGFuZV9jdGwgfD0gUExBTkVf
Q1RMX1BJUEVfQ1NDX0VOQUJMRTsKKworCXJldHVybiBwbGFuZV9jdGw7Cit9CisKK3N0YXRpYyB1
MzIgc2tsX3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKKwkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorewor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUtPmRldik7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3Rh
dGUtPmh3LnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5
ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CisJdTMyIHBsYW5lX2N0bDsKKworCXBsYW5lX2N0
bCA9IFBMQU5FX0NUTF9FTkFCTEU7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEwICYm
ICFJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCQlwbGFuZV9jdGwgfD0gc2tsX3BsYW5lX2N0
bF9hbHBoYShwbGFuZV9zdGF0ZSk7CisJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUExBTkVfR0FN
TUFfRElTQUJMRTsKKworCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09IERS
TV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwkJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfWVVWX1RPX1JH
Ql9DU0NfRk9STUFUX0JUNzA5OworCisJCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2Ug
PT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RM
X1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CisJfQorCisJcGxhbmVfY3RsIHw9IHNrbF9w
bGFuZV9jdGxfZm9ybWF0KGZiLT5mb3JtYXQtPmZvcm1hdCk7CisJcGxhbmVfY3RsIHw9IHNrbF9w
bGFuZV9jdGxfdGlsaW5nKGZiLT5tb2RpZmllcik7CisJcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9j
dGxfcm90YXRlKHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFX01BU0spOworCisJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTApCisJCXBsYW5lX2N0bCB8PSBjbmxfcGxhbmVfY3RsX2ZsaXAo
cm90YXRpb24gJgorCQkJCQkJRFJNX01PREVfUkVGTEVDVF9NQVNLKTsKKworCWlmIChrZXktPmZs
YWdzICYgSTkxNV9TRVRfQ09MT1JLRVlfREVTVElOQVRJT04pCisJCXBsYW5lX2N0bCB8PSBQTEFO
RV9DVExfS0VZX0VOQUJMRV9ERVNUSU5BVElPTjsKKwllbHNlIGlmIChrZXktPmZsYWdzICYgSTkx
NV9TRVRfQ09MT1JLRVlfU09VUkNFKQorCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0tFWV9FTkFC
TEVfU09VUkNFOworCisJcmV0dXJuIHBsYW5lX2N0bDsKK30KKworc3RhdGljIHUzMiBnbGtfcGxh
bmVfY29sb3JfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
X3N0YXRlLT51YXBpLmNydGMtPmRldik7CisJdTMyIHBsYW5lX2NvbG9yX2N0bCA9IDA7CisKKwlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwkJcmV0dXJuIHBsYW5lX2NvbG9yX2N0bDsK
KworCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCisJCXBsYW5lX2NvbG9yX2N0bCB8PSBQ
TEFORV9DT0xPUl9QSVBFX0dBTU1BX0VOQUJMRTsKKworCWlmIChjcnRjX3N0YXRlLT5jc2NfZW5h
YmxlKQorCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfUElQRV9DU0NfRU5BQkxFOwor
CisJcmV0dXJuIHBsYW5lX2NvbG9yX2N0bDsKK30KKworc3RhdGljIHUzMiBnbGtfcGxhbmVfY29s
b3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAg
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZS0+ZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxf
cGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAw
OworCisJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5FX0dBTU1BX0RJU0FCTEU7
CisJcGxhbmVfY29sb3JfY3RsIHw9IGdsa19wbGFuZV9jb2xvcl9jdGxfYWxwaGEocGxhbmVfc3Rh
dGUpOworCisJaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiAhaWNsX2lzX2hkcl9wbGFuZShkZXZf
cHJpdiwgcGxhbmUtPmlkKSkgeworCQlzd2l0Y2ggKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNv
ZGluZykgeworCQljYXNlIERSTV9DT0xPUl9ZQ0JDUl9CVDcwOToKKwkJCXBsYW5lX2NvbG9yX2N0
bCB8PSBQTEFORV9DT0xPUl9DU0NfTU9ERV9ZVVY3MDlfVE9fUkdCNzA5OworCQkJYnJlYWs7CisJ
CWNhc2UgRFJNX0NPTE9SX1lDQkNSX0JUMjAyMDoKKwkJCXBsYW5lX2NvbG9yX2N0bCB8PQorCQkJ
CVBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjIwMjBfVE9fUkdCMjAyMDsKKwkJCWJyZWFrOworCQlk
ZWZhdWx0OgorCQkJcGxhbmVfY29sb3JfY3RsIHw9CisJCQkJUExBTkVfQ09MT1JfQ1NDX01PREVf
WVVWNjAxX1RPX1JHQjYwMTsKKwkJfQorCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3Jhbmdl
ID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQorCQkJcGxhbmVfY29sb3JfY3RsIHw9IFBM
QU5FX0NPTE9SX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CisJfSBlbHNlIGlmIChmYi0+
Zm9ybWF0LT5pc195dXYpIHsKKwkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX0lOUFVU
X0NTQ19FTkFCTEU7CisJCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NP
TE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1Jf
WVVWX1JBTkdFX0NPUlJFQ1RJT05fRElTQUJMRTsKKwl9CisKKwlyZXR1cm4gcGxhbmVfY29sb3Jf
Y3RsOworfQorCitzdGF0aWMgaW50CittYWluX3RvX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpCit7CisJZHJtX1dBUk5fT04oZmItPmRl
diwgIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpIHx8CisJCSAgICAobWFpbl9wbGFuZSAm
JiBtYWluX3BsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyKSk7CisKKwlyZXR1cm4g
ZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIgKyBtYWluX3BsYW5lOworfQorCitpbnQgc2tsX2Nj
c190b19tYWluX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY2Nz
X3BsYW5lKQoreworCWRybV9XQVJOX09OKGZiLT5kZXYsICFpc19jY3NfbW9kaWZpZXIoZmItPm1v
ZGlmaWVyKSB8fAorCQkgICAgY2NzX3BsYW5lIDwgZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIp
OworCisJaWYgKGlzX2dlbjEyX2Njc19jY19wbGFuZShmYiwgY2NzX3BsYW5lKSkKKwkJcmV0dXJu
IDA7CisKKwlyZXR1cm4gY2NzX3BsYW5lIC0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDI7Cit9
CisKK3N0YXRpYyBpbnQKK3NrbF9tYWluX3RvX2F1eF9wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGZiLT5kZXYpOworCisJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+
bW9kaWZpZXIpKQorCQlyZXR1cm4gbWFpbl90b19jY3NfcGxhbmUoZmIsIG1haW5fcGxhbmUpOwor
CWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA8IDExICYmCisJCSBpbnRlbF9mb3JtYXRfaW5mb19p
c195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIpKQorCQlyZXR1cm4gMTsK
KwllbHNlCisJCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZAorc2tsX3Byb2dyYW1fcGxhbmUo
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKKwkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlLAorCQkgIGludCBjb2xvcl9wbGFuZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJZW51bSBwbGFuZV9p
ZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKwllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwor
CWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3Rh
dGUtPmNrZXk7CisJdTMyIHN1cmZfYWRkciA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xv
cl9wbGFuZV0ub2Zmc2V0OworCXUzMiBzdHJpZGUgPSBza2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0
YXRlLCBjb2xvcl9wbGFuZSk7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBw
bGFuZV9zdGF0ZS0+aHcuZmI7CisJaW50IGF1eF9wbGFuZSA9IHNrbF9tYWluX3RvX2F1eF9wbGFu
ZShmYiwgY29sb3JfcGxhbmUpOworCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3Qu
eDE7CisJaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKKwl1MzIgeCA9IHBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueDsKKwl1MzIgeSA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ueTsKKwl1MzIgc3JjX3cgPSBkcm1fcmVjdF93
aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwl1MzIgc3JjX2ggPSBkcm1fcmVj
dF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJdTggYWxwaGEgPSBwbGFu
ZV9zdGF0ZS0+aHcuYWxwaGEgPj4gODsKKwl1MzIgcGxhbmVfY29sb3JfY3RsID0gMCwgYXV4X2Rp
c3QgPSAwOworCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisJdTMyIGtleW1zaywga2V5bWF4Owor
CXUzMiBwbGFuZV9jdGwgPSBwbGFuZV9zdGF0ZS0+Y3RsOworCisJcGxhbmVfY3RsIHw9IHNrbF9w
bGFuZV9jdGxfY3J0YyhjcnRjX3N0YXRlKTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQlwbGFuZV9jb2xvcl9jdGwgPSBwbGFu
ZV9zdGF0ZS0+Y29sb3JfY3RsIHwKKwkJCWdsa19wbGFuZV9jb2xvcl9jdGxfY3J0YyhjcnRjX3N0
YXRlKTsKKworCS8qIFNpemVzIGFyZSAwIGJhc2VkICovCisJc3JjX3ctLTsKKwlzcmNfaC0tOwor
CisJa2V5bWF4ID0gKGtleS0+bWF4X3ZhbHVlICYgMHhmZmZmZmYpIHwgUExBTkVfS0VZTUFYX0FM
UEhBKGFscGhhKTsKKworCWtleW1zayA9IGtleS0+Y2hhbm5lbF9tYXNrICYgMHg3ZmZmZmZmOwor
CWlmIChhbHBoYSA8IDB4ZmYpCisJCWtleW1zayB8PSBQTEFORV9LRVlNU0tfQUxQSEFfRU5BQkxF
OworCisJLyogVGhlIHNjYWxlciB3aWxsIGhhbmRsZSB0aGUgb3V0cHV0IHBvc2l0aW9uICovCisJ
aWYgKHBsYW5lX3N0YXRlLT5zY2FsZXJfaWQgPj0gMCkgeworCQljcnRjX3ggPSAwOworCQljcnRj
X3kgPSAwOworCX0KKworCWlmIChhdXhfcGxhbmUpIHsKKwkJYXV4X2Rpc3QgPSBwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQgLSBzdXJmX2FkZHI7CisKKwkJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPCAxMikKKwkJCWF1eF9kaXN0IHw9IHNrbF9wbGFuZV9zdHJpZGUo
cGxhbmVfc3RhdGUsIGF1eF9wbGFuZSk7CisJfQorCisJc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9w
cml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsIFBMQU5FX1NUUklERShwaXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7CisJaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFBMQU5FX1BPUyhwaXBlLCBwbGFuZV9pZCksCisJCQkgIChjcnRjX3kg
PDwgMTYpIHwgY3J0Y194KTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU0la
RShwaXBlLCBwbGFuZV9pZCksCisJCQkgIChzcmNfaCA8PCAxNikgfCBzcmNfdyk7CisKKwlpbnRl
bF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX0RJU1QocGlwZSwgcGxhbmVfaWQpLCBh
dXhfZGlzdCk7CisKKwlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQor
CQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1VTX0NUTChwaXBlLCBwbGFuZV9p
ZCksCisJCQkJICBwbGFuZV9zdGF0ZS0+Y3VzX2N0bCk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsIFBMQU5FX0NPTE9SX0NUTChwaXBlLCBwbGFuZV9pZCksCisJCQkJICBwbGFu
ZV9jb2xvcl9jdGwpOworCisJaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiBpY2xfaXNfaGRyX3Bs
YW5lKGRldl9wcml2LCBwbGFuZV9pZCkpCisJCWljbF9wcm9ncmFtX2lucHV0X2NzYyhwbGFuZSwg
Y3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJaWYgKGZiLT5tb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1NfQ0MpCisJCWludGVsX3VuY29yZV93cml0ZTY0
X2Z3KCZkZXZfcHJpdi0+dW5jb3JlLAorCQkJCQlQTEFORV9DQ19WQUwocGlwZSwgcGxhbmVfaWQp
LCBwbGFuZV9zdGF0ZS0+Y2N2YWwpOworCisJc2tsX3dyaXRlX3BsYW5lX3dtKHBsYW5lLCBjcnRj
X3N0YXRlKTsKKworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9LRVlWQUwocGlw
ZSwgcGxhbmVfaWQpLAorCQkJICBrZXktPm1pbl92YWx1ZSk7CisJaW50ZWxfZGVfd3JpdGVfZnco
ZGV2X3ByaXYsIFBMQU5FX0tFWU1TSyhwaXBlLCBwbGFuZV9pZCksIGtleW1zayk7CisJaW50ZWxf
ZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0tFWU1BWChwaXBlLCBwbGFuZV9pZCksIGtleW1h
eCk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfT0ZGU0VUKHBpcGUsIHBs
YW5lX2lkKSwKKwkJCSAgKHkgPDwgMTYpIHwgeCk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA8IDExKQorCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX09GRlNFVChw
aXBlLCBwbGFuZV9pZCksCisJCQkJICAocGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLnkgPDwg
MTYpIHwgcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLngpOworCisJaWYgKCFkcm1fYXRvbWlj
X2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSkpCisJCWludGVsX3BzcjJfcHJv
Z3JhbV9wbGFuZV9zZWxfZmV0Y2gocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCBjb2xv
cl9wbGFuZSk7CisKKwkvKgorCSAqIFRoZSBjb250cm9sIHJlZ2lzdGVyIHNlbGYtYXJtcyBpZiB0
aGUgcGxhbmUgd2FzIHByZXZpb3VzbHkKKwkgKiBkaXNhYmxlZC4gVHJ5IHRvIG1ha2UgdGhlIHBs
YW5lIGVuYWJsZSBhdG9taWMgYnkgd3JpdGluZworCSAqIHRoZSBjb250cm9sIHJlZ2lzdGVyIGp1
c3QgYmVmb3JlIHRoZSBzdXJmYWNlIHJlZ2lzdGVyLgorCSAqLworCWludGVsX2RlX3dyaXRlX2Z3
KGRldl9wcml2LCBQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9jdGwpOworCWludGVs
X2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSwKKwkJCSAg
aW50ZWxfcGxhbmVfZ2d0dF9vZmZzZXQocGxhbmVfc3RhdGUpICsgc3VyZl9hZGRyKTsKKworCWlm
IChwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkID49IDApCisJCXNrbF9wcm9ncmFtX3NjYWxlcihwbGFu
ZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
ZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Cit9CisKK3N0YXRpYyB2b2lkCitza2xf
cGxhbmVfYXN5bmNfZmxpcChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCSAgICAgYm9vbCBhc3luY19mbGlw
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUt
PmJhc2UuZGV2KTsKKwl1bnNpZ25lZCBsb25nIGlycWZsYWdzOworCWVudW0gcGxhbmVfaWQgcGxh
bmVfaWQgPSBwbGFuZS0+aWQ7CisJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKKwl1MzIg
c3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKKwl1MzIgcGxh
bmVfY3RsID0gcGxhbmVfc3RhdGUtPmN0bDsKKworCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3Rs
X2NydGMoY3J0Y19zdGF0ZSk7CisKKwlpZiAoYXN5bmNfZmxpcCkKKwkJcGxhbmVfY3RsIHw9IFBM
QU5FX0NUTF9BU1lOQ19GTElQOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNv
cmUubG9jaywgaXJxZmxhZ3MpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5F
X0NUTChwaXBlLCBwbGFuZV9pZCksIHBsYW5lX2N0bCk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQpLAorCQkJICBpbnRlbF9wbGFuZV9nZ3R0
X29mZnNldChwbGFuZV9zdGF0ZSkgKyBzdXJmX2FkZHIpOworCisJc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Cit9CisKK3N0YXRpYyB2b2lk
Citza2xfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCSBjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJaW50IGNvbG9yX3BsYW5lID0gMDsKKwor
CWlmIChwbGFuZV9zdGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZSAmJiAhcGxhbmVfc3RhdGUtPnBs
YW5hcl9zbGF2ZSkKKwkJLyogUHJvZ3JhbSB0aGUgVVYgcGxhbmUgb24gcGxhbmFyIG1hc3RlciAq
LworCQljb2xvcl9wbGFuZSA9IDE7CisKKwlza2xfcHJvZ3JhbV9wbGFuZShwbGFuZSwgY3J0Y19z
dGF0ZSwgcGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKK30KKworc3RhdGljIGJvb2wgaW50ZWxf
Zm9ybWF0X2lzX3AwMXgodTMyIGZvcm1hdCkKK3sKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2Ug
RFJNX0ZPUk1BVF9QMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgorCWNhc2UgRFJNX0ZPUk1B
VF9QMDE2OgorCQlyZXR1cm4gdHJ1ZTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gZmFsc2U7CisJfQor
fQorCitzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50
IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOworCXN0cnVjdCBkcm1fZm9ybWF0
X25hbWVfYnVmIGZvcm1hdF9uYW1lOworCisJaWYgKCFmYikKKwkJcmV0dXJuIDA7CisKKwlpZiAo
cm90YXRpb24gJiB+KERSTV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVfUk9UQVRFXzE4MCkgJiYK
KwkgICAgaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsKKwkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sCisJCQkgICAgIlJDIHN1cHBvcnQgb25seSB3aXRoIDAvMTgwIGRlZ3JlZSBy
b3RhdGlvbiAoJXgpXG4iLAorCQkJICAgIHJvdGF0aW9uKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJ
fQorCisJaWYgKHJvdGF0aW9uICYgRFJNX01PREVfUkVGTEVDVF9YICYmCisJICAgIGZiLT5tb2Rp
ZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2
LT5kcm0sCisJCQkgICAgImhvcml6b250YWwgZmxpcCBpcyBub3Qgc3VwcG9ydGVkIHdpdGggbGlu
ZWFyIHN1cmZhY2UgZm9ybWF0c1xuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWlmIChk
cm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkgeworCQlpZiAoZmItPm1vZGlmaWVyICE9
IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEICYmCisJCSAgICBmYi0+bW9kaWZpZXIgIT0gSTkxNV9G
T1JNQVRfTU9EX1lmX1RJTEVEKSB7CisJCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJ
CQkgICAgIlkvWWYgdGlsaW5nIHJlcXVpcmVkIGZvciA5MC8yNzAhXG4iKTsKKwkJCXJldHVybiAt
RUlOVkFMOworCQl9CisKKwkJLyoKKwkJICogOTAvMjcwIGlzIG5vdCBhbGxvd2VkIHdpdGggUkdC
NjQgMTY6MTY6MTY6MTYgYW5kCisJCSAqIEluZGV4ZWQgOC1iaXQuIFJHQiAxNi1iaXQgNTo2OjUg
aXMgYWxsb3dlZCBnZW4xMSBvbndhcmRzLgorCQkgKi8KKwkJc3dpdGNoIChmYi0+Zm9ybWF0LT5m
b3JtYXQpIHsKKwkJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDExKQorCQkJCWJyZWFrOworCQkJZmFsbHRocm91Z2g7CisJCWNhc2UgRFJNX0ZP
Uk1BVF9DODoKKwkJY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6CisJCWNhc2UgRFJNX0ZP
Uk1BVF9YQkdSMTYxNjE2MTZGOgorCQljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwkJ
Y2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6CisJCWNhc2UgRFJNX0ZPUk1BVF9ZMjEwOgor
CQljYXNlIERSTV9GT1JNQVRfWTIxMjoKKwkJY2FzZSBEUk1fRk9STUFUX1kyMTY6CisJCWNhc2Ug
RFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTY6CisJCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2
MTY6CisJCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCQkgICAgIlVuc3VwcG9ydGVk
IHBpeGVsIGZvcm1hdCAlcyBmb3IgOTAvMjcwIVxuIiwKKwkJCQkgICAgZHJtX2dldF9mb3JtYXRf
bmFtZShmYi0+Zm9ybWF0LT5mb3JtYXQsCisJCQkJCQkJJmZvcm1hdF9uYW1lKSk7CisJCQlyZXR1
cm4gLUVJTlZBTDsKKwkJZGVmYXVsdDoKKwkJCWJyZWFrOworCQl9CisJfQorCisJLyogWS10aWxp
bmcgaXMgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBJbnRlcmxhY2UgbW9kZSAqLworCWlmIChjcnRj
X3N0YXRlLT5ody5lbmFibGUgJiYKKwkgICAgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5m
bGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFICYmCisJICAgIChmYi0+bW9kaWZpZXIgPT0g
STkxNV9GT1JNQVRfTU9EX1lfVElMRUQgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWWZfVElMRUQgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRF9DQ1MgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0Rf
WWZfVElMRURfQ0NTIHx8CisJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lf
VElMRURfR0VOMTJfUkNfQ0NTIHx8CisJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTIHx8CisJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTX0NDKSkgeworCQlkcm1fZGJnX2ttcygmZGV2
X3ByaXYtPmRybSwKKwkJCSAgICAiWS9ZZiB0aWxpbmcgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBt
b2RlXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJLyogV2FfMTYwNjA1NDE4ODp0Z2ws
YWRsLXMgKi8KKwlpZiAoKElTX0FMREVSTEFLRV9TKGRldl9wcml2KSB8fCBJU19USUdFUkxBS0Uo
ZGV2X3ByaXYpKSAmJgorCSAgICBwbGFuZV9zdGF0ZS0+Y2tleS5mbGFncyAmIEk5MTVfU0VUX0NP
TE9SS0VZX1NPVVJDRSAmJgorCSAgICBpbnRlbF9mb3JtYXRfaXNfcDAxeChmYi0+Zm9ybWF0LT5m
b3JtYXQpKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJTb3VyY2Ug
Y29sb3Iga2V5aW5nIG5vdCBzdXBwb3J0ZWQgd2l0aCBQMDF4IGZvcm1hdHNcbiIpOworCQlyZXR1
cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBza2xfcGxhbmVf
Y2hlY2tfZHN0X2Nvb3JkaW5hdGVzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAorCQkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJCXRvX2k5MTUo
cGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRl
LT51YXBpLmRzdC54MTsKKwlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT51YXBpLmRzdCk7CisJaW50IHBpcGVfc3JjX3cgPSBjcnRjX3N0YXRlLT5waXBlX3NyY193Owor
CisJLyoKKwkgKiBEaXNwbGF5IFdBICMxMTc1OiBjbmwsZ2xrCisJICogUGxhbmVzIG90aGVyIHRo
YW4gdGhlIGN1cnNvciBtYXkgY2F1c2UgRklGTyB1bmRlcmZsb3cgYW5kIGRpc3BsYXkKKwkgKiBj
b3JydXB0aW9uIGlmIHN0YXJ0aW5nIGxlc3MgdGhhbiA0IHBpeGVscyBmcm9tIHRoZSByaWdodCBl
ZGdlIG9mCisJICogdGhlIHNjcmVlbi4KKwkgKiBCZXNpZGVzIHRoZSBhYm92ZSBXQSBmaXggdGhl
IHNpbWlsYXIgcHJvYmxlbSwgd2hlcmUgcGxhbmVzIG90aGVyCisJICogdGhhbiB0aGUgY3Vyc29y
IGVuZGluZyBsZXNzIHRoYW4gNCBwaXhlbHMgZnJvbSB0aGUgbGVmdCBlZGdlIG9mIHRoZQorCSAq
IHNjcmVlbiBtYXkgY2F1c2UgRklGTyB1bmRlcmZsb3cgYW5kIGRpc3BsYXkgY29ycnVwdGlvbi4K
KwkgKi8KKwlpZiAoKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpIHx8IElTX0NBTk5PTkxBS0UoZGV2
X3ByaXYpKSAmJgorCSAgICAoY3J0Y194ICsgY3J0Y193IDwgNCB8fCBjcnRjX3ggPiBwaXBlX3Ny
Y193IC0gNCkpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgInJlcXVl
c3RlZCBwbGFuZSBYICVzIHBvc2l0aW9uICVkIGludmFsaWQgKHZhbGlkIHJhbmdlICVkLSVkKVxu
IiwKKwkJCSAgICBjcnRjX3ggKyBjcnRjX3cgPCA0ID8gImVuZCIgOiAic3RhcnQiLAorCQkJICAg
IGNydGNfeCArIGNydGNfdyA8IDQgPyBjcnRjX3ggKyBjcnRjX3cgOiBjcnRjX3gsCisJCQkgICAg
NCwgcGlwZV9zcmNfdyAtIDQpOworCQlyZXR1cm4gLUVSQU5HRTsKKwl9CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfbnYxMl9yb3RhdGlvbihjb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCWNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3Rh
dGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKKwlpbnQgc3JjX3cgPSBkcm1fcmVjdF93
aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKworCS8qIERpc3BsYXkgV0EgIzEx
MDYgKi8KKwlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1h
dCwgZmItPm1vZGlmaWVyKSAmJgorCSAgICBzcmNfdyAmIDMgJiYKKwkgICAgKHJvdGF0aW9uID09
IERSTV9NT0RFX1JPVEFURV8yNzAgfHwKKwkgICAgIHJvdGF0aW9uID09IChEUk1fTU9ERV9SRUZM
RUNUX1ggfCBEUk1fTU9ERV9ST1RBVEVfOTApKSkgeworCQlEUk1fREVCVUdfS01TKCJzcmMgd2lk
dGggbXVzdCBiZSBtdWx0aXBsZSBvZiA0IGZvciByb3RhdGVkIHBsYW5hciBZVVZcbiIpOworCQly
ZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBza2xfcGxh
bmVfbWF4X3NjYWxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgICAg
ICBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKK3sKKwkvKgorCSAqIFdlIGRvbid0
IHlldCBrbm93IHRoZSBmaW5hbCBzb3VyY2Ugd2lkdGggbm9yCisJICogd2hldGhlciB3ZSBjYW4g
dXNlIHRoZSBIUSBzY2FsZXIgbW9kZS4gQXNzdW1lCisJICogdGhlIGJlc3QgY2FzZS4KKwkgKiBG
SVhNRSBuZWVkIHRvIHByb3Blcmx5IGNoZWNrIHRoaXMgbGF0ZXIuCisJICovCisJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwKKwkgICAg
IWludGVsX2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQsIGZiLT5tb2Rp
ZmllcikpCisJCXJldHVybiAweDMwMDAwIC0gMTsKKwllbHNlCisJCXJldHVybiAweDIwMDAwIC0g
MTsKK30KKworc3RhdGljIGludCBpbnRlbF9wbGFuZV9taW5fd2lkdGgoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKKwkJCQkgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJ
IGludCBjb2xvcl9wbGFuZSwKKwkJCQkgdW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCWlmIChw
bGFuZS0+bWluX3dpZHRoKQorCQlyZXR1cm4gcGxhbmUtPm1pbl93aWR0aChmYiwgY29sb3JfcGxh
bmUsIHJvdGF0aW9uKTsKKwllbHNlCisJCXJldHVybiAxOworfQorCitzdGF0aWMgaW50IGludGVs
X3BsYW5lX21heF93aWR0aChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkJCSBjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgaW50IGNvbG9yX3BsYW5lLAorCQkJCSB1
bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJaWYgKHBsYW5lLT5tYXhfd2lkdGgpCisJCXJldHVy
biBwbGFuZS0+bWF4X3dpZHRoKGZiLCBjb2xvcl9wbGFuZSwgcm90YXRpb24pOworCWVsc2UKKwkJ
cmV0dXJuIElOVF9NQVg7Cit9CisKK3N0YXRpYyBpbnQgaW50ZWxfcGxhbmVfbWF4X2hlaWdodChz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkJCSAgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsCisJCQkJICBpbnQgY29sb3JfcGxhbmUsCisJCQkJICB1bnNpZ25lZCBpbnQgcm90
YXRpb24pCit7CisJaWYgKHBsYW5lLT5tYXhfaGVpZ2h0KQorCQlyZXR1cm4gcGxhbmUtPm1heF9o
ZWlnaHQoZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7CisJZWxzZQorCQlyZXR1cm4gSU5UX01B
WDsKK30KKworc3RhdGljIGJvb2wKK3NrbF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJICAgICAgIGludCBtYWluX3gs
IGludCBtYWluX3ksIHUzMiBtYWluX29mZnNldCwKKwkJCSAgICAgICBpbnQgY2NzX3BsYW5lKQor
eworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OworCWludCBhdXhfeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLng7CisJ
aW50IGF1eF95ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueTsKKwl1MzIg
YXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsK
Kwl1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIGNjc19wbGFuZSk7CisJ
aW50IGhzdWI7CisJaW50IHZzdWI7CisKKwlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmco
JmhzdWIsICZ2c3ViLCBmYiwgY2NzX3BsYW5lKTsKKwl3aGlsZSAoYXV4X29mZnNldCA+PSBtYWlu
X29mZnNldCAmJiBhdXhfeSA8PSBtYWluX3kpIHsKKwkJaW50IHgsIHk7CisKKwkJaWYgKGF1eF94
ID09IG1haW5feCAmJiBhdXhfeSA9PSBtYWluX3kpCisJCQlicmVhazsKKworCQlpZiAoYXV4X29m
ZnNldCA9PSAwKQorCQkJYnJlYWs7CisKKwkJeCA9IGF1eF94IC8gaHN1YjsKKwkJeSA9IGF1eF95
IC8gdnN1YjsKKwkJYXV4X29mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNl
dCgmeCwgJnksCisJCQkJCQkJICAgICAgIHBsYW5lX3N0YXRlLAorCQkJCQkJCSAgICAgICBjY3Nf
cGxhbmUsCisJCQkJCQkJICAgICAgIGF1eF9vZmZzZXQsCisJCQkJCQkJICAgICAgIGF1eF9vZmZz
ZXQgLQorCQkJCQkJCQlhbGlnbm1lbnQpOworCQlhdXhfeCA9IHggKiBoc3ViICsgYXV4X3ggJSBo
c3ViOworCQlhdXhfeSA9IHkgKiB2c3ViICsgYXV4X3kgJSB2c3ViOworCX0KKworCWlmIChhdXhf
eCAhPSBtYWluX3ggfHwgYXV4X3kgIT0gbWFpbl95KQorCQlyZXR1cm4gZmFsc2U7CisKKwlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQgPSBhdXhfb2Zmc2V0OworCXBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggPSBhdXhfeDsKKwlwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0gYXV4X3k7CisKKwlyZXR1cm4gdHJ1ZTsKK30K
KworCitpbnQgc2tsX2NhbGNfbWFpbl9zdXJmYWNlX29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJCSBpbnQgKngsIGludCAqeSwgdTMyICpvZmZz
ZXQpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5l
X3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJY29uc3QgaW50IGF1eF9wbGFuZSA9IHNrbF9t
YWluX3RvX2F1eF9wbGFuZShmYiwgMCk7CisJY29uc3QgdTMyIGF1eF9vZmZzZXQgPSBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQ7CisJY29uc3QgdTMyIGFsaWdubWVu
dCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCAwKTsKKwljb25zdCBpbnQgdyA9IGRybV9yZWN0
X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCisJaW50ZWxfYWRkX2ZiX29m
ZnNldHMoeCwgeSwgcGxhbmVfc3RhdGUsIDApOworCSpvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21w
dXRlX2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwKTsKKwlpZiAoZHJtX1dBUk5f
T04oJmRldl9wcml2LT5kcm0sIGFsaWdubWVudCAmJiAhaXNfcG93ZXJfb2ZfMihhbGlnbm1lbnQp
KSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwkvKgorCSAqIEFVWCBzdXJmYWNlIG9mZnNldCBpcyBz
cGVjaWZpZWQgYXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlCisJICogbWFpbiBzdXJmYWNlIG9mZnNl
dCwgYW5kIGl0IG11c3QgYmUgbm9uLW5lZ2F0aXZlLiBNYWtlCisJICogc3VyZSB0aGF0IGlzIHdo
YXQgd2Ugd2lsbCBnZXQuCisJICovCisJaWYgKGF1eF9wbGFuZSAmJiAqb2Zmc2V0ID4gYXV4X29m
ZnNldCkKKwkJKm9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCh4LCB5
LCBwbGFuZV9zdGF0ZSwgMCwKKwkJCQkJCQkgICAgKm9mZnNldCwKKwkJCQkJCQkgICAgYXV4X29m
ZnNldCAmIH4oYWxpZ25tZW50IC0gMSkpOworCisJLyoKKwkgKiBXaGVuIHVzaW5nIGFuIFgtdGls
ZWQgc3VyZmFjZSwgdGhlIHBsYW5lIGJsb3dzIHVwCisJICogaWYgdGhlIHggb2Zmc2V0ICsgd2lk
dGggZXhjZWVkIHRoZSBzdHJpZGUuCisJICoKKwkgKiBUT0RPOiBsaW5lYXIgYW5kIFktdGlsZWQg
c2VlbSBmaW5lLCBZZiB1bnRlc3RlZCwKKwkgKi8KKwlpZiAoZmItPm1vZGlmaWVyID09IEk5MTVf
Rk9STUFUX01PRF9YX1RJTEVEKSB7CisJCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CisK
KwkJd2hpbGUgKCgqeCArIHcpICogY3BwID4gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnN0
cmlkZSkgeworCQkJaWYgKCpvZmZzZXQgPT0gMCkgeworCQkJCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLAorCQkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRpc3BsYXkgc3VyZmFj
ZSBvZmZzZXQgZHVlIHRvIFgtdGlsaW5nXG4iKTsKKwkJCQlyZXR1cm4gLUVJTlZBTDsKKwkJCX0K
KworCQkJKm9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCh4LCB5LCBw
bGFuZV9zdGF0ZSwgMCwKKwkJCQkJCQkJICAgICpvZmZzZXQsCisJCQkJCQkJCSAgICAqb2Zmc2V0
IC0gYWxpZ25tZW50KTsKKwkJfQorCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHNr
bF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVf
c3RhdGUtPnVhcGkucGxhbmUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwljb25zdCB1bnNpZ25lZCBpbnQgcm90YXRpb24g
PSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJaW50IHggPSBwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMueDEgPj4gMTY7CisJaW50IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CisJ
Y29uc3QgaW50IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAx
NjsKKwljb25zdCBpbnQgaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3Jj
KSA+PiAxNjsKKwljb25zdCBpbnQgbWluX3dpZHRoID0gaW50ZWxfcGxhbmVfbWluX3dpZHRoKHBs
YW5lLCBmYiwgMCwgcm90YXRpb24pOworCWNvbnN0IGludCBtYXhfd2lkdGggPSBpbnRlbF9wbGFu
ZV9tYXhfd2lkdGgocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7CisJY29uc3QgaW50IG1heF9oZWln
aHQgPSBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgMCwgcm90YXRpb24pOworCWNv
bnN0IGludCBhdXhfcGxhbmUgPSBza2xfbWFpbl90b19hdXhfcGxhbmUoZmIsIDApOworCWNvbnN0
IHUzMiBhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgMCk7CisJdTMyIG9mZnNl
dDsKKwlpbnQgcmV0OworCisJaWYgKHcgPiBtYXhfd2lkdGggfHwgdyA8IG1pbl93aWR0aCB8fCBo
ID4gbWF4X2hlaWdodCkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAi
cmVxdWVzdGVkIFkvUkdCIHNvdXJjZSBzaXplICVkeCVkIG91dHNpZGUgbGltaXRzIChtaW46ICVk
eDEgbWF4OiAlZHglZClcbiIsCisJCQkgICAgdywgaCwgbWluX3dpZHRoLCBtYXhfd2lkdGgsIG1h
eF9oZWlnaHQpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlyZXQgPSBza2xfY2FsY19tYWlu
X3N1cmZhY2Vfb2Zmc2V0KHBsYW5lX3N0YXRlLCAmeCwgJnksICZvZmZzZXQpOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CisKKwkvKgorCSAqIENDUyBBVVggc3VyZmFjZSBkb2Vzbid0IGhhdmUg
aXRzIG93biB4L3kgb2Zmc2V0cywgd2UgbXVzdCBtYWtlIHN1cmUKKwkgKiB0aGV5IG1hdGNoIHdp
dGggdGhlIG1haW4gc3VyZmFjZSB4L3kgb2Zmc2V0cy4KKwkgKi8KKwlpZiAoaXNfY2NzX21vZGlm
aWVyKGZiLT5tb2RpZmllcikpIHsKKwkJd2hpbGUgKCFza2xfY2hlY2tfbWFpbl9jY3NfY29vcmRp
bmF0ZXMocGxhbmVfc3RhdGUsIHgsIHksCisJCQkJCQkgICAgICAgb2Zmc2V0LCBhdXhfcGxhbmUp
KSB7CisJCQlpZiAob2Zmc2V0ID09IDApCisJCQkJYnJlYWs7CisKKwkJCW9mZnNldCA9IGludGVs
X3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksIHBsYW5lX3N0YXRlLCAwLAorCQkJ
CQkJCQkgICBvZmZzZXQsIG9mZnNldCAtIGFsaWdubWVudCk7CisJCX0KKworCQlpZiAoeCAhPSBw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS54IHx8CisJCSAgICB5ICE9IHBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVdLnkpIHsKKwkJCWRybV9kYmdfa21zKCZkZXZf
cHJpdi0+ZHJtLAorCQkJCSAgICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJm
YWNlIG9mZnNldCBkdWUgdG8gQ0NTXG4iKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJfQor
CisJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHggPiA4MTkxIHx8IHkgPiA4MTkxKTsKKwor
CXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQgPSBvZmZzZXQ7CisJcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lWzBdLnggPSB4OworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS55
ID0geTsKKworCS8qCisJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRlcyBiYWNrIHNvIHRoYXQg
dGhlIHNyYworCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRoZSByaWdodCB2YWx1ZXMu
CisJICovCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCisJ
CQkgICAgICB4IDw8IDE2LCB5IDw8IDE2KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50
IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5l
KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBw
bGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJaW50IHV2X3BsYW5lID0gMTsKKwlpbnQgbWF4X3dp
ZHRoID0gaW50ZWxfcGxhbmVfbWF4X3dpZHRoKHBsYW5lLCBmYiwgdXZfcGxhbmUsIHJvdGF0aW9u
KTsKKwlpbnQgbWF4X2hlaWdodCA9IGludGVsX3BsYW5lX21heF9oZWlnaHQocGxhbmUsIGZiLCB1
dl9wbGFuZSwgcm90YXRpb24pOworCWludCB4ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLngxID4+
IDE3OworCWludCB5ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE3OworCWludCB3ID0g
ZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTc7CisJaW50IGggPSBk
cm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTc7CisJdTMyIG9mZnNl
dDsKKworCS8qIEZJWE1FIG5vdCBxdWl0ZSBzdXJlIGhvdy9pZiB0aGVzZSBhcHBseSB0byB0aGUg
Y2hyb21hIHBsYW5lICovCisJaWYgKHcgPiBtYXhfd2lkdGggfHwgaCA+IG1heF9oZWlnaHQpIHsK
KwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKKwkJCSAgICAiQ2JDciBzb3VyY2Ugc2l6ZSAlZHgl
ZCB0b28gYmlnIChsaW1pdCAlZHglZClcbiIsCisJCQkgICAgdywgaCwgbWF4X3dpZHRoLCBtYXhf
aGVpZ2h0KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaW50ZWxfYWRkX2ZiX29mZnNldHMo
JngsICZ5LCBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOworCW9mZnNldCA9IGludGVsX3BsYW5lX2Nv
bXB1dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAorCQkJCQkJICAgIHBsYW5lX3N0YXRlLCB1dl9w
bGFuZSk7CisKKwlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsKKwkJaW50IGNj
c19wbGFuZSA9IG1haW5fdG9fY2NzX3BsYW5lKGZiLCB1dl9wbGFuZSk7CisJCXUzMiBhdXhfb2Zm
c2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zmc2V0OworCQl1MzIg
YWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIHV2X3BsYW5lKTsKKworCQlpZiAo
b2Zmc2V0ID4gYXV4X29mZnNldCkKKwkJCW9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGln
bmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJCSAgIHBsYW5lX3N0YXRlLAorCQkJCQkJCQkgICB1
dl9wbGFuZSwKKwkJCQkJCQkJICAgb2Zmc2V0LAorCQkJCQkJCQkgICBhdXhfb2Zmc2V0ICYgfihh
bGlnbm1lbnQgLSAxKSk7CisKKwkJd2hpbGUgKCFza2xfY2hlY2tfbWFpbl9jY3NfY29vcmRpbmF0
ZXMocGxhbmVfc3RhdGUsIHgsIHksCisJCQkJCQkgICAgICAgb2Zmc2V0LCBjY3NfcGxhbmUpKSB7
CisJCQlpZiAob2Zmc2V0ID09IDApCisJCQkJYnJlYWs7CisKKwkJCW9mZnNldCA9IGludGVsX3Bs
YW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJCSAgIHBsYW5lX3N0YXRl
LAorCQkJCQkJCQkgICB1dl9wbGFuZSwKKwkJCQkJCQkJICAgb2Zmc2V0LCBvZmZzZXQgLSBhbGln
bm1lbnQpOworCQl9CisKKwkJaWYgKHggIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19w
bGFuZV0ueCB8fAorCQkgICAgeSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5l
XS55KSB7CisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAorCQkJCSAgICAiVW5hYmxlIHRvIGZp
bmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gQ0NTXG4iKTsKKwkJCXJl
dHVybiAtRUlOVkFMOworCQl9CisJfQorCisJZHJtX1dBUk5fT04oJmk5MTUtPmRybSwgeCA+IDgx
OTEgfHwgeSA+IDgxOTEpOworCisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW3V2X3BsYW5lXS5v
ZmZzZXQgPSBvZmZzZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW3V2X3BsYW5lXS54ID0g
eDsKKwlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbdXZfcGxhbmVdLnkgPSB5OworCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgc2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWludCBzcmNfeCA9IHBsYW5lX3N0YXRl
LT51YXBpLnNyYy54MSA+PiAxNjsKKwlpbnQgc3JjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMu
eTEgPj4gMTY7CisJdTMyIG9mZnNldDsKKwlpbnQgY2NzX3BsYW5lOworCisJZm9yIChjY3NfcGxh
bmUgPSAwOyBjY3NfcGxhbmUgPCBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBjY3NfcGxhbmUrKykg
eworCQlpbnQgbWFpbl9oc3ViLCBtYWluX3ZzdWI7CisJCWludCBoc3ViLCB2c3ViOworCQlpbnQg
eCwgeTsKKworCQlpZiAoIWlzX2Njc19wbGFuZShmYiwgY2NzX3BsYW5lKSB8fAorCQkgICAgaXNf
Z2VuMTJfY2NzX2NjX3BsYW5lKGZiLCBjY3NfcGxhbmUpKQorCQkJY29udGludWU7CisKKwkJaW50
ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZtYWluX2hzdWIsICZtYWluX3ZzdWIsIGZiLAor
CQkJCQkgICAgICAgc2tsX2Njc190b19tYWluX3BsYW5lKGZiLCBjY3NfcGxhbmUpKTsKKwkJaW50
ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZoc3ViLCAmdnN1YiwgZmIsIGNjc19wbGFuZSk7
CisKKwkJaHN1YiAqPSBtYWluX2hzdWI7CisJCXZzdWIgKj0gbWFpbl92c3ViOworCQl4ID0gc3Jj
X3ggLyBoc3ViOworCQl5ID0gc3JjX3kgLyB2c3ViOworCisJCWludGVsX2FkZF9mYl9vZmZzZXRz
KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIGNjc19wbGFuZSk7CisKKwkJb2Zmc2V0ID0gaW50ZWxfcGxh
bmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJICAgIHBsYW5lX3N0YXRl
LAorCQkJCQkJCSAgICBjY3NfcGxhbmUpOworCisJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtj
Y3NfcGxhbmVdLm9mZnNldCA9IG9mZnNldDsKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Nj
c19wbGFuZV0ueCA9ICh4ICogaHN1YiArCisJCQkJCQkJIHNyY194ICUgaHN1YikgLworCQkJCQkJ
CW1haW5faHN1YjsKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSA9ICh5
ICogdnN1YiArCisJCQkJCQkJIHNyY195ICUgdnN1YikgLworCQkJCQkJCW1haW5fdnN1YjsKKwl9
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCWNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWludCByZXQsIGk7CisK
KwlyZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2d0dChwbGFuZV9zdGF0ZSk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKKwkJcmV0
dXJuIDA7CisKKwkvKgorCSAqIEhhbmRsZSB0aGUgQVVYIHN1cmZhY2UgZmlyc3Qgc2luY2UgdGhl
IG1haW4gc3VyZmFjZSBzZXR1cCBkZXBlbmRzIG9uCisJICogaXQuCisJICovCisJaWYgKGlzX2Nj
c19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7CisJCXJldCA9IHNrbF9jaGVja19jY3NfYXV4X3N1
cmZhY2UocGxhbmVfc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlp
ZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwKKwkJCQkJ
CWZiLT5tb2RpZmllcikpIHsKKwkJcmV0ID0gc2tsX2NoZWNrX252MTJfYXV4X3N1cmZhY2UocGxh
bmVfc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlmb3IgKGkgPSBm
Yi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBpIDwgQVJSQVlfU0laRShwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmUpOyBpKyspIHsKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ldLm9mZnNldCA9IDA7
CisJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS54ID0gMDsKKwkJcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2ldLnkgPSAwOworCX0KKworCXJldCA9IHNrbF9jaGVja19tYWluX3N1cmZhY2Uo
cGxhbmVfc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIGJvb2wgaW50ZWxfZmJfc2NhbGFibGUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIpCit7CisJaWYgKCFmYikKKwkJcmV0dXJuIGZhbHNlOworCisJc3dpdGNoIChmYi0+
Zm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJCXJldHVybiBmYWxzZTsK
KwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjE2
MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JN
QVRfQUJHUjE2MTYxNjE2RjoKKwkJcmV0dXJuIElOVEVMX0dFTih0b19pOTE1KGZiLT5kZXYpKSA+
PSAxMTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gdHJ1ZTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgc2ts
X3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2Uu
ZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKKwlpbnQgbWluX3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOworCWlu
dCBtYXhfc2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkc7CisJaW50IHJldDsKKwor
CXJldCA9IHNrbF9wbGFuZV9jaGVja19mYihjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisJaWYg
KHJldCkKKwkJcmV0dXJuIHJldDsKKworCS8qIHVzZSBzY2FsZXIgd2hlbiBjb2xvcmtleSBpcyBu
b3QgcmVxdWlyZWQgKi8KKwlpZiAoIXBsYW5lX3N0YXRlLT5ja2V5LmZsYWdzICYmIGludGVsX2Zi
X3NjYWxhYmxlKGZiKSkgeworCQltaW5fc2NhbGUgPSAxOworCQltYXhfc2NhbGUgPSBza2xfcGxh
bmVfbWF4X3NjYWxlKGRldl9wcml2LCBmYik7CisJfQorCisJcmV0ID0gaW50ZWxfYXRvbWljX3Bs
YW5lX2NoZWNrX2NsaXBwaW5nKHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlLAorCQkJCQkJbWluX3Nj
YWxlLCBtYXhfc2NhbGUsIHRydWUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQg
PSBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShwbGFuZV9zdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0
dXJuIHJldDsKKworCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKKwkJcmV0dXJuIDA7
CisKKwlyZXQgPSBza2xfcGxhbmVfY2hlY2tfZHN0X2Nvb3JkaW5hdGVzKGNydGNfc3RhdGUsIHBs
YW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gaW50ZWxfcGxh
bmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OworCisJcmV0ID0gc2tsX3BsYW5lX2NoZWNrX252MTJfcm90YXRpb24ocGxhbmVfc3Rh
dGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwkvKiBIVyBvbmx5IGhhcyA4IGJpdHMg
cGl4ZWwgcHJlY2lzaW9uLCBkaXNhYmxlIHBsYW5lIGlmIGludmlzaWJsZSAqLworCWlmICghKHBs
YW5lX3N0YXRlLT5ody5hbHBoYSA+PiA4KSkKKwkJcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSA9
IGZhbHNlOworCisJcGxhbmVfc3RhdGUtPmN0bCA9IHNrbF9wbGFuZV9jdGwoY3J0Y19zdGF0ZSwg
cGxhbmVfc3RhdGUpOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VN
SU5JTEFLRShkZXZfcHJpdikpCisJCXBsYW5lX3N0YXRlLT5jb2xvcl9jdGwgPSBnbGtfcGxhbmVf
Y29sb3JfY3RsKGNydGNfc3RhdGUsCisJCQkJCQkJICAgICBwbGFuZV9zdGF0ZSk7CisKKwlpZiAo
aW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwgZmItPm1vZGlm
aWVyKSAmJgorCSAgICBpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZS0+aWQpKQorCQkv
KiBFbmFibGUgYW5kIHVzZSBNUEVHLTIgY2hyb21hIHNpdGluZyAqLworCQlwbGFuZV9zdGF0ZS0+
Y3VzX2N0bCA9IFBMQU5FX0NVU19FTkFCTEUgfAorCQkJUExBTkVfQ1VTX0hQSEFTRV8wIHwKKwkJ
CVBMQU5FX0NVU19WUEhBU0VfU0lHTl9ORUdBVElWRSB8IFBMQU5FX0NVU19WUEhBU0VfMF8yNTsK
KwllbHNlCisJCXBsYW5lX3N0YXRlLT5jdXNfY3RsID0gMDsKKworCXJldHVybiAwOworfQorCitz
dGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX2ZiYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCisJCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkK
K3sKKwlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4g
cGlwZSA9PSBQSVBFX0EgJiYgcGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWTsKK30KKworc3RhdGlj
IGJvb2wgc2tsX3BsYW5lX2hhc19wbGFuYXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAorCQkJCSBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sKKwkv
KiBEaXNwbGF5IFdBICMwODcwOiBza2wsIGJ4dCAqLworCWlmIChJU19TS1lMQUtFKGRldl9wcml2
KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KSkKKwkJcmV0dXJuIGZhbHNlOworCisJaWYgKElTX0dF
TihkZXZfcHJpdiwgOSkgJiYgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpICYmIHBpcGUgPT0gUElQ
RV9DKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAocGxhbmVfaWQgIT0gUExBTkVfUFJJTUFSWSAm
JiBwbGFuZV9pZCAhPSBQTEFORV9TUFJJVEUwKQorCQlyZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4g
dHJ1ZTsKK30KKworc3RhdGljIGNvbnN0IHUzMiAqc2tsX2dldF9wbGFuZV9mb3JtYXRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJZW51bSBwaXBlIHBpcGUsIGVudW0g
cGxhbmVfaWQgcGxhbmVfaWQsCisJCQkJCWludCAqbnVtX2Zvcm1hdHMpCit7CisJaWYgKHNrbF9w
bGFuZV9oYXNfcGxhbmFyKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCkpIHsKKwkJKm51bV9mb3Jt
YXRzID0gQVJSQVlfU0laRShza2xfcGxhbmFyX2Zvcm1hdHMpOworCQlyZXR1cm4gc2tsX3BsYW5h
cl9mb3JtYXRzOworCX0gZWxzZSB7CisJCSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoc2tsX3Bs
YW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gc2tsX3BsYW5lX2Zvcm1hdHM7CisJfQorfQorCitzdGF0
aWMgY29uc3QgdTMyICpnbGtfZ2V0X3BsYW5lX2Zvcm1hdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorCQkJCQllbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZCwKKwkJCQkJaW50ICpudW1fZm9ybWF0cykKK3sKKwlpZiAoc2tsX3BsYW5lX2hhc19wbGFuYXIo
ZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKSkgeworCQkqbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpF
KGdsa19wbGFuYXJfZm9ybWF0cyk7CisJCXJldHVybiBnbGtfcGxhbmFyX2Zvcm1hdHM7CisJfSBl
bHNlIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmVfZm9ybWF0cyk7CisJ
CXJldHVybiBza2xfcGxhbmVfZm9ybWF0czsKKwl9Cit9CisKK3N0YXRpYyBjb25zdCB1MzIgKmlj
bF9nZXRfcGxhbmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJ
CQkJCWVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkLAorCQkJCQlpbnQgKm51
bV9mb3JtYXRzKQoreworCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkp
IHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfaGRyX3BsYW5lX2Zvcm1hdHMpOwor
CQlyZXR1cm4gaWNsX2hkcl9wbGFuZV9mb3JtYXRzOworCX0gZWxzZSBpZiAoaWNsX2lzX252MTJf
eV9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7CisJCSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJ
WkUoaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gaWNsX3Nkcl95X3BsYW5lX2Zv
cm1hdHM7CisJfSBlbHNlIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfc2RyX3V2
X3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gaWNsX3Nkcl91dl9wbGFuZV9mb3JtYXRzOworCX0K
K30KKworc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19jY3Moc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorCQkJICAgICAgZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxh
bmVfaWQpCit7CisJaWYgKHBsYW5lX2lkID09IFBMQU5FX0NVUlNPUikKKwkJcmV0dXJuIGZhbHNl
OworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJCXJldHVybiB0cnVlOworCisJ
aWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQlyZXR1cm4gcGlwZSAhPSBQSVBFX0M7CisK
KwlyZXR1cm4gcGlwZSAhPSBQSVBFX0MgJiYKKwkJKHBsYW5lX2lkID09IFBMQU5FX1BSSU1BUlkg
fHwKKwkJIHBsYW5lX2lkID09IFBMQU5FX1NQUklURTApOworfQorCitzdGF0aWMgYm9vbCBza2xf
cGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAorCQkJ
CQkgICB1MzIgZm9ybWF0LCB1NjQgbW9kaWZpZXIpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKF9wbGFuZSk7CisKKwlzd2l0Y2ggKG1vZGlmaWVyKSB7CisJ
Y2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxF
RDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgorCWNhc2UgSTkxNV9GT1JNQVRfTU9E
X1lmX1RJTEVEOgorCQlicmVhazsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoK
KwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6CisJCWlmICghcGxhbmUtPmhhc19j
Y3MpCisJCQlyZXR1cm4gZmFsc2U7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiBmYWxz
ZTsKKwl9CisKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoK
KwljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4Ogor
CWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKKwkJaWYgKGlzX2Njc19tb2RpZmllcihtb2RpZmll
cikpCisJCQlyZXR1cm4gdHJ1ZTsKKwkJZmFsbHRocm91Z2g7CisJY2FzZSBEUk1fRk9STUFUX1JH
QjU2NToKKwljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hC
R1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JN
QVRfQUJHUjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1lVWVY6CisJY2FzZSBEUk1fRk9STUFU
X1lWWVU6CisJY2FzZSBEUk1fRk9STUFUX1VZVlk6CisJY2FzZSBEUk1fRk9STUFUX1ZZVVk6CisJ
Y2FzZSBEUk1fRk9STUFUX05WMTI6CisJY2FzZSBEUk1fRk9STUFUX1hZVVY4ODg4OgorCWNhc2Ug
RFJNX0ZPUk1BVF9QMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgorCWNhc2UgRFJNX0ZPUk1B
VF9QMDE2OgorCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoKKwkJaWYgKG1vZGlmaWVyID09
IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCkKKwkJCXJldHVybiB0cnVlOworCQlmYWxsdGhyb3Vn
aDsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJY2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6
CisJY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX1hSR0Ix
NjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9S
TUFUX1kyMTA6CisJY2FzZSBEUk1fRk9STUFUX1kyMTI6CisJY2FzZSBEUk1fRk9STUFUX1kyMTY6
CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKKwljYXNlIERSTV9GT1JNQVRfWFZZ
VTE2MTYxNjE2OgorCQlpZiAobW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8CisJ
CSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCB8fAorCQkgICAgbW9kaWZp
ZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQpCisJCQlyZXR1cm4gdHJ1ZTsKKwkJZmFsbHRo
cm91Z2g7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0KK30KKworc3RhdGljIGJvb2wg
Z2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKKwkJCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sKKwkvKiBXYV8xNDAxMDQ3NzAw
ODp0Z2xbYTAuLmMwXSxya2xbYWxsXSxkZzFbYWxsXSAqLworCWlmIChJU19ERzEoZGV2X3ByaXYp
IHx8IElTX1JPQ0tFVExBS0UoZGV2X3ByaXYpIHx8CisJICAgIElTX1RHTF9ESVNQX1NURVBQSU5H
KGRldl9wcml2LCBTVEVQX0EwLCBTVEVQX0MwKSkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJu
IHBsYW5lX2lkIDwgUExBTkVfU1BSSVRFNDsKK30KKworc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVf
Zm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAorCQkJCQkgICAg
IHUzMiBmb3JtYXQsIHU2NCBtb2RpZmllcikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KF9wbGFuZS0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUoX3BsYW5lKTsKKworCXN3aXRjaCAobW9kaWZpZXIpIHsKKwlj
YXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzoKKwkJaWYgKCFnZW4xMl9w
bGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3ByaXYsIHBsYW5lLT5pZCkpCisJCQlyZXR1cm4gZmFs
c2U7CisJCWZhbGx0aHJvdWdoOworCWNhc2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgorCWNhc2Ug
STkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoK
KwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDU19DQzoKKwkJYnJlYWs7CisJZGVmYXVsdDoK
KwkJcmV0dXJuIGZhbHNlOworCX0KKworCXN3aXRjaCAoZm9ybWF0KSB7CisJY2FzZSBEUk1fRk9S
TUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKKwljYXNlIERSTV9GT1JN
QVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgorCQlpZiAoaXNfY2NzX21v
ZGlmaWVyKG1vZGlmaWVyKSkKKwkJCXJldHVybiB0cnVlOworCQlmYWxsdGhyb3VnaDsKKwljYXNl
IERSTV9GT1JNQVRfWVVZVjoKKwljYXNlIERSTV9GT1JNQVRfWVZZVToKKwljYXNlIERSTV9GT1JN
QVRfVVlWWToKKwljYXNlIERSTV9GT1JNQVRfVllVWToKKwljYXNlIERSTV9GT1JNQVRfTlYxMjoK
KwljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6CisJY2Fz
ZSBEUk1fRk9STUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJCWlmIChtb2RpZmll
ciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MpCisJCQlyZXR1cm4gdHJ1
ZTsKKwkJZmFsbHRocm91Z2g7CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwljYXNlIERSTV9G
T1JNQVRfWFJHQjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgorCWNhc2Ug
RFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6CisJ
Y2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9DODoKKwljYXNl
IERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2
RjoKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQVJH
QjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWTIxMDoKKwljYXNlIERSTV9GT1JNQVRfWTIx
MjoKKwljYXNlIERSTV9GT1JNQVRfWTIxNjoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYx
NjE2OgorCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6CisJCWlmIChtb2RpZmllciA9PSBE
Uk1fRk9STUFUX01PRF9MSU5FQVIgfHwKKwkJICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01P
RF9YX1RJTEVEIHx8CisJCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCkK
KwkJCXJldHVybiB0cnVlOworCQlmYWxsdGhyb3VnaDsKKwlkZWZhdWx0OgorCQlyZXR1cm4gZmFs
c2U7CisJfQorfQorCitzdGF0aWMgY29uc3QgdTY0ICpnZW4xMl9nZXRfcGxhbmVfbW9kaWZpZXJz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJICAgIGVudW0gcGxhbmVf
aWQgcGxhbmVfaWQpCit7CisJaWYgKGdlbjEyX3BsYW5lX3N1cHBvcnRzX21jX2NjcyhkZXZfcHJp
diwgcGxhbmVfaWQpKQorCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19tY19j
Y3M7CisJZWxzZQorCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19yY19jY3M7
Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzIHNrbF9wbGFuZV9mdW5j
cyA9IHsKKwkudXBkYXRlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAor
CS5kaXNhYmxlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZSwKKwkuZGVz
dHJveSA9IGludGVsX3BsYW5lX2Rlc3Ryb3ksCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBp
bnRlbF9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50
ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZSwKKwkuZm9ybWF0X21vZF9zdXBwb3J0ZWQgPSBza2xfcGxh
bmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9w
bGFuZV9mdW5jcyBnZW4xMl9wbGFuZV9mdW5jcyA9IHsKKwkudXBkYXRlX3BsYW5lID0gZHJtX2F0
b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAorCS5kaXNhYmxlX3BsYW5lID0gZHJtX2F0b21pY19o
ZWxwZXJfZGlzYWJsZV9wbGFuZSwKKwkuZGVzdHJveSA9IGludGVsX3BsYW5lX2Rlc3Ryb3ksCisJ
LmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBpbnRlbF9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJ
LmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZSwKKwkuZm9y
bWF0X21vZF9zdXBwb3J0ZWQgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZCwKK307
CisKK3N0YXRpYyB2b2lkCitza2xfcGxhbmVfZW5hYmxlX2ZsaXBfZG9uZShzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShwbGFuZS0+YmFzZS5kZXYpOworCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CisKKwlz
cGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJYmR3X2VuYWJsZV9waXBlX2lycShpOTE1
LCBwaXBlLCBHRU45X1BJUEVfUExBTkVfRkxJUF9ET05FKHBsYW5lLT5pZCkpOworCXNwaW5fdW5s
b2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworfQorCitzdGF0aWMgdm9pZAorc2tsX3BsYW5lX2Rp
c2FibGVfZmxpcF9kb25lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUpCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJZW51bSBw
aXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKKworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2Nr
KTsKKwliZHdfZGlzYWJsZV9waXBlX2lycShpOTE1LCBwaXBlLCBHRU45X1BJUEVfUExBTkVfRkxJ
UF9ET05FKHBsYW5lLT5pZCkpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwor
fQorCitzdHJ1Y3QgaW50ZWxfcGxhbmUgKgorc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJICAgZW51bSBwaXBlIHBpcGUsIGVu
dW0gcGxhbmVfaWQgcGxhbmVfaWQpCit7CisJY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyAq
cGxhbmVfZnVuY3M7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKKwllbnVtIGRybV9wbGFu
ZV90eXBlIHBsYW5lX3R5cGU7CisJdW5zaWduZWQgaW50IHN1cHBvcnRlZF9yb3RhdGlvbnM7CisJ
dW5zaWduZWQgaW50IHN1cHBvcnRlZF9jc2M7CisJY29uc3QgdTY0ICptb2RpZmllcnM7CisJY29u
c3QgdTMyICpmb3JtYXRzOworCWludCBudW1fZm9ybWF0czsKKwlpbnQgcmV0OworCisJcGxhbmUg
PSBpbnRlbF9wbGFuZV9hbGxvYygpOworCWlmIChJU19FUlIocGxhbmUpKQorCQlyZXR1cm4gcGxh
bmU7CisKKwlwbGFuZS0+cGlwZSA9IHBpcGU7CisJcGxhbmUtPmlkID0gcGxhbmVfaWQ7CisJcGxh
bmUtPmZyb250YnVmZmVyX2JpdCA9IElOVEVMX0ZST05UQlVGRkVSKHBpcGUsIHBsYW5lX2lkKTsK
KworCXBsYW5lLT5oYXNfZmJjID0gc2tsX3BsYW5lX2hhc19mYmMoZGV2X3ByaXYsIHBpcGUsIHBs
YW5lX2lkKTsKKwlpZiAocGxhbmUtPmhhc19mYmMpIHsKKwkJc3RydWN0IGludGVsX2ZiYyAqZmJj
ID0gJmRldl9wcml2LT5mYmM7CisKKwkJZmJjLT5wb3NzaWJsZV9mcmFtZWJ1ZmZlcl9iaXRzIHw9
IHBsYW5lLT5mcm9udGJ1ZmZlcl9iaXQ7CisJfQorCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTEpIHsKKwkJcGxhbmUtPm1pbl93aWR0aCA9IGljbF9wbGFuZV9taW5fd2lkdGg7CisJCXBs
YW5lLT5tYXhfd2lkdGggPSBpY2xfcGxhbmVfbWF4X3dpZHRoOworCQlwbGFuZS0+bWF4X2hlaWdo
dCA9IGljbF9wbGFuZV9tYXhfaGVpZ2h0OworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgeworCQlwbGFuZS0+bWF4X3dpZHRo
ID0gZ2xrX3BsYW5lX21heF93aWR0aDsKKwkJcGxhbmUtPm1heF9oZWlnaHQgPSBza2xfcGxhbmVf
bWF4X2hlaWdodDsKKwl9IGVsc2UgeworCQlwbGFuZS0+bWF4X3dpZHRoID0gc2tsX3BsYW5lX21h
eF93aWR0aDsKKwkJcGxhbmUtPm1heF9oZWlnaHQgPSBza2xfcGxhbmVfbWF4X2hlaWdodDsKKwl9
CisKKwlwbGFuZS0+bWF4X3N0cmlkZSA9IHNrbF9wbGFuZV9tYXhfc3RyaWRlOworCXBsYW5lLT51
cGRhdGVfcGxhbmUgPSBza2xfdXBkYXRlX3BsYW5lOworCXBsYW5lLT5kaXNhYmxlX3BsYW5lID0g
c2tsX2Rpc2FibGVfcGxhbmU7CisJcGxhbmUtPmdldF9od19zdGF0ZSA9IHNrbF9wbGFuZV9nZXRf
aHdfc3RhdGU7CisJcGxhbmUtPmNoZWNrX3BsYW5lID0gc2tsX3BsYW5lX2NoZWNrOworCXBsYW5l
LT5taW5fY2RjbGsgPSBza2xfcGxhbmVfbWluX2NkY2xrOworCisJaWYgKHBsYW5lX2lkID09IFBM
QU5FX1BSSU1BUlkpIHsKKwkJcGxhbmUtPm5lZWRfYXN5bmNfZmxpcF9kaXNhYmxlX3dhID0gSVNf
R0VOX1JBTkdFKGRldl9wcml2LCA5LCAxMCk7CisJCXBsYW5lLT5hc3luY19mbGlwID0gc2tsX3Bs
YW5lX2FzeW5jX2ZsaXA7CisJCXBsYW5lLT5lbmFibGVfZmxpcF9kb25lID0gc2tsX3BsYW5lX2Vu
YWJsZV9mbGlwX2RvbmU7CisJCXBsYW5lLT5kaXNhYmxlX2ZsaXBfZG9uZSA9IHNrbF9wbGFuZV9k
aXNhYmxlX2ZsaXBfZG9uZTsKKwl9CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkK
KwkJZm9ybWF0cyA9IGljbF9nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKKwkJCQkJ
CXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOworCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJCWZvcm1hdHMgPSBnbGtfZ2V0X3Bs
YW5lX2Zvcm1hdHMoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQlwbGFuZV9pZCwgJm51bV9mb3JtYXRz
KTsKKwllbHNlCisJCWZvcm1hdHMgPSBza2xfZ2V0X3BsYW5lX2Zvcm1hdHMoZGV2X3ByaXYsIHBp
cGUsCisJCQkJCQlwbGFuZV9pZCwgJm51bV9mb3JtYXRzKTsKKworCXBsYW5lLT5oYXNfY2NzID0g
c2tsX3BsYW5lX2hhc19jY3MoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKTsKKwlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMikgeworCQltb2RpZmllcnMgPSBnZW4xMl9nZXRfcGxhbmVfbW9k
aWZpZXJzKGRldl9wcml2LCBwbGFuZV9pZCk7CisJCXBsYW5lX2Z1bmNzID0gJmdlbjEyX3BsYW5l
X2Z1bmNzOworCX0gZWxzZSB7CisJCWlmIChwbGFuZS0+aGFzX2NjcykKKwkJCW1vZGlmaWVycyA9
IHNrbF9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2NjczsKKwkJZWxzZQorCQkJbW9kaWZpZXJzID0g
c2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbm9jY3M7CisJCXBsYW5lX2Z1bmNzID0gJnNrbF9w
bGFuZV9mdW5jczsKKwl9CisKKwlpZiAocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSkKKwkJcGxh
bmVfdHlwZSA9IERSTV9QTEFORV9UWVBFX1BSSU1BUlk7CisJZWxzZQorCQlwbGFuZV90eXBlID0g
RFJNX1BMQU5FX1RZUEVfT1ZFUkxBWTsKKworCXJldCA9IGRybV91bml2ZXJzYWxfcGxhbmVfaW5p
dCgmZGV2X3ByaXYtPmRybSwgJnBsYW5lLT5iYXNlLAorCQkJCSAgICAgICAwLCBwbGFuZV9mdW5j
cywKKwkJCQkgICAgICAgZm9ybWF0cywgbnVtX2Zvcm1hdHMsIG1vZGlmaWVycywKKwkJCQkgICAg
ICAgcGxhbmVfdHlwZSwKKwkJCQkgICAgICAgInBsYW5lICVkJWMiLCBwbGFuZV9pZCArIDEsCisJ
CQkJICAgICAgIHBpcGVfbmFtZShwaXBlKSk7CisJaWYgKHJldCkKKwkJZ290byBmYWlsOworCisJ
c3VwcG9ydGVkX3JvdGF0aW9ucyA9CisJCURSTV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVfUk9U
QVRFXzkwIHwKKwkJRFJNX01PREVfUk9UQVRFXzE4MCB8IERSTV9NT0RFX1JPVEFURV8yNzA7CisK
KwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKKwkJc3VwcG9ydGVkX3JvdGF0aW9ucyB8
PSBEUk1fTU9ERV9SRUZMRUNUX1g7CisKKwlkcm1fcGxhbmVfY3JlYXRlX3JvdGF0aW9uX3Byb3Bl
cnR5KCZwbGFuZS0+YmFzZSwKKwkJCQkJICAgRFJNX01PREVfUk9UQVRFXzAsCisJCQkJCSAgIHN1
cHBvcnRlZF9yb3RhdGlvbnMpOworCisJc3VwcG9ydGVkX2NzYyA9IEJJVChEUk1fQ09MT1JfWUNC
Q1JfQlQ2MDEpIHwgQklUKERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSk7CisKKwlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJc3VwcG9ydGVk
X2NzYyB8PSBCSVQoRFJNX0NPTE9SX1lDQkNSX0JUMjAyMCk7CisKKwlkcm1fcGxhbmVfY3JlYXRl
X2NvbG9yX3Byb3BlcnRpZXMoJnBsYW5lLT5iYXNlLAorCQkJCQkgIHN1cHBvcnRlZF9jc2MsCisJ
CQkJCSAgQklUKERSTV9DT0xPUl9ZQ0JDUl9MSU1JVEVEX1JBTkdFKSB8CisJCQkJCSAgQklUKERS
TV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKSwKKwkJCQkJICBEUk1fQ09MT1JfWUNCQ1JfQlQ3MDks
CisJCQkJCSAgRFJNX0NPTE9SX1lDQkNSX0xJTUlURURfUkFOR0UpOworCisJZHJtX3BsYW5lX2Ny
ZWF0ZV9hbHBoYV9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UpOworCWRybV9wbGFuZV9jcmVhdGVfYmxl
bmRfbW9kZV9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UsCisJCQkJCSAgICAgQklUKERSTV9NT0RFX0JM
RU5EX1BJWEVMX05PTkUpIHwKKwkJCQkJICAgICBCSVQoRFJNX01PREVfQkxFTkRfUFJFTVVMVEkp
IHwKKwkJCQkJICAgICBCSVQoRFJNX01PREVfQkxFTkRfQ09WRVJBR0UpKTsKKworCWRybV9wbGFu
ZV9jcmVhdGVfenBvc19pbW11dGFibGVfcHJvcGVydHkoJnBsYW5lLT5iYXNlLCBwbGFuZV9pZCk7
CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJZHJtX3BsYW5lX2VuYWJsZV9m
Yl9kYW1hZ2VfY2xpcHMoJnBsYW5lLT5iYXNlKTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDEwKQorCQlkcm1fcGxhbmVfY3JlYXRlX3NjYWxpbmdfZmlsdGVyX3Byb3BlcnR5KCZwbGFu
ZS0+YmFzZSwKKwkJCQkJCUJJVChEUk1fU0NBTElOR19GSUxURVJfREVGQVVMVCkgfAorCQkJCQkJ
QklUKERSTV9TQ0FMSU5HX0ZJTFRFUl9ORUFSRVNUX05FSUdIQk9SKSk7CisKKwlkcm1fcGxhbmVf
aGVscGVyX2FkZCgmcGxhbmUtPmJhc2UsICZpbnRlbF9wbGFuZV9oZWxwZXJfZnVuY3MpOworCisJ
cmV0dXJuIHBsYW5lOworCitmYWlsOgorCWludGVsX3BsYW5lX2ZyZWUocGxhbmUpOworCisJcmV0
dXJuIEVSUl9QVFIocmV0KTsKK30KKwordm9pZAorc2tsX2dldF9pbml0aWFsX3BsYW5lX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgICAgc3RydWN0IGludGVsX2luaXRpYWxf
cGxhbmVfY29uZmlnICpwbGFuZV9jb25maWcpCit7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOworCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFyeSk7CisJZW51bSBwbGFuZV9p
ZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKwllbnVtIHBpcGUgcGlwZTsKKwl1MzIgdmFsLCBiYXNl
LCBvZmZzZXQsIHN0cmlkZV9tdWx0LCB0aWxpbmcsIGFscGhhOworCWludCBmb3VyY2MsIHBpeGVs
X2Zvcm1hdDsKKwl1bnNpZ25lZCBpbnQgYWxpZ25lZF9oZWlnaHQ7CisJc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmI7CisJc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYjsKKworCWlm
ICghcGxhbmUtPmdldF9od19zdGF0ZShwbGFuZSwgJnBpcGUpKQorCQlyZXR1cm47CisKKwlkcm1f
V0FSTl9PTihkZXYsIHBpcGUgIT0gY3J0Yy0+cGlwZSk7CisKKwlpZiAoY3J0Y19zdGF0ZS0+Ymln
am9pbmVyKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJVbnN1cHBv
cnRlZCBiaWdqb2luZXIgY29uZmlndXJhdGlvbiBmb3IgaW5pdGlhbCBGQlxuIik7CisJCXJldHVy
bjsKKwl9CisKKwlpbnRlbF9mYiA9IGt6YWxsb2Moc2l6ZW9mKCppbnRlbF9mYiksIEdGUF9LRVJO
RUwpOworCWlmICghaW50ZWxfZmIpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJm
YWlsZWQgdG8gYWxsb2MgZmJcbiIpOworCQlyZXR1cm47CisJfQorCisJZmIgPSAmaW50ZWxfZmIt
PmJhc2U7CisKKwlmYi0+ZGV2ID0gZGV2OworCisJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJp
diwgUExBTkVfQ1RMKHBpcGUsIHBsYW5lX2lkKSk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSAxMSkKKwkJcGl4ZWxfZm9ybWF0ID0gdmFsICYgSUNMX1BMQU5FX0NUTF9GT1JNQVRfTUFT
SzsKKwllbHNlCisJCXBpeGVsX2Zvcm1hdCA9IHZhbCAmIFBMQU5FX0NUTF9GT1JNQVRfTUFTSzsK
KworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3By
aXYpKSB7CisJCWFscGhhID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKKwkJCQkgICAgICBQTEFO
RV9DT0xPUl9DVEwocGlwZSwgcGxhbmVfaWQpKTsKKwkJYWxwaGEgJj0gUExBTkVfQ09MT1JfQUxQ
SEFfTUFTSzsKKwl9IGVsc2UgeworCQlhbHBoYSA9IHZhbCAmIFBMQU5FX0NUTF9BTFBIQV9NQVNL
OworCX0KKworCWZvdXJjYyA9IHNrbF9mb3JtYXRfdG9fZm91cmNjKHBpeGVsX2Zvcm1hdCwKKwkJ
CQkgICAgICB2YWwgJiBQTEFORV9DVExfT1JERVJfUkdCWCwgYWxwaGEpOworCWZiLT5mb3JtYXQg
PSBkcm1fZm9ybWF0X2luZm8oZm91cmNjKTsKKworCXRpbGluZyA9IHZhbCAmIFBMQU5FX0NUTF9U
SUxFRF9NQVNLOworCXN3aXRjaCAodGlsaW5nKSB7CisJY2FzZSBQTEFORV9DVExfVElMRURfTElO
RUFSOgorCQlmYi0+bW9kaWZpZXIgPSBEUk1fRk9STUFUX01PRF9MSU5FQVI7CisJCWJyZWFrOwor
CWNhc2UgUExBTkVfQ1RMX1RJTEVEX1g6CisJCXBsYW5lX2NvbmZpZy0+dGlsaW5nID0gSTkxNV9U
SUxJTkdfWDsKKwkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ7CisJCWJy
ZWFrOworCWNhc2UgUExBTkVfQ1RMX1RJTEVEX1k6CisJCXBsYW5lX2NvbmZpZy0+dGlsaW5nID0g
STkxNV9USUxJTkdfWTsKKwkJaWYgKHZhbCAmIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lP
Tl9FTkFCTEUpCisJCQlmYi0+bW9kaWZpZXIgPSBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyID8K
KwkJCQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgOgorCQkJCUk5MTVfRk9S
TUFUX01PRF9ZX1RJTEVEX0NDUzsKKwkJZWxzZSBpZiAodmFsICYgUExBTkVfQ1RMX01FRElBX0RF
Q09NUFJFU1NJT05fRU5BQkxFKQorCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lf
VElMRURfR0VOMTJfTUNfQ0NTOworCQllbHNlCisJCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRDsKKwkJYnJlYWs7CisJY2FzZSBQTEFORV9DVExfVElMRURfWUY6CisJCWlm
ICh2YWwgJiBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFKQorCQkJZmItPm1v
ZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzsKKwkJZWxzZQorCQkJZmItPm1v
ZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOworCQlicmVhazsKKwlkZWZhdWx0Ogor
CQlNSVNTSU5HX0NBU0UodGlsaW5nKTsKKwkJZ290byBlcnJvcjsKKwl9CisKKwkvKgorCSAqIERS
TV9NT0RFX1JPVEFURV8gaXMgY291bnRlciBjbG9ja3dpc2UgdG8gc3RheSBjb21wYXRpYmxlIHdp
dGggWHJhbmRyCisJICogd2hpbGUgaTkxNSBIVyByb3RhdGlvbiBpcyBjbG9ja3dpc2UsIHRoYXRz
IHdoeSB0aGlzIHN3YXBwaW5nLgorCSAqLworCXN3aXRjaCAodmFsICYgUExBTkVfQ1RMX1JPVEFU
RV9NQVNLKSB7CisJY2FzZSBQTEFORV9DVExfUk9UQVRFXzA6CisJCXBsYW5lX2NvbmZpZy0+cm90
YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMDsKKwkJYnJlYWs7CisJY2FzZSBQTEFORV9DVExfUk9U
QVRFXzkwOgorCQlwbGFuZV9jb25maWctPnJvdGF0aW9uID0gRFJNX01PREVfUk9UQVRFXzI3MDsK
KwkJYnJlYWs7CisJY2FzZSBQTEFORV9DVExfUk9UQVRFXzE4MDoKKwkJcGxhbmVfY29uZmlnLT5y
b3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV8xODA7CisJCWJyZWFrOworCWNhc2UgUExBTkVfQ1RM
X1JPVEFURV8yNzA6CisJCXBsYW5lX2NvbmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVf
OTA7CisJCWJyZWFrOworCX0KKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwICYmCisJ
ICAgIHZhbCAmIFBMQU5FX0NUTF9GTElQX0hPUklaT05UQUwpCisJCXBsYW5lX2NvbmZpZy0+cm90
YXRpb24gfD0gRFJNX01PREVfUkVGTEVDVF9YOworCisJLyogOTAvMjcwIGRlZ3JlZSByb3RhdGlv
biB3b3VsZCByZXF1aXJlIGV4dHJhIHdvcmsgKi8KKwlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3
MChwbGFuZV9jb25maWctPnJvdGF0aW9uKSkKKwkJZ290byBlcnJvcjsKKworCWJhc2UgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSkgJiAweGZmZmZm
MDAwOworCXBsYW5lX2NvbmZpZy0+YmFzZSA9IGJhc2U7CisKKwlvZmZzZXQgPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCBQTEFORV9PRkZTRVQocGlwZSwgcGxhbmVfaWQpKTsKKworCXZhbCA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX1NJWkUocGlwZSwgcGxhbmVfaWQpKTsKKwlmYi0+
aGVpZ2h0ID0gKCh2YWwgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJZmItPndpZHRoID0gKCh2YWwg
Pj4gMCkgJiAweGZmZmYpICsgMTsKKworCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBM
QU5FX1NUUklERShwaXBlLCBwbGFuZV9pZCkpOworCXN0cmlkZV9tdWx0ID0gc2tsX3BsYW5lX3N0
cmlkZV9tdWx0KGZiLCAwLCBEUk1fTU9ERV9ST1RBVEVfMCk7CisJZmItPnBpdGNoZXNbMF0gPSAo
dmFsICYgMHgzZmYpICogc3RyaWRlX211bHQ7CisKKwlhbGlnbmVkX2hlaWdodCA9IGludGVsX2Zi
X2FsaWduX2hlaWdodChmYiwgMCwgZmItPmhlaWdodCk7CisKKwlwbGFuZV9jb25maWctPnNpemUg
PSBmYi0+cGl0Y2hlc1swXSAqIGFsaWduZWRfaGVpZ2h0OworCisJZHJtX2RiZ19rbXMoJmRldl9w
cml2LT5kcm0sCisJCSAgICAiJXMvJXMgd2l0aCBmYjogc2l6ZT0lZHglZEAlZCwgb2Zmc2V0PSV4
LCBwaXRjaCAlZCwgc2l6ZSAweCV4XG4iLAorCQkgICAgY3J0Yy0+YmFzZS5uYW1lLCBwbGFuZS0+
YmFzZS5uYW1lLCBmYi0+d2lkdGgsIGZiLT5oZWlnaHQsCisJCSAgICBmYi0+Zm9ybWF0LT5jcHBb
MF0gKiA4LCBiYXNlLCBmYi0+cGl0Y2hlc1swXSwKKwkJICAgIHBsYW5lX2NvbmZpZy0+c2l6ZSk7
CisKKwlwbGFuZV9jb25maWctPmZiID0gaW50ZWxfZmI7CisJcmV0dXJuOworCitlcnJvcjoKKwlr
ZnJlZShpbnRlbF9mYik7Cit9CisKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9za2xfdW5pdmVyc2FsX3BsYW5lLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi43MGViNTAxMGNkMjgKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuaApAQCAtMCwwICsxLDMzIEBACisvKiBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjAg
SW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIF9TS0xfVU5JVkVSU0FMX1BMQU5FX0hf
CisjZGVmaW5lIF9TS0xfVU5JVkVSU0FMX1BMQU5FX0hfCisKKyNpbmNsdWRlIDxsaW51eC90eXBl
cy5oPgorCitzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyOworc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7
CitzdHJ1Y3QgaW50ZWxfY3J0YzsKK3N0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZzsK
K3N0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZTsKKworZW51bSBwaXBlOworZW51bSBwbGFuZV9pZDsK
Kworc3RydWN0IGludGVsX3BsYW5lICoKK3NrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgIGVudW0gcGlwZSBwaXBlLCBlbnVt
IHBsYW5lX2lkIHBsYW5lX2lkKTsKKwordm9pZCBza2xfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmln
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkJCSAgc3RydWN0IGludGVsX2luaXRpYWxfcGxh
bmVfY29uZmlnICpwbGFuZV9jb25maWcpOworCitpbnQgc2tsX2Zvcm1hdF90b19mb3VyY2MoaW50
IGZvcm1hdCwgYm9vbCByZ2Jfb3JkZXIsIGJvb2wgYWxwaGEpOworCitpbnQgc2tsX2Njc190b19t
YWluX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY2NzX3BsYW5l
KTsKK2ludCBza2xfY2FsY19tYWluX3N1cmZhY2Vfb2Zmc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCQkJIGludCAqeCwgaW50ICp5LCB1MzIgKm9mZnNl
dCk7CisKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0u
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggYzU4ZTUwNzc1OTBkLi44
YzQyZmE1MWMwZjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtMzgsNiArMzgsNyBAQAog
I2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIgogI2luY2x1ZGUgImRpc3Bs
YXkvaW50ZWxfZmJjLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9zcHJpdGUuaCIKKyNpbmNs
dWRlICJkaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogI2luY2x1ZGUgImd0L2ludGVs
X2xsYy5oIgogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeAo=

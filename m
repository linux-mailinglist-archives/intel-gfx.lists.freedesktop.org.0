Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 62A6AB8F20
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 13:42:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7807F6FC98;
	Fri, 20 Sep 2019 11:42:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A638F6E82C
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 11:42:40 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 13:42:13 +0200
Message-Id: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 01/23] drm/i915/dp: Fix dsc bpp calculations, v2.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: stable@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlcmUgd2FzIGEgaW50ZWdlciB3cmFwYXJvdW5kIHdoZW4gbW9kZV9jbG9jayBiZWNhbWUgdG9v
IGhpZ2gsCmFuZCB3ZSBkaWRuJ3QgY29ycmVjdCBmb3IgdGhlIEZFQyBvdmVyaGVhZCBmYWN0b3Ig
d2hlbiBkaXZpZGluZywKd2l0aCB0aGUgY2FsY3VsYXRpb25zIGJyZWFraW5nIGF0IEhCUjMuCgpB
cyBhIHJlc3VsdCBvdXIgY2FsY3VsYXRlZCBicHAgd2FzIHdheSB0b28gaGlnaCwgYW5kIHRoZSBs
aW5rIHdpZHRoCmxpbWl0YXRpb24gbmV2ZXIgY2FtZSBpbnRvIGVmZmVjdC4KClByaW50IG91dCB0
aGUgcmVzdWx0aW5nIGJwcCBjYWxjdWx1bGF0aW9ucyBhcyBhIHNhbml0eSBjaGVjaywganVzdApp
biBjYXNlIHdlIGV2ZXIgaGF2ZSB0byBkZWJ1ZyBpdCBsYXRlciBvbiBhZ2Fpbi4KCldlIGFsc28g
dXNlZCB0aGUgd3JvbmcgZmFjdG9yIGZvciBGRUMuIFdoaWxlIGJzcGVjIG1lbnRpb25zIDIuNCUs
CmFsbCB0aGUgY2FsY3VsYXRpb25zIHVzZSAxLzAuOTcyMjYxLCBhbmQgdGhlIHNhbWUgcmF0aW8g
c2hvdWxkIGJlCmFwcGxpZWQgdG8gZGF0YSBNL04gYXMgd2VsbCwgc28gdXNlIGl0IHRoZXJlIHdo
ZW4gRkVDIGlzIGVuYWJsZWQuCgpNYWtlIHN1cmUgd2UgZG9uJ3QgYnJlYWsgaHcgcmVhZG91dCwg
YW5kIHJlYWQgb3V0IEZFQyBlbmFibGUgc3RhdGUKYW5kIGNvcnJlY3QgdGhlIERESSBjbG9jayBy
ZWFkb3V0IGZvciB0aGUgbmV3IHZhbHVlcy4KClRvZ2V0aGVyIHdpdGggdGhlIG5leHQgY29tbWl0
LCB0aGlzIGNhdXNlcyBGRUMgdG8gd29yayBjb3JyZWN0bHkKd2l0aCBiaWcgam9pbmVyLCB3aGls
ZSBhbHNvIGhhdmluZyB0aGUgY29ycmVjdCByZWZyZXNoIHJhdGUKcmVwb3J0ZWQgaW4ga21zX3Nl
dG1vZGUuYmFzaWMuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5s
YW5raG9yc3RAbGludXguaW50ZWwuY29tPgpGaXhlczogZDkyMThjOGY2Y2Y0ICgiZHJtL2k5MTUv
ZHA6IEFkZCBoZWxwZXJzIGZvciBDb21wcmVzc2VkIEJQUCBhbmQgU2xpY2UgQ291bnQgZm9yIERT
QyIpCkNjOiA8c3RhYmxlQHZnZXIua2VybmVsLm9yZz4gIyB2NS4wKwpDYzogTWFuYXNpIE5hdmFy
ZSA8bWFuYXNpLmQubmF2YXJlQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RkaS5jICAgICB8ICAxOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kcC5jICAgICAgfCAxOTUgKysrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5oICAgICAgfCAgIDYgKy0KIDQgZmlsZXMgY2hhbmdl
ZCwgMTI4IGluc2VydGlvbnMoKyksIDkzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDNlNjM5NDEzOTk2NC4uMWI1OWI4NTI4NzRiIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTE0NzksNiArMTQ3
OSwxMCBAQCBzdGF0aWMgdm9pZCBkZGlfZG90Y2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpwaXBlX2NvbmZpZykKIAlpZiAocGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIpCiAJ
CWRvdGNsb2NrIC89IHBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyOwogCisJLyogZmVjIGFk
ZHMgb3ZlcmhlYWQgdG8gdGhlIGRhdGEgTS9OIHZhbHVlcywgY29ycmVjdCBmb3IgaXQgKi8KKwlp
ZiAocGlwZV9jb25maWctPmZlY19lbmFibGUpCisJCWRvdGNsb2NrID0gaW50ZWxfZHBfZmVjX3Rv
X21vZGVfY2xvY2soZG90Y2xvY2spOworCiAJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9k
ZS5jcnRjX2Nsb2NrID0gZG90Y2xvY2s7CiB9CiAKQEAgLTQwMzEsNyArNDAzNSw5IEBAIHZvaWQg
aW50ZWxfZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJY2Fz
ZSBUUkFOU19ERElfTU9ERV9TRUxFQ1RfRkRJOgogCQlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVz
IHw9IEJJVChJTlRFTF9PVVRQVVRfQU5BTE9HKTsKIAkJYnJlYWs7Ci0JY2FzZSBUUkFOU19ERElf
TU9ERV9TRUxFQ1RfRFBfU1NUOgorCWNhc2UgVFJBTlNfRERJX01PREVfU0VMRUNUX0RQX1NTVDog
eworCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVy
LT5iYXNlKTsKKwogCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKQogCQkJ
cGlwZV9jb25maWctPm91dHB1dF90eXBlcyB8PSBCSVQoSU5URUxfT1VUUFVUX0VEUCk7CiAJCWVs
c2UKQEAgLTQwMzksNyArNDA0NSwxOCBAQCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCA9CiAJ
CQkoKHRlbXAgJiBERElfUE9SVF9XSURUSF9NQVNLKSA+PiBERElfUE9SVF9XSURUSF9TSElGVCkg
KyAxOwogCQlpbnRlbF9kcF9nZXRfbV9uKGludGVsX2NydGMsIHBpcGVfY29uZmlnKTsKKworCQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgeworCQkJcGlwZV9jb25maWctPmZlY19lbmFi
bGUgPQorCQkJCUk5MTVfUkVBRChpbnRlbF9kcC0+cmVncy5kcF90cF9jdGwpICYKKwkJCQkJICBE
UF9UUF9DVExfRkVDX0VOQUJMRTsKKwkJCURSTV9ERUJVR19LTVMoIltFTkNPREVSOiVkOiVzXSBG
ZWMgc3RhdHVzOiAldVxuIiwKKwkJCQkgICAgICBlbmNvZGVyLT5iYXNlLmJhc2UuaWQsIGVuY29k
ZXItPmJhc2UubmFtZSwKKwkJCQkgICAgICBwaXBlX2NvbmZpZy0+ZmVjX2VuYWJsZSk7CisJCX0K
KwogCQlicmVhazsKKwl9CiAJY2FzZSBUUkFOU19ERElfTU9ERV9TRUxFQ1RfRFBfTVNUOgogCQlw
aXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzIHw9IEJJVChJTlRFTF9PVVRQVVRfRFBfTVNUKTsKIAkJ
cGlwZV9jb25maWctPmxhbmVfY291bnQgPQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwppbmRleCBlMDAzM2Q5OWY2ZTMuLjc5OTY4NjRlNmY3YyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTEyNzczLDYg
KzEyNzczLDcgQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3VycmVudF9jb25maWcsCiAJUElQRV9DT05GX0NIRUNLX0JPT0woaGRtaV9z
Y3JhbWJsaW5nKTsKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChoZG1pX2hpZ2hfdG1kc19jbG9ja19y
YXRpbyk7CiAJUElQRV9DT05GX0NIRUNLX0JPT0woaGFzX2luZm9mcmFtZSk7CisJUElQRV9DT05G
X0NIRUNLX0JPT0woZmVjX2VuYWJsZSk7CiAKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTF9JTkNPTVBM
RVRFKGhhc19hdWRpbyk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpp
bmRleCBjY2FmOWYwMGI3NDcuLjRkZmI3OGRjN2ZhMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHAuYwpAQCAtNzYsOCArNzYsOCBAQAogI2RlZmluZSBEUF9EU0NfTUFYX0VO
Q19USFJPVUdIUFVUXzAJCTM0MDAwMAogI2RlZmluZSBEUF9EU0NfTUFYX0VOQ19USFJPVUdIUFVU
XzEJCTQwMDAwMAogCi0vKiBEUCBEU0MgRkVDIE92ZXJoZWFkIGZhY3RvciA9ICgxMDAgLSAyLjQp
LzEwMCAqLwotI2RlZmluZSBEUF9EU0NfRkVDX09WRVJIRUFEX0ZBQ1RPUgkJOTc2CisvKiBEUCBE
U0MgRkVDIE92ZXJoZWFkIGZhY3RvciA9IDEvKDAuOTcyMjYxKSAqLworI2RlZmluZSBEUF9EU0Nf
RkVDX09WRVJIRUFEX0ZBQ1RPUgkJOTcyMjYxCiAKIC8qIENvbXBsaWFuY2UgdGVzdCBzdGF0dXMg
Yml0cyAgKi8KICNkZWZpbmUgSU5URUxfRFBfUkVTT0xVVElPTl9TSElGVF9NQVNLCTAKQEAgLTQ5
Miw2ICs0OTIsMTA0IEBAIGludCBpbnRlbF9kcF9nZXRfbGlua190cmFpbl9mYWxsYmFja192YWx1
ZXMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIGlu
bGluZSB1MzIgaW50ZWxfZHBfbW9kZV90b19mZWNfY2xvY2sodTMyIG1vZGVfY2xvY2spCit7CisJ
cmV0dXJuIGRpdl91NjQobXVsX3UzMl91MzIobW9kZV9jbG9jaywgMTAwMDAwMFUpLAorCQkgICAg
ICAgRFBfRFNDX0ZFQ19PVkVSSEVBRF9GQUNUT1IpOworfQorCit1MzIgaW50ZWxfZHBfZmVjX3Rv
X21vZGVfY2xvY2sodTMyIGZlY19jbG9jaykKK3sKKwlyZXR1cm4gZGl2X3U2NChtdWxfdTMyX3Uz
MihmZWNfY2xvY2ssCisJCQkJICAgRFBfRFNDX0ZFQ19PVkVSSEVBRF9GQUNUT1IpLAorCQkgICAg
ICAgMTAwMDAwMFUpOworfQorCitzdGF0aWMgdTE2IGludGVsX2RwX2RzY19nZXRfb3V0cHV0X2Jw
cCh1MzIgbGlua19jbG9jaywgdTMyIGxhbmVfY291bnQsCisJCQkJICAgICAgIHUzMiBtb2RlX2Ns
b2NrLCB1MzIgbW9kZV9oZGlzcGxheSkKK3sKKwl1MzIgYml0c19wZXJfcGl4ZWwsIG1heF9icHBf
c21hbGxfam9pbmVyX3JhbTsKKwlpbnQgaTsKKworCS8qCisJICogQXZhaWxhYmxlIExpbmsgQmFu
ZHdpZHRoKEtiaXRzL3NlYykgPSAoTnVtYmVyT2ZMYW5lcykqCisJICogKExpbmtTeW1ib2xDbG9j
aykqIDggKiAoVGltZVNsb3RzUGVyTVRQKQorCSAqIGZvciBTU1QgLT4gVGltZVNsb3RzUGVyTVRQ
IGlzIDEsCisJICogZm9yIE1TVCAtPiBUaW1lU2xvdHNQZXJNVFAgaGFzIHRvIGJlIGNhbGN1bGF0
ZWQKKwkgKi8KKwliaXRzX3Blcl9waXhlbCA9IChsaW5rX2Nsb2NrICogbGFuZV9jb3VudCAqIDgp
IC8KKwkJCSBpbnRlbF9kcF9tb2RlX3RvX2ZlY19jbG9jayhtb2RlX2Nsb2NrKTsKKwlEUk1fREVC
VUdfS01TKCJNYXggbGluayBicHA6ICV1XG4iLCBiaXRzX3Blcl9waXhlbCk7CisKKwkvKiBTbWFs
bCBKb2luZXIgQ2hlY2s6IG91dHB1dCBicHAgPD0gam9pbmVyIFJBTSAoYml0cykgLyBIb3Jpei4g
d2lkdGggKi8KKwltYXhfYnBwX3NtYWxsX2pvaW5lcl9yYW0gPSBEUF9EU0NfTUFYX1NNQUxMX0pP
SU5FUl9SQU1fQlVGRkVSIC8gbW9kZV9oZGlzcGxheTsKKwlEUk1fREVCVUdfS01TKCJNYXggc21h
bGwgam9pbmVyIGJwcDogJXVcbiIsIG1heF9icHBfc21hbGxfam9pbmVyX3JhbSk7CisKKwkvKgor
CSAqIEdyZWF0ZXN0IGFsbG93ZWQgRFNDIEJQUCA9IE1JTiAob3V0cHV0IEJQUCBmcm9tIGF2YWls
YWJsZSBMaW5rIEJXCisJICogY2hlY2ssIG91dHB1dCBicHAgZnJvbSBzbWFsbCBqb2luZXIgUkFN
IGNoZWNrKQorCSAqLworCWJpdHNfcGVyX3BpeGVsID0gbWluKGJpdHNfcGVyX3BpeGVsLCBtYXhf
YnBwX3NtYWxsX2pvaW5lcl9yYW0pOworCisJLyogRXJyb3Igb3V0IGlmIHRoZSBtYXggYnBwIGlz
IGxlc3MgdGhhbiBzbWFsbGVzdCBhbGxvd2VkIHZhbGlkIGJwcCAqLworCWlmIChiaXRzX3Blcl9w
aXhlbCA8IHZhbGlkX2RzY19icHBbMF0pIHsKKwkJRFJNX0RFQlVHX0tNUygiVW5zdXBwb3J0ZWQg
QlBQICV1LCBtaW4gJXVcbiIsCisJCQkgICAgICBiaXRzX3Blcl9waXhlbCwgdmFsaWRfZHNjX2Jw
cFswXSk7CisJCXJldHVybiAwOworCX0KKworCS8qIEZpbmQgdGhlIG5lYXJlc3QgbWF0Y2ggaW4g
dGhlIGFycmF5IG9mIGtub3duIEJQUHMgZnJvbSBWRVNBICovCisJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUodmFsaWRfZHNjX2JwcCkgLSAxOyBpKyspIHsKKwkJaWYgKGJpdHNfcGVyX3BpeGVs
IDwgdmFsaWRfZHNjX2JwcFtpICsgMV0pCisJCQlicmVhazsKKwl9CisJYml0c19wZXJfcGl4ZWwg
PSB2YWxpZF9kc2NfYnBwW2ldOworCisJLyoKKwkgKiBDb21wcmVzc2VkIEJQUCBpbiBVNi40IGZv
cm1hdCBzbyBtdWx0aXBseSBieSAxNiwgZm9yIEdlbiAxMSwKKwkgKiBmcmFjdGlvbmFsIHBhcnQg
aXMgMAorCSAqLworCXJldHVybiBiaXRzX3Blcl9waXhlbCA8PCA0OworfQorCitzdGF0aWMgdTgg
aW50ZWxfZHBfZHNjX2dldF9zbGljZV9jb3VudChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAor
CQkJCSAgICAgICBpbnQgbW9kZV9jbG9jaywgaW50IG1vZGVfaGRpc3BsYXkpCit7CisJdTggbWlu
X3NsaWNlX2NvdW50LCBpOworCWludCBtYXhfc2xpY2Vfd2lkdGg7CisKKwlpZiAobW9kZV9jbG9j
ayA8PSBEUF9EU0NfUEVBS19QSVhFTF9SQVRFKQorCQltaW5fc2xpY2VfY291bnQgPSBESVZfUk9V
TkRfVVAobW9kZV9jbG9jaywKKwkJCQkJICAgICAgIERQX0RTQ19NQVhfRU5DX1RIUk9VR0hQVVRf
MCk7CisJZWxzZQorCQltaW5fc2xpY2VfY291bnQgPSBESVZfUk9VTkRfVVAobW9kZV9jbG9jaywK
KwkJCQkJICAgICAgIERQX0RTQ19NQVhfRU5DX1RIUk9VR0hQVVRfMSk7CisKKwltYXhfc2xpY2Vf
d2lkdGggPSBkcm1fZHBfZHNjX3NpbmtfbWF4X3NsaWNlX3dpZHRoKGludGVsX2RwLT5kc2NfZHBj
ZCk7CisJaWYgKG1heF9zbGljZV93aWR0aCA8IERQX0RTQ19NSU5fU0xJQ0VfV0lEVEhfVkFMVUUp
IHsKKwkJRFJNX0RFQlVHX0tNUygiVW5zdXBwb3J0ZWQgc2xpY2Ugd2lkdGggJWQgYnkgRFAgRFND
IFNpbmsgZGV2aWNlXG4iLAorCQkJICAgICAgbWF4X3NsaWNlX3dpZHRoKTsKKwkJcmV0dXJuIDA7
CisJfQorCS8qIEFsc28gdGFrZSBpbnRvIGFjY291bnQgbWF4IHNsaWNlIHdpZHRoICovCisJbWlu
X3NsaWNlX2NvdW50ID0gbWluX3QodTgsIG1pbl9zbGljZV9jb3VudCwKKwkJCQlESVZfUk9VTkRf
VVAobW9kZV9oZGlzcGxheSwKKwkJCQkJICAgICBtYXhfc2xpY2Vfd2lkdGgpKTsKKworCS8qIEZp
bmQgdGhlIGNsb3Nlc3QgbWF0Y2ggdG8gdGhlIHZhbGlkIHNsaWNlIGNvdW50IHZhbHVlcyAqLwor
CWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHZhbGlkX2RzY19zbGljZWNvdW50KTsgaSsrKSB7
CisJCWlmICh2YWxpZF9kc2Nfc2xpY2Vjb3VudFtpXSA+CisJCSAgICBkcm1fZHBfZHNjX3Npbmtf
bWF4X3NsaWNlX2NvdW50KGludGVsX2RwLT5kc2NfZHBjZCwKKwkJCQkJCSAgICBmYWxzZSkpCisJ
CQlicmVhazsKKwkJaWYgKG1pbl9zbGljZV9jb3VudCAgPD0gdmFsaWRfZHNjX3NsaWNlY291bnRb
aV0pCisJCQlyZXR1cm4gdmFsaWRfZHNjX3NsaWNlY291bnRbaV07CisJfQorCisJRFJNX0RFQlVH
X0tNUygiVW5zdXBwb3J0ZWQgU2xpY2UgQ291bnQgJWRcbiIsIG1pbl9zbGljZV9jb3VudCk7CisJ
cmV0dXJuIDA7Cit9CisKIHN0YXRpYyBlbnVtIGRybV9tb2RlX3N0YXR1cwogaW50ZWxfZHBfbW9k
ZV92YWxpZChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkgICAgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKm1vZGUpCkBAIC0yMTgyLDYgKzIyODAsNyBAQCBpbnRlbF9kcF9jb21w
dXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlib29sIGNvbnN0YW50
X24gPSBkcm1fZHBfaGFzX3F1aXJrKCZpbnRlbF9kcC0+ZGVzYywKIAkJCQkJICAgRFBfRFBDRF9R
VUlSS19DT05TVEFOVF9OKTsKIAlpbnQgcmV0ID0gMCwgb3V0cHV0X2JwcDsKKwl1MzIgZGF0YV9j
bG9jazsKIAogCWlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSAmJiAhSEFTX0RESShkZXZfcHJp
dikgJiYgcG9ydCAhPSBQT1JUX0EpCiAJCXBpcGVfY29uZmlnLT5oYXNfcGNoX2VuY29kZXIgPSB0
cnVlOwpAQCAtMjI0NCw5ICsyMzQzLDE0IEBAIGludGVsX2RwX2NvbXB1dGVfY29uZmlnKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWVsc2UKIAkJb3V0cHV0X2JwcCA9IGludGVsX2Rw
X291dHB1dF9icHAocGlwZV9jb25maWcsIHBpcGVfY29uZmlnLT5waXBlX2JwcCk7CiAKKwlpZiAo
cGlwZV9jb25maWctPmZlY19lbmFibGUpCisJCWRhdGFfY2xvY2sgPSBpbnRlbF9kcF9tb2RlX3Rv
X2ZlY19jbG9jayhhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrKTsKKwllbHNlCisJCWRhdGFfY2xv
Y2sgPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrOworCiAJaW50ZWxfbGlua19jb21wdXRlX21f
bihvdXRwdXRfYnBwLAogCQkJICAgICAgIHBpcGVfY29uZmlnLT5sYW5lX2NvdW50LAotCQkJICAg
ICAgIGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2ssCisJCQkgICAgICAgZGF0YV9jbG9jaywKIAkJ
CSAgICAgICBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jaywKIAkJCSAgICAgICAmcGlwZV9jb25maWct
PmRwX21fbiwKIAkJCSAgICAgICBjb25zdGFudF9uKTsKQEAgLTQzNjMsOTEgKzQ0NjcsNiBAQCBp
bnRlbF9kcF9nZXRfc2lua19pcnFfZXNpKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHU4ICpz
aW5rX2lycV92ZWN0b3IpCiAJCURQX0RQUlhfRVNJX0xFTjsKIH0KIAotdTE2IGludGVsX2RwX2Rz
Y19nZXRfb3V0cHV0X2JwcChpbnQgbGlua19jbG9jaywgdTggbGFuZV9jb3VudCwKLQkJCQlpbnQg
bW9kZV9jbG9jaywgaW50IG1vZGVfaGRpc3BsYXkpCi17Ci0JdTE2IGJpdHNfcGVyX3BpeGVsLCBt
YXhfYnBwX3NtYWxsX2pvaW5lcl9yYW07Ci0JaW50IGk7Ci0KLQkvKgotCSAqIEF2YWlsYWJsZSBM
aW5rIEJhbmR3aWR0aChLYml0cy9zZWMpID0gKE51bWJlck9mTGFuZXMpKgotCSAqIChMaW5rU3lt
Ym9sQ2xvY2spKiA4ICogKCgxMDAtRkVDT3ZlcmhlYWQpLzEwMCkqKFRpbWVTbG90c1Blck1UUCkK
LQkgKiBGRUNPdmVyaGVhZCA9IDIuNCUsIGZvciBTU1QgLT4gVGltZVNsb3RzUGVyTVRQIGlzIDEs
Ci0JICogZm9yIE1TVCAtPiBUaW1lU2xvdHNQZXJNVFAgaGFzIHRvIGJlIGNhbGN1bGF0ZWQKLQkg
Ki8KLQliaXRzX3Blcl9waXhlbCA9IChsaW5rX2Nsb2NrICogbGFuZV9jb3VudCAqIDggKgotCQkJ
ICBEUF9EU0NfRkVDX09WRVJIRUFEX0ZBQ1RPUikgLwotCQltb2RlX2Nsb2NrOwotCi0JLyogU21h
bGwgSm9pbmVyIENoZWNrOiBvdXRwdXQgYnBwIDw9IGpvaW5lciBSQU0gKGJpdHMpIC8gSG9yaXou
IHdpZHRoICovCi0JbWF4X2JwcF9zbWFsbF9qb2luZXJfcmFtID0gRFBfRFNDX01BWF9TTUFMTF9K
T0lORVJfUkFNX0JVRkZFUiAvCi0JCW1vZGVfaGRpc3BsYXk7Ci0KLQkvKgotCSAqIEdyZWF0ZXN0
IGFsbG93ZWQgRFNDIEJQUCA9IE1JTiAob3V0cHV0IEJQUCBmcm9tIGF2YWlhbGJsZSBMaW5rIEJX
Ci0JICogY2hlY2ssIG91dHB1dCBicHAgZnJvbSBzbWFsbCBqb2luZXIgUkFNIGNoZWNrKQotCSAq
LwotCWJpdHNfcGVyX3BpeGVsID0gbWluKGJpdHNfcGVyX3BpeGVsLCBtYXhfYnBwX3NtYWxsX2pv
aW5lcl9yYW0pOwotCi0JLyogRXJyb3Igb3V0IGlmIHRoZSBtYXggYnBwIGlzIGxlc3MgdGhhbiBz
bWFsbGVzdCBhbGxvd2VkIHZhbGlkIGJwcCAqLwotCWlmIChiaXRzX3Blcl9waXhlbCA8IHZhbGlk
X2RzY19icHBbMF0pIHsKLQkJRFJNX0RFQlVHX0tNUygiVW5zdXBwb3J0ZWQgQlBQICVkXG4iLCBi
aXRzX3Blcl9waXhlbCk7Ci0JCXJldHVybiAwOwotCX0KLQotCS8qIEZpbmQgdGhlIG5lYXJlc3Qg
bWF0Y2ggaW4gdGhlIGFycmF5IG9mIGtub3duIEJQUHMgZnJvbSBWRVNBICovCi0JZm9yIChpID0g
MDsgaSA8IEFSUkFZX1NJWkUodmFsaWRfZHNjX2JwcCkgLSAxOyBpKyspIHsKLQkJaWYgKGJpdHNf
cGVyX3BpeGVsIDwgdmFsaWRfZHNjX2JwcFtpICsgMV0pCi0JCQlicmVhazsKLQl9Ci0JYml0c19w
ZXJfcGl4ZWwgPSB2YWxpZF9kc2NfYnBwW2ldOwotCi0JLyoKLQkgKiBDb21wcmVzc2VkIEJQUCBp
biBVNi40IGZvcm1hdCBzbyBtdWx0aXBseSBieSAxNiwgZm9yIEdlbiAxMSwKLQkgKiBmcmFjdGlv
bmFsIHBhcnQgaXMgMAotCSAqLwotCXJldHVybiBiaXRzX3Blcl9waXhlbCA8PCA0OwotfQotCi11
OCBpbnRlbF9kcF9kc2NfZ2V0X3NsaWNlX2NvdW50KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAs
Ci0JCQkJaW50IG1vZGVfY2xvY2ssCi0JCQkJaW50IG1vZGVfaGRpc3BsYXkpCi17Ci0JdTggbWlu
X3NsaWNlX2NvdW50LCBpOwotCWludCBtYXhfc2xpY2Vfd2lkdGg7Ci0KLQlpZiAobW9kZV9jbG9j
ayA8PSBEUF9EU0NfUEVBS19QSVhFTF9SQVRFKQotCQltaW5fc2xpY2VfY291bnQgPSBESVZfUk9V
TkRfVVAobW9kZV9jbG9jaywKLQkJCQkJICAgICAgIERQX0RTQ19NQVhfRU5DX1RIUk9VR0hQVVRf
MCk7Ci0JZWxzZQotCQltaW5fc2xpY2VfY291bnQgPSBESVZfUk9VTkRfVVAobW9kZV9jbG9jaywK
LQkJCQkJICAgICAgIERQX0RTQ19NQVhfRU5DX1RIUk9VR0hQVVRfMSk7Ci0KLQltYXhfc2xpY2Vf
d2lkdGggPSBkcm1fZHBfZHNjX3NpbmtfbWF4X3NsaWNlX3dpZHRoKGludGVsX2RwLT5kc2NfZHBj
ZCk7Ci0JaWYgKG1heF9zbGljZV93aWR0aCA8IERQX0RTQ19NSU5fU0xJQ0VfV0lEVEhfVkFMVUUp
IHsKLQkJRFJNX0RFQlVHX0tNUygiVW5zdXBwb3J0ZWQgc2xpY2Ugd2lkdGggJWQgYnkgRFAgRFND
IFNpbmsgZGV2aWNlXG4iLAotCQkJICAgICAgbWF4X3NsaWNlX3dpZHRoKTsKLQkJcmV0dXJuIDA7
Ci0JfQotCS8qIEFsc28gdGFrZSBpbnRvIGFjY291bnQgbWF4IHNsaWNlIHdpZHRoICovCi0JbWlu
X3NsaWNlX2NvdW50ID0gbWluX3QodTgsIG1pbl9zbGljZV9jb3VudCwKLQkJCQlESVZfUk9VTkRf
VVAobW9kZV9oZGlzcGxheSwKLQkJCQkJICAgICBtYXhfc2xpY2Vfd2lkdGgpKTsKLQotCS8qIEZp
bmQgdGhlIGNsb3Nlc3QgbWF0Y2ggdG8gdGhlIHZhbGlkIHNsaWNlIGNvdW50IHZhbHVlcyAqLwot
CWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHZhbGlkX2RzY19zbGljZWNvdW50KTsgaSsrKSB7
Ci0JCWlmICh2YWxpZF9kc2Nfc2xpY2Vjb3VudFtpXSA+Ci0JCSAgICBkcm1fZHBfZHNjX3Npbmtf
bWF4X3NsaWNlX2NvdW50KGludGVsX2RwLT5kc2NfZHBjZCwKLQkJCQkJCSAgICBmYWxzZSkpCi0J
CQlicmVhazsKLQkJaWYgKG1pbl9zbGljZV9jb3VudCAgPD0gdmFsaWRfZHNjX3NsaWNlY291bnRb
aV0pCi0JCQlyZXR1cm4gdmFsaWRfZHNjX3NsaWNlY291bnRbaV07Ci0JfQotCi0JRFJNX0RFQlVH
X0tNUygiVW5zdXBwb3J0ZWQgU2xpY2UgQ291bnQgJWRcbiIsIG1pbl9zbGljZV9jb3VudCk7Ci0J
cmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyB2b2lkCiBpbnRlbF9waXhlbF9lbmNvZGluZ19zZXR1cF92
c2Moc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZHAuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHAuaAppbmRleCBlMDFkMWY4OTQwOWQuLmU5ZjExZTY5ODY5NyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuaApAQCAtMTAzLDEwICsxMDMsNiBAQCBib29sIGludGVs
X2RwX3NvdXJjZV9zdXBwb3J0c19oYnIyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogYm9v
bCBpbnRlbF9kcF9zb3VyY2Vfc3VwcG9ydHNfaGJyMyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KTsKIGJvb2wKIGludGVsX2RwX2dldF9saW5rX3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLCB1OCAqbGlua19zdGF0dXMpOwotdTE2IGludGVsX2RwX2RzY19nZXRfb3V0cHV0X2JwcChp
bnQgbGlua19jbG9jaywgdTggbGFuZV9jb3VudCwKLQkJCQlpbnQgbW9kZV9jbG9jaywgaW50IG1v
ZGVfaGRpc3BsYXkpOwotdTggaW50ZWxfZHBfZHNjX2dldF9zbGljZV9jb3VudChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLCBpbnQgbW9kZV9jbG9jaywKLQkJCQlpbnQgbW9kZV9oZGlzcGxheSk7
CiAKIGJvb2wgaW50ZWxfZHBfcmVhZF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwog
Ym9vbCBpbnRlbF9kcF9nZXRfY29sb3JpbWV0cnlfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApOwpAQCAtMTE5LDQgKzExNSw2IEBAIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IGlu
dGVsX2RwX3VudXNlZF9sYW5lX21hc2soaW50IGxhbmVfY291bnQpCiAJcmV0dXJuIH4oKDEgPDwg
bGFuZV9jb3VudCkgLSAxKSAmIDB4ZjsKIH0KIAordTMyIGludGVsX2RwX2ZlY190b19tb2RlX2Ns
b2NrKHUzMiBmZWNfY2xvY2spOworCiAjZW5kaWYgLyogX19JTlRFTF9EUF9IX18gKi8KLS0gCjIu
MjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

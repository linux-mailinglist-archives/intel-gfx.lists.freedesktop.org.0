Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 52AC9E19E1
	for <lists+intel-gfx@lfdr.de>; Wed, 23 Oct 2019 14:22:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9FFC56EA6E;
	Wed, 23 Oct 2019 12:22:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 125FF6EA70
 for <intel-gfx@lists.freedesktop.org>; Wed, 23 Oct 2019 12:22:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18936915-1500050 
 for <intel-gfx@lists.freedesktop.org>; Wed, 23 Oct 2019 13:21:59 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 23 Oct 2019 13:21:48 +0100
Message-Id: <20191023122151.5017-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 1/4] drm/i915/gt: Try to more gracefully quiesce
 the system before resets
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgYXJlIGRvaW5nIGEgbm9ybWFsIEdQVSByZXNldCB0cmlnZ2VyZWQgYWZ0ZXIgZGV0ZWN0
aW5nIGEgbG9uZwpwZXJpb2Qgb2Ygc3RhbGxlZCB3b3JrLCB3ZSBjYW4gdGFrZSBvdXIgdGltZSBh
bmQgYWxsb3cgdGhlIGVuZ2luZXMgdG8KcXVpZXNjZS4gU2luY2Ugd2UndmUgc3RvcHBlZCBzdWJt
aXNzaW9uIHRvIHRoZSBlbmdpbmUsIGFuZCBpZiB3ZSB3YWl0CmxvbmcgZW5vdWdoIGFuIGlubm9j
ZW50IGNvbnRleHQgc2hvdWxkIGNvbXBsZXRlLCBsZWF2aW5nIHRoZSBlbmdpbmUgaWRsZS4KU28g
Ynkgd2FpdGluZyBhIHNob3J0IGFtb3VudCBvZiB0aW1lLCB3ZSBzaG91bGQgcHJldmVudCBjbG9i
YmVyaW5nIG90aGVyCnVzZXJzIHdoZW4gcmVzZXR0aW5nIGEgc3R1Y2sgY29udGV4dC4KClNpZ25l
ZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWlr
YSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBKb29uYXMgTGFo
dGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvS2NvbmZpZy5wcm9maWxlICAgICAgICAgfCAxMSArKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgfCAyMCArKysrKysrKysrKysr
KysrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggfCAg
NCArKysrCiAzIGZpbGVzIGNoYW5nZWQsIDM0IGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnLnByb2ZpbGUgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnLnByb2ZpbGUKaW5kZXggNDhkZjg4ODlhODhhLi45N2Yw
MWJmZWRhNDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L0tjb25maWcucHJvZmls
ZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnLnByb2ZpbGUKQEAgLTI1LDMgKzI1
LDE0IEBAIGNvbmZpZyBEUk1fSTkxNV9TUElOX1JFUVVFU1QKIAkgIE1heSBiZSAwIHRvIGRpc2Fi
bGUgdGhlIGluaXRpYWwgc3Bpbi4gSW4gcHJhY3RpY2UsIHdlIGVzdGltYXRlCiAJICB0aGUgY29z
dCBvZiBlbmFibGluZyB0aGUgaW50ZXJydXB0IChpZiBjdXJyZW50bHkgZGlzYWJsZWQpIHRvIGJl
CiAJICBhIGZldyBtaWNyb3NlY29uZHMuCisKK2NvbmZpZyBEUk1fSTkxNV9TVE9QX1RJTUVPVVQK
KwlpbnQgIkhvdyBsb25nIHRvIHdhaXQgZm9yIGFuIGVuZ2luZSB0byBxdWllc2NlIGdyYWNlZnVs
bHkgYmVmb3JlIHJlc2V0IChtcykiCisJZGVmYXVsdCAxMDAgIyBtaWxsaXNlY29uZHMKKwloZWxw
CisJICBCeSBzdG9wcGluZyBzdWJtaXNzaW9uIGFuZCBzbGVlcGluZyBmb3IgYSBzaG9ydCB0aW1l
IGJlZm9yZSByZXNldHRpbmcKKwkgIHRoZSBHUFUsIHdlIGFsbG93IHRoZSBpbm5vY2VudCBjb250
ZXh0cyBhbHNvIG9uIHRoZSBzeXN0ZW0gdG8gcXVpZXNjZS4KKwkgIEl0IGlzIHRoZW4gbGVzcyBs
aWtlbHkgZm9yIGEgaGFuZ2luZyBjb250ZXh0IHRvIGNhdXNlIGNvbGxhdGVyYWwKKwkgIGRhbWFn
ZSBhcyB0aGUgc3lzdGVtIGlzIHJlc2V0IGluIG9yZGVyIHRvIHJlY292ZXIuIFRoZSBjb2xvcmFy
eSBpcworCSAgdGhhdCB0aGUgcmVzZXQgaXRzZWxmIG1heSB0YWtlIGxvbmdlciBhbmQgc28gYmUg
bW9yZSBkaXNydXB0aXZlIHRvCisJICBpbnRlcmFjdGl2ZSBvciBsb3cgbGF0ZW5jeSB3b3JrbG9h
ZHMuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3Mu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IDBlMjA3
MTM2MDNlYy4uNDk5Yjc3NWY3MjMxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfY3MuYwpAQCAtMzA4LDYgKzMwOCw5IEBAIHN0YXRpYyBpbnQgaW50ZWxfZW5naW5lX3Nl
dHVwKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGVudW0gaW50ZWxfZW5naW5lX2lkIGlkKQogCWVuZ2lu
ZS0+aW5zdGFuY2UgPSBpbmZvLT5pbnN0YW5jZTsKIAlfX3NwcmludF9lbmdpbmVfbmFtZShlbmdp
bmUpOwogCisJZW5naW5lLT5wcm9wcy5zdG9wX3RpbWVvdXRfbXMgPQorCQlDT05GSUdfRFJNX0k5
MTVfU1RPUF9USU1FT1VUOworCiAJLyoKIAkgKiBUbyBiZSBvdmVycmlkZGVuIGJ5IHRoZSBiYWNr
ZW5kIG9uIHNldHVwLiBIb3dldmVyIHRvIGZhY2lsaXRhdGUKIAkgKiBjbGVhbnVwIG9uIGVycm9y
IGR1cmluZyBzZXR1cCwgd2UgYWx3YXlzIHByb3ZpZGUgdGhlIGRlc3Ryb3kgdmZ1bmMuCkBAIC04
NzUsNiArODc4LDIxIEBAIHU2NCBpbnRlbF9lbmdpbmVfZ2V0X2xhc3RfYmF0Y2hfaGVhZChjb25z
dCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJcmV0dXJuIGJiYWRkcjsKIH0KIAor
c3RhdGljIHVuc2lnbmVkIGxvbmcgc3RvcF90aW1lb3V0KGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKK3sKKwlpZiAoaW5fYXRvbWljKCkgfHwgaXJxc19kaXNhYmxlZCgpKSAv
KiBpbnNpZGUgYXRvbWljIHByZWVtcHQtcmVzZXQ/ICovCisJCXJldHVybiAwOyAvKiBHb2luZyB0
b28gZmFzdCwgY2FuJ3Qgc3RvcCBub3chICovCisKKwkvKgorCSAqIElmIHdlIGFyZSBkb2luZyBh
IG5vcm1hbCBHUFUgcmVzZXQsIHdlIGNhbiB0YWtlIG91ciB0aW1lIGFuZCBhbGxvdworCSAqIHRo
ZSBlbmdpbmUgdG8gcXVpZXNjZS4gV2UndmUgc3RvcHBlZCBzdWJtaXNzaW9uIHRvIHRoZSBlbmdp
bmUsIGFuZAorCSAqIGlmIHdlIHdhaXQgbG9uZyBlbm91Z2ggYW4gaW5ub2NlbnQgY29udGV4dCBz
aG91bGQgY29tcGxldGUgYW5kCisJICogbGVhdmUgdGhlIGVuZ2luZSBpZGxlLiBTbyB0aGV5IHNo
b3VsZCBub3QgYmUgY2F1Z2h0IHVuYXdhcmUgYnkKKwkgKiB0aGUgZm9ydGhjb21pbmcgR1BVIHJl
c2V0ICh3aGljaCB1c3VhbGx5IGZvbGxvd3MgdGhlIHN0b3BfY3MpIQorCSAqLworCXJldHVybiBS
RUFEX09OQ0UoZW5naW5lLT5wcm9wcy5zdG9wX3RpbWVvdXRfbXMpOworfQorCiBpbnQgaW50ZWxf
ZW5naW5lX3N0b3BfY3Moc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGVuZ2luZS0+dW5jb3JlOwpAQCAtODkyLDcgKzkxMCw3
IEBAIGludCBpbnRlbF9lbmdpbmVfc3RvcF9jcyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiAJZXJyID0gMDsKIAlpZiAoX19pbnRlbF93YWl0X2Zvcl9yZWdpc3Rlcl9mdyh1bmNvcmUs
CiAJCQkJCSBtb2RlLCBNT0RFX0lETEUsIE1PREVfSURMRSwKLQkJCQkJIDEwMDAsIDAsCisJCQkJ
CSAxMDAwLCBzdG9wX3RpbWVvdXQoZW5naW5lKSwKIAkJCQkJIE5VTEwpKSB7CiAJCUdFTV9UUkFD
RSgiJXM6IHRpbWVkIG91dCBvbiBTVE9QX1JJTkcgLT4gSURMRVxuIiwgZW5naW5lLT5uYW1lKTsK
IAkJZXJyID0gLUVUSU1FRE9VVDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3R5cGVzLmgKaW5kZXggMzQ1MWJlMDM0Y2FmLi44N2Q1YzRlZjNhZTcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCkBAIC01NDIsNiArNTQyLDEw
IEBAIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgewogCQkgKi8KIAkJa3RpbWVfdCB0b3RhbDsKIAl9
IHN0YXRzOworCisJc3RydWN0IHsKKwkJdW5zaWduZWQgbG9uZyBzdG9wX3RpbWVvdXRfbXM7CisJ
fSBwcm9wczsKIH07CiAKIHN0YXRpYyBpbmxpbmUgYm9vbAotLSAKMi4yNC4wLnJjMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

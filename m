Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5A444129666
	for <lists+intel-gfx@lfdr.de>; Mon, 23 Dec 2019 14:17:37 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EEB066E2AF;
	Mon, 23 Dec 2019 13:17:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 60C446E0F5
 for <intel-gfx@lists.freedesktop.org>; Mon, 23 Dec 2019 13:17:31 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 23 Dec 2019 05:17:31 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,347,1571727600"; d="scan'208";a="223020239"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga001.fm.intel.com with ESMTP; 23 Dec 2019 05:17:29 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 23 Dec 2019 15:14:44 +0200
Message-Id: <20191223131444.20259-5-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20191223131444.20259-1-stanislav.lisovskiy@intel.com>
References: <20191223131444.20259-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v10 4/4] drm/i915: Correctly map DBUF slices to
 pipes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkZWQgcHJvcGVyIERCdWYgc2xpY2UgbWFwcGluZyB0byBjb3JyZXNwb25kZW50CnBpcGVzLCBk
ZXBlbmRpbmcgb24gcGlwZSBjb25maWd1cmF0aW9uIGFzIHN0YXRlZAppbiBCU3BlYy4KCnYyOgog
ICAgLSBSZW1vdmUgdW5uZWVkZWQgYnJhY2VzCiAgICAtIFN0b3AgdXNpbmcgbWFjcm8gZm9yIERC
dWYgYXNzaWdubWVudHMgYXMKICAgICAgaXQgc2VlbXMgdG8gcmVkdWNlIHJlYWRhYmlsaXR5LgoK
djM6IFN0YXJ0IHVzaW5nIGVuYWJsZWQgc2xpY2VzIG1hc2sgaW4gZGV2X3ByaXYKCnY0OiBSZW5h
bWVkICJlbmFibGVkX3NsaWNlcyIgdXNlZCBpbiBkZXZfcHJpdgogICAgdG8gImVuYWJsZWRfZGJ1
Zl9zbGljZXNfbWFzayIoTWF0dCBSb3BlcikKCnY1OiAtIFJlbW92ZWQgcmVkdW5kYW50IHBhcmFt
ZXRlcnMgZnJvbQogICAgICBpbnRlbF9nZXRfZGRiX3NpemUgZnVuY3Rpb24uKE1hdHQgUm9wZXIp
CiAgICAtIE1hZGUgaTkxNV9wb3NzaWJsZV9kYnVmX3NsaWNlcyBzdGF0aWMoTWF0dCBSb3BlcikK
ICAgIC0gUmVuYW1lZCB0b3RhbF93aWR0aCBpbnRvIHRvdGFsX3dpZHRoX2luX3JhbmdlCiAgICAg
IHNvIHRoYXQgaXQgbm93IHJlZmxlY3RzIHRoYXQgdGhpcyBpcyBub3QKICAgICAgYSB0b3RhbCBw
aXBlIHdpZHRoIGJ1dCB0aGUgb25lIGluIGN1cnJlbnQKICAgICAgZGJ1ZiBzbGljZSBhbGxvd2Vk
IHJhbmdlIGZvciBwaXBlLihNYXR0IFJvcGVyKQogICAgLSBSZW1vdmVkIDR0aCBwaXBlIGZvciBJ
Q0wgaW4gREJ1ZiBhc3NpZ25tZW50CiAgICAgIHRhYmxlKE1hdHQgUm9wZXIpCiAgICAtIEZpeGVk
IHdyb25nIERCdWYgc2xpY2UgaW4gREJ1ZiB0YWJsZSBmb3IgVEdMCiAgICAgIChNYXR0IFJvcGVy
KQogICAgLSBBZGRlZCBjb21tZW50IHJlZ2FyZGluZyB3aHkgd2UgY3VycmVudGx5IG5vdAogICAg
ICB1c2luZyBwaXBlIHJhdGlvIGZvciBEQnVmIGFzc2lnbm1lbnQgZm9yIElDTAoKdjY6IC0gQ2hh
bmdlZCB1MzIgdG8gdW5zaWduZWQgaW50IGluCiAgICAgIGljbF9nZXRfZmlyc3RfZGJ1Zl9zbGlj
ZV9vZmZzZXQgZnVuY3Rpb24gc2lnbmF0dXJlCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IENoYW5nZWQgYWxzbyB1MzIgdG8gdTggaW4gZGJ1ZiBzbGljZSBtYXNrIHN0cnVjdHVyZQogICAg
ICAoVmlsbGUgU3lyasOkbMOkKQogICAgLSBTd2l0Y2hlZCBmcm9tIERCVUZfUzFfQklUIHRvIGVu
dW0gKyBleHBsaWNpdAogICAgICBCSVQoREJVRl9TMSkgYWNjZXNzKFZpbGxlIFN5cmrDpGzDpCkK
ICAgIC0gU3dpdGNoZWQgdG8gbmFtZWQgaW5pdGlhbGl6ZXJzIGluIERCdWYgYXNzaWdubWVudAog
ICAgICBhcnJheXMoVmlsbGUgU3lyasOkbMOkKQogICAgLSBEQnVmIGFzc2lnbm1lbnQgYXJyYXlz
IG5vdyB1c2UgYXV0b2dlbmVyYXRpb24gdG9vbAogICAgICBmcm9tCiAgICAgIGh0dHBzOi8vcGF0
Y2h3b3JrLmZyZWVkZXNrdG9wLm9yZy9zZXJpZXMvNzA0OTMvCiAgICAgIHRvIGF2b2lkIHR5cG9z
LgogICAgLSBSZW5hbWVkIGk5MTVfZmluZF9waXBlX2NvbmYgdG8gKl9jb21wdXRlX2RidWZfc2xp
Y2VzCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIENoYW5nZWQgcGxhdGZvcm1zIG9yZGVy
aW5nIGluIHNrbF9jb21wdXRlX2RidWZfc2xpY2VzCiAgICAgIHRvIGJlIGZyb20gbmV3ZXN0IHRv
IG9sZGVzdChWaWxsZSBTeXJqw6Rsw6QpCgpTaWduZWQtb2ZmLWJ5OiBTdGFuaXNsYXYgTGlzb3Zz
a2l5IDxzdGFuaXNsYXYubGlzb3Zza2l5QGludGVsLmNvbT4KLS0tCiAuLi4vZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMgICAgfCAgIDIgKy0KIC4uLi9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuaCAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfcG0uYyAgICAgICAgICAgICAgIHwgMzg3ICsrKysrKysrKysrKysrKysrLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCAgICAgICAgICAgICAgIHwgICAyICsKIDQgZmls
ZXMgY2hhbmdlZCwgMzc2IGluc2VydGlvbnMoKyksIDIzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKaW5kZXgg
YjMwNzM4ZDJkNDZjLi4zMzRiZWJlNjFlNDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jCkBAIC00NDQzLDcgKzQ0NDMsNyBAQCBz
dGF0aWMgdm9pZCBpY2xfZGJ1Zl9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCSAqIEp1c3QgcG93ZXIgdXAgMSBzbGljZSwgd2Ugd2lsbAogCSAqIGZpZ3VyZSBvdXQg
bGF0ZXIgd2hpY2ggc2xpY2VzIHdlIGhhdmUgYW5kIHdoYXQgd2UgbmVlZC4KIAkgKi8KLQlkZXZf
cHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrID0gREJVRl9TMV9CSVQ7CisJZGV2X3ByaXYt
PmVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzayA9IEJJVChEQlVGX1MxKTsKIAlpY2xfZGJ1Zl9zbGlj
ZXNfdXBkYXRlKGRldl9wcml2LCBkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrKTsK
IH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3Bvd2VyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
cG93ZXIuaAppbmRleCBmNTI1OTRlY2Y1NzcuLjAwOWU3MjgxYTBkZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmgKQEAgLTMwNywx
MyArMzA3LDE1IEBAIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2FzeW5jKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogfQogI2VuZGlmCiAKK2VudW0gZGJ1Zl9zbGljZSB7CisJREJVRl9T
MSwKKwlEQlVGX1MyCit9OworCiAjZGVmaW5lIHdpdGhfaW50ZWxfZGlzcGxheV9wb3dlcihpOTE1
LCBkb21haW4sIHdmKSBcCiAJZm9yICgod2YpID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoKGk5
MTUpLCAoZG9tYWluKSk7ICh3Zik7IFwKIAkgICAgIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2Fz
eW5jKChpOTE1KSwgKGRvbWFpbiksICh3ZikpLCAod2YpID0gMCkKIAotI2RlZmluZSBEQlVGX1Mx
X0JJVAkJCUJJVCgwKQotI2RlZmluZSBEQlVGX1MyX0JJVAkJCUJJVCgxKQotCiB2b2lkIGljbF9k
YnVmX3NsaWNlc191cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJ
ICAgIHU4IHJlcV9zbGljZXMpOwogaW50IGludGVsX2RidWZfbWF4X3NsaWNlcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggZGM2
YjY5ZjViNmQ3Li44OWUyYTRlZWFkNzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtMzYy
NCw3ICszNjI0LDcgQEAgdTggaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCS8qIEdlbiBwcmlvciB0byBHRU4xMSBoYXZl
IG9ubHkgb25lIERCdWYgc2xpY2UgKi8KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQot
CQlyZXR1cm4gREJVRl9TMV9CSVQ7CisJCXJldHVybiBCSVQoREJVRl9TMSk7CiAKIAlmb3IgKGkg
PSAwOyBpIDwgbWF4X3NsaWNlczsgaSsrKSB7CiAJCWlmIChJOTE1X1JFQUQoREJVRl9DVExfUyhC
SVQoaSkpKSAmIERCVUZfUE9XRVJfU1RBVEUpCkBAIC0zODMyLDEzICszODMyLDI5IEBAIGJvb2wg
aW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQog
CXJldHVybiB0cnVlOwogfQogCi1zdGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgICAgIGNvbnN0IHU2NCB0b3RhbF9kYXRhX3Jh
dGUsCi0JCQkgICAgICBjb25zdCBpbnQgbnVtX2FjdGl2ZSkKKy8qCisgKiBDYWxjdWxhdGUgaW5p
dGlhbCBEQnVmIHNsaWNlIG9mZnNldCwgYmFzZWQgb24gc2xpY2Ugc2l6ZQorICogYW5kIG1hc2so
aS5lIGlmIHNsaWNlIHNpemUgaXMgMTAyNCBhbmQgc2Vjb25kIHNsaWNlIGlzIGVuYWJsZWQKKyAq
IG9mZnNldCB3b3VsZCBiZSAxMDI0KQorICovCitzdGF0aWMgdW5zaWduZWQgaW50CitpY2xfZ2V0
X2ZpcnN0X2RidWZfc2xpY2Vfb2Zmc2V0KHUzMiBkYnVmX3NsaWNlX21hc2ssCisJCQkJdTMyIHNs
aWNlX3NpemUsCisJCQkJdTMyIGRkYl9zaXplKQoreworCXVuc2lnbmVkIGludCBvZmZzZXQgPSAw
OworCisJaWYgKCFkYnVmX3NsaWNlX21hc2spCisJCXJldHVybiAwOworCisJb2Zmc2V0ID0gKGZm
cyhkYnVmX3NsaWNlX21hc2spIC0gMSkgKiBzbGljZV9zaXplOworCisJV0FSTl9PTihvZmZzZXQg
Pj0gZGRiX3NpemUpOworCXJldHVybiBvZmZzZXQ7Cit9CisKK3N0YXRpYyB1MTYgaW50ZWxfZ2V0
X2RkYl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRlLT51YXBpLnN0YXRlOwotCXN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRl
KHN0YXRlKTsKIAl1MTYgZGRiX3NpemUgPSBJTlRFTF9JTkZPKGRldl9wcml2KS0+ZGRiX3NpemU7
CiAKIAlXQVJOX09OKGRkYl9zaXplID09IDApOwpAQCAtMzg0NiwxMiArMzg2MiwxMiBAQCBzdGF0
aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKIAkJcmV0dXJuIGRkYl9zaXplIC0g
NDsgLyogNCBibG9ja3MgZm9yIGJ5cGFzcyBwYXRoIGFsbG9jYXRpb24gKi8KIAotCWludGVsX3N0
YXRlLT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2sgPSBEQlVGX1MxX0JJVDsKLQlkZGJfc2l6ZSAv
PSAyOwotCiAJcmV0dXJuIGRkYl9zaXplOwogfQogCitzdGF0aWMgdTggc2tsX2NvbXB1dGVfZGJ1
Zl9zbGljZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJ
ICB1MzIgYWN0aXZlX3BpcGVzKTsKKwogc3RhdGljIHZvaWQKIHNrbF9kZGJfZ2V0X3BpcGVfYWxs
b2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCSAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtMzg2MywxMCAr
Mzg3OSwxNyBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRl
bF9zdGF0ZSA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CiAJc3RydWN0IGRybV9jcnRj
ICpmb3JfY3J0YyA9IGNydGNfc3RhdGUtPnVhcGkuY3J0YzsKIAljb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YzsKLQl1MzIgcGlwZV93aWR0aCA9IDAsIHRvdGFsX3dpZHRoID0gMCwgd2lkdGhf
YmVmb3JlX3BpcGUgPSAwOworCXUzMiBwaXBlX3dpZHRoID0gMCwgdG90YWxfd2lkdGhfaW5fcmFu
Z2UgPSAwLCB3aWR0aF9iZWZvcmVfcGlwZSA9IDA7CiAJZW51bSBwaXBlIGZvcl9waXBlID0gdG9f
aW50ZWxfY3J0Yyhmb3JfY3J0YyktPnBpcGU7CiAJdTE2IGRkYl9zaXplOworCXUzMiBkZGJfcmFu
Z2Vfc2l6ZTsKIAl1MzIgaTsKKwl1MzIgZGJ1Zl9zbGljZV9tYXNrOworCXUzMiBhY3RpdmVfcGlw
ZXM7CisJdTMyIG9mZnNldDsKKwl1MzIgc2xpY2Vfc2l6ZTsKKwl1MzIgdG90YWxfc2xpY2VfbWFz
azsKKwl1MzIgc3RhcnQsIGVuZDsKIAogCWlmIChXQVJOX09OKCFzdGF0ZSkgfHwgIWNydGNfc3Rh
dGUtPmh3LmFjdGl2ZSkgewogCQlhbGxvYy0+c3RhcnQgPSAwOwpAQCAtMzg3NiwxMiArMzg5OSwx
NSBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAl9CiAKIAlpZiAoaW50ZWxfc3RhdGUtPmFjdGl2ZV9waXBlX2No
YW5nZXMpCi0JCSpudW1fYWN0aXZlID0gaHdlaWdodDgoaW50ZWxfc3RhdGUtPmFjdGl2ZV9waXBl
cyk7CisJCWFjdGl2ZV9waXBlcyA9IGludGVsX3N0YXRlLT5hY3RpdmVfcGlwZXM7CiAJZWxzZQot
CQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGRldl9wcml2LT5hY3RpdmVfcGlwZXMpOworCQlhY3Rp
dmVfcGlwZXMgPSBkZXZfcHJpdi0+YWN0aXZlX3BpcGVzOworCisJKm51bV9hY3RpdmUgPSBod2Vp
Z2h0OChhY3RpdmVfcGlwZXMpOworCisJZGRiX3NpemUgPSBpbnRlbF9nZXRfZGRiX3NpemUoZGV2
X3ByaXYpOwogCi0JZGRiX3NpemUgPSBpbnRlbF9nZXRfZGRiX3NpemUoZGV2X3ByaXYsIGNydGNf
c3RhdGUsIHRvdGFsX2RhdGFfcmF0ZSwKLQkJCQkgICAgICAqbnVtX2FjdGl2ZSk7CisJc2xpY2Vf
c2l6ZSA9IGRkYl9zaXplIC8gSU5URUxfSU5GTyhkZXZfcHJpdiktPm51bV9zdXBwb3J0ZWRfZGJ1
Zl9zbGljZXM7CiAKIAkvKgogCSAqIElmIHRoZSBzdGF0ZSBkb2Vzbid0IGNoYW5nZSB0aGUgYWN0
aXZlIENSVEMncyBvciB0aGVyZSBpcyBubwpAQCAtMzkwMCwyMiArMzkyNiw3MSBAQCBza2xfZGRi
X2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkJcmV0dXJuOwogCX0KIAorCS8qCisJICogR2V0IGFsbG93ZWQgREJ1ZiBzbGljZXMg
Zm9yIGNvcnJlc3BvbmRlbnQgcGlwZSBhbmQgcGxhdGZvcm0uCisJICovCisJZGJ1Zl9zbGljZV9t
YXNrID0gc2tsX2NvbXB1dGVfZGJ1Zl9zbGljZXMoY3J0Y19zdGF0ZSwgYWN0aXZlX3BpcGVzKTsK
KworCURSTV9ERUJVR19LTVMoIkRCdWYgc2xpY2UgbWFzayAleCBwaXBlICVkIGFjdGl2ZSBwaXBl
cyAleFxuIiwKKwkJICAgICAgZGJ1Zl9zbGljZV9tYXNrLAorCQkgICAgICBmb3JfcGlwZSwgYWN0
aXZlX3BpcGVzKTsKKworCS8qCisJICogRmlndXJlIG91dCBhdCB3aGljaCBEQnVmIHNsaWNlIHdl
IHN0YXJ0LCBpLmUgaWYgd2Ugc3RhcnQgYXQgRGJ1ZiBTMgorCSAqIGFuZCBzbGljZSBzaXplIGlz
IDEwMjQsIHRoZSBvZmZzZXQgd291bGQgYmUgMTAyNAorCSAqLworCW9mZnNldCA9IGljbF9nZXRf
Zmlyc3RfZGJ1Zl9zbGljZV9vZmZzZXQoZGJ1Zl9zbGljZV9tYXNrLAorCQkJCQkJIHNsaWNlX3Np
emUsIGRkYl9zaXplKTsKKworCS8qCisJICogRmlndXJlIG91dCB0b3RhbCBzaXplIG9mIGFsbG93
ZWQgREJ1ZiBzbGljZXMsIHdoaWNoIGlzIGJhc2ljYWxseQorCSAqIGEgbnVtYmVyIG9mIGFsbG93
ZWQgc2xpY2VzIGZvciB0aGF0IHBpcGUgbXVsdGlwbGllZCBieSBzbGljZSBzaXplLgorCSAqIElu
c2lkZSBvZiB0aGlzCisJICogcmFuZ2UgZGRiIGVudHJpZXMgYXJlIHN0aWxsIGFsbG9jYXRlZCBp
biBwcm9wb3J0aW9uIHRvIGRpc3BsYXkgd2lkdGguCisJICovCisJZGRiX3JhbmdlX3NpemUgPSBo
d2VpZ2h0OChkYnVmX3NsaWNlX21hc2spICogc2xpY2Vfc2l6ZTsKKwogCS8qCiAJICogV2F0ZXJt
YXJrL2RkYiByZXF1aXJlbWVudCBoaWdobHkgZGVwZW5kcyB1cG9uIHdpZHRoIG9mIHRoZQogCSAq
IGZyYW1lYnVmZmVyLCBTbyBpbnN0ZWFkIG9mIGFsbG9jYXRpbmcgRERCIGVxdWFsbHkgYW1vbmcg
cGlwZXMKIAkgKiBkaXN0cmlidXRlIEREQiBiYXNlZCBvbiByZXNvbHV0aW9uL3dpZHRoIG9mIHRo
ZSBkaXNwbGF5LgogCSAqLworCXRvdGFsX3NsaWNlX21hc2sgPSBkYnVmX3NsaWNlX21hc2s7CiAJ
Zm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoaW50ZWxfc3RhdGUsIGNydGMsIGNydGNf
c3RhdGUsIGkpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21v
ZGUgPQogCQkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJCWVudW0gcGlwZSBwaXBl
ID0gY3J0Yy0+cGlwZTsKIAkJaW50IGhkaXNwbGF5LCB2ZGlzcGxheTsKKwkJdTMyIHBpcGVfZGJ1
Zl9zbGljZV9tYXNrOwogCi0JCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQorCQlpZiAoIWNy
dGNfc3RhdGUtPmh3LmFjdGl2ZSkKKwkJCWNvbnRpbnVlOworCisJCXBpcGVfZGJ1Zl9zbGljZV9t
YXNrID0gc2tsX2NvbXB1dGVfZGJ1Zl9zbGljZXMoY3J0Y19zdGF0ZSwKKwkJCQkJCQkgICAgICAg
YWN0aXZlX3BpcGVzKTsKKworCQkvKgorCQkgKiBBY2NvcmRpbmcgdG8gQlNwZWMgcGlwZSBjYW4g
c2hhcmUgb25lIGRidWYgc2xpY2Ugd2l0aCBhbm90aGVyCisJCSAqIHBpcGVzIG9yIHBpcGUgY2Fu
IHVzZSBtdWx0aXBsZSBkYnVmcywgaW4gYm90aCBjYXNlcyB3ZQorCQkgKiBhY2NvdW50IGZvciBv
dGhlciBwaXBlcyBvbmx5IGlmIHRoZXkgaGF2ZSBleGFjdGx5IHNhbWUgbWFzay4KKwkJICogSG93
ZXZlciB3ZSBuZWVkIHRvIGFjY291bnQgaG93IG1hbnkgc2xpY2VzIHdlIHNob3VsZCBlbmFibGUK
KwkJICogaW4gdG90YWwuCisJCSAqLworCQl0b3RhbF9zbGljZV9tYXNrIHw9IHBpcGVfZGJ1Zl9z
bGljZV9tYXNrOworCisJCS8qCisJCSAqIERvIG5vdCBhY2NvdW50IHBpcGVzIHVzaW5nIG90aGVy
IHNsaWNlIHNldHMKKwkJICogbHVja2lseSBhcyBvZiBjdXJyZW50IEJTcGVjIHNsaWNlIHNldHMg
ZG8gbm90IHBhcnRpYWxseQorCQkgKiBpbnRlcnNlY3QocGlwZXMgc2hhcmUgZWl0aGVyIHNhbWUg
b25lIHNsaWNlIG9yIHNhbWUgc2xpY2Ugc2V0CisJCSAqIGkuZSBubyBwYXJ0aWFsIGludGVyc2Vj
dGlvbiksIHNvIGl0IGlzIGVub3VnaCB0byBjaGVjayBmb3IKKwkJICogZXF1YWxpdHkgZm9yIG5v
dy4KKwkJICovCisJCWlmIChkYnVmX3NsaWNlX21hc2sgIT0gcGlwZV9kYnVmX3NsaWNlX21hc2sp
CiAJCQljb250aW51ZTsKIAogCQlkcm1fbW9kZV9nZXRfaHZfdGltaW5nKGFkanVzdGVkX21vZGUs
ICZoZGlzcGxheSwgJnZkaXNwbGF5KTsKLQkJdG90YWxfd2lkdGggKz0gaGRpc3BsYXk7CisKKwkJ
dG90YWxfd2lkdGhfaW5fcmFuZ2UgKz0gaGRpc3BsYXk7CiAKIAkJaWYgKHBpcGUgPCBmb3JfcGlw
ZSkKIAkJCXdpZHRoX2JlZm9yZV9waXBlICs9IGhkaXNwbGF5OwpAQCAtMzkyMyw4ICszOTk4LDIw
IEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCQkJcGlwZV93aWR0aCA9IGhkaXNwbGF5OwogCX0KIAotCWFsbG9j
LT5zdGFydCA9IGRkYl9zaXplICogd2lkdGhfYmVmb3JlX3BpcGUgLyB0b3RhbF93aWR0aDsKLQlh
bGxvYy0+ZW5kID0gZGRiX3NpemUgKiAod2lkdGhfYmVmb3JlX3BpcGUgKyBwaXBlX3dpZHRoKSAv
IHRvdGFsX3dpZHRoOworCWludGVsX3N0YXRlLT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2sgPSB0
b3RhbF9zbGljZV9tYXNrOworCisJc3RhcnQgPSBkZGJfcmFuZ2Vfc2l6ZSAqIHdpZHRoX2JlZm9y
ZV9waXBlIC8gdG90YWxfd2lkdGhfaW5fcmFuZ2U7CisJZW5kID0gZGRiX3JhbmdlX3NpemUgKgor
CQkod2lkdGhfYmVmb3JlX3BpcGUgKyBwaXBlX3dpZHRoKSAvIHRvdGFsX3dpZHRoX2luX3Jhbmdl
OworCisJYWxsb2MtPnN0YXJ0ID0gb2Zmc2V0ICsgc3RhcnQ7CisJYWxsb2MtPmVuZCA9IG9mZnNl
dCArIGVuZDsKKworCURSTV9ERUJVR19LTVMoIlBpcGUgJWQgZGRiICVkLSVkXG4iLCBmb3JfcGlw
ZSwKKwkJICAgICAgYWxsb2MtPnN0YXJ0LCBhbGxvYy0+ZW5kKTsKKwlEUk1fREVCVUdfS01TKCJF
bmFibGVkIGRkYiBzbGljZXMgbWFzayAleCBudW0gc3VwcG9ydGVkICVkXG4iLAorCQkgICAgICBp
bnRlbF9zdGF0ZS0+ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrLAorCQkgICAgICBJTlRFTF9JTkZP
KGRldl9wcml2KS0+bnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyk7CiB9CiAKIHN0YXRpYyBpbnQg
c2tsX2NvbXB1dGVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLApAQCAtNDA5NSw2ICs0MTgyLDI2OCBAQCBza2xfcGxhbmVfZG93bnNjYWxlX2Ftb3Vu
dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlyZXR1cm4gbXVs
X2ZpeGVkMTYoZG93bnNjYWxlX3csIGRvd25zY2FsZV9oKTsKIH0KIAorc3RydWN0IGRidWZfc2xp
Y2VfY29uZl9lbnRyeSB7CisJdTggYWN0aXZlX3BpcGVzOworCXU4IGRidWZfbWFza1tJOTE1X01B
WF9QSVBFU107Cit9OworCisvKgorICogVGFibGUgdGFrZW4gZnJvbSBCc3BlYyAxMjcxNgorICog
UGlwZXMgZG8gaGF2ZSBzb21lIHByZWZlcnJlZCBEQnVmIHNsaWNlIGFmZmluaXR5LAorICogcGx1
cyB0aGVyZSBhcmUgc29tZSBoYXJkY29kZWQgcmVxdWlyZW1lbnRzIG9uIGhvdworICogdGhvc2Ug
c2hvdWxkIGJlIGRpc3RyaWJ1dGVkIGZvciBtdWx0aXBpcGUgc2NlbmFyaW9zLgorICogRm9yIG1v
cmUgREJ1ZiBzbGljZXMgYWxnb3JpdGhtIGNhbiBnZXQgZXZlbiBtb3JlIG1lc3N5CisgKiBhbmQg
bGVzcyByZWFkYWJsZSwgc28gZGVjaWRlZCB0byB1c2UgYSB0YWJsZSBhbG1vc3QKKyAqIGFzIGlz
IGZyb20gQlNwZWMgaXRzZWxmIC0gdGhhdCB3YXkgaXQgaXMgYXQgbGVhc3QgZWFzaWVyCisgKiB0
byBjb21wYXJlLCBjaGFuZ2UgYW5kIGNoZWNrLgorICovCitzdGF0aWMgc3RydWN0IGRidWZfc2xp
Y2VfY29uZl9lbnRyeSBpY2xfYWxsb3dlZF9kYnVmc1tdID0KKy8qIEF1dG9nZW5lcmF0ZWQgd2l0
aCBpZ3QvdG9vbHMvaW50ZWxfZGJ1Zl9tYXAgdG9vbDogKi8KK3sKKwl7CisJCS5hY3RpdmVfcGlw
ZXMgPSBCSVQoUElQRV9BKSwKKwkJeworCQkJW1BJUEVfQV0gPSBCSVQoREJVRl9TMSkgfCBCSVQo
REJVRl9TMikKKwkJfQorCX0sCisJeworCQkuYWN0aXZlX3BpcGVzID0gQklUKFBJUEVfQiksCisJ
CXsKKwkJCVtQSVBFX0JdID0gQklUKERCVUZfUzEpIHwgQklUKERCVUZfUzIpCisJCX0KKwl9LAor
CXsKKwkJLmFjdGl2ZV9waXBlcyA9IEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQiksCisJCXsKKwkJ
CVtQSVBFX0FdID0gQklUKERCVUZfUzEpLAorCQkJW1BJUEVfQl0gPSBCSVQoREJVRl9TMikKKwkJ
fQorCX0sCisJeworCQkuYWN0aXZlX3BpcGVzID0gQklUKFBJUEVfQyksCisJCXsKKwkJCVtQSVBF
X0NdID0gQklUKERCVUZfUzIpIHwgQklUKERCVUZfUzEpCisJCX0KKwl9LAorCXsKKwkJLmFjdGl2
ZV9waXBlcyA9IEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQyksCisJCXsKKwkJCVtQSVBFX0FdID0g
QklUKERCVUZfUzEpLAorCQkJW1BJUEVfQ10gPSBCSVQoREJVRl9TMikKKwkJfQorCX0sCisJewor
CQkuYWN0aXZlX3BpcGVzID0gQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSwKKwkJeworCQkJW1BJ
UEVfQl0gPSBCSVQoREJVRl9TMSksCisJCQlbUElQRV9DXSA9IEJJVChEQlVGX1MyKQorCQl9CisJ
fSwKKwl7CisJCS5hY3RpdmVfcGlwZXMgPSBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0IpIHwgQklU
KFBJUEVfQyksCisJCXsKKwkJCVtQSVBFX0FdID0gQklUKERCVUZfUzEpLAorCQkJW1BJUEVfQl0g
PSBCSVQoREJVRl9TMSksCisJCQlbUElQRV9DXSA9IEJJVChEQlVGX1MyKQorCQl9CisJfSwKK307
CisKKworLyoKKyAqIFRhYmxlIHRha2VuIGZyb20gQnNwZWMgNDkyNTUKKyAqIFBpcGVzIGRvIGhh
dmUgc29tZSBwcmVmZXJyZWQgREJ1ZiBzbGljZSBhZmZpbml0eSwKKyAqIHBsdXMgdGhlcmUgYXJl
IHNvbWUgaGFyZGNvZGVkIHJlcXVpcmVtZW50cyBvbiBob3cKKyAqIHRob3NlIHNob3VsZCBiZSBk
aXN0cmlidXRlZCBmb3IgbXVsdGlwaXBlIHNjZW5hcmlvcy4KKyAqIEZvciBtb3JlIERCdWYgc2xp
Y2VzIGFsZ29yaXRobSBjYW4gZ2V0IGV2ZW4gbW9yZSBtZXNzeQorICogYW5kIGxlc3MgcmVhZGFi
bGUsIHNvIGRlY2lkZWQgdG8gdXNlIGEgdGFibGUgYWxtb3N0CisgKiBhcyBpcyBmcm9tIEJTcGVj
IGl0c2VsZiAtIHRoYXQgd2F5IGl0IGlzIGF0IGxlYXN0IGVhc2llcgorICogdG8gY29tcGFyZSwg
Y2hhbmdlIGFuZCBjaGVjay4KKyAqLworc3RhdGljIHN0cnVjdCBkYnVmX3NsaWNlX2NvbmZfZW50
cnkgdGdsX2FsbG93ZWRfZGJ1ZnNbXSA9CisvKiBBdXRvZ2VuZXJhdGVkIHdpdGggaWd0L3Rvb2xz
L2ludGVsX2RidWZfbWFwIHRvb2w6ICovCit7CisJeworCQkuYWN0aXZlX3BpcGVzID0gQklUKFBJ
UEVfQSksCisJCXsKKwkJCVtQSVBFX0FdID0gQklUKERCVUZfUzEpIHwgQklUKERCVUZfUzIpCisJ
CX0KKwl9LAorCXsKKwkJLmFjdGl2ZV9waXBlcyA9IEJJVChQSVBFX0IpLAorCQl7CisJCQlbUElQ
RV9CXSA9IEJJVChEQlVGX1MxKSB8IEJJVChEQlVGX1MyKQorCQl9CisJfSwKKwl7CisJCS5hY3Rp
dmVfcGlwZXMgPSBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0IpLAorCQl7CisJCQlbUElQRV9BXSA9
IEJJVChEQlVGX1MyKSwKKwkJCVtQSVBFX0JdID0gQklUKERCVUZfUzEpCisJCX0KKwl9LAorCXsK
KwkJLmFjdGl2ZV9waXBlcyA9IEJJVChQSVBFX0MpLAorCQl7CisJCQlbUElQRV9DXSA9IEJJVChE
QlVGX1MyKSB8IEJJVChEQlVGX1MxKQorCQl9CisJfSwKKwl7CisJCS5hY3RpdmVfcGlwZXMgPSBC
SVQoUElQRV9BKSB8IEJJVChQSVBFX0MpLAorCQl7CisJCQlbUElQRV9BXSA9IEJJVChEQlVGX1Mx
KSwKKwkJCVtQSVBFX0NdID0gQklUKERCVUZfUzIpCisJCX0KKwl9LAorCXsKKwkJLmFjdGl2ZV9w
aXBlcyA9IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQyksCisJCXsKKwkJCVtQSVBFX0JdID0gQklU
KERCVUZfUzEpLAorCQkJW1BJUEVfQ10gPSBCSVQoREJVRl9TMikKKwkJfQorCX0sCisJeworCQku
YWN0aXZlX3BpcGVzID0gQklUKFBJUEVfQSkgfCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpLAor
CQl7CisJCQlbUElQRV9BXSA9IEJJVChEQlVGX1MxKSwKKwkJCVtQSVBFX0JdID0gQklUKERCVUZf
UzEpLAorCQkJW1BJUEVfQ10gPSBCSVQoREJVRl9TMikKKwkJfQorCX0sCisJeworCQkuYWN0aXZl
X3BpcGVzID0gQklUKFBJUEVfRCksCisJCXsKKwkJCVtQSVBFX0RdID0gQklUKERCVUZfUzIpIHwg
QklUKERCVUZfUzEpCisJCX0KKwl9LAorCXsKKwkJLmFjdGl2ZV9waXBlcyA9IEJJVChQSVBFX0Ep
IHwgQklUKFBJUEVfRCksCisJCXsKKwkJCVtQSVBFX0FdID0gQklUKERCVUZfUzEpLAorCQkJW1BJ
UEVfRF0gPSBCSVQoREJVRl9TMikKKwkJfQorCX0sCisJeworCQkuYWN0aXZlX3BpcGVzID0gQklU
KFBJUEVfQikgfCBCSVQoUElQRV9EKSwKKwkJeworCQkJW1BJUEVfQl0gPSBCSVQoREJVRl9TMSks
CisJCQlbUElQRV9EXSA9IEJJVChEQlVGX1MyKQorCQl9CisJfSwKKwl7CisJCS5hY3RpdmVfcGlw
ZXMgPSBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfRCksCisJCXsKKwkJCVtQ
SVBFX0FdID0gQklUKERCVUZfUzEpLAorCQkJW1BJUEVfQl0gPSBCSVQoREJVRl9TMSksCisJCQlb
UElQRV9EXSA9IEJJVChEQlVGX1MyKQorCQl9CisJfSwKKwl7CisJCS5hY3RpdmVfcGlwZXMgPSBC
SVQoUElQRV9DKSB8IEJJVChQSVBFX0QpLAorCQl7CisJCQlbUElQRV9DXSA9IEJJVChEQlVGX1Mx
KSwKKwkJCVtQSVBFX0RdID0gQklUKERCVUZfUzIpCisJCX0KKwl9LAorCXsKKwkJLmFjdGl2ZV9w
aXBlcyA9IEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSwKKwkJeworCQkJ
W1BJUEVfQV0gPSBCSVQoREJVRl9TMSksCisJCQlbUElQRV9DXSA9IEJJVChEQlVGX1MyKSwKKwkJ
CVtQSVBFX0RdID0gQklUKERCVUZfUzIpCisJCX0KKwl9LAorCXsKKwkJLmFjdGl2ZV9waXBlcyA9
IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSwKKwkJeworCQkJW1BJUEVf
Ql0gPSBCSVQoREJVRl9TMSksCisJCQlbUElQRV9DXSA9IEJJVChEQlVGX1MyKSwKKwkJCVtQSVBF
X0RdID0gQklUKERCVUZfUzIpCisJCX0KKwl9LAorCXsKKwkJLmFjdGl2ZV9waXBlcyA9CisJCQlC
SVQoUElQRV9BKSB8IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSwKKwkJ
eworCQkJW1BJUEVfQV0gPSBCSVQoREJVRl9TMSksCisJCQlbUElQRV9CXSA9IEJJVChEQlVGX1Mx
KSwKKwkJCVtQSVBFX0NdID0gQklUKERCVUZfUzIpLAorCQkJW1BJUEVfRF0gPSBCSVQoREJVRl9T
MikKKwkJfQorCX0sCit9OworCitzdGF0aWMgdTggY29tcHV0ZV9kYnVmX3NsaWNlcyhlbnVtIHBp
cGUgcGlwZSwKKwkJCSAgICAgIHUzMiBhY3RpdmVfcGlwZXMsCisJCQkgICAgICBjb25zdCBzdHJ1
Y3QgZGJ1Zl9zbGljZV9jb25mX2VudHJ5ICpkYnVmX3NsaWNlcywKKwkJCSAgICAgIGludCBzaXpl
KQoreworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IHNpemU7IGkrKykgeworCQlpZiAoZGJ1
Zl9zbGljZXNbaV0uYWN0aXZlX3BpcGVzID09IGFjdGl2ZV9waXBlcykKKwkJCXJldHVybiBkYnVm
X3NsaWNlc1tpXS5kYnVmX21hc2tbcGlwZV07CisJfQorCXJldHVybiAwOworfQorCisvKgorICog
VGhpcyBmdW5jdGlvbiBmaW5kcyBhbiBlbnRyeSB3aXRoIHNhbWUgZW5hYmxlZCBwaXBlIGNvbmZp
Z3VyYXRpb24gYW5kCisgKiByZXR1cm5zIGNvcnJlc3BvbmRlbnQgREJ1ZiBzbGljZSBtYXNrIGFz
IHN0YXRlZCBpbiBCU3BlYyBmb3IgcGFydGljdWxhcgorICogcGxhdGZvcm0uCisgKi8KK3N0YXRp
YyB1MzIgaWNsX2NvbXB1dGVfZGJ1Zl9zbGljZXMoZW51bSBwaXBlIHBpcGUsCisJCQkJICAgdTMy
IGFjdGl2ZV9waXBlcywKKwkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKK3sKKwkvKgorCSAqIEZJWE1FOiBGb3IgSUNMIHRoaXMgaXMgc3RpbGwgYSBiaXQg
dW5jbGVhciBhcyBwcmV2IEJTcGVjIHJldmlzaW9uCisJICogcmVxdWlyZWQgY2FsY3VsYXRpbmcg
InBpcGUgcmF0aW8iIGluIG9yZGVyIHRvIGRldGVybWluZQorCSAqIGlmIG9uZSBvciB0d28gc2xp
Y2VzIGNhbiBiZSB1c2VkIGZvciBzaW5nbGUgcGlwZSBjb25maWd1cmF0aW9ucworCSAqIGFzIGFk
ZGl0aW9uYWwgY29uc3RyYWludCB0byB0aGUgZXhpc3RpbmcgdGFibGUuCisJICogSG93ZXZlciBi
YXNlZCBvbiByZWNlbnQgaW5mbywgaXQgc2hvdWxkIGJlIG5vdCAicGlwZSByYXRpbyIKKwkgKiBi
dXQgcmF0aGVyIHJhdGlvIGJldHdlZW4gcGl4ZWxfcmF0ZSBhbmQgY2RjbGsgd2l0aCBhZGRpdGlv
bmFsCisJICogY29uc3RhbnRzLCBzbyBmb3Igbm93IHdlIGFyZSB1c2luZyBvbmx5IHRhYmxlIHVu
dGlsIHRoaXMgaXMKKwkgKiBjbGFyaWZpZWQuIEFsc28gdGhpcyBpcyB0aGUgcmVhc29uIHdoeSBj
cnRjX3N0YXRlIHBhcmFtIGlzCisJICogc3RpbGwgaGVyZSAtIHdlIHdpbGwgbmVlZCBpdCBvbmNl
IHRob3NlIGFkZGl0aW9uYWwgY29uc3RyYWludHMKKwkgKiBwb3AgdXAuCisJICovCisJcmV0dXJu
IGNvbXB1dGVfZGJ1Zl9zbGljZXMocGlwZSwgYWN0aXZlX3BpcGVzLAorCQkJCSAgIGljbF9hbGxv
d2VkX2RidWZzLAorCQkJCSAgIEFSUkFZX1NJWkUoaWNsX2FsbG93ZWRfZGJ1ZnMpKTsKK30KKwor
c3RhdGljIHUzMiB0Z2xfY29tcHV0ZV9kYnVmX3NsaWNlcyhlbnVtIHBpcGUgcGlwZSwKKwkJCQkg
ICB1MzIgYWN0aXZlX3BpcGVzLAorCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQoreworCXJldHVybiBjb21wdXRlX2RidWZfc2xpY2VzKHBpcGUsIGFjdGl2
ZV9waXBlcywKKwkJCQkgICB0Z2xfYWxsb3dlZF9kYnVmcywKKwkJCQkgICBBUlJBWV9TSVpFKHRn
bF9hbGxvd2VkX2RidWZzKSk7Cit9CisKK3N0YXRpYyB1OCBza2xfY29tcHV0ZV9kYnVmX3NsaWNl
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgICB1MzIg
YWN0aXZlX3BpcGVzKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+
cGlwZTsKKworCWlmIChJU19HRU4oZGV2X3ByaXYsIDEyKSkKKwkJcmV0dXJuIHRnbF9jb21wdXRl
X2RidWZfc2xpY2VzKHBpcGUsCisJCQkJCSAgICAgICBhY3RpdmVfcGlwZXMsCisJCQkJCSAgICAg
ICBjcnRjX3N0YXRlKTsKKwllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDExKSkKKwkJcmV0dXJu
IGljbF9jb21wdXRlX2RidWZfc2xpY2VzKHBpcGUsCisJCQkJCSAgICAgICBhY3RpdmVfcGlwZXMs
CisJCQkJCSAgICAgICBjcnRjX3N0YXRlKTsKKwkvKgorCSAqIEZvciBhbnl0aGluZyBlbHNlIGp1
c3QgcmV0dXJuIG9uZSBzbGljZSB5ZXQuCisJICogU2hvdWxkIGJlIGV4dGVuZGVkIGZvciBvdGhl
ciBwbGF0Zm9ybXMuCisJICovCisJcmV0dXJuIEJJVChEQlVGX1MxKTsKK30KKwogc3RhdGljIHU2
NAogc2tsX3BsYW5lX3JlbGF0aXZlX2RhdGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Bt
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oCmluZGV4IGQ2MGE4NTQyMWM1YS4u
Zjg1M2JjMTg0ZGQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKQEAgLTU3LDYgKzU3LDggQEAg
Ym9vbCBpbGtfZGlzYWJsZV9scF93bShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
Owogdm9pZCBpbnRlbF9pbml0X2lwYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
Owogdm9pZCBpbnRlbF9lbmFibGVfaXBjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dik7CiAKK2ludCBpbnRlbF9kYnVmX21heF9zbGljZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKKwogYm9vbCBpbnRlbF9zZXRfbWVtb3J5X2N4c3Ioc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBib29sIGVuYWJsZSk7CiAKICNlbmRpZiAvKiBfX0lOVEVMX1BN
X0hfXyAqLwotLSAKMi4yNC4xLjQ4NS5nYWQwNWEzZDhlNQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

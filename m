Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 60653EAEE4
	for <lists+intel-gfx@lfdr.de>; Thu, 31 Oct 2019 12:26:48 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BFAB16EE40;
	Thu, 31 Oct 2019 11:26:46 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 123F86EE3D
 for <intel-gfx@lists.freedesktop.org>; Thu, 31 Oct 2019 11:26:18 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 31 Oct 2019 12:26:04 +0100
Message-Id: <20191031112610.27608-6-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
References: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/12] drm/i915: Complete crtc hw/uapi split, v6.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm93IHRoYXQgd2Ugc2VwYXJhdGVkIGV2ZXJ5dGhpbmcgaW50byB1YXBpIGFuZCBodywgaXQncwp0
aW1lIHRvIG1ha2UgdGhlIHNwbGl0IGRlZmluaXRpdmUuIFJlbW92ZSB0aGUgdW5pb24gYW5kCm1h
a2UgYSBjb3B5IG9mIHRoZSBodyBzdGF0ZSBvbiBtb2Rlc2V0IGFuZCBmYXN0c2V0LgoKQ29sb3Ig
YmxvYnMgYXJlIGNvcGllZCBpbiBjcnRjIGF0b21pY19jaGVjaygpLCByaWdodApiZWZvcmUgY29s
b3IgbWFuYWdlbWVudCBpcyBjaGVja2VkLgoKQ2hhbmdlcyBzaW5jZSB2MToKLSBDb3B5IGFsbCBi
bG9icyBpbW1lZGlhdGVseSBhZnRlciBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19tb2Rlc2V0KCku
Ci0gQ2xlYXIgY3J0Y19zdGF0ZS0+aHcgb24gZGlzYWJsZSwgaW5zdGVhZCBvZiB1c2luZyBjbGVh
cl9pbnRlbF9jcnRjX3N0YXRlKCkuCkNoYW5nZXMgc2luY2UgdjI6Ci0gVXNlIGludGVsX2NydGNf
ZnJlZV9od19zdGF0ZSArIGNsZWFyIGluIGludGVsX2NydGNfZGlzYWJsZV9ub2F0b21pYygpLgot
IE1ha2UgYSBpbnRlbF9jcnRjX3ByZXBhcmVfc3RhdGUoKSBmdW5jdGlvbiB0aGF0IGNsZWFycyB0
aGUgY3J0Y19zdGF0ZQogIGFuZCBjb3BpZXMgaHcgbWVtYmVycy4KLSBSZW1vdmUgc2V0dGluZyB1
YXBpLmFkanVzdGVkX21vZGUsIHdlIG5vdyBoYXZlIGEgZGlyZWN0IGNhbGwgdG8KICBkcm1fY2Fs
Y190aW1lc3RhbXBpbmdfY29uc3RhbnRzKCkuCkNoYW5nZXMgc2luY2UgdjM6Ci0gUmVuYW1lIHBy
ZWZpeCBjb3B5X2h3X3RvX3VhcGlfc3RhdGUoKSB3aXRoIGludGVsX2NydGMuCi0gQ29weSBjb2xv
ciBibG9icyB0byB1YXBpIGFzIHdlbGwuCi0gQWRkIGEgaW50ZWxfY3J0Y19jb3B5X3VhcGlfdG9f
aHdfc3RhdGVfbm9tb2Rlc2V0KCkgZnVuY3Rpb24gZm9yIGNsYXJpdHkuCkNoYW5nZXMgc2luY2Ug
djQ6Ci0gQ29weSBody5hZGp1c3RlZF9tb2RlIGJhY2sgdG8gdWFwaS5hZGp1c3RlZF9tb2RlLCB0
byBzaHV0IHVwCiAgdGhlIGNhbGwgdG8gZHJtX2NhbGNfdGltZXN0YW1waW5nX2NvbnN0YW50cygp
IGluCiAgZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX2xlZ2FjeV9tb2Rlc2V0X3N0YXRlKCkuCi0g
VXNlIGRybV9wcm9wZXJ0eV9yZXBsYWNlX2Jsb2IgKFZpbGxlKS4KQ2hhbmdlcyBzaW5jZSB2NToK
LSBVc2UgaHctPm1vZGUgaW4gaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKCkuIChWaWxs
ZSkKLSBDb3B5IHRvIHVhcGkubW9kZSB1c2luZyBkcm1fYXRvbWljX3NldF9tb2RlX2Zvcl9jcnRj
KCkuIChWaWxsZSkKClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxh
bmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9hdG9taWMuYyAgIHwgMzEgKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9hdG9taWMuaCAgIHwgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMgIHwgOTAgKysrKysrKysrKysrKysrLS0tLQogLi4uL2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oICAgIHwgIDkgKy0KIDQgZmlsZXMgY2hhbmdl
ZCwgMTA5IGluc2VydGlvbnMoKyksIDIzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCmluZGV4IDQ4OTY0ZjMzYzBjMS4uMzMwMWMxNzhk
YTAzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKQEAg
LTE5NSw2ICsxOTUsMTQgQEAgaW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9j
cnRjICpjcnRjKQogCiAJX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX2R1cGxpY2F0ZV9zdGF0ZShj
cnRjLCAmY3J0Y19zdGF0ZS0+dWFwaSk7CiAKKwkvKiBjb3B5IGNvbG9yIGJsb2JzICovCisJaWYg
KGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQorCQlkcm1fcHJvcGVydHlfYmxvYl9nZXQoY3J0
Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQpOworCWlmIChjcnRjX3N0YXRlLT5ody5jdG0pCisJCWRy
bV9wcm9wZXJ0eV9ibG9iX2dldChjcnRjX3N0YXRlLT5ody5jdG0pOworCWlmIChjcnRjX3N0YXRl
LT5ody5nYW1tYV9sdXQpCisJCWRybV9wcm9wZXJ0eV9ibG9iX2dldChjcnRjX3N0YXRlLT5ody5n
YW1tYV9sdXQpOworCiAJY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgPSBmYWxzZTsKIAljcnRjX3N0
YXRlLT5kaXNhYmxlX2xwX3dtID0gZmFsc2U7CiAJY3J0Y19zdGF0ZS0+ZGlzYWJsZV9jeHNyID0g
ZmFsc2U7CkBAIC0yMDgsNiArMjE2LDI4IEBAIGludGVsX2NydGNfZHVwbGljYXRlX3N0YXRlKHN0
cnVjdCBkcm1fY3J0YyAqY3J0YykKIAlyZXR1cm4gJmNydGNfc3RhdGUtPnVhcGk7CiB9CiAKK3N0
YXRpYyB2b2lkIGludGVsX2NydGNfcHV0X2NvbG9yX2Jsb2JzKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQoreworCWRybV9wcm9wZXJ0eV9ibG9iX3B1dChjcnRjX3N0YXRlLT5o
dy5kZWdhbW1hX2x1dCk7CisJZHJtX3Byb3BlcnR5X2Jsb2JfcHV0KGNydGNfc3RhdGUtPmh3Lmdh
bW1hX2x1dCk7CisJZHJtX3Byb3BlcnR5X2Jsb2JfcHV0KGNydGNfc3RhdGUtPmh3LmN0bSk7Cit9
CisKK3ZvaWQgaW50ZWxfY3J0Y19mcmVlX2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQoreworCWludGVsX2NydGNfcHV0X2NvbG9yX2Jsb2JzKGNydGNfc3RhdGUp
OworfQorCit2b2lkIGludGVsX2NydGNfY29weV9jb2xvcl9ibG9icyhzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlkcm1fcHJvcGVydHlfcmVwbGFjZV9ibG9iKCZjcnRj
X3N0YXRlLT5ody5kZWdhbW1hX2x1dCwKKwkJCQkgIGNydGNfc3RhdGUtPnVhcGkuZGVnYW1tYV9s
dXQpOworCWRybV9wcm9wZXJ0eV9yZXBsYWNlX2Jsb2IoJmNydGNfc3RhdGUtPmh3LmdhbW1hX2x1
dCwKKwkJCQkgIGNydGNfc3RhdGUtPnVhcGkuZ2FtbWFfbHV0KTsKKwlkcm1fcHJvcGVydHlfcmVw
bGFjZV9ibG9iKCZjcnRjX3N0YXRlLT5ody5jdG0sCisJCQkJICBjcnRjX3N0YXRlLT51YXBpLmN0
bSk7Cit9CisKIC8qKgogICogaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlIC0gZGVzdHJveSBjcnRj
IHN0YXRlCiAgKiBAY3J0YzogZHJtIGNydGMKQEAgLTIyMyw2ICsyNTMsNyBAQCBpbnRlbF9jcnRj
X2Rlc3Ryb3lfc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShzdGF0ZSk7CiAKIAlfX2Ry
bV9hdG9taWNfaGVscGVyX2NydGNfZGVzdHJveV9zdGF0ZSgmY3J0Y19zdGF0ZS0+dWFwaSk7CisJ
aW50ZWxfY3J0Y19mcmVlX2h3X3N0YXRlKGNydGNfc3RhdGUpOwogCWtmcmVlKGNydGNfc3RhdGUp
OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0
b21pYy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAppbmRl
eCA0OWQ1Y2IxYjllMGEuLjdiNDk2MjM0MTliYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2F0b21pYy5oCkBAIC0zNiw2ICszNiw4IEBAIGludGVsX2RpZ2l0YWxfY29u
bmVjdG9yX2R1cGxpY2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKTsK
IHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqaW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0
IGRybV9jcnRjICpjcnRjKTsKIHZvaWQgaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlKHN0cnVjdCBk
cm1fY3J0YyAqY3J0YywKIAkJCSAgICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKTsK
K3ZvaWQgaW50ZWxfY3J0Y19mcmVlX2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKTsKK3ZvaWQgaW50ZWxfY3J0Y19jb3B5X2NvbG9yX2Jsb2JzKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICppbnRl
bF9hdG9taWNfc3RhdGVfYWxsb2Moc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiB2b2lkIGludGVs
X2F0b21pY19zdGF0ZV9jbGVhcihzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDRhOWRj
MTRmMmVlMi4uMzczY2JiYmI1N2E0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwpAQCAtNzE4NSw2ICs3MTg1LDggQEAgc3RhdGljIHZvaWQgaW50ZWxf
Y3J0Y19kaXNhYmxlX25vYXRvbWljKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAljcnRjLT5lbmFi
bGVkID0gZmFsc2U7CiAJY3J0Yy0+c3RhdGUtPmNvbm5lY3Rvcl9tYXNrID0gMDsKIAljcnRjLT5z
dGF0ZS0+ZW5jb2Rlcl9tYXNrID0gMDsKKwlpbnRlbF9jcnRjX2ZyZWVfaHdfc3RhdGUoY3J0Y19z
dGF0ZSk7CisJbWVtc2V0KCZjcnRjX3N0YXRlLT5odywgMCwgc2l6ZW9mKGNydGNfc3RhdGUtPmh3
KSk7CiAKIAlmb3JfZWFjaF9lbmNvZGVyX29uX2NydGMoY3J0Yy0+ZGV2LCBjcnRjLCBlbmNvZGVy
KQogCQllbmNvZGVyLT5iYXNlLmNydGMgPSBOVUxMOwpAQCAtMTI1NTcsOCArMTI1NTksNDEgQEAg
c3RhdGljIGJvb2wgY2hlY2tfZGlnaXRhbF9wb3J0X2NvbmZsaWN0cyhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkKIAlyZXR1cm4gcmV0OwogfQogCitzdGF0aWMgdm9pZAoraW50ZWxf
Y3J0Y19jb3B5X3VhcGlfdG9faHdfc3RhdGVfbm9tb2Rlc2V0KHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQoreworCWludGVsX2NydGNfY29weV9jb2xvcl9ibG9icyhjcnRjX3N0
YXRlKTsKK30KKworc3RhdGljIHZvaWQKK2ludGVsX2NydGNfY29weV91YXBpX3RvX2h3X3N0YXRl
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWNydGNfc3RhdGUtPmh3
LmVuYWJsZSA9IGNydGNfc3RhdGUtPnVhcGkuZW5hYmxlOworCWNydGNfc3RhdGUtPmh3LmFjdGl2
ZSA9IGNydGNfc3RhdGUtPnVhcGkuYWN0aXZlOworCWNydGNfc3RhdGUtPmh3Lm1vZGUgPSBjcnRj
X3N0YXRlLT51YXBpLm1vZGU7CisJY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSA9IGNydGNf
c3RhdGUtPnVhcGkuYWRqdXN0ZWRfbW9kZTsKKwlpbnRlbF9jcnRjX2NvcHlfdWFwaV90b19od19z
dGF0ZV9ub21vZGVzZXQoY3J0Y19zdGF0ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGludGVsX2NydGNf
Y29weV9od190b191YXBpX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQoreworCWNydGNfc3RhdGUtPnVhcGkuZW5hYmxlID0gY3J0Y19zdGF0ZS0+aHcuZW5hYmxlOwor
CWNydGNfc3RhdGUtPnVhcGkuYWN0aXZlID0gY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOworCVdBUk5f
T04oZHJtX2F0b21pY19zZXRfbW9kZV9mb3JfY3J0YygmY3J0Y19zdGF0ZS0+dWFwaSwgJmNydGNf
c3RhdGUtPmh3Lm1vZGUpIDwgMCk7CisKKwljcnRjX3N0YXRlLT51YXBpLmFkanVzdGVkX21vZGUg
PSBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOworCisJLyogY29weSBjb2xvciBibG9icyB0
byB1YXBpICovCisJZHJtX3Byb3BlcnR5X3JlcGxhY2VfYmxvYigmY3J0Y19zdGF0ZS0+dWFwaS5k
ZWdhbW1hX2x1dCwKKwkJCQkgIGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KTsKKwlkcm1fcHJv
cGVydHlfcmVwbGFjZV9ibG9iKCZjcnRjX3N0YXRlLT51YXBpLmdhbW1hX2x1dCwKKwkJCQkgIGNy
dGNfc3RhdGUtPmh3LmdhbW1hX2x1dCk7CisJZHJtX3Byb3BlcnR5X3JlcGxhY2VfYmxvYigmY3J0
Y19zdGF0ZS0+dWFwaS5jdG0sCisJCQkJICBjcnRjX3N0YXRlLT5ody5jdG0pOworfQorCiBzdGF0
aWMgaW50Ci1jbGVhcl9pbnRlbF9jcnRjX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQoraW50ZWxfY3J0Y19wcmVwYXJlX2NsZWFyZWRfc3RhdGUoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0KIAkJdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CkBAIC0xMjU2
OCwxMSArMTI2MDMsMTUgQEAgY2xlYXJfaW50ZWxfY3J0Y19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoIXNhdmVkX3N0YXRlKQogCQlyZXR1cm4gLUVOT01F
TTsKIAorCS8qIGZyZWUgdGhlIG9sZCBjcnRjX3N0YXRlLT5odyBtZW1iZXJzICovCisJaW50ZWxf
Y3J0Y19mcmVlX2h3X3N0YXRlKGNydGNfc3RhdGUpOworCiAJLyogRklYTUU6IGJlZm9yZSB0aGUg
c3dpdGNoIHRvIGF0b21pYyBzdGFydGVkLCBhIG5ldyBwaXBlX2NvbmZpZyB3YXMKIAkgKiBremFs
bG9jJ2QuIENvZGUgdGhhdCBkZXBlbmRzIG9uIGFueSBmaWVsZCBiZWluZyB6ZXJvIHNob3VsZCBi
ZQogCSAqIGZpeGVkLCBzbyB0aGF0IHRoZSBjcnRjX3N0YXRlIGNhbiBiZSBzYWZlbHkgZHVwbGlj
YXRlZC4gRm9yIG5vdywKIAkgKiBvbmx5IGZpZWxkcyB0aGF0IGFyZSBrbm93IHRvIG5vdCBjYXVz
ZSBwcm9ibGVtcyBhcmUgcHJlc2VydmVkLiAqLwogCisJc2F2ZWRfc3RhdGUtPnVhcGkgPSBjcnRj
X3N0YXRlLT51YXBpOwogCXNhdmVkX3N0YXRlLT5zY2FsZXJfc3RhdGUgPSBjcnRjX3N0YXRlLT5z
Y2FsZXJfc3RhdGU7CiAJc2F2ZWRfc3RhdGUtPnNoYXJlZF9kcGxsID0gY3J0Y19zdGF0ZS0+c2hh
cmVkX2RwbGw7CiAJc2F2ZWRfc3RhdGUtPmRwbGxfaHdfc3RhdGUgPSBjcnRjX3N0YXRlLT5kcGxs
X2h3X3N0YXRlOwpAQCAtMTI1OTAsMTQgKzEyNjI5LDExIEBAIGNsZWFyX2ludGVsX2NydGNfc3Rh
dGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXNhdmVkX3N0YXRlLT5z
eW5jX21vZGVfc2xhdmVzX21hc2sgPQogCQkJY3J0Y19zdGF0ZS0+c3luY19tb2RlX3NsYXZlc19t
YXNrOwogCi0JLyogS2VlcCBiYXNlIGRybV9jcnRjX3N0YXRlIGludGFjdCwgb25seSBjbGVhciBv
dXIgZXh0ZW5kZWQgc3RydWN0ICovCi0JQlVJTERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlLCBiYXNlKSk7Ci0JQlVJTERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlLCB1YXBpKSk7Ci0JQlVJTERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlLCBodykpOwotCW1lbWNweSgmY3J0Y19zdGF0ZS0+dWFwaSArIDEsICZzYXZl
ZF9zdGF0ZS0+dWFwaSArIDEsCi0JICAgICAgIHNpemVvZigqY3J0Y19zdGF0ZSkgLSBzaXplb2Yo
Y3J0Y19zdGF0ZS0+dWFwaSkpOwotCisJbWVtY3B5KGNydGNfc3RhdGUsIHNhdmVkX3N0YXRlLCBz
aXplb2YoKmNydGNfc3RhdGUpKTsKIAlrZnJlZShzYXZlZF9zdGF0ZSk7CisKKwlpbnRlbF9jcnRj
X2NvcHlfdWFwaV90b19od19zdGF0ZShjcnRjX3N0YXRlKTsKKwogCXJldHVybiAwOwogfQogCkBA
IC0xMjYxMywxMCArMTI2NDksNiBAQCBpbnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIAlpbnQgaTsKIAlib29sIHJldHJ5ID0gdHJ1
ZTsKIAotCXJldCA9IGNsZWFyX2ludGVsX2NydGNfc3RhdGUocGlwZV9jb25maWcpOwotCWlmIChy
ZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIgPQogCQko
ZW51bSB0cmFuc2NvZGVyKSB0b19pbnRlbF9jcnRjKGNydGMpLT5waXBlOwogCkBAIC0xMjc0NCw2
ICsxMjc3NiwxMiBAQCBpbnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpwaXBlX2NvbmZpZykKIAlEUk1fREVCVUdfS01TKCJodyBtYXggYnBwOiAlaSwgcGlw
ZSBicHA6ICVpLCBkaXRoZXJpbmc6ICVpXG4iLAogCQkgICAgICBiYXNlX2JwcCwgcGlwZV9jb25m
aWctPnBpcGVfYnBwLCBwaXBlX2NvbmZpZy0+ZGl0aGVyKTsKIAorCS8qCisJICogTWFrZSBkcm1f
Y2FsY190aW1lc3RhbXBpbmdfY29uc3RhbnRzIGluCisJICogZHJtX2F0b21pY19oZWxwZXJfdXBk
YXRlX2xlZ2FjeV9tb2Rlc2V0X3N0YXRlKCkgaGFwcHkKKwkgKi8KKwlwaXBlX2NvbmZpZy0+dWFw
aS5hZGp1c3RlZF9tb2RlID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CisKIAlyZXR1
cm4gMDsKIH0KIApAQCAtMTM0NzMsNiArMTM1MTEsOCBAQCB2ZXJpZnlfY3J0Y19zdGF0ZShzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCXN0YXRlID0gb2xkX2NydGNfc3RhdGUtPnVhcGkuc3Rh
dGU7CiAJX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX2Rlc3Ryb3lfc3RhdGUoJm9sZF9jcnRjX3N0
YXRlLT51YXBpKTsKKwlpbnRlbF9jcnRjX2ZyZWVfaHdfc3RhdGUob2xkX2NydGNfc3RhdGUpOwor
CiAJcGlwZV9jb25maWcgPSBvbGRfY3J0Y19zdGF0ZTsKIAltZW1zZXQocGlwZV9jb25maWcsIDAs
IHNpemVvZigqcGlwZV9jb25maWcpKTsKIAlwaXBlX2NvbmZpZy0+dWFwaS5jcnRjID0gJmNydGMt
PmJhc2U7CkBAIC0xNDAwNywxNCArMTQwNDcsMjQgQEAgc3RhdGljIGludCBpbnRlbF9hdG9taWNf
Y2hlY2soc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9j
cnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19j
cnRjX3N0YXRlLCBpKSB7Ci0JCWlmICghbmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSkpCisJ
CWlmICghbmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSkpIHsKKwkJCS8qIExpZ2h0IGNvcHkg
Ki8KKwkJCWludGVsX2NydGNfY29weV91YXBpX3RvX2h3X3N0YXRlX25vbW9kZXNldChuZXdfY3J0
Y19zdGF0ZSk7CisKIAkJCWNvbnRpbnVlOworCQl9CiAKIAkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+
dWFwaS5lbmFibGUpIHsKKwkJCWludGVsX2NydGNfY29weV91YXBpX3RvX2h3X3N0YXRlKG5ld19j
cnRjX3N0YXRlKTsKKwogCQkJYW55X21zID0gdHJ1ZTsKIAkJCWNvbnRpbnVlOwogCQl9CiAKKwkJ
cmV0ID0gaW50ZWxfY3J0Y19wcmVwYXJlX2NsZWFyZWRfc3RhdGUobmV3X2NydGNfc3RhdGUpOwor
CQlpZiAocmV0KQorCQkJZ290byBmYWlsOworCiAJCXJldCA9IGludGVsX21vZGVzZXRfcGlwZV9j
b25maWcobmV3X2NydGNfc3RhdGUpOwogCQlpZiAocmV0KQogCQkJZ290byBmYWlsOwpAQCAtMTcy
ODUsNiArMTczMzUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3JlYWRvdXRfaHdfc3Rh
dGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+
YmFzZS5zdGF0ZSk7CiAKIAkJX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX2Rlc3Ryb3lfc3RhdGUo
JmNydGNfc3RhdGUtPnVhcGkpOworCQlpbnRlbF9jcnRjX2ZyZWVfaHdfc3RhdGUoY3J0Y19zdGF0
ZSk7CiAJCW1lbXNldChjcnRjX3N0YXRlLCAwLCBzaXplb2YoKmNydGNfc3RhdGUpKTsKIAkJX19k
cm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZjcnRjLT5iYXNlLCAmY3J0Y19zdGF0ZS0+dWFw
aSk7CiAKQEAgLTE3Mzk2LDE1ICsxNzQ0NywxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0
X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJaW50IG1pbl9jZGNs
ayA9IDA7CiAKIAkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewotCQkJc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgbW9kZTsKKwkJCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJmNy
dGNfc3RhdGUtPmh3Lm1vZGU7CiAKIAkJCWludGVsX21vZGVfZnJvbV9waXBlX2NvbmZpZygmY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSwKIAkJCQkJCSAgICBjcnRjX3N0YXRlKTsKIAotCQkJ
bW9kZSA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7Ci0JCQltb2RlLmhkaXNwbGF5ID0g
Y3J0Y19zdGF0ZS0+cGlwZV9zcmNfdzsKLQkJCW1vZGUudmRpc3BsYXkgPSBjcnRjX3N0YXRlLT5w
aXBlX3NyY19oOwotCQkJV0FSTl9PTihkcm1fYXRvbWljX3NldF9tb2RlX2Zvcl9jcnRjKCZjcnRj
X3N0YXRlLT51YXBpLCAmbW9kZSkpOworCQkJKm1vZGUgPSBjcnRjX3N0YXRlLT5ody5hZGp1c3Rl
ZF9tb2RlOworCQkJbW9kZS0+aGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY193OworCQkJ
bW9kZS0+dmRpc3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY19oOwogCiAJCQkvKgogCQkJICog
VGhlIGluaXRpYWwgbW9kZSBuZWVkcyB0byBiZSBzZXQgaW4gb3JkZXIgdG8ga2VlcApAQCAtMTc0
MTUsMTEgKzE3NDY1LDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19z
dGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQkJICogc2V0IGEgZmxhZyB0byBpbmRpY2F0
ZSB0aGF0IGEgZnVsbCByZWNhbGN1bGF0aW9uIGlzCiAJCQkgKiBuZWVkZWQgb24gdGhlIG5leHQg
Y29tbWl0LgogCQkJICovCi0JCQljcnRjX3N0YXRlLT5ody5tb2RlLnByaXZhdGVfZmxhZ3MgPSBJ
OTE1X01PREVfRkxBR19JTkhFUklURUQ7CisJCQltb2RlLT5wcml2YXRlX2ZsYWdzID0gSTkxNV9N
T0RFX0ZMQUdfSU5IRVJJVEVEOwogCiAJCQlpbnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShj
cnRjX3N0YXRlKTsKIAogCQkJaW50ZWxfY3J0Y191cGRhdGVfYWN0aXZlX3RpbWluZ3MoY3J0Y19z
dGF0ZSk7CisKKwkJCWludGVsX2NydGNfY29weV9od190b191YXBpX3N0YXRlKGNydGNfc3RhdGUp
OwogCQl9CiAKIAkJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYtPmRybSwg
Y3J0YywgcGxhbmUpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggZTg0MzQzZDNiZjhkLi45MzE5Y2E2ODIxMDUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5o
CkBAIC03NTcsOCArNzU3LDYgQEAgZW51bSBpbnRlbF9vdXRwdXRfZm9ybWF0IHsKIH07CiAKIHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlIHsKLQl1bmlvbiB7Ci0Jc3RydWN0IGRybV9jcnRjX3N0YXRl
IGJhc2U7CiAJLyoKIAkgKiB1YXBpIChkcm0pIHN0YXRlLiBUaGlzIGlzIHRoZSBzb2Z0d2FyZSBz
dGF0ZSBzaG93biB0byB1c2Vyc3BhY2UuCiAJICogSW4gcGFydGljdWxhciwgdGhlIGZvbGxvd2lu
ZyBtZW1iZXJzIGFyZSB1c2VkIGZvciBib29ra2VlcGluZzoKQEAgLTc4MSw4ICs3NzksMTEgQEAg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgewogCSAqCiAJICogRHVyaW5nIGluaXRpYWwgaHcgcmVh
ZG91dCwgdGhleSBuZWVkIHRvIGJlIGNvcGllZCB0byB1YXBpLgogCSAqLwotCXN0cnVjdCBkcm1f
Y3J0Y19zdGF0ZSBodzsKLQl9OworCXN0cnVjdCB7CisJCWJvb2wgYWN0aXZlLCBlbmFibGU7CisJ
CXN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZGVnYW1tYV9sdXQsICpnYW1tYV9sdXQsICpjdG07
CisJCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlIG1vZGUsIGFkanVzdGVkX21vZGU7CisJfSBodzsK
IAogCS8qKgogCSAqIHF1aXJrcyAtIGJpdGZpZWxkIHdpdGggaHcgc3RhdGUgcmVhZG91dCBxdWly
a3MKLS0gCjIuMjQuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

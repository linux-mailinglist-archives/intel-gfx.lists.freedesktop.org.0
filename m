Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D28DF331A5
	for <lists+intel-gfx@lfdr.de>; Mon,  3 Jun 2019 16:02:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8619789173;
	Mon,  3 Jun 2019 14:02:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 65ABD88FE2
 for <intel-gfx@lists.freedesktop.org>; Mon,  3 Jun 2019 14:02:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16775787-1500050 
 for multiple; Mon, 03 Jun 2019 14:59:15 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  3 Jun 2019 14:59:03 +0100
Message-Id: <20190603135910.15979-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190603135910.15979-1-chris@chris-wilson.co.uk>
References: <20190603135910.15979-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/15] drm/i915: Keep contexts pinned until
 after the next kernel context switch
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgbmVlZCB0byBrZWVwIHRoZSBjb250ZXh0IGltYWdlIHBpbm5lZCBpbiBtZW1vcnkgdW50aWwg
YWZ0ZXIgdGhlIEdQVQpoYXMgZmluaXNoZWQgd3JpdGluZyBpbnRvIGl0LiBTaW5jZSBpdCBjb250
aW51ZXMgdG8gd3JpdGUgYXMgd2Ugc2lnbmFsCnRoZSBmaW5hbCBicmVhZGNydW1iLCB3ZSBuZWVk
IHRvIGtlZXAgaXQgcGlubmVkIHVudGlsIHRoZSByZXF1ZXN0IGFmdGVyCml0IGlzIGNvbXBsZXRl
LiBDdXJyZW50bHkgd2Uga25vdyB0aGUgb3JkZXIgaW4gd2hpY2ggcmVxdWVzdHMgZXhlY3V0ZSBv
bgplYWNoIGVuZ2luZSwgYW5kIHNvIHRvIHJlbW92ZSB0aGF0IHByZXN1bXB0aW9uIHdlIG5lZWQg
dG8gaWRlbnRpZnkgYQpyZXF1ZXN0L2NvbnRleHQtc3dpdGNoIHdlIGtub3cgbXVzdCBvY2N1ciBh
ZnRlciBvdXIgY29tcGxldGlvbi4gQW55CnJlcXVlc3QgcXVldWVkIGFmdGVyIHRoZSBzaWduYWwg
bXVzdCBpbXBseSBhIGNvbnRleHQgc3dpdGNoLCBmb3IKc2ltcGxpY2l0eSB3ZSB1c2UgYSBmcmVz
aCByZXF1ZXN0IGZyb20gdGhlIGtlcm5lbCBjb250ZXh0LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMg
V2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwgMjQgKystLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oICAgfCAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fcG0uYyAgICAgICAgfCAyMCArKysrLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAgIHwgODAgKysrKysrKysrKysrKysrLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmggICAgICAgfCAgMyArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5cGVzLmggfCAgNiArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmggICAgICAgIHwgIDIgLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgMjMgKy0tLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyAgICAgfCAgMiArCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCAgfCAxMyArLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8IDYyICsrLS0tLS0tLS0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCA0NCArLS0tLS0tLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jICAgICAgICAgfCAxMSArLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8IDgxICsrKysr
KysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmggICAgICAg
ICAgICB8ICA1ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oICAg
ICAgfCAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAg
fCAgNCAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICAgICAgfCAx
NSAtLS0tCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAg
MSAtCiAxOSBmaWxlcyBjaGFuZ2VkLCAyMTUgaW5zZXJ0aW9ucygrKSwgMTg1IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGZi
MDNhMTk5MzJjZi4uMTE2ZjBlNTUzMDhlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMKQEAgLTY4NiwxNyArNjg2LDYgQEAgaW50IGk5MTVfZ2VtX2NvbnRl
eHRzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiAwOwog
fQogCi12b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2xvc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQotewotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQllbnVtIGlu
dGVsX2VuZ2luZV9pZCBpZDsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0u
c3RydWN0X211dGV4KTsKLQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkK
LQkJaW50ZWxfZW5naW5lX2xvc3RfY29udGV4dChlbmdpbmUpOwotfQotCiB2b2lkIGk5MTVfZ2Vt
X2NvbnRleHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJbG9ja2Rl
cF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CkBAIC0xMTgxLDEwICsxMTcw
LDYgQEAgZ2VuOF9tb2RpZnlfcnBjcyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBp
bnRlbF9zc2V1IHNzZXUpCiAJaWYgKHJldCkKIAkJZ290byBvdXRfYWRkOwogCi0JcmV0ID0gZ2Vu
OF9lbWl0X3JwY3NfY29uZmlnKHJxLCBjZSwgc3NldSk7Ci0JaWYgKHJldCkKLQkJZ290byBvdXRf
YWRkOwotCiAJLyoKIAkgKiBHdWFyYW50ZWUgY29udGV4dCBpbWFnZSBhbmQgdGhlIHRpbWVsaW5l
IHJlbWFpbnMgcGlubmVkIHVudGlsIHRoZQogCSAqIG1vZGlmeWluZyByZXF1ZXN0IGlzIHJldGly
ZWQgYnkgc2V0dGluZyB0aGUgY2UgYWN0aXZpdHkgdHJhY2tlci4KQEAgLTExOTIsOSArMTE3Nywx
MiBAQCBnZW44X21vZGlmeV9ycGNzKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGlu
dGVsX3NzZXUgc3NldSkKIAkgKiBCdXQgd2Ugb25seSBuZWVkIHRvIHRha2Ugb25lIHBpbiBvbiB0
aGUgYWNjb3VudCBvZiBpdC4gT3IgaW4gb3RoZXIKIAkgKiB3b3JkcyB0cmFuc2ZlciB0aGUgcGlu
bmVkIGNlIG9iamVjdCB0byB0cmFja2VkIGFjdGl2ZSByZXF1ZXN0LgogCSAqLwotCWlmICghaTkx
NV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmY2UtPmFjdGl2ZV90cmFja2VyKSkKLQkJX19pbnRlbF9j
b250ZXh0X3BpbihjZSk7Ci0JX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmY2UtPmFjdGl2ZV90
cmFja2VyLCBycSk7CisJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9pc19pZGxlKCZjZS0+YWN0aXZl
KSk7CisJcmV0ID0gaTkxNV9hY3RpdmVfcmVmKCZjZS0+YWN0aXZlLCBycS0+ZmVuY2UuY29udGV4
dCwgcnEpOworCWlmIChyZXQpCisJCWdvdG8gb3V0X2FkZDsKKworCXJldCA9IGdlbjhfZW1pdF9y
cGNzX2NvbmZpZyhycSwgY2UsIHNzZXUpOwogCiBvdXRfYWRkOgogCWk5MTVfcmVxdWVzdF9hZGQo
cnEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKaW5kZXgg
NjMwMzkyYzc3ZTQ4Li45NjkxZGQwNjJmNzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2NvbnRleHQuaApAQCAtMTM0LDcgKzEzNCw2IEBAIHN0YXRpYyBpbmxpbmUgYm9v
bCBpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
KQogCiAvKiBpOTE1X2dlbV9jb250ZXh0LmMgKi8KIGludCBfX211c3RfY2hlY2sgaTkxNV9nZW1f
Y29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBp
OTE1X2dlbV9jb250ZXh0c19sb3N0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7
CiB2b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KTsKIAogaW50IGk5MTVfZ2VtX2NvbnRleHRfb3BlbihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggZjQw
ZjEzYzBiOGI3Li41OWI2ZDQ1YjE5MzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jCkBAIC0xMCw2ICsxMCwyMiBAQAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVk
ZSAiaTkxNV9nbG9iYWxzLmgiCiAKK3N0YXRpYyB2b2lkIGNhbGxfaWRsZV9iYXJyaWVycyhzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJc3RydWN0IGxsaXN0X25vZGUgKm5vZGUs
ICpuZXh0OworCisJbGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0LCBsbGlzdF9kZWxfYWxs
KCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKSB7CisJCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0
ICphY3RpdmUgPQorCQkJY29udGFpbmVyX29mKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwKKwkJ
CQkgICAgIHR5cGVvZigqYWN0aXZlKSwgbGluayk7CisKKwkJSU5JVF9MSVNUX0hFQUQoJmFjdGl2
ZS0+bGluayk7CisJCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKKwor
CQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIE5VTEwpOworCX0KK30KKwogc3RhdGljIHZvaWQgaTkx
NV9nZW1fcGFyayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmU7CkBAIC0xNyw4ICszMywxMCBAQCBzdGF0aWMgdm9pZCBpOTE1
X2dlbV9wYXJrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBpOTE1LCBpZCkKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCQlj
YWxsX2lkbGVfYmFycmllcnMoZW5naW5lKTsgLyogY2xlYW51cCBhZnRlciB3ZWRnaW5nICovCiAJ
CWk5MTVfZ2VtX2JhdGNoX3Bvb2xfZmluaSgmZW5naW5lLT5iYXRjaF9wb29sKTsKKwl9CiAKIAlp
OTE1X3RpbWVsaW5lc19wYXJrKGk5MTUpOwogCWk5MTVfdm1hX3BhcmtlZChpOTE1KTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCA3ZTJiMThkZGRhMTkuLjAxMDJm
NmJiNjJlYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpAQCAtNjEs
NyArNjEsNiBAQCBpbnQgX19pbnRlbF9jb250ZXh0X2RvX3BpbihzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UpCiAKIAkJaTkxNV9nZW1fY29udGV4dF9nZXQoY2UtPmdlbV9jb250ZXh0KTsgLyogZm9y
IGN0eC0+cHBndHQgKi8KIAotCQlpbnRlbF9jb250ZXh0X2dldChjZSk7CiAJCXNtcF9tYl9fYmVm
b3JlX2F0b21pYygpOyAvKiBmbHVzaCBwaW4gYmVmb3JlIGl0IGlzIHZpc2libGUgKi8KIAl9CiAK
QEAgLTg5LDIwICs4OCw0NSBAQCB2b2lkIGludGVsX2NvbnRleHRfdW5waW4oc3RydWN0IGludGVs
X2NvbnRleHQgKmNlKQogCQljZS0+b3BzLT51bnBpbihjZSk7CiAKIAkJaTkxNV9nZW1fY29udGV4
dF9wdXQoY2UtPmdlbV9jb250ZXh0KTsKLQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlpbnRl
bF9jb250ZXh0X2luYWN0aXZlKGNlKTsKIAl9CiAKIAltdXRleF91bmxvY2soJmNlLT5waW5fbXV0
ZXgpOwogCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfY29u
dGV4dF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCQkgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCitzdGF0aWMgaW50IF9fY29udGV4dF9waW5fc3RhdGUoc3Ry
dWN0IGk5MTVfdm1hICp2bWEsIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCiB7Ci0Jc3RydWN0IGludGVs
X2NvbnRleHQgKmNlID0KLQkJY29udGFpbmVyX29mKGFjdGl2ZSwgdHlwZW9mKCpjZSksIGFjdGl2
ZV90cmFja2VyKTsKKwlpbnQgZXJyOwogCi0JaW50ZWxfY29udGV4dF91bnBpbihjZSk7CisJZXJy
ID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgZmxhZ3MgfCBQSU5fR0xPQkFMKTsKKwlpZiAoZXJy
KQorCQlyZXR1cm4gZXJyOworCisJLyoKKwkgKiBBbmQgbWFyayBpdCBhcyBhIGdsb2JhbGx5IHBp
bm5lZCBvYmplY3QgdG8gbGV0IHRoZSBzaHJpbmtlciBrbm93CisJICogaXQgY2Fubm90IHJlY2xh
aW0gdGhlIG9iamVjdCB1bnRpbCB3ZSByZWxlYXNlIGl0LgorCSAqLworCXZtYS0+b2JqLT5waW5f
Z2xvYmFsKys7CisJdm1hLT5vYmotPm1tLmRpcnR5ID0gdHJ1ZTsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgdm9pZCBfX2NvbnRleHRfdW5waW5fc3RhdGUoc3RydWN0IGk5MTVfdm1hICp2bWEp
Cit7CisJdm1hLT5vYmotPnBpbl9nbG9iYWwtLTsKKwlfX2k5MTVfdm1hX3VucGluKHZtYSk7Cit9
CisKK3N0YXRpYyB2b2lkIGludGVsX2NvbnRleHRfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAq
YWN0aXZlKQoreworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGNvbnRhaW5lcl9vZihhY3Rp
dmUsIHR5cGVvZigqY2UpLCBhY3RpdmUpOworCisJaWYgKGNlLT5zdGF0ZSkKKwkJX19jb250ZXh0
X3VucGluX3N0YXRlKGNlLT5zdGF0ZSk7CisKKwlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiB9CiAK
IHZvaWQKQEAgLTEyNCw4ICsxNDgsNDYgQEAgaW50ZWxfY29udGV4dF9pbml0KHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSwKIAogCW11dGV4X2luaXQoJmNlLT5waW5fbXV0ZXgpOwogCi0JaTkxNV9h
Y3RpdmVfcmVxdWVzdF9pbml0KCZjZS0+YWN0aXZlX3RyYWNrZXIsCi0JCQkJIE5VTEwsIGludGVs
X2NvbnRleHRfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KGN0eC0+aTkxNSwgJmNlLT5hY3Rp
dmUsIGludGVsX2NvbnRleHRfcmV0aXJlKTsKK30KKworaW50IGludGVsX2NvbnRleHRfYWN0aXZl
KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdW5zaWduZWQgbG9uZyBmbGFncykKK3sKKwlpbnQg
ZXJyOworCisJaWYgKCFpOTE1X2FjdGl2ZV9hY3F1aXJlKCZjZS0+YWN0aXZlKSkKKwkJcmV0dXJu
IDA7CisKKwlpbnRlbF9jb250ZXh0X2dldChjZSk7CisKKwlpZiAoIWNlLT5zdGF0ZSkKKwkJcmV0
dXJuIDA7CisKKwllcnIgPSBfX2NvbnRleHRfcGluX3N0YXRlKGNlLT5zdGF0ZSwgZmxhZ3MpOwor
CWlmIChlcnIpIHsKKwkJaTkxNV9hY3RpdmVfY2FuY2VsKCZjZS0+YWN0aXZlKTsKKwkJaW50ZWxf
Y29udGV4dF9wdXQoY2UpOworCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFByZWFsbG9jYXRlIHRy
YWNraW5nIG5vZGVzICovCisJaWYgKCFpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjZS0+Z2Vt
X2NvbnRleHQpKSB7CisJCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmVfcHJlYWxsb2NhdGVfYmFy
cmllcigmY2UtPmFjdGl2ZSwKKwkJCQkJCQkgICAgICBjZS0+ZW5naW5lKTsKKwkJaWYgKGVycikg
eworCQkJaTkxNV9hY3RpdmVfcmVsZWFzZSgmY2UtPmFjdGl2ZSk7CisJCQlyZXR1cm4gZXJyOwor
CQl9CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgaW50ZWxfY29udGV4dF9pbmFjdGl2ZShz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJLyogTm9kZXMgcHJlYWxsb2NhdGVkIGluIGlu
dGVsX2NvbnRleHRfYWN0aXZlKCkgKi8KKwlpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIoJmNl
LT5hY3RpdmUpOworCWk5MTVfYWN0aXZlX3JlbGVhc2UoJmNlLT5hY3RpdmUpOwogfQogCiBzdGF0
aWMgdm9pZCBpOTE1X2dsb2JhbF9jb250ZXh0X3Nocmluayh2b2lkKQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5oCmluZGV4IDYzMzkyYzg4Y2Q5OC4uZTcxNjI5ZjdjMmUwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCkBAIC0xMDIsNiArMTAyLDkg
QEAgc3RhdGljIGlubGluZSB2b2lkIGludGVsX2NvbnRleHRfZXhpdChzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UpCiAJCWNlLT5vcHMtPmV4aXQoY2UpOwogfQogCitpbnQgaW50ZWxfY29udGV4dF9h
Y3RpdmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB1bnNpZ25lZCBsb25nIGZsYWdzKTsKK3Zv
aWQgaW50ZWxfY29udGV4dF9pbmFjdGl2ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpOworCiBz
dGF0aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9jb250ZXh0ICppbnRlbF9jb250ZXh0X2dldChzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7CiAJa3JlZl9nZXQoJmNlLT5yZWYpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oCmluZGV4IGU0N2Q1YjdhZjVk
NC4uMDgwNDllZTkxY2VlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29u
dGV4dF90eXBlcy5oCkBAIC01NCwxMCArNTQsMTAgQEAgc3RydWN0IGludGVsX2NvbnRleHQgewog
CXN0cnVjdCBtdXRleCBwaW5fbXV0ZXg7IC8qIGd1YXJkcyBwaW5uaW5nIGFuZCBhc3NvY2lhdGVk
IG9uLWdwdWluZyAqLwogCiAJLyoqCi0JICogYWN0aXZlX3RyYWNrZXI6IEFjdGl2ZSB0cmFja2Vy
IGZvciB0aGUgZXh0ZXJuYWwgcnEgYWN0aXZpdHkKLQkgKiBvbiB0aGlzIGludGVsX2NvbnRleHQg
b2JqZWN0LgorCSAqIGFjdGl2ZTogQWN0aXZlIHRyYWNrZXIgZm9yIHRoZSBycSBhY3Rpdml0eSAo
aW5jLiBleHRlcm5hbCkgb24gdGhpcworCSAqIGludGVsX2NvbnRleHQgb2JqZWN0LgogCSAqLwot
CXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGFjdGl2ZV90cmFja2VyOworCXN0cnVjdCBpOTE1
X2FjdGl2ZSBhY3RpdmU7CiAKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dF9vcHMgKm9wczsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaAppbmRleCAxYzBkYjE1MWYwYjEu
LmZlOTQ1NGZhYWM3MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKQEAg
LTQ0OCw4ICs0NDgsNiBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZW5naW5lX3Jlc2V0KHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIGJvb2wgaW50ZWxfZW5naW5lX2lzX2lkbGUo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIGJvb2wgaW50ZWxfZW5naW5lc19hcmVf
aWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogCi12b2lkIGludGVsX2Vu
Z2luZV9sb3N0X2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKLQogdm9p
ZCBpbnRlbF9lbmdpbmVzX3Jlc2V0X2RlZmF1bHRfc3VibWlzc2lvbihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSk7CiB1bnNpZ25lZCBpbnQgaW50ZWxfZW5naW5lc19oYXNfY29udGV4dF9p
c29sYXRpb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IDZiODM4OTQ4YmEyNC4uOThiMjE3NjIx
NDc1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3Mu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtNjEx
LDYgKzYxMSw4IEBAIHN0YXRpYyBpbnQgaW50ZWxfZW5naW5lX3NldHVwX2NvbW1vbihzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJaW50IGVycjsKIAorCWluaXRfbGxpc3RfaGVh
ZCgmZW5naW5lLT5iYXJyaWVyX3Rhc2tzKTsKKwogCWVyciA9IGluaXRfc3RhdHVzX3BhZ2UoZW5n
aW5lKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwpAQCAtODcwLDYgKzg3Miw3IEBAIHZvaWQg
aW50ZWxfZW5naW5lX2NsZWFudXBfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKIAlpZiAoZW5naW5lLT5wcmVlbXB0X2NvbnRleHQpCiAJCWludGVsX2NvbnRleHRfdW5waW4o
ZW5naW5lLT5wcmVlbXB0X2NvbnRleHQpOwogCWludGVsX2NvbnRleHRfdW5waW4oZW5naW5lLT5r
ZXJuZWxfY29udGV4dCk7CisJR0VNX0JVR19PTighbGxpc3RfZW1wdHkoJmVuZ2luZS0+YmFycmll
cl90YXNrcykpOwogCiAJaTkxNV90aW1lbGluZV9maW5pKCZlbmdpbmUtPnRpbWVsaW5lKTsKIApA
QCAtMTIwMCwyNiArMTIwMyw2IEBAIHZvaWQgaW50ZWxfZW5naW5lc19yZXNldF9kZWZhdWx0X3N1
Ym1pc3Npb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCWVuZ2luZS0+c2V0X2Rl
ZmF1bHRfc3VibWlzc2lvbihlbmdpbmUpOwogfQogCi0vKioKLSAqIGludGVsX2VuZ2luZV9sb3N0
X2NvbnRleHQ6IGNhbGxlZCB3aGVuIHRoZSBHUFUgaXMgcmVzZXQgaW50byB1bmtub3duIHN0YXRl
Ci0gKiBAZW5naW5lOiB0aGUgZW5naW5lCi0gKgotICogV2UgaGF2ZSBlaXRoZXIgcmVzZXQgdGhl
IEdQVSBvciBvdGhlcndpc2UgYWJvdXQgdG8gbG9zZSBzdGF0ZSB0cmFja2luZyBvZgotICogdGhl
IGN1cnJlbnQgR1BVIGxvZ2ljYWwgc3RhdGUgKGUuZy4gc3VzcGVuZCkuIE9uIG5leHQgdXNlLCBp
dCBpcyB0aGVyZWZvcmUKLSAqIGltcGVyYXRpdmUgdGhhdCB3ZSBtYWtlIG5vIHByZXN1bXB0aW9u
cyBhYm91dCB0aGUgY3VycmVudCBzdGF0ZSBhbmQgbG9hZAotICogZnJvbSBzY3JhdGNoLgotICov
Ci12b2lkIGludGVsX2VuZ2luZV9sb3N0X2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQotewotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKLQotCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQljZSA9IGZldGNoX2Fu
ZF96ZXJvKCZlbmdpbmUtPmxhc3RfcmV0aXJlZF9jb250ZXh0KTsKLQlpZiAoY2UpCi0JCWludGVs
X2NvbnRleHRfdW5waW4oY2UpOwotfQotCiBib29sIGludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdv
cmQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN3aXRjaCAoSU5URUxfR0VO
KGVuZ2luZS0+aTkxNSkpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bt
LmMKaW5kZXggN2JmZmEwYzZmNWEyLi4yNTI4NzE0MGZiNjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCkBAIC04OCw2ICs4OCw4IEBAIHN0YXRpYyBib29sIHN3
aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAK
IAkvKiBDaGVjayBhZ2FpbiBvbiB0aGUgbmV4dCByZXRpcmVtZW50LiAqLwogCWVuZ2luZS0+d2Fr
ZXJlZl9zZXJpYWwgPSBlbmdpbmUtPnNlcmlhbCArIDE7CisKKwlpOTE1X3JlcXVlc3RfYWRkX2Jh
cnJpZXJzKHJxKTsKIAlfX2k5MTVfcmVxdWVzdF9jb21taXQocnEpOwogCiAJcmV0dXJuIGZhbHNl
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVz
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRleCBk
MmRmZjkwNTZlYTAuLjUyZjQ5ODdhNTdlNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3R5cGVzLmgKQEAgLTExLDYgKzExLDcgQEAKICNpbmNsdWRlIDxsaW51eC9p
cnFfd29yay5oPgogI2luY2x1ZGUgPGxpbnV4L2tyZWYuaD4KICNpbmNsdWRlIDxsaW51eC9saXN0
Lmg+CisjaW5jbHVkZSA8bGludXgvbGxpc3QuaD4KICNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgog
CiAjaW5jbHVkZSAiaTkxNV9nZW0uaCIKQEAgLTI4OCw2ICsyODksNyBAQCBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzIHsKIAlzdHJ1Y3QgaW50ZWxfcmluZyAqYnVmZmVyOwogCiAJc3RydWN0IGk5MTVf
dGltZWxpbmUgdGltZWxpbmU7CisJc3RydWN0IGxsaXN0X2hlYWQgYmFycmllcl90YXNrczsKIAog
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICprZXJuZWxfY29udGV4dDsgLyogcGlubmVkICovCiAJc3Ry
dWN0IGludGVsX2NvbnRleHQgKnByZWVtcHRfY29udGV4dDsgLyogcGlubmVkOyBvcHRpb25hbCAq
LwpAQCAtNDM3LDE3ICs0MzksNiBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAogCXN0cnVj
dCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzIGV4ZWNsaXN0czsKIAotCS8qIENvbnRleHRzIGFyZSBw
aW5uZWQgd2hpbHN0IHRoZXkgYXJlIGFjdGl2ZSBvbiB0aGUgR1BVLiBUaGUgbGFzdAotCSAqIGNv
bnRleHQgZXhlY3V0ZWQgcmVtYWlucyBhY3RpdmUgd2hpbHN0IHRoZSBHUFUgaXMgaWRsZSAtIHRo
ZQotCSAqIHN3aXRjaCBhd2F5IGFuZCB3cml0ZSB0byB0aGUgY29udGV4dCBvYmplY3Qgb25seSBv
Y2N1cnMgb24gdGhlCi0JICogbmV4dCBleGVjdXRpb24uICBDb250ZXh0cyBhcmUgb25seSB1bnBp
bm5lZCBvbiByZXRpcmVtZW50IG9mIHRoZQotCSAqIGZvbGxvd2luZyByZXF1ZXN0IGVuc3VyaW5n
IHRoYXQgd2UgY2FuIGFsd2F5cyB3cml0ZSB0byB0aGUgb2JqZWN0Ci0JICogb24gdGhlIGNvbnRl
eHQgc3dpdGNoIGV2ZW4gYWZ0ZXIgaWRsaW5nLiBBY3Jvc3Mgc3VzcGVuZCwgd2Ugc3dpdGNoCi0J
ICogdG8gdGhlIGtlcm5lbCBjb250ZXh0IGFuZCB0cmFzaCBpdCBhcyB0aGUgc2F2ZSBtYXkgbm90
IGhhcHBlbgotCSAqIGJlZm9yZSB0aGUgaGFyZHdhcmUgaXMgcG93ZXJlZCBkb3duLgotCSAqLwot
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpsYXN0X3JldGlyZWRfY29udGV4dDsKLQogCS8qIHN0YXR1
c19ub3RpZmllcjogbGlzdCBvZiBjYWxsYmFja3MgZm9yIGNvbnRleHQtc3dpdGNoIGNoYW5nZXMg
Ki8KIAlzdHJ1Y3QgYXRvbWljX25vdGlmaWVyX2hlYWQgY29udGV4dF9zdGF0dXNfbm90aWZpZXI7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggOWJhMTRmYTdiN2ZiLi45ZjE1
NzA0NjZmOWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0xNDIyLDYwICsx
NDIyLDExIEBAIHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19jb250ZXh0X2Rlc3Ryb3koc3RydWN0IGty
ZWYgKmtyZWYpCiAJaW50ZWxfY29udGV4dF9mcmVlKGNlKTsKIH0KIAotc3RhdGljIGludCBfX2Nv
bnRleHRfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQotewotCXVuc2lnbmVkIGludCBmbGFnczsK
LQlpbnQgZXJyOwotCi0JZmxhZ3MgPSBQSU5fR0xPQkFMIHwgUElOX0hJR0g7Ci0JZmxhZ3MgfD0g
UElOX09GRlNFVF9CSUFTIHwgaTkxNV9nZ3R0X3Bpbl9iaWFzKHZtYSk7Ci0KLQllcnIgPSBpOTE1
X3ZtYV9waW4odm1hLCAwLCAwLCBmbGFncyk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQot
CXZtYS0+b2JqLT5waW5fZ2xvYmFsKys7Ci0Jdm1hLT5vYmotPm1tLmRpcnR5ID0gdHJ1ZTsKLQot
CXJldHVybiAwOwotfQotCi1zdGF0aWMgdm9pZCBfX2NvbnRleHRfdW5waW4oc3RydWN0IGk5MTVf
dm1hICp2bWEpCi17Ci0Jdm1hLT5vYmotPnBpbl9nbG9iYWwtLTsKLQlfX2k5MTVfdm1hX3VucGlu
KHZtYSk7Ci19Ci0KIHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19jb250ZXh0X3VucGluKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0K
LQkvKgotCSAqIFRoZSB0YXNrbGV0IG1heSBzdGlsbCBiZSB1c2luZyBhIHBvaW50ZXIgdG8gb3Vy
IHN0YXRlLCB2aWEgYW4KLQkgKiBvbGQgcmVxdWVzdC4gSG93ZXZlciwgc2luY2Ugd2Uga25vdyB3
ZSBvbmx5IHVucGluIHRoZSBjb250ZXh0Ci0JICogb24gcmV0aXJlbWVudCBvZiB0aGUgZm9sbG93
aW5nIHJlcXVlc3QsIHdlIGtub3cgdGhhdCB0aGUgbGFzdAotCSAqIHJlcXVlc3QgcmVmZXJlbmNp
bmcgdXMgd2lsbCBoYXZlIGhhZCBhIGNvbXBsZXRpb24gQ1MgaW50ZXJydXB0LgotCSAqIElmIHdl
IHNlZSB0aGF0IGl0IGlzIHN0aWxsIGFjdGl2ZSwgaXQgbWVhbnMgdGhhdCB0aGUgdGFza2xldCBo
YXNuJ3QKLQkgKiBoYWQgdGhlIGNoYW5jZSB0byBydW4geWV0OyBsZXQgaXQgcnVuIGJlZm9yZSB3
ZSB0ZWFyZG93biB0aGUKLQkgKiByZWZlcmVuY2UgaXQgbWF5IHVzZS4KLQkgKi8KLQllbmdpbmUg
PSBSRUFEX09OQ0UoY2UtPmluZmxpZ2h0KTsKLQlpZiAodW5saWtlbHkoZW5naW5lKSkgewotCQl1
bnNpZ25lZCBsb25nIGZsYWdzOwotCi0JCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPnRpbWVs
aW5lLmxvY2ssIGZsYWdzKTsKLQkJcHJvY2Vzc19jc2IoZW5naW5lKTsKLQkJc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7Ci0KLQkJR0VNX0JVR19P
TihSRUFEX09OQ0UoY2UtPmluZmxpZ2h0KSk7Ci0JfQotCiAJaTkxNV9nZW1fY29udGV4dF91bnBp
bl9od19pZChjZS0+Z2VtX2NvbnRleHQpOwotCi0JaW50ZWxfcmluZ191bnBpbihjZS0+cmluZyk7
Ci0KIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGNlLT5zdGF0ZS0+b2JqKTsKLQlfX2NvbnRl
eHRfdW5waW4oY2UtPnN0YXRlKTsKKwlpbnRlbF9yaW5nX3VucGluKGNlLT5yaW5nKTsKIH0KIAog
c3RhdGljIHZvaWQKQEAgLTE1MTIsNyArMTQ2MywxMCBAQCBfX2V4ZWNsaXN0c19jb250ZXh0X3Bp
bihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCWdvdG8gZXJyOwogCUdFTV9CVUdfT04oIWNl
LT5zdGF0ZSk7CiAKLQlyZXQgPSBfX2NvbnRleHRfcGluKGNlLT5zdGF0ZSk7CisJcmV0ID0gaW50
ZWxfY29udGV4dF9hY3RpdmUoY2UsCisJCQkJICAgZW5naW5lLT5pOTE1LT5nZ3R0LnBpbl9iaWFz
IHwKKwkJCQkgICBQSU5fT0ZGU0VUX0JJQVMgfAorCQkJCSAgIFBJTl9ISUdIKTsKIAlpZiAocmV0
KQogCQlnb3RvIGVycjsKIApAQCAtMTUyMSw3ICsxNDc1LDcgQEAgX19leGVjbGlzdHNfY29udGV4
dF9waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJCQlJOTE1X01BUF9PVkVSUklERSk7
CiAJaWYgKElTX0VSUih2YWRkcikpIHsKIAkJcmV0ID0gUFRSX0VSUih2YWRkcik7Ci0JCWdvdG8g
dW5waW5fdm1hOworCQlnb3RvIHVucGluX2FjdGl2ZTsKIAl9CiAKIAlyZXQgPSBpbnRlbF9yaW5n
X3BpbihjZS0+cmluZyk7CkBAIC0xNTQyLDggKzE0OTYsOCBAQCBfX2V4ZWNsaXN0c19jb250ZXh0
X3BpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJaW50ZWxfcmluZ191bnBpbihjZS0+cmlu
Zyk7CiB1bnBpbl9tYXA6CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChjZS0+c3RhdGUtPm9i
aik7Ci11bnBpbl92bWE6Ci0JX19jb250ZXh0X3VucGluKGNlLT5zdGF0ZSk7Cit1bnBpbl9hY3Rp
dmU6CisJaW50ZWxfY29udGV4dF9pbmFjdGl2ZShjZSk7CiBlcnI6CiAJcmV0dXJuIHJldDsKIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCBmZjU4ZDY1
OGUzZTIuLmZjNTk2YWRjNjM3YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jp
bmdidWZmZXIuYwpAQCAtMTM0OSw0NSArMTM0OSw5IEBAIHN0YXRpYyB2b2lkIF9fY29udGV4dF91
bnBpbl9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCQlnZW42X3BwZ3R0X3Vu
cGluKHBwZ3R0KTsKIH0KIAotc3RhdGljIGludCBfX2NvbnRleHRfcGluKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSkKLXsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlpbnQgZXJyOwotCi0Jdm1h
ID0gY2UtPnN0YXRlOwotCWlmICghdm1hKQotCQlyZXR1cm4gMDsKLQotCWVyciA9IGk5MTVfdm1h
X3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwgfCBQSU5fSElHSCk7Ci0JaWYgKGVycikKLQkJcmV0
dXJuIGVycjsKLQotCS8qCi0JICogQW5kIG1hcmsgaXMgYXMgYSBnbG9iYWxseSBwaW5uZWQgb2Jq
ZWN0IHRvIGxldCB0aGUgc2hyaW5rZXIga25vdwotCSAqIGl0IGNhbm5vdCByZWNsYWltIHRoZSBv
YmplY3QgdW50aWwgd2UgcmVsZWFzZSBpdC4KLQkgKi8KLQl2bWEtPm9iai0+cGluX2dsb2JhbCsr
OwotCXZtYS0+b2JqLT5tbS5kaXJ0eSA9IHRydWU7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGlj
IHZvaWQgX19jb250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKLXsKLQlzdHJ1
Y3QgaTkxNV92bWEgKnZtYTsKLQotCXZtYSA9IGNlLT5zdGF0ZTsKLQlpZiAoIXZtYSkKLQkJcmV0
dXJuOwotCi0Jdm1hLT5vYmotPnBpbl9nbG9iYWwtLTsKLQlpOTE1X3ZtYV91bnBpbih2bWEpOwot
fQotCiBzdGF0aWMgdm9pZCByaW5nX2NvbnRleHRfdW5waW4oc3RydWN0IGludGVsX2NvbnRleHQg
KmNlKQogewogCV9fY29udGV4dF91bnBpbl9wcGd0dChjZS0+Z2VtX2NvbnRleHQpOwotCV9fY29u
dGV4dF91bnBpbihjZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKgpAQCAtMTQ3Nywx
OCArMTQ0MSwxOCBAQCBzdGF0aWMgaW50IHJpbmdfY29udGV4dF9waW4oc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlKQogCQljZS0+c3RhdGUgPSB2bWE7CiAJfQogCi0JZXJyID0gX19jb250ZXh0X3Bp
bihjZSk7CisJZXJyID0gaW50ZWxfY29udGV4dF9hY3RpdmUoY2UsIFBJTl9ISUdIKTsKIAlpZiAo
ZXJyKQogCQlyZXR1cm4gZXJyOwogCiAJZXJyID0gX19jb250ZXh0X3Bpbl9wcGd0dChjZS0+Z2Vt
X2NvbnRleHQpOwogCWlmIChlcnIpCi0JCWdvdG8gZXJyX3VucGluOworCQlnb3RvIGVycl9hY3Rp
dmU7CiAKIAlyZXR1cm4gMDsKIAotZXJyX3VucGluOgotCV9fY29udGV4dF91bnBpbihjZSk7Citl
cnJfYWN0aXZlOgorCWludGVsX2NvbnRleHRfaW5hY3RpdmUoY2UpOwogCXJldHVybiBlcnI7CiB9
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCmluZGV4IDZkNzU2Mjc2OWViMi4u
Yjc2NzVlZjE4NTIzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2Vu
Z2luZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKQEAgLTE0
NiwxMiArMTQ2LDE4IEBAIHN0YXRpYyB2b2lkIG1vY2tfY29udGV4dF9kZXN0cm95KHN0cnVjdCBr
cmVmICpyZWYpCiAKIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X3BpbihzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UpCiB7CisJaW50IHJldDsKKwogCWlmICghY2UtPnJpbmcpIHsKIAkJY2UtPnJpbmcg
PSBtb2NrX3JpbmcoY2UtPmVuZ2luZSk7CiAJCWlmICghY2UtPnJpbmcpCiAJCQlyZXR1cm4gLUVO
T01FTTsKIAl9CiAKKwlyZXQgPSBpbnRlbF9jb250ZXh0X2FjdGl2ZShjZSwgUElOX0hJR0gpOwor
CWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKIAltb2NrX3RpbWVsaW5lX3BpbihjZS0+cmluZy0+
dGltZWxpbmUpOwogCXJldHVybiAwOwogfQpAQCAtMzI4LDE0ICszMzQsOSBAQCB2b2lkIG1vY2tf
ZW5naW5lX2ZyZWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBt
b2NrX2VuZ2luZSAqbW9jayA9CiAJCWNvbnRhaW5lcl9vZihlbmdpbmUsIHR5cGVvZigqbW9jayks
IGJhc2UpOwotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAogCUdFTV9CVUdfT04odGltZXJf
cGVuZGluZygmbW9jay0+aHdfZGVsYXkpKTsKIAotCWNlID0gZmV0Y2hfYW5kX3plcm8oJmVuZ2lu
ZS0+bGFzdF9yZXRpcmVkX2NvbnRleHQpOwotCWlmIChjZSkKLQkJaW50ZWxfY29udGV4dF91bnBp
bihjZSk7Ci0KIAlpbnRlbF9jb250ZXh0X3VucGluKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwog
CiAJaW50ZWxfZW5naW5lX2ZpbmlfYnJlYWRjcnVtYnMoZW5naW5lKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZS5jCmluZGV4IDg2M2FlMTI3MDdiYS4uNTYzMjk5ZTUwOTAxIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfYWN0aXZlLmMKQEAgLTEwMCw3ICsxMDAsNyBAQCBhY3RpdmVfaW5zdGFuY2Uo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCiAJCXBhcmVudCA9ICpwOwogCiAJCW5v
ZGUgPSByYl9lbnRyeShwYXJlbnQsIHN0cnVjdCBhY3RpdmVfbm9kZSwgbm9kZSk7Ci0JCWlmIChu
b2RlLT50aW1lbGluZSA9PSBpZHgpCisJCWlmIChub2RlLT50aW1lbGluZSA9PSBpZHggJiYgIUlT
X0VSUihub2RlLT5iYXNlLnJlcXVlc3QpKQogCQkJZ290byByZXBsYWNlOwogCiAJCWlmIChub2Rl
LT50aW1lbGluZSA8IGlkeCkKQEAgLTE1Nyw2ICsxNTcsNyBAQCB2b2lkIGk5MTVfYWN0aXZlX2lu
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmVmLT5yZXRpcmUgPSByZXRpcmU7
CiAJcmVmLT50cmVlID0gUkJfUk9PVDsKIAlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJnJlZi0+
bGFzdCwgTlVMTCwgbGFzdF9yZXRpcmUpOworCWluaXRfbGxpc3RfaGVhZCgmcmVmLT5iYXJyaWVy
cyk7CiAJcmVmLT5jb3VudCA9IDA7CiB9CiAKQEAgLTI2Myw2ICsyNjQsODQgQEAgdm9pZCBpOTE1
X2FjdGl2ZV9maW5pKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogfQogI2VuZGlmCiAKK2ludCBp
OTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYsCisJCQkJCSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CisJdW5zaWduZWQgbG9u
ZyB0bXA7CisJaW50IGVyciA9IDA7CisKKwlpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7CisJZm9y
X2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGk5MTUsIGVuZ2luZS0+bWFzaywgdG1wKSB7CisJ
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICprY3R4ID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKKwkJ
c3RydWN0IGFjdGl2ZV9ub2RlICpub2RlOworCisJCW5vZGUgPSBrbWVtX2NhY2hlX2FsbG9jKGds
b2JhbC5zbGFiX2NhY2hlLCBHRlBfS0VSTkVMKTsKKwkJaWYgKHVubGlrZWx5KCFub2RlKSkgewor
CQkJZXJyID0gLUVOT01FTTsKKwkJCWJyZWFrOworCQl9CisKKwkJaTkxNV9hY3RpdmVfcmVxdWVz
dF9pbml0KCZub2RlLT5iYXNlLAorCQkJCQkgKHZvaWQgKillbmdpbmUsIG5vZGVfcmV0aXJlKTsK
KwkJbm9kZS0+dGltZWxpbmUgPSBrY3R4LT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dDsK
KwkJbm9kZS0+cmVmID0gcmVmOworCQlyZWYtPmNvdW50Kys7CisKKwkJbGxpc3RfYWRkKChzdHJ1
Y3QgbGxpc3Rfbm9kZSAqKSZub2RlLT5iYXNlLmxpbmssCisJCQkgICZyZWYtPmJhcnJpZXJzKTsK
Kwl9CisJaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYpOworCisJcmV0dXJuIGVycjsKK30KKwordm9p
ZCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7
CisJc3RydWN0IGxsaXN0X25vZGUgKnBvcywgKm5leHQ7CisKKwlpOTE1X2FjdGl2ZV9hY3F1aXJl
KHJlZik7CisKKwlsbGlzdF9mb3JfZWFjaF9zYWZlKHBvcywgbmV4dCwgbGxpc3RfZGVsX2FsbCgm
cmVmLT5iYXJyaWVycykpIHsKKwkJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCQlz
dHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGU7CisJCXN0cnVjdCByYl9ub2RlICoqcCwgKnBhcmVudDsK
KworCQlub2RlID0gY29udGFpbmVyX29mKChzdHJ1Y3QgbGlzdF9oZWFkICopcG9zLAorCQkJCSAg
ICB0eXBlb2YoKm5vZGUpLCBiYXNlLmxpbmspOworCisJCWVuZ2luZSA9ICh2b2lkICopcmN1X2Fj
Y2Vzc19wb2ludGVyKG5vZGUtPmJhc2UucmVxdWVzdCk7CisJCVJDVV9JTklUX1BPSU5URVIobm9k
ZS0+YmFzZS5yZXF1ZXN0LCBFUlJfUFRSKC1FQUdBSU4pKTsKKworCQlwYXJlbnQgPSBOVUxMOwor
CQlwID0gJnJlZi0+dHJlZS5yYl9ub2RlOworCQl3aGlsZSAoKnApIHsKKwkJCXBhcmVudCA9ICpw
OworCQkJaWYgKHJiX2VudHJ5KHBhcmVudCwKKwkJCQkgICAgIHN0cnVjdCBhY3RpdmVfbm9kZSwK
KwkJCQkgICAgIG5vZGUpLT50aW1lbGluZSA8IG5vZGUtPnRpbWVsaW5lKQorCQkJCXAgPSAmcGFy
ZW50LT5yYl9yaWdodDsKKwkJCWVsc2UKKwkJCQlwID0gJnBhcmVudC0+cmJfbGVmdDsKKwkJfQor
CQlyYl9saW5rX25vZGUoJm5vZGUtPm5vZGUsIHBhcmVudCwgcCk7CisJCXJiX2luc2VydF9jb2xv
cigmbm9kZS0+bm9kZSwgJnJlZi0+dHJlZSk7CisKKwkJbGxpc3RfYWRkKChzdHJ1Y3QgbGxpc3Rf
bm9kZSAqKSZub2RlLT5iYXNlLmxpbmssCisJCQkgICZlbmdpbmUtPmJhcnJpZXJfdGFza3MpOwor
CX0KKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7Cit9CisKK3ZvaWQgaTkxNV9yZXF1ZXN0X2Fk
ZF9iYXJyaWVycyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOworCXN0cnVjdCBsbGlzdF9ub2RlICpub2RlLCAq
bmV4dDsKKworCWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbGxpc3RfZGVsX2FsbCgm
ZW5naW5lLT5iYXJyaWVyX3Rhc2tzKSkKKwkJbGlzdF9hZGRfdGFpbCgoc3RydWN0IGxpc3RfaGVh
ZCAqKW5vZGUsICZycS0+YWN0aXZlX2xpc3QpOworfQorCiBpbnQgaTkxNV9hY3RpdmVfcmVxdWVz
dF9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKIAkJCSAgICBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCmluZGV4IDdk
NzU4NzE5Y2UzOS4uZDU1ZDM3NjczOTQ0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgK
QEAgLTQwNiw0ICs0MDYsOSBAQCB2b2lkIGk5MTVfYWN0aXZlX2Zpbmkoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYpOwogc3RhdGljIGlubGluZSB2b2lkIGk5MTVfYWN0aXZlX2Zpbmkoc3RydWN0IGk5
MTVfYWN0aXZlICpyZWYpIHsgfQogI2VuZGlmCiAKK2ludCBpOTE1X2FjdGl2ZV9hY3F1aXJlX3By
ZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCisJCQkJCSAgICBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwordm9pZCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2Jh
cnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwordm9pZCBpOTE1X3JlcXVlc3RfYWRkX2Jh
cnJpZXJzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKTsKKwogI2VuZGlmIC8qIF9JOTE1X0FDVElW
RV9IXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlw
ZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKaW5kZXggYjY3
OTI1M2I1M2E1Li5jMDI1OTkxYjkyMzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3Rp
dmVfdHlwZXMuaApAQCAtNyw2ICs3LDcgQEAKICNpZm5kZWYgX0k5MTVfQUNUSVZFX1RZUEVTX0hf
CiAjZGVmaW5lIF9JOTE1X0FDVElWRV9UWVBFU19IXwogCisjaW5jbHVkZSA8bGludXgvbGxpc3Qu
aD4KICNpbmNsdWRlIDxsaW51eC9yYnRyZWUuaD4KICNpbmNsdWRlIDxsaW51eC9yY3VwZGF0ZS5o
PgogCkBAIC0zMSw2ICszMiw4IEBAIHN0cnVjdCBpOTE1X2FjdGl2ZSB7CiAJdW5zaWduZWQgaW50
IGNvdW50OwogCiAJdm9pZCAoKnJldGlyZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOworCisJ
c3RydWN0IGxsaXN0X2hlYWQgYmFycmllcnM7CiB9OwogCiAjZW5kaWYgLyogX0k5MTVfQUNUSVZF
X1RZUEVTX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA5ZjJlMjEzYzYwNDYuLjRk
YmE2Y2VmNmE2OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC0xMTkzLDEwICsxMTkzLDYg
QEAgdm9pZCBpOTE1X2dlbV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IAogCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwotCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaTkxNV9nZW1fY29udGV4dHNfbG9zdChpOTE1
KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiB2b2lkIGk5
MTVfZ2VtX2luaXRfc3dpenpsaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggODEwMGNjZjA0YzBiLi5iZTgzMGYw
ZWE3NmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0yMTMsMTggKzIxMyw2
IEBAIHN0YXRpYyB2b2lkIF9fcmV0aXJlX2VuZ2luZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSwKIAlzcGluX3VubG9jaygmcnEtPmxvY2spOwogCiAJbG9jYWxfaXJxX2Vu
YWJsZSgpOwotCi0JLyoKLQkgKiBUaGUgYmFja2luZyBvYmplY3QgZm9yIHRoZSBjb250ZXh0IGlz
IGRvbmUgYWZ0ZXIgc3dpdGNoaW5nIHRvIHRoZQotCSAqICpuZXh0KiBjb250ZXh0LiBUaGVyZWZv
cmUgd2UgY2Fubm90IHJldGlyZSB0aGUgcHJldmlvdXMgY29udGV4dCB1bnRpbAotCSAqIHRoZSBu
ZXh0IGNvbnRleHQgaGFzIGFscmVhZHkgc3RhcnRlZCBydW5uaW5nLiBIb3dldmVyLCBzaW5jZSB3
ZQotCSAqIGNhbm5vdCB0YWtlIHRoZSByZXF1aXJlZCBsb2NrcyBhdCBpOTE1X3JlcXVlc3Rfc3Vi
bWl0KCkgd2UKLQkgKiBkZWZlciB0aGUgdW5waW5uaW5nIG9mIHRoZSBhY3RpdmUgY29udGV4dCB0
byBub3csIHJldGlyZW1lbnQgb2YKLQkgKiB0aGUgc3Vic2VxdWVudCByZXF1ZXN0LgotCSAqLwot
CWlmIChlbmdpbmUtPmxhc3RfcmV0aXJlZF9jb250ZXh0KQotCQlpbnRlbF9jb250ZXh0X3VucGlu
KGVuZ2luZS0+bGFzdF9yZXRpcmVkX2NvbnRleHQpOwotCWVuZ2luZS0+bGFzdF9yZXRpcmVkX2Nv
bnRleHQgPSBycS0+aHdfY29udGV4dDsKIH0KIAogc3RhdGljIHZvaWQgX19yZXRpcmVfZW5naW5l
X3VwdG8oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLApAQCAtNzU5LDkgKzc0Nyw2IEBA
IF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIGdmcF90IGdm
cCkKIAogCXJxLT5pbmZpeCA9IHJxLT5yaW5nLT5lbWl0OyAvKiBlbmQgb2YgaGVhZGVyOyBzdGFy
dCBvZiB1c2VyIHBheWxvYWQgKi8KIAotCS8qIEtlZXAgYSBzZWNvbmQgcGluIGZvciB0aGUgZHVh
bCByZXRpcmVtZW50IGFsb25nIGVuZ2luZSBhbmQgcmluZyAqLwotCV9faW50ZWxfY29udGV4dF9w
aW4oY2UpOwotCiAJaW50ZWxfY29udGV4dF9tYXJrX2FjdGl2ZShjZSk7CiAJcmV0dXJuIHJxOwog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2
aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMK
aW5kZXggYjdmM2ZiYjRhZTg5Li5hOTZkMGMwMTJkNDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTU2LDcgKzU2LDYgQEAgc3Rh
dGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJ
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2go
aTkxNSk7Ci0JaTkxNV9nZW1fY29udGV4dHNfbG9zdChpOTE1KTsKIAltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZmx1c2hfd29yaygmaTkxNS0+Z2VtLmlkbGVfd29y
ayk7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

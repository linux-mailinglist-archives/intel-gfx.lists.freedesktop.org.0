Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8DFE69CA28
	for <lists+intel-gfx@lfdr.de>; Mon, 26 Aug 2019 09:24:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C723E6E1F2;
	Mon, 26 Aug 2019 07:24:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E27786E1F2
 for <intel-gfx@lists.freedesktop.org>; Mon, 26 Aug 2019 07:24:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18262677-1500050 
 for multiple; Mon, 26 Aug 2019 08:21:52 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 26 Aug 2019 08:21:23 +0100
Message-Id: <20190826072149.9447-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190826072149.9447-1-chris@chris-wilson.co.uk>
References: <20190826072149.9447-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 02/28] drm/i915/selftests: Remove accidental
 serialization between gpu_fill
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VXBvbiBvYmplY3QgY3JlYXRpb24gZm9yIGxpdmVfZ2VtX2NvbnRleHRzLCB3ZSBmaWxsIHRoZSBv
YmplY3Qgd2l0aAprbm93biBzY3JhdGNoIGFuZCBmbHVzaCBpdCBvdXQgb2YgdGhlIENQVSBjYWNo
ZS4gQmVmb3JlIHBlcmZvcm1pbmcgdGhlCkdQVSBmaWxsLCB3ZSBkb24ndCBuZWVkIHRvIGZsdXNo
IGl0IGFnYWluIGFuZCBzbyBhdm9pZCBzZXJpYWxpc2luZyB3aXRoCnByZXZpb3VzIGZpbGxzLgoK
SG93ZXZlciwgd2UgZG8gbmVlZCBzb21lIHRocm90dGxpbmcgb24gdGhlIGludGVybmFsIGludGVy
ZmFjZXMgaWYgd2UgZG8Kbm90IHdhbnQgdG8gcnVuIG91dCBvZiBtZW1vcnkhCgpTaWduZWQtb2Zm
LWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiAuLi4vZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgfCA4MyArKysrKysrKysrKysr
KysrLS0tCiAxIGZpbGUgY2hhbmdlZCwgNzIgaW5zZXJ0aW9ucygrKSwgMTEgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X2NvbnRleHQuYwppbmRleCAzYWRiNjBjMmZkMWYuLjc1ODQxN2Q5ZjNjMSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMK
QEAgLTE4MCwxMiArMTgwLDYgQEAgc3RhdGljIGludCBncHVfZmlsbChzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UsCiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCi0J
aTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKLQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3Rv
X2d0dF9kb21haW4ob2JqLCB0cnVlKTsKLQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7Ci0J
aWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQogCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAs
IFBJTl9ISUdIIHwgUElOX1VTRVIpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CkBAIC0zNDMs
NiArMzM3LDQ1IEBAIHN0YXRpYyB1bnNpZ25lZCBsb25nIG1heF9kd29yZHMoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKIAlyZXR1cm4gbnBhZ2VzIC8gRFdfUEVSX1BBR0U7CiB9CiAK
K3N0YXRpYyB2b2lkIHRocm90dGxlX3JlbGVhc2Uoc3RydWN0IGk5MTVfcmVxdWVzdCAqKnEsIGlu
dCBjb3VudCkKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJ
CWlmIChJU19FUlJfT1JfTlVMTChxW2ldKSkKKwkJCWNvbnRpbnVlOworCisJCWk5MTVfcmVxdWVz
dF9wdXQoZmV0Y2hfYW5kX3plcm8oJnFbaV0pKTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgdGhyb3R0
bGUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAq
KnEsIGludCBjb3VudCkKK3sKKwlpbnQgaTsKKworCWlmICghSVNfRVJSX09SX05VTEwocVswXSkp
IHsKKwkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHFbMF0sCisJCQkJICAgICAgSTkxNV9XQUlUX0lO
VEVSUlVQVElCTEUsCisJCQkJICAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpIDwgMCkKKwkJCXJl
dHVybiAtRUlOVFI7CisKKwkJaTkxNV9yZXF1ZXN0X3B1dChxWzBdKTsKKwl9CisKKwlmb3IgKGkg
PSAwOyBpIDwgY291bnQgLSAxOyBpKyspCisJCXFbaV0gPSBxW2kgKyAxXTsKKworCXFbaV0gPSBp
bnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKKwlpZiAoSVNfRVJSKHFbaV0pKQorCQly
ZXR1cm4gUFRSX0VSUihxW2ldKTsKKworCWk5MTVfcmVxdWVzdF9nZXQocVtpXSk7CisJaTkxNV9y
ZXF1ZXN0X2FkZChxW2ldKTsKKworCXJldHVybiAwOworfQorCiBzdGF0aWMgaW50IGlndF9jdHhf
ZXhlYyh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7
CkBAIC0zNjIsNiArMzk1LDcgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQog
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmogPSBOVUxMOwogCQl1bnNpZ25lZCBsb25nIG5jb250ZXh0cywgbmR3b3Jk
cywgZHc7CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnRxWzVdID0ge307CiAJCXN0cnVjdCBpZ3Rf
bGl2ZV90ZXN0IHQ7CiAJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAkJSUdUX1RJTUVPVVQoZW5k
X3RpbWUpOwpAQCAtNDA4LDEzICs0NDIsMTggQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9p
ZCAqYXJnKQogCQkJfQogCiAJCQllcnIgPSBncHVfZmlsbChjZSwgb2JqLCBkdyk7Ci0JCQlpbnRl
bF9jb250ZXh0X3B1dChjZSk7Ci0KIAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoIkZhaWxlZCB0
byBmaWxsIGR3b3JkICVsdSBbJWx1LyVsdV0gd2l0aCBncHUgKCVzKSBpbiBjdHggJXUgW2Z1bGwt
cHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJCSAgICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3Jk
cyhvYmopLAogCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGN0eC0+aHdfaWQsCiAJCQkJICAgICAg
IHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQkJ
CWdvdG8gb3V0X3VubG9jazsKKwkJCX0KKworCQkJZXJyID0gdGhyb3R0bGUoY2UsIHRxLCBBUlJB
WV9TSVpFKHRxKSk7CisJCQlpZiAoZXJyKSB7CisJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwog
CQkJCWdvdG8gb3V0X3VubG9jazsKIAkJCX0KIApAQCAtNDI1LDYgKzQ2NCw4IEBAIHN0YXRpYyBp
bnQgaWd0X2N0eF9leGVjKHZvaWQgKmFyZykKIAogCQkJbmR3b3JkcysrOwogCQkJbmNvbnRleHRz
Kys7CisKKwkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJfQogCiAJCXByX2luZm8oIlN1Ym1p
dHRlZCAlbHUgY29udGV4dHMgdG8gJXMsIGZpbGxpbmcgJWx1IGR3b3Jkc1xuIiwKQEAgLTQ0Myw2
ICs0ODQsNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCX0KIAogb3V0
X3VubG9jazoKKwkJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwogCQlpZiAo
aWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKIAkJbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKQEAgLTQ2MCw2ICs1MDIsNyBAQCBzdGF0aWMgaW50IGln
dF9jdHhfZXhlYyh2b2lkICphcmcpCiBzdGF0aWMgaW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9p
ZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnRxWzVdID0ge307CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKnBh
cmVudDsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdp
bmVfaWQgaWQ7CkBAIC01MzIsMTQgKzU3NSwyMCBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRfY3R4
X2V4ZWModm9pZCAqYXJnKQogCQkJfQogCiAJCQllcnIgPSBncHVfZmlsbChjZSwgb2JqLCBkdyk7
Ci0JCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7Ci0JCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgp
OwotCiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAlbHUg
WyVsdS8lbHVdIHdpdGggZ3B1ICglcykgaW4gY3R4ICV1IFtmdWxsLXBwZ3R0PyAlc10sIGVycj0l
ZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9kd29yZHMob2JqKSwKIAkJCQkgICAg
ICAgZW5naW5lLT5uYW1lLCBjdHgtPmh3X2lkLAogCQkJCSAgICAgICB5ZXNubyghIWN0eC0+dm0p
LCBlcnIpOworCQkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJCQlrZXJuZWxfY29udGV4dF9j
bG9zZShjdHgpOworCQkJCWdvdG8gb3V0X3Rlc3Q7CisJCQl9CisKKwkJCWVyciA9IHRocm90dGxl
KGNlLCB0cSwgQVJSQVlfU0laRSh0cSkpOworCQkJaWYgKGVycikgeworCQkJCWludGVsX2NvbnRl
eHRfcHV0KGNlKTsKKwkJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCQkJCWdvdG8gb3V0
X3Rlc3Q7CiAJCQl9CiAKQEAgLTU1MCw2ICs1OTksOSBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRf
Y3R4X2V4ZWModm9pZCAqYXJnKQogCiAJCQluZHdvcmRzKys7CiAJCQluY29udGV4dHMrKzsKKwor
CQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsK
IAkJfQogCQlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1IGNvbnRleHRzIHRvICVzLCBmaWxsaW5nICVs
dSBkd29yZHNcbiIsCiAJCQluY29udGV4dHMsIGVuZ2luZS0+bmFtZSwgbmR3b3Jkcyk7CkBAIC01
NzEsNiArNjIzLDcgQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVkX2N0eF9leGVjKHZvaWQgKmFyZykK
IAkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJfQogb3V0X3Rlc3Q6CisJ
dGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwogCWlmIChpZ3RfbGl2ZV90ZXN0
X2VuZCgmdCkpCiAJCWVyciA9IC1FSU87CiBvdXRfdW5sb2NrOgpAQCAtMTA0Nyw2ICsxMTAwLDcg
QEAgc3RhdGljIGludCBpZ3RfY3R4X3JlYWRvbmx5KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqID0gTlVMTDsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICp0cVs1XSA9IHt9OwogCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJ
dW5zaWduZWQgbG9uZyBpZHgsIG5kd29yZHMsIGR3OwpAQCAtMTExOCw2ICsxMTcyLDEyIEBAIHN0
YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJCQkJZ290byBvdXRfdW5sb2Nr
OwogCQkJfQogCisJCQllcnIgPSB0aHJvdHRsZShjZSwgdHEsIEFSUkFZX1NJWkUodHEpKTsKKwkJ
CWlmIChlcnIpIHsKKwkJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7CisJ
CQkJZ290byBvdXRfdW5sb2NrOworCQkJfQorCiAJCQlpZiAoKytkdyA9PSBtYXhfZHdvcmRzKG9i
aikpIHsKIAkJCQlvYmogPSBOVUxMOwogCQkJCWR3ID0gMDsKQEAgLTExNDgsNiArMTIwOCw3IEBA
IHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJfQogCiBvdXRfdW5sb2Nr
OgorCXRocm90dGxlX3JlbGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsKIAlpZiAoaWd0X2xpdmVf
dGVzdF9lbmQoJnQpKQogCQllcnIgPSAtRUlPOwogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeA==

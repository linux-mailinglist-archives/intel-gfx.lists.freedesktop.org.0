Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5A20277AF3
	for <lists+intel-gfx@lfdr.de>; Sat, 27 Jul 2019 20:02:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C82DD6EECB;
	Sat, 27 Jul 2019 18:02:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9F1816EECB;
 Sat, 27 Jul 2019 18:02:55 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17659861-1500050 
 for multiple; Sat, 27 Jul 2019 19:02:47 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 27 Jul 2019 19:02:47 +0100
Message-Id: <20190727180247.28311-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] kms_busy: Replace fiddling with hangcheck
 modparam with explicit fence
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VXNlIGFuIGV4cGxpY2l0IGZlbmNlIHRvIGNpcmN1bXZlbnQgdGhlIFtpOTE1XSBHUFUgaGFuZyBk
ZXRlY3Rpb24gcmF0aGVyCnRoYW4gdHdlYWsgdGhlIGk5MTUgc3BlY2lmaWMgbW9kcGFyYW0gKGFu
ZCByZW1vdmUgdGhlIGFzc2VydGlvbiB0aGF0CnN1Y2ggYSBwYXJhbSBleGlzdHMpLiBOb3RlLCB0
aGF0IHdpdGggYSBiaXQgbW9yZSB3b3JrLCB0aGUgZmVuY2UgY291bGQKYmUgdXNlZCBiZSBkaXJl
Y3RseSByYXRoZXIgdGhhbiB2aWEgZGlydHlpbmcgdGhlIGZiIHdpdGggYSBkdW1teWxvYWQuCgpT
aWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0t
CiBsaWIvaWd0X2R1bW15bG9hZC5jIHwgIDUgKysrKysKIGxpYi9pZ3RfZHVtbXlsb2FkLmggfCAx
MCArKysrKystLS0tCiB0ZXN0cy9rbXNfYnVzeS5jICAgIHwgMjYgKysrKysrKysrKy0tLS0tLS0t
LS0tLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMjEgaW5zZXJ0aW9ucygrKSwgMjAgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvbGliL2lndF9kdW1teWxvYWQuYyBiL2xpYi9pZ3RfZHVtbXlsb2Fk
LmMKaW5kZXggMGUwNjI3NmFmLi42NWI1Y2M5MjcgMTAwNjQ0Ci0tLSBhL2xpYi9pZ3RfZHVtbXls
b2FkLmMKKysrIGIvbGliL2lndF9kdW1teWxvYWQuYwpAQCAtMjM2LDYgKzIzNiwxMSBAQCBlbWl0
X3JlY3Vyc2l2ZV9iYXRjaChpZ3Rfc3Bpbl90ICpzcGluLAogCWlmIChvcHRzLT5mbGFncyAmIElH
VF9TUElOX0ZFTkNFX09VVCkKIAkJZXhlY2J1Zi0+ZmxhZ3MgfD0gSTkxNV9FWEVDX0ZFTkNFX09V
VDsKIAorCWlmIChvcHRzLT5mbGFncyAmIElHVF9TUElOX0ZFTkNFX0lOKSB7CisJCWV4ZWNidWYt
PmZsYWdzIHw9IEk5MTVfRVhFQ19GRU5DRV9JTjsKKwkJZXhlY2J1Zi0+cnN2ZDIgPSBvcHRzLT5m
ZW5jZTsKKwl9CisKIAlmb3IgKGkgPSAwOyBpIDwgbmVuZ2luZTsgaSsrKSB7CiAJCWV4ZWNidWYt
PmZsYWdzICY9IH5FTkdJTkVfTUFTSzsKIAkJZXhlY2J1Zi0+ZmxhZ3MgfD0gZmxhZ3NbaV07CmRp
ZmYgLS1naXQgYS9saWIvaWd0X2R1bW15bG9hZC5oIGIvbGliL2lndF9kdW1teWxvYWQuaAppbmRl
eCBiYjI1NzUxYWQuLjY2ODM3MDU3ZCAxMDA2NDQKLS0tIGEvbGliL2lndF9kdW1teWxvYWQuaAor
KysgYi9saWIvaWd0X2R1bW15bG9hZC5oCkBAIC01NCwxMiArNTQsMTQgQEAgc3RydWN0IGlndF9z
cGluX2ZhY3RvcnkgewogCXVpbnQzMl90IGRlcGVuZGVuY3k7CiAJdW5zaWduZWQgaW50IGVuZ2lu
ZTsKIAl1bnNpZ25lZCBpbnQgZmxhZ3M7CisJaW50IGZlbmNlOwogfTsKIAotI2RlZmluZSBJR1Rf
U1BJTl9GRU5DRV9PVVQgICAgICgxIDw8IDApCi0jZGVmaW5lIElHVF9TUElOX1BPTExfUlVOICAg
ICAgKDEgPDwgMSkKLSNkZWZpbmUgSUdUX1NQSU5fRkFTVCAgICAgICAgICAoMSA8PCAyKQotI2Rl
ZmluZSBJR1RfU1BJTl9OT19QUkVFTVBUSU9OICgxIDw8IDMpCisjZGVmaW5lIElHVF9TUElOX0ZF
TkNFX0lOICAgICAgKDEgPDwgMCkKKyNkZWZpbmUgSUdUX1NQSU5fRkVOQ0VfT1VUICAgICAoMSA8
PCAxKQorI2RlZmluZSBJR1RfU1BJTl9QT0xMX1JVTiAgICAgICgxIDw8IDIpCisjZGVmaW5lIElH
VF9TUElOX0ZBU1QgICAgICAgICAgKDEgPDwgMykKKyNkZWZpbmUgSUdUX1NQSU5fTk9fUFJFRU1Q
VElPTiAoMSA8PCA0KQogCiBpZ3Rfc3Bpbl90ICoKIF9faWd0X3NwaW5fZmFjdG9yeShpbnQgZmQs
IGNvbnN0IHN0cnVjdCBpZ3Rfc3Bpbl9mYWN0b3J5ICpvcHRzKTsKZGlmZiAtLWdpdCBhL3Rlc3Rz
L2ttc19idXN5LmMgYi90ZXN0cy9rbXNfYnVzeS5jCmluZGV4IDY2ZjI2Y2QwOC4uYmFmNDVmMzBm
IDEwMDY0NAotLS0gYS90ZXN0cy9rbXNfYnVzeS5jCisrKyBiL3Rlc3RzL2ttc19idXN5LmMKQEAg
LTc1LDIyICs3NSwxNiBAQCBzdGF0aWMgdm9pZCBmbGlwX3RvX2ZiKGlndF9kaXNwbGF5X3QgKmRw
eSwgaW50IHBpcGUsCiAJc3RydWN0IHBvbGxmZCBwZmQgPSB7IC5mZCA9IGRweS0+ZHJtX2ZkLCAu
ZXZlbnRzID0gUE9MTElOIH07CiAJY29uc3QgaW50IHRpbWVvdXQgPSBtb2Rlc2V0ID8gODUwMCA6
IDEwMDsKIAlzdHJ1Y3QgZHJtX2V2ZW50X3ZibGFuayBldjsKKwlJR1RfQ09SS19GRU5DRShjb3Jr
KTsKKwlpZ3Rfc3Bpbl90ICp0OworCWludCBmZW5jZTsKIAotCWlndF9zcGluX3QgKnQgPSBpZ3Rf
c3Bpbl9uZXcoZHB5LT5kcm1fZmQsCi0JCQkJICAgICAuZW5naW5lID0gcmluZywKLQkJCQkgICAg
IC5kZXBlbmRlbmN5ID0gZmItPmdlbV9oYW5kbGUpOwotCi0JaWYgKG1vZGVzZXQpIHsKLQkJLyoK
LQkJICogV2Ugd2FudCB0byBjaGVjayB0aGF0IGEgbW9kZXNldCBhY3R1YWxseSB3YWl0cyBmb3Ig
dGhlCi0JCSAqIHNwaW4gYmF0Y2ggdG8gY29tcGxldGUsIGJ1dCB3ZSBrZWVwIGEgYmlnZ2VyIHRp
bWVvdXQgZm9yCi0JCSAqIGRpc2FibGUgdGhhbiByZXF1aXJlZCBmb3IgZmxpcHBpbmcuCi0JCSAq
Ci0JCSAqIEFzIGEgcmVzdWx0LCB0aGUgR1BVIHJlc2V0IGNvZGUgbWF5IGtpY2sgaW4sIHdoaWNo
IHdlIG5ldXRlcgotCQkgKiBoZXJlIHRvIGJlIHN1cmUgdGhlcmUncyBubyBwcmVtYXR1cmUgY29t
cGxldGlvbi4KLQkJICovCi0JCWlndF9zZXRfbW9kdWxlX3BhcmFtX2ludCgiZW5hYmxlX2hhbmdj
aGVjayIsIDApOwotCX0KKwlmZW5jZSA9IGlndF9jb3JrX3BsdWcoJmNvcmssIGRweS0+ZHJtX2Zk
KTsKKwl0ID0gaWd0X3NwaW5fbmV3KGRweS0+ZHJtX2ZkLAorCQkJIC5lbmdpbmUgPSByaW5nLAor
CQkJIC5mZW5jZSA9IGZlbmNlLAorCQkJIC5kZXBlbmRlbmN5ID0gZmItPmdlbV9oYW5kbGUsCisJ
CQkgLmZsYWdzID0gSUdUX1NQSU5fRkVOQ0VfSU4gfCBJR1RfU1BJTl9OT19QUkVFTVBUSU9OKTsK
IAogCWlndF9mb3JrKGNoaWxkLCAxKSB7CiAJCWlndF9hc3NlcnQoZ2VtX2JvX2J1c3koZHB5LT5k
cm1fZmQsIGZiLT5nZW1faGFuZGxlKSk7CkBAIC0xMTYsMTMgKzExMCwxMyBAQCBzdGF0aWMgdm9p
ZCBmbGlwX3RvX2ZiKGlndF9kaXNwbGF5X3QgKmRweSwgaW50IHBpcGUsCiAJaWd0X3dhaXRjaGls
ZHJlbl90aW1lb3V0KDUgKiB0aW1lb3V0LAogCQkJCSAiZmxpcCBibG9ja2VkIHdhaXRpbmcgZm9y
IGJ1c3kgYm9cbiIpOwogCWlndF9zcGluX2VuZCh0KTsKKwljbG9zZShmZW5jZSk7CiAKIAlpZ3Rf
YXNzZXJ0KHJlYWQoZHB5LT5kcm1fZmQsICZldiwgc2l6ZW9mKGV2KSkgPT0gc2l6ZW9mKGV2KSk7
CiAJaWd0X2Fzc2VydChwb2xsKCZwZmQsIDEsIDApID09IDApOwogCiAJaWYgKG1vZGVzZXQpIHsK
IAkJZ2VtX3F1aWVzY2VudF9ncHUoZHB5LT5kcm1fZmQpOwotCQlpZ3Rfc2V0X21vZHVsZV9wYXJh
bV9pbnQoImVuYWJsZV9oYW5nY2hlY2siLCAxKTsKIAogCQkvKiBDbGVhciBvbGQgbW9kZSBibG9i
LiAqLwogCQlpZ3RfcGlwZV9yZWZyZXNoKGRweSwgcGlwZSwgdHJ1ZSk7Ci0tIAoyLjIyLjAKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBt
YWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 62D46105389
	for <lists+intel-gfx@lfdr.de>; Thu, 21 Nov 2019 14:51:53 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 413516EF32;
	Thu, 21 Nov 2019 13:51:51 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8A7436EF30
 for <intel-gfx@lists.freedesktop.org>; Thu, 21 Nov 2019 13:51:49 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19286322-1500050 
 for multiple; Thu, 21 Nov 2019 13:51:35 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 21 Nov 2019 13:51:27 +0000
Message-Id: <20191121135131.338984-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/5] drm/i915: Use a ctor for TYPESAFE_BY_RCU
 i915_request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2Ugc3RhcnQgcGVla2luZyBpbnRvIHJlcXVlc3RzIGZvciBsb25nZXIgYW5kIGxvbmdlciwg
ZS5nLgppbmNvcnBvcmF0aW5nIHVzZSBvZiBzcGlubG9ja3Mgd2hlbiBvbmx5IHByb3RlY3RlZCBi
eSBhbgpyY3VfcmVhZF9sb2NrKCksIHdlIG5lZWQgdG8gYmUgY2FyZWZ1bCBpbiBob3cgd2UgcmVz
ZXQgdGhlIHJlcXVlc3Qgd2hlbgpyZWN5Y2xpbmcgYW5kIG5lZWQgdG8gcHJlc2VydmUgYW55IGJh
cnJpZXJzIHRoYXQgbWF5IHN0aWxsIGJlIGluIHVzZSBhcwp0aGUgcmVxdWVzdCBpcyByZXNldCBm
b3IgcmV1c2UuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgICB8IDM3ICsrKysrKysrKysr
KysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYyB8
ICA2ICsrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5oIHwgIDEgKwog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZS5jICB8ICA4ICsrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZS5oICB8ICAyICsrCiA1IGZpbGVzIGNoYW5nZWQs
IDQyIGluc2VydGlvbnMoKyksIDEyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmMKaW5kZXggMDAwMTFmOTUzM2I2Li41ZTViZDdkNTcxMzQgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0yMTQsNyArMjE0LDcgQEAgc3RhdGljIHZvaWQgcmVtb3Zl
X2Zyb21fZW5naW5lKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQlzcGluX2xvY2soJmVuZ2lu
ZS0+YWN0aXZlLmxvY2spOwogCQlsb2NrZWQgPSBlbmdpbmU7CiAJfQotCWxpc3RfZGVsKCZycS0+
c2NoZWQubGluayk7CisJbGlzdF9kZWxfaW5pdCgmcnEtPnNjaGVkLmxpbmspOwogCXNwaW5fdW5s
b2NrX2lycSgmbG9ja2VkLT5hY3RpdmUubG9jayk7CiB9CiAKQEAgLTU4Niw2ICs1ODYsMTkgQEAg
cmVxdWVzdF9hbGxvY19zbG93KHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsIGdmcF90IGdmcCkK
IAlyZXR1cm4ga21lbV9jYWNoZV9hbGxvYyhnbG9iYWwuc2xhYl9yZXF1ZXN0cywgZ2ZwKTsKIH0K
IAorc3RhdGljIHZvaWQgX19pOTE1X3JlcXVlc3RfY3Rvcih2b2lkICphcmcpCit7CisJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEgPSBhcmc7CisKKwlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOwor
CWk5MTVfc2NoZWRfbm9kZV9pbml0KCZycS0+c2NoZWQpOworCWk5MTVfc3dfZmVuY2VfaW5pdCgm
cnEtPnN1Ym1pdCwgc3VibWl0X25vdGlmeSk7CisJaTkxNV9zd19mZW5jZV9pbml0KCZycS0+c2Vt
YXBob3JlLCBzZW1hcGhvcmVfbm90aWZ5KTsKKworCUlOSVRfTElTVF9IRUFEKCZycS0+ZXhlY3V0
ZV9jYik7CisJcnEtPmZpbGVfcHJpdiA9IE5VTEw7Cit9CisKIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KgogX19pOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgZ2ZwX3Qg
Z2ZwKQogewpAQCAtNjU1LDI0ICs2NjgsMjAgQEAgX19pOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSwgZ2ZwX3QgZ2ZwKQogCiAJcnEtPnJjdXN0YXRlID0gZ2V0X3N0
YXRlX3N5bmNocm9uaXplX3JjdSgpOyAvKiBhY3RzIGFzIHNtcF9tYigpICovCiAKLQlzcGluX2xv
Y2tfaW5pdCgmcnEtPmxvY2spOwogCWRtYV9mZW5jZV9pbml0KCZycS0+ZmVuY2UsICZpOTE1X2Zl
bmNlX29wcywgJnJxLT5sb2NrLAogCQkgICAgICAgdGwtPmZlbmNlX2NvbnRleHQsIHNlcW5vKTsK
IAogCS8qIFdlIGJ1bXAgdGhlIHJlZiBmb3IgdGhlIGZlbmNlIGNoYWluICovCi0JaTkxNV9zd19m
ZW5jZV9pbml0KCZpOTE1X3JlcXVlc3RfZ2V0KHJxKS0+c3VibWl0LCBzdWJtaXRfbm90aWZ5KTsK
LQlpOTE1X3N3X2ZlbmNlX2luaXQoJmk5MTVfcmVxdWVzdF9nZXQocnEpLT5zZW1hcGhvcmUsIHNl
bWFwaG9yZV9ub3RpZnkpOworCWk5MTVfc3dfZmVuY2VfcmVpbml0KCZpOTE1X3JlcXVlc3RfZ2V0
KHJxKS0+c3VibWl0KTsKKwlpOTE1X3N3X2ZlbmNlX3JlaW5pdCgmaTkxNV9yZXF1ZXN0X2dldChy
cSktPnNlbWFwaG9yZSk7CiAKLQlpOTE1X3NjaGVkX25vZGVfaW5pdCgmcnEtPnNjaGVkKTsKKwlp
OTE1X3NjaGVkX25vZGVfcmVpbml0KCZycS0+c2NoZWQpOwogCiAJLyogTm8gemFsbG9jLCBtdXN0
IGNsZWFyIHdoYXQgd2UgbmVlZCBieSBoYW5kICovCi0JcnEtPmZpbGVfcHJpdiA9IE5VTEw7CiAJ
cnEtPmJhdGNoID0gTlVMTDsKIAlycS0+Y2FwdHVyZV9saXN0ID0gTlVMTDsKIAlycS0+ZmxhZ3Mg
PSAwOwogCi0JSU5JVF9MSVNUX0hFQUQoJnJxLT5leGVjdXRlX2NiKTsKLQogCS8qCiAJICogUmVz
ZXJ2ZSBzcGFjZSBpbiB0aGUgcmluZyBidWZmZXIgZm9yIGFsbCB0aGUgY29tbWFuZHMgcmVxdWly
ZWQgdG8KIAkgKiBldmVudHVhbGx5IGVtaXQgdGhpcyByZXF1ZXN0LiBUaGlzIGlzIHRvIGd1YXJh
bnRlZSB0aGF0IHRoZQpAQCAtMTUzMywxMCArMTU0MiwxNCBAQCBzdGF0aWMgc3RydWN0IGk5MTVf
Z2xvYmFsX3JlcXVlc3QgZ2xvYmFsID0geyB7CiAKIGludCBfX2luaXQgaTkxNV9nbG9iYWxfcmVx
dWVzdF9pbml0KHZvaWQpCiB7Ci0JZ2xvYmFsLnNsYWJfcmVxdWVzdHMgPSBLTUVNX0NBQ0hFKGk5
MTVfcmVxdWVzdCwKLQkJCQkJICBTTEFCX0hXQ0FDSEVfQUxJR04gfAotCQkJCQkgIFNMQUJfUkVD
TEFJTV9BQ0NPVU5UIHwKLQkJCQkJICBTTEFCX1RZUEVTQUZFX0JZX1JDVSk7CisJZ2xvYmFsLnNs
YWJfcmVxdWVzdHMgPQorCQlrbWVtX2NhY2hlX2NyZWF0ZSgiaTkxNV9yZXF1ZXN0IiwKKwkJCQkg
IHNpemVvZihzdHJ1Y3QgaTkxNV9yZXF1ZXN0KSwKKwkJCQkgIF9fYWxpZ25vZl9fKHN0cnVjdCBp
OTE1X3JlcXVlc3QpLAorCQkJCSAgU0xBQl9IV0NBQ0hFX0FMSUdOIHwKKwkJCQkgIFNMQUJfUkVD
TEFJTV9BQ0NPVU5UIHwKKwkJCQkgIFNMQUJfVFlQRVNBRkVfQllfUkNVLAorCQkJCSAgX19pOTE1
X3JlcXVlc3RfY3Rvcik7CiAJaWYgKCFnbG9iYWwuc2xhYl9yZXF1ZXN0cykKIAkJcmV0dXJuIC1F
Tk9NRU07CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVy
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCmluZGV4IDE5NDI0NjU0
OGM0ZC4uYTVhNmRiZTZhNTNjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMK
QEAgLTM4Nyw2ICszODcsMTAgQEAgdm9pZCBpOTE1X3NjaGVkX25vZGVfaW5pdChzdHJ1Y3QgaTkx
NV9zY2hlZF9ub2RlICpub2RlKQogCUlOSVRfTElTVF9IRUFEKCZub2RlLT5zaWduYWxlcnNfbGlz
dCk7CiAJSU5JVF9MSVNUX0hFQUQoJm5vZGUtPndhaXRlcnNfbGlzdCk7CiAJSU5JVF9MSVNUX0hF
QUQoJm5vZGUtPmxpbmspOworfQorCit2b2lkIGk5MTVfc2NoZWRfbm9kZV9yZWluaXQoc3RydWN0
IGk5MTVfc2NoZWRfbm9kZSAqbm9kZSkKK3sKIAlub2RlLT5hdHRyLnByaW9yaXR5ID0gSTkxNV9Q
UklPUklUWV9JTlZBTElEOwogCW5vZGUtPnNlbWFwaG9yZXMgPSAwOwogCW5vZGUtPmZsYWdzID0g
MDsKQEAgLTQ4MSw2ICs0ODUsNyBAQCB2b2lkIGk5MTVfc2NoZWRfbm9kZV9maW5pKHN0cnVjdCBp
OTE1X3NjaGVkX25vZGUgKm5vZGUpCiAJCWlmIChkZXAtPmZsYWdzICYgSTkxNV9ERVBFTkRFTkNZ
X0FMTE9DKQogCQkJaTkxNV9kZXBlbmRlbmN5X2ZyZWUoZGVwKTsKIAl9CisJSU5JVF9MSVNUX0hF
QUQoJm5vZGUtPnNpZ25hbGVyc19saXN0KTsKIAogCS8qIFJlbW92ZSBvdXJzZWx2ZXMgZnJvbSBl
dmVyeW9uZSB3aG8gZGVwZW5kcyB1cG9uIHVzICovCiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KGRlcCwgdG1wLCAmbm9kZS0+d2FpdGVyc19saXN0LCB3YWl0X2xpbmspIHsKQEAgLTQ5MSw2ICs0
OTYsNyBAQCB2b2lkIGk5MTVfc2NoZWRfbm9kZV9maW5pKHN0cnVjdCBpOTE1X3NjaGVkX25vZGUg
Km5vZGUpCiAJCWlmIChkZXAtPmZsYWdzICYgSTkxNV9ERVBFTkRFTkNZX0FMTE9DKQogCQkJaTkx
NV9kZXBlbmRlbmN5X2ZyZWUoZGVwKTsKIAl9CisJSU5JVF9MSVNUX0hFQUQoJm5vZGUtPndhaXRl
cnNfbGlzdCk7CiAKIAlzcGluX3VubG9ja19pcnEoJnNjaGVkdWxlX2xvY2spOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmgKaW5kZXggMDdkMjQzYWNmNTUzLi5kMWRjNGVmZWY3
N2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuaApAQCAtMjYsNiArMjYsNyBA
QAogCQkJCQkgc2NoZWQubGluaykKIAogdm9pZCBpOTE1X3NjaGVkX25vZGVfaW5pdChzdHJ1Y3Qg
aTkxNV9zY2hlZF9ub2RlICpub2RlKTsKK3ZvaWQgaTkxNV9zY2hlZF9ub2RlX3JlaW5pdChzdHJ1
Y3QgaTkxNV9zY2hlZF9ub2RlICpub2RlKTsKIAogYm9vbCBfX2k5MTVfc2NoZWRfbm9kZV9hZGRf
ZGVwZW5kZW5jeShzdHJ1Y3QgaTkxNV9zY2hlZF9ub2RlICpub2RlLAogCQkJCSAgICAgIHN0cnVj
dCBpOTE1X3NjaGVkX25vZGUgKnNpZ25hbCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfc3dfZmVuY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2Uu
YwppbmRleCA2YTg4ZGIyOTEyNTIuLmVhY2M2YzVjZTBmZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfc3dfZmVuY2UuYwpAQCAtMjI3LDYgKzIyNywxNCBAQCB2b2lkIF9faTkxNV9zd19mZW5jZV9p
bml0KHN0cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSwKIAlmZW5jZS0+ZmxhZ3MgPSAodW5zaWdu
ZWQgbG9uZylmbjsKIH0KIAordm9pZCBpOTE1X3N3X2ZlbmNlX3JlaW5pdChzdHJ1Y3QgaTkxNV9z
d19mZW5jZSAqZmVuY2UpCit7CisJZGVidWdfZmVuY2VfaW5pdChmZW5jZSk7CisKKwlhdG9taWNf
c2V0KCZmZW5jZS0+cGVuZGluZywgMSk7CisJZmVuY2UtPmVycm9yID0gMDsKK30KKwogdm9pZCBp
OTE1X3N3X2ZlbmNlX2NvbW1pdChzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UpCiB7CiAJZGVi
dWdfZmVuY2VfYWN0aXZhdGUoZmVuY2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9zd19mZW5jZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZS5o
CmluZGV4IGFiN2Q1OGJkMGI5ZC4uMWU5MGQ5YTUxYmQyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9zd19mZW5jZS5oCkBAIC01NCw2ICs1NCw4IEBAIGRvIHsJCQkJCQkJCVwKIAlfX2k5MTVfc3df
ZmVuY2VfaW5pdCgoZmVuY2UpLCAoZm4pLCBOVUxMLCBOVUxMKQogI2VuZGlmCiAKK3ZvaWQgaTkx
NV9zd19mZW5jZV9yZWluaXQoc3RydWN0IGk5MTVfc3dfZmVuY2UgKmZlbmNlKTsKKwogI2lmZGVm
IENPTkZJR19EUk1fSTkxNV9TV19GRU5DRV9ERUJVR19PQkpFQ1RTCiB2b2lkIGk5MTVfc3dfZmVu
Y2VfZmluaShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UpOwogI2Vsc2UKLS0gCjIuMjQuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

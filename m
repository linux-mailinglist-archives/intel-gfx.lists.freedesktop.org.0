Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9A8E68E5DD
	for <lists+intel-gfx@lfdr.de>; Thu, 15 Aug 2019 10:00:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C35586E0AC;
	Thu, 15 Aug 2019 08:00:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2AC416E0AC
 for <intel-gfx@lists.freedesktop.org>; Thu, 15 Aug 2019 08:00:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18147413-1500050 
 for multiple; Thu, 15 Aug 2019 08:59:55 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 15 Aug 2019 08:59:48 +0100
Message-Id: <20190815075948.9256-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915: Replace PIN_NONFAULT with calls to
 PIN_NOEVICT
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2hlbiB1bmRlciBzZXZlcmUgc3RyZXNzIGZvciBHVFQgbWFwcGFibGUgc3BhY2UsIHRoZSBMUlUg
ZXZpY3Rpb24gbW9kZWwKZmFsbHMgb2ZmIGEgY2xpZmYuIFdlIHNwZW5kIGFsbCBvdXIgdGltZSBz
Y2FubmluZyB0aGUgbXVjaCBsYXJnZQpub24tbWFwcGFibGUgdm1hIHNlYXJjaGluZyBmb3Igc29t
ZXRoaW5nIHdpdGhpbiB0aGUgbWFwcGFibGUgem9uZSB3ZSBjYW4KZXZpY3QuIFR1cm4gdGhpcyBv
biBpdHMgaGVhZCBieSBvbmx5IHVzaW5nIHRoZSBmdWxsIHZtYSBpZiBpdCBpcyBhbHJlYWR5CnBp
bm5lZCBpbiB0aGUgbWFwcGFibGUgem9uZSBvciB0aGVyZSBpcyBzdWZmaWNpZW50ICpmcmVlKiBz
cGFjZSB0bwphY2NvbW1vZGF0ZSBpdChwcmlvcml0aXppbmcgc3BlZWR5IHJldXNlKS4gSWYgdGhl
cmUgaXMgbm90LCBpbW1lZGlhdGVseQpmYWxsIGJhY2sgdG8gdXNpbmcgc21hbGwgY2h1bmtzICh0
aWxlcm93IGZvciBHVFQgbW1hcCwgc2luZ2xlIHBhZ2VzIGZvcgpwd3JpdGUvcmVsb2NhdGlvbikg
YW5kIHVzaW5nIHJhbmRvbSBldmljdGlvbiBiZWZvcmUgZG9pbmcgYSBmdWxsIHNlYXJjaC4KClRl
c3RjYXNlOiBpZ3QvZ2VtX2NvbmN1cnJlbnRfYmx0ClJlZmVyZW5jZXM6IGh0dHBzOi8vYnVncy5m
cmVlZGVza3RvcC5vcmcvc2hvd19idWcuY2dpP2lkPTExMDg0OApTaWduZWQtb2ZmLWJ5OiBDaHJp
cyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCktlZXAgbm9uYmxvY2sgYXJv
dW5kLCBpdCBzZXJ2ZXMgYXMgYSBOT1dBUk4gZmxhZyBmb3IgdGhlIGZ1bGwgcGluLgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgfCA0ICsrLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMgICAgICAgfCA4ICsrKystLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgIHwgOCArKysr
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZpY3QuYyAgICAgICAgICB8IDgg
LS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgICAgICAgICAg
fCA2ICsrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggICAgICAgICAg
ICB8IDYgKysrLS0tCiA2IGZpbGVzIGNoYW5nZWQsIDE4IGluc2VydGlvbnMoKyksIDIyIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9l
eGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZl
ci5jCmluZGV4IDkxNTEyY2M2ZDdhNi4uNjY5ZjhlMmZmZmViIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTEwOTIsOCArMTA5Miw4IEBA
IHN0YXRpYyB2b2lkICpyZWxvY19pb21hcChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCiAJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEwsIDAsIDAsCiAJ
CQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfAotCQkJCQkgICAgICAgUElOX05PTkJMT0NLIHwKLQkJ
CQkJICAgICAgIFBJTl9OT05GQVVMVCk7CisJCQkJCSAgICAgICBQSU5fTk9OQkxPQ0sgLyogTk9X
QVJOICovIHwKKwkJCQkJICAgICAgIFBJTl9OT0VWSUNUKTsKIAkJaWYgKElTX0VSUih2bWEpKSB7
CiAJCQltZW1zZXQoJmNhY2hlLT5ub2RlLCAwLCBzaXplb2YoY2FjaGUtPm5vZGUpKTsKIAkJCWVy
ciA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5nZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9tbWFuLmMKaW5kZXggMWU3MzExNDkzNTMwLi40OTVmZjY4MTY0N2IgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAtMjY3LDE1ICsyNjcsMTUgQEAg
dm1fZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAkvKiBOb3cg
cGluIGl0IGludG8gdGhlIEdUVCBhcyBuZWVkZWQgKi8KIAl2bWEgPSBpOTE1X2dlbV9vYmplY3Rf
Z2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLAogCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfAotCQkJ
CSAgICAgICBQSU5fTk9OQkxPQ0sgfAotCQkJCSAgICAgICBQSU5fTk9ORkFVTFQpOworCQkJCSAg
ICAgICBQSU5fTk9OQkxPQ0sgLyogTk9XQVJOICovIHwKKwkJCQkgICAgICAgUElOX05PU0VBUkNI
KTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJLyogVXNlIGEgcGFydGlhbCB2aWV3IGlmIGl0IGlz
IGJpZ2dlciB0aGFuIGF2YWlsYWJsZSBzcGFjZSAqLwogCQlzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcg
dmlldyA9CiAJCQljb21wdXRlX3BhcnRpYWxfdmlldyhvYmosIHBhZ2Vfb2Zmc2V0LCBNSU5fQ0hV
TktfUEFHRVMpOwogCQl1bnNpZ25lZCBpbnQgZmxhZ3M7CiAKLQkJZmxhZ3MgPSBQSU5fTUFQUEFC
TEU7CisJCWZsYWdzID0gUElOX01BUFBBQkxFIHwgUElOX05PU0VBUkNIOwogCQlpZiAodmlldy50
eXBlID09IEk5MTVfR0dUVF9WSUVXX05PUk1BTCkKIAkJCWZsYWdzIHw9IFBJTl9OT05CTE9DSzsg
LyogYXZvaWQgd2FybmluZ3MgZm9yIHBpbm5lZCAqLwogCkBAIC0yODYsNyArMjg2LDcgQEAgdm1f
ZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAkJb2JqLT5mcm9u
dGJ1ZmZlcl9nZ3R0X29yaWdpbiA9IE9SSUdJTl9DUFU7CiAKIAkJdm1hID0gaTkxNV9nZW1fb2Jq
ZWN0X2dndHRfcGluKG9iaiwgJnZpZXcsIDAsIDAsIGZsYWdzKTsKLQkJaWYgKElTX0VSUih2bWEp
ICYmICF2aWV3LnR5cGUpIHsKKwkJaWYgKElTX0VSUih2bWEpKSB7CiAJCQlmbGFncyA9IFBJTl9N
QVBQQUJMRTsKIAkJCXZpZXcudHlwZSA9IEk5MTVfR0dUVF9WSUVXX1BBUlRJQUw7CiAJCQl2bWEg
PSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCAmdmlldywgMCwgMCwgZmxhZ3MpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggYjRjMzlhMDZmZWU1Li5jNTcwOTQ0NzEyMzIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMzQzLDggKzM0Myw4IEBAIGk5MTVfZ2VtX2d0dF9wcmVh
ZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXdha2VyZWYgPSBpbnRlbF9ydW50
aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dn
dHRfcGluKG9iaiwgTlVMTCwgMCwgMCwKIAkJCQkgICAgICAgUElOX01BUFBBQkxFIHwKLQkJCQkg
ICAgICAgUElOX05PTkZBVUxUIHwKLQkJCQkgICAgICAgUElOX05PTkJMT0NLKTsKKwkJCQkgICAg
ICAgUElOX05PTkJMT0NLIC8qIE5PV0FSTiAqLyB8CisJCQkJICAgICAgIFBJTl9OT0VWSUNUKTsK
IAlpZiAoIUlTX0VSUih2bWEpKSB7CiAJCW5vZGUuc3RhcnQgPSBpOTE1X2dndHRfb2Zmc2V0KHZt
YSk7CiAJCW5vZGUuYWxsb2NhdGVkID0gZmFsc2U7CkBAIC01NTcsOCArNTU3LDggQEAgaTkxNV9n
ZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAl2
bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLAogCQkJCSAgICAg
ICBQSU5fTUFQUEFCTEUgfAotCQkJCSAgICAgICBQSU5fTk9ORkFVTFQgfAotCQkJCSAgICAgICBQ
SU5fTk9OQkxPQ0spOworCQkJCSAgICAgICBQSU5fTk9OQkxPQ0sgLyogTk9XQVJOICovIHwKKwkJ
CQkgICAgICAgUElOX05PRVZJQ1QpOwogCWlmICghSVNfRVJSKHZtYSkpIHsKIAkJbm9kZS5zdGFy
dCA9IGk5MTVfZ2d0dF9vZmZzZXQodm1hKTsKIAkJbm9kZS5hbGxvY2F0ZWQgPSBmYWxzZTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCmluZGV4IDE3OTYzOTFiYzU5OC4uNTJjODZj
NmUwNjczIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTYxLDkgKzYx
LDYgQEAgbWFya19mcmVlKHN0cnVjdCBkcm1fbW1fc2NhbiAqc2NhbiwKIAlpZiAoaTkxNV92bWFf
aXNfcGlubmVkKHZtYSkpCiAJCXJldHVybiBmYWxzZTsKIAotCWlmIChmbGFncyAmIFBJTl9OT05G
QVVMVCAmJiBpOTE1X3ZtYV9oYXNfdXNlcmZhdWx0KHZtYSkpCi0JCXJldHVybiBmYWxzZTsKLQog
CWxpc3RfYWRkKCZ2bWEtPmV2aWN0X2xpbmssIHVud2luZCk7CiAJcmV0dXJuIGRybV9tbV9zY2Fu
X2FkZF9ibG9jayhzY2FuLCAmdm1hLT5ub2RlKTsKIH0KQEAgLTMzMCwxMSArMzI3LDYgQEAgaW50
IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAog
CQkJYnJlYWs7CiAJCX0KIAotCQlpZiAoZmxhZ3MgJiBQSU5fTk9ORkFVTFQgJiYgaTkxNV92bWFf
aGFzX3VzZXJmYXVsdCh2bWEpKSB7Ci0JCQlyZXQgPSAtRU5PU1BDOwotCQkJYnJlYWs7Ci0JCX0K
LQogCQkvKiBPdmVybGFwIG9mIG9iamVjdHMgaW4gdGhlIHNhbWUgYmF0Y2g/ICovCiAJCWlmIChp
OTE1X3ZtYV9pc19waW5uZWQodm1hKSkgewogCQkJcmV0ID0gLUVOT1NQQzsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMKaW5kZXggZTA3YzFhZTk3MWQ3Li5hM2Y0YTI5NmQ2NWYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0zNzQ3LDcgKzM3NDcsOCBAQCBpbnQgaTkx
NV9nZW1fZ3R0X2luc2VydChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlpZiAoZmxh
Z3MgJiBQSU5fTk9FVklDVCkKIAkJcmV0dXJuIC1FTk9TUEM7CiAKLQkvKiBObyBmcmVlIHNwYWNl
LCBwaWNrIGEgc2xvdCBhdCByYW5kb20uCisJLyoKKwkgKiBObyBmcmVlIHNwYWNlLCBwaWNrIGEg
c2xvdCBhdCByYW5kb20uCiAJICoKIAkgKiBUaGVyZSBpcyBhIHBhdGhvbG9naWNhbCBjYXNlIGhl
cmUgdXNpbmcgYSBHVFQgc2hhcmVkIGJldHdlZW4KIAkgKiBtbWFwIGFuZCBHUFUgKGkuZS4gZ2d0
dC9hbGlhc2luZ19wcGd0dCBidXQgbm90IGZ1bGwtcHBndHQpOgpAQCAtMzc3NSw2ICszNzc2LDkg
QEAgaW50IGk5MTVfZ2VtX2d0dF9pbnNlcnQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
CiAJaWYgKGVyciAhPSAtRU5PU1BDKQogCQlyZXR1cm4gZXJyOwogCisJaWYgKGZsYWdzICYgUElO
X05PU0VBUkNIKQorCQlyZXR1cm4gLUVOT1NQQzsKKwogCS8qIFJhbmRvbWx5IHNlbGVjdGVkIHBs
YWNlbWVudCBpcyBwaW5uZWQsIGRvIGEgc2VhcmNoICovCiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rf
c29tZXRoaW5nKHZtLCBzaXplLCBhbGlnbm1lbnQsIGNvbG9yLAogCQkJCSAgICAgICBzdGFydCwg
ZW5kLCBmbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4IDUxMjc0NDgz
NTAyZS4uYjk3YTQ3ZmM3YTY4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbV9ndHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAt
NjAwLDkgKzYwMCw5IEBAIGludCBpOTE1X2dlbV9ndHRfaW5zZXJ0KHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtLAogCQkJdTY0IHN0YXJ0LCB1NjQgZW5kLCB1bnNpZ25lZCBpbnQgZmxhZ3Mp
OwogCiAvKiBGbGFncyB1c2VkIGJ5IHBpbi9iaW5kJmZyaWVuZHMuICovCi0jZGVmaW5lIFBJTl9O
T05CTE9DSwkJQklUX1VMTCgwKQotI2RlZmluZSBQSU5fTk9ORkFVTFQJCUJJVF9VTEwoMSkKLSNk
ZWZpbmUgUElOX05PRVZJQ1QJCUJJVF9VTEwoMikKKyNkZWZpbmUgUElOX05PRVZJQ1QJCUJJVF9V
TEwoMCkKKyNkZWZpbmUgUElOX05PU0VBUkNICQlCSVRfVUxMKDEpCisjZGVmaW5lIFBJTl9OT05C
TE9DSwkJQklUX1VMTCgyKQogI2RlZmluZSBQSU5fTUFQUEFCTEUJCUJJVF9VTEwoMykKICNkZWZp
bmUgUElOX1pPTkVfNEcJCUJJVF9VTEwoNCkKICNkZWZpbmUgUElOX0hJR0gJCUJJVF9VTEwoNSkK
LS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

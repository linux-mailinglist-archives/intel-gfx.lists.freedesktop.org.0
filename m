Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E88DAE2D0D
	for <lists+intel-gfx@lfdr.de>; Thu, 24 Oct 2019 11:20:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3DB6F6E1A5;
	Thu, 24 Oct 2019 09:20:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 86C886E1A4
 for <intel-gfx@lists.freedesktop.org>; Thu, 24 Oct 2019 09:19:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18946544-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 24 Oct 2019 10:19:56 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 24 Oct 2019 10:19:52 +0100
Message-Id: <20191024091954.18451-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
In-Reply-To: <20191024091954.18451-1-chris@chris-wilson.co.uk>
References: <20191024091954.18451-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 5/7] drm/i915/selftests: extend coverage to include
 LMEM huge-pages
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgoKQWRkIExNRU0gb2Jq
ZWN0cyB0byBsaXN0IG9mIGJhY2tlbmRzIHdlIHRlc3QgZm9yIGh1Z2UtR1RULXBhZ2VzLgoKU2ln
bmVkLW9mZi1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgpSZXZpZXdl
ZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogLi4uL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYyAgIHwgMTIxICsrKysrKysrKysr
KysrKysrLQogMSBmaWxlIGNoYW5nZWQsIDEyMCBpbnNlcnRpb25zKCspLCAxIGRlbGV0aW9uKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3Bh
Z2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwpp
bmRleCBkYWM4MzQ0NTA3YzEuLjY4N2U5YWM5YjU4YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKQEAgLTksNiArOSw3IEBACiAjaW5jbHVk
ZSAiaTkxNV9zZWxmdGVzdC5oIgogCiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3JlZ2lvbi5oIgor
I2luY2x1ZGUgImdlbS9pOTE1X2dlbV9sbWVtLmgiCiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3Bt
LmgiCiAKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgpAQCAtOTgzLDcgKzk4NCw3IEBAIHN0YXRp
YyBpbnQgZ3B1X3dyaXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCSAgICAgICB2bWEt
PnNpemUgPj4gUEFHRV9TSElGVCwgdmFsKTsKIH0KIAotc3RhdGljIGludCBjcHVfY2hlY2soc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdTMyIGR3b3JkLCB1MzIgdmFsKQorc3RhdGlj
IGludCBfX2NwdV9jaGVja19zaG1lbShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1
MzIgZHdvcmQsIHUzMiB2YWwpCiB7CiAJdW5zaWduZWQgaW50IG5lZWRzX2ZsdXNoOwogCXVuc2ln
bmVkIGxvbmcgbjsKQEAgLTEwMTUsNiArMTAxNiw1MSBAQCBzdGF0aWMgaW50IGNwdV9jaGVjayhz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1MzIgZHdvcmQsIHUzMiB2YWwpCiAJcmV0
dXJuIGVycjsKIH0KIAorc3RhdGljIGludCBfX2NwdV9jaGVja19sbWVtKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosIHUzMiBkd29yZCwgdTMyIHZhbCkKK3sKKwl1bnNpZ25lZCBsb25n
IG47CisJaW50IGVycjsKKworCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CisJZXJyID0gaTkx
NV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4ob2JqLCBmYWxzZSk7CisJaTkxNV9nZW1fb2Jq
ZWN0X3VubG9jayhvYmopOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSBpOTE1
X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKwor
CWZvciAobiA9IDA7IG4gPCBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOyArK24pIHsKKwkJ
dTMyIF9faW9tZW0gKmJhc2U7CisJCXUzMiByZWFkX3ZhbDsKKworCQliYXNlID0gaTkxNV9nZW1f
b2JqZWN0X2xtZW1faW9fbWFwX3BhZ2VfYXRvbWljKG9iaiwgbik7CisKKwkJcmVhZF92YWwgPSBp
b3JlYWQzMihiYXNlICsgZHdvcmQpOworCQlpb19tYXBwaW5nX3VubWFwX2F0b21pYyhiYXNlKTsK
KwkJaWYgKHJlYWRfdmFsICE9IHZhbCkgeworCQkJcHJfZXJyKCJuPSVsdSBiYXNlWyV1XT0ldSwg
dmFsPSV1XG4iLAorCQkJICAgICAgIG4sIGR3b3JkLCByZWFkX3ZhbCwgdmFsKTsKKwkJCWVyciA9
IC1FSU5WQUw7CisJCQlicmVhazsKKwkJfQorCX0KKworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9w
YWdlcyhvYmopOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgY3B1X2NoZWNrKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHUzMiBkd29yZCwgdTMyIHZhbCkKK3sKKwlpZiAo
aTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFnZShvYmopKQorCQlyZXR1cm4gX19jcHVfY2hl
Y2tfc2htZW0ob2JqLCBkd29yZCwgdmFsKTsKKwllbHNlIGlmIChpOTE1X2dlbV9vYmplY3RfaXNf
bG1lbShvYmopKQorCQlyZXR1cm4gX19jcHVfY2hlY2tfbG1lbShvYmosIGR3b3JkLCB2YWwpOwor
CisJcmV0dXJuIC1FTk9ERVY7Cit9CisKIHN0YXRpYyBpbnQgX19pZ3Rfd3JpdGVfaHVnZShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkgICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKIAkJCSAgICB1NjQgc2l6ZSwgdTY0IG9mZnNldCwKQEAgLTEzOTksNiArMTQ0NSw3OCBA
QCBzdGF0aWMgaW50IGlndF9wcGd0dF9nZW1mc19odWdlKHZvaWQgKmFyZykKIAlyZXR1cm4gZXJy
OwogfQogCitzdGF0aWMgaW50IGlndF9wcGd0dF9sbWVtX2h1Z2Uodm9pZCAqYXJnKQoreworCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBhcmc7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBjdHgtPmk5MTU7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsK
KwlzdGF0aWMgY29uc3QgdW5zaWduZWQgaW50IHNpemVzW10gPSB7CisJCVNaXzY0SywKKwkJU1pf
NTEySywKKwkJU1pfMU0sCisJCVNaXzJNLAorCX07CisJaW50IGk7CisJaW50IGVycjsKKworCWlm
ICghSEFTX0xNRU0oaTkxNSkpIHsKKwkJcHJfaW5mbygiZGV2aWNlIGxhY2tzIExNRU0gc3VwcG9y
dCwgc2tpcHBpbmdcbiIpOworCQlyZXR1cm4gMDsKKwl9CisKKwkvKgorCSAqIFNhbml0eSBjaGVj
ayB0aGF0IHRoZSBIVyB1c2VzIGh1Z2UgcGFnZXMgY29ycmVjdGx5IHRocm91Z2ggTE1FTQorCSAq
IC0tIGVuc3VyZSB0aGF0IG91ciB3cml0ZXMgbGFuZCBpbiB0aGUgcmlnaHQgcGxhY2UuCisJICov
CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShzaXplcyk7ICsraSkgeworCQl1bnNpZ25l
ZCBpbnQgc2l6ZSA9IHNpemVzW2ldOworCisJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
bG1lbShpOTE1LCBzaXplLCBJOTE1X0JPX0FMTE9DX0NPTlRJR1VPVVMpOworCQlpZiAoSVNfRVJS
KG9iaikpIHsKKwkJCWVyciA9IFBUUl9FUlIob2JqKTsKKwkJCWlmIChlcnIgPT0gLUUyQklHKSB7
CisJCQkJcHJfaW5mbygib2JqZWN0IHRvbyBiaWcgZm9yIHJlZ2lvbiFcbiIpOworCQkJCXJldHVy
biAwOworCQkJfQorCisJCQlyZXR1cm4gZXJyOworCQl9CisKKwkJZXJyID0gaTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9wYWdlcyhvYmopOworCQlpZiAoZXJyKQorCQkJZ290byBvdXRfcHV0OworCisJCWlm
IChvYmotPm1tLnBhZ2Vfc2l6ZXMucGh5cyA8IEk5MTVfR1RUX1BBR0VfU0laRV82NEspIHsKKwkJ
CXByX2luZm8oIkxNRU0gdW5hYmxlIHRvIGFsbG9jYXRlIGh1Z2UtcGFnZShzKSB3aXRoIHNpemU9
JXVcbiIsCisJCQkJc2l6ZSk7CisJCQlnb3RvIG91dF91bnBpbjsKKwkJfQorCisJCWVyciA9IGln
dF93cml0ZV9odWdlKGN0eCwgb2JqKTsKKwkJaWYgKGVycikgeworCQkJcHJfZXJyKCJMTUVNIHdy
aXRlLWh1Z2UgZmFpbGVkIHdpdGggc2l6ZT0ldVxuIiwgc2l6ZSk7CisJCQlnb3RvIG91dF91bnBp
bjsKKwkJfQorCisJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOworCQlfX2k5MTVf
Z2VtX29iamVjdF9wdXRfcGFnZXMob2JqLCBJOTE1X01NX05PUk1BTCk7CisJCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKKwl9CisKKwlyZXR1cm4gMDsKKworb3V0X3VucGluOgorCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9wYWdlcyhvYmopOworb3V0X3B1dDoKKwlpOTE1X2dlbV9vYmplY3RfcHV0
KG9iaik7CisKKwlpZiAoZXJyID09IC1FTk9NRU0pCisJCWVyciA9IDA7CisKKwlyZXR1cm4gZXJy
OworfQorCiBzdGF0aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIHsKIAlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gYXJnOwpAQCAtMTc2MCw2ICsxODc4LDcgQEAg
aW50IGk5MTVfZ2VtX2h1Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAkJU1VCVEVTVChpZ3RfcHBndHRfZXhoYXVzdF9odWdlKSwKIAkJU1VCVEVT
VChpZ3RfcHBndHRfZ2VtZnNfaHVnZSksCiAJCVNVQlRFU1QoaWd0X3BwZ3R0X2ludGVybmFsX2h1
Z2UpLAorCQlTVUJURVNUKGlndF9wcGd0dF9sbWVtX2h1Z2UpLAogCX07CiAJc3RydWN0IGRybV9m
aWxlICpmaWxlOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0tIAoyLjI0LjAucmMw
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1n
ZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

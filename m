Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3675A27FE26
	for <lists+intel-gfx@lfdr.de>; Thu,  1 Oct 2020 13:11:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8936C6E175;
	Thu,  1 Oct 2020 11:11:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 65A396E175
 for <intel-gfx@lists.freedesktop.org>; Thu,  1 Oct 2020 11:10:57 +0000 (UTC)
IronPort-SDR: 1dEDNp5hlBRzHRNFT6UDe/VSJg/t11gAgndjJ2QCoxq5dJPOPVzcRnLu9rfqgAteq4rPQW7YFq
 ZCoTDLnVGKsg==
X-IronPort-AV: E=McAfee;i="6000,8403,9760"; a="161932271"
X-IronPort-AV: E=Sophos;i="5.77,323,1596524400"; d="scan'208";a="161932271"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 01 Oct 2020 04:10:57 -0700
IronPort-SDR: QQJYXqOgRueg7sJhv3LjnyOH7crM9wmo8lwaXm8XMG5rOJ9R1boVlI0BnENSyQMKAHFefiXgrt
 etcL2eiKDtPQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.77,323,1596524400"; d="scan'208";a="312987500"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga006.jf.intel.com with SMTP; 01 Oct 2020 04:10:52 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 01 Oct 2020 14:10:53 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  1 Oct 2020 14:10:53 +0300
Message-Id: <20201001111053.24451-1-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20200929233449.32323-11-ville.syrjala@linux.intel.com>
References: <20200929233449.32323-11-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 10/11] drm/i915: Plumb crtc_state to link
 training
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkdl
dCByaWQgb2YgbW9kZSBjcnRjLT5jb25maWcgdXNhZ2UsIGFuZCBzb21lIGFkLWhvYyBpbnRlbF9k
cCBzdGF0ZQp1c2FnZSBieSBwbHVtYmluZyB0aGUgY3J0YyBzdGF0ZSBhbGwgdGhlIHdheSBkb3du
IHRvIHRoZSBsaW5rIHRyYWluaW5nCmNvZGUuCgpVbmZvcnR1bmF0ZWx5IHdlIGRvIGhhdmUgdG8g
a2VlcCBzb21lIGNhY2hlZCBzdGF0ZSBpbiBpbnRlbF9kcCBzbwp0aGF0IHdlIGNhbiBkbyB0aGUg
ImRvZXMgdGhlIGxpbmsgbmVlZCByZXRyYWluaW5nPyIgY2hlY2tzIGZyb20KdGhlIHNob3J0IGhw
ZCBoYW5kbGVyLgoKdjI6IEFkZCBpbnRlbF9jcnRjX3N0YXRlIGZvcndhcmQgZGVjbGFyYXRpb24K
djM6IERvbid0IGtpbGwgdGhlIFBIWSB0ZXN0IGNvZGUgdG90YWxseSBzaW5jZSBpdCdzCiAgICBu
b3cgaW4gdGhlIGhvdHBsdWcgd29yayB3aGVyZSB3ZSBjYW4gZ2V0IGF0IHRoZSBzdGF0ZXMKdjQ6
IERvbid0IHJlc3VycmVjdCB0aGUgZGVidWcgc2NyYW1ibGluZyBkaXNhYmxlIGJpdCAoSW1yZSkK
ICAgIFVzZSBpbnRlbF9kcF9tc3RfaXNfbWFzdGVyX3RyYW5zKCkgKEltcmUpCgpSZXZpZXdlZC1i
eTogSW1yZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBWaWxsZSBT
eXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgICAgICB8IDQxMyArKysrKysrKystLS0tLS0t
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmggICAgICB8ICAgNiAr
LQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oICAgIHwgIDE3ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCAxMjMgKysr
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmggICAgICAgfCAgMTAg
Ky0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2xpbmtfdHJhaW5pbmcuYyB8IDEwMiAr
KystLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbGlua190cmFpbmluZy5oIHwgICA4
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmMgfCAgMjMg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBpb19waHkuaCB8ICAgMiAr
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2hkbWkuYyAgICAgfCAgIDcgKy0K
IDEwIGZpbGVzIGNoYW5nZWQsIDM4NiBpbnNlcnRpb25zKCspLCAzMjUgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKaW5kZXggNzAzMmMzNjcwNzVh
Li5kYmYwZmZjMDVjOGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGRpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGku
YwpAQCAtMTAzNCw3ICsxMDM0LDggQEAgY25sX2dldF9idWZfdHJhbnNfZWRwKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLCBpbnQgKm5fZW50cmllcykKIH0KIAogc3RhdGljIGNvbnN0IHN0
cnVjdCBjbmxfZGRpX2J1Zl90cmFucyAqCi1pY2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19oZG1pKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgdHlwZSwgaW50IHJhdGUsCitpY2xfZ2V0
X2NvbWJvX2J1Zl90cmFuc19oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJ
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAg
aW50ICpuX2VudHJpZXMpCiB7CiAJKm5fZW50cmllcyA9IEFSUkFZX1NJWkUoaWNsX2NvbWJvX3Bo
eV9kZGlfdHJhbnNsYXRpb25zX2hkbWkpOwpAQCAtMTA0Miw3ICsxMDQzLDggQEAgaWNsX2dldF9j
b21ib19idWZfdHJhbnNfaGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IHR5
cGUsIGludCByYXRlLAogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGNubF9kZGlfYnVmX3RyYW5z
ICoKLWljbF9nZXRfY29tYm9fYnVmX3RyYW5zX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLCBpbnQgdHlwZSwgaW50IHJhdGUsCitpY2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19kcChzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgaW50ICpuX2VudHJpZXMpCiB7CiAJKm5fZW50cmll
cyA9IEFSUkFZX1NJWkUoaWNsX2NvbWJvX3BoeV9kZGlfdHJhbnNsYXRpb25zX2RwX2hicjIpOwpA
QCAtMTA1MCwxMiArMTA1MiwxMyBAQCBpY2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19kcChzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IHR5cGUsIGludCByYXRlLAogfQogCiBzdGF0aWMg
Y29uc3Qgc3RydWN0IGNubF9kZGlfYnVmX3RyYW5zICoKLWljbF9nZXRfY29tYm9fYnVmX3RyYW5z
X2VkcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IHR5cGUsIGludCByYXRlLAor
aWNsX2dldF9jb21ib19idWZfdHJhbnNfZWRwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAorCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJ
ICAgIGludCAqbl9lbnRyaWVzKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCi0JaWYgKHJhdGUgPiA1NDAwMDApIHsK
KwlpZiAoY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayA+IDU0MDAwMCkgewogCQkqbl9lbnRyaWVzID0g
QVJSQVlfU0laRShpY2xfY29tYm9fcGh5X2RkaV90cmFuc2xhdGlvbnNfZWRwX2hicjMpOwogCQly
ZXR1cm4gaWNsX2NvbWJvX3BoeV9kZGlfdHJhbnNsYXRpb25zX2VkcF9oYnIzOwogCX0gZWxzZSBp
ZiAoZGV2X3ByaXYtPnZidC5lZHAubG93X3Zzd2luZykgewpAQCAtMTA2MywyMyArMTA2NiwyNSBA
QCBpY2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19lZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKIAkJcmV0dXJuIGljbF9jb21ib19waHlfZGRpX3RyYW5z
bGF0aW9uc19lZHBfaGJyMjsKIAl9CiAKLQlyZXR1cm4gaWNsX2dldF9jb21ib19idWZfdHJhbnNf
ZHAoZW5jb2RlciwgdHlwZSwgcmF0ZSwgbl9lbnRyaWVzKTsKKwlyZXR1cm4gaWNsX2dldF9jb21i
b19idWZfdHJhbnNfZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbl9lbnRyaWVzKTsKIH0KIAogc3Rh
dGljIGNvbnN0IHN0cnVjdCBjbmxfZGRpX2J1Zl90cmFucyAqCi1pY2xfZ2V0X2NvbWJvX2J1Zl90
cmFucyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IHR5cGUsIGludCByYXRlLAor
aWNsX2dldF9jb21ib19idWZfdHJhbnMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJ
CQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCWludCAqbl9l
bnRyaWVzKQogewotCWlmICh0eXBlID09IElOVEVMX09VVFBVVF9IRE1JKQotCQlyZXR1cm4gaWNs
X2dldF9jb21ib19idWZfdHJhbnNfaGRtaShlbmNvZGVyLCB0eXBlLCByYXRlLCBuX2VudHJpZXMp
OwotCWVsc2UgaWYgKHR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkKLQkJcmV0dXJuIGljbF9nZXRf
Y29tYm9fYnVmX3RyYW5zX2VkcChlbmNvZGVyLCB0eXBlLCByYXRlLCBuX2VudHJpZXMpOworCWlm
IChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9IRE1JKSkKKwkJ
cmV0dXJuIGljbF9nZXRfY29tYm9fYnVmX3RyYW5zX2hkbWkoZW5jb2RlciwgY3J0Y19zdGF0ZSwg
bl9lbnRyaWVzKTsKKwllbHNlIGlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElO
VEVMX09VVFBVVF9FRFApKQorCQlyZXR1cm4gaWNsX2dldF9jb21ib19idWZfdHJhbnNfZWRwKGVu
Y29kZXIsIGNydGNfc3RhdGUsIG5fZW50cmllcyk7CiAJZWxzZQotCQlyZXR1cm4gaWNsX2dldF9j
b21ib19idWZfdHJhbnNfZHAoZW5jb2RlciwgdHlwZSwgcmF0ZSwgbl9lbnRyaWVzKTsKKwkJcmV0
dXJuIGljbF9nZXRfY29tYm9fYnVmX3RyYW5zX2RwKGVuY29kZXIsIGNydGNfc3RhdGUsIG5fZW50
cmllcyk7CiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaWNsX21nX3BoeV9kZGlfYnVmX3RyYW5z
ICoKLWljbF9nZXRfbWdfYnVmX3RyYW5zX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKK2ljbF9nZXRfbWdfYnVmX3RyYW5zX2hkbWkoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogCQkJICBpbnQgKm5fZW50cmllcykKIHsKIAkqbl9lbnRyaWVzID0g
QVJSQVlfU0laRShpY2xfbWdfcGh5X2RkaV90cmFuc2xhdGlvbnNfaGRtaSk7CkBAIC0xMDg3LDEw
ICsxMDkyLDExIEBAIGljbF9nZXRfbWdfYnVmX3RyYW5zX2hkbWkoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVj
dCBpY2xfbWdfcGh5X2RkaV9idWZfdHJhbnMgKgotaWNsX2dldF9tZ19idWZfdHJhbnNfZHAoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKK2ljbF9nZXRf
bWdfYnVmX3RyYW5zX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQlpbnQgKm5fZW50cmllcykK
IHsKLQlpZiAocmF0ZSA+IDI3MDAwMCkgeworCWlmIChjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrID4g
MjcwMDAwKSB7CiAJCSpuX2VudHJpZXMgPSBBUlJBWV9TSVpFKGljbF9tZ19waHlfZGRpX3RyYW5z
bGF0aW9uc19oYnIyX2hicjMpOwogCQlyZXR1cm4gaWNsX21nX3BoeV9kZGlfdHJhbnNsYXRpb25z
X2hicjJfaGJyMzsKIAl9IGVsc2UgewpAQCAtMTEwMCwxNyArMTEwNiwxOSBAQCBpY2xfZ2V0X21n
X2J1Zl90cmFuc19kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IHR5cGUsIGlu
dCByYXRlLAogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGljbF9tZ19waHlfZGRpX2J1Zl90cmFu
cyAqCi1pY2xfZ2V0X21nX2J1Zl90cmFucyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rlciwg
aW50IHR5cGUsIGludCByYXRlLAoraWNsX2dldF9tZ19idWZfdHJhbnMoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCisJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCSAgICAgaW50ICpuX2VudHJpZXMpCiB7Ci0JaWYgKHR5cGUgPT0gSU5URUxf
T1VUUFVUX0hETUkpCi0JCXJldHVybiBpY2xfZ2V0X21nX2J1Zl90cmFuc19oZG1pKGVuY29kZXIs
IHR5cGUsIHJhdGUsIG5fZW50cmllcyk7CisJaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19z
dGF0ZSwgSU5URUxfT1VUUFVUX0hETUkpKQorCQlyZXR1cm4gaWNsX2dldF9tZ19idWZfdHJhbnNf
aGRtaShlbmNvZGVyLCBjcnRjX3N0YXRlLCBuX2VudHJpZXMpOwogCWVsc2UKLQkJcmV0dXJuIGlj
bF9nZXRfbWdfYnVmX3RyYW5zX2RwKGVuY29kZXIsIHR5cGUsIHJhdGUsIG5fZW50cmllcyk7CisJ
CXJldHVybiBpY2xfZ2V0X21nX2J1Zl90cmFuc19kcChlbmNvZGVyLCBjcnRjX3N0YXRlLCBuX2Vu
dHJpZXMpOwogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGNubF9kZGlfYnVmX3RyYW5zICoKLWVo
bF9nZXRfY29tYm9fYnVmX3RyYW5zX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
IGludCB0eXBlLCBpbnQgcmF0ZSwKK2VobF9nZXRfY29tYm9fYnVmX3RyYW5zX2hkbWkoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICBpbnQgKm5fZW50cmllcykKIHsKIAkqbl9lbnRy
aWVzID0gQVJSQVlfU0laRShpY2xfY29tYm9fcGh5X2RkaV90cmFuc2xhdGlvbnNfaGRtaSk7CkBA
IC0xMTE4LDcgKzExMjYsOCBAQCBlaGxfZ2V0X2NvbWJvX2J1Zl90cmFuc19oZG1pKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgdHlwZSwgaW50IHJhdGUsCiB9CiAKIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgY25sX2RkaV9idWZfdHJhbnMgKgotZWhsX2dldF9jb21ib19idWZfdHJhbnNf
ZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKK2Vo
bF9nZXRfY29tYm9fYnVmX3RyYW5zX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAor
CQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICBp
bnQgKm5fZW50cmllcykKIHsKIAkqbl9lbnRyaWVzID0gQVJSQVlfU0laRShlaGxfY29tYm9fcGh5
X2RkaV90cmFuc2xhdGlvbnNfZHApOwpAQCAtMTEyNiwxMyArMTEzNSwxNCBAQCBlaGxfZ2V0X2Nv
bWJvX2J1Zl90cmFuc19kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IHR5cGUs
IGludCByYXRlLAogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGNubF9kZGlfYnVmX3RyYW5zICoK
LWVobF9nZXRfY29tYm9fYnVmX3RyYW5zX2VkcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwgaW50IHR5cGUsIGludCByYXRlLAorZWhsX2dldF9jb21ib19idWZfdHJhbnNfZWRwKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgIGludCAqbl9lbnRyaWVzKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CiAJaWYgKGRldl9wcml2LT52YnQuZWRwLmxvd192c3dpbmcpIHsKLQkJaWYgKHJhdGUgPiA1NDAw
MDApIHsKKwkJaWYgKGNydGNfc3RhdGUtPnBvcnRfY2xvY2sgPiA1NDAwMDApIHsKIAkJCSpuX2Vu
dHJpZXMgPSBBUlJBWV9TSVpFKGljbF9jb21ib19waHlfZGRpX3RyYW5zbGF0aW9uc19lZHBfaGJy
Myk7CiAJCQlyZXR1cm4gaWNsX2NvbWJvX3BoeV9kZGlfdHJhbnNsYXRpb25zX2VkcF9oYnIzOwog
CQl9IGVsc2UgewpAQCAtMTE0MSwyMyArMTE1MSwyNSBAQCBlaGxfZ2V0X2NvbWJvX2J1Zl90cmFu
c19lZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwK
IAkJfQogCX0KIAotCXJldHVybiBlaGxfZ2V0X2NvbWJvX2J1Zl90cmFuc19kcChlbmNvZGVyLCB0
eXBlLCByYXRlLCBuX2VudHJpZXMpOworCXJldHVybiBlaGxfZ2V0X2NvbWJvX2J1Zl90cmFuc19k
cChlbmNvZGVyLCBjcnRjX3N0YXRlLCBuX2VudHJpZXMpOwogfQogCiBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGNubF9kZGlfYnVmX3RyYW5zICoKLWVobF9nZXRfY29tYm9fYnVmX3RyYW5zKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgdHlwZSwgaW50IHJhdGUsCitlaGxfZ2V0X2NvbWJv
X2J1Zl90cmFucyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCWNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJaW50ICpuX2VudHJpZXMpCiB7Ci0J
aWYgKHR5cGUgPT0gSU5URUxfT1VUUFVUX0hETUkpCi0JCXJldHVybiBlaGxfZ2V0X2NvbWJvX2J1
Zl90cmFuc19oZG1pKGVuY29kZXIsIHR5cGUsIHJhdGUsIG5fZW50cmllcyk7Ci0JZWxzZSBpZiAo
dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKQotCQlyZXR1cm4gZWhsX2dldF9jb21ib19idWZfdHJh
bnNfZWRwKGVuY29kZXIsIHR5cGUsIHJhdGUsIG5fZW50cmllcyk7CisJaWYgKGludGVsX2NydGNf
aGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0hETUkpKQorCQlyZXR1cm4gZWhsX2dl
dF9jb21ib19idWZfdHJhbnNfaGRtaShlbmNvZGVyLCBjcnRjX3N0YXRlLCBuX2VudHJpZXMpOwor
CWVsc2UgaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0VE
UCkpCisJCXJldHVybiBlaGxfZ2V0X2NvbWJvX2J1Zl90cmFuc19lZHAoZW5jb2RlciwgY3J0Y19z
dGF0ZSwgbl9lbnRyaWVzKTsKIAllbHNlCi0JCXJldHVybiBlaGxfZ2V0X2NvbWJvX2J1Zl90cmFu
c19kcChlbmNvZGVyLCB0eXBlLCByYXRlLCBuX2VudHJpZXMpOworCQlyZXR1cm4gZWhsX2dldF9j
b21ib19idWZfdHJhbnNfZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbl9lbnRyaWVzKTsKIH0KIAog
c3RhdGljIGNvbnN0IHN0cnVjdCBjbmxfZGRpX2J1Zl90cmFucyAqCi10Z2xfZ2V0X2NvbWJvX2J1
Zl90cmFuc19oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgdHlwZSwgaW50
IHJhdGUsCit0Z2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAorCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkJCSAgICAgaW50ICpuX2VudHJpZXMpCiB7CiAJKm5fZW50cmllcyA9IEFSUkFZX1NJ
WkUoaWNsX2NvbWJvX3BoeV9kZGlfdHJhbnNsYXRpb25zX2hkbWkpOwpAQCAtMTE2NSwxMiArMTE3
NywxMyBAQCB0Z2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLCBpbnQgdHlwZSwgaW50IHJhdGUsCiB9CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3Qg
Y25sX2RkaV9idWZfdHJhbnMgKgotdGdsX2dldF9jb21ib19idWZfdHJhbnNfZHAoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKK3RnbF9nZXRfY29tYm9f
YnVmX3RyYW5zX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJICAgY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICBpbnQgKm5fZW50cmll
cykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKIAotCWlmIChyYXRlID4gMjcwMDAwKSB7CisJaWYgKGNydGNfc3RhdGUt
PnBvcnRfY2xvY2sgPiAyNzAwMDApIHsKIAkJaWYgKElTX1RHTF9VKGRldl9wcml2KSB8fCBJU19U
R0xfWShkZXZfcHJpdikpIHsKIAkJCSpuX2VudHJpZXMgPSBBUlJBWV9TSVpFKHRnbF91eV9jb21i
b19waHlfZGRpX3RyYW5zbGF0aW9uc19kcF9oYnIyKTsKIAkJCXJldHVybiB0Z2xfdXlfY29tYm9f
cGh5X2RkaV90cmFuc2xhdGlvbnNfZHBfaGJyMjsKQEAgLTExODUsMTMgKzExOTgsMTQgQEAgdGds
X2dldF9jb21ib19idWZfdHJhbnNfZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGlu
dCB0eXBlLCBpbnQgcmF0ZSwKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBjbmxfZGRpX2J1Zl90
cmFucyAqCi10Z2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19lZHAoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKK3RnbF9nZXRfY29tYm9fYnVmX3RyYW5zX2Vk
cChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICBpbnQgKm5fZW50cmllcykKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29k
ZXIpOwogCi0JaWYgKHJhdGUgPiA1NDAwMDApIHsKKwlpZiAoY3J0Y19zdGF0ZS0+cG9ydF9jbG9j
ayA+IDU0MDAwMCkgewogCQkqbl9lbnRyaWVzID0gQVJSQVlfU0laRShpY2xfY29tYm9fcGh5X2Rk
aV90cmFuc2xhdGlvbnNfZWRwX2hicjMpOwogCQlyZXR1cm4gaWNsX2NvbWJvX3BoeV9kZGlfdHJh
bnNsYXRpb25zX2VkcF9oYnIzOwogCX0gZWxzZSBpZiAoZGV2X3ByaXYtPnZidC5lZHAuaG9ibCAm
JiAhaW50ZWxfZHAtPmhvYmxfZmFpbGVkKSB7CkBAIC0xMjAyLDIzICsxMjE2LDI1IEBAIHRnbF9n
ZXRfY29tYm9fYnVmX3RyYW5zX2VkcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50
IHR5cGUsIGludCByYXRlLAogCQlyZXR1cm4gaWNsX2NvbWJvX3BoeV9kZGlfdHJhbnNsYXRpb25z
X2VkcF9oYnIyOwogCX0KIAotCXJldHVybiB0Z2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19kcChlbmNv
ZGVyLCB0eXBlLCByYXRlLCBuX2VudHJpZXMpOworCXJldHVybiB0Z2xfZ2V0X2NvbWJvX2J1Zl90
cmFuc19kcChlbmNvZGVyLCBjcnRjX3N0YXRlLCBuX2VudHJpZXMpOwogfQogCiBzdGF0aWMgY29u
c3Qgc3RydWN0IGNubF9kZGlfYnVmX3RyYW5zICoKLXRnbF9nZXRfY29tYm9fYnVmX3RyYW5zKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgdHlwZSwgaW50IHJhdGUsCit0Z2xfZ2V0
X2NvbWJvX2J1Zl90cmFucyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCWNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJaW50ICpuX2VudHJpZXMp
CiB7Ci0JaWYgKHR5cGUgPT0gSU5URUxfT1VUUFVUX0hETUkpCi0JCXJldHVybiB0Z2xfZ2V0X2Nv
bWJvX2J1Zl90cmFuc19oZG1pKGVuY29kZXIsIHR5cGUsIHJhdGUsIG5fZW50cmllcyk7Ci0JZWxz
ZSBpZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKQotCQlyZXR1cm4gdGdsX2dldF9jb21ib19i
dWZfdHJhbnNfZWRwKGVuY29kZXIsIHR5cGUsIHJhdGUsIG5fZW50cmllcyk7CisJaWYgKGludGVs
X2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0hETUkpKQorCQlyZXR1cm4g
dGdsX2dldF9jb21ib19idWZfdHJhbnNfaGRtaShlbmNvZGVyLCBjcnRjX3N0YXRlLCBuX2VudHJp
ZXMpOworCWVsc2UgaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VU
UFVUX0VEUCkpCisJCXJldHVybiB0Z2xfZ2V0X2NvbWJvX2J1Zl90cmFuc19lZHAoZW5jb2Rlciwg
Y3J0Y19zdGF0ZSwgbl9lbnRyaWVzKTsKIAllbHNlCi0JCXJldHVybiB0Z2xfZ2V0X2NvbWJvX2J1
Zl90cmFuc19kcChlbmNvZGVyLCB0eXBlLCByYXRlLCBuX2VudHJpZXMpOworCQlyZXR1cm4gdGds
X2dldF9jb21ib19idWZfdHJhbnNfZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbl9lbnRyaWVzKTsK
IH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCB0Z2xfZGtsX3BoeV9kZGlfYnVmX3RyYW5zICoKLXRn
bF9nZXRfZGtsX2J1Zl90cmFuc19oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLCBp
bnQgdHlwZSwgaW50IHJhdGUsCit0Z2xfZ2V0X2RrbF9idWZfdHJhbnNfaGRtaShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkJICAgaW50ICpuX2VudHJpZXMpCiB7CiAJKm5fZW50cmllcyA9IEFS
UkFZX1NJWkUodGdsX2RrbF9waHlfaGRtaV9kZGlfdHJhbnMpOwpAQCAtMTIyNiwxMCArMTI0Miwx
MSBAQCB0Z2xfZ2V0X2RrbF9idWZfdHJhbnNfaGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwgaW50IHR5cGUsIGludCByYXRlLAogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IHRnbF9k
a2xfcGh5X2RkaV9idWZfdHJhbnMgKgotdGdsX2dldF9ka2xfYnVmX3RyYW5zX2RwKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgdHlwZSwgaW50IHJhdGUsCit0Z2xfZ2V0X2RrbF9i
dWZfdHJhbnNfZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkgY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgaW50ICpuX2VudHJpZXMpCiB7
Ci0JaWYgKHJhdGUgPiAyNzAwMDApIHsKKwlpZiAoY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayA+IDI3
MDAwMCkgewogCQkqbl9lbnRyaWVzID0gQVJSQVlfU0laRSh0Z2xfZGtsX3BoeV9kcF9kZGlfdHJh
bnNfaGJyMik7CiAJCXJldHVybiB0Z2xfZGtsX3BoeV9kcF9kZGlfdHJhbnNfaGJyMjsKIAl9IGVs
c2UgewpAQCAtMTIzOSwxNiArMTI1NiwxOCBAQCB0Z2xfZ2V0X2RrbF9idWZfdHJhbnNfZHAoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGludCB0eXBlLCBpbnQgcmF0ZSwKIH0KIAogc3Rh
dGljIGNvbnN0IHN0cnVjdCB0Z2xfZGtsX3BoeV9kZGlfYnVmX3RyYW5zICoKLXRnbF9nZXRfZGts
X2J1Zl90cmFucyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IHR5cGUsIGludCBy
YXRlLAordGdsX2dldF9ka2xfYnVmX3RyYW5zKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAorCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
ICAgICAgaW50ICpuX2VudHJpZXMpCiB7Ci0JaWYgKHR5cGUgPT0gSU5URUxfT1VUUFVUX0hETUkp
Ci0JCXJldHVybiB0Z2xfZ2V0X2RrbF9idWZfdHJhbnNfaGRtaShlbmNvZGVyLCB0eXBlLCByYXRl
LCBuX2VudHJpZXMpOworCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVM
X09VVFBVVF9IRE1JKSkKKwkJcmV0dXJuIHRnbF9nZXRfZGtsX2J1Zl90cmFuc19oZG1pKGVuY29k
ZXIsIGNydGNfc3RhdGUsIG5fZW50cmllcyk7CiAJZWxzZQotCQlyZXR1cm4gdGdsX2dldF9ka2xf
YnVmX3RyYW5zX2RwKGVuY29kZXIsIHR5cGUsIHJhdGUsIG5fZW50cmllcyk7CisJCXJldHVybiB0
Z2xfZ2V0X2RrbF9idWZfdHJhbnNfZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbl9lbnRyaWVzKTsK
IH0KIAotc3RhdGljIGludCBpbnRlbF9kZGlfaGRtaV9sZXZlbChzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlcikKK3N0YXRpYyBpbnQgaW50ZWxfZGRpX2hkbWlfbGV2ZWwoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCisJCQkJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CiAJaW50IG5fZW50cmllcywgbGV2ZWwsIGRlZmF1bHRfZW50
cnk7CkBAIC0xMjU2LDE5ICsxMjc1LDE1IEBAIHN0YXRpYyBpbnQgaW50ZWxfZGRpX2hkbWlfbGV2
ZWwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAKIAlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMikgewogCQlpZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQot
CQkJdGdsX2dldF9jb21ib19idWZfdHJhbnMoZW5jb2RlciwgSU5URUxfT1VUUFVUX0hETUksCi0J
CQkJCQkwLCAmbl9lbnRyaWVzKTsKKwkJCXRnbF9nZXRfY29tYm9fYnVmX3RyYW5zX2hkbWkoZW5j
b2RlciwgY3J0Y19zdGF0ZSwgJm5fZW50cmllcyk7CiAJCWVsc2UKLQkJCXRnbF9nZXRfZGtsX2J1
Zl90cmFucyhlbmNvZGVyLCBJTlRFTF9PVVRQVVRfSERNSSwgMCwKLQkJCQkJICAgICAgJm5fZW50
cmllcyk7CisJCQl0Z2xfZ2V0X2RrbF9idWZfdHJhbnNfaGRtaShlbmNvZGVyLCBjcnRjX3N0YXRl
LCAmbl9lbnRyaWVzKTsKIAkJZGVmYXVsdF9lbnRyeSA9IG5fZW50cmllcyAtIDE7CiAJfSBlbHNl
IGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDExKSB7CiAJCWlmIChpbnRlbF9waHlfaXNfY29t
Ym8oZGV2X3ByaXYsIHBoeSkpCi0JCQlpY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhlbmNvZGVyLCBJ
TlRFTF9PVVRQVVRfSERNSSwKLQkJCQkJCTAsICZuX2VudHJpZXMpOworCQkJaWNsX2dldF9jb21i
b19idWZfdHJhbnNfaGRtaShlbmNvZGVyLCBjcnRjX3N0YXRlLCAmbl9lbnRyaWVzKTsKIAkJZWxz
ZQotCQkJaWNsX2dldF9tZ19idWZfdHJhbnMoZW5jb2RlciwgSU5URUxfT1VUUFVUX0hETUksIDAs
Ci0JCQkJCSAgICAgJm5fZW50cmllcyk7CisJCQlpY2xfZ2V0X21nX2J1Zl90cmFuc19oZG1pKGVu
Y29kZXIsIGNydGNfc3RhdGUsICZuX2VudHJpZXMpOwogCQlkZWZhdWx0X2VudHJ5ID0gbl9lbnRy
aWVzIC0gMTsKIAl9IGVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKSB7CiAJCWNubF9n
ZXRfYnVmX3RyYW5zX2hkbWkoZW5jb2RlciwgJm5fZW50cmllcyk7CkBAIC0xNTk1LDE0ICsxNjEw
LDE1IEBAIHZvaWQgaHN3X2ZkaV9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkgICAgICAgRFBfVFBfQ1RMX0VOQUJMRSk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVs
X2RkaV9pbml0X2RwX2J1Zl9yZWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCitzdGF0
aWMgdm9pZCBpbnRlbF9kZGlfaW5pdF9kcF9idWZfcmVnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAorCQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5j
b2Rlcik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBlbmNfdG9fZGln
X3BvcnQoZW5jb2Rlcik7CiAKIAlpbnRlbF9kcC0+RFAgPSBkaWdfcG9ydC0+c2F2ZWRfcG9ydF9i
aXRzIHwKIAkJRERJX0JVRl9DVExfRU5BQkxFIHwgRERJX0JVRl9UUkFOU19TRUxFQ1QoMCk7Ci0J
aW50ZWxfZHAtPkRQIHw9IERESV9QT1JUX1dJRFRIKGludGVsX2RwLT5sYW5lX2NvdW50KTsKKwlp
bnRlbF9kcC0+RFAgfD0gRERJX1BPUlRfV0lEVEgoY3J0Y19zdGF0ZS0+bGFuZV9jb3VudCk7CiB9
CiAKIHN0YXRpYyBpbnQgaWNsX2NhbGNfdGJ0X3BsbF9saW5rKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKQEAgLTIyNjYsMTMgKzIyODIsMTQgQEAgc3RhdGljIHZvaWQgX3NrbF9k
ZGlfc2V0X2lib29zdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAKIHN0
YXRpYyB2b2lkIHNrbF9kZGlfc2V0X2lib29zdChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKLQkJCSAgICAgICBpbnQgbGV2ZWwsIGVudW0gaW50ZWxfb3V0cHV0X3R5cGUgdHlwZSkKKwkJ
CSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAg
ICAgICBpbnQgbGV2ZWwpCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQg
PSBlbmNfdG9fZGlnX3BvcnQoZW5jb2Rlcik7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJdTggaWJvb3N0OwogCi0JaWYg
KHR5cGUgPT0gSU5URUxfT1VUUFVUX0hETUkpCisJaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0
Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0hETUkpKQogCQlpYm9vc3QgPSBpbnRlbF9iaW9zX2hkbWlf
Ym9vc3RfbGV2ZWwoZW5jb2Rlcik7CiAJZWxzZQogCQlpYm9vc3QgPSBpbnRlbF9iaW9zX2RwX2Jv
b3N0X2xldmVsKGVuY29kZXIpOwpAQCAtMjI4MSwxNCArMjI5OCwxMiBAQCBzdGF0aWMgdm9pZCBz
a2xfZGRpX3NldF9pYm9vc3Qoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCWNvbnN0
IHN0cnVjdCBkZGlfYnVmX3RyYW5zICpkZGlfdHJhbnNsYXRpb25zOwogCQlpbnQgbl9lbnRyaWVz
OwogCi0JCWlmICh0eXBlID09IElOVEVMX09VVFBVVF9IRE1JKQorCQlpZiAoaW50ZWxfY3J0Y19o
YXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpCiAJCQlkZGlfdHJhbnNsYXRp
b25zID0gaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfaGRtaShlbmNvZGVyLCAmbl9lbnRyaWVzKTsK
LQkJZWxzZSBpZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKQotCQkJZGRpX3RyYW5zbGF0aW9u
cyA9IGludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2VkcChlbmNvZGVyLAotCQkJCQkJCQkgICAgICAg
Jm5fZW50cmllcyk7CisJCWVsc2UgaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwg
SU5URUxfT1VUUFVUX0VEUCkpCisJCQlkZGlfdHJhbnNsYXRpb25zID0gaW50ZWxfZGRpX2dldF9i
dWZfdHJhbnNfZWRwKGVuY29kZXIsICZuX2VudHJpZXMpOwogCQllbHNlCi0JCQlkZGlfdHJhbnNs
YXRpb25zID0gaW50ZWxfZGRpX2dldF9idWZfdHJhbnNfZHAoZW5jb2RlciwKLQkJCQkJCQkJICAg
ICAgJm5fZW50cmllcyk7CisJCQlkZGlfdHJhbnNsYXRpb25zID0gaW50ZWxfZGRpX2dldF9idWZf
dHJhbnNfZHAoZW5jb2RlciwgJm5fZW50cmllcyk7CiAKIAkJaWYgKGRybV9XQVJOX09OX09OQ0Uo
JmRldl9wcml2LT5kcm0sICFkZGlfdHJhbnNsYXRpb25zKSkKIAkJCXJldHVybjsKQEAgLTIzMTEs
MTYgKzIzMjYsMTcgQEAgc3RhdGljIHZvaWQgc2tsX2RkaV9zZXRfaWJvb3N0KHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogfQogCiBzdGF0aWMgdm9pZCBieHRfZGRpX3Zzd2luZ19zZXF1
ZW5jZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKLQkJCQkgICAgaW50IGxldmVsLCBl
bnVtIGludGVsX291dHB1dF90eXBlIHR5cGUpCisJCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgICBpbnQgbGV2ZWwpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJ
Y29uc3Qgc3RydWN0IGJ4dF9kZGlfYnVmX3RyYW5zICpkZGlfdHJhbnNsYXRpb25zOwogCWVudW0g
cG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAlpbnQgbl9lbnRyaWVzOwogCi0JaWYgKHR5cGUg
PT0gSU5URUxfT1VUUFVUX0hETUkpCisJaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0
ZSwgSU5URUxfT1VUUFVUX0hETUkpKQogCQlkZGlfdHJhbnNsYXRpb25zID0gYnh0X2dldF9idWZf
dHJhbnNfaGRtaShlbmNvZGVyLCAmbl9lbnRyaWVzKTsKLQllbHNlIGlmICh0eXBlID09IElOVEVM
X09VVFBVVF9FRFApCisJZWxzZSBpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJ
TlRFTF9PVVRQVVRfRURQKSkKIAkJZGRpX3RyYW5zbGF0aW9ucyA9IGJ4dF9nZXRfYnVmX3RyYW5z
X2VkcChlbmNvZGVyLCAmbl9lbnRyaWVzKTsKIAllbHNlCiAJCWRkaV90cmFuc2xhdGlvbnMgPSBi
eHRfZ2V0X2J1Zl90cmFuc19kcChlbmNvZGVyLCAmbl9lbnRyaWVzKTsKQEAgLTIzMzcsNyArMjM1
Myw4IEBAIHN0YXRpYyB2b2lkIGJ4dF9kZGlfdnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCQkJCSAgICAgZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0uZGVlbXBo
YXNpcyk7CiB9CiAKLXN0YXRpYyB1OCBpbnRlbF9kZGlfZHBfdm9sdGFnZV9tYXgoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKK3N0YXRpYyB1OCBpbnRlbF9kZGlfZHBfdm9sdGFnZV9tYXgoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZk
cF90b19kaWdfcG9ydChpbnRlbF9kcCktPmJhc2U7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CkBAIC0yMzQ3LDMzICsyMzY0
LDI4IEBAIHN0YXRpYyB1OCBpbnRlbF9kZGlfZHBfdm9sdGFnZV9tYXgoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CiAJCWlmIChp
bnRlbF9waHlfaXNfY29tYm8oZGV2X3ByaXYsIHBoeSkpCi0JCQl0Z2xfZ2V0X2NvbWJvX2J1Zl90
cmFucyhlbmNvZGVyLCBlbmNvZGVyLT50eXBlLAotCQkJCQkJaW50ZWxfZHAtPmxpbmtfcmF0ZSwg
Jm5fZW50cmllcyk7CisJCQl0Z2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhlbmNvZGVyLCBjcnRjX3N0
YXRlLCAmbl9lbnRyaWVzKTsKIAkJZWxzZQotCQkJdGdsX2dldF9ka2xfYnVmX3RyYW5zKGVuY29k
ZXIsIGVuY29kZXItPnR5cGUsCi0JCQkJCSAgICAgIGludGVsX2RwLT5saW5rX3JhdGUsICZuX2Vu
dHJpZXMpOworCQkJdGdsX2dldF9ka2xfYnVmX3RyYW5zKGVuY29kZXIsIGNydGNfc3RhdGUsICZu
X2VudHJpZXMpOwogCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA9PSAxMSkgewogCQlp
ZiAoSVNfRUxLSEFSVExBS0UoZGV2X3ByaXYpKQotCQkJZWhsX2dldF9jb21ib19idWZfdHJhbnMo
ZW5jb2RlciwgZW5jb2Rlci0+dHlwZSwKLQkJCQkJCWludGVsX2RwLT5saW5rX3JhdGUsICZuX2Vu
dHJpZXMpOworCQkJZWhsX2dldF9jb21ib19idWZfdHJhbnMoZW5jb2RlciwgY3J0Y19zdGF0ZSwg
Jm5fZW50cmllcyk7CiAJCWVsc2UgaWYgKGludGVsX3BoeV9pc19jb21ibyhkZXZfcHJpdiwgcGh5
KSkKLQkJCWljbF9nZXRfY29tYm9fYnVmX3RyYW5zKGVuY29kZXIsIGVuY29kZXItPnR5cGUsCi0J
CQkJCQlpbnRlbF9kcC0+bGlua19yYXRlLCAmbl9lbnRyaWVzKTsKKwkJCWljbF9nZXRfY29tYm9f
YnVmX3RyYW5zKGVuY29kZXIsIGNydGNfc3RhdGUsICZuX2VudHJpZXMpOwogCQllbHNlCi0JCQlp
Y2xfZ2V0X21nX2J1Zl90cmFucyhlbmNvZGVyLCBlbmNvZGVyLT50eXBlLAotCQkJCQkgICAgIGlu
dGVsX2RwLT5saW5rX3JhdGUsICZuX2VudHJpZXMpOworCQkJaWNsX2dldF9tZ19idWZfdHJhbnMo
ZW5jb2RlciwgY3J0Y19zdGF0ZSwgJm5fZW50cmllcyk7CiAJfSBlbHNlIGlmIChJU19DQU5OT05M
QUtFKGRldl9wcml2KSkgewotCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQ
KQorCQlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRURQ
KSkKIAkJCWNubF9nZXRfYnVmX3RyYW5zX2VkcChlbmNvZGVyLCAmbl9lbnRyaWVzKTsKIAkJZWxz
ZQogCQkJY25sX2dldF9idWZfdHJhbnNfZHAoZW5jb2RlciwgJm5fZW50cmllcyk7CiAJfSBlbHNl
IGlmIChJU19HRU45X0xQKGRldl9wcml2KSkgewotCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRF
TF9PVVRQVVRfRURQKQorCQlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRF
TF9PVVRQVVRfRURQKSkKIAkJCWJ4dF9nZXRfYnVmX3RyYW5zX2VkcChlbmNvZGVyLCAmbl9lbnRy
aWVzKTsKIAkJZWxzZQogCQkJYnh0X2dldF9idWZfdHJhbnNfZHAoZW5jb2RlciwgJm5fZW50cmll
cyk7CiAJfSBlbHNlIHsKLQkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkK
KwkJaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0VEUCkp
CiAJCQlpbnRlbF9kZGlfZ2V0X2J1Zl90cmFuc19lZHAoZW5jb2RlciwgJm5fZW50cmllcyk7CiAJ
CWVsc2UKIAkJCWludGVsX2RkaV9nZXRfYnVmX3RyYW5zX2RwKGVuY29kZXIsICZuX2VudHJpZXMp
OwpAQCAtMjQwMCw3ICsyNDEyLDggQEAgc3RhdGljIHU4IGludGVsX2RkaV9kcF9wcmVlbXBoX21h
eChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogfQogCiBzdGF0aWMgdm9pZCBjbmxfZGRpX3Zz
d2luZ19wcm9ncmFtKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAotCQkJCSAgIGludCBs
ZXZlbCwgZW51bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBlKQorCQkJCSAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgIGludCBsZXZlbCkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKIAljb25zdCBzdHJ1Y3QgY25sX2RkaV9idWZfdHJhbnMgKmRkaV90cmFuc2xhdGlvbnM7CkBA
IC0yNDA4LDkgKzI0MjEsOSBAQCBzdGF0aWMgdm9pZCBjbmxfZGRpX3Zzd2luZ19wcm9ncmFtKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWludCBuX2VudHJpZXMsIGxuOwogCXUzMiB2
YWw7CiAKLQlpZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfSERNSSkKKwlpZiAoaW50ZWxfY3J0Y19o
YXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpCiAJCWRkaV90cmFuc2xhdGlv
bnMgPSBjbmxfZ2V0X2J1Zl90cmFuc19oZG1pKGVuY29kZXIsICZuX2VudHJpZXMpOwotCWVsc2Ug
aWYgKHR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkKKwllbHNlIGlmIChpbnRlbF9jcnRjX2hhc190
eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9FRFApKQogCQlkZGlfdHJhbnNsYXRpb25zID0g
Y25sX2dldF9idWZfdHJhbnNfZWRwKGVuY29kZXIsICZuX2VudHJpZXMpOwogCWVsc2UKIAkJZGRp
X3RyYW5zbGF0aW9ucyA9IGNubF9nZXRfYnVmX3RyYW5zX2RwKGVuY29kZXIsICZuX2VudHJpZXMp
OwpAQCAtMjQ2NCwyMiArMjQ3NywxNiBAQCBzdGF0aWMgdm9pZCBjbmxfZGRpX3Zzd2luZ19wcm9n
cmFtKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogfQogCiBzdGF0aWMgdm9pZCBjbmxf
ZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKLQkJCQkg
ICAgaW50IGxldmVsLCBlbnVtIGludGVsX291dHB1dF90eXBlIHR5cGUpCisJCQkJICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgICBpbnQgbGV2ZWwp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWludCB3aWR0
aCwgcmF0ZSwgbG47CiAJdTMyIHZhbDsKIAotCWlmICh0eXBlID09IElOVEVMX09VVFBVVF9IRE1J
KSB7Ci0JCXdpZHRoID0gNDsKLQkJcmF0ZSA9IDA7IC8qIFJhdGUgaXMgYWx3YXlzIDwgdGhhbiA2
R0h6IGZvciBIRE1JICovCi0JfSBlbHNlIHsKLQkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9
IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKLQotCQl3aWR0aCA9IGludGVsX2RwLT5sYW5lX2Nv
dW50OwotCQlyYXRlID0gaW50ZWxfZHAtPmxpbmtfcmF0ZTsKLQl9CisJd2lkdGggPSBjcnRjX3N0
YXRlLT5sYW5lX2NvdW50OworCXJhdGUgPSBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrOwogCiAJLyoK
IAkgKiAxLiBJZiBwb3J0IHR5cGUgaXMgZURQIG9yIERQLApAQCAtMjQ4NywxMCArMjQ5NCwxMCBA
QCBzdGF0aWMgdm9pZCBjbmxfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAkgKiBlbHNlIGNsZWFyIHRvIDBiLgogCSAqLwogCXZhbCA9IGludGVsX2Rl
X3JlYWQoZGV2X3ByaXYsIENOTF9QT1JUX1BDU19EVzFfTE4wKHBvcnQpKTsKLQlpZiAodHlwZSAh
PSBJTlRFTF9PVVRQVVRfSERNSSkKLQkJdmFsIHw9IENPTU1PTl9LRUVQRVJfRU47Ci0JZWxzZQor
CWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9IRE1JKSkK
IAkJdmFsICY9IH5DT01NT05fS0VFUEVSX0VOOworCWVsc2UKKwkJdmFsIHw9IENPTU1PTl9LRUVQ
RVJfRU47CiAJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENOTF9QT1JUX1BDU19EVzFfR1JQKHBv
cnQpLCB2YWwpOwogCiAJLyogMi4gUHJvZ3JhbSBsb2FkZ2VuIHNlbGVjdCAqLwpAQCAtMjUyMiw3
ICsyNTI5LDcgQEAgc3RhdGljIHZvaWQgY25sX2RkaV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENOTF9QT1JU
X1RYX0RXNV9HUlAocG9ydCksIHZhbCk7CiAKIAkvKiA1LiBQcm9ncmFtIHN3aW5nIGFuZCBkZS1l
bXBoYXNpcyAqLwotCWNubF9kZGlfdnN3aW5nX3Byb2dyYW0oZW5jb2RlciwgbGV2ZWwsIHR5cGUp
OworCWNubF9kZGlfdnN3aW5nX3Byb2dyYW0oZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwog
CiAJLyogNi4gU2V0IHRyYWluaW5nIGVuYWJsZSB0byB0cmlnZ2VyIHVwZGF0ZSAqLwogCXZhbCA9
IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIENOTF9QT1JUX1RYX0RXNV9MTjAocG9ydCkpOwpAQCAt
MjUzMSwyMyArMjUzOCwyMSBAQCBzdGF0aWMgdm9pZCBjbmxfZGRpX3Zzd2luZ19zZXF1ZW5jZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIH0KIAogc3RhdGljIHZvaWQgaWNsX2RkaV9j
b21ib192c3dpbmdfcHJvZ3JhbShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKLQkJCQkJ
IHUzMiBsZXZlbCwgaW50IHR5cGUsIGludCByYXRlKQorCQkJCQkgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJCSBpbnQgbGV2ZWwpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJ
Y29uc3Qgc3RydWN0IGNubF9kZGlfYnVmX3RyYW5zICpkZGlfdHJhbnNsYXRpb25zOwogCWVudW0g
cGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGRldl9wcml2LCBlbmNvZGVyLT5wb3J0KTsKLQlj
b25zdCBzdHJ1Y3QgY25sX2RkaV9idWZfdHJhbnMgKmRkaV90cmFuc2xhdGlvbnMgPSBOVUxMOwot
CXUzMiBuX2VudHJpZXMsIHZhbDsKLQlpbnQgbG47CisJaW50IG5fZW50cmllcywgbG47CisJdTMy
IHZhbDsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQotCQlkZGlfdHJhbnNsYXRp
b25zID0gdGdsX2dldF9jb21ib19idWZfdHJhbnMoZW5jb2RlciwgdHlwZSwgcmF0ZSwKLQkJCQkJ
CQkgICAmbl9lbnRyaWVzKTsKKwkJZGRpX3RyYW5zbGF0aW9ucyA9IHRnbF9nZXRfY29tYm9fYnVm
X3RyYW5zKGVuY29kZXIsIGNydGNfc3RhdGUsICZuX2VudHJpZXMpOwogCWVsc2UgaWYgKElTX0VM
S0hBUlRMQUtFKGRldl9wcml2KSkKLQkJZGRpX3RyYW5zbGF0aW9ucyA9IGVobF9nZXRfY29tYm9f
YnVmX3RyYW5zKGVuY29kZXIsIHR5cGUsIHJhdGUsCi0JCQkJCQkJICAgJm5fZW50cmllcyk7CisJ
CWRkaV90cmFuc2xhdGlvbnMgPSBlaGxfZ2V0X2NvbWJvX2J1Zl90cmFucyhlbmNvZGVyLCBjcnRj
X3N0YXRlLCAmbl9lbnRyaWVzKTsKIAllbHNlCi0JCWRkaV90cmFuc2xhdGlvbnMgPSBpY2xfZ2V0
X2NvbWJvX2J1Zl90cmFucyhlbmNvZGVyLCB0eXBlLCByYXRlLAotCQkJCQkJCSAgICZuX2VudHJp
ZXMpOworCQlkZGlfdHJhbnNsYXRpb25zID0gaWNsX2dldF9jb21ib19idWZfdHJhbnMoZW5jb2Rl
ciwgY3J0Y19zdGF0ZSwgJm5fZW50cmllcyk7CiAJaWYgKCFkZGlfdHJhbnNsYXRpb25zKQogCQly
ZXR1cm47CiAKQEAgLTI1NTgsNyArMjU2Myw3IEBAIHN0YXRpYyB2b2lkIGljbF9kZGlfY29tYm9f
dnN3aW5nX3Byb2dyYW0oc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCWxldmVsID0g
bl9lbnRyaWVzIC0gMTsKIAl9CiAKLQlpZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKSB7CisJ
aWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0VEUCkpIHsK
IAkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsK
IAogCQl2YWwgPSBFRFA0SzJLX01PREVfT1ZSRF9FTiB8IEVEUDRLMktfTU9ERV9PVlJEX09QVElN
SVpFRDsKQEAgLTI2MDYsMjUgKzI2MTEsMTYgQEAgc3RhdGljIHZvaWQgaWNsX2RkaV9jb21ib192
c3dpbmdfcHJvZ3JhbShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIH0KIAogc3RhdGlj
IHZvaWQgaWNsX2NvbWJvX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAotCQkJCQkgICAgICB1MzIgbGV2ZWwsCi0JCQkJCSAgICAgIGVudW0gaW50
ZWxfb3V0cHV0X3R5cGUgdHlwZSkKKwkJCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCisJCQkJCSAgICAgIGludCBsZXZlbCkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAll
bnVtIHBoeSBwaHkgPSBpbnRlbF9wb3J0X3RvX3BoeShkZXZfcHJpdiwgZW5jb2Rlci0+cG9ydCk7
Ci0JaW50IHdpZHRoID0gMDsKLQlpbnQgcmF0ZSA9IDA7CisJaW50IHdpZHRoLCByYXRlLCBsbjsK
IAl1MzIgdmFsOwotCWludCBsbiA9IDA7CiAKLQlpZiAodHlwZSA9PSBJTlRFTF9PVVRQVVRfSERN
SSkgewotCQl3aWR0aCA9IDQ7Ci0JCS8qIFJhdGUgaXMgYWx3YXlzIDwgdGhhbiA2R0h6IGZvciBI
RE1JICovCi0JfSBlbHNlIHsKLQkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19p
bnRlbF9kcChlbmNvZGVyKTsKLQotCQl3aWR0aCA9IGludGVsX2RwLT5sYW5lX2NvdW50OwotCQly
YXRlID0gaW50ZWxfZHAtPmxpbmtfcmF0ZTsKLQl9CisJd2lkdGggPSBjcnRjX3N0YXRlLT5sYW5l
X2NvdW50OworCXJhdGUgPSBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrOwogCiAJLyoKIAkgKiAxLiBJ
ZiBwb3J0IHR5cGUgaXMgZURQIG9yIERQLApAQCAtMjYzMiw3ICsyNjI4LDcgQEAgc3RhdGljIHZv
aWQgaWNsX2NvbWJvX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCSAqIGVsc2UgY2xlYXIgdG8gMGIuCiAJICovCiAJdmFsID0gaW50ZWxfZGVf
cmVhZChkZXZfcHJpdiwgSUNMX1BPUlRfUENTX0RXMV9MTjAocGh5KSk7Ci0JaWYgKHR5cGUgPT0g
SU5URUxfT1VUUFVUX0hETUkpCisJaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwg
SU5URUxfT1VUUFVUX0hETUkpKQogCQl2YWwgJj0gfkNPTU1PTl9LRUVQRVJfRU47CiAJZWxzZQog
CQl2YWwgfD0gQ09NTU9OX0tFRVBFUl9FTjsKQEAgLTI2NjcsNyArMjY2Myw3IEBAIHN0YXRpYyB2
b2lkIGljbF9jb21ib19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgSUNMX1BPUlRfVFhfRFc1X0dS
UChwaHkpLCB2YWwpOwogCiAJLyogNS4gUHJvZ3JhbSBzd2luZyBhbmQgZGUtZW1waGFzaXMgKi8K
LQlpY2xfZGRpX2NvbWJvX3Zzd2luZ19wcm9ncmFtKGVuY29kZXIsIGxldmVsLCB0eXBlLCByYXRl
KTsKKwlpY2xfZGRpX2NvbWJvX3Zzd2luZ19wcm9ncmFtKGVuY29kZXIsIGNydGNfc3RhdGUsIGxl
dmVsKTsKIAogCS8qIDYuIFNldCB0cmFpbmluZyBlbmFibGUgdG8gdHJpZ2dlciB1cGRhdGUgKi8K
IAl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBJQ0xfUE9SVF9UWF9EVzVfTE4wKHBoeSkp
OwpAQCAtMjY3NiwyMyArMjY3MiwxNiBAQCBzdGF0aWMgdm9pZCBpY2xfY29tYm9fcGh5X2RkaV92
c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB9CiAKIHN0YXRp
YyB2b2lkIGljbF9tZ19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKLQkJCQkJICAgaW50IGxpbmtfY2xvY2ssIHUzMiBsZXZlbCwKLQkJCQkJICAg
ZW51bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBlKQorCQkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkJICAgaW50IGxldmVsKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwog
CWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190YyhkZXZfcHJpdiwgZW5jb2Rl
ci0+cG9ydCk7CiAJY29uc3Qgc3RydWN0IGljbF9tZ19waHlfZGRpX2J1Zl90cmFucyAqZGRpX3Ry
YW5zbGF0aW9uczsKLQl1MzIgbl9lbnRyaWVzLCB2YWw7Ci0JaW50IGxuLCByYXRlID0gMDsKKwlp
bnQgbl9lbnRyaWVzLCBsbjsKKwl1MzIgdmFsOwogCi0JaWYgKHR5cGUgIT0gSU5URUxfT1VUUFVU
X0hETUkpIHsKLQkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChl
bmNvZGVyKTsKLQotCQlyYXRlID0gaW50ZWxfZHAtPmxpbmtfcmF0ZTsKLQl9Ci0KLQlkZGlfdHJh
bnNsYXRpb25zID0gaWNsX2dldF9tZ19idWZfdHJhbnMoZW5jb2RlciwgdHlwZSwgcmF0ZSwKLQkJ
CQkJCSZuX2VudHJpZXMpOworCWRkaV90cmFuc2xhdGlvbnMgPSBpY2xfZ2V0X21nX2J1Zl90cmFu
cyhlbmNvZGVyLCBjcnRjX3N0YXRlLCAmbl9lbnRyaWVzKTsKIAkvKiBUaGUgdGFibGUgZG9lcyBu
b3QgaGF2ZSB2YWx1ZXMgZm9yIGxldmVsIDMgYW5kIGxldmVsIDkuICovCiAJaWYgKGxldmVsID49
IG5fZW50cmllcyB8fCBsZXZlbCA9PSAzIHx8IGxldmVsID09IDkpIHsKIAkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sCkBAIC0yNzU5LDcgKzI3NDgsNyBAQCBzdGF0aWMgdm9pZCBpY2xfbWdf
cGh5X2RkaV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
ICovCiAJZm9yIChsbiA9IDA7IGxuIDwgMjsgbG4rKykgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFk
KGRldl9wcml2LCBNR19DTEtIVUIobG4sIHRjX3BvcnQpKTsKLQkJaWYgKGxpbmtfY2xvY2sgPCAz
MDAwMDApCisJCWlmIChjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrIDwgMzAwMDAwKQogCQkJdmFsIHw9
IENGR19MT1dfUkFURV9MS1JFTl9FTjsKIAkJZWxzZQogCQkJdmFsICY9IH5DRkdfTE9XX1JBVEVf
TEtSRU5fRU47CkBAIC0yNzcwLDcgKzI3NTksNyBAQCBzdGF0aWMgdm9pZCBpY2xfbWdfcGh5X2Rk
aV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZm9yIChs
biA9IDA7IGxuIDwgMjsgbG4rKykgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBN
R19UWDFfRENDKGxuLCB0Y19wb3J0KSk7CiAJCXZhbCAmPSB+Q0ZHX0FNSV9DS19ESVZfT1ZFUlJJ
REVfVkFMX01BU0s7Ci0JCWlmIChsaW5rX2Nsb2NrIDw9IDUwMDAwMCkgeworCQlpZiAoY3J0Y19z
dGF0ZS0+cG9ydF9jbG9jayA8PSA1MDAwMDApIHsKIAkJCXZhbCAmPSB+Q0ZHX0FNSV9DS19ESVZf
T1ZFUlJJREVfRU47CiAJCX0gZWxzZSB7CiAJCQl2YWwgfD0gQ0ZHX0FNSV9DS19ESVZfT1ZFUlJJ
REVfRU4gfApAQCAtMjc4MCw3ICsyNzY5LDcgQEAgc3RhdGljIHZvaWQgaWNsX21nX3BoeV9kZGlf
dnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJCXZhbCA9
IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIE1HX1RYMl9EQ0MobG4sIHRjX3BvcnQpKTsKIAkJdmFs
ICY9IH5DRkdfQU1JX0NLX0RJVl9PVkVSUklERV9WQUxfTUFTSzsKLQkJaWYgKGxpbmtfY2xvY2sg
PD0gNTAwMDAwKSB7CisJCWlmIChjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrIDw9IDUwMDAwMCkgewog
CQkJdmFsICY9IH5DRkdfQU1JX0NLX0RJVl9PVkVSUklERV9FTjsKIAkJfSBlbHNlIHsKIAkJCXZh
bCB8PSBDRkdfQU1JX0NLX0RJVl9PVkVSUklERV9FTiB8CkBAIC0yODA2LDM4ICsyNzk1LDMwIEBA
IHN0YXRpYyB2b2lkIGljbF9tZ19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIH0KIAogc3RhdGljIHZvaWQgaWNsX2RkaV92c3dpbmdfc2VxdWVu
Y2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCi0JCQkJICAgIGludCBsaW5rX2Nsb2Nr
LAotCQkJCSAgICB1MzIgbGV2ZWwsCi0JCQkJICAgIGVudW0gaW50ZWxfb3V0cHV0X3R5cGUgdHlw
ZSkKKwkJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJ
CQkJICAgIGludCBsZXZlbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIHBoeSBwaHkgPSBpbnRlbF9wb3J0
X3RvX3BoeShkZXZfcHJpdiwgZW5jb2Rlci0+cG9ydCk7CiAKIAlpZiAoaW50ZWxfcGh5X2lzX2Nv
bWJvKGRldl9wcml2LCBwaHkpKQotCQlpY2xfY29tYm9fcGh5X2RkaV92c3dpbmdfc2VxdWVuY2Uo
ZW5jb2RlciwgbGV2ZWwsIHR5cGUpOworCQlpY2xfY29tYm9fcGh5X2RkaV92c3dpbmdfc2VxdWVu
Y2UoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwogCWVsc2UKLQkJaWNsX21nX3BoeV9kZGlf
dnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxpbmtfY2xvY2ssIGxldmVsLAotCQkJCQkgICAgICAg
dHlwZSk7CisJCWljbF9tZ19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0
YXRlLCBsZXZlbCk7CiB9CiAKIHN0YXRpYyB2b2lkCi10Z2xfZGtsX3BoeV9kZGlfdnN3aW5nX3Nl
cXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgbGlua19jbG9jaywKLQkJ
CQl1MzIgbGV2ZWwsIGVudW0gaW50ZWxfb3V0cHV0X3R5cGUgdHlwZSkKK3RnbF9ka2xfcGh5X2Rk
aV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJaW50IGxldmVsKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190YyhkZXZf
cHJpdiwgZW5jb2Rlci0+cG9ydCk7CiAJY29uc3Qgc3RydWN0IHRnbF9ka2xfcGh5X2RkaV9idWZf
dHJhbnMgKmRkaV90cmFuc2xhdGlvbnM7Ci0JdTMyIG5fZW50cmllcywgdmFsLCBsbiwgZHBjbnRf
bWFzaywgZHBjbnRfdmFsOwotCWludCByYXRlID0gMDsKKwl1MzIgdmFsLCBkcGNudF9tYXNrLCBk
cGNudF92YWw7CisJaW50IG5fZW50cmllcywgbG47CiAKLQlpZiAodHlwZSA9PSBJTlRFTF9PVVRQ
VVRfSERNSSkgewotCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2Rw
KGVuY29kZXIpOwotCi0JCXJhdGUgPSBpbnRlbF9kcC0+bGlua19yYXRlOwotCX0KLQotCWRkaV90
cmFuc2xhdGlvbnMgPSB0Z2xfZ2V0X2RrbF9idWZfdHJhbnMoZW5jb2RlciwgZW5jb2Rlci0+dHlw
ZSwgcmF0ZSwKLQkJCQkJCSAmbl9lbnRyaWVzKTsKKwlkZGlfdHJhbnNsYXRpb25zID0gdGdsX2dl
dF9ka2xfYnVmX3RyYW5zKGVuY29kZXIsIGNydGNfc3RhdGUsICZuX2VudHJpZXMpOwogCiAJaWYg
KGxldmVsID49IG5fZW50cmllcykKIAkJbGV2ZWwgPSBuX2VudHJpZXMgLSAxOwpAQCAtMjg3Mywy
MCArMjg1NCwyMCBAQCB0Z2xfZGtsX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLCBpbnQgbGlua19jbG9jaywKIH0KIAogc3RhdGljIHZvaWQgdGds
X2RkaV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCi0JCQkJ
ICAgIGludCBsaW5rX2Nsb2NrLAotCQkJCSAgICB1MzIgbGV2ZWwsCi0JCQkJICAgIGVudW0gaW50
ZWxfb3V0cHV0X3R5cGUgdHlwZSkKKwkJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCisJCQkJICAgIGludCBsZXZlbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIHBo
eSBwaHkgPSBpbnRlbF9wb3J0X3RvX3BoeShkZXZfcHJpdiwgZW5jb2Rlci0+cG9ydCk7CiAKIAlp
ZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQotCQlpY2xfY29tYm9fcGh5X2Rk
aV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgbGV2ZWwsIHR5cGUpOworCQlpY2xfY29tYm9fcGh5
X2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwogCWVsc2UK
LQkJdGdsX2RrbF9waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsaW5rX2Nsb2NrLCBs
ZXZlbCwgdHlwZSk7CisJCXRnbF9ka2xfcGh5X2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2Rlciwg
Y3J0Y19zdGF0ZSwgbGV2ZWwpOwogfQogCi1zdGF0aWMgdTMyIHRyYW5zbGF0ZV9zaWduYWxfbGV2
ZWwoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IHNpZ25hbF9sZXZlbHMpCitzdGF0aWMg
aW50IHRyYW5zbGF0ZV9zaWduYWxfbGV2ZWwoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJ
CQkgIHU4IHNpZ25hbF9sZXZlbHMpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlpbnQgaTsKQEAgLTI5MDMsNTUgKzI4ODQsNTggQEAg
c3RhdGljIHUzMiB0cmFuc2xhdGVfc2lnbmFsX2xldmVsKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsIGludCBzaWduYWxfbGV2ZWxzKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdTMyIGludGVs
X2RkaV9kcF9sZXZlbChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQorc3RhdGljIGludCBpbnRl
bF9kZGlfZHBfbGV2ZWwoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAl1OCB0cmFpbl9z
ZXQgPSBpbnRlbF9kcC0+dHJhaW5fc2V0WzBdOwotCWludCBzaWduYWxfbGV2ZWxzID0gdHJhaW5f
c2V0ICYgKERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTUFTSyB8Ci0JCQkJCSBEUF9UUkFJTl9QUkVf
RU1QSEFTSVNfTUFTSyk7CisJdTggc2lnbmFsX2xldmVscyA9IHRyYWluX3NldCAmIChEUF9UUkFJ
Tl9WT0xUQUdFX1NXSU5HX01BU0sgfAorCQkJCQlEUF9UUkFJTl9QUkVfRU1QSEFTSVNfTUFTSyk7
CiAKIAlyZXR1cm4gdHJhbnNsYXRlX3NpZ25hbF9sZXZlbChpbnRlbF9kcCwgc2lnbmFsX2xldmVs
cyk7CiB9CiAKIHN0YXRpYyB2b2lkCi10Z2xfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKK3RnbF9zZXRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwLAorCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkcF90b19kaWdfcG9ydChp
bnRlbF9kcCktPmJhc2U7CiAJaW50IGxldmVsID0gaW50ZWxfZGRpX2RwX2xldmVsKGludGVsX2Rw
KTsKIAotCXRnbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGludGVsX2RwLT5saW5rX3Jh
dGUsCi0JCQkJbGV2ZWwsIGVuY29kZXItPnR5cGUpOworCXRnbF9kZGlfdnN3aW5nX3NlcXVlbmNl
KGVuY29kZXIsIGNydGNfc3RhdGUsIGxldmVsKTsKIH0KIAogc3RhdGljIHZvaWQKLWljbF9zZXRf
c2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQoraWNsX3NldF9zaWduYWxf
bGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCSAgICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyID0gJmRwX3RvX2RpZ19wb3J0KGludGVsX2RwKS0+YmFzZTsKIAlpbnQgbGV2ZWwgPSBp
bnRlbF9kZGlfZHBfbGV2ZWwoaW50ZWxfZHApOwogCi0JaWNsX2RkaV92c3dpbmdfc2VxdWVuY2Uo
ZW5jb2RlciwgaW50ZWxfZHAtPmxpbmtfcmF0ZSwKLQkJCQlsZXZlbCwgZW5jb2Rlci0+dHlwZSk7
CisJaWNsX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwog
fQogCiBzdGF0aWMgdm9pZAotY25sX3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCitjbmxfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwKKwkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxf
ZHApLT5iYXNlOwogCWludCBsZXZlbCA9IGludGVsX2RkaV9kcF9sZXZlbChpbnRlbF9kcCk7CiAK
LQljbmxfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgZW5jb2Rlci0+dHlwZSk7
CisJY25sX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwog
fQogCiBzdGF0aWMgdm9pZAotYnh0X3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCitieHRfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwKKwkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxf
ZHApLT5iYXNlOwogCWludCBsZXZlbCA9IGludGVsX2RkaV9kcF9sZXZlbChpbnRlbF9kcCk7CiAK
LQlieHRfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgZW5jb2Rlci0+dHlwZSk7
CisJYnh0X2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwog
fQogCiBzdGF0aWMgdm9pZAotaHN3X3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCitoc3dfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwKKwkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxf
ZHApLT5iYXNlOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOwpAQCAtMjk2OCw3ICsyOTUyLDcgQEAgaHN3X3NldF9zaWduYWxf
bGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaW50ZWxfZHAtPkRQIHw9IHNpZ25h
bF9sZXZlbHM7CiAKIAlpZiAoSVNfR0VOOV9CQyhkZXZfcHJpdikpCi0JCXNrbF9kZGlfc2V0X2li
b29zdChlbmNvZGVyLCBsZXZlbCwgZW5jb2Rlci0+dHlwZSk7CisJCXNrbF9kZGlfc2V0X2lib29z
dChlbmNvZGVyLCBjcnRjX3N0YXRlLCBsZXZlbCk7CiAKIAlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgRERJX0JVRl9DVEwocG9ydCksIGludGVsX2RwLT5EUCk7CiAJaW50ZWxfZGVfcG9zdGluZ19y
ZWFkKGRldl9wcml2LCBERElfQlVGX0NUTChwb3J0KSk7CkBAIC0zMzc1LDggKzMzNTksOSBAQCBz
dGF0aWMgdm9pZCB0Z2xfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJaW50IGxldmVsID0gaW50ZWxfZGRpX2RwX2xldmVsKGludGVsX2RwKTsKIAll
bnVtIHRyYW5zY29kZXIgdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwog
Ci0JaW50ZWxfZHBfc2V0X2xpbmtfcGFyYW1zKGludGVsX2RwLCBjcnRjX3N0YXRlLT5wb3J0X2Ns
b2NrLAotCQkJCSBjcnRjX3N0YXRlLT5sYW5lX2NvdW50LCBpc19tc3QpOworCWludGVsX2RwX3Nl
dF9saW5rX3BhcmFtcyhpbnRlbF9kcCwKKwkJCQkgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywKKwkJ
CQkgY3J0Y19zdGF0ZS0+bGFuZV9jb3VudCk7CiAKIAlpbnRlbF9kcC0+cmVncy5kcF90cF9jdGwg
PSBUR0xfRFBfVFBfQ1RMKHRyYW5zY29kZXIpOwogCWludGVsX2RwLT5yZWdzLmRwX3RwX3N0YXR1
cyA9IFRHTF9EUF9UUF9TVEFUVVModHJhbnNjb2Rlcik7CkBAIC0zNDQ4LDggKzM0MzMsNyBAQCBz
dGF0aWMgdm9pZCB0Z2xfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJICovCiAKIAkvKiA3LmUgQ29uZmlndXJlIHZvbHRhZ2Ugc3dpbmcgYW5kIHJl
bGF0ZWQgSU8gc2V0dGluZ3MgKi8KLQl0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBj
cnRjX3N0YXRlLT5wb3J0X2Nsb2NrLCBsZXZlbCwKLQkJCQllbmNvZGVyLT50eXBlKTsKKwl0Z2xf
ZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRlLCBsZXZlbCk7CiAKIAkvKgog
CSAqIDcuZiBDb21ibyBQSFk6IENvbmZpZ3VyZSBQT1JUX0NMX0RXMTAgU3RhdGljIFBvd2VyIERv
d24gdG8gcG93ZXIgdXAKQEAgLTM0NzIsNyArMzQ1Niw3IEBAIHN0YXRpYyB2b2lkIHRnbF9kZGlf
cHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkgKiBXZSBv
bmx5IGNvbmZpZ3VyZSB3aGF0IHRoZSByZWdpc3RlciB2YWx1ZSB3aWxsIGJlIGhlcmUuICBBY3R1
YWwKIAkgKiBlbmFibGluZyBoYXBwZW5zIGR1cmluZyBsaW5rIHRyYWluaW5nIGZhcnRoZXIgZG93
bi4KIAkgKi8KLQlpbnRlbF9kZGlfaW5pdF9kcF9idWZfcmVnKGVuY29kZXIpOworCWludGVsX2Rk
aV9pbml0X2RwX2J1Zl9yZWcoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAKIAlpZiAoIWlzX21zdCkK
IAkJaW50ZWxfZHBfc2lua19kcG1zKGludGVsX2RwLCBEUk1fTU9ERV9EUE1TX09OKTsKQEAgLTM0
OTIsMTEgKzM0NzYsMTEgQEAgc3RhdGljIHZvaWQgdGdsX2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCSAqICAgICBQYXR0ZXJuLCB3YWl0IGZvciA1
IGlkbGUgcGF0dGVybnMgKERQX1RQX1NUQVRVUyBNaW5fSWRsZXNfU2VudCkKIAkgKiAgICAgKHRp
bWVvdXQgYWZ0ZXIgODAwIHVzKQogCSAqLwotCWludGVsX2RwX3N0YXJ0X2xpbmtfdHJhaW4oaW50
ZWxfZHApOworCWludGVsX2RwX3N0YXJ0X2xpbmtfdHJhaW4oaW50ZWxfZHAsIGNydGNfc3RhdGUp
OwogCiAJLyogNy5rIFNldCBEUF9UUF9DVEwgbGluayB0cmFpbmluZyB0byBOb3JtYWwgKi8KIAlp
ZiAoIWlzX3RyYW5zX3BvcnRfc3luY19tb2RlKGNydGNfc3RhdGUpKQotCQlpbnRlbF9kcF9zdG9w
X2xpbmtfdHJhaW4oaW50ZWxfZHApOworCQlpbnRlbF9kcF9zdG9wX2xpbmtfdHJhaW4oaW50ZWxf
ZHAsIGNydGNfc3RhdGUpOwogCiAJLyogNy5sIENvbmZpZ3VyZSBhbmQgZW5hYmxlIEZFQyBpZiBu
ZWVkZWQgKi8KIAlpbnRlbF9kZGlfZW5hYmxlX2ZlYyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKQEAg
LTM1MjIsOCArMzUwNiw5IEBAIHN0YXRpYyB2b2lkIGhzd19kZGlfcHJlX2VuYWJsZV9kcChzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAllbHNlCiAJCWRybV9XQVJOX09OKCZkZXZf
cHJpdi0+ZHJtLCBpc19tc3QgJiYgcG9ydCA9PSBQT1JUX0EpOwogCi0JaW50ZWxfZHBfc2V0X2xp
bmtfcGFyYW1zKGludGVsX2RwLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAotCQkJCSBjcnRjX3N0
YXRlLT5sYW5lX2NvdW50LCBpc19tc3QpOworCWludGVsX2RwX3NldF9saW5rX3BhcmFtcyhpbnRl
bF9kcCwKKwkJCQkgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywKKwkJCQkgY3J0Y19zdGF0ZS0+bGFu
ZV9jb3VudCk7CiAKIAlpbnRlbF9lZHBfcGFuZWxfb24oaW50ZWxfZHApOwogCkBAIC0zNTM3LDEy
ICszNTIyLDExIEBAIHN0YXRpYyB2b2lkIGhzd19kZGlfcHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlpY2xfcHJvZ3JhbV9tZ19kcF9tb2RlKGRpZ19wb3J0
LCBjcnRjX3N0YXRlKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlpY2xf
ZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAotCQkJ
CQlsZXZlbCwgZW5jb2Rlci0+dHlwZSk7CisJCWljbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29k
ZXIsIGNydGNfc3RhdGUsIGxldmVsKTsKIAllbHNlIGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2
KSkKLQkJY25sX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgbGV2ZWwsIGVuY29kZXItPnR5
cGUpOworCQljbmxfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRlLCBsZXZl
bCk7CiAJZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCi0JCWJ4dF9kZGlfdnN3aW5nX3Nl
cXVlbmNlKGVuY29kZXIsIGxldmVsLCBlbmNvZGVyLT50eXBlKTsKKwkJYnh0X2RkaV92c3dpbmdf
c2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwogCWVsc2UKIAkJaW50ZWxfcHJl
cGFyZV9kcF9kZGlfYnVmZmVycyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKIApAQCAtMzU1NSwxNyAr
MzUzOSwxNyBAQCBzdGF0aWMgdm9pZCBoc3dfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJCSAgICAgICBsYW5lX3JldmVyc2FsKTsKIAl9CiAK
LQlpbnRlbF9kZGlfaW5pdF9kcF9idWZfcmVnKGVuY29kZXIpOworCWludGVsX2RkaV9pbml0X2Rw
X2J1Zl9yZWcoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAJaWYgKCFpc19tc3QpCiAJCWludGVsX2Rw
X3NpbmtfZHBtcyhpbnRlbF9kcCwgRFJNX01PREVfRFBNU19PTik7CiAJaW50ZWxfZHBfY29uZmln
dXJlX3Byb3RvY29sX2NvbnZlcnRlcihpbnRlbF9kcCk7CiAJaW50ZWxfZHBfc2lua19zZXRfZGVj
b21wcmVzc2lvbl9zdGF0ZShpbnRlbF9kcCwgY3J0Y19zdGF0ZSwKIAkJCQkJICAgICAgdHJ1ZSk7
CiAJaW50ZWxfZHBfc2lua19zZXRfZmVjX3JlYWR5KGludGVsX2RwLCBjcnRjX3N0YXRlKTsKLQlp
bnRlbF9kcF9zdGFydF9saW5rX3RyYWluKGludGVsX2RwKTsKKwlpbnRlbF9kcF9zdGFydF9saW5r
X3RyYWluKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKIAlpZiAoKHBvcnQgIT0gUE9SVF9BIHx8IElO
VEVMX0dFTihkZXZfcHJpdikgPj0gOSkgJiYKIAkgICAgIWlzX3RyYW5zX3BvcnRfc3luY19tb2Rl
KGNydGNfc3RhdGUpKQotCQlpbnRlbF9kcF9zdG9wX2xpbmtfdHJhaW4oaW50ZWxfZHApOworCQlp
bnRlbF9kcF9zdG9wX2xpbmtfdHJhaW4oaW50ZWxfZHAsIGNydGNfc3RhdGUpOwogCiAJaW50ZWxf
ZGRpX2VuYWJsZV9mZWMoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAKQEAgLTM2MDUsNyArMzU4OSw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9wcmVfZW5hYmxlX2hkbWkoc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUsCiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQg
PSBlbmNfdG9fZGlnX3BvcnQoZW5jb2Rlcik7CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hk
bWkgPSAmZGlnX3BvcnQtPmhkbWk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0JaW50IGxldmVsID0gaW50ZWxfZGRpX2hk
bWlfbGV2ZWwoZW5jb2Rlcik7CisJaW50IGxldmVsID0gaW50ZWxfZGRpX2hkbWlfbGV2ZWwoZW5j
b2RlciwgY3J0Y19zdGF0ZSk7CiAKIAlpbnRlbF9kcF9kdWFsX21vZGVfc2V0X3RtZHNfb3V0cHV0
KGludGVsX2hkbWksIHRydWUpOwogCWludGVsX2RkaV9jbGtfc2VsZWN0KGVuY29kZXIsIGNydGNf
c3RhdGUpOwpAQCAtMzYxNSwyMCArMzU5OSwxOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJl
X2VuYWJsZV9oZG1pKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCWljbF9wcm9n
cmFtX21nX2RwX21vZGUoZGlnX3BvcnQsIGNydGNfc3RhdGUpOwogCiAJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTIpCi0JCXRnbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGNydGNf
c3RhdGUtPnBvcnRfY2xvY2ssCi0JCQkJCWxldmVsLCBJTlRFTF9PVVRQVVRfSERNSSk7CisJCXRn
bF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGNydGNfc3RhdGUsIGxldmVsKTsKIAllbHNl
IGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDExKQotCQlpY2xfZGRpX3Zzd2luZ19zZXF1ZW5j
ZShlbmNvZGVyLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAotCQkJCQlsZXZlbCwgSU5URUxfT1VU
UFVUX0hETUkpOworCQlpY2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRl
LCBsZXZlbCk7CiAJZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpCi0JCWNubF9kZGlf
dnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxldmVsLCBJTlRFTF9PVVRQVVRfSERNSSk7CisJCWNu
bF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGNydGNfc3RhdGUsIGxldmVsKTsKIAllbHNl
IGlmIChJU19HRU45X0xQKGRldl9wcml2KSkKLQkJYnh0X2RkaV92c3dpbmdfc2VxdWVuY2UoZW5j
b2RlciwgbGV2ZWwsIElOVEVMX09VVFBVVF9IRE1JKTsKKwkJYnh0X2RkaV92c3dpbmdfc2VxdWVu
Y2UoZW5jb2RlciwgY3J0Y19zdGF0ZSwgbGV2ZWwpOwogCWVsc2UKIAkJaW50ZWxfcHJlcGFyZV9o
ZG1pX2RkaV9idWZmZXJzKGVuY29kZXIsIGxldmVsKTsKIAogCWlmIChJU19HRU45X0JDKGRldl9w
cml2KSkKLQkJc2tsX2RkaV9zZXRfaWJvb3N0KGVuY29kZXIsIGxldmVsLCBJTlRFTF9PVVRQVVRf
SERNSSk7CisJCXNrbF9kZGlfc2V0X2lib29zdChlbmNvZGVyLCBjcnRjX3N0YXRlLCBsZXZlbCk7
CiAKIAlpbnRlbF9kZGlfZW5hYmxlX3BpcGVfY2xvY2soZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAK
QEAgLTM5MTgsMTIgKzM5MDAsMTQgQEAgc3RhdGljIHZvaWQgdHJhbnNfcG9ydF9zeW5jX3N0b3Bf
bGlua190cmFpbihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJICAgIGNydGNf
c3RhdGUtPmNwdV90cmFuc2NvZGVyKQogCQkJY29udGludWU7CiAKLQkJaW50ZWxfZHBfc3RvcF9s
aW5rX3RyYWluKGVuY190b19pbnRlbF9kcChzbGF2ZV9lbmNvZGVyKSk7CisJCWludGVsX2RwX3N0
b3BfbGlua190cmFpbihlbmNfdG9faW50ZWxfZHAoc2xhdmVfZW5jb2RlciksCisJCQkJCSBzbGF2
ZV9jcnRjX3N0YXRlKTsKIAl9CiAKIAl1c2xlZXBfcmFuZ2UoMjAwLCA0MDApOwogCi0JaW50ZWxf
ZHBfc3RvcF9saW5rX3RyYWluKGVuY190b19pbnRlbF9kcChlbmNvZGVyKSk7CisJaW50ZWxfZHBf
c3RvcF9saW5rX3RyYWluKGVuY190b19pbnRlbF9kcChlbmNvZGVyKSwKKwkJCQkgY3J0Y19zdGF0
ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9kZGlfZHAoc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUsCkBAIC0zOTM2LDcgKzM5MjAsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9lbmFibGVfZGRpX2RwKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCWVudW0g
cG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAogCWlmIChwb3J0ID09IFBPUlRfQSAmJiBJTlRF
TF9HRU4oZGV2X3ByaXYpIDwgOSkKLQkJaW50ZWxfZHBfc3RvcF9saW5rX3RyYWluKGludGVsX2Rw
KTsKKwkJaW50ZWxfZHBfc3RvcF9saW5rX3RyYWluKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKIAog
CWludGVsX2VkcF9iYWNrbGlnaHRfb24oY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CiAJaW50ZWxf
cHNyX2VuYWJsZShpbnRlbF9kcCwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CkBAIC00MTk3LDcg
KzQxODEsOCBAQCBpbnRlbF9kZGlfcHJlX3BsbF9lbmFibGUoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUsCiAJCQkJCQljcnRjX3N0YXRlLT5sYW5lX2xhdF9vcHRpbV9tYXNrKTsKIH0K
IAotc3RhdGljIHZvaWQgaW50ZWxfZGRpX3ByZXBhcmVfbGlua19yZXRyYWluKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCitzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlcGFyZV9saW5rX3JldHJh
aW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCQkJICAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
ZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CkBAIC00
MjI1LDkgKzQyMTAsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlcGFyZV9saW5rX3JldHJh
aW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAl9CiAKIAlkcF90cF9jdGwgPSBEUF9UUF9D
VExfRU5BQkxFIHwgRFBfVFBfQ1RMX0xJTktfVFJBSU5fUEFUMTsKLQlpZiAoaW50ZWxfZHAtPmxp
bmtfbXN0KQorCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBV
VF9EUF9NU1QpKSB7CiAJCWRwX3RwX2N0bCB8PSBEUF9UUF9DVExfTU9ERV9NU1Q7Ci0JZWxzZSB7
CisJfSBlbHNlIHsKIAkJZHBfdHBfY3RsIHw9IERQX1RQX0NUTF9NT0RFX1NTVDsKIAkJaWYgKGRy
bV9kcF9lbmhhbmNlZF9mcmFtZV9jYXAoaW50ZWxfZHAtPmRwY2QpKQogCQkJZHBfdHBfY3RsIHw9
IERQX1RQX0NUTF9FTkhBTkNFRF9GUkFNRV9FTkFCTEU7CkBAIC00MjQzLDYgKzQyMjgsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlcGFyZV9saW5rX3JldHJhaW4oc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfZGRpX3NldF9saW5rX3RyYWluKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgIHU4IGRwX3RyYWluX3BhdCkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKQEAg
LTQyNzMsNyArNDI1OSw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9zZXRfbGlua190cmFpbihz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBpbnRl
bF9kcC0+cmVncy5kcF90cF9jdGwsIHRlbXApOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9kZGlf
c2V0X2lkbGVfbGlua190cmFpbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQorc3RhdGljIHZv
aWQgaW50ZWxfZGRpX3NldF9pZGxlX2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwKKwkJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
IAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkcF90b19kaWdfcG9ydChpbnRlbF9k
cCktPmJhc2U7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RkaS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGku
aAppbmRleCBmNWZiNjJmYzk0MDAuLjlhMmFjNzMxNjRmOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5oCkBAIC00MSw4ICs0MSwxMCBAQCB2b2lkIGludGVsX2RkaV9z
ZXRfdmNfcGF5bG9hZF9hbGxvYyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkJCQkgICAgYm9vbCBzdGF0ZSk7CiB2b2lkIGludGVsX2RkaV9jb21wdXRlX21pbl92
b2x0YWdlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCQkJIHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKLXUzMiBieHRfc2lnbmFsX2xldmVs
cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKLXUzMiBkZGlfc2lnbmFsX2xldmVscyhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKK3UzMiBieHRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAorCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSk7Cit1MzIgZGRpX3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwKKwkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
OwogaW50IGludGVsX2RkaV90b2dnbGVfaGRjcF9zaWduYWxsaW5nKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICppbnRlbF9lbmNvZGVyLAogCQkJCSAgICAgZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2Nv
ZGVyLAogCQkJCSAgICAgYm9vbCBlbmFibGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCBlMzMzOWU0MWRkZjcuLjY2ZDE5
NzE1M2M5MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3R5cGVzLmgKQEAgLTEyNzMsNyArMTI3Myw2IEBAIHN0cnVjdCBpbnRlbF9kcCB7CiAJ
aW50IGxpbmtfcmF0ZTsKIAl1OCBsYW5lX2NvdW50OwogCXU4IHNpbmtfY291bnQ7Ci0JYm9vbCBs
aW5rX21zdDsKIAlib29sIGxpbmtfdHJhaW5lZDsKIAlib29sIGhhc19oZG1pX3Npbms7CiAJYm9v
bCBoYXNfYXVkaW87CkBAIC0xMzY2LDEzICsxMzY1LDE5IEBAIHN0cnVjdCBpbnRlbF9kcCB7CiAJ
aTkxNV9yZWdfdCAoKmF1eF9jaF9kYXRhX3JlZykoc3RydWN0IGludGVsX2RwICpkcCwgaW50IGlu
ZGV4KTsKIAogCS8qIFRoaXMgaXMgY2FsbGVkIGJlZm9yZSBhIGxpbmsgdHJhaW5pbmcgaXMgc3Rh
cnRlcmQgKi8KLQl2b2lkICgqcHJlcGFyZV9saW5rX3JldHJhaW4pKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApOwotCXZvaWQgKCpzZXRfbGlua190cmFpbikoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwgdTggZHBfdHJhaW5fcGF0KTsKLQl2b2lkICgqc2V0X2lkbGVfbGlua190cmFpbikoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCk7Ci0Jdm9pZCAoKnNldF9zaWduYWxfbGV2ZWxzKShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKKwl2b2lkICgqcHJlcGFyZV9saW5rX3JldHJhaW4pKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CisJdm9pZCAoKnNldF9saW5rX3RyYWluKShzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAorCQkJICAgICAgIHU4IGRwX3RyYWluX3BhdCk7CisJdm9pZCAoKnNldF9p
ZGxlX2xpbmtfdHJhaW4pKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKKwl2b2lkICgqc2V0X3NpZ25h
bF9sZXZlbHMpKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiAKIAl1OCAoKnByZWVtcGhfbWF4KShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKLQl1OCAoKnZvbHRhZ2VfbWF4KShzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKTsKKwl1OCAoKnZvbHRhZ2VfbWF4KShzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAorCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiAK
IAkvKiBEaXNwbGF5cG9ydCBjb21wbGlhbmNlIHRlc3RpbmcgKi8KIAlzdHJ1Y3QgaW50ZWxfZHBf
Y29tcGxpYW5jZSBjb21wbGlhbmNlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cC5jCmluZGV4IDEzMmIwNmE2NDlkOC4uMzcxNWNmOGMwYTZhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC0yNzk5LDEzICsyNzk5LDExIEBAIGludGVsX2RwX2Nv
bXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogfQogCiB2b2lkIGlu
dGVsX2RwX3NldF9saW5rX3BhcmFtcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAotCQkJICAg
ICAgaW50IGxpbmtfcmF0ZSwgdTggbGFuZV9jb3VudCwKLQkJCSAgICAgIGJvb2wgbGlua19tc3Qp
CisJCQkgICAgICBpbnQgbGlua19yYXRlLCBpbnQgbGFuZV9jb3VudCkKIHsKIAlpbnRlbF9kcC0+
bGlua190cmFpbmVkID0gZmFsc2U7CiAJaW50ZWxfZHAtPmxpbmtfcmF0ZSA9IGxpbmtfcmF0ZTsK
IAlpbnRlbF9kcC0+bGFuZV9jb3VudCA9IGxhbmVfY291bnQ7Ci0JaW50ZWxfZHAtPmxpbmtfbXN0
ID0gbGlua19tc3Q7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2RwX3ByZXBhcmUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCkBAIC0yODE3LDEwICsyODE1LDkgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHBfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7
CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKLQlpbnRlbF9kcF9zZXRfbGlua19wYXJhbXMoaW50
ZWxfZHAsIHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrLAotCQkJCSBwaXBlX2NvbmZpZy0+bGFuZV9j
b3VudCwKLQkJCQkgaW50ZWxfY3J0Y19oYXNfdHlwZShwaXBlX2NvbmZpZywKLQkJCQkJCSAgICAg
SU5URUxfT1VUUFVUX0RQX01TVCkpOworCWludGVsX2RwX3NldF9saW5rX3BhcmFtcyhpbnRlbF9k
cCwKKwkJCQkgcGlwZV9jb25maWctPnBvcnRfY2xvY2ssCisJCQkJIHBpcGVfY29uZmlnLT5sYW5l
X2NvdW50KTsKIAogCS8qCiAJICogVGhlcmUgYXJlIGZvdXIga2luZHMgb2YgRFAgcmVnaXN0ZXJz
OgpAQCAtMzc5MSw2ICszNzg4LDcgQEAgc3RhdGljIHZvaWQgY2h2X3Bvc3RfZGlzYWJsZV9kcChz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAogc3RhdGljIHZvaWQKIGNwdF9zZXRf
bGlua190cmFpbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJICAgdTggZHBfdHJhaW5fcGF0KQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHAp
OwpAQCAtMzgyMSw2ICszODE5LDcgQEAgY3B0X3NldF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAsCiAKIHN0YXRpYyB2b2lkCiBnNHhfc2V0X2xpbmtfdHJhaW4oc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCwKKwkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCSAgIHU4IGRwX3RyYWluX3BhdCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKQEAgLTM4NTYsNyArMzg1NSw4
IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2VuYWJsZV9wb3J0KHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiAKIAkvKiBlbmFibGUgd2l0aCBwYXR0ZXJuIDEgKGFzIHBlciBzcGVjKSAqLwogCi0J
aW50ZWxfZHBfcHJvZ3JhbV9saW5rX3RyYWluaW5nX3BhdHRlcm4oaW50ZWxfZHAsIERQX1RSQUlO
SU5HX1BBVFRFUk5fMSk7CisJaW50ZWxfZHBfcHJvZ3JhbV9saW5rX3RyYWluaW5nX3BhdHRlcm4o
aW50ZWxfZHAsIGNydGNfc3RhdGUsCisJCQkJCSAgICAgICBEUF9UUkFJTklOR19QQVRURVJOXzEp
OwogCiAJLyoKIAkgKiBNYWdpYyBmb3IgVkxWL0NIVi4gV2UgX211c3RfIGZpcnN0IHNldCB1cCB0
aGUgcmVnaXN0ZXIKQEAgLTM5NDcsOCArMzk0Nyw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJs
ZV9kcChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAogCWludGVsX2RwX3Npbmtf
ZHBtcyhpbnRlbF9kcCwgRFJNX01PREVfRFBNU19PTik7CiAJaW50ZWxfZHBfY29uZmlndXJlX3By
b3RvY29sX2NvbnZlcnRlcihpbnRlbF9kcCk7Ci0JaW50ZWxfZHBfc3RhcnRfbGlua190cmFpbihp
bnRlbF9kcCk7Ci0JaW50ZWxfZHBfc3RvcF9saW5rX3RyYWluKGludGVsX2RwKTsKKwlpbnRlbF9k
cF9zdGFydF9saW5rX3RyYWluKGludGVsX2RwLCBwaXBlX2NvbmZpZyk7CisJaW50ZWxfZHBfc3Rv
cF9saW5rX3RyYWluKGludGVsX2RwLCBwaXBlX2NvbmZpZyk7CiAKIAlpZiAocGlwZV9jb25maWct
Pmhhc19hdWRpbykgewogCQlkcm1fZGJnKCZkZXZfcHJpdi0+ZHJtLCAiRW5hYmxpbmcgRFAgYXVk
aW8gb24gcGlwZSAlY1xuIiwKQEAgLTQxNTcsMTIgKzQxNTcsMTQgQEAgaW50ZWxfZHBfZ2V0X2xp
bmtfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHU4IGxpbmtfc3RhdHVzW0RQX0xJ
TktfU1RBVFUKIAkJCQlEUF9MSU5LX1NUQVRVU19TSVpFKSA9PSBEUF9MSU5LX1NUQVRVU19TSVpF
OwogfQogCi1zdGF0aWMgdTggaW50ZWxfZHBfdm9sdGFnZV9tYXhfMihzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwKQorc3RhdGljIHU4IGludGVsX2RwX3ZvbHRhZ2VfbWF4XzIoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwKKwkJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7CiAJcmV0dXJuIERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMjsKIH0KIAot
c3RhdGljIHU4IGludGVsX2RwX3ZvbHRhZ2VfbWF4XzMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKK3N0YXRpYyB1OCBpbnRlbF9kcF92b2x0YWdlX21heF8zKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCisJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewogCXJldHVybiBEUF9UUkFJTl9WT0xUQUdFX1NXSU5HX0xFVkVMXzM7CiB9CkBAIC00MTc3LDcg
KzQxNzksOCBAQCBzdGF0aWMgdTggaW50ZWxfZHBfcHJlZW1waF9tYXhfMyhzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQogCXJldHVybiBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8zOwogfQogCi1z
dGF0aWMgdm9pZCB2bHZfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKK3N0YXRpYyB2b2lkIHZsdl9zZXRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwLAorCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50
ZWxfZHApLT5iYXNlOwogCXVuc2lnbmVkIGxvbmcgZGVtcGhfcmVnX3ZhbHVlLCBwcmVlbXBoX3Jl
Z192YWx1ZSwKQEAgLTQyNTcsMTEgKzQyNjAsMTMgQEAgc3RhdGljIHZvaWQgdmx2X3NldF9zaWdu
YWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCXJldHVybjsKIAl9CiAKLQl2
bHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoZW5jb2RlciwgZGVtcGhfcmVnX3ZhbHVlLCBwcmVlbXBo
X3JlZ192YWx1ZSwKKwl2bHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoZW5jb2RlciwgY3J0Y19zdGF0
ZSwKKwkJCQkgZGVtcGhfcmVnX3ZhbHVlLCBwcmVlbXBoX3JlZ192YWx1ZSwKIAkJCQkgdW5pcXRy
YW5zY2FsZV9yZWdfdmFsdWUsIDApOwogfQogCi1zdGF0aWMgdm9pZCBjaHZfc2V0X3NpZ25hbF9s
ZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK3N0YXRpYyB2b2lkIGNodl9zZXRfc2ln
bmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCSAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlOwogCXUzMiBkZWVtcGhf
cmVnX3ZhbHVlLCBtYXJnaW5fcmVnX3ZhbHVlOwpAQCAtNDMzOCw4ICs0MzQzLDkgQEAgc3RhdGlj
IHZvaWQgY2h2X3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJ
CXJldHVybjsKIAl9CiAKLQljaHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoZW5jb2RlciwgZGVlbXBo
X3JlZ192YWx1ZSwKLQkJCQkgbWFyZ2luX3JlZ192YWx1ZSwgdW5pcV90cmFuc19zY2FsZSk7CisJ
Y2h2X3NldF9waHlfc2lnbmFsX2xldmVsKGVuY29kZXIsIGNydGNfc3RhdGUsCisJCQkJIGRlZW1w
aF9yZWdfdmFsdWUsIG1hcmdpbl9yZWdfdmFsdWUsCisJCQkJIHVuaXFfdHJhbnNfc2NhbGUpOwog
fQogCiBzdGF0aWMgdTMyIGc0eF9zaWduYWxfbGV2ZWxzKHU4IHRyYWluX3NldCkKQEAgLTQzODAs
NyArNDM4Niw4IEBAIHN0YXRpYyB1MzIgZzR4X3NpZ25hbF9sZXZlbHModTggdHJhaW5fc2V0KQog
fQogCiBzdGF0aWMgdm9pZAotZzR4X3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCitnNHhfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwKKwkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9k
cCk7CiAJdTggdHJhaW5fc2V0ID0gaW50ZWxfZHAtPnRyYWluX3NldFswXTsKQEAgLTQ0MjcsNyAr
NDQzNCw4IEBAIHN0YXRpYyB1MzIgc25iX2NwdV9lZHBfc2lnbmFsX2xldmVscyh1OCB0cmFpbl9z
ZXQpCiB9CiAKIHN0YXRpYyB2b2lkCi1zbmJfY3B1X2VkcF9zZXRfc2lnbmFsX2xldmVscyhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQorc25iX2NwdV9lZHBfc2V0X3NpZ25hbF9sZXZlbHMoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXU4IHRyYWluX3NldCA9IGludGVsX2RwLT50cmFp
bl9zZXRbMF07CkBAIC00NDc4LDcgKzQ0ODYsOCBAQCBzdGF0aWMgdTMyIGl2Yl9jcHVfZWRwX3Np
Z25hbF9sZXZlbHModTggdHJhaW5fc2V0KQogfQogCiBzdGF0aWMgdm9pZAotaXZiX2NwdV9lZHBf
c2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK2l2Yl9jcHVfZWRw
X3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkgICAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1OCB0cmFp
bl9zZXQgPSBpbnRlbF9kcC0+dHJhaW5fc2V0WzBdOwpAQCAtNDQ5Niw3ICs0NTA1LDggQEAgaXZi
X2NwdV9lZHBfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlp
bnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIGludGVsX2RwLT5vdXRwdXRfcmVnKTsKIH0K
IAotdm9pZCBpbnRlbF9kcF9zZXRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQordm9pZCBpbnRlbF9kcF9zZXRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwLAorCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxf
ZHApOwogCXU4IHRyYWluX3NldCA9IGludGVsX2RwLT50cmFpbl9zZXRbMF07CkBAIC00NTEwLDEx
ICs0NTIwLDEyIEBAIHZvaWQgaW50ZWxfZHBfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKIAkJICAgIHRyYWluX3NldCAmIERQX1RSQUlOX01BWF9QUkVfRU1QSEFT
SVNfUkVBQ0hFRCA/CiAJCSAgICAiIChtYXgpIiA6ICIiKTsKIAotCWludGVsX2RwLT5zZXRfc2ln
bmFsX2xldmVscyhpbnRlbF9kcCk7CisJaW50ZWxfZHAtPnNldF9zaWduYWxfbGV2ZWxzKGludGVs
X2RwLCBjcnRjX3N0YXRlKTsKIH0KIAogdm9pZAogaW50ZWxfZHBfcHJvZ3JhbV9saW5rX3RyYWlu
aW5nX3BhdHRlcm4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCQkgICAgICAgY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgICAgIHU4IGRwX3Ry
YWluX3BhdCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19p
OTE1KGludGVsX2RwKTsKQEAgLTQ1MjUsMTMgKzQ1MzYsMTQgQEAgaW50ZWxfZHBfcHJvZ3JhbV9s
aW5rX3RyYWluaW5nX3BhdHRlcm4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCSAgICAi
VXNpbmcgRFAgdHJhaW5pbmcgcGF0dGVybiBUUFMlZFxuIiwKIAkJCSAgICBkcF90cmFpbl9wYXQg
JiB0cmFpbl9wYXRfbWFzayk7CiAKLQlpbnRlbF9kcC0+c2V0X2xpbmtfdHJhaW4oaW50ZWxfZHAs
IGRwX3RyYWluX3BhdCk7CisJaW50ZWxfZHAtPnNldF9saW5rX3RyYWluKGludGVsX2RwLCBjcnRj
X3N0YXRlLCBkcF90cmFpbl9wYXQpOwogfQogCi12b2lkIGludGVsX2RwX3NldF9pZGxlX2xpbmtf
dHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK3ZvaWQgaW50ZWxfZHBfc2V0X2lkbGVf
bGlua190cmFpbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCSAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJaWYgKGludGVsX2RwLT5zZXRfaWRs
ZV9saW5rX3RyYWluKQotCQlpbnRlbF9kcC0+c2V0X2lkbGVfbGlua190cmFpbihpbnRlbF9kcCk7
CisJCWludGVsX2RwLT5zZXRfaWRsZV9saW5rX3RyYWluKGludGVsX2RwLCBjcnRjX3N0YXRlKTsK
IH0KIAogc3RhdGljIHZvaWQKQEAgLTU0MjQsMTQgKzU0MzYsMTQgQEAgc3RhdGljIHU4IGludGVs
X2RwX2F1dG90ZXN0X2VkaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlyZXR1cm4gdGVz
dF9yZXN1bHQ7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX2RwX3BoeV9wYXR0ZXJuX3VwZGF0ZShz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQorc3RhdGljIHZvaWQgaW50ZWxfZHBfcGh5X3BhdHRl
cm5fdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJCWNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9CiAJCQl0b19pOTE1KGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKS0+YmFzZS5i
YXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19k
aWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9kcF9waHlfdGVzdF9wYXJhbXMgKmRhdGEg
PQogCQkJJmludGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfZGF0YS5waHl0ZXN0OwotCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhkaWdfcG9ydC0+YmFzZS5iYXNlLmNydGMp
OworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51
YXBpLmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgcGF0dGVybl92
YWw7CiAKQEAgLTU0OTEsNyArNTUwMyw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX3BoeV9wYXR0
ZXJuX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogfQogCiBzdGF0aWMgdm9pZAot
aW50ZWxfZHBfYXV0b3Rlc3RfcGh5X2RkaV9kaXNhYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCitpbnRlbF9kcF9hdXRvdGVzdF9waHlfZGRpX2Rpc2FibGUoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKKwkJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3Bv
cnQoaW50ZWxfZHApOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBkaWdfcG9ydC0+YmFzZS5i
YXNlLmRldjsKQEAgLTU1MTcsNyArNTUzMCw4IEBAIGludGVsX2RwX2F1dG90ZXN0X3BoeV9kZGlf
ZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogfQogCiBzdGF0aWMgdm9pZAotaW50
ZWxfZHBfYXV0b3Rlc3RfcGh5X2RkaV9lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwg
dWludDhfdCBsYW5lX2NudCkKK2ludGVsX2RwX2F1dG90ZXN0X3BoeV9kZGlfZW5hYmxlKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0g
ZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBkaWdf
cG9ydC0+YmFzZS5iYXNlLmRldjsKQEAgLTU1NDMsNyArNTU1Nyw4IEBAIGludGVsX2RwX2F1dG90
ZXN0X3BoeV9kZGlfZW5hYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHVpbnQ4X3QgbGFu
ZV9jbnQpCiAJCSAgICAgICB0cmFuc19kZGlfZnVuY19jdGxfdmFsdWUpOwogfQogCi1zdGF0aWMg
dm9pZCBpbnRlbF9kcF9wcm9jZXNzX3BoeV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCitzdGF0aWMgdm9pZCBpbnRlbF9kcF9wcm9jZXNzX3BoeV9yZXF1ZXN0KHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsCisJCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2RwX3BoeV90ZXN0X3BhcmFtcyAqZGF0YSA9CiAJCSZp
bnRlbF9kcC0+Y29tcGxpYW5jZS50ZXN0X2RhdGEucGh5dGVzdDsKQEAgLTU1NTUsMTUgKzU1NzAs
MTUgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfcHJvY2Vzc19waHlfcmVxdWVzdChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQogCX0KIAogCS8qIHJldHJpZXZlIHZzd2luZyAmIHByZS1lbXBoYXNp
cyBzZXR0aW5nICovCi0JaW50ZWxfZHBfZ2V0X2FkanVzdF90cmFpbihpbnRlbF9kcCwgbGlua19z
dGF0dXMpOworCWludGVsX2RwX2dldF9hZGp1c3RfdHJhaW4oaW50ZWxfZHAsIGNydGNfc3RhdGUs
IGxpbmtfc3RhdHVzKTsKIAotCWludGVsX2RwX2F1dG90ZXN0X3BoeV9kZGlfZGlzYWJsZShpbnRl
bF9kcCk7CisJaW50ZWxfZHBfYXV0b3Rlc3RfcGh5X2RkaV9kaXNhYmxlKGludGVsX2RwLCBjcnRj
X3N0YXRlKTsKIAotCWludGVsX2RwX3NldF9zaWduYWxfbGV2ZWxzKGludGVsX2RwKTsKKwlpbnRl
bF9kcF9zZXRfc2lnbmFsX2xldmVscyhpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAKLQlpbnRlbF9k
cF9waHlfcGF0dGVybl91cGRhdGUoaW50ZWxfZHApOworCWludGVsX2RwX3BoeV9wYXR0ZXJuX3Vw
ZGF0ZShpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAKLQlpbnRlbF9kcF9hdXRvdGVzdF9waHlfZGRp
X2VuYWJsZShpbnRlbF9kcCwgZGF0YS0+bnVtX2xhbmVzKTsKKwlpbnRlbF9kcF9hdXRvdGVzdF9w
aHlfZGRpX2VuYWJsZShpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAKIAlkcm1fZHBfc2V0X3BoeV90
ZXN0X3BhdHRlcm4oJmludGVsX2RwLT5hdXgsIGRhdGEsCiAJCQkJICAgIGxpbmtfc3RhdHVzW0RQ
X0RQQ0RfUkVWXSk7CkBAIC01NzE5LDYgKzU3MzQsMTAgQEAgaW50ZWxfZHBfbmVlZHNfbGlua19y
ZXRyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJLyoKIAkgKiBWYWxpZGF0ZSB0aGUg
Y2FjaGVkIHZhbHVlcyBvZiBpbnRlbF9kcC0+bGlua19yYXRlIGFuZAogCSAqIGludGVsX2RwLT5s
YW5lX2NvdW50IGJlZm9yZSBhdHRlbXB0aW5nIHRvIHJldHJhaW4uCisJICoKKwkgKiBGSVhNRSB3
b3VsZCBiZSBuaWNlIHRvIHVzZXIgdGhlIGNydGMgc3RhdGUgaGVyZSwgYnV0IHNpbmNlCisJICog
d2UgbmVlZCB0byBjYWxsIHRoaXMgZnJvbSB0aGUgc2hvcnQgSFBEIGhhbmRsZXIgdGhhdCBzZWVt
cworCSAqIGEgYml0IGhhcmQuCiAJICovCiAJaWYgKCFpbnRlbF9kcF9saW5rX3BhcmFtc192YWxp
ZChpbnRlbF9kcCwgaW50ZWxfZHAtPmxpbmtfcmF0ZSwKIAkJCQkJaW50ZWxfZHAtPmxhbmVfY291
bnQpKQpAQCAtNTg1Miw4ICs1ODcxLDIwIEBAIGludCBpbnRlbF9kcF9yZXRyYWluX2xpbmsoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCQkJICAgICAgaW50ZWxfY3J0Y19wY2hf
dHJhbnNjb2RlcihjcnRjKSwgZmFsc2UpOwogCX0KIAotCWludGVsX2RwX3N0YXJ0X2xpbmtfdHJh
aW4oaW50ZWxfZHApOwotCWludGVsX2RwX3N0b3BfbGlua190cmFpbihpbnRlbF9kcCk7CisJZm9y
X2VhY2hfaW50ZWxfY3J0Y19tYXNrKCZkZXZfcHJpdi0+ZHJtLCBjcnRjLCBjcnRjX21hc2spIHsK
KwkJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQorCQkJdG9faW50
ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKKworCQkvKiByZXRyYWluIG9uIHRoZSBN
U1QgbWFzdGVyIHRyYW5zY29kZXIgKi8KKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIg
JiYKKwkJICAgIGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RQ
X01TVCkgJiYKKwkJICAgICFpbnRlbF9kcF9tc3RfaXNfbWFzdGVyX3RyYW5zKGNydGNfc3RhdGUp
KQorCQkJY29udGludWU7CisKKwkJaW50ZWxfZHBfc3RhcnRfbGlua190cmFpbihpbnRlbF9kcCwg
Y3J0Y19zdGF0ZSk7CisJCWludGVsX2RwX3N0b3BfbGlua190cmFpbihpbnRlbF9kcCwgY3J0Y19z
dGF0ZSk7CisJCWJyZWFrOworCX0KIAogCWZvcl9lYWNoX2ludGVsX2NydGNfbWFzaygmZGV2X3By
aXYtPmRybSwgY3J0YywgY3J0Y19tYXNrKSB7CiAJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlID0KQEAgLTU5MjMsNiArNTk1NCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
ZHBfZG9fcGh5X3Rlc3Qoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAl1MzIgY3J0Y19tYXNrOwogCWludCByZXQ7CiAK
QEAgLTU5NDAsNyArNTk3MiwyMCBAQCBzdGF0aWMgaW50IGludGVsX2RwX2RvX3BoeV90ZXN0KHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5k
cm0sICJbRU5DT0RFUjolZDolc10gUEhZIHRlc3RcbiIsCiAJCSAgICBlbmNvZGVyLT5iYXNlLmJh
c2UuaWQsIGVuY29kZXItPmJhc2UubmFtZSk7Ci0JaW50ZWxfZHBfcHJvY2Vzc19waHlfcmVxdWVz
dChpbnRlbF9kcCk7CisKKwlmb3JfZWFjaF9pbnRlbF9jcnRjX21hc2soJmRldl9wcml2LT5kcm0s
IGNydGMsIGNydGNfbWFzaykgeworCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSA9CisJCQl0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOworCisJ
CS8qIHRlc3Qgb24gdGhlIE1TVCBtYXN0ZXIgdHJhbnNjb2RlciAqLworCQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMiAmJgorCQkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRl
LCBJTlRFTF9PVVRQVVRfRFBfTVNUKSAmJgorCQkgICAgIWludGVsX2RwX21zdF9pc19tYXN0ZXJf
dHJhbnMoY3J0Y19zdGF0ZSkpCisJCQljb250aW51ZTsKKworCQlpbnRlbF9kcF9wcm9jZXNzX3Bo
eV9yZXF1ZXN0KGludGVsX2RwLCBjcnRjX3N0YXRlKTsKKwkJYnJlYWs7CisJfQogCiAJcmV0dXJu
IDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmgKaW5kZXggNjBmNDRm
NDFmZDA4Li42Njg1NGFhYjk4ODcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHAuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RwLmgKQEAgLTQ1LDggKzQ1LDcgQEAgYm9vbCBpbnRlbF9kcF9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgaTkxNV9yZWdfdCBvdXRwdXRfcmVnLAogYm9vbCBpbnRlbF9k
cF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCwKIAkJ
CSAgICAgc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yKTsKIHZvaWQgaW50
ZWxfZHBfc2V0X2xpbmtfcGFyYW1zKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCi0JCQkgICAg
ICBpbnQgbGlua19yYXRlLCB1OCBsYW5lX2NvdW50LAotCQkJICAgICAgYm9vbCBsaW5rX21zdCk7
CisJCQkgICAgICBpbnQgbGlua19yYXRlLCBpbnQgbGFuZV9jb3VudCk7CiBpbnQgaW50ZWxfZHBf
Z2V0X2xpbmtfdHJhaW5fZmFsbGJhY2tfdmFsdWVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAs
CiAJCQkJCSAgICBpbnQgbGlua19yYXRlLCB1OCBsYW5lX2NvdW50KTsKIGludCBpbnRlbF9kcF9y
ZXRyYWluX2xpbmsoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCkBAIC05MywxMCArOTIs
MTMgQEAgdm9pZCBpbnRlbF9lZHBfZHJyc19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAKIHZvaWQKIGludGVsX2RwX3Byb2dyYW1fbGlua190cmFpbmluZ19wYXR0ZXJu
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICAgICB1OCBkcF90cmFpbl9wYXQpOwog
dm9pZAotaW50ZWxfZHBfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCk7Ci12b2lkIGludGVsX2RwX3NldF9pZGxlX2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCk7CitpbnRlbF9kcF9zZXRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwLAorCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
Owordm9pZCBpbnRlbF9kcF9zZXRfaWRsZV9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCisJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7
CiB2b2lkIGludGVsX2RwX2NvbXB1dGVfcmF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBp
bnQgcG9ydF9jbG9jaywKIAkJCSAgIHU4ICpsaW5rX2J3LCB1OCAqcmF0ZV9zZWxlY3QpOwogYm9v
bCBpbnRlbF9kcF9zb3VyY2Vfc3VwcG9ydHNfaGJyMihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbGlu
a190cmFpbmluZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9saW5r
X3RyYWluaW5nLmMKaW5kZXggZjJjOGI1NmJlOWVhLi41MWU4ZDQ2ZDliN2YgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbGlua190cmFpbmluZy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbGlua190cmFpbmluZy5j
CkBAIC00OSw4ICs0OSwxMCBAQCBzdGF0aWMgdTggZHBfdm9sdGFnZV9tYXgodTggcHJlZW1waCkK
IAl9CiB9CiAKLXZvaWQgaW50ZWxfZHBfZ2V0X2FkanVzdF90cmFpbihzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLAotCQkJICAgICAgIGNvbnN0IHU4IGxpbmtfc3RhdHVzW0RQX0xJTktfU1RBVFVT
X1NJWkVdKQordm9pZAoraW50ZWxfZHBfZ2V0X2FkanVzdF90cmFpbihzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLAorCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKKwkJCSAgY29uc3QgdTggbGlua19zdGF0dXNbRFBfTElOS19TVEFUVVNfU0laRV0pCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1
OCB2ID0gMDsKQEAgLTU5LDcgKzYxLDcgQEAgdm9pZCBpbnRlbF9kcF9nZXRfYWRqdXN0X3RyYWlu
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJdTggdm9sdGFnZV9tYXg7CiAJdTggcHJlZW1w
aF9tYXg7CiAKLQlmb3IgKGxhbmUgPSAwOyBsYW5lIDwgaW50ZWxfZHAtPmxhbmVfY291bnQ7IGxh
bmUrKykgeworCWZvciAobGFuZSA9IDA7IGxhbmUgPCBjcnRjX3N0YXRlLT5sYW5lX2NvdW50OyBs
YW5lKyspIHsKIAkJdiA9IG1heCh2LCBkcm1fZHBfZ2V0X2FkanVzdF9yZXF1ZXN0X3ZvbHRhZ2Uo
bGlua19zdGF0dXMsIGxhbmUpKTsKIAkJcCA9IG1heChwLCBkcm1fZHBfZ2V0X2FkanVzdF9yZXF1
ZXN0X3ByZV9lbXBoYXNpcyhsaW5rX3N0YXR1cywgbGFuZSkpOwogCX0KQEAgLTc0LDcgKzc2LDcg
QEAgdm9pZCBpbnRlbF9kcF9nZXRfYWRqdXN0X3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsCiAKIAl2ID0gbWluKHYsIGRwX3ZvbHRhZ2VfbWF4KHApKTsKIAotCXZvbHRhZ2VfbWF4ID0g
aW50ZWxfZHAtPnZvbHRhZ2VfbWF4KGludGVsX2RwKTsKKwl2b2x0YWdlX21heCA9IGludGVsX2Rw
LT52b2x0YWdlX21heChpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAJZHJtX1dBUk5fT05fT05DRSgm
aTkxNS0+ZHJtLAogCQkJIHZvbHRhZ2VfbWF4ICE9IERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVW
RUxfMiAmJgogCQkJIHZvbHRhZ2VfbWF4ICE9IERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxf
Myk7CkBAIC04OCwxMiArOTAsMTQgQEAgdm9pZCBpbnRlbF9kcF9nZXRfYWRqdXN0X3RyYWluKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAKIHN0YXRpYyBib29sCiBpbnRlbF9kcF9zZXRfbGlu
a190cmFpbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQl1OCBkcF90cmFpbl9wYXQpCiB7CiAJdTggYnVm
W3NpemVvZihpbnRlbF9kcC0+dHJhaW5fc2V0KSArIDFdOwogCWludCByZXQsIGxlbjsKIAotCWlu
dGVsX2RwX3Byb2dyYW1fbGlua190cmFpbmluZ19wYXR0ZXJuKGludGVsX2RwLCBkcF90cmFpbl9w
YXQpOworCWludGVsX2RwX3Byb2dyYW1fbGlua190cmFpbmluZ19wYXR0ZXJuKGludGVsX2RwLCBj
cnRjX3N0YXRlLAorCQkJCQkgICAgICAgZHBfdHJhaW5fcGF0KTsKIAogCWJ1ZlswXSA9IGRwX3Ry
YWluX3BhdDsKIAlpZiAoKGRwX3RyYWluX3BhdCAmIERQX1RSQUlOSU5HX1BBVFRFUk5fTUFTSykg
PT0KQEAgLTEwMiw4ICsxMDYsOCBAQCBpbnRlbF9kcF9zZXRfbGlua190cmFpbihzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAogCQlsZW4gPSAxOwogCX0gZWxzZSB7CiAJCS8qIERQX1RSQUlOSU5H
X0xBTkV4X1NFVCBmb2xsb3cgRFBfVFJBSU5JTkdfUEFUVEVSTl9TRVQgKi8KLQkJbWVtY3B5KGJ1
ZiArIDEsIGludGVsX2RwLT50cmFpbl9zZXQsIGludGVsX2RwLT5sYW5lX2NvdW50KTsKLQkJbGVu
ID0gaW50ZWxfZHAtPmxhbmVfY291bnQgKyAxOworCQltZW1jcHkoYnVmICsgMSwgaW50ZWxfZHAt
PnRyYWluX3NldCwgY3J0Y19zdGF0ZS0+bGFuZV9jb3VudCk7CisJCWxlbiA9IGNydGNfc3RhdGUt
PmxhbmVfY291bnQgKyAxOwogCX0KIAogCXJldCA9IGRybV9kcF9kcGNkX3dyaXRlKCZpbnRlbF9k
cC0+YXV4LCBEUF9UUkFJTklOR19QQVRURVJOX1NFVCwKQEAgLTExNCwzMSArMTE4LDM0IEBAIGlu
dGVsX2RwX3NldF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAKIHN0YXRp
YyBib29sCiBpbnRlbF9kcF9yZXNldF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsCi0JCQl1OCBkcF90cmFpbl9wYXQpCisJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAorCQkJICB1OCBkcF90cmFpbl9wYXQpCiB7CiAJbWVtc2V0KGludGVs
X2RwLT50cmFpbl9zZXQsIDAsIHNpemVvZihpbnRlbF9kcC0+dHJhaW5fc2V0KSk7Ci0JaW50ZWxf
ZHBfc2V0X3NpZ25hbF9sZXZlbHMoaW50ZWxfZHApOwotCXJldHVybiBpbnRlbF9kcF9zZXRfbGlu
a190cmFpbihpbnRlbF9kcCwgZHBfdHJhaW5fcGF0KTsKKwlpbnRlbF9kcF9zZXRfc2lnbmFsX2xl
dmVscyhpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CisJcmV0dXJuIGludGVsX2RwX3NldF9saW5rX3Ry
YWluKGludGVsX2RwLCBjcnRjX3N0YXRlLCBkcF90cmFpbl9wYXQpOwogfQogCiBzdGF0aWMgYm9v
bAotaW50ZWxfZHBfdXBkYXRlX2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkK
K2ludGVsX2RwX3VwZGF0ZV9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJ
CQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlpbnQg
cmV0OwogCi0JaW50ZWxfZHBfc2V0X3NpZ25hbF9sZXZlbHMoaW50ZWxfZHApOworCWludGVsX2Rw
X3NldF9zaWduYWxfbGV2ZWxzKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKIAogCXJldCA9IGRybV9k
cF9kcGNkX3dyaXRlKCZpbnRlbF9kcC0+YXV4LCBEUF9UUkFJTklOR19MQU5FMF9TRVQsCi0JCQkJ
aW50ZWxfZHAtPnRyYWluX3NldCwgaW50ZWxfZHAtPmxhbmVfY291bnQpOworCQkJCWludGVsX2Rw
LT50cmFpbl9zZXQsIGNydGNfc3RhdGUtPmxhbmVfY291bnQpOwogCi0JcmV0dXJuIHJldCA9PSBp
bnRlbF9kcC0+bGFuZV9jb3VudDsKKwlyZXR1cm4gcmV0ID09IGNydGNfc3RhdGUtPmxhbmVfY291
bnQ7CiB9CiAKLXN0YXRpYyBib29sIGludGVsX2RwX2xpbmtfbWF4X3Zzd2luZ19yZWFjaGVkKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCitzdGF0aWMgYm9vbCBpbnRlbF9kcF9saW5rX21heF92
c3dpbmdfcmVhY2hlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCQkgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCWludCBsYW5lOwogCi0J
Zm9yIChsYW5lID0gMDsgbGFuZSA8IGludGVsX2RwLT5sYW5lX2NvdW50OyBsYW5lKyspCisJZm9y
IChsYW5lID0gMDsgbGFuZSA8IGNydGNfc3RhdGUtPmxhbmVfY291bnQ7IGxhbmUrKykKIAkJaWYg
KChpbnRlbF9kcC0+dHJhaW5fc2V0W2xhbmVdICYKIAkJICAgICBEUF9UUkFJTl9NQVhfU1dJTkdf
UkVBQ0hFRCkgPT0gMCkKIAkJCXJldHVybiBmYWxzZTsKQEAgLTE0OCw3ICsxNTUsOCBAQCBzdGF0
aWMgYm9vbCBpbnRlbF9kcF9saW5rX21heF92c3dpbmdfcmVhY2hlZChzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwKQogCiAvKiBFbmFibGUgY29ycmVzcG9uZGluZyBwb3J0IGFuZCBzdGFydCB0cmFp
bmluZyBwYXR0ZXJuIDEgKi8KIHN0YXRpYyBib29sCi1pbnRlbF9kcF9saW5rX3RyYWluaW5nX2Ns
b2NrX3JlY292ZXJ5KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCitpbnRlbF9kcF9saW5rX3Ry
YWluaW5nX2Nsb2NrX3JlY292ZXJ5KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJICAg
ICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1OCB2b2x0
YWdlOwpAQCAtMTU4LDkgKzE2Niw5IEBAIGludGVsX2RwX2xpbmtfdHJhaW5pbmdfY2xvY2tfcmVj
b3Zlcnkoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAl1OCBsaW5rX2J3LCByYXRlX3NlbGVj
dDsKIAogCWlmIChpbnRlbF9kcC0+cHJlcGFyZV9saW5rX3JldHJhaW4pCi0JCWludGVsX2RwLT5w
cmVwYXJlX2xpbmtfcmV0cmFpbihpbnRlbF9kcCk7CisJCWludGVsX2RwLT5wcmVwYXJlX2xpbmtf
cmV0cmFpbihpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAKLQlpbnRlbF9kcF9jb21wdXRlX3JhdGUo
aW50ZWxfZHAsIGludGVsX2RwLT5saW5rX3JhdGUsCisJaW50ZWxfZHBfY29tcHV0ZV9yYXRlKGlu
dGVsX2RwLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAogCQkJICAgICAgJmxpbmtfYncsICZyYXRl
X3NlbGVjdCk7CiAKIAlpZiAobGlua19idykKQEAgLTE3Miw3ICsxODAsNyBAQCBpbnRlbF9kcF9s
aW5rX3RyYWluaW5nX2Nsb2NrX3JlY292ZXJ5KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAK
IAkvKiBXcml0ZSB0aGUgbGluayBjb25maWd1cmF0aW9uIGRhdGEgKi8KIAlsaW5rX2NvbmZpZ1sw
XSA9IGxpbmtfYnc7Ci0JbGlua19jb25maWdbMV0gPSBpbnRlbF9kcC0+bGFuZV9jb3VudDsKKwls
aW5rX2NvbmZpZ1sxXSA9IGNydGNfc3RhdGUtPmxhbmVfY291bnQ7CiAJaWYgKGRybV9kcF9lbmhh
bmNlZF9mcmFtZV9jYXAoaW50ZWxfZHAtPmRwY2QpKQogCQlsaW5rX2NvbmZpZ1sxXSB8PSBEUF9M
QU5FX0NPVU5UX0VOSEFOQ0VEX0ZSQU1FX0VOOwogCWRybV9kcF9kcGNkX3dyaXRlKCZpbnRlbF9k
cC0+YXV4LCBEUF9MSU5LX0JXX1NFVCwgbGlua19jb25maWcsIDIpOwpAQCAtMTg5LDcgKzE5Nyw3
IEBAIGludGVsX2RwX2xpbmtfdHJhaW5pbmdfY2xvY2tfcmVjb3Zlcnkoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIAlpbnRlbF9kcC0+RFAgfD0gRFBfUE9SVF9FTjsKIAogCS8qIGNsb2NrIHJl
Y292ZXJ5ICovCi0JaWYgKCFpbnRlbF9kcF9yZXNldF9saW5rX3RyYWluKGludGVsX2RwLAorCWlm
ICghaW50ZWxfZHBfcmVzZXRfbGlua190cmFpbihpbnRlbF9kcCwgY3J0Y19zdGF0ZSwKIAkJCQkg
ICAgICAgRFBfVFJBSU5JTkdfUEFUVEVSTl8xIHwKIAkJCQkgICAgICAgRFBfTElOS19TQ1JBTUJM
SU5HX0RJU0FCTEUpKSB7CiAJCWRybV9lcnIoJmk5MTUtPmRybSwgImZhaWxlZCB0byBlbmFibGUg
bGluayB0cmFpbmluZ1xuIik7CkBAIC0yMjAsNyArMjI4LDcgQEAgaW50ZWxfZHBfbGlua190cmFp
bmluZ19jbG9ja19yZWNvdmVyeShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkJcmV0dXJu
IGZhbHNlOwogCQl9CiAKLQkJaWYgKGRybV9kcF9jbG9ja19yZWNvdmVyeV9vayhsaW5rX3N0YXR1
cywgaW50ZWxfZHAtPmxhbmVfY291bnQpKSB7CisJCWlmIChkcm1fZHBfY2xvY2tfcmVjb3Zlcnlf
b2sobGlua19zdGF0dXMsIGNydGNfc3RhdGUtPmxhbmVfY291bnQpKSB7CiAJCQlkcm1fZGJnX2tt
cygmaTkxNS0+ZHJtLCAiY2xvY2sgcmVjb3ZlcnkgT0tcbiIpOwogCQkJcmV0dXJuIHRydWU7CiAJ
CX0KQEAgLTIzOSw4ICsyNDcsOCBAQCBpbnRlbF9kcF9saW5rX3RyYWluaW5nX2Nsb2NrX3JlY292
ZXJ5KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCXZvbHRhZ2UgPSBpbnRlbF9kcC0+dHJh
aW5fc2V0WzBdICYgRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19NQVNLOwogCiAJCS8qIFVwZGF0ZSB0
cmFpbmluZyBzZXQgYXMgcmVxdWVzdGVkIGJ5IHRhcmdldCAqLwotCQlpbnRlbF9kcF9nZXRfYWRq
dXN0X3RyYWluKGludGVsX2RwLCBsaW5rX3N0YXR1cyk7Ci0JCWlmICghaW50ZWxfZHBfdXBkYXRl
X2xpbmtfdHJhaW4oaW50ZWxfZHApKSB7CisJCWludGVsX2RwX2dldF9hZGp1c3RfdHJhaW4oaW50
ZWxfZHAsIGNydGNfc3RhdGUsIGxpbmtfc3RhdHVzKTsKKwkJaWYgKCFpbnRlbF9kcF91cGRhdGVf
bGlua190cmFpbihpbnRlbF9kcCwgY3J0Y19zdGF0ZSkpIHsKIAkJCWRybV9lcnIoJmk5MTUtPmRy
bSwKIAkJCQkiZmFpbGVkIHRvIHVwZGF0ZSBsaW5rIHRyYWluaW5nXG4iKTsKIAkJCXJldHVybiBm
YWxzZTsKQEAgLTI1Miw3ICsyNjAsNyBAQCBpbnRlbF9kcF9saW5rX3RyYWluaW5nX2Nsb2NrX3Jl
Y292ZXJ5KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCWVsc2UKIAkJCXZvbHRhZ2VfdHJp
ZXMgPSAxOwogCi0JCWlmIChpbnRlbF9kcF9saW5rX21heF92c3dpbmdfcmVhY2hlZChpbnRlbF9k
cCkpCisJCWlmIChpbnRlbF9kcF9saW5rX21heF92c3dpbmdfcmVhY2hlZChpbnRlbF9kcCwgY3J0
Y19zdGF0ZSkpCiAJCQltYXhfdnN3aW5nX3JlYWNoZWQgPSB0cnVlOwogCiAJfQpAQCAtMjY2LDcg
KzI3NCw4IEBAIGludGVsX2RwX2xpbmtfdHJhaW5pbmdfY2xvY2tfcmVjb3Zlcnkoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKICAqIG9yIGZvciAxLjQgZGV2aWNlcyB0aGF0IHN1cHBvcnQgaXQs
IHRyYWluaW5nIFBhdHRlcm4gMyBmb3IgSEJSMgogICogb3IgMS4yIGRldmljZXMgdGhhdCBzdXBw
b3J0IGl0LCBUcmFpbmluZyBQYXR0ZXJuIDIgb3RoZXJ3aXNlLgogICovCi1zdGF0aWMgdTMyIGlu
dGVsX2RwX3RyYWluaW5nX3BhdHRlcm4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK3N0YXRp
YyB1MzIgaW50ZWxfZHBfdHJhaW5pbmdfcGF0dGVybihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
LAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
CiAJYm9vbCBzb3VyY2VfdHBzMywgc2lua190cHMzLCBzb3VyY2VfdHBzNCwgc2lua190cHM0Owog
CkBAIC0yODAsNyArMjg5LDcgQEAgc3RhdGljIHUzMiBpbnRlbF9kcF90cmFpbmluZ19wYXR0ZXJu
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJc2lua190cHM0ID0gZHJtX2RwX3RwczRfc3Vw
cG9ydGVkKGludGVsX2RwLT5kcGNkKTsKIAlpZiAoc291cmNlX3RwczQgJiYgc2lua190cHM0KSB7
CiAJCXJldHVybiBEUF9UUkFJTklOR19QQVRURVJOXzQ7Ci0JfSBlbHNlIGlmIChpbnRlbF9kcC0+
bGlua19yYXRlID09IDgxMDAwMCkgeworCX0gZWxzZSBpZiAoY3J0Y19zdGF0ZS0+cG9ydF9jbG9j
ayA9PSA4MTAwMDApIHsKIAkJaWYgKCFzb3VyY2VfdHBzNCkKIAkJCWRybV9kYmdfa21zKCZkcF90
b19pOTE1KGludGVsX2RwKS0+ZHJtLAogCQkJCSAgICAiOC4xIEdicHMgbGluayByYXRlIHdpdGhv
dXQgc291cmNlIEhCUjMvVFBTNCBzdXBwb3J0XG4iKTsKQEAgLTI5Nyw3ICszMDYsNyBAQCBzdGF0
aWMgdTMyIGludGVsX2RwX3RyYWluaW5nX3BhdHRlcm4oc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIAlzaW5rX3RwczMgPSBkcm1fZHBfdHBzM19zdXBwb3J0ZWQoaW50ZWxfZHAtPmRwY2QpOwog
CWlmIChzb3VyY2VfdHBzMyAmJiBzaW5rX3RwczMpIHsKIAkJcmV0dXJuICBEUF9UUkFJTklOR19Q
QVRURVJOXzM7Ci0JfSBlbHNlIGlmIChpbnRlbF9kcC0+bGlua19yYXRlID49IDU0MDAwMCkgewor
CX0gZWxzZSBpZiAoY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayA+PSA1NDAwMDApIHsKIAkJaWYgKCFz
b3VyY2VfdHBzMykKIAkJCWRybV9kYmdfa21zKCZkcF90b19pOTE1KGludGVsX2RwKS0+ZHJtLAog
CQkJCSAgICAiPj01LjQvNi40OCBHYnBzIGxpbmsgcmF0ZSB3aXRob3V0IHNvdXJjZSBIQlIyL1RQ
UzMgc3VwcG9ydFxuIik7CkBAIC0zMTAsNyArMzE5LDggQEAgc3RhdGljIHUzMiBpbnRlbF9kcF90
cmFpbmluZ19wYXR0ZXJuKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB9CiAKIHN0YXRpYyBi
b29sCi1pbnRlbF9kcF9saW5rX3RyYWluaW5nX2NoYW5uZWxfZXF1YWxpemF0aW9uKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCitpbnRlbF9kcF9saW5rX3RyYWluaW5nX2NoYW5uZWxfZXF1YWxp
emF0aW9uKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJCSAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWludCB0cmllczsKQEAgLTMxOCwxMyAr
MzI4LDEzIEBAIGludGVsX2RwX2xpbmtfdHJhaW5pbmdfY2hhbm5lbF9lcXVhbGl6YXRpb24oc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIAl1OCBsaW5rX3N0YXR1c1tEUF9MSU5LX1NUQVRVU19T
SVpFXTsKIAlib29sIGNoYW5uZWxfZXEgPSBmYWxzZTsKIAotCXRyYWluaW5nX3BhdHRlcm4gPSBp
bnRlbF9kcF90cmFpbmluZ19wYXR0ZXJuKGludGVsX2RwKTsKKwl0cmFpbmluZ19wYXR0ZXJuID0g
aW50ZWxfZHBfdHJhaW5pbmdfcGF0dGVybihpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAJLyogU2Ny
YW1ibGluZyBpcyBkaXNhYmxlZCBmb3IgVFBTMi8zIGFuZCBlbmFibGVkIGZvciBUUFM0ICovCiAJ
aWYgKHRyYWluaW5nX3BhdHRlcm4gIT0gRFBfVFJBSU5JTkdfUEFUVEVSTl80KQogCQl0cmFpbmlu
Z19wYXR0ZXJuIHw9IERQX0xJTktfU0NSQU1CTElOR19ESVNBQkxFOwogCiAJLyogY2hhbm5lbCBl
cXVhbGl6YXRpb24gKi8KLQlpZiAoIWludGVsX2RwX3NldF9saW5rX3RyYWluKGludGVsX2RwLAor
CWlmICghaW50ZWxfZHBfc2V0X2xpbmtfdHJhaW4oaW50ZWxfZHAsIGNydGNfc3RhdGUsCiAJCQkJ
ICAgICB0cmFpbmluZ19wYXR0ZXJuKSkgewogCQlkcm1fZXJyKCZpOTE1LT5kcm0sICJmYWlsZWQg
dG8gc3RhcnQgY2hhbm5lbCBlcXVhbGl6YXRpb25cbiIpOwogCQlyZXR1cm4gZmFsc2U7CkBAIC0z
NDEsNyArMzUxLDcgQEAgaW50ZWxfZHBfbGlua190cmFpbmluZ19jaGFubmVsX2VxdWFsaXphdGlv
bihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCiAJCS8qIE1ha2Ugc3VyZSBjbG9jayBpcyBz
dGlsbCBvayAqLwogCQlpZiAoIWRybV9kcF9jbG9ja19yZWNvdmVyeV9vayhsaW5rX3N0YXR1cywK
LQkJCQkJICAgICAgaW50ZWxfZHAtPmxhbmVfY291bnQpKSB7CisJCQkJCSAgICAgIGNydGNfc3Rh
dGUtPmxhbmVfY291bnQpKSB7CiAJCQlpbnRlbF9kcF9kdW1wX2xpbmtfc3RhdHVzKGxpbmtfc3Rh
dHVzKTsKIAkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkJICAgICJDbG9jayByZWNvdmVy
eSBjaGVjayBmYWlsZWQsIGNhbm5vdCAiCkBAIC0zNTAsNyArMzYwLDcgQEAgaW50ZWxfZHBfbGlu
a190cmFpbmluZ19jaGFubmVsX2VxdWFsaXphdGlvbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogCQl9CiAKIAkJaWYgKGRybV9kcF9jaGFubmVsX2VxX29rKGxpbmtfc3RhdHVzLAotCQkJCQkg
aW50ZWxfZHAtPmxhbmVfY291bnQpKSB7CisJCQkJCSBjcnRjX3N0YXRlLT5sYW5lX2NvdW50KSkg
ewogCQkJY2hhbm5lbF9lcSA9IHRydWU7CiAJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiQ2hh
bm5lbCBFUSBkb25lLiBEUCBUcmFpbmluZyAiCiAJCQkJICAgICJzdWNjZXNzZnVsXG4iKTsKQEAg
LTM1OCw4ICszNjgsOCBAQCBpbnRlbF9kcF9saW5rX3RyYWluaW5nX2NoYW5uZWxfZXF1YWxpemF0
aW9uKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCX0KIAogCQkvKiBVcGRhdGUgdHJhaW5p
bmcgc2V0IGFzIHJlcXVlc3RlZCBieSB0YXJnZXQgKi8KLQkJaW50ZWxfZHBfZ2V0X2FkanVzdF90
cmFpbihpbnRlbF9kcCwgbGlua19zdGF0dXMpOwotCQlpZiAoIWludGVsX2RwX3VwZGF0ZV9saW5r
X3RyYWluKGludGVsX2RwKSkgeworCQlpbnRlbF9kcF9nZXRfYWRqdXN0X3RyYWluKGludGVsX2Rw
LCBjcnRjX3N0YXRlLCBsaW5rX3N0YXR1cyk7CisJCWlmICghaW50ZWxfZHBfdXBkYXRlX2xpbmtf
dHJhaW4oaW50ZWxfZHAsIGNydGNfc3RhdGUpKSB7CiAJCQlkcm1fZXJyKCZpOTE1LT5kcm0sCiAJ
CQkJImZhaWxlZCB0byB1cGRhdGUgbGluayB0cmFpbmluZ1xuIik7CiAJCQlicmVhazsKQEAgLTM3
MywzNSArMzgzLDM3IEBAIGludGVsX2RwX2xpbmtfdHJhaW5pbmdfY2hhbm5lbF9lcXVhbGl6YXRp
b24oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJCSAgICAiQ2hhbm5lbCBlcXVhbGl6YXRp
b24gZmFpbGVkIDUgdGltZXNcbiIpOwogCX0KIAotCWludGVsX2RwX3NldF9pZGxlX2xpbmtfdHJh
aW4oaW50ZWxfZHApOworCWludGVsX2RwX3NldF9pZGxlX2xpbmtfdHJhaW4oaW50ZWxfZHAsIGNy
dGNfc3RhdGUpOwogCiAJcmV0dXJuIGNoYW5uZWxfZXE7CiAKIH0KIAotdm9pZCBpbnRlbF9kcF9z
dG9wX2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK3ZvaWQgaW50ZWxfZHBf
c3RvcF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkgICAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlpbnRlbF9kcC0+bGlu
a190cmFpbmVkID0gdHJ1ZTsKIAotCWludGVsX2RwX3NldF9saW5rX3RyYWluKGludGVsX2RwLAor
CWludGVsX2RwX3NldF9saW5rX3RyYWluKGludGVsX2RwLCBjcnRjX3N0YXRlLAogCQkJCURQX1RS
QUlOSU5HX1BBVFRFUk5fRElTQUJMRSk7CiB9CiAKIHZvaWQKLWludGVsX2RwX3N0YXJ0X2xpbmtf
dHJhaW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK2ludGVsX2RwX3N0YXJ0X2xpbmtfdHJh
aW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxf
Y29ubmVjdG9yID0gaW50ZWxfZHAtPmF0dGFjaGVkX2Nvbm5lY3RvcjsKIAotCWlmICghaW50ZWxf
ZHBfbGlua190cmFpbmluZ19jbG9ja19yZWNvdmVyeShpbnRlbF9kcCkpCisJaWYgKCFpbnRlbF9k
cF9saW5rX3RyYWluaW5nX2Nsb2NrX3JlY292ZXJ5KGludGVsX2RwLCBjcnRjX3N0YXRlKSkKIAkJ
Z290byBmYWlsdXJlX2hhbmRsaW5nOwotCWlmICghaW50ZWxfZHBfbGlua190cmFpbmluZ19jaGFu
bmVsX2VxdWFsaXphdGlvbihpbnRlbF9kcCkpCisJaWYgKCFpbnRlbF9kcF9saW5rX3RyYWluaW5n
X2NoYW5uZWxfZXF1YWxpemF0aW9uKGludGVsX2RwLCBjcnRjX3N0YXRlKSkKIAkJZ290byBmYWls
dXJlX2hhbmRsaW5nOwogCiAJZHJtX2RiZ19rbXMoJmRwX3RvX2k5MTUoaW50ZWxfZHApLT5kcm0s
CiAJCSAgICAiW0NPTk5FQ1RPUjolZDolc10gTGluayBUcmFpbmluZyBQYXNzZWQgYXQgTGluayBS
YXRlID0gJWQsIExhbmUgY291bnQgPSAlZCIsCiAJCSAgICBpbnRlbF9jb25uZWN0b3ItPmJhc2Uu
YmFzZS5pZCwKIAkJICAgIGludGVsX2Nvbm5lY3Rvci0+YmFzZS5uYW1lLAotCQkgICAgaW50ZWxf
ZHAtPmxpbmtfcmF0ZSwgaW50ZWxfZHAtPmxhbmVfY291bnQpOworCQkgICAgY3J0Y19zdGF0ZS0+
cG9ydF9jbG9jaywgY3J0Y19zdGF0ZS0+bGFuZV9jb3VudCk7CiAJcmV0dXJuOwogCiAgZmFpbHVy
ZV9oYW5kbGluZzoKQEAgLTQwOSwxNSArNDIxLDE1IEBAIGludGVsX2RwX3N0YXJ0X2xpbmtfdHJh
aW4oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJICAgICJbQ09OTkVDVE9SOiVkOiVzXSBM
aW5rIFRyYWluaW5nIGZhaWxlZCBhdCBsaW5rIHJhdGUgPSAlZCwgbGFuZSBjb3VudCA9ICVkIiwK
IAkJICAgIGludGVsX2Nvbm5lY3Rvci0+YmFzZS5iYXNlLmlkLAogCQkgICAgaW50ZWxfY29ubmVj
dG9yLT5iYXNlLm5hbWUsCi0JCSAgICBpbnRlbF9kcC0+bGlua19yYXRlLCBpbnRlbF9kcC0+bGFu
ZV9jb3VudCk7CisJCSAgICBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLCBjcnRjX3N0YXRlLT5sYW5l
X2NvdW50KTsKIAogCWlmIChpbnRlbF9kcC0+aG9ibF9hY3RpdmUpIHsKIAkJZHJtX2RiZ19rbXMo
JmRwX3RvX2k5MTUoaW50ZWxfZHApLT5kcm0sCiAJCQkgICAgIkxpbmsgVHJhaW5pbmcgZmFpbGVk
IHdpdGggSE9CTCBhY3RpdmUsIG5vdCBlbmFibGluZyBpdCBmcm9tIG5vdyBvbiIpOwogCQlpbnRl
bF9kcC0+aG9ibF9mYWlsZWQgPSB0cnVlOwogCX0gZWxzZSBpZiAoaW50ZWxfZHBfZ2V0X2xpbmtf
dHJhaW5fZmFsbGJhY2tfdmFsdWVzKGludGVsX2RwLAotCQkJCQkJCSAgIGludGVsX2RwLT5saW5r
X3JhdGUsCi0JCQkJCQkJICAgaW50ZWxfZHAtPmxhbmVfY291bnQpKSB7CisJCQkJCQkJICAgY3J0
Y19zdGF0ZS0+cG9ydF9jbG9jaywKKwkJCQkJCQkgICBjcnRjX3N0YXRlLT5sYW5lX2NvdW50KSkg
ewogCQlyZXR1cm47CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RwX2xpbmtfdHJhaW5pbmcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHBfbGlua190cmFpbmluZy5oCmluZGV4IDAxZjFkYWJiYjA2MC4uNjQ4YTZkMWY5
ZmEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2xp
bmtfdHJhaW5pbmcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
X2xpbmtfdHJhaW5pbmcuaApAQCAtOCwxMSArOCwxNSBAQAogCiAjaW5jbHVkZSA8ZHJtL2RybV9k
cF9oZWxwZXIuaD4KIAorc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfZHA7
CiAKIHZvaWQgaW50ZWxfZHBfZ2V0X2FkanVzdF90cmFpbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQkJICAgICAgIGNvbnN0IHU4IGxpbmtfc3RhdHVzW0RQX0xJTktfU1RBVFVTX1NJWkVdKTsK
LXZvaWQgaW50ZWxfZHBfc3RhcnRfbGlua190cmFpbihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KTsKLXZvaWQgaW50ZWxfZHBfc3RvcF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApOwordm9pZCBpbnRlbF9kcF9zdGFydF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCisJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpOwordm9pZCBpbnRlbF9kcF9zdG9wX2xpbmtfdHJhaW4oc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KTsKIAogI2VuZGlmIC8qIF9fSU5URUxfRFBfTElOS19UUkFJTklOR19IX18gKi8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBpb19waHkuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBpb19waHkuYwppbmRleCA3OTEwNTIyMjcz
YjIuLjUxNGM0YTdhZGZmYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kcGlvX3BoeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHBpb19waHkuYwpAQCAtNjQ0LDE2ICs2NDQsMTYgQEAgYnh0X2RkaV9waHlfZ2V0X2xhbmVf
bGF0X29wdGltX21hc2soc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJcmV0dXJuIG1h
c2s7CiB9CiAKLQogdm9pZCBjaHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCisJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAkJCSAgICAgIHUzMiBkZWVtcGhfcmVnX3ZhbHVlLCB1MzIgbWFyZ2luX3Jl
Z192YWx1ZSwKIAkJCSAgICAgIGJvb2wgdW5pcV90cmFuc19zY2FsZSkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlz
dHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGVuY190b19kaWdfcG9ydChlbmNv
ZGVyKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoZW5j
b2Rlci0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIGRwaW9fY2hhbm5lbCBjaCA9IHZsdl9k
aWdfcG9ydF90b19jaGFubmVsKGRpZ19wb3J0KTsKLQllbnVtIHBpcGUgcGlwZSA9IGludGVsX2Ny
dGMtPnBpcGU7CisJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiB2YWw7CiAJaW50
IGk7CiAKQEAgLTY2Niw3ICs2NjYsNyBAQCB2b2lkIGNodl9zZXRfcGh5X3NpZ25hbF9sZXZlbChz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAl2YWwgfD0gRFBJT19QQ1NfVFgxREVFTVBf
OVA1IHwgRFBJT19QQ1NfVFgyREVFTVBfOVA1OwogCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBw
aXBlLCBWTFZfUENTMDFfRFcxMChjaCksIHZhbCk7CiAKLQlpZiAoaW50ZWxfY3J0Yy0+Y29uZmln
LT5sYW5lX2NvdW50ID4gMikgeworCWlmIChjcnRjX3N0YXRlLT5sYW5lX2NvdW50ID4gMikgewog
CQl2YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUENTMjNfRFcxMChjaCkp
OwogCQl2YWwgJj0gfihEUElPX1BDU19TV0lOR19DQUxDX1RYMF9UWDIgfCBEUElPX1BDU19TV0lO
R19DQUxDX1RYMV9UWDMpOwogCQl2YWwgJj0gfihEUElPX1BDU19UWDFERUVNUF9NQVNLIHwgRFBJ
T19QQ1NfVFgyREVFTVBfTUFTSyk7CkBAIC02NzksNyArNjc5LDcgQEAgdm9pZCBjaHZfc2V0X3Bo
eV9zaWduYWxfbGV2ZWwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJdmFsIHw9IERQ
SU9fUENTX1RYMU1BUkdJTl8wMDAgfCBEUElPX1BDU19UWDJNQVJHSU5fMDAwOwogCXZsdl9kcGlv
X3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUENTMDFfRFc5KGNoKSwgdmFsKTsKIAotCWlmIChp
bnRlbF9jcnRjLT5jb25maWctPmxhbmVfY291bnQgPiAyKSB7CisJaWYgKGNydGNfc3RhdGUtPmxh
bmVfY291bnQgPiAyKSB7CiAJCXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZM
Vl9QQ1MyM19EVzkoY2gpKTsKIAkJdmFsICY9IH4oRFBJT19QQ1NfVFgxTUFSR0lOX01BU0sgfCBE
UElPX1BDU19UWDJNQVJHSU5fTUFTSyk7CiAJCXZhbCB8PSBEUElPX1BDU19UWDFNQVJHSU5fMDAw
IHwgRFBJT19QQ1NfVFgyTUFSR0lOXzAwMDsKQEAgLTY4Nyw3ICs2ODcsNyBAQCB2b2lkIGNodl9z
ZXRfcGh5X3NpZ25hbF9sZXZlbChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAl9CiAK
IAkvKiBQcm9ncmFtIHN3aW5nIGRlZW1waCAqLwotCWZvciAoaSA9IDA7IGkgPCBpbnRlbF9jcnRj
LT5jb25maWctPmxhbmVfY291bnQ7IGkrKykgeworCWZvciAoaSA9IDA7IGkgPCBjcnRjX3N0YXRl
LT5sYW5lX2NvdW50OyBpKyspIHsKIAkJdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlw
ZSwgQ0hWX1RYX0RXNChjaCwgaSkpOwogCQl2YWwgJj0gfkRQSU9fU1dJTkdfREVFTVBIOVA1X01B
U0s7CiAJCXZhbCB8PSBkZWVtcGhfcmVnX3ZhbHVlIDw8IERQSU9fU1dJTkdfREVFTVBIOVA1X1NI
SUZUOwpAQCAtNjk1LDcgKzY5NSw3IEBAIHZvaWQgY2h2X3NldF9waHlfc2lnbmFsX2xldmVsKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCX0KIAogCS8qIFByb2dyYW0gc3dpbmcgbWFy
Z2luICovCi0JZm9yIChpID0gMDsgaSA8IGludGVsX2NydGMtPmNvbmZpZy0+bGFuZV9jb3VudDsg
aSsrKSB7CisJZm9yIChpID0gMDsgaSA8IGNydGNfc3RhdGUtPmxhbmVfY291bnQ7IGkrKykgewog
CQl2YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBDSFZfVFhfRFcyKGNoLCBpKSk7
CiAKIAkJdmFsICY9IH5EUElPX1NXSU5HX01BUkdJTjAwMF9NQVNLOwpAQCAtNzE4LDcgKzcxOCw3
IEBAIHZvaWQgY2h2X3NldF9waHlfc2lnbmFsX2xldmVsKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCSAqIEZvciBub3csIGZvciB0aGlzIHVuaXF1ZSB0cmFuc2l0aW9uIHNjYWxlIHNl
bGVjdGlvbiwgc2V0IGJpdAogCSAqIDI3IGZvciBjaDAgYW5kIGNoMS4KIAkgKi8KLQlmb3IgKGkg
PSAwOyBpIDwgaW50ZWxfY3J0Yy0+Y29uZmlnLT5sYW5lX2NvdW50OyBpKyspIHsKKwlmb3IgKGkg
PSAwOyBpIDwgY3J0Y19zdGF0ZS0+bGFuZV9jb3VudDsgaSsrKSB7CiAJCXZhbCA9IHZsdl9kcGlv
X3JlYWQoZGV2X3ByaXYsIHBpcGUsIENIVl9UWF9EVzMoY2gsIGkpKTsKIAkJaWYgKHVuaXFfdHJh
bnNfc2NhbGUpCiAJCQl2YWwgfD0gRFBJT19UWF9VTklRX1RSQU5TX1NDQUxFX0VOOwpAQCAtNzMy
LDcgKzczMiw3IEBAIHZvaWQgY2h2X3NldF9waHlfc2lnbmFsX2xldmVsKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCXZhbCB8PSBEUElPX1BDU19TV0lOR19DQUxDX1RYMF9UWDIgfCBE
UElPX1BDU19TV0lOR19DQUxDX1RYMV9UWDM7CiAJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBp
cGUsIFZMVl9QQ1MwMV9EVzEwKGNoKSwgdmFsKTsKIAotCWlmIChpbnRlbF9jcnRjLT5jb25maWct
PmxhbmVfY291bnQgPiAyKSB7CisJaWYgKGNydGNfc3RhdGUtPmxhbmVfY291bnQgPiAyKSB7CiAJ
CXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9QQ1MyM19EVzEwKGNoKSk7
CiAJCXZhbCB8PSBEUElPX1BDU19TV0lOR19DQUxDX1RYMF9UWDIgfCBEUElPX1BDU19TV0lOR19D
QUxDX1RYMV9UWDM7CiAJCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUENTMjNf
RFcxMChjaCksIHZhbCk7CkBAIC05OTIsMTQgKzk5MiwxNSBAQCB2b2lkIGNodl9waHlfcG9zdF9w
bGxfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIH0KIAogdm9pZCB2bHZf
c2V0X3BoeV9zaWduYWxfbGV2ZWwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAg
IHUzMiBkZW1waF9yZWdfdmFsdWUsIHUzMiBwcmVlbXBoX3JlZ192YWx1ZSwKIAkJCSAgICAgIHUz
MiB1bmlxdHJhbnNjYWxlX3JlZ192YWx1ZSwgdTMyIHR4M19kZW1waCkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoZW5jb2Rlci0+YmFz
ZS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGVuY190b19k
aWdfcG9ydChlbmNvZGVyKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIGRwaW9fY2hhbm5lbCBwb3J0ID0gdmx2
X2RpZ19wb3J0X3RvX2NoYW5uZWwoZGlnX3BvcnQpOwotCWVudW0gcGlwZSBwaXBlID0gaW50ZWxf
Y3J0Yy0+cGlwZTsKKwllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKIAl2bHZfZHBpb19n
ZXQoZGV2X3ByaXYpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2RwaW9fcGh5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
aW9fcGh5LmgKaW5kZXggZjQxOGFhYjkwYjdlLi42NDczNDQwZTc0NTcgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBpb19waHkuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmgKQEAgLTMyLDYgKzMyLDcgQEAg
dm9pZCBieHRfZGRpX3BoeV9zZXRfbGFuZV9vcHRpbV9tYXNrKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogdTggYnh0X2RkaV9waHlfZ2V0X2xhbmVfbGF0X29wdGltX21hc2soc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIpOwogCiB2b2lkIGNodl9zZXRfcGh5X3NpZ25hbF9sZXZl
bChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgdTMyIGRlZW1waF9yZWdfdmFs
dWUsIHUzMiBtYXJnaW5fcmVnX3ZhbHVlLAogCQkJICAgICAgYm9vbCB1bmlxX3RyYW5zX3NjYWxl
KTsKIHZvaWQgY2h2X2RhdGFfbGFuZV9zb2Z0X3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLApAQCAtNDYsNiArNDcsNyBAQCB2b2lkIGNodl9waHlfcG9zdF9wbGxfZGlzYWJsZShz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSk7CiAKIHZvaWQgdmx2X3NldF9waHlfc2lnbmFs
X2xldmVsKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJICAgICAgY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgICB1MzIgZGVtcGhfcmVn
X3ZhbHVlLCB1MzIgcHJlZW1waF9yZWdfdmFsdWUsCiAJCQkgICAgICB1MzIgdW5pcXRyYW5zY2Fs
ZV9yZWdfdmFsdWUsIHUzMiB0eDNfZGVtcGgpOwogdm9pZCB2bHZfcGh5X3ByZV9wbGxfZW5hYmxl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2hkbWkuYwppbmRleCAzZjIwMDhkODQ1YzIuLjQxNGE0NmE2YjVmMyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMKQEAgLTI3NzUsOCArMjc3NSw5
IEBAIHN0YXRpYyB2b2lkIHZsdl9oZG1pX3ByZV9lbmFibGUoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUsCiAJdmx2X3BoeV9wcmVfZW5jb2Rlcl9lbmFibGUoZW5jb2RlciwgcGlwZV9j
b25maWcpOwogCiAJLyogSERNSSAxLjBWLTJkQiAqLwotCXZsdl9zZXRfcGh5X3NpZ25hbF9sZXZl
bChlbmNvZGVyLCAweDJiMjQ1ZjVmLCAweDAwMDAyMDAwLCAweDU1NzhiODNhLAotCQkJCSAweDJi
MjQ3ODc4KTsKKwl2bHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoZW5jb2RlciwgcGlwZV9jb25maWcs
CisJCQkJIDB4MmIyNDVmNWYsIDB4MDAwMDIwMDAsCisJCQkJIDB4NTU3OGI4M2EsIDB4MmIyNDc4
NzgpOwogCiAJZGlnX3BvcnQtPnNldF9pbmZvZnJhbWVzKGVuY29kZXIsCiAJCQkgICAgICBwaXBl
X2NvbmZpZy0+aGFzX2luZm9mcmFtZSwKQEAgLTI4NTMsNyArMjg1NCw3IEBAIHN0YXRpYyB2b2lk
IGNodl9oZG1pX3ByZV9lbmFibGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAK
IAkvKiBGSVhNRTogUHJvZ3JhbSB0aGUgc3VwcG9ydCB4eHggVi1kQiAqLwogCS8qIFVzZSA4MDBt
Vi0wZEIgKi8KLQljaHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoZW5jb2RlciwgMTI4LCAxMDIsIGZh
bHNlKTsKKwljaHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoZW5jb2RlciwgcGlwZV9jb25maWcsIDEy
OCwgMTAyLCBmYWxzZSk7CiAKIAlkaWdfcG9ydC0+c2V0X2luZm9mcmFtZXMoZW5jb2RlciwKIAkJ
CSAgICAgIHBpcGVfY29uZmlnLT5oYXNfaW5mb2ZyYW1lLAotLSAKMi4yNi4yCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

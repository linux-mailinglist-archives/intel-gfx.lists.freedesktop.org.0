Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7700DBE926
	for <lists+intel-gfx@lfdr.de>; Thu, 26 Sep 2019 01:45:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D36796EECA;
	Wed, 25 Sep 2019 23:45:23 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 367DE6EEC9
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 23:45:12 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Sep 2019 16:45:10 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,549,1559545200"; d="scan'208";a="201422306"
Received: from josouza-mobl.jf.intel.com ([10.7.200.160])
 by orsmga002.jf.intel.com with ESMTP; 25 Sep 2019 16:45:10 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 16:45:07 -0700
Message-Id: <20190925234509.29505-3-jose.souza@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190925234509.29505-1-jose.souza@intel.com>
References: <20190925234509.29505-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 2/4] drm/i915/tgl: Add dkl phy programming
 sequences
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogQ2xpbnRvbiBBIFRheWxvciA8Y2xpbnRvbi5hLnRheWxvckBpbnRlbC5jb20+CgpBZGRl
ZCBES0wgUGh5IHNlcXVlbmNlcyBhbmQgaGVscGVycyBmdW5jdGlvbnMgdG8gcHJvZ3JhbSB2b2x0
YWdlCnN3aW5nLCBjbG9jayBnYXRpbmcgYW5kIGRwIG1vZGUuCgpJdCBpcyBub3Qgd3JpdHRlbiBp
biBEUCBlbmFibGluZyBzZXF1ZW5jZSBidXQgIlBIWSBDbG9ja2dhdGluZwpwcm9ncmFtbWluZyIg
c3RhdGVzIHRoYXQgY2xvY2sgZ2F0aW5nIHNob3VsZCBiZSBlbmFibGVkIGFmdGVyIHRoZQpsaW5r
IHRyYWluaW5nIGJ1dCBkb2luZyBzbyBjYXVzZXMgYWxsIHRoZSBmb2xsb3dpbmcgdHJhaW5pbmdz
IHRvIGZhaWwKc28gbm90IGVuYWJsaW5nIGl0IGZvci4KCnYyOgpTZXR0aW5nIHRoZSByaWdodCBI
SVBfSU5ERVhfUkVHIGJpdHMgKEpvc8OpKQoKdjM6CkFkZGluZyB0aGUgbWVhbmluZyBvZiBlYWNo
IGNvbHVtbiBvZiB0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zCkFkZGluZyBpZiBnZW4gPj0g
MTIgb24gaW50ZWxfZGRpX2hkbWlfbGV2ZWwoKSBhbmQKaW50ZWxfZGRpX3ByZV9lbmFibGVfaGRt
aSgpIGluc3RlYWQgb2YgcmV1c2UgcGFydCBvZiBnZW4gPj0gMTEgaWYKCnY0OgpNb3ZlZCB0aGUg
RFBfTU9ERSBsYW5lIHByb2dyYW1pbmcgdG8gYW5vdGhlciBwYXRjaCBhcyBJQ0wgYWxzbwpuZWVk
ZWQgaXQKU2hhcmluZyBpY2xfcGh5X3NldF9jbG9ja19nYXRpbmcoKSBhbmQgaWNsX3Byb2dyYW1f
bWdfZHBfbW9kZSgpIHdpdGgKVEdMIGFzIGJpdHMgYW5kIHByb2dyYW1pbmcgYXMgbm93IGl0IGFs
bW9zdCBpZGVudGljYWwgdG8gSUNMCgpCU3BlYzogNDkyOTIKQlNwZWM6IDQ5MTkwCgpDYzogSW1y
ZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29tPgpDYzogTHVjYXMgRGUgTWFyY2hpIDxsdWNhcy5k
ZW1hcmNoaUBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEg
PGpvc2Uuc291emFAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBDbGludG9uIEEgVGF5bG9yIDxj
bGludG9uLmEudGF5bG9yQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RkaS5jIHwgMTc1ICsrKysrKysrKysrKysrKysrKysrLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlZy5oICAgICAgICAgIHwgICA4IC0tCiAyIGZpbGVzIGNoYW5nZWQs
IDE1NSBpbnNlcnRpb25zKCspLCAyOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kZGkuYwppbmRleCAzMTZjZWRiMTY5MzUuLjRkYTc5NDBmMWZjZiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBAIC01ODYsNiArNTg2LDI2
IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaWNsX21nX3BoeV9kZGlfYnVmX3RyYW5zIGljbF9tZ19w
aHlfZGRpX3RyYW5zbGF0aW9uc1tdID0gewogCXsgMHgwLCAweDAwLCAweDAwIH0sCS8qIDMgICAg
ICAgICAgICAgIDAgICAqLwogfTsKIAorc3RydWN0IHRnbF9ka2xfcGh5X2RkaV9idWZfdHJhbnMg
eworCXUzMiBka2xfdnN3aW5nX2NvbnRyb2w7CisJdTMyIGRrbF9wcmVzaG9vdF9jb250cm9sOwor
CXUzMiBka2xfZGVfZW1waGFzaXNfY29udHJvbDsKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
dGdsX2RrbF9waHlfZGRpX2J1Zl90cmFucyB0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zW10g
PSB7CisJCQkJLyogVlMJcHJlLWVtcAlOb24tdHJhbnMgbVYJUHJlLWVtcGggZEIgKi8KKwl7IDB4
NywgMHgwLCAweDAwIH0sCS8qIDAJMAk0MDBtVgkJMCBkQiAqLworCXsgMHg1LCAweDAsIDB4MDMg
fSwJLyogMAkxCTQwMG1WCQkzLjUgZEIgKi8KKwl7IDB4MiwgMHgwLCAweDBiIH0sCS8qIDAJMgk0
MDBtVgkJNiBkQiAqLworCXsgMHgwLCAweDAsIDB4MTkgfSwJLyogMAkzCTQwMG1WCQk5LjUgZEIg
Ki8KKwl7IDB4NSwgMHgwLCAweDAwIH0sCS8qIDEJMAk2MDBtVgkJMCBkQiAqLworCXsgMHgyLCAw
eDAsIDB4MDMgfSwJLyogMQkxCTYwMG1WCQkzLjUgZEIgKi8KKwl7IDB4MCwgMHgwLCAweDE0IH0s
CS8qIDEJMgk2MDBtVgkJNiBkQiAqLworCXsgMHgyLCAweDAsIDB4MDAgfSwJLyogMgkwCTgwMG1W
CQkwIGRCICovCisJeyAweDAsIDB4MCwgMHgwQiB9LAkvKiAyCTEJODAwbVYJCTMuNSBkQiAqLwor
CXsgMHgwLCAweDAsIDB4MDAgfSwJLyogMwkwCTEyMDBtVgkJMCBkQiBIRE1JIGRlZmF1bHQgKi8K
K307CisKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZGRpX2J1Zl90cmFucyAqCiBiZHdfZ2V0X2J1Zl90
cmFuc19lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgKm5fZW50cmll
cykKIHsKQEAgLTg3Miw3ICs4OTIsMTQgQEAgc3RhdGljIGludCBpbnRlbF9kZGlfaGRtaV9sZXZl
bChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3IKIAogCWxl
dmVsID0gZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdLmhkbWlfbGV2ZWxfc2hpZnQ7
CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgeworCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEyKSB7CisJCWlmIChpbnRlbF9waHlfaXNfY29tYm8oZGV2X3ByaXYsIHBoeSkp
CisJCQlpY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhkZXZfcHJpdiwgSU5URUxfT1VUUFVUX0hETUks
CisJCQkJCQkwLCAmbl9lbnRyaWVzKTsKKwkJZWxzZQorCQkJbl9lbnRyaWVzID0gQVJSQVlfU0la
RSh0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zKTsKKwkJZGVmYXVsdF9lbnRyeSA9IG5fZW50
cmllcyAtIDE7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDExKSB7CiAJCWlm
IChpbnRlbF9waHlfaXNfY29tYm8oZGV2X3ByaXYsIHBoeSkpCiAJCQlpY2xfZ2V0X2NvbWJvX2J1
Zl90cmFucyhkZXZfcHJpdiwgSU5URUxfT1VUUFVUX0hETUksCiAJCQkJCQkwLCAmbl9lbnRyaWVz
KTsKQEAgLTIzMzQsNyArMjM2MSwxMyBAQCB1OCBpbnRlbF9kZGlfZHBfdm9sdGFnZV9tYXgoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJZW51bSBwaHkgcGh5ID0gaW50ZWxfcG9ydF90
b19waHkoZGV2X3ByaXYsIHBvcnQpOwogCWludCBuX2VudHJpZXM7CiAKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMSkgeworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CisJ
CWlmIChpbnRlbF9waHlfaXNfY29tYm8oZGV2X3ByaXYsIHBoeSkpCisJCQlpY2xfZ2V0X2NvbWJv
X2J1Zl90cmFucyhkZXZfcHJpdiwgZW5jb2Rlci0+dHlwZSwKKwkJCQkJCWludGVsX2RwLT5saW5r
X3JhdGUsICZuX2VudHJpZXMpOworCQllbHNlCisJCQluX2VudHJpZXMgPSBBUlJBWV9TSVpFKHRn
bF9ka2xfcGh5X2RkaV90cmFuc2xhdGlvbnMpOworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA9PSAxMSkgewogCQlpZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQog
CQkJaWNsX2dldF9jb21ib19idWZfdHJhbnMoZGV2X3ByaXYsIGVuY29kZXItPnR5cGUsCiAJCQkJ
CQlpbnRlbF9kcC0+bGlua19yYXRlLCAmbl9lbnRyaWVzKTsKQEAgLTI3NzYsNiArMjgwOSw2MyBA
QCBzdGF0aWMgdm9pZCBpY2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAkJaWNsX21nX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxp
bmtfY2xvY2ssIGxldmVsKTsKIH0KIAorc3RhdGljIHZvaWQKK3RnbF9ka2xfcGh5X2RkaV92c3dp
bmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsIGludCBsaW5rX2Nsb2Nr
LAorCQkJCXUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGlu
dGVsX3BvcnRfdG9fdGMoZGV2X3ByaXYsIGVuY29kZXItPnBvcnQpOworCWNvbnN0IHN0cnVjdCB0
Z2xfZGtsX3BoeV9kZGlfYnVmX3RyYW5zICpkZGlfdHJhbnNsYXRpb25zOworCXUzMiBuX2VudHJp
ZXMsIHZhbCwgbG47CisKKwluX2VudHJpZXMgPSBBUlJBWV9TSVpFKHRnbF9ka2xfcGh5X2RkaV90
cmFuc2xhdGlvbnMpOworCWRkaV90cmFuc2xhdGlvbnMgPSB0Z2xfZGtsX3BoeV9kZGlfdHJhbnNs
YXRpb25zOworCisJaWYgKGxldmVsID49IG5fZW50cmllcykKKwkJbGV2ZWwgPSBuX2VudHJpZXMg
LSAxOworCisJZm9yIChsbiA9IDA7IGxuIDwgMjsgbG4rKykgeworCQlJOTE1X1dSSVRFKEhJUF9J
TkRFWF9SRUcodGNfcG9ydCksIEhJUF9JTkRFWF9WQUwodGNfcG9ydCwgbG4pKTsKKworCQkvKiBB
bGwgdGhlIHJlZ2lzdGVycyBhcmUgUk1XICovCisJCXZhbCA9IEk5MTVfUkVBRChES0xfVFhfRFBD
TlRMMCh0Y19wb3J0KSk7CisJCXZhbCAmPSB+KERLTF9UWF9QUkVTSE9PVF9DT0VGRl9NQVNLIHwK
KwkJCSBES0xfVFhfREVfRU1QQUhTSVNfQ09FRkZfTUFTSyB8CisJCQkgREtMX1RYX1ZTV0lOR19D
T05UUk9MX01BU0spOworCQl2YWwgfD0gREtMX1RYX1ZTV0lOR19DT05UUk9MKGRkaV90cmFuc2xh
dGlvbnNbbGV2ZWxdLmRrbF92c3dpbmdfY29udHJvbCk7CisJCXZhbCB8PSBES0xfVFhfREVfRU1Q
SEFTSVNfQ09FRkYoZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0uZGtsX2RlX2VtcGhhc2lzX2NvbnRy
b2wpOworCQl2YWwgfD0gREtMX1RYX1BSRVNIT09UX0NPRUZGKGRkaV90cmFuc2xhdGlvbnNbbGV2
ZWxdLmRrbF9wcmVzaG9vdF9jb250cm9sKTsKKwkJSTkxNV9XUklURShES0xfVFhfRFBDTlRMMCh0
Y19wb3J0KSwgdmFsKTsKKworCQl2YWwgPSBJOTE1X1JFQUQoREtMX1RYX0RQQ05UTDEodGNfcG9y
dCkpOworCQl2YWwgJj0gfihES0xfVFhfUFJFU0hPT1RfQ09FRkZfTUFTSyB8CisJCQkgREtMX1RY
X0RFX0VNUEFIU0lTX0NPRUZGX01BU0sgfAorCQkJIERLTF9UWF9WU1dJTkdfQ09OVFJPTF9NQVNL
KTsKKwkJdmFsIHw9IERLTF9UWF9WU1dJTkdfQ09OVFJPTChkZGlfdHJhbnNsYXRpb25zW2xldmVs
XS5ka2xfdnN3aW5nX2NvbnRyb2wpOworCQl2YWwgfD0gREtMX1RYX0RFX0VNUEhBU0lTX0NPRUZG
KGRkaV90cmFuc2xhdGlvbnNbbGV2ZWxdLmRrbF9kZV9lbXBoYXNpc19jb250cm9sKTsKKwkJdmFs
IHw9IERLTF9UWF9QUkVTSE9PVF9DT0VGRihkZGlfdHJhbnNsYXRpb25zW2xldmVsXS5ka2xfcHJl
c2hvb3RfY29udHJvbCk7CisJCUk5MTVfV1JJVEUoREtMX1RYX0RQQ05UTDEodGNfcG9ydCksIHZh
bCk7CisKKwkJdmFsID0gSTkxNV9SRUFEKERLTF9UWF9EUENOVEwyKHRjX3BvcnQpKTsKKwkJdmFs
ICY9IH5ES0xfVFhfRFAyMEJJVE1PREU7CisJCUk5MTVfV1JJVEUoREtMX1RYX0RQQ05UTDIodGNf
cG9ydCksIHZhbCk7CisJfQorfQorCitzdGF0aWMgdm9pZCB0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5j
ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgICAgaW50IGxpbmtfY2xvY2ss
CisJCQkJICAgIHUzMiBsZXZlbCwKKwkJCQkgICAgZW51bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBl
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOworCWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGRldl9wcml2
LCBlbmNvZGVyLT5wb3J0KTsKKworCWlmIChpbnRlbF9waHlfaXNfY29tYm8oZGV2X3ByaXYsIHBo
eSkpCisJCWljbF9jb21ib19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwg
dHlwZSk7CisJZWxzZQorCQl0Z2xfZGtsX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIs
IGxpbmtfY2xvY2ssIGxldmVsKTsKK30KKwogc3RhdGljIHUzMiB0cmFuc2xhdGVfc2lnbmFsX2xl
dmVsKGludCBzaWduYWxfbGV2ZWxzKQogewogCWludCBpOwpAQCAtMjgwNyw3ICsyODk3LDEwIEBA
IHUzMiBieHRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCXN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0gJmRwb3J0LT5iYXNlOwogCWludCBsZXZlbCA9IGlu
dGVsX2RkaV9kcF9sZXZlbChpbnRlbF9kcCk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMSkKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJdGdsX2RkaV92c3dpbmdf
c2VxdWVuY2UoZW5jb2RlciwgaW50ZWxfZHAtPmxpbmtfcmF0ZSwKKwkJCQkJbGV2ZWwsIGVuY29k
ZXItPnR5cGUpOworCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCiAJCWljbF9k
ZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGludGVsX2RwLT5saW5rX3JhdGUsCiAJCQkJCWxl
dmVsLCBlbmNvZGVyLT50eXBlKTsKIAllbHNlIGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSkK
QEAgLTMwNzEsMzggKzMxNjQsNjEgQEAgaWNsX3BoeV9zZXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBp
bnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0LCBib29sIGVuYWJsZSkKIAkgICAgICAgTUdfRFBf
TU9ERV9DRkdfR0FPTlBXUl9HQVRJTkc7CiAKIAlmb3IgKGxuID0gMDsgbG4gPCAyOyBsbisrKSB7
Ci0JCXZhbCA9IEk5MTVfUkVBRChNR19EUF9NT0RFKGxuLCBwb3J0KSk7CisJCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEyKSB7CisJCQlJOTE1X1dSSVRFKEhJUF9JTkRFWF9SRUcodGNfcG9y
dCksIEhJUF9JTkRFWF9WQUwodGNfcG9ydCwgbG4pKTsKKwkJCXZhbCA9IEk5MTVfUkVBRChES0xf
RFBfTU9ERSh0Y19wb3J0KSk7CisJCX0gZWxzZSB7CisJCQl2YWwgPSBJOTE1X1JFQUQoTUdfRFBf
TU9ERShsbiwgcG9ydCkpOworCQl9CisKIAkJaWYgKGVuYWJsZSkKIAkJCXZhbCB8PSBiaXRzOwog
CQllbHNlCiAJCQl2YWwgJj0gfmJpdHM7Ci0JCUk5MTVfV1JJVEUoTUdfRFBfTU9ERShsbiwgcG9y
dCksIHZhbCk7CisKKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCQlJOTE1X1dS
SVRFKERLTF9EUF9NT0RFKHRjX3BvcnQpLCB2YWwpOworCQllbHNlCisJCQlJOTE1X1dSSVRFKE1H
X0RQX01PREUobG4sIHBvcnQpLCB2YWwpOwogCX0KIAotCWJpdHMgPSBNR19NSVNDX1NVUzBfQ0ZH
X1RSMlBXUl9HQVRJTkcgfCBNR19NSVNDX1NVUzBfQ0ZHX0NMMlBXUl9HQVRJTkcgfAotCSAgICAg
ICBNR19NSVNDX1NVUzBfQ0ZHX0dBT05QV1JfR0FUSU5HIHwgTUdfTUlTQ19TVVMwX0NGR19UUlBX
Ul9HQVRJTkcgfAotCSAgICAgICBNR19NSVNDX1NVUzBfQ0ZHX0NMMVBXUl9HQVRJTkcgfCBNR19N
SVNDX1NVUzBfQ0ZHX0RHUFdSX0dBVElORzsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA9PSAx
MSkgeworCQliaXRzID0gTUdfTUlTQ19TVVMwX0NGR19UUjJQV1JfR0FUSU5HIHwKKwkJICAgICAg
IE1HX01JU0NfU1VTMF9DRkdfQ0wyUFdSX0dBVElORyB8CisJCSAgICAgICBNR19NSVNDX1NVUzBf
Q0ZHX0dBT05QV1JfR0FUSU5HIHwKKwkJICAgICAgIE1HX01JU0NfU1VTMF9DRkdfVFJQV1JfR0FU
SU5HIHwKKwkJICAgICAgIE1HX01JU0NfU1VTMF9DRkdfQ0wxUFdSX0dBVElORyB8CisJCSAgICAg
ICBNR19NSVNDX1NVUzBfQ0ZHX0RHUFdSX0dBVElORzsKIAotCXZhbCA9IEk5MTVfUkVBRChNR19N
SVNDX1NVUzAodGNfcG9ydCkpOwotCWlmIChlbmFibGUpCi0JCXZhbCB8PSAoYml0cyB8IE1HX01J
U0NfU1VTMF9TVVNDTEtfRFlOQ0xLR0FURV9NT0RFKDMpKTsKLQllbHNlCi0JCXZhbCAmPSB+KGJp
dHMgfCBNR19NSVNDX1NVUzBfU1VTQ0xLX0RZTkNMS0dBVEVfTU9ERV9NQVNLKTsKLQlJOTE1X1dS
SVRFKE1HX01JU0NfU1VTMCh0Y19wb3J0KSwgdmFsKTsKKwkJdmFsID0gSTkxNV9SRUFEKE1HX01J
U0NfU1VTMCh0Y19wb3J0KSk7CisJCWlmIChlbmFibGUpCisJCQl2YWwgfD0gKGJpdHMgfCBNR19N
SVNDX1NVUzBfU1VTQ0xLX0RZTkNMS0dBVEVfTU9ERSgzKSk7CisJCWVsc2UKKwkJCXZhbCAmPSB+
KGJpdHMgfCBNR19NSVNDX1NVUzBfU1VTQ0xLX0RZTkNMS0dBVEVfTU9ERV9NQVNLKTsKKwkJSTkx
NV9XUklURShNR19NSVNDX1NVUzAodGNfcG9ydCksIHZhbCk7CisJfQogfQogCiBzdGF0aWMgdm9p
ZCBpY2xfcHJvZ3JhbV9tZ19kcF9tb2RlKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVs
X2RpZ19wb3J0KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoaW50ZWxfZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gaW50
ZWxfZGlnX3BvcnQtPmJhc2UucG9ydDsKKwllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVsX3Bv
cnRfdG9fdGMoZGV2X3ByaXYsIHBvcnQpOwogCXUzMiBsbjAsIGxuMSwgcGluX2Fzc2lnbm1lbnQ7
CiAJdTggd2lkdGg7CiAKIAlpZiAoaW50ZWxfZGlnX3BvcnQtPnRjX21vZGUgPT0gVENfUE9SVF9U
QlRfQUxUKQogCQlyZXR1cm47CiAKLQlsbjAgPSBJOTE1X1JFQUQoTUdfRFBfTU9ERSgwLCBwb3J0
KSk7Ci0JbG4xID0gSTkxNV9SRUFEKE1HX0RQX01PREUoMSwgcG9ydCkpOworCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEyKSB7CisJCUk5MTVfV1JJVEUoSElQX0lOREVYX1JFRyh0Y19wb3J0
KSwgSElQX0lOREVYX1ZBTCh0Y19wb3J0LCAweDApKTsKKwkJbG4wID0gSTkxNV9SRUFEKERLTF9E
UF9NT0RFKHRjX3BvcnQpKTsKKwkJSTkxNV9XUklURShISVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBI
SVBfSU5ERVhfVkFMKHRjX3BvcnQsIDB4MSkpOworCQlsbjEgPSBJOTE1X1JFQUQoREtMX0RQX01P
REUodGNfcG9ydCkpOworCX0gZWxzZSB7CisJCWxuMCA9IEk5MTVfUkVBRChNR19EUF9NT0RFKDAs
IHBvcnQpKTsKKwkJbG4xID0gSTkxNV9SRUFEKE1HX0RQX01PREUoMSwgcG9ydCkpOworCX0KIAog
CWxuMCAmPSB+KE1HX0RQX01PREVfQ0ZHX0RQX1gxX01PREUgfCBNR19EUF9NT0RFX0NGR19EUF9Y
MV9NT0RFKTsKIAlsbjEgJj0gfihNR19EUF9NT0RFX0NGR19EUF9YMV9NT0RFIHwgTUdfRFBfTU9E
RV9DRkdfRFBfWDJfTU9ERSk7CkBAIC0zMTU3LDggKzMyNzMsMTUgQEAgc3RhdGljIHZvaWQgaWNs
X3Byb2dyYW1fbWdfZHBfbW9kZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdf
cG9ydCkKIAkJTUlTU0lOR19DQVNFKHBpbl9hc3NpZ25tZW50KTsKIAl9CiAKLQlJOTE1X1dSSVRF
KE1HX0RQX01PREUoMCwgcG9ydCksIGxuMCk7Ci0JSTkxNV9XUklURShNR19EUF9NT0RFKDEsIHBv
cnQpLCBsbjEpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CisJCUk5MTVfV1JJ
VEUoSElQX0lOREVYX1JFRyh0Y19wb3J0KSwgSElQX0lOREVYX1ZBTCh0Y19wb3J0LCAweDApKTsK
KwkJSTkxNV9XUklURShES0xfRFBfTU9ERSh0Y19wb3J0KSwgbG4wKTsKKwkJSTkxNV9XUklURShI
SVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5ERVhfVkFMKHRjX3BvcnQsIDB4MSkpOworCQlJ
OTE1X1dSSVRFKERLTF9EUF9NT0RFKHRjX3BvcnQpLCBsbjEpOworCX0gZWxzZSB7CisJCUk5MTVf
V1JJVEUoTUdfRFBfTU9ERSgwLCBwb3J0KSwgbG4wKTsKKwkJSTkxNV9XUklURShNR19EUF9NT0RF
KDEsIHBvcnQpLCBsbjEpOworCX0KIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfZHBfc2lua19zZXRf
ZmVjX3JlYWR5KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCkBAIC0zMjYzLDcgKzMzODYsNyBA
QCBzdGF0aWMgdm9pZCB0Z2xfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJaWNsX3BoeV9zZXRfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0LCBmYWxzZSk7CiAK
IAkvKiA3LmUgKi8KLQlpY2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRl
LT5wb3J0X2Nsb2NrLCBsZXZlbCwKKwl0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBj
cnRjX3N0YXRlLT5wb3J0X2Nsb2NrLCBsZXZlbCwKIAkJCQllbmNvZGVyLT50eXBlKTsKIAogCS8q
IDcuZiAqLwpAQCAtMzI5NSw2ICszNDE4LDE1IEBAIHN0YXRpYyB2b2lkIHRnbF9kZGlfcHJlX2Vu
YWJsZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkvKiA3LmsgKi8KIAlpbnRl
bF9kcF9zdG9wX2xpbmtfdHJhaW4oaW50ZWxfZHApOwogCisJLyoKKwkgKiBUT0RPOiBlbmFibGUg
Y2xvY2sgZ2F0aW5nCisJICoKKwkgKiBJdCBpcyBub3Qgd3JpdHRlbiBpbiBEUCBlbmFibGluZyBz
ZXF1ZW5jZSBidXQgIlBIWSBDbG9ja2dhdGluZworCSAqIHByb2dyYW1taW5nIiBzdGF0ZXMgdGhh
dCBjbG9jayBnYXRpbmcgc2hvdWxkIGJlIGVuYWJsZWQgYWZ0ZXIgdGhlCisJICogbGluayB0cmFp
bmluZyBidXQgZG9pbmcgc28gY2F1c2VzIGFsbCB0aGUgZm9sbG93aW5nIHRyYWluaW5ncyB0byBm
YWlsCisJICogc28gbm90IGVuYWJsaW5nIGl0IGZvciBub3cuCisJICovCisKIAkvKiA3LmwgKi8K
IAlpbnRlbF9kZGlfZW5hYmxlX2ZlYyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKIAlpbnRlbF9kc2Nf
ZW5hYmxlKGVuY29kZXIsIGNydGNfc3RhdGUpOwpAQCAtMzQwMiw3ICszNTM0LDEwIEBAIHN0YXRp
YyB2b2lkIGludGVsX2RkaV9wcmVfZW5hYmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJaWNsX3Byb2dyYW1fbWdfZHBfbW9kZShkaWdfcG9ydCk7CiAJaWNsX3BoeV9zZXRf
Y2xvY2tfZ2F0aW5nKGRpZ19wb3J0LCBmYWxzZSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJdGdsX2RkaV92c3dp
bmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywKKwkJCQkJbGV2ZWws
IElOVEVMX09VVFBVVF9IRE1JKTsKKwllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDEx
KQogCQlpY2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRlLT5wb3J0X2Ns
b2NrLAogCQkJCQlsZXZlbCwgSU5URUxfT1VUUFVUX0hETUkpOwogCWVsc2UgaWYgKElTX0NBTk5P
TkxBS0UoZGV2X3ByaXYpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZWcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKaW5kZXggYmNmNDQ5YzFkMTUy
Li43ZjZiNTlhYTYzNDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVn
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaApAQCAtMTAyNDUsMTQgKzEw
MjQ1LDYgQEAgZW51bSBza2xfcG93ZXJfZ2F0ZSB7CiAJCQkJCQkgICAgIF9ES0xfVFhfRFcxOCkK
IAogI2RlZmluZSBfREtMX0RQX01PREUJCQkJCTB4QTAKLSNkZWZpbmUgIERLTF9EUF9NT0RFX0NG
R19HQU9OUFdSX0dBVElORwkJKDEgPDwgMSkKLSNkZWZpbmUgIERLTF9EUF9NT0RFX0NGR19ESUdQ
V1JfR0FUSU5HCQkoMSA8PCAyKQotI2RlZmluZSAgREtMX0RQX01PREVfQ0ZHX0NMTlBXUl9HQVRJ
TkcJCSgxIDw8IDMpCi0jZGVmaW5lICBES0xfRFBfTU9ERV9DRkdfVFJQV1JfR0FUSU5HCQkoMSA8
PCA0KQotI2RlZmluZSAgREtMX0RQX01PREVfQ0ZHX1RSMlBXUl9HQVRJTkcJCSgxIDw8IDUpCi0j
ZGVmaW5lICBES0xfRFBfTU9ERV9DRkdfR0FUSU5HX0NUUkxfTUFTSwkoMHgxZiA8PCAxKQotI2Rl
ZmluZSAgREtMX0RQX01PREVfQ0ZHX0RQX1gxX01PREUJCQkoMSA8PCA2KQotI2RlZmluZSAgREtM
X0RQX01PREVfQ0ZHX0RQX1gyX01PREUJCQkoMSA8PCA3KQogI2RlZmluZSBES0xfRFBfTU9ERSh0
Y19wb3J0KSBfTU1JTyhfUE9SVCh0Y19wb3J0LCBcCiAJCQkJCQkgICAgIF9ES0xfUEhZMV9CQVNF
LCBcCiAJCQkJCQkgICAgIF9ES0xfUEhZMl9CQVNFKSArIFwKLS0gCjIuMjMuMAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcg
bGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A71268FD07
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 10:06:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0E1A96EB20;
	Fri, 16 Aug 2019 08:06:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 518F16EB1C
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 08:05:50 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Aug 2019 01:05:50 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,391,1559545200"; d="scan'208";a="184851512"
Received: from miyoungj-mobl1.amr.corp.intel.com (HELO
 ldmartin-desk1.intel.com) ([10.254.105.68])
 by FMSMGA003.fm.intel.com with ESMTP; 16 Aug 2019 01:05:48 -0700
From: Lucas De Marchi <lucas.demarchi@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 16 Aug 2019 01:04:41 -0700
Message-Id: <20190816080503.28594-18-lucas.demarchi@intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190816080503.28594-1-lucas.demarchi@intel.com>
References: <20190816080503.28594-1-lucas.demarchi@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 17/39] drm/i915/tgl: Select master transcoder in
 DP MST
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8am9zZS5zb3V6YUBpbnRlbC5jb20+CgpPbiBU
R0wgdGhlIGJsZW5kaW5nIG9mIGFsbCB0aGUgc3RyZWFtcyBoYXZlIG1vdmVkIGZyb20gRERJIHRv
CnRyYW5zY29kZXIsIHNvIG5vdyBldmVyeSB0cmFuc2NvZGVyIHdvcmtpbmcgb3ZlciB0aGUgc2Ft
ZSBNU1QgcG9ydCBtdXN0CnNlbmQgaXRzIHN0cmVhbSB0byBhIG1hc3RlciB0cmFuc2NvZGVyIGFu
ZCBtYXN0ZXIgd2lsbCBzZW5kIHRvIERESQpyZXNwZWN0aW5nIHRoZSB0aW1lIHNsb3RzLgoKU28g
aGVyZSBpdCBpcyBwaWNraW5nIHRoZSBsb3dlc3QgcGlwZS90cmFuc2NvZGVyIGFzIGl0IHdpbGwg
YmUKZW5hYmxlZCBmaXJzdCBhbmQgZGlzYWJsZWQgbGFzdC4KQlNwZWM6IDUwNDkzCkJTcGVjOiA0
OTE5MAoKQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+
CkNjOiBNYW5hc2kgTmF2YXJlIDxtYW5hc2kuZC5uYXZhcmVAaW50ZWwuY29tPgpDYzogUm9kcmln
byBWaXZpIDxyb2RyaWdvLnZpdmlAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBKb3PDqSBSb2Jl
cnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTHVjYXMg
RGUgTWFyY2hpIDxsdWNhcy5kZW1hcmNoaUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyAgICAgIHwgIDE3ICsrCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAgMTUgKysKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oICB8ICAgMyArCiAuLi4vZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcF9tc3QuYyAgIHwgMTU5ICsrKysrKysrKysrKysrKysrLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuaCAgIHwgICAyICsKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAgICAgICB8ICAgMyArCiA3IGZpbGVzIGNo
YW5nZWQsIDE5OSBpbnNlcnRpb25zKCspLCAzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDY0N2JhNTE0MDY1Ni4uYzI2ZGVlODUyMWY2
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTE4NDAsNiAr
MTg0MCwxMiBAQCB2b2lkIGludGVsX2RkaV9lbmFibGVfdHJhbnNjb2Rlcl9mdW5jKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCX0gZWxzZSBpZiAoaW50ZWxfY3J0
Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFBfTVNUKSkgewogCQl0ZW1wIHw9
IFRSQU5TX0RESV9NT0RFX1NFTEVDVF9EUF9NU1Q7CiAJCXRlbXAgfD0gRERJX1BPUlRfV0lEVEgo
Y3J0Y19zdGF0ZS0+bGFuZV9jb3VudCk7CisKKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTIpIHsKKwkJCWVudW0gdHJhbnNjb2RlciBtYXN0ZXIgPSBjcnRjX3N0YXRlLT5tc3RfbWFzdGVy
X3RyYW5zOworCisJCQl0ZW1wIHw9IFRSQU5TX0RESV9NU1RfVFJBTlNQT1JUX1NFTEVDVF9EUFRQ
KG1hc3Rlcik7CisJCX0KIAl9IGVsc2UgewogCQl0ZW1wIHw9IFRSQU5TX0RESV9NT0RFX1NFTEVD
VF9EUF9TU1Q7CiAJCXRlbXAgfD0gRERJX1BPUlRfV0lEVEgoY3J0Y19zdGF0ZS0+bGFuZV9jb3Vu
dCk7CkBAIC0zODYzLDYgKzM4NjksOCBAQCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlicmVhazsKIAl9CiAKKwlwaXBlX2NvbmZpZy0+
bXN0X21hc3Rlcl90cmFucyA9IFRSQU5TQ09ERVJfSU5WQUxJRDsKKwogCXN3aXRjaCAodGVtcCAm
IFRSQU5TX0RESV9NT0RFX1NFTEVDVF9NQVNLKSB7CiAJY2FzZSBUUkFOU19ERElfTU9ERV9TRUxF
Q1RfSERNSToKIAkJcGlwZV9jb25maWctPmhhc19oZG1pX3NpbmsgPSB0cnVlOwpAQCAtMzg5OCw2
ICszOTA2LDEzIEBAIHZvaWQgaW50ZWxfZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCXBpcGVfY29uZmlnLT5vdXRwdXRfdHlwZXMgfD0gQklUKElOVEVMX09V
VFBVVF9EUF9NU1QpOwogCQlwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCA9CiAJCQkoKHRlbXAgJiBE
RElfUE9SVF9XSURUSF9NQVNLKSA+PiBERElfUE9SVF9XSURUSF9TSElGVCkgKyAxOworCisJCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CisJCQl0ZW1wID0gdGVtcCAmIFRSQU5TX0RE
SV9NU1RfVFJBTlNQT1JUX1NFTEVDVF9NQVNLOworCQkJdGVtcCA9IHRlbXAgPj4gVFJBTlNfRERJ
X01TVF9UUkFOU1BPUlRfU0VMRUNUX1NISUZUOworCQkJcGlwZV9jb25maWctPm1zdF9tYXN0ZXJf
dHJhbnMgPSB0ZW1wOworCQl9CisKIAkJaW50ZWxfZHBfZ2V0X21fbihpbnRlbF9jcnRjLCBwaXBl
X2NvbmZpZyk7CiAJCWJyZWFrOwogCWRlZmF1bHQ6CkBAIC00MDAwLDYgKzQwMTUsOCBAQCBzdGF0
aWMgaW50IGludGVsX2RkaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAogCWludGVsX2RkaV9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKGRldl9wcml2LCBw
aXBlX2NvbmZpZyk7CiAKKwlwaXBlX2NvbmZpZy0+bXN0X21hc3Rlcl90cmFucyA9IFRSQU5TQ09E
RVJfSU5WQUxJRDsKKwogCXJldHVybiAwOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDcyYzQxZDNhZmZiMS4uODFjMWQzNTllZGIyIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtNDcs
NiArNDcsNyBAQAogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfY3J0LmgiCiAjaW5jbHVkZSAiZGlz
cGxheS9pbnRlbF9kZGkuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2RwLmgiCisjaW5jbHVk
ZSAiZGlzcGxheS9pbnRlbF9kcF9tc3QuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2RzaS5o
IgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHZvLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRl
bF9nbWJ1cy5oIgpAQCAtMTIxNTQsNiArMTIxNTUsMTQgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHVt
cF9waXBlX2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcs
CiAKIAlpbnRlbF9kcGxsX2R1bXBfaHdfc3RhdGUoZGV2X3ByaXYsICZwaXBlX2NvbmZpZy0+ZHBs
bF9od19zdGF0ZSk7CiAKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiAmJgorCSAgICBp
bnRlbF9jcnRjX2hhc190eXBlKHBpcGVfY29uZmlnLCBJTlRFTF9PVVRQVVRfRFBfTVNUKSkgewor
CQllbnVtIHRyYW5zY29kZXIgbWFzdGVyID0gcGlwZV9jb25maWctPm1zdF9tYXN0ZXJfdHJhbnM7
CisKKwkJRFJNX0RFQlVHX0tNUygibWFzdGVyIG1zdCBjcHVfdHJhbnNjb2RlcjogJXNcbiIsCisJ
CQkgICAgICB0cmFuc2NvZGVyX25hbWUobWFzdGVyKSk7CisJfQorCiBkdW1wX3BsYW5lczoKIAlp
ZiAoIXN0YXRlKQogCQlyZXR1cm47CkBAIC0xMjgzNyw2ICsxMjg0Niw4IEBAIGludGVsX3BpcGVf
Y29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmN1cnJlbnRfY29u
ZmlnLAogCVBJUEVfQ09ORl9DSEVDS19JTkZPRlJBTUUoaGRtaSk7CiAJUElQRV9DT05GX0NIRUNL
X0lORk9GUkFNRShkcm0pOwogCisJUElQRV9DT05GX0NIRUNLX0kobXN0X21hc3Rlcl90cmFucyk7
CisKICN1bmRlZiBQSVBFX0NPTkZfQ0hFQ0tfWAogI3VuZGVmIFBJUEVfQ09ORl9DSEVDS19JCiAj
dW5kZWYgUElQRV9DT05GX0NIRUNLX0JPT0wKQEAgLTEzNjEzLDYgKzEzNjI0LDEwIEBAIHN0YXRp
YyBpbnQgaW50ZWxfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaW50IHJl
dCwgaTsKIAlib29sIGFueV9tcyA9IHN0YXRlLT5jZGNsay5mb3JjZV9taW5fY2RjbGtfY2hhbmdl
ZDsKIAorCXJldCA9IGludGVsX2RwX21zdF9hdG9taWNfYWRkX2FmZmVjdGVkX2NydGNzKHN0YXRl
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCiAJLyogQ2F0Y2ggSTkxNV9NT0RFX0ZMQUdf
SU5IRVJJVEVEICovCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUs
IGNydGMsIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKaW5kZXggYzAxOTcz
ODBhODcxLi40NTliMzQxNzk2YmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheS5oCkBAIC05MSw2ICs5MSw4IEBAIGVudW0gcGlwZSB7CiAjZGVmaW5lIHBp
cGVfbmFtZShwKSAoKHApICsgJ0EnKQogCiBlbnVtIHRyYW5zY29kZXIgeworCVRSQU5TQ09ERVJf
SU5WQUxJRCA9IC0xLAorCiAJLyoKIAkgKiBUaGUgZm9sbG93aW5nIHRyYW5zY29kZXJzIGhhdmUg
YSAxOjEgdHJhbnNjb2RlciAtPiBwaXBlIG1hcHBpbmcsCiAJICoga2VlcCB0aGVpciB2YWx1ZXMg
Zml4ZWQ6IHRoZSBjb2RlIGFzc3VtZXMgdGhhdCBUUkFOU0NPREVSX0E9MCwgdGhlCkBAIC0xMzIs
NiArMTM0LDcgQEAgc3RhdGljIGlubGluZSBjb25zdCBjaGFyICp0cmFuc2NvZGVyX25hbWUoZW51
bSB0cmFuc2NvZGVyIHRyYW5zY29kZXIpCiAJCXJldHVybiAiRFNJIEEiOwogCWNhc2UgVFJBTlND
T0RFUl9EU0lfQzoKIAkJcmV0dXJuICJEU0kgQyI7CisJY2FzZSBUUkFOU0NPREVSX0lOVkFMSUQ6
CiAJZGVmYXVsdDoKIAkJcmV0dXJuICI8aW52YWxpZD4iOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggYTg4ZWM5YWE5
Y2EwLi41NGQxMDUzZmY2ZDAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC05ODMsNiArOTgzLDkgQEAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgewogCiAJLyogRm9yd2FyZCBFcnJvciBjb3JyZWN0aW9uIFN0YXRlICovCiAJ
Ym9vbCBmZWNfZW5hYmxlOworCisJLyogTWFzdGVyIHRyYW5zY29kZXIgZm9yIGFsbCBzdHJlYW1z
LCBvbmx5IHVzZWQgb24gVEdMKyAqLworCWVudW0gdHJhbnNjb2RlciBtc3RfbWFzdGVyX3RyYW5z
OwogfTsKIAogc3RydWN0IGludGVsX2NydGMgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHBfbXN0LmMKaW5kZXggNzEzODc4NWRhZjE1Li43NWM5ZGI4NWYyYjAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYwpAQCAtODcsNiArODcs
NTAgQEAgc3RhdGljIGludCBpbnRlbF9kcF9tc3RfY29tcHV0ZV9saW5rX2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlyZXR1cm4gMDsKIH0KIAorLyoKKyAqIEl0ZXJhdGUg
b3ZlciBhbGwgdGhlIENSVENzIGFuZCByZXR1cm4gdGhlIHRyYW5zY29kZXIgb2YgdGhlIGxvd2Vz
dCBDUlRDIHRoYXQKKyAqIHNoYXJlIHRoZSBzYW1lIE1TVCBjb25uZWN0b3IuCisgKi8KK3N0YXRp
YyBlbnVtIHRyYW5zY29kZXIKK21zdF9jb21wdXRlX21hc3Rlcl90cmFucyhzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqc3RhdGUsCisJCQkgc3RydWN0IGRybV9jb25uZWN0b3IgKm1zdF9jb25uKQor
eworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX21zdF9jb25uID0gdG9faW50ZWxfY29u
bmVjdG9yKG1zdF9jb25uKTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0
ZSA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqaW50ZWxfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YzsK
KwlpbnQgaTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpCisJCXJldHVybiBUUkFO
U0NPREVSX0lOVkFMSUQ7CisKKwkvKiBJdGVyYXRlIGZyb20gdGhlIGxvd2VzdCB0byB0aGUgaGln
aGVzdCBwaXBlICovCisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoaW50ZWxfc3Rh
dGUsIGludGVsX2NydGMsIGludGVsX2NydGNfc3RhdGUsIGkpIHsKKwkJc3RydWN0IGludGVsX2Rp
Z2l0YWxfY29ubmVjdG9yX3N0YXRlICppbnRlbF9jb25uX3N0YXRlOworCQlzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICppbnRlbF9jb25uOworCQlpbnQgajsKKworCQlpZiAoIWludGVsX2NydGNfc3Rh
dGUtPmJhc2UuYWN0aXZlKQorCQkJY29udGludWU7CisKKwkJZm9yX2VhY2hfbmV3X2ludGVsX2Nv
bm5lY3Rvcl9pbl9zdGF0ZShpbnRlbF9zdGF0ZSwgaW50ZWxfY29ubiwKKwkJCQkJCSAgICAgIGlu
dGVsX2Nvbm5fc3RhdGUsIGopIHsKKwkJCS8qIE9ubHkgY2FyZSBhYm91dCBjb25uZWN0b3JzIG9m
IHRoaXMgQ1JUQyAqLworCQkJaWYgKGludGVsX2Nvbm5fc3RhdGUtPmJhc2UuY3J0YyAhPQorCQkJ
ICAgIGludGVsX2NydGNfc3RhdGUtPmJhc2UuY3J0YykKKwkJCQljb250aW51ZTsKKworCQkJaWYg
KGludGVsX2Nvbm4tPm1zdF9wb3J0ICE9IGludGVsX21zdF9jb25uLT5tc3RfcG9ydCkKKwkJCQlj
b250aW51ZTsKKworCQkJcmV0dXJuIGludGVsX2NydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwor
CQl9CisJfQorCisJcmV0dXJuIFRSQU5TQ09ERVJfSU5WQUxJRDsKK30KKwogc3RhdGljIGludCBp
bnRlbF9kcF9tc3RfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCQkJICAgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCQkg
ICAgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCkBAIC05NCwxNCAr
MTM4LDE1IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcF9tc3RfZW5j
b2RlciAqaW50ZWxfbXN0ID0gZW5jX3RvX21zdCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCA9ICZpbnRlbF9tc3QtPnByaW1hcnktPmRwOwotCXN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciA9Ci0JCXRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRl
LT5jb25uZWN0b3IpOworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0
YXRlLT5jb25uZWN0b3I7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9y
ID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3Rvcik7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxf
Y29ubmVjdG9yX3N0YXRlICppbnRlbF9jb25uX3N0YXRlID0KIAkJdG9faW50ZWxfZGlnaXRhbF9j
b25uZWN0b3Jfc3RhdGUoY29ubl9zdGF0ZSk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPQogCQkmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsK
LQl2b2lkICpwb3J0ID0gY29ubmVjdG9yLT5wb3J0OworCXZvaWQgKnBvcnQgPSBpbnRlbF9jb25u
ZWN0b3ItPnBvcnQ7CiAJc3RydWN0IGxpbmtfY29uZmlnX2xpbWl0cyBsaW1pdHM7CisJZW51bSB0
cmFuc2NvZGVyIG1hc3RlcjsKIAlpbnQgcmV0OwogCiAJaWYgKGFkanVzdGVkX21vZGUtPmZsYWdz
ICYgRFJNX01PREVfRkxBR19EQkxTQ0FOKQpAQCAtMTQ2LDYgKzE5MSw1MSBAQCBzdGF0aWMgaW50
IGludGVsX2RwX21zdF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAogCWludGVsX2RkaV9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKGRldl9wcml2LCBwaXBl
X2NvbmZpZyk7CiAKKwltYXN0ZXIgPSBtc3RfY29tcHV0ZV9tYXN0ZXJfdHJhbnMoY29ubl9zdGF0
ZS0+c3RhdGUsIGNvbm5lY3Rvcik7CisJcGlwZV9jb25maWctPm1zdF9tYXN0ZXJfdHJhbnMgPSBt
YXN0ZXI7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludAoraW50ZWxfZHBfbXN0X21hc3Rl
cl90cmFuc19jaGVjayhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubiwKKwkJCQlzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqbmV3X2Nvbm5fc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uLT5kZXYpOworCXN0cnVjdCBkcm1fYXRvbWlj
X3N0YXRlICpzdGF0ZSA9IG5ld19jb25uX3N0YXRlLT5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUgPQorCQlkcm1fYXRvbWljX2dldF9vbGRfY29ubmVj
dG9yX3N0YXRlKHN0YXRlLCBjb25uKTsKKwlzdHJ1Y3QgZHJtX2NydGMgKm5ld19jcnRjID0gbmV3
X2Nvbm5fc3RhdGUtPmNydGM7CisJc3RydWN0IGRybV9jcnRjICpvbGRfY3J0YyA9IG9sZF9jb25u
X3N0YXRlLT5jcnRjOworCWVudW0gdHJhbnNjb2RlciBvbGRfbWFzdGVyX3RyYW5zID0gVFJBTlND
T0RFUl9JTlZBTElEOworCWVudW0gdHJhbnNjb2RlciBuZXdfbWFzdGVyX3RyYW5zID0gVFJBTlND
T0RFUl9JTlZBTElEOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUsICpv
bGRfY3J0Y19zdGF0ZTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpCisJCXJldHVy
biAwOworCisJaWYgKG9sZF9jcnRjKSB7CisJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICppbnRl
bF9jcnRjX3N0YXRlOworCisJCW9sZF9jcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfbmV3X2Ny
dGNfc3RhdGUoc3RhdGUsIG9sZF9jcnRjKTsKKwkJaW50ZWxfY3J0Y19zdGF0ZSA9IHRvX2ludGVs
X2NydGNfc3RhdGUob2xkX2NydGNfc3RhdGUpOworCQlvbGRfbWFzdGVyX3RyYW5zID0gaW50ZWxf
Y3J0Y19zdGF0ZS0+bXN0X21hc3Rlcl90cmFuczsKKwl9CisKKwlpZiAobmV3X2NydGMpIHsKKwkJ
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmludGVsX2NydGNfc3RhdGU7CisKKwkJbmV3X2NydGNf
c3RhdGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgbmV3X2NydGMpOwor
CQlpbnRlbF9jcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShuZXdfY3J0Y19zdGF0ZSk7
CisJCW5ld19tYXN0ZXJfdHJhbnMgPSBtc3RfY29tcHV0ZV9tYXN0ZXJfdHJhbnMoc3RhdGUsIGNv
bm4pOworCX0KKworCWlmIChvbGRfY3J0YyAmJiBvbGRfbWFzdGVyX3RyYW5zICE9IG5ld19tYXN0
ZXJfdHJhbnMpCisJCW9sZF9jcnRjX3N0YXRlLT5tb2RlX2NoYW5nZWQgPSB0cnVlOworCisJaWYg
KG5ld19jcnRjICYmIG9sZF9tYXN0ZXJfdHJhbnMgIT0gbmV3X21hc3Rlcl90cmFucykKKwkJbmV3
X2NydGNfc3RhdGUtPm1vZGVfY2hhbmdlZCA9IHRydWU7CisKIAlyZXR1cm4gMDsKIH0KIApAQCAt
MTY4LDYgKzI1OCwxMCBAQCBpbnRlbF9kcF9tc3RfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAorCXJldCA9IGlu
dGVsX2RwX21zdF9tYXN0ZXJfdHJhbnNfY2hlY2soY29ubmVjdG9yLCBuZXdfY29ubl9zdGF0ZSk7
CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCWlmICghb2xkX2Nvbm5fc3RhdGUtPmNydGMp
CiAJCXJldHVybiAwOwogCkBAIC02NzIsMyArNzY2LDYyIEBAIGludGVsX2RwX21zdF9lbmNvZGVy
X2NsZWFudXAoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQpCiAJZHJt
X2RwX21zdF90b3BvbG9neV9tZ3JfZGVzdHJveSgmaW50ZWxfZHAtPm1zdF9tZ3IpOwogCS8qIGVu
Y29kZXJzIHdpbGwgZ2V0IGtpbGxlZCBieSBub3JtYWwgY2xlYW51cCAqLwogfQorCisvKioKKyAq
IGludGVsX2RwX21zdF9hdG9taWNfYWRkX2FmZmVjdGVkX2NydGNzIC0gQWRkIGFsbCBDUlRDcyB0
aGF0IHNoYXJlIHRoZSBNU1QKKyAqIHN0cmVhbSB3aXRoIHRoZSBDUlRDcyBpbiB0aGUgY3VycmVu
dCBhdG9taWMgc3RhdGUuCisgKiBAc3RhdGU6IHN0YXRlIHRvIGFkZCBDUlRDcworICoKKyAqIEl0
IGlzIG5lZWRlZCBhZGQgdGhlIENSVENzIHRyaWdnZXIgYSBjYWxsIHRvIGF0b21pY19jaGVjaygp
IHRvCisgKiBldmVyeSBjb25uZWN0b3IgYXR0YWNoZWQgdG8gdGhlIENSVEMgaW4gY2FzZSBhIG5l
dyBtYXN0ZXIgdHJhbnNjb2RlciB3aWxsCisgKiBiZSBuZWVkZWQuCisgKi8KK2ludCBpbnRlbF9k
cF9tc3RfYXRvbWljX2FkZF9hZmZlY3RlZF9jcnRjcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KHN0YXRlLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRl
ICppbnRlbF9jb25uX3N0YXRlOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFz
ZS5kZXY7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubjsKKwlpbnQgaTsKKwor
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpCisJCXJldHVybiAwOworCisJZm9yX2VhY2hf
bmV3X2ludGVsX2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwgaW50ZWxfY29ubiwgaW50ZWxfY29u
bl9zdGF0ZSwgaSkgeworCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9saXN0
X2l0ZXI7CisJCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uX2l0ZXI7CisKKwkJaWYgKCFpbnRl
bF9jb25uLT5tc3RfcG9ydCkKKwkJCWNvbnRpbnVlOworCisJCWRybV9jb25uZWN0b3JfbGlzdF9p
dGVyX2JlZ2luKGRldiwgJmNvbm5fbGlzdF9pdGVyKTsKKwkJZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rv
cl9pdGVyKGNvbm5faXRlciwgJmNvbm5fbGlzdF9pdGVyKSB7CisJCQlzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqY29ubl9pdGVyX3N0YXRlOworCQkJc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
aW50ZWxfY29ubl9pdGVyOworCQkJc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOwor
CisJCQlpbnRlbF9jb25uX2l0ZXIgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9pdGVyKTsKKwor
CQkJaWYgKGludGVsX2Nvbm5faXRlci0+bXN0X3BvcnQgIT0gaW50ZWxfY29ubi0+bXN0X3BvcnQp
CisJCQkJY29udGludWU7CisKKwkJCWNvbm5faXRlcl9zdGF0ZSA9IGRybV9hdG9taWNfZ2V0X2Nv
bm5lY3Rvcl9zdGF0ZSgmc3RhdGUtPmJhc2UsIGNvbm5faXRlcik7CisJCQlpZiAoSVNfRVJSKGNv
bm5faXRlcl9zdGF0ZSkpIHsKKwkJCQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5f
bGlzdF9pdGVyKTsKKwkJCQlyZXR1cm4gUFRSX0VSUihjb25uX2l0ZXJfc3RhdGUpOworCQkJfQor
CQkJaWYgKCFjb25uX2l0ZXJfc3RhdGUtPmNydGMpCisJCQkJY29udGludWU7CisKKwkJCWNydGNf
c3RhdGUgPSBkcm1fYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwKKwkJCQkJCQkg
ICAgICAgY29ubl9pdGVyX3N0YXRlLT5jcnRjKTsKKwkJCWlmIChJU19FUlIoY3J0Y19zdGF0ZSkp
IHsKKwkJCQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5fbGlzdF9pdGVyKTsKKwkJ
CQlyZXR1cm4gUFRSX0VSUihjcnRjX3N0YXRlKTsKKwkJCX0KKwkJfQorCQlkcm1fY29ubmVjdG9y
X2xpc3RfaXRlcl9lbmQoJmNvbm5fbGlzdF9pdGVyKTsKKwl9CisKKwlyZXR1cm4gMDsKK30KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5oCmluZGV4IGY2NjBhZDgw
ZGIwNC4uMTczNTk4YWE4MWQyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RwX21zdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHBfbXN0LmgKQEAgLTYsMTAgKzYsMTIgQEAKICNpZm5kZWYgX19JTlRFTF9EUF9NU1RfSF9f
CiAjZGVmaW5lIF9fSU5URUxfRFBfTVNUX0hfXwogCitzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
Owogc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydDsKIAogaW50IGludGVsX2RwX21zdF9lbmNvZGVy
X2luaXQoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsIGludCBjb25u
X2lkKTsKIHZvaWQgaW50ZWxfZHBfbXN0X2VuY29kZXJfY2xlYW51cChzdHJ1Y3QgaW50ZWxfZGln
aXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCk7CitpbnQgaW50ZWxfZHBfbXN0X2F0b21pY19hZGRf
YWZmZWN0ZWRfY3J0Y3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogaW50IGlu
dGVsX2RwX21zdF9lbmNvZGVyX2FjdGl2ZV9saW5rcyhzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0
ICppbnRlbF9kaWdfcG9ydCk7CiAKICNlbmRpZiAvKiBfX0lOVEVMX0RQX01TVF9IX18gKi8KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IDA5NWRkMjcwNDRjMC4uYzgzNmFmMGI4MjMxIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAgLTk0ODAsNiArOTQ4MCw5IEBAIGVudW0gc2tsX3Bvd2Vy
X2dhdGUgewogI2RlZmluZSAgVFJBTlNfRERJX0VEUF9JTlBVVF9BX09OT0ZGCSg0IDw8IDEyKQog
I2RlZmluZSAgVFJBTlNfRERJX0VEUF9JTlBVVF9CX09OT0ZGCSg1IDw8IDEyKQogI2RlZmluZSAg
VFJBTlNfRERJX0VEUF9JTlBVVF9DX09OT0ZGCSg2IDw8IDEyKQorI2RlZmluZSAgVFJBTlNfRERJ
X01TVF9UUkFOU1BPUlRfU0VMRUNUX1NISUZUCQkxMCAvKiBUR0wrICovCisjZGVmaW5lICBUUkFO
U19ERElfTVNUX1RSQU5TUE9SVF9TRUxFQ1RfTUFTSwkJKDB4MyA8PCAxMCkKKyNkZWZpbmUgIFRS
QU5TX0RESV9NU1RfVFJBTlNQT1JUX1NFTEVDVF9EUFRQKHRyYW5zKQkoKHRyYW5zKSA8PCAxMCkK
ICNkZWZpbmUgIFRSQU5TX0RESV9IRENQX1NJR05BTExJTkcJKDEgPDwgOSkKICNkZWZpbmUgIFRS
QU5TX0RESV9EUF9WQ19QQVlMT0FEX0FMTE9DCSgxIDw8IDgpCiAjZGVmaW5lICBUUkFOU19ERElf
SERNSV9TQ1JBTUJMRVJfQ1RTX0VOQUJMRSAoMSA8PCA3KQotLSAKMi4yMS4wCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

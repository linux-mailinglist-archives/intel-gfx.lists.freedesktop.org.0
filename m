Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 377F910B190
	for <lists+intel-gfx@lfdr.de>; Wed, 27 Nov 2019 15:44:07 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 90A6D6E2B6;
	Wed, 27 Nov 2019 14:44:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4C5F66E2B6
 for <intel-gfx@lists.freedesktop.org>; Wed, 27 Nov 2019 14:43:58 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 Nov 2019 06:43:58 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,249,1571727600"; d="scan'208";a="234122860"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga004.fm.intel.com with ESMTP; 27 Nov 2019 06:43:56 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 27 Nov 2019 16:41:28 +0200
Message-Id: <20191127144128.3195-5-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191127144128.3195-1-stanislav.lisovskiy@intel.com>
References: <20191127144128.3195-1-stanislav.lisovskiy@intel.com>
Subject: [Intel-gfx] [PATCH v6 4/4] drm/i915: Correctly map DBUF slices to
 pipes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkZWQgcHJvcGVyIERCdWYgc2xpY2UgbWFwcGluZyB0byBjb3JyZXNwb25kZW50CnBpcGVzLCBk
ZXBlbmRpbmcgb24gcGlwZSBjb25maWd1cmF0aW9uIGFzIHN0YXRlZAppbiBCU3BlYy4KCnYyOgog
ICAgLSBSZW1vdmUgdW5uZWVkZWQgYnJhY2VzCiAgICAtIFN0b3AgdXNpbmcgbWFjcm8gZm9yIERC
dWYgYXNzaWdubWVudHMgYXMKICAgICAgaXQgc2VlbXMgdG8gcmVkdWNlIHJlYWRhYmlsaXR5LgoK
U2lnbmVkLW9mZi1ieTogU3RhbmlzbGF2IExpc292c2tpeSA8c3RhbmlzbGF2Lmxpc292c2tpeUBp
bnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyB8IDIzNSArKysr
KysrKysrKysrKysrKysrKysrKysrKysrKystLQogMSBmaWxlIGNoYW5nZWQsIDIyMSBpbnNlcnRp
b25zKCspLCAxNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCA0YzMw
ZGRkYjk0M2EuLjZiMWU2YjJhZWY0MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC0zODE1
LDYgKzM4MTUsMjUgQEAgYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUpCiAJcmV0dXJuIHRydWU7CiB9CiAKKy8qCisgKiBDYWxjdWxhdGUg
aW5pdGlhbCBEQnVmIHNsaWNlIG9mZnNldCwgYmFzZWQgb24gc2xpY2Ugc2l6ZQorICogYW5kIG1h
c2soaS5lIGlmIHNsaWNlIHNpemUgaXMgMTAyNCBhbmQgc2Vjb25kIHNsaWNlIGlzIGVuYWJsZWQK
KyAqIG9mZnNldCB3b3VsZCBiZSAxMDI0KQorICovCitzdGF0aWMgdTMyIGljbF9nZXRfZmlyc3Rf
ZGJ1Zl9zbGljZV9vZmZzZXQodTMyIGRidWZfc2xpY2VfbWFzaywKKwkJCQkJICAgdTMyIHNsaWNl
X3NpemUsIHUzMiBkZGJfc2l6ZSkKK3sKKwl1MzIgb2Zmc2V0ID0gMDsKKworCWlmICghZGJ1Zl9z
bGljZV9tYXNrKQorCQlyZXR1cm4gMDsKKworCW9mZnNldCA9IChmZnMoZGJ1Zl9zbGljZV9tYXNr
KSAtIDEpICogc2xpY2Vfc2l6ZTsKKworCVdBUk5fT04ob2Zmc2V0ID49IGRkYl9zaXplKTsKKwly
ZXR1cm4gb2Zmc2V0OworfQorCiBzdGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgIGNvbnN0IHU2NCB0b3RhbF9kYXRhX3Jh
dGUsCkBAIC0zODI4LDE4ICszODQ3LDEzIEBAIHN0YXRpYyB1MTYgaW50ZWxfZ2V0X2RkYl9zaXpl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA8IDExKQogCQlyZXR1cm4gZGRiX3NpemUgLSA0OyAvKiA0IGJsb2NrcyBmb3IgYnlwYXNz
IHBhdGggYWxsb2NhdGlvbiAqLwogCi0JLyoKLQkgKiBGSVhNRTogRW5hYmxlZCBzbGljZXMgc2hv
dWxkIGJlIG9ubHkKLQkgKiBpbiBhY2NvcmRpbmcgdG8gQlNwZWMgYW5kIGJlIGRldGVybWluZWQK
LQkgKiBieSBudW0gYWN0aXZlIHBpcGVzKEJTcGVjIDEyNzE2IGFuZCA0OTI1NSkuCi0JICogRm9y
IG5vdyBzZXQgbWFzayBmb3IgMXN0IHNsaWNlIG9ubHkuCi0JICovCi0JZGRiLT5lbmFibGVkX3Ns
aWNlcyA9IERCVUZfUzFfQklUOwotCWRkYl9zaXplIC89IDI7Ci0KIAlyZXR1cm4gZGRiX3NpemU7
CiB9CiAKK3UzMiBpOTE1X3Bvc3NpYmxlX2RidWZfc2xpY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKKwkJCSAgICAgIGludCBwaXBlLCB1MzIgYWN0aXZlX3BpcGVzLAorCQkJ
ICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOworCiBzdGF0
aWMgdm9pZAogc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCkBAIC0zODU1LDcgKzM4NjksMTQgQEAgc2tsX2RkYl9nZXRfcGlwZV9h
bGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdTMy
IHBpcGVfd2lkdGggPSAwLCB0b3RhbF93aWR0aCA9IDAsIHdpZHRoX2JlZm9yZV9waXBlID0gMDsK
IAllbnVtIHBpcGUgZm9yX3BpcGUgPSB0b19pbnRlbF9jcnRjKGZvcl9jcnRjKS0+cGlwZTsKIAl1
MTYgZGRiX3NpemU7CisJdTMyIGRkYl9yYW5nZV9zaXplOwogCXUzMiBpOworCXUzMiBkYnVmX3Ns
aWNlX21hc2s7CisJdTMyIGFjdGl2ZV9waXBlczsKKwl1MzIgb2Zmc2V0OworCXUzMiBzbGljZV9z
aXplOworCXUzMiB0b3RhbF9zbGljZV9tYXNrOworCXUzMiBzdGFydCwgZW5kOwogCiAJaWYgKFdB
Uk5fT04oIXN0YXRlKSB8fCAhY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCWFsbG9jLT5zdGFy
dCA9IDA7CkBAIC0zODY0LDE0ICszODg1LDIzIEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlv
bl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJ
fQogCi0JaWYgKGludGVsX3N0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzKQorCWlmIChpbnRlbF9z
dGF0ZS0+YWN0aXZlX3BpcGVfY2hhbmdlcykgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGlu
dGVsX3N0YXRlLT5hY3RpdmVfcGlwZXMpOwotCWVsc2UKKwkJYWN0aXZlX3BpcGVzID0gaW50ZWxf
c3RhdGUtPmFjdGl2ZV9waXBlczsKKwl9IGVsc2UgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4
KGRldl9wcml2LT5hY3RpdmVfcGlwZXMpOworCQlhY3RpdmVfcGlwZXMgPSBkZXZfcHJpdi0+YWN0
aXZlX3BpcGVzOworCX0KIAogCWRkYl9zaXplID0gaW50ZWxfZ2V0X2RkYl9zaXplKGRldl9wcml2
LCBjcnRjX3N0YXRlLCB0b3RhbF9kYXRhX3JhdGUsCiAJCQkJICAgICAgKm51bV9hY3RpdmUsIGRk
Yik7CiAKKwlEUk1fREVCVUdfS01TKCJHb3QgdG90YWwgZGRiIHNpemUgJWRcbiIsIGRkYl9zaXpl
KTsKKworCXNsaWNlX3NpemUgPSBkZGJfc2l6ZSAvIElOVEVMX0lORk8oZGV2X3ByaXYpLT5udW1f
c3VwcG9ydGVkX2RidWZfc2xpY2VzOworCisJRFJNX0RFQlVHX0tNUygiR290IERCdWYgc2xpY2Ug
c2l6ZSAlZFxuIiwgc2xpY2Vfc2l6ZSk7CisKIAkvKgogCSAqIElmIHRoZSBzdGF0ZSBkb2Vzbid0
IGNoYW5nZSB0aGUgYWN0aXZlIENSVEMncyBvciB0aGVyZSBpcyBubwogCSAqIG1vZGVzZXQgcmVx
dWVzdCwgdGhlbiB0aGVyZSdzIG5vIG5lZWQgdG8gcmVjYWxjdWxhdGU7CkBAIC0zODg5LDE4ICsz
OTE5LDY4IEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJfQogCisJLyoKKwkgKiBHZXQgYWxs
b3dlZCBEQnVmIHNsaWNlcyBmb3IgY29ycmVzcG9uZGVudCBwaXBlIGFuZCBwbGF0Zm9ybS4KKwkg
Ki8KKwlkYnVmX3NsaWNlX21hc2sgPSBpOTE1X3Bvc3NpYmxlX2RidWZfc2xpY2VzKGRldl9wcml2
LCBmb3JfcGlwZSwKKwkJCQkJCSAgICBhY3RpdmVfcGlwZXMsIGNydGNfc3RhdGUpOworCisJRFJN
X0RFQlVHX0tNUygiREJ1ZiBzbGljZSBtYXNrICV4IHBpcGUgJWQgYWN0aXZlIHBpcGVzICV4XG4i
LAorCQkgICAgICBkYnVmX3NsaWNlX21hc2ssCisJCSAgICAgIGZvcl9waXBlLCBhY3RpdmVfcGlw
ZXMpOworCisJLyoKKwkgKiBGaWd1cmUgb3V0IGF0IHdoaWNoIERCdWYgc2xpY2Ugd2Ugc3RhcnQs
IGkuZSBpZiB3ZSBzdGFydCBhdCBEYnVmIFMyCisJICogYW5kIHNsaWNlIHNpemUgaXMgMTAyNCwg
dGhlIG9mZnNldCB3b3VsZCBiZSAxMDI0CisJICovCisJb2Zmc2V0ID0gaWNsX2dldF9maXJzdF9k
YnVmX3NsaWNlX29mZnNldChkYnVmX3NsaWNlX21hc2ssCisJCQkJCQkgc2xpY2Vfc2l6ZSwgZGRi
X3NpemUpOworCisJLyoKKwkgKiBGaWd1cmUgb3V0IHRvdGFsIHNpemUgb2YgYWxsb3dlZCBEQnVm
IHNsaWNlcywgd2hpY2ggaXMgYmFzaWNhbGx5CisJICogYSBudW1iZXIgb2YgYWxsb3dlZCBzbGlj
ZXMgZm9yIHRoYXQgcGlwZSBtdWx0aXBsaWVkIGJ5IHNsaWNlIHNpemUuCisJICogSW5zaWRlIG9m
IHRoaXMKKwkgKiByYW5nZSBkZGIgZW50cmllcyBhcmUgc3RpbGwgYWxsb2NhdGVkIGluIHByb3Bv
cnRpb24gdG8gZGlzcGxheSB3aWR0aC4KKwkgKi8KKwlkZGJfcmFuZ2Vfc2l6ZSA9IGh3ZWlnaHQ4
KGRidWZfc2xpY2VfbWFzaykgKiBzbGljZV9zaXplOworCiAJLyoKIAkgKiBXYXRlcm1hcmsvZGRi
IHJlcXVpcmVtZW50IGhpZ2hseSBkZXBlbmRzIHVwb24gd2lkdGggb2YgdGhlCiAJICogZnJhbWVi
dWZmZXIsIFNvIGluc3RlYWQgb2YgYWxsb2NhdGluZyBEREIgZXF1YWxseSBhbW9uZyBwaXBlcwog
CSAqIGRpc3RyaWJ1dGUgRERCIGJhc2VkIG9uIHJlc29sdXRpb24vd2lkdGggb2YgdGhlIGRpc3Bs
YXkuCiAJICovCisJdG90YWxfc2xpY2VfbWFzayA9IGRidWZfc2xpY2VfbWFzazsKIAlmb3JfZWFj
aF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShpbnRlbF9zdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwg
aSkgewogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJ
CQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJZW51bSBwaXBlIHBpcGUgPSBjcnRj
LT5waXBlOwogCQlpbnQgaGRpc3BsYXksIHZkaXNwbGF5OworCQl1MzIgcGlwZV9kYnVmX3NsaWNl
X21hc2sgPQorCQkJCQlpOTE1X3Bvc3NpYmxlX2RidWZfc2xpY2VzKGRldl9wcml2LAorCQkJCQkJ
CQkgIHBpcGUsCisJCQkJCQkJCSAgYWN0aXZlX3BpcGVzLAorCQkJCQkJCQkgIGNydGNfc3RhdGUp
OwogCi0JCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQorCQlpZiAoIWNydGNfc3RhdGUtPmh3
LmFjdGl2ZSkKKwkJCWNvbnRpbnVlOworCisJCS8qCisJCSAqIEFjY29yZGluZyB0byBCU3BlYyBw
aXBlIGNhbiBzaGFyZSBvbmUgZGJ1ZiBzbGljZSB3aXRoIGFub3RoZXIKKwkJICogcGlwZXMgb3Ig
cGlwZSBjYW4gdXNlIG11bHRpcGxlIGRidWZzLCBpbiBib3RoIGNhc2VzIHdlCisJCSAqIGFjY291
bnQgZm9yIG90aGVyIHBpcGVzIG9ubHkgaWYgdGhleSBoYXZlIGV4YWN0bHkgc2FtZSBtYXNrLgor
CQkgKiBIb3dldmVyIHdlIG5lZWQgdG8gYWNjb3VudCBob3cgbWFueSBzbGljZXMgd2Ugc2hvdWxk
IGVuYWJsZQorCQkgKiBpbiB0b3RhbC4KKwkJICovCisJCXRvdGFsX3NsaWNlX21hc2sgfD0gcGlw
ZV9kYnVmX3NsaWNlX21hc2s7CisKKwkJLyoKKwkJICogRG8gbm90IGFjY291bnQgcGlwZXMgdXNp
bmcgb3RoZXIgc2xpY2Ugc2V0cworCQkgKiBsdWNraWx5IGFzIG9mIGN1cnJlbnQgQlNwZWMgc2xp
Y2Ugc2V0cyBkbyBub3QgcGFydGlhbGx5CisJCSAqIGludGVyc2VjdChwaXBlcyBzaGFyZSBlaXRo
ZXIgc2FtZSBvbmUgc2xpY2Ugb3Igc2FtZSBzbGljZSBzZXQKKwkJICogaS5lIG5vIHBhcnRpYWwg
aW50ZXJzZWN0aW9uKSwgc28gaXQgaXMgZW5vdWdoIHRvIGNoZWNrIGZvcgorCQkgKiBlcXVhbGl0
eSBmb3Igbm93LgorCQkgKi8KKwkJaWYgKGRidWZfc2xpY2VfbWFzayAhPSBwaXBlX2RidWZfc2xp
Y2VfbWFzaykKIAkJCWNvbnRpbnVlOwogCiAJCWRybV9tb2RlX2dldF9odl90aW1pbmcoYWRqdXN0
ZWRfbW9kZSwgJmhkaXNwbGF5LCAmdmRpc3BsYXkpOwpAQCAtMzkxMiw4ICszOTkyLDE5IEBAIHNr
bF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkJcGlwZV93aWR0aCA9IGhkaXNwbGF5OwogCX0KIAotCWFsbG9jLT5zdGFy
dCA9IGRkYl9zaXplICogd2lkdGhfYmVmb3JlX3BpcGUgLyB0b3RhbF93aWR0aDsKLQlhbGxvYy0+
ZW5kID0gZGRiX3NpemUgKiAod2lkdGhfYmVmb3JlX3BpcGUgKyBwaXBlX3dpZHRoKSAvIHRvdGFs
X3dpZHRoOworCWRkYi0+ZW5hYmxlZF9zbGljZXMgPSB0b3RhbF9zbGljZV9tYXNrOworCisJc3Rh
cnQgPSBkZGJfcmFuZ2Vfc2l6ZSAqIHdpZHRoX2JlZm9yZV9waXBlIC8gdG90YWxfd2lkdGg7CisJ
ZW5kID0gZGRiX3JhbmdlX3NpemUgKiAod2lkdGhfYmVmb3JlX3BpcGUgKyBwaXBlX3dpZHRoKSAv
IHRvdGFsX3dpZHRoOworCisJYWxsb2MtPnN0YXJ0ID0gb2Zmc2V0ICsgc3RhcnQ7CisJYWxsb2Mt
PmVuZCA9IG9mZnNldCArIGVuZDsKKworCURSTV9ERUJVR19LTVMoIlBpcGUgJWQgZGRiICVkLSVk
XG4iLCBmb3JfcGlwZSwKKwkJICAgICAgYWxsb2MtPnN0YXJ0LCBhbGxvYy0+ZW5kKTsKKwlEUk1f
REVCVUdfS01TKCJFbmFibGVkIGRkYiBzbGljZXMgbWFzayAleCBudW0gc3VwcG9ydGVkICVkXG4i
LAorCQkgICAgICBkZGItPmVuYWJsZWRfc2xpY2VzLAorCQkgICAgICBJTlRFTF9JTkZPKGRldl9w
cml2KS0+bnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyk7CiB9CiAKIHN0YXRpYyBpbnQgc2tsX2Nv
bXB1dGVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LApAQCAtNDAzNSw2ICs0MTI2LDcgQEAgdm9pZCBza2xfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHN0cnVjdCBza2xfZGRiX3ZhbHVlcyAq
ZGRiIC8qIG91dCAqLykKIHsKIAlkZGItPmVuYWJsZWRfc2xpY2VzID0gaW50ZWxfZW5hYmxlZF9k
YnVmX3NsaWNlc19udW0oZGV2X3ByaXYpOworCURSTV9ERUJVR19LTVMoIkdvdCBodyBkYnVmIHNs
aWNlcyBtYXNrICV4XG4iLCBkZGItPmVuYWJsZWRfc2xpY2VzKTsKIH0KIAogLyoKQEAgLTQwODQs
NiArNDE3NiwxMjEgQEAgc2tsX3BsYW5lX2Rvd25zY2FsZV9hbW91bnQoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJcmV0dXJuIG11bF9maXhlZDE2KGRvd25zY2Fs
ZV93LCBkb3duc2NhbGVfaCk7CiB9CiAKK3N0cnVjdCBkYnVmX3NsaWNlX2NvbmZfZW50cnkgewor
CXUzMiBhY3RpdmVfcGlwZXM7CisJdTMyIGRidWZfbWFza1tJOTE1X01BWF9QSVBFU107Cit9Owor
CisvKgorICogVGFibGUgdGFrZW4gZnJvbSBCc3BlYyAxMjcxNgorICogUGlwZXMgZG8gaGF2ZSBz
b21lIHByZWZlcnJlZCBEQnVmIHNsaWNlIGFmZmluaXR5LAorICogcGx1cyB0aGVyZSBhcmUgc29t
ZSBoYXJkY29kZWQgcmVxdWlyZW1lbnRzIG9uIGhvdworICogdGhvc2Ugc2hvdWxkIGJlIGRpc3Ry
aWJ1dGVkIGZvciBtdWx0aXBpcGUgc2NlbmFyaW9zLgorICogRm9yIG1vcmUgREJ1ZiBzbGljZXMg
YWxnb3JpdGhtIGNhbiBnZXQgZXZlbiBtb3JlIG1lc3N5CisgKiBhbmQgbGVzcyByZWFkYWJsZSwg
c28gZGVjaWRlZCB0byB1c2UgYSB0YWJsZSBhbG1vc3QKKyAqIGFzIGlzIGZyb20gQlNwZWMgaXRz
ZWxmIC0gdGhhdCB3YXkgaXQgaXMgYXQgbGVhc3QgZWFzaWVyCisgKiB0byBjb21wYXJlLCBjaGFu
Z2UgYW5kIGNoZWNrLgorICovCitzdGF0aWMgc3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSBp
Y2xfYWxsb3dlZF9kYnVmc1tdID0geworCXsgQklUKFBJUEVfQSksIHsgREJVRl9TMV9CSVQsIDAs
IDAsIDAgfSB9LAorCXsgQklUKFBJUEVfQiksIHsgMCwgREJVRl9TMV9CSVQsIDAsIDAgfSB9LAor
CXsgQklUKFBJUEVfQyksIHsgMCwgMCwgREJVRl9TMl9CSVQsIDAgfSB9LAorCXsgQklUKFBJUEVf
QSkgfCBCSVQoUElQRV9CKSwgeyBEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQsIDAsIDAgfSB9LAor
CXsgQklUKFBJUEVfQSkgfCBCSVQoUElQRV9DKSwgeyBEQlVGX1MxX0JJVCwgMCwgREJVRl9TMl9C
SVQsIDAgfSB9LAorCXsgQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSwgeyAwLCBEQlVGX1MxX0JJ
VCwgREJVRl9TMl9CSVQsIDAgfSB9LAorCXsgQklUKFBJUEVfQSkgfCBCSVQoUElQRV9CKSB8IEJJ
VChQSVBFX0MpLAorCQl7IERCVUZfUzFfQklULCBEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQsIDAg
fSB9Cit9OworCisvKgorICogVGFibGUgdGFrZW4gZnJvbSBCc3BlYyA0OTI1NQorICogUGlwZXMg
ZG8gaGF2ZSBzb21lIHByZWZlcnJlZCBEQnVmIHNsaWNlIGFmZmluaXR5LAorICogcGx1cyB0aGVy
ZSBhcmUgc29tZSBoYXJkY29kZWQgcmVxdWlyZW1lbnRzIG9uIGhvdworICogdGhvc2Ugc2hvdWxk
IGJlIGRpc3RyaWJ1dGVkIGZvciBtdWx0aXBpcGUgc2NlbmFyaW9zLgorICogRm9yIG1vcmUgREJ1
ZiBzbGljZXMgYWxnb3JpdGhtIGNhbiBnZXQgZXZlbiBtb3JlIG1lc3N5CisgKiBhbmQgbGVzcyBy
ZWFkYWJsZSwgc28gZGVjaWRlZCB0byB1c2UgYSB0YWJsZSBhbG1vc3QKKyAqIGFzIGlzIGZyb20g
QlNwZWMgaXRzZWxmIC0gdGhhdCB3YXkgaXQgaXMgYXQgbGVhc3QgZWFzaWVyCisgKiB0byBjb21w
YXJlLCBjaGFuZ2UgYW5kIGNoZWNrLgorICovCitzdGF0aWMgc3RydWN0IGRidWZfc2xpY2VfY29u
Zl9lbnRyeSB0Z2xfYWxsb3dlZF9kYnVmc1tdID0geworCXsgQklUKFBJUEVfQSksIHsgREJVRl9T
MV9CSVQgfCBEQlVGX1MyX0JJVCwgMCwgMCwgMCB9IH0sCisJeyBCSVQoUElQRV9CKSwgeyAwLCBE
QlVGX1MxX0JJVCB8IERCVUZfUzJfQklULCAwLCAwIH0gfSwKKwl7IEJJVChQSVBFX0MpLCB7IDAs
IDAsIERCVUZfUzFfQklUIHwgREJVRl9TMl9CSVQsIDAgfSB9LAorCXsgQklUKFBJUEVfRCksIHsg
MCwgMCwgMCwgREJVRl9TMV9CSVQgfCBEQlVGX1MyX0JJVCB9IH0sCisJeyBCSVQoUElQRV9BKSB8
IEJJVChQSVBFX0IpLCB7IERCVUZfUzJfQklULCBEQlVGX1MxX0JJVCwgMCwgMCB9IH0sCisJeyBC
SVQoUElQRV9BKSB8IEJJVChQSVBFX0MpLCB7IERCVUZfUzFfQklULCAwLCBEQlVGX1MyX0JJVCwg
MCB9IH0sCisJeyBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0QpLCB7IERCVUZfUzFfQklULCAwLCAw
LCBEQlVGX1MyX0JJVCB9IH0sCisJeyBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpLCB7IDAsIERC
VUZfUzFfQklULCBEQlVGX1MyX0JJVCwgMCB9IH0sCisJeyBCSVQoUElQRV9CKSB8IEJJVChQSVBF
X0QpLCB7IDAsIERCVUZfUzFfQklULCAwLCBEQlVGX1MyX0JJVCB9IH0sCisJeyBCSVQoUElQRV9D
KSB8IEJJVChQSVBFX0QpLCB7IDAsIDAsIERCVUZfUzJfQklULCBEQlVGX1MyX0JJVCB9IH0sCisJ
eyBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQyksCisJCXsgREJVRl9TMV9C
SVQsIERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCwgMCB9IH0sCisJeyBCSVQoUElQRV9BKSB8IEJJ
VChQSVBFX0IpIHwgQklUKFBJUEVfRCksCisJCXsgREJVRl9TMV9CSVQsIERCVUZfUzFfQklULCAw
LCBEQlVGX1MyX0JJVCB9IH0sCisJeyBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0MpIHwgQklUKFBJ
UEVfRCksCisJCXsgREJVRl9TMV9CSVQsIDAsIERCVUZfUzJfQklULCBEQlVGX1MyX0JJVCB9IH0s
CisJeyBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpIHwgQklUKFBJUEVfRCksCisJCXsgMCwgREJV
Rl9TMV9CSVQsIERCVUZfUzJfQklULCBEQlVGX1MyX0JJVCB9IH0sCisJeyBCSVQoUElQRV9BKSB8
IEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSwKKwkJeyBEQlVGX1MxX0JJ
VCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklULCBEQlVGX1MyX0JJVCB9IH0sCit9OworCitzdGF0
aWMgdTMyIGk5MTVfZmluZF9waXBlX2NvbmYoaW50IHBpcGUsCisJCQkgICAgICAgdTMyIGFjdGl2
ZV9waXBlcywKKwkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZGJ1Zl9zbGljZV9jb25mX2VudHJ5ICpk
YnVmX3NsaWNlcywKKwkJCSAgICAgICBpbnQgc2l6ZSkKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9
IDA7IGkgPCBzaXplOyBpKyspIHsKKwkJaWYgKGRidWZfc2xpY2VzW2ldLmFjdGl2ZV9waXBlcyA9
PSBhY3RpdmVfcGlwZXMpCisJCQlyZXR1cm4gZGJ1Zl9zbGljZXNbaV0uZGJ1Zl9tYXNrW3BpcGVd
OworCX0KKwlyZXR1cm4gMDsKK30KKworLyoKKyAqIFRoaXMgZnVuY3Rpb24gZmluZHMgYW4gZW50
cnkgd2l0aCBzYW1lIGVuYWJsZWQgcGlwZSBjb25maWd1cmF0aW9uIGFuZAorICogcmV0dXJucyBj
b3JyZXNwb25kZW50IERCdWYgc2xpY2UgbWFzayBhcyBzdGF0ZWQgaW4gQlNwZWMgZm9yIHBhcnRp
Y3VsYXIKKyAqIHBsYXRmb3JtLgorICovCitzdGF0aWMgdTMyIGljbF9wb3NzaWJsZV9kYnVmX3Ns
aWNlcyhpbnQgcGlwZSwKKwkJCQkgICAgdTMyIGFjdGl2ZV9waXBlcywKKwkJCQkgICAgY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJcmV0dXJuIGk5MTVfZmlu
ZF9waXBlX2NvbmYocGlwZSwgYWN0aXZlX3BpcGVzLAorCQkJCSAgIGljbF9hbGxvd2VkX2RidWZz
LAorCQkJCSAgIEFSUkFZX1NJWkUoaWNsX2FsbG93ZWRfZGJ1ZnMpKTsKK30KKworc3RhdGljIHUz
MiB0Z2xfcG9zc2libGVfZGJ1Zl9zbGljZXMoaW50IHBpcGUsCisJCQkJICAgIHUzMiBhY3RpdmVf
cGlwZXMsCisJCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQoreworCXJldHVybiBpOTE1X2ZpbmRfcGlwZV9jb25mKHBpcGUsIGFjdGl2ZV9waXBlcywKKwkJ
CQkgICB0Z2xfYWxsb3dlZF9kYnVmcywKKwkJCQkgICBBUlJBWV9TSVpFKHRnbF9hbGxvd2VkX2Ri
dWZzKSk7Cit9CisKK3UzMiBpOTE1X3Bvc3NpYmxlX2RidWZfc2xpY2VzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgICAgIGludCBwaXBlLCB1MzIgYWN0aXZlX3BpcGVz
LAorCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7
CisJaWYgKElTX0dFTihkZXZfcHJpdiwgMTEpKQorCQlyZXR1cm4gaWNsX3Bvc3NpYmxlX2RidWZf
c2xpY2VzKHBpcGUsCisJCQkJCQlhY3RpdmVfcGlwZXMsCisJCQkJCQljcnRjX3N0YXRlKTsKKwll
bHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDEyKSkKKwkJcmV0dXJuIHRnbF9wb3NzaWJsZV9kYnVm
X3NsaWNlcyhwaXBlLAorCQkJCQkJYWN0aXZlX3BpcGVzLAorCQkJCQkJY3J0Y19zdGF0ZSk7CisJ
LyoKKwkgKiBGb3IgYW55dGhpbmcgZWxzZSBqdXN0IHJldHVybiBvbmUgc2xpY2UgeWV0LgorCSAq
IFNob3VsZCBiZSBleHRlbmRlZCBmb3Igb3RoZXIgcGxhdGZvcm1zLgorCSAqLworCXJldHVybiBE
QlVGX1MxX0JJVDsKK30KKwogc3RhdGljIHU2NAogc2tsX3BsYW5lX3JlbGF0aXZlX2RhdGFfcmF0
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLS0gCjIuMTcuMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5212C5014E
	for <lists+intel-gfx@lfdr.de>; Mon, 24 Jun 2019 07:45:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EB23F8991C;
	Mon, 24 Jun 2019 05:45:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D4FA0898FD
 for <intel-gfx@lists.freedesktop.org>; Mon, 24 Jun 2019 05:45:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17000422-1500050 
 for multiple; Mon, 24 Jun 2019 06:43:22 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 24 Jun 2019 06:43:15 +0100
Message-Id: <20190624054315.18910-19-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190624054315.18910-1-chris@chris-wilson.co.uk>
References: <20190624054315.18910-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 19/19] drm/i915: Replace struct_mutex for batch
 pool serialisation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3dpdGNoIHRvIHRyYWNraW5nIGFjdGl2aXR5IHZpYSBpOTE1X2FjdGl2ZSBvbiBpbmRpdmlkdWFs
IG5vZGVzLCBvbmx5CmtlZXBpbmcgYSBsaXN0IG9mIHJldGlyZWQgb2JqZWN0cyBpbiB0aGUgY2Fj
aGUsIGFuZCByZWFwaW5nIHRoZSBjYWNoZQp3aGVuIHRoZSBlbmdpbmUgaXRzZWxmIGlkbGVzLgoK
U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgICAgIHwgICAyICst
CiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAgNTggKysr
Ky0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jICAgIHwgICAx
IC0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oICB8ICAgMSAt
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAgICAgICAgfCAgIDQgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oICAgICAgICB8ICAgMSAtCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyAgICAgfCAgMTEgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jICAgICB8ICAgMiArCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jICAgfCAxNjQgKysrKysrKysr
KysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oICAg
fCAgMzQgKysrKwogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbF90eXBlcy5o
IHwgIDI5ICsrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5o
ICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYyAgICAgICAg
IHwgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAgICB8
ICA2OCAtLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5o
ICAgIHwgIDI2IC0tLQogMTUgZmlsZXMgY2hhbmdlZCwgMjc3IGluc2VydGlvbnMoKyksIDEzMyBk
ZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfcG9vbC5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuaAogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sX3R5cGVzLmgKIGRlbGV0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmgKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01h
a2VmaWxlCmluZGV4IDg0YWMwZmQxYjhkMC4uYWQ4YjlmMTg4N2EwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtl
ZmlsZQpAQCAtNzIsNiArNzIsNyBAQCBvYmoteSArPSBndC8KIGd0LXkgKz0gXAogCWd0L2ludGVs
X2JyZWFkY3J1bWJzLm8gXAogCWd0L2ludGVsX2NvbnRleHQubyBcCisJZ3QvaW50ZWxfZW5naW5l
X3Bvb2wubyBcCiAJZ3QvaW50ZWxfZW5naW5lX2NzLm8gXAogCWd0L2ludGVsX2VuZ2luZV9wbS5v
IFwKIAlndC9pbnRlbF9ndC5vIFwKQEAgLTExOCw3ICsxMTksNiBAQCBpOTE1LXkgKz0gXAogCSAg
JChnZW0teSkgXAogCSAgaTkxNV9hY3RpdmUubyBcCiAJICBpOTE1X2NtZF9wYXJzZXIubyBcCi0J
ICBpOTE1X2dlbV9iYXRjaF9wb29sLm8gXAogCSAgaTkxNV9nZW1fZXZpY3QubyBcCiAJICBpOTE1
X2dlbV9mZW5jZV9yZWcubyBcCiAJICBpOTE1X2dlbV9ndHQubyBcCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCA4MGM5YzU3YTMwMmYuLjBl
YTJkNDliYzhiOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhl
Y2J1ZmZlci5jCkBAIC0xNiw2ICsxNiw3IEBACiAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1faW9j
dGxzLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfY29udGV4dC5oIgorI2luY2x1ZGUgImd0L2ludGVs
X2VuZ2luZV9wb29sLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJndC9p
bnRlbF9ndF9wbS5oIgogCkBAIC0xMTQ1LDI1ICsxMTQ2LDI2IEBAIHN0YXRpYyBpbnQgX19yZWxv
Y19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJCQkgICAgIHVuc2lnbmVk
IGludCBsZW4pCiB7CiAJc3RydWN0IHJlbG9jX2NhY2hlICpjYWNoZSA9ICZlYi0+cmVsb2NfY2Fj
aGU7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX3Bvb2xfbm9kZSAqcG9vbDsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlzdHJ1Y3Qg
aTkxNV92bWEgKmJhdGNoOwogCXUzMiAqY21kOwogCWludCBlcnI7CiAKLQlvYmogPSBpOTE1X2dl
bV9iYXRjaF9wb29sX2dldCgmZWItPmVuZ2luZS0+YmF0Y2hfcG9vbCwgUEFHRV9TSVpFKTsKLQlp
ZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBQVFJfRVJSKG9iaik7CisJcG9vbCA9IGludGVsX2Vu
Z2luZV9wb29sX2dldCgmZWItPmVuZ2luZS0+cG9vbCwgUEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJS
KHBvb2wpKQorCQlyZXR1cm4gUFRSX0VSUihwb29sKTsKIAotCWNtZCA9IGk5MTVfZ2VtX29iamVj
dF9waW5fbWFwKG9iaiwKKwljbWQgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChwb29sLT5vYmos
CiAJCQkJICAgICAgY2FjaGUtPmhhc19sbGMgPwogCQkJCSAgICAgIEk5MTVfTUFQX0ZPUkNFX1dC
IDoKIAkJCQkgICAgICBJOTE1X01BUF9GT1JDRV9XQyk7Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGlu
X3BhZ2VzKG9iaik7Ci0JaWYgKElTX0VSUihjbWQpKQotCQlyZXR1cm4gUFRSX0VSUihjbWQpOwor
CWlmIChJU19FUlIoY21kKSkgeworCQllcnIgPSBQVFJfRVJSKGNtZCk7CisJCWdvdG8gb3V0X3Bv
b2w7CisJfQogCi0JYmF0Y2ggPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtYS0+dm0sIE5VTEwp
OworCWJhdGNoID0gaTkxNV92bWFfaW5zdGFuY2UocG9vbC0+b2JqLCB2bWEtPnZtLCBOVUxMKTsK
IAlpZiAoSVNfRVJSKGJhdGNoKSkgewogCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKIAkJZ290byBl
cnJfdW5tYXA7CkBAIC0xMTc5LDYgKzExODEsMTAgQEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9h
bGxvYyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJZ290byBlcnJfdW5waW47CiAJfQog
CisJZXJyID0gaW50ZWxfZW5naW5lX3Bvb2xfbWFya19hY3RpdmUocG9vbCwgcnEpOworCWlmIChl
cnIpCisJCWdvdG8gZXJyX3JlcXVlc3Q7CisKIAllcnIgPSByZWxvY19tb3ZlX3RvX2dwdShycSwg
dm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9yZXF1ZXN0OwpAQCAtMTIwNCw3ICsxMjEwLDcg
QEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICpl
YiwKIAljYWNoZS0+cnFfc2l6ZSA9IDA7CiAKIAkvKiBSZXR1cm4gd2l0aCBiYXRjaCBtYXBwaW5n
IChjbWQpIHN0aWxsIHBpbm5lZCAqLwotCXJldHVybiAwOworCWdvdG8gb3V0X3Bvb2w7CiAKIHNr
aXBfcmVxdWVzdDoKIAlpOTE1X3JlcXVlc3Rfc2tpcChycSwgZXJyKTsKQEAgLTEyMTMsNyArMTIx
OSw5IEBAIHN0YXRpYyBpbnQgX19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZl
ciAqZWIsCiBlcnJfdW5waW46CiAJaTkxNV92bWFfdW5waW4oYmF0Y2gpOwogZXJyX3VubWFwOgot
CWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5f
bWFwKHBvb2wtPm9iaik7CitvdXRfcG9vbDoKKwlpbnRlbF9lbmdpbmVfcG9vbF9wdXQocG9vbCk7
CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTk1NywxOCArMTk2NSwxNyBAQCBzdGF0aWMgaW50IGk5
MTVfcmVzZXRfZ2VuN19zb2xfb2Zmc2V0cyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogc3Rh
dGljIHN0cnVjdCBpOTE1X3ZtYSAqZWJfcGFyc2Uoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIs
IGJvb2wgaXNfbWFzdGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpzaGFkb3df
YmF0Y2hfb2JqOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpwb29sOwogCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQlzaGFkb3dfYmF0Y2hfb2JqID0gaTkxNV9n
ZW1fYmF0Y2hfcG9vbF9nZXQoJmViLT5lbmdpbmUtPmJhdGNoX3Bvb2wsCi0JCQkJCQkgICBQQUdF
X0FMSUdOKGViLT5iYXRjaF9sZW4pKTsKLQlpZiAoSVNfRVJSKHNoYWRvd19iYXRjaF9vYmopKQot
CQlyZXR1cm4gRVJSX0NBU1Qoc2hhZG93X2JhdGNoX29iaik7CisJcG9vbCA9IGludGVsX2VuZ2lu
ZV9wb29sX2dldCgmZWItPmVuZ2luZS0+cG9vbCwgZWItPmJhdGNoX2xlbik7CisJaWYgKElTX0VS
Uihwb29sKSkKKwkJcmV0dXJuIEVSUl9DQVNUKHBvb2wpOwogCiAJZXJyID0gaW50ZWxfZW5naW5l
X2NtZF9wYXJzZXIoZWItPmVuZ2luZSwKIAkJCQkgICAgICBlYi0+YmF0Y2gtPm9iaiwKLQkJCQkg
ICAgICBzaGFkb3dfYmF0Y2hfb2JqLAorCQkJCSAgICAgIHBvb2wtPm9iaiwKIAkJCQkgICAgICBl
Yi0+YmF0Y2hfc3RhcnRfb2Zmc2V0LAogCQkJCSAgICAgIGViLT5iYXRjaF9sZW4sCiAJCQkJICAg
ICAgaXNfbWFzdGVyKTsKQEAgLTE5NzcsMTIgKzE5ODQsMTIgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3ZtYSAqZWJfcGFyc2Uoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIGJvb2wgaXNfbWFzdGVy
KQogCQkJdm1hID0gTlVMTDsKIAkJZWxzZQogCQkJdm1hID0gRVJSX1BUUihlcnIpOwotCQlnb3Rv
IG91dDsKKwkJZ290byBlcnI7CiAJfQogCi0Jdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGlu
KHNoYWRvd19iYXRjaF9vYmosIE5VTEwsIDAsIDAsIDApOworCXZtYSA9IGk5MTVfZ2VtX29iamVj
dF9nZ3R0X3Bpbihwb29sLT5vYmosIE5VTEwsIDAsIDAsIDApOwogCWlmIChJU19FUlIodm1hKSkK
LQkJZ290byBvdXQ7CisJCWdvdG8gZXJyOwogCiAJZWItPnZtYVtlYi0+YnVmZmVyX2NvdW50XSA9
IGk5MTVfdm1hX2dldCh2bWEpOwogCWViLT5mbGFnc1tlYi0+YnVmZmVyX2NvdW50XSA9CkBAIC0x
OTkwLDggKzE5OTcsMTEgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqZWJfcGFyc2Uoc3RydWN0
IGk5MTVfZXhlY2J1ZmZlciAqZWIsIGJvb2wgaXNfbWFzdGVyKQogCXZtYS0+ZXhlY19mbGFncyA9
ICZlYi0+ZmxhZ3NbZWItPmJ1ZmZlcl9jb3VudF07CiAJZWItPmJ1ZmZlcl9jb3VudCsrOwogCi1v
dXQ6Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKHNoYWRvd19iYXRjaF9vYmopOworCXZt
YS0+cHJpdmF0ZSA9IHBvb2w7CisJcmV0dXJuIHZtYTsKKworZXJyOgorCWludGVsX2VuZ2luZV9w
b29sX3B1dChwb29sKTsKIAlyZXR1cm4gdm1hOwogfQogCkBAIC0yNjE1LDYgKzI2MjUsOCBAQCBp
OTE1X2dlbV9kb19leGVjYnVmZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJICogdG8gZXhw
bGljaXRseSBob2xkIGFub3RoZXIgcmVmZXJlbmNlIGhlcmUuCiAJICovCiAJZWIucmVxdWVzdC0+
YmF0Y2ggPSBlYi5iYXRjaDsKKwlpZiAoZWIuYmF0Y2gtPnByaXZhdGUpCisJCWludGVsX2VuZ2lu
ZV9wb29sX21hcmtfYWN0aXZlKGViLmJhdGNoLT5wcml2YXRlLCBlYi5yZXF1ZXN0KTsKIAogCXRy
YWNlX2k5MTVfcmVxdWVzdF9xdWV1ZShlYi5yZXF1ZXN0LCBlYi5iYXRjaF9mbGFncyk7CiAJZXJy
ID0gZWJfc3VibWl0KCZlYik7CkBAIC0yNjM5LDYgKzI2NTEsOCBAQCBpOTE1X2dlbV9kb19leGVj
YnVmZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiBlcnJfYmF0Y2hfdW5waW46CiAJaWYgKGVi
LmJhdGNoX2ZsYWdzICYgSTkxNV9ESVNQQVRDSF9TRUNVUkUpCiAJCWk5MTVfdm1hX3VucGluKGVi
LmJhdGNoKTsKKwlpZiAoZWIuYmF0Y2gtPnByaXZhdGUpCisJCWludGVsX2VuZ2luZV9wb29sX3B1
dChlYi5iYXRjaC0+cHJpdmF0ZSk7CiBlcnJfdm1hOgogCWlmIChlYi5leGVjKQogCQllYl9yZWxl
YXNlX3ZtYXMoJmViKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3Qu
YwppbmRleCA0MzE5NGZiY2JjMmUuLjMyNjAzNzdhYzAyMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtNjQsNyArNjQsNiBAQCB2b2lkIGk5MTVfZ2Vt
X29iamVjdF9pbml0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJSU5JVF9MSVNU
X0hFQUQoJm9iai0+dm1hLmxpc3QpOwogCiAJSU5JVF9MSVNUX0hFQUQoJm9iai0+bHV0X2xpc3Qp
OwotCUlOSVRfTElTVF9IRUFEKCZvYmotPmJhdGNoX3Bvb2xfbGluayk7CiAKIAlpbml0X3JjdV9o
ZWFkKCZvYmotPnJjdSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3RfdHlwZXMuaAppbmRleCAzNGI1MWZhZDAyZGUuLmQ0NzRjNmFjNDEwMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAt
MTE0LDcgKzExNCw2IEBAIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0IHsKIAl1bnNpZ25lZCBp
bnQgdXNlcmZhdWx0X2NvdW50OwogCXN0cnVjdCBsaXN0X2hlYWQgdXNlcmZhdWx0X2xpbms7CiAK
LQlzdHJ1Y3QgbGlzdF9oZWFkIGJhdGNoX3Bvb2xfbGluazsKIAlJOTE1X1NFTEZURVNUX0RFQ0xB
UkUoc3RydWN0IGxpc3RfaGVhZCBzdF9saW5rKTsKIAogCS8qCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9wbS5jCmluZGV4IDkzZDE4ODUyNjQ1Ny4uYmYwODViMGNiN2M2IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtMzMsMTAgKzMzLDggQEAgc3RhdGlj
IHZvaWQgaTkxNV9nZW1fcGFyayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0JZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1
LCBpZCkKIAkJY2FsbF9pZGxlX2JhcnJpZXJzKGVuZ2luZSk7IC8qIGNsZWFudXAgYWZ0ZXIgd2Vk
Z2luZyAqLwotCQlpOTE1X2dlbV9iYXRjaF9wb29sX2ZpbmkoJmVuZ2luZS0+YmF0Y2hfcG9vbCk7
Ci0JfQogCiAJaTkxNV92bWFfcGFya2VkKGk5MTUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZS5oCmluZGV4IDU1N2IwOGIxM2ZlYi4uNjM3NWQ2MTExYjE1IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaApAQCAtOSw3ICs5LDYgQEAKICNpbmNsdWRlIDxs
aW51eC9yYW5kb20uaD4KICNpbmNsdWRlIDxsaW51eC9zZXFsb2NrLmg+CiAKLSNpbmNsdWRlICJp
OTE1X2dlbV9iYXRjaF9wb29sLmgiCiAjaW5jbHVkZSAiaTkxNV9wbXUuaCIKICNpbmNsdWRlICJp
OTE1X3JlZy5oIgogI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCBiMjdmYzU1NWZlMDkuLjQ5NDM5Y2YyZmQxZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTMyLDYgKzMy
LDcgQEAKIAogI2luY2x1ZGUgImludGVsX2VuZ2luZS5oIgogI2luY2x1ZGUgImludGVsX2VuZ2lu
ZV9wbS5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wb29sLmgiCiAjaW5jbHVkZSAiaW50ZWxf
Y29udGV4dC5oIgogI2luY2x1ZGUgImludGVsX2xyYy5oIgogI2luY2x1ZGUgImludGVsX3Jlc2V0
LmgiCkBAIC00OTgsMTEgKzQ5OSw2IEBAIGludCBpbnRlbF9lbmdpbmVzX2luaXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIHZvaWQgaW50
ZWxfZW5naW5lX2luaXRfYmF0Y2hfcG9vbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
Ci17Ci0JaTkxNV9nZW1fYmF0Y2hfcG9vbF9pbml0KCZlbmdpbmUtPmJhdGNoX3Bvb2wsIGVuZ2lu
ZSk7Ci19Ci0KIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfZXhlY2xpc3RzKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNv
bnN0IGV4ZWNsaXN0cyA9ICZlbmdpbmUtPmV4ZWNsaXN0czsKQEAgLTYyOCwxMCArNjI0LDExIEBA
IHN0YXRpYyBpbnQgaW50ZWxfZW5naW5lX3NldHVwX2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiAJaW50ZWxfZW5naW5lX2luaXRfYnJlYWRjcnVtYnMoZW5naW5lKTsKIAlp
bnRlbF9lbmdpbmVfaW5pdF9leGVjbGlzdHMoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfaW5pdF9o
YW5nY2hlY2soZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVfaW5pdF9iYXRjaF9wb29sKGVuZ2luZSk7
CiAJaW50ZWxfZW5naW5lX2luaXRfY21kX3BhcnNlcihlbmdpbmUpOwogCWludGVsX2VuZ2luZV9p
bml0X19wbShlbmdpbmUpOwogCisJaW50ZWxfZW5naW5lX3Bvb2xfaW5pdCgmZW5naW5lLT5wb29s
KTsKKwogCS8qIFVzZSB0aGUgd2hvbGUgZGV2aWNlIGJ5IGRlZmF1bHQgKi8KIAllbmdpbmUtPnNz
ZXUgPQogCQlpbnRlbF9zc2V1X2Zyb21fZGV2aWNlX2luZm8oJlJVTlRJTUVfSU5GTyhlbmdpbmUt
Pmk5MTUpLT5zc2V1KTsKQEAgLTg4MCw5ICs4NzcsOSBAQCB2b2lkIGludGVsX2VuZ2luZV9jbGVh
bnVwX2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAljbGVhbnVwX3N0
YXR1c19wYWdlKGVuZ2luZSk7CiAKKwlpbnRlbF9lbmdpbmVfcG9vbF9maW5pKCZlbmdpbmUtPnBv
b2wpOwogCWludGVsX2VuZ2luZV9maW5pX2JyZWFkY3J1bWJzKGVuZ2luZSk7CiAJaW50ZWxfZW5n
aW5lX2NsZWFudXBfY21kX3BhcnNlcihlbmdpbmUpOwotCWk5MTVfZ2VtX2JhdGNoX3Bvb2xfZmlu
aSgmZW5naW5lLT5iYXRjaF9wb29sKTsKIAogCWlmIChlbmdpbmUtPmRlZmF1bHRfc3RhdGUpCiAJ
CWk5MTVfZ2VtX29iamVjdF9wdXQoZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXggOTc1MWEwMmQ4NmJjLi5mZTlmOWVh
ZmZlODggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9w
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCkBAIC03
LDYgKzcsNyBAQAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAKICNpbmNsdWRlICJpbnRlbF9lbmdp
bmUuaCIKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG9vbC5oIgogI2luY2x1ZGUgImludGVsX2Vu
Z2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0X3BtLmgiCiAKQEAgLTExNiw2ICsxMTcsNyBA
QCBzdGF0aWMgaW50IF9fZW5naW5lX3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCUdF
TV9UUkFDRSgiJXNcbiIsIGVuZ2luZS0+bmFtZSk7CiAKIAlpbnRlbF9lbmdpbmVfZGlzYXJtX2Jy
ZWFkY3J1bWJzKGVuZ2luZSk7CisJaW50ZWxfZW5naW5lX3Bvb2xfcGFyaygmZW5naW5lLT5wb29s
KTsKIAogCS8qIE11c3QgYmUgcmVzZXQgdXBvbiBpZGxpbmcsIG9yIHdlIG1heSBtaXNzIHRoZSBi
dXN5IHdha2V1cC4gKi8KIAlHRU1fQlVHX09OKGVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9y
aXR5X2hpbnQgIT0gSU5UX01JTik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3Bvb2wuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmRhYzVk
ODdiNDBlYgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2VuZ2luZV9wb29sLmMKQEAgLTAsMCArMSwxNjQgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRl
bnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTQtMjAxOCBJbnRlbCBDb3Jwb3Jh
dGlvbgorICovCisKKyNpbmNsdWRlICJnZW0vaTkxNV9nZW1fb2JqZWN0LmgiCisKKyNpbmNsdWRl
ICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgorI2luY2x1ZGUgImlu
dGVsX2VuZ2luZV9wb29sLmgiCisKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICp0b19l
bmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sKQoreworCXJldHVybiBjb250YWlu
ZXJfb2YocG9vbCwgc3RydWN0IGludGVsX2VuZ2luZV9jcywgcG9vbCk7Cit9CisKK3N0YXRpYyBz
dHJ1Y3QgbGlzdF9oZWFkICoKK2J1Y2tldF9mb3Jfc2l6ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bv
b2wgKnBvb2wsIHNpemVfdCBzeikKK3sKKwlpbnQgbjsKKworCS8qCisJICogQ29tcHV0ZSBhIHBv
d2VyLW9mLXR3byBidWNrZXQsIGJ1dCB0aHJvdyBldmVyeXRoaW5nIGdyZWF0ZXIgdGhhbgorCSAq
IDE2S2lCIGludG8gdGhlIHNhbWUgYnVja2V0OiBpLmUuIHRoZSB0aGUgYnVja2V0cyBob2xkIG9i
amVjdHMgb2YKKwkgKiAoMSBwYWdlLCAyIHBhZ2VzLCA0IHBhZ2VzLCA4KyBwYWdlcykuCisJICov
CisJbiA9IGZscyhzeiA+PiBQQUdFX1NISUZUKSAtIDE7CisJaWYgKG4gPj0gQVJSQVlfU0laRShw
b29sLT5jYWNoZV9saXN0KSkKKwkJbiA9IEFSUkFZX1NJWkUocG9vbC0+Y2FjaGVfbGlzdCkgLSAx
OworCisJcmV0dXJuICZwb29sLT5jYWNoZV9saXN0W25dOworfQorCitzdGF0aWMgdm9pZCBub2Rl
X2ZyZWUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUgKm5vZGUpCit7CisJaTkxNV9nZW1f
b2JqZWN0X3B1dChub2RlLT5vYmopOworCWtmcmVlKG5vZGUpOworfQorCitzdGF0aWMgaW50IHBv
b2xfYWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQoreworCXN0cnVjdCBpbnRlbF9lbmdp
bmVfcG9vbF9ub2RlICpub2RlID0KKwkJY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpub2RlKSwg
YWN0aXZlKTsKKwlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gbm9kZS0+b2JqLT5i
YXNlLnJlc3Y7CisKKwlpZiAocmVzZXJ2YXRpb25fb2JqZWN0X3RyeWxvY2socmVzdikpIHsKKwkJ
cmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2ZlbmNlKHJlc3YsIE5VTEwpOworCQlyZXNlcnZh
dGlvbl9vYmplY3RfdW5sb2NrKHJlc3YpOworCX0KKworCXJldHVybiBpOTE1X2dlbV9vYmplY3Rf
cGluX3BhZ2VzKG5vZGUtPm9iaik7Cit9CisKK3N0YXRpYyB2b2lkIHBvb2xfcmV0aXJlKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKQoreworCXN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpu
b2RlID0KKwkJY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpub2RlKSwgYWN0aXZlKTsKKwlzdHJ1
Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wgPSBub2RlLT5wb29sOworCXN0cnVjdCBsaXN0X2hl
YWQgKmxpc3QgPSBidWNrZXRfZm9yX3NpemUocG9vbCwgbm9kZS0+b2JqLT5iYXNlLnNpemUpOwor
CXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlHRU1fQlVHX09OKCFpbnRlbF9lbmdpbmVfcG1faXNf
YXdha2UodG9fZW5naW5lKHBvb2wpKSk7CisKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMo
bm9kZS0+b2JqKTsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZwb29sLT5sb2NrLCBmbGFncyk7CisJ
bGlzdF9hZGQoJm5vZGUtPmxpbmssIGxpc3QpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBv
b2wtPmxvY2ssIGZsYWdzKTsKK30KKworc3RhdGljIHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9u
b2RlICoKK25vZGVfY3JlYXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCwgc2l6ZV90
IHN6KQoreworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IHRvX2VuZ2luZShwb29s
KTsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqbm9kZTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOworCisJbm9kZSA9IGttYWxsb2Moc2l6ZW9mKCpub2RlKSwKKwkJ
ICAgICAgIEdGUF9LRVJORUwgfCBfX0dGUF9SRVRSWV9NQVlGQUlMIHwgX19HRlBfTk9XQVJOKTsK
KwlpZiAoIW5vZGUpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCisJbm9kZS0+cG9vbCA9
IHBvb2w7CisJaTkxNV9hY3RpdmVfaW5pdChlbmdpbmUtPmk5MTUsICZub2RlLT5hY3RpdmUsIHBv
b2xfYWN0aXZlLCBwb29sX3JldGlyZSk7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRl
X2ludGVybmFsKGVuZ2luZS0+aTkxNSwgc3opOworCWlmIChJU19FUlIob2JqKSkgeworCQlrZnJl
ZShub2RlKTsKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisJfQorCisJbm9kZS0+b2JqID0gb2Jq
OworCXJldHVybiBub2RlOworfQorCitzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqCitp
bnRlbF9lbmdpbmVfcG9vbF9nZXQoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sLCBzaXpl
X3Qgc2l6ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqbm9kZTsKKwlzdHJ1
Y3QgbGlzdF9oZWFkICpsaXN0OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisJaW50IHJldDsKKwor
CUdFTV9CVUdfT04oIWludGVsX2VuZ2luZV9wbV9pc19hd2FrZSh0b19lbmdpbmUocG9vbCkpKTsK
KworCXNpemUgPSBQQUdFX0FMSUdOKHNpemUpOworCWxpc3QgPSBidWNrZXRfZm9yX3NpemUocG9v
bCwgc2l6ZSk7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmcG9vbC0+bG9jaywgZmxhZ3MpOworCWxp
c3RfZm9yX2VhY2hfZW50cnkobm9kZSwgbGlzdCwgbGluaykgeworCQlpZiAobm9kZS0+b2JqLT5i
YXNlLnNpemUgPCBzaXplKQorCQkJY29udGludWU7CisJCWxpc3RfZGVsKCZub2RlLT5saW5rKTsK
KwkJYnJlYWs7CisJfQorCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBvb2wtPmxvY2ssIGZsYWdz
KTsKKworCWlmICgmbm9kZS0+bGluayA9PSBsaXN0KSB7CisJCW5vZGUgPSBub2RlX2NyZWF0ZShw
b29sLCBzaXplKTsKKwkJaWYgKElTX0VSUihub2RlKSkKKwkJCXJldHVybiBub2RlOworCX0KKwor
CXJldCA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJm5vZGUtPmFjdGl2ZSk7CisJaWYgKHJldCkgewor
CQlub2RlX2ZyZWUobm9kZSk7CisJCXJldHVybiBFUlJfUFRSKHJldCk7CisJfQorCisJcmV0dXJu
IG5vZGU7Cit9CisKK3ZvaWQgaW50ZWxfZW5naW5lX3Bvb2xfaW5pdChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX3Bvb2wgKnBvb2wpCit7CisJaW50IG47CisKKwlzcGluX2xvY2tfaW5pdCgmcG9vbC0+bG9j
ayk7CisJZm9yIChuID0gMDsgbiA8IEFSUkFZX1NJWkUocG9vbC0+Y2FjaGVfbGlzdCk7IG4rKykK
KwkJSU5JVF9MSVNUX0hFQUQoJnBvb2wtPmNhY2hlX2xpc3Rbbl0pOworfQorCit2b2lkIGludGVs
X2VuZ2luZV9wb29sX3Bhcmsoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sKQoreworCWlu
dCBuOworCisJZm9yIChuID0gMDsgbiA8IEFSUkFZX1NJWkUocG9vbC0+Y2FjaGVfbGlzdCk7IG4r
KykgeworCQlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0ID0gJnBvb2wtPmNhY2hlX2xpc3Rbbl07CisJ
CXN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpub2RlLCAqbm47CisKKwkJbGlzdF9mb3Jf
ZWFjaF9lbnRyeV9zYWZlKG5vZGUsIG5uLCBsaXN0LCBsaW5rKQorCQkJbm9kZV9mcmVlKG5vZGUp
OworCisJCUlOSVRfTElTVF9IRUFEKGxpc3QpOworCX0KK30KKwordm9pZCBpbnRlbF9lbmdpbmVf
cG9vbF9maW5pKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCkKK3sKKwlpbnQgbjsKKwor
CWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKHBvb2wtPmNhY2hlX2xpc3QpOyBuKyspCisJCUdF
TV9CVUdfT04oIWxpc3RfZW1wdHkoJnBvb2wtPmNhY2hlX2xpc3Rbbl0pKTsKK30KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDAwMDAwMDAwMDAwMC4uZjdhMGE2NjBjMWM5Ci0tLSAvZGV2L251bGwKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuaApAQCAtMCwwICsxLDM0IEBA
CisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDC
qSAyMDE0LTIwMTggSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIElOVEVMX0VOR0lO
RV9QT09MX0gKKyNkZWZpbmUgSU5URUxfRU5HSU5FX1BPT0xfSAorCisjaW5jbHVkZSAiaW50ZWxf
ZW5naW5lX3Bvb2xfdHlwZXMuaCIKKyNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgorI2luY2x1ZGUg
Imk5MTVfcmVxdWVzdC5oIgorCitzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqCitpbnRl
bF9lbmdpbmVfcG9vbF9nZXQoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sLCBzaXplX3Qg
c2l6ZSk7CisKK3N0YXRpYyBpbmxpbmUgaW50CitpbnRlbF9lbmdpbmVfcG9vbF9tYXJrX2FjdGl2
ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqbm9kZSwKKwkJCSAgICAgIHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxKQoreworCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJm5vZGUtPmFjdGl2
ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJxKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkCitpbnRl
bF9lbmdpbmVfcG9vbF9wdXQoc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUgKm5vZGUpCit7
CisJaTkxNV9hY3RpdmVfcmVsZWFzZSgmbm9kZS0+YWN0aXZlKTsKK30KKwordm9pZCBpbnRlbF9l
bmdpbmVfcG9vbF9pbml0KHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCk7Cit2b2lkIGlu
dGVsX2VuZ2luZV9wb29sX3Bhcmsoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sKTsKK3Zv
aWQgaW50ZWxfZW5naW5lX3Bvb2xfZmluaShzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wp
OworCisjZW5kaWYgLyogSU5URUxfRU5HSU5FX1BPT0xfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2xfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sX3R5cGVzLmgKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5lMzFlZTM2MWI3NmYKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbF90eXBlcy5oCkBAIC0wLDAg
KzEsMjkgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29w
eXJpZ2h0IMKpIDIwMTQtMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgSU5U
RUxfRU5HSU5FX1BPT0xfVFlQRVNfSAorI2RlZmluZSBJTlRFTF9FTkdJTkVfUE9PTF9UWVBFU19I
CisKKyNpbmNsdWRlIDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGludXgvc3BpbmxvY2suaD4K
KworI2luY2x1ZGUgImk5MTVfYWN0aXZlX3R5cGVzLmgiCisKK3N0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0OworCitzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgeworCXNwaW5sb2NrX3QgbG9jazsK
KwlzdHJ1Y3QgbGlzdF9oZWFkIGNhY2hlX2xpc3RbNF07Cit9OworCitzdHJ1Y3QgaW50ZWxfZW5n
aW5lX3Bvb2xfbm9kZSB7CisJc3RydWN0IGk5MTVfYWN0aXZlIGFjdGl2ZTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBsaXN0X2hlYWQgbGluazsKKwlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX3Bvb2wgKnBvb2w7Cit9OworCisjZW5kaWYgLyogSU5URUxfRU5HSU5FX1BP
T0xfVFlQRVNfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlw
ZXMuaAppbmRleCAwZGRlN2UwNGIxMDIuLjZkMmYzZTExZGExYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKQEAgLTE2LDEyICsxNiwxMiBAQAogI2lu
Y2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAKICNpbmNsdWRlICJpOTE1X2dlbS5oIgotI2luY2x1ZGUg
Imk5MTVfZ2VtX2JhdGNoX3Bvb2wuaCIKICNpbmNsdWRlICJpOTE1X3BtdS5oIgogI2luY2x1ZGUg
Imk5MTVfcHJpb2xpc3RfdHlwZXMuaCIKICNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCi0jaW5j
bHVkZSAiZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCIKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVf
cG9vbF90eXBlcy5oIgogI2luY2x1ZGUgImludGVsX3NzZXUuaCIKKyNpbmNsdWRlICJpbnRlbF90
aW1lbGluZV90eXBlcy5oIgogI2luY2x1ZGUgImludGVsX3dha2VyZWYuaCIKICNpbmNsdWRlICJp
bnRlbF93b3JrYXJvdW5kc190eXBlcy5oIgogCkBAIC0zNTMsNyArMzUzLDcgQEAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyB7CiAJICogd2hlbiB0aGUgY29tbWFuZCBwYXJzZXIgaXMgZW5hYmxlZC4g
UHJldmVudHMgdGhlIGNsaWVudCBmcm9tCiAJICogbW9kaWZ5aW5nIHRoZSBiYXRjaCBjb250ZW50
cyBhZnRlciBzb2Z0d2FyZSBwYXJzaW5nLgogCSAqLwotCXN0cnVjdCBpOTE1X2dlbV9iYXRjaF9w
b29sIGJhdGNoX3Bvb2w7CisJc3RydWN0IGludGVsX2VuZ2luZV9wb29sIHBvb2w7CiAKIAlzdHJ1
Y3QgaW50ZWxfaHdfc3RhdHVzX3BhZ2Ugc3RhdHVzX3BhZ2U7CiAJc3RydWN0IGk5MTVfY3R4X3dv
cmthcm91bmRzIHdhX2N0eDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21v
Y2tfZW5naW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCmluZGV4
IDViY2I0NjFiODM3Mi4uYjk0ZDU3YmYyYzQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9tb2NrX2VuZ2luZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tf
ZW5naW5lLmMKQEAgLTI3LDYgKzI3LDcgQEAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1
ZGUgImludGVsX2NvbnRleHQuaCIKICNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKKyNpbmNs
dWRlICJpbnRlbF9lbmdpbmVfcG9vbC5oIgogCiAjaW5jbHVkZSAibW9ja19lbmdpbmUuaCIKICNp
bmNsdWRlICJzZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmgiCkBAIC0yOTEsNiArMjkyLDggQEAgaW50
IG1vY2tfZW5naW5lX2luaXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWludGVs
X2VuZ2luZV9pbml0X2V4ZWNsaXN0cyhlbmdpbmUpOwogCWludGVsX2VuZ2luZV9pbml0X19wbShl
bmdpbmUpOwogCisJaW50ZWxfZW5naW5lX3Bvb2xfaW5pdCgmZW5naW5lLT5wb29sKTsKKwogCWVu
Z2luZS0+a2VybmVsX2NvbnRleHQgPQogCQlpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoaTkx
NS0+a2VybmVsX2NvbnRleHQsIGVuZ2luZS0+aWQpOwogCWlmIChJU19FUlIoZW5naW5lLT5rZXJu
ZWxfY29udGV4dCkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IGVlZWNkYWQw
ZTNjYS4uMjUzZTg2ODY4MDYxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAt
Mjk1LDI3ICsyOTUsNiBAQCBzdGF0aWMgaW50IHBlcl9maWxlX3N0YXRzKGludCBpZCwgdm9pZCAq
cHRyLCB2b2lkICpkYXRhKQogCQkJICAgc3RhdHMuY2xvc2VkKTsgXAogfSB3aGlsZSAoMCkKIAot
c3RhdGljIHZvaWQgcHJpbnRfYmF0Y2hfcG9vbF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCi0J
CQkJICAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQotewotCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwot
CXN0cnVjdCBmaWxlX3N0YXRzIHN0YXRzID0ge307Ci0JZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7
Ci0JaW50IGo7Ci0KLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBkZXZfcHJpdiwgaWQpIHsKLQkJ
Zm9yIChqID0gMDsgaiA8IEFSUkFZX1NJWkUoZW5naW5lLT5iYXRjaF9wb29sLmNhY2hlX2xpc3Qp
OyBqKyspIHsKLQkJCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLAotCQkJCQkgICAgJmVuZ2luZS0+
YmF0Y2hfcG9vbC5jYWNoZV9saXN0W2pdLAotCQkJCQkgICAgYmF0Y2hfcG9vbF9saW5rKQotCQkJ
CXBlcl9maWxlX3N0YXRzKDAsIG9iaiwgJnN0YXRzKTsKLQkJfQotCX0KLQotCXByaW50X2ZpbGVf
c3RhdHMobSwgIltrXWJhdGNoIHBvb2wiLCBzdGF0cyk7Ci19Ci0KIHN0YXRpYyB2b2lkIHByaW50
X2NvbnRleHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAogCQkJCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewpAQCAtMzczLDU4ICszNTIsMTIgQEAgc3RhdGljIGludCBpOTE1X2dl
bV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAotCXByaW50X2JhdGNoX3Bvb2xfc3RhdHMobSwgaTkxNSk7CiAJcHJp
bnRfY29udGV4dF9zdGF0cyhtLCBpOTE1KTsKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgaTkxNV9nZW1fYmF0Y2hf
cG9vbF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKLXsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwotCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOwotCWludCB0b3RhbCA9IDA7Ci0JaW50IHJldCwgajsKLQotCXJl
dCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChy
ZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBkZXZfcHJpdiwg
aWQpIHsKLQkJZm9yIChqID0gMDsgaiA8IEFSUkFZX1NJWkUoZW5naW5lLT5iYXRjaF9wb29sLmNh
Y2hlX2xpc3QpOyBqKyspIHsKLQkJCWludCBjb3VudDsKLQotCQkJY291bnQgPSAwOwotCQkJbGlz
dF9mb3JfZWFjaF9lbnRyeShvYmosCi0JCQkJCSAgICAmZW5naW5lLT5iYXRjaF9wb29sLmNhY2hl
X2xpc3Rbal0sCi0JCQkJCSAgICBiYXRjaF9wb29sX2xpbmspCi0JCQkJY291bnQrKzsKLQkJCXNl
cV9wcmludGYobSwgIiVzIGNhY2hlWyVkXTogJWQgb2JqZWN0c1xuIiwKLQkJCQkgICBlbmdpbmUt
Pm5hbWUsIGosIGNvdW50KTsKLQotCQkJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosCi0JCQkJCSAg
ICAmZW5naW5lLT5iYXRjaF9wb29sLmNhY2hlX2xpc3Rbal0sCi0JCQkJCSAgICBiYXRjaF9wb29s
X2xpbmspIHsKLQkJCQlzZXFfcHV0cyhtLCAiICAgIik7Ci0JCQkJZGVzY3JpYmVfb2JqKG0sIG9i
aik7Ci0JCQkJc2VxX3B1dGMobSwgJ1xuJyk7Ci0JCQl9Ci0KLQkJCXRvdGFsICs9IGNvdW50Owot
CQl9Ci0JfQotCi0Jc2VxX3ByaW50ZihtLCAidG90YWw6ICVkXG4iLCB0b3RhbCk7Ci0KLQltdXRl
eF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKLQotCXJldHVybiAwOwotfQotCiBzdGF0aWMg
dm9pZCBnZW44X2Rpc3BsYXlfaW50ZXJydXB0X2luZm8oc3RydWN0IHNlcV9maWxlICptKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2
YXRlKTsKQEAgLTQzNjQsNyArNDI5Nyw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2luZm9f
bGlzdCBpOTE1X2RlYnVnZnNfbGlzdFtdID0gewogCXsiaTkxNV9nZW1fb2JqZWN0cyIsIGk5MTVf
Z2VtX29iamVjdF9pbmZvLCAwfSwKIAl7Imk5MTVfZ2VtX2ZlbmNlX3JlZ3MiLCBpOTE1X2dlbV9m
ZW5jZV9yZWdzX2luZm8sIDB9LAogCXsiaTkxNV9nZW1faW50ZXJydXB0IiwgaTkxNV9pbnRlcnJ1
cHRfaW5mbywgMH0sCi0JeyJpOTE1X2dlbV9iYXRjaF9wb29sIiwgaTkxNV9nZW1fYmF0Y2hfcG9v
bF9pbmZvLCAwfSwKIAl7Imk5MTVfZ3VjX2luZm8iLCBpOTE1X2d1Y19pbmZvLCAwfSwKIAl7Imk5
MTVfZ3VjX2xvYWRfc3RhdHVzIiwgaTkxNV9ndWNfbG9hZF9zdGF0dXNfaW5mbywgMH0sCiAJeyJp
OTE1X2d1Y19sb2dfZHVtcCIsIGk5MTVfZ3VjX2xvZ19kdW1wLCAwfSwKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuaApkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggZmVlZWVlYWE1NGQ4Li4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fYmF0Y2hfcG9vbC5oCisrKyAvZGV2L251bGwKQEAgLTEsMjYgKzAsMCBAQAotLyoK
LSAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKLSAqCi0gKiBDb3B5cmlnaHQgwqkgMjAx
NC0yMDE4IEludGVsIENvcnBvcmF0aW9uCi0gKi8KLQotI2lmbmRlZiBJOTE1X0dFTV9CQVRDSF9Q
T09MX0gKLSNkZWZpbmUgSTkxNV9HRU1fQkFUQ0hfUE9PTF9ICi0KLSNpbmNsdWRlIDxsaW51eC90
eXBlcy5oPgotCi1zdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdDsKLXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3M7Ci0KLXN0cnVjdCBpOTE1X2dlbV9iYXRjaF9wb29sIHsKLQlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGxpc3RfaGVhZCBjYWNoZV9saXN0WzRdOwotfTsKLQot
dm9pZCBpOTE1X2dlbV9iYXRjaF9wb29sX2luaXQoc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wg
KnBvb2wsCi0JCQkgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwotdm9pZCBp
OTE1X2dlbV9iYXRjaF9wb29sX2Zpbmkoc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBvb2wp
Owotc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgotaTkxNV9nZW1fYmF0Y2hfcG9vbF9nZXQo
c3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBvb2wsIHNpemVfdCBzaXplKTsKLQotI2VuZGlm
IC8qIEk5MTVfR0VNX0JBVENIX1BPT0xfSCAqLwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

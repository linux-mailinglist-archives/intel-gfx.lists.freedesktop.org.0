Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1CB411E321D
	for <lists+intel-gfx@lfdr.de>; Wed, 27 May 2020 00:12:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6B38789319;
	Tue, 26 May 2020 22:12:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8E875896ED
 for <intel-gfx@lists.freedesktop.org>; Tue, 26 May 2020 22:12:45 +0000 (UTC)
IronPort-SDR: xL6rG4tCaTcli6tHB/fuVzDwRrtdMoxNh+K7RlOAcrAlVgKhiAjvgX4gBiOKyi4x3iTpJ/hSmr
 vI47Bz6Vy5jg==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by orsmga104.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 26 May 2020 15:12:44 -0700
IronPort-SDR: J1ggYwKEvd5AHMhKvEZ3AdDsphoJ/MfM2EKqjFNi8Vsr8tXAv54YVPsNp4vtmaP17VjjPcA9sR
 PnCjVicI1Y9Q==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,439,1583222400"; d="scan'208";a="310381871"
Received: from josouza-mobl2.jf.intel.com (HELO josouza-MOBL2.intel.com)
 ([10.24.14.40])
 by FMSMGA003.fm.intel.com with ESMTP; 26 May 2020 15:12:44 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 26 May 2020 15:14:46 -0700
Message-Id: <20200526221447.64110-5-jose.souza@intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20200526221447.64110-1-jose.souza@intel.com>
References: <20200526221447.64110-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/6] drm/i915: Implement PSR2 selective fetch
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsIEdFTjEyIHBsYXRmb3JtcyBzdXBwb3J0cyBQU1IyIHNlbGVjdGl2ZSBmZXRjaCBidXQgbm90
IGFsbCBHRU4xMgpwbGF0Zm9ybXMgc3VwcG9ydHMgUFNSMiBoYXJkd2FyZSB0cmFja2luZyhha2Eg
UktMKS4KClRoaXMgZmVhdHVyZSBjb25zaXN0cyBpbiBzb2Z0d2FyZSBwcm9ncmFtIHJlZ2lzdGVy
cyB3aXRoIHRoZSBkYW1hZ2VkCmFyZWEgb2YgZWFjaCBwbGFuZSB0aGlzIHdheSBoYXJkd2FyZSB3
aWxsIG9ubHkgZmV0Y2ggZnJvbSBtZW1vcnkgdGhvc2UKYXJlYXMgYW5kIHNlbnQgdGhlIFBTUjIg
c2VsZWN0aXZlIHVwZGF0ZSBibG9ja3MgdG8gcGFuZWwsIHNhdmluZyBldmVuCm1vcmUgcG93ZXIg
YnV0IHRvIGl0IGFjdHVhbGx5IGhhcHBlbiB1c2Vyc3BhY2UgbmVlZHMgdG8gc2VuZCB0aGUKZGFt
YWdlZCBhcmVhcyBvdGhlcndpc2UgaXQgd2lsbCBzdGlsbCBmZXRjaCB0aGUgd2hvbGUgcGxhbmUg
YXMKZmFsbGJhY2suCkFzIHRvZGF5IEdub21lMyBkbyBub3Qgc2VuZCBkYW1hZ2VkIGFyZWFzIGFu
ZCB0aGUgb25seSBjb21wb3NpdG9yIHRoYXQKSSdtIGF3YXJlIHRoYXQgc2V0cyB0aGUgZGFtYWdl
ZCBhcmVhcyBpcyBXZXN0b24uCmh0dHBzOi8vZ2l0bGFiLmZyZWVkZXNrdG9wLm9yZy93YXlsYW5k
L3dlc3Rvbi8tL21lcmdlX3JlcXVlc3RzLzE3CgpTbyBoZXJlIGltcGxlbWVudGluZyBwYWdlIGZs
aXAgcGFydCwgaXQgaXMgc3RpbGwgY29tcGxldGVseSBtaXNzaW5nCmZyb250YnVmZmVyIG1vZGlm
aWNhdGlvbnMsIHRoYXQgaXMgd2h5IHRoZSBlbmFibGVfcHNyMl9zZWxfZmV0Y2gKcGFyYW1ldGVy
IHdhcyBhZGRlZC4KClRoZSBwbGFuIGlzIHRvIHN3aXRjaCBhbGwgR0VOMTIgcGxhdGZvcm1zIHRv
IHNlbGVjdGl2ZSBmZXRjaCB3aGVuCnJlYWR5LCBpdCB3aWxsIGFsc28gZGVwZW5kIGluIGFkZCBz
b21lIHRlc3RzIHNlbmRpbmcgZGFtYWdlZCBhcmVhcy4KSSBoYXZlIGEgaGFja2VkIHZlcnNpb24g
b2Yga21zX3BzcjJfc3Ugd2l0aCAzIHBsYW5lcyB0aGF0IEkgY2FuCmNsZWFudXAgYW5kIHNlbmQg
aW4gYSBmZXcgZGF5cyg5OSUgb2YgUFNSMiBzZWxlY3RpdmUgZmV0Y2ggY2hhbmdlcyB3YXMKZG9u
ZSBkdXJpbmcgbXkgZnJlZSB0aW1lIHdoaWxlIGJvcmVkIGR1cmluZyBxdWFyYW50aW5lIHJhaW55
IGRheXMpLgoKQlNwZWM6IDU1MjI5CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFA
bGludXguaW50ZWwuY29tPgpDYzogSW1yZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29tPgpDYzog
R3dhbi1neWVvbmcgTXVuIDxnd2FuLWd5ZW9uZy5tdW5AaW50ZWwuY29tPgpDYzogUm9kcmlnbyBW
aXZpIDxyb2RyaWdvLnZpdmlAaW50ZWwuY29tPgpDYzogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhp
bmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8g
ZGUgU291emEgPGpvc2Uuc291emFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAgNSArCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5X2RlYnVnZnMuYyAgfCAgIDMgKwogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV90eXBlcy5oICAgIHwgIDEwICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfcHNyLmMgICAgICB8IDMyOSArKysrKysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmggICAgICB8ICAxMCArCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGFyYW1zLmMgICAgICAgICAgICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BhcmFtcy5oICAgICAgICAgICAgfCAgIDEgKwogOSBmaWxlcyBjaGFuZ2VkLCAzNTIg
aW5zZXJ0aW9ucygrKSwgMTUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBiNjk4NzgzMzQwNDAuLjk4NDgwOTIwOGMyOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTEx
NzI5LDYgKzExNzI5LDggQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfY3Vyc29yKHN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKIAkJc2ts
X3dyaXRlX2N1cnNvcl93bShwbGFuZSwgY3J0Y19zdGF0ZSk7CiAKKwlpbnRlbF9wc3IyX3Byb2dy
YW1fcGxhbmVfc2VsX2ZldGNoKHBsYW5lLCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisKIAlp
ZiAocGxhbmUtPmN1cnNvci5iYXNlICE9IGJhc2UgfHwKIAkgICAgcGxhbmUtPmN1cnNvci5zaXpl
ICE9IGZiY19jdGwgfHwKIAkgICAgcGxhbmUtPmN1cnNvci5jbnRsICE9IGNudGwpIHsKQEAgLTE1
MTE1LDYgKzE1MTE3LDggQEAgc3RhdGljIHZvaWQgY29tbWl0X3BpcGVfY29uZmlnKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCiAJCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRl
X3BpcGUpCiAJCQlpbnRlbF9waXBlX2Zhc3RzZXQob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0
YXRlKTsKKworCQlpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19jdGwobmV3X2NydGNf
c3RhdGUpOwogCX0KIAogCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5hdG9taWNfdXBkYXRlX3dhdGVy
bWFya3MpCkBAIC0xNTE1Niw2ICsxNTE2MCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3VwZGF0ZV9j
cnRjKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJaW50ZWxfY29sb3JfbG9h
ZF9sdXRzKG5ld19jcnRjX3N0YXRlKTsKIAogCQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0YXRl
LCBjcnRjKTsKKwkJaW50ZWxfcHNyMl9zZWxfZmV0Y2hfdXBkYXRlKHN0YXRlLCBjcnRjKTsKIAog
CQlpZiAobmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9waXBlKQogCQkJaW50ZWxfZW5jb2RlcnNfdXBk
YXRlX3BpcGUoc3RhdGUsIGNydGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMKaW5kZXggNzA1MjU2MjNiY2RmLi4wZjYwMDk3
NDQ2MmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X2RlYnVnZnMuYwpAQCAtNDE3LDYgKzQxNyw5IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBf
cHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJCQlzdV9ibG9ja3Mg
PSBzdV9ibG9ja3MgPj4gUFNSMl9TVV9TVEFUVVNfU0hJRlQoZnJhbWUpOwogCQkJc2VxX3ByaW50
ZihtLCAiJWRcdCVkXG4iLCBmcmFtZSwgc3VfYmxvY2tzKTsKIAkJfQorCisJCXNlcV9wcmludGYo
bSwgIlBTUjIgc2VsZWN0aXZlIGZldGNoOiAlc1xuIiwKKwkJCSAgIGVuYWJsZWRkaXNhYmxlZChw
c3ItPnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQpKTsKIAl9CiAKIHVubG9jazoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggMzBi
Mjc2NzU3OGRjLi5iNzdhNTEyZTUzNjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC01ODYsNiArNTg2LDEzIEBAIHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSB7CiAJdTMyIHBsYW5hcl9zbGF2ZTsKIAogCXN0cnVjdCBkcm1f
aW50ZWxfc3ByaXRlX2NvbG9ya2V5IGNrZXk7CisKKwlzdHJ1Y3QgeworCQl1MzIgY3RsOworCQl1
MzIgcG9zOworCQl1MzIgb2Zmc2V0OworCQl1MzIgc2l6ZTsKKwl9IHBzcjJfc2VsX2ZldGNoOwog
fTsKIAogc3RydWN0IGludGVsX2luaXRpYWxfcGxhbmVfY29uZmlnIHsKQEAgLTkzMSw2ICs5Mzgs
NyBAQCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSB7CiAKIAlib29sIGhhc19wc3I7CiAJYm9vbCBo
YXNfcHNyMjsKKwlib29sIGVuYWJsZV9wc3IyX3NlbF9mZXRjaDsKIAl1MzIgZGMzY29fZXhpdGxp
bmU7CiAKIAkvKgpAQCAtMTA3MCw2ICsxMDc4LDggQEAgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
ewogCiAJLyogRm9yIERTQiByZWxhdGVkIGluZm8gKi8KIAlzdHJ1Y3QgaW50ZWxfZHNiICpkc2I7
CisKKwl1MzIgcHNyMl9zd19tYW5fdHJhY2tfY3RsOwogfTsKIAogZW51bSBpbnRlbF9waXBlX2Ny
Y19zb3VyY2UgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKaW5kZXgg
MGM4NmU5ZTM0MWEyLi5iYzJhMmU2NGZlMmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9wc3IuYwpAQCAtNTE4LDYgKzUxOCwxNCBAQCBzdGF0aWMgdm9pZCBoc3dfYWN0aXZh
dGVfcHNyMihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCWVsc2UKIAkJdmFsIHw9IEVEUF9Q
U1IyX1RQMl9USU1FXzI1MDB1czsKIAorCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNo
X2VuYWJsZWQpCisJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LAorCQkJICAgICAgIFBTUjJfTUFO
X1RSS19DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwKKwkJCSAgICAgICBQU1IyX01BTl9U
UktfQ1RMX0VOQUJMRSk7CisJZWxzZSBpZiAoSEFTX1BTUjJfU0VMX0ZFVENIKGRldl9wcml2KSkK
KwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCisJCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChk
ZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLCAwKTsKKwogCS8qCiAJICogUFNSMiBIVyBpcyBpbmNv
cnJlY3RseSB1c2luZyBFRFBfUFNSX1RQMV9UUDNfU0VMIGFuZCBCU3BlYyBpcwogCSAqIHJlY29t
bWVuZGluZyBrZWVwIHRoaXMgYml0IHVuc2V0IHdoaWxlIFBTUjIgaXMgZW5hYmxlZC4KQEAgLTYy
OCw2ICs2MzYsMzggQEAgdGdsX2RjM2NvX2V4aXRsaW5lX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAsCiAJY3J0Y19zdGF0ZS0+ZGMzY29fZXhpdGxpbmUgPSBjcnRjX3Zk
aXNwbGF5IC0gZXhpdF9zY2FubGluZXM7CiB9CiAKK3N0YXRpYyBib29sIGludGVsX3BzcjJfc2Vs
X2ZldGNoX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCQkgICAg
ICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT51
YXBpLnN0YXRlKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19p
OTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOwor
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CisJaW50IGk7CisKKwlpZiAoIWk5MTVfbW9kcGFy
YW1zLmVuYWJsZV9wc3IyX3NlbF9mZXRjaCkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwKKwkJCSAgICAiUFNSMiBzZWwgZmV0Y2ggbm90IGVuYWJsZWQsIGRpc2FibGVkIGJ5IHBhcmFt
ZXRlclxuIik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlpZiAoY3J0Y19zdGF0ZS0+dWFwaS5h
c3luY19mbGlwKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJQU1Iy
IHNlbCBmZXRjaCBub3QgZW5hYmxlZCwgYXN5bmMgZmxpcCBlbmFibGVkXG4iKTsKKwkJcmV0dXJu
IGZhbHNlOworCX0KKworCWZvcl9lYWNoX25ld19pbnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwg
cGxhbmUsIHBsYW5lX3N0YXRlLCBpKSB7CisJCWlmIChwbGFuZV9zdGF0ZS0+dWFwaS5yb3RhdGlv
biAhPSBEUk1fTU9ERV9ST1RBVEVfMCkgeworCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJCQkJICAgICJQU1IyIHNlbCBmZXRjaCBub3QgZW5hYmxlZCwgcGxhbmUgcm90YXRlZFxuIik7
CisJCQlyZXR1cm4gZmFsc2U7CisJCX0KKwl9CisKKwlyZXR1cm4gY3J0Y19zdGF0ZS0+ZW5hYmxl
X3BzcjJfc2VsX2ZldGNoID0gdHJ1ZTsKK30KKwogc3RhdGljIGJvb2wgaW50ZWxfcHNyMl9jb25m
aWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CkBAIC02OTcsMjIgKzczNywxNyBAQCBzdGF0aWMg
Ym9vbCBpbnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
CQlyZXR1cm4gZmFsc2U7CiAJfQogCi0JLyoKLQkgKiBTb21lIHBsYXRmb3JtcyBsYWNrIFBTUjIg
SFcgdHJhY2tpbmcgYW5kIGluc3RlYWQgcmVxdWlyZSBtYW51YWwKLQkgKiB0cmFja2luZyBieSBz
b2Z0d2FyZS4gIEluIHRoaXMgY2FzZSwgdGhlIGRyaXZlciBpcyByZXF1aXJlZCB0byB0cmFjawot
CSAqIHRoZSBhcmVhcyB0aGF0IG5lZWQgdXBkYXRlcyBhbmQgcHJvZ3JhbSBoYXJkd2FyZSB0byBz
ZW5kIHNlbGVjdGl2ZQotCSAqIHVwZGF0ZXMuCi0JICoKLQkgKiBTbyB1bnRpbCB0aGUgc29mdHdh
cmUgdHJhY2tpbmcgaXMgaW1wbGVtZW50ZWQsIFBTUjIgbmVlZHMgdG8gYmUKLQkgKiBkaXNhYmxl
ZCBmb3IgcGxhdGZvcm1zIHdpdGhvdXQgUFNSMiBIVyB0cmFja2luZy4KLQkgKi8KLQlpZiAoIUhB
U19QU1JfSFdfVFJBQ0tJTkcoZGV2X3ByaXYpKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLAotCQkJICAgICJObyBQU1IyIEhXIHRyYWNraW5nIGluIHRoZSBwbGF0Zm9ybVxuIik7Ci0J
CXJldHVybiBmYWxzZTsKKwlpZiAoSEFTX1BTUjJfU0VMX0ZFVENIKGRldl9wcml2KSkgeworCQlp
ZiAoIWludGVsX3BzcjJfc2VsX2ZldGNoX2NvbmZpZ192YWxpZChpbnRlbF9kcCwgY3J0Y19zdGF0
ZSkgJiYKKwkJICAgICFIQVNfUFNSX0hXX1RSQUNLSU5HKGRldl9wcml2KSkgeworCQkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkJICAgICJQU1IyIG5vdCBlbmFibGVkLCBzZWxlY3Rp
dmUgZmV0Y2ggbm90IHZhbGlkIGFuZCBubyBIVyB0cmFja2luZyBhdmFpbGFibGVcbiIpOworCQkJ
cmV0dXJuIGZhbHNlOworCQl9CiAJfQogCi0JaWYgKGNydGNfaGRpc3BsYXkgPiBwc3JfbWF4X2gg
fHwgY3J0Y192ZGlzcGxheSA+IHBzcl9tYXhfdikgeworCWlmICghY3J0Y19zdGF0ZS0+ZW5hYmxl
X3BzcjJfc2VsX2ZldGNoICYmCisJICAgIChjcnRjX2hkaXNwbGF5ID4gcHNyX21heF9oIHx8IGNy
dGNfdmRpc3BsYXkgPiBwc3JfbWF4X3YpKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJt
LAogCQkJICAgICJQU1IyIG5vdCBlbmFibGVkLCByZXNvbHV0aW9uICVkeCVkID4gbWF4IHN1cHBv
cnRlZCAlZHglZFxuIiwKIAkJCSAgICBjcnRjX2hkaXNwbGF5LCBjcnRjX3ZkaXNwbGF5LApAQCAt
ODYzLDYgKzg5OCwxMSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQl2YWwgfD0gRVhJVExJTkVfRU5BQkxFOwogCQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgRVhJVExJTkUoY3B1X3RyYW5zY29kZXIpLCB2YWwpOwogCX0K
KworCWlmIChIQVNfUFNSX0hXX1RSQUNLSU5HKGRldl9wcml2KSkKKwkJaW50ZWxfZGVfcm13KGRl
dl9wcml2LCBDSElDS0VOX1BBUjFfMSwgSUdOT1JFX1BTUjJfSFdfVFJBQ0tJTkcsCisJCQkgICAg
IGRldl9wcml2LT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCA/CisJCQkgICAgIElHTk9SRV9Q
U1IyX0hXX1RSQUNLSU5HIDogMCk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVf
bG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKQEAgLTg4NCw3ICs5MjQs
NyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJLyogREM1L0RDNiByZXF1aXJlcyBhdCBsZWFzdCA2IGlkbGUg
ZnJhbWVzICovCiAJdmFsID0gdXNlY3NfdG9famlmZmllcyhpbnRlbF9nZXRfZnJhbWVfdGltZV91
cyhjcnRjX3N0YXRlKSAqIDYpOwogCWRldl9wcml2LT5wc3IuZGMzY29fZXhpdF9kZWxheSA9IHZh
bDsKLQorCWRldl9wcml2LT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCA9IGNydGNfc3RhdGUt
PmVuYWJsZV9wc3IyX3NlbF9mZXRjaDsKIAkvKgogCSAqIElmIGEgUFNSIGVycm9yIGhhcHBlbmVk
IGFuZCB0aGUgZHJpdmVyIGlzIHJlbG9hZGVkLCB0aGUgRURQX1BTUl9JSVIKIAkgKiB3aWxsIHN0
aWxsIGtlZXAgdGhlIGVycm9yIHNldCBldmVuIGFmdGVyIHRoZSByZXNldCBkb25lIGluIHRoZQpA
QCAtMTA4MCw2ICsxMTIwLDI2NSBAQCBzdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdf
ZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWludGVsX3Bzcl9leGl0
KGRldl9wcml2KTsKIH0KIAordm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fcGxhbmVfc2VsX2ZldGNo
KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwor
CisJaWYgKCFIQVNfUFNSMl9TRUxfRkVUQ0goZGV2X3ByaXYpIHx8CisJICAgICFwbGFuZV9zdGF0
ZSB8fAorCSAgICAhY3J0Y19zdGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNoKQorCQlyZXR1cm47
CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU0VMX0ZFVENIX0NUTChwaXBl
LCBwbGFuZS0+aWQpLAorCQkJICBwbGFuZV9zdGF0ZS0+cHNyMl9zZWxfZmV0Y2guY3RsKTsKKwlp
ZiAoIXBsYW5lX3N0YXRlLT5wc3IyX3NlbF9mZXRjaC5jdGwgfHwgcGxhbmUtPmlkID09IFBMQU5F
X0NVUlNPUikKKwkJcmV0dXJuOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5F
X1NFTF9GRVRDSF9QT1MocGlwZSwgcGxhbmUtPmlkKSwKKwkJCSAgcGxhbmVfc3RhdGUtPnBzcjJf
c2VsX2ZldGNoLnBvcyk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NFTF9G
RVRDSF9PRkZTRVQocGlwZSwgcGxhbmUtPmlkKSwKKwkJCSAgcGxhbmVfc3RhdGUtPnBzcjJfc2Vs
X2ZldGNoLm9mZnNldCk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NFTF9G
RVRDSF9TSVpFKHBpcGUsIHBsYW5lLT5pZCksCisJCQkgIHBsYW5lX3N0YXRlLT5wc3IyX3NlbF9m
ZXRjaC5zaXplKTsKK30KKwordm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19j
dGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CisJc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKworCWlmICgh
SEFTX1BTUjJfU0VMX0ZFVENIKGRldl9wcml2KSB8fAorCSAgICAhY3J0Y19zdGF0ZS0+ZW5hYmxl
X3BzcjJfc2VsX2ZldGNoKQorCQlyZXR1cm47CisKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwg
UFNSMl9NQU5fVFJLX0NUTChwc3ItPnRyYW5zY29kZXIpLAorCQkgICAgICAgY3J0Y19zdGF0ZS0+
cHNyMl9zd19tYW5fdHJhY2tfY3RsKTsKK30KKworc3RhdGljIHZvaWQgaW50ZWxfcHNyMl9wbGFu
ZV9zZWxfZmV0Y2hfY2FsYyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAor
CQkJCQkgICAgc3RydWN0IGRybV9yZWN0ICpjbGlwKQoreworCWludCBjb2xvcl9wbGFuZSA9IHBs
YW5lX3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lICYmICFwbGFuZV9zdGF0ZS0+cGxhbmFyX3Ns
YXZlOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9z
dGF0ZS0+dWFwaS5wbGFuZSk7CisJdTMyIHZhbDsKKworCWlmIChwbGFuZS0+aWQgPT0gUExBTkVf
Q1VSU09SKQorCQlyZXR1cm47CisKKwl2YWwgPSAocGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Nv
bG9yX3BsYW5lXS55ICsgY2xpcC0+eTEpIDw8IDE2OworCXZhbCB8PSBwbGFuZV9zdGF0ZS0+Y29s
b3JfcGxhbmVbY29sb3JfcGxhbmVdLng7CisJcGxhbmVfc3RhdGUtPnBzcjJfc2VsX2ZldGNoLm9m
ZnNldCA9IHZhbDsKKworCXZhbCA9IChjbGlwLT55MSArIHBsYW5lX3N0YXRlLT51YXBpLmNydGNf
eSkgPDwgMTY7CisJdmFsIHw9IHBsYW5lX3N0YXRlLT51YXBpLmNydGNfeDsKKwlwbGFuZV9zdGF0
ZS0+cHNyMl9zZWxfZmV0Y2gucG9zID0gdmFsOworCisJLyogU2l6ZXMgYXJlIDAgYmFzZWQgKi8K
Kwl2YWwgPSAoY2xpcC0+eTIgLSBjbGlwLT55MSAtIDEpIDw8IDE2OworCXZhbCB8PSAoZHJtX3Jl
Y3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTYpIC0gMTsKKwlwbGFuZV9zdGF0
ZS0+cHNyMl9zZWxfZmV0Y2guc2l6ZSA9IHZhbDsKK30KKworc3RhdGljIHZvaWQgaW50ZWxfcHNy
Ml90cmFuc19tYW5fdHJrX2N0bF9jYWxjKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAorCQkJCQkgICAgICBzdHJ1Y3QgZHJtX3JlY3QgKmNsaXAsCisJCQkJCSAgICAgIGJvb2wg
ZnVsbF91cGRhdGUpCit7CisJdTMyIHZhbCA9IFBTUjJfTUFOX1RSS19DVExfRU5BQkxFOworCisJ
aWYgKGZ1bGxfdXBkYXRlKSB7CisJCXZhbCB8PSBQU1IyX01BTl9UUktfQ1RMX1NJTkdMRV9GVUxM
X0ZSQU1FOworCQlnb3RvIGV4aXQ7CisJfQorCisJaWYgKGNsaXAtPnkxID09IC0xKQorCQlnb3Rv
IGV4aXQ7CisKKwl2YWwgfD0gUFNSMl9NQU5fVFJLX0NUTF9QQVJUSUFMX0ZSQU1FX1VQREFURTsK
Kwl2YWwgfD0gUFNSMl9NQU5fVFJLX0NUTF9SRUdJT05fU1RBUlRfQUREUihjbGlwLT55MSAvIDQg
KyAxKTsKKwl2YWwgfD0gUFNSMl9NQU5fVFJLX0NUTF9SRUdJT05fRU5EX0FERFIoRElWX1JPVU5E
X1VQKGNsaXAtPnkyLCA0KSArIDEpOworZXhpdDoKKwljcnRjX3N0YXRlLT5wc3IyX3N3X21hbl90
cmFja19jdGwgPSB2YWw7Cit9CisKK3N0YXRpYyB2b2lkIGludGVsX3BzcjJfcGxhbmVfc2VsX2Zl
dGNoX2N0bF9jYWxjKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkJCQlzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJCQkJYm9vbCBlbmFibGUpCit7CisJaWYg
KCFlbmFibGUpCisJCXBsYW5lX3N0YXRlLT5wc3IyX3NlbF9mZXRjaC5jdGwgPSAwOworCWVsc2Ug
aWYgKHBsYW5lLT5pZCA9PSBQTEFORV9DVVJTT1IpCisJCXBsYW5lX3N0YXRlLT5wc3IyX3NlbF9m
ZXRjaC5jdGwgPSBwbGFuZS0+Y3Vyc29yLmNudGw7CisJZWxzZQorCQlwbGFuZV9zdGF0ZS0+cHNy
Ml9zZWxfZmV0Y2guY3RsID0gcGxhbmVfc3RhdGUtPmN0bDsKK30KKworc3RhdGljIHZvaWQgY2xp
cF91cGRhdGUoc3RydWN0IGRybV9yZWN0ICpvdmVybGFwX2RhbWFnZV9hcmVhLAorCQkJc3RydWN0
IGRybV9yZWN0ICpkYW1hZ2VfYXJlYSkKK3sKKwlpZiAob3ZlcmxhcF9kYW1hZ2VfYXJlYS0+eTEg
PT0gLTEpIHsKKwkJb3ZlcmxhcF9kYW1hZ2VfYXJlYS0+eTEgPSBkYW1hZ2VfYXJlYS0+eTE7CisJ
CW92ZXJsYXBfZGFtYWdlX2FyZWEtPnkyID0gZGFtYWdlX2FyZWEtPnkyOworCQlyZXR1cm47CisJ
fQorCisJaWYgKGRhbWFnZV9hcmVhLT55MSA8IG92ZXJsYXBfZGFtYWdlX2FyZWEtPnkxKQorCQlv
dmVybGFwX2RhbWFnZV9hcmVhLT55MSA9IGRhbWFnZV9hcmVhLT55MTsKKworCWlmIChkYW1hZ2Vf
YXJlYS0+eTIgPiBvdmVybGFwX2RhbWFnZV9hcmVhLT55MikKKwkJb3ZlcmxhcF9kYW1hZ2VfYXJl
YS0+eTIgPSBkYW1hZ2VfYXJlYS0+eTI7Cit9CisKKy8qIFVwZGF0ZSBwbGFuZSBkYW1hZ2UgYXJl
YSBpZiBwbGFuZXMgYWJvdmUgbW92ZWQgb3IgaGF2ZSBhbHBoYSAqLworc3RhdGljIHZvaWQgaW50
ZWxfcHNyMl9waXBlX2RpcnR5X2FyZWFzX3NldChzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlLAorCQkJCQkgICAgc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJCQkJICAg
IGNvbnN0IHN0cnVjdCBkcm1fcmVjdCAqcGlwZV9kaXJ0eV9hcmVhcywKKwkJCQkJICAgIHN0cnVj
dCBkcm1fcmVjdCAqcGxhbmVfY2xpcCkKK3sKKwllbnVtIHBsYW5lX2lkIGk7CisKKwlmb3IgKGkg
PSBQTEFORV9DVVJTT1I7IGkgPiBwbGFuZS0+aWQ7IGktLSkgeworCQlpbnQgajsKKworCQlmb3Ig
KGogPSAwOyBqIDwgMjsgaisrKSB7CisJCQlzdHJ1Y3QgZHJtX3JlY3QgciA9IHBpcGVfZGlydHlf
YXJlYXNbaSAqIDIgKyBqXTsKKworCQkJaWYgKCFkcm1fcmVjdF93aWR0aCgmcikpCisJCQkJY29u
dGludWU7CisJCQlpZiAoIWRybV9yZWN0X2ludGVyc2VjdCgmciwgJnBsYW5lX3N0YXRlLT51YXBp
LmRzdCkpCisJCQkJY29udGludWU7CisKKwkJCXIueTEgLT0gcGxhbmVfc3RhdGUtPnVhcGkuY3J0
Y195OworCQkJci55MiAtPSBwbGFuZV9zdGF0ZS0+dWFwaS5jcnRjX3k7CisJCQljbGlwX3VwZGF0
ZShwbGFuZV9jbGlwLCAmcik7CisJCX0KKwl9Cit9CisKK3ZvaWQgaW50ZWxfcHNyMl9zZWxfZmV0
Y2hfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCSBzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSA9IGludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOworCXN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlLCAqb2xkX3BsYW5lX3N0YXRlOwor
CXN0cnVjdCBkcm1fcmVjdCBwaXBlX2RpcnR5X2FyZWFzW0k5MTVfTUFYX1BMQU5FUyAqIDJdID0g
e307CisJc3RydWN0IGRybV9yZWN0IHBpcGVfY2xpcCA9IHsgLnkxID0gLTEgfTsKKwlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lOworCWJvb2wgZnVsbF91cGRhdGUgPSBmYWxzZTsKKwlpbnQgaTsK
KworCWlmICghY3J0Y19zdGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNoKQorCQlyZXR1cm47CisK
KwkvKgorCSAqIExvYWQgYWxsIHRoZSBwaXBlcyBhcmVhcyB3aGVyZSB0aGVyZSBpcyBhIHBsYW5l
IHdpdGggYWxwaGEgb3IgYSBwbGFuZQorCSAqIHRoYXQgbW92ZWQgb3IgcGxhbmUgdGhhdCB0aGUg
dmlzaWJpbGl0eSBjaGFuZ2VkIGluIHRob3NlCisJICogY2FzZXMgcGxhbmVzIGJlbGxvdyBpdCB3
aWxsIG5lZWQgdG8gYmUgZmV0Y2hlZCBpbiB0aG9zZSBpbnRlcnNlY3Rpb24KKwkgKiBhcmVhcyBl
dmVuIGlmIHRoZXkgYXJlIG5vdCBkYW1hZ2VkIGluIHRob3NlIGFyZWFzLgorCSAqLworCWZvcl9l
YWNoX29sZG5ld19pbnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwgcGxhbmUsIG9sZF9wbGFuZV9z
dGF0ZSwKKwkJCQkJICAgICBuZXdfcGxhbmVfc3RhdGUsIGkpIHsKKwkJYm9vbCBhbHBoYSwgZmxp
cCwgZGlydHk7CisKKwkJaWYgKG5ld19wbGFuZV9zdGF0ZS0+dWFwaS5jcnRjICE9IGNydGNfc3Rh
dGUtPnVhcGkuY3J0YykKKwkJCWNvbnRpbnVlOworCisJCWFscGhhID0gbmV3X3BsYW5lX3N0YXRl
LT51YXBpLmFscGhhICE9IFUxNl9NQVg7CisJCWFscGhhIHw9IG9sZF9wbGFuZV9zdGF0ZS0+dWFw
aS5hbHBoYSAhPSBVMTZfTUFYOworCQlmbGlwID0gbmV3X3BsYW5lX3N0YXRlLT51YXBpLmZiICE9
IG9sZF9wbGFuZV9zdGF0ZS0+dWFwaS5mYjsKKwkJZGlydHkgPSBhbHBoYSAmJiBmbGlwOworCQlk
aXJ0eSB8PSAhZHJtX3JlY3RfZXF1YWxzKCZuZXdfcGxhbmVfc3RhdGUtPnVhcGkuZHN0LAorCQkJ
CQkgICZvbGRfcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwkJZGlydHkgfD0gbmV3X3BsYW5lX3N0
YXRlLT51YXBpLnZpc2libGUgIT0KKwkJCSBvbGRfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZTsK
KwkJaWYgKCFkaXJ0eSkKKwkJCWNvbnRpbnVlOworCisJCWlmIChvbGRfcGxhbmVfc3RhdGUtPnVh
cGkudmlzaWJsZSkKKwkJCXBpcGVfZGlydHlfYXJlYXNbcGxhbmUtPmlkICogMl0gPSBvbGRfcGxh
bmVfc3RhdGUtPnVhcGkuZHN0OworCQlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUp
CisJCQlwaXBlX2RpcnR5X2FyZWFzW3BsYW5lLT5pZCAqIDIgKyAxXSA9IG5ld19wbGFuZV9zdGF0
ZS0+dWFwaS5kc3Q7CisJfQorCisJLyoKKwkgKiBJdGVyYXRlIG92ZXIgYWxsIHBsYW5lcywgY29t
cHV0ZSB0aGUgZGFtYWdlZCBjbGlwIGFyZWEgYWxzbyBpbmNsdWRpbmcKKwkgKiB0aGUgcGlwZV9k
aXJ0eV9hcmVhcywgY29tcHV0ZSBwbGFuZSByZWdpc3RlcnMgYW5kIHVwZGF0ZSBwaXBlIGRhbWFn
ZWQKKwkgKiBhcmVhCisJICovCisJZm9yX2VhY2hfb2xkbmV3X2ludGVsX3BsYW5lX2luX3N0YXRl
KHN0YXRlLCBwbGFuZSwgb2xkX3BsYW5lX3N0YXRlLAorCQkJCQkgICAgIG5ld19wbGFuZV9zdGF0
ZSwgaSkgeworCQlzdHJ1Y3QgZHJtX3JlY3QgcGxhbmVfY2xpcCA9IHsgLnkxID0gLTEgfTsKKwkJ
c3RydWN0IGRybV9tb2RlX3JlY3QgKmNsaXBzOworCQl1MzIgbnVtX2NsaXBzOworCQlpbnQgajsK
KworCQlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLmNydGMgIT0gY3J0Y19zdGF0ZS0+dWFwaS5j
cnRjKQorCQkJY29udGludWU7CisKKwkJLyoKKwkJICogVE9ETzogTm90IGNsZWFyIGhvdyB0byBo
YW5kbGUgcGxhbmVzIHdpdGggbmVnYXRpdmUgcG9zaXRpb24sCisJCSAqIGFsc28gcGxhbmVzIGFy
ZSBub3QgdXBkYXRlZCBpZiB0aGV5IGhhdmUgYSBuZWdhdGl2ZSBYCisJCSAqIHBvc2l0aW9uIHNv
IGZvciBub3cgZG9pbmcgYSBmdWxsIHVwZGF0ZSBpbiB0aGlzIGNhc2VzCisJCSAqLworCQlpZiAo
bmV3X3BsYW5lX3N0YXRlLT51YXBpLmNydGNfeSA8IDAgfHwKKwkJICAgIG5ld19wbGFuZV9zdGF0
ZS0+dWFwaS5jcnRjX3ggPCAwKSB7CisJCQlmdWxsX3VwZGF0ZSA9IHRydWU7CisJCQlicmVhazsK
KwkJfQorCisJCWludGVsX3BzcjJfcGxhbmVfc2VsX2ZldGNoX2N0bF9jYWxjKHBsYW5lLCBuZXdf
cGxhbmVfc3RhdGUsCisJCQkJCQkgICAgbmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpOwor
CQlpZiAoIW5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQorCQkJY29udGludWU7CisKKwkJ
Y2xpcHMgPSBkcm1fcGxhbmVfZ2V0X2RhbWFnZV9jbGlwcygmbmV3X3BsYW5lX3N0YXRlLT51YXBp
KTsKKwkJbnVtX2NsaXBzID0gZHJtX3BsYW5lX2dldF9kYW1hZ2VfY2xpcHNfY291bnQoJm5ld19w
bGFuZV9zdGF0ZS0+dWFwaSk7CisKKwkJLyoKKwkJICogSWYgcGxhbmUgbW92ZWQgbWFyayB0aGUg
d2hvbGUgcGxhbmUgYXJlYSBhcyBkYW1hZ2VkIHNvIGl0CisJCSAqIGNhbiBiZSBjb21wbGV0ZSBk
cmF3IGluIHRoZSBuZXcgcG9zaXRpb24KKwkJICovCisJCWlmICghZHJtX3JlY3RfZXF1YWxzKCZu
ZXdfcGxhbmVfc3RhdGUtPnVhcGkuZHN0LAorCQkJCSAgICAgJm9sZF9wbGFuZV9zdGF0ZS0+dWFw
aS5kc3QpKSB7CisJCQludW1fY2xpcHMgPSAwOworCQkJcGxhbmVfY2xpcC55MSA9IG5ld19wbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CisJCQlwbGFuZV9jbGlwLnkyID0gbmV3X3BsYW5l
X3N0YXRlLT51YXBpLnNyYy55MiA+PiAxNjsKKwkJfSBlbHNlIGlmICghbnVtX2NsaXBzKSB7CisJ
CQkvKgorCQkJICogSWYgcGxhbmUgZG9uJ3QgaGF2ZSBkYW1hZ2UgYXJlYXMgYnV0IHRoZSBmcmFt
ZWJ1ZmZlcgorCQkJICogY2hhbmdlZCBtYXJrIHRoZSB3aG9sZSBwbGFuZSBhcyBkYW1hZ2VkCisJ
CQkgKi8KKwkJCWlmIChuZXdfcGxhbmVfc3RhdGUtPnVhcGkuZmIgPT0gb2xkX3BsYW5lX3N0YXRl
LT51YXBpLmZiKQorCQkJCWNvbnRpbnVlOworCisJCQlwbGFuZV9jbGlwLnkxID0gbmV3X3BsYW5l
X3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKKwkJCXBsYW5lX2NsaXAueTIgPSBuZXdfcGxhbmVf
c3RhdGUtPnVhcGkuc3JjLnkyID4+IDE2OworCQl9CisKKwkJZm9yIChqID0gMDsgaiA8IG51bV9j
bGlwczsgaisrKSB7CisJCQlzdHJ1Y3QgZHJtX3JlY3QgZGFtYWdlX2FyZWE7CisKKwkJCWRhbWFn
ZV9hcmVhLngxID0gY2xpcHNbal0ueDE7CisJCQlkYW1hZ2VfYXJlYS54MiA9IGNsaXBzW2pdLngy
OworCQkJZGFtYWdlX2FyZWEueTEgPSBjbGlwc1tqXS55MTsKKwkJCWRhbWFnZV9hcmVhLnkyID0g
Y2xpcHNbal0ueTI7CisJCQljbGlwX3VwZGF0ZSgmcGxhbmVfY2xpcCwgJmRhbWFnZV9hcmVhKTsK
KwkJfQorCisJCWludGVsX3BzcjJfcGlwZV9kaXJ0eV9hcmVhc19zZXQobmV3X3BsYW5lX3N0YXRl
LCBwbGFuZSwKKwkJCQkJCXBpcGVfZGlydHlfYXJlYXMsICZwbGFuZV9jbGlwKTsKKwkJaW50ZWxf
cHNyMl9wbGFuZV9zZWxfZmV0Y2hfY2FsYyhuZXdfcGxhbmVfc3RhdGUsICZwbGFuZV9jbGlwKTsK
KworCQlwbGFuZV9jbGlwLnkxICs9IG5ld19wbGFuZV9zdGF0ZS0+dWFwaS5jcnRjX3k7CisJCXBs
YW5lX2NsaXAueTIgKz0gbmV3X3BsYW5lX3N0YXRlLT51YXBpLmNydGNfeTsKKwkJY2xpcF91cGRh
dGUoJnBpcGVfY2xpcCwgJnBsYW5lX2NsaXApOworCX0KKworCWludGVsX3BzcjJfdHJhbnNfbWFu
X3Rya19jdGxfY2FsYyhjcnRjX3N0YXRlLCAmcGlwZV9jbGlwLCBmdWxsX3VwZGF0ZSk7Cit9CisK
IC8qKgogICogaW50ZWxfcHNyX3VwZGF0ZSAtIFVwZGF0ZSBQU1Igc3RhdGUKICAqIEBpbnRlbF9k
cDogSW50ZWwgRFAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfcHNyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oCmluZGV4
IGI0NTE1MTg2ZDVmNC4uZDgwYmQwZTQ2YjIxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfcHNyLmgKQEAgLTEzLDYgKzEzLDEwIEBAIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0
YXRlOwogc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CiBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZTsK
IHN0cnVjdCBpbnRlbF9kcDsKK3N0cnVjdCBpbnRlbF9jcnRjOworc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZTsKK3N0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZTsKK3N0cnVjdCBpbnRlbF9wbGFuZTsK
IAogI2RlZmluZSBDQU5fUFNSKGRldl9wcml2KSAoSEFTX1BTUihkZXZfcHJpdikgJiYgZGV2X3By
aXYtPnBzci5zaW5rX3N1cHBvcnQpCiB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCk7CkBAIC00Myw1ICs0NywxMSBAQCB2b2lkIGludGVsX3Bzcl9hdG9t
aWNfY2hlY2soc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJCSAgICBzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX3N0YXRlLAogCQkJICAgIHN0cnVjdCBkcm1fY29ubmVj
dG9yX3N0YXRlICpuZXdfc3RhdGUpOwogdm9pZCBpbnRlbF9wc3Jfc2V0X2ZvcmNlX21vZGVfY2hh
bmdlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKK3ZvaWQgaW50ZWxfcHNyMl9zZWxfZmV0
Y2hfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCSBzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0Yyk7Cit2b2lkIGludGVsX3BzcjJfcHJvZ3JhbV9wbGFuZV9zZWxfZmV0
Y2goc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJCQkJY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpOwordm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19j
dGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCiAjZW5kaWYg
LyogX19JTlRFTF9QU1JfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9zcHJpdGUuYwppbmRleCA4YmUwNmNiMjU5OTkuLmFmZWRlMzcyYWMwNSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC02OTAsNiArNjkwLDggQEAg
c2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0FVWF9PRkZTRVQocGlwZSwgcGxhbmVfaWQpLAogCQkJ
CSAgKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS55IDw8IDE2KSB8IHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVsxXS54KTsKIAorCWludGVsX3BzcjJfcHJvZ3JhbV9wbGFuZV9zZWxfZmV0Y2go
cGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwogCS8qCiAJICogVGhlIGNvbnRyb2wg
cmVnaXN0ZXIgc2VsZi1hcm1zIGlmIHRoZSBwbGFuZSB3YXMgcHJldmlvdXNseQogCSAqIGRpc2Fi
bGVkLiBUcnkgdG8gbWFrZSB0aGUgcGxhbmUgZW5hYmxlIGF0b21pYyBieSB3cml0aW5nCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaAppbmRleCAxNDZiZmQyNzZjZTcuLmFlN2VmYzkyMjM5MyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oCkBAIC01MDMsNiArNTAzLDcgQEAgc3RydWN0IGk5MTVfcHNyIHsK
IAlib29sIGxpbmtfc3RhbmRieTsKIAlib29sIGNvbG9yaW1ldHJ5X3N1cHBvcnQ7CiAJYm9vbCBw
c3IyX2VuYWJsZWQ7CisJYm9vbCBwc3IyX3NlbF9mZXRjaF9lbmFibGVkOwogCXU4IHNpbmtfc3lu
Y19sYXRlbmN5OwogCWt0aW1lX3QgbGFzdF9lbnRyeV9hdHRlbXB0OwogCWt0aW1lX3QgbGFzdF9l
eGl0OwpAQCAtMTYzNCw2ICsxNjM1LDcgQEAgSVNfU1VCUExBVEZPUk0oY29uc3Qgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAjZGVmaW5lIEhBU19QU1IoZGV2X3ByaXYpCQkgKElOVEVM
X0lORk8oZGV2X3ByaXYpLT5kaXNwbGF5Lmhhc19wc3IpCiAjZGVmaW5lIEhBU19QU1JfSFdfVFJB
Q0tJTkcoZGV2X3ByaXYpIFwKIAkoSU5URUxfSU5GTyhkZXZfcHJpdiktPmRpc3BsYXkuaGFzX3Bz
cl9od190cmFja2luZykKKyNkZWZpbmUgSEFTX1BTUjJfU0VMX0ZFVENIKGRldl9wcml2KQkgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCiAjZGVmaW5lIEhBU19UUkFOU0NPREVSKGRldl9wcml2
LCB0cmFucykJICgoSU5URUxfSU5GTyhkZXZfcHJpdiktPmNwdV90cmFuc2NvZGVyX21hc2sgJiBC
SVQodHJhbnMpKSAhPSAwKQogCiAjZGVmaW5lIEhBU19SQzYoZGV2X3ByaXYpCQkgKElOVEVMX0lO
Rk8oZGV2X3ByaXYpLT5oYXNfcmM2KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9wYXJhbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGFyYW1zLmMKaW5kZXgg
YWRkMDBlYzFmNzg3Li4zMDA1NDUxYzExOTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGFyYW1zLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wYXJhbXMu
YwpAQCAtODgsNiArODgsMTEgQEAgaTkxNV9wYXJhbV9uYW1lZF91bnNhZmUoZW5hYmxlX3Bzciwg
aW50LCAwNjAwLAogCSIoMD1kaXNhYmxlZCwgMT1lbmFibGVkKSAiCiAJIkRlZmF1bHQ6IC0xICh1
c2UgcGVyLWNoaXAgZGVmYXVsdCkiKTsKIAoraTkxNV9wYXJhbV9uYW1lZF91bnNhZmUoZW5hYmxl
X3BzcjJfc2VsX2ZldGNoLCBpbnQsIDA0MDAsCisJIkVuYWJsZSBQU1IyIHNlbGVjdGl2ZSBmZXRj
aCAiCisJIigwPWRpc2FibGVkLCAxPWVuYWJsZWQpICIKKwkiRGVmYXVsdDogMCIpOworCiBpOTE1
X3BhcmFtX25hbWVkX3Vuc2FmZShmb3JjZV9wcm9iZSwgY2hhcnAsIDA0MDAsCiAJIkZvcmNlIHBy
b2JlIHRoZSBkcml2ZXIgZm9yIHNwZWNpZmllZCBkZXZpY2VzLiAiCiAJIlNlZSBDT05GSUdfRFJN
X0k5MTVfRk9SQ0VfUFJPQkUgZm9yIGRldGFpbHMuIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BhcmFtcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wYXJh
bXMuaAppbmRleCA0NTMyMzczMmYwOTkuLjVhMGIxNjkyMzAxNiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wYXJhbXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BhcmFtcy5oCkBAIC01Myw2ICs1Myw3IEBAIHN0cnVjdCBkcm1fcHJpbnRlcjsKIAlwYXJh
bShpbnQsIGVuYWJsZV9kYywgLTEsIDA0MDApIFwKIAlwYXJhbShpbnQsIGVuYWJsZV9mYmMsIC0x
LCAwNjAwKSBcCiAJcGFyYW0oaW50LCBlbmFibGVfcHNyLCAtMSwgMDYwMCkgXAorCXBhcmFtKGlu
dCwgZW5hYmxlX3BzcjJfc2VsX2ZldGNoLCAwLCAwNDAwKSBcCiAJcGFyYW0oaW50LCBkaXNhYmxl
X3Bvd2VyX3dlbGwsIC0xLCAwNDAwKSBcCiAJcGFyYW0oaW50LCBlbmFibGVfaXBzLCAxLCAwNjAw
KSBcCiAJcGFyYW0oaW50LCBpbnZlcnRfYnJpZ2h0bmVzcywgMCwgMDYwMCkgXAotLSAKMi4yNi4y
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1n
ZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

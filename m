Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 01C962C347
	for <lists+intel-gfx@lfdr.de>; Tue, 28 May 2019 11:30:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D09696E228;
	Tue, 28 May 2019 09:30:09 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7A2A289F06
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 09:30:05 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16703187-1500050 
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 10:29:58 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 May 2019 10:29:46 +0100
Message-Id: <20190528092956.14910-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190528092956.14910-1-chris@chris-wilson.co.uk>
References: <20190528092956.14910-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 05/15] drm/i915: Move phys objects to its own file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29udGludWluZyB0aGUgZGVjbHV0dGVyaW5nIG9mIGk5MTVfZ2VtLmMsIHRoaXMgdGltZSB0aGUg
bGVnYWN5IHBoeXNpY2FsCm9iamVjdC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hy
aXNAY2hyaXMtd2lsc29uLmNvLnVrPgpSZXZpZXdlZC1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3
LmF1bGRAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAg
ICAgICAgICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0LmggICAgfCAgMTEgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90
eXBlcy5oICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGFnZXMu
YyAgICAgfCA1MjEgKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3BoeXMuYyAgICAgIHwgMjExICsrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3NobWVtLmMgICAgIHwgIDYxICsrCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9waHlzLmMgICAgfCAgODAgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmggICAgICAgICAgICAgICB8ICAgMiAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
ICAgICAgICAgICAgICAgfCA3MTIgKy0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9zaHJpbmtlci5jICAgICAgfCAgNTkgKy0KIC4uLi9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jICB8ICA1NCAtLQogLi4uL2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X21vY2tfc2VsZnRlc3RzLmggIHwgICAxICsKIDEyIGZpbGVzIGNoYW5nZWQsIDg5
NSBpbnNlcnRpb25zKCspLCA4MjEgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGh5cy5jCiBjcmVhdGUgbW9kZSAx
MDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGNjZjA1MjBlOGFkNC4uYTU4NGZmZjUzZTYzIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9NYWtlZmlsZQpAQCAtODgsNiArODgsOCBAQCBpOTE1LXkgKz0gJChndC15KQogb2Jq
LXkgKz0gZ2VtLwogZ2VtLXkgKz0gXAogCWdlbS9pOTE1X2dlbV9vYmplY3QubyBcCisJZ2VtL2k5
MTVfZ2VtX3BhZ2VzLm8gXAorCWdlbS9pOTE1X2dlbV9waHlzLm8gXAogCWdlbS9pOTE1X2dlbV9z
aG1lbS5vCiBpOTE1LXkgKz0gXAogCSAgJChnZW0teSkgXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdC5oCmluZGV4IDA1ZWY2YjAwNzZhZS4uODg0OTU1MzBlYmQ5IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0zMywxMSAr
MzMsMTcgQEAgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3NobWVtKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAog
CQkJCSAgICAgYm9vbCBuZWVkc19jbGZsdXNoKTsKIAoraW50IGk5MTVfZ2VtX29iamVjdF9hdHRh
Y2hfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBpbnQgYWxpZ24pOworCiB2
b2lkIGk5MTVfZ2VtX2Nsb3NlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbSwgc3Ry
dWN0IGRybV9maWxlICpmaWxlKTsKIHZvaWQgaTkxNV9nZW1fZnJlZV9vYmplY3Qoc3RydWN0IGRy
bV9nZW1fb2JqZWN0ICpvYmopOwogCiB2b2lkIGk5MTVfZ2VtX2ZsdXNoX2ZyZWVfb2JqZWN0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKK3N0cnVjdCBzZ190YWJsZSAqCitfX2k5
MTVfZ2VtX29iamVjdF91bnNldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KTsKK3ZvaWQgaTkxNV9nZW1fb2JqZWN0X3RydW5jYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopOworCiAvKioKICAqIGk5MTVfZ2VtX29iamVjdF9sb29rdXBfcmN1IC0gbG9vayB1
cCBhIHRlbXBvcmFyeSBHRU0gb2JqZWN0IGZyb20gaXRzIGhhbmRsZQogICogQGZpbHA6IERSTSBm
aWxlIHByaXZhdGUgZGF0ZQpAQCAtMjM2LDYgKzI0Miw4IEBAIGk5MTVfZ2VtX29iamVjdF9nZXRf
ZG1hX2FkZHJlc3Moc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIHZvaWQgX19pOTE1
X2dlbV9vYmplY3Rfc2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CQkJIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMsCiAJCQkJIHVuc2lnbmVkIGludCBzZ19wYWdlX3Np
emVzKTsKKworaW50IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopOwogaW50IF9faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlcyhzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKIAogc3RhdGljIGlubGluZSBpbnQgX19tdXN0
X2NoZWNrCkBAIC0yOTEsNyArMjk5LDggQEAgZW51bSBpOTE1X21tX3N1YmNsYXNzIHsgLyogbG9j
a2RlcCBzdWJjbGFzcyBmb3Igb2JqLT5tbS5sb2NrL3N0cnVjdF9tdXRleCAqLwogCiBpbnQgX19p
OTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAJCQkJZW51bSBpOTE1X21tX3N1YmNsYXNzIHN1YmNsYXNzKTsKLXZvaWQgX19pOTE1X2dlbV9v
YmplY3RfdHJ1bmNhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7Cit2b2lkIGk5
MTVfZ2VtX29iamVjdF90cnVuY2F0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsK
K3ZvaWQgaTkxNV9nZW1fb2JqZWN0X3dyaXRlYmFjayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKTsKIAogZW51bSBpOTE1X21hcF90eXBlIHsKIAlJOTE1X01BUF9XQiA9IDAsCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5kZXgg
ZmUzYjJhMjc3NWY3Li5kZjhlMjllZTM5NDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKQEAgLTUyLDYgKzUyLDggQEAgc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3Rfb3BzIHsKIAlpbnQgKCpnZXRfcGFnZXMpKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopOwogCXZvaWQgKCpwdXRfcGFnZXMpKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCQkgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpOworCXZvaWQgKCp0
cnVuY2F0ZSkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7CisJdm9pZCAoKndyaXRl
YmFjaykoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7CiAKIAlpbnQgKCpwd3JpdGUp
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBk
cm1faTkxNV9nZW1fcHdyaXRlICphcmcpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcGFnZXMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjM4Nzli
MzY2OWRlYQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9wYWdlcy5jCkBAIC0wLDAgKzEsNTIxIEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE0LTIwMTYgSW50ZWwgQ29ycG9yYXRp
b24KKyAqLworCisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpOTE1X2dlbV9vYmpl
Y3QuaCIKKwordm9pZCBfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgc3RydWN0IHNnX3RhYmxlICpwYWdlcywKKwkJCQkgdW5z
aWduZWQgaW50IHNnX3BhZ2Vfc2l6ZXMpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXVuc2lnbmVkIGxvbmcgc3VwcG9ydGVkID0g
SU5URUxfSU5GTyhpOTE1KS0+cGFnZV9zaXplczsKKwlpbnQgaTsKKworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJm9iai0+bW0ubG9jayk7CisKKwkvKiBNYWtlIHRoZSBwYWdlcyBjb2hlcmVudCB3aXRo
IHRoZSBHUFUgKGZsdXNoaW5nIGFueSBzd2FwaW4pLiAqLworCWlmIChvYmotPmNhY2hlX2RpcnR5
KSB7CisJCW9iai0+d3JpdGVfZG9tYWluID0gMDsKKwkJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNf
c3RydWN0X3BhZ2Uob2JqKSkKKwkJCWRybV9jbGZsdXNoX3NnKHBhZ2VzKTsKKwkJb2JqLT5jYWNo
ZV9kaXJ0eSA9IGZhbHNlOworCX0KKworCW9iai0+bW0uZ2V0X3BhZ2Uuc2dfcG9zID0gcGFnZXMt
PnNnbDsKKwlvYmotPm1tLmdldF9wYWdlLnNnX2lkeCA9IDA7CisKKwlvYmotPm1tLnBhZ2VzID0g
cGFnZXM7CisKKwlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKG9iaikgJiYKKwkgICAgaTkx
NS0+cXVpcmtzICYgUVVJUktfUElOX1NXSVpaTEVEX1BBR0VTKSB7CisJCUdFTV9CVUdfT04ob2Jq
LT5tbS5xdWlya2VkKTsKKwkJX19pOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJCW9i
ai0+bW0ucXVpcmtlZCA9IHRydWU7CisJfQorCisJR0VNX0JVR19PTighc2dfcGFnZV9zaXplcyk7
CisJb2JqLT5tbS5wYWdlX3NpemVzLnBoeXMgPSBzZ19wYWdlX3NpemVzOworCisJLyoKKwkgKiBD
YWxjdWxhdGUgdGhlIHN1cHBvcnRlZCBwYWdlLXNpemVzIHdoaWNoIGZpdCBpbnRvIHRoZSBnaXZl
bgorCSAqIHNnX3BhZ2Vfc2l6ZXMuIFRoaXMgd2lsbCBnaXZlIHVzIHRoZSBwYWdlLXNpemVzIHdo
aWNoIHdlIG1heSBiZSBhYmxlCisJICogdG8gdXNlIG9wcG9ydHVuaXN0aWNhbGx5IHdoZW4gbGF0
ZXIgaW5zZXJ0aW5nIGludG8gdGhlIEdUVC4gRm9yCisJICogZXhhbXBsZSBpZiBwaHlzPTJHLCB0
aGVuIGluIHRoZW9yeSB3ZSBzaG91bGQgYmUgYWJsZSB0byB1c2UgMUcsIDJNLAorCSAqIDY0SyBv
ciA0SyBwYWdlcywgYWx0aG91Z2ggaW4gcHJhY3RpY2UgdGhpcyB3aWxsIGRlcGVuZCBvbiBhIG51
bWJlciBvZgorCSAqIG90aGVyIGZhY3RvcnMuCisJICovCisJb2JqLT5tbS5wYWdlX3NpemVzLnNn
ID0gMDsKKwlmb3JfZWFjaF9zZXRfYml0KGksICZzdXBwb3J0ZWQsIGlsb2cyKEk5MTVfR1RUX01B
WF9QQUdFX1NJWkUpICsgMSkgeworCQlpZiAob2JqLT5tbS5wYWdlX3NpemVzLnBoeXMgJiB+MHUg
PDwgaSkKKwkJCW9iai0+bW0ucGFnZV9zaXplcy5zZyB8PSBCSVQoaSk7CisJfQorCUdFTV9CVUdf
T04oIUhBU19QQUdFX1NJWkVTKGk5MTUsIG9iai0+bW0ucGFnZV9zaXplcy5zZykpOworCisJc3Bp
bl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJbGlzdF9hZGQoJm9iai0+bW0ubGluaywgJmk5
MTUtPm1tLnVuYm91bmRfbGlzdCk7CisJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsK
K30KKworaW50IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCit7CisJaW50IGVycjsKKworCWlmICh1bmxpa2VseShvYmotPm1tLm1h
ZHYgIT0gSTkxNV9NQURWX1dJTExORUVEKSkgeworCQlEUk1fREVCVUcoIkF0dGVtcHRpbmcgdG8g
b2J0YWluIGEgcHVyZ2VhYmxlIG9iamVjdFxuIik7CisJCXJldHVybiAtRUZBVUxUOworCX0KKwor
CWVyciA9IG9iai0+b3BzLT5nZXRfcGFnZXMob2JqKTsKKwlHRU1fQlVHX09OKCFlcnIgJiYgIWk5
MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSk7CisKKwlyZXR1cm4gZXJyOworfQorCisvKiBF
bnN1cmUgdGhhdCB0aGUgYXNzb2NpYXRlZCBwYWdlcyBhcmUgZ2F0aGVyZWQgZnJvbSB0aGUgYmFj
a2luZyBzdG9yYWdlCisgKiBhbmQgcGlubmVkIGludG8gb3VyIG9iamVjdC4gaTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9wYWdlcygpIG1heSBiZSBjYWxsZWQKKyAqIG11bHRpcGxlIHRpbWVzIGJlZm9yZSB0
aGV5IGFyZSByZWxlYXNlZCBieSBhIHNpbmdsZSBjYWxsIHRvCisgKiBpOTE1X2dlbV9vYmplY3Rf
dW5waW5fcGFnZXMoKSAtIG9uY2UgdGhlIHBhZ2VzIGFyZSBubyBsb25nZXIgcmVmZXJlbmNlZAor
ICogZWl0aGVyIGFzIGEgcmVzdWx0IG9mIG1lbW9yeSBwcmVzc3VyZSAocmVhcGluZyBwYWdlcyB1
bmRlciB0aGUgc2hyaW5rZXIpCisgKiBvciBhcyB0aGUgb2JqZWN0IGlzIGl0c2VsZiByZWxlYXNl
ZC4KKyAqLworaW50IF9faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQoreworCWludCBlcnI7CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJm9iai0+bW0ubG9jayk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWlm
ICh1bmxpa2VseSghaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKSkgeworCQlHRU1fQlVH
X09OKGk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikpOworCisJCWVyciA9IF9f
X19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKG9iaik7CisJCWlmIChlcnIpCisJCQlnb3RvIHVu
bG9jazsKKworCQlzbXBfbWJfX2JlZm9yZV9hdG9taWMoKTsKKwl9CisJYXRvbWljX2luYygmb2Jq
LT5tbS5wYWdlc19waW5fY291bnQpOworCit1bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZvYmotPm1t
LmxvY2spOworCXJldHVybiBlcnI7Cit9CisKKy8qIEltbWVkaWF0ZWx5IGRpc2NhcmQgdGhlIGJh
Y2tpbmcgc3RvcmFnZSAqLwordm9pZCBpOTE1X2dlbV9vYmplY3RfdHJ1bmNhdGUoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlkcm1fZ2VtX2ZyZWVfbW1hcF9vZmZzZXQoJm9i
ai0+YmFzZSk7CisJaWYgKG9iai0+b3BzLT50cnVuY2F0ZSkKKwkJb2JqLT5vcHMtPnRydW5jYXRl
KG9iaik7Cit9CisKKy8qIFRyeSB0byBkaXNjYXJkIHVud2FudGVkIHBhZ2VzICovCit2b2lkIGk5
MTVfZ2VtX29iamVjdF93cml0ZWJhY2soc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
K3sKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPm1tLmxvY2spOworCUdFTV9CVUdfT04oaTkx
NV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKTsKKworCWlmIChvYmotPm9wcy0+d3JpdGViYWNr
KQorCQlvYmotPm9wcy0+d3JpdGViYWNrKG9iaik7Cit9CisKK3N0YXRpYyB2b2lkIF9faTkxNV9n
ZW1fb2JqZWN0X3Jlc2V0X3BhZ2VfaXRlcihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KQoreworCXN0cnVjdCByYWRpeF90cmVlX2l0ZXIgaXRlcjsKKwl2b2lkIF9fcmN1ICoqc2xvdDsK
KworCXJjdV9yZWFkX2xvY2soKTsKKwlyYWRpeF90cmVlX2Zvcl9lYWNoX3Nsb3Qoc2xvdCwgJm9i
ai0+bW0uZ2V0X3BhZ2UucmFkaXgsICZpdGVyLCAwKQorCQlyYWRpeF90cmVlX2RlbGV0ZSgmb2Jq
LT5tbS5nZXRfcGFnZS5yYWRpeCwgaXRlci5pbmRleCk7CisJcmN1X3JlYWRfdW5sb2NrKCk7Cit9
CisKK3N0cnVjdCBzZ190YWJsZSAqCitfX2k5MTVfZ2VtX29iamVjdF91bnNldF9wYWdlcyhzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2Vz
OworCisJcGFnZXMgPSBmZXRjaF9hbmRfemVybygmb2JqLT5tbS5wYWdlcyk7CisJaWYgKElTX0VS
Ul9PUl9OVUxMKHBhZ2VzKSkKKwkJcmV0dXJuIHBhZ2VzOworCisJc3Bpbl9sb2NrKCZpOTE1LT5t
bS5vYmpfbG9jayk7CisJbGlzdF9kZWwoJm9iai0+bW0ubGluayk7CisJc3Bpbl91bmxvY2soJmk5
MTUtPm1tLm9ial9sb2NrKTsKKworCWlmIChvYmotPm1tLm1hcHBpbmcpIHsKKwkJdm9pZCAqcHRy
OworCisJCXB0ciA9IHBhZ2VfbWFza19iaXRzKG9iai0+bW0ubWFwcGluZyk7CisJCWlmIChpc192
bWFsbG9jX2FkZHIocHRyKSkKKwkJCXZ1bm1hcChwdHIpOworCQllbHNlCisJCQlrdW5tYXAoa21h
cF90b19wYWdlKHB0cikpOworCisJCW9iai0+bW0ubWFwcGluZyA9IE5VTEw7CisJfQorCisJX19p
OTE1X2dlbV9vYmplY3RfcmVzZXRfcGFnZV9pdGVyKG9iaik7CisJb2JqLT5tbS5wYWdlX3NpemVz
LnBoeXMgPSBvYmotPm1tLnBhZ2Vfc2l6ZXMuc2cgPSAwOworCisJcmV0dXJuIHBhZ2VzOworfQor
CitpbnQgX19pOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCisJCQkJZW51bSBpOTE1X21tX3N1YmNsYXNzIHN1YmNsYXNzKQoreworCXN0cnVj
dCBzZ190YWJsZSAqcGFnZXM7CisJaW50IGVycjsKKworCWlmIChpOTE1X2dlbV9vYmplY3RfaGFz
X3Bpbm5lZF9wYWdlcyhvYmopKQorCQlyZXR1cm4gLUVCVVNZOworCisJR0VNX0JVR19PTihvYmot
PmJpbmRfY291bnQpOworCisJLyogTWF5IGJlIGNhbGxlZCBieSBzaHJpbmtlciBmcm9tIHdpdGhp
biBnZXRfcGFnZXMoKSAob24gYW5vdGhlciBibykgKi8KKwltdXRleF9sb2NrX25lc3RlZCgmb2Jq
LT5tbS5sb2NrLCBzdWJjbGFzcyk7CisJaWYgKHVubGlrZWx5KGF0b21pY19yZWFkKCZvYmotPm1t
LnBhZ2VzX3Bpbl9jb3VudCkpKSB7CisJCWVyciA9IC1FQlVTWTsKKwkJZ290byB1bmxvY2s7CisJ
fQorCisJLyoKKwkgKiAtPnB1dF9wYWdlcyBtaWdodCBuZWVkIHRvIGFsbG9jYXRlIG1lbW9yeSBm
b3IgdGhlIGJpdDE3IHN3aXp6bGUKKwkgKiBhcnJheSwgaGVuY2UgcHJvdGVjdCB0aGVtIGZyb20g
YmVpbmcgcmVhcGVkIGJ5IHJlbW92aW5nIHRoZW0gZnJvbSBndHQKKwkgKiBsaXN0cyBlYXJseS4K
KwkgKi8KKwlwYWdlcyA9IF9faTkxNV9nZW1fb2JqZWN0X3Vuc2V0X3BhZ2VzKG9iaik7CisKKwkv
KgorCSAqIFhYWCBUZW1wb3JhcnkgaGlqaW54IHRvIGF2b2lkIHVwZGF0aW5nIGFsbCBiYWNrZW5k
cyB0byBoYW5kbGUKKwkgKiBOVUxMIHBhZ2VzLiBJbiB0aGUgZnV0dXJlLCB3aGVuIHdlIGhhdmUg
bW9yZSBhc3luY2hyb25vdXMKKwkgKiBnZXRfcGFnZXMgYmFja2VuZHMgd2Ugc2hvdWxkIGJlIGJl
dHRlciBhYmxlIHRvIGhhbmRsZSB0aGUKKwkgKiBjYW5jZWxsYXRpb24gb2YgdGhlIGFzeW5jIHRh
c2sgaW4gYSBtb3JlIHVuaWZvcm0gbWFubmVyLgorCSAqLworCWlmICghcGFnZXMgJiYgIWk5MTVf
Z2VtX29iamVjdF9uZWVkc19hc3luY19jYW5jZWwob2JqKSkKKwkJcGFnZXMgPSBFUlJfUFRSKC1F
SU5WQUwpOworCisJaWYgKCFJU19FUlIocGFnZXMpKQorCQlvYmotPm9wcy0+cHV0X3BhZ2VzKG9i
aiwgcGFnZXMpOworCisJZXJyID0gMDsKK3VubG9jazoKKwltdXRleF91bmxvY2soJm9iai0+bW0u
bG9jayk7CisKKwlyZXR1cm4gZXJyOworfQorCisvKiBUaGUgJ21hcHBpbmcnIHBhcnQgb2YgaTkx
NV9nZW1fb2JqZWN0X3Bpbl9tYXAoKSBiZWxvdyAqLworc3RhdGljIHZvaWQgKmk5MTVfZ2VtX29i
amVjdF9tYXAoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgZW51
bSBpOTE1X21hcF90eXBlIHR5cGUpCit7CisJdW5zaWduZWQgbG9uZyBuX3BhZ2VzID0gb2JqLT5i
YXNlLnNpemUgPj4gUEFHRV9TSElGVDsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnNndCA9IG9iai0+bW0u
cGFnZXM7CisJc3RydWN0IHNndF9pdGVyIHNndF9pdGVyOworCXN0cnVjdCBwYWdlICpwYWdlOwor
CXN0cnVjdCBwYWdlICpzdGFja19wYWdlc1szMl07CisJc3RydWN0IHBhZ2UgKipwYWdlcyA9IHN0
YWNrX3BhZ2VzOworCXVuc2lnbmVkIGxvbmcgaSA9IDA7CisJcGdwcm90X3QgcGdwcm90OworCXZv
aWQgKmFkZHI7CisKKwkvKiBBIHNpbmdsZSBwYWdlIGNhbiBhbHdheXMgYmUga21hcHBlZCAqLwor
CWlmIChuX3BhZ2VzID09IDEgJiYgdHlwZSA9PSBJOTE1X01BUF9XQikKKwkJcmV0dXJuIGttYXAo
c2dfcGFnZShzZ3QtPnNnbCkpOworCisJaWYgKG5fcGFnZXMgPiBBUlJBWV9TSVpFKHN0YWNrX3Bh
Z2VzKSkgeworCQkvKiBUb28gYmlnIGZvciBzdGFjayAtLSBhbGxvY2F0ZSB0ZW1wb3JhcnkgYXJy
YXkgaW5zdGVhZCAqLworCQlwYWdlcyA9IGt2bWFsbG9jX2FycmF5KG5fcGFnZXMsIHNpemVvZigq
cGFnZXMpLCBHRlBfS0VSTkVMKTsKKwkJaWYgKCFwYWdlcykKKwkJCXJldHVybiBOVUxMOworCX0K
KworCWZvcl9lYWNoX3NndF9wYWdlKHBhZ2UsIHNndF9pdGVyLCBzZ3QpCisJCXBhZ2VzW2krK10g
PSBwYWdlOworCisJLyogQ2hlY2sgdGhhdCB3ZSBoYXZlIHRoZSBleHBlY3RlZCBudW1iZXIgb2Yg
cGFnZXMgKi8KKwlHRU1fQlVHX09OKGkgIT0gbl9wYWdlcyk7CisKKwlzd2l0Y2ggKHR5cGUpIHsK
KwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UodHlwZSk7CisJCS8qIGZhbGx0aHJvdWdoIHRvIHVz
ZSBQQUdFX0tFUk5FTCBhbnl3YXkgKi8KKwljYXNlIEk5MTVfTUFQX1dCOgorCQlwZ3Byb3QgPSBQ
QUdFX0tFUk5FTDsKKwkJYnJlYWs7CisJY2FzZSBJOTE1X01BUF9XQzoKKwkJcGdwcm90ID0gcGdw
cm90X3dyaXRlY29tYmluZShQQUdFX0tFUk5FTF9JTyk7CisJCWJyZWFrOworCX0KKwlhZGRyID0g
dm1hcChwYWdlcywgbl9wYWdlcywgMCwgcGdwcm90KTsKKworCWlmIChwYWdlcyAhPSBzdGFja19w
YWdlcykKKwkJa3ZmcmVlKHBhZ2VzKTsKKworCXJldHVybiBhZGRyOworfQorCisvKiBnZXQsIHBp
biwgYW5kIG1hcCB0aGUgcGFnZXMgb2YgdGhlIG9iamVjdCBpbnRvIGtlcm5lbCBzcGFjZSAqLwor
dm9pZCAqaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKKwkJCSAgICAgIGVudW0gaTkxNV9tYXBfdHlwZSB0eXBlKQoreworCWVudW0gaTkxNV9t
YXBfdHlwZSBoYXNfdHlwZTsKKwlib29sIHBpbm5lZDsKKwl2b2lkICpwdHI7CisJaW50IGVycjsK
KworCWlmICh1bmxpa2VseSghaTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFnZShvYmopKSkK
KwkJcmV0dXJuIEVSUl9QVFIoLUVOWElPKTsKKworCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0
aWJsZSgmb2JqLT5tbS5sb2NrKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gRVJSX1BUUihlcnIpOwor
CisJcGlubmVkID0gISh0eXBlICYgSTkxNV9NQVBfT1ZFUlJJREUpOworCXR5cGUgJj0gfkk5MTVf
TUFQX09WRVJSSURFOworCisJaWYgKCFhdG9taWNfaW5jX25vdF96ZXJvKCZvYmotPm1tLnBhZ2Vz
X3Bpbl9jb3VudCkpIHsKKwkJaWYgKHVubGlrZWx5KCFpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2Vz
KG9iaikpKSB7CisJCQlHRU1fQlVHX09OKGk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2Vz
KG9iaikpOworCisJCQllcnIgPSBfX19faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlcyhvYmopOwor
CQkJaWYgKGVycikKKwkJCQlnb3RvIGVycl91bmxvY2s7CisKKwkJCXNtcF9tYl9fYmVmb3JlX2F0
b21pYygpOworCQl9CisJCWF0b21pY19pbmMoJm9iai0+bW0ucGFnZXNfcGluX2NvdW50KTsKKwkJ
cGlubmVkID0gZmFsc2U7CisJfQorCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFn
ZXMob2JqKSk7CisKKwlwdHIgPSBwYWdlX3VucGFja19iaXRzKG9iai0+bW0ubWFwcGluZywgJmhh
c190eXBlKTsKKwlpZiAocHRyICYmIGhhc190eXBlICE9IHR5cGUpIHsKKwkJaWYgKHBpbm5lZCkg
eworCQkJZXJyID0gLUVCVVNZOworCQkJZ290byBlcnJfdW5waW47CisJCX0KKworCQlpZiAoaXNf
dm1hbGxvY19hZGRyKHB0cikpCisJCQl2dW5tYXAocHRyKTsKKwkJZWxzZQorCQkJa3VubWFwKGtt
YXBfdG9fcGFnZShwdHIpKTsKKworCQlwdHIgPSBvYmotPm1tLm1hcHBpbmcgPSBOVUxMOworCX0K
KworCWlmICghcHRyKSB7CisJCXB0ciA9IGk5MTVfZ2VtX29iamVjdF9tYXAob2JqLCB0eXBlKTsK
KwkJaWYgKCFwdHIpIHsKKwkJCWVyciA9IC1FTk9NRU07CisJCQlnb3RvIGVycl91bnBpbjsKKwkJ
fQorCisJCW9iai0+bW0ubWFwcGluZyA9IHBhZ2VfcGFja19iaXRzKHB0ciwgdHlwZSk7CisJfQor
CitvdXRfdW5sb2NrOgorCW11dGV4X3VubG9jaygmb2JqLT5tbS5sb2NrKTsKKwlyZXR1cm4gcHRy
OworCitlcnJfdW5waW46CisJYXRvbWljX2RlYygmb2JqLT5tbS5wYWdlc19waW5fY291bnQpOwor
ZXJyX3VubG9jazoKKwlwdHIgPSBFUlJfUFRSKGVycik7CisJZ290byBvdXRfdW5sb2NrOworfQor
Cit2b2lkIF9faTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAorCQkJCSB1bnNpZ25lZCBsb25nIG9mZnNldCwKKwkJCQkgdW5zaWduZWQgbG9u
ZyBzaXplKQoreworCWVudW0gaTkxNV9tYXBfdHlwZSBoYXNfdHlwZTsKKwl2b2lkICpwdHI7CisK
KwlHRU1fQlVHX09OKCFpOTE1X2dlbV9vYmplY3RfaGFzX3Bpbm5lZF9wYWdlcyhvYmopKTsKKwlH
RU1fQlVHX09OKHJhbmdlX292ZXJmbG93c190KHR5cGVvZihvYmotPmJhc2Uuc2l6ZSksCisJCQkJ
ICAgICBvZmZzZXQsIHNpemUsIG9iai0+YmFzZS5zaXplKSk7CisKKwlvYmotPm1tLmRpcnR5ID0g
dHJ1ZTsKKworCWlmIChvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVO
VF9GT1JfV1JJVEUpCisJCXJldHVybjsKKworCXB0ciA9IHBhZ2VfdW5wYWNrX2JpdHMob2JqLT5t
bS5tYXBwaW5nLCAmaGFzX3R5cGUpOworCWlmIChoYXNfdHlwZSA9PSBJOTE1X01BUF9XQykKKwkJ
cmV0dXJuOworCisJZHJtX2NsZmx1c2hfdmlydF9yYW5nZShwdHIgKyBvZmZzZXQsIHNpemUpOwor
CWlmIChzaXplID09IG9iai0+YmFzZS5zaXplKSB7CisJCW9iai0+d3JpdGVfZG9tYWluICY9IH5J
OTE1X0dFTV9ET01BSU5fQ1BVOworCQlvYmotPmNhY2hlX2RpcnR5ID0gZmFsc2U7CisJfQorfQor
CitzdHJ1Y3Qgc2NhdHRlcmxpc3QgKgoraTkxNV9nZW1fb2JqZWN0X2dldF9zZyhzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkgICAgICAgdW5zaWduZWQgaW50IG4sCisJCSAgICAg
ICB1bnNpZ25lZCBpbnQgKm9mZnNldCkKK3sKKwlzdHJ1Y3QgaTkxNV9nZW1fb2JqZWN0X3BhZ2Vf
aXRlciAqaXRlciA9ICZvYmotPm1tLmdldF9wYWdlOworCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7
CisJdW5zaWduZWQgaW50IGlkeCwgY291bnQ7CisKKwltaWdodF9zbGVlcCgpOworCUdFTV9CVUdf
T04obiA+PSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUKTsKKwlHRU1fQlVHX09OKCFpOTE1
X2dlbV9vYmplY3RfaGFzX3Bpbm5lZF9wYWdlcyhvYmopKTsKKworCS8qIEFzIHdlIGl0ZXJhdGUg
Zm9yd2FyZCB0aHJvdWdoIHRoZSBzZywgd2UgcmVjb3JkIGVhY2ggZW50cnkgaW4gYQorCSAqIHJh
ZGl4dHJlZSBmb3IgcXVpY2sgcmVwZWF0ZWQgKGJhY2t3YXJkcykgbG9va3Vwcy4gSWYgd2UgaGF2
ZSBzZWVuCisJICogdGhpcyBpbmRleCBwcmV2aW91c2x5LCB3ZSB3aWxsIGhhdmUgYW4gZW50cnkg
Zm9yIGl0LgorCSAqCisJICogSW5pdGlhbCBsb29rdXAgaXMgTyhOKSwgYnV0IHRoaXMgaXMgYW1v
cnRpemVkIHRvIE8oMSkgZm9yCisJICogc2VxdWVudGlhbCBwYWdlIGFjY2VzcyAod2hlcmUgZWFj
aCBuZXcgcmVxdWVzdCBpcyBjb25zZWN1dGl2ZQorCSAqIHRvIHRoZSBwcmV2aW91cyBvbmUpLiBS
ZXBlYXRlZCBsb29rdXBzIGFyZSBPKGxnKG9iai0+YmFzZS5zaXplKSksCisJICogaS5lLiBPKDEp
IHdpdGggYSBsYXJnZSBjb25zdGFudCEKKwkgKi8KKwlpZiAobiA8IFJFQURfT05DRShpdGVyLT5z
Z19pZHgpKQorCQlnb3RvIGxvb2t1cDsKKworCW11dGV4X2xvY2soJml0ZXItPmxvY2spOworCisJ
LyogV2UgcHJlZmVyIHRvIHJldXNlIHRoZSBsYXN0IHNnIHNvIHRoYXQgcmVwZWF0ZWQgbG9va3Vw
IG9mIHRoaXMKKwkgKiAob3IgdGhlIHN1YnNlcXVlbnQpIHNnIGFyZSBmYXN0IC0gY29tcGFyaW5n
IGFnYWluc3QgdGhlIGxhc3QKKwkgKiBzZyBpcyBmYXN0ZXIgdGhhbiBnb2luZyB0aHJvdWdoIHRo
ZSByYWRpeHRyZWUuCisJICovCisKKwlzZyA9IGl0ZXItPnNnX3BvczsKKwlpZHggPSBpdGVyLT5z
Z19pZHg7CisJY291bnQgPSBfX3NnX3BhZ2VfY291bnQoc2cpOworCisJd2hpbGUgKGlkeCArIGNv
dW50IDw9IG4pIHsKKwkJdm9pZCAqZW50cnk7CisJCXVuc2lnbmVkIGxvbmcgaTsKKwkJaW50IHJl
dDsKKworCQkvKiBJZiB3ZSBjYW5ub3QgYWxsb2NhdGUgYW5kIGluc2VydCB0aGlzIGVudHJ5LCBv
ciB0aGUKKwkJICogaW5kaXZpZHVhbCBwYWdlcyBmcm9tIHRoaXMgcmFuZ2UsIGNhbmNlbCB1cGRh
dGluZyB0aGUKKwkJICogc2dfaWR4IHNvIHRoYXQgb24gdGhpcyBsb29rdXAgd2UgYXJlIGZvcmNl
ZCB0byBsaW5lYXJseQorCQkgKiBzY2FuIG9ud2FyZHMsIGJ1dCBvbiBmdXR1cmUgbG9va3VwcyB3
ZSB3aWxsIHRyeSB0aGUKKwkJICogaW5zZXJ0aW9uIGFnYWluIChpbiB3aGljaCBjYXNlIHdlIG5l
ZWQgdG8gYmUgY2FyZWZ1bCBvZgorCQkgKiB0aGUgZXJyb3IgcmV0dXJuIHJlcG9ydGluZyB0aGF0
IHdlIGhhdmUgYWxyZWFkeSBpbnNlcnRlZAorCQkgKiB0aGlzIGluZGV4KS4KKwkJICovCisJCXJl
dCA9IHJhZGl4X3RyZWVfaW5zZXJ0KCZpdGVyLT5yYWRpeCwgaWR4LCBzZyk7CisJCWlmIChyZXQg
JiYgcmV0ICE9IC1FRVhJU1QpCisJCQlnb3RvIHNjYW47CisKKwkJZW50cnkgPSB4YV9ta192YWx1
ZShpZHgpOworCQlmb3IgKGkgPSAxOyBpIDwgY291bnQ7IGkrKykgeworCQkJcmV0ID0gcmFkaXhf
dHJlZV9pbnNlcnQoJml0ZXItPnJhZGl4LCBpZHggKyBpLCBlbnRyeSk7CisJCQlpZiAocmV0ICYm
IHJldCAhPSAtRUVYSVNUKQorCQkJCWdvdG8gc2NhbjsKKwkJfQorCisJCWlkeCArPSBjb3VudDsK
KwkJc2cgPSBfX19fc2dfbmV4dChzZyk7CisJCWNvdW50ID0gX19zZ19wYWdlX2NvdW50KHNnKTsK
Kwl9CisKK3NjYW46CisJaXRlci0+c2dfcG9zID0gc2c7CisJaXRlci0+c2dfaWR4ID0gaWR4Owor
CisJbXV0ZXhfdW5sb2NrKCZpdGVyLT5sb2NrKTsKKworCWlmICh1bmxpa2VseShuIDwgaWR4KSkg
LyogaW5zZXJ0aW9uIGNvbXBsZXRlZCBieSBhbm90aGVyIHRocmVhZCAqLworCQlnb3RvIGxvb2t1
cDsKKworCS8qIEluIGNhc2Ugd2UgZmFpbGVkIHRvIGluc2VydCB0aGUgZW50cnkgaW50byB0aGUg
cmFkaXh0cmVlLCB3ZSBuZWVkCisJICogdG8gbG9vayBiZXlvbmQgdGhlIGN1cnJlbnQgc2cuCisJ
ICovCisJd2hpbGUgKGlkeCArIGNvdW50IDw9IG4pIHsKKwkJaWR4ICs9IGNvdW50OworCQlzZyA9
IF9fX19zZ19uZXh0KHNnKTsKKwkJY291bnQgPSBfX3NnX3BhZ2VfY291bnQoc2cpOworCX0KKwor
CSpvZmZzZXQgPSBuIC0gaWR4OworCXJldHVybiBzZzsKKworbG9va3VwOgorCXJjdV9yZWFkX2xv
Y2soKTsKKworCXNnID0gcmFkaXhfdHJlZV9sb29rdXAoJml0ZXItPnJhZGl4LCBuKTsKKwlHRU1f
QlVHX09OKCFzZyk7CisKKwkvKiBJZiB0aGlzIGluZGV4IGlzIGluIHRoZSBtaWRkbGUgb2YgbXVs
dGktcGFnZSBzZyBlbnRyeSwKKwkgKiB0aGUgcmFkaXggdHJlZSB3aWxsIGNvbnRhaW4gYSB2YWx1
ZSBlbnRyeSB0aGF0IHBvaW50cworCSAqIHRvIHRoZSBzdGFydCBvZiB0aGF0IHJhbmdlLiBXZSB3
aWxsIHJldHVybiB0aGUgcG9pbnRlciB0bworCSAqIHRoZSBiYXNlIHBhZ2UgYW5kIHRoZSBvZmZz
ZXQgb2YgdGhpcyBwYWdlIHdpdGhpbiB0aGUKKwkgKiBzZyBlbnRyeSdzIHJhbmdlLgorCSAqLwor
CSpvZmZzZXQgPSAwOworCWlmICh1bmxpa2VseSh4YV9pc192YWx1ZShzZykpKSB7CisJCXVuc2ln
bmVkIGxvbmcgYmFzZSA9IHhhX3RvX3ZhbHVlKHNnKTsKKworCQlzZyA9IHJhZGl4X3RyZWVfbG9v
a3VwKCZpdGVyLT5yYWRpeCwgYmFzZSk7CisJCUdFTV9CVUdfT04oIXNnKTsKKworCQkqb2Zmc2V0
ID0gbiAtIGJhc2U7CisJfQorCisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwlyZXR1cm4gc2c7Cit9
CisKK3N0cnVjdCBwYWdlICoKK2k5MTVfZ2VtX29iamVjdF9nZXRfcGFnZShzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLCB1bnNpZ25lZCBpbnQgbikKK3sKKwlzdHJ1Y3Qgc2NhdHRlcmxp
c3QgKnNnOworCXVuc2lnbmVkIGludCBvZmZzZXQ7CisKKwlHRU1fQlVHX09OKCFpOTE1X2dlbV9v
YmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpOworCisJc2cgPSBpOTE1X2dlbV9vYmplY3RfZ2V0
X3NnKG9iaiwgbiwgJm9mZnNldCk7CisJcmV0dXJuIG50aF9wYWdlKHNnX3BhZ2Uoc2cpLCBvZmZz
ZXQpOworfQorCisvKiBMaWtlIGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZSgpLCBidXQgbWFyayB0
aGUgcmV0dXJuZWQgcGFnZSBkaXJ0eSAqLworc3RydWN0IHBhZ2UgKgoraTkxNV9nZW1fb2JqZWN0
X2dldF9kaXJ0eV9wYWdlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkgICAg
ICAgdW5zaWduZWQgaW50IG4pCit7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisKKwlwYWdlID0gaTkx
NV9nZW1fb2JqZWN0X2dldF9wYWdlKG9iaiwgbik7CisJaWYgKCFvYmotPm1tLmRpcnR5KQorCQlz
ZXRfcGFnZV9kaXJ0eShwYWdlKTsKKworCXJldHVybiBwYWdlOworfQorCitkbWFfYWRkcl90Citp
OTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRyZXNzX2xlbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAorCQkJCSAgICB1bnNpZ25lZCBsb25nIG4sCisJCQkJICAgIHVuc2lnbmVkIGlu
dCAqbGVuKQoreworCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7CisJdW5zaWduZWQgaW50IG9mZnNl
dDsKKworCXNnID0gaTkxNV9nZW1fb2JqZWN0X2dldF9zZyhvYmosIG4sICZvZmZzZXQpOworCisJ
aWYgKGxlbikKKwkJKmxlbiA9IHNnX2RtYV9sZW4oc2cpIC0gKG9mZnNldCA8PCBQQUdFX1NISUZU
KTsKKworCXJldHVybiBzZ19kbWFfYWRkcmVzcyhzZykgKyAob2Zmc2V0IDw8IFBBR0VfU0hJRlQp
OworfQorCitkbWFfYWRkcl90CitpOTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRyZXNzKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkJdW5zaWduZWQgbG9uZyBuKQoreworCXJl
dHVybiBpOTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRyZXNzX2xlbihvYmosIG4sIE5VTEwpOwor
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BoeXMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9waHlzLmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4xYzBjZTY5Zjc2NWIKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGh5cy5jCkBAIC0wLDAgKzEsMjEx
IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdo
dCDCqSAyMDE0LTIwMTYgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgv
aGlnaG1lbS5oPgorI2luY2x1ZGUgPGxpbnV4L3NobWVtX2ZzLmg+CisjaW5jbHVkZSA8bGludXgv
c3dhcC5oPgorCisjaW5jbHVkZSA8ZHJtL2RybS5oPiAvKiBmb3IgZHJtX2xlZ2FjeS5oISAqLwor
I2luY2x1ZGUgPGRybS9kcm1fY2FjaGUuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2xlZ2FjeS5oPiAv
KiBmb3IgZHJtX3BjaS5oISAqLworI2luY2x1ZGUgPGRybS9kcm1fcGNpLmg+CisKKyNpbmNsdWRl
ICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgorCitzdGF0aWMgaW50
IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQoreworCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0gb2JqLT5iYXNlLmZp
bHAtPmZfbWFwcGluZzsKKwlzdHJ1Y3QgZHJtX2RtYV9oYW5kbGUgKnBoeXM7CisJc3RydWN0IHNn
X3RhYmxlICpzdDsKKwlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOworCWNoYXIgKnZhZGRyOworCWlu
dCBpOworCWludCBlcnI7CisKKwlpZiAoV0FSTl9PTihpOTE1X2dlbV9vYmplY3RfbmVlZHNfYml0
MTdfc3dpenpsZShvYmopKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwkvKiBBbHdheXMgYWxpZ25p
bmcgdG8gdGhlIG9iamVjdCBzaXplLCBhbGxvd3MgYSBzaW5nbGUgYWxsb2NhdGlvbgorCSAqIHRv
IGhhbmRsZSBhbGwgcG9zc2libGUgY2FsbGVycywgYW5kIGdpdmVuIHR5cGljYWwgb2JqZWN0IHNp
emVzLAorCSAqIHRoZSBhbGlnbm1lbnQgb2YgdGhlIGJ1ZGR5IGFsbG9jYXRpb24gd2lsbCBuYXR1
cmFsbHkgbWF0Y2guCisJICovCisJcGh5cyA9IGRybV9wY2lfYWxsb2Mob2JqLT5iYXNlLmRldiwK
KwkJCSAgICAgcm91bmR1cF9wb3dfb2ZfdHdvKG9iai0+YmFzZS5zaXplKSwKKwkJCSAgICAgcm91
bmR1cF9wb3dfb2ZfdHdvKG9iai0+YmFzZS5zaXplKSk7CisJaWYgKCFwaHlzKQorCQlyZXR1cm4g
LUVOT01FTTsKKworCXZhZGRyID0gcGh5cy0+dmFkZHI7CisJZm9yIChpID0gMDsgaSA8IG9iai0+
YmFzZS5zaXplIC8gUEFHRV9TSVpFOyBpKyspIHsKKwkJc3RydWN0IHBhZ2UgKnBhZ2U7CisJCWNo
YXIgKnNyYzsKKworCQlwYWdlID0gc2htZW1fcmVhZF9tYXBwaW5nX3BhZ2UobWFwcGluZywgaSk7
CisJCWlmIChJU19FUlIocGFnZSkpIHsKKwkJCWVyciA9IFBUUl9FUlIocGFnZSk7CisJCQlnb3Rv
IGVycl9waHlzOworCQl9CisKKwkJc3JjID0ga21hcF9hdG9taWMocGFnZSk7CisJCW1lbWNweSh2
YWRkciwgc3JjLCBQQUdFX1NJWkUpOworCQlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKHZhZGRyLCBQ
QUdFX1NJWkUpOworCQlrdW5tYXBfYXRvbWljKHNyYyk7CisKKwkJcHV0X3BhZ2UocGFnZSk7CisJ
CXZhZGRyICs9IFBBR0VfU0laRTsKKwl9CisKKwlpOTE1X2dlbV9jaGlwc2V0X2ZsdXNoKHRvX2k5
MTUob2JqLT5iYXNlLmRldikpOworCisJc3QgPSBrbWFsbG9jKHNpemVvZigqc3QpLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIXN0KSB7CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3BoeXM7CisJ
fQorCisJaWYgKHNnX2FsbG9jX3RhYmxlKHN0LCAxLCBHRlBfS0VSTkVMKSkgeworCQlrZnJlZShz
dCk7CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3BoeXM7CisJfQorCisJc2cgPSBzdC0+
c2dsOworCXNnLT5vZmZzZXQgPSAwOworCXNnLT5sZW5ndGggPSBvYmotPmJhc2Uuc2l6ZTsKKwor
CXNnX2RtYV9hZGRyZXNzKHNnKSA9IHBoeXMtPmJ1c2FkZHI7CisJc2dfZG1hX2xlbihzZykgPSBv
YmotPmJhc2Uuc2l6ZTsKKworCW9iai0+cGh5c19oYW5kbGUgPSBwaHlzOworCisJX19pOTE1X2dl
bV9vYmplY3Rfc2V0X3BhZ2VzKG9iaiwgc3QsIHNnLT5sZW5ndGgpOworCisJcmV0dXJuIDA7CisK
K2Vycl9waHlzOgorCWRybV9wY2lfZnJlZShvYmotPmJhc2UuZGV2LCBwaHlzKTsKKworCXJldHVy
biBlcnI7Cit9CisKK3N0YXRpYyB2b2lkCitpOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzX3BoeXMo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCSAgICAgICBzdHJ1Y3Qgc2dfdGFi
bGUgKnBhZ2VzKQoreworCV9faTkxNV9nZW1fb2JqZWN0X3JlbGVhc2Vfc2htZW0ob2JqLCBwYWdl
cywgZmFsc2UpOworCisJaWYgKG9iai0+bW0uZGlydHkpIHsKKwkJc3RydWN0IGFkZHJlc3Nfc3Bh
Y2UgKm1hcHBpbmcgPSBvYmotPmJhc2UuZmlscC0+Zl9tYXBwaW5nOworCQljaGFyICp2YWRkciA9
IG9iai0+cGh5c19oYW5kbGUtPnZhZGRyOworCQlpbnQgaTsKKworCQlmb3IgKGkgPSAwOyBpIDwg
b2JqLT5iYXNlLnNpemUgLyBQQUdFX1NJWkU7IGkrKykgeworCQkJc3RydWN0IHBhZ2UgKnBhZ2U7
CisJCQljaGFyICpkc3Q7CisKKwkJCXBhZ2UgPSBzaG1lbV9yZWFkX21hcHBpbmdfcGFnZShtYXBw
aW5nLCBpKTsKKwkJCWlmIChJU19FUlIocGFnZSkpCisJCQkJY29udGludWU7CisKKwkJCWRzdCA9
IGttYXBfYXRvbWljKHBhZ2UpOworCQkJZHJtX2NsZmx1c2hfdmlydF9yYW5nZSh2YWRkciwgUEFH
RV9TSVpFKTsKKwkJCW1lbWNweShkc3QsIHZhZGRyLCBQQUdFX1NJWkUpOworCQkJa3VubWFwX2F0
b21pYyhkc3QpOworCisJCQlzZXRfcGFnZV9kaXJ0eShwYWdlKTsKKwkJCWlmIChvYmotPm1tLm1h
ZHYgPT0gSTkxNV9NQURWX1dJTExORUVEKQorCQkJCW1hcmtfcGFnZV9hY2Nlc3NlZChwYWdlKTsK
KwkJCXB1dF9wYWdlKHBhZ2UpOworCQkJdmFkZHIgKz0gUEFHRV9TSVpFOworCQl9CisJCW9iai0+
bW0uZGlydHkgPSBmYWxzZTsKKwl9CisKKwlzZ19mcmVlX3RhYmxlKHBhZ2VzKTsKKwlrZnJlZShw
YWdlcyk7CisKKwlkcm1fcGNpX2ZyZWUob2JqLT5iYXNlLmRldiwgb2JqLT5waHlzX2hhbmRsZSk7
Cit9CisKK3N0YXRpYyB2b2lkCitpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9waHlzKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2Vz
KG9iaik7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMg
aTkxNV9nZW1fcGh5c19vcHMgPSB7CisJLmdldF9wYWdlcyA9IGk5MTVfZ2VtX29iamVjdF9nZXRf
cGFnZXNfcGh5cywKKwkucHV0X3BhZ2VzID0gaTkxNV9nZW1fb2JqZWN0X3B1dF9wYWdlc19waHlz
LAorCS5yZWxlYXNlID0gaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfcGh5cywKK307CisKK2ludCBp
OTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwgaW50IGFsaWduKQoreworCXN0cnVjdCBzZ190YWJsZSAqcGFnZXM7CisJaW50IGVycjsKKwor
CWlmIChhbGlnbiA+IG9iai0+YmFzZS5zaXplKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChv
YmotPm9wcyA9PSAmaTkxNV9nZW1fcGh5c19vcHMpCisJCXJldHVybiAwOworCisJaWYgKG9iai0+
b3BzICE9ICZpOTE1X2dlbV9zaG1lbV9vcHMpCisJCXJldHVybiAtRUlOVkFMOworCisJZXJyID0g
aTkxNV9nZW1fb2JqZWN0X3VuYmluZChvYmopOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisK
KwltdXRleF9sb2NrKCZvYmotPm1tLmxvY2spOworCisJaWYgKG9iai0+bW0ubWFkdiAhPSBJOTE1
X01BRFZfV0lMTE5FRUQpIHsKKwkJZXJyID0gLUVGQVVMVDsKKwkJZ290byBlcnJfdW5sb2NrOwor
CX0KKworCWlmIChvYmotPm1tLnF1aXJrZWQpIHsKKwkJZXJyID0gLUVGQVVMVDsKKwkJZ290byBl
cnJfdW5sb2NrOworCX0KKworCWlmIChvYmotPm1tLm1hcHBpbmcpIHsKKwkJZXJyID0gLUVCVVNZ
OworCQlnb3RvIGVycl91bmxvY2s7CisJfQorCisJcGFnZXMgPSBfX2k5MTVfZ2VtX29iamVjdF91
bnNldF9wYWdlcyhvYmopOworCisJb2JqLT5vcHMgPSAmaTkxNV9nZW1fcGh5c19vcHM7CisKKwll
cnIgPSBfX19faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlcyhvYmopOworCWlmIChlcnIpCisJCWdv
dG8gZXJyX3hmZXI7CisKKwkvKiBQZXJtYS1waW4gKHVudGlsIHJlbGVhc2UpIHRoZSBwaHlzaWNh
bCBzZXQgb2YgcGFnZXMgKi8KKwlfX2k5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKKwor
CWlmICghSVNfRVJSX09SX05VTEwocGFnZXMpKQorCQlpOTE1X2dlbV9zaG1lbV9vcHMucHV0X3Bh
Z2VzKG9iaiwgcGFnZXMpOworCW11dGV4X3VubG9jaygmb2JqLT5tbS5sb2NrKTsKKwlyZXR1cm4g
MDsKKworZXJyX3hmZXI6CisJb2JqLT5vcHMgPSAmaTkxNV9nZW1fc2htZW1fb3BzOworCWlmICgh
SVNfRVJSX09SX05VTEwocGFnZXMpKSB7CisJCXVuc2lnbmVkIGludCBzZ19wYWdlX3NpemVzID0g
aTkxNV9zZ19wYWdlX3NpemVzKHBhZ2VzLT5zZ2wpOworCisJCV9faTkxNV9nZW1fb2JqZWN0X3Nl
dF9wYWdlcyhvYmosIHBhZ2VzLCBzZ19wYWdlX3NpemVzKTsKKwl9CitlcnJfdW5sb2NrOgorCW11
dGV4X3VubG9jaygmb2JqLT5tbS5sb2NrKTsKKwlyZXR1cm4gZXJyOworfQorCisjaWYgSVNfRU5B
QkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVf
Z2VtX3BoeXMuYyIKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3NobWVtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2ht
ZW0uYwppbmRleCBlMjcyMWJkOWFiNDQuLjU2ODE2NGNhNjZmZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMKQEAgLTIxMyw2ICsyMTMsNjUgQEAgc3RhdGljIGlu
dCBzaG1lbV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlyZXR1
cm4gcmV0OwogfQogCitzdGF0aWMgdm9pZAorc2htZW1fdHJ1bmNhdGUoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaikKK3sKKwkvKgorCSAqIE91ciBnb2FsIGhlcmUgaXMgdG8gcmV0dXJu
IGFzIG11Y2ggb2YgdGhlIG1lbW9yeSBhcworCSAqIGlzIHBvc3NpYmxlIGJhY2sgdG8gdGhlIHN5
c3RlbSBhcyB3ZSBhcmUgY2FsbGVkIGZyb20gT09NLgorCSAqIFRvIGRvIHRoaXMgd2UgbXVzdCBp
bnN0cnVjdCB0aGUgc2htZnMgdG8gZHJvcCBhbGwgb2YgaXRzCisJICogYmFja2luZyBwYWdlcywg
Km5vdyouCisJICovCisJc2htZW1fdHJ1bmNhdGVfcmFuZ2UoZmlsZV9pbm9kZShvYmotPmJhc2Uu
ZmlscCksIDAsIChsb2ZmX3QpLTEpOworCW9iai0+bW0ubWFkdiA9IF9fSTkxNV9NQURWX1BVUkdF
RDsKKwlvYmotPm1tLnBhZ2VzID0gRVJSX1BUUigtRUZBVUxUKTsKK30KKworc3RhdGljIHZvaWQK
K3NobWVtX3dyaXRlYmFjayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCXN0
cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nOworCXN0cnVjdCB3cml0ZWJhY2tfY29udHJvbCB3
YmMgPSB7CisJCS5zeW5jX21vZGUgPSBXQl9TWU5DX05PTkUsCisJCS5ucl90b193cml0ZSA9IFNX
QVBfQ0xVU1RFUl9NQVgsCisJCS5yYW5nZV9zdGFydCA9IDAsCisJCS5yYW5nZV9lbmQgPSBMTE9O
R19NQVgsCisJCS5mb3JfcmVjbGFpbSA9IDEsCisJfTsKKwl1bnNpZ25lZCBsb25nIGk7CisKKwkv
KgorCSAqIExlYXZlIG1tYXBpbmdzIGludGFjdCAoR1RUIHdpbGwgaGF2ZSBiZWVuIHJldm9rZWQg
b24gdW5iaW5kaW5nLAorCSAqIGxlYXZpbmcgb25seSBDUFUgbW1hcGluZ3MgYXJvdW5kKSBhbmQg
YWRkIHRob3NlIHBhZ2VzIHRvIHRoZSBMUlUKKwkgKiBpbnN0ZWFkIG9mIGludm9raW5nIHdyaXRl
YmFjayBzbyB0aGV5IGFyZSBhZ2VkIGFuZCBwYWdlZCBvdXQKKwkgKiBhcyBub3JtYWwuCisJICov
CisJbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5mX21hcHBpbmc7CisKKwkvKiBCZWdpbiB3cml0
ZWJhY2sgb24gZWFjaCBkaXJ0eSBwYWdlICovCisJZm9yIChpID0gMDsgaSA8IG9iai0+YmFzZS5z
aXplID4+IFBBR0VfU0hJRlQ7IGkrKykgeworCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKKworCQlwYWdl
ID0gZmluZF9sb2NrX2VudHJ5KG1hcHBpbmcsIGkpOworCQlpZiAoIXBhZ2UgfHwgeGFfaXNfdmFs
dWUocGFnZSkpCisJCQljb250aW51ZTsKKworCQlpZiAoIXBhZ2VfbWFwcGVkKHBhZ2UpICYmIGNs
ZWFyX3BhZ2VfZGlydHlfZm9yX2lvKHBhZ2UpKSB7CisJCQlpbnQgcmV0OworCisJCQlTZXRQYWdl
UmVjbGFpbShwYWdlKTsKKwkJCXJldCA9IG1hcHBpbmctPmFfb3BzLT53cml0ZXBhZ2UocGFnZSwg
JndiYyk7CisJCQlpZiAoIVBhZ2VXcml0ZWJhY2socGFnZSkpCisJCQkJQ2xlYXJQYWdlUmVjbGFp
bShwYWdlKTsKKwkJCWlmICghcmV0KQorCQkJCWdvdG8gcHV0OworCQl9CisJCXVubG9ja19wYWdl
KHBhZ2UpOworcHV0OgorCQlwdXRfcGFnZShwYWdlKTsKKwl9Cit9CisKIHZvaWQKIF9faTkxNV9n
ZW1fb2JqZWN0X3JlbGVhc2Vfc2htZW0oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAkJCQlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLApAQCAtMzYyLDYgKzQyMSw4IEBAIGNvbnN0IHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0X29wcyBpOTE1X2dlbV9zaG1lbV9vcHMgPSB7CiAKIAku
Z2V0X3BhZ2VzID0gc2htZW1fZ2V0X3BhZ2VzLAogCS5wdXRfcGFnZXMgPSBzaG1lbV9wdXRfcGFn
ZXMsCisJLnRydW5jYXRlID0gc2htZW1fdHJ1bmNhdGUsCisJLndyaXRlYmFjayA9IHNobWVtX3dy
aXRlYmFjaywKIAogCS5wd3JpdGUgPSBzaG1lbV9wd3JpdGUsCiB9OwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX3BoeXMuYwpuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmVkNjQwMTJlNWQyNAotLS0gL2Rldi9udWxsCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fcGh5cy5jCkBA
IC0wLDAgKzEsODAgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgor
ICogQ29weXJpZ2h0IMKpIDIwMTYgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAi
aTkxNV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAic2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5o
IgorCitzdGF0aWMgaW50IG1vY2tfcGh5c19vYmplY3Qodm9pZCAqYXJnKQoreworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmo7CisJaW50IGVycjsKKworCS8qIENyZWF0ZSBhbiBvYmplY3QgYW5kIGJpbmQgaXQgdG8g
YSBjb250aWd1b3VzIHNldCBvZiBwaHlzaWNhbCBwYWdlcywKKwkgKiBpLmUuIGV4ZXJjaXNlIHRo
ZSBpOTE1X2dlbV9vYmplY3RfcGh5cyBBUEkuCisJICovCisKKwlvYmogPSBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX3NobWVtKGk5MTUsIFBBR0VfU0laRSk7CisJaWYgKElTX0VSUihvYmopKSB7CisJ
CWVyciA9IFBUUl9FUlIob2JqKTsKKwkJcHJfZXJyKCJpOTE1X2dlbV9vYmplY3RfY3JlYXRlIGZh
aWxlZCwgZXJyPSVkXG4iLCBlcnIpOworCQlnb3RvIG91dDsKKwl9CisKKwltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwllcnIgPSBpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3Bo
eXMob2JqLCBQQUdFX1NJWkUpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CisJaWYgKGVycikgeworCQlwcl9lcnIoImk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyBm
YWlsZWQsIGVycj0lZFxuIiwgZXJyKTsKKwkJZ290byBvdXRfb2JqOworCX0KKworCWlmIChvYmot
Pm9wcyAhPSAmaTkxNV9nZW1fcGh5c19vcHMpIHsKKwkJcHJfZXJyKCJpOTE1X2dlbV9vYmplY3Rf
YXR0YWNoX3BoeXMgZGlkIG5vdCBjcmVhdGUgYSBwaHlzIG9iamVjdFxuIik7CisJCWVyciA9IC1F
SU5WQUw7CisJCWdvdG8gb3V0X29iajsKKwl9CisKKwlpZiAoIWF0b21pY19yZWFkKCZvYmotPm1t
LnBhZ2VzX3Bpbl9jb3VudCkpIHsKKwkJcHJfZXJyKCJpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3Bo
eXMgZGlkIG5vdCBwaW4gaXRzIHBoeXMgcGFnZXNcbiIpOworCQllcnIgPSAtRUlOVkFMOworCQln
b3RvIG91dF9vYmo7CisJfQorCisJLyogTWFrZSB0aGUgb2JqZWN0IGRpcnR5IHNvIHRoYXQgcHV0
X3BhZ2VzIG11c3QgZG8gY29weSBiYWNrIHRoZSBkYXRhICovCisJbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9t
YWluKG9iaiwgdHJ1ZSk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
KwlpZiAoZXJyKSB7CisJCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWlu
IGZhaWxlZCB3aXRoIGVycj0lZFxuIiwKKwkJICAgICAgIGVycik7CisJCWdvdG8gb3V0X29iajsK
Kwl9CisKK291dF9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworb3V0OgorCXJldHVy
biBlcnI7Cit9CisKK2ludCBpOTE1X2dlbV9waHlzX21vY2tfc2VsZnRlc3RzKHZvaWQpCit7CisJ
c3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVCht
b2NrX3BoeXNfb2JqZWN0KSwKKwl9OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1Owor
CWludCBlcnI7CisKKwlpOTE1ID0gbW9ja19nZW1fZGV2aWNlKCk7CisJaWYgKCFpOTE1KQorCQly
ZXR1cm4gLUVOT01FTTsKKworCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOworCisJ
ZHJtX2Rldl9wdXQoJmk5MTUtPmRybSk7CisJcmV0dXJuIGVycjsKK30KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5oCmluZGV4IDUwN2RiYTVkYWU5YS4uMGYwMThmZDU4YTYwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmgKQEAgLTI5MDMsOCArMjkwMyw2IEBAIGk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlz
cGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJCSAgICAgY29u
c3Qgc3RydWN0IGk5MTVfZ2d0dF92aWV3ICp2aWV3LAogCQkJCSAgICAgdW5zaWduZWQgaW50IGZs
YWdzKTsKIHZvaWQgaTkxNV9nZW1fb2JqZWN0X3VucGluX2Zyb21fZGlzcGxheV9wbGFuZShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSk7Ci1pbnQgaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJaW50IGFsaWduKTsKIGludCBpOTE1X2dl
bV9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bGUpOwogdm9pZCBpOTE1X2dlbV9yZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVj
dCBkcm1fZmlsZSAqZmlsZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDk4YWMyYmJi
NjUzNC4uNmYzZTkzOTRlODA2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTI2LDcgKzI2
LDYgQEAKICAqLwogCiAjaW5jbHVkZSA8ZHJtL2RybV92bWFfbWFuYWdlci5oPgotI2luY2x1ZGUg
PGRybS9kcm1fcGNpLmg+CiAjaW5jbHVkZSA8ZHJtL2k5MTVfZHJtLmg+CiAjaW5jbHVkZSA8bGlu
dXgvZG1hLWZlbmNlLWFycmF5Lmg+CiAjaW5jbHVkZSA8bGludXgva3RocmVhZC5oPgpAQCAtOTks
MTMzICs5OCw2IEBAIGk5MTVfZ2VtX2dldF9hcGVydHVyZV9pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGk5MTVfZ2Vt
X29iamVjdF9nZXRfcGFnZXNfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQot
ewotCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0gb2JqLT5iYXNlLmZpbHAtPmZfbWFw
cGluZzsKLQlkcm1fZG1hX2hhbmRsZV90ICpwaHlzOwotCXN0cnVjdCBzZ190YWJsZSAqc3Q7Ci0J
c3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKLQljaGFyICp2YWRkcjsKLQlpbnQgaTsKLQlpbnQgZXJy
OwotCi0JaWYgKFdBUk5fT04oaTkxNV9nZW1fb2JqZWN0X25lZWRzX2JpdDE3X3N3aXp6bGUob2Jq
KSkpCi0JCXJldHVybiAtRUlOVkFMOwotCi0JLyogQWx3YXlzIGFsaWduaW5nIHRvIHRoZSBvYmpl
Y3Qgc2l6ZSwgYWxsb3dzIGEgc2luZ2xlIGFsbG9jYXRpb24KLQkgKiB0byBoYW5kbGUgYWxsIHBv
c3NpYmxlIGNhbGxlcnMsIGFuZCBnaXZlbiB0eXBpY2FsIG9iamVjdCBzaXplcywKLQkgKiB0aGUg
YWxpZ25tZW50IG9mIHRoZSBidWRkeSBhbGxvY2F0aW9uIHdpbGwgbmF0dXJhbGx5IG1hdGNoLgot
CSAqLwotCXBoeXMgPSBkcm1fcGNpX2FsbG9jKG9iai0+YmFzZS5kZXYsCi0JCQkgICAgIHJvdW5k
dXBfcG93X29mX3R3byhvYmotPmJhc2Uuc2l6ZSksCi0JCQkgICAgIHJvdW5kdXBfcG93X29mX3R3
byhvYmotPmJhc2Uuc2l6ZSkpOwotCWlmICghcGh5cykKLQkJcmV0dXJuIC1FTk9NRU07Ci0KLQl2
YWRkciA9IHBoeXMtPnZhZGRyOwotCWZvciAoaSA9IDA7IGkgPCBvYmotPmJhc2Uuc2l6ZSAvIFBB
R0VfU0laRTsgaSsrKSB7Ci0JCXN0cnVjdCBwYWdlICpwYWdlOwotCQljaGFyICpzcmM7Ci0KLQkJ
cGFnZSA9IHNobWVtX3JlYWRfbWFwcGluZ19wYWdlKG1hcHBpbmcsIGkpOwotCQlpZiAoSVNfRVJS
KHBhZ2UpKSB7Ci0JCQllcnIgPSBQVFJfRVJSKHBhZ2UpOwotCQkJZ290byBlcnJfcGh5czsKLQkJ
fQotCi0JCXNyYyA9IGttYXBfYXRvbWljKHBhZ2UpOwotCQltZW1jcHkodmFkZHIsIHNyYywgUEFH
RV9TSVpFKTsKLQkJZHJtX2NsZmx1c2hfdmlydF9yYW5nZSh2YWRkciwgUEFHRV9TSVpFKTsKLQkJ
a3VubWFwX2F0b21pYyhzcmMpOwotCi0JCXB1dF9wYWdlKHBhZ2UpOwotCQl2YWRkciArPSBQQUdF
X1NJWkU7Ci0JfQotCi0JaTkxNV9nZW1fY2hpcHNldF9mbHVzaCh0b19pOTE1KG9iai0+YmFzZS5k
ZXYpKTsKLQotCXN0ID0ga21hbGxvYyhzaXplb2YoKnN0KSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFz
dCkgewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIGVycl9waHlzOwotCX0KLQotCWlmIChzZ19h
bGxvY190YWJsZShzdCwgMSwgR0ZQX0tFUk5FTCkpIHsKLQkJa2ZyZWUoc3QpOwotCQllcnIgPSAt
RU5PTUVNOwotCQlnb3RvIGVycl9waHlzOwotCX0KLQotCXNnID0gc3QtPnNnbDsKLQlzZy0+b2Zm
c2V0ID0gMDsKLQlzZy0+bGVuZ3RoID0gb2JqLT5iYXNlLnNpemU7Ci0KLQlzZ19kbWFfYWRkcmVz
cyhzZykgPSBwaHlzLT5idXNhZGRyOwotCXNnX2RtYV9sZW4oc2cpID0gb2JqLT5iYXNlLnNpemU7
Ci0KLQlvYmotPnBoeXNfaGFuZGxlID0gcGh5czsKLQotCV9faTkxNV9nZW1fb2JqZWN0X3NldF9w
YWdlcyhvYmosIHN0LCBzZy0+bGVuZ3RoKTsKLQotCXJldHVybiAwOwotCi1lcnJfcGh5czoKLQlk
cm1fcGNpX2ZyZWUob2JqLT5iYXNlLmRldiwgcGh5cyk7Ci0KLQlyZXR1cm4gZXJyOwotfQotCi1z
dGF0aWMgdm9pZAotaTkxNV9nZW1fb2JqZWN0X3B1dF9wYWdlc19waHlzKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCi0JCQkgICAgICAgc3RydWN0IHNnX3RhYmxlICpwYWdlcykKLXsK
LQlfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3NobWVtKG9iaiwgcGFnZXMsIGZhbHNlKTsKLQot
CWlmIChvYmotPm1tLmRpcnR5KSB7Ci0JCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0g
b2JqLT5iYXNlLmZpbHAtPmZfbWFwcGluZzsKLQkJY2hhciAqdmFkZHIgPSBvYmotPnBoeXNfaGFu
ZGxlLT52YWRkcjsKLQkJaW50IGk7Ci0KLQkJZm9yIChpID0gMDsgaSA8IG9iai0+YmFzZS5zaXpl
IC8gUEFHRV9TSVpFOyBpKyspIHsKLQkJCXN0cnVjdCBwYWdlICpwYWdlOwotCQkJY2hhciAqZHN0
OwotCi0JCQlwYWdlID0gc2htZW1fcmVhZF9tYXBwaW5nX3BhZ2UobWFwcGluZywgaSk7Ci0JCQlp
ZiAoSVNfRVJSKHBhZ2UpKQotCQkJCWNvbnRpbnVlOwotCi0JCQlkc3QgPSBrbWFwX2F0b21pYyhw
YWdlKTsKLQkJCWRybV9jbGZsdXNoX3ZpcnRfcmFuZ2UodmFkZHIsIFBBR0VfU0laRSk7Ci0JCQlt
ZW1jcHkoZHN0LCB2YWRkciwgUEFHRV9TSVpFKTsKLQkJCWt1bm1hcF9hdG9taWMoZHN0KTsKLQot
CQkJc2V0X3BhZ2VfZGlydHkocGFnZSk7Ci0JCQlpZiAob2JqLT5tbS5tYWR2ID09IEk5MTVfTUFE
Vl9XSUxMTkVFRCkKLQkJCQltYXJrX3BhZ2VfYWNjZXNzZWQocGFnZSk7Ci0JCQlwdXRfcGFnZShw
YWdlKTsKLQkJCXZhZGRyICs9IFBBR0VfU0laRTsKLQkJfQotCQlvYmotPm1tLmRpcnR5ID0gZmFs
c2U7Ci0JfQotCi0Jc2dfZnJlZV90YWJsZShwYWdlcyk7Ci0Ja2ZyZWUocGFnZXMpOwotCi0JZHJt
X3BjaV9mcmVlKG9iai0+YmFzZS5kZXYsIG9iai0+cGh5c19oYW5kbGUpOwotfQotCi1zdGF0aWMg
dm9pZAotaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQotewotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotfQotCi1z
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3BzIGk5MTVfZ2VtX3BoeXNf
b3BzID0gewotCS5nZXRfcGFnZXMgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX3BoeXMsCi0J
LnB1dF9wYWdlcyA9IGk5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXNfcGh5cywKLQkucmVsZWFzZSA9
IGk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3BoeXMsCi19OwotCiBpbnQgaTkxNV9nZW1fb2JqZWN0
X3VuYmluZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hOwpAQCAtMTk2NCwxMSArMTgzNiw2IEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQog
CXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9mcmVlX21tYXBf
b2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JZHJtX2dlbV9mcmVl
X21tYXBfb2Zmc2V0KCZvYmotPmJhc2UpOwotfQotCiBpbnQKIGk5MTVfZ2VtX21tYXBfZ3R0KHN0
cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJICBzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LApAQCAtMjAx
NCwxMTEgKzE4ODEsNiBAQCBpOTE1X2dlbV9tbWFwX2d0dF9pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAogCXJldHVybiBpOTE1X2dlbV9tbWFwX2d0dChmaWxlLCBkZXYs
IGFyZ3MtPmhhbmRsZSwgJmFyZ3MtPm9mZnNldCk7CiB9CiAKLS8qIEltbWVkaWF0ZWx5IGRpc2Nh
cmQgdGhlIGJhY2tpbmcgc3RvcmFnZSAqLwotdm9pZCBfX2k5MTVfZ2VtX29iamVjdF90cnVuY2F0
ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCWk5MTVfZ2VtX29iamVjdF9m
cmVlX21tYXBfb2Zmc2V0KG9iaik7Ci0KLQlpZiAob2JqLT5iYXNlLmZpbHAgPT0gTlVMTCkKLQkJ
cmV0dXJuOwotCi0JLyogT3VyIGdvYWwgaGVyZSBpcyB0byByZXR1cm4gYXMgbXVjaCBvZiB0aGUg
bWVtb3J5IGFzCi0JICogaXMgcG9zc2libGUgYmFjayB0byB0aGUgc3lzdGVtIGFzIHdlIGFyZSBj
YWxsZWQgZnJvbSBPT00uCi0JICogVG8gZG8gdGhpcyB3ZSBtdXN0IGluc3RydWN0IHRoZSBzaG1m
cyB0byBkcm9wIGFsbCBvZiBpdHMKLQkgKiBiYWNraW5nIHBhZ2VzLCAqbm93Ki4KLQkgKi8KLQlz
aG1lbV90cnVuY2F0ZV9yYW5nZShmaWxlX2lub2RlKG9iai0+YmFzZS5maWxwKSwgMCwgKGxvZmZf
dCktMSk7Ci0Jb2JqLT5tbS5tYWR2ID0gX19JOTE1X01BRFZfUFVSR0VEOwotCW9iai0+bW0ucGFn
ZXMgPSBFUlJfUFRSKC1FRkFVTFQpOwotfQotCi1zdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX29iamVj
dF9yZXNldF9wYWdlX2l0ZXIoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlz
dHJ1Y3QgcmFkaXhfdHJlZV9pdGVyIGl0ZXI7Ci0Jdm9pZCBfX3JjdSAqKnNsb3Q7Ci0KLQlyY3Vf
cmVhZF9sb2NrKCk7Ci0JcmFkaXhfdHJlZV9mb3JfZWFjaF9zbG90KHNsb3QsICZvYmotPm1tLmdl
dF9wYWdlLnJhZGl4LCAmaXRlciwgMCkKLQkJcmFkaXhfdHJlZV9kZWxldGUoJm9iai0+bW0uZ2V0
X3BhZ2UucmFkaXgsIGl0ZXIuaW5kZXgpOwotCXJjdV9yZWFkX3VubG9jaygpOwotfQotCi1zdGF0
aWMgc3RydWN0IHNnX3RhYmxlICoKLV9faTkxNV9nZW1fb2JqZWN0X3Vuc2V0X3BhZ2VzKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwotCXN0cnVjdCBzZ190YWJsZSAqcGFnZXM7
Ci0KLQlwYWdlcyA9IGZldGNoX2FuZF96ZXJvKCZvYmotPm1tLnBhZ2VzKTsKLQlpZiAoSVNfRVJS
X09SX05VTEwocGFnZXMpKQotCQlyZXR1cm4gcGFnZXM7Ci0KLQlzcGluX2xvY2soJmk5MTUtPm1t
Lm9ial9sb2NrKTsKLQlsaXN0X2RlbCgmb2JqLT5tbS5saW5rKTsKLQlzcGluX3VubG9jaygmaTkx
NS0+bW0ub2JqX2xvY2spOwotCi0JaWYgKG9iai0+bW0ubWFwcGluZykgewotCQl2b2lkICpwdHI7
Ci0KLQkJcHRyID0gcGFnZV9tYXNrX2JpdHMob2JqLT5tbS5tYXBwaW5nKTsKLQkJaWYgKGlzX3Zt
YWxsb2NfYWRkcihwdHIpKQotCQkJdnVubWFwKHB0cik7Ci0JCWVsc2UKLQkJCWt1bm1hcChrbWFw
X3RvX3BhZ2UocHRyKSk7Ci0KLQkJb2JqLT5tbS5tYXBwaW5nID0gTlVMTDsKLQl9Ci0KLQlfX2k5
MTVfZ2VtX29iamVjdF9yZXNldF9wYWdlX2l0ZXIob2JqKTsKLQlvYmotPm1tLnBhZ2Vfc2l6ZXMu
cGh5cyA9IG9iai0+bW0ucGFnZV9zaXplcy5zZyA9IDA7Ci0KLQlyZXR1cm4gcGFnZXM7Ci19Ci0K
LWludCBfX2k5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKLQkJCQllbnVtIGk5MTVfbW1fc3ViY2xhc3Mgc3ViY2xhc3MpCi17Ci0Jc3RydWN0
IHNnX3RhYmxlICpwYWdlczsKLQlpbnQgcmV0OwotCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNf
cGlubmVkX3BhZ2VzKG9iaikpCi0JCXJldHVybiAtRUJVU1k7Ci0KLQlHRU1fQlVHX09OKG9iai0+
YmluZF9jb3VudCk7Ci0KLQkvKiBNYXkgYmUgY2FsbGVkIGJ5IHNocmlua2VyIGZyb20gd2l0aGlu
IGdldF9wYWdlcygpIChvbiBhbm90aGVyIGJvKSAqLwotCW11dGV4X2xvY2tfbmVzdGVkKCZvYmot
Pm1tLmxvY2ssIHN1YmNsYXNzKTsKLQlpZiAodW5saWtlbHkoYXRvbWljX3JlYWQoJm9iai0+bW0u
cGFnZXNfcGluX2NvdW50KSkpIHsKLQkJcmV0ID0gLUVCVVNZOwotCQlnb3RvIHVubG9jazsKLQl9
Ci0KLQkvKgotCSAqIC0+cHV0X3BhZ2VzIG1pZ2h0IG5lZWQgdG8gYWxsb2NhdGUgbWVtb3J5IGZv
ciB0aGUgYml0MTcgc3dpenpsZQotCSAqIGFycmF5LCBoZW5jZSBwcm90ZWN0IHRoZW0gZnJvbSBi
ZWluZyByZWFwZWQgYnkgcmVtb3ZpbmcgdGhlbSBmcm9tIGd0dAotCSAqIGxpc3RzIGVhcmx5Lgot
CSAqLwotCXBhZ2VzID0gX19pOTE1X2dlbV9vYmplY3RfdW5zZXRfcGFnZXMob2JqKTsKLQotCS8q
Ci0JICogWFhYIFRlbXBvcmFyeSBoaWppbnggdG8gYXZvaWQgdXBkYXRpbmcgYWxsIGJhY2tlbmRz
IHRvIGhhbmRsZQotCSAqIE5VTEwgcGFnZXMuIEluIHRoZSBmdXR1cmUsIHdoZW4gd2UgaGF2ZSBt
b3JlIGFzeW5jaHJvbm91cwotCSAqIGdldF9wYWdlcyBiYWNrZW5kcyB3ZSBzaG91bGQgYmUgYmV0
dGVyIGFibGUgdG8gaGFuZGxlIHRoZQotCSAqIGNhbmNlbGxhdGlvbiBvZiB0aGUgYXN5bmMgdGFz
ayBpbiBhIG1vcmUgdW5pZm9ybSBtYW5uZXIuCi0JICovCi0JaWYgKCFwYWdlcyAmJiAhaTkxNV9n
ZW1fb2JqZWN0X25lZWRzX2FzeW5jX2NhbmNlbChvYmopKQotCQlwYWdlcyA9IEVSUl9QVFIoLUVJ
TlZBTCk7Ci0KLQlpZiAoIUlTX0VSUihwYWdlcykpCi0JCW9iai0+b3BzLT5wdXRfcGFnZXMob2Jq
LCBwYWdlcyk7Ci0KLQlyZXQgPSAwOwotdW5sb2NrOgotCW11dGV4X3VubG9jaygmb2JqLT5tbS5s
b2NrKTsKLQotCXJldHVybiByZXQ7Ci19Ci0KIGJvb2wgaTkxNV9zZ190cmltKHN0cnVjdCBzZ190
YWJsZSAqb3JpZ19zdCkKIHsKIAlzdHJ1Y3Qgc2dfdGFibGUgbmV3X3N0OwpAQCAtMjE0NywyNTIg
KzE5MDksNiBAQCBib29sIGk5MTVfc2dfdHJpbShzdHJ1Y3Qgc2dfdGFibGUgKm9yaWdfc3QpCiAJ
cmV0dXJuIHRydWU7CiB9CiAKLXZvaWQgX19pOTE1X2dlbV9vYmplY3Rfc2V0X3BhZ2VzKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMs
Ci0JCQkJIHVuc2lnbmVkIGludCBzZ19wYWdlX3NpemVzKQotewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKLQl1bnNpZ25lZCBsb25nIHN1
cHBvcnRlZCA9IElOVEVMX0lORk8oaTkxNSktPnBhZ2Vfc2l6ZXM7Ci0JaW50IGk7Ci0KLQlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZvYmotPm1tLmxvY2spOwotCi0JLyogTWFrZSB0aGUgcGFnZXMgY29o
ZXJlbnQgd2l0aCB0aGUgR1BVIChmbHVzaGluZyBhbnkgc3dhcGluKS4gKi8KLQlpZiAob2JqLT5j
YWNoZV9kaXJ0eSkgewotCQlvYmotPndyaXRlX2RvbWFpbiA9IDA7Ci0JCWlmIChpOTE1X2dlbV9v
YmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpCi0JCQlkcm1fY2xmbHVzaF9zZyhwYWdlcyk7Ci0J
CW9iai0+Y2FjaGVfZGlydHkgPSBmYWxzZTsKLQl9Ci0KLQlvYmotPm1tLmdldF9wYWdlLnNnX3Bv
cyA9IHBhZ2VzLT5zZ2w7Ci0Jb2JqLT5tbS5nZXRfcGFnZS5zZ19pZHggPSAwOwotCi0Jb2JqLT5t
bS5wYWdlcyA9IHBhZ2VzOwotCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9pc190aWxlZChvYmopICYm
Ci0JICAgIGk5MTUtPnF1aXJrcyAmIFFVSVJLX1BJTl9TV0laWkxFRF9QQUdFUykgewotCQlHRU1f
QlVHX09OKG9iai0+bW0ucXVpcmtlZCk7Ci0JCV9faTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhv
YmopOwotCQlvYmotPm1tLnF1aXJrZWQgPSB0cnVlOwotCX0KLQotCUdFTV9CVUdfT04oIXNnX3Bh
Z2Vfc2l6ZXMpOwotCW9iai0+bW0ucGFnZV9zaXplcy5waHlzID0gc2dfcGFnZV9zaXplczsKLQot
CS8qCi0JICogQ2FsY3VsYXRlIHRoZSBzdXBwb3J0ZWQgcGFnZS1zaXplcyB3aGljaCBmaXQgaW50
byB0aGUgZ2l2ZW4KLQkgKiBzZ19wYWdlX3NpemVzLiBUaGlzIHdpbGwgZ2l2ZSB1cyB0aGUgcGFn
ZS1zaXplcyB3aGljaCB3ZSBtYXkgYmUgYWJsZQotCSAqIHRvIHVzZSBvcHBvcnR1bmlzdGljYWxs
eSB3aGVuIGxhdGVyIGluc2VydGluZyBpbnRvIHRoZSBHVFQuIEZvcgotCSAqIGV4YW1wbGUgaWYg
cGh5cz0yRywgdGhlbiBpbiB0aGVvcnkgd2Ugc2hvdWxkIGJlIGFibGUgdG8gdXNlIDFHLCAyTSwK
LQkgKiA2NEsgb3IgNEsgcGFnZXMsIGFsdGhvdWdoIGluIHByYWN0aWNlIHRoaXMgd2lsbCBkZXBl
bmQgb24gYSBudW1iZXIgb2YKLQkgKiBvdGhlciBmYWN0b3JzLgotCSAqLwotCW9iai0+bW0ucGFn
ZV9zaXplcy5zZyA9IDA7Ci0JZm9yX2VhY2hfc2V0X2JpdChpLCAmc3VwcG9ydGVkLCBpbG9nMihJ
OTE1X0dUVF9NQVhfUEFHRV9TSVpFKSArIDEpIHsKLQkJaWYgKG9iai0+bW0ucGFnZV9zaXplcy5w
aHlzICYgfjB1IDw8IGkpCi0JCQlvYmotPm1tLnBhZ2Vfc2l6ZXMuc2cgfD0gQklUKGkpOwotCX0K
LQlHRU1fQlVHX09OKCFIQVNfUEFHRV9TSVpFUyhpOTE1LCBvYmotPm1tLnBhZ2Vfc2l6ZXMuc2cp
KTsKLQotCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwotCWxpc3RfYWRkKCZvYmotPm1t
LmxpbmssICZpOTE1LT5tbS51bmJvdW5kX2xpc3QpOwotCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5v
YmpfbG9jayk7Ci19Ci0KLXN0YXRpYyBpbnQgX19fX2k5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXMo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlpbnQgZXJyOwotCi0JaWYgKHVu
bGlrZWx5KG9iai0+bW0ubWFkdiAhPSBJOTE1X01BRFZfV0lMTE5FRUQpKSB7Ci0JCURSTV9ERUJV
RygiQXR0ZW1wdGluZyB0byBvYnRhaW4gYSBwdXJnZWFibGUgb2JqZWN0XG4iKTsKLQkJcmV0dXJu
IC1FRkFVTFQ7Ci0JfQotCi0JZXJyID0gb2JqLT5vcHMtPmdldF9wYWdlcyhvYmopOwotCUdFTV9C
VUdfT04oIWVyciAmJiAhaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKTsKLQotCXJldHVy
biBlcnI7Ci19Ci0KLS8qIEVuc3VyZSB0aGF0IHRoZSBhc3NvY2lhdGVkIHBhZ2VzIGFyZSBnYXRo
ZXJlZCBmcm9tIHRoZSBiYWNraW5nIHN0b3JhZ2UKLSAqIGFuZCBwaW5uZWQgaW50byBvdXIgb2Jq
ZWN0LiBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKCkgbWF5IGJlIGNhbGxlZAotICogbXVsdGlw
bGUgdGltZXMgYmVmb3JlIHRoZXkgYXJlIHJlbGVhc2VkIGJ5IGEgc2luZ2xlIGNhbGwgdG8KLSAq
IGk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcygpIC0gb25jZSB0aGUgcGFnZXMgYXJlIG5vIGxv
bmdlciByZWZlcmVuY2VkCi0gKiBlaXRoZXIgYXMgYSByZXN1bHQgb2YgbWVtb3J5IHByZXNzdXJl
IChyZWFwaW5nIHBhZ2VzIHVuZGVyIHRoZSBzaHJpbmtlcikKLSAqIG9yIGFzIHRoZSBvYmplY3Qg
aXMgaXRzZWxmIHJlbGVhc2VkLgotICovCi1pbnQgX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2Vz
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JaW50IGVycjsKLQotCWVyciA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmb2JqLT5tbS5sb2NrKTsKLQlpZiAoZXJyKQotCQly
ZXR1cm4gZXJyOwotCi0JaWYgKHVubGlrZWx5KCFpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9i
aikpKSB7Ci0JCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFnZXMob2Jq
KSk7Ci0KLQkJZXJyID0gX19fX2k5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXMob2JqKTsKLQkJaWYg
KGVycikKLQkJCWdvdG8gdW5sb2NrOwotCi0JCXNtcF9tYl9fYmVmb3JlX2F0b21pYygpOwotCX0K
LQlhdG9taWNfaW5jKCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCk7Ci0KLXVubG9jazoKLQltdXRl
eF91bmxvY2soJm9iai0+bW0ubG9jayk7Ci0JcmV0dXJuIGVycjsKLX0KLQotLyogVGhlICdtYXBw
aW5nJyBwYXJ0IG9mIGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKCkgYmVsb3cgKi8KLXN0YXRpYyB2
b2lkICppOTE1X2dlbV9vYmplY3RfbWFwKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCi0JCQkJIGVudW0gaTkxNV9tYXBfdHlwZSB0eXBlKQotewotCXVuc2lnbmVkIGxvbmcg
bl9wYWdlcyA9IG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJRlQ7Ci0Jc3RydWN0IHNnX3RhYmxl
ICpzZ3QgPSBvYmotPm1tLnBhZ2VzOwotCXN0cnVjdCBzZ3RfaXRlciBzZ3RfaXRlcjsKLQlzdHJ1
Y3QgcGFnZSAqcGFnZTsKLQlzdHJ1Y3QgcGFnZSAqc3RhY2tfcGFnZXNbMzJdOwotCXN0cnVjdCBw
YWdlICoqcGFnZXMgPSBzdGFja19wYWdlczsKLQl1bnNpZ25lZCBsb25nIGkgPSAwOwotCXBncHJv
dF90IHBncHJvdDsKLQl2b2lkICphZGRyOwotCi0JLyogQSBzaW5nbGUgcGFnZSBjYW4gYWx3YXlz
IGJlIGttYXBwZWQgKi8KLQlpZiAobl9wYWdlcyA9PSAxICYmIHR5cGUgPT0gSTkxNV9NQVBfV0Ip
Ci0JCXJldHVybiBrbWFwKHNnX3BhZ2Uoc2d0LT5zZ2wpKTsKLQotCWlmIChuX3BhZ2VzID4gQVJS
QVlfU0laRShzdGFja19wYWdlcykpIHsKLQkJLyogVG9vIGJpZyBmb3Igc3RhY2sgLS0gYWxsb2Nh
dGUgdGVtcG9yYXJ5IGFycmF5IGluc3RlYWQgKi8KLQkJcGFnZXMgPSBrdm1hbGxvY19hcnJheShu
X3BhZ2VzLCBzaXplb2YoKnBhZ2VzKSwgR0ZQX0tFUk5FTCk7Ci0JCWlmICghcGFnZXMpCi0JCQly
ZXR1cm4gTlVMTDsKLQl9Ci0KLQlmb3JfZWFjaF9zZ3RfcGFnZShwYWdlLCBzZ3RfaXRlciwgc2d0
KQotCQlwYWdlc1tpKytdID0gcGFnZTsKLQotCS8qIENoZWNrIHRoYXQgd2UgaGF2ZSB0aGUgZXhw
ZWN0ZWQgbnVtYmVyIG9mIHBhZ2VzICovCi0JR0VNX0JVR19PTihpICE9IG5fcGFnZXMpOwotCi0J
c3dpdGNoICh0eXBlKSB7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKHR5cGUpOwotCQkvKiBm
YWxsdGhyb3VnaCB0byB1c2UgUEFHRV9LRVJORUwgYW55d2F5ICovCi0JY2FzZSBJOTE1X01BUF9X
QjoKLQkJcGdwcm90ID0gUEFHRV9LRVJORUw7Ci0JCWJyZWFrOwotCWNhc2UgSTkxNV9NQVBfV0M6
Ci0JCXBncHJvdCA9IHBncHJvdF93cml0ZWNvbWJpbmUoUEFHRV9LRVJORUxfSU8pOwotCQlicmVh
azsKLQl9Ci0JYWRkciA9IHZtYXAocGFnZXMsIG5fcGFnZXMsIDAsIHBncHJvdCk7Ci0KLQlpZiAo
cGFnZXMgIT0gc3RhY2tfcGFnZXMpCi0JCWt2ZnJlZShwYWdlcyk7Ci0KLQlyZXR1cm4gYWRkcjsK
LX0KLQotLyogZ2V0LCBwaW4sIGFuZCBtYXAgdGhlIHBhZ2VzIG9mIHRoZSBvYmplY3QgaW50byBr
ZXJuZWwgc3BhY2UgKi8KLXZvaWQgKmk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkgICAgICBlbnVtIGk5MTVfbWFwX3R5cGUgdHlwZSkK
LXsKLQllbnVtIGk5MTVfbWFwX3R5cGUgaGFzX3R5cGU7Ci0JYm9vbCBwaW5uZWQ7Ci0Jdm9pZCAq
cHRyOwotCWludCByZXQ7Ci0KLQlpZiAodW5saWtlbHkoIWk5MTVfZ2VtX29iamVjdF9oYXNfc3Ry
dWN0X3BhZ2Uob2JqKSkpCi0JCXJldHVybiBFUlJfUFRSKC1FTlhJTyk7Ci0KLQlyZXQgPSBtdXRl
eF9sb2NrX2ludGVycnVwdGlibGUoJm9iai0+bW0ubG9jayk7Ci0JaWYgKHJldCkKLQkJcmV0dXJu
IEVSUl9QVFIocmV0KTsKLQotCXBpbm5lZCA9ICEodHlwZSAmIEk5MTVfTUFQX09WRVJSSURFKTsK
LQl0eXBlICY9IH5JOTE1X01BUF9PVkVSUklERTsKLQotCWlmICghYXRvbWljX2luY19ub3RfemVy
bygmb2JqLT5tbS5wYWdlc19waW5fY291bnQpKSB7Ci0JCWlmICh1bmxpa2VseSghaTkxNV9nZW1f
b2JqZWN0X2hhc19wYWdlcyhvYmopKSkgewotCQkJR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3Rf
aGFzX3Bpbm5lZF9wYWdlcyhvYmopKTsKLQotCQkJcmV0ID0gX19fX2k5MTVfZ2VtX29iamVjdF9n
ZXRfcGFnZXMob2JqKTsKLQkJCWlmIChyZXQpCi0JCQkJZ290byBlcnJfdW5sb2NrOwotCi0JCQlz
bXBfbWJfX2JlZm9yZV9hdG9taWMoKTsKLQkJfQotCQlhdG9taWNfaW5jKCZvYmotPm1tLnBhZ2Vz
X3Bpbl9jb3VudCk7Ci0JCXBpbm5lZCA9IGZhbHNlOwotCX0KLQlHRU1fQlVHX09OKCFpOTE1X2dl
bV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpOwotCi0JcHRyID0gcGFnZV91bnBhY2tfYml0cyhvYmot
Pm1tLm1hcHBpbmcsICZoYXNfdHlwZSk7Ci0JaWYgKHB0ciAmJiBoYXNfdHlwZSAhPSB0eXBlKSB7
Ci0JCWlmIChwaW5uZWQpIHsKLQkJCXJldCA9IC1FQlVTWTsKLQkJCWdvdG8gZXJyX3VucGluOwot
CQl9Ci0KLQkJaWYgKGlzX3ZtYWxsb2NfYWRkcihwdHIpKQotCQkJdnVubWFwKHB0cik7Ci0JCWVs
c2UKLQkJCWt1bm1hcChrbWFwX3RvX3BhZ2UocHRyKSk7Ci0KLQkJcHRyID0gb2JqLT5tbS5tYXBw
aW5nID0gTlVMTDsKLQl9Ci0KLQlpZiAoIXB0cikgewotCQlwdHIgPSBpOTE1X2dlbV9vYmplY3Rf
bWFwKG9iaiwgdHlwZSk7Ci0JCWlmICghcHRyKSB7Ci0JCQlyZXQgPSAtRU5PTUVNOwotCQkJZ290
byBlcnJfdW5waW47Ci0JCX0KLQotCQlvYmotPm1tLm1hcHBpbmcgPSBwYWdlX3BhY2tfYml0cyhw
dHIsIHR5cGUpOwotCX0KLQotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJm9iai0+bW0ubG9j
ayk7Ci0JcmV0dXJuIHB0cjsKLQotZXJyX3VucGluOgotCWF0b21pY19kZWMoJm9iai0+bW0ucGFn
ZXNfcGluX2NvdW50KTsKLWVycl91bmxvY2s6Ci0JcHRyID0gRVJSX1BUUihyZXQpOwotCWdvdG8g
b3V0X3VubG9jazsKLX0KLQotdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJCQkgdW5zaWduZWQgbG9uZyBvZmZzZXQsCi0J
CQkJIHVuc2lnbmVkIGxvbmcgc2l6ZSkKLXsKLQllbnVtIGk5MTVfbWFwX3R5cGUgaGFzX3R5cGU7
Ci0Jdm9pZCAqcHRyOwotCi0JR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRf
cGFnZXMob2JqKSk7Ci0JR0VNX0JVR19PTihyYW5nZV9vdmVyZmxvd3NfdCh0eXBlb2Yob2JqLT5i
YXNlLnNpemUpLAotCQkJCSAgICAgb2Zmc2V0LCBzaXplLCBvYmotPmJhc2Uuc2l6ZSkpOwotCi0J
b2JqLT5tbS5kaXJ0eSA9IHRydWU7Ci0KLQlpZiAob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVf
Qk9fQ0FDSEVfQ09IRVJFTlRfRk9SX1dSSVRFKQotCQlyZXR1cm47Ci0KLQlwdHIgPSBwYWdlX3Vu
cGFja19iaXRzKG9iai0+bW0ubWFwcGluZywgJmhhc190eXBlKTsKLQlpZiAoaGFzX3R5cGUgPT0g
STkxNV9NQVBfV0MpCi0JCXJldHVybjsKLQotCWRybV9jbGZsdXNoX3ZpcnRfcmFuZ2UocHRyICsg
b2Zmc2V0LCBzaXplKTsKLQlpZiAoc2l6ZSA9PSBvYmotPmJhc2Uuc2l6ZSkgewotCQlvYmotPndy
aXRlX2RvbWFpbiAmPSB+STkxNV9HRU1fRE9NQUlOX0NQVTsKLQkJb2JqLT5jYWNoZV9kaXJ0eSA9
IGZhbHNlOwotCX0KLX0KLQogc3RhdGljIHVuc2lnbmVkIGxvbmcgdG9fd2FpdF90aW1lb3V0KHM2
NCB0aW1lb3V0X25zKQogewogCWlmICh0aW1lb3V0X25zIDwgMCkKQEAgLTMzODEsNyArMjg5Nyw3
IEBAIGk5MTVfZ2VtX21hZHZpc2VfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAq
ZGF0YSwKIAkvKiBpZiB0aGUgb2JqZWN0IGlzIG5vIGxvbmdlciBhdHRhY2hlZCwgZGlzY2FyZCBp
dHMgYmFja2luZyBzdG9yYWdlICovCiAJaWYgKG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfRE9O
VE5FRUQgJiYKIAkgICAgIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkKLQkJX19pOTE1
X2dlbV9vYmplY3RfdHJ1bmNhdGUob2JqKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3RydW5jYXRlKG9i
aik7CiAKIAlhcmdzLT5yZXRhaW5lZCA9IG9iai0+bW0ubWFkdiAhPSBfX0k5MTVfTUFEVl9QVVJH
RUQ7CiAJbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwpAQCAtNDE1NywyMzIgKzM2NzMsNiBA
QCB2b2lkIGk5MTVfZ2VtX3RyYWNrX2ZiKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvbGQs
CiAJfQogfQogCi1zdHJ1Y3Qgc2NhdHRlcmxpc3QgKgotaTkxNV9nZW1fb2JqZWN0X2dldF9zZyhz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkgICAgICAgdW5zaWduZWQgaW50IG4s
Ci0JCSAgICAgICB1bnNpZ25lZCBpbnQgKm9mZnNldCkKLXsKLQlzdHJ1Y3QgaTkxNV9nZW1fb2Jq
ZWN0X3BhZ2VfaXRlciAqaXRlciA9ICZvYmotPm1tLmdldF9wYWdlOwotCXN0cnVjdCBzY2F0dGVy
bGlzdCAqc2c7Ci0JdW5zaWduZWQgaW50IGlkeCwgY291bnQ7Ci0KLQltaWdodF9zbGVlcCgpOwot
CUdFTV9CVUdfT04obiA+PSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUKTsKLQlHRU1fQlVH
X09OKCFpOTE1X2dlbV9vYmplY3RfaGFzX3Bpbm5lZF9wYWdlcyhvYmopKTsKLQotCS8qIEFzIHdl
IGl0ZXJhdGUgZm9yd2FyZCB0aHJvdWdoIHRoZSBzZywgd2UgcmVjb3JkIGVhY2ggZW50cnkgaW4g
YQotCSAqIHJhZGl4dHJlZSBmb3IgcXVpY2sgcmVwZWF0ZWQgKGJhY2t3YXJkcykgbG9va3Vwcy4g
SWYgd2UgaGF2ZSBzZWVuCi0JICogdGhpcyBpbmRleCBwcmV2aW91c2x5LCB3ZSB3aWxsIGhhdmUg
YW4gZW50cnkgZm9yIGl0LgotCSAqCi0JICogSW5pdGlhbCBsb29rdXAgaXMgTyhOKSwgYnV0IHRo
aXMgaXMgYW1vcnRpemVkIHRvIE8oMSkgZm9yCi0JICogc2VxdWVudGlhbCBwYWdlIGFjY2VzcyAo
d2hlcmUgZWFjaCBuZXcgcmVxdWVzdCBpcyBjb25zZWN1dGl2ZQotCSAqIHRvIHRoZSBwcmV2aW91
cyBvbmUpLiBSZXBlYXRlZCBsb29rdXBzIGFyZSBPKGxnKG9iai0+YmFzZS5zaXplKSksCi0JICog
aS5lLiBPKDEpIHdpdGggYSBsYXJnZSBjb25zdGFudCEKLQkgKi8KLQlpZiAobiA8IFJFQURfT05D
RShpdGVyLT5zZ19pZHgpKQotCQlnb3RvIGxvb2t1cDsKLQotCW11dGV4X2xvY2soJml0ZXItPmxv
Y2spOwotCi0JLyogV2UgcHJlZmVyIHRvIHJldXNlIHRoZSBsYXN0IHNnIHNvIHRoYXQgcmVwZWF0
ZWQgbG9va3VwIG9mIHRoaXMKLQkgKiAob3IgdGhlIHN1YnNlcXVlbnQpIHNnIGFyZSBmYXN0IC0g
Y29tcGFyaW5nIGFnYWluc3QgdGhlIGxhc3QKLQkgKiBzZyBpcyBmYXN0ZXIgdGhhbiBnb2luZyB0
aHJvdWdoIHRoZSByYWRpeHRyZWUuCi0JICovCi0KLQlzZyA9IGl0ZXItPnNnX3BvczsKLQlpZHgg
PSBpdGVyLT5zZ19pZHg7Ci0JY291bnQgPSBfX3NnX3BhZ2VfY291bnQoc2cpOwotCi0Jd2hpbGUg
KGlkeCArIGNvdW50IDw9IG4pIHsKLQkJdm9pZCAqZW50cnk7Ci0JCXVuc2lnbmVkIGxvbmcgaTsK
LQkJaW50IHJldDsKLQotCQkvKiBJZiB3ZSBjYW5ub3QgYWxsb2NhdGUgYW5kIGluc2VydCB0aGlz
IGVudHJ5LCBvciB0aGUKLQkJICogaW5kaXZpZHVhbCBwYWdlcyBmcm9tIHRoaXMgcmFuZ2UsIGNh
bmNlbCB1cGRhdGluZyB0aGUKLQkJICogc2dfaWR4IHNvIHRoYXQgb24gdGhpcyBsb29rdXAgd2Ug
YXJlIGZvcmNlZCB0byBsaW5lYXJseQotCQkgKiBzY2FuIG9ud2FyZHMsIGJ1dCBvbiBmdXR1cmUg
bG9va3VwcyB3ZSB3aWxsIHRyeSB0aGUKLQkJICogaW5zZXJ0aW9uIGFnYWluIChpbiB3aGljaCBj
YXNlIHdlIG5lZWQgdG8gYmUgY2FyZWZ1bCBvZgotCQkgKiB0aGUgZXJyb3IgcmV0dXJuIHJlcG9y
dGluZyB0aGF0IHdlIGhhdmUgYWxyZWFkeSBpbnNlcnRlZAotCQkgKiB0aGlzIGluZGV4KS4KLQkJ
ICovCi0JCXJldCA9IHJhZGl4X3RyZWVfaW5zZXJ0KCZpdGVyLT5yYWRpeCwgaWR4LCBzZyk7Ci0J
CWlmIChyZXQgJiYgcmV0ICE9IC1FRVhJU1QpCi0JCQlnb3RvIHNjYW47Ci0KLQkJZW50cnkgPSB4
YV9ta192YWx1ZShpZHgpOwotCQlmb3IgKGkgPSAxOyBpIDwgY291bnQ7IGkrKykgewotCQkJcmV0
ID0gcmFkaXhfdHJlZV9pbnNlcnQoJml0ZXItPnJhZGl4LCBpZHggKyBpLCBlbnRyeSk7Ci0JCQlp
ZiAocmV0ICYmIHJldCAhPSAtRUVYSVNUKQotCQkJCWdvdG8gc2NhbjsKLQkJfQotCi0JCWlkeCAr
PSBjb3VudDsKLQkJc2cgPSBfX19fc2dfbmV4dChzZyk7Ci0JCWNvdW50ID0gX19zZ19wYWdlX2Nv
dW50KHNnKTsKLQl9Ci0KLXNjYW46Ci0JaXRlci0+c2dfcG9zID0gc2c7Ci0JaXRlci0+c2dfaWR4
ID0gaWR4OwotCi0JbXV0ZXhfdW5sb2NrKCZpdGVyLT5sb2NrKTsKLQotCWlmICh1bmxpa2VseShu
IDwgaWR4KSkgLyogaW5zZXJ0aW9uIGNvbXBsZXRlZCBieSBhbm90aGVyIHRocmVhZCAqLwotCQln
b3RvIGxvb2t1cDsKLQotCS8qIEluIGNhc2Ugd2UgZmFpbGVkIHRvIGluc2VydCB0aGUgZW50cnkg
aW50byB0aGUgcmFkaXh0cmVlLCB3ZSBuZWVkCi0JICogdG8gbG9vayBiZXlvbmQgdGhlIGN1cnJl
bnQgc2cuCi0JICovCi0Jd2hpbGUgKGlkeCArIGNvdW50IDw9IG4pIHsKLQkJaWR4ICs9IGNvdW50
OwotCQlzZyA9IF9fX19zZ19uZXh0KHNnKTsKLQkJY291bnQgPSBfX3NnX3BhZ2VfY291bnQoc2cp
OwotCX0KLQotCSpvZmZzZXQgPSBuIC0gaWR4OwotCXJldHVybiBzZzsKLQotbG9va3VwOgotCXJj
dV9yZWFkX2xvY2soKTsKLQotCXNnID0gcmFkaXhfdHJlZV9sb29rdXAoJml0ZXItPnJhZGl4LCBu
KTsKLQlHRU1fQlVHX09OKCFzZyk7Ci0KLQkvKiBJZiB0aGlzIGluZGV4IGlzIGluIHRoZSBtaWRk
bGUgb2YgbXVsdGktcGFnZSBzZyBlbnRyeSwKLQkgKiB0aGUgcmFkaXggdHJlZSB3aWxsIGNvbnRh
aW4gYSB2YWx1ZSBlbnRyeSB0aGF0IHBvaW50cwotCSAqIHRvIHRoZSBzdGFydCBvZiB0aGF0IHJh
bmdlLiBXZSB3aWxsIHJldHVybiB0aGUgcG9pbnRlciB0bwotCSAqIHRoZSBiYXNlIHBhZ2UgYW5k
IHRoZSBvZmZzZXQgb2YgdGhpcyBwYWdlIHdpdGhpbiB0aGUKLQkgKiBzZyBlbnRyeSdzIHJhbmdl
LgotCSAqLwotCSpvZmZzZXQgPSAwOwotCWlmICh1bmxpa2VseSh4YV9pc192YWx1ZShzZykpKSB7
Ci0JCXVuc2lnbmVkIGxvbmcgYmFzZSA9IHhhX3RvX3ZhbHVlKHNnKTsKLQotCQlzZyA9IHJhZGl4
X3RyZWVfbG9va3VwKCZpdGVyLT5yYWRpeCwgYmFzZSk7Ci0JCUdFTV9CVUdfT04oIXNnKTsKLQot
CQkqb2Zmc2V0ID0gbiAtIGJhc2U7Ci0JfQotCi0JcmN1X3JlYWRfdW5sb2NrKCk7Ci0KLQlyZXR1
cm4gc2c7Ci19Ci0KLXN0cnVjdCBwYWdlICoKLWk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZShzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1bnNpZ25lZCBpbnQgbikKLXsKLQlzdHJ1Y3Qg
c2NhdHRlcmxpc3QgKnNnOwotCXVuc2lnbmVkIGludCBvZmZzZXQ7Ci0KLQlHRU1fQlVHX09OKCFp
OTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpOwotCi0Jc2cgPSBpOTE1X2dlbV9v
YmplY3RfZ2V0X3NnKG9iaiwgbiwgJm9mZnNldCk7Ci0JcmV0dXJuIG50aF9wYWdlKHNnX3BhZ2Uo
c2cpLCBvZmZzZXQpOwotfQotCi0vKiBMaWtlIGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZSgpLCBi
dXQgbWFyayB0aGUgcmV0dXJuZWQgcGFnZSBkaXJ0eSAqLwotc3RydWN0IHBhZ2UgKgotaTkxNV9n
ZW1fb2JqZWN0X2dldF9kaXJ0eV9wYWdlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
Ci0JCQkgICAgICAgdW5zaWduZWQgaW50IG4pCi17Ci0Jc3RydWN0IHBhZ2UgKnBhZ2U7Ci0KLQlw
YWdlID0gaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlKG9iaiwgbik7Ci0JaWYgKCFvYmotPm1tLmRp
cnR5KQotCQlzZXRfcGFnZV9kaXJ0eShwYWdlKTsKLQotCXJldHVybiBwYWdlOwotfQotCi1kbWFf
YWRkcl90Ci1pOTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRyZXNzX2xlbihzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCSAgICB1bnNpZ25lZCBsb25nIG4sCi0JCQkJICAgIHVu
c2lnbmVkIGludCAqbGVuKQotewotCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7Ci0JdW5zaWduZWQg
aW50IG9mZnNldDsKLQotCXNnID0gaTkxNV9nZW1fb2JqZWN0X2dldF9zZyhvYmosIG4sICZvZmZz
ZXQpOwotCi0JaWYgKGxlbikKLQkJKmxlbiA9IHNnX2RtYV9sZW4oc2cpIC0gKG9mZnNldCA8PCBQ
QUdFX1NISUZUKTsKLQotCXJldHVybiBzZ19kbWFfYWRkcmVzcyhzZykgKyAob2Zmc2V0IDw8IFBB
R0VfU0hJRlQpOwotfQotCi1kbWFfYWRkcl90Ci1pOTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRy
ZXNzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJdW5zaWduZWQgbG9uZyBu
KQotewotCXJldHVybiBpOTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRyZXNzX2xlbihvYmosIG4s
IE5VTEwpOwotfQotCi0KLWludCBpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgaW50IGFsaWduKQotewotCXN0cnVjdCBzZ190YWJsZSAq
cGFnZXM7Ci0JaW50IGVycjsKLQotCWlmIChhbGlnbiA+IG9iai0+YmFzZS5zaXplKQotCQlyZXR1
cm4gLUVJTlZBTDsKLQotCWlmIChvYmotPm9wcyA9PSAmaTkxNV9nZW1fcGh5c19vcHMpCi0JCXJl
dHVybiAwOwotCi0JaWYgKG9iai0+b3BzICE9ICZpOTE1X2dlbV9zaG1lbV9vcHMpCi0JCXJldHVy
biAtRUlOVkFMOwotCi0JZXJyID0gaTkxNV9nZW1fb2JqZWN0X3VuYmluZChvYmopOwotCWlmIChl
cnIpCi0JCXJldHVybiBlcnI7Ci0KLQltdXRleF9sb2NrKCZvYmotPm1tLmxvY2spOwotCi0JaWYg
KG9iai0+bW0ubWFkdiAhPSBJOTE1X01BRFZfV0lMTE5FRUQpIHsKLQkJZXJyID0gLUVGQVVMVDsK
LQkJZ290byBlcnJfdW5sb2NrOwotCX0KLQotCWlmIChvYmotPm1tLnF1aXJrZWQpIHsKLQkJZXJy
ID0gLUVGQVVMVDsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KLQotCWlmIChvYmotPm1tLm1hcHBp
bmcpIHsKLQkJZXJyID0gLUVCVVNZOwotCQlnb3RvIGVycl91bmxvY2s7Ci0JfQotCi0JcGFnZXMg
PSBfX2k5MTVfZ2VtX29iamVjdF91bnNldF9wYWdlcyhvYmopOwotCi0Jb2JqLT5vcHMgPSAmaTkx
NV9nZW1fcGh5c19vcHM7Ci0KLQllcnIgPSBfX19faTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlcyhv
YmopOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX3hmZXI7Ci0KLQkvKiBQZXJtYS1waW4gKHVudGls
IHJlbGVhc2UpIHRoZSBwaHlzaWNhbCBzZXQgb2YgcGFnZXMgKi8KLQlfX2k5MTVfZ2VtX29iamVj
dF9waW5fcGFnZXMob2JqKTsKLQotCWlmICghSVNfRVJSX09SX05VTEwocGFnZXMpKQotCQlpOTE1
X2dlbV9zaG1lbV9vcHMucHV0X3BhZ2VzKG9iaiwgcGFnZXMpOwotCW11dGV4X3VubG9jaygmb2Jq
LT5tbS5sb2NrKTsKLQlyZXR1cm4gMDsKLQotZXJyX3hmZXI6Ci0Jb2JqLT5vcHMgPSAmaTkxNV9n
ZW1fc2htZW1fb3BzOwotCWlmICghSVNfRVJSX09SX05VTEwocGFnZXMpKSB7Ci0JCXVuc2lnbmVk
IGludCBzZ19wYWdlX3NpemVzID0gaTkxNV9zZ19wYWdlX3NpemVzKHBhZ2VzLT5zZ2wpOwotCi0J
CV9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHBhZ2VzLCBzZ19wYWdlX3NpemVzKTsK
LQl9Ci1lcnJfdW5sb2NrOgotCW11dGV4X3VubG9jaygmb2JqLT5tbS5sb2NrKTsKLQlyZXR1cm4g
ZXJyOwotfQotCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCiAjaW5j
bHVkZSAic2VsZnRlc3RzL3NjYXR0ZXJsaXN0LmMiCiAjaW5jbHVkZSAic2VsZnRlc3RzL21vY2tf
Z2VtX2RldmljZS5jIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
c2hyaW5rZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3Nocmlua2VyLmMKaW5k
ZXggNTg4ZTM4OThiMTIwLi4yYzdhZWZiM2UxMDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fc2hyaW5rZXIuYwpAQCAtMTE0LDY1ICsxMTQsMTggQEAgc3RhdGljIGJvb2wgdW5zYWZl
X2Ryb3BfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlyZXR1cm4gIWk5
MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKTsKIH0KIAotc3RhdGljIHZvaWQgX19zdGFydF93
cml0ZWJhY2soc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJCSAgICAgIHVuc2ln
bmVkIGludCBmbGFncykKK3N0YXRpYyB2b2lkIHRyeV90b193cml0ZWJhY2soc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCSAgICAgdW5zaWduZWQgaW50IGZsYWdzKQogewotCXN0
cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nOwotCXN0cnVjdCB3cml0ZWJhY2tfY29udHJvbCB3
YmMgPSB7Ci0JCS5zeW5jX21vZGUgPSBXQl9TWU5DX05PTkUsCi0JCS5ucl90b193cml0ZSA9IFNX
QVBfQ0xVU1RFUl9NQVgsCi0JCS5yYW5nZV9zdGFydCA9IDAsCi0JCS5yYW5nZV9lbmQgPSBMTE9O
R19NQVgsCi0JCS5mb3JfcmVjbGFpbSA9IDEsCi0JfTsKLQl1bnNpZ25lZCBsb25nIGk7Ci0KLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPm1tLmxvY2spOwotCUdFTV9CVUdfT04oaTkxNV9nZW1f
b2JqZWN0X2hhc19wYWdlcyhvYmopKTsKLQogCXN3aXRjaCAob2JqLT5tbS5tYWR2KSB7CiAJY2Fz
ZSBJOTE1X01BRFZfRE9OVE5FRUQ6Ci0JCV9faTkxNV9nZW1fb2JqZWN0X3RydW5jYXRlKG9iaik7
CisJCWk5MTVfZ2VtX29iamVjdF90cnVuY2F0ZShvYmopOwogCWNhc2UgX19JOTE1X01BRFZfUFVS
R0VEOgogCQlyZXR1cm47CiAJfQogCi0JaWYgKCFvYmotPmJhc2UuZmlscCkKLQkJcmV0dXJuOwot
Ci0JaWYgKCEoZmxhZ3MgJiBJOTE1X1NIUklOS19XUklURUJBQ0spKQotCQlyZXR1cm47Ci0KLQkv
KgotCSAqIExlYXZlIG1tYXBpbmdzIGludGFjdCAoR1RUIHdpbGwgaGF2ZSBiZWVuIHJldm9rZWQg
b24gdW5iaW5kaW5nLAotCSAqIGxlYXZpbmcgb25seSBDUFUgbW1hcGluZ3MgYXJvdW5kKSBhbmQg
YWRkIHRob3NlIHBhZ2VzIHRvIHRoZSBMUlUKLQkgKiBpbnN0ZWFkIG9mIGludm9raW5nIHdyaXRl
YmFjayBzbyB0aGV5IGFyZSBhZ2VkIGFuZCBwYWdlZCBvdXQKLQkgKiBhcyBub3JtYWwuCi0JICov
Ci0JbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5mX21hcHBpbmc7Ci0KLQkvKiBCZWdpbiB3cml0
ZWJhY2sgb24gZWFjaCBkaXJ0eSBwYWdlICovCi0JZm9yIChpID0gMDsgaSA8IG9iai0+YmFzZS5z
aXplID4+IFBBR0VfU0hJRlQ7IGkrKykgewotCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKLQotCQlwYWdl
ID0gZmluZF9sb2NrX2VudHJ5KG1hcHBpbmcsIGkpOwotCQlpZiAoIXBhZ2UgfHwgeGFfaXNfdmFs
dWUocGFnZSkpCi0JCQljb250aW51ZTsKLQotCQlpZiAoIXBhZ2VfbWFwcGVkKHBhZ2UpICYmIGNs
ZWFyX3BhZ2VfZGlydHlfZm9yX2lvKHBhZ2UpKSB7Ci0JCQlpbnQgcmV0OwotCi0JCQlTZXRQYWdl
UmVjbGFpbShwYWdlKTsKLQkJCXJldCA9IG1hcHBpbmctPmFfb3BzLT53cml0ZXBhZ2UocGFnZSwg
JndiYyk7Ci0JCQlpZiAoIVBhZ2VXcml0ZWJhY2socGFnZSkpCi0JCQkJQ2xlYXJQYWdlUmVjbGFp
bShwYWdlKTsKLQkJCWlmICghcmV0KQotCQkJCWdvdG8gcHV0OwotCQl9Ci0JCXVubG9ja19wYWdl
KHBhZ2UpOwotcHV0OgotCQlwdXRfcGFnZShwYWdlKTsKLQl9CisJaWYgKGZsYWdzICYgSTkxNV9T
SFJJTktfV1JJVEVCQUNLKQorCQlpOTE1X2dlbV9vYmplY3Rfd3JpdGViYWNrKG9iaik7CiB9CiAK
IC8qKgpAQCAtMzE1LDcgKzI2OCw3IEBAIGk5MTVfZ2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQltdXRleF9sb2NrX25lc3RlZCgmb2JqLT5tbS5sb2NrLAogCQkJ
CQkJICBJOTE1X01NX1NIUklOS0VSKTsKIAkJCQlpZiAoIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFn
ZXMob2JqKSkgewotCQkJCQlfX3N0YXJ0X3dyaXRlYmFjayhvYmosIGZsYWdzKTsKKwkJCQkJdHJ5
X3RvX3dyaXRlYmFjayhvYmosIGZsYWdzKTsKIAkJCQkJY291bnQgKz0gb2JqLT5iYXNlLnNpemUg
Pj4gUEFHRV9TSElGVDsKIAkJCQl9CiAJCQkJbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVj
dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jCmlu
ZGV4IGEwZjU5ZmIwZDcwMS4uYjk4YTI4NmE4YmU1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jCkBAIC00OSw1OSArNDksNiBAQCBzdGF0
aWMgaW50IGlndF9nZW1fb2JqZWN0KHZvaWQgKmFyZykKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0
aWMgaW50IGlndF9waHlzX29iamVjdCh2b2lkICphcmcpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBhcmc7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlp
bnQgZXJyOwotCi0JLyogQ3JlYXRlIGFuIG9iamVjdCBhbmQgYmluZCBpdCB0byBhIGNvbnRpZ3Vv
dXMgc2V0IG9mIHBoeXNpY2FsIHBhZ2VzLAotCSAqIGkuZS4gZXhlcmNpc2UgdGhlIGk5MTVfZ2Vt
X29iamVjdF9waHlzIEFQSS4KLQkgKi8KLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
c2htZW0oaTkxNSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRS
X0VSUihvYmopOwotCQlwcl9lcnIoImk5MTVfZ2VtX29iamVjdF9jcmVhdGUgZmFpbGVkLCBlcnI9
JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0OwotCX0KLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyhvYmosIFBB
R0VfU0laRSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAo
ZXJyKSB7Ci0JCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzIGZhaWxlZCwgZXJy
PSVkXG4iLCBlcnIpOwotCQlnb3RvIG91dF9vYmo7Ci0JfQotCi0JaWYgKG9iai0+b3BzICE9ICZp
OTE1X2dlbV9waHlzX29wcykgewotCQlwcl9lcnIoImk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5
cyBkaWQgbm90IGNyZWF0ZSBhIHBoeXMgb2JqZWN0XG4iKTsKLQkJZXJyID0gLUVJTlZBTDsKLQkJ
Z290byBvdXRfb2JqOwotCX0KLQotCWlmICghYXRvbWljX3JlYWQoJm9iai0+bW0ucGFnZXNfcGlu
X2NvdW50KSkgewotCQlwcl9lcnIoImk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyBkaWQgbm90
IHBpbiBpdHMgcGh5cyBwYWdlc1xuIik7Ci0JCWVyciA9IC1FSU5WQUw7Ci0JCWdvdG8gb3V0X29i
ajsKLQl9Ci0KLQkvKiBNYWtlIHRoZSBvYmplY3QgZGlydHkgc28gdGhhdCBwdXRfcGFnZXMgbXVz
dCBkbyBjb3B5IGJhY2sgdGhlIGRhdGEgKi8KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob2JqLCB0
cnVlKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChlcnIp
IHsKLQkJcHJfZXJyKCJpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4gZmFpbGVkIHdp
dGggZXJyPSVkXG4iLAotCQkgICAgICAgZXJyKTsKLQkJZ290byBvdXRfb2JqOwotCX0KLQotb3V0
X29iajoKLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1vdXQ6Ci0JcmV0dXJuIGVycjsKLX0K
LQogc3RhdGljIGludCBpZ3RfZ2VtX2h1Z2Uodm9pZCAqYXJnKQogewogCWNvbnN0IHVuc2lnbmVk
IGludCBucmVhbCA9IDUwOTsgLyoganVzdCB0byBiZSBhd2t3YXJkICovCkBAIC02MzEsNyArNTc4
LDYgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogewogCXN0YXRp
YyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CiAJCVNVQlRFU1QoaWd0X2dl
bV9vYmplY3QpLAotCQlTVUJURVNUKGlndF9waHlzX29iamVjdCksCiAJfTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNTsKIAlpbnQgZXJyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbW9ja19zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X21vY2tfc2VsZnRlc3RzLmgKaW5kZXggODhlNWFiNTg2MzM3
Li41MTBlYjE3NmJiMmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X21vY2tfc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfbW9ja19zZWxmdGVzdHMuaApAQCAtMTgsNiArMTgsNyBAQCBzZWxmdGVzdChlbmdp
bmUsIGludGVsX2VuZ2luZV9jc19tb2NrX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KHRpbWVsaW5lcywg
aTkxNV90aW1lbGluZV9tb2NrX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KHJlcXVlc3RzLCBpOTE1X3Jl
cXVlc3RfbW9ja19zZWxmdGVzdHMpCiBzZWxmdGVzdChvYmplY3RzLCBpOTE1X2dlbV9vYmplY3Rf
bW9ja19zZWxmdGVzdHMpCitzZWxmdGVzdChwaHlzLCBpOTE1X2dlbV9waHlzX21vY2tfc2VsZnRl
c3RzKQogc2VsZnRlc3QoZG1hYnVmLCBpOTE1X2dlbV9kbWFidWZfbW9ja19zZWxmdGVzdHMpCiBz
ZWxmdGVzdCh2bWEsIGk5MTVfdm1hX21vY2tfc2VsZnRlc3RzKQogc2VsZnRlc3QoZXZpY3QsIGk5
MTVfZ2VtX2V2aWN0X21vY2tfc2VsZnRlc3RzKQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

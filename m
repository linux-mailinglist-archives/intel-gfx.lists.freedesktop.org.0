Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 49CCEECE3E
	for <lists+intel-gfx@lfdr.de>; Sat,  2 Nov 2019 12:09:34 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2D1096E42F;
	Sat,  2 Nov 2019 11:09:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 59E856E42F
 for <intel-gfx@lists.freedesktop.org>; Sat,  2 Nov 2019 11:09:30 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19057149-1500050 
 for <intel-gfx@lists.freedesktop.org>; Sat, 02 Nov 2019 11:09:27 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat,  2 Nov 2019 11:09:27 +0000
Message-Id: <20191102110927.29575-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc2
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/execlists: Verify context register state
 before execution
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hlY2sgdGhhdCB0aGUgY29udGV4dCdzIHJpbmcgcmVnaXN0ZXIgc3RhdGUgc3RpbGwgbWF0Y2hl
cyBvdXIKZXhwZWN0YXRpb25zIHByaW9yIHRvIGV4ZWN1dGlvbi4KClNpZ25lZC1vZmYtYnk6IENo
cmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWlrYSBLdW9wcGFsYSA8
bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+ClJldmlld2VkLWJ5OiBNaWthIEt1b3BwYWxh
IDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYyAgICAgfCA4MCArKysrKysrKysrKysrKysrKysrKy0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmNfcmVnLmggfCAgNCArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgIHwgIDQgKy0KIDMgZmlsZXMgY2hhbmdlZCwgNzAg
aW5zZXJ0aW9ucygrKSwgMTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYwppbmRleCA1MWFlZjJhMjMzY2IuLjcwODBjNjFlMWQ5OSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfbHJjLmMKQEAgLTk5MCw2ICs5OTAsNjcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZW5n
aW5lX2NvbnRleHRfb3V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAl3cml0ZV9z
ZXF1bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5zdGF0cy5sb2NrLCBmbGFncyk7CiB9CiAKK3N0
YXRpYyBpbnQgbHJjX3JpbmdfbWlfbW9kZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCit7CisJaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyKQorCQlyZXR1cm4g
MHg2MDsKKwllbHNlIGlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSA5KQorCQlyZXR1cm4g
MHg1NDsKKwllbHNlIGlmIChlbmdpbmUtPmNsYXNzID09IFJFTkRFUl9DTEFTUykKKwkJcmV0dXJu
IDB4NTg7CisJZWxzZQorCQlyZXR1cm4gLTE7Cit9CisKK3N0YXRpYyB2b2lkCitleGVjbGlzdHNf
Y2hlY2tfY29udGV4dChjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJCQljb25zdCBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJY29uc3Qgc3RydWN0IGludGVsX3Jp
bmcgKnJpbmcgPSBjZS0+cmluZzsKKwl1MzIgKnJlZ3MgPSBjZS0+bHJjX3JlZ19zdGF0ZTsKKwli
b29sIHZhbGlkID0gdHJ1ZTsKKwlpbnQgeDsKKworCWlmIChyZWdzW0NUWF9SSU5HX1NUQVJUXSAh
PSBpOTE1X2dndHRfb2Zmc2V0KHJpbmctPnZtYSkpIHsKKwkJcHJfZXJyKCIlczogY29udGV4dCBz
dWJtaXR0ZWQgd2l0aCBpbmNvcnJlY3QgUklOR19TVEFSVCBbJTA4eF0sIGV4cGVjdGVkICUwOHhc
biIsCisJCQkgICAgZW5naW5lLT5uYW1lLAorCQkJICAgIHJlZ3NbQ1RYX1JJTkdfU1RBUlRdLAor
CQkJICAgIGk5MTVfZ2d0dF9vZmZzZXQocmluZy0+dm1hKSk7CisJCXJlZ3NbQ1RYX1JJTkdfU1RB
UlRdID0gaTkxNV9nZ3R0X29mZnNldChyaW5nLT52bWEpOworCQl2YWxpZCA9IGZhbHNlOworCX0K
KworCWlmICgocmVnc1tDVFhfUklOR19DVExdICYgfihSSU5HX1dBSVQgfCBSSU5HX1dBSVRfU0VN
QVBIT1JFKSkgIT0KKwkgICAgKFJJTkdfQ1RMX1NJWkUocmluZy0+c2l6ZSkgfCBSSU5HX1ZBTElE
KSkgeworCQlwcl9lcnIoIiVzOiBjb250ZXh0IHN1Ym1pdHRlZCB3aXRoIGluY29ycmVjdCBSSU5H
X0NUTCBbJTA4eF0sIGV4cGVjdGVkICUwOHhcbiIsCisJCQkgICAgZW5naW5lLT5uYW1lLAorCQkJ
ICAgIHJlZ3NbQ1RYX1JJTkdfQ1RMXSwKKwkJCSAgICAodTMyKShSSU5HX0NUTF9TSVpFKHJpbmct
PnNpemUpIHwgUklOR19WQUxJRCkpOworCQlyZWdzW0NUWF9SSU5HX0NUTF0gPSBSSU5HX0NUTF9T
SVpFKHJpbmctPnNpemUpIHwgUklOR19WQUxJRDsKKwkJdmFsaWQgPSBmYWxzZTsKKwl9CisKKwlp
ZiAocmVnc1tDVFhfQkJfU1RBVEVdICE9IFJJTkdfQkJfUFBHVFQpIHsKKwkJcHJfZXJyKCIlczog
Y29udGV4dCBzdWJtaXR0ZWQgd2l0aCBpbmNvcnJlY3QgQkJfU1RBVEUgWyUwOHhdLCBleHBlY3Rl
ZCAlMDh4XG4iLAorCQkJICAgIGVuZ2luZS0+bmFtZSwKKwkJCSAgICByZWdzW0NUWF9CQl9TVEFU
RV0sCisJCQkgICAgUklOR19CQl9QUEdUVCk7CisJCXJlZ3NbQ1RYX0JCX1NUQVRFXSA9IFJJTkdf
QkJfUFBHVFQ7CisJCXZhbGlkID0gZmFsc2U7CisJfQorCisJeCA9IGxyY19yaW5nX21pX21vZGUo
ZW5naW5lKTsKKwlpZiAoeCAhPSAtMSAmJiByZWdzW3ggKyAxXSAmIFNUT1BfUklORykgeworCQlw
cl9lcnIoIiVzOiBjb250ZXh0IHN1Ym1pdHRlZCB3aXRoIFNUT1BfUklORyBbJTA4eF0gaW4gUklO
R19NSV9NT0RFXG4iLAorCQkJICAgIGVuZ2luZS0+bmFtZSwgcmVnc1t4ICsgMV0pOworCQlyZWdz
W3ggKyAxXSAmPSB+U1RPUF9SSU5HOworCQlyZWdzW3ggKyAxXSB8PSBTVE9QX1JJTkcgPDwgMTY7
CisJCXZhbGlkID0gZmFsc2U7CisJfQorCisJV0FSTl9PTkNFKCF2YWxpZCwgIkludmFsaWQgbHJj
IHN0YXRlIGZvdW5kIGJlZm9yZSBzdWJtaXNzaW9uXG4iKTsKK30KKwogc3RhdGljIGlubGluZSBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKIF9fZXhlY2xpc3RzX3NjaGVkdWxlX2luKHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxKQogewpAQCAtOTk4LDYgKzEwNTksOSBAQCBfX2V4ZWNsaXN0c19zY2hl
ZHVsZV9pbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogCWludGVsX2NvbnRleHRfZ2V0KGNl
KTsKIAorCWlmIChJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pKQorCQlleGVj
bGlzdHNfY2hlY2tfY29udGV4dChjZSwgcnEtPmVuZ2luZSk7CisKIAlpZiAoY2UtPnRhZykgewog
CQkvKiBVc2UgYSBmaXhlZCB0YWcgZm9yIE9BIGFuZCBmcmllbmRzICovCiAJCWNlLT5scmNfZGVz
YyB8PSAodTY0KWNlLT50YWcgPDwgMzI7CkBAIC0yMzUzLDcgKzI0MTcsNyBAQCBfX2V4ZWNsaXN0
c191cGRhdGVfcmVnX3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAlHRU1f
QlVHX09OKCFpbnRlbF9yaW5nX29mZnNldF92YWxpZChyaW5nLCByaW5nLT5oZWFkKSk7CiAJR0VN
X0JVR19PTighaW50ZWxfcmluZ19vZmZzZXRfdmFsaWQocmluZywgcmluZy0+dGFpbCkpOwogCi0J
cmVnc1tDVFhfUklOR19CVUZGRVJfU1RBUlRdID0gaTkxNV9nZ3R0X29mZnNldChyaW5nLT52bWEp
OworCXJlZ3NbQ1RYX1JJTkdfU1RBUlRdID0gaTkxNV9nZ3R0X29mZnNldChyaW5nLT52bWEpOwog
CXJlZ3NbQ1RYX1JJTkdfSEVBRF0gPSByaW5nLT5oZWFkOwogCXJlZ3NbQ1RYX1JJTkdfVEFJTF0g
PSByaW5nLT50YWlsOwogCkBAIC0yOTQwLDE4ICszMDA0LDYgQEAgc3RhdGljIHZvaWQgcmVzZXRf
Y3NiX3BvaW50ZXJzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJCSAgICAgICAm
ZXhlY2xpc3RzLT5jc2Jfc3RhdHVzW3Jlc2V0X3ZhbHVlXSk7CiB9CiAKLXN0YXRpYyBpbnQgbHJj
X3JpbmdfbWlfbW9kZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0J
aWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyKQotCQlyZXR1cm4gMHg2MDsKLQllbHNl
IGlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSA5KQotCQlyZXR1cm4gMHg1NDsKLQllbHNl
IGlmIChlbmdpbmUtPmNsYXNzID09IFJFTkRFUl9DTEFTUykKLQkJcmV0dXJuIDB4NTg7Ci0JZWxz
ZQotCQlyZXR1cm4gLTE7Ci19Ci0KIHN0YXRpYyB2b2lkIF9fZXhlY2xpc3RzX3Jlc2V0X3JlZ19z
dGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkJCWNvbnN0IHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKQEAgLTM4ODUsNyArMzkzNyw3IEBAIHN0YXRpYyB2
b2lkIGluaXRfY29tbW9uX3JlZ19zdGF0ZSh1MzIgKiBjb25zdCByZWdzLAogCQkJX01BU0tFRF9C
SVRfRElTQUJMRShDVFhfQ1RSTF9FTkdJTkVfQ1RYX1NBVkVfSU5ISUJJVCB8CiAJCQkJCSAgICBD
VFhfQ1RSTF9SU19DVFhfRU5BQkxFKTsKIAotCXJlZ3NbQ1RYX1JJTkdfQlVGRkVSX0NPTlRST0xd
ID0gUklOR19DVExfU0laRShyaW5nLT5zaXplKSB8IFJJTkdfVkFMSUQ7CisJcmVnc1tDVFhfUklO
R19DVExdID0gUklOR19DVExfU0laRShyaW5nLT5zaXplKSB8IFJJTkdfVkFMSUQ7CiAJcmVnc1tD
VFhfQkJfU1RBVEVdID0gUklOR19CQl9QUEdUVDsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjX3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjX3JlZy5oCmluZGV4IDA2YWIwMjc2ZTEwZS4uMDhhM2JlNjVmNzAwIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmNfcmVnLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjX3JlZy5oCkBAIC0xMyw4ICsxMyw4IEBACiAjZGVm
aW5lIENUWF9DT05URVhUX0NPTlRST0wJCSgweDAyICsgMSkKICNkZWZpbmUgQ1RYX1JJTkdfSEVB
RAkJCSgweDA0ICsgMSkKICNkZWZpbmUgQ1RYX1JJTkdfVEFJTAkJCSgweDA2ICsgMSkKLSNkZWZp
bmUgQ1RYX1JJTkdfQlVGRkVSX1NUQVJUCQkoMHgwOCArIDEpCi0jZGVmaW5lIENUWF9SSU5HX0JV
RkZFUl9DT05UUk9MCQkoMHgwYSArIDEpCisjZGVmaW5lIENUWF9SSU5HX1NUQVJUCQkJKDB4MDgg
KyAxKQorI2RlZmluZSBDVFhfUklOR19DVEwJCQkoMHgwYSArIDEpCiAjZGVmaW5lIENUWF9CQl9T
VEFURQkJCSgweDEwICsgMSkKICNkZWZpbmUgQ1RYX0JCX1BFUl9DVFhfUFRSCQkoMHgxOCArIDEp
CiAjZGVmaW5lIENUWF9QRFAzX1VEVwkJCSgweDI0ICsgMSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfbHJjLmMKaW5kZXggZWI3MWFjMmY5OTJjLi5kMWE3NTY1ZWFkMTkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0zMjA3LDEyICszMjA3LDEyIEBAIHN0
YXRpYyBpbnQgbGl2ZV9scmNfZml4ZWQodm9pZCAqYXJnKQogCQl9IHRibFtdID0gewogCQkJewog
CQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfU1RBUlQoZW5naW5lLT5tbWlvX2Jhc2UpKSwK
LQkJCQlDVFhfUklOR19CVUZGRVJfU1RBUlQgLSAxLAorCQkJCUNUWF9SSU5HX1NUQVJUIC0gMSwK
IAkJCQkiUklOR19TVEFSVCIKIAkJCX0sCiAJCQl7CiAJCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQo
UklOR19DVEwoZW5naW5lLT5tbWlvX2Jhc2UpKSwKLQkJCQlDVFhfUklOR19CVUZGRVJfQ09OVFJP
TCAtIDEsCisJCQkJQ1RYX1JJTkdfQ1RMIC0gMSwKIAkJCQkiUklOR19DVEwiCiAJCQl9LAogCQkJ
ewotLSAKMi4yNC4wLnJjMgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9ADD4DC647
	for <lists+intel-gfx@lfdr.de>; Fri, 18 Oct 2019 15:39:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5B7416EB49;
	Fri, 18 Oct 2019 13:39:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AEE346E108;
 Fri, 18 Oct 2019 13:39:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18883047-1500050 
 for multiple; Fri, 18 Oct 2019 14:38:58 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 18 Oct 2019 14:38:53 +0100
Message-Id: <20191018133855.31743-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191018133855.31743-1-chris@chris-wilson.co.uk>
References: <20191018133855.31743-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 1/3] i915: Exercise preemption timeout
 controls in sysfs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RHluYW1pYyBzdWJ0ZXN0cyEKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgotLS0KIGxpYi9pOTE1L2dlbV9jb250ZXh0LmMgICAgICAgICAgICAg
ICAgfCAgNDEgKysrKwogbGliL2k5MTUvZ2VtX2NvbnRleHQuaCAgICAgICAgICAgICAgICB8ICAg
MiArCiB0ZXN0cy9NYWtlZmlsZS5zb3VyY2VzICAgICAgICAgICAgICAgIHwgICAxICsKIHRlc3Rz
L2k5MTUvc3lzZnNfcHJlZW1wdGlvbl90aW1lb3V0LmMgfCAzMTAgKysrKysrKysrKysrKysrKysr
KysrKysrKysKIHRlc3RzL21lc29uLmJ1aWxkICAgICAgICAgICAgICAgICAgICAgfCAgIDEgKwog
NSBmaWxlcyBjaGFuZ2VkLCAzNTUgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHRl
c3RzL2k5MTUvc3lzZnNfcHJlZW1wdGlvbl90aW1lb3V0LmMKCmRpZmYgLS1naXQgYS9saWIvaTkx
NS9nZW1fY29udGV4dC5jIGIvbGliL2k5MTUvZ2VtX2NvbnRleHQuYwppbmRleCAxZmFlNTE5MWYu
LmFhMDgzYzJmMCAxMDA2NDQKLS0tIGEvbGliL2k5MTUvZ2VtX2NvbnRleHQuYworKysgYi9saWIv
aTkxNS9nZW1fY29udGV4dC5jCkBAIC00MDMsMyArNDAzLDQ0IEBAIGJvb2wgZ2VtX2NvbnRleHRf
aGFzX2VuZ2luZShpbnQgZmQsIHVpbnQzMl90IGN0eCwgdWludDY0X3QgZW5naW5lKQogCiAJcmV0
dXJuIF9fZ2VtX2V4ZWNidWYoZmQsICZleGVjYnVmKSA9PSAtRU5PRU5UOwogfQorCitzdGF0aWMg
aW50IGNyZWF0ZV9leHRfaW9jdGwoaW50IGk5MTUsCisJCQkgICAgc3RydWN0IGRybV9pOTE1X2dl
bV9jb250ZXh0X2NyZWF0ZV9leHQgKmFyZykKK3sKKwlpbnQgZXJyOworCisJZXJyID0gMDsKKwlp
ZiAoaWd0X2lvY3RsKGk5MTUsIERSTV9JT0NUTF9JOTE1X0dFTV9DT05URVhUX0NSRUFURV9FWFQs
IGFyZykpIHsKKwkJZXJyID0gLWVycm5vOworCQlpZ3RfYXNzdW1lKGVycik7CisJfQorCisJZXJy
bm8gPSAwOworCXJldHVybiBlcnI7Cit9CisKK3VpbnQzMl90IGdlbV9jb250ZXh0X2NyZWF0ZV9m
b3JfZW5naW5lKGludCBpOTE1LCB1bnNpZ25lZCBpbnQgY2xhc3MsIHVuc2lnbmVkIGludCBpbnN0
KQoreworCUk5MTVfREVGSU5FX0NPTlRFWFRfUEFSQU1fRU5HSU5FUyhlbmdpbmVzLCAxKSA9IHsK
KwkJLmVuZ2luZXMgPSB7IHsgLmVuZ2luZV9jbGFzcyA9IGNsYXNzLCAuZW5naW5lX2luc3RhbmNl
ID0gaW5zdCB9IH0KKwl9OworCXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9jcmVhdGVfZXh0
X3NldHBhcmFtIHBfZW5naW5lcyA9IHsKKwkJLmJhc2UgPSB7CisJCQkubmFtZSA9IEk5MTVfQ09O
VEVYVF9DUkVBVEVfRVhUX1NFVFBBUkFNLAorCQkJLm5leHRfZXh0ZW5zaW9uID0gMCwgLyogZW5k
IG9mIGNoYWluICovCisJCX0sCisJCS5wYXJhbSA9IHsKKwkJCS5wYXJhbSA9IEk5MTVfQ09OVEVY
VF9QQVJBTV9FTkdJTkVTLAorCQkJLnZhbHVlID0gdG9fdXNlcl9wb2ludGVyKCZlbmdpbmVzKSwK
KwkJCS5zaXplID0gc2l6ZW9mKGVuZ2luZXMpLAorCQl9LAorCX07CisJc3RydWN0IGRybV9pOTE1
X2dlbV9jb250ZXh0X2NyZWF0ZV9leHQgY3JlYXRlID0geworCQkuZmxhZ3MgPSBJOTE1X0NPTlRF
WFRfQ1JFQVRFX0ZMQUdTX1VTRV9FWFRFTlNJT05TLAorCQkuZXh0ZW5zaW9ucyA9IHRvX3VzZXJf
cG9pbnRlcigmcF9lbmdpbmVzKSwKKwl9OworCisJaWd0X2Fzc2VydF9lcShjcmVhdGVfZXh0X2lv
Y3RsKGk5MTUsICZjcmVhdGUpLCAwKTsKKwlpZ3RfYXNzZXJ0X25lcShjcmVhdGUuY3R4X2lkLCAw
KTsKKwlyZXR1cm4gY3JlYXRlLmN0eF9pZDsKK30KZGlmZiAtLWdpdCBhL2xpYi9pOTE1L2dlbV9j
b250ZXh0LmggYi9saWIvaTkxNS9nZW1fY29udGV4dC5oCmluZGV4IGMwZDRjOTYxNS4uOWUwYTA4
M2YwIDEwMDY0NAotLS0gYS9saWIvaTkxNS9nZW1fY29udGV4dC5oCisrKyBiL2xpYi9pOTE1L2dl
bV9jb250ZXh0LmgKQEAgLTM0LDYgKzM0LDggQEAgaW50IF9fZ2VtX2NvbnRleHRfY3JlYXRlKGlu
dCBmZCwgdWludDMyX3QgKmN0eF9pZCk7CiB2b2lkIGdlbV9jb250ZXh0X2Rlc3Ryb3koaW50IGZk
LCB1aW50MzJfdCBjdHhfaWQpOwogaW50IF9fZ2VtX2NvbnRleHRfZGVzdHJveShpbnQgZmQsIHVp
bnQzMl90IGN0eF9pZCk7CiAKK3VpbnQzMl90IGdlbV9jb250ZXh0X2NyZWF0ZV9mb3JfZW5naW5l
KGludCBmZCwgdW5zaWduZWQgaW50IGNsYXNzLCB1bnNpZ25lZCBpbnQgaW5zdCk7CisKIGludCBf
X2dlbV9jb250ZXh0X2Nsb25lKGludCBpOTE1LAogCQkJdWludDMyX3Qgc3JjLCB1bnNpZ25lZCBp
bnQgc2hhcmUsCiAJCQl1bnNpZ25lZCBpbnQgZmxhZ3MsCmRpZmYgLS1naXQgYS90ZXN0cy9NYWtl
ZmlsZS5zb3VyY2VzIGIvdGVzdHMvTWFrZWZpbGUuc291cmNlcwppbmRleCAwOTNlYjU3ZjMuLmRm
ZjdkYWMwNiAxMDA2NDQKLS0tIGEvdGVzdHMvTWFrZWZpbGUuc291cmNlcworKysgYi90ZXN0cy9N
YWtlZmlsZS5zb3VyY2VzCkBAIC05OCw2ICs5OCw3IEBAIFRFU1RTX3Byb2dzID0gXAogCXRvb2xz
X3Rlc3QgXAogCXZnZW1fYmFzaWMgXAogCXZnZW1fc2xvdyBcCisJaTkxNS9zeXNmc19wcmVlbXB0
aW9uX3RpbWVvdXQgXAogCSQoTlVMTCkKIAogVEVTVFNfcHJvZ3MgKz0gZ2VtX2JhZF9yZWxvYwpk
aWZmIC0tZ2l0IGEvdGVzdHMvaTkxNS9zeXNmc19wcmVlbXB0aW9uX3RpbWVvdXQuYyBiL3Rlc3Rz
L2k5MTUvc3lzZnNfcHJlZW1wdGlvbl90aW1lb3V0LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAwLi5hMmMwZTgyNjUKLS0tIC9kZXYvbnVsbAorKysgYi90ZXN0cy9pOTE1L3N5
c2ZzX3ByZWVtcHRpb25fdGltZW91dC5jCkBAIC0wLDAgKzEsMzEwIEBACisvKgorICogQ29weXJp
Z2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVi
eSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICog
Y29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMg
KHRoZSAiU29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVz
dHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8g
dXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNl
LAorICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBw
ZXJzb25zIHRvIHdob20gdGhlCisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1
YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5
cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcgdGhlIG5l
eHQKKyAqIHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJz
dGFudGlhbCBwb3J0aW9ucyBvZiB0aGUKKyAqIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FS
RSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBS
RVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJS
QU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQ
VVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIEFV
VEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFH
RVMgT1IgT1RIRVIKKyAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJB
Q1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09O
TkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTCisg
KiBJTiBUSEUgU09GVFdBUkUuCisgKi8KKworI2luY2x1ZGUgPGRpcmVudC5oPgorI2luY2x1ZGUg
PGVycm5vLmg+CisjaW5jbHVkZSA8ZmNudGwuaD4KKyNpbmNsdWRlIDxpbnR0eXBlcy5oPgorI2lu
Y2x1ZGUgPHN5cy9zdGF0Lmg+CisjaW5jbHVkZSA8c3lzL3R5cGVzLmg+CisjaW5jbHVkZSA8dW5p
c3RkLmg+CisKKyNpbmNsdWRlICJkcm10ZXN0LmgiIC8qIGdlbV9xdWllc2NlbnRfZ3B1KCkhICov
CisjaW5jbHVkZSAiaWd0X2R1bW15bG9hZC5oIgorI2luY2x1ZGUgImlndF9zeXNmcy5oIgorI2lu
Y2x1ZGUgImlvY3RsX3dyYXBwZXJzLmgiIC8qIGlndF9yZXF1aXJlX2dlbSgpISAqLworI2luY2x1
ZGUgInN3X3N5bmMuaCIKKworI2luY2x1ZGUgImlndF9kZWJ1Z2ZzLmgiCisKK3N0YXRpYyBib29s
IF9fZW5hYmxlX2hhbmdjaGVjayhpbnQgZGlyLCBib29sIHN0YXRlKQoreworCXJldHVybiBpZ3Rf
c3lzZnNfc2V0KGRpciwgImVuYWJsZV9oYW5nY2hlY2siLCBzdGF0ZSA/ICIxIiA6ICIwIik7Cit9
CisKK3N0YXRpYyBib29sIGVuYWJsZV9oYW5nY2hlY2soaW50IGk5MTUsIGJvb2wgc3RhdGUpCit7
CisJYm9vbCBzdWNjZXNzOworCWludCBkaXI7CisKKwlkaXIgPSBpZ3Rfc3lzZnNfb3Blbl9wYXJh
bWV0ZXJzKGk5MTUpOworCWlmIChkaXIgPCAwKSAvKiBubyBwYXJhbWV0ZXJzLCBtdXN0IGJlIGRl
ZmF1bHQhICovCisJCXJldHVybiBmYWxzZTsKKworCXN1Y2Nlc3MgPSBfX2VuYWJsZV9oYW5nY2hl
Y2soZGlyLCBzdGF0ZSk7CisJY2xvc2UoZGlyKTsKKworCXJldHVybiBzdWNjZXNzOworfQorCitz
dGF0aWMgdm9pZCB0ZXN0X2lkZW1wb3RlbnQoaW50IGk5MTUsIGludCBlbmdpbmUpCit7CisJdW5z
aWduZWQgaW50IHNhdmVkLCBkZWxheTsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVu
Z2luZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0X2Rl
YnVnKCJJbml0aWFsIHByZWVtcHRfdGltZW91dF9tczoldVxuIiwgc2F2ZWQpOworCisJaWd0X3N5
c2ZzX3ByaW50ZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAwKTsKKwlpZ3Rf
c3lzZnNfc2NhbmYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgIiV1IiwgJmRlbGF5KTsK
KwlpZ3RfYXNzZXJ0X2VxKGRlbGF5LCAwKTsKKworCWlndF9zeXNmc19wcmludGYoZW5naW5lLCAi
cHJlZW1wdF90aW1lb3V0X21zIiwgIiV1IiwgMSk7CisJaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwg
InByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZkZWxheSk7CisJaWd0X2Fzc2VydF9lcShkZWxh
eSwgMSk7CisKKwlpZ3Rfc3lzZnNfcHJpbnRmKGVuZ2luZSwgInByZWVtcHRfdGltZW91dF9tcyIs
ICIldSIsIDEwMDApOworCWlndF9zeXNmc19zY2FuZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRf
bXMiLCAiJXUiLCAmZGVsYXkpOworCWlndF9hc3NlcnRfZXEoZGVsYXksIDEwMDApOworCisJaWd0
X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCA2NTQzMjEp
OworCWlndF9zeXNmc19zY2FuZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAm
ZGVsYXkpOworCWlndF9hc3NlcnRfZXEoZGVsYXksIDY1NDMyMSk7CisKKwlpZ3Rfc3lzZnNfcHJp
bnRmKGVuZ2luZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIsIHNhdmVkKTsKKwlpZ3Rfc3lz
ZnNfc2NhbmYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgIiV1IiwgJmRlbGF5KTsKKwlp
Z3RfYXNzZXJ0X2VxKGRlbGF5LCBzYXZlZCk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfaW52YWxp
ZChpbnQgaTkxNSwgaW50IGVuZ2luZSkKK3sKKwl1bnNpZ25lZCBpbnQgc2F2ZWQsIGRlbGF5Owor
CisJaWd0X2Fzc2VydChpZ3Rfc3lzZnNfc2NhbmYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21z
IiwgIiV1IiwgJnNhdmVkKSA9PSAxKTsKKwlpZ3RfZGVidWcoIkluaXRpYWwgcHJlZW1wdF90aW1l
b3V0X21zOiV1XG4iLCBzYXZlZCk7CisKKwlpZ3Rfc3lzZnNfcHJpbnRmKGVuZ2luZSwgInByZWVt
cHRfdGltZW91dF9tcyIsIFBSSXU2NCwgLTEpOworCWlndF9zeXNmc19zY2FuZihlbmdpbmUsICJw
cmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAmZGVsYXkpOworCWlndF9hc3NlcnRfZXEoZGVsYXks
IHNhdmVkKTsKKworCWlndF9zeXNmc19wcmludGYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21z
IiwgIiVkIiwgLTEpOworCWlndF9zeXNmc19zY2FuZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRf
bXMiLCAiJXUiLCAmZGVsYXkpOworCWlndF9hc3NlcnRfZXEoZGVsYXksIHNhdmVkKTsKKworCWln
dF9zeXNmc19wcmludGYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgUFJJdTY0LCA0MHVs
bCA8PCAzMik7CisJaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgInByZWVtcHRfdGltZW91dF9tcyIs
ICIldSIsICZkZWxheSk7CisJaWd0X2Fzc2VydF9lcShkZWxheSwgc2F2ZWQpOworfQorCitzdGF0
aWMgdm9pZCBzZXRfdW5iYW5uYWJsZShpbnQgaTkxNSwgdWludDMyX3QgY3R4KQoreworCXN0cnVj
dCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSBwID0geworCQkuY3R4X2lkID0gY3R4LAorCQku
cGFyYW0gPSBJOTE1X0NPTlRFWFRfUEFSQU1fQkFOTkFCTEUsCisJfTsKKworCWlndF9hc3NlcnRf
ZXEoX19nZW1fY29udGV4dF9zZXRfcGFyYW0oaTkxNSwgJnApLCAwKTsKK30KKworc3RhdGljIHVp
bnQzMl90IGNyZWF0ZV9jb250ZXh0KGludCBpOTE1LCB1bnNpZ25lZCBpbnQgY2xhc3MsIHVuc2ln
bmVkIGludCBpbnN0LCBpbnQgcHJpbykKK3sKKwl1aW50MzJfdCBjdHg7CisKKwljdHggPSBnZW1f
Y29udGV4dF9jcmVhdGVfZm9yX2VuZ2luZShpOTE1LCBjbGFzcywgaW5zdCk7CisJc2V0X3VuYmFu
bmFibGUoaTkxNSwgY3R4KTsKKwlnZW1fY29udGV4dF9zZXRfcHJpb3JpdHkoaTkxNSwgY3R4LCBw
cmlvKTsKKworCXJldHVybiBjdHg7Cit9CisKK3N0YXRpYyB1aW50NjRfdCBfX3Rlc3RfdGltZW91
dChpbnQgaTkxNSwgaW50IGVuZ2luZSwgdW5zaWduZWQgaW50IHRpbWVvdXQpCit7CisJdW5zaWdu
ZWQgaW50IGNsYXNzLCBpbnN0OworCXN0cnVjdCB0aW1lc3BlYyB0cyA9IHt9OworCWlndF9zcGlu
X3QgKnNwaW5bMl07CisJdWludDY0X3QgZWxhcHNlZDsKKwl1aW50MzJfdCBjdHhbMl07CisKKwlp
Z3RfYXNzZXJ0KGlndF9zeXNmc19zY2FuZihlbmdpbmUsICJjbGFzcyIsICIldSIsICZjbGFzcykg
PT0gMSk7CisJaWd0X2Fzc2VydChpZ3Rfc3lzZnNfc2NhbmYoZW5naW5lLCAiaW5zdGFuY2UiLCAi
JXUiLCAmaW5zdCkgPT0gMSk7CisKKwlpZ3Rfc3lzZnNfcHJpbnRmKGVuZ2luZSwgInByZWVtcHRf
dGltZW91dF9tcyIsICIldSIsIHRpbWVvdXQpOworCisJY3R4WzBdID0gY3JlYXRlX2NvbnRleHQo
aTkxNSwgY2xhc3MsIGluc3QsIC0xMDIzKTsKKwlzcGluWzBdID0gaWd0X3NwaW5fbmV3KGk5MTUs
IGN0eFswXSwKKwkJCSAgICAgICAuZmxhZ3MgPSAoSUdUX1NQSU5fTk9fUFJFRU1QVElPTiB8CisJ
CQkJCSBJR1RfU1BJTl9QT0xMX1JVTiB8CisJCQkJCSBJR1RfU1BJTl9GRU5DRV9PVVQpKTsKKwlp
Z3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVkKHNwaW5bMF0pOworCisJY3R4WzFdID0gY3Jl
YXRlX2NvbnRleHQoaTkxNSwgY2xhc3MsIGluc3QsIDEwMjMpOworCWlndF9uc2VjX2VsYXBzZWQo
JnRzKTsKKwlzcGluWzFdID0gaWd0X3NwaW5fbmV3KGk5MTUsIGN0eFsxXSwgLmZsYWdzID0gSUdU
X1NQSU5fUE9MTF9SVU4pOworCWlndF9zcGluX2J1c3l3YWl0X3VudGlsX3N0YXJ0ZWQoc3Bpblsx
XSk7CisJZWxhcHNlZCA9IGlndF9uc2VjX2VsYXBzZWQoJnRzKTsKKworCWlndF9zcGluX2ZyZWUo
aTkxNSwgc3BpblsxXSk7CisKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfd2FpdChzcGluWzBd
LT5vdXRfZmVuY2UsIDEpLCAwKTsKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfc3RhdHVzKHNw
aW5bMF0tPm91dF9mZW5jZSksIC1FSU8pOworCisJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluWzBd
KTsKKworCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4WzFdKTsKKwlnZW1fY29udGV4dF9k
ZXN0cm95KGk5MTUsIGN0eFswXSk7CisJZ2VtX3F1aWVzY2VudF9ncHUoaTkxNSk7CisKKwlyZXR1
cm4gZWxhcHNlZDsKK30KKworc3RhdGljIHZvaWQgdGVzdF90aW1lb3V0KGludCBpOTE1LCBpbnQg
ZW5naW5lKQoreworCWludCBkZWxheXNbXSA9IHsgMSwgNTAsIDEwMCwgNTAwIH07CisJdW5zaWdu
ZWQgaW50IHNhdmVkLCBkZWxheTsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2lu
ZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0X2RlYnVn
KCJJbml0aWFsIHByZWVtcHRfdGltZW91dF9tczoldVxuIiwgc2F2ZWQpOworCisJZ2VtX3F1aWVz
Y2VudF9ncHUoaTkxNSk7CisJaWd0X3JlcXVpcmUoZW5hYmxlX2hhbmdjaGVjayhpOTE1LCBmYWxz
ZSkpOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRlbGF5cyk7IGkrKykgewor
CQl1aW50NjRfdCBlbGFwc2VkOworCisJCWVsYXBzZWQgPSBfX3Rlc3RfdGltZW91dChpOTE1LCBl
bmdpbmUsIGRlbGF5c1tpXSk7CisJCWlndF9pbmZvKCJwcmVlbXB0X3RpbWVvdXRfbXM6JWQsIGVs
YXBzZWQ9JS4zZm1zXG4iLAorCQkJIGRlbGF5c1tpXSwgZWxhcHNlZCAqIDFlLTYpOworCisJCS8q
CisJCSAqIFdlIG5lZWQgdG8gZ2l2ZSBhIGNvdXBsZSBvZiBqaWZmaWVzIHNsYWNrIGZvciB0aGUg
c2NoZWR1bGVyIHRpbWVvdXRzCisJCSAqIGFuZCB0aGVuIGEgbGl0dGxlIG1vcmUgc2xhY2sgZnIg
dGhlIG92ZXJoZWFkIGluIHN1Ym1pdHRpbmcgYW5kCisJCSAqIG1lYXN1cmluZy4gNTBtcyBzaG91
bGQgY292ZXIgYWxsIG9mIG91ciBzaW5zIGFuZCBiZSB1c2VmdWwKKwkJICogdG9sZXJhbmNlLgor
CQkgKi8KKwkJaWd0X2Fzc2VydF9mKGVsYXBzZWQgLyAxMDAwIC8gMTAwMCA8IGRlbGF5c1tpXSAr
IDUwLAorCQkJICAgICAiRm9yY2VkIHByZWVtcHRpb24gdGltZW91dCBleGNlZWRlZCByZXF1ZXN0
IVxuIik7CisJfQorCisJaWd0X2Fzc2VydChlbmFibGVfaGFuZ2NoZWNrKGk5MTUsIHRydWUpKTsK
KwlnZW1fcXVpZXNjZW50X2dwdShpOTE1KTsKKworCWlndF9zeXNmc19wcmludGYoZW5naW5lLCAi
cHJlZW1wdF90aW1lb3V0X21zIiwgIiV1Iiwgc2F2ZWQpOworCWlndF9zeXNmc19zY2FuZihlbmdp
bmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAmZGVsYXkpOworCWlndF9hc3NlcnRfZXEo
ZGVsYXksIHNhdmVkKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9vZmYoaW50IGk5MTUsIGludCBl
bmdpbmUpCit7CisJdW5zaWduZWQgaW50IHNhdmVkLCBkZWxheTsKKwl1bnNpZ25lZCBpbnQgY2xh
c3MsIGluc3Q7CisJaWd0X3NwaW5fdCAqc3BpblsyXTsKKwl1aW50MzJfdCBjdHhbMl07CisKKwlp
Z3RfYXNzZXJ0KGlndF9zeXNmc19zY2FuZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAi
JXUiLCAmc2F2ZWQpID09IDEpOworCWlndF9kZWJ1ZygiSW5pdGlhbCBwcmVlbXB0X3RpbWVvdXRf
bXM6JXVcbiIsIHNhdmVkKTsKKworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCWlndF9yZXF1
aXJlKGVuYWJsZV9oYW5nY2hlY2soaTkxNSwgZmFsc2UpKTsKKworCWlndF9hc3NlcnQoaWd0X3N5
c2ZzX3NjYW5mKGVuZ2luZSwgImNsYXNzIiwgIiV1IiwgJmNsYXNzKSA9PSAxKTsKKwlpZ3RfYXNz
ZXJ0KGlndF9zeXNmc19zY2FuZihlbmdpbmUsICJpbnN0YW5jZSIsICIldSIsICZpbnN0KSA9PSAx
KTsKKworCWlndF9zeXNmc19wcmludGYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgIiV1
IiwgMCk7CisKKwljdHhbMF0gPSBjcmVhdGVfY29udGV4dChpOTE1LCBjbGFzcywgaW5zdCwgLTEw
MjMpOworCXNwaW5bMF0gPSBpZ3Rfc3Bpbl9uZXcoaTkxNSwgY3R4WzBdLAorCQkJICAgICAgIC5m
bGFncyA9IChJR1RfU1BJTl9OT19QUkVFTVBUSU9OIHwKKwkJCQkJIElHVF9TUElOX1BPTExfUlVO
IHwKKwkJCQkJIElHVF9TUElOX0ZFTkNFX09VVCkpOworCWlndF9zcGluX2J1c3l3YWl0X3VudGls
X3N0YXJ0ZWQoc3BpblswXSk7CisKKwljdHhbMV0gPSBjcmVhdGVfY29udGV4dChpOTE1LCBjbGFz
cywgaW5zdCwgMTAyMyk7CisJc3BpblsxXSA9IGlndF9zcGluX25ldyhpOTE1LCBjdHhbMV0sIC5m
bGFncyA9IElHVF9TUElOX1BPTExfUlVOKTsKKworCWZvciAoaW50IGkgPSAwOyBpIDwgMTUwOyBp
KyspIHsKKwkJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3N0YXR1cyhzcGluWzBdLT5vdXRfZmVu
Y2UpLCAwKTsKKwkJc2xlZXAoMSk7CisJfQorCisJaWd0X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJw
cmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAxKTsKKworCWlndF9zcGluX2J1c3l3YWl0X3VudGls
X3N0YXJ0ZWQoc3BpblsxXSk7CisJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluWzFdKTsKKworCWln
dF9hc3NlcnRfZXEoc3luY19mZW5jZV93YWl0KHNwaW5bMF0tPm91dF9mZW5jZSwgMSksIDApOwor
CWlndF9hc3NlcnRfZXEoc3luY19mZW5jZV9zdGF0dXMoc3BpblswXS0+b3V0X2ZlbmNlKSwgLUVJ
Tyk7CisKKwlpZ3Rfc3Bpbl9mcmVlKGk5MTUsIHNwaW5bMF0pOworCisJZ2VtX2NvbnRleHRfZGVz
dHJveShpOTE1LCBjdHhbMV0pOworCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4WzBdKTsK
KworCWlndF9hc3NlcnQoZW5hYmxlX2hhbmdjaGVjayhpOTE1LCB0cnVlKSk7CisJZ2VtX3F1aWVz
Y2VudF9ncHUoaTkxNSk7CisKKwlpZ3Rfc3lzZnNfcHJpbnRmKGVuZ2luZSwgInByZWVtcHRfdGlt
ZW91dF9tcyIsICIldSIsIHNhdmVkKTsKKwlpZ3Rfc3lzZnNfc2NhbmYoZW5naW5lLCAicHJlZW1w
dF90aW1lb3V0X21zIiwgIiV1IiwgJmRlbGF5KTsKKwlpZ3RfYXNzZXJ0X2VxKGRlbGF5LCBzYXZl
ZCk7Cit9CisKK2lndF9tYWluCit7CisJaW50IGk5MTUsIHN5cyA9IC0xOworCXN0cnVjdCBkaXJl
bnQgKmRlOworCWludCBlbmdpbmVzOworCURJUiAqZGlyOworCisJaWd0X2ZpeHR1cmUgeworCQlp
OTE1ID0gZHJtX29wZW5fZHJpdmVyKERSSVZFUl9JTlRFTCk7CisJCWlndF9yZXF1aXJlX2dlbShp
OTE1KTsKKworCQlzeXMgPSBpZ3Rfc3lzZnNfb3BlbihpOTE1KTsKKwkJaWd0X3JlcXVpcmUoc3lz
ICE9IC0xKTsKKwl9CisKKwllbmdpbmVzID0gb3BlbmF0KHN5cywgImVuZ2luZSIsIE9fUkRPTkxZ
KTsKKwlkaXIgPSBmZG9wZW5kaXIoZW5naW5lcyk7CisJd2hpbGUgKGRpciAmJiAoZGUgPSByZWFk
ZGlyKGRpcikpKSB7CisJCWludCBlbmdpbmUgPSBvcGVuYXQoZW5naW5lcywgZGUtPmRfbmFtZSwg
T19SRE9OTFkpOworCQlzdHJ1Y3Qgc3RhdCBzdDsKKwkJY2hhciAqbmFtZTsKKworCQluYW1lID0g
aWd0X3N5c2ZzX2dldChlbmdpbmUsICJuYW1lIik7CisJCWlmICghbmFtZSkKKwkJCWNvbnRpbnVl
OworCisJCWlndF9zdWJ0ZXN0X2dyb3VwIHsKKwkJCWlndF9maXh0dXJlIHsKKwkJCQlpZ3RfcmVx
dWlyZShmc3RhdGF0KGVuZ2luZSwKKwkJCQkJCSAgICAicHJlZW1wdF90aW1lb3V0X21zIiwKKwkJ
CQkJCSAgICAmc3QsIDApID09IDApOworCQkJfQorCisJCQlpZ3Rfc3VidGVzdF9mKCIlcy1pZGVt
cG90ZW50IiwgbmFtZSkKKwkJCQl0ZXN0X2lkZW1wb3RlbnQoaTkxNSwgZW5naW5lKTsKKwkJCWln
dF9zdWJ0ZXN0X2YoIiVzLWludmFsaWQiLCBuYW1lKQorCQkJCXRlc3RfaW52YWxpZChpOTE1LCBl
bmdpbmUpOworCQkJaWd0X3N1YnRlc3RfZigiJXMtdGltZW91dCIsIG5hbWUpCisJCQkJdGVzdF90
aW1lb3V0KGk5MTUsIGVuZ2luZSk7CisJCQlpZ3Rfc3VidGVzdF9mKCIlcy1vZmYiLCBuYW1lKQor
CQkJCXRlc3Rfb2ZmKGk5MTUsIGVuZ2luZSk7CisJCX0KKworCQlmcmVlKG5hbWUpOworCQljbG9z
ZShlbmdpbmUpOworCX0KKworCWlndF9maXh0dXJlIHsKKwkJY2xvc2Uoc3lzKTsKKwkJY2xvc2Uo
aTkxNSk7CisJfQorfQpkaWZmIC0tZ2l0IGEvdGVzdHMvbWVzb24uYnVpbGQgYi90ZXN0cy9tZXNv
bi5idWlsZAppbmRleCAzZjNlZWUyNzcuLmE2OTkzNzdlMyAxMDA2NDQKLS0tIGEvdGVzdHMvbWVz
b24uYnVpbGQKKysrIGIvdGVzdHMvbWVzb24uYnVpbGQKQEAgLTIzOCw2ICsyMzgsNyBAQCBpOTE1
X3Byb2dzID0gWwogCSdpOTE1X3F1ZXJ5JywKIAknaTkxNV9zZWxmdGVzdCcsCiAJJ2k5MTVfc3Vz
cGVuZCcsCisJJ3N5c2ZzX3ByZWVtcHRpb25fdGltZW91dCcsCiBdCiAKIHRlc3RfZGVwcyA9IFsg
aWd0X2RlcHMgXQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZng=

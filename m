Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4901647AB8
	for <lists+intel-gfx@lfdr.de>; Mon, 17 Jun 2019 09:22:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C2C25891A3;
	Mon, 17 Jun 2019 07:22:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E55B18918F
 for <intel-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 07:22:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16923056-1500050 
 for multiple; Mon, 17 Jun 2019 08:19:16 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 17 Jun 2019 08:19:10 +0100
Message-Id: <20190617071912.20256-20-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617071912.20256-1-chris@chris-wilson.co.uk>
References: <20190617071912.20256-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 20/22] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com, mika.kuoppala@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dC5jICAgfCAgMTIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZm
ZXIuYyAgICB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5
cGVzLmggIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAg
ICAgICB8ICAgOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAg
ICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jICAgICAg
ICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAg
ICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAg
IHwgICAzIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8
IDE0OSArKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmggICAgICAg
ICAgICB8IDMwNSArKysrLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlX3R5cGVzLmggICAgICB8ICAxNyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW0uYyAgICAgICAgICAgICAgIHwgIDQyICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmMgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYyAgICAgICAgICAgfCAgNDkgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuaCAgICAgICAgICAgfCAgIDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1l
bGluZS5jICAgICAgICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVs
aW5lX3R5cGVzLmggICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMg
ICAgICAgICAgICAgICB8ICAzNiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zyb250
YnVmZmVyLmMgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zlcmxh
eS5jICAgICAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9hY3RpdmUuYyAgfCAgMjIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfdGlt
ZWxpbmUuYyAgICB8ICAgMiArLQogMjIgZmlsZXMgY2hhbmdlZCwgMjI1IGluc2VydGlvbnMoKyks
IDQ2OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuYwppbmRleCBjODU0NjhkNTE3ZWYuLjBjZDBiMmE4MzBiOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC05MTEsMjAgKzkxMSwxOCBAQCBz
dGF0aWMgaW50IGNvbnRleHRfYmFycmllcl90YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHgsCiAJCQkJdm9pZCAoKnRhc2spKHZvaWQgKmRhdGEpLAogCQkJCXZvaWQgKmRhdGEpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJc3RydWN0IGNvbnRl
eHRfYmFycmllcl90YXNrICpjYjsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0Owog
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyID0gMDsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCUdFTV9CVUdfT04oIXRhc2spOwog
CiAJY2IgPSBrbWFsbG9jKHNpemVvZigqY2IpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWNiKQogCQly
ZXR1cm4gLUVOT01FTTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmNiLT5iYXNlLCBOVUxM
LCBjYl9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoJmNiLT5iYXNlLCBOVUxMLCBjYl9yZXRp
cmUpOwogCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJmNiLT5iYXNlKTsKIAlpZiAoZXJyKSB7
CiAJCWtmcmVlKGNiKTsKQEAgLTk1Niw3ICs5NTQsOSBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFy
cmllcl90YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCWlmIChlbWl0KQogCQkJ
ZXJyID0gZW1pdChycSwgZGF0YSk7CiAJCWlmIChlcnIgPT0gMCkKLQkJCWVyciA9IGk5MTVfYWN0
aXZlX3JlZigmY2ItPmJhc2UsIHJxLT5mZW5jZS5jb250ZXh0LCBycSk7CisJCQllcnIgPSBpOTE1
X2FjdGl2ZV9yZWYoJmNiLT5iYXNlLAorCQkJCQkgICAgICBycS0+ZmVuY2UuY29udGV4dCwKKwkJ
CQkJICAgICAgJnJxLT5mZW5jZSk7CiAKIAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCWlmIChl
cnIpCkBAIC0xMTkzLDcgKzExOTMsNyBAQCBnZW44X21vZGlmeV9ycGNzKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3NldSkKIAkJcmV0dXJuIFBUUl9FUlIocnEp
OwogCiAJLyogUXVldWUgdGhpcyBzd2l0Y2ggYWZ0ZXIgYWxsIG90aGVyIGFjdGl2aXR5IGJ5IHRo
aXMgY29udGV4dC4gKi8KLQlyZXQgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmY2UtPnJpbmct
PnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsIHJxKTsKKwlyZXQgPSBpOTE1X2FjdGl2ZV9mZW5jZV9z
ZXQoJmNlLT5yaW5nLT50aW1lbGluZS0+bGFzdF9yZXF1ZXN0LCBycSk7CiAJaWYgKHJldCkKIAkJ
Z290byBvdXRfYWRkOwogCkBAIC0xMjA1LDcgKzEyMDUsNyBAQCBnZW44X21vZGlmeV9ycGNzKHN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3NldSkKIAkgKiB3b3Jk
cyB0cmFuc2ZlciB0aGUgcGlubmVkIGNlIG9iamVjdCB0byB0cmFja2VkIGFjdGl2ZSByZXF1ZXN0
LgogCSAqLwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZSgmY2UtPmFjdGl2ZSkpOwot
CXJldCA9IGk5MTVfYWN0aXZlX3JlZigmY2UtPmFjdGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJx
KTsKKwlyZXQgPSBpOTE1X2FjdGl2ZV9yZWYoJmNlLT5hY3RpdmUsIHJxLT5mZW5jZS5jb250ZXh0
LCAmcnEtPmZlbmNlKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF9hZGQ7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IDUyOGVlYTQ0ZGNj
Zi4uZWViNGM2Y2RiMDFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9leGVjYnVmZmVyLmMKQEAgLTEzMTYsNyArMTMxNiw3IEBAIHJlbG9jYXRlX2VudHJ5KHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLAogCiAJaWYgKCFlYi0+cmVsb2NfY2FjaGUudmFkZHIgJiYKIAkgICAg
KERCR19GT1JDRV9SRUxPQyA9PSBGT1JDRV9HUFVfUkVMT0MgfHwKLQkgICAgICFyZXNlcnZhdGlv
bl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3Uodm1hLT5yZXN2LCB0cnVlKSkpIHsKKwkgICAgIGk5
MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKSkgewogCQljb25zdCB1bnNpZ25lZCBpbnQgZ2VuID0gZWIt
PnJlbG9jX2NhY2hlLmdlbjsKIAkJdW5zaWduZWQgaW50IGxlbjsKIAkJdTMyICpiYXRjaDsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRl
eCAyMWJmYjdiZDBmNTcuLmU4N2ZjYTRkODE5NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtMTEsNiArMTEsOCBAQAogCiAjaW5j
bHVkZSA8ZHJtL2RybV9nZW0uaD4KIAorI2luY2x1ZGUgPHVhcGkvZHJtL2k5MTVfZHJtLmg+CisK
ICNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCAwNTAxMWQ0YTNiODguLjM1
YjczYzM0Nzg4NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTE1
LDE0ICsxNSwxMSBAQCBzdGF0aWMgdm9pZCBjYWxsX2lkbGVfYmFycmllcnMoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBsbGlzdF9ub2RlICpub2RlLCAqbmV4dDsKIAog
CWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbGxpc3RfZGVsX2FsbCgmZW5naW5lLT5i
YXJyaWVyX3Rhc2tzKSkgewotCQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlID0K
KwkJc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IgPQogCQkJY29udGFpbmVyX29mKChzdHJ1Y3QgbGlz
dF9oZWFkICopbm9kZSwKLQkJCQkgICAgIHR5cGVvZigqYWN0aXZlKSwgbGluayk7CisJCQkJICAg
ICB0eXBlb2YoKmNiKSwgbm9kZSk7CiAKLQkJSU5JVF9MSVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7
Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQotCQlhY3RpdmUt
PnJldGlyZShhY3RpdmUsIE5VTEwpOworCQljYi0+ZnVuYyhOVUxMLCBjYik7CiAJfQogfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggYWJlYjZiZjAxNTVhLi5i
ODUxOWYxNzY0YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Nv
bnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAg
LTE4Myw3ICsxODMsNyBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlLAogCiAJbXV0ZXhfaW5pdCgmY2UtPnBpbl9tdXRleCk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0
KGN0eC0+aTkxNSwgJmNlLT5hY3RpdmUsCisJaTkxNV9hY3RpdmVfaW5pdCgmY2UtPmFjdGl2ZSwK
IAkJCSBfX2ludGVsX2NvbnRleHRfYWN0aXZlLCBfX2ludGVsX2NvbnRleHRfcmV0aXJlKTsKIH0K
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXggODRjNjcwYmRiMDgxLi5l
ZTEwZDBjOGJlMWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jl
c2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwpAQCAtODgx
LDEwICs4ODEsMTAgQEAgc3RhdGljIGJvb2wgX19pOTE1X2dlbV91bnNldF93ZWRnZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICovCiAJbXV0ZXhfbG9jaygmaTkxNS0+Z3QudGlt
ZWxpbmVzLm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHRsLCAmaTkxNS0+Z3QudGltZWxp
bmVzLmFjdGl2ZV9saXN0LCBsaW5rKSB7Ci0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCQlz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotCQlycSA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0
X3VubG9ja2VkKCZ0bC0+bGFzdF9yZXF1ZXN0KTsKLQkJaWYgKCFycSkKKwkJZmVuY2UgPSBpOTE1
X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOworCQlpZiAoIWZlbmNlKQogCQkJ
Y29udGludWU7CiAKIAkJLyoKQEAgLTg5NCw4ICs4OTQsOCBAQCBzdGF0aWMgYm9vbCBfX2k5MTVf
Z2VtX3Vuc2V0X3dlZGdlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJICogKEk5
MTVfRkVOQ0VfVElNRU9VVCkgc28gdGhpcyB3YWl0IHNob3VsZCBub3QgYmUgdW5ib3VuZGVkCiAJ
CSAqIGluIHRoZSB3b3JzdCBjYXNlLgogCQkgKi8KLQkJZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdCgm
cnEtPmZlbmNlLCBmYWxzZSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCQlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKKwkJZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdChmZW5jZSwgZmFsc2UsIE1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJfQogCW11dGV4X3VubG9j
aygmaTkxNS0+Z3QudGltZWxpbmVzLm11dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYwppbmRleCAwYzk3Zjk1M2U5MDguLmEzOTFmZDUyYWRiYyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTg1NCw5ICs4NTQsMTMgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15X3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogCWlmICghcnEpCiAJCXJldHVybiBOVUxMOwogCi0JSU5JVF9MSVNUX0hFQUQoJnJx
LT5hY3RpdmVfbGlzdCk7CiAJcnEtPmVuZ2luZSA9IGVuZ2luZTsKIAorCXNwaW5fbG9ja19pbml0
KCZycS0+bG9jayk7CisJSU5JVF9MSVNUX0hFQUQoJnJxLT5mZW5jZS5jYl9saXN0KTsKKwlycS0+
ZmVuY2UubG9jayA9ICZycS0+bG9jazsKKwlycS0+ZmVuY2Uub3BzID0gJmk5MTVfZmVuY2Vfb3Bz
OworCiAJaTkxNV9zY2hlZF9ub2RlX2luaXQoJnJxLT5zY2hlZCk7CiAKIAkvKiBtYXJrIHRoaXMg
cmVxdWVzdCBhcyBwZXJtYW5lbnRseSBpbmNvbXBsZXRlICovCkBAIC05NDUsOCArOTQ5LDggQEAg
c3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJCQkJfQog
CiAJCQkJLyogRGlzYWJsZSBORVdDTElFTlQgcHJvbW90aW9uICovCi0JCQkJX19pOTE1X2FjdGl2
ZV9yZXF1ZXN0X3NldCgmcnFbaV0tPnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsCi0JCQkJCQkJICBk
dW1teSk7CisJCQkJX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnJxW2ldLT50aW1lbGluZS0+bGFz
dF9yZXF1ZXN0LAorCQkJCQkJCSZkdW1teS0+ZmVuY2UpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQo
cnFbaV0pOwogCQkJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2No
ZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKaW5kZXggOTAy
OWRlNGI0NjUxLi4xMjAyODFjMzM5MDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVy
LmMKQEAgLTM5MSwxMSArMzkxLDggQEAgaW50ZWxfZ3Z0X3dvcmtsb2FkX3JlcV9hbGxvYyhzdHJ1
Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiB7CiAJc3RydWN0IGludGVsX3ZncHUg
KnZncHUgPSB3b3JrbG9hZC0+dmdwdTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9zdWJtaXNzaW9uICpz
ID0gJnZncHUtPnN1Ym1pc3Npb247Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmICh3
b3JrbG9hZC0+cmVxKQogCQlyZXR1cm4gMDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMK
aW5kZXggMjBiMGUxOWFhZmZmLi44MWQ2MmVkMWQ0MGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYwpAQCAtOCw4ICs4LDYgQEAKICNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1
ZGUgImk5MTVfZ2xvYmFscy5oIgogCi0jZGVmaW5lIEJLTChyZWYpICgmKHJlZiktPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpCi0KIC8qCiAgKiBBY3RpdmUgcmVmcyBtZW1vcnkgbWFuYWdlbWVudAog
ICoKQEAgLTIzLDcgKzIxLDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X2dsb2JhbF9hY3RpdmUgewog
fSBnbG9iYWw7CiAKIHN0cnVjdCBhY3RpdmVfbm9kZSB7Ci0Jc3RydWN0IGk5MTVfYWN0aXZlX3Jl
cXVlc3QgYmFzZTsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgYmFzZTsKIAlzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZjsKIAlzdHJ1Y3QgcmJfbm9kZSBub2RlOwogCXU2NCB0aW1lbGluZTsKQEAg
LTU0LDcgKzUyLDcgQEAgX19hY3RpdmVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQog
CXJlZi0+cmV0aXJlKHJlZik7CiAKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUoaXQsIG4sICZyb290LCBub2RlKSB7Ci0JCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfcmVxdWVz
dF9pc3NldCgmaXQtPmJhc2UpKTsKKwkJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9mZW5jZV9pc3Nl
dCgmaXQtPmJhc2UpKTsKIAkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBpdCk7
CiAJfQogfQpAQCAtOTAsMTIgKzg4LDEzIEBAIGFjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYpCiB9CiAKIHN0YXRpYyB2b2lkCi1ub2RlX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3Rp
dmVfcmVxdWVzdCAqYmFzZSwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitub2RlX3JldGlyZShz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCiB7Ci0JYWN0
aXZlX3JldGlyZShjb250YWluZXJfb2YoYmFzZSwgc3RydWN0IGFjdGl2ZV9ub2RlLCBiYXNlKS0+
cmVmKTsKKwlpOTE1X2FjdGl2ZV9mZW5jZV9jYihmZW5jZSwgY2IpOworCWFjdGl2ZV9yZXRpcmUo
Y29udGFpbmVyX29mKGNiLCBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UuY2IpLT5yZWYpOwogfQog
Ci1zdGF0aWMgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKgorc3RhdGljIHN0cnVjdCBpOTE1
X2FjdGl2ZV9mZW5jZSAqCiBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYs
IHU2NCBpZHgpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlLCAqcHJlYWxsb2M7CkBAIC0x
MzgsNyArMTM3LDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1
NjQgaWR4KQogCX0KIAogCW5vZGUgPSBwcmVhbGxvYzsKLQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lu
aXQoJm5vZGUtPmJhc2UsIE5VTEwsIG5vZGVfcmV0aXJlKTsKKwlfX2k5MTVfYWN0aXZlX2ZlbmNl
X2luaXQoJm5vZGUtPmJhc2UsIE5VTEwsIG5vZGVfcmV0aXJlKTsKIAlub2RlLT5yZWYgPSByZWY7
CiAJbm9kZS0+dGltZWxpbmUgPSBpZHg7CiAKQEAgLTE1MiwxNiArMTUxLDEzIEBAIGFjdGl2ZV9p
bnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIAlyZXR1cm4gJm5vZGUt
PmJhc2U7CiB9CiAKLXZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAotCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCit2b2lkIF9faTkxNV9hY3Rp
dmVfaW5pdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWludCAoKmFjdGl2ZSkoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpLAogCQkJdm9pZCAoKnJldGlyZSkoc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYpLAogCQkJc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCiB7CiAJdW5zaWduZWQgbG9u
ZyBiaXRzOwogCi0JcmVmLT5pOTE1ID0gaTkxNTsKLQogCXJlZi0+ZmxhZ3MgPSAwOwogCXJlZi0+
YWN0aXZlID0gYWN0aXZlOwogCXJlZi0+cmV0aXJlID0gcHRyX3VucGFja19iaXRzKHJldGlyZSwg
JmJpdHMsIDIpOwpAQCAtMTc4LDkgKzE3NCw5IEBAIHZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBpbnQgaTkxNV9hY3RpdmVfcmVmKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkgICAgdTY0IHRpbWVsaW5lLAotCQkgICAgc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIHsKLQlzdHJ1
Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlOworCXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5j
ZSAqYWN0aXZlOwogCWludCBlcnI7CiAKIAkvKiBQcmV2ZW50IHJlYXBpbmcgaW4gY2FzZSB3ZSBt
YWxsb2Mvd2FpdCB3aGlsZSBidWlsZGluZyB0aGUgdHJlZSAqLwpAQCAtMTk0LDkgKzE5MCw5IEBA
IGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCWdvdG8gb3V0
OwogCX0KIAotCWlmICghaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldChhY3RpdmUpKQorCUdFTV9C
VUdfT04oIWF0b21pY19yZWFkKCZyZWYtPmNvdW50KSk7CisJaWYgKCFfX2k5MTVfYWN0aXZlX2Zl
bmNlX3NldChhY3RpdmUsIGZlbmNlKSkKIAkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7Ci0JX19p
OTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChhY3RpdmUsIHJxKTsKIAogb3V0OgogCWk5MTVfYWN0aXZl
X3JlbGVhc2UocmVmKTsKQEAgLTI0OCw3ICsyNDQsMTQgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJfQogCiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFj
aF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVlLCBub2RlKSB7Ci0JCWVyciA9IGk5MTVfYWN0
aXZlX3JlcXVlc3RfcmV0aXJlKCZpdC0+YmFzZSwgQktMKHJlZikpOworCQlzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZTsKKworCQlmZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgmaXQtPmJhc2Up
OworCQlpZiAoIWZlbmNlKQorCQkJY29udGludWU7CisKKwkJZXJyID0gZG1hX2ZlbmNlX3dhaXQo
ZmVuY2UsIHRydWUpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKIAkJaWYgKGVycikKIAkJCWJy
ZWFrOwogCX0KQEAgLTI2NCw0MCArMjY3LDYgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpCiAJcmV0dXJuIDA7CiB9CiAKLWludCBpOTE1X3JlcXVlc3RfYXdh
aXRfYWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0JCQkJICAgICAgc3Ry
dWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKLXsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpiYXJyaWVyID0KLQkJaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoYWN0aXZlLCAmcnEtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIGJhcnJpZXIgPyBpOTE1X3JlcXVlc3RfYXdh
aXRfZG1hX2ZlbmNlKHJxLCAmYmFycmllci0+ZmVuY2UpIDogMDsKLX0KLQotaW50IGk5MTVfcmVx
dWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKQotewotCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwotCWludCBlcnI7Ci0K
LQlpZiAoUkJfRU1QVFlfUk9PVCgmcmVmLT50cmVlKSkKLQkJcmV0dXJuIDA7Ci0KLQkvKiBhd2Fp
dCBhbGxvY2F0ZXMgYW5kIHNvIHdlIG5lZWQgdG8gYXZvaWQgaGl0dGluZyB0aGUgc2hyaW5rZXIg
Ki8KLQllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7Ci0JaWYgKGVycikKLQkJcmV0dXJu
IGVycjsKLQotCW11dGV4X2xvY2soJnJlZi0+bXV0ZXgpOwotCXJidHJlZV9wb3N0b3JkZXJfZm9y
X2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJlZi0+dHJlZSwgbm9kZSkgewotCQllcnIgPSBpOTE1
X3JlcXVlc3RfYXdhaXRfYWN0aXZlX3JlcXVlc3QocnEsICZpdC0+YmFzZSk7Ci0JCWlmIChlcnIp
Ci0JCQlicmVhazsKLQl9Ci0JbXV0ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsKLQotCWk5MTVfYWN0
aXZlX3JlbGVhc2UocmVmKTsKLQlyZXR1cm4gZXJyOwotfQotCiAjaWYgSVNfRU5BQkxFRChDT05G
SUdfRFJNX0k5MTVfREVCVUdfR0VNKQogdm9pZCBpOTE1X2FjdGl2ZV9maW5pKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQogewpAQCAtMzI2LDEzICsyOTUsMTIgQEAgaW50IGk5MTVfYWN0aXZlX2Fj
cXVpcmVfcHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWJy
ZWFrOwogCQl9CiAKLQkJaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KCZub2RlLT5iYXNlLAotCQkJ
CQkgKHZvaWQgKillbmdpbmUsIG5vZGVfcmV0aXJlKTsKKwkJX19pOTE1X2FjdGl2ZV9mZW5jZV9p
bml0KCZub2RlLT5iYXNlLCBlbmdpbmUsIG5vZGVfcmV0aXJlKTsKIAkJbm9kZS0+dGltZWxpbmUg
PSBrY3R4LT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dDsKIAkJbm9kZS0+cmVmID0gcmVm
OwogCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKIAotCQlsbGlzdF9hZGQoKHN0cnVjdCBsbGlz
dF9ub2RlICopJm5vZGUtPmJhc2UubGluaywKKwkJbGxpc3RfYWRkKChzdHJ1Y3QgbGxpc3Rfbm9k
ZSAqKSZub2RlLT5iYXNlLmNiLm5vZGUsCiAJCQkgICZyZWYtPmJhcnJpZXJzKTsKIAl9CiAKQEAg
LTM1MiwxMCArMzIwLDEwIEBAIHZvaWQgaTkxNV9hY3RpdmVfYWNxdWlyZV9iYXJyaWVyKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKQogCQlzdHJ1Y3QgcmJfbm9kZSAqKnAsICpwYXJlbnQ7CiAKIAkJ
bm9kZSA9IGNvbnRhaW5lcl9vZigoc3RydWN0IGxpc3RfaGVhZCAqKXBvcywKLQkJCQkgICAgdHlw
ZW9mKCpub2RlKSwgYmFzZS5saW5rKTsKKwkJCQkgICAgdHlwZW9mKCpub2RlKSwgYmFzZS5jYi5u
b2RlKTsKIAotCQllbmdpbmUgPSAodm9pZCAqKXJjdV9hY2Nlc3NfcG9pbnRlcihub2RlLT5iYXNl
LnJlcXVlc3QpOwotCQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJhc2UucmVxdWVzdCwgRVJSX1BU
UigtRUFHQUlOKSk7CisJCWVuZ2luZSA9ICh2b2lkICopcmN1X2FjY2Vzc19wb2ludGVyKG5vZGUt
PmJhc2UuZmVuY2UpOworCQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJhc2UuZmVuY2UsIEVSUl9Q
VFIoLUVBR0FJTikpOwogCiAJCXBhcmVudCA9IE5VTEw7CiAJCXAgPSAmcmVmLT50cmVlLnJiX25v
ZGU7CkBAIC0zNzEsNyArMzM5LDcgQEAgdm9pZCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJCXJiX2xpbmtfbm9kZSgmbm9kZS0+bm9kZSwgcGFy
ZW50LCBwKTsKIAkJcmJfaW5zZXJ0X2NvbG9yKCZub2RlLT5ub2RlLCAmcmVmLT50cmVlKTsKIAot
CQlsbGlzdF9hZGQoKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UubGluaywKKwkJbGxp
c3RfYWRkKChzdHJ1Y3QgbGxpc3Rfbm9kZSAqKSZub2RlLT5iYXNlLmNiLm5vZGUsCiAJCQkgICZl
bmdpbmUtPmJhcnJpZXJfdGFza3MpOwogCX0KIAltdXRleF91bmxvY2soJnJlZi0+bXV0ZXgpOwpA
QCAtMzgxLDI5ICszNDksNzIgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkX2JhcnJpZXJzKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9
IHJxLT5lbmdpbmU7CiAJc3RydWN0IGxsaXN0X25vZGUgKm5vZGUsICpuZXh0OworCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7CisKKwlHRU1fQlVHX09OKGludGVsX2VuZ2luZV9pc192aXJ0dWFsKGVuZ2lu
ZSkpOworCW5vZGUgPSBsbGlzdF9kZWxfYWxsKCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpOworCWlm
ICghbm9kZSkKKwkJcmV0dXJuOwogCi0JbGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0LCBs
bGlzdF9kZWxfYWxsKCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKQotCQlsaXN0X2FkZF90YWlsKChz
dHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwgJnJxLT5hY3RpdmVfbGlzdCk7CisJc3Bpbl9sb2NrX2ly
cXNhdmUoJnJxLT5sb2NrLCBmbGFncyk7CisJbGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0
LCBub2RlKQorCQlsaXN0X2FkZF90YWlsKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwgJnJxLT5m
ZW5jZS5jYl9saXN0KTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZycS0+bG9jaywgZmxhZ3Mp
OwogfQogCi1pbnQgaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX3Jl
cXVlc3QgKmFjdGl2ZSwKLQkJCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3N0cnVjdCBk
bWFfZmVuY2UgKgorX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX2Zl
bmNlICphY3RpdmUsCisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIHsKKwlzdHJ1Y3QgZG1h
X2ZlbmNlICpwcmV2OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwkvKiBOQjogdXBkYXRlcyBt
dXN0IGJlIHNlcmlhbGlzZWQgYnkgYW4gb3V0ZXIgdGltZWxpbmUgbXV0ZXggKi8KKwlzcGluX2xv
Y2tfaXJxc2F2ZShmZW5jZS0+bG9jaywgZmxhZ3MpOworCUdFTV9CVUdfT04odGVzdF9iaXQoRE1B
X0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSk7CisKKwlwcmV2ID0gcmN1
X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChhY3RpdmUtPmZlbmNlLCAxIC8qIHRpbWVsaW5lIG11dGV4
ICovKTsKKwlpZiAocHJldikgeworCQlzcGluX2xvY2tfbmVzdGVkKHByZXYtPmxvY2ssIFNJTkdM
RV9ERVBUSF9ORVNUSU5HKTsKKwkJX19saXN0X2RlbF9lbnRyeSgmYWN0aXZlLT5jYi5ub2RlKTsK
KwkJc3Bpbl91bmxvY2socHJldi0+bG9jayk7CisJCXByZXYgPSByY3VfYWNjZXNzX3BvaW50ZXIo
YWN0aXZlLT5mZW5jZSk7CisJfQorCisJcmN1X2Fzc2lnbl9wb2ludGVyKGFjdGl2ZS0+ZmVuY2Us
IGZlbmNlKTsKKwlsaXN0X2FkZF90YWlsKCZhY3RpdmUtPmNiLm5vZGUsICZmZW5jZS0+Y2JfbGlz
dCk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CisKKwly
ZXR1cm4gcHJldjsKK30KKworaW50IGk5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9h
Y3RpdmVfZmVuY2UgKmFjdGl2ZSwKKwkJCSAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJ
c3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAJaW50IGVycjsKIAogCS8qIE11c3QgbWFpbnRhaW4g
b3JkZXJpbmcgd3J0IHByZXZpb3VzIGFjdGl2ZSByZXF1ZXN0cyAqLwotCWVyciA9IGk5MTVfcmVx
dWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChycSwgYWN0aXZlKTsKLQlpZiAoZXJyKQotCQlyZXR1
cm4gZXJyOworCXJjdV9yZWFkX2xvY2soKTsKKwlmZW5jZSA9IF9faTkxNV9hY3RpdmVfZmVuY2Vf
c2V0KGFjdGl2ZSwgJnJxLT5mZW5jZSk7CisJaWYgKGZlbmNlKQorCQlmZW5jZSA9IGRtYV9mZW5j
ZV9nZXRfcmN1KGZlbmNlKTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCWlmIChmZW5jZSkgewor
CQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CisJCWRtYV9m
ZW5jZV9wdXQoZmVuY2UpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CiAKLQlfX2k5
MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KGFjdGl2ZSwgcnEpOwogCXJldHVybiAwOwogfQogCi12b2lk
IGk5MTVfYWN0aXZlX3JldGlyZV9ub29wKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3Rp
dmUsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCit2b2lkIGk5MTVfYWN0
aXZlX25vb3Aoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNi
KQogewotCS8qIFNwYWNlIGxlZnQgaW50ZW50aW9uYWxseSBibGFuayAqLworCWk5MTVfYWN0aXZl
X2ZlbmNlX2NiKGZlbmNlLCBjYik7CiB9CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkx
NV9TRUxGVEVTVCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZl
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCmluZGV4IDkxMWE4MzM4MDA3
YS4uZmRmODdiYWQ3NmQ1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Fj
dGl2ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKQEAgLTEwLDcg
KzEwLDkgQEAKICNpbmNsdWRlIDxsaW51eC9sb2NrZGVwLmg+CiAKICNpbmNsdWRlICJpOTE1X2Fj
dGl2ZV90eXBlcy5oIgotI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgorCitzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0Oworc3RydWN0IGludGVsX2VuZ2luZV9jczsKIAogLyoKICAqIFdlIHRyZWF0IHJlcXVl
c3RzIGFzIGZlbmNlcy4gVGhpcyBpcyBub3QgYmUgdG8gY29uZnVzZWQgd2l0aCBvdXIKQEAgLTI4
LDMwMCArMzAsMTAzIEBACiAgKiB3cml0ZSBhY2Nlc3Mgc28gdGhhdCB3ZSBjYW4gcGVyZm9ybSBj
b25jdXJyZW50IHJlYWQgb3BlcmF0aW9ucyBiZXR3ZWVuCiAgKiB0aGUgQ1BVIGFuZCBHUFUgZW5n
aW5lcywgYXMgd2VsbCBhcyB3YWl0aW5nIGZvciBhbGwgcmVuZGVyaW5nIHRvCiAgKiBjb21wbGV0
ZSwgb3Igd2FpdGluZyBmb3IgdGhlIGxhc3QgR1BVIHVzZXIgb2YgYSAiZmVuY2UgcmVnaXN0ZXIi
LiBUaGUKLSAqIG9iamVjdCB0aGVuIGVtYmVkcyBhICNpOTE1X2FjdGl2ZV9yZXF1ZXN0IHRvIHRy
YWNrIHRoZSBtb3N0IHJlY2VudCAoaW4KKyAqIG9iamVjdCB0aGVuIGVtYmVkcyBhICNpOTE1X2Fj
dGl2ZV9mZW5jZSB0byB0cmFjayB0aGUgbW9zdCByZWNlbnQgKGluCiAgKiByZXRpcmVtZW50IG9y
ZGVyKSByZXF1ZXN0IHJlbGV2YW50IGZvciB0aGUgZGVzaXJlZCBtb2RlIG9mIGFjY2Vzcy4KLSAq
IFRoZSAjaTkxNV9hY3RpdmVfcmVxdWVzdCBpcyB1cGRhdGVkIHdpdGggaTkxNV9hY3RpdmVfcmVx
dWVzdF9zZXQoKSB0bworICogVGhlICNpOTE1X2FjdGl2ZV9mZW5jZSBpcyB1cGRhdGVkIHdpdGgg
aTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCkgdG8KICAqIHRyYWNrIHRoZSBtb3N0IHJlY2VudCBmZW5j
ZSByZXF1ZXN0LCB0eXBpY2FsbHkgdGhpcyBpcyBkb25lIGFzIHBhcnQgb2YKICAqIGk5MTVfdm1h
X21vdmVfdG9fYWN0aXZlKCkuCiAgKgotICogV2hlbiB0aGUgI2k5MTVfYWN0aXZlX3JlcXVlc3Qg
Y29tcGxldGVzIChpcyByZXRpcmVkKSwgaXQgd2lsbAorICogV2hlbiB0aGUgI2k5MTVfYWN0aXZl
X2ZlbmNlIGNvbXBsZXRlcyAoaXMgcmV0aXJlZCksIGl0IHdpbGwKICAqIHNpZ25hbCBpdHMgY29t
cGxldGlvbiB0byB0aGUgb3duZXIgdGhyb3VnaCBhIGNhbGxiYWNrIGFzIHdlbGwgYXMgbWFyawot
ICogaXRzZWxmIGFzIGlkbGUgKGk5MTVfYWN0aXZlX3JlcXVlc3QucmVxdWVzdCA9PSBOVUxMKS4g
VGhlIG93bmVyCisgKiBpdHNlbGYgYXMgaWRsZSAoaTkxNV9hY3RpdmVfZmVuY2UucmVxdWVzdCA9
PSBOVUxMKS4gVGhlIG93bmVyCiAgKiBjYW4gdGhlbiBwZXJmb3JtIGFueSBhY3Rpb24sIHN1Y2gg
YXMgZGVsYXllZCBmcmVlaW5nIG9mIGFuIGFjdGl2ZQogICogcmVzb3VyY2UgaW5jbHVkaW5nIGl0
c2VsZi4KICAqLwogCi12b2lkIGk5MTVfYWN0aXZlX3JldGlyZV9ub29wKHN0cnVjdCBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVl
c3QpOwordm9pZCBpOTE1X2FjdGl2ZV9ub29wKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1
Y3QgZG1hX2ZlbmNlX2NiICpjYik7CiAKIC8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0
IC0gcHJlcGFyZXMgdGhlIGFjdGl2aXR5IHRyYWNrZXIgZm9yIHVzZQorICogX19pOTE1X2FjdGl2
ZV9mZW5jZV9pbml0IC0gcHJlcGFyZXMgdGhlIGFjdGl2aXR5IHRyYWNrZXIgZm9yIHVzZQogICog
QGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICogQHJxIC0gaW5pdGlhbCByZXF1ZXN0IHRv
IHRyYWNrLCBjYW4gYmUgTlVMTAorICogQGZlbmNlIC0gaW5pdGlhbCBmZW5jZSB0byB0cmFjaywg
Y2FuIGJlIE5VTEwKICAqIEBmdW5jIC0gYSBjYWxsYmFjayB3aGVuIHRoZW4gdGhlIHRyYWNrZXIg
aXMgcmV0aXJlZCAoYmVjb21lcyBpZGxlKSwKICAqICAgICAgICAgY2FuIGJlIE5VTEwKICAqCi0g
KiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoKSBwcmVwYXJlcyB0aGUgZW1iZWRkZWQgQGFjdGl2
ZSBzdHJ1Y3QgZm9yIHVzZSBhcwotICogYW4gYWN0aXZpdHkgdHJhY2tlciwgdGhhdCBpcyBmb3Ig
dHJhY2tpbmcgdGhlIGxhc3Qga25vd24gYWN0aXZlIHJlcXVlc3QKLSAqIGFzc29jaWF0ZWQgd2l0
aCBpdC4gV2hlbiB0aGUgbGFzdCByZXF1ZXN0IGJlY29tZXMgaWRsZSwgd2hlbiBpdCBpcyByZXRp
cmVkCisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCkgcHJlcGFyZXMgdGhlIGVtYmVkZGVkIEBh
Y3RpdmUgc3RydWN0IGZvciB1c2UgYXMKKyAqIGFuIGFjdGl2aXR5IHRyYWNrZXIsIHRoYXQgaXMg
Zm9yIHRyYWNraW5nIHRoZSBsYXN0IGtub3duIGFjdGl2ZSBmZW5jZQorICogYXNzb2NpYXRlZCB3
aXRoIGl0LiBXaGVuIHRoZSBsYXN0IGZlbmNlIGJlY29tZXMgaWRsZSwgd2hlbiBpdCBpcyByZXRp
cmVkCiAgKiBhZnRlciBjb21wbGV0aW9uLCB0aGUgb3B0aW9uYWwgY2FsbGJhY2sgQGZ1bmMgaXMg
aW52b2tlZC4KICAqLwogc3RhdGljIGlubGluZSB2b2lkCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2lu
aXQoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwKLQkJCSBpOTE1X2FjdGl2ZV9yZXRpcmVfZm4gcmV0aXJlKQorX19pOTE1X2Fj
dGl2ZV9mZW5jZV9pbml0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkJIHZv
aWQgKmZlbmNlLAorCQkJIGRtYV9mZW5jZV9mdW5jX3QgZm4pCiB7Ci0JUkNVX0lOSVRfUE9JTlRF
UihhY3RpdmUtPnJlcXVlc3QsIHJxKTsKLQlJTklUX0xJU1RfSEVBRCgmYWN0aXZlLT5saW5rKTsK
LQlhY3RpdmUtPnJldGlyZSA9IHJldGlyZSA/OiBpOTE1X2FjdGl2ZV9yZXRpcmVfbm9vcDsKKwlS
Q1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIGZlbmNlKTsKKwlhY3RpdmUtPmNiLmZ1bmMg
PSBmbiA/OiBpOTE1X2FjdGl2ZV9ub29wOwogfQogCi0jZGVmaW5lIElOSVRfQUNUSVZFX1JFUVVF
U1QobmFtZSkgaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KChuYW1lKSwgTlVMTCwgTlVMTCkKLQot
LyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCAtIHVwZGF0ZXMgdGhlIHRyYWNrZXIgdG8g
d2F0Y2ggdGhlIGN1cnJlbnQgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tl
cgotICogQHJlcXVlc3QgLSB0aGUgcmVxdWVzdCB0byB3YXRjaAotICoKLSAqIF9faTkxNV9hY3Rp
dmVfcmVxdWVzdF9zZXQoKSB3YXRjaGVzIHRoZSBnaXZlbiBAcmVxdWVzdCBmb3IgY29tcGxldGlv
bi4gV2hpbHN0Ci0gKiB0aGF0IEByZXF1ZXN0IGlzIGJ1c3ksIHRoZSBAYWN0aXZlIHJlcG9ydHMg
YnVzeS4gV2hlbiB0aGF0IEByZXF1ZXN0IGlzCi0gKiByZXRpcmVkLCB0aGUgQGFjdGl2ZSB0cmFj
a2VyIGlzIHVwZGF0ZWQgdG8gcmVwb3J0IGlkbGUuCi0gKi8KLXN0YXRpYyBpbmxpbmUgdm9pZAot
X19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0
aXZlLAotCQkJICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQotewotCWxpc3RfbW92ZSgm
YWN0aXZlLT5saW5rLCAmcmVxdWVzdC0+YWN0aXZlX2xpc3QpOwotCXJjdV9hc3NpZ25fcG9pbnRl
cihhY3RpdmUtPnJlcXVlc3QsIHJlcXVlc3QpOwotfQotCi1pbnQgX19tdXN0X2NoZWNrCi1pOTE1
X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAot
CQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwotCi0vKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVl
c3RfcmF3IC0gcmV0dXJuIHRoZSBhY3RpdmUgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3Rp
dmUgdHJhY2tlcgotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KCkgcmV0dXJucyB0aGUg
Y3VycmVudCByZXF1ZXN0IGJlaW5nIHRyYWNrZWQsIG9yIE5VTEwuCi0gKiBJdCBkb2VzIG5vdCBv
YnRhaW4gYSByZWZlcmVuY2Ugb24gdGhlIHJlcXVlc3QgZm9yIHRoZSBjYWxsZXIsIHNvIHRoZSBj
YWxsZXIKLSAqIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCi0gKi8KLXN0YXRpYyBpbmxpbmUgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3Jhdyhjb25zdCBzdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJc3RydWN0IG11dGV4ICptdXRleCkKLXsK
LQlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChhY3RpdmUtPnJlcXVlc3QsCi0JCQkJ
CSBsb2NrZGVwX2lzX2hlbGQobXV0ZXgpKTsKLX0KLQotLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1
ZXN0X3BlZWsgLSByZXBvcnQgdGhlIGFjdGl2ZSByZXF1ZXN0IGJlaW5nIG1vbml0b3JlZAotICog
QGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3Rf
cGVlaygpIHJldHVybnMgdGhlIGN1cnJlbnQgcmVxdWVzdCBiZWluZyB0cmFja2VkIGlmCi0gKiBz
dGlsbCBhY3RpdmUsIG9yIE5VTEwuIEl0IGRvZXMgbm90IG9idGFpbiBhIHJlZmVyZW5jZSBvbiB0
aGUgcmVxdWVzdAotICogZm9yIHRoZSBjYWxsZXIsIHNvIHRoZSBjYWxsZXIgbXVzdCBob2xkIHN0
cnVjdF9tdXRleC4KLSAqLwotc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5
MTVfYWN0aXZlX3JlcXVlc3RfcGVlayhjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAq
YWN0aXZlLAotCQkJIHN0cnVjdCBtdXRleCAqbXV0ZXgpCi17Ci0Jc3RydWN0IGk5MTVfcmVxdWVz
dCAqcmVxdWVzdDsKLQotCXJlcXVlc3QgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdyhhY3RpdmUs
IG11dGV4KTsKLQlpZiAoIXJlcXVlc3QgfHwgaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChyZXF1ZXN0
KSkKLQkJcmV0dXJuIE5VTEw7CisjZGVmaW5lIElOSVRfQUNUSVZFX0ZFTkNFKEEpIF9faTkxNV9h
Y3RpdmVfZmVuY2VfaW5pdChBLCBOVUxMLCBOVUxMKQogCi0JcmV0dXJuIHJlcXVlc3Q7Ci19Citz
dHJ1Y3QgZG1hX2ZlbmNlICoKK19faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2Fj
dGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwogCiAvKioK
LSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBh
Y3RpdmUgcmVxdWVzdAorICogaTkxNV9hY3RpdmVfZmVuY2Vfc2V0IC0gdXBkYXRlcyB0aGUgdHJh
Y2tlciB0byB3YXRjaCB0aGUgY3VycmVudCBmZW5jZQogICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUg
dHJhY2tlcgorICogQHJxIC0gdGhlIHJlcXVlc3QgdG8gd2F0Y2gKICAqCi0gKiBpOTE1X2FjdGl2
ZV9yZXF1ZXN0X2dldCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0
LCBvciBOVUxMCi0gKiBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgaWRsZS4gVGhlIGNhbGxlciBt
dXN0IGhvbGQgc3RydWN0X211dGV4LgorICogaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCkgd2F0Y2hl
cyB0aGUgZ2l2ZW4gQHJxIGZvciBjb21wbGV0aW9uLiBXaGlsZQorICogdGhhdCBAcnEgaXMgYnVz
eSwgdGhlIEBhY3RpdmUgcmVwb3J0cyBidXN5LiBXaGVuIHRoYXQgQHJxIGlzIHNpZ25hbGVkCisg
KiAob3IgZWxzZSByZXRpcmVkKSB0aGUgQGFjdGl2ZSB0cmFja2VyIGlzIHVwZGF0ZWQgdG8gcmVw
b3J0IGlkbGUuCiAgKi8KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1
X2FjdGl2ZV9yZXF1ZXN0X2dldChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0
aXZlLAotCQkJc3RydWN0IG11dGV4ICptdXRleCkKLXsKLQlyZXR1cm4gaTkxNV9yZXF1ZXN0X2dl
dChpOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoYWN0aXZlLCBtdXRleCkpOwotfQotCi0vKioKLSAq
IF9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmN1IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRo
ZSBhY3RpdmUgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICoKLSAq
IF9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoKSByZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBh
Y3RpdmUgcmVxdWVzdCwKLSAqIG9yIE5VTEwgaWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUu
IFRoZSBjYWxsZXIgbXVzdCBob2xkIHRoZSBSQ1UgcmVhZAotICogbG9jaywgYnV0IHRoZSByZXR1
cm5lZCBwb2ludGVyIGlzIHNhZmUgdG8gdXNlIG91dHNpZGUgb2YgUkNVLgotICovCi1zdGF0aWMg
aW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF9y
Y3UoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKLXsKLQkvKgotCSAq
IFBlcmZvcm1pbmcgYSBsb2NrbGVzcyByZXRyaWV2YWwgb2YgdGhlIGFjdGl2ZSByZXF1ZXN0IGlz
IHN1cGVyCi0JICogdHJpY2t5LiBTTEFCX1RZUEVTQUZFX0JZX1JDVSBtZXJlbHkgZ3VhcmFudGVl
cyB0aGF0IHRoZSBiYWNraW5nCi0JICogc2xhYiBvZiByZXF1ZXN0IG9iamVjdHMgd2lsbCBub3Qg
YmUgZnJlZWQgd2hpbHN0IHdlIGhvbGQgdGhlCi0JICogUkNVIHJlYWQgbG9jay4gSXQgZG9lcyBu
b3QgZ3VhcmFudGVlIHRoYXQgdGhlIHJlcXVlc3QgaXRzZWxmCi0JICogd2lsbCBub3QgYmUgZnJl
ZWQgYW5kIHRoZW4gKnJldXNlZCouIFZpeiwKLQkgKgotCSAqIFRocmVhZCBBCQkJVGhyZWFkIEIK
LQkgKgotCSAqIHJxID0gYWN0aXZlLnJlcXVlc3QKLQkgKgkJCQlyZXRpcmUocnEpIC0+IGZyZWUo
cnEpOwotCSAqCQkJCShycSBpcyBub3cgZmlyc3Qgb24gdGhlIHNsYWIgZnJlZWxpc3QpCi0JICoJ
CQkJYWN0aXZlLnJlcXVlc3QgPSBOVUxMCi0JICoKLQkgKgkJCQlycSA9IG5ldyBzdWJtaXNzaW9u
IG9uIGEgbmV3IG9iamVjdAotCSAqIHJlZihycSkKLQkgKgotCSAqIFRvIHByZXZlbnQgdGhlIHJl
cXVlc3QgZnJvbSBiZWluZyByZXVzZWQgd2hpbHN0IHRoZSBjYWxsZXIKLQkgKiB1c2VzIGl0LCB3
ZSB0YWtlIGEgcmVmZXJlbmNlIGxpa2Ugbm9ybWFsLiBXaGlsc3QgYWNxdWlyaW5nCi0JICogdGhl
IHJlZmVyZW5jZSB3ZSBjaGVjayB0aGF0IGl0IGlzIG5vdCBpbiBhIGRlc3Ryb3llZCBzdGF0ZQot
CSAqIChyZWZjbnQgPT0gMCkuIFRoYXQgcHJldmVudHMgdGhlIHJlcXVlc3QgYmVpbmcgcmVhbGxv
Y2F0ZWQKLQkgKiB3aGlsc3QgdGhlIGNhbGxlciBob2xkcyBvbiB0byBpdC4gVG8gY2hlY2sgdGhh
dCB0aGUgcmVxdWVzdAotCSAqIHdhcyBub3QgcmVhbGxvY2F0ZWQgYXMgd2UgYWNxdWlyZWQgdGhl
IHJlZmVyZW5jZSB3ZSBoYXZlIHRvCi0JICogY2hlY2sgdGhhdCBvdXIgcmVxdWVzdCByZW1haW5z
IHRoZSBhY3RpdmUgcmVxdWVzdCBhY3Jvc3MKLQkgKiB0aGUgbG9va3VwLCBpbiB0aGUgc2FtZSBt
YW5uZXIgYXMgYSBzZXFsb2NrLiBUaGUgdmlzaWJpbGl0eQotCSAqIG9mIHRoZSBwb2ludGVyIHZl
cnN1cyB0aGUgcmVmZXJlbmNlIGNvdW50aW5nIGlzIGNvbnRyb2xsZWQKLQkgKiBieSB1c2luZyBS
Q1UgYmFycmllcnMgKHJjdV9kZXJlZmVyZW5jZSBhbmQgcmN1X2Fzc2lnbl9wb2ludGVyKS4KLQkg
KgotCSAqIEluIHRoZSBtaWRkbGUgb2YgYWxsIHRoYXQsIHdlIGluc3BlY3Qgd2hldGhlciB0aGUg
cmVxdWVzdCBpcwotCSAqIGNvbXBsZXRlLiBSZXRpcmluZyBpcyBsYXp5IHNvIHRoZSByZXF1ZXN0
IG1heSBiZSBjb21wbGV0ZWQgbG9uZwotCSAqIGJlZm9yZSB0aGUgYWN0aXZlIHRyYWNrZXIgaXMg
dXBkYXRlZC4gUXVlcnlpbmcgd2hldGhlciB0aGUKLQkgKiByZXF1ZXN0IGlzIGNvbXBsZXRlIGlz
IGZhciBjaGVhcGVyIChhcyBpdCBpbnZvbHZlcyBubyBsb2NrZWQKLQkgKiBpbnN0cnVjdGlvbnMg
c2V0dGluZyBjYWNoZWxpbmVzIHRvIGV4Y2x1c2l2ZSkgdGhhbiBhY3F1aXJpbmcKLQkgKiB0aGUg
cmVmZXJlbmNlLCBzbyB3ZSBkbyBpdCBmaXJzdC4gVGhlIFJDVSByZWFkIGxvY2sgZW5zdXJlcyB0
aGUKLQkgKiBwb2ludGVyIGRlcmVmZXJlbmNlIGlzIHZhbGlkLCBidXQgZG9lcyBub3QgZW5zdXJl
IHRoYXQgdGhlCi0JICogc2Vxbm8gbm9yIEhXUyBpcyB0aGUgcmlnaHQgb25lISBIb3dldmVyLCBp
ZiB0aGUgcmVxdWVzdCB3YXMKLQkgKiByZWFsbG9jYXRlZCwgdGhhdCBtZWFucyB0aGUgYWN0aXZl
IHRyYWNrZXIncyByZXF1ZXN0IHdhcyBjb21wbGV0ZS4KLQkgKiBJZiB0aGUgbmV3IHJlcXVlc3Qg
aXMgYWxzbyBjb21wbGV0ZSwgdGhlbiBib3RoIGFyZSBhbmQgd2UgY2FuCi0JICoganVzdCByZXBv
cnQgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUuIElmIHRoZSBuZXcgcmVxdWVzdCBpcwotCSAq
IGluY29tcGxldGUsIHRoZW4gd2UgYWNxdWlyZSBhIHJlZmVyZW5jZSBvbiBpdCBhbmQgY2hlY2sg
dGhhdAotCSAqIGl0IHJlbWFpbmVkIHRoZSBhY3RpdmUgcmVxdWVzdC4KLQkgKgotCSAqIEl0IGlz
IHRoZW4gaW1wZXJhdGl2ZSB0aGF0IHdlIGRvIG5vdCB6ZXJvIHRoZSByZXF1ZXN0IG9uCi0JICog
cmVhbGxvY2F0aW9uLCBzbyB0aGF0IHdlIGNhbiBjaGFzZSB0aGUgZGFuZ2xpbmcgcG9pbnRlcnMh
Ci0JICogU2VlIGk5MTVfcmVxdWVzdF9hbGxvYygpLgotCSAqLwotCWRvIHsKLQkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcmVxdWVzdDsKLQotCQlyZXF1ZXN0ID0gcmN1X2RlcmVmZXJlbmNlKGFjdGl2
ZS0+cmVxdWVzdCk7Ci0JCWlmICghcmVxdWVzdCB8fCBpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJl
cXVlc3QpKQotCQkJcmV0dXJuIE5VTEw7Ci0KLQkJLyoKLQkJICogQW4gZXNwZWNpYWxseSBzaWxs
eSBjb21waWxlciBjb3VsZCBkZWNpZGUgdG8gcmVjb21wdXRlIHRoZQotCQkgKiByZXN1bHQgb2Yg
aTkxNV9yZXF1ZXN0X2NvbXBsZXRlZCwgbW9yZSBzcGVjaWZpY2FsbHkKLQkJICogcmUtZW1pdCB0
aGUgbG9hZCBmb3IgcmVxdWVzdC0+ZmVuY2Uuc2Vxbm8uIEEgcmFjZSB3b3VsZCBjYXRjaAotCQkg
KiBhIGxhdGVyIHNlcW5vIHZhbHVlLCB3aGljaCBjb3VsZCBmbGlwIHRoZSByZXN1bHQgZnJvbSB0
cnVlIHRvCi0JCSAqIGZhbHNlLiBXaGljaCBtZWFucyBwYXJ0IG9mIHRoZSBpbnN0cnVjdGlvbnMg
YmVsb3cgbWlnaHQgbm90Ci0JCSAqIGJlIGV4ZWN1dGVkLCB3aGlsZSBsYXRlciBvbiBpbnN0cnVj
dGlvbnMgYXJlIGV4ZWN1dGVkLiBEdWUgdG8KLQkJICogYmFycmllcnMgd2l0aGluIHRoZSByZWZj
b3VudGluZyB0aGUgaW5jb25zaXN0ZW5jeSBjYW4ndCByZWFjaAotCQkgKiBwYXN0IHRoZSBjYWxs
IHRvIGk5MTVfcmVxdWVzdF9nZXRfcmN1LCBidXQgbm90IGV4ZWN1dGluZwotCQkgKiB0aGF0IHdo
aWxlIHN0aWxsIGV4ZWN1dGluZyBpOTE1X3JlcXVlc3RfcHV0KCkgY3JlYXRlcwotCQkgKiBoYXZv
YyBlbm91Z2guICBQcmV2ZW50IHRoaXMgd2l0aCBhIGNvbXBpbGVyIGJhcnJpZXIuCi0JCSAqLwot
CQliYXJyaWVyKCk7Ci0KLQkJcmVxdWVzdCA9IGk5MTVfcmVxdWVzdF9nZXRfcmN1KHJlcXVlc3Qp
OwotCi0JCS8qCi0JCSAqIFdoYXQgc3RvcHMgdGhlIGZvbGxvd2luZyByY3VfYWNjZXNzX3BvaW50
ZXIoKSBmcm9tIG9jY3VycmluZwotCQkgKiBiZWZvcmUgdGhlIGFib3ZlIGk5MTVfcmVxdWVzdF9n
ZXRfcmN1KCk/IElmIHdlIHdlcmUKLQkJICogdG8gcmVhZCB0aGUgdmFsdWUgYmVmb3JlIHBhdXNp
bmcgdG8gZ2V0IHRoZSByZWZlcmVuY2UgdG8KLQkJICogdGhlIHJlcXVlc3QsIHdlIG1heSBub3Qg
bm90aWNlIGEgY2hhbmdlIGluIHRoZSBhY3RpdmUKLQkJICogdHJhY2tlci4KLQkJICoKLQkJICog
VGhlIHJjdV9hY2Nlc3NfcG9pbnRlcigpIGlzIGEgbWVyZSBjb21waWxlciBiYXJyaWVyLCB3aGlj
aAotCQkgKiBtZWFucyBib3RoIHRoZSBDUFUgYW5kIGNvbXBpbGVyIGFyZSBmcmVlIHRvIHBlcmZv
cm0gdGhlCi0JCSAqIG1lbW9yeSByZWFkIHdpdGhvdXQgY29uc3RyYWludC4gVGhlIGNvbXBpbGVy
IG9ubHkgaGFzIHRvCi0JCSAqIGVuc3VyZSB0aGF0IGFueSBvcGVyYXRpb25zIGFmdGVyIHRoZSBy
Y3VfYWNjZXNzX3BvaW50ZXIoKQotCQkgKiBvY2N1ciBhZnRlcndhcmRzIGluIHByb2dyYW0gb3Jk
ZXIuIFRoaXMgbWVhbnMgdGhlIHJlYWQgbWF5Ci0JCSAqIGJlIHBlcmZvcm1lZCBlYXJsaWVyIGJ5
IGFuIG91dC1vZi1vcmRlciBDUFUsIG9yIGFkdmVudHVyb3VzCi0JCSAqIGNvbXBpbGVyLgotCQkg
KgotCQkgKiBUaGUgYXRvbWljIG9wZXJhdGlvbiBhdCB0aGUgaGVhcnQgb2YKLQkJICogaTkxNV9y
ZXF1ZXN0X2dldF9yY3UoKSwgc2VlIGRtYV9mZW5jZV9nZXRfcmN1KCksIGlzCi0JCSAqIGF0b21p
Y19pbmNfbm90X3plcm8oKSB3aGljaCBpcyBvbmx5IGEgZnVsbCBtZW1vcnkgYmFycmllcgotCQkg
KiB3aGVuIHN1Y2Nlc3NmdWwuIFRoYXQgaXMsIGlmIGk5MTVfcmVxdWVzdF9nZXRfcmN1KCkKLQkJ
ICogcmV0dXJucyB0aGUgcmVxdWVzdCAoYW5kIHNvIHdpdGggdGhlIHJlZmVyZW5jZSBjb3VudGVk
Ci0JCSAqIGluY3JlbWVudGVkKSB0aGVuIHRoZSBmb2xsb3dpbmcgcmVhZCBmb3IgcmN1X2FjY2Vz
c19wb2ludGVyKCkKLQkJICogbXVzdCBvY2N1ciBhZnRlciB0aGUgYXRvbWljIG9wZXJhdGlvbiBh
bmQgc28gY29uZmlybQotCQkgKiB0aGF0IHRoaXMgcmVxdWVzdCBpcyB0aGUgb25lIGN1cnJlbnRs
eSBiZWluZyB0cmFja2VkLgotCQkgKgotCQkgKiBUaGUgY29ycmVzcG9uZGluZyB3cml0ZSBiYXJy
aWVyIGlzIHBhcnQgb2YKLQkJICogcmN1X2Fzc2lnbl9wb2ludGVyKCkuCi0JCSAqLwotCQlpZiAo
IXJlcXVlc3QgfHwgcmVxdWVzdCA9PSByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0
KSkKLQkJCXJldHVybiByY3VfcG9pbnRlcl9oYW5kb2ZmKHJlcXVlc3QpOwotCi0JCWk5MTVfcmVx
dWVzdF9wdXQocmVxdWVzdCk7Ci0JfSB3aGlsZSAoMSk7Ci19Ci0KK2ludCBfX211c3RfY2hlY2sK
K2k5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwK
KwkJICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwogLyoqCi0gKiBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X2dldF91bmxvY2tlZCAtIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJl
cXVlc3QKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2dldCAtIHJldHVybiBhIHJlZmVyZW5jZSB0byB0
aGUgYWN0aXZlIGZlbmNlCiAgKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCiAgKgotICog
aTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQoKSByZXR1cm5zIGEgcmVmZXJlbmNlIHRv
IHRoZSBhY3RpdmUgcmVxdWVzdCwKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgpIHJldHVybnMg
YSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSBmZW5jZSwKICAqIG9yIE5VTEwgaWYgdGhlIGFjdGl2
ZSB0cmFja2VyIGlzIGlkbGUuIFRoZSByZWZlcmVuY2UgaXMgb2J0YWluZWQgdW5kZXIgUkNVLAog
ICogc28gbm8gbG9ja2luZyBpcyByZXF1aXJlZCBieSB0aGUgY2FsbGVyLgogICoKLSAqIFRoZSBy
ZWZlcmVuY2Ugc2hvdWxkIGJlIGZyZWVkIHdpdGggaTkxNV9yZXF1ZXN0X3B1dCgpLgorICogVGhl
IHJlZmVyZW5jZSBzaG91bGQgYmUgZnJlZWQgd2l0aCBkbWFfZmVuY2VfcHV0KCkuCiAgKi8KLXN0
YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2dl
dF91bmxvY2tlZChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQorc3Rh
dGljIGlubGluZSBzdHJ1Y3QgZG1hX2ZlbmNlICoKK2k5MTVfYWN0aXZlX2ZlbmNlX2dldChzdHJ1
Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkKIHsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
ZXF1ZXN0OworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCiAJcmN1X3JlYWRfbG9jaygpOwot
CXJlcXVlc3QgPSBfX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3JjdShhY3RpdmUpOworCWZlbmNl
ID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmYWN0aXZlLT5mZW5jZSk7CiAJcmN1X3JlYWRfdW5s
b2NrKCk7CiAKLQlyZXR1cm4gcmVxdWVzdDsKKwlyZXR1cm4gZmVuY2U7CiB9CiAKIC8qKgotICog
aTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCAtIHJlcG9ydCB3aGV0aGVyIHRoZSBhY3RpdmUgdHJh
Y2tlciBpcyBhc3NpZ25lZAorICogaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQgLSByZXBvcnQgd2hl
dGhlciB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgYXNzaWduZWQKICAqIEBhY3RpdmUgLSB0aGUgYWN0
aXZlIHRyYWNrZXIKICAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCkgcmV0dXJucyB0
cnVlIGlmIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBjdXJyZW50bHkKLSAqIGFzc2lnbmVkIHRvIGEg
cmVxdWVzdC4gRHVlIHRvIHRoZSBsYXp5IHJldGlyaW5nLCB0aGF0IHJlcXVlc3QgbWF5IGJlIGlk
bGUKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2lzc2V0KCkgcmV0dXJucyB0cnVlIGlmIHRoZSBhY3Rp
dmUgdHJhY2tlciBpcyBjdXJyZW50bHkKKyAqIGFzc2lnbmVkIHRvIGEgZmVuY2UuIER1ZSB0byB0
aGUgbGF6eSByZXRpcmluZywgdGhhdCBmZW5jZSBtYXkgYmUgaWRsZQogICogYW5kIHRoaXMgbWF5
IHJlcG9ydCBzdGFsZSBpbmZvcm1hdGlvbi4KICAqLwogc3RhdGljIGlubGluZSBib29sCi1pOTE1
X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICph
Y3RpdmUpCitpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgKmFjdGl2ZSkKIHsKLQlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2ZS0+cmVx
dWVzdCk7CisJcmV0dXJuIHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPmZlbmNlKTsKIH0KIAot
LyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSAtIHdhaXRzIHVudGlsIHRoZSByZXF1
ZXN0IGlzIHJldGlyZWQKLSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHJlcXVlc3Qgb24gd2hpY2gg
dG8gd2FpdAotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCkgd2FpdHMgdW50aWwg
dGhlIHJlcXVlc3QgaXMgY29tcGxldGVkLAotICogYW5kIHRoZW4gZW5zdXJlcyB0aGF0IGF0IGxl
YXN0IHRoZSByZXRpcmVtZW50IGhhbmRsZXIgZm9yIHRoaXMKLSAqIEBhY3RpdmUgdHJhY2tlciBp
cyBjYWxsZWQgYmVmb3JlIHJldHVybmluZy4gSWYgdGhlIEBhY3RpdmUKLSAqIHRyYWNrZXIgaXMg
aWRsZSwgdGhlIGZ1bmN0aW9uIHJldHVybnMgaW1tZWRpYXRlbHkuCi0gKi8KLXN0YXRpYyBpbmxp
bmUgaW50IF9fbXVzdF9jaGVjawotaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5
MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSAgIHN0cnVjdCBtdXRleCAqbXV0ZXgpCitz
dGF0aWMgaW5saW5lIHZvaWQKK2k5MTVfYWN0aXZlX2ZlbmNlX2NiKHN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpyZXF1ZXN0OwotCWxvbmcgcmV0OwotCi0JcmVxdWVzdCA9IGk5MTVfYWN0aXZlX3JlcXVlc3Rf
cmF3KGFjdGl2ZSwgbXV0ZXgpOwotCWlmICghcmVxdWVzdCkKLQkJcmV0dXJuIDA7Ci0KLQlyZXQg
PSBpOTE1X3JlcXVlc3Rfd2FpdChyZXF1ZXN0LAotCQkJCUk5MTVfV0FJVF9JTlRFUlJVUFRJQkxF
LAotCQkJCU1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQlpZiAocmV0IDwgMCkKLQkJcmV0dXJuIHJl
dDsKLQotCWxpc3RfZGVsX2luaXQoJmFjdGl2ZS0+bGluayk7Ci0JUkNVX0lOSVRfUE9JTlRFUihh
Y3RpdmUtPnJlcXVlc3QsIE5VTEwpOwotCi0JYWN0aXZlLT5yZXRpcmUoYWN0aXZlLCByZXF1ZXN0
KTsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSA9CisJCWNvbnRhaW5lcl9vZihj
YiwgdHlwZW9mKCphY3RpdmUpLCBjYik7CiAKLQlyZXR1cm4gMDsKKwlSQ1VfSU5JVF9QT0lOVEVS
KGFjdGl2ZS0+ZmVuY2UsIE5VTEwpOwogfQogCiAvKgpAQCAtMzUwLDMxICsxNTUsMjkgQEAgaTkx
NV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZSwKICAqIHN5bmNocm9uaXNhdGlvbi4KICAqLwogCi12b2lkIF9faTkxNV9hY3RpdmVfaW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
LAordm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQlp
bnQgKCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKIAkJCXZvaWQgKCpyZXRpcmUp
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKIAkJCXN0cnVjdCBsb2NrX2NsYXNzX2tleSAqa2V5
KTsKLSNkZWZpbmUgaTkxNV9hY3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwgcmV0aXJlKSBk
byB7CQlcCisjZGVmaW5lIGk5MTVfYWN0aXZlX2luaXQocmVmLCBhY3RpdmUsIHJldGlyZSkgZG8g
ewkJXAogCXN0YXRpYyBzdHJ1Y3QgbG9ja19jbGFzc19rZXkgX19rZXk7CQkJCVwKIAkJCQkJCQkJ
CVwKLQlfX2k5MTVfYWN0aXZlX2luaXQoaTkxNSwgcmVmLCBhY3RpdmUsIHJldGlyZSwgJl9fa2V5
KTsJCVwKKwlfX2k5MTVfYWN0aXZlX2luaXQocmVmLCBhY3RpdmUsIHJldGlyZSwgJl9fa2V5KTsJ
CVwKIH0gd2hpbGUgKDApCiAKIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYsCiAJCSAgICB1NjQgdGltZWxpbmUsCi0JCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSk7CisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CiAKIGludCBpOTE1X2FjdGl2ZV93
YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9h
Y3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJCQkgICAgICBzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZik7Ci1pbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLAotCQkJCSAgICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICph
Y3RpdmUpOworaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfZmVuY2Uoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEsCisJCQkJICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKTsK
IAogaW50IGk5MTVfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwogdm9p
ZCBpOTE1X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKLXZvaWQgX19p
OTE1X2FjdGl2ZV9yZWxlYXNlX25lc3RlZChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgaW50IHN1
YmNsYXNzKTsKIAogc3RhdGljIGlubGluZSBib29sCiBpOTE1X2FjdGl2ZV9pc19pZGxlKGNvbnN0
IHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZl
X3R5cGVzLmgKaW5kZXggYTNhNWVjM2U0MTYzLi40MmFhYTI5MjEwYTggMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApAQCAtOCw2ICs4LDcgQEAKICNkZWZpbmUgX0k5
MTVfQUNUSVZFX1RZUEVTX0hfCiAKICNpbmNsdWRlIDxsaW51eC9hdG9taWMuaD4KKyNpbmNsdWRl
IDxsaW51eC9kbWEtZmVuY2UuaD4KICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgogI2luY2x1ZGUg
PGxpbnV4L211dGV4Lmg+CiAjaW5jbHVkZSA8bGludXgvcmJ0cmVlLmg+CkBAIC0xNiwxNyArMTcs
OSBAQAogCiAjaW5jbHVkZSAiaTkxNV91dGlscy5oIgogCi1zdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZTsKLXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0Owotc3RydWN0IGk5MTVfcmVxdWVzdDsKLQot
dHlwZWRlZiB2b2lkICgqaTkxNV9hY3RpdmVfcmV0aXJlX2ZuKShzdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCAqLAotCQkJCSAgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKik7Ci0KLXN0cnVjdCBp
OTE1X2FjdGl2ZV9yZXF1ZXN0IHsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0IF9fcmN1ICpyZXF1ZXN0
OwotCXN0cnVjdCBsaXN0X2hlYWQgbGluazsKLQlpOTE1X2FjdGl2ZV9yZXRpcmVfZm4gcmV0aXJl
Oworc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlIHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlIF9fcmN1ICpm
ZW5jZTsKKwlzdHJ1Y3QgZG1hX2ZlbmNlX2NiIGNiOwogfTsKIAogc3RydWN0IGFjdGl2ZV9ub2Rl
OwpAQCAtMzcsOCArMzAsNiBAQCBzdHJ1Y3QgYWN0aXZlX25vZGU7CiAjZGVmaW5lIGk5MTVfYWN0
aXZlX21heV9zbGVlcChmbikgcHRyX3BhY2tfYml0cygmKGZuKSwgSTkxNV9BQ1RJVkVfTUFZX1NM
RUVQLCAyKQogCiBzdHJ1Y3QgaTkxNV9hY3RpdmUgewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1OwotCiAJc3RydWN0IGFjdGl2ZV9ub2RlICpjYWNoZTsKIAlzdHJ1Y3QgcmJfcm9vdCB0
cmVlOwogCXN0cnVjdCBtdXRleCBtdXRleDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDhm
Nzk2ODFmODk3NS4uYzkwMmVmODVhM2ZjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTk1
MywyOCArOTUzLDM4IEBAIHdhaXRfZm9yX3RpbWVsaW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAogCW11dGV4X2xvY2soJmd0LT5tdXRleCk7CiAJbGlzdF9mb3JfZWFjaF9lbnRy
eSh0bCwgJmd0LT5hY3RpdmVfbGlzdCwgbGluaykgewotCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQkJcnEgPSBpOTE1X2FjdGl2ZV9yZXF1
ZXN0X2dldF91bmxvY2tlZCgmdGwtPmxhc3RfcmVxdWVzdCk7Ci0JCWlmICghcnEpCisJCWZlbmNl
ID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJaWYgKCFmZW5j
ZSkKIAkJCWNvbnRpbnVlOwogCiAJCW11dGV4X3VubG9jaygmZ3QtPm11dGV4KTsKIAotCQkvKgot
CQkgKiAiUmFjZS10by1pZGxlIi4KLQkJICoKLQkJICogU3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwg
Y29udGV4dCBpcyBvZnRlbiB1c2VkIGEgc3luY2hyb25vdXMKLQkJICogc3RlcCBwcmlvciB0byBp
ZGxpbmcsIGUuZy4gaW4gc3VzcGVuZCBmb3IgZmx1c2hpbmcgYWxsCi0JCSAqIGN1cnJlbnQgb3Bl
cmF0aW9ucyB0byBtZW1vcnkgYmVmb3JlIHNsZWVwaW5nLiBUaGVzZSB3ZQotCQkgKiB3YW50IHRv
IGNvbXBsZXRlIGFzIHF1aWNrbHkgYXMgcG9zc2libGUgdG8gYXZvaWQgcHJvbG9uZ2VkCi0JCSAq
IHN0YWxscywgc28gYWxsb3cgdGhlIGdwdSB0byBib29zdCB0byBtYXhpbXVtIGNsb2Nrcy4KLQkJ
ICovCi0JCWlmIChmbGFncyAmIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCkKLQkJCWdlbjZfcnBz
X2Jvb3N0KHJxKTsKKwkJaWYgKCFkbWFfZmVuY2VfaXNfaTkxNShmZW5jZSkpIHsKKwkJCXRpbWVv
dXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLAorCQkJCQkJCSBmbGFncyAmIEk5MTVf
V0FJVF9JTlRFUlJVUFRJQkxFLAorCQkJCQkJCSB0aW1lb3V0KTsKKwkJfSBlbHNlIHsKKwkJCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxID0gdG9fcmVxdWVzdChmZW5jZSk7CisKKwkJCS8qCisJCQkg
KiAiUmFjZS10by1pZGxlIi4KKwkJCSAqCisJCQkgKiBTd2l0Y2hpbmcgdG8gdGhlIGtlcm5lbCBj
b250ZXh0IGlzIG9mdGVuIHVzZWQgYXMKKwkJCSAqIGEgc3luY2hyb25vdXMgc3RlcCBwcmlvciB0
byBpZGxpbmcsIGUuZy4gaW4gc3VzcGVuZAorCQkJICogZm9yIGZsdXNoaW5nIGFsbCBjdXJyZW50
IG9wZXJhdGlvbnMgdG8gbWVtb3J5IGJlZm9yZQorCQkJICogc2xlZXBpbmcuIFRoZXNlIHdlIHdh
bnQgdG8gY29tcGxldGUgYXMgcXVpY2tseSBhcworCQkJICogcG9zc2libGUgdG8gYXZvaWQgcHJv
bG9uZ2VkIHN0YWxscywgc28gYWxsb3cgdGhlIGdwdQorCQkJICogdG8gYm9vc3QgdG8gbWF4aW11
bSBjbG9ja3MuCisJCQkgKi8KKwkJCWlmIChmbGFncyAmIEk5MTVfV0FJVF9GT1JfSURMRV9CT09T
VCkKKwkJCQlnZW42X3Jwc19ib29zdChycSk7CisKKwkJCXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rf
d2FpdChycSwgZmxhZ3MsIHRpbWVvdXQpOworCQl9CiAKLQkJdGltZW91dCA9IGk5MTVfcmVxdWVz
dF93YWl0KHJxLCBmbGFncywgdGltZW91dCk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlk
bWFfZmVuY2VfcHV0KGZlbmNlKTsKIAkJaWYgKHRpbWVvdXQgPCAwKQogCQkJcmV0dXJuIHRpbWVv
dXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKaW5kZXggOTRlZGY0NmI1MjI5Li5k
ODlmMTY4NjE2NzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0yMDczLDcg
KzIwNzMsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpwZF92bWFfY3JlYXRlKHN0cnVjdCBn
ZW42X3BwZ3R0ICpwcGd0dCwgaW50IHNpemUpCiAJaWYgKCF2bWEpCiAJCXJldHVybiBFUlJfUFRS
KC1FTk9NRU0pOwogCi0JaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmdm1hLT5hY3RpdmUsIE5VTEws
IE5VTEwpOworCWk5MTVfYWN0aXZlX2luaXQoJnZtYS0+YWN0aXZlLCBOVUxMLCBOVUxMKTsKIAog
CXZtYS0+dm0gPSAmZ2d0dC0+dm07CiAJdm1hLT5vcHMgPSAmcGRfdm1hX29wczsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggMjdiOTg5M2ZhOGUzLi5hMjU1OWExZTVhZGEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0yMjksOSArMjI5LDggQEAgc3RhdGlj
IHZvaWQgZnJlZV9jYXB0dXJlX2xpc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKIAog
c3RhdGljIGJvb2wgaTkxNV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
IHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLCAqbmV4dDsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZycS0+dGltZWxpbmUtPm11dGV4KTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hl
bGQoJnJxLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoIWk5MTVfcmVxdWVzdF9jb21w
bGV0ZWQocnEpKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTI0NSwzNSArMjQ0LDYgQEAgc3RhdGlj
IGJvb2wgaTkxNV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogCWFk
dmFuY2VfcmluZyhycSk7CiAKLQkvKgotCSAqIFdhbGsgdGhyb3VnaCB0aGUgYWN0aXZlIGxpc3Qs
IGNhbGxpbmcgcmV0aXJlIG9uIGVhY2guIFRoaXMgYWxsb3dzCi0JICogb2JqZWN0cyB0byB0cmFj
ayB0aGVpciBHUFUgYWN0aXZpdHkgYW5kIG1hcmsgdGhlbXNlbHZlcyBhcyBpZGxlCi0JICogd2hl
biB0aGVpciAqbGFzdCogYWN0aXZlIHJlcXVlc3QgaXMgY29tcGxldGVkICh1cGRhdGluZyBzdGF0
ZQotCSAqIHRyYWNraW5nIGxpc3RzIGZvciBldmljdGlvbiwgYWN0aXZlIHJlZmVyZW5jZXMgZm9y
IEdFTSwgZXRjKS4KLQkgKgotCSAqIEFzIHRoZSAtPnJldGlyZSgpIG1heSBmcmVlIHRoZSBub2Rl
LCB3ZSBkZWNvdXBsZSBpdCBmaXJzdCBhbmQKLQkgKiBwYXNzIGFsb25nIHRoZSBhdXhpbGlhcnkg
aW5mb3JtYXRpb24gKHRvIGF2b2lkIGRlcmVmZXJlbmNpbmcKLQkgKiB0aGUgbm9kZSBhZnRlciB0
aGUgY2FsbGJhY2spLgotCSAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShhY3RpdmUsIG5l
eHQsICZycS0+YWN0aXZlX2xpc3QsIGxpbmspIHsKLQkJLyoKLQkJICogSW4gbWljcm9iZW5jaG1h
cmtzIG9yIGZvY3VzaW5nIHVwb24gdGltZSBpbnNpZGUgdGhlIGtlcm5lbCwKLQkJICogd2UgbWF5
IHNwZW5kIGFuIGlub3JkaW5hdGUgYW1vdW50IG9mIHRpbWUgc2ltcGx5IGhhbmRsaW5nCi0JCSAq
IHRoZSByZXRpcmVtZW50IG9mIHJlcXVlc3RzIGFuZCBwcm9jZXNzaW5nIHRoZWlyIGNhbGxiYWNr
cy4KLQkJICogT2Ygd2hpY2gsIHRoaXMgbG9vcCBpdHNlbGYgaXMgcGFydGljdWxhcmx5IGhvdCBk
dWUgdG8gdGhlCi0JCSAqIGNhY2hlIG1pc3NlcyB3aGVuIGp1bXBpbmcgYXJvdW5kIHRoZSBsaXN0
IG9mCi0JCSAqIGk5MTVfYWN0aXZlX3JlcXVlc3QuICBTbyB3ZSB0cnkgdG8ga2VlcCB0aGlzIGxv
b3AgYXMKLQkJICogc3RyZWFtbGluZWQgYXMgcG9zc2libGUgYW5kIGFsc28gcHJlZmV0Y2ggdGhl
IG5leHQKLQkJICogaTkxNV9hY3RpdmVfcmVxdWVzdCB0byB0cnkgYW5kIGhpZGUgdGhlIGxpa2Vs
eSBjYWNoZSBtaXNzLgotCQkgKi8KLQkJcHJlZmV0Y2h3KG5leHQpOwotCi0JCUlOSVRfTElTVF9I
RUFEKCZhY3RpdmUtPmxpbmspOwotCQlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+cmVxdWVzdCwg
TlVMTCk7Ci0KLQkJYWN0aXZlLT5yZXRpcmUoYWN0aXZlLCBycSk7Ci0JfQotCiAJbG9jYWxfaXJx
X2Rpc2FibGUoKTsKIAogCS8qCkBAIC0zMjgsMTEgKzI5OCw5IEBAIHZvaWQgaTkxNV9yZXF1ZXN0
X3JldGlyZV91cHRvKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQkgIHJxLT5mZW5jZS5jb250
ZXh0LCBycS0+ZmVuY2Uuc2Vxbm8sCiAJCSAgaHdzcF9zZXFubyhycSkpOwogCi0JbG9ja2RlcF9h
c3NlcnRfaGVsZCgmcnEtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJnJxLT50aW1lbGluZS0+bXV0ZXgpOwogCUdFTV9CVUdfT04oIWk5MTVfcmVxdWVzdF9j
b21wbGV0ZWQocnEpKTsKLQotCWlmIChsaXN0X2VtcHR5KCZycS0+cmluZ19saW5rKSkKLQkJcmV0
dXJuOworCUdFTV9CVUdfT04obGlzdF9lbXB0eSgmcnEtPnJpbmdfbGluaykpOwogCiAJZG8gewog
CQl0bXAgPSBsaXN0X2ZpcnN0X2VudHJ5KCZyaW5nLT5yZXF1ZXN0X2xpc3QsCkBAIC01NjcsNiAr
NTM1LDcgQEAgc3RhdGljIHZvaWQgcmluZ19yZXRpcmVfcmVxdWVzdHMoc3RydWN0IGludGVsX3Jp
bmcgKnJpbmcpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsICpybjsKIAorCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnJpbmctPnRpbWVsaW5lLT5tdXRleCk7CiAJbGlzdF9mb3JfZWFjaF9lbnRy
eV9zYWZlKHJxLCBybiwgJnJpbmctPnJlcXVlc3RfbGlzdCwgcmluZ19saW5rKQogCQlpZiAoIWk5
MTVfcmVxdWVzdF9yZXRpcmUocnEpKQogCQkJYnJlYWs7CkBAIC02ODcsNyArNjU2LDYgQEAgX19p
OTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgZ2ZwX3QgZ2ZwKQog
CXJxLT53YWl0Ym9vc3QgPSBmYWxzZTsKIAlycS0+ZXhlY3V0aW9uX21hc2sgPSBBTExfRU5HSU5F
UzsKIAotCUlOSVRfTElTVF9IRUFEKCZycS0+YWN0aXZlX2xpc3QpOwogCUlOSVRfTElTVF9IRUFE
KCZycS0+ZXhlY3V0ZV9jYik7CiAKIAkvKgpAQCAtNzI2LDcgKzY5NCw2IEBAIF9faTkxNV9yZXF1
ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIGdmcF90IGdmcCkKIAljZS0+cmlu
Zy0+ZW1pdCA9IHJxLT5oZWFkOwogCiAJLyogTWFrZSBzdXJlIHdlIGRpZG4ndCBhZGQgb3Vyc2Vs
dmVzIHRvIGV4dGVybmFsIHN0YXRlIGJlZm9yZSBmcmVlaW5nICovCi0JR0VNX0JVR19PTighbGlz
dF9lbXB0eSgmcnEtPmFjdGl2ZV9saXN0KSk7CiAJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEt
PnNjaGVkLnNpZ25hbGVyc19saXN0KSk7CiAJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEtPnNj
aGVkLndhaXRlcnNfbGlzdCkpOwogCkBAIC0xMTE1LDcgKzEwODIsOCBAQCBfX2k5MTVfcmVxdWVz
dF9hZGRfdG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICogcHJlY2x1ZGVz
IG9wdGltaXNpbmcgdG8gdXNlIHNlbWFwaG9yZXMgc2VyaWFsaXNhdGlvbiBvZiBhIHNpbmdsZQog
CSAqIHRpbWVsaW5lIGFjcm9zcyBlbmdpbmVzLgogCSAqLwotCXByZXYgPSByY3VfZGVyZWZlcmVu
Y2VfcHJvdGVjdGVkKHRpbWVsaW5lLT5sYXN0X3JlcXVlc3QucmVxdWVzdCwgMSk7CisJcHJldiA9
IHRvX3JlcXVlc3QoX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVl
c3QsCisJCQkJCQkgICZycS0+ZmVuY2UpKTsKIAlpZiAocHJldiAmJiAhaTkxNV9yZXF1ZXN0X2Nv
bXBsZXRlZChwcmV2KSkgewogCQlpZiAoaXNfcG93ZXJfb2ZfMihwcmV2LT5lbmdpbmUtPm1hc2sg
fCBycS0+ZW5naW5lLT5tYXNrKSkKIAkJCWk5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVuY2UoJnJx
LT5zdWJtaXQsCkBAIC0xMTQwLDcgKzExMDgsNiBAQCBfX2k5MTVfcmVxdWVzdF9hZGRfdG9fdGlt
ZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICogdXMsIHRoZSB0aW1lbGluZSB3aWxs
IGhvbGQgaXRzIHNlcW5vIHdoaWNoIGlzIGxhdGVyIHRoYW4gb3Vycy4KIAkgKi8KIAlHRU1fQlVH
X09OKHRpbWVsaW5lLT5zZXFubyAhPSBycS0+ZmVuY2Uuc2Vxbm8pOwotCV9faTkxNV9hY3RpdmVf
cmVxdWVzdF9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsIHJxKTsKIAogCXJldHVybiBwcmV2
OwogfQpAQCAtMTQ5Miw3ICsxNDU5LDExIEBAIGJvb2wgaTkxNV9yZXRpcmVfcmVxdWVzdHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHJp
bmcsIHRtcCwKIAkJCQkgJmk5MTUtPmd0LmFjdGl2ZV9yaW5ncywgYWN0aXZlX2xpbmspIHsKIAkJ
aW50ZWxfcmluZ19nZXQocmluZyk7IC8qIGxhc3QgcnEgaG9sZHMgcmVmZXJlbmNlISAqLworCQlt
dXRleF9sb2NrKCZyaW5nLT50aW1lbGluZS0+bXV0ZXgpOworCiAJCXJpbmdfcmV0aXJlX3JlcXVl
c3RzKHJpbmcpOworCisJCW11dGV4X3VubG9jaygmcmluZy0+dGltZWxpbmUtPm11dGV4KTsKIAkJ
aW50ZWxfcmluZ19wdXQocmluZyk7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5o
CmluZGV4IGJlYmMxZTliNGE1ZS4uODI3N2NmZjBkZjcwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlcXVlc3QuaApAQCAtMjExLDcgKzIxMSw2IEBAIHN0cnVjdCBpOTE1X3JlcXVlc3QgewogCSAq
IG9uIHRoZSBhY3RpdmVfbGlzdCAob2YgdGhlaXIgZmluYWwgcmVxdWVzdCkuCiAJICovCiAJc3Ry
dWN0IGk5MTVfY2FwdHVyZV9saXN0ICpjYXB0dXJlX2xpc3Q7Ci0Jc3RydWN0IGxpc3RfaGVhZCBh
Y3RpdmVfbGlzdDsKIAogCS8qKiBUaW1lIGF0IHdoaWNoIHRoaXMgcmVxdWVzdCB3YXMgZW1pdHRl
ZCwgaW4gamlmZmllcy4gKi8KIAl1bnNpZ25lZCBsb25nIGVtaXR0ZWRfamlmZmllczsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYwppbmRleCBkYzJjNjkxMzE5OGIuLmVlYmMyNGZmN2Ey
MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYwpAQCAtMTgwLDggKzE4MCw3IEBA
IGNhY2hlbGluZV9hbGxvYyhzdHJ1Y3QgaTkxNV90aW1lbGluZV9od3NwICpod3NwLCB1bnNpZ25l
ZCBpbnQgY2FjaGVsaW5lKQogCWNsLT5od3NwID0gaHdzcDsKIAljbC0+dmFkZHIgPSBwYWdlX3Bh
Y2tfYml0cyh2YWRkciwgY2FjaGVsaW5lKTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaHdzcF90b19p
OTE1KGh3c3ApLCAmY2wtPmFjdGl2ZSwKLQkJCSBfX2NhY2hlbGluZV9hY3RpdmUsIF9fY2FjaGVs
aW5lX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgmY2wtPmFjdGl2ZSwgX19jYWNoZWxpbmVf
YWN0aXZlLCBfX2NhY2hlbGluZV9yZXRpcmUpOwogCiAJcmV0dXJuIGNsOwogfQpAQCAtMjY0LDcg
KzI2Myw3IEBAIGludCBpOTE1X3RpbWVsaW5lX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAKIAltdXRleF9pbml0KCZ0aW1lbGluZS0+bXV0ZXgpOwogCi0JSU5JVF9BQ1RJVkVf
UkVRVUVTVCgmdGltZWxpbmUtPmxhc3RfcmVxdWVzdCk7CisJSU5JVF9BQ1RJVkVfRkVOQ0UoJnRp
bWVsaW5lLT5sYXN0X3JlcXVlc3QpOwogCUlOSVRfTElTVF9IRUFEKCZ0aW1lbGluZS0+cmVxdWVz
dHMpOwogCiAJaTkxNV9zeW5jbWFwX2luaXQoJnRpbWVsaW5lLT5zeW5jKTsKQEAgLTQ2NCw3ICs0
NjMsNyBAQCBfX2k5MTVfdGltZWxpbmVfZ2V0X3NlcW5vKHN0cnVjdCBpOTE1X3RpbWVsaW5lICp0
bCwKIAkgKiBhbGwgd3JpdGVzIGludG8gdGhlIGNhY2hlbGluZSBmcm9tIHByZXZpb3VzIHJlcXVl
c3RzIGFyZSBjb21wbGV0ZS4KIAkgKi8KIAllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnRsLT5od3Nw
X2NhY2hlbGluZS0+YWN0aXZlLAotCQkJICAgICAgdGwtPmZlbmNlX2NvbnRleHQsIHJxKTsKKwkJ
CSAgICAgIHRsLT5mZW5jZV9jb250ZXh0LCAmcnEtPmZlbmNlKTsKIAlpZiAoZXJyKQogCQlnb3Rv
IGVycl9jYWNoZWxpbmU7CiAKQEAgLTUxNSw3ICs1MTQsNyBAQCBpbnQgaTkxNV90aW1lbGluZV9n
ZXRfc2Vxbm8oc3RydWN0IGk5MTVfdGltZWxpbmUgKnRsLAogc3RhdGljIGludCBjYWNoZWxpbmVf
cmVmKHN0cnVjdCBpOTE1X3RpbWVsaW5lX2NhY2hlbGluZSAqY2wsCiAJCQkgc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfYWN0aXZlX3JlZigmY2wtPmFjdGl2ZSwgcnEt
PmZlbmNlLmNvbnRleHQsIHJxKTsKKwlyZXR1cm4gaTkxNV9hY3RpdmVfcmVmKCZjbC0+YWN0aXZl
LCBycS0+ZmVuY2UuY29udGV4dCwgJnJxLT5mZW5jZSk7CiB9CiAKIGludCBpOTE1X3RpbWVsaW5l
X3JlYWRfaHdzcChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpmcm9tLApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV90aW1lbGluZV90eXBlcy5oCmluZGV4IGZjZTVjYjRmMTA5MC4uNWFmNmQxODVkNzBj
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lX3R5cGVzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZV90eXBlcy5oCkBAIC00NSw3
ICs0NSw3IEBAIHN0cnVjdCBpOTE1X3RpbWVsaW5lIHsKIAkgKiB0aGUgcmVxdWVzdCB1c2luZyBp
OTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF9yZXF1ZXN0X3JjdSgpLCBvciBob2xkIHRoZQogCSAqIHN0
cnVjdF9tdXRleC4KIAkgKi8KLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCBsYXN0X3JlcXVl
c3Q7CisJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlIGxhc3RfcmVxdWVzdDsKIAogCS8qKgogCSAq
IFdlIHRyYWNrIHRoZSBtb3N0IHJlY2VudCBzZXFubyB0aGF0IHdlIHdhaXQgb24gaW4gZXZlcnkg
Y29udGV4dCBzbwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggYTBlNDUyMzViNTgxLi44ODcz
M2RhZmRiZGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMTE2LDggKzExNiw3IEBAIHZt
YV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl2bWEtPnNpemUgPSBv
YmotPmJhc2Uuc2l6ZTsKIAl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gSTkxNV9HVFRfTUlOX0FM
SUdOTUVOVDsKIAotCWk5MTVfYWN0aXZlX2luaXQodm0tPmk5MTUsICZ2bWEtPmFjdGl2ZSwKLQkJ
CSBfX2k5MTVfdm1hX2FjdGl2ZSwgX19pOTE1X3ZtYV9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2lu
aXQoJnZtYS0+YWN0aXZlLCBfX2k5MTVfdm1hX2FjdGl2ZSwgX19pOTE1X3ZtYV9yZXRpcmUpOwog
CiAJSU5JVF9MSVNUX0hFQUQoJnZtYS0+Y2xvc2VkX2xpbmspOwogCkBAIC05MTEsNyArOTEwLDcg
QEAgaW50IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCSAq
IGFkZCB0aGUgYWN0aXZlIHJlZmVyZW5jZSBmaXJzdCBhbmQgcXVldWUgZm9yIGl0IHRvIGJlIGRy
b3BwZWQKIAkgKiAqbGFzdCouCiAJICovCi0JZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFj
dGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJxKTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnZt
YS0+YWN0aXZlLCBycS0+ZmVuY2UuY29udGV4dCwgJnJxLT5mZW5jZSk7CiAJaWYgKHVubGlrZWx5
KGVycikpCiAJCXJldHVybiBlcnI7CiAKQEAgLTkyMiw3ICs5MjEsNyBAQCBpbnQgaTkxNV92bWFf
bW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCWlmIChpbnRlbF9mcm9udGJ1
ZmZlcl9pbnZhbGlkYXRlKG9iai0+ZnJvbnRidWZmZXIsIE9SSUdJTl9DUykpCiAJCQlpOTE1X2Fj
dGl2ZV9yZWYoJm9iai0+ZnJvbnRidWZmZXItPndyaXRlLAogCQkJCQlycS0+ZmVuY2UuY29udGV4
dCwKLQkJCQkJcnEpOworCQkJCQkmcnEtPmZlbmNlKTsKIAogCQlvYmotPnJlYWRfZG9tYWlucyA9
IDA7CiAJfQpAQCAtOTQxLDMyICs5NDAsMTEgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCi0JLyoKLQkgKiBGaXJzdCB3YWl0IHVwb24gYW55IGFjdGl2aXR5
IGFzIHJldGlyaW5nIHRoZSByZXF1ZXN0IG1heQotCSAqIGhhdmUgc2lkZS1lZmZlY3RzIHN1Y2gg
YXMgdW5waW5uaW5nIG9yIGV2ZW4gdW5iaW5kaW5nIHRoaXMgdm1hLgotCSAqLwotCW1pZ2h0X3Ns
ZWVwKCk7Ci0JaWYgKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKSB7Ci0JCS8qCi0JCSAqIFdoZW4g
YSBjbG9zZWQgVk1BIGlzIHJldGlyZWQsIGl0IGlzIHVuYm91bmQgLSBlZWsuCi0JCSAqIEluIG9y
ZGVyIHRvIHByZXZlbnQgaXQgZnJvbSBiZWluZyByZWN1cnNpdmVseSBjbG9zZWQsCi0JCSAqIHRh
a2UgYSBwaW4gb24gdGhlIHZtYSBzbyB0aGF0IHRoZSBzZWNvbmQgdW5iaW5kIGlzCi0JCSAqIGFi
b3J0ZWQuCi0JCSAqCi0JCSAqIEV2ZW4gbW9yZSBzY2FyeSBpcyB0aGF0IHRoZSByZXRpcmUgY2Fs
bGJhY2sgbWF5IGZyZWUKLQkJICogdGhlIG9iamVjdCAobGFzdCBhY3RpdmUgdm1hKS4gVG8gcHJl
dmVudCB0aGUgZXhwbG9zaW9uCi0JCSAqIHdlIGRlZmVyIHRoZSBhY3R1YWwgb2JqZWN0IGZyZWUg
dG8gYSB3b3JrZXIgdGhhdCBjYW4KLQkJICogb25seSBwcm9jZWVkIG9uY2UgaXQgYWNxdWlyZXMg
dGhlIHN0cnVjdF9tdXRleCAod2hpY2gKLQkJICogd2UgY3VycmVudGx5IGhvbGQsIHRoZXJlZm9y
ZSBpdCBjYW5ub3QgZnJlZSB0aGlzIG9iamVjdAotCQkgKiBiZWZvcmUgd2UgYXJlIGZpbmlzaGVk
KS4KLQkJICovCi0JCV9faTkxNV92bWFfcGluKHZtYSk7Ci0JCXJldCA9IGk5MTVfYWN0aXZlX3dh
aXQoJnZtYS0+YWN0aXZlKTsKLQkJX19pOTE1X3ZtYV91bnBpbih2bWEpOwotCQlpZiAocmV0KQot
CQkJcmV0dXJuIHJldDsKLQl9CisJcmV0ID0gaTkxNV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUp
OworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKKwlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2Fj
dGl2ZSh2bWEpKTsKIAlpZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpIHsKIAkJdm1hX3ByaW50
X2FsbG9jYXRvcih2bWEsICJpcyBwaW5uZWQiKTsKIAkJcmV0dXJuIC1FQlVTWTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zyb250YnVmZmVyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9mcm9udGJ1ZmZlci5jCmluZGV4IDNmYWVlOGU3NThiMC4uODBjYWNi
YTFmYzgwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mcm9udGJ1ZmZl
ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zyb250YnVmZmVyLmMKQEAgLTI0
Nyw3ICsyNDcsNyBAQCBpbnRlbF9mcm9udGJ1ZmZlcl9nZXQoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaikKIAlmcm9udC0+b2JqID0gb2JqOwogCWtyZWZfaW5pdCgmZnJvbnQtPnJlZik7
CiAJYXRvbWljX3NldCgmZnJvbnQtPmJpdHMsIDApOwotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwg
JmZyb250LT53cml0ZSwKKwlpOTE1X2FjdGl2ZV9pbml0KCZmcm9udC0+d3JpdGUsCiAJCQkgZnJv
bnRidWZmZXJfYWN0aXZlLAogCQkJIGk5MTVfYWN0aXZlX21heV9zbGVlcChmcm9udGJ1ZmZlcl9y
ZXRpcmUpKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zlcmxh
eS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jCmluZGV4IGYwNzQzYWY3
OWZjYi4uZDUwYTAxOTZiMTY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jCkBA
IC0yMzAsNyArMjMwLDggQEAgYWxsb2NfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3Zl
cmxheSwgdm9pZCAoKmZuKShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqKSkKIAlpZiAoSVNfRVJSKHJx
KSkKIAkJcmV0dXJuIHJxOwogCi0JZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZvdmVybGF5LT5sYXN0
X2ZsaXAsIHJxLT5mZW5jZS5jb250ZXh0LCBycSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZv
dmVybGF5LT5sYXN0X2ZsaXAsCisJCQkgICAgICBycS0+ZmVuY2UuY29udGV4dCwgJnJxLT5mZW5j
ZSk7CiAJaWYgKGVycikgewogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJcmV0dXJuIEVSUl9Q
VFIoZXJyKTsKQEAgLTEzNjYsOCArMTM2Nyw3IEBAIHZvaWQgaW50ZWxfb3ZlcmxheV9zZXR1cChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJb3ZlcmxheS0+Y29udHJhc3QgPSA3
NTsKIAlvdmVybGF5LT5zYXR1cmF0aW9uID0gMTQ2OwogCi0JaTkxNV9hY3RpdmVfaW5pdChkZXZf
cHJpdiwKLQkJCSAmb3ZlcmxheS0+bGFzdF9mbGlwLAorCWk5MTVfYWN0aXZlX2luaXQoJm92ZXJs
YXktPmxhc3RfZmxpcCwKIAkJCSBOVUxMLCBpbnRlbF9vdmVybGF5X2xhc3RfZmxpcF9yZXRpcmUp
OwogCiAJcmV0ID0gZ2V0X3JlZ2lzdGVycyhvdmVybGF5LCBPVkVSTEFZX05FRURTX1BIWVNJQ0FM
KGRldl9wcml2KSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2
ZS5jCmluZGV4IGI1Y2MwMDM1NTRlZi4uMGU4YmY4YmNlMTQ2IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwpAQCAtMzYsNyArMzYsNyBAQCBzdGF0aWMg
aW50IF9fbGl2ZV9hY3RpdmVfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
aWYgKCFzdWJtaXQpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JaTkxNV9hY3RpdmVfaW5pdChpOTE1
LCAmYWN0aXZlLT5iYXNlLCBOVUxMLCBfX2xpdmVfYWN0aXZlX3JldGlyZSk7CisJaTkxNV9hY3Rp
dmVfaW5pdCgmYWN0aXZlLT5iYXNlLCBOVUxMLCBfX2xpdmVfYWN0aXZlX3JldGlyZSk7CiAJYWN0
aXZlLT5yZXRpcmVkID0gZmFsc2U7CiAKIAllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZhY3Rp
dmUtPmJhc2UpOwpAQCAtNTcsNyArNTcsOCBAQCBzdGF0aWMgaW50IF9fbGl2ZV9hY3RpdmVfc2V0
dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQkgICAgICAgR0ZQX0tFUk5F
TCk7CiAJCWlmIChlcnIgPj0gMCkKIAkJCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmYWN0aXZlLT5i
YXNlLAotCQkJCQkgICAgICBycS0+ZmVuY2UuY29udGV4dCwgcnEpOworCQkJCQkgICAgICBycS0+
ZmVuY2UuY29udGV4dCwKKwkJCQkJICAgICAgJnJxLT5mZW5jZSk7CiAJCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoIkZhaWxlZCB0byB0cmFjayBhY3RpdmUg
cmVmIVxuIik7CkBAIC04OSwxNCArOTAsMTAgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV93YWl0
KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlz
dHJ1Y3QgbGl2ZV9hY3RpdmUgYWN0aXZlOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWlu
dCBlcnI7CiAKIAkvKiBDaGVjayB0aGF0IHdlIGdldCBhIGNhbGxiYWNrIHdoZW4gcmVxdWVzdHMg
cmV0aXJlIHVwb24gd2FpdGluZyAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3Bt
KTsKLQogCWVyciA9IF9fbGl2ZV9hY3RpdmVfc2V0dXAoaTkxNSwgJmFjdGl2ZSk7CiAKIAlpOTE1
X2FjdGl2ZV93YWl0KCZhY3RpdmUuYmFzZSk7CkBAIC0xMDYsMTEgKzEwMywxMiBAQCBzdGF0aWMg
aW50IGxpdmVfYWN0aXZlX3dhaXQodm9pZCAqYXJnKQogCX0KIAogCWk5MTVfYWN0aXZlX2Zpbmko
JmFjdGl2ZS5iYXNlKTsKKworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKIAkJZXJyID0gLUVJ
TzsKLQotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsK
IAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCiAJcmV0dXJuIGVycjsK
IH0KIApAQCAtMTE4LDE5ICsxMTYsMTcgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9yZXRpcmUo
dm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0
cnVjdCBsaXZlX2FjdGl2ZSBhY3RpdmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50
IGVycjsKIAogCS8qIENoZWNrIHRoYXQgd2UgZ2V0IGEgY2FsbGJhY2sgd2hlbiByZXF1ZXN0cyBh
cmUgaW5kaXJlY3RseSByZXRpcmVkICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVf
cG0pOwotCiAJZXJyID0gX19saXZlX2FjdGl2ZV9zZXR1cChpOTE1LCAmYWN0aXZlKTsKIAogCS8q
IHdhaXRzIGZvciAmIHJldGlyZXMgYWxsIHJlcXVlc3RzICovCisJbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9M
T0NLRUQpKQogCQllcnIgPSAtRUlPOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKIAlpZiAoIWFjdGl2ZS5yZXRpcmVkKSB7CiAJCXByX2VycigiaTkxNV9hY3RpdmUg
bm90IHJldGlyZWQgYWZ0ZXIgZmx1c2hpbmchXG4iKTsKQEAgLTEzOCw4ICsxMzQsNiBAQCBzdGF0
aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICphcmcpCiAJfQogCiAJaTkxNV9hY3RpdmVf
ZmluaSgmYWN0aXZlLmJhc2UpOwotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1l
X3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9tb2NrX3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9j
a190aW1lbGluZS5jCmluZGV4IDY1YjUyYmUyM2Q0Mi4uMDI0ZGU3MThmNjZmIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMKQEAgLTE1LDcgKzE1
LDcgQEAgdm9pZCBtb2NrX3RpbWVsaW5lX2luaXQoc3RydWN0IGk5MTVfdGltZWxpbmUgKnRpbWVs
aW5lLCB1NjQgY29udGV4dCkKIAogCW11dGV4X2luaXQoJnRpbWVsaW5lLT5tdXRleCk7CiAKLQlJ
TklUX0FDVElWRV9SRVFVRVNUKCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0KTsKKwlJTklUX0FDVElW
RV9GRU5DRSgmdGltZWxpbmUtPmxhc3RfcmVxdWVzdCk7CiAJSU5JVF9MSVNUX0hFQUQoJnRpbWVs
aW5lLT5yZXF1ZXN0cyk7CiAKIAlpOTE1X3N5bmNtYXBfaW5pdCgmdGltZWxpbmUtPnN5bmMpOwot
LSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

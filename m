Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1139C175A2
	for <lists+intel-gfx@lfdr.de>; Wed,  8 May 2019 12:10:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DC7FB895E2;
	Wed,  8 May 2019 10:10:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AAA8C895B9;
 Wed,  8 May 2019 10:10:23 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16487696-1500050 
 for multiple; Wed, 08 May 2019 11:10:12 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  8 May 2019 11:09:51 +0100
Message-Id: <20190508100958.32637-9-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190508100958.32637-1-chris@chris-wilson.co.uk>
References: <20190508100958.32637-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 09/16] i915/gem_ctx_switch: Exercise queues
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVldWVzIGFyZSBhIGZvcm0gb2YgY29udGV4dHMgdGhhdCBzaGFyZSB2bSBhbmQgZW5mb3JlIGEg
c2luZ2xlIHRpbWVsaW5lCmFjcm9zcyBhbGwgZW5naW5lcy4gVGVzdCBzd2l0Y2hpbmcgYmV0d2Vl
biB0aGVtLCBqdXN0IGxpa2Ugb3JkaW5hcnkKY29udGV4dHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJp
cyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiB0ZXN0cy9pOTE1L2dlbV9j
dHhfc3dpdGNoLmMgfCA3NSArKysrKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tCiAx
IGZpbGUgY2hhbmdlZCwgNTUgaW5zZXJ0aW9ucygrKSwgMjAgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvdGVzdHMvaTkxNS9nZW1fY3R4X3N3aXRjaC5jIGIvdGVzdHMvaTkxNS9nZW1fY3R4X3N3
aXRjaC5jCmluZGV4IDg3ZTEzYjkxNS4uNjQ3OTExZDRjIDEwMDY0NAotLS0gYS90ZXN0cy9pOTE1
L2dlbV9jdHhfc3dpdGNoLmMKKysrIGIvdGVzdHMvaTkxNS9nZW1fY3R4X3N3aXRjaC5jCkBAIC00
NCw3ICs0NCw4IEBACiAjZGVmaW5lIExPQ0FMX0k5MTVfRVhFQ19OT19SRUxPQyAoMTw8MTEpCiAj
ZGVmaW5lIExPQ0FMX0k5MTVfRVhFQ19IQU5ETEVfTFVUICgxPDwxMikKIAotI2RlZmluZSBJTlRF
UlJVUFRJQkxFIDEKKyNkZWZpbmUgSU5URVJSVVBUSUJMRSAweDEKKyNkZWZpbmUgUVVFVUUgMHgy
CiAKIHN0YXRpYyBkb3VibGUgZWxhcHNlZChjb25zdCBzdHJ1Y3QgdGltZXNwZWMgKnN0YXJ0LCBj
b25zdCBzdHJ1Y3QgdGltZXNwZWMgKmVuZCkKIHsKQEAgLTEyNiw4ICsxMjcsMTIgQEAgc3RhdGlj
IHZvaWQgc2luZ2xlKGludCBmZCwgdWludDMyX3QgaGFuZGxlLAogCiAJZ2VtX3JlcXVpcmVfcmlu
ZyhmZCwgZS0+ZXhlY19pZCB8IGUtPmZsYWdzKTsKIAotCWZvciAobiA9IDA7IG4gPCA2NDsgbisr
KQotCQljb250ZXh0c1tuXSA9IGdlbV9jb250ZXh0X2NyZWF0ZShmZCk7CisJZm9yIChuID0gMDsg
biA8IDY0OyBuKyspIHsKKwkJaWYgKGZsYWdzICYgUVVFVUUpCisJCQljb250ZXh0c1tuXSA9IGdl
bV9xdWV1ZV9jcmVhdGUoZmQpOworCQllbHNlCisJCQljb250ZXh0c1tuXSA9IGdlbV9jb250ZXh0
X2NyZWF0ZShmZCk7CisJfQogCiAJbWVtc2V0KCZvYmosIDAsIHNpemVvZihvYmopKTsKIAlvYmou
aGFuZGxlID0gaGFuZGxlOwpAQCAtMjMyLDggKzIzNywxMiBAQCBzdGF0aWMgdm9pZCBhbGwoaW50
IGZkLCB1aW50MzJfdCBoYW5kbGUsIHVuc2lnbmVkIGZsYWdzLCBpbnQgdGltZW91dCkKIAl9CiAJ
aWd0X3JlcXVpcmUobmVuZ2luZSk7CiAKLQlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShjb250
ZXh0cyk7IG4rKykKLQkJY29udGV4dHNbbl0gPSBnZW1fY29udGV4dF9jcmVhdGUoZmQpOworCWZv
ciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKGNvbnRleHRzKTsgbisrKSB7CisJCWlmIChmbGFncyAm
IFFVRVVFKQorCQkJY29udGV4dHNbbl0gPSBnZW1fcXVldWVfY3JlYXRlKGZkKTsKKwkJZWxzZQor
CQkJY29udGV4dHNbbl0gPSBnZW1fY29udGV4dF9jcmVhdGUoZmQpOworCX0KIAogCW1lbXNldChv
YmosIDAsIHNpemVvZihvYmopKTsKIAlvYmpbMV0uaGFuZGxlID0gaGFuZGxlOwpAQCAtMjk4LDYg
KzMwNywxNyBAQCBpZ3RfbWFpbgogewogCWNvbnN0IGludCBuY3B1cyA9IHN5c2NvbmYoX1NDX05Q
Uk9DRVNTT1JTX09OTE4pOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lICpl
OworCXN0YXRpYyBjb25zdCBzdHJ1Y3QgeworCQljb25zdCBjaGFyICpuYW1lOworCQl1bnNpZ25l
ZCBpbnQgZmxhZ3M7CisJCWJvb2wgKCpyZXF1aXJlKShpbnQgZmQpOworCX0gcGhhc2VzW10gPSB7
CisJCXsgIiIsIDAsIE5VTEwgfSwKKwkJeyAiLWludGVycnVwdGlibGUiLCBJTlRFUlJVUFRJQkxF
LCBOVUxMIH0sCisJCXsgIi1xdWV1ZSIsIFFVRVVFLCBnZW1faGFzX3F1ZXVlcyB9LAorCQl7ICIt
cXVldWUtaW50ZXJydXB0aWJsZSIsIFFVRVVFIHwgSU5URVJSVVBUSUJMRSwgZ2VtX2hhc19xdWV1
ZXMgfSwKKwkJeyB9CisJfTsKIAl1aW50MzJfdCBsaWdodCA9IDAsIGhlYXZ5OwogCWludCBmZCA9
IC0xOwogCkBAIC0zMTksMjEgKzMzOSwyNiBAQCBpZ3RfbWFpbgogCX0KIAogCWZvciAoZSA9IGlu
dGVsX2V4ZWN1dGlvbl9lbmdpbmVzOyBlLT5uYW1lOyBlKyspIHsKLQkJaWd0X3N1YnRlc3RfZigi
JXMlcyIsIGUtPmV4ZWNfaWQgPT0gMCA/ICJiYXNpYy0iIDogIiIsIGUtPm5hbWUpCi0JCQlzaW5n
bGUoZmQsIGxpZ2h0LCBlLCAwLCAxLCA1KTsKLQotCQlpZ3Rfc2tpcF9vbl9zaW11bGF0aW9uKCk7
Ci0KLQkJaWd0X3N1YnRlc3RfZigiJXMlcy1oZWF2eSIsIGUtPmV4ZWNfaWQgPT0gMCA/ICJiYXNp
Yy0iIDogIiIsIGUtPm5hbWUpCi0JCQlzaW5nbGUoZmQsIGhlYXZ5LCBlLCAwLCAxLCA1KTsKLQkJ
aWd0X3N1YnRlc3RfZigiJXMtaW50ZXJydXB0aWJsZSIsIGUtPm5hbWUpCi0JCQlzaW5nbGUoZmQs
IGxpZ2h0LCBlLCBJTlRFUlJVUFRJQkxFLCAxLCAxNTApOwotCQlpZ3Rfc3VidGVzdF9mKCJmb3Jr
ZWQtJXMiLCBlLT5uYW1lKQotCQkJc2luZ2xlKGZkLCBsaWdodCwgZSwgMCwgbmNwdXMsIDE1MCk7
Ci0JCWlndF9zdWJ0ZXN0X2YoImZvcmtlZC0lcy1oZWF2eSIsIGUtPm5hbWUpCi0JCQlzaW5nbGUo
ZmQsIGhlYXZ5LCBlLCAwLCBuY3B1cywgMTUwKTsKLQkJaWd0X3N1YnRlc3RfZigiZm9ya2VkLSVz
LWludGVycnVwdGlibGUiLCBlLT5uYW1lKQotCQkJc2luZ2xlKGZkLCBsaWdodCwgZSwgSU5URVJS
VVBUSUJMRSwgbmNwdXMsIDE1MCk7CisJCWZvciAodHlwZW9mKCpwaGFzZXMpICpwID0gcGhhc2Vz
OyBwLT5uYW1lOyBwKyspIHsKKwkJCWlndF9zdWJ0ZXN0X2dyb3VwIHsKKwkJCQlpZ3RfZml4dHVy
ZSB7CisJCQkJCWlmIChwLT5yZXF1aXJlKQorCQkJCQkJaWd0X3JlcXVpcmUocC0+cmVxdWlyZShm
ZCkpOworCQkJCX0KKworCQkJCWlndF9zdWJ0ZXN0X2YoIiVzJXMlcyIsIGUtPmV4ZWNfaWQgPT0g
MCA/ICJiYXNpYy0iIDogIiIsIGUtPm5hbWUsIHAtPm5hbWUpCisJCQkJCXNpbmdsZShmZCwgbGln
aHQsIGUsIHAtPmZsYWdzLCAxLCA1KTsKKworCQkJCWlndF9za2lwX29uX3NpbXVsYXRpb24oKTsK
KworCQkJCWlndF9zdWJ0ZXN0X2YoIiVzJXMtaGVhdnklcyIsIGUtPmV4ZWNfaWQgPT0gMCA/ICJi
YXNpYy0iIDogIiIsIGUtPm5hbWUsIHAtPm5hbWUpCisJCQkJCXNpbmdsZShmZCwgaGVhdnksIGUs
IHAtPmZsYWdzLCAxLCA1KTsKKwkJCQlpZ3Rfc3VidGVzdF9mKCJmb3JrZWQtJXMlcyIsIGUtPm5h
bWUsIHAtPm5hbWUpCisJCQkJCXNpbmdsZShmZCwgbGlnaHQsIGUsIHAtPmZsYWdzLCBuY3B1cywg
MTUwKTsKKwkJCQlpZ3Rfc3VidGVzdF9mKCJmb3JrZWQtJXMtaGVhdnklcyIsIGUtPm5hbWUsIHAt
Pm5hbWUpCisJCQkJCXNpbmdsZShmZCwgaGVhdnksIGUsIHAtPmZsYWdzLCBuY3B1cywgMTUwKTsK
KwkJCX0KKwkJfQogCX0KIAogCWlndF9zdWJ0ZXN0KCJiYXNpYy1hbGwtbGlnaHQiKQpAQCAtMzQx
LDYgKzM2NiwxNiBAQCBpZ3RfbWFpbgogCWlndF9zdWJ0ZXN0KCJiYXNpYy1hbGwtaGVhdnkiKQog
CQlhbGwoZmQsIGhlYXZ5LCAwLCA1KTsKIAorCWlndF9zdWJ0ZXN0X2dyb3VwIHsKKwkJaWd0X2Zp
eHR1cmUgeworCQkJaWd0X3JlcXVpcmUoZ2VtX2hhc19xdWV1ZXMoZmQpKTsKKwkJfQorCQlpZ3Rf
c3VidGVzdCgiYmFzaWMtcXVldWUtbGlnaHQiKQorCQkJYWxsKGZkLCBsaWdodCwgUVVFVUUsIDUp
OworCQlpZ3Rfc3VidGVzdCgiYmFzaWMtcXVldWUtaGVhdnkiKQorCQkJYWxsKGZkLCBoZWF2eSwg
UVVFVUUsIDUpOworCX0KKwogCWlndF9maXh0dXJlIHsKIAkJaWd0X3N0b3BfaGFuZ19kZXRlY3Rv
cigpOwogCQlnZW1fY2xvc2UoZmQsIGhlYXZ5KTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

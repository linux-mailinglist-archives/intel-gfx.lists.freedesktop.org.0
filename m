Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E9FE310CC80
	for <lists+intel-gfx@lfdr.de>; Thu, 28 Nov 2019 17:10:58 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A97F26E851;
	Thu, 28 Nov 2019 16:10:56 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0967D6E851
 for <Intel-gfx@lists.freedesktop.org>; Thu, 28 Nov 2019 16:10:55 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Nov 2019 08:10:55 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,253,1571727600"; d="scan'208";a="221368379"
Received: from kjbrenna-mobl1.ger.corp.intel.com (HELO localhost.localdomain)
 ([10.251.83.147])
 by orsmga002.jf.intel.com with ESMTP; 28 Nov 2019 08:10:54 -0800
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Thu, 28 Nov 2019 16:10:51 +0000
Message-Id: <20191128161051.12753-1-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/pmu: Report frequency as zero while
 GPU is sleeping
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KCldlIHVzZWQg
dG8gcmVwb3J0IHRoZSBtaW5pbXVtIHBvc3NpYmxlIGZyZXF1ZW5jeSBhcyBib3RoIHJlcXVlc3Rl
ZCBhbmQKYWN0aXZlIHdoaWxlIEdQVSB3YXMgaW4gc2xlZXAgc3RhdGUuIFRoaXMgd2FzIGEgY29u
c2VxdWVuY2Ugb2Ygc2FtcGxpbmcKdGhlIHZhbHVlIGZyb20gdGhlICJjdXJyZW50IGZyZXF1ZW5j
eSIgZmllbGQgaW4gb3VyIHNvZnR3YXJlIHRyYWNraW5nLgoKVGhpcyB3YXMgc3RyaWN0bHkgc3Bl
YWtpbmcgd3JvbmcsIGJ1dCBnaXZlbiB0aGF0IHVudGlsIHJlY2VudGx5IHRoZQpjdXJyZW50IGZy
ZXF1ZW5jeSBpbiBzbGVlcGluZyBzdGF0ZSB1c2VkIHRvIGJlIGVxdWFsIHRvIG1pbmltdW0sIGl0
IGRpZApub3Qgc3RhbmQgb3V0IHN1ZmZpY2llbnRseSB0byBiZSBub3RpY2VkIGFzIHN1Y2guCgpB
ZnRlciBzb21lIHJlY2VudCBjaGFuZ2VzIGhhdmUgbWFkZSB0aGUgY3VycmVudCBmcmVxdWVuY3kg
YmUgcmVwb3J0ZWQKYXMgbGFzdCBhY3RpdmUgYmVmb3JlIEdQVSB3ZW50IHRvIHNsZWVwLCBtZWFu
aW5nIGJvdGggcmVxdWVzdGVkIGFuZCBhY3RpdmUKZnJlcXVlbmNpZXMgY291bGQgZW5kIHVwIGJl
aW5nIHJlcG9ydGVkIGF0IHRoZWlyIG1heGltdW0gdmFsdWVzIGZvciB0aGUKZHVyYXRpb24gb2Yg
dGhlIEdQVSBpZGxlIHN0YXRlLCBpdCBiZWNhbWUgbXVjaCBtb3JlIG9idmlvdXMgdGhhdCB0aGlz
IGRvZXMKbm90IG1ha2Ugc2Vuc2UuCgpUbyBmaXggdGhpcyB3ZSB3aWxsIG5vdyBzYW1wbGUgdGhl
IGZyZXF1ZW5jeSBjb3VudGVycyBvbmx5IHdoZW4gdGhlIEdQVSBpcwphd2FrZS4gQXMgYSBjb25z
ZXF1ZW5jZSByZXBvcnRlZCBmcmVxdWVuY2llcyBjb3VsZCBiZSByZXBvcnRlZCBhcyBiZWxvdwp0
aGUgR1BVIHJlcG9ydGVkIG1pbmltdW0gYnV0IHRoYXQgc2hvdWxkIGJlIG11Y2ggbGVzcyBjb25m
dXNpbmcgdGhhdCB0aGUKY3VycmVudCBzaXR1YXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBUdnJ0a28g
VXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcG11LmMgfCA0NCArKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0KIDEg
ZmlsZSBjaGFuZ2VkLCAyMyBpbnNlcnRpb25zKCspLCAyMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wbXUuYwppbmRleCA5NWU4MjRhNzhkNGQuLmI1NzZhMmJlOWY4MSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3BtdS5jCkBAIC0zNzgsMzIgKzM3OCwzMiBAQCBmcmVxdWVuY3lfc2FtcGxlKHN0
cnVjdCBpbnRlbF9ndCAqZ3QsIHVuc2lnbmVkIGludCBwZXJpb2RfbnMpCiAJc3RydWN0IGk5MTVf
cG11ICpwbXUgPSAmaTkxNS0+cG11OwogCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZndC0+cnBz
OwogCisJaWYgKCEocG11LT5lbmFibGUgJgorCSAgICAgIChjb25maWdfZW5hYmxlZF9tYXNrKEk5
MTVfUE1VX0FDVFVBTF9GUkVRVUVOQ1kpIHwKKwkgICAgICAgY29uZmlnX2VuYWJsZWRfbWFzayhJ
OTE1X1BNVV9SRVFVRVNURURfRlJFUVVFTkNZKSkpIHx8CisJICAgICFpbnRlbF9ndF9wbV9nZXRf
aWZfYXdha2UoZ3QpKQorCQlyZXR1cm47CisKIAlpZiAocG11LT5lbmFibGUgJiBjb25maWdfZW5h
YmxlZF9tYXNrKEk5MTVfUE1VX0FDVFVBTF9GUkVRVUVOQ1kpKSB7CiAJCXUzMiB2YWw7CiAKLQkJ
dmFsID0gcnBzLT5jdXJfZnJlcTsKLQkJaWYgKGludGVsX2d0X3BtX2dldF9pZl9hd2FrZShndCkp
IHsKLQkJCXUzMiBzdGF0OwotCi0JCQkvKgotCQkJICogV2UgdGFrZSBhIHF1aWNrIHBlZWsgaGVy
ZSB3aXRob3V0IHVzaW5nIGZvcmNld2FrZQotCQkJICogc28gdGhhdCB3ZSBkb24ndCBwZXJ0dXJi
IHRoZSBzeXN0ZW0gdW5kZXIgb2JzZXJ2YXRpb24KLQkJCSAqIChmb3JjZXdha2UgPT4gIXJjNiA9
PiBpbmNyZWFzZWQgcG93ZXIgdXNlKS4gV2UgZXhwZWN0Ci0JCQkgKiB0aGF0IGlmIHRoZSByZWFk
IGZhaWxzIGJlY2F1c2UgaXQgaXMgb3V0c2lkZSBvZiB0aGUKLQkJCSAqIG1taW8gcG93ZXIgd2Vs
bCwgdGhlbiBpdCB3aWxsIHJldHVybiAwIC0tIGluIHdoaWNoCi0JCQkgKiBjYXNlIHdlIGFzc3Vt
ZSB0aGUgc3lzdGVtIGlzIHJ1bm5pbmcgYXQgdGhlIGludGVuZGVkCi0JCQkgKiBmcmVxdWVuY3ku
IEZvcnR1bmF0ZWx5LCB0aGUgcmVhZCBzaG91bGQgcmFyZWx5IGZhaWwhCi0JCQkgKi8KLQkJCXN0
YXQgPSBpbnRlbF91bmNvcmVfcmVhZF9mdyh1bmNvcmUsIEdFTjZfUlBTVEFUMSk7Ci0JCQlpZiAo
c3RhdCkKLQkJCQl2YWwgPSBpbnRlbF9nZXRfY2FnZihycHMsIHN0YXQpOwotCi0JCQlpbnRlbF9n
dF9wbV9wdXRfYXN5bmMoZ3QpOwotCQl9CisJCS8qCisJCSAqIFdlIHRha2UgYSBxdWljayBwZWVr
IGhlcmUgd2l0aG91dCB1c2luZyBmb3JjZXdha2UKKwkJICogc28gdGhhdCB3ZSBkb24ndCBwZXJ0
dXJiIHRoZSBzeXN0ZW0gdW5kZXIgb2JzZXJ2YXRpb24KKwkJICogKGZvcmNld2FrZSA9PiAhcmM2
ID0+IGluY3JlYXNlZCBwb3dlciB1c2UpLiBXZSBleHBlY3QKKwkJICogdGhhdCBpZiB0aGUgcmVh
ZCBmYWlscyBiZWNhdXNlIGl0IGlzIG91dHNpZGUgb2YgdGhlCisJCSAqIG1taW8gcG93ZXIgd2Vs
bCwgdGhlbiBpdCB3aWxsIHJldHVybiAwIC0tIGluIHdoaWNoCisJCSAqIGNhc2Ugd2UgYXNzdW1l
IHRoZSBzeXN0ZW0gaXMgcnVubmluZyBhdCB0aGUgaW50ZW5kZWQKKwkJICogZnJlcXVlbmN5LiBG
b3J0dW5hdGVseSwgdGhlIHJlYWQgc2hvdWxkIHJhcmVseSBmYWlsIQorCQkgKi8KKwkJdmFsID0g
aW50ZWxfdW5jb3JlX3JlYWRfZncodW5jb3JlLCBHRU42X1JQU1RBVDEpOworCQlpZiAodmFsKQor
CQkJdmFsID0gaW50ZWxfZ2V0X2NhZ2YocnBzLCB2YWwpOworCQllbHNlCisJCQl2YWwgPSBycHMt
PmN1cl9mcmVxOwogCiAJCWFkZF9zYW1wbGVfbXVsdCgmcG11LT5zYW1wbGVbX19JOTE1X1NBTVBM
RV9GUkVRX0FDVF0sCi0JCQkJaW50ZWxfZ3B1X2ZyZXEocnBzLCB2YWwpLAotCQkJCXBlcmlvZF9u
cyAvIDEwMDApOworCQkJCWludGVsX2dwdV9mcmVxKHJwcywgdmFsKSwgcGVyaW9kX25zIC8gMTAw
MCk7CiAJfQogCiAJaWYgKHBtdS0+ZW5hYmxlICYgY29uZmlnX2VuYWJsZWRfbWFzayhJOTE1X1BN
VV9SRVFVRVNURURfRlJFUVVFTkNZKSkgewpAQCAtNDExLDYgKzQxMSw4IEBAIGZyZXF1ZW5jeV9z
YW1wbGUoc3RydWN0IGludGVsX2d0ICpndCwgdW5zaWduZWQgaW50IHBlcmlvZF9ucykKIAkJCQlp
bnRlbF9ncHVfZnJlcShycHMsIHJwcy0+Y3VyX2ZyZXEpLAogCQkJCXBlcmlvZF9ucyAvIDEwMDAp
OwogCX0KKworCWludGVsX2d0X3BtX3B1dF9hc3luYyhndCk7CiB9CiAKIHN0YXRpYyBlbnVtIGhy
dGltZXJfcmVzdGFydCBpOTE1X3NhbXBsZShzdHJ1Y3QgaHJ0aW1lciAqaHJ0aW1lcikKLS0gCjIu
MjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

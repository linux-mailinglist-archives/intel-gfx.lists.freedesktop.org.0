Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 17159181466
	for <lists+intel-gfx@lfdr.de>; Wed, 11 Mar 2020 10:17:38 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 65B976E41B;
	Wed, 11 Mar 2020 09:17:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DF0D46E41B
 for <intel-gfx@lists.freedesktop.org>; Wed, 11 Mar 2020 09:17:34 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 11 Mar 2020 02:17:33 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,540,1574150400"; d="scan'208";a="236371914"
Received: from unknown (HELO slisovsk-Lenovo-ideapad-720S-13IKB.fi.intel.com)
 ([10.237.72.89])
 by orsmga008.jf.intel.com with ESMTP; 11 Mar 2020 02:17:31 -0700
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 11 Mar 2020 11:13:38 +0200
Message-Id: <20200311091338.9148-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200309161204.17792-5-stanislav.lisovskiy@intel.com>
References: <20200309161204.17792-5-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v19 4/8] drm/i915: Refactor intel_can_enable_sagv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGludGVsX2Nhbl9lbmFibGVfc2FndiBmdW5jdGlvbiBjb250YWlucwphIG1peCBv
ZiB3b3JrYXJvdW5kcyBmb3IgZGlmZmVyZW50IHBsYXRmb3Jtcwpzb21lIG9mIHRoZW0gYXJlIG5v
dCB2YWxpZCBmb3IgZ2VucyA+PSAxMSBhbHJlYWR5LApzbyBsZXRzIHNwbGl0IGl0IGludG8gc2Vw
YXJhdGUgZnVuY3Rpb25zLgoKdjI6CiAgICAtIFJld29yayB3YXRlcm1hcmsgY2FsY3VsYXRpb24g
YWxnb3JpdGhtIHRvCiAgICAgIGF0dGVtcHQgdG8gY2FsY3VsYXRlIExldmVsIDAgd2F0ZXJtYXJr
CiAgICAgIHdpdGggYWRkZWQgc2FndiBibG9jayB0aW1lIGxhdGVuY3kgYW5kCiAgICAgIGNoZWNr
IGlmIGl0IGZpdHMgaW4gREJ1ZiBpbiBvcmRlciB0bwogICAgICBkZXRlcm1pbmUgaWYgU0FHViBj
YW4gYmUgZW5hYmxlZCBhbHJlYWR5CiAgICAgIGF0IHRoaXMgc3RhZ2UsIGp1c3QgYXMgQlNwZWMg
NDkzMjUgc3RhdGVzLgogICAgICBpZiB0aGF0IGZhaWxzIHJvbGxiYWNrIHRvIHVzdWFsIExldmVs
IDAKICAgICAgbGF0ZW5jeSBhbmQgZGlzYWJsZSBTQUdWLgogICAgLSBSZW1vdmUgdW5uZWVkZWQg
dGFicyhKYW1lcyBBdXNtdXMpCgp2MzogUmViYXNlZCB0aGUgcGF0Y2gKCnY0OiAtIEFkZGVkIGJh
Y2sgaW50ZXJsYWNlZCBjaGVjayBmb3IgR2VuMTIgYW5kCiAgICAgIGFkZGVkIHNlcGFyYXRlIGZ1
bmN0aW9uIGZvciBUR0wgU0FHViBjaGVjawogICAgICAodGhhbmtzIHRvIEphbWVzIEF1c211cyBm
b3Igc3BvdHRpbmcpCiAgICAtIFJlbW92ZWQgdW5uZWVkZWQgZ2VuIGNoZWNrCiAgICAtIEV4dHJh
Y3RlZCBHZW4xMiBTQUdWIGRlY2lzaW9uIG1ha2luZyBjb2RlCiAgICAgIHRvIGEgc2VwYXJhdGUg
ZnVuY3Rpb24gZnJvbSBza2xfY29tcHV0ZV93bQoKdjU6IC0gQWRkZWQgU0FHViBnbG9iYWwgc3Rh
dGUgdG8gZGV2X3ByaXYsIGJlY2F1c2UKICAgICAgd2UgbmVlZCB0byB0cmFjayBhbGwgcGlwZXMs
IG5vdCBvbmx5IHRob3NlCiAgICAgIGluIGF0b21pYyBzdGF0ZS4gRWFjaCBwaXBlIGhhcyBub3cg
Y29ycmVzcG9uZGVudAogICAgICBiaXQgbWFzayByZWZsZWN0aW5nLCB3aGV0aGVyIGl0IGNhbiB0
b2xlcmF0ZQogICAgICBTQUdWIG9yIG5vdCh0aGFua3MgdG8gVmlsbGUgU3lyamFsYSBmb3Igc3Vn
Z2VzdGlvbnMpLgogICAgLSBOb3cgdXNpbmcgYWN0aXZlIGZsYWcgaW5zdGVhZCBvZiBlbmFibGUg
aW4gY3JjCiAgICAgIHVzYWdlIGNoZWNrLgoKdjY6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0cwoK
djc6IC0ga21zX2N1cnNvcl9sZWdhY3kgc2VlbXMgdG8gZ2V0IGJyb2tlbiBiZWNhdXNlIG9mIG11
bHRpcGxlIG1lbWNweQogICAgICBjYWxscyB3aGVuIGNvcHlpbmcgbGV2ZWwgMCB3YXRlciBtYXJr
cyBmb3IgZW5hYmxlZCBTQUdWLCB0bwogICAgICBmaXggdGhpcyBub3cgc2ltcGx5IHVzaW5nIHRo
YXQgZmllbGQgcmlnaHQgYXdheSwgd2l0aG91dCBjb3B5aW5nLAogICAgICBmb3IgdGhhdCBpbnRy
b2R1Y2VkIGEgbmV3IHdtX2xldmVsIGFjY2Vzc29yIHdoaWNoIGRlY2lkZXMgd2hpY2gKICAgICAg
d21fbGV2ZWwgdG8gcmV0dXJuIGJhc2VkIG9uIFNBR1Ygc3RhdGUuCgp2ODogLSBQcm90ZWN0IGNy
dGNfc2Fndl9tYXNrIHNhbWUgd2F5IGFzIHdlIGRvIGZvciBvdGhlciBnbG9iYWwgc3RhdGUKICAg
ICAgY2hhbmdlczogaS5lIGNoZWNrIGlmIGNoYW5nZXMgYXJlIG5lZWRlZCwgdGhlbiBncmFiIGFs
bCBjcnRjIGxvY2tzCiAgICAgIHRvIHNlcmlhbGl6ZSB0aGUgY2hhbmdlcyhWaWxsZSBTeXJqw6Rs
w6QpCiAgICAtIEFkZCBjcnRjX3NhZ3ZfbWFzayBjYWNoaW5nIGluIG9yZGVyIHRvIGF2b2lkIG5l
ZWRsZXNzIHJlY2FsY3VsYXRpb25zCiAgICAgIChNYXR0aGV3IFJvcGVyKQogICAgLSBQdXQgYmFj
ayBHZW4xMiBTQUdWIHN3aXRjaCBpbiBvcmRlciB0byBnZXQgaXQgZW5hYmxlZCBpbiBzZXBhcmF0
ZQogICAgICBwYXRjaChNYXR0aGV3IFJvcGVyKQogICAgLSBSZW5hbWUgKl9zZXRfc2Fndl9tYXNr
IHRvICpfY29tcHV0ZV9zYWd2X21hc2soTWF0dGhldyBSb3BlcikKICAgIC0gQ2hlY2sgaWYgdGhl
cmUgYXJlIG5vIGFjdGl2ZSBwaXBlcyBpbiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKICAgICAgaW5z
dGVhZCBvZiBwbGF0Zm9ybSBzcGVjaWZpYyBmdW5jdGlvbnMoTWF0dGhldyBSb3BlciksIHNhbWUK
ICAgICAgZm9yIGludGVsX2hhc19zYWd2IGNoZWNrLgoKdjkgIC0gU3dpdGNoZWQgdG8gdTggZm9y
IGNydGNfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gY3J0Y19zYWd2X21hc2sgbm93
IGlzIHBpcGVfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRXh0cmFjdGVkIHNhZ3Yg
Y2hlY2tpbmcgbG9naWMgZnJvbSBza2wvaWNsL3RnbF9jb21wdXRlX3NhZ3ZfbWFzawogICAgLSBF
eHRyYWN0ZWQgc2tsX3BsYW5lX3dtX2xldmVsIGZ1bmN0aW9uIGFuZCBwYXNzaW5nIGxhdGVuY3kg
dG8KICAgICAgc2VwYXJhdGUgcGF0Y2hlcyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIFJlbW92ZWQg
cGFydCBvZiB1bm5lZWRlZCBjb3B5LXBhc3RlIGZyb20gdGdsX2NoZWNrX3BpcGVfZml0c19zYWd2
X3dtCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIE5vdyB1c2luZyBzaW1wbGUgYXNzaWdu
bWVudCBmb3Igc2Fndl93bTAgYXMgaXQgY29udGFpbnMgb25seQogICAgICBwb2QgdHlwZXMgYW5k
IG5vIHBvaW50ZXJzKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRml4ZWQgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2IG5vdCB0byBkbyBkb3VibGUgZHV0eSwgbm93IGl0IG9ubHkKICAgICAgY2hlY2sgU0FH
ViBiaXRzIGJ5IEFORGluZyB0aG9zZSBiZXR3ZWVuIGxvY2FsIGFuZCBnbG9iYWwgc3RhdGUuCiAg
ICAgIFRoZSBTQUdWIG1hc2tzIGFyZSBub3cgY29tcHV0ZWQgYWZ0ZXIgd2F0ZXJtYXJrcyBhcmUg
YXZhaWxhYmxlLAogICAgICBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGZpZ3VyZSBvdXQgaWYgZGRi
IHJhbmdlcyBhcmUgZml0dGluZyBuaWNlbHkuCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IE5vdyBoYXZpbmcgdXZfc2Fndl93bTAgYW5kIHNhZ3Zfd20wLCBvdGhlcndpc2Ugd2UgaGF2ZSB3
cm9uZyBsb2dpYwogICAgICB3aGVuIHVzaW5nIHNrbF9wbGFuZV93bV9sZXZlbCBhY2Nlc3Nvciwg
YXMgd2UgaGFkIHByZXZpb3VzbHkgZm9yCiAgICAgIEdlbjExKyBjb2xvciBwbGFuZSBhbmQgcmVn
dWxhciB3bSBsZXZlbHMsIHNvIHByb2JhYmx5IGJvdGgKICAgICAgaGFzIHRvIGJlIHJlY2FsY3Vs
YXRlZCB3aXRoIGFkZGl0aW9uYWwgU0FHViBibG9jayB0aW1lIGZvciBMZXZlbCAwLgoKdjEwOiAt
IFN0YXJ0aW5nIHRvIHVzZSBuZXcgZ2xvYmFsIHN0YXRlIGZvciBzdG9yaW5nIHBpcGVfc2Fndl9t
YXNrCgp2MTE6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0IHdpdGggcmVjZW50IGRybS10aXAKICAg
ICAtIENoZWNrIGlmIHdlIHJlYWxseSBuZWVkIHRvIHJlY2FsY3VsYXRlIFNBR1YgbWFzaywgb3Ro
ZXJ3aXNlCiAgICAgICBiYWlsIG91dCB3aXRob3V0IG1ha2luZyBhbnkgY2hhbmdlcy4KICAgICAt
IFVzZSBjYWNoZWQgU0FHViByZXN1bHQsIGluc3RlYWQgb2YgcmVjYWxjdWxhdGluZyBpdCBldmVy
eXRpbWUsCiAgICAgICBpZiBid19zdGF0ZSBoYXNuJ3QgY2hhbmdlZC4KCnYxMjogLSBSZW1vdmVk
IFdBUk4gZnJvbSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YsIGluIHNvbWUgb2YgdGhlIGNvbW1pdHMK
ICAgICAgIGlmIHdlIGRvbid0IHJlY2FsY3VsYXRlZCB3YXRlcm1hcmtzLCBid19zdGF0ZSBpcyBu
b3QgcmVjYWxjdWxhdGVkLAogICAgICAgdGh1cyBsZWFkaW5nIHRvIFNBR1Ygc3RhdGUgbm90IHJl
Y2FsY3VsYXRlZCBieSB0aGUgY29tbWl0IHN0YXRlLAogICAgICAgd2hpY2ggaXMgc3RpbGwgY2Fs
bGluZyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YgZnVuY3Rpb24uIEZpeCB0aGF0CiAgICAgICBieSBq
dXN0IGFuYWx5emluZyB0aGUgY3VycmVudCBnbG9iYWwgYndfc3RhdGUgb2JqZWN0IC0gYmVjYXVz
ZQogICAgICAgd2Ugc2ltcGx5IGhhdmUgbm8gb3RoZXIgb2JqZWN0cyByZWxhdGVkIHRvIHRoYXQu
Cgp2MTM6IC0gUmViYXNlZCwgZml4ZWQgd2FybmluZ3MgcmVnYXJkaW5nIGxvbmcgbGluZXMKICAg
ICAtIENoYW5nZWQgZnVuY3Rpb24gY2FsbCBzaXRlcyBmcm9tIGludGVsX2F0b21pY19idyogdG8K
ICAgICAgIGludGVsX3diXyogYXMgd2FzIHN1Z2dlc3RlZC4oSmFuaSBOaWt1bGEpCiAgICAgLSBU
YWtlbiBkZGJfc3RhdGVfY2hhbmdlZCBhbmQgYndfc3RhdGVfY2hhbmdlZCBpbnRvIHVzZS4KCnYx
NDogLSB0b3RhbF9hZmZlY3RlZF9wbGFuZXMgaXMgbm8gbG9uZ2VyIG5lZWRlZCB0byBjaGVjayBm
b3IgZGRiIGNoYW5nZXMsCiAgICAgICBqdXN0IGFzIGFjdGl2ZV9waXBlX2NoYW5nZXMuCgp2MTU6
IC0gRml4ZWQgc3R1cGlkIG1pc3Rha2Ugd2l0aCB1bmluaXRpYWxpemVkIGNydGMgaW4KICAgICAg
IHNrbF9jb21wdXRlX3NhZ3ZfbWFzay4KCnYxNjogLSBDb252ZXJ0IHBpcGVfc2Fndl9tYXNrIHRv
IHBpcGVfc2Fndl9yZWplY3QgYW5kIG5vdyB1c2luZyBpbnZlcnRlZAogICAgICAgZmxhZyB0byBp
bmRpY2F0ZSBTQUdWIHJlYWRpbmVzcyBmb3IgdGhlIHBpcGUoVmlsbGUgU3lyasOkbMOkKQogICAg
IC0gQWRkZWQgcmV0dXJuIHZhbHVlIHRvIGludGVsX2NvbXB1dGVfc2Fndl9tYXNrIHdoaWNoIGNh
bGwKICAgICAgIGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0YXRlIGluIG9yZGVyIHRv
IHByb3Blcmx5CiAgICAgICBwcm9wYWdhdGUgRURFQURMQ0sgdG8gZHJtLgogICAgIC0gQmFzZWQg
b24gdGhlIGRpc2N1c3Npb24gd2l0aCBWaWxsZSwgcmVtb3ZlZCBhY3RpdmVfcGlwZV9jaGFuZ2Vz
CiAgICAgICBjaGVjayBhbmQgYWxzbyB0aGVyZSBzZWVtcyB0byBiZSBubyBuZWVkIGZvciBjaGVj
a2luZwogICAgICAgZGRiX3N0YXRlX2NoYW5nZXMgYXMgd2VsbC4KICAgICAgIEluc3RlYWQgd2Ug
anVzdCBpdGVyYXRlIHRocm91Z2ggY3J0Y3MgaW4gc3RhdGUgLSBoYXZpbmcKICAgICAgIGNydGMg
aW4gYSBzdGF0ZSBhbHJlYWR5IGd1YXJhbnRlZXMgdGhhdCBpdCBpcyBhdCBsZWFzdCByZWFkLWxv
Y2tlZAogICAgICAgSGF2aW5nIGFkZGl0aW9uYWwgZmxhZyB0byBjaGVjayBpZiB0aGVyZSBhY3R1
YWxseSB3ZXJlIHNvbWUgcGxhbmUKICAgICAgIHdtL2RkYiBjaGFuZ2VzIHdvdWxkIGJlIHByb2Jh
Ymx5IGFkZGVkIGxhdGVyIGFzIGFuIG9wdGltaXphdGlvbi4KICAgICAtIFdlIGNhbid0IGdldCBw
YXJlbnQgYXRvbWljIHN0YXRlIGZyb20gY3J0Y19zdGF0ZSBhdCBjb21taXQgc3RhZ2UKICAgICAg
IChuaWNlIGRybSBmZWF0dXJlKSwgYWxzbyBwcm9wYWdhdGluZyBzdGF0ZSB0aHJvdWdoIGZ1bmN0
aW9uIGNhbGwKICAgICAgIGNoYWluIHNlZW1zIHRvIGJlIG92ZXJraWxsIGFuZCBub3QgcG9zc2li
bGUoY3Vyc29yIGxlZ2FjeSB1cGRhdGVzKQogICAgICAgUXVlcnlpbmcgZm9yIGJ3X3N0YXRlIG9i
amVjdCBmcm9tIGdsb2JhbCBzdGF0ZSBpcyBub3QgcG9zc2libGUgYXMKICAgICAgIGl0IG1pZ2h0
IGdldCBzd2FwcGVkIHdpdGggb3RoZXIgZ2xvYmFsIHN0YXRlLgogICAgICAgU28uLi4ganVzdCBz
dGlja2VkIGNhbl9zYWd2IGJvb2xlYW4gaW50byB3bSBjcnRjIHN0YXRlLgoKdjE3OiAtIFNraXAg
aW5hY3RpdmUgY3J0Y3MsIHdoZW4gY2hlY2tpbmcgZm9yIFNBR1YtcmVhZGluZXNzLgoKU2lnbmVk
LW9mZi1ieTogU3RhbmlzbGF2IExpc292c2tpeSA8c3RhbmlzbGF2Lmxpc292c2tpeUBpbnRlbC5j
b20+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAaW50ZWwuY29tPgpDYzogSmFt
ZXMgQXVzbXVzIDxqYW1lcy5hdXNtdXNAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfYncuaCAgICAgICB8ICAxOCArCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAgMjMgKy0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jICAgICAgICAgICAgICAgfCAzMTcgKysrKysrKysrKysrKysrKy0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oICAgICAgICAgICAgICAgfCAgIDEgKwogNSBmaWxlcyBj
aGFuZ2VkLCAzMjEgaW5zZXJ0aW9ucygrKSwgNDEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCmluZGV4IGI1ZjYxNDYzOTIyZi4uNDA4M2FkZjRiNDMy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCkBAIC0xOCw2ICsxOCwy
NCBAQCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZTsKIHN0cnVjdCBpbnRlbF9id19zdGF0ZSB7CiAJ
c3RydWN0IGludGVsX2dsb2JhbF9zdGF0ZSBiYXNlOwogCisJLyoKKwkgKiBDb250YWlucyBhIGJp
dCBtYXNrLCB1c2VkIHRvIGRldGVybWluZSwgd2hldGhlciBjb3JyZXNwb25kZW50CisJICogcGlw
ZSBhbGxvd3MgU0FHViBvciBub3QuCisJICovCisJdTggcGlwZV9zYWd2X3JlamVjdDsKKworCS8q
CisJICogVXNlZCB0byBkZXRlcm1pbmUgaWYgd2UgYWxyZWFkeSBoYWQgY2FsY3VsYXRlZAorCSAq
IFNBR1YgbWFzayBmb3IgdGhpcyBzdGF0ZSBvbmNlLgorCSAqLworCWJvb2wgc2Fndl9jYWxjdWxh
dGVkOworCisJLyoKKwkgKiBDb250YWlucyBmaW5hbCBTQUdWIGRlY2lzaW9uIGJhc2VkIG9uIGN1
cnJlbnQgbWFzaywKKwkgKiB0byBwcmV2ZW50IGRvaW5nIHRoZSBzYW1lIGpvYiBvdmVyIGFuZCBv
dmVyIGFnYWluLgorCSAqLworCWJvb2wgY2FuX3NhZ3Y7CisKIAl1bnNpZ25lZCBpbnQgZGF0YV9y
YXRlW0k5MTVfTUFYX1BJUEVTXTsKIAl1OCBudW1fYWN0aXZlX3BsYW5lc1tJOTE1X01BWF9QSVBF
U107CiB9OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpp
bmRleCA4ZjIzYzRkNTFjMzMuLjllMDA1OGE3OGVhNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE0MDEwLDcgKzE0MDEwLDEwIEBAIHN0YXRp
YyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJLyogV2F0
ZXJtYXJrcyAqLwogCQlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsr
KSB7CiAJCQlpZiAoc2tsX3dtX2xldmVsX2VxdWFscygmaHdfcGxhbmVfd20tPndtW2xldmVsXSwK
LQkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxdKSkKKwkJCQkJCSZzd19wbGFuZV93bS0+d21b
bGV2ZWxdKSB8fAorCQkJICAgKHNrbF93bV9sZXZlbF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53bVts
ZXZlbF0sCisJCQkJCQkmc3dfcGxhbmVfd20tPnNhZ3Zfd20wKSAmJgorCQkJICAgKGxldmVsID09
IDApKSkKIAkJCQljb250aW51ZTsKIAogCQkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKQEAgLTE0
MDY1LDcgKzE0MDY4LDEwIEBAIHN0YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YywKIAkJLyogV2F0ZXJtYXJrcyAqLwogCQlmb3IgKGxldmVsID0gMDsgbGV2
ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7CiAJCQlpZiAoc2tsX3dtX2xldmVsX2VxdWFscygm
aHdfcGxhbmVfd20tPndtW2xldmVsXSwKLQkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxdKSkK
KwkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxdKSB8fAorCQkJICAgKHNrbF93bV9sZXZlbF9l
cXVhbHMoJmh3X3BsYW5lX3dtLT53bVtsZXZlbF0sCisJCQkJCQkmc3dfcGxhbmVfd20tPnNhZ3Zf
d20wKSAmJgorCQkJICAgKGxldmVsID09IDApKSkKIAkJCQljb250aW51ZTsKIAogCQkJZHJtX2Vy
cigmZGV2X3ByaXYtPmRybSwKQEAgLTE1NTQ0LDggKzE1NTUwLDEwIEBAIHN0YXRpYyB2b2lkIGlu
dGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAkJICogU0tMIHdvcmthcm91bmQ6IGJzcGVjIHJlY29tbWVuZHMgd2UgZGlzYWJsZSB0aGUgU0FH
ViB3aGVuIHdlCiAJCSAqIGhhdmUgbW9yZSB0aGVuIG9uZSBwaXBlIGVuYWJsZWQKIAkJICovCi0J
CWlmICghaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKLQkJCWludGVsX2Rpc2FibGVfc2Fn
dihkZXZfcHJpdik7CisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpIHsKKwkJCWlmICgh
aW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKKwkJCQlpbnRlbF9kaXNhYmxlX3NhZ3YoZGV2
X3ByaXYpOworCQl9CiAKIAkJaW50ZWxfbW9kZXNldF92ZXJpZnlfZGlzYWJsZWQoZGV2X3ByaXYs
IHN0YXRlKTsKIAl9CkBAIC0xNTY0NSw4ICsxNTY1MywxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9h
dG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYg
KHN0YXRlLT5tb2Rlc2V0KQogCQlpbnRlbF92ZXJpZnlfcGxhbmVzKHN0YXRlKTsKIAotCWlmIChz
dGF0ZS0+bW9kZXNldCAmJiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQotCQlpbnRlbF9l
bmFibGVfc2FndihkZXZfcHJpdik7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkgewor
CQlpZiAoc3RhdGUtPm1vZGVzZXQgJiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKKwkJ
CWludGVsX2VuYWJsZV9zYWd2KGRldl9wcml2KTsKKwl9CiAKIAlkcm1fYXRvbWljX2hlbHBlcl9j
b21taXRfaHdfZG9uZSgmc3RhdGUtPmJhc2UpOwogCkBAIC0xNTc5OCw3ICsxNTgwOCw2IEBAIHN0
YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NvbW1pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiAJ
aWYgKHN0YXRlLT5nbG9iYWxfc3RhdGVfY2hhbmdlZCkgewogCQlhc3NlcnRfZ2xvYmFsX3N0YXRl
X2xvY2tlZChkZXZfcHJpdik7Ci0KIAkJZGV2X3ByaXYtPmFjdGl2ZV9waXBlcyA9IHN0YXRlLT5h
Y3RpdmVfcGlwZXM7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IDVlMDBlNjExZjA3Ny4uZGEwMzA4Yjg3ZGFkIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlw
ZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlw
ZXMuaApAQCAtNjY5LDExICs2NjksMTQgQEAgc3RydWN0IHNrbF9wbGFuZV93bSB7CiAJc3RydWN0
IHNrbF93bV9sZXZlbCB3bVs4XTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHV2X3dtWzhdOwogCXN0
cnVjdCBza2xfd21fbGV2ZWwgdHJhbnNfd207CisJc3RydWN0IHNrbF93bV9sZXZlbCBzYWd2X3dt
MDsKKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHV2X3NhZ3Zfd20wOwogCWJvb2wgaXNfcGxhbmFyOwog
fTsKIAogc3RydWN0IHNrbF9waXBlX3dtIHsKIAlzdHJ1Y3Qgc2tsX3BsYW5lX3dtIHBsYW5lc1tJ
OTE1X01BWF9QTEFORVNdOworCWJvb2wgY2FuX3NhZ3Y7CiB9OwogCiBlbnVtIHZsdl93bV9sZXZl
bCB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCBmZWM4OTcyMmJlNzUuLmEzYjU1NzEzZmQ2
MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC00Myw2ICs0Myw3IEBACiAjaW5jbHVkZSAi
aTkxNV9maXhlZC5oIgogI2luY2x1ZGUgImk5MTVfaXJxLmgiCiAjaW5jbHVkZSAiaTkxNV90cmFj
ZS5oIgorI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfYncuaCIKICNpbmNsdWRlICJpbnRlbF9wbS5o
IgogI2luY2x1ZGUgImludGVsX3NpZGViYW5kLmgiCiAjaW5jbHVkZSAiLi4vLi4vLi4vcGxhdGZv
cm0veDg2L2ludGVsX2lwcy5oIgpAQCAtMzYzNCw3ICszNjM1LDcgQEAgc3RhdGljIGJvb2wgc2ts
X25lZWRzX21lbW9yeV9id193YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
cmV0dXJuIElTX0dFTjlfQkMoZGV2X3ByaXYpIHx8IElTX0JST1hUT04oZGV2X3ByaXYpOwogfQog
Ci1zdGF0aWMgYm9vbAorYm9vbAogaW50ZWxfaGFzX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogewogCS8qIEhBQ0shICovCkBAIC0zNzU3LDM5ICszNzU4LDI1IEBAIGlu
dGVsX2Rpc2FibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0
dXJuIDA7CiB9CiAKLWJvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQorc3RhdGljIGJvb2wgc2tsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBl
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9
IHRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT51YXBpLnN0YXRlKTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwotCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOwotCWVudW0gcGlwZSBwaXBlOwogCWludCBsZXZl
bCwgbGF0ZW5jeTsKIAotCWlmICghaW50ZWxfaGFzX3NhZ3YoZGV2X3ByaXYpKQotCQlyZXR1cm4g
ZmFsc2U7Ci0KLQkvKgotCSAqIElmIHRoZXJlIGFyZSBubyBhY3RpdmUgQ1JUQ3MsIG5vIGFkZGl0
aW9uYWwgY2hlY2tzIG5lZWQgYmUgcGVyZm9ybWVkCi0JICovCi0JaWYgKGh3ZWlnaHQ4KHN0YXRl
LT5hY3RpdmVfcGlwZXMpID09IDApCi0JCXJldHVybiB0cnVlOworCWNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAKLQkvKgotCSAqIFNLTCsgd29ya2Fyb3VuZDog
YnNwZWMgcmVjb21tZW5kcyB3ZSBkaXNhYmxlIFNBR1Ygd2hlbiB3ZSBoYXZlCi0JICogbW9yZSB0
aGVuIG9uZSBwaXBlIGVuYWJsZWQKLQkgKi8KLQlpZiAoaHdlaWdodDgoc3RhdGUtPmFjdGl2ZV9w
aXBlcykgPiAxKQorCWlmICgoSU5URUxfR0VOKGRldl9wcml2KSA8PSA5KSAmJiAoaHdlaWdodDgo
c3RhdGUtPmFjdGl2ZV9waXBlcykgPiAxKSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JLyogU2luY2Ug
d2UncmUgbm93IGd1YXJhbnRlZWQgdG8gb25seSBoYXZlIG9uZSBhY3RpdmUgQ1JUQy4uLiAqLwot
CXBpcGUgPSBmZnMoc3RhdGUtPmFjdGl2ZV9waXBlcykgLSAxOwotCWNydGMgPSBpbnRlbF9nZXRf
Y3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7Ci0JY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2Ny
dGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQorCWlmIChjcnRjX3N0YXRl
LT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpIHsKKwkJ
RFJNX0RFQlVHX0tNUygiTm8gU0FHViBmb3IgaW50ZXJsYWNlZCBtb2RlIG9uIHBpcGUgJWNcbiIs
CisJCQkgICAgICBwaXBlX25hbWUoY3J0Yy0+cGlwZSkpOwogCQlyZXR1cm4gZmFsc2U7CisJfQog
CiAJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YyhkZXYsIGNydGMsIHBsYW5lKSB7CiAJCXN0
cnVjdCBza2xfcGxhbmVfd20gKndtID0KQEAgLTM4MTYsMTMgKzM4MDMsMTQ4IEBAIGJvb2wgaW50
ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkg
KiBpbmN1ciBtZW1vcnkgbGF0ZW5jaWVzIGhpZ2hlciB0aGFuIHNhZ3ZfYmxvY2tfdGltZV91cyB3
ZQogCQkgKiBjYW4ndCBlbmFibGUgU0FHVi4KIAkJICovCi0JCWlmIChsYXRlbmN5IDwgZGV2X3By
aXYtPnNhZ3ZfYmxvY2tfdGltZV91cykKKwkJaWYgKGxhdGVuY3kgPCBkZXZfcHJpdi0+c2Fndl9i
bG9ja190aW1lX3VzKSB7CisJCQlEUk1fREVCVUdfS01TKCJMYXRlbmN5ICVkIDwgc2FndiBibG9j
ayB0aW1lICVkLCBubyBTQUdWIGZvciBwaXBlICVjXG4iLAorCQkJCSAgICAgIGxhdGVuY3ksIGRl
dl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVfdXMsIHBpcGVfbmFtZShjcnRjLT5waXBlKSk7CiAJCQly
ZXR1cm4gZmFsc2U7CisJCX0KIAl9CiAKIAlyZXR1cm4gdHJ1ZTsKIH0KIAorc3RhdGljIGJvb2wK
K3RnbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlwZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSk7CisKK3N0YXRpYyBib29sIGludGVsX2NhbGN1bGF0ZV9zYWd2X3Jlc3VsdChzdHJ1
Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0YXRlKQoreworCXJldHVybiBid19zdGF0ZS0+cGlwZV9z
YWd2X3JlamVjdCA9PSAwOworfQorCitzdGF0aWMgaW50IGludGVsX2NvbXB1dGVfc2Fndl9tYXNr
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQoreworCWludCByZXQ7CisJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7
CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRl
bF9id19zdGF0ZSAqbmV3X2J3X3N0YXRlID0gTlVMTDsKKwlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUg
Km9sZF9id19zdGF0ZSA9IE5VTEw7CisJaW50IGk7CisKKwkvKgorCSAqIElmIFNBR1YgaXMgbm90
IHN1cHBvcnRlZCB3ZSBqdXN0IGNhbid0IGRvIGFueXRoaW5nCisJICogbm90IGV2ZW4gc2V0IG9y
IHJlamVjdCBTQUdWIHBvaW50cyAtIGp1c3QgYmFpbCBvdXQuCisJICogVGh1cyBhdm9pZCBuZWVk
bGVzcyBjYWxjdWxhdGlvbnMuCisJICovCisJaWYgKCFpbnRlbF9oYXNfc2FndihkZXZfcHJpdikp
CisJCXJldHVybiAwOworCisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUs
IGNydGMsCisJCQkJCSBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlib29sIHBpcGVfc2Fndl9lbmFi
bGU7CisKKwkJbmV3X2J3X3N0YXRlID0gaW50ZWxfYndfZ2V0X3N0YXRlKHN0YXRlKTsKKwkJb2xk
X2J3X3N0YXRlID0gaW50ZWxfYndfZ2V0X29sZF9zdGF0ZShzdGF0ZSk7CisKKwkJaWYgKElTX0VS
Ul9PUl9OVUxMKG5ld19id19zdGF0ZSkgfHwgSVNfRVJSX09SX05VTEwob2xkX2J3X3N0YXRlKSkg
eworCQkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCQlyZXR1cm4gLUVJ
TlZBTDsKKwkJfQorCisJCW5ld19id19zdGF0ZS0+c2Fndl9jYWxjdWxhdGVkID0gZmFsc2U7CisK
KwkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQorCQkJY29udGludWU7CisKKwkJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCQlwaXBlX3NhZ3ZfZW5hYmxlID0gdGdsX2Nh
bl9lbmFibGVfc2Fndl9vbl9waXBlKG5ld19jcnRjX3N0YXRlKTsKKwkJZWxzZQorCQkJcGlwZV9z
YWd2X2VuYWJsZSA9IHNrbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlwZShuZXdfY3J0Y19zdGF0ZSk7
CisKKwkJaWYgKHBpcGVfc2Fndl9lbmFibGUpCisJCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9y
ZWplY3QgJj0gfkJJVChjcnRjLT5waXBlKTsKKwkJZWxzZQorCQkJbmV3X2J3X3N0YXRlLT5waXBl
X3NhZ3ZfcmVqZWN0IHw9IEJJVChjcnRjLT5waXBlKTsKKwl9CisKKwlpZiAoIW5ld19id19zdGF0
ZSB8fCAhb2xkX2J3X3N0YXRlKQorCQlyZXR1cm4gMDsKKworCW5ld19id19zdGF0ZS0+Y2FuX3Nh
Z3YgPSBpbnRlbF9jYWxjdWxhdGVfc2Fndl9yZXN1bHQobmV3X2J3X3N0YXRlKTsKKwluZXdfYndf
c3RhdGUtPnNhZ3ZfY2FsY3VsYXRlZCA9IHRydWU7CisKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0
Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywKKwkJCQkJIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCXN0
cnVjdCBza2xfcGlwZV93bSAqcGlwZV93bSA9ICZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGlt
YWw7CisKKwkJLyoKKwkJICogRHVlIHRvIGRybSBsaW1pdGF0aW9uIGF0IGNvbW1pdCBzdGF0ZSwg
d2hlbgorCQkgKiBjaGFuZ2VzIGFyZSB3cml0dGVuIHRoZSB3aG9sZSBhdG9taWMgc3RhdGUgaXMK
KwkJICogemVyb2VkIGF3YXkgPT4gd2hpY2ggcHJldmVudHMgZnJvbSB1c2luZyBpdCwKKwkJICog
c28ganVzdCBzdGlja2luZyBpdCBpbnRvIHBpcGUgd20gc3RhdGUgZm9yCisJCSAqIGtlZXBpbmcg
aXQgc2ltcGxlIC0gYW55d2F5IHRoaXMgaXMgcmVsYXRlZCB0byB3bS4KKwkJICogUHJvcGVyIHdh
eSBpbiBpZGVhbCB1bml2ZXJzZSB3b3VsZCBiZSBvZiBjb3Vyc2Ugbm90CisJCSAqIHRvIGxvc2Ug
cGFyZW50IGF0b21pYyBzdGF0ZSBvYmplY3QgZnJvbSBjaGlsZCBjcnRjX3N0YXRlLAorCQkgKiBh
bmQgc3RpY2sgdG8gT09QIHByb2dyYW1taW5nIHByaW5jaXBsZXMsIHdoaWNoIGhhZCBiZWVuCisJ
CSAqIHNjaWVudGlmaWNhbGx5IHByb3ZlbiB0byB3b3JrLgorCQkgKi8KKwkJcGlwZV93bS0+Y2Fu
X3NhZ3YgPSBuZXdfYndfc3RhdGUtPmNhbl9zYWd2OworCX0KKworCS8qCisJICogRm9yIFNBR1Yg
d2UgbmVlZCB0byBhY2NvdW50IGFsbCB0aGUgcGlwZXMsCisJICogbm90IG9ubHkgdGhlIG9uZXMg
d2hpY2ggYXJlIGluIHN0YXRlIGN1cnJlbnRseS4KKwkgKiBHcmFiIGFsbCBsb2NrcyBpZiB3ZSBk
ZXRlY3QgdGhhdCB3ZSBhcmUgYWN0dWFsbHkKKwkgKiBnb2luZyB0byBkbyBzb21ldGhpbmcuCisJ
ICovCisJaWYgKG5ld19id19zdGF0ZS0+cGlwZV9zYWd2X3JlamVjdCAhPSBvbGRfYndfc3RhdGUt
PnBpcGVfc2Fndl9yZWplY3QpIHsKKwkJRFJNX0RFQlVHX0tNUygiU3RhdGUgJXA6IG9sZCBzYWd2
IG1hc2sgMHgleCwgbmV3IHNhZ3YgbWFzayAweCV4XG4iLAorCQkJICAgICAgc3RhdGUsCisJCQkg
ICAgICBvbGRfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QsCisJCQkgICAgICBuZXdfYndfc3Rh
dGUtPnBpcGVfc2Fndl9yZWplY3QpOworCisJCXJldCA9IGludGVsX2F0b21pY19zZXJpYWxpemVf
Z2xvYmFsX3N0YXRlKCZuZXdfYndfc3RhdGUtPmJhc2UpOworCQlpZiAocmV0KSB7CisJCQlEUk1f
REVCVUdfS01TKCJDb3VsZCBub3Qgc2VyaWFsaXplIGdsb2JhbCBzdGF0ZVxuIik7CisJCQlyZXR1
cm4gcmV0OworCQl9CisJfQorCisJcmV0dXJuIDA7Cit9CisKKy8qCisgKiBUaGlzIGZ1bmN0aW9u
IHRvIGJlIHVzZWQgYmVmb3JlIHN3YXAgc3RhdGUKKyAqLworYm9vbCBpbnRlbF9jYW5fZW5hYmxl
X3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX2J3X3N0YXRlICpid19zdGF0
ZTsKKworCWlmICghaW50ZWxfaGFzX3NhZ3YoZGV2X3ByaXYpKSB7CisJCURSTV9ERUJVR19LTVMo
Ik5vIFNBR1Ygc3VwcG9ydCBkZXRlY3RlZFxuIik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwli
d19zdGF0ZSA9IGludGVsX2J3X2dldF9zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSX09SX05V
TEwoYndfc3RhdGUpKSB7CisJCVdBUk4oMSwgIkNvdWxkIG5vdCBnZXQgYndfc3RhdGVcbiIpOwor
CQlyZXR1cm4gZmFsc2U7CisJfQorCisJaWYgKGJ3X3N0YXRlLT5zYWd2X2NhbGN1bGF0ZWQpCisJ
CWdvdG8gb3V0OworCisJYndfc3RhdGUtPmNhbl9zYWd2ID0gaW50ZWxfY2FsY3VsYXRlX3NhZ3Zf
cmVzdWx0KGJ3X3N0YXRlKTsKKwlid19zdGF0ZS0+c2Fndl9jYWxjdWxhdGVkID0gdHJ1ZTsKKwor
b3V0OgorCXJldHVybiBid19zdGF0ZS0+Y2FuX3NhZ3Y7Cit9CisKIC8qCiAgKiBDYWxjdWxhdGUg
aW5pdGlhbCBEQnVmIHNsaWNlIG9mZnNldCwgYmFzZWQgb24gc2xpY2Ugc2l6ZQogICogYW5kIG1h
c2soaS5lIGlmIHNsaWNlIHNpemUgaXMgMTAyNCBhbmQgc2Vjb25kIHNsaWNlIGlzIGVuYWJsZWQK
QEAgLTQwNDIsNiArNDE2NCw3IEBAIHNrbF9jdXJzb3JfYWxsb2NhdGlvbihjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJdW5zaWduZWQgaW50IGxhdGVuY3kgPSBk
ZXZfcHJpdi0+d20uc2tsX2xhdGVuY3lbbGV2ZWxdOwogCiAJCXNrbF9jb21wdXRlX3BsYW5lX3dt
KGNydGNfc3RhdGUsIGxldmVsLCBsYXRlbmN5LCAmd3AsICZ3bSwgJndtKTsKKwogCQlpZiAod20u
bWluX2RkYl9hbGxvYyA9PSBVMTZfTUFYKQogCQkJYnJlYWs7CiAKQEAgLTQ1NTYsOSArNDY3OSw4
MyBAQCBza2xfcGxhbmVfd21fbGV2ZWwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQogCQkmY3J0Y19zdGF0
ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3BsYW5lX2lkXTsKIAorCWlmICghbGV2ZWwpIHsKKwkJ
Y29uc3Qgc3RydWN0IHNrbF9waXBlX3dtICpwaXBlX3dtID0gJmNydGNfc3RhdGUtPndtLnNrbC5v
cHRpbWFsOworCisJCWlmIChwaXBlX3dtLT5jYW5fc2FndikKKwkJCXJldHVybiBjb2xvcl9wbGFu
ZSA9PSAwID8gJndtLT5zYWd2X3dtMCA6ICZ3bS0+dXZfc2Fndl93bTA7CisJfQorCiAJcmV0dXJu
IGNvbG9yX3BsYW5lID09IDAgPyAmd20tPndtW2xldmVsXSA6ICZ3bS0+dXZfd21bbGV2ZWxdOwog
fQogCitzdGF0aWMgYm9vbAordGdsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBlKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNy
dGNfc3RhdGUtPnVhcGkuY3J0YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGMtPmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKGNydGMpOworCXN0cnVjdCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjcnRj
X3N0YXRlLT53bS5za2wuZGRiOworCXUxNiBhbGxvY19zaXplOworCXU2NCB0b3RhbF9kYXRhX3Jh
dGU7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZDsKKwlpbnQgbnVtX2FjdGl2ZTsKKwl1NjQgcGxh
bmVfZGF0YV9yYXRlW0k5MTVfTUFYX1BMQU5FU10gPSB7fTsKKwl1MzIgYmxvY2tzOworCisJLyoK
KwkgKiBJZiBwaXBlIGlzIG5vdCBhY3RpdmUgaXQgY2FuJ3QgYWZmZWN0IFNBR1YgcmVqZWN0aW9u
CisJICogQ2hlY2tpbmcgaXQgaGVyZSBpcyBuZWVkZWQgdG8gbGVhdmUgb25seSBjYXNlcyB3aGVu
CisJICogYWxsb2Nfc2l6ZSBpcyAwIGZvciBhbnkgb3RoZXIgcmVhc29ucywgZXhjZXB0IGluYWN0
aXZlCisJICogcGlwZS4gQXMgaW5hY3RpdmUgcGlwZSBpcyBmaW5lLCBob3dldmVyIGhhdmluZyBu
byBkZGIKKwkgKiBzcGFjZSBhdmFpbGFibGUgaXMgYWxyZWFkeSBwcm9ibGVtYXRpYyAtIHNvIG5l
ZWQgdG8KKwkgKiB0byBzZXBhcmF0ZSB0aG9zZS4KKwkgKi8KKwlpZiAoIWNydGNfc3RhdGUtPmh3
LmFjdGl2ZSkKKwkJcmV0dXJuIHRydWU7CisKKwkvKgorCSAqIE5vIG5lZWQgdG8gY2hlY2sgZ2Vu
IGhlcmUsIHdlIGNhbGwgdGhpcyBvbmx5IGZvciBnZW4xMgorCSAqLworCXRvdGFsX2RhdGFfcmF0
ZSA9CisJCWljbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKGNydGNfc3RhdGUsCisJCQkJ
CQkgcGxhbmVfZGF0YV9yYXRlKTsKKworCXNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1p
dHMoZGV2X3ByaXYsIGNydGNfc3RhdGUsCisJCQkJCSAgIHRvdGFsX2RhdGFfcmF0ZSwKKwkJCQkJ
ICAgYWxsb2MsICZudW1fYWN0aXZlKTsKKwlhbGxvY19zaXplID0gc2tsX2RkYl9lbnRyeV9zaXpl
KGFsbG9jKTsKKwlpZiAoYWxsb2Nfc2l6ZSA9PSAwKQorCQlyZXR1cm4gZmFsc2U7CisKKwkvKgor
CSAqIERvIGNoZWNrIGlmIHdlIGNhbiBmaXQgTDAgKyBzYWd2X2Jsb2NrX3RpbWUgYW5kCisJICog
ZGlzYWJsZSBTQUdWIGlmIHdlIGNhbid0LgorCSAqLworCWJsb2NrcyA9IDA7CisJZm9yX2VhY2hf
cGxhbmVfaWRfb25fY3J0YyhpbnRlbF9jcnRjLCBwbGFuZV9pZCkgeworCQkvKgorCQkgKiBUaGUg
b25seSBwbGFjZSwgd2hlcmUgd2UgY2FuJ3QgdXNlIHNrbF9wbGFuZV93bV9sZXZlbAorCQkgKiBh
Y2Nlc3NvciwgYmVjYXVzZSBpZiBhY3R1YWxseSBjYWxscyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YK
KwkJICogd2hpY2ggZGVwZW5kcyBvbiB0aGF0IGZ1bmN0aW9uLgorCQkgKi8KKwkJY29uc3Qgc3Ry
dWN0IHNrbF9wbGFuZV93bSAqd20gPQorCQkJJmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBs
YW5lc1twbGFuZV9pZF07CisKKwkJYmxvY2tzICs9IHdtLT5zYWd2X3dtMC5taW5fZGRiX2FsbG9j
OworCQlibG9ja3MgKz0gd20tPnV2X3NhZ3Zfd20wLm1pbl9kZGJfYWxsb2M7CisKKwkJaWYgKGJs
b2NrcyA+IGFsbG9jX3NpemUpIHsKKwkJCURSTV9ERUJVR19LTVMoIk5vdCBlbm91Z2ggZGRiIGJs
b2NrcyglZDwlZCkgZm9yIFNBR1Ygb24gcGlwZSAlY1xuIiwKKwkJCQkgICAgICBhbGxvY19zaXpl
LCBibG9ja3MsIHBpcGVfbmFtZShpbnRlbF9jcnRjLT5waXBlKSk7CisJCQlyZXR1cm4gZmFsc2U7
CisJCX0KKwl9CisJRFJNX0RFQlVHX0tNUygiJWQgdG90YWwgYmxvY2tzIHJlcXVpcmVkIGZvciBT
QUdWLCBkZGIgZW50cnkgc2l6ZSAlZFxuIiwKKwkJICAgICAgYmxvY2tzLCBhbGxvY19zaXplKTsK
KwlyZXR1cm4gdHJ1ZTsKK30KKwogc3RhdGljIGludAogc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewpAQCAtNTE0MCwxMSArNTMzNywx
OSBAQCBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV9wbGFuZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyB2b2lkCiBza2xfY29tcHV0ZV93bV9sZXZl
bHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgICAgIGNv
bnN0IHN0cnVjdCBza2xfd21fcGFyYW1zICp3bV9wYXJhbXMsCi0JCSAgICAgIHN0cnVjdCBza2xf
d21fbGV2ZWwgKmxldmVscykKKwkJICAgICAgc3RydWN0IHNrbF9wbGFuZV93bSAqcGxhbmVfd20s
CisJCSAgICAgIGJvb2wgeXV2KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCWludCBsZXZlbCwgbWF4
X2xldmVsID0gaWxrX3dtX21heF9sZXZlbChkZXZfcHJpdik7CisJLyoKKwkgKiBDaGVjayB3aGlj
aCBraW5kIG9mIHBsYW5lIGlzIGl0IGFuZCBiYXNlZCBvbiB0aGF0IGNhbGN1bGF0ZQorCSAqIGNv
cnJlc3BvbmRlbnQgV00gbGV2ZWxzLgorCSAqLworCXN0cnVjdCBza2xfd21fbGV2ZWwgKmxldmVs
cyA9IHl1diA/IHBsYW5lX3dtLT51dl93bSA6IHBsYW5lX3dtLT53bTsKIAlzdHJ1Y3Qgc2tsX3dt
X2xldmVsICpyZXN1bHRfcHJldiA9ICZsZXZlbHNbMF07CisJc3RydWN0IHNrbF93bV9sZXZlbCAq
c2Fndl93bSA9IHl1diA/CisJCQkJJnBsYW5lX3dtLT51dl9zYWd2X3dtMCA6ICZwbGFuZV93bS0+
c2Fndl93bTA7CiAKIAlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsr
KSB7CiAJCXN0cnVjdCBza2xfd21fbGV2ZWwgKnJlc3VsdCA9ICZsZXZlbHNbbGV2ZWxdOwpAQCAt
NTE1NSw2ICs1MzYwLDI3IEBAIHNrbF9jb21wdXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogCQlyZXN1bHRfcHJldiA9IHJlc3VsdDsKIAl9
CisJLyoKKwkgKiBGb3IgR2VuMTIgaWYgaXQgaXMgYW4gTDAgd2UgbmVlZCB0byBhbHNvCisJICog
Y29uc2lkZXIgc2Fndl9ibG9ja190aW1lIHdoZW4gY2FsY3VsYXRpbmcKKwkgKiBMMCB3YXRlcm1h
cmsgLSB3ZSB3aWxsIG5lZWQgdGhhdCB3aGVuIG1ha2luZworCSAqIGEgZGVjaXNpb24gd2hldGhl
ciBlbmFibGUgU0FHViBvciBub3QuCisJICogRm9yIG9sZGVyIGdlbnMgd2UgYWdyZWVkIHRvIGNv
cHkgTDAgdmFsdWUgZm9yCisJICogY29tcGF0aWJpbGl0eS4KKwkgKi8KKwlpZiAoKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTIpKSB7CisJCXUzMiBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9s
YXRlbmN5WzBdOworCisJCWxhdGVuY3kgKz0gZGV2X3ByaXYtPnNhZ3ZfYmxvY2tfdGltZV91czsK
KwkJc2tsX2NvbXB1dGVfcGxhbmVfd20oY3J0Y19zdGF0ZSwgMCwgbGF0ZW5jeSwKKwkJCQkgICAg
IHdtX3BhcmFtcywgJmxldmVsc1swXSwKKwkJCQkgICAgIHNhZ3Zfd20pOworCQlEUk1fREVCVUdf
S01TKCIlZCBMMCBibG9ja3MgcmVxdWlyZWQgZm9yIFNBR1YgdnMgJWQgZm9yIG5vbi1TQUdWXG4i
LAorCQkJICAgICAgc2Fndl93bS0+bWluX2RkYl9hbGxvYywgbGV2ZWxzWzBdLm1pbl9kZGJfYWxs
b2MpOworCX0gZWxzZSB7CisJCS8qIFNpbmNlIGFsbCBtZW1iZXJzIGFyZSBQT0QgKi8KKwkJKnNh
Z3Zfd20gPSBsZXZlbHNbMF07CisJfQogfQogCiBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV90cmFu
c2l0aW9uX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAt
NTIzNyw3ICs1NDYzLDcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd21fc2luZ2xlKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiBy
ZXQ7CiAKLQlza2xfY29tcHV0ZV93bV9sZXZlbHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20t
PndtKTsKKwlza2xfY29tcHV0ZV93bV9sZXZlbHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20s
IGZhbHNlKTsKIAlza2xfY29tcHV0ZV90cmFuc2l0aW9uX3dtKGNydGNfc3RhdGUsICZ3bV9wYXJh
bXMsIHdtKTsKIAogCXJldHVybiAwOwpAQCAtNTI1OSw3ICs1NDg1LDcgQEAgc3RhdGljIGludCBz
a2xfYnVpbGRfcGxhbmVfd21fdXYoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRj
X3N0YXRlLCAmd21fcGFyYW1zLCB3bS0+dXZfd20pOworCXNrbF9jb21wdXRlX3dtX2xldmVscyhj
cnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bSwgdHJ1ZSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTU1
OTgsOSArNTgyNCwyNSBAQCBza2xfcHJpbnRfd21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAkJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYt
PmRybSwgY3J0YywgcGxhbmUpIHsKIAkJCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+
aWQ7CiAJCQljb25zdCBzdHJ1Y3Qgc2tsX3BsYW5lX3dtICpvbGRfd20sICpuZXdfd207CisJCQlj
b25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpvbGRfd21fbGV2ZWwsICpuZXdfd21fbGV2ZWw7CisJ
CQl1MTYgb2xkX3BsYW5lX3Jlc19sLCBuZXdfcGxhbmVfcmVzX2w7CisJCQl1OCAgb2xkX3BsYW5l
X3Jlc19iLCBuZXdfcGxhbmVfcmVzX2I7CisJCQl1MTYgb2xkX21pbl9kZGJfYWxsb2MsIG5ld19t
aW5fZGRiX2FsbG9jOworCQkJaW50IGNvbG9yX3BsYW5lID0gMDsKIAogCQkJb2xkX3dtID0gJm9s
ZF9waXBlX3dtLT5wbGFuZXNbcGxhbmVfaWRdOwogCQkJbmV3X3dtID0gJm5ld19waXBlX3dtLT5w
bGFuZXNbcGxhbmVfaWRdOworCQkJb2xkX3dtX2xldmVsID0gc2tsX3BsYW5lX3dtX2xldmVsKG9s
ZF9jcnRjX3N0YXRlLCBwbGFuZV9pZCwgMCwgY29sb3JfcGxhbmUpOworCQkJbmV3X3dtX2xldmVs
ID0gc2tsX3BsYW5lX3dtX2xldmVsKG5ld19jcnRjX3N0YXRlLCBwbGFuZV9pZCwgMCwgY29sb3Jf
cGxhbmUpOworCisJCQlvbGRfcGxhbmVfcmVzX2wgPSBvbGRfd21fbGV2ZWwtPnBsYW5lX3Jlc19s
OworCQkJb2xkX3BsYW5lX3Jlc19iID0gb2xkX3dtX2xldmVsLT5wbGFuZV9yZXNfYjsKKworCQkJ
bmV3X3BsYW5lX3Jlc19sID0gbmV3X3dtX2xldmVsLT5wbGFuZV9yZXNfbDsKKwkJCW5ld19wbGFu
ZV9yZXNfYiA9IG5ld193bV9sZXZlbC0+cGxhbmVfcmVzX2I7CisKKwkJCW9sZF9taW5fZGRiX2Fs
bG9jID0gb2xkX3dtX2xldmVsLT5taW5fZGRiX2FsbG9jOworCQkJbmV3X21pbl9kZGJfYWxsb2Mg
PSBuZXdfd21fbGV2ZWwtPm1pbl9kZGJfYWxsb2M7CiAKIAkJCWlmIChza2xfcGxhbmVfd21fZXF1
YWxzKGRldl9wcml2LCBvbGRfd20sIG5ld193bSkpCiAJCQkJY29udGludWU7CkBAIC01NjI0LDcg
KzU4NjYsNyBAQCBza2xfcHJpbnRfd21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAkJCQkgICAgIltQTEFORTolZDolc10gICBsaW5lcyAlYyUzZCwlYyUzZCwlYyUz
ZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCIKIAkJCQkgICAgICAiIC0+ICVj
JTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkXG4iLAog
CQkJCSAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJCSAgICBl
bmFzdChvbGRfd20tPndtWzBdLmlnbm9yZV9saW5lcyksIG9sZF93bS0+d21bMF0ucGxhbmVfcmVz
X2wsCisJCQkJICAgIGVuYXN0KG9sZF93bS0+d21bMF0uaWdub3JlX2xpbmVzKSwgb2xkX3BsYW5l
X3Jlc19sLAogCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzFdLmlnbm9yZV9saW5lcyksIG9sZF93
bS0+d21bMV0ucGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+d21bMl0uaWdub3Jl
X2xpbmVzKSwgb2xkX3dtLT53bVsyXS5wbGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3Qob2xkX3dt
LT53bVszXS5pZ25vcmVfbGluZXMpLCBvbGRfd20tPndtWzNdLnBsYW5lX3Jlc19sLApAQCAtNTYz
NCw3ICs1ODc2LDcgQEAgc2tsX3ByaW50X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUpCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+d21bN10uaWdub3JlX2xpbmVzKSwg
b2xkX3dtLT53bVs3XS5wbGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT50cmFuc193
bS5pZ25vcmVfbGluZXMpLCBvbGRfd20tPnRyYW5zX3dtLnBsYW5lX3Jlc19sLAogCi0JCQkJICAg
IGVuYXN0KG5ld193bS0+d21bMF0uaWdub3JlX2xpbmVzKSwgbmV3X3dtLT53bVswXS5wbGFuZV9y
ZXNfbCwKKwkJCQkgICAgZW5hc3QobmV3X3dtLT53bVswXS5pZ25vcmVfbGluZXMpLCBuZXdfcGxh
bmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG5ld193bS0+d21bMV0uaWdub3JlX2xpbmVzKSwgbmV3
X3dtLT53bVsxXS5wbGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3QobmV3X3dtLT53bVsyXS5pZ25v
cmVfbGluZXMpLCBuZXdfd20tPndtWzJdLnBsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChuZXdf
d20tPndtWzNdLmlnbm9yZV9saW5lcyksIG5ld193bS0+d21bM10ucGxhbmVfcmVzX2wsCkBAIC01
NjQ4LDEyICs1ODkwLDEyIEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogCQkJCSAgICAiW1BMQU5FOiVkOiVzXSAgYmxvY2tzICU0ZCwlNGQs
JTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkIgogCQkJCSAgICAiIC0+ICU0ZCwlNGQsJTRkLCU0
ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkXG4iLAogCQkJCSAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBw
bGFuZS0+YmFzZS5uYW1lLAotCQkJCSAgICBvbGRfd20tPndtWzBdLnBsYW5lX3Jlc19iLCBvbGRf
d20tPndtWzFdLnBsYW5lX3Jlc19iLAorCQkJCSAgICBvbGRfcGxhbmVfcmVzX2IsIG9sZF93bS0+
d21bMV0ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG9sZF93bS0+d21bMl0ucGxhbmVfcmVzX2IsIG9s
ZF93bS0+d21bM10ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG9sZF93bS0+d21bNF0ucGxhbmVfcmVz
X2IsIG9sZF93bS0+d21bNV0ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG9sZF93bS0+d21bNl0ucGxh
bmVfcmVzX2IsIG9sZF93bS0+d21bN10ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG9sZF93bS0+dHJh
bnNfd20ucGxhbmVfcmVzX2IsCi0JCQkJICAgIG5ld193bS0+d21bMF0ucGxhbmVfcmVzX2IsIG5l
d193bS0+d21bMV0ucGxhbmVfcmVzX2IsCisJCQkJICAgIG5ld19wbGFuZV9yZXNfYiwgbmV3X3dt
LT53bVsxXS5wbGFuZV9yZXNfYiwKIAkJCQkgICAgbmV3X3dtLT53bVsyXS5wbGFuZV9yZXNfYiwg
bmV3X3dtLT53bVszXS5wbGFuZV9yZXNfYiwKIAkJCQkgICAgbmV3X3dtLT53bVs0XS5wbGFuZV9y
ZXNfYiwgbmV3X3dtLT53bVs1XS5wbGFuZV9yZXNfYiwKIAkJCQkgICAgbmV3X3dtLT53bVs2XS5w
bGFuZV9yZXNfYiwgbmV3X3dtLT53bVs3XS5wbGFuZV9yZXNfYiwKQEAgLTU2NjMsMTIgKzU5MDUs
MTIgQEAgc2tsX3ByaW50X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUpCiAJCQkJICAgICJbUExBTkU6JWQ6JXNdIG1pbl9kZGIgJTRkLCU0ZCwlNGQsJTRkLCU0ZCwl
NGQsJTRkLCU0ZCwlNGQiCiAJCQkJICAgICIgLT4gJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRk
LCU0ZCwlNGRcbiIsCiAJCQkJICAgIHBsYW5lLT5iYXNlLmJhc2UuaWQsIHBsYW5lLT5iYXNlLm5h
bWUsCi0JCQkJICAgIG9sZF93bS0+d21bMF0ubWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVsxXS5t
aW5fZGRiX2FsbG9jLAorCQkJCSAgICBvbGRfbWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVsxXS5t
aW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRfd20tPndtWzJdLm1pbl9kZGJfYWxsb2MsIG9sZF93
bS0+d21bM10ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgb2xkX3dtLT53bVs0XS5taW5fZGRiX2Fs
bG9jLCBvbGRfd20tPndtWzVdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG9sZF93bS0+d21bNl0u
bWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVs3XS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRf
d20tPnRyYW5zX3dtLm1pbl9kZGJfYWxsb2MsCi0JCQkJICAgIG5ld193bS0+d21bMF0ubWluX2Rk
Yl9hbGxvYywgbmV3X3dtLT53bVsxXS5taW5fZGRiX2FsbG9jLAorCQkJCSAgICBuZXdfbWluX2Rk
Yl9hbGxvYywgbmV3X3dtLT53bVsxXS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBuZXdfd20tPndt
WzJdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+d21bM10ubWluX2RkYl9hbGxvYywKIAkJCQkgICAg
bmV3X3dtLT53bVs0XS5taW5fZGRiX2FsbG9jLCBuZXdfd20tPndtWzVdLm1pbl9kZGJfYWxsb2Ms
CiAJCQkJICAgIG5ld193bS0+d21bNl0ubWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVs3XS5taW5f
ZGRiX2FsbG9jLApAQCAtNTgyOSw2ICs2MDcxLDEwIEBAIHNrbF9jb21wdXRlX3dtKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJcmV0dXJuIHJldDsKIAl9CiAKKwlyZXQgPSBp
bnRlbF9jb21wdXRlX3NhZ3ZfbWFzayhzdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsK
KwogCXJldCA9IHNrbF9jb21wdXRlX2RkYihzdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJl
dDsKQEAgLTU5NjAsNiArNjIwNiw5IEBAIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCXZhbCA9IEk5MTVfUkVBRChDVVJfV00ocGlwZSwg
bGV2ZWwpKTsKIAogCQkJc2tsX3dtX2xldmVsX2Zyb21fcmVnX3ZhbCh2YWwsICZ3bS0+d21bbGV2
ZWxdKTsKKwkJCWlmIChsZXZlbCA9PSAwKQorCQkJCW1lbWNweSgmd20tPnNhZ3Zfd20wLCAmd20t
PndtW2xldmVsXSwKKwkJCQkgICAgICAgc2l6ZW9mKHN0cnVjdCBza2xfd21fbGV2ZWwpKTsKIAkJ
fQogCiAJCWlmIChwbGFuZV9pZCAhPSBQTEFORV9DVVJTT1IpCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0u
aAppbmRleCBkNjBhODU0MjFjNWEuLjY1NzQzYTRjYmNmNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9w
bS5oCkBAIC00Miw2ICs0Miw3IEBAIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogdm9pZCBnNHhfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgdmx2X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7CiBib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7Citib29sIGludGVsX2hhc19zYWd2KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBpbnQgaW50ZWxfZW5hYmxlX3NhZ3Yoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIGludCBpbnRlbF9kaXNhYmxlX3NhZ3Yoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIGJvb2wgc2tsX3dtX2xldmVsX2VxdWFs
cyhjb25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpsMSwKLS0gCjIuMjQuMS40ODUuZ2FkMDVhM2Q4
ZTUKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

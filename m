Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A48E8DB14C
	for <lists+intel-gfx@lfdr.de>; Thu, 17 Oct 2019 17:42:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 277D66EABD;
	Thu, 17 Oct 2019 15:42:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E03606EABD
 for <intel-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 15:42:18 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18871812-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 16:42:14 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 17 Oct 2019 16:42:07 +0100
Message-Id: <20191017154208.20128-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 1/2] drm/i915/execlists: Don't merely skip
 submission if maybe timeslicing
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm9ybWFsbHksIHdlIHRyeSBhbmQgc2tpcCBzdWJtaXNzaW9uIGlmIEVMU1BbMV0gaXMgZmlsbGVk
LiBIb3dldmVyLCB3ZQptYXkgZGVzaXJlIHRvIGVuYWJsZSB0aW1lc2xpY2luZyBkdWUgdG8gdGhl
IHF1ZXVlIHByaW9yaXR5LCBldmVuIGlmCkVMU1BbMV0gaXRzZWxmIGRvZXMgbm90IHJlcXVpcmUg
dGltZXNsaWNpbmcuIFRoYXQgaXMgdGhlIHF1ZXVlIGlzIGVxdWFsCnByaW9yaXR5IHRvIEVMU1Bb
MF0gYW5kIGhpZ2hlciBwcmlvcml0eSB0aGVuIEVMU1BbMV0uIFByZXZpb3VzbHksIHdlCndvdWxk
IHdhaXQgdW50aWwgdGhlIGNvbnRleHQgc3dpdGNoIHRvIHByZWVtcHQgdGhlIGN1cnJlbnQgRUxT
UFsxXSwgYnV0CndpdGggdGltZXNsaWNpbmcsIHdlIHdhbnQgdG8gcHJlZW1wdCBFTFNQWzBdIGFu
ZCByZXBsYWNlIGl0IHdpdGggdGhlCnF1ZXVlLgoKSW4gd3JpdGluZyB0aGUgdGVzdCBjYXNlLCBp
dCBiZWNvbWUgcXVpY2tseSBhcHBhcmVudCB0aGF0IHdlIHdlcmUgYWxzbwpzdXBwcmVzc2luZyB0
aGUgdGFza2xldCBkdXJpbmcgcHJvbW90aW9uIGFuZCBzbyBmYWlsaW5nIHRvIG5vdGljZSB3aGVu
CnRoZSBxdWV1ZSBzdGFydGVkIHJlcXVpcmluZyB0aW1lc2xpY2luZy4KCkZpeGVzOiAyMjI5YWRj
ODEzODAgKCJkcm0vaTkxNS9leGVjbGlzdDogVHJpbSBpbW1lZGlhdGUgdGltZXNsaWNlIGV4cGly
eSIpClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICB8ICAyMiArKystCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyB8IDE2NCArKysrKysrKysrKysrKysrKysrKysr
KystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jICB8ICAxNyArKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmggIHwgIDE4IC0tLQogNCBmaWxlcyBj
aGFuZ2VkLCAxOTIgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwppbmRleCBlOWZlOWY3OWNlZGQuLmQwMDg4ZDAyMDIyMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTM1MiwxMCArMzUyLDE1IEBAIHN0YXRpYyBp
bmxpbmUgYm9vbCBuZWVkX3ByZWVtcHQoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCSAqIEhvd2V2ZXIsIHRoZSBwcmlvcml0eSBoaW50IGlzIGEgbWVyZSBoaW50IHRoYXQg
d2UgbWF5IG5lZWQgdG8KIAkgKiBwcmVlbXB0LiBJZiB0aGF0IGhpbnQgaXMgc3RhbGUgb3Igd2Ug
bWF5IGJlIHRyeWluZyB0byBwcmVlbXB0CiAJICogb3Vyc2VsdmVzLCBpZ25vcmUgdGhlIHJlcXVl
c3QuCisJICoKKwkgKiBNb3JlIG5hdHVyYWxseSB3ZSB3b3VsZCB3cml0ZQorCSAqICAgICAgcHJp
byA+PSBtYXgoMCwgbGFzdCk7CisJICogZXhjZXB0IHRoYXQgd2Ugd2lzaCB0byBwcmV2ZW50IHRy
aWdnZXJpbmcgcHJlZW1wdGlvbiBhdCB0aGUgc2FtZQorCSAqIHByaW9yaXR5IGxldmVsOiB0aGUg
dGFzayB0aGF0IGlzIHJ1bm5pbmcgc2hvdWxkIHJlbWFpbiBydW5uaW5nCisJICogdG8gcHJlc2Vy
dmUgRklGTyBvcmRlcmluZyBvZiBkZXBlbmRlbmNpZXMuCiAJICovCi0JbGFzdF9wcmlvID0gZWZm
ZWN0aXZlX3ByaW8ocnEpOwotCWlmICghaTkxNV9zY2hlZHVsZXJfbmVlZF9wcmVlbXB0KGVuZ2lu
ZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQsCi0JCQkJCSBsYXN0X3ByaW8pKQorCWxh
c3RfcHJpbyA9IG1heChlZmZlY3RpdmVfcHJpbyhycSksIEk5MTVfUFJJT1JJVFlfTk9STUFMIC0g
MSk7CisJaWYgKGVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgPD0gbGFzdF9w
cmlvKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKgpAQCAtMTUwOSw4ICsxNTE0LDE3IEBAIHN0YXRp
YyB2b2lkIGV4ZWNsaXN0c19kZXF1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAkJCSAqIHN1Ym1pc3Npb24uCiAJCQkgKi8KIAkJCWlmICghbGlzdF9pc19sYXN0KCZsYXN0LT5z
Y2hlZC5saW5rLAotCQkJCQkgICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cykpCisJCQkJCSAgJmVu
Z2luZS0+YWN0aXZlLnJlcXVlc3RzKSkgeworCQkJCS8qCisJCQkJICogRXZlbiBpZiBFTFNQWzFd
IGlzIG9jY3VwaWVkIGFuZCBub3Qgd29ydGh5CisJCQkJICogb2YgdGltZXNsaWNlcywgb3VyIHF1
ZXVlIG1pZ2h0IGJlLgorCQkJCSAqLworCQkJCWlmICghZXhlY2xpc3RzLT50aW1lci5leHBpcmVz
ICYmCisJCQkJICAgIG5lZWRfdGltZXNsaWNlKGVuZ2luZSwgbGFzdCkpCisJCQkJCW1vZF90aW1l
cigmZXhlY2xpc3RzLT50aW1lciwKKwkJCQkJCSAgamlmZmllcyArIDEpOwogCQkJCXJldHVybjsK
KwkJCX0KIAogCQkJLyoKIAkJCSAqIFdhSWRsZUxpdGVSZXN0b3JlOmJkdyxza2wKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggMjg2ODM3MWM2MDllLi41YmNmZTRhMjQ2
NmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0zMjUsNyArMzI1
LDEzIEBAIHNlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQogCWlmIChJU19FUlIocnEpKQogCQlnb3RvIG91
dF9jdHg7CiAKLQllcnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWVy
ciA9IDA7CisJaWYgKHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQorCQllcnIgPSBy
cS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYihycSk7CisJaWYgKGVyciA9PSAwKQorCQll
cnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWlmIChlcnIgPT0gMCkK
KwkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJaWYgKGVy
cikKIAkJcnEgPSBFUlJfUFRSKGVycik7CkBAIC0zMzgsMTAgKzM0NCwxMCBAQCBzZW1hcGhvcmVf
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgaW50IGlkeCkKIHN0YXRpYyBpbnQKIHJlbGVhc2VfcXVldWUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAogCSAgICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCSAgICAgIGludCBp
ZHgpCisJICAgICAgaW50IGlkeCwgaW50IHByaW8pCiB7CiAJc3RydWN0IGk5MTVfc2NoZWRfYXR0
ciBhdHRyID0gewotCQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklU
WV9NQVgpLAorCQkucHJpb3JpdHkgPSBwcmlvLAogCX07CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CiAJdTMyICpjczsKQEAgLTM2Miw5ICszNjgsMTUgQEAgcmVsZWFzZV9xdWV1ZShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJKmNzKysgPSAxOwogCiAJaW50ZWxfcmluZ19hZHZh
bmNlKHJxLCBjcyk7CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIAlpOTE1X3JlcXVlc3RfYWRk
KHJxKTsKIAorCWxvY2FsX2JoX2Rpc2FibGUoKTsKIAllbmdpbmUtPnNjaGVkdWxlKHJxLCAmYXR0
cik7CisJbG9jYWxfYmhfZW5hYmxlKCk7IC8qIGtpY2sgdGFza2xldCAqLworCisJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTM4Myw3ICszOTUsNiBAQCBzbGljZV9z
ZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqb3V0ZXIsCiAJaWYgKElTX0VS
UihoZWFkKSkKIAkJcmV0dXJuIFBUUl9FUlIoaGVhZCk7CiAKLQlpOTE1X3JlcXVlc3RfZ2V0KGhl
YWQpOwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIG91dGVyLT5pOTE1LCBpZCkgewogCQlmb3Ig
KGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBA
IC0zOTMsMTAgKzQwNCwxMiBAQCBzbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqb3V0ZXIsCiAJCQkJZXJyID0gUFRSX0VSUihycSk7CiAJCQkJZ290byBvdXQ7CiAJ
CQl9CisKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQl9CiAJfQogCi0JZXJyID0gcmVsZWFz
ZV9xdWV1ZShvdXRlciwgdm1hLCBuKTsKKwllcnIgPSByZWxlYXNlX3F1ZXVlKG91dGVyLCB2bWEs
IG4sIElOVF9NQVgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCkBAIC00ODIsNiArNDk1LDE0
NiBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCXJldHVy
biBlcnI7CiB9CiAKK3N0YXRpYyBpbnQgbm9wX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJcnEgPSBpOTE1X3Jl
cXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCWlmIChJU19FUlIocnEpKQor
CQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIHZvaWQgd2FpdF9mb3Jfc3VibWl0KHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKK3sKKwlkbyB7CisJCWNvbmRfcmVzY2hlZCgpOworCQlpbnRlbF9lbmdpbmVf
Zmx1c2hfc3VibWlzc2lvbihlbmdpbmUpOworCX0gd2hpbGUgKFJFQURfT05DRShlbmdpbmUtPmV4
ZWNsaXN0cy5wZW5kaW5nWzBdKSk7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcXVl
dWUodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdm9p
ZCAqdmFkZHI7CisJaW50IGVyciA9IDA7CisKKwkvKgorCSAqIE1ha2Ugc3VyZSB0aGF0IGV2ZW4g
aWYgRUxTUFswXSBhbmQgRUxTUFsxXSBhcmUgZmlsbGVkIHdpdGgKKwkgKiB0aW1lc2xpY2luZyBi
ZXR3ZWVuIHRoZW0gZGlzYWJsZWQsIHdlICpkbyogZW5hYmxlIHRpbWVzbGljaW5nCisJICogaWYg
dGhlIHF1ZXVlIGRlbWFuZHMgaXQuIChOb3JtYWxseSwgd2UgZG8gbm90IHN1Ym1pdCBpZgorCSAq
IEVMU1BbMV0gaXMgYWxyZWFkeSBvY2N1cGllZCwgc28gbXVzdCByZWx5IG9uIHRpbWVzbGljaW5n
IHRvCisJICogZWplY3QgRUxTUFswXSBpbiBmYXZvdXIgb2YgdGhlIHF1ZXVlLikKKwkgKi8KKwor
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0la
RSk7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VSUihvYmopOworCisJdm1hID0g
aTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJS
KHZtYSkpIHsKKwkJZXJyID0gUFRSX0VSUih2bWEpOworCQlnb3RvIGVycl9vYmo7CisJfQorCisJ
dmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dDKTsKKwlpZiAo
SVNfRVJSKHZhZGRyKSkgeworCQllcnIgPSBQVFJfRVJSKHZhZGRyKTsKKwkJZ290byBlcnJfb2Jq
OworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlm
IChlcnIpCisJCWdvdG8gZXJyX21hcDsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5p
OTE1LCBpZCkgeworCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7CisJCQkucHJpb3Jp
dHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9NQVgpLAorCQl9OworCQlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKworCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlv
bihlbmdpbmUpKQorCQkJY29udGludWU7CisKKwkJbWVtc2V0KHZhZGRyLCAwLCBQQUdFX1NJWkUp
OworCisJCS8qIEVMU1BbMF06IHNlbWFwaG9yZSB3YWl0ICovCisJCXJxID0gc2VtYXBob3JlX3F1
ZXVlKGVuZ2luZSwgdm1hLCAwKTsKKwkJaWYgKElTX0VSUihycSkpIHsKKwkJCWVyciA9IFBUUl9F
UlIocnEpOworCQkJZ290byBlcnJfcGluOworCQl9CisJCWVuZ2luZS0+c2NoZWR1bGUocnEsICZh
dHRyKTsKKwkJd2FpdF9mb3Jfc3VibWl0KGVuZ2luZSk7CisKKwkJLyogRUxTUFsxXTogbm9wIHJl
cXVlc3QgKi8KKwkJZXJyID0gbm9wX3JlcXVlc3QoZW5naW5lKTsKKwkJaWYgKGVycikgeworCQkJ
aTkxNV9yZXF1ZXN0X3B1dChycSk7CisJCQlnb3RvIGVycl9waW47CisJCX0KKwkJd2FpdF9mb3Jf
c3VibWl0KGVuZ2luZSk7CisKKwkJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJx
KSk7CisJCUdFTV9CVUdfT04oZXhlY2xpc3RzX2FjdGl2ZSgmZW5naW5lLT5leGVjbGlzdHMpICE9
IHJxKTsKKworCQkvKiBRdWV1ZTogc2VtYXBob3JlIHNpZ25hbCwgbWF0Y2hpbmcgcHJpb3JpdHkg
YXMgc2VtYXBob3JlICovCisJCWVyciA9IHJlbGVhc2VfcXVldWUoZW5naW5lLCB2bWEsIDEsIGVm
ZmVjdGl2ZV9wcmlvKHJxKSk7CisJCWlmIChlcnIpIHsKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEp
OworCQkJZ290byBlcnJfcGluOworCQl9CisKKwkJaW50ZWxfZW5naW5lX2ZsdXNoX3N1Ym1pc3Np
b24oZW5naW5lKTsKKwkJaWYgKCFSRUFEX09OQ0UoZW5naW5lLT5leGVjbGlzdHMudGltZXIuZXhw
aXJlcykgJiYKKwkJICAgICFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkgeworCQkJc3RydWN0
IGRybV9wcmludGVyIHAgPQorCQkJCWRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYp
OworCisJCQlHRU1fVFJBQ0VfRVJSKCIlczogRmFpbGVkIHRvIGVuYWJsZSB0aW1lc2xpY2luZyFc
biIsCisJCQkJICAgICAgZW5naW5lLT5uYW1lKTsKKwkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2lu
ZSwgJnAsCisJCQkJCSAgIiVzXG4iLCBlbmdpbmUtPm5hbWUpOworCQkJR0VNX1RSQUNFX0RVTVAo
KTsKKworCQkJbWVtc2V0KHZhZGRyLCAweGZmLCBQQUdFX1NJWkUpOworCQkJZXJyID0gLUVJTlZB
TDsKKwkJfQorCisJCS8qIFRpbWVzbGljZSBldmVyeSBqaWZmaWUsIHNvIHdpdGhpbiAyIHdlIHNo
b3VsZCBzaWduYWwgKi8KKwkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCAzKSA8IDApIHsK
KwkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0KKwkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1
LT5kcm0uZGV2KTsKKworCQkJcHJfZXJyKCIlczogRmFpbGVkIHRvIHRpbWVzbGljZSBpbnRvIHF1
ZXVlXG4iLAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSk7CisJCQlpbnRlbF9lbmdpbmVfZHVtcChl
bmdpbmUsICZwLAorCQkJCQkgICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKKworCQkJbWVtc2V0KHZh
ZGRyLCAweGZmLCBQQUdFX1NJWkUpOworCQkJZXJyID0gLUVJTzsKKwkJfQorCQlpOTE1X3JlcXVl
c3RfcHV0KHJxKTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCX0KKworCitlcnJfcGluOgorCWk5
MTVfdm1hX3VucGluKHZtYSk7CitlcnJfbWFwOgorCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAo
b2JqKTsKK2Vycl9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXJldHVybiBlcnI7
Cit9CisKIHN0YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIHsKIAlz
dHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwpAQCAtMjQzNyw2ICsyNTkwLDcgQEAgaW50IGludGVs
X2V4ZWNsaXN0c19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IAkJU1VCVEVTVChsaXZlX3VubGl0ZV9zd2l0Y2gpLAogCQlTVUJURVNUKGxpdmVfdW5saXRlX3By
ZWVtcHQpLAogCQlTVUJURVNUKGxpdmVfdGltZXNsaWNlX3ByZWVtcHQpLAorCQlTVUJURVNUKGxp
dmVfdGltZXNsaWNlX3F1ZXVlKSwKIAkJU1VCVEVTVChsaXZlX2J1c3l3YWl0X3ByZWVtcHQpLAog
CQlTVUJURVNUKGxpdmVfcHJlZW1wdCksCiAJCVNVQlRFU1QobGl2ZV9sYXRlX3ByZWVtcHQpLApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMKaW5kZXggN2I4NGViY2EyOTAxLi4wY2E0
MGY2YmYwOGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVy
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYwpAQCAtMTc3LDkg
KzE3NywyMiBAQCBzdGF0aWMgaW5saW5lIGludCBycV9wcmlvKGNvbnN0IHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxKQogCXJldHVybiBycS0+c2NoZWQuYXR0ci5wcmlvcml0eSB8IF9fTk9fUFJFRU1Q
VElPTjsKIH0KIAorc3RhdGljIGlubGluZSBib29sIG5lZWRfcHJlZW1wdChpbnQgcHJpbywgaW50
IGFjdGl2ZSkKK3sKKwkvKgorCSAqIEFsbG93IHByZWVtcHRpb24gb2YgbG93IC0+IG5vcm1hbCAt
PiBoaWdoLCBidXQgd2UgZG8KKwkgKiBub3QgYWxsb3cgbG93IHByaW9yaXR5IHRhc2tzIHRvIHBy
ZWVtcHQgb3RoZXIgbG93IHByaW9yaXR5CisJICogdGFza3MgdW5kZXIgdGhlIGltcHJlc3Npb24g
dGhhdCBsYXRlbmN5IGZvciBsb3cgcHJpb3JpdHkKKwkgKiB0YXNrcyBkb2VzIG5vdCBtYXR0ZXIg
KGFzIG11Y2ggYXMgYmFja2dyb3VuZCB0aHJvdWdocHV0KSwKKwkgKiBzbyBraXNzLgorCSAqLwor
CXJldHVybiBwcmlvID49IG1heChJOTE1X1BSSU9SSVRZX05PUk1BTCwgYWN0aXZlKTsKK30KKwog
c3RhdGljIHZvaWQga2lja19zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSwgaW50IHByaW8pCiB7Ci0JY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqaW5mbGlnaHQgPSAq
ZW5naW5lLT5leGVjbGlzdHMuYWN0aXZlOworCWNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKmlu
ZmxpZ2h0ID0KKwkJZXhlY2xpc3RzX2FjdGl2ZSgmZW5naW5lLT5leGVjbGlzdHMpOwogCiAJLyoK
IAkgKiBJZiB3ZSBhcmUgYWxyZWFkeSB0aGUgY3VycmVudGx5IGV4ZWN1dGluZyBjb250ZXh0LCBk
b24ndApAQCAtMTg4LDcgKzIwMSw3IEBAIHN0YXRpYyB2b2lkIGtpY2tfc3VibWlzc2lvbihzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGludCBwcmlvKQogCSAqIHRhc2tsZXQsIGkuZS4g
d2UgaGF2ZSBub3QgY2hhbmdlIHRoZSBwcmlvcml0eSBxdWV1ZQogCSAqIHN1ZmZpY2llbnRseSB0
byBvdXN0IHRoZSBydW5uaW5nIGNvbnRleHQuCiAJICovCi0JaWYgKCFpbmZsaWdodCB8fCAhaTkx
NV9zY2hlZHVsZXJfbmVlZF9wcmVlbXB0KHByaW8sIHJxX3ByaW8oaW5mbGlnaHQpKSkKKwlpZiAo
IWluZmxpZ2h0IHx8ICFuZWVkX3ByZWVtcHQocHJpbywgcnFfcHJpbyhpbmZsaWdodCkpKQogCQly
ZXR1cm47CiAKIAl0YXNrbGV0X2hpX3NjaGVkdWxlKCZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5oCmluZGV4IDdlZWZjY2ZmMzliZi4u
MDdkMjQzYWNmNTUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVk
dWxlci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmgKQEAgLTUy
LDIyICs1Miw0IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ByaW9saXN0X2ZyZWUoc3RydWN0
IGk5MTVfcHJpb2xpc3QgKnApCiAJCV9faTkxNV9wcmlvbGlzdF9mcmVlKHApOwogfQogCi1zdGF0
aWMgaW5saW5lIGJvb2wgaTkxNV9zY2hlZHVsZXJfbmVlZF9wcmVlbXB0KGludCBwcmlvLCBpbnQg
YWN0aXZlKQotewotCS8qCi0JICogQWxsb3cgcHJlZW1wdGlvbiBvZiBsb3cgLT4gbm9ybWFsIC0+
IGhpZ2gsIGJ1dCB3ZSBkbwotCSAqIG5vdCBhbGxvdyBsb3cgcHJpb3JpdHkgdGFza3MgdG8gcHJl
ZW1wdCBvdGhlciBsb3cgcHJpb3JpdHkKLQkgKiB0YXNrcyB1bmRlciB0aGUgaW1wcmVzc2lvbiB0
aGF0IGxhdGVuY3kgZm9yIGxvdyBwcmlvcml0eQotCSAqIHRhc2tzIGRvZXMgbm90IG1hdHRlciAo
YXMgbXVjaCBhcyBiYWNrZ3JvdW5kIHRocm91Z2hwdXQpLAotCSAqIHNvIGtpc3MuCi0JICoKLQkg
KiBNb3JlIG5hdHVyYWxseSB3ZSB3b3VsZCB3cml0ZQotCSAqCXByaW8gPj0gbWF4KDAsIGxhc3Qp
OwotCSAqIGV4Y2VwdCB0aGF0IHdlIHdpc2ggdG8gcHJldmVudCB0cmlnZ2VyaW5nIHByZWVtcHRp
b24gYXQgdGhlIHNhbWUKLQkgKiBwcmlvcml0eSBsZXZlbDogdGhlIHRhc2sgdGhhdCBpcyBydW5u
aW5nIHNob3VsZCByZW1haW4gcnVubmluZwotCSAqIHRvIHByZXNlcnZlIEZJRk8gb3JkZXJpbmcg
b2YgZGVwZW5kZW5jaWVzLgotCSAqLwotCXJldHVybiBwcmlvID4gbWF4KEk5MTVfUFJJT1JJVFlf
Tk9STUFMIC0gMSwgYWN0aXZlKTsKLX0KLQogI2VuZGlmIC8qIF9JOTE1X1NDSEVEVUxFUl9IXyAq
LwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
Zng=

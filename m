Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 90B6C8649C
	for <lists+intel-gfx@lfdr.de>; Thu,  8 Aug 2019 16:45:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0C18A6E855;
	Thu,  8 Aug 2019 14:45:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B56BB6E855
 for <intel-gfx@lists.freedesktop.org>; Thu,  8 Aug 2019 14:45:15 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17932247-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 08 Aug 2019 15:45:12 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  8 Aug 2019 15:45:11 +0100
Message-Id: <20190808144511.32269-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915: Only include active engines in the
 capture state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2tpcCBwcmludGluZyBvdXQgaWRsZSBlbmdpbmVzIHRoYXQgZGlkIG5vdCBjb250cmlidXRlIHRv
IHRoZSBHUFUgaGFuZy4KQXMgdGhlIG51bWJlciBvZiBlbmdpbmVzIGdldHMgZXZlciBsYXJnZXIs
IHdlIGhhdmUgaW5jcmVhc2luZyBub2lzZSBpbgp0aGUgZXJyb3Igc3RhdGUgd2hlcmUgdHlwaWNh
bGx5IHRoZXJlIGlzIG9ubHkgb25lIGd1aWx0eSByZXF1ZXN0IG9uIG9uZQplbmdpbmUgdGhhdCB3
ZSBuZWVkIHRvIGluc3BlY3QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNo
cmlzLXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxk
QGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jIHwg
MjM4ICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dwdV9lcnJvci5oIHwgICA3ICstCiAyIGZpbGVzIGNoYW5nZWQsIDEwNCBpbnNlcnRpb25zKCsp
LCAxNDEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9ncHVfZXJyb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKaW5k
ZXggY2ZlMGM0MmRkZWZiLi43NTM2MjgxNTU3ZjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
cHVfZXJyb3IuYwpAQCAtNDksMjcgKzQ5LDYgQEAKICNkZWZpbmUgQUxMT1dfRkFJTCAoR0ZQX0tF
Uk5FTCB8IF9fR0ZQX1JFVFJZX01BWUZBSUwgfCBfX0dGUF9OT1dBUk4pCiAjZGVmaW5lIEFUT01J
Q19NQVlGQUlMIChHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKQogCi1zdGF0aWMgaW5saW5lIGNv
bnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgotZW5naW5lX2xvb2t1cChjb25zdCBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQgaW50IGlkKQotewotCWlmIChpZCA+PSBJ
OTE1X05VTV9FTkdJTkVTKQotCQlyZXR1cm4gTlVMTDsKLQotCXJldHVybiBpOTE1LT5lbmdpbmVb
aWRdOwotfQotCi1zdGF0aWMgaW5saW5lIGNvbnN0IGNoYXIgKgotX19lbmdpbmVfbmFtZShjb25z
dCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JcmV0dXJuIGVuZ2luZSA/IGVu
Z2luZS0+bmFtZSA6ICIiOwotfQotCi1zdGF0aWMgY29uc3QgY2hhciAqCi1lbmdpbmVfbmFtZShj
b25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQgaW50IGlkKQotewot
CXJldHVybiBfX2VuZ2luZV9uYW1lKGVuZ2luZV9sb29rdXAoaTkxNSwgaWQpKTsKLX0KLQogc3Rh
dGljIHZvaWQgX19zZ19zZXRfYnVmKHN0cnVjdCBzY2F0dGVybGlzdCAqc2csCiAJCQkgdm9pZCAq
YWRkciwgdW5zaWduZWQgaW50IGxlbiwgbG9mZl90IGl0KQogewpAQCAtNDQ3LDcgKzQyNiw3IEBA
IHN0YXRpYyB2b2lkIGVycm9yX3ByaW50X2luc3Rkb25lKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9z
dGF0ZV9idWYgKm0sCiAJZXJyX3ByaW50ZihtLCAiICBJTlNURE9ORTogMHglMDh4XG4iLAogCQkg
ICBlZS0+aW5zdGRvbmUuaW5zdGRvbmUpOwogCi0JaWYgKGVlLT5lbmdpbmVfaWQgIT0gUkNTMCB8
fCBJTlRFTF9HRU4obS0+aTkxNSkgPD0gMykKKwlpZiAoZWUtPmVuZ2luZS0+Y2xhc3MgIT0gUkVO
REVSX0NMQVNTIHx8IElOVEVMX0dFTihtLT5pOTE1KSA8PSAzKQogCQlyZXR1cm47CiAKIAllcnJf
cHJpbnRmKG0sICIgIFNDX0lOU1RET05FOiAweCUwOHhcbiIsCkBAIC01MDEsOCArNDgwLDcgQEAg
c3RhdGljIHZvaWQgZXJyb3JfcHJpbnRfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0
ZV9idWYgKm0sCiB7CiAJaW50IG47CiAKLQllcnJfcHJpbnRmKG0sICIlcyBjb21tYW5kIHN0cmVh
bTpcbiIsCi0JCSAgIGVuZ2luZV9uYW1lKG0tPmk5MTUsIGVlLT5lbmdpbmVfaWQpKTsKKwllcnJf
cHJpbnRmKG0sICIlcyBjb21tYW5kIHN0cmVhbTpcbiIsIGVlLT5lbmdpbmUtPm5hbWUpOwogCWVy
cl9wcmludGYobSwgIiAgSURMRT86ICVzXG4iLCB5ZXNubyhlZS0+aWRsZSkpOwogCWVycl9wcmlu
dGYobSwgIiAgU1RBUlQ6IDB4JTA4eFxuIiwgZWUtPnN0YXJ0KTsKIAllcnJfcHJpbnRmKG0sICIg
IEhFQUQ6ICAweCUwOHggWzB4JTA4eF1cbiIsIGVlLT5oZWFkLCBlZS0+cnFfaGVhZCk7CkBAIC01
NzgsOSArNTU2LDkgQEAgdm9pZCBpOTE1X2Vycm9yX3ByaW50ZihzdHJ1Y3QgZHJtX2k5MTVfZXJy
b3Jfc3RhdGVfYnVmICplLCBjb25zdCBjaGFyICpmLCAuLi4pCiB9CiAKIHN0YXRpYyB2b2lkIHBy
aW50X2Vycm9yX29iaihzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICptLAotCQkJICAg
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgICAgY29uc3QgY2hhciAqbmFtZSwKLQkJCSAgICBz
dHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICpvYmopCisJCQkgICAgY29uc3Qgc3RydWN0IGRy
bV9pOTE1X2Vycm9yX29iamVjdCAqb2JqKQogewogCWNoYXIgb3V0W0FTQ0lJODVfQlVGU1pdOwog
CWludCBwYWdlOwpAQCAtNjc3LDcgKzY1NSw3IEBAIHN0YXRpYyB2b2lkIGVycl9mcmVlX3NnbChz
dHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnbCkKIHN0YXRpYyB2b2lkIF9fZXJyX3ByaW50X3RvX3NnbChz
dHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICptLAogCQkJICAgICAgIHN0cnVjdCBpOTE1
X2dwdV9zdGF0ZSAqZXJyb3IpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqb2Jq
OworCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9lcnJvcl9lbmdpbmUgKmVlOwogCXN0cnVjdCB0aW1l
c3BlYzY0IHRzOwogCWludCBpLCBqOwogCkBAIC03MDIsMTUgKzY4MCwxMiBAQCBzdGF0aWMgdm9p
ZCBfX2Vycl9wcmludF90b19zZ2woc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqbSwK
IAkJICAgamlmZmllc190b19tc2VjcyhqaWZmaWVzIC0gZXJyb3ItPmNhcHR1cmUpLAogCQkgICBq
aWZmaWVzX3RvX21zZWNzKGVycm9yLT5jYXB0dXJlIC0gZXJyb3ItPmVwb2NoKSk7CiAKLQlmb3Ig
KGkgPSAwOyBpIDwgQVJSQVlfU0laRShlcnJvci0+ZW5naW5lKTsgaSsrKSB7Ci0JCWlmICghZXJy
b3ItPmVuZ2luZVtpXS5jb250ZXh0LnBpZCkKLQkJCWNvbnRpbnVlOwotCisJZm9yIChlZSA9IGVy
cm9yLT5lbmdpbmU7IGVlOyBlZSA9IGVlLT5uZXh0KQogCQllcnJfcHJpbnRmKG0sICJBY3RpdmUg
cHJvY2VzcyAob24gcmluZyAlcyk6ICVzIFslZF1cbiIsCi0JCQkgICBlbmdpbmVfbmFtZShtLT5p
OTE1LCBpKSwKLQkJCSAgIGVycm9yLT5lbmdpbmVbaV0uY29udGV4dC5jb21tLAotCQkJICAgZXJy
b3ItPmVuZ2luZVtpXS5jb250ZXh0LnBpZCk7Ci0JfQorCQkJICAgZWUtPmVuZ2luZS0+bmFtZSwK
KwkJCSAgIGVlLT5jb250ZXh0LmNvbW0sCisJCQkgICBlZS0+Y29udGV4dC5waWQpOworCiAJZXJy
X3ByaW50ZihtLCAiUmVzZXQgY291bnQ6ICV1XG4iLCBlcnJvci0+cmVzZXRfY291bnQpOwogCWVy
cl9wcmludGYobSwgIlN1c3BlbmQgY291bnQ6ICV1XG4iLCBlcnJvci0+c3VzcGVuZF9jb3VudCk7
CiAJZXJyX3ByaW50ZihtLCAiUGxhdGZvcm06ICVzXG4iLCBpbnRlbF9wbGF0Zm9ybV9uYW1lKGVy
cm9yLT5kZXZpY2VfaW5mby5wbGF0Zm9ybSkpOwpAQCAtNzU4LDE3ICs3MzMsMTUgQEAgc3RhdGlj
IHZvaWQgX19lcnJfcHJpbnRfdG9fc2dsKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYg
Km0sCiAJaWYgKElTX0dFTihtLT5pOTE1LCA3KSkKIAkJZXJyX3ByaW50ZihtLCAiRVJSX0lOVDog
MHglMDh4XG4iLCBlcnJvci0+ZXJyX2ludCk7CiAKLQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0la
RShlcnJvci0+ZW5naW5lKTsgaSsrKSB7Ci0JCWlmIChlcnJvci0+ZW5naW5lW2ldLmVuZ2luZV9p
ZCAhPSAtMSkKLQkJCWVycm9yX3ByaW50X2VuZ2luZShtLCAmZXJyb3ItPmVuZ2luZVtpXSwgZXJy
b3ItPmVwb2NoKTsKLQl9CisJZm9yIChlZSA9IGVycm9yLT5lbmdpbmU7IGVlOyBlZSA9IGVlLT5u
ZXh0KQorCQllcnJvcl9wcmludF9lbmdpbmUobSwgZWUsIGVycm9yLT5lcG9jaCk7CiAKLQlmb3Ig
KGkgPSAwOyBpIDwgQVJSQVlfU0laRShlcnJvci0+ZW5naW5lKTsgaSsrKSB7Ci0JCWNvbnN0IHN0
cnVjdCBkcm1faTkxNV9lcnJvcl9lbmdpbmUgKmVlID0gJmVycm9yLT5lbmdpbmVbaV07CisJZm9y
IChlZSA9IGVycm9yLT5lbmdpbmU7IGVlOyBlZSA9IGVlLT5uZXh0KSB7CisJCWNvbnN0IHN0cnVj
dCBkcm1faTkxNV9lcnJvcl9vYmplY3QgKm9iajsKIAogCQlvYmogPSBlZS0+YmF0Y2hidWZmZXI7
CiAJCWlmIChvYmopIHsKLQkJCWVycl9wdXRzKG0sIG0tPmk5MTUtPmVuZ2luZVtpXS0+bmFtZSk7
CisJCQllcnJfcHV0cyhtLCBlZS0+ZW5naW5lLT5uYW1lKTsKIAkJCWlmIChlZS0+Y29udGV4dC5w
aWQpCiAJCQkJZXJyX3ByaW50ZihtLCAiIChzdWJtaXR0ZWQgYnkgJXMgWyVkXSkiLAogCQkJCQkg
ICBlZS0+Y29udGV4dC5jb21tLApAQCAtNzc2LDE2ICs3NDksMTUgQEAgc3RhdGljIHZvaWQgX19l
cnJfcHJpbnRfdG9fc2dsKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYgKm0sCiAJCQll
cnJfcHJpbnRmKG0sICIgLS0tIGd0dF9vZmZzZXQgPSAweCUwOHggJTA4eFxuIiwKIAkJCQkgICB1
cHBlcl8zMl9iaXRzKG9iai0+Z3R0X29mZnNldCksCiAJCQkJICAgbG93ZXJfMzJfYml0cyhvYmot
Pmd0dF9vZmZzZXQpKTsKLQkJCXByaW50X2Vycm9yX29iaihtLCBtLT5pOTE1LT5lbmdpbmVbaV0s
IE5VTEwsIG9iaik7CisJCQlwcmludF9lcnJvcl9vYmoobSwgZWUtPmVuZ2luZSwgTlVMTCwgb2Jq
KTsKIAkJfQogCiAJCWZvciAoaiA9IDA7IGogPCBlZS0+dXNlcl9ib19jb3VudDsgaisrKQotCQkJ
cHJpbnRfZXJyb3Jfb2JqKG0sIG0tPmk5MTUtPmVuZ2luZVtpXSwKLQkJCQkJInVzZXIiLCBlZS0+
dXNlcl9ib1tqXSk7CisJCQlwcmludF9lcnJvcl9vYmoobSwgZWUtPmVuZ2luZSwgInVzZXIiLCBl
ZS0+dXNlcl9ib1tqXSk7CiAKIAkJaWYgKGVlLT5udW1fcmVxdWVzdHMpIHsKIAkJCWVycl9wcmlu
dGYobSwgIiVzIC0tLSAlZCByZXF1ZXN0c1xuIiwKLQkJCQkgICBtLT5pOTE1LT5lbmdpbmVbaV0t
Pm5hbWUsCisJCQkJICAgZWUtPmVuZ2luZS0+bmFtZSwKIAkJCQkgICBlZS0+bnVtX3JlcXVlc3Rz
KTsKIAkJCWZvciAoaiA9IDA7IGogPCBlZS0+bnVtX3JlcXVlc3RzOyBqKyspCiAJCQkJZXJyb3Jf
cHJpbnRfcmVxdWVzdChtLCAiICIsCkBAIC03OTMsMjIgKzc2NSwxMyBAQCBzdGF0aWMgdm9pZCBf
X2Vycl9wcmludF90b19zZ2woc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqbSwKIAkJ
CQkJCSAgICBlcnJvci0+ZXBvY2gpOwogCQl9CiAKLQkJcHJpbnRfZXJyb3Jfb2JqKG0sIG0tPmk5
MTUtPmVuZ2luZVtpXSwKLQkJCQkicmluZ2J1ZmZlciIsIGVlLT5yaW5nYnVmZmVyKTsKLQotCQlw
cmludF9lcnJvcl9vYmoobSwgbS0+aTkxNS0+ZW5naW5lW2ldLAotCQkJCSJIVyBTdGF0dXMiLCBl
ZS0+aHdzX3BhZ2UpOwotCi0JCXByaW50X2Vycm9yX29iaihtLCBtLT5pOTE1LT5lbmdpbmVbaV0s
Ci0JCQkJIkhXIGNvbnRleHQiLCBlZS0+Y3R4KTsKLQotCQlwcmludF9lcnJvcl9vYmoobSwgbS0+
aTkxNS0+ZW5naW5lW2ldLAotCQkJCSJXQSBjb250ZXh0IiwgZWUtPndhX2N0eCk7Ci0KLQkJcHJp
bnRfZXJyb3Jfb2JqKG0sIG0tPmk5MTUtPmVuZ2luZVtpXSwKKwkJcHJpbnRfZXJyb3Jfb2JqKG0s
IGVlLT5lbmdpbmUsICJyaW5nYnVmZmVyIiwgZWUtPnJpbmdidWZmZXIpOworCQlwcmludF9lcnJv
cl9vYmoobSwgZWUtPmVuZ2luZSwgIkhXIFN0YXR1cyIsIGVlLT5od3NfcGFnZSk7CisJCXByaW50
X2Vycm9yX29iaihtLCBlZS0+ZW5naW5lLCAiSFcgY29udGV4dCIsIGVlLT5jdHgpOworCQlwcmlu
dF9lcnJvcl9vYmoobSwgZWUtPmVuZ2luZSwgIldBIGNvbnRleHQiLCBlZS0+d2FfY3R4KTsKKwkJ
cHJpbnRfZXJyb3Jfb2JqKG0sIGVlLT5lbmdpbmUsCiAJCQkJIldBIGJhdGNoYnVmZmVyIiwgZWUt
PndhX2JhdGNoYnVmZmVyKTsKLQotCQlwcmludF9lcnJvcl9vYmoobSwgbS0+aTkxNS0+ZW5naW5l
W2ldLAorCQlwcmludF9lcnJvcl9vYmoobSwgZWUtPmVuZ2luZSwKIAkJCQkiTlVMTCBjb250ZXh0
IiwgZWUtPmRlZmF1bHRfc3RhdGUpOwogCX0KIApAQCAtOTU3LDEzICs5MjAsMTUgQEAgdm9pZCBf
X2k5MTVfZ3B1X3N0YXRlX2ZyZWUoc3RydWN0IGtyZWYgKmVycm9yX3JlZikKIHsKIAlzdHJ1Y3Qg
aTkxNV9ncHVfc3RhdGUgKmVycm9yID0KIAkJY29udGFpbmVyX29mKGVycm9yX3JlZiwgdHlwZW9m
KCplcnJvciksIHJlZik7Ci0JbG9uZyBpLCBqOworCWxvbmcgaTsKIAotCWZvciAoaSA9IDA7IGkg
PCBBUlJBWV9TSVpFKGVycm9yLT5lbmdpbmUpOyBpKyspIHsKLQkJc3RydWN0IGRybV9pOTE1X2Vy
cm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVuZ2luZVtpXTsKKwl3aGlsZSAoZXJyb3ItPmVuZ2lu
ZSkgeworCQlzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5lICplZSA9IGVycm9yLT5lbmdpbmU7
CiAKLQkJZm9yIChqID0gMDsgaiA8IGVlLT51c2VyX2JvX2NvdW50OyBqKyspCi0JCQlpOTE1X2Vy
cm9yX29iamVjdF9mcmVlKGVlLT51c2VyX2JvW2pdKTsKKwkJZXJyb3ItPmVuZ2luZSA9IGVlLT5u
ZXh0OworCisJCWZvciAoaSA9IDA7IGkgPCBlZS0+dXNlcl9ib19jb3VudDsgaSsrKQorCQkJaTkx
NV9lcnJvcl9vYmplY3RfZnJlZShlZS0+dXNlcl9ib1tpXSk7CiAJCWtmcmVlKGVlLT51c2VyX2Jv
KTsKIAogCQlpOTE1X2Vycm9yX29iamVjdF9mcmVlKGVlLT5iYXRjaGJ1ZmZlcik7CkBAIC05NzQs
NiArOTM5LDcgQEAgdm9pZCBfX2k5MTVfZ3B1X3N0YXRlX2ZyZWUoc3RydWN0IGtyZWYgKmVycm9y
X3JlZikKIAkJaTkxNV9lcnJvcl9vYmplY3RfZnJlZShlZS0+d2FfY3R4KTsKIAogCQlrZnJlZShl
ZS0+cmVxdWVzdHMpOworCQlrZnJlZShlZSk7CiAJfQogCiAJa2ZyZWUoZXJyb3ItPm92ZXJsYXkp
OwpAQCAtMTA1NSwyMyArMTAyMSwxNyBAQCBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAgKgogICogSXQncyBvbmx5IGEgc21hbGwgc3RlcCBi
ZXR0ZXIgdGhhbiBhIHJhbmRvbSBudW1iZXIgaW4gaXRzIGN1cnJlbnQgZm9ybS4KICAqLwotc3Rh
dGljIHUzMiBpOTE1X2Vycm9yX2dlbmVyYXRlX2NvZGUoc3RydWN0IGk5MTVfZ3B1X3N0YXRlICpl
cnJvciwKLQkJCQkgICAgaW50ZWxfZW5naW5lX21hc2tfdCBlbmdpbmVfbWFzaykKK3N0YXRpYyB1
MzIgaTkxNV9lcnJvcl9nZW5lcmF0ZV9jb2RlKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3Ip
CiB7CisJY29uc3Qgc3RydWN0IGRybV9pOTE1X2Vycm9yX2VuZ2luZSAqZWUgPSBlcnJvci0+ZW5n
aW5lOworCiAJLyoKIAkgKiBJUEVIUiB3b3VsZCBiZSBhbiBpZGVhbCB3YXkgdG8gZGV0ZWN0IGVy
cm9ycywgYXMgaXQncyB0aGUgZ3Jvc3MKIAkgKiBtZWFzdXJlIG9mICJ0aGUgY29tbWFuZCB0aGF0
IGh1bmcuIiBIb3dldmVyLCBoYXMgc29tZSB2ZXJ5IGNvbW1vbgogCSAqIHN5bmNocm9uaXphdGlv
biBjb21tYW5kcyB3aGljaCBhbG1vc3QgYWx3YXlzIGFwcGVhciBpbiB0aGUgY2FzZQogCSAqIHN0
cmljdGx5IGEgY2xpZW50IGJ1Zy4gVXNlIGluc3Rkb25lIHRvIGRpZmZlcmVudGlhdGUgdGhvc2Ug
c29tZS4KIAkgKi8KLQlpZiAoZW5naW5lX21hc2spIHsKLQkJc3RydWN0IGRybV9pOTE1X2Vycm9y
X2VuZ2luZSAqZWUgPQotCQkJJmVycm9yLT5lbmdpbmVbZmZzKGVuZ2luZV9tYXNrKV07Ci0KLQkJ
cmV0dXJuIGVlLT5pcGVociBeIGVlLT5pbnN0ZG9uZS5pbnN0ZG9uZTsKLQl9Ci0KLQlyZXR1cm4g
MDsKKwlyZXR1cm4gZWUgPyBlZS0+aXBlaHIgXiBlZS0+aW5zdGRvbmUuaW5zdGRvbmUgOiAwOwog
fQogCiBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX2ZlbmNlcyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUg
KmVycm9yKQpAQCAtMTI4NSw5ICsxMjQ1LDExIEBAIHN0YXRpYyB2b2lkIGVycm9yX3JlY29yZF9l
bmdpbmVfZXhlY2xpc3RzKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAll
ZS0+bnVtX3BvcnRzID0gbjsKIH0KIAotc3RhdGljIHZvaWQgcmVjb3JkX2NvbnRleHQoc3RydWN0
IGRybV9pOTE1X2Vycm9yX2NvbnRleHQgKmUsCi0JCQkgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4KQorc3RhdGljIGJvb2wgcmVjb3JkX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X2Vycm9y
X2NvbnRleHQgKmUsCisJCQkgICBjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKKwlj
b25zdCBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gcnEtPmdlbV9jb250ZXh0OworCiAJ
aWYgKGN0eC0+cGlkKSB7CiAJCXN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzazsKIApAQCAtMTMwNCw2
ICsxMjY2LDggQEAgc3RhdGljIHZvaWQgcmVjb3JkX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X2Vy
cm9yX2NvbnRleHQgKmUsCiAJZS0+c2NoZWRfYXR0ciA9IGN0eC0+c2NoZWQ7CiAJZS0+Z3VpbHR5
ID0gYXRvbWljX3JlYWQoJmN0eC0+Z3VpbHR5X2NvdW50KTsKIAllLT5hY3RpdmUgPSBhdG9taWNf
cmVhZCgmY3R4LT5hY3RpdmVfY291bnQpOworCisJcmV0dXJuIGk5MTVfZ2VtX2NvbnRleHRfbm9f
ZXJyb3JfY2FwdHVyZShjdHgpOwogfQogCiBzdHJ1Y3QgY2FwdHVyZV92bWEgewpAQCAtMTM5OCw3
NCArMTM2Miw2NyBAQCBzdGF0aWMgdm9pZAogZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9n
cHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29tcHJlc3MgKmNvbXByZXNzKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gZXJyb3ItPmk5MTU7Ci0JaW50IGk7CisJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9lbmdpbmUgKmVl
OworCisJZWUgPSBremFsbG9jKHNpemVvZigqZWUpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWVlKQor
CQlyZXR1cm47CiAKLQlmb3IgKGkgPSAwOyBpIDwgSTkxNV9OVU1fRU5HSU5FUzsgaSsrKSB7Ci0J
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IGk5MTUtPmVuZ2luZVtpXTsKLQkJc3Ry
dWN0IGRybV9pOTE1X2Vycm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVuZ2luZVtpXTsKKwlmb3Jf
ZWFjaF91YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpIHsKIAkJc3RydWN0IGNhcHR1cmVfdm1hICpj
YXB0dXJlID0gTlVMTDsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKIAkJdW5zaWdu
ZWQgbG9uZyBmbGFnczsKIAotCQllZS0+ZW5naW5lX2lkID0gLTE7Ci0KLQkJaWYgKCFlbmdpbmUp
Ci0JCQljb250aW51ZTsKLQotCQllZS0+ZW5naW5lX2lkID0gaTsKLQogCQkvKiBSZWZpbGwgb3Vy
IHBhZ2UgcG9vbCBiZWZvcmUgZW50ZXJpbmcgYXRvbWljIHNlY3Rpb24gKi8KIAkJcG9vbF9yZWZp
bGwoJmNvbXByZXNzLT5wb29sLCBBTExPV19GQUlMKTsKIAotCQllcnJvcl9yZWNvcmRfZW5naW5l
X3JlZ2lzdGVycyhlcnJvciwgZW5naW5lLCBlZSk7Ci0JCWVycm9yX3JlY29yZF9lbmdpbmVfZXhl
Y2xpc3RzKGVuZ2luZSwgZWUpOwotCiAJCXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPmFjdGl2
ZS5sb2NrLCBmbGFncyk7CiAJCXJlcXVlc3QgPSBpbnRlbF9lbmdpbmVfZmluZF9hY3RpdmVfcmVx
dWVzdChlbmdpbmUpOwotCQlpZiAocmVxdWVzdCkgewotCQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCA9IHJlcXVlc3QtPmdlbV9jb250ZXh0OwotCQkJc3RydWN0IGludGVsX3JpbmcgKnJp
bmcgPSByZXF1ZXN0LT5yaW5nOwotCi0JCQlyZWNvcmRfY29udGV4dCgmZWUtPmNvbnRleHQsIGN0
eCk7Ci0KLQkJCS8qCi0JCQkgKiBXZSBuZWVkIHRvIGNvcHkgdGhlc2UgdG8gYW4gYW5vbnltb3Vz
IGJ1ZmZlcgotCQkJICogYXMgdGhlIHNpbXBsZXN0IG1ldGhvZCB0byBhdm9pZCBiZWluZyBvdmVy
d3JpdHRlbgotCQkJICogYnkgdXNlcnNwYWNlLgotCQkJICovCi0JCQljYXB0dXJlID0gY2FwdHVy
ZV92bWEoY2FwdHVyZSwKLQkJCQkJICAgICAgcmVxdWVzdC0+YmF0Y2gsCi0JCQkJCSAgICAgICZl
ZS0+YmF0Y2hidWZmZXIpOworCQlpZiAoIXJlcXVlc3QpIHsKKwkJCXNwaW5fdW5sb2NrX2lycXJl
c3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKKwkJCWNvbnRpbnVlOworCQl9CiAK
LQkJCWlmIChIQVNfQlJPS0VOX0NTX1RMQihpOTE1KSkKLQkJCQljYXB0dXJlID0gY2FwdHVyZV92
bWEoY2FwdHVyZSwKLQkJCQkJCSAgICAgIGVuZ2luZS0+Z3QtPnNjcmF0Y2gsCi0JCQkJCQkgICAg
ICAmZWUtPndhX2JhdGNoYnVmZmVyKTsKKwkJZXJyb3ItPnNpbXVsYXRlZCB8PSByZWNvcmRfY29u
dGV4dCgmZWUtPmNvbnRleHQsIHJlcXVlc3QpOwogCi0JCQljYXB0dXJlID0gcmVxdWVzdF9yZWNv
cmRfdXNlcl9ibyhyZXF1ZXN0LCBlZSwgY2FwdHVyZSk7CisJCS8qCisJCSAqIFdlIG5lZWQgdG8g
Y29weSB0aGVzZSB0byBhbiBhbm9ueW1vdXMgYnVmZmVyCisJCSAqIGFzIHRoZSBzaW1wbGVzdCBt
ZXRob2QgdG8gYXZvaWQgYmVpbmcgb3ZlcndyaXR0ZW4KKwkJICogYnkgdXNlcnNwYWNlLgorCQkg
Ki8KKwkJY2FwdHVyZSA9IGNhcHR1cmVfdm1hKGNhcHR1cmUsCisJCQkJICAgICAgcmVxdWVzdC0+
YmF0Y2gsCisJCQkJICAgICAgJmVlLT5iYXRjaGJ1ZmZlcik7CiAKKwkJaWYgKEhBU19CUk9LRU5f
Q1NfVExCKGk5MTUpKQogCQkJY2FwdHVyZSA9IGNhcHR1cmVfdm1hKGNhcHR1cmUsCi0JCQkJCSAg
ICAgIHJlcXVlc3QtPmh3X2NvbnRleHQtPnN0YXRlLAotCQkJCQkgICAgICAmZWUtPmN0eCk7CisJ
CQkJCSAgICAgIGVuZ2luZS0+Z3QtPnNjcmF0Y2gsCisJCQkJCSAgICAgICZlZS0+d2FfYmF0Y2hi
dWZmZXIpOwogCi0JCQljYXB0dXJlID0gY2FwdHVyZV92bWEoY2FwdHVyZSwKLQkJCQkJICAgICAg
cmluZy0+dm1hLAotCQkJCQkgICAgICAmZWUtPnJpbmdidWZmZXIpOworCQljYXB0dXJlID0gcmVx
dWVzdF9yZWNvcmRfdXNlcl9ibyhyZXF1ZXN0LCBlZSwgY2FwdHVyZSk7CiAKLQkJCWVycm9yLT5z
aW11bGF0ZWQgfD0KLQkJCQlpOTE1X2dlbV9jb250ZXh0X25vX2Vycm9yX2NhcHR1cmUoY3R4KTsK
KwkJY2FwdHVyZSA9IGNhcHR1cmVfdm1hKGNhcHR1cmUsCisJCQkJICAgICAgcmVxdWVzdC0+aHdf
Y29udGV4dC0+c3RhdGUsCisJCQkJICAgICAgJmVlLT5jdHgpOwogCi0JCQllZS0+cnFfaGVhZCA9
IHJlcXVlc3QtPmhlYWQ7Ci0JCQllZS0+cnFfcG9zdCA9IHJlcXVlc3QtPnBvc3RmaXg7Ci0JCQll
ZS0+cnFfdGFpbCA9IHJlcXVlc3QtPnRhaWw7CisJCWNhcHR1cmUgPSBjYXB0dXJlX3ZtYShjYXB0
dXJlLAorCQkJCSAgICAgIHJlcXVlc3QtPnJpbmctPnZtYSwKKwkJCQkgICAgICAmZWUtPnJpbmdi
dWZmZXIpOwogCi0JCQllZS0+Y3B1X3JpbmdfaGVhZCA9IHJpbmctPmhlYWQ7Ci0JCQllZS0+Y3B1
X3JpbmdfdGFpbCA9IHJpbmctPnRhaWw7CisJCWVlLT5jcHVfcmluZ19oZWFkID0gcmVxdWVzdC0+
cmluZy0+aGVhZDsKKwkJZWUtPmNwdV9yaW5nX3RhaWwgPSByZXF1ZXN0LT5yaW5nLT50YWlsOwog
Ci0JCQllbmdpbmVfcmVjb3JkX3JlcXVlc3RzKGVuZ2luZSwgcmVxdWVzdCwgZWUpOwotCQl9CisJ
CWVlLT5ycV9oZWFkID0gcmVxdWVzdC0+aGVhZDsKKwkJZWUtPnJxX3Bvc3QgPSByZXF1ZXN0LT5w
b3N0Zml4OworCQllZS0+cnFfdGFpbCA9IHJlcXVlc3QtPnRhaWw7CisKKwkJZW5naW5lX3JlY29y
ZF9yZXF1ZXN0cyhlbmdpbmUsIHJlcXVlc3QsIGVlKTsKIAkJc3Bpbl91bmxvY2tfaXJxcmVzdG9y
ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogCisJCWVycm9yX3JlY29yZF9lbmdpbmVf
cmVnaXN0ZXJzKGVycm9yLCBlbmdpbmUsIGVlKTsKKwkJZXJyb3JfcmVjb3JkX2VuZ2luZV9leGVj
bGlzdHMoZW5naW5lLCBlZSk7CisKIAkJd2hpbGUgKGNhcHR1cmUpIHsKIAkJCXN0cnVjdCBjYXB0
dXJlX3ZtYSAqdGhpcyA9IGNhcHR1cmU7CiAJCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9ICp0aGlz
LT5zbG90OwpAQCAtMTQ5Miw3ICsxNDQ5LDE4IEBAIGdlbV9yZWNvcmRfcmluZ3Moc3RydWN0IGk5
MTVfZ3B1X3N0YXRlICplcnJvciwgc3RydWN0IGNvbXByZXNzICpjb21wcmVzcykKIAogCQllZS0+
ZGVmYXVsdF9zdGF0ZSA9CiAJCQljYXB0dXJlX29iamVjdChpOTE1LCBlbmdpbmUtPmRlZmF1bHRf
c3RhdGUsIGNvbXByZXNzKTsKKworCQllZS0+ZW5naW5lID0gZW5naW5lOworCisJCWVlLT5uZXh0
ID0gZXJyb3ItPmVuZ2luZTsKKwkJZXJyb3ItPmVuZ2luZSA9IGVlOworCisJCWVlID0ga3phbGxv
YyhzaXplb2YoKmVlKSwgR0ZQX0tFUk5FTCk7CisJCWlmICghZWUpCisJCQlyZXR1cm47CiAJfQor
CisJa2ZyZWUoZWUpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtMTYyOCwyNCArMTU5NiwxOCBAQCBl
cnJvcl9tc2coc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvciwKIAkgIGludGVsX2VuZ2luZV9t
YXNrX3QgZW5naW5lcywgY29uc3QgY2hhciAqbXNnKQogewogCWludCBsZW47Ci0JaW50IGk7Ci0K
LQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShlcnJvci0+ZW5naW5lKTsgaSsrKQotCQlpZiAo
IWVycm9yLT5lbmdpbmVbaV0uY29udGV4dC5waWQpCi0JCQllbmdpbmVzICY9IH5CSVQoaSk7CiAK
IAlsZW4gPSBzY25wcmludGYoZXJyb3ItPmVycm9yX21zZywgc2l6ZW9mKGVycm9yLT5lcnJvcl9t
c2cpLAogCQkJIkdQVSBIQU5HOiBlY29kZSAlZDoleDoweCUwOHgiLAogCQkJSU5URUxfR0VOKGVy
cm9yLT5pOTE1KSwgZW5naW5lcywKLQkJCWk5MTVfZXJyb3JfZ2VuZXJhdGVfY29kZShlcnJvciwg
ZW5naW5lcykpOwotCWlmIChlbmdpbmVzKSB7CisJCQlpOTE1X2Vycm9yX2dlbmVyYXRlX2NvZGUo
ZXJyb3IpKTsKKwlpZiAoZXJyb3ItPmVuZ2luZSkgewogCQkvKiBKdXN0IHNob3cgdGhlIGZpcnN0
IGV4ZWN1dGluZyBwcm9jZXNzLCBtb3JlIGlzIGNvbmZ1c2luZyAqLwotCQlpID0gX19mZnMoZW5n
aW5lcyk7CiAJCWxlbiArPSBzY25wcmludGYoZXJyb3ItPmVycm9yX21zZyArIGxlbiwKIAkJCQkg
c2l6ZW9mKGVycm9yLT5lcnJvcl9tc2cpIC0gbGVuLAogCQkJCSAiLCBpbiAlcyBbJWRdIiwKLQkJ
CQkgZXJyb3ItPmVuZ2luZVtpXS5jb250ZXh0LmNvbW0sCi0JCQkJIGVycm9yLT5lbmdpbmVbaV0u
Y29udGV4dC5waWQpOworCQkJCSBlcnJvci0+ZW5naW5lLT5jb250ZXh0LmNvbW0sCisJCQkJIGVy
cm9yLT5lbmdpbmUtPmNvbnRleHQucGlkKTsKIAl9CiAJaWYgKG1zZykKIAkJbGVuICs9IHNjbnBy
aW50ZihlcnJvci0+ZXJyb3JfbXNnICsgbGVuLApAQCAtMTY4NiwxMiArMTY0OCwxMCBAQCBzdGF0
aWMgdm9pZCBjYXB0dXJlX3BhcmFtcyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQogCiBz
dGF0aWMgdW5zaWduZWQgbG9uZyBjYXB0dXJlX2ZpbmRfZXBvY2goY29uc3Qgc3RydWN0IGk5MTVf
Z3B1X3N0YXRlICplcnJvcikKIHsKKwljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5l
ICplZTsKIAl1bnNpZ25lZCBsb25nIGVwb2NoID0gZXJyb3ItPmNhcHR1cmU7Ci0JaW50IGk7Ci0K
LQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShlcnJvci0+ZW5naW5lKTsgaSsrKSB7Ci0JCWNv
bnN0IHN0cnVjdCBkcm1faTkxNV9lcnJvcl9lbmdpbmUgKmVlID0gJmVycm9yLT5lbmdpbmVbaV07
CiAKKwlmb3IgKGVlID0gZXJyb3ItPmVuZ2luZTsgZWU7IGVlID0gZWUtPm5leHQpIHsKIAkJaWYg
KGVlLT5oYW5nY2hlY2tfdGltZXN0YW1wICYmCiAJCSAgICB0aW1lX2JlZm9yZShlZS0+aGFuZ2No
ZWNrX3RpbWVzdGFtcCwgZXBvY2gpKQogCQkJZXBvY2ggPSBlZS0+aGFuZ2NoZWNrX3RpbWVzdGFt
cDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oCmluZGV4IGEyNGMzNTEwN2QxNi4u
ZGY5ZjU3NzY2NjI2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9l
cnJvci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmgKQEAgLTgx
LDcgKzgxLDggQEAgc3RydWN0IGk5MTVfZ3B1X3N0YXRlIHsKIAlzdHJ1Y3QgaW50ZWxfZGlzcGxh
eV9lcnJvcl9zdGF0ZSAqZGlzcGxheTsKIAogCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9lbmdpbmUg
ewotCQlpbnQgZW5naW5lX2lkOworCQljb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmU7CisKIAkJLyogU29mdHdhcmUgdHJhY2tlZCBzdGF0ZSAqLwogCQlib29sIGlkbGU7CiAJCXVu
c2lnbmVkIGxvbmcgaGFuZ2NoZWNrX3RpbWVzdGFtcDsKQEAgLTE1OCw3ICsxNTksOSBAQCBzdHJ1
Y3QgaTkxNV9ncHVfc3RhdGUgewogCQkJCXUzMiBwcF9kaXJfYmFzZTsKIAkJCX07CiAJCX0gdm1f
aW5mbzsKLQl9IGVuZ2luZVtJOTE1X05VTV9FTkdJTkVTXTsKKworCQlzdHJ1Y3QgZHJtX2k5MTVf
ZXJyb3JfZW5naW5lICpuZXh0OworCX0gKmVuZ2luZTsKIAogCXN0cnVjdCBzY2F0dGVybGlzdCAq
c2dsLCAqZml0OwogfTsKLS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeA==

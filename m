Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9902AE0386
	for <lists+intel-gfx@lfdr.de>; Tue, 22 Oct 2019 13:57:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 20E706E5FB;
	Tue, 22 Oct 2019 11:57:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AC2386E5FB
 for <intel-gfx@lists.freedesktop.org>; Tue, 22 Oct 2019 11:57:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18924542-1500050 
 for multiple; Tue, 22 Oct 2019 12:57:18 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 22 Oct 2019 12:57:05 +0100
Message-Id: <20191022115705.4744-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
In-Reply-To: <20191022115126.18746-4-chris@chris-wilson.co.uk>
References: <20191022115126.18746-4-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Add coverage of mocs
 registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvYmUgdGhlIG1vY3MgcmVnaXN0ZXJzIGZvciBuZXcgY29udGV4dHMgYW5kIGFjcm9zcyBHUFUg
cmVzZXRzLiBTaW1pbGFyCnRvIGludGVsX3dvcmthcm91bmRzLCB3ZSBoYXZlIHRhYmxlcyBvZiB3
aGF0IHJlZ2lzdGVyIHZhbHVlcyB3ZSBleHBlY3QKdG8gc2VlLCBzbyB2ZXJpZnkgdGhhdCB1c2Vy
IGNvbnRleHRzIGFyZSBhZmZlY3RlZCBieSB0aGVtLiBJbiB0aGUKZnV0dXJlLCB3ZSBzaG91bGQg
YWRkIHRlc3RzIHNpbWlsYXIgdG8gaW50ZWxfc3NldSB0byBjb3ZlciBkeW5hbWljCnJlY29uZmln
dXJhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNhbkBp
bnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMgICAgICAgICAgfCAg
IDQgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5jICAgICAgIHwgMzkz
ICsrKysrKysrKysrKysrKysrKwogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2Vs
ZnRlc3RzLmggIHwgICAxICsKIDMgZmlsZXMgY2hhbmdlZCwgMzk4IGluc2VydGlvbnMoKykKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMKaW5kZXggNDQ1ZWMwMjViZGEwLi4wNmRi
YTdmZjI5NGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3Mu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMKQEAgLTQ0OCwzICs0
NDgsNyBAQCB2b2lkIGludGVsX21vY3NfaW5pdChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCWlmIChI
QVNfR0xPQkFMX01PQ1NfUkVHSVNURVJTKGd0LT5pOTE1KSkKIAkJaW5pdF9nbG9iYWxfbW9jcyhn
dCk7CiB9CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKKyNpbmNs
dWRlICJzZWxmdGVzdF9tb2NzLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X21vY3MuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmNhOTY3
OWMzZWU2OAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X21vY3MuYwpAQCAtMCwwICsxLDM5MyBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICov
CisKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKKyNpbmNsdWRlICJpOTE1X3NlbGZ0
ZXN0LmgiCisKKyNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5oIgorI2luY2x1
ZGUgInNlbGZ0ZXN0cy9pZ3RfcmVzZXQuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5u
ZXIuaCIKKworc3RydWN0IGxpdmVfbW9jcyB7CisJc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUg
dGFibGU7CisJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoOworCXZvaWQgKnZhZGRyOworfTsKKwor
c3RhdGljIGludCByZXF1ZXN0X2FkZF9zeW5jKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQg
ZXJyKQoreworCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOwor
CWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApCisJCWVyciA9IC1FVElN
RTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBp
bnQgcmVxdWVzdF9hZGRfc3BpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGlndF9z
cGlubmVyICpzcGluKQoreworCWludCBlcnIgPSAwOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7
CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJaWYgKHNwaW4gJiYgIWlndF93YWl0X2Zvcl9zcGlu
bmVyKHNwaW4sIHJxKSkKKwkJZXJyID0gLUVUSU1FOworCWk5MTVfcmVxdWVzdF9wdXQocnEpOwor
CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0
Y2goc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwlvYmogPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19F
UlIob2JqKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwlpOTE1X2dlbV9vYmplY3Rfc2V0
X2NhY2hlX2NvaGVyZW5jeShvYmosIEk5MTVfQ0FDSElOR19DQUNIRUQpOworCisJdm1hID0gaTkx
NV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZt
YSkpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gdm1hOworCX0KKwor
CWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlmIChlcnIpIHsK
KwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX1BUUihlcnIpOworCX0K
KworCXJldHVybiB2bWE7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX2luaXQoc3RydWN0IGxp
dmVfbW9jcyAqYXJnLCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCWludCBlcnI7CisKKwlpZiAo
IWdldF9tb2NzX3NldHRpbmdzKGd0LT5pOTE1LCAmYXJnLT50YWJsZSkpCisJCXJldHVybiAtRUlO
VkFMOworCisJYXJnLT5zY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOworCWlmIChJU19FUlIo
YXJnLT5zY3JhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIoYXJnLT5zY3JhdGNoKTsKKworCWFyZy0+
dmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChhcmctPnNjcmF0Y2gtPm9iaiwgSTkxNV9N
QVBfV0IpOworCWlmIChJU19FUlIoYXJnLT52YWRkcikpIHsKKwkJZXJyID0gUFRSX0VSUihhcmct
PnZhZGRyKTsKKwkJZ290byBlcnJfc2NyYXRjaDsKKwl9CisKKwlyZXR1cm4gMDsKKworZXJyX3Nj
cmF0Y2g6CisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmFyZy0+c2NyYXRjaCwgMCk7CisJ
cmV0dXJuIGVycjsKK30KKworc3RhdGljIHZvaWQgbGl2ZV9tb2NzX2Zpbmkoc3RydWN0IGxpdmVf
bW9jcyAqYXJnKQoreworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZhcmctPnNjcmF0Y2gs
IEk5MTVfVk1BX1JFTEVBU0VfTUFQKTsKK30KKworc3RhdGljIGludCByZWFkX3JlZ3Moc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEsCisJCSAgICAgdTMyIGFkZHIsIHVuc2lnbmVkIGludCBjb3VudCwK
KwkJICAgICB1aW50MzJfdCAqb2Zmc2V0KQoreworCXVuc2lnbmVkIGludCBpOworCXUzMiAqY3M7
CisKKwlHRU1fQlVHX09OKCFJU19BTElHTkVEKCpvZmZzZXQsIHNpemVvZih1MzIpKSk7CisKKwlj
cyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDQgKiBjb3VudCk7CisJaWYgKElTX0VSUihjcykpCisJ
CXJldHVybiBQVFJfRVJSKGNzKTsKKworCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJ
CSpjcysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9VU0VfR0dUVDsKKwkJKmNz
KysgPSBhZGRyOworCQkqY3MrKyA9ICpvZmZzZXQ7CisJCSpjcysrID0gMDsKKworCQlhZGRyICs9
IHNpemVvZih1MzIpOworCQkqb2Zmc2V0ICs9IHNpemVvZih1MzIpOworCX0KKworCWludGVsX3Jp
bmdfYWR2YW5jZShycSwgY3MpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgcmVhZF9t
b2NzX3RhYmxlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJICAgY29uc3Qgc3RydWN0IGRy
bV9pOTE1X21vY3NfdGFibGUgKnRhYmxlLAorCQkJICAgdWludDMyX3QgKm9mZnNldCkKK3sKKwl1
MzIgYWRkcjsKKworCWlmIChIQVNfR0xPQkFMX01PQ1NfUkVHSVNURVJTKHJxLT5pOTE1KSkKKwkJ
YWRkciA9IDB4NDAwMDsKKwllbHNlCisJCWFkZHIgPSBtb2NzX3JlZ2lzdGVyKHJxLT5lbmdpbmUp
OworCisJcmV0dXJuIHJlYWRfcmVncyhycSwgYWRkciwgdGFibGUtPm5fZW50cmllcywgb2Zmc2V0
KTsKK30KKworc3RhdGljIGludCByZWFkX2wzY2NfdGFibGUoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEsCisJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUsCisJCQkg
ICB1aW50MzJfdCAqb2Zmc2V0KQoreworCS8qIENhbiB3ZSByZWFkIHRoZSBNQ1IgcmFuZ2UgMHhi
MDAgZGlyZWN0bHk/IFNlZSBpbnRlbF93b3JrYXJvdW5kcyEgKi8KKwl1MzIgYWRkciA9IGk5MTVf
bW1pb19yZWdfb2Zmc2V0KEdFTjlfTE5DRkNNT0NTKDApKTsKKworCXJldHVybiByZWFkX3JlZ3Mo
cnEsIGFkZHIsICh0YWJsZS0+bl9lbnRyaWVzICsgMSkgLyAyLCBvZmZzZXQpOworfQorCitzdGF0
aWMgaW50IGNoZWNrX21vY3NfdGFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAor
CQkJICAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwKKwkJCSAgICB1
aW50MzJfdCAqKnZhZGRyKQoreworCXVuc2lnbmVkIGludCBpOworCXUzMiBleHBlY3Q7CisKKwlm
b3JfZWFjaF9tb2NzKGV4cGVjdCwgdGFibGUsIGkpIHsKKwkJaWYgKCoqdmFkZHIgIT0gZXhwZWN0
KSB7CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIE1PQ1NbJWRdIGVudHJ5LCBmb3VuZCAlMDh4LCBl
eHBlY3RlZCAlMDh4XG4iLAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgaSwgKip2YWRkciwgZXhw
ZWN0KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCSsrKnZhZGRyOworCX0KKworCXJldHVy
biAwOworfQorCitzdGF0aWMgaW50IGNoZWNrX2wzY2NfdGFibGUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAorCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0
YWJsZSwKKwkJCSAgICB1aW50MzJfdCAqKnZhZGRyKQoreworCXVuc2lnbmVkIGludCBpOworCXUz
MiBleHBlY3Q7CisKKwlmb3JfZWFjaF9sM2NjKGV4cGVjdCwgdGFibGUsIGkpIHsKKwkJaWYgKCoq
dmFkZHIgIT0gZXhwZWN0KSB7CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIEwzQ0NbJWRdIGVudHJ5
LCBmb3VuZCAlMDh4LCBleHBlY3RlZCAlMDh4XG4iLAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwg
aSwgKip2YWRkciwgZXhwZWN0KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCSsrKnZhZGRy
OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNoZWNrX21vY3NfZW5naW5lKHN0
cnVjdCBsaXZlX21vY3MgKmFyZywKKwkJCSAgICAgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQor
eworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gYXJnLT5zY3JhdGNoOworCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOworCXUzMiBvZmZzZXQ7CisJdTMyICp2YWRkcjsKKwlpbnQgZXJyOworCisJbWVt
c2V0MzIoYXJnLT52YWRkciwgU1RBQ0tfTUFHSUMsIFBBR0VfU0laRSAvIHNpemVvZih1MzIpKTsK
KworCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CisJaWYgKElTX0VSUihy
cSkpCisJCXJldHVybiBQVFJfRVJSKHJxKTsKKworCWk5MTVfdm1hX2xvY2sodm1hKTsKKwllcnIg
PSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCB2bWEtPm9iaiwgdHJ1ZSk7CisJaWYgKCFl
cnIpCisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIEVYRUNfT0JKRUNU
X1dSSVRFKTsKKwlpOTE1X3ZtYV91bmxvY2sodm1hKTsKKworCW9mZnNldCA9IGk5MTVfZ2d0dF9v
ZmZzZXQodm1hKTsKKwlpZiAoIWVycikKKwkJZXJyID0gcmVhZF9tb2NzX3RhYmxlKHJxLCAmYXJn
LT50YWJsZSwgJm9mZnNldCk7CisJaWYgKCFlcnIgJiYgY2UtPmVuZ2luZS0+Y2xhc3MgPT0gUkVO
REVSX0NMQVNTKQorCQllcnIgPSByZWFkX2wzY2NfdGFibGUocnEsICZhcmctPnRhYmxlLCAmb2Zm
c2V0KTsKKwlvZmZzZXQgLT0gaTkxNV9nZ3R0X29mZnNldCh2bWEpOworCUdFTV9CVUdfT04ob2Zm
c2V0ID4gUEFHRV9TSVpFKTsKKworCWVyciA9IHJlcXVlc3RfYWRkX3N5bmMocnEsIGVycik7CisJ
aWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXZhZGRyID0gYXJnLT52YWRkcjsKKwlpZiAoIWVy
cikKKwkJZXJyID0gY2hlY2tfbW9jc190YWJsZShjZS0+ZW5naW5lLCAmYXJnLT50YWJsZSwgJnZh
ZGRyKTsKKwlpZiAoIWVyciAmJiBjZS0+ZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJfQ0xBU1MpCisJ
CWVyciA9IGNoZWNrX2wzY2NfdGFibGUoY2UtPmVuZ2luZSwgJmFyZy0+dGFibGUsICZ2YWRkcik7
CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCUdFTV9CVUdfT04oYXJnLT52YWRkciArIG9m
ZnNldCAhPSB2YWRkcik7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX2tl
cm5lbCh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3Ry
dWN0IGxpdmVfbW9jcyBtb2NzOworCWludCBlcnI7CisKKwllcnIgPSBsaXZlX21vY3NfaW5pdCgm
bW9jcywgZ3QpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndCwgaWQpIHsKKwkJZXJyID0gY2hlY2tfbW9jc19lbmdpbmUoJm1vY3MsIGVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisJfQorCisJbGl2ZV9t
b2NzX2ZpbmkoJm1vY3MpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2Nz
X2NsZWFuKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlz
dHJ1Y3QgbGl2ZV9tb2NzIG1vY3M7CisJaW50IGVycjsKKworCWVyciA9IGxpdmVfbW9jc19pbml0
KCZtb2NzLCBndCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGd0LCBpZCkgeworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisKKwkJY2Ug
PSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5nZW1fY29udGV4
dCwKKwkJCQkJICBlbmdpbmUpOworCQlpZiAoSVNfRVJSKGNlKSkgeworCQkJZXJyID0gUFRSX0VS
UihjZSk7CisJCQlicmVhazsKKwkJfQorCisJCWVyciA9IGNoZWNrX21vY3NfZW5naW5lKCZtb2Nz
LCBjZSk7CisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOwor
CX0KKworCWxpdmVfbW9jc19maW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IGFjdGl2ZV9lbmdpbmVfcmVzZXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJICAg
ICAgIGNvbnN0IGNoYXIgKnJlYXNvbikKK3sKKwlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3BpbjsKKwlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwlpbnQgZXJyOworCisJZXJyID0gaWd0X3NwaW5uZXJf
aW5pdCgmc3BpbiwgY2UtPmVuZ2luZS0+Z3QpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisK
KwlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluLCBjZSwgTUlfTk9PUCk7CisJ
aWYgKElTX0VSUihycSkpIHsKKwkJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbik7CisJCXJldHVybiBQ
VFJfRVJSKHJxKTsKKwl9CisKKwllcnIgPSByZXF1ZXN0X2FkZF9zcGluKHJxLCAmc3Bpbik7CisJ
aWYgKGVyciA9PSAwKQorCQllcnIgPSBpbnRlbF9lbmdpbmVfcmVzZXQoY2UtPmVuZ2luZSwgcmVh
c29uKTsKKworCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7CisJaWd0X3NwaW5uZXJfZmluaSgmc3Bp
bik7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IF9fbGl2ZV9tb2NzX3Jlc2V0KHN0
cnVjdCBsaXZlX21vY3MgKm1vY3MsCisJCQkgICAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
K3sKKwlpbnQgZXJyOworCisJZXJyID0gaW50ZWxfZW5naW5lX3Jlc2V0KGNlLT5lbmdpbmUsICJt
b2NzIik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGNoZWNrX21vY3NfZW5n
aW5lKG1vY3MsIGNlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZXJyID0gYWN0aXZl
X2VuZ2luZV9yZXNldChjZSwgIm1vY3MiKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJ
ZXJyID0gY2hlY2tfbW9jc19lbmdpbmUobW9jcywgY2UpOworCWlmIChlcnIpCisJCXJldHVybiBl
cnI7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBsaXZlX21vY3NfcmVzZXQodm9pZCAq
YXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCXN0cnVjdCBsaXZlX21v
Y3MgbW9jczsKKwlpbnQgZXJyID0gMDsKKworCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2luZShn
dCkpCisJCXJldHVybiAwOworCisJZXJyID0gbGl2ZV9tb2NzX2luaXQoJm1vY3MsIGd0KTsKKwlp
ZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKKwlm
b3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQg
KmNlOworCisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4
dC0+Z2VtX2NvbnRleHQsCisJCQkJCSAgZW5naW5lKTsKKwkJaWYgKElTX0VSUihjZSkpIHsKKwkJ
CWVyciA9IFBUUl9FUlIoY2UpOworCQkJYnJlYWs7CisJCX0KKworCQlpbnRlbF9lbmdpbmVfcG1f
Z2V0KGVuZ2luZSk7CisJCWVyciA9IF9fbGl2ZV9tb2NzX3Jlc2V0KCZtb2NzLCBjZSk7CisJCWlu
dGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKworCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJ
CWlmIChlcnIpCisJCQlicmVhazsKKwl9CisJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOwor
CisJbGl2ZV9tb2NzX2ZpbmkoJm1vY3MpOworCXJldHVybiBlcnI7Cit9CisKK2ludCBpbnRlbF9t
b2NzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0
YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2
ZV9tb2NzX2tlcm5lbCksCisJCVNVQlRFU1QobGl2ZV9tb2NzX2NsZWFuKSwKKwkJU1VCVEVTVChs
aXZlX21vY3NfcmVzZXQpLAorCX07CisJc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUgdGFibGU7
CisKKwlpZiAoIWdldF9tb2NzX3NldHRpbmdzKGk5MTUsICZ0YWJsZSkpCisJCXJldHVybiAwOwor
CisJcmV0dXJuIGludGVsX2d0X2xpdmVfc3VidGVzdHModGVzdHMsICZpOTE1LT5ndCk7Cit9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0
ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVz
dHMuaAppbmRleCAwMGEwNjM3MzBiYzMuLmMyM2QwNmJjYTA5ZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCkBAIC0xNiw2
ICsxNiw3IEBAIHNlbGZ0ZXN0KGd0X2VuZ2luZXMsIGludGVsX2VuZ2luZV9saXZlX3NlbGZ0ZXN0
cykKIHNlbGZ0ZXN0KGd0X3RpbWVsaW5lcywgaW50ZWxfdGltZWxpbmVfbGl2ZV9zZWxmdGVzdHMp
CiBzZWxmdGVzdChndF9jb250ZXh0cywgaW50ZWxfY29udGV4dF9saXZlX3NlbGZ0ZXN0cykKIHNl
bGZ0ZXN0KGd0X2xyYywgaW50ZWxfbHJjX2xpdmVfc2VsZnRlc3RzKQorc2VsZnRlc3QoZ3RfbW9j
cywgaW50ZWxfbW9jc19saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd0X3BtLCBpbnRlbF9ndF9w
bV9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd0X2hlYXJ0YmVhdCwgaW50ZWxfaGVhcnRiZWF0
X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QocmVxdWVzdHMsIGk5MTVfcmVxdWVzdF9saXZlX3Nl
bGZ0ZXN0cykKLS0gCjIuMjQuMC5yYzAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 11C1F126FFC
	for <lists+intel-gfx@lfdr.de>; Thu, 19 Dec 2019 22:49:57 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F1E2D6EB9B;
	Thu, 19 Dec 2019 21:49:53 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9732A6EB9A
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Dec 2019 21:49:53 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 19 Dec 2019 13:49:53 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,333,1571727600"; d="scan'208";a="228389311"
Received: from labuser-z97x-ud5h.jf.intel.com ([10.54.75.49])
 by orsmga002.jf.intel.com with ESMTP; 19 Dec 2019 13:49:52 -0800
From: Manasi Navare <manasi.d.navare@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 19 Dec 2019 13:51:15 -0800
Message-Id: <20191219215117.929-1-manasi.d.navare@intel.com>
X-Mailer: git-send-email 2.19.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 1/3] drm/i915/dp: Make sure all tiled
 connectors get added to the state with full modeset
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gY2FzZSBvZiB0aWxlZCBkaXNwbGF5cywgYWxsIHRoZSB0aWxlcyBhcmUgbGlua2UgZHRvIGVh
Y2ggb3RoZXIKZm9yIHRyYW5zY29kZXIgcG9ydCBzeW5jLiBTbyBpbiBpbnRlbF9hdG9taWNfY2hl
Y2soKSB3ZSBuZWVkIHRvIG1ha2UKc3VyZSB0aGF0IHdlIGFkZCBhbGwgdGhlIHRpbGVzIHRvIHRo
ZSBtb2Rlc2V0IGFuZCBpZiBvbmUgb2YgdGhlCnRpbGVzIG5lZWRzIGEgZnVsbCBtb2Rlc2V0IHRo
ZW4gbWFyayBhbGwgb3RoZXIgdGlsZXMgZm9yIGEgZnVsbCBtb2Rlc2V0LgoKdjI6CiogQ2hhbmdl
IGNydGNfc3RhdGUgc2NvcGUsIHJlbW92ZSB0aWxlX2dycF9pZCAoVmlsbGUpCiogVXNlIGludGVs
X2Nvbm5lY3Rvcl9uZWVkc19tb2Rlc2V0KCkgKFZpbGxlKQoqIEFkZCBtb2Rlc2V0X3N5bmNlZF9j
cnRjcyAoVmlsbGUpCiogTWFrZSBzdXJlIHN5bmNlZCBjcnRjcyBhcmUgZm9yY2VkIGZ1bGwgbW9k
ZXNldAphZnRlciBmYXN0c2V0IGNoZWNrIChWaWxsZSkKClN1Z2dlc3RlZC1ieTogVmlsbGUgU3ly
asOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6IFZpbGxlIFN5cmrDpGzD
pCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBKb3PDqSBSb2JlcnRvIGRlIFNv
dXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KQ2M6IE1hdHQgUm9wZXIgPG1hdHRoZXcuZC5yb3Bl
ckBpbnRlbC5jb20+CkJ1Z3ppbGxhOiBodHRwczovL2dpdGxhYi5mcmVlZGVza3RvcC5vcmcvZHJt
L2ludGVsL2lzc3Vlcy81ClNpZ25lZC1vZmYtYnk6IE1hbmFzaSBOYXZhcmUgPG1hbmFzaS5kLm5h
dmFyZUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMgfCAxNDMgKysrKysrKysrKysrKysrKystLQogMSBmaWxlIGNoYW5nZWQsIDEzMSBp
bnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGEzZjk0MzA0OTNhZS4uMDA2MDhkOGNlZjUwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTM5
MTAsMTggKzEzOTEwLDYgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19jaGVja19mYXN0c2V0KGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGEKIAluZXdfY3J0Y19zdGF0
ZS0+dWFwaS5tb2RlX2NoYW5nZWQgPSBmYWxzZTsKIAluZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3Bp
cGUgPSB0cnVlOwogCi0JLyoKLQkgKiBJZiB3ZSdyZSBub3QgZG9pbmcgdGhlIGZ1bGwgbW9kZXNl
dCB3ZSB3YW50IHRvCi0JICoga2VlcCB0aGUgY3VycmVudCBNL04gdmFsdWVzIGFzIHRoZXkgbWF5
IGJlCi0JICogc3VmZmljaWVudGx5IGRpZmZlcmVudCB0byB0aGUgY29tcHV0ZWQgdmFsdWVzCi0J
ICogdG8gY2F1c2UgcHJvYmxlbXMuCi0JICoKLQkgKiBGSVhNRTogc2hvdWxkIHJlYWxseSBjb3B5
IG1vcmUgZnV6enkgc3RhdGUgaGVyZQotCSAqLwotCW5ld19jcnRjX3N0YXRlLT5mZGlfbV9uID0g
b2xkX2NydGNfc3RhdGUtPmZkaV9tX247Ci0JbmV3X2NydGNfc3RhdGUtPmRwX21fbiA9IG9sZF9j
cnRjX3N0YXRlLT5kcF9tX247Ci0JbmV3X2NydGNfc3RhdGUtPmRwX20yX24yID0gb2xkX2NydGNf
c3RhdGUtPmRwX20yX24yOwotCW5ld19jcnRjX3N0YXRlLT5oYXNfZHJycyA9IG9sZF9jcnRjX3N0
YXRlLT5oYXNfZHJyczsKIH0KIAogc3RhdGljIGludCBpbnRlbF9jcnRjX2FkZF9wbGFuZXNfdG9f
c3RhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCkBAIC0xNDAzMiw2ICsxNDAy
MCwxMDUgQEAgc3RhdGljIGludCBpbnRlbF9hdG9taWNfY2hlY2tfY3J0Y3Moc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyB2b2lkCitpbnRl
bF9kcF9tb2Rlc2V0X3N5bmNlZF9jcnRjcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGM7CisJaW50IGk7CisKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19p
bl9zdGF0ZShzdGF0ZSwgY3J0YywKKwkJCQkJIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCWlmIChp
c190cmFuc19wb3J0X3N5bmNfbW9kZShuZXdfY3J0Y19zdGF0ZSkpIHsKKwkJCW5ld19jcnRjX3N0
YXRlLT51YXBpLm1vZGVfY2hhbmdlZCA9IHRydWU7CisJCQluZXdfY3J0Y19zdGF0ZS0+dXBkYXRl
X3BpcGUgPSBmYWxzZTsKKwkJfQorCX0KK30KKworc3RhdGljIHZvaWQKK2ludGVsX2RwX2F0b21p
Y19jaGVja19zeW5jZWRfY3J0Y3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7
CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjOworCWludCBpOworCisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3Rh
dGUoc3RhdGUsIGNydGMsCisJCQkJCSBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAoIWlzX3Ry
YW5zX3BvcnRfc3luY19tb2RlKG5ld19jcnRjX3N0YXRlKSB8fAorCQkgICAgIW5lZWRzX21vZGVz
ZXQobmV3X2NydGNfc3RhdGUpKQorCQkJY29udGludWU7CisKKwkJaW50ZWxfZHBfbW9kZXNldF9z
eW5jZWRfY3J0Y3Moc3RhdGUpOworCX0KK30KKworc3RhdGljIGludAoraW50ZWxfZHBfbW9kZXNl
dF9hbGxfdGlsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsIGludCB0aWxlX2dy
cF9pZCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0
YXRlLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKKwlzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9saXN0X2l0ZXI7CisKKwlkcm1fY29ubmVj
dG9yX2xpc3RfaXRlcl9iZWdpbigmZGV2X3ByaXYtPmRybSwgJmNvbm5fbGlzdF9pdGVyKTsKKwlk
cm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0ZXIoY29ubmVjdG9yLCAmY29ubl9saXN0X2l0ZXIpIHsK
KwkJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5faXRlcl9zdGF0ZTsKKwkJc3RydWN0
IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOworCisJCWlmICghKGNvbm5lY3Rvci0+aGFzX3Rp
bGUgJiYKKwkJICAgICAgY29ubmVjdG9yLT50aWxlX2dyb3VwLT5pZCA9PSB0aWxlX2dycF9pZCkp
CisJCQljb250aW51ZTsKKwkJY29ubl9pdGVyX3N0YXRlID0gZHJtX2F0b21pY19nZXRfY29ubmVj
dG9yX3N0YXRlKCZzdGF0ZS0+YmFzZSwKKwkJCQkJCQkJIGNvbm5lY3Rvcik7CisJCWlmIChJU19F
UlIoY29ubl9pdGVyX3N0YXRlKSkgeworCQkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZj
b25uX2xpc3RfaXRlcik7CisJCQlyZXR1cm4gUFRSX0VSUihjb25uX2l0ZXJfc3RhdGUpOworCQl9
CisKKwkJaWYgKCFjb25uX2l0ZXJfc3RhdGUtPmNydGMpCisJCQljb250aW51ZTsKKworCQljcnRj
X3N0YXRlID0gZHJtX2F0b21pY19nZXRfY3J0Y19zdGF0ZSgmc3RhdGUtPmJhc2UsCisJCQkJCQkg
ICAgICAgY29ubl9pdGVyX3N0YXRlLT5jcnRjKTsKKwkJaWYgKElTX0VSUihjcnRjX3N0YXRlKSkg
eworCQkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2xpc3RfaXRlcik7CisJCQly
ZXR1cm4gUFRSX0VSUihjb25uX2l0ZXJfc3RhdGUpOworCQl9CisJCWNydGNfc3RhdGUtPm1vZGVf
Y2hhbmdlZCA9IHRydWU7CisJfQorCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9s
aXN0X2l0ZXIpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQKK2ludGVsX2RwX2F0b21p
Y19jaGVja190aWxlZF9jb25ucyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNl
LmRldik7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUsICpuZXdfY29ubl9zdGF0ZTsKKwlpbnQgaSwg
cmV0OworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKKwkJcmV0dXJuIDA7CisKKwkv
KiBJcyB0aWxlZCwgbWFyayBhbGwgb3RoZXIgdGlsZWQgQ1JUQ3MgYXMgbmVlZGluZyBhIG1vZGVz
ZXQgKi8KKwlmb3JfZWFjaF9vbGRuZXdfY29ubmVjdG9yX2luX3N0YXRlKCZzdGF0ZS0+YmFzZSwg
Y29ubmVjdG9yLAorCQkJCQkgICBvbGRfY29ubl9zdGF0ZSwgbmV3X2Nvbm5fc3RhdGUsIGkpIHsK
KwkJaWYgKCFjb25uZWN0b3ItPmhhc190aWxlKQorCQkJY29udGludWU7CisJCWlmICghaW50ZWxf
Y29ubmVjdG9yX25lZWRzX21vZGVzZXQoc3RhdGUsIG9sZF9jb25uX3N0YXRlLAorCQkJCQkJICAg
bmV3X2Nvbm5fc3RhdGUpKQorCQkJY29udGludWU7CisKKwkJcmV0ID0gaW50ZWxfZHBfbW9kZXNl
dF9hbGxfdGlsZXMoc3RhdGUsIGNvbm5lY3Rvci0+dGlsZV9ncm91cC0+aWQpOworCQlpZiAocmV0
KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwogLyoqCiAgKiBpbnRlbF9h
dG9taWNfY2hlY2sgLSB2YWxpZGF0ZSBzdGF0ZSBvYmplY3QKICAqIEBkZXY6IGRybSBkZXZpY2UK
QEAgLTE0MDU5LDYgKzE0MTQ2LDEyIEBAIHN0YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NoZWNrKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaWYgKHJldCkKIAkJZ290byBmYWlsOwogCisJcmV0ID0g
aW50ZWxfZHBfYXRvbWljX2NoZWNrX3RpbGVkX2Nvbm5zKHN0YXRlKTsKKwlpZiAocmV0KQorCQln
b3RvIGZhaWw7CisKKwlpbnRlbF9kcF9hdG9taWNfY2hlY2tfc3luY2VkX2NydGNzKHN0YXRlKTsK
KwogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRf
Y3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0YXRlLCBpKSB7CiAJCWlmICghbmVlZHNf
bW9kZXNldChuZXdfY3J0Y19zdGF0ZSkpIHsKQEAgLTE0MDg5LDYgKzE0MTgyLDMyIEBAIHN0YXRp
YyBpbnQgaW50ZWxfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQlhbnlf
bXMgPSB0cnVlOwogCX0KIAorCS8qCisJICogSW4gY2FzZSBvZiBwb3J0IHN5bmNlZCBjcnRjcywg
aWYgb25lIG9mIHRoZSBzeW5jZWQgY3J0Y3MKKwkgKiBuZWVkcyBhIGZ1bGwgbW9kZXNldCwgYWxs
IG90aGVyIHN5bmNlZCBjcnRjcyBzaG91bGQgYmUKKwkgKiBmb3JjZWQgYSBmdWxsIG1vZGVzZXQu
CisJICovCisJaW50ZWxfZHBfYXRvbWljX2NoZWNrX3N5bmNlZF9jcnRjcyhzdGF0ZSk7CisKKwlm
b3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNf
c3RhdGUsCisJCQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAobmVlZHNfbW9kZXNl
dChuZXdfY3J0Y19zdGF0ZSkpCisJCQljb250aW51ZTsKKworCQkvKgorCQkgKiBJZiB3ZSdyZSBu
b3QgZG9pbmcgdGhlIGZ1bGwgbW9kZXNldCB3ZSB3YW50IHRvCisJCSAqIGtlZXAgdGhlIGN1cnJl
bnQgTS9OIHZhbHVlcyBhcyB0aGV5IG1heSBiZQorCQkgKiBzdWZmaWNpZW50bHkgZGlmZmVyZW50
IHRvIHRoZSBjb21wdXRlZCB2YWx1ZXMKKwkJICogdG8gY2F1c2UgcHJvYmxlbXMuCisJCSAqCisJ
CSAqIEZJWE1FOiBzaG91bGQgcmVhbGx5IGNvcHkgbW9yZSBmdXp6eSBzdGF0ZSBoZXJlCisJCSAq
LworCQluZXdfY3J0Y19zdGF0ZS0+ZmRpX21fbiA9IG9sZF9jcnRjX3N0YXRlLT5mZGlfbV9uOwor
CQluZXdfY3J0Y19zdGF0ZS0+ZHBfbV9uID0gb2xkX2NydGNfc3RhdGUtPmRwX21fbjsKKwkJbmV3
X2NydGNfc3RhdGUtPmRwX20yX24yID0gb2xkX2NydGNfc3RhdGUtPmRwX20yX24yOworCQluZXdf
Y3J0Y19zdGF0ZS0+aGFzX2RycnMgPSBvbGRfY3J0Y19zdGF0ZS0+aGFzX2RycnM7CisJfQorCiAJ
aWYgKGFueV9tcyAmJiAhY2hlY2tfZGlnaXRhbF9wb3J0X2NvbmZsaWN0cyhzdGF0ZSkpIHsKIAkJ
RFJNX0RFQlVHX0tNUygicmVqZWN0aW5nIGNvbmZsaWN0aW5nIGRpZ2l0YWwgcG9ydCBjb25maWd1
cmF0aW9uXG4iKTsKIAkJcmV0ID0gRUlOVkFMOwotLSAKMi4xOS4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

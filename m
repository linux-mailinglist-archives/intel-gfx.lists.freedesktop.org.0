Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8BEC8A4E17
	for <lists+intel-gfx@lfdr.de>; Mon,  2 Sep 2019 06:03:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1289F89AA6;
	Mon,  2 Sep 2019 04:03:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 90C2B89A92
 for <intel-gfx@lists.freedesktop.org>; Mon,  2 Sep 2019 04:03:23 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18339025-1500050 
 for multiple; Mon, 02 Sep 2019 05:03:08 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  2 Sep 2019 05:03:02 +0100
Message-Id: <20190902040303.14195-20-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190902040303.14195-1-chris@chris-wilson.co.uk>
References: <20190902040303.14195-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 20/21] drm/i915: Move request runtime management
 onto gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVxdWVzdHMgYXJlIHJ1biBmcm9tIHRoZSBndCBhbmQgYXJlIHRpZGVkIGludG8gdGhlIGd0IHJ1
bnRpbWUgcG93ZXIKbWFuYWdlbWVudCwgc28gcHVsbCB0aGUgcnVudGltZSByZXF1ZXN0IG1hbmFn
ZW1lbnQgdW5kZXIgZ3QvCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAg
ICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4u
YyAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAg
ICAgICAgfCAgMjIgKy0tLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jIHwgICA1ICstCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFu
LmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgICAgICAg
ICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jICAgICAg
ICAgfCAgIDkgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMg
ICB8IDExOCArKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3JlcXVlc3RzLmggICB8ICAxOSArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3R5cGVzLmggICAgICB8ICAxMSArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfdGltZWxpbmUuYyAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAgMTcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
ICAgICAgICAgICAgICAgfCAgMTAgLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMg
ICAgICAgICAgICAgICB8ICAxNSAtLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2
aWN0LmMgICAgICAgICB8ICAxNCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jICAgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMgICAgICAgICAgIHwgIDU5ICstLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmggICAgICAgICAgIHwgICAzICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
Z3RfZmx1c2hfdGVzdC5jICAgfCAgIDkgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF9saXZlX3Rlc3QuYyAgICB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9j
a19nZW1fZGV2aWNlLmMgIHwgICA5ICstCiAyMSBmaWxlcyBjaGFuZ2VkLCAyMDMgaW5zZXJ0aW9u
cygrKSwgMTQ1IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpp
bmRleCA2NThiOTMwZDM0YTguLmFiNWZhNThkMjRmNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAg
LTgzLDYgKzgzLDcgQEAgZ3QteSArPSBcCiAJZ3QvaW50ZWxfZ3RfaXJxLm8gXAogCWd0L2ludGVs
X2d0X3BtLm8gXAogCWd0L2ludGVsX2d0X3BtX2lycS5vIFwKKwlndC9pbnRlbF9ndF9yZXF1ZXN0
cy5vIFwKIAlndC9pbnRlbF9oYW5nY2hlY2subyBcCiAJZ3QvaW50ZWxfbHJjLm8gXAogCWd0L2lu
dGVsX3JlbmRlcnN0YXRlLm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFu
LmMKaW5kZXggNzYxYWIwMDc2YTZhLi5lMGJmYzAyMWVjNmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAtOCw2ICs4LDcgQEAKICNpbmNsdWRlIDxsaW51eC9z
aXplcy5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9n
dF9yZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2dl
bV9ndHQuaCIKQEAgLTQyMSw2ICs0MjIsNyBAQCB2b2lkIGk5MTVfZ2VtX29iamVjdF9yZWxlYXNl
X21tYXAoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0YXRpYyBpbnQgY3JlYXRl
X21tYXBfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJaW50IGVycjsKIAogCWVyciA9IGRybV9nZW1f
Y3JlYXRlX21tYXBfb2Zmc2V0KCZvYmotPmJhc2UpOwpAQCAtNDI5LDcgKzQzMSw3IEBAIHN0YXRp
YyBpbnQgY3JlYXRlX21tYXBfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiAKIAkvKiBBdHRlbXB0IHRvIHJlYXAgc29tZSBtbWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3Rz
ICovCiAJZG8gewotCQllcnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKKwkJZXJyID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShndCwgTUFYX1ND
SEVEVUxFX1RJTUVPVVQpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKQEAgLTQzOCw3ICs0NDAs
NyBAQCBzdGF0aWMgaW50IGNyZWF0ZV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQogCQlpZiAoIWVycikKIAkJCWJyZWFrOwogCi0JfSB3aGlsZSAoZmx1c2hfZGVs
YXllZF93b3JrKCZpOTE1LT5nZW0ucmV0aXJlX3dvcmspKTsKKwl9IHdoaWxlIChmbHVzaF9kZWxh
eWVkX3dvcmsoJmd0LT5yZXF1ZXN0cy5yZXRpcmVfd29yaykpOwogCiAJcmV0dXJuIGVycjsKIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggYWZiY2Y5MjE5MjY3Li5i
NDU5NzE5Mzg2ZTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC03
LDMxICs3LDE4IEBACiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVkZSAiZ3Qv
aW50ZWxfZ3QuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgorI2luY2x1ZGUgImd0L2lu
dGVsX2d0X3JlcXVlc3RzLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5
MTVfZ2xvYmFscy5oIgogCiBzdGF0aWMgdm9pZCBpOTE1X2dlbV9wYXJrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCWNhbmNlbF9kZWxheWVkX3dvcmsoJmk5MTUtPmdlbS5yZXRp
cmVfd29yayk7Ci0KIAlpOTE1X3ZtYV9wYXJrZWQoaTkxNSk7CiAKIAlpOTE1X2dsb2JhbHNfcGFy
aygpOwogfQogCi1zdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd29yaykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0JCWNvbnRh
aW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBnZW0ucmV0aXJlX3dvcmsud29yayk7Ci0KLQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1LCAwKTsKLQotCXF1ZXVlX2RlbGF5ZWRfd29yayhpOTE1
LT53cSwKLQkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCi0JCQkgICByb3VuZF9qaWZmaWVz
X3VwX3JlbGF0aXZlKEhaKSk7Ci19Ci0KIHN0YXRpYyBpbnQgcG1fbm90aWZpZXIoc3RydWN0IG5v
dGlmaWVyX2Jsb2NrICpuYiwKIAkJICAgICAgIHVuc2lnbmVkIGxvbmcgYWN0aW9uLAogCQkgICAg
ICAgdm9pZCAqZGF0YSkKQEAgLTQyLDkgKzI5LDYgQEAgc3RhdGljIGludCBwbV9ub3RpZmllcihz
dHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLAogCXN3aXRjaCAoYWN0aW9uKSB7CiAJY2FzZSBJTlRF
TF9HVF9VTlBBUks6CiAJCWk5MTVfZ2xvYmFsc191bnBhcmsoKTsKLQkJcXVldWVfZGVsYXllZF93
b3JrKGk5MTUtPndxLAotCQkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCi0JCQkJICAgcm91
bmRfamlmZmllc191cF9yZWxhdGl2ZShIWikpOwogCQlicmVhazsKIAogCWNhc2UgSU5URUxfR1Rf
UEFSSzoKQEAgLTU5LDcgKzQzLDcgQEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250
ZXh0X3N5bmMoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlib29sIHJlc3VsdCA9ICFpbnRlbF9n
dF9pc193ZWRnZWQoZ3QpOwogCi0JaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUs
IEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CisJaWYgKGludGVsX2d0X3dhaXRf
Zm9yX2lkbGUoZ3QsIEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CiAJCS8qIFhY
WCBoaWRlIHdhcm5pbmcgZnJvbSBnZW1fZWlvICovCiAJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNl
dCkgewogCQkJZGV2X2VycihndC0+aTkxNS0+ZHJtLmRldiwKQEAgLTIxOSw4ICsyMDMsNiBAQCB2
b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogdm9p
ZCBpOTE1X2dlbV9pbml0X19wbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlJ
TklUX0RFTEFZRURfV09SSygmaTkxNS0+Z2VtLnJldGlyZV93b3JrLCByZXRpcmVfd29ya19oYW5k
bGVyKTsKLQogCWk5MTUtPmdlbS5wbV9ub3RpZmllci5ub3RpZmllcl9jYWxsID0gcG1fbm90aWZp
ZXI7CiAJYmxvY2tpbmdfbm90aWZpZXJfY2hhaW5fcmVnaXN0ZXIoJmk5MTUtPmd0LnBtX25vdGlm
aWNhdGlvbnMsCiAJCQkJCSAmaTkxNS0+Z2VtLnBtX25vdGlmaWVyKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXgg
YmM0YzhkNzYzMDI0Li5lODBkMzA5ZjU0MjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC04LDYgKzgsNyBAQAog
CiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIK
KyNpbmNsdWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImd0L2ludGVsX3Jl
c2V0LmgiCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogCkBAIC0zMDQsNyArMzA1LDcgQEAg
Y3JlYXRlX3Rlc3Rfb2JqZWN0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWludCBl
cnI7CiAKIAkvKiBLZWVwIGluIEdFTSdzIGdvb2QgZ3JhY2VzICovCi0JaTkxNV9yZXRpcmVfcmVx
dWVzdHModm0tPmk5MTUsIDApOworCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0cyh2bS0+Z3QsIDAp
OwogCiAJc2l6ZSA9IG1pbih2bS0+dG90YWwgLyAyLCAxMDI0dWxsICogRFdfUEVSX1BBR0UgKiBQ
QUdFX1NJWkUpOwogCXNpemUgPSByb3VuZF9kb3duKHNpemUsIERXX1BFUl9QQUdFICogUEFHRV9T
SVpFKTsKQEAgLTkyMiw3ICs5MjMsNyBAQCBfX3NzZXVfZmluaXNoKGNvbnN0IGNoYXIgKm5hbWUs
CiAJCWlndF9zcGlubmVyX2VuZChzcGluKTsKIAogCWlmICgoZmxhZ3MgJiBURVNUX0lETEUpICYm
IHJldCA9PSAwKSB7Ci0JCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoY2UtPmVuZ2luZS0+
aTkxNSwKKwkJcmV0ID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShjZS0+ZW5naW5lLT5ndCwKIAkJ
CQkJICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYwppbmRleCA4NTYzYWYxODE5YzQuLjM4MmI2YWVmZWZlYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTM4NSw3ICsz
ODUsNyBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJaTkxNV9nZW1fZHJpdmVyX3VucmVnaXN0ZXJfX3Nocmlua2Vy
KGk5MTUpOwogCWludGVsX2d0X3BtX2dldCgmaTkxNS0+Z3QpOwotCWNhbmNlbF9kZWxheWVkX3dv
cmtfc3luYygmaTkxNS0+Z2VtLnJldGlyZV93b3JrKTsKKwljYW5jZWxfZGVsYXllZF93b3JrX3N5
bmMoJmk5MTUtPmd0LnJlcXVlc3RzLnJldGlyZV93b3JrKTsKIH0KIAogc3RhdGljIHZvaWQgcmVz
dG9yZV9yZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXggYzJhZmZmYjk0NDc0Li5mMzg2MjhiZmQzNGMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwpAQCAtNiw2ICs2LDcgQEAKICNpbmNsdWRlICJp
OTE1X2Rydi5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0u
aCIKKyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImludGVsX3VuY29y
ZS5oIgogCiB2b2lkIGludGVsX2d0X2luaXRfZWFybHkoc3RydWN0IGludGVsX2d0ICpndCwgc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCkBAIC0yMCw2ICsyMSw3IEBAIHZvaWQgaW50ZWxf
Z3RfaW5pdF9lYXJseShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAogCWludGVsX2d0X2luaXRfaGFuZ2NoZWNrKGd0KTsKIAlpbnRlbF9ndF9pbml0
X3Jlc2V0KGd0KTsKKwlpbnRlbF9ndF9pbml0X3JlcXVlc3RzKGd0KTsKIAlpbnRlbF9ndF9wbV9p
bml0X2Vhcmx5KGd0KTsKIAlpbnRlbF91Y19pbml0X2Vhcmx5KCZndC0+dWMpOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKaW5kZXggYWE2Y2YwMTUyY2U3Li5mYTk2ZTFhZDdi
ZDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYwpAQCAtMTAsNiArMTAsNyBA
QAogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAj
aW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1ZXN0cy5oIgog
I2luY2x1ZGUgImludGVsX3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfd2FrZXJlZi5oIgogCkBAIC00
OCw2ICs0OSw3IEBAIHN0YXRpYyBpbnQgX19ndF91bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQogCWk5MTVfcG11X2d0X3VucGFya2VkKGk5MTUpOwogCiAJaW50ZWxfZ3RfcXVldWVfaGFu
Z2NoZWNrKGd0KTsKKwlpbnRlbF9ndF91bnBhcmtfcmVxdWVzdHMoZ3QpOwogCiAJcG1fbm90aWZ5
KGk5MTUsIElOVEVMX0dUX1VOUEFSSyk7CiAKQEAgLTU2LDEzICs1OCwxNCBAQCBzdGF0aWMgaW50
IF9fZ3RfdW5wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIAogc3RhdGljIGludCBfX2d0
X3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0KLQkJY29udGFpbmVyX29mKHdmLCB0eXBlb2YoKmk5MTUpLCBndC53YWtlcmVm
KTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZiA9IGZldGNoX2FuZF96ZXJvKCZpOTE1LT5ndC5h
d2FrZSk7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGNvbnRhaW5lcl9vZih3ZiwgdHlwZW9mKCpn
dCksIHdha2VyZWYpOworCWludGVsX3dha2VyZWZfdCB3YWtlcmVmID0gZmV0Y2hfYW5kX3plcm8o
Jmd0LT5hd2FrZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndC0+aTkxNTsK
IAogCUdFTV9UUkFDRSgiXG4iKTsKIAogCXBtX25vdGlmeShpOTE1LCBJTlRFTF9HVF9QQVJLKTsK
KwlpbnRlbF9ndF9wYXJrX3JlcXVlc3RzKGd0KTsKIAogCWk5MTVfcG11X2d0X3BhcmtlZChpOTE1
KTsKIAlpZiAoSU5URUxfR0VOKGk5MTUpID49IDYpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3RfcmVxdWVzdHMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAw
MDAuLjE1YjJhZmNjYjQzNQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMKQEAgLTAsMCArMSwxMTggQEAKKy8qCisgKiBTUERYLUxp
Y2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29y
cG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAiaTkxNV9yZXF1ZXN0LmgiCisjaW5jbHVkZSAiaW50
ZWxfZ3QuaCIKKyNpbmNsdWRlICJpbnRlbF9ndF9wbS5oIgorI2luY2x1ZGUgImludGVsX2d0X3Jl
cXVlc3RzLmgiCisjaW5jbHVkZSAiaW50ZWxfdGltZWxpbmUuaCIKKworc3RhdGljIHZvaWQgcmV0
aXJlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCit7CisJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEsICpybjsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShycSwgcm4sICZ0
bC0+cmVxdWVzdHMsIGxpbmspCisJCWlmICghaTkxNV9yZXF1ZXN0X3JldGlyZShycSkpCisJCQli
cmVhazsKK30KKworbG9uZyBpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMoc3RydWN0IGludGVsX2d0
ICpndCwgbG9uZyB0aW1lb3V0KQoreworCXN0cnVjdCBpbnRlbF9ndF90aW1lbGluZXMgKnRpbWVs
aW5lcyA9ICZndC0+dGltZWxpbmVzOworCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsICp0bjsK
Kwl1bnNpZ25lZCBsb25nIGFjdGl2ZV9jb3VudCA9IDA7CisJdW5zaWduZWQgbG9uZyBmbGFnczsK
KwlMSVNUX0hFQUQoZnJlZSk7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmdGltZWxpbmVzLT5sb2Nr
LCBmbGFncyk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHRsLCB0biwgJnRpbWVsaW5lcy0+
YWN0aXZlX2xpc3QsIGxpbmspIHsKKwkJaWYgKCFtdXRleF90cnlsb2NrKCZ0bC0+bXV0ZXgpKQor
CQkJY29udGludWU7CisKKwkJaW50ZWxfdGltZWxpbmVfZ2V0KHRsKTsKKwkJR0VNX0JVR19PTigh
dGwtPmFjdGl2ZV9jb3VudCk7CisJCXRsLT5hY3RpdmVfY291bnQrKzsgLyogcGluIHRoZSBsaXN0
IGVsZW1lbnQgKi8KKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGltZWxpbmVzLT5sb2NrLCBm
bGFncyk7CisKKwkJaWYgKHRpbWVvdXQgPiAwKSB7CisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZTsKKworCQkJZmVuY2UgPSBpOTE1X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3Qp
OworCQkJaWYgKGZlbmNlKSB7CisJCQkJdGltZW91dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQo
ZmVuY2UsCisJCQkJCQkJCSB0cnVlLAorCQkJCQkJCQkgdGltZW91dCk7CisJCQkJZG1hX2ZlbmNl
X3B1dChmZW5jZSk7CisJCQl9CisJCX0KKworCQlyZXRpcmVfcmVxdWVzdHModGwpOworCisJCXNw
aW5fbG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKKworCQkvKiBSZXN1bWUg
aXRlcmF0aW9uIGFmdGVyIGRyb3BwaW5nIGxvY2sgKi8KKwkJbGlzdF9zYWZlX3Jlc2V0X25leHQo
dGwsIHRuLCBsaW5rKTsKKwkJaWYgKC0tdGwtPmFjdGl2ZV9jb3VudCkKKwkJCWFjdGl2ZV9jb3Vu
dCArPSAhIXJjdV9hY2Nlc3NfcG9pbnRlcih0bC0+bGFzdF9yZXF1ZXN0LmZlbmNlKTsKKwkJZWxz
ZQorCQkJbGlzdF9kZWwoJnRsLT5saW5rKTsKKworCQltdXRleF91bmxvY2soJnRsLT5tdXRleCk7
CisKKwkJLyogRGVmZXIgdGhlIGZpbmFsIHJlbGVhc2UgdG8gYWZ0ZXIgdGhlIHNwaW5sb2NrICov
CisJCWlmIChyZWZjb3VudF9kZWNfYW5kX3Rlc3QoJnRsLT5rcmVmLnJlZmNvdW50KSkgeworCQkJ
R0VNX0JVR19PTih0bC0+YWN0aXZlX2NvdW50KTsKKwkJCWxpc3RfYWRkKCZ0bC0+bGluaywgJmZy
ZWUpOworCQl9CisJfQorCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywg
ZmxhZ3MpOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHRsLCB0biwgJmZyZWUsIGxpbmsp
CisJCV9faW50ZWxfdGltZWxpbmVfZnJlZSgmdGwtPmtyZWYpOworCisJcmV0dXJuIGFjdGl2ZV9j
b3VudCA/IHRpbWVvdXQgOiAwOworfQorCitpbnQgaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShzdHJ1
Y3QgaW50ZWxfZ3QgKmd0LCBsb25nIHRpbWVvdXQpCit7CisJLyogSWYgdGhlIGRldmljZSBpcyBh
c2xlZXAsIHdlIGhhdmUgbm8gcmVxdWVzdHMgb3V0c3RhbmRpbmcgKi8KKwlpZiAoIWludGVsX2d0
X3BtX2lzX2F3YWtlKGd0KSkKKwkJcmV0dXJuIDA7CisKKwl3aGlsZSAoKHRpbWVvdXQgPSBpbnRl
bF9ndF9yZXRpcmVfcmVxdWVzdHMoZ3QsIHRpbWVvdXQpKSA+IDApIHsKKwkJY29uZF9yZXNjaGVk
KCk7CisJCWlmIChzaWduYWxfcGVuZGluZyhjdXJyZW50KSkKKwkJCXJldHVybiAtRUlOVFI7CisJ
fQorCisJcmV0dXJuIHRpbWVvdXQ7Cit9CisKK3N0YXRpYyB2b2lkIHJldGlyZV93b3JrX2hhbmRs
ZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPQor
CQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpndCksIHJlcXVlc3RzLnJldGlyZV93b3JrLndv
cmspOworCisJaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzKGd0LCAwKTsKKwlzY2hlZHVsZV9kZWxh
eWVkX3dvcmsoJmd0LT5yZXF1ZXN0cy5yZXRpcmVfd29yaywKKwkJCSAgICAgIHJvdW5kX2ppZmZp
ZXNfdXBfcmVsYXRpdmUoSFopKTsKK30KKwordm9pZCBpbnRlbF9ndF9pbml0X3JlcXVlc3RzKHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJSU5JVF9ERUxBWUVEX1dPUksoJmd0LT5yZXF1ZXN0cy5y
ZXRpcmVfd29yaywgcmV0aXJlX3dvcmtfaGFuZGxlcik7Cit9CisKK3ZvaWQgaW50ZWxfZ3RfcGFy
a19yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCWNhbmNlbF9kZWxheWVkX3dvcmso
Jmd0LT5yZXF1ZXN0cy5yZXRpcmVfd29yayk7Cit9CisKK3ZvaWQgaW50ZWxfZ3RfdW5wYXJrX3Jl
cXVlc3RzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc2NoZWR1bGVfZGVsYXllZF93b3JrKCZn
dC0+cmVxdWVzdHMucmV0aXJlX3dvcmssCisJCQkgICAgICByb3VuZF9qaWZmaWVzX3VwX3JlbGF0
aXZlKEhaKSk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9n
dF9yZXF1ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMu
aApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmFmMDdkNTRjYTBhZgot
LS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVl
c3RzLmgKQEAgLTAsMCArMSwxOSBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBN
SVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNp
Zm5kZWYgSU5URUxfR1RfUkVRVUVTVFNfSAorI2RlZmluZSBJTlRFTF9HVF9SRVFVRVNUU19ICisK
K3N0cnVjdCBpbnRlbF9ndDsKKworbG9uZyBpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMoc3RydWN0
IGludGVsX2d0ICpndCwgbG9uZyB0aW1lb3V0KTsKK2ludCBpbnRlbF9ndF93YWl0X2Zvcl9pZGxl
KHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGxvbmcgdGltZW91dCk7CisKK3ZvaWQgaW50ZWxfZ3RfaW5p
dF9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKK3ZvaWQgaW50ZWxfZ3RfcGFya19yZXF1
ZXN0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKK3ZvaWQgaW50ZWxfZ3RfdW5wYXJrX3JlcXVlc3Rz
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOworCisjZW5kaWYgLyogSU5URUxfR1RfUkVRVUVTVFNfSCAq
LwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKaW5kZXggZGMyOTVjMTk2
ZDExLi4yZDA0MDQ1OWJkNmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlw
ZXMuaApAQCAtNDksNiArNDksMTcgQEAgc3RydWN0IGludGVsX2d0IHsKIAkJc3RydWN0IGxpc3Rf
aGVhZCBod3NwX2ZyZWVfbGlzdDsKIAl9IHRpbWVsaW5lczsKIAorCXN0cnVjdCBpbnRlbF9ndF9y
ZXF1ZXN0cyB7CisJCS8qKgorCQkgKiBXZSBsZWF2ZSB0aGUgdXNlciBJUlEgb2ZmIGFzIG11Y2gg
YXMgcG9zc2libGUsCisJCSAqIGJ1dCB0aGlzIG1lYW5zIHRoYXQgcmVxdWVzdHMgd2lsbCBmaW5p
c2ggYW5kIG5ldmVyCisJCSAqIGJlIHJldGlyZWQgb25jZSB0aGUgc3lzdGVtIGdvZXMgaWRsZS4g
U2V0IGEgdGltZXIgdG8KKwkJICogZmlyZSBwZXJpb2RpY2FsbHkgd2hpbGUgdGhlIHJpbmcgaXMg
cnVubmluZy4gV2hlbiBpdAorCQkgKiBmaXJlcywgZ28gcmV0aXJlIHJlcXVlc3RzLgorCQkgKi8K
KwkJc3RydWN0IGRlbGF5ZWRfd29yayByZXRpcmVfd29yazsKKwl9IHJlcXVlc3RzOworCiAJc3Ry
dWN0IGludGVsX3dha2VyZWYgd2FrZXJlZjsKIAogCXN0cnVjdCBsaXN0X2hlYWQgY2xvc2VkX3Zt
YTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5l
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCmluZGV4IGIw
YjBmYTVmOTFkZS4uNDQ5MDI5M2VjNzdhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X3RpbWVsaW5lLmMKQEAgLTgsNiArOCw3IEBACiAKICNpbmNsdWRlICJpbnRlbF9lbmdp
bmVfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9ndC5oIgorI2luY2x1ZGUgImludGVsX2d0X3JlcXVl
c3RzLmgiCiAKICNpbmNsdWRlICIuLi9zZWxmdGVzdHMvaTkxNV9yYW5kb20uaCIKICNpbmNsdWRl
ICIuLi9pOTE1X3NlbGZ0ZXN0LmgiCkBAIC02NDEsNiArNjQyLDcgQEAgc3RhdGljIGludCBsaXZl
X2h3c3BfYWx0ZXJuYXRlKHZvaWQgKmFyZykKIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9p
ZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOwogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGw7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQg
aWQ7CkBAIC02NTEsNyArNjUzLDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICph
cmcpCiAJICogZm9yZWlnbiBHUFUgcmVmZXJlbmNlcy4KIAkgKi8KIAotCXRsID0gaW50ZWxfdGlt
ZWxpbmVfY3JlYXRlKCZpOTE1LT5ndCwgTlVMTCk7CisJdGwgPSBpbnRlbF90aW1lbGluZV9jcmVh
dGUoZ3QsIE5VTEwpOwogCWlmIChJU19FUlIodGwpKQogCQlyZXR1cm4gUFRSX0VSUih0bCk7CiAK
QEAgLTY2Miw3ICs2NjQsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykK
IAlpZiAoZXJyKQogCQlnb3RvIG91dF9mcmVlOwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwg
aTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJ
Y29uc3QgdTMyICpod3NwX3NlcW5vWzJdOwogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAkJ
dTMyIHNlcW5vWzJdOwpAQCAtNzM0LDcgKzczNiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dy
YXAodm9pZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAotCQlpOTE1X3JldGlyZV9yZXF1ZXN0
cyhpOTE1LCAwKTsgLyogcmVjeWNsZSBIV1NQICovCisJCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0
cyhndCwgMCk7IC8qIHJlY3ljbGUgSFdTUCAqLwogCX0KIAogb3V0OgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2RlYnVnZnMuYwppbmRleCBkNzQxMGYzZjU3NmYuLjkzNjE3MmY1OGE2NSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTQxLDYgKzQxLDcgQEAKIAogI2luY2x1ZGUgImdl
bS9pOTE1X2dlbV9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKKyNpbmNs
dWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImd0L2ludGVsX3Jlc2V0Lmgi
CiAjaW5jbHVkZSAiZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uaCIKIApAQCAtMzYwMSwzMyAr
MzYwMiwzMyBAQCBzdGF0aWMgaW50CiBpOTE1X2Ryb3BfY2FjaGVzX3NldCh2b2lkICpkYXRhLCB1
NjQgdmFsKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKwlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwogCWludCByZXQ7CiAKIAlEUk1fREVCVUcoIkRy
b3BwaW5nIGNhY2hlczogMHglMDhsbHggWzB4JTA4bGx4XVxuIiwKIAkJICB2YWwsIHZhbCAmIERS
T1BfQUxMKTsKIAogCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FDVElWRSAmJgotCSAgICB3YWl0X2Zv
cihpbnRlbF9lbmdpbmVzX2FyZV9pZGxlKCZpOTE1LT5ndCksCi0JCSAgICAgSTkxNV9JRExFX0VO
R0lORVNfVElNRU9VVCkpCi0JCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkgICAg
d2FpdF9mb3IoaW50ZWxfZW5naW5lc19hcmVfaWRsZShndCksIEk5MTVfSURMRV9FTkdJTkVTX1RJ
TUVPVVQpKQorCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAogCWlmICh2YWwgJiBEUk9QX1JF
VElSRSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSwgMCk7CisJCWludGVsX2d0X3JldGly
ZV9yZXF1ZXN0cyhndCwgMCk7CiAKIAlpZiAodmFsICYgKERST1BfSURMRSB8IERST1BfQUNUSVZF
KSkgewotCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hFRFVMRV9U
SU1FT1VUKTsKKwkJcmV0ID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShndCwgTUFYX1NDSEVEVUxF
X1RJTUVPVVQpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAl9CiAKIAlpZiAodmFsICYg
RFJPUF9JRExFKSB7Ci0JCXJldCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoJmk5MTUtPmd0
KTsKKwkJcmV0ID0gaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCk7CiAJCWlmIChyZXQpCiAJ
CQlyZXR1cm4gcmV0OwogCX0KIAotCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FDVElWRSAmJiBpbnRl
bF9ndF90ZXJtaW5hbGx5X3dlZGdlZCgmaTkxNS0+Z3QpKQotCQlpbnRlbF9ndF9oYW5kbGVfZXJy
b3IoJmk5MTUtPmd0LCBBTExfRU5HSU5FUywgMCwgTlVMTCk7CisJaWYgKHZhbCAmIERST1BfUkVT
RVRfQUNUSVZFICYmIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKGd0KSkKKwkJaW50ZWxfZ3Rf
aGFuZGxlX2Vycm9yKGd0LCBBTExfRU5HSU5FUywgMCwgTlVMTCk7CiAKIAlmc19yZWNsYWltX2Fj
cXVpcmUoR0ZQX0tFUk5FTCk7CiAJaWYgKHZhbCAmIERST1BfQk9VTkQpCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaAppbmRleCAzZDFkNjUyNDMxYmUuLjQ3NWYyNjBiZWM2OSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oCkBAIC0xNzA5LDE1ICsxNzA5LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
ewogCiAJc3RydWN0IHsKIAkJc3RydWN0IG5vdGlmaWVyX2Jsb2NrIHBtX25vdGlmaWVyOwotCi0J
CS8qKgotCQkgKiBXZSBsZWF2ZSB0aGUgdXNlciBJUlEgb2ZmIGFzIG11Y2ggYXMgcG9zc2libGUs
Ci0JCSAqIGJ1dCB0aGlzIG1lYW5zIHRoYXQgcmVxdWVzdHMgd2lsbCBmaW5pc2ggYW5kIG5ldmVy
Ci0JCSAqIGJlIHJldGlyZWQgb25jZSB0aGUgc3lzdGVtIGdvZXMgaWRsZS4gU2V0IGEgdGltZXIg
dG8KLQkJICogZmlyZSBwZXJpb2RpY2FsbHkgd2hpbGUgdGhlIHJpbmcgaXMgcnVubmluZy4gV2hl
biBpdAotCQkgKiBmaXJlcywgZ28gcmV0aXJlIHJlcXVlc3RzLgotCQkgKi8KLQkJc3RydWN0IGRl
bGF5ZWRfd29yayByZXRpcmVfd29yazsKIAl9IGdlbTsKIAogCS8qIEZvciBpOTQ1Z20gdmJsYW5r
IGlycSB2cy4gQzMgd29ya2Fyb3VuZCAqLwpAQCAtMjMxNCw3ICsyMzA1LDYgQEAgdm9pZCBpOTE1
X2dlbV9kcml2ZXJfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9p
ZCBpOTE1X2dlbV9kcml2ZXJfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSk7CiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZW1vdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KTsKLWludCBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgbG9uZyB0aW1lb3V0KTsKIHZvaWQgaTkxNV9nZW1f
c3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpOTE1X2dl
bV9zdXNwZW5kX2xhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQg
aTkxNV9nZW1fcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwppbmRleCBjNWYxYzIwNDNmOTcuLmM1NjgyMDM1NThhOCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jCkBAIC04OTAsMjEgKzg5MCw2IEBAIHZvaWQgaTkxNV9nZW1fcnVu
dGltZV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCX0KIH0KIAotaW50
IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGxv
bmcgdGltZW91dCkKLXsKLQkvKiBJZiB0aGUgZGV2aWNlIGlzIGFzbGVlcCwgd2UgaGF2ZSBubyBy
ZXF1ZXN0cyBvdXRzdGFuZGluZyAqLwotCWlmICghaW50ZWxfZ3RfcG1faXNfYXdha2UoJmk5MTUt
Pmd0KSkKLQkJcmV0dXJuIDA7Ci0KLQl3aGlsZSAoKHRpbWVvdXQgPSBpOTE1X3JldGlyZV9yZXF1
ZXN0cyhpOTE1LCB0aW1lb3V0KSkgPiAwKSB7Ci0JCWNvbmRfcmVzY2hlZCgpOwotCQlpZiAoc2ln
bmFsX3BlbmRpbmcoY3VycmVudCkpCi0JCQlyZXR1cm4gLUVJTlRSOwotCX0KLQotCXJldHVybiB0
aW1lb3V0OwotfQotCiBzdHJ1Y3QgaTkxNV92bWEgKgogaTkxNV9nZW1fb2JqZWN0X2dndHRfcGlu
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgY29uc3Qgc3RydWN0IGk5MTVf
Z2d0dF92aWV3ICp2aWV3LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKaW5kZXgg
NzA4MDU1YTM4ODdlLi44MDMwMjQxOGE1OTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
ZXZpY3QuYwpAQCAtMjksNiArMjksNyBAQAogI2luY2x1ZGUgPGRybS9pOTE1X2RybS5oPgogCiAj
aW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndF9y
ZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X3RyYWNl
LmgiCkBAIC0zNyw3ICszOCw3IEBAIEk5MTVfU0VMRlRFU1RfREVDTEFSRShzdGF0aWMgc3RydWN0
IGlndF9ldmljdF9jdGwgewogCWJvb2wgZmFpbF9pZl9idXN5OjE7CiB9IGlndF9ldmljdF9jdGw7
KQogCi1zdGF0aWMgaW50IGdndHRfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CitzdGF0aWMgaW50IGdndHRfZmx1c2goc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAkvKgogCSAq
IE5vdCBldmVyeXRoaW5nIGluIHRoZSBHR1RUIGlzIHRyYWNrZWQgdmlhIHZtYSAob3RoZXJ3aXNl
IHdlCkBAIC00Niw3ICs0Nyw3IEBAIHN0YXRpYyBpbnQgZ2d0dF9mbHVzaChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAkgKiB0aGUgaG9wZXMgdGhhdCB3ZSBjYW4gdGhlbiByZW1vdmUg
Y29udGV4dHMgYW5kIHRoZSBsaWtlIG9ubHkKIAkgKiBib3VuZCBieSB0aGVpciBhY3RpdmUgcmVm
ZXJlbmNlLgogCSAqLwotCXJldHVybiBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKTsKKwlyZXR1cm4gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShndCwgTUFY
X1NDSEVEVUxFX1RJTUVPVVQpOwogfQogCiBzdGF0aWMgYm9vbApAQCAtOTIsNyArOTMsNiBAQCBp
OTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJ
CQkgdTY0IHN0YXJ0LCB1NjQgZW5kLAogCQkJIHVuc2lnbmVkIGZsYWdzKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZtLT5pOTE1OwogCXN0cnVjdCBkcm1fbW1fc2Nh
biBzY2FuOwogCXN0cnVjdCBsaXN0X2hlYWQgZXZpY3Rpb25fbGlzdDsKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwgKm5leHQ7CkBAIC0xMjQsNyArMTI0LDcgQEAgaTkxNV9nZW1fZXZpY3Rfc29tZXRo
aW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJCSAgICBtaW5fc2l6ZSwgYWxp
Z25tZW50LCBjYWNoZV9sZXZlbCwKIAkJCQkgICAgc3RhcnQsIGVuZCwgbW9kZSk7CiAKLQlpOTE1
X3JldGlyZV9yZXF1ZXN0cyh2bS0+aTkxNSwgMCk7CisJaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3Rz
KHZtLT5ndCwgMCk7CiAKIHNlYXJjaF9hZ2FpbjoKIAlhY3RpdmUgPSBOVUxMOwpAQCAtMTk3LDcg
KzE5Nyw3IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSwKIAlpZiAoSTkxNV9TRUxGVEVTVF9PTkxZKGlndF9ldmljdF9jdGwuZmFpbF9pZl9i
dXN5KSkKIAkJcmV0dXJuIC1FQlVTWTsKIAotCXJldCA9IGdndHRfZmx1c2goZGV2X3ByaXYpOwor
CXJldCA9IGdndHRfZmx1c2godm0tPmd0KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCkBA
IC0yNzEsNyArMjcxLDcgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtLAogCSAqIGEgc3RyYXkgcGluIChwcmV2ZW50aW5nIGV2aWN0aW9u
KSB0aGF0IGNhbiBvbmx5IGJlIHJlc29sdmVkIGJ5CiAJICogcmV0aXJpbmcuCiAJICovCi0JaTkx
NV9yZXRpcmVfcmVxdWVzdHModm0tPmk5MTUsIDApOworCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0
cyh2bS0+Z3QsIDApOwogCiAJY2hlY2tfY29sb3IgPSB2bS0+bW0uY29sb3JfYWRqdXN0OwogCWlm
IChjaGVja19jb2xvcikgewpAQCAtMzc0LDcgKzM3NCw3IEBAIGludCBpOTE1X2dlbV9ldmljdF92
bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAkgKiBzd2l0Y2ggb3RoZXJ3aXNlIGlz
IGluZWZmZWN0aXZlLgogCSAqLwogCWlmIChpOTE1X2lzX2dndHQodm0pKSB7Ci0JCXJldCA9IGdn
dHRfZmx1c2godm0tPmk5MTUpOworCQlyZXQgPSBnZ3R0X2ZsdXNoKHZtLT5ndCk7CiAJCWlmIChy
ZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKaW5k
ZXggMmI3YTRkNDliMmU2Li45YjliYmMyNGU3OWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jCkBAIC0zOCw2ICszOCw3IEBACiAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2Zyb250
YnVmZmVyLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9n
dF9yZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X3Nj
YXR0ZXJsaXN0LmgiCkBAIC0yNTI0LDcgKzI1MjUsOCBAQCB2b2lkIGk5MTVfZ2VtX2d0dF9maW5p
c2hfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlzdHJ1Y3QgaTkxNV9n
Z3R0ICpnZ3R0ID0gJmRldl9wcml2LT5nZ3R0OwogCiAJaWYgKHVubGlrZWx5KGdndHQtPmRvX2lk
bGVfbWFwcykpIHsKLQkJaWYgKGk5MTVfcmV0aXJlX3JlcXVlc3RzKGRldl9wcml2LCBNQVhfU0NI
RURVTEVfVElNRU9VVCkpIHsKKwkJaWYgKGludGVsX2d0X3JldGlyZV9yZXF1ZXN0cyhnZ3R0LT52
bS5ndCwKKwkJCQkJICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCkpIHsKIAkJCURSTV9FUlJPUigi
RmFpbGVkIHRvIHdhaXQgZm9yIGlkbGU7IFZUJ2QgbWF5IGhhbmcuXG4iKTsKIAkJCS8qIFdhaXQg
YSBiaXQsIGluIGhvcGVzIGl0IGF2b2lkcyB0aGUgaGFuZyAqLwogCQkJdWRlbGF5KDEwKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggMWM1ZTgwNGM5Y2EyLi4yZDIwZWMyMTFj
YjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0xOTUsNyArMTk1LDcgQEAg
c3RhdGljIHZvaWQgZnJlZV9jYXB0dXJlX2xpc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVz
dCkKIAl9CiB9CiAKLXN0YXRpYyBib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEpCitib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpCiB7CiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmcnEtPnRpbWVsaW5lLT5tdXRleCk7CiAK
QEAgLTE0MjksNjMgKzE0MjksNiBAQCBsb25nIGk5MTVfcmVxdWVzdF93YWl0KHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxLAogCXJldHVybiB0aW1lb3V0OwogfQogCi1sb25nIGk5MTVfcmV0aXJlX3Jl
cXVlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBsb25nIHRpbWVvdXQpCi17Ci0J
c3RydWN0IGludGVsX2d0X3RpbWVsaW5lcyAqdGltZWxpbmVzID0gJmk5MTUtPmd0LnRpbWVsaW5l
czsKLQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCAqdG47Ci0JdW5zaWduZWQgbG9uZyBhY3Rp
dmVfY291bnQgPSAwOwotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0JTElTVF9IRUFEKGZyZWUpOwot
Ci0Jc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCWxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZSh0bCwgdG4sICZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCBsaW5rKSB7
Ci0JCWlmICghbXV0ZXhfdHJ5bG9jaygmdGwtPm11dGV4KSkKLQkJCWNvbnRpbnVlOwotCi0JCWlu
dGVsX3RpbWVsaW5lX2dldCh0bCk7Ci0JCUdFTV9CVUdfT04oIXRsLT5hY3RpdmVfY291bnQpOwot
CQl0bC0+YWN0aXZlX2NvdW50Kys7IC8qIHBpbiB0aGUgbGlzdCBlbGVtZW50ICovCi0JCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCi0JCWlmICh0aW1l
b3V0ID4gMCkgewotCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7Ci0KLQkJCWZlbmNlID0gaTkx
NV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKLQkJCWlmIChmZW5jZSkgewot
CQkJCXRpbWVvdXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLAotCQkJCQkJCQkgdHJ1
ZSwKLQkJCQkJCQkJIHRpbWVvdXQpOwotCQkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCQkJfQot
CQl9Ci0KLQkJcmV0aXJlX3JlcXVlc3RzKHRsKTsKLQotCQlzcGluX2xvY2tfaXJxc2F2ZSgmdGlt
ZWxpbmVzLT5sb2NrLCBmbGFncyk7Ci0KLQkJLyogUmVzdW1lIGl0ZXJhdGlvbiBhZnRlciBkcm9w
cGluZyBsb2NrICovCi0JCWxpc3Rfc2FmZV9yZXNldF9uZXh0KHRsLCB0biwgbGluayk7Ci0JCWlm
ICgtLXRsLT5hY3RpdmVfY291bnQpCi0JCQlhY3RpdmVfY291bnQgKz0gISFyY3VfYWNjZXNzX3Bv
aW50ZXIodGwtPmxhc3RfcmVxdWVzdC5mZW5jZSk7Ci0JCWVsc2UKLQkJCWxpc3RfZGVsKCZ0bC0+
bGluayk7Ci0KLQkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwotCi0JCS8qIERlZmVyIHRoZSBm
aW5hbCByZWxlYXNlIHRvIGFmdGVyIHRoZSBzcGlubG9jayAqLwotCQlpZiAocmVmY291bnRfZGVj
X2FuZF90ZXN0KCZ0bC0+a3JlZi5yZWZjb3VudCkpIHsKLQkJCUdFTV9CVUdfT04odGwtPmFjdGl2
ZV9jb3VudCk7Ci0JCQlsaXN0X2FkZCgmdGwtPmxpbmssICZmcmVlKTsKLQkJfQotCX0KLQlzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQotCWxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZSh0bCwgdG4sICZmcmVlLCBsaW5rKQotCQlfX2ludGVsX3RpbWVsaW5l
X2ZyZWUoJnRsLT5rcmVmKTsKLQotCXJldHVybiBhY3RpdmVfY291bnQgPyB0aW1lb3V0IDogMDsK
LX0KLQogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQogI2luY2x1ZGUg
InNlbGZ0ZXN0cy9tb2NrX3JlcXVlc3QuYyIKICNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9yZXF1
ZXN0LmMiCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCmluZGV4IDJhNWQ2ODJhYTZiMS4u
ZGU5YWQ5MjE0NWQyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaApAQCAtMjUwLDYg
KzI1MCw3IEBAIHN0cnVjdCBpOTE1X3JlcXVlc3QgKl9faTkxNV9yZXF1ZXN0X2NvbW1pdChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KTsKIHZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJCQkgIGNvbnN0IHN0cnVjdCBpOTE1X3NjaGVkX2F0dHIg
KmF0dHIpOwogCitib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpOwogdm9pZCBpOTE1X3JlcXVlc3RfcmV0aXJlX3VwdG8oc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpOwogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgpAQCAtNDM5LDYgKzQ0
MCw0IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3JlcXVlc3RfaGFzX25vcHJlZW1wdChjb25z
dCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlyZXR1cm4gdW5saWtlbHkocnEtPmZsYWdzICYg
STkxNV9SRVFVRVNUX05PUFJFRU1QVCk7CiB9CiAKLWxvbmcgaTkxNV9yZXRpcmVfcmVxdWVzdHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGxvbmcgdGltZW91dCk7Ci0KICNlbmRpZiAv
KiBJOTE1X1JFUVVFU1RfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aWd0X2ZsdXNoX3Rlc3QuYwppbmRleCBlZDQ5NmJkNmQ4NGYuLjdiMDkzOWUzZjAwNyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKQEAgLTQs
OCArNCw4IEBACiAgKiBDb3B5cmlnaHQgwqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgogICovCiAK
LSNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0
LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKIAogI2luY2x1ZGUgImk5MTVf
ZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgpAQCAtMTQsMTEgKzE0LDEyIEBACiAK
IGludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlp
bnQgcmV0ID0gaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkgPyAtRUlPIDogMDsKKwlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OworCWludCByZXQgPSBpbnRlbF9ndF9pc193ZWRn
ZWQoZ3QpID8gLUVJTyA6IDA7CiAKIAljb25kX3Jlc2NoZWQoKTsKIAotCWlmIChpOTE1X2dlbV93
YWl0X2Zvcl9pZGxlKGk5MTUsIEhaIC8gNSkgPT0gLUVUSU1FKSB7CisJaWYgKGludGVsX2d0X3dh
aXRfZm9yX2lkbGUoZ3QsIEhaIC8gNSkgPT0gLUVUSU1FKSB7CiAJCXByX2VycigiJXBTIHRpbWVk
IG91dCwgY2FuY2VsbGluZyBhbGwgZnVydGhlciB0ZXN0aW5nLlxuIiwKIAkJICAgICAgIF9fYnVp
bHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7CiAKQEAgLTI2LDcgKzI3LDcgQEAgaW50IGlndF9mbHVz
aF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQkJICBfX2J1aWx0aW5fcmV0
dXJuX2FkZHJlc3MoMCkpOwogCQlHRU1fVFJBQ0VfRFVNUCgpOwogCi0JCWludGVsX2d0X3NldF93
ZWRnZWQoJmk5MTUtPmd0KTsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCXJldCA9IC1F
SU87CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0
X2xpdmVfdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rl
c3QuYwppbmRleCBlYWU5MGY5N2RmNmMuLjgxMGI2MDEwMGMyYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCkBAIC00LDcgKzQsOCBAQAogICog
Q29weXJpZ2h0IMKpIDIwMTggSW50ZWwgQ29ycG9yYXRpb24KICAqLwogCi0jaW5jbHVkZSAiLi4v
aTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0
X3JlcXVlc3RzLmgiCiAKICNpbmNsdWRlICIuLi9pOTE1X3NlbGZ0ZXN0LmgiCiAjaW5jbHVkZSAi
aWd0X2ZsdXNoX3Rlc3QuaCIKQEAgLTIzLDcgKzI0LDcgQEAgaW50IGlndF9saXZlX3Rlc3RfYmVn
aW4oc3RydWN0IGlndF9saXZlX3Rlc3QgKnQsCiAJdC0+ZnVuYyA9IGZ1bmM7CiAJdC0+bmFtZSA9
IG5hbWU7CiAKLQllcnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hFRFVM
RV9USU1FT1VUKTsKKwllcnIgPSBpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCwgTUFY
X1NDSEVEVUxFX1RJTUVPVVQpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCIlcyglcyk6IGZhaWxl
ZCB0byBpZGxlIGJlZm9yZSwgd2l0aCBlcnI9JWQhIiwKIAkJICAgICAgIGZ1bmMsIG5hbWUsIGVy
cik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1f
ZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNl
LmMKaW5kZXggNjZjYzU2MzRkYjFjLi5hZjAzNTZlNjZhNDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTI2LDYgKzI2LDcgQEAK
ICNpbmNsdWRlIDxsaW51eC9wbV9ydW50aW1lLmg+CiAKICNpbmNsdWRlICJndC9pbnRlbF9ndC5o
IgorI2luY2x1ZGUgImd0L2ludGVsX2d0X3JlcXVlc3RzLmgiCiAjaW5jbHVkZSAiZ3QvbW9ja19l
bmdpbmUuaCIKIAogI2luY2x1ZGUgIm1vY2tfcmVxdWVzdC5oIgpAQCAtNDQsNyArNDUsNyBAQCB2
b2lkIG1vY2tfZGV2aWNlX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWRv
IHsKIAkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCQltb2NrX2VuZ2luZV9m
bHVzaChlbmdpbmUpOwotCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUsIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKSk7CisJfSB3aGlsZSAoaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzKCZp
OTE1LT5ndCwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpKTsKIH0KIAogc3RhdGljIHZvaWQgbW9ja19k
ZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQpAQCAtOTgsMTAgKzk5LDYgQEAg
c3RhdGljIHZvaWQgcmVsZWFzZV9kZXYoc3RydWN0IGRldmljZSAqZGV2KQogCWtmcmVlKHBkZXYp
OwogfQogCi1zdGF0aWMgdm9pZCBtb2NrX3JldGlyZV93b3JrX2hhbmRsZXIoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKQotewotfQotCiBzdGF0aWMgaW50IHBtX2RvbWFpbl9yZXN1bWUoc3RydWN0
IGRldmljZSAqZGV2KQogewogCXJldHVybiBwbV9nZW5lcmljX3J1bnRpbWVfcmVzdW1lKGRldik7
CkBAIC0xODAsOCArMTc3LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2Rl
dmljZSh2b2lkKQogCiAJbW9ja19pbml0X2NvbnRleHRzKGk5MTUpOwogCi0JSU5JVF9ERUxBWUVE
X1dPUksoJmk5MTUtPmdlbS5yZXRpcmVfd29yaywgbW9ja19yZXRpcmVfd29ya19oYW5kbGVyKTsK
LQogCWk5MTUtPmd0LmF3YWtlID0gdHJ1ZTsKIAogCWludGVsX3RpbWVsaW5lc19pbml0KGk5MTUp
OwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
Zng=

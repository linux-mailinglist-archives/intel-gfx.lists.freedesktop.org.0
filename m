Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F0B7B432EE
	for <lists+intel-gfx@lfdr.de>; Thu, 13 Jun 2019 08:20:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9EFCB89070;
	Thu, 13 Jun 2019 06:20:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CC41789296
 for <intel-gfx@lists.freedesktop.org>; Thu, 13 Jun 2019 06:20:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16883629-1500050 
 for multiple; Thu, 13 Jun 2019 07:20:23 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 13 Jun 2019 07:20:20 +0100
Message-Id: <20190613062021.27094-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190613062021.27094-1-chris@chris-wilson.co.uk>
References: <20190613062021.27094-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/4] drm/i915: Move fence register tracking from
 i915->mm to ggtt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgdGhlIGZlbmNlIHJlZ2lzdGVycyBvbmx5IGFwcGx5IHRvIHJlZ2lvbnMgaW5zaWRlIHRoZSBH
R1RUIGlzIG1ha2VzCm1vcmUgc2Vuc2UgdGhhdCB3ZSB0cmFjayB0aGVzZSBhcyBwYXJ0IG9mIHRo
ZSBpOTE1X2dndHQgYW5kIG5vdCB0aGUKZ2VuZXJhbCBtbS4gSW4gdGhlIG5leHQgcGF0Y2gsIHdl
IHdpbGwgdGhlbiBwdWxsIHRoZSByZWdpc3RlciBsb2NraW5nCnVuZGVybmVhdGggdGhlIGk5MTVf
Z2d0dC5tdXRleC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2ls
c29uLmNvLnVrPgpSZXZpZXdlZC1ieTogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51
eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4u
YyAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAgfCAg
MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyAgICAgfCAgNiArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMgICAgfCAgNyArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L2d2dC5oICAgICAgICAgICAgfCAgNCArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgfCA0MiArKysrKystLS0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAgICAgICAgfCAgMyArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgfCAyOCAtLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jICAgICAgICAgICB8IDUyICsrKy0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jIHwgOTAgKysrKysrKysrKysrKysrKy0tLS0t
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5oIHwgMTkgKysrKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgICAgIHwgIDIgKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggICAgICAgfCAxNCArKystCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jICAgICB8ICA2ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3ZtYS5oICAgICAgICAgICB8ICAyICstCiAxNSBmaWxlcyBjaGFuZ2VkLCAxNDQg
aW5zZXJ0aW9ucygrKSwgMTM3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fbW1hbi5jCmluZGV4IGM3YjliMzRkZTAxYi4uYThiOGI5YzI4MWYxIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKQEAgLTMxMCw5ICszMTAsOSBAQCB2
bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCS8qIE1hcmsg
YXMgYmVpbmcgbW1hcHBlZCBpbnRvIHVzZXJzcGFjZSBmb3IgbGF0ZXIgcmV2b2NhdGlvbiAqLwog
CWFzc2VydF9ycG1fd2FrZWxvY2tfaGVsZChpOTE1KTsKIAlpZiAoIWk5MTVfdm1hX3NldF91c2Vy
ZmF1bHQodm1hKSAmJiAhb2JqLT51c2VyZmF1bHRfY291bnQrKykKLQkJbGlzdF9hZGQoJm9iai0+
dXNlcmZhdWx0X2xpbmssICZpOTE1LT5tbS51c2VyZmF1bHRfbGlzdCk7CisJCWxpc3RfYWRkKCZv
YmotPnVzZXJmYXVsdF9saW5rLCAmaTkxNS0+Z2d0dC51c2VyZmF1bHRfbGlzdCk7CiAJaWYgKENP
TkZJR19EUk1fSTkxNV9VU0VSRkFVTFRfQVVUT1NVU1BFTkQpCi0JCWludGVsX3dha2VyZWZfYXV0
bygmaTkxNS0+bW0udXNlcmZhdWx0X3dha2VyZWYsCisJCWludGVsX3dha2VyZWZfYXV0bygmaTkx
NS0+Z2d0dC51c2VyZmF1bHRfd2FrZXJlZiwKIAkJCQkgICBtc2Vjc190b19qaWZmaWVzX3RpbWVv
dXQoQ09ORklHX0RSTV9JOTE1X1VTRVJGQVVMVF9BVVRPU1VTUEVORCkpOwogCUdFTV9CVUdfT04o
IW9iai0+dXNlcmZhdWx0X2NvdW50KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
cG0uYwppbmRleCAwM2FmNzgxNTFhZWIuLmEzM2Y2OTYxMGQ2ZiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTEyNSw3ICsxMjUsNyBAQCB2b2lkIGk5MTVfZ2VtX3N1
c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJR0VNX1RSQUNFKCJcbiIp
OwogCi0JaW50ZWxfd2FrZXJlZl9hdXRvKCZpOTE1LT5tbS51c2VyZmF1bHRfd2FrZXJlZiwgMCk7
CisJaW50ZWxfd2FrZXJlZl9hdXRvKCZpOTE1LT5nZ3R0LnVzZXJmYXVsdF93YWtlcmVmLCAwKTsK
IAlmbHVzaF93b3JrcXVldWUoaTkxNS0+d3EpOwogCiAJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
ZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwppbmRleCA5NTJl
MTFiNGI1YzUuLjNiODhiYmQzNzI3NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfcmVzZXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNl
dC5jCkBAIC02OTUsMTkgKzY5NSwxOSBAQCBzdGF0aWMgdm9pZCByZXZva2VfbW1hcHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IGk7CiAKLQlmb3IgKGkgPSAwOyBpIDwg
aTkxNS0+bnVtX2ZlbmNlX3JlZ3M7IGkrKykgeworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT5nZ3R0
Lm51bV9mZW5jZXM7IGkrKykgewogCQlzdHJ1Y3QgZHJtX3ZtYV9vZmZzZXRfbm9kZSAqbm9kZTsK
IAkJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJCXU2NCB2bWFfb2Zmc2V0OwogCi0JCXZtYSA9IFJF
QURfT05DRShpOTE1LT5mZW5jZV9yZWdzW2ldLnZtYSk7CisJCXZtYSA9IFJFQURfT05DRShpOTE1
LT5nZ3R0LmZlbmNlX3JlZ3NbaV0udm1hKTsKIAkJaWYgKCF2bWEpCiAJCQljb250aW51ZTsKIAog
CQlpZiAoIWk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSkKIAkJCWNvbnRpbnVlOwogCi0JCUdF
TV9CVUdfT04odm1hLT5mZW5jZSAhPSAmaTkxNS0+ZmVuY2VfcmVnc1tpXSk7CisJCUdFTV9CVUdf
T04odm1hLT5mZW5jZSAhPSAmaTkxNS0+Z2d0dC5mZW5jZV9yZWdzW2ldKTsKIAkJbm9kZSA9ICZ2
bWEtPm9iai0+YmFzZS52bWFfbm9kZTsKIAkJdm1hX29mZnNldCA9IHZtYS0+Z2d0dF92aWV3LnBh
cnRpYWwub2Zmc2V0IDw8IFBBR0VfU0hJRlQ7CiAJCXVubWFwX21hcHBpbmdfcmFuZ2UoaTkxNS0+
ZHJtLmFub25faW5vZGUtPmlfbWFwcGluZywKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9hcGVydHVyZV9nbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJl
X2dtLmMKaW5kZXggMWZhMmY2NWMzY2QxLi40MDk4OTAyYmZhZWIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d2dC9hcGVydHVyZV9nbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9hcGVydHVyZV9nbS5jCkBAIC0zNSw2ICszNSw3IEBACiAgKi8KIAogI2luY2x1ZGUg
Imk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fZmVuY2VfcmVnLmgiCiAjaW5jbHVkZSAi
Z3Z0LmgiCiAKIHN0YXRpYyBpbnQgYWxsb2NfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGJv
b2wgaGlnaF9nbSkKQEAgLTEyOCw3ICsxMjksNyBAQCB2b2lkIGludGVsX3ZncHVfd3JpdGVfZmVu
Y2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiB7CiAJc3RydWN0IGludGVsX2d2dCAqZ3Z0ID0g
dmdwdS0+Z3Z0OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd2dC0+ZGV2
X3ByaXY7Ci0Jc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqcmVnOworCXN0cnVjdCBpOTE1X2Zl
bmNlX3JlZyAqcmVnOwogCWk5MTVfcmVnX3QgZmVuY2VfcmVnX2xvLCBmZW5jZV9yZWdfaGk7CiAK
IAlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoZGV2X3ByaXYpOwpAQCAtMTYzLDcgKzE2NCw3IEBA
IHN0YXRpYyB2b2lkIGZyZWVfdmdwdV9mZW5jZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIHsK
IAlzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQgPSB2Z3B1LT5ndnQ7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZ3Z0LT5kZXZfcHJpdjsKLQlzdHJ1Y3QgZHJtX2k5MTVfZmVuY2Vf
cmVnICpyZWc7CisJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpyZWc7CiAJdTMyIGk7CiAKIAlpZiAo
V0FSTl9PTighdmdwdV9mZW5jZV9zeih2Z3B1KSkpCkBAIC0xODcsNyArMTg4LDcgQEAgc3RhdGlj
IGludCBhbGxvY192Z3B1X2ZlbmNlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogewogCXN0cnVj
dCBpbnRlbF9ndnQgKmd2dCA9IHZncHUtPmd2dDsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBndnQtPmRldl9wcml2OwotCXN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKnJl
ZzsKKwlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKnJlZzsKIAlpbnQgaTsKIAogCWludGVsX3J1bnRp
bWVfcG1fZ2V0KGRldl9wcml2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2
dC9ndnQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9ndnQuaAppbmRleCBiNTRmMmJkYzEz
YTQuLmRmZDEwY2Y4MmI2NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2d2
dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9ndnQuaApAQCAtODcsNyArODcsNyBA
QCBzdHJ1Y3QgaW50ZWxfdmdwdV9nbSB7CiAKIC8qIEZlbmNlcyBvd25lZCBieSBhIHZHUFUgKi8K
IHN0cnVjdCBpbnRlbF92Z3B1X2ZlbmNlIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpy
ZWdzW0lOVEVMX0dWVF9NQVhfTlVNX0ZFTkNFU107CisJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpy
ZWdzW0lOVEVMX0dWVF9NQVhfTlVNX0ZFTkNFU107CiAJdTMyIGJhc2U7CiAJdTMyIHNpemU7CiB9
OwpAQCAtMzkwLDcgKzM5MCw3IEBAIGludCBpbnRlbF9ndnRfbG9hZF9maXJtd2FyZShzdHJ1Y3Qg
aW50ZWxfZ3Z0ICpndnQpOwogI2RlZmluZSBndnRfaGlkZGVuX2dtYWRyX2VuZChndnQpIChndnRf
aGlkZGVuX2dtYWRyX2Jhc2UoZ3Z0KSBcCiAJCQkJICAgKyBndnRfaGlkZGVuX3N6KGd2dCkgLSAx
KQogCi0jZGVmaW5lIGd2dF9mZW5jZV9zeihndnQpIChndnQtPmRldl9wcml2LT5udW1fZmVuY2Vf
cmVncykKKyNkZWZpbmUgZ3Z0X2ZlbmNlX3N6KGd2dCkgKChndnQpLT5kZXZfcHJpdi0+Z2d0dC5u
dW1fZmVuY2VzKQogCiAvKiBBcGVydHVyZS9HTSBzcGFjZSBkZWZpbml0aW9ucyBmb3IgdkdQVSAq
LwogI2RlZmluZSB2Z3B1X2FwZXJ0dXJlX29mZnNldCh2Z3B1KQkoKHZncHUpLT5nbS5sb3dfZ21f
bm9kZS5zdGFydCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggMDI2ZmI0NjAy
MGY2Li4zMjM4NjM1MDQxMTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0x
NDMsOCArMTQzLDYgQEAgZGVzY3JpYmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAl1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0czsK
IAlpbnQgcGluX2NvdW50ID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5k
ZXYtPnN0cnVjdF9tdXRleCk7Ci0KIAlzZXFfcHJpbnRmKG0sICIlcEs6ICVjJWMlYyVjJWMgJTh6
ZEtpQiAlMDJ4ICUwMnggJXMlcyVzIiwKIAkJICAgJm9iai0+YmFzZSwKIAkJICAgZ2V0X2FjdGl2
ZV9mbGFnKG9iaiksCkBAIC0xNjAsMTcgKzE1OCwxNyBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNl
cV9maWxlICptLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCQkgICBvYmotPm1t
Lm1hZHYgPT0gSTkxNV9NQURWX0RPTlRORUVEID8gIiBwdXJnZWFibGUiIDogIiIpOwogCWlmIChv
YmotPmJhc2UubmFtZSkKIAkJc2VxX3ByaW50ZihtLCAiIChuYW1lOiAlZCkiLCBvYmotPmJhc2Uu
bmFtZSk7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZvYmotPnZtYS5saXN0LCBvYmpfbGlu
aykgewotCQlpZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpCi0JCQlwaW5fY291bnQrKzsKLQl9
Ci0Jc2VxX3ByaW50ZihtLCAiIChwaW5uZWQgeCAlZCkiLCBwaW5fY291bnQpOwotCWlmIChvYmot
PnBpbl9nbG9iYWwpCi0JCXNlcV9wcmludGYobSwgIiAoZ2xvYmFsKSIpOworCisJc3Bpbl9sb2Nr
KCZvYmotPnZtYS5sb2NrKTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJm9iai0+dm1hLmxp
c3QsIG9ial9saW5rKSB7CiAJCWlmICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUp
KQogCQkJY29udGludWU7CiAKKwkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOworCisJCWlm
IChpOTE1X3ZtYV9pc19waW5uZWQodm1hKSkKKwkJCXBpbl9jb3VudCsrOworCiAJCXNlcV9wcmlu
dGYobSwgIiAoJXNndHQgb2Zmc2V0OiAlMDhsbHgsIHNpemU6ICUwOGxseCwgcGFnZXM6ICVzIiwK
IAkJCSAgIGk5MTVfdm1hX2lzX2dndHQodm1hKSA/ICJnIiA6ICJwcCIsCiAJCQkgICB2bWEtPm5v
ZGUuc3RhcnQsIHZtYS0+bm9kZS5zaXplLApAQCAtMjIxLDkgKzIxOSwxNiBAQCBkZXNjcmliZV9v
Ymooc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQog
CQkJCSAgIHZtYS0+ZmVuY2UtPmlkLAogCQkJCSAgIGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQo
JnZtYS0+bGFzdF9mZW5jZSkgPyAiKiIgOiAiIik7CiAJCXNlcV9wdXRzKG0sICIpIik7CisKKwkJ
c3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAl9CisJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxv
Y2spOworCisJc2VxX3ByaW50ZihtLCAiIChwaW5uZWQgeCAlZCkiLCBwaW5fY291bnQpOwogCWlm
IChvYmotPnN0b2xlbikKIAkJc2VxX3ByaW50ZihtLCAiIChzdG9sZW46ICUwOGxseCkiLCBvYmot
PnN0b2xlbi0+c3RhcnQpOworCWlmIChvYmotPnBpbl9nbG9iYWwpCisJCXNlcV9wcmludGYobSwg
IiAoZ2xvYmFsKSIpOwogCiAJZW5naW5lID0gaTkxNV9nZW1fb2JqZWN0X2xhc3Rfd3JpdGVfZW5n
aW5lKG9iaik7CiAJaWYgKGVuZ2luZSkKQEAgLTY5OCwyOCArNzAzLDI1IEBAIHN0YXRpYyBpbnQg
aTkxNV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIHN0
YXRpYyBpbnQgaTkxNV9nZW1fZmVuY2VfcmVnc19pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9p
ZCAqZGF0YSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3Rv
X2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+
ZHJtOwotCWludCBpLCByZXQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2Rl
X3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJdW5zaWduZWQgaW50IGk7CiAKLQlyZXQgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJmRldi0+c3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1
cm4gcmV0OworCXNlcV9wcmludGYobSwgIlRvdGFsIGZlbmNlcyA9ICVkXG4iLCBpOTE1LT5nZ3R0
Lm51bV9mZW5jZXMpOwogCi0Jc2VxX3ByaW50ZihtLCAiVG90YWwgZmVuY2VzID0gJWRcbiIsIGRl
dl9wcml2LT5udW1fZmVuY2VfcmVncyk7Ci0JZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1f
ZmVuY2VfcmVnczsgaSsrKSB7Ci0JCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gZGV2X3ByaXYtPmZl
bmNlX3JlZ3NbaV0udm1hOworCXJjdV9yZWFkX2xvY2soKTsKKwlmb3IgKGkgPSAwOyBpIDwgaTkx
NS0+Z2d0dC5udW1fZmVuY2VzOyBpKyspIHsKKwkJc3RydWN0IGk5MTVfdm1hICp2bWEgPSBpOTE1
LT5nZ3R0LmZlbmNlX3JlZ3NbaV0udm1hOwogCiAJCXNlcV9wcmludGYobSwgIkZlbmNlICVkLCBw
aW4gY291bnQgPSAlZCwgb2JqZWN0ID0gIiwKLQkJCSAgIGksIGRldl9wcml2LT5mZW5jZV9yZWdz
W2ldLnBpbl9jb3VudCk7CisJCQkgICBpLCBpOTE1LT5nZ3R0LmZlbmNlX3JlZ3NbaV0ucGluX2Nv
dW50KTsKIAkJaWYgKCF2bWEpCiAJCQlzZXFfcHV0cyhtLCAidW51c2VkIik7CiAJCWVsc2UKIAkJ
CWRlc2NyaWJlX29iaihtLCB2bWEtPm9iaik7CiAJCXNlcV9wdXRjKG0sICdcbicpOwogCX0KKwly
Y3VfcmVhZF91bmxvY2soKTsKIAotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwog
CXJldHVybiAwOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCA4MWZmMmM3OGZkNTUu
LjI1NGY3YjdkZjMwNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC0zNTAsNyArMzUwLDcg
QEAgc3RhdGljIGludCBpOTE1X2dldHBhcmFtX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHZvaWQgKmRhdGEsCiAJCXZhbHVlID0gcGRldi0+cmV2aXNpb247CiAJCWJyZWFrOwogCWNhc2Ug
STkxNV9QQVJBTV9OVU1fRkVOQ0VTX0FWQUlMOgotCQl2YWx1ZSA9IGRldl9wcml2LT5udW1fZmVu
Y2VfcmVnczsKKwkJdmFsdWUgPSBkZXZfcHJpdi0+Z2d0dC5udW1fZmVuY2VzOwogCQlicmVhazsK
IAljYXNlIEk5MTVfUEFSQU1fSEFTX09WRVJMQVk6CiAJCXZhbHVlID0gZGV2X3ByaXYtPm92ZXJs
YXkgPyAxIDogMDsKQEAgLTE2MjUsNyArMTYyNSw2IEBAIHN0YXRpYyBpbnQgaTkxNV9kcml2ZXJf
aW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaW50ZWxfdW5jb3Jl
X3Nhbml0aXplKGRldl9wcml2KTsKIAogCWludGVsX2d0X2luaXRfd29ya2Fyb3VuZHMoZGV2X3By
aXYpOwotCWk5MTVfZ2VtX2xvYWRfaW5pdF9mZW5jZXMoZGV2X3ByaXYpOwogCiAJLyogT24gdGhl
IDk0NUcvR00sIHRoZSBjaGlwc2V0IHJlcG9ydHMgdGhlIE1TSSBjYXBhYmlsaXR5IG9uIHRoZQog
CSAqIGludGVncmF0ZWQgZ3JhcGhpY3MgZXZlbiB0aG91Z2ggdGhlIHN1cHBvcnQgaXNuJ3QgYWN0
dWFsbHkgdGhlcmUKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGViOThkMjg1ZDI5MC4uOTBk
OTRkOTA0ZTY1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTc1NywxNCArNzU3LDYgQEAg
c3RydWN0IGk5MTVfZ2VtX21tIHsKIAkgKi8KIAlzdHJ1Y3QgbGlzdF9oZWFkIHNocmlua19saXN0
OwogCi0JLyoqIExpc3Qgb2YgYWxsIG9iamVjdHMgaW4gZ3R0X3NwYWNlLCBjdXJyZW50bHkgbW1h
cGVkIGJ5IHVzZXJzcGFjZS4KLQkgKiBBbGwgb2JqZWN0cyB3aXRoaW4gdGhpcyBsaXN0IG11c3Qg
YWxzbyBiZSBvbiBib3VuZF9saXN0LgotCSAqLwotCXN0cnVjdCBsaXN0X2hlYWQgdXNlcmZhdWx0
X2xpc3Q7Ci0KLQkvKiBNYW51YWwgcnVudGltZSBwbSBhdXRvc3VzcGVuZCBkZWxheSBmb3IgdXNl
ciBHR1RUIG1tYXBzICovCi0Jc3RydWN0IGludGVsX3dha2VyZWZfYXV0byB1c2VyZmF1bHRfd2Fr
ZXJlZjsKLQogCS8qKgogCSAqIExpc3Qgb2Ygb2JqZWN0cyB3aGljaCBhcmUgcGVuZGluZyBkZXN0
cnVjdGlvbi4KIAkgKi8KQEAgLTc5NCw5ICs3ODYsNiBAQCBzdHJ1Y3QgaTkxNV9nZW1fbW0gewog
CXN0cnVjdCBub3RpZmllcl9ibG9jayB2bWFwX25vdGlmaWVyOwogCXN0cnVjdCBzaHJpbmtlciBz
aHJpbmtlcjsKIAotCS8qKiBMUlUgbGlzdCBvZiBvYmplY3RzIHdpdGggZmVuY2UgcmVncyBvbiB0
aGVtLiAqLwotCXN0cnVjdCBsaXN0X2hlYWQgZmVuY2VfbGlzdDsKLQogCS8qKgogCSAqIFdvcmtx
dWV1ZSB0byBmYXVsdCBpbiB1c2VycHRyIHBhZ2VzLCBmbHVzaGVkIGJ5IHRoZSBleGVjYnVmCiAJ
ICogd2hlbiByZXF1aXJlZCBidXQgb3RoZXJ3aXNlIGxlZnQgdG8gdXNlcnNwYWNlIHRvIHRyeSBh
Z2FpbgpAQCAtMTQ4NSw5ICsxNDc0LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCS8q
IHByb3RlY3RzIHBhbmVsIHBvd2VyIHNlcXVlbmNlciBzdGF0ZSAqLwogCXN0cnVjdCBtdXRleCBw
cHNfbXV0ZXg7CiAKLQlzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnIGZlbmNlX3JlZ3NbSTkxNV9N
QVhfTlVNX0ZFTkNFU107IC8qIGFzc3VtZSA5NjUgKi8KLQlpbnQgbnVtX2ZlbmNlX3JlZ3M7IC8q
IDggb24gcHJlLTk2NSwgMTYgb3RoZXJ3aXNlICovCi0KIAl1bnNpZ25lZCBpbnQgZnNiX2ZyZXEs
IG1lbV9mcmVxLCBpc19kZHIzOwogCXVuc2lnbmVkIGludCBza2xfcHJlZmVycmVkX3Zjb19mcmVx
OwogCXVuc2lnbmVkIGludCBtYXhfY2RjbGtfZnJlcTsKQEAgLTI1NDEsNyArMjUyNyw2IEBAIHZv
aWQgaTkxNV9nZW1fY2xlYW51cF91c2VycHRyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdik7CiB2b2lkIGk5MTVfZ2VtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKIGludCBpOTE1X2dlbV9pbml0X2Vhcmx5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7CiB2b2lkIGk5MTVfZ2VtX2NsZWFudXBfZWFybHkoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKLXZvaWQgaTkxNV9nZW1fbG9hZF9pbml0X2ZlbmNlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IGk5MTVfZ2VtX2ZyZWV6ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IGk5MTVfZ2VtX2ZyZWV6ZV9sYXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiAKQEAgLTI2NjEsMTkgKzI2NDYsNiBA
QCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmk5MTVfZ2VtX3ByaW1lX2ltcG9ydChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAogc3RydWN0IGRtYV9idWYgKmk5MTVfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtX29iaiwg
aW50IGZsYWdzKTsKIAotLyogaTkxNV9nZW1fZmVuY2VfcmVnLmMgKi8KLXN0cnVjdCBkcm1faTkx
NV9mZW5jZV9yZWcgKgotaTkxNV9yZXNlcnZlX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7Ci12b2lkIGk5MTVfdW5yZXNlcnZlX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9m
ZW5jZV9yZWcgKmZlbmNlKTsKLQotdm9pZCBpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotCi12b2lkIGk5MTVfZ2VtX2RldGVjdF9iaXRf
Nl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGk5MTVf
Z2VtX29iamVjdF9kb19iaXRfMTdfc3dpenpsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAotCQkJCSAgICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKTsKLXZvaWQgaTkxNV9nZW1f
b2JqZWN0X3NhdmVfYml0XzE3X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKLQkJCQkJIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpOwotCiBzdGF0aWMgaW5saW5lIHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICoKIF9faTkxNV9nZW1fY29udGV4dF9sb29rdXBfcmN1KHN0cnVj
dCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwgdTMyIGlkKQogewpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKaW5kZXggNDAxN2VjZjU2MWY2Li40YmJkZWQ0YWE5MzYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwpAQCAtODg0LDcgKzg4NCw3IEBAIGk5MTVfZ2VtX3N3X2ZpbmlzaF9pb2N0
bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCXJldHVybiAwOwogfQogCi12
b2lkIGk5MTVfZ2VtX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCit2b2lkIGk5MTVfZ2VtX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCAqb247CiAJ
aW50IGk7CkBAIC04OTcsMTcgKzg5NywxOSBAQCB2b2lkIGk5MTVfZ2VtX3J1bnRpbWVfc3VzcGVu
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICovCiAKIAlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUob2JqLCBvbiwKLQkJCQkgJmRldl9wcml2LT5tbS51c2VyZmF1bHRfbGlz
dCwgdXNlcmZhdWx0X2xpbmspCisJCQkJICZpOTE1LT5nZ3R0LnVzZXJmYXVsdF9saXN0LCB1c2Vy
ZmF1bHRfbGluaykKIAkJX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKG9iaik7CiAKLQkv
KiBUaGUgZmVuY2Ugd2lsbCBiZSBsb3N0IHdoZW4gdGhlIGRldmljZSBwb3dlcnMgZG93bi4gSWYg
YW55IHdlcmUKKwkvKgorCSAqIFRoZSBmZW5jZSB3aWxsIGJlIGxvc3Qgd2hlbiB0aGUgZGV2aWNl
IHBvd2VycyBkb3duLiBJZiBhbnkgd2VyZQogCSAqIGluIHVzZSBieSBoYXJkd2FyZSAoaS5lLiB0
aGV5IGFyZSBwaW5uZWQpLCB3ZSBzaG91bGQgbm90IGJlIHBvd2VyaW5nCiAJICogZG93biEgQWxs
IG90aGVyIGZlbmNlcyB3aWxsIGJlIHJlYWNxdWlyZWQgYnkgdGhlIHVzZXIgdXBvbiB3YWtpbmcu
CiAJICovCi0JZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1fZmVuY2VfcmVnczsgaSsrKSB7
Ci0JCXN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKnJlZyA9ICZkZXZfcHJpdi0+ZmVuY2VfcmVn
c1tpXTsKKwlmb3IgKGkgPSAwOyBpIDwgaTkxNS0+Z2d0dC5udW1fZmVuY2VzOyBpKyspIHsKKwkJ
c3RydWN0IGk5MTVfZmVuY2VfcmVnICpyZWcgPSAmaTkxNS0+Z2d0dC5mZW5jZV9yZWdzW2ldOwog
Ci0JCS8qIElkZWFsbHkgd2Ugd2FudCB0byBhc3NlcnQgdGhhdCB0aGUgZmVuY2UgcmVnaXN0ZXIg
aXMgbm90CisJCS8qCisJCSAqIElkZWFsbHkgd2Ugd2FudCB0byBhc3NlcnQgdGhhdCB0aGUgZmVu
Y2UgcmVnaXN0ZXIgaXMgbm90CiAJCSAqIGxpdmUgYXQgdGhpcyBwb2ludCAoaS5lLiB0aGF0IG5v
IHBpZWNlIG9mIGNvZGUgd2lsbCBiZQogCQkgKiB0cnlpbmcgdG8gd3JpdGUgdGhyb3VnaCBmZW5j
ZSArIEdUVCwgYXMgdGhhdCBib3RoIHZpb2xhdGVzCiAJCSAqIG91ciB0cmFja2luZyBvZiBhY3Rp
dml0eSBhbmQgYXNzb2NpYXRlZCBsb2NraW5nL2JhcnJpZXJzLApAQCAtMTY4Nyw3ICsxNjg5LDcg
QEAgdm9pZCBpOTE1X2dlbV9maW5pX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIHsKIAlHRU1fQlVHX09OKGRldl9wcml2LT5ndC5hd2FrZSk7CiAKLQlpbnRlbF93YWtlcmVm
X2F1dG9fZmluaSgmZGV2X3ByaXYtPm1tLnVzZXJmYXVsdF93YWtlcmVmKTsKKwlpbnRlbF93YWtl
cmVmX2F1dG9fZmluaSgmZGV2X3ByaXYtPmdndHQudXNlcmZhdWx0X3dha2VyZWYpOwogCiAJaTkx
NV9nZW1fc3VzcGVuZF9sYXRlKGRldl9wcml2KTsKIAlpbnRlbF9kaXNhYmxlX2d0X3Bvd2Vyc2F2
ZShkZXZfcHJpdik7CkBAIC0xNzI5LDM4ICsxNzMxLDYgQEAgdm9pZCBpOTE1X2dlbV9pbml0X21t
aW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaTkxNV9nZW1fc2FuaXRpemUoaTkx
NSk7CiB9CiAKLXZvaWQKLWk5MTVfZ2VtX2xvYWRfaW5pdF9mZW5jZXMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQotewotCWludCBpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gNyAmJiAhSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgJiYKLQkgICAgIUlTX0NIRVJSWVZJ
RVcoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+bnVtX2ZlbmNlX3JlZ3MgPSAzMjsKLQllbHNlIGlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQgfHwKLQkJIElTX0k5NDVHKGRldl9wcml2KSB8fCBJ
U19JOTQ1R00oZGV2X3ByaXYpIHx8Ci0JCSBJU19HMzMoZGV2X3ByaXYpIHx8IElTX1BJTkVWSUVX
KGRldl9wcml2KSkKLQkJZGV2X3ByaXYtPm51bV9mZW5jZV9yZWdzID0gMTY7Ci0JZWxzZQotCQlk
ZXZfcHJpdi0+bnVtX2ZlbmNlX3JlZ3MgPSA4OwotCi0JaWYgKGludGVsX3ZncHVfYWN0aXZlKGRl
dl9wcml2KSkKLQkJZGV2X3ByaXYtPm51bV9mZW5jZV9yZWdzID0KLQkJCQlJOTE1X1JFQUQodmd0
aWZfcmVnKGF2YWlsX3JzLmZlbmNlX251bSkpOwotCi0JLyogSW5pdGlhbGl6ZSBmZW5jZSByZWdp
c3RlcnMgdG8gemVybyAqLwotCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+bnVtX2ZlbmNlX3Jl
Z3M7IGkrKykgewotCQlzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZSA9ICZkZXZfcHJp
di0+ZmVuY2VfcmVnc1tpXTsKLQotCQlmZW5jZS0+aTkxNSA9IGRldl9wcml2OwotCQlmZW5jZS0+
aWQgPSBpOwotCQlsaXN0X2FkZF90YWlsKCZmZW5jZS0+bGluaywgJmRldl9wcml2LT5tbS5mZW5j
ZV9saXN0KTsKLQl9Ci0JaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoZGV2X3ByaXYpOwotCi0JaTkx
NV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUoZGV2X3ByaXYpOwotfQotCiBzdGF0aWMgdm9pZCBp
OTE1X2dlbV9pbml0X19tbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzcGlu
X2xvY2tfaW5pdCgmaTkxNS0+bW0ub2JqX2xvY2spOwpAQCAtMTc3MCwxMCArMTc0MCw2IEBAIHN0
YXRpYyB2b2lkIGk5MTVfZ2VtX2luaXRfX21tKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCiAJSU5JVF9MSVNUX0hFQUQoJmk5MTUtPm1tLnB1cmdlX2xpc3QpOwogCUlOSVRfTElTVF9I
RUFEKCZpOTE1LT5tbS5zaHJpbmtfbGlzdCk7Ci0JSU5JVF9MSVNUX0hFQUQoJmk5MTUtPm1tLmZl
bmNlX2xpc3QpOwotCi0JSU5JVF9MSVNUX0hFQUQoJmk5MTUtPm1tLnVzZXJmYXVsdF9saXN0KTsK
LQlpbnRlbF93YWtlcmVmX2F1dG9faW5pdCgmaTkxNS0+bW0udXNlcmZhdWx0X3dha2VyZWYsIGk5
MTUpOwogCiAJaTkxNV9nZW1faW5pdF9fb2JqZWN0cyhpOTE1KTsKIH0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKaW5kZXggMTBhYTZlMzUwYmZhLi4xYzk0NjY2NzZj
YWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCkBAIC0yNSw2
ICsyNSw3IEBACiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5MTVfc2NhdHRl
cmxpc3QuaCIKKyNpbmNsdWRlICJpOTE1X3ZncHUuaCIKIAogLyoqCiAgKiBET0M6IGZlbmNlIHJl
Z2lzdGVyIGhhbmRsaW5nCkBAIC01OCw3ICs1OSw3IEBACiAKICNkZWZpbmUgcGlwZWxpbmVkIDAK
IAotc3RhdGljIHZvaWQgaTk2NV93cml0ZV9mZW5jZV9yZWcoc3RydWN0IGRybV9pOTE1X2ZlbmNl
X3JlZyAqZmVuY2UsCitzdGF0aWMgdm9pZCBpOTY1X3dyaXRlX2ZlbmNlX3JlZyhzdHJ1Y3QgaTkx
NV9mZW5jZV9yZWcgKmZlbmNlLAogCQkJCSBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlpOTE1
X3JlZ190IGZlbmNlX3JlZ19sbywgZmVuY2VfcmVnX2hpOwpAQCAtMTE1LDcgKzExNiw3IEBAIHN0
YXRpYyB2b2lkIGk5NjVfd3JpdGVfZmVuY2VfcmVnKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcg
KmZlbmNlLAogCX0KIH0KIAotc3RhdGljIHZvaWQgaTkxNV93cml0ZV9mZW5jZV9yZWcoc3RydWN0
IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCitzdGF0aWMgdm9pZCBpOTE1X3dyaXRlX2ZlbmNl
X3JlZyhzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCQkJCSBzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIHsKIAl1MzIgdmFsOwpAQCAtMTU1LDcgKzE1Niw3IEBAIHN0YXRpYyB2b2lkIGk5MTVf
d3JpdGVfZmVuY2VfcmVnKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCX0KIH0K
IAotc3RhdGljIHZvaWQgaTgzMF93cml0ZV9mZW5jZV9yZWcoc3RydWN0IGRybV9pOTE1X2ZlbmNl
X3JlZyAqZmVuY2UsCitzdGF0aWMgdm9pZCBpODMwX3dyaXRlX2ZlbmNlX3JlZyhzdHJ1Y3QgaTkx
NV9mZW5jZV9yZWcgKmZlbmNlLAogCQkJCSBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAl1MzIg
dmFsOwpAQCAtMTg3LDcgKzE4OCw3IEBAIHN0YXRpYyB2b2lkIGk4MzBfd3JpdGVfZmVuY2VfcmVn
KHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCX0KIH0KIAotc3RhdGljIHZvaWQg
ZmVuY2Vfd3JpdGUoc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCitzdGF0aWMgdm9p
ZCBmZW5jZV93cml0ZShzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCQkJc3RydWN0IGk5
MTVfdm1hICp2bWEpCiB7CiAJLyoKQEAgLTIxMSw3ICsyMTIsNyBAQCBzdGF0aWMgdm9pZCBmZW5j
ZV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAlmZW5jZS0+ZGlydHkg
PSBmYWxzZTsKIH0KIAotc3RhdGljIGludCBmZW5jZV91cGRhdGUoc3RydWN0IGRybV9pOTE1X2Zl
bmNlX3JlZyAqZmVuY2UsCitzdGF0aWMgaW50IGZlbmNlX3VwZGF0ZShzdHJ1Y3QgaTkxNV9mZW5j
ZV9yZWcgKmZlbmNlLAogCQkJc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJaW50ZWxfd2FrZXJl
Zl90IHdha2VyZWY7CkBAIC0yNTYsNyArMjU3LDcgQEAgc3RhdGljIGludCBmZW5jZV91cGRhdGUo
c3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAJCQlvbGQtPmZlbmNlID0gTlVMTDsK
IAkJfQogCi0JCWxpc3RfbW92ZSgmZmVuY2UtPmxpbmssICZmZW5jZS0+aTkxNS0+bW0uZmVuY2Vf
bGlzdCk7CisJCWxpc3RfbW92ZSgmZmVuY2UtPmxpbmssICZmZW5jZS0+aTkxNS0+Z2d0dC5mZW5j
ZV9saXN0KTsKIAl9CiAKIAkvKgpAQCAtMjgwLDcgKzI4MSw3IEBAIHN0YXRpYyBpbnQgZmVuY2Vf
dXBkYXRlKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCiAJaWYgKHZtYSkgewog
CQl2bWEtPmZlbmNlID0gZmVuY2U7Ci0JCWxpc3RfbW92ZV90YWlsKCZmZW5jZS0+bGluaywgJmZl
bmNlLT5pOTE1LT5tbS5mZW5jZV9saXN0KTsKKwkJbGlzdF9tb3ZlX3RhaWwoJmZlbmNlLT5saW5r
LCAmZmVuY2UtPmk5MTUtPmdndHQuZmVuY2VfbGlzdCk7CiAJfQogCiAJaW50ZWxfcnVudGltZV9w
bV9wdXQoZmVuY2UtPmk5MTUsIHdha2VyZWYpOwpAQCAtMzAwLDcgKzMwMSw3IEBAIHN0YXRpYyBp
bnQgZmVuY2VfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogICovCiBp
bnQgaTkxNV92bWFfcHV0X2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCXN0cnVjdCBk
cm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlID0gdm1hLT5mZW5jZTsKKwlzdHJ1Y3QgaTkxNV9mZW5j
ZV9yZWcgKmZlbmNlID0gdm1hLT5mZW5jZTsKIAogCWlmICghZmVuY2UpCiAJCXJldHVybiAwOwpA
QCAtMzExLDExICszMTIsMTEgQEAgaW50IGk5MTVfdm1hX3B1dF9mZW5jZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKIAlyZXR1cm4gZmVuY2VfdXBkYXRlKGZlbmNlLCBOVUxMKTsKIH0KIAotc3RhdGlj
IHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCitzdGF0aWMgc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBkcm1faTkxNV9mZW5jZV9y
ZWcgKmZlbmNlOworCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2U7CiAKLQlsaXN0X2Zvcl9l
YWNoX2VudHJ5KGZlbmNlLCAmaTkxNS0+bW0uZmVuY2VfbGlzdCwgbGluaykgeworCWxpc3RfZm9y
X2VhY2hfZW50cnkoZmVuY2UsICZpOTE1LT5nZ3R0LmZlbmNlX2xpc3QsIGxpbmspIHsKIAkJR0VN
X0JVR19PTihmZW5jZS0+dm1hICYmIGZlbmNlLT52bWEtPmZlbmNlICE9IGZlbmNlKTsKIAogCQlp
ZiAoZmVuY2UtPnBpbl9jb3VudCkKQEAgLTM0OSwxMCArMzUwLDkgQEAgc3RhdGljIHN0cnVjdCBk
cm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAgKgogICogMCBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUu
CiAgKi8KLWludAotaTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoraW50
IGk5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfZmVuY2VfcmVnICpmZW5jZTsKKwlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlOwog
CXN0cnVjdCBpOTE1X3ZtYSAqc2V0ID0gaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKHZtYS0+b2Jq
KSA/IHZtYSA6IE5VTEw7CiAJaW50IGVycjsKIApAQCAtMzY5LDcgKzM2OSw3IEBAIGk5MTVfdm1h
X3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJZmVuY2UtPnBpbl9jb3VudCsrOwog
CQlpZiAoIWZlbmNlLT5kaXJ0eSkgewogCQkJbGlzdF9tb3ZlX3RhaWwoJmZlbmNlLT5saW5rLAot
CQkJCSAgICAgICAmZmVuY2UtPmk5MTUtPm1tLmZlbmNlX2xpc3QpOworCQkJCSAgICAgICAmZmVu
Y2UtPmk5MTUtPmdndHQuZmVuY2VfbGlzdCk7CiAJCQlyZXR1cm4gMDsKIAkJfQogCX0gZWxzZSBp
ZiAoc2V0KSB7CkBAIC00MDQsMTAgKzQwNCw5IEBAIGk5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKICAqIFRoaXMgZnVuY3Rpb24gd2Fsa3MgdGhlIGZlbmNlIHJlZ3MgbG9v
a2luZyBmb3IgYSBmcmVlIG9uZSBhbmQgcmVtb3ZlCiAgKiBpdCBmcm9tIHRoZSBmZW5jZV9saXN0
LiBJdCBpcyB1c2VkIHRvIHJlc2VydmUgZmVuY2UgZm9yIHZHUFUgdG8gdXNlLgogICovCi1zdHJ1
Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICoKLWk5MTVfcmVzZXJ2ZV9mZW5jZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKK3N0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqaTkxNV9yZXNlcnZlX2Zl
bmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBkcm1faTkxNV9m
ZW5jZV9yZWcgKmZlbmNlOworCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2U7CiAJaW50IGNv
dW50OwogCWludCByZXQ7CiAKQEAgLTQxNSw3ICs0MTQsNyBAQCBpOTE1X3Jlc2VydmVfZmVuY2Uo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAkvKiBLZWVwIGF0IGxlYXN0IG9uZSBm
ZW5jZSBhdmFpbGFibGUgZm9yIHRoZSBkaXNwbGF5IGVuZ2luZS4gKi8KIAljb3VudCA9IDA7Ci0J
bGlzdF9mb3JfZWFjaF9lbnRyeShmZW5jZSwgJmk5MTUtPm1tLmZlbmNlX2xpc3QsIGxpbmspCisJ
bGlzdF9mb3JfZWFjaF9lbnRyeShmZW5jZSwgJmk5MTUtPmdndHQuZmVuY2VfbGlzdCwgbGluaykK
IAkJY291bnQgKz0gIWZlbmNlLT5waW5fY291bnQ7CiAJaWYgKGNvdW50IDw9IDEpCiAJCXJldHVy
biBFUlJfUFRSKC1FTk9TUEMpOwpAQCAtNDQxLDExICs0NDAsMTEgQEAgaTkxNV9yZXNlcnZlX2Zl
bmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogICoKICAqIFRoaXMgZnVuY3Rpb24g
YWRkIGEgcmVzZXJ2ZWQgZmVuY2UgcmVnaXN0ZXIgZnJvbSB2R1BVIHRvIHRoZSBmZW5jZV9saXN0
LgogICovCi12b2lkIGk5MTVfdW5yZXNlcnZlX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9y
ZWcgKmZlbmNlKQordm9pZCBpOTE1X3VucmVzZXJ2ZV9mZW5jZShzdHJ1Y3QgaTkxNV9mZW5jZV9y
ZWcgKmZlbmNlKQogewogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmZlbmNlLT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAotCWxpc3RfYWRkKCZmZW5jZS0+bGluaywgJmZlbmNlLT5pOTE1LT5tbS5m
ZW5jZV9saXN0KTsKKwlsaXN0X2FkZCgmZmVuY2UtPmxpbmssICZmZW5jZS0+aTkxNS0+Z2d0dC5m
ZW5jZV9saXN0KTsKIH0KIAogLyoqCkBAIC00NjEsOCArNDYwLDggQEAgdm9pZCBpOTE1X2dlbV9y
ZXN0b3JlX2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpbnQgaTsKIAog
CXJjdV9yZWFkX2xvY2soKTsgLyoga2VlcCBvYmogYWxpdmUgYXMgd2UgZGVyZWZlcmVuY2UgKi8K
LQlmb3IgKGkgPSAwOyBpIDwgaTkxNS0+bnVtX2ZlbmNlX3JlZ3M7IGkrKykgewotCQlzdHJ1Y3Qg
ZHJtX2k5MTVfZmVuY2VfcmVnICpyZWcgPSAmaTkxNS0+ZmVuY2VfcmVnc1tpXTsKKwlmb3IgKGkg
PSAwOyBpIDwgaTkxNS0+Z2d0dC5udW1fZmVuY2VzOyBpKyspIHsKKwkJc3RydWN0IGk5MTVfZmVu
Y2VfcmVnICpyZWcgPSAmaTkxNS0+Z2d0dC5mZW5jZV9yZWdzW2ldOwogCQlzdHJ1Y3QgaTkxNV92
bWEgKnZtYSA9IFJFQURfT05DRShyZWctPnZtYSk7CiAKIAkJR0VNX0JVR19PTih2bWEgJiYgdm1h
LT5mZW5jZSAhPSByZWcpOwpAQCAtNTM0LDggKzUzMyw3IEBAIHZvaWQgaTkxNV9nZW1fcmVzdG9y
ZV9mZW5jZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAgKiBEZXRlY3RzIGJpdCA2
IHN3aXp6bGluZyBvZiBhZGRyZXNzIGxvb2t1cCBiZXR3ZWVuIElHRCBhY2Nlc3MgYW5kIENQVQog
ICogYWNjZXNzIHRocm91Z2ggbWFpbiBtZW1vcnkuCiAgKi8KLXZvaWQKLWk5MTVfZ2VtX2RldGVj
dF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIHZv
aWQgZGV0ZWN0X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
CiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKIAl1MzIgc3dp
enpsZV94ID0gSTkxNV9CSVRfNl9TV0laWkxFX1VOS05PV047CkBAIC03MDgsOCArNzA2LDcgQEAg
aTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAgKiBiaXQgMTcgb2YgaXRzIHBoeXNpY2FsIGFkZHJlc3MgYW5kIHRoZXJlZm9yZSBiZWlu
ZyBpbnRlcnByZXRlZCBkaWZmZXJlbnRseQogICogYnkgdGhlIEdQVS4KICAqLwotc3RhdGljIHZv
aWQKLWk5MTVfZ2VtX3N3aXp6bGVfcGFnZShzdHJ1Y3QgcGFnZSAqcGFnZSkKK3N0YXRpYyB2b2lk
IGk5MTVfZ2VtX3N3aXp6bGVfcGFnZShzdHJ1Y3QgcGFnZSAqcGFnZSkKIHsKIAljaGFyIHRlbXBb
NjRdOwogCWNoYXIgKnZhZGRyOwpAQCAtNzk4LDMgKzc5NSw0MiBAQCBpOTE1X2dlbV9vYmplY3Rf
c2F2ZV9iaXRfMTdfc3dpenpsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlp
Kys7CiAJfQogfQorCit2b2lkIGk5MTVfZ2d0dF9pbml0X2ZlbmNlcyhzdHJ1Y3QgaTkxNV9nZ3R0
ICpnZ3R0KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ2d0dC0+dm0uaTkx
NTsKKwlpbnQgbnVtX2ZlbmNlczsKKwlpbnQgaTsKKworCUlOSVRfTElTVF9IRUFEKCZnZ3R0LT5m
ZW5jZV9saXN0KTsKKwlJTklUX0xJU1RfSEVBRCgmZ2d0dC0+dXNlcmZhdWx0X2xpc3QpOworCWlu
dGVsX3dha2VyZWZfYXV0b19pbml0KCZnZ3R0LT51c2VyZmF1bHRfd2FrZXJlZiwgaTkxNSk7CisK
KwlkZXRlY3RfYml0XzZfc3dpenpsZShpOTE1KTsKKworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0g
NyAmJgorCSAgICAhKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNfQ0hFUlJZVklFVyhpOTE1KSkp
CisJCW51bV9mZW5jZXMgPSAzMjsKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCB8fAor
CQkgSVNfSTk0NUcoaTkxNSkgfHwgSVNfSTk0NUdNKGk5MTUpIHx8CisJCSBJU19HMzMoaTkxNSkg
fHwgSVNfUElORVZJRVcoaTkxNSkpCisJCW51bV9mZW5jZXMgPSAxNjsKKwllbHNlCisJCW51bV9m
ZW5jZXMgPSA4OworCisJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5MTUpKQorCQludW1fZmVuY2Vz
ID0gaW50ZWxfdW5jb3JlX3JlYWQoJmk5MTUtPnVuY29yZSwKKwkJCQkJICAgICAgIHZndGlmX3Jl
ZyhhdmFpbF9ycy5mZW5jZV9udW0pKTsKKworCS8qIEluaXRpYWxpemUgZmVuY2UgcmVnaXN0ZXJz
IHRvIHplcm8gKi8KKwlmb3IgKGkgPSAwOyBpIDwgbnVtX2ZlbmNlczsgaSsrKSB7CisJCXN0cnVj
dCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UgPSAmZ2d0dC0+ZmVuY2VfcmVnc1tpXTsKKworCQlmZW5j
ZS0+aTkxNSA9IGk5MTU7CisJCWZlbmNlLT5pZCA9IGk7CisJCWxpc3RfYWRkX3RhaWwoJmZlbmNl
LT5saW5rLCAmZ2d0dC0+ZmVuY2VfbGlzdCk7CisJfQorCWdndHQtPm51bV9mZW5jZXMgPSBudW1f
ZmVuY2VzOworCisJaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoaTkxNSk7Cit9CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5oCmluZGV4IDA5ZGNhZjE0MTIxYi4uZDJkYTk4
ODI4MTc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9y
ZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuaApAQCAt
MjYsMTMgKzI2LDE3IEBACiAjZGVmaW5lIF9fSTkxNV9GRU5DRV9SRUdfSF9fCiAKICNpbmNsdWRl
IDxsaW51eC9saXN0Lmg+CisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAorc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3Q7CiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKK3N0cnVjdCBpOTE1X2dn
dHQ7CiBzdHJ1Y3QgaTkxNV92bWE7CitzdHJ1Y3Qgc2dfdGFibGU7CiAKICNkZWZpbmUgSTk2NV9G
RU5DRV9QQUdFIDQwOTZVTAogCi1zdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnIHsKK3N0cnVjdCBp
OTE1X2ZlbmNlX3JlZyB7CiAJc3RydWN0IGxpc3RfaGVhZCBsaW5rOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtNDksNCArNTMsMTcg
QEAgc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyB7CiAJYm9vbCBkaXJ0eTsKIH07CiAKKy8qIGk5
MTVfZ2VtX2ZlbmNlX3JlZy5jICovCitzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmk5MTVfcmVzZXJ2
ZV9mZW5jZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGk5MTVfdW5yZXNl
cnZlX2ZlbmNlKHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UpOworCit2b2lkIGk5MTVfZ2Vt
X3Jlc3RvcmVfZmVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKKwordm9pZCBp
OTE1X2dlbV9vYmplY3RfZG9fYml0XzE3X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKKwkJCQkgICAgICAgc3RydWN0IHNnX3RhYmxlICpwYWdlcyk7Cit2b2lkIGk5MTVf
Z2VtX29iamVjdF9zYXZlX2JpdF8xN19zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCisJCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKTsKKwordm9pZCBpOTE1X2dndHRf
aW5pdF9mZW5jZXMoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCk7CisKICNlbmRpZgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCBlNzA2NzViZmI1MWQuLjdiZTcyMzg4YjA1MiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTM1NjcsNiArMzU2Nyw4IEBAIGludCBp
OTE1X2dndHRfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAln
Z3R0LT5tdHJyID0gYXJjaF9waHlzX3djX2FkZChnZ3R0LT5nbWFkci5zdGFydCwgZ2d0dC0+bWFw
cGFibGVfZW5kKTsKIAorCWk5MTVfZ2d0dF9pbml0X2ZlbmNlcyhnZ3R0KTsKKwogCS8qCiAJICog
SW5pdGlhbGlzZSBzdG9sZW4gZWFybHkgc28gdGhhdCB3ZSBtYXkgcmVzZXJ2ZSBwcmVhbGxvY2F0
ZWQKIAkgKiBvYmplY3RzIGZvciB0aGUgQklPUyB0byBLTVMgdHJhbnNpdGlvbi4KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZ3R0LmgKaW5kZXggODk0MzdkMGE3MjFjLi42M2ZhMzU3YzY5ZGUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCkBAIC0zOSw2ICszOSw3IEBACiAjaW5jbHVk
ZSA8bGludXgvcGFnZXZlYy5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfcmVzZXQuaCIKKyNpbmNs
dWRlICJpOTE1X2dlbV9mZW5jZV9yZWcuaCIKICNpbmNsdWRlICJpOTE1X3JlcXVlc3QuaCIKICNp
bmNsdWRlICJpOTE1X3NjYXR0ZXJsaXN0LmgiCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgpA
QCAtNjEsNyArNjIsNiBAQAogI2RlZmluZSBJOTE1X01BWF9OVU1fRkVOQ0VfQklUUyA2CiAKIHN0
cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGU7Ci1zdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnOwog
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Q7CiBzdHJ1Y3QgaTkxNV92bWE7CiAKQEAgLTQwOCw2
ICs0MDgsMTggQEAgc3RydWN0IGk5MTVfZ2d0dCB7CiAKIAl1MzIgcGluX2JpYXM7CiAKKwl1bnNp
Z25lZCBpbnQgbnVtX2ZlbmNlczsKKwlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgZmVuY2VfcmVnc1tJ
OTE1X01BWF9OVU1fRkVOQ0VTXTsKKwlzdHJ1Y3QgbGlzdF9oZWFkIGZlbmNlX2xpc3Q7CisKKwkv
KiogTGlzdCBvZiBhbGwgb2JqZWN0cyBpbiBndHRfc3BhY2UsIGN1cnJlbnRseSBtbWFwZWQgYnkg
dXNlcnNwYWNlLgorCSAqIEFsbCBvYmplY3RzIHdpdGhpbiB0aGlzIGxpc3QgbXVzdCBhbHNvIGJl
IG9uIGJvdW5kX2xpc3QuCisJICovCisJc3RydWN0IGxpc3RfaGVhZCB1c2VyZmF1bHRfbGlzdDsK
KworCS8qIE1hbnVhbCBydW50aW1lIHBtIGF1dG9zdXNwZW5kIGRlbGF5IGZvciB1c2VyIEdHVFQg
bW1hcHMgKi8KKwlzdHJ1Y3QgaW50ZWxfd2FrZXJlZl9hdXRvIHVzZXJmYXVsdF93YWtlcmVmOwor
CiAJc3RydWN0IGRybV9tbV9ub2RlIGVycm9yX2NhcHR1cmU7CiAJc3RydWN0IGRybV9tbV9ub2Rl
IHVjX2Z3OwogfTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vy
cm9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCmluZGV4IGQ3ZjE2
NGM5ZjJlYi4uMjZjOWMwNTk1YmRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dwdV9lcnJvci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9y
LmMKQEAgLTExMjcsMTcgKzExMjcsMTcgQEAgc3RhdGljIHZvaWQgZ2VtX3JlY29yZF9mZW5jZXMo
c3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKIAlpbnQgaTsKIAogCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDYpIHsKLQkJZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1fZmVuY2Vf
cmVnczsgaSsrKQorCQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPmdndHQubnVtX2ZlbmNlczsg
aSsrKQogCQkJZXJyb3ItPmZlbmNlW2ldID0KIAkJCQlpbnRlbF91bmNvcmVfcmVhZDY0KHVuY29y
ZSwKIAkJCQkJCSAgICBGRU5DRV9SRUdfR0VONl9MTyhpKSk7CiAJfSBlbHNlIGlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDQpIHsKLQkJZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT5udW1fZmVu
Y2VfcmVnczsgaSsrKQorCQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPmdndHQubnVtX2ZlbmNl
czsgaSsrKQogCQkJZXJyb3ItPmZlbmNlW2ldID0KIAkJCQlpbnRlbF91bmNvcmVfcmVhZDY0KHVu
Y29yZSwKIAkJCQkJCSAgICBGRU5DRV9SRUdfOTY1X0xPKGkpKTsKIAl9IGVsc2UgewotCQlmb3Ig
KGkgPSAwOyBpIDwgZGV2X3ByaXYtPm51bV9mZW5jZV9yZWdzOyBpKyspCisJCWZvciAoaSA9IDA7
IGkgPCBkZXZfcHJpdi0+Z2d0dC5udW1fZmVuY2VzOyBpKyspCiAJCQllcnJvci0+ZmVuY2VbaV0g
PQogCQkJCWludGVsX3VuY29yZV9yZWFkKHVuY29yZSwgRkVOQ0VfUkVHKGkpKTsKIAl9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV92bWEuaAppbmRleCAwYzU3YWI0ZmVkNWQuLjRiNzY5ZGI2NDliZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3ZtYS5oCkBAIC01NCw3ICs1NCw3IEBAIHN0cnVjdCBpOTE1X3ZtYSB7CiAJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bTsKIAljb25zdCBzdHJ1Y3QgaTkxNV92bWFfb3BzICpvcHM7Ci0Jc3RydWN0IGRybV9p
OTE1X2ZlbmNlX3JlZyAqZmVuY2U7CisJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZTsKIAlz
dHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2OyAvKiogQWxpYXMgb2Ygb2JqLT5yZXN2ICov
CiAJc3RydWN0IHNnX3RhYmxlICpwYWdlczsKIAl2b2lkIF9faW9tZW0gKmlvbWFwOwotLSAKMi4y
MC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRl
bC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

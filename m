Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E50C92C3E40
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Nov 2020 11:41:34 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 16A376E9A8;
	Wed, 25 Nov 2020 10:40:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D90A56E89B
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Nov 2020 10:40:27 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Nov 2020 11:39:34 +0100
Message-Id: <20201125104011.606641-27-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.29.2.222.g5d2a92d10f8
In-Reply-To: <20201125104011.606641-1-maarten.lankhorst@linux.intel.com>
References: <20201125104011.606641-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v5 26/63] drm/i915: Make
 intel_init_workaround_bb more compatible with ww locking.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSBjcmVhdGlvbiBzZXBhcmF0ZSBmcm9tIHBpbm5pbmcsIGluIG9yZGVyIHRvIHRha2UgdGhl
IGxvY2sgb25seQpvbmNlLCBhbmQgcGluIHRoZSBtYXBwaW5nIHdpdGggdGhlIGxvY2sgaGVsZC4K
ClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51
eC5pbnRlbC5jb20+ClJldmlld2VkLWJ5OiBUaG9tYXMgSGVsbHN0csO2bSA8dGhvbWFzLmhlbGxz
dHJvbUBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
bHJjLmMgfCA0MyArKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQs
IDMzIGluc2VydGlvbnMoKyksIDEwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbHJjLmMKaW5kZXggODIxZjQxOWQzMTA4Li4wMTFiOWZhMDkwZTMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jCkBAIC0zOTgyLDcgKzM5ODIsNyBAQCBnZW4xMF9pbml0X2luZGly
ZWN0Y3R4X2JiKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMyICpiYXRjaCkKIAog
I2RlZmluZSBDVFhfV0FfQkJfT0JKX1NJWkUgKFBBR0VfU0laRSkKIAotc3RhdGljIGludCBscmNf
c2V0dXBfd2FfY3R4KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3N0YXRpYyBpbnQg
bHJjX2luaXRfd2FfY3R4KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAt
Mzk5OCwxMCArMzk5OCw2IEBAIHN0YXRpYyBpbnQgbHJjX3NldHVwX3dhX2N0eChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCWdvdG8gZXJyOwogCX0KIAotCWVyciA9IGk5MTVfZ2d0
dF9waW4odm1hLCBOVUxMLCAwLCBQSU5fSElHSCk7Ci0JaWYgKGVycikKLQkJZ290byBlcnI7Ci0K
IAllbmdpbmUtPndhX2N0eC52bWEgPSB2bWE7CiAJcmV0dXJuIDA7CiAKQEAgLTQwMTAsOSArNDAw
NiwxNiBAQCBzdGF0aWMgaW50IGxyY19zZXR1cF93YV9jdHgoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyB2b2lkIGxyY19kZXN0cm95X3dh
X2N0eChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCitzdGF0aWMgdm9pZCBscmNfZGVz
dHJveV93YV9jdHgoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBib29sIHVucGluKQog
ewotCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZlbmdpbmUtPndhX2N0eC52bWEsIDApOwor
CWlmICghZW5naW5lLT53YV9jdHgudm1hKQorCQlyZXR1cm47CisKKwlpZiAodW5waW4pCisJCWk5
MTVfdm1hX3VucGluKGVuZ2luZS0+d2FfY3R4LnZtYSk7CisKKwlpOTE1X3ZtYV9wdXQoZW5naW5l
LT53YV9jdHgudm1hKTsKKwllbmdpbmUtPndhX2N0eC52bWEgPSBOVUxMOwogfQogCiB0eXBlZGVm
IHUzMiAqKCp3YV9iYl9mdW5jX3QpKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMy
ICpiYXRjaCk7CkBAIC00MDI0LDYgKzQwMjcsNyBAQCBzdGF0aWMgaW50IGludGVsX2luaXRfd29y
a2Fyb3VuZF9iYihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCQkJCSAgICAmd2Ff
Y3R4LT5wZXJfY3R4IH07CiAJd2FfYmJfZnVuY190IHdhX2JiX2ZuWzJdOwogCXZvaWQgKmJhdGNo
LCAqYmF0Y2hfcHRyOworCXN0cnVjdCBpOTE1X2dlbV93d19jdHggd3c7CiAJdW5zaWduZWQgaW50
IGk7CiAJaW50IHJldDsKIApAQCAtNDA1MSwxMyArNDA1NSwyMSBAQCBzdGF0aWMgaW50IGludGVs
X2luaXRfd29ya2Fyb3VuZF9iYihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCXJl
dHVybiAwOwogCX0KIAotCXJldCA9IGxyY19zZXR1cF93YV9jdHgoZW5naW5lKTsKKwlyZXQgPSBs
cmNfaW5pdF93YV9jdHgoZW5naW5lKTsKIAlpZiAocmV0KSB7CiAJCWRybV9kYmcoJmVuZ2luZS0+
aTkxNS0+ZHJtLAogCQkJIkZhaWxlZCB0byBzZXR1cCBjb250ZXh0IFdBIHBhZ2U6ICVkXG4iLCBy
ZXQpOwogCQlyZXR1cm4gcmV0OwogCX0KIAorCWk5MTVfZ2VtX3d3X2N0eF9pbml0KCZ3dywgdHJ1
ZSk7CityZXRyeToKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9jayh3YV9jdHgtPnZtYS0+b2Jq
LCAmd3cpOworCWlmICghcmV0KQorCQlyZXQgPSBpOTE1X2dndHRfcGluKHdhX2N0eC0+dm1hLCAm
d3csIDAsIFBJTl9ISUdIKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjsKKwogCWJhdGNoID0gaTkx
NV9nZW1fb2JqZWN0X3Bpbl9tYXAod2FfY3R4LT52bWEtPm9iaiwgSTkxNV9NQVBfV0IpOwogCiAJ
LyoKQEAgLTQwODEsOCArNDA5MywxOSBAQCBzdGF0aWMgaW50IGludGVsX2luaXRfd29ya2Fyb3Vu
ZF9iYihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAlfX2k5MTVfZ2VtX29iamVj
dF9mbHVzaF9tYXAod2FfY3R4LT52bWEtPm9iaiwgMCwgYmF0Y2hfcHRyIC0gYmF0Y2gpOwogCV9f
aTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbWFwKHdhX2N0eC0+dm1hLT5vYmopOworCisJaWYgKHJl
dCkKKwkJaTkxNV92bWFfdW5waW4od2FfY3R4LT52bWEpOworCitlcnI6CisJaWYgKHJldCA9PSAt
RURFQURMSykgeworCQlyZXQgPSBpOTE1X2dlbV93d19jdHhfYmFja29mZigmd3cpOworCQlpZiAo
IXJldCkKKwkJCWdvdG8gcmV0cnk7CisJfQorCWk5MTVfZ2VtX3d3X2N0eF9maW5pKCZ3dyk7CiAJ
aWYgKHJldCkKLQkJbHJjX2Rlc3Ryb3lfd2FfY3R4KGVuZ2luZSk7CisJCWxyY19kZXN0cm95X3dh
X2N0eChlbmdpbmUsIGZhbHNlKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC01MTU5LDcgKzUxODIs
NyBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCiAJZXhlY2xpc3RzX3NodXRkb3duKGVuZ2luZSk7CiAKIAlpbnRlbF9lbmdpbmVf
Y2xlYW51cF9jb21tb24oZW5naW5lKTsKLQlscmNfZGVzdHJveV93YV9jdHgoZW5naW5lKTsKKwls
cmNfZGVzdHJveV93YV9jdHgoZW5naW5lLCB0cnVlKTsKIH0KIAogc3RhdGljIHZvaWQKLS0gCjIu
MjkuMi4yMjIuZzVkMmE5MmQxMGY4CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZngK

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C6BE2F3698
	for <lists+intel-gfx@lfdr.de>; Thu,  7 Nov 2019 19:06:17 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0ECD06F777;
	Thu,  7 Nov 2019 18:06:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 095636F771
 for <intel-gfx@lists.freedesktop.org>; Thu,  7 Nov 2019 18:06:08 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19119456-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 07 Nov 2019 18:06:05 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  7 Nov 2019 18:06:00 +0000
Message-Id: <20191107180601.30815-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191107180601.30815-1-chris@chris-wilson.co.uk>
References: <20191107180601.30815-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 4/5] drm/i915/selftests: Wrap vm_mmap() around GEM
 objects
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvdmlkZSBhIHV0aWxpdHkgZnVuY3Rpb24gdG8gY3JlYXRlIGEgdm1hIGNvcnJlc3BvbmRpbmcg
dG8gYW4gbW1hcCgpIG9mCm91ciBkZXZpY2UuIEFuZCB1c2UgaXQgdG8gZXhlcmNpc2UgdGhlIGVx
dWl2YWxlbnQgb2YgdXNlcnNwYWNlCnBlcmZvcm1pbmcgYSBHVFQgbW1hcCBvZiBvdXIgb2JqZWN0
cy4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogQWJkaWVsIEphbnVsZ3VlIDxhYmRpZWwuamFudWxndWVAbGludXguaW50ZWwuY29tPgpS
ZXZpZXdlZC1ieTogQWJkaWVsIEphbnVsZ3VlIDxhYmRpZWwuamFudWxndWVAbGludXguaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgICAgICB8
ICAgMSArCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCAx
MDAgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0
X21tYXAuYyAgICAgfCAgMzkgKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2lndF9tbWFwLmggICAgIHwgIDE5ICsrKysKIDQgZmlsZXMgY2hhbmdlZCwgMTU5IGluc2VydGlv
bnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aWd0X21tYXAuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pZ3RfbW1hcC5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZp
bGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCA5MGRjZjA5ZjUyY2MuLmUw
ZmQxMGMwY2ZiOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTI1OSw2ICsyNTksNyBAQCBpOTE1
LSQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKSArPSBcCiAJc2VsZnRlc3RzL2k5MTVfc2VsZnRl
c3QubyBcCiAJc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0Lm8gXAogCXNlbGZ0ZXN0cy9pZ3RfbGl2
ZV90ZXN0Lm8gXAorCXNlbGZ0ZXN0cy9pZ3RfbW1hcC5vIFwKIAlzZWxmdGVzdHMvaWd0X3Jlc2V0
Lm8gXAogCXNlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5vCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKaW5kZXggMjliMjA3N2I3M2QyLi5k
NWFlNDkxYTAzNjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fbW1hbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fbW1hbi5jCkBAIC0xMiw2ICsxMiw3IEBACiAjaW5jbHVkZSAiaTkxNV9zZWxm
dGVzdC5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgogI2luY2x1ZGUgInNl
bGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3RfbW1hcC5o
IgogCiBzdHJ1Y3QgdGlsZSB7CiAJdW5zaWduZWQgaW50IHdpZHRoOwpAQCAtNjk0LDEyICs2OTUs
MTExIEBAIHN0YXRpYyBpbnQgaWd0X21tYXBfb2Zmc2V0X2V4aGF1c3Rpb24odm9pZCAqYXJnKQog
CWdvdG8gb3V0OwogfQogCisjZGVmaW5lIGV4cGFuZDMyKHgpICgoKHgpIDw8IDApIHwgKCh4KSA8
PCA4KSB8ICgoeCkgPDwgMTYpIHwgKCh4KSA8PCAyNCkpCitzdGF0aWMgaW50IGlndF9tbWFwX2d0
dCh2b2lkICphcmcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3Qg
KmFyZWE7CisJdW5zaWduZWQgbG9uZyBhZGRyOworCXZvaWQgKnZhZGRyOworCWludCBlcnIsIGk7
CisKKwlpZiAoIWk5MTVfZ2d0dF9oYXNfYXBlcnR1cmUoJmk5MTUtPmdndHQpKQorCQlyZXR1cm4g
MDsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9T
SVpFKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CisKKwl2YWRk
ciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19F
UlIodmFkZHIpKSB7CisJCWVyciA9IFBUUl9FUlIodmFkZHIpOworCQlnb3RvIG91dDsKKwl9CisJ
bWVtc2V0KHZhZGRyLCBQT0lTT05fSU5VU0UsIFBBR0VfU0laRSk7CisJaTkxNV9nZW1fb2JqZWN0
X2ZsdXNoX21hcChvYmopOworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKworCWVy
ciA9IGNyZWF0ZV9tbWFwX29mZnNldChvYmopOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJ
YWRkciA9IGlndF9tbWFwX25vZGUoaTkxNSwgJm9iai0+YmFzZS52bWFfbm9kZSwKKwkJCSAgICAg
MCwgUFJPVF9XUklURSwgTUFQX1NIQVJFRCk7CisJaWYgKElTX0VSUl9WQUxVRShhZGRyKSkgewor
CQllcnIgPSBhZGRyOworCQlnb3RvIG91dDsKKwl9CisKKwlwcl9kZWJ1ZygiaWd0X21tYXAob2Jq
Omd0dCkgQCAlbHhcbiIsIGFkZHIpOworCisJYXJlYSA9IGZpbmRfdm1hKGN1cnJlbnQtPm1tLCBh
ZGRyKTsKKwlpZiAoIWFyZWEpIHsKKwkJcHJfZXJyKCJEaWQgbm90IGNyZWF0ZSBhIHZtX2FyZWFf
c3RydWN0IGZvciB0aGUgbW1hcFxuIik7CisJCWVyciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0X3Vu
bWFwOworCX0KKworCWlmIChhcmVhLT52bV9wcml2YXRlX2RhdGEgIT0gb2JqKSB7CisJCXByX2Vy
cigidm1fYXJlYV9zdHJ1Y3QgZGlkIG5vdCBwb2ludCBiYWNrIHRvIG91ciBvYmplY3QhXG4iKTsK
KwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBvdXRfdW5tYXA7CisJfQorCisJZm9yIChpID0gMDsg
aSA8IFBBR0VfU0laRSAvIHNpemVvZih1MzIpOyBpKyspIHsKKwkJdTMyIF9fdXNlciAqdXggPSB1
NjRfdG9fdXNlcl9wdHIoKHU2NCkoYWRkciArIGkgKiBzaXplb2YqKHV4KSkpOworCQl1MzIgeDsK
KworCQlpZiAoZ2V0X3VzZXIoeCwgdXgpKSB7CisJCQlwcl9lcnIoIlVuYWJsZSB0byByZWFkIGZy
b20gR1RUIG1tYXAsIG9mZnNldDolemRcbiIsCisJCQkgICAgICAgaSAqIHNpemVvZih4KSk7CisJ
CQllcnIgPSAtRUZBVUxUOworCQkJYnJlYWs7CisJCX0KKworCQlpZiAoeCAhPSBleHBhbmQzMihQ
T0lTT05fSU5VU0UpKSB7CisJCQlwcl9lcnIoIlJlYWQgaW5jb3JyZWN0IHZhbHVlIGZyb20gR1RU
IG1tYXAsIG9mZnNldDolemQsIGZvdW5kOiV4LCBleHBlY3RlZDoleFxuIiwKKwkJCSAgICAgICBp
ICogc2l6ZW9mKHgpLCB4LCBleHBhbmQzMihQT0lTT05fSU5VU0UpKTsKKwkJCWVyciA9IC1FSU5W
QUw7CisJCQlicmVhazsKKwkJfQorCisJCXggPSBleHBhbmQzMihQT0lTT05fRlJFRSk7CisJCWlm
IChwdXRfdXNlcih4LCB1eCkpIHsKKwkJCXByX2VycigiVW5hYmxlIHRvIHdyaXRlIHRvIEdUVCBt
bWFwLCBvZmZzZXQ6JXpkXG4iLAorCQkJICAgICAgIGkgKiBzaXplb2YoeCkpOworCQkJZXJyID0g
LUVGQVVMVDsKKwkJCWJyZWFrOworCQl9CisJfQorCitvdXRfdW5tYXA6CisJdm1fbXVubWFwKGFk
ZHIsIFBBR0VfU0laRSk7CisKKwl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwg
STkxNV9NQVBfRk9SQ0VfV0MpOworCWlmIChJU19FUlIodmFkZHIpKSB7CisJCWVyciA9IFBUUl9F
UlIodmFkZHIpOworCQlnb3RvIG91dDsKKwl9CisJaWYgKGVyciA9PSAwICYmIG1lbWNocl9pbnYo
dmFkZHIsIFBPSVNPTl9GUkVFLCBQQUdFX1NJWkUpKSB7CisJCXByX2VycigiV3JpdGUgdmlhIEdH
VFQgbW1hcCBkaWQgbm90IGxhbmQgaW4gYmFja2luZyBzdG9yZVxuIik7CisJCWVyciA9IC1FSU5W
QUw7CisJfQorCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKworb3V0OgorCWk5MTVf
Z2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1cm4gZXJyOworfQorCiBpbnQgaTkxNV9nZW1fbW1h
bl9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdGF0
aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0gewogCQlTVUJURVNUKGlndF9w
YXJ0aWFsX3RpbGluZyksCiAJCVNVQlRFU1QoaWd0X3Ntb2tlX3RpbGluZyksCiAJCVNVQlRFU1Qo
aWd0X21tYXBfb2Zmc2V0X2V4aGF1c3Rpb24pLAorCQlTVUJURVNUKGlndF9tbWFwX2d0dCksCiAJ
fTsKIAogCXJldHVybiBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbW1hcC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2lndF9tbWFwLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMDAwLi41ODNhNGZmOGI4YzkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaWd0X21tYXAuYwpAQCAtMCwwICsxLDM5IEBACisvKgorICogU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVs
IENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGRybS9kcm1fZmlsZS5oPgorCisjaW5jbHVk
ZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpZ3RfbW1hcC5oIgorCit1bnNpZ25lZCBsb25nIGln
dF9tbWFwX25vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgc3RydWN0
IGRybV92bWFfb2Zmc2V0X25vZGUgKm5vZGUsCisJCQkgICAgdW5zaWduZWQgbG9uZyBhZGRyLAor
CQkJICAgIHVuc2lnbmVkIGxvbmcgcHJvdCwKKwkJCSAgICB1bnNpZ25lZCBsb25nIGZsYWdzKQor
eworCXN0cnVjdCBmaWxlICpmaWxlOworCWludCBlcnI7CisKKwkvKiBQcmV0ZW5kIHRvIG9wZW4o
Ii9kZXYvZHJpL2NhcmQwIikgKi8KKwlmaWxlID0gbW9ja19kcm1fZ2V0ZmlsZShpOTE1LT5kcm0u
cHJpbWFyeSwgT19SRFdSKTsKKwlpZiAoSVNfRVJSKGZpbGUpKQorCQlyZXR1cm4gUFRSX0VSUihm
aWxlKTsKKworCWVyciA9IGRybV92bWFfbm9kZV9hbGxvdyhub2RlLCBmaWxlLT5wcml2YXRlX2Rh
dGEpOworCWlmIChlcnIpIHsKKwkJYWRkciA9IGVycjsKKwkJZ290byBvdXRfZmlsZTsKKwl9CisK
KwlhZGRyID0gdm1fbW1hcChmaWxlLCBhZGRyLCBkcm1fdm1hX25vZGVfc2l6ZShub2RlKSA8PCBQ
QUdFX1NISUZULAorCQkgICAgICAgcHJvdCwgZmxhZ3MsIGRybV92bWFfbm9kZV9vZmZzZXRfYWRk
cihub2RlKSk7CisKKwlkcm1fdm1hX25vZGVfcmV2b2tlKG5vZGUsIGZpbGUtPnByaXZhdGVfZGF0
YSk7CitvdXRfZmlsZToKKwlmcHV0KGZpbGUpOworCXJldHVybiBhZGRyOworfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9tbWFwLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X21tYXAuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwMDAuLjZlNzE2Y2I1OWQ3ZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbW1hcC5oCkBAIC0wLDAgKzEsMTkgQEAKKy8qCisg
KiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkg
SW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIElHVF9NTUFQX0gKKyNkZWZpbmUgSUdU
X01NQVBfSAorCitzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKK3N0cnVjdCBkcm1fdm1hX29mZnNl
dF9ub2RlOworCit1bnNpZ25lZCBsb25nIGlndF9tbWFwX25vZGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCisJCQkgICAgc3RydWN0IGRybV92bWFfb2Zmc2V0X25vZGUgKm5vZGUsCisJ
CQkgICAgdW5zaWduZWQgbG9uZyBhZGRyLAorCQkJICAgIHVuc2lnbmVkIGxvbmcgcHJvdCwKKwkJ
CSAgICB1bnNpZ25lZCBsb25nIGZsYWdzKTsKKworI2VuZGlmIC8qIElHVF9NTUFQX0ggKi8KLS0g
CjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
SW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

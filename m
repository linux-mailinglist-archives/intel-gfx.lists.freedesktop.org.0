Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4FE1DA136B
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C3D056E065;
	Thu, 29 Aug 2019 08:12:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A33D06E03A
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:12:04 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299864-1500050 
 for multiple; Thu, 29 Aug 2019 09:11:54 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:20 +0100
Message-Id: <20190829081150.10271-7-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/36] drm/i915: Replace obj->pin_global with
 obj->frontbuffer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

b2JqLT5waW5fZ2xvYmFsIHdhcyBvcmlnaW5hbCB1c2VkIGFzIGEgbWVhbnMgdG8ga2VlcCB0aGUg
c2hyaW5rZXIgb2ZmCnRoZSBhY3RpdmUgc2Nhbm91dCwgYnV0IHdlIHVzZSB0aGUgdm1hLT5waW5f
Y291bnQgaXRzZWxmIGZvciB0aGF0IGFuZAp0aGUgb2JqLT5mcm9udGJ1ZmZlciB0byBkZWxheSBz
aHJpbmtpbmcgYWN0aXZlIGZyYW1lYnVmZmVycy4gVGhlIG90aGVyCnJvbGUgdGhhdCBvYmotPnBp
bl9nbG9iYWwgZ2FpbmVkIHdhcyBmb3Igc3BvdHRpbmcgZGlzcGxheSBvYmplY3RzIGluc2lkZQpH
RU0gYW5kIHdvcmtpbmcgaGFyZGVyIHRvIGtlZXAgdGhvc2UgY29oZXJlbnQ7IGZvciB3aGljaCB3
ZSBjYW4gYWdhaW4Kc2ltcGx5IGluc3BlY3Qgb2JqLT5mcm9udGJ1ZmZlciBkaXJlY3RseS4KCkNv
bWluZyB1cCBuZXh0LCB3ZSB3aWxsIHdhbnQgdG8gbWFuaXB1bGF0ZSB0aGUgcGluX2dsb2JhbCBj
b3VudGVyCm91dHNpZGUgb2YgdGhlIHByaW5jaXBsZSBsb2Nrcywgc28gd291bGQgbmVlZCB0byBt
YWtlIHBpbl9nbG9iYWwgYXRvbWljLgpIb3dldmVyLCBzaW5jZSBvYmotPmZyb250YnVmZmVyIGlz
IGFscmVhZHkgbWFuYWdlZCBhdG9taWNhbGx5LCBpdCBtYWtlcwpzZW5zZSB0byB1c2UgdGhhdCB0
aGUgcHJpbWFyeSBrZXkgZm9yIGRpc3BsYXkgb2JqZWN0cyBpbnN0ZWFkIG9mIGhhdmluZwpwaW5f
Z2xvYmFsLgoKVmlsbGUgcG9pbnRlZCBvdXQgdGhlIHByaW5jaXBsZSBkaWZmZXJlbmNlIGlzIHRo
YXQgb2JqLT5mcm9udGJ1ZmZlciBpcwpzZXQgZm9yIGFzIGxvbmcgYXMgYW4gaW50ZWxfZnJhbWVi
dWZmZXIgaXMgYXR0YWNoZWQgdG8gYW4gb2JqZWN0LCBidXQKb2JqLT5waW5fZ2xvYmFsIHdhcyBv
bmx5IHJhaXNlZCBmb3IgYXMgbG9uZyBhcyB0aGUgb2JqZWN0IHdhcyBhY3RpdmUuIEluCnByYWN0
aWNlLCB0aGlzIG1lYW5zIHRoYXQgd2UgY29uc2lkZXIgdGhlIG9iamVjdCBhcyBiZWluZyBvbiB0
aGUgc2Nhbm91dApmb3IgbG9uZ2VyIHRoYW4gaXMgc3RyaWN0bHkgcmVxdWlyZWQsIGNhdXNpbmcg
dXMgdG8gYmUgbW9yZSBwcm9hY3RpdmUgaW4KZmx1c2hpbmcgLS0gdGhvdWdoIGl0IHNob3VsZCBi
ZSB0cnVlIHRoYXQgd2Ugd291bGQgaGF2ZSBmbHVzaGVkCmV2ZW50dWFsbHkgd2hlbiB0aGUgYmFj
ayBiZWNhbWUgdGhlIGZyb250LCBleGNlcHQgdGhhdCBvbiB0aGUgZmxpcCBwYXRoCnRoYXQgZmx1
c2ggaXMgYXN5bmMgYnV0IHdoZW4gaGl0IGZyb20gYW5vdGhlciBpb2N0bCBpdCB3aWxsIGJlCnN5
bmNocm9ub3VzLgoKdjI6IGk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcigpCgpTaWduZWQt
b2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IE1pa2Eg
S3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOk
bMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYyAgfCAxMyArKysrKy0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICAgfCAzNCArKysrKystLS0tLS0tLS0tLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAgMyArLQog
Li4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggIHwgIDIgLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jICB8IDE1ICsrKy0tLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAxMiArKy0t
LS0tCiA2IGZpbGVzIGNoYW5nZWQsIDI5IGluc2VydGlvbnMoKyksIDUwIGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZm
ZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYwpp
bmRleCA3MTkzNzk3NzRmYTUuLmZjNDBkYzFmZGJjYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYwpAQCAtMjIwLDExICsyMjAsMTggQEAg
c3RhdGljIHZvaWQgZnJvbnRidWZmZXJfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqcmVmKQogewogCXN0
cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQgPQogCQljb250YWluZXJfb2YocmVmLCB0eXBl
b2YoKmZyb250KSwgcmVmKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gZnJv
bnQtPm9iajsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAotCWZyb250LT5vYmotPmZyb250YnVm
ZmVyID0gTlVMTDsKLQlzcGluX3VubG9jaygmdG9faTkxNShmcm9udC0+b2JqLT5iYXNlLmRldikt
PmZiX3RyYWNraW5nLmxvY2spOworCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CisJZm9yX2Vh
Y2hfZ2d0dF92bWEodm1hLCBvYmopCisJCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBJOTE1X0dU
VF9NSU5fQUxJR05NRU5UOworCXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAotCWk5MTVf
Z2VtX29iamVjdF9wdXQoZnJvbnQtPm9iaik7CisJb2JqLT5mcm9udGJ1ZmZlciA9IE5VTEw7CisJ
c3Bpbl91bmxvY2soJnRvX2k5MTUob2JqLT5iYXNlLmRldiktPmZiX3RyYWNraW5nLmxvY2spOwor
CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCWtmcmVlKGZyb250KTsKIH0KIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCmluZGV4IDljNThlOGZhYzFkOS4u
NmFmNzQwYTVlM2RiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZG9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFp
bi5jCkBAIC0yNyw3ICsyNyw3IEBAIHN0YXRpYyB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X2Zvcl9kaXNwbGF5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAKIHZvaWQgaTkx
NV9nZW1fb2JqZWN0X2ZsdXNoX2lmX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKIHsKLQlpZiAoIVJFQURfT05DRShvYmotPnBpbl9nbG9iYWwpKQorCWlmICghaTkxNV9n
ZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9iaikpCiAJCXJldHVybjsKIAogCWk5MTVfZ2VtX29i
amVjdF9sb2NrKG9iaik7CkBAIC00MjIsMTIgKzQyMiw4IEBAIGk5MTVfZ2VtX29iamVjdF9waW5f
dG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiAJYXNz
ZXJ0X29iamVjdF9oZWxkKG9iaik7CiAKLQkvKiBNYXJrIHRoZSBnbG9iYWwgcGluIGVhcmx5IHNv
IHRoYXQgd2UgYWNjb3VudCBmb3IgdGhlCi0JICogZGlzcGxheSBjb2hlcmVuY3kgd2hpbHN0IHNl
dHRpbmcgdXAgdGhlIGNhY2hlIGRvbWFpbnMuCi0JICovCi0Jb2JqLT5waW5fZ2xvYmFsKys7Ci0K
LQkvKiBUaGUgZGlzcGxheSBlbmdpbmUgaXMgbm90IGNvaGVyZW50IHdpdGggdGhlIExMQyBjYWNo
ZSBvbiBnZW42LiAgQXMKKwkvKgorCSAqIFRoZSBkaXNwbGF5IGVuZ2luZSBpcyBub3QgY29oZXJl
bnQgd2l0aCB0aGUgTExDIGNhY2hlIG9uIGdlbjYuICBBcwogCSAqIGEgcmVzdWx0LCB3ZSBtYWtl
IHN1cmUgdGhhdCB0aGUgcGlubmluZyB0aGF0IGlzIGFib3V0IHRvIG9jY3VyIGlzCiAJICogZG9u
ZSB3aXRoIHVuY2FjaGVkIFBURXMuIFRoaXMgaXMgbG93ZXN0IGNvbW1vbiBkZW5vbWluYXRvciBm
b3IgYWxsCiAJICogY2hpcHNldHMuCkBAIC00MzksMTIgKzQzNSwxMSBAQCBpOTE1X2dlbV9vYmpl
Y3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwKIAkJCQkJICAgICAg
SEFTX1dUKHRvX2k5MTUob2JqLT5iYXNlLmRldikpID8KIAkJCQkJICAgICAgSTkxNV9DQUNIRV9X
VCA6IEk5MTVfQ0FDSEVfTk9ORSk7Ci0JaWYgKHJldCkgewotCQl2bWEgPSBFUlJfUFRSKHJldCk7
Ci0JCWdvdG8gZXJyX3VucGluX2dsb2JhbDsKLQl9CisJaWYgKHJldCkKKwkJcmV0dXJuIEVSUl9Q
VFIocmV0KTsKIAotCS8qIEFzIHRoZSB1c2VyIG1heSBtYXAgdGhlIGJ1ZmZlciBvbmNlIHBpbm5l
ZCBpbiB0aGUgZGlzcGxheSBwbGFuZQorCS8qCisJICogQXMgdGhlIHVzZXIgbWF5IG1hcCB0aGUg
YnVmZmVyIG9uY2UgcGlubmVkIGluIHRoZSBkaXNwbGF5IHBsYW5lCiAJICogKGUuZy4gbGlia21z
IGZvciB0aGUgYm9vdHVwIHNwbGFzaCksIHdlIGhhdmUgdG8gZW5zdXJlIHRoYXQgd2UKIAkgKiBh
bHdheXMgdXNlIG1hcF9hbmRfZmVuY2VhYmxlIGZvciBhbGwgc2Nhbm91dCBidWZmZXJzLiBIb3dl
dmVyLAogCSAqIGl0IG1heSBzaW1wbHkgYmUgdG9vIGJpZyB0byBmaXQgaW50byBtYXBwYWJsZSwg
aW4gd2hpY2ggY2FzZQpAQCAtNDYxLDIyICs0NTYsMTkgQEAgaTkxNV9nZW1fb2JqZWN0X3Bpbl90
b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJaWYgKElT
X0VSUih2bWEpKQogCQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCB2aWV3LCAw
LCBhbGlnbm1lbnQsIGZsYWdzKTsKIAlpZiAoSVNfRVJSKHZtYSkpCi0JCWdvdG8gZXJyX3VucGlu
X2dsb2JhbDsKKwkJcmV0dXJuIHZtYTsKIAogCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBtYXhf
dCh1NjQsIHZtYS0+ZGlzcGxheV9hbGlnbm1lbnQsIGFsaWdubWVudCk7CiAKIAlfX2k5MTVfZ2Vt
X29iamVjdF9mbHVzaF9mb3JfZGlzcGxheShvYmopOwogCi0JLyogSXQgc2hvdWxkIG5vdyBiZSBv
dXQgb2YgYW55IG90aGVyIHdyaXRlIGRvbWFpbnMsIGFuZCB3ZSBjYW4gdXBkYXRlCisJLyoKKwkg
KiBJdCBzaG91bGQgbm93IGJlIG91dCBvZiBhbnkgb3RoZXIgd3JpdGUgZG9tYWlucywgYW5kIHdl
IGNhbiB1cGRhdGUKIAkgKiB0aGUgZG9tYWluIHZhbHVlcyBmb3Igb3VyIGNoYW5nZXMuCiAJICov
CiAJb2JqLT5yZWFkX2RvbWFpbnMgfD0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKIAogCXJldHVybiB2
bWE7Ci0KLWVycl91bnBpbl9nbG9iYWw6Ci0Jb2JqLT5waW5fZ2xvYmFsLS07Ci0JcmV0dXJuIHZt
YTsKIH0KIAogc3RhdGljIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQpAQCAtNTE0LDEyICs1MDYsNiBAQCBpOTE1
X2dlbV9vYmplY3RfdW5waW5fZnJvbV9kaXNwbGF5X3BsYW5lKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQogCiAJYXNzZXJ0X29iamVjdF9oZWxkKG9iaik7CiAKLQlpZiAoV0FSTl9PTihvYmotPnBpbl9n
bG9iYWwgPT0gMCkpCi0JCXJldHVybjsKLQotCWlmICgtLW9iai0+cGluX2dsb2JhbCA9PSAwKQot
CQl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gSTkxNV9HVFRfTUlOX0FMSUdOTUVOVDsKLQogCS8q
IEJ1bXAgdGhlIExSVSB0byB0cnkgYW5kIGF2b2lkIHByZW1hdHVyZSBldmljdGlvbiB3aGlsc3Qg
ZmxpcHBpbmcgICovCiAJaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChvYmopOwog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5kZXggNWVmYjk5
MzZlMDViLi4yOWI5ZWRkYzRjN2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fb2JqZWN0LmgKQEAgLTQwNiw3ICs0MDYsOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wgY3B1X3dy
aXRlX25lZWRzX2NsZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlpZiAo
IShvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfV1JJVEUp
KQogCQlyZXR1cm4gdHJ1ZTsKIAotCXJldHVybiBvYmotPnBpbl9nbG9iYWw7IC8qIGN1cnJlbnRs
eSBpbiB1c2UgYnkgSFcsIGtlZXAgZmx1c2hlZCAqLworCS8qIEN1cnJlbnRseSBpbiB1c2UgYnkg
SFcgKGRpc3BsYXkgZW5naW5lKT8gS2VlcCBmbHVzaGVkLiAqLworCXJldHVybiBpOTE1X2dlbV9v
YmplY3RfaXNfZnJhbWVidWZmZXIob2JqKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIF9fc3Rh
cnRfY3B1X3dyaXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5kZXggZWRlMGVi
NDIxOGE4Li4xM2I5ZGMwZTFhODkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKQEAgLTE1Miw4ICsxNTIsNiBAQCBzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCB7CiAKIAkvKiogQ291bnQgb2YgVk1BIGFjdHVhbGx5IGJvdW5kIGJ5IHRo
aXMgb2JqZWN0ICovCiAJYXRvbWljX3QgYmluZF9jb3VudDsKLQkvKiogQ291bnQgb2YgaG93IG1h
bnkgZ2xvYmFsIFZNQSBhcmUgY3VycmVudGx5IHBpbm5lZCBmb3IgdXNlIGJ5IEhXICovCi0JdW5z
aWduZWQgaW50IHBpbl9nbG9iYWw7CiAKIAlzdHJ1Y3QgewogCQlzdHJ1Y3QgbXV0ZXggbG9jazsg
LyogcHJvdGVjdHMgdGhlIHBhZ2VzIGFuZCB0aGVpciB1c2UgKi8KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKaW5kZXggZWRkMjFkMTRlNjRmLi40ZTU1Y2Zj
MmIwZGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJp
bmtlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5j
CkBAIC02MSw3ICs2MSw4IEBAIHN0YXRpYyBib29sIGNhbl9yZWxlYXNlX3BhZ2VzKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfc2hyaW5r
YWJsZShvYmopKQogCQlyZXR1cm4gZmFsc2U7CiAKLQkvKiBPbmx5IHJlcG9ydCB0cnVlIGlmIGJ5
IHVuYmluZGluZyB0aGUgb2JqZWN0IGFuZCBwdXR0aW5nIGl0cyBwYWdlcworCS8qCisJICogT25s
eSByZXBvcnQgdHJ1ZSBpZiBieSB1bmJpbmRpbmcgdGhlIG9iamVjdCBhbmQgcHV0dGluZyBpdHMg
cGFnZXMKIAkgKiB3ZSBjYW4gYWN0dWFsbHkgbWFrZSBmb3J3YXJkIHByb2dyZXNzIHRvd2FyZHMg
ZnJlZWluZyBwaHlzaWNhbAogCSAqIHBhZ2VzLgogCSAqCkBAIC03MiwxNiArNzMsOCBAQCBzdGF0
aWMgYm9vbCBjYW5fcmVsZWFzZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KQogCWlmIChhdG9taWNfcmVhZCgmb2JqLT5tbS5wYWdlc19waW5fY291bnQpID4gYXRvbWljX3Jl
YWQoJm9iai0+YmluZF9jb3VudCkpCiAJCXJldHVybiBmYWxzZTsKIAotCS8qIElmIGFueSB2bWEg
YXJlICJwZXJtYW5lbnRseSIgcGlubmVkLCBpdCB3aWxsIHByZXZlbnQgdXMgZnJvbQotCSAqIHJl
Y2xhaW1pbmcgdGhlIG9iai0+bW0ucGFnZXMuIFdlIG9ubHkgYWxsb3cgc2Nhbm91dCBvYmplY3Rz
IHRvIGNsYWltCi0JICogYSBwZXJtYW5lbnQgcGluLCBhbG9uZyB3aXRoIGEgZmV3IG90aGVycyBs
aWtlIHRoZSBjb250ZXh0IG9iamVjdHMuCi0JICogVG8gc2ltcGxpZnkgdGhlIHNjYW4sIGFuZCB0
byBhdm9pZCB3YWxraW5nIHRoZSBsaXN0IG9mIHZtYSB1bmRlciB0aGUKLQkgKiBvYmplY3QsIHdl
IGp1c3QgY2hlY2sgdGhlIGNvdW50IG9mIGl0cyBwZXJtYW5lbnRseSBwaW5uZWQuCi0JICovCi0J
aWYgKFJFQURfT05DRShvYmotPnBpbl9nbG9iYWwpKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQkvKiBX
ZSBjYW4gb25seSByZXR1cm4gcGh5c2ljYWwgcGFnZXMgdG8gdGhlIHN5c3RlbSBpZiB3ZSBjYW4g
ZWl0aGVyCisJLyoKKwkgKiBXZSBjYW4gb25seSByZXR1cm4gcGh5c2ljYWwgcGFnZXMgdG8gdGhl
IHN5c3RlbSBpZiB3ZSBjYW4gZWl0aGVyCiAJICogZGlzY2FyZCB0aGUgY29udGVudHMgKGJlY2F1
c2UgdGhlIHVzZXIgaGFzIG1hcmtlZCB0aGVtIGFzIGJlaW5nCiAJICogcHVyZ2VhYmxlKSBvciBp
ZiB3ZSBjYW4gbW92ZSB0aGVpciBjb250ZW50cyBvdXQgdG8gc3dhcC4KIAkgKi8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggNWU4MWM0ZmMxM2FlLi4zMGIwYjU5MmUyMGQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC03NywxMSArNzcsNiBAQCBzdGF0aWMg
aW50IGk5MTVfY2FwYWJpbGl0aWVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAly
ZXR1cm4gMDsKIH0KIAotc3RhdGljIGNoYXIgZ2V0X3Bpbl9mbGFnKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCi17Ci0JcmV0dXJuIG9iai0+cGluX2dsb2JhbCA/ICdwJyA6ICcgJzsK
LX0KLQogc3RhdGljIGNoYXIgZ2V0X3RpbGluZ19mbGFnKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopCiB7CiAJc3dpdGNoIChpOTE1X2dlbV9vYmplY3RfZ2V0X3RpbGluZyhvYmopKSB7
CkBAIC0xNDAsOSArMTM1LDggQEAgZGVzY3JpYmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAlp
bnQgcGluX2NvdW50ID0gMDsKIAotCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjJWMgJTh6ZEtp
QiAlMDJ4ICUwMnggJXMlcyVzIiwKKwlzZXFfcHJpbnRmKG0sICIlcEs6ICVjJWMlYyAlOHpkS2lC
ICUwMnggJTAyeCAlcyVzJXMiLAogCQkgICAmb2JqLT5iYXNlLAotCQkgICBnZXRfcGluX2ZsYWco
b2JqKSwKIAkJICAgZ2V0X3RpbGluZ19mbGFnKG9iaiksCiAJCSAgIGdldF9nbG9iYWxfZmxhZyhv
YmopLAogCQkgICBnZXRfcGluX21hcHBlZF9mbGFnKG9iaiksCkBAIC0yMjEsOCArMjE1LDggQEAg
ZGVzY3JpYmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaikKIAlzZXFfcHJpbnRmKG0sICIgKHBpbm5lZCB4ICVkKSIsIHBpbl9jb3VudCk7CiAJ
aWYgKG9iai0+c3RvbGVuKQogCQlzZXFfcHJpbnRmKG0sICIgKHN0b2xlbjogJTA4bGx4KSIsIG9i
ai0+c3RvbGVuLT5zdGFydCk7Ci0JaWYgKG9iai0+cGluX2dsb2JhbCkKLQkJc2VxX3ByaW50Ziht
LCAiIChnbG9iYWwpIik7CisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihvYmop
KQorCQlzZXFfcHJpbnRmKG0sICIgKGZiKSIpOwogCiAJZW5naW5lID0gaTkxNV9nZW1fb2JqZWN0
X2xhc3Rfd3JpdGVfZW5naW5lKG9iaik7CiAJaWYgKGVuZ2luZSkKLS0gCjIuMjMuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

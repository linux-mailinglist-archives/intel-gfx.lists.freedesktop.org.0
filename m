Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E400A37FF2
	for <lists+intel-gfx@lfdr.de>; Thu,  6 Jun 2019 23:52:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3526B899BC;
	Thu,  6 Jun 2019 21:52:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2481D899BC
 for <intel-gfx@lists.freedesktop.org>; Thu,  6 Jun 2019 21:52:42 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Jun 2019 14:52:42 -0700
X-ExtLoop1: 1
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga002.jf.intel.com with ESMTP; 06 Jun 2019 14:52:41 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  6 Jun 2019 14:52:10 -0700
Message-Id: <20190606215218.34486-2-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190606215218.34486-1-daniele.ceraolospurio@intel.com>
References: <20190606215218.34486-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 1/8] drm/i915: use vfuncs for
 reg_read/write_fw_domains
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiBnb2luZyB0aHJvdWdoIHRoZSBpZi1lbHNlIGNoYWluIGV2ZXJ5IHRpbWUsIGxl
dCdzIHNhdmUgdGhlCmZ1bmN0aW9uIGluIHRoZSB1bmNvcmUgc3RydWN0dXJlLiBOb3RlIHRoYXQg
dGhlIG5ldyBmdW5jdGlvbnMgYXJlCnB1cnBvc2VseSBub3QgdXNlZCBmcm9tIHRoZSByZWcgcmVh
ZC93cml0ZSBmdW5jdGlvbnMgdG8ga2VlcCB0aGUKaW5saW5pbmcgdGhlcmUuCgpXaGlsZSBhdCBp
dCwgdXNlIHRoZSBuZXcgbWFjcm8gdG8gY2FsbCB0aGUgb2xkIG9uZXMgdG8gY2xlYW4gdGhlIGNv
ZGUgYQpiaXQuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxl
LmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3VuY29yZS5jICAgICAgICAgIHwgMTcyICsrKysrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3VuY29yZS5oICAgICAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX3VuY29yZS5jIHwgICA0ICstCiAzIGZpbGVzIGNoYW5nZWQs
IDc1IGluc2VydGlvbnMoKyksIDEwNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3VuY29yZS5jCmluZGV4IGY3ODY2ODEyM2YwMi4uYzNiZTc5YzQ5NTdiIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF91bmNvcmUuYwpAQCAtOTAxLDYgKzkwMSwxMiBAQCBzdGF0aWMgYm9vbCBpc19n
ZW4jI3gjI19zaGFkb3dlZCh1MzIgb2Zmc2V0KSBcCiBfX2lzX2dlblhfc2hhZG93ZWQoOCkKIF9f
aXNfZ2VuWF9zaGFkb3dlZCgxMSkKIAorc3RhdGljIGVudW0gZm9yY2V3YWtlX2RvbWFpbnMKK2dl
bjZfcmVnX3dyaXRlX2Z3X2RvbWFpbnMoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLCBpOTE1
X3JlZ190IHJlZykKK3sKKwlyZXR1cm4gRk9SQ0VXQUtFX1JFTkRFUjsKK30KKwogI2RlZmluZSBf
X2dlbjhfcmVnX3dyaXRlX2Z3X2RvbWFpbnModW5jb3JlLCBvZmZzZXQpIFwKICh7IFwKIAllbnVt
IGZvcmNld2FrZV9kb21haW5zIF9fZndkOyBcCkBAIC0xMTQ1LDI2ICsxMTUxLDIzIEBAIGZ1bmMj
I19yZWFkIyN4KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwgaTkxNV9yZWdfdCByZWcsIGJv
b2wgdHJhY2UpIHsgXAogCXZhbCA9IF9fcmF3X3VuY29yZV9yZWFkIyN4KHVuY29yZSwgcmVnKTsg
XAogCUdFTjZfUkVBRF9GT09URVI7IFwKIH0KLSNkZWZpbmUgX19nZW42X3JlYWQoeCkgX19nZW5f
cmVhZChnZW42LCB4KQotI2RlZmluZSBfX2Z3dGFibGVfcmVhZCh4KSBfX2dlbl9yZWFkKGZ3dGFi
bGUsIHgpCi0jZGVmaW5lIF9fZ2VuMTFfZnd0YWJsZV9yZWFkKHgpIF9fZ2VuX3JlYWQoZ2VuMTFf
Znd0YWJsZSwgeCkKLQotX19nZW4xMV9md3RhYmxlX3JlYWQoOCkKLV9fZ2VuMTFfZnd0YWJsZV9y
ZWFkKDE2KQotX19nZW4xMV9md3RhYmxlX3JlYWQoMzIpCi1fX2dlbjExX2Z3dGFibGVfcmVhZCg2
NCkKLV9fZnd0YWJsZV9yZWFkKDgpCi1fX2Z3dGFibGVfcmVhZCgxNikKLV9fZnd0YWJsZV9yZWFk
KDMyKQotX19md3RhYmxlX3JlYWQoNjQpCi1fX2dlbjZfcmVhZCg4KQotX19nZW42X3JlYWQoMTYp
Ci1fX2dlbjZfcmVhZCgzMikKLV9fZ2VuNl9yZWFkKDY0KQotCi0jdW5kZWYgX19nZW4xMV9md3Rh
YmxlX3JlYWQKLSN1bmRlZiBfX2Z3dGFibGVfcmVhZAotI3VuZGVmIF9fZ2VuNl9yZWFkCisKKyNk
ZWZpbmUgX19nZW5fcmVnX3JlYWRfZnVuY3MoZnVuYykgXAorc3RhdGljIGVudW0gZm9yY2V3YWtl
X2RvbWFpbnMgXAorZnVuYyMjX3JlZ19yZWFkX2Z3X2RvbWFpbnMoc3RydWN0IGludGVsX3VuY29y
ZSAqdW5jb3JlLCBpOTE1X3JlZ190IHJlZykgeyBcCisJcmV0dXJuIF9fIyNmdW5jIyNfcmVnX3Jl
YWRfZndfZG9tYWlucyh1bmNvcmUsIGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZykpOyBcCit9IFwK
K1wKK19fZ2VuX3JlYWQoZnVuYywgOCkgXAorX19nZW5fcmVhZChmdW5jLCAxNikgXAorX19nZW5f
cmVhZChmdW5jLCAzMikgXAorX19nZW5fcmVhZChmdW5jLCA2NCkKKworX19nZW5fcmVnX3JlYWRf
ZnVuY3MoZ2VuMTFfZnd0YWJsZSk7CitfX2dlbl9yZWdfcmVhZF9mdW5jcyhmd3RhYmxlKTsKK19f
Z2VuX3JlZ19yZWFkX2Z1bmNzKGdlbjYpOworCisjdW5kZWYgX19nZW5fcmVnX3JlYWRfZnVuY3MK
ICN1bmRlZiBHRU42X1JFQURfRk9PVEVSCiAjdW5kZWYgR0VONl9SRUFEX0hFQURFUgogCkBAIC0x
MjI1LDYgKzEyMjgsOSBAQCBnZW42X3dyaXRlIyN4KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSwgaTkxNV9yZWdfdCByZWcsIHUjI3ggdmFsLCBib29sIHRyYWNlKQogCV9fcmF3X3VuY29yZV93
cml0ZSMjeCh1bmNvcmUsIHJlZywgdmFsKTsgXAogCUdFTjZfV1JJVEVfRk9PVEVSOyBcCiB9Citf
X2dlbjZfd3JpdGUoOCkKK19fZ2VuNl93cml0ZSgxNikKK19fZ2VuNl93cml0ZSgzMikKIAogI2Rl
ZmluZSBfX2dlbl93cml0ZShmdW5jLCB4KSBcCiBzdGF0aWMgdm9pZCBcCkBAIC0xMjM3LDM4ICsx
MjQzLDMzIEBAIGZ1bmMjI193cml0ZSMjeChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsIGk5
MTVfcmVnX3QgcmVnLCB1IyN4IHZhbCwgYm9vbCB0cmFjCiAJX19yYXdfdW5jb3JlX3dyaXRlIyN4
KHVuY29yZSwgcmVnLCB2YWwpOyBcCiAJR0VONl9XUklURV9GT09URVI7IFwKIH0KLSNkZWZpbmUg
X19nZW44X3dyaXRlKHgpIF9fZ2VuX3dyaXRlKGdlbjgsIHgpCi0jZGVmaW5lIF9fZnd0YWJsZV93
cml0ZSh4KSBfX2dlbl93cml0ZShmd3RhYmxlLCB4KQotI2RlZmluZSBfX2dlbjExX2Z3dGFibGVf
d3JpdGUoeCkgX19nZW5fd3JpdGUoZ2VuMTFfZnd0YWJsZSwgeCkKLQotX19nZW4xMV9md3RhYmxl
X3dyaXRlKDgpCi1fX2dlbjExX2Z3dGFibGVfd3JpdGUoMTYpCi1fX2dlbjExX2Z3dGFibGVfd3Jp
dGUoMzIpCi1fX2Z3dGFibGVfd3JpdGUoOCkKLV9fZnd0YWJsZV93cml0ZSgxNikKLV9fZnd0YWJs
ZV93cml0ZSgzMikKLV9fZ2VuOF93cml0ZSg4KQotX19nZW44X3dyaXRlKDE2KQotX19nZW44X3dy
aXRlKDMyKQotX19nZW42X3dyaXRlKDgpCi1fX2dlbjZfd3JpdGUoMTYpCi1fX2dlbjZfd3JpdGUo
MzIpCiAKLSN1bmRlZiBfX2dlbjExX2Z3dGFibGVfd3JpdGUKLSN1bmRlZiBfX2Z3dGFibGVfd3Jp
dGUKLSN1bmRlZiBfX2dlbjhfd3JpdGUKLSN1bmRlZiBfX2dlbjZfd3JpdGUKKyNkZWZpbmUgX19n
ZW5fcmVnX3dyaXRlX2Z1bmNzKGZ1bmMpIFwKK3N0YXRpYyBlbnVtIGZvcmNld2FrZV9kb21haW5z
IFwKK2Z1bmMjI19yZWdfd3JpdGVfZndfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNv
cmUsIGk5MTVfcmVnX3QgcmVnKSB7IFwKKwlyZXR1cm4gX18jI2Z1bmMjI19yZWdfd3JpdGVfZndf
ZG9tYWlucyh1bmNvcmUsIGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZykpOyBcCit9IFwKK1wKK19f
Z2VuX3dyaXRlKGZ1bmMsIDgpIFwKK19fZ2VuX3dyaXRlKGZ1bmMsIDE2KSBcCitfX2dlbl93cml0
ZShmdW5jLCAzMikKKworX19nZW5fcmVnX3dyaXRlX2Z1bmNzKGdlbjExX2Z3dGFibGUpOworX19n
ZW5fcmVnX3dyaXRlX2Z1bmNzKGZ3dGFibGUpOworX19nZW5fcmVnX3dyaXRlX2Z1bmNzKGdlbjgp
OworCisjdW5kZWYgX19nZW5fcmVnX3dyaXRlX2Z1bmNzCiAjdW5kZWYgR0VONl9XUklURV9GT09U
RVIKICN1bmRlZiBHRU42X1dSSVRFX0hFQURFUgogCi0jZGVmaW5lIEFTU0lHTl9XUklURV9NTUlP
X1ZGVU5DUyh1bmNvcmUsIHgpIFwKKyNkZWZpbmUgQVNTSUdOX1dSSVRFX01NSU9fVkZVTkNTX05P
X0ZXKHVuY29yZSwgeCkgXAogZG8geyBcCiAJKHVuY29yZSktPmZ1bmNzLm1taW9fd3JpdGViID0g
eCMjX3dyaXRlODsgXAogCSh1bmNvcmUpLT5mdW5jcy5tbWlvX3dyaXRldyA9IHgjI193cml0ZTE2
OyBcCiAJKHVuY29yZSktPmZ1bmNzLm1taW9fd3JpdGVsID0geCMjX3dyaXRlMzI7IFwKIH0gd2hp
bGUgKDApCiAKLSNkZWZpbmUgQVNTSUdOX1JFQURfTU1JT19WRlVOQ1ModW5jb3JlLCB4KSBcCisj
ZGVmaW5lIEFTU0lHTl9SRUFEX01NSU9fVkZVTkNTX05PX0ZXKHVuY29yZSwgeCkgXAogZG8geyBc
CiAJKHVuY29yZSktPmZ1bmNzLm1taW9fcmVhZGIgPSB4IyNfcmVhZDg7IFwKIAkodW5jb3JlKS0+
ZnVuY3MubW1pb19yZWFkdyA9IHgjI19yZWFkMTY7IFwKQEAgLTEyNzYsNiArMTI3NywxNyBAQCBk
byB7IFwKIAkodW5jb3JlKS0+ZnVuY3MubW1pb19yZWFkcSA9IHgjI19yZWFkNjQ7IFwKIH0gd2hp
bGUgKDApCiAKKyNkZWZpbmUgQVNTSUdOX1dSSVRFX01NSU9fVkZVTkNTKHVuY29yZSwgeCkgXAor
ZG8geyBcCisJQVNTSUdOX1dSSVRFX01NSU9fVkZVTkNTX05PX0ZXKCh1bmNvcmUpLCB4KTsgXAor
CSh1bmNvcmUpLT5mdW5jcy53cml0ZV9md19kb21haW5zID0geCMjX3JlZ193cml0ZV9md19kb21h
aW5zOyBcCit9IHdoaWxlICgwKQorCisjZGVmaW5lIEFTU0lHTl9SRUFEX01NSU9fVkZVTkNTKHVu
Y29yZSwgeCkgXAorZG8geyBcCisJQVNTSUdOX1JFQURfTU1JT19WRlVOQ1NfTk9fRlcodW5jb3Jl
LCB4KTsgXAorCSh1bmNvcmUpLT5mdW5jcy5yZWFkX2Z3X2RvbWFpbnMgPSB4IyNfcmVnX3JlYWRf
ZndfZG9tYWluczsgXAorfSB3aGlsZSAoMCkKIAogc3RhdGljIHZvaWQgZndfZG9tYWluX2luaXQo
c3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAogCQkJICAgZW51bSBmb3JjZXdha2VfZG9tYWlu
X2lkIGRvbWFpbl9pZCwKQEAgLTE1NTksMTEgKzE1NzEsMTEgQEAgaW50IGludGVsX3VuY29yZV9p
bml0X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogCiAJaWYgKCFpbnRlbF91bmNv
cmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKSB7CiAJCWlmIChJU19HRU4oaTkxNSwgNSkpIHsKLQkJ
CUFTU0lHTl9XUklURV9NTUlPX1ZGVU5DUyh1bmNvcmUsIGdlbjUpOwotCQkJQVNTSUdOX1JFQURf
TU1JT19WRlVOQ1ModW5jb3JlLCBnZW41KTsKKwkJCUFTU0lHTl9XUklURV9NTUlPX1ZGVU5DU19O
T19GVyh1bmNvcmUsIGdlbjUpOworCQkJQVNTSUdOX1JFQURfTU1JT19WRlVOQ1NfTk9fRlcodW5j
b3JlLCBnZW41KTsKIAkJfSBlbHNlIHsKLQkJCUFTU0lHTl9XUklURV9NTUlPX1ZGVU5DUyh1bmNv
cmUsIGdlbjIpOwotCQkJQVNTSUdOX1JFQURfTU1JT19WRlVOQ1ModW5jb3JlLCBnZW4yKTsKKwkJ
CUFTU0lHTl9XUklURV9NTUlPX1ZGVU5DU19OT19GVyh1bmNvcmUsIGdlbjIpOworCQkJQVNTSUdO
X1JFQURfTU1JT19WRlVOQ1NfTk9fRlcodW5jb3JlLCBnZW4yKTsKIAkJfQogCX0gZWxzZSBpZiAo
SVNfR0VOX1JBTkdFKGk5MTUsIDYsIDcpKSB7CiAJCUFTU0lHTl9XUklURV9NTUlPX1ZGVU5DUyh1
bmNvcmUsIGdlbjYpOwpAQCAtMTU5NCw2ICsxNjA2LDEyIEBAIGludCBpbnRlbF91bmNvcmVfaW5p
dF9tbWlvKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIAkJQVNTSUdOX1JFQURfTU1JT19W
RlVOQ1ModW5jb3JlLCBnZW4xMV9md3RhYmxlKTsKIAl9CiAKKwkvKiBtYWtlIHN1cmUgZncgZnVu
Y3MgYXJlIHNldCBpZiBhbmQgb25seSBpZiB3ZSBoYXZlIGZ3Ki8KKwlHRU1fQlVHX09OKGludGVs
X3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkgIT0gISF1bmNvcmUtPmZ1bmNzLmZvcmNlX3dh
a2VfZ2V0KTsKKwlHRU1fQlVHX09OKGludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkg
IT0gISF1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2VfcHV0KTsKKwlHRU1fQlVHX09OKGludGVsX3Vu
Y29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkgIT0gISF1bmNvcmUtPmZ1bmNzLnJlYWRfZndfZG9t
YWlucyk7CisJR0VNX0JVR19PTihpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpICE9
ICEhdW5jb3JlLT5mdW5jcy53cml0ZV9md19kb21haW5zKTsKKwogCWlmIChIQVNfRlBHQV9EQkdf
VU5DTEFJTUVEKGk5MTUpKQogCQl1bmNvcmUtPmZsYWdzIHw9IFVOQ09SRV9IQVNfRlBHQV9EQkdf
VU5DTEFJTUVEOwogCkBAIC0xODY2LDYyICsxODg0LDYgQEAgaW50ZWxfdW5jb3JlX2FybV91bmNs
YWltZWRfbW1pb19kZXRlY3Rpb24oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogCXJldHVy
biByZXQ7CiB9CiAKLXN0YXRpYyBlbnVtIGZvcmNld2FrZV9kb21haW5zCi1pbnRlbF91bmNvcmVf
Zm9yY2V3YWtlX2Zvcl9yZWFkKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKLQkJCQlpOTE1
X3JlZ190IHJlZykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHVuY29yZV90
b19pOTE1KHVuY29yZSk7Ci0JdTMyIG9mZnNldCA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZyk7
Ci0JZW51bSBmb3JjZXdha2VfZG9tYWlucyBmd19kb21haW5zOwotCi0JaWYgKElOVEVMX0dFTihp
OTE1KSA+PSAxMSkgewotCQlmd19kb21haW5zID0gX19nZW4xMV9md3RhYmxlX3JlZ19yZWFkX2Z3
X2RvbWFpbnModW5jb3JlLCBvZmZzZXQpOwotCX0gZWxzZSBpZiAoSEFTX0ZXVEFCTEUoaTkxNSkp
IHsKLQkJZndfZG9tYWlucyA9IF9fZnd0YWJsZV9yZWdfcmVhZF9md19kb21haW5zKHVuY29yZSwg
b2Zmc2V0KTsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KSB7Ci0JCWZ3X2RvbWFp
bnMgPSBfX2dlbjZfcmVnX3JlYWRfZndfZG9tYWlucyh1bmNvcmUsIG9mZnNldCk7Ci0JfSBlbHNl
IHsKLQkJLyogb24gZGV2aWNlcyB3aXRoIEZXIHdlIGV4cGVjdCB0byBoaXQgb25lIG9mIHRoZSBh
Ym92ZSBjYXNlcyAqLwotCQlpZiAoaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkK
LQkJCU1JU1NJTkdfQ0FTRShJTlRFTF9HRU4oaTkxNSkpOwotCi0JCWZ3X2RvbWFpbnMgPSAwOwot
CX0KLQotCVdBUk5fT04oZndfZG9tYWlucyAmIH51bmNvcmUtPmZ3X2RvbWFpbnMpOwotCi0JcmV0
dXJuIGZ3X2RvbWFpbnM7Ci19Ci0KLXN0YXRpYyBlbnVtIGZvcmNld2FrZV9kb21haW5zCi1pbnRl
bF91bmNvcmVfZm9yY2V3YWtlX2Zvcl93cml0ZShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUs
Ci0JCQkJIGk5MTVfcmVnX3QgcmVnKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdW5jb3JlX3RvX2k5MTUodW5jb3JlKTsKLQl1MzIgb2Zmc2V0ID0gaTkxNV9tbWlvX3JlZ19v
ZmZzZXQocmVnKTsKLQllbnVtIGZvcmNld2FrZV9kb21haW5zIGZ3X2RvbWFpbnM7Ci0KLQlpZiAo
SU5URUxfR0VOKGk5MTUpID49IDExKSB7Ci0JCWZ3X2RvbWFpbnMgPSBfX2dlbjExX2Z3dGFibGVf
cmVnX3dyaXRlX2Z3X2RvbWFpbnModW5jb3JlLCBvZmZzZXQpOwotCX0gZWxzZSBpZiAoSEFTX0ZX
VEFCTEUoaTkxNSkgJiYgIUlTX1ZBTExFWVZJRVcoaTkxNSkpIHsKLQkJZndfZG9tYWlucyA9IF9f
Znd0YWJsZV9yZWdfd3JpdGVfZndfZG9tYWlucyh1bmNvcmUsIG9mZnNldCk7Ci0JfSBlbHNlIGlm
IChJU19HRU4oaTkxNSwgOCkpIHsKLQkJZndfZG9tYWlucyA9IF9fZ2VuOF9yZWdfd3JpdGVfZndf
ZG9tYWlucyh1bmNvcmUsIG9mZnNldCk7Ci0JfSBlbHNlIGlmIChJU19HRU5fUkFOR0UoaTkxNSwg
NiwgNykpIHsKLQkJZndfZG9tYWlucyA9IEZPUkNFV0FLRV9SRU5ERVI7Ci0JfSBlbHNlIHsKLQkJ
Lyogb24gZGV2aWNlcyB3aXRoIEZXIHdlIGV4cGVjdCB0byBoaXQgb25lIG9mIHRoZSBhYm92ZSBj
YXNlcyAqLwotCQlpZiAoaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkKLQkJCU1J
U1NJTkdfQ0FTRShJTlRFTF9HRU4oaTkxNSkpOwotCi0JCWZ3X2RvbWFpbnMgPSAwOwotCX0KLQot
CVdBUk5fT04oZndfZG9tYWlucyAmIH51bmNvcmUtPmZ3X2RvbWFpbnMpOwotCi0JcmV0dXJuIGZ3
X2RvbWFpbnM7Ci19Ci0KIC8qKgogICogaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9mb3JfcmVnIC0g
d2hpY2ggZm9yY2V3YWtlIGRvbWFpbnMgYXJlIG5lZWRlZCB0byBhY2Nlc3MKICAqIAkJCQkgICAg
YSByZWdpc3RlcgpAQCAtMTk0OCwxMCArMTkxMCwxMiBAQCBpbnRlbF91bmNvcmVfZm9yY2V3YWtl
X2Zvcl9yZWcoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAogCQlyZXR1cm4gMDsKIAogCWlm
IChvcCAmIEZXX1JFR19SRUFEKQotCQlmd19kb21haW5zID0gaW50ZWxfdW5jb3JlX2ZvcmNld2Fr
ZV9mb3JfcmVhZCh1bmNvcmUsIHJlZyk7CisJCWZ3X2RvbWFpbnMgPSB1bmNvcmUtPmZ1bmNzLnJl
YWRfZndfZG9tYWlucyh1bmNvcmUsIHJlZyk7CiAKIAlpZiAob3AgJiBGV19SRUdfV1JJVEUpCi0J
CWZ3X2RvbWFpbnMgfD0gaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9mb3Jfd3JpdGUodW5jb3JlLCBy
ZWcpOworCQlmd19kb21haW5zIHw9IHVuY29yZS0+ZnVuY3Mud3JpdGVfZndfZG9tYWlucyh1bmNv
cmUsIHJlZyk7CisKKwlXQVJOX09OKGZ3X2RvbWFpbnMgJiB+dW5jb3JlLT5md19kb21haW5zKTsK
IAogCXJldHVybiBmd19kb21haW5zOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfdW5jb3JlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuaApp
bmRleCBkNmFmM2RlNzAxMjEuLjcyZWY4YjI2MjkzMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
dW5jb3JlLmgKQEAgLTcwLDYgKzcwLDExIEBAIHN0cnVjdCBpbnRlbF91bmNvcmVfZnVuY3Mgewog
CXZvaWQgKCpmb3JjZV93YWtlX3B1dCkoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAogCQkJ
ICAgICAgIGVudW0gZm9yY2V3YWtlX2RvbWFpbnMgZG9tYWlucyk7CiAKKwllbnVtIGZvcmNld2Fr
ZV9kb21haW5zICgqcmVhZF9md19kb21haW5zKShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUs
CisJCQkJCQkgIGk5MTVfcmVnX3Qgcik7CisJZW51bSBmb3JjZXdha2VfZG9tYWlucyAoKndyaXRl
X2Z3X2RvbWFpbnMpKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKKwkJCQkJCSAgIGk5MTVf
cmVnX3Qgcik7CisKIAl1OCAoKm1taW9fcmVhZGIpKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSwKIAkJCSBpOTE1X3JlZ190IHIsIGJvb2wgdHJhY2UpOwogCXUxNiAoKm1taW9fcmVhZHcpKHN0
cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9tb2NrX3VuY29yZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL21vY2tfdW5jb3JlLmMKaW5kZXggZmY4OTk5YzYzYTEyLi4zNDMwMTcyMTU0NjMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX3VuY29yZS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX3VuY29yZS5jCkBAIC00MSw2ICs0
MSw2IEBAIF9fbm9wX3JlYWQoNjQpCiAKIHZvaWQgbW9ja191bmNvcmVfaW5pdChzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUpCiB7Ci0JQVNTSUdOX1dSSVRFX01NSU9fVkZVTkNTKHVuY29yZSwg
bm9wKTsKLQlBU1NJR05fUkVBRF9NTUlPX1ZGVU5DUyh1bmNvcmUsIG5vcCk7CisJQVNTSUdOX1dS
SVRFX01NSU9fVkZVTkNTX05PX0ZXKHVuY29yZSwgbm9wKTsKKwlBU1NJR05fUkVBRF9NTUlPX1ZG
VU5DU19OT19GVyh1bmNvcmUsIG5vcCk7CiB9Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50
ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8C1B6347B8
	for <lists+intel-gfx@lfdr.de>; Tue,  4 Jun 2019 15:11:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DADE68982A;
	Tue,  4 Jun 2019 13:11:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0CB768982D
 for <intel-gfx@lists.freedesktop.org>; Tue,  4 Jun 2019 13:11:49 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 04 Jun 2019 06:11:48 -0700
X-ExtLoop1: 1
Received: from bblokx-mobl.ger.corp.intel.com (HELO delly.ger.corp.intel.com)
 ([10.249.139.199])
 by FMSMGA003.fm.intel.com with ESMTP; 04 Jun 2019 06:11:47 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  4 Jun 2019 16:11:35 +0300
Message-Id: <20190604131140.12647-3-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190604131140.12647-1-lionel.g.landwerlin@intel.com>
References: <20190604131140.12647-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 2/7] drm/i915/perf: allow for CS OA configs
 to be created lazily
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SGVyZSB3ZSBpbnRyb2R1Y2UgYSBtZWNoYW5pc20gYnkgd2hpY2ggdGhlIGV4ZWNidWYgcGFydCBv
ZiB0aGUgaTkxNQpkcml2ZXIgd2lsbCBiZSBhYmxlIHRvIHJlcXVlc3QgdGhhdCBhIGJhdGNoIGJ1
ZmZlciBjb250YWluaW5nIHRoZQpwcm9ncmFtbWluZyBmb3IgYSBwYXJ0aWN1bGFyIE9BIGNvbmZp
ZyBiZSBjcmVhdGVkLgoKV2UnbGwgZXhlY3V0ZSB0aGVzZSBPQSBjb25maWd1cmF0aW9uIGJ1ZmZl
cnMgcmlnaHQgYmVmb3JlIGV4ZWN1dGluZyBhCnNldCBvZiB1c2Vyc3BhY2UgY29tbWFuZHMgc28g
dGhhdCBhIHBhcnRpY3VsYXIgdXNlciBiYXRjaGJ1ZmZlciBiZQpleGVjdXRlZCB3aXRoIGEgZ2l2
ZW4gT0EgY29uZmlndXJhdGlvbi4KClRoaXMgbWVjaGFuaXNtIGVzc2VudGlhbGx5IGFsbG93cyB0
aGUgdXNlcnNwYWNlIGRyaXZlciB0byBnbyB0aHJvdWdoCnNldmVyYWwgT0EgY29uZmlndXJhdGlv
biB3aXRob3V0IGhhdmluZyB0byBvcGVuL2Nsb3NlIHRoZSBpOTE1L3BlcmYKc3RyZWFtLgoKdjI6
IE5vIG5lZWQgZm9yIGxvY2tpbmcgb24gb2JqZWN0IE9BIGNvbmZpZyBvYmplY3QgY3JlYXRpb24g
KENocmlzKQogICAgRmx1c2ggY3B1IG1hcHBpbmcgb2YgT0EgY29uZmlnIChDaHJpcykKClNpZ25l
ZC1vZmYtYnk6IExpb25lbCBMYW5kd2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCB8ICAg
MSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICB8ICAyMiAr
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgIHwgMTcxICsr
KysrKysrKysrKysrKy0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTYyIGluc2VydGlvbnMoKyksIDMy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2NvbW1h
bmRzLmgKaW5kZXggZWVjMzFlMzZhY2E3Li5lN2VmZjlkYjM0M2UgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBAIC0xMjYsNiArMTI2LDcgQEAKICAq
LwogI2RlZmluZSBNSV9MT0FEX1JFR0lTVEVSX0lNTSh4KQlNSV9JTlNUUigweDIyLCAyKih4KS0x
KQogI2RlZmluZSAgIE1JX0xSSV9GT1JDRV9QT1NURUQJCSgxPDwxMikKKyNkZWZpbmUgTUlfTE9B
RF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MgKDEyNikKICNkZWZpbmUgTUlfU1RPUkVfUkVHSVNURVJf
TUVNICAgICAgICBNSV9JTlNUUigweDI0LCAxKQogI2RlZmluZSBNSV9TVE9SRV9SRUdJU1RFUl9N
RU1fR0VOOCAgIE1JX0lOU1RSKDB4MjQsIDIpCiAjZGVmaW5lICAgTUlfU1JNX0xSTV9HTE9CQUxf
R1RUCQkoMTw8MjIpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA3NmYyYmY5MGVkODYuLmYx
ZTUxMzA3MjUzYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xMjc2LDYgKzEyNzYsMTAg
QEAgc3RydWN0IGk5MTVfb2FfY29uZmlnIHsKIAlzdHJ1Y3QgYXR0cmlidXRlICphdHRyc1syXTsK
IAlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSBzeXNmc19tZXRyaWNfaWQ7CiAKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOworCisJc3RydWN0IGxpc3RfaGVhZCB2bWFfbGluazsKKwog
CWF0b21pY190IHJlZl9jb3VudDsKIH07CiAKQEAgLTE4NjUsMTEgKzE4NjksMjEgQEAgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgewogCQlzdHJ1Y3QgbXV0ZXggbWV0cmljc19sb2NrOwogCiAJCS8q
Ci0JCSAqIExpc3Qgb2YgZHluYW1pYyBjb25maWd1cmF0aW9ucywgeW91IG5lZWQgdG8gaG9sZAot
CQkgKiBkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgorCQkgKiBMaXN0
IG9mIGR5bmFtaWMgY29uZmlndXJhdGlvbnMgKHN0cnVjdCBpOTE1X29hX2NvbmZpZyksIHlvdQor
CQkgKiBuZWVkIHRvIGhvbGQgZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFjY2VzcyBp
dC4KIAkJICovCiAJCXN0cnVjdCBpZHIgbWV0cmljc19pZHI7CiAKKwkJLyoKKwkJICogTGlzdCBv
ZiBkeW5hbWljIGNvbmZpZ3VyYXRpb25zIChzdHJ1Y3QgaTkxNV9vYV9jb25maWcpCisJCSAqIHdo
aWNoIGhhdmUgYW4gYWxsb2NhdGVkIGJ1ZmZlciBpbiBHR1RUIGZvciByZWNvbmZpZ3VyYXRpb24s
CisJCSAqIHlvdSBuZWVkIHRvIGhvbGQgZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFj
Y2VzcyBpdC4KKwkJICogRWxlbWVudHMgYXJlIGFkZGVkIHRvIHRoZSBsaXN0IGxhemlsbHkgb24g
ZXhlY2J1ZiAod2hlbiBhCisJCSAqIHBhcnRpY3VsYXIgY29uZmlndXJhdGlvbiBpcyByZXF1ZXN0
ZWQpLiBUaGUgbGlzdCBpcyBmcmVlZAorCQkgKiB1cG9uIGNsb3NpbmcgdGhlIHBlcmYgc3RyZWFt
LgorCQkgKi8KKwkJc3RydWN0IGxpc3RfaGVhZCBtZXRyaWNzX2J1ZmZlcnM7CisKIAkJLyoKIAkJ
ICogTG9jayBhc3NvY2lhdGVkIHdpdGggYW55dGhpbmcgYmVsb3cgd2l0aGluIHRoaXMgc3RydWN0
dXJlCiAJCSAqIGV4Y2VwdCBleGNsdXNpdmVfc3RyZWFtLgpAQCAtMjgxNSw2ICsyODI5LDEwIEBA
IGludCBpOTE1X3BlcmZfcmVtb3ZlX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogdm9pZCBpOTE1X29hX2luaXRfcmVnX3N0YXRlKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkg
ICAgdTMyICpyZWdfc3RhdGUpOworaW50IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJICAgIGludCBtZXRyaWNzX3NldCwKKwkJCSAgICBz
dHJ1Y3QgaTkxNV9vYV9jb25maWcgKipvdXRfY29uZmlnLAorCQkJICAgIHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICoqb3V0X29iaik7CiAKIC8qIGk5MTVfZ2VtX2V2aWN0LmMgKi8KIGludCBf
X211c3RfY2hlY2sgaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCAyZTMzYTliNGVhZTcuLmUw
MDcxZTQ0ZGUzZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTM2Niw5ICszNjYsMTYg
QEAgc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIHsKIAlpbnQgb2FfcGVyaW9kX2V4cG9uZW50
OwogfTsKIAotc3RhdGljIHZvaWQgZnJlZV9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAotCQkJICAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitz
dGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmln
KQogeworCWlmICghYXRvbWljX2RlY19hbmRfdGVzdCgmb2FfY29uZmlnLT5yZWZfY291bnQpKQor
CQlyZXR1cm47CisKKwlpZiAob2FfY29uZmlnLT5vYmopIHsKKwkJbGlzdF9kZWwoJm9hX2NvbmZp
Zy0+dm1hX2xpbmspOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9hX2NvbmZpZy0+b2JqKTsKKwl9
CisKIAlpZiAoIVBUUl9FUlIob2FfY29uZmlnLT5mbGV4X3JlZ3MpKQogCQlrZnJlZShvYV9jb25m
aWctPmZsZXhfcmVncyk7CiAJaWYgKCFQVFJfRVJSKG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3Mp
KQpAQCAtMzc4LDM4ICszODUsMTI2IEBAIHN0YXRpYyB2b2lkIGZyZWVfb2FfY29uZmlnKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlrZnJlZShvYV9jb25maWcpOwogfQogCi1z
dGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKLQkJCSAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitzdGF0aWMgdTMyICp3
cml0ZV9jc19taV9scmkodTMyICpjcywgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdfZGF0
YSwgdTMyIG5fcmVncykKIHsKLQlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJm9hX2NvbmZpZy0+
cmVmX2NvdW50KSkKLQkJcmV0dXJuOworCXUzMiBpOwogCi0JZnJlZV9vYV9jb25maWcoZGV2X3By
aXYsIG9hX2NvbmZpZyk7CisJZm9yIChpID0gMDsgaSA8IG5fcmVnczsgaSsrKSB7CisJCWlmICgo
aSAlIE1JX0xPQURfUkVHSVNURVJfSU1NX01BWF9SRUdTKSA9PSAwKSB7CisJCQl1MzIgbl9scmkg
PSBtaW4obl9yZWdzIC0gaSwKKwkJCQkJKHUzMikgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JF
R1MpOworCisJCQkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKG5fbHJpKTsKKwkJfQorCQkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZ19kYXRhW2ldLmFkZHIpOworCQkqY3MrKyA9
IHJlZ19kYXRhW2ldLnZhbHVlOworCX0KKworCXJldHVybiBjczsKIH0KIAotc3RhdGljIGludCBn
ZXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSBpbnQg
bWV0cmljc19zZXQsCi0JCQkgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZykKK3N0
YXRpYyBpbnQgYWxsb2Nfb2FfY29uZmlnX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKKwkJCQkgIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnKQogewotCWludCBy
ZXQ7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmJvOworCXNpemVfdCBjb25maWdfbGVu
Z3RoID0gMDsKKwl1MzIgKmNzOwogCi0JaWYgKG1ldHJpY3Nfc2V0ID09IDEpIHsKLQkJKm91dF9j
b25maWcgPSAmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWc7Ci0JCWF0b21pY19pbmMoJmRl
dl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnJlZl9jb3VudCk7Ci0JCXJldHVybiAwOworCWlm
IChvYV9jb25maWctPm11eF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xlbmd0aCArPSBESVZf
Uk9VTkRfVVAob2FfY29uZmlnLT5tdXhfcmVnc19sZW4sCisJCQkJCSAgICAgIE1JX0xPQURfUkVH
SVNURVJfSU1NX01BWF9SRUdTKSAqIDQ7CisJCWNvbmZpZ19sZW5ndGggKz0gb2FfY29uZmlnLT5t
dXhfcmVnc19sZW4gKiA4OworCX0KKwlpZiAob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4g
PiAwKSB7CisJCWNvbmZpZ19sZW5ndGggKz0gRElWX1JPVU5EX1VQKG9hX2NvbmZpZy0+Yl9jb3Vu
dGVyX3JlZ3NfbGVuLAorCQkJCQkgICAgICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUykg
KiA0OworCQljb25maWdfbGVuZ3RoICs9IG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuICog
ODsKKwl9CisJaWYgKG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xl
bmd0aCArPSBESVZfUk9VTkRfVVAob2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuLAorCQkJCQkgICAg
ICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUykgKiA0OworCQljb25maWdfbGVuZ3RoICs9
IG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiAqIDg7CiAJfQorCWNvbmZpZ19sZW5ndGggKz0gNDsg
LyogTUlfQkFUQ0hfQlVGRkVSX0VORCAqLworCWNvbmZpZ19sZW5ndGggPSBBTElHTihjb25maWdf
bGVuZ3RoLCBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOworCWJvID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBjb25maWdfbGVuZ3RoKTsKKwlpZiAoSVNfRVJSKGJvKSkK
KwkJcmV0dXJuIFBUUl9FUlIoYm8pOworCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChi
bywgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9w
dXQoYm8pOworCQlyZXR1cm4gUFRSX0VSUihjcyk7CisJfQorCisJY3MgPSB3cml0ZV9jc19taV9s
cmkoY3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKKwlj
cyA9IHdyaXRlX2NzX21pX2xyaShjcywgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywgb2FfY29u
ZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOworCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLCBvYV9j
b25maWctPmZsZXhfcmVncywgb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuKTsKKworCSpjcysrID0g
TUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoYm8pOwor
CWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoYm8pOworCisJb2FfY29uZmlnLT5vYmogPSBibzsK
KworCXJldHVybiAwOworfQorCitpbnQgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgaW50IG1ldHJpY3Nfc2V0LAorCQkJICAgIHN0
cnVjdCBpOTE1X29hX2NvbmZpZyAqKm91dF9jb25maWcsCisJCQkgICAgc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKipvdXRfb2JqKQoreworCWludCByZXQgPSAwOworCXN0cnVjdCBpOTE1X29h
X2NvbmZpZyAqb2FfY29uZmlnOworCisJaWYgKCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKQorCQly
ZXR1cm4gLUVOT0RFVjsKKworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+
cGVyZi5tZXRyaWNzX2xvY2spOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQkqb3V0X2Nv
bmZpZyA9IGlkcl9maW5kKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgbWV0cmljc19zZXQp
OwotCWlmICghKm91dF9jb25maWcpCi0JCXJldCA9IC1FSU5WQUw7Ci0JZWxzZQotCQlhdG9taWNf
aW5jKCYoKm91dF9jb25maWcpLT5yZWZfY291bnQpOworCWlmIChtZXRyaWNzX3NldCA9PSAxKSB7
CisJCW9hX2NvbmZpZyA9ICZpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnOworCX0gZWxzZSB7CisJ
CW9hX2NvbmZpZyA9IGlkcl9maW5kKCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCBtZXRyaWNzX3Nl
dCk7CisJCWlmICghb2FfY29uZmlnKSB7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290byB1bmxv
Y2s7CisJCX0KKwl9CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9j
ayk7CisJaWYgKG91dF9jb25maWcpIHsKKwkJYXRvbWljX2luYygmb2FfY29uZmlnLT5yZWZfY291
bnQpOworCQkqb3V0X2NvbmZpZyA9IG9hX2NvbmZpZzsKKwl9CisKKwlpZiAob3V0X29iaikgewor
CQlpZiAob2FfY29uZmlnLT5vYmopIHsKKwkJCSpvdXRfb2JqID0gaTkxNV9nZW1fb2JqZWN0X2dl
dChvYV9jb25maWctPm9iaik7CisJCX0gZWxzZSB7CisJCQlyZXQgPSBhbGxvY19vYV9jb25maWdf
YnVmZmVyKGk5MTUsIG9hX2NvbmZpZyk7CisJCQlpZiAocmV0KQorCQkJCWdvdG8gZXJyX2J1Zl9h
bGxvYzsKKworCQkJbGlzdF9hZGQoJm9hX2NvbmZpZy0+dm1hX2xpbmssCisJCQkJICZpOTE1LT5w
ZXJmLm1ldHJpY3NfYnVmZmVycyk7CisJCQkqb3V0X29iaiA9IGk5MTVfZ2VtX29iamVjdF9nZXQo
b2FfY29uZmlnLT5vYmopOworCQl9CisJfQorCisJZ290byB1bmxvY2s7CisKK2Vycl9idWZfYWxs
b2M6CisJaWYgKG91dF9jb25maWcpIHsKKwkJcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOworCQkq
b3V0X2NvbmZpZyA9IE5VTEw7CisJfQordW5sb2NrOgorCW11dGV4X3VubG9jaygmaTkxNS0+cGVy
Zi5tZXRyaWNzX2xvY2spOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTEzODAsNyArMTQ3NSw3IEBA
IHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3RyZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJl
YW0gKnN0cmVhbSkKIAlpZiAoc3RyZWFtLT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0
cmVhbSk7CiAKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJ
cHV0X29hX2NvbmZpZyhzdHJlYW0tPm9hX2NvbmZpZyk7CiAKIAlpZiAoZGV2X3ByaXYtPnBlcmYu
b2Euc3B1cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgewogCQlEUk1fTk9URSgiJWQgc3B1cmlvdXMg
T0EgcmVwb3J0IG5vdGljZXMgc3VwcHJlc3NlZCBkdWUgdG8gcmF0ZWxpbWl0aW5nXG4iLApAQCAt
MjA5NCw3ICsyMTg5LDggQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCX0KIAl9CiAKLQlyZXQgPSBnZXRfb2FfY29uZmln
KGRldl9wcml2LCBwcm9wcy0+bWV0cmljc19zZXQsICZzdHJlYW0tPm9hX2NvbmZpZyk7CisJcmV0
ID0gaTkxNV9wZXJmX2dldF9vYV9jb25maWcoZGV2X3ByaXYsIHByb3BzLT5tZXRyaWNzX3NldCwK
KwkJCQkgICAgICAmc3RyZWFtLT5vYV9jb25maWcsIE5VTEwpOwogCWlmIChyZXQpIHsKIAkJRFJN
X0RFQlVHKCJJbnZhbGlkIE9BIGNvbmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nfc2V0KTsK
IAkJZ290byBlcnJfY29uZmlnOwpAQCAtMjEzMiw2ICsyMjI4LDggQEAgc3RhdGljIGludCBpOTE1
X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCWdvdG8g
ZXJyX2VuYWJsZTsKIAl9CiAKKwlEUk1fREVCVUcoIm9wZW5pbmcgc3RyZWFtIG9hIGNvbmZpZyB1
dWlkPSVzXG4iLCBzdHJlYW0tPm9hX2NvbmZpZy0+dXVpZCk7CisKIAltdXRleF91bmxvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiAwOwpAQCAtMjE0NSw3ICsyMjQz
LDcgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0sCiAJZnJlZV9vYV9idWZmZXIoZGV2X3ByaXYpOwogCiBlcnJfb2FfYnVmX2Fs
bG9jOgotCXB1dF9vYV9jb25maWcoZGV2X3ByaXYsIHN0cmVhbS0+b2FfY29uZmlnKTsKKwlwdXRf
b2FfY29uZmlnKHN0cmVhbS0+b2FfY29uZmlnKTsKIAogCWludGVsX3VuY29yZV9mb3JjZXdha2Vf
cHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAlpbnRlbF9ydW50aW1lX3Bt
X3B1dChkZXZfcHJpdiwgc3RyZWFtLT53YWtlcmVmKTsKQEAgLTI1MTIsOSArMjYxMCwyMSBAQCBz
dGF0aWMgaW50IGk5MTVfcGVyZl9yZWxlYXNlKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBm
aWxlICpmaWxlKQogewogCXN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0gPSBmaWxlLT5w
cml2YXRlX2RhdGE7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gc3RyZWFt
LT5kZXZfcHJpdjsKKwlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZywgKm5leHQ7CiAK
IAltdXRleF9sb2NrKCZkZXZfcHJpdi0+cGVyZi5sb2NrKTsKKwogCWk5MTVfcGVyZl9kZXN0cm95
X2xvY2tlZChzdHJlYW0pOworCisJLyogRGlzcG9zZSBvZiBhbGwgb2EgY29uZmlnIGJhdGNoIGJ1
ZmZlcnMuICovCisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKKwls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUob2FfY29uZmlnLCBuZXh0LCAmZGV2X3ByaXYtPnBlcmYu
bWV0cmljc19idWZmZXJzLCB2bWFfbGluaykgeworCQlsaXN0X2RlbCgmb2FfY29uZmlnLT52bWFf
bGluayk7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2FfY29uZmlnLT5vYmopOworCQlvYV9jb25m
aWctPm9iaiA9IE5VTEw7CisJfQorCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmlj
c19sb2NrKTsKKwogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubG9jayk7CiAKIAlyZXR1
cm4gMDsKQEAgLTMyOTYsNyArMzQwNiw3IEBAIGludCBpOTE1X3BlcmZfYWRkX2NvbmZpZ19pb2N0
bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogc3lzZnNfZXJyOgogCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKIHJlZ19lcnI6Ci0JcHV0X29h
X2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmlnKTsKKwlwdXRfb2FfY29uZmlnKG9hX2NvbmZpZyk7
CiAJRFJNX0RFQlVHKCJGYWlsZWQgdG8gYWRkIG5ldyBPQSBjb25maWdcbiIpOwogCXJldHVybiBl
cnI7CiB9CkBAIC0zMzUwLDcgKzM0NjAsNyBAQCBpbnQgaTkxNV9wZXJmX3JlbW92ZV9jb25maWdf
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAogCURSTV9ERUJVRygi
UmVtb3ZlZCBjb25maWcgJXMgaWQ9JWlcbiIsIG9hX2NvbmZpZy0+dXVpZCwgb2FfY29uZmlnLT5p
ZCk7CiAKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBvYV9jb25maWcpOworCXB1dF9vYV9jb25m
aWcob2FfY29uZmlnKTsKIAogY29uZmlnX2VycjoKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5w
ZXJmLm1ldHJpY3NfbG9jayk7CkBAIC0zNDkyLDYgKzM2MDIsOCBAQCB2b2lkIGk5MTVfcGVyZl9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJaW5pdF93YWl0cXVldWVf
aGVhZCgmZGV2X3ByaXYtPnBlcmYub2EucG9sbF93cSk7CiAKIAkJSU5JVF9MSVNUX0hFQUQoJmRl
dl9wcml2LT5wZXJmLnN0cmVhbXMpOworCQlJTklUX0xJU1RfSEVBRCgmZGV2X3ByaXYtPnBlcmYu
bWV0cmljc19idWZmZXJzKTsKKwogCQltdXRleF9pbml0KCZkZXZfcHJpdi0+cGVyZi5sb2NrKTsK
IAkJc3Bpbl9sb2NrX2luaXQoJmRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jayk7
CiAKQEAgLTM1MDgsMTAgKzM2MjAsOSBAQCB2b2lkIGk5MTVfcGVyZl9pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogc3RhdGljIGludCBkZXN0cm95X2NvbmZpZyhpbnQg
aWQsIHZvaWQgKnAsIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZGF0YTsKIAlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZyA9IHA7CiAK
LQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBvYV9jb25maWcpOworCXB1dF9vYV9jb25maWcob2Ff
Y29uZmlnKTsKIAogCXJldHVybiAwOwogfQpAQCAtMzUyNSw3ICszNjM2LDcgQEAgdm9pZCBpOTE1
X3BlcmZfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKCFkZXZf
cHJpdi0+cGVyZi5pbml0aWFsaXplZCkKIAkJcmV0dXJuOwogCi0JaWRyX2Zvcl9lYWNoKCZkZXZf
cHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgZGVzdHJveV9jb25maWcsIGRldl9wcml2KTsKKwlpZHJf
Zm9yX2VhY2goJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyLCBkZXN0cm95X2NvbmZpZywgTlVM
TCk7CiAJaWRyX2Rlc3Ryb3koJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyKTsKIAogCXVucmVn
aXN0ZXJfc3lzY3RsX3RhYmxlKGRldl9wcml2LT5wZXJmLnN5c2N0bF9oZWFkZXIpOwotLSAKMi4y
MS4wLjM5Mi5nZjhmNjc4NzE1OWUKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeA==

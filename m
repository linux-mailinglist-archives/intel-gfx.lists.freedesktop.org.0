Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5A45D2D9C2
	for <lists+intel-gfx@lfdr.de>; Wed, 29 May 2019 11:58:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3DE366E0CB;
	Wed, 29 May 2019 09:58:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B13EB6E0CA;
 Wed, 29 May 2019 09:58:18 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16717563-1500050 
 for multiple; Wed, 29 May 2019 10:58:12 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 29 May 2019 10:58:05 +0100
Message-Id: <20190529095805.31851-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] i915/gem_workarounds: Verify regs directly
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgc2VlbXMgbGlrZSB0aGUgSFcgdmFsaWRhdG9yIGlzIGdldHRpbmcgYmV0dGVyIGF0IHByZXZl
bnRpbmcgb3VyCnNub29waW5nIG9mIHN5c3RlbSByZWdpc3RlcnMgZnJvbSBub24tcHJpdmlsZWdl
ZCBiYXRjaGVzISBJZiB3ZSBjYW4ndAp1c2UgU1JNLCBsZXQncyBwcm9iZSB0aGUgcmVnaXN0ZXIg
ZGlyZWN0bHkgdGhyb3VnaCBtbWlvLCBtYWtpbmcgc3VyZSB3ZQpoYXZlIHRoZSBjb250ZXh0IHNw
aW5uaW5nIG9uIHRoZSBHUFUgZmlyc3QuCgp2MjogSG9sZCBmb3JjZXdha2UganVzdCBpbiBjYXNl
IHRoZSBzcGlubmluZyBiYXRjaCBpc24ndCBlbm91Z2ggdG8KanVzdGlmeSBvdXIgcmVnaXN0ZXIg
YWNjZXNzLgoKQnVnemlsbGE6IGh0dHBzOi8vYnVncy5mcmVlZGVza3RvcC5vcmcvc2hvd19idWcu
Y2dpP2lkPTExMDU0NApTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KQ2M6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy53aWxsaWFtLmF1bGRAZ21haWwu
Y29tPgotLS0KIHRlc3RzL2k5MTUvZ2VtX3dvcmthcm91bmRzLmMgfCA4OCArKysrKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNyBpbnNlcnRpb25zKCsp
LCA3MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dlbV93b3JrYXJvdW5k
cy5jIGIvdGVzdHMvaTkxNS9nZW1fd29ya2Fyb3VuZHMuYwppbmRleCA0NGUzZGNlOGEuLjI3Njdi
MDRkNyAxMDA2NDQKLS0tIGEvdGVzdHMvaTkxNS9nZW1fd29ya2Fyb3VuZHMuYworKysgYi90ZXN0
cy9pOTE1L2dlbV93b3JrYXJvdW5kcy5jCkBAIC04MCw3MCArODAsMjcgQEAgc3RhdGljIGJvb2wg
d3JpdGVfb25seShjb25zdCB1aW50MzJfdCBhZGRyKQogCXJldHVybiBmYWxzZTsKIH0KIAotI2Rl
ZmluZSBNSV9TVE9SRV9SRUdJU1RFUl9NRU0gKDB4MjQgPDwgMjMpCi0KLXN0YXRpYyBpbnQgd29y
a2Fyb3VuZF9mYWlsX2NvdW50KGludCBmZCwgdWludDMyX3QgY3R4KQorc3RhdGljIGludCB3b3Jr
YXJvdW5kX2ZhaWxfY291bnQoaW50IGk5MTUsIHVpbnQzMl90IGN0eCkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiBvYmpbMl07Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9yZWxv
Y2F0aW9uX2VudHJ5ICpyZWxvYzsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4
ZWNidWY7Ci0JdWludDMyX3QgcmVzdWx0X3N6LCBiYXRjaF9zejsKLQl1aW50MzJfdCAqYmFzZSwg
Km91dDsKLQlpbnQgZmFpbF9jb3VudCA9IDA7Ci0KLQlyZWxvYyA9IGNhbGxvYyhudW1fd2FfcmVn
cywgc2l6ZW9mKCpyZWxvYykpOwotCWlndF9hc3NlcnQocmVsb2MpOwotCi0JcmVzdWx0X3N6ID0g
NCAqIG51bV93YV9yZWdzOwotCXJlc3VsdF9zeiA9IFBBR0VfQUxJR04ocmVzdWx0X3N6KTsKLQot
CWJhdGNoX3N6ID0gMTYgKiBudW1fd2FfcmVncyArIDQ7Ci0JYmF0Y2hfc3ogPSBQQUdFX0FMSUdO
KGJhdGNoX3N6KTsKLQotCW1lbXNldChvYmosIDAsIHNpemVvZihvYmopKTsKLQlvYmpbMF0uaGFu
ZGxlID0gZ2VtX2NyZWF0ZShmZCwgcmVzdWx0X3N6KTsKLQlnZW1fc2V0X2NhY2hpbmcoZmQsIG9i
alswXS5oYW5kbGUsIEk5MTVfQ0FDSElOR19DQUNIRUQpOwotCW9ialsxXS5oYW5kbGUgPSBnZW1f
Y3JlYXRlKGZkLCBiYXRjaF9zeik7Ci0Jb2JqWzFdLnJlbG9jc19wdHIgPSB0b191c2VyX3BvaW50
ZXIocmVsb2MpOwotCW9ialsxXS5yZWxvY2F0aW9uX2NvdW50ID0gbnVtX3dhX3JlZ3M7Ci0KLQlv
dXQgPSBiYXNlID0gZ2VtX21tYXBfX2NwdShmZCwgb2JqWzFdLmhhbmRsZSwgMCwgYmF0Y2hfc3os
IFBST1RfV1JJVEUpOwotCWZvciAoaW50IGkgPSAwOyBpIDwgbnVtX3dhX3JlZ3M7IGkrKykgewot
CQkqb3V0KysgPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU0gfCAoKGdlbiA+PSA4ID8gNCA6IDIpIC0g
Mik7Ci0JCSpvdXQrKyA9IHdhX3JlZ3NbaV0uYWRkcjsKLQkJcmVsb2NbaV0udGFyZ2V0X2hhbmRs
ZSA9IG9ialswXS5oYW5kbGU7Ci0JCXJlbG9jW2ldLm9mZnNldCA9IChvdXQgLSBiYXNlKSAqIHNp
emVvZigqb3V0KTsKLQkJcmVsb2NbaV0uZGVsdGEgPSBpICogc2l6ZW9mKHVpbnQzMl90KTsKLQkJ
cmVsb2NbaV0ucmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9NQUlOX0lOU1RSVUNUSU9OOwotCQly
ZWxvY1tpXS53cml0ZV9kb21haW4gPSBJOTE1X0dFTV9ET01BSU5fSU5TVFJVQ1RJT047Ci0JCSpv
dXQrKyA9IHJlbG9jW2ldLmRlbHRhOwotCQlpZiAoZ2VuID49IDgpCi0JCQkqb3V0KysgPSAwOwot
CX0KLQkqb3V0KysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOwotCW11bm1hcChiYXNlLCBiYXRjaF9z
eik7CisJaWd0X3NwaW5fdCAqc3BpbjsKKwlpbnQgZncsIGZhaWwgPSAwOwogCi0JbWVtc2V0KCZl
eGVjYnVmLCAwLCBzaXplb2YoZXhlY2J1ZikpOwotCWV4ZWNidWYuYnVmZmVyc19wdHIgPSB0b191
c2VyX3BvaW50ZXIob2JqKTsKLQlleGVjYnVmLmJ1ZmZlcl9jb3VudCA9IDI7Ci0JZXhlY2J1Zi5y
c3ZkMSA9IGN0eDsKLQlnZW1fZXhlY2J1ZihmZCwgJmV4ZWNidWYpOworCXNwaW4gPSBpZ3Rfc3Bp
bl9uZXcoaTkxNSwgLmN0eCA9IGN0eCwgLmZsYWdzID0gSUdUX1NQSU5fUE9MTF9SVU4pOworCWln
dF9zcGluX2J1c3l3YWl0X3VudGlsX3N0YXJ0ZWQoc3Bpbik7CiAKLQlnZW1fc2V0X2RvbWFpbihm
ZCwgb2JqWzBdLmhhbmRsZSwgSTkxNV9HRU1fRE9NQUlOX0NQVSwgMCk7Ci0KLQlpZ3RfZGVidWco
IkFkZHJlc3NcdHZhbFx0XHRtYXNrXHRcdHJlYWRcdFx0cmVzdWx0XG4iKTsKLQotCW91dCA9IGdl
bV9tbWFwX19jcHUoZmQsIG9ialswXS5oYW5kbGUsIDAsIHJlc3VsdF9zeiwgUFJPVF9SRUFEKTsK
KwlmdyA9IGlndF9vcGVuX2ZvcmNld2FrZV9oYW5kbGUoaTkxNSk7CiAJZm9yIChpbnQgaSA9IDA7
IGkgPCBudW1fd2FfcmVnczsgaSsrKSB7CisJCXVpbnQzMl90IHZhbHVlID0KKwkJCSoodWludDMy
X3QgKikoaWd0X2dsb2JhbF9tbWlvICsgd2FfcmVnc1tpXS5hZGRyKTsKIAkJY29uc3QgYm9vbCBv
ayA9CiAJCQkod2FfcmVnc1tpXS52YWx1ZSAmIHdhX3JlZ3NbaV0ubWFzaykgPT0KLQkJCShvdXRb
aV0gJiB3YV9yZWdzW2ldLm1hc2spOworCQkJKHZhbHVlICYgd2FfcmVnc1tpXS5tYXNrKTsKIAkJ
Y2hhciBidWZbODBdOwogCiAJCXNucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksCiAJCQkgIjB4JTA1
WFx0MHglMDhYXHQweCUwOFhcdDB4JTA4WCIsCiAJCQkgd2FfcmVnc1tpXS5hZGRyLCB3YV9yZWdz
W2ldLnZhbHVlLCB3YV9yZWdzW2ldLm1hc2ssCi0JCQkgb3V0W2ldKTsKKwkJCSB2YWx1ZSk7CiAK
IAkJaWYgKG9rKSB7CiAJCQlpZ3RfZGVidWcoIiVzXHRPS1xuIiwgYnVmKTsKQEAgLTE1MSwyNyAr
MTA4LDE0IEBAIHN0YXRpYyBpbnQgd29ya2Fyb3VuZF9mYWlsX2NvdW50KGludCBmZCwgdWludDMy
X3QgY3R4KQogCQkJaWd0X2RlYnVnKCIlc1x0SUdOT1JFRCAody9vKVxuIiwgYnVmKTsKIAkJfSBl
bHNlIHsKIAkJCWlndF93YXJuKCIlc1x0RkFJTFxuIiwgYnVmKTsKLQkJCWZhaWxfY291bnQrKzsK
KwkJCWZhaWwrKzsKIAkJfQogCX0KLQltdW5tYXAob3V0LCByZXN1bHRfc3opOworCWNsb3NlKGZ3
KTsKIAotCWdlbV9jbG9zZShmZCwgb2JqWzFdLmhhbmRsZSk7Ci0JZ2VtX2Nsb3NlKGZkLCBvYmpb
MF0uaGFuZGxlKTsKLQlmcmVlKHJlbG9jKTsKKwlpZ3Rfc3Bpbl9mcmVlKGk5MTUsIHNwaW4pOwog
Ci0JcmV0dXJuIGZhaWxfY291bnQ7Ci19Ci0KLXN0YXRpYyBpbnQgcmVvcGVuKGludCBmZCkKLXsK
LQljaGFyIHBhdGhbMjU2XTsKLQotCXNucHJpbnRmKHBhdGgsIHNpemVvZihwYXRoKSwgIi9wcm9j
L3NlbGYvZmQvJWQiLCBmZCk7Ci0JZmQgPSBvcGVuKHBhdGgsIE9fUkRXUik7Ci0JaWd0X2Fzc2Vy
dF9sdGUoMCwgZmQpOwotCi0JcmV0dXJuIGZkOworCXJldHVybiBmYWlsOwogfQogCiAjZGVmaW5l
IENPTlRFWFQgMHgxCkBAIC0xODEsNyArMTI1LDcgQEAgc3RhdGljIHZvaWQgY2hlY2tfd29ya2Fy
b3VuZHMoaW50IGZkLCBlbnVtIG9wZXJhdGlvbiBvcCwgdW5zaWduZWQgaW50IGZsYWdzKQogCXVp
bnQzMl90IGN0eCA9IDA7CiAKIAlpZiAoZmxhZ3MgJiBGRCkKLQkJZmQgPSByZW9wZW4oZmQpOwor
CQlmZCA9IGdlbV9yZW9wZW5fZHJpdmVyKGZkKTsKIAogCWlmIChmbGFncyAmIENPTlRFWFQpIHsK
IAkJZ2VtX3JlcXVpcmVfY29udGV4dHMoZmQpOwpAQCAtMjUyLDYgKzE5Niw4IEBAIGlndF9tYWlu
CiAJCWRldmljZSA9IGRybV9vcGVuX2RyaXZlcihEUklWRVJfSU5URUwpOwogCQlpZ3RfcmVxdWly
ZV9nZW0oZGV2aWNlKTsKIAorCQlpbnRlbF9tbWlvX3VzZV9wY2lfYmFyKGludGVsX2dldF9wY2lf
ZGV2aWNlKCkpOworCiAJCWdlbiA9IGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGRldmlj
ZSkpOwogCiAJCWZkID0gaWd0X2RlYnVnZnNfb3BlbihkZXZpY2UsICJpOTE1X3dhX3JlZ2lzdGVy
cyIsIE9fUkRPTkxZKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

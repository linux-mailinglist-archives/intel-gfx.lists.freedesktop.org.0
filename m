Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D6F612C5296
	for <lists+intel-gfx@lfdr.de>; Thu, 26 Nov 2020 12:08:59 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6502A6E8BC;
	Thu, 26 Nov 2020 11:08:57 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (unknown [77.68.26.236])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CBB286E8B9;
 Thu, 26 Nov 2020 11:08:55 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 23115280-1500050 
 for multiple; Thu, 26 Nov 2020 11:08:44 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 26 Nov 2020 11:08:42 +0000
Message-Id: <20201126110842.680720-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.29.2
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t v2] i915/gem_exec_schedule: Try to spot
 unfairness
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org, Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QW4gaW1wb3J0YW50IHByb3BlcnR5IGZvciBtdWx0aS1jbGllbnQgc3lzdGVtcyBpcyB0aGF0IGVh
Y2ggY2xpZW50IGdldHMKYSAnZmFpcicgYWxsb3RtZW50IG9mIHN5c3RlbSB0aW1lLiAoV2hlcmUg
ZmFpcm5lc3MgaXMgYXQgdGhlIHdoaW0gb2YgdGhlCmNvbnRleHQgcHJvcGVydGllcywgc3VjaCBh
cyBwcmlvcml0aWVzLikgVGhpcyB0ZXN0IGZvcmtzIE4gaW5kZXBlbmRlbnQKY2xpZW50cyAoYWxi
ZWl0IHRoZXkgaGFwcGVuIHRvIHNoYXJlIGEgc2luZ2xlIHZtKSwgYW5kIGRvZXMgYW4gZXF1YWwK
YW1vdW50IG9mIHdvcmsgaW4gY2xpZW50IGFuZCBhc3NlcnRzIHRoYXQgdGhleSB0YWtlIGFuIGVx
dWFsIGFtb3VudCBvZgp0aW1lLgoKVGhvdWdoIHdlIGhhdmUgbmV2ZXIgY2xhaW1lZCB0byBoYXZl
IGEgY29tcGxldGVseSBmYWlyIHNjaGVkdWxlciwgdGhhdAppcyB3aGF0IGlzIGV4cGVjdGVkLgoK
djI6IGlndF9hc3NlcnRfZiBhbmQgbW9yZSBjb21tZW50YXJ5OyBleGNsdWRlIHZpcCBmcm9tIGNs
aWVudCBzdGF0cywKaW5jbHVkZSByYW5nZSBvZiBmcmFtZSBpbnRlcnZhbHMgZnJvbSBlYWNoIGlu
ZGl2aWR1YWwgY2xpZW50CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5j
b20+CkNjOiBSYW1hbGluZ2FtIEMgPHJhbWFsaW5nYW0uY0BpbnRlbC5jb20+Ci0tLQogdGVzdHMv
aTkxNS9nZW1fZXhlY19zY2hlZHVsZS5jIHwgOTExICsrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKwogMSBmaWxlIGNoYW5nZWQsIDkxMSBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEv
dGVzdHMvaTkxNS9nZW1fZXhlY19zY2hlZHVsZS5jIGIvdGVzdHMvaTkxNS9nZW1fZXhlY19zY2hl
ZHVsZS5jCmluZGV4IGYyM2Q2M2FjMy4uZTY5NzcxMjk5IDEwMDY0NAotLS0gYS90ZXN0cy9pOTE1
L2dlbV9leGVjX3NjaGVkdWxlLmMKKysrIGIvdGVzdHMvaTkxNS9nZW1fZXhlY19zY2hlZHVsZS5j
CkBAIC0yOSw2ICsyOSw3IEBACiAjaW5jbHVkZSA8c3lzL3BvbGwuaD4KICNpbmNsdWRlIDxzeXMv
aW9jdGwuaD4KICNpbmNsdWRlIDxzeXMvbW1hbi5oPgorI2luY2x1ZGUgPHN5cy9yZXNvdXJjZS5o
PgogI2luY2x1ZGUgPHN5cy9zeXNjYWxsLmg+CiAjaW5jbHVkZSA8c2NoZWQuaD4KICNpbmNsdWRl
IDxzaWduYWwuaD4KQEAgLTI1MTYsNiArMjUxNyw4ODMgQEAgc3RhdGljIHZvaWQgbWVhc3VyZV9z
ZW1hcGhvcmVfcG93ZXIoaW50IGk5MTUpCiAJcmFwbF9jbG9zZSgmcGtnKTsKIH0KIAorc3RhdGlj
IGludCByZWFkX3RpbWVzdGFtcF9mcmVxdWVuY3koaW50IGk5MTUpCit7CisJaW50IHZhbHVlID0g
MDsKKwlkcm1faTkxNV9nZXRwYXJhbV90IGdwID0geworCQkudmFsdWUgPSAmdmFsdWUsCisJCS5w
YXJhbSA9IEk5MTVfUEFSQU1fQ1NfVElNRVNUQU1QX0ZSRVFVRU5DWSwKKwl9OworCWlvY3RsKGk5
MTUsIERSTV9JT0NUTF9JOTE1X0dFVFBBUkFNLCAmZ3ApOworCXJldHVybiB2YWx1ZTsKK30KKwor
c3RhdGljIHVpbnQ2NF90IGRpdjY0X3U2NF9yb3VuZF91cCh1aW50NjRfdCB4LCB1aW50NjRfdCB5
KQoreworCXJldHVybiAoeCArIHkgLSAxKSAvIHk7Cit9CisKK3N0YXRpYyB1aW50NjRfdCBuc190
b19jdHhfdGlja3MoaW50IGk5MTUsIHVpbnQ2NF90IG5zKQoreworCWludCBmID0gcmVhZF90aW1l
c3RhbXBfZnJlcXVlbmN5KGk5MTUpOworCWlmIChpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZp
ZChpOTE1KSkgPT0gMTEpCisJCWYgPSAxMjUwMDAwMDsgLyogaWNsISEhIGFyZSB5b3UgZmVlbGlu
ZyBhbHJpZ2h0PyBDVFggdnMgQ1MgKi8KKwlyZXR1cm4gZGl2NjRfdTY0X3JvdW5kX3VwKG5zICog
ZiwgTlNFQ19QRVJfU0VDKTsKK30KKworc3RhdGljIHVpbnQ2NF90IHRpY2tzX3RvX25zKGludCBp
OTE1LCB1aW50NjRfdCB0aWNrcykKK3sKKwlyZXR1cm4gZGl2NjRfdTY0X3JvdW5kX3VwKHRpY2tz
ICogTlNFQ19QRVJfU0VDLAorCQkJCSAgcmVhZF90aW1lc3RhbXBfZnJlcXVlbmN5KGk5MTUpKTsK
K30KKworI2RlZmluZSBNSV9JTlNUUihvcGNvZGUsIGZsYWdzKSAoKChvcGNvZGUpIDw8IDIzKSB8
IChmbGFncykpCisKKyNkZWZpbmUgTUlfTUFUSCh4KSAgICAgICAgICAgICAgICAgICAgICBNSV9J
TlNUUigweDFhLCAoeCkgLSAxKQorI2RlZmluZSBNSV9NQVRIX0lOU1RSKG9wY29kZSwgb3AxLCBv
cDIpICgob3Bjb2RlKSA8PCAyMCB8IChvcDEpIDw8IDEwIHwgKG9wMikpCisvKiBPcGNvZGVzIGZv
ciBNSV9NQVRIX0lOU1RSICovCisjZGVmaW5lICAgTUlfTUFUSF9OT09QICAgICAgICAgICAgICAg
ICAgTUlfTUFUSF9JTlNUUigweDAwMCwgMHgwLCAweDApCisjZGVmaW5lICAgTUlfTUFUSF9MT0FE
KG9wMSwgb3AyKSAgICAgICAgTUlfTUFUSF9JTlNUUigweDA4MCwgb3AxLCBvcDIpCisjZGVmaW5l
ICAgTUlfTUFUSF9MT0FESU5WKG9wMSwgb3AyKSAgICAgTUlfTUFUSF9JTlNUUigweDQ4MCwgb3Ax
LCBvcDIpCisjZGVmaW5lICAgTUlfTUFUSF9MT0FEMChvcDEpICAgICAgICAgICAgTUlfTUFUSF9J
TlNUUigweDA4MSwgb3AxKQorI2RlZmluZSAgIE1JX01BVEhfTE9BRDEob3AxKSAgICAgICAgICAg
IE1JX01BVEhfSU5TVFIoMHg0ODEsIG9wMSkKKyNkZWZpbmUgICBNSV9NQVRIX0FERCAgICAgICAg
ICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4MTAwLCAweDAsIDB4MCkKKyNkZWZpbmUgICBNSV9N
QVRIX1NVQiAgICAgICAgICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4MTAxLCAweDAsIDB4MCkK
KyNkZWZpbmUgICBNSV9NQVRIX0FORCAgICAgICAgICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4
MTAyLCAweDAsIDB4MCkKKyNkZWZpbmUgICBNSV9NQVRIX09SICAgICAgICAgICAgICAgICAgICBN
SV9NQVRIX0lOU1RSKDB4MTAzLCAweDAsIDB4MCkKKyNkZWZpbmUgICBNSV9NQVRIX1hPUiAgICAg
ICAgICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4MTA0LCAweDAsIDB4MCkKKyNkZWZpbmUgICBN
SV9NQVRIX1NUT1JFKG9wMSwgb3AyKSAgICAgICBNSV9NQVRIX0lOU1RSKDB4MTgwLCBvcDEsIG9w
MikKKyNkZWZpbmUgICBNSV9NQVRIX1NUT1JFSU5WKG9wMSwgb3AyKSAgICBNSV9NQVRIX0lOU1RS
KDB4NTgwLCBvcDEsIG9wMikKKy8qIFJlZ2lzdGVycyB1c2VkIGFzIG9wZXJhbmRzIGluIE1JX01B
VEhfSU5TVFIgKi8KKyNkZWZpbmUgICBNSV9NQVRIX1JFRyh4KSAgICAgICAgICAgICAgICAoeCkK
KyNkZWZpbmUgICBNSV9NQVRIX1JFR19TUkNBICAgICAgICAgICAgICAweDIwCisjZGVmaW5lICAg
TUlfTUFUSF9SRUdfU1JDQiAgICAgICAgICAgICAgMHgyMQorI2RlZmluZSAgIE1JX01BVEhfUkVH
X0FDQ1UgICAgICAgICAgICAgIDB4MzEKKyNkZWZpbmUgICBNSV9NQVRIX1JFR19aRiAgICAgICAg
ICAgICAgICAweDMyCisjZGVmaW5lICAgTUlfTUFUSF9SRUdfQ0YgICAgICAgICAgICAgICAgMHgz
MworCisjZGVmaW5lIE1JX0xPQURfUkVHSVNURVJfUkVHICAgIE1JX0lOU1RSKDB4MkEsIDEpCisK
K3N0YXRpYyB2b2lkIGRlbGF5KGludCBpOTE1LAorCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9leGVj
dXRpb25fZW5naW5lMiAqZSwKKwkJICB1aW50MzJfdCBoYW5kbGUsCisJCSAgdWludDY0X3QgYWRk
ciwKKwkJICB1aW50NjRfdCBucykKK3sKKwljb25zdCBpbnQgdXNlXzY0YiA9IGludGVsX2dlbihp
bnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA+PSA4OworCWNvbnN0IHVpbnQzMl90IGJhc2UgPSBn
ZW1fZW5naW5lX21taW9fYmFzZShpOTE1LCBlLT5uYW1lKTsKKyNkZWZpbmUgQ1NfR1BSKHgpIChi
YXNlICsgMHg2MDAgKyA4ICogKHgpKQorI2RlZmluZSBSVU5USU1FIChiYXNlICsgMHgzYTgpCisJ
ZW51bSB7IFNUQVJUX1RTLCBOT1dfVFMgfTsKKwl1aW50MzJfdCAqbWFwLCAqY3MsICpqbXA7CisK
KwlpZ3RfcmVxdWlyZShiYXNlKTsKKworCS8qIExvb3AgdW50aWwgQ1RYX1RJTUVTVEFNUCAtIGlu
aXRpYWwgPiBAbnMgKi8KKworCWNzID0gbWFwID0gZ2VtX21tYXBfX2RldmljZV9jb2hlcmVudChp
OTE1LCBoYW5kbGUsIDAsIDQwOTYsIFBST1RfV1JJVEUpOworCisJKmNzKysgPSBNSV9MT0FEX1JF
R0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihTVEFSVF9UUykgKyA0OworCSpjcysrID0gMDsK
KwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVHOworCSpjcysrID0gUlVOVElNRTsKKwkqY3Mr
KyA9IENTX0dQUihTVEFSVF9UUyk7CisKKwl3aGlsZSAob2Zmc2V0X2luX3BhZ2UoY3MpICYgNjMp
CisJCSpjcysrID0gMDsKKwlqbXAgPSBjczsKKworCSpjcysrID0gMHg1IDw8IDIzOyAvKiBNSV9B
UkJfQ0hFQ0sgKi8KKworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU07CisJKmNzKysgPSBD
U19HUFIoTk9XX1RTKSArIDQ7CisJKmNzKysgPSAwOworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RF
Ul9SRUc7CisJKmNzKysgPSBSVU5USU1FOworCSpjcysrID0gQ1NfR1BSKE5PV19UUyk7CisKKwkv
KiBkZWx0YSA9IG5vdyAtIHN0YXJ0OyBpbnZlcnRlZCB0byBtYXRjaCBDT05EX0JCRSAqLworCSpj
cysrID0gTUlfTUFUSCg0KTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNB
LCBNSV9NQVRIX1JFRyhOT1dfVFMpKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JF
R19TUkNCLCBNSV9NQVRIX1JFRyhTVEFSVF9UUykpOworCSpjcysrID0gTUlfTUFUSF9TVUI7CisJ
KmNzKysgPSBNSV9NQVRIX1NUT1JFSU5WKE1JX01BVEhfUkVHKE5PV19UUyksIE1JX01BVEhfUkVH
X0FDQ1UpOworCisJLyogU2F2ZSBkZWx0YSBmb3IgcmVhZGluZyBieSBDT05EX0JCRSAqLworCSpj
cysrID0gMHgyNCA8PCAyMyB8ICgxICsgdXNlXzY0Yik7IC8qIFNSTSAqLworCSpjcysrID0gQ1Nf
R1BSKE5PV19UUyk7CisJKmNzKysgPSBhZGRyICsgNDAwMDsKKwkqY3MrKyA9IGFkZHIgPj4gMzI7
CisKKwkvKiBEZWxheSBiZXR3ZWVuIFNSTSBhbmQgQ09ORF9CQkUgdG8gcG9zdCB0aGUgd3JpdGVz
ICovCisJZm9yIChpbnQgbiA9IDA7IG4gPCA4OyBuKyspIHsKKwkJKmNzKysgPSBNSV9TVE9SRV9E
V09SRF9JTU07CisJCWlmICh1c2VfNjRiKSB7CisJCQkqY3MrKyA9IGFkZHIgKyA0MDY0OworCQkJ
KmNzKysgPSBhZGRyID4+IDMyOworCQl9IGVsc2UgeworCQkJKmNzKysgPSAwOworCQkJKmNzKysg
PSBhZGRyICsgNDA2NDsKKwkJfQorCQkqY3MrKyA9IDA7CisJfQorCisJLyogQnJlYWsgaWYgZGVs
dGEgW3RpbWUgZWxhcHNlZF0gPiBucyAqLworCSpjcysrID0gTUlfQ09ORF9CQVRDSF9CVUZGRVJf
RU5EIHwgTUlfRE9fQ09NUEFSRSB8ICgxICsgdXNlXzY0Yik7CisJKmNzKysgPSB+bnNfdG9fY3R4
X3RpY2tzKGk5MTUsIG5zKTsKKwkqY3MrKyA9IGFkZHIgKyA0MDAwOworCSpjcysrID0gYWRkciA+
PiAzMjsKKworCS8qIE90aGVyd2lzZSBiYWNrIHRvIHJlY2FsY3VsYXRpbmcgZGVsdGEgKi8KKwkq
Y3MrKyA9IE1JX0JBVENIX0JVRkZFUl9TVEFSVCB8IDEgPDwgOCB8IHVzZV82NGI7CisJKmNzKysg
PSBhZGRyICsgb2Zmc2V0X2luX3BhZ2Uoam1wKTsKKwkqY3MrKyA9IGFkZHIgPj4gMzI7CisKKwlt
dW5tYXAobWFwLCA0MDk2KTsKK30KKworc3RhdGljIHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19v
YmplY3QyCitkZWxheV9jcmVhdGUoaW50IGk5MTUsIHVpbnQzMl90IGN0eCwKKwkgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqZSwKKwkgICAgIHVpbnQ2NF90IHRhcmdl
dF9ucykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiBvYmogPSB7CisJCS5o
YW5kbGUgPSBiYXRjaF9jcmVhdGUoaTkxNSksCisJCS5mbGFncyA9IEVYRUNfT0JKRUNUX1NVUFBP
UlRTXzQ4Ql9BRERSRVNTLAorCX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBl
eGVjYnVmID0geworCQkuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIoJm9iaiksCisJCS5i
dWZmZXJfY291bnQgPSAxLAorCQkucnN2ZDEgPSBjdHgsCisJCS5mbGFncyA9IGUtPmZsYWdzLAor
CX07CisKKwlvYmoub2Zmc2V0ID0gb2JqLmhhbmRsZSA8PCAxMjsKKwlnZW1fZXhlY2J1ZihpOTE1
LCAmZXhlY2J1Zik7CisJZ2VtX3N5bmMoaTkxNSwgb2JqLmhhbmRsZSk7CisKKwlkZWxheShpOTE1
LCBlLCBvYmouaGFuZGxlLCBvYmoub2Zmc2V0LCB0YXJnZXRfbnMpOworCisJb2JqLmZsYWdzIHw9
IEVYRUNfT0JKRUNUX1BJTk5FRDsKKwlyZXR1cm4gb2JqOworfQorCitzdGF0aWMgdm9pZCB0c2xv
ZyhpbnQgaTkxNSwKKwkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUs
CisJCSAgdWludDMyX3QgaGFuZGxlLAorCQkgIHVpbnQ2NF90IGFkZHIpCit7CisJY29uc3QgaW50
IHVzZV82NGIgPSBpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChpOTE1KSkgPj0gODsKKwlj
b25zdCB1aW50MzJfdCBiYXNlID0gZ2VtX2VuZ2luZV9tbWlvX2Jhc2UoaTkxNSwgZS0+bmFtZSk7
CisjZGVmaW5lIENTX0dQUih4KSAoYmFzZSArIDB4NjAwICsgOCAqICh4KSkKKyNkZWZpbmUgQ1Nf
VElNRVNUQU1QIChiYXNlICsgMHgzNTgpCisJZW51bSB7IElOQywgTUFTSywgQUREUiB9OworCXVp
bnQzMl90ICp0aW1lc3RhbXBfbG8sICphZGRyX2xvOworCXVpbnQzMl90ICptYXAsICpjczsKKwor
CWlndF9yZXF1aXJlKGJhc2UpOworCisJbWFwID0gZ2VtX21tYXBfX2RldmljZV9jb2hlcmVudChp
OTE1LCBoYW5kbGUsIDAsIDQwOTYsIFBST1RfV1JJVEUpOworCWNzID0gbWFwICsgNTEyOworCisJ
LyogUmVjb3JkIHRoZSBjdXJyZW50IENTX1RJTUVTVEFNUCBpbnRvIGEgam91cm5hbCBbYSA1MTIg
c2xvdCByaW5nXS4gKi8KKwkqY3MrKyA9IDB4MjQgPDwgMjMgfCAoMSArIHVzZV82NGIpOyAvKiBT
Uk0gKi8KKwkqY3MrKyA9IENTX1RJTUVTVEFNUDsKKwl0aW1lc3RhbXBfbG8gPSBjczsKKwkqY3Mr
KyA9IGFkZHI7CisJKmNzKysgPSBhZGRyID4+IDMyOworCisJLyogTG9hZCB0aGUgYWRkcmVzcyAr
IGluYyAmIG1hc2sgdmFyaWFibGVzICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsK
KwkqY3MrKyA9IENTX0dQUihBRERSKTsKKwlhZGRyX2xvID0gY3M7CisJKmNzKysgPSBhZGRyOwor
CSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU07CisJKmNzKysgPSBDU19HUFIoQUREUikgKyA0
OworCSpjcysrID0gYWRkciA+PiAzMjsKKworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU07
CisJKmNzKysgPSBDU19HUFIoSU5DKTsKKwkqY3MrKyA9IDQ7CisJKmNzKysgPSBNSV9MT0FEX1JF
R0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihJTkMpICsgNDsKKwkqY3MrKyA9IDA7CisKKwkq
Y3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpjcysrID0gQ1NfR1BSKE1BU0spOworCSpj
cysrID0gMHhmZmZmZjdmZjsKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpjcysr
ID0gQ1NfR1BSKE1BU0spICsgNDsKKwkqY3MrKyA9IDB4ZmZmZmZmZmY7CisKKwkvKiBJbmNyZW1l
bnQgdGhlIFtyaW5nXSBhZGRyZXNzIGZvciBzYXZpbmcgQ1NfVElNRVNUQU1QICovCisJKmNzKysg
PSBNSV9NQVRIKDgpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1J
X01BVEhfUkVHKElOQykpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0Is
IE1JX01BVEhfUkVHKEFERFIpKTsKKwkqY3MrKyA9IE1JX01BVEhfQUREOworCSpjcysrID0gTUlf
TUFUSF9TVE9SRShNSV9NQVRIX1JFRyhBRERSKSwgTUlfTUFUSF9SRUdfQUNDVSk7CisJKmNzKysg
PSBNSV9NQVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQSwgTUlfTUFUSF9SRUcoQUREUikpOworCSpj
cysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0IsIE1JX01BVEhfUkVHKE1BU0spKTsK
KwkqY3MrKyA9IE1JX01BVEhfQU5EOworCSpjcysrID0gTUlfTUFUSF9TVE9SRShNSV9NQVRIX1JF
RyhBRERSKSwgTUlfTUFUSF9SRUdfQUNDVSk7CisKKwkvKiBSZXdyaXRlIHRoZSBiYXRjaCBidWZm
ZXIgZm9yIHRoZSBuZXh0IGV4ZWN1dGlvbiAqLworCSpjcysrID0gMHgyNCA8PCAyMyB8ICgxICsg
dXNlXzY0Yik7IC8qIFNSTSAqLworCSpjcysrID0gQ1NfR1BSKEFERFIpOworCSpjcysrID0gYWRk
ciArIG9mZnNldF9pbl9wYWdlKHRpbWVzdGFtcF9sbyk7CisJKmNzKysgPSBhZGRyID4+IDMyOwor
CSpjcysrID0gMHgyNCA8PCAyMyB8ICgxICsgdXNlXzY0Yik7IC8qIFNSTSAqLworCSpjcysrID0g
Q1NfR1BSKEFERFIpOworCSpjcysrID0gYWRkciArIG9mZnNldF9pbl9wYWdlKGFkZHJfbG8pOwor
CSpjcysrID0gYWRkciA+PiAzMjsKKworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwor
CW11bm1hcChtYXAsIDQwOTYpOworfQorCitzdGF0aWMgc3RydWN0IGRybV9pOTE1X2dlbV9leGVj
X29iamVjdDIKK3RzbG9nX2NyZWF0ZShpbnQgaTkxNSwgdWludDMyX3QgY3R4LCBjb25zdCBzdHJ1
Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9l
eGVjX29iamVjdDIgb2JqID0geworCQkuaGFuZGxlID0gYmF0Y2hfY3JlYXRlKGk5MTUpLAorCQku
ZmxhZ3MgPSBFWEVDX09CSkVDVF9TVVBQT1JUU180OEJfQUREUkVTUywKKwl9OworCXN0cnVjdCBk
cm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZXhlY2J1ZiA9IHsKKwkJLmJ1ZmZlcnNfcHRyID0gdG9f
dXNlcl9wb2ludGVyKCZvYmopLAorCQkuYnVmZmVyX2NvdW50ID0gMSwKKwkJLnJzdmQxID0gY3R4
LAorCQkuZmxhZ3MgPSBlLT5mbGFncywKKwl9OworCisJb2JqLm9mZnNldCA9IG9iai5oYW5kbGUg
PDwgMTI7CisJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCWdlbV9zeW5jKGk5MTUsIG9i
ai5oYW5kbGUpOworCisJdHNsb2coaTkxNSwgZSwgb2JqLmhhbmRsZSwgb2JqLm9mZnNldCk7CisK
KwlvYmouZmxhZ3MgfD0gRVhFQ19PQkpFQ1RfUElOTkVEOworCXJldHVybiBvYmo7Cit9CisKK3N0
YXRpYyBpbnQgY21wX3UzMihjb25zdCB2b2lkICpBLCBjb25zdCB2b2lkICpCKQoreworCWNvbnN0
IHVpbnQzMl90ICphID0gQSwgKmIgPSBCOworCisJaWYgKCphIDwgKmIpCisJCXJldHVybiAtMTsK
KwllbHNlIGlmICgqYSA+ICpiKQorCQlyZXR1cm4gMTsKKwllbHNlCisJCXJldHVybiAwOworfQor
CitzdGF0aWMgYm9vbCBoYXNfY3R4X3RpbWVzdGFtcChpbnQgaTkxNSwgY29uc3Qgc3RydWN0IGlu
dGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplKQoreworCWNvbnN0IGludCBnZW4gPSBpbnRlbF9nZW4o
aW50ZWxfZ2V0X2RybV9kZXZpZChpOTE1KSk7CisKKwlpZiAoZ2VuID09IDggJiYgZS0+Y2xhc3Mg
PT0gSTkxNV9FTkdJTkVfQ0xBU1NfVklERU8pCisJCXJldHVybiBmYWxzZTsgLyogbG9va3MgZnVi
YXIgKi8KKworCXJldHVybiB0cnVlOworfQorCitzdGF0aWMgc3RydWN0IGludGVsX2V4ZWN1dGlv
bl9lbmdpbmUyCitwaWNrX3JhbmRvbV9lbmdpbmUoaW50IGk5MTUsIGNvbnN0IHN0cnVjdCBpbnRl
bF9leGVjdXRpb25fZW5naW5lMiAqbm90KQoreworCWNvbnN0IHN0cnVjdCBpbnRlbF9leGVjdXRp
b25fZW5naW5lMiAqZTsKKwl1bnNpZ25lZCBpbnQgY291bnQgPSAwOworCisJX19mb3JfZWFjaF9w
aHlzaWNhbF9lbmdpbmUoaTkxNSwgZSkgeworCQlpZiAoZS0+ZmxhZ3MgPT0gbm90LT5mbGFncykK
KwkJCWNvbnRpbnVlOworCQlpZiAoIWdlbV9jbGFzc19oYXNfbXV0YWJsZV9zdWJtaXNzaW9uKGk5
MTUsIGUtPmNsYXNzKSkKKwkJCWNvbnRpbnVlOworCQljb3VudCsrOworCX0KKwlpZiAoIWNvdW50
KQorCQlyZXR1cm4gKm5vdDsKKworCWNvdW50ID0gcmFuZCgpICUgY291bnQ7CisJX19mb3JfZWFj
aF9waHlzaWNhbF9lbmdpbmUoaTkxNSwgZSkgeworCQlpZiAoZS0+ZmxhZ3MgPT0gbm90LT5mbGFn
cykKKwkJCWNvbnRpbnVlOworCQlpZiAoIWdlbV9jbGFzc19oYXNfbXV0YWJsZV9zdWJtaXNzaW9u
KGk5MTUsIGUtPmNsYXNzKSkKKwkJCWNvbnRpbnVlOworCQlpZiAoIWNvdW50LS0pCisJCQlicmVh
azsKKwl9CisKKwlyZXR1cm4gKmU7Cit9CisKK3N0YXRpYyB2b2lkIGZhaXJfY2hpbGQoaW50IGk5
MTUsIHVpbnQzMl90IGN0eCwKKwkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9leGVjdXRpb25f
ZW5naW5lMiAqZSwKKwkJICAgICAgIHVpbnQ2NF90IGZyYW1lX25zLAorCQkgICAgICAgaW50IHRp
bWVsaW5lLAorCQkgICAgICAgdWludDMyX3QgY29tbW9uLAorCQkgICAgICAgdW5zaWduZWQgaW50
IGZsYWdzLAorCQkgICAgICAgdW5zaWduZWQgbG9uZyAqY3RsLAorCQkgICAgICAgdW5zaWduZWQg
bG9uZyAqbWVkaWFuLAorCQkgICAgICAgdW5zaWduZWQgbG9uZyAqaXFyKQorI2RlZmluZSBGX1NZ
TkMJCSgxIDw8IDApCisjZGVmaW5lIEZfUEFDRQkJKDEgPDwgMSkKKyNkZWZpbmUgRl9GTE9XCQko
MSA8PCAyKQorI2RlZmluZSBGX0hBTEYJCSgxIDw8IDMpCisjZGVmaW5lIEZfU09MTwkJKDEgPDwg
NCkKKyNkZWZpbmUgRl9TUEFSRQkJKDEgPDwgNSkKKyNkZWZpbmUgRl9ORVhUCQkoMSA8PCA2KQor
I2RlZmluZSBGX1ZJUAkJKDEgPDwgNykKKyNkZWZpbmUgRl9SUlVMCQkoMSA8PCA4KQorI2RlZmlu
ZSBGX1NIQVJFCQkoMSA8PCA5KQorI2RlZmluZSBGX1BJTkcJCSgxIDw8IDEwKQorI2RlZmluZSBG
X1RIUk9UVExFCSgxIDw8IDExKQorI2RlZmluZSBGX0lTT0xBVEUJKDEgPDwgMTIpCit7CisJY29u
c3QgaW50IGJhdGNoZXNfcGVyX2ZyYW1lID0gZmxhZ3MgJiBGX1NPTE8gPyAxIDogMzsKKwlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiBvYmpbNF0gPSB7CisJCXt9LAorCQl7CisJCQku
aGFuZGxlID0gY29tbW9uID86IGdlbV9jcmVhdGUoaTkxNSwgNDA5NiksCisJCX0sCisJCWRlbGF5
X2NyZWF0ZShpOTE1LCBjdHgsIGUsIGZyYW1lX25zIC8gYmF0Y2hlc19wZXJfZnJhbWUpLAorCQlk
ZWxheV9jcmVhdGUoaTkxNSwgY3R4LCBlLCBmcmFtZV9ucyAvIGJhdGNoZXNfcGVyX2ZyYW1lKSwK
Kwl9OworCXN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiBwaW5nID0gKmU7CisJaW50IHBf
ZmVuY2UgPSAtMSwgbl9mZW5jZSA9IC0xOworCXVuc2lnbmVkIGxvbmcgY291bnQgPSAwOworCWlu
dCBuOworCisJc3JhbmRvbShnZXRwaWQoKSk7CisJaWYgKGZsYWdzICYgRl9QSU5HKQorCQlwaW5n
ID0gcGlja19yYW5kb21fZW5naW5lKGk5MTUsIGUpOworCW9ialswXSA9IHRzbG9nX2NyZWF0ZShp
OTE1LCBjdHgsICZwaW5nKTsKKworCXdoaWxlICghUkVBRF9PTkNFKCpjdGwpKSB7CisJCXN0cnVj
dCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZXhlY2J1ZiA9IHsKKwkJCS5idWZmZXJzX3B0ciA9
IHRvX3VzZXJfcG9pbnRlcihvYmopLAorCQkJLmJ1ZmZlcl9jb3VudCA9IDQsCisJCQkucnN2ZDEg
PSBjdHgsCisJCQkucnN2ZDIgPSAtMSwKKwkJCS5mbGFncyA9IGUtPmZsYWdzLAorCQl9OworCisJ
CWlmIChmbGFncyAmIEZfRkxPVykgeworCQkJdW5zaWduZWQgaW50IHNlcTsKKworCQkJc2VxID0g
Y291bnQ7CisJCQlpZiAoZmxhZ3MgJiBGX05FWFQpCisJCQkJc2VxKys7CisKKwkJCWV4ZWNidWYu
cnN2ZDIgPQorCQkJCXN3X3N5bmNfdGltZWxpbmVfY3JlYXRlX2ZlbmNlKHRpbWVsaW5lLCBzZXEp
OworCQkJZXhlY2J1Zi5mbGFncyB8PSBJOTE1X0VYRUNfRkVOQ0VfSU47CisJCX0KKworCQlleGVj
YnVmLmZsYWdzIHw9IEk5MTVfRVhFQ19GRU5DRV9PVVQ7CisJCWdlbV9leGVjYnVmX3dyKGk5MTUs
ICZleGVjYnVmKTsKKwkJbl9mZW5jZSA9IGV4ZWNidWYucnN2ZDIgPj4gMzI7CisJCWV4ZWNidWYu
ZmxhZ3MgJj0gfihJOTE1X0VYRUNfRkVOQ0VfT1VUIHwgSTkxNV9FWEVDX0ZFTkNFX0lOKTsKKwkJ
Zm9yIChuID0gMTsgbiA8IGJhdGNoZXNfcGVyX2ZyYW1lOyBuKyspCisJCQlnZW1fZXhlY2J1Zihp
OTE1LCAmZXhlY2J1Zik7CisJCWNsb3NlKGV4ZWNidWYucnN2ZDIpOworCisJCWV4ZWNidWYuYnVm
ZmVyX2NvdW50ID0gMTsKKwkJZXhlY2J1Zi5iYXRjaF9zdGFydF9vZmZzZXQgPSAyMDQ4OworCQll
eGVjYnVmLmZsYWdzID0gcGluZy5mbGFncyB8IEk5MTVfRVhFQ19GRU5DRV9JTjsKKwkJZXhlY2J1
Zi5yc3ZkMiA9IG5fZmVuY2U7CisJCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsKKworCQlp
ZiAoZmxhZ3MgJiBGX1BBQ0UgJiYgcF9mZW5jZSAhPSAtMSkgeworCQkJc3RydWN0IHBvbGxmZCBw
ZmQgPSB7CisJCQkJLmZkID0gcF9mZW5jZSwKKwkJCQkuZXZlbnRzID0gUE9MTElOLAorCQkJfTsK
KwkJCXBvbGwoJnBmZCwgMSwgLTEpOworCQl9CisJCWNsb3NlKHBfZmVuY2UpOworCisJCWlmIChm
bGFncyAmIEZfU1lOQykgeworCQkJc3RydWN0IHBvbGxmZCBwZmQgPSB7CisJCQkJLmZkID0gbl9m
ZW5jZSwKKwkJCQkuZXZlbnRzID0gUE9MTElOLAorCQkJfTsKKwkJCXBvbGwoJnBmZCwgMSwgLTEp
OworCQl9CisKKwkJaWYgKGZsYWdzICYgRl9USFJPVFRMRSkKKwkJCWlndF9pb2N0bChpOTE1LCBE
Uk1fSU9DVExfSTkxNV9HRU1fVEhST1RUTEUsIDApOworCisJCWlndF9zd2FwKG9ialsyXSwgb2Jq
WzNdKTsKKwkJaWd0X3N3YXAocF9mZW5jZSwgbl9mZW5jZSk7CisJCWNvdW50Kys7CisJfQorCWNs
b3NlKHBfZmVuY2UpOworCisJZ2VtX2Nsb3NlKGk5MTUsIG9ialszXS5oYW5kbGUpOworCWdlbV9j
bG9zZShpOTE1LCBvYmpbMl0uaGFuZGxlKTsKKwlpZiAob2JqWzFdLmhhbmRsZSAhPSBjb21tb24p
CisJCWdlbV9jbG9zZShpOTE1LCBvYmpbMV0uaGFuZGxlKTsKKworCWdlbV9zeW5jKGk5MTUsIG9i
alswXS5oYW5kbGUpOworCWlmIChtZWRpYW4pIHsKKwkJdWludDMyX3QgKm1hcDsKKworCQkvKgor
CQkgKiBXZSByZWNvcmRlZCB0aGUgQ1NfVElNRVNUQU1QIG9mIGVhY2ggZnJhbWUsIGFuZCBpZgor
CQkgKiB0aGUgR1BVIGlzIGJlaW5nIHNoYXJlZCBjb21wbGV0ZWx5IGZhaXJseSwgd2UgZXhwZWN0
CisJCSAqIGVhY2ggZnJhbWUgdG8gYmUgYXQgdGhlIHNhbWUgaW50ZXJ2YWwgZnJvbSB0aGUgbGFz
dC4KKwkJICoKKwkJICogQ29tcHV0ZSB0aGUgaW50ZXJ2YWwgYmV0d2VlbiBmcmFtZXMgYW5kIHJl
cG9ydCBiYWNrCisJCSAqIGJvdGggdGhlIG1lZGlhbiBpbnRlcnZhbCBhbmQgdGhlIHJhbmdlIGZv
ciB0aGlzIGNsaWVudC4KKwkJICovCisKKwkJbWFwID0gZ2VtX21tYXBfX2RldmljZV9jb2hlcmVu
dChpOTE1LCBvYmpbMF0uaGFuZGxlLAorCQkJCQkJMCwgNDA5NiwgUFJPVF9XUklURSk7CisJCWZv
ciAobiA9IDE7IG4gPCBtaW4oY291bnQsIDUxMik7IG4rKykgeworCQkJaWd0X2Fzc2VydChtYXBb
bl0pOworCQkJbWFwW24gLSAxXSA9IG1hcFtuXSAtIG1hcFtuIC0gMV07CisJCX0KKwkJcXNvcnQo
bWFwLCAtLW4sIHNpemVvZigqbWFwKSwgY21wX3UzMik7CisJCSppcXIgPSB0aWNrc190b19ucyhp
OTE1LCBtYXBbKDMgKiBuICsgMykgLyA0XSAtIG1hcFtuIC8gNF0pOworCQkqbWVkaWFuID0gdGlj
a3NfdG9fbnMoaTkxNSwgbWFwW24gLyAyXSk7CisJCW11bm1hcChtYXAsIDQwOTYpOworCX0KKwln
ZW1fY2xvc2UoaTkxNSwgb2JqWzBdLmhhbmRsZSk7Cit9CisKK3N0YXRpYyBpbnQgY21wX3VsKGNv
bnN0IHZvaWQgKkEsIGNvbnN0IHZvaWQgKkIpCit7CisJY29uc3QgdW5zaWduZWQgbG9uZyAqYSA9
IEEsICpiID0gQjsKKworCWlmICgqYSA8ICpiKQorCQlyZXR1cm4gLTE7CisJZWxzZSBpZiAoKmEg
PiAqYikKKwkJcmV0dXJuIDE7CisJZWxzZQorCQlyZXR1cm4gMDsKK30KKworc3RhdGljIHVpbnQ2
NF90IGRfY3B1X3RpbWUoY29uc3Qgc3RydWN0IHJ1c2FnZSAqYSwgY29uc3Qgc3RydWN0IHJ1c2Fn
ZSAqYikKK3sKKwl1aW50NjRfdCBjcHVfdGltZSA9IDA7CisKKwljcHVfdGltZSArPSAoYS0+cnVf
dXRpbWUudHZfc2VjIC0gYi0+cnVfdXRpbWUudHZfc2VjKSAqIE5TRUNfUEVSX1NFQzsKKwljcHVf
dGltZSArPSAoYS0+cnVfdXRpbWUudHZfdXNlYyAtIGItPnJ1X3V0aW1lLnR2X3VzZWMpICogMTAw
MDsKKworCWNwdV90aW1lICs9IChhLT5ydV9zdGltZS50dl9zZWMgLSBiLT5ydV9zdGltZS50dl9z
ZWMpICogTlNFQ19QRVJfU0VDOworCWNwdV90aW1lICs9IChhLT5ydV9zdGltZS50dl91c2VjIC0g
Yi0+cnVfc3RpbWUudHZfdXNlYykgKiAxMDAwOworCisJcmV0dXJuIGNwdV90aW1lOworfQorCitz
dGF0aWMgdm9pZCB0aW1lbGluZV9hZHZhbmNlKGludCB0aW1lbGluZSwgaW50IGRlbGF5X25zKQor
eworCXN0cnVjdCB0aW1lc3BlYyB0diA9IHsgLnR2X25zZWMgPSBkZWxheV9ucyB9OworCW5hbm9z
bGVlcCgmdHYsIE5VTEwpOworCXN3X3N5bmNfdGltZWxpbmVfaW5jKHRpbWVsaW5lLCAxKTsKK30K
Kworc3RhdGljIHZvaWQgZmFpcm5lc3MoaW50IGk5MTUsCisJCSAgICAgY29uc3Qgc3RydWN0IGlu
dGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplLAorCQkgICAgIGludCB0aW1lb3V0LCB1bnNpZ25lZCBp
bnQgZmxhZ3MpCit7CisJY29uc3QgaW50IGZyYW1lX25zID0gMTY2NjYgKiAxMDAwOworCWNvbnN0
IGludCBmZW5jZV9ucyA9IGZsYWdzICYgRl9IQUxGID8gMiAqIGZyYW1lX25zIDogZnJhbWVfbnM7
CisJdW5zaWduZWQgbG9uZyAqcmVzdWx0LCAqaXFyOworCXVpbnQzMl90IGNvbW1vbiA9IDA7CisK
KwlpZ3RfcmVxdWlyZShoYXNfY3R4X3RpbWVzdGFtcChpOTE1LCBlKSk7CisJaWd0X3JlcXVpcmUo
Z2VtX2NsYXNzX2hhc19tdXRhYmxlX3N1Ym1pc3Npb24oaTkxNSwgZS0+Y2xhc3MpKTsKKworCWlm
IChmbGFncyAmIEZfU0hBUkUpCisJCWNvbW1vbiA9IGdlbV9jcmVhdGUoaTkxNSwgNDA5NSk7CisK
KwlyZXN1bHQgPSBtbWFwKE5VTEwsIDQwOTYsIFBST1RfV1JJVEUsIE1BUF9TSEFSRUQgfCBNQVBf
QU5PTiwgLTEsIDApOworCWlndF9hc3NlcnQocmVzdWx0ICE9IE1BUF9GQUlMRUQpOworCWlxciA9
IG1tYXAoTlVMTCwgNDA5NiwgUFJPVF9XUklURSwgTUFQX1NIQVJFRCB8IE1BUF9BTk9OLCAtMSwg
MCk7CisJaWd0X2Fzc2VydChpcXIgIT0gTUFQX0ZBSUxFRCk7CisKKwlmb3IgKGludCBuID0gMjsg
biA8PSAyNTY7IG4gPDw9IDEpIHsgLyogMzIgPT0gNTAwdXMgcGVyIGNsaWVudCAqLworCQlpbnQg
dGltZWxpbmUgPSBzd19zeW5jX3RpbWVsaW5lX2NyZWF0ZSgpOworCQlpbnQgbmZlbmNlcyA9IHRp
bWVvdXQgKiBOU0VDX1BFUl9TRUMgLyBmZW5jZV9ucyArIDE7CisJCWludCBuY2hpbGQgPSBuIC0g
MTsgLyogb2RkIGZvciBlYXN5IG1lZGlhbnMgKi8KKwkJY29uc3QgaW50IGNoaWxkX25zID0gZnJh
bWVfbnMgLyAobmNoaWxkICsgISEoZmxhZ3MgJiBGX1NQQVJFKSk7CisJCWNvbnN0IGludCBsbyA9
IG5jaGlsZCAvIDQ7CisJCWNvbnN0IGludCBoaSA9ICgzICogbmNoaWxkICsgMykgLyA0IC0gMTsK
KwkJc3RydWN0IHJ1c2FnZSBvbGRfdXNhZ2UsIHVzYWdlOworCQl1aW50NjRfdCBjcHVfdGltZSwg
ZF90aW1lOworCQlzdHJ1Y3QgdGltZXNwZWMgdHY7CisJCXN0cnVjdCBpZ3RfbWVhbiBtOworCisJ
CW1lbXNldChyZXN1bHQsIDAsIChuY2hpbGQgKyAxKSAqIHNpemVvZihyZXN1bHRbMF0pKTsKKwor
CQlpZiAoZmxhZ3MgJiBGX1BJTkcpIHsKKwkJCXN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5l
MiAqcGluZzsKKworCQkJX19mb3JfZWFjaF9waHlzaWNhbF9lbmdpbmUoaTkxNSwgcGluZykgewor
CQkJCWlmIChwaW5nLT5mbGFncyA9PSBlLT5mbGFncykKKwkJCQkJY29udGludWU7CisKKwkJCQlp
Z3RfZm9yayhjaGlsZCwgMSkgeworCQkJCQl1aW50MzJfdCBjdHggPSBnZW1fY29udGV4dF9jbG9u
ZV93aXRoX2VuZ2luZXMoaTkxNSwgMCk7CisKKwkJCQkJZmFpcl9jaGlsZChpOTE1LCBjdHgsIHBp
bmcsCisJCQkJCQkgICBjaGlsZF9ucyAvIDgsCisJCQkJCQkgICAtMSwgY29tbW9uLAorCQkJCQkJ
ICAgRl9TT0xPIHwgRl9QQUNFIHwgRl9TSEFSRSwKKwkJCQkJCSAgICZyZXN1bHRbbmNoaWxkXSwK
KwkJCQkJCSAgIE5VTEwsIE5VTEwpOworCisJCQkJCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwg
Y3R4KTsKKwkJCQl9CisJCQl9CisJCX0KKworCQlnZXRydXNhZ2UoUlVTQUdFX0NISUxEUkVOLCAm
b2xkX3VzYWdlKTsKKwkJaWd0X25zZWNfZWxhcHNlZChtZW1zZXQoJnR2LCAwLCBzaXplb2YodHYp
KSk7CisJCWlndF9mb3JrKGNoaWxkLCBuY2hpbGQpIHsKKwkJCXVpbnQzMl90IGN0eDsKKworCQkJ
aWYgKGZsYWdzICYgRl9JU09MQVRFKSB7CisJCQkJaW50IGNsb25lLCBkbWFidWYgPSAtMTsKKwor
CQkJCWlmIChjb21tb24pCisJCQkJCWRtYWJ1ZiA9IHByaW1lX2hhbmRsZV90b19mZChpOTE1LCBj
b21tb24pOworCisJCQkJY2xvbmUgPSBnZW1fcmVvcGVuX2RyaXZlcihpOTE1KTsKKwkJCQlnZW1f
Y29udGV4dF9jb3B5X2VuZ2luZXMoaTkxNSwgMCwgY2xvbmUsIDApOworCQkJCWk5MTUgPSBjbG9u
ZTsKKworCQkJCWlmIChkbWFidWYgIT0gLTEpCisJCQkJCWNvbW1vbiA9IHByaW1lX2ZkX3RvX2hh
bmRsZShpOTE1LCBkbWFidWYpOworCQkJfQorCisJCQljdHggPSBnZW1fY29udGV4dF9jbG9uZV93
aXRoX2VuZ2luZXMoaTkxNSwgMCk7CisKKwkJCWlmIChmbGFncyAmIEZfVklQICYmIGNoaWxkID09
IDApIHsKKwkJCQlnZW1fY29udGV4dF9zZXRfcHJpb3JpdHkoaTkxNSwgY3R4LCBNQVhfUFJJTyk7
CisJCQkJZmxhZ3MgfD0gRl9GTE9XOworCQkJfQorCQkJaWYgKGZsYWdzICYgRl9SUlVMICYmIGNo
aWxkID09IDApCisJCQkJZmxhZ3MgfD0gRl9TT0xPIHwgRl9GTE9XIHwgRl9TWU5DOworCisJCQlm
YWlyX2NoaWxkKGk5MTUsIGN0eCwgZSwgY2hpbGRfbnMsCisJCQkJICAgdGltZWxpbmUsIGNvbW1v
biwgZmxhZ3MsCisJCQkJICAgJnJlc3VsdFtuY2hpbGRdLAorCQkJCSAgICZyZXN1bHRbY2hpbGRd
LCAmaXFyW2NoaWxkXSk7CisKKwkJCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4KTsKKwkJ
fQorCisJCXdoaWxlIChuZmVuY2VzLS0pCisJCQl0aW1lbGluZV9hZHZhbmNlKHRpbWVsaW5lLCBm
ZW5jZV9ucyk7CisKKwkJcmVzdWx0W25jaGlsZF0gPSAxOworCQlmb3IgKGludCBjaGlsZCA9IDA7
IGNoaWxkIDwgbmNoaWxkOyBjaGlsZCsrKSB7CisJCQl3aGlsZSAoIVJFQURfT05DRShyZXN1bHRb
Y2hpbGRdKSkKKwkJCQl0aW1lbGluZV9hZHZhbmNlKHRpbWVsaW5lLCBmZW5jZV9ucyk7CisJCX0K
KworCQlpZ3Rfd2FpdGNoaWxkcmVuKCk7CisJCWNsb3NlKHRpbWVsaW5lKTsKKworCQkvKgorCQkg
KiBBcmUgd2UgcnVubmluZyBvdXQgb2YgQ1BVIHRpbWUsIGFuZCBmYWlsIHRvIHN1Ym1pdCBmcmFt
ZXM/CisJCSAqCisJCSAqIFdlIHRyeSB0byBydWxlIG91dCBhbnkgdW5kdWUgaW1wYWN0IG9uIHRo
ZSBHUFUgc2NoZWR1bGluZworCQkgKiBmcm9tIHRoZSBDUFUgc2NoZWR1bGVyIGJ5IGxvb2tpbmcg
Zm9yIGNvcmUgc2F0dXJhdGlvbi4gSWYKKwkJICogd2UgbWF5IGJlIGluIGEgc2l0dWF0aW9uIHdo
ZXJlIHRoZSBjbGllbnRzICsga2VybmVsIGFyZQorCQkgKiB0YWtpbmcgYSB3aG9sZSBjb3JlICh0
aGluayBsb2NrZGVwKSwgdGhlbiBpdCBpcyBpbmNyZWFzaW5nbHkKKwkJICogbGlrZWx5IHRoYXQg
b3VyIG1lYXN1cmVtZW50cyBpbmNsdWRlIGRlbGF5cyBmcm9tIHRoZSBDUFUKKwkJICogc2NoZWR1
bGVyLiBFcnIgb24gdGhlIHNpZGUgb2YgY2F1dGlvbi4KKwkJICovCisJCWRfdGltZSA9IGlndF9u
c2VjX2VsYXBzZWQoJnR2KTsKKwkJZ2V0cnVzYWdlKFJVU0FHRV9DSElMRFJFTiwgJnVzYWdlKTsK
KwkJY3B1X3RpbWUgPSBkX2NwdV90aW1lKCZ1c2FnZSwgJm9sZF91c2FnZSk7CisJCWlndF9kZWJ1
ZygiQ1BVIHVzYWdlOiAlLjBmJSVcbiIsIDEwMC4gKiBjcHVfdGltZSAvIGRfdGltZSk7CisJCWlm
ICg0ICogY3B1X3RpbWUgPiAzICogZF90aW1lKSB7CisJCQlpZiAobmNoaWxkID4gNykgLyogZ29v
ZCBlbm91Z2ggdG8ganVkZ2UgcGFzcy9mYWlsICovCisJCQkJYnJlYWs7CisKKwkJCWlndF9za2lw
X29uX2YoNCAqIGNwdV90aW1lID4gMyAqIGRfdGltZSwKKwkJCQkgICAgICAiJS4wZiUlIENQVSB1
c2FnZSwgcHJlc3VtaW5nIGNhcGFjaXR5IGV4Y2VlZGVkXG4iLAorCQkJCSAgICAgIDEwMC4gKiBj
cHVfdGltZSAvIGRfdGltZSk7CisJCX0KKworCQkvKiBXaXRoIG5vIGNvbnRlbnRpb24sIHdlIHNo
b3VsZCBtYXRjaCBvdXIgdGFyZ2V0IGZyYW1ldGltZSAqLworCQlpZiAobmNoaWxkID09IDEpIHsK
KwkJCWlndF9hc3NlcnQoNCAqIHJlc3VsdFswXSA+IDMgKiBmZW5jZV9ucyAmJgorCQkJCSAgIDMg
KiByZXN1bHRbMF0gPCA0ICogZmVuY2VfbnMpOworCQkJY29udGludWU7CisJCX0KKworCQlpZiAo
ZmxhZ3MgJiAoRl9WSVAgfCBGX1JSVUwpKSB7CisJCQlpZ3RfaW5mbygiVklQIGludGVydmFsICUu
MmZtcywgcmFuZ2UgJS4yZm1zXG4iLAorCQkJCSAxZS02ICogcmVzdWx0WzBdLCAxZS02ICogaXFy
WzBdKTsKKwkJCWlndF9hc3NlcnRfZig0ICogcmVzdWx0WzBdID4gMyAqIGZlbmNlX25zICYmCisJ
CQkJICAgICAzICogcmVzdWx0WzBdIDwgNCAqIGZlbmNlX25zLAorCQkJCSAgICAgIlZJUCBleHBl
Y3RzIHRvIHJ1biBleGFjdGx5IHdoZW4gaXQgd2FudHMsIGV4cGVjdHMgYW4gaW50ZXJ2YWwgb2Yg
JS4yZm1zLCB3YXMgJS4yZm1zXG4iLAorCQkJCSAgICAgMWUtNiAqIGZlbmNlX25zLCAxZS02ICog
cmVzdWx0WzBdKTsKKwkJCWlndF9hc3NlcnRfZigyICogaXFyWzBdIDwgcmVzdWx0WzBdLAorCQkJ
CSAgICAgIlZJUCBmcmFtZSBJUVIgJS4yZm1zIGV4Y2VlZGVkIG1lZGlhbiB0aHJlc2hvbGQgJS4y
Zm1zXG4iLAorCQkJCSAgICAgMWUtNiAqIGlxclswXSwKKwkJCQkgICAgIDFlLTYgKiByZXN1bHRb
MF0gLyAyKTsKKwkJCWlmICghLS1uY2hpbGQpCisJCQkJY29udGludWU7CisKKwkJCS8qIEV4Y2x1
ZGUgdGhlIFZJUCByZXN1bHQgZnJvbSB0aGUgcGxlYmlhbiBzdGF0aXN0aWNzICovCisJCQltZW1t
b3ZlKHJlc3VsdCwgcmVzdWx0ICsgMSwgbmNoaWxkICogc2l6ZW9mKCpyZXN1bHQpKTsKKwkJCW1l
bW1vdmUoaXFyLCBpcXIgKyAxLCBuY2hpbGQgKiBzaXplb2YoKmlxcikpOworCQl9CisKKwkJaWd0
X21lYW5faW5pdCgmbSk7CisJCWZvciAoaW50IGNoaWxkID0gMDsgY2hpbGQgPCBuY2hpbGQ7IGNo
aWxkKyspCisJCQlpZ3RfbWVhbl9hZGQoJm0sIHJlc3VsdFtjaGlsZF0pOworCisJCXFzb3J0KHJl
c3VsdCwgbmNoaWxkLCBzaXplb2YoKnJlc3VsdCksIGNtcF91bCk7CisJCXFzb3J0KGlxciwgbmNo
aWxkLCBzaXplb2YoKmlxciksIGNtcF91bCk7CisKKwkJaWd0X2luZm8oIiUzZCBjbGllbnRzLCBy
YW5nZTogWyUuMWYsICUuMWZdLCBpcXI6IFslLjFmLCAlLjFmXSwgbWVkaWFuOiAlLjFmIFslLjFm
LCAlLjFmXSwgbWVhbjogJS4xZiDCsSAlLjJmIG1zXG4iLAorCQkJIG5jaGlsZCwKKwkJCSAxZS02
ICogcmVzdWx0WzBdLCAgMWUtNiAqIHJlc3VsdFtuY2hpbGQgLSAxXSwKKwkJCSAxZS02ICogcmVz
dWx0W2xvXSwgMWUtNiAqIHJlc3VsdFtoaV0sCisJCQkgMWUtNiAqIHJlc3VsdFtuY2hpbGQgLyAy
XSwKKwkJCSAxZS02ICogaXFyW2xvXSwgMWUtNiAqIGlxcltoaV0sCisJCQkgMWUtNiAqIGlndF9t
ZWFuX2dldCgmbSksCisJCQkgMWUtNiAqIHNxcnQoaWd0X21lYW5fZ2V0X3ZhcmlhbmNlKCZtKSkp
OworCisJCWlndF9hc3NlcnRfZigyICogaXFyW2hpXSA8IHJlc3VsdFtuY2hpbGQgLyAyXSwKKwkJ
CSAgICAgIkNoaWxkIGZyYW1lIElRUiAlLjJmbXMgZXhjZWVkZWQgbWVkaWFuIHRocmVzaG9sZCAl
LjJmbXNcbiIsCisJCQkgICAgIDFlLTYgKiBpcXJbaGldLAorCQkJICAgICAxZS02ICogcmVzdWx0
W25jaGlsZCAvIDJdIC8gMik7CisKKwkJaWd0X2Fzc2VydF9mKDQgKiBpZ3RfbWVhbl9nZXQoJm0p
ID4gMyAqIHJlc3VsdFtuY2hpbGQgLyAyXSAmJgorCQkJICAgICAzICogaWd0X21lYW5fZ2V0KCZt
KSA8IDQgKiByZXN1bHRbbmNoaWxkIC8gMl0sCisJCQkgICAgICJNZWFuIG9mIGNsaWVudCBpbnRl
cnZhbCAlLjJmbXMgZGlmZmVycyBmcm9tIG1lZGlhbiAlLjJmbXMsIGRpc3RyaWJ1dGlvbiBpcyBz
a2V3ZWRcbiIsCisKKwkJCSAgICAgMWUtNiAqIGlndF9tZWFuX2dldCgmbSksIDFlLTYgKiByZXN1
bHRbbmNoaWxkIC8gMl0pOworCisJCWlndF9hc3NlcnRfZigyICogKHJlc3VsdFtoaV0gLSByZXN1
bHRbbG9dKSA8IHJlc3VsdFtuY2hpbGQgLyAyXSwKKwkJCSAgICAgIkludGVycXVhcnRpbGUgcmFu
Z2Ugb2YgY2xpZW50IGludGVydmFscyAlLjJmbXMgaXMgYXMgbGFyZ2UgYXMgdGhlIG1lZGlhbiB0
aHJlc2hvbGQgJS4yZm1zLCBjbGllbnRzIGFyZSBub3QgZXZlbmx5IGRpc3RyaWJ1dGVkIVxuIiwK
KwkJCSAgICAgMWUtNiAqIChyZXN1bHRbaGldIC0gcmVzdWx0W2xvXSksCisJCQkgICAgIDFlLTYg
KiByZXN1bHRbbmNoaWxkIC8gMl0gLyAyKTsKKworCQkvKiBNYXkgYmUgc2xvd2VkIGR1ZSB0byBz
aGVlciB2b2x1bWUgb2YgY29udGV4dCBzd2l0Y2hlcyAqLworCQlpZiAocmVzdWx0WzBdID4gMiAq
IGZlbmNlX25zKQorCQkJYnJlYWs7CisJfQorCisJbXVubWFwKGlxciwgNDA5Nik7CisJbXVubWFw
KHJlc3VsdCwgNDA5Nik7CisJaWYgKGNvbW1vbikKKwkJZ2VtX2Nsb3NlKGk5MTUsIGNvbW1vbik7
Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfZmFpcm5lc3MoaW50IGk5MTUsIGludCB0aW1lb3V0KQor
eworCXN0YXRpYyBjb25zdCBzdHJ1Y3QgeworCQljb25zdCBjaGFyICpuYW1lOworCQl1bnNpZ25l
ZCBpbnQgZmxhZ3M7CisJfSBmYWlyW10gPSB7CisJCS8qCisJCSAqIG5vbmUgLSBtYXhpbWFsIGdy
ZWVkIGluIGVhY2ggY2xpZW50CisJCSAqCisJCSAqIFB1c2ggYXMgbWFueSBmcmFtZXMgZnJvbSBl
YWNoIGNsaWVudCBhcyBmYXN0IGFzIHBvc3NpYmxlCisJCSAqLworCQl7ICJub25lIiwgICAgICAg
MCB9LAorCQl7ICJub25lLXZpcCIsICAgRl9WSVAgfSwgLyogb25lIHZpcCBjbGllbnQgbXVzdCBt
ZWV0IGRlYWRsaW5lcyAqLworCQl7ICJub25lLXNvbG8iLCAgRl9TT0xPIH0sIC8qIDEgYmF0Y2gg
cGVyIGZyYW1lIHBlciBjbGllbnQgKi8KKwkJeyAibm9uZS1zaGFyZSIsIEZfU0hBUkUgfSwgLyog
cmVhZCBmcm9tIGEgY29tbW9uIGJ1ZmZlciAqLworCQl7ICJub25lLXJydWwiLCAgRl9SUlVMIH0s
IC8qICJyZWFsdGltZS1yZXNwb25zZSB1bmRlciBsb2FkIiAqLworCQl7ICJub25lLXBpbmciLCAg
Rl9QSU5HIH0sIC8qIG1lYXN1cmUgaW50ZXItZW5naW5lIGZhaXJuZXNzICovCisKKwkJLyoKKwkJ
ICogdGhyb3R0bGUgLSBvcmlnaW5hbCBwZXIgY2xpZW50IHRocm90dGxpbmcKKwkJICoKKwkJICog
VXNlZCBmb3IgZnJvbnQgYnVmZmVyaW5nIHJlbmRlcmluZyB3aGVyZSB0aGVyZSBpcyBubworCQkg
KiBleHRlbmFsIGZyYW1lIG1hcmtlci4gRWFjaCBjbGllbnQgdHJpZXMgdG8gb25seSBrZWVwCisJ
CSAqIDIwbXMgb2Ygd29yayBzdWJtaXR0ZWQsIHRob3VnaCB0aGF0IG1lYXN1cmVtZW50IGlzCisJ
CSAqIGZsYXdlZC4uLgorCQkgKgorCQkgKiBUaGlzIGlzIHVzZWQgYnkgWG9yZyB0byB0cnkgYW5k
IG1haW50YWluIHNvbWUgcmVzZW1iYWxhbmNlCisJCSAqIG9mIGlucHV0L291dHB1dCBjb25zaXN0
ZW5jeSB3aGVuIGJlaW5nIGZlZWQgYSBjb250aW51b3VzCisJCSAqIHN0cmVhbSBvZiBYMTEgZHJh
dyByZXF1ZXN0cyBzdHJhaWdodCBpbnRvIHNjYW5vdXQsIHdoZXJlCisJCSAqIHRoZSBjbGllbnRz
IG1heSBzdWJtaXQgdGhlIHdvcmsgZmFzdGVyIHRoYW4gY2FuIGJlIGRyYXduLgorCQkgKgorCQkg
KiBUaHJvdHRsaW5nIHRyYWNrcyByZXF1ZXN0cyBwZXItZmlsZSAoYW5kIGFzc3VtZXMgdGhhdAor
CQkgKiBhbGwgcmVxdWVzdHMgYXJlIGluIHN1Ym1pc3Npb24gb3JkZXIgYWNyb3NzIHRoZSB3aG9s
ZSBmaWxlKSwKKwkJICogc28gd2Ugc3BsaXQgZWFjaCBjaGlsZCB0byBpdHMgb3duIGZkLgorCQkg
Ki8KKwkJeyAidGhyb3R0bGUiLCAgICAgICBGX1RIUk9UVExFIHwgRl9JU09MQVRFIH0sCisJCXsg
InRocm90dGxlLXZpcCIsICAgRl9USFJPVFRMRSB8IEZfSVNPTEFURSB8IEZfVklQIH0sCisJCXsg
InRocm90dGxlLXNvbG8iLCAgRl9USFJPVFRMRSB8IEZfSVNPTEFURSB8IEZfU09MTyB9LAorCQl7
ICJ0aHJvdHRsZS1zaGFyZSIsIEZfVEhST1RUTEUgfCBGX0lTT0xBVEUgfCBGX1NIQVJFIH0sCisJ
CXsgInRocm90dGxlLXJydWwiLCAgRl9USFJPVFRMRSB8IEZfSVNPTEFURSB8IEZfUlJVTCB9LAor
CisJCS8qCisJCSAqIHBhY2UgLSBtZXNhICJzdWJtaXQgZG91YmxlIGJ1ZmZlcmluZyIKKwkJICoK
KwkJICogU3VibWl0IGEgZnJhbWUsIHdhaXQgZm9yIHByZXZpb3VzIGZyYW1lIHRvIHN0YXJ0LiBU
aGlzCisJCSAqIHByZXZlbnRzIGVhY2ggY2xpZW50IGZyb20gZ2V0dGluZyB0b28gZmFyIGFoZWFk
IG9mIGl0cworCQkgKiByZW5kZXJpbmcsIG1haW50YWluaW5nIGEgY29uc2lzdGVudCBpbnB1dC9v
dXRwdXQgbGF0ZW5jeS4KKwkJICovCisJCXsgInBhY2UiLCAgICAgICBGX1BBQ0UgfSwKKwkJeyAi
cGFjZS1zb2xvIiwgIEZfUEFDRSB8IEZfU09MT30sCisJCXsgInBhY2Utc2hhcmUiLCBGX1BBQ0Ug
fCBGX1NIQVJFfSwKKwkJeyAicGFjZS1waW5nIiwgIEZfUEFDRSB8IEZfU0hBUkUgfCBGX1BJTkd9
LAorCisJCS8qIHN5bmMgLSBvbmx5IHN1Ym1pdCBhIGZyYW1lIGF0IGEgdGltZSAqLworCQl7ICJz
eW5jIiwgICAgICBGX1NZTkMgfSwKKwkJeyAic3luYy12aXAiLCAgRl9TWU5DIHwgRl9WSVAgfSwK
KwkJeyAic3luYy1zb2xvIiwgRl9TWU5DIHwgRl9TT0xPIH0sCisKKwkJLyogZmxvdyAtIHN5bmNo
cm9uaXNlIGV4ZWN1dGlvbiBhZ2FpbnN0IHRoZSBjbG9jayAodmJsYW5rKSAqLworCQl7ICJmbG93
IiwgICAgICAgRl9QQUNFIHwgRl9GTE9XIH0sCisJCXsgImZsb3ctc29sbyIsICBGX1BBQ0UgfCBG
X0ZMT1cgfCBGX1NPTE8gfSwKKwkJeyAiZmxvdy1zaGFyZSIsIEZfUEFDRSB8IEZfRkxPVyB8IEZf
U0hBUkUgfSwKKwkJeyAiZmxvdy1waW5nIiwgIEZfUEFDRSB8IEZfRkxPVyB8IEZfU0hBUkUgfCBG
X1BJTkcgfSwKKworCQkvKiBuZXh0IC0gc3VibWl0IGFoZWFkIG9mIHRoZSBjbG9jayAodmJsYW5r
IGRvdWJsZSBidWZmZXJpbmcpICovCisJCXsgIm5leHQiLCAgICAgICBGX1BBQ0UgfCBGX0ZMT1cg
fCBGX05FWFQgfSwKKwkJeyAibmV4dC1zb2xvIiwgIEZfUEFDRSB8IEZfRkxPVyB8IEZfTkVYVCB8
IEZfU09MTyB9LAorCQl7ICJuZXh0LXNoYXJlIiwgRl9QQUNFIHwgRl9GTE9XIHwgRl9ORVhUIHwg
Rl9TSEFSRSB9LAorCQl7ICJuZXh0LXBpbmciLCAgRl9QQUNFIHwgRl9GTE9XIHwgRl9ORVhUIHwg
Rl9TSEFSRSB8IEZfUElORyB9LAorCisJCS8qIHNwYXJlIC0gdW5kZXJ1dGlsaXNlIGJ5IGEgc2lu
Z2xlIGNsaWVudCB0aW1lc2xpY2UgKi8KKwkJeyAic3BhcmUiLCAgICAgIEZfUEFDRSB8IEZfRkxP
VyB8IEZfU1BBUkUgfSwKKwkJeyAic3BhcmUtc29sbyIsIEZfUEFDRSB8IEZfRkxPVyB8IEZfU1BB
UkUgfCBGX1NPTE8gfSwKKworCQkvKiBoYWxmIC0gcnVuIGF0IGhhbGYgcGFjZSAoc3VibWl0IDE2
bXMgb2Ygd29yayBldmVyeSAzMm1zKSAqLworCQl7ICJoYWxmIiwgICAgICAgRl9QQUNFIHwgRl9G
TE9XIHwgRl9IQUxGIH0sCisJCXsgImhhbGYtc29sbyIsICBGX1BBQ0UgfCBGX0ZMT1cgfCBGX0hB
TEYgfCBGX1NPTE99LAorCisJCXt9CisJfTsKKworCWlndF9maXh0dXJlIHsKKwkJaWd0X2luZm8o
IkNTIHRpbWVzdGFtcCBmcmVxdWVuY3k6ICVkXG4iLAorCQkJIHJlYWRfdGltZXN0YW1wX2ZyZXF1
ZW5jeShpOTE1KSk7CisKKwkJaWd0X3JlcXVpcmUoaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2
aWQoaTkxNSkpID49IDgpOworCX0KKworCWZvciAodHlwZW9mKCpmYWlyKSAqZiA9IGZhaXI7IGYt
Pm5hbWU7IGYrKykgeworCQlpZ3Rfc3VidGVzdF93aXRoX2R5bmFtaWNfZigiZmFpci0lcyIsIGYt
Pm5hbWUpICB7CisJCQljb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmU7CisK
KwkJCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5naW5lKGk5MTUsIGUpIHsKKwkJCQlpZiAoIWdlbV9j
bGFzc19jYW5fc3RvcmVfZHdvcmQoaTkxNSwgZS0+Y2xhc3MpKQorCQkJCQljb250aW51ZTsKKwor
CQkJCWlndF9keW5hbWljX2YoIiVzIiwgZS0+bmFtZSkKKwkJCQkJZmFpcm5lc3MoaTkxNSwgZSwg
dGltZW91dCwgZi0+ZmxhZ3MpOworCQkJfQorCQl9CisJfQorfQorCitzdGF0aWMgdWludDMyX3Qg
cmVhZF9jdHhfdGltZXN0YW1wKGludCBpOTE1LAorCQkJCSAgIHVpbnQzMl90IGN0eCwKKwkJCQkg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUpCit7CisJY29uc3QgaW50
IHVzZV82NGIgPSBpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChpOTE1KSkgPj0gODsKKwlj
b25zdCB1aW50MzJfdCBiYXNlID0gZ2VtX2VuZ2luZV9tbWlvX2Jhc2UoaTkxNSwgZS0+bmFtZSk7
CisJc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5IHJlbG9jOworCXN0cnVjdCBk
cm1faTkxNV9nZW1fZXhlY19vYmplY3QyIG9iaiA9IHsKKwkJLmhhbmRsZSA9IGdlbV9jcmVhdGUo
aTkxNSwgNDA5NiksCisJCS5vZmZzZXQgPSAzMiA8PCAyMCwKKwkJLnJlbG9jc19wdHIgPSB0b191
c2VyX3BvaW50ZXIoJnJlbG9jKSwKKwkJLnJlbG9jYXRpb25fY291bnQgPSAxLAorCX07CisJc3Ry
dWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVmID0geworCQkuYnVmZmVyc19wdHIg
PSB0b191c2VyX3BvaW50ZXIoJm9iaiksCisJCS5idWZmZXJfY291bnQgPSAxLAorCQkuZmxhZ3Mg
PSBlLT5mbGFncywKKwkJLnJzdmQxID0gY3R4LAorCX07CisjZGVmaW5lIFJVTlRJTUUgKGJhc2Ug
KyAweDNhOCkKKwl1aW50MzJfdCAqbWFwLCAqY3M7CisJdWludDMyX3QgdHM7CisKKwlpZ3RfcmVx
dWlyZShiYXNlKTsKKworCWNzID0gbWFwID0gZ2VtX21tYXBfX2RldmljZV9jb2hlcmVudChpOTE1
LCBvYmouaGFuZGxlLAorCQkJCQkgICAgIDAsIDQwOTYsIFBST1RfV1JJVEUpOworCisJKmNzKysg
PSAweDI0IDw8IDIzIHwgKDEgKyB1c2VfNjRiKTsgLyogU1JNICovCisJKmNzKysgPSBSVU5USU1F
OworCW1lbXNldCgmcmVsb2MsIDAsIHNpemVvZihyZWxvYykpOworCXJlbG9jLnRhcmdldF9oYW5k
bGUgPSBvYmouaGFuZGxlOworCXJlbG9jLnByZXN1bWVkX29mZnNldCA9IG9iai5vZmZzZXQ7CisJ
cmVsb2Mub2Zmc2V0ID0gb2Zmc2V0X2luX3BhZ2UoY3MpOworCXJlbG9jLmRlbHRhID0gNDAwMDsK
KwkqY3MrKyA9IG9iai5vZmZzZXQgKyA0MDAwOworCSpjcysrID0gb2JqLm9mZnNldCA+PiAzMjsK
KworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWdlbV9leGVjYnVmKGk5MTUsICZl
eGVjYnVmKTsKKwlnZW1fc3luYyhpOTE1LCBvYmouaGFuZGxlKTsKKwlnZW1fY2xvc2UoaTkxNSwg
b2JqLmhhbmRsZSk7CisKKwl0cyA9IG1hcFsxMDAwXTsKKwltdW5tYXAobWFwLCA0MDk2KTsKKwor
CXJldHVybiB0czsKK30KKworc3RhdGljIHZvaWQgZmFpcnNsaWNlKGludCBpOTE1LAorCQkgICAg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUsCisJCSAgICAgIHVuc2ln
bmVkIGxvbmcgZmxhZ3MpCit7CisJaWd0X3NwaW5fdCAqc3BpbiA9IE5VTEw7CisJdWludDMyX3Qg
Y3R4WzNdOworCXVpbnQzMl90IHRzWzNdOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKGN0eCk7IGkrKykgeworCQljdHhbaV0gPSBnZW1fY29udGV4dF9jbG9uZV93aXRoX2VuZ2lu
ZXMoaTkxNSwgMCk7CisJCWlmIChzcGluID09IE5VTEwpIHsKKwkJCXNwaW4gPSBfX2lndF9zcGlu
X25ldyhpOTE1LAorCQkJCQkgICAgICAuY3R4ID0gY3R4W2ldLAorCQkJCQkgICAgICAuZW5naW5l
ID0gZS0+ZmxhZ3MsCisJCQkJCSAgICAgIC5mbGFncyA9IGZsYWdzKTsKKwkJfSBlbHNlIHsKKwkJ
CXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZWIgPSB7CisJCQkJLmJ1ZmZlcl9jb3Vu
dCA9IDEsCisJCQkJLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2ludGVyKCZzcGluLT5vYmpbSUdU
X1NQSU5fQkFUQ0hdKSwKKwkJCQkuZmxhZ3MgPSBlLT5mbGFncywKKwkJCQkucnN2ZDEgPSBjdHhb
aV0sCisJCQl9OworCQkJZ2VtX2V4ZWNidWYoaTkxNSwgJmViKTsKKwkJfQorCX0KKworCXNsZWVw
KDIpOyAvKiBvdmVyIHRoZSBjb3Vyc2Ugb2YgbWFueSB0aW1lc2xpY2VzICovCisKKwlpZ3RfYXNz
ZXJ0KGdlbV9ib19idXN5KGk5MTUsIHNwaW4tPmhhbmRsZSkpOworCWlndF9zcGluX2VuZChzcGlu
KTsKKwlmb3IgKGludCBpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3R4KTsgaSsrKQorCQl0c1tpXSA9
IHJlYWRfY3R4X3RpbWVzdGFtcChpOTE1LCBjdHhbaV0sIGUpOworCisJZm9yIChpbnQgaSA9IDA7
IGkgPCBBUlJBWV9TSVpFKGN0eCk7IGkrKykKKwkJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBj
dHhbaV0pOworCWlndF9zcGluX2ZyZWUoaTkxNSwgc3Bpbik7CisKKwlxc29ydCh0cywgMywgc2l6
ZW9mKCp0cyksIGNtcF91MzIpOworCWlndF9pbmZvKCIlczogWyUuMWYsICUuMWYsICUuMWZdIG1z
XG4iLCBlLT5uYW1lLAorCQkgMWUtNiAqIHRpY2tzX3RvX25zKGk5MTUsIHRzWzBdKSwKKwkJIDFl
LTYgKiB0aWNrc190b19ucyhpOTE1LCB0c1sxXSksCisJCSAxZS02ICogdGlja3NfdG9fbnMoaTkx
NSwgdHNbMl0pKTsKKworCWlndF9hc3NlcnRfZih0c1syXSwgIkNUWF9USU1FU1RBTVAgbm90IHJl
cG9ydGVkIVxuIik7CisJaWd0X2Fzc2VydF9mKCh0c1syXSAtIHRzWzBdKSAqIDYgPCB0c1sxXSwK
KwkJICAgICAiUmFuZ2Ugb2YgdGltZXNsaWNlcyBncmVhdGVyIHRoYW4gdG9sZXJhYmxlOiAlLjJm
bXMgPiAlLjJmbXM7IHVuZmFpciFcbiIsCisJCSAgICAgMWUtNiAqIHRpY2tzX3RvX25zKGk5MTUs
IHRzWzJdIC0gdHNbMF0pLAorCQkgICAgIDFlLTYgKiB0aWNrc190b19ucyhpOTE1LCB0c1sxXSkg
LyA2KTsKK30KKwogI2RlZmluZSB0ZXN0X2VhY2hfZW5naW5lKFQsIGk5MTUsIGUpIFwKIAlpZ3Rf
c3VidGVzdF93aXRoX2R5bmFtaWMoVCkgX19mb3JfZWFjaF9waHlzaWNhbF9lbmdpbmUoaTkxNSwg
ZSkgXAogCQlpZ3RfZHluYW1pY19mKCIlcyIsIGUtPm5hbWUpCkBAIC0yNTgyLDYgKzM0NjAsMzUg
QEAgaWd0X21haW4KIAkJdGVzdF9lYWNoX2VuZ2luZSgibGF0ZXNsaWNlIiwgZmQsIGUpCiAJCQls
YXRlc2xpY2UoZmQsIGUtPmZsYWdzKTsKIAorCQlpZ3Rfc3VidGVzdF9ncm91cCB7CisJCQlpZ3Rf
Zml4dHVyZSB7CisJCQkJaWd0X3JlcXVpcmUoZ2VtX3NjaGVkdWxlcl9oYXNfc2VtYXBob3Jlcyhm
ZCkpOworCQkJCWlndF9yZXF1aXJlKGdlbV9zY2hlZHVsZXJfaGFzX3ByZWVtcHRpb24oZmQpKTsK
KwkJCQlpZ3RfcmVxdWlyZShpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChmZCkpID49IDgp
OworCQkJfQorCisJCQl0ZXN0X2VhY2hfZW5naW5lKCJmYWlyc2xpY2UiLCBmZCwgZSkKKwkJCQlm
YWlyc2xpY2UoZmQsIGUsIDApOworCisJCQl0ZXN0X2VhY2hfZW5naW5lKCJ1LWZhaXJzbGljZSIs
IGZkLCBlKQorCQkJCWZhaXJzbGljZShmZCwgZSwgSUdUX1NQSU5fVVNFUlBUUik7CisKKwkJCWln
dF9zdWJ0ZXN0KCJmYWlyc2xpY2UtYWxsIikgIHsKKwkJCQlfX2Zvcl9lYWNoX3BoeXNpY2FsX2Vu
Z2luZShmZCwgZSkgeworCQkJCQlpZ3RfZm9yayhjaGlsZCwgMSkKKwkJCQkJCWZhaXJzbGljZShm
ZCwgZSwgMCk7CisJCQkJfQorCQkJCWlndF93YWl0Y2hpbGRyZW4oKTsKKwkJCX0KKwkJCWlndF9z
dWJ0ZXN0KCJ1LWZhaXJzbGljZS1hbGwiKSAgeworCQkJCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5n
aW5lKGZkLCBlKSB7CisJCQkJCWlndF9mb3JrKGNoaWxkLCAxKQorCQkJCQkJZmFpcnNsaWNlKGZk
LCBlLCBJR1RfU1BJTl9VU0VSUFRSKTsKKwkJCQl9CisJCQkJaWd0X3dhaXRjaGlsZHJlbigpOwor
CQkJfQorCQl9CisKIAkJdGVzdF9lYWNoX2VuZ2luZSgic3VibWl0LWVhcmx5LXNsaWNlIiwgZmQs
IGUpCiAJCQlzdWJtaXRfc2xpY2UoZmQsIGUsIEVBUkxZX1NVQk1JVCk7CiAJCXRlc3RfZWFjaF9l
bmdpbmUoInN1Ym1pdC1nb2xkZW4tc2xpY2UiLCBmZCwgZSkKQEAgLTI2MTAsNiArMzUxNywxMCBA
QCBpZ3RfbWFpbgogCQl0ZXN0X2VhY2hfZW5naW5lX3N0b3JlKCJwcm9tb3Rpb24iLCBmZCwgZSkK
IAkJCXByb21vdGlvbihmZCwgZS0+ZmxhZ3MpOwogCisJCWlndF9zdWJ0ZXN0X2dyb3VwIHsKKwkJ
CXRlc3RfZmFpcm5lc3MoZmQsIDIpOworCQl9CisKIAkJaWd0X3N1YnRlc3RfZ3JvdXAgewogCQkJ
aWd0X2ZpeHR1cmUgewogCQkJCWlndF9yZXF1aXJlKGdlbV9zY2hlZHVsZXJfaGFzX3ByZWVtcHRp
b24oZmQpKTsKLS0gCjIuMjkuMgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4Cg==

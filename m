Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2B93BEA2A7
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 18:33:28 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7B4D56EAED;
	Wed, 30 Oct 2019 17:33:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 189C26EAED
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 17:33:25 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 30 Oct 2019 10:33:24 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,248,1569308400"; d="scan'208";a="194040639"
Received: from sslose-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.3.112])
 by orsmga008.jf.intel.com with ESMTP; 30 Oct 2019 10:33:22 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Oct 2019 17:33:20 +0000
Message-Id: <20191030173320.8850-1-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/lmem: add the fake lmem region
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW50ZW5kZWQgZm9yIHVwc3RyZWFtIHRlc3Rpbmcgc28gdGhhdCB3ZSBjYW4gc3RpbGwgZXhlcmNp
c2UgdGhlIExNRU0KcGx1bWJpbmcgYW5kICFpOTE1X2dndHRfaGFzX2FwZXJ0dXJlIHBhdGhzLiBT
bW9rZSB0ZXN0ZWQgb24gU2t1bGwgQ2FueW9uCmRldmljZS4gVGhpcyB3b3JrcyBieSBhbGxvY2F0
aW5nIGFuIGludGVsX21lbW9yeV9yZWdpb24gZm9yIGEgcmVzZXJ2ZWQKcG9ydGlvbiBvZiBzeXN0
ZW0gbWVtb3J5LCB3aGljaCB3ZSB0cmVhdCBsaWtlIExNRU0uIEZvciB0aGUgTE1FTUJBUiB3ZQpz
dGVhbCB0aGUgYXBlcnR1cmUgYW5kIDE6MSBpdCBtYXAgdG8gdGhlIHN0b2xlbiByZWdpb24uCgpU
byBlbmFibGUgc2ltcGx5IHNldCB0aGUgaTkxNSBtb2RwYXJhbSBmYWtlX2xtZW1fc3RhcnQ9IG9u
IHRoZSBrZXJuZWwKY21kbGluZSB3aXRoIHRoZSBzdGFydCBvZiByZXNlcnZlZCByZWdpb24oc2Vl
IG1lbW1hcD0pLiBUaGUgc2l6ZSBvZiB0aGUKcmVnaW9uIHdlIGNhbiB1c2UgaXMgZGV0ZXJtaW5l
ZCBieSB0aGUgc2l6ZSBvZiB0aGUgbWFwcGFibGUgYXBlcnR1cmUsIHNvCnRoZSBzaXplIG9mIHJl
c2VydmVkIHJlZ2lvbiBzaG91bGQgYmUgPj0gbWFwcGFibGVfZW5kLiBGb3Igbm93IHdlIG9ubHkK
ZW5hYmxlIGZvciB0aGUgc2VsZnRlc3RzLiBEZXBlbmRzIG9uIENPTkZJR19EUk1fSTkxNV9VTlNU
QUJMRSBiZWluZwplbmFibGVkLgoKZWcuIG1lbW1hcD0yRyQxNkcgaTkxNS5mYWtlX2xtZW1fc3Rh
cnQ9MHg0MDAwMDAwMDAKCnYyOiBtYWtlIGZha2VfbG1lbV9zdGFydCBhbiBpOTE1IG1vZHBhcmFt
CgpTaWduZWQtb2ZmLWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+CkNj
OiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBB
YmRpZWwgSmFudWxndWUgPGFiZGllbC5qYW51bGd1ZUBsaW51eC5pbnRlbC5jb20+CkNjOiBBcmth
ZGl1c3ogSGlsZXIgPGFya2FkaXVzei5oaWxlckBpbnRlbC5jb20+CkNjOiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29u
ZmlnLnVuc3RhYmxlICAgICAgfCAgOCArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2xtZW0uYyAgIHwgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAg
ICAgICAgIHwgMTUgKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wYXJhbXMuYyAgICAg
ICAgIHwgIDcgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGFyYW1zLmggICAgICAgICB8
ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uYyB8ICAzICsK
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uaCB8ICA2ICsrCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5jICAgfCA5MiArKysrKysrKysrKysr
KysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5oICAgfCAg
NSArKwogOSBmaWxlcyBjaGFuZ2VkLCAxNDAgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L0tjb25maWcudW5zdGFibGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9LY29uZmlnLnVuc3RhYmxlCmluZGV4IGNmMTUxYTI5N2VkNy4uYjBlNTM3Mjk1OWExIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9LY29uZmlnLnVuc3RhYmxlCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L0tjb25maWcudW5zdGFibGUKQEAgLTE5LDMgKzE5LDExIEBAIGNvbmZp
ZyBEUk1fSTkxNV9VTlNUQUJMRQogCSAgUmVjb21tZW5kZWQgZm9yIGRyaXZlciBkZXZlbG9wZXJz
IF9vbmx5Xy4KIAogCSAgSWYgaW4gdGhlIHNsaWdodGVzdCBiaXQgb2YgZG91YnQsIHNheSAiTiIu
CisKK2NvbmZpZyBEUk1fSTkxNV9VTlNUQUJMRV9GQUtFX0xNRU0KKwlib29sICJFbmFibGUgdGhl
IGV4cGVyaW1lbnRhbCBmYWtlIGxtZW0iCisJZGVwZW5kcyBvbiBEUk1fSTkxNV9VTlNUQUJMRQor
CWRlZmF1bHQgbgorCWhlbHAKKyAgICAgICAgICBDb252ZXJ0IHNvbWUgc3lzdGVtIG1lbW9yeSBp
bnRvIGEgZmFrZSBsb2NhbCBtZW1vcnkgcmVnaW9uIGZvcgorCSAgdGVzdGluZy4KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9sbWVtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbG1lbS5jCmluZGV4IDkyNmY2Yzk0MGUwZC4uMGUyYmY2
YjdlMTQzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbG1l
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9sbWVtLmMKQEAgLTI0
LDYgKzI0LDcgQEAgaTkxNV9nZW1fb2JqZWN0X2xtZW1faW9fbWFwX3BhZ2Uoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKIAlyZXNvdXJjZV9zaXplX3Qgb2Zmc2V0OwogCiAJb2Zmc2V0
ID0gaTkxNV9nZW1fb2JqZWN0X2dldF9kbWFfYWRkcmVzcyhvYmosIG4pOworCW9mZnNldCAtPSBv
YmotPm1tLnJlZ2lvbi0+cmVnaW9uLnN0YXJ0OwogCiAJcmV0dXJuIGlvX21hcHBpbmdfbWFwX3dj
KCZvYmotPm1tLnJlZ2lvbi0+aW9tYXAsIG9mZnNldCwgUEFHRV9TSVpFKTsKIH0KQEAgLTM1LDYg
KzM2LDcgQEAgaTkxNV9nZW1fb2JqZWN0X2xtZW1faW9fbWFwX3BhZ2VfYXRvbWljKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJcmVzb3VyY2Vfc2l6ZV90IG9mZnNldDsKIAogCW9m
ZnNldCA9IGk5MTVfZ2VtX29iamVjdF9nZXRfZG1hX2FkZHJlc3Mob2JqLCBuKTsKKwlvZmZzZXQg
LT0gb2JqLT5tbS5yZWdpb24tPnJlZ2lvbi5zdGFydDsKIAogCXJldHVybiBpb19tYXBwaW5nX21h
cF9hdG9taWNfd2MoJm9iai0+bW0ucmVnaW9uLT5pb21hcCwgb2Zmc2V0KTsKIH0KQEAgLTQ5LDYg
KzUxLDcgQEAgaTkxNV9nZW1fb2JqZWN0X2xtZW1faW9fbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2lzX2NvbnRpZ3VvdXMo
b2JqKSk7CiAKIAlvZmZzZXQgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X2RtYV9hZGRyZXNzKG9iaiwg
bik7CisJb2Zmc2V0IC09IG9iai0+bW0ucmVnaW9uLT5yZWdpb24uc3RhcnQ7CiAKIAlyZXR1cm4g
aW9fbWFwcGluZ19tYXBfd2MoJm9iai0+bW0ucmVnaW9uLT5pb21hcCwgb2Zmc2V0LCBzaXplKTsK
IH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCmluZGV4IDIxMjczYjUxNmRiZS4uNDgwZTIwNTRmNjI4
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTE0ODMsNiArMTQ4MywyMSBAQCBpbnQgaTkx
NV9kcml2ZXJfcHJvYmUoc3RydWN0IHBjaV9kZXYgKnBkZXYsIGNvbnN0IHN0cnVjdCBwY2lfZGV2
aWNlX2lkICplbnQpCiAJaWYgKCFpOTE1X21vZHBhcmFtcy5udWNsZWFyX3BhZ2VmbGlwICYmIG1h
dGNoX2luZm8tPmdlbiA8IDUpCiAJCWRldl9wcml2LT5kcm0uZHJpdmVyX2ZlYXR1cmVzICY9IH5E
UklWRVJfQVRPTUlDOwogCisJLyoKKwkgKiBDaGVjayBpZiB3ZSBzdXBwb3J0IGZha2UgTE1FTSAt
LSBmb3Igbm93IHdlIG9ubHkgdW5sZWFzaCB0aGlzIGZvcgorCSAqIHRoZSBsaXZlIHNlbGZ0ZXN0
cyh0ZXN0LWFuZC1leGl0KS4KKwkgKi8KKwlpZiAoSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVf
VU5TVEFCTEVfRkFLRV9MTUVNKSkgeworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5ICYm
IGk5MTVfc2VsZnRlc3QubGl2ZSA8IDAgJiYKKwkJICAgIGk5MTVfbW9kcGFyYW1zLmZha2VfbG1l
bV9zdGFydCkgeworCQkJbWt3cml0ZV9kZXZpY2VfaW5mbyhkZXZfcHJpdiktPm1lbW9yeV9yZWdp
b25zID0KKwkJCQlSRUdJT05fU01FTSB8IFJFR0lPTl9MTUVNIHwgUkVHSU9OX1NUT0xFTjsKKwkJ
CW1rd3JpdGVfZGV2aWNlX2luZm8oZGV2X3ByaXYpLT5pc19kZ2Z4ID0gdHJ1ZTsKKwkJCUdFTV9C
VUdfT04oIUhBU19MTUVNKGRldl9wcml2KSk7CisJCQlHRU1fQlVHX09OKCFJU19ER0ZYKGRldl9w
cml2KSk7CisJCX0KKwl9CisKIAlyZXQgPSBwY2lfZW5hYmxlX2RldmljZShwZGV2KTsKIAlpZiAo
cmV0KQogCQlnb3RvIG91dF9maW5pOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9wYXJhbXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGFyYW1zLmMKaW5kZXgg
M2ZhNzlhZGIyYzFjLi4xZGQxZjM2NTI3OTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGFyYW1zLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wYXJhbXMu
YwpAQCAtMTc5LDYgKzE3OSwxMSBAQCBpOTE1X3BhcmFtX25hbWVkKGVuYWJsZV9ndnQsIGJvb2ws
IDA0MDAsCiAJIkVuYWJsZSBzdXBwb3J0IGZvciBJbnRlbCBHVlQtZyBncmFwaGljcyB2aXJ0dWFs
aXphdGlvbiBob3N0IHN1cHBvcnQoZGVmYXVsdDpmYWxzZSkiKTsKICNlbmRpZgogCisjaWYgSVNf
RU5BQkxFRChDT05GSUdfRFJNX0k5MTVfVU5TVEFCTEVfRkFLRV9MTUVNKQoraTkxNV9wYXJhbV9u
YW1lZF91bnNhZmUoZmFrZV9sbWVtX3N0YXJ0LCB1bG9uZywgMDYwMCwKKwkiRmFrZSBMTUVNIHN0
YXJ0IG9mZnNldCAoZGVmYXVsdDogMCkiKTsKKyNlbmRpZgorCiBzdGF0aWMgX19hbHdheXNfaW5s
aW5lIHZvaWQgX3ByaW50X3BhcmFtKHN0cnVjdCBkcm1fcHJpbnRlciAqcCwKIAkJCQkJIGNvbnN0
IGNoYXIgKm5hbWUsCiAJCQkJCSBjb25zdCBjaGFyICp0eXBlLApAQCAtMTkwLDYgKzE5NSw4IEBA
IHN0YXRpYyBfX2Fsd2F5c19pbmxpbmUgdm9pZCBfcHJpbnRfcGFyYW0oc3RydWN0IGRybV9wcmlu
dGVyICpwLAogCQlkcm1fcHJpbnRmKHAsICJpOTE1LiVzPSVkXG4iLCBuYW1lLCAqKGNvbnN0IGlu
dCAqKXgpOwogCWVsc2UgaWYgKCFfX2J1aWx0aW5fc3RyY21wKHR5cGUsICJ1bnNpZ25lZCBpbnQi
KSkKIAkJZHJtX3ByaW50ZihwLCAiaTkxNS4lcz0ldVxuIiwgbmFtZSwgKihjb25zdCB1bnNpZ25l
ZCBpbnQgKil4KTsKKwllbHNlIGlmICghX19idWlsdGluX3N0cmNtcCh0eXBlLCAidW5zaWduZWQg
bG9uZyIpKQorCQlkcm1fcHJpbnRmKHAsICJpOTE1LiVzPSVsdVxuIiwgbmFtZSwgKihjb25zdCB1
bnNpZ25lZCBsb25nICopeCk7CiAJZWxzZSBpZiAoIV9fYnVpbHRpbl9zdHJjbXAodHlwZSwgImNo
YXIgKiIpKQogCQlkcm1fcHJpbnRmKHAsICJpOTE1LiVzPSVzXG4iLCBuYW1lLCAqKGNvbnN0IGNo
YXIgKiopeCk7CiAJZWxzZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
YXJhbXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGFyYW1zLmgKaW5kZXggYTI3NjMx
N2FkNzRiLi4zMWI4OGYyOTdmYmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcGFyYW1zLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wYXJhbXMuaApAQCAt
NjYsNiArNjYsNyBAQCBzdHJ1Y3QgZHJtX3ByaW50ZXI7CiAJcGFyYW0oaW50LCBmYXN0Ym9vdCwg
LTEpIFwKIAlwYXJhbShpbnQsIGVuYWJsZV9kcGNkX2JhY2tsaWdodCwgMCkgXAogCXBhcmFtKGNo
YXIgKiwgZm9yY2VfcHJvYmUsIENPTkZJR19EUk1fSTkxNV9GT1JDRV9QUk9CRSkgXAorCXBhcmFt
KHVuc2lnbmVkIGxvbmcsIGZha2VfbG1lbV9zdGFydCwgMCkgXAogCS8qIGxlYXZlIGJvb2xzIGF0
IHRoZSBlbmQgdG8gbm90IGNyZWF0ZSBob2xlcyAqLyBcCiAJcGFyYW0oYm9vbCwgYWxwaGFfc3Vw
cG9ydCwgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfQUxQSEFfU1VQUE9SVCkpIFwKIAlwYXJh
bShib29sLCBlbmFibGVfaGFuZ2NoZWNrLCB0cnVlKSBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9tZW1vcnlfcmVnaW9uLmMKaW5kZXggYTYwZjc3ZmY1OGQ0Li5iYWFlYWVjYzY0YWYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmMKQEAgLTIyOCw2ICsy
MjgsOSBAQCBpbnQgaW50ZWxfbWVtb3J5X3JlZ2lvbnNfaHdfcHJvYmUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJCWNhc2UgSU5URUxfTUVNT1JZX1NUT0xFTjoKIAkJCW1lbSA9IGk5
MTVfZ2VtX3N0b2xlbl9zZXR1cChpOTE1KTsKIAkJCWJyZWFrOworCQljYXNlIElOVEVMX01FTU9S
WV9MT0NBTDoKKwkJCW1lbSA9IGludGVsX3NldHVwX2Zha2VfbG1lbShpOTE1KTsKKwkJCWJyZWFr
OwogCQl9CiAKIAkJaWYgKElTX0VSUihtZW0pKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9tZW1vcnlfcmVnaW9uLmgKaW5kZXggMTk5MjBjMjU2ZWRlLi4yMzg3MjIwMDk2NzcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmgKQEAgLTEwLDYgKzEwLDcg
QEAKICNpbmNsdWRlIDxsaW51eC9pb3BvcnQuaD4KICNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgog
I2luY2x1ZGUgPGxpbnV4L2lvLW1hcHBpbmcuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX21tLmg+CiAK
ICNpbmNsdWRlICJpOTE1X2J1ZGR5LmgiCiAKQEAgLTcxLDYgKzcyLDkgQEAgc3RydWN0IGludGVs
X21lbW9yeV9yZWdpb24gewogCXN0cnVjdCBpb19tYXBwaW5nIGlvbWFwOwogCXN0cnVjdCByZXNv
dXJjZSByZWdpb247CiAKKwkvKiBGb3IgZmFrZSBMTUVNICovCisJc3RydWN0IGRybV9tbV9ub2Rl
IGZha2VfbWFwcGFibGU7CisKIAlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKIAlzdHJ1Y3QgbXV0
ZXggbW1fbG9jazsKIApAQCAtODMsNiArODcsOCBAQCBzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lv
biB7CiAJdW5zaWduZWQgaW50IGluc3RhbmNlOwogCXVuc2lnbmVkIGludCBpZDsKIAorCWRtYV9h
ZGRyX3QgcmVtYXBfYWRkcjsKKwogCXN0cnVjdCB7CiAJCXN0cnVjdCBtdXRleCBsb2NrOyAvKiBQ
cm90ZWN0cyBhY2Nlc3MgdG8gb2JqZWN0cyAqLwogCQlzdHJ1Y3QgbGlzdF9oZWFkIGxpc3Q7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcmVnaW9uX2xtZW0uYwppbmRleCA5YTM1MWFmNDVjZTYu
LjU4MzExODA5NTYzNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcmVn
aW9uX2xtZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5j
CkBAIC05LDkgKzksNjIgQEAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcmVnaW9uLmgiCiAjaW5j
bHVkZSAiaW50ZWxfcmVnaW9uX2xtZW0uaCIKIAorc3RhdGljIGludCBpbml0X2Zha2VfbG1lbV9i
YXIoc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1lbSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IG1lbS0+aTkxNTsKKwlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmk5
MTUtPmdndHQ7CisJdW5zaWduZWQgbG9uZyBuOworCWludCByZXQ7CisKKwkvKiBXZSB3YW50IHRv
IDE6MSBtYXAgdGhlIG1hcHBhYmxlIGFwZXJ0dXJlIHRvIG91ciByZXNlcnZlZCByZWdpb24gKi8K
KworCW1lbS0+ZmFrZV9tYXBwYWJsZS5zdGFydCA9IDA7CisJbWVtLT5mYWtlX21hcHBhYmxlLnNp
emUgPSByZXNvdXJjZV9zaXplKCZtZW0tPnJlZ2lvbik7CisJbWVtLT5mYWtlX21hcHBhYmxlLmNv
bG9yID0gSTkxNV9DT0xPUl9VTkVWSUNUQUJMRTsKKworCXJldCA9IGRybV9tbV9yZXNlcnZlX25v
ZGUoJmdndHQtPnZtLm1tLCAmbWVtLT5mYWtlX21hcHBhYmxlKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OworCisJbWVtLT5yZW1hcF9hZGRyID0gZG1hX21hcF9yZXNvdXJjZSgmaTkxNS0+ZHJt
LnBkZXYtPmRldiwKKwkJCQkJICAgbWVtLT5yZWdpb24uc3RhcnQsCisJCQkJCSAgIG1lbS0+ZmFr
ZV9tYXBwYWJsZS5zaXplLAorCQkJCQkgICBQQ0lfRE1BX0JJRElSRUNUSU9OQUwsCisJCQkJCSAg
IERNQV9BVFRSX0ZPUkNFX0NPTlRJR1VPVVMpOworCWlmIChkbWFfbWFwcGluZ19lcnJvcigmaTkx
NS0+ZHJtLnBkZXYtPmRldiwgbWVtLT5yZW1hcF9hZGRyKSkgeworCQlkcm1fbW1fcmVtb3ZlX25v
ZGUoJm1lbS0+ZmFrZV9tYXBwYWJsZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWZvciAo
biA9IDA7IG4gPCBtZW0tPmZha2VfbWFwcGFibGUuc2l6ZSA+PiBQQUdFX1NISUZUOyArK24pIHsK
KwkJZ2d0dC0+dm0uaW5zZXJ0X3BhZ2UoJmdndHQtPnZtLAorCQkJCSAgICAgbWVtLT5yZW1hcF9h
ZGRyICsgKG4gPDwgUEFHRV9TSElGVCksCisJCQkJICAgICBuIDw8IFBBR0VfU0hJRlQsCisJCQkJ
ICAgICBJOTE1X0NBQ0hFX05PTkUsIDApOworCX0KKworCW1lbS0+cmVnaW9uID0gKHN0cnVjdCBy
ZXNvdXJjZSlERUZJTkVfUkVTX01FTShtZW0tPnJlbWFwX2FkZHIsCisJCQkJCQkgICAgICBtZW0t
PmZha2VfbWFwcGFibGUuc2l6ZSk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZvaWQgcmVs
ZWFzZV9mYWtlX2xtZW1fYmFyKHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9uICptZW0pCit7CisJ
aWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmbWVtLT5mYWtlX21hcHBhYmxlKSkKKwkJZHJtX21t
X3JlbW92ZV9ub2RlKCZtZW0tPmZha2VfbWFwcGFibGUpOworCisJZG1hX3VubWFwX3Jlc291cmNl
KCZtZW0tPmk5MTUtPmRybS5wZGV2LT5kZXYsCisJCQkgICBtZW0tPnJlbWFwX2FkZHIsCisJCQkg
ICBtZW0tPmZha2VfbWFwcGFibGUuc2l6ZSwKKwkJCSAgIFBDSV9ETUFfQklESVJFQ1RJT05BTCwK
KwkJCSAgIERNQV9BVFRSX0ZPUkNFX0NPTlRJR1VPVVMpOworfQorCiBzdGF0aWMgdm9pZAogcmVn
aW9uX2xtZW1fcmVsZWFzZShzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtKQogeworCXJl
bGVhc2VfZmFrZV9sbWVtX2JhcihtZW0pOwogCWlvX21hcHBpbmdfZmluaSgmbWVtLT5pb21hcCk7
CiAJaW50ZWxfbWVtb3J5X3JlZ2lvbl9yZWxlYXNlX2J1ZGR5KG1lbSk7CiB9CkBAIC0yMSw2ICs3
NCwxMSBAQCByZWdpb25fbG1lbV9pbml0KHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9uICptZW0p
CiB7CiAJaW50IHJldDsKIAorCWlmIChpOTE1X21vZHBhcmFtcy5mYWtlX2xtZW1fc3RhcnQpIHsK
KwkJcmV0ID0gaW5pdF9mYWtlX2xtZW1fYmFyKG1lbSk7CisJCUdFTV9CVUdfT04ocmV0KTsKKwl9
CisKIAlpZiAoIWlvX21hcHBpbmdfaW5pdF93YygmbWVtLT5pb21hcCwKIAkJCQltZW0tPmlvX3N0
YXJ0LAogCQkJCXJlc291cmNlX3NpemUoJm1lbS0+cmVnaW9uKSkpCkBAIC0zOCwzICs5NiwzNyBA
QCBjb25zdCBzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbl9vcHMgaW50ZWxfcmVnaW9uX2xtZW1f
b3BzID0gewogCS5yZWxlYXNlID0gcmVnaW9uX2xtZW1fcmVsZWFzZSwKIAkuY3JlYXRlX29iamVj
dCA9IF9faTkxNV9nZW1fbG1lbV9vYmplY3RfY3JlYXRlLAogfTsKKworc3RydWN0IGludGVsX21l
bW9yeV9yZWdpb24gKgoraW50ZWxfc2V0dXBfZmFrZV9sbWVtKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQoreworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CisJ
c3RydWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1lbTsKKwlyZXNvdXJjZV9zaXplX3QgbWFwcGFi
bGVfZW5kOworCXJlc291cmNlX3NpemVfdCBpb19zdGFydDsKKwlyZXNvdXJjZV9zaXplX3Qgc3Rh
cnQ7CisKKwlHRU1fQlVHX09OKGk5MTVfZ2d0dF9oYXNfYXBlcnR1cmUoJmk5MTUtPmdndHQpKTsK
KwlHRU1fQlVHX09OKCFpOTE1X21vZHBhcmFtcy5mYWtlX2xtZW1fc3RhcnQpOworCisJLyogWW91
ciBtYXBwYWJsZSBhcGVydHVyZSBiZWxvbmdzIHRvIG1lIG5vdyEgKi8KKwltYXBwYWJsZV9lbmQg
PSBwY2lfcmVzb3VyY2VfbGVuKHBkZXYsIDIpOworCWlvX3N0YXJ0ID0gcGNpX3Jlc291cmNlX3N0
YXJ0KHBkZXYsIDIpLAorCXN0YXJ0ID0gaTkxNV9tb2RwYXJhbXMuZmFrZV9sbWVtX3N0YXJ0Owor
CisJbWVtID0gaW50ZWxfbWVtb3J5X3JlZ2lvbl9jcmVhdGUoaTkxNSwKKwkJCQkJIHN0YXJ0LAor
CQkJCQkgbWFwcGFibGVfZW5kLAorCQkJCQkgUEFHRV9TSVpFLAorCQkJCQkgaW9fc3RhcnQsCisJ
CQkJCSAmaW50ZWxfcmVnaW9uX2xtZW1fb3BzKTsKKwlpZiAoIUlTX0VSUihtZW0pKSB7CisJCURS
TV9JTkZPKCJJbnRlbCBncmFwaGljcyBmYWtlIExNRU06ICVwUlxuIiwgJm1lbS0+cmVnaW9uKTsK
KwkJRFJNX0lORk8oIkludGVsIGdyYXBoaWNzIGZha2UgTE1FTSBJTyBzdGFydDogJWxseFxuIiwK
KwkJCSAodTY0KW1lbS0+aW9fc3RhcnQpOworCQlEUk1fSU5GTygiSW50ZWwgZ3JhcGhpY3MgZmFr
ZSBMTUVNIHNpemU6ICVsbHhcbiIsCisJCQkgKHU2NClyZXNvdXJjZV9zaXplKCZtZW0tPnJlZ2lv
bikpOworCX0KKworCXJldHVybiBtZW07Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9yZWdpb25fbG1lbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcmVn
aW9uX2xtZW0uaAppbmRleCBlZDJhM2JhYjY0NDMuLjIxM2RlZjdjN2I4YSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcmVnaW9uX2xtZW0uaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9yZWdpb25fbG1lbS5oCkBAIC02LDYgKzYsMTEgQEAKICNpZm5kZWYg
X19JTlRFTF9SRUdJT05fTE1FTV9ICiAjZGVmaW5lIF9fSU5URUxfUkVHSU9OX0xNRU1fSAogCitz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKKwogZXh0ZXJuIGNvbnN0IHN0cnVjdCBpbnRlbF9tZW1v
cnlfcmVnaW9uX29wcyBpbnRlbF9yZWdpb25fbG1lbV9vcHM7CiAKK3N0cnVjdCBpbnRlbF9tZW1v
cnlfcmVnaW9uICoKK2ludGVsX3NldHVwX2Zha2VfbG1lbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSk7CisKICNlbmRpZiAvKiAhX19JTlRFTF9SRUdJT05fTE1FTV9IICovCi0tIAoyLjIw
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

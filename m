Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A82BE37BE3E
	for <lists+intel-gfx@lfdr.de>; Wed, 12 May 2021 15:31:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 036BF6EBA1;
	Wed, 12 May 2021 13:31:09 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8D3EB6EBA1
 for <intel-gfx@lists.freedesktop.org>; Wed, 12 May 2021 13:31:07 +0000 (UTC)
IronPort-SDR: 2raYMM48bFzuM2GtBlgTnoCxlp1ExNBSmwwPK8Y2++/zH24pCYkbSS+sMp7svAAAPOAht2sQs3
 Z/KLCA5c2aFg==
X-IronPort-AV: E=McAfee;i="6200,9189,9981"; a="220678721"
X-IronPort-AV: E=Sophos;i="5.82,293,1613462400"; d="scan'208";a="220678721"
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga101.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 12 May 2021 06:31:01 -0700
IronPort-SDR: bkGjE/JvtskZg9K29PEiWovMiUFC8S6Ya6BQwr6RsBHPenFIiEN0FoaC7R9EKDnCwldoxUMQpY
 rKZ4qZ14HR3w==
X-IronPort-AV: E=Sophos;i="5.82,293,1613462400"; d="scan'208";a="400107673"
Received: from olovaszi-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.252.33.202])
 by fmsmga007-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 12 May 2021 06:30:56 -0700
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 12 May 2021 16:30:44 +0300
Message-Id: <8379bbf2e220b8801670c3300b969bdb18456f0a.1620825897.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1620825897.git.jani.nikula@intel.com>
References: <cover.1620825897.git.jani.nikula@intel.com>
MIME-Version: 1.0
Organization: Intel Finland Oy - BIC 0357606-4 - Westendinkatu 7, 02160 Espoo
Subject: [Intel-gfx] [PATCH 1/3] drm/i915/backlight: extract backlight code
 to a separate file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gYSBsb25nIG92ZXJkdWUgcmVmYWN0b3JpbmcsIHNwbGl0IG91dCBiYWNrbGlnaHQgY29kZSB0
byBuZXcKaW50ZWxfYmFja2xpZ2h0LltjaF0uIFNpbXBsZSBjb2RlIG1vdmVtZW50LCBsZWF2ZSBy
ZW5hbWVzIGZvciBmb2xsb3ctdXAKd29yay4gTm8gZnVuY3Rpb25hbCBjaGFuZ2VzLgoKU2lnbmVk
LW9mZi1ieTogSmFuaSBOaWt1bGEgPGphbmkubmlrdWxhQGludGVsLmNvbT4KLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAgICAgICAgICAgfCAgICAxICsKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvZzR4X2RwLmMgICAgICAgICB8ICAgIDIgKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jICAgICAgICB8ICAgIDEgKwogLi4uL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2JhY2tsaWdodC5jICAgIHwgMTc3OCArKysrKysrKysrKysr
KysrKwogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2JhY2tsaWdodC5oICAgIHwgICA1
MSArCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29ubmVjdG9yLmMgICAgfCAgICA0
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAgfCAgICAy
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCAgICAx
ICsKIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eF9iYWNrbGlnaHQuYyB8ICAgIDIg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHZkcy5jICAgICB8ICAgIDEg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vcHJlZ2lvbi5jIHwgICAgMyAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wYW5lbC5jICAgIHwgMTc2NyAr
LS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVs
LmggICAgfCAgIDMzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9kc2kuYyAg
ICAgICAgfCAgICAxICsKIDE0IGZpbGVzIGNoYW5nZWQsIDE4NDIgaW5zZXJ0aW9ucygrKSwgMTgw
NSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2JhY2tsaWdodC5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9iYWNrbGlnaHQuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5k
ZXggZDBkOTM2ZDkxMzdiLi5hNTg3YTEwODNiODYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC0y
NDQsNiArMjQ0LDcgQEAgaTkxNS15ICs9IFwKIAlkaXNwbGF5L2c0eF9kcC5vIFwKIAlkaXNwbGF5
L2c0eF9oZG1pLm8gXAogCWRpc3BsYXkvaWNsX2RzaS5vIFwKKwlkaXNwbGF5L2ludGVsX2JhY2ts
aWdodC5vIFwKIAlkaXNwbGF5L2ludGVsX2NydC5vIFwKIAlkaXNwbGF5L2ludGVsX2RkaS5vIFwK
IAlkaXNwbGF5L2ludGVsX2RkaV9idWZfdHJhbnMubyBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2c0eF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9nNHhfZHAuYwppbmRleCBkZTBmMzU4MTg0YWEuLjI5YzBlY2E2NDdlMyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9nNHhfZHAuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2c0eF9kcC5jCkBAIC03LDYgKzcsNyBAQAogCiAjaW5jbHVkZSAiZzR4
X2RwLmgiCiAjaW5jbHVkZSAiaW50ZWxfYXVkaW8uaCIKKyNpbmNsdWRlICJpbnRlbF9iYWNrbGln
aHQuaCIKICNpbmNsdWRlICJpbnRlbF9jb25uZWN0b3IuaCIKICNpbmNsdWRlICJpbnRlbF9kZS5o
IgogI2luY2x1ZGUgImludGVsX2Rpc3BsYXlfdHlwZXMuaCIKQEAgLTE2LDcgKzE3LDYgQEAKICNp
bmNsdWRlICJpbnRlbF9maWZvX3VuZGVycnVuLmgiCiAjaW5jbHVkZSAiaW50ZWxfaGRtaS5oIgog
I2luY2x1ZGUgImludGVsX2hvdHBsdWcuaCIKLSNpbmNsdWRlICJpbnRlbF9wYW5lbC5oIgogI2lu
Y2x1ZGUgImludGVsX3Bwcy5oIgogI2luY2x1ZGUgImludGVsX3NpZGViYW5kLmgiCiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMKaW5kZXggY2U1NDRlMjBmMzVjLi41ODZmMjky
YTg4M2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jCkBAIC0yOSw2ICsy
OSw3IEBACiAjaW5jbHVkZSA8ZHJtL2RybV9taXBpX2RzaS5oPgogCiAjaW5jbHVkZSAiaW50ZWxf
YXRvbWljLmgiCisjaW5jbHVkZSAiaW50ZWxfYmFja2xpZ2h0LmgiCiAjaW5jbHVkZSAiaW50ZWxf
Y29tYm9fcGh5LmgiCiAjaW5jbHVkZSAiaW50ZWxfY29ubmVjdG9yLmgiCiAjaW5jbHVkZSAiaW50
ZWxfY3J0Yy5oIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9iYWNrbGlnaHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmFja2xp
Z2h0LmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi40YjAwODZlZTQ4
NTEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2JhY2tsaWdodC5jCkBAIC0wLDAgKzEsMTc3OCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZp
ZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCDCqSAyMDIxIEludGVsIENvcnBvcmF0aW9uCisgKi8K
KworI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgorI2luY2x1ZGUgPGxpbnV4L3B3bS5oPgorCisj
aW5jbHVkZSAiaW50ZWxfYmFja2xpZ2h0LmgiCisjaW5jbHVkZSAiaW50ZWxfY29ubmVjdG9yLmgi
CisjaW5jbHVkZSAiaW50ZWxfZGUuaCIKKyNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgi
CisjaW5jbHVkZSAiaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5oIgorI2luY2x1ZGUgImludGVsX2Rz
aV9kY3NfYmFja2xpZ2h0LmgiCisjaW5jbHVkZSAiaW50ZWxfcGFuZWwuaCIKKworLyoqCisgKiBz
Y2FsZSAtIHNjYWxlIHZhbHVlcyBmcm9tIG9uZSByYW5nZSB0byBhbm90aGVyCisgKiBAc291cmNl
X3ZhbDogdmFsdWUgaW4gcmFuZ2UgW0Bzb3VyY2VfbWluLi5Ac291cmNlX21heF0KKyAqIEBzb3Vy
Y2VfbWluOiBtaW5pbXVtIGxlZ2FsIHZhbHVlIGZvciBAc291cmNlX3ZhbAorICogQHNvdXJjZV9t
YXg6IG1heGltdW0gbGVnYWwgdmFsdWUgZm9yIEBzb3VyY2VfdmFsCisgKiBAdGFyZ2V0X21pbjog
Y29ycmVzcG9uZGluZyB0YXJnZXQgdmFsdWUgZm9yIEBzb3VyY2VfbWluCisgKiBAdGFyZ2V0X21h
eDogY29ycmVzcG9uZGluZyB0YXJnZXQgdmFsdWUgZm9yIEBzb3VyY2VfbWF4CisgKgorICogUmV0
dXJuIEBzb3VyY2VfdmFsIGluIHJhbmdlIFtAc291cmNlX21pbi4uQHNvdXJjZV9tYXhdIHNjYWxl
ZCB0byByYW5nZQorICogW0B0YXJnZXRfbWluLi5AdGFyZ2V0X21heF0uCisgKi8KK3N0YXRpYyB1
MzIgc2NhbGUodTMyIHNvdXJjZV92YWwsCisJCSB1MzIgc291cmNlX21pbiwgdTMyIHNvdXJjZV9t
YXgsCisJCSB1MzIgdGFyZ2V0X21pbiwgdTMyIHRhcmdldF9tYXgpCit7CisJdTY0IHRhcmdldF92
YWw7CisKKwlXQVJOX09OKHNvdXJjZV9taW4gPiBzb3VyY2VfbWF4KTsKKwlXQVJOX09OKHRhcmdl
dF9taW4gPiB0YXJnZXRfbWF4KTsKKworCS8qIGRlZmVuc2l2ZSAqLworCXNvdXJjZV92YWwgPSBj
bGFtcChzb3VyY2VfdmFsLCBzb3VyY2VfbWluLCBzb3VyY2VfbWF4KTsKKworCS8qIGF2b2lkIG92
ZXJmbG93cyAqLworCXRhcmdldF92YWwgPSBtdWxfdTMyX3UzMihzb3VyY2VfdmFsIC0gc291cmNl
X21pbiwKKwkJCQkgdGFyZ2V0X21heCAtIHRhcmdldF9taW4pOworCXRhcmdldF92YWwgPSBESVZf
Uk9VTkRfQ0xPU0VTVF9VTEwodGFyZ2V0X3ZhbCwgc291cmNlX21heCAtIHNvdXJjZV9taW4pOwor
CXRhcmdldF92YWwgKz0gdGFyZ2V0X21pbjsKKworCXJldHVybiB0YXJnZXRfdmFsOworfQorCisv
KgorICogU2NhbGUgdXNlcl9sZXZlbCBpbiByYW5nZSBbMC4udXNlcl9tYXhdIHRvIFswLi5od19t
YXhdLCBjbGFtcGluZyB0aGUgcmVzdWx0CisgKiB0byBbaHdfbWluLi5od19tYXhdLgorICovCitz
dGF0aWMgdTMyIGNsYW1wX3VzZXJfdG9faHcoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVj
dG9yLAorCQkJICAgIHUzMiB1c2VyX2xldmVsLCB1MzIgdXNlcl9tYXgpCit7CisJc3RydWN0IGlu
dGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCXUzMiBod19sZXZlbDsKKwor
CWh3X2xldmVsID0gc2NhbGUodXNlcl9sZXZlbCwgMCwgdXNlcl9tYXgsIDAsIHBhbmVsLT5iYWNr
bGlnaHQubWF4KTsKKwlod19sZXZlbCA9IGNsYW1wKGh3X2xldmVsLCBwYW5lbC0+YmFja2xpZ2h0
Lm1pbiwgcGFuZWwtPmJhY2tsaWdodC5tYXgpOworCisJcmV0dXJuIGh3X2xldmVsOworfQorCisv
KiBTY2FsZSBod19sZXZlbCBpbiByYW5nZSBbaHdfbWluLi5od19tYXhdIHRvIFswLi51c2VyX21h
eF0uICovCitzdGF0aWMgdTMyIHNjYWxlX2h3X3RvX3VzZXIoc3RydWN0IGludGVsX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yLAorCQkJICAgIHUzMiBod19sZXZlbCwgdTMyIHVzZXJfbWF4KQoreworCXN0
cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKworCXJldHVybiBz
Y2FsZShod19sZXZlbCwgcGFuZWwtPmJhY2tsaWdodC5taW4sIHBhbmVsLT5iYWNrbGlnaHQubWF4
LAorCQkgICAgIDAsIHVzZXJfbWF4KTsKK30KKwordTMyIGludGVsX3BhbmVsX2ludmVydF9wd21f
bGV2ZWwoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgdmFsKQoreworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNl
LmRldik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwor
CisJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVs
X21heCA9PSAwKTsKKworCWlmIChkZXZfcHJpdi0+cGFyYW1zLmludmVydF9icmlnaHRuZXNzIDwg
MCkKKwkJcmV0dXJuIHZhbDsKKworCWlmIChkZXZfcHJpdi0+cGFyYW1zLmludmVydF9icmlnaHRu
ZXNzID4gMCB8fAorCSAgICBkZXZfcHJpdi0+cXVpcmtzICYgUVVJUktfSU5WRVJUX0JSSUdIVE5F
U1MpIHsKKwkJcmV0dXJuIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCAtIHZhbCArIHBh
bmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21pbjsKKwl9CisKKwlyZXR1cm4gdmFsOworfQorCit2
b2lkIGludGVsX3BhbmVsX3NldF9wd21fbGV2ZWwoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKmNvbm5fc3RhdGUsIHUzMiB2YWwpCit7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5k
ZXYpOworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKwor
CWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJzZXQgYmFja2xpZ2h0IFBXTSA9ICVkXG4iLCB2YWwp
OworCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzLT5zZXQoY29ubl9zdGF0ZSwgdmFsKTsKK30K
KwordTMyIGludGVsX3BhbmVsX2JhY2tsaWdodF9sZXZlbF90b19wd20oc3RydWN0IGludGVsX2Nv
bm5lY3RvciAqY29ubmVjdG9yLCB1MzIgdmFsKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGludGVs
X3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCisJZHJtX1dBUk5fT05fT05DRSgm
ZGV2X3ByaXYtPmRybSwKKwkJCSBwYW5lbC0+YmFja2xpZ2h0Lm1heCA9PSAwIHx8IHBhbmVsLT5i
YWNrbGlnaHQucHdtX2xldmVsX21heCA9PSAwKTsKKworCXZhbCA9IHNjYWxlKHZhbCwgcGFuZWwt
PmJhY2tsaWdodC5taW4sIHBhbmVsLT5iYWNrbGlnaHQubWF4LAorCQkgICAgcGFuZWwtPmJhY2ts
aWdodC5wd21fbGV2ZWxfbWluLCBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpOworCisJ
cmV0dXJuIGludGVsX3BhbmVsX2ludmVydF9wd21fbGV2ZWwoY29ubmVjdG9yLCB2YWwpOworfQor
Cit1MzIgaW50ZWxfcGFuZWxfYmFja2xpZ2h0X2xldmVsX2Zyb21fcHdtKHN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRl
bF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKworCWRybV9XQVJOX09OX09OQ0Uo
JmRldl9wcml2LT5kcm0sCisJCQkgcGFuZWwtPmJhY2tsaWdodC5tYXggPT0gMCB8fCBwYW5lbC0+
YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPT0gMCk7CisKKwlpZiAoZGV2X3ByaXYtPnBhcmFtcy5p
bnZlcnRfYnJpZ2h0bmVzcyA+IDAgfHwKKwkgICAgKGRldl9wcml2LT5wYXJhbXMuaW52ZXJ0X2Jy
aWdodG5lc3MgPT0gMCAmJiBkZXZfcHJpdi0+cXVpcmtzICYgUVVJUktfSU5WRVJUX0JSSUdIVE5F
U1MpKQorCQl2YWwgPSBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggLSAodmFsIC0gcGFu
ZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluKTsKKworCXJldHVybiBzY2FsZSh2YWwsIHBhbmVs
LT5iYWNrbGlnaHQucHdtX2xldmVsX21pbiwgcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4
LAorCQkgICAgIHBhbmVsLT5iYWNrbGlnaHQubWluLCBwYW5lbC0+YmFja2xpZ2h0Lm1heCk7Cit9
CisKK3N0YXRpYyB1MzIgbHB0X2dldF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yLCBlbnVtIHBpcGUgdW51c2VkKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisKKwlyZXR1cm4gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMikgJiBCQUNLTElHSFRfRFVUWV9D
WUNMRV9NQVNLOworfQorCitzdGF0aWMgdTMyIHBjaF9nZXRfYmFja2xpZ2h0KHN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHVudXNlZCkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwor
CisJcmV0dXJuIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1BVX0NUTCkgJiBCQUNL
TElHSFRfRFVUWV9DWUNMRV9NQVNLOworfQorCitzdGF0aWMgdTMyIGk5eHhfZ2V0X2JhY2tsaWdo
dChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSB1bnVzZWQpCit7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3It
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFu
ZWw7CisJdTMyIHZhbDsKKworCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01f
Q1RMKSAmIEJBQ0tMSUdIVF9EVVRZX0NZQ0xFX01BU0s7CisJaWYgKERJU1BMQVlfVkVSKGRldl9w
cml2KSA8IDQpCisJCXZhbCA+Pj0gMTsKKworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNvbWJpbmF0
aW9uX21vZGUpIHsKKwkJdTggbGJwYzsKKworCQlwY2lfcmVhZF9jb25maWdfYnl0ZSh0b19wY2lf
ZGV2KGRldl9wcml2LT5kcm0uZGV2KSwgTEJQQywgJmxicGMpOworCQl2YWwgKj0gbGJwYzsKKwl9
CisKKwlyZXR1cm4gdmFsOworfQorCitzdGF0aWMgdTMyIHZsdl9nZXRfYmFja2xpZ2h0KHN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHBpcGUpCit7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2
KTsKKworCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgcGlwZSAhPSBQSVBFX0EgJiYg
cGlwZSAhPSBQSVBFX0IpKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBpbnRlbF9kZV9yZWFkKGRl
dl9wcml2LCBWTFZfQkxDX1BXTV9DVEwocGlwZSkpICYgQkFDS0xJR0hUX0RVVFlfQ1lDTEVfTUFT
SzsKK30KKworc3RhdGljIHUzMiBieHRfZ2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSB1bnVzZWQpCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
aW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisKKwlyZXR1cm4gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwKKwkJCSAgICAgQlhUX0JMQ19QV01fRFVUWShwYW5lbC0+YmFja2xp
Z2h0LmNvbnRyb2xsZXIpKTsKK30KKworc3RhdGljIHUzMiBleHRfcHdtX2dldF9iYWNrbGlnaHQo
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUgdW51c2VkKQorewor
CXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKwlzdHJ1Y3Qg
cHdtX3N0YXRlIHN0YXRlOworCisJcHdtX2dldF9zdGF0ZShwYW5lbC0+YmFja2xpZ2h0LnB3bSwg
JnN0YXRlKTsKKwlyZXR1cm4gcHdtX2dldF9yZWxhdGl2ZV9kdXR5X2N5Y2xlKCZzdGF0ZSwgMTAw
KTsKK30KKworc3RhdGljIHZvaWQgbHB0X3NldF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29u
bmVjdG9yKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNv
bm5lY3Rvci0+YmFzZS5kZXYpOworCisJdTMyIHZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYs
IEJMQ19QV01fUENIX0NUTDIpICYgfkJBQ0tMSUdIVF9EVVRZX0NZQ0xFX01BU0s7CisJaW50ZWxf
ZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDIsIHZhbCB8IGxldmVsKTsKK30KKwor
c3RhdGljIHZvaWQgcGNoX3NldF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+
YmFzZS5kZXYpOworCXUzMiB0bXA7CisKKwl0bXAgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBC
TENfUFdNX0NQVV9DVEwpICYgfkJBQ0tMSUdIVF9EVVRZX0NZQ0xFX01BU0s7CisJaW50ZWxfZGVf
d3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fQ1BVX0NUTCwgdG1wIHwgbGV2ZWwpOworfQorCitzdGF0
aWMgdm9pZCBpOXh4X3NldF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFz
ZS5kZXYpOworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsK
Kwl1MzIgdG1wLCBtYXNrOworCisJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHBhbmVsLT5i
YWNrbGlnaHQucHdtX2xldmVsX21heCA9PSAwKTsKKworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNv
bWJpbmF0aW9uX21vZGUpIHsKKwkJdTggbGJwYzsKKworCQlsYnBjID0gbGV2ZWwgKiAweGZlIC8g
cGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ICsgMTsKKwkJbGV2ZWwgLz0gbGJwYzsKKwkJ
cGNpX3dyaXRlX2NvbmZpZ19ieXRlKHRvX3BjaV9kZXYoZGV2X3ByaXYtPmRybS5kZXYpLCBMQlBD
LCBsYnBjKTsKKwl9CisKKwlpZiAoRElTUExBWV9WRVIoZGV2X3ByaXYpID09IDQpIHsKKwkJbWFz
ayA9IEJBQ0tMSUdIVF9EVVRZX0NZQ0xFX01BU0s7CisJfSBlbHNlIHsKKwkJbGV2ZWwgPDw9IDE7
CisJCW1hc2sgPSBCQUNLTElHSFRfRFVUWV9DWUNMRV9NQVNLX1BOVjsKKwl9CisKKwl0bXAgPSBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NUTCkgJiB+bWFzazsKKwlpbnRlbF9kZV93
cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9DVEwsIHRtcCB8IGxldmVsKTsKK30KKworc3RhdGljIHZv
aWQgdmx2X3NldF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNv
bm5fc3RhdGUsIHUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYp
OworCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0Yyhjb25uX3N0YXRlLT5jcnRjKS0+cGlw
ZTsKKwl1MzIgdG1wOworCisJdG1wID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgVkxWX0JMQ19Q
V01fQ1RMKHBpcGUpKSAmIH5CQUNLTElHSFRfRFVUWV9DWUNMRV9NQVNLOworCWludGVsX2RlX3dy
aXRlKGRldl9wcml2LCBWTFZfQkxDX1BXTV9DVEwocGlwZSksIHRtcCB8IGxldmVsKTsKK30KKwor
c3RhdGljIHZvaWQgYnh0X3NldF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+
YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5l
bDsKKworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LAorCQkgICAgICAgQlhUX0JMQ19QV01fRFVU
WShwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpLCBsZXZlbCk7Cit9CisKK3N0YXRpYyB2b2lk
IGV4dF9wd21fc2V0X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAq
Y29ubl9zdGF0ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAm
dG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3RvciktPnBhbmVsOworCisJcHdt
X3NldF9yZWxhdGl2ZV9kdXR5X2N5Y2xlKCZwYW5lbC0+YmFja2xpZ2h0LnB3bV9zdGF0ZSwgbGV2
ZWwsIDEwMCk7CisJcHdtX2FwcGx5X3N0YXRlKHBhbmVsLT5iYWNrbGlnaHQucHdtLCAmcGFuZWwt
PmJhY2tsaWdodC5wd21fc3RhdGUpOworfQorCitzdGF0aWMgdm9pZAoraW50ZWxfcGFuZWxfYWN0
dWFsbHlfc2V0X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29u
bl9zdGF0ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rv
ciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisKKwlkcm1fZGJn
X2ttcygmaTkxNS0+ZHJtLCAic2V0IGJhY2tsaWdodCBsZXZlbCA9ICVkXG4iLCBsZXZlbCk7CisK
KwlwYW5lbC0+YmFja2xpZ2h0LmZ1bmNzLT5zZXQoY29ubl9zdGF0ZSwgbGV2ZWwpOworfQorCisv
KiBzZXQgYmFja2xpZ2h0IGJyaWdodG5lc3MgdG8gbGV2ZWwgaW4gcmFuZ2UgWzAuLm1heF0sIGFz
c3VtaW5nIGh3IG1pbiBpcworICogcmVzcGVjdGVkLgorICovCit2b2lkIGludGVsX3BhbmVsX3Nl
dF9iYWNrbGlnaHRfYWNwaShjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSwKKwkJCQkgICAgdTMyIHVzZXJfbGV2ZWwsIHUzMiB1c2VyX21heCkKK3sKKwlzdHJ1Y3Qg
aW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0
ZS0+Y29ubmVjdG9yKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAm
Y29ubmVjdG9yLT5wYW5lbDsKKwl1MzIgaHdfbGV2ZWw7CisKKwkvKgorCSAqIExhY2sgb2YgY3J0
YyBtYXkgb2NjdXIgZHVyaW5nIGRyaXZlciBpbml0IGJlY2F1c2UKKwkgKiBjb25uZWN0aW9uX211
dGV4IGlzbid0IGhlbGQgYWNyb3NzIHRoZSBlbnRpcmUgYmFja2xpZ2h0CisJICogc2V0dXAgKyBt
b2Rlc2V0IHJlYWRvdXQsIGFuZCB0aGUgQklPUyBjYW4gaXNzdWUgdGhlCisJICogcmVxdWVzdHMg
YXQgYW55IHRpbWUuCisJICovCisJaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnByZXNlbnQgfHwgIWNv
bm5fc3RhdGUtPmNydGMpCisJCXJldHVybjsKKworCW11dGV4X2xvY2soJmRldl9wcml2LT5iYWNr
bGlnaHRfbG9jayk7CisKKwlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgcGFuZWwtPmJhY2ts
aWdodC5tYXggPT0gMCk7CisKKwlod19sZXZlbCA9IGNsYW1wX3VzZXJfdG9faHcoY29ubmVjdG9y
LCB1c2VyX2xldmVsLCB1c2VyX21heCk7CisJcGFuZWwtPmJhY2tsaWdodC5sZXZlbCA9IGh3X2xl
dmVsOworCisJaWYgKHBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlKQorCQlwYW5lbC0+YmFja2xpZ2h0
LmRldmljZS0+cHJvcHMuYnJpZ2h0bmVzcyA9CisJCQlzY2FsZV9od190b191c2VyKGNvbm5lY3Rv
ciwKKwkJCQkJIHBhbmVsLT5iYWNrbGlnaHQubGV2ZWwsCisJCQkJCSBwYW5lbC0+YmFja2xpZ2h0
LmRldmljZS0+cHJvcHMubWF4X2JyaWdodG5lc3MpOworCisJaWYgKHBhbmVsLT5iYWNrbGlnaHQu
ZW5hYmxlZCkKKwkJaW50ZWxfcGFuZWxfYWN0dWFsbHlfc2V0X2JhY2tsaWdodChjb25uX3N0YXRl
LCBod19sZXZlbCk7CisKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7
Cit9CisKK3N0YXRpYyB2b2lkIGxwdF9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUsIHUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3Qg
aW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3Iob2xkX2Nvbm5f
c3RhdGUtPmNvbm5lY3Rvcik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwl1MzIgdG1wOworCisJaW50ZWxfcGFuZWxf
c2V0X3B3bV9sZXZlbChvbGRfY29ubl9zdGF0ZSwgbGV2ZWwpOworCisJLyoKKwkgKiBBbHRob3Vn
aCB3ZSBkb24ndCBzdXBwb3J0IG9yIGVuYWJsZSBDUFUgUFdNIHdpdGggTFBUL1NQVCBiYXNlZAor
CSAqIHN5c3RlbXMsIGl0IG1heSBoYXZlIGJlZW4gZW5hYmxlZCBwcmlvciB0byBsb2FkaW5nIHRo
ZQorCSAqIGRyaXZlci4gRGlzYWJsZSB0byBhdm9pZCB3YXJuaW5ncyBvbiBMQ1BMTCBkaXNhYmxl
LgorCSAqCisJICogVGhpcyBuZWVkcyByZXdvcmsgaWYgd2UgbmVlZCB0byBhZGQgc3VwcG9ydCBm
b3IgQ1BVIFBXTSBvbiBQQ0ggc3BsaXQKKwkgKiBwbGF0Zm9ybXMuCisJICovCisJdG1wID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DUFVfQ1RMMik7CisJaWYgKHRtcCAmIEJMTV9Q
V01fRU5BQkxFKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJjcHUg
YmFja2xpZ2h0IHdhcyBlbmFibGVkLCBkaXNhYmxpbmdcbiIpOworCQlpbnRlbF9kZV93cml0ZShk
ZXZfcHJpdiwgQkxDX1BXTV9DUFVfQ1RMMiwKKwkJCSAgICAgICB0bXAgJiB+QkxNX1BXTV9FTkFC
TEUpOworCX0KKworCXRtcCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NU
TDEpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxLCB0bXAgJiB+
QkxNX1BDSF9QV01fRU5BQkxFKTsKK30KKworc3RhdGljIHZvaWQgcGNoX2Rpc2FibGVfYmFja2xp
Z2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSwgdTMy
IHZhbCkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9j
b25uZWN0b3Iob2xkX2Nvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwl1MzIgdG1w
OworCisJaW50ZWxfcGFuZWxfc2V0X3B3bV9sZXZlbChvbGRfY29ubl9zdGF0ZSwgdmFsKTsKKwor
CXRtcCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1BVX0NUTDIpOworCWludGVs
X2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NQVV9DVEwyLCB0bXAgJiB+QkxNX1BXTV9FTkFC
TEUpOworCisJdG1wID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSk7
CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEsIHRtcCAmIH5CTE1f
UENIX1BXTV9FTkFCTEUpOworfQorCitzdGF0aWMgdm9pZCBpOXh4X2Rpc2FibGVfYmFja2xpZ2h0
KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSwgdTMyIHZh
bCkKK3sKKwlpbnRlbF9wYW5lbF9zZXRfcHdtX2xldmVsKG9sZF9jb25uX3N0YXRlLCB2YWwpOwor
fQorCitzdGF0aWMgdm9pZCBpOTY1X2Rpc2FibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1f
Y29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSwgdTMyIHZhbCkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG9sZF9jb25uX3N0YXRlLT5jb25uZWN0
b3ItPmRldik7CisJdTMyIHRtcDsKKworCWludGVsX3BhbmVsX3NldF9wd21fbGV2ZWwob2xkX2Nv
bm5fc3RhdGUsIHZhbCk7CisKKwl0bXAgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdN
X0NUTDIpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NUTDIsIHRtcCAmIH5C
TE1fUFdNX0VOQUJMRSk7Cit9CisKK3N0YXRpYyB2b2lkIHZsdl9kaXNhYmxlX2JhY2tsaWdodChj
b25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUsIHUzMiB2YWwp
Cit7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVj
dG9yKG9sZF9jb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJZW51bSBwaXBlIHBp
cGUgPSB0b19pbnRlbF9jcnRjKG9sZF9jb25uX3N0YXRlLT5jcnRjKS0+cGlwZTsKKwl1MzIgdG1w
OworCisJaW50ZWxfcGFuZWxfc2V0X3B3bV9sZXZlbChvbGRfY29ubl9zdGF0ZSwgdmFsKTsKKwor
CXRtcCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFZMVl9CTENfUFdNX0NUTDIocGlwZSkpOwor
CWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBWTFZfQkxDX1BXTV9DVEwyKHBpcGUpLAorCQkgICAg
ICAgdG1wICYgfkJMTV9QV01fRU5BQkxFKTsKK30KKworc3RhdGljIHZvaWQgYnh0X2Rpc2FibGVf
YmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0
ZSwgdTMyIHZhbCkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19p
bnRlbF9jb25uZWN0b3Iob2xkX2Nvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlz
dHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisJdTMyIHRtcDsK
KworCWludGVsX3BhbmVsX3NldF9wd21fbGV2ZWwob2xkX2Nvbm5fc3RhdGUsIHZhbCk7CisKKwl0
bXAgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAorCQkJICAgIEJYVF9CTENfUFdNX0NUTChwYW5l
bC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpKTsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQlhU
X0JMQ19QV01fQ1RMKHBhbmVsLT5iYWNrbGlnaHQuY29udHJvbGxlciksCisJCSAgICAgICB0bXAg
JiB+QlhUX0JMQ19QV01fRU5BQkxFKTsKKworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xs
ZXIgPT0gMSkgeworCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBVVElMX1BJTl9DVEwp
OworCQl2YWwgJj0gflVUSUxfUElOX0VOQUJMRTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYs
IFVUSUxfUElOX0NUTCwgdmFsKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGNucF9kaXNhYmxlX2Jh
Y2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUs
IHUzMiB2YWwpCit7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50
ZWxfY29ubmVjdG9yKG9sZF9jb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3Ry
dWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCXUzMiB0bXA7CisK
KwlpbnRlbF9wYW5lbF9zZXRfcHdtX2xldmVsKG9sZF9jb25uX3N0YXRlLCB2YWwpOworCisJdG1w
ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKKwkJCSAgICBCWFRfQkxDX1BXTV9DVEwocGFuZWwt
PmJhY2tsaWdodC5jb250cm9sbGVyKSk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJYVF9C
TENfUFdNX0NUTChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpLAorCQkgICAgICAgdG1wICYg
fkJYVF9CTENfUFdNX0VOQUJMRSk7Cit9CisKK3N0YXRpYyB2b2lkIGV4dF9wd21fZGlzYWJsZV9i
YWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRl
LCB1MzIgbGV2ZWwpCit7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9f
aW50ZWxfY29ubmVjdG9yKG9sZF9jb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBpbnRl
bF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKworCXBhbmVsLT5iYWNrbGlnaHQu
cHdtX3N0YXRlLmVuYWJsZWQgPSBmYWxzZTsKKwlwd21fYXBwbHlfc3RhdGUocGFuZWwtPmJhY2ts
aWdodC5wd20sICZwYW5lbC0+YmFja2xpZ2h0LnB3bV9zdGF0ZSk7Cit9CisKK3ZvaWQgaW50ZWxf
cGFuZWxfZGlzYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUg
Km9sZF9jb25uX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9
IHRvX2ludGVsX2Nvbm5lY3RvcihvbGRfY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYp
OworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKworCWlm
ICghcGFuZWwtPmJhY2tsaWdodC5wcmVzZW50KQorCQlyZXR1cm47CisKKwkvKgorCSAqIERvIG5v
dCBkaXNhYmxlIGJhY2tsaWdodCBvbiB0aGUgdmdhX3N3aXRjaGVyb28gcGF0aC4gV2hlbiBzd2l0
Y2hpbmcKKwkgKiBhd2F5IGZyb20gaTkxNSwgdGhlIG90aGVyIGNsaWVudCBtYXkgZGVwZW5kIG9u
IGk5MTUgdG8gaGFuZGxlIHRoZQorCSAqIGJhY2tsaWdodC4gVGhpcyB3aWxsIGxlYXZlIHRoZSBi
YWNrbGlnaHQgb24gdW5uZWNlc3NhcmlseSB3aGVuCisJICogYW5vdGhlciBjbGllbnQgaXMgbm90
IGFjdGl2YXRlZC4KKwkgKi8KKwlpZiAoZGV2X3ByaXYtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUg
PT0gRFJNX1NXSVRDSF9QT1dFUl9DSEFOR0lORykgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKKwkJCSAgICAiU2tpcHBpbmcgYmFja2xpZ2h0IGRpc2FibGUgb24gdmdhIHN3aXRjaFxu
Iik7CisJCXJldHVybjsKKwl9CisKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xv
Y2spOworCisJaWYgKHBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlKQorCQlwYW5lbC0+YmFja2xpZ2h0
LmRldmljZS0+cHJvcHMucG93ZXIgPSBGQl9CTEFOS19QT1dFUkRPV047CisJcGFuZWwtPmJhY2ts
aWdodC5lbmFibGVkID0gZmFsc2U7CisJcGFuZWwtPmJhY2tsaWdodC5mdW5jcy0+ZGlzYWJsZShv
bGRfY29ubl9zdGF0ZSwgMCk7CisKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5iYWNrbGlnaHRf
bG9jayk7Cit9CisKK3N0YXRpYyB2b2lkIGxwdF9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25u
ZWN0b3IpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29u
bmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0
b3ItPnBhbmVsOworCXUzMiBwY2hfY3RsMSwgcGNoX2N0bDIsIHNjaGlja2VuOworCisJcGNoX2N0
bDEgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxKTsKKwlpZiAocGNo
X2N0bDEgJiBCTE1fUENIX1BXTV9FTkFCTEUpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5k
cm0sICJwY2ggYmFja2xpZ2h0IGFscmVhZHkgZW5hYmxlZFxuIik7CisJCXBjaF9jdGwxICY9IH5C
TE1fUENIX1BXTV9FTkFCTEU7CisJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX1BD
SF9DVEwxLCBwY2hfY3RsMSk7CisJfQorCisJaWYgKEhBU19QQ0hfTFBUKGRldl9wcml2KSkgewor
CQlzY2hpY2tlbiA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFNPVVRIX0NISUNLRU4yKTsKKwkJ
aWYgKHBhbmVsLT5iYWNrbGlnaHQuYWx0ZXJuYXRlX3B3bV9pbmNyZW1lbnQpCisJCQlzY2hpY2tl
biB8PSBMUFRfUFdNX0dSQU5VTEFSSVRZOworCQllbHNlCisJCQlzY2hpY2tlbiAmPSB+TFBUX1BX
TV9HUkFOVUxBUklUWTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFNPVVRIX0NISUNLRU4y
LCBzY2hpY2tlbik7CisJfSBlbHNlIHsKKwkJc2NoaWNrZW4gPSBpbnRlbF9kZV9yZWFkKGRldl9w
cml2LCBTT1VUSF9DSElDS0VOMSk7CisJCWlmIChwYW5lbC0+YmFja2xpZ2h0LmFsdGVybmF0ZV9w
d21faW5jcmVtZW50KQorCQkJc2NoaWNrZW4gfD0gU1BUX1BXTV9HUkFOVUxBUklUWTsKKwkJZWxz
ZQorCQkJc2NoaWNrZW4gJj0gflNQVF9QV01fR1JBTlVMQVJJVFk7CisJCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCBTT1VUSF9DSElDS0VOMSwgc2NoaWNrZW4pOworCX0KKworCXBjaF9jdGwyID0g
cGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4IDw8IDE2OworCWludGVsX2RlX3dyaXRlKGRl
dl9wcml2LCBCTENfUFdNX1BDSF9DVEwyLCBwY2hfY3RsMik7CisKKwlwY2hfY3RsMSA9IDA7CisJ
aWYgKHBhbmVsLT5iYWNrbGlnaHQuYWN0aXZlX2xvd19wd20pCisJCXBjaF9jdGwxIHw9IEJMTV9Q
Q0hfUE9MQVJJVFk7CisKKwkvKiBBZnRlciBMUFQsIG92ZXJyaWRlIGlzIHRoZSBkZWZhdWx0LiAq
LworCWlmIChIQVNfUENIX0xQVChkZXZfcHJpdikpCisJCXBjaF9jdGwxIHw9IEJMTV9QQ0hfT1ZF
UlJJREVfRU5BQkxFOworCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NU
TDEsIHBjaF9jdGwxKTsKKwlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01f
UENIX0NUTDEpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxLAor
CQkgICAgICAgcGNoX2N0bDEgfCBCTE1fUENIX1BXTV9FTkFCTEUpOworCisJLyogVGhpcyB3b24n
dCBzdGljayB1bnRpbCB0aGUgYWJvdmUgZW5hYmxlLiAqLworCWludGVsX3BhbmVsX3NldF9wd21f
bGV2ZWwoY29ubl9zdGF0ZSwgbGV2ZWwpOworfQorCitzdGF0aWMgdm9pZCBwY2hfZW5hYmxlX2Jh
Y2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkg
Y29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkK
K3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0
b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9wYW5l
bCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKwllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5z
Y29kZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKKwl1MzIgY3B1X2N0bDIsIHBjaF9j
dGwxLCBwY2hfY3RsMjsKKworCWNwdV9jdGwyID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxD
X1BXTV9DUFVfQ1RMMik7CisJaWYgKGNwdV9jdGwyICYgQkxNX1BXTV9FTkFCTEUpIHsKKwkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJjcHUgYmFja2xpZ2h0IGFscmVhZHkgZW5hYmxlZFxu
Iik7CisJCWNwdV9jdGwyICY9IH5CTE1fUFdNX0VOQUJMRTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2
X3ByaXYsIEJMQ19QV01fQ1BVX0NUTDIsIGNwdV9jdGwyKTsKKwl9CisKKwlwY2hfY3RsMSA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEpOworCWlmIChwY2hfY3RsMSAm
IEJMTV9QQ0hfUFdNX0VOQUJMRSkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgInBj
aCBiYWNrbGlnaHQgYWxyZWFkeSBlbmFibGVkXG4iKTsKKwkJcGNoX2N0bDEgJj0gfkJMTV9QQ0hf
UFdNX0VOQUJMRTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEs
IHBjaF9jdGwxKTsKKwl9CisKKwlpZiAoY3B1X3RyYW5zY29kZXIgPT0gVFJBTlNDT0RFUl9FRFAp
CisJCWNwdV9jdGwyID0gQkxNX1RSQU5TQ09ERVJfRURQOworCWVsc2UKKwkJY3B1X2N0bDIgPSBC
TE1fUElQRShjcHVfdHJhbnNjb2Rlcik7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19Q
V01fQ1BVX0NUTDIsIGNwdV9jdGwyKTsKKwlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYs
IEJMQ19QV01fQ1BVX0NUTDIpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NQ
VV9DVEwyLCBjcHVfY3RsMiB8IEJMTV9QV01fRU5BQkxFKTsKKworCS8qIFRoaXMgd29uJ3Qgc3Rp
Y2sgdW50aWwgdGhlIGFib3ZlIGVuYWJsZS4gKi8KKwlpbnRlbF9wYW5lbF9zZXRfcHdtX2xldmVs
KGNvbm5fc3RhdGUsIGxldmVsKTsKKworCXBjaF9jdGwyID0gcGFuZWwtPmJhY2tsaWdodC5wd21f
bGV2ZWxfbWF4IDw8IDE2OworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX1BDSF9D
VEwyLCBwY2hfY3RsMik7CisKKwlwY2hfY3RsMSA9IDA7CisJaWYgKHBhbmVsLT5iYWNrbGlnaHQu
YWN0aXZlX2xvd19wd20pCisJCXBjaF9jdGwxIHw9IEJMTV9QQ0hfUE9MQVJJVFk7CisKKwlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSwgcGNoX2N0bDEpOworCWludGVs
X2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSk7CisJaW50ZWxfZGVf
d3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEsCisJCSAgICAgICBwY2hfY3RsMSB8IEJM
TV9QQ0hfUFdNX0VOQUJMRSk7Cit9CisKK3N0YXRpYyB2b2lkIGk5eHhfZW5hYmxlX2JhY2tsaWdo
dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgIGNvbnN0
IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCit7CisJ
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNv
bm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBh
bmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisJdTMyIGN0bCwgZnJlcTsKKworCWN0bCA9IGludGVs
X2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1RMKTsKKwlpZiAoY3RsICYgQkFDS0xJR0hUX0RV
VFlfQ1lDTEVfTUFTS19QTlYpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJiYWNr
bGlnaHQgYWxyZWFkeSBlbmFibGVkXG4iKTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJM
Q19QV01fQ1RMLCAwKTsKKwl9CisKKwlmcmVxID0gcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxf
bWF4OworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNvbWJpbmF0aW9uX21vZGUpCisJCWZyZXEgLz0g
MHhmZjsKKworCWN0bCA9IGZyZXEgPDwgMTc7CisJaWYgKHBhbmVsLT5iYWNrbGlnaHQuY29tYmlu
YXRpb25fbW9kZSkKKwkJY3RsIHw9IEJMTV9MRUdBQ1lfTU9ERTsKKwlpZiAoSVNfUElORVZJRVco
ZGV2X3ByaXYpICYmIHBhbmVsLT5iYWNrbGlnaHQuYWN0aXZlX2xvd19wd20pCisJCWN0bCB8PSBC
TE1fUE9MQVJJVFlfUE5WOworCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fQ1RM
LCBjdGwpOworCWludGVsX2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DVEwpOwor
CisJLyogWFhYOiBjb21iaW5lIHRoaXMgaW50byBhYm92ZSB3cml0ZT8gKi8KKwlpbnRlbF9wYW5l
bF9zZXRfcHdtX2xldmVsKGNvbm5fc3RhdGUsIGxldmVsKTsKKworCS8qCisJICogTmVlZGVkIHRv
IGVuYWJsZSBiYWNrbGlnaHQgb24gc29tZSA4NTVnbSBtb2RlbHMuIEJMQ19ISVNUX0NUTCBpcwor
CSAqIDg1NWdtIG9ubHksIGJ1dCBjaGVja2luZyBmb3IgZ2VuMiBpcyBzYWZlLCBhcyA4NTVnbSBp
cyB0aGUgb25seSBnZW4yCisJICogdGhhdCBoYXMgYmFja2xpZ2h0LgorCSAqLworCWlmIChESVNQ
TEFZX1ZFUihkZXZfcHJpdikgPT0gMikKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19I
SVNUX0NUTCwgQkxNX0hJU1RPR1JBTV9FTkFCTEUpOworfQorCitzdGF0aWMgdm9pZCBpOTY1X2Vu
YWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CisJCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMy
IGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVs
X2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGlu
dGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCWVudW0gcGlwZSBwaXBlID0g
dG9faW50ZWxfY3J0Yyhjb25uX3N0YXRlLT5jcnRjKS0+cGlwZTsKKwl1MzIgY3RsLCBjdGwyLCBm
cmVxOworCisJY3RsMiA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1RMMik7CisJ
aWYgKGN0bDIgJiBCTE1fUFdNX0VOQUJMRSkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwgImJhY2tsaWdodCBhbHJlYWR5IGVuYWJsZWRcbiIpOworCQljdGwyICY9IH5CTE1fUFdNX0VO
QUJMRTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19QV01fQ1RMMiwgY3RsMik7CisJ
fQorCisJZnJlcSA9IHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heDsKKwlpZiAocGFuZWwt
PmJhY2tsaWdodC5jb21iaW5hdGlvbl9tb2RlKQorCQlmcmVxIC89IDB4ZmY7CisKKwljdGwgPSBm
cmVxIDw8IDE2OworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NUTCwgY3RsKTsK
KworCWN0bDIgPSBCTE1fUElQRShwaXBlKTsKKwlpZiAocGFuZWwtPmJhY2tsaWdodC5jb21iaW5h
dGlvbl9tb2RlKQorCQljdGwyIHw9IEJMTV9DT01CSU5BVElPTl9NT0RFOworCWlmIChwYW5lbC0+
YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtKQorCQljdGwyIHw9IEJMTV9QT0xBUklUWV9JOTY1Owor
CWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NUTDIsIGN0bDIpOworCWludGVsX2Rl
X3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DVEwyKTsKKwlpbnRlbF9kZV93cml0ZShk
ZXZfcHJpdiwgQkxDX1BXTV9DVEwyLCBjdGwyIHwgQkxNX1BXTV9FTkFCTEUpOworCisJaW50ZWxf
cGFuZWxfc2V0X3B3bV9sZXZlbChjb25uX3N0YXRlLCBsZXZlbCk7Cit9CisKK3N0YXRpYyB2b2lk
IHZsdl9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0
ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRv
X2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3Ry
dWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCWVudW0gcGlwZSBw
aXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOworCXUzMiBj
dGwsIGN0bDI7CisKKwljdGwyID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgVkxWX0JMQ19QV01f
Q1RMMihwaXBlKSk7CisJaWYgKGN0bDIgJiBCTE1fUFdNX0VOQUJMRSkgeworCQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwgImJhY2tsaWdodCBhbHJlYWR5IGVuYWJsZWRcbiIpOworCQljdGwy
ICY9IH5CTE1fUFdNX0VOQUJMRTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFZMVl9CTENf
UFdNX0NUTDIocGlwZSksIGN0bDIpOworCX0KKworCWN0bCA9IHBhbmVsLT5iYWNrbGlnaHQucHdt
X2xldmVsX21heCA8PCAxNjsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgVkxWX0JMQ19QV01f
Q1RMKHBpcGUpLCBjdGwpOworCisJLyogWFhYOiBjb21iaW5lIHRoaXMgaW50byBhYm92ZSB3cml0
ZT8gKi8KKwlpbnRlbF9wYW5lbF9zZXRfcHdtX2xldmVsKGNvbm5fc3RhdGUsIGxldmVsKTsKKwor
CWN0bDIgPSAwOworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtKQorCQljdGwy
IHw9IEJMTV9QT0xBUklUWV9JOTY1OworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBWTFZfQkxD
X1BXTV9DVEwyKHBpcGUpLCBjdGwyKTsKKwlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYs
IFZMVl9CTENfUFdNX0NUTDIocGlwZSkpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBWTFZf
QkxDX1BXTV9DVEwyKHBpcGUpLAorCQkgICAgICAgY3RsMiB8IEJMTV9QV01fRU5BQkxFKTsKK30K
Kworc3RhdGljIHZvaWQgYnh0X2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0
YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCit7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7
CisJZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yykt
PnBpcGU7CisJdTMyIHB3bV9jdGwsIHZhbDsKKworCS8qIENvbnRyb2xsZXIgMSB1c2VzIHRoZSB1
dGlsaXR5IHBpbi4gKi8KKwlpZiAocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyID09IDEpIHsK
KwkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgVVRJTF9QSU5fQ1RMKTsKKwkJaWYgKHZh
bCAmIFVUSUxfUElOX0VOQUJMRSkgeworCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJ
CQkJICAgICJ1dGlsIHBpbiBhbHJlYWR5IGVuYWJsZWRcbiIpOworCQkJdmFsICY9IH5VVElMX1BJ
Tl9FTkFCTEU7CisJCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgVVRJTF9QSU5fQ1RMLCB2YWwp
OworCQl9CisKKwkJdmFsID0gMDsKKwkJaWYgKHBhbmVsLT5iYWNrbGlnaHQudXRpbF9waW5fYWN0
aXZlX2xvdykKKwkJCXZhbCB8PSBVVElMX1BJTl9QT0xBUklUWTsKKwkJaW50ZWxfZGVfd3JpdGUo
ZGV2X3ByaXYsIFVUSUxfUElOX0NUTCwKKwkJCSAgICAgICB2YWwgfCBVVElMX1BJTl9QSVBFKHBp
cGUpIHwgVVRJTF9QSU5fTU9ERV9QV00gfCBVVElMX1BJTl9FTkFCTEUpOworCX0KKworCXB3bV9j
dGwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAorCQkJCUJYVF9CTENfUFdNX0NUTChwYW5lbC0+
YmFja2xpZ2h0LmNvbnRyb2xsZXIpKTsKKwlpZiAocHdtX2N0bCAmIEJYVF9CTENfUFdNX0VOQUJM
RSkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgImJhY2tsaWdodCBhbHJlYWR5IGVu
YWJsZWRcbiIpOworCQlwd21fY3RsICY9IH5CWFRfQkxDX1BXTV9FTkFCTEU7CisJCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LAorCQkJICAgICAgIEJYVF9CTENfUFdNX0NUTChwYW5lbC0+YmFja2xp
Z2h0LmNvbnRyb2xsZXIpLAorCQkJICAgICAgIHB3bV9jdGwpOworCX0KKworCWludGVsX2RlX3dy
aXRlKGRldl9wcml2LAorCQkgICAgICAgQlhUX0JMQ19QV01fRlJFUShwYW5lbC0+YmFja2xpZ2h0
LmNvbnRyb2xsZXIpLAorCQkgICAgICAgcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4KTsK
KworCWludGVsX3BhbmVsX3NldF9wd21fbGV2ZWwoY29ubl9zdGF0ZSwgbGV2ZWwpOworCisJcHdt
X2N0bCA9IDA7CisJaWYgKHBhbmVsLT5iYWNrbGlnaHQuYWN0aXZlX2xvd19wd20pCisJCXB3bV9j
dGwgfD0gQlhUX0JMQ19QV01fUE9MQVJJVFk7CisKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwg
QlhUX0JMQ19QV01fQ1RMKHBhbmVsLT5iYWNrbGlnaHQuY29udHJvbGxlciksCisJCSAgICAgICBw
d21fY3RsKTsKKwlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsCisJCQkgICAgICBCWFRf
QkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyKSk7CisJaW50ZWxfZGVfd3Jp
dGUoZGV2X3ByaXYsIEJYVF9CTENfUFdNX0NUTChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIp
LAorCQkgICAgICAgcHdtX2N0bCB8IEJYVF9CTENfUFdNX0VOQUJMRSk7Cit9CisKK3N0YXRpYyB2
b2lkIGNucF9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9
IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJ
c3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCXUzMiBwd21f
Y3RsOworCisJcHdtX2N0bCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCisJCQkJQlhUX0JMQ19Q
V01fQ1RMKHBhbmVsLT5iYWNrbGlnaHQuY29udHJvbGxlcikpOworCWlmIChwd21fY3RsICYgQlhU
X0JMQ19QV01fRU5BQkxFKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiYmFja2xp
Z2h0IGFscmVhZHkgZW5hYmxlZFxuIik7CisJCXB3bV9jdGwgJj0gfkJYVF9CTENfUFdNX0VOQUJM
RTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCisJCQkgICAgICAgQlhUX0JMQ19QV01fQ1RM
KHBhbmVsLT5iYWNrbGlnaHQuY29udHJvbGxlciksCisJCQkgICAgICAgcHdtX2N0bCk7CisJfQor
CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCisJCSAgICAgICBCWFRfQkxDX1BXTV9GUkVRKHBh
bmVsLT5iYWNrbGlnaHQuY29udHJvbGxlciksCisJCSAgICAgICBwYW5lbC0+YmFja2xpZ2h0LnB3
bV9sZXZlbF9tYXgpOworCisJaW50ZWxfcGFuZWxfc2V0X3B3bV9sZXZlbChjb25uX3N0YXRlLCBs
ZXZlbCk7CisKKwlwd21fY3RsID0gMDsKKwlpZiAocGFuZWwtPmJhY2tsaWdodC5hY3RpdmVfbG93
X3B3bSkKKwkJcHdtX2N0bCB8PSBCWFRfQkxDX1BXTV9QT0xBUklUWTsKKworCWludGVsX2RlX3dy
aXRlKGRldl9wcml2LCBCWFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVy
KSwKKwkJICAgICAgIHB3bV9jdGwpOworCWludGVsX2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwK
KwkJCSAgICAgIEJYVF9CTENfUFdNX0NUTChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpKTsK
KwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQlhUX0JMQ19QV01fQ1RMKHBhbmVsLT5iYWNrbGln
aHQuY29udHJvbGxlciksCisJCSAgICAgICBwd21fY3RsIHwgQlhUX0JMQ19QV01fRU5BQkxFKTsK
K30KKworc3RhdGljIHZvaWQgZXh0X3B3bV9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKK3sKKwlzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29u
bmVjdG9yKTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7
CisKKwlwd21fc2V0X3JlbGF0aXZlX2R1dHlfY3ljbGUoJnBhbmVsLT5iYWNrbGlnaHQucHdtX3N0
YXRlLCBsZXZlbCwgMTAwKTsKKwlwYW5lbC0+YmFja2xpZ2h0LnB3bV9zdGF0ZS5lbmFibGVkID0g
dHJ1ZTsKKwlwd21fYXBwbHlfc3RhdGUocGFuZWwtPmJhY2tsaWdodC5wd20sICZwYW5lbC0+YmFj
a2xpZ2h0LnB3bV9zdGF0ZSk7Cit9CisKK3N0YXRpYyB2b2lkIF9faW50ZWxfcGFuZWxfZW5hYmxl
X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJ
CQkJICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCit7CisJ
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNv
bm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25u
ZWN0b3ItPnBhbmVsOworCisJV0FSTl9PTihwYW5lbC0+YmFja2xpZ2h0Lm1heCA9PSAwKTsKKwor
CWlmIChwYW5lbC0+YmFja2xpZ2h0LmxldmVsIDw9IHBhbmVsLT5iYWNrbGlnaHQubWluKSB7CisJ
CXBhbmVsLT5iYWNrbGlnaHQubGV2ZWwgPSBwYW5lbC0+YmFja2xpZ2h0Lm1heDsKKwkJaWYgKHBh
bmVsLT5iYWNrbGlnaHQuZGV2aWNlKQorCQkJcGFuZWwtPmJhY2tsaWdodC5kZXZpY2UtPnByb3Bz
LmJyaWdodG5lc3MgPQorCQkJCXNjYWxlX2h3X3RvX3VzZXIoY29ubmVjdG9yLAorCQkJCQkJIHBh
bmVsLT5iYWNrbGlnaHQubGV2ZWwsCisJCQkJCQkgcGFuZWwtPmJhY2tsaWdodC5kZXZpY2UtPnBy
b3BzLm1heF9icmlnaHRuZXNzKTsKKwl9CisKKwlwYW5lbC0+YmFja2xpZ2h0LmZ1bmNzLT5lbmFi
bGUoY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSwgcGFuZWwtPmJhY2tsaWdodC5sZXZlbCk7CisJcGFu
ZWwtPmJhY2tsaWdodC5lbmFibGVkID0gdHJ1ZTsKKwlpZiAocGFuZWwtPmJhY2tsaWdodC5kZXZp
Y2UpCisJCXBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlLT5wcm9wcy5wb3dlciA9IEZCX0JMQU5LX1VO
QkxBTks7Cit9CisKK3ZvaWQgaW50ZWxfcGFuZWxfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgIGNvbnN0IHN0cnVjdCBkcm1f
Y29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5i
YXNlLmRldik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVs
OworCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMp
LT5waXBlOworCisJaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnByZXNlbnQpCisJCXJldHVybjsKKwor
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAicGlwZSAlY1xuIiwgcGlwZV9uYW1lKHBpcGUp
KTsKKworCW11dGV4X2xvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisKKwlfX2ludGVs
X3BhbmVsX2VuYWJsZV9iYWNrbGlnaHQoY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisKKwltdXRl
eF91bmxvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7Cit9CisKKyNpZiBJU19FTkFCTEVE
KENPTkZJR19CQUNLTElHSFRfQ0xBU1NfREVWSUNFKQorc3RhdGljIHUzMiBpbnRlbF9wYW5lbF9n
ZXRfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5k
ZXYpOworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKwl1
MzIgdmFsID0gMDsKKworCW11dGV4X2xvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisK
KwlpZiAocGFuZWwtPmJhY2tsaWdodC5lbmFibGVkKQorCQl2YWwgPSBwYW5lbC0+YmFja2xpZ2h0
LmZ1bmNzLT5nZXQoY29ubmVjdG9yLCBpbnRlbF9jb25uZWN0b3JfZ2V0X3BpcGUoY29ubmVjdG9y
KSk7CisKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisKKwlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgImdldCBiYWNrbGlnaHQgUFdNID0gJWRcbiIsIHZhbCk7
CisJcmV0dXJuIHZhbDsKK30KKworLyogU2NhbGUgdXNlcl9sZXZlbCBpbiByYW5nZSBbMC4udXNl
cl9tYXhdIHRvIFtod19taW4uLmh3X21heF0uICovCitzdGF0aWMgdTMyIHNjYWxlX3VzZXJfdG9f
aHcoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLAorCQkJICAgIHUzMiB1c2VyX2xl
dmVsLCB1MzIgdXNlcl9tYXgpCit7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25u
ZWN0b3ItPnBhbmVsOworCisJcmV0dXJuIHNjYWxlKHVzZXJfbGV2ZWwsIDAsIHVzZXJfbWF4LAor
CQkgICAgIHBhbmVsLT5iYWNrbGlnaHQubWluLCBwYW5lbC0+YmFja2xpZ2h0Lm1heCk7Cit9CisK
Ky8qIHNldCBiYWNrbGlnaHQgYnJpZ2h0bmVzcyB0byBsZXZlbCBpbiByYW5nZSBbMC4ubWF4XSwg
c2NhbGluZyB3cnQgaHcgbWluICovCitzdGF0aWMgdm9pZCBpbnRlbF9wYW5lbF9zZXRfYmFja2xp
Z2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLAorCQkJCSAg
ICAgIHUzMiB1c2VyX2xldmVsLCB1MzIgdXNlcl9tYXgpCit7CisJc3RydWN0IGludGVsX2Nvbm5l
Y3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rv
cik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0
b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+
cGFuZWw7CisJdTMyIGh3X2xldmVsOworCisJaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnByZXNlbnQp
CisJCXJldHVybjsKKworCW11dGV4X2xvY2soJmRldl9wcml2LT5iYWNrbGlnaHRfbG9jayk7CisK
Kwlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgcGFuZWwtPmJhY2tsaWdodC5tYXggPT0gMCk7
CisKKwlod19sZXZlbCA9IHNjYWxlX3VzZXJfdG9faHcoY29ubmVjdG9yLCB1c2VyX2xldmVsLCB1
c2VyX21heCk7CisJcGFuZWwtPmJhY2tsaWdodC5sZXZlbCA9IGh3X2xldmVsOworCisJaWYgKHBh
bmVsLT5iYWNrbGlnaHQuZW5hYmxlZCkKKwkJaW50ZWxfcGFuZWxfYWN0dWFsbHlfc2V0X2JhY2ts
aWdodChjb25uX3N0YXRlLCBod19sZXZlbCk7CisKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5i
YWNrbGlnaHRfbG9jayk7Cit9CisKK3N0YXRpYyBpbnQgaW50ZWxfYmFja2xpZ2h0X2RldmljZV91
cGRhdGVfc3RhdHVzKHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiZCkKK3sKKwlzdHJ1Y3QgaW50
ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSBibF9nZXRfZGF0YShiZCk7CisJc3RydWN0IGludGVs
X3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSBjb25uZWN0b3ItPmJhc2UuZGV2OworCisJZHJtX21vZGVzZXRfbG9jaygmZGV2LT5tb2Rl
X2NvbmZpZy5jb25uZWN0aW9uX211dGV4LCBOVUxMKTsKKwlEUk1fREVCVUdfS01TKCJ1cGRhdGlu
ZyBpbnRlbF9iYWNrbGlnaHQsIGJyaWdodG5lc3M9JWQvJWRcbiIsCisJCSAgICAgIGJkLT5wcm9w
cy5icmlnaHRuZXNzLCBiZC0+cHJvcHMubWF4X2JyaWdodG5lc3MpOworCWludGVsX3BhbmVsX3Nl
dF9iYWNrbGlnaHQoY29ubmVjdG9yLT5iYXNlLnN0YXRlLCBiZC0+cHJvcHMuYnJpZ2h0bmVzcywK
KwkJCQkgIGJkLT5wcm9wcy5tYXhfYnJpZ2h0bmVzcyk7CisKKwkvKgorCSAqIEFsbG93IGZsaXBw
aW5nIGJsX3Bvd2VyIGFzIGEgc3ViLXN0YXRlIG9mIGVuYWJsZWQuIFNhZGx5IHRoZQorCSAqIGJh
Y2tsaWdodCBjbGFzcyBkZXZpY2UgZG9lcyBub3QgbWFrZSBpdCBlYXN5IHRvIGRpZmZlcmVudGlh
dGUKKwkgKiBiZXR3ZWVuIGNhbGxiYWNrcyBmb3IgYnJpZ2h0bmVzcyBhbmQgYmxfcG93ZXIsIHNv
IG91ciBiYWNrbGlnaHRfcG93ZXIKKwkgKiBjYWxsYmFjayBuZWVkcyB0byB0YWtlIHRoaXMgaW50
byBhY2NvdW50LgorCSAqLworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZWQpIHsKKwkJaWYg
KHBhbmVsLT5iYWNrbGlnaHQucG93ZXIpIHsKKwkJCWJvb2wgZW5hYmxlID0gYmQtPnByb3BzLnBv
d2VyID09IEZCX0JMQU5LX1VOQkxBTksgJiYKKwkJCQliZC0+cHJvcHMuYnJpZ2h0bmVzcyAhPSAw
OworCQkJcGFuZWwtPmJhY2tsaWdodC5wb3dlcihjb25uZWN0b3IsIGVuYWJsZSk7CisJCX0KKwl9
IGVsc2UgeworCQliZC0+cHJvcHMucG93ZXIgPSBGQl9CTEFOS19QT1dFUkRPV047CisJfQorCisJ
ZHJtX21vZGVzZXRfdW5sb2NrKCZkZXYtPm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0ZXgpOwor
CXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGludGVsX2JhY2tsaWdodF9kZXZpY2VfZ2V0X2Jy
aWdodG5lc3Moc3RydWN0IGJhY2tsaWdodF9kZXZpY2UgKmJkKQoreworCXN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvciA9IGJsX2dldF9kYXRhKGJkKTsKKwlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gY29ubmVjdG9yLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisJaW50
IHJldCA9IDA7CisKKwl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmRldl9wcml2LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKSB7CisJCXUzMiBod19sZXZlbDsKKworCQlkcm1fbW9kZXNldF9sb2NrKCZkZXYt
Pm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0ZXgsIE5VTEwpOworCisJCWh3X2xldmVsID0gaW50
ZWxfcGFuZWxfZ2V0X2JhY2tsaWdodChjb25uZWN0b3IpOworCQlyZXQgPSBzY2FsZV9od190b191
c2VyKGNvbm5lY3RvciwKKwkJCQkgICAgICAgaHdfbGV2ZWwsIGJkLT5wcm9wcy5tYXhfYnJpZ2h0
bmVzcyk7CisKKwkJZHJtX21vZGVzZXRfdW5sb2NrKCZkZXYtPm1vZGVfY29uZmlnLmNvbm5lY3Rp
b25fbXV0ZXgpOworCX0KKworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
YmFja2xpZ2h0X29wcyBpbnRlbF9iYWNrbGlnaHRfZGV2aWNlX29wcyA9IHsKKwkudXBkYXRlX3N0
YXR1cyA9IGludGVsX2JhY2tsaWdodF9kZXZpY2VfdXBkYXRlX3N0YXR1cywKKwkuZ2V0X2JyaWdo
dG5lc3MgPSBpbnRlbF9iYWNrbGlnaHRfZGV2aWNlX2dldF9icmlnaHRuZXNzLAorfTsKKworaW50
IGludGVsX2JhY2tsaWdodF9kZXZpY2VfcmVnaXN0ZXIoc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShj
b25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5l
Y3Rvci0+cGFuZWw7CisJc3RydWN0IGJhY2tsaWdodF9wcm9wZXJ0aWVzIHByb3BzOworCXN0cnVj
dCBiYWNrbGlnaHRfZGV2aWNlICpiZDsKKwljb25zdCBjaGFyICpuYW1lOworCWludCByZXQgPSAw
OworCisJaWYgKFdBUk5fT04ocGFuZWwtPmJhY2tsaWdodC5kZXZpY2UpKQorCQlyZXR1cm4gLUVO
T0RFVjsKKworCWlmICghcGFuZWwtPmJhY2tsaWdodC5wcmVzZW50KQorCQlyZXR1cm4gMDsKKwor
CVdBUk5fT04ocGFuZWwtPmJhY2tsaWdodC5tYXggPT0gMCk7CisKKwltZW1zZXQoJnByb3BzLCAw
LCBzaXplb2YocHJvcHMpKTsKKwlwcm9wcy50eXBlID0gQkFDS0xJR0hUX1JBVzsKKworCS8qCisJ
ICogTm90ZTogRXZlcnl0aGluZyBzaG91bGQgd29yayBldmVuIGlmIHRoZSBiYWNrbGlnaHQgZGV2
aWNlIG1heAorCSAqIHByZXNlbnRlZCB0byB0aGUgdXNlcnNwYWNlIGlzIGFyYml0cmFyaWx5IGNo
b3Nlbi4KKwkgKi8KKwlwcm9wcy5tYXhfYnJpZ2h0bmVzcyA9IHBhbmVsLT5iYWNrbGlnaHQubWF4
OworCXByb3BzLmJyaWdodG5lc3MgPSBzY2FsZV9od190b191c2VyKGNvbm5lY3RvciwKKwkJCQkJ
ICAgIHBhbmVsLT5iYWNrbGlnaHQubGV2ZWwsCisJCQkJCSAgICBwcm9wcy5tYXhfYnJpZ2h0bmVz
cyk7CisKKwlpZiAocGFuZWwtPmJhY2tsaWdodC5lbmFibGVkKQorCQlwcm9wcy5wb3dlciA9IEZC
X0JMQU5LX1VOQkxBTks7CisJZWxzZQorCQlwcm9wcy5wb3dlciA9IEZCX0JMQU5LX1BPV0VSRE9X
TjsKKworCW5hbWUgPSBrc3RyZHVwKCJpbnRlbF9iYWNrbGlnaHQiLCBHRlBfS0VSTkVMKTsKKwlp
ZiAoIW5hbWUpCisJCXJldHVybiAtRU5PTUVNOworCisJYmQgPSBiYWNrbGlnaHRfZGV2aWNlX3Jl
Z2lzdGVyKG5hbWUsIGNvbm5lY3Rvci0+YmFzZS5rZGV2LCBjb25uZWN0b3IsCisJCQkJICAgICAg
ICZpbnRlbF9iYWNrbGlnaHRfZGV2aWNlX29wcywgJnByb3BzKTsKKworCS8qCisJICogVXNpbmcg
dGhlIHNhbWUgbmFtZSBpbmRlcGVuZGVudCBvZiB0aGUgZHJtIGRldmljZSBvciBjb25uZWN0b3IK
KwkgKiBwcmV2ZW50cyByZWdpc3RyYXRpb24gb2YgbXVsdGlwbGUgYmFja2xpZ2h0IGRldmljZXMg
aW4gdGhlCisJICogZHJpdmVyLiBIb3dldmVyLCB3ZSBuZWVkIHRvIHVzZSB0aGUgZGVmYXVsdCBu
YW1lIGZvciBiYWNrd2FyZAorCSAqIGNvbXBhdGliaWxpdHkuIFVzZSB1bmlxdWUgbmFtZXMgZm9y
IHN1YnNlcXVlbnQgYmFja2xpZ2h0IGRldmljZXMgYXMgYQorCSAqIGZhbGxiYWNrIHdoZW4gdGhl
IGRlZmF1bHQgbmFtZSBhbHJlYWR5IGV4aXN0cy4KKwkgKi8KKwlpZiAoSVNfRVJSKGJkKSAmJiBQ
VFJfRVJSKGJkKSA9PSAtRUVYSVNUKSB7CisJCWtmcmVlKG5hbWUpOworCQluYW1lID0ga2FzcHJp
bnRmKEdGUF9LRVJORUwsICJjYXJkJWQtJXMtYmFja2xpZ2h0IiwKKwkJCQkgaTkxNS0+ZHJtLnBy
aW1hcnktPmluZGV4LCBjb25uZWN0b3ItPmJhc2UubmFtZSk7CisJCWlmICghbmFtZSkKKwkJCXJl
dHVybiAtRU5PTUVNOworCisJCWJkID0gYmFja2xpZ2h0X2RldmljZV9yZWdpc3RlcihuYW1lLCBj
b25uZWN0b3ItPmJhc2Uua2RldiwgY29ubmVjdG9yLAorCQkJCQkgICAgICAgJmludGVsX2JhY2ts
aWdodF9kZXZpY2Vfb3BzLCAmcHJvcHMpOworCX0KKworCWlmIChJU19FUlIoYmQpKSB7CisJCWRy
bV9lcnIoJmk5MTUtPmRybSwKKwkJCSJbQ09OTkVDVE9SOiVkOiVzXSBiYWNrbGlnaHQgZGV2aWNl
ICVzIHJlZ2lzdGVyIGZhaWxlZDogJWxkXG4iLAorCQkJY29ubmVjdG9yLT5iYXNlLmJhc2UuaWQs
IGNvbm5lY3Rvci0+YmFzZS5uYW1lLCBuYW1lLCBQVFJfRVJSKGJkKSk7CisJCXJldCA9IFBUUl9F
UlIoYmQpOworCQlnb3RvIG91dDsKKwl9CisKKwlwYW5lbC0+YmFja2xpZ2h0LmRldmljZSA9IGJk
OworCisJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKKwkJICAgICJbQ09OTkVDVE9SOiVkOiVzXSBi
YWNrbGlnaHQgZGV2aWNlICVzIHJlZ2lzdGVyZWRcbiIsCisJCSAgICBjb25uZWN0b3ItPmJhc2Uu
YmFzZS5pZCwgY29ubmVjdG9yLT5iYXNlLm5hbWUsIG5hbWUpOworCitvdXQ6CisJa2ZyZWUobmFt
ZSk7CisKKwlyZXR1cm4gcmV0OworfQorCit2b2lkIGludGVsX2JhY2tsaWdodF9kZXZpY2VfdW5y
ZWdpc3RlcihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3RydWN0IGlu
dGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCisJaWYgKHBhbmVsLT5iYWNr
bGlnaHQuZGV2aWNlKSB7CisJCWJhY2tsaWdodF9kZXZpY2VfdW5yZWdpc3RlcihwYW5lbC0+YmFj
a2xpZ2h0LmRldmljZSk7CisJCXBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlID0gTlVMTDsKKwl9Cit9
CisjZW5kaWYgLyogQ09ORklHX0JBQ0tMSUdIVF9DTEFTU19ERVZJQ0UgKi8KKworLyoKKyAqIENO
UDogUFdNIGNsb2NrIGZyZXF1ZW5jeSBpcyAxOS4yIE1IeiBvciAyNCBNSHouCisgKiAgICAgIFBX
TSBpbmNyZW1lbnQgPSAxCisgKi8KK3N0YXRpYyB1MzIgY25wX2h6X3RvX3B3bShzdHJ1Y3QgaW50
ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIHUzMiBwd21fZnJlcV9oeikKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwor
CisJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKEtIeihSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5y
YXdjbGtfZnJlcSksCisJCQkJIHB3bV9mcmVxX2h6KTsKK30KKworLyoKKyAqIEJYVDogUFdNIGNs
b2NrIGZyZXF1ZW5jeSA9IDE5LjIgTUh6LgorICovCitzdGF0aWMgdTMyIGJ4dF9oel90b19wd20o
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCit7CisJ
cmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKEtIeigxOTIwMCksIHB3bV9mcmVxX2h6KTsKK30KKwor
LyoKKyAqIFNQVDogVGhpcyB2YWx1ZSByZXByZXNlbnRzIHRoZSBwZXJpb2Qgb2YgdGhlIFBXTSBz
dHJlYW0gaW4gY2xvY2sgcGVyaW9kcworICogbXVsdGlwbGllZCBieSAxNiAoZGVmYXVsdCBpbmNy
ZW1lbnQpIG9yIDEyOCAoYWx0ZXJuYXRlIGluY3JlbWVudCBzZWxlY3RlZCBpbgorICogU0NISUNL
RU5fMSBiaXQgMCkuIFBXTSBjbG9jayBpcyAyNCBNSHouCisgKi8KK3N0YXRpYyB1MzIgc3B0X2h6
X3RvX3B3bShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIHUzMiBwd21fZnJlcV9o
eikKK3sKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisJ
dTMyIG11bDsKKworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmFsdGVybmF0ZV9wd21faW5jcmVtZW50
KQorCQltdWwgPSAxMjg7CisJZWxzZQorCQltdWwgPSAxNjsKKworCXJldHVybiBESVZfUk9VTkRf
Q0xPU0VTVChNSHooMjQpLCBwd21fZnJlcV9oeiAqIG11bCk7Cit9CisKKy8qCisgKiBMUFQ6IFRo
aXMgdmFsdWUgcmVwcmVzZW50cyB0aGUgcGVyaW9kIG9mIHRoZSBQV00gc3RyZWFtIGluIGNsb2Nr
IHBlcmlvZHMKKyAqIG11bHRpcGxpZWQgYnkgMTI4IChkZWZhdWx0IGluY3JlbWVudCkgb3IgMTYg
KGFsdGVybmF0ZSBpbmNyZW1lbnQsIHNlbGVjdGVkIGluCisgKiBMUFQgU09VVEhfQ0hJQ0tFTjIg
cmVnaXN0ZXIgYml0IDUpLgorICovCitzdGF0aWMgdTMyIGxwdF9oel90b19wd20oc3RydWN0IGlu
dGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisJdTMyIG11
bCwgY2xvY2s7CisKKwlpZiAocGFuZWwtPmJhY2tsaWdodC5hbHRlcm5hdGVfcHdtX2luY3JlbWVu
dCkKKwkJbXVsID0gMTY7CisJZWxzZQorCQltdWwgPSAxMjg7CisKKwlpZiAoSEFTX1BDSF9MUFRf
SChkZXZfcHJpdikpCisJCWNsb2NrID0gTUh6KDEzNSk7IC8qIExQVDpIICovCisJZWxzZQorCQlj
bG9jayA9IE1IeigyNCk7IC8qIExQVDpMUCAqLworCisJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNU
KGNsb2NrLCBwd21fZnJlcV9oeiAqIG11bCk7Cit9CisKKy8qCisgKiBJTEsvU05CL0lWQjogVGhp
cyB2YWx1ZSByZXByZXNlbnRzIHRoZSBwZXJpb2Qgb2YgdGhlIFBXTSBzdHJlYW0gaW4gUENICisg
KiBkaXNwbGF5IHJhdyBjbG9ja3MgbXVsdGlwbGllZCBieSAxMjguCisgKi8KK3N0YXRpYyB1MzIg
cGNoX2h6X3RvX3B3bShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIHUzMiBwd21f
ZnJlcV9oeikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCisJcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKEtIeihS
VU5USU1FX0lORk8oZGV2X3ByaXYpLT5yYXdjbGtfZnJlcSksCisJCQkJIHB3bV9mcmVxX2h6ICog
MTI4KTsKK30KKworLyoKKyAqIEdlbjI6IFRoaXMgZmllbGQgZGV0ZXJtaW5lcyB0aGUgbnVtYmVy
IG9mIHRpbWUgYmFzZSBldmVudHMgKGRpc3BsYXkgY29yZQorICogY2xvY2sgZnJlcXVlbmN5LzMy
KSBpbiB0b3RhbCBmb3IgYSBjb21wbGV0ZSBjeWNsZSBvZiBtb2R1bGF0ZWQgYmFja2xpZ2h0Cisg
KiBjb250cm9sLgorICoKKyAqIEdlbjM6IEEgdGltZSBiYXNlIGV2ZW50IGVxdWFscyB0aGUgZGlz
cGxheSBjb3JlIGNsb2NrIChbRGV2UE5WXSBIUkFXIGNsb2NrKQorICogZGl2aWRlZCBieSAzMi4K
KyAqLworc3RhdGljIHUzMiBpOXh4X2h6X3RvX3B3bShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IsIHUzMiBwd21fZnJlcV9oeikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCWludCBjbG9jazsKKwor
CWlmIChJU19QSU5FVklFVyhkZXZfcHJpdikpCisJCWNsb2NrID0gS0h6KFJVTlRJTUVfSU5GTyhk
ZXZfcHJpdiktPnJhd2Nsa19mcmVxKTsKKwllbHNlCisJCWNsb2NrID0gS0h6KGRldl9wcml2LT5j
ZGNsay5ody5jZGNsayk7CisKKwlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoY2xvY2ssIHB3bV9m
cmVxX2h6ICogMzIpOworfQorCisvKgorICogR2VuNDogVGhpcyB2YWx1ZSByZXByZXNlbnRzIHRo
ZSBwZXJpb2Qgb2YgdGhlIFBXTSBzdHJlYW0gaW4gZGlzcGxheSBjb3JlCisgKiBjbG9ja3MgKFtE
ZXZDVEddIEhSQVcgY2xvY2tzKSBtdWx0aXBsaWVkIGJ5IDEyOC4KKyAqCisgKi8KK3N0YXRpYyB1
MzIgaTk2NV9oel90b19wd20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIg
cHdtX2ZyZXFfaHopCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlpbnQgY2xvY2s7CisKKwlpZiAoSVNfRzRYKGRl
dl9wcml2KSkKKwkJY2xvY2sgPSBLSHooUlVOVElNRV9JTkZPKGRldl9wcml2KS0+cmF3Y2xrX2Zy
ZXEpOworCWVsc2UKKwkJY2xvY2sgPSBLSHooZGV2X3ByaXYtPmNkY2xrLmh3LmNkY2xrKTsKKwor
CXJldHVybiBESVZfUk9VTkRfQ0xPU0VTVChjbG9jaywgcHdtX2ZyZXFfaHogKiAxMjgpOworfQor
CisvKgorICogVkxWOiBUaGlzIHZhbHVlIHJlcHJlc2VudHMgdGhlIHBlcmlvZCBvZiB0aGUgUFdN
IHN0cmVhbSBpbiBkaXNwbGF5IGNvcmUKKyAqIGNsb2NrcyAoW0RldkNUR10gMjAwTUh6IEhSQVcg
Y2xvY2tzKSBtdWx0aXBsaWVkIGJ5IDEyOCBvciAyNU1IeiBTMElYIGNsb2NrcworICogbXVsdGlw
bGllZCBieSAxNi4gQ0hWIHVzZXMgYSAxOS4yTUh6IFMwSVggY2xvY2suCisgKi8KK3N0YXRpYyB1
MzIgdmx2X2h6X3RvX3B3bShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIHUzMiBw
d21fZnJlcV9oeikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCWludCBtdWwsIGNsb2NrOworCisJaWYgKChpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBDQlIxX1ZMVikgJiBDQlJfUFdNX0NMT0NLX01VWF9TRUxFQ1Qp
ID09IDApIHsKKwkJaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCQkJY2xvY2sgPSBLSHoo
MTkyMDApOworCQllbHNlCisJCQljbG9jayA9IE1IeigyNSk7CisJCW11bCA9IDE2OworCX0gZWxz
ZSB7CisJCWNsb2NrID0gS0h6KFJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPnJhd2Nsa19mcmVxKTsK
KwkJbXVsID0gMTI4OworCX0KKworCXJldHVybiBESVZfUk9VTkRfQ0xPU0VTVChjbG9jaywgcHdt
X2ZyZXFfaHogKiBtdWwpOworfQorCitzdGF0aWMgdTE2IGdldF92YnRfcHdtX2ZyZXEoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoreworCXUxNiBwd21fZnJlcV9oeiA9IGRldl9w
cml2LT52YnQuYmFja2xpZ2h0LnB3bV9mcmVxX2h6OworCisJaWYgKHB3bV9mcmVxX2h6KSB7CisJ
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJWQlQgZGVmaW5lZCBiYWNrbGln
aHQgZnJlcXVlbmN5ICV1IEh6XG4iLAorCQkJICAgIHB3bV9mcmVxX2h6KTsKKwl9IGVsc2Ugewor
CQlwd21fZnJlcV9oeiA9IDIwMDsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkg
ICAgImRlZmF1bHQgYmFja2xpZ2h0IGZyZXF1ZW5jeSAldSBIelxuIiwKKwkJCSAgICBwd21fZnJl
cV9oeik7CisJfQorCisJcmV0dXJuIHB3bV9mcmVxX2h6OworfQorCitzdGF0aWMgdTMyIGdldF9i
YWNrbGlnaHRfbWF4X3ZidChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7
CisJdTE2IHB3bV9mcmVxX2h6ID0gZ2V0X3ZidF9wd21fZnJlcShkZXZfcHJpdik7CisJdTMyIHB3
bTsKKworCWlmICghcGFuZWwtPmJhY2tsaWdodC5wd21fZnVuY3MtPmh6X3RvX3B3bSkgeworCQlk
cm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAiYmFja2xpZ2h0IGZyZXF1ZW5jeSBj
b252ZXJzaW9uIG5vdCBzdXBwb3J0ZWRcbiIpOworCQlyZXR1cm4gMDsKKwl9CisKKwlwd20gPSBw
YW5lbC0+YmFja2xpZ2h0LnB3bV9mdW5jcy0+aHpfdG9fcHdtKGNvbm5lY3RvciwgcHdtX2ZyZXFf
aHopOworCWlmICghcHdtKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAg
ICJiYWNrbGlnaHQgZnJlcXVlbmN5IGNvbnZlcnNpb24gZmFpbGVkXG4iKTsKKwkJcmV0dXJuIDA7
CisJfQorCisJcmV0dXJuIHB3bTsKK30KKworLyoKKyAqIE5vdGU6IFRoZSBzZXR1cCBob29rcyBj
YW4ndCBhc3N1bWUgcGlwZSBpcyBzZXQhCisgKi8KK3N0YXRpYyB1MzIgZ2V0X2JhY2tsaWdodF9t
aW5fdmJ0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwor
CXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKwlpbnQgbWlu
OworCisJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xl
dmVsX21heCA9PSAwKTsKKworCS8qCisJICogWFhYOiBJZiB0aGUgdmJ0IHZhbHVlIGlzIDI1NSwg
aXQgbWFrZXMgbWluIGVxdWFsIHRvIG1heCwgd2hpY2ggbGVhZHMKKwkgKiB0byBwcm9ibGVtcy4g
VGhlcmUgYXJlIHN1Y2ggbWFjaGluZXMgb3V0IHRoZXJlLiBFaXRoZXIgb3VyCisJICogaW50ZXJw
cmV0YXRpb24gaXMgd3Jvbmcgb3IgdGhlIHZidCBoYXMgYm9ndXMgZGF0YS4gT3IgYm90aC4gU2Fm
ZWd1YXJkCisJICogYWdhaW5zdCB0aGlzIGJ5IGxldHRpbmcgdGhlIG1pbmltdW0gYmUgYXQgbW9z
dCAoYXJiaXRyYXJpbHkgY2hvc2VuKQorCSAqIDI1JSBvZiB0aGUgbWF4LgorCSAqLworCW1pbiA9
IGNsYW1wX3QoaW50LCBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0bmVzcywgMCwg
NjQpOworCWlmIChtaW4gIT0gZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQubWluX2JyaWdodG5lc3Mp
IHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgImNsYW1waW5nIFZCVCBt
aW4gYmFja2xpZ2h0ICVkLzI1NSB0byAlZC8yNTVcbiIsCisJCQkgICAgZGV2X3ByaXYtPnZidC5i
YWNrbGlnaHQubWluX2JyaWdodG5lc3MsIG1pbik7CisJfQorCisJLyogdmJ0IHZhbHVlIGlzIGEg
Y29lZmZpY2llbnQgaW4gcmFuZ2UgWzAuLjI1NV0gKi8KKwlyZXR1cm4gc2NhbGUobWluLCAwLCAy
NTUsIDAsIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCk7Cit9CisKK3N0YXRpYyBpbnQg
bHB0X3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIGVu
dW0gcGlwZSB1bnVzZWQpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVs
ID0gJmNvbm5lY3Rvci0+cGFuZWw7CisJdTMyIGNwdV9jdGwyLCBwY2hfY3RsMSwgcGNoX2N0bDIs
IHZhbDsKKwlib29sIGFsdCwgY3B1X21vZGU7CisKKwlpZiAoSEFTX1BDSF9MUFQoZGV2X3ByaXYp
KQorCQlhbHQgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBTT1VUSF9DSElDS0VOMikgJiBMUFRf
UFdNX0dSQU5VTEFSSVRZOworCWVsc2UKKwkJYWx0ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwg
U09VVEhfQ0hJQ0tFTjEpICYgU1BUX1BXTV9HUkFOVUxBUklUWTsKKwlwYW5lbC0+YmFja2xpZ2h0
LmFsdGVybmF0ZV9wd21faW5jcmVtZW50ID0gYWx0OworCisJcGNoX2N0bDEgPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxKTsKKwlwYW5lbC0+YmFja2xpZ2h0LmFjdGl2
ZV9sb3dfcHdtID0gcGNoX2N0bDEgJiBCTE1fUENIX1BPTEFSSVRZOworCisJcGNoX2N0bDIgPSBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwyKTsKKwlwYW5lbC0+YmFja2xp
Z2h0LnB3bV9sZXZlbF9tYXggPSBwY2hfY3RsMiA+PiAxNjsKKworCWNwdV9jdGwyID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DUFVfQ1RMMik7CisKKwlpZiAoIXBhbmVsLT5iYWNr
bGlnaHQucHdtX2xldmVsX21heCkKKwkJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ID0g
Z2V0X2JhY2tsaWdodF9tYXhfdmJ0KGNvbm5lY3Rvcik7CisKKwlpZiAoIXBhbmVsLT5iYWNrbGln
aHQucHdtX2xldmVsX21heCkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlwYW5lbC0+YmFja2xpZ2h0
LnB3bV9sZXZlbF9taW4gPSBnZXRfYmFja2xpZ2h0X21pbl92YnQoY29ubmVjdG9yKTsKKworCXBh
bmVsLT5iYWNrbGlnaHQucHdtX2VuYWJsZWQgPSBwY2hfY3RsMSAmIEJMTV9QQ0hfUFdNX0VOQUJM
RTsKKworCWNwdV9tb2RlID0gcGFuZWwtPmJhY2tsaWdodC5wd21fZW5hYmxlZCAmJiBIQVNfUENI
X0xQVChkZXZfcHJpdikgJiYKKwkJICAgIShwY2hfY3RsMSAmIEJMTV9QQ0hfT1ZFUlJJREVfRU5B
QkxFKSAmJgorCQkgICAoY3B1X2N0bDIgJiBCTE1fUFdNX0VOQUJMRSk7CisKKwlpZiAoY3B1X21v
ZGUpIHsKKwkJdmFsID0gcGNoX2dldF9iYWNrbGlnaHQoY29ubmVjdG9yLCB1bnVzZWQpOworCisJ
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJDUFUgYmFja2xpZ2h0IHJlZ2lz
dGVyIHdhcyBlbmFibGVkLCBzd2l0Y2hpbmcgdG8gUENIIG92ZXJyaWRlXG4iKTsKKworCQkvKiBX
cml0ZSBjb252ZXJ0ZWQgQ1BVIFBXTSB2YWx1ZSB0byBQQ0ggb3ZlcnJpZGUgcmVnaXN0ZXIgKi8K
KwkJbHB0X3NldF9iYWNrbGlnaHQoY29ubmVjdG9yLT5iYXNlLnN0YXRlLCB2YWwpOworCQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSwKKwkJCSAgICAgICBwY2hfY3Rs
MSB8IEJMTV9QQ0hfT1ZFUlJJREVfRU5BQkxFKTsKKworCQlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgQkxDX1BXTV9DUFVfQ1RMMiwKKwkJCSAgICAgICBjcHVfY3RsMiAmIH5CTE1fUFdNX0VOQUJM
RSk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgcGNoX3NldHVwX2JhY2tsaWdo
dChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSB1bnVzZWQpCit7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3It
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFu
ZWw7CisJdTMyIGNwdV9jdGwyLCBwY2hfY3RsMSwgcGNoX2N0bDI7CisKKwlwY2hfY3RsMSA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEpOworCXBhbmVsLT5iYWNrbGln
aHQuYWN0aXZlX2xvd19wd20gPSBwY2hfY3RsMSAmIEJMTV9QQ0hfUE9MQVJJVFk7CisKKwlwY2hf
Y3RsMiA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDIpOworCXBhbmVs
LT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA9IHBjaF9jdGwyID4+IDE2OworCisJaWYgKCFwYW5l
bC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpCisJCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVs
X21heCA9IGdldF9iYWNrbGlnaHRfbWF4X3ZidChjb25uZWN0b3IpOworCisJaWYgKCFwYW5lbC0+
YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpCisJCXJldHVybiAtRU5PREVWOworCisJcGFuZWwtPmJh
Y2tsaWdodC5wd21fbGV2ZWxfbWluID0gZ2V0X2JhY2tsaWdodF9taW5fdmJ0KGNvbm5lY3Rvcik7
CisKKwljcHVfY3RsMiA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1BVX0NUTDIp
OworCXBhbmVsLT5iYWNrbGlnaHQucHdtX2VuYWJsZWQgPSAoY3B1X2N0bDIgJiBCTE1fUFdNX0VO
QUJMRSkgJiYKKwkJKHBjaF9jdGwxICYgQkxNX1BDSF9QV01fRU5BQkxFKTsKKworCXJldHVybiAw
OworfQorCitzdGF0aWMgaW50IGk5eHhfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHVudXNlZCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOworCXN0cnVj
dCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKwl1MzIgY3RsLCB2YWw7
CisKKwljdGwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NUTCk7CisKKwlpZiAo
RElTUExBWV9WRVIoZGV2X3ByaXYpID09IDIgfHwgSVNfSTkxNUdNKGRldl9wcml2KSB8fCBJU19J
OTQ1R00oZGV2X3ByaXYpKQorCQlwYW5lbC0+YmFja2xpZ2h0LmNvbWJpbmF0aW9uX21vZGUgPSBj
dGwgJiBCTE1fTEVHQUNZX01PREU7CisKKwlpZiAoSVNfUElORVZJRVcoZGV2X3ByaXYpKQorCQlw
YW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID0gY3RsICYgQkxNX1BPTEFSSVRZX1BOVjsK
KworCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA9IGN0bCA+PiAxNzsKKworCWlmICgh
cGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4KSB7CisJCXBhbmVsLT5iYWNrbGlnaHQucHdt
X2xldmVsX21heCA9IGdldF9iYWNrbGlnaHRfbWF4X3ZidChjb25uZWN0b3IpOworCQlwYW5lbC0+
YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPj49IDE7CisJfQorCisJaWYgKCFwYW5lbC0+YmFja2xp
Z2h0LnB3bV9sZXZlbF9tYXgpCisJCXJldHVybiAtRU5PREVWOworCisJaWYgKHBhbmVsLT5iYWNr
bGlnaHQuY29tYmluYXRpb25fbW9kZSkKKwkJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4
ICo9IDB4ZmY7CisKKwlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9taW4gPSBnZXRfYmFja2xp
Z2h0X21pbl92YnQoY29ubmVjdG9yKTsKKworCXZhbCA9IGk5eHhfZ2V0X2JhY2tsaWdodChjb25u
ZWN0b3IsIHVudXNlZCk7CisJdmFsID0gaW50ZWxfcGFuZWxfaW52ZXJ0X3B3bV9sZXZlbChjb25u
ZWN0b3IsIHZhbCk7CisJdmFsID0gY2xhbXAodmFsLCBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZl
bF9taW4sIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCk7CisKKwlwYW5lbC0+YmFja2xp
Z2h0LnB3bV9lbmFibGVkID0gdmFsICE9IDA7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlu
dCBpOTY1X3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3Is
IGVudW0gcGlwZSB1bnVzZWQpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBh
bmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisJdTMyIGN0bCwgY3RsMjsKKworCWN0bDIgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NUTDIpOworCXBhbmVsLT5iYWNrbGlnaHQuY29t
YmluYXRpb25fbW9kZSA9IGN0bDIgJiBCTE1fQ09NQklOQVRJT05fTU9ERTsKKwlwYW5lbC0+YmFj
a2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID0gY3RsMiAmIEJMTV9QT0xBUklUWV9JOTY1OworCisJY3Rs
ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DVEwpOworCXBhbmVsLT5iYWNrbGln
aHQucHdtX2xldmVsX21heCA9IGN0bCA+PiAxNjsKKworCWlmICghcGFuZWwtPmJhY2tsaWdodC5w
d21fbGV2ZWxfbWF4KQorCQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPSBnZXRfYmFj
a2xpZ2h0X21heF92YnQoY29ubmVjdG9yKTsKKworCWlmICghcGFuZWwtPmJhY2tsaWdodC5wd21f
bGV2ZWxfbWF4KQorCQlyZXR1cm4gLUVOT0RFVjsKKworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNv
bWJpbmF0aW9uX21vZGUpCisJCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCAqPSAweGZm
OworCisJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluID0gZ2V0X2JhY2tsaWdodF9taW5f
dmJ0KGNvbm5lY3Rvcik7CisKKwlwYW5lbC0+YmFja2xpZ2h0LnB3bV9lbmFibGVkID0gY3RsMiAm
IEJMTV9QV01fRU5BQkxFOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgdmx2X3NldHVw
X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSBw
aXBlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29u
bmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0
b3ItPnBhbmVsOworCXUzMiBjdGwsIGN0bDI7CisKKwlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2
LT5kcm0sIHBpcGUgIT0gUElQRV9BICYmIHBpcGUgIT0gUElQRV9CKSkKKwkJcmV0dXJuIC1FTk9E
RVY7CisKKwljdGwyID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgVkxWX0JMQ19QV01fQ1RMMihw
aXBlKSk7CisJcGFuZWwtPmJhY2tsaWdodC5hY3RpdmVfbG93X3B3bSA9IGN0bDIgJiBCTE1fUE9M
QVJJVFlfSTk2NTsKKworCWN0bCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFZMVl9CTENfUFdN
X0NUTChwaXBlKSk7CisJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ID0gY3RsID4+IDE2
OworCisJaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpCisJCXBhbmVsLT5iYWNr
bGlnaHQucHdtX2xldmVsX21heCA9IGdldF9iYWNrbGlnaHRfbWF4X3ZidChjb25uZWN0b3IpOwor
CisJaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpCisJCXJldHVybiAtRU5PREVW
OworCisJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluID0gZ2V0X2JhY2tsaWdodF9taW5f
dmJ0KGNvbm5lY3Rvcik7CisKKwlwYW5lbC0+YmFja2xpZ2h0LnB3bV9lbmFibGVkID0gY3RsMiAm
IEJMTV9QV01fRU5BQkxFOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQKK2J4dF9zZXR1
cF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUg
dW51c2VkKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25u
ZWN0b3ItPnBhbmVsOworCXUzMiBwd21fY3RsLCB2YWw7CisKKwlwYW5lbC0+YmFja2xpZ2h0LmNv
bnRyb2xsZXIgPSBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5jb250cm9sbGVyOworCisJcHdtX2N0
bCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCisJCQkJQlhUX0JMQ19QV01fQ1RMKHBhbmVsLT5i
YWNrbGlnaHQuY29udHJvbGxlcikpOworCisJLyogQ29udHJvbGxlciAxIHVzZXMgdGhlIHV0aWxp
dHkgcGluLiAqLworCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIgPT0gMSkgeworCQl2
YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBVVElMX1BJTl9DVEwpOworCQlwYW5lbC0+YmFj
a2xpZ2h0LnV0aWxfcGluX2FjdGl2ZV9sb3cgPQorCQkJCQl2YWwgJiBVVElMX1BJTl9QT0xBUklU
WTsKKwl9CisKKwlwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID0gcHdtX2N0bCAmIEJY
VF9CTENfUFdNX1BPTEFSSVRZOworCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA9CisJ
CWludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJYVF9CTENfUFdNX0ZSRVEocGFuZWwtPmJhY2tsaWdo
dC5jb250cm9sbGVyKSk7CisKKwlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCkK
KwkJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ID0gZ2V0X2JhY2tsaWdodF9tYXhfdmJ0
KGNvbm5lY3Rvcik7CisKKwlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCkKKwkJ
cmV0dXJuIC1FTk9ERVY7CisKKwlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9taW4gPSBnZXRf
YmFja2xpZ2h0X21pbl92YnQoY29ubmVjdG9yKTsKKworCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Vu
YWJsZWQgPSBwd21fY3RsICYgQlhUX0JMQ19QV01fRU5BQkxFOworCisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQKK2NucF9zZXR1cF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yLCBlbnVtIHBpcGUgdW51c2VkKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGludGVs
X3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOworCXUzMiBwd21fY3RsOworCisJLyoK
KwkgKiBDTlAgaGFzIHRoZSBCWFQgaW1wbGVtZW50YXRpb24gb2YgYmFja2xpZ2h0LCBidXQgd2l0
aCBvbmx5IG9uZQorCSAqIGNvbnRyb2xsZXIuIFRPRE86IElDUCBoYXMgbXVsdGlwbGUgY29udHJv
bGxlcnMgYnV0IHdlIG9ubHkgdXNlCisJICogY29udHJvbGxlciAwIGZvciBub3cuCisJICovCisJ
cGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyID0gMDsKKworCXB3bV9jdGwgPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LAorCQkJCUJYVF9CTENfUFdNX0NUTChwYW5lbC0+YmFja2xpZ2h0LmNvbnRy
b2xsZXIpKTsKKworCXBhbmVsLT5iYWNrbGlnaHQuYWN0aXZlX2xvd19wd20gPSBwd21fY3RsICYg
QlhUX0JMQ19QV01fUE9MQVJJVFk7CisJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ID0K
KwkJaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgQlhUX0JMQ19QV01fRlJFUShwYW5lbC0+YmFja2xp
Z2h0LmNvbnRyb2xsZXIpKTsKKworCWlmICghcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4
KQorCQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPSBnZXRfYmFja2xpZ2h0X21heF92
YnQoY29ubmVjdG9yKTsKKworCWlmICghcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4KQor
CQlyZXR1cm4gLUVOT0RFVjsKKworCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21pbiA9IGdl
dF9iYWNrbGlnaHRfbWluX3ZidChjb25uZWN0b3IpOworCisJcGFuZWwtPmJhY2tsaWdodC5wd21f
ZW5hYmxlZCA9IHB3bV9jdGwgJiBCWFRfQkxDX1BXTV9FTkFCTEU7CisKKwlyZXR1cm4gMDsKK30K
Kworc3RhdGljIGludCBleHRfcHdtX3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IsCisJCQkJICAgZW51bSBwaXBlIHBpcGUpCit7CisJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwg
PSAmY29ubmVjdG9yLT5wYW5lbDsKKwljb25zdCBjaGFyICpkZXNjOworCXUzMiBsZXZlbDsKKwor
CS8qIEdldCB0aGUgcmlnaHQgUFdNIGNoaXAgZm9yIERTSSBiYWNrbGlnaHQgYWNjb3JkaW5nIHRv
IFZCVCAqLworCWlmIChkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPnB3bV9ibGMgPT0gUFBTX0JM
Q19QTUlDKSB7CisJCXBhbmVsLT5iYWNrbGlnaHQucHdtID0gcHdtX2dldChkZXYtPmRldiwgInB3
bV9wbWljX2JhY2tsaWdodCIpOworCQlkZXNjID0gIlBNSUMiOworCX0gZWxzZSB7CisJCXBhbmVs
LT5iYWNrbGlnaHQucHdtID0gcHdtX2dldChkZXYtPmRldiwgInB3bV9zb2NfYmFja2xpZ2h0Iik7
CisJCWRlc2MgPSAiU29DIjsKKwl9CisKKwlpZiAoSVNfRVJSKHBhbmVsLT5iYWNrbGlnaHQucHdt
KSkgeworCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAiRmFpbGVkIHRvIGdldCB0aGUgJXMgUFdN
IGNoaXBcbiIsCisJCQlkZXNjKTsKKwkJcGFuZWwtPmJhY2tsaWdodC5wd20gPSBOVUxMOworCQly
ZXR1cm4gLUVOT0RFVjsKKwl9CisKKwlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPSAx
MDA7IC8qIDEwMCUgKi8KKwlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9taW4gPSBnZXRfYmFj
a2xpZ2h0X21pbl92YnQoY29ubmVjdG9yKTsKKworCWlmIChwd21faXNfZW5hYmxlZChwYW5lbC0+
YmFja2xpZ2h0LnB3bSkpIHsKKwkJLyogUFdNIGlzIGFscmVhZHkgZW5hYmxlZCwgdXNlIGV4aXN0
aW5nIHNldHRpbmdzICovCisJCXB3bV9nZXRfc3RhdGUocGFuZWwtPmJhY2tsaWdodC5wd20sICZw
YW5lbC0+YmFja2xpZ2h0LnB3bV9zdGF0ZSk7CisKKwkJbGV2ZWwgPSBwd21fZ2V0X3JlbGF0aXZl
X2R1dHlfY3ljbGUoJnBhbmVsLT5iYWNrbGlnaHQucHdtX3N0YXRlLAorCQkJCQkJICAgIDEwMCk7
CisJCWxldmVsID0gaW50ZWxfcGFuZWxfaW52ZXJ0X3B3bV9sZXZlbChjb25uZWN0b3IsIGxldmVs
KTsKKwkJcGFuZWwtPmJhY2tsaWdodC5wd21fZW5hYmxlZCA9IHRydWU7CisKKwkJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sICJQV00gYWxyZWFkeSBlbmFibGVkIGF0IGZyZXEgJWxkLCBWQlQg
ZnJlcSAlZCwgbGV2ZWwgJWRcbiIsCisJCQkgICAgTlNFQ19QRVJfU0VDIC8gKHVuc2lnbmVkIGxv
bmcpcGFuZWwtPmJhY2tsaWdodC5wd21fc3RhdGUucGVyaW9kLAorCQkJICAgIGdldF92YnRfcHdt
X2ZyZXEoZGV2X3ByaXYpLCBsZXZlbCk7CisJfSBlbHNlIHsKKwkJLyogU2V0IHBlcmlvZCBmcm9t
IFZCVCBmcmVxdWVuY3ksIGxlYXZlIG90aGVyIHNldHRpbmdzIGF0IDAuICovCisJCXBhbmVsLT5i
YWNrbGlnaHQucHdtX3N0YXRlLnBlcmlvZCA9CisJCQlOU0VDX1BFUl9TRUMgLyBnZXRfdmJ0X3B3
bV9mcmVxKGRldl9wcml2KTsKKwl9CisKKwlkcm1faW5mbygmZGV2X3ByaXYtPmRybSwgIlVzaW5n
ICVzIFBXTSBmb3IgTENEIGJhY2tsaWdodCBjb250cm9sXG4iLAorCQkgZGVzYyk7CisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyB2b2lkIGludGVsX3B3bV9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCit7CisJc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3Rh
dGUtPmNvbm5lY3Rvcik7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3It
PnBhbmVsOworCisJcGFuZWwtPmJhY2tsaWdodC5wd21fZnVuY3MtPnNldChjb25uX3N0YXRlLAor
CQkJCSAgICAgICBpbnRlbF9wYW5lbF9pbnZlcnRfcHdtX2xldmVsKGNvbm5lY3RvciwgbGV2ZWwp
KTsKK30KKworc3RhdGljIHUzMiBpbnRlbF9wd21fZ2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSBwaXBlKQoreworCXN0cnVjdCBpbnRlbF9w
YW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKworCXJldHVybiBpbnRlbF9wYW5lbF9p
bnZlcnRfcHdtX2xldmVsKGNvbm5lY3RvciwKKwkJCQkJICAgIHBhbmVsLT5iYWNrbGlnaHQucHdt
X2Z1bmNzLT5nZXQoY29ubmVjdG9yLCBwaXBlKSk7Cit9CisKK3N0YXRpYyB2b2lkIGludGVsX3B3
bV9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAorCQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9
IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOworCXN0cnVjdCBpbnRl
bF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKworCXBhbmVsLT5iYWNrbGlnaHQu
cHdtX2Z1bmNzLT5lbmFibGUoY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSwKKwkJCQkJICAgaW50ZWxf
cGFuZWxfaW52ZXJ0X3B3bV9sZXZlbChjb25uZWN0b3IsIGxldmVsKSk7Cit9CisKK3N0YXRpYyB2
b2lkIGludGVsX3B3bV9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyIGxldmVsKQoreworCXN0cnVjdCBpbnRlbF9jb25uZWN0
b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3Ip
OworCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKKworCXBh
bmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzLT5kaXNhYmxlKGNvbm5fc3RhdGUsCisJCQkJCSAgICBp
bnRlbF9wYW5lbF9pbnZlcnRfcHdtX2xldmVsKGNvbm5lY3RvciwgbGV2ZWwpKTsKK30KKworc3Rh
dGljIGludCBpbnRlbF9wd21fc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmNvbm5lY3RvciwgZW51bSBwaXBlIHBpcGUpCit7CisJc3RydWN0IGludGVsX3BhbmVsICpwYW5l
bCA9ICZjb25uZWN0b3ItPnBhbmVsOworCWludCByZXQgPSBwYW5lbC0+YmFja2xpZ2h0LnB3bV9m
dW5jcy0+c2V0dXAoY29ubmVjdG9yLCBwaXBlKTsKKworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4g
cmV0OworCisJcGFuZWwtPmJhY2tsaWdodC5taW4gPSBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZl
bF9taW47CisJcGFuZWwtPmJhY2tsaWdodC5tYXggPSBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZl
bF9tYXg7CisJcGFuZWwtPmJhY2tsaWdodC5sZXZlbCA9IGludGVsX3B3bV9nZXRfYmFja2xpZ2h0
KGNvbm5lY3RvciwgcGlwZSk7CisJcGFuZWwtPmJhY2tsaWdodC5lbmFibGVkID0gcGFuZWwtPmJh
Y2tsaWdodC5wd21fZW5hYmxlZDsKKworCXJldHVybiAwOworfQorCit2b2lkIGludGVsX3BhbmVs
X3VwZGF0ZV9iYWNrbGlnaHQoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJ
ICBzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCit7CisJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVj
dG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2
KTsKKwlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7CisKKwlp
ZiAoIXBhbmVsLT5iYWNrbGlnaHQucHJlc2VudCkKKwkJcmV0dXJuOworCisJbXV0ZXhfbG9jaygm
ZGV2X3ByaXYtPmJhY2tsaWdodF9sb2NrKTsKKwlpZiAoIXBhbmVsLT5iYWNrbGlnaHQuZW5hYmxl
ZCkKKwkJX19pbnRlbF9wYW5lbF9lbmFibGVfYmFja2xpZ2h0KGNydGNfc3RhdGUsIGNvbm5fc3Rh
dGUpOworCisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOworfQorCitp
bnQgaW50ZWxfcGFuZWxfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25u
ZWN0b3IsIGVudW0gcGlwZSBwaXBlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmludGVsX2Nvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uZWN0b3IpOworCXN0cnVj
dCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmaW50ZWxfY29ubmVjdG9yLT5wYW5lbDsKKwlpbnQgcmV0
OworCisJaWYgKCFkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wcmVzZW50KSB7CisJCWlmIChkZXZf
cHJpdi0+cXVpcmtzICYgUVVJUktfQkFDS0xJR0hUX1BSRVNFTlQpIHsKKwkJCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAorCQkJCSAgICAibm8gYmFja2xpZ2h0IHByZXNlbnQgcGVyIFZCVCwg
YnV0IHByZXNlbnQgcGVyIHF1aXJrXG4iKTsKKwkJfSBlbHNlIHsKKwkJCWRybV9kYmdfa21zKCZk
ZXZfcHJpdi0+ZHJtLAorCQkJCSAgICAibm8gYmFja2xpZ2h0IHByZXNlbnQgcGVyIFZCVFxuIik7
CisJCQlyZXR1cm4gMDsKKwkJfQorCX0KKworCS8qIGVuc3VyZSBpbnRlbF9wYW5lbCBoYXMgYmVl
biBpbml0aWFsaXplZCBmaXJzdCAqLworCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwg
IXBhbmVsLT5iYWNrbGlnaHQuZnVuY3MpKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCS8qIHNldCBs
ZXZlbCBhbmQgbWF4IGluIHBhbmVsIHN0cnVjdCAqLworCW11dGV4X2xvY2soJmRldl9wcml2LT5i
YWNrbGlnaHRfbG9jayk7CisJcmV0ID0gcGFuZWwtPmJhY2tsaWdodC5mdW5jcy0+c2V0dXAoaW50
ZWxfY29ubmVjdG9yLCBwaXBlKTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5iYWNrbGlnaHRf
bG9jayk7CisKKwlpZiAocmV0KSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJ
ICAgICJmYWlsZWQgdG8gc2V0dXAgYmFja2xpZ2h0IGZvciBjb25uZWN0b3IgJXNcbiIsCisJCQkg
ICAgY29ubmVjdG9yLT5uYW1lKTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwlwYW5lbC0+YmFja2xp
Z2h0LnByZXNlbnQgPSB0cnVlOworCisJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCSAg
ICAiQ29ubmVjdG9yICVzIGJhY2tsaWdodCBpbml0aWFsaXplZCwgJXMsIGJyaWdodG5lc3MgJXUv
JXVcbiIsCisJCSAgICBjb25uZWN0b3ItPm5hbWUsCisJCSAgICBlbmFibGVkZGlzYWJsZWQocGFu
ZWwtPmJhY2tsaWdodC5lbmFibGVkKSwKKwkJICAgIHBhbmVsLT5iYWNrbGlnaHQubGV2ZWwsIHBh
bmVsLT5iYWNrbGlnaHQubWF4KTsKKworCXJldHVybiAwOworfQorCit2b2lkIGludGVsX3BhbmVs
X2Rlc3Ryb3lfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwpCit7CisJLyogZGlz
cG9zZSBvZiB0aGUgcHdtICovCisJaWYgKHBhbmVsLT5iYWNrbGlnaHQucHdtKQorCQlwd21fcHV0
KHBhbmVsLT5iYWNrbGlnaHQucHdtKTsKKworCXBhbmVsLT5iYWNrbGlnaHQucHJlc2VudCA9IGZh
bHNlOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3BhbmVsX2JsX2Z1bmNzIGJ4dF9w
d21fZnVuY3MgPSB7CisJLnNldHVwID0gYnh0X3NldHVwX2JhY2tsaWdodCwKKwkuZW5hYmxlID0g
Ynh0X2VuYWJsZV9iYWNrbGlnaHQsCisJLmRpc2FibGUgPSBieHRfZGlzYWJsZV9iYWNrbGlnaHQs
CisJLnNldCA9IGJ4dF9zZXRfYmFja2xpZ2h0LAorCS5nZXQgPSBieHRfZ2V0X2JhY2tsaWdodCwK
KwkuaHpfdG9fcHdtID0gYnh0X2h6X3RvX3B3bSwKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGFuZWxfYmxfZnVuY3MgY25wX3B3bV9mdW5jcyA9IHsKKwkuc2V0dXAgPSBjbnBfc2V0
dXBfYmFja2xpZ2h0LAorCS5lbmFibGUgPSBjbnBfZW5hYmxlX2JhY2tsaWdodCwKKwkuZGlzYWJs
ZSA9IGNucF9kaXNhYmxlX2JhY2tsaWdodCwKKwkuc2V0ID0gYnh0X3NldF9iYWNrbGlnaHQsCisJ
LmdldCA9IGJ4dF9nZXRfYmFja2xpZ2h0LAorCS5oel90b19wd20gPSBjbnBfaHpfdG9fcHdtLAor
fTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9wYW5lbF9ibF9mdW5jcyBscHRfcHdtX2Z1
bmNzID0geworCS5zZXR1cCA9IGxwdF9zZXR1cF9iYWNrbGlnaHQsCisJLmVuYWJsZSA9IGxwdF9l
bmFibGVfYmFja2xpZ2h0LAorCS5kaXNhYmxlID0gbHB0X2Rpc2FibGVfYmFja2xpZ2h0LAorCS5z
ZXQgPSBscHRfc2V0X2JhY2tsaWdodCwKKwkuZ2V0ID0gbHB0X2dldF9iYWNrbGlnaHQsCisJLmh6
X3RvX3B3bSA9IGxwdF9oel90b19wd20sCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVs
X3BhbmVsX2JsX2Z1bmNzIHNwdF9wd21fZnVuY3MgPSB7CisJLnNldHVwID0gbHB0X3NldHVwX2Jh
Y2tsaWdodCwKKwkuZW5hYmxlID0gbHB0X2VuYWJsZV9iYWNrbGlnaHQsCisJLmRpc2FibGUgPSBs
cHRfZGlzYWJsZV9iYWNrbGlnaHQsCisJLnNldCA9IGxwdF9zZXRfYmFja2xpZ2h0LAorCS5nZXQg
PSBscHRfZ2V0X2JhY2tsaWdodCwKKwkuaHpfdG9fcHdtID0gc3B0X2h6X3RvX3B3bSwKK307CisK
K3N0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfcGFuZWxfYmxfZnVuY3MgcGNoX3B3bV9mdW5jcyA9
IHsKKwkuc2V0dXAgPSBwY2hfc2V0dXBfYmFja2xpZ2h0LAorCS5lbmFibGUgPSBwY2hfZW5hYmxl
X2JhY2tsaWdodCwKKwkuZGlzYWJsZSA9IHBjaF9kaXNhYmxlX2JhY2tsaWdodCwKKwkuc2V0ID0g
cGNoX3NldF9iYWNrbGlnaHQsCisJLmdldCA9IHBjaF9nZXRfYmFja2xpZ2h0LAorCS5oel90b19w
d20gPSBwY2hfaHpfdG9fcHdtLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9wYW5l
bF9ibF9mdW5jcyBleHRfcHdtX2Z1bmNzID0geworCS5zZXR1cCA9IGV4dF9wd21fc2V0dXBfYmFj
a2xpZ2h0LAorCS5lbmFibGUgPSBleHRfcHdtX2VuYWJsZV9iYWNrbGlnaHQsCisJLmRpc2FibGUg
PSBleHRfcHdtX2Rpc2FibGVfYmFja2xpZ2h0LAorCS5zZXQgPSBleHRfcHdtX3NldF9iYWNrbGln
aHQsCisJLmdldCA9IGV4dF9wd21fZ2V0X2JhY2tsaWdodCwKK307CisKK3N0YXRpYyBjb25zdCBz
dHJ1Y3QgaW50ZWxfcGFuZWxfYmxfZnVuY3Mgdmx2X3B3bV9mdW5jcyA9IHsKKwkuc2V0dXAgPSB2
bHZfc2V0dXBfYmFja2xpZ2h0LAorCS5lbmFibGUgPSB2bHZfZW5hYmxlX2JhY2tsaWdodCwKKwku
ZGlzYWJsZSA9IHZsdl9kaXNhYmxlX2JhY2tsaWdodCwKKwkuc2V0ID0gdmx2X3NldF9iYWNrbGln
aHQsCisJLmdldCA9IHZsdl9nZXRfYmFja2xpZ2h0LAorCS5oel90b19wd20gPSB2bHZfaHpfdG9f
cHdtLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9wYW5lbF9ibF9mdW5jcyBpOTY1
X3B3bV9mdW5jcyA9IHsKKwkuc2V0dXAgPSBpOTY1X3NldHVwX2JhY2tsaWdodCwKKwkuZW5hYmxl
ID0gaTk2NV9lbmFibGVfYmFja2xpZ2h0LAorCS5kaXNhYmxlID0gaTk2NV9kaXNhYmxlX2JhY2ts
aWdodCwKKwkuc2V0ID0gaTl4eF9zZXRfYmFja2xpZ2h0LAorCS5nZXQgPSBpOXh4X2dldF9iYWNr
bGlnaHQsCisJLmh6X3RvX3B3bSA9IGk5NjVfaHpfdG9fcHdtLAorfTsKKworc3RhdGljIGNvbnN0
IHN0cnVjdCBpbnRlbF9wYW5lbF9ibF9mdW5jcyBpOXh4X3B3bV9mdW5jcyA9IHsKKwkuc2V0dXAg
PSBpOXh4X3NldHVwX2JhY2tsaWdodCwKKwkuZW5hYmxlID0gaTl4eF9lbmFibGVfYmFja2xpZ2h0
LAorCS5kaXNhYmxlID0gaTl4eF9kaXNhYmxlX2JhY2tsaWdodCwKKwkuc2V0ID0gaTl4eF9zZXRf
YmFja2xpZ2h0LAorCS5nZXQgPSBpOXh4X2dldF9iYWNrbGlnaHQsCisJLmh6X3RvX3B3bSA9IGk5
eHhfaHpfdG9fcHdtLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9wYW5lbF9ibF9m
dW5jcyBwd21fYmxfZnVuY3MgPSB7CisJLnNldHVwID0gaW50ZWxfcHdtX3NldHVwX2JhY2tsaWdo
dCwKKwkuZW5hYmxlID0gaW50ZWxfcHdtX2VuYWJsZV9iYWNrbGlnaHQsCisJLmRpc2FibGUgPSBp
bnRlbF9wd21fZGlzYWJsZV9iYWNrbGlnaHQsCisJLnNldCA9IGludGVsX3B3bV9zZXRfYmFja2xp
Z2h0LAorCS5nZXQgPSBpbnRlbF9wd21fZ2V0X2JhY2tsaWdodCwKK307CisKKy8qIFNldCB1cCBj
aGlwIHNwZWNpZmljIGJhY2tsaWdodCBmdW5jdGlvbnMgKi8KK3ZvaWQKK2ludGVsX3BhbmVsX2lu
aXRfYmFja2xpZ2h0X2Z1bmNzKHN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwpCit7CisJc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0KKwkJY29udGFpbmVyX29mKHBhbmVsLCBzdHJ1
Y3QgaW50ZWxfY29ubmVjdG9yLCBwYW5lbCk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKKworCWlmIChjb25uZWN0b3It
PmJhc2UuY29ubmVjdG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVDVE9SX0RTSSAmJgorCSAgICBp
bnRlbF9kc2lfZGNzX2luaXRfYmFja2xpZ2h0X2Z1bmNzKGNvbm5lY3RvcikgPT0gMCkKKwkJcmV0
dXJuOworCisJaWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpIHx8IElTX0JST1hUT04oZGV2X3By
aXYpKSB7CisJCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzID0gJmJ4dF9wd21fZnVuY3M7CisJ
fSBlbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShkZXZfcHJpdikgPj0gUENIX0NOUCkgeworCQlwYW5l
bC0+YmFja2xpZ2h0LnB3bV9mdW5jcyA9ICZjbnBfcHdtX2Z1bmNzOworCX0gZWxzZSBpZiAoSU5U
RUxfUENIX1RZUEUoZGV2X3ByaXYpID49IFBDSF9MUFQpIHsKKwkJaWYgKEhBU19QQ0hfTFBUKGRl
dl9wcml2KSkKKwkJCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzID0gJmxwdF9wd21fZnVuY3M7
CisJCWVsc2UKKwkJCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzID0gJnNwdF9wd21fZnVuY3M7
CisJfSBlbHNlIGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgeworCQlwYW5lbC0+YmFja2xp
Z2h0LnB3bV9mdW5jcyA9ICZwY2hfcHdtX2Z1bmNzOworCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklF
VyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKKwkJaWYgKGNvbm5lY3Rv
ci0+YmFzZS5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNUT1JfRFNJKSB7CisJCQlw
YW5lbC0+YmFja2xpZ2h0LnB3bV9mdW5jcyA9ICZleHRfcHdtX2Z1bmNzOworCQl9IGVsc2Ugewor
CQkJcGFuZWwtPmJhY2tsaWdodC5wd21fZnVuY3MgPSAmdmx2X3B3bV9mdW5jczsKKwkJfQorCX0g
ZWxzZSBpZiAoRElTUExBWV9WRVIoZGV2X3ByaXYpID09IDQpIHsKKwkJcGFuZWwtPmJhY2tsaWdo
dC5wd21fZnVuY3MgPSAmaTk2NV9wd21fZnVuY3M7CisJfSBlbHNlIHsKKwkJcGFuZWwtPmJhY2ts
aWdodC5wd21fZnVuY3MgPSAmaTl4eF9wd21fZnVuY3M7CisJfQorCisJaWYgKGNvbm5lY3Rvci0+
YmFzZS5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNUT1JfZURQICYmCisJICAgIGlu
dGVsX2RwX2F1eF9pbml0X2JhY2tsaWdodF9mdW5jcyhjb25uZWN0b3IpID09IDApCisJCXJldHVy
bjsKKworCS8qIFdlJ3JlIHVzaW5nIGEgc3RhbmRhcmQgUFdNIGJhY2tsaWdodCBpbnRlcmZhY2Ug
Ki8KKwlwYW5lbC0+YmFja2xpZ2h0LmZ1bmNzID0gJnB3bV9ibF9mdW5jczsKK30KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmFja2xpZ2h0LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2JhY2tsaWdodC5oCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMjgyMDIwY2I0N2Q1Ci0tLSAvZGV2L251bGwKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9iYWNrbGlnaHQuaApAQCAtMCww
ICsxLDUxIEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29w
eXJpZ2h0IMKpIDIwMjEgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIF9fSU5URUxf
QkFDS0xJR0hUX0hfXworI2RlZmluZSBfX0lOVEVMX0JBQ0tMSUdIVF9IX18KKworI2luY2x1ZGUg
PGxpbnV4L3R5cGVzLmg+CisKK3N0cnVjdCBkcm1fY29ubmVjdG9yOworc3RydWN0IGRybV9jb25u
ZWN0b3Jfc3RhdGU7CitzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlOworc3RydWN0IGludGVsX2Nv
bm5lY3RvcjsKK3N0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOworc3RydWN0IGludGVsX2VuY29kZXI7
CitzdHJ1Y3QgaW50ZWxfcGFuZWw7CitlbnVtIHBpcGU7CisKK3ZvaWQgaW50ZWxfcGFuZWxfaW5p
dF9iYWNrbGlnaHRfZnVuY3Moc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCk7Cit2b2lkIGludGVs
X3BhbmVsX2Rlc3Ryb3lfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwpOwordm9p
ZCBpbnRlbF9wYW5lbF9zZXRfYmFja2xpZ2h0X2FjcGkoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKmNvbm5fc3RhdGUsCisJCQkJICAgIHUzMiBsZXZlbCwgdTMyIG1heCk7CitpbnQg
aW50ZWxfcGFuZWxfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0
b3IsCisJCQkJZW51bSBwaXBlIHBpcGUpOwordm9pZCBpbnRlbF9wYW5lbF9lbmFibGVfYmFja2xp
Z2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgY29u
c3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpOwordm9pZCBpbnRlbF9w
YW5lbF91cGRhdGVfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAor
CQkJCSAgc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgIGNvbnN0IHN0cnVjdCBkcm1fY29u
bmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKTsKK3ZvaWQgaW50ZWxfcGFuZWxfZGlzYWJsZV9iYWNr
bGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlKTsK
K3ZvaWQgaW50ZWxfcGFuZWxfc2V0X3B3bV9sZXZlbChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyIGxldmVsKTsKK3UzMiBpbnRlbF9wYW5lbF9pbnZlcnRf
cHdtX2xldmVsKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIGxldmVsKTsK
K3UzMiBpbnRlbF9wYW5lbF9iYWNrbGlnaHRfbGV2ZWxfdG9fcHdtKHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvciwgdTMyIGxldmVsKTsKK3UzMiBpbnRlbF9wYW5lbF9iYWNrbGlnaHRf
bGV2ZWxfZnJvbV9wd20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgdmFs
KTsKKworI2lmIElTX0VOQUJMRUQoQ09ORklHX0JBQ0tMSUdIVF9DTEFTU19ERVZJQ0UpCitpbnQg
aW50ZWxfYmFja2xpZ2h0X2RldmljZV9yZWdpc3RlcihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IpOwordm9pZCBpbnRlbF9iYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIoc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKTsKKyNlbHNlIC8qIENPTkZJR19CQUNLTElHSFRf
Q0xBU1NfREVWSUNFICovCitzdGF0aWMgaW5saW5lIGludCBpbnRlbF9iYWNrbGlnaHRfZGV2aWNl
X3JlZ2lzdGVyKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3sKKwlyZXR1cm4g
MDsKK30KK3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9iYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0
ZXIoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQoreworfQorI2VuZGlmIC8qIENP
TkZJR19CQUNLTElHSFRfQ0xBU1NfREVWSUNFICovCisKKyNlbmRpZiAvKiBfX0lOVEVMX0JBQ0tM
SUdIVF9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfY29ubmVjdG9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Nvbm5l
Y3Rvci5jCmluZGV4IDliZWQxY2NlY2VhMC4uNGY0OWQ3ODJlY2EyIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Nvbm5lY3Rvci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29ubmVjdG9yLmMKQEAgLTI5LDEzICsyOSwxMyBA
QAogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljX2hlbHBlci5oPgogI2luY2x1ZGUgPGRybS9kcm1f
ZWRpZC5oPgogCi0jaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9wYW5lbC5oIgotCiAjaW5jbHVkZSAi
aTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpbnRlbF9iYWNrbGlnaHQuaCIKICNpbmNsdWRlICJpbnRl
bF9jb25uZWN0b3IuaCIKICNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X2RlYnVnZnMuaCIKICNpbmNs
dWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxfaGRjcC5oIgorI2lu
Y2x1ZGUgImludGVsX3BhbmVsLmgiCiAKIGludCBpbnRlbF9jb25uZWN0b3JfaW5pdChzdHJ1Y3Qg
aW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kZGkuYwppbmRleCBiN2EyZmNlNjg0YzkuLmU5NjM4MjkxYWMzMiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBAIC0yOSw2ICsyOSw3IEBACiAKICNp
bmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImludGVsX2F1ZGlvLmgiCisjaW5jbHVkZSAi
aW50ZWxfYmFja2xpZ2h0LmgiCiAjaW5jbHVkZSAiaW50ZWxfY29tYm9fcGh5LmgiCiAjaW5jbHVk
ZSAiaW50ZWxfY29ubmVjdG9yLmgiCiAjaW5jbHVkZSAiaW50ZWxfY3J0Yy5oIgpAQCAtNDgsNyAr
NDksNiBAQAogI2luY2x1ZGUgImludGVsX2hkbWkuaCIKICNpbmNsdWRlICJpbnRlbF9ob3RwbHVn
LmgiCiAjaW5jbHVkZSAiaW50ZWxfbHNwY29uLmgiCi0jaW5jbHVkZSAiaW50ZWxfcGFuZWwuaCIK
ICNpbmNsdWRlICJpbnRlbF9wcHMuaCIKICNpbmNsdWRlICJpbnRlbF9wc3IuaCIKICNpbmNsdWRl
ICJpbnRlbF9zcHJpdGUuaCIKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpp
bmRleCA4NjE0MDliYzIxMGQuLjkzNmViNDFlOTM2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHAuYwpAQCAtNDQsNiArNDQsNyBAQAogI2luY2x1ZGUgImk5MTVfZHJ2Lmgi
CiAjaW5jbHVkZSAiaW50ZWxfYXRvbWljLmgiCiAjaW5jbHVkZSAiaW50ZWxfYXVkaW8uaCIKKyNp
bmNsdWRlICJpbnRlbF9iYWNrbGlnaHQuaCIKICNpbmNsdWRlICJpbnRlbF9jb25uZWN0b3IuaCIK
ICNpbmNsdWRlICJpbnRlbF9kZGkuaCIKICNpbmNsdWRlICJpbnRlbF9kZS5oIgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eF9iYWNrbGlnaHQuYwpp
bmRleCA4ZTlhYzliYTFkMzguLjRhYTQ4YjQyNTgzZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9hdXhfYmFja2xpZ2h0LmMKQEAgLTM0LDkgKzM0
LDkgQEAKICAqIGZvciBzb21lIHJlYXNvbi4KICAqLwogCisjaW5jbHVkZSAiaW50ZWxfYmFja2xp
Z2h0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV90eXBlcy5oIgogI2luY2x1ZGUgImludGVs
X2RwX2F1eF9iYWNrbGlnaHQuaCIKLSNpbmNsdWRlICJpbnRlbF9wYW5lbC5oIgogCiAvKiBUT0RP
OgogICogSW1wbGVtZW50IEhEUiwgcmlnaHQgbm93IHdlIGp1c3QgaW1wbGVtZW50IHRoZSBiYXJl
IG1pbmltdW0gdG8gYnJpbmcgdXMgYmFjayBpbnRvIFNEUiBtb2RlIHNvIHdlCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHZkcy5jCmluZGV4IDdmNDBlOWY2MGJjMi4uNmQ2OGFj
NzliMjMxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2
ZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMuYwpAQCAt
NDAsNiArNDAsNyBAQAogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpbnRlbF9h
dG9taWMuaCIKKyNpbmNsdWRlICJpbnRlbF9iYWNrbGlnaHQuaCIKICNpbmNsdWRlICJpbnRlbF9j
b25uZWN0b3IuaCIKICNpbmNsdWRlICJpbnRlbF9kZS5oIgogI2luY2x1ZGUgImludGVsX2Rpc3Bs
YXlfdHlwZXMuaCIKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfb3ByZWdpb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ByZWdp
b24uYwppbmRleCBkZmQ3MjRlNTA2YjUuLjJiNDQ1ZjVjZWQxNSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vcHJlZ2lvbi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ByZWdpb24uYwpAQCAtMzAsMTAgKzMwLDkgQEAKICNp
bmNsdWRlIDxsaW51eC9maXJtd2FyZS5oPgogI2luY2x1ZGUgPGFjcGkvdmlkZW8uaD4KIAotI2lu
Y2x1ZGUgImRpc3BsYXkvaW50ZWxfcGFuZWwuaCIKLQogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAj
aW5jbHVkZSAiaW50ZWxfYWNwaS5oIgorI2luY2x1ZGUgImludGVsX2JhY2tsaWdodC5oIgogI2lu
Y2x1ZGUgImludGVsX2Rpc3BsYXlfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRlbF9vcHJlZ2lvbi5o
IgogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVs
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMKaW5kZXggN2Q3
YTYwYjRkMmRlLi5hZDU0NzY3NDQwYzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfcGFuZWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3BhbmVsLmMKQEAgLTI4LDE3ICsyOCwxMyBAQAogICogICAgICBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KICAqLwogCi0jZGVmaW5lIHByX2ZtdChmbXQpIEtC
VUlMRF9NT0ROQU1FICI6ICIgZm10Ci0KICNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KLSNpbmNs
dWRlIDxsaW51eC9tb2R1bGVwYXJhbS5oPgogI2luY2x1ZGUgPGxpbnV4L3B3bS5oPgogCisjaW5j
bHVkZSAiaW50ZWxfYmFja2xpZ2h0LmgiCiAjaW5jbHVkZSAiaW50ZWxfY29ubmVjdG9yLmgiCiAj
aW5jbHVkZSAiaW50ZWxfZGUuaCIKICNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCi0j
aW5jbHVkZSAiaW50ZWxfZHBfYXV4X2JhY2tsaWdodC5oIgotI2luY2x1ZGUgImludGVsX2RzaV9k
Y3NfYmFja2xpZ2h0LmgiCiAjaW5jbHVkZSAiaW50ZWxfcGFuZWwuaCIKIAogdm9pZApAQCAtNDU2
LDE3NjcgKzQ1Miw2IEBAIGludCBpbnRlbF9nbWNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJcmV0dXJuIDA7CiB9CiAKLS8qKgotICogc2NhbGUg
LSBzY2FsZSB2YWx1ZXMgZnJvbSBvbmUgcmFuZ2UgdG8gYW5vdGhlcgotICogQHNvdXJjZV92YWw6
IHZhbHVlIGluIHJhbmdlIFtAc291cmNlX21pbi4uQHNvdXJjZV9tYXhdCi0gKiBAc291cmNlX21p
bjogbWluaW11bSBsZWdhbCB2YWx1ZSBmb3IgQHNvdXJjZV92YWwKLSAqIEBzb3VyY2VfbWF4OiBt
YXhpbXVtIGxlZ2FsIHZhbHVlIGZvciBAc291cmNlX3ZhbAotICogQHRhcmdldF9taW46IGNvcnJl
c3BvbmRpbmcgdGFyZ2V0IHZhbHVlIGZvciBAc291cmNlX21pbgotICogQHRhcmdldF9tYXg6IGNv
cnJlc3BvbmRpbmcgdGFyZ2V0IHZhbHVlIGZvciBAc291cmNlX21heAotICoKLSAqIFJldHVybiBA
c291cmNlX3ZhbCBpbiByYW5nZSBbQHNvdXJjZV9taW4uLkBzb3VyY2VfbWF4XSBzY2FsZWQgdG8g
cmFuZ2UKLSAqIFtAdGFyZ2V0X21pbi4uQHRhcmdldF9tYXhdLgotICovCi1zdGF0aWMgdTMyIHNj
YWxlKHUzMiBzb3VyY2VfdmFsLAotCQkgdTMyIHNvdXJjZV9taW4sIHUzMiBzb3VyY2VfbWF4LAot
CQkgdTMyIHRhcmdldF9taW4sIHUzMiB0YXJnZXRfbWF4KQotewotCXU2NCB0YXJnZXRfdmFsOwot
Ci0JV0FSTl9PTihzb3VyY2VfbWluID4gc291cmNlX21heCk7Ci0JV0FSTl9PTih0YXJnZXRfbWlu
ID4gdGFyZ2V0X21heCk7Ci0KLQkvKiBkZWZlbnNpdmUgKi8KLQlzb3VyY2VfdmFsID0gY2xhbXAo
c291cmNlX3ZhbCwgc291cmNlX21pbiwgc291cmNlX21heCk7Ci0KLQkvKiBhdm9pZCBvdmVyZmxv
d3MgKi8KLQl0YXJnZXRfdmFsID0gbXVsX3UzMl91MzIoc291cmNlX3ZhbCAtIHNvdXJjZV9taW4s
Ci0JCQkJIHRhcmdldF9tYXggLSB0YXJnZXRfbWluKTsKLQl0YXJnZXRfdmFsID0gRElWX1JPVU5E
X0NMT1NFU1RfVUxMKHRhcmdldF92YWwsIHNvdXJjZV9tYXggLSBzb3VyY2VfbWluKTsKLQl0YXJn
ZXRfdmFsICs9IHRhcmdldF9taW47Ci0KLQlyZXR1cm4gdGFyZ2V0X3ZhbDsKLX0KLQotLyogU2Nh
bGUgdXNlcl9sZXZlbCBpbiByYW5nZSBbMC4udXNlcl9tYXhdIHRvIFswLi5od19tYXhdLCBjbGFt
cGluZyB0aGUgcmVzdWx0Ci0gKiB0byBbaHdfbWluLi5od19tYXhdLiAqLwotc3RhdGljIHUzMiBj
bGFtcF91c2VyX3RvX2h3KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwKLQkJCSAg
ICB1MzIgdXNlcl9sZXZlbCwgdTMyIHVzZXJfbWF4KQotewotCXN0cnVjdCBpbnRlbF9wYW5lbCAq
cGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQl1MzIgaHdfbGV2ZWw7Ci0KLQlod19sZXZlbCA9
IHNjYWxlKHVzZXJfbGV2ZWwsIDAsIHVzZXJfbWF4LCAwLCBwYW5lbC0+YmFja2xpZ2h0Lm1heCk7
Ci0JaHdfbGV2ZWwgPSBjbGFtcChod19sZXZlbCwgcGFuZWwtPmJhY2tsaWdodC5taW4sIHBhbmVs
LT5iYWNrbGlnaHQubWF4KTsKLQotCXJldHVybiBod19sZXZlbDsKLX0KLQotLyogU2NhbGUgaHdf
bGV2ZWwgaW4gcmFuZ2UgW2h3X21pbi4uaHdfbWF4XSB0byBbMC4udXNlcl9tYXhdLiAqLwotc3Rh
dGljIHUzMiBzY2FsZV9od190b191c2VyKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rv
ciwKLQkJCSAgICB1MzIgaHdfbGV2ZWwsIHUzMiB1c2VyX21heCkKLXsKLQlzdHJ1Y3QgaW50ZWxf
cGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlyZXR1cm4gc2NhbGUoaHdfbGV2
ZWwsIHBhbmVsLT5iYWNrbGlnaHQubWluLCBwYW5lbC0+YmFja2xpZ2h0Lm1heCwKLQkJICAgICAw
LCB1c2VyX21heCk7Ci19Ci0KLXUzMiBpbnRlbF9wYW5lbF9pbnZlcnRfcHdtX2xldmVsKHN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIHZhbCkKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCXN0
cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQotCWRybV9XQVJO
X09OKCZkZXZfcHJpdi0+ZHJtLCBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPT0gMCk7
Ci0KLQlpZiAoZGV2X3ByaXYtPnBhcmFtcy5pbnZlcnRfYnJpZ2h0bmVzcyA8IDApCi0JCXJldHVy
biB2YWw7Ci0KLQlpZiAoZGV2X3ByaXYtPnBhcmFtcy5pbnZlcnRfYnJpZ2h0bmVzcyA+IDAgfHwK
LQkgICAgZGV2X3ByaXYtPnF1aXJrcyAmIFFVSVJLX0lOVkVSVF9CUklHSFRORVNTKSB7Ci0JCXJl
dHVybiBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggLSB2YWwgKyBwYW5lbC0+YmFja2xp
Z2h0LnB3bV9sZXZlbF9taW47Ci0JfQotCi0JcmV0dXJuIHZhbDsKLX0KLQotdm9pZCBpbnRlbF9w
YW5lbF9zZXRfcHdtX2xldmVsKGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25u
X3N0YXRlLCB1MzIgdmFsKQotewotCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9
IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlkcm1fZGJnX2tt
cygmaTkxNS0+ZHJtLCAic2V0IGJhY2tsaWdodCBQV00gPSAlZFxuIiwgdmFsKTsKLQlwYW5lbC0+
YmFja2xpZ2h0LnB3bV9mdW5jcy0+c2V0KGNvbm5fc3RhdGUsIHZhbCk7Ci19Ci0KLXUzMiBpbnRl
bF9wYW5lbF9iYWNrbGlnaHRfbGV2ZWxfdG9fcHdtKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNv
bm5lY3RvciwgdTMyIHZhbCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFu
ZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQotCWRybV9XQVJOX09OX09OQ0UoJmRldl9wcml2LT5k
cm0sCi0JCQkgcGFuZWwtPmJhY2tsaWdodC5tYXggPT0gMCB8fCBwYW5lbC0+YmFja2xpZ2h0LnB3
bV9sZXZlbF9tYXggPT0gMCk7Ci0KLQl2YWwgPSBzY2FsZSh2YWwsIHBhbmVsLT5iYWNrbGlnaHQu
bWluLCBwYW5lbC0+YmFja2xpZ2h0Lm1heCwKLQkJICAgIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xl
dmVsX21pbiwgcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4KTsKLQotCXJldHVybiBpbnRl
bF9wYW5lbF9pbnZlcnRfcHdtX2xldmVsKGNvbm5lY3RvciwgdmFsKTsKLX0KLQotdTMyIGludGVs
X3BhbmVsX2JhY2tsaWdodF9sZXZlbF9mcm9tX3B3bShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IsIHUzMiB2YWwpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBh
bmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlkcm1fV0FSTl9PTl9PTkNFKCZkZXZfcHJpdi0+
ZHJtLAotCQkJIHBhbmVsLT5iYWNrbGlnaHQubWF4ID09IDAgfHwgcGFuZWwtPmJhY2tsaWdodC5w
d21fbGV2ZWxfbWF4ID09IDApOwotCi0JaWYgKGRldl9wcml2LT5wYXJhbXMuaW52ZXJ0X2JyaWdo
dG5lc3MgPiAwIHx8Ci0JICAgIChkZXZfcHJpdi0+cGFyYW1zLmludmVydF9icmlnaHRuZXNzID09
IDAgJiYgZGV2X3ByaXYtPnF1aXJrcyAmIFFVSVJLX0lOVkVSVF9CUklHSFRORVNTKSkKLQkJdmFs
ID0gcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4IC0gKHZhbCAtIHBhbmVsLT5iYWNrbGln
aHQucHdtX2xldmVsX21pbik7Ci0KLQlyZXR1cm4gc2NhbGUodmFsLCBwYW5lbC0+YmFja2xpZ2h0
LnB3bV9sZXZlbF9taW4sIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCwKLQkJICAgICBw
YW5lbC0+YmFja2xpZ2h0Lm1pbiwgcGFuZWwtPmJhY2tsaWdodC5tYXgpOwotfQotCi1zdGF0aWMg
dTMyIGxwdF9nZXRfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rvciwg
ZW51bSBwaXBlIHVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCi0JcmV0dXJuIGludGVsX2RlX3JlYWQo
ZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDIpICYgQkFDS0xJR0hUX0RVVFlfQ1lDTEVfTUFTSzsK
LX0KLQotc3RhdGljIHUzMiBwY2hfZ2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uZWN0b3IsIGVudW0gcGlwZSB1bnVzZWQpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQotCXJldHVybiBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NQVV9DVEwpICYgQkFDS0xJR0hUX0RVVFlf
Q1lDTEVfTUFTSzsKLX0KLQotc3RhdGljIHUzMiBpOXh4X2dldF9iYWNrbGlnaHQoc3RydWN0IGlu
dGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUgdW51c2VkKQotewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7
Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUzMiB2
YWw7Ci0KLQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NUTCkgJiBCQUNL
TElHSFRfRFVUWV9DWUNMRV9NQVNLOwotCWlmIChESVNQTEFZX1ZFUihkZXZfcHJpdikgPCA0KQot
CQl2YWwgPj49IDE7Ci0KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5jb21iaW5hdGlvbl9tb2RlKSB7
Ci0JCXU4IGxicGM7Ci0KLQkJcGNpX3JlYWRfY29uZmlnX2J5dGUodG9fcGNpX2RldihkZXZfcHJp
di0+ZHJtLmRldiksIExCUEMsICZsYnBjKTsKLQkJdmFsICo9IGxicGM7Ci0JfQotCi0JcmV0dXJu
IHZhbDsKLX0KLQotc3RhdGljIHUzMiB2bHZfZ2V0X2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29u
bmVjdG9yICpjb25uZWN0b3IsIGVudW0gcGlwZSBwaXBlKQotewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0KLQlpZiAo
ZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHBpcGUgIT0gUElQRV9BICYmIHBpcGUgIT0gUElQ
RV9CKSkKLQkJcmV0dXJuIDA7Ci0KLQlyZXR1cm4gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgVkxW
X0JMQ19QV01fQ1RMKHBpcGUpKSAmIEJBQ0tMSUdIVF9EVVRZX0NZQ0xFX01BU0s7Ci19Ci0KLXN0
YXRpYyB1MzIgYnh0X2dldF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVj
dG9yLCBlbnVtIHBpcGUgdW51c2VkKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3BhbmVs
ICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCi0JcmV0dXJuIGludGVsX2RlX3JlYWQoZGV2
X3ByaXYsCi0JCQkgICAgIEJYVF9CTENfUFdNX0RVVFkocGFuZWwtPmJhY2tsaWdodC5jb250cm9s
bGVyKSk7Ci19Ci0KLXN0YXRpYyB1MzIgZXh0X3B3bV9nZXRfYmFja2xpZ2h0KHN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHVudXNlZCkKLXsKLQlzdHJ1Y3QgaW50
ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0Jc3RydWN0IHB3bV9zdGF0ZSBz
dGF0ZTsKLQotCXB3bV9nZXRfc3RhdGUocGFuZWwtPmJhY2tsaWdodC5wd20sICZzdGF0ZSk7Ci0J
cmV0dXJuIHB3bV9nZXRfcmVsYXRpdmVfZHV0eV9jeWNsZSgmc3RhdGUsIDEwMCk7Ci19Ci0KLXN0
YXRpYyB2b2lkIGxwdF9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0
YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJh
c2UuZGV2KTsKLQotCXUzMiB2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX1BD
SF9DVEwyKSAmIH5CQUNLTElHSFRfRFVUWV9DWUNMRV9NQVNLOwotCWludGVsX2RlX3dyaXRlKGRl
dl9wcml2LCBCTENfUFdNX1BDSF9DVEwyLCB2YWwgfCBsZXZlbCk7Ci19Ci0KLXN0YXRpYyB2b2lk
IHBjaF9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25u
X3N0YXRlLCB1MzIgbGV2ZWwpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9y
ID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsK
LQl1MzIgdG1wOwotCi0JdG1wID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DUFVf
Q1RMKSAmIH5CQUNLTElHSFRfRFVUWV9DWUNMRV9NQVNLOwotCWludGVsX2RlX3dyaXRlKGRldl9w
cml2LCBCTENfUFdNX0NQVV9DVEwsIHRtcCB8IGxldmVsKTsKLX0KLQotc3RhdGljIHZvaWQgaTl4
eF9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0
YXRlLCB1MzIgbGV2ZWwpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0g
dG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlz
dHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0JdTMyIHRtcCwg
bWFzazsKLQotCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBwYW5lbC0+YmFja2xpZ2h0LnB3
bV9sZXZlbF9tYXggPT0gMCk7Ci0KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5jb21iaW5hdGlvbl9t
b2RlKSB7Ci0JCXU4IGxicGM7Ci0KLQkJbGJwYyA9IGxldmVsICogMHhmZSAvIHBhbmVsLT5iYWNr
bGlnaHQucHdtX2xldmVsX21heCArIDE7Ci0JCWxldmVsIC89IGxicGM7Ci0JCXBjaV93cml0ZV9j
b25maWdfYnl0ZSh0b19wY2lfZGV2KGRldl9wcml2LT5kcm0uZGV2KSwgTEJQQywgbGJwYyk7Ci0J
fQotCi0JaWYgKERJU1BMQVlfVkVSKGRldl9wcml2KSA9PSA0KSB7Ci0JCW1hc2sgPSBCQUNLTElH
SFRfRFVUWV9DWUNMRV9NQVNLOwotCX0gZWxzZSB7Ci0JCWxldmVsIDw8PSAxOwotCQltYXNrID0g
QkFDS0xJR0hUX0RVVFlfQ1lDTEVfTUFTS19QTlY7Ci0JfQotCi0JdG1wID0gaW50ZWxfZGVfcmVh
ZChkZXZfcHJpdiwgQkxDX1BXTV9DVEwpICYgfm1hc2s7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIEJMQ19QV01fQ1RMLCB0bXAgfCBsZXZlbCk7Ci19Ci0KLXN0YXRpYyB2b2lkIHZsdl9zZXRf
YmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLCB1
MzIgbGV2ZWwpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50
ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQllbnVtIHBp
cGUgcGlwZSA9IHRvX2ludGVsX2NydGMoY29ubl9zdGF0ZS0+Y3J0YyktPnBpcGU7Ci0JdTMyIHRt
cDsKLQotCXRtcCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFZMVl9CTENfUFdNX0NUTChwaXBl
KSkgJiB+QkFDS0xJR0hUX0RVVFlfQ1lDTEVfTUFTSzsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgVkxWX0JMQ19QV01fQ1RMKHBpcGUpLCB0bXAgfCBsZXZlbCk7Ci19Ci0KLXN0YXRpYyB2b2lk
IGJ4dF9zZXRfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25u
X3N0YXRlLCB1MzIgbGV2ZWwpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9y
ID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsK
LQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwKLQkJICAgICAgIEJYVF9CTENfUFdNX0RVVFkocGFuZWwtPmJh
Y2tsaWdodC5jb250cm9sbGVyKSwgbGV2ZWwpOwotfQotCi1zdGF0aWMgdm9pZCBleHRfcHdtX3Nl
dF9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUs
IHUzMiBsZXZlbCkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJnRvX2ludGVsX2Nv
bm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpLT5wYW5lbDsKLQotCXB3bV9zZXRfcmVsYXRp
dmVfZHV0eV9jeWNsZSgmcGFuZWwtPmJhY2tsaWdodC5wd21fc3RhdGUsIGxldmVsLCAxMDApOwot
CXB3bV9hcHBseV9zdGF0ZShwYW5lbC0+YmFja2xpZ2h0LnB3bSwgJnBhbmVsLT5iYWNrbGlnaHQu
cHdtX3N0YXRlKTsKLX0KLQotc3RhdGljIHZvaWQKLWludGVsX3BhbmVsX2FjdHVhbGx5X3NldF9i
YWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUz
MiBsZXZlbCkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRl
bF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVs
X3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCi0JZHJtX2RiZ19rbXMoJmk5MTUt
PmRybSwgInNldCBiYWNrbGlnaHQgbGV2ZWwgPSAlZFxuIiwgbGV2ZWwpOwotCi0JcGFuZWwtPmJh
Y2tsaWdodC5mdW5jcy0+c2V0KGNvbm5fc3RhdGUsIGxldmVsKTsKLX0KLQotLyogc2V0IGJhY2ts
aWdodCBicmlnaHRuZXNzIHRvIGxldmVsIGluIHJhbmdlIFswLi5tYXhdLCBhc3N1bWluZyBodyBt
aW4gaXMKLSAqIHJlc3BlY3RlZC4KLSAqLwotdm9pZCBpbnRlbF9wYW5lbF9zZXRfYmFja2xpZ2h0
X2FjcGkoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsCi0JCQkJ
ICAgIHUzMiB1c2VyX2xldmVsLCB1MzIgdXNlcl9tYXgpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5l
Y3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rv
cik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0
b3ItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+
cGFuZWw7Ci0JdTMyIGh3X2xldmVsOwotCi0JLyoKLQkgKiBMYWNrIG9mIGNydGMgbWF5IG9jY3Vy
IGR1cmluZyBkcml2ZXIgaW5pdCBiZWNhdXNlCi0JICogY29ubmVjdGlvbl9tdXRleCBpc24ndCBo
ZWxkIGFjcm9zcyB0aGUgZW50aXJlIGJhY2tsaWdodAotCSAqIHNldHVwICsgbW9kZXNldCByZWFk
b3V0LCBhbmQgdGhlIEJJT1MgY2FuIGlzc3VlIHRoZQotCSAqIHJlcXVlc3RzIGF0IGFueSB0aW1l
LgotCSAqLwotCWlmICghcGFuZWwtPmJhY2tsaWdodC5wcmVzZW50IHx8ICFjb25uX3N0YXRlLT5j
cnRjKQotCQlyZXR1cm47Ci0KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2sp
OwotCi0JZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHBhbmVsLT5iYWNrbGlnaHQubWF4ID09
IDApOwotCi0JaHdfbGV2ZWwgPSBjbGFtcF91c2VyX3RvX2h3KGNvbm5lY3RvciwgdXNlcl9sZXZl
bCwgdXNlcl9tYXgpOwotCXBhbmVsLT5iYWNrbGlnaHQubGV2ZWwgPSBod19sZXZlbDsKLQotCWlm
IChwYW5lbC0+YmFja2xpZ2h0LmRldmljZSkKLQkJcGFuZWwtPmJhY2tsaWdodC5kZXZpY2UtPnBy
b3BzLmJyaWdodG5lc3MgPQotCQkJc2NhbGVfaHdfdG9fdXNlcihjb25uZWN0b3IsCi0JCQkJCSBw
YW5lbC0+YmFja2xpZ2h0LmxldmVsLAotCQkJCQkgcGFuZWwtPmJhY2tsaWdodC5kZXZpY2UtPnBy
b3BzLm1heF9icmlnaHRuZXNzKTsKLQotCWlmIChwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZWQpCi0J
CWludGVsX3BhbmVsX2FjdHVhbGx5X3NldF9iYWNrbGlnaHQoY29ubl9zdGF0ZSwgaHdfbGV2ZWwp
OwotCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwotfQotCi1zdGF0
aWMgdm9pZCBscHRfZGlzYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKm9sZF9jb25uX3N0YXRlLCB1MzIgbGV2ZWwpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5l
Y3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKG9sZF9jb25uX3N0YXRlLT5jb25u
ZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29u
bmVjdG9yLT5iYXNlLmRldik7Ci0JdTMyIHRtcDsKLQotCWludGVsX3BhbmVsX3NldF9wd21fbGV2
ZWwob2xkX2Nvbm5fc3RhdGUsIGxldmVsKTsKLQotCS8qCi0JICogQWx0aG91Z2ggd2UgZG9uJ3Qg
c3VwcG9ydCBvciBlbmFibGUgQ1BVIFBXTSB3aXRoIExQVC9TUFQgYmFzZWQKLQkgKiBzeXN0ZW1z
LCBpdCBtYXkgaGF2ZSBiZWVuIGVuYWJsZWQgcHJpb3IgdG8gbG9hZGluZyB0aGUKLQkgKiBkcml2
ZXIuIERpc2FibGUgdG8gYXZvaWQgd2FybmluZ3Mgb24gTENQTEwgZGlzYWJsZS4KLQkgKgotCSAq
IFRoaXMgbmVlZHMgcmV3b3JrIGlmIHdlIG5lZWQgdG8gYWRkIHN1cHBvcnQgZm9yIENQVSBQV00g
b24gUENIIHNwbGl0Ci0JICogcGxhdGZvcm1zLgotCSAqLwotCXRtcCA9IGludGVsX2RlX3JlYWQo
ZGV2X3ByaXYsIEJMQ19QV01fQ1BVX0NUTDIpOwotCWlmICh0bXAgJiBCTE1fUFdNX0VOQUJMRSkg
ewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiY3B1IGJhY2tsaWdodCB3
YXMgZW5hYmxlZCwgZGlzYWJsaW5nXG4iKTsKLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJM
Q19QV01fQ1BVX0NUTDIsCi0JCQkgICAgICAgdG1wICYgfkJMTV9QV01fRU5BQkxFKTsKLQl9Ci0K
LQl0bXAgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxKTsKLQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSwgdG1wICYgfkJMTV9QQ0hfUFdN
X0VOQUJMRSk7Ci19Ci0KLXN0YXRpYyB2b2lkIHBjaF9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUsIHUzMiB2YWwpCi17Ci0J
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKG9s
ZF9jb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0JdTMyIHRtcDsKLQotCWludGVs
X3BhbmVsX3NldF9wd21fbGV2ZWwob2xkX2Nvbm5fc3RhdGUsIHZhbCk7Ci0KLQl0bXAgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NQVV9DVEwyKTsKLQlpbnRlbF9kZV93cml0ZShk
ZXZfcHJpdiwgQkxDX1BXTV9DUFVfQ1RMMiwgdG1wICYgfkJMTV9QV01fRU5BQkxFKTsKLQotCXRt
cCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEpOwotCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxLCB0bXAgJiB+QkxNX1BDSF9QV01fRU5B
QkxFKTsKLX0KLQotc3RhdGljIHZvaWQgaTl4eF9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUsIHUzMiB2YWwpCi17Ci0JaW50
ZWxfcGFuZWxfc2V0X3B3bV9sZXZlbChvbGRfY29ubl9zdGF0ZSwgdmFsKTsKLX0KLQotc3RhdGlj
IHZvaWQgaTk2NV9kaXNhYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9z
dGF0ZSAqb2xkX2Nvbm5fc3RhdGUsIHUzMiB2YWwpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShvbGRfY29ubl9zdGF0ZS0+Y29ubmVjdG9yLT5kZXYpOwot
CXUzMiB0bXA7Ci0KLQlpbnRlbF9wYW5lbF9zZXRfcHdtX2xldmVsKG9sZF9jb25uX3N0YXRlLCB2
YWwpOwotCi0JdG1wID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DVEwyKTsKLQlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9DVEwyLCB0bXAgJiB+QkxNX1BXTV9FTkFC
TEUpOwotfQotCi1zdGF0aWMgdm9pZCB2bHZfZGlzYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlLCB1MzIgdmFsKQotewotCXN0cnVj
dCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3RvcihvbGRfY29u
bl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gdG9faW50
ZWxfY3J0YyhvbGRfY29ubl9zdGF0ZS0+Y3J0YyktPnBpcGU7Ci0JdTMyIHRtcDsKLQotCWludGVs
X3BhbmVsX3NldF9wd21fbGV2ZWwob2xkX2Nvbm5fc3RhdGUsIHZhbCk7Ci0KLQl0bXAgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBWTFZfQkxDX1BXTV9DVEwyKHBpcGUpKTsKLQlpbnRlbF9kZV93
cml0ZShkZXZfcHJpdiwgVkxWX0JMQ19QV01fQ1RMMihwaXBlKSwKLQkJICAgICAgIHRtcCAmIH5C
TE1fUFdNX0VOQUJMRSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGJ4dF9kaXNhYmxlX2JhY2tsaWdodChj
b25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUsIHUzMiB2YWwp
Ci17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVj
dG9yKG9sZF9jb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVs
X3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUzMiB0bXA7Ci0KLQlpbnRlbF9w
YW5lbF9zZXRfcHdtX2xldmVsKG9sZF9jb25uX3N0YXRlLCB2YWwpOwotCi0JdG1wID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwKLQkJCSAgICBCWFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdo
dC5jb250cm9sbGVyKSk7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJYVF9CTENfUFdNX0NU
TChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpLAotCQkgICAgICAgdG1wICYgfkJYVF9CTENf
UFdNX0VOQUJMRSk7Ci0KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyID09IDEpIHsK
LQkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgVVRJTF9QSU5fQ1RMKTsKLQkJdmFsICY9
IH5VVElMX1BJTl9FTkFCTEU7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBVVElMX1BJTl9D
VEwsIHZhbCk7Ci0JfQotfQotCi1zdGF0aWMgdm9pZCBjbnBfZGlzYWJsZV9iYWNrbGlnaHQoY29u
c3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9jb25uX3N0YXRlLCB1MzIgdmFsKQot
ewotCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rv
cihvbGRfY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9w
YW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQl1MzIgdG1wOwotCi0JaW50ZWxfcGFu
ZWxfc2V0X3B3bV9sZXZlbChvbGRfY29ubl9zdGF0ZSwgdmFsKTsKLQotCXRtcCA9IGludGVsX2Rl
X3JlYWQoZGV2X3ByaXYsCi0JCQkgICAgQlhUX0JMQ19QV01fQ1RMKHBhbmVsLT5iYWNrbGlnaHQu
Y29udHJvbGxlcikpOwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCWFRfQkxDX1BXTV9DVEwo
cGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyKSwKLQkJICAgICAgIHRtcCAmIH5CWFRfQkxDX1BX
TV9FTkFCTEUpOwotfQotCi1zdGF0aWMgdm9pZCBleHRfcHdtX2Rpc2FibGVfYmFja2xpZ2h0KGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSwgdTMyIGxldmVs
KQotewotCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5l
Y3RvcihvbGRfY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBh
bmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9zdGF0ZS5l
bmFibGVkID0gZmFsc2U7Ci0JcHdtX2FwcGx5X3N0YXRlKHBhbmVsLT5iYWNrbGlnaHQucHdtLCAm
cGFuZWwtPmJhY2tsaWdodC5wd21fc3RhdGUpOwotfQotCi12b2lkIGludGVsX3BhbmVsX2Rpc2Fi
bGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9z
dGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9j
b25uZWN0b3Iob2xkX2Nvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlzdHJ1Y3Qg
aW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlpZiAoIXBhbmVsLT5i
YWNrbGlnaHQucHJlc2VudCkKLQkJcmV0dXJuOwotCi0JLyoKLQkgKiBEbyBub3QgZGlzYWJsZSBi
YWNrbGlnaHQgb24gdGhlIHZnYV9zd2l0Y2hlcm9vIHBhdGguIFdoZW4gc3dpdGNoaW5nCi0JICog
YXdheSBmcm9tIGk5MTUsIHRoZSBvdGhlciBjbGllbnQgbWF5IGRlcGVuZCBvbiBpOTE1IHRvIGhh
bmRsZSB0aGUKLQkgKiBiYWNrbGlnaHQuIFRoaXMgd2lsbCBsZWF2ZSB0aGUgYmFja2xpZ2h0IG9u
IHVubmVjZXNzYXJpbHkgd2hlbgotCSAqIGFub3RoZXIgY2xpZW50IGlzIG5vdCBhY3RpdmF0ZWQu
Ci0JICovCi0JaWYgKGRldl9wcml2LT5kcm0uc3dpdGNoX3Bvd2VyX3N0YXRlID09IERSTV9TV0lU
Q0hfUE9XRVJfQ0hBTkdJTkcpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkg
ICAgIlNraXBwaW5nIGJhY2tsaWdodCBkaXNhYmxlIG9uIHZnYSBzd2l0Y2hcbiIpOwotCQlyZXR1
cm47Ci0JfQotCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmJhY2tsaWdodF9sb2NrKTsKLQotCWlm
IChwYW5lbC0+YmFja2xpZ2h0LmRldmljZSkKLQkJcGFuZWwtPmJhY2tsaWdodC5kZXZpY2UtPnBy
b3BzLnBvd2VyID0gRkJfQkxBTktfUE9XRVJET1dOOwotCXBhbmVsLT5iYWNrbGlnaHQuZW5hYmxl
ZCA9IGZhbHNlOwotCXBhbmVsLT5iYWNrbGlnaHQuZnVuY3MtPmRpc2FibGUob2xkX2Nvbm5fc3Rh
dGUsIDApOwotCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwotfQot
Ci1zdGF0aWMgdm9pZCBscHRfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFz
ZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsK
LQl1MzIgcGNoX2N0bDEsIHBjaF9jdGwyLCBzY2hpY2tlbjsKLQotCXBjaF9jdGwxID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSk7Ci0JaWYgKHBjaF9jdGwxICYgQkxN
X1BDSF9QV01fRU5BQkxFKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAicGNoIGJh
Y2tsaWdodCBhbHJlYWR5IGVuYWJsZWRcbiIpOwotCQlwY2hfY3RsMSAmPSB+QkxNX1BDSF9QV01f
RU5BQkxFOwotCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSwgcGNo
X2N0bDEpOwotCX0KLQotCWlmIChIQVNfUENIX0xQVChkZXZfcHJpdikpIHsKLQkJc2NoaWNrZW4g
PSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBTT1VUSF9DSElDS0VOMik7Ci0JCWlmIChwYW5lbC0+
YmFja2xpZ2h0LmFsdGVybmF0ZV9wd21faW5jcmVtZW50KQotCQkJc2NoaWNrZW4gfD0gTFBUX1BX
TV9HUkFOVUxBUklUWTsKLQkJZWxzZQotCQkJc2NoaWNrZW4gJj0gfkxQVF9QV01fR1JBTlVMQVJJ
VFk7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBTT1VUSF9DSElDS0VOMiwgc2NoaWNrZW4p
OwotCX0gZWxzZSB7Ci0JCXNjaGlja2VuID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgU09VVEhf
Q0hJQ0tFTjEpOwotCQlpZiAocGFuZWwtPmJhY2tsaWdodC5hbHRlcm5hdGVfcHdtX2luY3JlbWVu
dCkKLQkJCXNjaGlja2VuIHw9IFNQVF9QV01fR1JBTlVMQVJJVFk7Ci0JCWVsc2UKLQkJCXNjaGlj
a2VuICY9IH5TUFRfUFdNX0dSQU5VTEFSSVRZOwotCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwg
U09VVEhfQ0hJQ0tFTjEsIHNjaGlja2VuKTsKLQl9Ci0KLQlwY2hfY3RsMiA9IHBhbmVsLT5iYWNr
bGlnaHQucHdtX2xldmVsX21heCA8PCAxNjsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQkxD
X1BXTV9QQ0hfQ1RMMiwgcGNoX2N0bDIpOwotCi0JcGNoX2N0bDEgPSAwOwotCWlmIChwYW5lbC0+
YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtKQotCQlwY2hfY3RsMSB8PSBCTE1fUENIX1BPTEFSSVRZ
OwotCi0JLyogQWZ0ZXIgTFBULCBvdmVycmlkZSBpcyB0aGUgZGVmYXVsdC4gKi8KLQlpZiAoSEFT
X1BDSF9MUFQoZGV2X3ByaXYpKQotCQlwY2hfY3RsMSB8PSBCTE1fUENIX09WRVJSSURFX0VOQUJM
RTsKLQotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxLCBwY2hfY3Rs
MSk7Ci0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxKTsK
LQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSwKLQkJICAgICAgIHBj
aF9jdGwxIHwgQkxNX1BDSF9QV01fRU5BQkxFKTsKLQotCS8qIFRoaXMgd29uJ3Qgc3RpY2sgdW50
aWwgdGhlIGFib3ZlIGVuYWJsZS4gKi8KLQlpbnRlbF9wYW5lbF9zZXRfcHdtX2xldmVsKGNvbm5f
c3RhdGUsIGxldmVsKTsKLX0KLQotc3RhdGljIHZvaWQgcGNoX2VuYWJsZV9iYWNrbGlnaHQoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJIGNvbnN0IHN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCi17Ci0Jc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3Rh
dGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0g
JmNvbm5lY3Rvci0+cGFuZWw7Ci0JZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0
Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7Ci0JdTMyIGNwdV9jdGwyLCBwY2hfY3RsMSwgcGNoX2N0
bDI7Ci0KLQljcHVfY3RsMiA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1BVX0NU
TDIpOwotCWlmIChjcHVfY3RsMiAmIEJMTV9QV01fRU5BQkxFKSB7Ci0JCWRybV9kYmdfa21zKCZk
ZXZfcHJpdi0+ZHJtLCAiY3B1IGJhY2tsaWdodCBhbHJlYWR5IGVuYWJsZWRcbiIpOwotCQljcHVf
Y3RsMiAmPSB+QkxNX1BXTV9FTkFCTEU7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENf
UFdNX0NQVV9DVEwyLCBjcHVfY3RsMik7Ci0JfQotCi0JcGNoX2N0bDEgPSBpbnRlbF9kZV9yZWFk
KGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxKTsKLQlpZiAocGNoX2N0bDEgJiBCTE1fUENIX1BX
TV9FTkFCTEUpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJwY2ggYmFja2xpZ2h0
IGFscmVhZHkgZW5hYmxlZFxuIik7Ci0JCXBjaF9jdGwxICY9IH5CTE1fUENIX1BXTV9FTkFCTEU7
Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxLCBwY2hfY3RsMSk7
Ci0JfQotCi0JaWYgKGNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09ERVJfRURQKQotCQljcHVfY3Rs
MiA9IEJMTV9UUkFOU0NPREVSX0VEUDsKLQllbHNlCi0JCWNwdV9jdGwyID0gQkxNX1BJUEUoY3B1
X3RyYW5zY29kZXIpOwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NQVV9DVEwy
LCBjcHVfY3RsMik7Ci0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBCTENfUFdNX0NQ
VV9DVEwyKTsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9DUFVfQ1RMMiwgY3B1
X2N0bDIgfCBCTE1fUFdNX0VOQUJMRSk7Ci0KLQkvKiBUaGlzIHdvbid0IHN0aWNrIHVudGlsIHRo
ZSBhYm92ZSBlbmFibGUuICovCi0JaW50ZWxfcGFuZWxfc2V0X3B3bV9sZXZlbChjb25uX3N0YXRl
LCBsZXZlbCk7Ci0KLQlwY2hfY3RsMiA9IHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA8
PCAxNjsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMiwgcGNoX2N0
bDIpOwotCi0JcGNoX2N0bDEgPSAwOwotCWlmIChwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3df
cHdtKQotCQlwY2hfY3RsMSB8PSBCTE1fUENIX1BPTEFSSVRZOwotCi0JaW50ZWxfZGVfd3JpdGUo
ZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEsIHBjaF9jdGwxKTsKLQlpbnRlbF9kZV9wb3N0aW5n
X3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEpOwotCWludGVsX2RlX3dyaXRlKGRldl9w
cml2LCBCTENfUFdNX1BDSF9DVEwxLAotCQkgICAgICAgcGNoX2N0bDEgfCBCTE1fUENIX1BXTV9F
TkFCTEUpOwotfQotCi1zdGF0aWMgdm9pZCBpOXh4X2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJICBjb25zdCBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyIGxldmVsKQotewotCXN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5j
b25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25u
ZWN0b3ItPnBhbmVsOwotCXUzMiBjdGwsIGZyZXE7Ci0KLQljdGwgPSBpbnRlbF9kZV9yZWFkKGRl
dl9wcml2LCBCTENfUFdNX0NUTCk7Ci0JaWYgKGN0bCAmIEJBQ0tMSUdIVF9EVVRZX0NZQ0xFX01B
U0tfUE5WKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiYmFja2xpZ2h0IGFscmVh
ZHkgZW5hYmxlZFxuIik7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NUTCwg
MCk7Ci0JfQotCi0JZnJlcSA9IHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heDsKLQlpZiAo
cGFuZWwtPmJhY2tsaWdodC5jb21iaW5hdGlvbl9tb2RlKQotCQlmcmVxIC89IDB4ZmY7Ci0KLQlj
dGwgPSBmcmVxIDw8IDE3OwotCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNvbWJpbmF0aW9uX21vZGUp
Ci0JCWN0bCB8PSBCTE1fTEVHQUNZX01PREU7Ci0JaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSAm
JiBwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtKQotCQljdGwgfD0gQkxNX1BPTEFSSVRZ
X1BOVjsKLQotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NUTCwgY3RsKTsKLQlp
bnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1RMKTsKLQotCS8qIFhYWDog
Y29tYmluZSB0aGlzIGludG8gYWJvdmUgd3JpdGU/ICovCi0JaW50ZWxfcGFuZWxfc2V0X3B3bV9s
ZXZlbChjb25uX3N0YXRlLCBsZXZlbCk7Ci0KLQkvKgotCSAqIE5lZWRlZCB0byBlbmFibGUgYmFj
a2xpZ2h0IG9uIHNvbWUgODU1Z20gbW9kZWxzLiBCTENfSElTVF9DVEwgaXMKLQkgKiA4NTVnbSBv
bmx5LCBidXQgY2hlY2tpbmcgZm9yIGdlbjIgaXMgc2FmZSwgYXMgODU1Z20gaXMgdGhlIG9ubHkg
Z2VuMgotCSAqIHRoYXQgaGFzIGJhY2tsaWdodC4KLQkgKi8KLQlpZiAoRElTUExBWV9WRVIoZGV2
X3ByaXYpID09IDIpCi0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfSElTVF9DVEwsIEJM
TV9ISVNUT0dSQU1fRU5BQkxFKTsKLX0KLQotc3RhdGljIHZvaWQgaTk2NV9lbmFibGVfYmFja2xp
Z2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJCSAgY29u
c3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKLXsK
LQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3Io
Y29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAq
cGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2Ny
dGMoY29ubl9zdGF0ZS0+Y3J0YyktPnBpcGU7Ci0JdTMyIGN0bCwgY3RsMiwgZnJlcTsKLQotCWN0
bDIgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NUTDIpOwotCWlmIChjdGwyICYg
QkxNX1BXTV9FTkFCTEUpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJiYWNrbGln
aHQgYWxyZWFkeSBlbmFibGVkXG4iKTsKLQkJY3RsMiAmPSB+QkxNX1BXTV9FTkFCTEU7Ci0JCWlu
dGVsX2RlX3dyaXRlKGRldl9wcml2LCBCTENfUFdNX0NUTDIsIGN0bDIpOwotCX0KLQotCWZyZXEg
PSBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXg7Ci0JaWYgKHBhbmVsLT5iYWNrbGlnaHQu
Y29tYmluYXRpb25fbW9kZSkKLQkJZnJlcSAvPSAweGZmOwotCi0JY3RsID0gZnJlcSA8PCAxNjsK
LQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9DVEwsIGN0bCk7Ci0KLQljdGwyID0g
QkxNX1BJUEUocGlwZSk7Ci0JaWYgKHBhbmVsLT5iYWNrbGlnaHQuY29tYmluYXRpb25fbW9kZSkK
LQkJY3RsMiB8PSBCTE1fQ09NQklOQVRJT05fTU9ERTsKLQlpZiAocGFuZWwtPmJhY2tsaWdodC5h
Y3RpdmVfbG93X3B3bSkKLQkJY3RsMiB8PSBCTE1fUE9MQVJJVFlfSTk2NTsKLQlpbnRlbF9kZV93
cml0ZShkZXZfcHJpdiwgQkxDX1BXTV9DVEwyLCBjdGwyKTsKLQlpbnRlbF9kZV9wb3N0aW5nX3Jl
YWQoZGV2X3ByaXYsIEJMQ19QV01fQ1RMMik7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJM
Q19QV01fQ1RMMiwgY3RsMiB8IEJMTV9QV01fRU5BQkxFKTsKLQotCWludGVsX3BhbmVsX3NldF9w
d21fbGV2ZWwoY29ubl9zdGF0ZSwgbGV2ZWwpOwotfQotCi1zdGF0aWMgdm9pZCB2bHZfZW5hYmxl
X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJ
CQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZl
bCkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25u
ZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9w
YW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQllbnVtIHBpcGUgcGlwZSA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKLQl1MzIgY3RsLCBjdGwyOwot
Ci0JY3RsMiA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFZMVl9CTENfUFdNX0NUTDIocGlwZSkp
OwotCWlmIChjdGwyICYgQkxNX1BXTV9FTkFCTEUpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2
LT5kcm0sICJiYWNrbGlnaHQgYWxyZWFkeSBlbmFibGVkXG4iKTsKLQkJY3RsMiAmPSB+QkxNX1BX
TV9FTkFCTEU7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBWTFZfQkxDX1BXTV9DVEwyKHBp
cGUpLCBjdGwyKTsKLQl9Ci0KLQljdGwgPSBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgg
PDwgMTY7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFZMVl9CTENfUFdNX0NUTChwaXBlKSwg
Y3RsKTsKLQotCS8qIFhYWDogY29tYmluZSB0aGlzIGludG8gYWJvdmUgd3JpdGU/ICovCi0JaW50
ZWxfcGFuZWxfc2V0X3B3bV9sZXZlbChjb25uX3N0YXRlLCBsZXZlbCk7Ci0KLQljdGwyID0gMDsK
LQlpZiAocGFuZWwtPmJhY2tsaWdodC5hY3RpdmVfbG93X3B3bSkKLQkJY3RsMiB8PSBCTE1fUE9M
QVJJVFlfSTk2NTsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgVkxWX0JMQ19QV01fQ1RMMihw
aXBlKSwgY3RsMik7Ci0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBWTFZfQkxDX1BX
TV9DVEwyKHBpcGUpKTsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgVkxWX0JMQ19QV01fQ1RM
MihwaXBlKSwKLQkJICAgICAgIGN0bDIgfCBCTE1fUFdNX0VOQUJMRSk7Ci19Ci0KLXN0YXRpYyB2
b2lkIGJ4dF9lbmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAotCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSwgdTMyIGxldmVsKQotewotCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9
IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0J
c3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCWVudW0gcGlw
ZSBwaXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOwotCXUz
MiBwd21fY3RsLCB2YWw7Ci0KLQkvKiBDb250cm9sbGVyIDEgdXNlcyB0aGUgdXRpbGl0eSBwaW4u
ICovCi0JaWYgKHBhbmVsLT5iYWNrbGlnaHQuY29udHJvbGxlciA9PSAxKSB7Ci0JCXZhbCA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsIFVUSUxfUElOX0NUTCk7Ci0JCWlmICh2YWwgJiBVVElMX1BJ
Tl9FTkFCTEUpIHsKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAidXRp
bCBwaW4gYWxyZWFkeSBlbmFibGVkXG4iKTsKLQkJCXZhbCAmPSB+VVRJTF9QSU5fRU5BQkxFOwot
CQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFVUSUxfUElOX0NUTCwgdmFsKTsKLQkJfQotCi0J
CXZhbCA9IDA7Ci0JCWlmIChwYW5lbC0+YmFja2xpZ2h0LnV0aWxfcGluX2FjdGl2ZV9sb3cpCi0J
CQl2YWwgfD0gVVRJTF9QSU5fUE9MQVJJVFk7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBV
VElMX1BJTl9DVEwsCi0JCQkgICAgICAgdmFsIHwgVVRJTF9QSU5fUElQRShwaXBlKSB8IFVUSUxf
UElOX01PREVfUFdNIHwgVVRJTF9QSU5fRU5BQkxFKTsKLQl9Ci0KLQlwd21fY3RsID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwKLQkJCQlCWFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdodC5j
b250cm9sbGVyKSk7Ci0JaWYgKHB3bV9jdGwgJiBCWFRfQkxDX1BXTV9FTkFCTEUpIHsKLQkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJiYWNrbGlnaHQgYWxyZWFkeSBlbmFibGVkXG4iKTsK
LQkJcHdtX2N0bCAmPSB+QlhUX0JMQ19QV01fRU5BQkxFOwotCQlpbnRlbF9kZV93cml0ZShkZXZf
cHJpdiwKLQkJCSAgICAgICBCWFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdodC5jb250cm9s
bGVyKSwKLQkJCSAgICAgICBwd21fY3RsKTsKLQl9Ci0KLQlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwKLQkJICAgICAgIEJYVF9CTENfUFdNX0ZSRVEocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVy
KSwKLQkJICAgICAgIHBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCk7Ci0KLQlpbnRlbF9w
YW5lbF9zZXRfcHdtX2xldmVsKGNvbm5fc3RhdGUsIGxldmVsKTsKLQotCXB3bV9jdGwgPSAwOwot
CWlmIChwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtKQotCQlwd21fY3RsIHw9IEJYVF9C
TENfUFdNX1BPTEFSSVRZOwotCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJYVF9CTENfUFdN
X0NUTChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpLAotCQkgICAgICAgcHdtX2N0bCk7Ci0J
aW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LAotCQkJICAgICAgQlhUX0JMQ19QV01fQ1RM
KHBhbmVsLT5iYWNrbGlnaHQuY29udHJvbGxlcikpOwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2
LCBCWFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyKSwKLQkJICAgICAg
IHB3bV9jdGwgfCBCWFRfQkxDX1BXTV9FTkFCTEUpOwotfQotCi1zdGF0aWMgdm9pZCBjbnBfZW5h
YmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
LQkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBs
ZXZlbCkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9j
b25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRl
bF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQl1MzIgcHdtX2N0bDsKLQotCXB3
bV9jdGwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCUJYVF9CTENfUFdNX0NUTChwYW5l
bC0+YmFja2xpZ2h0LmNvbnRyb2xsZXIpKTsKLQlpZiAocHdtX2N0bCAmIEJYVF9CTENfUFdNX0VO
QUJMRSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgImJhY2tsaWdodCBhbHJlYWR5
IGVuYWJsZWRcbiIpOwotCQlwd21fY3RsICY9IH5CWFRfQkxDX1BXTV9FTkFCTEU7Ci0JCWludGVs
X2RlX3dyaXRlKGRldl9wcml2LAotCQkJICAgICAgIEJYVF9CTENfUFdNX0NUTChwYW5lbC0+YmFj
a2xpZ2h0LmNvbnRyb2xsZXIpLAotCQkJICAgICAgIHB3bV9jdGwpOwotCX0KLQotCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LAotCQkgICAgICAgQlhUX0JMQ19QV01fRlJFUShwYW5lbC0+YmFja2xp
Z2h0LmNvbnRyb2xsZXIpLAotCQkgICAgICAgcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4
KTsKLQotCWludGVsX3BhbmVsX3NldF9wd21fbGV2ZWwoY29ubl9zdGF0ZSwgbGV2ZWwpOwotCi0J
cHdtX2N0bCA9IDA7Ci0JaWYgKHBhbmVsLT5iYWNrbGlnaHQuYWN0aXZlX2xvd19wd20pCi0JCXB3
bV9jdGwgfD0gQlhUX0JMQ19QV01fUE9MQVJJVFk7Ci0KLQlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgQlhUX0JMQ19QV01fQ1RMKHBhbmVsLT5iYWNrbGlnaHQuY29udHJvbGxlciksCi0JCSAgICAg
ICBwd21fY3RsKTsKLQlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsCi0JCQkgICAgICBC
WFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyKSk7Ci0JaW50ZWxfZGVf
d3JpdGUoZGV2X3ByaXYsIEJYVF9CTENfUFdNX0NUTChwYW5lbC0+YmFja2xpZ2h0LmNvbnRyb2xs
ZXIpLAotCQkgICAgICAgcHdtX2N0bCB8IEJYVF9CTENfUFdNX0VOQUJMRSk7Ci19Ci0KLXN0YXRp
YyB2b2lkIGV4dF9wd21fZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0
YXRlICpjb25uX3N0YXRlLCB1MzIgbGV2ZWwpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3RvciAq
Y29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0J
c3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCi0JcHdtX3Nl
dF9yZWxhdGl2ZV9kdXR5X2N5Y2xlKCZwYW5lbC0+YmFja2xpZ2h0LnB3bV9zdGF0ZSwgbGV2ZWws
IDEwMCk7Ci0JcGFuZWwtPmJhY2tsaWdodC5wd21fc3RhdGUuZW5hYmxlZCA9IHRydWU7Ci0JcHdt
X2FwcGx5X3N0YXRlKHBhbmVsLT5iYWNrbGlnaHQucHdtLCAmcGFuZWwtPmJhY2tsaWdodC5wd21f
c3RhdGUpOwotfQotCi1zdGF0aWMgdm9pZCBfX2ludGVsX3BhbmVsX2VuYWJsZV9iYWNrbGlnaHQo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJCSAgIGNvbnN0
IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQotewotCXN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5j
b25uZWN0b3IpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5l
bDsKLQotCVdBUk5fT04ocGFuZWwtPmJhY2tsaWdodC5tYXggPT0gMCk7Ci0KLQlpZiAocGFuZWwt
PmJhY2tsaWdodC5sZXZlbCA8PSBwYW5lbC0+YmFja2xpZ2h0Lm1pbikgewotCQlwYW5lbC0+YmFj
a2xpZ2h0LmxldmVsID0gcGFuZWwtPmJhY2tsaWdodC5tYXg7Ci0JCWlmIChwYW5lbC0+YmFja2xp
Z2h0LmRldmljZSkKLQkJCXBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlLT5wcm9wcy5icmlnaHRuZXNz
ID0KLQkJCQlzY2FsZV9od190b191c2VyKGNvbm5lY3RvciwKLQkJCQkJCSBwYW5lbC0+YmFja2xp
Z2h0LmxldmVsLAotCQkJCQkJIHBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlLT5wcm9wcy5tYXhfYnJp
Z2h0bmVzcyk7Ci0JfQotCi0JcGFuZWwtPmJhY2tsaWdodC5mdW5jcy0+ZW5hYmxlKGNydGNfc3Rh
dGUsIGNvbm5fc3RhdGUsIHBhbmVsLT5iYWNrbGlnaHQubGV2ZWwpOwotCXBhbmVsLT5iYWNrbGln
aHQuZW5hYmxlZCA9IHRydWU7Ci0JaWYgKHBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlKQotCQlwYW5l
bC0+YmFja2xpZ2h0LmRldmljZS0+cHJvcHMucG93ZXIgPSBGQl9CTEFOS19VTkJMQU5LOwotfQot
Ci12b2lkIGludGVsX3BhbmVsX2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9z
dGF0ZSAqY29ubl9zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3Ig
PSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwot
CXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQllbnVtIHBp
cGUgcGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKLQot
CWlmICghcGFuZWwtPmJhY2tsaWdodC5wcmVzZW50KQotCQlyZXR1cm47Ci0KLQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwgInBpcGUgJWNcbiIsIHBpcGVfbmFtZShwaXBlKSk7Ci0KLQltdXRl
eF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwotCi0JX19pbnRlbF9wYW5lbF9lbmFi
bGVfYmFja2xpZ2h0KGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOwotCi0JbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwotfQotCi0jaWYgSVNfRU5BQkxFRChDT05GSUdfQkFD
S0xJR0hUX0NMQVNTX0RFVklDRSkKLXN0YXRpYyB1MzIgaW50ZWxfcGFuZWxfZ2V0X2JhY2tsaWdo
dChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCi17Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0JdTMyIHZhbCA9IDA7
Ci0KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwotCi0JaWYgKHBhbmVs
LT5iYWNrbGlnaHQuZW5hYmxlZCkKLQkJdmFsID0gcGFuZWwtPmJhY2tsaWdodC5mdW5jcy0+Z2V0
KGNvbm5lY3RvciwgaW50ZWxfY29ubmVjdG9yX2dldF9waXBlKGNvbm5lY3RvcikpOwotCi0JbXV0
ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwotCi0JZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sICJnZXQgYmFja2xpZ2h0IFBXTSA9ICVkXG4iLCB2YWwpOwotCXJldHVybiB2
YWw7Ci19Ci0KLS8qIFNjYWxlIHVzZXJfbGV2ZWwgaW4gcmFuZ2UgWzAuLnVzZXJfbWF4XSB0byBb
aHdfbWluLi5od19tYXhdLiAqLwotc3RhdGljIHUzMiBzY2FsZV91c2VyX3RvX2h3KHN0cnVjdCBp
bnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwKLQkJCSAgICB1MzIgdXNlcl9sZXZlbCwgdTMyIHVz
ZXJfbWF4KQotewotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5l
bDsKLQotCXJldHVybiBzY2FsZSh1c2VyX2xldmVsLCAwLCB1c2VyX21heCwKLQkJICAgICBwYW5l
bC0+YmFja2xpZ2h0Lm1pbiwgcGFuZWwtPmJhY2tsaWdodC5tYXgpOwotfQotCi0vKiBzZXQgYmFj
a2xpZ2h0IGJyaWdodG5lc3MgdG8gbGV2ZWwgaW4gcmFuZ2UgWzAuLm1heF0sIHNjYWxpbmcgd3J0
IGh3IG1pbiAqLwotc3RhdGljIHZvaWQgaW50ZWxfcGFuZWxfc2V0X2JhY2tsaWdodChjb25zdCBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwKLQkJCQkgICAgICB1MzIgdXNl
cl9sZXZlbCwgdTMyIHVzZXJfbWF4KQotewotCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRl
dik7Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUz
MiBod19sZXZlbDsKLQotCWlmICghcGFuZWwtPmJhY2tsaWdodC5wcmVzZW50KQotCQlyZXR1cm47
Ci0KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwotCi0JZHJtX1dBUk5f
T04oJmRldl9wcml2LT5kcm0sIHBhbmVsLT5iYWNrbGlnaHQubWF4ID09IDApOwotCi0JaHdfbGV2
ZWwgPSBzY2FsZV91c2VyX3RvX2h3KGNvbm5lY3RvciwgdXNlcl9sZXZlbCwgdXNlcl9tYXgpOwot
CXBhbmVsLT5iYWNrbGlnaHQubGV2ZWwgPSBod19sZXZlbDsKLQotCWlmIChwYW5lbC0+YmFja2xp
Z2h0LmVuYWJsZWQpCi0JCWludGVsX3BhbmVsX2FjdHVhbGx5X3NldF9iYWNrbGlnaHQoY29ubl9z
dGF0ZSwgaHdfbGV2ZWwpOwotCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xv
Y2spOwotfQotCi1zdGF0aWMgaW50IGludGVsX2JhY2tsaWdodF9kZXZpY2VfdXBkYXRlX3N0YXR1
cyhzdHJ1Y3QgYmFja2xpZ2h0X2RldmljZSAqYmQpCi17Ci0Jc3RydWN0IGludGVsX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yID0gYmxfZ2V0X2RhdGEoYmQpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFu
ZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY29ubmVj
dG9yLT5iYXNlLmRldjsKLQotCWRybV9tb2Rlc2V0X2xvY2soJmRldi0+bW9kZV9jb25maWcuY29u
bmVjdGlvbl9tdXRleCwgTlVMTCk7Ci0JRFJNX0RFQlVHX0tNUygidXBkYXRpbmcgaW50ZWxfYmFj
a2xpZ2h0LCBicmlnaHRuZXNzPSVkLyVkXG4iLAotCQkgICAgICBiZC0+cHJvcHMuYnJpZ2h0bmVz
cywgYmQtPnByb3BzLm1heF9icmlnaHRuZXNzKTsKLQlpbnRlbF9wYW5lbF9zZXRfYmFja2xpZ2h0
KGNvbm5lY3Rvci0+YmFzZS5zdGF0ZSwgYmQtPnByb3BzLmJyaWdodG5lc3MsCi0JCQkJICBiZC0+
cHJvcHMubWF4X2JyaWdodG5lc3MpOwotCi0JLyoKLQkgKiBBbGxvdyBmbGlwcGluZyBibF9wb3dl
ciBhcyBhIHN1Yi1zdGF0ZSBvZiBlbmFibGVkLiBTYWRseSB0aGUKLQkgKiBiYWNrbGlnaHQgY2xh
c3MgZGV2aWNlIGRvZXMgbm90IG1ha2UgaXQgZWFzeSB0byB0byBkaWZmZXJlbnRpYXRlCi0JICog
YmV0d2VlbiBjYWxsYmFja3MgZm9yIGJyaWdodG5lc3MgYW5kIGJsX3Bvd2VyLCBzbyBvdXIgYmFj
a2xpZ2h0X3Bvd2VyCi0JICogY2FsbGJhY2sgbmVlZHMgdG8gdGFrZSB0aGlzIGludG8gYWNjb3Vu
dC4KLQkgKi8KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5lbmFibGVkKSB7Ci0JCWlmIChwYW5lbC0+
YmFja2xpZ2h0LnBvd2VyKSB7Ci0JCQlib29sIGVuYWJsZSA9IGJkLT5wcm9wcy5wb3dlciA9PSBG
Ql9CTEFOS19VTkJMQU5LICYmCi0JCQkJYmQtPnByb3BzLmJyaWdodG5lc3MgIT0gMDsKLQkJCXBh
bmVsLT5iYWNrbGlnaHQucG93ZXIoY29ubmVjdG9yLCBlbmFibGUpOwotCQl9Ci0JfSBlbHNlIHsK
LQkJYmQtPnByb3BzLnBvd2VyID0gRkJfQkxBTktfUE9XRVJET1dOOwotCX0KLQotCWRybV9tb2Rl
c2V0X3VubG9jaygmZGV2LT5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4KTsKLQlyZXR1cm4g
MDsKLX0KLQotc3RhdGljIGludCBpbnRlbF9iYWNrbGlnaHRfZGV2aWNlX2dldF9icmlnaHRuZXNz
KHN0cnVjdCBiYWNrbGlnaHRfZGV2aWNlICpiZCkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uZWN0b3IgPSBibF9nZXRfZGF0YShiZCk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
IGNvbm5lY3Rvci0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShkZXYpOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCWludCByZXQgPSAw
OwotCi0Jd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJl
ZikgewotCQl1MzIgaHdfbGV2ZWw7Ci0KLQkJZHJtX21vZGVzZXRfbG9jaygmZGV2LT5tb2RlX2Nv
bmZpZy5jb25uZWN0aW9uX211dGV4LCBOVUxMKTsKLQotCQlod19sZXZlbCA9IGludGVsX3BhbmVs
X2dldF9iYWNrbGlnaHQoY29ubmVjdG9yKTsKLQkJcmV0ID0gc2NhbGVfaHdfdG9fdXNlcihjb25u
ZWN0b3IsCi0JCQkJICAgICAgIGh3X2xldmVsLCBiZC0+cHJvcHMubWF4X2JyaWdodG5lc3MpOwot
Ci0JCWRybV9tb2Rlc2V0X3VubG9jaygmZGV2LT5tb2RlX2NvbmZpZy5jb25uZWN0aW9uX211dGV4
KTsKLQl9Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGJhY2tsaWdo
dF9vcHMgaW50ZWxfYmFja2xpZ2h0X2RldmljZV9vcHMgPSB7Ci0JLnVwZGF0ZV9zdGF0dXMgPSBp
bnRlbF9iYWNrbGlnaHRfZGV2aWNlX3VwZGF0ZV9zdGF0dXMsCi0JLmdldF9icmlnaHRuZXNzID0g
aW50ZWxfYmFja2xpZ2h0X2RldmljZV9nZXRfYnJpZ2h0bmVzcywKLX07Ci0KLWludCBpbnRlbF9i
YWNrbGlnaHRfZGV2aWNlX3JlZ2lzdGVyKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rv
cikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29ubmVjdG9y
LT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBh
bmVsOwotCXN0cnVjdCBiYWNrbGlnaHRfcHJvcGVydGllcyBwcm9wczsKLQlzdHJ1Y3QgYmFja2xp
Z2h0X2RldmljZSAqYmQ7Ci0JY29uc3QgY2hhciAqbmFtZTsKLQlpbnQgcmV0ID0gMDsKLQotCWlm
IChXQVJOX09OKHBhbmVsLT5iYWNrbGlnaHQuZGV2aWNlKSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0K
LQlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHJlc2VudCkKLQkJcmV0dXJuIDA7Ci0KLQlXQVJOX09O
KHBhbmVsLT5iYWNrbGlnaHQubWF4ID09IDApOwotCi0JbWVtc2V0KCZwcm9wcywgMCwgc2l6ZW9m
KHByb3BzKSk7Ci0JcHJvcHMudHlwZSA9IEJBQ0tMSUdIVF9SQVc7Ci0KLQkvKgotCSAqIE5vdGU6
IEV2ZXJ5dGhpbmcgc2hvdWxkIHdvcmsgZXZlbiBpZiB0aGUgYmFja2xpZ2h0IGRldmljZSBtYXgK
LQkgKiBwcmVzZW50ZWQgdG8gdGhlIHVzZXJzcGFjZSBpcyBhcmJpdHJhcmlseSBjaG9zZW4uCi0J
ICovCi0JcHJvcHMubWF4X2JyaWdodG5lc3MgPSBwYW5lbC0+YmFja2xpZ2h0Lm1heDsKLQlwcm9w
cy5icmlnaHRuZXNzID0gc2NhbGVfaHdfdG9fdXNlcihjb25uZWN0b3IsCi0JCQkJCSAgICBwYW5l
bC0+YmFja2xpZ2h0LmxldmVsLAotCQkJCQkgICAgcHJvcHMubWF4X2JyaWdodG5lc3MpOwotCi0J
aWYgKHBhbmVsLT5iYWNrbGlnaHQuZW5hYmxlZCkKLQkJcHJvcHMucG93ZXIgPSBGQl9CTEFOS19V
TkJMQU5LOwotCWVsc2UKLQkJcHJvcHMucG93ZXIgPSBGQl9CTEFOS19QT1dFUkRPV047Ci0KLQlu
YW1lID0ga3N0cmR1cCgiaW50ZWxfYmFja2xpZ2h0IiwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFuYW1l
KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCWJkID0gYmFja2xpZ2h0X2RldmljZV9yZWdpc3Rlcihu
YW1lLCBjb25uZWN0b3ItPmJhc2Uua2RldiwgY29ubmVjdG9yLAotCQkJCSAgICAgICAmaW50ZWxf
YmFja2xpZ2h0X2RldmljZV9vcHMsICZwcm9wcyk7Ci0KLQkvKgotCSAqIFVzaW5nIHRoZSBzYW1l
IG5hbWUgaW5kZXBlbmRlbnQgb2YgdGhlIGRybSBkZXZpY2Ugb3IgY29ubmVjdG9yCi0JICogcHJl
dmVudHMgcmVnaXN0cmF0aW9uIG9mIG11bHRpcGxlIGJhY2tsaWdodCBkZXZpY2VzIGluIHRoZQot
CSAqIGRyaXZlci4gSG93ZXZlciwgd2UgbmVlZCB0byB1c2UgdGhlIGRlZmF1bHQgbmFtZSBmb3Ig
YmFja3dhcmQKLQkgKiBjb21wYXRpYmlsaXR5LiBVc2UgdW5pcXVlIG5hbWVzIGZvciBzdWJzZXF1
ZW50IGJhY2tsaWdodCBkZXZpY2VzIGFzIGEKLQkgKiBmYWxsYmFjayB3aGVuIHRoZSBkZWZhdWx0
IG5hbWUgYWxyZWFkeSBleGlzdHMuCi0JICovCi0JaWYgKElTX0VSUihiZCkgJiYgUFRSX0VSUihi
ZCkgPT0gLUVFWElTVCkgewotCQlrZnJlZShuYW1lKTsKLQkJbmFtZSA9IGthc3ByaW50ZihHRlBf
S0VSTkVMLCAiY2FyZCVkLSVzLWJhY2tsaWdodCIsCi0JCQkJIGk5MTUtPmRybS5wcmltYXJ5LT5p
bmRleCwgY29ubmVjdG9yLT5iYXNlLm5hbWUpOwotCQlpZiAoIW5hbWUpCi0JCQlyZXR1cm4gLUVO
T01FTTsKLQotCQliZCA9IGJhY2tsaWdodF9kZXZpY2VfcmVnaXN0ZXIobmFtZSwgY29ubmVjdG9y
LT5iYXNlLmtkZXYsIGNvbm5lY3RvciwKLQkJCQkJICAgICAgICZpbnRlbF9iYWNrbGlnaHRfZGV2
aWNlX29wcywgJnByb3BzKTsKLQl9Ci0KLQlpZiAoSVNfRVJSKGJkKSkgewotCQlkcm1fZXJyKCZp
OTE1LT5kcm0sCi0JCQkiW0NPTk5FQ1RPUjolZDolc10gYmFja2xpZ2h0IGRldmljZSAlcyByZWdp
c3RlciBmYWlsZWQ6ICVsZFxuIiwKLQkJCWNvbm5lY3Rvci0+YmFzZS5iYXNlLmlkLCBjb25uZWN0
b3ItPmJhc2UubmFtZSwgbmFtZSwgUFRSX0VSUihiZCkpOwotCQlyZXQgPSBQVFJfRVJSKGJkKTsK
LQkJZ290byBvdXQ7Ci0JfQotCi0JcGFuZWwtPmJhY2tsaWdodC5kZXZpY2UgPSBiZDsKLQotCWRy
bV9kYmdfa21zKCZpOTE1LT5kcm0sCi0JCSAgICAiW0NPTk5FQ1RPUjolZDolc10gYmFja2xpZ2h0
IGRldmljZSAlcyByZWdpc3RlcmVkXG4iLAotCQkgICAgY29ubmVjdG9yLT5iYXNlLmJhc2UuaWQs
IGNvbm5lY3Rvci0+YmFzZS5uYW1lLCBuYW1lKTsKLQotb3V0OgotCWtmcmVlKG5hbWUpOwotCi0J
cmV0dXJuIHJldDsKLX0KLQotdm9pZCBpbnRlbF9iYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIo
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQotewotCXN0cnVjdCBpbnRlbF9wYW5l
bCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQotCWlmIChwYW5lbC0+YmFja2xpZ2h0LmRl
dmljZSkgewotCQliYWNrbGlnaHRfZGV2aWNlX3VucmVnaXN0ZXIocGFuZWwtPmJhY2tsaWdodC5k
ZXZpY2UpOwotCQlwYW5lbC0+YmFja2xpZ2h0LmRldmljZSA9IE5VTEw7Ci0JfQotfQotI2VuZGlm
IC8qIENPTkZJR19CQUNLTElHSFRfQ0xBU1NfREVWSUNFICovCi0KLS8qCi0gKiBDTlA6IFBXTSBj
bG9jayBmcmVxdWVuY3kgaXMgMTkuMiBNSHogb3IgMjQgTUh6LgotICogICAgICBQV00gaW5jcmVt
ZW50ID0gMQotICovCi1zdGF0aWMgdTMyIGNucF9oel90b19wd20oc3RydWN0IGludGVsX2Nvbm5l
Y3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCi17Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQotCXJldHVy
biBESVZfUk9VTkRfQ0xPU0VTVChLSHooUlVOVElNRV9JTkZPKGRldl9wcml2KS0+cmF3Y2xrX2Zy
ZXEpLAotCQkJCSBwd21fZnJlcV9oeik7Ci19Ci0KLS8qCi0gKiBCWFQ6IFBXTSBjbG9jayBmcmVx
dWVuY3kgPSAxOS4yIE1Iei4KLSAqLwotc3RhdGljIHUzMiBieHRfaHpfdG9fcHdtKHN0cnVjdCBp
bnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIHB3bV9mcmVxX2h6KQotewotCXJldHVybiBE
SVZfUk9VTkRfQ0xPU0VTVChLSHooMTkyMDApLCBwd21fZnJlcV9oeik7Ci19Ci0KLS8qCi0gKiBT
UFQ6IFRoaXMgdmFsdWUgcmVwcmVzZW50cyB0aGUgcGVyaW9kIG9mIHRoZSBQV00gc3RyZWFtIGlu
IGNsb2NrIHBlcmlvZHMKLSAqIG11bHRpcGxpZWQgYnkgMTYgKGRlZmF1bHQgaW5jcmVtZW50KSBv
ciAxMjggKGFsdGVybmF0ZSBpbmNyZW1lbnQgc2VsZWN0ZWQgaW4KLSAqIFNDSElDS0VOXzEgYml0
IDApLiBQV00gY2xvY2sgaXMgMjQgTUh6LgotICovCi1zdGF0aWMgdTMyIHNwdF9oel90b19wd20o
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHopCi17Ci0J
c3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUzMiBtdWw7
Ci0KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5hbHRlcm5hdGVfcHdtX2luY3JlbWVudCkKLQkJbXVs
ID0gMTI4OwotCWVsc2UKLQkJbXVsID0gMTY7Ci0KLQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1Qo
TUh6KDI0KSwgcHdtX2ZyZXFfaHogKiBtdWwpOwotfQotCi0vKgotICogTFBUOiBUaGlzIHZhbHVl
IHJlcHJlc2VudHMgdGhlIHBlcmlvZCBvZiB0aGUgUFdNIHN0cmVhbSBpbiBjbG9jayBwZXJpb2Rz
Ci0gKiBtdWx0aXBsaWVkIGJ5IDEyOCAoZGVmYXVsdCBpbmNyZW1lbnQpIG9yIDE2IChhbHRlcm5h
dGUgaW5jcmVtZW50LCBzZWxlY3RlZCBpbgotICogTFBUIFNPVVRIX0NISUNLRU4yIHJlZ2lzdGVy
IGJpdCA1KS4KLSAqLwotc3RhdGljIHUzMiBscHRfaHpfdG9fcHdtKHN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmNvbm5lY3RvciwgdTMyIHB3bV9mcmVxX2h6KQotewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3RydWN0
IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUzMiBtdWwsIGNsb2Nr
OwotCi0JaWYgKHBhbmVsLT5iYWNrbGlnaHQuYWx0ZXJuYXRlX3B3bV9pbmNyZW1lbnQpCi0JCW11
bCA9IDE2OwotCWVsc2UKLQkJbXVsID0gMTI4OwotCi0JaWYgKEhBU19QQ0hfTFBUX0goZGV2X3By
aXYpKQotCQljbG9jayA9IE1IeigxMzUpOyAvKiBMUFQ6SCAqLwotCWVsc2UKLQkJY2xvY2sgPSBN
SHooMjQpOyAvKiBMUFQ6TFAgKi8KLQotCXJldHVybiBESVZfUk9VTkRfQ0xPU0VTVChjbG9jaywg
cHdtX2ZyZXFfaHogKiBtdWwpOwotfQotCi0vKgotICogSUxLL1NOQi9JVkI6IFRoaXMgdmFsdWUg
cmVwcmVzZW50cyB0aGUgcGVyaW9kIG9mIHRoZSBQV00gc3RyZWFtIGluIFBDSAotICogZGlzcGxh
eSByYXcgY2xvY2tzIG11bHRpcGxpZWQgYnkgMTI4LgotICovCi1zdGF0aWMgdTMyIHBjaF9oel90
b19wd20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFfaHop
Ci17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0
b3ItPmJhc2UuZGV2KTsKLQotCXJldHVybiBESVZfUk9VTkRfQ0xPU0VTVChLSHooUlVOVElNRV9J
TkZPKGRldl9wcml2KS0+cmF3Y2xrX2ZyZXEpLAotCQkJCSBwd21fZnJlcV9oeiAqIDEyOCk7Ci19
Ci0KLS8qCi0gKiBHZW4yOiBUaGlzIGZpZWxkIGRldGVybWluZXMgdGhlIG51bWJlciBvZiB0aW1l
IGJhc2UgZXZlbnRzIChkaXNwbGF5IGNvcmUKLSAqIGNsb2NrIGZyZXF1ZW5jeS8zMikgaW4gdG90
YWwgZm9yIGEgY29tcGxldGUgY3ljbGUgb2YgbW9kdWxhdGVkIGJhY2tsaWdodAotICogY29udHJv
bC4KLSAqCi0gKiBHZW4zOiBBIHRpbWUgYmFzZSBldmVudCBlcXVhbHMgdGhlIGRpc3BsYXkgY29y
ZSBjbG9jayAoW0RldlBOVl0gSFJBVyBjbG9jaykKLSAqIGRpdmlkZWQgYnkgMzIuCi0gKi8KLXN0
YXRpYyB1MzIgaTl4eF9oel90b19wd20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9y
LCB1MzIgcHdtX2ZyZXFfaHopCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlpbnQgY2xvY2s7Ci0KLQlpZiAoSVNf
UElORVZJRVcoZGV2X3ByaXYpKQotCQljbG9jayA9IEtIeihSVU5USU1FX0lORk8oZGV2X3ByaXYp
LT5yYXdjbGtfZnJlcSk7Ci0JZWxzZQotCQljbG9jayA9IEtIeihkZXZfcHJpdi0+Y2RjbGsuaHcu
Y2RjbGspOwotCi0JcmV0dXJuIERJVl9ST1VORF9DTE9TRVNUKGNsb2NrLCBwd21fZnJlcV9oeiAq
IDMyKTsKLX0KLQotLyoKLSAqIEdlbjQ6IFRoaXMgdmFsdWUgcmVwcmVzZW50cyB0aGUgcGVyaW9k
IG9mIHRoZSBQV00gc3RyZWFtIGluIGRpc3BsYXkgY29yZQotICogY2xvY2tzIChbRGV2Q1RHXSBI
UkFXIGNsb2NrcykgbXVsdGlwbGllZCBieSAxMjguCi0gKgotICovCi1zdGF0aWMgdTMyIGk5NjVf
aHpfdG9fcHdtKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIHB3bV9mcmVx
X2h6KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29u
bmVjdG9yLT5iYXNlLmRldik7Ci0JaW50IGNsb2NrOwotCi0JaWYgKElTX0c0WChkZXZfcHJpdikp
Ci0JCWNsb2NrID0gS0h6KFJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPnJhd2Nsa19mcmVxKTsKLQll
bHNlCi0JCWNsb2NrID0gS0h6KGRldl9wcml2LT5jZGNsay5ody5jZGNsayk7Ci0KLQlyZXR1cm4g
RElWX1JPVU5EX0NMT1NFU1QoY2xvY2ssIHB3bV9mcmVxX2h6ICogMTI4KTsKLX0KLQotLyoKLSAq
IFZMVjogVGhpcyB2YWx1ZSByZXByZXNlbnRzIHRoZSBwZXJpb2Qgb2YgdGhlIFBXTSBzdHJlYW0g
aW4gZGlzcGxheSBjb3JlCi0gKiBjbG9ja3MgKFtEZXZDVEddIDIwME1IeiBIUkFXIGNsb2Nrcykg
bXVsdGlwbGllZCBieSAxMjggb3IgMjVNSHogUzBJWCBjbG9ja3MKLSAqIG11bHRpcGxpZWQgYnkg
MTYuIENIViB1c2VzIGEgMTkuMk1IeiBTMElYIGNsb2NrLgotICovCi1zdGF0aWMgdTMyIHZsdl9o
el90b19wd20oc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCB1MzIgcHdtX2ZyZXFf
aHopCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25u
ZWN0b3ItPmJhc2UuZGV2KTsKLQlpbnQgbXVsLCBjbG9jazsKLQotCWlmICgoaW50ZWxfZGVfcmVh
ZChkZXZfcHJpdiwgQ0JSMV9WTFYpICYgQ0JSX1BXTV9DTE9DS19NVVhfU0VMRUNUKSA9PSAwKSB7
Ci0JCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJCWNsb2NrID0gS0h6KDE5MjAwKTsK
LQkJZWxzZQotCQkJY2xvY2sgPSBNSHooMjUpOwotCQltdWwgPSAxNjsKLQl9IGVsc2UgewotCQlj
bG9jayA9IEtIeihSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5yYXdjbGtfZnJlcSk7Ci0JCW11bCA9
IDEyODsKLQl9Ci0KLQlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoY2xvY2ssIHB3bV9mcmVxX2h6
ICogbXVsKTsKLX0KLQotc3RhdGljIHUxNiBnZXRfdmJ0X3B3bV9mcmVxKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKLXsKLQl1MTYgcHdtX2ZyZXFfaHogPSBkZXZfcHJpdi0+dmJ0
LmJhY2tsaWdodC5wd21fZnJlcV9oejsKLQotCWlmIChwd21fZnJlcV9oeikgewotCQlkcm1fZGJn
X2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiVkJUIGRlZmluZWQgYmFja2xpZ2h0IGZyZXF1
ZW5jeSAldSBIelxuIiwKLQkJCSAgICBwd21fZnJlcV9oeik7Ci0JfSBlbHNlIHsKLQkJcHdtX2Zy
ZXFfaHogPSAyMDA7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJkZWZh
dWx0IGJhY2tsaWdodCBmcmVxdWVuY3kgJXUgSHpcbiIsCi0JCQkgICAgcHdtX2ZyZXFfaHopOwot
CX0KLQotCXJldHVybiBwd21fZnJlcV9oejsKLX0KLQotc3RhdGljIHUzMiBnZXRfYmFja2xpZ2h0
X21heF92YnQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQotewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7
Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUxNiBw
d21fZnJlcV9oeiA9IGdldF92YnRfcHdtX2ZyZXEoZGV2X3ByaXYpOwotCXUzMiBwd207Ci0KLQlp
ZiAoIXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzLT5oel90b19wd20pIHsKLQkJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgImJhY2tsaWdodCBmcmVxdWVuY3kgY29udmVyc2lv
biBub3Qgc3VwcG9ydGVkXG4iKTsKLQkJcmV0dXJuIDA7Ci0JfQotCi0JcHdtID0gcGFuZWwtPmJh
Y2tsaWdodC5wd21fZnVuY3MtPmh6X3RvX3B3bShjb25uZWN0b3IsIHB3bV9mcmVxX2h6KTsKLQlp
ZiAoIXB3bSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiYmFja2xp
Z2h0IGZyZXF1ZW5jeSBjb252ZXJzaW9uIGZhaWxlZFxuIik7Ci0JCXJldHVybiAwOwotCX0KLQot
CXJldHVybiBwd207Ci19Ci0KLS8qCi0gKiBOb3RlOiBUaGUgc2V0dXAgaG9va3MgY2FuJ3QgYXNz
dW1lIHBpcGUgaXMgc2V0IQotICovCi1zdGF0aWMgdTMyIGdldF9iYWNrbGlnaHRfbWluX3ZidChz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlzdHJ1Y3Qg
aW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0JaW50IG1pbjsKLQotCWRy
bV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgg
PT0gMCk7Ci0KLQkvKgotCSAqIFhYWDogSWYgdGhlIHZidCB2YWx1ZSBpcyAyNTUsIGl0IG1ha2Vz
IG1pbiBlcXVhbCB0byBtYXgsIHdoaWNoIGxlYWRzCi0JICogdG8gcHJvYmxlbXMuIFRoZXJlIGFy
ZSBzdWNoIG1hY2hpbmVzIG91dCB0aGVyZS4gRWl0aGVyIG91cgotCSAqIGludGVycHJldGF0aW9u
IGlzIHdyb25nIG9yIHRoZSB2YnQgaGFzIGJvZ3VzIGRhdGEuIE9yIGJvdGguIFNhZmVndWFyZAot
CSAqIGFnYWluc3QgdGhpcyBieSBsZXR0aW5nIHRoZSBtaW5pbXVtIGJlIGF0IG1vc3QgKGFyYml0
cmFyaWx5IGNob3NlbikKLQkgKiAyNSUgb2YgdGhlIG1heC4KLQkgKi8KLQltaW4gPSBjbGFtcF90
KGludCwgZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQubWluX2JyaWdodG5lc3MsIDAsIDY0KTsKLQlp
ZiAobWluICE9IGRldl9wcml2LT52YnQuYmFja2xpZ2h0Lm1pbl9icmlnaHRuZXNzKSB7Ci0JCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJjbGFtcGluZyBWQlQgbWluIGJhY2ts
aWdodCAlZC8yNTUgdG8gJWQvMjU1XG4iLAotCQkJICAgIGRldl9wcml2LT52YnQuYmFja2xpZ2h0
Lm1pbl9icmlnaHRuZXNzLCBtaW4pOwotCX0KLQotCS8qIHZidCB2YWx1ZSBpcyBhIGNvZWZmaWNp
ZW50IGluIHJhbmdlIFswLi4yNTVdICovCi0JcmV0dXJuIHNjYWxlKG1pbiwgMCwgMjU1LCAwLCBw
YW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpOwotfQotCi1zdGF0aWMgaW50IGxwdF9zZXR1
cF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUg
dW51c2VkKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25u
ZWN0b3ItPnBhbmVsOwotCXUzMiBjcHVfY3RsMiwgcGNoX2N0bDEsIHBjaF9jdGwyLCB2YWw7Ci0J
Ym9vbCBhbHQsIGNwdV9tb2RlOwotCi0JaWYgKEhBU19QQ0hfTFBUKGRldl9wcml2KSkKLQkJYWx0
ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgU09VVEhfQ0hJQ0tFTjIpICYgTFBUX1BXTV9HUkFO
VUxBUklUWTsKLQllbHNlCi0JCWFsdCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFNPVVRIX0NI
SUNLRU4xKSAmIFNQVF9QV01fR1JBTlVMQVJJVFk7Ci0JcGFuZWwtPmJhY2tsaWdodC5hbHRlcm5h
dGVfcHdtX2luY3JlbWVudCA9IGFsdDsKLQotCXBjaF9jdGwxID0gaW50ZWxfZGVfcmVhZChkZXZf
cHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMSk7Ci0JcGFuZWwtPmJhY2tsaWdodC5hY3RpdmVfbG93X3B3
bSA9IHBjaF9jdGwxICYgQkxNX1BDSF9QT0xBUklUWTsKLQotCXBjaF9jdGwyID0gaW50ZWxfZGVf
cmVhZChkZXZfcHJpdiwgQkxDX1BXTV9QQ0hfQ1RMMik7Ci0JcGFuZWwtPmJhY2tsaWdodC5wd21f
bGV2ZWxfbWF4ID0gcGNoX2N0bDIgPj4gMTY7Ci0KLQljcHVfY3RsMiA9IGludGVsX2RlX3JlYWQo
ZGV2X3ByaXYsIEJMQ19QV01fQ1BVX0NUTDIpOwotCi0JaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnB3
bV9sZXZlbF9tYXgpCi0JCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA9IGdldF9iYWNr
bGlnaHRfbWF4X3ZidChjb25uZWN0b3IpOwotCi0JaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnB3bV9s
ZXZlbF9tYXgpCi0JCXJldHVybiAtRU5PREVWOwotCi0JcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2
ZWxfbWluID0gZ2V0X2JhY2tsaWdodF9taW5fdmJ0KGNvbm5lY3Rvcik7Ci0KLQlwYW5lbC0+YmFj
a2xpZ2h0LnB3bV9lbmFibGVkID0gcGNoX2N0bDEgJiBCTE1fUENIX1BXTV9FTkFCTEU7Ci0KLQlj
cHVfbW9kZSA9IHBhbmVsLT5iYWNrbGlnaHQucHdtX2VuYWJsZWQgJiYgSEFTX1BDSF9MUFQoZGV2
X3ByaXYpICYmCi0JCSAgICEocGNoX2N0bDEgJiBCTE1fUENIX09WRVJSSURFX0VOQUJMRSkgJiYK
LQkJICAgKGNwdV9jdGwyICYgQkxNX1BXTV9FTkFCTEUpOwotCi0JaWYgKGNwdV9tb2RlKSB7Ci0J
CXZhbCA9IHBjaF9nZXRfYmFja2xpZ2h0KGNvbm5lY3RvciwgdW51c2VkKTsKLQotCQlkcm1fZGJn
X2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiQ1BVIGJhY2tsaWdodCByZWdpc3RlciB3YXMg
ZW5hYmxlZCwgc3dpdGNoaW5nIHRvIFBDSCBvdmVycmlkZVxuIik7Ci0KLQkJLyogV3JpdGUgY29u
dmVydGVkIENQVSBQV00gdmFsdWUgdG8gUENIIG92ZXJyaWRlIHJlZ2lzdGVyICovCi0JCWxwdF9z
ZXRfYmFja2xpZ2h0KGNvbm5lY3Rvci0+YmFzZS5zdGF0ZSwgdmFsKTsKLQkJaW50ZWxfZGVfd3Jp
dGUoZGV2X3ByaXYsIEJMQ19QV01fUENIX0NUTDEsCi0JCQkgICAgICAgcGNoX2N0bDEgfCBCTE1f
UENIX09WRVJSSURFX0VOQUJMRSk7Ci0KLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEJMQ19Q
V01fQ1BVX0NUTDIsCi0JCQkgICAgICAgY3B1X2N0bDIgJiB+QkxNX1BXTV9FTkFCTEUpOwotCX0K
LQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHBjaF9zZXR1cF9iYWNrbGlnaHQoc3RydWN0
IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUgdW51c2VkKQotewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRl
dik7Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCXUz
MiBjcHVfY3RsMiwgcGNoX2N0bDEsIHBjaF9jdGwyOwotCi0JcGNoX2N0bDEgPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwxKTsKLQlwYW5lbC0+YmFja2xpZ2h0LmFjdGl2
ZV9sb3dfcHdtID0gcGNoX2N0bDEgJiBCTE1fUENIX1BPTEFSSVRZOwotCi0JcGNoX2N0bDIgPSBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX1BDSF9DVEwyKTsKLQlwYW5lbC0+YmFja2xp
Z2h0LnB3bV9sZXZlbF9tYXggPSBwY2hfY3RsMiA+PiAxNjsKLQotCWlmICghcGFuZWwtPmJhY2ts
aWdodC5wd21fbGV2ZWxfbWF4KQotCQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPSBn
ZXRfYmFja2xpZ2h0X21heF92YnQoY29ubmVjdG9yKTsKLQotCWlmICghcGFuZWwtPmJhY2tsaWdo
dC5wd21fbGV2ZWxfbWF4KQotCQlyZXR1cm4gLUVOT0RFVjsKLQotCXBhbmVsLT5iYWNrbGlnaHQu
cHdtX2xldmVsX21pbiA9IGdldF9iYWNrbGlnaHRfbWluX3ZidChjb25uZWN0b3IpOwotCi0JY3B1
X2N0bDIgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBCTENfUFdNX0NQVV9DVEwyKTsKLQlwYW5l
bC0+YmFja2xpZ2h0LnB3bV9lbmFibGVkID0gKGNwdV9jdGwyICYgQkxNX1BXTV9FTkFCTEUpICYm
Ci0JCShwY2hfY3RsMSAmIEJMTV9QQ0hfUFdNX0VOQUJMRSk7Ci0KLQlyZXR1cm4gMDsKLX0KLQot
c3RhdGljIGludCBpOXh4X3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpj
b25uZWN0b3IsIGVudW0gcGlwZSB1bnVzZWQpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxf
cGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0JdTMyIGN0bCwgdmFsOwotCi0JY3Rs
ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgQkxDX1BXTV9DVEwpOwotCi0JaWYgKERJU1BMQVlf
VkVSKGRldl9wcml2KSA9PSAyIHx8IElTX0k5MTVHTShkZXZfcHJpdikgfHwgSVNfSTk0NUdNKGRl
dl9wcml2KSkKLQkJcGFuZWwtPmJhY2tsaWdodC5jb21iaW5hdGlvbl9tb2RlID0gY3RsICYgQkxN
X0xFR0FDWV9NT0RFOwotCi0JaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSkKLQkJcGFuZWwtPmJh
Y2tsaWdodC5hY3RpdmVfbG93X3B3bSA9IGN0bCAmIEJMTV9QT0xBUklUWV9QTlY7Ci0KLQlwYW5l
bC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPSBjdGwgPj4gMTc7Ci0KLQlpZiAoIXBhbmVsLT5i
YWNrbGlnaHQucHdtX2xldmVsX21heCkgewotCQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9t
YXggPSBnZXRfYmFja2xpZ2h0X21heF92YnQoY29ubmVjdG9yKTsKLQkJcGFuZWwtPmJhY2tsaWdo
dC5wd21fbGV2ZWxfbWF4ID4+PSAxOwotCX0KLQotCWlmICghcGFuZWwtPmJhY2tsaWdodC5wd21f
bGV2ZWxfbWF4KQotCQlyZXR1cm4gLUVOT0RFVjsKLQotCWlmIChwYW5lbC0+YmFja2xpZ2h0LmNv
bWJpbmF0aW9uX21vZGUpCi0JCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCAqPSAweGZm
OwotCi0JcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluID0gZ2V0X2JhY2tsaWdodF9taW5f
dmJ0KGNvbm5lY3Rvcik7Ci0KLQl2YWwgPSBpOXh4X2dldF9iYWNrbGlnaHQoY29ubmVjdG9yLCB1
bnVzZWQpOwotCXZhbCA9IGludGVsX3BhbmVsX2ludmVydF9wd21fbGV2ZWwoY29ubmVjdG9yLCB2
YWwpOwotCXZhbCA9IGNsYW1wKHZhbCwgcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluLCBw
YW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpOwotCi0JcGFuZWwtPmJhY2tsaWdodC5wd21f
ZW5hYmxlZCA9IHZhbCAhPSAwOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgaTk2NV9z
ZXR1cF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBp
cGUgdW51c2VkKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZj
b25uZWN0b3ItPnBhbmVsOwotCXUzMiBjdGwsIGN0bDI7Ci0KLQljdGwyID0gaW50ZWxfZGVfcmVh
ZChkZXZfcHJpdiwgQkxDX1BXTV9DVEwyKTsKLQlwYW5lbC0+YmFja2xpZ2h0LmNvbWJpbmF0aW9u
X21vZGUgPSBjdGwyICYgQkxNX0NPTUJJTkFUSU9OX01PREU7Ci0JcGFuZWwtPmJhY2tsaWdodC5h
Y3RpdmVfbG93X3B3bSA9IGN0bDIgJiBCTE1fUE9MQVJJVFlfSTk2NTsKLQotCWN0bCA9IGludGVs
X2RlX3JlYWQoZGV2X3ByaXYsIEJMQ19QV01fQ1RMKTsKLQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9s
ZXZlbF9tYXggPSBjdGwgPj4gMTY7Ci0KLQlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVs
X21heCkKLQkJcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ID0gZ2V0X2JhY2tsaWdodF9t
YXhfdmJ0KGNvbm5lY3Rvcik7Ci0KLQlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21h
eCkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5jb21iaW5hdGlv
bl9tb2RlKQotCQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggKj0gMHhmZjsKLQotCXBh
bmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21pbiA9IGdldF9iYWNrbGlnaHRfbWluX3ZidChjb25u
ZWN0b3IpOwotCi0JcGFuZWwtPmJhY2tsaWdodC5wd21fZW5hYmxlZCA9IGN0bDIgJiBCTE1fUFdN
X0VOQUJMRTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHZsdl9zZXR1cF9iYWNrbGln
aHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBlbnVtIHBpcGUgcGlwZSkKLXsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+
YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5l
bDsKLQl1MzIgY3RsLCBjdGwyOwotCi0JaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBw
aXBlICE9IFBJUEVfQSAmJiBwaXBlICE9IFBJUEVfQikpCi0JCXJldHVybiAtRU5PREVWOwotCi0J
Y3RsMiA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFZMVl9CTENfUFdNX0NUTDIocGlwZSkpOwot
CXBhbmVsLT5iYWNrbGlnaHQuYWN0aXZlX2xvd19wd20gPSBjdGwyICYgQkxNX1BPTEFSSVRZX0k5
NjU7Ci0KLQljdGwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBWTFZfQkxDX1BXTV9DVEwocGlw
ZSkpOwotCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA9IGN0bCA+PiAxNjsKLQotCWlm
ICghcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4KQotCQlwYW5lbC0+YmFja2xpZ2h0LnB3
bV9sZXZlbF9tYXggPSBnZXRfYmFja2xpZ2h0X21heF92YnQoY29ubmVjdG9yKTsKLQotCWlmICgh
cGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4KQotCQlyZXR1cm4gLUVOT0RFVjsKLQotCXBh
bmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21pbiA9IGdldF9iYWNrbGlnaHRfbWluX3ZidChjb25u
ZWN0b3IpOwotCi0JcGFuZWwtPmJhY2tsaWdodC5wd21fZW5hYmxlZCA9IGN0bDIgJiBCTE1fUFdN
X0VOQUJMRTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50Ci1ieHRfc2V0dXBfYmFja2xp
Z2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciwgZW51bSBwaXBlIHVudXNlZCkK
LXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rv
ci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5w
YW5lbDsKLQl1MzIgcHdtX2N0bCwgdmFsOwotCi0JcGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVy
ID0gZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQuY29udHJvbGxlcjsKLQotCXB3bV9jdGwgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LAotCQkJCUJYVF9CTENfUFdNX0NUTChwYW5lbC0+YmFja2xpZ2h0
LmNvbnRyb2xsZXIpKTsKLQotCS8qIENvbnRyb2xsZXIgMSB1c2VzIHRoZSB1dGlsaXR5IHBpbi4g
Ki8KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyID09IDEpIHsKLQkJdmFsID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwgVVRJTF9QSU5fQ1RMKTsKLQkJcGFuZWwtPmJhY2tsaWdodC51
dGlsX3Bpbl9hY3RpdmVfbG93ID0KLQkJCQkJdmFsICYgVVRJTF9QSU5fUE9MQVJJVFk7Ci0JfQot
Ci0JcGFuZWwtPmJhY2tsaWdodC5hY3RpdmVfbG93X3B3bSA9IHB3bV9jdGwgJiBCWFRfQkxDX1BX
TV9QT0xBUklUWTsKLQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXggPQotCQlpbnRlbF9k
ZV9yZWFkKGRldl9wcml2LCBCWFRfQkxDX1BXTV9GUkVRKHBhbmVsLT5iYWNrbGlnaHQuY29udHJv
bGxlcikpOwotCi0JaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpCi0JCXBhbmVs
LT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA9IGdldF9iYWNrbGlnaHRfbWF4X3ZidChjb25uZWN0
b3IpOwotCi0JaWYgKCFwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9tYXgpCi0JCXJldHVybiAt
RU5PREVWOwotCi0JcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluID0gZ2V0X2JhY2tsaWdo
dF9taW5fdmJ0KGNvbm5lY3Rvcik7Ci0KLQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9lbmFibGVkID0g
cHdtX2N0bCAmIEJYVF9CTENfUFdNX0VOQUJMRTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMg
aW50Ci1jbnBfc2V0dXBfYmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rv
ciwgZW51bSBwaXBlIHVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAq
cGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQl1MzIgcHdtX2N0bDsKLQotCS8qCi0JICogQ05Q
IGhhcyB0aGUgQlhUIGltcGxlbWVudGF0aW9uIG9mIGJhY2tsaWdodCwgYnV0IHdpdGggb25seSBv
bmUKLQkgKiBjb250cm9sbGVyLiBUT0RPOiBJQ1AgaGFzIG11bHRpcGxlIGNvbnRyb2xsZXJzIGJ1
dCB3ZSBvbmx5IHVzZQotCSAqIGNvbnRyb2xsZXIgMCBmb3Igbm93LgotCSAqLwotCXBhbmVsLT5i
YWNrbGlnaHQuY29udHJvbGxlciA9IDA7Ci0KLQlwd21fY3RsID0gaW50ZWxfZGVfcmVhZChkZXZf
cHJpdiwKLQkJCQlCWFRfQkxDX1BXTV9DVEwocGFuZWwtPmJhY2tsaWdodC5jb250cm9sbGVyKSk7
Ci0KLQlwYW5lbC0+YmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID0gcHdtX2N0bCAmIEJYVF9CTENf
UFdNX1BPTEFSSVRZOwotCXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCA9Ci0JCWludGVs
X2RlX3JlYWQoZGV2X3ByaXYsIEJYVF9CTENfUFdNX0ZSRVEocGFuZWwtPmJhY2tsaWdodC5jb250
cm9sbGVyKSk7Ci0KLQlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCkKLQkJcGFu
ZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ID0gZ2V0X2JhY2tsaWdodF9tYXhfdmJ0KGNvbm5l
Y3Rvcik7Ci0KLQlpZiAoIXBhbmVsLT5iYWNrbGlnaHQucHdtX2xldmVsX21heCkKLQkJcmV0dXJu
IC1FTk9ERVY7Ci0KLQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9sZXZlbF9taW4gPSBnZXRfYmFja2xp
Z2h0X21pbl92YnQoY29ubmVjdG9yKTsKLQotCXBhbmVsLT5iYWNrbGlnaHQucHdtX2VuYWJsZWQg
PSBwd21fY3RsICYgQlhUX0JMQ19QV01fRU5BQkxFOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRp
YyBpbnQgZXh0X3B3bV9zZXR1cF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29u
bmVjdG9yLAotCQkJCSAgIGVudW0gcGlwZSBwaXBlKQotewotCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSBjb25uZWN0b3ItPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5l
Y3Rvci0+cGFuZWw7Ci0JY29uc3QgY2hhciAqZGVzYzsKLQl1MzIgbGV2ZWw7Ci0KLQkvKiBHZXQg
dGhlIHJpZ2h0IFBXTSBjaGlwIGZvciBEU0kgYmFja2xpZ2h0IGFjY29yZGluZyB0byBWQlQgKi8K
LQlpZiAoZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnLT5wd21fYmxjID09IFBQU19CTENfUE1JQykg
ewotCQlwYW5lbC0+YmFja2xpZ2h0LnB3bSA9IHB3bV9nZXQoZGV2LT5kZXYsICJwd21fcG1pY19i
YWNrbGlnaHQiKTsKLQkJZGVzYyA9ICJQTUlDIjsKLQl9IGVsc2UgewotCQlwYW5lbC0+YmFja2xp
Z2h0LnB3bSA9IHB3bV9nZXQoZGV2LT5kZXYsICJwd21fc29jX2JhY2tsaWdodCIpOwotCQlkZXNj
ID0gIlNvQyI7Ci0JfQotCi0JaWYgKElTX0VSUihwYW5lbC0+YmFja2xpZ2h0LnB3bSkpIHsKLQkJ
ZHJtX2VycigmZGV2X3ByaXYtPmRybSwgIkZhaWxlZCB0byBnZXQgdGhlICVzIFBXTSBjaGlwXG4i
LAotCQkJZGVzYyk7Ci0JCXBhbmVsLT5iYWNrbGlnaHQucHdtID0gTlVMTDsKLQkJcmV0dXJuIC1F
Tk9ERVY7Ci0JfQotCi0JcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4ID0gMTAwOyAvKiAx
MDAlICovCi0JcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluID0gZ2V0X2JhY2tsaWdodF9t
aW5fdmJ0KGNvbm5lY3Rvcik7Ci0KLQlpZiAocHdtX2lzX2VuYWJsZWQocGFuZWwtPmJhY2tsaWdo
dC5wd20pKSB7Ci0JCS8qIFBXTSBpcyBhbHJlYWR5IGVuYWJsZWQsIHVzZSBleGlzdGluZyBzZXR0
aW5ncyAqLwotCQlwd21fZ2V0X3N0YXRlKHBhbmVsLT5iYWNrbGlnaHQucHdtLCAmcGFuZWwtPmJh
Y2tsaWdodC5wd21fc3RhdGUpOwotCi0JCWxldmVsID0gcHdtX2dldF9yZWxhdGl2ZV9kdXR5X2N5
Y2xlKCZwYW5lbC0+YmFja2xpZ2h0LnB3bV9zdGF0ZSwKLQkJCQkJCSAgICAxMDApOwotCQlsZXZl
bCA9IGludGVsX3BhbmVsX2ludmVydF9wd21fbGV2ZWwoY29ubmVjdG9yLCBsZXZlbCk7Ci0JCXBh
bmVsLT5iYWNrbGlnaHQucHdtX2VuYWJsZWQgPSB0cnVlOwotCi0JCWRybV9kYmdfa21zKCZkZXZf
cHJpdi0+ZHJtLCAiUFdNIGFscmVhZHkgZW5hYmxlZCBhdCBmcmVxICVsZCwgVkJUIGZyZXEgJWQs
IGxldmVsICVkXG4iLAotCQkJICAgIE5TRUNfUEVSX1NFQyAvICh1bnNpZ25lZCBsb25nKXBhbmVs
LT5iYWNrbGlnaHQucHdtX3N0YXRlLnBlcmlvZCwKLQkJCSAgICBnZXRfdmJ0X3B3bV9mcmVxKGRl
dl9wcml2KSwgbGV2ZWwpOwotCX0gZWxzZSB7Ci0JCS8qIFNldCBwZXJpb2QgZnJvbSBWQlQgZnJl
cXVlbmN5LCBsZWF2ZSBvdGhlciBzZXR0aW5ncyBhdCAwLiAqLwotCQlwYW5lbC0+YmFja2xpZ2h0
LnB3bV9zdGF0ZS5wZXJpb2QgPQotCQkJTlNFQ19QRVJfU0VDIC8gZ2V0X3ZidF9wd21fZnJlcShk
ZXZfcHJpdik7Ci0JfQotCi0JZHJtX2luZm8oJmRldl9wcml2LT5kcm0sICJVc2luZyAlcyBQV00g
Zm9yIExDRCBiYWNrbGlnaHQgY29udHJvbFxuIiwKLQkJIGRlc2MpOwotCXJldHVybiAwOwotfQot
Ci1zdGF0aWMgdm9pZCBpbnRlbF9wd21fc2V0X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSwgdTMyIGxldmVsKQotewotCXN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25u
ZWN0b3IpOwotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsK
LQotCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzLT5zZXQoY29ubl9zdGF0ZSwKLQkJCQkgICAg
ICAgaW50ZWxfcGFuZWxfaW52ZXJ0X3B3bV9sZXZlbChjb25uZWN0b3IsIGxldmVsKSk7Ci19Ci0K
LXN0YXRpYyB1MzIgaW50ZWxfcHdtX2dldF9iYWNrbGlnaHQoc3RydWN0IGludGVsX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yLCBlbnVtIHBpcGUgcGlwZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBh
bmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlyZXR1cm4gaW50ZWxfcGFuZWxfaW52ZXJ0X3B3
bV9sZXZlbChjb25uZWN0b3IsCi0JCQkJCSAgICBwYW5lbC0+YmFja2xpZ2h0LnB3bV9mdW5jcy0+
Z2V0KGNvbm5lY3RvciwgcGlwZSkpOwotfQotCi1zdGF0aWMgdm9pZCBpbnRlbF9wd21fZW5hYmxl
X2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJ
CQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUz
MiBsZXZlbCkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRl
bF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1Y3QgaW50ZWxfcGFuZWwg
KnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9mdW5j
cy0+ZW5hYmxlKGNydGNfc3RhdGUsIGNvbm5fc3RhdGUsCi0JCQkJCSAgIGludGVsX3BhbmVsX2lu
dmVydF9wd21fbGV2ZWwoY29ubmVjdG9yLCBsZXZlbCkpOwotfQotCi1zdGF0aWMgdm9pZCBpbnRl
bF9wd21fZGlzYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUg
KmNvbm5fc3RhdGUsIHUzMiBsZXZlbCkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25u
ZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQlzdHJ1
Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0KLQlwYW5lbC0+YmFj
a2xpZ2h0LnB3bV9mdW5jcy0+ZGlzYWJsZShjb25uX3N0YXRlLAotCQkJCQkgICAgaW50ZWxfcGFu
ZWxfaW52ZXJ0X3B3bV9sZXZlbChjb25uZWN0b3IsIGxldmVsKSk7Ci19Ci0KLXN0YXRpYyBpbnQg
aW50ZWxfcHdtX3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IsIGVudW0gcGlwZSBwaXBlKQotewotCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29u
bmVjdG9yLT5wYW5lbDsKLQlpbnQgcmV0ID0gcGFuZWwtPmJhY2tsaWdodC5wd21fZnVuY3MtPnNl
dHVwKGNvbm5lY3RvciwgcGlwZSk7Ci0KLQlpZiAocmV0IDwgMCkKLQkJcmV0dXJuIHJldDsKLQot
CXBhbmVsLT5iYWNrbGlnaHQubWluID0gcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWluOwot
CXBhbmVsLT5iYWNrbGlnaHQubWF4ID0gcGFuZWwtPmJhY2tsaWdodC5wd21fbGV2ZWxfbWF4Owot
CXBhbmVsLT5iYWNrbGlnaHQubGV2ZWwgPSBpbnRlbF9wd21fZ2V0X2JhY2tsaWdodChjb25uZWN0
b3IsIHBpcGUpOwotCXBhbmVsLT5iYWNrbGlnaHQuZW5hYmxlZCA9IHBhbmVsLT5iYWNrbGlnaHQu
cHdtX2VuYWJsZWQ7Ci0KLQlyZXR1cm4gMDsKLX0KLQotdm9pZCBpbnRlbF9wYW5lbF91cGRhdGVf
YmFja2xpZ2h0KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAotCQkJCSAgc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCi0JCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRl
ICpjb25uX3N0YXRlKQotewotCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRv
X2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7Ci0Jc3Ry
dWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCi0JaWYgKCFwYW5l
bC0+YmFja2xpZ2h0LnByZXNlbnQpCi0JCXJldHVybjsKLQotCW11dGV4X2xvY2soJmRldl9wcml2
LT5iYWNrbGlnaHRfbG9jayk7Ci0JaWYgKCFwYW5lbC0+YmFja2xpZ2h0LmVuYWJsZWQpCi0JCV9f
aW50ZWxfcGFuZWxfZW5hYmxlX2JhY2tsaWdodChjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKLQot
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmJhY2tsaWdodF9sb2NrKTsKLX0KLQotaW50IGludGVs
X3BhbmVsX3NldHVwX2JhY2tsaWdodChzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLCBl
bnVtIHBpcGUgcGlwZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9j
b25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKTsKLQlzdHJ1Y3QgaW50ZWxf
cGFuZWwgKnBhbmVsID0gJmludGVsX2Nvbm5lY3Rvci0+cGFuZWw7Ci0JaW50IHJldDsKLQotCWlm
ICghZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQucHJlc2VudCkgewotCQlpZiAoZGV2X3ByaXYtPnF1
aXJrcyAmIFFVSVJLX0JBQ0tMSUdIVF9QUkVTRU5UKSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwKLQkJCQkgICAgIm5vIGJhY2tsaWdodCBwcmVzZW50IHBlciBWQlQsIGJ1dCBwcmVz
ZW50IHBlciBxdWlya1xuIik7Ci0JCX0gZWxzZSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKLQkJCQkgICAgIm5vIGJhY2tsaWdodCBwcmVzZW50IHBlciBWQlRcbiIpOwotCQkJcmV0
dXJuIDA7Ci0JCX0KLQl9Ci0KLQkvKiBlbnN1cmUgaW50ZWxfcGFuZWwgaGFzIGJlZW4gaW5pdGlh
bGl6ZWQgZmlyc3QgKi8KLQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICFwYW5lbC0+
YmFja2xpZ2h0LmZ1bmNzKSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQkvKiBzZXQgbGV2ZWwgYW5k
IG1heCBpbiBwYW5lbCBzdHJ1Y3QgKi8KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0
X2xvY2spOwotCXJldCA9IHBhbmVsLT5iYWNrbGlnaHQuZnVuY3MtPnNldHVwKGludGVsX2Nvbm5l
Y3RvciwgcGlwZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+YmFja2xpZ2h0X2xvY2spOwot
Ci0JaWYgKHJldCkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiZmFp
bGVkIHRvIHNldHVwIGJhY2tsaWdodCBmb3IgY29ubmVjdG9yICVzXG4iLAotCQkJICAgIGNvbm5l
Y3Rvci0+bmFtZSk7Ci0JCXJldHVybiByZXQ7Ci0JfQotCi0JcGFuZWwtPmJhY2tsaWdodC5wcmVz
ZW50ID0gdHJ1ZTsKLQotCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkgICAgIkNvbm5l
Y3RvciAlcyBiYWNrbGlnaHQgaW5pdGlhbGl6ZWQsICVzLCBicmlnaHRuZXNzICV1LyV1XG4iLAot
CQkgICAgY29ubmVjdG9yLT5uYW1lLAotCQkgICAgZW5hYmxlZGRpc2FibGVkKHBhbmVsLT5iYWNr
bGlnaHQuZW5hYmxlZCksCi0JCSAgICBwYW5lbC0+YmFja2xpZ2h0LmxldmVsLCBwYW5lbC0+YmFj
a2xpZ2h0Lm1heCk7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZvaWQgaW50ZWxfcGFuZWxf
ZGVzdHJveV9iYWNrbGlnaHQoc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCkKLXsKLQkvKiBkaXNw
b3NlIG9mIHRoZSBwd20gKi8KLQlpZiAocGFuZWwtPmJhY2tsaWdodC5wd20pCi0JCXB3bV9wdXQo
cGFuZWwtPmJhY2tsaWdodC5wd20pOwotCi0JcGFuZWwtPmJhY2tsaWdodC5wcmVzZW50ID0gZmFs
c2U7Ci19Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfcGFuZWxfYmxfZnVuY3MgYnh0X3B3
bV9mdW5jcyA9IHsKLQkuc2V0dXAgPSBieHRfc2V0dXBfYmFja2xpZ2h0LAotCS5lbmFibGUgPSBi
eHRfZW5hYmxlX2JhY2tsaWdodCwKLQkuZGlzYWJsZSA9IGJ4dF9kaXNhYmxlX2JhY2tsaWdodCwK
LQkuc2V0ID0gYnh0X3NldF9iYWNrbGlnaHQsCi0JLmdldCA9IGJ4dF9nZXRfYmFja2xpZ2h0LAot
CS5oel90b19wd20gPSBieHRfaHpfdG9fcHdtLAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBp
bnRlbF9wYW5lbF9ibF9mdW5jcyBjbnBfcHdtX2Z1bmNzID0gewotCS5zZXR1cCA9IGNucF9zZXR1
cF9iYWNrbGlnaHQsCi0JLmVuYWJsZSA9IGNucF9lbmFibGVfYmFja2xpZ2h0LAotCS5kaXNhYmxl
ID0gY25wX2Rpc2FibGVfYmFja2xpZ2h0LAotCS5zZXQgPSBieHRfc2V0X2JhY2tsaWdodCwKLQku
Z2V0ID0gYnh0X2dldF9iYWNrbGlnaHQsCi0JLmh6X3RvX3B3bSA9IGNucF9oel90b19wd20sCi19
OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3BhbmVsX2JsX2Z1bmNzIGxwdF9wd21fZnVu
Y3MgPSB7Ci0JLnNldHVwID0gbHB0X3NldHVwX2JhY2tsaWdodCwKLQkuZW5hYmxlID0gbHB0X2Vu
YWJsZV9iYWNrbGlnaHQsCi0JLmRpc2FibGUgPSBscHRfZGlzYWJsZV9iYWNrbGlnaHQsCi0JLnNl
dCA9IGxwdF9zZXRfYmFja2xpZ2h0LAotCS5nZXQgPSBscHRfZ2V0X2JhY2tsaWdodCwKLQkuaHpf
dG9fcHdtID0gbHB0X2h6X3RvX3B3bSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxf
cGFuZWxfYmxfZnVuY3Mgc3B0X3B3bV9mdW5jcyA9IHsKLQkuc2V0dXAgPSBscHRfc2V0dXBfYmFj
a2xpZ2h0LAotCS5lbmFibGUgPSBscHRfZW5hYmxlX2JhY2tsaWdodCwKLQkuZGlzYWJsZSA9IGxw
dF9kaXNhYmxlX2JhY2tsaWdodCwKLQkuc2V0ID0gbHB0X3NldF9iYWNrbGlnaHQsCi0JLmdldCA9
IGxwdF9nZXRfYmFja2xpZ2h0LAotCS5oel90b19wd20gPSBzcHRfaHpfdG9fcHdtLAotfTsKLQot
c3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9wYW5lbF9ibF9mdW5jcyBwY2hfcHdtX2Z1bmNzID0g
ewotCS5zZXR1cCA9IHBjaF9zZXR1cF9iYWNrbGlnaHQsCi0JLmVuYWJsZSA9IHBjaF9lbmFibGVf
YmFja2xpZ2h0LAotCS5kaXNhYmxlID0gcGNoX2Rpc2FibGVfYmFja2xpZ2h0LAotCS5zZXQgPSBw
Y2hfc2V0X2JhY2tsaWdodCwKLQkuZ2V0ID0gcGNoX2dldF9iYWNrbGlnaHQsCi0JLmh6X3RvX3B3
bSA9IHBjaF9oel90b19wd20sCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3BhbmVs
X2JsX2Z1bmNzIGV4dF9wd21fZnVuY3MgPSB7Ci0JLnNldHVwID0gZXh0X3B3bV9zZXR1cF9iYWNr
bGlnaHQsCi0JLmVuYWJsZSA9IGV4dF9wd21fZW5hYmxlX2JhY2tsaWdodCwKLQkuZGlzYWJsZSA9
IGV4dF9wd21fZGlzYWJsZV9iYWNrbGlnaHQsCi0JLnNldCA9IGV4dF9wd21fc2V0X2JhY2tsaWdo
dCwKLQkuZ2V0ID0gZXh0X3B3bV9nZXRfYmFja2xpZ2h0LAotfTsKLQotc3RhdGljIGNvbnN0IHN0
cnVjdCBpbnRlbF9wYW5lbF9ibF9mdW5jcyB2bHZfcHdtX2Z1bmNzID0gewotCS5zZXR1cCA9IHZs
dl9zZXR1cF9iYWNrbGlnaHQsCi0JLmVuYWJsZSA9IHZsdl9lbmFibGVfYmFja2xpZ2h0LAotCS5k
aXNhYmxlID0gdmx2X2Rpc2FibGVfYmFja2xpZ2h0LAotCS5zZXQgPSB2bHZfc2V0X2JhY2tsaWdo
dCwKLQkuZ2V0ID0gdmx2X2dldF9iYWNrbGlnaHQsCi0JLmh6X3RvX3B3bSA9IHZsdl9oel90b19w
d20sCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3BhbmVsX2JsX2Z1bmNzIGk5NjVf
cHdtX2Z1bmNzID0gewotCS5zZXR1cCA9IGk5NjVfc2V0dXBfYmFja2xpZ2h0LAotCS5lbmFibGUg
PSBpOTY1X2VuYWJsZV9iYWNrbGlnaHQsCi0JLmRpc2FibGUgPSBpOTY1X2Rpc2FibGVfYmFja2xp
Z2h0LAotCS5zZXQgPSBpOXh4X3NldF9iYWNrbGlnaHQsCi0JLmdldCA9IGk5eHhfZ2V0X2JhY2ts
aWdodCwKLQkuaHpfdG9fcHdtID0gaTk2NV9oel90b19wd20sCi19OwotCi1zdGF0aWMgY29uc3Qg
c3RydWN0IGludGVsX3BhbmVsX2JsX2Z1bmNzIGk5eHhfcHdtX2Z1bmNzID0gewotCS5zZXR1cCA9
IGk5eHhfc2V0dXBfYmFja2xpZ2h0LAotCS5lbmFibGUgPSBpOXh4X2VuYWJsZV9iYWNrbGlnaHQs
Ci0JLmRpc2FibGUgPSBpOXh4X2Rpc2FibGVfYmFja2xpZ2h0LAotCS5zZXQgPSBpOXh4X3NldF9i
YWNrbGlnaHQsCi0JLmdldCA9IGk5eHhfZ2V0X2JhY2tsaWdodCwKLQkuaHpfdG9fcHdtID0gaTl4
eF9oel90b19wd20sCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3BhbmVsX2JsX2Z1
bmNzIHB3bV9ibF9mdW5jcyA9IHsKLQkuc2V0dXAgPSBpbnRlbF9wd21fc2V0dXBfYmFja2xpZ2h0
LAotCS5lbmFibGUgPSBpbnRlbF9wd21fZW5hYmxlX2JhY2tsaWdodCwKLQkuZGlzYWJsZSA9IGlu
dGVsX3B3bV9kaXNhYmxlX2JhY2tsaWdodCwKLQkuc2V0ID0gaW50ZWxfcHdtX3NldF9iYWNrbGln
aHQsCi0JLmdldCA9IGludGVsX3B3bV9nZXRfYmFja2xpZ2h0LAotfTsKLQotLyogU2V0IHVwIGNo
aXAgc3BlY2lmaWMgYmFja2xpZ2h0IGZ1bmN0aW9ucyAqLwotc3RhdGljIHZvaWQKLWludGVsX3Bh
bmVsX2luaXRfYmFja2xpZ2h0X2Z1bmNzKHN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwpCi17Ci0J
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0KLQkJY29udGFpbmVyX29mKHBhbmVs
LCBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yLCBwYW5lbCk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKLQotCWlmIChjb25u
ZWN0b3ItPmJhc2UuY29ubmVjdG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVDVE9SX0RTSSAmJgot
CSAgICBpbnRlbF9kc2lfZGNzX2luaXRfYmFja2xpZ2h0X2Z1bmNzKGNvbm5lY3RvcikgPT0gMCkK
LQkJcmV0dXJuOwotCi0JaWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpIHx8IElTX0JST1hUT04o
ZGV2X3ByaXYpKSB7Ci0JCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzID0gJmJ4dF9wd21fZnVu
Y3M7Ci0JfSBlbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShkZXZfcHJpdikgPj0gUENIX0NOUCkgewot
CQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9mdW5jcyA9ICZjbnBfcHdtX2Z1bmNzOwotCX0gZWxzZSBp
ZiAoSU5URUxfUENIX1RZUEUoZGV2X3ByaXYpID49IFBDSF9MUFQpIHsKLQkJaWYgKEhBU19QQ0hf
TFBUKGRldl9wcml2KSkKLQkJCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzID0gJmxwdF9wd21f
ZnVuY3M7Ci0JCWVsc2UKLQkJCXBhbmVsLT5iYWNrbGlnaHQucHdtX2Z1bmNzID0gJnNwdF9wd21f
ZnVuY3M7Ci0JfSBlbHNlIGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgewotCQlwYW5lbC0+
YmFja2xpZ2h0LnB3bV9mdW5jcyA9ICZwY2hfcHdtX2Z1bmNzOwotCX0gZWxzZSBpZiAoSVNfVkFM
TEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKLQkJaWYgKGNv
bm5lY3Rvci0+YmFzZS5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNUT1JfRFNJKSB7
Ci0JCQlwYW5lbC0+YmFja2xpZ2h0LnB3bV9mdW5jcyA9ICZleHRfcHdtX2Z1bmNzOwotCQl9IGVs
c2UgewotCQkJcGFuZWwtPmJhY2tsaWdodC5wd21fZnVuY3MgPSAmdmx2X3B3bV9mdW5jczsKLQkJ
fQotCX0gZWxzZSBpZiAoRElTUExBWV9WRVIoZGV2X3ByaXYpID09IDQpIHsKLQkJcGFuZWwtPmJh
Y2tsaWdodC5wd21fZnVuY3MgPSAmaTk2NV9wd21fZnVuY3M7Ci0JfSBlbHNlIHsKLQkJcGFuZWwt
PmJhY2tsaWdodC5wd21fZnVuY3MgPSAmaTl4eF9wd21fZnVuY3M7Ci0JfQotCi0JaWYgKGNvbm5l
Y3Rvci0+YmFzZS5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNUT1JfZURQICYmCi0J
ICAgIGludGVsX2RwX2F1eF9pbml0X2JhY2tsaWdodF9mdW5jcyhjb25uZWN0b3IpID09IDApCi0J
CXJldHVybjsKLQotCS8qIFdlJ3JlIHVzaW5nIGEgc3RhbmRhcmQgUFdNIGJhY2tsaWdodCBpbnRl
cmZhY2UgKi8KLQlwYW5lbC0+YmFja2xpZ2h0LmZ1bmNzID0gJnB3bV9ibF9mdW5jczsKLX0KLQog
ZW51bSBkcm1fY29ubmVjdG9yX3N0YXR1cwogaW50ZWxfcGFuZWxfZGV0ZWN0KHN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3IsIGJvb2wgZm9yY2UpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3BhbmVsLmgKaW5kZXggMWQzNDBmNzdiZmZjLi5hZTY4NGU4MDgyY2Ig
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGFuZWwuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmgKQEAgLTgsMTYg
KzgsMTMgQEAKIAogI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAKLSNpbmNsdWRlICJpbnRlbF9k
aXNwbGF5LmgiCi0KIHN0cnVjdCBkcm1fY29ubmVjdG9yOwogc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGU7CiBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZTsKIHN0cnVjdCBpbnRlbF9jb25uZWN0b3I7
Ci1zdHJ1Y3QgaW50ZWxfY3J0YzsKIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOwotc3RydWN0IGlu
dGVsX2VuY29kZXI7CiBzdHJ1Y3QgaW50ZWxfcGFuZWw7CitlbnVtIGRybV9jb25uZWN0b3Jfc3Rh
dHVzOwogCiBpbnQgaW50ZWxfcGFuZWxfaW5pdChzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsLAog
CQkgICAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlLApAQCAtMzEsMTcgKzI4
LDYgQEAgaW50IGludGVsX3BjaF9wYW5lbF9maXR0aW5nKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpj
b25uX3N0YXRlKTsKIGludCBpbnRlbF9nbWNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpjb25uX3N0YXRlKTsKLXZvaWQgaW50ZWxfcGFuZWxfc2V0X2JhY2tsaWdodF9hY3Bp
KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLAotCQkJCSAgICB1
MzIgbGV2ZWwsIHUzMiBtYXgpOwotaW50IGludGVsX3BhbmVsX3NldHVwX2JhY2tsaWdodChzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAotCQkJCWVudW0gcGlwZSBwaXBlKTsKLXZvaWQg
aW50ZWxfcGFuZWxfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKLQkJCQkgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpj
b25uX3N0YXRlKTsKLXZvaWQgaW50ZWxfcGFuZWxfdXBkYXRlX2JhY2tsaWdodChzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKLQkJCQkgIHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAotCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0J
CQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7Ci12b2lk
IGludGVsX3BhbmVsX2Rpc2FibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpvbGRfY29ubl9zdGF0ZSk7CiBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqCiBpbnRl
bF9wYW5lbF9lZGlkX2Rvd25jbG9ja19tb2RlKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5l
Y3RvciwKIAkJCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZml4ZWRfbW9kZSk7CkBA
IC00OSwyMiArMzUsNSBAQCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqCiBpbnRlbF9wYW5lbF9l
ZGlkX2ZpeGVkX21vZGUoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKTsKIHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICoKIGludGVsX3BhbmVsX3ZidF9maXhlZF9tb2RlKHN0cnVjdCBp
bnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rvcik7Ci12b2lkIGludGVsX3BhbmVsX3NldF9wd21fbGV2
ZWwoY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsIHUzMiBsZXZl
bCk7Ci11MzIgaW50ZWxfcGFuZWxfaW52ZXJ0X3B3bV9sZXZlbChzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IsIHUzMiBsZXZlbCk7Ci11MzIgaW50ZWxfcGFuZWxfYmFja2xpZ2h0X2xl
dmVsX3RvX3B3bShzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsIHUzMiBsZXZlbCk7
Ci11MzIgaW50ZWxfcGFuZWxfYmFja2xpZ2h0X2xldmVsX2Zyb21fcHdtKHN0cnVjdCBpbnRlbF9j
b25uZWN0b3IgKmNvbm5lY3RvciwgdTMyIHZhbCk7Ci0KLSNpZiBJU19FTkFCTEVEKENPTkZJR19C
QUNLTElHSFRfQ0xBU1NfREVWSUNFKQotaW50IGludGVsX2JhY2tsaWdodF9kZXZpY2VfcmVnaXN0
ZXIoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKTsKLXZvaWQgaW50ZWxfYmFja2xp
Z2h0X2RldmljZV91bnJlZ2lzdGVyKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rvcik7
Ci0jZWxzZSAvKiBDT05GSUdfQkFDS0xJR0hUX0NMQVNTX0RFVklDRSAqLwotc3RhdGljIGlubGlu
ZSBpbnQgaW50ZWxfYmFja2xpZ2h0X2RldmljZV9yZWdpc3RlcihzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICpjb25uZWN0b3IpCi17Ci0JcmV0dXJuIDA7Ci19Ci1zdGF0aWMgaW5saW5lIHZvaWQgaW50
ZWxfYmFja2xpZ2h0X2RldmljZV91bnJlZ2lzdGVyKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNv
bm5lY3RvcikKLXsKLX0KLSNlbmRpZiAvKiBDT05GSUdfQkFDS0xJR0hUX0NMQVNTX0RFVklDRSAq
LwogCiAjZW5kaWYgLyogX19JTlRFTF9QQU5FTF9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS92bHZfZHNpLmMKaW5kZXggMDg0YzljNDNiMmVkLi5mMDE1NmE3MTRhNzIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jCkBAIC0zMiw2ICszMiw3IEBACiAKICNpbmNs
dWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImludGVsX2F0b21pYy5oIgorI2luY2x1ZGUgImlu
dGVsX2JhY2tsaWdodC5oIgogI2luY2x1ZGUgImludGVsX2Nvbm5lY3Rvci5oIgogI2luY2x1ZGUg
ImludGVsX2NydGMuaCIKICNpbmNsdWRlICJpbnRlbF9kZS5oIgotLSAKMi4yMC4xCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

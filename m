Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A0D7AA29E
	for <lists+intel-gfx@lfdr.de>; Thu,  5 Sep 2019 14:05:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 30EE66E098;
	Thu,  5 Sep 2019 12:05:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 225F66E095
 for <intel-gfx@lists.freedesktop.org>; Thu,  5 Sep 2019 12:05:12 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Sep 2019 05:05:11 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,470,1559545200"; d="scan'208";a="190474660"
Received: from aandueza-mobl1.amr.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.252.38.201])
 by FMSMGA003.fm.intel.com with ESMTP; 05 Sep 2019 05:05:10 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  5 Sep 2019 15:04:48 +0300
Message-Id: <20190905120451.14327-10-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190905120451.14327-1-lionel.g.landwerlin@intel.com>
References: <20190905120451.14327-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v14 09/12] drm/i915/perf: execute OA
 configuration from command stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgaGF2ZW4ndCBydW4gaW50byBpc3N1ZXMgd2l0aCBwcm9ncmFtbWluZyB0aGUgZ2xvYmFsIE9B
L05PQQpyZWdpc3RlcnMgY29uZmlndXJhdGlvbiBmcm9tIENQVSBzbyBmYXIsIGJ1dCBIVyBlbmdp
bmVlcnMgYWN0dWFsbHkKcmVjb21tZW5kIGRvaW5nIHRoaXMgZnJvbSB0aGUgY29tbWFuZCBzdHJl
YW1lci4gT24gVEdMIGluIHBhcnRpY3VsYXIKb25lIG9mIHRoZSBjbG9jayBkb21haW4gaW4gd2hp
Y2ggc29tZSBvZiB0aGF0IHByb2dyYW1taW5nIGdvZXMgbWlnaHQKbm90IGJlIHBvd2VyZWQgd2hl
biB3ZSBwb2tlIHRoaW5ncyBmcm9tIHRoZSBDUFUuCgpTaW5jZSB3ZSBoYXZlIGEgY29tbWFuZCBi
dWZmZXIgcHJlcGFyZWQgZm9yIHRoZSBleGVjYnVmZmVyIHNpZGUgb2YKdGhpbmdzLCB3ZSBjYW4g
cmV1c2UgdGhhdCBhcHByb2FjaCBoZXJlIHRvby4KClRoaXMgYWxzbyBhbGxvd3MgdXMgdG8gc2ln
bmlmaWNhbnRseSByZWR1Y2UgdGhlIGFtb3VudCBvZiB0aW1lIHdlIGhvbGQKdGhlIG1haW4gbG9j
ay4KCnYyOiBEcm9wIHRoZSBnbG9iYWwgbG9jayBhcyBtdWNoIGFzIHBvc3NpYmxlCgp2MzogVGFr
ZSBnbG9iYWwgbG9jayB0byBwaW4gZ2xvYmFsCgp2NDogQ3JlYXRlIGk5MTUgcmVxdWVzdCBpbiBl
bWl0X29hX2NvbmZpZygpIHRvIGF2b2lkIGRlYWRsb2NrcyAoTGlvbmVsKQoKdjU6IE1vdmUgbG9j
a2luZyB0byB0aGUgc3RyZWFtIChMaW9uZWwpCgp2NjogTW92ZSBhY3RpdmUgcmVjb25maWd1cmF0
aW9uIHJlcXVlc3QgaW50byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwpCgp2NzogUGluIFZNQSBv
dXRzaWRlIHJlcXVlc3QgY3JlYXRpb24gKENocmlzKQogICAgTG9jayBWTUEgYmVmb3JlIG1vdmUg
dG8gYWN0aXZlIChDaHJpcykKCnY4OiBGaXggZG91YmxlIGZyZWUgb24gc3RyZWFtLT5pbml0aWFs
X29hX2NvbmZpZ19ibyAoTGlvbmVsKQogICAgRG9uJ3QgYWxsb3cgaW50ZXJydXB0aW9uIHdoZW4g
d2FpdGluZyBvbiBhY3RpdmUgY29uZmlnIHJlcXVlc3QKICAgIChMaW9uZWwpCgpTaWduZWQtb2Zm
LWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgfCAgMTMgKystCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmYuYyB8IDE3MCArKysrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tCiAyIGZpbGVzIGNoYW5nZWQsIDEyMiBpbnNlcnRpb25zKCspLCA2MSBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCAyMGI2YTcwMjMwOTcuLjA4NGNkZDExNWQ1YSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xMTI5LDcgKzExMjksOCBAQCBzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSB7CiAJY29uc3Qgc3RydWN0IGk5MTVfcGVyZl9zdHJlYW1fb3BzICpvcHM7
CiAKIAkvKioKLQkgKiBAYWN0aXZlX2NvbmZpZ19tdXRleDogUHJvdGVjdHMgYWNjZXNzIHRvIEBv
YV9jb25maWcgJiBAb2FfY29uZmlnX2Jvcy4KKwkgKiBAYWN0aXZlX2NvbmZpZ19tdXRleDogUHJv
dGVjdHMgYWNjZXNzIHRvIEBhY3RpdmVfY29uZmlnX3JxLAorCSAqIEBvYV9jb25maWcgJiBAb2Ff
Y29uZmlnX2Jvcy4KIAkgKi8KIAlzdHJ1Y3QgbXV0ZXggY29uZmlnX211dGV4OwogCkBAIC0xMTQ0
LDYgKzExNDUsMTYgQEAgc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gewogCSAqLwogCXN0cnVjdCBs
aXN0X2hlYWQgb2FfY29uZmlnX2JvczsKIAorCS8qKgorCSAqIEBhY3RpdmVfY29uZmlnX3JxOiBM
YXN0IHJlcXVlc3QgcmVjb25maWd1cmluZyB0aGUgSFcuCisJICovCisJc3RydWN0IGk5MTVfYWN0
aXZlX3JlcXVlc3QgYWN0aXZlX2NvbmZpZ19ycTsKKworCS8qKgorCSAqIEBpbml0aWFsX29hX2Nv
bmZpZ19ibzogRmlyc3QgT0EgY29uZmlndXJhdGlvbiBCTyB0byBiZSBydW4uCisJICovCisJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmluaXRpYWxfb2FfY29uZmlnX2JvOworCiAJLyoqCiAJ
ICogVGhlIE9BIGNvbnRleHQgc3BlY2lmaWMgaW5mb3JtYXRpb24uCiAJICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcGVyZi5jCmluZGV4IGYyYjc3OGQ4NGI1Mi4uOGUzNTMyNTE4MTM5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3BlcmYuYwpAQCAtMTU1OCwxOCArMTU1OCwyMyBAQCBmcmVlX29hX2NvbmZpZ3Mo
c3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3Ry
ZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OworCWludCBlcnI7
CiAKIAlCVUdfT04oc3RyZWFtICE9IGRldl9wcml2LT5wZXJmLmV4Y2x1c2l2ZV9zdHJlYW0pOwog
Ci0JLyoKLQkgKiBVbnNldCBleGNsdXNpdmVfc3RyZWFtIGZpcnN0LCBpdCB3aWxsIGJlIGNoZWNr
ZWQgd2hpbGUgZGlzYWJsaW5nCi0JICogdGhlIG1ldHJpYyBzZXQgb24gZ2VuOCsuCi0JICovCiAJ
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWRldl9wcml2LT5wZXJm
LmV4Y2x1c2l2ZV9zdHJlYW0gPSBOVUxMOworCW11dGV4X2xvY2soJnN0cmVhbS0+Y29uZmlnX211
dGV4KTsKIAlkZXZfcHJpdi0+cGVyZi5vcHMuZGlzYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CisJ
ZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoJnN0cmVhbS0+YWN0aXZlX2NvbmZpZ19y
cSwgMCwKKwkJCQkJICZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZzdHJl
YW0tPmNvbmZpZ19tdXRleCk7CisJZGV2X3ByaXYtPnBlcmYuZXhjbHVzaXZlX3N0cmVhbSA9IE5V
TEw7CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKKwlpZiAo
ZXJyKQorCQlEUk1fRVJST1IoIkZhaWxlZCB0byBkaXNhYmxlIHBlcmYgc3RyZWFtXG4iKTsKKwor
CiAJZnJlZV9vYV9idWZmZXIoc3RyZWFtKTsKIAlmcmVlX25vYV93YWl0KHN0cmVhbSk7CiAKQEAg
LTE3OTUsNiArMTgwMCwxMCBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJCXJldHVybiBQVFJfRVJSKGJvKTsKIAl9CiAKKwlyZXQg
PSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtKTsKKwlpZiAocmV0KQor
CQlnb3RvIGVycl91bnJlZjsKKwogCS8qCiAJICogV2UgcGluIGluIEdHVFQgYmVjYXVzZSB3ZSBq
dW1wIGludG8gdGhpcyBidWZmZXIgbm93IGJlY2F1c2UKIAkgKiBtdWx0aXBsZSBPQSBjb25maWcg
Qk9zIHdpbGwgaGF2ZSBhIGp1bXAgdG8gdGhpcyBhZGRyZXNzIGFuZCBpdApAQCAtMTgwMiwxMCAr
MTgxMSwxMyBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiAJICovCiAJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKGJvLCBO
VUxMLCAwLCA0MDk2LCAwKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJcmV0ID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVy
cl91bnJlZjsKIAl9CiAKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CiAJYmF0Y2ggPSBjcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJvLCBJOTE1X01BUF9XQik7
CiAJaWYgKElTX0VSUihiYXRjaCkpIHsKIAkJcmV0ID0gUFRSX0VSUihiYXRjaCk7CkBAIC0xOTM5
LDcgKzE5NTEsOSBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZf
c3RyZWFtICpzdHJlYW0pCiAJcmV0dXJuIDA7CiAKIGVycl91bnBpbjoKLQlfX2k5MTVfdm1hX3Vu
cGluKHZtYSk7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaTkxNV92
bWFfdW5waW5fYW5kX3JlbGVhc2UoJnZtYSwgMCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAogZXJyX3VucmVmOgogCWk5MTVfZ2VtX29iamVjdF9wdXQoYm8pOwpA
QCAtMTk0Nyw1MCArMTk2MSw3MyBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQg
Y29uZmlnX29hX3JlZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJICAg
Y29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdzLAotCQkJICAgdTMyIG5fcmVncykKK3N0YXRp
YyBpbnQgZW1pdF9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkg
IHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7Ci0JdTMyIGk7CisJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdTMyICpjczsKKwlpbnQg
ZXJyOwogCi0JZm9yIChpID0gMDsgaSA8IG5fcmVnczsgaSsrKSB7Ci0JCWNvbnN0IHN0cnVjdCBp
OTE1X29hX3JlZyAqcmVnID0gcmVncyArIGk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmc3RyZWFt
LT5jb25maWdfbXV0ZXgpOworCisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uoc3RyZWFtLT5pbml0
aWFsX29hX2NvbmZpZ19ibywKKwkJCQkmc3RyZWFtLT5lbmdpbmUtPmd0LT5nZ3R0LT52bSwgTlVM
TCk7CisJaWYgKHVubGlrZWx5KElTX0VSUih2bWEpKSkKKwkJcmV0dXJuIFBUUl9FUlIodm1hKTsK
IAotCQlJOTE1X1dSSVRFKHJlZy0+YWRkciwgcmVnLT52YWx1ZSk7CisJZXJyID0gaTkxNV92bWFf
cGluKHZtYSwgMCwgMCwgUElOX0dMT0JBTCk7CisJaWYgKGVycikKKwkJZ290byBlcnJfdm1hX3Vu
cGluOworCisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cmVhbS0+ZW5naW5lLT5rZXJuZWxf
Y29udGV4dCk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdv
dG8gZXJyX2FkZF9yZXF1ZXN0OwogCX0KLX0KIAotc3RhdGljIHZvaWQgZGVsYXlfYWZ0ZXJfbXV4
KHZvaWQpCi17Ci0JLyoKLQkgKiBJdCBhcHBhcmVudGx5IHRha2VzIGEgZmFpcmx5IGxvbmcgdGlt
ZSBmb3IgYSBuZXcgTVVYCi0JICogY29uZmlndXJhdGlvbiB0byBiZSBiZSBhcHBsaWVkIGFmdGVy
IHRoZXNlIHJlZ2lzdGVyIHdyaXRlcy4KLQkgKiBUaGlzIGRlbGF5IGR1cmF0aW9uIHdhcyBkZXJp
dmVkIGVtcGlyaWNhbGx5IGJhc2VkIG9uIHRoZQotCSAqIHJlbmRlcl9iYXNpYyBjb25maWcgYnV0
IGhvcGVmdWxseSBpdCBjb3ZlcnMgdGhlIG1heGltdW0KLQkgKiBjb25maWd1cmF0aW9uIGxhdGVu
Y3kuCi0JICoKLQkgKiBBcyBhIGZhbGxiYWNrLCB0aGUgY2hlY2tzIGluIF9hcHBlbmRfb2FfcmVw
b3J0cygpIHRvIHNraXAKLQkgKiBpbnZhbGlkIE9BIHJlcG9ydHMgZG8gYWxzbyBzZWVtIHRvIHdv
cmsgdG8gZGlzY2FyZCByZXBvcnRzCi0JICogZ2VuZXJhdGVkIGJlZm9yZSB0aGlzIGNvbmZpZyBo
YXMgY29tcGxldGVkIC0gYWxiZWl0IG5vdAotCSAqIHNpbGVudGx5LgotCSAqCi0JICogVW5mb3J0
dW5hdGVseSB0aGlzIGlzIGVzc2VudGlhbGx5IGEgbWFnaWMgbnVtYmVyLCBzaW5jZSB3ZQotCSAq
IGRvbid0IGN1cnJlbnRseSBrbm93IG9mIGEgcmVsaWFibGUgbWVjaGFuaXNtIGZvciBwcmVkaWN0
aW5nCi0JICogaG93IGxvbmcgdGhlIE1VWCBjb25maWcgd2lsbCB0YWtlIHRvIGFwcGx5IGFuZCBi
ZXNpZGVzCi0JICogc2VlaW5nIGludmFsaWQgcmVwb3J0cyB3ZSBkb24ndCBrbm93IG9mIGEgcmVs
aWFibGUgd2F5IHRvCi0JICogZXhwbGljaXRseSBjaGVjayB0aGF0IHRoZSBNVVggY29uZmlnIGhh
cyBsYW5kZWQuCi0JICoKLQkgKiBJdCdzIGV2ZW4gcG9zc2libGUgd2UndmUgbWlzcyBjaGFyYWN0
ZXJpemVkIHRoZSB1bmRlcmx5aW5nCi0JICogcHJvYmxlbSAtIGl0IGp1c3Qgc2VlbXMgbGlrZSB0
aGUgc2ltcGxlc3QgZXhwbGFuYXRpb24gd2h5Ci0JICogYSBkZWxheSBhdCB0aGlzIGxvY2F0aW9u
IHdvdWxkIG1pdGlnYXRlIGFueSBpbnZhbGlkIHJlcG9ydHMuCi0JICovCi0JdXNsZWVwX3Jhbmdl
KDE1MDAwLCAyMDAwMCk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJnN0cmVhbS0+
YWN0aXZlX2NvbmZpZ19ycSwKKwkJCQkgICAgICBycSk7CisJaWYgKGVycikKKwkJZ290byBlcnJf
YWRkX3JlcXVlc3Q7CisKKwlpOTE1X3ZtYV9sb2NrKHZtYSk7CisJZXJyID0gaTkxNV9yZXF1ZXN0
X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmosIDApOworCWlmICghZXJyKQorCQllcnIgPSBpOTE1
X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCAwKTsKKwlpOTE1X3ZtYV91bmxvY2sodm1hKTsK
KwlpZiAoZXJyKQorCQlnb3RvIGVycl9hZGRfcmVxdWVzdDsKKworCWNzID0gaW50ZWxfcmluZ19i
ZWdpbihycSwgSU5URUxfR0VOKGk5MTUpID49IDggPyA0IDogMik7CisJaWYgKElTX0VSUihjcykp
IHsKKwkJZXJyID0gUFRSX0VSUihjcyk7CisJCWdvdG8gZXJyX2FkZF9yZXF1ZXN0OworCX0KKwor
CWlmIChJTlRFTF9HRU4oaTkxNSkgPiA4KSB7CisJCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NU
QVJUX0dFTjg7CisJCSpjcysrID0gbG93ZXJfMzJfYml0cyh2bWEtPm5vZGUuc3RhcnQpOworCQkq
Y3MrKyA9IHVwcGVyXzMyX2JpdHModm1hLT5ub2RlLnN0YXJ0KTsKKwkJKmNzKysgPSBNSV9OT09Q
OworCX0gZWxzZSB7CisJCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NUQVJUOworCQkqY3MrKyA9
IHZtYS0+bm9kZS5zdGFydDsKKwl9CisKKwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKwor
ZXJyX2FkZF9yZXF1ZXN0OgorCWk5MTVfcmVxdWVzdF9hZGQocnEpOworZXJyX3ZtYV91bnBpbjoK
KwlpOTE1X3ZtYV91bnBpbih2bWEpOworCisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGljIGludCBo
c3dfZW5hYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2Owot
CWNvbnN0IHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnID0gc3RyZWFtLT5vYV9jb25m
aWc7CiAKIAkvKgogCSAqIFBSTToKQEAgLTIwMDcsMTMgKzIwNDQsNyBAQCBzdGF0aWMgaW50IGhz
d19lbmFibGVfbWV0cmljX3NldChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCUk5
MTVfV1JJVEUoR0VONl9VQ0dDVEwxLCAoSTkxNV9SRUFEKEdFTjZfVUNHQ1RMMSkgfAogCQkJCSAg
R0VONl9DU1VOSVRfQ0xPQ0tfR0FURV9ESVNBQkxFKSk7CiAKLQljb25maWdfb2FfcmVncyhkZXZf
cHJpdiwgb2FfY29uZmlnLT5tdXhfcmVncywgb2FfY29uZmlnLT5tdXhfcmVnc19sZW4pOwotCWRl
bGF5X2FmdGVyX211eCgpOwotCi0JY29uZmlnX29hX3JlZ3MoZGV2X3ByaXYsIG9hX2NvbmZpZy0+
Yl9jb3VudGVyX3JlZ3MsCi0JCSAgICAgICBvYV9jb25maWctPmJfY291bnRlcl9yZWdzX2xlbik7
Ci0KLQlyZXR1cm4gMDsKKwlyZXR1cm4gZW1pdF9vYV9jb25maWcoZGV2X3ByaXYsIHN0cmVhbSk7
CiB9CiAKIHN0YXRpYyB2b2lkIGhzd19kaXNhYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVy
Zl9zdHJlYW0gKnN0cmVhbSkKQEAgLTIzNzIsMTMgKzI0MDMsNyBAQCBzdGF0aWMgaW50IGdlbjhf
ZW5hYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlpZiAo
cmV0KQogCQlyZXR1cm4gcmV0OwogCi0JY29uZmlnX29hX3JlZ3MoZGV2X3ByaXYsIG9hX2NvbmZp
Zy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKLQlkZWxheV9hZnRlcl9tdXgo
KTsKLQotCWNvbmZpZ19vYV9yZWdzKGRldl9wcml2LCBvYV9jb25maWctPmJfY291bnRlcl9yZWdz
LAotCQkgICAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOwotCi0JcmV0dXJuIDA7
CisJcmV0dXJuIGVtaXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0pOwogfQogCiBzdGF0aWMg
dm9pZCBnZW44X2Rpc2FibGVfbWV0cmljX3NldChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtKQpAQCAtMjU5Nyw2ICsyNjIyLDkgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAKIAlzdHJlYW0tPmVuZ2luZSA9IHBy
b3BzLT5lbmdpbmU7CiAKKwlJTklUX0FDVElWRV9SRVFVRVNUKCZzdHJlYW0tPmFjdGl2ZV9jb25m
aWdfcnEsCisJCQkgICAgJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKKwogCXN0cmVhbS0+c2FtcGxl
X2ZsYWdzIHw9IFNBTVBMRV9PQV9SRVBPUlQ7CiAJc3RyZWFtLT5zYW1wbGVfc2l6ZSArPSBmb3Jt
YXRfc2l6ZTsKIApAQCAtMjYyNSw4ICsyNjUzLDkgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVh
bV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCWdvdG8gZXJyX25vYV93
YWl0X2FsbG9jOwogCX0KIAotCXJldCA9IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKGRldl9wcml2
LCBwcm9wcy0+bWV0cmljc19zZXQsCi0JCQkJICAgICAgJnN0cmVhbS0+b2FfY29uZmlnKTsKKwly
ZXQgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZ19hbmRfYm8oc3RyZWFtLCBwcm9wcy0+bWV0cmlj
c19zZXQsCisJCQkJCSAgICAgJnN0cmVhbS0+b2FfY29uZmlnLAorCQkJCQkgICAgICZzdHJlYW0t
PmluaXRpYWxfb2FfY29uZmlnX2JvKTsKIAlpZiAocmV0KSB7CiAJCURSTV9ERUJVRygiSW52YWxp
ZCBPQSBjb25maWcgaWQ9JWlcbiIsIHByb3BzLT5tZXRyaWNzX3NldCk7CiAJCWdvdG8gZXJyX2Nv
bmZpZzsKQEAgLTI2NTgsMTYgKzI2ODcsMzEgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9p
bml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJc3RyZWFtLT5vcHMgPSAmaTkx
NV9vYV9zdHJlYW1fb3BzOwogCWRldl9wcml2LT5wZXJmLmV4Y2x1c2l2ZV9zdHJlYW0gPSBzdHJl
YW07CiAKKwltdXRleF9sb2NrKCZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CiAJcmV0ID0gZGV2X3By
aXYtPnBlcmYub3BzLmVuYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CiAJaWYgKHJldCkgewogCQlE
Uk1fREVCVUcoIlVuYWJsZSB0byBlbmFibGUgbWV0cmljIHNldFxuIik7Ci0JCWdvdG8gZXJyX2Vu
YWJsZTsKKwkJLyoKKwkJICogSWdub3JlIHRoZSByZXR1cm4gdmFsdWUgc2luY2Ugd2UgYWxyZWFk
eSBoYXZlIGFuIGVycm9yIGZyb20KKwkJICogdGhlIGVuYWJsZSB2ZnVuYy4KKwkJICovCisJCWk5
MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZzdHJlYW0tPmFjdGl2ZV9jb25maWdfcnEsIDAsCisJ
CQkJCSAgICZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CisJfSBlbHNlIHsKKwkJcmV0ID0gaTkxNV9h
Y3RpdmVfcmVxdWVzdF9yZXRpcmUoJnN0cmVhbS0+YWN0aXZlX2NvbmZpZ19ycSwgMCwKKwkJCQkJ
CSAmc3RyZWFtLT5jb25maWdfbXV0ZXgpOwogCX0KIAotCURSTV9ERUJVRygib3BlbmluZyBzdHJl
YW0gb2EgY29uZmlnIHV1aWQ9JXNcbiIsIHN0cmVhbS0+b2FfY29uZmlnLT51dWlkKTsKLQorCW11
dGV4X3VubG9jaygmc3RyZWFtLT5jb25maWdfbXV0ZXgpOwogCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCisJaTkxNV9nZW1fb2JqZWN0X3B1dChzdHJlYW0tPmlu
aXRpYWxfb2FfY29uZmlnX2JvKTsKKwlzdHJlYW0tPmluaXRpYWxfb2FfY29uZmlnX2JvID0gTlVM
TDsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9lbmFibGU7CisKKwlEUk1fREVCVUcoIm9wZW5pbmcg
c3RyZWFtIG9hIGNvbmZpZyB1dWlkPSVzXG4iLCBzdHJlYW0tPm9hX2NvbmZpZy0+dXVpZCk7CisK
IAlocnRpbWVyX2luaXQoJnN0cmVhbS0+cG9sbF9jaGVja190aW1lciwKIAkJICAgICBDTE9DS19N
T05PVE9OSUMsIEhSVElNRVJfTU9ERV9SRUwpOwogCXN0cmVhbS0+cG9sbF9jaGVja190aW1lci5m
dW5jdGlvbiA9IG9hX3BvbGxfY2hlY2tfdGltZXJfY2I7CkBAIC0yNjc3LDggKzI3MjEsMTEgQEAg
c3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0sCiAJcmV0dXJuIDA7CiAKIGVycl9lbmFibGU6Ci0JZGV2X3ByaXYtPnBlcmYuZXhjbHVz
aXZlX3N0cmVhbSA9IE5VTEw7CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCW11dGV4X2xvY2soJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKIAlkZXZfcHJpdi0+cGVy
Zi5vcHMuZGlzYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CisJbXV0ZXhfdW5sb2NrKCZzdHJlYW0t
PmNvbmZpZ19tdXRleCk7CisJZGV2X3ByaXYtPnBlcmYuZXhjbHVzaXZlX3N0cmVhbSA9IE5VTEw7
CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIGVycl9sb2Nr
OgpAQCAtMjY5MCw2ICsyNzM3LDkgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0
cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAKIAlmcmVlX29hX2NvbmZpZ3Moc3RyZWFt
KTsKIAorCWlmIChzdHJlYW0tPmluaXRpYWxfb2FfY29uZmlnX2JvKQorCQlpOTE1X2dlbV9vYmpl
Y3RfcHV0KHN0cmVhbS0+aW5pdGlhbF9vYV9jb25maWdfYm8pOworCiBlcnJfY29uZmlnOgogCWZy
ZWVfbm9hX3dhaXQoc3RyZWFtKTsKIAotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 91D201B16A5
	for <lists+intel-gfx@lfdr.de>; Mon, 20 Apr 2020 22:06:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8B2B16E84B;
	Mon, 20 Apr 2020 20:06:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 89E846E843
 for <intel-gfx@lists.freedesktop.org>; Mon, 20 Apr 2020 20:06:16 +0000 (UTC)
IronPort-SDR: wLBPRJzjXoUWlc/HzZ3qhd4JO3Kuk9iIppG0Z2iorFe9Ub83+jON1Zre6IDmr5bXMpbU1o8eqe
 VztJ1ZlzWo+w==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga104.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 20 Apr 2020 13:06:15 -0700
IronPort-SDR: 2kya9VtDc6O1EVGhjTX+V8IuCId4YeIuHQAilm1Ft6tFWUgGDbnUU1Kk7KFnzDunM/o50P5ksc
 qB8nWVU46hNA==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.72,407,1580803200"; d="scan'208";a="290210705"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga002.fm.intel.com with SMTP; 20 Apr 2020 13:06:13 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Mon, 20 Apr 2020 23:06:13 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 20 Apr 2020 23:06:08 +0300
Message-Id: <20200420200610.31798-2-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200420200610.31798-1-ville.syrjala@linux.intel.com>
References: <20200420200610.31798-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/4] drm/i915: Introduce .set_signal_levels()
 vfunc
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClNv
cnQgb3V0IHNvbWUgb2YgdGhlIG1lc3MgYmV0d2VlbiBpbnRlbF9kZGkuYyBpbnRlbF9kcC5jIGJ5
CmludHJvZHVjaW5nIGEgLnNldF9zaWduYWxfbGV2ZWxzKCkgdmZ1bmMuCgpTaWduZWQtb2ZmLWJ5
OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgICAgICB8ICA4MSArKysrKysr
LS0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDEg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgIHwgMTQ2ICsr
KysrKysrKysrLS0tLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCAxNTAgaW5zZXJ0aW9ucygrKSwgNzgg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKaW5k
ZXggN2MyMjM1MjBhZDZiLi5lYjQyMDA2OWE0NjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kZGkuYwpAQCAtMjY1OSwzOCArMjY1OSw2NiBAQCBzdGF0aWMgdTMyIGludGVs
X2RkaV9kcF9sZXZlbChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCXJldHVybiB0cmFuc2xh
dGVfc2lnbmFsX2xldmVsKHNpZ25hbF9sZXZlbHMpOwogfQogCi11MzIgYnh0X3NpZ25hbF9sZXZl
bHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK3N0YXRpYyB2b2lkCit0Z2xfc2V0X3NpZ25h
bF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgaW50ZWxfZGln
aXRhbF9wb3J0ICpkcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRwb3J0LT5iYXNlLmJhc2UuZGV2KTsK
LQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkcG9ydC0+YmFzZTsKKwlzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkcF90b19kaWdfcG9ydChpbnRlbF9kcCktPmJhc2U7
CiAJaW50IGxldmVsID0gaW50ZWxfZGRpX2RwX2xldmVsKGludGVsX2RwKTsKIAotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDEyKQotCQl0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVy
LCBpbnRlbF9kcC0+bGlua19yYXRlLAotCQkJCQlsZXZlbCwgZW5jb2Rlci0+dHlwZSk7Ci0JZWxz
ZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKLQkJaWNsX2RkaV92c3dpbmdfc2VxdWVu
Y2UoZW5jb2RlciwgaW50ZWxfZHAtPmxpbmtfcmF0ZSwKLQkJCQkJbGV2ZWwsIGVuY29kZXItPnR5
cGUpOwotCWVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKQotCQljbmxfZGRpX3Zzd2lu
Z19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgZW5jb2Rlci0+dHlwZSk7Ci0JZWxzZQotCQlieHRf
ZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgZW5jb2Rlci0+dHlwZSk7Ci0KLQly
ZXR1cm4gMDsKKwl0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBpbnRlbF9kcC0+bGlu
a19yYXRlLAorCQkJCWxldmVsLCBlbmNvZGVyLT50eXBlKTsKIH0KIAotdTMyIGRkaV9zaWduYWxf
bGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCitzdGF0aWMgdm9pZAoraWNsX3NldF9z
aWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqZHBvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkcG9ydC0+YmFzZS5iYXNlLmRl
dik7Ci0Jc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBvcnQtPmJhc2U7CisJc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5i
YXNlOwogCWludCBsZXZlbCA9IGludGVsX2RkaV9kcF9sZXZlbChpbnRlbF9kcCk7CiAKKwlpY2xf
ZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBpbnRlbF9kcC0+bGlua19yYXRlLAorCQkJCWxl
dmVsLCBlbmNvZGVyLT50eXBlKTsKK30KKworc3RhdGljIHZvaWQKK2NubF9zZXRfc2lnbmFsX2xl
dmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQoreworCXN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyID0gJmRwX3RvX2RpZ19wb3J0KGludGVsX2RwKS0+YmFzZTsKKwlpbnQgbGV2ZWwg
PSBpbnRlbF9kZGlfZHBfbGV2ZWwoaW50ZWxfZHApOworCisJY25sX2RkaV92c3dpbmdfc2VxdWVu
Y2UoZW5jb2RlciwgbGV2ZWwsIGVuY29kZXItPnR5cGUpOworfQorCitzdGF0aWMgdm9pZAorYnh0
X3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCit7CisJc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNl
OworCWludCBsZXZlbCA9IGludGVsX2RkaV9kcF9sZXZlbChpbnRlbF9kcCk7CisKKwlieHRfZGRp
X3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgZW5jb2Rlci0+dHlwZSk7Cit9CisKK3N0
YXRpYyB2b2lkCitoc3dfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkcF90b19kaWdfcG9ydChp
bnRlbF9kcCktPmJhc2U7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJaW50IGxldmVsID0gaW50ZWxfZGRpX2RwX2xldmVs
KGludGVsX2RwKTsKKwllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CisJdTMyIHNpZ25h
bF9sZXZlbHM7CisKKwlzaWduYWxfbGV2ZWxzID0gRERJX0JVRl9UUkFOU19TRUxFQ1QobGV2ZWwp
OworCisJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJVc2luZyBzaWduYWwgbGV2ZWxzICUw
OHhcbiIsCisJCSAgICBzaWduYWxfbGV2ZWxzKTsKKworCWludGVsX2RwLT5EUCAmPSB+RERJX0JV
Rl9FTVBfTUFTSzsKKwlpbnRlbF9kcC0+RFAgfD0gc2lnbmFsX2xldmVsczsKKwogCWlmIChJU19H
RU45X0JDKGRldl9wcml2KSkKIAkJc2tsX2RkaV9zZXRfaWJvb3N0KGVuY29kZXIsIGxldmVsLCBl
bmNvZGVyLT50eXBlKTsKIAotCXJldHVybiBERElfQlVGX1RSQU5TX1NFTEVDVChsZXZlbCk7CisJ
aW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERESV9CVUZfQ1RMKHBvcnQpLCBpbnRlbF9kcC0+RFAp
OworCWludGVsX2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgRERJX0JVRl9DVEwocG9ydCkpOwog
fQogCiBzdGF0aWMgaW5saW5lCkBAIC00NDM1LDYgKzQ0NjMsMTcgQEAgaW50ZWxfZGRpX2luaXRf
ZHBfY29ubmVjdG9yKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0KQog
CQlpbnRlbF9kZGlfcHJlcGFyZV9saW5rX3JldHJhaW47CiAJaW50ZWxfZGlnX3BvcnQtPmRwLnNl
dF9saW5rX3RyYWluID0gaW50ZWxfZGRpX3NldF9saW5rX3RyYWluOwogCisJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTIpCisJCWludGVsX2RpZ19wb3J0LT5kcC5zZXRfc2lnbmFsX2xldmVs
cyA9IHRnbF9zZXRfc2lnbmFsX2xldmVsczsKKwllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDExKQorCQlpbnRlbF9kaWdfcG9ydC0+ZHAuc2V0X3NpZ25hbF9sZXZlbHMgPSBpY2xfc2V0
X3NpZ25hbF9sZXZlbHM7CisJZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpCisJCWlu
dGVsX2RpZ19wb3J0LT5kcC5zZXRfc2lnbmFsX2xldmVscyA9IGNubF9zZXRfc2lnbmFsX2xldmVs
czsKKwllbHNlIGlmIChJU19HRU45X0xQKGRldl9wcml2KSkKKwkJaW50ZWxfZGlnX3BvcnQtPmRw
LnNldF9zaWduYWxfbGV2ZWxzID0gYnh0X3NldF9zaWduYWxfbGV2ZWxzOworCWVsc2UKKwkJaW50
ZWxfZGlnX3BvcnQtPmRwLnNldF9zaWduYWxfbGV2ZWxzID0gaHN3X3NldF9zaWduYWxfbGV2ZWxz
OworCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMikgewogCQlpbnRlbF9kaWdfcG9ydC0+
ZHAucmVncy5kcF90cF9jdGwgPSBEUF9UUF9DVEwocG9ydCk7CiAJCWludGVsX2RpZ19wb3J0LT5k
cC5yZWdzLmRwX3RwX3N0YXR1cyA9IERQX1RQX1NUQVRVUyhwb3J0KTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggNjE2ODUw
Y2M2NmJiLi45NjBiYTE0ZjAxYzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC0xMzY5LDYgKzEzNjksNyBAQCBzdHJ1Y3Qg
aW50ZWxfZHAgewogCS8qIFRoaXMgaXMgY2FsbGVkIGJlZm9yZSBhIGxpbmsgdHJhaW5pbmcgaXMg
c3RhcnRlcmQgKi8KIAl2b2lkICgqcHJlcGFyZV9saW5rX3JldHJhaW4pKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApOwogCXZvaWQgKCpzZXRfbGlua190cmFpbikoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwgdTggZHBfdHJhaW5fcGF0KTsKKwl2b2lkICgqc2V0X3NpZ25hbF9sZXZlbHMpKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogCiAJLyogRGlzcGxheXBvcnQgY29tcGxpYW5jZSB0
ZXN0aW5nICovCiAJc3RydWN0IGludGVsX2RwX2NvbXBsaWFuY2UgY29tcGxpYW5jZTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwppbmRleCBmMTIwZTI4ODFmNzcuLjdkNWUx
ZTg1N2JhNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtNDAz
Myw3ICs0MDMzLDcgQEAgaW50ZWxfZHBfcHJlX2VtcGhhc2lzX21heChzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLCB1OCB2b2x0YWdlX3N3aW5nKQogCX0KIH0KIAotc3RhdGljIHUzMiB2bHZfc2ln
bmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQorc3RhdGljIHZvaWQgdmx2X3Nl
dF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlOwog
CXVuc2lnbmVkIGxvbmcgZGVtcGhfcmVnX3ZhbHVlLCBwcmVlbXBoX3JlZ192YWx1ZSwKQEAgLTQw
NjEsNyArNDA2MSw3IEBAIHN0YXRpYyB1MzIgdmx2X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKIAkJCXVuaXF0cmFuc2NhbGVfcmVnX3ZhbHVlID0gMHg1NTk4REEzQTsK
IAkJCWJyZWFrOwogCQlkZWZhdWx0OgotCQkJcmV0dXJuIDA7CisJCQlyZXR1cm47CiAJCX0KIAkJ
YnJlYWs7CiAJY2FzZSBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8xOgpAQCAtNDA4MCw3ICs0MDgw
LDcgQEAgc3RhdGljIHUzMiB2bHZfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQogCQkJdW5pcXRyYW5zY2FsZV9yZWdfdmFsdWUgPSAweDU1QUREQTNBOwogCQkJYnJlYWs7
CiAJCWRlZmF1bHQ6Ci0JCQlyZXR1cm4gMDsKKwkJCXJldHVybjsKIAkJfQogCQlicmVhazsKIAlj
YXNlIERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzI6CkBAIC00MDk1LDcgKzQwOTUsNyBAQCBzdGF0
aWMgdTMyIHZsdl9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCQl1
bmlxdHJhbnNjYWxlX3JlZ192YWx1ZSA9IDB4NTVBRERBM0E7CiAJCQlicmVhazsKIAkJZGVmYXVs
dDoKLQkJCXJldHVybiAwOworCQkJcmV0dXJuOwogCQl9CiAJCWJyZWFrOwogCWNhc2UgRFBfVFJB
SU5fUFJFX0VNUEhfTEVWRUxfMzoKQEAgLTQxMDYsMjAgKzQxMDYsMTggQEAgc3RhdGljIHUzMiB2
bHZfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkJdW5pcXRyYW5z
Y2FsZV9yZWdfdmFsdWUgPSAweDU1QUREQTNBOwogCQkJYnJlYWs7CiAJCWRlZmF1bHQ6Ci0JCQly
ZXR1cm4gMDsKKwkJCXJldHVybjsKIAkJfQogCQlicmVhazsKIAlkZWZhdWx0OgotCQlyZXR1cm4g
MDsKKwkJcmV0dXJuOwogCX0KIAogCXZsdl9zZXRfcGh5X3NpZ25hbF9sZXZlbChlbmNvZGVyLCBk
ZW1waF9yZWdfdmFsdWUsIHByZWVtcGhfcmVnX3ZhbHVlLAogCQkJCSB1bmlxdHJhbnNjYWxlX3Jl
Z192YWx1ZSwgMCk7Ci0KLQlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHUzMiBjaHZfc2lnbmFsX2xl
dmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQorc3RhdGljIHZvaWQgY2h2X3NldF9zaWdu
YWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIgPSAmZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlOwogCXUzMiBk
ZWVtcGhfcmVnX3ZhbHVlLCBtYXJnaW5fcmVnX3ZhbHVlOwpAQCAtNDE0Nyw3ICs0MTQ1LDcgQEAg
c3RhdGljIHUzMiBjaHZfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQog
CQkJdW5pcV90cmFuc19zY2FsZSA9IHRydWU7CiAJCQlicmVhazsKIAkJZGVmYXVsdDoKLQkJCXJl
dHVybiAwOworCQkJcmV0dXJuOwogCQl9CiAJCWJyZWFrOwogCWNhc2UgRFBfVFJBSU5fUFJFX0VN
UEhfTEVWRUxfMToKQEAgLTQxNjUsNyArNDE2Myw3IEBAIHN0YXRpYyB1MzIgY2h2X3NpZ25hbF9s
ZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJCW1hcmdpbl9yZWdfdmFsdWUgPSAx
NTQ7CiAJCQlicmVhazsKIAkJZGVmYXVsdDoKLQkJCXJldHVybiAwOworCQkJcmV0dXJuOwogCQl9
CiAJCWJyZWFrOwogCWNhc2UgRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxfMjoKQEAgLTQxNzksNyAr
NDE3Nyw3IEBAIHN0YXRpYyB1MzIgY2h2X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIAkJCW1hcmdpbl9yZWdfdmFsdWUgPSAxNTQ7CiAJCQlicmVhazsKIAkJZGVmYXVs
dDoKLQkJCXJldHVybiAwOworCQkJcmV0dXJuOwogCQl9CiAJCWJyZWFrOwogCWNhc2UgRFBfVFJB
SU5fUFJFX0VNUEhfTEVWRUxfMzoKQEAgLTQxODksMjEgKzQxODcsMTggQEAgc3RhdGljIHUzMiBj
aHZfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkJbWFyZ2luX3Jl
Z192YWx1ZSA9IDE1NDsKIAkJCWJyZWFrOwogCQlkZWZhdWx0OgotCQkJcmV0dXJuIDA7CisJCQly
ZXR1cm47CiAJCX0KIAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJcmV0dXJuIDA7CisJCXJldHVybjsK
IAl9CiAKIAljaHZfc2V0X3BoeV9zaWduYWxfbGV2ZWwoZW5jb2RlciwgZGVlbXBoX3JlZ192YWx1
ZSwKIAkJCQkgbWFyZ2luX3JlZ192YWx1ZSwgdW5pcV90cmFuc19zY2FsZSk7Ci0KLQlyZXR1cm4g
MDsKIH0KIAotc3RhdGljIHUzMgotZzR4X3NpZ25hbF9sZXZlbHModTggdHJhaW5fc2V0KQorc3Rh
dGljIHUzMiBnNHhfc2lnbmFsX2xldmVscyh1OCB0cmFpbl9zZXQpCiB7CiAJdTMyIHNpZ25hbF9s
ZXZlbHMgPSAwOwogCkBAIC00MjQwLDEyICs0MjM1LDMxIEBAIGc0eF9zaWduYWxfbGV2ZWxzKHU4
IHRyYWluX3NldCkKIAlyZXR1cm4gc2lnbmFsX2xldmVsczsKIH0KIAorc3RhdGljIHZvaWQKK2c0
eF9zZXRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXU4
IHRyYWluX3NldCA9IGludGVsX2RwLT50cmFpbl9zZXRbMF07CisJdTMyIHNpZ25hbF9sZXZlbHM7
CisKKwlzaWduYWxfbGV2ZWxzID0gZzR4X3NpZ25hbF9sZXZlbHModHJhaW5fc2V0KTsKKworCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiVXNpbmcgc2lnbmFsIGxldmVscyAlMDh4XG4iLAor
CQkgICAgc2lnbmFsX2xldmVscyk7CisKKwlpbnRlbF9kcC0+RFAgJj0gfihEUF9WT0xUQUdFX01B
U0sgfCBEUF9QUkVfRU1QSEFTSVNfTUFTSyk7CisJaW50ZWxfZHAtPkRQIHw9IHNpZ25hbF9sZXZl
bHM7CisKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgaW50ZWxfZHAtPm91dHB1dF9yZWcsIGlu
dGVsX2RwLT5EUCk7CisJaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBpbnRlbF9kcC0+
b3V0cHV0X3JlZyk7Cit9CisKIC8qIFNOQiBDUFUgZURQIHZvbHRhZ2Ugc3dpbmcgYW5kIHByZS1l
bXBoYXNpcyBjb250cm9sICovCi1zdGF0aWMgdTMyCi1zbmJfY3B1X2VkcF9zaWduYWxfbGV2ZWxz
KHU4IHRyYWluX3NldCkKK3N0YXRpYyB1MzIgc25iX2NwdV9lZHBfc2lnbmFsX2xldmVscyh1OCB0
cmFpbl9zZXQpCiB7Ci0JaW50IHNpZ25hbF9sZXZlbHMgPSB0cmFpbl9zZXQgJiAoRFBfVFJBSU5f
Vk9MVEFHRV9TV0lOR19NQVNLIHwKLQkJCQkJIERQX1RSQUlOX1BSRV9FTVBIQVNJU19NQVNLKTsK
Kwl1OCBzaWduYWxfbGV2ZWxzID0gdHJhaW5fc2V0ICYgKERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdf
TUFTSyB8CisJCQkJCURQX1RSQUlOX1BSRV9FTVBIQVNJU19NQVNLKTsKKwogCXN3aXRjaCAoc2ln
bmFsX2xldmVscykgewogCWNhc2UgRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8wIHwgRFBf
VFJBSU5fUFJFX0VNUEhfTEVWRUxfMDoKIAljYXNlIERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVW
RUxfMSB8IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzA6CkBAIC00MjY4LDEyICs0MjgyLDMxIEBA
IHNuYl9jcHVfZWRwX3NpZ25hbF9sZXZlbHModTggdHJhaW5fc2V0KQogCX0KIH0KIAorc3RhdGlj
IHZvaWQKK3NuYl9jcHVfZWRwX3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CisJdTggdHJhaW5fc2V0ID0gaW50ZWxfZHAtPnRyYWluX3NldFswXTsKKwl1
MzIgc2lnbmFsX2xldmVsczsKKworCXNpZ25hbF9sZXZlbHMgPSBzbmJfY3B1X2VkcF9zaWduYWxf
bGV2ZWxzKHRyYWluX3NldCk7CisKKwlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlVzaW5n
IHNpZ25hbCBsZXZlbHMgJTA4eFxuIiwKKwkJICAgIHNpZ25hbF9sZXZlbHMpOworCisJaW50ZWxf
ZHAtPkRQICY9IH5FRFBfTElOS19UUkFJTl9WT0xfRU1QX01BU0tfU05COworCWludGVsX2RwLT5E
UCB8PSBzaWduYWxfbGV2ZWxzOworCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIGludGVsX2Rw
LT5vdXRwdXRfcmVnLCBpbnRlbF9kcC0+RFApOworCWludGVsX2RlX3Bvc3RpbmdfcmVhZChkZXZf
cHJpdiwgaW50ZWxfZHAtPm91dHB1dF9yZWcpOworfQorCiAvKiBJVkIgQ1BVIGVEUCB2b2x0YWdl
IHN3aW5nIGFuZCBwcmUtZW1waGFzaXMgY29udHJvbCAqLwotc3RhdGljIHUzMgotaXZiX2NwdV9l
ZHBfc2lnbmFsX2xldmVscyh1OCB0cmFpbl9zZXQpCitzdGF0aWMgdTMyIGl2Yl9jcHVfZWRwX3Np
Z25hbF9sZXZlbHModTggdHJhaW5fc2V0KQogewotCWludCBzaWduYWxfbGV2ZWxzID0gdHJhaW5f
c2V0ICYgKERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTUFTSyB8Ci0JCQkJCSBEUF9UUkFJTl9QUkVf
RU1QSEFTSVNfTUFTSyk7CisJdTggc2lnbmFsX2xldmVscyA9IHRyYWluX3NldCAmIChEUF9UUkFJ
Tl9WT0xUQUdFX1NXSU5HX01BU0sgfAorCQkJCQlEUF9UUkFJTl9QUkVfRU1QSEFTSVNfTUFTSyk7
CisKIAlzd2l0Y2ggKHNpZ25hbF9sZXZlbHMpIHsKIAljYXNlIERQX1RSQUlOX1ZPTFRBR0VfU1dJ
TkdfTEVWRUxfMCB8IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzA6CiAJCXJldHVybiBFRFBfTElO
S19UUkFJTl80MDBNVl8wREJfSVZCOwpAQCAtNDI5OSwzOCArNDMzMiwyOSBAQCBpdmJfY3B1X2Vk
cF9zaWduYWxfbGV2ZWxzKHU4IHRyYWluX3NldCkKIAl9CiB9CiAKLXZvaWQKLWludGVsX2RwX3Nl
dF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCitzdGF0aWMgdm9pZAor
aXZiX2NwdV9lZHBfc2V0X3NpZ25hbF9sZXZlbHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVs
X2RwKTsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9IGRwX3Rv
X2RpZ19wb3J0KGludGVsX2RwKTsKLQllbnVtIHBvcnQgcG9ydCA9IGludGVsX2RpZ19wb3J0LT5i
YXNlLnBvcnQ7Ci0JdTMyIHNpZ25hbF9sZXZlbHMsIG1hc2sgPSAwOwogCXU4IHRyYWluX3NldCA9
IGludGVsX2RwLT50cmFpbl9zZXRbMF07CisJdTMyIHNpZ25hbF9sZXZlbHM7CiAKLQlpZiAoSVNf
R0VOOV9MUChkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkgewotCQlzaWdu
YWxfbGV2ZWxzID0gYnh0X3NpZ25hbF9sZXZlbHMoaW50ZWxfZHApOwotCX0gZWxzZSBpZiAoSEFT
X0RESShkZXZfcHJpdikpIHsKLQkJc2lnbmFsX2xldmVscyA9IGRkaV9zaWduYWxfbGV2ZWxzKGlu
dGVsX2RwKTsKLQkJbWFzayA9IERESV9CVUZfRU1QX01BU0s7Ci0JfSBlbHNlIGlmIChJU19DSEVS
UllWSUVXKGRldl9wcml2KSkgewotCQlzaWduYWxfbGV2ZWxzID0gY2h2X3NpZ25hbF9sZXZlbHMo
aW50ZWxfZHApOwotCX0gZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpIHsKLQkJc2ln
bmFsX2xldmVscyA9IHZsdl9zaWduYWxfbGV2ZWxzKGludGVsX2RwKTsKLQl9IGVsc2UgaWYgKElT
X0lWWUJSSURHRShkZXZfcHJpdikgJiYgcG9ydCA9PSBQT1JUX0EpIHsKLQkJc2lnbmFsX2xldmVs
cyA9IGl2Yl9jcHVfZWRwX3NpZ25hbF9sZXZlbHModHJhaW5fc2V0KTsKLQkJbWFzayA9IEVEUF9M
SU5LX1RSQUlOX1ZPTF9FTVBfTUFTS19JVkI7Ci0JfSBlbHNlIGlmIChJU19HRU4oZGV2X3ByaXYs
IDYpICYmIHBvcnQgPT0gUE9SVF9BKSB7Ci0JCXNpZ25hbF9sZXZlbHMgPSBzbmJfY3B1X2VkcF9z
aWduYWxfbGV2ZWxzKHRyYWluX3NldCk7Ci0JCW1hc2sgPSBFRFBfTElOS19UUkFJTl9WT0xfRU1Q
X01BU0tfU05COwotCX0gZWxzZSB7Ci0JCXNpZ25hbF9sZXZlbHMgPSBnNHhfc2lnbmFsX2xldmVs
cyh0cmFpbl9zZXQpOwotCQltYXNrID0gRFBfVk9MVEFHRV9NQVNLIHwgRFBfUFJFX0VNUEhBU0lT
X01BU0s7Ci0JfQorCXNpZ25hbF9sZXZlbHMgPSBpdmJfY3B1X2VkcF9zaWduYWxfbGV2ZWxzKHRy
YWluX3NldCk7CiAKLQlpZiAobWFzaykKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJV
c2luZyBzaWduYWwgbGV2ZWxzICUwOHhcbiIsCi0JCQkgICAgc2lnbmFsX2xldmVscyk7CisJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJVc2luZyBzaWduYWwgbGV2ZWxzICUwOHhcbiIsCisJ
CSAgICBzaWduYWxfbGV2ZWxzKTsKKworCWludGVsX2RwLT5EUCAmPSB+RURQX0xJTktfVFJBSU5f
Vk9MX0VNUF9NQVNLX0lWQjsKKwlpbnRlbF9kcC0+RFAgfD0gc2lnbmFsX2xldmVsczsKKworCWlu
dGVsX2RlX3dyaXRlKGRldl9wcml2LCBpbnRlbF9kcC0+b3V0cHV0X3JlZywgaW50ZWxfZHAtPkRQ
KTsKKwlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIGludGVsX2RwLT5vdXRwdXRfcmVn
KTsKK30KKwordm9pZCBpbnRlbF9kcF9zZXRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3Rv
X2k5MTUoaW50ZWxfZHApOworCXU4IHRyYWluX3NldCA9IGludGVsX2RwLT50cmFpbl9zZXRbMF07
CiAKIAlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlVzaW5nIHZzd2luZyBsZXZlbCAlZCVz
XG4iLAogCQkgICAgdHJhaW5fc2V0ICYgRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19NQVNLLApAQCAt
NDM0MSwxMCArNDM2NSw3IEBAIGludGVsX2RwX3NldF9zaWduYWxfbGV2ZWxzKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiAJCSAgICB0cmFpbl9zZXQgJiBEUF9UUkFJTl9NQVhfUFJFX0VNUEhB
U0lTX1JFQUNIRUQgPwogCQkgICAgIiAobWF4KSIgOiAiIik7CiAKLQlpbnRlbF9kcC0+RFAgPSAo
aW50ZWxfZHAtPkRQICYgfm1hc2spIHwgc2lnbmFsX2xldmVsczsKLQotCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCBpbnRlbF9kcC0+b3V0cHV0X3JlZywgaW50ZWxfZHAtPkRQKTsKLQlpbnRlbF9k
ZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIGludGVsX2RwLT5vdXRwdXRfcmVnKTsKKwlpbnRlbF9k
cC0+c2V0X3NpZ25hbF9sZXZlbHMoaW50ZWxfZHApOwogfQogCiB2b2lkCkBAIC04NTE1LDYgKzg1
MzYsMTcgQEAgYm9vbCBpbnRlbF9kcF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAllbHNlCiAJCWludGVsX2RpZ19wb3J0LT5kcC5zZXRfbGlua190cmFpbiA9IGc0eF9z
ZXRfbGlua190cmFpbjsKIAorCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKKwkJaW50ZWxf
ZGlnX3BvcnQtPmRwLnNldF9zaWduYWxfbGV2ZWxzID0gY2h2X3NldF9zaWduYWxfbGV2ZWxzOwor
CWVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQorCQlpbnRlbF9kaWdfcG9ydC0+ZHAu
c2V0X3NpZ25hbF9sZXZlbHMgPSB2bHZfc2V0X3NpZ25hbF9sZXZlbHM7CisJZWxzZSBpZiAoSVNf
SVZZQlJJREdFKGRldl9wcml2KSAmJiBwb3J0ID09IFBPUlRfQSkKKwkJaW50ZWxfZGlnX3BvcnQt
PmRwLnNldF9zaWduYWxfbGV2ZWxzID0gaXZiX2NwdV9lZHBfc2V0X3NpZ25hbF9sZXZlbHM7CisJ
ZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA2KSAmJiBwb3J0ID09IFBPUlRfQSkKKwkJaW50ZWxf
ZGlnX3BvcnQtPmRwLnNldF9zaWduYWxfbGV2ZWxzID0gc25iX2NwdV9lZHBfc2V0X3NpZ25hbF9s
ZXZlbHM7CisJZWxzZQorCQlpbnRlbF9kaWdfcG9ydC0+ZHAuc2V0X3NpZ25hbF9sZXZlbHMgPSBn
NHhfc2V0X3NpZ25hbF9sZXZlbHM7CisKIAlpbnRlbF9kaWdfcG9ydC0+ZHAub3V0cHV0X3JlZyA9
IG91dHB1dF9yZWc7CiAJaW50ZWxfZGlnX3BvcnQtPm1heF9sYW5lcyA9IDQ7CiAJaW50ZWxfZGln
X3BvcnQtPmRwLnJlZ3MuZHBfdHBfY3RsID0gRFBfVFBfQ1RMKHBvcnQpOwotLSAKMi4yNC4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZngg
bWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 39BEA3120A
	for <lists+intel-gfx@lfdr.de>; Fri, 31 May 2019 18:13:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8DA6B896C4;
	Fri, 31 May 2019 16:13:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B63EF896C4
 for <intel-gfx@lists.freedesktop.org>; Fri, 31 May 2019 16:13:24 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16751385-1500050 
 for multiple; Fri, 31 May 2019 17:11:34 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 31 May 2019 17:11:29 +0100
Message-Id: <20190531161130.28347-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190531161130.28347-1-chris@chris-wilson.co.uk>
References: <20190531161130.28347-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/3] drm/i915: Use unchecked writes for setting
 up the fences
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgdGhlIGZlbmNlIHJlZ2lzdGVycyBhcmUgbm90IHBhcnQgb2YgdGhlIGVuZ2luZSBwb3dlcndl
bGxzLCB3ZSBkbyBub3QKbmVlZCB0byBmaWRkbGUgd2l0aCBmb3JjZXdha2UgaW4gb3JkZXIgdG8g
dXBkYXRlIGEgZmVuY2UuIEF2b2lkIHVzaW5nCnRoZSBoZWF2eXdlaWdodCBkZWJ1ZyBjaGVja2lu
ZyBub3JtYWwgbW1pbyB3cml0ZXMgYXMgdGhlIGNoZWNraW5nCmRvbWluYXRlcyB0aGUgc2VsZnRl
c3QgcnVudGltZSBhbmQgaXMgc3VwZXJmbHVvdXMhCgpJbiB0aGUgcHJvY2VzcywgcmV0aXJlIHRo
ZSBJOTE1X1dSSVRFKCkgaW1wbGljaXQgbWFjcm8gd2l0aCB0aGUgbmV3CmludGVsX3VuY29yZV93
cml0ZSBpbnRlcmZhY2UuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9y
ZWcuYyB8IDEyMyArKysrKysrKysrKystLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNjggaW5z
ZXJ0aW9ucygrKSwgNTUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9mZW5jZV9yZWcuYwppbmRleCAyZTllMzIzMzBhYWEuLmM2ODczMGZiMjFlNiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKQEAgLTk0LDkgKzk0LDEwIEBAIHN0
YXRpYyB2b2lkIGk5NjVfd3JpdGVfZmVuY2VfcmVnKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcg
KmZlbmNlLAogCX0KIAogCWlmICghcGlwZWxpbmVkKSB7Ci0JCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGZlbmNlLT5pOTE1OworCQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmMg
PSAmZmVuY2UtPmk5MTUtPnVuY29yZTsKIAotCQkvKiBUbyB3L2EgaW5jb2hlcmVuY3kgd2l0aCBu
b24tYXRvbWljIDY0LWJpdCByZWdpc3RlciB1cGRhdGVzLAorCQkvKgorCQkgKiBUbyB3L2EgaW5j
b2hlcmVuY3kgd2l0aCBub24tYXRvbWljIDY0LWJpdCByZWdpc3RlciB1cGRhdGVzLAogCQkgKiB3
ZSBzcGxpdCB0aGUgNjQtYml0IHVwZGF0ZSBpbnRvIHR3byAzMi1iaXQgd3JpdGVzLiBJbiBvcmRl
cgogCQkgKiBmb3IgYSBwYXJ0aWFsIGZlbmNlIG5vdCB0byBiZSBldmFsdWF0ZWQgYmV0d2VlbiB3
cml0ZXMsIHdlCiAJCSAqIHByZWNlZGUgdGhlIHVwZGF0ZSB3aXRoIHdyaXRlIHRvIHR1cm4gb2Zm
IHRoZSBmZW5jZSByZWdpc3RlciwKQEAgLTEwNSwxMiArMTA2LDEyIEBAIHN0YXRpYyB2b2lkIGk5
NjVfd3JpdGVfZmVuY2VfcmVnKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCQkg
KiBGb3IgZXh0cmEgbGV2ZWxzIG9mIHBhcmFub2lhLCB3ZSBtYWtlIHN1cmUgZWFjaCBzdGVwIGxh
bmRzCiAJCSAqIGJlZm9yZSBhcHBseWluZyB0aGUgbmV4dCBzdGVwLgogCQkgKi8KLQkJSTkxNV9X
UklURShmZW5jZV9yZWdfbG8sIDApOwotCQlQT1NUSU5HX1JFQUQoZmVuY2VfcmVnX2xvKTsKKwkJ
aW50ZWxfdW5jb3JlX3dyaXRlX2Z3KHVuYywgZmVuY2VfcmVnX2xvLCAwKTsKKwkJaW50ZWxfdW5j
b3JlX3Bvc3RpbmdfcmVhZF9mdyh1bmMsIGZlbmNlX3JlZ19sbyk7CiAKLQkJSTkxNV9XUklURShm
ZW5jZV9yZWdfaGksIHVwcGVyXzMyX2JpdHModmFsKSk7Ci0JCUk5MTVfV1JJVEUoZmVuY2VfcmVn
X2xvLCBsb3dlcl8zMl9iaXRzKHZhbCkpOwotCQlQT1NUSU5HX1JFQUQoZmVuY2VfcmVnX2xvKTsK
KwkJaW50ZWxfdW5jb3JlX3dyaXRlX2Z3KHVuYywgZmVuY2VfcmVnX2hpLCB1cHBlcl8zMl9iaXRz
KHZhbCkpOworCQlpbnRlbF91bmNvcmVfd3JpdGVfZncodW5jLCBmZW5jZV9yZWdfbG8sIGxvd2Vy
XzMyX2JpdHModmFsKSk7CisJCWludGVsX3VuY29yZV9wb3N0aW5nX3JlYWRfZncodW5jLCBmZW5j
ZV9yZWdfbG8pOwogCX0KIH0KIApAQCAtMTQ2LDExICsxNDcsMTEgQEAgc3RhdGljIHZvaWQgaTkx
NV93cml0ZV9mZW5jZV9yZWcoc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAJfQog
CiAJaWYgKCFwaXBlbGluZWQpIHsKLQkJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZmVuY2UtPmk5MTU7CisJCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuYyA9ICZmZW5jZS0+aTkx
NS0+dW5jb3JlOwogCQlpOTE1X3JlZ190IHJlZyA9IEZFTkNFX1JFRyhmZW5jZS0+aWQpOwogCi0J
CUk5MTVfV1JJVEUocmVnLCB2YWwpOwotCQlQT1NUSU5HX1JFQUQocmVnKTsKKwkJaW50ZWxfdW5j
b3JlX3dyaXRlX2Z3KHVuYywgcmVnLCB2YWwpOworCQlpbnRlbF91bmNvcmVfcG9zdGluZ19yZWFk
X2Z3KHVuYywgcmVnKTsKIAl9CiB9CiAKQEAgLTE3OCwxOCArMTc5LDE5IEBAIHN0YXRpYyB2b2lk
IGk4MzBfd3JpdGVfZmVuY2VfcmVnKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAog
CX0KIAogCWlmICghcGlwZWxpbmVkKSB7Ci0JCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGZlbmNlLT5pOTE1OworCQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmMgPSAmZmVuY2Ut
Pmk5MTUtPnVuY29yZTsKIAkJaTkxNV9yZWdfdCByZWcgPSBGRU5DRV9SRUcoZmVuY2UtPmlkKTsK
IAotCQlJOTE1X1dSSVRFKHJlZywgdmFsKTsKLQkJUE9TVElOR19SRUFEKHJlZyk7CisJCWludGVs
X3VuY29yZV93cml0ZV9mdyh1bmMsIHJlZywgdmFsKTsKKwkJaW50ZWxfdW5jb3JlX3Bvc3Rpbmdf
cmVhZF9mdyh1bmMsIHJlZyk7CiAJfQogfQogCiBzdGF0aWMgdm9pZCBmZW5jZV93cml0ZShzdHJ1
Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAkJCXN0cnVjdCBpOTE1X3ZtYSAqdm1hKQog
ewotCS8qIFByZXZpb3VzIGFjY2VzcyB0aHJvdWdoIHRoZSBmZW5jZSByZWdpc3RlciBpcyBtYXJz
aGFsbGVkIGJ5CisJLyoKKwkgKiBQcmV2aW91cyBhY2Nlc3MgdGhyb3VnaCB0aGUgZmVuY2UgcmVn
aXN0ZXIgaXMgbWFyc2hhbGxlZCBieQogCSAqIHRoZSBtYigpIGluc2lkZSB0aGUgZmF1bHQgaGFu
ZGxlcnMgKGk5MTVfZ2VtX3JlbGVhc2VfbW1hcHMpCiAJICogYW5kIGV4cGxpY2l0bHkgbWFuYWdl
ZCBmb3IgaW50ZXJuYWwgdXNlcnMuCiAJICovCkBAIC0yMDEsNyArMjAzLDggQEAgc3RhdGljIHZv
aWQgZmVuY2Vfd3JpdGUoc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAJZWxzZQog
CQlpOTY1X3dyaXRlX2ZlbmNlX3JlZyhmZW5jZSwgdm1hKTsKIAotCS8qIEFjY2VzcyB0aHJvdWdo
IHRoZSBmZW5jZWQgcmVnaW9uIGFmdGVyd2FyZHMgaXMKKwkvKgorCSAqIEFjY2VzcyB0aHJvdWdo
IHRoZSBmZW5jZWQgcmVnaW9uIGFmdGVyd2FyZHMgaXMKIAkgKiBvcmRlcmVkIGJ5IHRoZSBwb3N0
aW5nIHJlYWRzIHdoaWxzdCB3cml0aW5nIHRoZSByZWdpc3RlcnMuCiAJICovCiAKQEAgLTMwOCwx
MSArMzExLDExIEBAIGludCBpOTE1X3ZtYV9wdXRfZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEp
CiAJcmV0dXJuIGZlbmNlX3VwZGF0ZShmZW5jZSwgTlVMTCk7CiB9CiAKLXN0YXRpYyBzdHJ1Y3Qg
ZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK3N0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBkcm1faTkxNV9mZW5jZV9y
ZWcgKmZlbmNlOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShmZW5jZSwgJmRldl9wcml2LT5tbS5m
ZW5jZV9saXN0LCBsaW5rKSB7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShmZW5jZSwgJmk5MTUtPm1t
LmZlbmNlX2xpc3QsIGxpbmspIHsKIAkJR0VNX0JVR19PTihmZW5jZS0+dm1hICYmIGZlbmNlLT52
bWEtPmZlbmNlICE9IGZlbmNlKTsKIAogCQlpZiAoZmVuY2UtPnBpbl9jb3VudCkKQEAgLTMyMiw3
ICszMjUsNyBAQCBzdGF0aWMgc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2VfZmluZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogCiAJLyogV2FpdCBmb3IgY29t
cGxldGlvbiBvZiBwZW5kaW5nIGZsaXBzIHdoaWNoIGNvbnN1bWUgZmVuY2VzICovCi0JaWYgKGlu
dGVsX2hhc19wZW5kaW5nX2ZiX3VucGluKGRldl9wcml2KSkKKwlpZiAoaW50ZWxfaGFzX3BlbmRp
bmdfZmJfdW5waW4oaTkxNSkpCiAJCXJldHVybiBFUlJfUFRSKC1FQUdBSU4pOwogCiAJcmV0dXJu
IEVSUl9QVFIoLUVERUFETEspOwpAQCAtMzUzLDcgKzM1Niw4IEBAIGk5MTVfdm1hX3Bpbl9mZW5j
ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlzdHJ1Y3QgaTkxNV92bWEgKnNldCA9IGk5MTVfZ2Vt
X29iamVjdF9pc190aWxlZCh2bWEtPm9iaikgPyB2bWEgOiBOVUxMOwogCWludCBlcnI7CiAKLQkv
KiBOb3RlIHRoYXQgd2UgcmV2b2tlIGZlbmNlcyBvbiBydW50aW1lIHN1c3BlbmQuIFRoZXJlZm9y
ZSB0aGUgdXNlcgorCS8qCisJICogTm90ZSB0aGF0IHdlIHJldm9rZSBmZW5jZXMgb24gcnVudGlt
ZSBzdXNwZW5kLiBUaGVyZWZvcmUgdGhlIHVzZXIKIAkgKiBtdXN0IGtlZXAgdGhlIGRldmljZSBh
d2FrZSB3aGlsc3QgdXNpbmcgdGhlIGZlbmNlLgogCSAqLwogCWFzc2VydF9ycG1fd2FrZWxvY2tf
aGVsZCh2bWEtPnZtLT5pOTE1KTsKQEAgLTM5NSwyOCArMzk5LDI4IEBAIGk5MTVfdm1hX3Bpbl9m
ZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogLyoqCiAgKiBpOTE1X3Jlc2VydmVfZmVuY2Ug
LSBSZXNlcnZlIGEgZmVuY2UgZm9yIHZHUFUKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgcHJp
dmF0ZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIHByaXZhdGUKICAqCiAgKiBUaGlzIGZ1bmN0aW9u
IHdhbGtzIHRoZSBmZW5jZSByZWdzIGxvb2tpbmcgZm9yIGEgZnJlZSBvbmUgYW5kIHJlbW92ZQog
ICogaXQgZnJvbSB0aGUgZmVuY2VfbGlzdC4gSXQgaXMgdXNlZCB0byByZXNlcnZlIGZlbmNlIGZv
ciB2R1BVIHRvIHVzZS4KICAqLwogc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqCi1pOTE1X3Jl
c2VydmVfZmVuY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9yZXNl
cnZlX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBkcm1f
aTkxNV9mZW5jZV9yZWcgKmZlbmNlOwogCWludCBjb3VudDsKIAlpbnQgcmV0OwogCi0JbG9ja2Rl
cF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJLyogS2VlcCBhdCBsZWFzdCBv
bmUgZmVuY2UgYXZhaWxhYmxlIGZvciB0aGUgZGlzcGxheSBlbmdpbmUuICovCiAJY291bnQgPSAw
OwotCWxpc3RfZm9yX2VhY2hfZW50cnkoZmVuY2UsICZkZXZfcHJpdi0+bW0uZmVuY2VfbGlzdCwg
bGluaykKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGZlbmNlLCAmaTkxNS0+bW0uZmVuY2VfbGlzdCwg
bGluaykKIAkJY291bnQgKz0gIWZlbmNlLT5waW5fY291bnQ7CiAJaWYgKGNvdW50IDw9IDEpCiAJ
CXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOwogCi0JZmVuY2UgPSBmZW5jZV9maW5kKGRldl9wcml2
KTsKKwlmZW5jZSA9IGZlbmNlX2ZpbmQoaTkxNSk7CiAJaWYgKElTX0VSUihmZW5jZSkpCiAJCXJl
dHVybiBmZW5jZTsKIApAQCAtNDQ2LDE5ICs0NTAsMTkgQEAgdm9pZCBpOTE1X3VucmVzZXJ2ZV9m
ZW5jZShzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZSkKIAogLyoqCiAgKiBpOTE1X2dl
bV9yZXN0b3JlX2ZlbmNlcyAtIHJlc3RvcmUgZmVuY2Ugc3RhdGUKLSAqIEBkZXZfcHJpdjogaTkx
NSBkZXZpY2UgcHJpdmF0ZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIHByaXZhdGUKICAqCiAgKiBS
ZXN0b3JlIHRoZSBodyBmZW5jZSBzdGF0ZSB0byBtYXRjaCB0aGUgc29mdHdhcmUgdHJhY2tpbmcg
YWdhaW4sIHRvIGJlIGNhbGxlZAogICogYWZ0ZXIgYSBncHUgcmVzZXQgYW5kIG9uIHJlc3VtZS4g
Tm90ZSB0aGF0IG9uIHJ1bnRpbWUgc3VzcGVuZCB3ZSBvbmx5IGNhbmNlbAogICogdGhlIGZlbmNl
cywgdG8gYmUgcmVhY3F1aXJlZCBieSB0aGUgdXNlciBsYXRlci4KICAqLwotdm9pZCBpOTE1X2dl
bV9yZXN0b3JlX2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lk
IGk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCWludCBpOwogCiAJcmN1X3JlYWRfbG9jaygpOyAvKiBrZWVwIG9iaiBhbGl2ZSBhcyB3ZSBk
ZXJlZmVyZW5jZSAqLwotCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+bnVtX2ZlbmNlX3JlZ3M7
IGkrKykgewotCQlzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpyZWcgPSAmZGV2X3ByaXYtPmZl
bmNlX3JlZ3NbaV07CisJZm9yIChpID0gMDsgaSA8IGk5MTUtPm51bV9mZW5jZV9yZWdzOyBpKysp
IHsKKwkJc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqcmVnID0gJmk5MTUtPmZlbmNlX3JlZ3Nb
aV07CiAJCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gUkVBRF9PTkNFKHJlZy0+dm1hKTsKIAogCQlH
RU1fQlVHX09OKHZtYSAmJiB2bWEtPmZlbmNlICE9IHJlZyk7CkBAIC01MjUsMTggKzUyOSwxOSBA
QCB2b2lkIGk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAogLyoqCiAgKiBpOTE1X2dlbV9kZXRlY3RfYml0XzZfc3dpenpsZSAtIGRldGVj
dCBiaXQgNiBzd2l6emxpbmcgcGF0dGVybgotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBwcml2
YXRlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgcHJpdmF0ZQogICoKICAqIERldGVjdHMgYml0IDYg
c3dpenpsaW5nIG9mIGFkZHJlc3MgbG9va3VwIGJldHdlZW4gSUdEIGFjY2VzcyBhbmQgQ1BVCiAg
KiBhY2Nlc3MgdGhyb3VnaCBtYWluIG1lbW9yeS4KICAqLwogdm9pZAotaTkxNV9nZW1fZGV0ZWN0
X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraTkxNV9n
ZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jID0gJmk5MTUtPnVuY29yZTsKIAl1MzIgc3dpenps
ZV94ID0gSTkxNV9CSVRfNl9TV0laWkxFX1VOS05PV047CiAJdTMyIHN3aXp6bGVfeSA9IEk5MTVf
QklUXzZfU1dJWlpMRV9VTktOT1dOOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCB8
fCBJU19WQUxMRVlWSUVXKGRldl9wcml2KSkgeworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCB8
fCBJU19WQUxMRVlWSUVXKGk5MTUpKSB7CiAJCS8qCiAJCSAqIE9uIEJEVyssIHN3aXp6bGluZyBp
cyBub3QgdXNlZC4gV2UgbGVhdmUgdGhlIENQVSBtZW1vcnkKIAkJICogY29udHJvbGxlciBpbiBj
aGFyZ2Ugb2Ygb3B0aW1pemluZyBtZW1vcnkgYWNjZXNzZXMgd2l0aG91dApAQCAtNTQ2LDkgKzU1
MSw5IEBAIGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAkJICovCiAJCXN3aXp6bGVfeCA9IEk5MTVfQklUXzZfU1dJWlpMRV9O
T05FOwogCQlzd2l6emxlX3kgPSBJOTE1X0JJVF82X1NXSVpaTEVfTk9ORTsKLQl9IGVsc2UgaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gNikgewotCQlpZiAoZGV2X3ByaXYtPnByZXNlcnZlX2Jp
b3Nfc3dpenpsZSkgewotCQkJaWYgKEk5MTVfUkVBRChESVNQX0FSQl9DVEwpICYKKwl9IGVsc2Ug
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KSB7CisJCWlmIChpOTE1LT5wcmVzZXJ2ZV9iaW9zX3N3
aXp6bGUpIHsKKwkJCWlmIChpbnRlbF91bmNvcmVfcmVhZCh1bmMsIERJU1BfQVJCX0NUTCkgJgog
CQkJICAgIERJU1BfVElMRV9TVVJGQUNFX1NXSVpaTElORykgewogCQkJCXN3aXp6bGVfeCA9IEk5
MTVfQklUXzZfU1dJWlpMRV85XzEwOwogCQkJCXN3aXp6bGVfeSA9IEk5MTVfQklUXzZfU1dJWlpM
RV85OwpAQCAtNTU4LDE1ICs1NjMsMTcgQEAgaTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJfQogCQl9IGVsc2UgewogCQkJ
dTMyIGRpbW1fYzAsIGRpbW1fYzE7Ci0JCQlkaW1tX2MwID0gSTkxNV9SRUFEKE1BRF9ESU1NX0Mw
KTsKLQkJCWRpbW1fYzEgPSBJOTE1X1JFQUQoTUFEX0RJTU1fQzEpOworCQkJZGltbV9jMCA9IGlu
dGVsX3VuY29yZV9yZWFkKHVuYywgTUFEX0RJTU1fQzApOworCQkJZGltbV9jMSA9IGludGVsX3Vu
Y29yZV9yZWFkKHVuYywgTUFEX0RJTU1fQzEpOwogCQkJZGltbV9jMCAmPSBNQURfRElNTV9BX1NJ
WkVfTUFTSyB8IE1BRF9ESU1NX0JfU0laRV9NQVNLOwogCQkJZGltbV9jMSAmPSBNQURfRElNTV9B
X1NJWkVfTUFTSyB8IE1BRF9ESU1NX0JfU0laRV9NQVNLOwotCQkJLyogRW5hYmxlIHN3aXp6bGlu
ZyB3aGVuIHRoZSBjaGFubmVscyBhcmUgcG9wdWxhdGVkCisJCQkvKgorCQkJICogRW5hYmxlIHN3
aXp6bGluZyB3aGVuIHRoZSBjaGFubmVscyBhcmUgcG9wdWxhdGVkCiAJCQkgKiB3aXRoIGlkZW50
aWNhbGx5IHNpemVkIGRpbW1zLiBXZSBkb24ndCBuZWVkIHRvIGNoZWNrCiAJCQkgKiB0aGUgM3Jk
IGNoYW5uZWwgYmVjYXVzZSBubyBjcHUgd2l0aCBncHUgYXR0YWNoZWQKIAkJCSAqIHNoaXBzIGlu
IHRoYXQgY29uZmlndXJhdGlvbi4gQWxzbywgc3dpenpsaW5nIG9ubHkKLQkJCSAqIG1ha2VzIHNl
bnNlIGZvciAyIGNoYW5uZWxzIGFueXdheS4gKi8KKwkJCSAqIG1ha2VzIHNlbnNlIGZvciAyIGNo
YW5uZWxzIGFueXdheS4KKwkJCSAqLwogCQkJaWYgKGRpbW1fYzAgPT0gZGltbV9jMSkgewogCQkJ
CXN3aXp6bGVfeCA9IEk5MTVfQklUXzZfU1dJWlpMRV85XzEwOwogCQkJCXN3aXp6bGVfeSA9IEk5
MTVfQklUXzZfU1dJWlpMRV85OwpAQCAtNTc1LDIwICs1ODIsMjMgQEAgaTkxNV9nZW1fZGV0ZWN0
X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJCXN3
aXp6bGVfeSA9IEk5MTVfQklUXzZfU1dJWlpMRV9OT05FOwogCQkJfQogCQl9Ci0JfSBlbHNlIGlm
IChJU19HRU4oZGV2X3ByaXYsIDUpKSB7Ci0JCS8qIE9uIElyb25sYWtlIHdoYXRldmVyIERSQU0g
Y29uZmlnLCBHUFUgYWx3YXlzIGRvCisJfSBlbHNlIGlmIChJU19HRU4oaTkxNSwgNSkpIHsKKwkJ
LyoKKwkJICogT24gSXJvbmxha2Ugd2hhdGV2ZXIgRFJBTSBjb25maWcsIEdQVSBhbHdheXMgZG8K
IAkJICogc2FtZSBzd2l6emxpbmcgc2V0dXAuCiAJCSAqLwogCQlzd2l6emxlX3ggPSBJOTE1X0JJ
VF82X1NXSVpaTEVfOV8xMDsKIAkJc3dpenpsZV95ID0gSTkxNV9CSVRfNl9TV0laWkxFXzk7Ci0J
fSBlbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDIpKSB7Ci0JCS8qIEFzIGZhciBhcyB3ZSBrbm93
LCB0aGUgODY1IGRvZXNuJ3QgaGF2ZSB0aGVzZSBiaXQgNgorCX0gZWxzZSBpZiAoSVNfR0VOKGk5
MTUsIDIpKSB7CisJCS8qCisJCSAqIEFzIGZhciBhcyB3ZSBrbm93LCB0aGUgODY1IGRvZXNuJ3Qg
aGF2ZSB0aGVzZSBiaXQgNgogCQkgKiBzd2l6emxpbmcgaXNzdWVzLgogCQkgKi8KIAkJc3dpenps
ZV94ID0gSTkxNV9CSVRfNl9TV0laWkxFX05PTkU7CiAJCXN3aXp6bGVfeSA9IEk5MTVfQklUXzZf
U1dJWlpMRV9OT05FOwotCX0gZWxzZSBpZiAoSVNfRzQ1KGRldl9wcml2KSB8fCBJU19JOTY1Ryhk
ZXZfcHJpdikgfHwgSVNfRzMzKGRldl9wcml2KSkgewotCQkvKiBUaGUgOTY1LCBHMzMsIGFuZCBu
ZXdlciwgaGF2ZSBhIHZlcnkgZmxleGlibGUgbWVtb3J5CisJfSBlbHNlIGlmIChJU19HNDUoaTkx
NSkgfHwgSVNfSTk2NUcoaTkxNSkgfHwgSVNfRzMzKGk5MTUpKSB7CisJCS8qCisJCSAqIFRoZSA5
NjUsIEczMywgYW5kIG5ld2VyLCBoYXZlIGEgdmVyeSBmbGV4aWJsZSBtZW1vcnkKIAkJICogY29u
ZmlndXJhdGlvbi4gIEl0IHdpbGwgZW5hYmxlIGR1YWwtY2hhbm5lbCBtb2RlCiAJCSAqIChpbnRl
cmxlYXZpbmcpIG9uIGFzIG11Y2ggbWVtb3J5IGFzIGl0IGNhbiwgYW5kIHRoZSBHUFUKIAkJICog
d2lsbCBhZGRpdGlvbmFsbHkgc29tZXRpbWVzIGVuYWJsZSBkaWZmZXJlbnQgYml0IDYKQEAgLTYx
NCwxNCArNjI0LDE2IEBAIGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICogYmFua3Mgb2YgbWVtb3J5IGFyZSBwYWlyZWQg
YW5kIHVuc3dpenpsZWQgb24gdGhlCiAJCSAqIHVuZXZlbiBwb3J0aW9uLCBzbyBsZWF2ZSB0aGF0
IGFzIHVua25vd24uCiAJCSAqLwotCQlpZiAoSTkxNV9SRUFEMTYoQzBEUkIzKSA9PSBJOTE1X1JF
QUQxNihDMURSQjMpKSB7CisJCWlmIChpbnRlbF91bmNvcmVfcmVhZCh1bmMsIEMwRFJCMykgPT0K
KwkJICAgIGludGVsX3VuY29yZV9yZWFkKHVuYywgQzFEUkIzKSkgewogCQkJc3dpenpsZV94ID0g
STkxNV9CSVRfNl9TV0laWkxFXzlfMTA7CiAJCQlzd2l6emxlX3kgPSBJOTE1X0JJVF82X1NXSVpa
TEVfOTsKIAkJfQogCX0gZWxzZSB7Ci0JCXUzMiBkY2M7CisJCXUzMiBkY2MgPSBpbnRlbF91bmNv
cmVfcmVhZCh1bmMsIERDQyk7CiAKLQkJLyogT24gOXh4IGNoaXBzZXRzLCBjaGFubmVsIGludGVy
bGVhdmUgYnkgdGhlIENQVSBpcworCQkvKgorCQkgKiBPbiA5eHggY2hpcHNldHMsIGNoYW5uZWwg
aW50ZXJsZWF2ZSBieSB0aGUgQ1BVIGlzCiAJCSAqIGRldGVybWluZWQgYnkgRENDLiAgRm9yIHNp
bmdsZS1jaGFubmVsLCBuZWl0aGVyIHRoZSBDUFUKIAkJICogbm9yIHRoZSBHUFUgZG8gc3dpenps
aW5nLiAgRm9yIGR1YWwgY2hhbm5lbCBpbnRlcmxlYXZlZCwKIAkJICogdGhlIEdQVSdzIGludGVy
bGVhdmUgaXMgYml0IDkgYW5kIDEwIGZvciBYIHRpbGVkLCBhbmQgYml0CkBAIC02MjksNyArNjQx
LDYgQEAgaTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCQkgKiBjYW4gYmUgYmFzZWQgb24gZWl0aGVyIGJpdCAxMSAoaGF2ZW4n
dCBzZWVuIHRoaXMgeWV0KSBvcgogCQkgKiBiaXQgMTcgKGNvbW1vbikuCiAJCSAqLwotCQlkY2Mg
PSBJOTE1X1JFQUQoRENDKTsKIAkJc3dpdGNoIChkY2MgJiBEQ0NfQUREUkVTU0lOR19NT0RFX01B
U0spIHsKIAkJY2FzZSBEQ0NfQUREUkVTU0lOR19NT0RFX1NJTkdMRV9DSEFOTkVMOgogCQljYXNl
IERDQ19BRERSRVNTSU5HX01PREVfRFVBTF9DSEFOTkVMX0FTWU1NRVRSSUM6CkBAIC02MzgsNyAr
NjQ5LDggQEAgaTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCQkJYnJlYWs7CiAJCWNhc2UgRENDX0FERFJFU1NJTkdfTU9ERV9E
VUFMX0NIQU5ORUxfSU5URVJMRUFWRUQ6CiAJCQlpZiAoZGNjICYgRENDX0NIQU5ORUxfWE9SX0RJ
U0FCTEUpIHsKLQkJCQkvKiBUaGlzIGlzIHRoZSBiYXNlIHN3aXp6bGluZyBieSB0aGUgR1BVIGZv
cgorCQkJCS8qCisJCQkJICogVGhpcyBpcyB0aGUgYmFzZSBzd2l6emxpbmcgYnkgdGhlIEdQVSBm
b3IKIAkJCQkgKiB0aWxlZCBidWZmZXJzLgogCQkJCSAqLwogCQkJCXN3aXp6bGVfeCA9IEk5MTVf
QklUXzZfU1dJWlpMRV85XzEwOwpAQCAtNjU2LDggKzY2OCw4IEBAIGk5MTVfZ2VtX2RldGVjdF9i
aXRfNl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJfQogCiAJ
CS8qIGNoZWNrIGZvciBMLXNoYXBlZCBtZW1vcnkgYWthIG1vZGlmaWVkIGVuaGFuY2VkIGFkZHJl
c3NpbmcgKi8KLQkJaWYgKElTX0dFTihkZXZfcHJpdiwgNCkgJiYKLQkJICAgICEoSTkxNV9SRUFE
KERDQzIpICYgRENDMl9NT0RJRklFRF9FTkhBTkNFRF9ESVNBQkxFKSkgeworCQlpZiAoSVNfR0VO
KGk5MTUsIDQpICYmCisJCSAgICAhKGludGVsX3VuY29yZV9yZWFkKHVuYywgRENDMikgJiBEQ0My
X01PRElGSUVEX0VOSEFOQ0VEX0RJU0FCTEUpKSB7CiAJCQlzd2l6emxlX3ggPSBJOTE1X0JJVF82
X1NXSVpaTEVfVU5LTk9XTjsKIAkJCXN3aXp6bGVfeSA9IEk5MTVfQklUXzZfU1dJWlpMRV9VTktO
T1dOOwogCQl9CkBAIC02NzIsNyArNjg0LDggQEAgaTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJaWYgKHN3aXp6bGVfeCA9
PSBJOTE1X0JJVF82X1NXSVpaTEVfVU5LTk9XTiB8fAogCSAgICBzd2l6emxlX3kgPT0gSTkxNV9C
SVRfNl9TV0laWkxFX1VOS05PV04pIHsKLQkJLyogVXNlcnNwYWNlIGxpa2VzIHRvIGV4cGxvZGUg
aWYgaXQgc2VlcyB1bmtub3duIHN3aXp6bGluZywKKwkJLyoKKwkJICogVXNlcnNwYWNlIGxpa2Vz
IHRvIGV4cGxvZGUgaWYgaXQgc2VlcyB1bmtub3duIHN3aXp6bGluZywKIAkJICogc28gbGllLiBX
ZSB3aWxsIGZpbmlzaCB0aGUgbGllIHdoZW4gcmVwb3J0aW5nIHRocm91Z2gKIAkJICogdGhlIGdl
dC10aWxpbmctaW9jdGwgYnkgcmVwb3J0aW5nIHRoZSBwaHlzaWNhbCBzd2l6emxlCiAJCSAqIG1v
ZGUgYXMgdW5rbm93biBpbnN0ZWFkLgpAQCAtNjgxLDEzICs2OTQsMTMgQEAgaTkxNV9nZW1fZGV0
ZWN0X2JpdF82X3N3aXp6bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkg
KiBiaXQxNyBkZXBlbmRlbnQsIGFuZCBzbyB3ZSBuZWVkIHRvIGFsc28gcHJldmVudCB0aGUgcGFn
ZXMKIAkJICogZnJvbSBiZWluZyBtb3ZlZC4KIAkJICovCi0JCWRldl9wcml2LT5xdWlya3MgfD0g
UVVJUktfUElOX1NXSVpaTEVEX1BBR0VTOworCQlpOTE1LT5xdWlya3MgfD0gUVVJUktfUElOX1NX
SVpaTEVEX1BBR0VTOwogCQlzd2l6emxlX3ggPSBJOTE1X0JJVF82X1NXSVpaTEVfTk9ORTsKIAkJ
c3dpenpsZV95ID0gSTkxNV9CSVRfNl9TV0laWkxFX05PTkU7CiAJfQogCi0JZGV2X3ByaXYtPm1t
LmJpdF82X3N3aXp6bGVfeCA9IHN3aXp6bGVfeDsKLQlkZXZfcHJpdi0+bW0uYml0XzZfc3dpenps
ZV95ID0gc3dpenpsZV95OworCWk5MTUtPm1tLmJpdF82X3N3aXp6bGVfeCA9IHN3aXp6bGVfeDsK
KwlpOTE1LT5tbS5iaXRfNl9zd2l6emxlX3kgPSBzd2l6emxlX3k7CiB9CiAKIC8qCi0tIAoyLjIw
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

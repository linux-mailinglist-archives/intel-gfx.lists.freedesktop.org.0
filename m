Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7BD749B0E0
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 15:27:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7099D6EC8B;
	Fri, 23 Aug 2019 13:27:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 32F766EC94
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 13:27:12 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18240600-1500050 
 for multiple; Fri, 23 Aug 2019 14:27:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 23 Aug 2019 14:26:51 +0100
Message-Id: <20190823132700.25286-7-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190823132700.25286-1-chris@chris-wilson.co.uk>
References: <20190823132700.25286-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/15] drm/i915: Mark up obj->pin_global as
 being atomic
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29taW5nIHVwIG5leHQsIHdlIHdpbGwgd2FudCB0byBtYW5pcHVsYXRlIHRoZSBwaW5fZ2xvYmFs
IGNvdW50ZXIKb3V0c2lkZSBvZiB0aGUgcHJpbmNpcGxlIGxvY2tzLCBzbyBjb252ZXJ0IGl0IHRv
IGFuIGF0b21pYy4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2ls
c29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4u
YyAgICAgICB8IDEyICsrKysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5oICAgICAgIHwgIDMgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0X3R5cGVzLmggfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3Nocmlua2VyLmMgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZGVidWdmcy5jICAgICAgICAgICAgICB8ICA0ICsrLS0KIDUgZmlsZXMgY2hhbmdlZCwgMTIgaW5z
ZXJ0aW9ucygrKSwgMTEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2RvbWFpbi5jCmluZGV4IGVmMzMwMDFlOGRkYi4uYjdiZTlhZDJiNjJjIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCkBAIC0yNyw3ICsyNyw3IEBA
IHN0YXRpYyB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2Zvcl9kaXNwbGF5KHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAKIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2lm
X2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKLQlpZiAoIVJFQURf
T05DRShvYmotPnBpbl9nbG9iYWwpKQorCWlmICghYXRvbWljX3JlYWQoJm9iai0+cGluX2dsb2Jh
bCkpCiAJCXJldHVybjsKIAogCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CkBAIC00MjUsNyAr
NDI1LDcgQEAgaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJLyogTWFyayB0aGUgZ2xvYmFsIHBpbiBlYXJseSBzbyB0
aGF0IHdlIGFjY291bnQgZm9yIHRoZQogCSAqIGRpc3BsYXkgY29oZXJlbmN5IHdoaWxzdCBzZXR0
aW5nIHVwIHRoZSBjYWNoZSBkb21haW5zLgogCSAqLwotCW9iai0+cGluX2dsb2JhbCsrOworCWF0
b21pY19pbmMoJm9iai0+cGluX2dsb2JhbCk7CiAKIAkvKiBUaGUgZGlzcGxheSBlbmdpbmUgaXMg
bm90IGNvaGVyZW50IHdpdGggdGhlIExMQyBjYWNoZSBvbiBnZW42LiAgQXMKIAkgKiBhIHJlc3Vs
dCwgd2UgbWFrZSBzdXJlIHRoYXQgdGhlIHBpbm5pbmcgdGhhdCBpcyBhYm91dCB0byBvY2N1ciBp
cwpAQCAtNDc1LDcgKzQ3NSw3IEBAIGk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFu
ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXJldHVybiB2bWE7CiAKIGVycl91
bnBpbl9nbG9iYWw6Ci0Jb2JqLT5waW5fZ2xvYmFsLS07CisJYXRvbWljX2RlYygmb2JqLT5waW5f
Z2xvYmFsKTsKIAlyZXR1cm4gdm1hOwogfQogCkBAIC01MTUsMTEgKzUxNSwxMSBAQCBpOTE1X2dl
bV9vYmplY3RfdW5waW5fZnJvbV9kaXNwbGF5X3BsYW5lKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQog
CiAJYXNzZXJ0X29iamVjdF9oZWxkKG9iaik7CiAKLQlpZiAoV0FSTl9PTihvYmotPnBpbl9nbG9i
YWwgPT0gMCkpCisJaWYgKEdFTV9XQVJOX09OKCFhdG9taWNfcmVhZCgmb2JqLT5waW5fZ2xvYmFs
KSkpCiAJCXJldHVybjsKIAotCWlmICgtLW9iai0+cGluX2dsb2JhbCA9PSAwKQotCQl2bWEtPmRp
c3BsYXlfYWxpZ25tZW50ID0gSTkxNV9HVFRfTUlOX0FMSUdOTUVOVDsKKwlpZiAoYXRvbWljX2Rl
Y19hbmRfdGVzdCgmb2JqLT5waW5fZ2xvYmFsKSkKKwkJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9
IEk5MTVfR1RUX01JTl9BTElHTk1FTlQ7IC8qIFhYWCByYWNlICovCiAKIAkvKiBCdW1wIHRoZSBM
UlUgdG8gdHJ5IGFuZCBhdm9pZCBwcmVtYXR1cmUgZXZpY3Rpb24gd2hpbHN0IGZsaXBwaW5nICAq
LwogCWk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dndHQob2JqKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCA1ZWZiOTkzNmUwNWIuLjExYmIx
YTQxMmU0ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApA
QCAtNDA2LDcgKzQwNiw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBjcHVfd3JpdGVfbmVlZHNfY2xm
bHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWlmICghKG9iai0+Y2FjaGVf
Y29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkpCiAJCXJldHVybiB0
cnVlOwogCi0JcmV0dXJuIG9iai0+cGluX2dsb2JhbDsgLyogY3VycmVudGx5IGluIHVzZSBieSBI
Vywga2VlcCBmbHVzaGVkICovCisJLyogQ3VycmVudGx5IGluIHVzZSBieSBIVyAoZGlzcGxheSBl
bmdpbmUpPyBLZWVwIGZsdXNoZWQuICovCisJcmV0dXJuIGF0b21pY19yZWFkKCZvYmotPnBpbl9n
bG9iYWwpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgX19zdGFydF9jcHVfd3JpdGUoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRleCA1MTFmY2U3OTEzZWMuLmEwOWU3NGUyNzcz
NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90
eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlw
ZXMuaApAQCAtMTUzLDcgKzE1Myw3IEBAIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0IHsKIAkv
KiogQ291bnQgb2YgVk1BIGFjdHVhbGx5IGJvdW5kIGJ5IHRoaXMgb2JqZWN0ICovCiAJYXRvbWlj
X3QgYmluZF9jb3VudDsKIAkvKiogQ291bnQgb2YgaG93IG1hbnkgZ2xvYmFsIFZNQSBhcmUgY3Vy
cmVudGx5IHBpbm5lZCBmb3IgdXNlIGJ5IEhXICovCi0JdW5zaWduZWQgaW50IHBpbl9nbG9iYWw7
CisJYXRvbWljX3QgcGluX2dsb2JhbDsKIAogCXN0cnVjdCB7CiAJCXN0cnVjdCBtdXRleCBsb2Nr
OyAvKiBwcm90ZWN0cyB0aGUgcGFnZXMgYW5kIHRoZWlyIHVzZSAqLwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCA5NDk3MGY2MGQ3ZjYuLjg0MWYx
ODM4NmI1NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3No
cmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2Vy
LmMKQEAgLTc4LDcgKzc4LDcgQEAgc3RhdGljIGJvb2wgY2FuX3JlbGVhc2VfcGFnZXMoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkgKiBUbyBzaW1wbGlmeSB0aGUgc2NhbiwgYW5k
IHRvIGF2b2lkIHdhbGtpbmcgdGhlIGxpc3Qgb2Ygdm1hIHVuZGVyIHRoZQogCSAqIG9iamVjdCwg
d2UganVzdCBjaGVjayB0aGUgY291bnQgb2YgaXRzIHBlcm1hbmVudGx5IHBpbm5lZC4KIAkgKi8K
LQlpZiAoUkVBRF9PTkNFKG9iai0+cGluX2dsb2JhbCkpCisJaWYgKGF0b21pY19yZWFkKCZvYmot
PnBpbl9nbG9iYWwpKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKiBXZSBjYW4gb25seSByZXR1cm4g
cGh5c2ljYWwgcGFnZXMgdG8gdGhlIHN5c3RlbSBpZiB3ZSBjYW4gZWl0aGVyCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IGUxMDNmY2JhNjQzNS4uYzM2NTM4ZjFiMzZjIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtNzksNyArNzksNyBAQCBzdGF0aWMgaW50
IGk5MTVfY2FwYWJpbGl0aWVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAogc3Rh
dGljIGNoYXIgZ2V0X3Bpbl9mbGFnKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7
Ci0JcmV0dXJuIG9iai0+cGluX2dsb2JhbCA/ICdwJyA6ICcgJzsKKwlyZXR1cm4gYXRvbWljX3Jl
YWQoJm9iai0+cGluX2dsb2JhbCkgPyAncCcgOiAnICc7CiB9CiAKIHN0YXRpYyBjaGFyIGdldF90
aWxpbmdfZmxhZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQpAQCAtMjIxLDcgKzIy
MSw3IEBAIGRlc2NyaWJlX29iaihzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCiAJc2VxX3ByaW50ZihtLCAiIChwaW5uZWQgeCAlZCkiLCBwaW5fY291
bnQpOwogCWlmIChvYmotPnN0b2xlbikKIAkJc2VxX3ByaW50ZihtLCAiIChzdG9sZW46ICUwOGxs
eCkiLCBvYmotPnN0b2xlbi0+c3RhcnQpOwotCWlmIChvYmotPnBpbl9nbG9iYWwpCisJaWYgKGF0
b21pY19yZWFkKCZvYmotPnBpbl9nbG9iYWwpKQogCQlzZXFfcHJpbnRmKG0sICIgKGdsb2JhbCki
KTsKIAogCWVuZ2luZSA9IGk5MTVfZ2VtX29iamVjdF9sYXN0X3dyaXRlX2VuZ2luZShvYmopOwot
LSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

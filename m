Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3429D54F8B
	for <lists+intel-gfx@lfdr.de>; Tue, 25 Jun 2019 15:02:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 689096E0F6;
	Tue, 25 Jun 2019 13:02:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BF39E6E0F6
 for <intel-gfx@lists.freedesktop.org>; Tue, 25 Jun 2019 13:02:25 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17018177-1500050 
 for multiple; Tue, 25 Jun 2019 14:01:35 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 25 Jun 2019 14:01:21 +0100
Message-Id: <20190625130128.11009-13-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190625130128.11009-1-chris@chris-wilson.co.uk>
References: <20190625130128.11009-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 13/20] drm/i915/gt: Guard timeline pinning with
 its own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gcHJlcGFyYXRpb24gZm9yIHJlbW92aW5nIHN0cnVjdF9tdXRleCBmcm9tIGFyb3VuZCBjb250
ZXh0IHJldGlyZW1lbnQsCndlIG5lZWQgdG8gbWFrZSB0aW1lbGluZSBwaW5uaW5nIHNhZmUuIFNp
bmNlIG11bHRpcGxlIGVuZ2luZXMvY29udGV4dHMKY2FuIHNoYXJlIGEgc2luZ2xlIHRpbWVsaW5l
LCBpdCBuZWVkcyB0byBiZSBwcm90ZWN0ZWQgYnkgYSBtdXRleC4KClNpZ25lZC1vZmYtYnk6IENo
cmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMgICAgICB8IDI5ICsrKysrKysrKy0tLS0tLS0tLS0K
IC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCAgICB8ICAyICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jICAgICAgICAgfCAgNiArKy0tCiAz
IGZpbGVzIGNoYW5nZWQsIDE4IGluc2VydGlvbnMoKyksIDE5IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jCmluZGV4IDY3MmJjY2JmZDc5Ny4uZDdk
Y2Y1NGIxOGM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1l
bGluZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKQEAg
LTIyMSw3ICsyMjEsOSBAQCBpbnQgaW50ZWxfdGltZWxpbmVfaW5pdChzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKnRpbWVsaW5lLAogCUJVSUxEX0JVR19PTihLU1lOQ01BUCA8IEk5MTVfTlVNX0VOR0lO
RVMpOwogCiAJdGltZWxpbmUtPmd0ID0gZ3Q7Ci0JdGltZWxpbmUtPnBpbl9jb3VudCA9IDA7CisK
KwlhdG9taWNfc2V0KCZ0aW1lbGluZS0+cGluX2NvdW50LCAwKTsKKwogCXRpbWVsaW5lLT5oYXNf
aW5pdGlhbF9icmVhZGNydW1iID0gIWh3c3A7CiAJdGltZWxpbmUtPmh3c3BfY2FjaGVsaW5lID0g
TlVMTDsKIApAQCAtMjg3LDcgKzI4OSw3IEBAIHZvaWQgaW50ZWxfdGltZWxpbmVzX2luaXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIHZvaWQgaW50ZWxfdGltZWxpbmVfZmluaShz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lKQogewotCUdFTV9CVUdfT04odGltZWxpbmUt
PnBpbl9jb3VudCk7CisJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmdGltZWxpbmUtPnBpbl9jb3Vu
dCkpOwogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnRpbWVsaW5lLT5yZXF1ZXN0cykpOwogCiAJ
aWYgKHRpbWVsaW5lLT5od3NwX2NhY2hlbGluZSkKQEAgLTMyMywzMyArMzI1LDMxIEBAIGludCBp
bnRlbF90aW1lbGluZV9waW4oc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKIHsKIAlpbnQgZXJy
OwogCi0JaWYgKHRsLT5waW5fY291bnQrKykKKwlpZiAoYXRvbWljX2FkZF91bmxlc3MoJnRsLT5w
aW5fY291bnQsIDEsIDApKQogCQlyZXR1cm4gMDsKLQlHRU1fQlVHX09OKCF0bC0+cGluX2NvdW50
KTsKLQlHRU1fQlVHX09OKHRsLT5hY3RpdmVfY291bnQpOwogCiAJZXJyID0gaTkxNV92bWFfcGlu
KHRsLT5od3NwX2dndHQsIDAsIDAsIFBJTl9HTE9CQUwgfCBQSU5fSElHSCk7CiAJaWYgKGVycikK
LQkJZ290byB1bnBpbjsKKwkJcmV0dXJuIGVycjsKIAogCXRsLT5od3NwX29mZnNldCA9CiAJCWk5
MTVfZ2d0dF9vZmZzZXQodGwtPmh3c3BfZ2d0dCkgKwogCQlvZmZzZXRfaW5fcGFnZSh0bC0+aHdz
cF9vZmZzZXQpOwogCiAJY2FjaGVsaW5lX2FjcXVpcmUodGwtPmh3c3BfY2FjaGVsaW5lKTsKKwlp
ZiAoYXRvbWljX2ZldGNoX2luYygmdGwtPnBpbl9jb3VudCkpIHsKKwkJY2FjaGVsaW5lX3JlbGVh
c2UodGwtPmh3c3BfY2FjaGVsaW5lKTsKKwkJX19pOTE1X3ZtYV91bnBpbih0bC0+aHdzcF9nZ3R0
KTsKKwl9CiAKIAlyZXR1cm4gMDsKLQotdW5waW46Ci0JdGwtPnBpbl9jb3VudCA9IDA7Ci0JcmV0
dXJuIGVycjsKIH0KIAogdm9pZCBpbnRlbF90aW1lbGluZV9lbnRlcihzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKnRsKQogewogCXN0cnVjdCBpbnRlbF9ndF90aW1lbGluZXMgKnRpbWVsaW5lcyA9ICZ0
bC0+Z3QtPnRpbWVsaW5lczsKIAotCUdFTV9CVUdfT04oIXRsLT5waW5fY291bnQpOworCUdFTV9C
VUdfT04oIWF0b21pY19yZWFkKCZ0bC0+cGluX2NvdW50KSk7CiAJaWYgKHRsLT5hY3RpdmVfY291
bnQrKykKIAkJcmV0dXJuOwogCUdFTV9CVUdfT04oIXRsLT5hY3RpdmVfY291bnQpOyAvKiBvdmVy
Zmxvdz8gKi8KQEAgLTM4MSw3ICszODEsNyBAQCB2b2lkIGludGVsX3RpbWVsaW5lX2V4aXQoc3Ry
dWN0IGludGVsX3RpbWVsaW5lICp0bCkKIAogc3RhdGljIHUzMiB0aW1lbGluZV9hZHZhbmNlKHN0
cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCiB7Ci0JR0VNX0JVR19PTighdGwtPnBpbl9jb3VudCk7
CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnRsLT5waW5fY291bnQpKTsKIAlHRU1fQlVHX09O
KHRsLT5zZXFubyAmIHRsLT5oYXNfaW5pdGlhbF9icmVhZGNydW1iKTsKIAogCXJldHVybiB0bC0+
c2Vxbm8gKz0gMSArIHRsLT5oYXNfaW5pdGlhbF9icmVhZGNydW1iOwpAQCAtNTMyLDExICs1MzIs
MTAgQEAgaW50IGludGVsX3RpbWVsaW5lX3JlYWRfaHdzcChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpm
cm9tLAogCiB2b2lkIGludGVsX3RpbWVsaW5lX3VucGluKHN0cnVjdCBpbnRlbF90aW1lbGluZSAq
dGwpCiB7Ci0JR0VNX0JVR19PTighdGwtPnBpbl9jb3VudCk7Ci0JaWYgKC0tdGwtPnBpbl9jb3Vu
dCkKKwlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmdGwtPnBpbl9jb3VudCkpOworCWlmICghYXRv
bWljX2RlY19hbmRfdGVzdCgmdGwtPnBpbl9jb3VudCkpCiAJCXJldHVybjsKIAotCUdFTV9CVUdf
T04odGwtPmFjdGl2ZV9jb3VudCk7CiAJY2FjaGVsaW5lX3JlbGVhc2UodGwtPmh3c3BfY2FjaGVs
aW5lKTsKIAogCV9faTkxNV92bWFfdW5waW4odGwtPmh3c3BfZ2d0dCk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZV90eXBlcy5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaAppbmRleCBiODIwZWU3NmI3ZjUu
LjhkZDE0YTJiODc4MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
dGltZWxpbmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1l
bGluZV90eXBlcy5oCkBAIC0yNSw3ICsyNSw3IEBAIHN0cnVjdCBpbnRlbF90aW1lbGluZSB7CiAK
IAlzdHJ1Y3QgbXV0ZXggbXV0ZXg7IC8qIHByb3RlY3RzIHRoZSBmbG93IG9mIHJlcXVlc3RzICov
CiAKLQl1bnNpZ25lZCBpbnQgcGluX2NvdW50OworCWF0b21pY190IHBpbl9jb3VudDsKIAljb25z
dCB1MzIgKmh3c3Bfc2Vxbm87CiAJc3RydWN0IGk5MTVfdm1hICpod3NwX2dndHQ7CiAJdTMyIGh3
c3Bfb2Zmc2V0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdp
bmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKaW5kZXggNDkwZWJk
MTIxZjRjLi5hNDhiMzZkMzFlNjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L21vY2tfZW5naW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUu
YwpAQCAtMzgsMTMgKzM4LDEzIEBAIHN0cnVjdCBtb2NrX3JpbmcgewogCiBzdGF0aWMgdm9pZCBt
b2NrX3RpbWVsaW5lX3BpbihzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQogewotCXRsLT5waW5f
Y291bnQrKzsKKwlhdG9taWNfaW5jKCZ0bC0+cGluX2NvdW50KTsKIH0KIAogc3RhdGljIHZvaWQg
bW9ja190aW1lbGluZV91bnBpbihzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQogewotCUdFTV9C
VUdfT04oIXRsLT5waW5fY291bnQpOwotCXRsLT5waW5fY291bnQtLTsKKwlHRU1fQlVHX09OKCFh
dG9taWNfcmVhZCgmdGwtPnBpbl9jb3VudCkpOworCWF0b21pY19kZWMoJnRsLT5waW5fY291bnQp
OwogfQogCiBzdGF0aWMgc3RydWN0IGludGVsX3JpbmcgKm1vY2tfcmluZyhzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 32CEB82E65
	for <lists+intel-gfx@lfdr.de>; Tue,  6 Aug 2019 11:08:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 932166E345;
	Tue,  6 Aug 2019 09:07:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D413C6E345
 for <intel-gfx@lists.freedesktop.org>; Tue,  6 Aug 2019 09:07:57 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17901460-1500050 
 for multiple; Tue, 06 Aug 2019 10:05:36 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  6 Aug 2019 10:05:16 +0100
Message-Id: <20190806090535.14807-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190806090535.14807-1-chris@chris-wilson.co.uk>
References: <20190806090535.14807-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 03/22] drm/i915: Defer final intel_wakeref_put
 to process context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2UgbmVlZCB0byBhY3F1aXJlIGEgbXV0ZXggdG8gc2VyaWFsaXNlIHRoZSBmaW5hbAppbnRl
bF93YWtlcmVmX3B1dCwgd2UgbmVlZCB0byBlbnN1cmUgdGhhdCB3ZSBhcmUgaW4gcHJvY2VzcyBj
b250ZXh0IGF0CnRoYXQgdGltZS4gSG93ZXZlciwgd2Ugd2FudCB0byBhbGxvdyBvcGVyYXRpb24g
b24gdGhlIGludGVsX3dha2VyZWYgZnJvbQppbnNpZGUgdGltZXIgYW5kIG90aGVyIGhhcmRpcnEg
Y29udGV4dCwgd2hpY2ggbWVhbnMgdGhhdCBuZWVkIHRvIGRlZmVyCnRoYXQgZmluYWwgcHV0IHRv
IGEgd29ya3F1ZXVlLgoKSW5zaWRlIHRoZSBmaW5hbCB3YWtlcmVmIHB1dHMsIHdlIGFyZSBzYWZl
IHRvIG9wZXJhdGUgaW4gYW55IGNvbnRleHQsIGFzCndlIGFyZSBzaW1wbHkgbWFya2luZyB1cCB0
aGUgSFcgYW5kIHN0YXRlIHRyYWNraW5nIGZvciB0aGUgcG90ZW50aWFsCnNsZWVwLiBJdCdzIG9u
bHkgdGhlIHNlcmlhbGlzYXRpb24gd2l0aCB0aGUgcG90ZW50aWFsIHNsZWVwaW5nIGdldHRpbmcK
dGhhdCByZXF1aXJlcyBjYXJlZnVsIHdhaXQgYXZvaWRhbmNlLiBUaGlzIGFsbG93cyB1cyB0byBy
ZXRhaW4gdGhlCmltbWVkaWF0ZSBwcm9jZXNzaW5nIGFzIGJlZm9yZSAod2Ugb25seSBuZWVkIHRv
IHNsZWVwIG92ZXIgdGhlIHNhbWUKcmFjZXMgYXMgdGhlIGN1cnJlbnQgbXV0ZXhfbG9jaykuCgp2
MjogQWRkIGEgc2VsZnRlc3QgdG8gZW5zdXJlIHdlIGV4ZXJjaXNlIHRoZSBjb2RlIHdoaWxlIGxv
Y2tkZXAgd2F0Y2hlcy4KdjM6IFRoYXQgdGVzdCB3YXMgZXh0cmVtZWx5IGxvdWQgYW5kIGNvbXBs
YWluZWQgYWJvdXQgbWFueSB0aGluZ3MhCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNr
dG9wLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTExMjk1ClJlZmVyZW5jZXM6IGh0dHBzOi8vYnVncy5m
cmVlZGVza3RvcC5vcmcvc2hvd19idWcuY2dpP2lkPTExMTI0NQpGaXhlczogMTgzOTg5MDRjYTll
ICgiZHJtL2k5MTU6IE9ubHkgcmVjb3ZlciBhY3RpdmUgZW5naW5lcyIpCkZpeGVzOiA1MWZiZDhk
ZTg3ZGMgKCJkcm0vaTkxNS9wbXU6IEF0b21pY2FsbHkgYWNxdWlyZSB0aGUgZ3RfcG0gd2FrZXJl
ZiIpClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IE1pa2Eg
S3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8IDEzICstLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgIDEgKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgICAgIHwgMzggKysrLS0tLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaCAgICAgfCAxOCArKy0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jICAgICAgICAgfCAyOCArKystLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oICAgICAgICAgfCAyMiArKysrLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgIHwgIDQgKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jICAgICB8IDI4ICsrKysrKysKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5oICAgICB8IDE0ICsrKysKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9wbS5jICB8IDgzICsrKysrKysrKysr
KysrKysrKysKIC4uLi9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYyB8
ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAg
NCArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAyNiAr
LS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYyAgICAgICAgICB8IDgy
ICsrKysrKysrKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5o
ICAgICAgICAgIHwgNjIgKysrKysrKysrLS0tLS0KIC4uLi9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9saXZlX3NlbGZ0ZXN0cy5oICB8ICA1ICstCiAxNiBmaWxlcyBjaGFuZ2VkLCAzMDEgaW5zZXJ0
aW9ucygrKSwgMTMxIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lLmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfcG0uYwoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggNzI5MjI3MDNhZjQ5Li4xN2UzNjE4MjQxYzUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC0xMzAsNyArMTMwLDkg
QEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoc3RydWN0IGludGVs
X2d0ICpndCkKIAkJfQogCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3JlcXVlc3RzKGd0LT5pOTE1KSAm
JiByZXN1bHQpOwogCi0JR0VNX0JVR19PTihndC0+YXdha2UpOworCWlmIChpbnRlbF9ndF9wbV93
YWl0X2Zvcl9pZGxlKGd0KSkKKwkJcmVzdWx0ID0gZmFsc2U7CisKIAlyZXR1cm4gcmVzdWx0Owog
fQogCkBAIC0xNjEsMTMgKzE2Myw2IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKLQkvKgotCSAqIEFzc2VydCB0aGF0IHdlIHN1Y2Nlc3NmdWxseSBmbHVzaGVkIGFs
bCB0aGUgd29yayBhbmQKLQkgKiByZXNldCB0aGUgR1BVIGJhY2sgdG8gaXRzIGlkbGUsIGxvdyBw
b3dlciBzdGF0ZS4KLQkgKi8KLQlHRU1fQlVHX09OKGk5MTUtPmd0LmF3YWtlKTsKLQlmbHVzaF93
b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsKLQogCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygm
aTkxNS0+Z3QuaGFuZ2NoZWNrLndvcmspOwogCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0
cyhpOTE1KTsKQEAgLTI0NCw4ICsyMzksNiBAQCB2b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlHRU1fVFJBQ0UoIlxuIik7CiAKLQlXQVJOX09O
KGk5MTUtPmd0LmF3YWtlKTsKLQogCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
Y3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IGQw
YmVmZDZjMDIzYS4uNTc0ODA3OWViY2UyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfY3MuYwpAQCAtMTU5Myw1ICsxNTkzLDYgQEAgaW50ZWxfZW5naW5lX2ZpbmRfYWN0
aXZlX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogfQogCiAjaWYgSVNf
RU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAic2VsZnRlc3RfZW5n
aW5lLmMiCiAjaW5jbHVkZSAic2VsZnRlc3RfZW5naW5lX2NzLmMiCiAjZW5kaWYKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXggMDMzNjIwNDk4OGQ2Li42YjE1
ZTMzMzVkZDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCkBA
IC0zNywyOCArMzcsNiBAQCBzdGF0aWMgaW50IF9fZW5naW5lX3VucGFyayhzdHJ1Y3QgaW50ZWxf
d2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZW5naW5lX3BtX2dldChz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50ZWxfd2FrZXJlZl9nZXQoJmVu
Z2luZS0+aTkxNS0+cnVudGltZV9wbSwgJmVuZ2luZS0+d2FrZXJlZiwgX19lbmdpbmVfdW5wYXJr
KTsKLX0KLQotdm9pZCBpbnRlbF9lbmdpbmVfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCi17Ci0JLyoKLQkgKiBXZSBhcmUgY29tbWl0dGVkIG5vdyB0byBwYXJraW5nIHRoaXMg
ZW5naW5lLCBtYWtlIHN1cmUgdGhlcmUKLQkgKiB3aWxsIGJlIG5vIG1vcmUgaW50ZXJydXB0cyBh
cnJpdmluZyBsYXRlciBhbmQgdGhlIGVuZ2luZQotCSAqIGlzIHRydWx5IGlkbGUuCi0JICovCi0J
aWYgKHdhaXRfZm9yKGludGVsX2VuZ2luZV9pc19pZGxlKGVuZ2luZSksIDEwKSkgewotCQlzdHJ1
Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9kZWJ1Z19wcmludGVyKF9fZnVuY19fKTsKLQotCQlkZXZf
ZXJyKGVuZ2luZS0+aTkxNS0+ZHJtLmRldiwKLQkJCSIlcyBpcyBub3QgaWRsZSBiZWZvcmUgcGFy
a2luZ1xuIiwKLQkJCWVuZ2luZS0+bmFtZSk7Ci0JCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwg
JnAsIE5VTEwpOwotCX0KLX0KLQogc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKQEAgLTEzNiwxMiArMTE0LDE4IEBAIHN0YXRpYyBpbnQgX19lbmdpbmVfcGFyayhzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZW5naW5l
X3BtX3B1dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50ZWxfd2FrZXJl
Zl9wdXQoJmVuZ2luZS0+aTkxNS0+cnVudGltZV9wbSwgJmVuZ2luZS0+d2FrZXJlZiwgX19lbmdp
bmVfcGFyayk7Ci19CitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3dha2VyZWZfb3BzIHdmX29w
cyA9IHsKKwkuZ2V0ID0gX19lbmdpbmVfdW5wYXJrLAorCS5wdXQgPSBfX2VuZ2luZV9wYXJrLAor
fTsKIAogdm9pZCBpbnRlbF9lbmdpbmVfaW5pdF9fcG0oc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogewotCWludGVsX3dha2VyZWZfaW5pdCgmZW5naW5lLT53YWtlcmVmKTsKKwlzdHJ1
Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtID0gJmVuZ2luZS0+aTkxNS0+cnVudGltZV9wbTsKKwor
CWludGVsX3dha2VyZWZfaW5pdCgmZW5naW5lLT53YWtlcmVmLCBycG0sICZ3Zl9vcHMpOwogfQor
CisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAic2Vs
ZnRlc3RfZW5naW5lX3BtLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX3BtLmgKaW5kZXggMDE1YWM3MmQ3YWQwLi43MzljNTBmZWZjZWYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCkBAIC0xMCwyNCArMTAsMjYgQEAKICNp
bmNsdWRlICJpbnRlbF9lbmdpbmVfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgi
CiAKLXN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwotCi12b2lkIGludGVsX2VuZ2luZV9wbV9nZXQo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKLXZvaWQgaW50ZWxfZW5naW5lX3BtX3B1
dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwotCiBzdGF0aWMgaW5saW5lIGJvb2wK
IGludGVsX2VuZ2luZV9wbV9pc19hd2FrZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfaXNfYWN0aXZlKCZlbmdpbmUtPndha2Vy
ZWYpOwogfQogCi1zdGF0aWMgaW5saW5lIGJvb2wKLWludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdh
a2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQorc3RhdGljIGlubGluZSB2b2lkIGlu
dGVsX2VuZ2luZV9wbV9nZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWlu
dGVsX3dha2VyZWZfZ2V0KCZlbmdpbmUtPndha2VyZWYpOworfQorCitzdGF0aWMgaW5saW5lIGJv
b2wgaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZSgmZW5naW5lLT53
YWtlcmVmKTsKIH0KIAotdm9pZCBpbnRlbF9lbmdpbmVfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpOworc3RhdGljIGlubGluZSB2b2lkIGludGVsX2VuZ2luZV9wbV9wdXQoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWludGVsX3dha2VyZWZfcHV0KCZlbmdp
bmUtPndha2VyZWYpOworfQogCiB2b2lkIGludGVsX2VuZ2luZV9pbml0X19wbShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ndF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0u
YwppbmRleCA2Yzg5NzAyNzFhN2YuLjEzNjNlMDY5ZWM4MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF9wbS5jCkBAIC0xNyw3ICsxNyw3IEBAIHN0YXRpYyB2b2lkIHBtX25vdGlmeShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHN0YXRlKQogCWJsb2NraW5nX25vdGlm
aWVyX2NhbGxfY2hhaW4oJmk5MTUtPmd0LnBtX25vdGlmaWNhdGlvbnMsIHN0YXRlLCBpOTE1KTsK
IH0KIAotc3RhdGljIGludCBpbnRlbF9ndF91bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndm
KQorc3RhdGljIGludCBfX2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CiAJ
c3RydWN0IGludGVsX2d0ICpndCA9IGNvbnRhaW5lcl9vZih3ZiwgdHlwZW9mKCpndCksIHdha2Vy
ZWYpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5MTU7CkBAIC01Mywx
NCArNTMsNyBAQCBzdGF0aWMgaW50IGludGVsX2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJl
ZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSA9ICZndC0+aTkxNS0+
cnVudGltZV9wbTsKLQotCWludGVsX3dha2VyZWZfZ2V0KHJwbSwgJmd0LT53YWtlcmVmLCBpbnRl
bF9ndF91bnBhcmspOwotfQotCi1zdGF0aWMgaW50IGludGVsX2d0X3Bhcmsoc3RydWN0IGludGVs
X3dha2VyZWYgKndmKQorc3RhdGljIGludCBfX2d0X3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVyX29m
KHdmLCB0eXBlb2YoKmk5MTUpLCBndC53YWtlcmVmKTsKQEAgLTc0LDIyICs2NywyNSBAQCBzdGF0
aWMgaW50IGludGVsX2d0X3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCWlmIChJTlRF
TF9HRU4oaTkxNSkgPj0gNikKIAkJZ2VuNl9ycHNfaWRsZShpOTE1KTsKIAorCS8qIEV2ZXJ5dGhp
bmcgc3dpdGNoZWQgb2ZmLCBmbHVzaCBhbnkgcmVzaWR1YWwgaW50ZXJydXB0IGp1c3QgaW4gY2Fz
ZSAqLworCWludGVsX3N5bmNocm9uaXplX2lycShpOTE1KTsKKwogCUdFTV9CVUdfT04oIXdha2Vy
ZWYpOwogCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsIFBPV0VSX0RPTUFJTl9HVF9JUlEs
IHdha2VyZWYpOwogCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZ3RfcG1fcHV0KHN0cnVj
dCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSA9ICZndC0+
aTkxNS0+cnVudGltZV9wbTsKLQotCWludGVsX3dha2VyZWZfcHV0KHJwbSwgJmd0LT53YWtlcmVm
LCBpbnRlbF9ndF9wYXJrKTsKLX0KK3N0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJlZl9v
cHMgd2Zfb3BzID0geworCS5nZXQgPSBfX2d0X3VucGFyaywKKwkucHV0ID0gX19ndF9wYXJrLAor
CS5mbGFncyA9IElOVEVMX1dBS0VSRUZfUFVUX0FTWU5DLAorfTsKIAogdm9pZCBpbnRlbF9ndF9w
bV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7Ci0JaW50ZWxfd2FrZXJlZl9pbml0
KCZndC0+d2FrZXJlZik7CisJaW50ZWxfd2FrZXJlZl9pbml0KCZndC0+d2FrZXJlZiwgJmd0LT5p
OTE1LT5ydW50aW1lX3BtLCAmd2Zfb3BzKTsKKwogCUJMT0NLSU5HX0lOSVRfTk9USUZJRVJfSEVB
RCgmZ3QtPnBtX25vdGlmaWNhdGlvbnMpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Z3RfcG0uaAppbmRleCBlOGExOGQ0YjI3YzkuLjU3NjMzZjUzOGRkYiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndF9wbS5oCkBAIC0xNywxNCArMTcsMzIgQEAgZW51bSB7CiAJSU5URUxf
R1RfUEFSSywKIH07CiAKLXZvaWQgaW50ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
Owotdm9pZCBpbnRlbF9ndF9wbV9wdXQoc3RydWN0IGludGVsX2d0ICpndCk7CitzdGF0aWMgaW5s
aW5lIGJvb2wKK2ludGVsX2d0X3BtX2lzX2F3YWtlKGNvbnN0IHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
Cit7CisJcmV0dXJuIGludGVsX3dha2VyZWZfaXNfYWN0aXZlKCZndC0+d2FrZXJlZik7Cit9CisK
K3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9ndF9wbV9nZXQoc3RydWN0IGludGVsX2d0ICpndCkK
K3sKKwlpbnRlbF93YWtlcmVmX2dldCgmZ3QtPndha2VyZWYpOworfQogCiBzdGF0aWMgaW5saW5l
IGJvb2wgaW50ZWxfZ3RfcG1fZ2V0X2lmX2F3YWtlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJ
cmV0dXJuIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZSgmZ3QtPndha2VyZWYpOwogfQogCitz
dGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZ3RfcG1fcHV0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7
CisJaW50ZWxfd2FrZXJlZl9wdXQoJmd0LT53YWtlcmVmKTsKK30KKworc3RhdGljIGlubGluZSBp
bnQgaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXJl
dHVybiBpbnRlbF93YWtlcmVmX3dhaXRfZm9yX2lkbGUoJmd0LT53YWtlcmVmKTsKK30KKwogdm9p
ZCBpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogCiB2b2lkIGlu
dGVsX2d0X3Nhbml0aXplKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgZm9yY2UpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCAyMzJmNDBmY2I0OTAuLjFhMDExNjc1MWQxOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTEzOSw2ICsxMzksNyBAQAogI2lu
Y2x1ZGUgImk5MTVfdmdwdS5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1
ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJpbnRl
bF9scmNfcmVnLmgiCiAjaW5jbHVkZSAiaW50ZWxfbW9jcy5oIgogI2luY2x1ZGUgImludGVsX3Jl
c2V0LmgiCkBAIC01NTYsNiArNTU3LDcgQEAgZXhlY2xpc3RzX3NjaGVkdWxlX2luKHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLCBpbnQgaWR4KQogCQlpbnRlbF9jb250ZXh0X2dldChjZSk7CiAJCWNl
LT5pbmZsaWdodCA9IHJxLT5lbmdpbmU7CiAKKwkJaW50ZWxfZ3RfcG1fZ2V0KGNlLT5pbmZsaWdo
dC0+Z3QpOwogCQlleGVjbGlzdHNfY29udGV4dF9zdGF0dXNfY2hhbmdlKHJxLCBJTlRFTF9DT05U
RVhUX1NDSEVEVUxFX0lOKTsKIAkJaW50ZWxfZW5naW5lX2NvbnRleHRfaW4oY2UtPmluZmxpZ2h0
KTsKIAl9CkBAIC01ODgsNiArNTkwLDcgQEAgZXhlY2xpc3RzX3NjaGVkdWxlX291dChzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIAlpZiAoIWludGVsX2NvbnRleHRfaW5mbGlnaHRfY291bnQoY2Up
KSB7CiAJCWludGVsX2VuZ2luZV9jb250ZXh0X291dChjZS0+aW5mbGlnaHQpOwogCQlleGVjbGlz
dHNfY29udGV4dF9zdGF0dXNfY2hhbmdlKHJxLCBJTlRFTF9DT05URVhUX1NDSEVEVUxFX09VVCk7
CisJCWludGVsX2d0X3BtX3B1dChjZS0+aW5mbGlnaHQtPmd0KTsKIAogCQkvKgogCQkgKiBJZiB0
aGlzIGlzIHBhcnQgb2YgYSB2aXJ0dWFsIGVuZ2luZSwgaXRzIG5leHQgcmVxdWVzdCBtYXkKQEAg
LTI3MTksNyArMjcyMiw2IEBAIHN0YXRpYyB1MzIgKmdlbjhfZW1pdF9maW5pX2JyZWFkY3J1bWJf
cmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAqY3MpCiBzdGF0aWMgdm9pZCBl
eGVjbGlzdHNfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJZGVsX3Rp
bWVyX3N5bmMoJmVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyKTsKLQlpbnRlbF9lbmdpbmVfcGFyayhl
bmdpbmUpOwogfQogCiB2b2lkIGludGVsX2V4ZWNsaXN0c19zZXRfZGVmYXVsdF9zdWJtaXNzaW9u
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfZW5naW5lLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAw
Li5mNjViMTE4ZTI2MWQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9lbmdpbmUuYwpAQCAtMCwwICsxLDI4IEBACisvKgorICogU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjAKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOCBJbnRlbCBDb3Jw
b3JhdGlvbgorICovCisKKyNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSAic2Vs
ZnRlc3RfZW5naW5lLmgiCisKK2ludCBpbnRlbF9lbmdpbmVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGludCAoKiBjb25zdCB0ZXN0c1td
KShzdHJ1Y3QgaW50ZWxfZ3QgKikgPSB7CisJCWxpdmVfZW5naW5lX3BtX3NlbGZ0ZXN0cywKKwkJ
TlVMTCwKKwl9OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CisJdHlwZW9mKCp0
ZXN0cykgKmZuOworCisJZm9yIChmbiA9IHRlc3RzOyAqZm47IGZuKyspIHsKKwkJaW50IGVycjsK
KworCQllcnIgPSAoKmZuKShndCk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0KKwor
CXJldHVybiAwOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfZW5naW5lLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmUuaApu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmFiMzJkMDllYzVhMQotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5o
CkBAIC0wLDAgKzEsMTQgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIu
MAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lm
bmRlZiBTRUxGVEVTVF9FTkdJTkVfSAorI2RlZmluZSBTRUxGVEVTVF9FTkdJTkVfSAorCitzdHJ1
Y3QgaW50ZWxfZ3Q7CisKK2ludCBsaXZlX2VuZ2luZV9wbV9zZWxmdGVzdHMoc3RydWN0IGludGVs
X2d0ICpndCk7CisKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfZW5naW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9l
bmdpbmVfcG0uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjc1YzE5
NzYxMjcwNQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2VuZ2luZV9wbS5jCkBAIC0wLDAgKzEsODMgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRl
bnRpZmllcjogR1BMLTIuMAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE4IEludGVsIENvcnBvcmF0
aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKKyNpbmNsdWRlICJzZWxmdGVz
dF9lbmdpbmUuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X2F0b21pYy5oIgorCitzdGF0aWMg
aW50IGxpdmVfZW5naW5lX3BtKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
YXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2lu
ZV9pZCBpZDsKKworCS8qCisJICogQ2hlY2sgd2UgY2FuIGNhbGwgaW50ZWxfZW5naW5lX3BtX3B1
dCBmcm9tIGFueSBjb250ZXh0LiBObworCSAqIGZhaWx1cmVzIGFyZSByZXBvcnRlZCBkaXJlY3Rs
eSwgYnV0IGlmIHdlIG1lc3MgdXAgbG9ja2RlcCBzaG91bGQKKwkgKiB0ZWxsIHVzLgorCSAqLwor
CWlmIChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KSkgeworCQlwcl9lcnIoIlVuYWJsZSB0
byBmbHVzaCBHVCBwbSBiZWZvcmUgdGVzdFxuIik7CisJCXJldHVybiAtRUJVU1k7CisJfQorCisJ
R0VNX0JVR19PTihpbnRlbF9ndF9wbV9pc19hd2FrZShndCkpOworCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LT5pOTE1LCBpZCkgeworCQljb25zdCB0eXBlb2YoKmlndF9hdG9taWNfcGhhc2Vz
KSAqcDsKKworCQlmb3IgKHAgPSBpZ3RfYXRvbWljX3BoYXNlczsgcC0+bmFtZTsgcCsrKSB7CisJ
CQkvKgorCQkJICogQWNxdWlzaXRpb24gaXMgYWx3YXlzIHN5bmNocm9ub3VzLCBleGNlcHQgaWYg
d2UKKwkJCSAqIGtub3cgdGhhdCB0aGUgZW5naW5lIGlzIGFscmVhZHkgYXdhbGUsIGluIHdoaWNo
CisJCQkgKiB3ZSBzaG91bGQgdXNlIGludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdha2UoKSB0bwor
CQkJICogYXRvbWljYWxseSBncmFiIHRoZSB3YWtlcmVmLgorCQkJICoKKwkJCSAqIEluIHByYWN0
aWNlLAorCQkJICogICAgaW50ZWxfZW5naW5lX3BtX2dldCgpOworCQkJICogICAgaW50ZWxfZW5n
aW5lX3BtX3B1dCgpOworCQkJICogb2NjdXJzIGluIG9uZSB0aHJlYWQsIHdoaWxlIHNpbXVsdGFu
ZW91c2x5CisJCQkgKiAgICBpbnRlbF9lbmdpbmVfcG1fZ2V0X2lmX2F3YWtlKCk7CisJCQkgKiAg
ICBpbnRlbF9lbmdpbmVfcG1fcHV0KCk7CisJCQkgKiBvY2N1cnMgaW4gYXRvbWljIGNvbnRleHQg
aW4gYW5vdGhlci4KKwkJCSAqLworCQkJR0VNX0JVR19PTihpbnRlbF9lbmdpbmVfcG1faXNfYXdh
a2UoZW5naW5lKSk7CisJCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CisKKwkJCXAtPmNy
aXRpY2FsX3NlY3Rpb25fYmVnaW4oKTsKKwkJCWlmICghaW50ZWxfZW5naW5lX3BtX2dldF9pZl9h
d2FrZShlbmdpbmUpKQorCQkJCXByX2VycigiaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZSgl
cykgZmFpbGVkIHVuZGVyICVzXG4iLAorCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIHAtPm5hbWUp
OworCQkJZWxzZQorCQkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJCWludGVsX2Vu
Z2luZV9wbV9wdXQoZW5naW5lKTsKKwkJCXAtPmNyaXRpY2FsX3NlY3Rpb25fZW5kKCk7CisKKwkJ
CS8qIGVuZ2luZSB3YWtlcmVmIGlzIHN5bmMgKGluc3RhbnQpICovCisJCQlpZiAoaW50ZWxfZW5n
aW5lX3BtX2lzX2F3YWtlKGVuZ2luZSkpIHsKKwkJCQlwcl9lcnIoIiVzIGlzIHN0aWxsIGF3YWtl
IGFmdGVyIGZsdXNoaW5nIHBtXG4iLAorCQkJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQkJCXJl
dHVybiAtRUlOVkFMOworCQkJfQorCisJCQkvKiBndCB3YWtlcmVmIGlzIGFzeW5jIChkZWZlcnJl
ZCB0byB3b3JrcXVldWUpICovCisJCQlpZiAoaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCkp
IHsKKwkJCQlwcl9lcnIoIkdUIGZhaWxlZCB0byBpZGxlXG4iKTsKKwkJCQlyZXR1cm4gLUVJTlZB
TDsKKwkJCX0KKwkJfQorCX0KKworCXJldHVybiAwOworfQorCitpbnQgbGl2ZV9lbmdpbmVfcG1f
c2VsZnRlc3RzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RhdGljIGNvbnN0IHN0cnVjdCBp
OTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZlX2VuZ2luZV9wbSksCisJfTsK
KworCXJldHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCBndCk7Cit9CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYwppbmRleCBh
NzhiZDk5YmM2Y2IuLmM5MTE5YjkwZDZhYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCkBAIC0yOSw2ICsyOSw3IEBACiAjaW5jbHVk
ZSAiZ3QvaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgog
I2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKICNp
bmNsdWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3VjX3N1Ym1pc3Np
b24uaCIKIApAQCAtNTM3LDYgKzUzOCw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpz
Y2hlZHVsZV9pbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgaW50IGlkeCkKIAlpZiAoIXJxLT5o
d19jb250ZXh0LT5pbmZsaWdodCkKIAkJcnEtPmh3X2NvbnRleHQtPmluZmxpZ2h0ID0gcnEtPmVu
Z2luZTsKIAlpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2luYyhycS0+aHdfY29udGV4dCk7CisJaW50
ZWxfZ3RfcG1fZ2V0KHJxLT5lbmdpbmUtPmd0KTsKIAogCXJldHVybiBpOTE1X3JlcXVlc3RfZ2V0
KHJxKTsKIH0KQEAgLTU0OSw2ICs1NTEsNyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZV9vdXQoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaWYgKCFpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2NvdW50
KHJxLT5od19jb250ZXh0KSkKIAkJcnEtPmh3X2NvbnRleHQtPmluZmxpZ2h0ID0gTlVMTDsKIAor
CWludGVsX2d0X3BtX3B1dChycS0+ZW5naW5lLT5ndCk7CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7
CiB9CiAKQEAgLTEwNzYsNyArMTA3OSw2IEBAIHN0YXRpYyB2b2lkIGd1Y19pbnRlcnJ1cHRzX3Jl
bGVhc2Uoc3RydWN0IGludGVsX2d0ICpndCkKIAogc3RhdGljIHZvaWQgZ3VjX3N1Ym1pc3Npb25f
cGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0JaW50ZWxfZW5naW5lX3Bh
cmsoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfdW5waW5fYnJlYWRjcnVtYnNfaXJxKGVuZ2luZSk7
CiAJZW5naW5lLT5mbGFncyAmPSB+STkxNV9FTkdJTkVfTkVFRFNfQlJFQURDUlVNQl9UQVNLTEVU
OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCA2M2I1OTlmNTg0ZGIuLjY4
YTZiMDAyYzliYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2Zz
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM5LDYgKzM5
LDcgQEAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX3Bzci5oIgogCiAjaW5jbHVkZSAiZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgogI2luY2x1ZGUg
Imd0L2ludGVsX3Jlc2V0LmgiCiAjaW5jbHVkZSAiZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24u
aCIKIApAQCAtMzY2NCw2ICszNjY1LDkgQEAgaTkxNV9kcm9wX2NhY2hlc19zZXQodm9pZCAqZGF0
YSwgdTY0IHZhbCkKIAkJCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwogCiAJCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKKwkJaWYgKHJldCA9PSAwICYmIHZhbCAm
IERST1BfSURMRSkKKwkJCXJldCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoJmk5MTUtPmd0
KTsKIAl9CiAKIAlpZiAodmFsICYgRFJPUF9SRVNFVF9BQ1RJVkUgJiYgaW50ZWxfZ3RfdGVybWlu
YWxseV93ZWRnZWQoJmk5MTUtPmd0KSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDdlZmZm
MTRiOTEzNy4uZjY3MTk3MzM2ZWU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTg5NCwx
OSArODk0LDYgQEAgdm9pZCBpOTE1X2dlbV9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJfQogfQogCi1zdGF0aWMgaW50IHdhaXRfZm9yX2VuZ2luZXMoc3Ry
dWN0IGludGVsX2d0ICpndCkKLXsKLQlpZiAod2FpdF9mb3IoaW50ZWxfZW5naW5lc19hcmVfaWRs
ZShndCksIEk5MTVfSURMRV9FTkdJTkVTX1RJTUVPVVQpKSB7Ci0JCWRldl9lcnIoZ3QtPmk5MTUt
PmRybS5kZXYsCi0JCQkiRmFpbGVkIHRvIGlkbGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdlZCFc
biIpOwotCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKLQkJ
cmV0dXJuIC1FSU87Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyBsb25nCiB3YWl0X2Zv
cl90aW1lbGluZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgIHVuc2lnbmVk
IGludCBmbGFncywgbG9uZyB0aW1lb3V0KQpAQCAtOTU0LDI3ICs5NDEsMjAgQEAgaW50IGk5MTVf
Z2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICB1
bnNpZ25lZCBpbnQgZmxhZ3MsIGxvbmcgdGltZW91dCkKIHsKIAkvKiBJZiB0aGUgZGV2aWNlIGlz
IGFzbGVlcCwgd2UgaGF2ZSBubyByZXF1ZXN0cyBvdXRzdGFuZGluZyAqLwotCWlmICghUkVBRF9P
TkNFKGk5MTUtPmd0LmF3YWtlKSkKKwlpZiAoIWludGVsX2d0X3BtX2lzX2F3YWtlKCZpOTE1LT5n
dCkpCiAJCXJldHVybiAwOwogCi0JR0VNX1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVs
ZCVzLCBhd2FrZT89JXNcbiIsCisJR0VNX1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVs
ZCVzXG4iLAogCQkgIGZsYWdzLCBmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQgPyAibG9ja2VkIiA6
ICJ1bmxvY2tlZCIsCi0JCSAgdGltZW91dCwgdGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9V
VCA/ICIgKGZvcmV2ZXIpIiA6ICIiLAotCQkgIHllc25vKGk5MTUtPmd0LmF3YWtlKSk7CisJCSAg
dGltZW91dCwgdGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9VVCA/ICIgKGZvcmV2ZXIpIiA6
ICIiKTsKIAogCXRpbWVvdXQgPSB3YWl0X2Zvcl90aW1lbGluZXMoaTkxNSwgZmxhZ3MsIHRpbWVv
dXQpOwogCWlmICh0aW1lb3V0IDwgMCkKIAkJcmV0dXJuIHRpbWVvdXQ7CiAKIAlpZiAoZmxhZ3Mg
JiBJOTE1X1dBSVRfTE9DS0VEKSB7Ci0JCWludCBlcnI7Ci0KIAkJbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQkJZXJyID0gd2FpdF9mb3JfZW5naW5lcygm
aTkxNS0+Z3QpOwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQogCQlpOTE1X3JldGlyZV9y
ZXF1ZXN0cyhpOTE1KTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3dha2VyZWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwppbmRl
eCAwNmJkOGIyMTVjYzIuLmQ0NDQzZTgxYzFjOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfd2FrZXJlZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dh
a2VyZWYuYwpAQCAtNCwyNSArNCwyNSBAQAogICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29y
cG9yYXRpb24KICAqLwogCisjaW5jbHVkZSA8bGludXgvd2FpdF9iaXQuaD4KKwogI2luY2x1ZGUg
ImludGVsX3J1bnRpbWVfcG0uaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgiCiAKLXN0YXRp
YyB2b2lkIHJwbV9nZXQoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwgc3RydWN0IGludGVs
X3dha2VyZWYgKndmKQorc3RhdGljIHZvaWQgcnBtX2dldChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAq
d2YpCiB7Ci0Jd2YtPndha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChycG0pOworCXdmLT53
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQod2YtPnJwbSk7CiB9CiAKLXN0YXRpYyB2b2lk
IHJwbV9wdXQoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwgc3RydWN0IGludGVsX3dha2Vy
ZWYgKndmKQorc3RhdGljIHZvaWQgcnBtX3B1dChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7
CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWYgPSBmZXRjaF9hbmRfemVybygmd2YtPndha2VyZWYp
OwogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQocnBtLCB3YWtlcmVmKTsKKwlpbnRlbF9ydW50aW1l
X3BtX3B1dCh3Zi0+cnBtLCB3YWtlcmVmKTsKIAlJTlRFTF9XQUtFUkVGX0JVR19PTighd2FrZXJl
Zik7CiB9CiAKLWludCBfX2ludGVsX3dha2VyZWZfZ2V0X2ZpcnN0KHN0cnVjdCBpbnRlbF9ydW50
aW1lX3BtICpycG0sCi0JCQkgICAgICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCQkgICAg
ICBpbnQgKCpmbikoc3RydWN0IGludGVsX3dha2VyZWYgKndmKSkKK2ludCBfX2ludGVsX3dha2Vy
ZWZfZ2V0X2ZpcnN0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIHsKIAkvKgogCSAqIFRyZWF0
IGdldC9wdXQgYXMgZGlmZmVyZW50IHN1YmNsYXNzZXMsIGFzIHdlIG1heSBuZWVkIHRvIHJ1bgpA
QCAtMzQsMTEgKzM0LDExIEBAIGludCBfX2ludGVsX3dha2VyZWZfZ2V0X2ZpcnN0KHN0cnVjdCBp
bnRlbF9ydW50aW1lX3BtICpycG0sCiAJaWYgKCFhdG9taWNfcmVhZCgmd2YtPmNvdW50KSkgewog
CQlpbnQgZXJyOwogCi0JCXJwbV9nZXQocnBtLCB3Zik7CisJCXJwbV9nZXQod2YpOwogCi0JCWVy
ciA9IGZuKHdmKTsKKwkJZXJyID0gd2YtPm9wcy0+Z2V0KHdmKTsKIAkJaWYgKHVubGlrZWx5KGVy
cikpIHsKLQkJCXJwbV9wdXQocnBtLCB3Zik7CisJCQlycG1fcHV0KHdmKTsKIAkJCW11dGV4X3Vu
bG9jaygmd2YtPm11dGV4KTsKIAkJCXJldHVybiBlcnI7CiAJCX0KQEAgLTUyLDI3ICs1Miw2NyBA
QCBpbnQgX19pbnRlbF93YWtlcmVmX2dldF9maXJzdChzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAq
cnBtLAogCXJldHVybiAwOwogfQogCi1pbnQgX19pbnRlbF93YWtlcmVmX3B1dF9sYXN0KHN0cnVj
dCBpbnRlbF9ydW50aW1lX3BtICpycG0sCi0JCQkgICAgIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3
ZiwKLQkJCSAgICAgaW50ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikpCitzdGF0aWMg
dm9pZCBfX19faW50ZWxfd2FrZXJlZl9wdXRfbGFzdChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2Yp
CiB7Ci0JaW50IGVycjsKKwlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJndmLT5jb3VudCkpCisJ
CWdvdG8gdW5sb2NrOworCisJaWYgKGxpa2VseSghd2YtPm9wcy0+cHV0KHdmKSkpIHsKKwkJcnBt
X3B1dCh3Zik7CisJCXdha2VfdXBfdmFyKCZ3Zi0+d2FrZXJlZik7CisJfSBlbHNlIHsKKwkJLyog
b3BzLT5wdXQoKSBtdXN0IHNjaGVkdWxlIGl0cyBvd24gcmVsZWFzZSBvbiBkZWZlcnJhbCAqLwor
CQlhdG9taWNfc2V0X3JlbGVhc2UoJndmLT5jb3VudCwgMSk7CisJfQogCi0JZXJyID0gZm4od2Yp
OwotCWlmIChsaWtlbHkoIWVycikpCi0JCXJwbV9wdXQocnBtLCB3Zik7Ci0JZWxzZQotCQlhdG9t
aWNfaW5jKCZ3Zi0+Y291bnQpOwordW5sb2NrOgogCW11dGV4X3VubG9jaygmd2YtPm11dGV4KTsK
K30KKwordm9pZCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQoreworCUlOVEVMX1dBS0VSRUZfQlVHX09OKHdvcmtfcGVuZGluZygmd2YtPndvcmspKTsK
IAotCXJldHVybiBlcnI7CisJLyogQXNzdW1lIHdlIGFyZSBub3QgaW4gcHJvY2VzcyBjb250ZXh0
IGFuZCBzbyBjYW5ub3Qgc2xlZXAuICovCisJaWYgKHdmLT5vcHMtPmZsYWdzICYgSU5URUxfV0FL
RVJFRl9QVVRfQVNZTkMgfHwKKwkgICAgIW11dGV4X3RyeWxvY2soJndmLT5tdXRleCkpIHsKKwkJ
c2NoZWR1bGVfd29yaygmd2YtPndvcmspOworCQlyZXR1cm47CisJfQorCisJX19fX2ludGVsX3dh
a2VyZWZfcHV0X2xhc3Qod2YpOwogfQogCi12b2lkIF9faW50ZWxfd2FrZXJlZl9pbml0KHN0cnVj
dCBpbnRlbF93YWtlcmVmICp3Ziwgc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCitzdGF0aWMg
dm9pZCBfX2ludGVsX3dha2VyZWZfcHV0X3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3cmspCiB7
CisJc3RydWN0IGludGVsX3dha2VyZWYgKndmID0gY29udGFpbmVyX29mKHdyaywgdHlwZW9mKCp3
ZiksIHdvcmspOworCisJaWYgKGF0b21pY19hZGRfdW5sZXNzKCZ3Zi0+Y291bnQsIC0xLCAxKSkK
KwkJcmV0dXJuOworCisJbXV0ZXhfbG9jaygmd2YtPm11dGV4KTsKKwlfX19faW50ZWxfd2FrZXJl
Zl9wdXRfbGFzdCh3Zik7Cit9CisKK3ZvaWQgX19pbnRlbF93YWtlcmVmX2luaXQoc3RydWN0IGlu
dGVsX3dha2VyZWYgKndmLAorCQkJICBzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAorCQkJ
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJlZl9vcHMgKm9wcywKKwkJCSAgc3RydWN0IGxvY2tf
Y2xhc3Nfa2V5ICprZXkpCit7CisJd2YtPnJwbSA9IHJwbTsKKwl3Zi0+b3BzID0gb3BzOworCiAJ
X19tdXRleF9pbml0KCZ3Zi0+bXV0ZXgsICJ3YWtlcmVmIiwga2V5KTsKIAlhdG9taWNfc2V0KCZ3
Zi0+Y291bnQsIDApOwogCXdmLT53YWtlcmVmID0gMDsKKworCUlOSVRfV09SSygmd2YtPndvcmss
IF9faW50ZWxfd2FrZXJlZl9wdXRfd29yayk7Cit9CisKK2ludCBpbnRlbF93YWtlcmVmX3dhaXRf
Zm9yX2lkbGUoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQoreworCXJldHVybiB3YWl0X3Zhcl9l
dmVudF9raWxsYWJsZSgmd2YtPndha2VyZWYsCisJCQkJICAgICAgICFpbnRlbF93YWtlcmVmX2lz
X2FjdGl2ZSh3ZikpOwogfQogCiBzdGF0aWMgdm9pZCB3YWtlcmVmX2F1dG9fdGltZW91dChzdHJ1
Y3QgdGltZXJfbGlzdCAqdCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3dha2VyZWYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaAppbmRleCAx
ZDZmNTk4NmU0ZTUuLjUzNWEzYTEyODY0YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfd2FrZXJlZi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2Vy
ZWYuaApAQCAtOCwxMCArOCwxMiBAQAogI2RlZmluZSBJTlRFTF9XQUtFUkVGX0gKIAogI2luY2x1
ZGUgPGxpbnV4L2F0b21pYy5oPgorI2luY2x1ZGUgPGxpbnV4L2JpdHMuaD4KICNpbmNsdWRlIDxs
aW51eC9tdXRleC5oPgogI2luY2x1ZGUgPGxpbnV4L3JlZmNvdW50Lmg+CiAjaW5jbHVkZSA8bGlu
dXgvc3RhY2tkZXBvdC5oPgogI2luY2x1ZGUgPGxpbnV4L3RpbWVyLmg+CisjaW5jbHVkZSA8bGlu
dXgvd29ya3F1ZXVlLmg+CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVRykK
ICNkZWZpbmUgSU5URUxfV0FLRVJFRl9CVUdfT04oZXhwcikgQlVHX09OKGV4cHIpCkBAIC0yMCwy
OSArMjIsNDIgQEAKICNlbmRpZgogCiBzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbTsKK3N0cnVjdCBp
bnRlbF93YWtlcmVmOwogCiB0eXBlZGVmIGRlcG90X3N0YWNrX2hhbmRsZV90IGludGVsX3dha2Vy
ZWZfdDsKIAorc3RydWN0IGludGVsX3dha2VyZWZfb3BzIHsKKwlpbnQgKCpnZXQpKHN0cnVjdCBp
bnRlbF93YWtlcmVmICp3Zik7CisJaW50ICgqcHV0KShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2Yp
OworCisJdW5zaWduZWQgbG9uZyBmbGFnczsKKyNkZWZpbmUgSU5URUxfV0FLRVJFRl9QVVRfQVNZ
TkMgQklUKDApCit9OworCiBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiB7CiAJYXRvbWljX3QgY291bnQ7
CiAJc3RydWN0IG11dGV4IG11dGV4OworCiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisKKwlz
dHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtOworCWNvbnN0IHN0cnVjdCBpbnRlbF93YWtlcmVm
X29wcyAqb3BzOworCisJc3RydWN0IHdvcmtfc3RydWN0IHdvcms7CiB9OwogCiB2b2lkIF9faW50
ZWxfd2FrZXJlZl9pbml0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKKwkJCSAgc3RydWN0IGlu
dGVsX3J1bnRpbWVfcG0gKnJwbSwKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX3dha2VyZWZfb3Bz
ICpvcHMsCiAJCQkgIHN0cnVjdCBsb2NrX2NsYXNzX2tleSAqa2V5KTsKLSNkZWZpbmUgaW50ZWxf
d2FrZXJlZl9pbml0KHdmKSBkbyB7CQkJCQlcCisjZGVmaW5lIGludGVsX3dha2VyZWZfaW5pdCh3
ZiwgcnBtLCBvcHMpIGRvIHsJCQkJXAogCXN0YXRpYyBzdHJ1Y3QgbG9ja19jbGFzc19rZXkgX19r
ZXk7CQkJCVwKIAkJCQkJCQkJCVwKLQlfX2ludGVsX3dha2VyZWZfaW5pdCgod2YpLCAmX19rZXkp
OwkJCQlcCisJX19pbnRlbF93YWtlcmVmX2luaXQoKHdmKSwgKHJwbSksIChvcHMpLCAmX19rZXkp
OwkJXAogfSB3aGlsZSAoMCkKIAotaW50IF9faW50ZWxfd2FrZXJlZl9nZXRfZmlyc3Qoc3RydWN0
IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJCSAgICAgIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3
ZiwKLQkJCSAgICAgIGludCAoKmZuKShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpKTsKLWludCBf
X2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJ
CSAgICAgc3RydWN0IGludGVsX3dha2VyZWYgKndmLAotCQkJICAgICBpbnQgKCpmbikoc3RydWN0
IGludGVsX3dha2VyZWYgKndmKSk7CitpbnQgX19pbnRlbF93YWtlcmVmX2dldF9maXJzdChzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YpOwordm9pZCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3Ry
dWN0IGludGVsX3dha2VyZWYgKndmKTsKIAogLyoqCiAgKiBpbnRlbF93YWtlcmVmX2dldDogQWNx
dWlyZSB0aGUgd2FrZXJlZgpAQCAtNjEsMTIgKzc2LDEwIEBAIGludCBfX2ludGVsX3dha2VyZWZf
cHV0X2xhc3Qoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKICAqIGNvZGUgb3RoZXJ3aXNl
LgogICovCiBzdGF0aWMgaW5saW5lIGludAotaW50ZWxfd2FrZXJlZl9nZXQoc3RydWN0IGludGVs
X3J1bnRpbWVfcG0gKnJwbSwKLQkJICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCSAgaW50
ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikpCitpbnRlbF93YWtlcmVmX2dldChzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CiAJaWYgKHVubGlrZWx5KCFhdG9taWNfaW5jX25vdF96
ZXJvKCZ3Zi0+Y291bnQpKSkKLQkJcmV0dXJuIF9faW50ZWxfd2FrZXJlZl9nZXRfZmlyc3QocnBt
LCB3ZiwgZm4pOworCQlyZXR1cm4gX19pbnRlbF93YWtlcmVmX2dldF9maXJzdCh3Zik7CiAKIAly
ZXR1cm4gMDsKIH0KQEAgLTEwMiwxNiArMTE1LDEyIEBAIGludGVsX3dha2VyZWZfZ2V0X2lmX2Fj
dGl2ZShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAgKiBSZXR1cm5zOiAwIGlmIHRoZSB3YWtl
cmVmIHdhcyByZWxlYXNlZCBzdWNjZXNzZnVsbHksIG9yIGEgbmVnYXRpdmUgZXJyb3IKICAqIGNv
ZGUgb3RoZXJ3aXNlLgogICovCi1zdGF0aWMgaW5saW5lIGludAotaW50ZWxfd2FrZXJlZl9wdXQo
c3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAq
d2YsCi0JCSAgaW50ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikpCitzdGF0aWMgaW5s
aW5lIHZvaWQKK2ludGVsX3dha2VyZWZfcHV0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIHsK
IAlJTlRFTF9XQUtFUkVGX0JVR19PTihhdG9taWNfcmVhZCgmd2YtPmNvdW50KSA8PSAwKTsKLQlp
ZiAoYXRvbWljX2RlY19hbmRfbXV0ZXhfbG9jaygmd2YtPmNvdW50LCAmd2YtPm11dGV4KSkKLQkJ
cmV0dXJuIF9faW50ZWxfd2FrZXJlZl9wdXRfbGFzdChycG0sIHdmLCBmbik7Ci0KLQlyZXR1cm4g
MDsKKwlpZiAodW5saWtlbHkoIWF0b21pY19hZGRfdW5sZXNzKCZ3Zi0+Y291bnQsIC0xLCAxKSkp
CisJCV9faW50ZWxfd2FrZXJlZl9wdXRfbGFzdCh3Zik7CiB9CiAKIC8qKgpAQCAtMTU0LDYgKzE2
MywxOSBAQCBpbnRlbF93YWtlcmVmX2lzX2FjdGl2ZShjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJl
ZiAqd2YpCiAJcmV0dXJuIFJFQURfT05DRSh3Zi0+d2FrZXJlZik7CiB9CiAKKy8qKgorICogaW50
ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlOiBXYWl0IHVudGlsIHRoZSB3YWtlcmVmIGlzIGlkbGUK
KyAqIEB3ZjogdGhlIHdha2VyZWYKKyAqCisgKiBXYWl0IGZvciB0aGUgZWFybGllciBhc3luY2hy
b25vdXMgcmVsZWFzZSBvZiB0aGUgd2FrZXJlZi4gTm90ZQorICogdGhpcyB3aWxsIHdhaXQgZm9y
IGFueSB0aGlyZCBwYXJ0eSBhcyB3ZWxsLCBzbyBtYWtlIHN1cmUgeW91IG9ubHkgd2FpdAorICog
d2hlbiB5b3UgaGF2ZSBjb250cm9sIG92ZXIgdGhlIHdha2VyZWYgYW5kIHRydXN0IG5vIG9uZSBl
bHNlIGlzIGFjcXVpcmluZworICogaXQuCisgKgorICogUmV0dXJuOiAwIG9uIHN1Y2Nlc3MsIGVy
cm9yIGNvZGUgaWYga2lsbGVkLgorICovCitpbnQgaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxl
KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3Zik7CisKIHN0cnVjdCBpbnRlbF93YWtlcmVmX2F1dG8g
ewogCXN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpycG07CiAJc3RydWN0IHRpbWVyX2xpc3QgdGlt
ZXI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZl
X3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9z
ZWxmdGVzdHMuaAppbmRleCBhODQxZDNmOWJlZGMuLjFjY2YwZjczMWFjMCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCkBA
IC0xMiwxMCArMTIsMTEgQEAKIHNlbGZ0ZXN0KHNhbml0eWNoZWNrLCBpOTE1X2xpdmVfc2FuaXR5
Y2hlY2spIC8qIGtlZXAgZmlyc3QgKGlndCBzZWxmY2hlY2spICovCiBzZWxmdGVzdCh1bmNvcmUs
IGludGVsX3VuY29yZV9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KHdvcmthcm91bmRzLCBpbnRl
bF93b3JrYXJvdW5kc19saXZlX3NlbGZ0ZXN0cykKLXNlbGZ0ZXN0KHRpbWVsaW5lcywgaW50ZWxf
dGltZWxpbmVfbGl2ZV9zZWxmdGVzdHMpCitzZWxmdGVzdChndF9lbmdpbmVzLCBpbnRlbF9lbmdp
bmVfbGl2ZV9zZWxmdGVzdHMpCitzZWxmdGVzdChndF90aW1lbGluZXMsIGludGVsX3RpbWVsaW5l
X2xpdmVfc2VsZnRlc3RzKQorc2VsZnRlc3QoZ3RfY29udGV4dHMsIGludGVsX2NvbnRleHRfbGl2
ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChyZXF1ZXN0cywgaTkxNV9yZXF1ZXN0X2xpdmVfc2VsZnRl
c3RzKQogc2VsZnRlc3QoYWN0aXZlLCBpOTE1X2FjdGl2ZV9saXZlX3NlbGZ0ZXN0cykKLXNlbGZ0
ZXN0KGd0X2NvbnRleHRzLCBpbnRlbF9jb250ZXh0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3Qo
b2JqZWN0cywgaTkxNV9nZW1fb2JqZWN0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QobW1hbiwg
aTkxNV9nZW1fbW1hbl9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGRtYWJ1ZiwgaTkxNV9nZW1f
ZG1hYnVmX2xpdmVfc2VsZnRlc3RzKQotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 175E6BD9B7
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 10:21:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3732289B7B;
	Wed, 25 Sep 2019 08:21:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C972C89B99
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 08:21:16 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 10:21:09 +0200
Message-Id: <20190925082110.17439-1-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915/dp: Fix dsc bpp calculations, v5.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: stable@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlcmUgd2FzIGEgaW50ZWdlciB3cmFwYXJvdW5kIHdoZW4gbW9kZV9jbG9jayBiZWNhbWUgdG9v
IGhpZ2gsCmFuZCB3ZSBkaWRuJ3QgY29ycmVjdCBmb3IgdGhlIEZFQyBvdmVyaGVhZCBmYWN0b3Ig
d2hlbiBkaXZpZGluZywKd2l0aCB0aGUgY2FsY3VsYXRpb25zIGJyZWFraW5nIGF0IEhCUjMuCgpB
cyBhIHJlc3VsdCBvdXIgY2FsY3VsYXRlZCBicHAgd2FzIHdheSB0b28gaGlnaCwgYW5kIHRoZSBs
aW5rIHdpZHRoCmxpbWl0YXRpb24gbmV2ZXIgY2FtZSBpbnRvIGVmZmVjdC4KClByaW50IG91dCB0
aGUgcmVzdWx0aW5nIGJwcCBjYWxjdWx1bGF0aW9ucyBhcyBhIHNhbml0eSBjaGVjaywganVzdApp
biBjYXNlIHdlIGV2ZXIgaGF2ZSB0byBkZWJ1ZyBpdCBsYXRlciBvbiBhZ2Fpbi4KCldlIGFsc28g
dXNlZCB0aGUgd3JvbmcgZmFjdG9yIGZvciBGRUMuIFdoaWxlIGJzcGVjIG1lbnRpb25zIDIuNCUs
CmFsbCB0aGUgY2FsY3VsYXRpb25zIHVzZSAxLzAuOTcyMjYxLCBhbmQgdGhlIHNhbWUgcmF0aW8g
c2hvdWxkIGJlCmFwcGxpZWQgdG8gZGF0YSBNL04gYXMgd2VsbCwgc28gdXNlIGl0IHRoZXJlIHdo
ZW4gRkVDIGlzIGVuYWJsZWQuCgpUaGlzIGZpeGVzIHRoZSBGSUZPIHVuZGVycnVuIHdlIGFyZSBz
ZWVpbmcgd2l0aCBGRUMgZW5hYmxlZC4KCkNoYW5nZXMgc2luY2UgdjI6Ci0gSGFuZGxlIGZlY19l
bmFibGUgaW4gaW50ZWxfbGlua19jb21wdXRlX21fbiwgc28gb25seSBkYXRhIE0vTiBpcyBhZGp1
c3RlZC4gKFZpbGxlKQotIEZpeCBpbml0aWFsIGhhcmR3YXJlIHJlYWRvdXQgZm9yIEZFQy4gKFZp
bGxlKQpDaGFuZ2VzIHNpbmNlIHYzOgotIFJlbW92ZSBib2d1cyBmZWNfdG9fbW9kZV9jbG9jay4g
KFZpbGxlKQpDaGFuZ2VzIHNpbmNlIHY0OgotIFVzZSB0aGUgY29ycmVjdCByZWdpc3RlciBmb3Ig
aWNsLiAoVmlsbGUpCi0gU3BsaXQgaHcgcmVhZG91dCB0byBhIHNlcGFyYXRlIHBhdGNoLgoKU2ln
bmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4Lmlu
dGVsLmNvbT4KRml4ZXM6IGQ5MjE4YzhmNmNmNCAoImRybS9pOTE1L2RwOiBBZGQgaGVscGVycyBm
b3IgQ29tcHJlc3NlZCBCUFAgYW5kIFNsaWNlIENvdW50IGZvciBEU0MiKQpDYzogPHN0YWJsZUB2
Z2VyLmtlcm5lbC5vcmc+ICMgdjUuMCsKQ2M6IE1hbmFzaSBOYXZhcmUgPG1hbmFzaS5kLm5hdmFy
ZUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5oIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgICAg
ICB8IDE4NCArKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2RwLmggICAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcF9tc3QuYyAgfCAgIDIgKy0KIDUgZmlsZXMgY2hhbmdlZCwgMTA3IGluc2VydGlvbnMo
KyksIDk5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKaW5kZXggNWVjZjU0MjcwMTgxLi5jNGM5Mjg2YmU5ODcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC03MjkxLDcgKzcyOTEs
NyBAQCBzdGF0aWMgaW50IGlyb25sYWtlX2ZkaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxf
Y3J0YyAqaW50ZWxfY3J0YywKIAlwaXBlX2NvbmZpZy0+ZmRpX2xhbmVzID0gbGFuZTsKIAogCWlu
dGVsX2xpbmtfY29tcHV0ZV9tX24ocGlwZV9jb25maWctPnBpcGVfYnBwLCBsYW5lLCBmZGlfZG90
Y2xvY2ssCi0JCQkgICAgICAgbGlua19idywgJnBpcGVfY29uZmlnLT5mZGlfbV9uLCBmYWxzZSk7
CisJCQkgICAgICAgbGlua19idywgJnBpcGVfY29uZmlnLT5mZGlfbV9uLCBmYWxzZSwgZmFsc2Up
OwogCiAJcmV0ID0gaXJvbmxha2VfY2hlY2tfZmRpX2xhbmVzKGRldiwgaW50ZWxfY3J0Yy0+cGlw
ZSwgcGlwZV9jb25maWcpOwogCWlmIChyZXQgPT0gLUVERUFETEspCkBAIC03NTM4LDExICs3NTM4
LDE1IEBAIHZvaWQKIGludGVsX2xpbmtfY29tcHV0ZV9tX24odTE2IGJpdHNfcGVyX3BpeGVsLCBp
bnQgbmxhbmVzLAogCQkgICAgICAgaW50IHBpeGVsX2Nsb2NrLCBpbnQgbGlua19jbG9jaywKIAkJ
ICAgICAgIHN0cnVjdCBpbnRlbF9saW5rX21fbiAqbV9uLAotCQkgICAgICAgYm9vbCBjb25zdGFu
dF9uKQorCQkgICAgICAgYm9vbCBjb25zdGFudF9uLCBib29sIGZlY19lbmFibGUpCiB7Ci0JbV9u
LT50dSA9IDY0OworCXUzMiBkYXRhX2Nsb2NrID0gYml0c19wZXJfcGl4ZWwgKiBwaXhlbF9jbG9j
azsKKworCWlmIChmZWNfZW5hYmxlKQorCQlkYXRhX2Nsb2NrID0gaW50ZWxfZHBfbW9kZV90b19m
ZWNfY2xvY2soZGF0YV9jbG9jayk7CiAKLQljb21wdXRlX21fbihiaXRzX3Blcl9waXhlbCAqIHBp
eGVsX2Nsb2NrLAorCW1fbi0+dHUgPSA2NDsKKwljb21wdXRlX21fbihkYXRhX2Nsb2NrLAogCQkg
ICAgbGlua19jbG9jayAqIG5sYW5lcyAqIDgsCiAJCSAgICAmbV9uLT5nbWNoX20sICZtX24tPmdt
Y2hfbiwKIAkJICAgIGNvbnN0YW50X24pOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuaAppbmRleCA1Y2VhNmY4ZTEwN2EuLjRiOWUxOGU1YTI2MyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTQ0Myw3ICs0
NDMsNyBAQCBlbnVtIHBoeV9maWEgewogdm9pZCBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBi
cHAsIGludCBubGFuZXMsCiAJCQkgICAgaW50IHBpeGVsX2Nsb2NrLCBpbnQgbGlua19jbG9jaywK
IAkJCSAgICBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm1fbiwKLQkJCSAgICBib29sIGNvbnN0YW50
X24pOworCQkJICAgIGJvb2wgY29uc3RhbnRfbiwgYm9vbCBmZWNfZW5hYmxlKTsKIGJvb2wgaXNf
Y2NzX21vZGlmaWVyKHU2NCBtb2RpZmllcik7CiB2b2lkIGxwdF9kaXNhYmxlX2Nsa291dF9kcChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdTMyIGludGVsX3BsYW5lX2ZiX21h
eF9zdHJpZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCmluZGV4IDgyOTU1OWY5NzQ0MC4uMmIxZTcxZjk5MmIw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC03Niw4ICs3Niw4
IEBACiAjZGVmaW5lIERQX0RTQ19NQVhfRU5DX1RIUk9VR0hQVVRfMAkJMzQwMDAwCiAjZGVmaW5l
IERQX0RTQ19NQVhfRU5DX1RIUk9VR0hQVVRfMQkJNDAwMDAwCiAKLS8qIERQIERTQyBGRUMgT3Zl
cmhlYWQgZmFjdG9yID0gKDEwMCAtIDIuNCkvMTAwICovCi0jZGVmaW5lIERQX0RTQ19GRUNfT1ZF
UkhFQURfRkFDVE9SCQk5NzYKKy8qIERQIERTQyBGRUMgT3ZlcmhlYWQgZmFjdG9yID0gMS8oMC45
NzIyNjEpICovCisjZGVmaW5lIERQX0RTQ19GRUNfT1ZFUkhFQURfRkFDVE9SCQk5NzIyNjEKIAog
LyogQ29tcGxpYW5jZSB0ZXN0IHN0YXR1cyBiaXRzICAqLwogI2RlZmluZSBJTlRFTF9EUF9SRVNP
TFVUSU9OX1NISUZUX01BU0sJMApAQCAtNDkyLDYgKzQ5Miw5NyBAQCBpbnQgaW50ZWxfZHBfZ2V0
X2xpbmtfdHJhaW5fZmFsbGJhY2tfdmFsdWVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJ
cmV0dXJuIDA7CiB9CiAKK3UzMiBpbnRlbF9kcF9tb2RlX3RvX2ZlY19jbG9jayh1MzIgbW9kZV9j
bG9jaykKK3sKKwlyZXR1cm4gZGl2X3U2NChtdWxfdTMyX3UzMihtb2RlX2Nsb2NrLCAxMDAwMDAw
VSksCisJCSAgICAgICBEUF9EU0NfRkVDX09WRVJIRUFEX0ZBQ1RPUik7Cit9CisKK3N0YXRpYyB1
MTYgaW50ZWxfZHBfZHNjX2dldF9vdXRwdXRfYnBwKHUzMiBsaW5rX2Nsb2NrLCB1MzIgbGFuZV9j
b3VudCwKKwkJCQkgICAgICAgdTMyIG1vZGVfY2xvY2ssIHUzMiBtb2RlX2hkaXNwbGF5KQorewor
CXUzMiBiaXRzX3Blcl9waXhlbCwgbWF4X2JwcF9zbWFsbF9qb2luZXJfcmFtOworCWludCBpOwor
CisJLyoKKwkgKiBBdmFpbGFibGUgTGluayBCYW5kd2lkdGgoS2JpdHMvc2VjKSA9IChOdW1iZXJP
ZkxhbmVzKSoKKwkgKiAoTGlua1N5bWJvbENsb2NrKSogOCAqIChUaW1lU2xvdHNQZXJNVFApCisJ
ICogZm9yIFNTVCAtPiBUaW1lU2xvdHNQZXJNVFAgaXMgMSwKKwkgKiBmb3IgTVNUIC0+IFRpbWVT
bG90c1Blck1UUCBoYXMgdG8gYmUgY2FsY3VsYXRlZAorCSAqLworCWJpdHNfcGVyX3BpeGVsID0g
KGxpbmtfY2xvY2sgKiBsYW5lX2NvdW50ICogOCkgLworCQkJIGludGVsX2RwX21vZGVfdG9fZmVj
X2Nsb2NrKG1vZGVfY2xvY2spOworCURSTV9ERUJVR19LTVMoIk1heCBsaW5rIGJwcDogJXVcbiIs
IGJpdHNfcGVyX3BpeGVsKTsKKworCS8qIFNtYWxsIEpvaW5lciBDaGVjazogb3V0cHV0IGJwcCA8
PSBqb2luZXIgUkFNIChiaXRzKSAvIEhvcml6LiB3aWR0aCAqLworCW1heF9icHBfc21hbGxfam9p
bmVyX3JhbSA9IERQX0RTQ19NQVhfU01BTExfSk9JTkVSX1JBTV9CVUZGRVIgLyBtb2RlX2hkaXNw
bGF5OworCURSTV9ERUJVR19LTVMoIk1heCBzbWFsbCBqb2luZXIgYnBwOiAldVxuIiwgbWF4X2Jw
cF9zbWFsbF9qb2luZXJfcmFtKTsKKworCS8qCisJICogR3JlYXRlc3QgYWxsb3dlZCBEU0MgQlBQ
ID0gTUlOIChvdXRwdXQgQlBQIGZyb20gYXZhaWxhYmxlIExpbmsgQlcKKwkgKiBjaGVjaywgb3V0
cHV0IGJwcCBmcm9tIHNtYWxsIGpvaW5lciBSQU0gY2hlY2spCisJICovCisJYml0c19wZXJfcGl4
ZWwgPSBtaW4oYml0c19wZXJfcGl4ZWwsIG1heF9icHBfc21hbGxfam9pbmVyX3JhbSk7CisKKwkv
KiBFcnJvciBvdXQgaWYgdGhlIG1heCBicHAgaXMgbGVzcyB0aGFuIHNtYWxsZXN0IGFsbG93ZWQg
dmFsaWQgYnBwICovCisJaWYgKGJpdHNfcGVyX3BpeGVsIDwgdmFsaWRfZHNjX2JwcFswXSkgewor
CQlEUk1fREVCVUdfS01TKCJVbnN1cHBvcnRlZCBCUFAgJXUsIG1pbiAldVxuIiwKKwkJCSAgICAg
IGJpdHNfcGVyX3BpeGVsLCB2YWxpZF9kc2NfYnBwWzBdKTsKKwkJcmV0dXJuIDA7CisJfQorCisJ
LyogRmluZCB0aGUgbmVhcmVzdCBtYXRjaCBpbiB0aGUgYXJyYXkgb2Yga25vd24gQlBQcyBmcm9t
IFZFU0EgKi8KKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRSh2YWxpZF9kc2NfYnBwKSAtIDE7
IGkrKykgeworCQlpZiAoYml0c19wZXJfcGl4ZWwgPCB2YWxpZF9kc2NfYnBwW2kgKyAxXSkKKwkJ
CWJyZWFrOworCX0KKwliaXRzX3Blcl9waXhlbCA9IHZhbGlkX2RzY19icHBbaV07CisKKwkvKgor
CSAqIENvbXByZXNzZWQgQlBQIGluIFU2LjQgZm9ybWF0IHNvIG11bHRpcGx5IGJ5IDE2LCBmb3Ig
R2VuIDExLAorCSAqIGZyYWN0aW9uYWwgcGFydCBpcyAwCisJICovCisJcmV0dXJuIGJpdHNfcGVy
X3BpeGVsIDw8IDQ7Cit9CisKK3N0YXRpYyB1OCBpbnRlbF9kcF9kc2NfZ2V0X3NsaWNlX2NvdW50
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJICAgICAgIGludCBtb2RlX2Nsb2NrLCBp
bnQgbW9kZV9oZGlzcGxheSkKK3sKKwl1OCBtaW5fc2xpY2VfY291bnQsIGk7CisJaW50IG1heF9z
bGljZV93aWR0aDsKKworCWlmIChtb2RlX2Nsb2NrIDw9IERQX0RTQ19QRUFLX1BJWEVMX1JBVEUp
CisJCW1pbl9zbGljZV9jb3VudCA9IERJVl9ST1VORF9VUChtb2RlX2Nsb2NrLAorCQkJCQkgICAg
ICAgRFBfRFNDX01BWF9FTkNfVEhST1VHSFBVVF8wKTsKKwllbHNlCisJCW1pbl9zbGljZV9jb3Vu
dCA9IERJVl9ST1VORF9VUChtb2RlX2Nsb2NrLAorCQkJCQkgICAgICAgRFBfRFNDX01BWF9FTkNf
VEhST1VHSFBVVF8xKTsKKworCW1heF9zbGljZV93aWR0aCA9IGRybV9kcF9kc2Nfc2lua19tYXhf
c2xpY2Vfd2lkdGgoaW50ZWxfZHAtPmRzY19kcGNkKTsKKwlpZiAobWF4X3NsaWNlX3dpZHRoIDwg
RFBfRFNDX01JTl9TTElDRV9XSURUSF9WQUxVRSkgeworCQlEUk1fREVCVUdfS01TKCJVbnN1cHBv
cnRlZCBzbGljZSB3aWR0aCAlZCBieSBEUCBEU0MgU2luayBkZXZpY2VcbiIsCisJCQkgICAgICBt
YXhfc2xpY2Vfd2lkdGgpOworCQlyZXR1cm4gMDsKKwl9CisJLyogQWxzbyB0YWtlIGludG8gYWNj
b3VudCBtYXggc2xpY2Ugd2lkdGggKi8KKwltaW5fc2xpY2VfY291bnQgPSBtaW5fdCh1OCwgbWlu
X3NsaWNlX2NvdW50LAorCQkJCURJVl9ST1VORF9VUChtb2RlX2hkaXNwbGF5LAorCQkJCQkgICAg
IG1heF9zbGljZV93aWR0aCkpOworCisJLyogRmluZCB0aGUgY2xvc2VzdCBtYXRjaCB0byB0aGUg
dmFsaWQgc2xpY2UgY291bnQgdmFsdWVzICovCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUo
dmFsaWRfZHNjX3NsaWNlY291bnQpOyBpKyspIHsKKwkJaWYgKHZhbGlkX2RzY19zbGljZWNvdW50
W2ldID4KKwkJICAgIGRybV9kcF9kc2Nfc2lua19tYXhfc2xpY2VfY291bnQoaW50ZWxfZHAtPmRz
Y19kcGNkLAorCQkJCQkJICAgIGZhbHNlKSkKKwkJCWJyZWFrOworCQlpZiAobWluX3NsaWNlX2Nv
dW50ICA8PSB2YWxpZF9kc2Nfc2xpY2Vjb3VudFtpXSkKKwkJCXJldHVybiB2YWxpZF9kc2Nfc2xp
Y2Vjb3VudFtpXTsKKwl9CisKKwlEUk1fREVCVUdfS01TKCJVbnN1cHBvcnRlZCBTbGljZSBDb3Vu
dCAlZFxuIiwgbWluX3NsaWNlX2NvdW50KTsKKwlyZXR1cm4gMDsKK30KKwogc3RhdGljIGVudW0g
ZHJtX21vZGVfc3RhdHVzCiBpbnRlbF9kcF9tb2RlX3ZhbGlkKHN0cnVjdCBkcm1fY29ubmVjdG9y
ICpjb25uZWN0b3IsCiAJCSAgICBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkKQEAgLTIy
NTksNyArMjM1MCw3IEBAIGludGVsX2RwX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJICAgICAgIGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2ssCiAJCQkg
ICAgICAgcGlwZV9jb25maWctPnBvcnRfY2xvY2ssCiAJCQkgICAgICAgJnBpcGVfY29uZmlnLT5k
cF9tX24sCi0JCQkgICAgICAgY29uc3RhbnRfbik7CisJCQkgICAgICAgY29uc3RhbnRfbiwgcGlw
ZV9jb25maWctPmZlY19lbmFibGUpOwogCiAJaWYgKGludGVsX2Nvbm5lY3Rvci0+cGFuZWwuZG93
bmNsb2NrX21vZGUgIT0gTlVMTCAmJgogCQlkZXZfcHJpdi0+ZHJycy50eXBlID09IFNFQU1MRVNT
X0RSUlNfU1VQUE9SVCkgewpAQCAtMjI2OSw3ICsyMzYwLDcgQEAgaW50ZWxfZHBfY29tcHV0ZV9j
b25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCSAgICAgICBpbnRlbF9j
b25uZWN0b3ItPnBhbmVsLmRvd25jbG9ja19tb2RlLT5jbG9jaywKIAkJCQkJICAgICAgIHBpcGVf
Y29uZmlnLT5wb3J0X2Nsb2NrLAogCQkJCQkgICAgICAgJnBpcGVfY29uZmlnLT5kcF9tMl9uMiwK
LQkJCQkJICAgICAgIGNvbnN0YW50X24pOworCQkJCQkgICAgICAgY29uc3RhbnRfbiwgcGlwZV9j
b25maWctPmZlY19lbmFibGUpOwogCX0KIAogCWlmICghSEFTX0RESShkZXZfcHJpdikpCkBAIC00
MzczLDkxICs0NDY0LDYgQEAgaW50ZWxfZHBfZ2V0X3NpbmtfaXJxX2VzaShzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwLCB1OCAqc2lua19pcnFfdmVjdG9yKQogCQlEUF9EUFJYX0VTSV9MRU47CiB9
CiAKLXUxNiBpbnRlbF9kcF9kc2NfZ2V0X291dHB1dF9icHAoaW50IGxpbmtfY2xvY2ssIHU4IGxh
bmVfY291bnQsCi0JCQkJaW50IG1vZGVfY2xvY2ssIGludCBtb2RlX2hkaXNwbGF5KQotewotCXUx
NiBiaXRzX3Blcl9waXhlbCwgbWF4X2JwcF9zbWFsbF9qb2luZXJfcmFtOwotCWludCBpOwotCi0J
LyoKLQkgKiBBdmFpbGFibGUgTGluayBCYW5kd2lkdGgoS2JpdHMvc2VjKSA9IChOdW1iZXJPZkxh
bmVzKSoKLQkgKiAoTGlua1N5bWJvbENsb2NrKSogOCAqICgoMTAwLUZFQ092ZXJoZWFkKS8xMDAp
KihUaW1lU2xvdHNQZXJNVFApCi0JICogRkVDT3ZlcmhlYWQgPSAyLjQlLCBmb3IgU1NUIC0+IFRp
bWVTbG90c1Blck1UUCBpcyAxLAotCSAqIGZvciBNU1QgLT4gVGltZVNsb3RzUGVyTVRQIGhhcyB0
byBiZSBjYWxjdWxhdGVkCi0JICovCi0JYml0c19wZXJfcGl4ZWwgPSAobGlua19jbG9jayAqIGxh
bmVfY291bnQgKiA4ICoKLQkJCSAgRFBfRFNDX0ZFQ19PVkVSSEVBRF9GQUNUT1IpIC8KLQkJbW9k
ZV9jbG9jazsKLQotCS8qIFNtYWxsIEpvaW5lciBDaGVjazogb3V0cHV0IGJwcCA8PSBqb2luZXIg
UkFNIChiaXRzKSAvIEhvcml6LiB3aWR0aCAqLwotCW1heF9icHBfc21hbGxfam9pbmVyX3JhbSA9
IERQX0RTQ19NQVhfU01BTExfSk9JTkVSX1JBTV9CVUZGRVIgLwotCQltb2RlX2hkaXNwbGF5Owot
Ci0JLyoKLQkgKiBHcmVhdGVzdCBhbGxvd2VkIERTQyBCUFAgPSBNSU4gKG91dHB1dCBCUFAgZnJv
bSBhdmFpYWxibGUgTGluayBCVwotCSAqIGNoZWNrLCBvdXRwdXQgYnBwIGZyb20gc21hbGwgam9p
bmVyIFJBTSBjaGVjaykKLQkgKi8KLQliaXRzX3Blcl9waXhlbCA9IG1pbihiaXRzX3Blcl9waXhl
bCwgbWF4X2JwcF9zbWFsbF9qb2luZXJfcmFtKTsKLQotCS8qIEVycm9yIG91dCBpZiB0aGUgbWF4
IGJwcCBpcyBsZXNzIHRoYW4gc21hbGxlc3QgYWxsb3dlZCB2YWxpZCBicHAgKi8KLQlpZiAoYml0
c19wZXJfcGl4ZWwgPCB2YWxpZF9kc2NfYnBwWzBdKSB7Ci0JCURSTV9ERUJVR19LTVMoIlVuc3Vw
cG9ydGVkIEJQUCAlZFxuIiwgYml0c19wZXJfcGl4ZWwpOwotCQlyZXR1cm4gMDsKLQl9Ci0KLQkv
KiBGaW5kIHRoZSBuZWFyZXN0IG1hdGNoIGluIHRoZSBhcnJheSBvZiBrbm93biBCUFBzIGZyb20g
VkVTQSAqLwotCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHZhbGlkX2RzY19icHApIC0gMTsg
aSsrKSB7Ci0JCWlmIChiaXRzX3Blcl9waXhlbCA8IHZhbGlkX2RzY19icHBbaSArIDFdKQotCQkJ
YnJlYWs7Ci0JfQotCWJpdHNfcGVyX3BpeGVsID0gdmFsaWRfZHNjX2JwcFtpXTsKLQotCS8qCi0J
ICogQ29tcHJlc3NlZCBCUFAgaW4gVTYuNCBmb3JtYXQgc28gbXVsdGlwbHkgYnkgMTYsIGZvciBH
ZW4gMTEsCi0JICogZnJhY3Rpb25hbCBwYXJ0IGlzIDAKLQkgKi8KLQlyZXR1cm4gYml0c19wZXJf
cGl4ZWwgPDwgNDsKLX0KLQotdTggaW50ZWxfZHBfZHNjX2dldF9zbGljZV9jb3VudChzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLAotCQkJCWludCBtb2RlX2Nsb2NrLAotCQkJCWludCBtb2RlX2hk
aXNwbGF5KQotewotCXU4IG1pbl9zbGljZV9jb3VudCwgaTsKLQlpbnQgbWF4X3NsaWNlX3dpZHRo
OwotCi0JaWYgKG1vZGVfY2xvY2sgPD0gRFBfRFNDX1BFQUtfUElYRUxfUkFURSkKLQkJbWluX3Ns
aWNlX2NvdW50ID0gRElWX1JPVU5EX1VQKG1vZGVfY2xvY2ssCi0JCQkJCSAgICAgICBEUF9EU0Nf
TUFYX0VOQ19USFJPVUdIUFVUXzApOwotCWVsc2UKLQkJbWluX3NsaWNlX2NvdW50ID0gRElWX1JP
VU5EX1VQKG1vZGVfY2xvY2ssCi0JCQkJCSAgICAgICBEUF9EU0NfTUFYX0VOQ19USFJPVUdIUFVU
XzEpOwotCi0JbWF4X3NsaWNlX3dpZHRoID0gZHJtX2RwX2RzY19zaW5rX21heF9zbGljZV93aWR0
aChpbnRlbF9kcC0+ZHNjX2RwY2QpOwotCWlmIChtYXhfc2xpY2Vfd2lkdGggPCBEUF9EU0NfTUlO
X1NMSUNFX1dJRFRIX1ZBTFVFKSB7Ci0JCURSTV9ERUJVR19LTVMoIlVuc3VwcG9ydGVkIHNsaWNl
IHdpZHRoICVkIGJ5IERQIERTQyBTaW5rIGRldmljZVxuIiwKLQkJCSAgICAgIG1heF9zbGljZV93
aWR0aCk7Ci0JCXJldHVybiAwOwotCX0KLQkvKiBBbHNvIHRha2UgaW50byBhY2NvdW50IG1heCBz
bGljZSB3aWR0aCAqLwotCW1pbl9zbGljZV9jb3VudCA9IG1pbl90KHU4LCBtaW5fc2xpY2VfY291
bnQsCi0JCQkJRElWX1JPVU5EX1VQKG1vZGVfaGRpc3BsYXksCi0JCQkJCSAgICAgbWF4X3NsaWNl
X3dpZHRoKSk7Ci0KLQkvKiBGaW5kIHRoZSBjbG9zZXN0IG1hdGNoIHRvIHRoZSB2YWxpZCBzbGlj
ZSBjb3VudCB2YWx1ZXMgKi8KLQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRSh2YWxpZF9kc2Nf
c2xpY2Vjb3VudCk7IGkrKykgewotCQlpZiAodmFsaWRfZHNjX3NsaWNlY291bnRbaV0gPgotCQkg
ICAgZHJtX2RwX2RzY19zaW5rX21heF9zbGljZV9jb3VudChpbnRlbF9kcC0+ZHNjX2RwY2QsCi0J
CQkJCQkgICAgZmFsc2UpKQotCQkJYnJlYWs7Ci0JCWlmIChtaW5fc2xpY2VfY291bnQgIDw9IHZh
bGlkX2RzY19zbGljZWNvdW50W2ldKQotCQkJcmV0dXJuIHZhbGlkX2RzY19zbGljZWNvdW50W2ld
OwotCX0KLQotCURSTV9ERUJVR19LTVMoIlVuc3VwcG9ydGVkIFNsaWNlIENvdW50ICVkXG4iLCBt
aW5fc2xpY2VfY291bnQpOwotCXJldHVybiAwOwotfQotCiBzdGF0aWMgdm9pZAogaW50ZWxfcGl4
ZWxfZW5jb2Rpbmdfc2V0dXBfdnNjKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICAg
ICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmgKaW5kZXggZTAxZDFmODk0MDlkLi5hMTk0YjViNmRh
MDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmgKQEAgLTEwMywxMCAr
MTAzLDYgQEAgYm9vbCBpbnRlbF9kcF9zb3VyY2Vfc3VwcG9ydHNfaGJyMihzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKTsKIGJvb2wgaW50ZWxfZHBfc291cmNlX3N1cHBvcnRzX2hicjMoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCk7CiBib29sCiBpbnRlbF9kcF9nZXRfbGlua19zdGF0dXMoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwgdTggKmxpbmtfc3RhdHVzKTsKLXUxNiBpbnRlbF9kcF9k
c2NfZ2V0X291dHB1dF9icHAoaW50IGxpbmtfY2xvY2ssIHU4IGxhbmVfY291bnQsCi0JCQkJaW50
IG1vZGVfY2xvY2ssIGludCBtb2RlX2hkaXNwbGF5KTsKLXU4IGludGVsX2RwX2RzY19nZXRfc2xp
Y2VfY291bnQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IG1vZGVfY2xvY2ssCi0JCQkJ
aW50IG1vZGVfaGRpc3BsYXkpOwogCiBib29sIGludGVsX2RwX3JlYWRfZHBjZChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKTsKIGJvb2wgaW50ZWxfZHBfZ2V0X2NvbG9yaW1ldHJ5X3N0YXR1cyhz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKQEAgLTExOSw0ICsxMTUsNiBAQCBzdGF0aWMgaW5s
aW5lIHVuc2lnbmVkIGludCBpbnRlbF9kcF91bnVzZWRfbGFuZV9tYXNrKGludCBsYW5lX2NvdW50
KQogCXJldHVybiB+KCgxIDw8IGxhbmVfY291bnQpIC0gMSkgJiAweGY7CiB9CiAKK3UzMiBpbnRl
bF9kcF9tb2RlX3RvX2ZlY19jbG9jayh1MzIgbW9kZV9jbG9jayk7CisKICNlbmRpZiAvKiBfX0lO
VEVMX0RQX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcF9tc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0
LmMKaW5kZXggZWVlYjNmOTMzYWE0Li5jZjRkODUxYTUxMzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYwpAQCAtODEsNyArODEsNyBAQCBzdGF0aWMgaW50
IGludGVsX2RwX21zdF9jb21wdXRlX2xpbmtfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCQkJICAgICAgIGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2ssCiAJCQkgICAgICAg
Y3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywKIAkJCSAgICAgICAmY3J0Y19zdGF0ZS0+ZHBfbV9uLAot
CQkJICAgICAgIGNvbnN0YW50X24pOworCQkJICAgICAgIGNvbnN0YW50X24sIGNydGNfc3RhdGUt
PmZlY19lbmFibGUpOwogCWNydGNfc3RhdGUtPmRwX21fbi50dSA9IHNsb3RzOwogCiAJcmV0dXJu
IDA7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

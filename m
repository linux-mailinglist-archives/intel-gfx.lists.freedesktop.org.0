Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 267CD54F9E
	for <lists+intel-gfx@lfdr.de>; Tue, 25 Jun 2019 15:03:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 996DA6E10F;
	Tue, 25 Jun 2019 13:03:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 451CC6E0FA
 for <intel-gfx@lists.freedesktop.org>; Tue, 25 Jun 2019 13:03:19 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17018172-1500050 
 for multiple; Tue, 25 Jun 2019 14:01:34 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 25 Jun 2019 14:01:17 +0100
Message-Id: <20190625130128.11009-9-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190625130128.11009-1-chris@chris-wilson.co.uk>
References: <20190625130128.11009-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 09/20] drm/i915: Lift intel_engines_resume() to
 callers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2luY2UgdGhlIHJlc2V0IHBhdGggd2FudHMgdG8gcmVjb3ZlciB0aGUgZW5naW5lcyBpdHNlbGYs
IGl0IG9ubHkgd2FudHMKdG8gcmVpbml0aWFsaXNlIHRoZSBoYXJkd2FyZSB1c2luZyBpOTE1X2dl
bV9pbml0X2h3KCkuIFB1bGwgdGhlIGNhbGwgdG8KaW50ZWxfZW5naW5lc19yZXN1bWUoKSB0byB0
aGUgbW9kdWxlIGluaXQvcmVzdW1lIHBhdGggc28gd2UgY2FuIGF2b2lkIGl0CmR1cmluZyByZXNl
dC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgIHwgICA3ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyB8ICAyNCAtLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oIHwgICAyIC0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMgICAgIHwgIDIxICsrLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaCAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jlc2V0LmMgICAgIHwgIDIxICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW0uYyAgICAgICAgICAgfCAxNzMgKysrKysrKysrLS0tLS0tLS0tLS0tLQogNyBmaWxl
cyBjaGFuZ2VkLCAxMTYgaW5zZXJ0aW9ucygrKSwgMTM0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggNmI3MzBiZDRkNzJmLi40ZDc3NDM3NmY1
YjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC0yNTQsMTQgKzI1
NCwxNSBAQCB2b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAlpOTE1X2dlbV9yZXN0b3JlX2d0dF9tYXBwaW5ncyhpOTE1KTsKIAlpOTE1X2dlbV9yZXN0
b3JlX2ZlbmNlcyhpOTE1KTsKIAorCWlmIChpOTE1X2dlbV9pbml0X2h3KGk5MTUpKQorCQlnb3Rv
IGVycl93ZWRnZWQ7CisKIAkvKgogCSAqIEFzIHdlIGRpZG4ndCBmbHVzaCB0aGUga2VybmVsIGNv
bnRleHQgYmVmb3JlIHN1c3BlbmQsIHdlIGNhbm5vdAogCSAqIGd1YXJhbnRlZSB0aGF0IHRoZSBj
b250ZXh0IGltYWdlIGlzIGNvbXBsZXRlLiBTbyBsZXQncyBqdXN0IHJlc2V0CiAJICogaXQgYW5k
IHN0YXJ0IGFnYWluLgogCSAqLwotCWludGVsX2d0X3Jlc3VtZSgmaTkxNS0+Z3QpOwotCi0JaWYg
KGk5MTVfZ2VtX2luaXRfaHcoaTkxNSkpCisJaWYgKGludGVsX2d0X3Jlc3VtZSgmaTkxNS0+Z3Qp
KQogCQlnb3RvIGVycl93ZWRnZWQ7CiAKIAlpbnRlbF91Y19yZXN1bWUoaTkxNSk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4IDUyNTNjMzgyMDM0ZC4uODRl
NDMyYWJlOGUwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwpA
QCAtMTQyLDI3ICsxNDIsMyBAQCB2b2lkIGludGVsX2VuZ2luZV9pbml0X19wbShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJaW50ZWxfd2FrZXJlZl9pbml0KCZlbmdpbmUtPndh
a2VyZWYpOwogfQotCi1pbnQgaW50ZWxfZW5naW5lc19yZXN1bWUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCi17Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOwotCWludCBlcnIgPSAwOwotCi0JaW50ZWxfZ3RfcG1fZ2V0KCZp
OTE1LT5ndCk7Ci0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKLQkJaW50ZWxf
ZW5naW5lX3BtX2dldChlbmdpbmUpOwotCQllbmdpbmUtPnNlcmlhbCsrOyAvKiBrZXJuZWwgY29u
dGV4dCBsb3N0ICovCi0JCWVyciA9IGVuZ2luZS0+cmVzdW1lKGVuZ2luZSk7Ci0JCWludGVsX2Vu
Z2luZV9wbV9wdXQoZW5naW5lKTsKLQkJaWYgKGVycikgewotCQkJZGV2X2VycihpOTE1LT5kcm0u
ZGV2LAotCQkJCSJGYWlsZWQgdG8gcmVzdGFydCAlcyAoJWQpXG4iLAotCQkJCWVuZ2luZS0+bmFt
ZSwgZXJyKTsKLQkJCWJyZWFrOwotCQl9Ci0JfQotCWludGVsX2d0X3BtX3B1dCgmaTkxNS0+Z3Qp
OwotCi0JcmV0dXJuIGVycjsKLX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X3BtLmgKaW5kZXggN2QwNTdjZGNkOTE5Li4wMTVhYzcyZDdhZDAgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCkBAIC0zMSw2ICszMSw0IEBAIHZvaWQgaW50ZWxf
ZW5naW5lX3Bhcmsoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAogdm9pZCBpbnRl
bF9lbmdpbmVfaW5pdF9fcG0oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAotaW50
IGludGVsX2VuZ2luZXNfcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKLQog
I2VuZGlmIC8qIElOVEVMX0VOR0lORV9QTV9IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Z3RfcG0uYwppbmRleCBlYzZiNjlkMDE0YjYuLjM2YmE4MGU2YTBiNyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndF9wbS5jCkBAIC01LDYgKzUsNyBAQAogICovCiAKICNpbmNsdWRlICJp
OTE1X2Rydi5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImludGVs
X2d0X3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfcG0uaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVm
LmgiCkBAIC0xMjIsMTAgKzEyMywxMSBAQCB2b2lkIGludGVsX2d0X3Nhbml0aXplKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsIGJvb2wgZm9yY2UpCiAJCWludGVsX2VuZ2luZV9yZXNldChlbmdpbmUsIGZh
bHNlKTsKIH0KIAotdm9pZCBpbnRlbF9ndF9yZXN1bWUoc3RydWN0IGludGVsX2d0ICpndCkKK2lu
dCBpbnRlbF9ndF9yZXN1bWUoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9
IDA7CiAKIAkvKgogCSAqIEFmdGVyIHJlc3VtZSwgd2UgbWF5IG5lZWQgdG8gcG9rZSBpbnRvIHRo
ZSBwaW5uZWQga2VybmVsCkBAIC0xMzMsOSArMTM1LDEyIEBAIHZvaWQgaW50ZWxfZ3RfcmVzdW1l
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJICogT25seSB0aGUga2VybmVsIGNvbnRleHRzIHNob3Vs
ZCByZW1haW4gcGlubmVkIG92ZXIgc3VzcGVuZCwKIAkgKiBhbGxvd2luZyB1cyB0byBmaXh1cCB0
aGUgdXNlciBjb250ZXh0cyBvbiB0aGVpciBmaXJzdCBwaW4uCiAJICovCisJaW50ZWxfZ3RfcG1f
Z2V0KGd0KTsKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlOwogCisJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsK
KwogCQljZSA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQ7CiAJCWlmIChjZSkKIAkJCWNlLT5vcHMt
PnJlc2V0KGNlKTsKQEAgLTE0Myw1ICsxNDgsMTkgQEAgdm9pZCBpbnRlbF9ndF9yZXN1bWUoc3Ry
dWN0IGludGVsX2d0ICpndCkKIAkJY2UgPSBlbmdpbmUtPnByZWVtcHRfY29udGV4dDsKIAkJaWYg
KGNlKQogCQkJY2UtPm9wcy0+cmVzZXQoY2UpOworCisJCWVuZ2luZS0+c2VyaWFsKys7IC8qIGtl
cm5lbCBjb250ZXh0IGxvc3QgKi8KKwkJZXJyID0gZW5naW5lLT5yZXN1bWUoZW5naW5lKTsKKwor
CQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisJCWlmIChlcnIpIHsKKwkJCWRldl9lcnIo
Z3QtPmk5MTUtPmRybS5kZXYsCisJCQkJIkZhaWxlZCB0byByZXN0YXJ0ICVzICglZClcbiIsCisJ
CQkJZW5naW5lLT5uYW1lLCBlcnIpOworCQkJYnJlYWs7CisJCX0KIAl9CisJaW50ZWxfZ3RfcG1f
cHV0KGd0KTsKKworCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Rf
cG0uaAppbmRleCA0ZGJiOTJjZjU4ZDcuLmJhOTYwZTFmYzIwOSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ndF9wbS5oCkBAIC0yMiw2ICsyMiw2IEBAIHZvaWQgaW50ZWxfZ3RfcG1fcHV0
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogdm9pZCBpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KHN0cnVj
dCBpbnRlbF9ndCAqZ3QpOwogCiB2b2lkIGludGVsX2d0X3Nhbml0aXplKHN0cnVjdCBpbnRlbF9n
dCAqZ3QsIGJvb2wgZm9yY2UpOwotdm9pZCBpbnRlbF9ndF9yZXN1bWUoc3RydWN0IGludGVsX2d0
ICpndCk7CitpbnQgaW50ZWxfZ3RfcmVzdW1lKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogCiAjZW5k
aWYgLyogSU5URUxfR1RfUE1fSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfcmVzZXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMK
aW5kZXggZTdjYmQ5Y2Y4NWMxLi5hZGZkYjkwODU4N2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfcmVzZXQuYwpAQCAtOTQ5LDYgKzk0OSwyMSBAQCBzdGF0aWMgaW50IGRvX3Jlc2V0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXJldHVybiBndF9yZXNldChpOTE1LCBzdGFs
bGVkX21hc2spOwogfQogCitzdGF0aWMgaW50IHJlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRl
bF9lbmdpbmVfaWQgaWQ7CisJaW50IHJldDsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5
MTUsIGlkKSB7CisJCXJldCA9IGVuZ2luZS0+cmVzdW1lKGVuZ2luZSk7CisJCWlmIChyZXQpCisJ
CQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQorCiAvKioKICAqIGk5MTVfcmVzZXQg
LSByZXNldCBjaGlwIGFmdGVyIGEgaGFuZwogICogQGk5MTU6ICNkcm1faTkxNV9wcml2YXRlIHRv
IHJlc2V0CkBAIC0xMDIzLDkgKzEwMzgsMTMgQEAgdm9pZCBpOTE1X3Jlc2V0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8g
aW5pdGlhbGlzZSBIVyBmb2xsb3dpbmcgcmVzZXQgKCVkKVxuIiwKIAkJCSAgcmV0KTsKLQkJZ290
byBlcnJvcjsKKwkJZ290byB0YWludDsKIAl9CiAKKwlyZXQgPSByZXN1bWUoaTkxNSk7CisJaWYg
KHJldCkKKwkJZ290byB0YWludDsKKwogCWk5MTVfcXVldWVfaGFuZ2NoZWNrKGk5MTUpOwogCiBm
aW5pc2g6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCBkZWVjYmUxMjhlNWIuLjVjYzNhNzVk
NTIxYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC00Niw3ICs0Niw2IEBACiAjaW5jbHVk
ZSAiZ2VtL2k5MTVfZ2VtX2lvY3Rscy5oIgogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgog
I2luY2x1ZGUgImdlbS9pOTE1X2dlbWZzLmgiCi0jaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3Bt
LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5o
IgogI2luY2x1ZGUgImd0L2ludGVsX21vY3MuaCIKQEAgLTExOTIsMTIgKzExOTEsMTcgQEAgc3Rh
dGljIHZvaWQgaW5pdF91bnVzZWRfcmluZ3Moc3RydWN0IGludGVsX2d0ICpndCkKIAl9CiB9CiAK
LXN0YXRpYyBpbnQgaW5pdF9odyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoraW50IGk5MTVfZ2VtX2lu
aXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBndC0+aTkxNTsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUg
PSBndC0+dW5jb3JlOworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1LT51bmNv
cmU7CisJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAlpbnQgcmV0OwogCisJQlVH
X09OKCFpOTE1LT5rZXJuZWxfY29udGV4dCk7CisJcmV0ID0gaTkxNV90ZXJtaW5hbGx5X3dlZGdl
ZChpOTE1KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCiAJZ3QtPmxhc3RfaW5pdF90aW1l
ID0ga3RpbWVfZ2V0KCk7CiAKIAkvKiBEb3VibGUgbGF5ZXIgc2VjdXJpdHkgYmxhbmtldCwgc2Vl
IGk5MTVfZ2VtX2luaXQoKSAqLwpAQCAtMTI0OCw1MSArMTI1MiwxMCBAQCBzdGF0aWMgaW50IGlu
aXRfaHcoc3RydWN0IGludGVsX2d0ICpndCkKIAogCWludGVsX21vY3NfaW5pdF9sM2NjX3RhYmxl
KGd0KTsKIAotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHVuY29yZSwgRk9SQ0VXQUtFX0FM
TCk7Ci0KLQlyZXR1cm4gMDsKLQotb3V0OgotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHVu
Y29yZSwgRk9SQ0VXQUtFX0FMTCk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi1pbnQgaTkxNV9nZW1f
aW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKLXsKLQlzdHJ1Y3QgaW50ZWxf
dW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwotCWludCByZXQ7Ci0KLQlCVUdfT04oIWk5
MTUtPmtlcm5lbF9jb250ZXh0KTsKLQlyZXQgPSBpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUp
OwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQkvKiBEb3VibGUgbGF5ZXIgc2VjdXJpdHkg
YmxhbmtldCwgc2VlIGk5MTVfZ2VtX2luaXQoKSAqLwotCWludGVsX3VuY29yZV9mb3JjZXdha2Vf
Z2V0KHVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7Ci0KLQlyZXQgPSBpbml0X2h3KCZpOTE1LT5ndCk7
Ci0JaWYgKHJldCkKLQkJZ290byBlcnJfaW5pdDsKLQotCS8qIE9ubHkgd2hlbiB0aGUgSFcgaXMg
cmUtaW5pdGlhbGlzZWQsIGNhbiB3ZSByZXBsYXkgdGhlIHJlcXVlc3RzICovCi0JcmV0ID0gaW50
ZWxfZW5naW5lc19yZXN1bWUoaTkxNSk7Ci0JaWYgKHJldCkKLQkJZ290byBlcnJfZW5naW5lczsK
LQotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7Ci0K
IAlpbnRlbF9lbmdpbmVzX3NldF9zY2hlZHVsZXJfY2FwcyhpOTE1KTsKIAotCXJldHVybiAwOwot
Ci1lcnJfZW5naW5lczoKLQlpbnRlbF91Y19maW5pX2h3KGk5MTUpOwotZXJyX2luaXQ6CitvdXQ6
CiAJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQodW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKLQot
CWludGVsX2VuZ2luZXNfc2V0X3NjaGVkdWxlcl9jYXBzKGk5MTUpOwotCiAJcmV0dXJuIHJldDsK
IH0KIApAQCAtMTQ0OSwyOCArMTQxMiwyOCBAQCBzdGF0aWMgaW50IGludGVsX2VuZ2luZXNfdmVy
aWZ5X3dvcmthcm91bmRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybiBl
cnI7CiB9CiAKLWludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK2ludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCWludCByZXQ7CiAKIAkvKiBXZSBuZWVkIHRvIGZhbGxiYWNrIHRvIDRLIHBhZ2VzIGlmIGhv
c3QgZG9lc24ndCBzdXBwb3J0IGh1Z2UgZ3R0LiAqLwotCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShk
ZXZfcHJpdikgJiYgIWludGVsX3ZncHVfaGFzX2h1Z2VfZ3R0KGRldl9wcml2KSkKLQkJbWt3cml0
ZV9kZXZpY2VfaW5mbyhkZXZfcHJpdiktPnBhZ2Vfc2l6ZXMgPQorCWlmIChpbnRlbF92Z3B1X2Fj
dGl2ZShpOTE1KSAmJiAhaW50ZWxfdmdwdV9oYXNfaHVnZV9ndHQoaTkxNSkpCisJCW1rd3JpdGVf
ZGV2aWNlX2luZm8oaTkxNSktPnBhZ2Vfc2l6ZXMgPQogCQkJSTkxNV9HVFRfUEFHRV9TSVpFXzRL
OwogCi0JZGV2X3ByaXYtPm1tLnVub3JkZXJlZF90aW1lbGluZSA9IGRtYV9mZW5jZV9jb250ZXh0
X2FsbG9jKDEpOworCWk5MTUtPm1tLnVub3JkZXJlZF90aW1lbGluZSA9IGRtYV9mZW5jZV9jb250
ZXh0X2FsbG9jKDEpOwogCi0JaW50ZWxfdGltZWxpbmVzX2luaXQoZGV2X3ByaXYpOworCWludGVs
X3RpbWVsaW5lc19pbml0KGk5MTUpOwogCi0JcmV0ID0gaTkxNV9nZW1faW5pdF91c2VycHRyKGRl
dl9wcml2KTsKKwlyZXQgPSBpOTE1X2dlbV9pbml0X3VzZXJwdHIoaTkxNSk7CiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAotCXJldCA9IGludGVsX3VjX2luaXRfbWlzYyhkZXZfcHJpdik7CisJ
cmV0ID0gaW50ZWxfdWNfaW5pdF9taXNjKGk5MTUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQlyZXQgPSBpbnRlbF93b3BjbV9pbml0KCZkZXZfcHJpdi0+d29wY20pOworCXJldCA9IGlu
dGVsX3dvcGNtX2luaXQoJmk5MTUtPndvcGNtKTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl91Y19t
aXNjOwogCkBAIC0xNDgwLDUwICsxNDQzLDU1IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkgKiB3ZSBob2xkIHRoZSBmb3JjZXdha2UgZHVy
aW5nIGluaXRpYWxpc2F0aW9uIHRoZXNlIHByb2JsZW1zCiAJICoganVzdCBtYWdpY2FsbHkgZ28g
YXdheS4KIAkgKi8KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWludGVsX3VuY29y
ZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCi0JcmV0ID0g
aTkxNV9pbml0X2dndHQoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfaW5pdF9nZ3R0KGk5MTUpOwog
CWlmIChyZXQpIHsKIAkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7CiAJCWdvdG8gZXJyX3VubG9j
azsKIAl9CiAKLQlyZXQgPSBpOTE1X2dlbV9pbml0X3NjcmF0Y2goZGV2X3ByaXYsCi0JCQkJICAg
IElTX0dFTihkZXZfcHJpdiwgMikgPyBTWl8yNTZLIDogUEFHRV9TSVpFKTsKKwlyZXQgPSBpOTE1
X2dlbV9pbml0X3NjcmF0Y2goaTkxNSwKKwkJCQkgICAgSVNfR0VOKGk5MTUsIDIpID8gU1pfMjU2
SyA6IFBBR0VfU0laRSk7CiAJaWYgKHJldCkgewogCQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsK
IAkJZ290byBlcnJfZ2d0dDsKIAl9CiAKLQlyZXQgPSBpbnRlbF9lbmdpbmVzX3NldHVwKGRldl9w
cml2KTsKKwlyZXQgPSBpbnRlbF9lbmdpbmVzX3NldHVwKGk5MTUpOwogCWlmIChyZXQpIHsKIAkJ
R0VNX0JVR19PTihyZXQgPT0gLUVJTyk7CiAJCWdvdG8gZXJyX3VubG9jazsKIAl9CiAKLQlyZXQg
PSBpOTE1X2dlbV9jb250ZXh0c19pbml0KGRldl9wcml2KTsKKwlyZXQgPSBpOTE1X2dlbV9jb250
ZXh0c19pbml0KGk5MTUpOwogCWlmIChyZXQpIHsKIAkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7
CiAJCWdvdG8gZXJyX3NjcmF0Y2g7CiAJfQogCi0JcmV0ID0gaW50ZWxfZW5naW5lc19pbml0KGRl
dl9wcml2KTsKKwlyZXQgPSBpbnRlbF9lbmdpbmVzX2luaXQoaTkxNSk7CiAJaWYgKHJldCkgewog
CQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsKIAkJZ290byBlcnJfY29udGV4dDsKIAl9CiAKLQlp
bnRlbF9pbml0X2d0X3Bvd2Vyc2F2ZShkZXZfcHJpdik7CisJaW50ZWxfaW5pdF9ndF9wb3dlcnNh
dmUoaTkxNSk7CiAKLQlyZXQgPSBpbnRlbF91Y19pbml0KGRldl9wcml2KTsKKwlyZXQgPSBpbnRl
bF91Y19pbml0KGk5MTUpOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyX3BtOwogCi0JcmV0ID0gaTkx
NV9nZW1faW5pdF9odyhkZXZfcHJpdik7CisJcmV0ID0gaTkxNV9nZW1faW5pdF9odyhpOTE1KTsK
IAlpZiAocmV0KQogCQlnb3RvIGVycl91Y19pbml0OwogCisJLyogT25seSB3aGVuIHRoZSBIVyBp
cyByZS1pbml0aWFsaXNlZCwgY2FuIHdlIHJlcGxheSB0aGUgcmVxdWVzdHMgKi8KKwlyZXQgPSBp
bnRlbF9ndF9yZXN1bWUoJmk5MTUtPmd0KTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9pbml0X2h3
OworCiAJLyoKIAkgKiBEZXNwaXRlIGl0cyBuYW1lIGludGVsX2luaXRfY2xvY2tfZ2F0aW5nIGFw
cGxpZXMgYm90aCBkaXNwbGF5CiAJICogY2xvY2sgZ2F0aW5nIHdvcmthcm91bmRzOyBHVCBtbWlv
IHdvcmthcm91bmRzIGFuZCB0aGUgb2NjYXNpb25hbApAQCAtMTUzMywyOCArMTUwMSwyOCBAQCBp
bnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICoK
IAkgKiBGSVhNRTogYnJlYWsgdXAgdGhlIHdvcmthcm91bmRzIGFuZCBhcHBseSB0aGVtIGF0IHRo
ZSByaWdodCB0aW1lIQogCSAqLwotCWludGVsX2luaXRfY2xvY2tfZ2F0aW5nKGRldl9wcml2KTsK
KwlpbnRlbF9pbml0X2Nsb2NrX2dhdGluZyhpOTE1KTsKIAotCXJldCA9IGludGVsX2VuZ2luZXNf
dmVyaWZ5X3dvcmthcm91bmRzKGRldl9wcml2KTsKKwlyZXQgPSBpbnRlbF9lbmdpbmVzX3Zlcmlm
eV93b3JrYXJvdW5kcyhpOTE1KTsKIAlpZiAocmV0KQotCQlnb3RvIGVycl9pbml0X2h3OworCQln
b3RvIGVycl9ndDsKIAotCXJldCA9IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVmYXVsdHMoZGV2
X3ByaXYpOworCXJldCA9IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVmYXVsdHMoaTkxNSk7CiAJ
aWYgKHJldCkKLQkJZ290byBlcnJfaW5pdF9odzsKKwkJZ290byBlcnJfZ3Q7CiAKIAlpZiAoaTkx
NV9pbmplY3RfbG9hZF9mYWlsdXJlKCkpIHsKIAkJcmV0ID0gLUVOT0RFVjsKLQkJZ290byBlcnJf
aW5pdF9odzsKKwkJZ290byBlcnJfZ3Q7CiAJfQogCiAJaWYgKGk5MTVfaW5qZWN0X2xvYWRfZmFp
bHVyZSgpKSB7CiAJCXJldCA9IC1FSU87Ci0JCWdvdG8gZXJyX2luaXRfaHc7CisJCWdvdG8gZXJy
X2d0OwogCX0KIAotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZkZXZfcHJpdi0+dW5jb3Jl
LCBGT1JDRVdBS0VfQUxMKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211
dGV4KTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJcmV0
dXJuIDA7CiAKQEAgLTE1NjQsNjYgKzE1MzIsNjcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIEhXIGFzIGlycmV2aXNpYmx5IHdlZGdl
ZCwgYnV0IGtlZXAgZW5vdWdoIHN0YXRlIGFyb3VuZCB0aGF0IHRoZQogCSAqIGRyaXZlciBkb2Vz
bid0IGV4cGxvZGUgZHVyaW5nIHJ1bnRpbWUuCiAJICovCi1lcnJfaW5pdF9odzoKLQltdXRleF91
bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKK2Vycl9ndDoKKwltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0JaTkxNV9nZW1fc2V0X3dlZGdlZChkZXZf
cHJpdik7Ci0JaTkxNV9nZW1fc3VzcGVuZChkZXZfcHJpdik7Ci0JaTkxNV9nZW1fc3VzcGVuZF9s
YXRlKGRldl9wcml2KTsKKwlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCWk5MTVfZ2VtX3N1
c3BlbmQoaTkxNSk7CisJaTkxNV9nZW1fc3VzcGVuZF9sYXRlKGk5MTUpOwogCi0JaTkxNV9nZW1f
ZHJhaW5fd29ya3F1ZXVlKGRldl9wcml2KTsKKwlpOTE1X2dlbV9kcmFpbl93b3JrcXVldWUoaTkx
NSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaW50ZWxf
dWNfZmluaV9odyhkZXZfcHJpdik7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CitlcnJfaW5pdF9odzoKKwlpbnRlbF91Y19maW5pX2h3KGk5MTUpOwogZXJyX3VjX2luaXQ6
Ci0JaW50ZWxfdWNfZmluaShkZXZfcHJpdik7CisJaW50ZWxfdWNfZmluaShpOTE1KTsKIGVycl9w
bToKIAlpZiAocmV0ICE9IC1FSU8pIHsKLQkJaW50ZWxfY2xlYW51cF9ndF9wb3dlcnNhdmUoZGV2
X3ByaXYpOwotCQlpbnRlbF9lbmdpbmVzX2NsZWFudXAoZGV2X3ByaXYpOworCQlpbnRlbF9jbGVh
bnVwX2d0X3Bvd2Vyc2F2ZShpOTE1KTsKKwkJaW50ZWxfZW5naW5lc19jbGVhbnVwKGk5MTUpOwog
CX0KIGVycl9jb250ZXh0OgogCWlmIChyZXQgIT0gLUVJTykKLQkJaTkxNV9nZW1fY29udGV4dHNf
ZmluaShkZXZfcHJpdik7CisJCWk5MTVfZ2VtX2NvbnRleHRzX2ZpbmkoaTkxNSk7CiBlcnJfc2Ny
YXRjaDoKLQlpOTE1X2dlbV9maW5pX3NjcmF0Y2goZGV2X3ByaXYpOworCWk5MTVfZ2VtX2Zpbmlf
c2NyYXRjaChpOTE1KTsKIGVycl9nZ3R0OgogZXJyX3VubG9jazoKLQlpbnRlbF91bmNvcmVfZm9y
Y2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7Ci0JbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2Fr
ZV9wdXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAogZXJyX3VjX21pc2M6Ci0JaW50ZWxfdWNfZmluaV9taXNj
KGRldl9wcml2KTsKKwlpbnRlbF91Y19maW5pX21pc2MoaTkxNSk7CiAKIAlpZiAocmV0ICE9IC1F
SU8pIHsKLQkJaTkxNV9nZW1fY2xlYW51cF91c2VycHRyKGRldl9wcml2KTsKLQkJaW50ZWxfdGlt
ZWxpbmVzX2ZpbmkoZGV2X3ByaXYpOworCQlpOTE1X2dlbV9jbGVhbnVwX3VzZXJwdHIoaTkxNSk7
CisJCWludGVsX3RpbWVsaW5lc19maW5pKGk5MTUpOwogCX0KIAogCWlmIChyZXQgPT0gLUVJTykg
ewotCQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJCS8qCiAJCSAqIEFsbG93IGVuZ2luZSBp
bml0aWFsaXNhdGlvbiB0byBmYWlsIGJ5IG1hcmtpbmcgdGhlIEdQVSBhcwogCQkgKiB3ZWRnZWQu
IEJ1dCB3ZSBvbmx5IHdhbnQgdG8gZG8gdGhpcyB3aGVyZSB0aGUgR1BVIGlzIGFuZ3J5LAogCQkg
KiBmb3IgYWxsIG90aGVyIGZhaWx1cmUsIHN1Y2ggYXMgYW4gYWxsb2NhdGlvbiBmYWlsdXJlLCBi
YWlsLgogCQkgKi8KLQkJaWYgKCFpOTE1X3Jlc2V0X2ZhaWxlZChkZXZfcHJpdikpIHsKLQkJCWk5
MTVfbG9hZF9lcnJvcihkZXZfcHJpdiwKKwkJaWYgKCFpOTE1X3Jlc2V0X2ZhaWxlZChpOTE1KSkg
eworCQkJaTkxNV9sb2FkX2Vycm9yKGk5MTUsCiAJCQkJCSJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBH
UFUsIGRlY2xhcmluZyBpdCB3ZWRnZWQhXG4iKTsKLQkJCWk5MTVfZ2VtX3NldF93ZWRnZWQoZGV2
X3ByaXYpOworCQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKIAkJfQogCiAJCS8qIE1pbmlt
YWwgYmFzaWMgcmVjb3ZlcnkgZm9yIEtNUyAqLwotCQlyZXQgPSBpOTE1X2dndHRfZW5hYmxlX2h3
KGRldl9wcml2KTsKLQkJaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3MoZGV2X3ByaXYpOwot
CQlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhkZXZfcHJpdik7Ci0JCWludGVsX2luaXRfY2xvY2tf
Z2F0aW5nKGRldl9wcml2KTsKKwkJcmV0ID0gaTkxNV9nZ3R0X2VuYWJsZV9odyhpOTE1KTsKKwkJ
aTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3MoaTkxNSk7CisJCWk5MTVfZ2VtX3Jlc3RvcmVf
ZmVuY2VzKGk5MTUpOworCQlpbnRlbF9pbml0X2Nsb2NrX2dhdGluZyhpOTE1KTsKIAotCQltdXRl
eF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwkJbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl9CiAKLQlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmpl
Y3RzKGRldl9wcml2KTsKKwlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwogCXJl
dHVybiByZXQ7CiB9CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D49012DBF68
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Dec 2020 12:30:12 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 184666E118;
	Wed, 16 Dec 2020 11:30:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B75586E118
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Dec 2020 11:30:09 +0000 (UTC)
IronPort-SDR: /15LXChgN9WTKJgFEPTZA4xtxk7Xd3J8IbUzOQlxT+ZcZ8lFD5RVcyWC/qWX9+AhbBkSvkqJjO
 z5K1aUjfGH4Q==
X-IronPort-AV: E=McAfee;i="6000,8403,9836"; a="236629488"
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="236629488"
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga104.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 03:30:09 -0800
IronPort-SDR: qzd2g+TetFXvJTpxcrT38zj0CLRrchth0jRpTePdDR4YvxXiuKXUiyieVQ3uzYE8GIooqKP3wx
 XCNlgoAHFLMQ==
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="451875391"
Received: from slevy-mobl.ger.corp.intel.com (HELO localhost)
 ([10.214.192.176])
 by fmsmga001-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 03:30:03 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Dec 2020 13:29:12 +0200
Message-Id: <72e2f24020bb18931b34f990372636e2c67ebd5d.1608117676.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1608117676.git.jani.nikula@intel.com>
References: <cover.1608117676.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 05/11] drm/i915: refactor some crtc code out
 of intel display.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Dave Airlie <airlied@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClRoZXJlIG1heSBiZSBtb3Jl
IGNydGMgY29kZSB0aGF0IGNhbiBiZSBwdWxsZWQgb3V0LCBidXQgdGhpcwppcyBhIGdvb2Qgc3Rh
cnQuCgpTaWduZWQtb2ZmLWJ5OiBEYXZlIEFpcmxpZSA8YWlybGllZEByZWRoYXQuY29tPgpbSmFu
aTogY2xlYW5lZCB1cCBpbnRlbF9jcnRjLmggYSBiaXQuXQpTaWduZWQtb2ZmLWJ5OiBKYW5pIE5p
a3VsYSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01h
a2VmaWxlICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfY3J0Yy5jICAgIHwgOTUzICsrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0Yy5oICAgIHwgIDIyICsKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgOTM0ICstLS0tLS0tLS0tLS0tLS0tLQog
NCBmaWxlcyBjaGFuZ2VkLCA5NzcgaW5zZXJ0aW9ucygrKSwgOTMzIGRlbGV0aW9ucygtKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0Yy5j
CiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9j
cnRjLmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGI2NTU4NDAxNjkxZS4uZjJlOTA3MzMzZjcy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtMTk3LDYgKzE5Nyw3IEBAIGk5MTUteSArPSBcCiAJ
ZGlzcGxheS9pbnRlbF9jb2xvci5vIFwKIAlkaXNwbGF5L2ludGVsX2NvbWJvX3BoeS5vIFwKIAlk
aXNwbGF5L2ludGVsX2Nvbm5lY3Rvci5vIFwKKwlkaXNwbGF5L2ludGVsX2NydGMubyBcCiAJZGlz
cGxheS9pbnRlbF9jc3IubyBcCiAJZGlzcGxheS9pbnRlbF9jdXJzb3IubyBcCiAJZGlzcGxheS9p
bnRlbF9kaXNwbGF5Lm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9jcnRjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydGMu
YwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmQyNmJlYjhhZDllZAot
LS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0
Yy5jCkBAIC0wLDAgKzEsOTUzIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisv
KgorICogQ29weXJpZ2h0IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworI2luY2x1ZGUg
PGxpbnV4L2tlcm5lbC5oPgorI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KKworI2luY2x1ZGUgPGRy
bS9kcm1fYXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+CisjaW5j
bHVkZSA8ZHJtL2RybV9wbGFuZS5oPgorI2luY2x1ZGUgPGRybS9kcm1fcGxhbmVfaGVscGVyLmg+
CisKKyNpbmNsdWRlICJpbnRlbF9hdG9taWMuaCIKKyNpbmNsdWRlICJpbnRlbF9hdG9taWNfcGxh
bmUuaCIKKyNpbmNsdWRlICJpbnRlbF9jb2xvci5oIgorI2luY2x1ZGUgImludGVsX2NydGMuaCIK
KyNpbmNsdWRlICJpbnRlbF9jdXJzb3IuaCIKKyNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X2RlYnVn
ZnMuaCIKKyNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCisjaW5jbHVkZSAiaW50ZWxf
cGlwZV9jcmMuaCIKKyNpbmNsdWRlICJpbnRlbF9zcHJpdGUuaCIKKworLyogUHJpbWFyeSBwbGFu
ZSBmb3JtYXRzIGZvciBnZW4gPD0gMyAqLworc3RhdGljIGNvbnN0IHUzMiBpOHh4X3ByaW1hcnlf
Zm9ybWF0c1tdID0geworCURSTV9GT1JNQVRfQzgsCisJRFJNX0ZPUk1BVF9YUkdCMTU1NSwKKwlE
Uk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorfTsKKworLyogUHJpbWFy
eSBwbGFuZSBmb3JtYXRzIGZvciBpdmIgKG5vIGZwMTYgZHVlIHRvIGh3IGlzc3VlKSAqLworc3Rh
dGljIGNvbnN0IHUzMiBpdmJfcHJpbWFyeV9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9DOCwK
KwlEUk1fRk9STUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JNQVRf
WEJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hCR1IyMTAx
MDEwLAorfTsKKworLyogUHJpbWFyeSBwbGFuZSBmb3JtYXRzIGZvciBnZW4gPj0gNCwgZXhjZXB0
IGl2YiAqLworc3RhdGljIGNvbnN0IHUzMiBpOTY1X3ByaW1hcnlfZm9ybWF0c1tdID0geworCURS
TV9GT1JNQVRfQzgsCisJRFJNX0ZPUk1BVF9SR0I1NjUsCisJRFJNX0ZPUk1BVF9YUkdCODg4OCwK
KwlEUk1fRk9STUFUX1hCR1I4ODg4LAorCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZP
Uk1BVF9YQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkYsCit9OworCisvKiBQ
cmltYXJ5IHBsYW5lIGZvcm1hdHMgZm9yIHZsdi9jaHYgKi8KK3N0YXRpYyBjb25zdCB1MzIgdmx2
X3ByaW1hcnlfZm9ybWF0c1tdID0geworCURSTV9GT1JNQVRfQzgsCisJRFJNX0ZPUk1BVF9SR0I1
NjUsCisJRFJNX0ZPUk1BVF9YUkdCODg4OCwKKwlEUk1fRk9STUFUX1hCR1I4ODg4LAorCURSTV9G
T1JNQVRfQVJHQjg4ODgsCisJRFJNX0ZPUk1BVF9BQkdSODg4OCwKKwlEUk1fRk9STUFUX1hSR0Iy
MTAxMDEwLAorCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9BUkdCMjEwMTAx
MCwKKwlEUk1fRk9STUFUX0FCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RiwK
K307CisKK3N0YXRpYyBjb25zdCB1NjQgaTl4eF9mb3JtYXRfbW9kaWZpZXJzW10gPSB7CisJSTkx
NV9GT1JNQVRfTU9EX1hfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JN
QVRfTU9EX0lOVkFMSUQKK307CisKK3N0YXRpYyBib29sIGk4eHhfcGxhbmVfZm9ybWF0X21vZF9z
dXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAorCQkJCQkgICAgdTMyIGZvcm1hdCwg
dTY0IG1vZGlmaWVyKQoreworCXN3aXRjaCAobW9kaWZpZXIpIHsKKwljYXNlIERSTV9GT1JNQVRf
TU9EX0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgorCQlicmVhazsKKwlk
ZWZhdWx0OgorCQlyZXR1cm4gZmFsc2U7CisJfQorCisJc3dpdGNoIChmb3JtYXQpIHsKKwljYXNl
IERSTV9GT1JNQVRfQzg6CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwljYXNlIERSTV9GT1JN
QVRfWFJHQjE1NTU6CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCQlyZXR1cm4gbW9kaWZp
ZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8CisJCQltb2RpZmllciA9PSBJOTE1X0ZPUk1B
VF9NT0RfWF9USUxFRDsKKwlkZWZhdWx0OgorCQlyZXR1cm4gZmFsc2U7CisJfQorfQorCitzdGF0
aWMgYm9vbCBpOTY1X3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUg
Kl9wbGFuZSwKKwkJCQkJICAgIHUzMiBmb3JtYXQsIHU2NCBtb2RpZmllcikKK3sKKwlzd2l0Y2gg
KG1vZGlmaWVyKSB7CisJY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6CisJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWF9USUxFRDoKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOwor
CX0KKworCXN3aXRjaCAoZm9ybWF0KSB7CisJY2FzZSBEUk1fRk9STUFUX0M4OgorCWNhc2UgRFJN
X0ZPUk1BVF9SR0I1NjU6CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZP
Uk1BVF9YQkdSODg4ODoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9S
TUFUX0FCR1I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwljYXNlIERSTV9G
T1JNQVRfWEJHUjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCWNhc2Ug
RFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoK
KwkJcmV0dXJuIG1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUiB8fAorCQkJbW9kaWZp
ZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNl
OworCX0KK30KKworc3RhdGljIGJvb2wgaTl4eF9wbGFuZV9oYXNfZmJjKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgICAgICBlbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9w
bGFuZSkKK3sKKwlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlp
ZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSkKKwkJcmV0
dXJuIGk5eHhfcGxhbmUgPT0gUExBTkVfQTsgLyogdGllZCB0byBwaXBlIEEgKi8KKwllbHNlIGlm
IChJU19JVllCUklER0UoZGV2X3ByaXYpKQorCQlyZXR1cm4gaTl4eF9wbGFuZSA9PSBQTEFORV9B
IHx8IGk5eHhfcGxhbmUgPT0gUExBTkVfQiB8fAorCQkJaTl4eF9wbGFuZSA9PSBQTEFORV9DOwor
CWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKKwkJcmV0dXJuIGk5eHhfcGxhbmUg
PT0gUExBTkVfQSB8fCBpOXh4X3BsYW5lID09IFBMQU5FX0I7CisJZWxzZQorCQlyZXR1cm4gaTl4
eF9wbGFuZSA9PSBQTEFORV9BOworfQorCitzdGF0aWMgdm9pZCBhc3NlcnRfdmJsYW5rX2Rpc2Fi
bGVkKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKK3sKKwlpZiAoSTkxNV9TVEFURV9XQVJOX09OKGRy
bV9jcnRjX3ZibGFua19nZXQoY3J0YykgPT0gMCkpCisJCWRybV9jcnRjX3ZibGFua19wdXQoY3J0
Yyk7Cit9CisKK3UzMiBpbnRlbF9jcnRjX2dldF92YmxhbmtfY291bnRlcihzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7
CisJc3RydWN0IGRybV92YmxhbmtfY3J0YyAqdmJsYW5rID0gJmRldi0+dmJsYW5rW2RybV9jcnRj
X2luZGV4KCZjcnRjLT5iYXNlKV07CisKKwlpZiAoIXZibGFuay0+bWF4X3ZibGFua19jb3VudCkK
KwkJcmV0dXJuICh1MzIpZHJtX2NydGNfYWNjdXJhdGVfdmJsYW5rX2NvdW50KCZjcnRjLT5iYXNl
KTsKKworCXJldHVybiBjcnRjLT5iYXNlLmZ1bmNzLT5nZXRfdmJsYW5rX2NvdW50ZXIoJmNydGMt
PmJhc2UpOworfQorCit1MzIgaW50ZWxfY3J0Y19tYXhfdmJsYW5rX2NvdW50KGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOworCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNy
dGMpOworCXUzMiBtb2RlX2ZsYWdzID0gY3J0Yy0+bW9kZV9mbGFnczsKKworCS8qCisJICogRnJv
bSBHZW4gMTEsIEluIGNhc2Ugb2YgZHNpIGNtZCBtb2RlLCBmcmFtZSBjb3VudGVyIHdvdWxkbnQK
KwkgKiBoYXZlIHVwZGF0ZWQgYXQgdGhlIGJlZ2lubmluZyBvZiBURSwgaWYgd2Ugd2FudCB0byB1
c2UKKwkgKiB0aGUgaHcgY291bnRlciwgdGhlbiB3ZSB3b3VsZCBmaW5kIGl0IHVwZGF0ZWQgaW4g
b25seQorCSAqIHRoZSBuZXh0IFRFLCBoZW5jZSBzd2l0Y2hpbmcgdG8gc3cgY291bnRlci4KKwkg
Ki8KKwlpZiAobW9kZV9mbGFncyAmIChJOTE1X01PREVfRkxBR19EU0lfVVNFX1RFMCB8IEk5MTVf
TU9ERV9GTEFHX0RTSV9VU0VfVEUxKSkKKwkJcmV0dXJuIDA7CisKKwkvKgorCSAqIE9uIGk5NjVn
bSB0aGUgaGFyZHdhcmUgZnJhbWUgY291bnRlciByZWFkcworCSAqIHplcm8gd2hlbiB0aGUgVFYg
ZW5jb2RlciBpcyBlbmFibGVkIDooCisJICovCisJaWYgKElTX0k5NjVHTShkZXZfcHJpdikgJiYK
KwkgICAgKGNydGNfc3RhdGUtPm91dHB1dF90eXBlcyAmIEJJVChJTlRFTF9PVVRQVVRfVFZPVVQp
KSkKKwkJcmV0dXJuIDA7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA1IHx8IElTX0c0
WChkZXZfcHJpdikpCisJCXJldHVybiAweGZmZmZmZmZmOyAvKiBmdWxsIDMyIGJpdCBjb3VudGVy
ICovCisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAzKQorCQlyZXR1cm4gMHhmZmZm
ZmY7IC8qIG9ubHkgMjQgYml0cyBvZiBmcmFtZSBjb3VudCAqLworCWVsc2UKKwkJcmV0dXJuIDA7
IC8qIEdlbjIgZG9lc24ndCBoYXZlIGEgaGFyZHdhcmUgZnJhbWUgY291bnRlciAqLworfQorCit2
b2lkIGludGVsX2NydGNfdmJsYW5rX29uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpOworCisJYXNzZXJ0X3ZibGFua19kaXNhYmxlZCgmY3J0Yy0+
YmFzZSk7CisJZHJtX2NydGNfc2V0X21heF92YmxhbmtfY291bnQoJmNydGMtPmJhc2UsCisJCQkJ
ICAgICAgaW50ZWxfY3J0Y19tYXhfdmJsYW5rX2NvdW50KGNydGNfc3RhdGUpKTsKKwlkcm1fY3J0
Y192Ymxhbmtfb24oJmNydGMtPmJhc2UpOworfQorCit2b2lkIGludGVsX2NydGNfdmJsYW5rX29m
Zihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
KworCWRybV9jcnRjX3ZibGFua19vZmYoJmNydGMtPmJhc2UpOworCWFzc2VydF92YmxhbmtfZGlz
YWJsZWQoJmNydGMtPmJhc2UpOworfQorCitzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqaW50ZWxf
Y3J0Y19zdGF0ZV9hbGxvYyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKworCWNydGNfc3RhdGUgPSBrbWFsbG9jKHNpemVv
ZigqY3J0Y19zdGF0ZSksIEdGUF9LRVJORUwpOworCisJaWYgKGNydGNfc3RhdGUpCisJCWludGVs
X2NydGNfc3RhdGVfcmVzZXQoY3J0Y19zdGF0ZSwgY3J0Yyk7CisKKwlyZXR1cm4gY3J0Y19zdGF0
ZTsKK30KKwordm9pZCBpbnRlbF9jcnRjX3N0YXRlX3Jlc2V0KHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAorCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQoreworCW1l
bXNldChjcnRjX3N0YXRlLCAwLCBzaXplb2YoKmNydGNfc3RhdGUpKTsKKworCV9fZHJtX2F0b21p
Y19oZWxwZXJfY3J0Y19zdGF0ZV9yZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSwgJmNydGMtPmJhc2Up
OworCisJY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIgPSBJTlZBTElEX1RSQU5TQ09ERVI7CisJ
Y3J0Y19zdGF0ZS0+bWFzdGVyX3RyYW5zY29kZXIgPSBJTlZBTElEX1RSQU5TQ09ERVI7CisJY3J0
Y19zdGF0ZS0+aHN3X3dvcmthcm91bmRfcGlwZSA9IElOVkFMSURfUElQRTsKKwljcnRjX3N0YXRl
LT5vdXRwdXRfZm9ybWF0ID0gSU5URUxfT1VUUFVUX0ZPUk1BVF9JTlZBTElEOworCWNydGNfc3Rh
dGUtPnNjYWxlcl9zdGF0ZS5zY2FsZXJfaWQgPSAtMTsKKwljcnRjX3N0YXRlLT5tc3RfbWFzdGVy
X3RyYW5zY29kZXIgPSBJTlZBTElEX1RSQU5TQ09ERVI7Cit9CisKK3N0YXRpYyBib29sIGk5eHhf
cGxhbmVfaGFzX3dpbmRvd2luZyhzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsK
KwllbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHBsYW5lLT5pOXh4X3BsYW5lOworCisJ
aWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCQlyZXR1cm4gaTl4eF9wbGFuZSA9PSBQTEFO
RV9COworCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSB8fCBJU19HNFgoZGV2X3By
aXYpKQorCQlyZXR1cm4gZmFsc2U7CisJZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA0KSkKKwkJ
cmV0dXJuIGk5eHhfcGxhbmUgPT0gUExBTkVfQzsKKwllbHNlCisJCXJldHVybiBpOXh4X3BsYW5l
ID09IFBMQU5FX0IgfHwKKwkJCWk5eHhfcGxhbmUgPT0gUExBTkVfQzsKK30KKworc3RhdGljIHUz
MiBpOXh4X3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCQl0b19pOTE1KHBsYW5lX3N0
YXRlLT51YXBpLnBsYW5lLT5kZXYpOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0
YXRlLT5ody5yb3RhdGlvbjsKKwl1MzIgZHNwY250cjsKKworCWRzcGNudHIgPSBESVNQTEFZX1BM
QU5FX0VOQUJMRTsKKworCWlmIChJU19HNFgoZGV2X3ByaXYpIHx8IElTX0dFTihkZXZfcHJpdiwg
NSkgfHwKKwkgICAgSVNfR0VOKGRldl9wcml2LCA2KSB8fCBJU19JVllCUklER0UoZGV2X3ByaXYp
KQorCQlkc3BjbnRyIHw9IERJU1BQTEFORV9UUklDS0xFX0ZFRURfRElTQUJMRTsKKworCXN3aXRj
aCAoZmItPmZvcm1hdC0+Zm9ybWF0KSB7CisJY2FzZSBEUk1fRk9STUFUX0M4OgorCQlkc3BjbnRy
IHw9IERJU1BQTEFORV84QlBQOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE1NTU6
CisJCWRzcGNudHIgfD0gRElTUFBMQU5FX0JHUlg1NTU7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZP
Uk1BVF9BUkdCMTU1NToKKwkJZHNwY250ciB8PSBESVNQUExBTkVfQkdSQTU1NTsKKwkJYnJlYWs7
CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJZHNwY250ciB8PSBESVNQUExBTkVfQkdSWDU2
NTsKKwkJYnJlYWs7CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCQlkc3BjbnRyIHw9IERJ
U1BQTEFORV9CR1JYODg4OworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJ
CWRzcGNudHIgfD0gRElTUFBMQU5FX1JHQlg4ODg7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1B
VF9BUkdCODg4ODoKKwkJZHNwY250ciB8PSBESVNQUExBTkVfQkdSQTg4ODsKKwkJYnJlYWs7CisJ
Y2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgorCQlkc3BjbnRyIHw9IERJU1BQTEFORV9SR0JBODg4
OworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6CisJCWRzcGNudHIgfD0g
RElTUFBMQU5FX0JHUlgxMDEwMTA7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEw
MTAxMDoKKwkJZHNwY250ciB8PSBESVNQUExBTkVfUkdCWDEwMTAxMDsKKwkJYnJlYWs7CisJY2Fz
ZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCQlkc3BjbnRyIHw9IERJU1BQTEFORV9CR1JBMTAx
MDEwOworCQlicmVhazsKKwljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6CisJCWRzcGNudHIg
fD0gRElTUFBMQU5FX1JHQkExMDEwMTA7CisJCWJyZWFrOworCWNhc2UgRFJNX0ZPUk1BVF9YQkdS
MTYxNjE2MTZGOgorCQlkc3BjbnRyIHw9IERJU1BQTEFORV9SR0JYMTYxNjE2OworCQlicmVhazsK
KwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoZmItPmZvcm1hdC0+Zm9ybWF0KTsKKwkJcmV0dXJu
IDA7CisJfQorCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCAmJgorCSAgICBmYi0+bW9k
aWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQpCisJCWRzcGNudHIgfD0gRElTUFBMQU5F
X1RJTEVEOworCisJaWYgKHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkKKwkJZHNwY250
ciB8PSBESVNQUExBTkVfUk9UQVRFXzE4MDsKKworCWlmIChyb3RhdGlvbiAmIERSTV9NT0RFX1JF
RkxFQ1RfWCkKKwkJZHNwY250ciB8PSBESVNQUExBTkVfTUlSUk9SOworCisJcmV0dXJuIGRzcGNu
dHI7Cit9CisKK3N0YXRpYyBpbnQKK2k5eHhfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCisJCSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQoreworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFu
ZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CisJaW50IHJldDsKKworCXJldCA9IGNodl9wbGFuZV9jaGVj
a19yb3RhdGlvbihwbGFuZV9zdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJl
dCA9IGludGVsX2F0b21pY19wbGFuZV9jaGVja19jbGlwcGluZyhwbGFuZV9zdGF0ZSwgY3J0Y19z
dGF0ZSwKKwkJCQkJCURSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKKwkJCQkJCURSTV9QTEFO
RV9IRUxQRVJfTk9fU0NBTElORywKKwkJCQkJCWk5eHhfcGxhbmVfaGFzX3dpbmRvd2luZyhwbGFu
ZSkpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBpOXh4X2NoZWNrX3BsYW5l
X3N1cmZhY2UocGxhbmVfc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpZiAo
IXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCisJCXJldHVybiAwOworCisJcmV0ID0gaW50ZWxf
cGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQly
ZXR1cm4gcmV0OworCisJcGxhbmVfc3RhdGUtPmN0bCA9IGk5eHhfcGxhbmVfY3RsKGNydGNfc3Rh
dGUsIHBsYW5lX3N0YXRlKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgdTMyIGk5eHhfcGxh
bmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7
CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVh
cGkuY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjLT5iYXNlLmRldik7CisJdTMyIGRzcGNudHIgPSAwOworCisJaWYgKGNydGNfc3RhdGUtPmdh
bW1hX2VuYWJsZSkKKwkJZHNwY250ciB8PSBESVNQUExBTkVfR0FNTUFfRU5BQkxFOworCisJaWYg
KGNydGNfc3RhdGUtPmNzY19lbmFibGUpCisJCWRzcGNudHIgfD0gRElTUFBMQU5FX1BJUEVfQ1ND
X0VOQUJMRTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNSkKKwkJZHNwY250ciB8PSBE
SVNQUExBTkVfU0VMX1BJUEUoY3J0Yy0+cGlwZSk7CisKKwlyZXR1cm4gZHNwY250cjsKK30KKwor
c3RhdGljIHZvaWQgaTl4eF9wbGFuZV9yYXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSwKKwkJCSAgICAgdW5zaWduZWQgaW50ICpudW0sIHVuc2lnbmVkIGludCAqZGVu
KQoreworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3
LmZiOworCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CisKKwkvKgorCSAq
IGc0eCBic3BlYyBzYXlzIDY0YnBwIHBpeGVsIHJhdGUgY2FuJ3QgZXhjZWVkIDgwJQorCSAqIG9m
IGNkY2xrIHdoZW4gdGhlIHNwcml0ZSBwbGFuZSBpcyBlbmFibGVkIG9uIHRoZQorCSAqIHNhbWUg
cGlwZS4gaWxrL3NuYiBic3BlYyBzYXlzIDY0YnBwIHBpeGVsIHJhdGUgaXMKKwkgKiBuZXZlciBh
bGxvd2VkIHRvIGV4Y2VlZCA4MCUgb2YgY2RjbGsuIExldCdzIGp1c3QgZ28KKwkgKiB3aXRoIHRo
ZSBpbGsvc25iIGxpbWl0IGFsd2F5cy4KKwkgKi8KKwlpZiAoY3BwID09IDgpIHsKKwkJKm51bSA9
IDEwOworCQkqZGVuID0gODsKKwl9IGVsc2UgeworCQkqbnVtID0gMTsKKwkJKmRlbiA9IDE7CisJ
fQorfQorCitzdGF0aWMgaW50IGk5eHhfcGxhbmVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJdW5zaWduZWQgaW50IHBpeGVsX3JhdGU7CisJdW5zaWdu
ZWQgaW50IG51bSwgZGVuOworCisJLyoKKwkgKiBOb3RlIHRoYXQgY3J0Y19zdGF0ZS0+cGl4ZWxf
cmF0ZSBhY2NvdW50cyBmb3IgYm90aAorCSAqIGhvcml6b250YWwgYW5kIHZlcnRpY2FsIHBhbmVs
IGZpdHRlciBkb3duc2NhbGluZyBmYWN0b3JzLgorCSAqIFByZS1IU1cgYnNwZWMgdGVsbHMgdXMg
dG8gb25seSBjb25zaWRlciB0aGUgaG9yaXpvbnRhbAorCSAqIGRvd25zY2FsaW5nIGZhY3RvciBo
ZXJlLiBXZSBpZ25vcmUgdGhhdCBhbmQganVzdCBjb25zaWRlcgorCSAqIGJvdGggZm9yIHNpbXBs
aWNpdHkuCisJICovCisJcGl4ZWxfcmF0ZSA9IGNydGNfc3RhdGUtPnBpeGVsX3JhdGU7CisKKwlp
OXh4X3BsYW5lX3JhdGlvKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCAmbnVtLCAmZGVuKTsKKwor
CS8qIHR3byBwaXhlbHMgcGVyIGNsb2NrIHdpdGggZG91YmxlIHdpZGUgcGlwZSAqLworCWlmIChj
cnRjX3N0YXRlLT5kb3VibGVfd2lkZSkKKwkJZGVuICo9IDI7CisKKwlyZXR1cm4gRElWX1JPVU5E
X1VQKHBpeGVsX3JhdGUgKiBudW0sIGRlbik7Cit9CisKK3N0YXRpYyB2b2lkIGk5eHhfdXBkYXRl
X3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkgICAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCWVudW0gaTl4eF9wbGFuZV9p
ZCBpOXh4X3BsYW5lID0gcGxhbmUtPmk5eHhfcGxhbmU7CisJdTMyIGxpbmVhcl9vZmZzZXQ7CisJ
aW50IHggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueDsKKwlpbnQgeSA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVswXS55OworCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5k
c3QueDE7CisJaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKKwlpbnQgY3J0
Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CisJaW50IGNydGNf
aCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1bnNpZ25lZCBs
b25nIGlycWZsYWdzOworCXUzMiBkc3BhZGRyX29mZnNldDsKKwl1MzIgZHNwY250cjsKKworCWRz
cGNudHIgPSBwbGFuZV9zdGF0ZS0+Y3RsIHwgaTl4eF9wbGFuZV9jdGxfY3J0YyhjcnRjX3N0YXRl
KTsKKworCWxpbmVhcl9vZmZzZXQgPSBpbnRlbF9mYl94eV90b19saW5lYXIoeCwgeSwgcGxhbmVf
c3RhdGUsIDApOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKKwkJZHNwYWRkcl9v
ZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0OworCWVsc2UKKwkJZHNw
YWRkcl9vZmZzZXQgPSBsaW5lYXJfb2Zmc2V0OworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9w
cml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsIERTUFNUUklERShpOXh4X3BsYW5lKSwKKwkJCSAgcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
WzBdLnN0cmlkZSk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDQpIHsKKwkJLyoKKwkJ
ICogUExBTkVfQSBkb2Vzbid0IGFjdHVhbGx5IGhhdmUgYSBmdWxsIHdpbmRvdworCQkgKiBnZW5l
cmF0b3IgYnV0IGxldCdzIGFzc3VtZSB3ZSBzdGlsbCBuZWVkIHRvCisJCSAqIHByb2dyYW0gd2hh
dGV2ZXIgaXMgdGhlcmUuCisJCSAqLworCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgRFNQ
UE9TKGk5eHhfcGxhbmUpLAorCQkJCSAgKGNydGNfeSA8PCAxNikgfCBjcnRjX3gpOworCQlpbnRl
bF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgRFNQU0laRShpOXh4X3BsYW5lKSwKKwkJCQkgICgoY3J0
Y19oIC0gMSkgPDwgMTYpIHwgKGNydGNfdyAtIDEpKTsKKwl9IGVsc2UgaWYgKElTX0NIRVJSWVZJ
RVcoZGV2X3ByaXYpICYmIGk5eHhfcGxhbmUgPT0gUExBTkVfQikgeworCQlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgUFJJTVBPUyhpOXh4X3BsYW5lKSwKKwkJCQkgIChjcnRjX3kgPDwgMTYp
IHwgY3J0Y194KTsKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBSSU1TSVpFKGk5eHhf
cGxhbmUpLAorCQkJCSAgKChjcnRjX2ggLSAxKSA8PCAxNikgfCAoY3J0Y193IC0gMSkpOworCQlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUFJJTUNOU1RBTFBIQShpOXh4X3BsYW5lKSwgMCk7
CisJfQorCisJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJp
dikpIHsKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIERTUE9GRlNFVChpOXh4X3BsYW5l
KSwKKwkJCQkgICh5IDw8IDE2KSB8IHgpOworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA0KSB7CisJCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBEU1BMSU5PRkYoaTl4eF9w
bGFuZSksCisJCQkJICBsaW5lYXJfb2Zmc2V0KTsKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsIERTUFRJTEVPRkYoaTl4eF9wbGFuZSksCisJCQkJICAoeSA8PCAxNikgfCB4KTsKKwl9CisK
KwkvKgorCSAqIFRoZSBjb250cm9sIHJlZ2lzdGVyIHNlbGYtYXJtcyBpZiB0aGUgcGxhbmUgd2Fz
IHByZXZpb3VzbHkKKwkgKiBkaXNhYmxlZC4gVHJ5IHRvIG1ha2UgdGhlIHBsYW5lIGVuYWJsZSBh
dG9taWMgYnkgd3JpdGluZworCSAqIHRoZSBjb250cm9sIHJlZ2lzdGVyIGp1c3QgYmVmb3JlIHRo
ZSBzdXJmYWNlIHJlZ2lzdGVyLgorCSAqLworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBE
U1BDTlRSKGk5eHhfcGxhbmUpLCBkc3BjbnRyKTsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA0KQorCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgRFNQU1VSRihpOXh4X3BsYW5lKSwK
KwkJCQkgIGludGVsX3BsYW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSArIGRzcGFkZHJfb2Zm
c2V0KTsKKwllbHNlCisJCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBEU1BBRERSKGk5eHhf
cGxhbmUpLAorCQkJCSAgaW50ZWxfcGxhbmVfZ2d0dF9vZmZzZXQocGxhbmVfc3RhdGUpICsgZHNw
YWRkcl9vZmZzZXQpOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29y
ZS5sb2NrLCBpcnFmbGFncyk7Cit9CisKK3N0YXRpYyB2b2lkIGk5eHhfZGlzYWJsZV9wbGFuZShz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwllbnVtIGk5eHhfcGxhbmVfaWQgaTl4
eF9wbGFuZSA9IHBsYW5lLT5pOXh4X3BsYW5lOworCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisJ
dTMyIGRzcGNudHI7CisKKwkvKgorCSAqIERTUENOVFIgcGlwZSBnYW1tYSBlbmFibGUgb24gZzR4
KyBhbmQgcGlwZSBjc2MKKwkgKiBlbmFibGUgb24gaWxrKyBhZmZlY3QgdGhlIHBpcGUgYm90dG9t
IGNvbG9yIGFzCisJICogd2VsbCwgc28gd2UgbXVzdCBjb25maWd1cmUgdGhlbSBldmVuIGlmIHRo
ZSBwbGFuZQorCSAqIGlzIGRpc2FibGVkLgorCSAqCisJICogT24gcHJlLWc0eCB0aGVyZSBpcyBu
byB3YXkgdG8gZ2FtbWEgY29ycmVjdCB0aGUKKwkgKiBwaXBlIGJvdHRvbSBjb2xvciBidXQgd2Un
bGwga2VlcCBvbiBkb2luZyB0aGlzCisJICogYW55d2F5IHNvIHRoYXQgdGhlIGNydGMgc3RhdGUg
cmVhZG91dCB3b3JrcyBjb3JyZWN0bHkuCisJICovCisJZHNwY250ciA9IGk5eHhfcGxhbmVfY3Rs
X2NydGMoY3J0Y19zdGF0ZSk7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29y
ZS5sb2NrLCBpcnFmbGFncyk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgRFNQQ05U
UihpOXh4X3BsYW5lKSwgZHNwY250cik7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkK
KwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIERTUFNVUkYoaTl4eF9wbGFuZSksIDApOwor
CWVsc2UKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIERTUEFERFIoaTl4eF9wbGFuZSks
IDApOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBp
cnFmbGFncyk7Cit9CisKK3N0YXRpYyBib29sIGk5eHhfcGxhbmVfZ2V0X2h3X3N0YXRlKHN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkJICAgIGVudW0gcGlwZSAqcGlwZSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7
CisJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47CisJZW51bSBp
OXh4X3BsYW5lX2lkIGk5eHhfcGxhbmUgPSBwbGFuZS0+aTl4eF9wbGFuZTsKKwlpbnRlbF93YWtl
cmVmX3Qgd2FrZXJlZjsKKwlib29sIHJldDsKKwl1MzIgdmFsOworCisJLyoKKwkgKiBOb3QgMTAw
JSBjb3JyZWN0IGZvciBwbGFuZXMgdGhhdCBjYW4gbW92ZSBiZXR3ZWVuIHBpcGVzLAorCSAqIGJ1
dCB0aGF0J3Mgb25seSB0aGUgY2FzZSBmb3IgZ2VuMi00IHdoaWNoIGRvbid0IGhhdmUgYW55CisJ
ICogZGlzcGxheSBwb3dlciB3ZWxscy4KKwkgKi8KKwlwb3dlcl9kb21haW4gPSBQT1dFUl9ET01B
SU5fUElQRShwbGFuZS0+cGlwZSk7CisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0
X2lmX2VuYWJsZWQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbik7CisJaWYgKCF3YWtlcmVmKQorCQly
ZXR1cm4gZmFsc2U7CisKKwl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBEU1BDTlRSKGk5
eHhfcGxhbmUpKTsKKworCXJldCA9IHZhbCAmIERJU1BMQVlfUExBTkVfRU5BQkxFOworCisJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkKKwkJKnBpcGUgPSBwbGFuZS0+cGlwZTsKKwllbHNl
CisJCSpwaXBlID0gKHZhbCAmIERJU1BQTEFORV9TRUxfUElQRV9NQVNLKSA+PgorCQkJRElTUFBM
QU5FX1NFTF9QSVBFX1NISUZUOworCisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYs
IHBvd2VyX2RvbWFpbiwgd2FrZXJlZik7CisKKwlyZXR1cm4gcmV0OworfQorCit1bnNpZ25lZCBp
bnQKK2k5eHhfcGxhbmVfbWF4X3N0cmlkZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkg
ICAgICB1MzIgcGl4ZWxfZm9ybWF0LCB1NjQgbW9kaWZpZXIsCisJCSAgICAgIHVuc2lnbmVkIGlu
dCByb3RhdGlvbikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHBsYW5lLT5iYXNlLmRldik7CisKKwlpZiAoIUhBU19HTUNIKGRldl9wcml2KSkgeworCQly
ZXR1cm4gMzIqMTAyNDsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkgewor
CQlpZiAobW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQpCisJCQlyZXR1cm4gMTYq
MTAyNDsKKwkJZWxzZQorCQkJcmV0dXJuIDMyKjEwMjQ7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDMpIHsKKwkJaWYgKG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJ
TEVEKQorCQkJcmV0dXJuIDgqMTAyNDsKKwkJZWxzZQorCQkJcmV0dXJuIDE2KjEwMjQ7CisJfSBl
bHNlIHsKKwkJaWYgKHBsYW5lLT5pOXh4X3BsYW5lID09IFBMQU5FX0MpCisJCQlyZXR1cm4gNCox
MDI0OworCQllbHNlCisJCQlyZXR1cm4gOCoxMDI0OworCX0KK30KKworc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1fcGxhbmVfZnVuY3MgaTk2NV9wbGFuZV9mdW5jcyA9IHsKKwkudXBkYXRlX3BsYW5l
ID0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAorCS5kaXNhYmxlX3BsYW5lID0gZHJt
X2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZSwKKwkuZGVzdHJveSA9IGludGVsX3BsYW5lX2Rl
c3Ryb3ksCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBpbnRlbF9wbGFuZV9kdXBsaWNhdGVf
c3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0
ZSwKKwkuZm9ybWF0X21vZF9zdXBwb3J0ZWQgPSBpOTY1X3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9y
dGVkLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgaTh4eF9wbGFu
ZV9mdW5jcyA9IHsKKwkudXBkYXRlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3Bs
YW5lLAorCS5kaXNhYmxlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZSwK
KwkuZGVzdHJveSA9IGludGVsX3BsYW5lX2Rlc3Ryb3ksCisJLmF0b21pY19kdXBsaWNhdGVfc3Rh
dGUgPSBpbnRlbF9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRl
ID0gaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZSwKKwkuZm9ybWF0X21vZF9zdXBwb3J0ZWQgPSBp
OHh4X3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkLAorfTsKKworc3RhdGljIHN0cnVjdCBpbnRl
bF9wbGFuZSAqCitpbnRlbF9wcmltYXJ5X3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQoreworCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmU7CisJY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyAqcGxhbmVfZnVuY3M7CisJdW5z
aWduZWQgaW50IHN1cHBvcnRlZF9yb3RhdGlvbnM7CisJY29uc3QgdTMyICpmb3JtYXRzOworCWlu
dCBudW1fZm9ybWF0czsKKwlpbnQgcmV0LCB6cG9zOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gOSkKKwkJcmV0dXJuIHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBw
aXBlLAorCQkJCQkJICBQTEFORV9QUklNQVJZKTsKKworCXBsYW5lID0gaW50ZWxfcGxhbmVfYWxs
b2MoKTsKKwlpZiAoSVNfRVJSKHBsYW5lKSkKKwkJcmV0dXJuIHBsYW5lOworCisJcGxhbmUtPnBp
cGUgPSBwaXBlOworCS8qCisJICogT24gZ2VuMi8zIG9ubHkgcGxhbmUgQSBjYW4gZG8gRkJDLCBi
dXQgdGhlIHBhbmVsIGZpdHRlciBhbmQgTFZEUworCSAqIHBvcnQgaXMgaG9va2VkIHRvIHBpcGUg
Qi4gSGVuY2Ugd2Ugd2FudCBwbGFuZSBBIGZlZWRpbmcgcGlwZSBCLgorCSAqLworCWlmIChIQVNf
RkJDKGRldl9wcml2KSAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCAmJgorCSAgICBJTlRFTF9O
VU1fUElQRVMoZGV2X3ByaXYpID09IDIpCisJCXBsYW5lLT5pOXh4X3BsYW5lID0gKGVudW0gaTl4
eF9wbGFuZV9pZCkgIXBpcGU7CisJZWxzZQorCQlwbGFuZS0+aTl4eF9wbGFuZSA9IChlbnVtIGk5
eHhfcGxhbmVfaWQpIHBpcGU7CisJcGxhbmUtPmlkID0gUExBTkVfUFJJTUFSWTsKKwlwbGFuZS0+
ZnJvbnRidWZmZXJfYml0ID0gSU5URUxfRlJPTlRCVUZGRVIocGlwZSwgcGxhbmUtPmlkKTsKKwor
CXBsYW5lLT5oYXNfZmJjID0gaTl4eF9wbGFuZV9oYXNfZmJjKGRldl9wcml2LCBwbGFuZS0+aTl4
eF9wbGFuZSk7CisJaWYgKHBsYW5lLT5oYXNfZmJjKSB7CisJCXN0cnVjdCBpbnRlbF9mYmMgKmZi
YyA9ICZkZXZfcHJpdi0+ZmJjOworCisJCWZiYy0+cG9zc2libGVfZnJhbWVidWZmZXJfYml0cyB8
PSBwbGFuZS0+ZnJvbnRidWZmZXJfYml0OworCX0KKworCWlmIChJU19WQUxMRVlWSUVXKGRldl9w
cml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCQlmb3JtYXRzID0gdmx2X3ByaW1h
cnlfZm9ybWF0czsKKwkJbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKHZsdl9wcmltYXJ5X2Zvcm1h
dHMpOworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7CisJCS8qCisJCSAq
IFdhRlAxNkdhbW1hRW5hYmxpbmc6aXZiCisJCSAqICJXb3JrYXJvdW5kIDogV2hlbiB1c2luZyB0
aGUgNjQtYml0IGZvcm1hdCwgdGhlIHBsYW5lCisJCSAqICBvdXRwdXQgb24gZWFjaCBjb2xvciBj
aGFubmVsIGhhcyBvbmUgcXVhcnRlciBhbXBsaXR1ZGUuCisJCSAqICBJdCBjYW4gYmUgYnJvdWdo
dCB1cCB0byBmdWxsIGFtcGxpdHVkZSBieSB1c2luZyBwaXBlCisJCSAqICBnYW1tYSBjb3JyZWN0
aW9uIG9yIHBpcGUgY29sb3Igc3BhY2UgY29udmVyc2lvbiB0bworCQkgKiAgbXVsdGlwbHkgdGhl
IHBsYW5lIG91dHB1dCBieSBmb3VyLiIKKwkJICoKKwkJICogVGhlcmUgaXMgbm8gZGVkaWNhdGVk
IHBsYW5lIGdhbW1hIGZvciB0aGUgcHJpbWFyeSBwbGFuZSwKKwkJICogYW5kIHVzaW5nIHRoZSBw
aXBlIGdhbW1hL2NzYyBjb3VsZCBjb25mbGljdCB3aXRoIG90aGVyCisJCSAqIHBsYW5lcywgc28g
d2UgY2hvb3NlIG5vdCB0byBleHBvc2UgZnAxNiBvbiBJVkIgcHJpbWFyeQorCQkgKiBwbGFuZXMu
IEhTVyBwcmltYXJ5IHBsYW5lcyBubyBsb25nZXIgaGF2ZSB0aGlzIHByb2JsZW0uCisJCSAqLwor
CQlpZiAoSVNfSVZZQlJJREdFKGRldl9wcml2KSkgeworCQkJZm9ybWF0cyA9IGl2Yl9wcmltYXJ5
X2Zvcm1hdHM7CisJCQludW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoaXZiX3ByaW1hcnlfZm9ybWF0
cyk7CisJCX0gZWxzZSB7CisJCQlmb3JtYXRzID0gaTk2NV9wcmltYXJ5X2Zvcm1hdHM7CisJCQlu
dW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoaTk2NV9wcmltYXJ5X2Zvcm1hdHMpOworCQl9CisJfSBl
bHNlIHsKKwkJZm9ybWF0cyA9IGk4eHhfcHJpbWFyeV9mb3JtYXRzOworCQludW1fZm9ybWF0cyA9
IEFSUkFZX1NJWkUoaTh4eF9wcmltYXJ5X2Zvcm1hdHMpOworCX0KKworCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDQpCisJCXBsYW5lX2Z1bmNzID0gJmk5NjVfcGxhbmVfZnVuY3M7CisJZWxz
ZQorCQlwbGFuZV9mdW5jcyA9ICZpOHh4X3BsYW5lX2Z1bmNzOworCisJaWYgKElTX1ZBTExFWVZJ
RVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCQlwbGFuZS0+bWluX2Nk
Y2xrID0gdmx2X3BsYW5lX21pbl9jZGNsazsKKwllbHNlIGlmIChJU19CUk9BRFdFTEwoZGV2X3By
aXYpIHx8IElTX0hBU1dFTEwoZGV2X3ByaXYpKQorCQlwbGFuZS0+bWluX2NkY2xrID0gaHN3X3Bs
YW5lX21pbl9jZGNsazsKKwllbHNlIGlmIChJU19JVllCUklER0UoZGV2X3ByaXYpKQorCQlwbGFu
ZS0+bWluX2NkY2xrID0gaXZiX3BsYW5lX21pbl9jZGNsazsKKwllbHNlCisJCXBsYW5lLT5taW5f
Y2RjbGsgPSBpOXh4X3BsYW5lX21pbl9jZGNsazsKKworCXBsYW5lLT5tYXhfc3RyaWRlID0gaTl4
eF9wbGFuZV9tYXhfc3RyaWRlOworCXBsYW5lLT51cGRhdGVfcGxhbmUgPSBpOXh4X3VwZGF0ZV9w
bGFuZTsKKwlwbGFuZS0+ZGlzYWJsZV9wbGFuZSA9IGk5eHhfZGlzYWJsZV9wbGFuZTsKKwlwbGFu
ZS0+Z2V0X2h3X3N0YXRlID0gaTl4eF9wbGFuZV9nZXRfaHdfc3RhdGU7CisJcGxhbmUtPmNoZWNr
X3BsYW5lID0gaTl4eF9wbGFuZV9jaGVjazsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDUgfHwgSVNfRzRYKGRldl9wcml2KSkKKwkJcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0
KCZkZXZfcHJpdi0+ZHJtLCAmcGxhbmUtPmJhc2UsCisJCQkJCSAgICAgICAwLCBwbGFuZV9mdW5j
cywKKwkJCQkJICAgICAgIGZvcm1hdHMsIG51bV9mb3JtYXRzLAorCQkJCQkgICAgICAgaTl4eF9m
b3JtYXRfbW9kaWZpZXJzLAorCQkJCQkgICAgICAgRFJNX1BMQU5FX1RZUEVfUFJJTUFSWSwKKwkJ
CQkJICAgICAgICJwcmltYXJ5ICVjIiwgcGlwZV9uYW1lKHBpcGUpKTsKKwllbHNlCisJCXJldCA9
IGRybV91bml2ZXJzYWxfcGxhbmVfaW5pdCgmZGV2X3ByaXYtPmRybSwgJnBsYW5lLT5iYXNlLAor
CQkJCQkgICAgICAgMCwgcGxhbmVfZnVuY3MsCisJCQkJCSAgICAgICBmb3JtYXRzLCBudW1fZm9y
bWF0cywKKwkJCQkJICAgICAgIGk5eHhfZm9ybWF0X21vZGlmaWVycywKKwkJCQkJICAgICAgIERS
TV9QTEFORV9UWVBFX1BSSU1BUlksCisJCQkJCSAgICAgICAicGxhbmUgJWMiLAorCQkJCQkgICAg
ICAgcGxhbmVfbmFtZShwbGFuZS0+aTl4eF9wbGFuZSkpOworCWlmIChyZXQpCisJCWdvdG8gZmFp
bDsKKworCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSAmJiBwaXBlID09IFBJUEVfQikgewor
CQlzdXBwb3J0ZWRfcm90YXRpb25zID0KKwkJCURSTV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVf
Uk9UQVRFXzE4MCB8CisJCQlEUk1fTU9ERV9SRUZMRUNUX1g7CisJfSBlbHNlIGlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDQpIHsKKwkJc3VwcG9ydGVkX3JvdGF0aW9ucyA9CisJCQlEUk1fTU9E
RV9ST1RBVEVfMCB8IERSTV9NT0RFX1JPVEFURV8xODA7CisJfSBlbHNlIHsKKwkJc3VwcG9ydGVk
X3JvdGF0aW9ucyA9IERSTV9NT0RFX1JPVEFURV8wOworCX0KKworCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDQpCisJCWRybV9wbGFuZV9jcmVhdGVfcm90YXRpb25fcHJvcGVydHkoJnBsYW5l
LT5iYXNlLAorCQkJCQkJICAgRFJNX01PREVfUk9UQVRFXzAsCisJCQkJCQkgICBzdXBwb3J0ZWRf
cm90YXRpb25zKTsKKworCXpwb3MgPSAwOworCWRybV9wbGFuZV9jcmVhdGVfenBvc19pbW11dGFi
bGVfcHJvcGVydHkoJnBsYW5lLT5iYXNlLCB6cG9zKTsKKworCWRybV9wbGFuZV9oZWxwZXJfYWRk
KCZwbGFuZS0+YmFzZSwgJmludGVsX3BsYW5lX2hlbHBlcl9mdW5jcyk7CisKKwlyZXR1cm4gcGxh
bmU7CisKK2ZhaWw6CisJaW50ZWxfcGxhbmVfZnJlZShwbGFuZSk7CisKKwlyZXR1cm4gRVJSX1BU
UihyZXQpOworfQorCitzdGF0aWMgc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGNfYWxsb2Mo
dm9pZCkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YzsKKworCWNydGMgPSBremFsbG9jKHNpemVvZigqY3J0YyksIEdGUF9L
RVJORUwpOworCWlmICghY3J0YykKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwljcnRj
X3N0YXRlID0gaW50ZWxfY3J0Y19zdGF0ZV9hbGxvYyhjcnRjKTsKKwlpZiAoIWNydGNfc3RhdGUp
IHsKKwkJa2ZyZWUoY3J0Yyk7CisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCX0KKworCWNy
dGMtPmJhc2Uuc3RhdGUgPSAmY3J0Y19zdGF0ZS0+dWFwaTsKKwljcnRjLT5jb25maWcgPSBjcnRj
X3N0YXRlOworCisJcmV0dXJuIGNydGM7Cit9CisKK3N0YXRpYyB2b2lkIGludGVsX2NydGNfZnJl
ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKK3sKKwlpbnRlbF9jcnRjX2Rlc3Ryb3lfc3RhdGUo
JmNydGMtPmJhc2UsIGNydGMtPmJhc2Uuc3RhdGUpOworCWtmcmVlKGNydGMpOworfQorCitzdGF0
aWMgdm9pZCBpbnRlbF9jcnRjX2Rlc3Ryb3koc3RydWN0IGRybV9jcnRjICpjcnRjKQoreworCXN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKKworCWRy
bV9jcnRjX2NsZWFudXAoY3J0Yyk7CisJa2ZyZWUoaW50ZWxfY3J0Yyk7Cit9CisKK3N0YXRpYyBp
bnQgaW50ZWxfY3J0Y19sYXRlX3JlZ2lzdGVyKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKK3sKKwlp
bnRlbF9jcnRjX2RlYnVnZnNfYWRkKGNydGMpOworCXJldHVybiAwOworfQorCisjZGVmaW5lIElO
VEVMX0NSVENfRlVOQ1MgXAorCS5nYW1tYV9zZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9sZWdhY3lf
Z2FtbWFfc2V0LCBcCisJLnNldF9jb25maWcgPSBkcm1fYXRvbWljX2hlbHBlcl9zZXRfY29uZmln
LCBcCisJLmRlc3Ryb3kgPSBpbnRlbF9jcnRjX2Rlc3Ryb3ksIFwKKwkucGFnZV9mbGlwID0gZHJt
X2F0b21pY19oZWxwZXJfcGFnZV9mbGlwLCBcCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBp
bnRlbF9jcnRjX2R1cGxpY2F0ZV9zdGF0ZSwgXAorCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGlu
dGVsX2NydGNfZGVzdHJveV9zdGF0ZSwgXAorCS5zZXRfY3JjX3NvdXJjZSA9IGludGVsX2NydGNf
c2V0X2NyY19zb3VyY2UsIFwKKwkudmVyaWZ5X2NyY19zb3VyY2UgPSBpbnRlbF9jcnRjX3Zlcmlm
eV9jcmNfc291cmNlLCBcCisJLmdldF9jcmNfc291cmNlcyA9IGludGVsX2NydGNfZ2V0X2NyY19z
b3VyY2VzLCBcCisJLmxhdGVfcmVnaXN0ZXIgPSBpbnRlbF9jcnRjX2xhdGVfcmVnaXN0ZXIKKwor
c3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyBiZHdfY3J0Y19mdW5jcyA9IHsKKwlJ
TlRFTF9DUlRDX0ZVTkNTLAorCisJLmdldF92YmxhbmtfY291bnRlciA9IGc0eF9nZXRfdmJsYW5r
X2NvdW50ZXIsCisJLmVuYWJsZV92YmxhbmsgPSBiZHdfZW5hYmxlX3ZibGFuaywKKwkuZGlzYWJs
ZV92YmxhbmsgPSBiZHdfZGlzYWJsZV92YmxhbmssCisJLmdldF92YmxhbmtfdGltZXN0YW1wID0g
aW50ZWxfY3J0Y19nZXRfdmJsYW5rX3RpbWVzdGFtcCwKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1
Y3QgZHJtX2NydGNfZnVuY3MgaWxrX2NydGNfZnVuY3MgPSB7CisJSU5URUxfQ1JUQ19GVU5DUywK
KworCS5nZXRfdmJsYW5rX2NvdW50ZXIgPSBnNHhfZ2V0X3ZibGFua19jb3VudGVyLAorCS5lbmFi
bGVfdmJsYW5rID0gaWxrX2VuYWJsZV92YmxhbmssCisJLmRpc2FibGVfdmJsYW5rID0gaWxrX2Rp
c2FibGVfdmJsYW5rLAorCS5nZXRfdmJsYW5rX3RpbWVzdGFtcCA9IGludGVsX2NydGNfZ2V0X3Zi
bGFua190aW1lc3RhbXAsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNz
IGc0eF9jcnRjX2Z1bmNzID0geworCUlOVEVMX0NSVENfRlVOQ1MsCisKKwkuZ2V0X3ZibGFua19j
b3VudGVyID0gZzR4X2dldF92YmxhbmtfY291bnRlciwKKwkuZW5hYmxlX3ZibGFuayA9IGk5NjVf
ZW5hYmxlX3ZibGFuaywKKwkuZGlzYWJsZV92YmxhbmsgPSBpOTY1X2Rpc2FibGVfdmJsYW5rLAor
CS5nZXRfdmJsYW5rX3RpbWVzdGFtcCA9IGludGVsX2NydGNfZ2V0X3ZibGFua190aW1lc3RhbXAs
Cit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGk5NjVfY3J0Y19mdW5j
cyA9IHsKKwlJTlRFTF9DUlRDX0ZVTkNTLAorCisJLmdldF92YmxhbmtfY291bnRlciA9IGk5MTVf
Z2V0X3ZibGFua19jb3VudGVyLAorCS5lbmFibGVfdmJsYW5rID0gaTk2NV9lbmFibGVfdmJsYW5r
LAorCS5kaXNhYmxlX3ZibGFuayA9IGk5NjVfZGlzYWJsZV92YmxhbmssCisJLmdldF92Ymxhbmtf
dGltZXN0YW1wID0gaW50ZWxfY3J0Y19nZXRfdmJsYW5rX3RpbWVzdGFtcCwKK307CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfZnVuY3MgaTkxNWdtX2NydGNfZnVuY3MgPSB7CisJSU5U
RUxfQ1JUQ19GVU5DUywKKworCS5nZXRfdmJsYW5rX2NvdW50ZXIgPSBpOTE1X2dldF92Ymxhbmtf
Y291bnRlciwKKwkuZW5hYmxlX3ZibGFuayA9IGk5MTVnbV9lbmFibGVfdmJsYW5rLAorCS5kaXNh
YmxlX3ZibGFuayA9IGk5MTVnbV9kaXNhYmxlX3ZibGFuaywKKwkuZ2V0X3ZibGFua190aW1lc3Rh
bXAgPSBpbnRlbF9jcnRjX2dldF92YmxhbmtfdGltZXN0YW1wLAorfTsKKworc3RhdGljIGNvbnN0
IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyBpOTE1X2NydGNfZnVuY3MgPSB7CisJSU5URUxfQ1JUQ19G
VU5DUywKKworCS5nZXRfdmJsYW5rX2NvdW50ZXIgPSBpOTE1X2dldF92YmxhbmtfY291bnRlciwK
KwkuZW5hYmxlX3ZibGFuayA9IGk4eHhfZW5hYmxlX3ZibGFuaywKKwkuZGlzYWJsZV92Ymxhbmsg
PSBpOHh4X2Rpc2FibGVfdmJsYW5rLAorCS5nZXRfdmJsYW5rX3RpbWVzdGFtcCA9IGludGVsX2Ny
dGNfZ2V0X3ZibGFua190aW1lc3RhbXAsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9j
cnRjX2Z1bmNzIGk4eHhfY3J0Y19mdW5jcyA9IHsKKwlJTlRFTF9DUlRDX0ZVTkNTLAorCisJLyog
bm8gaHcgdmJsYW5rIGNvdW50ZXIgKi8KKwkuZW5hYmxlX3ZibGFuayA9IGk4eHhfZW5hYmxlX3Zi
bGFuaywKKwkuZGlzYWJsZV92YmxhbmsgPSBpOHh4X2Rpc2FibGVfdmJsYW5rLAorCS5nZXRfdmJs
YW5rX3RpbWVzdGFtcCA9IGludGVsX2NydGNfZ2V0X3ZibGFua190aW1lc3RhbXAsCit9OworCitp
bnQgaW50ZWxfY3J0Y19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51
bSBwaXBlIHBpcGUpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpwcmltYXJ5LCAqY3Vyc29yOwor
CWNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyAqZnVuY3M7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGM7CisJaW50IHNwcml0ZSwgcmV0OworCisJY3J0YyA9IGludGVsX2NydGNfYWxsb2MoKTsK
KwlpZiAoSVNfRVJSKGNydGMpKQorCQlyZXR1cm4gUFRSX0VSUihjcnRjKTsKKworCWNydGMtPnBp
cGUgPSBwaXBlOworCWNydGMtPm51bV9zY2FsZXJzID0gUlVOVElNRV9JTkZPKGRldl9wcml2KS0+
bnVtX3NjYWxlcnNbcGlwZV07CisKKwlwcmltYXJ5ID0gaW50ZWxfcHJpbWFyeV9wbGFuZV9jcmVh
dGUoZGV2X3ByaXYsIHBpcGUpOworCWlmIChJU19FUlIocHJpbWFyeSkpIHsKKwkJcmV0ID0gUFRS
X0VSUihwcmltYXJ5KTsKKwkJZ290byBmYWlsOworCX0KKwljcnRjLT5wbGFuZV9pZHNfbWFzayB8
PSBCSVQocHJpbWFyeS0+aWQpOworCisJZm9yX2VhY2hfc3ByaXRlKGRldl9wcml2LCBwaXBlLCBz
cHJpdGUpIHsKKwkJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKKworCQlwbGFuZSA9IGludGVs
X3Nwcml0ZV9wbGFuZV9jcmVhdGUoZGV2X3ByaXYsIHBpcGUsIHNwcml0ZSk7CisJCWlmIChJU19F
UlIocGxhbmUpKSB7CisJCQlyZXQgPSBQVFJfRVJSKHBsYW5lKTsKKwkJCWdvdG8gZmFpbDsKKwkJ
fQorCQljcnRjLT5wbGFuZV9pZHNfbWFzayB8PSBCSVQocGxhbmUtPmlkKTsKKwl9CisKKwljdXJz
b3IgPSBpbnRlbF9jdXJzb3JfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlKTsKKwlpZiAoSVNf
RVJSKGN1cnNvcikpIHsKKwkJcmV0ID0gUFRSX0VSUihjdXJzb3IpOworCQlnb3RvIGZhaWw7CisJ
fQorCWNydGMtPnBsYW5lX2lkc19tYXNrIHw9IEJJVChjdXJzb3ItPmlkKTsKKworCWlmIChIQVNf
R01DSChkZXZfcHJpdikpIHsKKwkJaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpIHx8CisJCSAg
ICBJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19HNFgoZGV2X3ByaXYpKQorCQkJZnVuY3Mg
PSAmZzR4X2NydGNfZnVuY3M7CisJCWVsc2UgaWYgKElTX0dFTihkZXZfcHJpdiwgNCkpCisJCQlm
dW5jcyA9ICZpOTY1X2NydGNfZnVuY3M7CisJCWVsc2UgaWYgKElTX0k5NDVHTShkZXZfcHJpdikg
fHwgSVNfSTkxNUdNKGRldl9wcml2KSkKKwkJCWZ1bmNzID0gJmk5MTVnbV9jcnRjX2Z1bmNzOwor
CQllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDMpKQorCQkJZnVuY3MgPSAmaTkxNV9jcnRjX2Z1
bmNzOworCQllbHNlCisJCQlmdW5jcyA9ICZpOHh4X2NydGNfZnVuY3M7CisJfSBlbHNlIHsKKwkJ
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKKwkJCWZ1bmNzID0gJmJkd19jcnRjX2Z1bmNz
OworCQllbHNlCisJCQlmdW5jcyA9ICZpbGtfY3J0Y19mdW5jczsKKwl9CisKKwlyZXQgPSBkcm1f
Y3J0Y19pbml0X3dpdGhfcGxhbmVzKCZkZXZfcHJpdi0+ZHJtLCAmY3J0Yy0+YmFzZSwKKwkJCQkJ
JnByaW1hcnktPmJhc2UsICZjdXJzb3ItPmJhc2UsCisJCQkJCWZ1bmNzLCAicGlwZSAlYyIsIHBp
cGVfbmFtZShwaXBlKSk7CisJaWYgKHJldCkKKwkJZ290byBmYWlsOworCisJQlVHX09OKHBpcGUg
Pj0gQVJSQVlfU0laRShkZXZfcHJpdi0+cGlwZV90b19jcnRjX21hcHBpbmcpIHx8CisJICAgICAg
IGRldl9wcml2LT5waXBlX3RvX2NydGNfbWFwcGluZ1twaXBlXSAhPSBOVUxMKTsKKwlkZXZfcHJp
di0+cGlwZV90b19jcnRjX21hcHBpbmdbcGlwZV0gPSBjcnRjOworCisJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPCA5KSB7CisJCWVudW0gaTl4eF9wbGFuZV9pZCBpOXh4X3BsYW5lID0gcHJpbWFy
eS0+aTl4eF9wbGFuZTsKKworCQlCVUdfT04oaTl4eF9wbGFuZSA+PSBBUlJBWV9TSVpFKGRldl9w
cml2LT5wbGFuZV90b19jcnRjX21hcHBpbmcpIHx8CisJCSAgICAgICBkZXZfcHJpdi0+cGxhbmVf
dG9fY3J0Y19tYXBwaW5nW2k5eHhfcGxhbmVdICE9IE5VTEwpOworCQlkZXZfcHJpdi0+cGxhbmVf
dG9fY3J0Y19tYXBwaW5nW2k5eHhfcGxhbmVdID0gY3J0YzsKKwl9CisKKwlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMCkKKwkJZHJtX2NydGNfY3JlYXRlX3NjYWxpbmdfZmlsdGVyX3Byb3Bl
cnR5KCZjcnRjLT5iYXNlLAorCQkJCQkJQklUKERSTV9TQ0FMSU5HX0ZJTFRFUl9ERUZBVUxUKSB8
CisJCQkJCQlCSVQoRFJNX1NDQUxJTkdfRklMVEVSX05FQVJFU1RfTkVJR0hCT1IpKTsKKworCWlu
dGVsX2NvbG9yX2luaXQoY3J0Yyk7CisKKwlpbnRlbF9jcnRjX2NyY19pbml0KGNydGMpOworCisJ
ZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRybV9jcnRjX2luZGV4KCZjcnRjLT5iYXNlKSAh
PSBjcnRjLT5waXBlKTsKKworCXJldHVybiAwOworCitmYWlsOgorCWludGVsX2NydGNfZnJlZShj
cnRjKTsKKworCXJldHVybiByZXQ7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2NydGMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfY3J0Yy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMDgxMTJk
NTU3NDExCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9jcnRjLmgKQEAgLTAsMCArMSwyMiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IE1JVCAqLworLyoKKyAqIENvcHlyaWdodCDCqSAyMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8K
KworI2lmbmRlZiBfSU5URUxfQ1JUQ19IXworI2RlZmluZSBfSU5URUxfQ1JUQ19IXworCisjaW5j
bHVkZSA8bGludXgvdHlwZXMuaD4KKworZW51bSBwaXBlOworc3RydWN0IGRybV9pOTE1X3ByaXZh
dGU7CitzdHJ1Y3QgaW50ZWxfY3J0YzsKK3N0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOworCit1MzIg
aW50ZWxfY3J0Y19tYXhfdmJsYW5rX2NvdW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKTsKK2ludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSk7CitzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
aW50ZWxfY3J0Y19zdGF0ZV9hbGxvYyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7Cit2b2lkIGlu
dGVsX2NydGNfc3RhdGVfcmVzZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CisJCQkgICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpOworCisjZW5kaWYKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggMmE1OTczZWI2YmY3Li41
MzAyMjJlNjhlZTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCkBAIC02OCw4ICs2OCw4IEBACiAjaW5jbHVkZSAiaW50ZWxfYncuaCIKICNpbmNsdWRl
ICJpbnRlbF9jZGNsay5oIgogI2luY2x1ZGUgImludGVsX2NvbG9yLmgiCisjaW5jbHVkZSAiaW50
ZWxfY3J0Yy5oIgogI2luY2x1ZGUgImludGVsX2Nzci5oIgotI2luY2x1ZGUgImludGVsX2N1cnNv
ci5oIgogI2luY2x1ZGUgImludGVsX2Rpc3BsYXlfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRlbF9k
cF9saW5rX3RyYWluaW5nLmgiCiAjaW5jbHVkZSAiaW50ZWxfZmJjLmgiCkBAIC04OCw1NiArODgs
NiBAQAogI2luY2x1ZGUgImludGVsX3RjLmgiCiAjaW5jbHVkZSAiaW50ZWxfdmdhLmgiCiAKLS8q
IFByaW1hcnkgcGxhbmUgZm9ybWF0cyBmb3IgZ2VuIDw9IDMgKi8KLXN0YXRpYyBjb25zdCB1MzIg
aTh4eF9wcmltYXJ5X2Zvcm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAotCURSTV9GT1JNQVRf
WFJHQjE1NTUsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLX07
Ci0KLS8qIFByaW1hcnkgcGxhbmUgZm9ybWF0cyBmb3IgaXZiIChubyBmcDE2IGR1ZSB0byBodyBp
c3N1ZSkgKi8KLXN0YXRpYyBjb25zdCB1MzIgaXZiX3ByaW1hcnlfZm9ybWF0c1tdID0gewotCURS
TV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9YUkdCODg4OCwK
LQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCi0JRFJNX0ZP
Uk1BVF9YQkdSMjEwMTAxMCwKLX07Ci0KLS8qIFByaW1hcnkgcGxhbmUgZm9ybWF0cyBmb3IgZ2Vu
ID49IDQsIGV4Y2VwdCBpdmIgKi8KLXN0YXRpYyBjb25zdCB1MzIgaTk2NV9wcmltYXJ5X2Zvcm1h
dHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAotCURSTV9GT1JNQVRfUkdCNTY1LAotCURSTV9GT1JN
QVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9YQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAx
MDEwLAotCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZG
LAotfTsKLQotLyogUHJpbWFyeSBwbGFuZSBmb3JtYXRzIGZvciB2bHYvY2h2ICovCi1zdGF0aWMg
Y29uc3QgdTMyIHZsdl9wcmltYXJ5X2Zvcm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAotCURS
TV9GT1JNQVRfUkdCNTY1LAotCURSTV9GT1JNQVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9YQkdS
ODg4OCwKLQlEUk1fRk9STUFUX0FSR0I4ODg4LAotCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0JRFJN
X0ZPUk1BVF9YUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAotCURSTV9GT1JN
QVRfQVJHQjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hC
R1IxNjE2MTYxNkYsCi19OwotCi1zdGF0aWMgY29uc3QgdTY0IGk5eHhfZm9ybWF0X21vZGlmaWVy
c1tdID0gewotCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAotCURSTV9GT1JNQVRfTU9EX0xJTkVB
UiwKLQlEUk1fRk9STUFUX01PRF9JTlZBTElECi19OwotCiBzdGF0aWMgdm9pZCBpOXh4X2NydGNf
Y2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpwaXBlX2NvbmZpZyk7CiBzdGF0aWMgdm9pZCBpbGtfcGNoX2Nsb2NrX2dldChzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKQEAgLTE2Myw3ICsxMTMsNiBAQCBzdGF0aWMgdm9pZCBza2xf
cGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwog
c3RhdGljIHZvaWQgaWxrX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKTsKIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfc2V0dXBfaHdfc3RhdGUo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkJIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJl
X2N0eCAqY3R4KTsKLXN0YXRpYyBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqaW50ZWxfY3J0Y19z
dGF0ZV9hbGxvYyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7CiAKIHN0cnVjdCBpbnRlbF9saW1p
dCB7CiAJc3RydWN0IHsKQEAgLTEzMDIsMTIgKzEyNTEsNiBAQCBzdGF0aWMgdm9pZCBhc3NlcnRf
cGxhbmVzX2Rpc2FibGVkKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCQlhc3NlcnRfcGxhbmVf
ZGlzYWJsZWQocGxhbmUpOwogfQogCi1zdGF0aWMgdm9pZCBhc3NlcnRfdmJsYW5rX2Rpc2FibGVk
KHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKLXsKLQlpZiAoSTkxNV9TVEFURV9XQVJOX09OKGRybV9j
cnRjX3ZibGFua19nZXQoY3J0YykgPT0gMCkpCi0JCWRybV9jcnRjX3ZibGFua19wdXQoY3J0Yyk7
Ci19Ci0KIHZvaWQgYXNzZXJ0X3BjaF90cmFuc2NvZGVyX2Rpc2FibGVkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCQkgICAgZW51bSBwaXBlIHBpcGUpCiB7CkBAIC0xNzky
LDU1ICsxNzM1LDYgQEAgZW51bSBwaXBlIGludGVsX2NydGNfcGNoX3RyYW5zY29kZXIoc3RydWN0
IGludGVsX2NydGMgKmNydGMpCiAJCXJldHVybiBjcnRjLT5waXBlOwogfQogCi1zdGF0aWMgdTMy
IGludGVsX2NydGNfbWF4X3ZibGFua19jb3VudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQl1MzIgbW9kZV9m
bGFncyA9IGNydGMtPm1vZGVfZmxhZ3M7Ci0KLQkvKgotCSAqIEZyb20gR2VuIDExLCBJbiBjYXNl
IG9mIGRzaSBjbWQgbW9kZSwgZnJhbWUgY291bnRlciB3b3VsZG50Ci0JICogaGF2ZSB1cGRhdGVk
IGF0IHRoZSBiZWdpbm5pbmcgb2YgVEUsIGlmIHdlIHdhbnQgdG8gdXNlCi0JICogdGhlIGh3IGNv
dW50ZXIsIHRoZW4gd2Ugd291bGQgZmluZCBpdCB1cGRhdGVkIGluIG9ubHkKLQkgKiB0aGUgbmV4
dCBURSwgaGVuY2Ugc3dpdGNoaW5nIHRvIHN3IGNvdW50ZXIuCi0JICovCi0JaWYgKG1vZGVfZmxh
Z3MgJiAoSTkxNV9NT0RFX0ZMQUdfRFNJX1VTRV9URTAgfCBJOTE1X01PREVfRkxBR19EU0lfVVNF
X1RFMSkpCi0JCXJldHVybiAwOwotCi0JLyoKLQkgKiBPbiBpOTY1Z20gdGhlIGhhcmR3YXJlIGZy
YW1lIGNvdW50ZXIgcmVhZHMKLQkgKiB6ZXJvIHdoZW4gdGhlIFRWIGVuY29kZXIgaXMgZW5hYmxl
ZCA6KAotCSAqLwotCWlmIChJU19JOTY1R00oZGV2X3ByaXYpICYmCi0JICAgIChjcnRjX3N0YXRl
LT5vdXRwdXRfdHlwZXMgJiBCSVQoSU5URUxfT1VUUFVUX1RWT1VUKSkpCi0JCXJldHVybiAwOwot
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSB8fCBJU19HNFgoZGV2X3ByaXYpKQotCQly
ZXR1cm4gMHhmZmZmZmZmZjsgLyogZnVsbCAzMiBiaXQgY291bnRlciAqLwotCWVsc2UgaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMykKLQkJcmV0dXJuIDB4ZmZmZmZmOyAvKiBvbmx5IDI0IGJp
dHMgb2YgZnJhbWUgY291bnQgKi8KLQllbHNlCi0JCXJldHVybiAwOyAvKiBHZW4yIGRvZXNuJ3Qg
aGF2ZSBhIGhhcmR3YXJlIGZyYW1lIGNvdW50ZXIgKi8KLX0KLQotdm9pZCBpbnRlbF9jcnRjX3Zi
bGFua19vbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKLXsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5j
cnRjKTsKLQotCWFzc2VydF92YmxhbmtfZGlzYWJsZWQoJmNydGMtPmJhc2UpOwotCWRybV9jcnRj
X3NldF9tYXhfdmJsYW5rX2NvdW50KCZjcnRjLT5iYXNlLAotCQkJCSAgICAgIGludGVsX2NydGNf
bWF4X3ZibGFua19jb3VudChjcnRjX3N0YXRlKSk7Ci0JZHJtX2NydGNfdmJsYW5rX29uKCZjcnRj
LT5iYXNlKTsKLX0KLQotdm9pZCBpbnRlbF9jcnRjX3ZibGFua19vZmYoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCi17Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0KLQlkcm1fY3J0Y192Ymxh
bmtfb2ZmKCZjcnRjLT5iYXNlKTsKLQlhc3NlcnRfdmJsYW5rX2Rpc2FibGVkKCZjcnRjLT5iYXNl
KTsKLX0KLQogdm9pZCBpbnRlbF9lbmFibGVfcGlwZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqbmV3X2NydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOwpAQCAtNDA0NywxNzEgKzM5NDEs
NiBAQCBpbnQgc2tsX2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgaTl4eF9wbGFuZV9y
YXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgICAg
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJCSAgICAgdW5z
aWduZWQgaW50ICpudW0sIHVuc2lnbmVkIGludCAqZGVuKQotewotCWNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCXVuc2lnbmVkIGludCBjcHAg
PSBmYi0+Zm9ybWF0LT5jcHBbMF07Ci0KLQkvKgotCSAqIGc0eCBic3BlYyBzYXlzIDY0YnBwIHBp
eGVsIHJhdGUgY2FuJ3QgZXhjZWVkIDgwJQotCSAqIG9mIGNkY2xrIHdoZW4gdGhlIHNwcml0ZSBw
bGFuZSBpcyBlbmFibGVkIG9uIHRoZQotCSAqIHNhbWUgcGlwZS4gaWxrL3NuYiBic3BlYyBzYXlz
IDY0YnBwIHBpeGVsIHJhdGUgaXMKLQkgKiBuZXZlciBhbGxvd2VkIHRvIGV4Y2VlZCA4MCUgb2Yg
Y2RjbGsuIExldCdzIGp1c3QgZ28KLQkgKiB3aXRoIHRoZSBpbGsvc25iIGxpbWl0IGFsd2F5cy4K
LQkgKi8KLQlpZiAoY3BwID09IDgpIHsKLQkJKm51bSA9IDEwOwotCQkqZGVuID0gODsKLQl9IGVs
c2UgewotCQkqbnVtID0gMTsKLQkJKmRlbiA9IDE7Ci0JfQotfQotCi1zdGF0aWMgaW50IGk5eHhf
cGxhbmVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAotCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0J
dW5zaWduZWQgaW50IHBpeGVsX3JhdGU7Ci0JdW5zaWduZWQgaW50IG51bSwgZGVuOwotCi0JLyoK
LQkgKiBOb3RlIHRoYXQgY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSBhY2NvdW50cyBmb3IgYm90aAot
CSAqIGhvcml6b250YWwgYW5kIHZlcnRpY2FsIHBhbmVsIGZpdHRlciBkb3duc2NhbGluZyBmYWN0
b3JzLgotCSAqIFByZS1IU1cgYnNwZWMgdGVsbHMgdXMgdG8gb25seSBjb25zaWRlciB0aGUgaG9y
aXpvbnRhbAotCSAqIGRvd25zY2FsaW5nIGZhY3RvciBoZXJlLiBXZSBpZ25vcmUgdGhhdCBhbmQg
anVzdCBjb25zaWRlcgotCSAqIGJvdGggZm9yIHNpbXBsaWNpdHkuCi0JICovCi0JcGl4ZWxfcmF0
ZSA9IGNydGNfc3RhdGUtPnBpeGVsX3JhdGU7Ci0KLQlpOXh4X3BsYW5lX3JhdGlvKGNydGNfc3Rh
dGUsIHBsYW5lX3N0YXRlLCAmbnVtLCAmZGVuKTsKLQotCS8qIHR3byBwaXhlbHMgcGVyIGNsb2Nr
IHdpdGggZG91YmxlIHdpZGUgcGlwZSAqLwotCWlmIChjcnRjX3N0YXRlLT5kb3VibGVfd2lkZSkK
LQkJZGVuICo9IDI7Ci0KLQlyZXR1cm4gRElWX1JPVU5EX1VQKHBpeGVsX3JhdGUgKiBudW0sIGRl
bik7Ci19Ci0KLXVuc2lnbmVkIGludAotaTl4eF9wbGFuZV9tYXhfc3RyaWRlKHN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUsCi0JCSAgICAgIHUzMiBwaXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllciwK
LQkJICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQotCWlmICghSEFTX0dN
Q0goZGV2X3ByaXYpKSB7Ci0JCXJldHVybiAzMioxMDI0OwotCX0gZWxzZSBpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA0KSB7Ci0JCWlmIChtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9U
SUxFRCkKLQkJCXJldHVybiAxNioxMDI0OwotCQllbHNlCi0JCQlyZXR1cm4gMzIqMTAyNDsKLQl9
IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMykgewotCQlpZiAobW9kaWZpZXIgPT0g
STkxNV9GT1JNQVRfTU9EX1hfVElMRUQpCi0JCQlyZXR1cm4gOCoxMDI0OwotCQllbHNlCi0JCQly
ZXR1cm4gMTYqMTAyNDsKLQl9IGVsc2UgewotCQlpZiAocGxhbmUtPmk5eHhfcGxhbmUgPT0gUExB
TkVfQykKLQkJCXJldHVybiA0KjEwMjQ7Ci0JCWVsc2UKLQkJCXJldHVybiA4KjEwMjQ7Ci0JfQot
fQotCi1zdGF0aWMgdTMyIGk5eHhfcGxhbmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCi17Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JdTMyIGRzcGNudHIgPSAw
OwotCi0JaWYgKGNydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSkKLQkJZHNwY250ciB8PSBESVNQUExB
TkVfR0FNTUFfRU5BQkxFOwotCi0JaWYgKGNydGNfc3RhdGUtPmNzY19lbmFibGUpCi0JCWRzcGNu
dHIgfD0gRElTUFBMQU5FX1BJUEVfQ1NDX0VOQUJMRTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpIDwgNSkKLQkJZHNwY250ciB8PSBESVNQUExBTkVfU0VMX1BJUEUoY3J0Yy0+cGlwZSk7Ci0K
LQlyZXR1cm4gZHNwY250cjsKLX0KLQotc3RhdGljIHUzMiBpOXh4X3BsYW5lX2N0bChjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwot
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwot
CXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKLQl1MzIg
ZHNwY250cjsKLQotCWRzcGNudHIgPSBESVNQTEFZX1BMQU5FX0VOQUJMRTsKLQotCWlmIChJU19H
NFgoZGV2X3ByaXYpIHx8IElTX0dFTihkZXZfcHJpdiwgNSkgfHwKLQkgICAgSVNfR0VOKGRldl9w
cml2LCA2KSB8fCBJU19JVllCUklER0UoZGV2X3ByaXYpKQotCQlkc3BjbnRyIHw9IERJU1BQTEFO
RV9UUklDS0xFX0ZFRURfRElTQUJMRTsKLQotCXN3aXRjaCAoZmItPmZvcm1hdC0+Zm9ybWF0KSB7
Ci0JY2FzZSBEUk1fRk9STUFUX0M4OgotCQlkc3BjbnRyIHw9IERJU1BQTEFORV84QlBQOwotCQli
cmVhazsKLQljYXNlIERSTV9GT1JNQVRfWFJHQjE1NTU6Ci0JCWRzcGNudHIgfD0gRElTUFBMQU5F
X0JHUlg1NTU7Ci0JCWJyZWFrOwotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTU1NToKLQkJZHNwY250
ciB8PSBESVNQUExBTkVfQkdSQTU1NTsKLQkJYnJlYWs7Ci0JY2FzZSBEUk1fRk9STUFUX1JHQjU2
NToKLQkJZHNwY250ciB8PSBESVNQUExBTkVfQkdSWDU2NTsKLQkJYnJlYWs7Ci0JY2FzZSBEUk1f
Rk9STUFUX1hSR0I4ODg4OgotCQlkc3BjbnRyIHw9IERJU1BQTEFORV9CR1JYODg4OwotCQlicmVh
azsKLQljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6Ci0JCWRzcGNudHIgfD0gRElTUFBMQU5FX1JH
Qlg4ODg7Ci0JCWJyZWFrOwotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoKLQkJZHNwY250ciB8
PSBESVNQUExBTkVfQkdSQTg4ODsKLQkJYnJlYWs7Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4
OgotCQlkc3BjbnRyIHw9IERJU1BQTEFORV9SR0JBODg4OwotCQlicmVhazsKLQljYXNlIERSTV9G
T1JNQVRfWFJHQjIxMDEwMTA6Ci0JCWRzcGNudHIgfD0gRElTUFBMQU5FX0JHUlgxMDEwMTA7Ci0J
CWJyZWFrOwotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMDoKLQkJZHNwY250ciB8PSBESVNQ
UExBTkVfUkdCWDEwMTAxMDsKLQkJYnJlYWs7Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEw
OgotCQlkc3BjbnRyIHw9IERJU1BQTEFORV9CR1JBMTAxMDEwOwotCQlicmVhazsKLQljYXNlIERS
TV9GT1JNQVRfQUJHUjIxMDEwMTA6Ci0JCWRzcGNudHIgfD0gRElTUFBMQU5FX1JHQkExMDEwMTA7
Ci0JCWJyZWFrOwotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgotCQlkc3BjbnRyIHw9
IERJU1BQTEFORV9SR0JYMTYxNjE2OwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NB
U0UoZmItPmZvcm1hdC0+Zm9ybWF0KTsKLQkJcmV0dXJuIDA7Ci0JfQotCi0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gNCAmJgotCSAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9E
X1hfVElMRUQpCi0JCWRzcGNudHIgfD0gRElTUFBMQU5FX1RJTEVEOwotCi0JaWYgKHJvdGF0aW9u
ICYgRFJNX01PREVfUk9UQVRFXzE4MCkKLQkJZHNwY250ciB8PSBESVNQUExBTkVfUk9UQVRFXzE4
MDsKLQotCWlmIChyb3RhdGlvbiAmIERSTV9NT0RFX1JFRkxFQ1RfWCkKLQkJZHNwY250ciB8PSBE
SVNQUExBTkVfTUlSUk9SOwotCi0JcmV0dXJuIGRzcGNudHI7Ci19Ci0KIGludCBpOXh4X2NoZWNr
X3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQpAQCAtNDI3MiwxOTcgKzQwMDEs
NiBAQCBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBib29sIGk5eHhfcGxhbmVf
aGFzX3dpbmRvd2luZyhzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lKQotewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVt
IGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHBsYW5lLT5pOXh4X3BsYW5lOwotCi0JaWYgKElT
X0NIRVJSWVZJRVcoZGV2X3ByaXYpKQotCQlyZXR1cm4gaTl4eF9wbGFuZSA9PSBQTEFORV9COwot
CWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSB8fCBJU19HNFgoZGV2X3ByaXYpKQot
CQlyZXR1cm4gZmFsc2U7Ci0JZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA0KSkKLQkJcmV0dXJu
IGk5eHhfcGxhbmUgPT0gUExBTkVfQzsKLQllbHNlCi0JCXJldHVybiBpOXh4X3BsYW5lID09IFBM
QU5FX0IgfHwKLQkJCWk5eHhfcGxhbmUgPT0gUExBTkVfQzsKLX0KLQotc3RhdGljIGludAotaTl4
eF9wbGFuZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJIHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0Jc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKLQlp
bnQgcmV0OwotCi0JcmV0ID0gY2h2X3BsYW5lX2NoZWNrX3JvdGF0aW9uKHBsYW5lX3N0YXRlKTsK
LQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gaW50ZWxfYXRvbWljX3BsYW5lX2No
ZWNrX2NsaXBwaW5nKHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlLAotCQkJCQkJRFJNX1BMQU5FX0hF
TFBFUl9OT19TQ0FMSU5HLAotCQkJCQkJRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLAotCQkJ
CQkJaTl4eF9wbGFuZV9oYXNfd2luZG93aW5nKHBsYW5lKSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJu
IHJldDsKLQotCXJldCA9IGk5eHhfY2hlY2tfcGxhbmVfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJs
ZSkKLQkJcmV0dXJuIDA7Ci0KLQlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRpbmF0
ZXMocGxhbmVfc3RhdGUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlwbGFuZV9zdGF0
ZS0+Y3RsID0gaTl4eF9wbGFuZV9jdGwoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwotCi0JcmV0
dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIGk5eHhfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUsCi0JCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKLQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShw
bGFuZS0+YmFzZS5kZXYpOwotCWVudW0gaTl4eF9wbGFuZV9pZCBpOXh4X3BsYW5lID0gcGxhbmUt
Pmk5eHhfcGxhbmU7Ci0JdTMyIGxpbmVhcl9vZmZzZXQ7Ci0JaW50IHggPSBwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMF0ueDsKLQlpbnQgeSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS55
OwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7Ci0JaW50IGNydGNfeSA9
IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKLQlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7Ci0JaW50IGNydGNfaCA9IGRybV9yZWN0X2hlaWdodCgm
cGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKLQl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwotCXUzMiBk
c3BhZGRyX29mZnNldDsKLQl1MzIgZHNwY250cjsKLQotCWRzcGNudHIgPSBwbGFuZV9zdGF0ZS0+
Y3RsIHwgaTl4eF9wbGFuZV9jdGxfY3J0YyhjcnRjX3N0YXRlKTsKLQotCWxpbmVhcl9vZmZzZXQg
PSBpbnRlbF9mYl94eV90b19saW5lYXIoeCwgeSwgcGxhbmVfc3RhdGUsIDApOwotCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gNCkKLQkJZHNwYWRkcl9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMF0ub2Zmc2V0OwotCWVsc2UKLQkJZHNwYWRkcl9vZmZzZXQgPSBsaW5lYXJf
b2Zmc2V0OwotCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJx
ZmxhZ3MpOwotCi0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIERTUFNUUklERShpOXh4X3Bs
YW5lKSwKLQkJCSAgcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnN0cmlkZSk7Ci0KLQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA8IDQpIHsKLQkJLyoKLQkJICogUExBTkVfQSBkb2Vzbid0IGFj
dHVhbGx5IGhhdmUgYSBmdWxsIHdpbmRvdwotCQkgKiBnZW5lcmF0b3IgYnV0IGxldCdzIGFzc3Vt
ZSB3ZSBzdGlsbCBuZWVkIHRvCi0JCSAqIHByb2dyYW0gd2hhdGV2ZXIgaXMgdGhlcmUuCi0JCSAq
LwotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgRFNQUE9TKGk5eHhfcGxhbmUpLAotCQkJ
CSAgKGNydGNfeSA8PCAxNikgfCBjcnRjX3gpOwotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwgRFNQU0laRShpOXh4X3BsYW5lKSwKLQkJCQkgICgoY3J0Y19oIC0gMSkgPDwgMTYpIHwgKGNy
dGNfdyAtIDEpKTsKLQl9IGVsc2UgaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpICYmIGk5eHhf
cGxhbmUgPT0gUExBTkVfQikgewotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUFJJTVBP
UyhpOXh4X3BsYW5lKSwKLQkJCQkgIChjcnRjX3kgPDwgMTYpIHwgY3J0Y194KTsKLQkJaW50ZWxf
ZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBSSU1TSVpFKGk5eHhfcGxhbmUpLAotCQkJCSAgKChjcnRj
X2ggLSAxKSA8PCAxNikgfCAoY3J0Y193IC0gMSkpOwotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgUFJJTUNOU1RBTFBIQShpOXh4X3BsYW5lKSwgMCk7Ci0JfQotCi0JaWYgKElTX0hBU1dF
TEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKLQkJaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIERTUE9GRlNFVChpOXh4X3BsYW5lKSwKLQkJCQkgICh5IDw8IDE2KSB8
IHgpOwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7Ci0JCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBEU1BMSU5PRkYoaTl4eF9wbGFuZSksCi0JCQkJICBsaW5lYXJf
b2Zmc2V0KTsKLQkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIERTUFRJTEVPRkYoaTl4eF9w
bGFuZSksCi0JCQkJICAoeSA8PCAxNikgfCB4KTsKLQl9Ci0KLQkvKgotCSAqIFRoZSBjb250cm9s
IHJlZ2lzdGVyIHNlbGYtYXJtcyBpZiB0aGUgcGxhbmUgd2FzIHByZXZpb3VzbHkKLQkgKiBkaXNh
YmxlZC4gVHJ5IHRvIG1ha2UgdGhlIHBsYW5lIGVuYWJsZSBhdG9taWMgYnkgd3JpdGluZwotCSAq
IHRoZSBjb250cm9sIHJlZ2lzdGVyIGp1c3QgYmVmb3JlIHRoZSBzdXJmYWNlIHJlZ2lzdGVyLgot
CSAqLwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBEU1BDTlRSKGk5eHhfcGxhbmUpLCBk
c3BjbnRyKTsKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQotCQlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgRFNQU1VSRihpOXh4X3BsYW5lKSwKLQkJCQkgIGludGVsX3BsYW5lX2dn
dHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSArIGRzcGFkZHJfb2Zmc2V0KTsKLQllbHNlCi0JCWludGVs
X2RlX3dyaXRlX2Z3KGRldl9wcml2LCBEU1BBRERSKGk5eHhfcGxhbmUpLAotCQkJCSAgaW50ZWxf
cGxhbmVfZ2d0dF9vZmZzZXQocGxhbmVfc3RhdGUpICsgZHNwYWRkcl9vZmZzZXQpOwotCi0Jc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci19
Ci0KLXN0YXRpYyB2b2lkIGk5eHhfZGlzYWJsZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAotCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUt
PmJhc2UuZGV2KTsKLQllbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHBsYW5lLT5pOXh4
X3BsYW5lOwotCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7Ci0JdTMyIGRzcGNudHI7Ci0KLQkvKgot
CSAqIERTUENOVFIgcGlwZSBnYW1tYSBlbmFibGUgb24gZzR4KyBhbmQgcGlwZSBjc2MKLQkgKiBl
bmFibGUgb24gaWxrKyBhZmZlY3QgdGhlIHBpcGUgYm90dG9tIGNvbG9yIGFzCi0JICogd2VsbCwg
c28gd2UgbXVzdCBjb25maWd1cmUgdGhlbSBldmVuIGlmIHRoZSBwbGFuZQotCSAqIGlzIGRpc2Fi
bGVkLgotCSAqCi0JICogT24gcHJlLWc0eCB0aGVyZSBpcyBubyB3YXkgdG8gZ2FtbWEgY29ycmVj
dCB0aGUKLQkgKiBwaXBlIGJvdHRvbSBjb2xvciBidXQgd2UnbGwga2VlcCBvbiBkb2luZyB0aGlz
Ci0JICogYW55d2F5IHNvIHRoYXQgdGhlIGNydGMgc3RhdGUgcmVhZG91dCB3b3JrcyBjb3JyZWN0
bHkuCi0JICovCi0JZHNwY250ciA9IGk5eHhfcGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0ZSk7Ci0K
LQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci0K
LQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgRFNQQ05UUihpOXh4X3BsYW5lKSwgZHNwY250
cik7Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKLQkJaW50ZWxfZGVfd3JpdGVfZnco
ZGV2X3ByaXYsIERTUFNVUkYoaTl4eF9wbGFuZSksIDApOwotCWVsc2UKLQkJaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIERTUEFERFIoaTl4eF9wbGFuZSksIDApOwotCi0Jc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci19Ci0KLXN0YXRp
YyBib29sIGk5eHhfcGxhbmVfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUs
Ci0JCQkJICAgIGVudW0gcGlwZSAqcGlwZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JZW51bSBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47Ci0JZW51bSBpOXh4X3BsYW5lX2lkIGk5eHhfcGxh
bmUgPSBwbGFuZS0+aTl4eF9wbGFuZTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQlib29s
IHJldDsKLQl1MzIgdmFsOwotCi0JLyoKLQkgKiBOb3QgMTAwJSBjb3JyZWN0IGZvciBwbGFuZXMg
dGhhdCBjYW4gbW92ZSBiZXR3ZWVuIHBpcGVzLAotCSAqIGJ1dCB0aGF0J3Mgb25seSB0aGUgY2Fz
ZSBmb3IgZ2VuMi00IHdoaWNoIGRvbid0IGhhdmUgYW55Ci0JICogZGlzcGxheSBwb3dlciB3ZWxs
cy4KLQkgKi8KLQlwb3dlcl9kb21haW4gPSBQT1dFUl9ET01BSU5fUElQRShwbGFuZS0+cGlwZSk7
Ci0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYs
IHBvd2VyX2RvbWFpbik7Ci0JaWYgKCF3YWtlcmVmKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQl2YWwg
PSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBEU1BDTlRSKGk5eHhfcGxhbmUpKTsKLQotCXJldCA9
IHZhbCAmIERJU1BMQVlfUExBTkVfRU5BQkxFOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gNSkKLQkJKnBpcGUgPSBwbGFuZS0+cGlwZTsKLQllbHNlCi0JCSpwaXBlID0gKHZhbCAmIERJ
U1BQTEFORV9TRUxfUElQRV9NQVNLKSA+PgotCQkJRElTUFBMQU5FX1NFTF9QSVBFX1NISUZUOwot
Ci0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbiwgd2FrZXJl
Zik7Ci0KLQlyZXR1cm4gcmV0OwotfQotCiBzdGF0aWMgdm9pZCBza2xfZGV0YWNoX3NjYWxlcihz
dHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywgaW50IGlkKQogewogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKQEAgLTExOTA5LDMzICsxMTQ0Nyw2IEBA
IHN0YXRpYyB2b2lkIGlsa19wY2hfY2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CQkJCQkgJnBpcGVfY29uZmlnLT5mZGlfbV9uKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfY3J0
Y19zdGF0ZV9yZXNldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkg
ICBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKLXsKLQltZW1zZXQoY3J0Y19zdGF0ZSwgMCwgc2l6
ZW9mKCpjcnRjX3N0YXRlKSk7Ci0KLQlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfc3RhdGVfcmVz
ZXQoJmNydGNfc3RhdGUtPnVhcGksICZjcnRjLT5iYXNlKTsKLQotCWNydGNfc3RhdGUtPmNwdV90
cmFuc2NvZGVyID0gSU5WQUxJRF9UUkFOU0NPREVSOwotCWNydGNfc3RhdGUtPm1hc3Rlcl90cmFu
c2NvZGVyID0gSU5WQUxJRF9UUkFOU0NPREVSOwotCWNydGNfc3RhdGUtPmhzd193b3JrYXJvdW5k
X3BpcGUgPSBJTlZBTElEX1BJUEU7Ci0JY3J0Y19zdGF0ZS0+b3V0cHV0X2Zvcm1hdCA9IElOVEVM
X09VVFBVVF9GT1JNQVRfSU5WQUxJRDsKLQljcnRjX3N0YXRlLT5zY2FsZXJfc3RhdGUuc2NhbGVy
X2lkID0gLTE7Ci0JY3J0Y19zdGF0ZS0+bXN0X21hc3Rlcl90cmFuc2NvZGVyID0gSU5WQUxJRF9U
UkFOU0NPREVSOwotfQotCi1zdGF0aWMgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmludGVsX2Ny
dGNfc3RhdGVfYWxsb2Moc3RydWN0IGludGVsX2NydGMgKmNydGMpCi17Ci0Jc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGU7Ci0KLQljcnRjX3N0YXRlID0ga21hbGxvYyhzaXplb2Yo
KmNydGNfc3RhdGUpLCBHRlBfS0VSTkVMKTsKLQotCWlmIChjcnRjX3N0YXRlKQotCQlpbnRlbF9j
cnRjX3N0YXRlX3Jlc2V0KGNydGNfc3RhdGUsIGNydGMpOwotCi0JcmV0dXJuIGNydGNfc3RhdGU7
Ci19Ci0KIC8qIFJldHVybnMgdGhlIGN1cnJlbnRseSBwcm9ncmFtbWVkIG1vZGUgb2YgdGhlIGdp
dmVuIGVuY29kZXIuICovCiBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqCiBpbnRlbF9lbmNvZGVy
X2N1cnJlbnRfbW9kZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKQEAgLTExOTc2LDE0
ICsxMTQ4Nyw2IEBAIGludGVsX2VuY29kZXJfY3VycmVudF9tb2RlKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyKQogCXJldHVybiBtb2RlOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9jcnRj
X2Rlc3Ryb3koc3RydWN0IGRybV9jcnRjICpjcnRjKQotewotCXN0cnVjdCBpbnRlbF9jcnRjICpp
bnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKLQotCWRybV9jcnRjX2NsZWFudXAoY3J0
Yyk7Ci0Ja2ZyZWUoaW50ZWxfY3J0Yyk7Ci19Ci0KIC8qKgogICogaW50ZWxfd21fbmVlZF91cGRh
dGUgLSBDaGVjayB3aGV0aGVyIHdhdGVybWFya3MgbmVlZCB1cGRhdGluZwogICogQGN1cjogY3Vy
cmVudCBwbGFuZSBzdGF0ZQpAQCAtMTUxODcsMTcgKzE0NjkwLDYgQEAgc3RhdGljIGludCBpbnRl
bF9hdG9taWNfcHJlcGFyZV9jb21taXQoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUp
CiAJcmV0dXJuIDA7CiB9CiAKLXUzMiBpbnRlbF9jcnRjX2dldF92YmxhbmtfY291bnRlcihzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YykKLXsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+
YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV92YmxhbmtfY3J0YyAqdmJsYW5rID0gJmRldi0+dmJsYW5r
W2RybV9jcnRjX2luZGV4KCZjcnRjLT5iYXNlKV07Ci0KLQlpZiAoIXZibGFuay0+bWF4X3ZibGFu
a19jb3VudCkKLQkJcmV0dXJuICh1MzIpZHJtX2NydGNfYWNjdXJhdGVfdmJsYW5rX2NvdW50KCZj
cnRjLT5iYXNlKTsKLQotCXJldHVybiBjcnRjLT5iYXNlLmZ1bmNzLT5nZXRfdmJsYW5rX2NvdW50
ZXIoJmNydGMtPmJhc2UpOwotfQotCiB2b2lkIGludGVsX2NydGNfYXJtX2ZpZm9fdW5kZXJydW4o
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIHsKQEAgLTE2MjUwLDMzNiArMTU3NDIsNiBAQCB2b2lkIGludGVsX3BsYW5l
X2Rlc3Ryb3koc3RydWN0IGRybV9wbGFuZSAqcGxhbmUpCiAJa2ZyZWUodG9faW50ZWxfcGxhbmUo
cGxhbmUpKTsKIH0KIAotc3RhdGljIGJvb2wgaTh4eF9wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRl
ZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCi0JCQkJCSAgICB1MzIgZm9ybWF0LCB1NjQgbW9k
aWZpZXIpCi17Ci0Jc3dpdGNoIChtb2RpZmllcikgewotCWNhc2UgRFJNX0ZPUk1BVF9NT0RfTElO
RUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6Ci0JCWJyZWFrOwotCWRlZmF1bHQ6
Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci0KLQlzd2l0Y2ggKGZvcm1hdCkgewotCWNhc2UgRFJNX0ZP
Uk1BVF9DODoKLQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgotCWNhc2UgRFJNX0ZPUk1BVF9YUkdC
MTU1NToKLQljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6Ci0JCXJldHVybiBtb2RpZmllciA9PSBE
Uk1fRk9STUFUX01PRF9MSU5FQVIgfHwKLQkJCW1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9Y
X1RJTEVEOwotCWRlZmF1bHQ6Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci19Ci0KLXN0YXRpYyBib29s
IGk5NjVfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5l
LAotCQkJCQkgICAgdTMyIGZvcm1hdCwgdTY0IG1vZGlmaWVyKQotewotCXN3aXRjaCAobW9kaWZp
ZXIpIHsKLQljYXNlIERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKLQljYXNlIEk5MTVfRk9STUFUX01P
RF9YX1RJTEVEOgotCQlicmVhazsKLQlkZWZhdWx0OgotCQlyZXR1cm4gZmFsc2U7Ci0JfQotCi0J
c3dpdGNoIChmb3JtYXQpIHsKLQljYXNlIERSTV9GT1JNQVRfQzg6Ci0JY2FzZSBEUk1fRk9STUFU
X1JHQjU2NToKLQljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1hC
R1I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQUJH
Ujg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9Y
QkdSMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9S
TUFUX0FCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgotCQlyZXR1
cm4gbW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8Ci0JCQltb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWF9USUxFRDsKLQlkZWZhdWx0OgotCQlyZXR1cm4gZmFsc2U7Ci0JfQot
fQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBpOTY1X3BsYW5lX2Z1bmNz
ID0gewotCS51cGRhdGVfcGxhbmUgPSBkcm1fYXRvbWljX2hlbHBlcl91cGRhdGVfcGxhbmUsCi0J
LmRpc2FibGVfcGxhbmUgPSBkcm1fYXRvbWljX2hlbHBlcl9kaXNhYmxlX3BsYW5lLAotCS5kZXN0
cm95ID0gaW50ZWxfcGxhbmVfZGVzdHJveSwKLQkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSA9IGlu
dGVsX3BsYW5lX2R1cGxpY2F0ZV9zdGF0ZSwKLQkuYXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBpbnRl
bF9wbGFuZV9kZXN0cm95X3N0YXRlLAotCS5mb3JtYXRfbW9kX3N1cHBvcnRlZCA9IGk5NjVfcGxh
bmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9w
bGFuZV9mdW5jcyBpOHh4X3BsYW5lX2Z1bmNzID0gewotCS51cGRhdGVfcGxhbmUgPSBkcm1fYXRv
bWljX2hlbHBlcl91cGRhdGVfcGxhbmUsCi0JLmRpc2FibGVfcGxhbmUgPSBkcm1fYXRvbWljX2hl
bHBlcl9kaXNhYmxlX3BsYW5lLAotCS5kZXN0cm95ID0gaW50ZWxfcGxhbmVfZGVzdHJveSwKLQku
YXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSA9IGludGVsX3BsYW5lX2R1cGxpY2F0ZV9zdGF0ZSwKLQku
YXRvbWljX2Rlc3Ryb3lfc3RhdGUgPSBpbnRlbF9wbGFuZV9kZXN0cm95X3N0YXRlLAotCS5mb3Jt
YXRfbW9kX3N1cHBvcnRlZCA9IGk4eHhfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCi19Owot
Ci1zdGF0aWMgYm9vbCBpOXh4X3BsYW5lX2hhc19mYmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAotCQkJICAgICAgIGVudW0gaTl4eF9wbGFuZV9pZCBpOXh4X3BsYW5lKQotewot
CWlmICghSEFTX0ZCQyhkZXZfcHJpdikpCi0JCXJldHVybiBmYWxzZTsKLQotCWlmIChJU19CUk9B
RFdFTEwoZGV2X3ByaXYpIHx8IElTX0hBU1dFTEwoZGV2X3ByaXYpKQotCQlyZXR1cm4gaTl4eF9w
bGFuZSA9PSBQTEFORV9BOyAvKiB0aWVkIHRvIHBpcGUgQSAqLwotCWVsc2UgaWYgKElTX0lWWUJS
SURHRShkZXZfcHJpdikpCi0JCXJldHVybiBpOXh4X3BsYW5lID09IFBMQU5FX0EgfHwgaTl4eF9w
bGFuZSA9PSBQTEFORV9CIHx8Ci0JCQlpOXh4X3BsYW5lID09IFBMQU5FX0M7Ci0JZWxzZSBpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQotCQlyZXR1cm4gaTl4eF9wbGFuZSA9PSBQTEFORV9B
IHx8IGk5eHhfcGxhbmUgPT0gUExBTkVfQjsKLQllbHNlCi0JCXJldHVybiBpOXh4X3BsYW5lID09
IFBMQU5FX0E7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgaW50ZWxfcGxhbmUgKgotaW50ZWxfcHJpbWFy
eV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBp
cGUgcGlwZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwotCWNvbnN0IHN0cnVjdCBk
cm1fcGxhbmVfZnVuY3MgKnBsYW5lX2Z1bmNzOwotCXVuc2lnbmVkIGludCBzdXBwb3J0ZWRfcm90
YXRpb25zOwotCWNvbnN0IHUzMiAqZm9ybWF0czsKLQlpbnQgbnVtX2Zvcm1hdHM7Ci0JaW50IHJl
dCwgenBvczsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCi0JCXJldHVybiBza2xf
dW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSwKLQkJCQkJCSAgUExBTkVfUFJJ
TUFSWSk7Ci0KLQlwbGFuZSA9IGludGVsX3BsYW5lX2FsbG9jKCk7Ci0JaWYgKElTX0VSUihwbGFu
ZSkpCi0JCXJldHVybiBwbGFuZTsKLQotCXBsYW5lLT5waXBlID0gcGlwZTsKLQkvKgotCSAqIE9u
IGdlbjIvMyBvbmx5IHBsYW5lIEEgY2FuIGRvIEZCQywgYnV0IHRoZSBwYW5lbCBmaXR0ZXIgYW5k
IExWRFMKLQkgKiBwb3J0IGlzIGhvb2tlZCB0byBwaXBlIEIuIEhlbmNlIHdlIHdhbnQgcGxhbmUg
QSBmZWVkaW5nIHBpcGUgQi4KLQkgKi8KLQlpZiAoSEFTX0ZCQyhkZXZfcHJpdikgJiYgSU5URUxf
R0VOKGRldl9wcml2KSA8IDQgJiYKLQkgICAgSU5URUxfTlVNX1BJUEVTKGRldl9wcml2KSA9PSAy
KQotCQlwbGFuZS0+aTl4eF9wbGFuZSA9IChlbnVtIGk5eHhfcGxhbmVfaWQpICFwaXBlOwotCWVs
c2UKLQkJcGxhbmUtPmk5eHhfcGxhbmUgPSAoZW51bSBpOXh4X3BsYW5lX2lkKSBwaXBlOwotCXBs
YW5lLT5pZCA9IFBMQU5FX1BSSU1BUlk7Ci0JcGxhbmUtPmZyb250YnVmZmVyX2JpdCA9IElOVEVM
X0ZST05UQlVGRkVSKHBpcGUsIHBsYW5lLT5pZCk7Ci0KLQlwbGFuZS0+aGFzX2ZiYyA9IGk5eHhf
cGxhbmVfaGFzX2ZiYyhkZXZfcHJpdiwgcGxhbmUtPmk5eHhfcGxhbmUpOwotCWlmIChwbGFuZS0+
aGFzX2ZiYykgewotCQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKLQot
CQlmYmMtPnBvc3NpYmxlX2ZyYW1lYnVmZmVyX2JpdHMgfD0gcGxhbmUtPmZyb250YnVmZmVyX2Jp
dDsKLQl9Ci0KLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhk
ZXZfcHJpdikpIHsKLQkJZm9ybWF0cyA9IHZsdl9wcmltYXJ5X2Zvcm1hdHM7Ci0JCW51bV9mb3Jt
YXRzID0gQVJSQVlfU0laRSh2bHZfcHJpbWFyeV9mb3JtYXRzKTsKLQl9IGVsc2UgaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gNCkgewotCQkvKgotCQkgKiBXYUZQMTZHYW1tYUVuYWJsaW5nOml2
YgotCQkgKiAiV29ya2Fyb3VuZCA6IFdoZW4gdXNpbmcgdGhlIDY0LWJpdCBmb3JtYXQsIHRoZSBw
bGFuZQotCQkgKiAgb3V0cHV0IG9uIGVhY2ggY29sb3IgY2hhbm5lbCBoYXMgb25lIHF1YXJ0ZXIg
YW1wbGl0dWRlLgotCQkgKiAgSXQgY2FuIGJlIGJyb3VnaHQgdXAgdG8gZnVsbCBhbXBsaXR1ZGUg
YnkgdXNpbmcgcGlwZQotCQkgKiAgZ2FtbWEgY29ycmVjdGlvbiBvciBwaXBlIGNvbG9yIHNwYWNl
IGNvbnZlcnNpb24gdG8KLQkJICogIG11bHRpcGx5IHRoZSBwbGFuZSBvdXRwdXQgYnkgZm91ci4i
Ci0JCSAqCi0JCSAqIFRoZXJlIGlzIG5vIGRlZGljYXRlZCBwbGFuZSBnYW1tYSBmb3IgdGhlIHBy
aW1hcnkgcGxhbmUsCi0JCSAqIGFuZCB1c2luZyB0aGUgcGlwZSBnYW1tYS9jc2MgY291bGQgY29u
ZmxpY3Qgd2l0aCBvdGhlcgotCQkgKiBwbGFuZXMsIHNvIHdlIGNob29zZSBub3QgdG8gZXhwb3Nl
IGZwMTYgb24gSVZCIHByaW1hcnkKLQkJICogcGxhbmVzLiBIU1cgcHJpbWFyeSBwbGFuZXMgbm8g
bG9uZ2VyIGhhdmUgdGhpcyBwcm9ibGVtLgotCQkgKi8KLQkJaWYgKElTX0lWWUJSSURHRShkZXZf
cHJpdikpIHsKLQkJCWZvcm1hdHMgPSBpdmJfcHJpbWFyeV9mb3JtYXRzOwotCQkJbnVtX2Zvcm1h
dHMgPSBBUlJBWV9TSVpFKGl2Yl9wcmltYXJ5X2Zvcm1hdHMpOwotCQl9IGVsc2UgewotCQkJZm9y
bWF0cyA9IGk5NjVfcHJpbWFyeV9mb3JtYXRzOwotCQkJbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpF
KGk5NjVfcHJpbWFyeV9mb3JtYXRzKTsKLQkJfQotCX0gZWxzZSB7Ci0JCWZvcm1hdHMgPSBpOHh4
X3ByaW1hcnlfZm9ybWF0czsKLQkJbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKGk4eHhfcHJpbWFy
eV9mb3JtYXRzKTsKLQl9Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQotCQlwbGFu
ZV9mdW5jcyA9ICZpOTY1X3BsYW5lX2Z1bmNzOwotCWVsc2UKLQkJcGxhbmVfZnVuY3MgPSAmaTh4
eF9wbGFuZV9mdW5jczsKLQotCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVS
UllWSUVXKGRldl9wcml2KSkKLQkJcGxhbmUtPm1pbl9jZGNsayA9IHZsdl9wbGFuZV9taW5fY2Rj
bGs7Ci0JZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9w
cml2KSkKLQkJcGxhbmUtPm1pbl9jZGNsayA9IGhzd19wbGFuZV9taW5fY2RjbGs7Ci0JZWxzZSBp
ZiAoSVNfSVZZQlJJREdFKGRldl9wcml2KSkKLQkJcGxhbmUtPm1pbl9jZGNsayA9IGl2Yl9wbGFu
ZV9taW5fY2RjbGs7Ci0JZWxzZQotCQlwbGFuZS0+bWluX2NkY2xrID0gaTl4eF9wbGFuZV9taW5f
Y2RjbGs7Ci0KLQlwbGFuZS0+bWF4X3N0cmlkZSA9IGk5eHhfcGxhbmVfbWF4X3N0cmlkZTsKLQlw
bGFuZS0+dXBkYXRlX3BsYW5lID0gaTl4eF91cGRhdGVfcGxhbmU7Ci0JcGxhbmUtPmRpc2FibGVf
cGxhbmUgPSBpOXh4X2Rpc2FibGVfcGxhbmU7Ci0JcGxhbmUtPmdldF9od19zdGF0ZSA9IGk5eHhf
cGxhbmVfZ2V0X2h3X3N0YXRlOwotCXBsYW5lLT5jaGVja19wbGFuZSA9IGk5eHhfcGxhbmVfY2hl
Y2s7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA1IHx8IElTX0c0WChkZXZfcHJpdikp
Ci0JCXJldCA9IGRybV91bml2ZXJzYWxfcGxhbmVfaW5pdCgmZGV2X3ByaXYtPmRybSwgJnBsYW5l
LT5iYXNlLAotCQkJCQkgICAgICAgMCwgcGxhbmVfZnVuY3MsCi0JCQkJCSAgICAgICBmb3JtYXRz
LCBudW1fZm9ybWF0cywKLQkJCQkJICAgICAgIGk5eHhfZm9ybWF0X21vZGlmaWVycywKLQkJCQkJ
ICAgICAgIERSTV9QTEFORV9UWVBFX1BSSU1BUlksCi0JCQkJCSAgICAgICAicHJpbWFyeSAlYyIs
IHBpcGVfbmFtZShwaXBlKSk7Ci0JZWxzZQotCQlyZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5lX2lu
aXQoJmRldl9wcml2LT5kcm0sICZwbGFuZS0+YmFzZSwKLQkJCQkJICAgICAgIDAsIHBsYW5lX2Z1
bmNzLAotCQkJCQkgICAgICAgZm9ybWF0cywgbnVtX2Zvcm1hdHMsCi0JCQkJCSAgICAgICBpOXh4
X2Zvcm1hdF9tb2RpZmllcnMsCi0JCQkJCSAgICAgICBEUk1fUExBTkVfVFlQRV9QUklNQVJZLAot
CQkJCQkgICAgICAgInBsYW5lICVjIiwKLQkJCQkJICAgICAgIHBsYW5lX25hbWUocGxhbmUtPmk5
eHhfcGxhbmUpKTsKLQlpZiAocmV0KQotCQlnb3RvIGZhaWw7Ci0KLQlpZiAoSVNfQ0hFUlJZVklF
VyhkZXZfcHJpdikgJiYgcGlwZSA9PSBQSVBFX0IpIHsKLQkJc3VwcG9ydGVkX3JvdGF0aW9ucyA9
Ci0JCQlEUk1fTU9ERV9ST1RBVEVfMCB8IERSTV9NT0RFX1JPVEFURV8xODAgfAotCQkJRFJNX01P
REVfUkVGTEVDVF9YOwotCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KSB7Ci0J
CXN1cHBvcnRlZF9yb3RhdGlvbnMgPQotCQkJRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9S
T1RBVEVfMTgwOwotCX0gZWxzZSB7Ci0JCXN1cHBvcnRlZF9yb3RhdGlvbnMgPSBEUk1fTU9ERV9S
T1RBVEVfMDsKLQl9Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQotCQlkcm1fcGxh
bmVfY3JlYXRlX3JvdGF0aW9uX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwKLQkJCQkJCSAgIERSTV9N
T0RFX1JPVEFURV8wLAotCQkJCQkJICAgc3VwcG9ydGVkX3JvdGF0aW9ucyk7Ci0KLQl6cG9zID0g
MDsKLQlkcm1fcGxhbmVfY3JlYXRlX3pwb3NfaW1tdXRhYmxlX3Byb3BlcnR5KCZwbGFuZS0+YmFz
ZSwgenBvcyk7Ci0KLQlkcm1fcGxhbmVfaGVscGVyX2FkZCgmcGxhbmUtPmJhc2UsICZpbnRlbF9w
bGFuZV9oZWxwZXJfZnVuY3MpOwotCi0JcmV0dXJuIHBsYW5lOwotCi1mYWlsOgotCWludGVsX3Bs
YW5lX2ZyZWUocGxhbmUpOwotCi0JcmV0dXJuIEVSUl9QVFIocmV0KTsKLX0KLQotc3RhdGljIGlu
dCBpbnRlbF9jcnRjX2xhdGVfcmVnaXN0ZXIoc3RydWN0IGRybV9jcnRjICpjcnRjKQotewotCWlu
dGVsX2NydGNfZGVidWdmc19hZGQoY3J0Yyk7Ci0JcmV0dXJuIDA7Ci19Ci0KLSNkZWZpbmUgSU5U
RUxfQ1JUQ19GVU5DUyBcCi0JLmdhbW1hX3NldCA9IGRybV9hdG9taWNfaGVscGVyX2xlZ2FjeV9n
YW1tYV9zZXQsIFwKLQkuc2V0X2NvbmZpZyA9IGRybV9hdG9taWNfaGVscGVyX3NldF9jb25maWcs
IFwKLQkuZGVzdHJveSA9IGludGVsX2NydGNfZGVzdHJveSwgXAotCS5wYWdlX2ZsaXAgPSBkcm1f
YXRvbWljX2hlbHBlcl9wYWdlX2ZsaXAsIFwKLQkuYXRvbWljX2R1cGxpY2F0ZV9zdGF0ZSA9IGlu
dGVsX2NydGNfZHVwbGljYXRlX3N0YXRlLCBcCi0JLmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50
ZWxfY3J0Y19kZXN0cm95X3N0YXRlLCBcCi0JLnNldF9jcmNfc291cmNlID0gaW50ZWxfY3J0Y19z
ZXRfY3JjX3NvdXJjZSwgXAotCS52ZXJpZnlfY3JjX3NvdXJjZSA9IGludGVsX2NydGNfdmVyaWZ5
X2NyY19zb3VyY2UsIFwKLQkuZ2V0X2NyY19zb3VyY2VzID0gaW50ZWxfY3J0Y19nZXRfY3JjX3Nv
dXJjZXMsIFwKLQkubGF0ZV9yZWdpc3RlciA9IGludGVsX2NydGNfbGF0ZV9yZWdpc3RlcgotCi1z
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9jcnRjX2Z1bmNzIGJkd19jcnRjX2Z1bmNzID0gewotCUlO
VEVMX0NSVENfRlVOQ1MsCi0KLQkuZ2V0X3ZibGFua19jb3VudGVyID0gZzR4X2dldF92Ymxhbmtf
Y291bnRlciwKLQkuZW5hYmxlX3ZibGFuayA9IGJkd19lbmFibGVfdmJsYW5rLAotCS5kaXNhYmxl
X3ZibGFuayA9IGJkd19kaXNhYmxlX3ZibGFuaywKLQkuZ2V0X3ZibGFua190aW1lc3RhbXAgPSBp
bnRlbF9jcnRjX2dldF92YmxhbmtfdGltZXN0YW1wLAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1fY3J0Y19mdW5jcyBpbGtfY3J0Y19mdW5jcyA9IHsKLQlJTlRFTF9DUlRDX0ZVTkNTLAot
Ci0JLmdldF92YmxhbmtfY291bnRlciA9IGc0eF9nZXRfdmJsYW5rX2NvdW50ZXIsCi0JLmVuYWJs
ZV92YmxhbmsgPSBpbGtfZW5hYmxlX3ZibGFuaywKLQkuZGlzYWJsZV92YmxhbmsgPSBpbGtfZGlz
YWJsZV92YmxhbmssCi0JLmdldF92YmxhbmtfdGltZXN0YW1wID0gaW50ZWxfY3J0Y19nZXRfdmJs
YW5rX3RpbWVzdGFtcCwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfZnVuY3Mg
ZzR4X2NydGNfZnVuY3MgPSB7Ci0JSU5URUxfQ1JUQ19GVU5DUywKLQotCS5nZXRfdmJsYW5rX2Nv
dW50ZXIgPSBnNHhfZ2V0X3ZibGFua19jb3VudGVyLAotCS5lbmFibGVfdmJsYW5rID0gaTk2NV9l
bmFibGVfdmJsYW5rLAotCS5kaXNhYmxlX3ZibGFuayA9IGk5NjVfZGlzYWJsZV92YmxhbmssCi0J
LmdldF92YmxhbmtfdGltZXN0YW1wID0gaW50ZWxfY3J0Y19nZXRfdmJsYW5rX3RpbWVzdGFtcCwK
LX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2NydGNfZnVuY3MgaTk2NV9jcnRjX2Z1bmNz
ID0gewotCUlOVEVMX0NSVENfRlVOQ1MsCi0KLQkuZ2V0X3ZibGFua19jb3VudGVyID0gaTkxNV9n
ZXRfdmJsYW5rX2NvdW50ZXIsCi0JLmVuYWJsZV92YmxhbmsgPSBpOTY1X2VuYWJsZV92Ymxhbmss
Ci0JLmRpc2FibGVfdmJsYW5rID0gaTk2NV9kaXNhYmxlX3ZibGFuaywKLQkuZ2V0X3ZibGFua190
aW1lc3RhbXAgPSBpbnRlbF9jcnRjX2dldF92YmxhbmtfdGltZXN0YW1wLAotfTsKLQotc3RhdGlj
IGNvbnN0IHN0cnVjdCBkcm1fY3J0Y19mdW5jcyBpOTE1Z21fY3J0Y19mdW5jcyA9IHsKLQlJTlRF
TF9DUlRDX0ZVTkNTLAotCi0JLmdldF92YmxhbmtfY291bnRlciA9IGk5MTVfZ2V0X3ZibGFua19j
b3VudGVyLAotCS5lbmFibGVfdmJsYW5rID0gaTkxNWdtX2VuYWJsZV92YmxhbmssCi0JLmRpc2Fi
bGVfdmJsYW5rID0gaTkxNWdtX2Rpc2FibGVfdmJsYW5rLAotCS5nZXRfdmJsYW5rX3RpbWVzdGFt
cCA9IGludGVsX2NydGNfZ2V0X3ZibGFua190aW1lc3RhbXAsCi19OwotCi1zdGF0aWMgY29uc3Qg
c3RydWN0IGRybV9jcnRjX2Z1bmNzIGk5MTVfY3J0Y19mdW5jcyA9IHsKLQlJTlRFTF9DUlRDX0ZV
TkNTLAotCi0JLmdldF92YmxhbmtfY291bnRlciA9IGk5MTVfZ2V0X3ZibGFua19jb3VudGVyLAot
CS5lbmFibGVfdmJsYW5rID0gaTh4eF9lbmFibGVfdmJsYW5rLAotCS5kaXNhYmxlX3ZibGFuayA9
IGk4eHhfZGlzYWJsZV92YmxhbmssCi0JLmdldF92YmxhbmtfdGltZXN0YW1wID0gaW50ZWxfY3J0
Y19nZXRfdmJsYW5rX3RpbWVzdGFtcCwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Ny
dGNfZnVuY3MgaTh4eF9jcnRjX2Z1bmNzID0gewotCUlOVEVMX0NSVENfRlVOQ1MsCi0KLQkvKiBu
byBodyB2YmxhbmsgY291bnRlciAqLwotCS5lbmFibGVfdmJsYW5rID0gaTh4eF9lbmFibGVfdmJs
YW5rLAotCS5kaXNhYmxlX3ZibGFuayA9IGk4eHhfZGlzYWJsZV92YmxhbmssCi0JLmdldF92Ymxh
bmtfdGltZXN0YW1wID0gaW50ZWxfY3J0Y19nZXRfdmJsYW5rX3RpbWVzdGFtcCwKLX07Ci0KLXN0
YXRpYyBzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0Y19hbGxvYyh2b2lkKQotewotCXN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
OwotCi0JY3J0YyA9IGt6YWxsb2Moc2l6ZW9mKCpjcnRjKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFj
cnRjKQotCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKLQotCWNydGNfc3RhdGUgPSBpbnRlbF9j
cnRjX3N0YXRlX2FsbG9jKGNydGMpOwotCWlmICghY3J0Y19zdGF0ZSkgewotCQlrZnJlZShjcnRj
KTsKLQkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7Ci0JfQotCi0JY3J0Yy0+YmFzZS5zdGF0ZSA9
ICZjcnRjX3N0YXRlLT51YXBpOwotCWNydGMtPmNvbmZpZyA9IGNydGNfc3RhdGU7Ci0KLQlyZXR1
cm4gY3J0YzsKLX0KLQotc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19mcmVlKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjKQotewotCWludGVsX2NydGNfZGVzdHJveV9zdGF0ZSgmY3J0Yy0+YmFzZSwgY3J0
Yy0+YmFzZS5zdGF0ZSk7Ci0Ja2ZyZWUoY3J0Yyk7Ci19Ci0KIHN0YXRpYyB2b2lkIGludGVsX3Bs
YW5lX3Bvc3NpYmxlX2NydGNzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CkBAIC0xNjU5MiwxMDAgKzE1NzU0LDYg
QEAgc3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfcG9zc2libGVfY3J0Y3NfaW5pdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMgaW50IGludGVsX2NydGNf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQot
ewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcHJpbWFyeSwgKmN1cnNvcjsKLQljb25zdCBzdHJ1Y3Qg
ZHJtX2NydGNfZnVuY3MgKmZ1bmNzOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwotCWludCBz
cHJpdGUsIHJldDsKLQotCWNydGMgPSBpbnRlbF9jcnRjX2FsbG9jKCk7Ci0JaWYgKElTX0VSUihj
cnRjKSkKLQkJcmV0dXJuIFBUUl9FUlIoY3J0Yyk7Ci0KLQljcnRjLT5waXBlID0gcGlwZTsKLQlj
cnRjLT5udW1fc2NhbGVycyA9IFJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPm51bV9zY2FsZXJzW3Bp
cGVdOwotCi0JcHJpbWFyeSA9IGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBw
aXBlKTsKLQlpZiAoSVNfRVJSKHByaW1hcnkpKSB7Ci0JCXJldCA9IFBUUl9FUlIocHJpbWFyeSk7
Ci0JCWdvdG8gZmFpbDsKLQl9Ci0JY3J0Yy0+cGxhbmVfaWRzX21hc2sgfD0gQklUKHByaW1hcnkt
PmlkKTsKLQotCWZvcl9lYWNoX3Nwcml0ZShkZXZfcHJpdiwgcGlwZSwgc3ByaXRlKSB7Ci0JCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7Ci0KLQkJcGxhbmUgPSBpbnRlbF9zcHJpdGVfcGxhbmVf
Y3JlYXRlKGRldl9wcml2LCBwaXBlLCBzcHJpdGUpOwotCQlpZiAoSVNfRVJSKHBsYW5lKSkgewot
CQkJcmV0ID0gUFRSX0VSUihwbGFuZSk7Ci0JCQlnb3RvIGZhaWw7Ci0JCX0KLQkJY3J0Yy0+cGxh
bmVfaWRzX21hc2sgfD0gQklUKHBsYW5lLT5pZCk7Ci0JfQotCi0JY3Vyc29yID0gaW50ZWxfY3Vy
c29yX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSk7Ci0JaWYgKElTX0VSUihjdXJzb3IpKSB7
Ci0JCXJldCA9IFBUUl9FUlIoY3Vyc29yKTsKLQkJZ290byBmYWlsOwotCX0KLQljcnRjLT5wbGFu
ZV9pZHNfbWFzayB8PSBCSVQoY3Vyc29yLT5pZCk7Ci0KLQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYp
KSB7Ci0JCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSB8fAotCQkgICAgSVNfVkFMTEVZVklF
VyhkZXZfcHJpdikgfHwgSVNfRzRYKGRldl9wcml2KSkKLQkJCWZ1bmNzID0gJmc0eF9jcnRjX2Z1
bmNzOwotCQllbHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDQpKQotCQkJZnVuY3MgPSAmaTk2NV9j
cnRjX2Z1bmNzOwotCQllbHNlIGlmIChJU19JOTQ1R00oZGV2X3ByaXYpIHx8IElTX0k5MTVHTShk
ZXZfcHJpdikpCi0JCQlmdW5jcyA9ICZpOTE1Z21fY3J0Y19mdW5jczsKLQkJZWxzZSBpZiAoSVNf
R0VOKGRldl9wcml2LCAzKSkKLQkJCWZ1bmNzID0gJmk5MTVfY3J0Y19mdW5jczsKLQkJZWxzZQot
CQkJZnVuY3MgPSAmaTh4eF9jcnRjX2Z1bmNzOwotCX0gZWxzZSB7Ci0JCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDgpCi0JCQlmdW5jcyA9ICZiZHdfY3J0Y19mdW5jczsKLQkJZWxzZQotCQkJ
ZnVuY3MgPSAmaWxrX2NydGNfZnVuY3M7Ci0JfQotCi0JcmV0ID0gZHJtX2NydGNfaW5pdF93aXRo
X3BsYW5lcygmZGV2X3ByaXYtPmRybSwgJmNydGMtPmJhc2UsCi0JCQkJCSZwcmltYXJ5LT5iYXNl
LCAmY3Vyc29yLT5iYXNlLAotCQkJCQlmdW5jcywgInBpcGUgJWMiLCBwaXBlX25hbWUocGlwZSkp
OwotCWlmIChyZXQpCi0JCWdvdG8gZmFpbDsKLQotCUJVR19PTihwaXBlID49IEFSUkFZX1NJWkUo
ZGV2X3ByaXYtPnBpcGVfdG9fY3J0Y19tYXBwaW5nKSB8fAotCSAgICAgICBkZXZfcHJpdi0+cGlw
ZV90b19jcnRjX21hcHBpbmdbcGlwZV0gIT0gTlVMTCk7Ci0JZGV2X3ByaXYtPnBpcGVfdG9fY3J0
Y19tYXBwaW5nW3BpcGVdID0gY3J0YzsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSkg
ewotCQllbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHByaW1hcnktPmk5eHhfcGxhbmU7
Ci0KLQkJQlVHX09OKGk5eHhfcGxhbmUgPj0gQVJSQVlfU0laRShkZXZfcHJpdi0+cGxhbmVfdG9f
Y3J0Y19tYXBwaW5nKSB8fAotCQkgICAgICAgZGV2X3ByaXYtPnBsYW5lX3RvX2NydGNfbWFwcGlu
Z1tpOXh4X3BsYW5lXSAhPSBOVUxMKTsKLQkJZGV2X3ByaXYtPnBsYW5lX3RvX2NydGNfbWFwcGlu
Z1tpOXh4X3BsYW5lXSA9IGNydGM7Ci0JfQotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTApCi0JCWRybV9jcnRjX2NyZWF0ZV9zY2FsaW5nX2ZpbHRlcl9wcm9wZXJ0eSgmY3J0Yy0+YmFz
ZSwKLQkJCQkJCUJJVChEUk1fU0NBTElOR19GSUxURVJfREVGQVVMVCkgfAotCQkJCQkJQklUKERS
TV9TQ0FMSU5HX0ZJTFRFUl9ORUFSRVNUX05FSUdIQk9SKSk7Ci0KLQlpbnRlbF9jb2xvcl9pbml0
KGNydGMpOwotCi0JaW50ZWxfY3J0Y19jcmNfaW5pdChjcnRjKTsKLQotCWRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLCBkcm1fY3J0Y19pbmRleCgmY3J0Yy0+YmFzZSkgIT0gY3J0Yy0+cGlwZSk7
Ci0KLQlyZXR1cm4gMDsKLQotZmFpbDoKLQlpbnRlbF9jcnRjX2ZyZWUoY3J0Yyk7Ci0KLQlyZXR1
cm4gcmV0OwotfQogCiBpbnQgaW50ZWxfZ2V0X3BpcGVfZnJvbV9jcnRjX2lkX2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkJICAgICAgc3RydWN0IGRybV9maWxl
ICpmaWxlKQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZngK

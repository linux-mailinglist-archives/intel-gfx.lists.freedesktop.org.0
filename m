Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7B49B5703B
	for <lists+intel-gfx@lfdr.de>; Wed, 26 Jun 2019 20:03:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C071F6E4CE;
	Wed, 26 Jun 2019 18:03:57 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 96EDC6E4C1
 for <intel-gfx@lists.freedesktop.org>; Wed, 26 Jun 2019 18:03:56 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 26 Jun 2019 11:03:56 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,420,1557212400"; d="scan'208";a="152735069"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga007.jf.intel.com with SMTP; 26 Jun 2019 11:03:54 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Wed, 26 Jun 2019 21:03:53 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 26 Jun 2019 21:03:42 +0300
Message-Id: <20190626180344.26314-4-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190626180344.26314-1-ville.syrjala@linux.intel.com>
References: <20190626180344.26314-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 3/5] drm/i915: Split pch irq handling to
 ack+handler
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClRo
ZSBwcm9wZXIgd2F5IHRvIHByb2Nlc3MgaW50ZXJydXB0cyBpcyB0byBmaXJzdCBhY2tub3dsZWRn
ZSB0aGVtCmFsbCwgYW5kIGxhdGVyIHByb2Nlc3MgdGhlbS4gU3RhcnQgZG93biB0aGF0IHBhdGgg
Zm9yIHBjaCBpbnRlcnJ1cHRzCmJ5IGNvbGxlY3RpbmcgdGhlIHJlbGV2YW50IHJlZ2lzdGVyIHZh
bHVlcyBpbnRvIGEgc3RydWN0IHNvIHRoYXQKd2UgY2FuIGNhcnJ5IHRoZW0gZnJvbSB0aGUgYWNr
IHBhcnQgdG8gdGhlIGhhbmRsZXIgcGFydC4KCnYyOiBEcm9wIHRoZSB6ZXJvIGluaXRpYWxpemF0
aW9uIChDaHJpcykKICAgIEFkYXB0IHRvIFBDSF9NQ0MgY2hhbmdlcwoKU2lnbmVkLW9mZi1ieTog
VmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQt
Ynk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfaXJxLmMgfCAyMDMgKysrKysrKysrKysrKysrKysrKysrLS0tLS0t
LS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMzQgaW5zZXJ0aW9ucygrKSwgNjkgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5kZXggODQ0MGVkZTgxMTU0Li5iYzZmODE0YWE1YTEg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpAQCAtMjM2MSw2ICsyMzYxLDE5IEBAIHN0YXRpYyBp
cnFyZXR1cm5fdCBjaGVycnl2aWV3X2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKIAly
ZXR1cm4gcmV0OwogfQogCitzdHJ1Y3QgcGNoX2lycV9yZWdzIHsKKwl1MzIgaWlyOworCXUzMiBz
ZXJyX2ludDsgLyogY3B0L2xwdCAqLworCXVuaW9uIHsKKwkJc3RydWN0IGhwZF9pcnFfcmVncyBo
cGQ7IC8qIGlieCsgKi8KKwkJc3RydWN0IGhwZF9pcnFfcmVncyBkZGk7IC8qIGljcCsgKi8KKwl9
OworCXVuaW9uIHsKKwkJc3RydWN0IGhwZF9pcnFfcmVncyBocGQyOyAvKiBzcHQrICovCisJCXN0
cnVjdCBocGRfaXJxX3JlZ3MgdGM7IC8qIGljcCsgKi8KKwl9OworfTsKKwogc3RhdGljIHZvaWQg
aWJ4X2hwZF9pcnFfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAg
ICBzdHJ1Y3QgaHBkX2lycV9yZWdzICpocGQpCiB7CkBAIC0yMzk3LDE1ICsyNDEwLDIxIEBAIHN0
YXRpYyB2b2lkIGlieF9ocGRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCWludGVsX2hwZF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGluX21hc2ssIGxvbmdf
bWFzayk7CiB9CiAKLXN0YXRpYyB2b2lkIGlieF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwY2hfaWlyKQorc3RhdGljIHZvaWQgaWJ4X2lycV9hY2so
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJc3RydWN0IHBjaF9pcnFfcmVn
cyAqcGNoKQogewotCXN0cnVjdCBocGRfaXJxX3JlZ3MgaHBkOwotCWludCBwaXBlOworCXBjaC0+
aHBkLmhvdHBsdWdfdHJpZ2dlciA9IHBjaC0+aWlyICYgU0RFX0hPVFBMVUdfTUFTSzsKIAotCWhw
ZC5ob3RwbHVnX3RyaWdnZXIgPSBwY2hfaWlyICYgU0RFX0hPVFBMVUdfTUFTSzsKKwlpYnhfaHBk
X2lycV9hY2soZGV2X3ByaXYsICZwY2gtPmhwZCk7Cit9CisKK3N0YXRpYyB2b2lkIGlieF9pcnFf
aGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgICAgY29uc3Qg
c3RydWN0IHBjaF9pcnFfcmVncyAqcGNoKQoreworCXUzMiBwY2hfaWlyID0gcGNoLT5paXI7CisJ
ZW51bSBwaXBlIHBpcGU7CiAKLQlpYnhfaHBkX2lycV9hY2soZGV2X3ByaXYsICZocGQpOwotCWli
eF9ocGRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsICZocGQsIGhwZF9pYngpOworCWlieF9ocGRfaXJx
X2hhbmRsZXIoZGV2X3ByaXYsICZwY2gtPmhwZCwgaHBkX2lieCk7CiAKIAlpZiAocGNoX2lpciAm
IFNERV9BVURJT19QT1dFUl9NQVNLKSB7CiAJCWludCBwb3J0ID0gZmZzKChwY2hfaWlyICYgU0RF
X0FVRElPX1BPV0VSX01BU0spID4+CkBAIC0yNDcxLDkgKzI0OTAsMTcgQEAgc3RhdGljIHZvaWQg
aXZiX2Vycl9pbnRfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
STkxNV9XUklURShHRU43X0VSUl9JTlQsIGVycl9pbnQpOwogfQogCi1zdGF0aWMgdm9pZCBjcHRf
c2Vycl9pbnRfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0
aWMgdm9pZCBjcHRfc2Vycl9pbnRfYWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKKwkJCSAgICAgc3RydWN0IHBjaF9pcnFfcmVncyAqcGNoKQoreworCXBjaC0+c2Vycl9pbnQg
PSBJOTE1X1JFQUQoU0VSUl9JTlQpOworCUk5MTVfV1JJVEUoU0VSUl9JTlQsIHBjaC0+c2Vycl9p
bnQpOworfQorCitzdGF0aWMgdm9pZCBjcHRfc2Vycl9pbnRfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkJIGNvbnN0IHN0cnVjdCBwY2hfaXJxX3JlZ3MgKnBj
aCkKIHsKLQl1MzIgc2Vycl9pbnQgPSBJOTE1X1JFQUQoU0VSUl9JTlQpOworCXUzMiBzZXJyX2lu
dCA9IHBjaC0+c2Vycl9pbnQ7CiAJZW51bSBwaXBlIHBpcGU7CiAKIAlpZiAoc2Vycl9pbnQgJiBT
RVJSX0lOVF9QT0lTT04pCkBAIC0yNDgyLDE5ICsyNTA5LDI2IEBAIHN0YXRpYyB2b2lkIGNwdF9z
ZXJyX2ludF9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlmb3Jf
ZWFjaF9waXBlKGRldl9wcml2LCBwaXBlKQogCQlpZiAoc2Vycl9pbnQgJiBTRVJSX0lOVF9UUkFO
U19GSUZPX1VOREVSUlVOKHBpcGUpKQogCQkJaW50ZWxfcGNoX2ZpZm9fdW5kZXJydW5faXJxX2hh
bmRsZXIoZGV2X3ByaXYsIHBpcGUpOwotCi0JSTkxNV9XUklURShTRVJSX0lOVCwgc2Vycl9pbnQp
OwogfQogCi1zdGF0aWMgdm9pZCBjcHRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCB1MzIgcGNoX2lpcikKK3N0YXRpYyB2b2lkIGNwdF9pcnFfYWNrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCXN0cnVjdCBwY2hfaXJxX3JlZ3MgKnBj
aCkKIHsKLQlzdHJ1Y3QgaHBkX2lycV9yZWdzIGhwZDsKLQlpbnQgcGlwZTsKKwlwY2gtPmhwZC5o
b3RwbHVnX3RyaWdnZXIgPSBwY2gtPmlpciAmIFNERV9IT1RQTFVHX01BU0tfQ1BUOworCisJaWJ4
X2hwZF9pcnFfYWNrKGRldl9wcml2LCAmcGNoLT5ocGQpOwogCi0JaHBkLmhvdHBsdWdfdHJpZ2dl
ciA9IHBjaF9paXIgJiBTREVfSE9UUExVR19NQVNLX0NQVDsKKwlpZiAocGNoLT5paXIgJiBTREVf
RVJST1JfQ1BUKQorCQljcHRfc2Vycl9pbnRfYWNrKGRldl9wcml2LCBwY2gpOworfQorCitzdGF0
aWMgdm9pZCBjcHRfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorCQkJICAgIGNvbnN0IHN0cnVjdCBwY2hfaXJxX3JlZ3MgKnBjaCkKK3sKKwl1MzIgcGNoX2lp
ciA9IHBjaC0+aWlyOworCWVudW0gcGlwZSBwaXBlOwogCi0JaWJ4X2hwZF9pcnFfYWNrKGRldl9w
cml2LCAmaHBkKTsKLQlpYnhfaHBkX2lycV9oYW5kbGVyKGRldl9wcml2LCAmaHBkLCBocGRfY3B0
KTsKKwlpYnhfaHBkX2lycV9oYW5kbGVyKGRldl9wcml2LCAmcGNoLT5ocGQsIGhwZF9jcHQpOwog
CiAJaWYgKHBjaF9paXIgJiBTREVfQVVESU9fUE9XRVJfTUFTS19DUFQpIHsKIAkJaW50IHBvcnQg
PSBmZnMoKHBjaF9paXIgJiBTREVfQVVESU9fUE9XRVJfTUFTS19DUFQpID4+CkBAIC0yNTIyLDM0
ICsyNTU2LDQyIEBAIHN0YXRpYyB2b2lkIGNwdF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwY2hfaWlyKQogCQkJCQkgSTkxNV9SRUFEKEZESV9SWF9J
SVIocGlwZSkpKTsKIAogCWlmIChwY2hfaWlyICYgU0RFX0VSUk9SX0NQVCkKLQkJY3B0X3NlcnJf
aW50X2hhbmRsZXIoZGV2X3ByaXYpOworCQljcHRfc2Vycl9pbnRfaGFuZGxlcihkZXZfcHJpdiwg
cGNoKTsKIH0KIAotc3RhdGljIHZvaWQgaWNwX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgdTMyIHBjaF9paXIsCi0JCQkgICAgY29uc3QgdTMyIGhwZF9waW5z
W0hQRF9OVU1fUElOU10pCitzdGF0aWMgdm9pZCBpY3BfaXJxX2FjayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCisJCQlzdHJ1Y3QgcGNoX2lycV9yZWdzICpwY2gpCiB7Ci0Jc3Ry
dWN0IGhwZF9pcnFfcmVncyBkZGk7Ci0Jc3RydWN0IGhwZF9pcnFfcmVncyB0YzsKLQl1MzIgcGlu
X21hc2sgPSAwLCBsb25nX21hc2sgPSAwOworCXBjaC0+ZGRpLmhvdHBsdWdfdHJpZ2dlciA9IHBj
aC0+aWlyICYgU0RFX0RESV9NQVNLX0lDUDsKKwlwY2gtPnRjLmhvdHBsdWdfdHJpZ2dlciA9IHBj
aC0+aWlyICYgU0RFX1RDX01BU0tfSUNQOwogCi0JZGRpLmhvdHBsdWdfdHJpZ2dlciA9IHBjaF9p
aXIgJiBTREVfRERJX01BU0tfSUNQOwotCXRjLmhvdHBsdWdfdHJpZ2dlciA9IHBjaF9paXIgJiBT
REVfVENfTUFTS19JQ1A7CisJaWYgKHBjaC0+ZGRpLmhvdHBsdWdfdHJpZ2dlcikgeworCQlwY2gt
PmRkaS5kaWdfaG90cGx1Z19yZWcgPSBJOTE1X1JFQUQoU0hPVFBMVUdfQ1RMX0RESSk7CisJCUk5
MTVfV1JJVEUoU0hPVFBMVUdfQ1RMX0RESSwgcGNoLT5kZGkuZGlnX2hvdHBsdWdfcmVnKTsKKwl9
CiAKLQlpZiAoZGRpLmhvdHBsdWdfdHJpZ2dlcikgewotCQlkZGkuZGlnX2hvdHBsdWdfcmVnID0g
STkxNV9SRUFEKFNIT1RQTFVHX0NUTF9EREkpOwotCQlJOTE1X1dSSVRFKFNIT1RQTFVHX0NUTF9E
REksIGRkaS5kaWdfaG90cGx1Z19yZWcpOworCWlmIChwY2gtPnRjLmhvdHBsdWdfdHJpZ2dlcikg
eworCQlwY2gtPnRjLmRpZ19ob3RwbHVnX3JlZyA9IEk5MTVfUkVBRChTSE9UUExVR19DVExfVEMp
OworCQlJOTE1X1dSSVRFKFNIT1RQTFVHX0NUTF9UQywgcGNoLT50Yy5kaWdfaG90cGx1Z19yZWcp
OworCX0KK30KIAorc3RhdGljIHZvaWQgaWNwX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgcGNoX2lycV9yZWdzICpwY2gs
CisJCQkgICAgY29uc3QgdTMyIGhwZF9waW5zW0hQRF9OVU1fUElOU10pCit7CisJdTMyIHBjaF9p
aXIgPSBwY2gtPmlpcjsKKwl1MzIgcGluX21hc2sgPSAwLCBsb25nX21hc2sgPSAwOworCisJaWYg
KHBjaC0+ZGRpLmhvdHBsdWdfdHJpZ2dlcikgewogCQlpbnRlbF9nZXRfaHBkX3BpbnMoZGV2X3By
aXYsICZwaW5fbWFzaywgJmxvbmdfbWFzaywKLQkJCQkgICAmZGRpLCBocGRfcGlucywKKwkJCQkg
ICAmcGNoLT5kZGksIGhwZF9waW5zLAogCQkJCSAgIGljcF9kZGlfcG9ydF9ob3RwbHVnX2xvbmdf
ZGV0ZWN0KTsKIAl9CiAKLQlpZiAodGMuaG90cGx1Z190cmlnZ2VyKSB7Ci0JCXRjLmRpZ19ob3Rw
bHVnX3JlZyA9IEk5MTVfUkVBRChTSE9UUExVR19DVExfVEMpOwotCQlJOTE1X1dSSVRFKFNIT1RQ
TFVHX0NUTF9UQywgdGMuZGlnX2hvdHBsdWdfcmVnKTsKLQorCWlmIChwY2gtPnRjLmhvdHBsdWdf
dHJpZ2dlcikgewogCQlpbnRlbF9nZXRfaHBkX3BpbnMoZGV2X3ByaXYsICZwaW5fbWFzaywgJmxv
bmdfbWFzaywKLQkJCQkgICAmdGMsIGhwZF9waW5zLAorCQkJCSAgICZwY2gtPnRjLCBocGRfcGlu
cywKIAkJCQkgICBpY3BfdGNfcG9ydF9ob3RwbHVnX2xvbmdfZGV0ZWN0KTsKIAl9CiAKQEAgLTI1
NjAsMzEgKzI2MDIsMzkgQEAgc3RhdGljIHZvaWQgaWNwX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBjaF9paXIsCiAJCWdtYnVzX2lycV9oYW5kbGVy
KGRldl9wcml2KTsKIH0KIAotc3RhdGljIHZvaWQgc3B0X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBjaF9paXIpCitzdGF0aWMgdm9pZCBzcHRfaXJx
X2FjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQlzdHJ1Y3QgcGNoX2ly
cV9yZWdzICpwY2gpCiB7Ci0JdTMyIHBpbl9tYXNrID0gMCwgbG9uZ19tYXNrID0gMDsKLQlzdHJ1
Y3QgaHBkX2lycV9yZWdzIGhwZDsKLQlzdHJ1Y3QgaHBkX2lycV9yZWdzIGhwZDI7Ci0KLQlocGQu
aG90cGx1Z190cmlnZ2VyID0gcGNoX2lpciAmIFNERV9IT1RQTFVHX01BU0tfU1BUICYKKwlwY2gt
PmhwZC5ob3RwbHVnX3RyaWdnZXIgPSBwY2gtPmlpciAmIFNERV9IT1RQTFVHX01BU0tfU1BUICYK
IAkJflNERV9QT1JURV9IT1RQTFVHX1NQVDsKLQlocGQyLmhvdHBsdWdfdHJpZ2dlciA9IHBjaF9p
aXIgJiBTREVfUE9SVEVfSE9UUExVR19TUFQ7CisJcGNoLT5ocGQyLmhvdHBsdWdfdHJpZ2dlciA9
IHBjaC0+aWlyICYgU0RFX1BPUlRFX0hPVFBMVUdfU1BUOwogCi0JaWYgKGhwZC5ob3RwbHVnX3Ry
aWdnZXIpIHsKLQkJaHBkLmRpZ19ob3RwbHVnX3JlZyA9IEk5MTVfUkVBRChQQ0hfUE9SVF9IT1RQ
TFVHKTsKLQkJSTkxNV9XUklURShQQ0hfUE9SVF9IT1RQTFVHLCBocGQuZGlnX2hvdHBsdWdfcmVn
KTsKKwlpZiAocGNoLT5ocGQuaG90cGx1Z190cmlnZ2VyKSB7CisJCXBjaC0+aHBkLmRpZ19ob3Rw
bHVnX3JlZyA9IEk5MTVfUkVBRChQQ0hfUE9SVF9IT1RQTFVHKTsKKwkJSTkxNV9XUklURShQQ0hf
UE9SVF9IT1RQTFVHLCBwY2gtPmhwZC5kaWdfaG90cGx1Z19yZWcpOworCX0KKworCWlmIChwY2gt
PmhwZDIuaG90cGx1Z190cmlnZ2VyKSB7CisJCXBjaC0+aHBkMi5kaWdfaG90cGx1Z19yZWcgPSBJ
OTE1X1JFQUQoUENIX1BPUlRfSE9UUExVRzIpOworCQlJOTE1X1dSSVRFKFBDSF9QT1JUX0hPVFBM
VUcyLCBwY2gtPmhwZDIuZGlnX2hvdHBsdWdfcmVnKTsKKwl9Cit9CiAKK3N0YXRpYyB2b2lkIHNw
dF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgICAg
Y29uc3Qgc3RydWN0IHBjaF9pcnFfcmVncyAqcGNoKQoreworCXUzMiBwY2hfaWlyID0gcGNoLT5p
aXI7CisJdTMyIHBpbl9tYXNrID0gMCwgbG9uZ19tYXNrID0gMDsKKworCWlmIChwY2gtPmhwZC5o
b3RwbHVnX3RyaWdnZXIpIHsKIAkJaW50ZWxfZ2V0X2hwZF9waW5zKGRldl9wcml2LCAmcGluX21h
c2ssICZsb25nX21hc2ssCi0JCQkJICAgJmhwZCwgaHBkX3NwdCwKKwkJCQkgICAmcGNoLT5ocGQs
IGhwZF9zcHQsCiAJCQkJICAgc3B0X3BvcnRfaG90cGx1Z19sb25nX2RldGVjdCk7CiAJfQogCi0J
aWYgKGhwZDIuaG90cGx1Z190cmlnZ2VyKSB7Ci0JCWhwZDIuZGlnX2hvdHBsdWdfcmVnID0gSTkx
NV9SRUFEKFBDSF9QT1JUX0hPVFBMVUcyKTsKLQkJSTkxNV9XUklURShQQ0hfUE9SVF9IT1RQTFVH
MiwgaHBkMi5kaWdfaG90cGx1Z19yZWcpOwotCisJaWYgKHBjaC0+aHBkMi5ob3RwbHVnX3RyaWdn
ZXIpIHsKIAkJaW50ZWxfZ2V0X2hwZF9waW5zKGRldl9wcml2LCAmcGluX21hc2ssICZsb25nX21h
c2ssCi0JCQkJICAgJmhwZDIsIGhwZF9zcHQsCisJCQkJICAgJnBjaC0+aHBkMiwgaHBkX3NwdCwK
IAkJCQkgICBzcHRfcG9ydF9ob3RwbHVnMl9sb25nX2RldGVjdCk7CiAJfQogCkBAIC0yNjQ5LDE1
ICsyNjk5LDIwIEBAIHN0YXRpYyB2b2lkIGlsa19kaXNwbGF5X2lycV9oYW5kbGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCS8qIGNoZWNrIGV2ZW50IGZyb20gUENIICov
CiAJaWYgKGRlX2lpciAmIERFX1BDSF9FVkVOVCkgewotCQl1MzIgcGNoX2lpciA9IEk5MTVfUkVB
RChTREVJSVIpOworCQlzdHJ1Y3QgcGNoX2lycV9yZWdzIHBjaDsKIAotCQlpZiAoSEFTX1BDSF9D
UFQoZGV2X3ByaXYpKQotCQkJY3B0X2lycV9oYW5kbGVyKGRldl9wcml2LCBwY2hfaWlyKTsKLQkJ
ZWxzZQotCQkJaWJ4X2lycV9oYW5kbGVyKGRldl9wcml2LCBwY2hfaWlyKTsKKwkJcGNoLmlpciA9
IEk5MTVfUkVBRChTREVJSVIpOworCisJCWlmIChIQVNfUENIX0NQVChkZXZfcHJpdikpIHsKKwkJ
CWNwdF9pcnFfYWNrKGRldl9wcml2LCAmcGNoKTsKKwkJCWNwdF9pcnFfaGFuZGxlcihkZXZfcHJp
diwgJnBjaCk7CisJCX0gZWxzZSB7CisJCQlpYnhfaXJxX2FjayhkZXZfcHJpdiwgJnBjaCk7CisJ
CQlpYnhfaXJxX2hhbmRsZXIoZGV2X3ByaXYsICZwY2gpOworCQl9CiAKIAkJLyogc2hvdWxkIGNs
ZWFyIFBDSCBob3RwbHVnIGV2ZW50IGJlZm9yZSBjbGVhciBDUFUgaXJxICovCi0JCUk5MTVfV1JJ
VEUoU0RFSUlSLCBwY2hfaWlyKTsKKwkJSTkxNV9XUklURShTREVJSVIsIHBjaC5paXIpOwogCX0K
IAogCWlmIChJU19HRU4oZGV2X3ByaXYsIDUpICYmIGRlX2lpciAmIERFX1BDVV9FVkVOVCkKQEAg
LTI2OTksMTIgKzI3NTQsMTUgQEAgc3RhdGljIHZvaWQgaXZiX2Rpc3BsYXlfaXJxX2hhbmRsZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJLyogY2hlY2sgZXZlbnQgZnJv
bSBQQ0ggKi8KIAlpZiAoIUhBU19QQ0hfTk9QKGRldl9wcml2KSAmJiAoZGVfaWlyICYgREVfUENI
X0VWRU5UX0lWQikpIHsKLQkJdTMyIHBjaF9paXIgPSBJOTE1X1JFQUQoU0RFSUlSKTsKKwkJc3Ry
dWN0IHBjaF9pcnFfcmVncyBwY2g7CisKKwkJcGNoLmlpciA9IEk5MTVfUkVBRChTREVJSVIpOwog
Ci0JCWNwdF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgcGNoX2lpcik7CisJCWNwdF9pcnFfYWNrKGRl
dl9wcml2LCAmcGNoKTsKKwkJY3B0X2lycV9oYW5kbGVyKGRldl9wcml2LCAmcGNoKTsKIAogCQkv
KiBjbGVhciBQQ0ggaG90cGx1ZyBldmVudCBiZWZvcmUgY2xlYXIgQ1BVIGlycSAqLwotCQlJOTE1
X1dSSVRFKFNERUlJUiwgcGNoX2lpcik7CisJCUk5MTVfV1JJVEUoU0RFSUlSLCBwY2guaWlyKTsK
IAl9CiB9CiAKQEAgLTI5ODcsMjQgKzMwNDUsMzEgQEAgZ2VuOF9kZV9pcnFfaGFuZGxlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBtYXN0ZXJfY3RsKQogCiAJaWYgKEhB
U19QQ0hfU1BMSVQoZGV2X3ByaXYpICYmICFIQVNfUENIX05PUChkZXZfcHJpdikgJiYKIAkgICAg
bWFzdGVyX2N0bCAmIEdFTjhfREVfUENIX0lSUSkgeworCQlzdHJ1Y3QgcGNoX2lycV9yZWdzIHBj
aDsKKwogCQkvKgogCQkgKiBGSVhNRShCRFcpOiBBc3N1bWUgZm9yIG5vdyB0aGF0IHRoZSBuZXcg
aW50ZXJydXB0IGhhbmRsaW5nCiAJCSAqIHNjaGVtZSBhbHNvIGNsb3NlZCB0aGUgU0RFIGludGVy
cnVwdCBoYW5kbGluZyByYWNlIHdlJ3ZlIHNlZW4KIAkJICogb24gb2xkZXIgcGNoLXNwbGl0IHBs
YXRmb3Jtcy4gQnV0IHRoaXMgbmVlZHMgdGVzdGluZy4KIAkJICovCi0JCWlpciA9IEk5MTVfUkVB
RChTREVJSVIpOwotCQlpZiAoaWlyKSB7Ci0JCQlJOTE1X1dSSVRFKFNERUlJUiwgaWlyKTsKKwkJ
cGNoLmlpciA9IEk5MTVfUkVBRChTREVJSVIpOworCQlpZiAocGNoLmlpcikgeworCQkJSTkxNV9X
UklURShTREVJSVIsIHBjaC5paXIpOwogCQkJcmV0ID0gSVJRX0hBTkRMRUQ7CiAKLQkJCWlmIChJ
TlRFTF9QQ0hfVFlQRShkZXZfcHJpdikgPj0gUENIX01DQykKLQkJCQlpY3BfaXJxX2hhbmRsZXIo
ZGV2X3ByaXYsIGlpciwgaHBkX21jYyk7Ci0JCQllbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShkZXZf
cHJpdikgPj0gUENIX0lDUCkKLQkJCQlpY3BfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIGlpciwgaHBk
X2ljcCk7Ci0JCQllbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShkZXZfcHJpdikgPj0gUENIX1NQVCkK
LQkJCQlzcHRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIGlpcik7Ci0JCQllbHNlCi0JCQkJY3B0X2ly
cV9oYW5kbGVyKGRldl9wcml2LCBpaXIpOworCQkJaWYgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2
KSA+PSBQQ0hfTUNDKSB7CisJCQkJaWNwX2lycV9hY2soZGV2X3ByaXYsICZwY2gpOworCQkJCWlj
cF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgJnBjaCwgaHBkX21jYyk7CisJCQl9IGVsc2UgaWYgKElO
VEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQQ0hfSUNQKSB7CisJCQkJaWNwX2lycV9hY2soZGV2
X3ByaXYsICZwY2gpOworCQkJCWljcF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgJnBjaCwgaHBkX2lj
cCk7CisJCQl9IGVsc2UgaWYgKElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQQ0hfU1BUKSB7
CisJCQkJc3B0X2lycV9hY2soZGV2X3ByaXYsICZwY2gpOworCQkJCXNwdF9pcnFfaGFuZGxlcihk
ZXZfcHJpdiwgJnBjaCk7CisJCQl9IGVsc2UgeworCQkJCWNwdF9pcnFfYWNrKGRldl9wcml2LCAm
cGNoKTsKKwkJCQljcHRfaXJxX2hhbmRsZXIoZGV2X3ByaXYsICZwY2gpOworCQkJfQogCQl9IGVs
c2UgewogCQkJLyoKIAkJCSAqIExpa2Ugb24gcHJldmlvdXMgUENIIHRoZXJlIHNlZW1zIHRvIGJl
IHNvbWV0aGluZwotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZng=

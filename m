Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8651B82501
	for <lists+intel-gfx@lfdr.de>; Mon,  5 Aug 2019 20:40:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 64F3989CA0;
	Mon,  5 Aug 2019 18:40:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 54B1C89C52
 for <intel-gfx@lists.freedesktop.org>; Mon,  5 Aug 2019 18:40:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17896493-1500050 
 for multiple; Mon, 05 Aug 2019 19:39:05 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  5 Aug 2019 19:39:04 +0100
Message-Id: <20190805183904.23893-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190805094333.17600-1-chris@chris-wilson.co.uk>
References: <20190805094333.17600-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3] drm/i915: Defer final intel_wakeref_put to
 process context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2UgbmVlZCB0byBhY3F1aXJlIGEgbXV0ZXggdG8gc2VyaWFsaXNlIHRoZSBmaW5hbAppbnRl
bF93YWtlcmVmX3B1dCwgd2UgbmVlZCB0byBlbnN1cmUgdGhhdCB3ZSBhcmUgaW4gcHJvY2VzcyBj
b250ZXh0IGF0CnRoYXQgdGltZS4gSG93ZXZlciwgd2Ugd2FudCB0byBhbGxvdyBvcGVyYXRpb24g
b24gdGhlIGludGVsX3dha2VyZWYgZnJvbQppbnNpZGUgdGltZXIgYW5kIG90aGVyIGhhcmRpcnEg
Y29udGV4dCwgd2hpY2ggbWVhbnMgdGhhdCBuZWVkIHRvIGRlZmVyCnRoYXQgZmluYWwgcHV0IHRv
IGEgd29ya3F1ZXVlLgoKSW5zaWRlIHRoZSBmaW5hbCB3YWtlcmVmIHB1dHMsIHdlIGFyZSBzYWZl
IHRvIG9wZXJhdGUgaW4gYW55IGNvbnRleHQsIGFzCndlIGFyZSBzaW1wbHkgbWFya2luZyB1cCB0
aGUgSFcgYW5kIHN0YXRlIHRyYWNraW5nIGZvciB0aGUgcG90ZW50aWFsCnNsZWVwLiBJdCdzIG9u
bHkgdGhlIHNlcmlhbGlzYXRpb24gd2l0aCB0aGUgcG90ZW50aWFsIHNsZWVwaW5nIGdldHRpbmcK
dGhhdCByZXF1aXJlcyBjYXJlZnVsIHdhaXQgYXZvaWRhbmNlLiBUaGlzIGFsbG93cyB1cyB0byBy
ZXRhaW4gdGhlCmltbWVkaWF0ZSBwcm9jZXNzaW5nIGFzIGJlZm9yZSAod2Ugb25seSBuZWVkIHRv
IHNsZWVwIG92ZXIgdGhlIHNhbWUKcmFjZXMgYXMgdGhlIGN1cnJlbnQgbXV0ZXhfbG9jaykuCgp2
MjogQWRkIGEgc2VsZnRlc3QgdG8gZW5zdXJlIHdlIGV4ZXJjaXNlIHRoZSBjb2RlIHdoaWxlIGxv
Y2tkZXAgd2F0Y2hlcy4KdjM6IFRoYXQgdGVzdCB3YXMgZXh0cmVtZWx5IGxvdWQgYW5kIGNvbXBs
YWluZWQgYWJvdXQgbWFueSB0aGluZ3MhCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNr
dG9wLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTExMjk1CkZpeGVzOiAxODM5ODkwNGNhOWUgKCJkcm0v
aTkxNTogT25seSByZWNvdmVyIGFjdGl2ZSBlbmdpbmVzIikKRml4ZXM6IDUxZmJkOGRlODdkYyAo
ImRybS9pOTE1L3BtdTogQXRvbWljYWxseSBhY3F1aXJlIHRoZSBndF9wbSB3YWtlcmVmIikKU2ln
bmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBU
dnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpDYzogTWlrYSBLdW9wcGFs
YSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+Ci0tLQpOb3QgYWxsb3dlZCB0byB1c2Ug
Zmx1c2hfd29yayBpbnNpZGUgd2FpdF9ldmVudCAtLSBpdCBkb2Vzbid0IGhlbHAsIEkKd2FzIHRo
aW5raW5nIGl0IHdvdWxkIHdvcmsgYXMgYSB5aWVsZF90bywgYnV0IG5vLgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8IDEzICstLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgIDEgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgICAgIHwgMzggKysrLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oICAgICB8IDE4ICsrLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMgICAgICAgICB8IDI4ICsrKy0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaCAgICAgICAgIHwgMjIgKysrKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8ICA0ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmUuYyAgICAgfCAyOCArKysrKysKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5oICAgICB8IDE0ICsrKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX3BtLmMgIHwgODMgKysrKysrKysrKysr
KysrKysrCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMgfCAg
NCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgIDQg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgMjYgKy0t
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmMgICAgICAgICAgfCA4NyAr
KysrKysrKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmgg
ICAgICAgICAgfCA2MiArKysrKysrKy0tLS0tCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
bGl2ZV9zZWxmdGVzdHMuaCAgfCAgNSArLQogMTYgZmlsZXMgY2hhbmdlZCwgMzA2IGluc2VydGlv
bnMoKyksIDEzMSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmUuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX3BtLmMKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDcyOTIyNzAzYWY0OS4uMTdlMzYxODI0MWM1IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtMTMwLDcgKzEzMCw5IEBA
IHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCiAJCX0KIAl9IHdoaWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhndC0+aTkxNSkgJiYg
cmVzdWx0KTsKIAotCUdFTV9CVUdfT04oZ3QtPmF3YWtlKTsKKwlpZiAoaW50ZWxfZ3RfcG1fd2Fp
dF9mb3JfaWRsZShndCkpCisJCXJlc3VsdCA9IGZhbHNlOworCiAJcmV0dXJuIHJlc3VsdDsKIH0K
IApAQCAtMTYxLDEzICsxNjMsNiBAQCB2b2lkIGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiAKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCi0JLyoKLQkgKiBBc3NlcnQgdGhhdCB3ZSBzdWNjZXNzZnVsbHkgZmx1c2hlZCBhbGwg
dGhlIHdvcmsgYW5kCi0JICogcmVzZXQgdGhlIEdQVSBiYWNrIHRvIGl0cyBpZGxlLCBsb3cgcG93
ZXIgc3RhdGUuCi0JICovCi0JR0VNX0JVR19PTihpOTE1LT5ndC5hd2FrZSk7Ci0JZmx1c2hfd29y
aygmaTkxNS0+Z2VtLmlkbGVfd29yayk7Ci0KIAljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmk5
MTUtPmd0LmhhbmdjaGVjay53b3JrKTsKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMo
aTkxNSk7CkBAIC0yNDQsOCArMjM5LDYgQEAgdm9pZCBpOTE1X2dlbV9yZXN1bWUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJR0VNX1RSQUNFKCJcbiIpOwogCi0JV0FSTl9PTihp
OTE1LT5ndC5hd2FrZSk7Ci0KIAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxM
KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2Nz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCBhOTFm
MTU3MTdjYzEuLjQxNGIwZGJiM2EyMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX2NzLmMKQEAgLTE2NzIsNSArMTY3Miw2IEBAIGludGVsX2VuZ2luZV9maW5kX2FjdGl2
ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIH0KIAogI2lmIElTX0VO
QUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2lu
ZS5jIgogI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2luZV9jcy5jIgogI2VuZGlmCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4IDAzMzYyMDQ5ODhkNi4uNmIxNWUz
MzM1ZGQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
cG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwpAQCAt
MzcsMjggKzM3LDYgQEAgc3RhdGljIGludCBfX2VuZ2luZV91bnBhcmsoc3RydWN0IGludGVsX3dh
a2VyZWYgKndmKQogCXJldHVybiAwOwogfQogCi12b2lkIGludGVsX2VuZ2luZV9wbV9nZXQoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWludGVsX3dha2VyZWZfZ2V0KCZlbmdp
bmUtPmk5MTUtPnJ1bnRpbWVfcG0sICZlbmdpbmUtPndha2VyZWYsIF9fZW5naW5lX3VucGFyayk7
Ci19Ci0KLXZvaWQgaW50ZWxfZW5naW5lX3Bhcmsoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQotewotCS8qCi0JICogV2UgYXJlIGNvbW1pdHRlZCBub3cgdG8gcGFya2luZyB0aGlzIGVu
Z2luZSwgbWFrZSBzdXJlIHRoZXJlCi0JICogd2lsbCBiZSBubyBtb3JlIGludGVycnVwdHMgYXJy
aXZpbmcgbGF0ZXIgYW5kIHRoZSBlbmdpbmUKLQkgKiBpcyB0cnVseSBpZGxlLgotCSAqLwotCWlm
ICh3YWl0X2ZvcihpbnRlbF9lbmdpbmVfaXNfaWRsZShlbmdpbmUpLCAxMCkpIHsKLQkJc3RydWN0
IGRybV9wcmludGVyIHAgPSBkcm1fZGVidWdfcHJpbnRlcihfX2Z1bmNfXyk7Ci0KLQkJZGV2X2Vy
cihlbmdpbmUtPmk5MTUtPmRybS5kZXYsCi0JCQkiJXMgaXMgbm90IGlkbGUgYmVmb3JlIHBhcmtp
bmdcbiIsCi0JCQllbmdpbmUtPm5hbWUpOwotCQlpbnRlbF9lbmdpbmVfZHVtcChlbmdpbmUsICZw
LCBOVUxMKTsKLQl9Ci19Ci0KIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CkBAIC0xMzYsMTIgKzExNCwxOCBAQCBzdGF0aWMgaW50IF9fZW5naW5lX3Bhcmsoc3RydWN0
IGludGVsX3dha2VyZWYgKndmKQogCXJldHVybiAwOwogfQogCi12b2lkIGludGVsX2VuZ2luZV9w
bV9wdXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWludGVsX3dha2VyZWZf
cHV0KCZlbmdpbmUtPmk5MTUtPnJ1bnRpbWVfcG0sICZlbmdpbmUtPndha2VyZWYsIF9fZW5naW5l
X3BhcmspOwotfQorc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF93YWtlcmVmX29wcyB3Zl9vcHMg
PSB7CisJLmdldCA9IF9fZW5naW5lX3VucGFyaywKKwkucHV0ID0gX19lbmdpbmVfcGFyaywKK307
CiAKIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfX3BtKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKIHsKLQlpbnRlbF93YWtlcmVmX2luaXQoJmVuZ2luZS0+d2FrZXJlZik7CisJc3RydWN0
IGludGVsX3J1bnRpbWVfcG0gKnJwbSA9ICZlbmdpbmUtPmk5MTUtPnJ1bnRpbWVfcG07CisKKwlp
bnRlbF93YWtlcmVmX2luaXQoJmVuZ2luZS0+d2FrZXJlZiwgcnBtLCAmd2Zfb3BzKTsKIH0KKwor
I2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2luY2x1ZGUgInNlbGZ0
ZXN0X2VuZ2luZV9wbS5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfcG0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9wbS5oCmluZGV4IDAxNWFjNzJkN2FkMC4uNzM5YzUwZmVmY2VmIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaApAQCAtMTAsMjQgKzEwLDI2IEBACiAjaW5j
bHVkZSAiaW50ZWxfZW5naW5lX3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxfd2FrZXJlZi5oIgog
Ci1zdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKLQotdm9pZCBpbnRlbF9lbmdpbmVfcG1fZ2V0KHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7Ci12b2lkIGludGVsX2VuZ2luZV9wbV9wdXQo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKLQogc3RhdGljIGlubGluZSBib29sCiBp
bnRlbF9lbmdpbmVfcG1faXNfYXdha2UoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogewogCXJldHVybiBpbnRlbF93YWtlcmVmX2lzX2FjdGl2ZSgmZW5naW5lLT53YWtlcmVm
KTsKIH0KIAotc3RhdGljIGlubGluZSBib29sCi1pbnRlbF9lbmdpbmVfcG1fZ2V0X2lmX2F3YWtl
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRl
bF9lbmdpbmVfcG1fZ2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlpbnRl
bF93YWtlcmVmX2dldCgmZW5naW5lLT53YWtlcmVmKTsKK30KKworc3RhdGljIGlubGluZSBib29s
IGludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdha2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogewogCXJldHVybiBpbnRlbF93YWtlcmVmX2dldF9pZl9hY3RpdmUoJmVuZ2luZS0+d2Fr
ZXJlZik7CiB9CiAKLXZvaWQgaW50ZWxfZW5naW5lX3Bhcmsoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKTsKK3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9lbmdpbmVfcG1fcHV0KHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlpbnRlbF93YWtlcmVmX3B1dCgmZW5naW5l
LT53YWtlcmVmKTsKK30KIAogdm9pZCBpbnRlbF9lbmdpbmVfaW5pdF9fcG0oc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3RfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMK
aW5kZXggNmM4OTcwMjcxYTdmLi4xMzYzZTA2OWVjODMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3RfcG0uYwpAQCAtMTcsNyArMTcsNyBAQCBzdGF0aWMgdm9pZCBwbV9ub3RpZnkoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCBzdGF0ZSkKIAlibG9ja2luZ19ub3RpZmll
cl9jYWxsX2NoYWluKCZpOTE1LT5ndC5wbV9ub3RpZmljYXRpb25zLCBzdGF0ZSwgaTkxNSk7CiB9
CiAKLXN0YXRpYyBpbnQgaW50ZWxfZ3RfdW5wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikK
K3N0YXRpYyBpbnQgX19ndF91bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogewogCXN0
cnVjdCBpbnRlbF9ndCAqZ3QgPSBjb250YWluZXJfb2Yod2YsIHR5cGVvZigqZ3QpLCB3YWtlcmVm
KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OwpAQCAtNTMsMTQg
KzUzLDcgQEAgc3RhdGljIGludCBpbnRlbF9ndF91bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQogCXJldHVybiAwOwogfQogCi12b2lkIGludGVsX2d0X3BtX2dldChzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQotewotCXN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpycG0gPSAmZ3QtPmk5MTUtPnJ1
bnRpbWVfcG07Ci0KLQlpbnRlbF93YWtlcmVmX2dldChycG0sICZndC0+d2FrZXJlZiwgaW50ZWxf
Z3RfdW5wYXJrKTsKLX0KLQotc3RhdGljIGludCBpbnRlbF9ndF9wYXJrKHN0cnVjdCBpbnRlbF93
YWtlcmVmICp3ZikKK3N0YXRpYyBpbnQgX19ndF9wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3
ZikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNvbnRhaW5lcl9vZih3
ZiwgdHlwZW9mKCppOTE1KSwgZ3Qud2FrZXJlZik7CkBAIC03NCwyMiArNjcsMjUgQEAgc3RhdGlj
IGludCBpbnRlbF9ndF9wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIAlpZiAoSU5URUxf
R0VOKGk5MTUpID49IDYpCiAJCWdlbjZfcnBzX2lkbGUoaTkxNSk7CiAKKwkvKiBFdmVyeXRoaW5n
IHN3aXRjaGVkIG9mZiwgZmx1c2ggYW55IHJlc2lkdWFsIGludGVycnVwdCBqdXN0IGluIGNhc2Ug
Ki8KKwlpbnRlbF9zeW5jaHJvbml6ZV9pcnEoaTkxNSk7CisKIAlHRU1fQlVHX09OKCF3YWtlcmVm
KTsKIAlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01BSU5fR1RfSVJRLCB3
YWtlcmVmKTsKIAogCXJldHVybiAwOwogfQogCi12b2lkIGludGVsX2d0X3BtX3B1dChzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQotewotCXN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpycG0gPSAmZ3QtPmk5
MTUtPnJ1bnRpbWVfcG07Ci0KLQlpbnRlbF93YWtlcmVmX3B1dChycG0sICZndC0+d2FrZXJlZiwg
aW50ZWxfZ3RfcGFyayk7Ci19CitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3dha2VyZWZfb3Bz
IHdmX29wcyA9IHsKKwkuZ2V0ID0gX19ndF91bnBhcmssCisJLnB1dCA9IF9fZ3RfcGFyaywKKwku
ZmxhZ3MgPSBJTlRFTF9XQUtFUkVGX1BVVF9BU1lOQywKK307CiAKIHZvaWQgaW50ZWxfZ3RfcG1f
aW5pdF9lYXJseShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCWludGVsX3dha2VyZWZfaW5pdCgm
Z3QtPndha2VyZWYpOworCWludGVsX3dha2VyZWZfaW5pdCgmZ3QtPndha2VyZWYsICZndC0+aTkx
NS0+cnVudGltZV9wbSwgJndmX29wcyk7CisKIAlCTE9DS0lOR19JTklUX05PVElGSUVSX0hFQUQo
Jmd0LT5wbV9ub3RpZmljYXRpb25zKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
X3BtLmgKaW5kZXggZThhMThkNGIyN2M5Li41NzYzM2Y1MzhkZGIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfcG0uaApAQCAtMTcsMTQgKzE3LDMyIEBAIGVudW0gewogCUlOVEVMX0dU
X1BBUkssCiB9OwogCi12b2lkIGludGVsX2d0X3BtX2dldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsK
LXZvaWQgaW50ZWxfZ3RfcG1fcHV0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOworc3RhdGljIGlubGlu
ZSBib29sCitpbnRlbF9ndF9wbV9pc19hd2FrZShjb25zdCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQor
eworCXJldHVybiBpbnRlbF93YWtlcmVmX2lzX2FjdGl2ZSgmZ3QtPndha2VyZWYpOworfQorCitz
dGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7
CisJaW50ZWxfd2FrZXJlZl9nZXQoJmd0LT53YWtlcmVmKTsKK30KIAogc3RhdGljIGlubGluZSBi
b29sIGludGVsX2d0X3BtX2dldF9pZl9hd2FrZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXJl
dHVybiBpbnRlbF93YWtlcmVmX2dldF9pZl9hY3RpdmUoJmd0LT53YWtlcmVmKTsKIH0KIAorc3Rh
dGljIGlubGluZSB2b2lkIGludGVsX2d0X3BtX3B1dChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQorewor
CWludGVsX3dha2VyZWZfcHV0KCZndC0+d2FrZXJlZik7Cit9CisKK3N0YXRpYyBpbmxpbmUgaW50
IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlyZXR1
cm4gaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlKCZndC0+d2FrZXJlZik7Cit9CisKIHZvaWQg
aW50ZWxfZ3RfcG1faW5pdF9lYXJseShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKIAogdm9pZCBpbnRl
bF9ndF9zYW5pdGl6ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBib29sIGZvcmNlKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggMjMyZjQwZmNiNDkwLi4xYTAxMTY3NTFkMTkgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0xMzksNiArMTM5LDcgQEAKICNpbmNs
dWRlICJpOTE1X3ZncHUuaCIKICNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRl
ICJpbnRlbF9ndC5oIgorI2luY2x1ZGUgImludGVsX2d0X3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxf
bHJjX3JlZy5oIgogI2luY2x1ZGUgImludGVsX21vY3MuaCIKICNpbmNsdWRlICJpbnRlbF9yZXNl
dC5oIgpAQCAtNTU2LDYgKzU1Nyw3IEBAIGV4ZWNsaXN0c19zY2hlZHVsZV9pbihzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwgaW50IGlkeCkKIAkJaW50ZWxfY29udGV4dF9nZXQoY2UpOwogCQljZS0+
aW5mbGlnaHQgPSBycS0+ZW5naW5lOwogCisJCWludGVsX2d0X3BtX2dldChjZS0+aW5mbGlnaHQt
Pmd0KTsKIAkJZXhlY2xpc3RzX2NvbnRleHRfc3RhdHVzX2NoYW5nZShycSwgSU5URUxfQ09OVEVY
VF9TQ0hFRFVMRV9JTik7CiAJCWludGVsX2VuZ2luZV9jb250ZXh0X2luKGNlLT5pbmZsaWdodCk7
CiAJfQpAQCAtNTg4LDYgKzU5MCw3IEBAIGV4ZWNsaXN0c19zY2hlZHVsZV9vdXQoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCiAJaWYgKCFpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2NvdW50KGNlKSkg
ewogCQlpbnRlbF9lbmdpbmVfY29udGV4dF9vdXQoY2UtPmluZmxpZ2h0KTsKIAkJZXhlY2xpc3Rz
X2NvbnRleHRfc3RhdHVzX2NoYW5nZShycSwgSU5URUxfQ09OVEVYVF9TQ0hFRFVMRV9PVVQpOwor
CQlpbnRlbF9ndF9wbV9wdXQoY2UtPmluZmxpZ2h0LT5ndCk7CiAKIAkJLyoKIAkJICogSWYgdGhp
cyBpcyBwYXJ0IG9mIGEgdmlydHVhbCBlbmdpbmUsIGl0cyBuZXh0IHJlcXVlc3QgbWF5CkBAIC0y
NzE5LDcgKzI3MjIsNiBAQCBzdGF0aWMgdTMyICpnZW44X2VtaXRfZmluaV9icmVhZGNydW1iX3Jj
cyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LCB1MzIgKmNzKQogc3RhdGljIHZvaWQgZXhl
Y2xpc3RzX3Bhcmsoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCWRlbF90aW1l
cl9zeW5jKCZlbmdpbmUtPmV4ZWNsaXN0cy50aW1lcik7Ci0JaW50ZWxfZW5naW5lX3BhcmsoZW5n
aW5lKTsKIH0KIAogdm9pZCBpbnRlbF9leGVjbGlzdHNfc2V0X2RlZmF1bHRfc3VibWlzc2lvbihz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2VuZ2luZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4u
ZjY1YjExOGUyNjFkCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfZW5naW5lLmMKQEAgLTAsMCArMSwyOCBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBHUEwtMi4wCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTggSW50ZWwgQ29ycG9y
YXRpb24KKyAqLworCisjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgorI2luY2x1ZGUgInNlbGZ0
ZXN0X2VuZ2luZS5oIgorCitpbnQgaW50ZWxfZW5naW5lX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBpbnQgKCogY29uc3QgdGVzdHNbXSko
c3RydWN0IGludGVsX2d0ICopID0geworCQlsaXZlX2VuZ2luZV9wbV9zZWxmdGVzdHMsCisJCU5V
TEwsCisJfTsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OworCXR5cGVvZigqdGVz
dHMpICpmbjsKKworCWZvciAoZm4gPSB0ZXN0czsgKmZuOyBmbisrKSB7CisJCWludCBlcnI7CisK
KwkJZXJyID0gKCpmbikoZ3QpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwly
ZXR1cm4gMDsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lLmgKbmV3
IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5hYjMyZDA5ZWM1YTEKLS0tIC9k
ZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmUuaApA
QCAtMCwwICsxLDE0IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAK
KyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5k
ZWYgU0VMRlRFU1RfRU5HSU5FX0gKKyNkZWZpbmUgU0VMRlRFU1RfRU5HSU5FX0gKKworc3RydWN0
IGludGVsX2d0OworCitpbnQgbGl2ZV9lbmdpbmVfcG1fc2VsZnRlc3RzKHN0cnVjdCBpbnRlbF9n
dCAqZ3QpOworCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2VuZ2luZV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5n
aW5lX3BtLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi43NWMxOTc2
MTI3MDUKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9lbmdpbmVfcG0uYwpAQCAtMCwwICsxLDgzIEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IEdQTC0yLjAKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlv
bgorICovCisKKyNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSAic2VsZnRlc3Rf
ZW5naW5lLmgiCisjaW5jbHVkZSAic2VsZnRlc3RzL2lndF9hdG9taWMuaCIKKworc3RhdGljIGlu
dCBsaXZlX2VuZ2luZV9wbSh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFy
ZzsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVf
aWQgaWQ7CisKKwkvKgorCSAqIENoZWNrIHdlIGNhbiBjYWxsIGludGVsX2VuZ2luZV9wbV9wdXQg
ZnJvbSBhbnkgY29udGV4dC4gTm8KKwkgKiBmYWlsdXJlcyBhcmUgcmVwb3J0ZWQgZGlyZWN0bHks
IGJ1dCBpZiB3ZSBtZXNzIHVwIGxvY2tkZXAgc2hvdWxkCisJICogdGVsbCB1cy4KKwkgKi8KKwlp
ZiAoaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCkpIHsKKwkJcHJfZXJyKCJVbmFibGUgdG8g
Zmx1c2ggR1QgcG0gYmVmb3JlIHRlc3RcbiIpOworCQlyZXR1cm4gLUVCVVNZOworCX0KKworCUdF
TV9CVUdfT04oaW50ZWxfZ3RfcG1faXNfYXdha2UoZ3QpKTsKKwlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBndC0+aTkxNSwgaWQpIHsKKwkJY29uc3QgdHlwZW9mKCppZ3RfYXRvbWljX3BoYXNlcykg
KnA7CisKKwkJZm9yIChwID0gaWd0X2F0b21pY19waGFzZXM7IHAtPm5hbWU7IHArKykgeworCQkJ
LyoKKwkJCSAqIEFjcXVpc2l0aW9uIGlzIGFsd2F5cyBzeW5jaHJvbm91cywgZXhjZXB0IGlmIHdl
CisJCQkgKiBrbm93IHRoYXQgdGhlIGVuZ2luZSBpcyBhbHJlYWR5IGF3YWxlLCBpbiB3aGljaAor
CQkJICogd2Ugc2hvdWxkIHVzZSBpbnRlbF9lbmdpbmVfcG1fZ2V0X2lmX2F3YWtlKCkgdG8KKwkJ
CSAqIGF0b21pY2FsbHkgZ3JhYiB0aGUgd2FrZXJlZi4KKwkJCSAqCisJCQkgKiBJbiBwcmFjdGlj
ZSwKKwkJCSAqICAgIGludGVsX2VuZ2luZV9wbV9nZXQoKTsKKwkJCSAqICAgIGludGVsX2VuZ2lu
ZV9wbV9wdXQoKTsKKwkJCSAqIG9jY3VycyBpbiBvbmUgdGhyZWFkLCB3aGlsZSBzaW11bHRhbmVv
dXNseQorCQkJICogICAgaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZSgpOworCQkJICogICAg
aW50ZWxfZW5naW5lX3BtX3B1dCgpOworCQkJICogb2NjdXJzIGluIGF0b21pYyBjb250ZXh0IGlu
IGFub3RoZXIuCisJCQkgKi8KKwkJCUdFTV9CVUdfT04oaW50ZWxfZW5naW5lX3BtX2lzX2F3YWtl
KGVuZ2luZSkpOworCQkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOworCisJCQlwLT5jcml0
aWNhbF9zZWN0aW9uX2JlZ2luKCk7CisJCQlpZiAoIWludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdh
a2UoZW5naW5lKSkKKwkJCQlwcl9lcnIoImludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdha2UoJXMp
IGZhaWxlZCB1bmRlciAlc1xuIiwKKwkJCQkgICAgICAgZW5naW5lLT5uYW1lLCBwLT5uYW1lKTsK
KwkJCWVsc2UKKwkJCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisJCQlpbnRlbF9lbmdp
bmVfcG1fcHV0KGVuZ2luZSk7CisJCQlwLT5jcml0aWNhbF9zZWN0aW9uX2VuZCgpOworCisJCQkv
KiBlbmdpbmUgd2FrZXJlZiBpcyBzeW5jIChpbnN0YW50KSAqLworCQkJaWYgKGludGVsX2VuZ2lu
ZV9wbV9pc19hd2FrZShlbmdpbmUpKSB7CisJCQkJcHJfZXJyKCIlcyBpcyBzdGlsbCBhd2FrZSBh
ZnRlciBmbHVzaGluZyBwbVxuIiwKKwkJCQkgICAgICAgZW5naW5lLT5uYW1lKTsKKwkJCQlyZXR1
cm4gLUVJTlZBTDsKKwkJCX0KKworCQkJLyogZ3Qgd2FrZXJlZiBpcyBhc3luYyAoZGVmZXJyZWQg
dG8gd29ya3F1ZXVlKSAqLworCQkJaWYgKGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoZ3QpKSB7
CisJCQkJcHJfZXJyKCJHVCBmYWlsZWQgdG8gaWRsZVxuIik7CisJCQkJcmV0dXJuIC1FSU5WQUw7
CisJCQl9CisJCX0KKwl9CisKKwlyZXR1cm4gMDsKK30KKworaW50IGxpdmVfZW5naW5lX3BtX3Nl
bGZ0ZXN0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkx
NV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2ZV9lbmdpbmVfcG0pLAorCX07CisK
KwlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgZ3QpOworfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKaW5kZXggNDEy
ODkyMDk2ZGFhLi40OTc4NmU3YTY0N2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYwpAQCAtMjksNiArMjksNyBAQAogI2luY2x1ZGUg
Imd0L2ludGVsX2NvbnRleHQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKICNp
bmNsdWRlICJndC9pbnRlbF9ndC5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCiAjaW5j
bHVkZSAiZ3QvaW50ZWxfbHJjX3JlZy5oIgogI2luY2x1ZGUgImludGVsX2d1Y19zdWJtaXNzaW9u
LmgiCiAKQEAgLTUzNyw2ICs1MzgsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqc2No
ZWR1bGVfaW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGludCBpZHgpCiAJaWYgKCFycS0+aHdf
Y29udGV4dC0+aW5mbGlnaHQpCiAJCXJxLT5od19jb250ZXh0LT5pbmZsaWdodCA9IHJxLT5lbmdp
bmU7CiAJaW50ZWxfY29udGV4dF9pbmZsaWdodF9pbmMocnEtPmh3X2NvbnRleHQpOworCWludGVs
X2d0X3BtX2dldChycS0+ZW5naW5lLT5ndCk7CiAKIAlyZXR1cm4gaTkxNV9yZXF1ZXN0X2dldChy
cSk7CiB9CkBAIC01NDksNiArNTUxLDcgQEAgc3RhdGljIHZvaWQgc2NoZWR1bGVfb3V0KHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogCWlmICghaW50ZWxfY29udGV4dF9pbmZsaWdodF9jb3VudChy
cS0+aHdfY29udGV4dCkpCiAJCXJxLT5od19jb250ZXh0LT5pbmZsaWdodCA9IE5VTEw7CiAKKwlp
bnRlbF9ndF9wbV9wdXQocnEtPmVuZ2luZS0+Z3QpOwogCWk5MTVfcmVxdWVzdF9wdXQocnEpOwog
fQogCkBAIC0xMDc2LDcgKzEwNzksNiBAQCBzdGF0aWMgdm9pZCBndWNfaW50ZXJydXB0c19yZWxl
YXNlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIHN0YXRpYyB2b2lkIGd1Y19zdWJtaXNzaW9uX3Bh
cmsoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCWludGVsX2VuZ2luZV9wYXJr
KGVuZ2luZSk7CiAJaW50ZWxfZW5naW5lX3VucGluX2JyZWFkY3J1bWJzX2lycShlbmdpbmUpOwog
CWVuZ2luZS0+ZmxhZ3MgJj0gfkk5MTVfRU5HSU5FX05FRURTX0JSRUFEQ1JVTUJfVEFTS0xFVDsK
IH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggODk1MzMzNmYyYWU1Li5lYTNi
YTI2NjJhOWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0zOSw2ICszOSw3
IEBACiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9wc3IuaCIKIAogI2luY2x1ZGUgImdlbS9pOTE1
X2dlbV9jb250ZXh0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJn
dC9pbnRlbF9yZXNldC5oIgogI2luY2x1ZGUgImd0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmgi
CiAKQEAgLTM2NjUsNiArMzY2Niw5IEBAIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZvaWQgKmRhdGEs
IHU2NCB2YWwpCiAJCQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCiAJCQkJCQkgICAgIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKTsKIAorCQlpZiAocmV0ID09IDAgJiYgdmFsICYgRFJPUF9JRExFKQor
CQkJcmV0ID0gaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZSgmaTkxNS0+Z3QpOworCiAJCWlmICh2
YWwgJiBEUk9QX1JFVElSRSkKIAkJCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwppbmRleCBlYjM0ZjNlNWE3NGQuLjVlYWNlY2JkNzAwMiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jCkBAIC04OTMsMTkgKzg5Myw2IEBAIHZvaWQgaTkxNV9nZW1fcnVu
dGltZV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCX0KIH0KIAotc3Rh
dGljIGludCB3YWl0X2Zvcl9lbmdpbmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0JaWYgKHdh
aXRfZm9yKGludGVsX2VuZ2luZXNfYXJlX2lkbGUoZ3QpLCBJOTE1X0lETEVfRU5HSU5FU19USU1F
T1VUKSkgewotCQlkZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LAotCQkJIkZhaWxlZCB0byBpZGxl
IGVuZ2luZXMsIGRlY2xhcmluZyB3ZWRnZWQhXG4iKTsKLQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJ
aW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JCXJldHVybiAtRUlPOwotCX0KLQotCXJldHVybiAw
OwotfQotCiBzdGF0aWMgbG9uZwogd2FpdF9mb3JfdGltZWxpbmVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkgICB1bnNpZ25lZCBpbnQgZmxhZ3MsIGxvbmcgdGltZW91dCkKQEAg
LTk1MywyNyArOTQwLDIwIEBAIGludCBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgdW5zaWduZWQgaW50IGZsYWdzLCBsb25nIHRpbWVv
dXQpCiB7CiAJLyogSWYgdGhlIGRldmljZSBpcyBhc2xlZXAsIHdlIGhhdmUgbm8gcmVxdWVzdHMg
b3V0c3RhbmRpbmcgKi8KLQlpZiAoIVJFQURfT05DRShpOTE1LT5ndC5hd2FrZSkpCisJaWYgKCFp
bnRlbF9ndF9wbV9pc19hd2FrZSgmaTkxNS0+Z3QpKQogCQlyZXR1cm4gMDsKIAotCUdFTV9UUkFD
RSgiZmxhZ3M9JXggKCVzKSwgdGltZW91dD0lbGQlcywgYXdha2U/PSVzXG4iLAorCUdFTV9UUkFD
RSgiZmxhZ3M9JXggKCVzKSwgdGltZW91dD0lbGQlc1xuIiwKIAkJICBmbGFncywgZmxhZ3MgJiBJ
OTE1X1dBSVRfTE9DS0VEID8gImxvY2tlZCIgOiAidW5sb2NrZWQiLAotCQkgIHRpbWVvdXQsIHRp
bWVvdXQgPT0gTUFYX1NDSEVEVUxFX1RJTUVPVVQgPyAiIChmb3JldmVyKSIgOiAiIiwKLQkJICB5
ZXNubyhpOTE1LT5ndC5hd2FrZSkpOworCQkgIHRpbWVvdXQsIHRpbWVvdXQgPT0gTUFYX1NDSEVE
VUxFX1RJTUVPVVQgPyAiIChmb3JldmVyKSIgOiAiIik7CiAKIAl0aW1lb3V0ID0gd2FpdF9mb3Jf
dGltZWxpbmVzKGk5MTUsIGZsYWdzLCB0aW1lb3V0KTsKIAlpZiAodGltZW91dCA8IDApCiAJCXJl
dHVybiB0aW1lb3V0OwogCiAJaWYgKGZsYWdzICYgSTkxNV9XQUlUX0xPQ0tFRCkgewotCQlpbnQg
ZXJyOwotCiAJCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
Ci0JCWVyciA9IHdhaXRfZm9yX2VuZ2luZXMoJmk5MTUtPmd0KTsKLQkJaWYgKGVycikKLQkJCXJl
dHVybiBlcnI7Ci0KIAkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAJfQogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF93YWtlcmVmLmMKaW5kZXggMDZiZDhiMjE1Y2MyLi45ODdmZGY4YzNlOGQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmMKQEAgLTQsMjUgKzQsMjUgQEAKICAq
IENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCiAgKi8KIAorI2luY2x1ZGUgPGxp
bnV4L3dhaXRfYml0Lmg+CisKICNpbmNsdWRlICJpbnRlbF9ydW50aW1lX3BtLmgiCiAjaW5jbHVk
ZSAiaW50ZWxfd2FrZXJlZi5oIgogCi1zdGF0aWMgdm9pZCBycG1fZ2V0KHN0cnVjdCBpbnRlbF9y
dW50aW1lX3BtICpycG0sIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKK3N0YXRpYyB2b2lkIHJw
bV9nZXQoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogewotCXdmLT53YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQocnBtKTsKKwl3Zi0+d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0
KHdmLT5ycG0pOwogfQogCi1zdGF0aWMgdm9pZCBycG1fcHV0KHN0cnVjdCBpbnRlbF9ydW50aW1l
X3BtICpycG0sIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKK3N0YXRpYyB2b2lkIHJwbV9wdXQo
c3RydWN0IGludGVsX3dha2VyZWYgKndmKQogewogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmID0g
ZmV0Y2hfYW5kX3plcm8oJndmLT53YWtlcmVmKTsKIAotCWludGVsX3J1bnRpbWVfcG1fcHV0KHJw
bSwgd2FrZXJlZik7CisJaW50ZWxfcnVudGltZV9wbV9wdXQod2YtPnJwbSwgd2FrZXJlZik7CiAJ
SU5URUxfV0FLRVJFRl9CVUdfT04oIXdha2VyZWYpOwogfQogCi1pbnQgX19pbnRlbF93YWtlcmVm
X2dldF9maXJzdChzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAotCQkJICAgICAgc3RydWN0
IGludGVsX3dha2VyZWYgKndmLAotCQkJICAgICAgaW50ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtl
cmVmICp3ZikpCitpbnQgX19pbnRlbF93YWtlcmVmX2dldF9maXJzdChzdHJ1Y3QgaW50ZWxfd2Fr
ZXJlZiAqd2YpCiB7CiAJLyoKIAkgKiBUcmVhdCBnZXQvcHV0IGFzIGRpZmZlcmVudCBzdWJjbGFz
c2VzLCBhcyB3ZSBtYXkgbmVlZCB0byBydW4KQEAgLTM0LDExICszNCwxMSBAQCBpbnQgX19pbnRl
bF93YWtlcmVmX2dldF9maXJzdChzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAogCWlmICgh
YXRvbWljX3JlYWQoJndmLT5jb3VudCkpIHsKIAkJaW50IGVycjsKIAotCQlycG1fZ2V0KHJwbSwg
d2YpOworCQlycG1fZ2V0KHdmKTsKIAotCQllcnIgPSBmbih3Zik7CisJCWVyciA9IHdmLT5vcHMt
PmdldCh3Zik7CiAJCWlmICh1bmxpa2VseShlcnIpKSB7Ci0JCQlycG1fcHV0KHJwbSwgd2YpOwor
CQkJcnBtX3B1dCh3Zik7CiAJCQltdXRleF91bmxvY2soJndmLT5tdXRleCk7CiAJCQlyZXR1cm4g
ZXJyOwogCQl9CkBAIC01MiwyNyArNTIsNzIgQEAgaW50IF9faW50ZWxfd2FrZXJlZl9nZXRfZmly
c3Qoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKIAlyZXR1cm4gMDsKIH0KIAotaW50IF9f
aW50ZWxfd2FrZXJlZl9wdXRfbGFzdChzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAotCQkJ
ICAgICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCQkgICAgIGludCAoKmZuKShzdHJ1Y3Qg
aW50ZWxfd2FrZXJlZiAqd2YpKQorc3RhdGljIHZvaWQgX19fX2ludGVsX3dha2VyZWZfcHV0X2xh
c3Qoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogewotCWludCBlcnI7CisJaWYgKCFhdG9taWNf
ZGVjX2FuZF90ZXN0KCZ3Zi0+Y291bnQpKQorCQlnb3RvIHVubG9jazsKKworCWlmIChsaWtlbHko
IXdmLT5vcHMtPnB1dCh3ZikpKSB7CisJCXJwbV9wdXQod2YpOworCQl3YWtlX3VwX3Zhcigmd2Yt
Pndha2VyZWYpOworCX0gZWxzZSB7CisJCS8qIG9wcy0+cHV0KCkgbXVzdCBzY2hlZHVsZSBpdHMg
b3duIHJlbGVhc2Ugb24gZGVmZXJyYWwgKi8KKwkJYXRvbWljX3NldF9yZWxlYXNlKCZ3Zi0+Y291
bnQsIDEpOworCX0KIAotCWVyciA9IGZuKHdmKTsKLQlpZiAobGlrZWx5KCFlcnIpKQotCQlycG1f
cHV0KHJwbSwgd2YpOwotCWVsc2UKLQkJYXRvbWljX2luYygmd2YtPmNvdW50KTsKK3VubG9jazoK
IAltdXRleF91bmxvY2soJndmLT5tdXRleCk7Cit9CisKK3ZvaWQgX19pbnRlbF93YWtlcmVmX3B1
dF9sYXN0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKK3sKKwlJTlRFTF9XQUtFUkVGX0JVR19P
Tih3b3JrX3BlbmRpbmcoJndmLT53b3JrKSk7CisKKwkvKiBBc3N1bWUgd2UgYXJlIG5vdCBpbiBw
cm9jZXNzIGNvbnRleHQgYW5kIHNvIGNhbm5vdCBzbGVlcC4gKi8KKwlpZiAod2YtPm9wcy0+Zmxh
Z3MgJiBJTlRFTF9XQUtFUkVGX1BVVF9BU1lOQyB8fAorCSAgICAhbXV0ZXhfdHJ5bG9jaygmd2Yt
Pm11dGV4KSkgeworCQlzY2hlZHVsZV93b3JrKCZ3Zi0+d29yayk7CisJCXJldHVybjsKKwl9CisK
KwlfX19faW50ZWxfd2FrZXJlZl9wdXRfbGFzdCh3Zik7Cit9CisKK3N0YXRpYyB2b2lkIF9faW50
ZWxfd2FrZXJlZl9wdXRfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndyaykKK3sKKwlzdHJ1Y3Qg
aW50ZWxfd2FrZXJlZiAqd2YgPSBjb250YWluZXJfb2Yod3JrLCB0eXBlb2YoKndmKSwgd29yayk7
CisKKwlpZiAoYXRvbWljX2FkZF91bmxlc3MoJndmLT5jb3VudCwgLTEsIDEpKQorCQlyZXR1cm47
CiAKLQlyZXR1cm4gZXJyOworCW11dGV4X2xvY2soJndmLT5tdXRleCk7CisJX19fX2ludGVsX3dh
a2VyZWZfcHV0X2xhc3Qod2YpOwogfQogCi12b2lkIF9faW50ZWxfd2FrZXJlZl9pbml0KHN0cnVj
dCBpbnRlbF93YWtlcmVmICp3Ziwgc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCit2b2lkIF9f
aW50ZWxfd2FrZXJlZl9pbml0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKKwkJCSAgc3RydWN0
IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX3dha2VyZWZf
b3BzICpvcHMsCisJCQkgIHN0cnVjdCBsb2NrX2NsYXNzX2tleSAqa2V5KQogeworCXdmLT5ycG0g
PSBycG07CisJd2YtPm9wcyA9IG9wczsKKwogCV9fbXV0ZXhfaW5pdCgmd2YtPm11dGV4LCAid2Fr
ZXJlZiIsIGtleSk7CiAJYXRvbWljX3NldCgmd2YtPmNvdW50LCAwKTsKIAl3Zi0+d2FrZXJlZiA9
IDA7CisKKwlJTklUX1dPUksoJndmLT53b3JrLCBfX2ludGVsX3dha2VyZWZfcHV0X3dvcmspOwor
fQorCitzdGF0aWMgYm9vbCBfX3dha2VyZWZfaXNfaWRsZShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAq
d2YpCit7CisJZmx1c2hfd29yaygmd2YtPndvcmspOworCXJldHVybiAhaW50ZWxfd2FrZXJlZl9p
c19hY3RpdmUod2YpOworfQorCitpbnQgaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlKHN0cnVj
dCBpbnRlbF93YWtlcmVmICp3ZikKK3sKKwlyZXR1cm4gd2FpdF92YXJfZXZlbnRfa2lsbGFibGUo
JndmLT53YWtlcmVmLCBfX3dha2VyZWZfaXNfaWRsZSh3ZikpOwogfQogCiBzdGF0aWMgdm9pZCB3
YWtlcmVmX2F1dG9fdGltZW91dChzdHJ1Y3QgdGltZXJfbGlzdCAqdCkKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3dha2VyZWYuaAppbmRleCAxZDZmNTk4NmU0ZTUuLjUzNWEzYTEyODY0YiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaApAQCAtOCwxMCArOCwxMiBAQAogI2RlZmluZSBJ
TlRFTF9XQUtFUkVGX0gKIAogI2luY2x1ZGUgPGxpbnV4L2F0b21pYy5oPgorI2luY2x1ZGUgPGxp
bnV4L2JpdHMuaD4KICNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgogI2luY2x1ZGUgPGxpbnV4L3Jl
ZmNvdW50Lmg+CiAjaW5jbHVkZSA8bGludXgvc3RhY2tkZXBvdC5oPgogI2luY2x1ZGUgPGxpbnV4
L3RpbWVyLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+CiAKICNpZiBJU19FTkFCTEVE
KENPTkZJR19EUk1fSTkxNV9ERUJVRykKICNkZWZpbmUgSU5URUxfV0FLRVJFRl9CVUdfT04oZXhw
cikgQlVHX09OKGV4cHIpCkBAIC0yMCwyOSArMjIsNDIgQEAKICNlbmRpZgogCiBzdHJ1Y3QgaW50
ZWxfcnVudGltZV9wbTsKK3N0cnVjdCBpbnRlbF93YWtlcmVmOwogCiB0eXBlZGVmIGRlcG90X3N0
YWNrX2hhbmRsZV90IGludGVsX3dha2VyZWZfdDsKIAorc3RydWN0IGludGVsX3dha2VyZWZfb3Bz
IHsKKwlpbnQgKCpnZXQpKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3Zik7CisJaW50ICgqcHV0KShz
dHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpOworCisJdW5zaWduZWQgbG9uZyBmbGFnczsKKyNkZWZp
bmUgSU5URUxfV0FLRVJFRl9QVVRfQVNZTkMgQklUKDApCit9OworCiBzdHJ1Y3QgaW50ZWxfd2Fr
ZXJlZiB7CiAJYXRvbWljX3QgY291bnQ7CiAJc3RydWN0IG11dGV4IG11dGV4OworCiAJaW50ZWxf
d2FrZXJlZl90IHdha2VyZWY7CisKKwlzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtOworCWNv
bnN0IHN0cnVjdCBpbnRlbF93YWtlcmVmX29wcyAqb3BzOworCisJc3RydWN0IHdvcmtfc3RydWN0
IHdvcms7CiB9OwogCiB2b2lkIF9faW50ZWxfd2FrZXJlZl9pbml0KHN0cnVjdCBpbnRlbF93YWtl
cmVmICp3ZiwKKwkJCSAgc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKKwkJCSAgY29uc3Qg
c3RydWN0IGludGVsX3dha2VyZWZfb3BzICpvcHMsCiAJCQkgIHN0cnVjdCBsb2NrX2NsYXNzX2tl
eSAqa2V5KTsKLSNkZWZpbmUgaW50ZWxfd2FrZXJlZl9pbml0KHdmKSBkbyB7CQkJCQlcCisjZGVm
aW5lIGludGVsX3dha2VyZWZfaW5pdCh3ZiwgcnBtLCBvcHMpIGRvIHsJCQkJXAogCXN0YXRpYyBz
dHJ1Y3QgbG9ja19jbGFzc19rZXkgX19rZXk7CQkJCVwKIAkJCQkJCQkJCVwKLQlfX2ludGVsX3dh
a2VyZWZfaW5pdCgod2YpLCAmX19rZXkpOwkJCQlcCisJX19pbnRlbF93YWtlcmVmX2luaXQoKHdm
KSwgKHJwbSksIChvcHMpLCAmX19rZXkpOwkJXAogfSB3aGlsZSAoMCkKIAotaW50IF9faW50ZWxf
d2FrZXJlZl9nZXRfZmlyc3Qoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJCSAgICAg
IHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKLQkJCSAgICAgIGludCAoKmZuKShzdHJ1Y3QgaW50
ZWxfd2FrZXJlZiAqd2YpKTsKLWludCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGlu
dGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJCSAgICAgc3RydWN0IGludGVsX3dha2VyZWYgKndmLAot
CQkJICAgICBpbnQgKCpmbikoc3RydWN0IGludGVsX3dha2VyZWYgKndmKSk7CitpbnQgX19pbnRl
bF93YWtlcmVmX2dldF9maXJzdChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpOwordm9pZCBfX2lu
dGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3dha2VyZWYgKndmKTsKIAogLyoqCiAg
KiBpbnRlbF93YWtlcmVmX2dldDogQWNxdWlyZSB0aGUgd2FrZXJlZgpAQCAtNjEsMTIgKzc2LDEw
IEBAIGludCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3J1bnRpbWVfcG0g
KnJwbSwKICAqIGNvZGUgb3RoZXJ3aXNlLgogICovCiBzdGF0aWMgaW5saW5lIGludAotaW50ZWxf
d2FrZXJlZl9nZXQoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJICBzdHJ1Y3QgaW50
ZWxfd2FrZXJlZiAqd2YsCi0JCSAgaW50ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3Zikp
CitpbnRlbF93YWtlcmVmX2dldChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CiAJaWYgKHVu
bGlrZWx5KCFhdG9taWNfaW5jX25vdF96ZXJvKCZ3Zi0+Y291bnQpKSkKLQkJcmV0dXJuIF9faW50
ZWxfd2FrZXJlZl9nZXRfZmlyc3QocnBtLCB3ZiwgZm4pOworCQlyZXR1cm4gX19pbnRlbF93YWtl
cmVmX2dldF9maXJzdCh3Zik7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTEwMiwxNiArMTE1LDEyIEBA
IGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAg
KiBSZXR1cm5zOiAwIGlmIHRoZSB3YWtlcmVmIHdhcyByZWxlYXNlZCBzdWNjZXNzZnVsbHksIG9y
IGEgbmVnYXRpdmUgZXJyb3IKICAqIGNvZGUgb3RoZXJ3aXNlLgogICovCi1zdGF0aWMgaW5saW5l
IGludAotaW50ZWxfd2FrZXJlZl9wdXQoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJ
ICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCSAgaW50ICgqZm4pKHN0cnVjdCBpbnRlbF93
YWtlcmVmICp3ZikpCitzdGF0aWMgaW5saW5lIHZvaWQKK2ludGVsX3dha2VyZWZfcHV0KHN0cnVj
dCBpbnRlbF93YWtlcmVmICp3ZikKIHsKIAlJTlRFTF9XQUtFUkVGX0JVR19PTihhdG9taWNfcmVh
ZCgmd2YtPmNvdW50KSA8PSAwKTsKLQlpZiAoYXRvbWljX2RlY19hbmRfbXV0ZXhfbG9jaygmd2Yt
PmNvdW50LCAmd2YtPm11dGV4KSkKLQkJcmV0dXJuIF9faW50ZWxfd2FrZXJlZl9wdXRfbGFzdChy
cG0sIHdmLCBmbik7Ci0KLQlyZXR1cm4gMDsKKwlpZiAodW5saWtlbHkoIWF0b21pY19hZGRfdW5s
ZXNzKCZ3Zi0+Y291bnQsIC0xLCAxKSkpCisJCV9faW50ZWxfd2FrZXJlZl9wdXRfbGFzdCh3Zik7
CiB9CiAKIC8qKgpAQCAtMTU0LDYgKzE2MywxOSBAQCBpbnRlbF93YWtlcmVmX2lzX2FjdGl2ZShj
b25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIFJFQURfT05DRSh3Zi0+d2Fr
ZXJlZik7CiB9CiAKKy8qKgorICogaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlOiBXYWl0IHVu
dGlsIHRoZSB3YWtlcmVmIGlzIGlkbGUKKyAqIEB3ZjogdGhlIHdha2VyZWYKKyAqCisgKiBXYWl0
IGZvciB0aGUgZWFybGllciBhc3luY2hyb25vdXMgcmVsZWFzZSBvZiB0aGUgd2FrZXJlZi4gTm90
ZQorICogdGhpcyB3aWxsIHdhaXQgZm9yIGFueSB0aGlyZCBwYXJ0eSBhcyB3ZWxsLCBzbyBtYWtl
IHN1cmUgeW91IG9ubHkgd2FpdAorICogd2hlbiB5b3UgaGF2ZSBjb250cm9sIG92ZXIgdGhlIHdh
a2VyZWYgYW5kIHRydXN0IG5vIG9uZSBlbHNlIGlzIGFjcXVpcmluZworICogaXQuCisgKgorICog
UmV0dXJuOiAwIG9uIHN1Y2Nlc3MsIGVycm9yIGNvZGUgaWYga2lsbGVkLgorICovCitpbnQgaW50
ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3Zik7CisKIHN0
cnVjdCBpbnRlbF93YWtlcmVmX2F1dG8gewogCXN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpycG07
CiAJc3RydWN0IHRpbWVyX2xpc3QgdGltZXI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAppbmRleCBhODQxZDNmOWJlZGMuLjFj
Y2YwZjczMWFjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfbGl2ZV9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9saXZlX3NlbGZ0ZXN0cy5oCkBAIC0xMiwxMCArMTIsMTEgQEAKIHNlbGZ0ZXN0KHNhbml0
eWNoZWNrLCBpOTE1X2xpdmVfc2FuaXR5Y2hlY2spIC8qIGtlZXAgZmlyc3QgKGlndCBzZWxmY2hl
Y2spICovCiBzZWxmdGVzdCh1bmNvcmUsIGludGVsX3VuY29yZV9saXZlX3NlbGZ0ZXN0cykKIHNl
bGZ0ZXN0KHdvcmthcm91bmRzLCBpbnRlbF93b3JrYXJvdW5kc19saXZlX3NlbGZ0ZXN0cykKLXNl
bGZ0ZXN0KHRpbWVsaW5lcywgaW50ZWxfdGltZWxpbmVfbGl2ZV9zZWxmdGVzdHMpCitzZWxmdGVz
dChndF9lbmdpbmVzLCBpbnRlbF9lbmdpbmVfbGl2ZV9zZWxmdGVzdHMpCitzZWxmdGVzdChndF90
aW1lbGluZXMsIGludGVsX3RpbWVsaW5lX2xpdmVfc2VsZnRlc3RzKQorc2VsZnRlc3QoZ3RfY29u
dGV4dHMsIGludGVsX2NvbnRleHRfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChyZXF1ZXN0cywg
aTkxNV9yZXF1ZXN0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoYWN0aXZlLCBpOTE1X2FjdGl2
ZV9saXZlX3NlbGZ0ZXN0cykKLXNlbGZ0ZXN0KGd0X2NvbnRleHRzLCBpbnRlbF9jb250ZXh0X2xp
dmVfc2VsZnRlc3RzKQogc2VsZnRlc3Qob2JqZWN0cywgaTkxNV9nZW1fb2JqZWN0X2xpdmVfc2Vs
ZnRlc3RzKQogc2VsZnRlc3QobW1hbiwgaTkxNV9nZW1fbW1hbl9saXZlX3NlbGZ0ZXN0cykKIHNl
bGZ0ZXN0KGRtYWJ1ZiwgaTkxNV9nZW1fZG1hYnVmX2xpdmVfc2VsZnRlc3RzKQotLSAKMi4yMy4w
LnJjMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

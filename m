Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C53254EEBE
	for <lists+intel-gfx@lfdr.de>; Fri, 21 Jun 2019 20:21:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2FCD46E911;
	Fri, 21 Jun 2019 18:21:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 82A226E911
 for <intel-gfx@lists.freedesktop.org>; Fri, 21 Jun 2019 18:21:52 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 Jun 2019 11:21:52 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,401,1557212400"; d="scan'208";a="154532094"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga008.jf.intel.com with ESMTP; 21 Jun 2019 11:21:52 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 21 Jun 2019 11:21:23 -0700
Message-Id: <20190621182123.31368-2-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190621182123.31368-1-daniele.ceraolospurio@intel.com>
References: <20190621182123.31368-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 2/2] drm/i915/guc: handle GuC messages
 received with CTB disabled
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlcmUgaXMgYSB2ZXJ5IHNtYWxsIGNoYW5jZSBvZiB0cmlnZ2VyaW5nIGEgbG9nIGZsdXNoIGV2
ZW50IHdoZW4KZW5hYmxpbmcgb3IgZGlzYWJsaW5nIENUIGJ1ZmZlcnMuIEV2ZW50cyB0cmlnZ2Vy
ZWQgd2hpbGUgQ1QgYnVmZmVycwphcmUgZGlzYWJsZWQgYXJlIGxvZ2dlZCBpbiB0aGUgU0NSQVRD
SF8xNSByZWdpc3RlciB1c2luZyB0aGUgc2FtZSBiaXRzCnVzZWQgaW4gdGhlIENUIG1lc3NhZ2Ug
cGF5bG9hZC4gU2luY2Ugb3VyIGNvbW11bmljYXRpb24gY2hhbm5lbCB3aXRoCkd1QyBpcyB0dXJu
ZWQgb2ZmLCB3ZSBjYW4gc2F2ZSB0aGUgbWVzc2FnZSBhbmQgaGFuZGxlIGl0IGFmdGVyIHdlIHR1
cm4KaXQgYmFjayBvbi4KR3VDIHNob3VsZCBiZSBpZGxlIGFuZCBub3QgZ2VuZXJhdGUgbW9yZSBl
dmVudHMgaW4gdGhlIG1lYW50aW1lIGJlY2F1c2UKd2UncmUgbm90IHRhbGtpbmcgdG8gaXQuCgp2
MjogY2xlYXIgdGhlIG1taW8gcmVnaXN0ZXIgb24gc3RvcF9jb21tdW5pY2F0aW9uIGFzIHdlbGwg
KENocmlzKQoKU2lnbmVkLW9mZi1ieTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5j
ZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KQ2M6IE1pY2hhbCBXYWpkZWN6a28gPG1pY2hhbC53YWpk
ZWN6a29AaW50ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28u
dWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmggfCAgNSArKysKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjLmMgIHwgNzQgKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgNzkgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZ3VjLmgKaW5kZXggMDhjOTA2YWJkZmEyLi5kNmE3NWJjM2Q3ZjQgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2d1Yy5oCkBAIC04OCw2ICs4OCw5IEBAIHN0cnVjdCBpbnRlbF9ndWMgewogCQll
bnVtIGZvcmNld2FrZV9kb21haW5zIGZ3X2RvbWFpbnM7CiAJfSBzZW5kX3JlZ3M7CiAKKwkvKiBT
dG9yZSBtc2cgKGUuZy4gbG9nIGZsdXNoKSB0aGF0IHdlIHNlZSB3aGlsZSBDVEJzIGFyZSBkaXNh
YmxlZCAqLworCXUzMiBtbWlvX21zZzsKKwogCS8qIFRvIHNlcmlhbGl6ZSB0aGUgaW50ZWxfZ3Vj
X3NlbmQgYWN0aW9ucyAqLwogCXN0cnVjdCBtdXRleCBzZW5kX211dGV4OwogCkBAIC0xODEsNiAr
MTg0LDggQEAgc3RhdGljIGlubGluZSBib29sIGludGVsX2d1Y19pc19sb2FkZWQoc3RydWN0IGlu
dGVsX2d1YyAqZ3VjKQogc3RhdGljIGlubGluZSBpbnQgaW50ZWxfZ3VjX3Nhbml0aXplKHN0cnVj
dCBpbnRlbF9ndWMgKmd1YykKIHsKIAlpbnRlbF91Y19md19zYW5pdGl6ZSgmZ3VjLT5mdyk7CisJ
Z3VjLT5tbWlvX21zZyA9IDA7CisKIAlyZXR1cm4gMDsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Vj
LmMKaW5kZXggYzdmODJjOTQ0ZGQ2Li5mZGYwMGYxZWJiNTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3VjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
dWMuYwpAQCAtMjE4LDYgKzIxOCw1MyBAQCBzdGF0aWMgdm9pZCBndWNfZnJlZV9sb2FkX2Vycl9s
b2coc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCQlpOTE1X2dlbV9vYmplY3RfcHV0KGd1Yy0+bG9h
ZF9lcnJfbG9nKTsKIH0KIAorLyoKKyAqIEV2ZW50cyB0cmlnZ2VyZWQgd2hpbGUgQ1QgYnVmZmVy
cyBhcmUgZGlzYWJsZWQgYXJlIGxvZ2dlZCBpbiB0aGUgU0NSQVRDSF8xNQorICogcmVnaXN0ZXIg
dXNpbmcgdGhlIHNhbWUgYml0cyB1c2VkIGluIHRoZSBDVCBtZXNzYWdlIHBheWxvYWQuIFNpbmNl
IG91cgorICogY29tbXVuaWNhdGlvbiBjaGFubmVsIHdpdGggZ3VjIGlzIHR1cm5lZCBvZmYgYXQg
dGhpcyBwb2ludCwgd2UgY2FuIHNhdmUgdGhlCisgKiBtZXNzYWdlIGFuZCBoYW5kbGUgaXQgYWZ0
ZXIgd2UgdHVybiBpdCBiYWNrIG9uLgorICovCitzdGF0aWMgdm9pZCBndWNfY2xlYXJfbW1pb19t
c2coc3RydWN0IGludGVsX2d1YyAqZ3VjKQoreworCWludGVsX3VuY29yZV93cml0ZSgmZ3VjX3Rv
X2k5MTUoZ3VjKS0+dW5jb3JlLCBTT0ZUX1NDUkFUQ0goMTUpLCAwKTsKK30KKworc3RhdGljIHZv
aWQgZ3VjX2dldF9tbWlvX21zZyhzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCit7CisJdTMyIHZhbDsK
KworCXNwaW5fbG9ja19pcnEoJmd1Yy0+aXJxX2xvY2spOworCisJdmFsID0gaW50ZWxfdW5jb3Jl
X3JlYWQoJmd1Y190b19pOTE1KGd1YyktPnVuY29yZSwgU09GVF9TQ1JBVENIKDE1KSk7CisJZ3Vj
LT5tbWlvX21zZyB8PSB2YWwgJiBndWMtPm1zZ19lbmFibGVkX21hc2s7CisKKwkvKgorCSAqIGNs
ZWFyIGFsbCBldmVudHMsIGluY2x1ZGluZyB0aGUgb25lcyB3ZSdyZSBub3QgY3VycmVudGx5IHNl
cnZpY2luZywKKwkgKiB0byBtYWtlIHN1cmUgd2UgZG9uJ3QgdHJ5IHRvIHByb2Nlc3MgYSBzdGFs
ZSBtZXNzYWdlIGlmIHdlIGVuYWJsZQorCSAqIGhhbmRsaW5nIG9mIG1vcmUgZXZlbnRzIGxhdGVy
LgorCSAqLworCWd1Y19jbGVhcl9tbWlvX21zZyhndWMpOworCisJc3Bpbl91bmxvY2tfaXJxKCZn
dWMtPmlycV9sb2NrKTsKK30KKworc3RhdGljIHZvaWQgZ3VjX2hhbmRsZV9tbWlvX21zZyhzdHJ1
Y3QgaW50ZWxfZ3VjICpndWMpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBn
dWNfdG9faTkxNShndWMpOworCisJLyogd2UgbmVlZCBjb21tdW5pY2F0aW9uIHRvIGJlIGVuYWJs
ZWQgdG8gcmVwbHkgdG8gR3VDICovCisJR0VNX0JVR19PTihndWMtPmhhbmRsZXIgPT0gaW50ZWxf
Z3VjX3RvX2hvc3RfZXZlbnRfaGFuZGxlcl9ub3ApOworCisJaWYgKCFndWMtPm1taW9fbXNnKQor
CQlyZXR1cm47CisKKwlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJaW50ZWxfZ3Vj
X3RvX2hvc3RfcHJvY2Vzc19yZWN2X21zZyhndWMsICZndWMtPm1taW9fbXNnLCAxKTsKKwlzcGlu
X3VubG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKKworCWd1Yy0+bW1pb19tc2cgPSAwOworfQor
CiBzdGF0aWMgdm9pZCBndWNfcmVzZXRfaW50ZXJydXB0cyhzdHJ1Y3QgaW50ZWxfZ3VjICpndWMp
CiB7CiAJZ3VjLT5pbnRlcnJ1cHRzLnJlc2V0KGd1Y190b19pOTE1KGd1YykpOwpAQCAtMjM1LDYg
KzI4Miw3IEBAIHN0YXRpYyB2b2lkIGd1Y19kaXNhYmxlX2ludGVycnVwdHMoc3RydWN0IGludGVs
X2d1YyAqZ3VjKQogCiBzdGF0aWMgaW50IGd1Y19lbmFibGVfY29tbXVuaWNhdGlvbihzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndWNf
dG9faTkxNShndWMpOwogCWludCByZXQ7CiAKIAlyZXQgPSBpbnRlbF9ndWNfY3RfZW5hYmxlKCZn
dWMtPmN0KTsKQEAgLTI0NCw4ICsyOTIsMTcgQEAgc3RhdGljIGludCBndWNfZW5hYmxlX2NvbW11
bmljYXRpb24oc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCWd1Yy0+c2VuZCA9IGludGVsX2d1Y19z
ZW5kX2N0OwogCWd1Yy0+aGFuZGxlciA9IGludGVsX2d1Y190b19ob3N0X2V2ZW50X2hhbmRsZXJf
Y3Q7CiAKKwkvKiBjaGVjayBmb3IgbW1pbyBtZXNzYWdlcyByZWNlaXZlZCBiZWZvcmUvZHVyaW5n
IHRoZSBDVCBlbmFibGUgKi8KKwlndWNfZ2V0X21taW9fbXNnKGd1Yyk7CisJZ3VjX2hhbmRsZV9t
bWlvX21zZyhndWMpOworCiAJZ3VjX2VuYWJsZV9pbnRlcnJ1cHRzKGd1Yyk7CiAKKwkvKiBjaGVj
ayBmb3IgQ1QgbWVzc2FnZXMgcmVjZWl2ZWQgYmVmb3JlIHdlIGVuYWJsZWQgaW50ZXJydXB0cyAq
LworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKKwlpbnRlbF9ndWNfdG9faG9zdF9l
dmVudF9oYW5kbGVyX2N0KGd1Yyk7CisJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7
CisKIAlEUk1fSU5GTygiR3VDIGNvbW11bmljYXRpb24gZW5hYmxlZFxuIik7CiAKIAlyZXR1cm4g
MDsKQEAgLTI1NywxMCArMzE0LDE5IEBAIHN0YXRpYyB2b2lkIGd1Y19zdG9wX2NvbW11bmljYXRp
b24oc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCiAJZ3VjLT5zZW5kID0gaW50ZWxfZ3VjX3NlbmRf
bm9wOwogCWd1Yy0+aGFuZGxlciA9IGludGVsX2d1Y190b19ob3N0X2V2ZW50X2hhbmRsZXJfbm9w
OworCisJZ3VjX2NsZWFyX21taW9fbXNnKGd1Yyk7CiB9CiAKIHN0YXRpYyB2b2lkIGd1Y19kaXNh
YmxlX2NvbW11bmljYXRpb24oc3RydWN0IGludGVsX2d1YyAqZ3VjKQogeworCS8qCisJICogRXZl
bnRzIGdlbmVyYXRlZCBkdXJpbmcgb3IgYWZ0ZXIgQ1QgZGlzYWJsZSBhcmUgbG9nZ2VkIGJ5IGd1
YyBpbgorCSAqIHZpYSBtbWlvLiBNYWtlIHN1cmUgdGhlIHJlZ2lzdGVyIGlzIGNsZWFyIGJlZm9y
ZSBkaXNhYmxpbmcgQ1Qgc2luY2UKKwkgKiBhbGwgZXZlbnRzIHdlIGNhcmVkIGFib3V0IGhhdmUg
YWxyZWFkeSBiZWVuIHByb2Nlc3NlZCB2aWEgQ1QuCisJICovCisJZ3VjX2NsZWFyX21taW9fbXNn
KGd1Yyk7CisKIAlndWNfZGlzYWJsZV9pbnRlcnJ1cHRzKGd1Yyk7CiAKIAlndWMtPnNlbmQgPSBp
bnRlbF9ndWNfc2VuZF9ub3A7CkBAIC0yNjgsNiArMzM0LDE0IEBAIHN0YXRpYyB2b2lkIGd1Y19k
aXNhYmxlX2NvbW11bmljYXRpb24oc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCiAJaW50ZWxfZ3Vj
X2N0X2Rpc2FibGUoJmd1Yy0+Y3QpOwogCisJLyoKKwkgKiBDaGVjayBmb3IgbWVzc2FnZXMgcmVj
ZWl2ZWQgZHVyaW5nL2FmdGVyIHRoZSBDVCBkaXNhYmxlLiBXZSBkbyBub3QKKwkgKiBleHBlY3Qg
YW55IG1lc3NhZ2VzIHRvIGhhdmUgYXJyaXZlZCB2aWEgQ1QgYmV0d2VlbiB0aGUgaW50ZXJydXB0
CisJICogZGlzYWJsZSBhbmQgdGhlIENUIGRpc2FibGUgYmVjYXVzZSBHdUMgc2hvdWxkJ3ZlIGJl
ZW4gaWRsZSB1bnRpbCB3ZQorCSAqIHRyaWdnZXJlZCB0aGUgQ1QgZGlzYWJsZSBwcm90b2NvbC4K
KwkgKi8KKwlndWNfZ2V0X21taW9fbXNnKGd1Yyk7CisKIAlEUk1fSU5GTygiR3VDIGNvbW11bmlj
YXRpb24gZGlzYWJsZWRcbiIpOwogfQogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

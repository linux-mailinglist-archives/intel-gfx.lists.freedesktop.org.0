Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 362DBC871B
	for <lists+intel-gfx@lfdr.de>; Wed,  2 Oct 2019 13:20:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 877FD6E941;
	Wed,  2 Oct 2019 11:20:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2D48F6E934
 for <intel-gfx@lists.freedesktop.org>; Wed,  2 Oct 2019 11:20:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18692035-1500050 
 for multiple; Wed, 02 Oct 2019 12:20:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  2 Oct 2019 12:19:50 +0100
Message-Id: <20191002112000.12280-20-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191002112000.12280-1-chris@chris-wilson.co.uk>
References: <20191002112000.12280-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 20/30] drm/i915: Cancel non-persistent contexts
 on close
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm9ybWFsbHksIHdlIHJlbHkgb24gb3VyIGhhbmdjaGVjayB0byBwcmV2ZW50IHBlcnNpc3RlbnQg
YmF0Y2hlcyBmcm9tCmhvZ2dpbmcgdGhlIEdQVS4gSG93ZXZlciwgaWYgdGhlIHVzZXIgZGlzYWJs
ZXMgaGFuZ2NoZWNrLCB0aGlzIG1lY2hhbmlzbQpicmVha3MgZG93bi4gRGVzcGl0ZSBvdXIgaW5z
aXN0ZW5jZSB0aGF0IHRoaXMgaXMgdW5zYWZlLCB0aGUgdXNlcnMgYXJlCmVxdWFsbHkgaW5zaXN0
ZW50IHRoYXQgdGhleSB3YW50IHRvIHVzZSBlbmRsZXNzIGJhdGNoZXMgYW5kIHdpbGwgZGlzYWJs
ZQp0aGUgaGFuZ2NoZWNrIG1lY2hhbmlzbS4gV2UgYXJlIGxvb2tpbmcgYXQgcGVyaGFwcyByZXBs
YWNpbmcgaGFuZ2NoZWNrCndpdGggYSBzb2Z0ZXIgbWVjaGFuaXNtLCB0aGF0IHNlbmRzIGEgcHVs
c2UgZG93biB0aGUgZW5naW5lIHRvIGNoZWNrIGlmCml0IGlzIHdlbGwuIFdlIGNhbiB1c2UgdGhl
IHNhbWUgcHJlZW1wdGl2ZSBwdWxzZSB0byBmbHVzaCBhbiBhY3RpdmUKcGVyc2lzdGVudCBjb250
ZXh0IG9mZiB0aGUgR1BVIHVwb24gY29udGV4dCBjbG9zZSwgcHJldmVudGluZyByZXNvdXJjZXMK
YmVpbmcgbG9zdCBhbmQgdW5raWxsYWJsZSByZXF1ZXN0cyByZW1haW5pbmcgb24gdGhlIEdQVSBh
ZnRlciBwcm9jZXNzCnRlcm1pbmF0aW9uLiBUbyBhdm9pZCBjaGFuZ2luZyB0aGUgQUJJIGFuZCBh
Y2NpZGVudGFsbHkgYnJlYWtpbmcKZXhpc3RpbmcgdXNlcnNwYWNlLCB3ZSBtYWtlIHRoZSBwZXJz
aXN0ZW5jZSBvZiBhIGNvbnRleHQgZXhwbGljaXQgYW5kCmVuYWJsZSBpdCBieSBkZWZhdWx0ICht
YXRjaGluZyBjdXJyZW50IEFCSSkuIFVzZXJzcGFjZSBjYW4gb3B0IG91dCBvZgpwZXJzaXN0ZW50
IG1vZGUgKGZvcmNpbmcgcmVxdWVzdHMgdG8gYmUgY2FuY2VsbGVkIHdoZW4gdGhlIGNvbnRleHQg
aXMKY2xvc2VkIGJ5IHByb2Nlc3MgdGVybWluYXRpb24gb3IgZXhwbGljaXRseSkgYnkgYSBjb250
ZXh0IHBhcmFtZXRlci4gVG8KZmFjaWxpdGF0ZSBleGlzdGluZyB1c2UtY2FzZXMgb2YgZGlzYWJs
aW5nIGhhbmdjaGVjaywgaWYgdGhlIG1vZHBhcmFtIGlzCmRpc2FibGVkIChpOTE1LmVuYWJsZV9o
YW5nY2hlY2s9MCksIHdlIGRpc2FibGUgcGVyc2lzdGVuY2UgbW9kZSBieQpkZWZhdWx0LiAgKE5v
dGUsIG9uZSBvZiB0aGUgb3V0Y29tZXMgZm9yIHN1cHBvcnRpbmcgZW5kbGVzcyBtb2RlIHdpbGwg
YmUKdGhlIHJlbW92YWwgb2YgaGFuZ2NoZWNraW5nLCBhdCB3aGljaCBwb2ludCBvcHRpbmcgaW50
byBwZXJzaXN0ZW50IG1vZGUKd2lsbCBiZSBtYW5kYXRvcnksIG9yIG1heWJlIHRoZSBkZWZhdWx0
IHBlcmhhcHMgY29udHJvbGxlZCBieSBjZ3JvdXBzLikKClRlc3RjYXNlOiBpZ3QvZ2VtX2N0eF9w
ZXJzaXN0ZW5jZQpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IEpvb25hcyBMYWh0aW5lbiA8am9vbmFzLmxhaHRpbmVuQGxpbnV4LmludGVs
LmNvbT4KQ2M6IE1pY2hhxYIgV2luaWFyc2tpIDxtaWNoYWwud2luaWFyc2tpQGludGVsLmNvbT4K
Q2M6IEpvbiBCbG9vbWZpZWxkIDxqb24uYmxvb21maWVsZEBpbnRlbC5jb20+ClJldmlld2VkLWJ5
OiBKb24gQmxvb21maWVsZCA8am9uLmJsb29tZmllbGRAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAxMjIgKysrKysrKysrKysrKysr
KysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oICAgfCAgMTUg
KysrCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmggfCAgIDEg
KwogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgICAyICsK
IC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5jICB8ICA1NiArKysr
KysrKwogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmggIHwgIDE0
ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyAgICAgfCAgIDIg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcHJpb2xpc3RfdHlwZXMuaCAgICB8ICAgMSAr
CiBpbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggICAgICAgICAgICAgICAgICAgfCAgMTUgKysr
CiAxMCBmaWxlcyBjaGFuZ2VkLCAyMjggaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFy
dGJlYXQuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2VuZ2luZV9oZWFydGJlYXQuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01h
a2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5kZXggMWY4N2M3MGEyODQy
Li41NjFmYTJiYjMwMDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxl
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC03Niw2ICs3Niw3IEBAIGd0
LXkgKz0gXAogCWd0L2ludGVsX2JyZWFkY3J1bWJzLm8gXAogCWd0L2ludGVsX2NvbnRleHQubyBc
CiAJZ3QvaW50ZWxfZW5naW5lX2NzLm8gXAorCWd0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQubyBc
CiAJZ3QvaW50ZWxfZW5naW5lX3BtLm8gXAogCWd0L2ludGVsX2VuZ2luZV9wb29sLm8gXAogCWd0
L2ludGVsX2VuZ2luZV9zeXNmcy5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jCmluZGV4IDBhYjQxNjg4N2ZjMi4uZTgzMjIzOGE3MmU1IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTcwLDYgKzcwLDcgQEAK
ICNpbmNsdWRlIDxkcm0vaTkxNV9kcm0uaD4KIAogI2luY2x1ZGUgImd0L2ludGVsX2xyY19yZWcu
aCIKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgiCiAjaW5jbHVkZSAiZ3Qv
aW50ZWxfZW5naW5lX3VzZXIuaCIKIAogI2luY2x1ZGUgImk5MTVfZ2VtX2NvbnRleHQuaCIKQEAg
LTM3NSw2ICszNzYsNzggQEAgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3JlbGVhc2Uoc3RydWN0IGty
ZWYgKnJlZikKIAkJcXVldWVfd29yayhpOTE1LT53cSwgJmk5MTUtPmNvbnRleHRzLmZyZWVfd29y
ayk7CiB9CiAKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXMgKgorX19jb250
ZXh0X2VuZ2luZXNfc3RhdGljKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCit7CisJcmV0
dXJuIHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT5lbmdpbmVzLCB0cnVlKTsKK30KKwor
c3RhdGljIHZvaWQga2lsbF9jb250ZXh0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCit7
CisJaW50ZWxfZW5naW5lX21hc2tfdCB0bXAsIGFjdGl2ZSwgcmVzZXQ7CisJc3RydWN0IGludGVs
X2d0ICpndCA9ICZjdHgtPmk5MTUtPmd0OworCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIg
aXQ7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZTsKKworCS8qCisJICogSWYgd2UgYXJlIGFscmVhZHkgYmFubmVkLCBpdCB3YXMgZHVl
IHRvIGEgZ3VpbHR5IHJlcXVlc3QgY2F1c2luZworCSAqIGEgcmVzZXQgYW5kIHRoZSBlbnRpcmUg
Y29udGV4dCBiZWluZyBldmljdGVkIGZyb20gdGhlIEdQVS4KKwkgKi8KKwlpZiAoaTkxNV9nZW1f
Y29udGV4dF9pc19iYW5uZWQoY3R4KSkKKwkJcmV0dXJuOworCisJaTkxNV9nZW1fY29udGV4dF9z
ZXRfYmFubmVkKGN0eCk7CisKKwkvKgorCSAqIE1hcCB0aGUgdXNlcidzIGVuZ2luZSBiYWNrIHRv
IHRoZSBhY3R1YWwgZW5naW5lczsgb25lIHZpcnR1YWwKKwkgKiBlbmdpbmUgd2lsbCBiZSBtYXBw
ZWQgdG8gbXVsdGlwbGUgZW5naW5lcywgYW5kIHVzaW5nIGN0eC0+ZW5naW5lW10KKwkgKiB0aGUg
c2FtZSBlbmdpbmUgbWF5IGJlIGhhdmUgbXVsdGlwbGUgaW5zdGFuY2VzIGluIHRoZSB1c2VyJ3Mg
bWFwLgorCSAqIEhvd2V2ZXIsIHdlIG9ubHkgY2FyZSBhYm91dCBwZW5kaW5nIHJlcXVlc3RzLCBz
byBvbmx5IGluY2x1ZGUKKwkgKiBlbmdpbmVzIG9uIHdoaWNoIHRoZXJlIGFyZSBpbmNvbXBsZXRl
IHJlcXVlc3RzLgorCSAqLworCWFjdGl2ZSA9IDA7CisJZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwg
X19jb250ZXh0X2VuZ2luZXNfc3RhdGljKGN0eCksIGl0KSB7CisJCXN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlOworCisJCWlmICghY2UtPnRpbWVsaW5lKQorCQkJY29udGludWU7CisKKwkJZmVuY2Ug
PSBpOTE1X2FjdGl2ZV9mZW5jZV9nZXQoJmNlLT50aW1lbGluZS0+bGFzdF9yZXF1ZXN0KTsKKwkJ
aWYgKCFmZW5jZSkKKwkJCWNvbnRpbnVlOworCisJCWVuZ2luZSA9IHRvX3JlcXVlc3QoZmVuY2Up
LT5lbmdpbmU7CisJCWlmIChIQVNfRVhFQ0xJU1RTKGd0LT5pOTE1KSkKKwkJCWVuZ2luZSA9IGlu
dGVsX2NvbnRleHRfaW5mbGlnaHQoY2UpOworCQlpZiAoZW5naW5lKQorCQkJYWN0aXZlIHw9IGVu
Z2luZS0+bWFzazsKKworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwl9CisKKwkvKgorCSAqIFNl
bmQgYSAiaGlnaCBwcmlvcml0eSBwdWxzZSIgZG93biB0aGUgZW5naW5lIHRvIGNhdXNlIHRoZQor
CSAqIGN1cnJlbnQgcmVxdWVzdCB0byBiZSBtb21lbnRhcmlseSBwcmVlbXB0ZWQuIChJZiBpdCBm
YWlscyB0bworCSAqIGJlIHByZWVtcHRlZCwgaXQgd2lsbCBiZSByZXNldCkuIEFzIHdlIGhhdmUg
bWFya2VkIG91ciBjb250ZXh0CisJICogYXMgYmFubmVkLCBhbnkgaW5jb21wbGV0ZSByZXF1ZXN0
LCBpbmNsdWRpbmcgYW55IHJ1bm5pbmcsIHdpbGwKKwkgKiBiZSBza2lwcGVkIGZvbGxvd2luZyB0
aGUgcHJlZW1wdGlvbi4KKwkgKi8KKwlyZXNldCA9IDA7CisJZm9yX2VhY2hfZW5naW5lX21hc2tl
ZChlbmdpbmUsIGd0LT5pOTE1LCBhY3RpdmUsIHRtcCkKKwkJaWYgKGludGVsX2VuZ2luZV9wdWxz
ZShlbmdpbmUpKQorCQkJcmVzZXQgfD0gZW5naW5lLT5tYXNrOworCisJLyoKKwkgKiBJZiB3ZSBh
cmUgdW5hYmxlIHRvIHNlbmQgYSBwcmVlbXB0aXZlIHB1bHNlIHRvIGJ1bXAKKwkgKiB0aGUgY29u
dGV4dCBmcm9tIHRoZSBHUFUsIHdlIGhhdmUgdG8gcmVzb3J0IHRvIGEgZnVsbAorCSAqIHJlc2V0
LiBXZSBob3BlIHRoZSBjb2xsYXRlcmFsIGRhbWFnZSBpcyB3b3J0aCBpdC4KKwkgKi8KKwlpZiAo
cmVzZXQpCisJCWludGVsX2d0X2hhbmRsZV9lcnJvcihndCwgcmVzZXQsIDAsCisJCQkJICAgICAg
ImNvbnRleHQgY2xvc3VyZSBpbiAlcyIsIGN0eC0+bmFtZSk7Cit9CisKIHN0YXRpYyB2b2lkIGNv
bnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKIAlpOTE1X2dlbV9j
b250ZXh0X3NldF9jbG9zZWQoY3R4KTsKQEAgLTQwMCw2ICs0NzMsMTAgQEAgc3RhdGljIHZvaWQg
Y29udGV4dF9jbG9zZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCWx1dF9jbG9zZShj
dHgpOwogCiAJbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsKKworCWlmICghaTkxNV9nZW1fY29u
dGV4dF9pc19wZXJzaXN0ZW50KGN0eCkpCisJCWtpbGxfY29udGV4dChjdHgpOworCiAJaTkxNV9n
ZW1fY29udGV4dF9wdXQoY3R4KTsKIH0KIApAQCAtNDQwLDYgKzUxNywyMSBAQCBfX2NyZWF0ZV9j
b250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWk5MTVfZ2VtX2NvbnRleHRf
c2V0X2Jhbm5hYmxlKGN0eCk7CiAJaTkxNV9nZW1fY29udGV4dF9zZXRfcmVjb3ZlcmFibGUoY3R4
KTsKIAorCS8qCisJICogSWYgdGhlIHVzZXIgaGFzIGRpc2FibGVkIGhhbmdjaGVja2luZywgd2Ug
Y2FuIG5vdCBiZSBzdXJlIHRoYXQKKwkgKiB0aGUgYmF0Y2hlcyB3aWxsIGV2ZXIgY29tcGxldGUg
YWZ0ZXIgdGhlIGNvbnRleHQgaXMgY2xvc2VkLAorCSAqIGtlZXAgdGhlIGNvbnRleHQgYW5kIGFs
bCByZXNvdXJjZXMgcGlubmVkIGZvcmV2ZXIuIFNvIGluIHRoaXMKKwkgKiBjYXNlIHdlIG9wdCB0
byBmb3JjaWJseSBraWxsIG9mZiBhbGwgcmVtYWluaW5nIHJlcXVlc3RzIG9uCisJICogY29udGV4
dCBjbG9zZS4KKwkgKgorCSAqIE5vdGUgdGhhdCB0aGUgdXNlciBtYXkgY2hhbmNlIHRoZSB2YWx1
ZSBvZiB0aGUgbW9kcGFyYW0gYmV0d2VlbgorCSAqIGNvbnRleHQgY3JlYXRpb24gYW5kIGNsb3Nl
LCB3ZSBjaG9vc2UgdG8gaWdub3JlIHRoaXMgZm9yIHRoZQorCSAqIHNha2Ugb2YgZGV0ZXJtaW5p
c20gYW5kIGV4cGVjdCB0aGUgdXNlciB0byBzZXQgdGhlIHBhcmFtZXRlcgorCSAqIG9uIG1vZHVs
ZSBsb2FkIGFuZCBuZXZlciB0b3VjaCBpdCBhZ2Fpbi4KKwkgKi8KKwlpZiAoaTkxNV9tb2RwYXJh
bXMuZW5hYmxlX2hhbmdjaGVjaykgLyogY2dyb3VwIGhvb2s/ICovCisJCWk5MTVfZ2VtX2NvbnRl
eHRfc2V0X3BlcnNpc3RlbmNlKGN0eCk7CisKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShj
dHgtPmhhbmdfdGltZXN0YW1wKTsgaSsrKQogCQljdHgtPmhhbmdfdGltZXN0YW1wW2ldID0gamlm
ZmllcyAtIENPTlRFWFRfRkFTVF9IQU5HX0pJRkZJRVM7CiAKQEAgLTU5Nyw2ICs2ODksNyBAQCBp
OTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsIGludCBwcmlvKQogCX0KIAogCWk5MTVfZ2VtX2NvbnRleHRfY2xlYXJfYmFubmFibGUoY3R4
KTsKKwlpOTE1X2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShjdHgpOwogCWN0eC0+c2NoZWQu
cHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkocHJpbyk7CiAKIAlHRU1fQlVHX09OKCFpOTE1
X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjdHgpKTsKQEAgLTE3MjQsNiArMTgxNywyNiBAQCBnZXRf
ZW5naW5lcyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCXJldHVybiBlcnI7CiB9CiAK
K3N0YXRpYyBpbnQKK3NldF9wZXJzaXN0ZW5jZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
LAorCQljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gKmFyZ3MpCit7CisJ
aWYgKGFyZ3MtPnNpemUpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKGFyZ3MtPnZhbHVlKSB7
CisJCWk5MTVfZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlKGN0eCk7CisJCXJldHVybiAwOwor
CX0KKworCS8qIFRvIGNhbmNlbCBhIGNvbnRleHQgd2UgdXNlICJwcmVlbXB0LXRvLWlkbGUiICov
CisJaWYgKCEoY3R4LT5pOTE1LT5jYXBzLnNjaGVkdWxlciAmIEk5MTVfU0NIRURVTEVSX0NBUF9Q
UkVFTVBUSU9OKSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlpOTE1X2dlbV9jb250ZXh0X2NsZWFy
X3BlcnNpc3RlbmNlKGN0eCk7CisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgY3R4X3NldHBh
cmFtKHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZwcml2LAogCQkJc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCwKIAkJCXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSAq
YXJncykKQEAgLTE4MDEsNiArMTkxNCwxMCBAQCBzdGF0aWMgaW50IGN0eF9zZXRwYXJhbShzdHJ1
Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmcHJpdiwKIAkJcmV0ID0gc2V0X2VuZ2luZXMoY3R4
LCBhcmdzKTsKIAkJYnJlYWs7CiAKKwljYXNlIEk5MTVfQ09OVEVYVF9QQVJBTV9QRVJTSVNURU5D
RToKKwkJcmV0ID0gc2V0X3BlcnNpc3RlbmNlKGN0eCwgYXJncyk7CisJCWJyZWFrOworCiAJY2Fz
ZSBJOTE1X0NPTlRFWFRfUEFSQU1fQkFOX1BFUklPRDoKIAlkZWZhdWx0OgogCQlyZXQgPSAtRUlO
VkFMOwpAQCAtMjI1MCw2ICsyMzY3LDExIEBAIGludCBpOTE1X2dlbV9jb250ZXh0X2dldHBhcmFt
X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXJldCA9IGdldF9l
bmdpbmVzKGN0eCwgYXJncyk7CiAJCWJyZWFrOwogCisJY2FzZSBJOTE1X0NPTlRFWFRfUEFSQU1f
UEVSU0lTVEVOQ0U6CisJCWFyZ3MtPnNpemUgPSAwOworCQlhcmdzLT52YWx1ZSA9IGk5MTVfZ2Vt
X2NvbnRleHRfaXNfcGVyc2lzdGVudChjdHgpOworCQlicmVhazsKKwogCWNhc2UgSTkxNV9DT05U
RVhUX1BBUkFNX0JBTl9QRVJJT0Q6CiAJZGVmYXVsdDoKIAkJcmV0ID0gLUVJTlZBTDsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCmluZGV4IDE3Njk3ODYwOGI2
Zi4uZTBmNWI2YzZhMzMxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
b250ZXh0LmgKQEAgLTc0LDYgKzc0LDIxIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9j
b250ZXh0X2NsZWFyX3JlY292ZXJhYmxlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjCiAJY2xl
YXJfYml0KFVDT05URVhUX1JFQ09WRVJBQkxFLCAmY3R4LT51c2VyX2ZsYWdzKTsKIH0KIAorc3Rh
dGljIGlubGluZSBib29sIGk5MTVfZ2VtX2NvbnRleHRfaXNfcGVyc2lzdGVudChjb25zdCBzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQoreworCXJldHVybiB0ZXN0X2JpdChVQ09OVEVYVF9Q
RVJTSVNURU5DRSwgJmN0eC0+dXNlcl9mbGFncyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBp
OTE1X2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4KQoreworCXNldF9iaXQoVUNPTlRFWFRfUEVSU0lTVEVOQ0UsICZjdHgtPnVzZXJfZmxhZ3Mp
OworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9nZW1fY29udGV4dF9jbGVhcl9wZXJzaXN0
ZW5jZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQoreworCWNsZWFyX2JpdChVQ09OVEVY
VF9QRVJTSVNURU5DRSwgJmN0eC0+dXNlcl9mbGFncyk7Cit9CisKIHN0YXRpYyBpbmxpbmUgYm9v
bCBpOTE1X2dlbV9jb250ZXh0X2lzX2Jhbm5lZChjb25zdCBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4KQogewogCXJldHVybiB0ZXN0X2JpdChDT05URVhUX0JBTk5FRCwgJmN0eC0+ZmxhZ3Mp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRf
dHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVz
LmgKaW5kZXggMjYwZDU5Y2MzZGU4Li5kYWYxZWE1MDc1YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaApAQCAtMTM3LDYgKzEzNyw3
IEBAIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0IHsKICNkZWZpbmUgVUNPTlRFWFRfTk9fRVJST1Jf
Q0FQVFVSRQkxCiAjZGVmaW5lIFVDT05URVhUX0JBTk5BQkxFCQkyCiAjZGVmaW5lIFVDT05URVhU
X1JFQ09WRVJBQkxFCQkzCisjZGVmaW5lIFVDT05URVhUX1BFUlNJU1RFTkNFCQk0CiAKIAkvKioK
IAkgKiBAZmxhZ3M6IHNtYWxsIHNldCBvZiBib29sZWFucwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMKaW5kZXggYmU4OTc0Y2NmZjI0Li4w
ZDFhMjc1ZWMzMTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvbW9ja19jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9tb2NrX2NvbnRleHQuYwpAQCAtMjMsNiArMjMsOCBAQCBtb2NrX2NvbnRleHQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJSU5JVF9MSVNUX0hFQUQoJmN0eC0+bGluayk7CiAJY3R4
LT5pOTE1ID0gaTkxNTsKIAorCWk5MTVfZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlKGN0eCk7
CisKIAltdXRleF9pbml0KCZjdHgtPmVuZ2luZXNfbXV0ZXgpOwogCWUgPSBkZWZhdWx0X2VuZ2lu
ZXMoY3R4KTsKIAlpZiAoSVNfRVJSKGUpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAw
MDAwMDAwMC4uMmZjNDEzZjlkNTA2Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5jCkBAIC0wLDAgKzEsNTYgQEAKKy8qCisg
KiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkg
SW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAiaTkxNV9yZXF1ZXN0LmgiCisKKyNp
bmNsdWRlICJpbnRlbF9jb250ZXh0LmgiCisjaW5jbHVkZSAiaW50ZWxfZW5naW5lX2hlYXJ0YmVh
dC5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgorI2luY2x1ZGUgImludGVsX2VuZ2lu
ZS5oIgorI2luY2x1ZGUgImludGVsX2d0LmgiCisKK3N0YXRpYyB2b2lkIGlkbGVfcHVsc2Uoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3sK
KwllbmdpbmUtPndha2VyZWZfc2VyaWFsID0gUkVBRF9PTkNFKGVuZ2luZS0+c2VyaWFsKSArIDE7
CisJaTkxNV9yZXF1ZXN0X2FkZF9hY3RpdmVfYmFycmllcnMocnEpOworfQorCitpbnQgaW50ZWxf
ZW5naW5lX3B1bHNlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1Y3Qg
aTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7IC5wcmlvcml0eSA9IEk5MTVfUFJJT1JJVFlfQkFSUklF
UiB9OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQ7
CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50IGVyciA9IDA7CisKKwlpZiAoIWludGVs
X2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCWlm
ICghaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZShlbmdpbmUpKQorCQlyZXR1cm4gMDsKKwor
CWlmIChtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmNlLT50aW1lbGluZS0+bXV0ZXgpKQorCQln
b3RvIG91dF9ycG07CisKKwlpbnRlbF9jb250ZXh0X2VudGVyKGNlKTsKKwlycSA9IF9faTkxNV9y
ZXF1ZXN0X2NyZWF0ZShjZSwgR0ZQX05PV0FJVCB8IF9fR0ZQX05PV0FSTik7CisJaW50ZWxfY29u
dGV4dF9leGl0KGNlKTsKKwlpZiAoSVNfRVJSKHJxKSkgeworCQllcnIgPSBQVFJfRVJSKHJxKTsK
KwkJZ290byBvdXRfdW5sb2NrOworCX0KKworCXJxLT5mbGFncyB8PSBJOTE1X1JFUVVFU1RfU0VO
VElORUw7CisJaWRsZV9wdWxzZShlbmdpbmUsIHJxKTsKKworCV9faTkxNV9yZXF1ZXN0X2NvbW1p
dChycSk7CisJX19pOTE1X3JlcXVlc3RfcXVldWUocnEsICZhdHRyKTsKKworb3V0X3VubG9jazoK
KwltdXRleF91bmxvY2soJmNlLT50aW1lbGluZS0+bXV0ZXgpOworb3V0X3JwbToKKwlpbnRlbF9l
bmdpbmVfcG1fcHV0KGVuZ2luZSk7CisJcmV0dXJuIGVycjsKK30KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaApuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLmI5NTA0NTFiNTk5OAotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaApAQCAtMCwwICsx
LDE0IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHly
aWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBJTlRFTF9FTkdJ
TkVfSEVBUlRCRUFUX0gKKyNkZWZpbmUgSU5URUxfRU5HSU5FX0hFQVJUQkVBVF9ICisKK3N0cnVj
dCBpbnRlbF9lbmdpbmVfY3M7CisKK2ludCBpbnRlbF9lbmdpbmVfcHVsc2Uoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKTsKKworI2VuZGlmIC8qIElOVEVMX0VOR0lORV9IRUFSVEJFQVRf
SCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwppbmRleCA4ZTVl
NTEzZWRkYzkuLjg2YzBiMjI4MGI3YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX3BtLmMKQEAgLTExMSw3ICsxMTEsNyBAQCBzdGF0aWMgYm9vbCBzd2l0Y2hfdG9fa2Vy
bmVsX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWk5MTVfcmVxdWVz
dF9hZGRfYWN0aXZlX2JhcnJpZXJzKHJxKTsKIAogCS8qIEluc3RhbGwgb3Vyc2VsdmVzIGFzIGEg
cHJlZW1wdGlvbiBiYXJyaWVyICovCi0JcnEtPnNjaGVkLmF0dHIucHJpb3JpdHkgPSBJOTE1X1BS
SU9SSVRZX1VOUFJFRU1QVEFCTEU7CisJcnEtPnNjaGVkLmF0dHIucHJpb3JpdHkgPSBJOTE1X1BS
SU9SSVRZX0JBUlJJRVI7CiAJX19pOTE1X3JlcXVlc3RfY29tbWl0KHJxKTsKIAogCS8qIFJlbGVh
c2Ugb3VyIGV4Y2x1c2l2ZSBob2xkIG9uIHRoZSBlbmdpbmUgKi8KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcHJpb2xpc3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcHJpb2xpc3RfdHlwZXMuaAppbmRleCAyMTAzN2EyZTIwMzguLmFlOGJiM2NiNjI3
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wcmlvbGlzdF90eXBlcy5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcHJpb2xpc3RfdHlwZXMuaApAQCAtMzks
NiArMzksNyBAQCBlbnVtIHsKICAqIGFjdGl2ZSByZXF1ZXN0LgogICovCiAjZGVmaW5lIEk5MTVf
UFJJT1JJVFlfVU5QUkVFTVBUQUJMRSBJTlRfTUFYCisjZGVmaW5lIEk5MTVfUFJJT1JJVFlfQkFS
UklFUiBJTlRfTUFYCiAKICNkZWZpbmUgX19OT19QUkVFTVBUSU9OIChJOTE1X1BSSU9SSVRZX1dB
SVQpCiAKZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCBiL2luY2x1ZGUv
dWFwaS9kcm0vaTkxNV9kcm0uaAppbmRleCAzMGM1NDIxNDQwMTYuLmViOWU3MDRkNzE3YSAxMDA2
NDQKLS0tIGEvaW5jbHVkZS91YXBpL2RybS9pOTE1X2RybS5oCisrKyBiL2luY2x1ZGUvdWFwaS9k
cm0vaTkxNV9kcm0uaApAQCAtMTU2NSw2ICsxNTY1LDIxIEBAIHN0cnVjdCBkcm1faTkxNV9nZW1f
Y29udGV4dF9wYXJhbSB7CiAgKiAgIGk5MTVfY29udGV4dF9lbmdpbmVzX2JvbmQgKEk5MTVfQ09O
VEVYVF9FTkdJTkVTX0VYVF9CT05EKQogICovCiAjZGVmaW5lIEk5MTVfQ09OVEVYVF9QQVJBTV9F
TkdJTkVTCTB4YQorCisvKgorICogSTkxNV9DT05URVhUX1BBUkFNX1BFUlNJU1RFTkNFOgorICoK
KyAqIEFsbG93IHRoZSBjb250ZXh0IGFuZCBhY3RpdmUgcmVuZGVyaW5nIHRvIHN1cnZpdmUgdGhl
IHByb2Nlc3MgdW50aWwKKyAqIGNvbXBsZXRpb24uIFBlcnNpc3RlbmNlIGFsbG93cyBmaXJlLWFu
ZC1mb3JnZXQgY2xpZW50cyB0byBxdWV1ZSB1cCBhCisgKiBidW5jaCBvZiB3b3JrLCBoYW5kIHRo
ZSBvdXRwdXQgb3ZlciB0byBhIGRpc3BsYXkgc2VydmVyIGFuZCB0aGUgcXVpdC4KKyAqIElmIHRo
ZSBjb250ZXh0IGlzIG5vdCBtYXJrZWQgYXMgcGVyc2lzdGVudCwgdXBvbiBjbG9zaW5nIChlaXRo
ZXIgdmlhCisgKiBhbiBleHBsaWNpdCBEUk1fSTkxNV9HRU1fQ09OVEVYVF9ERVNUUk9ZIG9yIGlt
cGxpY2l0bHkgZnJvbSBmaWxlIGNsb3N1cmUKKyAqIG9yIHByb2Nlc3MgdGVybWluYXRpb24pLCB0
aGUgY29udGV4dCBhbmQgYW55IG91dHN0YW5kaW5nIHJlcXVlc3RzIHdpbGwgYmUKKyAqIGNhbmNl
bGxlZCAoYW5kIGV4cG9ydGVkIGZlbmNlcyBmb3IgY2FuY2VsbGVkIHJlcXVlc3RzIG1hcmtlZCBh
cyAtRUlPKS4KKyAqCisgKiBCeSBkZWZhdWx0LCBuZXcgY29udGV4dHMgYWxsb3cgcGVyc2lzdGVu
Y2UuCisgKi8KKyNkZWZpbmUgSTkxNV9DT05URVhUX1BBUkFNX1BFUlNJU1RFTkNFCTB4YgogLyog
TXVzdCBiZSBrZXB0IGNvbXBhY3QgLS0gbm8gaG9sZXMgYW5kIHdlbGwgZG9jdW1lbnRlZCAqLwog
CiAJX191NjQgdmFsdWU7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5CF7AFB780
	for <lists+intel-gfx@lfdr.de>; Wed, 13 Nov 2019 19:28:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2225F6EDDC;
	Wed, 13 Nov 2019 18:28:23 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A008B6EDDC;
 Wed, 13 Nov 2019 18:28:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19191410-1500050 
 for multiple; Wed, 13 Nov 2019 18:28:10 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 13 Nov 2019 18:28:07 +0000
Message-Id: <20191113182808.10780-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191113182808.10780-1-chris@chris-wilson.co.uk>
References: <20191113182808.10780-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 2/3] lib/igt_dummyload: Send batch as first
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+CgpUbyBz
aW1wbGlmeSBlbWl0dGluZyB0aGUgcmVjdXJzaXZlIGJhdGNoLCBtYWtlIGJhdGNoCmFsd2F5cyB0
aGUgZmlyc3Qgb2JqZWN0IG9uIHRoZSBleGVjYnVmIGxpc3QuCgpUaGlzIHdpbGwgcmVxdWlyZSBr
ZXJuZWwgdjQuMTMgb3IgZ3JlYXRlci4KCnYyOiBzZXQgaGFuZGxlcyBlYXJseSwgcG9sbF9wdHIg
aW5kZWNlbmN5IChDaHJpcykKdjM6IGFsbG93IGRlcCB3aXRoIHBvbGwKdjQ6IGZpeCBnZW1fZXhl
Y19zY2hlZHVsZQp2NTogcmViYXNlCnY2OiByZWJhc2UKdjY6IGdlbV9jdHhfc2hhcmVkCnY3OiBj
b25kaXRpb25hbCBjbG9zZSBvZiBwb2xsIGhhbmRsZQp2ODogYncgY29tcGF0IG5vdGUgKENocmlz
KQoKQ2M6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpTaWduZWQtb2Zm
LWJ5OiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBs
aWIvaWd0X2R1bW15bG9hZC5jICAgICAgICAgICAgfCAxMTUgKysrKysrKysrKysrKysrKystLS0t
LS0tLS0tLS0tLS0tCiBsaWIvaWd0X2R1bW15bG9hZC5oICAgICAgICAgICAgfCAgIDggKystCiB0
ZXN0cy9pOTE1L2dlbV9leGVjX2JhbGFuY2VyLmMgfCAgIDggKy0tCiB0ZXN0cy9pOTE1L2dlbV9z
cGluX2JhdGNoLmMgICAgfCAgMTMgKystLQogNCBmaWxlcyBjaGFuZ2VkLCA3NSBpbnNlcnRpb25z
KCspLCA2OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9saWIvaWd0X2R1bW15bG9hZC5jIGIv
bGliL2lndF9kdW1teWxvYWQuYwppbmRleCBiOWUyMzlkYjMuLmMwNzliZDA0NSAxMDA2NDQKLS0t
IGEvbGliL2lndF9kdW1teWxvYWQuYworKysgYi9saWIvaWd0X2R1bW15bG9hZC5jCkBAIC02Myw2
ICs2Myw3IEBACiAjZGVmaW5lIE1JX0FSQl9DSEsgKDB4NSA8PCAyMykKIAogc3RhdGljIGNvbnN0
IGludCBCQVRDSF9TSVpFID0gNDA5NjsKK3N0YXRpYyBjb25zdCBpbnQgUE9MTF9TSVpFID0gNDA5
NjsKIHN0YXRpYyBjb25zdCBpbnQgTE9PUF9TVEFSVF9PRkZTRVQgPSA2NDsKIAogc3RhdGljIElH
VF9MSVNUX0hFQUQoc3Bpbl9saXN0KTsKQEAgLTcyLDE2ICs3MywyMyBAQCBzdGF0aWMgaW50CiBl
bWl0X3JlY3Vyc2l2ZV9iYXRjaChpZ3Rfc3Bpbl90ICpzcGluLAogCQkgICAgIGludCBmZCwgY29u
c3Qgc3RydWN0IGlndF9zcGluX2ZhY3RvcnkgKm9wdHMpCiB7Ci0jZGVmaW5lIFNDUkFUQ0ggMAor
CiAjZGVmaW5lIEJBVENIIElHVF9TUElOX0JBVENICisjZGVmaW5lIFBPTEwgMQorI2RlZmluZSBE
RVAgICAgIDIKIAljb25zdCBpbnQgZ2VuID0gaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2aWQo
ZmQpKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRpb25fZW50cnkgcmVsb2NzWzJdLCAq
cjsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiAqIGNvbnN0IGJhdGNoID0KKwkJ
JnNwaW4tPm9ialtCQVRDSF07CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgKiBj
b25zdCBwb2xsID0KKwkJJnNwaW4tPm9ialtQT0xMXTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4
ZWNfb2JqZWN0MiAqIGNvbnN0IGRlcCA9CisJCSZzcGluLT5vYmpbREVQXTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX3JlbG9jYXRpb25fZW50cnkgcmVsb2NzWzRdLCAqcjsKIAlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX2V4ZWNidWZmZXIyICpleGVjYnVmOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19v
YmplY3QyICpvYmo7CiAJdW5zaWduZWQgaW50IGZsYWdzW0dFTV9NQVhfRU5HSU5FU107CiAJdW5z
aWduZWQgaW50IG5lbmdpbmU7CiAJaW50IGZlbmNlX2ZkID0gLTE7Ci0JdWludDMyX3QgKmNzLCAq
YmF0Y2g7CisJdWludDMyX3QgKmNzLCAqYmF0Y2hfc3RhcnQ7CiAJaW50IGk7CiAKIAluZW5naW5l
ID0gMDsKQEAgLTEwMyw2NCArMTExLDQ4IEBAIGVtaXRfcmVjdXJzaXZlX2JhdGNoKGlndF9zcGlu
X3QgKnNwaW4sCiAJbWVtc2V0KCZzcGluLT5leGVjYnVmLCAwLCBzaXplb2Yoc3Bpbi0+ZXhlY2J1
ZikpOwogCWV4ZWNidWYgPSAmc3Bpbi0+ZXhlY2J1ZjsKIAltZW1zZXQoc3Bpbi0+b2JqLCAwLCBz
aXplb2Yoc3Bpbi0+b2JqKSk7Ci0Jb2JqID0gc3Bpbi0+b2JqOwogCW1lbXNldChyZWxvY3MsIDAs
IHNpemVvZihyZWxvY3MpKTsKIAotCW9ialtCQVRDSF0uaGFuZGxlID0gZ2VtX2NyZWF0ZShmZCwg
QkFUQ0hfU0laRSk7Ci0JYmF0Y2ggPSBfX2dlbV9tbWFwX193YyhmZCwgb2JqW0JBVENIXS5oYW5k
bGUsCi0JCQkgICAgICAgMCwgQkFUQ0hfU0laRSwgUFJPVF9XUklURSk7Ci0JaWYgKCFiYXRjaCkK
LQkJYmF0Y2ggPSBnZW1fbW1hcF9fZ3R0KGZkLCBvYmpbQkFUQ0hdLmhhbmRsZSwKLQkJCQkgICAg
ICBCQVRDSF9TSVpFLCBQUk9UX1dSSVRFKTsKKwliYXRjaC0+aGFuZGxlID0gZ2VtX2NyZWF0ZShm
ZCwgQkFUQ0hfU0laRSk7CisJc3Bpbi0+aGFuZGxlID0gYmF0Y2gtPmhhbmRsZTsKIAotCWdlbV9z
ZXRfZG9tYWluKGZkLCBvYmpbQkFUQ0hdLmhhbmRsZSwKKwliYXRjaF9zdGFydCA9IF9fZ2VtX21t
YXBfX3djKGZkLCBiYXRjaC0+aGFuZGxlLAorCQkJCSAgICAgMCwgQkFUQ0hfU0laRSwgUFJPVF9X
UklURSk7CisJaWYgKCFiYXRjaF9zdGFydCkKKwkJYmF0Y2hfc3RhcnQgPSBnZW1fbW1hcF9fZ3R0
KGZkLCBiYXRjaC0+aGFuZGxlLAorCQkJCQkgICAgQkFUQ0hfU0laRSwgUFJPVF9XUklURSk7CisJ
Z2VtX3NldF9kb21haW4oZmQsIGJhdGNoLT5oYW5kbGUsCiAJCSAgICAgICBJOTE1X0dFTV9ET01B
SU5fR1RULCBJOTE1X0dFTV9ET01BSU5fR1RUKTsKIAlleGVjYnVmLT5idWZmZXJfY291bnQrKzsK
LQljcyA9IGJhdGNoOwotCi0JaWYgKG9wdHMtPmRlcGVuZGVuY3kpIHsKLQkJaWd0X2Fzc2VydCgh
KG9wdHMtPmZsYWdzICYgSUdUX1NQSU5fUE9MTF9SVU4pKTsKLQotCQlyID0gJnJlbG9jc1tvYmpb
QkFUQ0hdLnJlbG9jYXRpb25fY291bnQrK107CisJY3MgPSBiYXRjaF9zdGFydDsKIAotCQkvKiBk
dW1teSB3cml0ZSB0byBkZXBlbmRlbmN5ICovCi0JCW9ialtTQ1JBVENIXS5oYW5kbGUgPSBvcHRz
LT5kZXBlbmRlbmN5OwotCQlyLT5wcmVzdW1lZF9vZmZzZXQgPSAwOwotCQlyLT50YXJnZXRfaGFu
ZGxlID0gb2JqW1NDUkFUQ0hdLmhhbmRsZTsKLQkJci0+b2Zmc2V0ID0gc2l6ZW9mKHVpbnQzMl90
KSAqIDEwMjA7Ci0JCXItPmRlbHRhID0gMDsKLQkJci0+cmVhZF9kb21haW5zID0gSTkxNV9HRU1f
RE9NQUlOX1JFTkRFUjsKLQkJci0+d3JpdGVfZG9tYWluID0gSTkxNV9HRU1fRE9NQUlOX1JFTkRF
UjsKLQotCQlleGVjYnVmLT5idWZmZXJfY291bnQrKzsKLQl9IGVsc2UgaWYgKG9wdHMtPmZsYWdz
ICYgSUdUX1NQSU5fUE9MTF9SVU4pIHsKLQkJciA9ICZyZWxvY3Nbb2JqW0JBVENIXS5yZWxvY2F0
aW9uX2NvdW50KytdOworCXBvbGwtPmhhbmRsZSA9IGdlbV9jcmVhdGUoZmQsIFBPTExfU0laRSk7
CisJc3Bpbi0+cG9sbF9oYW5kbGUgPSBwb2xsLT5oYW5kbGU7CisJZXhlY2J1Zi0+YnVmZmVyX2Nv
dW50Kys7CiAKLQkJaWd0X2Fzc2VydCghb3B0cy0+ZGVwZW5kZW5jeSk7CisJaWYgKG9wdHMtPmZs
YWdzICYgSUdUX1NQSU5fUE9MTF9SVU4pIHsKKwkJciA9ICZyZWxvY3NbYmF0Y2gtPnJlbG9jYXRp
b25fY291bnQrK107CiAKIAkJaWYgKGdlbiA9PSA0IHx8IGdlbiA9PSA1KSB7CiAJCQlleGVjYnVm
LT5mbGFncyB8PSBJOTE1X0VYRUNfU0VDVVJFOwogCQkJaWd0X3JlcXVpcmUoX19pZ3RfZGV2aWNl
X3NldF9tYXN0ZXIoZmQpID09IDApOwogCQl9CiAKLQkJc3Bpbi0+cG9sbF9oYW5kbGUgPSBnZW1f
Y3JlYXRlKGZkLCA0MDk2KTsKLQkJb2JqW1NDUkFUQ0hdLmhhbmRsZSA9IHNwaW4tPnBvbGxfaGFu
ZGxlOwotCi0JCWlmIChfX2dlbV9zZXRfY2FjaGluZyhmZCwgc3Bpbi0+cG9sbF9oYW5kbGUsCisJ
CWlmIChfX2dlbV9zZXRfY2FjaGluZyhmZCwgcG9sbC0+aGFuZGxlLAogCQkJCSAgICAgIEk5MTVf
Q0FDSElOR19DQUNIRUQpID09IDApCi0JCQlzcGluLT5wb2xsID0gZ2VtX21tYXBfX2NwdShmZCwg
c3Bpbi0+cG9sbF9oYW5kbGUsCi0JCQkJCQkgICAwLCA0MDk2LAorCQkJc3Bpbi0+cG9sbCA9IGdl
bV9tbWFwX19jcHUoZmQsIHBvbGwtPmhhbmRsZSwKKwkJCQkJCSAgIDAsIFBPTExfU0laRSwKIAkJ
CQkJCSAgIFBST1RfUkVBRCB8IFBST1RfV1JJVEUpOwogCQllbHNlCi0JCQlzcGluLT5wb2xsID0g
Z2VtX21tYXBfX3djKGZkLCBzcGluLT5wb2xsX2hhbmRsZSwKLQkJCQkJCSAgMCwgNDA5NiwKKwkJ
CXNwaW4tPnBvbGwgPSBnZW1fbW1hcF9fd2MoZmQsIHBvbGwtPmhhbmRsZSwKKwkJCQkJCSAgMCwg
UE9MTF9TSVpFLAogCQkJCQkJICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFKTsKIAogCQlpZ3RfYXNz
ZXJ0X2VxKHNwaW4tPnBvbGxbU1BJTl9QT0xMX1NUQVJUX0lEWF0sIDApOwogCiAJCS8qIGJhdGNo
IGlzIGZpcnN0ICovCi0JCXItPnByZXN1bWVkX29mZnNldCA9IDQwOTY7Ci0JCXItPnRhcmdldF9o
YW5kbGUgPSBvYmpbU0NSQVRDSF0uaGFuZGxlOworCQlyLT5wcmVzdW1lZF9vZmZzZXQgPSBCQVRD
SF9TSVpFOworCQlyLT50YXJnZXRfaGFuZGxlID0gcG9sbC0+aGFuZGxlOwogCQlyLT5vZmZzZXQg
PSBzaXplb2YodWludDMyX3QpICogMTsKIAkJci0+ZGVsdGEgPSBzaXplb2YodWludDMyX3QpICog
U1BJTl9QT0xMX1NUQVJUX0lEWDsKIApAQCAtMTc5LDE0ICsxNzEsMjUgQEAgZW1pdF9yZWN1cnNp
dmVfYmF0Y2goaWd0X3NwaW5fdCAqc3BpbiwKIAkJfQogCiAJCSpjcysrID0gMTsKKwl9CisKKwlp
ZiAob3B0cy0+ZGVwZW5kZW5jeSkgeworCQlyID0gJnJlbG9jc1tiYXRjaC0+cmVsb2NhdGlvbl9j
b3VudCsrXTsKKworCQkvKiBkdW1teSB3cml0ZSB0byBkZXBlbmRlbmN5ICovCisJCWRlcC0+aGFu
ZGxlID0gb3B0cy0+ZGVwZW5kZW5jeTsKKwkJci0+cHJlc3VtZWRfb2Zmc2V0ID0gQkFUQ0hfU0la
RSArIFBPTExfU0laRTsKKwkJci0+dGFyZ2V0X2hhbmRsZSA9IGRlcC0+aGFuZGxlOworCQlyLT5v
ZmZzZXQgPSBzaXplb2YodWludDMyX3QpICogMTAyMDsKKwkJci0+ZGVsdGEgPSAwOworCQlyLT5y
ZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fUkVOREVSOworCQlyLT53cml0ZV9kb21haW4g
PSBJOTE1X0dFTV9ET01BSU5fUkVOREVSOwogCiAJCWV4ZWNidWYtPmJ1ZmZlcl9jb3VudCsrOwog
CX0KIAotCXNwaW4tPmhhbmRsZSA9IG9ialtCQVRDSF0uaGFuZGxlOwotCi0JaWd0X2Fzc2VydF9s
dChjcyAtIGJhdGNoLCBMT09QX1NUQVJUX09GRlNFVCAvIHNpemVvZigqY3MpKTsKLQlzcGluLT5j
b25kaXRpb24gPSBiYXRjaCArIExPT1BfU1RBUlRfT0ZGU0VUIC8gc2l6ZW9mKCpjcyk7CisJaWd0
X2Fzc2VydF9sdChjcyAtIGJhdGNoX3N0YXJ0LCBMT09QX1NUQVJUX09GRlNFVCAvIHNpemVvZigq
Y3MpKTsKKwlzcGluLT5jb25kaXRpb24gPSBiYXRjaF9zdGFydCArIExPT1BfU1RBUlRfT0ZGU0VU
IC8gc2l6ZW9mKCpjcyk7CiAJY3MgPSBzcGluLT5jb25kaXRpb247CiAKIAkvKiBBbGxvdyBvdXJz
ZWx2ZXMgdG8gYmUgcHJlZW1wdGVkICovCkBAIC0yMDgsOSArMjExLDkgQEAgZW1pdF9yZWN1cnNp
dmVfYmF0Y2goaWd0X3NwaW5fdCAqc3BpbiwKIAkJY3MgKz0gMTAwMDsKIAogCS8qIHJlY3Vyc2Ug
Ki8KLQlyID0gJnJlbG9jc1tvYmpbQkFUQ0hdLnJlbG9jYXRpb25fY291bnQrK107Ci0Jci0+dGFy
Z2V0X2hhbmRsZSA9IG9ialtCQVRDSF0uaGFuZGxlOwotCXItPm9mZnNldCA9IChjcyArIDEgLSBi
YXRjaCkgKiBzaXplb2YoKmNzKTsKKwlyID0gJnJlbG9jc1tiYXRjaC0+cmVsb2NhdGlvbl9jb3Vu
dCsrXTsKKwlyLT50YXJnZXRfaGFuZGxlID0gYmF0Y2gtPmhhbmRsZTsKKwlyLT5vZmZzZXQgPSAo
Y3MgKyAxIC0gYmF0Y2hfc3RhcnQpICogc2l6ZW9mKCpjcyk7CiAJci0+cmVhZF9kb21haW5zID0g
STkxNV9HRU1fRE9NQUlOX0NPTU1BTkQ7CiAJci0+ZGVsdGEgPSBMT09QX1NUQVJUX09GRlNFVDsK
IAlpZiAoZ2VuID49IDgpIHsKQEAgLTIyNywxMCArMjMwLDEwIEBAIGVtaXRfcmVjdXJzaXZlX2Jh
dGNoKGlndF9zcGluX3QgKnNwaW4sCiAJCSpjcyA9IHItPmRlbHRhOwogCQljcysrOwogCX0KLQlv
YmpbQkFUQ0hdLnJlbG9jc19wdHIgPSB0b191c2VyX3BvaW50ZXIocmVsb2NzKTsKKwliYXRjaC0+
cmVsb2NzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcihyZWxvY3MpOwogCi0JZXhlY2J1Zi0+YnVmZmVy
c19wdHIgPSB0b191c2VyX3BvaW50ZXIob2JqICsKLQkJCQkJICAgICAgICgyIC0gZXhlY2J1Zi0+
YnVmZmVyX2NvdW50KSk7CisJZXhlY2J1Zi0+YnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIo
c3Bpbi0+b2JqKTsKKwlleGVjYnVmLT5mbGFncyB8PSBJOTE1X0VYRUNfQkFUQ0hfRklSU1Q7CiAJ
ZXhlY2J1Zi0+cnN2ZDEgPSBvcHRzLT5jdHg7CiAKIAlpZiAob3B0cy0+ZmxhZ3MgJiBJR1RfU1BJ
Tl9GRU5DRV9PVVQpCkBAIC0yNjQsMTAgKzI2Nyw5IEBAIGVtaXRfcmVjdXJzaXZlX2JhdGNoKGln
dF9zcGluX3QgKnNwaW4sCiAJCX0KIAl9CiAKLQlpZ3RfYXNzZXJ0X2x0KGNzIC0gYmF0Y2gsIEJB
VENIX1NJWkUgLyBzaXplb2YoKmNzKSk7CisJaWd0X2Fzc2VydF9sdChjcyAtIGJhdGNoX3N0YXJ0
LCBCQVRDSF9TSVpFIC8gc2l6ZW9mKCpjcykpOwogCi0JLyogTWFrZSBpdCBlYXNpZXIgZm9yIGNh
bGxlcnMgdG8gcmVzdWJtaXQuICovCi0JZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoc3Bpbi0+
b2JqKTsgaSsrKSB7CisJZm9yIChpID0gMDsgaSA8IGV4ZWNidWYtPmJ1ZmZlcl9jb3VudDsgaSsr
KSB7CiAJCXNwaW4tPm9ialtpXS5yZWxvY2F0aW9uX2NvdW50ID0gMDsKIAkJc3Bpbi0+b2JqW2ld
LnJlbG9jc19wdHIgPSAwOwogCQlzcGluLT5vYmpbaV0uZmxhZ3MgPSBFWEVDX09CSkVDVF9QSU5O
RUQ7CkBAIC00NDUsMTAgKzQ0NywxMSBAQCB2b2lkIGlndF9zcGluX2ZyZWUoaW50IGZkLCBpZ3Rf
c3Bpbl90ICpzcGluKQogCWdlbV9tdW5tYXAoKHZvaWQgKikoKHVuc2lnbmVkIGxvbmcpc3Bpbi0+
Y29uZGl0aW9uICYgKH40MDk1VUwpKSwKIAkJICAgQkFUQ0hfU0laRSk7CiAKLQlpZiAoc3Bpbi0+
cG9sbCkgeworCWlmIChzcGluLT5wb2xsKQogCQlnZW1fbXVubWFwKHNwaW4tPnBvbGwsIDQwOTYp
OworCisJaWYgKHNwaW4tPnBvbGxfaGFuZGxlKQogCQlnZW1fY2xvc2UoZmQsIHNwaW4tPnBvbGxf
aGFuZGxlKTsKLQl9CiAKIAlpZiAoc3Bpbi0+aGFuZGxlKQogCQlnZW1fY2xvc2UoZmQsIHNwaW4t
PmhhbmRsZSk7CmRpZmYgLS1naXQgYS9saWIvaWd0X2R1bW15bG9hZC5oIGIvbGliL2lndF9kdW1t
eWxvYWQuaAppbmRleCA0MjFjYTE4M2IuLmRlNTc4MWQ3ZCAxMDA2NDQKLS0tIGEvbGliL2lndF9k
dW1teWxvYWQuaAorKysgYi9saWIvaWd0X2R1bW15bG9hZC5oCkBAIC0zNCw2ICszNCw3IEBACiAK
IHR5cGVkZWYgc3RydWN0IGlndF9zcGluIHsKIAl1bnNpZ25lZCBpbnQgaGFuZGxlOworCiAJdGlt
ZXJfdCB0aW1lcjsKIAlzdHJ1Y3QgaWd0X2xpc3RfaGVhZCBsaW5rOwogCkBAIC00MSw5ICs0Miwx
MiBAQCB0eXBlZGVmIHN0cnVjdCBpZ3Rfc3BpbiB7CiAJdWludDMyX3QgY21kX3ByZWNvbmRpdGlv
bjsKIAogCWludCBvdXRfZmVuY2U7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIg
b2JqWzJdOwotI2RlZmluZSBJR1RfU1BJTl9CQVRDSCAgIDEKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X2V4ZWNfb2JqZWN0MiBvYmpbM107CisjZGVmaW5lIElHVF9TUElOX0JBVENIICAgMAorI2RlZmlu
ZSBJR1RfU1BJTl9QT0xMICAgIDEKKwogCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIg
ZXhlY2J1ZjsKKwogCXVpbnQzMl90IHBvbGxfaGFuZGxlOwogCXVpbnQzMl90ICpwb2xsOwogI2Rl
ZmluZSBTUElOX1BPTExfU1RBUlRfSURYIDAKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX2V4
ZWNfYmFsYW5jZXIuYyBiL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfYmFsYW5jZXIuYwppbmRleCA3MGM0
NTI5YjQuLjE5ZGY0MDZjZiAxMDA2NDQKLS0tIGEvdGVzdHMvaTkxNS9nZW1fZXhlY19iYWxhbmNl
ci5jCisrKyBiL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfYmFsYW5jZXIuYwpAQCAtNzE4LDcgKzcxOCw3
IEBAIHN0YXRpYyB1aW50MzJfdCBjcmVhdGVfc2VtYXBob3JlX3RvX3NwaW5uZXIoaW50IGk5MTUs
IGlndF9zcGluX3QgKnNwaW4pCiAJY3MgPSBtYXAgPSBnZW1fbW1hcF9fY3B1KGk5MTUsIGhhbmRs
ZSwgMCwgNDA5NiwgUFJPVF9XUklURSk7CiAKIAkvKiBXYWl0IHVudGlsIHRoZSBzcGlubmVyIGlz
IHJ1bm5pbmcgKi8KLQlhZGRyID0gc3Bpbi0+b2JqWzBdLm9mZnNldCArIDQgKiBTUElOX1BPTExf
U1RBUlRfSURYOworCWFkZHIgPSBzcGluLT5vYmpbSUdUX1NQSU5fUE9MTF0ub2Zmc2V0ICsgNCAq
IFNQSU5fUE9MTF9TVEFSVF9JRFg7CiAJKmNzKysgPSBNSV9TRU1BUEhPUkVfV0FJVCB8CiAJCU1J
X1NFTUFQSE9SRV9QT0xMIHwKIAkJTUlfU0VNQVBIT1JFX1NBRF9ORVFfU0REIHwKQEAgLTc5Nyw5
ICs3OTcsOSBAQCBzdGF0aWMgdm9pZCBib25kZWRfc2xpY2UoaW50IGk5MTUpCiAJCWlndF9zcGlu
X3Jlc2V0KHNwaW4pOwogCiAJCS8qIGlndF9zcGluX3QgcG9sbCBhbmQgYmF0Y2ggb2JqIG11c3Qg
YmUgbGFpZCBvdXQgYXMgd2UgZXhwZWN0ICovCi0JCWlndF9hc3NlcnRfZXEoSUdUX1NQSU5fQkFU
Q0gsIDEpOwotCQlvYmpbMF0gPSBzcGluLT5vYmpbMF07Ci0JCW9ialsxXSA9IHNwaW4tPm9ialsx
XTsKKwkJaWd0X2Fzc2VydF9lcShJR1RfU1BJTl9CQVRDSCwgMCk7CisJCW9ialswXSA9IHNwaW4t
Pm9ialtJR1RfU1BJTl9QT0xMXTsKKwkJb2JqWzFdID0gc3Bpbi0+b2JqW0lHVF9TUElOX0JBVENI
XTsKIAkJb2JqWzJdLmhhbmRsZSA9IGNyZWF0ZV9zZW1hcGhvcmVfdG9fc3Bpbm5lcihpOTE1LCBz
cGluKTsKIAogCQllYi5idWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcihvYmopOwpkaWZmIC0t
Z2l0IGEvdGVzdHMvaTkxNS9nZW1fc3Bpbl9iYXRjaC5jIGIvdGVzdHMvaTkxNS9nZW1fc3Bpbl9i
YXRjaC5jCmluZGV4IGM2N2YwMTVmZi4uMDQ3MDdmZGMyIDEwMDY0NAotLS0gYS90ZXN0cy9pOTE1
L2dlbV9zcGluX2JhdGNoLmMKKysrIGIvdGVzdHMvaTkxNS9nZW1fc3Bpbl9iYXRjaC5jCkBAIC03
OCwxMiArNzgsOSBAQCBzdGF0aWMgdm9pZCBzcGluX3Jlc3VibWl0KGludCBmZCwgY29uc3Qgc3Ry
dWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplMiwKIAkJZ2VtX2NvbnRleHRfY3JlYXRlKGZk
KSA6IGN0eDA7CiAJaWd0X3NwaW5fdCAqc3BpbiA9IF9faWd0X3NwaW5fbmV3KGZkLCAuY3R4ID0g
Y3R4MCwgLmVuZ2luZSA9IGUyLT5mbGFncyk7CiAJY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlv
bl9lbmdpbmUyICpvdGhlcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGViID0g
c3Bpbi0+ZXhlY2J1ZjsKIAotCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZWIgPSB7
Ci0JCS5idWZmZXJfY291bnQgPSAxLAotCQkuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIo
JnNwaW4tPm9ialtJR1RfU1BJTl9CQVRDSF0pLAotCQkucnN2ZDEgPSBjdHgxLAotCX07CisJZWIu
cnN2ZDEgPSBjdHgxOwogCiAJaWd0X2Fzc2VydChnZW1fY29udGV4dF9oYXNfZW5naW5lX21hcChm
ZCwgMCkgfHwKIAkJICAgIShmbGFncyAmIFJFU1VCTUlUX0FMTF9FTkdJTkVTKSk7CkBAIC05Nywx
MSArOTQsMTMgQEAgc3RhdGljIHZvaWQgc3Bpbl9yZXN1Ym1pdChpbnQgZmQsIGNvbnN0IHN0cnVj
dCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqZTIsCiAJCQlpZiAoZ2VtX2VuZ2luZV9pc19lcXVh
bChvdGhlciwgZTIpKQogCQkJCWNvbnRpbnVlOwogCi0JCQllYi5mbGFncyA9IG90aGVyLT5mbGFn
czsKKwkJCWViLmZsYWdzICY9IH4oSTkxNV9FWEVDX1JJTkdfTUFTSyB8IEk5MTVfRVhFQ19CU0Rf
TUFTSyk7CisJCQllYi5mbGFncyB8PSBvdGhlci0+ZmxhZ3M7CiAJCQlnZW1fZXhlY2J1ZihmZCwg
JmViKTsKIAkJfQogCX0gZWxzZSB7Ci0JCWViLmZsYWdzID0gZTItPmZsYWdzOworCQllYi5mbGFn
cyAmPSB+KEk5MTVfRVhFQ19SSU5HX01BU0sgfCBJOTE1X0VYRUNfQlNEX01BU0spOworCQllYi5m
bGFncyB8PSBlMi0+ZmxhZ3M7CiAJCWdlbV9leGVjYnVmKGZkLCAmZWIpOwogCX0KIAotLSAKMi4y
NC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRl
bC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

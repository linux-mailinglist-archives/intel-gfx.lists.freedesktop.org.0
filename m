Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CE5182DBF6A
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Dec 2020 12:30:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4051589FC3;
	Wed, 16 Dec 2020 11:30:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AFC6B894DC
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Dec 2020 11:30:17 +0000 (UTC)
IronPort-SDR: QLe2665ojHgcyZ2xUnKstCceV+Wx5gGlT6/hKuiv1SrV/ioqXm0oERunJuH6p2A4Vq/H8GJa9d
 0od0RDsU9Twg==
X-IronPort-AV: E=McAfee;i="6000,8403,9836"; a="172477371"
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="172477371"
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 03:30:17 -0800
IronPort-SDR: bkEduDAFwDPXJ0WFWDfiuj3YnVl6oyRGFlVA6PDj4GmM+FOHJSTGvL6f0u3GUS19JFcVNCLuIJ
 LnZ0XaVvYDbw==
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="412554837"
Received: from slevy-mobl.ger.corp.intel.com (HELO localhost)
 ([10.214.192.176])
 by orsmga001-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 03:30:12 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Dec 2020 13:29:13 +0200
Message-Id: <08c0b7cc1371d98e09861cf53a89db927b12b47f.1608117676.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1608117676.git.jani.nikula@intel.com>
References: <cover.1608117676.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 06/11] drm/i915: refactor pll code out into
 intel_dpll.c
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Dave Airlie <airlied@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClRoaXMgcHVsbHMgYSBsYXJn
ZSBjaHVuayBvZiB0aGUgcGxsIGNhbGN1bGF0aW9uIGNvZGUgb3V0IG9mCmludGVsX2Rpc3BsYXku
YyB0byBhIG5ldyBmaWxlLgoKT25lIGZ1bmN0aW9uIG1ha2VzIHNlbnNlIHRvIGJlIGFuIGlubGlu
ZSwgb3RoZXJ3aXNlIHRoaXMKaXMgcHJldHR5IG11Y2ggYSBzdHJhaWdodCBjb3B5IGNvdmVyLiBB
bHNvIGFsbCB0aGUKcmVtYWluaW5nIGhvb2tzIGZvciBnNDUgYW5kIG9sZGVyIGVuZCB1cCB0aGUg
c2FtZSBub3cuCgpTaWduZWQtb2ZmLWJ5OiBEYXZlIEFpcmxpZSA8YWlybGllZEByZWRoYXQuY29t
PgpbSmFuaTogY2xlYW5lZCB1cCBpbnRlbF9kcGxsLmggYSBiaXQsIGRlLWR1cGVkIGludGVsX3Bh
bmVsX3VzZV9zc2MoKS5dClNpZ25lZC1vZmYtYnk6IEphbmkgTmlrdWxhIDxqYW5pLm5pa3VsYUBp
bnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAg
ICAgIHwgICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YyAgfCAxNDAyICstLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuaCAgfCAgICAzICsKIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXlfdHlwZXMuaCAgICB8ICAgMTMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcGxsLmMgICAgIHwgMTM2MyArKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwbGwuaCAgICAgfCAgIDIzICsKIDYgZmlsZXMgY2hhbmdlZCwg
MTQxNCBpbnNlcnRpb25zKCspLCAxMzkxIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBsbC5jCiBjcmVhdGUgbW9kZSAx
MDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsLmgKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L01ha2VmaWxlCmluZGV4IGYyZTkwNzMzM2Y3Mi4uZjI0MjRkNjdmMzA2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9N
YWtlZmlsZQpAQCAtMjAzLDYgKzIwMyw3IEBAIGk5MTUteSArPSBcCiAJZGlzcGxheS9pbnRlbF9k
aXNwbGF5Lm8gXAogCWRpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5vIFwKIAlkaXNwbGF5L2lu
dGVsX2RwaW9fcGh5Lm8gXAorCWRpc3BsYXkvaW50ZWxfZHBsbC5vIFwKIAlkaXNwbGF5L2ludGVs
X2RwbGxfbWdyLm8gXAogCWRpc3BsYXkvaW50ZWxfZHNiLm8gXAogCWRpc3BsYXkvaW50ZWxfZmJj
Lm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCA1MzAyMjJlNjhlZTIuLmE1NTlhYmY2MDJjYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTQ4LDYgKzQ4LDcgQEAKICNpbmNsdWRlICJkaXNw
bGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHAu
aCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2RwX21zdC5oIgorI2luY2x1ZGUgImRpc3BsYXkv
aW50ZWxfZHBsbC5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHBsbF9tZ3IuaCIKICNpbmNs
dWRlICJkaXNwbGF5L2ludGVsX2RzaS5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHZvLmgi
CkBAIC0xMTQsMTcgKzExNSw2IEBAIHN0YXRpYyB2b2lkIGlsa19wZml0X2VuYWJsZShjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiBzdGF0aWMgdm9pZCBpbnRlbF9t
b2Rlc2V0X3NldHVwX2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSBzdHJ1
Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCk7CiAKLXN0cnVjdCBpbnRlbF9saW1pdCB7
Ci0Jc3RydWN0IHsKLQkJaW50IG1pbiwgbWF4OwotCX0gZG90LCB2Y28sIG4sIG0sIG0xLCBtMiwg
cCwgcDE7Ci0KLQlzdHJ1Y3QgewotCQlpbnQgZG90X2xpbWl0OwotCQlpbnQgcDJfc2xvdywgcDJf
ZmFzdDsKLQl9IHAyOwotfTsKLQogLyogcmV0dXJucyBIUExMIGZyZXF1ZW5jeSBpbiBrSHogKi8K
IGludCB2bHZfZ2V0X2hwbGxfdmNvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IHsKQEAgLTE5MiwyNzEgKzE4Miw2IEBAIHN0YXRpYyB1MzIgaW50ZWxfZmRpX2xpbmtfZnJlcShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybiBkZXZfcHJpdi0+ZmRp
X3BsbF9mcmVxOwogfQogCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2xpbWl0IGludGVsX2xp
bWl0c19pOHh4X2RhYyA9IHsKLQkuZG90ID0geyAubWluID0gMjUwMDAsIC5tYXggPSAzNTAwMDAg
fSwKLQkudmNvID0geyAubWluID0gOTA4MDAwLCAubWF4ID0gMTUxMjAwMCB9LAotCS5uID0geyAu
bWluID0gMiwgLm1heCA9IDE2IH0sCi0JLm0gPSB7IC5taW4gPSA5NiwgLm1heCA9IDE0MCB9LAot
CS5tMSA9IHsgLm1pbiA9IDE4LCAubWF4ID0gMjYgfSwKLQkubTIgPSB7IC5taW4gPSA2LCAubWF4
ID0gMTYgfSwKLQkucCA9IHsgLm1pbiA9IDQsIC5tYXggPSAxMjggfSwKLQkucDEgPSB7IC5taW4g
PSAyLCAubWF4ID0gMzMgfSwKLQkucDIgPSB7IC5kb3RfbGltaXQgPSAxNjUwMDAsCi0JCS5wMl9z
bG93ID0gNCwgLnAyX2Zhc3QgPSAyIH0sCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVs
X2xpbWl0IGludGVsX2xpbWl0c19pOHh4X2R2byA9IHsKLQkuZG90ID0geyAubWluID0gMjUwMDAs
IC5tYXggPSAzNTAwMDAgfSwKLQkudmNvID0geyAubWluID0gOTA4MDAwLCAubWF4ID0gMTUxMjAw
MCB9LAotCS5uID0geyAubWluID0gMiwgLm1heCA9IDE2IH0sCi0JLm0gPSB7IC5taW4gPSA5Niwg
Lm1heCA9IDE0MCB9LAotCS5tMSA9IHsgLm1pbiA9IDE4LCAubWF4ID0gMjYgfSwKLQkubTIgPSB7
IC5taW4gPSA2LCAubWF4ID0gMTYgfSwKLQkucCA9IHsgLm1pbiA9IDQsIC5tYXggPSAxMjggfSwK
LQkucDEgPSB7IC5taW4gPSAyLCAubWF4ID0gMzMgfSwKLQkucDIgPSB7IC5kb3RfbGltaXQgPSAx
NjUwMDAsCi0JCS5wMl9zbG93ID0gNCwgLnAyX2Zhc3QgPSA0IH0sCi19OwotCi1zdGF0aWMgY29u
c3Qgc3RydWN0IGludGVsX2xpbWl0IGludGVsX2xpbWl0c19pOHh4X2x2ZHMgPSB7Ci0JLmRvdCA9
IHsgLm1pbiA9IDI1MDAwLCAubWF4ID0gMzUwMDAwIH0sCi0JLnZjbyA9IHsgLm1pbiA9IDkwODAw
MCwgLm1heCA9IDE1MTIwMDAgfSwKLQkubiA9IHsgLm1pbiA9IDIsIC5tYXggPSAxNiB9LAotCS5t
ID0geyAubWluID0gOTYsIC5tYXggPSAxNDAgfSwKLQkubTEgPSB7IC5taW4gPSAxOCwgLm1heCA9
IDI2IH0sCi0JLm0yID0geyAubWluID0gNiwgLm1heCA9IDE2IH0sCi0JLnAgPSB7IC5taW4gPSA0
LCAubWF4ID0gMTI4IH0sCi0JLnAxID0geyAubWluID0gMSwgLm1heCA9IDYgfSwKLQkucDIgPSB7
IC5kb3RfbGltaXQgPSAxNjUwMDAsCi0JCS5wMl9zbG93ID0gMTQsIC5wMl9mYXN0ID0gNyB9LAot
fTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCBpbnRlbF9saW1pdHNfaTl4eF9z
ZHZvID0gewotCS5kb3QgPSB7IC5taW4gPSAyMDAwMCwgLm1heCA9IDQwMDAwMCB9LAotCS52Y28g
PSB7IC5taW4gPSAxNDAwMDAwLCAubWF4ID0gMjgwMDAwMCB9LAotCS5uID0geyAubWluID0gMSwg
Lm1heCA9IDYgfSwKLQkubSA9IHsgLm1pbiA9IDcwLCAubWF4ID0gMTIwIH0sCi0JLm0xID0geyAu
bWluID0gOCwgLm1heCA9IDE4IH0sCi0JLm0yID0geyAubWluID0gMywgLm1heCA9IDcgfSwKLQku
cCA9IHsgLm1pbiA9IDUsIC5tYXggPSA4MCB9LAotCS5wMSA9IHsgLm1pbiA9IDEsIC5tYXggPSA4
IH0sCi0JLnAyID0geyAuZG90X2xpbWl0ID0gMjAwMDAwLAotCQkucDJfc2xvdyA9IDEwLCAucDJf
ZmFzdCA9IDUgfSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaW50ZWxf
bGltaXRzX2k5eHhfbHZkcyA9IHsKLQkuZG90ID0geyAubWluID0gMjAwMDAsIC5tYXggPSA0MDAw
MDAgfSwKLQkudmNvID0geyAubWluID0gMTQwMDAwMCwgLm1heCA9IDI4MDAwMDAgfSwKLQkubiA9
IHsgLm1pbiA9IDEsIC5tYXggPSA2IH0sCi0JLm0gPSB7IC5taW4gPSA3MCwgLm1heCA9IDEyMCB9
LAotCS5tMSA9IHsgLm1pbiA9IDgsIC5tYXggPSAxOCB9LAotCS5tMiA9IHsgLm1pbiA9IDMsIC5t
YXggPSA3IH0sCi0JLnAgPSB7IC5taW4gPSA3LCAubWF4ID0gOTggfSwKLQkucDEgPSB7IC5taW4g
PSAxLCAubWF4ID0gOCB9LAotCS5wMiA9IHsgLmRvdF9saW1pdCA9IDExMjAwMCwKLQkJLnAyX3Ns
b3cgPSAxNCwgLnAyX2Zhc3QgPSA3IH0sCi19OwotCi0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50
ZWxfbGltaXQgaW50ZWxfbGltaXRzX2c0eF9zZHZvID0gewotCS5kb3QgPSB7IC5taW4gPSAyNTAw
MCwgLm1heCA9IDI3MDAwMCB9LAotCS52Y28gPSB7IC5taW4gPSAxNzUwMDAwLCAubWF4ID0gMzUw
MDAwMH0sCi0JLm4gPSB7IC5taW4gPSAxLCAubWF4ID0gNCB9LAotCS5tID0geyAubWluID0gMTA0
LCAubWF4ID0gMTM4IH0sCi0JLm0xID0geyAubWluID0gMTcsIC5tYXggPSAyMyB9LAotCS5tMiA9
IHsgLm1pbiA9IDUsIC5tYXggPSAxMSB9LAotCS5wID0geyAubWluID0gMTAsIC5tYXggPSAzMCB9
LAotCS5wMSA9IHsgLm1pbiA9IDEsIC5tYXggPSAzfSwKLQkucDIgPSB7IC5kb3RfbGltaXQgPSAy
NzAwMDAsCi0JCS5wMl9zbG93ID0gMTAsCi0JCS5wMl9mYXN0ID0gMTAKLQl9LAotfTsKLQotc3Rh
dGljIGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCBpbnRlbF9saW1pdHNfZzR4X2hkbWkgPSB7Ci0J
LmRvdCA9IHsgLm1pbiA9IDIyMDAwLCAubWF4ID0gNDAwMDAwIH0sCi0JLnZjbyA9IHsgLm1pbiA9
IDE3NTAwMDAsIC5tYXggPSAzNTAwMDAwfSwKLQkubiA9IHsgLm1pbiA9IDEsIC5tYXggPSA0IH0s
Ci0JLm0gPSB7IC5taW4gPSAxMDQsIC5tYXggPSAxMzggfSwKLQkubTEgPSB7IC5taW4gPSAxNiwg
Lm1heCA9IDIzIH0sCi0JLm0yID0geyAubWluID0gNSwgLm1heCA9IDExIH0sCi0JLnAgPSB7IC5t
aW4gPSA1LCAubWF4ID0gODAgfSwKLQkucDEgPSB7IC5taW4gPSAxLCAubWF4ID0gOH0sCi0JLnAy
ID0geyAuZG90X2xpbWl0ID0gMTY1MDAwLAotCQkucDJfc2xvdyA9IDEwLCAucDJfZmFzdCA9IDUg
fSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaW50ZWxfbGltaXRzX2c0
eF9zaW5nbGVfY2hhbm5lbF9sdmRzID0gewotCS5kb3QgPSB7IC5taW4gPSAyMDAwMCwgLm1heCA9
IDExNTAwMCB9LAotCS52Y28gPSB7IC5taW4gPSAxNzUwMDAwLCAubWF4ID0gMzUwMDAwMCB9LAot
CS5uID0geyAubWluID0gMSwgLm1heCA9IDMgfSwKLQkubSA9IHsgLm1pbiA9IDEwNCwgLm1heCA9
IDEzOCB9LAotCS5tMSA9IHsgLm1pbiA9IDE3LCAubWF4ID0gMjMgfSwKLQkubTIgPSB7IC5taW4g
PSA1LCAubWF4ID0gMTEgfSwKLQkucCA9IHsgLm1pbiA9IDI4LCAubWF4ID0gMTEyIH0sCi0JLnAx
ID0geyAubWluID0gMiwgLm1heCA9IDggfSwKLQkucDIgPSB7IC5kb3RfbGltaXQgPSAwLAotCQku
cDJfc2xvdyA9IDE0LCAucDJfZmFzdCA9IDE0Ci0JfSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1
Y3QgaW50ZWxfbGltaXQgaW50ZWxfbGltaXRzX2c0eF9kdWFsX2NoYW5uZWxfbHZkcyA9IHsKLQku
ZG90ID0geyAubWluID0gODAwMDAsIC5tYXggPSAyMjQwMDAgfSwKLQkudmNvID0geyAubWluID0g
MTc1MDAwMCwgLm1heCA9IDM1MDAwMDAgfSwKLQkubiA9IHsgLm1pbiA9IDEsIC5tYXggPSAzIH0s
Ci0JLm0gPSB7IC5taW4gPSAxMDQsIC5tYXggPSAxMzggfSwKLQkubTEgPSB7IC5taW4gPSAxNywg
Lm1heCA9IDIzIH0sCi0JLm0yID0geyAubWluID0gNSwgLm1heCA9IDExIH0sCi0JLnAgPSB7IC5t
aW4gPSAxNCwgLm1heCA9IDQyIH0sCi0JLnAxID0geyAubWluID0gMiwgLm1heCA9IDYgfSwKLQku
cDIgPSB7IC5kb3RfbGltaXQgPSAwLAotCQkucDJfc2xvdyA9IDcsIC5wMl9mYXN0ID0gNwotCX0s
Ci19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2xpbWl0IHBudl9saW1pdHNfc2R2byA9
IHsKLQkuZG90ID0geyAubWluID0gMjAwMDAsIC5tYXggPSA0MDAwMDB9LAotCS52Y28gPSB7IC5t
aW4gPSAxNzAwMDAwLCAubWF4ID0gMzUwMDAwMCB9LAotCS8qIFBpbmV2aWV3J3MgTmNvdW50ZXIg
aXMgYSByaW5nIGNvdW50ZXIgKi8KLQkubiA9IHsgLm1pbiA9IDMsIC5tYXggPSA2IH0sCi0JLm0g
PSB7IC5taW4gPSAyLCAubWF4ID0gMjU2IH0sCi0JLyogUGluZXZpZXcgb25seSBoYXMgb25lIGNv
bWJpbmVkIG0gZGl2aWRlciwgd2hpY2ggd2UgdHJlYXQgYXMgbTIuICovCi0JLm0xID0geyAubWlu
ID0gMCwgLm1heCA9IDAgfSwKLQkubTIgPSB7IC5taW4gPSAwLCAubWF4ID0gMjU0IH0sCi0JLnAg
PSB7IC5taW4gPSA1LCAubWF4ID0gODAgfSwKLQkucDEgPSB7IC5taW4gPSAxLCAubWF4ID0gOCB9
LAotCS5wMiA9IHsgLmRvdF9saW1pdCA9IDIwMDAwMCwKLQkJLnAyX3Nsb3cgPSAxMCwgLnAyX2Zh
c3QgPSA1IH0sCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2xpbWl0IHBudl9saW1p
dHNfbHZkcyA9IHsKLQkuZG90ID0geyAubWluID0gMjAwMDAsIC5tYXggPSA0MDAwMDAgfSwKLQku
dmNvID0geyAubWluID0gMTcwMDAwMCwgLm1heCA9IDM1MDAwMDAgfSwKLQkubiA9IHsgLm1pbiA9
IDMsIC5tYXggPSA2IH0sCi0JLm0gPSB7IC5taW4gPSAyLCAubWF4ID0gMjU2IH0sCi0JLm0xID0g
eyAubWluID0gMCwgLm1heCA9IDAgfSwKLQkubTIgPSB7IC5taW4gPSAwLCAubWF4ID0gMjU0IH0s
Ci0JLnAgPSB7IC5taW4gPSA3LCAubWF4ID0gMTEyIH0sCi0JLnAxID0geyAubWluID0gMSwgLm1h
eCA9IDggfSwKLQkucDIgPSB7IC5kb3RfbGltaXQgPSAxMTIwMDAsCi0JCS5wMl9zbG93ID0gMTQs
IC5wMl9mYXN0ID0gMTQgfSwKLX07Ci0KLS8qIElyb25sYWtlIC8gU2FuZHlicmlkZ2UKLSAqCi0g
KiBXZSBjYWxjdWxhdGUgY2xvY2sgdXNpbmcgKHJlZ2lzdGVyX3ZhbHVlICsgMikgZm9yIE4vTTEv
TTIsIHNvIGhlcmUKLSAqIHRoZSByYW5nZSB2YWx1ZSBmb3IgdGhlbSBpcyAoYWN0dWFsX3ZhbHVl
IC0gMikuCi0gKi8KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaWxrX2xpbWl0c19k
YWMgPSB7Ci0JLmRvdCA9IHsgLm1pbiA9IDI1MDAwLCAubWF4ID0gMzUwMDAwIH0sCi0JLnZjbyA9
IHsgLm1pbiA9IDE3NjAwMDAsIC5tYXggPSAzNTEwMDAwIH0sCi0JLm4gPSB7IC5taW4gPSAxLCAu
bWF4ID0gNSB9LAotCS5tID0geyAubWluID0gNzksIC5tYXggPSAxMjcgfSwKLQkubTEgPSB7IC5t
aW4gPSAxMiwgLm1heCA9IDIyIH0sCi0JLm0yID0geyAubWluID0gNSwgLm1heCA9IDkgfSwKLQku
cCA9IHsgLm1pbiA9IDUsIC5tYXggPSA4MCB9LAotCS5wMSA9IHsgLm1pbiA9IDEsIC5tYXggPSA4
IH0sCi0JLnAyID0geyAuZG90X2xpbWl0ID0gMjI1MDAwLAotCQkucDJfc2xvdyA9IDEwLCAucDJf
ZmFzdCA9IDUgfSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaWxrX2xp
bWl0c19zaW5nbGVfbHZkcyA9IHsKLQkuZG90ID0geyAubWluID0gMjUwMDAsIC5tYXggPSAzNTAw
MDAgfSwKLQkudmNvID0geyAubWluID0gMTc2MDAwMCwgLm1heCA9IDM1MTAwMDAgfSwKLQkubiA9
IHsgLm1pbiA9IDEsIC5tYXggPSAzIH0sCi0JLm0gPSB7IC5taW4gPSA3OSwgLm1heCA9IDExOCB9
LAotCS5tMSA9IHsgLm1pbiA9IDEyLCAubWF4ID0gMjIgfSwKLQkubTIgPSB7IC5taW4gPSA1LCAu
bWF4ID0gOSB9LAotCS5wID0geyAubWluID0gMjgsIC5tYXggPSAxMTIgfSwKLQkucDEgPSB7IC5t
aW4gPSAyLCAubWF4ID0gOCB9LAotCS5wMiA9IHsgLmRvdF9saW1pdCA9IDIyNTAwMCwKLQkJLnAy
X3Nsb3cgPSAxNCwgLnAyX2Zhc3QgPSAxNCB9LAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBp
bnRlbF9saW1pdCBpbGtfbGltaXRzX2R1YWxfbHZkcyA9IHsKLQkuZG90ID0geyAubWluID0gMjUw
MDAsIC5tYXggPSAzNTAwMDAgfSwKLQkudmNvID0geyAubWluID0gMTc2MDAwMCwgLm1heCA9IDM1
MTAwMDAgfSwKLQkubiA9IHsgLm1pbiA9IDEsIC5tYXggPSAzIH0sCi0JLm0gPSB7IC5taW4gPSA3
OSwgLm1heCA9IDEyNyB9LAotCS5tMSA9IHsgLm1pbiA9IDEyLCAubWF4ID0gMjIgfSwKLQkubTIg
PSB7IC5taW4gPSA1LCAubWF4ID0gOSB9LAotCS5wID0geyAubWluID0gMTQsIC5tYXggPSA1NiB9
LAotCS5wMSA9IHsgLm1pbiA9IDIsIC5tYXggPSA4IH0sCi0JLnAyID0geyAuZG90X2xpbWl0ID0g
MjI1MDAwLAotCQkucDJfc2xvdyA9IDcsIC5wMl9mYXN0ID0gNyB9LAotfTsKLQotLyogTFZEUyAx
MDBtaHogcmVmY2xrIGxpbWl0cy4gKi8KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQg
aWxrX2xpbWl0c19zaW5nbGVfbHZkc18xMDBtID0gewotCS5kb3QgPSB7IC5taW4gPSAyNTAwMCwg
Lm1heCA9IDM1MDAwMCB9LAotCS52Y28gPSB7IC5taW4gPSAxNzYwMDAwLCAubWF4ID0gMzUxMDAw
MCB9LAotCS5uID0geyAubWluID0gMSwgLm1heCA9IDIgfSwKLQkubSA9IHsgLm1pbiA9IDc5LCAu
bWF4ID0gMTI2IH0sCi0JLm0xID0geyAubWluID0gMTIsIC5tYXggPSAyMiB9LAotCS5tMiA9IHsg
Lm1pbiA9IDUsIC5tYXggPSA5IH0sCi0JLnAgPSB7IC5taW4gPSAyOCwgLm1heCA9IDExMiB9LAot
CS5wMSA9IHsgLm1pbiA9IDIsIC5tYXggPSA4IH0sCi0JLnAyID0geyAuZG90X2xpbWl0ID0gMjI1
MDAwLAotCQkucDJfc2xvdyA9IDE0LCAucDJfZmFzdCA9IDE0IH0sCi19OwotCi1zdGF0aWMgY29u
c3Qgc3RydWN0IGludGVsX2xpbWl0IGlsa19saW1pdHNfZHVhbF9sdmRzXzEwMG0gPSB7Ci0JLmRv
dCA9IHsgLm1pbiA9IDI1MDAwLCAubWF4ID0gMzUwMDAwIH0sCi0JLnZjbyA9IHsgLm1pbiA9IDE3
NjAwMDAsIC5tYXggPSAzNTEwMDAwIH0sCi0JLm4gPSB7IC5taW4gPSAxLCAubWF4ID0gMyB9LAot
CS5tID0geyAubWluID0gNzksIC5tYXggPSAxMjYgfSwKLQkubTEgPSB7IC5taW4gPSAxMiwgLm1h
eCA9IDIyIH0sCi0JLm0yID0geyAubWluID0gNSwgLm1heCA9IDkgfSwKLQkucCA9IHsgLm1pbiA9
IDE0LCAubWF4ID0gNDIgfSwKLQkucDEgPSB7IC5taW4gPSAyLCAubWF4ID0gNiB9LAotCS5wMiA9
IHsgLmRvdF9saW1pdCA9IDIyNTAwMCwKLQkJLnAyX3Nsb3cgPSA3LCAucDJfZmFzdCA9IDcgfSwK
LX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaW50ZWxfbGltaXRzX3ZsdiA9
IHsKLQkgLyoKLQkgICogVGhlc2UgYXJlIHRoZSBkYXRhIHJhdGUgbGltaXRzIChtZWFzdXJlZCBp
biBmYXN0IGNsb2NrcykKLQkgICogc2luY2UgdGhvc2UgYXJlIHRoZSBzdHJpY3Rlc3QgbGltaXRz
IHdlIGhhdmUuIFRoZSBmYXN0Ci0JICAqIGNsb2NrIGFuZCBhY3R1YWwgcmF0ZSBsaW1pdHMgYXJl
IG1vcmUgcmVsYXhlZCwgc28gY2hlY2tpbmcKLQkgICogdGhlbSB3b3VsZCBtYWtlIG5vIGRpZmZl
cmVuY2UuCi0JICAqLwotCS5kb3QgPSB7IC5taW4gPSAyNTAwMCAqIDUsIC5tYXggPSAyNzAwMDAg
KiA1IH0sCi0JLnZjbyA9IHsgLm1pbiA9IDQwMDAwMDAsIC5tYXggPSA2MDAwMDAwIH0sCi0JLm4g
PSB7IC5taW4gPSAxLCAubWF4ID0gNyB9LAotCS5tMSA9IHsgLm1pbiA9IDIsIC5tYXggPSAzIH0s
Ci0JLm0yID0geyAubWluID0gMTEsIC5tYXggPSAxNTYgfSwKLQkucDEgPSB7IC5taW4gPSAyLCAu
bWF4ID0gMyB9LAotCS5wMiA9IHsgLnAyX3Nsb3cgPSAyLCAucDJfZmFzdCA9IDIwIH0sIC8qIHNs
b3c9bWluLCBmYXN0PW1heCAqLwotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9saW1p
dCBpbnRlbF9saW1pdHNfY2h2ID0gewotCS8qCi0JICogVGhlc2UgYXJlIHRoZSBkYXRhIHJhdGUg
bGltaXRzIChtZWFzdXJlZCBpbiBmYXN0IGNsb2NrcykKLQkgKiBzaW5jZSB0aG9zZSBhcmUgdGhl
IHN0cmljdGVzdCBsaW1pdHMgd2UgaGF2ZS4gIFRoZSBmYXN0Ci0JICogY2xvY2sgYW5kIGFjdHVh
bCByYXRlIGxpbWl0cyBhcmUgbW9yZSByZWxheGVkLCBzbyBjaGVja2luZwotCSAqIHRoZW0gd291
bGQgbWFrZSBubyBkaWZmZXJlbmNlLgotCSAqLwotCS5kb3QgPSB7IC5taW4gPSAyNTAwMCAqIDUs
IC5tYXggPSA1NDAwMDAgKiA1fSwKLQkudmNvID0geyAubWluID0gNDgwMDAwMCwgLm1heCA9IDY0
ODAwMDAgfSwKLQkubiA9IHsgLm1pbiA9IDEsIC5tYXggPSAxIH0sCi0JLm0xID0geyAubWluID0g
MiwgLm1heCA9IDIgfSwKLQkubTIgPSB7IC5taW4gPSAyNCA8PCAyMiwgLm1heCA9IDE3NSA8PCAy
MiB9LAotCS5wMSA9IHsgLm1pbiA9IDIsIC5tYXggPSA0IH0sCi0JLnAyID0gewkucDJfc2xvdyA9
IDEsIC5wMl9mYXN0ID0gMTQgfSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGlt
aXQgaW50ZWxfbGltaXRzX2J4dCA9IHsKLQkvKiBGSVhNRTogZmluZCByZWFsIGRvdCBsaW1pdHMg
Ki8KLQkuZG90ID0geyAubWluID0gMCwgLm1heCA9IElOVF9NQVggfSwKLQkudmNvID0geyAubWlu
ID0gNDgwMDAwMCwgLm1heCA9IDY3MDAwMDAgfSwKLQkubiA9IHsgLm1pbiA9IDEsIC5tYXggPSAx
IH0sCi0JLm0xID0geyAubWluID0gMiwgLm1heCA9IDIgfSwKLQkvKiBGSVhNRTogZmluZCByZWFs
IG0yIGxpbWl0cyAqLwotCS5tMiA9IHsgLm1pbiA9IDIgPDwgMjIsIC5tYXggPSAyNTUgPDwgMjIg
fSwKLQkucDEgPSB7IC5taW4gPSAyLCAubWF4ID0gNCB9LAotCS5wMiA9IHsgLnAyX3Nsb3cgPSAx
LCAucDJfZmFzdCA9IDIwIH0sCi19OwotCiAvKiBXQSBEaXNwbGF5ICMwODI3OiBHZW45OmFsbCAq
Lwogc3RhdGljIHZvaWQKIHNrbF93YV84Mjcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LCBlbnVtIHBpcGUgcGlwZSwgYm9vbCBlbmFibGUpCkBAIC01MDEsNDgzICsyMjYsNiBAQCBp
c190cmFuc19wb3J0X3N5bmNfbW9kZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIAkJaXNfdHJhbnNfcG9ydF9zeW5jX3NsYXZlKGNydGNfc3RhdGUpOwogfQogCi0v
KgotICogUGxhdGZvcm0gc3BlY2lmaWMgaGVscGVycyB0byBjYWxjdWxhdGUgdGhlIHBvcnQgUExM
IGxvb3BiYWNrLSAoY2xvY2subSksCi0gKiBhbmQgcG9zdC1kaXZpZGVyIChjbG9jay5wKSB2YWx1
ZXMsIHByZS0gKGNsb2NrLnZjbykgYW5kIHBvc3QtZGl2aWRlZCBmYXN0Ci0gKiAoY2xvY2suZG90
KSBjbG9jayByYXRlcy4gVGhpcyBmYXN0IGRvdCBjbG9jayBpcyBmZWQgdG8gdGhlIHBvcnQncyBJ
TyBsb2dpYy4KLSAqIFRoZSBoZWxwZXJzJyByZXR1cm4gdmFsdWUgaXMgdGhlIHJhdGUgb2YgdGhl
IGNsb2NrIHRoYXQgaXMgZmVkIHRvIHRoZQotICogZGlzcGxheSBlbmdpbmUncyBwaXBlIHdoaWNo
IGNhbiBiZSB0aGUgYWJvdmUgZmFzdCBkb3QgY2xvY2sgcmF0ZSBvciBhCi0gKiBkaXZpZGVkLWRv
d24gdmVyc2lvbiBvZiBpdC4KLSAqLwotLyogbTEgaXMgcmVzZXJ2ZWQgYXMgMCBpbiBQaW5ldmll
dywgbiBpcyBhIHJpbmcgY291bnRlciAqLwotc3RhdGljIGludCBwbnZfY2FsY19kcGxsX3BhcmFt
cyhpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqY2xvY2spCi17Ci0JY2xvY2stPm0gPSBjbG9jay0+
bTIgKyAyOwotCWNsb2NrLT5wID0gY2xvY2stPnAxICogY2xvY2stPnAyOwotCWlmIChXQVJOX09O
KGNsb2NrLT5uID09IDAgfHwgY2xvY2stPnAgPT0gMCkpCi0JCXJldHVybiAwOwotCWNsb2NrLT52
Y28gPSBESVZfUk9VTkRfQ0xPU0VTVChyZWZjbGsgKiBjbG9jay0+bSwgY2xvY2stPm4pOwotCWNs
b2NrLT5kb3QgPSBESVZfUk9VTkRfQ0xPU0VTVChjbG9jay0+dmNvLCBjbG9jay0+cCk7Ci0KLQly
ZXR1cm4gY2xvY2stPmRvdDsKLX0KLQotc3RhdGljIHUzMiBpOXh4X2RwbGxfY29tcHV0ZV9tKHN0
cnVjdCBkcGxsICpkcGxsKQotewotCXJldHVybiA1ICogKGRwbGwtPm0xICsgMikgKyAoZHBsbC0+
bTIgKyAyKTsKLX0KLQotc3RhdGljIGludCBpOXh4X2NhbGNfZHBsbF9wYXJhbXMoaW50IHJlZmNs
aywgc3RydWN0IGRwbGwgKmNsb2NrKQotewotCWNsb2NrLT5tID0gaTl4eF9kcGxsX2NvbXB1dGVf
bShjbG9jayk7Ci0JY2xvY2stPnAgPSBjbG9jay0+cDEgKiBjbG9jay0+cDI7Ci0JaWYgKFdBUk5f
T04oY2xvY2stPm4gKyAyID09IDAgfHwgY2xvY2stPnAgPT0gMCkpCi0JCXJldHVybiAwOwotCWNs
b2NrLT52Y28gPSBESVZfUk9VTkRfQ0xPU0VTVChyZWZjbGsgKiBjbG9jay0+bSwgY2xvY2stPm4g
KyAyKTsKLQljbG9jay0+ZG90ID0gRElWX1JPVU5EX0NMT1NFU1QoY2xvY2stPnZjbywgY2xvY2st
PnApOwotCi0JcmV0dXJuIGNsb2NrLT5kb3Q7Ci19Ci0KLXN0YXRpYyBpbnQgdmx2X2NhbGNfZHBs
bF9wYXJhbXMoaW50IHJlZmNsaywgc3RydWN0IGRwbGwgKmNsb2NrKQotewotCWNsb2NrLT5tID0g
Y2xvY2stPm0xICogY2xvY2stPm0yOwotCWNsb2NrLT5wID0gY2xvY2stPnAxICogY2xvY2stPnAy
OwotCWlmIChXQVJOX09OKGNsb2NrLT5uID09IDAgfHwgY2xvY2stPnAgPT0gMCkpCi0JCXJldHVy
biAwOwotCWNsb2NrLT52Y28gPSBESVZfUk9VTkRfQ0xPU0VTVChyZWZjbGsgKiBjbG9jay0+bSwg
Y2xvY2stPm4pOwotCWNsb2NrLT5kb3QgPSBESVZfUk9VTkRfQ0xPU0VTVChjbG9jay0+dmNvLCBj
bG9jay0+cCk7Ci0KLQlyZXR1cm4gY2xvY2stPmRvdCAvIDU7Ci19Ci0KLWludCBjaHZfY2FsY19k
cGxsX3BhcmFtcyhpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqY2xvY2spCi17Ci0JY2xvY2stPm0g
PSBjbG9jay0+bTEgKiBjbG9jay0+bTI7Ci0JY2xvY2stPnAgPSBjbG9jay0+cDEgKiBjbG9jay0+
cDI7Ci0JaWYgKFdBUk5fT04oY2xvY2stPm4gPT0gMCB8fCBjbG9jay0+cCA9PSAwKSkKLQkJcmV0
dXJuIDA7Ci0JY2xvY2stPnZjbyA9IERJVl9ST1VORF9DTE9TRVNUX1VMTChtdWxfdTMyX3UzMihy
ZWZjbGssIGNsb2NrLT5tKSwKLQkJCQkJICAgY2xvY2stPm4gPDwgMjIpOwotCWNsb2NrLT5kb3Qg
PSBESVZfUk9VTkRfQ0xPU0VTVChjbG9jay0+dmNvLCBjbG9jay0+cCk7Ci0KLQlyZXR1cm4gY2xv
Y2stPmRvdCAvIDU7Ci19Ci0KLS8qCi0gKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGdpdmVuIHNldCBv
ZiBkaXZpc29ycyBhcmUgdmFsaWQgZm9yIGEgZ2l2ZW4gcmVmY2xrIHdpdGgKLSAqIHRoZSBnaXZl
biBjb25uZWN0b3JzLgotICovCi1zdGF0aWMgYm9vbCBpbnRlbF9wbGxfaXNfdmFsaWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9saW1pdCAqbGltaXQsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGRwbGwgKmNsb2NrKQotewot
CWlmIChjbG9jay0+biA8IGxpbWl0LT5uLm1pbiB8fCBsaW1pdC0+bi5tYXggPCBjbG9jay0+bikK
LQkJcmV0dXJuIGZhbHNlOwotCWlmIChjbG9jay0+cDEgPCBsaW1pdC0+cDEubWluIHx8IGxpbWl0
LT5wMS5tYXggPCBjbG9jay0+cDEpCi0JCXJldHVybiBmYWxzZTsKLQlpZiAoY2xvY2stPm0yIDwg
bGltaXQtPm0yLm1pbiB8fCBsaW1pdC0+bTIubWF4IDwgY2xvY2stPm0yKQotCQlyZXR1cm4gZmFs
c2U7Ci0JaWYgKGNsb2NrLT5tMSA8IGxpbWl0LT5tMS5taW4gfHwgbGltaXQtPm0xLm1heCA8IGNs
b2NrLT5tMSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JaWYgKCFJU19QSU5FVklFVyhkZXZfcHJpdikg
JiYgIUlTX1ZBTExFWVZJRVcoZGV2X3ByaXYpICYmCi0JICAgICFJU19DSEVSUllWSUVXKGRldl9w
cml2KSAmJiAhSVNfR0VOOV9MUChkZXZfcHJpdikpCi0JCWlmIChjbG9jay0+bTEgPD0gY2xvY2st
Pm0yKQotCQkJcmV0dXJuIGZhbHNlOwotCi0JaWYgKCFJU19WQUxMRVlWSUVXKGRldl9wcml2KSAm
JiAhSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgJiYKLQkgICAgIUlTX0dFTjlfTFAoZGV2X3ByaXYp
KSB7Ci0JCWlmIChjbG9jay0+cCA8IGxpbWl0LT5wLm1pbiB8fCBsaW1pdC0+cC5tYXggPCBjbG9j
ay0+cCkKLQkJCXJldHVybiBmYWxzZTsKLQkJaWYgKGNsb2NrLT5tIDwgbGltaXQtPm0ubWluIHx8
IGxpbWl0LT5tLm1heCA8IGNsb2NrLT5tKQotCQkJcmV0dXJuIGZhbHNlOwotCX0KLQotCWlmIChj
bG9jay0+dmNvIDwgbGltaXQtPnZjby5taW4gfHwgbGltaXQtPnZjby5tYXggPCBjbG9jay0+dmNv
KQotCQlyZXR1cm4gZmFsc2U7Ci0JLyogWFhYOiBXZSBtYXkgbmVlZCB0byBiZSBjaGVja2luZyAi
RG90IGNsb2NrIiBkZXBlbmRpbmcgb24gdGhlIG11bHRpcGxpZXIsCi0JICogY29ubmVjdG9yLCBl
dGMuLCByYXRoZXIgdGhhbiBqdXN0IGEgc2luZ2xlIHJhbmdlLgotCSAqLwotCWlmIChjbG9jay0+
ZG90IDwgbGltaXQtPmRvdC5taW4gfHwgbGltaXQtPmRvdC5tYXggPCBjbG9jay0+ZG90KQotCQly
ZXR1cm4gZmFsc2U7Ci0KLQlyZXR1cm4gdHJ1ZTsKLX0KLQotc3RhdGljIGludAotaTl4eF9zZWxl
Y3RfcDJfZGl2KGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGltaXQsCi0JCSAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkgICBpbnQgdGFyZ2V0KQotewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjLT5kZXYpOwotCi0JaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwg
SU5URUxfT1VUUFVUX0xWRFMpKSB7Ci0JCS8qCi0JCSAqIEZvciBMVkRTIGp1c3QgcmVseSBvbiBp
dHMgY3VycmVudCBzZXR0aW5ncyBmb3IgZHVhbC1jaGFubmVsLgotCQkgKiBXZSBoYXZlbid0IGZp
Z3VyZWQgb3V0IGhvdyB0byByZWxpYWJseSBzZXQgdXAgZGlmZmVyZW50Ci0JCSAqIHNpbmdsZS9k
dWFsIGNoYW5uZWwgc3RhdGUsIGlmIHdlIGV2ZW4gY2FuLgotCQkgKi8KLQkJaWYgKGludGVsX2lz
X2R1YWxfbGlua19sdmRzKGRldl9wcml2KSkKLQkJCXJldHVybiBsaW1pdC0+cDIucDJfZmFzdDsK
LQkJZWxzZQotCQkJcmV0dXJuIGxpbWl0LT5wMi5wMl9zbG93OwotCX0gZWxzZSB7Ci0JCWlmICh0
YXJnZXQgPCBsaW1pdC0+cDIuZG90X2xpbWl0KQotCQkJcmV0dXJuIGxpbWl0LT5wMi5wMl9zbG93
OwotCQllbHNlCi0JCQlyZXR1cm4gbGltaXQtPnAyLnAyX2Zhc3Q7Ci0JfQotfQotCi0vKgotICog
UmV0dXJucyBhIHNldCBvZiBkaXZpc29ycyBmb3IgdGhlIGRlc2lyZWQgdGFyZ2V0IGNsb2NrIHdp
dGggdGhlIGdpdmVuCi0gKiByZWZjbGssIG9yIEZBTFNFLiAgVGhlIHJldHVybmVkIHZhbHVlcyBy
ZXByZXNlbnQgdGhlIGNsb2NrIGVxdWF0aW9uOgotICogcmVmbGNrICogKDUgKiAobTEgKyAyKSAr
IChtMiArIDIpKSAvIChuICsgMikgLyBwMSAvIHAyLgotICoKLSAqIFRhcmdldCBhbmQgcmVmZXJl
bmNlIGNsb2NrcyBhcmUgc3BlY2lmaWVkIGluIGtIei4KLSAqCi0gKiBJZiBtYXRjaF9jbG9jayBp
cyBwcm92aWRlZCwgdGhlbiBiZXN0X2Nsb2NrIFAgZGl2aWRlciBtdXN0IG1hdGNoIHRoZSBQCi0g
KiBkaXZpZGVyIGZyb20gQG1hdGNoX2Nsb2NrIHVzZWQgZm9yIExWRFMgZG93bmNsb2NraW5nLgot
ICovCi1zdGF0aWMgYm9vbAotaTl4eF9maW5kX2Jlc3RfZHBsbChjb25zdCBzdHJ1Y3QgaW50ZWxf
bGltaXQgKmxpbWl0LAotCQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
Ci0JCSAgICBpbnQgdGFyZ2V0LCBpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqbWF0Y2hfY2xvY2ss
Ci0JCSAgICBzdHJ1Y3QgZHBsbCAqYmVzdF9jbG9jaykKLXsKLQlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXY7Ci0Jc3RydWN0IGRwbGwgY2xvY2s7Ci0J
aW50IGVyciA9IHRhcmdldDsKLQotCW1lbXNldChiZXN0X2Nsb2NrLCAwLCBzaXplb2YoKmJlc3Rf
Y2xvY2spKTsKLQotCWNsb2NrLnAyID0gaTl4eF9zZWxlY3RfcDJfZGl2KGxpbWl0LCBjcnRjX3N0
YXRlLCB0YXJnZXQpOwotCi0JZm9yIChjbG9jay5tMSA9IGxpbWl0LT5tMS5taW47IGNsb2NrLm0x
IDw9IGxpbWl0LT5tMS5tYXg7Ci0JICAgICBjbG9jay5tMSsrKSB7Ci0JCWZvciAoY2xvY2subTIg
PSBsaW1pdC0+bTIubWluOwotCQkgICAgIGNsb2NrLm0yIDw9IGxpbWl0LT5tMi5tYXg7IGNsb2Nr
Lm0yKyspIHsKLQkJCWlmIChjbG9jay5tMiA+PSBjbG9jay5tMSkKLQkJCQlicmVhazsKLQkJCWZv
ciAoY2xvY2subiA9IGxpbWl0LT5uLm1pbjsKLQkJCSAgICAgY2xvY2subiA8PSBsaW1pdC0+bi5t
YXg7IGNsb2NrLm4rKykgewotCQkJCWZvciAoY2xvY2sucDEgPSBsaW1pdC0+cDEubWluOwotCQkJ
CQljbG9jay5wMSA8PSBsaW1pdC0+cDEubWF4OyBjbG9jay5wMSsrKSB7Ci0JCQkJCWludCB0aGlz
X2VycjsKLQotCQkJCQlpOXh4X2NhbGNfZHBsbF9wYXJhbXMocmVmY2xrLCAmY2xvY2spOwotCQkJ
CQlpZiAoIWludGVsX3BsbF9pc192YWxpZCh0b19pOTE1KGRldiksCi0JCQkJCQkJCWxpbWl0LAot
CQkJCQkJCQkmY2xvY2spKQotCQkJCQkJY29udGludWU7Ci0JCQkJCWlmIChtYXRjaF9jbG9jayAm
JgotCQkJCQkgICAgY2xvY2sucCAhPSBtYXRjaF9jbG9jay0+cCkKLQkJCQkJCWNvbnRpbnVlOwot
Ci0JCQkJCXRoaXNfZXJyID0gYWJzKGNsb2NrLmRvdCAtIHRhcmdldCk7Ci0JCQkJCWlmICh0aGlz
X2VyciA8IGVycikgewotCQkJCQkJKmJlc3RfY2xvY2sgPSBjbG9jazsKLQkJCQkJCWVyciA9IHRo
aXNfZXJyOwotCQkJCQl9Ci0JCQkJfQotCQkJfQotCQl9Ci0JfQotCi0JcmV0dXJuIChlcnIgIT0g
dGFyZ2V0KTsKLX0KLQotLyoKLSAqIFJldHVybnMgYSBzZXQgb2YgZGl2aXNvcnMgZm9yIHRoZSBk
ZXNpcmVkIHRhcmdldCBjbG9jayB3aXRoIHRoZSBnaXZlbgotICogcmVmY2xrLCBvciBGQUxTRS4g
IFRoZSByZXR1cm5lZCB2YWx1ZXMgcmVwcmVzZW50IHRoZSBjbG9jayBlcXVhdGlvbjoKLSAqIHJl
ZmxjayAqICg1ICogKG0xICsgMikgKyAobTIgKyAyKSkgLyAobiArIDIpIC8gcDEgLyBwMi4KLSAq
Ci0gKiBUYXJnZXQgYW5kIHJlZmVyZW5jZSBjbG9ja3MgYXJlIHNwZWNpZmllZCBpbiBrSHouCi0g
KgotICogSWYgbWF0Y2hfY2xvY2sgaXMgcHJvdmlkZWQsIHRoZW4gYmVzdF9jbG9jayBQIGRpdmlk
ZXIgbXVzdCBtYXRjaCB0aGUgUAotICogZGl2aWRlciBmcm9tIEBtYXRjaF9jbG9jayB1c2VkIGZv
ciBMVkRTIGRvd25jbG9ja2luZy4KLSAqLwotc3RhdGljIGJvb2wKLXBudl9maW5kX2Jlc3RfZHBs
bChjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0LAotCQkgICBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJICAgaW50IHRhcmdldCwgaW50IHJlZmNsaywgc3RydWN0
IGRwbGwgKm1hdGNoX2Nsb2NrLAotCQkgICBzdHJ1Y3QgZHBsbCAqYmVzdF9jbG9jaykKLXsKLQlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXY7Ci0Jc3Ry
dWN0IGRwbGwgY2xvY2s7Ci0JaW50IGVyciA9IHRhcmdldDsKLQotCW1lbXNldChiZXN0X2Nsb2Nr
LCAwLCBzaXplb2YoKmJlc3RfY2xvY2spKTsKLQotCWNsb2NrLnAyID0gaTl4eF9zZWxlY3RfcDJf
ZGl2KGxpbWl0LCBjcnRjX3N0YXRlLCB0YXJnZXQpOwotCi0JZm9yIChjbG9jay5tMSA9IGxpbWl0
LT5tMS5taW47IGNsb2NrLm0xIDw9IGxpbWl0LT5tMS5tYXg7Ci0JICAgICBjbG9jay5tMSsrKSB7
Ci0JCWZvciAoY2xvY2subTIgPSBsaW1pdC0+bTIubWluOwotCQkgICAgIGNsb2NrLm0yIDw9IGxp
bWl0LT5tMi5tYXg7IGNsb2NrLm0yKyspIHsKLQkJCWZvciAoY2xvY2subiA9IGxpbWl0LT5uLm1p
bjsKLQkJCSAgICAgY2xvY2subiA8PSBsaW1pdC0+bi5tYXg7IGNsb2NrLm4rKykgewotCQkJCWZv
ciAoY2xvY2sucDEgPSBsaW1pdC0+cDEubWluOwotCQkJCQljbG9jay5wMSA8PSBsaW1pdC0+cDEu
bWF4OyBjbG9jay5wMSsrKSB7Ci0JCQkJCWludCB0aGlzX2VycjsKLQotCQkJCQlwbnZfY2FsY19k
cGxsX3BhcmFtcyhyZWZjbGssICZjbG9jayk7Ci0JCQkJCWlmICghaW50ZWxfcGxsX2lzX3ZhbGlk
KHRvX2k5MTUoZGV2KSwKLQkJCQkJCQkJbGltaXQsCi0JCQkJCQkJCSZjbG9jaykpCi0JCQkJCQlj
b250aW51ZTsKLQkJCQkJaWYgKG1hdGNoX2Nsb2NrICYmCi0JCQkJCSAgICBjbG9jay5wICE9IG1h
dGNoX2Nsb2NrLT5wKQotCQkJCQkJY29udGludWU7Ci0KLQkJCQkJdGhpc19lcnIgPSBhYnMoY2xv
Y2suZG90IC0gdGFyZ2V0KTsKLQkJCQkJaWYgKHRoaXNfZXJyIDwgZXJyKSB7Ci0JCQkJCQkqYmVz
dF9jbG9jayA9IGNsb2NrOwotCQkJCQkJZXJyID0gdGhpc19lcnI7Ci0JCQkJCX0KLQkJCQl9Ci0J
CQl9Ci0JCX0KLQl9Ci0KLQlyZXR1cm4gKGVyciAhPSB0YXJnZXQpOwotfQotCi0vKgotICogUmV0
dXJucyBhIHNldCBvZiBkaXZpc29ycyBmb3IgdGhlIGRlc2lyZWQgdGFyZ2V0IGNsb2NrIHdpdGgg
dGhlIGdpdmVuCi0gKiByZWZjbGssIG9yIEZBTFNFLiAgVGhlIHJldHVybmVkIHZhbHVlcyByZXBy
ZXNlbnQgdGhlIGNsb2NrIGVxdWF0aW9uOgotICogcmVmbGNrICogKDUgKiAobTEgKyAyKSArICht
MiArIDIpKSAvIChuICsgMikgLyBwMSAvIHAyLgotICoKLSAqIFRhcmdldCBhbmQgcmVmZXJlbmNl
IGNsb2NrcyBhcmUgc3BlY2lmaWVkIGluIGtIei4KLSAqCi0gKiBJZiBtYXRjaF9jbG9jayBpcyBw
cm92aWRlZCwgdGhlbiBiZXN0X2Nsb2NrIFAgZGl2aWRlciBtdXN0IG1hdGNoIHRoZSBQCi0gKiBk
aXZpZGVyIGZyb20gQG1hdGNoX2Nsb2NrIHVzZWQgZm9yIExWRFMgZG93bmNsb2NraW5nLgotICov
Ci1zdGF0aWMgYm9vbAotZzR4X2ZpbmRfYmVzdF9kcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9saW1p
dCAqbGltaXQsCi0JCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkg
ICBpbnQgdGFyZ2V0LCBpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqbWF0Y2hfY2xvY2ssCi0JCSAg
IHN0cnVjdCBkcGxsICpiZXN0X2Nsb2NrKQotewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
cnRjX3N0YXRlLT51YXBpLmNydGMtPmRldjsKLQlzdHJ1Y3QgZHBsbCBjbG9jazsKLQlpbnQgbWF4
X247Ci0JYm9vbCBmb3VuZCA9IGZhbHNlOwotCS8qIGFwcHJveGltYXRlbHkgZXF1YWxzIHRhcmdl
dCAqIDAuMDA1ODUgKi8KLQlpbnQgZXJyX21vc3QgPSAodGFyZ2V0ID4+IDgpICsgKHRhcmdldCA+
PiA5KTsKLQotCW1lbXNldChiZXN0X2Nsb2NrLCAwLCBzaXplb2YoKmJlc3RfY2xvY2spKTsKLQot
CWNsb2NrLnAyID0gaTl4eF9zZWxlY3RfcDJfZGl2KGxpbWl0LCBjcnRjX3N0YXRlLCB0YXJnZXQp
OwotCi0JbWF4X24gPSBsaW1pdC0+bi5tYXg7Ci0JLyogYmFzZWQgb24gaGFyZHdhcmUgcmVxdWly
ZW1lbnQsIHByZWZlciBzbWFsbGVyIG4gdG8gcHJlY2lzaW9uICovCi0JZm9yIChjbG9jay5uID0g
bGltaXQtPm4ubWluOyBjbG9jay5uIDw9IG1heF9uOyBjbG9jay5uKyspIHsKLQkJLyogYmFzZWQg
b24gaGFyZHdhcmUgcmVxdWlyZW1lbnQsIHByZWZlcmUgbGFyZ2VyIG0xLG0yICovCi0JCWZvciAo
Y2xvY2subTEgPSBsaW1pdC0+bTEubWF4OwotCQkgICAgIGNsb2NrLm0xID49IGxpbWl0LT5tMS5t
aW47IGNsb2NrLm0xLS0pIHsKLQkJCWZvciAoY2xvY2subTIgPSBsaW1pdC0+bTIubWF4OwotCQkJ
ICAgICBjbG9jay5tMiA+PSBsaW1pdC0+bTIubWluOyBjbG9jay5tMi0tKSB7Ci0JCQkJZm9yIChj
bG9jay5wMSA9IGxpbWl0LT5wMS5tYXg7Ci0JCQkJICAgICBjbG9jay5wMSA+PSBsaW1pdC0+cDEu
bWluOyBjbG9jay5wMS0tKSB7Ci0JCQkJCWludCB0aGlzX2VycjsKLQotCQkJCQlpOXh4X2NhbGNf
ZHBsbF9wYXJhbXMocmVmY2xrLCAmY2xvY2spOwotCQkJCQlpZiAoIWludGVsX3BsbF9pc192YWxp
ZCh0b19pOTE1KGRldiksCi0JCQkJCQkJCWxpbWl0LAotCQkJCQkJCQkmY2xvY2spKQotCQkJCQkJ
Y29udGludWU7Ci0KLQkJCQkJdGhpc19lcnIgPSBhYnMoY2xvY2suZG90IC0gdGFyZ2V0KTsKLQkJ
CQkJaWYgKHRoaXNfZXJyIDwgZXJyX21vc3QpIHsKLQkJCQkJCSpiZXN0X2Nsb2NrID0gY2xvY2s7
Ci0JCQkJCQllcnJfbW9zdCA9IHRoaXNfZXJyOwotCQkJCQkJbWF4X24gPSBjbG9jay5uOwotCQkJ
CQkJZm91bmQgPSB0cnVlOwotCQkJCQl9Ci0JCQkJfQotCQkJfQotCQl9Ci0JfQotCXJldHVybiBm
b3VuZDsKLX0KLQotLyoKLSAqIENoZWNrIGlmIHRoZSBjYWxjdWxhdGVkIFBMTCBjb25maWd1cmF0
aW9uIGlzIG1vcmUgb3B0aW1hbCBjb21wYXJlZCB0byB0aGUKLSAqIGJlc3QgY29uZmlndXJhdGlv
biBhbmQgZXJyb3IgZm91bmQgc28gZmFyLiBSZXR1cm4gdGhlIGNhbGN1bGF0ZWQgZXJyb3IuCi0g
Ki8KLXN0YXRpYyBib29sIHZsdl9QTExfaXNfb3B0aW1hbChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCBpbnQgdGFyZ2V0X2ZyZXEsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGRwbGwgKmNhbGN1bGF0
ZWRfY2xvY2ssCi0JCQkgICAgICAgY29uc3Qgc3RydWN0IGRwbGwgKmJlc3RfY2xvY2ssCi0JCQkg
ICAgICAgdW5zaWduZWQgaW50IGJlc3RfZXJyb3JfcHBtLAotCQkJICAgICAgIHVuc2lnbmVkIGlu
dCAqZXJyb3JfcHBtKQotewotCS8qCi0JICogRm9yIENIViBpZ25vcmUgdGhlIGVycm9yIGFuZCBj
b25zaWRlciBvbmx5IHRoZSBQIHZhbHVlLgotCSAqIFByZWZlciBhIGJpZ2dlciBQIHZhbHVlIGJh
c2VkIG9uIEhXIHJlcXVpcmVtZW50cy4KLQkgKi8KLQlpZiAoSVNfQ0hFUlJZVklFVyh0b19pOTE1
KGRldikpKSB7Ci0JCSplcnJvcl9wcG0gPSAwOwotCi0JCXJldHVybiBjYWxjdWxhdGVkX2Nsb2Nr
LT5wID4gYmVzdF9jbG9jay0+cDsKLQl9Ci0KLQlpZiAoZHJtX1dBUk5fT05fT05DRShkZXYsICF0
YXJnZXRfZnJlcSkpCi0JCXJldHVybiBmYWxzZTsKLQotCSplcnJvcl9wcG0gPSBkaXZfdTY0KDEw
MDAwMDBVTEwgKgotCQkJCWFicyh0YXJnZXRfZnJlcSAtIGNhbGN1bGF0ZWRfY2xvY2stPmRvdCks
Ci0JCQkgICAgIHRhcmdldF9mcmVxKTsKLQkvKgotCSAqIFByZWZlciBhIGJldHRlciBQIHZhbHVl
IG92ZXIgYSBiZXR0ZXIgKHNtYWxsZXIpIGVycm9yIGlmIHRoZSBlcnJvcgotCSAqIGlzIHNtYWxs
LiBFbnN1cmUgdGhpcyBwcmVmZXJlbmNlIGZvciBmdXR1cmUgY29uZmlndXJhdGlvbnMgdG9vIGJ5
Ci0JICogc2V0dGluZyB0aGUgZXJyb3IgdG8gMC4KLQkgKi8KLQlpZiAoKmVycm9yX3BwbSA8IDEw
MCAmJiBjYWxjdWxhdGVkX2Nsb2NrLT5wID4gYmVzdF9jbG9jay0+cCkgewotCQkqZXJyb3JfcHBt
ID0gMDsKLQotCQlyZXR1cm4gdHJ1ZTsKLQl9Ci0KLQlyZXR1cm4gKmVycm9yX3BwbSArIDEwIDwg
YmVzdF9lcnJvcl9wcG07Ci19Ci0KLS8qCi0gKiBSZXR1cm5zIGEgc2V0IG9mIGRpdmlzb3JzIGZv
ciB0aGUgZGVzaXJlZCB0YXJnZXQgY2xvY2sgd2l0aCB0aGUgZ2l2ZW4KLSAqIHJlZmNsaywgb3Ig
RkFMU0UuICBUaGUgcmV0dXJuZWQgdmFsdWVzIHJlcHJlc2VudCB0aGUgY2xvY2sgZXF1YXRpb246
Ci0gKiByZWZsY2sgKiAoNSAqIChtMSArIDIpICsgKG0yICsgMikpIC8gKG4gKyAyKSAvIHAxIC8g
cDIuCi0gKi8KLXN0YXRpYyBib29sCi12bHZfZmluZF9iZXN0X2RwbGwoY29uc3Qgc3RydWN0IGlu
dGVsX2xpbWl0ICpsaW1pdCwKLQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCi0JCSAgIGludCB0YXJnZXQsIGludCByZWZjbGssIHN0cnVjdCBkcGxsICptYXRjaF9jbG9j
aywKLQkJICAgc3RydWN0IGRwbGwgKmJlc3RfY2xvY2spCi17Ci0Jc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcGxsIGNsb2NrOwotCXVu
c2lnbmVkIGludCBiZXN0cHBtID0gMTAwMDAwMDsKLQkvKiBtaW4gdXBkYXRlIDE5LjIgTUh6ICov
Ci0JaW50IG1heF9uID0gbWluKGxpbWl0LT5uLm1heCwgcmVmY2xrIC8gMTkyMDApOwotCWJvb2wg
Zm91bmQgPSBmYWxzZTsKLQotCXRhcmdldCAqPSA1OyAvKiBmYXN0IGNsb2NrICovCi0KLQltZW1z
ZXQoYmVzdF9jbG9jaywgMCwgc2l6ZW9mKCpiZXN0X2Nsb2NrKSk7Ci0KLQkvKiBiYXNlZCBvbiBo
YXJkd2FyZSByZXF1aXJlbWVudCwgcHJlZmVyIHNtYWxsZXIgbiB0byBwcmVjaXNpb24gKi8KLQlm
b3IgKGNsb2NrLm4gPSBsaW1pdC0+bi5taW47IGNsb2NrLm4gPD0gbWF4X247IGNsb2NrLm4rKykg
ewotCQlmb3IgKGNsb2NrLnAxID0gbGltaXQtPnAxLm1heDsgY2xvY2sucDEgPj0gbGltaXQtPnAx
Lm1pbjsgY2xvY2sucDEtLSkgewotCQkJZm9yIChjbG9jay5wMiA9IGxpbWl0LT5wMi5wMl9mYXN0
OyBjbG9jay5wMiA+PSBsaW1pdC0+cDIucDJfc2xvdzsKLQkJCSAgICAgY2xvY2sucDIgLT0gY2xv
Y2sucDIgPiAxMCA/IDIgOiAxKSB7Ci0JCQkJY2xvY2sucCA9IGNsb2NrLnAxICogY2xvY2sucDI7
Ci0JCQkJLyogYmFzZWQgb24gaGFyZHdhcmUgcmVxdWlyZW1lbnQsIHByZWZlciBiaWdnZXIgbTEs
bTIgdmFsdWVzICovCi0JCQkJZm9yIChjbG9jay5tMSA9IGxpbWl0LT5tMS5taW47IGNsb2NrLm0x
IDw9IGxpbWl0LT5tMS5tYXg7IGNsb2NrLm0xKyspIHsKLQkJCQkJdW5zaWduZWQgaW50IHBwbTsK
LQotCQkJCQljbG9jay5tMiA9IERJVl9ST1VORF9DTE9TRVNUKHRhcmdldCAqIGNsb2NrLnAgKiBj
bG9jay5uLAotCQkJCQkJCQkgICAgIHJlZmNsayAqIGNsb2NrLm0xKTsKLQotCQkJCQl2bHZfY2Fs
Y19kcGxsX3BhcmFtcyhyZWZjbGssICZjbG9jayk7Ci0KLQkJCQkJaWYgKCFpbnRlbF9wbGxfaXNf
dmFsaWQodG9faTkxNShkZXYpLAotCQkJCQkJCQlsaW1pdCwKLQkJCQkJCQkJJmNsb2NrKSkKLQkJ
CQkJCWNvbnRpbnVlOwotCi0JCQkJCWlmICghdmx2X1BMTF9pc19vcHRpbWFsKGRldiwgdGFyZ2V0
LAotCQkJCQkJCQkmY2xvY2ssCi0JCQkJCQkJCWJlc3RfY2xvY2ssCi0JCQkJCQkJCWJlc3RwcG0s
ICZwcG0pKQotCQkJCQkJY29udGludWU7Ci0KLQkJCQkJKmJlc3RfY2xvY2sgPSBjbG9jazsKLQkJ
CQkJYmVzdHBwbSA9IHBwbTsKLQkJCQkJZm91bmQgPSB0cnVlOwotCQkJCX0KLQkJCX0KLQkJfQot
CX0KLQotCXJldHVybiBmb3VuZDsKLX0KLQotLyoKLSAqIFJldHVybnMgYSBzZXQgb2YgZGl2aXNv
cnMgZm9yIHRoZSBkZXNpcmVkIHRhcmdldCBjbG9jayB3aXRoIHRoZSBnaXZlbgotICogcmVmY2xr
LCBvciBGQUxTRS4gIFRoZSByZXR1cm5lZCB2YWx1ZXMgcmVwcmVzZW50IHRoZSBjbG9jayBlcXVh
dGlvbjoKLSAqIHJlZmxjayAqICg1ICogKG0xICsgMikgKyAobTIgKyAyKSkgLyAobiArIDIpIC8g
cDEgLyBwMi4KLSAqLwotc3RhdGljIGJvb2wKLWNodl9maW5kX2Jlc3RfZHBsbChjb25zdCBzdHJ1
Y3QgaW50ZWxfbGltaXQgKmxpbWl0LAotCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKLQkJICAgaW50IHRhcmdldCwgaW50IHJlZmNsaywgc3RydWN0IGRwbGwgKm1hdGNo
X2Nsb2NrLAotCQkgICBzdHJ1Y3QgZHBsbCAqYmVzdF9jbG9jaykKLXsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0JdW5zaWduZWQgaW50IGJlc3Rf
ZXJyb3JfcHBtOwotCXN0cnVjdCBkcGxsIGNsb2NrOwotCXU2NCBtMjsKLQlpbnQgZm91bmQgPSBm
YWxzZTsKLQotCW1lbXNldChiZXN0X2Nsb2NrLCAwLCBzaXplb2YoKmJlc3RfY2xvY2spKTsKLQli
ZXN0X2Vycm9yX3BwbSA9IDEwMDAwMDA7Ci0KLQkvKgotCSAqIEJhc2VkIG9uIGhhcmR3YXJlIGRv
YywgdGhlIG4gYWx3YXlzIHNldCB0byAxLCBhbmQgbTEgYWx3YXlzCi0JICogc2V0IHRvIDIuICBJ
ZiByZXF1aXJlcyB0byBzdXBwb3J0IDIwME1oeiByZWZjbGssIHdlIG5lZWQgdG8KLQkgKiByZXZp
c2l0IHRoaXMgYmVjYXVzZSBuIG1heSBub3QgMSBhbnltb3JlLgotCSAqLwotCWNsb2NrLm4gPSAx
OwotCWNsb2NrLm0xID0gMjsKLQl0YXJnZXQgKj0gNTsJLyogZmFzdCBjbG9jayAqLwotCi0JZm9y
IChjbG9jay5wMSA9IGxpbWl0LT5wMS5tYXg7IGNsb2NrLnAxID49IGxpbWl0LT5wMS5taW47IGNs
b2NrLnAxLS0pIHsKLQkJZm9yIChjbG9jay5wMiA9IGxpbWl0LT5wMi5wMl9mYXN0OwotCQkJCWNs
b2NrLnAyID49IGxpbWl0LT5wMi5wMl9zbG93OwotCQkJCWNsb2NrLnAyIC09IGNsb2NrLnAyID4g
MTAgPyAyIDogMSkgewotCQkJdW5zaWduZWQgaW50IGVycm9yX3BwbTsKLQotCQkJY2xvY2sucCA9
IGNsb2NrLnAxICogY2xvY2sucDI7Ci0KLQkJCW0yID0gRElWX1JPVU5EX0NMT1NFU1RfVUxMKG11
bF91MzJfdTMyKHRhcmdldCwgY2xvY2sucCAqIGNsb2NrLm4pIDw8IDIyLAotCQkJCQkJICAgcmVm
Y2xrICogY2xvY2subTEpOwotCi0JCQlpZiAobTIgPiBJTlRfTUFYL2Nsb2NrLm0xKQotCQkJCWNv
bnRpbnVlOwotCi0JCQljbG9jay5tMiA9IG0yOwotCi0JCQljaHZfY2FsY19kcGxsX3BhcmFtcyhy
ZWZjbGssICZjbG9jayk7Ci0KLQkJCWlmICghaW50ZWxfcGxsX2lzX3ZhbGlkKHRvX2k5MTUoZGV2
KSwgbGltaXQsICZjbG9jaykpCi0JCQkJY29udGludWU7Ci0KLQkJCWlmICghdmx2X1BMTF9pc19v
cHRpbWFsKGRldiwgdGFyZ2V0LCAmY2xvY2ssIGJlc3RfY2xvY2ssCi0JCQkJCQliZXN0X2Vycm9y
X3BwbSwgJmVycm9yX3BwbSkpCi0JCQkJY29udGludWU7Ci0KLQkJCSpiZXN0X2Nsb2NrID0gY2xv
Y2s7Ci0JCQliZXN0X2Vycm9yX3BwbSA9IGVycm9yX3BwbTsKLQkJCWZvdW5kID0gdHJ1ZTsKLQkJ
fQotCX0KLQotCXJldHVybiBmb3VuZDsKLX0KLQotYm9vbCBieHRfZmluZF9iZXN0X2RwbGwoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQlzdHJ1Y3QgZHBsbCAqYmVzdF9j
bG9jaykKLXsKLQlpbnQgcmVmY2xrID0gMTAwMDAwOwotCWNvbnN0IHN0cnVjdCBpbnRlbF9saW1p
dCAqbGltaXQgPSAmaW50ZWxfbGltaXRzX2J4dDsKLQotCXJldHVybiBjaHZfZmluZF9iZXN0X2Rw
bGwobGltaXQsIGNydGNfc3RhdGUsCi0JCQkJICBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLCByZWZj
bGssCi0JCQkJICBOVUxMLCBiZXN0X2Nsb2NrKTsKLX0KLQogc3RhdGljIGJvb2wgcGlwZV9zY2Fu
bGluZV9pc19tb3Zpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCSAg
ICBlbnVtIHBpcGUgcGlwZSkKIHsKQEAgLTUyNzQsNyArNDUyMiw3IEBAIHN0YXRpYyB2b2lkIGl2
Yl91cGRhdGVfZmRpX2JjX2JpZnVyY2F0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0CiAgKiBGaW5kcyB0aGUgZW5jb2RlciBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVu
IENSVEMuIFRoaXMgY2FuIG9ubHkgYmUKICAqIHVzZWQgd2hlbiB3ZSBrbm93IHRoYXQgdGhlIENS
VEMgaXNuJ3QgZmVlZGluZyBtdWx0aXBsZSBlbmNvZGVycyEKICAqLwotc3RhdGljIHN0cnVjdCBp
bnRlbF9lbmNvZGVyICoKK3N0cnVjdCBpbnRlbF9lbmNvZGVyICoKIGludGVsX2dldF9jcnRjX25l
d19lbmNvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJICAg
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CkBAIC03OTQyLDUx
ICs3MTkwLDYgQEAgc3RhdGljIHZvaWQgaW50ZWxfcGFuZWxfc2FuaXRpemVfc3NjKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiB9CiAKLXN0YXRpYyBib29sIGludGVsX3Bh
bmVsX3VzZV9zc2Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQotewotCWlmIChk
ZXZfcHJpdi0+cGFyYW1zLnBhbmVsX3VzZV9zc2MgPj0gMCkKLQkJcmV0dXJuIGRldl9wcml2LT5w
YXJhbXMucGFuZWxfdXNlX3NzYyAhPSAwOwotCXJldHVybiBkZXZfcHJpdi0+dmJ0Lmx2ZHNfdXNl
X3NzYwotCQkmJiAhKGRldl9wcml2LT5xdWlya3MgJiBRVUlSS19MVkRTX1NTQ19ESVNBQkxFKTsK
LX0KLQotc3RhdGljIHUzMiBwbnZfZHBsbF9jb21wdXRlX2ZwKHN0cnVjdCBkcGxsICpkcGxsKQot
ewotCXJldHVybiAoMSA8PCBkcGxsLT5uKSA8PCAxNiB8IGRwbGwtPm0yOwotfQotCi1zdGF0aWMg
dTMyIGk5eHhfZHBsbF9jb21wdXRlX2ZwKHN0cnVjdCBkcGxsICpkcGxsKQotewotCXJldHVybiBk
cGxsLT5uIDw8IDE2IHwgZHBsbC0+bTEgPDwgOCB8IGRwbGwtPm0yOwotfQotCi1zdGF0aWMgdm9p
ZCBpOXh4X3VwZGF0ZV9wbGxfZGl2aWRlcnMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkJ
ICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkgICAgIHN0cnVj
dCBkcGxsICpyZWR1Y2VkX2Nsb2NrKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCXUzMiBmcCwgZnAyID0gMDsKLQotCWlm
IChJU19QSU5FVklFVyhkZXZfcHJpdikpIHsKLQkJZnAgPSBwbnZfZHBsbF9jb21wdXRlX2ZwKCZj
cnRjX3N0YXRlLT5kcGxsKTsKLQkJaWYgKHJlZHVjZWRfY2xvY2spCi0JCQlmcDIgPSBwbnZfZHBs
bF9jb21wdXRlX2ZwKHJlZHVjZWRfY2xvY2spOwotCX0gZWxzZSB7Ci0JCWZwID0gaTl4eF9kcGxs
X2NvbXB1dGVfZnAoJmNydGNfc3RhdGUtPmRwbGwpOwotCQlpZiAocmVkdWNlZF9jbG9jaykKLQkJ
CWZwMiA9IGk5eHhfZHBsbF9jb21wdXRlX2ZwKHJlZHVjZWRfY2xvY2spOwotCX0KLQotCWNydGNf
c3RhdGUtPmRwbGxfaHdfc3RhdGUuZnAwID0gZnA7Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNfdHlw
ZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykgJiYKLQkgICAgcmVkdWNlZF9jbG9jaykg
ewotCQljcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlLmZwMSA9IGZwMjsKLQl9IGVsc2UgewotCQlj
cnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlLmZwMSA9IGZwOwotCX0KLX0KLQogc3RhdGljIHZvaWQg
dmx2X3BsbGJfcmVjYWxfb3BhbXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIHBpcGUKIAkJcGlwZSkKIHsKQEAgLTgxMTEsMzkgKzczMTQsNiBAQCB2b2lkIGludGVsX2Rw
X3NldF9tX24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsIGVudW0g
bGlua19tX25fcwogCQlpbnRlbF9jcHVfdHJhbnNjb2Rlcl9zZXRfbV9uKGNydGNfc3RhdGUsIGRw
X21fbiwgZHBfbTJfbjIpOwogfQogCi1zdGF0aWMgdm9pZCB2bHZfY29tcHV0ZV9kcGxsKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAotCQkJICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpCi17Ci0JcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCA9IERQTExfSU5U
RUdSQVRFRF9SRUZfQ0xLX1ZMViB8Ci0JCURQTExfUkVGX0NMS19FTkFCTEVfVkxWIHwgRFBMTF9W
R0FfTU9ERV9ESVM7Ci0JaWYgKGNydGMtPnBpcGUgIT0gUElQRV9BKQotCQlwaXBlX2NvbmZpZy0+
ZHBsbF9od19zdGF0ZS5kcGxsIHw9IERQTExfSU5URUdSQVRFRF9DUklfQ0xLX1ZMVjsKLQotCS8q
IERQTEwgbm90IHVzZWQgd2l0aCBEU0ksIGJ1dCBzdGlsbCBuZWVkIHRoZSByZXN0IHNldCB1cCAq
LwotCWlmICghaW50ZWxfY3J0Y19oYXNfdHlwZShwaXBlX2NvbmZpZywgSU5URUxfT1VUUFVUX0RT
SSkpCi0JCXBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlLmRwbGwgfD0gRFBMTF9WQ09fRU5BQkxF
IHwKLQkJCURQTExfRVhUX0JVRkZFUl9FTkFCTEVfVkxWOwotCi0JcGlwZV9jb25maWctPmRwbGxf
aHdfc3RhdGUuZHBsbF9tZCA9Ci0JCShwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllciAtIDEp
IDw8IERQTExfTURfVURJX01VTFRJUExJRVJfU0hJRlQ7Ci19Ci0KLXN0YXRpYyB2b2lkIGNodl9j
b21wdXRlX2RwbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkgICAgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKLXsKLQlwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0
ZS5kcGxsID0gRFBMTF9TU0NfUkVGX0NMS19DSFYgfAotCQlEUExMX1JFRl9DTEtfRU5BQkxFX1ZM
ViB8IERQTExfVkdBX01PREVfRElTOwotCWlmIChjcnRjLT5waXBlICE9IFBJUEVfQSkKLQkJcGlw
ZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCB8PSBEUExMX0lOVEVHUkFURURfQ1JJX0NMS19W
TFY7Ci0KLQkvKiBEUExMIG5vdCB1c2VkIHdpdGggRFNJLCBidXQgc3RpbGwgbmVlZCB0aGUgcmVz
dCBzZXQgdXAgKi8KLQlpZiAoIWludGVsX2NydGNfaGFzX3R5cGUocGlwZV9jb25maWcsIElOVEVM
X09VVFBVVF9EU0kpKQotCQlwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsIHw9IERQTExf
VkNPX0VOQUJMRTsKLQotCXBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlLmRwbGxfbWQgPQotCQko
cGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIgLSAxKSA8PCBEUExMX01EX1VESV9NVUxUSVBM
SUVSX1NISUZUOwotfQotCiBzdGF0aWMgdm9pZCB2bHZfcHJlcGFyZV9wbGwoc3RydWN0IGludGVs
X2NydGMgKmNydGMsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnKQogewpAQCAtODQwMywxMjggKzc1NzMsNyBAQCB2b2lkIHZsdl9mb3JjZV9wbGxfb2Zm
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJCXZs
dl9kaXNhYmxlX3BsbChkZXZfcHJpdiwgcGlwZSk7CiB9CiAKLXN0YXRpYyB2b2lkIGk5eHhfY29t
cHV0ZV9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJICAgICAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkgICAgICBzdHJ1Y3QgZHBsbCAqcmVkdWNlZF9j
bG9jaykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKLQl1MzIgZHBsbDsKLQlzdHJ1Y3QgZHBsbCAqY2xvY2sgPSAmY3J0Y19z
dGF0ZS0+ZHBsbDsKLQotCWk5eHhfdXBkYXRlX3BsbF9kaXZpZGVycyhjcnRjLCBjcnRjX3N0YXRl
LCByZWR1Y2VkX2Nsb2NrKTsKLQotCWRwbGwgPSBEUExMX1ZHQV9NT0RFX0RJUzsKLQotCWlmIChp
bnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkKLQkJZHBs
bCB8PSBEUExMQl9NT0RFX0xWRFM7Ci0JZWxzZQotCQlkcGxsIHw9IERQTExCX01PREVfREFDX1NF
UklBTDsKLQotCWlmIChJU19JOTQ1RyhkZXZfcHJpdikgfHwgSVNfSTk0NUdNKGRldl9wcml2KSB8
fAotCSAgICBJU19HMzMoZGV2X3ByaXYpIHx8IElTX1BJTkVWSUVXKGRldl9wcml2KSkgewotCQlk
cGxsIHw9IChjcnRjX3N0YXRlLT5waXhlbF9tdWx0aXBsaWVyIC0gMSkKLQkJCTw8IFNEVk9fTVVM
VElQTElFUl9TSElGVF9ISVJFUzsKLQl9Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRj
X3N0YXRlLCBJTlRFTF9PVVRQVVRfU0RWTykgfHwKLQkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShj
cnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpCi0JCWRwbGwgfD0gRFBMTF9TRFZPX0hJR0hf
U1BFRUQ7Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2RlcihjcnRjX3N0YXRlKSkKLQkJ
ZHBsbCB8PSBEUExMX1NEVk9fSElHSF9TUEVFRDsKLQotCS8qIGNvbXB1dGUgYml0bWFzayBmcm9t
IHAxIHZhbHVlICovCi0JaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSkKLQkJZHBsbCB8PSAoMSA8
PCAoY2xvY2stPnAxIC0gMSkpIDw8IERQTExfRlBBMDFfUDFfUE9TVF9ESVZfU0hJRlRfUElORVZJ
RVc7Ci0JZWxzZSB7Ci0JCWRwbGwgfD0gKDEgPDwgKGNsb2NrLT5wMSAtIDEpKSA8PCBEUExMX0ZQ
QTAxX1AxX1BPU1RfRElWX1NISUZUOwotCQlpZiAoSVNfRzRYKGRldl9wcml2KSAmJiByZWR1Y2Vk
X2Nsb2NrKQotCQkJZHBsbCB8PSAoMSA8PCAocmVkdWNlZF9jbG9jay0+cDEgLSAxKSkgPDwgRFBM
TF9GUEExX1AxX1BPU1RfRElWX1NISUZUOwotCX0KLQlzd2l0Y2ggKGNsb2NrLT5wMikgewotCWNh
c2UgNToKLQkJZHBsbCB8PSBEUExMX0RBQ19TRVJJQUxfUDJfQ0xPQ0tfRElWXzU7Ci0JCWJyZWFr
OwotCWNhc2UgNzoKLQkJZHBsbCB8PSBEUExMQl9MVkRTX1AyX0NMT0NLX0RJVl83OwotCQlicmVh
azsKLQljYXNlIDEwOgotCQlkcGxsIHw9IERQTExfREFDX1NFUklBTF9QMl9DTE9DS19ESVZfMTA7
Ci0JCWJyZWFrOwotCWNhc2UgMTQ6Ci0JCWRwbGwgfD0gRFBMTEJfTFZEU19QMl9DTE9DS19ESVZf
MTQ7Ci0JCWJyZWFrOwotCX0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQotCQlkcGxs
IHw9ICg2IDw8IFBMTF9MT0FEX1BVTFNFX1BIQVNFX1NISUZUKTsKLQotCWlmIChjcnRjX3N0YXRl
LT5zZHZvX3R2X2Nsb2NrKQotCQlkcGxsIHw9IFBMTF9SRUZfSU5QVVRfVFZDTEtJTkJDOwotCWVs
c2UgaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMp
ICYmCi0JCSBpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSkKLQkJZHBsbCB8PSBQTExCX1JF
Rl9JTlBVVF9TUFJFQURTUEVDVFJVTUlOOwotCWVsc2UKLQkJZHBsbCB8PSBQTExfUkVGX0lOUFVU
X0RSRUZDTEs7Ci0KLQlkcGxsIHw9IERQTExfVkNPX0VOQUJMRTsKLQljcnRjX3N0YXRlLT5kcGxs
X2h3X3N0YXRlLmRwbGwgPSBkcGxsOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkg
ewotCQl1MzIgZHBsbF9tZCA9IChjcnRjX3N0YXRlLT5waXhlbF9tdWx0aXBsaWVyIC0gMSkKLQkJ
CTw8IERQTExfTURfVURJX01VTFRJUExJRVJfU0hJRlQ7Ci0JCWNydGNfc3RhdGUtPmRwbGxfaHdf
c3RhdGUuZHBsbF9tZCA9IGRwbGxfbWQ7Ci0JfQotfQotCi1zdGF0aWMgdm9pZCBpOHh4X2NvbXB1
dGVfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJCSAgICAgIHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJICAgICAgc3RydWN0IGRwbGwgKnJlZHVjZWRfY2xv
Y2spCi17Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQl1MzIgZHBsbDsK
LQlzdHJ1Y3QgZHBsbCAqY2xvY2sgPSAmY3J0Y19zdGF0ZS0+ZHBsbDsKLQotCWk5eHhfdXBkYXRl
X3BsbF9kaXZpZGVycyhjcnRjLCBjcnRjX3N0YXRlLCByZWR1Y2VkX2Nsb2NrKTsKLQotCWRwbGwg
PSBEUExMX1ZHQV9NT0RFX0RJUzsKIAotCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3Rh
dGUsIElOVEVMX09VVFBVVF9MVkRTKSkgewotCQlkcGxsIHw9ICgxIDw8IChjbG9jay0+cDEgLSAx
KSkgPDwgRFBMTF9GUEEwMV9QMV9QT1NUX0RJVl9TSElGVDsKLQl9IGVsc2UgewotCQlpZiAoY2xv
Y2stPnAxID09IDIpCi0JCQlkcGxsIHw9IFBMTF9QMV9ESVZJREVfQllfVFdPOwotCQllbHNlCi0J
CQlkcGxsIHw9IChjbG9jay0+cDEgLSAyKSA8PCBEUExMX0ZQQTAxX1AxX1BPU1RfRElWX1NISUZU
OwotCQlpZiAoY2xvY2stPnAyID09IDQpCi0JCQlkcGxsIHw9IFBMTF9QMl9ESVZJREVfQllfNDsK
LQl9Ci0KLQkvKgotCSAqIEJzcGVjOgotCSAqICJbQWxtYWRvciBFcnJhdGF9OiBGb3IgdGhlIGNv
cnJlY3Qgb3BlcmF0aW9uIG9mIHRoZSBtdXhlZCBEVk8gcGlucwotCSAqICAoR0RFVlNFTEIvSTJD
ZGF0YSwgR0lSREJZL0kyQ0NsaykgYW5kIChHRlJBTUVCL0RWSV9EYXRhLAotCSAqICBHVFJEWUIv
RFZJX0Nsayk6IEJpdCAzMSAoRFBMTCBWQ08gRW5hYmxlKSBhbmQgQml0IDMwICgyWCBDbG9jawot
CSAqICBFbmFibGUpIG11c3QgYmUgc2V0IHRvIOKAnDHigJ0gaW4gYm90aCB0aGUgRFBMTCBBIENv
bnRyb2wgUmVnaXN0ZXIKLQkgKiAgKDA2MDE0aC0wNjAxN2gpIGFuZCBEUExMIEIgQ29udHJvbCBS
ZWdpc3RlciAoMDYwMThoLTA2MDFCaCkuIgotCSAqCi0JICogRm9yIHNpbXBsaWNpdHkgV2Ugc2lt
cGx5IGtlZXAgYm90aCBiaXRzIGFsd2F5cyBlbmFibGVkIGluCi0JICogYm90aCBEUExMUy4gVGhl
IHNwZWMgc2F5cyB3ZSBzaG91bGQgZGlzYWJsZSB0aGUgRFZPIDJYIGNsb2NrCi0JICogd2hlbiBu
b3QgbmVlZGVkLCBidXQgdGhpcyBzZWVtcyB0byB3b3JrIGZpbmUgaW4gcHJhY3RpY2UuCi0JICov
Ci0JaWYgKElTX0k4MzAoZGV2X3ByaXYpIHx8Ci0JICAgIGludGVsX2NydGNfaGFzX3R5cGUoY3J0
Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RWTykpCi0JCWRwbGwgfD0gRFBMTF9EVk9fMlhfTU9ERTsK
LQotCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRT
KSAmJgotCSAgICBpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSkKLQkJZHBsbCB8PSBQTExC
X1JFRl9JTlBVVF9TUFJFQURTUEVDVFJVTUlOOwotCWVsc2UKLQkJZHBsbCB8PSBQTExfUkVGX0lO
UFVUX0RSRUZDTEs7Ci0KLQlkcGxsIHw9IERQTExfVkNPX0VOQUJMRTsKLQljcnRjX3N0YXRlLT5k
cGxsX2h3X3N0YXRlLmRwbGwgPSBkcGxsOwotfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9zZXRfdHJh
bnNjb2Rlcl90aW1pbmdzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogewpAQCAtODczMCwyMDcgKzc3NzksNiBAQCBzdGF0aWMgdm9pZCBpOXh4X3NldF9waXBlY29u
Zihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpbnRlbF9kZV9w
b3N0aW5nX3JlYWQoZGV2X3ByaXYsIFBJUEVDT05GKGNydGMtPnBpcGUpKTsKIH0KIAotc3RhdGlj
IGludCBpOHh4X2NydGNfY29tcHV0ZV9jbG9jayhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJ
CQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCWNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGlt
aXQ7Ci0JaW50IHJlZmNsayA9IDQ4MDAwOwotCi0JbWVtc2V0KCZjcnRjX3N0YXRlLT5kcGxsX2h3
X3N0YXRlLCAwLAotCSAgICAgICBzaXplb2YoY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZSkpOwot
Ci0JaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMp
KSB7Ci0JCWlmIChpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSkgewotCQkJcmVmY2xrID0g
ZGV2X3ByaXYtPnZidC5sdmRzX3NzY19mcmVxOwotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5k
cm0sCi0JCQkJICAgICJ1c2luZyBTU0MgcmVmZXJlbmNlIGNsb2NrIG9mICVkIGtIelxuIiwKLQkJ
CQkgICAgcmVmY2xrKTsKLQkJfQotCi0JCWxpbWl0ID0gJmludGVsX2xpbWl0c19pOHh4X2x2ZHM7
Ci0JfSBlbHNlIGlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBV
VF9EVk8pKSB7Ci0JCWxpbWl0ID0gJmludGVsX2xpbWl0c19pOHh4X2R2bzsKLQl9IGVsc2Ugewot
CQlsaW1pdCA9ICZpbnRlbF9saW1pdHNfaTh4eF9kYWM7Ci0JfQotCi0JaWYgKCFjcnRjX3N0YXRl
LT5jbG9ja19zZXQgJiYKLQkgICAgIWk5eHhfZmluZF9iZXN0X2RwbGwobGltaXQsIGNydGNfc3Rh
dGUsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCi0JCQkJIHJlZmNsaywgTlVMTCwgJmNydGNfc3Rh
dGUtPmRwbGwpKSB7Ci0JCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCi0JCQkiQ291bGRuJ3QgZmlu
ZCBQTEwgc2V0dGluZ3MgZm9yIG1vZGUhXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0J
aTh4eF9jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19zdGF0ZSwgTlVMTCk7Ci0KLQlyZXR1cm4gMDsK
LX0KLQotc3RhdGljIGludCBnNHhfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAotCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCi17Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7Ci0JY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdDsKLQlpbnQgcmVmY2xrID0gOTYw
MDA7Ci0KLQltZW1zZXQoJmNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUsIDAsCi0JICAgICAgIHNp
emVvZihjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlKSk7Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNf
dHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykpIHsKLQkJaWYgKGludGVsX3BhbmVs
X3VzZV9zc2MoZGV2X3ByaXYpKSB7Ci0JCQlyZWZjbGsgPSBkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3Nj
X2ZyZXE7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCQkgICAgInVzaW5nIFNT
QyByZWZlcmVuY2UgY2xvY2sgb2YgJWQga0h6XG4iLAotCQkJCSAgICByZWZjbGspOwotCQl9Ci0K
LQkJaWYgKGludGVsX2lzX2R1YWxfbGlua19sdmRzKGRldl9wcml2KSkKLQkJCWxpbWl0ID0gJmlu
dGVsX2xpbWl0c19nNHhfZHVhbF9jaGFubmVsX2x2ZHM7Ci0JCWVsc2UKLQkJCWxpbWl0ID0gJmlu
dGVsX2xpbWl0c19nNHhfc2luZ2xlX2NoYW5uZWxfbHZkczsKLQl9IGVsc2UgaWYgKGludGVsX2Ny
dGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0hETUkpIHx8Ci0JCSAgIGludGVs
X2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0FOQUxPRykpIHsKLQkJbGlt
aXQgPSAmaW50ZWxfbGltaXRzX2c0eF9oZG1pOwotCX0gZWxzZSBpZiAoaW50ZWxfY3J0Y19oYXNf
dHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfU0RWTykpIHsKLQkJbGltaXQgPSAmaW50ZWxf
bGltaXRzX2c0eF9zZHZvOwotCX0gZWxzZSB7Ci0JCS8qIFRoZSBvcHRpb24gaXMgZm9yIG90aGVy
IG91dHB1dHMgKi8KLQkJbGltaXQgPSAmaW50ZWxfbGltaXRzX2k5eHhfc2R2bzsKLQl9Ci0KLQlp
ZiAoIWNydGNfc3RhdGUtPmNsb2NrX3NldCAmJgotCSAgICAhZzR4X2ZpbmRfYmVzdF9kcGxsKGxp
bWl0LCBjcnRjX3N0YXRlLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAotCQkJCXJlZmNsaywgTlVM
TCwgJmNydGNfc3RhdGUtPmRwbGwpKSB7Ci0JCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCi0JCQki
Q291bGRuJ3QgZmluZCBQTEwgc2V0dGluZ3MgZm9yIG1vZGUhXG4iKTsKLQkJcmV0dXJuIC1FSU5W
QUw7Ci0JfQotCi0JaTl4eF9jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19zdGF0ZSwgTlVMTCk7Ci0K
LQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBwbnZfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAotCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCi17Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQljb25zdCBz
dHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0OwotCWludCByZWZjbGsgPSA5NjAwMDsKLQotCW1lbXNl
dCgmY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZSwgMCwKLQkgICAgICAgc2l6ZW9mKGNydGNfc3Rh
dGUtPmRwbGxfaHdfc3RhdGUpKTsKLQotCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3Rh
dGUsIElOVEVMX09VVFBVVF9MVkRTKSkgewotCQlpZiAoaW50ZWxfcGFuZWxfdXNlX3NzYyhkZXZf
cHJpdikpIHsKLQkJCXJlZmNsayA9IGRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcTsKLQkJCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAidXNpbmcgU1NDIHJlZmVyZW5jZSBj
bG9jayBvZiAlZCBrSHpcbiIsCi0JCQkJICAgIHJlZmNsayk7Ci0JCX0KLQotCQlsaW1pdCA9ICZw
bnZfbGltaXRzX2x2ZHM7Ci0JfSBlbHNlIHsKLQkJbGltaXQgPSAmcG52X2xpbWl0c19zZHZvOwot
CX0KLQotCWlmICghY3J0Y19zdGF0ZS0+Y2xvY2tfc2V0ICYmCi0JICAgICFwbnZfZmluZF9iZXN0
X2RwbGwobGltaXQsIGNydGNfc3RhdGUsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCi0JCQkJcmVm
Y2xrLCBOVUxMLCAmY3J0Y19zdGF0ZS0+ZHBsbCkpIHsKLQkJZHJtX2VycigmZGV2X3ByaXYtPmRy
bSwKLQkJCSJDb3VsZG4ndCBmaW5kIFBMTCBzZXR0aW5ncyBmb3IgbW9kZSFcbiIpOwotCQlyZXR1
cm4gLUVJTlZBTDsKLQl9Ci0KLQlpOXh4X2NvbXB1dGVfZHBsbChjcnRjLCBjcnRjX3N0YXRlLCBO
VUxMKTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGk5eHhfY3J0Y19jb21wdXRlX2Ns
b2NrKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQotewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNl
LmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7
Ci0JY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdDsKLQlpbnQgcmVmY2xrID0gOTYwMDA7
Ci0KLQltZW1zZXQoJmNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUsIDAsCi0JICAgICAgIHNpemVv
ZihjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlKSk7Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNfdHlw
ZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykpIHsKLQkJaWYgKGludGVsX3BhbmVsX3Vz
ZV9zc2MoZGV2X3ByaXYpKSB7Ci0JCQlyZWZjbGsgPSBkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2Zy
ZXE7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCQkgICAgInVzaW5nIFNTQyBy
ZWZlcmVuY2UgY2xvY2sgb2YgJWQga0h6XG4iLAotCQkJCSAgICByZWZjbGspOwotCQl9Ci0KLQkJ
bGltaXQgPSAmaW50ZWxfbGltaXRzX2k5eHhfbHZkczsKLQl9IGVsc2UgewotCQlsaW1pdCA9ICZp
bnRlbF9saW1pdHNfaTl4eF9zZHZvOwotCX0KLQotCWlmICghY3J0Y19zdGF0ZS0+Y2xvY2tfc2V0
ICYmCi0JICAgICFpOXh4X2ZpbmRfYmVzdF9kcGxsKGxpbWl0LCBjcnRjX3N0YXRlLCBjcnRjX3N0
YXRlLT5wb3J0X2Nsb2NrLAotCQkJCSByZWZjbGssIE5VTEwsICZjcnRjX3N0YXRlLT5kcGxsKSkg
ewotCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAotCQkJIkNvdWxkbid0IGZpbmQgUExMIHNldHRp
bmdzIGZvciBtb2RlIVxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWk5eHhfY29tcHV0
ZV9kcGxsKGNydGMsIGNydGNfc3RhdGUsIE5VTEwpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRp
YyBpbnQgY2h2X2NydGNfY29tcHV0ZV9jbG9jayhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJ
CQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQotewotCWludCByZWZjbGsg
PSAxMDAwMDA7Ci0JY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCA9ICZpbnRlbF9saW1p
dHNfY2h2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjX3N0
YXRlLT51YXBpLmNydGMtPmRldik7Ci0KLQltZW1zZXQoJmNydGNfc3RhdGUtPmRwbGxfaHdfc3Rh
dGUsIDAsCi0JICAgICAgIHNpemVvZihjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlKSk7Ci0KLQlp
ZiAoIWNydGNfc3RhdGUtPmNsb2NrX3NldCAmJgotCSAgICAhY2h2X2ZpbmRfYmVzdF9kcGxsKGxp
bWl0LCBjcnRjX3N0YXRlLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAotCQkJCXJlZmNsaywgTlVM
TCwgJmNydGNfc3RhdGUtPmRwbGwpKSB7Ci0JCWRybV9lcnIoJmk5MTUtPmRybSwgIkNvdWxkbid0
IGZpbmQgUExMIHNldHRpbmdzIGZvciBtb2RlIVxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0K
LQotCWNodl9jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19zdGF0ZSk7Ci0KLQlyZXR1cm4gMDsKLX0K
LQotc3RhdGljIGludCB2bHZfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAotCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCi17Ci0JaW50
IHJlZmNsayA9IDEwMDAwMDsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0ID0gJmlu
dGVsX2xpbWl0c192bHY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKLQotCW1lbXNldCgmY3J0Y19zdGF0ZS0+ZHBs
bF9od19zdGF0ZSwgMCwKLQkgICAgICAgc2l6ZW9mKGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUp
KTsKLQotCWlmICghY3J0Y19zdGF0ZS0+Y2xvY2tfc2V0ICYmCi0JICAgICF2bHZfZmluZF9iZXN0
X2RwbGwobGltaXQsIGNydGNfc3RhdGUsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCi0JCQkJcmVm
Y2xrLCBOVUxMLCAmY3J0Y19zdGF0ZS0+ZHBsbCkpIHsKLQkJZHJtX2VycigmaTkxNS0+ZHJtLCAg
IkNvdWxkbid0IGZpbmQgUExMIHNldHRpbmdzIGZvciBtb2RlIVxuIik7Ci0JCXJldHVybiAtRUlO
VkFMOwotCX0KLQotCXZsdl9jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19zdGF0ZSk7Ci0KLQlyZXR1
cm4gMDsKLX0KIAogc3RhdGljIGJvb2wgaTl4eF9oYXNfcGZpdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiB7CkBAIC05OTQxLDE3MiArODc4OSw2IEBAIGludCBpbGtfZ2V0X2xh
bmVzX3JlcXVpcmVkKGludCB0YXJnZXRfY2xvY2ssIGludCBsaW5rX2J3LCBpbnQgYnBwKQogCXJl
dHVybiBESVZfUk9VTkRfVVAoYnBzLCBsaW5rX2J3ICogOCk7CiB9CiAKLXN0YXRpYyBib29sIGls
a19uZWVkc19mYl9jYl90dW5lKHN0cnVjdCBkcGxsICpkcGxsLCBpbnQgZmFjdG9yKQotewotCXJl
dHVybiBpOXh4X2RwbGxfY29tcHV0ZV9tKGRwbGwpIDwgZmFjdG9yICogZHBsbC0+bjsKLX0KLQot
c3RhdGljIHZvaWQgaWxrX2NvbXB1dGVfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJ
CSAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkgICAgIHN0cnVj
dCBkcGxsICpyZWR1Y2VkX2Nsb2NrKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCXUzMiBkcGxsLCBmcCwgZnAyOwotCWlu
dCBmYWN0b3I7Ci0KLQkvKiBFbmFibGUgYXV0b3R1bmluZyBvZiB0aGUgUExMIGNsb2NrIChpZiBw
ZXJtaXNzaWJsZSkgKi8KLQlmYWN0b3IgPSAyMTsKLQlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShj
cnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykpIHsKLQkJaWYgKChpbnRlbF9wYW5lbF91c2Vf
c3NjKGRldl9wcml2KSAmJgotCQkgICAgIGRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcSA9PSAx
MDAwMDApIHx8Ci0JCSAgICAoSEFTX1BDSF9JQlgoZGV2X3ByaXYpICYmCi0JCSAgICAgaW50ZWxf
aXNfZHVhbF9saW5rX2x2ZHMoZGV2X3ByaXYpKSkKLQkJCWZhY3RvciA9IDI1OwotCX0gZWxzZSBp
ZiAoY3J0Y19zdGF0ZS0+c2R2b190dl9jbG9jaykgewotCQlmYWN0b3IgPSAyMDsKLQl9Ci0KLQlm
cCA9IGk5eHhfZHBsbF9jb21wdXRlX2ZwKCZjcnRjX3N0YXRlLT5kcGxsKTsKLQotCWlmIChpbGtf
bmVlZHNfZmJfY2JfdHVuZSgmY3J0Y19zdGF0ZS0+ZHBsbCwgZmFjdG9yKSkKLQkJZnAgfD0gRlBf
Q0JfVFVORTsKLQotCWlmIChyZWR1Y2VkX2Nsb2NrKSB7Ci0JCWZwMiA9IGk5eHhfZHBsbF9jb21w
dXRlX2ZwKHJlZHVjZWRfY2xvY2spOwotCi0JCWlmIChyZWR1Y2VkX2Nsb2NrLT5tIDwgZmFjdG9y
ICogcmVkdWNlZF9jbG9jay0+bikKLQkJCWZwMiB8PSBGUF9DQl9UVU5FOwotCX0gZWxzZSB7Ci0J
CWZwMiA9IGZwOwotCX0KLQotCWRwbGwgPSAwOwotCi0JaWYgKGludGVsX2NydGNfaGFzX3R5cGUo
Y3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMpKQotCQlkcGxsIHw9IERQTExCX01PREVfTFZE
UzsKLQllbHNlCi0JCWRwbGwgfD0gRFBMTEJfTU9ERV9EQUNfU0VSSUFMOwotCi0JZHBsbCB8PSAo
Y3J0Y19zdGF0ZS0+cGl4ZWxfbXVsdGlwbGllciAtIDEpCi0JCTw8IFBMTF9SRUZfU0RWT19IRE1J
X01VTFRJUExJRVJfU0hJRlQ7Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRl
LCBJTlRFTF9PVVRQVVRfU0RWTykgfHwKLQkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0
YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpCi0JCWRwbGwgfD0gRFBMTF9TRFZPX0hJR0hfU1BFRUQ7
Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2RlcihjcnRjX3N0YXRlKSkKLQkJZHBsbCB8
PSBEUExMX1NEVk9fSElHSF9TUEVFRDsKLQotCS8qCi0JICogVGhlIGhpZ2ggc3BlZWQgSU8gY2xv
Y2sgaXMgb25seSByZWFsbHkgcmVxdWlyZWQgZm9yCi0JICogU0RWTy9IRE1JL0RQLCBidXQgd2Ug
YWxzbyBlbmFibGUgaXQgZm9yIENSVCB0byBtYWtlIGl0Ci0JICogcG9zc2libGUgdG8gc2hhcmUg
dGhlIERQTEwgYmV0d2VlbiBDUlQgYW5kIEhETUkuIEVuYWJsaW5nCi0JICogdGhlIGNsb2NrIG5l
ZWRsZXNzbHkgZG9lcyBubyByZWFsIGhhcm0sIGV4Y2VwdCB1c2UgdXAgYQotCSAqIGJpdCBvZiBw
b3dlciBwb3RlbnRpYWxseS4KLQkgKgotCSAqIFdlJ2xsIGxpbWl0IHRoaXMgdG8gSVZCIHdpdGgg
MyBwaXBlcywgc2luY2UgaXQgaGFzIG9ubHkgdHdvCi0JICogRFBMTHMgYW5kIHNvIERQTEwgc2hh
cmluZyBpcyB0aGUgb25seSB3YXkgdG8gZ2V0IHRocmVlIHBpcGVzCi0JICogZHJpdmluZyBQQ0gg
cG9ydHMgYXQgdGhlIHNhbWUgdGltZS4gT24gU05CIHdlIGNvdWxkIGRvIHRoaXMsCi0JICogYW5k
IHBvdGVudGlhbGx5IGF2b2lkIGVuYWJsaW5nIHRoZSBzZWNvbmQgRFBMTCwgYnV0IGl0J3Mgbm90
Ci0JICogY2xlYXIgaWYgaXQnJ3MgYSB3aW4gb3IgbG9zcyBwb3dlciB3aXNlLiBObyBwb2ludCBp
biBkb2luZwotCSAqIHRoaXMgb24gSUxLIGF0IGFsbCBzaW5jZSBpdCBoYXMgYSBmaXhlZCBEUExM
PC0+cGlwZSBtYXBwaW5nLgotCSAqLwotCWlmIChJTlRFTF9OVU1fUElQRVMoZGV2X3ByaXYpID09
IDMgJiYKLQkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRf
QU5BTE9HKSkKLQkJZHBsbCB8PSBEUExMX1NEVk9fSElHSF9TUEVFRDsKLQotCS8qIGNvbXB1dGUg
Yml0bWFzayBmcm9tIHAxIHZhbHVlICovCi0JZHBsbCB8PSAoMSA8PCAoY3J0Y19zdGF0ZS0+ZHBs
bC5wMSAtIDEpKSA8PCBEUExMX0ZQQTAxX1AxX1BPU1RfRElWX1NISUZUOwotCS8qIGFsc28gRlBB
MSAqLwotCWRwbGwgfD0gKDEgPDwgKGNydGNfc3RhdGUtPmRwbGwucDEgLSAxKSkgPDwgRFBMTF9G
UEExX1AxX1BPU1RfRElWX1NISUZUOwotCi0Jc3dpdGNoIChjcnRjX3N0YXRlLT5kcGxsLnAyKSB7
Ci0JY2FzZSA1OgotCQlkcGxsIHw9IERQTExfREFDX1NFUklBTF9QMl9DTE9DS19ESVZfNTsKLQkJ
YnJlYWs7Ci0JY2FzZSA3OgotCQlkcGxsIHw9IERQTExCX0xWRFNfUDJfQ0xPQ0tfRElWXzc7Ci0J
CWJyZWFrOwotCWNhc2UgMTA6Ci0JCWRwbGwgfD0gRFBMTF9EQUNfU0VSSUFMX1AyX0NMT0NLX0RJ
Vl8xMDsKLQkJYnJlYWs7Ci0JY2FzZSAxNDoKLQkJZHBsbCB8PSBEUExMQl9MVkRTX1AyX0NMT0NL
X0RJVl8xNDsKLQkJYnJlYWs7Ci0JfQotCi0JaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19z
dGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMpICYmCi0JICAgIGludGVsX3BhbmVsX3VzZV9zc2MoZGV2
X3ByaXYpKQotCQlkcGxsIHw9IFBMTEJfUkVGX0lOUFVUX1NQUkVBRFNQRUNUUlVNSU47Ci0JZWxz
ZQotCQlkcGxsIHw9IFBMTF9SRUZfSU5QVVRfRFJFRkNMSzsKLQotCWRwbGwgfD0gRFBMTF9WQ09f
RU5BQkxFOwotCi0JY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZS5kcGxsID0gZHBsbDsKLQljcnRj
X3N0YXRlLT5kcGxsX2h3X3N0YXRlLmZwMCA9IGZwOwotCWNydGNfc3RhdGUtPmRwbGxfaHdfc3Rh
dGUuZnAxID0gZnAyOwotfQotCi1zdGF0aWMgaW50IGlsa19jcnRjX2NvbXB1dGVfY2xvY2soc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9Ci0J
CXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT51YXBpLnN0YXRlKTsKLQljb25zdCBz
dHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0OwotCWludCByZWZjbGsgPSAxMjAwMDA7Ci0KLQltZW1z
ZXQoJmNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUsIDAsCi0JICAgICAgIHNpemVvZihjcnRjX3N0
YXRlLT5kcGxsX2h3X3N0YXRlKSk7Ci0KLQkvKiBDUFUgZURQIGlzIHRoZSBvbmx5IG91dHB1dCB0
aGF0IGRvZXNuJ3QgbmVlZCBhIFBDSCBQTEwgb2YgaXRzIG93bi4gKi8KLQlpZiAoIWNydGNfc3Rh
dGUtPmhhc19wY2hfZW5jb2RlcikKLQkJcmV0dXJuIDA7Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNf
dHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykpIHsKLQkJaWYgKGludGVsX3BhbmVs
X3VzZV9zc2MoZGV2X3ByaXYpKSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJ
CQkgICAgInVzaW5nIFNTQyByZWZlcmVuY2UgY2xvY2sgb2YgJWQga0h6XG4iLAotCQkJCSAgICBk
ZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2ZyZXEpOwotCQkJcmVmY2xrID0gZGV2X3ByaXYtPnZidC5s
dmRzX3NzY19mcmVxOwotCQl9Ci0KLQkJaWYgKGludGVsX2lzX2R1YWxfbGlua19sdmRzKGRldl9w
cml2KSkgewotCQkJaWYgKHJlZmNsayA9PSAxMDAwMDApCi0JCQkJbGltaXQgPSAmaWxrX2xpbWl0
c19kdWFsX2x2ZHNfMTAwbTsKLQkJCWVsc2UKLQkJCQlsaW1pdCA9ICZpbGtfbGltaXRzX2R1YWxf
bHZkczsKLQkJfSBlbHNlIHsKLQkJCWlmIChyZWZjbGsgPT0gMTAwMDAwKQotCQkJCWxpbWl0ID0g
Jmlsa19saW1pdHNfc2luZ2xlX2x2ZHNfMTAwbTsKLQkJCWVsc2UKLQkJCQlsaW1pdCA9ICZpbGtf
bGltaXRzX3NpbmdsZV9sdmRzOwotCQl9Ci0JfSBlbHNlIHsKLQkJbGltaXQgPSAmaWxrX2xpbWl0
c19kYWM7Ci0JfQotCi0JaWYgKCFjcnRjX3N0YXRlLT5jbG9ja19zZXQgJiYKLQkgICAgIWc0eF9m
aW5kX2Jlc3RfZHBsbChsaW1pdCwgY3J0Y19zdGF0ZSwgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywK
LQkJCQlyZWZjbGssIE5VTEwsICZjcnRjX3N0YXRlLT5kcGxsKSkgewotCQlkcm1fZXJyKCZkZXZf
cHJpdi0+ZHJtLAotCQkJIkNvdWxkbid0IGZpbmQgUExMIHNldHRpbmdzIGZvciBtb2RlIVxuIik7
Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWlsa19jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19z
dGF0ZSwgTlVMTCk7Ci0KLQlpZiAoIWludGVsX3Jlc2VydmVfc2hhcmVkX2RwbGxzKHN0YXRlLCBj
cnRjLCBOVUxMKSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiZmFp
bGVkIHRvIGZpbmQgUExMIGZvciBwaXBlICVjXG4iLAotCQkJICAgIHBpcGVfbmFtZShjcnRjLT5w
aXBlKSk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCXJldHVybiAwOwotfQotCiBzdGF0aWMg
dm9pZCBpbnRlbF9wY2hfdHJhbnNjb2Rlcl9nZXRfbV9uKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCQkJCQkgc3RydWN0IGludGVsX2xpbmtfbV9uICptX24pCiB7CkBAIC0xMDUxOSwyOSArOTIw
MSw2IEBAIHN0YXRpYyBib29sIGlsa19nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIGludCBoc3dfY3J0Y19jb21wdXRlX2Ns
b2NrKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUgPQotCQl0b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7Ci0K
LQlpZiAoIWludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RTSSkg
fHwKLQkgICAgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciA9Ci0JCQlpbnRlbF9nZXRfY3J0Y19uZXdfZW5jb2RlcihzdGF0ZSwgY3J0
Y19zdGF0ZSk7Ci0KLQkJaWYgKCFpbnRlbF9yZXNlcnZlX3NoYXJlZF9kcGxscyhzdGF0ZSwgY3J0
YywgZW5jb2RlcikpIHsKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAi
ZmFpbGVkIHRvIGZpbmQgUExMIGZvciBwaXBlICVjXG4iLAotCQkJCSAgICBwaXBlX25hbWUoY3J0
Yy0+cGlwZSkpOwotCQkJcmV0dXJuIC1FSU5WQUw7Ci0JCX0KLQl9Ci0KLQlyZXR1cm4gMDsKLX0K
LQogc3RhdGljIHZvaWQgZGcxX2dldF9kZGlfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQsCiAJCQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnKQogewpAQCAtMTY0NzYsNjkgKzE1MTM1LDI3IEBAIHZvaWQgaW50ZWxfaW5p
dF9kaXNwbGF5X2hvb2tzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlp
bnRlbF9pbml0X2NkY2xrX2hvb2tzKGRldl9wcml2KTsKIAorCWludGVsX2RwbGxfaW5pdF9jbG9j
a19ob29rKGRldl9wcml2KTsKKwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpIHsKIAkJ
ZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaHN3X2dldF9waXBlX2NvbmZpZzsK
LQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnID0KLQkJCXNrbF9n
ZXRfaW5pdGlhbF9wbGFuZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0
ZV9jbG9jayA9IGhzd19jcnRjX2NvbXB1dGVfY2xvY2s7CiAJCWRldl9wcml2LT5kaXNwbGF5LmNy
dGNfZW5hYmxlID0gaHN3X2NydGNfZW5hYmxlOwogCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rp
c2FibGUgPSBoc3dfY3J0Y19kaXNhYmxlOwogCX0gZWxzZSBpZiAoSEFTX0RESShkZXZfcHJpdikp
IHsKIAkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaHN3X2dldF9waXBlX2Nv
bmZpZzsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnID0KLQkJ
CWk5eHhfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRj
X2NvbXB1dGVfY2xvY2sgPQotCQkJaHN3X2NydGNfY29tcHV0ZV9jbG9jazsKIAkJZGV2X3ByaXYt
PmRpc3BsYXkuY3J0Y19lbmFibGUgPSBoc3dfY3J0Y19lbmFibGU7CiAJCWRldl9wcml2LT5kaXNw
bGF5LmNydGNfZGlzYWJsZSA9IGhzd19jcnRjX2Rpc2FibGU7CiAJfSBlbHNlIGlmIChIQVNfUENI
X1NQTElUKGRldl9wcml2KSkgewogCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlwZV9jb25maWcg
PSBpbGtfZ2V0X3BpcGVfY29uZmlnOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5nZXRfaW5pdGlhbF9w
bGFuZV9jb25maWcgPQotCQkJaTl4eF9nZXRfaW5pdGlhbF9wbGFuZV9jb25maWc7Ci0JCWRldl9w
cml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jayA9Ci0JCQlpbGtfY3J0Y19jb21wdXRlX2Ns
b2NrOwogCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2VuYWJsZSA9IGlsa19jcnRjX2VuYWJsZTsK
IAkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19kaXNhYmxlID0gaWxrX2NydGNfZGlzYWJsZTsKLQl9
IGVsc2UgaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7Ci0JCWRldl9wcml2LT5kaXNwbGF5
LmdldF9waXBlX2NvbmZpZyA9IGk5eHhfZ2V0X3BpcGVfY29uZmlnOwotCQlkZXZfcHJpdi0+ZGlz
cGxheS5nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcgPQotCQkJaTl4eF9nZXRfaW5pdGlhbF9wbGFu
ZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jayA9IGNodl9j
cnRjX2NvbXB1dGVfY2xvY2s7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfZW5hYmxlID0gdmFs
bGV5dmlld19jcnRjX2VuYWJsZTsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19kaXNhYmxlID0g
aTl4eF9jcnRjX2Rpc2FibGU7Ci0JfSBlbHNlIGlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSkg
eworCX0gZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgfHwKKwkJICAgSVNfVkFMTEVZ
VklFVyhkZXZfcHJpdikpIHsKIAkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0g
aTl4eF9nZXRfcGlwZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFsX3Bs
YW5lX2NvbmZpZyA9Ci0JCQlpOXh4X2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZzsKLQkJZGV2X3By
aXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrID0gdmx2X2NydGNfY29tcHV0ZV9jbG9jazsK
IAkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFibGUgPSB2YWxsZXl2aWV3X2NydGNfZW5hYmxl
OwogCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rpc2FibGUgPSBpOXh4X2NydGNfZGlzYWJsZTsK
LQl9IGVsc2UgaWYgKElTX0c0WChkZXZfcHJpdikpIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0
X3BpcGVfY29uZmlnID0gaTl4eF9nZXRfcGlwZV9jb25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5
LmdldF9pbml0aWFsX3BsYW5lX2NvbmZpZyA9Ci0JCQlpOXh4X2dldF9pbml0aWFsX3BsYW5lX2Nv
bmZpZzsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrID0gZzR4X2NydGNf
Y29tcHV0ZV9jbG9jazsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFibGUgPSBpOXh4X2Ny
dGNfZW5hYmxlOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rpc2FibGUgPSBpOXh4X2NydGNf
ZGlzYWJsZTsKLQl9IGVsc2UgaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSkgewotCQlkZXZfcHJp
di0+ZGlzcGxheS5nZXRfcGlwZV9jb25maWcgPSBpOXh4X2dldF9waXBlX2NvbmZpZzsKLQkJZGV2
X3ByaXYtPmRpc3BsYXkuZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnID0KLQkJCWk5eHhfZ2V0X2lu
aXRpYWxfcGxhbmVfY29uZmlnOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xv
Y2sgPSBwbnZfY3J0Y19jb21wdXRlX2Nsb2NrOwotCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Vu
YWJsZSA9IGk5eHhfY3J0Y19lbmFibGU7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNydGNfZGlzYWJs
ZSA9IGk5eHhfY3J0Y19kaXNhYmxlOwotCX0gZWxzZSBpZiAoIUlTX0dFTihkZXZfcHJpdiwgMikp
IHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4eF9nZXRfcGlwZV9j
b25maWc7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFsX3BsYW5lX2NvbmZpZyA9Ci0J
CQlpOXh4X2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZzsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0
Y19jb21wdXRlX2Nsb2NrID0gaTl4eF9jcnRjX2NvbXB1dGVfY2xvY2s7Ci0JCWRldl9wcml2LT5k
aXNwbGF5LmNydGNfZW5hYmxlID0gaTl4eF9jcnRjX2VuYWJsZTsKLQkJZGV2X3ByaXYtPmRpc3Bs
YXkuY3J0Y19kaXNhYmxlID0gaTl4eF9jcnRjX2Rpc2FibGU7CiAJfSBlbHNlIHsKIAkJZGV2X3By
aXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnID0gaTl4eF9nZXRfcGlwZV9jb25maWc7Ci0JCWRl
dl9wcml2LT5kaXNwbGF5LmdldF9pbml0aWFsX3BsYW5lX2NvbmZpZyA9Ci0JCQlpOXh4X2dldF9p
bml0aWFsX3BsYW5lX2NvbmZpZzsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Ns
b2NrID0gaTh4eF9jcnRjX2NvbXB1dGVfY2xvY2s7CiAJCWRldl9wcml2LT5kaXNwbGF5LmNydGNf
ZW5hYmxlID0gaTl4eF9jcnRjX2VuYWJsZTsKIAkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19kaXNh
YmxlID0gaTl4eF9jcnRjX2Rpc2FibGU7CiAJfQpAQCAtMTY1NTIsMTAgKzE1MTY5LDEzIEBAIHZv
aWQgaW50ZWxfaW5pdF9kaXNwbGF5X2hvb2tzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJZGV2X3ByaXYtPmRpc3BsYXkuZmRpX2xpbmtfdHJhaW4gPSBpdmJfbWFudWFsX2Zk
aV9saW5rX3RyYWluOwogCX0KIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCisJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkgewogCQlkZXZfcHJpdi0+ZGlzcGxheS5jb21taXRf
bW9kZXNldF9lbmFibGVzID0gc2tsX2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXM7Ci0JZWxzZQorCQlk
ZXZfcHJpdi0+ZGlzcGxheS5nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcgPSBza2xfZ2V0X2luaXRp
YWxfcGxhbmVfY29uZmlnOworCX0gZWxzZSB7CiAJCWRldl9wcml2LT5kaXNwbGF5LmNvbW1pdF9t
b2Rlc2V0X2VuYWJsZXMgPSBpbnRlbF9jb21taXRfbW9kZXNldF9lbmFibGVzOworCQlkZXZfcHJp
di0+ZGlzcGxheS5nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcgPSBpOXh4X2dldF9pbml0aWFsX3Bs
YW5lX2NvbmZpZzsKKwl9CiAKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuaAppbmRleCA3MTdiMGU0MTYwZTkuLjM3NmNlYzcxYjQ3NyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTY1Myw2ICs2NTMs
OSBAQCB1MzIgaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldChpbnQgKngsIGludCAq
eSwKIAkJCQkgICAgICAgaW50IGNvbG9yX3BsYW5lKTsKIGludCBpbnRlbF9wbGFuZV9waW5fZmIo
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiB2b2lkIGludGVsX3BsYW5l
X3VucGluX2ZiKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRlKTsKK3N0
cnVjdCBpbnRlbF9lbmNvZGVyICoKK2ludGVsX2dldF9jcnRjX25ld19lbmNvZGVyKGNvbnN0IHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJICAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCiAvKiBtb2Rlc2V0dGluZyAqLwogdm9pZCBpbnRl
bF9tb2Rlc2V0X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRl
eCBkZmEzOTY2ZTVmYTEuLjM3YTlmMzA0Y2I1NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTE4MTEsNCArMTgxMSwxNyBA
QCB0b19pbnRlbF9mcm9udGJ1ZmZlcihzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKIAlyZXR1
cm4gZmIgPyB0b19pbnRlbF9mcmFtZWJ1ZmZlcihmYiktPmZyb250YnVmZmVyIDogTlVMTDsKIH0K
IAorc3RhdGljIGlubGluZSBib29sIGludGVsX3BhbmVsX3VzZV9zc2Moc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQoreworCWlmIChkZXZfcHJpdi0+cGFyYW1zLnBhbmVsX3VzZV9z
c2MgPj0gMCkKKwkJcmV0dXJuIGRldl9wcml2LT5wYXJhbXMucGFuZWxfdXNlX3NzYyAhPSAwOwor
CXJldHVybiBkZXZfcHJpdi0+dmJ0Lmx2ZHNfdXNlX3NzYworCQkmJiAhKGRldl9wcml2LT5xdWly
a3MgJiBRVUlSS19MVkRTX1NTQ19ESVNBQkxFKTsKK30KKworc3RhdGljIGlubGluZSB1MzIgaTl4
eF9kcGxsX2NvbXB1dGVfZnAoc3RydWN0IGRwbGwgKmRwbGwpCit7CisJcmV0dXJuIGRwbGwtPm4g
PDwgMTYgfCBkcGxsLT5tMSA8PCA4IHwgZHBsbC0+bTI7Cit9CisKICNlbmRpZiAvKiAgX19JTlRF
TF9ESVNQTEFZX1RZUEVTX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcGxsLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RwbGwuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjdiYTdmMzE1
YWFlZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHBsbC5jCkBAIC0wLDAgKzEsMTM2MyBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IE1JVAorLyoKKyAqIENvcHlyaWdodCDCqSAyMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8KKyNp
bmNsdWRlIDxsaW51eC9rZXJuZWwuaD4KKyNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgi
CisjaW5jbHVkZSAiaW50ZWxfZGlzcGxheS5oIgorI2luY2x1ZGUgImludGVsX2RwbGwuaCIKKyNp
bmNsdWRlICJpbnRlbF9sdmRzLmgiCisjaW5jbHVkZSAiaW50ZWxfcGFuZWwuaCIKKworc3RydWN0
IGludGVsX2xpbWl0IHsKKwlzdHJ1Y3QgeworCQlpbnQgbWluLCBtYXg7CisJfSBkb3QsIHZjbywg
biwgbSwgbTEsIG0yLCBwLCBwMTsKKworCXN0cnVjdCB7CisJCWludCBkb3RfbGltaXQ7CisJCWlu
dCBwMl9zbG93LCBwMl9mYXN0OworCX0gcDI7Cit9Oworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRl
bF9saW1pdCBpbnRlbF9saW1pdHNfaTh4eF9kYWMgPSB7CisJLmRvdCA9IHsgLm1pbiA9IDI1MDAw
LCAubWF4ID0gMzUwMDAwIH0sCisJLnZjbyA9IHsgLm1pbiA9IDkwODAwMCwgLm1heCA9IDE1MTIw
MDAgfSwKKwkubiA9IHsgLm1pbiA9IDIsIC5tYXggPSAxNiB9LAorCS5tID0geyAubWluID0gOTYs
IC5tYXggPSAxNDAgfSwKKwkubTEgPSB7IC5taW4gPSAxOCwgLm1heCA9IDI2IH0sCisJLm0yID0g
eyAubWluID0gNiwgLm1heCA9IDE2IH0sCisJLnAgPSB7IC5taW4gPSA0LCAubWF4ID0gMTI4IH0s
CisJLnAxID0geyAubWluID0gMiwgLm1heCA9IDMzIH0sCisJLnAyID0geyAuZG90X2xpbWl0ID0g
MTY1MDAwLAorCQkucDJfc2xvdyA9IDQsIC5wMl9mYXN0ID0gMiB9LAorfTsKKworc3RhdGljIGNv
bnN0IHN0cnVjdCBpbnRlbF9saW1pdCBpbnRlbF9saW1pdHNfaTh4eF9kdm8gPSB7CisJLmRvdCA9
IHsgLm1pbiA9IDI1MDAwLCAubWF4ID0gMzUwMDAwIH0sCisJLnZjbyA9IHsgLm1pbiA9IDkwODAw
MCwgLm1heCA9IDE1MTIwMDAgfSwKKwkubiA9IHsgLm1pbiA9IDIsIC5tYXggPSAxNiB9LAorCS5t
ID0geyAubWluID0gOTYsIC5tYXggPSAxNDAgfSwKKwkubTEgPSB7IC5taW4gPSAxOCwgLm1heCA9
IDI2IH0sCisJLm0yID0geyAubWluID0gNiwgLm1heCA9IDE2IH0sCisJLnAgPSB7IC5taW4gPSA0
LCAubWF4ID0gMTI4IH0sCisJLnAxID0geyAubWluID0gMiwgLm1heCA9IDMzIH0sCisJLnAyID0g
eyAuZG90X2xpbWl0ID0gMTY1MDAwLAorCQkucDJfc2xvdyA9IDQsIC5wMl9mYXN0ID0gNCB9LAor
fTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCBpbnRlbF9saW1pdHNfaTh4eF9s
dmRzID0geworCS5kb3QgPSB7IC5taW4gPSAyNTAwMCwgLm1heCA9IDM1MDAwMCB9LAorCS52Y28g
PSB7IC5taW4gPSA5MDgwMDAsIC5tYXggPSAxNTEyMDAwIH0sCisJLm4gPSB7IC5taW4gPSAyLCAu
bWF4ID0gMTYgfSwKKwkubSA9IHsgLm1pbiA9IDk2LCAubWF4ID0gMTQwIH0sCisJLm0xID0geyAu
bWluID0gMTgsIC5tYXggPSAyNiB9LAorCS5tMiA9IHsgLm1pbiA9IDYsIC5tYXggPSAxNiB9LAor
CS5wID0geyAubWluID0gNCwgLm1heCA9IDEyOCB9LAorCS5wMSA9IHsgLm1pbiA9IDEsIC5tYXgg
PSA2IH0sCisJLnAyID0geyAuZG90X2xpbWl0ID0gMTY1MDAwLAorCQkucDJfc2xvdyA9IDE0LCAu
cDJfZmFzdCA9IDcgfSwKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaW50
ZWxfbGltaXRzX2k5eHhfc2R2byA9IHsKKwkuZG90ID0geyAubWluID0gMjAwMDAsIC5tYXggPSA0
MDAwMDAgfSwKKwkudmNvID0geyAubWluID0gMTQwMDAwMCwgLm1heCA9IDI4MDAwMDAgfSwKKwku
biA9IHsgLm1pbiA9IDEsIC5tYXggPSA2IH0sCisJLm0gPSB7IC5taW4gPSA3MCwgLm1heCA9IDEy
MCB9LAorCS5tMSA9IHsgLm1pbiA9IDgsIC5tYXggPSAxOCB9LAorCS5tMiA9IHsgLm1pbiA9IDMs
IC5tYXggPSA3IH0sCisJLnAgPSB7IC5taW4gPSA1LCAubWF4ID0gODAgfSwKKwkucDEgPSB7IC5t
aW4gPSAxLCAubWF4ID0gOCB9LAorCS5wMiA9IHsgLmRvdF9saW1pdCA9IDIwMDAwMCwKKwkJLnAy
X3Nsb3cgPSAxMCwgLnAyX2Zhc3QgPSA1IH0sCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGlu
dGVsX2xpbWl0IGludGVsX2xpbWl0c19pOXh4X2x2ZHMgPSB7CisJLmRvdCA9IHsgLm1pbiA9IDIw
MDAwLCAubWF4ID0gNDAwMDAwIH0sCisJLnZjbyA9IHsgLm1pbiA9IDE0MDAwMDAsIC5tYXggPSAy
ODAwMDAwIH0sCisJLm4gPSB7IC5taW4gPSAxLCAubWF4ID0gNiB9LAorCS5tID0geyAubWluID0g
NzAsIC5tYXggPSAxMjAgfSwKKwkubTEgPSB7IC5taW4gPSA4LCAubWF4ID0gMTggfSwKKwkubTIg
PSB7IC5taW4gPSAzLCAubWF4ID0gNyB9LAorCS5wID0geyAubWluID0gNywgLm1heCA9IDk4IH0s
CisJLnAxID0geyAubWluID0gMSwgLm1heCA9IDggfSwKKwkucDIgPSB7IC5kb3RfbGltaXQgPSAx
MTIwMDAsCisJCS5wMl9zbG93ID0gMTQsIC5wMl9mYXN0ID0gNyB9LAorfTsKKworCitzdGF0aWMg
Y29uc3Qgc3RydWN0IGludGVsX2xpbWl0IGludGVsX2xpbWl0c19nNHhfc2R2byA9IHsKKwkuZG90
ID0geyAubWluID0gMjUwMDAsIC5tYXggPSAyNzAwMDAgfSwKKwkudmNvID0geyAubWluID0gMTc1
MDAwMCwgLm1heCA9IDM1MDAwMDB9LAorCS5uID0geyAubWluID0gMSwgLm1heCA9IDQgfSwKKwku
bSA9IHsgLm1pbiA9IDEwNCwgLm1heCA9IDEzOCB9LAorCS5tMSA9IHsgLm1pbiA9IDE3LCAubWF4
ID0gMjMgfSwKKwkubTIgPSB7IC5taW4gPSA1LCAubWF4ID0gMTEgfSwKKwkucCA9IHsgLm1pbiA9
IDEwLCAubWF4ID0gMzAgfSwKKwkucDEgPSB7IC5taW4gPSAxLCAubWF4ID0gM30sCisJLnAyID0g
eyAuZG90X2xpbWl0ID0gMjcwMDAwLAorCQkucDJfc2xvdyA9IDEwLAorCQkucDJfZmFzdCA9IDEw
CisJfSwKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaW50ZWxfbGltaXRz
X2c0eF9oZG1pID0geworCS5kb3QgPSB7IC5taW4gPSAyMjAwMCwgLm1heCA9IDQwMDAwMCB9LAor
CS52Y28gPSB7IC5taW4gPSAxNzUwMDAwLCAubWF4ID0gMzUwMDAwMH0sCisJLm4gPSB7IC5taW4g
PSAxLCAubWF4ID0gNCB9LAorCS5tID0geyAubWluID0gMTA0LCAubWF4ID0gMTM4IH0sCisJLm0x
ID0geyAubWluID0gMTYsIC5tYXggPSAyMyB9LAorCS5tMiA9IHsgLm1pbiA9IDUsIC5tYXggPSAx
MSB9LAorCS5wID0geyAubWluID0gNSwgLm1heCA9IDgwIH0sCisJLnAxID0geyAubWluID0gMSwg
Lm1heCA9IDh9LAorCS5wMiA9IHsgLmRvdF9saW1pdCA9IDE2NTAwMCwKKwkJLnAyX3Nsb3cgPSAx
MCwgLnAyX2Zhc3QgPSA1IH0sCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2xpbWl0
IGludGVsX2xpbWl0c19nNHhfc2luZ2xlX2NoYW5uZWxfbHZkcyA9IHsKKwkuZG90ID0geyAubWlu
ID0gMjAwMDAsIC5tYXggPSAxMTUwMDAgfSwKKwkudmNvID0geyAubWluID0gMTc1MDAwMCwgLm1h
eCA9IDM1MDAwMDAgfSwKKwkubiA9IHsgLm1pbiA9IDEsIC5tYXggPSAzIH0sCisJLm0gPSB7IC5t
aW4gPSAxMDQsIC5tYXggPSAxMzggfSwKKwkubTEgPSB7IC5taW4gPSAxNywgLm1heCA9IDIzIH0s
CisJLm0yID0geyAubWluID0gNSwgLm1heCA9IDExIH0sCisJLnAgPSB7IC5taW4gPSAyOCwgLm1h
eCA9IDExMiB9LAorCS5wMSA9IHsgLm1pbiA9IDIsIC5tYXggPSA4IH0sCisJLnAyID0geyAuZG90
X2xpbWl0ID0gMCwKKwkJLnAyX3Nsb3cgPSAxNCwgLnAyX2Zhc3QgPSAxNAorCX0sCit9OworCitz
dGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2xpbWl0IGludGVsX2xpbWl0c19nNHhfZHVhbF9jaGFu
bmVsX2x2ZHMgPSB7CisJLmRvdCA9IHsgLm1pbiA9IDgwMDAwLCAubWF4ID0gMjI0MDAwIH0sCisJ
LnZjbyA9IHsgLm1pbiA9IDE3NTAwMDAsIC5tYXggPSAzNTAwMDAwIH0sCisJLm4gPSB7IC5taW4g
PSAxLCAubWF4ID0gMyB9LAorCS5tID0geyAubWluID0gMTA0LCAubWF4ID0gMTM4IH0sCisJLm0x
ID0geyAubWluID0gMTcsIC5tYXggPSAyMyB9LAorCS5tMiA9IHsgLm1pbiA9IDUsIC5tYXggPSAx
MSB9LAorCS5wID0geyAubWluID0gMTQsIC5tYXggPSA0MiB9LAorCS5wMSA9IHsgLm1pbiA9IDIs
IC5tYXggPSA2IH0sCisJLnAyID0geyAuZG90X2xpbWl0ID0gMCwKKwkJLnAyX3Nsb3cgPSA3LCAu
cDJfZmFzdCA9IDcKKwl9LAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCBw
bnZfbGltaXRzX3Nkdm8gPSB7CisJLmRvdCA9IHsgLm1pbiA9IDIwMDAwLCAubWF4ID0gNDAwMDAw
fSwKKwkudmNvID0geyAubWluID0gMTcwMDAwMCwgLm1heCA9IDM1MDAwMDAgfSwKKwkvKiBQaW5l
dmlldydzIE5jb3VudGVyIGlzIGEgcmluZyBjb3VudGVyICovCisJLm4gPSB7IC5taW4gPSAzLCAu
bWF4ID0gNiB9LAorCS5tID0geyAubWluID0gMiwgLm1heCA9IDI1NiB9LAorCS8qIFBpbmV2aWV3
IG9ubHkgaGFzIG9uZSBjb21iaW5lZCBtIGRpdmlkZXIsIHdoaWNoIHdlIHRyZWF0IGFzIG0yLiAq
LworCS5tMSA9IHsgLm1pbiA9IDAsIC5tYXggPSAwIH0sCisJLm0yID0geyAubWluID0gMCwgLm1h
eCA9IDI1NCB9LAorCS5wID0geyAubWluID0gNSwgLm1heCA9IDgwIH0sCisJLnAxID0geyAubWlu
ID0gMSwgLm1heCA9IDggfSwKKwkucDIgPSB7IC5kb3RfbGltaXQgPSAyMDAwMDAsCisJCS5wMl9z
bG93ID0gMTAsIC5wMl9mYXN0ID0gNSB9LAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRl
bF9saW1pdCBwbnZfbGltaXRzX2x2ZHMgPSB7CisJLmRvdCA9IHsgLm1pbiA9IDIwMDAwLCAubWF4
ID0gNDAwMDAwIH0sCisJLnZjbyA9IHsgLm1pbiA9IDE3MDAwMDAsIC5tYXggPSAzNTAwMDAwIH0s
CisJLm4gPSB7IC5taW4gPSAzLCAubWF4ID0gNiB9LAorCS5tID0geyAubWluID0gMiwgLm1heCA9
IDI1NiB9LAorCS5tMSA9IHsgLm1pbiA9IDAsIC5tYXggPSAwIH0sCisJLm0yID0geyAubWluID0g
MCwgLm1heCA9IDI1NCB9LAorCS5wID0geyAubWluID0gNywgLm1heCA9IDExMiB9LAorCS5wMSA9
IHsgLm1pbiA9IDEsIC5tYXggPSA4IH0sCisJLnAyID0geyAuZG90X2xpbWl0ID0gMTEyMDAwLAor
CQkucDJfc2xvdyA9IDE0LCAucDJfZmFzdCA9IDE0IH0sCit9OworCisvKiBJcm9ubGFrZSAvIFNh
bmR5YnJpZGdlCisgKgorICogV2UgY2FsY3VsYXRlIGNsb2NrIHVzaW5nIChyZWdpc3Rlcl92YWx1
ZSArIDIpIGZvciBOL00xL00yLCBzbyBoZXJlCisgKiB0aGUgcmFuZ2UgdmFsdWUgZm9yIHRoZW0g
aXMgKGFjdHVhbF92YWx1ZSAtIDIpLgorICovCitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2xp
bWl0IGlsa19saW1pdHNfZGFjID0geworCS5kb3QgPSB7IC5taW4gPSAyNTAwMCwgLm1heCA9IDM1
MDAwMCB9LAorCS52Y28gPSB7IC5taW4gPSAxNzYwMDAwLCAubWF4ID0gMzUxMDAwMCB9LAorCS5u
ID0geyAubWluID0gMSwgLm1heCA9IDUgfSwKKwkubSA9IHsgLm1pbiA9IDc5LCAubWF4ID0gMTI3
IH0sCisJLm0xID0geyAubWluID0gMTIsIC5tYXggPSAyMiB9LAorCS5tMiA9IHsgLm1pbiA9IDUs
IC5tYXggPSA5IH0sCisJLnAgPSB7IC5taW4gPSA1LCAubWF4ID0gODAgfSwKKwkucDEgPSB7IC5t
aW4gPSAxLCAubWF4ID0gOCB9LAorCS5wMiA9IHsgLmRvdF9saW1pdCA9IDIyNTAwMCwKKwkJLnAy
X3Nsb3cgPSAxMCwgLnAyX2Zhc3QgPSA1IH0sCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGlu
dGVsX2xpbWl0IGlsa19saW1pdHNfc2luZ2xlX2x2ZHMgPSB7CisJLmRvdCA9IHsgLm1pbiA9IDI1
MDAwLCAubWF4ID0gMzUwMDAwIH0sCisJLnZjbyA9IHsgLm1pbiA9IDE3NjAwMDAsIC5tYXggPSAz
NTEwMDAwIH0sCisJLm4gPSB7IC5taW4gPSAxLCAubWF4ID0gMyB9LAorCS5tID0geyAubWluID0g
NzksIC5tYXggPSAxMTggfSwKKwkubTEgPSB7IC5taW4gPSAxMiwgLm1heCA9IDIyIH0sCisJLm0y
ID0geyAubWluID0gNSwgLm1heCA9IDkgfSwKKwkucCA9IHsgLm1pbiA9IDI4LCAubWF4ID0gMTEy
IH0sCisJLnAxID0geyAubWluID0gMiwgLm1heCA9IDggfSwKKwkucDIgPSB7IC5kb3RfbGltaXQg
PSAyMjUwMDAsCisJCS5wMl9zbG93ID0gMTQsIC5wMl9mYXN0ID0gMTQgfSwKK307CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgaWxrX2xpbWl0c19kdWFsX2x2ZHMgPSB7CisJLmRv
dCA9IHsgLm1pbiA9IDI1MDAwLCAubWF4ID0gMzUwMDAwIH0sCisJLnZjbyA9IHsgLm1pbiA9IDE3
NjAwMDAsIC5tYXggPSAzNTEwMDAwIH0sCisJLm4gPSB7IC5taW4gPSAxLCAubWF4ID0gMyB9LAor
CS5tID0geyAubWluID0gNzksIC5tYXggPSAxMjcgfSwKKwkubTEgPSB7IC5taW4gPSAxMiwgLm1h
eCA9IDIyIH0sCisJLm0yID0geyAubWluID0gNSwgLm1heCA9IDkgfSwKKwkucCA9IHsgLm1pbiA9
IDE0LCAubWF4ID0gNTYgfSwKKwkucDEgPSB7IC5taW4gPSAyLCAubWF4ID0gOCB9LAorCS5wMiA9
IHsgLmRvdF9saW1pdCA9IDIyNTAwMCwKKwkJLnAyX3Nsb3cgPSA3LCAucDJfZmFzdCA9IDcgfSwK
K307CisKKy8qIExWRFMgMTAwbWh6IHJlZmNsayBsaW1pdHMuICovCitzdGF0aWMgY29uc3Qgc3Ry
dWN0IGludGVsX2xpbWl0IGlsa19saW1pdHNfc2luZ2xlX2x2ZHNfMTAwbSA9IHsKKwkuZG90ID0g
eyAubWluID0gMjUwMDAsIC5tYXggPSAzNTAwMDAgfSwKKwkudmNvID0geyAubWluID0gMTc2MDAw
MCwgLm1heCA9IDM1MTAwMDAgfSwKKwkubiA9IHsgLm1pbiA9IDEsIC5tYXggPSAyIH0sCisJLm0g
PSB7IC5taW4gPSA3OSwgLm1heCA9IDEyNiB9LAorCS5tMSA9IHsgLm1pbiA9IDEyLCAubWF4ID0g
MjIgfSwKKwkubTIgPSB7IC5taW4gPSA1LCAubWF4ID0gOSB9LAorCS5wID0geyAubWluID0gMjgs
IC5tYXggPSAxMTIgfSwKKwkucDEgPSB7IC5taW4gPSAyLCAubWF4ID0gOCB9LAorCS5wMiA9IHsg
LmRvdF9saW1pdCA9IDIyNTAwMCwKKwkJLnAyX3Nsb3cgPSAxNCwgLnAyX2Zhc3QgPSAxNCB9LAor
fTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCBpbGtfbGltaXRzX2R1YWxfbHZk
c18xMDBtID0geworCS5kb3QgPSB7IC5taW4gPSAyNTAwMCwgLm1heCA9IDM1MDAwMCB9LAorCS52
Y28gPSB7IC5taW4gPSAxNzYwMDAwLCAubWF4ID0gMzUxMDAwMCB9LAorCS5uID0geyAubWluID0g
MSwgLm1heCA9IDMgfSwKKwkubSA9IHsgLm1pbiA9IDc5LCAubWF4ID0gMTI2IH0sCisJLm0xID0g
eyAubWluID0gMTIsIC5tYXggPSAyMiB9LAorCS5tMiA9IHsgLm1pbiA9IDUsIC5tYXggPSA5IH0s
CisJLnAgPSB7IC5taW4gPSAxNCwgLm1heCA9IDQyIH0sCisJLnAxID0geyAubWluID0gMiwgLm1h
eCA9IDYgfSwKKwkucDIgPSB7IC5kb3RfbGltaXQgPSAyMjUwMDAsCisJCS5wMl9zbG93ID0gNywg
LnAyX2Zhc3QgPSA3IH0sCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2xpbWl0IGlu
dGVsX2xpbWl0c192bHYgPSB7CisJIC8qCisJICAqIFRoZXNlIGFyZSB0aGUgZGF0YSByYXRlIGxp
bWl0cyAobWVhc3VyZWQgaW4gZmFzdCBjbG9ja3MpCisJICAqIHNpbmNlIHRob3NlIGFyZSB0aGUg
c3RyaWN0ZXN0IGxpbWl0cyB3ZSBoYXZlLiBUaGUgZmFzdAorCSAgKiBjbG9jayBhbmQgYWN0dWFs
IHJhdGUgbGltaXRzIGFyZSBtb3JlIHJlbGF4ZWQsIHNvIGNoZWNraW5nCisJICAqIHRoZW0gd291
bGQgbWFrZSBubyBkaWZmZXJlbmNlLgorCSAgKi8KKwkuZG90ID0geyAubWluID0gMjUwMDAgKiA1
LCAubWF4ID0gMjcwMDAwICogNSB9LAorCS52Y28gPSB7IC5taW4gPSA0MDAwMDAwLCAubWF4ID0g
NjAwMDAwMCB9LAorCS5uID0geyAubWluID0gMSwgLm1heCA9IDcgfSwKKwkubTEgPSB7IC5taW4g
PSAyLCAubWF4ID0gMyB9LAorCS5tMiA9IHsgLm1pbiA9IDExLCAubWF4ID0gMTU2IH0sCisJLnAx
ID0geyAubWluID0gMiwgLm1heCA9IDMgfSwKKwkucDIgPSB7IC5wMl9zbG93ID0gMiwgLnAyX2Zh
c3QgPSAyMCB9LCAvKiBzbG93PW1pbiwgZmFzdD1tYXggKi8KK307CisKK3N0YXRpYyBjb25zdCBz
dHJ1Y3QgaW50ZWxfbGltaXQgaW50ZWxfbGltaXRzX2NodiA9IHsKKwkvKgorCSAqIFRoZXNlIGFy
ZSB0aGUgZGF0YSByYXRlIGxpbWl0cyAobWVhc3VyZWQgaW4gZmFzdCBjbG9ja3MpCisJICogc2lu
Y2UgdGhvc2UgYXJlIHRoZSBzdHJpY3Rlc3QgbGltaXRzIHdlIGhhdmUuICBUaGUgZmFzdAorCSAq
IGNsb2NrIGFuZCBhY3R1YWwgcmF0ZSBsaW1pdHMgYXJlIG1vcmUgcmVsYXhlZCwgc28gY2hlY2tp
bmcKKwkgKiB0aGVtIHdvdWxkIG1ha2Ugbm8gZGlmZmVyZW5jZS4KKwkgKi8KKwkuZG90ID0geyAu
bWluID0gMjUwMDAgKiA1LCAubWF4ID0gNTQwMDAwICogNX0sCisJLnZjbyA9IHsgLm1pbiA9IDQ4
MDAwMDAsIC5tYXggPSA2NDgwMDAwIH0sCisJLm4gPSB7IC5taW4gPSAxLCAubWF4ID0gMSB9LAor
CS5tMSA9IHsgLm1pbiA9IDIsIC5tYXggPSAyIH0sCisJLm0yID0geyAubWluID0gMjQgPDwgMjIs
IC5tYXggPSAxNzUgPDwgMjIgfSwKKwkucDEgPSB7IC5taW4gPSAyLCAubWF4ID0gNCB9LAorCS5w
MiA9IHsJLnAyX3Nsb3cgPSAxLCAucDJfZmFzdCA9IDE0IH0sCit9OworCitzdGF0aWMgY29uc3Qg
c3RydWN0IGludGVsX2xpbWl0IGludGVsX2xpbWl0c19ieHQgPSB7CisJLyogRklYTUU6IGZpbmQg
cmVhbCBkb3QgbGltaXRzICovCisJLmRvdCA9IHsgLm1pbiA9IDAsIC5tYXggPSBJTlRfTUFYIH0s
CisJLnZjbyA9IHsgLm1pbiA9IDQ4MDAwMDAsIC5tYXggPSA2NzAwMDAwIH0sCisJLm4gPSB7IC5t
aW4gPSAxLCAubWF4ID0gMSB9LAorCS5tMSA9IHsgLm1pbiA9IDIsIC5tYXggPSAyIH0sCisJLyog
RklYTUU6IGZpbmQgcmVhbCBtMiBsaW1pdHMgKi8KKwkubTIgPSB7IC5taW4gPSAyIDw8IDIyLCAu
bWF4ID0gMjU1IDw8IDIyIH0sCisJLnAxID0geyAubWluID0gMiwgLm1heCA9IDQgfSwKKwkucDIg
PSB7IC5wMl9zbG93ID0gMSwgLnAyX2Zhc3QgPSAyMCB9LAorfTsKKworLyoKKyAqIFBsYXRmb3Jt
IHNwZWNpZmljIGhlbHBlcnMgdG8gY2FsY3VsYXRlIHRoZSBwb3J0IFBMTCBsb29wYmFjay0gKGNs
b2NrLm0pLAorICogYW5kIHBvc3QtZGl2aWRlciAoY2xvY2sucCkgdmFsdWVzLCBwcmUtIChjbG9j
ay52Y28pIGFuZCBwb3N0LWRpdmlkZWQgZmFzdAorICogKGNsb2NrLmRvdCkgY2xvY2sgcmF0ZXMu
IFRoaXMgZmFzdCBkb3QgY2xvY2sgaXMgZmVkIHRvIHRoZSBwb3J0J3MgSU8gbG9naWMuCisgKiBU
aGUgaGVscGVycycgcmV0dXJuIHZhbHVlIGlzIHRoZSByYXRlIG9mIHRoZSBjbG9jayB0aGF0IGlz
IGZlZCB0byB0aGUKKyAqIGRpc3BsYXkgZW5naW5lJ3MgcGlwZSB3aGljaCBjYW4gYmUgdGhlIGFi
b3ZlIGZhc3QgZG90IGNsb2NrIHJhdGUgb3IgYQorICogZGl2aWRlZC1kb3duIHZlcnNpb24gb2Yg
aXQuCisgKi8KKy8qIG0xIGlzIHJlc2VydmVkIGFzIDAgaW4gUGluZXZpZXcsIG4gaXMgYSByaW5n
IGNvdW50ZXIgKi8KK2ludCBwbnZfY2FsY19kcGxsX3BhcmFtcyhpbnQgcmVmY2xrLCBzdHJ1Y3Qg
ZHBsbCAqY2xvY2spCit7CisJY2xvY2stPm0gPSBjbG9jay0+bTIgKyAyOworCWNsb2NrLT5wID0g
Y2xvY2stPnAxICogY2xvY2stPnAyOworCWlmIChXQVJOX09OKGNsb2NrLT5uID09IDAgfHwgY2xv
Y2stPnAgPT0gMCkpCisJCXJldHVybiAwOworCWNsb2NrLT52Y28gPSBESVZfUk9VTkRfQ0xPU0VT
VChyZWZjbGsgKiBjbG9jay0+bSwgY2xvY2stPm4pOworCWNsb2NrLT5kb3QgPSBESVZfUk9VTkRf
Q0xPU0VTVChjbG9jay0+dmNvLCBjbG9jay0+cCk7CisKKwlyZXR1cm4gY2xvY2stPmRvdDsKK30K
Kworc3RhdGljIHUzMiBpOXh4X2RwbGxfY29tcHV0ZV9tKHN0cnVjdCBkcGxsICpkcGxsKQorewor
CXJldHVybiA1ICogKGRwbGwtPm0xICsgMikgKyAoZHBsbC0+bTIgKyAyKTsKK30KKworaW50IGk5
eHhfY2FsY19kcGxsX3BhcmFtcyhpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqY2xvY2spCit7CisJ
Y2xvY2stPm0gPSBpOXh4X2RwbGxfY29tcHV0ZV9tKGNsb2NrKTsKKwljbG9jay0+cCA9IGNsb2Nr
LT5wMSAqIGNsb2NrLT5wMjsKKwlpZiAoV0FSTl9PTihjbG9jay0+biArIDIgPT0gMCB8fCBjbG9j
ay0+cCA9PSAwKSkKKwkJcmV0dXJuIDA7CisJY2xvY2stPnZjbyA9IERJVl9ST1VORF9DTE9TRVNU
KHJlZmNsayAqIGNsb2NrLT5tLCBjbG9jay0+biArIDIpOworCWNsb2NrLT5kb3QgPSBESVZfUk9V
TkRfQ0xPU0VTVChjbG9jay0+dmNvLCBjbG9jay0+cCk7CisKKwlyZXR1cm4gY2xvY2stPmRvdDsK
K30KKworaW50IHZsdl9jYWxjX2RwbGxfcGFyYW1zKGludCByZWZjbGssIHN0cnVjdCBkcGxsICpj
bG9jaykKK3sKKwljbG9jay0+bSA9IGNsb2NrLT5tMSAqIGNsb2NrLT5tMjsKKwljbG9jay0+cCA9
IGNsb2NrLT5wMSAqIGNsb2NrLT5wMjsKKwlpZiAoV0FSTl9PTihjbG9jay0+biA9PSAwIHx8IGNs
b2NrLT5wID09IDApKQorCQlyZXR1cm4gMDsKKwljbG9jay0+dmNvID0gRElWX1JPVU5EX0NMT1NF
U1QocmVmY2xrICogY2xvY2stPm0sIGNsb2NrLT5uKTsKKwljbG9jay0+ZG90ID0gRElWX1JPVU5E
X0NMT1NFU1QoY2xvY2stPnZjbywgY2xvY2stPnApOworCisJcmV0dXJuIGNsb2NrLT5kb3QgLyA1
OworfQorCitpbnQgY2h2X2NhbGNfZHBsbF9wYXJhbXMoaW50IHJlZmNsaywgc3RydWN0IGRwbGwg
KmNsb2NrKQoreworCWNsb2NrLT5tID0gY2xvY2stPm0xICogY2xvY2stPm0yOworCWNsb2NrLT5w
ID0gY2xvY2stPnAxICogY2xvY2stPnAyOworCWlmIChXQVJOX09OKGNsb2NrLT5uID09IDAgfHwg
Y2xvY2stPnAgPT0gMCkpCisJCXJldHVybiAwOworCWNsb2NrLT52Y28gPSBESVZfUk9VTkRfQ0xP
U0VTVF9VTEwobXVsX3UzMl91MzIocmVmY2xrLCBjbG9jay0+bSksCisJCQkJCSAgIGNsb2NrLT5u
IDw8IDIyKTsKKwljbG9jay0+ZG90ID0gRElWX1JPVU5EX0NMT1NFU1QoY2xvY2stPnZjbywgY2xv
Y2stPnApOworCisJcmV0dXJuIGNsb2NrLT5kb3QgLyA1OworfQorCisvKgorICogUmV0dXJucyB3
aGV0aGVyIHRoZSBnaXZlbiBzZXQgb2YgZGl2aXNvcnMgYXJlIHZhbGlkIGZvciBhIGdpdmVuIHJl
ZmNsayB3aXRoCisgKiB0aGUgZ2l2ZW4gY29ubmVjdG9ycy4KKyAqLworc3RhdGljIGJvb2wgaW50
ZWxfcGxsX2lzX3ZhbGlkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0LAorCQkJICAgICAgIGNvbnN0IHN0
cnVjdCBkcGxsICpjbG9jaykKK3sKKwlpZiAoY2xvY2stPm4gPCBsaW1pdC0+bi5taW4gfHwgbGlt
aXQtPm4ubWF4IDwgY2xvY2stPm4pCisJCXJldHVybiBmYWxzZTsKKwlpZiAoY2xvY2stPnAxIDwg
bGltaXQtPnAxLm1pbiB8fCBsaW1pdC0+cDEubWF4IDwgY2xvY2stPnAxKQorCQlyZXR1cm4gZmFs
c2U7CisJaWYgKGNsb2NrLT5tMiA8IGxpbWl0LT5tMi5taW4gfHwgbGltaXQtPm0yLm1heCA8IGNs
b2NrLT5tMikKKwkJcmV0dXJuIGZhbHNlOworCWlmIChjbG9jay0+bTEgPCBsaW1pdC0+bTEubWlu
IHx8IGxpbWl0LT5tMS5tYXggPCBjbG9jay0+bTEpCisJCXJldHVybiBmYWxzZTsKKworCWlmICgh
SVNfUElORVZJRVcoZGV2X3ByaXYpICYmICFJU19WQUxMRVlWSUVXKGRldl9wcml2KSAmJgorCSAg
ICAhSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgJiYgIUlTX0dFTjlfTFAoZGV2X3ByaXYpKQorCQlp
ZiAoY2xvY2stPm0xIDw9IGNsb2NrLT5tMikKKwkJCXJldHVybiBmYWxzZTsKKworCWlmICghSVNf
VkFMTEVZVklFVyhkZXZfcHJpdikgJiYgIUlTX0NIRVJSWVZJRVcoZGV2X3ByaXYpICYmCisJICAg
ICFJU19HRU45X0xQKGRldl9wcml2KSkgeworCQlpZiAoY2xvY2stPnAgPCBsaW1pdC0+cC5taW4g
fHwgbGltaXQtPnAubWF4IDwgY2xvY2stPnApCisJCQlyZXR1cm4gZmFsc2U7CisJCWlmIChjbG9j
ay0+bSA8IGxpbWl0LT5tLm1pbiB8fCBsaW1pdC0+bS5tYXggPCBjbG9jay0+bSkKKwkJCXJldHVy
biBmYWxzZTsKKwl9CisKKwlpZiAoY2xvY2stPnZjbyA8IGxpbWl0LT52Y28ubWluIHx8IGxpbWl0
LT52Y28ubWF4IDwgY2xvY2stPnZjbykKKwkJcmV0dXJuIGZhbHNlOworCS8qIFhYWDogV2UgbWF5
IG5lZWQgdG8gYmUgY2hlY2tpbmcgIkRvdCBjbG9jayIgZGVwZW5kaW5nIG9uIHRoZSBtdWx0aXBs
aWVyLAorCSAqIGNvbm5lY3RvciwgZXRjLiwgcmF0aGVyIHRoYW4ganVzdCBhIHNpbmdsZSByYW5n
ZS4KKwkgKi8KKwlpZiAoY2xvY2stPmRvdCA8IGxpbWl0LT5kb3QubWluIHx8IGxpbWl0LT5kb3Qu
bWF4IDwgY2xvY2stPmRvdCkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIHRydWU7Cit9CisK
K3N0YXRpYyBpbnQKK2k5eHhfc2VsZWN0X3AyX2Rpdihjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQg
KmxpbWl0LAorCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
KwkJICAgaW50IHRhcmdldCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKworCWlmIChpbnRlbF9jcnRj
X2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkgeworCQkvKgorCQkgKiBG
b3IgTFZEUyBqdXN0IHJlbHkgb24gaXRzIGN1cnJlbnQgc2V0dGluZ3MgZm9yIGR1YWwtY2hhbm5l
bC4KKwkJICogV2UgaGF2ZW4ndCBmaWd1cmVkIG91dCBob3cgdG8gcmVsaWFibHkgc2V0IHVwIGRp
ZmZlcmVudAorCQkgKiBzaW5nbGUvZHVhbCBjaGFubmVsIHN0YXRlLCBpZiB3ZSBldmVuIGNhbi4K
KwkJICovCisJCWlmIChpbnRlbF9pc19kdWFsX2xpbmtfbHZkcyhkZXZfcHJpdikpCisJCQlyZXR1
cm4gbGltaXQtPnAyLnAyX2Zhc3Q7CisJCWVsc2UKKwkJCXJldHVybiBsaW1pdC0+cDIucDJfc2xv
dzsKKwl9IGVsc2UgeworCQlpZiAodGFyZ2V0IDwgbGltaXQtPnAyLmRvdF9saW1pdCkKKwkJCXJl
dHVybiBsaW1pdC0+cDIucDJfc2xvdzsKKwkJZWxzZQorCQkJcmV0dXJuIGxpbWl0LT5wMi5wMl9m
YXN0OworCX0KK30KKworLyoKKyAqIFJldHVybnMgYSBzZXQgb2YgZGl2aXNvcnMgZm9yIHRoZSBk
ZXNpcmVkIHRhcmdldCBjbG9jayB3aXRoIHRoZSBnaXZlbgorICogcmVmY2xrLCBvciBGQUxTRS4g
IFRoZSByZXR1cm5lZCB2YWx1ZXMgcmVwcmVzZW50IHRoZSBjbG9jayBlcXVhdGlvbjoKKyAqIHJl
ZmxjayAqICg1ICogKG0xICsgMikgKyAobTIgKyAyKSkgLyAobiArIDIpIC8gcDEgLyBwMi4KKyAq
CisgKiBUYXJnZXQgYW5kIHJlZmVyZW5jZSBjbG9ja3MgYXJlIHNwZWNpZmllZCBpbiBrSHouCisg
KgorICogSWYgbWF0Y2hfY2xvY2sgaXMgcHJvdmlkZWQsIHRoZW4gYmVzdF9jbG9jayBQIGRpdmlk
ZXIgbXVzdCBtYXRjaCB0aGUgUAorICogZGl2aWRlciBmcm9tIEBtYXRjaF9jbG9jayB1c2VkIGZv
ciBMVkRTIGRvd25jbG9ja2luZy4KKyAqLworc3RhdGljIGJvb2wKK2k5eHhfZmluZF9iZXN0X2Rw
bGwoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKKwkJICAgIHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgICAgaW50IHRhcmdldCwgaW50IHJlZmNsaywgc3Ry
dWN0IGRwbGwgKm1hdGNoX2Nsb2NrLAorCQkgICAgc3RydWN0IGRwbGwgKmJlc3RfY2xvY2spCit7
CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2Owor
CXN0cnVjdCBkcGxsIGNsb2NrOworCWludCBlcnIgPSB0YXJnZXQ7CisKKwltZW1zZXQoYmVzdF9j
bG9jaywgMCwgc2l6ZW9mKCpiZXN0X2Nsb2NrKSk7CisKKwljbG9jay5wMiA9IGk5eHhfc2VsZWN0
X3AyX2RpdihsaW1pdCwgY3J0Y19zdGF0ZSwgdGFyZ2V0KTsKKworCWZvciAoY2xvY2subTEgPSBs
aW1pdC0+bTEubWluOyBjbG9jay5tMSA8PSBsaW1pdC0+bTEubWF4OworCSAgICAgY2xvY2subTEr
KykgeworCQlmb3IgKGNsb2NrLm0yID0gbGltaXQtPm0yLm1pbjsKKwkJICAgICBjbG9jay5tMiA8
PSBsaW1pdC0+bTIubWF4OyBjbG9jay5tMisrKSB7CisJCQlpZiAoY2xvY2subTIgPj0gY2xvY2su
bTEpCisJCQkJYnJlYWs7CisJCQlmb3IgKGNsb2NrLm4gPSBsaW1pdC0+bi5taW47CisJCQkgICAg
IGNsb2NrLm4gPD0gbGltaXQtPm4ubWF4OyBjbG9jay5uKyspIHsKKwkJCQlmb3IgKGNsb2NrLnAx
ID0gbGltaXQtPnAxLm1pbjsKKwkJCQkJY2xvY2sucDEgPD0gbGltaXQtPnAxLm1heDsgY2xvY2su
cDErKykgeworCQkJCQlpbnQgdGhpc19lcnI7CisKKwkJCQkJaTl4eF9jYWxjX2RwbGxfcGFyYW1z
KHJlZmNsaywgJmNsb2NrKTsKKwkJCQkJaWYgKCFpbnRlbF9wbGxfaXNfdmFsaWQodG9faTkxNShk
ZXYpLAorCQkJCQkJCQlsaW1pdCwKKwkJCQkJCQkJJmNsb2NrKSkKKwkJCQkJCWNvbnRpbnVlOwor
CQkJCQlpZiAobWF0Y2hfY2xvY2sgJiYKKwkJCQkJICAgIGNsb2NrLnAgIT0gbWF0Y2hfY2xvY2st
PnApCisJCQkJCQljb250aW51ZTsKKworCQkJCQl0aGlzX2VyciA9IGFicyhjbG9jay5kb3QgLSB0
YXJnZXQpOworCQkJCQlpZiAodGhpc19lcnIgPCBlcnIpIHsKKwkJCQkJCSpiZXN0X2Nsb2NrID0g
Y2xvY2s7CisJCQkJCQllcnIgPSB0aGlzX2VycjsKKwkJCQkJfQorCQkJCX0KKwkJCX0KKwkJfQor
CX0KKworCXJldHVybiAoZXJyICE9IHRhcmdldCk7Cit9CisKKy8qCisgKiBSZXR1cm5zIGEgc2V0
IG9mIGRpdmlzb3JzIGZvciB0aGUgZGVzaXJlZCB0YXJnZXQgY2xvY2sgd2l0aCB0aGUgZ2l2ZW4K
KyAqIHJlZmNsaywgb3IgRkFMU0UuICBUaGUgcmV0dXJuZWQgdmFsdWVzIHJlcHJlc2VudCB0aGUg
Y2xvY2sgZXF1YXRpb246CisgKiByZWZsY2sgKiAoNSAqIChtMSArIDIpICsgKG0yICsgMikpIC8g
KG4gKyAyKSAvIHAxIC8gcDIuCisgKgorICogVGFyZ2V0IGFuZCByZWZlcmVuY2UgY2xvY2tzIGFy
ZSBzcGVjaWZpZWQgaW4ga0h6LgorICoKKyAqIElmIG1hdGNoX2Nsb2NrIGlzIHByb3ZpZGVkLCB0
aGVuIGJlc3RfY2xvY2sgUCBkaXZpZGVyIG11c3QgbWF0Y2ggdGhlIFAKKyAqIGRpdmlkZXIgZnJv
bSBAbWF0Y2hfY2xvY2sgdXNlZCBmb3IgTFZEUyBkb3duY2xvY2tpbmcuCisgKi8KK3N0YXRpYyBi
b29sCitwbnZfZmluZF9iZXN0X2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwK
KwkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCSAgIGludCB0YXJn
ZXQsIGludCByZWZjbGssIHN0cnVjdCBkcGxsICptYXRjaF9jbG9jaywKKwkJICAgc3RydWN0IGRw
bGwgKmJlc3RfY2xvY2spCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGNfc3RhdGUt
PnVhcGkuY3J0Yy0+ZGV2OworCXN0cnVjdCBkcGxsIGNsb2NrOworCWludCBlcnIgPSB0YXJnZXQ7
CisKKwltZW1zZXQoYmVzdF9jbG9jaywgMCwgc2l6ZW9mKCpiZXN0X2Nsb2NrKSk7CisKKwljbG9j
ay5wMiA9IGk5eHhfc2VsZWN0X3AyX2RpdihsaW1pdCwgY3J0Y19zdGF0ZSwgdGFyZ2V0KTsKKwor
CWZvciAoY2xvY2subTEgPSBsaW1pdC0+bTEubWluOyBjbG9jay5tMSA8PSBsaW1pdC0+bTEubWF4
OworCSAgICAgY2xvY2subTErKykgeworCQlmb3IgKGNsb2NrLm0yID0gbGltaXQtPm0yLm1pbjsK
KwkJICAgICBjbG9jay5tMiA8PSBsaW1pdC0+bTIubWF4OyBjbG9jay5tMisrKSB7CisJCQlmb3Ig
KGNsb2NrLm4gPSBsaW1pdC0+bi5taW47CisJCQkgICAgIGNsb2NrLm4gPD0gbGltaXQtPm4ubWF4
OyBjbG9jay5uKyspIHsKKwkJCQlmb3IgKGNsb2NrLnAxID0gbGltaXQtPnAxLm1pbjsKKwkJCQkJ
Y2xvY2sucDEgPD0gbGltaXQtPnAxLm1heDsgY2xvY2sucDErKykgeworCQkJCQlpbnQgdGhpc19l
cnI7CisKKwkJCQkJcG52X2NhbGNfZHBsbF9wYXJhbXMocmVmY2xrLCAmY2xvY2spOworCQkJCQlp
ZiAoIWludGVsX3BsbF9pc192YWxpZCh0b19pOTE1KGRldiksCisJCQkJCQkJCWxpbWl0LAorCQkJ
CQkJCQkmY2xvY2spKQorCQkJCQkJY29udGludWU7CisJCQkJCWlmIChtYXRjaF9jbG9jayAmJgor
CQkJCQkgICAgY2xvY2sucCAhPSBtYXRjaF9jbG9jay0+cCkKKwkJCQkJCWNvbnRpbnVlOworCisJ
CQkJCXRoaXNfZXJyID0gYWJzKGNsb2NrLmRvdCAtIHRhcmdldCk7CisJCQkJCWlmICh0aGlzX2Vy
ciA8IGVycikgeworCQkJCQkJKmJlc3RfY2xvY2sgPSBjbG9jazsKKwkJCQkJCWVyciA9IHRoaXNf
ZXJyOworCQkJCQl9CisJCQkJfQorCQkJfQorCQl9CisJfQorCisJcmV0dXJuIChlcnIgIT0gdGFy
Z2V0KTsKK30KKworLyoKKyAqIFJldHVybnMgYSBzZXQgb2YgZGl2aXNvcnMgZm9yIHRoZSBkZXNp
cmVkIHRhcmdldCBjbG9jayB3aXRoIHRoZSBnaXZlbgorICogcmVmY2xrLCBvciBGQUxTRS4gIFRo
ZSByZXR1cm5lZCB2YWx1ZXMgcmVwcmVzZW50IHRoZSBjbG9jayBlcXVhdGlvbjoKKyAqIHJlZmxj
ayAqICg1ICogKG0xICsgMikgKyAobTIgKyAyKSkgLyAobiArIDIpIC8gcDEgLyBwMi4KKyAqCisg
KiBUYXJnZXQgYW5kIHJlZmVyZW5jZSBjbG9ja3MgYXJlIHNwZWNpZmllZCBpbiBrSHouCisgKgor
ICogSWYgbWF0Y2hfY2xvY2sgaXMgcHJvdmlkZWQsIHRoZW4gYmVzdF9jbG9jayBQIGRpdmlkZXIg
bXVzdCBtYXRjaCB0aGUgUAorICogZGl2aWRlciBmcm9tIEBtYXRjaF9jbG9jayB1c2VkIGZvciBM
VkRTIGRvd25jbG9ja2luZy4KKyAqLworc3RhdGljIGJvb2wKK2c0eF9maW5kX2Jlc3RfZHBsbChj
b25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0LAorCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKKwkJICAgaW50IHRhcmdldCwgaW50IHJlZmNsaywgc3RydWN0IGRw
bGwgKm1hdGNoX2Nsb2NrLAorCQkgICBzdHJ1Y3QgZHBsbCAqYmVzdF9jbG9jaykKK3sKKwlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXY7CisJc3RydWN0
IGRwbGwgY2xvY2s7CisJaW50IG1heF9uOworCWJvb2wgZm91bmQgPSBmYWxzZTsKKwkvKiBhcHBy
b3hpbWF0ZWx5IGVxdWFscyB0YXJnZXQgKiAwLjAwNTg1ICovCisJaW50IGVycl9tb3N0ID0gKHRh
cmdldCA+PiA4KSArICh0YXJnZXQgPj4gOSk7CisKKwltZW1zZXQoYmVzdF9jbG9jaywgMCwgc2l6
ZW9mKCpiZXN0X2Nsb2NrKSk7CisKKwljbG9jay5wMiA9IGk5eHhfc2VsZWN0X3AyX2RpdihsaW1p
dCwgY3J0Y19zdGF0ZSwgdGFyZ2V0KTsKKworCW1heF9uID0gbGltaXQtPm4ubWF4OworCS8qIGJh
c2VkIG9uIGhhcmR3YXJlIHJlcXVpcmVtZW50LCBwcmVmZXIgc21hbGxlciBuIHRvIHByZWNpc2lv
biAqLworCWZvciAoY2xvY2subiA9IGxpbWl0LT5uLm1pbjsgY2xvY2subiA8PSBtYXhfbjsgY2xv
Y2subisrKSB7CisJCS8qIGJhc2VkIG9uIGhhcmR3YXJlIHJlcXVpcmVtZW50LCBwcmVmZXJlIGxh
cmdlciBtMSxtMiAqLworCQlmb3IgKGNsb2NrLm0xID0gbGltaXQtPm0xLm1heDsKKwkJICAgICBj
bG9jay5tMSA+PSBsaW1pdC0+bTEubWluOyBjbG9jay5tMS0tKSB7CisJCQlmb3IgKGNsb2NrLm0y
ID0gbGltaXQtPm0yLm1heDsKKwkJCSAgICAgY2xvY2subTIgPj0gbGltaXQtPm0yLm1pbjsgY2xv
Y2subTItLSkgeworCQkJCWZvciAoY2xvY2sucDEgPSBsaW1pdC0+cDEubWF4OworCQkJCSAgICAg
Y2xvY2sucDEgPj0gbGltaXQtPnAxLm1pbjsgY2xvY2sucDEtLSkgeworCQkJCQlpbnQgdGhpc19l
cnI7CisKKwkJCQkJaTl4eF9jYWxjX2RwbGxfcGFyYW1zKHJlZmNsaywgJmNsb2NrKTsKKwkJCQkJ
aWYgKCFpbnRlbF9wbGxfaXNfdmFsaWQodG9faTkxNShkZXYpLAorCQkJCQkJCQlsaW1pdCwKKwkJ
CQkJCQkJJmNsb2NrKSkKKwkJCQkJCWNvbnRpbnVlOworCisJCQkJCXRoaXNfZXJyID0gYWJzKGNs
b2NrLmRvdCAtIHRhcmdldCk7CisJCQkJCWlmICh0aGlzX2VyciA8IGVycl9tb3N0KSB7CisJCQkJ
CQkqYmVzdF9jbG9jayA9IGNsb2NrOworCQkJCQkJZXJyX21vc3QgPSB0aGlzX2VycjsKKwkJCQkJ
CW1heF9uID0gY2xvY2subjsKKwkJCQkJCWZvdW5kID0gdHJ1ZTsKKwkJCQkJfQorCQkJCX0KKwkJ
CX0KKwkJfQorCX0KKwlyZXR1cm4gZm91bmQ7Cit9CisKKy8qCisgKiBDaGVjayBpZiB0aGUgY2Fs
Y3VsYXRlZCBQTEwgY29uZmlndXJhdGlvbiBpcyBtb3JlIG9wdGltYWwgY29tcGFyZWQgdG8gdGhl
CisgKiBiZXN0IGNvbmZpZ3VyYXRpb24gYW5kIGVycm9yIGZvdW5kIHNvIGZhci4gUmV0dXJuIHRo
ZSBjYWxjdWxhdGVkIGVycm9yLgorICovCitzdGF0aWMgYm9vbCB2bHZfUExMX2lzX29wdGltYWwo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgaW50IHRhcmdldF9mcmVxLAorCQkJICAgICAgIGNvbnN0
IHN0cnVjdCBkcGxsICpjYWxjdWxhdGVkX2Nsb2NrLAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBk
cGxsICpiZXN0X2Nsb2NrLAorCQkJICAgICAgIHVuc2lnbmVkIGludCBiZXN0X2Vycm9yX3BwbSwK
KwkJCSAgICAgICB1bnNpZ25lZCBpbnQgKmVycm9yX3BwbSkKK3sKKwkvKgorCSAqIEZvciBDSFYg
aWdub3JlIHRoZSBlcnJvciBhbmQgY29uc2lkZXIgb25seSB0aGUgUCB2YWx1ZS4KKwkgKiBQcmVm
ZXIgYSBiaWdnZXIgUCB2YWx1ZSBiYXNlZCBvbiBIVyByZXF1aXJlbWVudHMuCisJICovCisJaWYg
KElTX0NIRVJSWVZJRVcodG9faTkxNShkZXYpKSkgeworCQkqZXJyb3JfcHBtID0gMDsKKworCQly
ZXR1cm4gY2FsY3VsYXRlZF9jbG9jay0+cCA+IGJlc3RfY2xvY2stPnA7CisJfQorCisJaWYgKGRy
bV9XQVJOX09OX09OQ0UoZGV2LCAhdGFyZ2V0X2ZyZXEpKQorCQlyZXR1cm4gZmFsc2U7CisKKwkq
ZXJyb3JfcHBtID0gZGl2X3U2NCgxMDAwMDAwVUxMICoKKwkJCQlhYnModGFyZ2V0X2ZyZXEgLSBj
YWxjdWxhdGVkX2Nsb2NrLT5kb3QpLAorCQkJICAgICB0YXJnZXRfZnJlcSk7CisJLyoKKwkgKiBQ
cmVmZXIgYSBiZXR0ZXIgUCB2YWx1ZSBvdmVyIGEgYmV0dGVyIChzbWFsbGVyKSBlcnJvciBpZiB0
aGUgZXJyb3IKKwkgKiBpcyBzbWFsbC4gRW5zdXJlIHRoaXMgcHJlZmVyZW5jZSBmb3IgZnV0dXJl
IGNvbmZpZ3VyYXRpb25zIHRvbyBieQorCSAqIHNldHRpbmcgdGhlIGVycm9yIHRvIDAuCisJICov
CisJaWYgKCplcnJvcl9wcG0gPCAxMDAgJiYgY2FsY3VsYXRlZF9jbG9jay0+cCA+IGJlc3RfY2xv
Y2stPnApIHsKKwkJKmVycm9yX3BwbSA9IDA7CisKKwkJcmV0dXJuIHRydWU7CisJfQorCisJcmV0
dXJuICplcnJvcl9wcG0gKyAxMCA8IGJlc3RfZXJyb3JfcHBtOworfQorCisvKgorICogUmV0dXJu
cyBhIHNldCBvZiBkaXZpc29ycyBmb3IgdGhlIGRlc2lyZWQgdGFyZ2V0IGNsb2NrIHdpdGggdGhl
IGdpdmVuCisgKiByZWZjbGssIG9yIEZBTFNFLiAgVGhlIHJldHVybmVkIHZhbHVlcyByZXByZXNl
bnQgdGhlIGNsb2NrIGVxdWF0aW9uOgorICogcmVmbGNrICogKDUgKiAobTEgKyAyKSArIChtMiAr
IDIpKSAvIChuICsgMikgLyBwMSAvIHAyLgorICovCitzdGF0aWMgYm9vbAordmx2X2ZpbmRfYmVz
dF9kcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGltaXQsCisJCSAgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgICBpbnQgdGFyZ2V0LCBpbnQgcmVmY2xrLCBz
dHJ1Y3QgZHBsbCAqbWF0Y2hfY2xvY2ssCisJCSAgIHN0cnVjdCBkcGxsICpiZXN0X2Nsb2NrKQor
eworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51
YXBpLmNydGMpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKKwlz
dHJ1Y3QgZHBsbCBjbG9jazsKKwl1bnNpZ25lZCBpbnQgYmVzdHBwbSA9IDEwMDAwMDA7CisJLyog
bWluIHVwZGF0ZSAxOS4yIE1IeiAqLworCWludCBtYXhfbiA9IG1pbihsaW1pdC0+bi5tYXgsIHJl
ZmNsayAvIDE5MjAwKTsKKwlib29sIGZvdW5kID0gZmFsc2U7CisKKwl0YXJnZXQgKj0gNTsgLyog
ZmFzdCBjbG9jayAqLworCisJbWVtc2V0KGJlc3RfY2xvY2ssIDAsIHNpemVvZigqYmVzdF9jbG9j
aykpOworCisJLyogYmFzZWQgb24gaGFyZHdhcmUgcmVxdWlyZW1lbnQsIHByZWZlciBzbWFsbGVy
IG4gdG8gcHJlY2lzaW9uICovCisJZm9yIChjbG9jay5uID0gbGltaXQtPm4ubWluOyBjbG9jay5u
IDw9IG1heF9uOyBjbG9jay5uKyspIHsKKwkJZm9yIChjbG9jay5wMSA9IGxpbWl0LT5wMS5tYXg7
IGNsb2NrLnAxID49IGxpbWl0LT5wMS5taW47IGNsb2NrLnAxLS0pIHsKKwkJCWZvciAoY2xvY2su
cDIgPSBsaW1pdC0+cDIucDJfZmFzdDsgY2xvY2sucDIgPj0gbGltaXQtPnAyLnAyX3Nsb3c7CisJ
CQkgICAgIGNsb2NrLnAyIC09IGNsb2NrLnAyID4gMTAgPyAyIDogMSkgeworCQkJCWNsb2NrLnAg
PSBjbG9jay5wMSAqIGNsb2NrLnAyOworCQkJCS8qIGJhc2VkIG9uIGhhcmR3YXJlIHJlcXVpcmVt
ZW50LCBwcmVmZXIgYmlnZ2VyIG0xLG0yIHZhbHVlcyAqLworCQkJCWZvciAoY2xvY2subTEgPSBs
aW1pdC0+bTEubWluOyBjbG9jay5tMSA8PSBsaW1pdC0+bTEubWF4OyBjbG9jay5tMSsrKSB7CisJ
CQkJCXVuc2lnbmVkIGludCBwcG07CisKKwkJCQkJY2xvY2subTIgPSBESVZfUk9VTkRfQ0xPU0VT
VCh0YXJnZXQgKiBjbG9jay5wICogY2xvY2subiwKKwkJCQkJCQkJICAgICByZWZjbGsgKiBjbG9j
ay5tMSk7CisKKwkJCQkJdmx2X2NhbGNfZHBsbF9wYXJhbXMocmVmY2xrLCAmY2xvY2spOworCisJ
CQkJCWlmICghaW50ZWxfcGxsX2lzX3ZhbGlkKHRvX2k5MTUoZGV2KSwKKwkJCQkJCQkJbGltaXQs
CisJCQkJCQkJCSZjbG9jaykpCisJCQkJCQljb250aW51ZTsKKworCQkJCQlpZiAoIXZsdl9QTExf
aXNfb3B0aW1hbChkZXYsIHRhcmdldCwKKwkJCQkJCQkJJmNsb2NrLAorCQkJCQkJCQliZXN0X2Ns
b2NrLAorCQkJCQkJCQliZXN0cHBtLCAmcHBtKSkKKwkJCQkJCWNvbnRpbnVlOworCisJCQkJCSpi
ZXN0X2Nsb2NrID0gY2xvY2s7CisJCQkJCWJlc3RwcG0gPSBwcG07CisJCQkJCWZvdW5kID0gdHJ1
ZTsKKwkJCQl9CisJCQl9CisJCX0KKwl9CisKKwlyZXR1cm4gZm91bmQ7Cit9CisKKy8qCisgKiBS
ZXR1cm5zIGEgc2V0IG9mIGRpdmlzb3JzIGZvciB0aGUgZGVzaXJlZCB0YXJnZXQgY2xvY2sgd2l0
aCB0aGUgZ2l2ZW4KKyAqIHJlZmNsaywgb3IgRkFMU0UuICBUaGUgcmV0dXJuZWQgdmFsdWVzIHJl
cHJlc2VudCB0aGUgY2xvY2sgZXF1YXRpb246CisgKiByZWZsY2sgKiAoNSAqIChtMSArIDIpICsg
KG0yICsgMikpIC8gKG4gKyAyKSAvIHAxIC8gcDIuCisgKi8KK3N0YXRpYyBib29sCitjaHZfZmlu
ZF9iZXN0X2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKKwkJICAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCSAgIGludCB0YXJnZXQsIGludCByZWZj
bGssIHN0cnVjdCBkcGxsICptYXRjaF9jbG9jaywKKwkJICAgc3RydWN0IGRwbGwgKmJlc3RfY2xv
Y2spCit7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPnVhcGkuY3J0Yyk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2
OworCXVuc2lnbmVkIGludCBiZXN0X2Vycm9yX3BwbTsKKwlzdHJ1Y3QgZHBsbCBjbG9jazsKKwl1
NjQgbTI7CisJaW50IGZvdW5kID0gZmFsc2U7CisKKwltZW1zZXQoYmVzdF9jbG9jaywgMCwgc2l6
ZW9mKCpiZXN0X2Nsb2NrKSk7CisJYmVzdF9lcnJvcl9wcG0gPSAxMDAwMDAwOworCisJLyoKKwkg
KiBCYXNlZCBvbiBoYXJkd2FyZSBkb2MsIHRoZSBuIGFsd2F5cyBzZXQgdG8gMSwgYW5kIG0xIGFs
d2F5cworCSAqIHNldCB0byAyLiAgSWYgcmVxdWlyZXMgdG8gc3VwcG9ydCAyMDBNaHogcmVmY2xr
LCB3ZSBuZWVkIHRvCisJICogcmV2aXNpdCB0aGlzIGJlY2F1c2UgbiBtYXkgbm90IDEgYW55bW9y
ZS4KKwkgKi8KKwljbG9jay5uID0gMTsKKwljbG9jay5tMSA9IDI7CisJdGFyZ2V0ICo9IDU7CS8q
IGZhc3QgY2xvY2sgKi8KKworCWZvciAoY2xvY2sucDEgPSBsaW1pdC0+cDEubWF4OyBjbG9jay5w
MSA+PSBsaW1pdC0+cDEubWluOyBjbG9jay5wMS0tKSB7CisJCWZvciAoY2xvY2sucDIgPSBsaW1p
dC0+cDIucDJfZmFzdDsKKwkJCQljbG9jay5wMiA+PSBsaW1pdC0+cDIucDJfc2xvdzsKKwkJCQlj
bG9jay5wMiAtPSBjbG9jay5wMiA+IDEwID8gMiA6IDEpIHsKKwkJCXVuc2lnbmVkIGludCBlcnJv
cl9wcG07CisKKwkJCWNsb2NrLnAgPSBjbG9jay5wMSAqIGNsb2NrLnAyOworCisJCQltMiA9IERJ
Vl9ST1VORF9DTE9TRVNUX1VMTChtdWxfdTMyX3UzMih0YXJnZXQsIGNsb2NrLnAgKiBjbG9jay5u
KSA8PCAyMiwKKwkJCQkJCSAgIHJlZmNsayAqIGNsb2NrLm0xKTsKKworCQkJaWYgKG0yID4gSU5U
X01BWC9jbG9jay5tMSkKKwkJCQljb250aW51ZTsKKworCQkJY2xvY2subTIgPSBtMjsKKworCQkJ
Y2h2X2NhbGNfZHBsbF9wYXJhbXMocmVmY2xrLCAmY2xvY2spOworCisJCQlpZiAoIWludGVsX3Bs
bF9pc192YWxpZCh0b19pOTE1KGRldiksIGxpbWl0LCAmY2xvY2spKQorCQkJCWNvbnRpbnVlOwor
CisJCQlpZiAoIXZsdl9QTExfaXNfb3B0aW1hbChkZXYsIHRhcmdldCwgJmNsb2NrLCBiZXN0X2Ns
b2NrLAorCQkJCQkJYmVzdF9lcnJvcl9wcG0sICZlcnJvcl9wcG0pKQorCQkJCWNvbnRpbnVlOwor
CisJCQkqYmVzdF9jbG9jayA9IGNsb2NrOworCQkJYmVzdF9lcnJvcl9wcG0gPSBlcnJvcl9wcG07
CisJCQlmb3VuZCA9IHRydWU7CisJCX0KKwl9CisKKwlyZXR1cm4gZm91bmQ7Cit9CisKK2Jvb2wg
Ynh0X2ZpbmRfYmVzdF9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAor
CQkJc3RydWN0IGRwbGwgKmJlc3RfY2xvY2spCit7CisJaW50IHJlZmNsayA9IDEwMDAwMDsKKwlj
b25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0ID0gJmludGVsX2xpbWl0c19ieHQ7CisKKwly
ZXR1cm4gY2h2X2ZpbmRfYmVzdF9kcGxsKGxpbWl0LCBjcnRjX3N0YXRlLAorCQkJCSAgY3J0Y19z
dGF0ZS0+cG9ydF9jbG9jaywgcmVmY2xrLAorCQkJCSAgTlVMTCwgYmVzdF9jbG9jayk7Cit9CisK
K3N0YXRpYyB1MzIgcG52X2RwbGxfY29tcHV0ZV9mcChzdHJ1Y3QgZHBsbCAqZHBsbCkKK3sKKwly
ZXR1cm4gKDEgPDwgZHBsbC0+bikgPDwgMTYgfCBkcGxsLT5tMjsKK30KKworc3RhdGljIHZvaWQg
aTl4eF91cGRhdGVfcGxsX2RpdmlkZXJzKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkJCSAg
ICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJICAgICBzdHJ1Y3Qg
ZHBsbCAqcmVkdWNlZF9jbG9jaykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwl1MzIgZnAsIGZwMiA9IDA7CisKKwlpZiAo
SVNfUElORVZJRVcoZGV2X3ByaXYpKSB7CisJCWZwID0gcG52X2RwbGxfY29tcHV0ZV9mcCgmY3J0
Y19zdGF0ZS0+ZHBsbCk7CisJCWlmIChyZWR1Y2VkX2Nsb2NrKQorCQkJZnAyID0gcG52X2RwbGxf
Y29tcHV0ZV9mcChyZWR1Y2VkX2Nsb2NrKTsKKwl9IGVsc2UgeworCQlmcCA9IGk5eHhfZHBsbF9j
b21wdXRlX2ZwKCZjcnRjX3N0YXRlLT5kcGxsKTsKKwkJaWYgKHJlZHVjZWRfY2xvY2spCisJCQlm
cDIgPSBpOXh4X2RwbGxfY29tcHV0ZV9mcChyZWR1Y2VkX2Nsb2NrKTsKKwl9CisKKwljcnRjX3N0
YXRlLT5kcGxsX2h3X3N0YXRlLmZwMCA9IGZwOworCisJaWYgKGludGVsX2NydGNfaGFzX3R5cGUo
Y3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMpICYmCisJICAgIHJlZHVjZWRfY2xvY2spIHsK
KwkJY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZS5mcDEgPSBmcDI7CisJfSBlbHNlIHsKKwkJY3J0
Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZS5mcDEgPSBmcDsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGk5
eHhfY29tcHV0ZV9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkJICAgICAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkgICAgICBzdHJ1Y3QgZHBsbCAqcmVk
dWNlZF9jbG9jaykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKKwl1MzIgZHBsbDsKKwlzdHJ1Y3QgZHBsbCAqY2xvY2sgPSAm
Y3J0Y19zdGF0ZS0+ZHBsbDsKKworCWk5eHhfdXBkYXRlX3BsbF9kaXZpZGVycyhjcnRjLCBjcnRj
X3N0YXRlLCByZWR1Y2VkX2Nsb2NrKTsKKworCWRwbGwgPSBEUExMX1ZHQV9NT0RFX0RJUzsKKwor
CWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkK
KwkJZHBsbCB8PSBEUExMQl9NT0RFX0xWRFM7CisJZWxzZQorCQlkcGxsIHw9IERQTExCX01PREVf
REFDX1NFUklBTDsKKworCWlmIChJU19JOTQ1RyhkZXZfcHJpdikgfHwgSVNfSTk0NUdNKGRldl9w
cml2KSB8fAorCSAgICBJU19HMzMoZGV2X3ByaXYpIHx8IElTX1BJTkVWSUVXKGRldl9wcml2KSkg
eworCQlkcGxsIHw9IChjcnRjX3N0YXRlLT5waXhlbF9tdWx0aXBsaWVyIC0gMSkKKwkJCTw8IFNE
Vk9fTVVMVElQTElFUl9TSElGVF9ISVJFUzsKKwl9CisKKwlpZiAoaW50ZWxfY3J0Y19oYXNfdHlw
ZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfU0RWTykgfHwKKwkgICAgaW50ZWxfY3J0Y19oYXNf
dHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpCisJCWRwbGwgfD0gRFBMTF9TRFZP
X0hJR0hfU1BFRUQ7CisKKwlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2RlcihjcnRjX3N0YXRl
KSkKKwkJZHBsbCB8PSBEUExMX1NEVk9fSElHSF9TUEVFRDsKKworCS8qIGNvbXB1dGUgYml0bWFz
ayBmcm9tIHAxIHZhbHVlICovCisJaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSkKKwkJZHBsbCB8
PSAoMSA8PCAoY2xvY2stPnAxIC0gMSkpIDw8IERQTExfRlBBMDFfUDFfUE9TVF9ESVZfU0hJRlRf
UElORVZJRVc7CisJZWxzZSB7CisJCWRwbGwgfD0gKDEgPDwgKGNsb2NrLT5wMSAtIDEpKSA8PCBE
UExMX0ZQQTAxX1AxX1BPU1RfRElWX1NISUZUOworCQlpZiAoSVNfRzRYKGRldl9wcml2KSAmJiBy
ZWR1Y2VkX2Nsb2NrKQorCQkJZHBsbCB8PSAoMSA8PCAocmVkdWNlZF9jbG9jay0+cDEgLSAxKSkg
PDwgRFBMTF9GUEExX1AxX1BPU1RfRElWX1NISUZUOworCX0KKwlzd2l0Y2ggKGNsb2NrLT5wMikg
eworCWNhc2UgNToKKwkJZHBsbCB8PSBEUExMX0RBQ19TRVJJQUxfUDJfQ0xPQ0tfRElWXzU7CisJ
CWJyZWFrOworCWNhc2UgNzoKKwkJZHBsbCB8PSBEUExMQl9MVkRTX1AyX0NMT0NLX0RJVl83Owor
CQlicmVhazsKKwljYXNlIDEwOgorCQlkcGxsIHw9IERQTExfREFDX1NFUklBTF9QMl9DTE9DS19E
SVZfMTA7CisJCWJyZWFrOworCWNhc2UgMTQ6CisJCWRwbGwgfD0gRFBMTEJfTFZEU19QMl9DTE9D
S19ESVZfMTQ7CisJCWJyZWFrOworCX0KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA0KQor
CQlkcGxsIHw9ICg2IDw8IFBMTF9MT0FEX1BVTFNFX1BIQVNFX1NISUZUKTsKKworCWlmIChjcnRj
X3N0YXRlLT5zZHZvX3R2X2Nsb2NrKQorCQlkcGxsIHw9IFBMTF9SRUZfSU5QVVRfVFZDTEtJTkJD
OworCWVsc2UgaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVU
X0xWRFMpICYmCisJCSBpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSkKKwkJZHBsbCB8PSBQ
TExCX1JFRl9JTlBVVF9TUFJFQURTUEVDVFJVTUlOOworCWVsc2UKKwkJZHBsbCB8PSBQTExfUkVG
X0lOUFVUX0RSRUZDTEs7CisKKwlkcGxsIHw9IERQTExfVkNPX0VOQUJMRTsKKwljcnRjX3N0YXRl
LT5kcGxsX2h3X3N0YXRlLmRwbGwgPSBkcGxsOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gNCkgeworCQl1MzIgZHBsbF9tZCA9IChjcnRjX3N0YXRlLT5waXhlbF9tdWx0aXBsaWVyIC0g
MSkKKwkJCTw8IERQTExfTURfVURJX01VTFRJUExJRVJfU0hJRlQ7CisJCWNydGNfc3RhdGUtPmRw
bGxfaHdfc3RhdGUuZHBsbF9tZCA9IGRwbGxfbWQ7CisJfQorfQorCitzdGF0aWMgdm9pZCBpOHh4
X2NvbXB1dGVfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgICAgIHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAgICAgc3RydWN0IGRwbGwgKnJlZHVj
ZWRfY2xvY2spCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2Owor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwl1MzIg
ZHBsbDsKKwlzdHJ1Y3QgZHBsbCAqY2xvY2sgPSAmY3J0Y19zdGF0ZS0+ZHBsbDsKKworCWk5eHhf
dXBkYXRlX3BsbF9kaXZpZGVycyhjcnRjLCBjcnRjX3N0YXRlLCByZWR1Y2VkX2Nsb2NrKTsKKwor
CWRwbGwgPSBEUExMX1ZHQV9NT0RFX0RJUzsKKworCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNy
dGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkgeworCQlkcGxsIHw9ICgxIDw8IChjbG9jay0+
cDEgLSAxKSkgPDwgRFBMTF9GUEEwMV9QMV9QT1NUX0RJVl9TSElGVDsKKwl9IGVsc2UgeworCQlp
ZiAoY2xvY2stPnAxID09IDIpCisJCQlkcGxsIHw9IFBMTF9QMV9ESVZJREVfQllfVFdPOworCQll
bHNlCisJCQlkcGxsIHw9IChjbG9jay0+cDEgLSAyKSA8PCBEUExMX0ZQQTAxX1AxX1BPU1RfRElW
X1NISUZUOworCQlpZiAoY2xvY2stPnAyID09IDQpCisJCQlkcGxsIHw9IFBMTF9QMl9ESVZJREVf
QllfNDsKKwl9CisKKwkvKgorCSAqIEJzcGVjOgorCSAqICJbQWxtYWRvciBFcnJhdGF9OiBGb3Ig
dGhlIGNvcnJlY3Qgb3BlcmF0aW9uIG9mIHRoZSBtdXhlZCBEVk8gcGlucworCSAqICAoR0RFVlNF
TEIvSTJDZGF0YSwgR0lSREJZL0kyQ0NsaykgYW5kIChHRlJBTUVCL0RWSV9EYXRhLAorCSAqICBH
VFJEWUIvRFZJX0Nsayk6IEJpdCAzMSAoRFBMTCBWQ08gRW5hYmxlKSBhbmQgQml0IDMwICgyWCBD
bG9jaworCSAqICBFbmFibGUpIG11c3QgYmUgc2V0IHRvIOKAnDHigJ0gaW4gYm90aCB0aGUgRFBM
TCBBIENvbnRyb2wgUmVnaXN0ZXIKKwkgKiAgKDA2MDE0aC0wNjAxN2gpIGFuZCBEUExMIEIgQ29u
dHJvbCBSZWdpc3RlciAoMDYwMThoLTA2MDFCaCkuIgorCSAqCisJICogRm9yIHNpbXBsaWNpdHkg
V2Ugc2ltcGx5IGtlZXAgYm90aCBiaXRzIGFsd2F5cyBlbmFibGVkIGluCisJICogYm90aCBEUExM
Uy4gVGhlIHNwZWMgc2F5cyB3ZSBzaG91bGQgZGlzYWJsZSB0aGUgRFZPIDJYIGNsb2NrCisJICog
d2hlbiBub3QgbmVlZGVkLCBidXQgdGhpcyBzZWVtcyB0byB3b3JrIGZpbmUgaW4gcHJhY3RpY2Uu
CisJICovCisJaWYgKElTX0k4MzAoZGV2X3ByaXYpIHx8CisJICAgIGludGVsX2NydGNfaGFzX3R5
cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RWTykpCisJCWRwbGwgfD0gRFBMTF9EVk9fMlhf
TU9ERTsKKworCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBV
VF9MVkRTKSAmJgorCSAgICBpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSkKKwkJZHBsbCB8
PSBQTExCX1JFRl9JTlBVVF9TUFJFQURTUEVDVFJVTUlOOworCWVsc2UKKwkJZHBsbCB8PSBQTExf
UkVGX0lOUFVUX0RSRUZDTEs7CisKKwlkcGxsIHw9IERQTExfVkNPX0VOQUJMRTsKKwljcnRjX3N0
YXRlLT5kcGxsX2h3X3N0YXRlLmRwbGwgPSBkcGxsOworfQorCitzdGF0aWMgaW50IGhzd19jcnRj
X2NvbXB1dGVfY2xvY2soc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkJICBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSA9CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT51YXBp
LnN0YXRlKTsKKworCWlmICghaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9P
VVRQVVRfRFNJKSB8fAorCSAgICBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJCXN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0KKwkJCWludGVsX2dldF9jcnRjX25ld19lbmNvZGVy
KHN0YXRlLCBjcnRjX3N0YXRlKTsKKworCQlpZiAoIWludGVsX3Jlc2VydmVfc2hhcmVkX2RwbGxz
KHN0YXRlLCBjcnRjLCBlbmNvZGVyKSkgeworCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJCQkJICAgICJmYWlsZWQgdG8gZmluZCBQTEwgZm9yIHBpcGUgJWNcbiIsCisJCQkJICAgIHBp
cGVfbmFtZShjcnRjLT5waXBlKSk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCX0KKworCXJl
dHVybiAwOworfQorCitzdGF0aWMgYm9vbCBpbGtfbmVlZHNfZmJfY2JfdHVuZShzdHJ1Y3QgZHBs
bCAqZHBsbCwgaW50IGZhY3RvcikKK3sKKwlyZXR1cm4gaTl4eF9kcGxsX2NvbXB1dGVfbShkcGxs
KSA8IGZhY3RvciAqIGRwbGwtPm47Cit9CisKKworc3RhdGljIHZvaWQgaWxrX2NvbXB1dGVfZHBs
bChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgICAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCisJCQkgICAgIHN0cnVjdCBkcGxsICpyZWR1Y2VkX2Nsb2NrKQorewor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOworCXUzMiBkcGxsLCBmcCwgZnAyOworCWludCBmYWN0b3I7CisKKwkvKiBFbmFibGUgYXV0
b3R1bmluZyBvZiB0aGUgUExMIGNsb2NrIChpZiBwZXJtaXNzaWJsZSkgKi8KKwlmYWN0b3IgPSAy
MTsKKwlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZE
UykpIHsKKwkJaWYgKChpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSAmJgorCQkgICAgIGRl
dl9wcml2LT52YnQubHZkc19zc2NfZnJlcSA9PSAxMDAwMDApIHx8CisJCSAgICAoSEFTX1BDSF9J
QlgoZGV2X3ByaXYpICYmCisJCSAgICAgaW50ZWxfaXNfZHVhbF9saW5rX2x2ZHMoZGV2X3ByaXYp
KSkKKwkJCWZhY3RvciA9IDI1OworCX0gZWxzZSBpZiAoY3J0Y19zdGF0ZS0+c2R2b190dl9jbG9j
aykgeworCQlmYWN0b3IgPSAyMDsKKwl9CisKKwlmcCA9IGk5eHhfZHBsbF9jb21wdXRlX2ZwKCZj
cnRjX3N0YXRlLT5kcGxsKTsKKworCWlmIChpbGtfbmVlZHNfZmJfY2JfdHVuZSgmY3J0Y19zdGF0
ZS0+ZHBsbCwgZmFjdG9yKSkKKwkJZnAgfD0gRlBfQ0JfVFVORTsKKworCWlmIChyZWR1Y2VkX2Ns
b2NrKSB7CisJCWZwMiA9IGk5eHhfZHBsbF9jb21wdXRlX2ZwKHJlZHVjZWRfY2xvY2spOworCisJ
CWlmIChyZWR1Y2VkX2Nsb2NrLT5tIDwgZmFjdG9yICogcmVkdWNlZF9jbG9jay0+bikKKwkJCWZw
MiB8PSBGUF9DQl9UVU5FOworCX0gZWxzZSB7CisJCWZwMiA9IGZwOworCX0KKworCWRwbGwgPSAw
OworCisJaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xW
RFMpKQorCQlkcGxsIHw9IERQTExCX01PREVfTFZEUzsKKwllbHNlCisJCWRwbGwgfD0gRFBMTEJf
TU9ERV9EQUNfU0VSSUFMOworCisJZHBsbCB8PSAoY3J0Y19zdGF0ZS0+cGl4ZWxfbXVsdGlwbGll
ciAtIDEpCisJCTw8IFBMTF9SRUZfU0RWT19IRE1JX01VTFRJUExJRVJfU0hJRlQ7CisKKwlpZiAo
aW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfU0RWTykgfHwKKwkg
ICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpCisJ
CWRwbGwgfD0gRFBMTF9TRFZPX0hJR0hfU1BFRUQ7CisKKwlpZiAoaW50ZWxfY3J0Y19oYXNfZHBf
ZW5jb2RlcihjcnRjX3N0YXRlKSkKKwkJZHBsbCB8PSBEUExMX1NEVk9fSElHSF9TUEVFRDsKKwor
CS8qCisJICogVGhlIGhpZ2ggc3BlZWQgSU8gY2xvY2sgaXMgb25seSByZWFsbHkgcmVxdWlyZWQg
Zm9yCisJICogU0RWTy9IRE1JL0RQLCBidXQgd2UgYWxzbyBlbmFibGUgaXQgZm9yIENSVCB0byBt
YWtlIGl0CisJICogcG9zc2libGUgdG8gc2hhcmUgdGhlIERQTEwgYmV0d2VlbiBDUlQgYW5kIEhE
TUkuIEVuYWJsaW5nCisJICogdGhlIGNsb2NrIG5lZWRsZXNzbHkgZG9lcyBubyByZWFsIGhhcm0s
IGV4Y2VwdCB1c2UgdXAgYQorCSAqIGJpdCBvZiBwb3dlciBwb3RlbnRpYWxseS4KKwkgKgorCSAq
IFdlJ2xsIGxpbWl0IHRoaXMgdG8gSVZCIHdpdGggMyBwaXBlcywgc2luY2UgaXQgaGFzIG9ubHkg
dHdvCisJICogRFBMTHMgYW5kIHNvIERQTEwgc2hhcmluZyBpcyB0aGUgb25seSB3YXkgdG8gZ2V0
IHRocmVlIHBpcGVzCisJICogZHJpdmluZyBQQ0ggcG9ydHMgYXQgdGhlIHNhbWUgdGltZS4gT24g
U05CIHdlIGNvdWxkIGRvIHRoaXMsCisJICogYW5kIHBvdGVudGlhbGx5IGF2b2lkIGVuYWJsaW5n
IHRoZSBzZWNvbmQgRFBMTCwgYnV0IGl0J3Mgbm90CisJICogY2xlYXIgaWYgaXQnJ3MgYSB3aW4g
b3IgbG9zcyBwb3dlciB3aXNlLiBObyBwb2ludCBpbiBkb2luZworCSAqIHRoaXMgb24gSUxLIGF0
IGFsbCBzaW5jZSBpdCBoYXMgYSBmaXhlZCBEUExMPC0+cGlwZSBtYXBwaW5nLgorCSAqLworCWlm
IChJTlRFTF9OVU1fUElQRVMoZGV2X3ByaXYpID09IDMgJiYKKwkgICAgaW50ZWxfY3J0Y19oYXNf
dHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfQU5BTE9HKSkKKwkJZHBsbCB8PSBEUExMX1NE
Vk9fSElHSF9TUEVFRDsKKworCS8qIGNvbXB1dGUgYml0bWFzayBmcm9tIHAxIHZhbHVlICovCisJ
ZHBsbCB8PSAoMSA8PCAoY3J0Y19zdGF0ZS0+ZHBsbC5wMSAtIDEpKSA8PCBEUExMX0ZQQTAxX1Ax
X1BPU1RfRElWX1NISUZUOworCS8qIGFsc28gRlBBMSAqLworCWRwbGwgfD0gKDEgPDwgKGNydGNf
c3RhdGUtPmRwbGwucDEgLSAxKSkgPDwgRFBMTF9GUEExX1AxX1BPU1RfRElWX1NISUZUOworCisJ
c3dpdGNoIChjcnRjX3N0YXRlLT5kcGxsLnAyKSB7CisJY2FzZSA1OgorCQlkcGxsIHw9IERQTExf
REFDX1NFUklBTF9QMl9DTE9DS19ESVZfNTsKKwkJYnJlYWs7CisJY2FzZSA3OgorCQlkcGxsIHw9
IERQTExCX0xWRFNfUDJfQ0xPQ0tfRElWXzc7CisJCWJyZWFrOworCWNhc2UgMTA6CisJCWRwbGwg
fD0gRFBMTF9EQUNfU0VSSUFMX1AyX0NMT0NLX0RJVl8xMDsKKwkJYnJlYWs7CisJY2FzZSAxNDoK
KwkJZHBsbCB8PSBEUExMQl9MVkRTX1AyX0NMT0NLX0RJVl8xNDsKKwkJYnJlYWs7CisJfQorCisJ
aWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMpICYm
CisJICAgIGludGVsX3BhbmVsX3VzZV9zc2MoZGV2X3ByaXYpKQorCQlkcGxsIHw9IFBMTEJfUkVG
X0lOUFVUX1NQUkVBRFNQRUNUUlVNSU47CisJZWxzZQorCQlkcGxsIHw9IFBMTF9SRUZfSU5QVVRf
RFJFRkNMSzsKKworCWRwbGwgfD0gRFBMTF9WQ09fRU5BQkxFOworCisJY3J0Y19zdGF0ZS0+ZHBs
bF9od19zdGF0ZS5kcGxsID0gZHBsbDsKKwljcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlLmZwMCA9
IGZwOworCWNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUuZnAxID0gZnAyOworfQorCitzdGF0aWMg
aW50IGlsa19jcnRjX2NvbXB1dGVfY2xvY2soc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkJ
ICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRj
X3N0YXRlLT51YXBpLnN0YXRlKTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0Owor
CWludCByZWZjbGsgPSAxMjAwMDA7CisKKwltZW1zZXQoJmNydGNfc3RhdGUtPmRwbGxfaHdfc3Rh
dGUsIDAsCisJICAgICAgIHNpemVvZihjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlKSk7CisKKwkv
KiBDUFUgZURQIGlzIHRoZSBvbmx5IG91dHB1dCB0aGF0IGRvZXNuJ3QgbmVlZCBhIFBDSCBQTEwg
b2YgaXRzIG93bi4gKi8KKwlpZiAoIWNydGNfc3RhdGUtPmhhc19wY2hfZW5jb2RlcikKKwkJcmV0
dXJuIDA7CisKKwlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQ
VVRfTFZEUykpIHsKKwkJaWYgKGludGVsX3BhbmVsX3VzZV9zc2MoZGV2X3ByaXYpKSB7CisJCQlk
cm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCQkgICAgInVzaW5nIFNTQyByZWZlcmVuY2Ug
Y2xvY2sgb2YgJWQga0h6XG4iLAorCQkJCSAgICBkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2ZyZXEp
OworCQkJcmVmY2xrID0gZGV2X3ByaXYtPnZidC5sdmRzX3NzY19mcmVxOworCQl9CisKKwkJaWYg
KGludGVsX2lzX2R1YWxfbGlua19sdmRzKGRldl9wcml2KSkgeworCQkJaWYgKHJlZmNsayA9PSAx
MDAwMDApCisJCQkJbGltaXQgPSAmaWxrX2xpbWl0c19kdWFsX2x2ZHNfMTAwbTsKKwkJCWVsc2UK
KwkJCQlsaW1pdCA9ICZpbGtfbGltaXRzX2R1YWxfbHZkczsKKwkJfSBlbHNlIHsKKwkJCWlmIChy
ZWZjbGsgPT0gMTAwMDAwKQorCQkJCWxpbWl0ID0gJmlsa19saW1pdHNfc2luZ2xlX2x2ZHNfMTAw
bTsKKwkJCWVsc2UKKwkJCQlsaW1pdCA9ICZpbGtfbGltaXRzX3NpbmdsZV9sdmRzOworCQl9CisJ
fSBlbHNlIHsKKwkJbGltaXQgPSAmaWxrX2xpbWl0c19kYWM7CisJfQorCisJaWYgKCFjcnRjX3N0
YXRlLT5jbG9ja19zZXQgJiYKKwkgICAgIWc0eF9maW5kX2Jlc3RfZHBsbChsaW1pdCwgY3J0Y19z
dGF0ZSwgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywKKwkJCQlyZWZjbGssIE5VTEwsICZjcnRjX3N0
YXRlLT5kcGxsKSkgeworCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAorCQkJIkNvdWxkbid0IGZp
bmQgUExMIHNldHRpbmdzIGZvciBtb2RlIVxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwor
CWlsa19jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19zdGF0ZSwgTlVMTCk7CisKKwlpZiAoIWludGVs
X3Jlc2VydmVfc2hhcmVkX2RwbGxzKHN0YXRlLCBjcnRjLCBOVUxMKSkgeworCQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAiZmFpbGVkIHRvIGZpbmQgUExMIGZvciBwaXBlICVj
XG4iLAorCQkJICAgIHBpcGVfbmFtZShjcnRjLT5waXBlKSk7CisJCXJldHVybiAtRUlOVkFMOwor
CX0KKworCXJldHVybiAwOworfQorCit2b2lkIHZsdl9jb21wdXRlX2RwbGwoc3RydWN0IGludGVs
X2NydGMgKmNydGMsCisJCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZykKK3sKKwlwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsID0gRFBMTF9JTlRFR1JBVEVE
X1JFRl9DTEtfVkxWIHwKKwkJRFBMTF9SRUZfQ0xLX0VOQUJMRV9WTFYgfCBEUExMX1ZHQV9NT0RF
X0RJUzsKKwlpZiAoY3J0Yy0+cGlwZSAhPSBQSVBFX0EpCisJCXBpcGVfY29uZmlnLT5kcGxsX2h3
X3N0YXRlLmRwbGwgfD0gRFBMTF9JTlRFR1JBVEVEX0NSSV9DTEtfVkxWOworCisJLyogRFBMTCBu
b3QgdXNlZCB3aXRoIERTSSwgYnV0IHN0aWxsIG5lZWQgdGhlIHJlc3Qgc2V0IHVwICovCisJaWYg
KCFpbnRlbF9jcnRjX2hhc190eXBlKHBpcGVfY29uZmlnLCBJTlRFTF9PVVRQVVRfRFNJKSkKKwkJ
cGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCB8PSBEUExMX1ZDT19FTkFCTEUgfAorCQkJ
RFBMTF9FWFRfQlVGRkVSX0VOQUJMRV9WTFY7CisKKwlwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0
ZS5kcGxsX21kID0KKwkJKHBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyIC0gMSkgPDwgRFBM
TF9NRF9VRElfTVVMVElQTElFUl9TSElGVDsKK30KKwordm9pZCBjaHZfY29tcHV0ZV9kcGxsKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcpCit7CisJcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCA9IERQTExf
U1NDX1JFRl9DTEtfQ0hWIHwKKwkJRFBMTF9SRUZfQ0xLX0VOQUJMRV9WTFYgfCBEUExMX1ZHQV9N
T0RFX0RJUzsKKwlpZiAoY3J0Yy0+cGlwZSAhPSBQSVBFX0EpCisJCXBpcGVfY29uZmlnLT5kcGxs
X2h3X3N0YXRlLmRwbGwgfD0gRFBMTF9JTlRFR1JBVEVEX0NSSV9DTEtfVkxWOworCisJLyogRFBM
TCBub3QgdXNlZCB3aXRoIERTSSwgYnV0IHN0aWxsIG5lZWQgdGhlIHJlc3Qgc2V0IHVwICovCisJ
aWYgKCFpbnRlbF9jcnRjX2hhc190eXBlKHBpcGVfY29uZmlnLCBJTlRFTF9PVVRQVVRfRFNJKSkK
KwkJcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCB8PSBEUExMX1ZDT19FTkFCTEU7CisK
KwlwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsX21kID0KKwkJKHBpcGVfY29uZmlnLT5w
aXhlbF9tdWx0aXBsaWVyIC0gMSkgPDwgRFBMTF9NRF9VRElfTVVMVElQTElFUl9TSElGVDsKK30K
Kworc3RhdGljIGludCBjaHZfY3J0Y19jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAorCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaW50
IHJlZmNsayA9IDEwMDAwMDsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0ID0gJmlu
dGVsX2xpbWl0c19jaHY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKworCW1lbXNldCgmY3J0Y19zdGF0ZS0+ZHBs
bF9od19zdGF0ZSwgMCwKKwkgICAgICAgc2l6ZW9mKGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUp
KTsKKworCWlmICghY3J0Y19zdGF0ZS0+Y2xvY2tfc2V0ICYmCisJICAgICFjaHZfZmluZF9iZXN0
X2RwbGwobGltaXQsIGNydGNfc3RhdGUsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCisJCQkJcmVm
Y2xrLCBOVUxMLCAmY3J0Y19zdGF0ZS0+ZHBsbCkpIHsKKwkJZHJtX2VycigmaTkxNS0+ZHJtLCAi
Q291bGRuJ3QgZmluZCBQTEwgc2V0dGluZ3MgZm9yIG1vZGUhXG4iKTsKKwkJcmV0dXJuIC1FSU5W
QUw7CisJfQorCisJY2h2X2NvbXB1dGVfZHBsbChjcnRjLCBjcnRjX3N0YXRlKTsKKworCXJldHVy
biAwOworfQorCitzdGF0aWMgaW50IHZsdl9jcnRjX2NvbXB1dGVfY2xvY2soc3RydWN0IGludGVs
X2NydGMgKmNydGMsCisJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
K3sKKwlpbnQgcmVmY2xrID0gMTAwMDAwOworCWNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGlt
aXQgPSAmaW50ZWxfbGltaXRzX3ZsdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOworCisJbWVtc2V0KCZjcnRjX3N0
YXRlLT5kcGxsX2h3X3N0YXRlLCAwLAorCSAgICAgICBzaXplb2YoY3J0Y19zdGF0ZS0+ZHBsbF9o
d19zdGF0ZSkpOworCisJaWYgKCFjcnRjX3N0YXRlLT5jbG9ja19zZXQgJiYKKwkgICAgIXZsdl9m
aW5kX2Jlc3RfZHBsbChsaW1pdCwgY3J0Y19zdGF0ZSwgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywK
KwkJCQlyZWZjbGssIE5VTEwsICZjcnRjX3N0YXRlLT5kcGxsKSkgeworCQlkcm1fZXJyKCZpOTE1
LT5kcm0sICAiQ291bGRuJ3QgZmluZCBQTEwgc2V0dGluZ3MgZm9yIG1vZGUhXG4iKTsKKwkJcmV0
dXJuIC1FSU5WQUw7CisJfQorCisJdmx2X2NvbXB1dGVfZHBsbChjcnRjLCBjcnRjX3N0YXRlKTsK
KworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGc0eF9jcnRjX2NvbXB1dGVfY2xvY2soc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCisJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0OworCWlu
dCByZWZjbGsgPSA5NjAwMDsKKworCW1lbXNldCgmY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZSwg
MCwKKwkgICAgICAgc2l6ZW9mKGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUpKTsKKworCWlmIChp
bnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkgeworCQlp
ZiAoaW50ZWxfcGFuZWxfdXNlX3NzYyhkZXZfcHJpdikpIHsKKwkJCXJlZmNsayA9IGRldl9wcml2
LT52YnQubHZkc19zc2NfZnJlcTsKKwkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJ
CSAgICAidXNpbmcgU1NDIHJlZmVyZW5jZSBjbG9jayBvZiAlZCBrSHpcbiIsCisJCQkJICAgIHJl
ZmNsayk7CisJCX0KKworCQlpZiAoaW50ZWxfaXNfZHVhbF9saW5rX2x2ZHMoZGV2X3ByaXYpKQor
CQkJbGltaXQgPSAmaW50ZWxfbGltaXRzX2c0eF9kdWFsX2NoYW5uZWxfbHZkczsKKwkJZWxzZQor
CQkJbGltaXQgPSAmaW50ZWxfbGltaXRzX2c0eF9zaW5nbGVfY2hhbm5lbF9sdmRzOworCX0gZWxz
ZSBpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkg
fHwKKwkJICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfQU5B
TE9HKSkgeworCQlsaW1pdCA9ICZpbnRlbF9saW1pdHNfZzR4X2hkbWk7CisJfSBlbHNlIGlmIChp
bnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9TRFZPKSkgeworCQls
aW1pdCA9ICZpbnRlbF9saW1pdHNfZzR4X3Nkdm87CisJfSBlbHNlIHsKKwkJLyogVGhlIG9wdGlv
biBpcyBmb3Igb3RoZXIgb3V0cHV0cyAqLworCQlsaW1pdCA9ICZpbnRlbF9saW1pdHNfaTl4eF9z
ZHZvOworCX0KKworCWlmICghY3J0Y19zdGF0ZS0+Y2xvY2tfc2V0ICYmCisJICAgICFnNHhfZmlu
ZF9iZXN0X2RwbGwobGltaXQsIGNydGNfc3RhdGUsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCisJ
CQkJcmVmY2xrLCBOVUxMLCAmY3J0Y19zdGF0ZS0+ZHBsbCkpIHsKKwkJZHJtX2VycigmZGV2X3By
aXYtPmRybSwKKwkJCSJDb3VsZG4ndCBmaW5kIFBMTCBzZXR0aW5ncyBmb3IgbW9kZSFcbiIpOwor
CQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpOXh4X2NvbXB1dGVfZHBsbChjcnRjLCBjcnRjX3N0
YXRlLCBOVUxMKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHBudl9jcnRjX2NvbXB1
dGVfY2xvY2soc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+
YmFzZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShk
ZXYpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGltaXQ7CisJaW50IHJlZmNsayA9IDk2
MDAwOworCisJbWVtc2V0KCZjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlLCAwLAorCSAgICAgICBz
aXplb2YoY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZSkpOworCisJaWYgKGludGVsX2NydGNfaGFz
X3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0xWRFMpKSB7CisJCWlmIChpbnRlbF9wYW5l
bF91c2Vfc3NjKGRldl9wcml2KSkgeworCQkJcmVmY2xrID0gZGV2X3ByaXYtPnZidC5sdmRzX3Nz
Y19mcmVxOworCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkJICAgICJ1c2luZyBT
U0MgcmVmZXJlbmNlIGNsb2NrIG9mICVkIGtIelxuIiwKKwkJCQkgICAgcmVmY2xrKTsKKwkJfQor
CisJCWxpbWl0ID0gJnBudl9saW1pdHNfbHZkczsKKwl9IGVsc2UgeworCQlsaW1pdCA9ICZwbnZf
bGltaXRzX3Nkdm87CisJfQorCisJaWYgKCFjcnRjX3N0YXRlLT5jbG9ja19zZXQgJiYKKwkgICAg
IXBudl9maW5kX2Jlc3RfZHBsbChsaW1pdCwgY3J0Y19zdGF0ZSwgY3J0Y19zdGF0ZS0+cG9ydF9j
bG9jaywKKwkJCQlyZWZjbGssIE5VTEwsICZjcnRjX3N0YXRlLT5kcGxsKSkgeworCQlkcm1fZXJy
KCZkZXZfcHJpdi0+ZHJtLAorCQkJIkNvdWxkbid0IGZpbmQgUExMIHNldHRpbmdzIGZvciBtb2Rl
IVxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWk5eHhfY29tcHV0ZV9kcGxsKGNydGMs
IGNydGNfc3RhdGUsIE5VTEwpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgaTl4eF9j
cnRjX2NvbXB1dGVfY2xvY2soc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkJICAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNydGMtPmJhc2UuZGV2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZGV2KTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0OworCWludCBy
ZWZjbGsgPSA5NjAwMDsKKworCW1lbXNldCgmY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0ZSwgMCwK
KwkgICAgICAgc2l6ZW9mKGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUpKTsKKworCWlmIChpbnRl
bF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9MVkRTKSkgeworCQlpZiAo
aW50ZWxfcGFuZWxfdXNlX3NzYyhkZXZfcHJpdikpIHsKKwkJCXJlZmNsayA9IGRldl9wcml2LT52
YnQubHZkc19zc2NfZnJlcTsKKwkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJCSAg
ICAidXNpbmcgU1NDIHJlZmVyZW5jZSBjbG9jayBvZiAlZCBrSHpcbiIsCisJCQkJICAgIHJlZmNs
ayk7CisJCX0KKworCQlsaW1pdCA9ICZpbnRlbF9saW1pdHNfaTl4eF9sdmRzOworCX0gZWxzZSB7
CisJCWxpbWl0ID0gJmludGVsX2xpbWl0c19pOXh4X3Nkdm87CisJfQorCisJaWYgKCFjcnRjX3N0
YXRlLT5jbG9ja19zZXQgJiYKKwkgICAgIWk5eHhfZmluZF9iZXN0X2RwbGwobGltaXQsIGNydGNf
c3RhdGUsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCisJCQkJIHJlZmNsaywgTlVMTCwgJmNydGNf
c3RhdGUtPmRwbGwpKSB7CisJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCisJCQkiQ291bGRuJ3Qg
ZmluZCBQTEwgc2V0dGluZ3MgZm9yIG1vZGUhXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQor
CisJaTl4eF9jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19zdGF0ZSwgTlVMTCk7CisKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIGludCBpOHh4X2NydGNfY29tcHV0ZV9jbG9jayhzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKKwkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
K3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCWNvbnN0IHN0cnVjdCBp
bnRlbF9saW1pdCAqbGltaXQ7CisJaW50IHJlZmNsayA9IDQ4MDAwOworCisJbWVtc2V0KCZjcnRj
X3N0YXRlLT5kcGxsX2h3X3N0YXRlLCAwLAorCSAgICAgICBzaXplb2YoY3J0Y19zdGF0ZS0+ZHBs
bF9od19zdGF0ZSkpOworCisJaWYgKGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5U
RUxfT1VUUFVUX0xWRFMpKSB7CisJCWlmIChpbnRlbF9wYW5lbF91c2Vfc3NjKGRldl9wcml2KSkg
eworCQkJcmVmY2xrID0gZGV2X3ByaXYtPnZidC5sdmRzX3NzY19mcmVxOworCQkJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sCisJCQkJICAgICJ1c2luZyBTU0MgcmVmZXJlbmNlIGNsb2NrIG9m
ICVkIGtIelxuIiwKKwkJCQkgICAgcmVmY2xrKTsKKwkJfQorCisJCWxpbWl0ID0gJmludGVsX2xp
bWl0c19pOHh4X2x2ZHM7CisJfSBlbHNlIGlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3Rh
dGUsIElOVEVMX09VVFBVVF9EVk8pKSB7CisJCWxpbWl0ID0gJmludGVsX2xpbWl0c19pOHh4X2R2
bzsKKwl9IGVsc2UgeworCQlsaW1pdCA9ICZpbnRlbF9saW1pdHNfaTh4eF9kYWM7CisJfQorCisJ
aWYgKCFjcnRjX3N0YXRlLT5jbG9ja19zZXQgJiYKKwkgICAgIWk5eHhfZmluZF9iZXN0X2RwbGwo
bGltaXQsIGNydGNfc3RhdGUsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCisJCQkJIHJlZmNsaywg
TlVMTCwgJmNydGNfc3RhdGUtPmRwbGwpKSB7CisJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCisJ
CQkiQ291bGRuJ3QgZmluZCBQTEwgc2V0dGluZ3MgZm9yIG1vZGUhXG4iKTsKKwkJcmV0dXJuIC1F
SU5WQUw7CisJfQorCisJaTh4eF9jb21wdXRlX2RwbGwoY3J0YywgY3J0Y19zdGF0ZSwgTlVMTCk7
CisKKwlyZXR1cm4gMDsKK30KKwordm9pZAoraW50ZWxfZHBsbF9pbml0X2Nsb2NrX2hvb2soc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoreworCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDkgfHwgSEFTX0RESShkZXZfcHJpdikpCisJCWRldl9wcml2LT5kaXNwbGF5LmNydGNf
Y29tcHV0ZV9jbG9jayA9IGhzd19jcnRjX2NvbXB1dGVfY2xvY2s7CisJZWxzZSBpZiAoSEFTX1BD
SF9TUExJVChkZXZfcHJpdikpCisJCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9j
ayA9IGlsa19jcnRjX2NvbXB1dGVfY2xvY2s7CisJZWxzZSBpZiAoSVNfQ0hFUlJZVklFVyhkZXZf
cHJpdikpCisJCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jayA9IGNodl9jcnRj
X2NvbXB1dGVfY2xvY2s7CisJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCisJCWRl
dl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jayA9IHZsdl9jcnRjX2NvbXB1dGVfY2xv
Y2s7CisJZWxzZSBpZiAoSVNfRzRYKGRldl9wcml2KSkKKwkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0
Y19jb21wdXRlX2Nsb2NrID0gZzR4X2NydGNfY29tcHV0ZV9jbG9jazsKKwllbHNlIGlmIChJU19Q
SU5FVklFVyhkZXZfcHJpdikpCisJCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9j
ayA9IHBudl9jcnRjX2NvbXB1dGVfY2xvY2s7CisJZWxzZSBpZiAoIUlTX0dFTihkZXZfcHJpdiwg
MikpCisJCWRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9jayA9IGk5eHhfY3J0Y19j
b21wdXRlX2Nsb2NrOworCWVsc2UKKwkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Ns
b2NrID0gaTh4eF9jcnRjX2NvbXB1dGVfY2xvY2s7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwbGwuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHBsbC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAw
MC4uY2FmNDYxNTA5MmUxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcGxsLmgKQEAgLTAsMCArMSwyMyBAQAorLyogU1BEWC1MaWNlbnNlLUlk
ZW50aWZpZXI6IE1JVCAqLworLyoKKyAqIENvcHlyaWdodCDCqSAyMDIwIEludGVsIENvcnBvcmF0
aW9uCisgKi8KKworI2lmbmRlZiBfSU5URUxfRFBMTF9IXworI2RlZmluZSBfSU5URUxfRFBMTF9I
XworCitzdHJ1Y3QgZHBsbDsKK3N0cnVjdCBkcm1faTkxNV9wcml2YXRlOworc3RydWN0IGludGVs
X2NydGM7CitzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZTsKKwordm9pZCBpbnRlbF9kcGxsX2luaXRf
Y2xvY2tfaG9vayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOworaW50IHZsdl9j
YWxjX2RwbGxfcGFyYW1zKGludCByZWZjbGssIHN0cnVjdCBkcGxsICpjbG9jayk7CitpbnQgcG52
X2NhbGNfZHBsbF9wYXJhbXMoaW50IHJlZmNsaywgc3RydWN0IGRwbGwgKmNsb2NrKTsKK2ludCBp
OXh4X2NhbGNfZHBsbF9wYXJhbXMoaW50IHJlZmNsaywgc3RydWN0IGRwbGwgKmNsb2NrKTsKK3Zv
aWQgdmx2X2NvbXB1dGVfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJICAgICAgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKTsKK3ZvaWQgY2h2X2NvbXB1dGVfZHBs
bChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJICAgICAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKnBpcGVfY29uZmlnKTsKKworI2VuZGlmCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50
ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

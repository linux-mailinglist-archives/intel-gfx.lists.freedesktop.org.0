Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 98C574DCFC
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 23:46:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 36ED26E7F5;
	Thu, 20 Jun 2019 21:46:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 632D66E7F5
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 21:46:18 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 20 Jun 2019 23:46:11 +0200
Message-Id: <20190620214613.14481-8-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
References: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 7/9] drm/i915: Prepare to split crtc state in
 uapi and hw state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugd2FudCB0byBzcGxpdCBkcm1fY3J0Y19zdGF0ZSBpbnRvIHRoZSB1c2VyIHZpc2libGUgc3Rh
dGUKYW5kIGFjdHVhbCBoYXJkd2FyZSBzdGF0ZS4gVG8gcHJlcGFyZSBmb3IgdGhpcywgd2UgbmVl
ZCBzb21lCmdyb3VuZCBydWxlcyB3aGF0IHNob3VsZCBiZSBpbiBlYWNoIHN0YXRlOgoKSW4gdWFw
aSB3ZSB1c2U6Ci0gY3J0YywgKl9jaGFuZ2VkIGZsYWdzLCBldmVudCwgY29tbWl0LCBzdGF0ZSwg
bW9kZV9ibG9iLCAocGxhbmUvY29ubmVjdG9yL2VuY29kZXIpX21hc2suCgpJbiBodyBzdGF0ZSB3
ZSB1c2Ugd2hhdCdzIGRpc3BsYXllZCBpbiBoYXJkd2FyZToKLSBlbmFibGUsIGFjdGl2ZSwgKGFk
anVzdGVkKSBtb2RlLCBjb2xvciBwcm9wZXJ0eSBibG9icy4KCmNsZWFyX2ludGVsX2NydGNfc3Rh
dGUgYW5kIGh3IHJlYWRvdXQgbmVlZCB0byBiZSB1cGRhdGVkIGZvciB0aGVzZSBydWxlcywKd2hp
Y2ggd2lsbCBhbGxvdyB1cyB0byBlbmFibGUgMiBqb2luZWQgcGlwZXMuCgpTaWduZWQtb2ZmLWJ5
OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jICAgICAgICB8ICAxOCAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyAgIHwgIDE2ICst
CiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgfCAgIDYgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYyAgICB8ICAxNCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5jICAgICAgIHwgICA0ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMgICAgfCAgIDggKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29sb3IuYyAgICB8IDE1MCArKy0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnQuYyAgICAgIHwgIDI0ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAgfCAgMjggKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8IDUyMSArKysrKysr
KystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyAgICAg
ICB8ICA0MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyAg
IHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmMg
fCAgMTQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBsbF9tZ3IuYyB8
ICAzNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kdm8uYyAgICAgIHwg
IDE0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jICAgICAgfCAg
IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jICAgICB8ICA2
MiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHNwY29uLmMgICB8ICAg
NCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9sdmRzLmMgICAgIHwgIDEy
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMgICAgfCAgMTQg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGlwZV9jcmMuYyB8ICAgNiAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyAgICAgIHwgIDEwICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nkdm8uYyAgICAgfCAgMjIgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgICB8ICAyNSArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF90di5jICAgICAgIHwgICA4ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYyAgICAgfCAgMTAgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jICAgICAgICB8ICAyMCArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgIDE0ICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaCAgICAgICAgICAgICAgfCAgMjggKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgICB8IDE3OSArKystLS0KIDMw
IGZpbGVzIGNoYW5nZWQsIDY3OCBpbnNlcnRpb25zKCspLCA2MzkgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYwppbmRleCBiODY3M2RlYmY5MzIuLjFkNDU5
ZGM3Y2ZhNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNp
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMKQEAgLTI3Nyw3
ICsyNzcsNyBAQCBzdGF0aWMgdm9pZCBjb25maWd1cmVfZHVhbF9saW5rX21vZGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlpZiAoaW50ZWxfZHNpLT5kdWFsX2xpbmsgPT0gRFNJ
X0RVQUxfTElOS19GUk9OVF9CQUNLKSB7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlID0KLQkJCQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7
CisJCQkJCSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJdTMyIGRzc19jdGwyOwog
CQl1MTYgaGFjdGl2ZSA9IGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXk7CiAJCXUxNiBkbF9i
dWZmZXJfZGVwdGg7CkBAIC02MjIsNyArNjIyLDcgQEAgZ2VuMTFfZHNpX2NvbmZpZ3VyZV90cmFu
c2NvZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVj
dCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2Up
OwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2Nv
bmZpZy0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2lu
dGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUgPSBpbnRl
bF9jcnRjLT5waXBlOwogCXUzMiB0bXA7CiAJZW51bSBwb3J0IHBvcnQ7CkBAIC03NjAsNyArNzYw
LDcgQEAgZ2VuMTFfZHNpX3NldF90cmFuc2NvZGVyX3RpbWluZ3Moc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpID0gZW5j
X3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJCQkmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKKwkJCQkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCWVudW0gcG9ydCBw
b3J0OwogCWVudW0gdHJhbnNjb2RlciBkc2lfdHJhbnM7CiAJLyogaG9yaXpvbnRhbCB0aW1pbmdz
ICovCkBAIC0xMjAxLDcgKzEyMDEsNyBAQCBzdGF0aWMgdm9pZCBnZW4xMV9kc2lfZ2V0X3RpbWlu
Z3Moc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGludGVsX2RzaSAq
aW50ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJCQkmcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKKwkJCQkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJ
aWYgKGludGVsX2RzaS0+ZHVhbF9saW5rKSB7CiAJCWFkanVzdGVkX21vZGUtPmNydGNfaGRpc3Bs
YXkgKj0gMjsKQEAgLTEyMjcsMTYgKzEyMjcsMTYgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dl
dF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMp
OwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29k
ZXItPmJhc2UpOwogCiAJLyogRklYTUU6IGFkYXB0IGljbF9kZGlfY2xvY2tfZ2V0KCkgZm9yIERT
SSBhbmQgdXNlIHRoYXQ/ICovCiAJcGlwZV9jb25maWctPnBvcnRfY2xvY2sgPQogCQljbmxfY2Fs
Y193cnBsbF9saW5rKGRldl9wcml2LCAmcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUpOwogCi0J
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gaW50ZWxfZHNpLT5w
Y2xrOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBpbnRlbF9k
c2ktPnBjbGs7CiAJaWYgKGludGVsX2RzaS0+ZHVhbF9saW5rKQotCQlwaXBlX2NvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgKj0gMjsKKwkJcGlwZV9jb25maWctPmh3LmFkanVz
dGVkX21vZGUuY3J0Y19jbG9jayAqPSAyOwogCiAJZ2VuMTFfZHNpX2dldF90aW1pbmdzKGVuY29k
ZXIsIHBpcGVfY29uZmlnKTsKIAlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzIHw9IEJJVChJTlRF
TF9PVVRQVVRfRFNJKTsKQEAgLTEyNTAsMTEgKzEyNTAsMTEgQEAgc3RhdGljIGludCBnZW4xMV9k
c2lfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0
IGludGVsX2RzaSAqaW50ZWxfZHNpID0gY29udGFpbmVyX29mKGVuY29kZXIsIHN0cnVjdCBpbnRl
bF9kc2ksCiAJCQkJCQkgICBiYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9j
b25uZWN0b3IgPSBpbnRlbF9kc2ktPmF0dGFjaGVkX2Nvbm5lY3RvcjsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNy
dGMpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlID0KIAkJCQkJ
aW50ZWxfY29ubmVjdG9yLT5wYW5lbC5maXhlZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICphZGp1c3RlZF9tb2RlID0KLQkJCQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21v
ZGU7CisJCQkJCSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCXBpcGVfY29uZmln
LT5vdXRwdXRfZm9ybWF0ID0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0I7CiAJaW50ZWxfZml4ZWRf
cGFuZWxfbW9kZShmaXhlZF9tb2RlLCBhZGp1c3RlZF9tb2RlKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCmluZGV4IDkwY2ExMWE0YWU4OC4uYjk1MDE1Y2Zh
NWRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKQEAg
LTE4NiwxMyArMTg2LDE0IEBAIGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX2R1cGxpY2F0ZV9zdGF0
ZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogc3RydWN0IGRybV9jcnRjX3N0YXRl
ICoKIGludGVsX2NydGNfZHVwbGljYXRlX3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKIHsK
Kwljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUgPSB0b19pbnRl
bF9jcnRjX3N0YXRlKGNydGMtPnN0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZTsKIAotCWNydGNfc3RhdGUgPSBrbWVtZHVwKGNydGMtPnN0YXRlLCBzaXplb2YoKmNy
dGNfc3RhdGUpLCBHRlBfS0VSTkVMKTsKKwljcnRjX3N0YXRlID0ga21lbWR1cChvbGRfY3J0Y19z
dGF0ZSwgc2l6ZW9mKCpjcnRjX3N0YXRlKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFjcnRjX3N0YXRl
KQogCQlyZXR1cm4gTlVMTDsKIAotCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kdXBsaWNhdGVf
c3RhdGUoY3J0YywgJmNydGNfc3RhdGUtPmJhc2UpOworCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0
Y19kdXBsaWNhdGVfc3RhdGUoY3J0YywgJmNydGNfc3RhdGUtPnVhcGkpOwogCiAJY3J0Y19zdGF0
ZS0+dXBkYXRlX3BpcGUgPSBmYWxzZTsKIAljcnRjX3N0YXRlLT5kaXNhYmxlX2xwX3dtID0gZmFs
c2U7CkBAIC0yMDUsNyArMjA2LDcgQEAgaW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0
IGRybV9jcnRjICpjcnRjKQogCWNydGNfc3RhdGUtPmZiX2JpdHMgPSAwOwogCWNydGNfc3RhdGUt
PnVwZGF0ZV9wbGFuZXMgPSAwOwogCi0JcmV0dXJuICZjcnRjX3N0YXRlLT5iYXNlOworCXJldHVy
biAmY3J0Y19zdGF0ZS0+dWFwaTsKIH0KIAogLyoqCkBAIC0yMjAsNyArMjIxLDEwIEBAIHZvaWQK
IGludGVsX2NydGNfZGVzdHJveV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCQkgc3Ry
dWN0IGRybV9jcnRjX3N0YXRlICpzdGF0ZSkKIHsKLQlkcm1fYXRvbWljX2hlbHBlcl9jcnRjX2Rl
c3Ryb3lfc3RhdGUoY3J0Yywgc3RhdGUpOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShzdGF0ZSk7CisKKwlfX2RybV9hdG9taWNfaGVs
cGVyX2NydGNfZGVzdHJveV9zdGF0ZSgmY3J0Y19zdGF0ZS0+dWFwaSk7CisJa2ZyZWUoY3J0Y19z
dGF0ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19zZXR1cF9zY2FsZXIoc3RydWN0
IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUsCkBAIC0zMTYsNyArMzIwLDcg
QEAgaW50IGludGVsX2F0b21pY19zZXR1cF9zY2FsZXJzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0gTlVM
TDsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zY2FsZXJfc3RhdGUgKnNjYWxlcl9zdGF0ZSA9CiAJCSZj
cnRjX3N0YXRlLT5zY2FsZXJfc3RhdGU7Ci0Jc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKmRybV9z
dGF0ZSA9IGNydGNfc3RhdGUtPmJhc2Uuc3RhdGU7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUg
KmRybV9zdGF0ZSA9IGNydGNfc3RhdGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoZHJtX3N0YXRlKTsK
IAlpbnQgbnVtX3NjYWxlcnNfbmVlZDsKIAlpbnQgaTsKQEAgLTM4NCw3ICszODgsNyBAQCBpbnQg
aW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQkJCSAqIGJ1dCBzaW5jZSB0aGlzIHBsYW5lIGlzIHVuY2hhbmdlZCBqdXN0IGRvIHRo
ZQogCQkJCSAqIG1pbmltdW0gcmVxdWlyZWQgdmFsaWRhdGlvbi4KIAkJCQkgKi8KLQkJCQljcnRj
X3N0YXRlLT5iYXNlLnBsYW5lc19jaGFuZ2VkID0gdHJ1ZTsKKwkJCQljcnRjX3N0YXRlLT51YXBp
LnBsYW5lc19jaGFuZ2VkID0gdHJ1ZTsKIAkJCX0KIAogCQkJaW50ZWxfcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2F0b21pY19wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9hdG9taWNfcGxhbmUuYwppbmRleCAwMjVjMDk0NjFjOWEuLjc1ODc1MTkxNzBmYiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCkBA
IC0yNTYsNyArMjU2LDcgQEAgdm9pZCBpbnRlbF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKIAkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAogCXRyYWNlX2ludGVsX3VwZGF0ZV9wbGFuZSgmcGxhbmUtPmJhc2Us
IGNydGMpOwogCXBsYW5lLT51cGRhdGVfcGxhbmUocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0
YXRlKTsKQEAgLTI2Niw3ICsyNjYsNyBAQCB2b2lkIGludGVsX3VwZGF0ZV9zbGF2ZShzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lLAogCQkJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpOwogCiAJdHJhY2VfaW50ZWxfdXBkYXRlX3BsYW5lKCZwbGFu
ZS0+YmFzZSwgY3J0Yyk7CiAJcGxhbmUtPnVwZGF0ZV9zbGF2ZShwbGFuZSwgY3J0Y19zdGF0ZSwg
cGxhbmVfc3RhdGUpOwpAQCAtMjc1LDcgKzI3NSw3IEBAIHZvaWQgaW50ZWxfdXBkYXRlX3NsYXZl
KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiB2b2lkIGludGVsX2Rpc2FibGVfcGxhbmUoc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAogCXRyYWNlX2ludGVsX2Rpc2Fi
bGVfcGxhbmUoJnBsYW5lLT5iYXNlLCBjcnRjKTsKIAlwbGFuZS0+ZGlzYWJsZV9wbGFuZShwbGFu
ZSwgY3J0Y19zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2F1ZGlvLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F1ZGlv
LmMKaW5kZXggODQwZGFmZjEyMjQ2Li4zMjdmODQ5ZjEzZjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2F1ZGlvLmMKQEAgLTE4OCw3ICsxODgsNyBAQCBzdGF0aWMgY29u
c3Qgc3RydWN0IHsKIHN0YXRpYyB1MzIgYXVkaW9fY29uZmlnX2hkbWlfcGl4ZWxfY2xvY2soY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5h
ZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgaTsK
IAogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGhkbWlfYXVkaW9fY2xvY2spOyBpKyspIHsK
QEAgLTIxMyw3ICsyMTMsNyBAQCBzdGF0aWMgaW50IGF1ZGlvX2NvbmZpZ19oZG1pX2dldF9uKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgIGludCByYXRl
KQogewogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJ
JmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVz
dGVkX21vZGU7CiAJaW50IGk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShoZG1pX2F1
ZF9uY3RzKTsgaSsrKSB7CkBAIC00OTksNyArNDk5LDcgQEAgc3RhdGljIHZvaWQgaWxrX2F1ZGlv
X2NvZGVjX2Rpc2FibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICAgIGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlw
ZTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJdTMyIHRtcCwgZWxkdjsKQEAg
LTU0NSw3ICs1NDUsNyBAQCBzdGF0aWMgdm9pZCBpbGtfYXVkaW9fY29kZWNfZW5hYmxlKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVj
dG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0
cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0YXRlLT5jb25uZWN0b3I7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+
cG9ydDsKQEAgLTYzNCwxMCArNjM0LDEwIEBAIHZvaWQgaW50ZWxfYXVkaW9fY29kZWNfZW5hYmxl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpOTE1
X2F1ZGlvX2NvbXBvbmVudCAqYWNvbXAgPSBkZXZfcHJpdi0+YXVkaW9fY29tcG9uZW50OwotCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNy
dGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0
YXRlLT5jb25uZWN0b3I7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVk
X21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCkBAIC02OTUsNyArNjk1LDcgQEAgdm9pZCBp
bnRlbF9hdWRpb19jb2RlY19kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCXN0cnVjdCBpOTE1X2F1ZGlvX2NvbXBvbmVudCAqYWNvbXAgPSBkZXZfcHJp
di0+YXVkaW9fY29tcG9uZW50OwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBwb3J0
IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5jCmluZGV4IDc1M2FjMzE2NTA2MS4u
MWYyMWRmYmMyODhiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2J3LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5jCkBA
IC0yNTksNyArMjU5LDcgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9id19jcnRjX251bV9h
Y3RpdmVfcGxhbmVzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXQKIAogc3RhdGljIHVuc2ln
bmVkIGludCBpbnRlbF9id19jcnRjX2RhdGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAl1bnNpZ25lZCBpbnQgZGF0
YV9yYXRlID0gMDsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkOwogCkBAIC0yODAsNyArMjgwLDcg
QEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9id19jcnRjX2RhdGFfcmF0ZShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y18KIHZvaWQgaW50ZWxfYndfY3J0Y191cGRhdGUoc3Ry
dWN0IGludGVsX2J3X3N0YXRlICpid19zdGF0ZSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAKIAlid19zdGF0ZS0+
ZGF0YV9yYXRlW2NydGMtPnBpcGVdID0KIAkJaW50ZWxfYndfY3J0Y19kYXRhX3JhdGUoY3J0Y19z
dGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Nk
Y2xrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMKaW5kZXgg
ODk5M2FiMjgzNTYyLi41YmJiOGE4MTliN2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2NkY2xrLmMKQEAgLTIyMDIsMTAgKzIyMDIsMTAgQEAgc3RhdGljIGludCBpbnRl
bF9waXhlbF9yYXRlX3RvX2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IGludCBpbnRlbF9jcnRjX2NvbXB1dGVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9Ci0JCXRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCQl0b19pOTE1KGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlpbnQgbWluX2NkY2xrOwogCi0JaWYgKCFjcnRj
X3N0YXRlLT5iYXNlLmVuYWJsZSkKKwlpZiAoIWNydGNfc3RhdGUtPmh3LmVuYWJsZSkKIAkJcmV0
dXJuIDA7CiAKIAltaW5fY2RjbGsgPSBpbnRlbF9waXhlbF9yYXRlX3RvX2NkY2xrKGRldl9wcml2
LCBjcnRjX3N0YXRlLT5waXhlbF9yYXRlKTsKQEAgLTIzMTMsNyArMjMxMyw3IEBAIHN0YXRpYyB1
OCBjbmxfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAkgICAgICAgc2l6ZW9mKHN0YXRlLT5taW5fdm9sdGFnZV9sZXZlbCkpOwogCiAJ
Zm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIGNydGNfc3RhdGUs
IGkpIHsKLQkJaWYgKGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCQlpZiAoY3J0Y19zdGF0ZS0+
aHcuZW5hYmxlKQogCQkJc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsW2ldID0KIAkJCQljcnRjX3N0
YXRlLT5taW5fdm9sdGFnZV9sZXZlbDsKIAkJZWxzZQpAQCAtMjM5OSw3ICsyMzk5LDcgQEAgc3Rh
dGljIGludCBza2xfZHBsbDBfdmNvKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQog
CQl2Y28gPSBkZXZfcHJpdi0+c2tsX3ByZWZlcnJlZF92Y29fZnJlcTsKIAogCWZvcl9lYWNoX25l
d19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7Ci0JCWlm
ICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxl
KQogCQkJY29udGludWU7CiAKIAkJaWYgKCFpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUs
IElOVEVMX09VVFBVVF9FRFApKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9jb2xvci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9j
b2xvci5jCmluZGV4IDIzYTg0ZGQ3OTg5Zi4uMWQyM2Y4YTllMzUxIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jb2xvci5jCkBAIC0xMDEsMTAgKzEwMSwxMCBAQCBzdGF0
aWMgYm9vbCBsdXRfaXNfbGVnYWN5KGNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqbHV0
KQogCiBzdGF0aWMgYm9vbCBjcnRjX3N0YXRlX2lzX2xlZ2FjeV9nYW1tYShjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlyZXR1cm4gIWNydGNfc3RhdGUtPmJh
c2UuZGVnYW1tYV9sdXQgJiYKLQkJIWNydGNfc3RhdGUtPmJhc2UuY3RtICYmCi0JCWNydGNfc3Rh
dGUtPmJhc2UuZ2FtbWFfbHV0ICYmCi0JCWx1dF9pc19sZWdhY3koY3J0Y19zdGF0ZS0+YmFzZS5n
YW1tYV9sdXQpOworCXJldHVybiAhY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQgJiYKKwkJIWNy
dGNfc3RhdGUtPmh3LmN0bSAmJgorCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKKwkJbHV0
X2lzX2xlZ2FjeShjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQpOwogfQogCiAvKgpAQCAtMTg5LDcg
KzE4OSw3IEBAIHN0YXRpYyB2b2lkIGljbF91cGRhdGVfb3V0cHV0X2NzYyhzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIAogc3RhdGljIGJvb2wgaWxrX2NzY19saW1pdGVkX3JhbmdlKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjLT5kZXYpOwogCiAJLyoKIAkgKiBGSVhNRSBpZiB0aGVyZSdzIGEgZ2FtbWEgTFVU
IGFmdGVyIHRoZSBDU0MsIHdlIHNob3VsZApAQCAtMjAzLDcgKzIwMyw3IEBAIHN0YXRpYyBib29s
IGlsa19jc2NfbGltaXRlZF9yYW5nZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGlsa19jc2NfY29udmVydF9jdG0oY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJdTE2IGNvZWZmc1s5XSkKIHsKLQljb25z
dCBzdHJ1Y3QgZHJtX2NvbG9yX2N0bSAqY3RtID0gY3J0Y19zdGF0ZS0+YmFzZS5jdG0tPmRhdGE7
CisJY29uc3Qgc3RydWN0IGRybV9jb2xvcl9jdG0gKmN0bSA9IGNydGNfc3RhdGUtPmh3LmN0bS0+
ZGF0YTsKIAljb25zdCB1NjQgKmlucHV0OwogCXU2NCB0ZW1wWzldOwogCWludCBpOwpAQCAtMjU0
LDExICsyNTQsMTEgQEAgc3RhdGljIHZvaWQgaWxrX2NzY19jb252ZXJ0X2N0bShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIHZvaWQgaWxrX2xvYWRf
Y3NjX21hdHJpeChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFz
ZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlib29sIGxpbWl0ZWRfY29sb3JfcmFuZ2UgPSBpbGtf
Y3NjX2xpbWl0ZWRfcmFuZ2UoY3J0Y19zdGF0ZSk7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5j
dG0pIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuY3RtKSB7CiAJCXUxNiBjb2VmZls5XTsKIAogCQlp
bGtfY3NjX2NvbnZlcnRfY3RtKGNydGNfc3RhdGUsIGNvZWZmKTsKQEAgLTI5MywxMCArMjkzLDEw
IEBAIHN0YXRpYyB2b2lkIGlsa19sb2FkX2NzY19tYXRyaXgoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lkIGljbF9sb2FkX2NzY19tYXRyaXgo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5jdG0pIHsKKwlpZiAoY3J0Y19z
dGF0ZS0+aHcuY3RtKSB7CiAJCXUxNiBjb2VmZls5XTsKIAogCQlpbGtfY3NjX2NvbnZlcnRfY3Rt
KGNydGNfc3RhdGUsIGNvZWZmKTsKQEAgLTMyMiwxMiArMzIyLDEyIEBAIHN0YXRpYyB2b2lkIGlj
bF9sb2FkX2NzY19tYXRyaXgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCiAgKi8KIHN0YXRpYyB2b2lkIGNoZXJyeXZpZXdfbG9hZF9jc2NfbWF0cml4KGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAotCWlmIChjcnRjX3N0YXRlLT5i
YXNlLmN0bSkgewotCQljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2N0bSAqY3RtID0gY3J0Y19zdGF0
ZS0+YmFzZS5jdG0tPmRhdGE7CisJaWYgKGNydGNfc3RhdGUtPmh3LmN0bSkgeworCQljb25zdCBz
dHJ1Y3QgZHJtX2NvbG9yX2N0bSAqY3RtID0gY3J0Y19zdGF0ZS0+aHcuY3RtLT5kYXRhOwogCQl1
MTYgY29lZmZzWzldID0ge307CiAJCWludCBpOwogCkBAIC0zODgsNyArMzg4LDcgQEAgc3RhdGlj
IHUzMiBpbGtfbHV0XzEwKGNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpjb2xvcikKIHN0YXRp
YyB2b2lkIGk5eHhfbG9hZF9sdXRzX2ludGVybmFsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2Ig
KmJsb2IpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRj
LT5waXBlOwogCWludCBpOwpAQCAtNDE5LDEyICs0MTksMTIgQEAgc3RhdGljIHZvaWQgaTl4eF9s
b2FkX2x1dHNfaW50ZXJuYWwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAKIHN0YXRpYyB2b2lkIGk5eHhfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCWk5eHhfbG9hZF9sdXRzX2ludGVybmFsKGNydGNfc3Rh
dGUsIGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0KTsKKwlpOXh4X2xvYWRfbHV0c19pbnRlcm5h
bChjcnRjX3N0YXRlLCBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQpOwogfQogCiBzdGF0aWMgdm9p
ZCBpOXh4X2NvbG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMt
PnBpcGU7CiAJdTMyIHZhbDsKQEAgLTQzNyw3ICs0MzcsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2Nv
bG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAog
c3RhdGljIHZvaWQgaWxrX2NvbG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlw
ZSA9IGNydGMtPnBpcGU7CiAJdTMyIHZhbDsKQEAgLTQ1Miw3ICs0NTIsNyBAQCBzdGF0aWMgdm9p
ZCBpbGtfY29sb3JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogCiBzdGF0aWMgdm9pZCBoc3dfY29sb3JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJSTkx
NV9XUklURShHQU1NQV9NT0RFKGNydGMtPnBpcGUpLCBjcnRjX3N0YXRlLT5nYW1tYV9tb2RlKTsK
QEAgLTQ2Miw3ICs0NjIsNyBAQCBzdGF0aWMgdm9pZCBoc3dfY29sb3JfY29tbWl0KGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgdm9pZCBza2xfY29s
b3JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewot
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNl
LmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1
MzIgdmFsID0gMDsKQEAgLTUwOCw4ICs1MDgsOCBAQCBzdGF0aWMgdm9pZCBpOTY1X2xvYWRfbHV0
XzEwcDYoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIHN0YXRpYyB2b2lkIGk5NjVfbG9hZF9s
dXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMp
OwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0
ZS0+YmFzZS5nYW1tYV9sdXQ7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9i
bG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAKIAlpZiAoY3J0Y19z
dGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkKIAkJaTl4eF9sb2FkX2x1
dHMoY3J0Y19zdGF0ZSk7CkBAIC01MzEsOCArNTMxLDggQEAgc3RhdGljIHZvaWQgaWxrX2xvYWRf
bHV0XzEwKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMgdm9pZCBpbGtfbG9hZF9s
dXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMp
OwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0
ZS0+YmFzZS5nYW1tYV9sdXQ7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9i
bG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAKIAlpZiAoY3J0Y19z
dGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkKIAkJaTl4eF9sb2FkX2x1
dHMoY3J0Y19zdGF0ZSk7CkBAIC02MzIsOSArNjMyLDkgQEAgc3RhdGljIHZvaWQgaXZiX2xvYWRf
bHV0X2V4dF9tYXgoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAKIHN0YXRpYyB2b2lkIGl2Yl9s
b2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0J
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRj
X3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKLQljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2Ig
KmRlZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dDsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwlj
b25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3
LmdhbW1hX2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0
ID0gY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQ7CiAKIAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFf
bW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkgewogCQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0
YXRlKTsKQEAgLTY1NSw5ICs2NTUsOSBAQCBzdGF0aWMgdm9pZCBpdmJfbG9hZF9sdXRzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgdm9pZCBiZHdf
bG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewot
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNl
LmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0
Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9i
ICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQ7CisJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJ
Y29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5o
dy5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpkZWdhbW1hX2x1
dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0OwogCiAJaWYgKGNydGNfc3RhdGUtPmdhbW1h
X21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFXzhCSVQpIHsKIAkJaTl4eF9sb2FkX2x1dHMoY3J0Y19z
dGF0ZSk7CkBAIC02NzgsMTEgKzY3OCwxMSBAQCBzdGF0aWMgdm9pZCBiZHdfbG9hZF9sdXRzKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgdm9pZCBn
bGtfbG9hZF9kZWdhbW1hX2x1dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMt
PnBpcGU7CiAJY29uc3QgdTMyIGx1dF9zaXplID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPmNvbG9y
LmRlZ2FtbWFfbHV0X3NpemU7Ci0JY29uc3Qgc3RydWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9IGNy
dGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQtPmRhdGE7CisJY29uc3Qgc3RydWN0IGRybV9jb2xv
cl9sdXQgKmx1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0LT5kYXRhOwogCXUzMiBpOwog
CiAJLyoKQEAgLTcxNyw3ICs3MTcsNyBAQCBzdGF0aWMgdm9pZCBnbGtfbG9hZF9kZWdhbW1hX2x1
dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogc3RhdGljIHZv
aWQgZ2xrX2xvYWRfZGVnYW1tYV9sdXRfbGluZWFyKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBw
aXBlID0gY3J0Yy0+cGlwZTsKIAljb25zdCB1MzIgbHV0X3NpemUgPSBJTlRFTF9JTkZPKGRldl9w
cml2KS0+Y29sb3IuZGVnYW1tYV9sdXRfc2l6ZTsKQEAgLTc0NCw4ICs3NDQsOCBAQCBzdGF0aWMg
dm9pZCBnbGtfbG9hZF9kZWdhbW1hX2x1dF9saW5lYXIoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdAogCiBzdGF0aWMgdm9pZCBnbGtfbG9hZF9sdXRzKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fcHJv
cGVydHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7Ci0Jc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0
Yyk7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0
YXRlLT5ody5nYW1tYV9sdXQ7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAKIAkvKgogCSAqIE9uIEdMSysgYm90aCBwaXBl
IENTQyBhbmQgZGVnYW1tYSBMVVQgYXJlIGNvbnRyb2xsZWQKQEAgLTc1NSw3ICs3NTUsNyBAQCBz
dGF0aWMgdm9pZCBnbGtfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogCSAqIHRoZSBkZWdhbWEgTFVUIHNvIHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byBy
ZWxvYWQKIAkgKiBpdCBldmVyeSB0aW1lIHRoZSBwaXBlIENTQyBpcyBiZWluZyBlbmFibGVkLgog
CSAqLwotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0KQorCWlmIChjcnRjX3N0YXRl
LT5ody5kZWdhbW1hX2x1dCkKIAkJZ2xrX2xvYWRfZGVnYW1tYV9sdXQoY3J0Y19zdGF0ZSk7CiAJ
ZWxzZQogCQlnbGtfbG9hZF9kZWdhbW1hX2x1dF9saW5lYXIoY3J0Y19zdGF0ZSk7CkBAIC03ODYs
NyArNzg2LDcgQEAgc3RhdGljIHZvaWQKIGljbF9sb2FkX2djbWF4KGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2NvbG9y
X2x1dCAqY29sb3IpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUg
PSBjcnRjLT5waXBlOwogCkBAIC03OTksOSArNzk5LDkgQEAgaWNsX2xvYWRfZ2NtYXgoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgdm9pZAogaWNsX3By
b2dyYW1fZ2FtbWFfc3VwZXJmaW5lX3NlZ21lbnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7CisJ
Y29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+aHcuZ2Ft
bWFfbHV0OwogCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9iLT5kYXRhOwog
CWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgaTsKQEAgLTgyOCw5ICs4MjgsOSBA
QCBpY2xfcHJvZ3JhbV9nYW1tYV9zdXBlcmZpbmVfc2VnbWVudChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkCiBpY2xfcHJvZ3JhbV9nYW1tYV9t
dWx0aV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5i
YXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxv
YiAqYmxvYiA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OworCWNvbnN0IHN0cnVjdCBkcm1f
cHJvcGVydHlfYmxvYiAqYmxvYiA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAljb25zdCBz
dHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0YTsKIAljb25zdCBzdHJ1Y3QgZHJt
X2NvbG9yX2x1dCAqZW50cnk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtODgw
LDEwICs4ODAsMTAgQEAgaWNsX3Byb2dyYW1fZ2FtbWFfbXVsdGlfc2VnbWVudChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogc3RhdGljIHZvaWQgaWNsX2xvYWRf
bHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQljb25z
dCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2Uu
Z2FtbWFfbHV0OwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2Ft
bWFfbHV0ID0gY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0OworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCi0JaWYgKGNydGNf
c3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0
KQogCQlnbGtfbG9hZF9kZWdhbW1hX2x1dChjcnRjX3N0YXRlKTsKIAogCXN3aXRjaCAoY3J0Y19z
dGF0ZS0+Z2FtbWFfbW9kZSAmIEdBTU1BX01PREVfTU9ERV9NQVNLKSB7CkBAIC05NTgsOSArOTU4
LDkgQEAgc3RhdGljIHZvaWQgY2h2X2xvYWRfY2dtX2dhbW1hKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAogCiBzdGF0aWMgdm9pZCBjaHZfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVy
dHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7Ci0JY29uc3Qg
c3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2Uu
ZGVnYW1tYV9sdXQ7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpn
YW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0Owog
CiAJY2hlcnJ5dmlld19sb2FkX2NzY19tYXRyaXgoY3J0Y19zdGF0ZSk7CiAKQEAgLTk3OCwyOCAr
OTc4LDI4IEBAIHN0YXRpYyB2b2lkIGNodl9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHZvaWQgaW50ZWxfY29sb3JfbG9hZF9sdXRzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjLT5kZXYpOwogCiAJZGV2X3ByaXYtPmRpc3BsYXkubG9hZF9sdXRzKGNydGNf
c3RhdGUpOwogfQogCiB2b2lkIGludGVsX2NvbG9yX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+
ZGV2KTsKIAogCWRldl9wcml2LT5kaXNwbGF5LmNvbG9yX2NvbW1pdChjcnRjX3N0YXRlKTsKIH0K
IAogaW50IGludGVsX2NvbG9yX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCiAJcmV0dXJuIGRl
dl9wcml2LT5kaXNwbGF5LmNvbG9yX2NoZWNrKGNydGNfc3RhdGUpOwogfQogCiB2b2lkIGludGVs
X2NvbG9yX2dldF9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAlpZiAoZGV2X3ByaXYtPmRp
c3BsYXkucmVhZF9sdXRzKQogCQlkZXZfcHJpdi0+ZGlzcGxheS5yZWFkX2x1dHMoY3J0Y19zdGF0
ZSk7CkBAIC0xMDIzLDE2ICsxMDIzLDE2IEBAIHN0YXRpYyBib29sIG5lZWRfcGxhbmVfdXBkYXRl
KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiBzdGF0aWMgaW50CiBpbnRlbF9jb2xvcl9hZGRf
YWZmZWN0ZWRfcGxhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19jcnRjX3N0YXRlLT5i
YXNlLnN0YXRlKTsKKwkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19jcnRjX3N0YXRlLT51YXBp
LnN0YXRlKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUg
PQogCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCi0JaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3Rp
dmUgfHwKLQkgICAgZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJm5ld19jcnRjX3N0YXRl
LT5iYXNlKSkKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKKwkgICAgZHJtX2F0
b21pY19jcnRjX25lZWRzX21vZGVzZXQoJm5ld19jcnRjX3N0YXRlLT51YXBpKSkKIAkJcmV0dXJu
IDA7CiAKIAlpZiAobmV3X2NydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSA9PSBvbGRfY3J0Y19zdGF0
ZS0+Z2FtbWFfZW5hYmxlICYmCkBAIC0xMDc0LDkgKzEwNzQsOSBAQCBzdGF0aWMgaW50IGNoZWNr
X2x1dF9zaXplKGNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqbHV0LCBpbnQgZXhwZWN0
ZWQpCiAKIHN0YXRpYyBpbnQgY2hlY2tfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX3By
b3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OwotCWNv
bnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZGVnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5i
YXNlLmRlZ2FtbWFfbHV0OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOworCWNvbnN0IHN0cnVjdCBkcm1fcHJv
cGVydHlfYmxvYiAqZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0OworCWNvbnN0
IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZGVnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5k
ZWdhbW1hX2x1dDsKIAlpbnQgZ2FtbWFfbGVuZ3RoLCBkZWdhbW1hX2xlbmd0aDsKIAl1MzIgZ2Ft
bWFfdGVzdHMsIGRlZ2FtbWFfdGVzdHM7CiAKQEAgLTExMjQsNyArMTEyNCw3IEBAIHN0YXRpYyBp
bnQgaTl4eF9jb2xvcl9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IAkJcmV0dXJuIHJldDsKIAogCWNydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSA9Ci0JCWNydGNfc3Rh
dGUtPmJhc2UuZ2FtbWFfbHV0ICYmCisJCWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCAmJgogCQkh
Y3J0Y19zdGF0ZS0+YzhfcGxhbmVzOwogCiAJY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9IGk5eHhf
Z2FtbWFfbW9kZShjcnRjX3N0YXRlKTsKQEAgLTExNDMsMTEgKzExNDMsMTEgQEAgc3RhdGljIHUz
MiBjaHZfY2dtX21vZGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiAJaWYgKGNydGNfc3RhdGVfaXNfbGVnYWN5X2dhbW1hKGNydGNfc3RhdGUpKQogCQlyZXR1cm4g
MDsKIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0KQorCWlmIChjcnRjX3N0YXRl
LT5ody5kZWdhbW1hX2x1dCkKIAkJY2dtX21vZGUgfD0gQ0dNX1BJUEVfTU9ERV9ERUdBTU1BOwot
CWlmIChjcnRjX3N0YXRlLT5iYXNlLmN0bSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuY3RtKQogCQlj
Z21fbW9kZSB8PSBDR01fUElQRV9NT0RFX0NTQzsKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5nYW1t
YV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCkKIAkJY2dtX21vZGUgfD0gQ0dN
X1BJUEVfTU9ERV9HQU1NQTsKIAogCXJldHVybiBjZ21fbW9kZTsKQEAgLTEyMDYsNyArMTIwNiw3
IEBAIHN0YXRpYyBpbnQgaWxrX2NvbG9yX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogCQlyZXR1cm4gcmV0OwogCiAJY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlID0K
LQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgJiYKKwkJY3J0Y19zdGF0ZS0+aHcuZ2FtbWFf
bHV0ICYmCiAJCSFjcnRjX3N0YXRlLT5jOF9wbGFuZXM7CiAKIAkvKgpAQCAtMTIzMiw4ICsxMjMy
LDggQEAgc3RhdGljIHUzMiBpdmJfZ2FtbWFfbW9kZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoIWNydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSB8fAogCSAg
ICBjcnRjX3N0YXRlX2lzX2xlZ2FjeV9nYW1tYShjcnRjX3N0YXRlKSkKIAkJcmV0dXJuIEdBTU1B
X01PREVfTU9ERV84QklUOwotCWVsc2UgaWYgKGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ICYm
Ci0JCSBjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0KQorCWVsc2UgaWYgKGNydGNfc3RhdGUt
Pmh3LmdhbW1hX2x1dCAmJgorCQkgY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQpCiAJCXJldHVy
biBHQU1NQV9NT0RFX01PREVfU1BMSVQ7CiAJZWxzZQogCQlyZXR1cm4gR0FNTUFfTU9ERV9NT0RF
XzEwQklUOwpAQCAtMTI0Nyw3ICsxMjQ3LDcgQEAgc3RhdGljIHUzMiBpdmJfY3NjX21vZGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICogQ1NDIGNvbWVzIGFm
dGVyIHRoZSBMVVQgaW4gZGVnYW1tYSwgUkdCLT5ZQ2JDciwKIAkgKiBhbmQgUkdCIGZ1bGwtPmxp
bWl0ZWQgcmFuZ2UgbW9kZS4KIAkgKi8KLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1
dCB8fAorCWlmIChjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCB8fAogCSAgICBjcnRjX3N0YXRl
LT5vdXRwdXRfZm9ybWF0ICE9IElOVEVMX09VVFBVVF9GT1JNQVRfUkdCIHx8CiAJICAgIGxpbWl0
ZWRfY29sb3JfcmFuZ2UpCiAJCXJldHVybiAwOwpAQCAtMTI2NSwxMyArMTI2NSwxMyBAQCBzdGF0
aWMgaW50IGl2Yl9jb2xvcl9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIAkJcmV0dXJuIHJldDsKIAogCWNydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSA9Ci0JCShjcnRj
X3N0YXRlLT5iYXNlLmdhbW1hX2x1dCB8fAotCQkgY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1
dCkgJiYKKwkJKGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCB8fAorCQkgY3J0Y19zdGF0ZS0+aHcu
ZGVnYW1tYV9sdXQpICYmCiAJCSFjcnRjX3N0YXRlLT5jOF9wbGFuZXM7CiAKIAljcnRjX3N0YXRl
LT5jc2NfZW5hYmxlID0KIAkJY3J0Y19zdGF0ZS0+b3V0cHV0X2Zvcm1hdCAhPSBJTlRFTF9PVVRQ
VVRfRk9STUFUX1JHQiB8fAotCQljcnRjX3N0YXRlLT5iYXNlLmN0bSB8fCBsaW1pdGVkX2NvbG9y
X3JhbmdlOworCQljcnRjX3N0YXRlLT5ody5jdG0gfHwgbGltaXRlZF9jb2xvcl9yYW5nZTsKIAog
CWNydGNfc3RhdGUtPmdhbW1hX21vZGUgPSBpdmJfZ2FtbWFfbW9kZShjcnRjX3N0YXRlKTsKIApA
QCAtMTMwMiwxNCArMTMwMiwxNCBAQCBzdGF0aWMgaW50IGdsa19jb2xvcl9jaGVjayhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJcmV0dXJuIHJldDsKIAogCWNydGNfc3Rh
dGUtPmdhbW1hX2VuYWJsZSA9Ci0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ICYmCisJCWNy
dGNfc3RhdGUtPmh3LmdhbW1hX2x1dCAmJgogCQkhY3J0Y19zdGF0ZS0+YzhfcGxhbmVzOwogCiAJ
LyogT24gR0xLKyBkZWdhbW1hIExVVCBpcyBjb250cm9sbGVkIGJ5IGNzY19lbmFibGUgKi8KIAlj
cnRjX3N0YXRlLT5jc2NfZW5hYmxlID0KLQkJY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dCB8
fAorCQljcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCB8fAogCQljcnRjX3N0YXRlLT5vdXRwdXRf
Zm9ybWF0ICE9IElOVEVMX09VVFBVVF9GT1JNQVRfUkdCIHx8Ci0JCWNydGNfc3RhdGUtPmJhc2Uu
Y3RtIHx8IGNydGNfc3RhdGUtPmxpbWl0ZWRfY29sb3JfcmFuZ2U7CisJCWNydGNfc3RhdGUtPmh3
LmN0bSB8fCBjcnRjX3N0YXRlLT5saW1pdGVkX2NvbG9yX3JhbmdlOwogCiAJY3J0Y19zdGF0ZS0+
Z2FtbWFfbW9kZSA9IGdsa19nYW1tYV9tb2RlKGNydGNfc3RhdGUpOwogCkBAIC0xMzI2LDE0ICsx
MzI2LDE0IEBAIHN0YXRpYyB1MzIgaWNsX2dhbW1hX21vZGUoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJdTMyIGdhbW1hX21vZGUgPSAwOwogCi0JaWYgKGNy
dGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFf
bHV0KQogCQlnYW1tYV9tb2RlIHw9IFBSRV9DU0NfR0FNTUFfRU5BQkxFOwogCi0JaWYgKGNydGNf
c3RhdGUtPmJhc2UuZ2FtbWFfbHV0ICYmCisJaWYgKGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCAm
JgogCSAgICAhY3J0Y19zdGF0ZS0+YzhfcGxhbmVzKQogCQlnYW1tYV9tb2RlIHw9IFBPU1RfQ1ND
X0dBTU1BX0VOQUJMRTsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgfHwKKwlp
ZiAoIWNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dCB8fAogCSAgICBjcnRjX3N0YXRlX2lzX2xlZ2Fj
eV9nYW1tYShjcnRjX3N0YXRlKSkKIAkJZ2FtbWFfbW9kZSB8PSBHQU1NQV9NT0RFX01PREVfOEJJ
VDsKIAllbHNlCkBAIC0xMzQ2LDcgKzEzNDYsNyBAQCBzdGF0aWMgdTMyIGljbF9jc2NfbW9kZShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAl1MzIgY3NjX21v
ZGUgPSAwOwogCi0JaWYgKGNydGNfc3RhdGUtPmJhc2UuY3RtKQorCWlmIChjcnRjX3N0YXRlLT5o
dy5jdG0pCiAJCWNzY19tb2RlIHw9IElDTF9DU0NfRU5BQkxFOwogCiAJaWYgKGNydGNfc3RhdGUt
Pm91dHB1dF9mb3JtYXQgIT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0IgfHwKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5jCmluZGV4IDNmY2YyZjg0YmNjZS4uZWY4MTQ0NTA5
M2Q2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0LmMKQEAgLTEzMiw5
ICsxMzIsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIHsKIAlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzIHw9IEJJVChJ
TlRFTF9PVVRQVVRfQU5BTE9HKTsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUu
ZmxhZ3MgfD0gaW50ZWxfY3J0X2dldF9mbGFncyhlbmNvZGVyKTsKKwlwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBpbnRlbF9jcnRfZ2V0X2ZsYWdzKGVuY29kZXIpOwogCi0J
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gcGlwZV9jb25maWct
PnBvcnRfY2xvY2s7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9
IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOwogfQogCiBzdGF0aWMgdm9pZCBoc3dfY3J0X2dldF9j
b25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCkBAIC0xNDQsMTMgKzE0NCwxMyBA
QCBzdGF0aWMgdm9pZCBoc3dfY3J0X2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAKIAlpbnRlbF9kZGlfZ2V0X2NvbmZpZyhlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CiAK
LQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICY9IH4oRFJNX01PREVfRkxB
R19QSFNZTkMgfAorCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzICY9IH4oRFJN
X01PREVfRkxBR19QSFNZTkMgfAogCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX05IU1lOQyB8CiAJ
CQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfUFZTWU5DIHwKIAkJCQkJICAgICAgRFJNX01PREVfRkxB
R19OVlNZTkMpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gaW50
ZWxfY3J0X2dldF9mbGFncyhlbmNvZGVyKTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9k
ZS5mbGFncyB8PSBpbnRlbF9jcnRfZ2V0X2ZsYWdzKGVuY29kZXIpOwogCi0JcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gbHB0X2dldF9pY2xraXAoZGV2X3ByaXYp
OworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBscHRfZ2V0X2lj
bGtpcChkZXZfcHJpdik7CiB9CiAKIC8qIE5vdGU6IFRoZSBjYWxsZXIgaXMgcmVxdWlyZWQgdG8g
ZmlsdGVyIG91dCBkcG1zIG1vZGVzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlCkBAIC0xNjEsOCArMTYx
LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0X3NldF9kcG1zKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnQgKmNydCA9IGludGVsX2Vu
Y29kZXJfdG9fY3J0KGVuY29kZXIpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjKTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBhZHBhOwogCiAJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gNSkKQEAgLTI3MSw3ICsyNzEsNyBAQCBzdGF0aWMgdm9pZCBoc3df
cHJlX2VuYWJsZV9jcnQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAg
Y29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJh
c2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCiAJV0FS
Tl9PTighY3J0Y19zdGF0ZS0+aGFzX3BjaF9lbmNvZGVyKTsKQEAgLTI4OCw3ICsyODgsNyBAQCBz
dGF0aWMgdm9pZCBoc3dfZW5hYmxlX2NydChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAkJCSAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsK
IAogCVdBUk5fT04oIWNydGNfc3RhdGUtPmhhc19wY2hfZW5jb2Rlcik7CkBAIC0zNTgsNyArMzU4
LDcgQEAgc3RhdGljIGludCBpbnRlbF9jcnRfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkJICAgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25u
X3N0YXRlKQogewogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJ
JnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZwaXBlX2NvbmZpZy0+aHcuYWRq
dXN0ZWRfbW9kZTsKIAogCWlmIChhZGp1c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdf
REJMU0NBTikKIAkJcmV0dXJuIC1FSU5WQUw7CkBAIC0zNzMsNyArMzczLDcgQEAgc3RhdGljIGlu
dCBwY2hfY3J0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CQkJCSAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKKwkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYg
KGFkanVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19EQkxTQ0FOKQogCQlyZXR1cm4g
LUVJTlZBTDsKQEAgLTM5MCw3ICszOTAsNyBAQCBzdGF0aWMgaW50IGhzd19jcnRfY29tcHV0ZV9j
b25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKKwkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYg
KGFkanVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19EQkxTQ0FOKQogCQlyZXR1cm4g
LUVJTlZBTDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDc5
MjVhMTc2ZjkwMC4uMjRhZjJjOGQwNTYxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGRpLmMKQEAgLTE0NzcsNyArMTQ3Nyw3IEBAIHN0YXRpYyB2b2lkIGRkaV9kb3RjbG9j
a19nZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCWlmIChwaXBlX2Nv
bmZpZy0+cGl4ZWxfbXVsdGlwbGllcikKIAkJZG90Y2xvY2sgLz0gcGlwZV9jb25maWctPnBpeGVs
X211bHRpcGxpZXI7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xv
Y2sgPSBkb3RjbG9jazsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2Nr
ID0gZG90Y2xvY2s7CiB9CiAKIHN0YXRpYyB2b2lkIGljbF9kZGlfY2xvY2tfZ2V0KHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMTY5MSw3ICsxNjkxLDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZGRpX2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogdm9p
ZCBpbnRlbF9kZGlfc2V0X3BpcGVfc2V0dGluZ3MoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSB0cmFuc2Nv
ZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAJdTMyIHRl
bXA7CkBAIC0xNzQ1LDcgKzE3NDUsNyBAQCB2b2lkIGludGVsX2RkaV9zZXRfcGlwZV9zZXR0aW5n
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHZvaWQgaW50ZWxf
ZGRpX3NldF92Y19wYXlsb2FkX2FsbG9jKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQkJCSAgICBib29sIHN0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFu
c2NvZGVyOwogCXUzMiB0ZW1wOwpAQCAtMTc2MCw3ICsxNzYwLDcgQEAgdm9pZCBpbnRlbF9kZGlf
c2V0X3ZjX3BheWxvYWRfYWxsb2MoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAKIHZvaWQgaW50ZWxfZGRpX2VuYWJsZV90cmFuc2NvZGVyX2Z1bmMoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJ
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSBpbnRlbF9kZGlfZ2V0X2NydGNfZW5jb2Rl
cihjcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CkBAIC0xNzg5LDkg
KzE3ODksOSBAQCB2b2lkIGludGVsX2RkaV9lbmFibGVfdHJhbnNjb2Rlcl9mdW5jKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlCVUcoKTsKIAl9CiAKLQlpZiAo
Y3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19QVlNZ
TkMpCisJaWYgKGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX1BWU1lOQykKIAkJdGVtcCB8PSBUUkFOU19ERElfUFZTWU5DOwotCWlmIChjcnRjX3N0YXRl
LT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX1BIU1lOQykKKwlpZiAo
Y3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfUEhTWU5D
KQogCQl0ZW1wIHw9IFRSQU5TX0RESV9QSFNZTkM7CiAKIAlpZiAoY3B1X3RyYW5zY29kZXIgPT0g
VFJBTlNDT0RFUl9FRFApIHsKQEAgLTE4NDQsNyArMTg0NCw3IEBAIHZvaWQgaW50ZWxfZGRpX2Vu
YWJsZV90cmFuc2NvZGVyX2Z1bmMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiAKIHZvaWQgaW50ZWxfZGRpX2Rpc2FibGVfdHJhbnNjb2Rlcl9mdW5jKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90
cmFuc2NvZGVyOwogCWk5MTVfcmVnX3QgcmVnID0gVFJBTlNfRERJX0ZVTkNfQ1RMKGNwdV90cmFu
c2NvZGVyKTsKQEAgLTIxMTYsNyArMjExNiw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9nZXRf
cG93ZXJfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogdm9pZCBpbnRl
bF9kZGlfZW5hYmxlX3BpcGVfY2xvY2soY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIgPSBpbnRlbF9kZGlfZ2V0X2NydGNfZW5jb2RlcihjcnRjKTsKIAllbnVtIHBv
cnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CkBAIC0yMTI5LDcgKzIxMjksNyBAQCB2b2lkIGludGVs
X2RkaV9lbmFibGVfcGlwZV9jbG9jayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIAogdm9pZCBpbnRlbF9kZGlfZGlzYWJsZV9waXBlX2Nsb2NrKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjLT5kZXYpOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3Rh
dGUtPmNwdV90cmFuc2NvZGVyOwogCiAJaWYgKGNwdV90cmFuc2NvZGVyICE9IFRSQU5TQ09ERVJf
RURQKQpAQCAtMzIxMiw3ICszMjEyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX3ByZV9lbmFi
bGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBp
cGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKQEAgLTM3MzUsNyArMzczNSw3IEBAIHZvaWQgaW50ZWxf
ZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgIHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0
Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVf
Y29uZmlnLT51YXBpLmNydGMpOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IHBp
cGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlcjsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpp
bnRlbF9kaWdfcG9ydDsKIAl1MzIgdGVtcCwgZmxhZ3MgPSAwOwpAQCAtMzc1NCw3ICszNzU0LDcg
QEAgdm9pZCBpbnRlbF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAllbHNlCiAJCWZsYWdzIHw9IERSTV9NT0RFX0ZMQUdfTlZTWU5DOwogCi0JcGlwZV9jb25m
aWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKKwlwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKIAogCXN3aXRjaCAodGVtcCAmIFRSQU5TX0RE
SV9CUENfTUFTSykgewogCWNhc2UgVFJBTlNfRERJX0JQQ182OgpAQCAtMzg4NCw3ICszODg0LDcg
QEAgc3RhdGljIGludCBpbnRlbF9kZGlfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZywKIAkJCQkgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0J
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNl
LmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2Nv
bmZpZy0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBv
cnQ7CiAJaW50IHJldDsKQEAgLTQwNDYsNyArNDA0Niw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfaGRt
aV9yZXNldF9saW5rKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJV0FSTl9PTigh
aW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfSERNSSkpOwogCi0J
aWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2
ZSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoIWNydGNfc3RhdGUtPmhkbWlfaGlnaF90bWRzX2Nsb2Nr
X3JhdGlvICYmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5j
CmluZGV4IDVjMWRiMWQzZDEyYi4uYmQyZTMwZDU4MWU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtNTE3LDcgKzUxNyw3IEBAIGljbF93YV9z
Y2FsZXJjbGtnYXRpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBp
cGUgcGlwZSwKIHN0YXRpYyBib29sCiBuZWVkc19tb2Rlc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpzdGF0ZSkKIHsKLQlyZXR1cm4gZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVz
ZXQoJnN0YXRlLT5iYXNlKTsKKwlyZXR1cm4gZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQo
JnN0YXRlLT51YXBpKTsKIH0KIAogLyoKQEAgLTYzMSw3ICs2MzEsNyBAQCBpOXh4X3NlbGVjdF9w
Ml9kaXYoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKIAkJICAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgIGludCB0YXJnZXQpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNl
LmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAlpZiAoaW50ZWxfY3J0Y19oYXNfdHlw
ZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfTFZEUykpIHsKIAkJLyoKQEAgLTY2Nyw3ICs2Njcs
NyBAQCBpOXh4X2ZpbmRfYmVzdF9kcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGltaXQs
CiAJCSAgICBpbnQgdGFyZ2V0LCBpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqbWF0Y2hfY2xvY2ss
CiAJCSAgICBzdHJ1Y3QgZHBsbCAqYmVzdF9jbG9jaykKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXY7CisJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2OwogCXN0cnVjdCBkcGxsIGNsb2NrOwogCWlu
dCBlcnIgPSB0YXJnZXQ7CiAKQEAgLTcyNSw3ICs3MjUsNyBAQCBwbnZfZmluZF9iZXN0X2RwbGwo
Y29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKIAkJICAgaW50IHRhcmdldCwgaW50IHJl
ZmNsaywgc3RydWN0IGRwbGwgKm1hdGNoX2Nsb2NrLAogCQkgICBzdHJ1Y3QgZHBsbCAqYmVzdF9j
bG9jaykKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
LT5kZXY7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+
ZGV2OwogCXN0cnVjdCBkcGxsIGNsb2NrOwogCWludCBlcnIgPSB0YXJnZXQ7CiAKQEAgLTc4MSw3
ICs3ODEsNyBAQCBnNHhfZmluZF9iZXN0X2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICps
aW1pdCwKIAkJICAgaW50IHRhcmdldCwgaW50IHJlZmNsaywgc3RydWN0IGRwbGwgKm1hdGNoX2Ns
b2NrLAogCQkgICBzdHJ1Y3QgZHBsbCAqYmVzdF9jbG9jaykKIHsKLQlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXY7CisJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2OwogCXN0cnVjdCBkcGxsIGNsb2NrOwog
CWludCBtYXhfbjsKIAlib29sIGZvdW5kID0gZmFsc2U7CkBAIC04NzUsNyArODc1LDcgQEAgdmx2
X2ZpbmRfYmVzdF9kcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9saW1pdCAqbGltaXQsCiAJCSAgIGlu
dCB0YXJnZXQsIGludCByZWZjbGssIHN0cnVjdCBkcGxsICptYXRjaF9jbG9jaywKIAkJICAgc3Ry
dWN0IGRwbGwgKmJlc3RfY2xvY2spCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwogCXN0cnVjdCBkcGxsIGNsb2NrOwogCXVuc2ln
bmVkIGludCBiZXN0cHBtID0gMTAwMDAwMDsKQEAgLTkzNSw3ICs5MzUsNyBAQCBjaHZfZmluZF9i
ZXN0X2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKIAkJICAgaW50IHRhcmdl
dCwgaW50IHJlZmNsaywgc3RydWN0IGRwbGwgKm1hdGNoX2Nsb2NrLAogCQkgICBzdHJ1Y3QgZHBs
bCAqYmVzdF9jbG9jaykKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CiAJdW5zaWduZWQgaW50IGJlc3RfZXJyb3JfcHBtOwogCXN0
cnVjdCBkcGxsIGNsb2NrOwpAQCAtMTAxNCw3ICsxMDE0LDcgQEAgYm9vbCBpbnRlbF9jcnRjX2Fj
dGl2ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAkgKiBmb3IgYXRvbWljLgogCSAqLwogCXJl
dHVybiBjcnRjLT5hY3RpdmUgJiYgY3J0Yy0+YmFzZS5wcmltYXJ5LT5zdGF0ZS0+ZmIgJiYKLQkJ
Y3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKwkJY3J0Yy0+Y29u
ZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CiB9CiAKIGVudW0gdHJhbnNjb2RlciBp
bnRlbF9waXBlX3RvX2NwdV90cmFuc2NvZGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKQEAgLTEwNjgsNyArMTA2OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3dhaXRfZm9yX3Bp
cGVfc2NhbmxpbmVfbW92aW5nKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogc3RhdGljIHZvaWQK
IGludGVsX3dhaXRfZm9yX3BpcGVfb2ZmKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpv
bGRfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMob2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkgewpAQCAtMTUzNCw3ICsxNTM0LDcgQEAgc3RhdGlj
IHZvaWQgaTl4eF9lbmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMg
dm9pZCBpOXh4X2Rpc2FibGVfcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIApAQCAtMTYyNiw3ICsxNjI2LDcgQEAgdm9pZCB2bHZfd2FpdF9wb3J0X3JlYWR5
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogc3RhdGljIHZvaWQgaXJvbmxh
a2VfZW5hYmxlX3BjaF90cmFuc2NvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0g
Y3J0Yy0+cGlwZTsKIAlpOTE1X3JlZ190IHJlZzsKQEAgLTE3NzgsNyArMTc3OCw3IEBAIGVudW0g
cGlwZSBpbnRlbF9jcnRjX3BjaF90cmFuc2NvZGVyKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQog
CiBzdGF0aWMgdTMyIGludGVsX2NydGNfbWF4X3ZibGFua19jb3VudChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0
Yy0+ZGV2KTsKIAogCS8qCiAJICogT24gaTk2NWdtIHRoZSBoYXJkd2FyZSBmcmFtZSBjb3VudGVy
IHJlYWRzCkBAIC0xNzk4LDcgKzE3OTgsNyBAQCBzdGF0aWMgdTMyIGludGVsX2NydGNfbWF4X3Zi
bGFua19jb3VudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZQogCiBz
dGF0aWMgdm9pZCBpbnRlbF9jcnRjX3ZibGFua19vbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAogCWRybV9jcnRjX3NldF9t
YXhfdmJsYW5rX2NvdW50KCZjcnRjLT5iYXNlLAogCQkJCSAgICAgIGludGVsX2NydGNfbWF4X3Zi
bGFua19jb3VudChjcnRjX3N0YXRlKSk7CkBAIC0xODA3LDcgKzE4MDcsNyBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9jcnRjX3ZibGFua19vbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIAogc3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX3BpcGUoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gbmV3X2NydGNfc3Rh
dGUtPmNwdV90cmFuc2NvZGVyOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKQEAgLTE4
NjUsNyArMTg2NSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9waXBlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIAogc3RhdGljIHZvaWQgaW50ZWxf
ZGlzYWJsZV9waXBlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gdHJhbnNjb2RlciBj
cHVfdHJhbnNjb2RlciA9IG9sZF9jcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKIAllbnVtIHBp
cGUgcGlwZSA9IGNydGMtPnBpcGU7CkBAIC0zMTI5LDE0ICszMTI5LDE0IEBAIGludGVsX3NldF9w
bGFuZV92aXNpYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXBsYW5l
X3N0YXRlLT5iYXNlLnZpc2libGUgPSB2aXNpYmxlOwogCiAJaWYgKHZpc2libGUpCi0JCWNydGNf
c3RhdGUtPmJhc2UucGxhbmVfbWFzayB8PSBkcm1fcGxhbmVfbWFzaygmcGxhbmUtPmJhc2UpOwor
CQljcnRjX3N0YXRlLT51YXBpLnBsYW5lX21hc2sgfD0gZHJtX3BsYW5lX21hc2soJnBsYW5lLT5i
YXNlKTsKIAllbHNlCi0JCWNydGNfc3RhdGUtPmJhc2UucGxhbmVfbWFzayAmPSB+ZHJtX3BsYW5l
X21hc2soJnBsYW5lLT5iYXNlKTsKKwkJY3J0Y19zdGF0ZS0+dWFwaS5wbGFuZV9tYXNrICY9IH5k
cm1fcGxhbmVfbWFzaygmcGxhbmUtPmJhc2UpOwogfQogCiBzdGF0aWMgdm9pZCBmaXh1cF9hY3Rp
dmVfcGxhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lOwog
CiAJLyoKQEAgLTMxNDcsNyArMzE0Nyw3IEBAIHN0YXRpYyB2b2lkIGZpeHVwX2FjdGl2ZV9wbGFu
ZXMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJY3J0Y19zdGF0ZS0+YWN0
aXZlX3BsYW5lcyA9IDA7CiAKIAlkcm1fZm9yX2VhY2hfcGxhbmVfbWFzayhwbGFuZSwgJmRldl9w
cml2LT5kcm0sCi0JCQkJY3J0Y19zdGF0ZS0+YmFzZS5wbGFuZV9tYXNrKQorCQkJCWNydGNfc3Rh
dGUtPnVhcGkucGxhbmVfbWFzaykKIAkJY3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lcyB8PSBCSVQo
dG9faW50ZWxfcGxhbmUocGxhbmUpLT5pZCk7CiB9CiAKQEAgLTM1ODksNyArMzU4OSw3IEBAIGk5
eHhfcGxhbmVfbWF4X3N0cmlkZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCiBzdGF0aWMg
dTMyIGk5eHhfcGxhbmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyIGRzcGNudHIgPSAwOwog
CkBAIC0zNzI2LDcgKzM3MjYsNyBAQCBpOXh4X3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQlyZXR1cm4gcmV0OwogCiAJcmV0ID0gZHJtX2F0b21pY19o
ZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLAotCQkJCQkJICAmY3J0
Y19zdGF0ZS0+YmFzZSwKKwkJCQkJCSAgJmNydGNfc3RhdGUtPnVhcGksCiAJCQkJCQkgIERSTV9Q
TEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJCSAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FM
SU5HLAogCQkJCQkJICBmYWxzZSwgdHJ1ZSk7CkBAIC0zODk3LDcgKzM4OTcsNyBAQCBzdGF0aWMg
dm9pZCBza2xfZGV0YWNoX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywgaW50
IGlkKQogICovCiBzdGF0aWMgdm9pZCBza2xfZGV0YWNoX3NjYWxlcnMoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVs
X2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGlu
dGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUg
PQogCQkmY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlOwogCWludCBpOwpAQCAtNDA5Miw3ICs0MDky
LDcgQEAgc3RhdGljIHUzMiBjbmxfcGxhbmVfY3RsX2ZsaXAodW5zaWduZWQgaW50IHJlZmxlY3Qp
CiAKIHUzMiBza2xfcGxhbmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJdTMy
IHBsYW5lX2N0bCA9IDA7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19H
RU1JTklMQUtFKGRldl9wcml2KSkKQEAgLTQxNDgsNyArNDE0OCw3IEBAIHUzMiBza2xfcGxhbmVf
Y3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiB1MzIgZ2xr
X3BsYW5lX2NvbG9yX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCXUzMiBwbGFu
ZV9jb2xvcl9jdGwgPSAwOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCkBAIC00
MzY5LDExICs0MzY5LDExIEBAIHN0YXRpYyB2b2lkIGljbF9zZXRfcGlwZV9jaGlja2VuKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjKQogc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX3BpcGVfY29uZmln
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCQkgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRj
X3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJLyogZHJtX2F0b21pY19oZWxwZXJfdXBkYXRl
X2xlZ2FjeV9tb2Rlc2V0X3N0YXRlIG1pZ2h0IG5vdCBiZSBjYWxsZWQuICovCi0JY3J0Yy0+YmFz
ZS5tb2RlID0gbmV3X2NydGNfc3RhdGUtPmJhc2UubW9kZTsKKwljcnRjLT5iYXNlLm1vZGUgPSBu
ZXdfY3J0Y19zdGF0ZS0+dWFwaS5tb2RlOwogCiAJLyoKIAkgKiBVcGRhdGUgcGlwZSBzaXplIGFu
ZCBhZGp1c3QgZml0dGVyIGlmIG5lZWRlZDogdGhlIHJlYXNvbiBmb3IgdGhpcyBpcwpAQCAtNDgw
Miw3ICs0ODAyLDcgQEAgc3RhdGljIHZvaWQgaXZiX21hbnVhbF9mZGlfbGlua190cmFpbihzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogc3RhdGljIHZvaWQgaXJvbmxha2VfZmRpX3BsbF9lbmFi
bGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7CiAJaW50IHBpcGUgPSBpbnRlbF9jcnRj
LT5waXBlOwogCWk5MTVfcmVnX3QgcmVnOwpAQCAtNDk2Myw5ICs0OTYzLDkgQEAgdm9pZCBscHRf
ZGlzYWJsZV9pY2xraXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogLyogUHJv
Z3JhbSBpQ0xLSVAgY2xvY2sgdG8gdGhlIGRlc2lyZWQgZnJlcXVlbmN5ICovCiBzdGF0aWMgdm9p
ZCBscHRfcHJvZ3JhbV9pY2xraXAoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JaW50IGNsb2NrID0gY3J0Y19zdGF0
ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJaW50IGNsb2NrID0gY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCXUzMiBkaXZzZWwsIHBoYXNlaW5jLCBh
dXhkaXYsIHBoYXNlZGlyID0gMDsKIAl1MzIgdGVtcDsKIApAQCAtNTA3OSw3ICs1MDc5LDcgQEAg
aW50IGxwdF9nZXRfaWNsa2lwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHN0
YXRpYyB2b2lkIGlyb25sYWtlX3BjaF90cmFuc2NvZGVyX3NldF90aW1pbmdzKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCQkJZW51bSBwaXBlIHBjaF90cmFu
c2NvZGVyKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gdHJhbnNjb2RlciBjcHVf
dHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCkBAIC01MTIyLDcgKzUx
MjIsNyBAQCBzdGF0aWMgdm9pZCBjcHRfc2V0X2ZkaV9iY19iaWZ1cmNhdGlvbihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgZQogCiBzdGF0aWMgdm9pZCBpdnlicmlkZ2Vf
dXBkYXRlX2ZkaV9iY19iaWZ1cmNhdGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAogCXN3aXRjaCAoY3J0Yy0+
cGlwZSkgewpAQCAtNTE1Miw3ICs1MTUyLDcgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICoKIGludGVsX2dldF9jcnRjX25ld19lbmNvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlLAogCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKmNvbm5lY3Rvcl9zdGF0ZTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29u
bmVjdG9yOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0gTlVMTDsKQEAgLTUxODQs
NyArNTE4NCw3IEBAIGludGVsX2dldF9jcnRjX25ld19lbmNvZGVyKGNvbnN0IHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKnN0YXRlLAogc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX2VuYWJsZShj
b25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCWludCBwaXBlID0gY3J0Yy0+cGlwZTsK
QEAgLTUyMzgsNyArNTIzOCw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3BjaF9lbmFibGUoY29u
c3Qgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJaWYgKEhBU19QQ0hfQ1BUKGRl
dl9wcml2KSAmJgogCSAgICBpbnRlbF9jcnRjX2hhc19kcF9lbmNvZGVyKGNydGNfc3RhdGUpKSB7
CiAJCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJCSZj
cnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZTsKIAkJdTMyIGJwYyA9IChJOTE1X1JFQUQoUElQRUNPTkYocGlwZSkpICYgUElQRUNP
TkZfQlBDX01BU0spID4+IDU7CiAJCWk5MTVfcmVnX3QgcmVnID0gVFJBTlNfRFBfQ1RMKHBpcGUp
OwogCQllbnVtIHBvcnQgcG9ydDsKQEAgLTUyNjgsNyArNTI2OCw3IEBAIHN0YXRpYyB2b2lkIGly
b25sYWtlX3BjaF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUs
CiBzdGF0aWMgdm9pZCBscHRfcGNoX2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJh
bnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCkBAIC01Mzg1LDEwICs1Mzg1
LDEwIEBAIHNrbF91cGRhdGVfc2NhbGVyKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLCBib29sIGZvcmNlX2RldGFjaCwKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zY2FsZXJfc3RhdGUg
KnNjYWxlcl9zdGF0ZSA9CiAJCSZjcnRjX3N0YXRlLT5zY2FsZXJfc3RhdGU7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmludGVsX2NydGMgPQotCQl0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CisJCXRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2NydGMtPmJhc2UuZGV2
KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZj
cnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3Rl
ZF9tb2RlOwogCiAJLyoKIAkgKiBTcmMgY29vcmRpbmF0ZXMgYXJlIGFscmVhZHkgcm90YXRlZCBi
eSAyNzAgZGVncmVlcyBmb3IKQEAgLTU0MDQsNyArNTQwNCw3IEBAIHNrbF91cGRhdGVfc2NhbGVy
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLCBib29sIGZvcmNlX2RldGFjaCwK
IAkgKiBPbmNlIE5WMTIgaXMgZW5hYmxlZCwgaGFuZGxlIGl0IGhlcmUgd2hpbGUgYWxsb2NhdGlu
ZyBzY2FsZXIKIAkgKiBmb3IgTlYxMi4KIAkgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA5ICYmIGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlICYmCisJaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gOSAmJiBjcnRjX3N0YXRlLT5ody5lbmFibGUgJiYKIAkgICAgbmVlZF9zY2FsZXIgJiYg
YWRqdXN0ZWRfbW9kZS0+ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkgewogCQlEUk1f
REVCVUdfS01TKCJQaXBlL1BsYW5lIHNjYWxpbmcgbm90IHN1cHBvcnRlZCB3aXRoIElGLUlEIG1v
ZGVcbiIpOwogCQlyZXR1cm4gLUVJTlZBTDsKQEAgLTU0NzYsMTMgKzU0NzYsMTMgQEAgc2tsX3Vw
ZGF0ZV9zY2FsZXIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsIGJvb2wgZm9y
Y2VfZGV0YWNoLAogICovCiBpbnQgc2tsX3VwZGF0ZV9zY2FsZXJfY3J0YyhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFk
anVzdGVkX21vZGUgPSAmc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZzdGF0ZS0+aHcuYWRqdXN0ZWRfbW9k
ZTsKIAlib29sIG5lZWRfc2NhbGVyID0gZmFsc2U7CiAKIAlpZiAoc3RhdGUtPm91dHB1dF9mb3Jt
YXQgPT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9ZQ0JDUjQyMCkKIAkJbmVlZF9zY2FsZXIgPSB0cnVl
OwogCi0JcmV0dXJuIHNrbF91cGRhdGVfc2NhbGVyKHN0YXRlLCAhc3RhdGUtPmJhc2UuYWN0aXZl
LCBTS0xfQ1JUQ19JTkRFWCwKKwlyZXR1cm4gc2tsX3VwZGF0ZV9zY2FsZXIoc3RhdGUsICFzdGF0
ZS0+aHcuYWN0aXZlLCBTS0xfQ1JUQ19JTkRFWCwKIAkJCQkgJnN0YXRlLT5zY2FsZXJfc3RhdGUu
c2NhbGVyX2lkLAogCQkJCSBzdGF0ZS0+cGlwZV9zcmNfdywgc3RhdGUtPnBpcGVfc3JjX2gsCiAJ
CQkJIGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXksCkBAIC01NTgyLDcgKzU1ODIsNyBAQCBz
dGF0aWMgdm9pZCBza3lsYWtlX3NjYWxlcl9kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
KQogCiBzdGF0aWMgdm9pZCBza3lsYWtlX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0g
cGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zY2FsZXJf
c3RhdGUgKnNjYWxlcl9zdGF0ZSA9CkBAIC01NjE5LDcgKzU2MTksNyBAQCBzdGF0aWMgdm9pZCBz
a3lsYWtlX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9wZml0X2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlp
bnQgcGlwZSA9IGNydGMtPnBpcGU7CiAKQEAgLTU2NDAsNyArNTY0MCw3IEBAIHN0YXRpYyB2b2lk
IGlyb25sYWtlX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCiB2b2lkIGhzd19lbmFibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGRldik7CiAKQEAgLTU2NzgsNyArNTY3OCw3IEBAIHZvaWQgaHN3X2VuYWJs
ZV9pcHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHZvaWQg
aHN3X2Rpc2FibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5i
YXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7CiAKQEAgLTU3OTAsNyArNTc5MCw3IEBAIGludGVsX3ByZV9kaXNhYmxlX3ByaW1hcnlfbm9h
dG9taWMoc3RydWN0IGRybV9jcnRjICpjcnRjKQogc3RhdGljIGJvb2wgaHN3X3ByZV91cGRhdGVf
ZGlzYWJsZV9pcHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRl
LAogCQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3Rh
dGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRj
X3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAogCWlmICghb2xkX2NydGNf
c3RhdGUtPmlwc19lbmFibGVkKQpAQCAtNTgwNiw3ICs1ODA2LDcgQEAgc3RhdGljIGJvb2wgaHN3
X3ByZV91cGRhdGVfZGlzYWJsZV9pcHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9s
ZF9jcnRjX3MKIAkgKiBEaXNhYmxlIElQUyBiZWZvcmUgd2UgcHJvZ3JhbSB0aGUgTFVULgogCSAq
LwogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSAmJgotCSAgICAobmV3X2NydGNfc3RhdGUtPmJh
c2UuY29sb3JfbWdtdF9jaGFuZ2VkIHx8CisJICAgIChuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jb2xv
cl9tZ210X2NoYW5nZWQgfHwKIAkgICAgIG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSkgJiYK
IAkgICAgbmV3X2NydGNfc3RhdGUtPmdhbW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFX1NQTElU
KQogCQlyZXR1cm4gdHJ1ZTsKQEAgLTU4MTcsNyArNTgxNyw3IEBAIHN0YXRpYyBib29sIGhzd19w
cmVfdXBkYXRlX2Rpc2FibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRf
Y3J0Y19zCiBzdGF0aWMgYm9vbCBoc3dfcG9zdF91cGRhdGVfZW5hYmxlX2lwcyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJICAgICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT51
YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Yy0+YmFzZS5kZXYpOwogCiAJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aXBzX2VuYWJsZWQpCkBA
IC01ODMzLDcgKzU4MzMsNyBAQCBzdGF0aWMgYm9vbCBoc3dfcG9zdF91cGRhdGVfZW5hYmxlX2lw
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfcwogCSAqIFJlLWVuYWJs
ZSBJUFMgYWZ0ZXIgdGhlIExVVCBoYXMgYmVlbiBwcm9ncmFtbWVkLgogCSAqLwogCWlmIChJU19I
QVNXRUxMKGRldl9wcml2KSAmJgotCSAgICAobmV3X2NydGNfc3RhdGUtPmJhc2UuY29sb3JfbWdt
dF9jaGFuZ2VkIHx8CisJICAgIChuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jb2xvcl9tZ210X2NoYW5n
ZWQgfHwKIAkgICAgIG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSkgJiYKIAkgICAgbmV3X2Ny
dGNfc3RhdGUtPmdhbW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFX1NQTElUKQogCQlyZXR1cm4g
dHJ1ZTsKQEAgLTU4NDMsNyArNTg0Myw3IEBAIHN0YXRpYyBib29sIGhzd19wb3N0X3VwZGF0ZV9l
bmFibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zCiAJICog
Zm9yY2libHkgZW5hYmxlIElQUyBvbiB0aGUgZmlyc3QgZmFzdHNldC4KIAkgKi8KIAlpZiAobmV3
X2NydGNfc3RhdGUtPnVwZGF0ZV9waXBlICYmCi0JICAgIG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFk
anVzdGVkX21vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkKKwkg
ICAgb2xkX2NydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVf
TU9ERV9GTEFHX0lOSEVSSVRFRCkKIAkJcmV0dXJuIHRydWU7CiAKIAlyZXR1cm4gIW9sZF9jcnRj
X3N0YXRlLT5pcHNfZW5hYmxlZDsKQEAgLTU4NzQsMTAgKzU4NzQsMTAgQEAgc3RhdGljIGJvb2wg
bmVlZHNfc2NhbGVyY2xrX3dhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAog
c3RhdGljIHZvaWQgaW50ZWxfcG9zdF9wbGFuZV91cGRhdGUoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm9sZF9jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
b2xkX3N0YXRlID0gb2xkX2NydGNfc3RhdGUtPmJhc2Uuc3RhdGU7CisJc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUgKm9sZF9zdGF0ZSA9IG9sZF9jcnRjX3N0YXRlLT51YXBpLnN0YXRlOwogCXN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZyA9CiAJCWludGVsX2F0b21pY19nZXRfbmV3
X2NydGNfc3RhdGUodG9faW50ZWxfYXRvbWljX3N0YXRlKG9sZF9zdGF0ZSksCiAJCQkJCQljcnRj
KTsKQEAgLTU4ODcsNyArNTg4Nyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bvc3RfcGxhbmVfdXBk
YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIAogCWludGVsX2Zy
b250YnVmZmVyX2ZsaXAodG9faTkxNShjcnRjLT5iYXNlLmRldiksIHBpcGVfY29uZmlnLT5mYl9i
aXRzKTsKIAotCWlmIChwaXBlX2NvbmZpZy0+dXBkYXRlX3dtX3Bvc3QgJiYgcGlwZV9jb25maWct
PmJhc2UuYWN0aXZlKQorCWlmIChwaXBlX2NvbmZpZy0+dXBkYXRlX3dtX3Bvc3QgJiYgcGlwZV9j
b25maWctPmh3LmFjdGl2ZSkKIAkJaW50ZWxfdXBkYXRlX3dhdGVybWFya3MoY3J0Yyk7CiAKIAlp
ZiAoaHN3X3Bvc3RfdXBkYXRlX2VuYWJsZV9pcHMob2xkX2NydGNfc3RhdGUsIHBpcGVfY29uZmln
KSkKQEAgLTU5MTcsMTAgKzU5MTcsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9zdF9wbGFuZV91
cGRhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogc3RhdGljIHZv
aWQgaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQog
ewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0
ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
b2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNy
dGMtPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZGV2KTsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlID0gb2xkX2NydGNf
c3RhdGUtPmJhc2Uuc3RhdGU7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSA9
IG9sZF9jcnRjX3N0YXRlLT51YXBpLnN0YXRlOwogCXN0cnVjdCBkcm1fcGxhbmUgKnByaW1hcnkg
PSBjcnRjLT5iYXNlLnByaW1hcnk7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3ByaW1h
cnlfc3RhdGUgPQogCQlkcm1fYXRvbWljX2dldF9vbGRfcGxhbmVfc3RhdGUob2xkX3N0YXRlLCBw
cmltYXJ5KTsKQEAgLTU5NjUsNyArNTk2NSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByZV9wbGFu
ZV91cGRhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCSAqIGV2
ZW50IHdoaWNoIGlzIGFmdGVyIHRoZSB2Ymxhbmsgc3RhcnQgZXZlbnQsIHNvIHdlIG5lZWQgdG8g
aGF2ZSBhCiAJICogd2FpdC1mb3ItdmJsYW5rIGJldHdlZW4gZGlzYWJsaW5nIHRoZSBwbGFuZSBh
bmQgdGhlIHBpcGUuCiAJICovCi0JaWYgKEhBU19HTUNIKGRldl9wcml2KSAmJiBvbGRfY3J0Y19z
dGF0ZS0+YmFzZS5hY3RpdmUgJiYKKwlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmIG9sZF9jcnRj
X3N0YXRlLT5ody5hY3RpdmUgJiYKIAkgICAgcGlwZV9jb25maWctPmRpc2FibGVfY3hzciAmJiBp
bnRlbF9zZXRfbWVtb3J5X2N4c3IoZGV2X3ByaXYsIGZhbHNlKSkKIAkJaW50ZWxfd2FpdF9mb3Jf
dmJsYW5rKGRldl9wcml2LCBjcnRjLT5waXBlKTsKIApAQCAtNTk3Nyw3ICs1OTc3LDcgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
b2xkX2NydGNfc3RhdGUsCiAJICogV2FDeFNSRGlzYWJsZWRGb3JTcHJpdGVTY2FsaW5nOml2Ygog
CSAqLwogCWlmIChwaXBlX2NvbmZpZy0+ZGlzYWJsZV9scF93bSAmJiBpbGtfZGlzYWJsZV9scF93
bShkZXYpICYmCi0JICAgIG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkgICAgb2xkX2Ny
dGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LCBj
cnRjLT5waXBlKTsKIAogCS8qCkBAIC02MTgwLDcgKzYxODAsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9lbmNvZGVyc191cGRhdGVfcGlwZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogc3RhdGlj
IHZvaWQgaW50ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShjcnRjLT5iYXNlLnByaW1hcnkpOwogCiAJcGxh
bmUtPmRpc2FibGVfcGxhbmUocGxhbmUsIGNydGNfc3RhdGUpOwpAQCAtNjE4OSw3ICs2MTg5LDcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXQKIHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZW5h
YmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCQkgc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogewotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9
IHBpcGVfY29uZmlnLT5iYXNlLmNydGM7CisJc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlwZV9j
b25maWctPnVhcGkuY3J0YzsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2Owog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7CkBAIC02MzE3
LDcgKzYzMTcsNyBAQCBzdGF0aWMgdm9pZCBpY2xfcGlwZV9tYnVzX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YykKIHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCXN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKm9sZF9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+
YmFzZS5jcnRjOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmlnLT51YXBpLmNy
dGM7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5k
ZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
KTsKIAlpbnQgcGlwZSA9IGludGVsX2NydGMtPnBpcGUsIGhzd193b3JrYXJvdW5kX3BpcGU7CkBA
IC02NDI2LDcgKzY0MjYsNyBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAogc3RhdGljIHZvaWQgaXJvbmxha2Vf
cGZpdF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0g
Y3J0Yy0+cGlwZTsKIApAQCAtNjQ0Miw3ICs2NDQyLDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2Vf
cGZpdF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
ZSkKIHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpv
bGRfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjID0gb2xkX2NydGNfc3RhdGUtPmJh
c2UuY3J0YzsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0Y19zdGF0ZS0+dWFwaS5j
cnRjOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRj
ICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKQEAgLTY1MDEsNyArNjUwMSw3IEBA
IHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqb2xkX2NydGNfc3RhdGUsCiBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZGlzYWJsZShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJIHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRf
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IG9sZF9jcnRj
X3N0YXRlLT51YXBpLmNydGM7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjKTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBvbGRf
Y3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CkBAIC02NTM1LDcgKzY1MzUsNyBAQCBzdGF0aWMg
dm9pZCBoYXN3ZWxsX2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfc3RhdGUsCiAKIHN0YXRpYyB2b2lkIGk5eHhfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAK
IAlpZiAoIWNydGNfc3RhdGUtPmdtY2hfcGZpdC5jb250cm9sKQpAQCAtNjYzOSw3ICs2NjM5LDcg
QEAgc3RhdGljIHU2NCBnZXRfY3J0Y19wb3dlcl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAogCXU2NCBtYXNrOwogCWVudW0gdHJhbnNjb2RlciB0cmFuc2NvZGVyID0gY3J0Y19zdGF0
ZS0+Y3B1X3RyYW5zY29kZXI7CiAKLQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCWlm
ICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1cm4gMDsKIAogCW1hc2sgPSBCSVRfVUxM
KFBPV0VSX0RPTUFJTl9QSVBFKHBpcGUpKTsKQEAgLTY2NDgsNyArNjY0OCw3IEBAIHN0YXRpYyB1
NjQgZ2V0X2NydGNfcG93ZXJfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkgICAg
Y3J0Y19zdGF0ZS0+cGNoX3BmaXQuZm9yY2VfdGhydSkKIAkJbWFzayB8PSBCSVRfVUxMKFBPV0VS
X0RPTUFJTl9QSVBFX1BBTkVMX0ZJVFRFUihwaXBlKSk7CiAKLQlkcm1fZm9yX2VhY2hfZW5jb2Rl
cl9tYXNrKGVuY29kZXIsIGRldiwgY3J0Y19zdGF0ZS0+YmFzZS5lbmNvZGVyX21hc2spIHsKKwlk
cm1fZm9yX2VhY2hfZW5jb2Rlcl9tYXNrKGVuY29kZXIsIGRldiwgY3J0Y19zdGF0ZS0+dWFwaS5l
bmNvZGVyX21hc2spIHsKIAkJc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIgPSB0
b19pbnRlbF9lbmNvZGVyKGVuY29kZXIpOwogCiAJCW1hc2sgfD0gQklUX1VMTChpbnRlbF9lbmNv
ZGVyLT5wb3dlcl9kb21haW4pOwpAQCAtNjY5NSw3ICs2Njk1LDcgQEAgc3RhdGljIHZvaWQgbW9k
ZXNldF9wdXRfcG93ZXJfZG9tYWlucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiBzdGF0aWMgdm9pZCB2YWxsZXl2aWV3X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpwaXBlX2NvbmZpZywKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpvbGRf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlwZV9jb25maWctPmJhc2UuY3J0
YzsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+dWFwaS5jcnRjOwogCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKQEAgLTY3NTEsNyArNjc1MSw3IEBAIHN0YXRpYyB2
b2lkIHZhbGxleXZpZXdfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnLAogCiBzdGF0aWMgdm9pZCBpOXh4X3NldF9wbGxfZGl2aWRlcnMoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CiAKIAlJOTE1X1dSSVRFKEZQMChjcnRjLT5waXBlKSwgY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0
ZS5mcDApOwpAQCAtNjc2MSw3ICs2NzYxLDcgQEAgc3RhdGljIHZvaWQgaTl4eF9zZXRfcGxsX2Rp
dmlkZXJzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGlj
IHZvaWQgaTl4eF9jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25m
aWcsCiAJCQkgICAgIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKLQlz
dHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+YmFzZS5jcnRjOworCXN0cnVjdCBk
cm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmlnLT51YXBpLmNydGM7CiAJc3RydWN0IGRybV9kZXZp
Y2UgKmRldiA9IGNydGMtPmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRl
bF9jcnRjKGNydGMpOwpAQCAtNjgxMSw3ICs2ODExLDcgQEAgc3RhdGljIHZvaWQgaTl4eF9jcnRj
X2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAKIHN0YXRpYyB2
b2lkIGk5eHhfcGZpdF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRf
Y3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
b2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJaWYgKCFv
bGRfY3J0Y19zdGF0ZS0+Z21jaF9wZml0LmNvbnRyb2wpCkBAIC02ODI3LDcgKzY4MjcsNyBAQCBz
dGF0aWMgdm9pZCBpOXh4X3BmaXRfZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqb2xkX2NydGNfc3RhdGUpCiBzdGF0aWMgdm9pZCBpOXh4X2NydGNfZGlzYWJsZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjID0gb2xk
X2NydGNfc3RhdGUtPmJhc2UuY3J0YzsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKQEAgLTY5
OTUsOCArNjk5NSw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2Nvbm5lY3Rvcl92ZXJpZnlfc3RhdGUo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCWlmICghY3J0Y19zdGF0ZSkK
IAkJCXJldHVybjsKIAotCQlJOTE1X1NUQVRFX1dBUk4oIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZl
LAotCQkgICAgICAiY29ubmVjdG9yIGlzIGFjdGl2ZSwgYnV0IGF0dGFjaGVkIGNydGMgaXNuJ3Rc
biIpOworCQlJOTE1X1NUQVRFX1dBUk4oIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSwKKwkJCQkiY29u
bmVjdG9yIGlzIGFjdGl2ZSwgYnV0IGF0dGFjaGVkIGNydGMgaXNuJ3RcbiIpOwogCiAJCWlmICgh
ZW5jb2RlciB8fCBlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9EUF9NU1QpCiAJCQlyZXR1
cm47CkBAIC03MDA3LDggKzcwMDcsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jb25uZWN0b3JfdmVy
aWZ5X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlJOTE1X1NU
QVRFX1dBUk4oY29ubl9zdGF0ZS0+Y3J0YyAhPSBlbmNvZGVyLT5iYXNlLmNydGMsCiAJCQkiYXR0
YWNoZWQgZW5jb2RlciBjcnRjIGRpZmZlcnMgZnJvbSBjb25uZWN0b3IgY3J0Y1xuIik7CiAJfSBl
bHNlIHsKLQkJSTkxNV9TVEFURV9XQVJOKGNydGNfc3RhdGUgJiYgY3J0Y19zdGF0ZS0+YmFzZS5h
Y3RpdmUsCi0JCQkiYXR0YWNoZWQgY3J0YyBpcyBhY3RpdmUsIGJ1dCBjb25uZWN0b3IgaXNuJ3Rc
biIpOworCQlJOTE1X1NUQVRFX1dBUk4oY3J0Y19zdGF0ZSAmJiBjcnRjX3N0YXRlLT5ody5hY3Rp
dmUsCisJCQkJImF0dGFjaGVkIGNydGMgaXMgYWN0aXZlLCBidXQgY29ubmVjdG9yIGlzbid0XG4i
KTsKIAkJSTkxNV9TVEFURV9XQVJOKCFjcnRjX3N0YXRlICYmIGNvbm5fc3RhdGUtPmJlc3RfZW5j
b2RlciwKIAkJCSJiZXN0IGVuY29kZXIgc2V0IHdpdGhvdXQgY3J0YyFcbiIpOwogCX0KQEAgLTcw
MTYsNyArNzAxNiw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Nvbm5lY3Rvcl92ZXJpZnlfc3RhdGUo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIHN0YXRpYyBpbnQgcGlwZV9y
ZXF1aXJlZF9mZGlfbGFuZXMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0JaWYgKGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlICYmIGNydGNfc3RhdGUtPmhhc19wY2hfZW5j
b2RlcikKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZW5hYmxlICYmIGNydGNfc3RhdGUtPmhhc19wY2hf
ZW5jb2RlcikKIAkJcmV0dXJuIGNydGNfc3RhdGUtPmZkaV9sYW5lczsKIAogCXJldHVybiAwOwpA
QCAtNzAyNiw3ICs3MDI2LDcgQEAgc3RhdGljIGludCBpcm9ubGFrZV9jaGVja19mZGlfbGFuZXMo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgZW51bSBwaXBlIHBpcGUsCiAJCQkJICAgICBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpz
dGF0ZSA9IHBpcGVfY29uZmlnLT5iYXNlLnN0YXRlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSA9IHBpcGVfY29uZmlnLT51YXBpLnN0YXRlOwogCXN0cnVjdCBpbnRlbF9jcnRjICpv
dGhlcl9jcnRjOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvdGhlcl9jcnRjX3N0YXRlOwog
CkBAIC03MDk5LDcgKzcwOTksNyBAQCBzdGF0aWMgaW50IGlyb25sYWtlX2ZkaV9jb21wdXRlX2Nv
bmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAkJCQkgICAgICAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0
IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5o
dy5hZGp1c3RlZF9tb2RlOwogCWludCBsYW5lLCBsaW5rX2J3LCBmZGlfZG90Y2xvY2ssIHJldDsK
IAlib29sIG5lZWRzX3JlY29tcHV0ZSA9IGZhbHNlOwogCkBAIC03MTQ1LDcgKzcxNDUsNyBAQCBz
dGF0aWMgaW50IGlyb25sYWtlX2ZkaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YywKIAogYm9vbCBoc3dfY3J0Y19zdGF0ZV9pcHNfY2FwYWJsZShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAogCS8qIElQUyBvbmx5IGV4aXN0cyBvbiBVTFQgbWFjaGluZXMgYW5kIGlzIHRpZWQgdG8g
cGlwZSBBLiAqLwpAQCAtNzE3NSw5ICs3MTc1LDkgQEAgYm9vbCBoc3dfY3J0Y19zdGF0ZV9pcHNf
Y2FwYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRp
YyBib29sIGhzd19jb21wdXRlX2lwc19jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9f
aTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJCXRvX2k5MTUoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRl
ID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCQl0
b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CiAKIAlpZiAoIWhz
d19jcnRjX3N0YXRlX2lwc19jYXBhYmxlKGNydGNfc3RhdGUpKQogCQlyZXR1cm4gZmFsc2U7CkBA
IC03MjE2LDcgKzcyMTYsNyBAQCBzdGF0aWMgdTMyIGlsa19waXBlX3BpeGVsX3JhdGUoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewogCXUzMiBwaXhlbF9yYXRl
OwogCi0JcGl4ZWxfcmF0ZSA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19j
bG9jazsKKwlwaXhlbF9yYXRlID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19j
bG9jazsKIAogCS8qCiAJICogV2Ugb25seSB1c2UgSUYtSUQgaW50ZXJsYWNpbmcuIElmIHdlIGV2
ZXIgdXNlCkBAIC03MjQ5LDEyICs3MjQ5LDEyIEBAIHN0YXRpYyB1MzIgaWxrX3BpcGVfcGl4ZWxf
cmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAKIHN0YXRp
YyB2b2lkIGludGVsX2NydGNfY29tcHV0ZV9waXhlbF9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwog
CiAJaWYgKEhBU19HTUNIKGRldl9wcml2KSkKIAkJLyogRklYTUUgY2FsY3VsYXRlIHByb3BlciBw
aXBlIHBpeGVsIHJhdGUgZm9yIEdNQ0ggcGZpdCAqLwogCQljcnRjX3N0YXRlLT5waXhlbF9yYXRl
ID0KLQkJCWNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCQkJY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCWVsc2UKIAkJY3J0Y19zdGF0
ZS0+cGl4ZWxfcmF0ZSA9CiAJCQlpbGtfcGlwZV9waXhlbF9yYXRlKGNydGNfc3RhdGUpOwpAQCAt
NzI2NCw3ICs3MjY0LDcgQEAgc3RhdGljIGludCBpbnRlbF9jcnRjX2NvbXB1dGVfY29uZmlnKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qg
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGU7CiAJaW50IGNsb2NrX2xpbWl0ID0gZGV2X3ByaXYtPm1heF9kb3RjbGtf
ZnJlcTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCkgewpAQCAtNzI5MCw3ICs3Mjkw
LDcgQEAgc3RhdGljIGludCBpbnRlbF9jcnRjX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCiAJaWYgKChwaXBlX2NvbmZpZy0+b3V0cHV0X2Zvcm1hdCA9PSBJTlRFTF9P
VVRQVVRfRk9STUFUX1lDQkNSNDIwIHx8CiAJICAgICBwaXBlX2NvbmZpZy0+b3V0cHV0X2Zvcm1h
dCA9PSBJTlRFTF9PVVRQVVRfRk9STUFUX1lDQkNSNDQ0KSAmJgotCSAgICAgcGlwZV9jb25maWct
PmJhc2UuY3RtKSB7CisJICAgICBwaXBlX2NvbmZpZy0+aHcuY3RtKSB7CiAJCS8qCiAJCSAqIFRo
ZXJlIGlzIG9ubHkgb25lIHBpcGUgQ1NDIHVuaXQgcGVyIHBpcGUsIGFuZCB3ZSBuZWVkIHRoYXQK
IAkJICogZm9yIG91dHB1dCBjb252ZXJzaW9uIGZyb20gUkdCLT5ZQ0JDUi4gU28gaWYgQ1RNIGlz
IGFscmVhZHkKQEAgLTc0NTksNyArNzQ1OSw3IEBAIHN0YXRpYyB2b2lkIHZsdl9wbGxiX3JlY2Fs
X29wYW1wKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlCiBzdGF0
aWMgdm9pZCBpbnRlbF9wY2hfdHJhbnNjb2Rlcl9zZXRfbV9uKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCQkgY29uc3Qgc3RydWN0IGludGVsX2xpbmtfbV9u
ICptX24pCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRj
LT5waXBlOwogCkBAIC03NDg2LDcgKzc0ODYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcHVfdHJh
bnNjb2Rlcl9zZXRfbV9uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YQog
CQkJCQkgY29uc3Qgc3RydWN0IGludGVsX2xpbmtfbV9uICptX24sCiAJCQkJCSBjb25zdCBzdHJ1
Y3QgaW50ZWxfbGlua19tX24gKm0yX24yKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVu
dW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAllbnVtIHRyYW5zY29kZXIgdHJhbnNjb2RlciA9
IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwpAQCAtNzc5OSw3ICs3Nzk5LDcgQEAgaW50IHZs
dl9mb3JjZV9wbGxfb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBp
cGUgcGlwZSwKIAlpZiAoIXBpcGVfY29uZmlnKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCXBpcGVf
Y29uZmlnLT5iYXNlLmNydGMgPSAmY3J0Yy0+YmFzZTsKKwlwaXBlX2NvbmZpZy0+dWFwaS5jcnRj
ID0gJmNydGMtPmJhc2U7CiAJcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIgPSAxOwogCXBp
cGVfY29uZmlnLT5kcGxsID0gKmRwbGw7CiAKQEAgLTc5NTksMTEgKzc5NTksMTEgQEAgc3RhdGlj
IHZvaWQgaTh4eF9jb21wdXRlX2RwbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIHN0YXRp
YyB2b2lkIGludGVsX3NldF9waXBlX3RpbWluZ3MoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBp
cGUgPSBjcnRjLT5waXBlOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNf
c3RhdGUtPmNwdV90cmFuc2NvZGVyOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5h
ZGp1c3RlZF9tb2RlOwogCXUzMiBjcnRjX3Z0b3RhbCwgY3J0Y192YmxhbmtfZW5kOwogCWludCB2
c3luY3NoaWZ0ID0gMDsKIApAQCAtODAyMSw3ICs4MDIxLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
c2V0X3BpcGVfdGltaW5ncyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIAogc3RhdGljIHZvaWQgaW50ZWxfc2V0X3BpcGVfc3JjX3NpemUoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCkBAIC04MDQyLDM5ICs4MDQyLDM5IEBAIHN0
YXRpYyB2b2lkIGludGVsX2dldF9waXBlX3RpbWluZ3Moc3RydWN0IGludGVsX2NydGMgKmNydGMs
CiAJdTMyIHRtcDsKIAogCXRtcCA9IEk5MTVfUkVBRChIVE9UQUwoY3B1X3RyYW5zY29kZXIpKTsK
LQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGRpc3BsYXkgPSAodG1wICYg
MHhmZmZmKSArIDE7Ci0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3Rh
bCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlLmNydGNfaGRpc3BsYXkgPSAodG1wICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwgPSAoKHRtcCA+PiAxNikgJiAweGZmZmYpICsg
MTsKIAogCWlmICghdHJhbnNjb2Rlcl9pc19kc2koY3B1X3RyYW5zY29kZXIpKSB7CiAJCXRtcCA9
IEk5MTVfUkVBRChIQkxBTksoY3B1X3RyYW5zY29kZXIpKTsKLQkJcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZS5jcnRjX2hibGFua19zdGFydCA9CisJCXBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlLmNydGNfaGJsYW5rX3N0YXJ0ID0KIAkJCQkJCQkodG1wICYgMHhmZmZmKSArIDE7
Ci0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfZW5kID0KKwkJ
cGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfZW5kID0KIAkJCQkJCSgo
dG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCX0KIAl0bXAgPSBJOTE1X1JFQUQoSFNZTkMoY3B1
X3RyYW5zY29kZXIpKTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHN5
bmNfc3RhcnQgPSAodG1wICYgMHhmZmZmKSArIDE7Ci0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5jcnRjX2hzeW5jX2VuZCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOworCXBp
cGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfc3RhcnQgPSAodG1wICYgMHhm
ZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQg
PSAoKHRtcCA+PiAxNikgJiAweGZmZmYpICsgMTsKIAogCXRtcCA9IEk5MTVfUkVBRChWVE9UQUwo
Y3B1X3RyYW5zY29kZXIpKTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNf
dmRpc3BsYXkgPSAodG1wICYgMHhmZmZmKSArIDE7Ci0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5jcnRjX3Z0b3RhbCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOworCXBpcGVf
Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3BsYXkgPSAodG1wICYgMHhmZmZmKSAr
IDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192dG90YWwgPSAoKHRtcCA+
PiAxNikgJiAweGZmZmYpICsgMTsKIAogCWlmICghdHJhbnNjb2Rlcl9pc19kc2koY3B1X3RyYW5z
Y29kZXIpKSB7CiAJCXRtcCA9IEk5MTVfUkVBRChWQkxBTksoY3B1X3RyYW5zY29kZXIpKTsKLQkJ
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZibGFua19zdGFydCA9CisJCXBp
cGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0ID0KIAkJCQkJCQko
dG1wICYgMHhmZmZmKSArIDE7Ci0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0
Y192YmxhbmtfZW5kID0KKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192Ymxh
bmtfZW5kID0KIAkJCQkJCSgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCX0KIAl0bXAgPSBJ
OTE1X1JFQUQoVlNZTkMoY3B1X3RyYW5zY29kZXIpKTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1
c3RlZF9tb2RlLmNydGNfdnN5bmNfc3RhcnQgPSAodG1wICYgMHhmZmZmKSArIDE7Ci0JcGlwZV9j
b25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZCA9ICgodG1wID4+IDE2KSAm
IDB4ZmZmZikgKyAxOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNf
c3RhcnQgPSAodG1wICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y192c3luY19lbmQgPSAoKHRtcCA+PiAxNikgJiAweGZmZmYpICsgMTsKIAogCWlmIChJ
OTE1X1JFQUQoUElQRUNPTkYoY3B1X3RyYW5zY29kZXIpKSAmIFBJUEVDT05GX0lOVEVSTEFDRV9N
QVNLKSB7Ci0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gRFJNX01P
REVfRkxBR19JTlRFUkxBQ0U7Ci0JCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0
Y192dG90YWwgKz0gMTsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3Zi
bGFua19lbmQgKz0gMTsKKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgfD0g
RFJNX01PREVfRkxBR19JTlRFUkxBQ0U7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2Rl
LmNydGNfdnRvdGFsICs9IDE7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNf
dmJsYW5rX2VuZCArPSAxOwogCX0KIH0KIApAQCAtODA4OSwyNyArODA4OSwyNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9nZXRfcGlwZV9zcmNfc2l6ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlw
aXBlX2NvbmZpZy0+cGlwZV9zcmNfaCA9ICh0bXAgJiAweGZmZmYpICsgMTsKIAlwaXBlX2NvbmZp
Zy0+cGlwZV9zcmNfdyA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCi0JcGlwZV9jb25m
aWctPmJhc2UubW9kZS52ZGlzcGxheSA9IHBpcGVfY29uZmlnLT5waXBlX3NyY19oOwotCXBpcGVf
Y29uZmlnLT5iYXNlLm1vZGUuaGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdzsKKwlw
aXBlX2NvbmZpZy0+aHcubW9kZS52ZGlzcGxheSA9IHBpcGVfY29uZmlnLT5waXBlX3NyY19oOwor
CXBpcGVfY29uZmlnLT5ody5tb2RlLmhkaXNwbGF5ID0gcGlwZV9jb25maWctPnBpcGVfc3JjX3c7
CiB9CiAKIHZvaWQgaW50ZWxfbW9kZV9mcm9tX3BpcGVfY29uZmlnKHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICptb2RlLAogCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcp
CiB7Ci0JbW9kZS0+aGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNy
dGNfaGRpc3BsYXk7Ci0JbW9kZS0+aHRvdGFsID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX2h0b3RhbDsKLQltb2RlLT5oc3luY19zdGFydCA9IHBpcGVfY29uZmlnLT5iYXNl
LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19zdGFydDsKLQltb2RlLT5oc3luY19lbmQgPSBwaXBl
X2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfZW5kOworCW1vZGUtPmhkaXNw
bGF5ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxheTsKKwltb2Rl
LT5odG90YWwgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbDsKKwlt
b2RlLT5oc3luY19zdGFydCA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHN5
bmNfc3RhcnQ7CisJbW9kZS0+aHN5bmNfZW5kID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y19oc3luY19lbmQ7CiAKLQltb2RlLT52ZGlzcGxheSA9IHBpcGVfY29uZmlnLT5iYXNl
LmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheTsKLQltb2RlLT52dG90YWwgPSBwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsOwotCW1vZGUtPnZzeW5jX3N0YXJ0ID0g
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0OwotCW1vZGUt
PnZzeW5jX2VuZCA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192c3luY19l
bmQ7CisJbW9kZS0+dmRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X3ZkaXNwbGF5OworCW1vZGUtPnZ0b3RhbCA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2Rl
LmNydGNfdnRvdGFsOworCW1vZGUtPnZzeW5jX3N0YXJ0ID0gcGlwZV9jb25maWctPmh3LmFkanVz
dGVkX21vZGUuY3J0Y192c3luY19zdGFydDsKKwltb2RlLT52c3luY19lbmQgPSBwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZDsKIAotCW1vZGUtPmZsYWdzID0gcGlw
ZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFnczsKKwltb2RlLT5mbGFncyA9IHBpcGVf
Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzOwogCW1vZGUtPnR5cGUgPSBEUk1fTU9ERV9U
WVBFX0RSSVZFUjsKIAotCW1vZGUtPmNsb2NrID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX2Nsb2NrOworCW1vZGUtPmNsb2NrID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y19jbG9jazsKIAogCW1vZGUtPmhzeW5jID0gZHJtX21vZGVfaHN5bmMobW9kZSk7
CiAJbW9kZS0+dnJlZnJlc2ggPSBkcm1fbW9kZV92cmVmcmVzaChtb2RlKTsKQEAgLTgxMTgsNyAr
ODExOCw3IEBAIHZvaWQgaW50ZWxfbW9kZV9mcm9tX3BpcGVfY29uZmlnKHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICptb2RlLAogCiBzdGF0aWMgdm9pZCBpOXh4X3NldF9waXBlY29uZihjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKIAl1MzIgcGlwZWNvbmY7CiAKQEAgLTgxNTUsNyArODE1NSw3IEBAIHN0YXRpYyB2b2lk
IGk5eHhfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogCQl9CiAJfQogCi0JaWYgKGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFn
cyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKSB7CisJaWYgKGNydGNfc3RhdGUtPmh3LmFkanVz
dGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkgewogCQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA8IDQgfHwKIAkJICAgIGludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0
ZSwgSU5URUxfT1VUUFVUX1NEVk8pKQogCQkJcGlwZWNvbmYgfD0gUElQRUNPTkZfSU5URVJMQUNF
X1dfRklFTERfSU5ESUNBVElPTjsKQEAgLTg1ODcsNyArODU4Nyw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX2dldF9jcnRjX3ljYmNyX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogc3Rh
dGljIHZvaWQgaTl4eF9nZXRfcGlwZV9jb2xvcl9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFyeSk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51
bSBpOXh4X3BsYW5lX2lkIGk5eHhfcGxhbmUgPSBwbGFuZS0+aTl4eF9wbGFuZTsKQEAgLTg3MTAs
NyArODcxMCw3IEBAIHN0YXRpYyBib29sIGk5eHhfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCSAqIGJ1dCBpbiBjYXNlIHRoZSBwaXBlIGlzIGVuYWJsZWQgdy9vIGFu
eSBwb3J0cyB3ZSBuZWVkIGEgc2FuZQogCSAqIGRlZmF1bHQuCiAJICovCi0JcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0KKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX2Nsb2NrID0KIAkJcGlwZV9jb25maWctPnBvcnRfY2xvY2sgLyBwaXBlX2Nv
bmZpZy0+cGl4ZWxfbXVsdGlwbGllcjsKIAogCXJldCA9IHRydWU7CkBAIC05MjI1LDcgKzkyMjUs
NyBAQCB2b2lkIGludGVsX2luaXRfcGNoX3JlZmNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAKIHN0YXRpYyB2b2lkIGlyb25sYWtlX3NldF9waXBlY29uZihjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIHZhbDsKQEAgLTkyNTMsNyAr
OTI1Myw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoY3J0Y19zdGF0ZS0+ZGl0aGVyKQog
CQl2YWwgfD0gKFBJUEVDT05GX0RJVEhFUl9FTiB8IFBJUEVDT05GX0RJVEhFUl9UWVBFX1NQKTsK
IAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQl2YWwgfD0gUElQRUNPTkZfSU5URVJMQUNFRF9J
TEs7CiAJZWxzZQogCQl2YWwgfD0gUElQRUNPTkZfUFJPR1JFU1NJVkU7CkBAIC05MjY5LDcgKzky
NjksNyBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9zZXRfcGlwZWNvbmYoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lkIGhhc3dlbGxfc2V0X3Bp
cGVjb25mKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNy
dGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNy
dGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCXUzMiB2YWwgPSAwOwpAQCAtOTI3Nyw3ICs5Mjc3
LDcgQEAgc3RhdGljIHZvaWQgaGFzd2VsbF9zZXRfcGlwZWNvbmYoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmIGNy
dGNfc3RhdGUtPmRpdGhlcikKIAkJdmFsIHw9IChQSVBFQ09ORl9ESVRIRVJfRU4gfCBQSVBFQ09O
Rl9ESVRIRVJfVFlQRV9TUCk7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2Rl
LmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpCisJaWYgKGNydGNfc3RhdGUtPmh3LmFk
anVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKIAkJdmFsIHw9IFBJ
UEVDT05GX0lOVEVSTEFDRURfSUxLOwogCWVsc2UKIAkJdmFsIHw9IFBJUEVDT05GX1BST0dSRVNT
SVZFOwpAQCAtOTI4OCw3ICs5Mjg4LDcgQEAgc3RhdGljIHZvaWQgaGFzd2VsbF9zZXRfcGlwZWNv
bmYoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2
b2lkIGJkd19zZXRfcGlwZW1pc2MoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyIHZhbCA9IDA7CiAKQEAgLTk4
ODgsNyArOTg4OCw3IEBAIHN0YXRpYyBpbnQgaGFzd2VsbF9jcnRjX2NvbXB1dGVfY2xvY2soc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUgPQotCQl0b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+YmFzZS5zdGF0
ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT51YXBpLnN0YXRlKTsKIAog
CWlmICghaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFNJKSB8
fAogCSAgICBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CkBAIC0xMDQxOCw3ICsxMDQxOCw3
IEBAIHN0YXRpYyBpbnQgaW50ZWxfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCX0KIAogCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5l
X3N0YXRlKCZwbGFuZV9zdGF0ZS0+YmFzZSwKLQkJCQkJCSAgJmNydGNfc3RhdGUtPmJhc2UsCisJ
CQkJCQkgICZjcnRjX3N0YXRlLT51YXBpLAogCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1ND
QUxJTkcsCiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJCSAgdHJ1
ZSwgdHJ1ZSk7CkBAIC0xMDYwMSw3ICsxMDYwMSw3IEBAIGk5eHhfY3Vyc29yX21heF9zdHJpZGUo
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAogc3RhdGljIHUzMiBpOXh4X2N1cnNvcl9jdGxf
Y3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIgY250bCA9IDA7CiAKQEAgLTExMDA4LDEyICsxMTAwOCwx
MiBAQCBpbnQgaW50ZWxfZ2V0X2xvYWRfZGV0ZWN0X3BpcGUoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvciwKIAkJZ290byBmYWlsOwogCX0KIAotCWNydGNfc3RhdGUtPmJhc2UuYWN0aXZl
ID0gY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUgPSB0cnVlOworCWNydGNfc3RhdGUtPnVhcGkuYWN0
aXZlID0gY3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUgPSB0cnVlOwogCiAJaWYgKCFtb2RlKQogCQlt
b2RlID0gJmxvYWRfZGV0ZWN0X21vZGU7CiAKLQlyZXQgPSBkcm1fYXRvbWljX3NldF9tb2RlX2Zv
cl9jcnRjKCZjcnRjX3N0YXRlLT5iYXNlLCBtb2RlKTsKKwlyZXQgPSBkcm1fYXRvbWljX3NldF9t
b2RlX2Zvcl9jcnRjKCZjcnRjX3N0YXRlLT51YXBpLCBtb2RlKTsKIAlpZiAocmV0KQogCQlnb3Rv
IGZhaWw7CiAKQEAgLTExMjIxLDcgKzExMjIxLDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGNo
X2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkgKiB3ZSBtYXkgbmVlZCBzb21l
IGlkZWEgZm9yIHRoZSBkb3RjbG9jayBhbnl3YXkuCiAJICogQ2FsY3VsYXRlIG9uZSBiYXNlZCBv
biB0aGUgRkRJIGNvbmZpZ3VyYXRpb24uCiAJICovCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0
ZWRfbW9kZS5jcnRjX2Nsb2NrID0KKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X2Nsb2NrID0KIAkJaW50ZWxfZG90Y2xvY2tfY2FsY3VsYXRlKGludGVsX2ZkaV9saW5rX2ZyZXEo
ZGV2X3ByaXYsIHBpcGVfY29uZmlnKSwKIAkJCQkJICZwaXBlX2NvbmZpZy0+ZmRpX21fbik7CiB9
CkBAIC0xMTI1MSw3ICsxMTI1MSw3IEBAIGludGVsX2VuY29kZXJfY3VycmVudF9tb2RlKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCQlyZXR1cm4gTlVMTDsKIAl9CiAKLQljcnRjX3N0
YXRlLT5iYXNlLmNydGMgPSAmY3J0Yy0+YmFzZTsKKwljcnRjX3N0YXRlLT51YXBpLmNydGMgPSAm
Y3J0Yy0+YmFzZTsKIAogCWlmICghZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnKGNy
dGMsIGNydGNfc3RhdGUpKSB7CiAJCWtmcmVlKGNydGNfc3RhdGUpOwpAQCAtMTEzMjIsMTIgKzEx
MzIyLDEyIEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0CiAJCQkJICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRlLAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJYm9vbCBtb2RlX2NoYW5nZWQgPSBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUp
OwotCWJvb2wgd2FzX2NydGNfZW5hYmxlZCA9IG9sZF9jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZTsK
LQlib29sIGlzX2NydGNfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlOworCWJvb2wg
d2FzX2NydGNfZW5hYmxlZCA9IG9sZF9jcnRjX3N0YXRlLT5ody5hY3RpdmU7CisJYm9vbCBpc19j
cnRjX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5ody5hY3RpdmU7CiAJYm9vbCB0dXJuX29mZiwgdHVy
bl9vbiwgdmlzaWJsZSwgd2FzX3Zpc2libGU7CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAlpbnQgcmV0OwpAQCAtMTE1MDIsOSArMTE1MDIsOSBA
QCBzdGF0aWMgaW50IGljbF9hZGRfbGlua2VkX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAogc3RhdGljIGludCBpY2xfY2hlY2tfbnYxMl9wbGFuZXMoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0J
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUo
Y3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZSk7CisJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CiAJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSwgKmxpbmtlZDsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlOwogCWludCBpOwpAQCAtMTE1NzQsOSArMTE1NzQsOSBAQCBzdGF0aWMg
aW50IGljbF9jaGVja19udjEyX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIAogc3RhdGljIGJvb2wgYzhfcGxhbmVzX2NoYW5nZWQoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7
CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQotCQl0b19pbnRlbF9hdG9taWNf
c3RhdGUobmV3X2NydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCQl0b19pbnRlbF9hdG9taWNfc3Rh
dGUobmV3X2NydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9CiAJCWludGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3Rh
dGUoc3RhdGUsIGNydGMpOwogCkBAIC0xMTczNyw3ICsxMTczNyw3IEBAIGNvbXB1dGVfYmFzZWxp
bmVfcGlwZV9icHAoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgIHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUgPSBwaXBlX2NvbmZpZy0+YmFzZS5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2F0b21pY19z
dGF0ZSAqc3RhdGUgPSBwaXBlX2NvbmZpZy0+dWFwaS5zdGF0ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uZWN0b3Jf
c3RhdGU7CiAJaW50IGJwcCwgaTsKQEAgLTExODkwLDcgKzExODkwLDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHVtcF9waXBlX2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcsCiAJCQkJICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJ
ICAgY29uc3QgY2hhciAqY29udGV4dCkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CiAJc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZTsKQEAgLTExODk5LDE0ICsxMTg5OSwxNCBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9kdW1wX3BpcGVfY29uZmlnKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZywKIAogCURSTV9ERUJVR19LTVMoIltDUlRDOiVkOiVzXSBlbmFibGU6ICVzICVzXG4iLAog
CQkgICAgICBjcnRjLT5iYXNlLmJhc2UuaWQsIGNydGMtPmJhc2UubmFtZSwKLQkJICAgICAgeWVz
bm8ocGlwZV9jb25maWctPmJhc2UuZW5hYmxlKSwgY29udGV4dCk7CisJCSAgICAgIHllc25vKHBp
cGVfY29uZmlnLT5ody5lbmFibGUpLCBjb250ZXh0KTsKIAotCWlmICghcGlwZV9jb25maWctPmJh
c2UuZW5hYmxlKQorCWlmICghcGlwZV9jb25maWctPmh3LmVuYWJsZSkKIAkJZ290byBkdW1wX3Bs
YW5lczsKIAogCXNucHJpbnRmX291dHB1dF90eXBlcyhidWYsIHNpemVvZihidWYpLCBwaXBlX2Nv
bmZpZy0+b3V0cHV0X3R5cGVzKTsKIAlEUk1fREVCVUdfS01TKCJhY3RpdmU6ICVzLCBvdXRwdXRf
dHlwZXM6ICVzICgweCV4KSwgb3V0cHV0IGZvcm1hdDogJXNcbiIsCi0JCSAgICAgIHllc25vKHBp
cGVfY29uZmlnLT5iYXNlLmFjdGl2ZSksCisJCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5ody5h
Y3RpdmUpLAogCQkgICAgICBidWYsIHBpcGVfY29uZmlnLT5vdXRwdXRfdHlwZXMsCiAJCSAgICAg
IG91dHB1dF9mb3JtYXRzKHBpcGVfY29uZmlnLT5vdXRwdXRfZm9ybWF0KSk7CiAKQEAgLTExOTQ2
LDEwICsxMTk0NiwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kdW1wX3BpcGVfY29uZmlnKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJaW50ZWxfZHVtcF9pbmZv
ZnJhbWUoZGV2X3ByaXYsICZwaXBlX2NvbmZpZy0+aW5mb2ZyYW1lcy5oZG1pKTsKIAogCURSTV9E
RUJVR19LTVMoInJlcXVlc3RlZCBtb2RlOlxuIik7Ci0JZHJtX21vZGVfZGVidWdfcHJpbnRtb2Rl
bGluZSgmcGlwZV9jb25maWctPmJhc2UubW9kZSk7CisJZHJtX21vZGVfZGVidWdfcHJpbnRtb2Rl
bGluZSgmcGlwZV9jb25maWctPmh3Lm1vZGUpOwogCURSTV9ERUJVR19LTVMoImFkanVzdGVkIG1v
ZGU6XG4iKTsKLQlkcm1fbW9kZV9kZWJ1Z19wcmludG1vZGVsaW5lKCZwaXBlX2NvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlKTsKLQlpbnRlbF9kdW1wX2NydGNfdGltaW5ncygmcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZSk7CisJZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZSgmcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUpOworCWludGVsX2R1bXBfY3J0Y190aW1pbmdzKCZw
aXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZSk7CiAJRFJNX0RFQlVHX0tNUygicG9ydCBjbG9j
azogJWQsIHBpcGUgc3JjIHNpemU6ICVkeCVkLCBwaXhlbCByYXRlICVkXG4iLAogCQkgICAgICBw
aXBlX2NvbmZpZy0+cG9ydF9jbG9jaywKIAkJICAgICAgcGlwZV9jb25maWctPnBpcGVfc3JjX3cs
IHBpcGVfY29uZmlnLT5waXBlX3NyY19oLApAQCAtMTIwNTgsNyArMTIwNTgsNyBAQCBzdGF0aWMg
aW50CiBjbGVhcl9pbnRlbF9jcnRjX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5
MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCQl0b19pOTE1KGNydGNfc3RhdGUtPnVh
cGkuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqc2F2ZWRfc3RhdGU7CiAK
IAlzYXZlZF9zdGF0ZSA9IGt6YWxsb2Moc2l6ZW9mKCpzYXZlZF9zdGF0ZSksIEdGUF9LRVJORUwp
OwpAQCAtMTIwNzksOSArMTIwNzksMTAgQEAgY2xlYXJfaW50ZWxfY3J0Y19zdGF0ZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJc2F2ZWRfc3RhdGUtPndtID0gY3J0Y19z
dGF0ZS0+d207CiAKIAkvKiBLZWVwIGJhc2UgZHJtX2NydGNfc3RhdGUgaW50YWN0LCBvbmx5IGNs
ZWFyIG91ciBleHRlbmRlZCBzdHJ1Y3QgKi8KLQlCVUlMRF9CVUdfT04ob2Zmc2V0b2Yoc3RydWN0
IGludGVsX2NydGNfc3RhdGUsIGJhc2UpKTsKLQltZW1jcHkoJmNydGNfc3RhdGUtPmJhc2UgKyAx
LCAmc2F2ZWRfc3RhdGUtPmJhc2UgKyAxLAotCSAgICAgICBzaXplb2YoKmNydGNfc3RhdGUpIC0g
c2l6ZW9mKGNydGNfc3RhdGUtPmJhc2UpKTsKKwlCVUlMRF9CVUdfT04ob2Zmc2V0b2Yoc3RydWN0
IGludGVsX2NydGNfc3RhdGUsIHVhcGkpKTsKKwlCVUlMRF9CVUdfT04ob2Zmc2V0b2Yoc3RydWN0
IGludGVsX2NydGNfc3RhdGUsIGh3KSk7CisJbWVtY3B5KCZjcnRjX3N0YXRlLT51YXBpICsgMSwg
JnNhdmVkX3N0YXRlLT51YXBpICsgMSwKKwkgICAgICAgc2l6ZW9mKCpjcnRjX3N0YXRlKSAtIHNp
emVvZihjcnRjX3N0YXRlLT51YXBpKSk7CiAKIAlrZnJlZShzYXZlZF9zdGF0ZSk7CiAJcmV0dXJu
IDA7CkBAIC0xMjA5MCw4ICsxMjA5MSw4IEBAIGNsZWFyX2ludGVsX2NydGNfc3RhdGUoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0aWMgaW50CiBpbnRlbF9tb2Rlc2V0
X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQlz
dHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+YmFzZS5jcnRjOwotCXN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IHBpcGVfY29uZmlnLT5iYXNlLnN0YXRlOworCXN0cnVj
dCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmlnLT51YXBpLmNydGM7CisJc3RydWN0IGRybV9h
dG9taWNfc3RhdGUgKnN0YXRlID0gcGlwZV9jb25maWctPnVhcGkuc3RhdGU7CiAJc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXI7CiAJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsK
IAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlOwpAQCAtMTIxMTEs
MTMgKzEyMTEyLDEzIEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCSAqIHBvc2l0aXZlIG9yIG5lZ2F0aXZlIHBvbGFyaXR5
IGlzIHJlcXVlc3RlZCwgdHJlYXQgdGhpcyBhcyBtZWFuaW5nCiAJICogbmVnYXRpdmUgcG9sYXJp
dHkuCiAJICovCi0JaWYgKCEocGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
CisJaWYgKCEocGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgJgogCSAgICAgIChE
Uk1fTU9ERV9GTEFHX1BIU1lOQyB8IERSTV9NT0RFX0ZMQUdfTkhTWU5DKSkpCi0JCXBpcGVfY29u
ZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OSFNZTkM7CisJ
CXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IERSTV9NT0RFX0ZMQUdfTkhT
WU5DOwogCi0JaWYgKCEocGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyAmCisJ
aWYgKCEocGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgJgogCSAgICAgIChEUk1f
TU9ERV9GTEFHX1BWU1lOQyB8IERSTV9NT0RFX0ZMQUdfTlZTWU5DKSkpCi0JCXBpcGVfY29uZmln
LT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OVlNZTkM7CisJCXBp
cGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IERSTV9NT0RFX0ZMQUdfTlZTWU5D
OwogCiAJcmV0ID0gY29tcHV0ZV9iYXNlbGluZV9waXBlX2JwcCh0b19pbnRlbF9jcnRjKGNydGMp
LAogCQkJCQlwaXBlX2NvbmZpZyk7CkBAIC0xMjEzNCw3ICsxMjEzNSw3IEBAIGludGVsX21vZGVz
ZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCSAq
IGNvbXB1dGF0aW9uIHRvIGNsZWFybHkgZGlzdGluZ3Vpc2ggaXQgZnJvbSB0aGUgYWRqdXN0ZWQg
bW9kZSwgd2hpY2gKIAkgKiBjYW4gYmUgY2hhbmdlZCBieSB0aGUgY29ubmVjdG9ycyBpbiB0aGUg
YmVsb3cgcmV0cnkgbG9vcC4KIAkgKi8KLQlkcm1fbW9kZV9nZXRfaHZfdGltaW5nKCZwaXBlX2Nv
bmZpZy0+YmFzZS5tb2RlLAorCWRybV9tb2RlX2dldF9odl90aW1pbmcoJnBpcGVfY29uZmlnLT5o
dy5tb2RlLAogCQkJICAgICAgICZwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdywKIAkJCSAgICAgICAm
cGlwZV9jb25maWctPnBpcGVfc3JjX2gpOwogCkBAIC0xMjE2Nyw3ICsxMjE2OCw3IEBAIGludGVs
X21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmln
KQogCXBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyID0gMTsKIAogCS8qIEZpbGwgaW4gZGVm
YXVsdCBjcnRjIHRpbWluZ3MsIGFsbG93IGVuY29kZXJzIHRvIG92ZXJ3cml0ZSB0aGVtLiAqLwot
CWRybV9tb2RlX3NldF9jcnRjaW5mbygmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZSwK
Kwlkcm1fbW9kZV9zZXRfY3J0Y2luZm8oJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLAog
CQkJICAgICAgQ1JUQ19TVEVSRU9fRE9VQkxFKTsKIAogCS8qIFBhc3Mgb3VyIG1vZGUgdG8gdGhl
IGNvbm5lY3RvcnMgYW5kIHRoZSBDUlRDIHRvIGdpdmUgdGhlbSBhIGNoYW5jZSB0bwpAQCAtMTIx
OTIsNyArMTIxOTMsNyBAQCBpbnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIAkvKiBTZXQgZGVmYXVsdCBwb3J0IGNsb2NrIGlmIG5v
dCBvdmVyd3JpdHRlbiBieSB0aGUgZW5jb2Rlci4gTmVlZHMgdG8gYmUKIAkgKiBkb25lIGFmdGVy
d2FyZHMgaW4gY2FzZSB0aGUgZW5jb2RlciBhZGp1c3RzIHRoZSBtb2RlLiAqLwogCWlmICghcGlw
ZV9jb25maWctPnBvcnRfY2xvY2spCi0JCXBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrID0gcGlwZV9j
b25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrCisJCXBpcGVfY29uZmlnLT5wb3J0
X2Nsb2NrID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jawogCQkJKiBw
aXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcjsKIAogCXJldCA9IGludGVsX2NydGNfY29tcHV0
ZV9jb25maWcodG9faW50ZWxfY3J0YyhjcnRjKSwgcGlwZV9jb25maWcpOwpAQCAtMTIzNTYsMTEg
KzEyMzU3LDExIEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmN1cnJlbnRfY29uZmlnLAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgIGJvb2wgZmFzdHNldCkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGN1cnJlbnRfY29uZmlnLT5iYXNlLmNy
dGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
dXJyZW50X2NvbmZpZy0+dWFwaS5jcnRjLT5kZXYpOwogCWJvb2wgcmV0ID0gdHJ1ZTsKIAlib29s
IGZpeHVwX2luaGVyaXRlZCA9IGZhc3RzZXQgJiYKLQkJKGN1cnJlbnRfY29uZmlnLT5iYXNlLm1v
ZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkgJiYKLQkJIShwaXBl
X2NvbmZpZy0+YmFzZS5tb2RlLnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklU
RUQpOworCQkoY3VycmVudF9jb25maWctPmh3Lm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9E
RV9GTEFHX0lOSEVSSVRFRCkgJiYKKwkJIShwaXBlX2NvbmZpZy0+aHcubW9kZS5wcml2YXRlX2Zs
YWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKTsKIAogCWlmIChmaXh1cF9pbmhlcml0ZWQg
JiYgIWZhc3Rib290X2VuYWJsZWQoZGV2X3ByaXYpKSB7CiAJCURSTV9ERUJVR19LTVMoImluaXRp
YWwgbW9kZXNldCBhbmQgZmFzdGJvb3Qgbm90IHNldFxuIik7CkBAIC0xMjUzMSwxOSArMTI1MzIs
MTkgQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3VycmVudF9jb25maWcsCiAKIAlQSVBFX0NPTkZfQ0hFQ0tfWChvdXRwdXRfdHlwZXMp
OwogCi0JUElQRV9DT05GX0NIRUNLX0koYmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGRpc3BsYXkp
OwotCVBJUEVfQ09ORl9DSEVDS19JKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCk7Ci0J
UElQRV9DT05GX0NIRUNLX0koYmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGJsYW5rX3N0YXJ0KTsK
LQlQSVBFX0NPTkZfQ0hFQ0tfSShiYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfZW5kKTsK
LQlQSVBFX0NPTkZfQ0hFQ0tfSShiYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19zdGFydCk7
Ci0JUElQRV9DT05GX0NIRUNLX0koYmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfZW5kKTsK
KwlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaGRpc3BsYXkpOworCVBJ
UEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwpOworCVBJUEVfQ09O
Rl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfc3RhcnQpOworCVBJUEVfQ09O
Rl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfZW5kKTsKKwlQSVBFX0NPTkZf
Q0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfc3RhcnQpOworCVBJUEVfQ09ORl9D
SEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQpOwogCi0JUElQRV9DT05GX0NI
RUNLX0koYmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3BsYXkpOwotCVBJUEVfQ09ORl9DSEVD
S19JKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCk7Ci0JUElQRV9DT05GX0NIRUNLX0ko
YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0KTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
SShiYXNlLmFkanVzdGVkX21vZGUuY3J0Y192YmxhbmtfZW5kKTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
SShiYXNlLmFkanVzdGVkX21vZGUuY3J0Y192c3luY19zdGFydCk7Ci0JUElQRV9DT05GX0NIRUNL
X0koYmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfZW5kKTsKKwlQSVBFX0NPTkZfQ0hFQ0tf
SShody5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3BsYXkpOworCVBJUEVfQ09ORl9DSEVDS19JKGh3
LmFkanVzdGVkX21vZGUuY3J0Y192dG90YWwpOworCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVz
dGVkX21vZGUuY3J0Y192Ymxhbmtfc3RhcnQpOworCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVz
dGVkX21vZGUuY3J0Y192YmxhbmtfZW5kKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3Rl
ZF9tb2RlLmNydGNfdnN5bmNfc3RhcnQpOworCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVk
X21vZGUuY3J0Y192c3luY19lbmQpOwogCiAJUElQRV9DT05GX0NIRUNLX0kocGl4ZWxfbXVsdGlw
bGllcik7CiAJUElQRV9DT05GX0NIRUNLX0kob3V0cHV0X2Zvcm1hdCk7CkBAIC0xMjU1OCwxNyAr
MTI1NTksMTcgQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3VycmVudF9jb25maWcsCiAKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTF9JTkNP
TVBMRVRFKGhhc19hdWRpbyk7CiAKLQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoYmFzZS5hZGp1c3Rl
ZF9tb2RlLmZsYWdzLAorCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZs
YWdzLAogCQkJICAgICAgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpOwogCiAJaWYgKCFQSVBFX0NP
TkZfUVVJUksoUElQRV9DT05GSUdfUVVJUktfTU9ERV9TWU5DX0ZMQUdTKSkgewotCQlQSVBFX0NP
TkZfQ0hFQ0tfRkxBR1MoYmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzLAorCQlQSVBFX0NPTkZfQ0hF
Q0tfRkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKIAkJCQkgICAgICBEUk1fTU9ERV9GTEFH
X1BIU1lOQyk7Ci0JCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhiYXNlLmFkanVzdGVkX21vZGUuZmxh
Z3MsCisJCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZsYWdzLAogCQkJ
CSAgICAgIERSTV9NT0RFX0ZMQUdfTkhTWU5DKTsKLQkJUElQRV9DT05GX0NIRUNLX0ZMQUdTKGJh
c2UuYWRqdXN0ZWRfbW9kZS5mbGFncywKKwkJUElQRV9DT05GX0NIRUNLX0ZMQUdTKGh3LmFkanVz
dGVkX21vZGUuZmxhZ3MsCiAJCQkJICAgICAgRFJNX01PREVfRkxBR19QVlNZTkMpOwotCQlQSVBF
X0NPTkZfQ0hFQ0tfRkxBR1MoYmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzLAorCQlQSVBFX0NPTkZf
Q0hFQ0tfRkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKIAkJCQkgICAgICBEUk1fTU9ERV9G
TEFHX05WU1lOQyk7CiAJfQogCkBAIC0xMjY0Nyw3ICsxMjY0OCw3IEBAIGludGVsX3BpcGVfY29u
ZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmN1cnJlbnRfY29uZmln
LAogCWlmIChJU19HNFgoZGV2X3ByaXYpIHx8IElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkKIAkJ
UElQRV9DT05GX0NIRUNLX0kocGlwZV9icHApOwogCi0JUElQRV9DT05GX0NIRUNLX0NMT0NLX0ZV
WlpZKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfQ0xP
Q0tfRlVaWlkoaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrKTsKIAlQSVBFX0NPTkZfQ0hFQ0tf
Q0xPQ0tfRlVaWlkocG9ydF9jbG9jayk7CiAKIAlQSVBFX0NPTkZfQ0hFQ0tfSShtaW5fdm9sdGFn
ZV9sZXZlbCk7CkBAIC0xMjY3Nyw3ICsxMjY3OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3BpcGVf
Y29uZmlnX3Nhbml0eV9jaGVjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
aWYgKHBpcGVfY29uZmlnLT5oYXNfcGNoX2VuY29kZXIpIHsKIAkJaW50IGZkaV9kb3RjbG9jayA9
IGludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShpbnRlbF9mZGlfbGlua19mcmVxKGRldl9wcml2LCBw
aXBlX2NvbmZpZyksCiAJCQkJCQkJICAgICZwaXBlX2NvbmZpZy0+ZmRpX21fbik7Ci0JCWludCBk
b3RjbG9jayA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKwkJ
aW50IGRvdGNsb2NrID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsK
IAogCQkvKgogCQkgKiBGREkgYWxyZWFkeSBwcm92aWRlZCBvbmUgaWRlYSBmb3IgdGhlIGRvdGNs
b2NrLgpAQCAtMTI3MDUsNyArMTI3MDYsNyBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJY29uc3QgZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5w
aXBlOwogCWludCBwbGFuZSwgbGV2ZWwsIG1heF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2
X3ByaXYpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA5IHx8ICFuZXdfc3RhdGUtPmJh
c2UuYWN0aXZlKQorCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSB8fCAhbmV3X3N0YXRlLT5o
dy5hY3RpdmUpCiAJCXJldHVybjsKIAogCWh3ID0ga3phbGxvYyhzaXplb2YoKmh3KSwgR0ZQX0tF
Uk5FTCk7CkBAIC0xMjkxNCwxMiArMTI5MTUsMTIgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0
IGludGVsX2NydGMgKmNydGMsCiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZTsK
IAlib29sIGFjdGl2ZTsKIAotCW9sZF9zdGF0ZSA9IG9sZF9jcnRjX3N0YXRlLT5iYXNlLnN0YXRl
OwotCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0YXRlKCZvbGRfY3J0Y19zdGF0
ZS0+YmFzZSk7CisJb2xkX3N0YXRlID0gb2xkX2NydGNfc3RhdGUtPnVhcGkuc3RhdGU7CisJX19k
cm1fYXRvbWljX2hlbHBlcl9jcnRjX2Rlc3Ryb3lfc3RhdGUoJm9sZF9jcnRjX3N0YXRlLT51YXBp
KTsKIAlwaXBlX2NvbmZpZyA9IG9sZF9jcnRjX3N0YXRlOwogCW1lbXNldChwaXBlX2NvbmZpZywg
MCwgc2l6ZW9mKCpwaXBlX2NvbmZpZykpOwotCXBpcGVfY29uZmlnLT5iYXNlLmNydGMgPSAmY3J0
Yy0+YmFzZTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5zdGF0ZSA9IG9sZF9zdGF0ZTsKKwlwaXBlX2Nv
bmZpZy0+dWFwaS5jcnRjID0gJmNydGMtPmJhc2U7CisJcGlwZV9jb25maWctPnVhcGkuc3RhdGUg
PSBvbGRfc3RhdGU7CiAKIAlEUk1fREVCVUdfS01TKCJbQ1JUQzolZDolc11cbiIsIGNydGMtPmJh
c2UuYmFzZS5pZCwgY3J0Yy0+YmFzZS5uYW1lKTsKIApAQCAtMTI5MjcsMjMgKzEyOTI4LDI2IEBA
IHZlcmlmeV9jcnRjX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJLyogd2Uga2Vl
cCBib3RoIHBpcGVzIGVuYWJsZWQgb24gODMwICovCiAJaWYgKElTX0k4MzAoZGV2X3ByaXYpKQot
CQlhY3RpdmUgPSBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJCWFjdGl2ZSA9IG5ld19j
cnRjX3N0YXRlLT5ody5hY3RpdmU7CiAKLQlJOTE1X1NUQVRFX1dBUk4obmV3X2NydGNfc3RhdGUt
PmJhc2UuYWN0aXZlICE9IGFjdGl2ZSwKLQkgICAgICJjcnRjIGFjdGl2ZSBzdGF0ZSBkb2Vzbid0
IG1hdGNoIHdpdGggaHcgc3RhdGUgIgotCSAgICAgIihleHBlY3RlZCAlaSwgZm91bmQgJWkpXG4i
LCBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUsIGFjdGl2ZSk7CisJSTkxNV9TVEFURV9XQVJO
KG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgIT0gYWN0aXZlLAorCQkJImNydGMgYWN0aXZlIHN0
YXRlIGRvZXNuJ3QgbWF0Y2ggd2l0aCBodyBzdGF0ZSAiCisJCQkiKGV4cGVjdGVkICVpLCBmb3Vu
ZCAlaSlcbiIsCisJCQluZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlLCBhY3RpdmUpOwogCi0JSTkx
NV9TVEFURV9XQVJOKGNydGMtPmFjdGl2ZSAhPSBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUs
Ci0JICAgICAidHJhbnNpdGlvbmFsIGFjdGl2ZSBzdGF0ZSBkb2VzIG5vdCBtYXRjaCBhdG9taWMg
aHcgc3RhdGUgIgotCSAgICAgIihleHBlY3RlZCAlaSwgZm91bmQgJWkpXG4iLCBuZXdfY3J0Y19z
dGF0ZS0+YmFzZS5hY3RpdmUsIGNydGMtPmFjdGl2ZSk7CisJSTkxNV9TVEFURV9XQVJOKGNydGMt
PmFjdGl2ZSAhPSBuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlLAorCQkJInRyYW5zaXRpb25hbCBh
Y3RpdmUgc3RhdGUgZG9lcyBub3QgbWF0Y2ggYXRvbWljIGh3IHN0YXRlICIKKwkJCSIoZXhwZWN0
ZWQgJWksIGZvdW5kICVpKVxuIiwKKwkJCW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUsIGNydGMt
PmFjdGl2ZSk7CiAKIAlmb3JfZWFjaF9lbmNvZGVyX29uX2NydGMoZGV2LCAmY3J0Yy0+YmFzZSwg
ZW5jb2RlcikgewogCQllbnVtIHBpcGUgcGlwZTsKIAogCQlhY3RpdmUgPSBlbmNvZGVyLT5nZXRf
aHdfc3RhdGUoZW5jb2RlciwgJnBpcGUpOwotCQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICE9IG5l
d19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwKLQkJCSJbRU5DT0RFUjolaV0gYWN0aXZlICVpIHdp
dGggY3J0YyBhY3RpdmUgJWlcbiIsCi0JCQllbmNvZGVyLT5iYXNlLmJhc2UuaWQsIGFjdGl2ZSwg
bmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKTsKKwkJSTkxNV9TVEFURV9XQVJOKGFjdGl2ZSAh
PSBuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlLAorCQkJCSJbRU5DT0RFUjolaV0gYWN0aXZlICVp
IHdpdGggY3J0YyBhY3RpdmUgJWlcbiIsCisJCQkJZW5jb2Rlci0+YmFzZS5iYXNlLmlkLCBhY3Rp
dmUsCisJCQkJbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSk7CiAKIAkJSTkxNV9TVEFURV9XQVJO
KGFjdGl2ZSAmJiBjcnRjLT5waXBlICE9IHBpcGUsCiAJCQkJIkVuY29kZXIgY29ubmVjdGVkIHRv
IHdyb25nIHBpcGUgJWNcbiIsCkBAIC0xMjk1NSw3ICsxMjk1OSw3IEBAIHZlcmlmeV9jcnRjX3N0
YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJaW50ZWxfY3J0Y19jb21wdXRlX3BpeGVs
X3JhdGUocGlwZV9jb25maWcpOwogCi0JaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUp
CisJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1cm47CiAKIAlpbnRlbF9w
aXBlX2NvbmZpZ19zYW5pdHlfY2hlY2soZGV2X3ByaXYsIHBpcGVfY29uZmlnKTsKQEAgLTEzMDE3
LDcgKzEzMDIxLDcgQEAgdmVyaWZ5X3NpbmdsZV9kcGxsX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAogCWNydGNfbWFzayA9IGRybV9jcnRjX21hc2soJmNydGMtPmJh
c2UpOwogCi0JaWYgKG5ld19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKG5ld19zdGF0ZS0+aHcu
YWN0aXZlKQogCQlJOTE1X1NUQVRFX1dBUk4oIShwbGwtPmFjdGl2ZV9tYXNrICYgY3J0Y19tYXNr
KSwKIAkJCQkicGxsIGFjdGl2ZSBtaXNtYXRjaCAoZXhwZWN0ZWQgcGlwZSAlYyBpbiBhY3RpdmUg
bWFzayAweCUwMngpXG4iLAogCQkJCXBpcGVfbmFtZShkcm1fY3J0Y19pbmRleCgmY3J0Yy0+YmFz
ZSkpLCBwbGwtPmFjdGl2ZV9tYXNrKTsKQEAgLTEzMDk1LDcgKzEzMDk5LDcgQEAgaW50ZWxfbW9k
ZXNldF92ZXJpZnlfZGlzYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CiBzdGF0aWMgdm9pZCB1cGRhdGVfc2NhbmxpbmVfb2Zmc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJLyoK
QEAgLTEzMTI2LDcgKzEzMTMwLDcgQEAgc3RhdGljIHZvaWQgdXBkYXRlX3NjYW5saW5lX29mZnNl
dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKiBhbnN3ZXIg
dGhhdCdzIHNsaWdodGx5IGluIHRoZSBmdXR1cmUuCiAJICovCiAJaWYgKElTX0dFTihkZXZfcHJp
diwgMikpIHsKLQkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PSAmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQljb25zdCBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2Rl
OwogCQlpbnQgdnRvdGFsOwogCiAJCXZ0b3RhbCA9IGFkanVzdGVkX21vZGUtPmNydGNfdnRvdGFs
OwpAQCAtMTMxODUsNyArMTMxODksNyBAQCBzdGF0aWMgaW50IGhhc3dlbGxfbW9kZV9zZXRfcGxh
bmVzX3dvcmthcm91bmQoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAkvKiBs
b29rIGF0IGFsbCBjcnRjJ3MgdGhhdCBhcmUgZ29pbmcgdG8gYmUgZW5hYmxlZCBpbiBkdXJpbmcg
bW9kZXNldCAqLwogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRj
LCBjcnRjX3N0YXRlLCBpKSB7Ci0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwKKwkJ
aWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKIAkJICAgICFuZWVkc19tb2Rlc2V0KGNydGNf
c3RhdGUpKQogCQkJY29udGludWU7CiAKQEAgLTEzMjEwLDcgKzEzMjE0LDcgQEAgc3RhdGljIGlu
dCBoYXN3ZWxsX21vZGVfc2V0X3BsYW5lc193b3JrYXJvdW5kKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogCiAJCWNydGNfc3RhdGUtPmhzd193b3JrYXJvdW5kX3BpcGUgPSBJTlZB
TElEX1BJUEU7CiAKLQkJaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSB8fAorCQlpZiAoIWNy
dGNfc3RhdGUtPmh3LmFjdGl2ZSB8fAogCQkgICAgbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKSkK
IAkJCWNvbnRpbnVlOwogCkBAIC0xMzMwMiwxMiArMTMzMDYsMTIgQEAgc3RhdGljIGludCBpbnRl
bF9tb2Rlc2V0X2NoZWNrcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAogCWZv
cl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19z
dGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0YXRlLCBpKSB7Ci0JCWlmIChuZXdfY3J0Y19zdGF0
ZS0+YmFzZS5hY3RpdmUpCisJCWlmIChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJc3Rh
dGUtPmFjdGl2ZV9jcnRjcyB8PSAxIDw8IGk7CiAJCWVsc2UKIAkJCXN0YXRlLT5hY3RpdmVfY3J0
Y3MgJj0gfigxIDw8IGkpOwogCi0JCWlmIChvbGRfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgIT0g
bmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCQlpZiAob2xkX2NydGNfc3RhdGUtPmh3LmFj
dGl2ZSAhPSBuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJc3RhdGUtPmFjdGl2ZV9waXBl
X2NoYW5nZXMgfD0gZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CiAJfQogCkBAIC0xMzQwOCw3
ICsxMzQxMiw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfY2hlY2tfZmFzdHNldChjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhCiAJaWYgKCFpbnRlbF9waXBlX2Nv
bmZpZ19jb21wYXJlKG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgdHJ1ZSkpCiAJCXJl
dHVybjsKIAotCW5ld19jcnRjX3N0YXRlLT5iYXNlLm1vZGVfY2hhbmdlZCA9IGZhbHNlOworCW5l
d19jcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZCA9IGZhbHNlOwogCW5ld19jcnRjX3N0YXRl
LT51cGRhdGVfcGlwZSA9IHRydWU7CiAKIAkvKgpAQCAtMTM0NDMsOSArMTM0NDcsOSBAQCBzdGF0
aWMgaW50IGludGVsX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCS8qIENh
dGNoIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCAqLwogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9j
cnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19j
cnRjX3N0YXRlLCBpKSB7Ci0JCWlmIChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5tb2RlLnByaXZhdGVf
ZmxhZ3MgIT0KLQkJICAgIG9sZF9jcnRjX3N0YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncykK
LQkJCW5ld19jcnRjX3N0YXRlLT5iYXNlLm1vZGVfY2hhbmdlZCA9IHRydWU7CisJCWlmIChuZXdf
Y3J0Y19zdGF0ZS0+aHcubW9kZS5wcml2YXRlX2ZsYWdzICE9CisJCSAgICBvbGRfY3J0Y19zdGF0
ZS0+aHcubW9kZS5wcml2YXRlX2ZsYWdzKQorCQkJbmV3X2NydGNfc3RhdGUtPnVhcGkubW9kZV9j
aGFuZ2VkID0gdHJ1ZTsKIAl9CiAKIAlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19tb2Rl
c2V0KGRldiwgJnN0YXRlLT5iYXNlKTsKQEAgLTEzNDU3LDcgKzEzNDYxLDcgQEAgc3RhdGljIGlu
dCBpbnRlbF9hdG9taWNfY2hlY2soc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJaWYgKCFuZWVk
c19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCi0JCWlmICghbmV3X2Ny
dGNfc3RhdGUtPmJhc2UuZW5hYmxlKSB7CisJCWlmICghbmV3X2NydGNfc3RhdGUtPnVhcGkuZW5h
YmxlKSB7CiAJCQlhbnlfbXMgPSB0cnVlOwogCQkJY29udGludWU7CiAJCX0KQEAgLTEzNTkzLDcg
KzEzNTk3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX2NydGNzKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlKQogCWludCBpOwogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2Ny
dGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwg
aSkgewotCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkJaWYgKCFuZXdfY3J0
Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJY29udGludWU7CiAKIAkJaW50ZWxfdXBkYXRlX2NydGMo
Y3J0Yywgc3RhdGUsIG9sZF9jcnRjX3N0YXRlLApAQCAtMTM2MTYsNyArMTM2MjAsNyBAQCBzdGF0
aWMgdm9pZCBza2xfdXBkYXRlX2NydGNzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9s
ZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkKIAkJLyogaWdub3JlIGFsbG9jYXRpb25z
IGZvciBjcnRjJ3MgdGhhdCBoYXZlIGJlZW4gdHVybmVkIG9mZi4gKi8KLQkJaWYgKG5ld19jcnRj
X3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkJaWYgKG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJ
CQllbnRyaWVzW2ldID0gb2xkX2NydGNfc3RhdGUtPndtLnNrbC5kZGI7CiAKIAkvKiBJZiAybmQg
REJ1ZiBzbGljZSByZXF1aXJlZCwgZW5hYmxlIGl0IGhlcmUgKi8KQEAgLTEzNjM4LDcgKzEzNjQy
LDcgQEAgc3RhdGljIHZvaWQgc2tsX3VwZGF0ZV9jcnRjcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAogCQkJcGlwZSA9IGNydGMtPnBpcGU7CiAKLQkJCWlmICh1cGRhdGVkICYg
Y21hc2sgfHwgIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkJCWlmICh1cGRhdGVkICYg
Y21hc2sgfHwgIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCQkJY29udGludWU7CiAKIAkJ
CWlmIChza2xfZGRiX2FsbG9jYXRpb25fb3ZlcmxhcHMoJm5ld19jcnRjX3N0YXRlLT53bS5za2wu
ZGRiLApAQCAtMTM2NTcsNyArMTM2NjEsNyBAQCBzdGF0aWMgdm9pZCBza2xfdXBkYXRlX2NydGNz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJICovCiAJCQlpZiAoIXNrbF9k
ZGJfZW50cnlfZXF1YWwoJm5ld19jcnRjX3N0YXRlLT53bS5za2wuZGRiLAogCQkJCQkJICZvbGRf
Y3J0Y19zdGF0ZS0+d20uc2tsLmRkYikgJiYKLQkJCSAgICAhbmV3X2NydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlX2NoYW5nZWQgJiYKKwkJCSAgICAhbmV3X2NydGNfc3RhdGUtPnVhcGkuYWN0aXZlX2No
YW5nZWQgJiYKIAkJCSAgICBzdGF0ZS0+d21fcmVzdWx0cy5kaXJ0eV9waXBlcyAhPSB1cGRhdGVk
KQogCQkJCXZibF93YWl0ID0gdHJ1ZTsKIApAQCAtMTM3NjIsNyArMTM3NjYsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiAKIAkJaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShvbGRfY3J0Y19zdGF0ZSwgbmV3X2Ny
dGNfc3RhdGUpOwogCi0JCWlmIChvbGRfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpIHsKKwkJaWYg
KG9sZF9jcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJCWludGVsX2NydGNfZGlzYWJsZV9wbGFu
ZXMoc3RhdGUsIGNydGMpOwogCiAJCQkvKgpAQCAtMTM3ODQsNyArMTM3ODgsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiAJCQlpbnRlbF9jaGVja19wY2hfZmlmb191bmRlcnJ1bnMoZGV2X3ByaXYpOwogCiAJ
CQkvKiBGSVhNRSB1bmlmeSB0aGlzIGZvciBhbGwgcGxhdGZvcm1zICovCi0JCQlpZiAoIW5ld19j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCQkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0
aXZlICYmCiAJCQkgICAgIUhBU19HTUNIKGRldl9wcml2KSAmJgogCQkJICAgIGRldl9wcml2LT5k
aXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcykKIAkJCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFs
X3dhdGVybWFya3Moc3RhdGUsCkBAIC0xMzgxOSwxMiArMTM4MjMsMTMgQEAgc3RhdGljIHZvaWQg
aW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCQlib29sIG1vZGVzZXQgPSBuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKTsKIAogCQkv
KiBDb21wbGV0ZSBldmVudHMgZm9yIG5vdyBkaXNhYmxlIHBpcGVzIGhlcmUuICovCi0JCWlmICht
b2Rlc2V0ICYmICFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgJiYgbmV3X2NydGNfc3RhdGUt
PmJhc2UuZXZlbnQpIHsKKwkJaWYgKG1vZGVzZXQgJiYgIW5ld19jcnRjX3N0YXRlLT5ody5hY3Rp
dmUgJiYgbmV3X2NydGNfc3RhdGUtPnVhcGkuZXZlbnQpIHsKIAkJCXNwaW5fbG9ja19pcnEoJmRl
di0+ZXZlbnRfbG9jayk7Ci0JCQlkcm1fY3J0Y19zZW5kX3ZibGFua19ldmVudCgmY3J0Yy0+YmFz
ZSwgbmV3X2NydGNfc3RhdGUtPmJhc2UuZXZlbnQpOworCQkJZHJtX2NydGNfc2VuZF92Ymxhbmtf
ZXZlbnQoJmNydGMtPmJhc2UsCisJCQkJCQkgICBuZXdfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCk7
CiAJCQlzcGluX3VubG9ja19pcnEoJmRldi0+ZXZlbnRfbG9jayk7CiAKLQkJCW5ld19jcnRjX3N0
YXRlLT5iYXNlLmV2ZW50ID0gTlVMTDsKKwkJCW5ld19jcnRjX3N0YXRlLT51YXBpLmV2ZW50ID0g
TlVMTDsKIAkJfQogCX0KIApAQCAtMTM4NDksOSArMTM4NTQsOSBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJ
ZHJtX2F0b21pY19oZWxwZXJfd2FpdF9mb3JfZmxpcF9kb25lKGRldiwgJnN0YXRlLT5iYXNlKTsK
IAogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdfY3J0
Y19zdGF0ZSwgaSkgewotCQlpZiAobmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlICYmCisJCWlm
IChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlICYmCiAJCSAgICAhbmVlZHNfbW9kZXNldChuZXdf
Y3J0Y19zdGF0ZSkgJiYKLQkJICAgIChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jb2xvcl9tZ210X2No
YW5nZWQgfHwKKwkJICAgIChuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jb2xvcl9tZ210X2NoYW5nZWQg
fHwKIAkJICAgICBuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpKQogCQkJaW50ZWxfY29sb3Jf
bG9hZF9sdXRzKG5ld19jcnRjX3N0YXRlKTsKIAl9CkBAIC0xNDMzMSwxNiArMTQzMzYsMTYgQEAg
aW50CiBza2xfbWF4X3NjYWxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCSAgICAgIHUzMiBwaXhlbF9mb3JtYXQpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CiAJaW50IG1heF9zY2FsZSwgbXVsdDsKIAlpbnQgY3J0Y19jbG9jaywgbWF4X2RvdGNsaywgdG1w
Y2xrMSwgdG1wY2xrMjsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJaWYgKCFj
cnRjX3N0YXRlLT5ody5lbmFibGUpCiAJCXJldHVybiBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJ
Tkc7CiAKLQljcnRjX2Nsb2NrID0gY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNf
Y2xvY2s7Ci0JbWF4X2RvdGNsayA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5i
YXNlLnN0YXRlKS0+Y2RjbGsubG9naWNhbC5jZGNsazsKKwljcnRjX2Nsb2NrID0gY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCW1heF9kb3RjbGsgPSB0b19pbnRlbF9h
dG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSktPmNkY2xrLmxvZ2ljYWwuY2RjbGs7
CiAKIAlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCkKIAkJbWF4X2RvdGNsayAqPSAyOwpAQCAtMTQzNzgsNyArMTQzODMsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9iZWdpbl9jcnRjX2NvbW1pdChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSwKIAlpZiAobW9kZXNldCkKIAkJZ290byBvdXQ7CiAKLQlpZiAobmV3X2NydGNfc3RhdGUt
PmJhc2UuY29sb3JfbWdtdF9jaGFuZ2VkIHx8CisJaWYgKG5ld19jcnRjX3N0YXRlLT51YXBpLmNv
bG9yX21nbXRfY2hhbmdlZCB8fAogCSAgICBuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpCiAJ
CWludGVsX2NvbG9yX2NvbW1pdChuZXdfY3J0Y19zdGF0ZSk7CiAKQEAgLTE0NDI0LDcgKzE0NDI5
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZmluaXNoX2NydGNfY29tbWl0KHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlLAogCiAJaWYgKG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSAm
JgogCSAgICAhbmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSkgJiYKLQkgICAgb2xkX2NydGNf
c3RhdGUtPmJhc2UubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVE
KQorCSAgICBvbGRfY3J0Y19zdGF0ZS0+aHcubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RF
X0ZMQUdfSU5IRVJJVEVEKQogCQlpbnRlbF9jcnRjX2FybV9maWZvX3VuZGVycnVuKGNydGMsIG5l
d19jcnRjX3N0YXRlKTsKIH0KIApAQCAtMTQ1MzcsNyArMTQ1NDIsNyBAQCBpbnRlbF9sZWdhY3lf
Y3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkgKiBXaGVuIGNydGMgaXMg
aW5hY3RpdmUgb3IgdGhlcmUgaXMgYSBtb2Rlc2V0IHBlbmRpbmcsCiAJICogd2FpdCBmb3IgaXQg
dG8gY29tcGxldGUgaW4gdGhlIHNsb3dwYXRoCiAJICovCi0JaWYgKCFjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSB8fCBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpIHx8CisJaWYgKCFjcnRjX3N0YXRl
LT5ody5hY3RpdmUgfHwgbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKSB8fAogCSAgICBjcnRjX3N0
YXRlLT51cGRhdGVfcGlwZSkKIAkJZ290byBzbG93OwogCkBAIC0xNDYzMiw3ICsxNDYzNyw3IEBA
IGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0X2ZyZWU6CiAJaWYg
KG5ld19jcnRjX3N0YXRlKQotCQlpbnRlbF9jcnRjX2Rlc3Ryb3lfc3RhdGUoY3J0YywgJm5ld19j
cnRjX3N0YXRlLT5iYXNlKTsKKwkJaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlKGNydGMsICZuZXdf
Y3J0Y19zdGF0ZS0+dWFwaSk7CiAJaWYgKHJldCkKIAkJaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0
ZShwbGFuZSwgbmV3X3BsYW5lX3N0YXRlKTsKIAllbHNlCkBAIC0xNDg4NCw3ICsxNDg4OSw3IEBA
IHN0YXRpYyBpbnQgaW50ZWxfY3J0Y19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJCXJldCA9IC1FTk9NRU07CiAJCWdvdG8gZmFpbDsKIAl9
Ci0JX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZpbnRlbF9jcnRjLT5iYXNlLCAmY3J0
Y19zdGF0ZS0+YmFzZSk7CisJX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZpbnRlbF9j
cnRjLT5iYXNlLCAmY3J0Y19zdGF0ZS0+dWFwaSk7CiAJaW50ZWxfY3J0Yy0+Y29uZmlnID0gY3J0
Y19zdGF0ZTsKIAogCXByaW1hcnkgPSBpbnRlbF9wcmltYXJ5X3BsYW5lX2NyZWF0ZShkZXZfcHJp
diwgcGlwZSk7CkBAIC0xNjE5OSw3ICsxNjIwNCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nhbml0
aXplX2NydGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICBJOTE1X1JFQUQocmVnKSAm
IH5QSVBFQ09ORl9GUkFNRV9TVEFSVF9ERUxBWV9NQVNLKTsKIAl9CiAKLQlpZiAoY3J0Y19zdGF0
ZS0+YmFzZS5hY3RpdmUpIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmU7CiAKIAkJLyogRGlzYWJsZSBldmVyeXRoaW5nIGJ1dCB0aGUg
cHJpbWFyeSBwbGFuZSAqLwpAQCAtMTYyMjQsMTAgKzE2MjI5LDEwIEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3Nhbml0aXplX2NydGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAkvKiBBZGp1c3Qg
dGhlIHN0YXRlIG9mIHRoZSBvdXRwdXQgcGlwZSBhY2NvcmRpbmcgdG8gd2hldGhlciB3ZQogCSAq
IGhhdmUgYWN0aXZlIGNvbm5lY3RvcnMvZW5jb2RlcnMuICovCi0JaWYgKGNydGNfc3RhdGUtPmJh
c2UuYWN0aXZlICYmICFpbnRlbF9jcnRjX2hhc19lbmNvZGVycyhjcnRjKSkKKwlpZiAoY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlICYmICFpbnRlbF9jcnRjX2hhc19lbmNvZGVycyhjcnRjKSkKIAkJaW50
ZWxfY3J0Y19kaXNhYmxlX25vYXRvbWljKCZjcnRjLT5iYXNlLCBjdHgpOwogCi0JaWYgKGNydGNf
c3RhdGUtPmJhc2UuYWN0aXZlIHx8IEhBU19HTUNIKGRldl9wcml2KSkgeworCWlmIChjcnRjX3N0
YXRlLT5ody5hY3RpdmUgfHwgSEFTX0dNQ0goZGV2X3ByaXYpKSB7CiAJCS8qCiAJCSAqIFdlIHN0
YXJ0IG91dCB3aXRoIHVuZGVycnVuIHJlcG9ydGluZyBkaXNhYmxlZCB0byBhdm9pZCByYWNlcy4K
IAkJICogRm9yIGNvcnJlY3QgYm9va2tlZXBpbmcgbWFyayB0aGlzIG9uIGFjdGl2ZSBjcnRjcy4K
QEAgLTE2MjU4LDcgKzE2MjYzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2FuaXRpemVfY3J0Yyhz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogc3RhdGljIGJvb2wgaGFzX2JvZ3VzX2RwbGxfY29u
ZmlnKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCiAJLyoKIAkgKiBTb21lIFNOQiBCSU9TZW4g
KGVnLiBBU1VTIEs1M1NWKSBhcmUga25vd24gdG8gbWlzcHJvZ3JhbQpAQCAtMTYyNzEsNyArMTYy
NzYsNyBAQCBzdGF0aWMgYm9vbCBoYXNfYm9ndXNfZHBsbF9jb25maWcoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICogcm9hZC4KIAkgKi8KIAlyZXR1cm4gSVNf
R0VOKGRldl9wcml2LCA2KSAmJgotCQljcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCQljcnRj
X3N0YXRlLT5ody5hY3RpdmUgJiYKIAkJY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwgJiYKIAkJY3J0
Y19zdGF0ZS0+cG9ydF9jbG9jayA9PSAwOwogfQpAQCAtMTYyODgsNyArMTYyOTMsNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9zYW5pdGl6ZV9lbmNvZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyKQogCSAqIGVuY29kZXIgaXMgYWN0aXZlIGFuZCB0cnlpbmcgdG8gcmVhZCBmcm9tIGEgcGlw
ZSkgYW5kIHRoZQogCSAqIHBpcGUgaXRzZWxmIGJlaW5nIGFjdGl2ZS4gKi8KIAlib29sIGhhc19h
Y3RpdmVfY3J0YyA9IGNydGNfc3RhdGUgJiYKLQkJY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJ
CWNydGNfc3RhdGUtPmh3LmFjdGl2ZTsKIAogCWlmIChjcnRjX3N0YXRlICYmIGhhc19ib2d1c19k
cGxsX2NvbmZpZyhjcnRjX3N0YXRlKSkgewogCQlEUk1fREVCVUdfS01TKCJCSU9TIGhhcyBtaXNw
cm9ncmFtbWVkIHRoZSBoYXJkd2FyZS4gRGlzYWJsaW5nIHBpcGUgJWNcbiIsCkBAIC0xNjQyNSwy
MiArMTY0MzAsMjIgQEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRl
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlID0KIAkJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAKLQkJ
X19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX2Rlc3Ryb3lfc3RhdGUoJmNydGNfc3RhdGUtPmJhc2Up
OworCQlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfZGVzdHJveV9zdGF0ZSgmY3J0Y19zdGF0ZS0+
dWFwaSk7CiAJCW1lbXNldChjcnRjX3N0YXRlLCAwLCBzaXplb2YoKmNydGNfc3RhdGUpKTsKLQkJ
X19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZjcnRjLT5iYXNlLCAmY3J0Y19zdGF0ZS0+
YmFzZSk7CisJCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19yZXNldCgmY3J0Yy0+YmFzZSwgJmNy
dGNfc3RhdGUtPnVhcGkpOwogCi0JCWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlID0gY3J0Y19zdGF0
ZS0+YmFzZS5lbmFibGUgPQorCQljcnRjX3N0YXRlLT5ody5hY3RpdmUgPSBjcnRjX3N0YXRlLT5o
dy5lbmFibGUgPQogCQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnKGNydGMsIGNy
dGNfc3RhdGUpOwogCi0JCWNydGMtPmJhc2UuZW5hYmxlZCA9IGNydGNfc3RhdGUtPmJhc2UuZW5h
YmxlOwotCQljcnRjLT5hY3RpdmUgPSBjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZTsKKwkJY3J0Yy0+
YmFzZS5lbmFibGVkID0gY3J0Y19zdGF0ZS0+aHcuZW5hYmxlOworCQljcnRjLT5hY3RpdmUgPSBj
cnRjX3N0YXRlLT5ody5hY3RpdmU7CiAKLQkJaWYgKGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQor
CQlpZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJZGV2X3ByaXYtPmFjdGl2ZV9jcnRjcyB8
PSAxIDw8IGNydGMtPnBpcGU7CiAKIAkJRFJNX0RFQlVHX0tNUygiW0NSVEM6JWQ6JXNdIGh3IHN0
YXRlIHJlYWRvdXQ6ICVzXG4iLAogCQkJICAgICAgY3J0Yy0+YmFzZS5iYXNlLmlkLCBjcnRjLT5i
YXNlLm5hbWUsCi0JCQkgICAgICBlbmFibGVkZGlzYWJsZWQoY3J0Y19zdGF0ZS0+YmFzZS5hY3Rp
dmUpKTsKKwkJCSAgICAgIGVuYWJsZWRkaXNhYmxlZChjcnRjX3N0YXRlLT5ody5hY3RpdmUpKTsK
IAl9CiAKIAlyZWFkb3V0X3BsYW5lX3N0YXRlKGRldl9wcml2KTsKQEAgLTE2NDU1LDcgKzE2NDYw
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYpCiAJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9
CiAJCQkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAotCQkJaWYgKGNy
dGNfc3RhdGUtPmJhc2UuYWN0aXZlICYmCisJCQlpZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlICYm
CiAJCQkgICAgY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwgPT0gcGxsKQogCQkJCXBsbC0+c3RhdGUu
Y3J0Y19tYXNrIHw9IDEgPDwgY3J0Yy0+cGlwZTsKIAkJfQpAQCAtMTY0ODksMjEgKzE2NDk0LDI0
IEBAIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KQogCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5f
aXRlcik7CiAJZm9yX2VhY2hfaW50ZWxfY29ubmVjdG9yX2l0ZXIoY29ubmVjdG9yLCAmY29ubl9p
dGVyKSB7CiAJCWlmIChjb25uZWN0b3ItPmdldF9od19zdGF0ZShjb25uZWN0b3IpKSB7Ci0JCQlj
b25uZWN0b3ItPmJhc2UuZHBtcyA9IERSTV9NT0RFX0RQTVNfT047CisJCQlzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IE5VTEw7CiAKKwkJCWNvbm5lY3Rvci0+YmFzZS5kcG1z
ID0gRFJNX01PREVfRFBNU19PTjsKIAkJCWVuY29kZXIgPSBjb25uZWN0b3ItPmVuY29kZXI7CiAJ
CQljb25uZWN0b3ItPmJhc2UuZW5jb2RlciA9ICZlbmNvZGVyLT5iYXNlOwogCi0JCQlpZiAoZW5j
b2Rlci0+YmFzZS5jcnRjICYmCi0JCQkgICAgZW5jb2Rlci0+YmFzZS5jcnRjLT5zdGF0ZS0+YWN0
aXZlKSB7CisJCQlpZiAoZW5jb2Rlci0+YmFzZS5jcnRjKQorCQkJCWNydGNfc3RhdGUgPSB0b19p
bnRlbF9jcnRjX3N0YXRlKGVuY29kZXItPmJhc2UuY3J0Yy0+c3RhdGUpOworCisJCQlpZiAoY3J0
Y19zdGF0ZSAmJiBjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJCQkvKgogCQkJCSAqIFRoaXMg
aGFzIHRvIGJlIGRvbmUgZHVyaW5nIGhhcmR3YXJlIHJlYWRvdXQKIAkJCQkgKiBiZWNhdXNlIGFu
eXRoaW5nIGNhbGxpbmcgLmNydGNfZGlzYWJsZSBtYXkKIAkJCQkgKiByZWx5IG9uIHRoZSBjb25u
ZWN0b3JfbWFzayBiZWluZyBhY2N1cmF0ZS4KIAkJCQkgKi8KLQkJCQllbmNvZGVyLT5iYXNlLmNy
dGMtPnN0YXRlLT5jb25uZWN0b3JfbWFzayB8PQorCQkJCWNydGNfc3RhdGUtPnVhcGkuY29ubmVj
dG9yX21hc2sgfD0KIAkJCQkJZHJtX2Nvbm5lY3Rvcl9tYXNrKCZjb25uZWN0b3ItPmJhc2UpOwot
CQkJCWVuY29kZXItPmJhc2UuY3J0Yy0+c3RhdGUtPmVuY29kZXJfbWFzayB8PQorCQkJCWNydGNf
c3RhdGUtPnVhcGkuZW5jb2Rlcl9tYXNrIHw9CiAJCQkJCWRybV9lbmNvZGVyX21hc2soJmVuY29k
ZXItPmJhc2UpOwogCQkJfQogCkBAIC0xNjUyNiwxMSArMTY1MzQsMTIgQEAgc3RhdGljIHZvaWQg
aW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJ
CWludCBtaW5fY2RjbGsgPSAwOwogCiAJCW1lbXNldCgmY3J0Yy0+YmFzZS5tb2RlLCAwLCBzaXpl
b2YoY3J0Yy0+YmFzZS5tb2RlKSk7Ci0JCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkgewor
CQlpZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCQlpbnRlbF9tb2RlX2Zyb21fcGlwZV9j
b25maWcoJmNydGMtPmJhc2UubW9kZSwgY3J0Y19zdGF0ZSk7CiAJCQljcnRjLT5iYXNlLm1vZGUu
aGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY193OwogCQkJY3J0Yy0+YmFzZS5tb2RlLnZk
aXNwbGF5ID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaDsKLQkJCWludGVsX21vZGVfZnJvbV9waXBl
X2NvbmZpZygmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLCBjcnRjX3N0YXRlKTsKKwkJ
CWludGVsX21vZGVfZnJvbV9waXBlX2NvbmZpZygmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9k
ZSwKKwkJCQkJCSAgICBjcnRjX3N0YXRlKTsKIAkJCVdBUk5fT04oZHJtX2F0b21pY19zZXRfbW9k
ZV9mb3JfY3J0YyhjcnRjLT5iYXNlLnN0YXRlLCAmY3J0Yy0+YmFzZS5tb2RlKSk7CiAKIAkJCS8q
CkBAIC0xNjU0Miw3ICsxNjU1MSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91
dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQkJICogc2V0IGEgZmxhZyB0byBp
bmRpY2F0ZSB0aGF0IGEgZnVsbCByZWNhbGN1bGF0aW9uIGlzCiAJCQkgKiBuZWVkZWQgb24gdGhl
IG5leHQgY29tbWl0LgogCQkJICovCi0JCQljcnRjX3N0YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9m
bGFncyA9IEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRDsKKwkJCWNydGNfc3RhdGUtPmh3Lm1vZGUu
cHJpdmF0ZV9mbGFncyA9IEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRDsKIAogCQkJaW50ZWxfY3J0
Y19jb21wdXRlX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSk7CiAKQEAgLTE2NTUzLDcgKzE2NTYyLDcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYpCiAJCQl9CiAKIAkJCWRybV9jYWxjX3RpbWVzdGFtcGluZ19jb25zdGFudHMo
JmNydGMtPmJhc2UsCi0JCQkJCQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZSk7CisJ
CQkJCQkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUpOwogCQkJdXBkYXRlX3NjYW5saW5l
X29mZnNldChjcnRjX3N0YXRlKTsKIAkJfQogCkBAIC0xNjcxMyw3ICsxNjcyMiw3IEBAIGludGVs
X21vZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCQlkcm1f
Y3J0Y192YmxhbmtfcmVzZXQoJmNydGMtPmJhc2UpOwogCi0JCWlmIChjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSkKKwkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCWludGVsX2NydGNfdmJs
YW5rX29uKGNydGNfc3RhdGUpOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcC5jCmluZGV4IDQzMzZkZjQ2ZmU3OC4uNGM0ZjdkNmNjMTY3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC0xODczLDcgKzE4NzMsNyBAQCBpbnRlbF9kcF9j
b21wdXRlX2xpbmtfY29uZmlnX3dpZGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkg
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCQkgIGNvbnN0IHN0cnVj
dCBsaW5rX2NvbmZpZ19saW1pdHMgKmxpbWl0cykKIHsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlOwogCWludCBicHAsIGNsb2NrLCBsYW5lX2NvdW50OwogCWludCBtb2RlX3Jh
dGUsIGxpbmtfY2xvY2ssIGxpbmtfYXZhaWw7CiAKQEAgLTE5MjUsNyArMTkyNSw3IEBAIHN0YXRp
YyBpbnQgaW50ZWxfZHBfZHNjX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdf
cG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
KmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRq
dXN0ZWRfbW9kZTsKIAl1OCBkc2NfbWF4X2JwYzsKIAlpbnQgcGlwZV9icHA7CiAJaW50IHJldDsK
QEAgLTIwMjksNyArMjAyOSw3IEBAIGludGVsX2RwX2NvbXB1dGVfbGlua19jb25maWcoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZywKIAkJCSAgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5f
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlw
ZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAlz
dHJ1Y3QgbGlua19jb25maWdfbGltaXRzIGxpbWl0czsKIAlpbnQgY29tbW9uX2xlbjsKQEAgLTIx
MTcsOCArMjExNyw4IEBAIGludGVsX2RwX3ljYmNyNDIwX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLAogewogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9pbmZvICppbmZvID0gJmNv
bm5lY3Rvci0+ZGlzcGxheV9pbmZvOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKLQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
KTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJaW50IHJldDsK
IAogCWlmICghZHJtX21vZGVfaXNfNDIwX29ubHkoaW5mbywgYWRqdXN0ZWRfbW9kZSkgfHwKQEAg
LTIxNDYsNyArMjE0Niw3IEBAIGJvb2wgaW50ZWxfZHBfbGltaXRlZF9jb2xvcl9yYW5nZShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAljb25zdCBzdHJ1Y3QgaW50
ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQogCQl0b19pbnRl
bF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVz
dGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYgKGludGVs
X2Nvbm5fc3RhdGUtPmJyb2FkY2FzdF9yZ2IgPT0gSU5URUxfQlJPQURDQVNUX1JHQl9BVVRPKSB7
CiAJCS8qCkBAIC0yMTY5LDExICsyMTY5LDExIEBAIGludGVsX2RwX2NvbXB1dGVfY29uZmlnKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFk
anVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZl
bmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfbHNwY29uICpsc3Bjb24gPSBlbmNfdG9faW50
ZWxfbHNwY29uKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBv
cnQ7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVf
Y29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9f
aW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICppbnRlbF9jb25uZWN0b3IgPSBpbnRlbF9kcC0+YXR0YWNoZWRfY29ubmVjdG9yOwogCXN0
cnVjdCBpbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZSAqaW50ZWxfY29ubl9zdGF0ZSA9CiAJ
CXRvX2ludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRlKGNvbm5fc3RhdGUpOwpAQCAtMjI4NCw4
ICsyMjg0LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5j
X3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXIt
PnBvcnQ7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29u
ZmlnLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3Rl
ZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOworCWNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaW50ZWxfZHBfc2V0X2xpbmtfcGFyYW1zKGludGVsX2Rw
LCBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jaywKIAkJCQkgcGlwZV9jb25maWctPmxhbmVfY291bnQs
CkBAIC0yODczLDcgKzI4NzMsNyBAQCBzdGF0aWMgdm9pZCBhc3NlcnRfZWRwX3BsbChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgc3RhdGUpCiBzdGF0aWMgdm9pZCBpcm9u
bGFrZV9lZHBfcGxsX29uKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CiAKIAlhc3NlcnRfcGlwZV9kaXNhYmxlZChkZXZfcHJpdiwgY3J0Yy0+cGlwZSk7CkBA
IC0yOTEzLDcgKzI5MTMsNyBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9lZHBfcGxsX29uKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9lZHBfcGxsX29mZihz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
IAogCWFzc2VydF9waXBlX2Rpc2FibGVkKGRldl9wcml2LCBjcnRjLT5waXBlKTsKQEAgLTMwNzMs
NyArMzA3Myw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX2dldF9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19p
bnRlbF9kcCgmZW5jb2Rlci0+YmFzZSk7CiAJdTMyIHRtcCwgZmxhZ3MgPSAwOwogCWVudW0gcG9y
dCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCiAJaWYgKGVuY29k
ZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkKIAkJcGlwZV9jb25maWctPm91dHB1dF90eXBl
cyB8PSBCSVQoSU5URUxfT1VUUFVUX0VEUCk7CkBAIC0zMTA4LDcgKzMxMDgsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9kcF9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CQkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OVlNZTkM7CiAJfQogCi0JcGlwZV9jb25maWctPmJh
c2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKIAogCWlmIChJU19HNFgoZGV2X3ByaXYpICYmIHRtcCAm
IERQX0NPTE9SX1JBTkdFXzE2XzIzNSkKIAkJcGlwZV9jb25maWctPmxpbWl0ZWRfY29sb3JfcmFu
Z2UgPSB0cnVlOwpAQCAtMzEyNSw3ICszMTI1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfZ2V0
X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCXBpcGVfY29uZmlnLT5w
b3J0X2Nsb2NrID0gMjcwMDAwOwogCX0KIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21v
ZGUuY3J0Y19jbG9jayA9CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9j
ayA9CiAJCWludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShwaXBlX2NvbmZpZy0+cG9ydF9jbG9jaywK
IAkJCQkJICZwaXBlX2NvbmZpZy0+ZHBfbV9uKTsKIApAQCAtMzM0MCw3ICszMzQwLDcgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAo
JmVuY29kZXItPmJhc2UpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CiAJdTMyIGRwX3JlZyA9IEk5MTVf
UkVBRChpbnRlbF9kcC0+b3V0cHV0X3JlZyk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBl
OwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwpAQCAtMzQ3MSw3ICszNDcxLDcgQEAgc3RhdGlj
IHZvaWQgdmx2X2luaXRfcGFuZWxfcG93ZXJfc2VxdWVuY2VyKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNf
dG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCiAJbG9ja2Rl
cF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBwc19tdXRleCk7CiAKQEAgLTM5OTQsNyArMzk5NCw3
IEBAIGludGVsX2RwX2xpbmtfZG93bihzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZl
bmNvZGVyLT5iYXNlKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
b2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWVudW0gcG9ydCBwb3J0
ID0gZW5jb2Rlci0+cG9ydDsKIAl1MzIgRFAgPSBpbnRlbF9kcC0+RFA7CiAKQEAgLTQ4MzYsNyAr
NDgzNiw3IEBAIGludCBpbnRlbF9kcF9yZXRyYWluX2xpbmsoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAKIAlXQVJOX09OKCFpbnRlbF9jcnRjX2hhc19kcF9lbmNvZGVyKGNydGNfc3Rh
dGUpKTsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRl
LT5ody5hY3RpdmUpCiAJCXJldHVybiAwOwogCiAJaWYgKGNvbm5fc3RhdGUtPmNvbW1pdCAmJgpA
QCAtNjgzNyw3ICs2ODM3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfc2V0X2RycnNfc3RhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gTlVMTDsK
IAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZGV2X3ByaXYtPmRycnMuZHA7Ci0Jc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBkcnJzX3JlZnJlc2hfcmF0ZV90eXBlIGluZGV4
ID0gRFJSU19ISUdIX1JSOwogCiAJaWYgKHJlZnJlc2hfcmF0ZSA8PSAwKSB7CkBAIC02ODczLDcg
KzY4NzMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9zZXRfZHJyc19zdGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoIWNydGNfc3Rh
dGUtPmJhc2UuYWN0aXZlKSB7CisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJRFJN
X0RFQlVHX0tNUygiZURQIGVuY29kZXIgZGlzYWJsZWQuIENSVEMgbm90IEFjdGl2ZVxuIik7CiAJ
CXJldHVybjsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RwX21zdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3Qu
YwppbmRleCA2MDY1MmViYmRmNjEuLjIzNmJmMDYxNDhhYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5jCkBAIC00MiwxMyArNDIsMTMgQEAgc3RhdGljIGlu
dCBpbnRlbF9kcF9tc3RfY29tcHV0ZV9saW5rX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAkJCQkJICAgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRl
LAogCQkJCQkgICAgc3RydWN0IGxpbmtfY29uZmlnX2xpbWl0cyAqbGltaXRzKQogewotCXN0cnVj
dCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPmJhc2Uuc3RhdGU7CisJc3Ry
dWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZTsKIAlz
dHJ1Y3QgaW50ZWxfZHBfbXN0X2VuY29kZXIgKmludGVsX21zdCA9IGVuY190b19tc3QoJmVuY29k
ZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSAmaW50ZWxfbXN0LT5wcmlt
YXJ5LT5kcDsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPQogCQl0b19pbnRl
bF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVk
X21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXZvaWQgKnBvcnQgPSBj
b25uZWN0b3ItPnBvcnQ7CiAJYm9vbCBjb25zdGFudF9uID0gZHJtX2RwX2hhc19xdWlyaygmaW50
ZWxfZHAtPmRlc2MsCiAJCQkJCSAgIERQX0RQQ0RfUVVJUktfQ09OU1RBTlRfTik7CkBAIC05OSw3
ICs5OSw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9z
dGF0ZSAqaW50ZWxfY29ubl9zdGF0ZSA9CiAJCXRvX2ludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0
YXRlKGNvbm5fc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3Rl
ZF9tb2RlID0KLQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAl2b2lkICpwb3J0ID0gY29ubmVjdG9yLT5wb3J0Owog
CXN0cnVjdCBsaW5rX2NvbmZpZ19saW1pdHMgbGltaXRzOwogCWludCByZXQ7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmMKaW5kZXggN2NjZjdmMzk3NGRi
Li41NDUxMDBhOGM3ZDAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHBpb19waHkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RwaW9fcGh5LmMKQEAgLTc0MSw3ICs3NDEsNyBAQCB2b2lkIGNodl9kYXRhX2xhbmVfc29mdF9y
ZXNldChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIGRw
aW9fY2hhbm5lbCBjaCA9IHZsdl9kcG9ydF90b19jaGFubmVsKGVuY190b19kaWdfcG9ydCgmZW5j
b2Rlci0+YmFzZSkpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+
cGlwZTsKIAl1MzIgdmFsOwogCkBAIC03ODUsNyArNzg1LDcgQEAgdm9pZCBjaHZfcGh5X3ByZV9w
bGxfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBpbnRl
bF9kaWdpdGFsX3BvcnQgKmRwb3J0ID0gZW5jX3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIGRwaW9fY2hhbm5lbCBjaCA9IHZsdl9k
cG9ydF90b19jaGFubmVsKGRwb3J0KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJ
dW5zaWduZWQgaW50IGxhbmVfbWFzayA9CkBAIC04NjYsNyArODY2LDcgQEAgdm9pZCBjaHZfcGh5
X3ByZV9lbmNvZGVyX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsK
IAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVs
X2RwKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIGRwaW9fY2hhbm5lbCBjaCA9
IHZsdl9kcG9ydF90b19jaGFubmVsKGRwb3J0KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBp
cGU7CiAJaW50IGRhdGEsIGksIHN0YWdnZXI7CkBAIC05NTUsNyArOTU1LDcgQEAgdm9pZCBjaHZf
cGh5X3Bvc3RfcGxsX2Rpc2FibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7Ci0JZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5i
YXNlLmNydGMpLT5waXBlOworCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKIAl1MzIgdmFsOwogCiAJdmx2X2RwaW9fZ2V0KGRl
dl9wcml2KTsKQEAgLTEwMTgsNyArMTAxOCw3IEBAIHZvaWQgdmx2X3BoeV9wcmVfcGxsX2VuYWJs
ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICpkcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJh
c2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBkcGlvX2NoYW5uZWwgcG9ydCA9IHZsdl9kcG9ydF90
b19jaGFubmVsKGRwb3J0KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKQEAgLTEw
NDgsNyArMTA0OCw3IEBAIHZvaWQgdmx2X3BoeV9wcmVfZW5jb2Rlcl9lbmFibGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190
b19pbnRlbF9kcCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
ZHBvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJZW51bSBkcGlvX2NoYW5uZWwgcG9ydCA9IHZsdl9kcG9ydF90b19jaGFubmVsKGRwb3J0
KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIHZhbDsKQEAgLTEwNzcsNyAr
MTA3Nyw3IEBAIHZvaWQgdmx2X3BoeV9yZXNldF9sYW5lcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkcG9ydCA9IGVuY190b19k
aWdfcG9ydCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRj
KTsKIAllbnVtIGRwaW9fY2hhbm5lbCBwb3J0ID0gdmx2X2Rwb3J0X3RvX2NoYW5uZWwoZHBvcnQp
OwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsX21nci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcGxsX21nci5jCmluZGV4IDJkNGU3YjlhN2I5ZC4uNGE2ZjQxZTVi
OWRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwbGxf
bWdyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsX21nci5j
CkBAIC0xMzUsNyArMTM1LDcgQEAgdm9pZCBhc3NlcnRfc2hhcmVkX2RwbGwoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogICovCiB2b2lkIGludGVsX3ByZXBhcmVfc2hhcmVkX2Rw
bGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7
CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVh
cGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwgPSBjcnRjX3N0
YXRlLT5zaGFyZWRfZHBsbDsKIApAQCAtMTYyLDcgKzE2Miw3IEBAIHZvaWQgaW50ZWxfcHJlcGFy
ZV9zaGFyZWRfZHBsbChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
ICAqLwogdm9pZCBpbnRlbF9lbmFibGVfc2hhcmVkX2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0
IGludGVsX3NoYXJlZF9kcGxsICpwbGwgPSBjcnRjX3N0YXRlLT5zaGFyZWRfZHBsbDsKIAl1bnNp
Z25lZCBpbnQgY3J0Y19tYXNrID0gZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CkBAIC0yMDcs
NyArMjA3LDcgQEAgdm9pZCBpbnRlbF9lbmFibGVfc2hhcmVkX2RwbGwoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAgKi8KIHZvaWQgaW50ZWxfZGlzYWJsZV9zaGFy
ZWRfZHBsbChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCA9IGNy
dGNfc3RhdGUtPnNoYXJlZF9kcGxsOwogCXVuc2lnbmVkIGludCBjcnRjX21hc2sgPSBkcm1fY3J0
Y19tYXNrKCZjcnRjLT5iYXNlKTsKQEAgLTI0NywxMyArMjQ3LDEzIEBAIGludGVsX2ZpbmRfc2hh
cmVkX2RwbGwoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgICAgICBl
bnVtIGludGVsX2RwbGxfaWQgcmFuZ2VfbWluLAogCQkgICAgICAgZW51bSBpbnRlbF9kcGxsX2lk
IHJhbmdlX21heCkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hh
cmVkX2RwbGwgKnBsbCwgKnVudXNlZF9wbGwgPSBOVUxMOwogCXN0cnVjdCBpbnRlbF9zaGFyZWRf
ZHBsbF9zdGF0ZSAqc2hhcmVkX2RwbGw7CiAJZW51bSBpbnRlbF9kcGxsX2lkIGk7CiAKLQlzaGFy
ZWRfZHBsbCA9IGludGVsX2F0b21pY19nZXRfc2hhcmVkX2RwbGxfc3RhdGUoY3J0Y19zdGF0ZS0+
YmFzZS5zdGF0ZSk7CisJc2hhcmVkX2RwbGwgPSBpbnRlbF9hdG9taWNfZ2V0X3NoYXJlZF9kcGxs
X3N0YXRlKGNydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCiAJZm9yIChpID0gcmFuZ2VfbWluOyBp
IDw9IHJhbmdlX21heDsgaSsrKSB7CiAJCXBsbCA9ICZkZXZfcHJpdi0+c2hhcmVkX2RwbGxzW2ld
OwpAQCAtMjkzLDEwICsyOTMsMTAgQEAgaW50ZWxfcmVmZXJlbmNlX3NoYXJlZF9kcGxsKHN0cnVj
dCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsLAogCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbF9zdGF0ZSAqc2hhcmVk
X2RwbGw7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJY29uc3QgZW51bSBpbnRlbF9kcGxsX2lkIGlkID0g
cGxsLT5pbmZvLT5pZDsKIAotCXNoYXJlZF9kcGxsID0gaW50ZWxfYXRvbWljX2dldF9zaGFyZWRf
ZHBsbF9zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKKwlzaGFyZWRfZHBsbCA9IGludGVs
X2F0b21pY19nZXRfc2hhcmVkX2RwbGxfc3RhdGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CiAK
IAlpZiAoc2hhcmVkX2RwbGxbaWRdLmNydGNfbWFzayA9PSAwKQogCQlzaGFyZWRfZHBsbFtpZF0u
aHdfc3RhdGUgPQpAQCAtNDI1LDcgKzQyNSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfc2hhcmVk
X2RwbGwgKgogaWJ4X2dldF9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCSAgICAgc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGw7CiAJZW51bSBpbnRlbF9k
cGxsX2lkIGk7CkBAIC03OTMsNyArNzkzLDcgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9zaGFyZWRf
ZHBsbCAqaHN3X2RkaV9oZG1pX2dldF9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICoKIHN0
YXRpYyBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKgogaHN3X2RkaV9kcF9nZXRfZHBsbChzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVh
cGkuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbDsKIAllbnVtIGlu
dGVsX2RwbGxfaWQgcGxsX2lkOwogCWludCBjbG9jayA9IGNydGNfc3RhdGUtPnBvcnRfY2xvY2s7
CkBAIC0xNjkzLDcgKzE2OTMsNyBAQCBzdGF0aWMgYm9vbAogYnh0X2RkaV9oZG1pX3BsbF9kaXZp
ZGVycyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgc3RydWN0IGJ4
dF9jbGtfZGl2ICpjbGtfZGl2KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcGxsIGJl
c3RfY2xvY2s7CiAKIAkvKiBDYWxjdWxhdGUgSERNSSBkaXYgKi8KQEAgLTE4MzEsNyArMTgzMSw3
IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKgogYnh0X2dldF9kcGxsKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAgICAgc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3No
YXJlZF9kcGxsICpwbGw7CiAJZW51bSBpbnRlbF9kcGxsX2lkIGlkOwpAQCAtMjIxNyw3ICsyMjE3
LDcgQEAgc3RhdGljIGJvb2wKIGNubF9kZGlfY2FsY3VsYXRlX3dycGxsKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJc3RydWN0IHNrbF93cnBsbF9wYXJhbXMgKndycGxs
X3BhcmFtcykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAl1MzIgYWZl
X2Nsb2NrID0gY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayAqIDU7CiAJdTMyIHJlZl9jbG9jazsKIAl1
MzIgZGNvX21pbiA9IDc5OTgwMDA7CkBAIC0yNDc2LDcgKzI0NzYsNyBAQCBzdGF0aWMgY29uc3Qg
c3RydWN0IHNrbF93cnBsbF9wYXJhbXMgaWNsX3RidF9wbGxfMTlfMk1Iel92YWx1ZXMgPSB7CiBz
dGF0aWMgYm9vbCBpY2xfY2FsY19kcF9jb21ib19wbGwoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCQkJICBzdHJ1Y3Qgc2tsX3dycGxsX3BhcmFtcyAqcGxsX3BhcmFtcykK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3Rh
dGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAljb25zdCBzdHJ1Y3QgaWNs
X2NvbWJvX3BsbF9wYXJhbXMgKnBhcmFtcyA9CiAJCWRldl9wcml2LT5jZGNsay5ody5yZWYgPT0g
MjQwMDAgPwogCQlpY2xfZHBfY29tYm9fcGxsXzI0TUh6X3ZhbHVlcyA6CkBAIC0yNDk4LDcgKzI0
OTgsNyBAQCBzdGF0aWMgYm9vbCBpY2xfY2FsY19kcF9jb21ib19wbGwoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgYm9vbCBpY2xfY2FsY190YnRfcGxsKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICBzdHJ1Y3Qgc2tsX3dycGxs
X3BhcmFtcyAqcGxsX3BhcmFtcykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2
KTsKIAogCSpwbGxfcGFyYW1zID0gZGV2X3ByaXYtPmNkY2xrLmh3LnJlZiA9PSAyNDAwMCA/CiAJ
CQlpY2xfdGJ0X3BsbF8yNE1Iel92YWx1ZXMgOiBpY2xfdGJ0X3BsbF8xOV8yTUh6X3ZhbHVlczsK
QEAgLTI1MDgsNyArMjUwOCw3IEBAIHN0YXRpYyBib29sIGljbF9jYWxjX3RidF9wbGwoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgYm9vbCBpY2xfY2FsY19kcGxs
X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCXN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5k
ZXYpOwogCXUzMiBjZmdjcjAsIGNmZ2NyMTsKIAlzdHJ1Y3Qgc2tsX3dycGxsX3BhcmFtcyBwbGxf
cGFyYW1zID0geyAwIH07CiAJYm9vbCByZXQ7CkBAIC0yNjI5LDcgKzI2MjksNyBAQCBzdGF0aWMg
Ym9vbCBpY2xfbWdfcGxsX2ZpbmRfZGl2aXNvcnMoaW50IGNsb2NrX2toeiwgYm9vbCBpc19kcCwg
Ym9vbCB1c2Vfc3NjLAogICovCiBzdGF0aWMgYm9vbCBpY2xfY2FsY19tZ19wbGxfc3RhdGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51
YXBpLmNydGMtPmRldik7CiAJc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUgKnBsbF9zdGF0ZSA9
ICZjcnRjX3N0YXRlLT5kcGxsX2h3X3N0YXRlOwogCWludCByZWZjbGtfa2h6ID0gZGV2X3ByaXYt
PmNkY2xrLmh3LnJlZjsKIAlpbnQgY2xvY2sgPSBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrOwpAQCAt
Mjc5Niw3ICsyNzk2LDcgQEAgc3RhdGljIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqCiBpY2xf
Z2V0X2RwbGwoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICAgICBzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0
Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydDsKIAlz
dHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbDsKIAllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXIt
PnBvcnQ7CkBAIC0zMzA0LDcgKzMzMDQsNyBAQCBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKgog
aW50ZWxfZ2V0X3NoYXJlZF9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQkgICAgICBzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNf
c3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfZHBsbF9tZ3IgKmRw
bGxfbWdyID0gZGV2X3ByaXYtPmRwbGxfbWdyOwogCiAJaWYgKFdBUk5fT04oIWRwbGxfbWdyKSkK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHZvLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2R2by5jCmluZGV4IDIyNjY2ZDI4ZjRh
YS4uYjY1OTg3ZGJiYWMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2R2by5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHZv
LmMKQEAgLTE3OCw5ICsxNzgsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kdm9fZ2V0X2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAllbHNlCiAJCWZsYWdzIHw9IERSTV9NT0RF
X0ZMQUdfTlZTWU5DOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8
PSBmbGFnczsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsK
IAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IHBpcGVfY29u
ZmlnLT5wb3J0X2Nsb2NrOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xv
Y2sgPSBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jazsKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfZGlz
YWJsZV9kdm8oc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCkBAIC0yMDcsOCArMjA3LDgg
QEAgc3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX2R2byhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAl1MzIgdGVtcCA9IEk5MTVfUkVBRChkdm9fcmVnKTsKIAogCWludGVsX2R2by0+ZGV2
LmRldl9vcHMtPm1vZGVfc2V0KCZpbnRlbF9kdm8tPmRldiwKLQkJCQkJICZwaXBlX2NvbmZpZy0+
YmFzZS5tb2RlLAotCQkJCQkgJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUpOworCQkJ
CQkgJnBpcGVfY29uZmlnLT5ody5tb2RlLAorCQkJCQkgJnBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlKTsKIAogCUk5MTVfV1JJVEUoZHZvX3JlZywgdGVtcCB8IERWT19FTkFCTEUpOwogCUk5
MTVfUkVBRChkdm9fcmVnKTsKQEAgLTI1Myw3ICsyNTMsNyBAQCBzdGF0aWMgaW50IGludGVsX2R2
b19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3Qg
aW50ZWxfZHZvICppbnRlbF9kdm8gPSBlbmNfdG9fZHZvKGVuY29kZXIpOwogCWNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlID0KIAkJaW50ZWxfZHZvLT5hdHRhY2hlZF9j
b25uZWN0b3ItPnBhbmVsLmZpeGVkX21vZGU7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFk
anVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZTsKIAogCS8qCiAJICogSWYgd2UgaGF2ZSB0aW1pbmdzIGZyb20gdGhlIEJJT1MgZm9y
IHRoZSBwYW5lbCwgcHV0IHRoZW0gaW4KQEAgLTI3Nyw4ICsyNzcsOCBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9kdm9fcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkg
Y29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5i
YXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2Rl
ID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOworCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBpbnRlbF9kdm8gKmludGVsX2R2byA9IGVuY190b19kdm8o
ZW5jb2Rlcik7CiAJaW50IHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiBkdm9fdmFsOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKaW5kZXggZDM2Y2FkYTJjYzdkLi5lMmE4
YzI2MmIwNTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZmJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYwpAQCAt
NjY4LDcgKzY2OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2ZiY191cGRhdGVfc3RhdGVfY2FjaGUo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJY2FjaGUtPnZtYSA9IE5VTEw7CiAJY2FjaGUtPmZs
YWdzID0gMDsKIAotCWNhY2hlLT5jcnRjLm1vZGVfZmxhZ3MgPSBjcnRjX3N0YXRlLT5iYXNlLmFk
anVzdGVkX21vZGUuZmxhZ3M7CisJY2FjaGUtPmNydGMubW9kZV9mbGFncyA9IGNydGNfc3RhdGUt
Pmh3LmFkanVzdGVkX21vZGUuZmxhZ3M7CiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElT
X0JST0FEV0VMTChkZXZfcHJpdikpCiAJCWNhY2hlLT5jcnRjLmhzd19iZHdfcGl4ZWxfcmF0ZSA9
IGNydGNfc3RhdGUtPnBpeGVsX3JhdGU7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9oZG1pLmMKaW5kZXggMGViZWM2OWJiYmZjLi43ODFjZmI4MjViZjMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jCkBAIC0yNzksNyArMjc5LDcgQEAgc3Rh
dGljIHZvaWQgaWJ4X3dyaXRlX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIHsKIAljb25zdCB1MzIgKmRhdGEgPSBmcmFtZTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAlpOTE1X3JlZ190IHJlZyA9IFRWSURFT19ESVBfQ1RMKGludGVsX2Ny
dGMtPnBpcGUpOwogCXUzMiB2YWwgPSBJOTE1X1JFQUQocmVnKTsKIAlpbnQgaTsKQEAgLTMxNSw3
ICszMTUsNyBAQCBzdGF0aWMgdm9pZCBpYnhfcmVhZF9pbmZvZnJhbWUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgdm9pZCAqZnJhbWUsIHNzaXplX3QgbGVuKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXUzMiB2YWwsICpkYXRhID0gZnJhbWU7CiAJaW50
IGk7CiAKQEAgLTMzNCw3ICszMzQsNyBAQCBzdGF0aWMgdTMyIGlieF9pbmZvZnJhbWVzX2VuYWJs
ZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICBjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0JZW51bSBwaXBlIHBpcGUg
PSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpLT5waXBlOworCWVudW0gcGlw
ZSBwaXBlID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKS0+cGlwZTsKIAlp
OTE1X3JlZ190IHJlZyA9IFRWSURFT19ESVBfQ1RMKHBpcGUpOwogCXUzMiB2YWwgPSBJOTE1X1JF
QUQocmVnKTsKIApAQCAtMzU2LDcgKzM1Niw3IEBAIHN0YXRpYyB2b2lkIGNwdF93cml0ZV9pbmZv
ZnJhbWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJY29uc3QgdTMyICpkYXRh
ID0gZnJhbWU7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJaTkxNV9y
ZWdfdCByZWcgPSBUVklERU9fRElQX0NUTChpbnRlbF9jcnRjLT5waXBlKTsKIAl1MzIgdmFsID0g
STkxNV9SRUFEKHJlZyk7CiAJaW50IGk7CkBAIC0zOTUsNyArMzk1LDcgQEAgc3RhdGljIHZvaWQg
Y3B0X3JlYWRfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAg
ICAgIHZvaWQgKmZyYW1lLCBzc2l6ZV90IGxlbikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRj
KTsKIAl1MzIgdmFsLCAqZGF0YSA9IGZyYW1lOwogCWludCBpOwogCkBAIC00MTQsNyArNDE0LDcg
QEAgc3RhdGljIHUzMiBjcHRfaW5mb2ZyYW1lc19lbmFibGVkKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29u
ZmlnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhwaXBlX2Nv
bmZpZy0+YmFzZS5jcnRjKS0+cGlwZTsKKwllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2NydGMo
cGlwZV9jb25maWctPnVhcGkuY3J0YyktPnBpcGU7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChUVklE
RU9fRElQX0NUTChwaXBlKSk7CiAKIAlpZiAoKHZhbCAmIFZJREVPX0RJUF9FTkFCTEUpID09IDAp
CkBAIC00MzIsNyArNDMyLDcgQEAgc3RhdGljIHZvaWQgdmx2X3dyaXRlX2luZm9mcmFtZShzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAljb25zdCB1MzIgKmRhdGEgPSBmcmFtZTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlpOTE1X3JlZ190IHJlZyA9
IFZMVl9UVklERU9fRElQX0NUTChpbnRlbF9jcnRjLT5waXBlKTsKIAl1MzIgdmFsID0gSTkxNV9S
RUFEKHJlZyk7CiAJaW50IGk7CkBAIC00NjgsNyArNDY4LDcgQEAgc3RhdGljIHZvaWQgdmx2X3Jl
YWRfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICAgIHZv
aWQgKmZyYW1lLCBzc2l6ZV90IGxlbikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAl1
MzIgdmFsLCAqZGF0YSA9IGZyYW1lOwogCWludCBpOwogCkBAIC00ODcsNyArNDg3LDcgQEAgc3Rh
dGljIHUzMiB2bHZfaW5mb2ZyYW1lc19lbmFibGVkKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+
YmFzZS5jcnRjKS0+cGlwZTsKKwllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2NydGMocGlwZV9j
b25maWctPnVhcGkuY3J0YyktPnBpcGU7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChWTFZfVFZJREVP
X0RJUF9DVEwocGlwZSkpOwogCiAJaWYgKCh2YWwgJiBWSURFT19ESVBfRU5BQkxFKSA9PSAwKQpA
QCAtNzAwLDcgKzcwMCw3IEBAIGludGVsX2hkbWlfY29tcHV0ZV9hdmlfaW5mb2ZyYW1lKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBoZG1pX2F2aV9pbmZvZnJhbWUg
KmZyYW1lID0gJmNydGNfc3RhdGUtPmluZm9mcmFtZXMuYXZpLmF2aTsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFk
anVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0YXRlLT5jb25uZWN0b3I7CiAJaW50IHJl
dDsKIApAQCAtNzg3LDcgKzc4Nyw3IEBAIGludGVsX2hkbWlfY29tcHV0ZV9oZG1pX2luZm9mcmFt
ZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCXJldCA9IGRybV9oZG1pX3ZlbmRv
cl9pbmZvZnJhbWVfZnJvbV9kaXNwbGF5X21vZGUoZnJhbWUsCiAJCQkJCQkJICBjb25uX3N0YXRl
LT5jb25uZWN0b3IsCi0JCQkJCQkJICAmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlKTsK
KwkJCQkJCQkgICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlKTsKIAlpZiAoV0FSTl9PTihy
ZXQpKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTk0OCw3ICs5NDgsNyBAQCBzdGF0aWMgYm9vbCBp
bnRlbF9oZG1pX3NldF9nY3BfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5i
YXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJaTkxNV9yZWdfdCByZWc7CiAKIAlpZiAoKGNy
dGNfc3RhdGUtPmluZm9mcmFtZXMuZW5hYmxlICYKQEAgLTk3Myw3ICs5NzMsNyBAQCB2b2lkIGlu
dGVsX2hkbWlfcmVhZF9nY3BfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5i
YXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT51YXBpLmNydGMpOwogCWk5MTVfcmVnX3QgcmVnOwogCiAJaWYgKChjcnRjX3N0YXRl
LT5pbmZvZnJhbWVzLmVuYWJsZSAmCkBAIC0xMDEwLDcgKzEwMTAsNyBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9oZG1pX2NvbXB1dGVfZ2NwX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAogCS8qIEVuYWJsZSBkZWZhdWx0X3BoYXNlIHdoZW5ldmVyIHRoZSBkaXNwbGF5IG1v
ZGUgaXMgc3VpdGFibHkgYWxpZ25lZCAqLwogCWlmIChnY3BfZGVmYXVsdF9waGFzZV9wb3NzaWJs
ZShjcnRjX3N0YXRlLT5waXBlX2JwcCwKLQkJCQkgICAgICAgJmNydGNfc3RhdGUtPmJhc2UuYWRq
dXN0ZWRfbW9kZSkpCisJCQkJICAgICAgICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlKSkK
IAkJY3J0Y19zdGF0ZS0+aW5mb2ZyYW1lcy5nY3AgfD0gR0NQX0RFRkFVTFRfUEhBU0VfRU5BQkxF
OwogfQogCkBAIC0xMDIwLDcgKzEwMjAsNyBAQCBzdGF0aWMgdm9pZCBpYnhfc2V0X2luZm9mcmFt
ZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGlu
dGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0
Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGln
X3BvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9o
ZG1pICppbnRlbF9oZG1pID0gJmludGVsX2RpZ19wb3J0LT5oZG1pOwogCWk5MTVfcmVnX3QgcmVn
ID0gVFZJREVPX0RJUF9DVEwoaW50ZWxfY3J0Yy0+cGlwZSk7CkBAIC0xMDc5LDcgKzEwNzksNyBA
QCBzdGF0aWMgdm9pZCBjcHRfc2V0X2luZm9mcmFtZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5f
c3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBlbmNfdG9faW50ZWxfaGRtaSgmZW5jb2Rlci0+YmFz
ZSk7CiAJaTkxNV9yZWdfdCByZWcgPSBUVklERU9fRElQX0NUTChpbnRlbF9jcnRjLT5waXBlKTsK
IAl1MzIgdmFsID0gSTkxNV9SRUFEKHJlZyk7CkBAIC0xMTI4LDcgKzExMjgsNyBAQCBzdGF0aWMg
dm9pZCB2bHZfc2V0X2luZm9mcmFtZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5i
YXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX2hk
bWkgKmludGVsX2hkbWkgPSBlbmNfdG9faW50ZWxfaGRtaSgmZW5jb2Rlci0+YmFzZSk7CiAJaTkx
NV9yZWdfdCByZWcgPSBWTFZfVFZJREVPX0RJUF9DVEwoaW50ZWxfY3J0Yy0+cGlwZSk7CiAJdTMy
IHZhbCA9IEk5MTVfUkVBRChyZWcpOwpAQCAtMTcyMSw5ICsxNzIxLDkgQEAgc3RhdGljIHZvaWQg
aW50ZWxfaGRtaV9wcmVwYXJlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBlbmNvZGVyLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJ
c3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBlbmNfdG9faW50ZWxfaGRtaSgmZW5jb2Rl
ci0+YmFzZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PSAmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7
CiAJdTMyIGhkbWlfdmFsOwogCiAJaW50ZWxfZHBfZHVhbF9tb2RlX3NldF90bWRzX291dHB1dChp
bnRlbF9oZG1pLCB0cnVlKTsKQEAgLTE4MTQsNyArMTgxNCw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2hkbWlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkgICAgdG1w
ICYgSERNSV9DT0xPUl9SQU5HRV8xNl8yMzUpCiAJCXBpcGVfY29uZmlnLT5saW1pdGVkX2NvbG9y
X3JhbmdlID0gdHJ1ZTsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3Mg
fD0gZmxhZ3M7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gZmxhZ3M7
CiAKIAlpZiAoKHRtcCAmIFNEVk9fQ09MT1JfRk9STUFUX01BU0spID09IEhETUlfQ09MT1JfRk9S
TUFUXzEyYnBjKQogCQlkb3RjbG9jayA9IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrICogMiAvIDM7
CkBAIC0xODI0LDcgKzE4MjQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX2dldF9jb25maWco
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaWYgKHBpcGVfY29uZmlnLT5waXhlbF9t
dWx0aXBsaWVyKQogCQlkb3RjbG9jayAvPSBwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcjsK
IAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IGRvdGNsb2Nr
OworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9jazsK
IAogCXBpcGVfY29uZmlnLT5sYW5lX2NvdW50ID0gNDsKIApAQCAtMTg0NSw3ICsxODQ1LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX2hkbWlfYXVkaW8oc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZywKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3Rh
dGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29u
ZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAogCVdBUk5fT04oIXBpcGVfY29uZmlnLT5oYXNf
aGRtaV9zaW5rKTsKIAlEUk1fREVCVUdfRFJJVkVSKCJFbmFibGluZyBIRE1JIGF1ZGlvIG9uIHBp
cGUgJWNcbiIsCkBAIC0xOTMxLDcgKzE5MzEsNyBAQCBzdGF0aWMgdm9pZCBjcHRfZW5hYmxlX2hk
bWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IGVuY29kZXItPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCXN0cnVjdCBpbnRlbF9o
ZG1pICppbnRlbF9oZG1pID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXItPmJhc2UpOwogCWVu
dW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgdGVtcDsKQEAgLTE5OTUsNyArMTk5NSw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVfaGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9o
ZG1pKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9k
aWdfcG9ydCA9CiAJCWhkbWlfdG9fZGlnX3BvcnQoaW50ZWxfaGRtaSk7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMpOwor
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjKTsKIAl1MzIgdGVtcDsKIAogCXRlbXAgPSBJOTE1X1JFQUQoaW50ZWxfaGRtaS0+
aGRtaV9yZWcpOwpAQCAtMjE5MywxMiArMjE5MywxMiBAQCBzdGF0aWMgYm9vbCBoZG1pX2RlZXBf
Y29sb3JfcG9zc2libGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJCQkJICAgICBpbnQgYnBjKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9Ci0JCXRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwotCXN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPmJhc2Uuc3RhdGU7CisJCXRvX2k5MTUo
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpz
dGF0ZSA9IGNydGNfc3RhdGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5lY3Rvcl9zdGF0ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwog
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNf
c3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGU7CiAJaW50IGk7CiAKIAlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpKQpAQCAtMjIyMyw3ICsyMjIz
LDcgQEAgc3RhdGljIGJvb2wgaGRtaV9kZWVwX2NvbG9yX3Bvc3NpYmxlKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5f
c3RhdGUoc3RhdGUsIGNvbm5lY3RvciwgY29ubmVjdG9yX3N0YXRlLCBpKSB7CiAJCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9pbmZvICppbmZvID0gJmNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvOwog
Ci0JCWlmIChjb25uZWN0b3Jfc3RhdGUtPmNydGMgIT0gY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKQor
CQlpZiAoY29ubmVjdG9yX3N0YXRlLT5jcnRjICE9IGNydGNfc3RhdGUtPnVhcGkuY3J0YykKIAkJ
CWNvbnRpbnVlOwogCiAJCWlmIChjcnRjX3N0YXRlLT5vdXRwdXRfZm9ybWF0ID09IElOVEVMX09V
VFBVVF9GT1JNQVRfWUNCQ1I0MjApIHsKQEAgLTIyNjYsNyArMjI2Niw3IEBAIGludGVsX2hkbWlf
eWNiY3I0MjBfY29uZmlnKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJCQkgICBp
bnQgKmNsb2NrXzEyYnBjLCBpbnQgKmNsb2NrXzEwYnBjLAogCQkJICAgaW50ICpjbG9ja184YnBj
KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0Yyhjb25m
aWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRl
bF9jcnRjKGNvbmZpZy0+dWFwaS5jcnRjKTsKIAogCWlmICghY29ubmVjdG9yLT55Y2Jjcl80MjBf
YWxsb3dlZCkgewogCQlEUk1fRVJST1IoIlBsYXRmb3JtIGRvZXNuJ3Qgc3VwcG9ydCBZQ0JDUjQy
MCBvdXRwdXRcbiIpOwpAQCAtMjI5OCwxMiArMjI5OCwxMiBAQCBpbnQgaW50ZWxfaGRtaV9jb21w
dXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaW50
ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBl
X2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0YXRlLT5jb25uZWN0b3I7CiAJc3RydWN0
IGRybV9zY2RjICpzY2RjID0gJmNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLmhkbWkuc2NkYzsKIAlz
dHJ1Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQog
CQl0b19pbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKLQlpbnQgY2xv
Y2tfOGJwYyA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKwlp
bnQgY2xvY2tfOGJwYyA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7
CiAJaW50IGNsb2NrXzEwYnBjID0gY2xvY2tfOGJwYyAqIDUgLyA0OwogCWludCBjbG9ja18xMmJw
YyA9IGNsb2NrXzhicGMgKiAzIC8gMjsKIAlpbnQgZGVzaXJlZF9icHA7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2xzcGNvbi5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9sc3Bjb24uYwppbmRleCA3MDI4ZDBjZjNiYjEuLjZjYTNm
MjJkMDU1MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9s
c3Bjb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2xzcGNvbi5j
CkBAIC0xODksNyArMTg5LDcgQEAgdm9pZCBsc3Bjb25feWNiY3I0MjBfY29uZmlnKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiB7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X2lu
Zm8gKmluZm8gPSAmY29ubmVjdG9yLT5kaXNwbGF5X2luZm87CiAJY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1
c3RlZF9tb2RlOworCQkJCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCWlmIChk
cm1fbW9kZV9pc180MjBfb25seShpbmZvLCBhZGp1c3RlZF9tb2RlKSAmJgogCSAgICBjb25uZWN0
b3ItPnljYmNyXzQyMF9hbGxvd2VkKSB7CkBAIC00NzUsNyArNDc1LDcgQEAgdm9pZCBsc3Bjb25f
c2V0X2luZm9mcmFtZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJh
c2UpOwogCXN0cnVjdCBpbnRlbF9sc3Bjb24gKmxzcGNvbiA9ICZkaWdfcG9ydC0+bHNwY29uOwog
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNf
c3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGU7CiAKIAlpZiAoIWxzcGNvbi0+YWN0aXZlKSB7CiAJCURSTV9FUlJPUigiV3JpdGluZyBpbmZv
ZnJhbWVzIHdoaWxlIExTUENPTiBkaXNhYmxlZCA/XG4iKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHZkcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9sdmRzLmMKaW5kZXggZWZlZmVkNjJhN2Y4Li43YjExM2RjN2Q4YTYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHZkcy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHZkcy5jCkBAIC0xMzUsNyArMTM1
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbHZkc19nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCWVsc2UKIAkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19QVlNZTkM7CiAK
LQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOworCXBpcGVf
Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPCA1KQogCQlwaXBlX2NvbmZpZy0+Z21jaF9wZml0Lmx2ZHNfYm9yZGVyX2Jp
dHMgPQpAQCAtMTQ4LDcgKzE0OCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2x2ZHNfZ2V0X2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJcGlwZV9jb25maWctPmdtY2hfcGZp
dC5jb250cm9sIHw9IHRtcCAmIFBBTkVMXzhUTzZfRElUSEVSX0VOQUJMRTsKIAl9CiAKLQlwaXBl
X2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBwaXBlX2NvbmZpZy0+cG9y
dF9jbG9jazsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gcGlw
ZV9jb25maWctPnBvcnRfY2xvY2s7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2x2ZHNfcHBzX2dl
dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0yMzAsOCAr
MjMwLDggQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJlX2VuYWJsZV9sdmRzKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBpbnRlbF9sdmRzX2VuY29kZXIgKmx2ZHNfZW5j
b2RlciA9IHRvX2x2ZHNfZW5jb2RlcigmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMp
OwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOworCWNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9t
b2RlOwogCWludCBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgdGVtcDsKIApAQCAtMzk0LDggKzM5
NCw4IEBAIHN0YXRpYyBpbnQgaW50ZWxfbHZkc19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqaW50ZWxfZW5jb2RlciwKIAkJdG9fbHZkc19lbmNvZGVyKCZpbnRlbF9lbmNvZGVy
LT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IgPQogCQls
dmRzX2VuY29kZXItPmF0dGFjaGVkX2Nvbm5lY3RvcjsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOwotCXN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZw
aXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxf
Y3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CiAJdW5zaWduZWQg
aW50IGx2ZHNfYnBwOwogCiAJLyogU2hvdWxkIG5ldmVyIGhhcHBlbiEhICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMKaW5kZXggMzlkNzQyMDk0MDY1Li41Y2Q1
MzhlODRiZjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
cGFuZWwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMK
QEAgLTE3OCw3ICsxNzgsNyBAQCBpbnRlbF9wY2hfcGFuZWxfZml0dGluZyhzdHJ1Y3QgaW50ZWxf
Y3J0YyAqaW50ZWxfY3J0YywKIAkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZywKIAkJCWludCBmaXR0aW5nX21vZGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgeCA9IDAsIHkgPSAwLCB3aWR0aCA9IDAsIGhlaWdo
dCA9IDA7CiAKIAkvKiBOYXRpdmUgbW9kZXMgZG9uJ3QgbmVlZCBmaXR0aW5nICovCkBAIC0zMDAs
NyArMzAwLDcgQEAgc3RhdGljIGlubGluZSB1MzIgcGFuZWxfZml0dGVyX3NjYWxpbmcodTMyIHNv
dXJjZSwgdTMyIHRhcmdldCkKIHN0YXRpYyB2b2lkIGk5NjVfc2NhbGVfYXNwZWN0KHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCSAgICAgIHUzMiAqcGZpdF9jb250cm9s
KQogewotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBp
cGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJ
dTMyIHNjYWxlZF93aWR0aCA9IGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXkgKgogCQlwaXBl
X2NvbmZpZy0+cGlwZV9zcmNfaDsKIAl1MzIgc2NhbGVkX2hlaWdodCA9IHBpcGVfY29uZmlnLT5w
aXBlX3NyY193ICoKQEAgLTMyMSw3ICszMjEsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3NjYWxlX2Fz
cGVjdChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgICB1MzIg
KnBmaXRfY29udHJvbCwgdTMyICpwZml0X3BnbV9yYXRpb3MsCiAJCQkgICAgICB1MzIgKmJvcmRl
cikKIHsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2Nv
bmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBzY2FsZWRf
d2lkdGggPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5ICoKIAkJcGlwZV9jb25maWctPnBp
cGVfc3JjX2g7CiAJdTMyIHNjYWxlZF9oZWlnaHQgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdyAq
CkBAIC0zODAsNyArMzgwLDcgQEAgdm9pZCBpbnRlbF9nbWNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7CiAJdTMyIHBmaXRfY29udHJv
bCA9IDAsIHBmaXRfcGdtX3JhdGlvcyA9IDAsIGJvcmRlciA9IDA7Ci0Jc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9k
ZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCS8qIE5hdGl2ZSBtb2RlcyBkb24ndCBuZWVkIGZpdHRp
bmcgKi8KIAlpZiAoYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheSA9PSBwaXBlX2NvbmZpZy0+
cGlwZV9zcmNfdyAmJgpAQCAtMTA0Nyw3ICsxMDQ3LDcgQEAgc3RhdGljIHZvaWQgdmx2X2VuYWJs
ZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
c3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNv
bm5fc3RhdGUtPmNvbm5lY3Rvcik7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGFuZWwgKnBh
bmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0JZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0YyktPnBpcGU7CisJZW51bSBwaXBlIHBpcGUgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0YyktPnBpcGU7CiAJdTMyIGN0bCwgY3RsMjsKIAog
CWN0bDIgPSBJOTE1X1JFQUQoVkxWX0JMQ19QV01fQ1RMMihwaXBlKSk7CkBAIC0xMDc3LDcgKzEw
NzcsNyBAQCBzdGF0aWMgdm9pZCBieHRfZW5hYmxlX2JhY2tsaWdodChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25u
ZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5k
ZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwgPSAmY29ubmVjdG9yLT5wYW5lbDsKLQll
bnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKS0+cGlw
ZTsKKwllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRj
KS0+cGlwZTsKIAl1MzIgcHdtX2N0bCwgdmFsOwogCiAJLyogQ29udHJvbGxlciAxIHVzZXMgdGhl
IHV0aWxpdHkgcGluLiAqLwpAQCAtMTE4OSw3ICsxMTg5LDcgQEAgdm9pZCBpbnRlbF9wYW5lbF9l
bmFibGVfYmFja2xpZ2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rv
cihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVs
ICpwYW5lbCA9ICZjb25uZWN0b3ItPnBhbmVsOwotCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpLT5waXBlOworCWVudW0gcGlwZSBwaXBlID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOwogCiAJaWYgKCFwYW5lbC0+
YmFja2xpZ2h0LnByZXNlbnQpCiAJCXJldHVybjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGlwZV9jcmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcGlwZV9jcmMuYwppbmRleCAxZTJjNDMwN2QwNWEuLmJkNTM3ZmM5NmM3NCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9waXBlX2NyYy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGlwZV9jcmMuYwpAQCAt
MzA5LDEzICszMDksMTMgQEAgaW50ZWxfY3J0Y19jcmNfc2V0dXBfd29ya2Fyb3VuZHMoc3RydWN0
IGludGVsX2NydGMgKmNydGMsIGJvb2wgZW5hYmxlKQogCQlnb3RvIHB1dF9zdGF0ZTsKIAl9CiAK
LQlwaXBlX2NvbmZpZy0+YmFzZS5tb2RlX2NoYW5nZWQgPSBwaXBlX2NvbmZpZy0+aGFzX3BzcjsK
KwlwaXBlX2NvbmZpZy0+dWFwaS5tb2RlX2NoYW5nZWQgPSBwaXBlX2NvbmZpZy0+aGFzX3BzcjsK
IAlwaXBlX2NvbmZpZy0+Y3JjX2VuYWJsZWQgPSBlbmFibGU7CiAKIAlpZiAoSVNfSEFTV0VMTChk
ZXZfcHJpdikgJiYKLQkgICAgcGlwZV9jb25maWctPmJhc2UuYWN0aXZlICYmIGNydGMtPnBpcGUg
PT0gUElQRV9BICYmCisJICAgIHBpcGVfY29uZmlnLT5ody5hY3RpdmUgJiYgY3J0Yy0+cGlwZSA9
PSBQSVBFX0EgJiYKIAkgICAgcGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09E
RVJfRURQKQotCQlwaXBlX2NvbmZpZy0+YmFzZS5tb2RlX2NoYW5nZWQgPSB0cnVlOworCQlwaXBl
X2NvbmZpZy0+dWFwaS5tb2RlX2NoYW5nZWQgPSB0cnVlOwogCiAJcmV0ID0gZHJtX2F0b21pY19j
b21taXQoc3RhdGUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3Bzci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpp
bmRleCA2OWQ5MDhlNmEwNTAuLjEzM2Q5NWE3MmFjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Bzci5jCkBAIC01MzcsOCArNTM3LDggQEAgc3RhdGljIGJvb2wgaW50ZWxf
cHNyMl9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0JaW50IGNydGNfaGRpc3Bs
YXkgPSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxheTsKLQlpbnQg
Y3J0Y192ZGlzcGxheSA9IGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNw
bGF5OworCWludCBjcnRjX2hkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX2hkaXNwbGF5OworCWludCBjcnRjX3ZkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwogCWludCBwc3JfbWF4X2ggPSAwLCBwc3JfbWF4X3YgPSAw
OwogCiAJaWYgKCFkZXZfcHJpdi0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0KQpAQCAtNTk1LDcgKzU5
NSw3IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdf
cG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBf
dG9faTkxNShpbnRlbF9kcCk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19z
dGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgcHNyX3NldHVwX3RpbWU7CiAKIAlpZiAoIUNB
Tl9QU1IoZGV2X3ByaXYpKQpAQCAtNzMyLDcgKzczMiw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bz
cl9lbmFibGVfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCWRl
dl9wcml2LT5wc3IucHNyMl9lbmFibGVkID0gaW50ZWxfcHNyMl9lbmFibGVkKGRldl9wcml2LCBj
cnRjX3N0YXRlKTsKIAlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyA9IDA7Ci0J
ZGV2X3ByaXYtPnBzci5waXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMp
LT5waXBlOworCWRldl9wcml2LT5wc3IucGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjKS0+cGlwZTsKIAogCURSTV9ERUJVR19LTVMoIkVuYWJsaW5nIFBTUiVzXG4iLAog
CQkgICAgICBkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CkBAIC05NDYs
NyArOTQ2LDcgQEAgdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsCiBpbnQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm5ld19jcnRjX3N0YXRlLAogCQkJICAgIHUzMiAqb3V0X3ZhbHVlKQogewotCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAKIAlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCB8
fCAhbmV3X2NydGNfc3RhdGUtPmhhc19wc3IpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Nkdm8uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfc2R2by5jCmluZGV4IGNlZGEwM2U1YTNkNC4uMzcyOGNhYjBmMWQzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nkdm8uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nkdm8uYwpAQCAtMTA1OSw3ICsxMDU5LDcgQEAg
c3RhdGljIGJvb2wgaW50ZWxfc2R2b19jb21wdXRlX2F2aV9pbmZvZnJhbWUoc3RydWN0IGludGVs
X3Nkdm8gKmludGVsX3Nkdm8sCiB7CiAJc3RydWN0IGhkbWlfYXZpX2luZm9mcmFtZSAqZnJhbWUg
PSAmY3J0Y19zdGF0ZS0+aW5mb2ZyYW1lcy5hdmkuYXZpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IHJldDsKIAogCWlm
ICghY3J0Y19zdGF0ZS0+aGFzX2hkbWlfc2luaykKQEAgLTEyNDgsOCArMTI0OCw4IEBAIHN0YXRp
YyBpbnQgaW50ZWxfc2R2b19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJdG9faW50ZWxfc2R2b19jb25uZWN0b3Jfc3RhdGUoY29ubl9zdGF0ZSk7CiAJc3Ry
dWN0IGludGVsX3Nkdm9fY29ubmVjdG9yICppbnRlbF9zZHZvX2Nvbm5lY3RvciA9CiAJCXRvX2lu
dGVsX3Nkdm9fY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0Jc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFz
ZS5tb2RlOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVf
Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2Rl
ID0gJnBpcGVfY29uZmlnLT5ody5tb2RlOwogCiAJRFJNX0RFQlVHX0tNUygiZm9yY2luZyBicGMg
dG8gOCBmb3IgU0RWT1xuIik7CiAJcGlwZV9jb25maWctPnBpcGVfYnBwID0gOCozOwpAQCAtMTQw
MSwxMyArMTQwMSwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX3ByZV9lbmFibGUoc3RydWN0
IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIsCiAJCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2VuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQlj
b25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRl
LT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKmFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlj
b25zdCBzdHJ1Y3QgaW50ZWxfc2R2b19jb25uZWN0b3Jfc3RhdGUgKnNkdm9fc3RhdGUgPQogCQl0
b19pbnRlbF9zZHZvX2Nvbm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3Qg
aW50ZWxfc2R2b19jb25uZWN0b3IgKmludGVsX3Nkdm9fY29ubmVjdG9yID0KIAkJdG9faW50ZWxf
c2R2b19jb25uZWN0b3IoY29ubl9zdGF0ZS0+Y29ubmVjdG9yKTsKLQljb25zdCBzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZjcnRjX3N0YXRlLT5iYXNlLm1vZGU7CisJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPSAmY3J0Y19zdGF0ZS0+aHcubW9kZTsKIAlzdHJ1
Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2byA9IHRvX3Nkdm8oaW50ZWxfZW5jb2Rlcik7CiAJdTMy
IHNkdm94OwogCXN0cnVjdCBpbnRlbF9zZHZvX2luX291dF9tYXAgaW5fb3V0OwpAQCAtMTYwMSw3
ICsxNjAxLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2b19nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCQkJZmxhZ3MgfD0gRFJNX01PREVfRkxBR19OVlNZTkM7CiAJ
fQogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKKwlw
aXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKIAogCS8qCiAJICog
cGl4ZWwgbXVsdGlwbGllciByZWFkb3V0IGlzIHRyaWNreTogT25seSBvbiBpOTE1Zy9nbSBpdCBp
cyBzdG9yZWQgaW4KQEAgLTE2MjEsNyArMTYyMSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nkdm9f
Z2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlpZiAocGlwZV9jb25m
aWctPnBpeGVsX211bHRpcGxpZXIpCiAJCWRvdGNsb2NrIC89IHBpcGVfY29uZmlnLT5waXhlbF9t
dWx0aXBsaWVyOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2Nr
ID0gZG90Y2xvY2s7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9
IGRvdGNsb2NrOwogCiAJLyogQ3Jvc3MgY2hlY2sgdGhlIHBvcnQgcGl4ZWwgbXVsdGlwbGllciB3
aXRoIHRoZSBzZHZvIGVuY29kZXIgc3RhdGUuICovCiAJaWYgKGludGVsX3Nkdm9fZ2V0X3ZhbHVl
KGludGVsX3Nkdm8sIFNEVk9fQ01EX0dFVF9DTE9DS19SQVRFX01VTFQsCkBAIC0xNjczLDcgKzE2
NzMsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX2VuYWJsZV9hdWRpbyhzdHJ1Y3QgaW50ZWxf
c2R2byAqaW50ZWxfc2R2bywKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19z
dGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
ID0gY29ubl9zdGF0ZS0+Y29ubmVjdG9yOwogCXU4ICplbGQgPSBjb25uZWN0b3ItPmVsZDsKIApA
QCAtMTY5NSw3ICsxNjk1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9zZHZvKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9zZHZv
ICppbnRlbF9zZHZvID0gdG9fc2R2byhlbmNvZGVyKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMp
OwogCXUzMiB0ZW1wOwogCiAJaWYgKG9sZF9jcnRjX3N0YXRlLT5oYXNfYXVkaW8pCkBAIC0xNzU3
LDcgKzE3NTcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9lbmFibGVfc2R2byhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gZW5jb2Rlci0+YmFz
ZS5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYp
OwogCXN0cnVjdCBpbnRlbF9zZHZvICppbnRlbF9zZHZvID0gdG9fc2R2byhlbmNvZGVyKTsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWct
PmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9j
cnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCXUzMiB0ZW1wOwogCWJvb2wgaW5wdXQxLCBp
bnB1dDI7CiAJaW50IGk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJp
dGUuYwppbmRleCAwMDRiNTIwMjdhZTguLjcxNTc4NDllMmI3ZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC05Myw5ICs5Myw5IEBAIGludCBpbnRl
bF91c2Vjc190b19zY2FubGluZXMoY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUsCiAgKi8KIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfc3RhcnQoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21v
ZGUgPSAmbmV3X2NydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZuZXdfY3J0Y19zdGF0ZS0+aHcuYWRq
dXN0ZWRfbW9kZTsKIAlsb25nIHRpbWVvdXQgPSBtc2Vjc190b19qaWZmaWVzX3RpbWVvdXQoMSk7
CiAJaW50IHNjYW5saW5lLCBtaW4sIG1heCwgdmJsYW5rX3N0YXJ0OwogCXdhaXRfcXVldWVfaGVh
ZF90ICp3cSA9IGRybV9jcnRjX3ZibGFua193YWl0cXVldWUoJmNydGMtPmJhc2UpOwpAQCAtMjAy
LDcgKzIwMiw3IEBAIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfc3RhcnQoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogICovCiB2b2lkIGludGVsX3BpcGVfdXBk
YXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiB7Ci0Jc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT5iYXNl
LmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJaW50
IHNjYW5saW5lX2VuZCA9IGludGVsX2dldF9jcnRjX3NjYW5saW5lKGNydGMpOwogCXUzMiBlbmRf
dmJsX2NvdW50ID0gaW50ZWxfY3J0Y19nZXRfdmJsYW5rX2NvdW50ZXIoY3J0Yyk7CkBAIC0yMTUs
MTQgKzIxNSwxNSBAQCB2b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJICogV291bGQgYmUgc2xpZ2h0bHkgbmljZSB0byBq
dXN0IGdyYWIgdGhlIHZibGFuayBjb3VudCBhbmQgYXJtIHRoZQogCSAqIGV2ZW50IG91dHNpZGUg
b2YgdGhlIGNyaXRpY2FsIHNlY3Rpb24gLSB0aGUgc3BpbmxvY2sgbWlnaHQgc3BpbiBmb3IgYQog
CSAqIHdoaWxlIC4uLiAqLwotCWlmIChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudCkgeworCWlm
IChuZXdfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCkgewogCQlXQVJOX09OKGRybV9jcnRjX3ZibGFu
a19nZXQoJmNydGMtPmJhc2UpICE9IDApOwogCiAJCXNwaW5fbG9jaygmY3J0Yy0+YmFzZS5kZXYt
PmV2ZW50X2xvY2spOwotCQlkcm1fY3J0Y19hcm1fdmJsYW5rX2V2ZW50KCZjcnRjLT5iYXNlLCBu
ZXdfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudCk7CisJCWRybV9jcnRjX2FybV92YmxhbmtfZXZlbnQo
JmNydGMtPmJhc2UsCisJCQkJICAgICAgICAgIG5ld19jcnRjX3N0YXRlLT51YXBpLmV2ZW50KTsK
IAkJc3Bpbl91bmxvY2soJmNydGMtPmJhc2UuZGV2LT5ldmVudF9sb2NrKTsKIAotCQluZXdfY3J0
Y19zdGF0ZS0+YmFzZS5ldmVudCA9IE5VTEw7CisJCW5ld19jcnRjX3N0YXRlLT51YXBpLmV2ZW50
ID0gTlVMTDsKIAl9CiAKIAlsb2NhbF9pcnFfZW5hYmxlKCk7CkBAIC0xMzQ5LDcgKzEzNTAsNyBA
QCBnNHhfc3ByaXRlX2NoZWNrX3NjYWxpbmcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpkc3QgPSAmcGxhbmVfc3RhdGUtPmJhc2Uu
ZHN0OwogCWludCBzcmNfeCwgc3JjX3ksIHNyY193LCBzcmNfaCwgY3J0Y193LCBjcnRjX2g7CiAJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19z
dGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9k
ZTsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmItPmZvcm1hdC0+Y3BwWzBdOwogCXVuc2lnbmVkIGlu
dCB3aWR0aF9ieXRlczsKIAlpbnQgbWluX3dpZHRoLCBtaW5faGVpZ2h0OwpAQCAtMTQyMiw3ICsx
NDIzLDcgQEAgZzR4X3Nwcml0ZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAl9CiAKIAlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZSgm
cGxhbmVfc3RhdGUtPmJhc2UsCi0JCQkJCQkgICZjcnRjX3N0YXRlLT5iYXNlLAorCQkJCQkJICAm
Y3J0Y19zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgbWluX3NjYWxlLCBtYXhfc2NhbGUsCiAJCQkJCQkg
IHRydWUsIHRydWUpOwogCWlmIChyZXQpCkBAIC0xNDc5LDcgKzE0ODAsNyBAQCB2bHZfc3ByaXRl
X2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlyZXR1cm4gcmV0
OwogCiAJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0
YXRlLT5iYXNlLAotCQkJCQkJICAmY3J0Y19zdGF0ZS0+YmFzZSwKKwkJCQkJCSAgJmNydGNfc3Rh
dGUtPnVhcGksCiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJCSAg
RFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLAogCQkJCQkJICB0cnVlLCB0cnVlKTsKQEAgLTE1
NjMsOCArMTU2NCw4IEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrX2ZiKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCX0KIAogCS8qIFktdGlsaW5nIGlzIG5v
dCBzdXBwb3J0ZWQgaW4gSUYtSUQgSW50ZXJsYWNlIG1vZGUgKi8KLQlpZiAoY3J0Y19zdGF0ZS0+
YmFzZS5lbmFibGUgJiYKLQkgICAgY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdz
ICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UgJiYKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZW5hYmxl
ICYmCisJICAgIGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSAmJgogCSAgICAoZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9Z
X1RJTEVEIHx8CiAJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVE
IHx8CiAJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTIHx8
CkBAIC0xNjQ0LDcgKzE2NDUsNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVjayhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAl9CiAKIAlyZXQgPSBkcm1fYXRvbWljX2hl
bHBlcl9jaGVja19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UsCi0JCQkJCQkgICZjcnRj
X3N0YXRlLT5iYXNlLAorCQkJCQkJICAmY3J0Y19zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgbWluX3Nj
YWxlLCBtYXhfc2NhbGUsCiAJCQkJCQkgIHRydWUsIHRydWUpOwogCWlmIChyZXQpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3R2LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3R2LmMKaW5kZXggMGE5NWRmNmM2YTU3Li42YjgxMDMy
ZThmMTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdHYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3R2LmMKQEAgLTkyNCw3
ICs5MjQsNyBAQCBpbnRlbF9lbmFibGVfdHYoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAKIAkvKiBQcmV2ZW50cyB2Ymxhbmsgd2FpdHMgZnJvbSB0aW1pbmcgb3V0IGluIGludGVsX3R2
X2RldGVjdF90eXBlKCkgKi8KIAlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsCi0JCQkg
ICAgICB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpLT5waXBlKTsKKwkJCSAg
ICAgIHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0YyktPnBpcGUpOwogCiAJSTkx
NV9XUklURShUVl9DVEwsIEk5MTVfUkVBRChUVl9DVEwpIHwgVFZfRU5DX0VOQUJMRSk7CiB9CkBA
IC0xMDg2LDcgKzEwODYsNyBAQCBpbnRlbF90dl9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0KLQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSBtb2Rl
ID0ge307CiAJdTMyIHR2X2N0bCwgaGN0bDEsIGhjdGwzLCB2Y3RsMSwgdmN0bDIsIHRtcDsKIAlz
dHJ1Y3QgdHZfbW9kZSB0dl9tb2RlID0ge307CkBAIC0xMTg5LDcgKzExODksNyBAQCBpbnRlbF90
dl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJdG9faW50
ZWxfdHZfY29ubmVjdG9yX3N0YXRlKGNvbm5fc3RhdGUpOwogCWNvbnN0IHN0cnVjdCB0dl9tb2Rl
ICp0dl9tb2RlID0gaW50ZWxfdHZfbW9kZV9maW5kKGNvbm5fc3RhdGUpOwogCXN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVz
dGVkX21vZGU7CisJCSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgaGRpc3Bs
YXkgPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5OwogCWludCB2ZGlzcGxheSA9IGFkanVz
dGVkX21vZGUtPmNydGNfdmRpc3BsYXk7CiAKQEAgLTE0MTgsNyArMTQxOCw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX3R2X3ByZV9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CQkJY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVf
Y29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9f
aW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfdHYgKmlu
dGVsX3R2ID0gZW5jX3RvX3R2KGVuY29kZXIpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF90dl9jb25u
ZWN0b3Jfc3RhdGUgKnR2X2Nvbm5fc3RhdGUgPQogCQl0b19pbnRlbF90dl9jb25uZWN0b3Jfc3Rh
dGUoY29ubl9zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3Zkc2MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmRzYy5j
CmluZGV4IGZmZWM4MDdiODk2MC4uNDE5YTc3NzIzODk0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Zkc2MuYwpAQCAtMzI5LDggKzMyOSw4IEBAIGludCBpbnRlbF9kcF9j
b21wdXRlX2RzY19wYXJhbXMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpbnQgY29sdW1u
X2luZGV4ID0gMDsKIAl1OCBsaW5lX2J1Zl9kZXB0aCA9IDA7CiAKLQl2ZHNjX2NmZy0+cGljX3dp
ZHRoID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OwotCXZk
c2NfY2ZnLT5waWNfaGVpZ2h0ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRj
X3ZkaXNwbGF5OworCXZkc2NfY2ZnLT5waWNfd2lkdGggPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OworCXZkc2NfY2ZnLT5waWNfaGVpZ2h0ID0gcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheTsKIAl2ZHNjX2NmZy0+c2xpY2Vfd2lk
dGggPSBESVZfUk9VTkRfVVAodmRzY19jZmctPnBpY193aWR0aCwKIAkJCQkJICAgICBwaXBlX2Nv
bmZpZy0+ZHNjX3BhcmFtcy5zbGljZV9jb3VudCk7CiAJLyoKQEAgLTQ3Nyw3ICs0NzcsNyBAQCBp
bnRlbF9kc2NfcG93ZXJfZG9tYWluKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogc3RhdGljIHZvaWQgaW50ZWxfY29uZmlndXJlX3Bwc19mb3JfZHNjX2VuY29kZXIo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCQljb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlj
b25zdCBzdHJ1Y3QgZHJtX2RzY19jb25maWcgKnZkc2NfY2ZnID0gJmNydGNfc3RhdGUtPmRwX2Rz
Y19jZmc7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtODk2LDcgKzg5Niw3IEBA
IHN0YXRpYyB2b2lkIGludGVsX2RwX3dyaXRlX2RzY19wcHNfc2RwKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogdm9pZCBpbnRlbF9kc2NfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNy
dGMtPnBpcGU7CiAJaTkxNV9yZWdfdCBkc3NfY3RsMV9yZWcsIGRzc19jdGwyX3JlZzsKQEAgLTkz
Miw3ICs5MzIsNyBAQCB2b2lkIGludGVsX2RzY19lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAKIHZvaWQgaW50ZWxfZHNjX2Rpc2FibGUoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWk5MTVfcmVnX3QgZHNzX2N0bDFf
cmVnLCBkc3NfY3RsMl9yZWc7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L3Zsdl9kc2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jCmlu
ZGV4IGUyNzJkODI2MjEwYS4uMGZmZGYwZjZjYWE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L3Zsdl9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L3Zsdl9kc2kuYwpAQCAtMjcwLDkgKzI3MCw5IEBAIHN0YXRpYyBpbnQgaW50ZWxfZHNpX2Nv
bXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBpbnRl
bF9kc2kgKmludGVsX2RzaSA9IGNvbnRhaW5lcl9vZihlbmNvZGVyLCBzdHJ1Y3QgaW50ZWxfZHNp
LAogCQkJCQkJICAgYmFzZSk7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVj
dG9yID0gaW50ZWxfZHNpLT5hdHRhY2hlZF9jb25uZWN0b3I7Ci0Jc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsK
IAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqZml4ZWRfbW9kZSA9IGludGVsX2Nvbm5l
Y3Rvci0+cGFuZWwuZml4ZWRfbW9kZTsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0
ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9t
b2RlOwogCWludCByZXQ7CiAKIAlEUk1fREVCVUdfS01TKCJcbiIpOwpAQCAtNjUyLDcgKzY1Miw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9wb3J0X2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAkJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBpbnRlbF9kc2kgKmlu
dGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBw
b3J0OwogCkBAIC03NzQsNyArNzc0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX3ByZV9lbmFi
bGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJIGNvbnN0IHN0cnVjdCBkcm1f
Y29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVs
X2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwotCXN0cnVjdCBkcm1fY3J0
YyAqY3J0YyA9IHBpcGVfY29uZmlnLT5iYXNlLmNydGM7CisJc3RydWN0IGRybV9jcnRjICpjcnRj
ID0gcGlwZV9jb25maWctPnVhcGkuY3J0YzsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2Ny
dGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwogCWludCBwaXBlID0gaW50ZWxfY3J0Yy0+cGlwZTsK
QEAgLTEwNjAsOSArMTA2MCw5IEBAIHN0YXRpYyB2b2lkIGJ4dF9kc2lfZ2V0X3BpcGVfY29uZmln
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBlbmNvZGVyLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PQotCQkJCQkmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCQkJJnBpcGVfY29u
ZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3Rl
ZF9tb2RlX3N3OwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBl
X2NvbmZpZy0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxf
ZHNpID0gZW5jX3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJdW5zaWduZWQgaW50IGxh
bmVfY291bnQgPSBpbnRlbF9kc2ktPmxhbmVfY291bnQ7CiAJdW5zaWduZWQgaW50IGJwcCwgZm10
OwpAQCAtMTA3Myw3ICsxMDczLDcgQEAgc3RhdGljIHZvaWQgYnh0X2RzaV9nZXRfcGlwZV9jb25m
aWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJY3J0Y19oYmxhbmtfc3RhcnRf
c3csIGNydGNfaGJsYW5rX2VuZF9zdzsKIAogCS8qIEZJWE1FOiBodyByZWFkb3V0IHNob3VsZCBu
b3QgZGVwZW5kIG9uIFNXIHN0YXRlICovCi0JYWRqdXN0ZWRfbW9kZV9zdyA9ICZjcnRjLT5jb25m
aWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlhZGp1c3RlZF9tb2RlX3N3ID0gJmNydGMtPmNvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCS8qCiAJICogQXRsZWFzdCBvbmUgcG9ydCBpcyBhY3Rp
dmUgYXMgZW5jb2Rlci0+Z2V0X2NvbmZpZyBjYWxsZWQgb25seSBpZgpAQCAtMTIzMiw3ICsxMjMy
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHNpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJfQogCiAJaWYgKHBjbGspIHsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRq
dXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gcGNsazsKKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y19jbG9jayA9IHBjbGs7CiAJCXBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrID0gcGNs
azsKIAl9CiB9CkBAIC0xMzQzLDkgKzEzNDMsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcHJl
cGFyZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlciwKIAlzdHJ1Y3QgZHJtX2Vu
Y29kZXIgKmVuY29kZXIgPSAmaW50ZWxfZW5jb2Rlci0+YmFzZTsKIAlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gZW5jb2Rlci0+ZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2lu
dGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCXN0cnVj
dCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koZW5jb2Rlcik7Ci0JY29u
c3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAllbnVtIHBvcnQg
cG9ydDsKIAl1bnNpZ25lZCBpbnQgYnBwID0gbWlwaV9kc2lfcGl4ZWxfZm9ybWF0X3RvX2JwcChp
bnRlbF9kc2ktPnBpeGVsX2Zvcm1hdCk7CiAJdTMyIHZhbCwgdG1wOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2RlYnVnZnMuYwppbmRleCA2MmNmMzRkYjkyODAuLmQ0ODMzN2UzMmQwYyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTI4MjcsMTEgKzI4MjcsMTEgQEAgc3RhdGljIGlu
dCBpOTE1X2Rpc3BsYXlfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIAog
CQlzZXFfcHJpbnRmKG0sICJDUlRDICVkOiBwaXBlOiAlYywgYWN0aXZlPSVzLCAoc2l6ZT0lZHgl
ZCksIGRpdGhlcj0lcywgYnBwPSVkXG4iLAogCQkJICAgY3J0Yy0+YmFzZS5iYXNlLmlkLCBwaXBl
X25hbWUoY3J0Yy0+cGlwZSksCi0JCQkgICB5ZXNubyhwaXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUp
LAorCQkJICAgeWVzbm8ocGlwZV9jb25maWctPmh3LmFjdGl2ZSksCiAJCQkgICBwaXBlX2NvbmZp
Zy0+cGlwZV9zcmNfdywgcGlwZV9jb25maWctPnBpcGVfc3JjX2gsCiAJCQkgICB5ZXNubyhwaXBl
X2NvbmZpZy0+ZGl0aGVyKSwgcGlwZV9jb25maWctPnBpcGVfYnBwKTsKIAotCQlpZiAocGlwZV9j
b25maWctPmJhc2UuYWN0aXZlKSB7CisJCWlmIChwaXBlX2NvbmZpZy0+aHcuYWN0aXZlKSB7CiAJ
CQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmN1cnNvciA9CiAJCQkJdG9faW50ZWxfcGxhbmUoY3J0Yy0+
YmFzZS5jdXJzb3IpOwogCkBAIC00MjU2LDExICs0MjU2LDExIEBAIHN0YXRpYyBpbnQgaTkxNV9k
cnJzX2N0bF9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAogCQljcnRjX3N0YXRlID0gdG9faW50
ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAotCQlpZiAoIWNydGNfc3RhdGUtPmJh
c2UuYWN0aXZlIHx8CisJCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlIHx8CiAJCSAgICAhY3J0
Y19zdGF0ZS0+aGFzX2RycnMpCiAJCQlnb3RvIG91dDsKIAotCQljb21taXQgPSBjcnRjX3N0YXRl
LT5iYXNlLmNvbW1pdDsKKwkJY29tbWl0ID0gY3J0Y19zdGF0ZS0+dWFwaS5jb21taXQ7CiAJCWlm
IChjb21taXQpIHsKIAkJCXJldCA9IHdhaXRfZm9yX2NvbXBsZXRpb25faW50ZXJydXB0aWJsZSgm
Y29tbWl0LT5od19kb25lKTsKIAkJCWlmIChyZXQpCkBAIC00MjcyLDcgKzQyNzIsNyBAQCBzdGF0
aWMgaW50IGk5MTVfZHJyc19jdGxfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCiAJCQlzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAkJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHA7CiAK
LQkJCWlmICghKGNydGNfc3RhdGUtPmJhc2UuY29ubmVjdG9yX21hc2sgJgorCQkJaWYgKCEoY3J0
Y19zdGF0ZS0+dWFwaS5jb25uZWN0b3JfbWFzayAmCiAJCQkgICAgICBkcm1fY29ubmVjdG9yX21h
c2soY29ubmVjdG9yKSkpCiAJCQkJY29udGludWU7CiAKQEAgLTQzMzEsMTQgKzQzMzEsMTQgQEAg
aTkxNV9maWZvX3VuZGVycnVuX3Jlc2V0X3dyaXRlKHN0cnVjdCBmaWxlICpmaWxwLAogCQkJcmV0
dXJuIHJldDsKIAogCQljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShpbnRlbF9jcnRj
LT5iYXNlLnN0YXRlKTsKLQkJY29tbWl0ID0gY3J0Y19zdGF0ZS0+YmFzZS5jb21taXQ7CisJCWNv
bW1pdCA9IGNydGNfc3RhdGUtPnVhcGkuY29tbWl0OwogCQlpZiAoY29tbWl0KSB7CiAJCQlyZXQg
PSB3YWl0X2Zvcl9jb21wbGV0aW9uX2ludGVycnVwdGlibGUoJmNvbW1pdC0+aHdfZG9uZSk7CiAJ
CQlpZiAoIXJldCkKIAkJCQlyZXQgPSB3YWl0X2Zvcl9jb21wbGV0aW9uX2ludGVycnVwdGlibGUo
JmNvbW1pdC0+ZmxpcF9kb25lKTsKIAkJfQogCi0JCWlmICghcmV0ICYmIGNydGNfc3RhdGUtPmJh
c2UuYWN0aXZlKSB7CisJCWlmICghcmV0ICYmIGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQkJ
RFJNX0RFQlVHX0tNUygiUmUtYXJtaW5nIEZJRk8gdW5kZXJydW5zIG9uIHBpcGUgJWNcbiIsCiAJ
CQkJICAgICAgcGlwZV9uYW1lKGludGVsX2NydGMtPnBpcGUpKTsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9kcnYuaAppbmRleCAxZDU4ZjdlYzVkODQuLjJhMzllYzczMjE4MSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZHJ2LmgKQEAgLTcxMyw3ICs3MTMsMzEgQEAgZW51bSBpbnRlbF9vdXRwdXRfZm9ybWF0
IHsKIH07CiAKIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlIHsKLQlzdHJ1Y3QgZHJtX2NydGNfc3Rh
dGUgYmFzZTsKKwl1bmlvbiB7CisJLyoKKwkgKiB1YXBpIChkcm0pIHN0YXRlLiBUaGlzIGlzIHRo
ZSBzb2Z0d2FyZSBzdGF0ZSBzaG93biB0byB1c2Vyc3BhY2UuCisJICogSW4gcGFydGljdWxhciwg
dGhlIGZvbGxvd2luZyBtZW1iZXJzIGFyZSB1c2VkIGZvciBib29ra2VlcGluZzoKKwkgKiAtIGNy
dGMKKwkgKiAtIHN0YXRlCisJICogLSAqX2NoYW5nZWQKKwkgKiAtIGV2ZW50CisJICogLSBjb21t
aXQKKwkgKiAtIG1vZGVfYmxvYgorCSAqLworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSB1YXBpOwor
CisJLyoKKwkgKiBhY3R1YWwgaGFyZHdhcmUgc3RhdGUsIHRoZSBzdGF0ZSB3ZSBwcm9ncmFtIHRv
IHRoZSBoYXJkd2FyZS4KKwkgKiBUaGUgZm9sbG93aW5nIG1lbWJlcnMgYXJlIHVzZWQgdG8gdmVy
aWZ5IHRoZSBoYXJkd2FyZSBzdGF0ZToKKwkgKiAtIGVuYWJsZQorCSAqIC0gYWN0aXZlCisJICog
LSBtb2RlIC8gYWRqdXN0ZWRfbW9kZQorCSAqIC0gY29sb3IgcHJvcGVydHkgYmxvYnMuCisJICoK
KwkgKiBEdXJpbmcgaW5pdGlhbCBodyByZWFkb3V0LCB0aGV5IG5lZWQgdG8gYmUgY29waWVkIHRv
IHVhcGkuCisJICovCisJc3RydWN0IGRybV9jcnRjX3N0YXRlIGh3OworCX07CiAKIAkvKioKIAkg
KiBxdWlya3MgLSBiaXRmaWVsZCB3aXRoIGh3IHN0YXRlIHJlYWRvdXQgcXVpcmtzCkBAIC0xMDQ2
LDcgKzEwNzAsNyBAQCBzdHJ1Y3QgY3hzcl9sYXRlbmN5IHsKIAogI2RlZmluZSB0b19pbnRlbF9h
dG9taWNfc3RhdGUoeCkgY29udGFpbmVyX29mKHgsIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUs
IGJhc2UpCiAjZGVmaW5lIHRvX2ludGVsX2NydGMoeCkgY29udGFpbmVyX29mKHgsIHN0cnVjdCBp
bnRlbF9jcnRjLCBiYXNlKQotI2RlZmluZSB0b19pbnRlbF9jcnRjX3N0YXRlKHgpIGNvbnRhaW5l
cl9vZih4LCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSwgYmFzZSkKKyNkZWZpbmUgdG9faW50ZWxf
Y3J0Y19zdGF0ZSh4KSBjb250YWluZXJfb2YoeCwgc3RydWN0IGludGVsX2NydGNfc3RhdGUsIHVh
cGkpCiAjZGVmaW5lIHRvX2ludGVsX2Nvbm5lY3Rvcih4KSBjb250YWluZXJfb2YoeCwgc3RydWN0
IGludGVsX2Nvbm5lY3RvciwgYmFzZSkKICNkZWZpbmUgdG9faW50ZWxfZW5jb2Rlcih4KSBjb250
YWluZXJfb2YoeCwgc3RydWN0IGludGVsX2VuY29kZXIsIGJhc2UpCiAjZGVmaW5lIHRvX2ludGVs
X2ZyYW1lYnVmZmVyKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIs
IGJhc2UpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCBhZmEwNjlmMGRjNzAuLjMwOGNlNmIz
ZjkxYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC00ODMsNyArNDgzLDcgQEAgc3RhdGlj
IGNvbnN0IGludCBwZXNzaW1hbF9sYXRlbmN5X25zID0gNTAwMDsKIAogc3RhdGljIHZvaWQgdmx2
X2dldF9maWZvX3NpemUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0J
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IHZsdl9maWZvX3N0YXRlICpmaWZvX3N0YXRl
ID0gJmNydGNfc3RhdGUtPndtLnZsdi5maWZvX3N0YXRlOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKQEAgLTgxNyw3ICs4MTcsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF93bV9wbGFuZV92
aXNpYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7CiAKIAkvKiBGSVhNRSBjaGVjayB0aGUgJ2VuYWJsZScgaW5zdGVhZCAqLwotCWlmICgh
Y3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJ
CXJldHVybiBmYWxzZTsKIAogCS8qCkBAIC04NzAsNyArODcwLDcgQEAgc3RhdGljIHZvaWQgcGlu
ZXZpZXdfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAljcnRjID0g
c2luZ2xlX2VuYWJsZWRfY3J0YyhkZXZfcHJpdik7CiAJaWYgKGNydGMpIHsKIAkJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmNydGMtPmNvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGMtPmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsK
IAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJY3J0Yy0+YmFzZS5wcmlt
YXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CkBAIC0xMTA2
LDcgKzExMDYsNyBAQCBzdGF0aWMgdTE2IGc0eF9jb21wdXRlX3dtKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0
b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJh
c2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJdW5z
aWduZWQgaW50IGxhdGVuY3kgPSBkZXZfcHJpdi0+d20ucHJpX2xhdGVuY3lbbGV2ZWxdICogMTA7
CiAJdW5zaWduZWQgaW50IGNsb2NrLCBodG90YWwsIGNwcCwgd2lkdGgsIHdtOwogCkBAIC0xMTY2
LDcgKzExNjYsNyBAQCBzdGF0aWMgdTE2IGc0eF9jb21wdXRlX3dtKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIGJvb2wgZzR4X3Jhd19wbGFuZV93bV9z
ZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJIGludCBsZXZlbCwg
ZW51bSBwbGFuZV9pZCBwbGFuZV9pZCwgdTE2IHZhbHVlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjLT5kZXYpOwogCWJvb2wgZGlydHkgPSBmYWxzZTsKIAogCWZvciAoOyBsZXZlbCA8
IGludGVsX3dtX251bV9sZXZlbHMoZGV2X3ByaXYpOyBsZXZlbCsrKSB7CkBAIC0xMTgyLDcgKzEx
ODIsNyBAQCBzdGF0aWMgYm9vbCBnNHhfcmF3X3BsYW5lX3dtX3NldChzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyBib29sIGc0eF9yYXdfZmJjX3dtX3NldChzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgICBpbnQgbGV2ZWwsIHUx
NiB2YWx1ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlib29sIGRp
cnR5ID0gZmFsc2U7CiAKIAkvKiBOT1JNQUwgbGV2ZWwgZG9lc24ndCBoYXZlIGFuIEZCQyB3YXRl
cm1hcmsgKi8KQEAgLTEyODQsNyArMTI4NCw3IEBAIHN0YXRpYyBib29sIGc0eF9yYXdfcGxhbmVf
d21faXNfdmFsaWQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBz
dGF0aWMgYm9vbCBnNHhfcmF3X2NydGNfd21faXNfdmFsaWQoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgICBpbnQgbGV2ZWwpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMt
PmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
X3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAlpZiAobGV2ZWwgPiBkZXZfcHJpdi0+d20ubWF4
X2xldmVsKQogCQlyZXR1cm4gZmFsc2U7CkBAIC0xMzIyLDkgKzEzMjIsOSBAQCBzdGF0aWMgdm9p
ZCBnNHhfaW52YWxpZGF0ZV93bXMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIHN0YXRpYyBp
bnQgZzR4X2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKKwkJ
dG9faW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCXN0cnVjdCBn
NHhfd21fc3RhdGUgKndtX3N0YXRlID0gJmNydGNfc3RhdGUtPndtLmc0eC5vcHRpbWFsOwogCWlu
dCBudW1fYWN0aXZlX3BsYW5lcyA9IGh3ZWlnaHQzMihjcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVz
ICYKIAkJCQkJICB+QklUKFBMQU5FX0NVUlNPUikpOwpAQCAtMTQxMSwxNyArMTQxMSwxNyBAQCBz
dGF0aWMgaW50IGc0eF9jb21wdXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiAKIHN0YXRpYyBpbnQgZzR4X2NvbXB1dGVfaW50ZXJtZWRpYXRlX3dtKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT51YXBp
LmNydGMpOwogCXN0cnVjdCBnNHhfd21fc3RhdGUgKmludGVybWVkaWF0ZSA9ICZuZXdfY3J0Y19z
dGF0ZS0+d20uZzR4LmludGVybWVkaWF0ZTsKIAljb25zdCBzdHJ1Y3QgZzR4X3dtX3N0YXRlICpv
cHRpbWFsID0gJm5ld19jcnRjX3N0YXRlLT53bS5nNHgub3B0aW1hbDsKIAlzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdf
Y3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdfY3J0
Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9s
ZF9jcnRjX3N0YXRlID0KIAkJaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShpbnRlbF9z
dGF0ZSwgY3J0Yyk7CiAJY29uc3Qgc3RydWN0IGc0eF93bV9zdGF0ZSAqYWN0aXZlID0gJm9sZF9j
cnRjX3N0YXRlLT53bS5nNHgub3B0aW1hbDsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkOwogCi0J
aWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwgZHJtX2F0b21pY19jcnRjX25lZWRz
X21vZGVzZXQoJm5ld19jcnRjX3N0YXRlLT5iYXNlKSkgeworCWlmICghbmV3X2NydGNfc3RhdGUt
Pmh3LmFjdGl2ZSB8fCBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2NydGNfc3Rh
dGUtPnVhcGkpKSB7CiAJCSppbnRlcm1lZGlhdGUgPSAqb3B0aW1hbDsKIAogCQlpbnRlcm1lZGlh
dGUtPmN4c3IgPSBmYWxzZTsKQEAgLTE1NTMsOCArMTU1Myw4IEBAIHN0YXRpYyB2b2lkIGc0eF9w
cm9ncmFtX3dhdGVybWFya3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogc3Rh
dGljIHZvaWQgZzR4X2luaXRpYWxfd2F0ZXJtYXJrcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSwKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUt
PmJhc2UuY3J0Yy0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAog
CW11dGV4X2xvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CiAJY3J0Yy0+d20uYWN0aXZlLmc0
eCA9IGNydGNfc3RhdGUtPndtLmc0eC5pbnRlcm1lZGlhdGU7CkBAIC0xNTY1LDggKzE1NjUsOCBA
QCBzdGF0aWMgdm9pZCBnNHhfaW5pdGlhbF93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlLAogc3RhdGljIHZvaWQgZzR4X29wdGltaXplX3dhdGVybWFya3Moc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRj
ICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjLT5kZXYpOworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCiAJaWYgKCFjcnRjX3N0YXRlLT53bS5uZWVk
X3Bvc3R2YmxfdXBkYXRlKQogCQlyZXR1cm47CkBAIC0xNjE1LDcgKzE2MTUsNyBAQCBzdGF0aWMg
dTE2IHZsdl9jb21wdXRlX3dtX2xldmVsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9k
ZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJdW5zaWduZWQgaW50IGNsb2Nr
LCBodG90YWwsIGNwcCwgd2lkdGgsIHdtOwogCiAJaWYgKGRldl9wcml2LT53bS5wcmlfbGF0ZW5j
eVtsZXZlbF0gPT0gMCkKQEAgLTE2NTMsNyArMTY1Myw3IEBAIHN0YXRpYyBib29sIHZsdl9uZWVk
X3Nwcml0ZTBfZmlmb193b3JrYXJvdW5kKHVuc2lnbmVkIGludCBhY3RpdmVfcGxhbmVzKQogCiBz
dGF0aWMgaW50IHZsdl9jb21wdXRlX2ZpZm8oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJY29uc3Qgc3RydWN0IGc0eF9waXBlX3dtICpy
YXcgPQogCQkmY3J0Y19zdGF0ZS0+d20udmx2LnJhd1tWTFZfV01fTEVWRUxfUE0yXTsKIAlzdHJ1
Y3Qgdmx2X2ZpZm9fc3RhdGUgKmZpZm9fc3RhdGUgPSAmY3J0Y19zdGF0ZS0+d20udmx2LmZpZm9f
c3RhdGU7CkBAIC0xNzY1LDcgKzE3NjUsNyBAQCBzdGF0aWMgdTE2IHZsdl9pbnZlcnRfd21fdmFs
dWUodTE2IHdtLCB1MTYgZmlmb19zaXplKQogc3RhdGljIGJvb2wgdmx2X3Jhd19wbGFuZV93bV9z
ZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJIGludCBsZXZlbCwg
ZW51bSBwbGFuZV9pZCBwbGFuZV9pZCwgdTE2IHZhbHVlKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjLT5kZXYpOwogCWludCBudW1fbGV2ZWxzID0gaW50ZWxfd21fbnVtX2xldmVscyhk
ZXZfcHJpdik7CiAJYm9vbCBkaXJ0eSA9IGZhbHNlOwogCkBAIC0xODQwLDE2ICsxODQwLDE2IEBA
IHN0YXRpYyBib29sIHZsdl9yYXdfY3J0Y193bV9pc192YWxpZChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIGludCB2bHZfY29tcHV0ZV9waXBlX3dt
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0KLQkJdG9faW50ZWxf
YXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCQl0b19pbnRlbF9hdG9taWNf
c3RhdGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CiAJc3RydWN0IHZsdl93bV9zdGF0ZSAqd21f
c3RhdGUgPSAmY3J0Y19zdGF0ZS0+d20udmx2Lm9wdGltYWw7CiAJY29uc3Qgc3RydWN0IHZsdl9m
aWZvX3N0YXRlICpmaWZvX3N0YXRlID0KIAkJJmNydGNfc3RhdGUtPndtLnZsdi5maWZvX3N0YXRl
OwogCWludCBudW1fYWN0aXZlX3BsYW5lcyA9IGh3ZWlnaHQzMihjcnRjX3N0YXRlLT5hY3RpdmVf
cGxhbmVzICYKIAkJCQkJICB+QklUKFBMQU5FX0NVUlNPUikpOwotCWJvb2wgbmVlZHNfbW9kZXNl
dCA9IGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZjcnRjX3N0YXRlLT5iYXNlKTsKKwli
b29sIG5lZWRzX21vZGVzZXQgPSBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19z
dGF0ZS0+dWFwaSk7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVf
c3RhdGU7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpuZXdfcGxhbmVfc3RhdGU7
CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKQEAgLTE5NDgsNyArMTk0OCw3IEBAIHN0YXRp
YyBpbnQgdmx2X2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHN0YXRpYyB2b2lkIHZsdl9hdG9taWNfdXBkYXRlX2ZpZm8oc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3VuY29yZSAq
dW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CiAJY29uc3Qgc3RydWN0IHZsdl9maWZvX3N0YXRl
ICpmaWZvX3N0YXRlID0KQEAgLTIwNDQsMTcgKzIwNDQsMTcgQEAgc3RhdGljIHZvaWQgdmx2X2F0
b21pY191cGRhdGVfZmlmbyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAogc3Rh
dGljIGludCB2bHZfY29tcHV0ZV9pbnRlcm1lZGlhdGVfd20oc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IHZsdl93bV9zdGF0ZSAqaW50ZXJtZWRpYXRlID0gJm5ld19jcnRjX3N0YXRlLT53bS52bHYuaW50
ZXJtZWRpYXRlOwogCWNvbnN0IHN0cnVjdCB2bHZfd21fc3RhdGUgKm9wdGltYWwgPSAmbmV3X2Ny
dGNfc3RhdGUtPndtLnZsdi5vcHRpbWFsOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmlu
dGVsX3N0YXRlID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19jcnRjX3N0YXRlLT5iYXNl
LnN0YXRlKTsKKwkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19jcnRjX3N0YXRlLT51YXBpLnN0
YXRlKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUgPQog
CQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKGludGVsX3N0YXRlLCBjcnRjKTsKIAlj
b25zdCBzdHJ1Y3Qgdmx2X3dtX3N0YXRlICphY3RpdmUgPSAmb2xkX2NydGNfc3RhdGUtPndtLnZs
di5vcHRpbWFsOwogCWludCBsZXZlbDsKIAotCWlmICghbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0
aXZlIHx8IGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdfY3J0Y19zdGF0ZS0+YmFz
ZSkpIHsKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwgZHJtX2F0b21pY19jcnRj
X25lZWRzX21vZGVzZXQoJm5ld19jcnRjX3N0YXRlLT51YXBpKSkgewogCQkqaW50ZXJtZWRpYXRl
ID0gKm9wdGltYWw7CiAKIAkJaW50ZXJtZWRpYXRlLT5jeHNyID0gZmFsc2U7CkBAIC0yMTcyLDgg
KzIxNzIsOCBAQCBzdGF0aWMgdm9pZCB2bHZfcHJvZ3JhbV93YXRlcm1hcmtzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHN0YXRpYyB2b2lkIHZsdl9pbml0aWFsX3dhdGVybWFy
a3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7Ci0Jc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51
YXBpLmNydGMtPmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAKIAltdXRleF9sb2NrKCZkZXZfcHJpdi0+d20ud21f
bXV0ZXgpOwogCWNydGMtPndtLmFjdGl2ZS52bHYgPSBjcnRjX3N0YXRlLT53bS52bHYuaW50ZXJt
ZWRpYXRlOwpAQCAtMjE4NCw4ICsyMTg0LDggQEAgc3RhdGljIHZvaWQgdmx2X2luaXRpYWxfd2F0
ZXJtYXJrcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIHN0YXRpYyB2b2lkIHZs
dl9vcHRpbWl6ZV93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAog
CQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0
Yy0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
IAogCWlmICghY3J0Y19zdGF0ZS0+d20ubmVlZF9wb3N0dmJsX3VwZGF0ZSkKIAkJcmV0dXJuOwpA
QCAtMjIxMCw3ICsyMjEwLDcgQEAgc3RhdGljIHZvaWQgaTk2NV91cGRhdGVfd20oc3RydWN0IGlu
dGVsX2NydGMgKnVudXNlZF9jcnRjKQogCQkvKiBzZWxmLXJlZnJlc2ggaGFzIG11Y2ggaGlnaGVy
IGxhdGVuY3kgKi8KIAkJc3RhdGljIGNvbnN0IGludCBzcl9sYXRlbmN5X25zID0gMTIwMDA7CiAJ
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJCSZjcnRj
LT5jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRjLT5jb25maWctPmh3LmFkanVz
dGVkX21vZGU7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0KIAkJCWNydGMt
PmJhc2UucHJpbWFyeS0+c3RhdGUtPmZiOwogCQlpbnQgY2xvY2sgPSBhZGp1c3RlZF9tb2RlLT5j
cnRjX2Nsb2NrOwpAQCAtMjI5MSw3ICsyMjkxLDcgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVf
d20oc3RydWN0IGludGVsX2NydGMgKnVudXNlZF9jcnRjKQogCWNydGMgPSBpbnRlbF9nZXRfY3J0
Y19mb3JfcGxhbmUoZGV2X3ByaXYsIFBMQU5FX0EpOwogCWlmIChpbnRlbF9jcnRjX2FjdGl2ZShj
cnRjKSkgewogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
Ci0JCQkmY3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCQkmY3J0Yy0+Y29uZmln
LT5ody5hZGp1c3RlZF9tb2RlOwogCQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
CiAJCQljcnRjLT5iYXNlLnByaW1hcnktPnN0YXRlLT5mYjsKIAkJaW50IGNwcDsKQEAgLTIzMTgs
NyArMjMxOCw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRj
ICp1bnVzZWRfY3J0YykKIAljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BsYW5lKGRldl9wcml2
LCBQTEFORV9CKTsKIAlpZiAoaW50ZWxfY3J0Y19hY3RpdmUoY3J0YykpIHsKIAkJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmNydGMtPmNvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGMtPmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsK
IAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJY3J0Yy0+YmFzZS5wcmlt
YXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjcHA7CkBAIC0yMzY2LDcgKzIzNjYsNyBAQCBzdGF0aWMg
dm9pZCBpOXh4X3VwZGF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJCS8q
IHNlbGYtcmVmcmVzaCBoYXMgbXVjaCBoaWdoZXIgbGF0ZW5jeSAqLwogCQlzdGF0aWMgY29uc3Qg
aW50IHNyX2xhdGVuY3lfbnMgPSA2MDAwOwogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCQkmZW5hYmxlZC0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21v
ZGU7CisJCQkmZW5hYmxlZC0+Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCQljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9CiAJCQllbmFibGVkLT5iYXNlLnByaW1hcnktPnN0YXRl
LT5mYjsKIAkJaW50IGNsb2NrID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jazsKQEAgLTI0MjQs
NyArMjQyNCw3IEBAIHN0YXRpYyB2b2lkIGk4NDVfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRj
ICp1bnVzZWRfY3J0YykKIAlpZiAoY3J0YyA9PSBOVUxMKQogCQlyZXR1cm47CiAKLQlhZGp1c3Rl
ZF9tb2RlID0gJmNydGMtPmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWFkanVzdGVkX21v
ZGUgPSAmY3J0Yy0+Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXBsYW5lYV93bSA9IGludGVs
X2NhbGN1bGF0ZV93bShhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrLAogCQkJCSAgICAgICAmaTg0
NV93bV9pbmZvLAogCQkJCSAgICAgICBkZXZfcHJpdi0+ZGlzcGxheS5nZXRfZmlmb19zaXplKGRl
dl9wcml2LCBQTEFORV9BKSwKQEAgLTI1MTQsNyArMjUxNCw3IEBAIHN0YXRpYyB1MzIgaWxrX2Nv
bXB1dGVfcHJpX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCiAJCXJl
dHVybiBtZXRob2QxOwogCiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2QyKGNzdGF0ZS0+cGl4ZWxf
cmF0ZSwKLQkJCQkgY3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwsCisJCQkJ
IGNzdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKIAkJCQkgZHJtX3JlY3Rfd2lk
dGgoJnBzdGF0ZS0+YmFzZS5kc3QpLAogCQkJCSBjcHAsIG1lbV92YWx1ZSk7CiAKQEAgLTI1NDIs
NyArMjU0Miw3IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfc3ByX3dtKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCiAKIAltZXRob2QxID0gaWxrX3dtX21ldGhvZDEoY3N0
YXRlLT5waXhlbF9yYXRlLCBjcHAsIG1lbV92YWx1ZSk7CiAJbWV0aG9kMiA9IGlsa193bV9tZXRo
b2QyKGNzdGF0ZS0+cGl4ZWxfcmF0ZSwKLQkJCQkgY3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUu
Y3J0Y19odG90YWwsCisJCQkJIGNzdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwK
IAkJCQkgZHJtX3JlY3Rfd2lkdGgoJnBzdGF0ZS0+YmFzZS5kc3QpLAogCQkJCSBjcHAsIG1lbV92
YWx1ZSk7CiAJcmV0dXJuIG1pbihtZXRob2QxLCBtZXRob2QyKTsKQEAgLTI1NjcsNyArMjU2Nyw3
IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfY3VyX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjc3RhdGUsCiAJY3BwID0gcHN0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsK
IAogCXJldHVybiBpbGtfd21fbWV0aG9kMihjc3RhdGUtPnBpeGVsX3JhdGUsCi0JCQkgICAgICBj
c3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKKwkJCSAgICAgIGNzdGF0ZS0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKIAkJCSAgICAgIHBzdGF0ZS0+YmFzZS5jcnRj
X3csIGNwcCwgbWVtX3ZhbHVlKTsKIH0KIApAQCAtMjc4OCwxMiArMjc4OCwxMiBAQCBzdGF0aWMg
dTMyCiBoc3dfY29tcHV0ZV9saW5ldGltZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3N0YXRlKQogewogCWNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0
YXRlID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKGNzdGF0ZS0+YmFzZS5zdGF0ZSk7CisJCXRv
X2ludGVsX2F0b21pY19zdGF0ZShjc3RhdGUtPnVhcGkuc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNzdGF0ZS0+YmFzZS5hZGp1c3Rl
ZF9tb2RlOworCQkmY3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBsaW5ldGltZSwgaXBz
X2xpbmV0aW1lOwogCi0JaWYgKCFjc3RhdGUtPmJhc2UuYWN0aXZlKQorCWlmICghY3N0YXRlLT5o
dy5hY3RpdmUpCiAJCXJldHVybiAwOwogCWlmIChXQVJOX09OKGFkanVzdGVkX21vZGUtPmNydGNf
Y2xvY2sgPT0gMCkpCiAJCXJldHVybiAwOwpAQCAtMzEwMyw4ICszMTAzLDggQEAgc3RhdGljIGJv
b2wgaWxrX3ZhbGlkYXRlX3BpcGVfd20oY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogLyogQ29tcHV0ZSBuZXcgd2F0ZXJtYXJrcyBmb3IgdGhlIHBpcGUgKi8KIHN0YXRp
YyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRl
KQogewotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNzdGF0ZS0+YmFzZS5zdGF0
ZTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3N0YXRl
LT5iYXNlLmNydGMpOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNzdGF0ZS0+
dWFwaS5zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBpbnRlbF9waXBlX3dtICpwaXBlX3dtOwog
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+ZGV2OwogCWNvbnN0IHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKQEAgLTMxMTgsNyArMzExOCw4
IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3N0YXRlKQogCiAJcGlwZV93bSA9ICZjc3RhdGUtPndtLmlsay5vcHRpbWFsOwogCi0JZHJt
X2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBwbGFuZV9zdGF0
ZSwgJmNzdGF0ZS0+YmFzZSkgeworCWRybV9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFu
ZV9zdGF0ZShwbGFuZSwgcGxhbmVfc3RhdGUsCisJCQkJCQkgICAmY3N0YXRlLT51YXBpKSB7CiAJ
CWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcHMgPSB0b19pbnRlbF9wbGFuZV9zdGF0
ZShwbGFuZV9zdGF0ZSk7CiAKIAkJaWYgKHBsYW5lLT50eXBlID09IERSTV9QTEFORV9UWVBFX1BS
SU1BUlkpCkBAIC0zMTI5LDcgKzMxMzAsNyBAQCBzdGF0aWMgaW50IGlsa19jb21wdXRlX3BpcGVf
d20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIAkJCWN1cnN0YXRlID0gcHM7CiAJ
fQogCi0JcGlwZV93bS0+cGlwZV9lbmFibGVkID0gY3N0YXRlLT5iYXNlLmFjdGl2ZTsKKwlwaXBl
X3dtLT5waXBlX2VuYWJsZWQgPSBjc3RhdGUtPmh3LmFjdGl2ZTsKIAlpZiAoc3Byc3RhdGUpIHsK
IAkJcGlwZV93bS0+c3ByaXRlc19lbmFibGVkID0gc3Byc3RhdGUtPmJhc2UudmlzaWJsZTsKIAkJ
cGlwZV93bS0+c3ByaXRlc19zY2FsZWQgPSBzcHJzdGF0ZS0+YmFzZS52aXNpYmxlICYmCkBAIC0z
MTg2LDExICszMTg3LDExIEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlKQogICovCiBzdGF0aWMgaW50IGlsa19jb21wdXRlX2lu
dGVybWVkaWF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3c3RhdGUpCiB7Ci0Jc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKG5ld3N0YXRlLT5iYXNl
LmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0Yyhu
ZXdzdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGludGVsX2NydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGlwZV93bSAq
YSA9ICZuZXdzdGF0ZS0+d20uaWxrLmludGVybWVkaWF0ZTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICppbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdzdGF0ZS0+
YmFzZS5zdGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdzdGF0ZS0+dWFwaS5zdGF0
ZSk7CiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZHN0YXRlID0KIAkJaW50ZWxf
YXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShpbnRlbF9zdGF0ZSwgaW50ZWxfY3J0Yyk7CiAJY29u
c3Qgc3RydWN0IGludGVsX3BpcGVfd20gKmIgPSAmb2xkc3RhdGUtPndtLmlsay5vcHRpbWFsOwpA
QCAtMzIwMiw3ICszMjAzLDcgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9pbnRlcm1lZGlhdGVf
d20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld3N0YXRlKQogCSAqIGFuZCBhZnRlciB0aGUg
dmJsYW5rLgogCSAqLwogCSphID0gbmV3c3RhdGUtPndtLmlsay5vcHRpbWFsOwotCWlmICghbmV3
c3RhdGUtPmJhc2UuYWN0aXZlIHx8IGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdz
dGF0ZS0+YmFzZSkgfHwKKwlpZiAoIW5ld3N0YXRlLT5ody5hY3RpdmUgfHwgZHJtX2F0b21pY19j
cnRjX25lZWRzX21vZGVzZXQoJm5ld3N0YXRlLT51YXBpKSB8fAogCSAgICBpbnRlbF9zdGF0ZS0+
c2tpcF9pbnRlcm1lZGlhdGVfd20pCiAJCXJldHVybiAwOwogCkBAIC0zNzc1LDcgKzM3NzYsNyBA
QCBib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOwog
CWNzdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAKLQlpZiAo
Y3J0Yy0+YmFzZS5zdGF0ZS0+YWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5U
RVJMQUNFKQorCWlmIChjc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSkKIAkJcmV0dXJuIGZhbHNlOwogCiAJZm9yX2VhY2hfaW50ZWxfcGxhbmVf
b25fY3J0YyhkZXYsIGNydGMsIHBsYW5lKSB7CkBAIC0zODI1LDcgKzM4MjYsNyBAQCBzdGF0aWMg
dTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKIAkJcmV0dXJuIGRkYl9zaXplIC0gNDsg
LyogNCBibG9ja3MgZm9yIGJ5cGFzcyBwYXRoIGFsbG9jYXRpb24gKi8KIAotCWFkanVzdGVkX21v
ZGUgPSAmY3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJYWRqdXN0ZWRfbW9kZSA9ICZjc3Rh
dGUtPmh3LmFkanVzdGVkX21vZGU7CiAJdG90YWxfZGF0YV9idyA9IHRvdGFsX2RhdGFfcmF0ZSAq
IGRybV9tb2RlX3ZyZWZyZXNoKGFkanVzdGVkX21vZGUpOwogCiAJLyoKQEAgLTM4NTQsOSArMzg1
NSw5IEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCSAgIHN0cnVjdCBza2xfZGRiX2VudHJ5ICphbGxvYywg
Lyogb3V0ICovCiAJCQkJICAgaW50ICpudW1fYWN0aXZlIC8qIG91dCAqLykKIHsKLQlzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjc3RhdGUtPmJhc2Uuc3RhdGU7CisJc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3N0YXRlLT51YXBpLnN0YXRlOwogCXN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRl
KTsKLQlzdHJ1Y3QgZHJtX2NydGMgKmZvcl9jcnRjID0gY3N0YXRlLT5iYXNlLmNydGM7CisJc3Ry
dWN0IGRybV9jcnRjICpmb3JfY3J0YyA9IGNzdGF0ZS0+dWFwaS5jcnRjOwogCWNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjOwogCXUzMiBwaXBlX3dpZHRoID0gMCwgdG90YWxfd2lkdGggPSAwLCB3aWR0aF9iZWZv
cmVfcGlwZSA9IDA7CkBAIC0zODY0LDcgKzM4NjUsNyBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9j
YXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl1MTYgZGRi
X3NpemU7CiAJdTMyIGk7CiAKLQlpZiAoV0FSTl9PTighc3RhdGUpIHx8ICFjc3RhdGUtPmJhc2Uu
YWN0aXZlKSB7CisJaWYgKFdBUk5fT04oIXN0YXRlKSB8fCAhY3N0YXRlLT5ody5hY3RpdmUpIHsK
IAkJYWxsb2MtPnN0YXJ0ID0gMDsKIAkJYWxsb2MtPmVuZCA9IDA7CiAJCSpudW1fYWN0aXZlID0g
aHdlaWdodDMyKGRldl9wcml2LT5hY3RpdmVfY3J0Y3MpOwpAQCAtMzkwNiwxMSArMzkwNywxMSBA
QCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAkJaW50IGhkaXNwbGF5LCB2ZGlzcGxheTsKIAkJZW51bSBwaXBlIHBp
cGU7CiAKLQkJaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSkKKwkJaWYgKCFjcnRjX3N0YXRl
LT5ody5lbmFibGUpCiAJCQljb250aW51ZTsKIAogCQlwaXBlID0gY3J0Yy0+cGlwZTsKLQkJYWRq
dXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCWFkanVzdGVk
X21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJZHJtX21vZGVfZ2V0X2h2
X3RpbWluZyhhZGp1c3RlZF9tb2RlLCAmaGRpc3BsYXksICZ2ZGlzcGxheSk7CiAJCXRvdGFsX3dp
ZHRoICs9IGhkaXNwbGF5OwogCkBAIC0zOTM5LDcgKzM5NDAsNyBAQCBzdGF0aWMgdW5zaWduZWQg
aW50CiBza2xfY3Vyc29yX2FsbG9jYXRpb24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCSAgICAgIGludCBudW1fYWN0aXZlKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjLT5kZXYpOwogCWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9s
ZXZlbChkZXZfcHJpdik7CiAJc3RydWN0IHNrbF93bV9sZXZlbCB3bSA9IHt9OwogCWludCByZXQs
IG1pbl9kZGJfYWxsb2MgPSAwOwpAQCAtNDEwNyw3ICs0MTA4LDcgQEAgc2tsX3BpcGVfZG93bnNj
YWxlX2Ftb3VudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
IAl1aW50X2ZpeGVkXzE2XzE2X3QgcGlwZV9kb3duc2NhbGUgPSB1MzJfdG9fZml4ZWQxNigxKTsK
IAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJaWYgKCFjcnRjX3N0YXRlLT5ody5l
bmFibGUpCiAJCXJldHVybiBwaXBlX2Rvd25zY2FsZTsKIAogCWlmIChjcnRjX3N0YXRlLT5wY2hf
cGZpdC5lbmFibGVkKSB7CkBAIC00MTM5LDcgKzQxNDAsNyBAQCBpbnQgc2tsX2NoZWNrX3BpcGVf
bWF4X3BpeGVsX3JhdGUoc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJCQkJICBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfY3J0Yy0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSA9IGNzdGF0ZS0+YmFzZS5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2F0
b21pY19zdGF0ZSAqc3RhdGUgPSBjc3RhdGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0IGRybV9wbGFu
ZSAqcGxhbmU7CiAJY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqZHJtX3BzdGF0ZTsKIAlp
bnQgY3J0Y19jbG9jaywgZG90Y2xrOwpAQCAtNDE0NywxMCArNDE0OCwxMCBAQCBpbnQgc2tsX2No
ZWNrX3BpcGVfbWF4X3BpeGVsX3JhdGUoc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJ
dWludF9maXhlZF8xNl8xNl90IHBpcGVfZG93bnNjYWxlOwogCXVpbnRfZml4ZWRfMTZfMTZfdCBt
YXhfZG93bnNjYWxlID0gdTMyX3RvX2ZpeGVkMTYoMSk7CiAKLQlpZiAoIWNzdGF0ZS0+YmFzZS5l
bmFibGUpCisJaWYgKCFjc3RhdGUtPmh3LmVuYWJsZSkKIAkJcmV0dXJuIDA7CiAKLQlkcm1fYXRv
bWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIGRybV9wc3RhdGUsICZj
c3RhdGUtPmJhc2UpIHsKKwlkcm1fYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3Rh
dGUocGxhbmUsIGRybV9wc3RhdGUsICZjc3RhdGUtPnVhcGkpIHsKIAkJdWludF9maXhlZF8xNl8x
Nl90IHBsYW5lX2Rvd25zY2FsZTsKIAkJdWludF9maXhlZF8xNl8xNl90IGZwXzlfZGl2XzggPSBk
aXZfZml4ZWQxNig5LCA4KTsKIAkJaW50IGJwcDsKQEAgLTQxNzUsNyArNDE3Niw3IEBAIGludCBz
a2xfY2hlY2tfcGlwZV9tYXhfcGl4ZWxfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0
YywKIAogCXBpcGVfZG93bnNjYWxlID0gbXVsX2ZpeGVkMTYocGlwZV9kb3duc2NhbGUsIG1heF9k
b3duc2NhbGUpOwogCi0JY3J0Y19jbG9jayA9IGNzdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNy
dGNfY2xvY2s7CisJY3J0Y19jbG9jayA9IGNzdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Ns
b2NrOwogCWRvdGNsayA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSktPmNkY2xrLmxvZ2lj
YWwuY2RjbGs7CiAKIAlpZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMCkKQEAgLTQyNDQsNyArNDI0NSw3IEBAIHNrbF9nZXRfdG90YWxfcmVsYXRp
dmVfZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCiAJCQkJIHU2NCAq
cGxhbmVfZGF0YV9yYXRlLAogCQkJCSB1NjQgKnV2X3BsYW5lX2RhdGFfcmF0ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjc3RhdGUtPmJhc2Uuc3RhdGU7CisJc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3N0YXRlLT51YXBpLnN0YXRlOwogCXN0cnVjdCBk
cm1fcGxhbmUgKnBsYW5lOwogCWNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKmRybV9wc3Rh
dGU7CiAJdTY0IHRvdGFsX2RhdGFfcmF0ZSA9IDA7CkBAIC00MjUzLDcgKzQyNTQsNyBAQCBza2xf
Z2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0
YXRlLAogCQlyZXR1cm4gMDsKIAogCS8qIENhbGN1bGF0ZSBhbmQgY2FjaGUgZGF0YSByYXRlIGZv
ciBlYWNoIHBsYW5lICovCi0JZHJtX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0
YXRlKHBsYW5lLCBkcm1fcHN0YXRlLCAmY3N0YXRlLT5iYXNlKSB7CisJZHJtX2F0b21pY19jcnRj
X3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBkcm1fcHN0YXRlLCAmY3N0YXRlLT51
YXBpKSB7CiAJCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSB0b19pbnRlbF9wbGFuZShwbGFuZSkt
PmlkOwogCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBzdGF0ZSA9CiAJCQl0b19p
bnRlbF9wbGFuZV9zdGF0ZShkcm1fcHN0YXRlKTsKQEAgLTQyODEsMTEgKzQyODIsMTEgQEAgaWNs
X2dldF90b3RhbF9yZWxhdGl2ZV9kYXRhX3JhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNz
dGF0ZSwKIAljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpkcm1fcHN0YXRlOwogCXU2NCB0
b3RhbF9kYXRhX3JhdGUgPSAwOwogCi0JaWYgKFdBUk5fT04oIWNzdGF0ZS0+YmFzZS5zdGF0ZSkp
CisJaWYgKFdBUk5fT04oIWNzdGF0ZS0+dWFwaS5zdGF0ZSkpCiAJCXJldHVybiAwOwogCiAJLyog
Q2FsY3VsYXRlIGFuZCBjYWNoZSBkYXRhIHJhdGUgZm9yIGVhY2ggcGxhbmUgKi8KLQlkcm1fYXRv
bWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIGRybV9wc3RhdGUsICZj
c3RhdGUtPmJhc2UpIHsKKwlkcm1fYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3Rh
dGUocGxhbmUsIGRybV9wc3RhdGUsICZjc3RhdGUtPnVhcGkpIHsKIAkJY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwc3RhdGUgPQogCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUoZHJtX3Bz
dGF0ZSk7CiAJCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSB0b19pbnRlbF9wbGFuZShwbGFuZSkt
PmlkOwpAQCAtNDMyNyw4ICs0MzI4LDggQEAgc3RhdGljIGludAogc2tsX2FsbG9jYXRlX3BpcGVf
ZGRiKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCiAJCSAgICAgIHN0cnVjdCBza2xf
ZGRiX2FsbG9jYXRpb24gKmRkYiAvKiBvdXQgKi8pCiB7Ci0Jc3RydWN0IGRybV9hdG9taWNfc3Rh
dGUgKnN0YXRlID0gY3N0YXRlLT5iYXNlLnN0YXRlOwotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9
IGNzdGF0ZS0+YmFzZS5jcnRjOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNz
dGF0ZS0+dWFwaS5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBjc3RhdGUtPnVhcGku
Y3J0YzsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMt
PmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGMpOwogCXN0cnVjdCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjc3RhdGUtPndtLnNrbC5kZGI7
CkBAIC00MzUwLDcgKzQzNTEsNyBAQCBza2xfYWxsb2NhdGVfcGlwZV9kZGIoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNzdGF0ZSwKIAlpZiAoV0FSTl9PTighc3RhdGUpKQogCQlyZXR1cm4gMDsK
IAotCWlmICghY3N0YXRlLT5iYXNlLmFjdGl2ZSkgeworCWlmICghY3N0YXRlLT5ody5hY3RpdmUp
IHsKIAkJYWxsb2MtPnN0YXJ0ID0gYWxsb2MtPmVuZCA9IDA7CiAJCXJldHVybiAwOwogCX0KQEAg
LTQ1OTIsNyArNDU5Myw3IEBAIGludGVsX2dldF9saW5ldGltZV91cyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlKQogCXUzMiBjcnRjX2h0b3RhbDsKIAl1aW50X2ZpeGVkXzE2
XzE2X3QgbGluZXRpbWVfdXM7CiAKLQlpZiAoIWNzdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKCFj
c3RhdGUtPmh3LmFjdGl2ZSkKIAkJcmV0dXJuIHUzMl90b19maXhlZDE2KDApOwogCiAJcGl4ZWxf
cmF0ZSA9IGNzdGF0ZS0+cGl4ZWxfcmF0ZTsKQEAgLTQ2MDAsNyArNDYwMSw3IEBAIGludGVsX2dl
dF9saW5ldGltZV91cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlKQogCWlm
IChXQVJOX09OKHBpeGVsX3JhdGUgPT0gMCkpCiAJCXJldHVybiB1MzJfdG9fZml4ZWQxNigwKTsK
IAotCWNydGNfaHRvdGFsID0gY3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19odG90YWw7
CisJY3J0Y19odG90YWwgPSBjc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWw7CiAJ
bGluZXRpbWVfdXMgPSBkaXZfZml4ZWQxNihjcnRjX2h0b3RhbCAqIDEwMDAsIHBpeGVsX3JhdGUp
OwogCiAJcmV0dXJuIGxpbmV0aW1lX3VzOwpAQCAtNDYzNSw3ICs0NjM2LDcgQEAgc2tsX2NvbXB1
dGVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkgICAgICB1MzIgcGxhbmVfcGl4ZWxfcmF0ZSwgc3RydWN0IHNrbF93bV9wYXJhbXMgKndwLAog
CQkgICAgICBpbnQgY29sb3JfcGxhbmUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMy
IGludGVybV9wYnBsOwogCkBAIC00NzYxLDcgKzQ3NjIsNyBAQCBzdGF0aWMgdm9pZCBza2xfY29t
cHV0ZV9wbGFuZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogCQkJ
CSBjb25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHRfcHJldiwKIAkJCQkgc3RydWN0IHNr
bF93bV9sZXZlbCAqcmVzdWx0IC8qIG91dCAqLykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNzdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3N0YXRlLT51YXBpLmNydGMtPmRl
dik7CiAJdTMyIGxhdGVuY3kgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3lbbGV2ZWxdOwogCXVp
bnRfZml4ZWRfMTZfMTZfdCBtZXRob2QxLCBtZXRob2QyOwogCXVpbnRfZml4ZWRfMTZfMTZfdCBz
ZWxlY3RlZF9yZXN1bHQ7CkBAIC00Nzg3LDE0ICs0Nzg4LDE0IEBAIHN0YXRpYyB2b2lkIHNrbF9j
b21wdXRlX3BsYW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCiAJ
bWV0aG9kMSA9IHNrbF93bV9tZXRob2QxKGRldl9wcml2LCB3cC0+cGxhbmVfcGl4ZWxfcmF0ZSwK
IAkJCQkgd3AtPmNwcCwgbGF0ZW5jeSwgd3AtPmRidWZfYmxvY2tfc2l6ZSk7CiAJbWV0aG9kMiA9
IHNrbF93bV9tZXRob2QyKHdwLT5wbGFuZV9waXhlbF9yYXRlLAotCQkJCSBjc3RhdGUtPmJhc2Uu
YWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKKwkJCQkgY3N0YXRlLT5ody5hZGp1c3RlZF9tb2Rl
LmNydGNfaHRvdGFsLAogCQkJCSBsYXRlbmN5LAogCQkJCSB3cC0+cGxhbmVfYmxvY2tzX3Blcl9s
aW5lKTsKIAogCWlmICh3cC0+eV90aWxlZCkgewogCQlzZWxlY3RlZF9yZXN1bHQgPSBtYXhfZml4
ZWQxNihtZXRob2QyLCB3cC0+eV90aWxlX21pbmltdW0pOwogCX0gZWxzZSB7Ci0JCWlmICgod3At
PmNwcCAqIGNzdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsIC8KKwkJaWYgKCh3
cC0+Y3BwICogY3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsIC8KIAkJICAgICB3
cC0+ZGJ1Zl9ibG9ja19zaXplIDwgMSkgJiYKIAkJICAgICAod3AtPnBsYW5lX2J5dGVzX3Blcl9s
aW5lIC8gd3AtPmRidWZfYmxvY2tfc2l6ZSA8IDEpKSB7CiAJCQlzZWxlY3RlZF9yZXN1bHQgPSBt
ZXRob2QyOwpAQCAtNDg4NSw3ICs0ODg2LDcgQEAgc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBz
a2xfd21fcGFyYW1zICp3bV9wYXJhbXMsCiAJCSAgICAgIHN0cnVjdCBza2xfd21fbGV2ZWwgKmxl
dmVscykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNz
dGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJaW50IGxldmVsLCBtYXhfbGV2
ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpy
ZXN1bHRfcHJldiA9ICZsZXZlbHNbMF07CiAKQEAgLTQ5MDIsNyArNDkwMyw3IEBAIHNrbF9jb21w
dXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlLAogc3Rh
dGljIHUzMgogc2tsX2NvbXB1dGVfbGluZXRpbWVfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjc3Rh
dGUtPmJhc2Uuc3RhdGU7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3N0YXRl
LT51YXBpLnN0YXRlOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoc3RhdGUtPmRldik7CiAJdWludF9maXhlZF8xNl8xNl90IGxpbmV0aW1lX3VzOwogCXUzMiBs
aW5ldGltZV93bTsKQEAgLTQ5MjEsNyArNDkyMiw3IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21wdXRl
X3RyYW5zaXRpb25fd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSwKIAkJ
CQkgICAgICBjb25zdCBzdHJ1Y3Qgc2tsX3dtX3BhcmFtcyAqd3AsCiAJCQkJICAgICAgc3RydWN0
IHNrbF9wbGFuZV93bSAqd20pCiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNzdGF0ZS0+
YmFzZS5jcnRjLT5kZXY7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNzdGF0ZS0+dWFwaS5j
cnRjLT5kZXY7CiAJY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShkZXYpOwogCXUxNiB0cmFuc19taW4sIHRyYW5zX3lfdGlsZV9taW47CiAJY29uc3QgdTE2
IHRyYW5zX2Ftb3VudCA9IDEwOyAvKiBUaGlzIGlzIGNvbmZpZ3VyYWJsZSBhbW91bnQgKi8KQEAg
LTUwODEsNyArNTA4Miw3IEBAIHN0YXRpYyBpbnQgaWNsX2J1aWxkX3BsYW5lX3dtKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBzdGF0aWMgaW50IHNrbF9idWlsZF9waXBl
X3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNzdGF0ZS0+dWFwaS5j
cnRjLT5kZXYpOwogCXN0cnVjdCBza2xfcGlwZV93bSAqcGlwZV93bSA9ICZjc3RhdGUtPndtLnNr
bC5vcHRpbWFsOwogCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lOwogCWNvbnN0IHN0cnVjdCBkcm1f
cGxhbmVfc3RhdGUgKmRybV9wc3RhdGU7CkBAIC01MDk0LDcgKzUwOTUsNyBAQCBzdGF0aWMgaW50
IHNrbF9idWlsZF9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiAJbWVt
c2V0KHBpcGVfd20tPnBsYW5lcywgMCwgc2l6ZW9mKHBpcGVfd20tPnBsYW5lcykpOwogCiAJZHJt
X2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBkcm1fcHN0YXRl
LAotCQkJCQkJICAgJmNzdGF0ZS0+YmFzZSkgeworCQkJCQkJICAgJmNzdGF0ZS0+dWFwaSkgewog
CQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBzdGF0ZSA9CiAJCQl0b19pbnRlbF9w
bGFuZV9zdGF0ZShkcm1fcHN0YXRlKTsKIApAQCAtNTI3Myw4ICs1Mjc0LDggQEAgc3RhdGljIGlu
dAogc2tsX2RkYl9hZGRfYWZmZWN0ZWRfcGxhbmVzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPSB0b19p
bnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOwotCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
KTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9IHRvX2ludGVsX2F0b21pY19z
dGF0ZShuZXdfY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CiAKQEAgLTU1NzQsNyArNTU3NSw3IEBAIHN0YXRpYyBp
bnQgc2tsX3dtX2FkZF9hZmZlY3RlZF9wbGFuZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUsCiAJCSAqIHBvd2VyIHdlbGwgdGhlIGhhcmR3YXJlIHN0YXRlIHdpbGwgZ28gb3V0IG9m
IHN5bmMKIAkJICogd2l0aCB0aGUgc29mdHdhcmUgc3RhdGUuCiAJCSAqLwotCQlpZiAoIWRybV9h
dG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdfY3J0Y19zdGF0ZS0+YmFzZSkgJiYKKwkJaWYg
KCFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPnVhcGkpICYm
CiAJCSAgICBza2xfcGxhbmVfd21fZXF1YWxzKGRldl9wcml2LAogCQkJCQkmb2xkX2NydGNfc3Rh
dGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF0sCiAJCQkJCSZuZXdfY3J0Y19zdGF0
ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3BsYW5lX2lkXSkpCkBAIC01NjQxLDcgKzU2NDIsNyBA
QCBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHN0YXRp
YyB2b2lkIHNrbF9hdG9taWNfdXBkYXRlX2NydGNfd20oc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJCQkJICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3N0YXRlLT5iYXNlLmNy
dGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhjc3RhdGUtPnVh
cGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShz
dGF0ZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBza2xfcGlwZV93bSAqcGlwZV93bSA9ICZjc3RhdGUt
PndtLnNrbC5vcHRpbWFsOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKQEAgLTU2NTUs
NyArNTY1Niw3IEBAIHN0YXRpYyB2b2lkIHNrbF9hdG9taWNfdXBkYXRlX2NydGNfd20oc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiBzdGF0aWMgdm9pZCBza2xfaW5pdGlhbF93bShz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCSAgIHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19p
bnRlbF9jcnRjKGNzdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxf
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IHNrbF9kZGJfdmFsdWVzICpyZXN1
bHRzID0gJnN0YXRlLT53bV9yZXN1bHRzOwpAQCAtNTY2NSw3ICs1NjY2LDcgQEAgc3RhdGljIHZv
aWQgc2tsX2luaXRpYWxfd20oc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAKIAlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+d20ud21fbXV0ZXgpOwogCi0JaWYgKGNzdGF0ZS0+YmFzZS5h
Y3RpdmVfY2hhbmdlZCkKKwlpZiAoY3N0YXRlLT51YXBpLmFjdGl2ZV9jaGFuZ2VkKQogCQlza2xf
YXRvbWljX3VwZGF0ZV9jcnRjX3dtKHN0YXRlLCBjc3RhdGUpOwogCiAJbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+d20ud21fbXV0ZXgpOwpAQCAtNTcyNCw4ICs1NzI1LDggQEAgc3RhdGljIHZvaWQg
aWxrX3Byb2dyYW1fd2F0ZXJtYXJrcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiBzdGF0aWMgdm9pZCBpbGtfaW5pdGlhbF93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlLAogCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUtPmJh
c2UuY3J0Yy0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVs
X2NydGMoY3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3N0YXRlLT51YXBpLmNydGMtPmRldik7CisJc3RydWN0IGludGVsX2Ny
dGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNzdGF0ZS0+dWFwaS5jcnRjKTsKIAogCW11
dGV4X2xvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CiAJaW50ZWxfY3J0Yy0+d20uYWN0aXZl
LmlsayA9IGNzdGF0ZS0+d20uaWxrLmludGVybWVkaWF0ZTsKQEAgLTU3MzYsOCArNTczNyw4IEBA
IHN0YXRpYyB2b2lkIGlsa19pbml0aWFsX3dhdGVybWFya3Moc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUsCiBzdGF0aWMgdm9pZCBpbGtfb3B0aW1pemVfd2F0ZXJtYXJrcyhzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNzdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjID0gdG9faW50ZWxfY3J0Yyhjc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlz
dHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3N0YXRlLT51YXBp
LmNydGMpOwogCiAJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPndtLndtX211dGV4KTsKIAlpZiAoY3N0
YXRlLT53bS5uZWVkX3Bvc3R2YmxfdXBkYXRlKSB7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9708B2DE0E
	for <lists+intel-gfx@lfdr.de>; Wed, 29 May 2019 15:24:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 26C216E319;
	Wed, 29 May 2019 13:24:41 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 576416E10B;
 Wed, 29 May 2019 13:24:39 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16720260-1500050 
 for multiple; Wed, 29 May 2019 14:24:23 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 29 May 2019 14:24:21 +0100
Message-Id: <20190529132421.27905-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] lib: Fix
 intel_get_current_physical_engine() iterator
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgcnVuIG91dCBvZiBlbmdpbmVzLCBpbnRlbF9nZXRfY3VycmVudF9waHlzaWNhbF9lbmdp
bmUoKSBkZWdyYWRlcwppbnRvIGFuIGluZmluaXRlIGxvb3AgYXMgYWx0aG91Z2ggaXQgYWR2YW5j
ZWQgdGhlIGl0ZXJhdG9yLCBpdCBkaWQgbm90CnVwZGF0ZSBpdHMgbG9jYWwgZW5naW5lIHBvaW50
ZXIuCgpSZXBvcnRlZC1ieTogUGV0cmkgTGF0dmFsYSA8cGV0cmkubGF0dmFsYUBpbnRlbC5jb20+
CkZpeGVzOiAxN2M3N2U3YjBjM2MgKCJsaWIvaTkxNTogYWRkIGdlbV9lbmdpbmVfdG9wb2xvZ3kg
bGlicmFyeSBhbmQgZm9yX2VhY2ggbG9vcCBkZWZpbml0aW9uIikKU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBBbmRpIFNoeXRpIDxhbmRp
LnNoeXRpQGludGVsLmNvbT4KQ2M6IFBldHJpIExhdHZhbGEgPHBldHJpLmxhdHZhbGFAaW50ZWwu
Y29tPgotLS0KIGxpYi9pOTE1L2dlbV9lbmdpbmVfdG9wb2xvZ3kuYyB8IDQ5ICsrKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGxpYi9pOTE1L2dlbV9lbmdpbmVfdG9wb2xvZ3kuaCB8
IDM2ICsrKysrKysrKysrKysrKystLS0tLS0tLS0KIDIgZmlsZXMgY2hhbmdlZCwgMjkgaW5zZXJ0
aW9ucygrKSwgNTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvbGliL2k5MTUvZ2VtX2VuZ2lu
ZV90b3BvbG9neS5jIGIvbGliL2k5MTUvZ2VtX2VuZ2luZV90b3BvbG9neS5jCmluZGV4IGZkZDFi
OTUxNi4uMTdmNjc3ODZmIDEwMDY0NAotLS0gYS9saWIvaTkxNS9nZW1fZW5naW5lX3RvcG9sb2d5
LmMKKysrIGIvbGliL2k5MTUvZ2VtX2VuZ2luZV90b3BvbG9neS5jCkBAIC04MSwxMSArODEsMTAg
QEAgc3RhdGljIHZvaWQgY3R4X21hcF9lbmdpbmVzKGludCBmZCwgc3RydWN0IGludGVsX2VuZ2lu
ZV9kYXRhICplZCwKIAkJCSAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gKnBh
cmFtKQogewogCXN0cnVjdCBpOTE1X2NvbnRleHRfcGFyYW1fZW5naW5lcyAqZW5naW5lcyA9Ci0J
CQlmcm9tX3VzZXJfcG9pbnRlcihwYXJhbS0+dmFsdWUpOworCQlmcm9tX3VzZXJfcG9pbnRlcihw
YXJhbS0+dmFsdWUpOwogCWludCBpID0gMDsKIAotCWZvciAodHlwZW9mKGVuZ2luZXMtPmVuZ2lu
ZXNbMF0pICpwID0KLQkgICAgICZlbmdpbmVzLT5lbmdpbmVzWzBdOworCWZvciAoc3RydWN0IGk5
MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICpwID0gJmVuZ2luZXMtPmVuZ2luZXNbMF07CiAJICAg
ICBpIDwgZWQtPm5lbmdpbmVzOyBpKyssIHArKykgewogCQlwLT5lbmdpbmVfY2xhc3MgPSBlZC0+
ZW5naW5lc1tpXS5jbGFzczsKIAkJcC0+ZW5naW5lX2luc3RhbmNlID0gZWQtPmVuZ2luZXNbaV0u
aW5zdGFuY2U7CkBAIC0xMzYsNyArMTM1LDcgQEAgc3RhdGljIHZvaWQgcXVlcnlfZW5naW5lX2xp
c3QoaW50IGZkLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2RhdGEgKmVkKQogewogCXVpbnQ4X3QgYnVm
ZltTSVpFT0ZfUVVFUlldID0geyB9OwogCXN0cnVjdCBkcm1faTkxNV9xdWVyeV9lbmdpbmVfaW5m
byAqcXVlcnlfZW5naW5lID0KLQkJCShzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfZW5naW5lX2luZm8g
KikgYnVmZjsKKwkJKHN0cnVjdCBkcm1faTkxNV9xdWVyeV9lbmdpbmVfaW5mbyAqKWJ1ZmY7CiAJ
aW50IGk7CiAKIAlxdWVyeV9lbmdpbmVzKGZkLCBxdWVyeV9lbmdpbmUsIFNJWkVPRl9RVUVSWSk7
CkBAIC0xNDksNDEgKzE0OCw2IEBAIHN0YXRpYyB2b2lkIHF1ZXJ5X2VuZ2luZV9saXN0KGludCBm
ZCwgc3RydWN0IGludGVsX2VuZ2luZV9kYXRhICplZCkKIAllZC0+bmVuZ2luZXMgPSBxdWVyeV9l
bmdpbmUtPm51bV9lbmdpbmVzOwogfQogCi1zdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIg
KgotaW50ZWxfZ2V0X2N1cnJlbnRfZW5naW5lKHN0cnVjdCBpbnRlbF9lbmdpbmVfZGF0YSAqZWQp
Ci17Ci0JaWYgKCFlZC0+bikKLQkJZWQtPmN1cnJlbnRfZW5naW5lID0gJmVkLT5lbmdpbmVzWzBd
OwotCWVsc2UgaWYgKGVkLT5uID49IGVkLT5uZW5naW5lcykKLQkJZWQtPmN1cnJlbnRfZW5naW5l
ID0gTlVMTDsKLQotCXJldHVybiBlZC0+Y3VycmVudF9lbmdpbmU7Ci19Ci0KLXZvaWQgaW50ZWxf
bmV4dF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9kYXRhICplZCkKLXsKLQlpZiAoZWQtPm4g
KyAxIDwgZWQtPm5lbmdpbmVzKSB7Ci0JCWVkLT5uKys7Ci0JCWVkLT5jdXJyZW50X2VuZ2luZSA9
ICZlZC0+ZW5naW5lc1tlZC0+bl07Ci0JfSBlbHNlIHsKLQkJZWQtPm4gPSBlZC0+bmVuZ2luZXM7
Ci0JCWVkLT5jdXJyZW50X2VuZ2luZSA9IE5VTEw7Ci0JfQotfQotCi1zdHJ1Y3QgaW50ZWxfZXhl
Y3V0aW9uX2VuZ2luZTIgKgotaW50ZWxfZ2V0X2N1cnJlbnRfcGh5c2ljYWxfZW5naW5lKHN0cnVj
dCBpbnRlbF9lbmdpbmVfZGF0YSAqZWQpCi17Ci0Jc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdp
bmUyICplOwotCi0JZm9yIChlID0gaW50ZWxfZ2V0X2N1cnJlbnRfZW5naW5lKGVkKTsKLQkgICAg
IGUgJiYgZS0+aXNfdmlydHVhbDsKLQkgICAgIGludGVsX25leHRfZW5naW5lKGVkKSkKLQkJOwot
Ci0JcmV0dXJuIGU7Ci19Ci0KIHN0YXRpYyBpbnQgZ2VtX3RvcG9sb2d5X2dldF9wYXJhbShpbnQg
ZmQsCiAJCQkJICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gKnApCiB7CkBAIC0x
OTcsMTAgKzE2MSw5IEBAIHN0YXRpYyBpbnQgZ2VtX3RvcG9sb2d5X2dldF9wYXJhbShpbnQgZmQs
CiAJCXJldHVybiAwOwogCiAJLyogc2l6ZSB3aWxsIHN0b3JlIHRoZSBlbmdpbmUgY291bnQgKi8K
LQlwLT5zaXplID0gKHAtPnNpemUgLSBzaXplb2Yoc3RydWN0IGk5MTVfY29udGV4dF9wYXJhbV9l
bmdpbmVzKSkgLwotCQkgIChvZmZzZXRvZihzdHJ1Y3QgaTkxNV9jb250ZXh0X3BhcmFtX2VuZ2lu
ZXMsCi0JCQkgICAgZW5naW5lc1sxXSkgLQotCQkgIHNpemVvZihzdHJ1Y3QgaTkxNV9jb250ZXh0
X3BhcmFtX2VuZ2luZXMpKTsKKwlpZ3RfYXNzZXJ0KHAtPnNpemUgPj0gc2l6ZW9mKHN0cnVjdCBp
OTE1X2NvbnRleHRfcGFyYW1fZW5naW5lcykpOworCXAtPnNpemUgLT0gc2l6ZW9mKHN0cnVjdCBp
OTE1X2NvbnRleHRfcGFyYW1fZW5naW5lcyk7CisJcC0+c2l6ZSAvPSBzaXplb2Yoc3RydWN0IGk5
MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlKTsKIAogCWlndF9hc3NlcnRfZihwLT5zaXplIDw9IEdF
TV9NQVhfRU5HSU5FUywgInVuc3VwcG9ydGVkIGVuZ2luZSBjb3VudFxuIik7CiAKZGlmZiAtLWdp
dCBhL2xpYi9pOTE1L2dlbV9lbmdpbmVfdG9wb2xvZ3kuaCBiL2xpYi9pOTE1L2dlbV9lbmdpbmVf
dG9wb2xvZ3kuaAppbmRleCAyNDE1ZmQxZTMuLmExMDE4YWZjYSAxMDA2NDQKLS0tIGEvbGliL2k5
MTUvZ2VtX2VuZ2luZV90b3BvbG9neS5oCisrKyBiL2xpYi9pOTE1L2dlbV9lbmdpbmVfdG9wb2xv
Z3kuaApAQCAtMzAsOSArMzAsNyBAQAogI2RlZmluZSBHRU1fTUFYX0VOR0lORVMJCUk5MTVfRVhF
Q19SSU5HX01BU0sgKyAxCiAKIHN0cnVjdCBpbnRlbF9lbmdpbmVfZGF0YSB7Ci0JdWludDMyX3Qg
bmVuZ2luZXM7Ci0JdWludDMyX3QgbjsKLQlzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIg
KmN1cnJlbnRfZW5naW5lOworCXVpbnQzMl90IG5lbmdpbmVzLCBjdXI7CiAJc3RydWN0IGludGVs
X2V4ZWN1dGlvbl9lbmdpbmUyIGVuZ2luZXNbR0VNX01BWF9FTkdJTkVTXTsKIH07CiAKQEAgLTQw
LDMxICszOCw0MyBAQCBib29sIGdlbV9oYXNfZW5naW5lX3RvcG9sb2d5KGludCBmZCk7CiBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2RhdGEgaW50ZWxfaW5pdF9lbmdpbmVfbGlzdChpbnQgZmQsIHVpbnQz
Ml90IGN0eF9pZCk7CiAKIC8qIGl0ZXJhdGlvbiBmdW5jdGlvbnMgKi8KLXN0cnVjdCBpbnRlbF9l
eGVjdXRpb25fZW5naW5lMiAqCi1pbnRlbF9nZXRfY3VycmVudF9lbmdpbmUoc3RydWN0IGludGVs
X2VuZ2luZV9kYXRhICplZCk7Ci0KLXN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqCi1p
bnRlbF9nZXRfY3VycmVudF9waHlzaWNhbF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9kYXRh
ICplZCk7Ci0KLXZvaWQgaW50ZWxfbmV4dF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9kYXRh
ICplZCk7Ci0KIGludCBnZW1fY29udGV4dF9sb29rdXBfZW5naW5lKGludCBmZCwgdWludDY0X3Qg
ZW5naW5lLCB1aW50MzJfdCBjdHhfaWQsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9u
X2VuZ2luZTIgKmUpOwogCiB2b2lkIGdlbV9jb250ZXh0X3NldF9hbGxfZW5naW5lcyhpbnQgZmQs
IHVpbnQzMl90IGN0eCk7CiAKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9l
bmdpbmUyICoKK2ludGVsX2dldF9jdXJyZW50X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Rh
dGEgKmVkKQoreworCWlmIChlZC0+Y3VyID49IGVkLT5uZW5naW5lcykKKwkJcmV0dXJuIE5VTEw7
CisKKwlyZXR1cm4gJmVkLT5lbmdpbmVzW2VkLT5jdXJdOworfQorCitzdGF0aWMgaW5saW5lIHN0
cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqCitpbnRlbF9nZXRfY3VycmVudF9waHlzaWNh
bF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9kYXRhICplZCkKK3sKKwlzdHJ1Y3QgaW50ZWxf
ZXhlY3V0aW9uX2VuZ2luZTIgKmU7CisKKwlmb3IgKDsgKGUgPSBpbnRlbF9nZXRfY3VycmVudF9l
bmdpbmUoZWQpKSAmJiBlLT5pc192aXJ0dWFsOyBlZC0+Y3VyKyspCisJCTsKKworCXJldHVybiBl
OworfQorCiAjZGVmaW5lIF9fZm9yX2VhY2hfc3RhdGljX2VuZ2luZShlX18pIFwKIAlmb3IgKChl
X18pID0gaW50ZWxfZXhlY3V0aW9uX2VuZ2luZXMyOyAoZV9fKS0+bmFtZTsgKGVfXykrKykKIAog
I2RlZmluZSBmb3JfZWFjaF9jb250ZXh0X2VuZ2luZShmZF9fLCBjdHhfXywgZV9fKSBcCiAJZm9y
IChzdHJ1Y3QgaW50ZWxfZW5naW5lX2RhdGEgaV9fID0gaW50ZWxfaW5pdF9lbmdpbmVfbGlzdChm
ZF9fLCBjdHhfXyk7IFwKIAkgICAgICgoZV9fKSA9IGludGVsX2dldF9jdXJyZW50X2VuZ2luZSgm
aV9fKSk7IFwKLQkgICAgIGludGVsX25leHRfZW5naW5lKCZpX18pKQorCSAgICAgaV9fLmN1cisr
KQogCiAvKiBuZWVkcyB0byByZXBsYWNlICJmb3JfZWFjaF9waHlzaWNhbF9lbmdpbmUiIHdoZW4g
Y29uZmxpY3RzIGFyZSBmaXhlZCAqLwogI2RlZmluZSBfX2Zvcl9lYWNoX3BoeXNpY2FsX2VuZ2lu
ZShmZF9fLCBlX18pIFwKIAlmb3IgKHN0cnVjdCBpbnRlbF9lbmdpbmVfZGF0YSBpX18gPSBpbnRl
bF9pbml0X2VuZ2luZV9saXN0KGZkX18sIDApOyBcCiAJICAgICAoKGVfXykgPSBpbnRlbF9nZXRf
Y3VycmVudF9waHlzaWNhbF9lbmdpbmUoJmlfXykpOyBcCi0JICAgICBpbnRlbF9uZXh0X2VuZ2lu
ZSgmaV9fKSkKKwkgICAgIGlfXy5jdXIrKykKIAogI2VuZGlmIC8qIEdFTV9FTkdJTkVfVE9QT0xP
R1lfSCAqLwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

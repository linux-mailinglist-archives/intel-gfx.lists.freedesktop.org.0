Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C5F3363372
	for <lists+intel-gfx@lfdr.de>; Tue,  9 Jul 2019 11:32:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 51EC16E05F;
	Tue,  9 Jul 2019 09:32:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 687CC89FBC
 for <intel-gfx@lists.freedesktop.org>; Tue,  9 Jul 2019 09:32:39 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Jul 2019 02:32:39 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,470,1557212400"; d="scan'208";a="185876216"
Received: from unknown (HELO delly.ger.corp.intel.com) ([10.252.37.9])
 by fmsmga001.fm.intel.com with ESMTP; 09 Jul 2019 02:32:37 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  9 Jul 2019 12:32:04 +0300
Message-Id: <20190709093208.20470-9-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190709093208.20470-1-lionel.g.landwerlin@intel.com>
References: <20190709093208.20470-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v7 08/12] drm/i915: add syncobj timeline support
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW50cm9kdWNlcyBhIG5ldyBwYXJhbWV0ZXJzIHRvIGV4ZWNidWYgc28gdGhhdCB3ZSBjYW4gc3Bl
Y2lmeSBzeW5jb2JqCmhhbmRsZXMgYXMgd2VsbCBhcyB0aW1lbGluZSBwb2ludHMuCgp2MjogUmV1
c2UgaTkxNV91c2VyX2V4dGVuc2lvbl9mbgoKdjM6IENoZWNrIHRoYXQgdGhlIGNoYWluZWQgZXh0
ZW5zaW9uIGlzIG9ubHkgcHJlc2VudCBvbmNlIChDaHJpcykKCnY0OiBDaGVjayB0aGF0IGRtYV9m
ZW5jZV9jaGFpbl9maW5kX3NlcW5vIHJldHVybnMgYSBub24gTlVMTCBmZW5jZSAoTGlvbmVsKQoK
djU6IFVzZSBCSVRfVUxMIChDaHJpcykKCnY2OiBGaXggaXNzdWUgd2l0aCBhbHJlYWR5IHNpZ25h
bGVkIHRpbWVsaW5lIHBvaW50cywKICAgIGRtYV9mZW5jZV9jaGFpbl9maW5kX3NlcW5vKCkgc2V0
dGluZyBmZW5jZSB0byBOVUxMIChDaHJpcykKClNpZ25lZC1vZmYtYnk6IExpb25lbCBMYW5kd2Vy
bGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAyOTcgKysrKysrKysrKysrKystLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAgfCAgIDQgKy0KIGlu
Y2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCAgICAgICAgICAgICAgICAgICB8ICAzOCArKysKIDMg
ZmlsZXMgY2hhbmdlZCwgMjgyIGluc2VydGlvbnMoKyksIDU3IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IDk4ODdm
YTllM2FjOC4uZmM1MTA4YjhmOGVmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTIxMyw2ICsyMTMsMTMgQEAgZW51bSB7CiAgKiB0aGUg
YmF0Y2hidWZmZXIgaW4gdHJ1c3RlZCBtb2RlLCBvdGhlcndpc2UgdGhlIGlvY3RsIGlzIHJlamVj
dGVkLgogICovCiAKK3N0cnVjdCBpOTE1X2ViX2ZlbmNlcyB7CisJc3RydWN0IGRybV9zeW5jb2Jq
ICpzeW5jb2JqOyAvKiBVc2Ugd2l0aCBwdHJfbWFza19iaXRzKCkgKi8KKwlzdHJ1Y3QgZG1hX2Zl
bmNlICpkbWFfZmVuY2U7CisJdTY0IHZhbHVlOworCXN0cnVjdCBkbWFfZmVuY2VfY2hhaW4gKmNo
YWluX2ZlbmNlOworfTsKKwogc3RydWN0IGk5MTVfZXhlY2J1ZmZlciB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTU7IC8qKiBpOTE1IGJhY2twb2ludGVyICovCiAJc3RydWN0IGRybV9m
aWxlICpmaWxlOyAvKiogcGVyLWZpbGUgbG9va3VwIHRhYmxlcyBhbmQgbGltaXRzICovCkBAIC0y
NzUsNiArMjgyLDcgQEAgc3RydWN0IGk5MTVfZXhlY2J1ZmZlciB7CiAKIAlzdHJ1Y3QgewogCQl1
NjQgZmxhZ3M7IC8qKiBBdmFpbGFibGUgZXh0ZW5zaW9ucyBwYXJhbWV0ZXJzICovCisJCXN0cnVj
dCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcl9leHRfdGltZWxpbmVfZmVuY2VzIHRpbWVsaW5lX2Zl
bmNlczsKIAl9IGV4dGVuc2lvbnM7CiB9OwogCkBAIC0yMjI0LDY3ICsyMjMyLDIwNyBAQCBlYl9z
ZWxlY3RfZW5naW5lKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogfQogCiBzdGF0aWMgdm9p
ZAotX19mcmVlX2ZlbmNlX2FycmF5KHN0cnVjdCBkcm1fc3luY29iaiAqKmZlbmNlcywgdW5zaWdu
ZWQgaW50IG4pCitfX2ZyZWVfZmVuY2VfYXJyYXkoc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5j
ZXMsIHVuc2lnbmVkIGludCBuKQogewotCXdoaWxlIChuLS0pCi0JCWRybV9zeW5jb2JqX3B1dChw
dHJfbWFza19iaXRzKGZlbmNlc1tuXSwgMikpOworCXdoaWxlIChuLS0pIHsKKwkJZHJtX3N5bmNv
YmpfcHV0KHB0cl9tYXNrX2JpdHMoZmVuY2VzW25dLnN5bmNvYmosIDIpKTsKKwkJZG1hX2ZlbmNl
X3B1dChmZW5jZXNbbl0uZG1hX2ZlbmNlKTsKKwkJa2ZyZWUoZmVuY2VzW25dLmNoYWluX2ZlbmNl
KTsKKwl9CiAJa3ZmcmVlKGZlbmNlcyk7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgZHJtX3N5bmNvYmog
KioKLWdldF9mZW5jZV9hcnJheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdz
LAotCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCitzdGF0aWMgc3RydWN0IGk5MTVfZWJfZmVuY2Vz
ICoKK2dldF90aW1lbGluZV9mZW5jZV9hcnJheShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwg
aW50ICpvdXRfbl9mZW5jZXMpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyX2V4
dF90aW1lbGluZV9mZW5jZXMgKnRpbWVsaW5lX2ZlbmNlcyA9CisJCSZlYi0+ZXh0ZW5zaW9ucy50
aW1lbGluZV9mZW5jZXM7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX2ZlbmNlIF9fdXNlciAq
dXNlcl9mZW5jZXM7CisJc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5jZXM7CisJdTY0IF9fdXNl
ciAqdXNlcl92YWx1ZXM7CisJdTY0IG51bV9mZW5jZXMsIG51bV91c2VyX2ZlbmNlcyA9IHRpbWVs
aW5lX2ZlbmNlcy0+ZmVuY2VfY291bnQ7CisJdW5zaWduZWQgbG9uZyBuOworCWludCBlcnI7CisK
KwkvKiBDaGVjayBtdWx0aXBsaWNhdGlvbiBvdmVyZmxvdyBmb3IgYWNjZXNzX29rKCkgYW5kIGt2
bWFsbG9jX2FycmF5KCkgKi8KKwlCVUlMRF9CVUdfT04oc2l6ZW9mKHNpemVfdCkgPiBzaXplb2Yo
dW5zaWduZWQgbG9uZykpOworCWlmIChudW1fdXNlcl9mZW5jZXMgPiBtaW5fdCh1bnNpZ25lZCBs
b25nLAorCQkJCSAgICBVTE9OR19NQVggLyBzaXplb2YoKnVzZXJfZmVuY2VzKSwKKwkJCQkgICAg
U0laRV9NQVggLyBzaXplb2YoKmZlbmNlcykpKQorCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsK
KworCXVzZXJfZmVuY2VzID0gdTY0X3RvX3VzZXJfcHRyKHRpbWVsaW5lX2ZlbmNlcy0+aGFuZGxl
c19wdHIpOworCWlmICghYWNjZXNzX29rKHVzZXJfZmVuY2VzLCBudW1fdXNlcl9mZW5jZXMgKiBz
aXplb2YoKnVzZXJfZmVuY2VzKSkpCisJCXJldHVybiBFUlJfUFRSKC1FRkFVTFQpOworCisJdXNl
cl92YWx1ZXMgPSB1NjRfdG9fdXNlcl9wdHIodGltZWxpbmVfZmVuY2VzLT52YWx1ZXNfcHRyKTsK
KwlpZiAoIWFjY2Vzc19vayh1c2VyX3ZhbHVlcywgbnVtX3VzZXJfZmVuY2VzICogc2l6ZW9mKCp1
c2VyX3ZhbHVlcykpKQorCQlyZXR1cm4gRVJSX1BUUigtRUZBVUxUKTsKKworCWZlbmNlcyA9IGt2
bWFsbG9jX2FycmF5KG51bV91c2VyX2ZlbmNlcywgc2l6ZW9mKCpmZW5jZXMpLAorCQkJCV9fR0ZQ
X05PV0FSTiB8IEdGUF9LRVJORUwpOworCWlmICghZmVuY2VzKQorCQlyZXR1cm4gRVJSX1BUUigt
RU5PTUVNKTsKKworCUJVSUxEX0JVR19PTih+KEFSQ0hfS01BTExPQ19NSU5BTElHTiAtIDEpICYK
KwkJICAgICB+X19JOTE1X0VYRUNfRkVOQ0VfVU5LTk9XTl9GTEFHUyk7CisKKwlmb3IgKG4gPSAw
LCBudW1fZmVuY2VzID0gMDsgbiA8IHRpbWVsaW5lX2ZlbmNlcy0+ZmVuY2VfY291bnQ7IG4rKykg
eworCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVuY2UgdXNlcl9mZW5jZTsKKwkJc3RydWN0
IGRybV9zeW5jb2JqICpzeW5jb2JqOworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSA9IE5VTEw7
CisJCXU2NCBwb2ludDsKKworCQlpZiAoX19jb3B5X2Zyb21fdXNlcigmdXNlcl9mZW5jZSwgdXNl
cl9mZW5jZXMrKywgc2l6ZW9mKHVzZXJfZmVuY2UpKSkgeworCQkJZXJyID0gLUVGQVVMVDsKKwkJ
CWdvdG8gZXJyOworCQl9CisKKwkJaWYgKHVzZXJfZmVuY2UuZmxhZ3MgJiBfX0k5MTVfRVhFQ19G
RU5DRV9VTktOT1dOX0ZMQUdTKSB7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnI7CisJ
CX0KKworCQlpZiAoX19nZXRfdXNlcihwb2ludCwgdXNlcl92YWx1ZXMrKykpIHsKKwkJCWVyciA9
IC1FRkFVTFQ7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCXN5bmNvYmogPSBkcm1fc3luY29ial9m
aW5kKGViLT5maWxlLCB1c2VyX2ZlbmNlLmhhbmRsZSk7CisJCWlmICghc3luY29iaikgeworCQkJ
RFJNX0RFQlVHKCJJbnZhbGlkIHN5bmNvYmogaGFuZGxlIHByb3ZpZGVkXG4iKTsKKwkJCWVyciA9
IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCWlmICh1c2VyX2ZlbmNlLmZsYWdzICYg
STkxNV9FWEVDX0ZFTkNFX1dBSVQpIHsKKwkJCWZlbmNlID0gZHJtX3N5bmNvYmpfZmVuY2VfZ2V0
KHN5bmNvYmopOworCQkJaWYgKCFmZW5jZSkgeworCQkJCURSTV9ERUJVRygiU3luY29iaiBoYW5k
bGUgaGFzIG5vIGZlbmNlXG4iKTsKKwkJCQlkcm1fc3luY29ial9wdXQoc3luY29iaik7CisJCQkJ
ZXJyID0gLUVJTlZBTDsKKwkJCQlnb3RvIGVycjsKKwkJCX0KKworCQkJZXJyID0gZG1hX2ZlbmNl
X2NoYWluX2ZpbmRfc2Vxbm8oJmZlbmNlLCBwb2ludCk7CisJCQlpZiAoZXJyKSB7CisJCQkJRFJN
X0RFQlVHKCJTeW5jb2JqIGhhbmRsZSBtaXNzaW5nIHJlcXVlc3RlZCBwb2ludCAlbGx1XG4iLCBw
b2ludCk7CisJCQkJZHJtX3N5bmNvYmpfcHV0KHN5bmNvYmopOworCQkJCWdvdG8gZXJyOworCQkJ
fQorCisJCQkvKiBBIHBvaW50IG1pZ2h0IGhhdmUgYmVlbiBzaWduYWxlZCBhbHJlYWR5IGFuZAor
CQkJICogZ2FyYmFnZSBjb2xsZWN0ZWQgZnJvbSB0aGUgdGltZWxpbmUuIEluIHRoaXMgY2FzZQor
CQkJICoganVzdCBpZ25vcmUgdGhlIHBvaW50IGFuZCBjYXJyeSBvbi4KKwkJCSAqLworCQkJaWYg
KCFmZW5jZSkgeworCQkJCWRybV9zeW5jb2JqX3B1dChzeW5jb2JqKTsKKwkJCQljb250aW51ZTsK
KwkJCX0KKwkJfQorCisJCS8qCisJCSAqIEZvciB0aW1lbGluZSBzeW5jb2JqcyB3ZSBuZWVkIHRv
IHByZWFsbG9jYXRlIGNoYWlucyBmb3IKKwkJICogbGF0ZXIgc2lnbmFsaW5nLgorCQkgKi8KKwkJ
aWYgKHBvaW50ICE9IDAgJiYgdXNlcl9mZW5jZS5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9TSUdO
QUwpIHsKKwkJCWZlbmNlc1tudW1fZmVuY2VzXS5jaGFpbl9mZW5jZSA9CisJCQkJa21hbGxvYyhz
aXplb2YoKmZlbmNlc1tudW1fZmVuY2VzXS5jaGFpbl9mZW5jZSksCisJCQkJCUdGUF9LRVJORUwp
OworCQkJaWYgKCFmZW5jZXNbbnVtX2ZlbmNlc10uY2hhaW5fZmVuY2UpIHsKKwkJCQlkbWFfZmVu
Y2VfcHV0KGZlbmNlKTsKKwkJCQlkcm1fc3luY29ial9wdXQoc3luY29iaik7CisJCQkJZXJyID0g
LUVOT01FTTsKKwkJCQlEUk1fREVCVUcoIlVuYWJsZSB0byBhbGxvYyBjaGFpbl9mZW5jZVxuIik7
CisJCQkJZ290byBlcnI7CisJCQl9CisJCX0gZWxzZSB7CisJCQlmZW5jZXNbbnVtX2ZlbmNlc10u
Y2hhaW5fZmVuY2UgPSBOVUxMOworCQl9CisKKwkJZmVuY2VzW251bV9mZW5jZXNdLnN5bmNvYmog
PSBwdHJfcGFja19iaXRzKHN5bmNvYmosIHVzZXJfZmVuY2UuZmxhZ3MsIDIpOworCQlmZW5jZXNb
bnVtX2ZlbmNlc10uZG1hX2ZlbmNlID0gZmVuY2U7CisJCWZlbmNlc1tudW1fZmVuY2VzXS52YWx1
ZSA9IHBvaW50OworCQludW1fZmVuY2VzKys7CisJfQorCisJKm91dF9uX2ZlbmNlcyA9IG51bV9m
ZW5jZXM7CisKKwlyZXR1cm4gZmVuY2VzOworCitlcnI6CisJX19mcmVlX2ZlbmNlX2FycmF5KGZl
bmNlcywgbnVtX2ZlbmNlcyk7CisJcmV0dXJuIEVSUl9QVFIoZXJyKTsKK30KKworc3RhdGljIHN0
cnVjdCBpOTE1X2ViX2ZlbmNlcyAqCitnZXRfbGVnYWN5X2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1
X2V4ZWNidWZmZXIgKmViLAorCQkgICAgICAgaW50ICpvdXRfbl9mZW5jZXMpCiB7Ci0JY29uc3Qg
dW5zaWduZWQgbG9uZyBuZmVuY2VzID0gYXJncy0+bnVtX2NsaXByZWN0czsKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdzID0gZWItPmFyZ3M7CiAJc3RydWN0IGRybV9pOTE1
X2dlbV9leGVjX2ZlbmNlIF9fdXNlciAqdXNlcjsKLQlzdHJ1Y3QgZHJtX3N5bmNvYmogKipmZW5j
ZXM7CisJc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5jZXM7CisJY29uc3QgdTMyIG51bV9mZW5j
ZXMgPSBhcmdzLT5udW1fY2xpcHJlY3RzOwogCXVuc2lnbmVkIGxvbmcgbjsKIAlpbnQgZXJyOwog
Ci0JaWYgKCEoYXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfQVJSQVkpKQotCQlyZXR1cm4g
TlVMTDsKKwkqb3V0X25fZmVuY2VzID0gbnVtX2ZlbmNlczsKIAogCS8qIENoZWNrIG11bHRpcGxp
Y2F0aW9uIG92ZXJmbG93IGZvciBhY2Nlc3Nfb2soKSBhbmQga3ZtYWxsb2NfYXJyYXkoKSAqLwog
CUJVSUxEX0JVR19PTihzaXplb2Yoc2l6ZV90KSA+IHNpemVvZih1bnNpZ25lZCBsb25nKSk7Ci0J
aWYgKG5mZW5jZXMgPiBtaW5fdCh1bnNpZ25lZCBsb25nLAotCQkJICAgIFVMT05HX01BWCAvIHNp
emVvZigqdXNlciksCi0JCQkgICAgU0laRV9NQVggLyBzaXplb2YoKmZlbmNlcykpKQorCWlmICgq
b3V0X25fZmVuY2VzID4gbWluX3QodW5zaWduZWQgbG9uZywKKwkJCQkgIFVMT05HX01BWCAvIHNp
emVvZigqdXNlciksCisJCQkJICBTSVpFX01BWCAvIHNpemVvZigqZmVuY2VzKSkpCiAJCXJldHVy
biBFUlJfUFRSKC1FSU5WQUwpOwogCiAJdXNlciA9IHU2NF90b191c2VyX3B0cihhcmdzLT5jbGlw
cmVjdHNfcHRyKTsKLQlpZiAoIWFjY2Vzc19vayh1c2VyLCBuZmVuY2VzICogc2l6ZW9mKCp1c2Vy
KSkpCisJaWYgKCFhY2Nlc3Nfb2sodXNlciwgKm91dF9uX2ZlbmNlcyAqIHNpemVvZigqdXNlcikp
KQogCQlyZXR1cm4gRVJSX1BUUigtRUZBVUxUKTsKIAotCWZlbmNlcyA9IGt2bWFsbG9jX2FycmF5
KG5mZW5jZXMsIHNpemVvZigqZmVuY2VzKSwKKwlmZW5jZXMgPSBrdm1hbGxvY19hcnJheSgqb3V0
X25fZmVuY2VzLCBzaXplb2YoKmZlbmNlcyksCiAJCQkJX19HRlBfTk9XQVJOIHwgR0ZQX0tFUk5F
TCk7CiAJaWYgKCFmZW5jZXMpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCi0JZm9yIChu
ID0gMDsgbiA8IG5mZW5jZXM7IG4rKykgewotCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVu
Y2UgZmVuY2U7CisJZm9yIChuID0gMDsgbiA8ICpvdXRfbl9mZW5jZXM7IG4rKykgeworCQlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVuY2UgdXNlcl9mZW5jZTsKIAkJc3RydWN0IGRybV9zeW5j
b2JqICpzeW5jb2JqOworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSA9IE5VTEw7CiAKLQkJaWYg
KF9fY29weV9mcm9tX3VzZXIoJmZlbmNlLCB1c2VyKyssIHNpemVvZihmZW5jZSkpKSB7CisJCWlm
IChfX2NvcHlfZnJvbV91c2VyKCZ1c2VyX2ZlbmNlLCB1c2VyKyssIHNpemVvZih1c2VyX2ZlbmNl
KSkpIHsKIAkJCWVyciA9IC1FRkFVTFQ7CiAJCQlnb3RvIGVycjsKIAkJfQogCi0JCWlmIChmZW5j
ZS5mbGFncyAmIF9fSTkxNV9FWEVDX0ZFTkNFX1VOS05PV05fRkxBR1MpIHsKKwkJaWYgKHVzZXJf
ZmVuY2UuZmxhZ3MgJiBfX0k5MTVfRVhFQ19GRU5DRV9VTktOT1dOX0ZMQUdTKSB7CiAJCQllcnIg
PSAtRUlOVkFMOwogCQkJZ290byBlcnI7CiAJCX0KIAotCQlzeW5jb2JqID0gZHJtX3N5bmNvYmpf
ZmluZChmaWxlLCBmZW5jZS5oYW5kbGUpOworCQlzeW5jb2JqID0gZHJtX3N5bmNvYmpfZmluZChl
Yi0+ZmlsZSwgdXNlcl9mZW5jZS5oYW5kbGUpOwogCQlpZiAoIXN5bmNvYmopIHsKIAkJCURSTV9E
RUJVRygiSW52YWxpZCBzeW5jb2JqIGhhbmRsZSBwcm92aWRlZFxuIik7CiAJCQllcnIgPSAtRU5P
RU5UOwogCQkJZ290byBlcnI7CiAJCX0KIAorCQlpZiAodXNlcl9mZW5jZS5mbGFncyAmIEk5MTVf
RVhFQ19GRU5DRV9XQUlUKSB7CisJCQlmZW5jZSA9IGRybV9zeW5jb2JqX2ZlbmNlX2dldChzeW5j
b2JqKTsKKwkJCWlmICghZmVuY2UpIHsKKwkJCQlEUk1fREVCVUcoIlN5bmNvYmogaGFuZGxlIGhh
cyBubyBmZW5jZVxuIik7CisJCQkJZHJtX3N5bmNvYmpfcHV0KHN5bmNvYmopOworCQkJCWVyciA9
IC1FSU5WQUw7CisJCQkJZ290byBlcnI7CisJCQl9CisJCX0KKwogCQlCVUlMRF9CVUdfT04ofihB
UkNIX0tNQUxMT0NfTUlOQUxJR04gLSAxKSAmCiAJCQkgICAgIH5fX0k5MTVfRVhFQ19GRU5DRV9V
TktOT1dOX0ZMQUdTKTsKIAotCQlmZW5jZXNbbl0gPSBwdHJfcGFja19iaXRzKHN5bmNvYmosIGZl
bmNlLmZsYWdzLCAyKTsKKwkJZmVuY2VzW25dLnN5bmNvYmogPSBwdHJfcGFja19iaXRzKHN5bmNv
YmosIHVzZXJfZmVuY2UuZmxhZ3MsIDIpOworCQlmZW5jZXNbbl0uZG1hX2ZlbmNlID0gZmVuY2U7
CisJCWZlbmNlc1tuXS52YWx1ZSA9IDA7CisJCWZlbmNlc1tuXS5jaGFpbl9mZW5jZSA9IE5VTEw7
CiAJfQogCiAJcmV0dXJuIGZlbmNlczsKQEAgLTIyOTQsMzcgKzI0NDIsNDQgQEAgZ2V0X2ZlbmNl
X2FycmF5KHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgKmFyZ3MsCiAJcmV0dXJuIEVS
Ul9QVFIoZXJyKTsKIH0KIAorc3RhdGljIHN0cnVjdCBpOTE1X2ViX2ZlbmNlcyAqCitnZXRfZmVu
Y2VfYXJyYXkoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIGludCAqb3V0X25fZmVuY2VzKQor
eworCWlmIChlYi0+YXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfQVJSQVkpCisJCXJldHVy
biBnZXRfbGVnYWN5X2ZlbmNlX2FycmF5KGViLCBvdXRfbl9mZW5jZXMpOworCisJaWYgKGViLT5l
eHRlbnNpb25zLmZsYWdzICYgQklUX1VMTChEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRfVElN
RUxJTkVfRkVOQ0VTKSkKKwkJcmV0dXJuIGdldF90aW1lbGluZV9mZW5jZV9hcnJheShlYiwgb3V0
X25fZmVuY2VzKTsKKworCSpvdXRfbl9mZW5jZXMgPSAwOworCXJldHVybiBOVUxMOworfQorCiBz
dGF0aWMgdm9pZAotcHV0X2ZlbmNlX2FycmF5KHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZl
cjIgKmFyZ3MsCi0JCXN0cnVjdCBkcm1fc3luY29iaiAqKmZlbmNlcykKK3B1dF9mZW5jZV9hcnJh
eShzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNlcywgaW50IG5mZW5jZXMpCiB7CiAJaWYgKGZl
bmNlcykKLQkJX19mcmVlX2ZlbmNlX2FycmF5KGZlbmNlcywgYXJncy0+bnVtX2NsaXByZWN0cyk7
CisJCV9fZnJlZV9mZW5jZV9hcnJheShmZW5jZXMsIG5mZW5jZXMpOwogfQogCiBzdGF0aWMgaW50
CiBhd2FpdF9mZW5jZV9hcnJheShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKLQkJICBzdHJ1
Y3QgZHJtX3N5bmNvYmogKipmZW5jZXMpCisJCSAgc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5j
ZXMsCisJCSAgaW50IG5mZW5jZXMpCiB7Ci0JY29uc3QgdW5zaWduZWQgaW50IG5mZW5jZXMgPSBl
Yi0+YXJncy0+bnVtX2NsaXByZWN0czsKIAl1bnNpZ25lZCBpbnQgbjsKIAlpbnQgZXJyOwogCiAJ
Zm9yIChuID0gMDsgbiA8IG5mZW5jZXM7IG4rKykgewogCQlzdHJ1Y3QgZHJtX3N5bmNvYmogKnN5
bmNvYmo7Ci0JCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCQl1bnNpZ25lZCBpbnQgZmxhZ3M7
CiAKLQkJc3luY29iaiA9IHB0cl91bnBhY2tfYml0cyhmZW5jZXNbbl0sICZmbGFncywgMik7CisJ
CXN5bmNvYmogPSBwdHJfdW5wYWNrX2JpdHMoZmVuY2VzW25dLnN5bmNvYmosICZmbGFncywgMik7
CiAJCWlmICghKGZsYWdzICYgSTkxNV9FWEVDX0ZFTkNFX1dBSVQpKQogCQkJY29udGludWU7CiAK
LQkJZmVuY2UgPSBkcm1fc3luY29ial9mZW5jZV9nZXQoc3luY29iaik7Ci0JCWlmICghZmVuY2Up
Ci0JCQlyZXR1cm4gLUVJTlZBTDsKLQotCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2Zl
bmNlKGViLT5yZXF1ZXN0LCBmZW5jZSk7Ci0JCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQllcnIg
PSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKGViLT5yZXF1ZXN0LAorCQkJCQkJICAgZmVu
Y2VzW25dLmRtYV9mZW5jZSk7CiAJCWlmIChlcnIgPCAwKQogCQkJcmV0dXJuIGVycjsKIAl9CkBA
IC0yMzM0LDkgKzI0ODksOSBAQCBhd2FpdF9mZW5jZV9hcnJheShzdHJ1Y3QgaTkxNV9leGVjYnVm
ZmVyICplYiwKIAogc3RhdGljIHZvaWQKIHNpZ25hbF9mZW5jZV9hcnJheShzdHJ1Y3QgaTkxNV9l
eGVjYnVmZmVyICplYiwKLQkJICAgc3RydWN0IGRybV9zeW5jb2JqICoqZmVuY2VzKQorCQkgICBz
dHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNlcywKKwkJICAgaW50IG5mZW5jZXMpCiB7Ci0JY29u
c3QgdW5zaWduZWQgaW50IG5mZW5jZXMgPSBlYi0+YXJncy0+bnVtX2NsaXByZWN0czsKIAlzdHJ1
Y3QgZG1hX2ZlbmNlICogY29uc3QgZmVuY2UgPSAmZWItPnJlcXVlc3QtPmZlbmNlOwogCXVuc2ln
bmVkIGludCBuOwogCkBAIC0yMzQ0LDE1ICsyNDk5LDQ2IEBAIHNpZ25hbF9mZW5jZV9hcnJheShz
dHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJc3RydWN0IGRybV9zeW5jb2JqICpzeW5jb2Jq
OwogCQl1bnNpZ25lZCBpbnQgZmxhZ3M7CiAKLQkJc3luY29iaiA9IHB0cl91bnBhY2tfYml0cyhm
ZW5jZXNbbl0sICZmbGFncywgMik7CisJCXN5bmNvYmogPSBwdHJfdW5wYWNrX2JpdHMoZmVuY2Vz
W25dLnN5bmNvYmosICZmbGFncywgMik7CiAJCWlmICghKGZsYWdzICYgSTkxNV9FWEVDX0ZFTkNF
X1NJR05BTCkpCiAJCQljb250aW51ZTsKIAotCQlkcm1fc3luY29ial9yZXBsYWNlX2ZlbmNlKHN5
bmNvYmosIGZlbmNlKTsKKwkJaWYgKGZlbmNlc1tuXS5jaGFpbl9mZW5jZSkgeworCQkJZHJtX3N5
bmNvYmpfYWRkX3BvaW50KHN5bmNvYmosIGZlbmNlc1tuXS5jaGFpbl9mZW5jZSwKKwkJCQkJICAg
ICAgZmVuY2UsIGZlbmNlc1tuXS52YWx1ZSk7CisJCQkvKgorCQkJICogVGhlIGNoYWluJ3Mgb3du
ZXJzaGlwIGlzIHRyYW5zZmVyZWQgdG8gdGhlCisJCQkgKiB0aW1lbGluZS4KKwkJCSAqLworCQkJ
ZmVuY2VzW25dLmNoYWluX2ZlbmNlID0gTlVMTDsKKwkJfSBlbHNlIHsKKwkJCWRybV9zeW5jb2Jq
X3JlcGxhY2VfZmVuY2Uoc3luY29iaiwgZmVuY2UpOworCQl9CiAJfQogfQogCitzdGF0aWMgaW50
IHBhcnNlX3RpbWVsaW5lX2ZlbmNlcyhzdHJ1Y3QgaTkxNV91c2VyX2V4dGVuc2lvbiBfX3VzZXIg
KmV4dCwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiA9IGRhdGE7
CisKKwkvKiBUaW1lbGluZSBmZW5jZXMgYXJlIGluY29tcGF0aWJsZSB3aXRoIHRoZSBmZW5jZSBh
cnJheSBmbGFnLiAqLworCWlmIChlYi0+YXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfQVJS
QVkpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKGViLT5leHRlbnNpb25zLmZsYWdzICYgQklU
X1VMTChEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRfVElNRUxJTkVfRkVOQ0VTKSkKKwkJcmV0
dXJuIC1FSU5WQUw7CisKKwlpZiAoY29weV9mcm9tX3VzZXIoJmViLT5leHRlbnNpb25zLnRpbWVs
aW5lX2ZlbmNlcywgZXh0LAorCQkJICAgc2l6ZW9mKGViLT5leHRlbnNpb25zLnRpbWVsaW5lX2Zl
bmNlcykpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWViLT5leHRlbnNpb25zLmZsYWdzIHw9IEJJ
VF9VTEwoRFJNX0k5MTVfR0VNX0VYRUNCVUZGRVJfRVhUX1RJTUVMSU5FX0ZFTkNFUyk7CisKKwly
ZXR1cm4gMDsKK30KKwogc3RhdGljIGNvbnN0IGk5MTVfdXNlcl9leHRlbnNpb25fZm4gZXhlY2J1
Zl9leHRlbnNpb25zW10gPSB7CisgICAgICAgIFtEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRf
VElNRUxJTkVfRkVOQ0VTXSA9IHBhcnNlX3RpbWVsaW5lX2ZlbmNlcywKIH07CiAKIHN0YXRpYyBp
bnQKQEAgLTIzNzcsMTQgKzI1NjMsMTUgQEAgc3RhdGljIGludAogaTkxNV9nZW1fZG9fZXhlY2J1
ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkgICAgICAgc3RydWN0IGRybV9maWxlICpm
aWxlLAogCQkgICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiAqYXJncywKLQkJ
ICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyICpleGVjLAotCQkgICAgICAg
c3RydWN0IGRybV9zeW5jb2JqICoqZmVuY2VzKQorCQkgICAgICAgc3RydWN0IGRybV9pOTE1X2dl
bV9leGVjX29iamVjdDIgKmV4ZWMpCiB7CiAJc3RydWN0IGk5MTVfZXhlY2J1ZmZlciBlYjsKIAlz
dHJ1Y3QgZG1hX2ZlbmNlICppbl9mZW5jZSA9IE5VTEw7CiAJc3RydWN0IGRtYV9mZW5jZSAqZXhl
Y19mZW5jZSA9IE5VTEw7CiAJc3RydWN0IHN5bmNfZmlsZSAqb3V0X2ZlbmNlID0gTlVMTDsKKwlz
dHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNlcyA9IE5VTEw7CiAJaW50IG91dF9mZW5jZV9mZCA9
IC0xOworCWludCBuZmVuY2VzID0gMDsKIAlpbnQgZXJyOwogCiAJQlVJTERfQlVHX09OKF9fRVhF
Q19JTlRFUk5BTF9GTEFHUyAmIH5fX0k5MTVfRVhFQ19JTExFR0FMX0ZMQUdTKTsKQEAgLTI0MjMs
MTAgKzI2MTAsMTYgQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LAogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKKwlmZW5jZXMgPSBnZXRfZmVuY2VfYXJy
YXkoJmViLCAmbmZlbmNlcyk7CisJaWYgKElTX0VSUihmZW5jZXMpKQorCQlyZXR1cm4gUFRSX0VS
UihmZW5jZXMpOworCiAJaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9FWEVDX0ZFTkNFX0lOKSB7CiAJ
CWluX2ZlbmNlID0gc3luY19maWxlX2dldF9mZW5jZShsb3dlcl8zMl9iaXRzKGFyZ3MtPnJzdmQy
KSk7Ci0JCWlmICghaW5fZmVuY2UpCi0JCQlyZXR1cm4gLUVJTlZBTDsKKwkJaWYgKCFpbl9mZW5j
ZSkgeworCQkJZXJyID0gLUVJTlZBTDsKKwkJCWdvdG8gZXJyX2ZlbmNlczsKKwkJfQogCX0KIAog
CWlmIChhcmdzLT5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9TVUJNSVQpIHsKQEAgLTI1ODQsNyAr
Mjc3Nyw3IEBAIGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwK
IAl9CiAKIAlpZiAoZmVuY2VzKSB7Ci0JCWVyciA9IGF3YWl0X2ZlbmNlX2FycmF5KCZlYiwgZmVu
Y2VzKTsKKwkJZXJyID0gYXdhaXRfZmVuY2VfYXJyYXkoJmViLCBmZW5jZXMsIG5mZW5jZXMpOwog
CQlpZiAoZXJyKQogCQkJZ290byBlcnJfcmVxdWVzdDsKIAl9CkBAIC0yNjEzLDcgKzI4MDYsNyBA
QCBpOTE1X2dlbV9kb19leGVjYnVmZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaTkxNV9y
ZXF1ZXN0X2FkZChlYi5yZXF1ZXN0KTsKIAogCWlmIChmZW5jZXMpCi0JCXNpZ25hbF9mZW5jZV9h
cnJheSgmZWIsIGZlbmNlcyk7CisJCXNpZ25hbF9mZW5jZV9hcnJheSgmZWIsIGZlbmNlcywgbmZl
bmNlcyk7CiAKIAlpZiAob3V0X2ZlbmNlKSB7CiAJCWlmIChlcnIgPT0gMCkgewpAQCAtMjY0OCw2
ICsyODQxLDggQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAogCWRtYV9mZW5jZV9wdXQoZXhlY19mZW5jZSk7CiBlcnJfaW5fZmVuY2U6CiAJZG1hX2ZlbmNl
X3B1dChpbl9mZW5jZSk7CitlcnJfZmVuY2VzOgorCXB1dF9mZW5jZV9hcnJheShmZW5jZXMsIG5m
ZW5jZXMpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTI3NDEsNyArMjkzNiw3IEBAIGk5MTVfZ2Vt
X2V4ZWNidWZmZXJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJ
CWV4ZWMyX2xpc3RbaV0uZmxhZ3MgPSAwOwogCX0KIAotCWVyciA9IGk5MTVfZ2VtX2RvX2V4ZWNi
dWZmZXIoZGV2LCBmaWxlLCAmZXhlYzIsIGV4ZWMyX2xpc3QsIE5VTEwpOworCWVyciA9IGk5MTVf
Z2VtX2RvX2V4ZWNidWZmZXIoZGV2LCBmaWxlLCAmZXhlYzIsIGV4ZWMyX2xpc3QpOwogCWlmIChl
eGVjMi5mbGFncyAmIF9fRVhFQ19IQVNfUkVMT0MpIHsKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9l
eGVjX29iamVjdCBfX3VzZXIgKnVzZXJfZXhlY19saXN0ID0KIAkJCXU2NF90b191c2VyX3B0cihh
cmdzLT5idWZmZXJzX3B0cik7CkBAIC0yNzcyLDcgKzI5NjcsNiBAQCBpOTE1X2dlbV9leGVjYnVm
ZmVyMl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogewogCXN0cnVj
dCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgKmFyZ3MgPSBkYXRhOwogCXN0cnVjdCBkcm1faTkx
NV9nZW1fZXhlY19vYmplY3QyICpleGVjMl9saXN0OwotCXN0cnVjdCBkcm1fc3luY29iaiAqKmZl
bmNlcyA9IE5VTEw7CiAJY29uc3Qgc2l6ZV90IGNvdW50ID0gYXJncy0+YnVmZmVyX2NvdW50Owog
CWludCBlcnI7CiAKQEAgLTI4MDAsMTUgKzI5OTQsNyBAQCBpOTE1X2dlbV9leGVjYnVmZmVyMl9p
b2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQlyZXR1cm4gLUVGQVVM
VDsKIAl9CiAKLQlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfQVJSQVkpIHsKLQkJ
ZmVuY2VzID0gZ2V0X2ZlbmNlX2FycmF5KGFyZ3MsIGZpbGUpOwotCQlpZiAoSVNfRVJSKGZlbmNl
cykpIHsKLQkJCWt2ZnJlZShleGVjMl9saXN0KTsKLQkJCXJldHVybiBQVFJfRVJSKGZlbmNlcyk7
Ci0JCX0KLQl9Ci0KLQllcnIgPSBpOTE1X2dlbV9kb19leGVjYnVmZmVyKGRldiwgZmlsZSwgYXJn
cywgZXhlYzJfbGlzdCwgZmVuY2VzKTsKKwllcnIgPSBpOTE1X2dlbV9kb19leGVjYnVmZmVyKGRl
diwgZmlsZSwgYXJncywgZXhlYzJfbGlzdCk7CiAKIAkvKgogCSAqIE5vdyB0aGF0IHdlIGhhdmUg
YmVndW4gZXhlY3V0aW9uIG9mIHRoZSBiYXRjaGJ1ZmZlciwgd2UgaWdub3JlCkBAIC0yODQ4LDcg
KzMwMzQsNiBAQCBlbmQ6OwogCX0KIAogCWFyZ3MtPmZsYWdzICY9IH5fX0k5MTVfRVhFQ19VTktO
T1dOX0ZMQUdTOwotCXB1dF9mZW5jZV9hcnJheShhcmdzLCBmZW5jZXMpOwogCWt2ZnJlZShleGVj
Ml9saXN0KTsKIAlyZXR1cm4gZXJyOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggZjcw
YWQ3YWRhZWE1Li45NDA2MjE4OGM1MjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtNDU3
LDYgKzQ1Nyw3IEBAIHN0YXRpYyBpbnQgaTkxNV9nZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWNhc2UgSTkxNV9QQVJBTV9IQVNfRVhFQ19CQVRDSF9G
SVJTVDoKIAljYXNlIEk5MTVfUEFSQU1fSEFTX0VYRUNfRkVOQ0VfQVJSQVk6CiAJY2FzZSBJOTE1
X1BBUkFNX0hBU19FWEVDX1NVQk1JVF9GRU5DRToKKwljYXNlIEk5MTVfUEFSQU1fSEFTX0VYRUNf
VElNRUxJTkVfRkVOQ0VTOgogCQkvKiBGb3IgdGhlIHRpbWUgYmVpbmcgYWxsIG9mIHRoZXNlIGFy
ZSBhbHdheXMgdHJ1ZTsKIAkJICogaWYgc29tZSBzdXBwb3J0ZWQgaGFyZHdhcmUgZG9lcyBub3Qg
aGF2ZSBvbmUgb2YgdGhlc2UKIAkJICogZmVhdHVyZXMgdGhpcyB2YWx1ZSBuZWVkcyB0byBiZSBw
cm92aWRlZCBmcm9tCkBAIC0zMjIwLDcgKzMyMjEsOCBAQCBzdGF0aWMgc3RydWN0IGRybV9kcml2
ZXIgZHJpdmVyID0gewogCSAqLwogCS5kcml2ZXJfZmVhdHVyZXMgPQogCSAgICBEUklWRVJfR0VN
IHwKLQkgICAgRFJJVkVSX1JFTkRFUiB8IERSSVZFUl9NT0RFU0VUIHwgRFJJVkVSX0FUT01JQyB8
IERSSVZFUl9TWU5DT0JKLAorCSAgICBEUklWRVJfUkVOREVSIHwgRFJJVkVSX01PREVTRVQgfCBE
UklWRVJfQVRPTUlDIHwgRFJJVkVSX1NZTkNPQkogfAorCSAgICBEUklWRVJfU1lOQ09CSl9USU1F
TElORSwKIAkucmVsZWFzZSA9IGk5MTVfZHJpdmVyX3JlbGVhc2UsCiAJLm9wZW4gPSBpOTE1X2Ry
aXZlcl9vcGVuLAogCS5sYXN0Y2xvc2UgPSBpOTE1X2RyaXZlcl9sYXN0Y2xvc2UsCmRpZmYgLS1n
aXQgYS9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVf
ZHJtLmgKaW5kZXggN2Q2MWY1M2ExYzE1Li5lNWFjMTE3NGMwMWUgMTAwNjQ0Ci0tLSBhL2luY2x1
ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAorKysgYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgK
QEAgLTYxOCw2ICs2MTgsMTIgQEAgdHlwZWRlZiBzdHJ1Y3QgZHJtX2k5MTVfaXJxX3dhaXQgewog
ICovCiAjZGVmaW5lIEk5MTVfUEFSQU1fUEVSRl9SRVZJU0lPTgk1NAogCisvKiBRdWVyeSB3aGV0
aGVyIERSTV9JOTE1X0dFTV9FWEVDQlVGRkVSMiBzdXBwb3J0cyBzdXBwbHlpbmcgYW4gYXJyYXkg
b2YKKyAqIHRpbWVsaW5lIHN5bmNvYmogdGhyb3VnaCBkcm1faTkxNV9nZW1fZXhlY2J1Zl9leHRf
dGltZWxpbmVfZmVuY2VzLiBTZWUKKyAqIEk5MTVfRVhFQ19FWFQuCisgKi8KKyNkZWZpbmUgSTkx
NV9QQVJBTV9IQVNfRVhFQ19USU1FTElORV9GRU5DRVMgNTUKKwogLyogTXVzdCBiZSBrZXB0IGNv
bXBhY3QgLS0gbm8gaG9sZXMgYW5kIHdlbGwgZG9jdW1lbnRlZCAqLwogCiB0eXBlZGVmIHN0cnVj
dCBkcm1faTkxNV9nZXRwYXJhbSB7CkBAIC0xMDE1LDkgKzEwMjEsNDEgQEAgc3RydWN0IGRybV9p
OTE1X2dlbV9leGVjX2ZlbmNlIHsKIH07CiAKIGVudW0gZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXJf
ZXh0IHsKKwkvKioKKwkgKiBTZWUgZHJtX2k5MTVfZ2VtX2V4ZWNidWZfZXh0X3RpbWVsaW5lX2Zl
bmNlcy4KKwkgKi8KKwlEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRfVElNRUxJTkVfRkVOQ0VT
ID0gMCwKKwogCURSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9NQVggLyogbm9uLUFCSSAqLwog
fTsKIAorLyoqCisgKiBUaGlzIHN0cnVjdHVyZSBkZXNjcmliZXMgYW4gYXJyYXkgb2YgZHJtX3N5
bmNvYmogYW5kIGFzc29jaWF0ZWQgcG9pbnRzIGZvcgorICogdGltZWxpbmUgdmFyaWFudHMgb2Yg
ZHJtX3N5bmNvYmouIEl0IGlzIGludmFsaWQgdG8gYXBwZW5kIHRoaXMgc3RydWN0dXJlIHRvCisg
KiB0aGUgZXhlY2J1ZiBpZiBJOTE1X0VYRUNfRkVOQ0VfQVJSQVkgaXMgc2V0LgorICovCitzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXJfZXh0X3RpbWVsaW5lX2ZlbmNlcyB7CisJc3RydWN0
IGk5MTVfdXNlcl9leHRlbnNpb24gYmFzZTsKKworCS8qKgorCSAqIE51bWJlciBvZiBlbGVtZW50
IGluIHRoZSBoYW5kbGVzX3B0ciAmIHZhbHVlX3B0ciBhcnJheXMuCisJICovCisJX191NjQgZmVu
Y2VfY291bnQ7CisKKwkvKioKKwkgKiBQb2ludGVyIHRvIGFuIGFycmF5IG9mIHN0cnVjdCBkcm1f
aTkxNV9nZW1fZXhlY19mZW5jZSBvZiBsZW5ndGgKKwkgKiBmZW5jZV9jb3VudC4KKwkgKi8KKwlf
X3U2NCBoYW5kbGVzX3B0cjsKKworCS8qKgorCSAqIFBvaW50ZXIgdG8gYW4gYXJyYXkgb2YgdTY0
IHZhbHVlcyBvZiBsZW5ndGggZmVuY2VfY291bnQuIFZhbHVlcworCSAqIG11c3QgYmUgMCBmb3Ig
YSBiaW5hcnkgZHJtX3N5bmNvYmouIEEgVmFsdWUgb2YgMCBmb3IgYSB0aW1lbGluZQorCSAqIGRy
bV9zeW5jb2JqIGlzIGludmFsaWQgYXMgaXQgdHVybnMgYSBkcm1fc3luY29iaiBpbnRvIGEgYmlu
YXJ5IG9uZS4KKwkgKi8KKwlfX3U2NCB2YWx1ZXNfcHRyOworfTsKKwogc3RydWN0IGRybV9pOTE1
X2dlbV9leGVjYnVmZmVyMiB7CiAJLyoqCiAJICogTGlzdCBvZiBnZW1fZXhlY19vYmplY3QyIHN0
cnVjdHMKLS0gCjIuMjEuMC4zOTIuZ2Y4ZjY3ODcxNTllCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

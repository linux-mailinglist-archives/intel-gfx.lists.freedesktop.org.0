Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 875A4FBB11
	for <lists+intel-gfx@lfdr.de>; Wed, 13 Nov 2019 22:47:57 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E93DA6E0C4;
	Wed, 13 Nov 2019 21:47:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 93CF76E0C4;
 Wed, 13 Nov 2019 21:47:54 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19193259-1500050 
 for multiple; Wed, 13 Nov 2019 21:47:38 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 13 Nov 2019 21:47:37 +0000
Message-Id: <20191113214737.27121-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] igt: Use COND_BBEND for busy spinning on
 gen9
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org, Joonas Lahtinen <joonas.lahtinen@intel.com>,
 Mika Kuoppala <mika.kuoppala@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVsLmNvbT4KCmdlbjkrIGlu
dHJvZHVjZXMgYSBjbWRwYXJzZXIgZm9yIHRoZSBCTFQgZW5naW5lIHdoaWNoIGNvcGllcyB0aGUK
aW5jb21pbmcgQkIgdG8gYSBrbWQgb3duZWQgYnVmZmVyIGZvciBzdWJtaXNzaW9uICh0byBwcmV2
ZW50IGNoYW5nZXMKYmVpbmcgbWFkZSBhZnRlciB0aGUgYmIgaGFzIGJlZW4gc2FmZWx5IHNjYW5u
ZWQpLiBUaGlzIGJyZWFrcyB0aGUKc3BpbiBmdW5jdGlvbmFsaXR5IGJlY2F1c2UgaXQgcmVsaWVz
IG9uIGNoYW5naW5nIHRoZSBzdWJtaXR0ZWQgc3BpbgpidWZmZXJzIGluIG9yZGVyIHRvIHRlcm1p
bmF0ZSB0aGVtLgoKSW5zdGVhZCwgZm9yIGdlbjkrLCB3ZSBjaGFuZ2UgdGhlIHNlbWFudGljcyBi
eSBpbnRyb2R1Y2luZyBhIENPTkRfQkJfRU5ECmludG8gdGhlIGluZmluaXRlIGxvb3AsIHRvIHdh
aXQgdW50aWwgYSBtZW1vcnkgZmxhZyAoaW4gYW5vdGhlIGJvKSBpcwpjbGVhcmVkLgoKdjI6IENv
cnJlY3Qgbm9wIGxlbmd0aCB0byBhdm9pZCBvdmVyd3JpdGluZyBiYl9lbmQgaW5zdHIgd2hlbiB1
c2luZwogICAgYSBkZXBlbmRlbmN5IGJvIChjb3JrKQp2MzogZml4IGNvbmZsaWN0cyBvbiBpZ3Rf
ZHVtbXlsb2FkIChNaWthKQp2NDogcy9ib29sIHJ1bm5pbmcvdWludDMyX3QgcnVubmluZywgZml4
IHItPmRlbHRhIChNaWthKQp2NTogcmVtb3ZlIG92ZXJ6ZWFsb3VzIGFzc2VydCAoTWlrYSkKdjY6
IHJlYmFzZSBvbiB0b3Agb2YgbGliIGNoYW5nZXMgKE1pa2EpCnY3OiByZXdvcmsgb24gdG9wIG9m
IHB1YmxpYyBpZ3QgbGliIGNoYW5nZXMgKE1pa2EpCnY4OiByZWJhc2UKdjk6IHNpbXBsaWZ5IGJ5
IHVzaW5nIGJiIGVuZCBhcyBjb25kaXRpb25hbCAoQ2hyaXMpCgpTaWduZWQtb2ZmLWJ5OiBKb24g
Qmxvb21maWVsZCA8am9uLmJsb29tZmllbGRAaW50ZWwuY29tPiAodjIpCkNjOiBKb29uYXMgTGFo
dGluZW4gPGpvb25hcy5sYWh0aW5lbkBpbnRlbC5jb20+CkNjOiBSb2RyaWdvIFZpdmkgPHJvZHJp
Z28udml2aUBpbnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGludGVs
LmNvbT4KU2lnbmVkLW9mZi1ieTogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5p
bnRlbC5jb20+Ci0tLQogbGliL2k4MzBfcmVnLmggICAgICAgICAgICAgICAgICAgICAgICAgIHwg
IDMgLS0KIGxpYi9pZ3RfZHVtbXlsb2FkLmMgICAgICAgICAgICAgICAgICAgICB8IDM5ICsrKysr
KysrKysrKysrKysrKysrKysrLS0KIGxpYi9pbnRlbF9yZWcuaCAgICAgICAgICAgICAgICAgICAg
ICAgICB8ICAzICsrCiB0ZXN0cy9pOTE1L2dlbV9kb3VibGVfaXJxX2xvb3AuYyAgICAgICAgfCAg
MiAtLQogdGVzdHMvaTkxNS9nZW1fd3JpdGVfcmVhZF9yaW5nX3N3aXRjaC5jIHwgIDIgKy0KIDUg
ZmlsZXMgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygrKSwgOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9saWIvaTgzMF9yZWcuaCBiL2xpYi9pODMwX3JlZy5oCmluZGV4IGE1NzY5MWM3ZS4uYjhh
ZDJhYzAwIDEwMDY0NAotLS0gYS9saWIvaTgzMF9yZWcuaAorKysgYi9saWIvaTgzMF9yZWcuaApA
QCAtNDMsOSArNDMsNiBAQAogLyogYnJvYWR3YXRlciBmbHVzaCBiaXRzICovCiAjZGVmaW5lIEJS
V19NSV9HTE9CQUxfU05BUFNIT1RfUkVTRVQgICAoMSA8PCAzKQogCi0jZGVmaW5lIE1JX0NPTkRf
QkFUQ0hfQlVGRkVSX0VORAkoMHgzNjw8MjMgfCAxKQotI2RlZmluZSBNSV9ET19DT01QQVJFCQkJ
KDE8PDIxKQotCiAjZGVmaW5lIE1JX0JBVENIX0JVRkZFUl9FTkQJKDB4QSA8PCAyMykKIAogLyog
Tm9vcCAqLwpkaWZmIC0tZ2l0IGEvbGliL2lndF9kdW1teWxvYWQuYyBiL2xpYi9pZ3RfZHVtbXls
b2FkLmMKaW5kZXggYjllMjM5ZGIzLi5jZmQwZTc1YTggMTAwNjQ0Ci0tLSBhL2xpYi9pZ3RfZHVt
bXlsb2FkLmMKKysrIGIvbGliL2lndF9kdW1teWxvYWQuYwpAQCAtNzUsNyArNzUsNyBAQCBlbWl0
X3JlY3Vyc2l2ZV9iYXRjaChpZ3Rfc3Bpbl90ICpzcGluLAogI2RlZmluZSBTQ1JBVENIIDAKICNk
ZWZpbmUgQkFUQ0ggSUdUX1NQSU5fQkFUQ0gKIAljb25zdCBpbnQgZ2VuID0gaW50ZWxfZ2VuKGlu
dGVsX2dldF9kcm1fZGV2aWQoZmQpKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRpb25f
ZW50cnkgcmVsb2NzWzJdLCAqcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRpb25fZW50
cnkgcmVsb2NzWzNdLCAqcjsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICpleGVj
YnVmOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyICpvYmo7CiAJdW5zaWduZWQg
aW50IGZsYWdzW0dFTV9NQVhfRU5HSU5FU107CkBAIC0yMDUsNyArMjA1LDQyIEBAIGVtaXRfcmVj
dXJzaXZlX2JhdGNoKGlndF9zcGluX3QgKnNwaW4sCiAJICogdHJvdWJsZS4gU2VlIGh0dHBzOi8v
YnVncy5mcmVlZGVza3RvcC5vcmcvc2hvd19idWcuY2dpP2lkPTEwMjI2MgogCSAqLwogCWlmICgh
KG9wdHMtPmZsYWdzICYgSUdUX1NQSU5fRkFTVCkpCi0JCWNzICs9IDEwMDA7CisJCWNzICs9IDk2
MDsKKworCS8qCisJICogV2hlbiB1c2luZyBhIGNtZHBhcnNlciwgdGhlIGJhdGNoIGlzIGNvcGll
ZCBpbnRvIGEgcmVhZCBvbmx5IGxvY2F0aW9uCisJICogYW5kIHZhbGlkYXRlZC4gV2UgYXJlIHRo
ZW4gdW5hYmxlIHRvIGFsdGVyIHRoZSBleGVjdXRpbmcgYmF0Y2gsCisJICogYnJlYWtpbmcgdGhl
IG9sZGVyICpzcGluLT5jb25kaXRpb24gPSBNSV9CQl9FTkQgdGVybWluYXRpb24uCisJICogSW5z
dGVhZCB3ZSBjYW4gdXNlIGEgY29uZGl0aW9uYWwgTUlfQkJfRU5EIGhlcmUgdGhhdCBsb29rcyBh
dAorCSAqIHRoZSB1c2VyJ3MgY29weSBvZiB0aGUgYmF0Y2ggYW5kIHRlcm1pbmF0ZXMgd2hlbiB0
aGV5IG1vZGlmaWVkIGl0LAorCSAqIG5vIG1hdHRlciBob3cgdGhleSBtb2RpZnkgaXQgKGZyb20g
ZWl0aGVyIHRoZSBHUFUgb3IgQ1BVKS4KKwkgKi8KKwlpZiAoZ2VuID49IDgpIHsgLyogYXJiaXRy
YXJ5IGN1dG9mZiBiZXR3ZWVuIHJpbmcvZXhlY2xpc3RzIHN1Ym1pc3Npb24gKi8KKwkJciA9ICZy
ZWxvY3Nbb2JqW0JBVENIXS5yZWxvY2F0aW9uX2NvdW50KytdOworCisJCS8qCisJCSAqIE9uIFNh
bmR5YnJpZGdlKyB0aGUgY29tcGFyaXNvbiBpcyBhIHN0cmljdCBncmVhdGVyLXRoYW46CisJCSAq
IGlmIHRoZSB2YWx1ZSBhdCBzcGluLT5jb25kaXRpb24gaXMgZ3JlYXRlciB0aGFuIEJCX0VORCwK
KwkJICogd2UgbG9vcCBiYWNrIHRvIHRoZSBiZWdpbm5pbmcuCisJCSAqIEJlZ2lubmluZyB3aXRo
IEthYnlsYWtlLCB3ZSBjYW4gc2VsZWN0IHRoZSBjb21wYXJpc29uIG1vZGUKKwkJICogYW5kIGxv
b3AgYmFjayB0byB0aGUgYmVnaW5uaW5nIGlmIHNwaW4tPmNvbmRpdGlvbiAhPSBCQl9FTkQKKwkJ
ICogKHVzaW5nIDUgPDwgMTIpLgorCQkgKiBGb3Igc2ltcGxpY2l0eSwgd2UgdHJ5IHRvIHN0aWNr
IHRvIGEgb25lLXNpemUgZml0cyBhbGwuCisJCSAqLworCQlzcGluLT5jb25kaXRpb24gPSBiYXRj
aCArIEJBVENIX1NJWkUgLyBzaXplb2YoKmJhdGNoKSAtIDE7CisJCSpzcGluLT5jb25kaXRpb24g
PSAweGZmZmZmZmZmOworCisJCXItPnByZXN1bWVkX29mZnNldCA9IDA7CisJCXItPnRhcmdldF9o
YW5kbGUgPSBvYmpbQkFUQ0hdLmhhbmRsZTsKKwkJci0+b2Zmc2V0ID0gKGNzICsgMiAtIGJhdGNo
KSAqIHNpemVvZigqY3MpOworCQlyLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fQ09N
TUFORDsKKwkJci0+ZGVsdGEgPSAoc3Bpbi0+Y29uZGl0aW9uIC0gYmF0Y2gpICogc2l6ZW9mKCpj
cyk7CisKKwkJKmNzKysgPSBNSV9DT05EX0JBVENIX0JVRkZFUl9FTkQgfCBNSV9ET19DT01QQVJF
IHwgMjsKKwkJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCQkqY3MrKyA9IHItPmRlbHRh
OworCQkqY3MrKyA9IDA7CisJfQogCiAJLyogcmVjdXJzZSAqLwogCXIgPSAmcmVsb2NzW29ialtC
QVRDSF0ucmVsb2NhdGlvbl9jb3VudCsrXTsKZGlmZiAtLWdpdCBhL2xpYi9pbnRlbF9yZWcuaCBi
L2xpYi9pbnRlbF9yZWcuaAppbmRleCAwNjk0NDBjYjcuLjdiMTFmZWRkOSAxMDA2NDQKLS0tIGEv
bGliL2ludGVsX3JlZy5oCisrKyBiL2xpYi9pbnRlbF9yZWcuaApAQCAtMjU5Myw2ICsyNTkzLDkg
QEAgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUu
CiAjZGVmaW5lIE1JX0JBVENIX0JVRkZFUgkJKCgweDMwIDw8IDIzKSB8IDEpCiAjZGVmaW5lIE1J
X0JBVENIX0JVRkZFUl9TVEFSVAkoMHgzMSA8PCAyMykKICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVS
X0VORAkoMHhBIDw8IDIzKQorI2RlZmluZSBNSV9DT05EX0JBVENIX0JVRkZFUl9FTkQJKDB4MzYg
PDwgMjMpCisjZGVmaW5lIE1JX0RPX0NPTVBBUkUgICAgICAgICAgICAgICAgICAgKDEgPDwgMjEp
CisKICNkZWZpbmUgTUlfQkFUQ0hfTk9OX1NFQ1VSRQkJKDEpCiAjZGVmaW5lIE1JX0JBVENIX05P
Tl9TRUNVUkVfSTk2NQkoMSA8PCA4KQogI2RlZmluZSBNSV9CQVRDSF9OT05fU0VDVVJFX0hTVwkJ
KDE8PDEzKSAvKiBBZGRpdGlvbmFsIGJpdCBmb3IgUkNTICovCmRpZmYgLS1naXQgYS90ZXN0cy9p
OTE1L2dlbV9kb3VibGVfaXJxX2xvb3AuYyBiL3Rlc3RzL2k5MTUvZ2VtX2RvdWJsZV9pcnFfbG9v
cC5jCmluZGV4IGIzMjZmYzU4YS4uZjE3ZjYxYzE5IDEwMDY0NAotLS0gYS90ZXN0cy9pOTE1L2dl
bV9kb3VibGVfaXJxX2xvb3AuYworKysgYi90ZXN0cy9pOTE1L2dlbV9kb3VibGVfaXJxX2xvb3Au
YwpAQCAtNTIsOCArNTIsNiBAQCBzdGF0aWMgZHJtX2ludGVsX2JvICp0YXJnZXRfYnVmZmVyLCAq
Ymx0X2JvOwogSUdUX1RFU1RfREVTQ1JJUFRJT04oIkJhc2ljIGNoZWNrIGZvciBtaXNzZWQgSVJR
cyBvbiBibHQgcmluZy4iKTsKIAogCi0jZGVmaW5lIE1JX0NPTkRfQkFUQ0hfQlVGRkVSX0VORAko
MHgzNjw8MjMgfCAxKQotI2RlZmluZSBNSV9ET19DT01QQVJFCQkJKDE8PDIxKQogc3RhdGljIHZv
aWQKIGR1bW15X3JlbG9jX2xvb3Aodm9pZCkKIHsKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2Vt
X3dyaXRlX3JlYWRfcmluZ19zd2l0Y2guYyBiL3Rlc3RzL2k5MTUvZ2VtX3dyaXRlX3JlYWRfcmlu
Z19zd2l0Y2guYwppbmRleCBlZjIyOWNjNTkuLjA5NWMxM2MzNCAxMDA2NDQKLS0tIGEvdGVzdHMv
aTkxNS9nZW1fd3JpdGVfcmVhZF9yaW5nX3N3aXRjaC5jCisrKyBiL3Rlc3RzL2k5MTUvZ2VtX3dy
aXRlX3JlYWRfcmluZ19zd2l0Y2guYwpAQCAtMTE1LDcgKzExNSw3IEBAIHN0YXRpYyB2b2lkIHJ1
bl90ZXN0KGludCByaW5nKQogCSAqIG90aGVyd2lzZSB0aGUgb2JqLT5sYXN0X3dyaXRlX3NlcW5v
IHdpbGwgYmUgdXBkYXRlZC4gKi8KIAlpZiAocmluZyA9PSBJOTE1X0VYRUNfUkVOREVSKSB7CiAJ
CUJFR0lOX0JBVENIKDQsIDEpOwotCQlPVVRfQkFUQ0goTUlfQ09ORF9CQVRDSF9CVUZGRVJfRU5E
IHwgTUlfRE9fQ09NUEFSRSk7CisJCU9VVF9CQVRDSChNSV9DT05EX0JBVENIX0JVRkZFUl9FTkQg
fCBNSV9ET19DT01QQVJFIHwgMSk7CiAJCU9VVF9CQVRDSCgweGZmZmZmZmZmKTsgLyogY29tcGFy
ZSBkd29yZCAqLwogCQlPVVRfUkVMT0ModGFyZ2V0X2JvLCBJOTE1X0dFTV9ET01BSU5fUkVOREVS
LCAwLCAwKTsKIAkJT1VUX0JBVENIKE1JX05PT1ApOwotLSAKMi4yNC4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

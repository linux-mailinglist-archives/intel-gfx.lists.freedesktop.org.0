Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 48E8085BBC
	for <lists+intel-gfx@lfdr.de>; Thu,  8 Aug 2019 09:42:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9B15F6E793;
	Thu,  8 Aug 2019 07:42:45 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C78766E793
 for <intel-gfx@lists.freedesktop.org>; Thu,  8 Aug 2019 07:42:43 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17926061-1500050 
 for multiple; Thu, 08 Aug 2019 08:42:12 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  8 Aug 2019 08:42:06 +0100
Message-Id: <20190808074207.18274-18-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190808074207.18274-1-chris@chris-wilson.co.uk>
References: <20190808074207.18274-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 18/19] drm/i915: Extract intel_frontbuffer
 active tracking
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW92ZSB0aGUgYWN0aXZlIHRyYWNraW5nIGZvciB0aGUgZnJvbnRidWZmZXIgb3BlcmF0aW9ucyBv
dXQgb2YgdGhlCmk5MTVfZ2VtX29iamVjdCBhbmQgaW50byBpdHMgb3duIGZpcnN0IGNsYXNzIChy
ZWZjb3VudGVkKSBvYmplY3QuIEluIHRoZQpwcm9jZXNzIG9mIGRldGFuZ2xpbmcsIHdlIHN3aXRj
aCBmcm9tIGxvdyBsZXZlbCByZXF1ZXN0IHRyYWNraW5nIHRvIHRoZQplYXNpZXIgaTkxNV9hY3Rp
dmUgLS0gd2l0aCB0aGUgcGxhbiB0aGF0IHRoaXMgYXZvaWRzIGFueSBwb3RlbnRpYWwKYXRvbWlj
IGNhbGxiYWNrcyBhcyB0aGUgZnJvbnRidWZmZXIgdHJhY2tpbmcgd2lzaGVzIHRvIHNsZWVwIGFz
IGl0CmZsdXNoZXMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KLS0tCiBEb2N1bWVudGF0aW9uL2dwdS9pOTE1LnJzdCAgICAgICAgICAgICAg
ICAgICAgfCAgIDMgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMgIHwgIDcwICsrKy0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVz
LmggICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5j
ICAgIHwgIDQwICsrLQogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zyb250YnVmZmVy
LmMgIHwgMjU1ICsrKysrKysrKysrKystLS0tLQogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Zyb250YnVmZmVyLmggIHwgIDcwICsrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX292ZXJsYXkuYyAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jbGZsdXNoLmMgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2RvbWFpbi5jICAgIHwgIDE0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fbW1hbi5jICAgICAgfCAgIDQgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5jICAgIHwgIDI3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fb2JqZWN0LmggICAgfCAgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdF90eXBlcy5oICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2Zz
LmMgICAgICAgICAgIHwgICA1IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAg
ICAgICAgICAgICB8ICAgNCAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAg
ICAgICAgICAgfCAgNDcgKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAg
ICAgICAgICAgIHwgICA2ICstCiAxNyBmaWxlcyBjaGFuZ2VkLCAzMDYgaW5zZXJ0aW9ucygrKSwg
MjYwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL0RvY3VtZW50YXRpb24vZ3B1L2k5MTUucnN0
IGIvRG9jdW1lbnRhdGlvbi9ncHUvaTkxNS5yc3QKaW5kZXggMGUzMjI2ODhiZTVjLi4zNDE1MjU1
YWQzZGMgMTAwNjQ0Ci0tLSBhL0RvY3VtZW50YXRpb24vZ3B1L2k5MTUucnN0CisrKyBiL0RvY3Vt
ZW50YXRpb24vZ3B1L2k5MTUucnN0CkBAIC05MSw5ICs5MSw2IEBAIEZyb250YnVmZmVyIFRyYWNr
aW5nCiAuLiBrZXJuZWwtZG9jOjogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9m
cm9udGJ1ZmZlci5jCiAgICA6aW50ZXJuYWw6CiAKLS4uIGtlcm5lbC1kb2M6OiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jCi0gICA6ZnVuY3Rpb25zOiBpOTE1X2dlbV90cmFja19mYgot
CiBEaXNwbGF5IEZJRk8gVW5kZXJydW4gUmVwb3J0aW5nCiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMKaW5kZXggOTM1YWVjNzY2MGFmLi5iOWEwOTQ4MTA4YjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0zMDQ5LDEyICszMDQ5LDEzIEBAIGlu
dGVsX2FsbG9jX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogewog
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiA9IE5VTEw7CiAJc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgbW9kZV9jbWQg
PSB7IDAgfTsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9ICZwbGFuZV9jb25maWctPmZi
LT5iYXNlOwogCXUzMiBiYXNlX2FsaWduZWQgPSByb3VuZF9kb3duKHBsYW5lX2NvbmZpZy0+YmFz
ZSwgUEFHRV9TSVpFKTsKIAl1MzIgc2l6ZV9hbGlnbmVkID0gcm91bmRfdXAocGxhbmVfY29uZmln
LT5iYXNlICsgcGxhbmVfY29uZmlnLT5zaXplLAogCQkJCSAgICBQQUdFX1NJWkUpOworCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJYm9vbCByZXQgPSBmYWxzZTsKIAogCXNpemVf
YWxpZ25lZCAtPSBiYXNlX2FsaWduZWQ7CiAKQEAgLTMwOTYsNyArMzA5Nyw3IEBAIGludGVsX2Fs
bG9jX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQlicmVhazsK
IAlkZWZhdWx0OgogCQlNSVNTSU5HX0NBU0UocGxhbmVfY29uZmlnLT50aWxpbmcpOwotCQlyZXR1
cm4gZmFsc2U7CisJCWdvdG8gb3V0OwogCX0KIAogCW1vZGVfY21kLnBpeGVsX2Zvcm1hdCA9IGZi
LT5mb3JtYXQtPmZvcm1hdDsKQEAgLTMxMDgsMTYgKzMxMDksMTUgQEAgaW50ZWxfYWxsb2NfaW5p
dGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAlpZiAoaW50ZWxfZnJh
bWVidWZmZXJfaW5pdCh0b19pbnRlbF9mcmFtZWJ1ZmZlcihmYiksIG9iaiwgJm1vZGVfY21kKSkg
ewogCQlEUk1fREVCVUdfS01TKCJpbnRlbCBmYiBpbml0IGZhaWxlZFxuIik7Ci0JCWdvdG8gb3V0
X3VucmVmX29iajsKKwkJZ290byBvdXQ7CiAJfQogCiAKIAlEUk1fREVCVUdfS01TKCJpbml0aWFs
IHBsYW5lIGZiIG9iaiAlcFxuIiwgb2JqKTsKLQlyZXR1cm4gdHJ1ZTsKLQotb3V0X3VucmVmX29i
ajoKKwlyZXQgPSB0cnVlOworb3V0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQlyZXR1
cm4gZmFsc2U7CisJcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTMxNzQsNiArMzE3
NCwxMiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9kaXNhYmxlX25vYXRvbWljKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAogCWludGVsX2Rpc2FibGVfcGxhbmUocGxhbmUsIGNydGNfc3RhdGUp
OwogfQogCitzdGF0aWMgc3RydWN0IGludGVsX2Zyb250YnVmZmVyICoKK3RvX2ludGVsX2Zyb250
YnVmZmVyKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKQoreworCXJldHVybiBmYiA/IHRvX2lu
dGVsX2ZyYW1lYnVmZmVyKGZiKS0+ZnJvbnRidWZmZXIgOiBOVUxMOworfQorCiBzdGF0aWMgdm9p
ZAogaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxf
Y3J0YywKIAkJCSAgICAgc3RydWN0IGludGVsX2luaXRpYWxfcGxhbmVfY29uZmlnICpwbGFuZV9j
b25maWcpCkBAIC0zMTgxLDcgKzMxODcsNiBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2Jq
KHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9jcnRjICpjOwotCXN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGRybV9wbGFuZSAqcHJpbWFyeSA9IGludGVsX2Ny
dGMtPmJhc2UucHJpbWFyeTsKIAlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9
IHByaW1hcnktPnN0YXRlOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwcmltYXJ5KTsKQEAgLTMyNTcsOCArMzI2Miw3IEBAIGludGVsX2ZpbmRfaW5p
dGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJCXJldHVybjsK
IAl9CiAKLQlvYmogPSBpbnRlbF9mYl9vYmooZmIpOwotCWludGVsX2ZiX29ial9mbHVzaChvYmos
IE9SSUdJTl9ESVJUWUZCKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCh0b19pbnRlbF9mcm9u
dGJ1ZmZlcihmYiksIE9SSUdJTl9ESVJUWUZCKTsKIAogCXBsYW5lX3N0YXRlLT5zcmNfeCA9IDA7
CiAJcGxhbmVfc3RhdGUtPnNyY195ID0gMDsKQEAgLTMyNzMsMTQgKzMyNzcsMTQgQEAgaW50ZWxf
ZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlp
bnRlbF9zdGF0ZS0+YmFzZS5zcmMgPSBkcm1fcGxhbmVfc3RhdGVfc3JjKHBsYW5lX3N0YXRlKTsK
IAlpbnRlbF9zdGF0ZS0+YmFzZS5kc3QgPSBkcm1fcGxhbmVfc3RhdGVfZGVzdChwbGFuZV9zdGF0
ZSk7CiAKLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKG9iaikpCisJaWYgKHBsYW5lX2Nv
bmZpZy0+dGlsaW5nKQogCQlkZXZfcHJpdi0+cHJlc2VydmVfYmlvc19zd2l6emxlID0gdHJ1ZTsK
IAogCXBsYW5lX3N0YXRlLT5mYiA9IGZiOwogCXBsYW5lX3N0YXRlLT5jcnRjID0gJmludGVsX2Ny
dGMtPmJhc2U7CiAKIAlhdG9taWNfb3IodG9faW50ZWxfcGxhbmUocHJpbWFyeSktPmZyb250YnVm
ZmVyX2JpdCwKLQkJICAmb2JqLT5mcm9udGJ1ZmZlcl9iaXRzKTsKKwkJICAmdG9faW50ZWxfZnJv
bnRidWZmZXIoZmIpLT5iaXRzKTsKIH0KIAogc3RhdGljIGludCBza2xfbWF4X3BsYW5lX3dpZHRo
KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLApAQCAtMTQxMzMsOSArMTQxMzcsOSBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfdHJhY2tfZmJzKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0
YXRlLCBwbGFuZSwgb2xkX3BsYW5lX3N0YXRlLAogCQkJCQkgICAgIG5ld19wbGFuZV9zdGF0ZSwg
aSkKLQkJaTkxNV9nZW1fdHJhY2tfZmIoaW50ZWxfZmJfb2JqKG9sZF9wbGFuZV9zdGF0ZS0+YmFz
ZS5mYiksCi0JCQkJICBpbnRlbF9mYl9vYmoobmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZiKSwKLQkJ
CQkgIHBsYW5lLT5mcm9udGJ1ZmZlcl9iaXQpOworCQlpbnRlbF9mcm9udGJ1ZmZlcl90cmFjayh0
b19pbnRlbF9mcm9udGJ1ZmZlcihvbGRfcGxhbmVfc3RhdGUtPmJhc2UuZmIpLAorCQkJCQl0b19p
bnRlbF9mcm9udGJ1ZmZlcihuZXdfcGxhbmVfc3RhdGUtPmJhc2UuZmIpLAorCQkJCQlwbGFuZS0+
ZnJvbnRidWZmZXJfYml0KTsKIH0KIAogc3RhdGljIGludCBpbnRlbF9hdG9taWNfY29tbWl0KHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsCkBAIC0xNDQxOSw3ICsxNDQyMyw3IEBAIGludGVsX3ByZXBh
cmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCXJldHVybiByZXQ7CiAKIAlm
Yl9vYmpfYnVtcF9yZW5kZXJfcHJpb3JpdHkob2JqKTsKLQlpbnRlbF9mYl9vYmpfZmx1c2gob2Jq
LCBPUklHSU5fRElSVFlGQik7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2gob2JqLT5mcm9udGJ1
ZmZlciwgT1JJR0lOX0RJUlRZRkIpOwogCiAJaWYgKCFuZXdfc3RhdGUtPmZlbmNlKSB7IC8qIGlt
cGxpY2l0IGZlbmNpbmcgKi8KIAkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CkBAIC0xNDY4Miwx
MyArMTQ2ODYsMTIgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFu
ZSAqcGxhbmUsCiAJCQkgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7
Ci0JaW50IHJldDsKIAlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsICpu
ZXdfcGxhbmVfc3RhdGU7CiAJc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpvbGRfZmI7CiAJc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQogCQl0b19pbnRlbF9jcnRjX3N0YXRl
KGNydGMtPnN0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7
CisJaW50IHJldDsKIAogCS8qCiAJICogV2hlbiBjcnRjIGlzIGluYWN0aXZlIG9yIHRoZXJlIGlz
IGEgbW9kZXNldCBwZW5kaW5nLApAQCAtMTQ3NTYsMTEgKzE0NzU5LDEwIEBAIGludGVsX2xlZ2Fj
eV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmIChyZXQpCiAJCWdv
dG8gb3V0X3VubG9jazsKIAotCWludGVsX2ZiX29ial9mbHVzaChpbnRlbF9mYl9vYmooZmIpLCBP
UklHSU5fRkxJUCk7Ci0KLQlvbGRfZmIgPSBvbGRfcGxhbmVfc3RhdGUtPmZiOwotCWk5MTVfZ2Vt
X3RyYWNrX2ZiKGludGVsX2ZiX29iaihvbGRfZmIpLCBpbnRlbF9mYl9vYmooZmIpLAotCQkJICBp
bnRlbF9wbGFuZS0+ZnJvbnRidWZmZXJfYml0KTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCh0
b19pbnRlbF9mcm9udGJ1ZmZlcihmYiksIE9SSUdJTl9GTElQKTsKKwlpbnRlbF9mcm9udGJ1ZmZl
cl90cmFjayh0b19pbnRlbF9mcm9udGJ1ZmZlcihvbGRfcGxhbmVfc3RhdGUtPmZiKSwKKwkJCQl0
b19pbnRlbF9mcm9udGJ1ZmZlcihmYiksCisJCQkJaW50ZWxfcGxhbmUtPmZyb250YnVmZmVyX2Jp
dCk7CiAKIAkvKiBTd2FwIHBsYW5lIHN0YXRlICovCiAJcGxhbmUtPnN0YXRlID0gbmV3X3BsYW5l
X3N0YXRlOwpAQCAtMTU1NDAsMTUgKzE1NTQyLDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2V0dXBf
b3V0cHV0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiBzdGF0aWMgdm9pZCBp
bnRlbF91c2VyX2ZyYW1lYnVmZmVyX2Rlc3Ryb3koc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIp
CiB7CiAJc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiA9IHRvX2ludGVsX2ZyYW1l
YnVmZmVyKGZiKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gaW50ZWxfZmJf
b2JqKGZiKTsKIAogCWRybV9mcmFtZWJ1ZmZlcl9jbGVhbnVwKGZiKTsKLQotCWk5MTVfZ2VtX29i
amVjdF9sb2NrKG9iaik7Ci0JV0FSTl9PTighb2JqLT5mcmFtZWJ1ZmZlcl9yZWZlcmVuY2VzLS0p
OwotCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKLQotCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9wdXQoaW50ZWxfZmItPmZyb250YnVmZmVyKTsKIAog
CWtmcmVlKGludGVsX2ZiKTsKIH0KQEAgLTE1NTc2LDcgKzE1NTcyLDcgQEAgc3RhdGljIGludCBp
bnRlbF91c2VyX2ZyYW1lYnVmZmVyX2RpcnR5KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAog
CXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCiAJ
aTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2lmX2Rpc3BsYXkob2JqKTsKLQlpbnRlbF9mYl9vYmpfZmx1
c2gob2JqLCBPUklHSU5fRElSVFlGQik7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2godG9faW50
ZWxfZnJvbnRidWZmZXIoZmIpLCBPUklHSU5fRElSVFlGQik7CiAKIAlyZXR1cm4gMDsKIH0KQEAg
LTE1NTk4LDggKzE1NTk0LDExIEBAIHN0YXRpYyBpbnQgaW50ZWxfZnJhbWVidWZmZXJfaW5pdChz
dHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiLAogCWludCByZXQgPSAtRUlOVkFMOwog
CWludCBpOwogCisJaW50ZWxfZmItPmZyb250YnVmZmVyID0gaW50ZWxfZnJvbnRidWZmZXJfZ2V0
KG9iaik7CisJaWYgKCFpbnRlbF9mYi0+ZnJvbnRidWZmZXIpCisJCXJldHVybiAtRU5PTUVNOwor
CiAJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKLQlvYmotPmZyYW1lYnVmZmVyX3JlZmVyZW5j
ZXMrKzsKIAl0aWxpbmcgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3RpbGluZyhvYmopOwogCXN0cmlk
ZSA9IGk5MTVfZ2VtX29iamVjdF9nZXRfc3RyaWRlKG9iaik7CiAJaTkxNV9nZW1fb2JqZWN0X3Vu
bG9jayhvYmopOwpAQCAtMTU3MTYsOSArMTU3MTUsNyBAQCBzdGF0aWMgaW50IGludGVsX2ZyYW1l
YnVmZmVyX2luaXQoc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiwKIAlyZXR1cm4g
MDsKIAogZXJyOgotCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7Ci0Jb2JqLT5mcmFtZWJ1ZmZl
cl9yZWZlcmVuY2VzLS07Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOworCWludGVsX2Zy
b250YnVmZmVyX3B1dChpbnRlbF9mYi0+ZnJvbnRidWZmZXIpOwogCXJldHVybiByZXQ7CiB9CiAK
QEAgLTE1NzM2LDggKzE1NzMzLDcgQEAgaW50ZWxfdXNlcl9mcmFtZWJ1ZmZlcl9jcmVhdGUoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT0VOVCk7CiAKIAlmYiA9
IGludGVsX2ZyYW1lYnVmZmVyX2NyZWF0ZShvYmosICZtb2RlX2NtZCk7Ci0JaWYgKElTX0VSUihm
YikpCi0JCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9i
aik7CiAKIAlyZXR1cm4gZmI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IGE4OGVjOWFhOWNhMC4uM2MxYTVmM2UxZDIy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
dHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
dHlwZXMuaApAQCAtODQsNiArODQsNyBAQCBlbnVtIGludGVsX2Jyb2FkY2FzdF9yZ2IgewogCiBz
dHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgewogCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgYmFzZTsK
KwlzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250YnVmZmVyOwogCXN0cnVjdCBpbnRlbF9y
b3RhdGlvbl9pbmZvIHJvdF9pbmZvOwogCiAJLyogZm9yIGVhY2ggcGxhbmUgaW4gdGhlIG5vcm1h
bCBHVFQgdmlldyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9mYmRldi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5j
CmluZGV4IGVjY2ZjMzBmOGUzMi4uNWU3Y2M1YTZhYzdmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCkBAIC00NywxMyArNDcsMTQgQEAKICNpbmNsdWRlICJp
bnRlbF9mYmRldi5oIgogI2luY2x1ZGUgImludGVsX2Zyb250YnVmZmVyLmgiCiAKLXN0YXRpYyB2
b2lkIGludGVsX2ZiZGV2X2ludmFsaWRhdGUoc3RydWN0IGludGVsX2ZiZGV2ICppZmJkZXYpCitz
dGF0aWMgc3RydWN0IGludGVsX2Zyb250YnVmZmVyICp0b19mcm9udGJ1ZmZlcihzdHJ1Y3QgaW50
ZWxfZmJkZXYgKmlmYmRldikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0g
aW50ZWxfZmJfb2JqKCZpZmJkZXYtPmZiLT5iYXNlKTsKLQl1bnNpZ25lZCBpbnQgb3JpZ2luID0K
LQkJaWZiZGV2LT52bWFfZmxhZ3MgJiBQTEFORV9IQVNfRkVOQ0UgPyBPUklHSU5fR1RUIDogT1JJ
R0lOX0NQVTsKKwlyZXR1cm4gaWZiZGV2LT5mYi0+ZnJvbnRidWZmZXI7Cit9CiAKLQlpbnRlbF9m
Yl9vYmpfaW52YWxpZGF0ZShvYmosIG9yaWdpbik7CitzdGF0aWMgdm9pZCBpbnRlbF9mYmRldl9p
bnZhbGlkYXRlKHN0cnVjdCBpbnRlbF9mYmRldiAqaWZiZGV2KQoreworCWludGVsX2Zyb250YnVm
ZmVyX2ludmFsaWRhdGUodG9fZnJvbnRidWZmZXIoaWZiZGV2KSwgT1JJR0lOX0NQVSk7CiB9CiAK
IHN0YXRpYyBpbnQgaW50ZWxfZmJkZXZfc2V0X3BhcihzdHJ1Y3QgZmJfaW5mbyAqaW5mbykKQEAg
LTEyMCw3ICsxMjEsNyBAQCBzdGF0aWMgaW50IGludGVsZmJfYWxsb2Moc3RydWN0IGRybV9mYl9o
ZWxwZXIgKmhlbHBlciwKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGRldik7CiAJc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgbW9kZV9jbWQgPSB7fTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCWludCBzaXplLCByZXQ7CisJaW50IHNpemU7
CiAKIAkvKiB3ZSBkb24ndCBkbyBwYWNrZWQgMjRicHAgKi8KIAlpZiAoc2l6ZXMtPnN1cmZhY2Vf
YnBwID09IDI0KQpAQCAtMTQ3LDI0ICsxNDgsMTYgQEAgc3RhdGljIGludCBpbnRlbGZiX2FsbG9j
KHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfc2htZW0oZGV2X3ByaXYsIHNpemUpOwogCWlmIChJU19FUlIob2JqKSkgewogCQlEUk1f
RVJST1IoImZhaWxlZCB0byBhbGxvY2F0ZSBmcmFtZWJ1ZmZlclxuIik7Ci0JCXJldCA9IFBUUl9F
UlIob2JqKTsKLQkJZ290byBlcnI7CisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAJfQogCiAJZmIg
PSBpbnRlbF9mcmFtZWJ1ZmZlcl9jcmVhdGUob2JqLCAmbW9kZV9jbWQpOwotCWlmIChJU19FUlIo
ZmIpKSB7Ci0JCXJldCA9IFBUUl9FUlIoZmIpOwotCQlnb3RvIGVycl9vYmo7Ci0JfQorCWk5MTVf
Z2VtX29iamVjdF9wdXQob2JqKTsKKwlpZiAoSVNfRVJSKGZiKSkKKwkJcmV0dXJuIFBUUl9FUlIo
ZmIpOwogCiAJaWZiZGV2LT5mYiA9IHRvX2ludGVsX2ZyYW1lYnVmZmVyKGZiKTsKLQogCXJldHVy
biAwOwotCi1lcnJfb2JqOgotCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLWVycjoKLQlyZXR1
cm4gcmV0OwogfQogCiBzdGF0aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVs
cGVyICpoZWxwZXIsCkBAIC0xODAsNyArMTczLDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0
ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCWNvbnN0IHN0cnVjdCBpOTE1X2dndHRf
dmlldyB2aWV3ID0gewogCQkudHlwZSA9IEk5MTVfR0dUVF9WSUVXX05PUk1BTCwKIAl9OwotCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXN0
cnVjdCBmYl9pbmZvICppbmZvOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtMjI2LDggKzIx
OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhl
bHBlciwKIAkJZ290byBvdXRfdW5sb2NrOwogCX0KIAotCWZiID0gJmlmYmRldi0+ZmItPmJhc2U7
Ci0JaW50ZWxfZmJfb2JqX2ZsdXNoKGludGVsX2ZiX29iaihmYiksIE9SSUdJTl9ESVJUWUZCKTsK
KwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCh0b19mcm9udGJ1ZmZlcihpZmJkZXYpLCBPUklHSU5f
RElSVFlGQik7CiAKIAlpbmZvID0gZHJtX2ZiX2hlbHBlcl9hbGxvY19mYmkoaGVscGVyKTsKIAlp
ZiAoSVNfRVJSKGluZm8pKSB7CkBAIC0yMzYsNyArMjI3LDcgQEAgc3RhdGljIGludCBpbnRlbGZi
X2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCQlnb3RvIG91dF91bnBpbjsK
IAl9CiAKLQlpZmJkZXYtPmhlbHBlci5mYiA9IGZiOworCWlmYmRldi0+aGVscGVyLmZiID0gJmlm
YmRldi0+ZmItPmJhc2U7CiAKIAlpbmZvLT5mYm9wcyA9ICZpbnRlbGZiX29wczsKIApAQCAtMjYy
LDEzICsyNTMsMTQgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hl
bHBlciAqaGVscGVyLAogCSAqIElmIHRoZSBvYmplY3QgaXMgc3RvbGVuIGhvd2V2ZXIsIGl0IHdp
bGwgYmUgZnVsbCBvZiB3aGF0ZXZlcgogCSAqIGdhcmJhZ2Ugd2FzIGxlZnQgaW4gdGhlcmUuCiAJ
ICovCi0JaWYgKGludGVsX2ZiX29iaihmYiktPnN0b2xlbiAmJiAhcHJlYWxsb2MpCisJaWYgKHZt
YS0+b2JqLT5zdG9sZW4gJiYgIXByZWFsbG9jKQogCQltZW1zZXRfaW8oaW5mby0+c2NyZWVuX2Jh
c2UsIDAsIGluZm8tPnNjcmVlbl9zaXplKTsKIAogCS8qIFVzZSBkZWZhdWx0IHNjcmF0Y2ggcGl4
bWFwIChpbmZvLT5waXhtYXAuZmxhZ3MgPSBGQl9QSVhNQVBfU1lTVEVNKSAqLwogCiAJRFJNX0RF
QlVHX0tNUygiYWxsb2NhdGVkICVkeCVkIGZiOiAweCUwOHhcbiIsCi0JCSAgICAgIGZiLT53aWR0
aCwgZmItPmhlaWdodCwgaTkxNV9nZ3R0X29mZnNldCh2bWEpKTsKKwkJICAgICAgaWZiZGV2LT5m
Yi0+YmFzZS53aWR0aCwgaWZiZGV2LT5mYi0+YmFzZS5oZWlnaHQsCisJCSAgICAgIGk5MTVfZ2d0
dF9vZmZzZXQodm1hKSk7CiAJaWZiZGV2LT52bWEgPSB2bWE7CiAJaWZiZGV2LT52bWFfZmxhZ3Mg
PSBmbGFnczsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9mcm9udGJ1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9u
dGJ1ZmZlci5jCmluZGV4IDljZGE4OGU0MWQyOS4uNzE5Mzc5Nzc0ZmE1IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zyb250YnVmZmVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5jCkBAIC0zMCwxMSAr
MzAsMTEgQEAKICAqIE1hbnkgZmVhdHVyZXMgcmVxdWlyZSB1cyB0byB0cmFjayBjaGFuZ2VzIHRv
IHRoZSBjdXJyZW50bHkgYWN0aXZlCiAgKiBmcm9udGJ1ZmZlciwgZXNwZWNpYWxseSByZW5kZXJp
bmcgdGFyZ2V0ZWQgYXQgdGhlIGZyb250YnVmZmVyLgogICoKLSAqIFRvIGJlIGFibGUgdG8gZG8g
c28gR0VNIHRyYWNrcyBmcm9udGJ1ZmZlcnMgdXNpbmcgYSBiaXRtYXNrIGZvciBhbGwgcG9zc2li
bGUKLSAqIGZyb250YnVmZmVyIHNsb3RzIHRocm91Z2ggaTkxNV9nZW1fdHJhY2tfZmIoKS4gVGhl
IGZ1bmN0aW9uIGluIHRoaXMgZmlsZSBhcmUKLSAqIHRoZW4gY2FsbGVkIHdoZW4gdGhlIGNvbnRl
bnRzIG9mIHRoZSBmcm9udGJ1ZmZlciBhcmUgaW52YWxpZGF0ZWQsIHdoZW4KLSAqIGZyb250YnVm
ZmVyIHJlbmRlcmluZyBoYXMgc3RvcHBlZCBhZ2FpbiB0byBmbHVzaCBvdXQgYWxsIHRoZSBjaGFu
Z2VzIGFuZCB3aGVuCi0gKiB0aGUgZnJvbnRidWZmZXIgaXMgZXhjaGFuZ2VkIHdpdGggYSBmbGlw
LiBTdWJzeXN0ZW1zIGludGVyZXN0ZWQgaW4KKyAqIFRvIGJlIGFibGUgdG8gZG8gc28gd2UgdHJh
Y2sgZnJvbnRidWZmZXJzIHVzaW5nIGEgYml0bWFzayBmb3IgYWxsIHBvc3NpYmxlCisgKiBmcm9u
dGJ1ZmZlciBzbG90cyB0aHJvdWdoIGludGVsX2Zyb250YnVmZmVyX3RyYWNrKCkuIFRoZSBmdW5j
dGlvbnMgaW4gdGhpcworICogZmlsZSBhcmUgdGhlbiBjYWxsZWQgd2hlbiB0aGUgY29udGVudHMg
b2YgdGhlIGZyb250YnVmZmVyIGFyZSBpbnZhbGlkYXRlZCwKKyAqIHdoZW4gZnJvbnRidWZmZXIg
cmVuZGVyaW5nIGhhcyBzdG9wcGVkIGFnYWluIHRvIGZsdXNoIG91dCBhbGwgdGhlIGNoYW5nZXMK
KyAqIGFuZCB3aGVuIHRoZSBmcm9udGJ1ZmZlciBpcyBleGNoYW5nZWQgd2l0aCBhIGZsaXAuIFN1
YnN5c3RlbXMgaW50ZXJlc3RlZCBpbgogICogZnJvbnRidWZmZXIgY2hhbmdlcyAoZS5nLiBQU1Is
IEZCQywgRFJSUykgc2hvdWxkIGRpcmVjdGx5IHB1dCB0aGVpciBjYWxsYmFja3MKICAqIGludG8g
dGhlIHJlbGV2YW50IHBsYWNlcyBhbmQgZmlsdGVyIGZvciB0aGUgZnJvbnRidWZmZXIgc2xvdHMg
dGhhdCB0aGV5IGFyZQogICogaW50ZXJlc3RlZCBpbnQuCkBAIC02MywyOCArNjMsOSBAQAogI2lu
Y2x1ZGUgImludGVsX2Zyb250YnVmZmVyLmgiCiAjaW5jbHVkZSAiaW50ZWxfcHNyLmgiCiAKLXZv
aWQgX19pbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAotCQkJICAgICAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbiwKLQkJCSAgICAgICB1bnNp
Z25lZCBpbnQgZnJvbnRidWZmZXJfYml0cykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwotCi0JaWYgKG9yaWdpbiA9PSBPUklH
SU5fQ1MpIHsKLQkJc3Bpbl9sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7Ci0JCWRl
dl9wcml2LT5mYl90cmFja2luZy5idXN5X2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKLQkJZGV2
X3ByaXYtPmZiX3RyYWNraW5nLmZsaXBfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKLQkJc3Bp
bl91bmxvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKLQl9Ci0KLQltaWdodF9zbGVl
cCgpOwotCWludGVsX3Bzcl9pbnZhbGlkYXRlKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBv
cmlnaW4pOwotCWludGVsX2VkcF9kcnJzX2ludmFsaWRhdGUoZGV2X3ByaXYsIGZyb250YnVmZmVy
X2JpdHMpOwotCWludGVsX2ZiY19pbnZhbGlkYXRlKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRz
LCBvcmlnaW4pOwotfQotCiAvKioKLSAqIGludGVsX2Zyb250YnVmZmVyX2ZsdXNoIC0gZmx1c2gg
ZnJvbnRidWZmZXIKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UKKyAqIGZyb250YnVmZmVyX2Zs
dXNoIC0gZmx1c2ggZnJvbnRidWZmZXIKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICogQGZyb250
YnVmZmVyX2JpdHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJpdHMKICAqIEBvcmlnaW46
IHdoaWNoIG9wZXJhdGlvbiBjYXVzZWQgdGhlIGZsdXNoCiAgKgpAQCAtOTQsNDUgKzc1LDI3IEBA
IHZvaWQgX19pbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAogICoKICAqIENhbiBiZSBjYWxsZWQgd2l0aG91dCBhbnkgbG9ja3MgaGVsZC4KICAq
Lwotc3RhdGljIHZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmx1c2goc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAotCQkJCSAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzLAotCQkJ
CSAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pCitzdGF0aWMgdm9pZCBmcm9udGJ1ZmZlcl9m
bHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCSAgICAgIHVuc2lnbmVkIGlu
dCBmcm9udGJ1ZmZlcl9iaXRzLAorCQkJICAgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQog
ewogCS8qIERlbGF5IGZsdXNoaW5nIHdoZW4gcmluZ3MgYXJlIHN0aWxsIGJ1c3kuKi8KLQlzcGlu
X2xvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKLQlmcm9udGJ1ZmZlcl9iaXRzICY9
IH5kZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzOwotCXNwaW5fdW5sb2NrKCZkZXZfcHJp
di0+ZmJfdHJhY2tpbmcubG9jayk7CisJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2Nr
KTsKKwlmcm9udGJ1ZmZlcl9iaXRzICY9IH5pOTE1LT5mYl90cmFja2luZy5idXN5X2JpdHM7CisJ
c3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwogCiAJaWYgKCFmcm9udGJ1ZmZl
cl9iaXRzKQogCQlyZXR1cm47CiAKIAltaWdodF9zbGVlcCgpOwotCWludGVsX2VkcF9kcnJzX2Zs
dXNoKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzKTsKLQlpbnRlbF9wc3JfZmx1c2goZGV2X3By
aXYsIGZyb250YnVmZmVyX2JpdHMsIG9yaWdpbik7Ci0JaW50ZWxfZmJjX2ZsdXNoKGRldl9wcml2
LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOwotfQotCi12b2lkIF9faW50ZWxfZmJfb2JqX2Zs
dXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkgIGVudW0gZmJfb3Bfb3Jp
Z2luIG9yaWdpbiwKLQkJCSAgdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpCi17Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsK
LQotCWlmIChvcmlnaW4gPT0gT1JJR0lOX0NTKSB7Ci0JCXNwaW5fbG9jaygmZGV2X3ByaXYtPmZi
X3RyYWNraW5nLmxvY2spOwotCQkvKiBGaWx0ZXIgb3V0IG5ldyBiaXRzIHNpbmNlIHJlbmRlcmlu
ZyBzdGFydGVkLiAqLwotCQlmcm9udGJ1ZmZlcl9iaXRzICY9IGRldl9wcml2LT5mYl90cmFja2lu
Zy5idXN5X2JpdHM7Ci0JCWRldl9wcml2LT5mYl90cmFja2luZy5idXN5X2JpdHMgJj0gfmZyb250
YnVmZmVyX2JpdHM7Ci0JCXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7
Ci0JfQotCi0JaWYgKGZyb250YnVmZmVyX2JpdHMpCi0JCWludGVsX2Zyb250YnVmZmVyX2ZsdXNo
KGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOworCWludGVsX2VkcF9kcnJzX2Zs
dXNoKGk5MTUsIGZyb250YnVmZmVyX2JpdHMpOworCWludGVsX3Bzcl9mbHVzaChpOTE1LCBmcm9u
dGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOworCWludGVsX2ZiY19mbHVzaChpOTE1LCBmcm9udGJ1ZmZl
cl9iaXRzLCBvcmlnaW4pOwogfQogCiAvKioKICAqIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfcHJl
cGFyZSAtIHByZXBhcmUgYXN5bmNocm9ub3VzIGZyb250YnVmZmVyIGZsaXAKLSAqIEBkZXZfcHJp
djogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICogQGZyb250YnVmZmVyX2Jp
dHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJpdHMKICAqCiAgKiBUaGlzIGZ1bmN0aW9u
IGdldHMgY2FsbGVkIGFmdGVyIHNjaGVkdWxpbmcgYSBmbGlwIG9uIEBvYmouIFRoZSBhY3R1YWwK
QEAgLTE0MiwxOSArMTA1LDE5IEBAIHZvaWQgX19pbnRlbF9mYl9vYmpfZmx1c2goc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKICAqCiAgKiBDYW4gYmUgY2FsbGVkIHdpdGhvdXQgYW55
IGxvY2tzIGhlbGQuCiAgKi8KLXZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9wcmVwYXJlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfZnJvbnRidWZmZXJf
ZmxpcF9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICB1bnNp
Z25lZCBmcm9udGJ1ZmZlcl9iaXRzKQogewotCXNwaW5fbG9jaygmZGV2X3ByaXYtPmZiX3RyYWNr
aW5nLmxvY2spOwotCWRldl9wcml2LT5mYl90cmFja2luZy5mbGlwX2JpdHMgfD0gZnJvbnRidWZm
ZXJfYml0czsKKwlzcGluX2xvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOworCWk5MTUtPmZi
X3RyYWNraW5nLmZsaXBfYml0cyB8PSBmcm9udGJ1ZmZlcl9iaXRzOwogCS8qIFJlbW92ZSBzdGFs
ZSBidXN5IGJpdHMgZHVlIHRvIHRoZSBvbGQgYnVmZmVyLiAqLwotCWRldl9wcml2LT5mYl90cmFj
a2luZy5idXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7Ci0Jc3Bpbl91bmxvY2soJmRldl9w
cml2LT5mYl90cmFja2luZy5sb2NrKTsKKwlpOTE1LT5mYl90cmFja2luZy5idXN5X2JpdHMgJj0g
fmZyb250YnVmZmVyX2JpdHM7CisJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2sp
OwogfQogCiAvKioKICAqIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfY29tcGxldGUgLSBjb21wbGV0
ZSBhc3luY2hyb25vdXMgZnJvbnRidWZmZXIgZmxpcAotICogQGRldl9wcml2OiBpOTE1IGRldmlj
ZQorICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKiBAZnJvbnRidWZmZXJfYml0czogZnJvbnRidWZm
ZXIgcGxhbmUgdHJhY2tpbmcgYml0cwogICoKICAqIFRoaXMgZnVuY3Rpb24gZ2V0cyBjYWxsZWQg
YWZ0ZXIgdGhlIGZsaXAgaGFzIGJlZW4gbGF0Y2hlZCBhbmQgd2lsbCBjb21wbGV0ZQpAQCAtMTYy
LDIzICsxMjUsMjIgQEAgdm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwX3ByZXBhcmUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICoKICAqIENhbiBiZSBjYWxsZWQgd2l0aG91
dCBhbnkgbG9ja3MgaGVsZC4KICAqLwotdm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwX2NvbXBs
ZXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfZnJvbnRi
dWZmZXJfZmxpcF9jb21wbGV0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkg
ICAgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMpCiB7Ci0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+
ZmJfdHJhY2tpbmcubG9jayk7CisJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsK
IAkvKiBNYXNrIGFueSBjYW5jZWxsZWQgZmxpcHMuICovCi0JZnJvbnRidWZmZXJfYml0cyAmPSBk
ZXZfcHJpdi0+ZmJfdHJhY2tpbmcuZmxpcF9iaXRzOwotCWRldl9wcml2LT5mYl90cmFja2luZy5m
bGlwX2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7Ci0Jc3Bpbl91bmxvY2soJmRldl9wcml2LT5m
Yl90cmFja2luZy5sb2NrKTsKKwlmcm9udGJ1ZmZlcl9iaXRzICY9IGk5MTUtPmZiX3RyYWNraW5n
LmZsaXBfYml0czsKKwlpOTE1LT5mYl90cmFja2luZy5mbGlwX2JpdHMgJj0gfmZyb250YnVmZmVy
X2JpdHM7CisJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwogCiAJaWYgKGZy
b250YnVmZmVyX2JpdHMpCi0JCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKGRldl9wcml2LAotCQkJ
CQlmcm9udGJ1ZmZlcl9iaXRzLCBPUklHSU5fRkxJUCk7CisJCWZyb250YnVmZmVyX2ZsdXNoKGk5
MTUsIGZyb250YnVmZmVyX2JpdHMsIE9SSUdJTl9GTElQKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9m
cm9udGJ1ZmZlcl9mbGlwIC0gc3luY2hyb25vdXMgZnJvbnRidWZmZXIgZmxpcAotICogQGRldl9w
cml2OiBpOTE1IGRldmljZQorICogQGk5MTU6IGk5MTUgZGV2aWNlCiAgKiBAZnJvbnRidWZmZXJf
Yml0czogZnJvbnRidWZmZXIgcGxhbmUgdHJhY2tpbmcgYml0cwogICoKICAqIFRoaXMgZnVuY3Rp
b24gZ2V0cyBjYWxsZWQgYWZ0ZXIgc2NoZWR1bGluZyBhIGZsaXAgb24gQG9iai4gVGhpcyBpcyBm
b3IKQEAgLTE4NywxMyArMTQ5LDE2MCBAQCB2b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfY29t
cGxldGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICoKICAqIENhbiBiZSBj
YWxsZWQgd2l0aG91dCBhbnkgbG9ja3MgaGVsZC4KICAqLwotdm9pZCBpbnRlbF9mcm9udGJ1ZmZl
cl9mbGlwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3ZvaWQgaW50ZWxfZnJv
bnRidWZmZXJfZmxpcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICB1bnNp
Z25lZCBmcm9udGJ1ZmZlcl9iaXRzKQogewotCXNwaW5fbG9jaygmZGV2X3ByaXYtPmZiX3RyYWNr
aW5nLmxvY2spOworCXNwaW5fbG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CiAJLyogUmVt
b3ZlIHN0YWxlIGJ1c3kgYml0cyBkdWUgdG8gdGhlIG9sZCBidWZmZXIuICovCi0JZGV2X3ByaXYt
PmZiX3RyYWNraW5nLmJ1c3lfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKLQlzcGluX3VubG9j
aygmZGV2X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOworCWk5MTUtPmZiX3RyYWNraW5nLmJ1c3lf
Yml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKKwlzcGluX3VubG9jaygmaTkxNS0+ZmJfdHJhY2tp
bmcubG9jayk7CiAKLQlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChkZXZfcHJpdiwgZnJvbnRidWZm
ZXJfYml0cywgT1JJR0lOX0ZMSVApOworCWZyb250YnVmZmVyX2ZsdXNoKGk5MTUsIGZyb250YnVm
ZmVyX2JpdHMsIE9SSUdJTl9GTElQKTsKK30KKwordm9pZCBfX2ludGVsX2ZiX2ludmFsaWRhdGUo
c3RydWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udCwKKwkJCSAgIGVudW0gZmJfb3Bfb3JpZ2lu
IG9yaWdpbiwKKwkJCSAgIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShmcm9udC0+b2JqLT5iYXNlLmRldik7
CisKKwlpZiAob3JpZ2luID09IE9SSUdJTl9DUykgeworCQlzcGluX2xvY2soJmk5MTUtPmZiX3Ry
YWNraW5nLmxvY2spOworCQlpOTE1LT5mYl90cmFja2luZy5idXN5X2JpdHMgfD0gZnJvbnRidWZm
ZXJfYml0czsKKwkJaTkxNS0+ZmJfdHJhY2tpbmcuZmxpcF9iaXRzICY9IH5mcm9udGJ1ZmZlcl9i
aXRzOworCQlzcGluX3VubG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CisJfQorCisJbWln
aHRfc2xlZXAoKTsKKwlpbnRlbF9wc3JfaW52YWxpZGF0ZShpOTE1LCBmcm9udGJ1ZmZlcl9iaXRz
LCBvcmlnaW4pOworCWludGVsX2VkcF9kcnJzX2ludmFsaWRhdGUoaTkxNSwgZnJvbnRidWZmZXJf
Yml0cyk7CisJaW50ZWxfZmJjX2ludmFsaWRhdGUoaTkxNSwgZnJvbnRidWZmZXJfYml0cywgb3Jp
Z2luKTsKK30KKwordm9pZCBfX2ludGVsX2ZiX2ZsdXNoKHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZl
ciAqZnJvbnQsCisJCSAgICAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbiwKKwkJICAgICAgdW5z
aWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGZyb250LT5vYmotPmJhc2UuZGV2KTsKKworCWlmIChvcmlnaW4gPT0g
T1JJR0lOX0NTKSB7CisJCXNwaW5fbG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CisJCS8q
IEZpbHRlciBvdXQgbmV3IGJpdHMgc2luY2UgcmVuZGVyaW5nIHN0YXJ0ZWQuICovCisJCWZyb250
YnVmZmVyX2JpdHMgJj0gaTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzOworCQlpOTE1LT5mYl90
cmFja2luZy5idXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7CisJCXNwaW5fdW5sb2NrKCZp
OTE1LT5mYl90cmFja2luZy5sb2NrKTsKKwl9CisKKwlpZiAoZnJvbnRidWZmZXJfYml0cykKKwkJ
ZnJvbnRidWZmZXJfZmx1c2goaTkxNSwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKK30KKwor
c3RhdGljIGludCBmcm9udGJ1ZmZlcl9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7
CisJc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udCA9CisJCWNvbnRhaW5lcl9vZihyZWYs
IHR5cGVvZigqZnJvbnQpLCB3cml0ZSk7CisKKwlrcmVmX2dldCgmZnJvbnQtPnJlZik7CisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGZyb250YnVmZmVyX3JldGlyZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKK3sKKwlzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250ID0KKwkJY29u
dGFpbmVyX29mKHJlZiwgdHlwZW9mKCpmcm9udCksIHdyaXRlKTsKKworCWludGVsX2Zyb250YnVm
ZmVyX2ZsdXNoKGZyb250LCBPUklHSU5fQ1MpOworCWludGVsX2Zyb250YnVmZmVyX3B1dChmcm9u
dCk7Cit9CisKK3N0YXRpYyB2b2lkIGZyb250YnVmZmVyX3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJl
ZikKKwlfX3JlbGVhc2VzKCZ0b19pOTE1KGZyb250LT5vYmotPmJhc2UuZGV2KS0+ZmJfdHJhY2tp
bmcubG9jaykKK3sKKwlzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250ID0KKwkJY29udGFp
bmVyX29mKHJlZiwgdHlwZW9mKCpmcm9udCksIHJlZik7CisKKwlmcm9udC0+b2JqLT5mcm9udGJ1
ZmZlciA9IE5VTEw7CisJc3Bpbl91bmxvY2soJnRvX2k5MTUoZnJvbnQtPm9iai0+YmFzZS5kZXYp
LT5mYl90cmFja2luZy5sb2NrKTsKKworCWk5MTVfZ2VtX29iamVjdF9wdXQoZnJvbnQtPm9iaik7
CisJa2ZyZWUoZnJvbnQpOworfQorCitzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKgoraW50ZWxf
ZnJvbnRidWZmZXJfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0
cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQ7CisKKwlzcGluX2xvY2soJmk5MTUtPmZiX3Ry
YWNraW5nLmxvY2spOworCWZyb250ID0gb2JqLT5mcm9udGJ1ZmZlcjsKKwlpZiAoZnJvbnQpCisJ
CWtyZWZfZ2V0KCZmcm9udC0+cmVmKTsKKwlzcGluX3VubG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcu
bG9jayk7CisJaWYgKGZyb250KQorCQlyZXR1cm4gZnJvbnQ7CisKKwlmcm9udCA9IGttYWxsb2Mo
c2l6ZW9mKCpmcm9udCksIEdGUF9LRVJORUwpOworCWlmICghZnJvbnQpCisJCXJldHVybiBOVUxM
OworCisJZnJvbnQtPm9iaiA9IG9iajsKKwlrcmVmX2luaXQoJmZyb250LT5yZWYpOworCWF0b21p
Y19zZXQoJmZyb250LT5iaXRzLCAwKTsKKwlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZmcm9udC0+
d3JpdGUsCisJCQkgZnJvbnRidWZmZXJfYWN0aXZlLCBmcm9udGJ1ZmZlcl9yZXRpcmUpOworCisJ
c3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKKwlpZiAob2JqLT5mcm9udGJ1ZmZl
cikgeworCQlrZnJlZShmcm9udCk7CisJCWZyb250ID0gb2JqLT5mcm9udGJ1ZmZlcjsKKwkJa3Jl
Zl9nZXQoJmZyb250LT5yZWYpOworCX0gZWxzZSB7CisJCWk5MTVfZ2VtX29iamVjdF9nZXQob2Jq
KTsKKwkJb2JqLT5mcm9udGJ1ZmZlciA9IGZyb250OworCX0KKwlzcGluX3VubG9jaygmaTkxNS0+
ZmJfdHJhY2tpbmcubG9jayk7CisKKwlyZXR1cm4gZnJvbnQ7Cit9CisKK3ZvaWQgaW50ZWxfZnJv
bnRidWZmZXJfcHV0KHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQpCit7CisJa3JlZl9w
dXRfbG9jaygmZnJvbnQtPnJlZiwKKwkJICAgICAgZnJvbnRidWZmZXJfcmVsZWFzZSwKKwkJICAg
ICAgJnRvX2k5MTUoZnJvbnQtPm9iai0+YmFzZS5kZXYpLT5mYl90cmFja2luZy5sb2NrKTsKK30K
KworLyoqCisgKiBpbnRlbF9mcm9udGJ1ZmZlcl90cmFjayAtIHVwZGF0ZSBmcm9udGJ1ZmZlciB0
cmFja2luZworICogQG9sZDogY3VycmVudCBidWZmZXIgZm9yIHRoZSBmcm9udGJ1ZmZlciBzbG90
cworICogQG5ldzogbmV3IGJ1ZmZlciBmb3IgdGhlIGZyb250YnVmZmVyIHNsb3RzCisgKiBAZnJv
bnRidWZmZXJfYml0czogYml0bWFzayBvZiBmcm9udGJ1ZmZlciBzbG90cworICoKKyAqIFRoaXMg
dXBkYXRlcyB0aGUgZnJvbnRidWZmZXIgdHJhY2tpbmcgYml0cyBAZnJvbnRidWZmZXJfYml0cyBi
eSBjbGVhcmluZyB0aGVtCisgKiBmcm9tIEBvbGQgYW5kIHNldHRpbmcgdGhlbSBpbiBAbmV3LiBC
b3RoIEBvbGQgYW5kIEBuZXcgY2FuIGJlIE5VTEwuCisgKi8KK3ZvaWQgaW50ZWxfZnJvbnRidWZm
ZXJfdHJhY2soc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpvbGQsCisJCQkgICAgIHN0cnVjdCBp
bnRlbF9mcm9udGJ1ZmZlciAqbmV3LAorCQkJICAgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJf
Yml0cykKK3sKKwkvKgorCSAqIENvbnRyb2wgb2YgaW5kaXZpZHVhbCBiaXRzIHdpdGhpbiB0aGUg
bWFzayBhcmUgZ3VhcmRlZCBieQorCSAqIHRoZSBvd25pbmcgcGxhbmUtPm11dGV4LCBpLmUuIHdl
IGNhbiBuZXZlciBzZWUgY29uY3VycmVudAorCSAqIG1hbmlwdWxhdGlvbiBvZiBpbmRpdmlkdWFs
IGJpdHMuIEJ1dCBzaW5jZSB0aGUgYml0ZmllbGQgYXMgYSB3aG9sZQorCSAqIGlzIHVwZGF0ZWQg
dXNpbmcgUk1XLCB3ZSBuZWVkIHRvIHVzZSBhdG9taWNzIGluIG9yZGVyIHRvIHVwZGF0ZQorCSAq
IHRoZSBiaXRzLgorCSAqLworCUJVSUxEX0JVR19PTihJTlRFTF9GUk9OVEJVRkZFUl9CSVRTX1BF
Ul9QSVBFICogSTkxNV9NQVhfUElQRVMgPgorCQkgICAgIEJJVFNfUEVSX1RZUEUoYXRvbWljX3Qp
KTsKKworCWlmIChvbGQpIHsKKwkJV0FSTl9PTighKGF0b21pY19yZWFkKCZvbGQtPmJpdHMpICYg
ZnJvbnRidWZmZXJfYml0cykpOworCQlhdG9taWNfYW5kbm90KGZyb250YnVmZmVyX2JpdHMsICZv
bGQtPmJpdHMpOworCX0KKworCWlmIChuZXcpIHsKKwkJV0FSTl9PTihhdG9taWNfcmVhZCgmbmV3
LT5iaXRzKSAmIGZyb250YnVmZmVyX2JpdHMpOworCQlhdG9taWNfb3IoZnJvbnRidWZmZXJfYml0
cywgJm5ldy0+Yml0cyk7CisJfQogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9mcm9udGJ1ZmZlci5oCmluZGV4IDU3MjczMjBjODA4NC4uYWRjNjRkNjFhNGE1IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zyb250YnVmZmVy
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5o
CkBAIC0yNCw3ICsyNCwxMCBAQAogI2lmbmRlZiBfX0lOVEVMX0ZST05UQlVGRkVSX0hfXwogI2Rl
ZmluZSBfX0lOVEVMX0ZST05UQlVGRkVSX0hfXwogCi0jaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX29i
amVjdC5oIgorI2luY2x1ZGUgPGxpbnV4L2F0b21pYy5oPgorI2luY2x1ZGUgPGxpbnV4L2tyZWYu
aD4KKworI2luY2x1ZGUgImk5MTVfYWN0aXZlLmgiCiAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
Owogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Q7CkBAIC0zNywyMyArNDAsMzAgQEAgZW51bSBm
Yl9vcF9vcmlnaW4gewogCU9SSUdJTl9ESVJUWUZCLAogfTsKIAotdm9pZCBpbnRlbF9mcm9udGJ1
ZmZlcl9mbGlwX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Ry
dWN0IGludGVsX2Zyb250YnVmZmVyIHsKKwlzdHJ1Y3Qga3JlZiByZWY7CisJYXRvbWljX3QgYml0
czsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmUgd3JpdGU7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKK307CisKK3ZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9wcmVwYXJlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9i
aXRzKTsKLXZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9jb21wbGV0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfY29tcGxl
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICB1bnNpZ25lZCBmcm9u
dGJ1ZmZlcl9iaXRzKTsKLXZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0
cyk7CiAKLXZvaWQgX19pbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAotCQkJICAgICAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbiwKLQkJCSAg
ICAgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cyk7Ci12b2lkIF9faW50ZWxfZmJfb2Jq
X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkgIGVudW0gZmJfb3Bf
b3JpZ2luIG9yaWdpbiwKLQkJCSAgdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpOworc3Ry
dWN0IGludGVsX2Zyb250YnVmZmVyICoKK2ludGVsX2Zyb250YnVmZmVyX2dldChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKKwordm9pZCBfX2ludGVsX2ZiX2ludmFsaWRhdGUoc3Ry
dWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udCwKKwkJCSAgIGVudW0gZmJfb3Bfb3JpZ2luIG9y
aWdpbiwKKwkJCSAgIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzKTsKIAogLyoqCi0gKiBp
bnRlbF9mYl9vYmpfaW52YWxpZGF0ZSAtIGludmFsaWRhdGUgZnJvbnRidWZmZXIgb2JqZWN0Ci0g
KiBAb2JqOiBHRU0gb2JqZWN0IHRvIGludmFsaWRhdGUKKyAqIGludGVsX2Zyb250YnVmZmVyX2lu
dmFsaWRhdGUgLSBpbnZhbGlkYXRlIGZyb250YnVmZmVyIG9iamVjdAorICogQGZyb250OiBHRU0g
b2JqZWN0IHRvIGludmFsaWRhdGUKICAqIEBvcmlnaW46IHdoaWNoIG9wZXJhdGlvbiBjYXVzZWQg
dGhlIGludmFsaWRhdGlvbgogICoKICAqIFRoaXMgZnVuY3Rpb24gZ2V0cyBjYWxsZWQgZXZlcnkg
dGltZSByZW5kZXJpbmcgb24gdGhlIGdpdmVuIG9iamVjdCBzdGFydHMgYW5kCkBAIC02MiwzNyAr
NzIsNTMgQEAgdm9pZCBfX2ludGVsX2ZiX29ial9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogICogdW50aWwgdGhlIHJlbmRlcmluZyBjb21wbGV0ZXMgb3IgYSBmbGlwIG9u
IHRoaXMgZnJvbnRidWZmZXIgcGxhbmUgaXMKICAqIHNjaGVkdWxlZC4KICAqLwotc3RhdGljIGlu
bGluZSBib29sIGludGVsX2ZiX29ial9pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCi0JCQkJCSAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKK3N0YXRpYyBpbmxp
bmUgYm9vbCBpbnRlbF9mcm9udGJ1ZmZlcl9pbnZhbGlkYXRlKHN0cnVjdCBpbnRlbF9mcm9udGJ1
ZmZlciAqZnJvbnQsCisJCQkJCQllbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pCiB7CiAJdW5zaWdu
ZWQgaW50IGZyb250YnVmZmVyX2JpdHM7CiAKLQlmcm9udGJ1ZmZlcl9iaXRzID0gYXRvbWljX3Jl
YWQoJm9iai0+ZnJvbnRidWZmZXJfYml0cyk7CisJaWYgKCFmcm9udCkKKwkJcmV0dXJuIGZhbHNl
OworCisJZnJvbnRidWZmZXJfYml0cyA9IGF0b21pY19yZWFkKCZmcm9udC0+Yml0cyk7CiAJaWYg
KCFmcm9udGJ1ZmZlcl9iaXRzKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlfX2ludGVsX2ZiX29ial9p
bnZhbGlkYXRlKG9iaiwgb3JpZ2luLCBmcm9udGJ1ZmZlcl9iaXRzKTsKKwlfX2ludGVsX2ZiX2lu
dmFsaWRhdGUoZnJvbnQsIG9yaWdpbiwgZnJvbnRidWZmZXJfYml0cyk7CiAJcmV0dXJuIHRydWU7
CiB9CiAKK3ZvaWQgX19pbnRlbF9mYl9mbHVzaChzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZy
b250LAorCQkgICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCisJCSAgICAgIHVuc2lnbmVk
IGludCBmcm9udGJ1ZmZlcl9iaXRzKTsKKwogLyoqCi0gKiBpbnRlbF9mYl9vYmpfZmx1c2ggLSBm
bHVzaCBmcm9udGJ1ZmZlciBvYmplY3QKLSAqIEBvYmo6IEdFTSBvYmplY3QgdG8gZmx1c2gKKyAq
IGludGVsX2Zyb250YnVmZmVyX2ZsdXNoIC0gZmx1c2ggZnJvbnRidWZmZXIgb2JqZWN0CisgKiBA
ZnJvbnQ6IEdFTSBvYmplY3QgdG8gZmx1c2gKICAqIEBvcmlnaW46IHdoaWNoIG9wZXJhdGlvbiBj
YXVzZWQgdGhlIGZsdXNoCiAgKgogICogVGhpcyBmdW5jdGlvbiBnZXRzIGNhbGxlZCBldmVyeSB0
aW1lIHJlbmRlcmluZyBvbiB0aGUgZ2l2ZW4gb2JqZWN0IGhhcwogICogY29tcGxldGVkIGFuZCBm
cm9udGJ1ZmZlciBjYWNoaW5nIGNhbiBiZSBzdGFydGVkIGFnYWluLgogICovCi1zdGF0aWMgaW5s
aW5lIHZvaWQgaW50ZWxfZmJfb2JqX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmosCi0JCQkJICAgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQorc3RhdGljIGlubGluZSB2
b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsdXNoKHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJv
bnQsCisJCQkJCSAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKIAl1bnNpZ25lZCBpbnQg
ZnJvbnRidWZmZXJfYml0czsKIAotCWZyb250YnVmZmVyX2JpdHMgPSBhdG9taWNfcmVhZCgmb2Jq
LT5mcm9udGJ1ZmZlcl9iaXRzKTsKKwlpZiAoIWZyb250KQorCQlyZXR1cm47CisKKwlmcm9udGJ1
ZmZlcl9iaXRzID0gYXRvbWljX3JlYWQoJmZyb250LT5iaXRzKTsKIAlpZiAoIWZyb250YnVmZmVy
X2JpdHMpCiAJCXJldHVybjsKIAotCV9faW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwgb3JpZ2luLCBm
cm9udGJ1ZmZlcl9iaXRzKTsKKwlfX2ludGVsX2ZiX2ZsdXNoKGZyb250LCBvcmlnaW4sIGZyb250
YnVmZmVyX2JpdHMpOwogfQogCit2b2lkIGludGVsX2Zyb250YnVmZmVyX3RyYWNrKHN0cnVjdCBp
bnRlbF9mcm9udGJ1ZmZlciAqb2xkLAorCQkJICAgICBzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIg
Km5ldywKKwkJCSAgICAgdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpOworCit2b2lkIGlu
dGVsX2Zyb250YnVmZmVyX3B1dChzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250KTsKKwog
I2VuZGlmIC8qIF9fSU5URUxfRlJPTlRCVUZGRVJfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCmluZGV4IDRmNzg1ODZlZTA1ZS4uZTEyNDhlYWNl
MGUxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJs
YXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpA
QCAtMjgxLDkgKzI4MSw5IEBAIHN0YXRpYyB2b2lkIGludGVsX292ZXJsYXlfZmxpcF9wcmVwYXJl
KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCiAJV0FSTl9PTihvdmVybGF5LT5vbGRf
dm1hKTsKIAotCWk5MTVfZ2VtX3RyYWNrX2ZiKG92ZXJsYXktPnZtYSA/IG92ZXJsYXktPnZtYS0+
b2JqIDogTlVMTCwKLQkJCSAgdm1hID8gdm1hLT5vYmogOiBOVUxMLAotCQkJICBJTlRFTF9GUk9O
VEJVRkZFUl9PVkVSTEFZKHBpcGUpKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl90cmFjayhvdmVybGF5
LT52bWEgPyBvdmVybGF5LT52bWEtPm9iai0+ZnJvbnRidWZmZXIgOiBOVUxMLAorCQkJCXZtYSA/
IHZtYS0+b2JqLT5mcm9udGJ1ZmZlciA6IE5VTEwsCisJCQkJSU5URUxfRlJPTlRCVUZGRVJfT1ZF
UkxBWShwaXBlKSk7CiAKIAlpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwX3ByZXBhcmUob3ZlcmxheS0+
aTkxNSwKIAkJCQkgICAgICAgSU5URUxfRlJPTlRCVUZGRVJfT1ZFUkxBWShwaXBlKSk7CkBAIC03
NjgsNyArNzY4LDcgQEAgc3RhdGljIGludCBpbnRlbF9vdmVybGF5X2RvX3B1dF9pbWFnZShzdHJ1
Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAkJcmV0ID0gUFRSX0VSUih2bWEpOwogCQlnb3Rv
IG91dF9waW5fc2VjdGlvbjsKIAl9Ci0JaW50ZWxfZmJfb2JqX2ZsdXNoKG5ld19ibywgT1JJR0lO
X0RJUlRZRkIpOworCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG5ld19iby0+ZnJvbnRidWZmZXIs
IE9SSUdJTl9ESVJUWUZCKTsKIAogCXJldCA9IGk5MTVfdm1hX3B1dF9mZW5jZSh2bWEpOwogCWlm
IChyZXQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xm
bHVzaC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYwppbmRl
eCBjMzE2ODQ2ODJlYWEuLjc3OTQ0OTUwZDRjOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY2xmbHVzaC5jCkBAIC00OSw3ICs0OSw3IEBAIHN0YXRpYyB2b2lkIF9faTkx
NV9kb19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJR0VNX0JV
R19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKTsKIAlkcm1fY2xmbHVzaF9zZyhv
YmotPm1tLnBhZ2VzKTsKLQlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLCBPUklHSU5fQ1BVKTsKKwlp
bnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChvYmotPmZyb250YnVmZmVyLCBPUklHSU5fQ1BVKTsKIH0K
IAogc3RhdGljIHZvaWQgaTkxNV9jbGZsdXNoX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCmluZGV4IDJlM2Nl
MmE2OTY1My4uYTFhZmMyNjkwZTllIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZG9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2RvbWFpbi5jCkBAIC01NTEsMTMgKzU1MSw2IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdG9f
Y3B1X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBib29sIHdyaXRlKQog
CXJldHVybiAwOwogfQogCi1zdGF0aWMgaW5saW5lIGVudW0gZmJfb3Bfb3JpZ2luCi1mYl93cml0
ZV9vcmlnaW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdW5zaWduZWQgaW50IGRv
bWFpbikKLXsKLQlyZXR1cm4gKGRvbWFpbiA9PSBJOTE1X0dFTV9ET01BSU5fR1RUID8KLQkJb2Jq
LT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA6IE9SSUdJTl9DUFUpOwotfQotCiAvKioKICAqIENh
bGxlZCB3aGVuIHVzZXIgc3BhY2UgcHJlcGFyZXMgdG8gdXNlIGFuIG9iamVjdCB3aXRoIHRoZSBD
UFUsIGVpdGhlcgogICogdGhyb3VnaCB0aGUgbW1hcCBpb2N0bCdzIG1hcHBpbmcgb3IgYSBHVFQg
bWFwcGluZy4KQEAgLTY2MSw5ICs2NTQsOCBAQCBpOTE1X2dlbV9zZXRfZG9tYWluX2lvY3RsKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAKIAlpOTE1X2dlbV9vYmplY3RfdW5s
b2NrKG9iaik7CiAKLQlpZiAod3JpdGVfZG9tYWluICE9IDApCi0JCWludGVsX2ZiX29ial9pbnZh
bGlkYXRlKG9iaiwKLQkJCQkJZmJfd3JpdGVfb3JpZ2luKG9iaiwgd3JpdGVfZG9tYWluKSk7CisJ
aWYgKHdyaXRlX2RvbWFpbikKKwkJaW50ZWxfZnJvbnRidWZmZXJfaW52YWxpZGF0ZShvYmotPmZy
b250YnVmZmVyLCBPUklHSU5fQ1BVKTsKIAogb3V0X3VucGluOgogCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyhvYmopOwpAQCAtNzgzLDcgKzc3NSw3IEBAIGludCBpOTE1X2dlbV9vYmplY3Rf
cHJlcGFyZV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0KIAogb3V0
OgotCWludGVsX2ZiX29ial9pbnZhbGlkYXRlKG9iaiwgT1JJR0lOX0NQVSk7CisJaW50ZWxfZnJv
bnRidWZmZXJfaW52YWxpZGF0ZShvYmotPmZyb250YnVmZmVyLCBPUklHSU5fQ1BVKTsKIAlvYmot
Pm1tLmRpcnR5ID0gdHJ1ZTsKIAkvKiByZXR1cm4gd2l0aCB0aGUgcGFnZXMgcGlubmVkICovCiAJ
cmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
bW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwppbmRleCAx
ZTczMTE0OTM1MzAuLjQ4YzJjYmU5YjI3OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fbW1hbi5jCkBAIC0xMDEsOSArMTAxLDYgQEAgaTkxNV9nZW1fbW1hcF9pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQl1cF93cml0ZSgmbW0tPm1tYXBfc2Vt
KTsKIAkJaWYgKElTX0VSUl9WQUxVRShhZGRyKSkKIAkJCWdvdG8gZXJyOwotCi0JCS8qIFRoaXMg
bWF5IHJhY2UsIGJ1dCB0aGF0J3Mgb2ssIGl0IG9ubHkgZ2V0cyBzZXQgKi8KLQkJV1JJVEVfT05D
RShvYmotPmZyb250YnVmZmVyX2dndHRfb3JpZ2luLCBPUklHSU5fQ1BVKTsKIAl9CiAJaTkxNV9n
ZW1fb2JqZWN0X3B1dChvYmopOwogCkBAIC0yODMsNyArMjgwLDYgQEAgdm1fZmF1bHRfdCBpOTE1
X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAkJICogVXNlcnNwYWNlIGlzIG5vdyB3
cml0aW5nIHRocm91Z2ggYW4gdW50cmFja2VkIFZNQSwgYWJhbmRvbgogCQkgKiBhbGwgaG9wZSB0
aGF0IHRoZSBoYXJkd2FyZSBpcyBhYmxlIHRvIHRyYWNrIGZ1dHVyZSB3cml0ZXMuCiAJCSAqLwot
CQlvYmotPmZyb250YnVmZmVyX2dndHRfb3JpZ2luID0gT1JJR0lOX0NQVTsKIAogCQl2bWEgPSBp
OTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCAmdmlldywgMCwgMCwgZmxhZ3MpOwogCQlpZiAo
SVNfRVJSKHZtYSkgJiYgIXZpZXcudHlwZSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX29iamVjdC5jCmluZGV4IDM5MjljM2E2YjI4MS4uMDgwN2JiNTQ2NGNmIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC00NiwxNiArNDYsNiBA
QCB2b2lkIGk5MTVfZ2VtX29iamVjdF9mcmVlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopCiAJcmV0dXJuIGttZW1fY2FjaGVfZnJlZShnbG9iYWwuc2xhYl9vYmplY3RzLCBvYmopOwog
fQogCi1zdGF0aWMgdm9pZAotZnJvbnRidWZmZXJfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0ICphY3RpdmUsCi0JCSAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCi17Ci0J
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9Ci0JCWNvbnRhaW5lcl9vZihhY3RpdmUs
IHR5cGVvZigqb2JqKSwgZnJvbnRidWZmZXJfd3JpdGUpOwotCi0JaW50ZWxfZmJfb2JqX2ZsdXNo
KG9iaiwgT1JJR0lOX0NTKTsKLX0KLQogdm9pZCBpOTE1X2dlbV9vYmplY3RfaW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdF9vcHMgKm9wcykKIHsKQEAgLTcyLDEwICs2Miw2IEBAIHZvaWQgaTkxNV9nZW1fb2Jq
ZWN0X2luaXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogCW9iai0+b3BzID0g
b3BzOwogCi0Jb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA9IE9SSUdJTl9HVFQ7Ci0JaTkx
NV9hY3RpdmVfcmVxdWVzdF9pbml0KCZvYmotPmZyb250YnVmZmVyX3dyaXRlLAotCQkJCSBOVUxM
LCBmcm9udGJ1ZmZlcl9yZXRpcmUpOwotCiAJb2JqLT5tbS5tYWR2ID0gSTkxNV9NQURWX1dJTExO
RUVEOwogCUlOSVRfUkFESVhfVFJFRSgmb2JqLT5tbS5nZXRfcGFnZS5yYWRpeCwgR0ZQX0tFUk5F
TCB8IF9fR0ZQX05PV0FSTik7CiAJbXV0ZXhfaW5pdCgmb2JqLT5tbS5nZXRfcGFnZS5sb2NrKTsK
QEAgLTE4Nyw3ICsxNzMsNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVfb2JqZWN0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCQlHRU1fQlVHX09OKGF0b21pY19yZWFk
KCZvYmotPmJpbmRfY291bnQpKTsKIAkJR0VNX0JVR19PTihvYmotPnVzZXJmYXVsdF9jb3VudCk7
Ci0JCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJm9iai0+ZnJvbnRidWZmZXJfYml0cykpOwogCQlH
RU1fQlVHX09OKCFsaXN0X2VtcHR5KCZvYmotPmx1dF9saXN0KSk7CiAKIAkJYXRvbWljX3NldCgm
b2JqLT5tbS5wYWdlc19waW5fY291bnQsIDApOwpAQCAtMjMwLDYgKzIxNSw4IEBAIHZvaWQgaTkx
NV9nZW1fZnJlZV9vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW1fb2JqKQogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB0b19pbnRlbF9ibyhnZW1fb2JqKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CiAKKwlH
RU1fQlVHX09OKGk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihvYmopKTsKKwogCS8qCiAJ
ICogQmVmb3JlIHdlIGZyZWUgdGhlIG9iamVjdCwgbWFrZSBzdXJlIGFueSBwdXJlIFJDVS1vbmx5
CiAJICogcmVhZC1zaWRlIGNyaXRpY2FsIHNlY3Rpb25zIGFyZSBjb21wbGV0ZSwgZS5nLgpAQCAt
MjYxLDEzICsyNDgsNiBAQCB2b2lkIGk5MTVfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2Vt
X29iamVjdCAqZ2VtX29iaikKIAkJcXVldWVfd29yayhpOTE1LT53cSwgJmk5MTUtPm1tLmZyZWVf
d29yayk7CiB9CiAKLXN0YXRpYyBpbmxpbmUgZW51bSBmYl9vcF9vcmlnaW4KLWZiX3dyaXRlX29y
aWdpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1bnNpZ25lZCBpbnQgZG9tYWlu
KQotewotCXJldHVybiAoZG9tYWluID09IEk5MTVfR0VNX0RPTUFJTl9HVFQgPwotCQlvYmotPmZy
b250YnVmZmVyX2dndHRfb3JpZ2luIDogT1JJR0lOX0NQVSk7Ci19Ci0KIHN0YXRpYyBib29sIGdw
dV93cml0ZV9uZWVkc19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7
CiAJcmV0dXJuICEob2JqLT5jYWNoZV9sZXZlbCA9PSBJOTE1X0NBQ0hFX05PTkUgfHwKQEAgLTI5
MCw4ICsyNzAsNyBAQCBpOTE1X2dlbV9vYmplY3RfZmx1c2hfd3JpdGVfZG9tYWluKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKQog
CQkJaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXModm1hLT52bS0+Z3QpOwogCi0JCWludGVsX2Zi
X29ial9mbHVzaChvYmosCi0JCQkJICAgZmJfd3JpdGVfb3JpZ2luKG9iaiwgSTkxNV9HRU1fRE9N
QUlOX0dUVCkpOworCQlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChvYmotPmZyb250YnVmZmVyLCBP
UklHSU5fQ1BVKTsKIAogCQlmb3JfZWFjaF9nZ3R0X3ZtYSh2bWEsIG9iaikgewogCQkJaWYgKHZt
YS0+aW9tYXApCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5k
ZXggMzcxNGNmMjM0ZDY0Li5hYmMyM2U3ZTEzYTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTE2MSw3ICsxNjEsNyBAQCBpOTE1X2dlbV9vYmplY3Rf
bmVlZHNfYXN5bmNfY2FuY2VsKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiBzdGF0aWMgaW5saW5lIGJvb2wKIGk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihjb25z
dCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCXJldHVybiBSRUFEX09OQ0Uo
b2JqLT5mcmFtZWJ1ZmZlcl9yZWZlcmVuY2VzKTsKKwlyZXR1cm4gUkVBRF9PTkNFKG9iai0+ZnJv
bnRidWZmZXIpOwogfQogCiBzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCmluZGV4IGQ0NzRjNmFj
NDEwMC4uZWRlMGViNDIxOGE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX29iamVjdF90eXBlcy5oCkBAIC0xMyw2ICsxMyw3IEBACiAjaW5jbHVkZSAiaTkxNV9z
ZWxmdGVzdC5oIgogCiBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdDsKK3N0cnVjdCBpbnRlbF9m
cm9uYnVmZmVyOwogCiAvKgogICogc3RydWN0IGk5MTVfbHV0X2hhbmRsZSB0cmFja3MgdGhlIGZh
c3QgbG9va3VwcyBmcm9tIGhhbmRsZSB0byB2bWEgdXNlZApAQCAtMTQxLDkgKzE0Miw3IEBAIHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0IHsKIAkgKi8KIAl1MTYgd3JpdGVfZG9tYWluOwogCi0J
YXRvbWljX3QgZnJvbnRidWZmZXJfYml0czsKLQl1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfZ2d0
dF9vcmlnaW47IC8qIHdyaXRlIG9uY2UgKi8KLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCBm
cm9udGJ1ZmZlcl93cml0ZTsKKwlzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250YnVmZmVy
OwogCiAJLyoqIEN1cnJlbnQgdGlsaW5nIHN0cmlkZSBmb3IgdGhlIG9iamVjdCwgaWYgaXQncyB0
aWxlZC4gKi8KIAl1bnNpZ25lZCBpbnQgdGlsaW5nX2FuZF9zdHJpZGU7CkBAIC0yMjQsOSArMjIz
LDYgQEAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgewogCQlib29sIHF1aXJrZWQ6MTsKIAl9
IG1tOwogCi0JLyoqIFJlZmVyZW5jZXMgZnJvbSBmcmFtZWJ1ZmZlcnMsIGxvY2tzIG91dCB0aWxp
bmcgY2hhbmdlcy4gKi8KLQl1bnNpZ25lZCBpbnQgZnJhbWVidWZmZXJfcmVmZXJlbmNlczsKLQog
CS8qKiBSZWNvcmQgb2YgYWRkcmVzcyBiaXQgMTcgb2YgZWFjaCBwYWdlIGF0IGxhc3QgdW5iaW5k
LiAqLwogCXVuc2lnbmVkIGxvbmcgKmJpdF8xNzsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYwppbmRleCBkYjFkZmZkMjBjYjguLjFmNjA5MzZhMDlhZiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kZWJ1Z2ZzLmMKQEAgLTEzOCw3ICsxMzgsNiBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNl
cV9maWxlICptLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CiAJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCXVuc2ln
bmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzOwogCWludCBwaW5fY291bnQgPSAwOwogCiAJc2VxX3By
aW50ZihtLCAiJXBLOiAlYyVjJWMlYyAlOHpkS2lCICUwMnggJTAyeCAlcyVzJXMiLApAQCAtMjI4
LDEwICsyMjcsNiBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWVuZ2luZSA9IGk5MTVfZ2VtX29iamVjdF9sYXN0X3dy
aXRlX2VuZ2luZShvYmopOwogCWlmIChlbmdpbmUpCiAJCXNlcV9wcmludGYobSwgIiAoJXMpIiwg
ZW5naW5lLT5uYW1lKTsKLQotCWZyb250YnVmZmVyX2JpdHMgPSBhdG9taWNfcmVhZCgmb2JqLT5m
cm9udGJ1ZmZlcl9iaXRzKTsKLQlpZiAoZnJvbnRidWZmZXJfYml0cykKLQkJc2VxX3ByaW50Ziht
LCAiIChmcm9udGJ1ZmZlcjogMHglMDN4KSIsIGZyb250YnVmZmVyX2JpdHMpOwogfQogCiBzdHJ1
Y3QgZmlsZV9zdGF0cyB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA0ODg3MjJlYjVlY2Uu
LmNlMzQxNDEzZmU3MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0yNDYyLDEwICsyNDYy
LDYgQEAgaW50IGk5MTVfZ2VtX21tYXBfZ3R0KHN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2LCBz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkgICAgICB1MzIgaGFuZGxlLCB1NjQgKm9mZnNldCk7
CiBpbnQgaTkxNV9nZW1fbW1hcF9ndHRfdmVyc2lvbih2b2lkKTsKIAotdm9pZCBpOTE1X2dlbV90
cmFja19mYihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2xkLAotCQkgICAgICAgc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm5ldywKLQkJICAgICAgIHVuc2lnbmVkIGZyb250YnVmZmVy
X2JpdHMpOwotCiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfZ2VtX3NldF9nbG9iYWxfc2Vxbm8oc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdTMyIHNlcW5vKTsKIAogc3RhdGljIGlubGluZSB1MzIgaTkx
NV9yZXNldF9jb3VudChzdHJ1Y3QgaTkxNV9ncHVfZXJyb3IgKmVycm9yKQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtLmMKaW5kZXggMzJhZGZkMTBmZWRhLi43Y2YzMTM1ZWM2ZmIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW0uYwpAQCAtMTM5LDE3ICsxMzksMTkgQEAgaTkxNV9nZW1fcGh5c19wd3JpdGUoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl2b2lkICp2YWRkciA9IG9iai0+cGh5c19o
YW5kbGUtPnZhZGRyICsgYXJncy0+b2Zmc2V0OwogCWNoYXIgX191c2VyICp1c2VyX2RhdGEgPSB1
NjRfdG9fdXNlcl9wdHIoYXJncy0+ZGF0YV9wdHIpOwogCi0JLyogV2UgbWFudWFsbHkgY29udHJv
bCB0aGUgZG9tYWluIGhlcmUgYW5kIHByZXRlbmQgdGhhdCBpdAorCS8qCisJICogV2UgbWFudWFs
bHkgY29udHJvbCB0aGUgZG9tYWluIGhlcmUgYW5kIHByZXRlbmQgdGhhdCBpdAogCSAqIHJlbWFp
bnMgY29oZXJlbnQgaS5lLiBpbiB0aGUgR1RUIGRvbWFpbiwgbGlrZSBzaG1lbV9wd3JpdGUuCiAJ
ICovCi0JaW50ZWxfZmJfb2JqX2ludmFsaWRhdGUob2JqLCBPUklHSU5fQ1BVKTsKKwlpbnRlbF9m
cm9udGJ1ZmZlcl9pbnZhbGlkYXRlKG9iai0+ZnJvbnRidWZmZXIsIE9SSUdJTl9DUFUpOworCiAJ
aWYgKGNvcHlfZnJvbV91c2VyKHZhZGRyLCB1c2VyX2RhdGEsIGFyZ3MtPnNpemUpKQogCQlyZXR1
cm4gLUVGQVVMVDsKIAogCWRybV9jbGZsdXNoX3ZpcnRfcmFuZ2UodmFkZHIsIGFyZ3MtPnNpemUp
OwogCWludGVsX2d0X2NoaXBzZXRfZmx1c2goJnRvX2k5MTUob2JqLT5iYXNlLmRldiktPmd0KTsK
IAotCWludGVsX2ZiX29ial9mbHVzaChvYmosIE9SSUdJTl9DUFUpOworCWludGVsX2Zyb250YnVm
ZmVyX2ZsdXNoKG9iai0+ZnJvbnRidWZmZXIsIE9SSUdJTl9DUFUpOwogCXJldHVybiAwOwogfQog
CkBAIC01OTQsNyArNTk2LDcgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCWdvdG8gb3V0X3VucGluOwogCX0KIAotCWludGVsX2Zi
X29ial9pbnZhbGlkYXRlKG9iaiwgT1JJR0lOX0NQVSk7CisJaW50ZWxfZnJvbnRidWZmZXJfaW52
YWxpZGF0ZShvYmotPmZyb250YnVmZmVyLCBPUklHSU5fQ1BVKTsKIAogCXVzZXJfZGF0YSA9IHU2
NF90b191c2VyX3B0cihhcmdzLT5kYXRhX3B0cik7CiAJb2Zmc2V0ID0gYXJncy0+b2Zmc2V0OwpA
QCAtNjM2LDcgKzYzOCw3IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCQl1c2VyX2RhdGEgKz0gcGFnZV9sZW5ndGg7CiAJCW9mZnNl
dCArPSBwYWdlX2xlbmd0aDsKIAl9Ci0JaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwgT1JJR0lOX0NQ
VSk7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2gob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NQ
VSk7CiAKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3Vu
cGluOgpAQCAtNzI5LDcgKzczMSw3IEBAIGk5MTVfZ2VtX3NobWVtX3B3cml0ZShzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlvZmZzZXQgPSAwOwogCX0KIAotCWludGVsX2ZiX29i
al9mbHVzaChvYmosIE9SSUdJTl9DUFUpOworCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG9iai0+
ZnJvbnRidWZmZXIsIE9SSUdJTl9DUFUpOwogCWk5MTVfZ2VtX29iamVjdF91bmxvY2tfZmVuY2Uo
b2JqLCBmZW5jZSk7CiAKIAlyZXR1cm4gcmV0OwpAQCAtMTc0NiwzOSArMTc0OCw2IEBAIGludCBp
OTE1X2dlbV9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUpCiAJcmV0dXJuIHJldDsKIH0KIAotLyoqCi0gKiBpOTE1X2dlbV90cmFja19mYiAt
IHVwZGF0ZSBmcm9udGJ1ZmZlciB0cmFja2luZwotICogQG9sZDogY3VycmVudCBHRU0gYnVmZmVy
IGZvciB0aGUgZnJvbnRidWZmZXIgc2xvdHMKLSAqIEBuZXc6IG5ldyBHRU0gYnVmZmVyIGZvciB0
aGUgZnJvbnRidWZmZXIgc2xvdHMKLSAqIEBmcm9udGJ1ZmZlcl9iaXRzOiBiaXRtYXNrIG9mIGZy
b250YnVmZmVyIHNsb3RzCi0gKgotICogVGhpcyB1cGRhdGVzIHRoZSBmcm9udGJ1ZmZlciB0cmFj
a2luZyBiaXRzIEBmcm9udGJ1ZmZlcl9iaXRzIGJ5IGNsZWFyaW5nIHRoZW0KLSAqIGZyb20gQG9s
ZCBhbmQgc2V0dGluZyB0aGVtIGluIEBuZXcuIEJvdGggQG9sZCBhbmQgQG5ldyBjYW4gYmUgTlVM
TC4KLSAqLwotdm9pZCBpOTE1X2dlbV90cmFja19mYihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2xkLAotCQkgICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm5ldywKLQkJICAg
ICAgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMpCi17Ci0JLyogQ29udHJvbCBvZiBpbmRpdmlk
dWFsIGJpdHMgd2l0aGluIHRoZSBtYXNrIGFyZSBndWFyZGVkIGJ5Ci0JICogdGhlIG93bmluZyBw
bGFuZS0+bXV0ZXgsIGkuZS4gd2UgY2FuIG5ldmVyIHNlZSBjb25jdXJyZW50Ci0JICogbWFuaXB1
bGF0aW9uIG9mIGluZGl2aWR1YWwgYml0cy4gQnV0IHNpbmNlIHRoZSBiaXRmaWVsZCBhcyBhIHdo
b2xlCi0JICogaXMgdXBkYXRlZCB1c2luZyBSTVcsIHdlIG5lZWQgdG8gdXNlIGF0b21pY3MgaW4g
b3JkZXIgdG8gdXBkYXRlCi0JICogdGhlIGJpdHMuCi0JICovCi0JQlVJTERfQlVHX09OKElOVEVM
X0ZST05UQlVGRkVSX0JJVFNfUEVSX1BJUEUgKiBJOTE1X01BWF9QSVBFUyA+Ci0JCSAgICAgQklU
U19QRVJfVFlQRShhdG9taWNfdCkpOwotCi0JaWYgKG9sZCkgewotCQlXQVJOX09OKCEoYXRvbWlj
X3JlYWQoJm9sZC0+ZnJvbnRidWZmZXJfYml0cykgJiBmcm9udGJ1ZmZlcl9iaXRzKSk7Ci0JCWF0
b21pY19hbmRub3QoZnJvbnRidWZmZXJfYml0cywgJm9sZC0+ZnJvbnRidWZmZXJfYml0cyk7Ci0J
fQotCi0JaWYgKG5ldykgewotCQlXQVJOX09OKGF0b21pY19yZWFkKCZuZXctPmZyb250YnVmZmVy
X2JpdHMpICYgZnJvbnRidWZmZXJfYml0cyk7Ci0JCWF0b21pY19vcihmcm9udGJ1ZmZlcl9iaXRz
LCAmbmV3LT5mcm9udGJ1ZmZlcl9iaXRzKTsKLQl9Ci19Ci0KICNpZiBJU19FTkFCTEVEKENPTkZJ
R19EUk1fSTkxNV9TRUxGVEVTVCkKICNpbmNsdWRlICJzZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNl
LmMiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfZ2VtLmMiCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEu
YwppbmRleCA4YmUxYmJlZjQwZTUuLmQzOGVmMmVmM2NlNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Zt
YS5jCkBAIC05MDgsOCArOTA4LDEwIEBAIGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwKIAkJcmV0dXJuIGVycjsKIAogCWlmIChmbGFncyAmIEVYRUNfT0JK
RUNUX1dSSVRFKSB7Ci0JCWlmIChpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9D
UykpCi0JCQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZvYmotPmZyb250YnVmZmVyX3dyaXRl
LCBycSk7CisJCWlmIChpbnRlbF9mcm9udGJ1ZmZlcl9pbnZhbGlkYXRlKG9iai0+ZnJvbnRidWZm
ZXIsIE9SSUdJTl9DUykpCisJCQlpOTE1X2FjdGl2ZV9yZWYoJm9iai0+ZnJvbnRidWZmZXItPndy
aXRlLAorCQkJCQlycS0+ZmVuY2UuY29udGV4dCwKKwkJCQkJcnEpOwogCiAJCXJlc2VydmF0aW9u
X29iamVjdF9hZGRfZXhjbF9mZW5jZSh2bWEtPnJlc3YsICZycS0+ZmVuY2UpOwogCQlvYmotPndy
aXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9SRU5ERVI7Ci0tIAoyLjIzLjAucmMxCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

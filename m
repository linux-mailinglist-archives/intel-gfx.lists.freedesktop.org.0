Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id ED9FE47AA3
	for <lists+intel-gfx@lfdr.de>; Mon, 17 Jun 2019 09:19:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 670C2891A6;
	Mon, 17 Jun 2019 07:19:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EFCCD89183
 for <intel-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 07:19:35 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16923051-1500050 
 for multiple; Mon, 17 Jun 2019 08:19:15 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 17 Jun 2019 08:19:05 +0100
Message-Id: <20190617071912.20256-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617071912.20256-1-chris@chris-wilson.co.uk>
References: <20190617071912.20256-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 15/22] drm/i915: Provide an i915_active.acquire
 callback
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com, mika.kuoppala@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgaW50cm9kdWNlIGEgY2FsbGJhY2sgZm9yIGk5MTVfYWN0aXZlIHRoYXQgaXMgb25seSBj
YWxsZWQgdGhlIGZpcnN0CnRpbWUgd2UgdXNlIHRoZSBpOTE1X2FjdGl2ZSBhbmQgaXMgc3ltbWV0
cmljYWxseSBwYWlyZWQgd2l0aCB0aGUKaTkxNV9hY3RpdmUucmV0aXJlIGNhbGxiYWNrLCB3ZSBj
YW4gcmVwbGFjZSB0aGUgb3Blbi1jb2RlZCBhbmQKbm9uLWF0b21pYyBpbXBsZW1lbnRhdGlvbnMg
LS0gd2hpY2ggd2lsbCBiZSB2ZXJ5IGZyYWdpbGUgKGkuZS4gYnJva2VuKQp1cG9uIHJlbW92aW5n
IHRoZSBzdHJ1Y3RfbXV0ZXggc2VyaWFsaXNhdGlvbi4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdp
bHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICB8ICA4MiArKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmggICAgICB8ICAxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfbHJjLmMgICAgICAgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3JpbmdidWZmZXIuYyAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9t
b2NrX2VuZ2luZS5jICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYyAgICAgICAgICAgfCAyMTcgKysrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgICAgfCAgMjUgKystCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oICAgICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfdGltZWxpbmUuYyAgICAgICAgIHwgIDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jICAgICAgICAgICAgICB8ICAyMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMgfCAgMTIgKy0KIDEzIGZpbGVzIGNoYW5nZWQsIDIyNSBp
bnNlcnRpb25zKCspLCAxOTMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggMWNlMTIyZjRlZDI1Li45MjYyYTFkNGY3NjMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtOTIzLDgg
KzkyMywxMiBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFycmllcl90YXNrKHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgsCiAJaWYgKCFjYikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpOTE1X2Fj
dGl2ZV9pbml0KGk5MTUsICZjYi0+YmFzZSwgY2JfcmV0aXJlKTsKLQlpOTE1X2FjdGl2ZV9hY3F1
aXJlKCZjYi0+YmFzZSk7CisJaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmY2ItPmJhc2UsIE5VTEws
IGNiX3JldGlyZSk7CisJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZSgmY2ItPmJhc2UpOworCWlm
IChlcnIpIHsKKwkJa2ZyZWUoY2IpOworCQlyZXR1cm4gZXJyOworCX0KIAogCWZvcl9lYWNoX2dl
bV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CiAJ
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29u
dGV4dC5jCmluZGV4IDJjNDU0ZjIyN2MyZS4uYjE5YWE4MjNhNTFhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC05NSwxMSArOTUsMTQgQEAgdm9pZCBpbnRlbF9j
b250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAlpbnRlbF9jb250ZXh0X3B1
dChjZSk7CiB9CiAKLXN0YXRpYyBpbnQgX19jb250ZXh0X3Bpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBmbGFncykKK3N0YXRpYyBpbnQgX19jb250ZXh0X3Bpbl9z
dGF0ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKKwl1NjQgZmxhZ3M7CiAJaW50IGVycjsKIAot
CWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIGZsYWdzIHwgUElOX0dMT0JBTCk7CisJZmxh
Z3MgPSBQSU5fSElHSCB8IFBJTl9HTE9CQUw7CisJZmxhZ3MgfD0gaTkxNV92bV90b19nZ3R0KHZt
YS0+dm0pLT5waW5fYmlhcyB8IFBJTl9PRkZTRVRfQklBUzsKKwllcnIgPSBpOTE1X3ZtYV9waW4o
dm1hLCAwLCAwLCBmbGFncyk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMTE5LDcg
KzEyMiw3IEBAIHN0YXRpYyB2b2lkIF9fY29udGV4dF91bnBpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVs
X2NvbnRleHRfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqYWN0aXZlKQorc3RhdGljIHZvaWQg
X19pbnRlbF9jb250ZXh0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKmFjdGl2ZSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBjb250YWluZXJfb2YoYWN0aXZlLCB0eXBlb2YoKmNl
KSwgYWN0aXZlKTsKIApAQCAtMTI5LDY1ICsxMzIsNTggQEAgc3RhdGljIHZvaWQgaW50ZWxfY29u
dGV4dF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCiAJaW50ZWxfY29udGV4dF9w
dXQoY2UpOwogfQogCi12b2lkCi1pbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLAotCQkgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkgICBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JR0VNX0JVR19PTighZW5naW5lLT5jb3BzKTsK
LQotCWtyZWZfaW5pdCgmY2UtPnJlZik7Ci0KLQljZS0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JY2Ut
PmVuZ2luZSA9IGVuZ2luZTsKLQljZS0+b3BzID0gZW5naW5lLT5jb3BzOwotCWNlLT5zc2V1ID0g
ZW5naW5lLT5zc2V1OwotCi0JSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGluayk7Ci0JSU5J
VF9MSVNUX0hFQUQoJmNlLT5zaWduYWxzKTsKLQotCW11dGV4X2luaXQoJmNlLT5waW5fbXV0ZXgp
OwotCi0JaTkxNV9hY3RpdmVfaW5pdChjdHgtPmk5MTUsICZjZS0+YWN0aXZlLCBpbnRlbF9jb250
ZXh0X3JldGlyZSk7Ci19Ci0KLWludCBpbnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSwgdW5zaWduZWQgbG9uZyBmbGFncykKK3N0YXRpYyBpbnQgX19p
bnRlbF9jb250ZXh0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKmFjdGl2ZSkKIHsKKwlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBjb250YWluZXJfb2YoYWN0aXZlLCB0eXBlb2YoKmNlKSwg
YWN0aXZlKTsKIAlpbnQgZXJyOwogCi0JaWYgKCFpOTE1X2FjdGl2ZV9hY3F1aXJlKCZjZS0+YWN0
aXZlKSkKLQkJcmV0dXJuIDA7Ci0KIAlpbnRlbF9jb250ZXh0X2dldChjZSk7CiAKIAlpZiAoIWNl
LT5zdGF0ZSkKIAkJcmV0dXJuIDA7CiAKLQllcnIgPSBfX2NvbnRleHRfcGluX3N0YXRlKGNlLT5z
dGF0ZSwgZmxhZ3MpOwotCWlmIChlcnIpIHsKLQkJaTkxNV9hY3RpdmVfY2FuY2VsKCZjZS0+YWN0
aXZlKTsKLQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCQlyZXR1cm4gZXJyOwotCX0KKwllcnIg
PSBfX2NvbnRleHRfcGluX3N0YXRlKGNlLT5zdGF0ZSk7CisJaWYgKGVycikKKwkJZ290byBlcnJf
cHV0OwogCiAJLyogUHJlYWxsb2NhdGUgdHJhY2tpbmcgbm9kZXMgKi8KIAlpZiAoIWk5MTVfZ2Vt
X2NvbnRleHRfaXNfa2VybmVsKGNlLT5nZW1fY29udGV4dCkpIHsKIAkJZXJyID0gaTkxNV9hY3Rp
dmVfYWNxdWlyZV9wcmVhbGxvY2F0ZV9iYXJyaWVyKCZjZS0+YWN0aXZlLAogCQkJCQkJCSAgICAg
IGNlLT5lbmdpbmUpOwotCQlpZiAoZXJyKSB7Ci0JCQlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZjZS0+
YWN0aXZlKTsKLQkJCXJldHVybiBlcnI7Ci0JCX0KKwkJaWYgKGVycikKKwkJCWdvdG8gZXJyX3Vu
cGluOwogCX0KIAogCXJldHVybiAwOworCitlcnJfdW5waW46CisJX19jb250ZXh0X3VucGluX3N0
YXRlKGNlLT5zdGF0ZSk7CitlcnJfcHV0OgorCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwlyZXR1
cm4gZXJyOwogfQogCi12b2lkIGludGVsX2NvbnRleHRfYWN0aXZlX3JlbGVhc2Uoc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKQordm9pZAoraW50ZWxfY29udGV4dF9pbml0KHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSwKKwkJICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKKwkJICAgc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCS8qIE5vZGVzIHByZWFsbG9jYXRlZCBp
biBpbnRlbF9jb250ZXh0X2FjdGl2ZSgpICovCi0JaTkxNV9hY3RpdmVfYWNxdWlyZV9iYXJyaWVy
KCZjZS0+YWN0aXZlKTsKLQlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZjZS0+YWN0aXZlKTsKKwlHRU1f
QlVHX09OKCFlbmdpbmUtPmNvcHMpOworCisJa3JlZl9pbml0KCZjZS0+cmVmKTsKKworCWNlLT5n
ZW1fY29udGV4dCA9IGN0eDsKKwljZS0+ZW5naW5lID0gZW5naW5lOworCWNlLT5vcHMgPSBlbmdp
bmUtPmNvcHM7CisJY2UtPnNzZXUgPSBlbmdpbmUtPnNzZXU7CisKKwlJTklUX0xJU1RfSEVBRCgm
Y2UtPnNpZ25hbF9saW5rKTsKKwlJTklUX0xJU1RfSEVBRCgmY2UtPnNpZ25hbHMpOworCisJbXV0
ZXhfaW5pdCgmY2UtPnBpbl9tdXRleCk7CisKKwlpOTE1X2FjdGl2ZV9pbml0KGN0eC0+aTkxNSwg
JmNlLT5hY3RpdmUsCisJCQkgX19pbnRlbF9jb250ZXh0X2FjdGl2ZSwgX19pbnRlbF9jb250ZXh0
X3JldGlyZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2xvYmFsX2NvbnRleHRfc2hyaW5rKHZv
aWQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgKaW5kZXggYTQ3Mjc1YmM0
ZjAxLi40MGNkODMyMGZjYzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2NvbnRleHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmgKQEAgLTksNiArOSw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9sb2NrZGVwLmg+CiAKKyNpbmNs
dWRlICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1ZGUgImludGVsX2NvbnRleHRfdHlwZXMuaCIKICNp
bmNsdWRlICJpbnRlbF9lbmdpbmVfdHlwZXMuaCIKIApAQCAtMTAyLDggKzEwMywxNyBAQCBzdGF0
aWMgaW5saW5lIHZvaWQgaW50ZWxfY29udGV4dF9leGl0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZSkKIAkJY2UtPm9wcy0+ZXhpdChjZSk7CiB9CiAKLWludCBpbnRlbF9jb250ZXh0X2FjdGl2ZV9h
Y3F1aXJlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdW5zaWduZWQgbG9uZyBmbGFncyk7Ci12
b2lkIGludGVsX2NvbnRleHRfYWN0aXZlX3JlbGVhc2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNl
KTsKK3N0YXRpYyBpbmxpbmUgaW50IGludGVsX2NvbnRleHRfYWN0aXZlX2FjcXVpcmUoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlKQoreworCXJldHVybiBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZjZS0+
YWN0aXZlKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGludGVsX2NvbnRleHRfYWN0aXZlX3Jl
bGVhc2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCS8qIE5vZGVzIHByZWFsbG9jYXRl
ZCBpbiBpbnRlbF9jb250ZXh0X2FjdGl2ZSgpICovCisJaTkxNV9hY3RpdmVfYWNxdWlyZV9iYXJy
aWVyKCZjZS0+YWN0aXZlKTsKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZjZS0+YWN0aXZlKTsKK30K
IAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqaW50ZWxfY29udGV4dF9nZXQo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMu
YwppbmRleCBjZDRjZjRkMGIzMGMuLjVkYmM0M2M3MDQ5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMKQEAgLTE1NjUsMTIgKzE1NjUsMTAgQEAgX19leGVjbGlzdHNfY29udGV4dF9w
aW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQlnb3RvIGVycjsKIAlHRU1fQlVHX09OKCFj
ZS0+c3RhdGUpOwogCi0JcmV0ID0gaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShjZSwKLQkJ
CQkJICAgZW5naW5lLT5pOTE1LT5nZ3R0LnBpbl9iaWFzIHwKLQkJCQkJICAgUElOX09GRlNFVF9C
SUFTIHwKLQkJCQkJICAgUElOX0hJR0gpOworCXJldCA9IGludGVsX2NvbnRleHRfYWN0aXZlX2Fj
cXVpcmUoY2UpOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyOworCUdFTV9CVUdfT04oIWk5MTVfdm1h
X2lzX3Bpbm5lZChjZS0+c3RhdGUpKTsKIAogCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9t
YXAoY2UtPnN0YXRlLT5vYmosCiAJCQkJCWk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZW5naW5lLT5p
OTE1KSB8CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVm
ZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKaW5kZXgg
NzBmOTU0MTRkY2NlLi5hZjBlZmExYTI5M2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yaW5nYnVmZmVyLmMKQEAgLTE0MzcsNyArMTQzNyw3IEBAIHN0YXRpYyBpbnQgcmluZ19j
b250ZXh0X3BpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJCWNlLT5zdGF0ZSA9IHZtYTsK
IAl9CiAKLQllcnIgPSBpbnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKGNlLCBQSU5fSElHSCk7
CisJZXJyID0gaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShjZSk7CiAJaWYgKGVycikKIAkJ
cmV0dXJuIGVycjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19l
bmdpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKaW5kZXggMDg2
ODAxYjUxNDQxLi5iOWMyNzY0YmVjYTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L21vY2tfZW5naW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdp
bmUuYwpAQCAtMTU0LDcgKzE1NCw3IEBAIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X3BpbihzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJCQlyZXR1cm4gLUVOT01FTTsKIAl9CiAKLQlyZXQgPSBp
bnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKGNlLCBQSU5fSElHSCk7CisJcmV0ID0gaW50ZWxf
Y29udGV4dF9hY3RpdmVfYWNxdWlyZShjZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKaW5kZXggMmQwMTlhYzZkYjIwLi42YTlmOGQzN2Y0
MTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwpAQCAtMzAsNDggKzMwLDUwIEBAIHN0
cnVjdCBhY3RpdmVfbm9kZSB7CiB9OwogCiBzdGF0aWMgdm9pZAotX19hY3RpdmVfcGFyayhzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZikKK2FjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpy
ZWYpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47CisJc3RydWN0IHJiX3Jvb3Qgcm9v
dDsKKwlib29sIHJldGlyZSA9IGZhbHNlOwogCi0JcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9l
bnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVlLCBub2RlKSB7Ci0JCUdFTV9CVUdfT04oaTkxNV9h
Y3RpdmVfcmVxdWVzdF9pc3NldCgmaXQtPmJhc2UpKTsKLQkJa21lbV9jYWNoZV9mcmVlKGdsb2Jh
bC5zbGFiX2NhY2hlLCBpdCk7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnJlZi0+Y291bnQp
KTsKKwlpZiAoYXRvbWljX2FkZF91bmxlc3MoJnJlZi0+Y291bnQsIC0xLCAxKSkKKwkJcmV0dXJu
OworCisJLyogT25lIGFjdGl2ZSBtYXkgYmUgZmx1c2hlZCBmcm9tIGluc2lkZSB0aGUgYWNxdWly
ZSBvZiBhbm90aGVyICovCisJbXV0ZXhfbG9ja19uZXN0ZWQoJnJlZi0+bXV0ZXgsIFNJTkdMRV9E
RVBUSF9ORVNUSU5HKTsKKworCS8qIHJldHVybiB0aGUgdW51c2VkIG5vZGVzIHRvIG91ciBzbGFi
Y2FjaGUgLS0gZmx1c2hpbmcgdGhlIGFsbG9jYXRvciAqLworCWlmIChhdG9taWNfZGVjX2FuZF90
ZXN0KCZyZWYtPmNvdW50KSkgeworCQlyb290ID0gcmVmLT50cmVlOworCQlyZWYtPnRyZWUgPSBS
Ql9ST09UOworCQlyZWYtPmNhY2hlID0gTlVMTDsKKwkJcmV0aXJlID0gdHJ1ZTsKIAl9Ci0JcmVm
LT50cmVlID0gUkJfUk9PVDsKLX0KIAotc3RhdGljIHZvaWQKLV9fYWN0aXZlX3JldGlyZShzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZikKLXsKLQlHRU1fQlVHX09OKCFyZWYtPmNvdW50KTsKLQlpZiAo
LS1yZWYtPmNvdW50KQorCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7CisJaWYgKCFyZXRpcmUp
CiAJCXJldHVybjsKIAotCS8qIHJldHVybiB0aGUgdW51c2VkIG5vZGVzIHRvIG91ciBzbGFiY2Fj
aGUgKi8KLQlfX2FjdGl2ZV9wYXJrKHJlZik7Ci0KIAlyZWYtPnJldGlyZShyZWYpOwotfQogCi1z
dGF0aWMgdm9pZAotbm9kZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmJhc2Us
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQotewotCV9fYWN0aXZlX3JldGlyZShjb250YWluZXJf
b2YoYmFzZSwgc3RydWN0IGFjdGl2ZV9ub2RlLCBiYXNlKS0+cmVmKTsKKwlyYnRyZWVfcG9zdG9y
ZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyb290LCBub2RlKSB7CisJCUdFTV9CVUdf
T04oaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmaXQtPmJhc2UpKTsKKwkJa21lbV9jYWNoZV9m
cmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBpdCk7CisJfQogfQogCiBzdGF0aWMgdm9pZAotbGFzdF9y
ZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmJhc2UsIHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxKQorbm9kZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmJhc2UsIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCV9fYWN0aXZlX3JldGlyZShjb250YWluZXJfb2Yo
YmFzZSwgc3RydWN0IGk5MTVfYWN0aXZlLCBsYXN0KSk7CisJYWN0aXZlX3JldGlyZShjb250YWlu
ZXJfb2YoYmFzZSwgc3RydWN0IGFjdGl2ZV9ub2RlLCBiYXNlKS0+cmVmKTsKIH0KIAogc3RhdGlj
IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICoKIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIHsKLQlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGU7CisJ
c3RydWN0IGFjdGl2ZV9ub2RlICpub2RlLCAqcHJlYWxsb2M7CiAJc3RydWN0IHJiX25vZGUgKipw
LCAqcGFyZW50OwotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKm9sZDsKIAogCS8qCiAJICogV2UgdHJh
Y2sgdGhlIG1vc3QgcmVjZW50bHkgdXNlZCB0aW1lbGluZSB0byBza2lwIGEgcmJ0cmVlIHNlYXJj
aApAQCAtNzksMjAgKzgxLDE4IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZiwgdTY0IGlkeCkKIAkgKiBhdCBhbGwuIFdlIGNhbiByZXVzZSB0aGUgbGFzdCBzbG90IGlm
IGl0IGlzIGVtcHR5LCB0aGF0IGlzCiAJICogYWZ0ZXIgdGhlIHByZXZpb3VzIGFjdGl2aXR5IGhh
cyBiZWVuIHJldGlyZWQsIG9yIGlmIGl0IG1hdGNoZXMgdGhlCiAJICogY3VycmVudCB0aW1lbGlu
ZS4KLQkgKgotCSAqIE5vdGUgdGhhdCB3ZSBhbGxvdyB0aGUgdGltZWxpbmUgdG8gYmUgYWN0aXZl
IHNpbXVsdGFuZW91c2x5IGluCi0JICogdGhlIHJidHJlZSBhbmQgdGhlIGxhc3QgY2FjaGUuIFdl
IGRvIHRoaXMgdG8gYXZvaWQgaGF2aW5nCi0JICogdG8gc2VhcmNoIGFuZCByZXBsYWNlIHRoZSBy
YnRyZWUgZWxlbWVudCBmb3IgYSBuZXcgdGltZWxpbmUsIHdpdGgKLQkgKiB0aGUgY29zdCBiZWlu
ZyB0aGF0IHdlIG11c3QgYmUgYXdhcmUgdGhhdCB0aGUgcmVmIG1heSBiZSByZXRpcmVkCi0JICog
dHdpY2UgZm9yIHRoZSBzYW1lIHRpbWVsaW5lIChhcyB0aGUgb2xkZXIgcmJ0cmVlIGVsZW1lbnQg
d2lsbCBiZQotCSAqIHJldGlyZWQgYmVmb3JlIHRoZSBuZXcgcmVxdWVzdCBhZGRlZCB0byBsYXN0
KS4KIAkgKi8KLQlvbGQgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdygmcmVmLT5sYXN0LCBCS0wo
cmVmKSk7Ci0JaWYgKCFvbGQgfHwgb2xkLT5mZW5jZS5jb250ZXh0ID09IGlkeCkKLQkJZ290byBv
dXQ7CisJbm9kZSA9IFJFQURfT05DRShyZWYtPmNhY2hlKTsKKwlpZiAobm9kZSAmJiBub2RlLT50
aW1lbGluZSA9PSBpZHgpCisJCXJldHVybiAmbm9kZS0+YmFzZTsKIAotCS8qIE1vdmUgdGhlIGN1
cnJlbnRseSBhY3RpdmUgZmVuY2UgaW50byB0aGUgcmJ0cmVlICovCi0JaWR4ID0gb2xkLT5mZW5j
ZS5jb250ZXh0OworCS8qIFByZWFsbG9jYXRlIGEgcmVwbGFjZW1lbnQsIGp1c3QgaW4gY2FzZSAq
LworCXByZWFsbG9jID0ga21lbV9jYWNoZV9hbGxvYyhnbG9iYWwuc2xhYl9jYWNoZSwgR0ZQX0tF
Uk5FTCk7CisJaWYgKCFwcmVhbGxvYykKKwkJcmV0dXJuIE5VTEw7CisKKwltdXRleF9sb2NrKCZy
ZWYtPm11dGV4KTsKKwlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSk7CiAKIAlw
YXJlbnQgPSBOVUxMOwogCXAgPSAmcmVmLT50cmVlLnJiX25vZGU7CkBAIC0xMDAsOCArMTAwLDEw
IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIAkJ
cGFyZW50ID0gKnA7CiAKIAkJbm9kZSA9IHJiX2VudHJ5KHBhcmVudCwgc3RydWN0IGFjdGl2ZV9u
b2RlLCBub2RlKTsKLQkJaWYgKG5vZGUtPnRpbWVsaW5lID09IGlkeCkKLQkJCWdvdG8gcmVwbGFj
ZTsKKwkJaWYgKG5vZGUtPnRpbWVsaW5lID09IGlkeCkgeworCQkJa21lbV9jYWNoZV9mcmVlKGds
b2JhbC5zbGFiX2NhY2hlLCBwcmVhbGxvYyk7CisJCQlnb3RvIG91dDsKKwkJfQogCiAJCWlmIChu
b2RlLT50aW1lbGluZSA8IGlkeCkKIAkJCXAgPSAmcGFyZW50LT5yYl9yaWdodDsKQEAgLTEwOSwx
NyArMTExLDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1NjQg
aWR4KQogCQkJcCA9ICZwYXJlbnQtPnJiX2xlZnQ7CiAJfQogCi0Jbm9kZSA9IGttZW1fY2FjaGVf
YWxsb2MoZ2xvYmFsLnNsYWJfY2FjaGUsIEdGUF9LRVJORUwpOwotCi0JLyoga21hbGxvYyBtYXkg
cmV0aXJlIHRoZSByZWYtPmxhc3QgKHRoYW5rcyBzaHJpbmtlcikhICovCi0JaWYgKHVubGlrZWx5
KCFpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdygmcmVmLT5sYXN0LCBCS0wocmVmKSkpKSB7Ci0JCWtt
ZW1fY2FjaGVfZnJlZShnbG9iYWwuc2xhYl9jYWNoZSwgbm9kZSk7Ci0JCWdvdG8gb3V0OwotCX0K
LQotCWlmICh1bmxpa2VseSghbm9kZSkpCi0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwotCisJ
bm9kZSA9IHByZWFsbG9jOwogCWk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdCgmbm9kZS0+YmFzZSwg
TlVMTCwgbm9kZV9yZXRpcmUpOwogCW5vZGUtPnJlZiA9IHJlZjsKIAlub2RlLT50aW1lbGluZSA9
IGlkeDsKQEAgLTEyNywzOCArMTE5LDI3IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZiwgdTY0IGlkeCkKIAlyYl9saW5rX25vZGUoJm5vZGUtPm5vZGUsIHBhcmVudCwg
cCk7CiAJcmJfaW5zZXJ0X2NvbG9yKCZub2RlLT5ub2RlLCAmcmVmLT50cmVlKTsKIAotcmVwbGFj
ZToKLQkvKgotCSAqIE92ZXJ3cml0ZSB0aGUgcHJldmlvdXMgYWN0aXZlIHNsb3QgaW4gdGhlIHJi
dHJlZSB3aXRoIGxhc3QsCi0JICogbGVhdmluZyBsYXN0IHplcm9lZC4gSWYgdGhlIHByZXZpb3Vz
IHNsb3QgaXMgc3RpbGwgYWN0aXZlLAotCSAqIHdlIG11c3QgYmUgY2FyZWZ1bCBhcyB3ZSBub3cg
b25seSBleHBlY3QgdG8gcmVjZWl2ZSBvbmUgcmV0aXJlCi0JICogY2FsbGJhY2sgbm90IHR3bywg
YW5kIHNvIG11Y2ggdW5kbyB0aGUgYWN0aXZlIGNvdW50aW5nIGZvciB0aGUKLQkgKiBvdmVyd3Jp
dHRlbiBzbG90LgotCSAqLwotCWlmIChpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZub2RlLT5i
YXNlKSkgewotCQkvKiBSZXRpcmUgb3Vyc2VsdmVzIGZyb20gdGhlIG9sZCBycS0+YWN0aXZlX2xp
c3QgKi8KLQkJX19saXN0X2RlbF9lbnRyeSgmbm9kZS0+YmFzZS5saW5rKTsKLQkJcmVmLT5jb3Vu
dC0tOwotCQlHRU1fQlVHX09OKCFyZWYtPmNvdW50KTsKLQl9Ci0JR0VNX0JVR19PTihsaXN0X2Vt
cHR5KCZyZWYtPmxhc3QubGluaykpOwotCWxpc3RfcmVwbGFjZV9pbml0KCZyZWYtPmxhc3QubGlu
aywgJm5vZGUtPmJhc2UubGluayk7Ci0Jbm9kZS0+YmFzZS5yZXF1ZXN0ID0gZmV0Y2hfYW5kX3pl
cm8oJnJlZi0+bGFzdC5yZXF1ZXN0KTsKLQogb3V0OgotCXJldHVybiAmcmVmLT5sYXN0OworCXJl
Zi0+Y2FjaGUgPSBub2RlOworCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7CisKKwlyZXR1cm4g
Jm5vZGUtPmJhc2U7CiB9CiAKLXZvaWQgaTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKLQkJICAgICAgc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCi0JCSAgICAg
IHZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSkKK3ZvaWQgX19pOTE1X2Fj
dGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYsCisJCQlpbnQgKCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwK
KwkJCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKKwkJCXN0cnVjdCBs
b2NrX2NsYXNzX2tleSAqa2V5KQogewogCXJlZi0+aTkxNSA9IGk5MTU7CisJcmVmLT5hY3RpdmUg
PSBhY3RpdmU7CiAJcmVmLT5yZXRpcmUgPSByZXRpcmU7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsK
LQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJnJlZi0+bGFzdCwgTlVMTCwgbGFzdF9yZXRpcmUp
OworCXJlZi0+Y2FjaGUgPSBOVUxMOwogCWluaXRfbGxpc3RfaGVhZCgmcmVmLT5iYXJyaWVycyk7
Ci0JcmVmLT5jb3VudCA9IDA7CisJYXRvbWljX3NldCgmcmVmLT5jb3VudCwgMCk7CisJX19tdXRl
eF9pbml0KCZyZWYtPm11dGV4LCAiaTkxNV9hY3RpdmUiLCBrZXkpOwogfQogCiBpbnQgaTkxNV9h
Y3RpdmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLApAQCAtMTY2LDYwICsxNDcsODAgQEAg
aW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJICAgIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogewogCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3Rp
dmU7Ci0JaW50IGVyciA9IDA7CisJaW50IGVycjsKIAogCS8qIFByZXZlbnQgcmVhcGluZyBpbiBj
YXNlIHdlIG1hbGxvYy93YWl0IHdoaWxlIGJ1aWxkaW5nIHRoZSB0cmVlICovCi0JaTkxNV9hY3Rp
dmVfYWNxdWlyZShyZWYpOworCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUocmVmKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOwogCiAJYWN0aXZlID0gYWN0aXZlX2luc3RhbmNlKHJlZiwgdGlt
ZWxpbmUpOwotCWlmIChJU19FUlIoYWN0aXZlKSkgewotCQllcnIgPSBQVFJfRVJSKGFjdGl2ZSk7
CisJaWYgKCFhY3RpdmUpIHsKKwkJZXJyID0gLUVOT01FTTsKIAkJZ290byBvdXQ7CiAJfQogCiAJ
aWYgKCFpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KGFjdGl2ZSkpCi0JCXJlZi0+Y291bnQrKzsK
KwkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CiAJX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChh
Y3RpdmUsIHJxKTsKIAotCUdFTV9CVUdfT04oIXJlZi0+Y291bnQpOwogb3V0OgogCWk5MTVfYWN0
aXZlX3JlbGVhc2UocmVmKTsKIAlyZXR1cm4gZXJyOwogfQogCi1ib29sIGk5MTVfYWN0aXZlX2Fj
cXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCitpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKEJLTChyZWYp
KTsKLQlyZXR1cm4gIXJlZi0+Y291bnQrKzsKKwlpbnQgZXJyOworCisJaWYgKGF0b21pY19hZGRf
dW5sZXNzKCZyZWYtPmNvdW50LCAxLCAwKSkKKwkJcmV0dXJuIDA7CisKKwllcnIgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJnJlZi0+bXV0ZXgpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7
CisKKwlpZiAoIWF0b21pY19yZWFkKCZyZWYtPmNvdW50KSAmJiByZWYtPmFjdGl2ZSkKKwkJZXJy
ID0gcmVmLT5hY3RpdmUocmVmKTsKKwlpZiAoIWVycikKKwkJYXRvbWljX2luYygmcmVmLT5jb3Vu
dCk7CisKKwltdXRleF91bmxvY2soJnJlZi0+bXV0ZXgpOworCisJcmV0dXJuIGVycjsKIH0KIAog
dm9pZCBpOTE1X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoQktMKHJlZikpOwotCV9fYWN0aXZlX3JldGlyZShyZWYpOworCWFj
dGl2ZV9yZXRpcmUocmVmKTsKIH0KIAogaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47Ci0JaW50IHJldCA9
IDA7CisJaW50IGVycjsKIAotCWlmIChpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZikpCi0JCWdvdG8g
b3V0X3JlbGVhc2U7CisJbWlnaHRfc2xlZXAoKTsKKwlpZiAoUkJfRU1QVFlfUk9PVCgmcmVmLT50
cmVlKSkKKwkJcmV0dXJuIDA7CiAKLQlyZXQgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSgm
cmVmLT5sYXN0LCBCS0wocmVmKSk7Ci0JaWYgKHJldCkKLQkJZ290byBvdXRfcmVsZWFzZTsKKwll
cnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnJlZi0+bXV0ZXgpOworCWlmIChlcnIpCisJ
CXJldHVybiBlcnI7CisKKwlpZiAoIWF0b21pY19hZGRfdW5sZXNzKCZyZWYtPmNvdW50LCAxLCAw
KSkKKwkJZ290byB1bmxvY2s7CiAKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUoaXQsIG4sICZyZWYtPnRyZWUsIG5vZGUpIHsKLQkJcmV0ID0gaTkxNV9hY3RpdmVfcmVxdWVz
dF9yZXRpcmUoJml0LT5iYXNlLCBCS0wocmVmKSk7Ci0JCWlmIChyZXQpCisJCWVyciA9IGk5MTVf
YWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZpdC0+YmFzZSwgQktMKHJlZikpOworCQlpZiAoZXJyKQog
CQkJYnJlYWs7CiAJfQogCi1vdXRfcmVsZWFzZToKLQlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7
Ci0JcmV0dXJuIHJldDsKKwlhY3RpdmVfcmV0aXJlKHJlZik7Cit1bmxvY2s6CisJbXV0ZXhfdW5s
b2NrKCZyZWYtPm11dGV4KTsKKwlyZXR1cm4gZXJyOwogfQogCiBpbnQgaTkxNV9yZXF1ZXN0X2F3
YWl0X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLApAQCAtMjM0LDIzICsy
MzUsMjQgQEAgaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwKIGludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlzdHJ1Y3QgYWN0aXZl
X25vZGUgKml0LCAqbjsKLQlpbnQgZXJyID0gMDsKKwlpbnQgZXJyOwogCi0JLyogYXdhaXQgYWxs
b2NhdGVzIGFuZCBzbyB3ZSBuZWVkIHRvIGF2b2lkIGhpdHRpbmcgdGhlIHNocmlua2VyICovCi0J
aWYgKGk5MTVfYWN0aXZlX2FjcXVpcmUocmVmKSkKLQkJZ290byBvdXQ7IC8qIHdhcyBpZGxlICov
CisJaWYgKFJCX0VNUFRZX1JPT1QoJnJlZi0+dHJlZSkpCisJCXJldHVybiAwOwogCi0JZXJyID0g
aTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHJxLCAmcmVmLT5sYXN0KTsKKwkvKiBh
d2FpdCBhbGxvY2F0ZXMgYW5kIHNvIHdlIG5lZWQgdG8gYXZvaWQgaGl0dGluZyB0aGUgc2hyaW5r
ZXIgKi8KKwllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7CiAJaWYgKGVycikKLQkJZ290
byBvdXQ7CisJCXJldHVybiBlcnI7CiAKKwltdXRleF9sb2NrKCZyZWYtPm11dGV4KTsKIAlyYnRy
ZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRyZWUsIG5vZGUp
IHsKIAkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHJxLCAmaXQtPmJh
c2UpOwogCQlpZiAoZXJyKQotCQkJZ290byBvdXQ7CisJCQlicmVhazsKIAl9CisJbXV0ZXhfdW5s
b2NrKCZyZWYtPm11dGV4KTsKIAotb3V0OgogCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKIAly
ZXR1cm4gZXJyOwogfQpAQCAtMjU4LDkgKzI2MCw5IEBAIGludCBpOTE1X3JlcXVlc3RfYXdhaXRf
YWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikK
ICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pCiB2b2lkIGk5MTVfYWN0
aXZlX2Zpbmkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7Ci0JR0VNX0JVR19PTihpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X2lzc2V0KCZyZWYtPmxhc3QpKTsKIAlHRU1fQlVHX09OKCFSQl9FTVBUWV9S
T09UKCZyZWYtPnRyZWUpKTsKLQlHRU1fQlVHX09OKHJlZi0+Y291bnQpOworCUdFTV9CVUdfT04o
YXRvbWljX3JlYWQoJnJlZi0+Y291bnQpKTsKKwltdXRleF9kZXN0cm95KCZyZWYtPm11dGV4KTsK
IH0KICNlbmRpZgogCkBAIC0yODYsNyArMjg4LDcgQEAgaW50IGk5MTVfYWN0aXZlX2FjcXVpcmVf
cHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCQkJICh2b2lk
ICopZW5naW5lLCBub2RlX3JldGlyZSk7CiAJCW5vZGUtPnRpbWVsaW5lID0ga2N0eC0+cmluZy0+
dGltZWxpbmUtPmZlbmNlX2NvbnRleHQ7CiAJCW5vZGUtPnJlZiA9IHJlZjsKLQkJcmVmLT5jb3Vu
dCsrOworCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKIAogCQlsbGlzdF9hZGQoKHN0cnVjdCBs
bGlzdF9ub2RlICopJm5vZGUtPmJhc2UubGluaywKIAkJCSAgJnJlZi0+YmFycmllcnMpOwpAQCAt
Mjk5LDggKzMwMSw5IEBAIHZvaWQgaTkxNV9hY3RpdmVfYWNxdWlyZV9iYXJyaWVyKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmKQogewogCXN0cnVjdCBsbGlzdF9ub2RlICpwb3MsICpuZXh0OwogCi0J
aTkxNV9hY3RpdmVfYWNxdWlyZShyZWYpOworCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRs
ZShyZWYpKTsKIAorCW11dGV4X2xvY2tfbmVzdGVkKCZyZWYtPm11dGV4LCBTSU5HTEVfREVQVEhf
TkVTVElORyk7CiAJbGxpc3RfZm9yX2VhY2hfc2FmZShwb3MsIG5leHQsIGxsaXN0X2RlbF9hbGwo
JnJlZi0+YmFycmllcnMpKSB7CiAJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAkJ
c3RydWN0IGFjdGl2ZV9ub2RlICpub2RlOwpAQCAtMzI5LDcgKzMzMiw3IEBAIHZvaWQgaTkxNV9h
Y3RpdmVfYWNxdWlyZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogCQlsbGlzdF9h
ZGQoKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UubGluaywKIAkJCSAgJmVuZ2luZS0+
YmFycmllcl90YXNrcyk7CiAJfQotCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKKwltdXRleF91
bmxvY2soJnJlZi0+bXV0ZXgpOwogfQogCiB2b2lkIGk5MTVfcmVxdWVzdF9hZGRfYmFycmllcnMo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAppbmRl
eCBjMTRlZWJmNmQwNzQuLjEzNDE2NmQzMTI1MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2
ZS5oCkBAIC0zNjksOSArMzY5LDE2IEBAIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKHN0cnVj
dCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAgKiBzeW5jaHJvbmlzYXRpb24uCiAgKi8K
IAotdm9pZCBpOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAot
CQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKLQkJICAgICAgdm9pZCAoKnJldGlyZSko
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpKTsKK3ZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCisJ
CQlpbnQgKCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKKwkJCXZvaWQgKCpyZXRp
cmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKKwkJCXN0cnVjdCBsb2NrX2NsYXNzX2tleSAq
a2V5KTsKKyNkZWZpbmUgaTkxNV9hY3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwgcmV0aXJl
KSBkbyB7CQlcCisJc3RhdGljIHN0cnVjdCBsb2NrX2NsYXNzX2tleSBfX2tleTsJCQkJXAorCQkJ
CQkJCQkJXAorCV9faTkxNV9hY3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwgcmV0aXJlLCAm
X19rZXkpOwkJXAorfSB3aGlsZSAoMCkKIAogaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZiwKIAkJICAgIHU2NCB0aW1lbGluZSwKQEAgLTM4NCwyMCArMzkxLDE0IEBA
IGludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAog
aW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSwKIAkJCQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKTsKIAot
Ym9vbCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKLQotc3Rh
dGljIGlubGluZSB2b2lkIGk5MTVfYWN0aXZlX2NhbmNlbChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZikKLXsKLQlHRU1fQlVHX09OKHJlZi0+Y291bnQgIT0gMSk7Ci0JcmVmLT5jb3VudCA9IDA7Ci19
Ci0KK2ludCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIHZv
aWQgaTkxNV9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Cit2b2lkIF9f
aTkxNV9hY3RpdmVfcmVsZWFzZV9uZXN0ZWQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIGludCBz
dWJjbGFzcyk7CiAKIHN0YXRpYyBpbmxpbmUgYm9vbAogaTkxNV9hY3RpdmVfaXNfaWRsZShjb25z
dCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKLQlyZXR1cm4gIXJlZi0+Y291bnQ7CisJcmV0
dXJuICFhdG9taWNfcmVhZCgmcmVmLT5jb3VudCk7CiB9CiAKICNpZiBJU19FTkFCTEVEKENPTkZJ
R19EUk1fSTkxNV9ERUJVR19HRU0pCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlw
ZXMuaAppbmRleCBjMDI1OTkxYjkyMzMuLjViMGEzMDI0Y2UyNCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCkBAIC03LDcgKzcsOSBAQAogI2lmbmRlZiBfSTkxNV9B
Q1RJVkVfVFlQRVNfSF8KICNkZWZpbmUgX0k5MTVfQUNUSVZFX1RZUEVTX0hfCiAKKyNpbmNsdWRl
IDxsaW51eC9hdG9taWMuaD4KICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgorI2luY2x1ZGUgPGxp
bnV4L211dGV4Lmg+CiAjaW5jbHVkZSA8bGludXgvcmJ0cmVlLmg+CiAjaW5jbHVkZSA8bGludXgv
cmN1cGRhdGUuaD4KIApAQCAtMjQsMTMgKzI2LDE3IEBAIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0IHsKIAlpOTE1X2FjdGl2ZV9yZXRpcmVfZm4gcmV0aXJlOwogfTsKIAorc3RydWN0IGFjdGl2
ZV9ub2RlOworCiBzdHJ1Y3QgaTkxNV9hY3RpdmUgewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1OwogCisJc3RydWN0IGFjdGl2ZV9ub2RlICpjYWNoZTsKIAlzdHJ1Y3QgcmJfcm9vdCB0
cmVlOwotCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGxhc3Q7Ci0JdW5zaWduZWQgaW50IGNv
dW50OworCXN0cnVjdCBtdXRleCBtdXRleDsKKwlhdG9taWNfdCBjb3VudDsKIAorCWludCAoKmFj
dGl2ZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwogCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmKTsKIAogCXN0cnVjdCBsbGlzdF9oZWFkIGJhcnJpZXJzOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCA3Y2MyMGNhZmJlMWUuLjE3YzczMmQzZDUyMyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTIwNzMsNyArMjA3Myw3IEBAIHN0
YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnBkX3ZtYV9jcmVhdGUoc3RydWN0IGdlbjZfcHBndHQgKnBw
Z3R0LCBpbnQgc2l6ZSkKIAlpZiAoIXZtYSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAK
LQlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZ2bWEtPmFjdGl2ZSwgTlVMTCk7CisJaTkxNV9hY3Rp
dmVfaW5pdChpOTE1LCAmdm1hLT5hY3RpdmUsIE5VTEwsIE5VTEwpOwogCUlOSVRfQUNUSVZFX1JF
UVVFU1QoJnZtYS0+bGFzdF9mZW5jZSk7CiAKIAl2bWEtPnZtID0gJmdndHQtPnZtOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jCmluZGV4IGMzMTFjZTljNmY5ZC4uZTJmOTMzNmJhYjgz
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jCkBAIC0xNDgsNiArMTQ4LDE1IEBA
IHN0YXRpYyB2b2lkIF9fY2FjaGVsaW5lX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKmFjdGl2
ZSkKIAkJX19pZGxlX2NhY2hlbGluZV9mcmVlKGNsKTsKIH0KIAorc3RhdGljIGludCBfX2NhY2hl
bGluZV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCit7CisJc3RydWN0IGk5MTVf
dGltZWxpbmVfY2FjaGVsaW5lICpjbCA9CisJCWNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigq
Y2wpLCBhY3RpdmUpOworCisJX19pOTE1X3ZtYV9waW4oY2wtPmh3c3AtPnZtYSk7CisJcmV0dXJu
IDA7Cit9CisKIHN0YXRpYyBzdHJ1Y3QgaTkxNV90aW1lbGluZV9jYWNoZWxpbmUgKgogY2FjaGVs
aW5lX2FsbG9jKHN0cnVjdCBpOTE1X3RpbWVsaW5lX2h3c3AgKmh3c3AsIHVuc2lnbmVkIGludCBj
YWNoZWxpbmUpCiB7CkBAIC0xNzAsMTUgKzE3OSwxNiBAQCBjYWNoZWxpbmVfYWxsb2Moc3RydWN0
IGk5MTVfdGltZWxpbmVfaHdzcCAqaHdzcCwgdW5zaWduZWQgaW50IGNhY2hlbGluZSkKIAljbC0+
aHdzcCA9IGh3c3A7CiAJY2wtPnZhZGRyID0gcGFnZV9wYWNrX2JpdHModmFkZHIsIGNhY2hlbGlu
ZSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGh3c3BfdG9faTkxNShod3NwKSwgJmNsLT5hY3RpdmUs
IF9fY2FjaGVsaW5lX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdChod3NwX3RvX2k5MTUoaHdz
cCksICZjbC0+YWN0aXZlLAorCQkJIF9fY2FjaGVsaW5lX2FjdGl2ZSwgX19jYWNoZWxpbmVfcmV0
aXJlKTsKIAogCXJldHVybiBjbDsKIH0KIAogc3RhdGljIHZvaWQgY2FjaGVsaW5lX2FjcXVpcmUo
c3RydWN0IGk5MTVfdGltZWxpbmVfY2FjaGVsaW5lICpjbCkKIHsKLQlpZiAoY2wgJiYgaTkxNV9h
Y3RpdmVfYWNxdWlyZSgmY2wtPmFjdGl2ZSkpCi0JCV9faTkxNV92bWFfcGluKGNsLT5od3NwLT52
bWEpOworCWlmIChjbCkKKwkJaTkxNV9hY3RpdmVfYWNxdWlyZSgmY2wtPmFjdGl2ZSk7CiB9CiAK
IHN0YXRpYyB2b2lkIGNhY2hlbGluZV9yZWxlYXNlKHN0cnVjdCBpOTE1X3RpbWVsaW5lX2NhY2hl
bGluZSAqY2wpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCBkODJmNGVjMzA1YmMuLmMxYjQ4
MTNjNWY4NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC03NywxMSArNzcsMjAgQEAgc3Rh
dGljIHZvaWQgdm1hX3ByaW50X2FsbG9jYXRvcihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgY29uc3Qg
Y2hhciAqcmVhc29uKQogCiAjZW5kaWYKIAotc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9yZXRpcmUo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCitzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3ZtYSAq
YWN0aXZlX3RvX3ZtYShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKLQlzdHJ1Y3QgaTkxNV92
bWEgKnZtYSA9IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqdm1hKSwgYWN0aXZlKTsKKwlyZXR1
cm4gY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKHN0cnVjdCBpOTE1X3ZtYSksIGFjdGl2ZSk7Cit9
CiAKLQlpOTE1X3ZtYV9wdXQodm1hKTsKK3N0YXRpYyBpbnQgX19pOTE1X3ZtYV9hY3RpdmUoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJaTkxNV92bWFfZ2V0KGFjdGl2ZV90b192bWEocmVm
KSk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIF9faTkxNV92bWFfcmV0aXJlKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKQoreworCWk5MTVfdm1hX3B1dChhY3RpdmVfdG9fdm1hKHJlZikp
OwogfQogCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKQEAgLTEwNiw3ICsxMTUsOCBAQCB2bWFf
Y3JlYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm1hLT5zaXplID0gb2Jq
LT5iYXNlLnNpemU7CiAJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5MTVfR1RUX01JTl9BTElH
Tk1FTlQ7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KHZtLT5pOTE1LCAmdm1hLT5hY3RpdmUsIF9faTkx
NV92bWFfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KHZtLT5pOTE1LCAmdm1hLT5hY3RpdmUs
CisJCQkgX19pOTE1X3ZtYV9hY3RpdmUsIF9faTkxNV92bWFfcmV0aXJlKTsKIAlJTklUX0FDVElW
RV9SRVFVRVNUKCZ2bWEtPmxhc3RfZmVuY2UpOwogCiAJSU5JVF9MSVNUX0hFQUQoJnZtYS0+Y2xv
c2VkX2xpbmspOwpAQCAtOTAzLDExICs5MTMsNyBAQCBpbnQgaTkxNV92bWFfbW92ZV90b19hY3Rp
dmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJICogYWRkIHRoZSBhY3RpdmUgcmVmZXJlbmNlIGZp
cnN0IGFuZCBxdWV1ZSBmb3IgaXQgdG8gYmUgZHJvcHBlZAogCSAqICpsYXN0Ki4KIAkgKi8KLQlp
ZiAoaTkxNV9hY3RpdmVfYWNxdWlyZSgmdm1hLT5hY3RpdmUpKQotCQlpOTE1X3ZtYV9nZXQodm1h
KTsKLQogCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUsIHJxLT5mZW5jZS5jb250
ZXh0LCBycSk7Ci0JaTkxNV9hY3RpdmVfcmVsZWFzZSgmdm1hLT5hY3RpdmUpOwogCWlmICh1bmxp
a2VseShlcnIpKQogCQlyZXR1cm4gZXJyOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2FjdGl2ZS5jCmluZGV4IGMwYjM1MzdhNWZhNi4uYjVjYzAwMzU1NGVmIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwpAQCAtMzYsMTQg
KzM2LDEyIEBAIHN0YXRpYyBpbnQgX19saXZlX2FjdGl2ZV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAlpZiAoIXN1Ym1pdCkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpOTE1
X2FjdGl2ZV9pbml0KGk5MTUsICZhY3RpdmUtPmJhc2UsIF9fbGl2ZV9hY3RpdmVfcmV0aXJlKTsK
KwlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZhY3RpdmUtPmJhc2UsIE5VTEwsIF9fbGl2ZV9hY3Rp
dmVfcmV0aXJlKTsKIAlhY3RpdmUtPnJldGlyZWQgPSBmYWxzZTsKIAotCWlmICghaTkxNV9hY3Rp
dmVfYWNxdWlyZSgmYWN0aXZlLT5iYXNlKSkgewotCQlwcl9lcnIoIkZpcnN0IGk5MTVfYWN0aXZl
X2FjcXVpcmUgc2hvdWxkIHJlcG9ydCBiZWluZyBpZGxlXG4iKTsKLQkJZXJyID0gLUVJTlZBTDsK
KwllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZhY3RpdmUtPmJhc2UpOworCWlmIChlcnIpCiAJ
CWdvdG8gb3V0OwotCX0KIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJ
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtNzQsOSArNzIsOSBAQCBzdGF0aWMgaW50IF9f
bGl2ZV9hY3RpdmVfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCXByX2Vy
cigiaTkxNV9hY3RpdmUgcmV0aXJlZCBiZWZvcmUgc3VibWlzc2lvbiFcbiIpOwogCQllcnIgPSAt
RUlOVkFMOwogCX0KLQlpZiAoYWN0aXZlLT5iYXNlLmNvdW50ICE9IGNvdW50KSB7CisJaWYgKGF0
b21pY19yZWFkKCZhY3RpdmUtPmJhc2UuY291bnQpICE9IGNvdW50KSB7CiAJCXByX2VycigiaTkx
NV9hY3RpdmUgbm90IHRyYWNraW5nIGFsbCByZXF1ZXN0cywgZm91bmQgJWQsIGV4cGVjdGVkICVk
XG4iLAotCQkgICAgICAgYWN0aXZlLT5iYXNlLmNvdW50LCBjb3VudCk7CisJCSAgICAgICBhdG9t
aWNfcmVhZCgmYWN0aXZlLT5iYXNlLmNvdW50KSwgY291bnQpOwogCQllcnIgPSAtRUlOVkFMOwog
CX0KIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E43C2BBC88
	for <lists+intel-gfx@lfdr.de>; Mon, 23 Sep 2019 21:55:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1E2F36E99C;
	Mon, 23 Sep 2019 19:55:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7AD6E6E875
 for <intel-gfx@lists.freedesktop.org>; Mon, 23 Sep 2019 19:55:16 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 23 Sep 2019 12:55:15 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,541,1559545200"; d="scan'208";a="179238329"
Received: from josouza-mobl.jf.intel.com ([10.7.200.160])
 by orsmga007.jf.intel.com with ESMTP; 23 Sep 2019 12:55:14 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 23 Sep 2019 12:55:08 -0700
Message-Id: <20190923195513.207536-5-jose.souza@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190923195513.207536-1-jose.souza@intel.com>
References: <20190923195513.207536-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 4/9] drm/i915/tgl: Add dkl phy programming
 sequences
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogQ2xpbnRvbiBBIFRheWxvciA8Y2xpbnRvbi5hLnRheWxvckBpbnRlbC5jb20+CgpBZGRl
ZCBES0wgUGh5IHNlcXVlbmNlcyBhbmQgaGVscGVycyBmdW5jdGlvbnMgdG8gcHJvZ3JhbSB2b2x0
YWdlCnN3aW5nLCBjbG9jayBnYXRpbmcgYW5kIGRwIG1vZGUuCgpJdCBpcyBub3Qgd3JpdHRlbiBp
biBEUCBlbmFibGluZyBzZXF1ZW5jZSBidXQgIlBIWSBDbG9ja2dhdGluZwpwcm9ncmFtbWluZyIg
c3RhdGVzIHRoYXQgY2xvY2sgZ2F0aW5nIHNob3VsZCBiZSBlbmFibGVkIGFmdGVyIHRoZQpsaW5r
IHRyYWluaW5nIGJ1dCBkb2luZyBzbyBjYXVzZXMgYWxsIHRoZSBmb2xsb3dpbmcgdHJhaW5pbmdz
IHRvIGZhaWwKc28gbm90IGVuYWJsaW5nIGl0IGZvci4KCnYyOgpTZXR0aW5nIHRoZSByaWdodCBI
SVBfSU5ERVhfUkVHIGJpdHMgKEpvc8OpKQoKdjM6CkFkZGluZyB0aGUgbWVhbmluZyBvZiBlYWNo
IGNvbHVtbiBvZiB0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zCkFkZGluZyBpZiBnZW4gPj0g
MTIgb24gaW50ZWxfZGRpX2hkbWlfbGV2ZWwoKSBhbmQKaW50ZWxfZGRpX3ByZV9lbmFibGVfaGRt
aSgpIGluc3RlYWQgb2YgcmV1c2UgcGFydCBvZiBnZW4gPj0gMTEgaWYKCkJTcGVjOiA0OTI5MgpC
U3BlYzogNDkxOTAKClNpZ25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uu
c291emFAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBDbGludG9uIEEgVGF5bG9yIDxjbGludG9u
LmEudGF5bG9yQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RkaS5jIHwgMjQ5ICsrKysrKysrKysrKysrKysrKysrKystCiAxIGZpbGUgY2hhbmdlZCwg
MjQwIGluc2VydGlvbnMoKyksIDkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGRpLmMKaW5kZXggMzNjZDc2NmY5ZWVhLi4xYWIzZTBjNGMwYTEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtNTg2LDYgKzU4NiwyNiBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IGljbF9tZ19waHlfZGRpX2J1Zl90cmFucyBpY2xfbWdfcGh5
X2RkaV90cmFuc2xhdGlvbnNbXSA9IHsKIAl7IDB4MCwgMHgwMCwgMHgwMCB9LAkvKiAzICAgICAg
ICAgICAgICAwICAgKi8KIH07CiAKK3N0cnVjdCB0Z2xfZGtsX3BoeV9kZGlfYnVmX3RyYW5zIHsK
Kwl1MzIgZGtsX3Zzd2luZ19jb250cm9sOworCXUzMiBka2xfcHJlc2hvb3RfY29udHJvbDsKKwl1
MzIgZGtsX2RlX2VtcGhhc2lzX2NvbnRyb2w7Cit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IHRn
bF9ka2xfcGh5X2RkaV9idWZfdHJhbnMgdGdsX2RrbF9waHlfZGRpX3RyYW5zbGF0aW9uc1tdID0g
eworCQkJCS8qIFZTCXByZS1lbXAJTm9uLXRyYW5zIG1WCVByZS1lbXBoIGRCICovCisJeyAweDcs
IDB4MCwgMHgwMCB9LAkvKiAwCTAJNDAwbVYJCTAgZEIgKi8KKwl7IDB4NSwgMHgwLCAweDAzIH0s
CS8qIDAJMQk0MDBtVgkJMy41IGRCICovCisJeyAweDIsIDB4MCwgMHgwYiB9LAkvKiAwCTIJNDAw
bVYJCTYgZEIgKi8KKwl7IDB4MCwgMHgwLCAweDE5IH0sCS8qIDAJMwk0MDBtVgkJOS41IGRCICov
CisJeyAweDUsIDB4MCwgMHgwMCB9LAkvKiAxCTAJNjAwbVYJCTAgZEIgKi8KKwl7IDB4MiwgMHgw
LCAweDAzIH0sCS8qIDEJMQk2MDBtVgkJMy41IGRCICovCisJeyAweDAsIDB4MCwgMHgxNCB9LAkv
KiAxCTIJNjAwbVYJCTYgZEIgKi8KKwl7IDB4MiwgMHgwLCAweDAwIH0sCS8qIDIJMAk4MDBtVgkJ
MCBkQiAqLworCXsgMHgwLCAweDAsIDB4MEIgfSwJLyogMgkxCTgwMG1WCQkzLjUgZEIgKi8KKwl7
IDB4MCwgMHgwLCAweDAwIH0sCS8qIDMJMAkxMjAwbVYJCTAgZEIgSERNSSBkZWZhdWx0ICovCit9
OworCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRkaV9idWZfdHJhbnMgKgogYmR3X2dldF9idWZfdHJh
bnNfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50ICpuX2VudHJpZXMp
CiB7CkBAIC04NzIsNyArODkyLDE0IEBAIHN0YXRpYyBpbnQgaW50ZWxfZGRpX2hkbWlfbGV2ZWwo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9yCiAKIAlsZXZl
bCA9IGRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XS5oZG1pX2xldmVsX3NoaWZ0Owog
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMikgeworCQlpZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQor
CQkJaWNsX2dldF9jb21ib19idWZfdHJhbnMoZGV2X3ByaXYsIElOVEVMX09VVFBVVF9IRE1JLAor
CQkJCQkJMCwgJm5fZW50cmllcyk7CisJCWVsc2UKKwkJCW5fZW50cmllcyA9IEFSUkFZX1NJWkUo
dGdsX2RrbF9waHlfZGRpX3RyYW5zbGF0aW9ucyk7CisJCWRlZmF1bHRfZW50cnkgPSBuX2VudHJp
ZXMgLSAxOworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA9PSAxMSkgewogCQlpZiAo
aW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQogCQkJaWNsX2dldF9jb21ib19idWZf
dHJhbnMoZGV2X3ByaXYsIElOVEVMX09VVFBVVF9IRE1JLAogCQkJCQkJMCwgJm5fZW50cmllcyk7
CkBAIC0yMzEzLDcgKzIzNDAsMTMgQEAgdTggaW50ZWxfZGRpX2RwX3ZvbHRhZ2VfbWF4KHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9f
cGh5KGRldl9wcml2LCBwb3J0KTsKIAlpbnQgbl9lbnRyaWVzOwogCi0JaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTEpIHsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgeworCQlp
ZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQorCQkJaWNsX2dldF9jb21ib19i
dWZfdHJhbnMoZGV2X3ByaXYsIGVuY29kZXItPnR5cGUsCisJCQkJCQlpbnRlbF9kcC0+bGlua19y
YXRlLCAmbl9lbnRyaWVzKTsKKwkJZWxzZQorCQkJbl9lbnRyaWVzID0gQVJSQVlfU0laRSh0Z2xf
ZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zKTsKKwl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPT0gMTEpIHsKIAkJaWYgKGludGVsX3BoeV9pc19jb21ibyhkZXZfcHJpdiwgcGh5KSkKIAkJ
CWljbF9nZXRfY29tYm9fYnVmX3RyYW5zKGRldl9wcml2LCBlbmNvZGVyLT50eXBlLAogCQkJCQkJ
aW50ZWxfZHAtPmxpbmtfcmF0ZSwgJm5fZW50cmllcyk7CkBAIC0yNzU1LDYgKzI3ODgsNjYgQEAg
c3RhdGljIHZvaWQgaWNsX2RkaV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCWljbF9tZ19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsaW5r
X2Nsb2NrLCBsZXZlbCk7CiB9CiAKK3N0YXRpYyB2b2lkCit0Z2xfZGtsX3BoeV9kZGlfdnN3aW5n
X3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgbGlua19jbG9jaywK
KwkJCQl1MzIgbGV2ZWwpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRl
bF9wb3J0X3RvX3RjKGRldl9wcml2LCBlbmNvZGVyLT5wb3J0KTsKKwljb25zdCBzdHJ1Y3QgdGds
X2RrbF9waHlfZGRpX2J1Zl90cmFucyAqZGRpX3RyYW5zbGF0aW9uczsKKwl1MzIgbl9lbnRyaWVz
LCB2YWwsIGxuOworCisJbl9lbnRyaWVzID0gQVJSQVlfU0laRSh0Z2xfZGtsX3BoeV9kZGlfdHJh
bnNsYXRpb25zKTsKKwlkZGlfdHJhbnNsYXRpb25zID0gdGdsX2RrbF9waHlfZGRpX3RyYW5zbGF0
aW9uczsKKworCWlmIChsZXZlbCA+PSBuX2VudHJpZXMpCisJCWxldmVsID0gbl9lbnRyaWVzIC0g
MTsKKworCS8qCisJICogQWxsIHJlZ2lzdGVycyBwcm9ncmFtbWVkIGhlcmUgdXNlIEhJUF9JTkRF
WF9SRUcgMCBvciAxCisJICovCisJZm9yIChsbiA9IDA7IGxuIDwgMjsgbG4rKykgeworCQlJOTE1
X1dSSVRFKEhJUF9JTkRFWF9SRUcodGNfcG9ydCksIEhJUF9JTkRFWF9WQUwodGNfcG9ydCwgbG4p
KTsKKworCQkvKiBBbGwgdGhlIHJlZ2lzdGVycyBhcmUgUk1XICovCisJCXZhbCA9IEk5MTVfUkVB
RChES0xfVFhfRFBDTlRMMCh0Y19wb3J0KSk7CisJCXZhbCAmPSB+KERLTF9UWF9QUkVTSE9PVF9D
T0VGRl9NQVNLIHwKKwkJCSBES0xfVFhfREVfRU1QQUhTSVNfQ09FRkZfTUFTSyB8CisJCQkgREtM
X1RYX1ZTV0lOR19DT05UUk9MX01BU0spOworCQl2YWwgfD0gREtMX1RYX1ZTV0lOR19DT05UUk9M
KGRkaV90cmFuc2xhdGlvbnNbbGV2ZWxdLmRrbF92c3dpbmdfY29udHJvbCk7CisJCXZhbCB8PSBE
S0xfVFhfREVfRU1QSEFTSVNfQ09FRkYoZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0uZGtsX2RlX2Vt
cGhhc2lzX2NvbnRyb2wpOworCQl2YWwgfD0gREtMX1RYX1BSRVNIT09UX0NPRUZGKGRkaV90cmFu
c2xhdGlvbnNbbGV2ZWxdLmRrbF9wcmVzaG9vdF9jb250cm9sKTsKKwkJSTkxNV9XUklURShES0xf
VFhfRFBDTlRMMCh0Y19wb3J0KSwgdmFsKTsKKworCQl2YWwgPSBJOTE1X1JFQUQoREtMX1RYX0RQ
Q05UTDEodGNfcG9ydCkpOworCQl2YWwgJj0gfihES0xfVFhfUFJFU0hPT1RfQ09FRkZfTUFTSyB8
CisJCQkgREtMX1RYX0RFX0VNUEFIU0lTX0NPRUZGX01BU0sgfAorCQkJIERLTF9UWF9WU1dJTkdf
Q09OVFJPTF9NQVNLKTsKKwkJdmFsIHw9IERLTF9UWF9WU1dJTkdfQ09OVFJPTChkZGlfdHJhbnNs
YXRpb25zW2xldmVsXS5ka2xfdnN3aW5nX2NvbnRyb2wpOworCQl2YWwgfD0gREtMX1RYX0RFX0VN
UEhBU0lTX0NPRUZGKGRkaV90cmFuc2xhdGlvbnNbbGV2ZWxdLmRrbF9kZV9lbXBoYXNpc19jb250
cm9sKTsKKwkJdmFsIHw9IERLTF9UWF9QUkVTSE9PVF9DT0VGRihkZGlfdHJhbnNsYXRpb25zW2xl
dmVsXS5ka2xfcHJlc2hvb3RfY29udHJvbCk7CisJCUk5MTVfV1JJVEUoREtMX1RYX0RQQ05UTDEo
dGNfcG9ydCksIHZhbCk7CisKKwkJdmFsID0gSTkxNV9SRUFEKERLTF9UWF9EUENOVEwyKHRjX3Bv
cnQpKTsKKwkJdmFsICY9IH5ES0xfVFhfRFAyMEJJVE1PREU7CisJCUk5MTVfV1JJVEUoREtMX1RY
X0RQQ05UTDIodGNfcG9ydCksIHZhbCk7CisJfQorfQorCitzdGF0aWMgdm9pZCB0Z2xfZGRpX3Zz
d2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgICAgaW50
IGxpbmtfY2xvY2ssCisJCQkJICAgIHUzMiBsZXZlbCwKKwkJCQkgICAgZW51bSBpbnRlbF9vdXRw
dXRfdHlwZSB0eXBlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9f
cGh5KGRldl9wcml2LCBlbmNvZGVyLT5wb3J0KTsKKworCWlmIChpbnRlbF9waHlfaXNfY29tYm8o
ZGV2X3ByaXYsIHBoeSkpCisJCWljbF9jb21ib19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNv
ZGVyLCBsZXZlbCwgdHlwZSk7CisJZWxzZQorCQl0Z2xfZGtsX3BoeV9kZGlfdnN3aW5nX3NlcXVl
bmNlKGVuY29kZXIsIGxpbmtfY2xvY2ssIGxldmVsKTsKK30KKwogc3RhdGljIHUzMiB0cmFuc2xh
dGVfc2lnbmFsX2xldmVsKGludCBzaWduYWxfbGV2ZWxzKQogewogCWludCBpOwpAQCAtMjc4Niw3
ICsyODc5LDEwIEBAIHUzMiBieHRfc2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0gJmRwb3J0LT5iYXNlOwogCWlu
dCBsZXZlbCA9IGludGVsX2RkaV9kcF9sZXZlbChpbnRlbF9kcCk7CiAKLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMSkKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJdGds
X2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgaW50ZWxfZHAtPmxpbmtfcmF0ZSwKKwkJCQkJ
bGV2ZWwsIGVuY29kZXItPnR5cGUpOworCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTEpCiAJCWljbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGludGVsX2RwLT5saW5rX3Jh
dGUsCiAJCQkJCWxldmVsLCBlbmNvZGVyLT50eXBlKTsKIAllbHNlIGlmIChJU19DQU5OT05MQUtF
KGRldl9wcml2KSkKQEAgLTMwMzMsNiArMzEyOSwzNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlf
Y2xrX2Rpc2FibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJfQogfQogCitzdGF0
aWMgdm9pZAordGdsX3BoeV9zZXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3Bv
cnQgKmRpZ19wb3J0LCBib29sIGVuYWJsZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKKwllbnVtIHBvcnQg
cG9ydCA9IGRpZ19wb3J0LT5iYXNlLnBvcnQ7CisJZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRl
bF9wb3J0X3RvX3RjKGRldl9wcml2LCBwb3J0KTsKKwl1MzIgdmFsLCBiaXRzOworCWludCBsbjsK
KworCWlmICh0Y19wb3J0ID09IFBPUlRfVENfTk9ORSkKKwkJcmV0dXJuOworCisJYml0cyA9IERL
TF9EUF9NT0RFX0NGR19UUjJQV1JfR0FUSU5HIHwgREtMX0RQX01PREVfQ0ZHX1RSUFdSX0dBVElO
RyB8CisJICAgICAgIERLTF9EUF9NT0RFX0NGR19DTE5QV1JfR0FUSU5HIHwgREtMX0RQX01PREVf
Q0ZHX0RJR1BXUl9HQVRJTkcgfAorCSAgICAgICBES0xfRFBfTU9ERV9DRkdfR0FPTlBXUl9HQVRJ
Tkc7CisKKwlmb3IgKGxuID0gMDsgbG4gPCAyOyBsbisrKSB7CisJCUk5MTVfV1JJVEUoSElQX0lO
REVYX1JFRyh0Y19wb3J0KSwgSElQX0lOREVYX1ZBTCh0Y19wb3J0LCBsbikpOworCisJCXZhbCA9
IEk5MTVfUkVBRChES0xfRFBfTU9ERSh0Y19wb3J0KSk7CisJCWlmIChlbmFibGUpCisJCQl2YWwg
fD0gYml0czsKKwkJZWxzZQorCQkJdmFsICY9IH5iaXRzOworCQlJOTE1X1dSSVRFKERLTF9EUF9N
T0RFKHRjX3BvcnQpLCB2YWwpOworCX0KK30KKwogc3RhdGljIHZvaWQKIGljbF9waHlfc2V0X2Ns
b2NrX2dhdGluZyhzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCwgYm9vbCBlbmFi
bGUpCiB7CkBAIC0zMTMyLDYgKzMyNTYsOTUgQEAgc3RhdGljIHZvaWQgaWNsX3Byb2dyYW1fbWdf
ZHBfbW9kZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCkKIAlJOTE1
X1dSSVRFKE1HX0RQX01PREUoMSwgcG9ydCksIGxuMSk7CiB9CiAKK3N0YXRpYyB2b2lkIHRnbF9w
cm9ncmFtX2RrbF9kcF9tb2RlKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19w
b3J0KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50
ZWxfZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOworCWVudW0gcG9ydCBwb3J0ID0gaW50ZWxfZGln
X3BvcnQtPmJhc2UucG9ydDsKKwllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVsX3BvcnRfdG9f
dGMoZGV2X3ByaXYsIHBvcnQpOworCXUzMiBsbjAsIGxuMSwgbGFuZV9tYXNrLCBwaW5fbWFzazsK
KwlpbnQgbnVtX2xhbmVzOworCisJaWYgKHRjX3BvcnQgPT0gUE9SVF9UQ19OT05FIHx8CisJICAg
IGludGVsX2RpZ19wb3J0LT50Y19tb2RlID09IFRDX1BPUlRfVEJUX0FMVCkKKwkJcmV0dXJuOwor
CisJSTkxNV9XUklURShISVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5ERVhfVkFMKHRjX3Bv
cnQsIDB4MCkpOworCWxuMCA9IEk5MTVfUkVBRChES0xfRFBfTU9ERSh0Y19wb3J0KSk7CisJSTkx
NV9XUklURShISVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5ERVhfVkFMKHRjX3BvcnQsIDB4
MSkpOworCWxuMSA9IEk5MTVfUkVBRChES0xfRFBfTU9ERSh0Y19wb3J0KSk7CisKKwludW1fbGFu
ZXMgPSBpbnRlbF9kaWdfcG9ydC0+ZHAubGFuZV9jb3VudDsKKworCXN3aXRjaCAoaW50ZWxfZGln
X3BvcnQtPnRjX21vZGUpIHsKKwljYXNlIFRDX1BPUlRfRFBfQUxUOgorCQlsbjAgJj0gfihES0xf
RFBfTU9ERV9DRkdfRFBfWDFfTU9ERSB8IERLTF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFKTsKKwkJ
bG4xICY9IH4oREtMX0RQX01PREVfQ0ZHX0RQX1gxX01PREUgfCBES0xfRFBfTU9ERV9DRkdfRFBf
WDJfTU9ERSk7CisKKwkJbGFuZV9tYXNrID0gaW50ZWxfdGNfcG9ydF9nZXRfbGFuZV9tYXNrKGlu
dGVsX2RpZ19wb3J0KTsgLyogRFBYNFRYTEFUQyAqLworCQlwaW5fbWFzayA9IGludGVsX3RjX3Bv
cnRfZ2V0X3Bpbl9hc3NpZ25tZW50X21hc2soaW50ZWxfZGlnX3BvcnQpOyAvKiBEUFBBVEMgKi8K
KworCQlzd2l0Y2ggKHBpbl9tYXNrKSB7CisJCWNhc2UgMHgwOgorCQkJaWYgKG51bV9sYW5lcyA9
PSAxKSB7CisJCQkJbG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFOworCQkJfSBlbHNl
IHsKKwkJCQlsbjAgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7CisJCQkJbG4xIHw9IERL
TF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQkJfQorCQkJYnJlYWs7CisJCWNhc2UgMHgxOgor
CQkJaWYgKG51bV9sYW5lcyA9PSA0KSB7CisJCQkJbG4wIHw9IERLTF9EUF9NT0RFX0NGR19EUF9Y
Ml9NT0RFOworCQkJCWxuMSB8PSBES0xfRFBfTU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJCX0KKwkJ
CWJyZWFrOworCQljYXNlIDB4MjoKKwkJCWlmIChudW1fbGFuZXMgPT0gMikgeworCQkJCWxuMCB8
PSBES0xfRFBfTU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJCQlsbjEgfD0gREtMX0RQX01PREVfQ0ZH
X0RQX1gyX01PREU7CisJCQl9CisJCQlicmVhazsKKwkJY2FzZSAweDM6CisJCWNhc2UgMHg1Ogor
CQkJaWYgKG51bV9sYW5lcyA9PSAxKSB7CisJCQkJbG4wIHw9IERLTF9EUF9NT0RFX0NGR19EUF9Y
MV9NT0RFOworCQkJCWxuMSB8PSBES0xfRFBfTU9ERV9DRkdfRFBfWDFfTU9ERTsKKwkJCX0gZWxz
ZSB7CisJCQkJbG4wIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQkJCWxuMSB8PSBE
S0xfRFBfTU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJCX0KKwkJCWJyZWFrOworCQljYXNlIDB4NDoK
KwkJY2FzZSAweDY6CisJCQlpZiAobnVtX2xhbmVzID09IDEpIHsKKwkJCQlsbjAgfD0gREtMX0RQ
X01PREVfQ0ZHX0RQX1gxX01PREU7CisJCQkJbG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMV9N
T0RFOworCQkJfSBlbHNlIHsKKwkJCQlsbjAgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7
CisJCQkJbG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQkJfQorCQkJYnJlYWs7
CisJCWRlZmF1bHQ6CisJCQlNSVNTSU5HX0NBU0UobGFuZV9tYXNrKTsKKwkJfQorCQlicmVhazsK
KworCWNhc2UgVENfUE9SVF9MRUdBQ1k6CisJCWxuMCB8PSBES0xfRFBfTU9ERV9DRkdfRFBfWDFf
TU9ERSB8IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQlsbjEgfD0gREtMX0RQX01PREVf
Q0ZHX0RQX1gxX01PREUgfCBES0xfRFBfTU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJYnJlYWs7CisK
KwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoaW50ZWxfZGlnX3BvcnQtPnRjX21vZGUpOworCQly
ZXR1cm47CisJfQorCisJSTkxNV9XUklURShISVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5E
RVhfVkFMKHRjX3BvcnQsIDB4MCkpOworCUk5MTVfV1JJVEUoREtMX0RQX01PREUodGNfcG9ydCks
IGxuMCk7CisJSTkxNV9XUklURShISVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5ERVhfVkFM
KHRjX3BvcnQsIDB4MSkpOworCUk5MTVfV1JJVEUoREtMX0RQX01PREUodGNfcG9ydCksIGxuMSk7
Cit9CisKIHN0YXRpYyB2b2lkIGludGVsX2RwX3Npbmtfc2V0X2ZlY19yZWFkeShzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAogCQkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKQEAgLTMyMTgsNyArMzQzMSw3IEBAIHN0YXRpYyB2b2lkIHRnbF9kZGlfcHJl
X2VuYWJsZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJZGlnX3BvcnQt
PmRkaV9pb19wb3dlcl9kb21haW4pOwogCiAJLyogNi4gKi8KLQlpY2xfcHJvZ3JhbV9tZ19kcF9t
b2RlKGRpZ19wb3J0KTsKKwl0Z2xfcHJvZ3JhbV9ka2xfZHBfbW9kZShkaWdfcG9ydCk7CiAKIAkv
KgogCSAqIDcuYSAtIFN0ZXBzIGluIHRoaXMgZnVuY3Rpb24gc2hvdWxkIG9ubHkgYmUgZXhlY3V0
ZWQgb3ZlciBNU1QKQEAgLTMyMzEsMTAgKzM0NDQsMTAgQEAgc3RhdGljIHZvaWQgdGdsX2RkaV9w
cmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWludGVsX2RkaV9j
b25maWdfdHJhbnNjb2Rlcl9mdW5jKGNydGNfc3RhdGUpOwogCiAJLyogNy5kICovCi0JaWNsX3Bo
eV9zZXRfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0LCBmYWxzZSk7CisJdGdsX3BoeV9zZXRfY2xvY2tf
Z2F0aW5nKGRpZ19wb3J0LCBmYWxzZSk7CiAKIAkvKiA3LmUgKi8KLQlpY2xfZGRpX3Zzd2luZ19z
ZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLCBsZXZlbCwKKwl0Z2xfZGRp
X3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLCBsZXZlbCwK
IAkJCQllbmNvZGVyLT50eXBlKTsKIAogCS8qIDcuZiAqLwpAQCAtMzI2Niw2ICszNDc5LDE1IEBA
IHN0YXRpYyB2b2lkIHRnbF9kZGlfcHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAkvKiA3LmsgKi8KIAlpbnRlbF9kcF9zdG9wX2xpbmtfdHJhaW4oaW50ZWxfZHAp
OwogCisJLyoKKwkgKiBUT0RPOiBlbmFibGUgY2xvY2sgZ2F0aW5nCisJICoKKwkgKiBJdCBpcyBu
b3Qgd3JpdHRlbiBpbiBEUCBlbmFibGluZyBzZXF1ZW5jZSBidXQgIlBIWSBDbG9ja2dhdGluZwor
CSAqIHByb2dyYW1taW5nIiBzdGF0ZXMgdGhhdCBjbG9jayBnYXRpbmcgc2hvdWxkIGJlIGVuYWJs
ZWQgYWZ0ZXIgdGhlCisJICogbGluayB0cmFpbmluZyBidXQgZG9pbmcgc28gY2F1c2VzIGFsbCB0
aGUgZm9sbG93aW5nIHRyYWluaW5ncyB0byBmYWlsCisJICogc28gbm90IGVuYWJsaW5nIGl0IGZv
ciBub3cuCisJICovCisKIAkvKiA3LmwgKi8KIAlpbnRlbF9kZGlfZW5hYmxlX2ZlYyhlbmNvZGVy
LCBjcnRjX3N0YXRlKTsKIAlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3RhdGUpOwpA
QCAtMzM3MSw5ICszNTkzLDE1IEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9wcmVfZW5hYmxlX2hk
bWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaW50ZWxfZGlzcGxheV9wb3dlcl9n
ZXQoZGV2X3ByaXYsIGRpZ19wb3J0LT5kZGlfaW9fcG93ZXJfZG9tYWluKTsKIAogCWljbF9wcm9n
cmFtX21nX2RwX21vZGUoZGlnX3BvcnQpOwotCWljbF9waHlfc2V0X2Nsb2NrX2dhdGluZyhkaWdf
cG9ydCwgZmFsc2UpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQl0Z2xfcGh5
X3NldF9jbG9ja19nYXRpbmcoZGlnX3BvcnQsIGZhbHNlKTsKKwllbHNlCisJCWljbF9waHlfc2V0
X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCwgZmFsc2UpOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTEpCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCXRnbF9kZGlfdnN3
aW5nX3NlcXVlbmNlKGVuY29kZXIsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCisJCQkJCWxldmVs
LCBJTlRFTF9PVVRQVVRfSERNSSk7CisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA9PSAx
MSkKIAkJaWNsX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZS0+cG9ydF9j
bG9jaywKIAkJCQkJbGV2ZWwsIElOVEVMX09VVFBVVF9IRE1JKTsKIAllbHNlIGlmIChJU19DQU5O
T05MQUtFKGRldl9wcml2KSkKQEAgLTMzODMsNyArMzYxMSwxMCBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9kZGlfcHJlX2VuYWJsZV9oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWVs
c2UKIAkJaW50ZWxfcHJlcGFyZV9oZG1pX2RkaV9idWZmZXJzKGVuY29kZXIsIGxldmVsKTsKIAot
CWljbF9waHlfc2V0X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCwgdHJ1ZSk7CisJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTIpCisJCXRnbF9waHlfc2V0X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCwg
dHJ1ZSk7CisJZWxzZQorCQlpY2xfcGh5X3NldF9jbG9ja19nYXRpbmcoZGlnX3BvcnQsIHRydWUp
OwogCiAJaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKQogCQlza2xfZGRpX3NldF9pYm9vc3QoZW5j
b2RlciwgbGV2ZWwsIElOVEVMX09VVFBVVF9IRE1JKTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

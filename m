Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 49050D4DE7
	for <lists+intel-gfx@lfdr.de>; Sat, 12 Oct 2019 09:23:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 885FE6E45F;
	Sat, 12 Oct 2019 07:23:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E16C56E45E
 for <intel-gfx@lists.freedesktop.org>; Sat, 12 Oct 2019 07:23:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18811657-1500050 
 for <intel-gfx@lists.freedesktop.org>; Sat, 12 Oct 2019 08:23:09 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 12 Oct 2019 08:23:07 +0100
Message-Id: <20191012072308.30312-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191012072308.30312-1-chris@chris-wilson.co.uk>
References: <20191012072308.30312-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/3] drm/i915/perf: implement active wait for noa
 configurations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
Tk9BIGNvbmZpZ3VyYXRpb24gdGFrZSBzb21lIGFtb3VudCBvZiB0aW1lIHRvIGFwcGx5LiBUaGF0
IGFtb3VudCBvZgp0aW1lIGRlcGVuZHMgb24gdGhlIHNpemUgb2YgdGhlIEdULiBUaGVyZSBpcyBu
byBkb2N1bWVudGVkIHRpbWUgZm9yCnRoaXMuIEZvciBleGFtcGxlLCBwYXN0IGV4cGVyaW1lbnRh
dGlvbnMgd2l0aCBwb3dlcmdhdGluZwpjb25maWd1cmF0aW9uIGNoYW5nZXMgc2VlbSB0byBpbmRp
Y2F0ZSBhIDYwfjcwdXMgZGVsYXkuIFdlIGdvIHdpdGgKNTAwdXMgYXMgZGVmYXVsdCBmb3Igbm93
IHdoaWNoIHNob3VsZCBiZSBvdmVyIHRoZSByZXF1aXJlZCBhbW91bnQgb2YKdGltZSAoYWNjb3Jk
aW5nIHRvIEhXIGFyY2hpdGVjdHMpLgoKdjI6IERvbid0IGZvcmdldCB0byBzYXZlL3Jlc3RvcmUg
cmVnaXN0ZXJzIHVzZWQgZm9yIHRoZSB3YWl0IChDaHJpcykKCnYzOiBOYW1lIHVzZWQgQ1NfR1BS
IHJlZ2lzdGVycyAoQ2hyaXMpCiAgICBGaXggY29tcGlsZSBpc3N1ZSBkdWUgdG8gcmViYXNlIChM
aW9uZWwpCgp2NDogRml4IHNhdmUvcmVzdG9yZSBoZWxwZXJzIChVbWVzaCkKCnY1OiBNb3ZlIG5v
YV93YWl0IGZyb20gZHJtX2k5MTVfcHJpdmF0ZSB0byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwp
Cgp2NjogQWRkIG1pc3Npbmcgc3RydWN0IGRlY2xhcmF0aW9ucyBpbiBpOTE1X3BlcmYuaAoKU2ln
bmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
ICh2NCkKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28u
dWs+ICh2NCkKLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMu
aCAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggICAg
ICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAg
fCAgMzIgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAg
fCAyMjQgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZf
dHlwZXMuaCAgICAgICAgfCAgIDggKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAg
ICAgICAgICAgICAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9z
ZWxmdGVzdHMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
cGVyZi5jICAgIHwgMjE2ICsrKysrKysrKysrKysrKysrCiA4IGZpbGVzIGNoYW5nZWQsIDQ5MiBp
bnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKaW5kZXggMDk4NzEwMGM3ODZiLi44ZTYzY2ZmY2Fi
ZTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5k
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBA
IC0xNjMsNyArMTYzLDggQEAKICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUCU1JX0lOU1RS
KDB4MzEsIDApCiAjZGVmaW5lICAgTUlfQkFUQ0hfR1RUCQkgICAgKDI8PDYpIC8qIGFsaWFzZWQg
d2l0aCAoMTw8Nykgb24gZ2VuNCAqLwogI2RlZmluZSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VO
OAlNSV9JTlNUUigweDMxLCAxKQotI2RlZmluZSAgIE1JX0JBVENIX1JFU09VUkNFX1NUUkVBTUVS
ICgxPDwxMCkKKyNkZWZpbmUgICBNSV9CQVRDSF9SRVNPVVJDRV9TVFJFQU1FUiBSRUdfQklUKDEw
KQorI2RlZmluZSAgIE1JX0JBVENIX1BSRURJQ0FURSAgICAgICAgIFJFR19CSVQoMTUpIC8qIEhT
Vysgb24gUkNTIG9ubHkqLwogCiAvKgogICogM0QgaW5zdHJ1Y3Rpb25zIHVzZWQgYnkgdGhlIGtl
cm5lbApAQCAtMjI0LDYgKzIyNSw3IEBACiAjZGVmaW5lICAgUElQRV9DT05UUk9MX0NTX1NUQUxM
CQkJCSgxPDwyMCkKICNkZWZpbmUgICBQSVBFX0NPTlRST0xfVExCX0lOVkFMSURBVEUJCQkoMTw8
MTgpCiAjZGVmaW5lICAgUElQRV9DT05UUk9MX01FRElBX1NUQVRFX0NMRUFSCQkoMTw8MTYpCisj
ZGVmaW5lICAgUElQRV9DT05UUk9MX1dSSVRFX1RJTUVTVEFNUAkJCSgzPDwxNCkKICNkZWZpbmUg
ICBQSVBFX0NPTlRST0xfUVdfV1JJVEUJCQkJKDE8PDE0KQogI2RlZmluZSAgIFBJUEVfQ09OVFJP
TF9QT1NUX1NZTkNfT1BfTUFTSyAgICAgICAgICAgICAgICAoMzw8MTQpCiAjZGVmaW5lICAgUElQ
RV9DT05UUk9MX0RFUFRIX1NUQUxMCQkJKDE8PDEzKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3R5cGVzLmgKaW5kZXggODAyZjUxNmEzNDMwLi5iZTRiMjYzNjIxYzggMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAtMTA5LDYgKzEwOSwxMSBAQCBl
bnVtIGludGVsX2d0X3NjcmF0Y2hfZmllbGQgewogCS8qIDggYnl0ZXMgKi8KIAlJTlRFTF9HVF9T
Q1JBVENIX0ZJRUxEX0NPSEVSRU5UTDNfV0EgPSAyNTYsCiAKKwkvKiA2ICogOCBieXRlcyAqLwor
CUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgPSAyMDQ4LAorCisJLyogNCBieXRl
cyAqLworCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVESUNBVEVfUkVTVUxUXzEgPSAy
MDk2LAogfTsKIAogI2VuZGlmIC8qIF9fSU5URUxfR1RfVFlQRVNfSF9fICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IGU1NzU3NjE1NTBhYy4uYTU0MWI2YWU1MzRmIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzU5MCw2ICszNTkwLDM3IEBAIERFRklO
RV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfd2VkZ2VkX2ZvcHMsCiAJCQlpOTE1X3dlZGdlZF9nZXQs
IGk5MTVfd2VkZ2VkX3NldCwKIAkJCSIlbGx1XG4iKTsKIAorc3RhdGljIGludAoraTkxNV9wZXJm
X25vYV9kZWxheV9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisJY29uc3QgdTMyIGNsayA9IFJVTlRJTUVfSU5GTyhpOTE1
KS0+Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHo7CisKKwkvKgorCSAqIFRoaXMgd291bGQgbGVh
ZCB0byBpbmZpbml0ZSB3YWl0cyBhcyB3ZSdyZSBkb2luZyB0aW1lc3RhbXAKKwkgKiBkaWZmZXJl
bmNlIG9uIHRoZSBDUyB3aXRoIG9ubHkgMzJiaXRzLgorCSAqLworCWlmICh2YWwgPiBtdWxfdTMy
X3UzMihVMzJfTUFYLCBjbGspKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWF0b21pYzY0X3NldCgm
aTkxNS0+cGVyZi5ub2FfcHJvZ3JhbW1pbmdfZGVsYXksIHZhbCk7CisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQKK2k5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0KHZvaWQgKmRhdGEsIHU2NCAqdmFs
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKworCSp2YWwgPSBh
dG9taWM2NF9yZWFkKCZpOTE1LT5wZXJmLm5vYV9wcm9ncmFtbWluZ19kZWxheSk7CisJcmV0dXJu
IDA7Cit9CisKK0RFRklORV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfcGVyZl9ub2FfZGVsYXlfZm9w
cywKKwkJCWk5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0LAorCQkJaTkxNV9wZXJmX25vYV9kZWxheV9z
ZXQsCisJCQkiJWxsdVxuIik7CisKICNkZWZpbmUgRFJPUF9VTkJPVU5ECUJJVCgwKQogI2RlZmlu
ZSBEUk9QX0JPVU5ECUJJVCgxKQogI2RlZmluZSBEUk9QX1JFVElSRQlCSVQoMikKQEAgLTQzNDUs
NiArNDM3Niw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9kZWJ1Z2ZzX2ZpbGVzIHsKIAlj
b25zdCBjaGFyICpuYW1lOwogCWNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgKmZvcHM7CiB9
IGk5MTVfZGVidWdmc19maWxlc1tdID0geworCXsiaTkxNV9wZXJmX25vYV9kZWxheSIsICZpOTE1
X3BlcmZfbm9hX2RlbGF5X2ZvcHN9LAogCXsiaTkxNV93ZWRnZWQiLCAmaTkxNV93ZWRnZWRfZm9w
c30sCiAJeyJpOTE1X2NhY2hlX3NoYXJpbmciLCAmaTkxNV9jYWNoZV9zaGFyaW5nX2ZvcHN9LAog
CXsiaTkxNV9nZW1fZHJvcF9jYWNoZXMiLCAmaTkxNV9kcm9wX2NhY2hlc19mb3BzfSwKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggNTBmMmY5NzIwMjBkLi44MWU4YTc5MzQwMDEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xOTgsNiArMTk4LDcgQEAKICNpbmNsdWRlICJnZW0v
aTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgogI2lu
Y2x1ZGUgImd0L2ludGVsX2VuZ2luZV91c2VyLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIK
ICNpbmNsdWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgpA
QCAtMTM0Nyw2ICsxMzQ4LDEyIEBAIGZyZWVfb2FfY29uZmlncyhzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqc3RyZWFtKQogCQlmcmVlX29hX2NvbmZpZ19ibyhvYV9ibyk7CiB9CiAKK3N0YXRpYyB2
b2lkCitmcmVlX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCit7CisJ
aTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJnN0cmVhbS0+bm9hX3dhaXQsIDApOworfQorCiBz
dGF0aWMgdm9pZCBpOTE1X29hX3N0cmVhbV9kZXN0cm95KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0pCiB7CiAJc3RydWN0IGk5MTVfcGVyZiAqcGVyZiA9IHN0cmVhbS0+cGVyZjsKQEAg
LTEzNjksNiArMTM3Niw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3RyZWFtX2Rlc3Ryb3koc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAkJb2FfcHV0X3JlbmRlcl9jdHhfaWQoc3Ry
ZWFtKTsKIAogCWZyZWVfb2FfY29uZmlncyhzdHJlYW0pOworCWZyZWVfbm9hX3dhaXQoc3RyZWFt
KTsKIAogCWlmIChwZXJmLT5zcHVyaW91c19yZXBvcnRfcnMubWlzc2VkKSB7CiAJCURSTV9OT1RF
KCIlZCBzcHVyaW91cyBPQSByZXBvcnQgbm90aWNlcyBzdXBwcmVzc2VkIGR1ZSB0byByYXRlbGlt
aXRpbmdcbiIsCkBAIC0xNTI5LDYgKzE1MzcsMjA2IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVm
ZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJcmV0dXJuIHJldDsKIH0KIAor
c3RhdGljIHUzMiAqc2F2ZV9yZXN0b3JlX3JlZ2lzdGVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0sIHUzMiAqY3MsCisJCQkJICBib29sIHNhdmUsIGk5MTVfcmVnX3QgcmVnLCB1MzIg
b2Zmc2V0LAorCQkJCSAgdTMyIGR3b3JkX2NvdW50KQoreworCXUzMiBjbWQ7CisJdTMyIGQ7CisK
KwljbWQgPSBzYXZlID8gTUlfU1RPUkVfUkVHSVNURVJfTUVNIDogTUlfTE9BRF9SRUdJU1RFUl9N
RU07CisJaWYgKElOVEVMX0dFTihzdHJlYW0tPnBlcmYtPmk5MTUpID49IDgpCisJCWNtZCsrOwor
CisJZm9yIChkID0gMDsgZCA8IGR3b3JkX2NvdW50OyBkKyspIHsKKwkJKmNzKysgPSBjbWQ7CisJ
CSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQocmVnKSArIDQgKiBkOworCQkqY3MrKyA9IGlu
dGVsX2d0X3NjcmF0Y2hfb2Zmc2V0KHN0cmVhbS0+ZW5naW5lLT5ndCwKKwkJCQkJCW9mZnNldCkg
KyA0ICogZDsKKwkJKmNzKysgPSAwOworCX0KKworCXJldHVybiBjczsKK30KKworc3RhdGljIGlu
dCBhbGxvY19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQoreworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5wZXJmLT5pOTE1OworCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpibzsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwljb25z
dCB1NjQgZGVsYXlfdGlja3MgPSAweGZmZmZmZmZmZmZmZmZmZmYgLQorCQlESVY2NF9VNjRfUk9V
TkRfVVAoCisJCQlhdG9taWM2NF9yZWFkKCZzdHJlYW0tPnBlcmYtPm5vYV9wcm9ncmFtbWluZ19k
ZWxheSkgKgorCQkJUlVOVElNRV9JTkZPKGk5MTUpLT5jc190aW1lc3RhbXBfZnJlcXVlbmN5X2to
eiwKKwkJCTEwMDAwMDB1bGwpOworCWNvbnN0IHUzMiBiYXNlID0gc3RyZWFtLT5lbmdpbmUtPm1t
aW9fYmFzZTsKKyNkZWZpbmUgQ1NfR1BSKHgpIEdFTjhfUklOR19DU19HUFIoYmFzZSwgeCkKKwl1
MzIgKmJhdGNoLCAqdHMwLCAqY3MsICpqdW1wOworCWludCByZXQsIGk7CisJZW51bSB7CisJCVNU
QVJUX1RTLAorCQlOT1dfVFMsCisJCURFTFRBX1RTLAorCQlKVU1QX1BSRURJQ0FURSwKKwkJREVM
VEFfVEFSR0VULAorCQlOX0NTX0dQUgorCX07CisKKwlibyA9IGk5MTVfZ2VtX29iamVjdF9jcmVh
dGVfaW50ZXJuYWwoaTkxNSwgNDA5Nik7CisJaWYgKElTX0VSUihibykpIHsKKwkJRFJNX0VSUk9S
KCJGYWlsZWQgdG8gYWxsb2NhdGUgTk9BIHdhaXQgYmF0Y2hidWZmZXJcbiIpOworCQlyZXR1cm4g
UFRSX0VSUihibyk7CisJfQorCisJLyoKKwkgKiBXZSBwaW4gaW4gR0dUVCBiZWNhdXNlIHdlIGp1
bXAgaW50byB0aGlzIGJ1ZmZlciBub3cgYmVjYXVzZQorCSAqIG11bHRpcGxlIE9BIGNvbmZpZyBC
T3Mgd2lsbCBoYXZlIGEganVtcCB0byB0aGlzIGFkZHJlc3MgYW5kIGl0CisJICogbmVlZHMgdG8g
YmUgZml4ZWQgZHVyaW5nIHRoZSBsaWZldGltZSBvZiB0aGUgaTkxNS9wZXJmIHN0cmVhbS4KKwkg
Ki8KKwl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oYm8sIE5VTEwsIDAsIDAsIFBJTl9I
SUdIKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJcmV0ID0gUFRSX0VSUih2bWEpOworCQlnb3Rv
IGVycl91bnJlZjsKKwl9CisKKwliYXRjaCA9IGNzID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAo
Ym8sIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGJhdGNoKSkgeworCQlyZXQgPSBQVFJfRVJS
KGJhdGNoKTsKKwkJZ290byBlcnJfdW5waW47CisJfQorCisJLyogU2F2ZSByZWdpc3RlcnMuICov
CisJZm9yIChpID0gMDsgaSA8IE5fQ1NfR1BSOyBpKyspCisJCWNzID0gc2F2ZV9yZXN0b3JlX3Jl
Z2lzdGVyKAorCQkJc3RyZWFtLCBjcywgdHJ1ZSAvKiBzYXZlICovLCBDU19HUFIoaSksCisJCQlJ
TlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfQ1NfR1BSICsgOCAqIGksIDIpOworCWNzID0gc2F2
ZV9yZXN0b3JlX3JlZ2lzdGVyKAorCQlzdHJlYW0sIGNzLCB0cnVlIC8qIHNhdmUgKi8sIE1JX1BS
RURJQ0FURV9SRVNVTFRfMSwKKwkJSU5URUxfR1RfU0NSQVRDSF9GSUVMRF9QRVJGX1BSRURJQ0FU
RV9SRVNVTFRfMSwgMSk7CisKKwkvKiBGaXJzdCB0aW1lc3RhbXAgc25hcHNob3QgbG9jYXRpb24u
ICovCisJdHMwID0gY3M7CisKKwkvKgorCSAqIEluaXRpYWwgc25hcHNob3Qgb2YgdGhlIHRpbWVz
dGFtcCByZWdpc3RlciB0byBpbXBsZW1lbnQgdGhlIHdhaXQuCisJICogV2Ugd29yayB3aXRoIDMy
YiB2YWx1ZXMsIHNvIGNsZWFyIG91dCB0aGUgdG9wIDMyYiBiaXRzIG9mIHRoZQorCSAqIHJlZ2lz
dGVyIGJlY2F1c2UgdGhlIEFMVSB3b3JrcyA2NGJpdHMuCisJICovCisJKmNzKysgPSBNSV9MT0FE
X1JFR0lTVEVSX0lNTSgxKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihT
VEFSVF9UUykpICsgNDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JF
RyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChSSU5HX1RJTUVTVEFN
UChiYXNlKSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoU1RBUlRfVFMp
KTsKKworCS8qCisJICogVGhpcyBpcyB0aGUgbG9jYXRpb24gd2UncmUgZ29pbmcgdG8ganVtcCBi
YWNrIGludG8gdW50aWwgdGhlCisJICogcmVxdWlyZWQgYW1vdW50IG9mIHRpbWUgaGFzIHBhc3Nl
ZC4KKwkgKi8KKwlqdW1wID0gY3M7CisKKwkvKgorCSAqIFRha2UgYW5vdGhlciBzbmFwc2hvdCBv
ZiB0aGUgdGltZXN0YW1wIHJlZ2lzdGVyLiBUYWtlIGNhcmUgdG8gY2xlYXIKKwkgKiB1cCB0aGUg
dG9wIDMyYml0cyBvZiBDU19HUFIoMSkgYXMgd2UncmUgdXNpbmcgaXQgZm9yIG90aGVyCisJICog
b3BlcmF0aW9ucyBiZWxvdy4KKwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKDEp
OworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BSKE5PV19UUykpICsgNDsKKwkq
Y3MrKyA9IDA7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRyB8ICgzIC0gMik7CisJKmNz
KysgPSBpOTE1X21taW9fcmVnX29mZnNldChSSU5HX1RJTUVTVEFNUChiYXNlKSk7CisJKmNzKysg
PSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoTk9XX1RTKSk7CisKKwkvKgorCSAqIERvIGEg
ZGlmZiBiZXR3ZWVuIHRoZSAyIHRpbWVzdGFtcHMgYW5kIHN0b3JlIHRoZSByZXN1bHQgYmFjayBp
bnRvCisJICogQ1NfR1BSKDEpLgorCSAqLworCSpjcysrID0gTUlfTUFUSCg1KTsKKwkqY3MrKyA9
IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNBLCBNSV9NQVRIX1JFRyhOT1dfVFMpKTsKKwkq
Y3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNCLCBNSV9NQVRIX1JFRyhTVEFSVF9U
UykpOworCSpjcysrID0gTUlfTUFUSF9TVUI7CisJKmNzKysgPSBNSV9NQVRIX1NUT1JFKE1JX01B
VEhfUkVHKERFTFRBX1RTKSwgTUlfTUFUSF9SRUdfQUNDVSk7CisJKmNzKysgPSBNSV9NQVRIX1NU
T1JFKE1JX01BVEhfUkVHKEpVTVBfUFJFRElDQVRFKSwgTUlfTUFUSF9SRUdfQ0YpOworCisJLyoK
KwkgKiBUcmFuc2ZlciB0aGUgY2FycnkgZmxhZyAoc2V0IHRvIDEgaWYgdHMxIDwgdHMwLCBtZWFu
aW5nIHRoZQorCSAqIHRpbWVzdGFtcCBoYXZlIHJvbGxlZCBvdmVyIHRoZSAzMmJpdHMpIGludG8g
dGhlIHByZWRpY2F0ZSByZWdpc3RlcgorCSAqIHRvIGJlIHVzZWQgZm9yIHRoZSBwcmVkaWNhdGVk
IGp1bXAuCisJICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRyB8ICgzIC0gMik7CisJ
KmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoSlVNUF9QUkVESUNBVEUpKTsKKwkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KE1JX1BSRURJQ0FURV9SRVNVTFRfMSk7CisKKwkv
KiBSZXN0YXJ0IGZyb20gdGhlIGJlZ2lubmluZyBpZiB3ZSBoYWQgdGltZXN0YW1wcyByb2xsIG92
ZXIuICovCisJKmNzKysgPSAoSU5URUxfR0VOKGk5MTUpIDwgOCA/CisJCSBNSV9CQVRDSF9CVUZG
RVJfU1RBUlQgOgorCQkgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjgpIHwKKwkJTUlfQkFUQ0hf
UFJFRElDQVRFOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldCh2bWEpICsgKHRzMCAtIGJhdGNo
KSAqIDQ7CisJKmNzKysgPSAwOworCisJLyoKKwkgKiBOb3cgYWRkIHRoZSBkaWZmIGJldHdlZW4g
dG8gcHJldmlvdXMgdGltZXN0YW1wcyBhbmQgYWRkIGl0IHRvIDoKKwkgKiAgICAgICgoKDEgKiA8
PCA2NCkgLSAxKSAtIGRlbGF5X25zKQorCSAqCisJICogV2hlbiB0aGUgQ2FycnkgRmxhZyBjb250
YWlucyAxIHRoaXMgbWVhbnMgdGhlIGVsYXBzZWQgdGltZSBpcworCSAqIGxvbmdlciB0aGFuIHRo
ZSBleHBlY3RlZCBkZWxheSwgYW5kIHdlIGNhbiBleGl0IHRoZSB3YWl0IGxvb3AuCisJICovCisJ
KmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgyKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdf
b2Zmc2V0KENTX0dQUihERUxUQV9UQVJHRVQpKTsKKwkqY3MrKyA9IGxvd2VyXzMyX2JpdHMoZGVs
YXlfdGlja3MpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BSKERFTFRBX1RB
UkdFVCkpICsgNDsKKwkqY3MrKyA9IHVwcGVyXzMyX2JpdHMoZGVsYXlfdGlja3MpOworCisJKmNz
KysgPSBNSV9NQVRIKDQpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0Es
IE1JX01BVEhfUkVHKERFTFRBX1RTKSk7CisJKmNzKysgPSBNSV9NQVRIX0xPQUQoTUlfTUFUSF9S
RUdfU1JDQiwgTUlfTUFUSF9SRUcoREVMVEFfVEFSR0VUKSk7CisJKmNzKysgPSBNSV9NQVRIX0FE
RDsKKwkqY3MrKyA9IE1JX01BVEhfU1RPUkVJTlYoTUlfTUFUSF9SRUcoSlVNUF9QUkVESUNBVEUp
LCBNSV9NQVRIX1JFR19DRik7CisKKwkvKgorCSAqIFRyYW5zZmVyIHRoZSByZXN1bHQgaW50byB0
aGUgcHJlZGljYXRlIHJlZ2lzdGVyIHRvIGJlIHVzZWQgZm9yIHRoZQorCSAqIHByZWRpY2F0ZWQg
anVtcC4KKwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVHIHwgKDMgLSAyKTsKKwkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihKVU1QX1BSRURJQ0FURSkpOworCSpj
cysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoTUlfUFJFRElDQVRFX1JFU1VMVF8xKTsKKworCS8q
IFByZWRpY2F0ZSB0aGUganVtcC4gICovCisJKmNzKysgPSAoSU5URUxfR0VOKGk5MTUpIDwgOCA/
CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQgOgorCQkgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dF
TjgpIHwKKwkJTUlfQkFUQ0hfUFJFRElDQVRFOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldCh2
bWEpICsgKGp1bXAgLSBiYXRjaCkgKiA0OworCSpjcysrID0gMDsKKworCS8qIFJlc3RvcmUgcmVn
aXN0ZXJzLiAqLworCWZvciAoaSA9IDA7IGkgPCBOX0NTX0dQUjsgaSsrKQorCQljcyA9IHNhdmVf
cmVzdG9yZV9yZWdpc3RlcigKKwkJCXN0cmVhbSwgY3MsIGZhbHNlIC8qIHJlc3RvcmUgKi8sIENT
X0dQUihpKSwKKwkJCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgKyA4ICogaSwg
Mik7CisJY3MgPSBzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIoCisJCXN0cmVhbSwgY3MsIGZhbHNlIC8q
IHJlc3RvcmUgKi8sIE1JX1BSRURJQ0FURV9SRVNVTFRfMSwKKwkJSU5URUxfR1RfU0NSQVRDSF9G
SUVMRF9QRVJGX1BSRURJQ0FURV9SRVNVTFRfMSwgMSk7CisKKwkvKiBBbmQgcmV0dXJuIHRvIHRo
ZSByaW5nLiAqLworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCUdFTV9CVUdfT04o
Y3MgLSBiYXRjaCA+IFBBR0VfU0laRSAvIHNpemVvZigqYmF0Y2gpKTsKKworCWk5MTVfZ2VtX29i
amVjdF9mbHVzaF9tYXAoYm8pOworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoYm8pOworCisJ
c3RyZWFtLT5ub2Ffd2FpdCA9IHZtYTsKKwlyZXR1cm4gMDsKKworZXJyX3VucGluOgorCV9faTkx
NV92bWFfdW5waW4odm1hKTsKK2Vycl91bnJlZjoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KGJvKTsK
KwlyZXR1cm4gcmV0OworfQorCiBzdGF0aWMgdm9pZCBjb25maWdfb2FfcmVncyhzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaTkxNV9vYV9yZWcgKnJlZ3Ms
CiAJCQkgICB1MzIgbl9yZWdzKQpAQCAtMjIwNiw2ICsyNDE0LDEyIEBAIHN0YXRpYyBpbnQgaTkx
NV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCQl9CiAJ
fQogCisJcmV0ID0gYWxsb2Nfbm9hX3dhaXQoc3RyZWFtKTsKKwlpZiAocmV0KSB7CisJCURSTV9E
RUJVRygiVW5hYmxlIHRvIGFsbG9jYXRlIE5PQSB3YWl0IGJhdGNoIGJ1ZmZlclxuIik7CisJCWdv
dG8gZXJyX25vYV93YWl0X2FsbG9jOworCX0KKwogCXN0cmVhbS0+b2FfY29uZmlnID0gaTkxNV9w
ZXJmX2dldF9vYV9jb25maWcocGVyZiwgcHJvcHMtPm1ldHJpY3Nfc2V0KTsKIAlpZiAoIXN0cmVh
bS0+b2FfY29uZmlnKSB7CiAJCURSTV9ERUJVRygiSW52YWxpZCBPQSBjb25maWcgaWQ9JWlcbiIs
IHByb3BzLT5tZXRyaWNzX3NldCk7CkBAIC0yMjY1LDYgKzI0NzksOSBAQCBzdGF0aWMgaW50IGk5
MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAlpbnRl
bF9lbmdpbmVfcG1fcHV0KHN0cmVhbS0+ZW5naW5lKTsKIAogZXJyX2NvbmZpZzoKKwlmcmVlX25v
YV93YWl0KHN0cmVhbSk7CisKK2Vycl9ub2Ffd2FpdF9hbGxvYzoKIAlpZiAoc3RyZWFtLT5jdHgp
CiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cmVhbSk7CiAKQEAgLTM2NTEsNiArMzg2OCw5IEBA
IHZvaWQgaTkxNV9wZXJmX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCXJh
dGVsaW1pdF9zZXRfZmxhZ3MoJnBlcmYtPnNwdXJpb3VzX3JlcG9ydF9ycywKIAkJCQkgICAgUkFU
RUxJTUlUX01TR19PTl9SRUxFQVNFKTsKIAorCQlhdG9taWM2NF9zZXQoJnBlcmYtPm5vYV9wcm9n
cmFtbWluZ19kZWxheSwKKwkJCSAgICAgNTAwICogMTAwMCAvKiA1MDB1cyAqLyk7CisKIAkJcGVy
Zi0+aTkxNSA9IGk5MTU7CiAJfQogfQpAQCAtMzY4MCwzICszOTAwLDcgQEAgdm9pZCBpOTE1X3Bl
cmZfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAltZW1zZXQoJnBlcmYtPm9w
cywgMCwgc2l6ZW9mKHBlcmYtPm9wcykpOwogCXBlcmYtPmk5MTUgPSBOVUxMOwogfQorCisjaWYg
SVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAic2VsZnRlc3Rz
L2k5MTVfcGVyZi5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmZfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZl90eXBlcy5o
CmluZGV4IDMzN2NkN2QyYWQ3Ny4uZDM1YTNjMTk0NmMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmZfdHlwZXMuaApAQCAtMjY2LDYgKzI2NiwxMiBAQCBzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSB7CiAJCSAqLwogCQl1MzIgaGVhZDsKIAl9IG9hX2J1ZmZlcjsKKworCS8qKgorCSAqIEEg
YmF0Y2ggYnVmZmVyIGRvaW5nIGEgd2FpdCBvbiB0aGUgR1BVIGZvciB0aGUgTk9BIGxvZ2ljIHRv
IGJlCisJICogcmVwcm9ncmFtbWVkLgorCSAqLworCXN0cnVjdCBpOTE1X3ZtYSAqbm9hX3dhaXQ7
CiB9OwogCiAvKioKQEAgLTM4NSw2ICszOTEsOCBAQCBzdHJ1Y3QgaTkxNV9wZXJmIHsKIAogCXN0
cnVjdCBpOTE1X29hX29wcyBvcHM7CiAJY29uc3Qgc3RydWN0IGk5MTVfb2FfZm9ybWF0ICpvYV9m
b3JtYXRzOworCisJYXRvbWljNjRfdCBub2FfcHJvZ3JhbW1pbmdfZGVsYXk7CiB9OwogCiAjZW5k
aWYgLyogX0k5MTVfUEVSRl9UWVBFU19IXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZWcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKaW5kZXgg
MGZiOTAzMGI4OWYxLi5lMjQ5OTFlNTQ4OTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaApAQCAt
NTQ1LDcgKzU0NSw5IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X21taW9fcmVnX3ZhbGlkKGk5
MTVfcmVnX3QgcmVnKQogI2RlZmluZSBNSV9QUkVESUNBVEVfU1JDMF9VRFcJX01NSU8oMHgyNDAw
ICsgNCkKICNkZWZpbmUgTUlfUFJFRElDQVRFX1NSQzEJX01NSU8oMHgyNDA4KQogI2RlZmluZSBN
SV9QUkVESUNBVEVfU1JDMV9VRFcJX01NSU8oMHgyNDA4ICsgNCkKLQorI2RlZmluZSBNSV9QUkVE
SUNBVEVfREFUQSAgICAgICBfTU1JTygweDI0MTApCisjZGVmaW5lIE1JX1BSRURJQ0FURV9SRVNV
TFQgICAgIF9NTUlPKDB4MjQxOCkKKyNkZWZpbmUgTUlfUFJFRElDQVRFX1JFU1VMVF8xICAgX01N
SU8oMHgyNDFjKQogI2RlZmluZSBNSV9QUkVESUNBVEVfUkVTVUxUXzIJX01NSU8oMHgyMjE0KQog
I2RlZmluZSAgTE9XRVJfU0xJQ0VfRU5BQkxFRAkoMSA8PCAwKQogI2RlZmluZSAgTE9XRVJfU0xJ
Q0VfRElTQUJMRUQJKDAgPDwgMCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCmluZGV4IDY3MTNlZmVhMzUwYi4uNmRhZjY1OTll
Yzc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZl
X3NlbGZ0ZXN0cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xp
dmVfc2VsZnRlc3RzLmgKQEAgLTM1LDMgKzM1LDQgQEAgc2VsZnRlc3QocmVzZXQsIGludGVsX3Jl
c2V0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoaGFuZ2NoZWNrLCBpbnRlbF9oYW5nY2hlY2tf
bGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChleGVjbGlzdHMsIGludGVsX2V4ZWNsaXN0c19saXZl
X3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd1YywgaW50ZWxfZ3VjX2xpdmVfc2VsZnRlc3QpCitzZWxm
dGVzdChwZXJmLCBpOTE1X3BlcmZfbGl2ZV9zZWxmdGVzdHMpCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5kYzZkNjg5ZTQyNTEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMKQEAgLTAsMCArMSwyMTYgQEAKKy8qCisgKiBTUERY
LUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwg
Q29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgva3JlZi5oPgorCisjaW5jbHVkZSAi
Z2VtL2k5MTVfZ2VtX3BtLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKworI2luY2x1ZGUg
Imk5MTVfc2VsZnRlc3QuaCIKKworI2luY2x1ZGUgImlndF9mbHVzaF90ZXN0LmgiCisjaW5jbHVk
ZSAibGliX3N3X2ZlbmNlLmgiCisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqCit0
ZXN0X3N0cmVhbShzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmKQoreworCXN0cnVjdCBkcm1faTkxNV9w
ZXJmX29wZW5fcGFyYW0gcGFyYW0gPSB7fTsKKwlzdHJ1Y3QgcGVyZl9vcGVuX3Byb3BlcnRpZXMg
cHJvcHMgPSB7CisJCS5lbmdpbmUgPSBpbnRlbF9lbmdpbmVfbG9va3VwX3VzZXIocGVyZi0+aTkx
NSwKKwkJCQkJCSAgIEk5MTVfRU5HSU5FX0NMQVNTX1JFTkRFUiwKKwkJCQkJCSAgIDApLAorCQku
c2FtcGxlX2ZsYWdzID0gU0FNUExFX09BX1JFUE9SVCwKKwkJLm9hX2Zvcm1hdCA9IEk5MTVfT0Ff
Rk9STUFUX0M0X0I4LAorCQkubWV0cmljc19zZXQgPSAxLAorCX07CisJc3RydWN0IGk5MTVfcGVy
Zl9zdHJlYW0gKnN0cmVhbTsKKworCXN0cmVhbSA9IGt6YWxsb2Moc2l6ZW9mKCpzdHJlYW0pLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIXN0cmVhbSkKKwkJcmV0dXJuIE5VTEw7CisKKwlzdHJlYW0tPnBl
cmYgPSBwZXJmOworCisJbXV0ZXhfbG9jaygmcGVyZi0+bG9jayk7CisJaWYgKGk5MTVfb2Ffc3Ry
ZWFtX2luaXQoc3RyZWFtLCAmcGFyYW0sICZwcm9wcykpIHsKKwkJa2ZyZWUoc3RyZWFtKTsKKwkJ
c3RyZWFtID0gIE5VTEw7CisJfQorCW11dGV4X3VubG9jaygmcGVyZi0+bG9jayk7CisKKwlyZXR1
cm4gc3RyZWFtOworfQorCitzdGF0aWMgdm9pZCBzdHJlYW1fZGVzdHJveShzdHJ1Y3QgaTkxNV9w
ZXJmX3N0cmVhbSAqc3RyZWFtKQoreworCXN0cnVjdCBpOTE1X3BlcmYgKnBlcmYgPSBzdHJlYW0t
PnBlcmY7CisKKwltdXRleF9sb2NrKCZwZXJmLT5sb2NrKTsKKwlpOTE1X3BlcmZfZGVzdHJveV9s
b2NrZWQoc3RyZWFtKTsKKwltdXRleF91bmxvY2soJnBlcmYtPmxvY2spOworfQorCitzdGF0aWMg
aW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW07CisKKwkv
KiBRdWljayBjaGVjayB3ZSBjYW4gY3JlYXRlIGEgcGVyZiBzdHJlYW0gKi8KKworCXN0cmVhbSA9
IHRlc3Rfc3RyZWFtKCZpOTE1LT5wZXJmKTsKKwlpZiAoIXN0cmVhbSkKKwkJcmV0dXJuIC1FSU5W
QUw7CisKKwlzdHJlYW1fZGVzdHJveShzdHJlYW0pOworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IHdyaXRlX3RpbWVzdGFtcChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgaW50IHNsb3QpCit7
CisJdTMyICpjczsKKwlpbnQgbGVuOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCA2KTsK
KwlpZiAoSVNfRVJSKGNzKSkKKwkJcmV0dXJuIFBUUl9FUlIoY3MpOworCisJbGVuID0gNTsKKwlp
ZiAoSU5URUxfR0VOKHJxLT5pOTE1KSA+PSA4KQorCQlsZW4rKzsKKworCSpjcysrID0gR0ZYX09Q
X1BJUEVfQ09OVFJPTChsZW4pOworCSpjcysrID0gUElQRV9DT05UUk9MX0dMT0JBTF9HVFRfSVZC
IHwKKwkJUElQRV9DT05UUk9MX1NUT1JFX0RBVEFfSU5ERVggfAorCQlQSVBFX0NPTlRST0xfV1JJ
VEVfVElNRVNUQU1QOworCSpjcysrID0gc2xvdCAqIHNpemVvZih1MzIpOworCSpjcysrID0gMDsK
KwkqY3MrKyA9IDA7CisJKmNzKysgPSAwOworCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGt0aW1lX3QgcG9sbF9zdGF0dXMoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsIGludCBzbG90KQoreworCXdoaWxlICghaW50ZWxfcmVhZF9zdGF0dXNf
cGFnZShycS0+ZW5naW5lLCBzbG90KSAmJgorCSAgICAgICAhaTkxNV9yZXF1ZXN0X2NvbXBsZXRl
ZChycSkpCisJCWNwdV9yZWxheCgpOworCisJcmV0dXJuIGt0aW1lX2dldCgpOworfQorCitzdGF0
aWMgaW50IGxpdmVfbm9hX2RlbGF5KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtOworCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWt0aW1lX3QgdDAsIHQxOworCXU2NCBleHBlY3RlZDsK
Kwl1MzIgZGVsYXk7CisJaW50IGVycjsKKwlpbnQgaTsKKworCS8qIENoZWNrIHRoYXQgdGhlIEdQ
VSBkZWxheXMgbWF0Y2hlcyBleHBlY3RhdGlvbnMgKi8KKworCXN0cmVhbSA9IHRlc3Rfc3RyZWFt
KCZpOTE1LT5wZXJmKTsKKwlpZiAoIXN0cmVhbSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlleHBl
Y3RlZCA9IGF0b21pYzY0X3JlYWQoJnN0cmVhbS0+cGVyZi0+bm9hX3Byb2dyYW1taW5nX2RlbGF5
KTsKKworCWlmIChzdHJlYW0tPmVuZ2luZS0+Y2xhc3MgIT0gUkVOREVSX0NMQVNTKSB7CisJCWVy
ciA9IC1FTk9ERVY7CisJCWdvdG8gb3V0OworCX0KKworCWZvciAoaSA9IDA7IGkgPCA0OyBpKysp
CisJCWludGVsX3dyaXRlX3N0YXR1c19wYWdlKHN0cmVhbS0+ZW5naW5lLCAweDEwMCArIGksIDAp
OworCisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cmVhbS0+ZW5naW5lLT5rZXJuZWxfY29u
dGV4dCk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8g
b3V0OworCX0KKworCWlmIChycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYiAmJgorCSAg
ICBpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpLT5oYXNfaW5pdGlhbF9icmVhZGNydW1iKSB7CisJ
CWVyciA9IHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKHJxKTsKKwkJaWYgKGVycikg
eworCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCQlnb3RvIG91dDsKKwkJfQorCX0KKworCWVy
ciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMHgxMDApOworCWlmIChlcnIpIHsKKwkJaTkxNV9yZXF1
ZXN0X2FkZChycSk7CisJCWdvdG8gb3V0OworCX0KKworCWVyciA9IHJxLT5lbmdpbmUtPmVtaXRf
YmJfc3RhcnQocnEsCisJCQkJCWk5MTVfZ2d0dF9vZmZzZXQoc3RyZWFtLT5ub2Ffd2FpdCksIDAs
CisJCQkJCUk5MTVfRElTUEFUQ0hfU0VDVVJFKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfcmVxdWVz
dF9hZGQocnEpOworCQlnb3RvIG91dDsKKwl9CisKKwllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEs
IDB4MTAyKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQlnb3RvIG91
dDsKKwl9CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsK
KworCXByZWVtcHRfZGlzYWJsZSgpOworCXQwID0gcG9sbF9zdGF0dXMocnEsIDB4MTAwKTsKKwl0
MSA9IHBvbGxfc3RhdHVzKHJxLCAweDEwMik7CisJcHJlZW1wdF9lbmFibGUoKTsKKworCXByX2lu
Zm8oIkNQVSBkZWxheTogJWxsdW5zLCBleHBlY3RlZCAlbGx1bnNcbiIsCisJCWt0aW1lX3N1Yih0
MSwgdDApLCBleHBlY3RlZCk7CisKKwlkZWxheSA9IGludGVsX3JlYWRfc3RhdHVzX3BhZ2Uoc3Ry
ZWFtLT5lbmdpbmUsIDB4MTAyKTsKKwlkZWxheSAtPSBpbnRlbF9yZWFkX3N0YXR1c19wYWdlKHN0
cmVhbS0+ZW5naW5lLCAweDEwMCk7CisJZGVsYXkgPSBkaXZfdTY0KG11bF91MzJfdTMyKGRlbGF5
LCAxMDAwICogMTAwMCksCisJCQlSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFtcF9mcmVx
dWVuY3lfa2h6KTsKKwlwcl9pbmZvKCJHUFUgZGVsYXk6ICV1bnMsIGV4cGVjdGVkICVsbHVuc1xu
IiwKKwkJZGVsYXksIGV4cGVjdGVkKTsKKworCWlmICg0ICogZGVsYXkgPCAzICogZXhwZWN0ZWQg
fHwgMiAqIGRlbGF5ID4gMyAqIGV4cGVjdGVkKSB7CisJCXByX2VycigiR1BVIGRlbGF5IFsldXVz
XSBvdXRzaWRlIG9mIGV4cGVjdGVkIHRocmVzaG9sZCEgWyVsbHV1cywgJWxsdXVzXVxuIiwKKwkJ
ICAgICAgIGRlbGF5IC8gMTAwMCwKKwkJICAgICAgIGRpdl91NjQoMyAqIGV4cGVjdGVkLCA0MDAw
KSwKKwkJICAgICAgIGRpdl91NjQoMyAqIGV4cGVjdGVkLCAyMDAwKSk7CisJCWVyciA9IC1FSU5W
QUw7CisJfQorCisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CitvdXQ6CisJc3RyZWFtX2Rlc3Ryb3ko
c3RyZWFtKTsKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaTkxNV9wZXJmX2xpdmVfc2VsZnRlc3Rz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3Qg
aTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2ZV9zYW5pdHljaGVjayksCisJ
CVNVQlRFU1QobGl2ZV9ub2FfZGVsYXkpLAorCX07CisJc3RydWN0IGk5MTVfcGVyZiAqcGVyZiA9
ICZpOTE1LT5wZXJmOworCisJaWYgKCFwZXJmLT5tZXRyaWNzX2tvYmogfHwgIXBlcmYtPm9wcy5l
bmFibGVfbWV0cmljX3NldCkKKwkJcmV0dXJuIDA7CisKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2Vk
KCZpOTE1LT5ndCkpCisJCXJldHVybiAwOworCisJcmV0dXJuIGk5MTVfc3VidGVzdHModGVzdHMs
IGk5MTUpOworfQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A672E115DA5
	for <lists+intel-gfx@lfdr.de>; Sat,  7 Dec 2019 18:01:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 72B7A6E1F2;
	Sat,  7 Dec 2019 17:01:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 23BFD6E1EC
 for <intel-gfx@lists.freedesktop.org>; Sat,  7 Dec 2019 17:01:24 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19496908-1500050 
 for multiple; Sat, 07 Dec 2019 17:01:11 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat,  7 Dec 2019 17:01:06 +0000
Message-Id: <20191207170110.2200142-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191207170110.2200142-1-chris@chris-wilson.co.uk>
References: <20191207170110.2200142-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/8] drm/i915/gem: Tidy up error handling for
 eb_parse()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgdGhlIGNhbGxlciBubyBsb25nZXIgdXNlcyB0aGUgaTkxNV92bWEgcmVzdWx0LCBzdG9wIHJl
dHVybmluZyBpdCBhbmQKanVzdCByZXR1cm4gdGhlIGVycm9yIGNvZGUgaW5zdGVhZC4KClNpZ25l
ZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIC4u
Li9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8IDM3ICsrKysrKysr
Ky0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNyBpbnNlcnRpb25zKCspLCAyMCBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhl
Y2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YwppbmRleCBhY2Y3MTQ2NmY4ZWEuLjY5MGEzNjcwZWQwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC0xOTgyLDE5ICsxOTgyLDI0IEBA
IHNoYWRvd19iYXRjaF9waW4oc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJcmV0dXJuIHZtYTsKIH0KIAotc3RhdGljIHN0cnVjdCBp
OTE1X3ZtYSAqZWJfcGFyc2Uoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCitzdGF0aWMgaW50
IGViX3BhcnNlKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQogewogCXN0cnVjdCBpbnRlbF9l
bmdpbmVfcG9vbF9ub2RlICpwb29sOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7
CiAKKwlpZiAoIWViX3VzZV9jbWRwYXJzZXIoZWIpKQorCQlyZXR1cm4gMDsKKwogCXBvb2wgPSBp
bnRlbF9lbmdpbmVfZ2V0X3Bvb2woZWItPmVuZ2luZSwgZWItPmJhdGNoX2xlbik7CiAJaWYgKElT
X0VSUihwb29sKSkKLQkJcmV0dXJuIEVSUl9DQVNUKHBvb2wpOworCQlyZXR1cm4gUFRSX0VSUihw
b29sKTsKIAogCXZtYSA9IHNoYWRvd19iYXRjaF9waW4oZWIsIHBvb2wtPm9iaik7Ci0JaWYgKElT
X0VSUih2bWEpKQorCWlmIChJU19FUlIodm1hKSkgeworCQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJ
CWdvdG8gZXJyOworCX0KIAogCWVyciA9IGludGVsX2VuZ2luZV9jbWRfcGFyc2VyKGViLT5lbmdp
bmUsCiAJCQkJICAgICAgZWItPmJhdGNoLApAQCAtMjAwMiw4ICsyMDA3LDYgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3ZtYSAqZWJfcGFyc2Uoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJCQkJ
ICAgICAgZWItPmJhdGNoX2xlbiwKIAkJCQkgICAgICB2bWEpOwogCWlmIChlcnIpIHsKLQkJaTkx
NV92bWFfdW5waW4odm1hKTsKLQogCQkvKgogCQkgKiBVbnNhZmUgR0dUVC1iYWNrZWQgYnVmZmVy
cyBjYW4gc3RpbGwgYmUgc3VibWl0dGVkIHNhZmVseQogCQkgKiBhcyBub24tc2VjdXJlLgpAQCAt
MjAxMiwxMCArMjAxNSw4IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmViX3BhcnNlKHN0cnVj
dCBpOTE1X2V4ZWNidWZmZXIgKmViKQogCQkgKi8KIAkJaWYgKGk5MTVfdm1hX2lzX2dndHQodm1h
KSAmJiBlcnIgPT0gLUVBQ0NFUykKIAkJCS8qIEV4ZWN1dGUgb3JpZ2luYWwgYnVmZmVyIG5vbi1z
ZWN1cmUgKi8KLQkJCXZtYSA9IE5VTEw7Ci0JCWVsc2UKLQkJCXZtYSA9IEVSUl9QVFIoZXJyKTsK
LQkJZ290byBlcnI7CisJCQllcnIgPSAwOworCQlnb3RvIGVycl91bnBpbjsKIAl9CiAKIAllYi0+
dm1hW2ViLT5idWZmZXJfY291bnRdID0gaTkxNV92bWFfZ2V0KHZtYSk7CkBAIC0yMDMzLDExICsy
MDM0LDEzIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmViX3BhcnNlKHN0cnVjdCBpOTE1X2V4
ZWNidWZmZXIgKmViKQogCS8qIGViLT5iYXRjaF9sZW4gdW5jaGFuZ2VkICovCiAKIAl2bWEtPnBy
aXZhdGUgPSBwb29sOwotCXJldHVybiB2bWE7CisJcmV0dXJuIDA7CiAKK2Vycl91bnBpbjoKKwlp
OTE1X3ZtYV91bnBpbih2bWEpOwogZXJyOgogCWludGVsX2VuZ2luZV9wb29sX3B1dChwb29sKTsK
LQlyZXR1cm4gdm1hOworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC0yNTU4LDE1
ICsyNTYxLDkgQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAogCWlmIChlYi5iYXRjaF9sZW4gPT0gMCkKIAkJZWIuYmF0Y2hfbGVuID0gZWIuYmF0Y2gtPnNp
emUgLSBlYi5iYXRjaF9zdGFydF9vZmZzZXQ7CiAKLQlpZiAoZWJfdXNlX2NtZHBhcnNlcigmZWIp
KSB7Ci0JCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCi0JCXZtYSA9IGViX3BhcnNlKCZlYik7Ci0J
CWlmIChJU19FUlIodm1hKSkgewotCQkJZXJyID0gUFRSX0VSUih2bWEpOwotCQkJZ290byBlcnJf
dm1hOwotCQl9Ci0JfQorCWVyciA9IGViX3BhcnNlKCZlYik7CisJaWYgKGVycikKKwkJZ290byBl
cnJfdm1hOwogCiAJLyoKIAkgKiBzbmIvaXZiL3ZsdiBjb25mbGF0ZSB0aGUgImJhdGNoIGluIHBw
Z3R0IiBiaXQgd2l0aCB0aGUgIm5vbi1zZWN1cmUKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

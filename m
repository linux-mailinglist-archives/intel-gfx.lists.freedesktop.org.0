Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 14895E317
	for <lists+intel-gfx@lfdr.de>; Mon, 29 Apr 2019 14:53:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DCCD3892EE;
	Mon, 29 Apr 2019 12:52:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C7BA4892EE
 for <intel-gfx@lists.freedesktop.org>; Mon, 29 Apr 2019 12:52:56 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16395645-1500050 
 for multiple; Mon, 29 Apr 2019 13:52:46 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 29 Apr 2019 13:52:45 +0100
Message-Id: <20190429125245.1437-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190429080159.12356-2-chris@chris-wilson.co.uk>
References: <20190429080159.12356-2-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Only reschedule the submission
 tasklet if preemption is possible
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgY291cGxlIHRoZSBzY2hlZHVsZXIgbW9yZSB0aWdodGx5IHdpdGggdGhlIGV4ZWNsaXN0
cyBwb2xpY3ksIHdlCmNhbiBhcHBseSB0aGUgcHJlZW1wdGlvbiBwb2xpY3kgdG8gdGhlIHF1ZXN0
aW9uIG9mIHdoZXRoZXIgd2UgbmVlZCB0bwpraWNrIHRoZSB0YXNrbGV0IGF0IGFsbCBmb3IgdGhp
cyBwcmlvcml0eSBidW1wLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJp
cy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIHwgIDUgKysr
KysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jICAgIHwgIDIgLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMgIHwgMTggKysrKysrKysrKystLS0tLS0t
CiAzIGZpbGVzIGNoYW5nZWQsIDE2IGluc2VydGlvbnMoKyksIDkgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCA4NDUzOGY2OTE4NWIuLjM3ZWQz
NTQ1OTk3MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJj
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTY0NSw3
ICs2NDUsMTIgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15X3JlcXVlc3Qoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiBzdGF0aWMgdm9pZCBkdW1teV9yZXF1ZXN0
X2ZyZWUoc3RydWN0IGk5MTVfcmVxdWVzdCAqZHVtbXkpCiB7CisJLyogV2UgaGF2ZSB0byBmYWtl
IHRoZSBDUyBpbnRlcnJ1cHQgdG8ga2ljayB0aGUgbmV4dCByZXF1ZXN0ICovCisJdGFza2xldF9o
aV9zY2hlZHVsZSgmZHVtbXktPmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOworCiAJaTkxNV9y
ZXF1ZXN0X21hcmtfY29tcGxldGUoZHVtbXkpOworCWRtYV9mZW5jZV9zaWduYWwoJmR1bW15LT5m
ZW5jZSk7CisKIAlpOTE1X3NjaGVkX25vZGVfZmluaSgmZHVtbXktPnNjaGVkKTsKIAlpOTE1X3N3
X2ZlbmNlX2ZpbmkoJmR1bW15LT5zdWJtaXQpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVz
dC5jCmluZGV4IGFmOGM5ZmE1ZTA2Ni4uMmUyMmRhNjZhNTZjIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuYwpAQCAtMTM1OCw5ICsxMzU4LDcgQEAgbG9uZyBpOTE1X3JlcXVlc3Rfd2Fp
dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAlpZiAoZmxhZ3MgJiBJOTE1X1dBSVRfUFJJT1JJ
VFkpIHsKIAkJaWYgKCFpOTE1X3JlcXVlc3Rfc3RhcnRlZChycSkgJiYgSU5URUxfR0VOKHJxLT5p
OTE1KSA+PSA2KQogCQkJZ2VuNl9ycHNfYm9vc3QocnEpOwotCQlsb2NhbF9iaF9kaXNhYmxlKCk7
IC8qIHN1c3BlbmQgdGFza2xldHMgZm9yIHJlcHJpb3JpdGlzYXRpb24gKi8KIAkJaTkxNV9zY2hl
ZHVsZV9idW1wX3ByaW9yaXR5KHJxLCBJOTE1X1BSSU9SSVRZX1dBSVQpOwotCQlsb2NhbF9iaF9l
bmFibGUoKTsgLyoga2ljayB0YXNrbGV0cyBlbiBtYXNzZSAqLwogCX0KIAogCXdhaXQudHNrID0g
Y3VycmVudDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVy
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCmluZGV4IDM5YmM0ZjU0
ZTI3Mi4uNDkxMzQxODM4N2JlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMK
QEAgLTI2MSwxNiArMjYxLDIwIEBAIHNjaGVkX2xvY2tfZW5naW5lKGNvbnN0IHN0cnVjdCBpOTE1
X3NjaGVkX25vZGUgKm5vZGUsCiAJcmV0dXJuIGVuZ2luZTsKIH0KIAotc3RhdGljIGJvb2wgaW5m
bGlnaHQoY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0JCSAgICAgY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQorc3RhdGljIGlubGluZSBpbnQgcnFfcHJpbyhjb25z
dCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQljb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICphY3RpdmU7CisJcmV0dXJuIHJxLT5zY2hlZC5hdHRyLnByaW9yaXR5IHwgX19OT19QUkVFTVBU
SU9OOworfQorCitzdGF0aWMgYm9vbCBraWNrX3Rhc2tsZXQoY29uc3Qgc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lLCBpbnQgcHJpbykKK3sKKwljb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICppbmZsaWdodCA9CisJCXBvcnRfcmVxdWVzdChlbmdpbmUtPmV4ZWNsaXN0cy5wb3J0KTsKIAot
CWlmICghaTkxNV9yZXF1ZXN0X2lzX2FjdGl2ZShycSkpCisJaWYgKCFpbmZsaWdodCkKIAkJcmV0
dXJuIGZhbHNlOwogCi0JYWN0aXZlID0gcG9ydF9yZXF1ZXN0KGVuZ2luZS0+ZXhlY2xpc3RzLnBv
cnQpOwotCXJldHVybiBhY3RpdmUtPmh3X2NvbnRleHQgPT0gcnEtPmh3X2NvbnRleHQ7CisJcmV0
dXJuIF9fZXhlY2xpc3RzX25lZWRfcHJlZW1wdChwcmlvLCBycV9wcmlvKGluZmxpZ2h0KSk7CiB9
CiAKIHN0YXRpYyB2b2lkIF9faTkxNV9zY2hlZHVsZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwK
QEAgLTQwMCw3ICs0MDQsNyBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfc2NoZWR1bGUoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsCiAJCSAqIElmIHdlIGFyZSBhbHJlYWR5IHRoZSBjdXJyZW50bHkgZXhl
Y3V0aW5nIGNvbnRleHQsIGRvbid0CiAJCSAqIGJvdGhlciBldmFsdWF0aW5nIGlmIHdlIHNob3Vs
ZCBwcmVlbXB0IG91cnNlbHZlcy4KIAkJICovCi0JCWlmIChpbmZsaWdodChub2RlX3RvX3JlcXVl
c3Qobm9kZSksIGVuZ2luZSkpCisJCWlmICgha2lja190YXNrbGV0KGVuZ2luZSwgcHJpbykpCiAJ
CQljb250aW51ZTsKIAogCQkvKiBEZWZlciAodGFza2xldCkgc3VibWlzc2lvbiB1bnRpbCBhZnRl
ciBhbGwgb2Ygb3VyIHVwZGF0ZXMuICovCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

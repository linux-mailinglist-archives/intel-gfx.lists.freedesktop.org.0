Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0CFD8607E2
	for <lists+intel-gfx@lfdr.de>; Fri,  5 Jul 2019 16:29:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5C2796E4DD;
	Fri,  5 Jul 2019 14:29:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C47FC6E4D2
 for <intel-gfx@lists.freedesktop.org>; Fri,  5 Jul 2019 14:29:26 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Jul 2019 07:29:26 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,455,1557212400"; d="scan'208";a="363191497"
Received: from rosetta.fi.intel.com ([10.237.72.194])
 by fmsmga005.fm.intel.com with ESMTP; 05 Jul 2019 07:29:25 -0700
Received: by rosetta.fi.intel.com (Postfix, from userid 1000)
 id 71BA584028D; Fri,  5 Jul 2019 17:29:09 +0300 (EEST)
From: Mika Kuoppala <mika.kuoppala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  5 Jul 2019 17:29:05 +0300
Message-Id: <20190705142908.4921-1-mika.kuoppala@linux.intel.com>
X-Mailer: git-send-email 2.17.1
Subject: [Intel-gfx] [PATCH 1/4] drm/i915/gtt: pde entry encoding is
 identical
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yIGFsbCBwYWdlIGRpcmVjdG9yeSBlbnRyaWVzLCB0aGUgcGRlIGVuY29kaW5nIGlzCmlkZW50
aWNhbC4gRG9uJ3QgY29tcGlsaWNhdGUgY2FsbCBzaXRlcyB3aXRoIGRpZmZlcmVudAp2ZXJzaW9u
cyBvZiBkb2luZyB0aGUgc2FtZSB0aGluZy4gV2UgY2hlY2sgdGhlIGV4aXN0ZW5jZSBvZgpwaHlz
aWNhbCBwYWdlIGJlZm9yZSB3cml0aW5nIHRoZSBlbnRyeSBpbnRvIGl0LiBUaGlzIGZ1cnRoZXIK
Z2VuZXJhbGl6ZXMgdGhlIHBkIHNvIHRoYXQgbWFuaXB1bGF0aW9uIGluIGNhbGxzaXRlcyB3aWxs
IGJlCmlkZW50aWNhbCwgcmVtb3ZpbmcgdGhlIG5lZWQgdG8gaGFuZGxlIHBkcHMgZGlmZmVyZW50
bHkgZm9yIGdlbjguCgp2Mjogc3F1YXNoCnYzOiBpbmMvZGVjIHdpdGggc2V0L2NsZWFyIChDaHJp
cykKdjQ6IGlubGluZXMsIHdhcm4sIHN0cmF5IHNldF9wZCAoQ2hyaXMpCgpDYzogQ2hyaXMgV2ls
c29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcu
YXVsZEBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IE1pa2EgS3VvcHBhbGEgPG1pa2Eua3VvcHBh
bGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jIHwgMTUyICsrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5oIHwgICAzIC0KIDIgZmlsZXMgY2hhbmdlZCwgNjMgaW5zZXJ0aW9u
cygrKSwgOTIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRl
eCA1N2RiMmQ3MjcwYzUuLmFkZjZlYWRkNTAwOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmMKQEAgLTIxMSwxMCArMjExLDEwIEBAIHN0YXRpYyB1NjQgZ2VuOF9wdGVfZW5jb2RlKGRt
YV9hZGRyX3QgYWRkciwKIAlyZXR1cm4gcHRlOwogfQogCi1zdGF0aWMgZ2VuOF9wZGVfdCBnZW44
X3BkZV9lbmNvZGUoY29uc3QgZG1hX2FkZHJfdCBhZGRyLAotCQkJCSAgY29uc3QgZW51bSBpOTE1
X2NhY2hlX2xldmVsIGxldmVsKQorc3RhdGljIHU2NCBnZW44X3BkZV9lbmNvZGUoY29uc3QgZG1h
X2FkZHJfdCBhZGRyLAorCQkJICAgY29uc3QgZW51bSBpOTE1X2NhY2hlX2xldmVsIGxldmVsKQog
ewotCWdlbjhfcGRlX3QgcGRlID0gX1BBR0VfUFJFU0VOVCB8IF9QQUdFX1JXOworCXU2NCBwZGUg
PSBfUEFHRV9QUkVTRU5UIHwgX1BBR0VfUlc7CiAJcGRlIHw9IGFkZHI7CiAJaWYgKGxldmVsICE9
IEk5MTVfQ0FDSEVfTk9ORSkKIAkJcGRlIHw9IFBQQVRfQ0FDSEVEX1BERTsKQEAgLTIyMyw5ICsy
MjMsNiBAQCBzdGF0aWMgZ2VuOF9wZGVfdCBnZW44X3BkZV9lbmNvZGUoY29uc3QgZG1hX2FkZHJf
dCBhZGRyLAogCXJldHVybiBwZGU7CiB9CiAKLSNkZWZpbmUgZ2VuOF9wZHBlX2VuY29kZSBnZW44
X3BkZV9lbmNvZGUKLSNkZWZpbmUgZ2VuOF9wbWw0ZV9lbmNvZGUgZ2VuOF9wZGVfZW5jb2RlCi0K
IHN0YXRpYyB1NjQgc25iX3B0ZV9lbmNvZGUoZG1hX2FkZHJfdCBhZGRyLAogCQkJICBlbnVtIGk5
MTVfY2FjaGVfbGV2ZWwgbGV2ZWwsCiAJCQkgIHUzMiBmbGFncykKQEAgLTc3NywyNCArNzc0LDU1
IEBAIHN0YXRpYyB2b2lkIGZyZWVfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJ
a2ZyZWUocGQpOwogfQogCi1zdGF0aWMgdm9pZCBpbml0X3BkX3dpdGhfcGFnZShzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSwKLQkJCSAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5
ICogY29uc3QgcGQsCi0JCQkgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX3RhYmxlICpwdCkKKyNkZWZp
bmUgaW5pdF9wZCh2bSwgcGQsIHRvKSB7CQkJCQlcCisJR0VNX0RFQlVHX0JVR19PTighcGRfaGFz
X3BoeXNfcGFnZShwZCkpOwkJXAorCWZpbGxfcHgoKHZtKSwgKHBkKSwgZ2VuOF9wZGVfZW5jb2Rl
KHB4X2RtYSh0byksIEk5MTVfQ0FDSEVfTExDKSk7IFwKKwltZW1zZXRfcCgocGQpLT5lbnRyeSwg
KHRvKSwgNTEyKTsJCQkJXAorfQorCitzdGF0aWMgaW5saW5lIHZvaWQKK3dyaXRlX2RtYV9lbnRy
eShzdHJ1Y3QgaTkxNV9wYWdlX2RtYSAqIGNvbnN0IHBkbWEsCisJCWNvbnN0IHVuc2lnbmVkIHNo
b3J0IHBkZSwKKwkJY29uc3QgdTY0IGVuY29kZWRfZW50cnkpCit7CisJdTY0ICogY29uc3QgdmFk
ZHIgPSBrbWFwX2F0b21pYyhwZG1hLT5wYWdlKTsKKworCXZhZGRyW3BkZV0gPSBlbmNvZGVkX2Vu
dHJ5OworCWt1bm1hcF9hdG9taWModmFkZHIpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQKK19f
c2V0X3BkX2VudHJ5KHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGQsCisJICAg
ICAgIGNvbnN0IHVuc2lnbmVkIHNob3J0IHBkZSwKKwkgICAgICAgc3RydWN0IGk5MTVfcGFnZV9k
bWEgKiBjb25zdCB0bywKKwkgICAgICAgdTY0ICgqZW5jb2RlKShjb25zdCBkbWFfYWRkcl90LCBj
b25zdCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwpKQogewotCWZpbGxfcHgodm0sIHBkLCBnZW44X3Bk
ZV9lbmNvZGUocHhfZG1hKHB0KSwgSTkxNV9DQUNIRV9MTEMpKTsKLQltZW1zZXRfcChwZC0+ZW50
cnksIHB0LCA1MTIpOworCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnBkLT51c2VkKSA+IDUxMik7
CisKKwlhdG9taWNfaW5jKCZwZC0+dXNlZCk7CisJcGQtPmVudHJ5W3BkZV0gPSB0bzsKKwl3cml0
ZV9kbWFfZW50cnkocHhfYmFzZShwZCksIHBkZSwgZW5jb2RlKHRvLT5kYWRkciwgSTkxNV9DQUNI
RV9MTEMpKTsKIH0KIAotc3RhdGljIHZvaWQgaW5pdF9wZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSwKLQkJICAgIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGQsCi0J
CSAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqIGNvbnN0IHRvKQorc3RhdGljIGlubGlu
ZSB2b2lkCitfX2NsZWFyX3BkX2VudHJ5KHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29u
c3QgcGQsCisJCSBjb25zdCB1bnNpZ25lZCBzaG9ydCBwZGUsCisJCSBzdHJ1Y3QgaTkxNV9wYWdl
X2RtYSAqIGNvbnN0IHRvLAorCQkgdTY0ICgqZW5jb2RlKShjb25zdCBkbWFfYWRkcl90LCBjb25z
dCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwpKQogewotCUdFTV9ERUJVR19CVUdfT04oIXBkX2hhc19w
aHlzX3BhZ2UocGQpKTsKKwlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZwZC0+dXNlZCkgPT0gMCk7
CiAKLQlmaWxsX3B4KHZtLCBwZCwgZ2VuOF9wZHBlX2VuY29kZShweF9kbWEodG8pLCBJOTE1X0NB
Q0hFX0xMQykpOwotCW1lbXNldF9wKHBkLT5lbnRyeSwgdG8sIDUxMik7CisJd3JpdGVfZG1hX2Vu
dHJ5KHB4X2Jhc2UocGQpLCBwZGUsIGVuY29kZSh0by0+ZGFkZHIsIEk5MTVfQ0FDSEVfTExDKSk7
CisJcGQtPmVudHJ5W3BkZV0gPSB0bzsKKwlhdG9taWNfZGVjKCZwZC0+dXNlZCk7CiB9CiAKKyNk
ZWZpbmUgc2V0X3BkX2VudHJ5KHBkLCBwZGUsIHRvKSBcCisJX19zZXRfcGRfZW50cnkoKHBkKSwg
KHBkZSksIHB4X2Jhc2UodG8pLCBnZW44X3BkZV9lbmNvZGUpCisKKyNkZWZpbmUgY2xlYXJfcGRf
ZW50cnkocGQsIHBkZSwgdG8pIFwKKwlfX2NsZWFyX3BkX2VudHJ5KChwZCksIChwZGUpLCBweF9i
YXNlKHRvKSwgZ2VuOF9wZGVfZW5jb2RlKQorCiAvKgogICogUERFIFRMQnMgYXJlIGEgcGFpbiB0
byBpbnZhbGlkYXRlIG9uIEdFTjgrLiBXaGVuIHdlIG1vZGlmeQogICogdGhlIHBhZ2UgdGFibGUg
c3RydWN0dXJlcywgd2UgbWFyayB0aGVtIGRpcnR5IHNvIHRoYXQKQEAgLTgyNCwxOCArODUyLDYg
QEAgc3RhdGljIGJvb2wgZ2VuOF9wcGd0dF9jbGVhcl9wdChjb25zdCBzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSwKIAlyZXR1cm4gIWF0b21pY19zdWJfcmV0dXJuKG51bV9lbnRyaWVzLCAm
cHQtPnVzZWQpOwogfQogCi1zdGF0aWMgdm9pZCBnZW44X3BwZ3R0X3NldF9wZGUoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sCi0JCQkgICAgICAgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rv
cnkgKnBkLAotCQkJICAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0LAotCQkJICAgICAg
IHVuc2lnbmVkIGludCBwZGUpCi17Ci0JZ2VuOF9wZGVfdCAqdmFkZHI7Ci0KLQl2YWRkciA9IGtt
YXBfYXRvbWljX3B4KHBkKTsKLQl2YWRkcltwZGVdID0gZ2VuOF9wZGVfZW5jb2RlKHB4X2RtYShw
dCksIEk5MTVfQ0FDSEVfTExDKTsKLQlrdW5tYXBfYXRvbWljKHZhZGRyKTsKLX0KLQogc3RhdGlj
IGJvb2wgZ2VuOF9wcGd0dF9jbGVhcl9wZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwK
IAkJCQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqcGQsCiAJCQkJdTY0IHN0YXJ0LCB1NjQg
bGVuZ3RoKQpAQCAtODUzLDExICs4NjksNyBAQCBzdGF0aWMgYm9vbCBnZW44X3BwZ3R0X2NsZWFy
X3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCiAJCXNwaW5fbG9jaygmcGQtPmxv
Y2spOwogCQlpZiAoIWF0b21pY19yZWFkKCZwdC0+dXNlZCkpIHsKLQkJCWdlbjhfcHBndHRfc2V0
X3BkZSh2bSwgcGQsIHZtLT5zY3JhdGNoX3B0LCBwZGUpOwotCQkJcGQtPmVudHJ5W3BkZV0gPSB2
bS0+c2NyYXRjaF9wdDsKLQotCQkJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnBkLT51c2VkKSk7
Ci0JCQlhdG9taWNfZGVjKCZwZC0+dXNlZCk7CisJCQljbGVhcl9wZF9lbnRyeShwZCwgcGRlLCB2
bS0+c2NyYXRjaF9wdCk7CiAJCQlmcmVlID0gdHJ1ZTsKIAkJfQogCQlzcGluX3VubG9jaygmcGQt
PmxvY2spOwpAQCAtODY4LDIwICs4ODAsNiBAQCBzdGF0aWMgYm9vbCBnZW44X3BwZ3R0X2NsZWFy
X3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXJldHVybiAhYXRvbWljX3JlYWQo
JnBkLT51c2VkKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9zZXRfcGRwZShzdHJ1Y3Qg
aTkxNV9wYWdlX2RpcmVjdG9yeSAqcGRwLAotCQkJCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5
ICpwZCwKLQkJCQl1bnNpZ25lZCBpbnQgcGRwZSkKLXsKLQlnZW44X3BwZ3R0X3BkcGVfdCAqdmFk
ZHI7Ci0KLQlpZiAoIXBkX2hhc19waHlzX3BhZ2UocGRwKSkKLQkJcmV0dXJuOwotCi0JdmFkZHIg
PSBrbWFwX2F0b21pY19weChwZHApOwotCXZhZGRyW3BkcGVdID0gZ2VuOF9wZHBlX2VuY29kZShw
eF9kbWEocGQpLCBJOTE1X0NBQ0hFX0xMQyk7Ci0Ja3VubWFwX2F0b21pYyh2YWRkcik7Ci19Ci0K
IC8qIFJlbW92ZXMgZW50cmllcyBmcm9tIGEgc2luZ2xlIHBhZ2UgZGlyIHBvaW50ZXIsIHJlbGVh
c2luZyBpdCBpZiBpdCdzIGVtcHR5LgogICogQ2FsbGVyIGNhbiB1c2UgdGhlIHJldHVybiB2YWx1
ZSB0byB1cGRhdGUgaGlnaGVyLWxldmVsIGVudHJpZXMKICAqLwpAQCAtOTAyLDExICs5MDAsNyBA
QCBzdGF0aWMgYm9vbCBnZW44X3BwZ3R0X2NsZWFyX3BkcChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSwKIAogCQlzcGluX2xvY2soJnBkcC0+bG9jayk7CiAJCWlmICghYXRvbWljX3JlYWQo
JnBkLT51c2VkKSkgewotCQkJZ2VuOF9wcGd0dF9zZXRfcGRwZShwZHAsIHZtLT5zY3JhdGNoX3Bk
LCBwZHBlKTsKLQkJCXBkcC0+ZW50cnlbcGRwZV0gPSB2bS0+c2NyYXRjaF9wZDsKLQotCQkJR0VN
X0JVR19PTighYXRvbWljX3JlYWQoJnBkcC0+dXNlZCkpOwotCQkJYXRvbWljX2RlYygmcGRwLT51
c2VkKTsKKwkJCWNsZWFyX3BkX2VudHJ5KHBkcCwgcGRwZSwgdm0tPnNjcmF0Y2hfcGQpOwogCQkJ
ZnJlZSA9IHRydWU7CiAJCX0KIAkJc3Bpbl91bmxvY2soJnBkcC0+bG9jayk7CkBAIC05MjMsMTcg
KzkxNyw2IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYXJfM2x2bChzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwKIAlnZW44X3BwZ3R0X2NsZWFyX3BkcCh2bSwgaTkxNV92bV90b19w
cGd0dCh2bSktPnBkLCBzdGFydCwgbGVuZ3RoKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuOF9wcGd0
dF9zZXRfcG1sNGUoc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBtbDQsCi0JCQkJIHN0cnVj
dCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZHAsCi0JCQkJIHVuc2lnbmVkIGludCBwbWw0ZSkKLXsK
LQlnZW44X3BwZ3R0X3BtbDRlX3QgKnZhZGRyOwotCi0JdmFkZHIgPSBrbWFwX2F0b21pY19weChw
bWw0KTsKLQl2YWRkcltwbWw0ZV0gPSBnZW44X3BtbDRlX2VuY29kZShweF9kbWEocGRwKSwgSTkx
NV9DQUNIRV9MTEMpOwotCWt1bm1hcF9hdG9taWModmFkZHIpOwotfQotCiAvKiBSZW1vdmVzIGVu
dHJpZXMgZnJvbSBhIHNpbmdsZSBwbWw0LgogICogVGhpcyBpcyB0aGUgdG9wLWxldmVsIHN0cnVj
dHVyZSBpbiA0LWxldmVsIHBhZ2UgdGFibGVzIHVzZWQgb24gZ2VuOCsuCiAgKiBFbXB0eSBlbnRy
aWVzIGFyZSBhbHdheXMgc2NyYXRjaCBwbWw0ZS4KQEAgLTk1Nyw4ICs5NDAsNyBAQCBzdGF0aWMg
dm9pZCBnZW44X3BwZ3R0X2NsZWFyXzRsdmwoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
CiAKIAkJc3Bpbl9sb2NrKCZwbWw0LT5sb2NrKTsKIAkJaWYgKCFhdG9taWNfcmVhZCgmcGRwLT51
c2VkKSkgewotCQkJZ2VuOF9wcGd0dF9zZXRfcG1sNGUocG1sNCwgdm0tPnNjcmF0Y2hfcGRwLCBw
bWw0ZSk7Ci0JCQlwbWw0LT5lbnRyeVtwbWw0ZV0gPSB2bS0+c2NyYXRjaF9wZHA7CisJCQljbGVh
cl9wZF9lbnRyeShwbWw0LCBwbWw0ZSwgdm0tPnNjcmF0Y2hfcGRwKTsKIAkJCWZyZWUgPSB0cnVl
OwogCQl9CiAJCXNwaW5fdW5sb2NrKCZwbWw0LT5sb2NrKTsKQEAgLTEyNzUsNyArMTI1Nyw3IEBA
IHN0YXRpYyBpbnQgZ2VuOF9pbml0X3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0pCiAJfQogCiAJZ2VuOF9pbml0aWFsaXplX3B0KHZtLCB2bS0+c2NyYXRjaF9wdCk7Ci0JaW5p
dF9wZF93aXRoX3BhZ2Uodm0sIHZtLT5zY3JhdGNoX3BkLCB2bS0+c2NyYXRjaF9wdCk7CisJaW5p
dF9wZCh2bSwgdm0tPnNjcmF0Y2hfcGQsIHZtLT5zY3JhdGNoX3B0KTsKIAlpZiAoaTkxNV92bV9p
c180bHZsKHZtKSkKIAkJaW5pdF9wZCh2bSwgdm0tPnNjcmF0Y2hfcGRwLCB2bS0+c2NyYXRjaF9w
ZCk7CiAKQEAgLTEyOTgsNiArMTI4MCwxMSBAQCBzdGF0aWMgaW50IGdlbjhfcHBndHRfbm90aWZ5
X3ZndChzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQsIGJvb2wgY3JlYXRlKQogCWVudW0gdmd0X2cy
dl90eXBlIG1zZzsKIAlpbnQgaTsKIAorCWlmIChjcmVhdGUpCisJCWF0b21pY19pbmMoJnBwZ3R0
LT5wZC0+dXNlZCk7IC8qIG5ldmVyIHJlbW92ZSAqLworCWVsc2UKKwkJYXRvbWljX2RlYygmcHBn
dHQtPnBkLT51c2VkKTsKKwogCWlmIChpOTE1X3ZtX2lzXzRsdmwodm0pKSB7CiAJCWNvbnN0IHU2
NCBkYWRkciA9IHB4X2RtYShwcGd0dC0+cGQpOwogCkBAIC0xNDE0LDkgKzE0MDEsNyBAQCBzdGF0
aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
CiAKIAkJCXNwaW5fbG9jaygmcGQtPmxvY2spOwogCQkJaWYgKHBkLT5lbnRyeVtwZGVdID09IHZt
LT5zY3JhdGNoX3B0KSB7Ci0JCQkJZ2VuOF9wcGd0dF9zZXRfcGRlKHZtLCBwZCwgcHQsIHBkZSk7
Ci0JCQkJcGQtPmVudHJ5W3BkZV0gPSBwdDsKLQkJCQlhdG9taWNfaW5jKCZwZC0+dXNlZCk7CisJ
CQkJc2V0X3BkX2VudHJ5KHBkLCBwZGUsIHB0KTsKIAkJCX0gZWxzZSB7CiAJCQkJYWxsb2MgPSBw
dDsKIAkJCQlwdCA9IHBkLT5lbnRyeVtwZGVdOwpAQCAtMTQ1OCwxMyArMTQ0MywxMSBAQCBzdGF0
aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfcGRwKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
LAogCQkJCWdvdG8gdW53aW5kOwogCQkJfQogCi0JCQlpbml0X3BkX3dpdGhfcGFnZSh2bSwgcGQs
IHZtLT5zY3JhdGNoX3B0KTsKKwkJCWluaXRfcGQodm0sIHBkLCB2bS0+c2NyYXRjaF9wdCk7CiAK
IAkJCXNwaW5fbG9jaygmcGRwLT5sb2NrKTsKIAkJCWlmIChwZHAtPmVudHJ5W3BkcGVdID09IHZt
LT5zY3JhdGNoX3BkKSB7Ci0JCQkJZ2VuOF9wcGd0dF9zZXRfcGRwZShwZHAsIHBkLCBwZHBlKTsK
LQkJCQlwZHAtPmVudHJ5W3BkcGVdID0gcGQ7Ci0JCQkJYXRvbWljX2luYygmcGRwLT51c2VkKTsK
KwkJCQlzZXRfcGRfZW50cnkocGRwLCBwZHBlLCBwZCk7CiAJCQl9IGVsc2UgewogCQkJCWFsbG9j
ID0gcGQ7CiAJCQkJcGQgPSBwZHAtPmVudHJ5W3BkcGVdOwpAQCAtMTQ5MCwxMiArMTQ3Myw5IEBA
IHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19wZHAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0sCiAJfQogCXNwaW5fbG9jaygmcGRwLT5sb2NrKTsKIAlpZiAoYXRvbWljX2RlY19hbmRf
dGVzdCgmcGQtPnVzZWQpKSB7Ci0JCWdlbjhfcHBndHRfc2V0X3BkcGUocGRwLCB2bS0+c2NyYXRj
aF9wZCwgcGRwZSk7Ci0JCXBkcC0+ZW50cnlbcGRwZV0gPSB2bS0+c2NyYXRjaF9wZDsKLQkJR0VN
X0JVR19PTighYXRvbWljX3JlYWQoJnBkcC0+dXNlZCkpOwotCQlhdG9taWNfZGVjKCZwZHAtPnVz
ZWQpOwogCQlHRU1fQlVHX09OKGFsbG9jKTsKIAkJYWxsb2MgPSBwZDsgLyogZGVmZXIgdGhlIGZy
ZWUgdG8gYWZ0ZXIgdGhlIGxvY2sgKi8KKwkJY2xlYXJfcGRfZW50cnkocGRwLCBwZHBlLCB2bS0+
c2NyYXRjaF9wZCk7CiAJfQogCXNwaW5fdW5sb2NrKCZwZHAtPmxvY2spOwogdW53aW5kOgpAQCAt
MTU0MCw4ICsxNTIwLDcgQEAgc3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9jXzRsdmwoc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAKIAkJCXNwaW5fbG9jaygmcG1sNC0+bG9jayk7CiAJ
CQlpZiAocG1sNC0+ZW50cnlbcG1sNGVdID09IHZtLT5zY3JhdGNoX3BkcCkgewotCQkJCWdlbjhf
cHBndHRfc2V0X3BtbDRlKHBtbDQsIHBkcCwgcG1sNGUpOwotCQkJCXBtbDQtPmVudHJ5W3BtbDRl
XSA9IHBkcDsKKwkJCQlzZXRfcGRfZW50cnkocG1sNCwgcG1sNGUsIHBkcCk7CiAJCQl9IGVsc2Ug
ewogCQkJCWFsbG9jID0gcGRwOwogCQkJCXBkcCA9IHBtbDQtPmVudHJ5W3BtbDRlXTsKQEAgLTE1
NjcsMTAgKzE1NDYsOSBAQCBzdGF0aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfNGx2bChzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAl9CiAJc3Bpbl9sb2NrKCZwbWw0LT5sb2NrKTsKIAlp
ZiAoYXRvbWljX2RlY19hbmRfdGVzdCgmcGRwLT51c2VkKSkgewotCQlnZW44X3BwZ3R0X3NldF9w
bWw0ZShwbWw0LCB2bS0+c2NyYXRjaF9wZHAsIHBtbDRlKTsKLQkJcG1sNC0+ZW50cnlbcG1sNGVd
ID0gdm0tPnNjcmF0Y2hfcGRwOwogCQlHRU1fQlVHX09OKGFsbG9jKTsKIAkJYWxsb2MgPSBwZHA7
IC8qIGRlZmVyIHRoZSBmcmVlIHVudGlsIGFmdGVyIHRoZSBsb2NrICovCisJCWNsZWFyX3BkX2Vu
dHJ5KHBtbDQsIHBtbDRlLCB2bS0+c2NyYXRjaF9wZHApOwogCX0KIAlzcGluX3VubG9jaygmcG1s
NC0+bG9jayk7CiB1bndpbmQ6CkBAIC0xNTk1LDIwICsxNTczLDE2IEBAIHN0YXRpYyBpbnQgZ2Vu
OF9wcmVhbGxvY2F0ZV90b3BfbGV2ZWxfcGRwKHN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCkKIAkJ
aWYgKElTX0VSUihwZCkpCiAJCQlnb3RvIHVud2luZDsKIAotCQlpbml0X3BkX3dpdGhfcGFnZSh2
bSwgcGQsIHZtLT5zY3JhdGNoX3B0KTsKLQkJZ2VuOF9wcGd0dF9zZXRfcGRwZShwZHAsIHBkLCBw
ZHBlKTsKLQotCQlhdG9taWNfaW5jKCZwZHAtPnVzZWQpOworCQlpbml0X3BkKHZtLCBwZCwgdm0t
PnNjcmF0Y2hfcHQpOworCQlzZXRfcGRfZW50cnkocGRwLCBwZHBlLCBwZCk7CiAJfQogCi0JYXRv
bWljX2luYygmcGRwLT51c2VkKTsgLyogbmV2ZXIgcmVtb3ZlICovCi0KIAlyZXR1cm4gMDsKIAog
dW53aW5kOgogCXN0YXJ0IC09IGZyb207CiAJZ2VuOF9mb3JfZWFjaF9wZHBlKHBkLCBwZHAsIGZy
b20sIHN0YXJ0LCBwZHBlKSB7Ci0JCWdlbjhfcHBndHRfc2V0X3BkcGUocGRwLCB2bS0+c2NyYXRj
aF9wZCwgcGRwZSk7CisJCWNsZWFyX3BkX2VudHJ5KHBkcCwgcGRwZSwgdm0tPnNjcmF0Y2hfcGQp
OwogCQlmcmVlX3BkKHZtLCBwZCk7CiAJfQogCWF0b21pY19zZXQoJnBkcC0+dXNlZCwgMCk7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4IGQwZTA5MDVhY2JiYi4uNTdhNjhlZjRl
ZGE3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAtNzIsOSArNzIsNiBAQCBz
dHJ1Y3QgaW50ZWxfZ3Q7CiAKIHR5cGVkZWYgdTMyIGdlbjZfcHRlX3Q7CiB0eXBlZGVmIHU2NCBn
ZW44X3B0ZV90OwotdHlwZWRlZiB1NjQgZ2VuOF9wZGVfdDsKLXR5cGVkZWYgdTY0IGdlbjhfcHBn
dHRfcGRwZV90OwotdHlwZWRlZiB1NjQgZ2VuOF9wcGd0dF9wbWw0ZV90OwogCiAjZGVmaW5lIGdn
dHRfdG90YWxfZW50cmllcyhnZ3R0KSAoKGdndHQpLT52bS50b3RhbCA+PiBQQUdFX1NISUZUKQog
Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

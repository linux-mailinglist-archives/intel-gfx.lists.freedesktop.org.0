Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E3A7FA2F7A
	for <lists+intel-gfx@lfdr.de>; Fri, 30 Aug 2019 08:12:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0971C6E248;
	Fri, 30 Aug 2019 06:12:41 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8DDD46E248
 for <intel-gfx@lists.freedesktop.org>; Fri, 30 Aug 2019 06:12:23 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18312340-1500050 
 for multiple; Fri, 30 Aug 2019 07:12:08 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 30 Aug 2019 07:11:56 +0100
Message-Id: <20190830061204.21206-13-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190830061204.21206-1-chris@chris-wilson.co.uk>
References: <20190830061204.21206-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 13/21] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAzMCAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jICAgIHwgICA4ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyAgfCAgMTEgKy0K
IC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyAgICB8ICAxMyArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwgIDIwICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICAgfCAgMTkgKy0KIC4u
Li9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8ICA0OCArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyAgICAgIHwgIDIxICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAgMzMgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCAgICB8ICAgNSArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyAgfCAgNjcgLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgICAgfCAgIDggKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYyAgICB8ICAxNSArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyAgIHwgIDI3ICstCiAuLi4vZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jICAgfCAgMjMgKy0KIC4uLi9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAxMiArLQogLi4uL2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgIHwgICAyIC0KIC4uLi9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYyAgICB8ICAgNyArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3QuYyAgICAgICAgICAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAxOSArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMgICAgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAgOTQgKysrLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgICAgIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlX3R5cGVzLmggICAgICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgODcgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZXZpY3QuYyAgICAgICAgIHwgIDIwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9mZW5jZV9yZWcuYyAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jICAgICAgICAgICB8IDEwNCArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuaCAgICAgICAgICAgfCAgMzEgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAzMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuYyAgICAgICAgICAgICAgIHwgNDc1ICsrKysrKysrKysrKy0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAgICAgICAgICAgIHwgIDU4ICstLQogLi4uL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyAgIHwgIDM2ICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAgOTEgKystLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgICAgIHwgICA4ICstCiAzNiBmaWxlcyBj
aGFuZ2VkLCA3OTkgaW5zZXJ0aW9ucygrKSwgNjU4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggYjM4ZDg0MmZmNmVjLi5m
YjBmYzZmZjBhYWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCkBAIC0yMDc5LDggKzIwNzksNiBAQCBpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAl1bnNpZ25lZCBpbnQgcGluY3RsOwogCXUzMiBh
bGlnbm1lbnQ7CiAKLQlXQVJOX09OKCFtdXRleF9pc19sb2NrZWQoJmRldi0+c3RydWN0X211dGV4
KSk7Ci0KIAlhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgMCk7CiAKIAkvKiBO
b3RlIHRoYXQgdGhlIHcvYSBhbHNvIHJlcXVpcmVzIDY0IFBURSBvZiBwYWRkaW5nIGZvbGxvd2lu
ZyB0aGUKQEAgLTIxNjEsOCArMjE1OSw2IEBAIGludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCiB2b2lkIGludGVsX3VucGluX2ZiX3ZtYShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBmbGFncykKIHsKLQlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfZ2VtX29i
amVjdF9sb2NrKHZtYS0+b2JqKTsKIAlpZiAoZmxhZ3MgJiBQTEFORV9IQVNfRkVOQ0UpCiAJCWk5
MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CkBAIC0zMDYzLDEyICszMDU5LDEwIEBAIGludGVsX2Fs
bG9jX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQlyZXR1cm4g
ZmFsc2U7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCW9iaiA9IGk5
MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoZGV2X3ByaXYsCiAJ
CQkJCQkJICAgICBiYXNlX2FsaWduZWQsCiAJCQkJCQkJICAgICBiYXNlX2FsaWduZWQsCiAJCQkJ
CQkJICAgICBzaXplX2FsaWduZWQpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgp
OwogCWlmICghb2JqKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTMyMzAsMTMgKzMyMjQsMTEgQEAg
aW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0
YywKIAlpbnRlbF9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlID0KIAkJaW50ZWxfZmJfcGl0
Y2goZmIsIDAsIGludGVsX3N0YXRlLT5iYXNlLnJvdGF0aW9uKTsKIAotCW11dGV4X2xvY2soJmRl
di0+c3RydWN0X211dGV4KTsKIAlpbnRlbF9zdGF0ZS0+dm1hID0KIAkJaW50ZWxfcGluX2FuZF9m
ZW5jZV9mYl9vYmooZmIsCiAJCQkJCSAgICZpbnRlbF9zdGF0ZS0+dmlldywKIAkJCQkJICAgaW50
ZWxfcGxhbmVfdXNlc19mZW5jZShpbnRlbF9zdGF0ZSksCiAJCQkJCSAgICZpbnRlbF9zdGF0ZS0+
ZmxhZ3MpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIo
aW50ZWxfc3RhdGUtPnZtYSkpIHsKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gcGluIGJvb3QgZmIg
b24gcGlwZSAlZDogJWxpXG4iLAogCQkJICBpbnRlbF9jcnRjLT5waXBlLCBQVFJfRVJSKGludGVs
X3N0YXRlLT52bWEpKTsKQEAgLTE0MzYxLDggKzE0MzUzLDYgQEAgc3RhdGljIHZvaWQgZmJfb2Jq
X2J1bXBfcmVuZGVyX3ByaW9yaXR5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAg
KiBiaXRzLiAgU29tZSBvbGRlciBwbGF0Zm9ybXMgbmVlZCBzcGVjaWFsIHBoeXNpY2FsIGFkZHJl
c3MgaGFuZGxpbmcgZm9yCiAgKiBjdXJzb3IgcGxhbmVzLgogICoKLSAqIE11c3QgYmUgY2FsbGVk
IHdpdGggc3RydWN0X211dGV4IGhlbGQuCi0gKgogICogUmV0dXJucyAwIG9uIHN1Y2Nlc3MsIG5l
Z2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAqLwogaW50CkBAIC0xNDQxOSwxNSArMTQ0
MDksOCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAog
CWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KSB7Ci0JCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotCQlyZXR1cm4gcmV0OwotCX0KLQogCXJldCA9IGlu
dGVsX3BsYW5lX3Bpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShuZXdfc3RhdGUpKTsKIAotCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9wYWdlcyhvYmopOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC0xNDQ3Niw4
ICsxNDQ1OSw2IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxh
bmUsCiAgKiBAb2xkX3N0YXRlOiB0aGUgc3RhdGUgZnJvbSB0aGUgcHJldmlvdXMgbW9kZXNldAog
ICoKICAqIENsZWFucyB1cCBhIGZyYW1lYnVmZmVyIHRoYXQgaGFzIGp1c3QgYmVlbiByZW1vdmVk
IGZyb20gYSBwbGFuZS4KLSAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVjdF9tdXRleCBo
ZWxkLgogICovCiB2b2lkCiBpbnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUg
KnBsYW5lLApAQCAtMTQ0OTMsOSArMTQ0NzQsNyBAQCBpbnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0
cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCX0KIAogCS8qIFNob3VsZCBvbmx5IGJlIGNhbGxlZCBh
ZnRlciBhIHN1Y2Nlc3NmdWwgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYigpISAqLwotCW11dGV4X2xv
Y2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlpbnRlbF9wbGFuZV91bnBpbl9mYih0
b19pbnRlbF9wbGFuZV9zdGF0ZShvbGRfc3RhdGUpKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKIH0KIAogaW50CkBAIC0xNDY5NSw3ICsxNDY3NCw2IEBAIGlu
dGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQkJICAg
dTMyIHNyY193LCB1MzIgc3JjX2gsCiAJCQkgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9j
dHggKmN0eCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmRldik7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRlLCAq
bmV3X3BsYW5lX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwbGFuZSk7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUg
PQpAQCAtMTQ3NjEsMTMgKzE0NzM5LDkgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3Ry
dWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkKIAkJZ290byBvdXRfZnJlZTsKIAotCXJl
dCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X2ZyZWU7Ci0KIAlyZXQgPSBpbnRlbF9wbGFuZV9waW5f
ZmIodG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5lX3N0YXRlKSk7CiAJaWYgKHJldCkKLQkJ
Z290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9mcmVlOwogCiAJaW50ZWxfZnJvbnRidWZmZXJf
Zmx1c2godG9faW50ZWxfZnJvbnRidWZmZXIoZmIpLCBPUklHSU5fRkxJUCk7CiAJaW50ZWxfZnJv
bnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRidWZmZXIob2xkX3BsYW5lX3N0YXRlLT5mYiks
CkBAIC0xNDc5Nyw4ICsxNDc3MSw2IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVj
dCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJaW50ZWxfcGxhbmVfdW5waW5fZmIodG9faW50ZWxfcGxh
bmVfc3RhdGUob2xkX3BsYW5lX3N0YXRlKSk7CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfZnJlZToKIAlpZiAobmV3X2NydGNf
c3RhdGUpCiAJCWludGVsX2NydGNfZGVzdHJveV9zdGF0ZShjcnRjLCAmbmV3X2NydGNfc3RhdGUt
PmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9m
YmRldi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCmluZGV4
IGQ1OWVlZTVjNWQ5Yy4uYTNkZWEzZjJkYWNkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9mYmRldi5jCkBAIC0yMDQsNyArMjA0LDYgQEAgc3RhdGljIGludCBpbnRlbGZi
X2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCQlzaXplcy0+ZmJfaGVpZ2h0
ID0gaW50ZWxfZmItPmJhc2UuaGVpZ2h0OwogCX0KIAotCW11dGV4X2xvY2soJmRldi0+c3RydWN0
X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50
aW1lX3BtKTsKIAogCS8qIFBpbiB0aGUgR0dUVCB2bWEgZm9yIG91ciBhY2Nlc3MgdmlhIGluZm8t
PnNjcmVlbl9iYXNlLgpAQCAtMjY2LDcgKzI2NSw2IEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVh
dGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKIAlpZmJkZXYtPnZtYV9mbGFncyA9IGZs
YWdzOwogCiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtl
cmVmKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAl2Z2Ffc3dpdGNoZXJv
b19jbGllbnRfZmJfc2V0KHBkZXYsIGluZm8pOwogCXJldHVybiAwOwogCkBAIC0yNzQsNyArMjcy
LDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVs
cGVyLAogCWludGVsX3VucGluX2ZiX3ZtYSh2bWEsIGZsYWdzKTsKIG91dF91bmxvY2s6CiAJaW50
ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRl
eF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0yOTEs
MTEgKzI4OCw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2ZiZGV2X2Rlc3Ryb3koc3RydWN0IGludGVs
X2ZiZGV2ICppZmJkZXYpCiAKIAlkcm1fZmJfaGVscGVyX2ZpbmkoJmlmYmRldi0+aGVscGVyKTsK
IAotCWlmIChpZmJkZXYtPnZtYSkgewotCQltdXRleF9sb2NrKCZpZmJkZXYtPmhlbHBlci5kZXYt
PnN0cnVjdF9tdXRleCk7CisJaWYgKGlmYmRldi0+dm1hKQogCQlpbnRlbF91bnBpbl9mYl92bWEo
aWZiZGV2LT52bWEsIGlmYmRldi0+dm1hX2ZsYWdzKTsKLQkJbXV0ZXhfdW5sb2NrKCZpZmJkZXYt
PmhlbHBlci5kZXYtPnN0cnVjdF9tdXRleCk7Ci0JfQogCiAJaWYgKGlmYmRldi0+ZmIpCiAJCWRy
bV9mcmFtZWJ1ZmZlcl9yZW1vdmUoJmlmYmRldi0+ZmItPmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwppbmRleCAyOWVkZmMzNDM3MTYuLjRmMzY1
NTdiM2YzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9v
dmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5
LmMKQEAgLTEzMDMsMTUgKzEzMDMsMTEgQEAgc3RhdGljIGludCBnZXRfcmVnaXN0ZXJzKHN0cnVj
dCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LCBib29sIHVzZV9waHlzKQogCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwogCWludCBlcnI7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGk5MTUsIFBBR0VfU0la
RSk7CiAJaWYgKG9iaiA9PSBOVUxMKQogCQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2lu
dGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVyciA9IFBU
Ul9FUlIob2JqKTsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKG9iaikpCisJ
CXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4o
b2JqLCBOVUxMLCAwLCAwLCBQSU5fTUFQUEFCTEUpOwogCWlmIChJU19FUlIodm1hKSkgewpAQCAt
MTMzMiwxMyArMTMyOCwxMCBAQCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGludGVs
X292ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiAJfQogCiAJb3ZlcmxheS0+cmVnX2Jv
ID0gb2JqOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJu
IDA7CiAKIGVycl9wdXRfYm86CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotZXJyX3VubG9j
azoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7
CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGll
bnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5j
CmluZGV4IGY5OTkyMDY1Mjc1MS4uOWU3MmI0MmE4NmY1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKQEAgLTE1Miw2ICsxNTIsMTcgQEAgc3Rh
dGljIHZvaWQgY2xlYXJfcGFnZXNfZG1hX2ZlbmNlX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
LAogCWlycV93b3JrX3F1ZXVlKCZ3LT5pcnFfd29yayk7CiB9CiAKK3N0YXRpYyBpbnQgbW92ZV90
b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQor
eworCWludCBlcnI7CisKKwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHJxLCAmdm1h
LT5hY3RpdmUpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlyZXR1cm4gaTkxNV9hY3Rp
dmVfcmVmKCZ2bWEtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7Cit9CisKIHN0YXRpYyB2b2lk
IGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0
IGNsZWFyX3BhZ2VzX3dvcmsgKncgPSBjb250YWluZXJfb2Yod29yaywgdHlwZW9mKCp3KSwgd29y
ayk7CkBAIC0yMTEsNyArMjIyLDcgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29ya2VyKHN0
cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiBrZWVwIHRyYWNrIG9mIHRoZSBHUFUgYWN0aXZp
dHkgd2l0aGluIHRoaXMgdm1hL3JlcXVlc3QsIGFuZAogCSAqIHByb3BhZ2F0ZSB0aGUgc2lnbmFs
IGZyb20gdGhlIHJlcXVlc3QgdG8gdy0+ZG1hLgogCSAqLwotCWVyciA9IGk5MTVfYWN0aXZlX3Jl
Zigmdm1hLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgcnEpOworCWVyciA9IG1vdmVfdG9fYWN0aXZl
KHZtYSwgcnEpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3JlcXVlc3Q7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGI4OTY5NjA1ZjRlOC4uNGQ5
MTgxYzAwNDRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
Y29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmMKQEAgLTMxMyw4ICszMTMsNiBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2ZyZWUo
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV9jb250
ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAogCXJlbGVhc2VfaHdfaWQoY3R4KTsKLQlpZiAoY3R4LT52
bSkKLQkJaTkxNV92bV9wdXQoY3R4LT52bSk7CiAKIAlmcmVlX2VuZ2luZXMocmN1X2FjY2Vzc19w
b2ludGVyKGN0eC0+ZW5naW5lcykpOwogCW11dGV4X2Rlc3Ryb3koJmN0eC0+ZW5naW5lc19tdXRl
eCk7CkBAIC0zNzksOSArMzc3LDEzIEBAIHZvaWQgaTkxNV9nZW1fY29udGV4dF9yZWxlYXNlKHN0
cnVjdCBrcmVmICpyZWYpCiAKIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKIHsKKwlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsK
KworCWlmIChjdHgtPnZtKQorCQlpOTE1X3ZtX2Nsb3NlKGN0eC0+dm0pOworCiAJbXV0ZXhfbG9j
aygmY3R4LT5tdXRleCk7CiAKLQlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsKIAlj
dHgtPmZpbGVfcHJpdiA9IEVSUl9QVFIoLUVCQURGKTsKIAogCS8qCkBAIC00NzQsNyArNDc2LDcg
QEAgX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCiAKIAlHRU1fQlVHX09OKG9sZCAmJiBpOTE1X3ZtX2lzXzRsdmwo
dm0pICE9IGk5MTVfdm1faXNfNGx2bChvbGQpKTsKIAotCWN0eC0+dm0gPSBpOTE1X3ZtX2dldCh2
bSk7CisJY3R4LT52bSA9IGk5MTVfdm1fb3Blbih2bSk7CiAJY29udGV4dF9hcHBseV9hbGwoY3R4
LCBfX2FwcGx5X3BwZ3R0LCB2bSk7CiAKIAlyZXR1cm4gb2xkOwpAQCAtNDg4LDcgKzQ5MCw3IEBA
IHN0YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
CiAKIAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwogCWlmICh2bSkKLQkJaTkxNV92bV9wdXQo
dm0pOworCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIH0KIAogc3RhdGljIHZvaWQgX19zZXRfdGltZWxp
bmUoc3RydWN0IGludGVsX3RpbWVsaW5lICoqZHN0LApAQCAtOTUzLDcgKzk1NSw3IEBAIHN0YXRp
YyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwK
IAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfdW5sb2NrOwogCi0JaTkxNV92bV9nZXQodm0pOwor
CWk5MTVfdm1fb3Blbih2bSk7CiAKIAlhcmdzLT5zaXplID0gMDsKIAlhcmdzLT52YWx1ZSA9IHJl
dDsKQEAgLTk3Myw3ICs5NzUsNyBAQCBzdGF0aWMgdm9pZCBzZXRfcHBndHRfYmFycmllcih2b2lk
ICpkYXRhKQogCWlmIChJTlRFTF9HRU4ob2xkLT5pOTE1KSA8IDgpCiAJCWdlbjZfcHBndHRfdW5w
aW5fYWxsKGk5MTVfdm1fdG9fcHBndHQob2xkKSk7CiAKLQlpOTE1X3ZtX3B1dChvbGQpOworCWk5
MTVfdm1fY2xvc2Uob2xkKTsKIH0KIAogc3RhdGljIGludCBlbWl0X3BwZ3R0X3VwZGF0ZShzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkKQEAgLTEwOTAsOCArMTA5Miw4IEBAIHN0
YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJp
diwKIAkJCQkgICBzZXRfcHBndHRfYmFycmllciwKIAkJCQkgICBvbGQpOwogCWlmIChlcnIpIHsK
LQkJaTkxNV92bV9wdXQoX19zZXRfcHBndHQoY3R4LCBvbGQpKTsKLQkJaTkxNV92bV9wdXQob2xk
KTsKKwkJaTkxNV92bV9jbG9zZShfX3NldF9wcGd0dChjdHgsIG9sZCkpOworCQlpOTE1X3ZtX2Ns
b3NlKG9sZCk7CiAJfQogCiB1bmxvY2s6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZG9tYWluLmMKaW5kZXggZjBjNDM3YjZlOTk1Li40NmEyMzQwOWUxYzAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKQEAgLTIwMiw3ICsyMDIsMTEgQEAg
aW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKIAkJICAgIGk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZSh2bWEsIGNhY2hlX2xl
dmVsKSkKIAkJCWNvbnRpbnVlOwogCi0JCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQly
ZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZtYS0+dm0tPm11dGV4KTsKKwkJaWYgKCFy
ZXQpIHsKKwkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZ2
bWEtPnZtLT5tdXRleCk7CisJCX0KIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAKQEAgLTI4
OCw3ICsyOTIsMTIgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWlmICghZHJtX21tX25vZGVfYWxsb2NhdGVk
KCZ2bWEtPm5vZGUpKQogCQkJCWNvbnRpbnVlOwogCi0JCQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZt
YSwgY2FjaGVfbGV2ZWwsIFBJTl9VUERBVEUpOworCQkJLyogV2FpdCBmb3IgYW4gZWFybGllciBh
c3luYyBiaW5kICovCisJCQlyZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7CisJ
CQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisKKwkJCXJldCA9IGk5MTVfdm1hX2JpbmQodm1h
LCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSwgTlVMTCk7CiAJCQlpZiAocmV0KQogCQkJCXJldHVy
biByZXQ7CiAJCX0KQEAgLTM4OSwxNiArMzk4LDExIEBAIGludCBpOTE1X2dlbV9zZXRfY2FjaGlu
Z19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWlmIChyZXQpCiAJ
CWdvdG8gb3V0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlnb3RvIG91dDsKLQogCXJldCA9IGk5MTVfZ2Vt
X29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsKIAlpZiAocmV0ID09IDApIHsKIAkJcmV0
ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChvYmosIGxldmVsKTsKIAkJaTkxNV9n
ZW1fb2JqZWN0X3VubG9jayhvYmopOwogCX0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCiBvdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwpAQCAtNDgzLDYg
KzQ4Nyw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dndHQo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJaWYgKCFkcm1fbW1fbm9kZV9hbGxv
Y2F0ZWQoJnZtYS0+bm9kZSkpCiAJCQljb250aW51ZTsKIAorCQlHRU1fQlVHX09OKHZtYS0+dm0g
IT0gJmk5MTUtPmdndHQudm0pOwogCQlsaXN0X21vdmVfdGFpbCgmdm1hLT52bV9saW5rLCAmdm1h
LT52bS0+Ym91bmRfbGlzdCk7CiAJfQogCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRl
eCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpp
bmRleCBjMDQ5MTk5YTFkZjUuLmMzZGQ4Y2U3ZTJiNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC01NTAsOCArNTUwLDExIEBAIGViX2Fk
ZF92bWEoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJCWViX3VucmVzZXJ2ZV92bWEodm1h
LCB2bWEtPmV4ZWNfZmxhZ3MpOwogCiAJCWxpc3RfYWRkX3RhaWwoJnZtYS0+ZXhlY19saW5rLCAm
ZWItPnVuYm91bmQpOwotCQlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQor
CQlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKSB7CisJCQltdXRleF9sb2Nr
KCZ2bWEtPnZtLT5tdXRleCk7CiAJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCW11
dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQl9CiAJCWlmICh1bmxpa2VseShlcnIpKQog
CQkJdm1hLT5leGVjX2ZsYWdzID0gTlVMTDsKIAl9CkBAIC02OTgsNyArNzAxLDkgQEAgc3RhdGlj
IGludCBlYl9yZXNlcnZlKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQogCiAJCWNhc2UgMToK
IAkJCS8qIFRvbyBmcmFnbWVudGVkLCB1bmJpbmQgZXZlcnl0aGluZyBhbmQgcmV0cnkgKi8KKwkJ
CW11dGV4X2xvY2soJmViLT5jb250ZXh0LT52bS0+bXV0ZXgpOwogCQkJZXJyID0gaTkxNV9nZW1f
ZXZpY3Rfdm0oZWItPmNvbnRleHQtPnZtKTsKKwkJCW11dGV4X3VubG9jaygmZWItPmNvbnRleHQt
PnZtLT5tdXRleCk7CiAJCQlpZiAoZXJyKQogCQkJCXJldHVybiBlcnI7CiAJCQlicmVhazsKQEAg
LTk3Miw3ICs5NzcsOSBAQCBzdGF0aWMgdm9pZCByZWxvY19jYWNoZV9yZXNldChzdHJ1Y3QgcmVs
b2NfY2FjaGUgKmNhY2hlKQogCQkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLAogCQkJ
CQkgICAgIGNhY2hlLT5ub2RlLnN0YXJ0LAogCQkJCQkgICAgIGNhY2hlLT5ub2RlLnNpemUpOwor
CQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQkJZHJtX21tX3JlbW92ZV9ub2RlKCZj
YWNoZS0+bm9kZSk7CisJCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJfSBlbHNl
IHsKIAkJCWk5MTVfdm1hX3VucGluKChzdHJ1Y3QgaTkxNV92bWEgKiljYWNoZS0+bm9kZS5tbSk7
CiAJCX0KQEAgLTEwNDcsMTEgKzEwNTQsMTMgQEAgc3RhdGljIHZvaWQgKnJlbG9jX2lvbWFwKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJCSAgICAgICBQSU5fTk9FVklDVCk7
CiAJCWlmIChJU19FUlIodm1hKSkgewogCQkJbWVtc2V0KCZjYWNoZS0+bm9kZSwgMCwgc2l6ZW9m
KGNhY2hlLT5ub2RlKSk7CisJCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCQllcnIg
PSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UKIAkJCQkoJmdndHQtPnZtLm1tLCAmY2FjaGUt
Pm5vZGUsCiAJCQkJIFBBR0VfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkg
MCwgZ2d0dC0+bWFwcGFibGVfZW5kLAogCQkJCSBEUk1fTU1fSU5TRVJUX0xPVyk7CisJCQltdXRl
eF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWlmIChlcnIpIC8qIG5vIGluYWN0aXZlIGFw
ZXJ0dXJlIHNwYWNlLCB1c2UgY3B1IHJlbG9jICovCiAJCQkJcmV0dXJuIE5VTEw7CiAJCX0gZWxz
ZSB7CkBAIC0xNDE2LDcgKzE0MjUsNyBAQCBlYl9yZWxvY2F0ZV9lbnRyeShzdHJ1Y3QgaTkxNV9l
eGVjYnVmZmVyICplYiwKIAkJaWYgKHJlbG9jLT53cml0ZV9kb21haW4gPT0gSTkxNV9HRU1fRE9N
QUlOX0lOU1RSVUNUSU9OICYmCiAJCSAgICBJU19HRU4oZWItPmk5MTUsIDYpKSB7CiAJCQllcnIg
PSBpOTE1X3ZtYV9iaW5kKHRhcmdldCwgdGFyZ2V0LT5vYmotPmNhY2hlX2xldmVsLAotCQkJCQkg
ICAgUElOX0dMT0JBTCk7CisJCQkJCSAgICBQSU5fR0xPQkFMLCBOVUxMKTsKIAkJCWlmIChXQVJO
X09OQ0UoZXJyLAogCQkJCSAgICAgICJVbmV4cGVjdGVkIGZhaWx1cmUgdG8gYmluZCB0YXJnZXQg
Vk1BISIpKQogCQkJCXJldHVybiBlcnI7CkBAIC0yMTQwLDM1ICsyMTQ5LDYgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKmViX3Rocm90dGxlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
IAlyZXR1cm4gaTkxNV9yZXF1ZXN0X2dldChycSk7CiB9CiAKLXN0YXRpYyBpbnQKLV9fZWJfcGlu
X2NvbnRleHQoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSkKLXsKLQlpbnQgZXJyOwotCi0JaWYgKGxpa2VseShhdG9taWNfaW5jX25vdF96ZXJvKCZj
ZS0+cGluX2NvdW50KSkpCi0JCXJldHVybiAwOwotCi0JZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZlYi0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJu
IGVycjsKLQotCWVyciA9IF9faW50ZWxfY29udGV4dF9kb19waW4oY2UpOwotCW11dGV4X3VubG9j
aygmZWItPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIGVycjsKLX0KLQotc3Rh
dGljIHZvaWQKLV9fZWJfdW5waW5fY29udGV4dChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwg
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQotewotCWlmIChsaWtlbHkoYXRvbWljX2FkZF91bmxl
c3MoJmNlLT5waW5fY291bnQsIC0xLCAxKSkpCi0JCXJldHVybjsKLQotCW11dGV4X2xvY2soJmVi
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKLQlt
dXRleF91bmxvY2soJmViLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLX0KLQogc3RhdGljIGlu
dCBfX2ViX3Bpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwpAQCAtMjE4OCw3
ICsyMTY4LDcgQEAgc3RhdGljIGludCBfX2ViX3Bpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1
ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAkgKiBHR1RUIHNwYWNlLCBzbyBk
byB0aGlzIGZpcnN0IGJlZm9yZSB3ZSByZXNlcnZlIGEgc2Vxbm8gZm9yCiAJICogb3Vyc2VsdmVz
LgogCSAqLwotCWVyciA9IF9fZWJfcGluX2NvbnRleHQoZWIsIGNlKTsKKwllcnIgPSBpbnRlbF9j
b250ZXh0X3BpbihjZSk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMjIzMiw3ICsy
MjEyLDcgQEAgc3RhdGljIGludCBfX2ViX3Bpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZl
ciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAlpbnRlbF9jb250ZXh0X2V4aXQoY2Up
OwogCWludGVsX2NvbnRleHRfdGltZWxpbmVfdW5sb2NrKHRsKTsKIGVycl91bnBpbjoKLQlfX2Vi
X3VucGluX2NvbnRleHQoZWIsIGNlKTsKKwlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKIAlyZXR1
cm4gZXJyOwogfQogCkBAIC0yMjQ1LDcgKzIyMjUsNyBAQCBzdGF0aWMgdm9pZCBlYl91bnBpbl9l
bmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJaW50ZWxfY29udGV4dF9leGl0KGNl
KTsKIAltdXRleF91bmxvY2soJnRsLT5tdXRleCk7CiAKLQlfX2ViX3VucGluX2NvbnRleHQoZWIs
IGNlKTsKKwlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKIH0KIAogc3RhdGljIHVuc2lnbmVkIGlu
dApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKaW5kZXggMjYxYzliZDgz
ZjUxLi5lNGFlZTI2Nzg1NDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21t
YW4uYwpAQCAtMjUxLDE2ICsyNTEsNiBAQCB2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVj
dCB2bV9mYXVsdCAqdm1mKQogCQlnb3RvIGVycl9ycG07CiAJfQogCi0JcmV0ID0gaTkxNV9tdXRl
eF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlnb3RvIGVycl9yZXNldDsK
LQotCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlzIGluY29o
ZXJlbnQuICovCi0JaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9OT05FICYmICFI
QVNfTExDKGk5MTUpKSB7Ci0JCXJldCA9IC1FRkFVTFQ7Ci0JCWdvdG8gZXJyX3VubG9jazsKLQl9
Ci0KIAkvKiBOb3cgcGluIGl0IGludG8gdGhlIEdUVCBhcyBuZWVkZWQgKi8KIAl2bWEgPSBpOTE1
X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLAogCQkJCSAgICAgICBQSU5fTUFQ
UEFCTEUgfApAQCAtMjkwLDcgKzI4MCwxMyBAQCB2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0
cnVjdCB2bV9mYXVsdCAqdm1mKQogCX0KIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJcmV0ID0gUFRS
X0VSUih2bWEpOwotCQlnb3RvIGVycl91bmxvY2s7CisJCWdvdG8gZXJyX3Jlc2V0OworCX0KKwor
CS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlzIGluY29oZXJl
bnQuICovCisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9OT05FICYmICFIQVNf
TExDKGk5MTUpKSB7CisJCXJldCA9IC1FRkFVTFQ7CisJCWdvdG8gZXJyX3VucGluOwogCX0KIAog
CXJldCA9IGk5MTVfdm1hX3Bpbl9mZW5jZSh2bWEpOwpAQCAtMzE5LDEzICszMTUsMTAgQEAgdm1f
ZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAkJCQkgICBtc2Vj
c190b19qaWZmaWVzX3RpbWVvdXQoQ09ORklHX0RSTV9JOTE1X1VTRVJGQVVMVF9BVVRPU1VTUEVO
RCkpOwogCiAJaTkxNV92bWFfc2V0X2dndHRfd3JpdGUodm1hKTsKLQogZXJyX2ZlbmNlOgogCWk5
MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CiBlcnJfdW5waW46CiAJX19pOTE1X3ZtYV91bnBpbih2
bWEpOwotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIGVy
cl9yZXNldDoKIAlpbnRlbF9ndF9yZXNldF91bmxvY2soZ2d0dC0+dm0uZ3QsIHNyY3UpOwogZXJy
X3JwbToKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmpl
Y3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwppbmRleCAw
ZWY2MGRhZTIzYTcuLmRiZjliZTlhNzlmNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3QuYwpAQCAtMTU1LDIxICsxNTUsMzAgQEAgc3RhdGljIHZvaWQgX19pOTE1
X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAl3YWtl
cmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCWxsaXN0X2Zv
cl9lYWNoX2VudHJ5X3NhZmUob2JqLCBvbiwgZnJlZWQsIGZyZWVkKSB7Ci0JCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hLCAqdm47Ci0KIAkJdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2Rlc3Ryb3kob2JqKTsK
IAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCQlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5rKSB7Ci0JCQlH
RU1fQlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKLQkJCWF0b21pY19hbmQofkk5MTVf
Vk1BX1BJTl9NQVNLLCAmdm1hLT5mbGFncyk7Ci0JCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7CisJ
CWlmICghbGlzdF9lbXB0eSgmb2JqLT52bWEubGlzdCkpIHsKKwkJCXN0cnVjdCBpOTE1X3ZtYSAq
dm1hOworCisJCQkvKgorCQkJICogTm90ZSB0aGF0IHRoZSB2bWEga2VlcHMgYW4gb2JqZWN0IHJl
ZmVyZW5jZSB3aGlsZQorCQkJICogaXQgaXMgYWN0aXZlLCBzbyBpdCAqc2hvdWxkKiBub3Qgc2xl
ZXAgd2hpbGUgd2UKKwkJCSAqIGRlc3Ryb3kgaXQuIE91ciBkZWJ1ZyBjb2RlIGVycnMgaW5zaXRz
IGl0ICptaWdodCouCisJCQkgKiBGb3IgdGhlIG1vbWVudCwgcGxheSBhbG9uZy4KKwkJCSAqLwor
CQkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKKwkJCXdoaWxlICgodm1hID0gbGlzdF9maXJz
dF9lbnRyeV9vcl9udWxsKCZvYmotPnZtYS5saXN0LAorCQkJCQkJCSAgICAgICBzdHJ1Y3QgaTkx
NV92bWEsCisJCQkJCQkJICAgICAgIG9ial9saW5rKSkpIHsKKwkJCQlHRU1fQlVHX09OKHZtYS0+
b2JqICE9IG9iaik7CisJCQkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOworCisJCQkJaTkx
NV92bWFfZGVzdHJveSh2bWEpOworCisJCQkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKKwkJ
CX0KKwkJCXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAkJfQotCQlHRU1fQlVHX09OKCFs
aXN0X2VtcHR5KCZvYmotPnZtYS5saXN0KSk7Ci0JCUdFTV9CVUdfT04oIVJCX0VNUFRZX1JPT1Qo
Jm9iai0+dm1hLnRyZWUpKTsKLQotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCiAJCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJm9iai0+YmluZF9jb3VudCkpOwogCQlH
RU1fQlVHX09OKG9iai0+dXNlcmZhdWx0X2NvdW50KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCAyOWI5ZWRkYzRjN2YuLmE3OGFmMjVkY2UzNiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtMTA2LDYgKzEw
NiwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2xvY2soc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlkbWFfcmVzdl9sb2NrKG9iai0+YmFzZS5yZXN2LCBO
VUxMKTsKIH0KIAorc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX29iamVjdF90cnlsb2NrKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJcmV0dXJuIGRtYV9yZXN2X3RyeWxv
Y2sob2JqLT5iYXNlLnJlc3YpOworfQorCiBzdGF0aWMgaW5saW5lIGludAogaTkxNV9nZW1fb2Jq
ZWN0X2xvY2tfaW50ZXJydXB0aWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQog
ewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2Vy
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCBk
MmMwNWQ3NTI5MDkuLjQ0N2VlMmIxZTIyMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTE2LDQwICsxNiw2IEBACiAKICNpbmNsdWRlICJpOTE1
X3RyYWNlLmgiCiAKLXN0YXRpYyBib29sIHNocmlua2VyX2xvY2soc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCi0JCQkgIHVuc2lnbmVkIGludCBmbGFncywKLQkJCSAgYm9vbCAqdW5sb2Nr
KQotewotCXN0cnVjdCBtdXRleCAqbSA9ICZpOTE1LT5kcm0uc3RydWN0X211dGV4OwotCi0Jc3dp
dGNoIChtdXRleF90cnlsb2NrX3JlY3Vyc2l2ZShtKSkgewotCWNhc2UgTVVURVhfVFJZTE9DS19S
RUNVUlNJVkU6Ci0JCSp1bmxvY2sgPSBmYWxzZTsKLQkJcmV0dXJuIHRydWU7Ci0KLQljYXNlIE1V
VEVYX1RSWUxPQ0tfRkFJTEVEOgotCQkqdW5sb2NrID0gZmFsc2U7Ci0JCWlmIChmbGFncyAmIEk5
MTVfU0hSSU5LX0FDVElWRSAmJgotCQkgICAgbXV0ZXhfbG9ja19raWxsYWJsZV9uZXN0ZWQobSwg
STkxNV9NTV9TSFJJTktFUikgPT0gMCkKLQkJCSp1bmxvY2sgPSB0cnVlOwotCQlyZXR1cm4gKnVu
bG9jazsKLQotCWNhc2UgTVVURVhfVFJZTE9DS19TVUNDRVNTOgotCQkqdW5sb2NrID0gdHJ1ZTsK
LQkJcmV0dXJuIHRydWU7Ci0JfQotCi0JQlVHKCk7Ci19Ci0KLXN0YXRpYyB2b2lkIHNocmlua2Vy
X3VubG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgYm9vbCB1bmxvY2spCi17Ci0J
aWYgKCF1bmxvY2spCi0JCXJldHVybjsKLQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci19Ci0KIHN0YXRpYyBib29sIHN3YXBfYXZhaWxhYmxlKHZvaWQpCiB7CiAJcmV0
dXJuIGdldF9ucl9zd2FwX3BhZ2VzKCkgPiAwOwpAQCAtMTU1LDEwICsxMjEsNiBAQCBpOTE1X2dl
bV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaW50ZWxfd2FrZXJlZl90
IHdha2VyZWYgPSAwOwogCXVuc2lnbmVkIGxvbmcgY291bnQgPSAwOwogCXVuc2lnbmVkIGxvbmcg
c2Nhbm5lZCA9IDA7Ci0JYm9vbCB1bmxvY2s7Ci0KLQlpZiAoIXNocmlua2VyX2xvY2soaTkxNSwg
c2hyaW5rLCAmdW5sb2NrKSkKLQkJcmV0dXJuIDA7CiAKIAkvKgogCSAqIFdoZW4gc2hyaW5raW5n
IHRoZSBhY3RpdmUgbGlzdCwgd2Ugc2hvdWxkIGFsc28gY29uc2lkZXIgYWN0aXZlCkBAIC0yNjgs
OCArMjMwLDYgQEAgaTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCWlmIChzaHJpbmsgJiBJOTE1X1NIUklOS19CT1VORCkKIAkJaW50ZWxfcnVudGltZV9wbV9w
dXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCi0Jc2hyaW5rZXJfdW5sb2NrKGk5MTUs
IHVubG9jayk7Ci0KIAlpZiAobnJfc2Nhbm5lZCkKIAkJKm5yX3NjYW5uZWQgKz0gc2Nhbm5lZDsK
IAlyZXR1cm4gY291bnQ7CkBAIC0zMzksMTMgKzI5OSw5IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3Nj
YW4oc3RydWN0IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9sICpzYykK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNvbnRhaW5lcl9vZihzaHJpbmtl
ciwgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUsIG1tLnNocmlua2VyKTsKIAl1bnNpZ25lZCBsb25n
IGZyZWVkOwotCWJvb2wgdW5sb2NrOwogCiAJc2MtPm5yX3NjYW5uZWQgPSAwOwogCi0JaWYgKCFz
aHJpbmtlcl9sb2NrKGk5MTUsIDAsICZ1bmxvY2spKQotCQlyZXR1cm4gU0hSSU5LX1NUT1A7Ci0K
IAlmcmVlZCA9IGk5MTVfZ2VtX3NocmluayhpOTE1LAogCQkJCXNjLT5ucl90b19zY2FuLAogCQkJ
CSZzYy0+bnJfc2Nhbm5lZCwKQEAgLTM2Niw4ICszMjIsNiBAQCBpOTE1X2dlbV9zaHJpbmtlcl9z
Y2FuKHN0cnVjdCBzaHJpbmtlciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29udHJvbCAqc2Mp
CiAJCX0KIAl9CiAKLQlzaHJpbmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCXJldHVybiBz
Yy0+bnJfc2Nhbm5lZCA/IGZyZWVkIDogU0hSSU5LX1NUT1A7CiB9CiAKQEAgLTQxOSwxMCArMzcz
LDYgQEAgaTkxNV9nZW1fc2hyaW5rZXJfdm1hcChzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLCB1
bnNpZ25lZCBsb25nIGV2ZW50LCB2b2lkICpwdHIKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKm5l
eHQ7CiAJdW5zaWduZWQgbG9uZyBmcmVlZF9wYWdlcyA9IDA7CiAJaW50ZWxfd2FrZXJlZl90IHdh
a2VyZWY7Ci0JYm9vbCB1bmxvY2s7Ci0KLQlpZiAoIXNocmlua2VyX2xvY2soaTkxNSwgMCwgJnVu
bG9jaykpCi0JCXJldHVybiBOT1RJRllfRE9ORTsKIAogCXdpdGhfaW50ZWxfcnVudGltZV9wbSgm
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZikKIAkJZnJlZWRfcGFnZXMgKz0gaTkxNV9nZW1fc2hy
aW5rKGk5MTUsIC0xVUwsIE5VTEwsCkBAIC00MzksMTUgKzM4OSwxMSBAQCBpOTE1X2dlbV9zaHJp
bmtlcl92bWFwKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVuc2lnbmVkIGxvbmcgZXZlbnQs
IHZvaWQgKnB0cgogCQlpZiAoIXZtYS0+aW9tYXAgfHwgaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkp
CiAJCQljb250aW51ZTsKIAotCQltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwog
CQlpZiAoaTkxNV92bWFfdW5iaW5kKHZtYSkgPT0gMCkKIAkJCWZyZWVkX3BhZ2VzICs9IGNvdW50
OwotCQltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAl9CiAJbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAotCXNocmlua2VyX3VubG9jayhpOTE1LCB1bmxvY2sp
OwotCiAJKih1bnNpZ25lZCBsb25nICopcHRyICs9IGZyZWVkX3BhZ2VzOwogCXJldHVybiBOT1RJ
RllfRE9ORTsKIH0KQEAgLTQ5MCwyMiArNDM2LDkgQEAgdm9pZCBpOTE1X2dlbV9zaHJpbmtlcl90
YWludHNfbXV0ZXgoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAlmc19yZWNsYWlt
X2FjcXVpcmUoR0ZQX0tFUk5FTCk7CiAKLQkvKgotCSAqIEFzIHdlIGludmFyaWFibHkgcmVseSBv
biB0aGUgc3RydWN0X211dGV4IHdpdGhpbiB0aGUgc2hyaW5rZXIsCi0JICogYnV0IGhhdmUgYSBj
b21wbGljYXRlZCByZWN1cnNpb24gZGFuY2UsIHRhaW50IGFsbCB0aGUgbXV0ZXhlcyB1c2VkCi0J
ICogd2l0aGluIHRoZSBzaHJpbmtlciB3aXRoIHRoZSBzdHJ1Y3RfbXV0ZXguIEZvciBjb21wbGV0
ZW5lc3MsIHdlCi0JICogdGFpbnQgd2l0aCBhbGwgc3ViY2xhc3Mgb2Ygc3RydWN0X211dGV4LCBl
dmVuIHRob3VnaCB3ZSBzaG91bGQKLQkgKiBvbmx5IG5lZWQgdGFpbnRpbmcgYnkgSTkxNV9NTV9O
T1JNQUwgdG8gY2F0Y2ggcG9zc2libGUgQUJCQQotCSAqIGRlYWRsb2NrcyBmcm9tIHVzaW5nIHN0
cnVjdF9tdXRleCBpbnNpZGUgQG11dGV4LgotCSAqLwotCW11dGV4X2FjcXVpcmUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXguZGVwX21hcCwKLQkJICAgICAgSTkxNV9NTV9TSFJJTktFUiwgMCwgX1JF
VF9JUF8pOwotCiAJbXV0ZXhfYWNxdWlyZSgmbXV0ZXgtPmRlcF9tYXAsIDAsIDAsIF9SRVRfSVBf
KTsKIAltdXRleF9yZWxlYXNlKCZtdXRleC0+ZGVwX21hcCwgMCwgX1JFVF9JUF8pOwogCi0JbXV0
ZXhfcmVsZWFzZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleC5kZXBfbWFwLCAwLCBfUkVUX0lQXyk7
Ci0KIAlmc19yZWNsYWltX3JlbGVhc2UoR0ZQX0tFUk5FTCk7CiAKIAlpZiAodW5sb2NrKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jCmluZGV4IDBkODFkZTE0NjFi
NC4uZDJhZWQ3MjhhZDhkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fc3RvbGVuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0
b2xlbi5jCkBAIC02MjEsOCArNjIxLDYgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5f
Zm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYKIAlpZiAo
IWRybV9tbV9pbml0aWFsaXplZCgmZGV2X3ByaXYtPm1tLnN0b2xlbikpCiAJCXJldHVybiBOVUxM
OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CiAJRFJNX0RFQlVHX0RSSVZFUigiY3JlYXRpbmcgcHJlYWxsb2NhdGVkIHN0b2xlbiBvYmplY3Q6
IHN0b2xlbl9vZmZzZXQ9JXBhLCBndHRfb2Zmc2V0PSVwYSwgc2l6ZT0lcGFcbiIsCiAJCQkgJnN0
b2xlbl9vZmZzZXQsICZndHRfb2Zmc2V0LCAmc2l6ZSk7CiAKQEAgLTY3NCwyMSArNjcyLDI1IEBA
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2CiAJICogc2V0dGluZyB1cCB0aGUgR1RUIHNwYWNlLiBU
aGUgYWN0dWFsIHJlc2VydmF0aW9uIHdpbGwgb2NjdXIKIAkgKiBsYXRlci4KIAkgKi8KKwltdXRl
eF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJcmV0ID0gaTkxNV9nZW1fZ3R0X3Jlc2VydmUoJmdn
dHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCSAgIHNpemUsIGd0dF9vZmZzZXQsIG9iai0+Y2FjaGVf
bGV2ZWwsCiAJCQkJICAgMCk7CiAJaWYgKHJldCkgewogCQlEUk1fREVCVUdfRFJJVkVSKCJmYWls
ZWQgdG8gYWxsb2NhdGUgc3RvbGVuIEdUVCBzcGFjZVxuIik7CisJCW11dGV4X3VubG9jaygmZ2d0
dC0+dm0ubXV0ZXgpOwogCQlnb3RvIGVycl9wYWdlczsKIAl9CiAKIAlHRU1fQlVHX09OKCFkcm1f
bW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwogCisJR0VNX0JVR19PTih2bWEtPnBhZ2Vz
KTsKIAl2bWEtPnBhZ2VzID0gb2JqLT5tbS5wYWdlczsKKwlhdG9taWNfc2V0KCZ2bWEtPnBhZ2Vz
X2NvdW50LCBJOTE1X1ZNQV9QQUdFU19BQ1RJVkUpOworCiAJc2V0X2JpdChJOTE1X1ZNQV9HTE9C
QUxfQklORF9CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSk7CiAJX19pOTE1X3ZtYV9zZXRfbWFw
X2FuZF9mZW5jZWFibGUodm1hKTsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAls
aXN0X2FkZF90YWlsKCZ2bWEtPnZtX2xpbmssICZnZ3R0LT52bS5ib3VuZF9saXN0KTsKIAltdXRl
eF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3RpbGluZy5jCmluZGV4IGNhMGMyZjQ1MTc0Mi4uYjljZmFlMGU0NDM1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jCkBAIC0xODEsMjIgKzE4MSwy
NSBAQCBzdGF0aWMgaW50CiBpOTE1X2dlbV9vYmplY3RfZmVuY2VfcHJlcGFyZShzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJICAgICAgaW50IHRpbGluZ19tb2RlLCB1bnNpZ25l
ZCBpbnQgc3RyaWRlKQogeworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmdG9faTkxNShvYmot
PmJhc2UuZGV2KS0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlpbnQgcmV0OworCWlu
dCByZXQgPSAwOwogCiAJaWYgKHRpbGluZ19tb2RlID09IEk5MTVfVElMSU5HX05PTkUpCiAJCXJl
dHVybiAwOwogCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWZvcl9lYWNoX2dndHRf
dm1hKHZtYSwgb2JqKSB7CiAJCWlmIChpOTE1X3ZtYV9mZW5jZV9wcmVwYXJlKHZtYSwgdGlsaW5n
X21vZGUsIHN0cmlkZSkpCiAJCQljb250aW51ZTsKIAogCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQo
dm1hKTsKIAkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7CisJCQlicmVhazsKIAl9CisJbXV0ZXhf
dW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAKLQlyZXR1cm4gMDsKKwlyZXR1cm4gcmV0OwogfQog
CiBpbnQKQEAgLTIxMiw3ICsyMTUsNiBAQCBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiAJR0VNX0JVR19PTighaTkxNV90aWxpbmdf
b2sob2JqLCB0aWxpbmcsIHN0cmlkZSkpOwogCUdFTV9CVUdfT04oIXN0cmlkZSBeICh0aWxpbmcg
PT0gSTkxNV9USUxJTkdfTk9ORSkpOwotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKCh0aWxpbmcgfCBzdHJpZGUpID09IG9iai0+dGlsaW5nX2Fu
ZF9zdHJpZGUpCiAJCXJldHVybiAwOwpAQCAtMzY0LDEyICszNjYsNyBAQCBpOTE1X2dlbV9zZXRf
dGlsaW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCX0KIAl9
CiAKLQllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRldi0+c3RydWN0X211dGV4KTsK
LQlpZiAoZXJyKQotCQlnb3RvIGVycjsKLQogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdGls
aW5nKG9iaiwgYXJncy0+dGlsaW5nX21vZGUsIGFyZ3MtPnN0cmlkZSk7Ci0JbXV0ZXhfdW5sb2Nr
KCZkZXYtPnN0cnVjdF9tdXRleCk7CiAKIAkvKiBXZSBoYXZlIHRvIG1haW50YWluIHRoaXMgZXhp
c3RpbmcgQUJJLi4uICovCiAJYXJncy0+c3RyaWRlID0gaTkxNV9nZW1fb2JqZWN0X2dldF9zdHJp
ZGUob2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91
c2VycHRyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCmlu
ZGV4IDc0ZGEzNTYxMWQ3Yy4uY2QzNjIzNmUzZmFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKQEAgLTkyLDcgKzkyLDYgQEAgdXNlcnB0cl9tbl9pbnZh
bGlkYXRlX3JhbmdlX3N0YXJ0KHN0cnVjdCBtbXVfbm90aWZpZXIgKl9tbiwKIAlzdHJ1Y3QgaTkx
NV9tbXVfbm90aWZpZXIgKm1uID0KIAkJY29udGFpbmVyX29mKF9tbiwgc3RydWN0IGk5MTVfbW11
X25vdGlmaWVyLCBtbik7CiAJc3RydWN0IGludGVydmFsX3RyZWVfbm9kZSAqaXQ7Ci0Jc3RydWN0
IG11dGV4ICp1bmxvY2sgPSBOVUxMOwogCXVuc2lnbmVkIGxvbmcgZW5kOwogCWludCByZXQgPSAw
OwogCkBAIC0xMjksMzMgKzEyOCwxMyBAQCB1c2VycHRyX21uX2ludmFsaWRhdGVfcmFuZ2Vfc3Rh
cnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAogCQl9CiAJCXNwaW5fdW5sb2NrKCZtbi0+bG9j
ayk7CiAKLQkJaWYgKCF1bmxvY2spIHsKLQkJCXVubG9jayA9ICZtbi0+bW0tPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXg7Ci0KLQkJCXN3aXRjaCAobXV0ZXhfdHJ5bG9ja19yZWN1cnNpdmUodW5sb2Nr
KSkgewotCQkJZGVmYXVsdDoKLQkJCWNhc2UgTVVURVhfVFJZTE9DS19GQUlMRUQ6Ci0JCQkJaWYg
KG11dGV4X2xvY2tfa2lsbGFibGVfbmVzdGVkKHVubG9jaywgSTkxNV9NTV9TSFJJTktFUikpIHsK
LQkJCQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCQkJCQlyZXR1cm4gLUVJTlRSOwotCQkJ
CX0KLQkJCQkvKiBmYWxsIHRocm91Z2ggKi8KLQkJCWNhc2UgTVVURVhfVFJZTE9DS19TVUNDRVNT
OgotCQkJCWJyZWFrOwotCi0JCQljYXNlIE1VVEVYX1RSWUxPQ0tfUkVDVVJTSVZFOgotCQkJCXVu
bG9jayA9IEVSUl9QVFIoLUVFWElTVCk7Ci0JCQkJYnJlYWs7Ci0JCQl9Ci0JCX0KLQogCQlyZXQg
PSBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKG9iaiwKIAkJCQkJICAgICBJOTE1X0dFTV9PQkpFQ1Rf
VU5CSU5EX0FDVElWRSk7CiAJCWlmIChyZXQgPT0gMCkKIAkJCXJldCA9IF9faTkxNV9nZW1fb2Jq
ZWN0X3B1dF9wYWdlcyhvYmosIEk5MTVfTU1fU0hSSU5LRVIpOwogCQlpOTE1X2dlbV9vYmplY3Rf
cHV0KG9iaik7CiAJCWlmIChyZXQpCi0JCQlnb3RvIHVubG9jazsKKwkJCXJldHVybiByZXQ7CiAK
IAkJc3Bpbl9sb2NrKCZtbi0+bG9jayk7CiAKQEAgLTE2OCwxMCArMTQ3LDYgQEAgdXNlcnB0cl9t
bl9pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0KHN0cnVjdCBtbXVfbm90aWZpZXIgKl9tbiwKIAl9CiAJ
c3Bpbl91bmxvY2soJm1uLT5sb2NrKTsKIAotdW5sb2NrOgotCWlmICghSVNfRVJSX09SX05VTEwo
dW5sb2NrKSkKLQkJbXV0ZXhfdW5sb2NrKHVubG9jayk7Ci0KIAlyZXR1cm4gcmV0OwogCiB9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCmluZGV4
IGM1Y2VhNDM3OTIxNi4uY2Q3NzExNDdiNDFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwpAQCAtMjUsNiArMjUsMTcgQEAgc3RhdGljIGNv
bnN0IHVuc2lnbmVkIGludCBwYWdlX3NpemVzW10gPSB7CiAJSTkxNV9HVFRfUEFHRV9TSVpFXzRL
LAogfTsKIAorc3RhdGljIGludCB1bmxvY2tlZF92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQoreworCWludCByZXQ7CisKKwltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJcmV0
ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7
CisKKwlyZXR1cm4gcmV0OworfQorCiBzdGF0aWMgdW5zaWduZWQgaW50IGdldF9sYXJnZXN0X3Bh
Z2Vfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICB1NjQgcmVtKQog
ewpAQCAtMzMzLDcgKzM0NCwxMSBAQCBzdGF0aWMgaW50IGlndF9jaGVja19wYWdlX3NpemVzKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm1h
LT52bS0+aTkxNTsKIAl1bnNpZ25lZCBpbnQgc3VwcG9ydGVkID0gSU5URUxfSU5GTyhpOTE1KS0+
cGFnZV9zaXplczsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7
Ci0JaW50IGVyciA9IDA7CisJaW50IGVycjsKKworCWVyciA9IGk5MTVfYWN0aXZlX3dhaXQoJnZt
YS0+YWN0aXZlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwogCiAJaWYgKCFIQVNfUEFHRV9T
SVpFUyhpOTE1LCB2bWEtPnBhZ2Vfc2l6ZXMuc2cpKSB7CiAJCXByX2VycigidW5zdXBwb3J0ZWQg
cGFnZV9zaXplcy5zZz0ldSwgc3VwcG9ydGVkPSV1XG4iLApAQCAtNTI2LDcgKzU0MSw3IEBAIHN0
YXRpYyBpbnQgaWd0X21vY2tfcHBndHRfbWlzYWxpZ25lZF9kbWEodm9pZCAqYXJnKQogCQkgKiBw
YWdlcy4KIAkJICovCiAJCWZvciAob2Zmc2V0ID0gNDA5Njsgb2Zmc2V0IDwgcGFnZV9zaXplOyBv
ZmZzZXQgKz0gNDA5NikgewotCQkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQllcnIg
PSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJaTkxNV92bWFf
Y2xvc2Uodm1hKTsKIAkJCQlnb3RvIG91dF91bnBpbjsKQEAgLTk0MSw3ICs5NTYsNyBAQCBzdGF0
aWMgaW50IF9faWd0X3dyaXRlX2h1Z2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCWlmIChJ
U19FUlIodm1hKSkKIAkJcmV0dXJuIFBUUl9FUlIodm1hKTsKIAotCWVyciA9IGk5MTVfdm1hX3Vu
YmluZCh2bWEpOworCWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAlpZiAoZXJyKQog
CQlnb3RvIG91dF92bWFfY2xvc2U7CiAKQEAgLTEzOTAsNyArMTQwNSw3IEBAIHN0YXRpYyBpbnQg
aWd0X3BwZ3R0X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCQkJZ290byBvdXRfdW5waW47CiAJCX0K
IAotCQllcnIgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgSTkxNV9DQUNIRV9OT05FLCBQSU5fVVBEQVRF
KTsKKwkJZXJyID0gaTkxNV92bWFfYmluZCh2bWEsIEk5MTVfQ0FDSEVfTk9ORSwgUElOX1VQREFU
RSwgTlVMTCk7CiAJCWlmIChlcnIpCiAJCQlnb3RvIG91dF91bnBpbjsKIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRl
eCBkYTU0YTcxOGM3MTIuLmFhNjdjMDJiYTk4YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTc0NywxMCArNzQ3
LDcgQEAgZW1pdF9ycGNzX3F1ZXJ5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
aWYgKGVycikKIAkJZ290byBza2lwX3JlcXVlc3Q7CiAKLQlpOTE1X3ZtYV91bnBpbihiYXRjaCk7
Ci0JaTkxNV92bWFfY2xvc2UoYmF0Y2gpOwotCWk5MTVfdm1hX3B1dChiYXRjaCk7Ci0KKwlpOTE1
X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmYmF0Y2gsIDApOwogCWk5MTVfdm1hX3VucGluKHZtYSk7
CiAKIAkqcnFfb3V0ID0gaTkxNV9yZXF1ZXN0X2dldChycSk7CkBAIC03NjQsOCArNzYxLDcgQEAg
ZW1pdF9ycGNzX3F1ZXJ5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiBlcnJfcmVx
dWVzdDoKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIGVycl9iYXRjaDoKLQlpOTE1X3ZtYV91bnBp
bihiYXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVs
ZWFzZSgmYmF0Y2gsIDApOwogZXJyX3ZtYToKIAlpOTE1X3ZtYV91bnBpbih2bWEpOwogCkBAIC0x
MzA5LDkgKzEzMDUsNyBAQCBzdGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCwKIAlpZiAoZXJyKQogCQlnb3RvIHNraXBfcmVxdWVzdDsKIAotCWk5
MTVfdm1hX3VucGluKHZtYSk7Ci0JaTkxNV92bWFfY2xvc2Uodm1hKTsKLQlpOTE1X3ZtYV9wdXQo
dm1hKTsKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmdm1hLCAwKTsKIAogCWk5MTVfcmVx
dWVzdF9hZGQocnEpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fbW1hbi5jCmluZGV4IDFkMjdiYWJmZjBjZS4uOWMyMTdkZmU5NmE5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4u
YwpAQCAtMjA1LDcgKzIwNSw2IEBAIHN0YXRpYyBpbnQgaWd0X3BhcnRpYWxfdGlsaW5nKHZvaWQg
KmFyZykKIAkJZ290byBvdXQ7CiAJfQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3Bt
KTsKIAogCWlmICgxKSB7CkBAIC0zMTgsNyArMzE3LDYgQEAgbmV4dF90aWxpbmc6IDsKIAogb3V0
X3VubG9jazoKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJl
Zik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9v
YmplY3RfdW5waW5fcGFnZXMob2JqKTsKIG91dDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1f
dXRpbHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGls
cy5jCmluZGV4IGVlNWRjMTNhMzBiMy4uNjcxOGRhMjBmMzVkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYwpAQCAtMTU0LDkgKzE1
NCw3IEBAIGludCBpZ3RfZ3B1X2ZpbGxfZHcoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7CiAKLQlpOTE1X3ZtYV91bnBpbihiYXRjaCk7Ci0JaTkxNV92
bWFfY2xvc2UoYmF0Y2gpOwotCWk5MTVfdm1hX3B1dChiYXRjaCk7CisJaTkxNV92bWFfdW5waW5f
YW5kX3JlbGVhc2UoJmJhdGNoLCAwKTsKIAogCXJldHVybiAwOwogCkBAIC0xNjUsNyArMTYzLDYg
QEAgaW50IGlndF9ncHVfZmlsbF9kdyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiBlcnJfcmVx
dWVzdDoKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIGVycl9iYXRjaDoKLQlpOTE1X3ZtYV91bnBp
bihiYXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVs
ZWFzZSgmYmF0Y2gsIDApOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Z3QuYwppbmRleCBkNDhlYzlhNzZlZDEuLmMyYWZmZmI5NDQ3NCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndC5jCkBAIC0yMDcsMTEgKzIwNywxMiBAQCB2b2lkIGludGVsX2d0X2ZsdXNoX2dn
dHRfd3JpdGVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIAl3aXRoX2ludGVsX3J1bnRpbWVfcG0o
Jmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpIHsKIAkJc3RydWN0IGludGVsX3VuY29yZSAqdW5j
b3JlID0gZ3QtPnVuY29yZTsKKwkJdW5zaWduZWQgbG9uZyBmbGFnczsKIAotCQlzcGluX2xvY2tf
aXJxKCZ1bmNvcmUtPmxvY2spOworCQlzcGluX2xvY2tfaXJxc2F2ZSgmdW5jb3JlLT5sb2NrLCBm
bGFncyk7CiAJCWludGVsX3VuY29yZV9wb3N0aW5nX3JlYWRfZncodW5jb3JlLAogCQkJCQkgICAg
IFJJTkdfSEVBRChSRU5ERVJfUklOR19CQVNFKSk7Ci0JCXNwaW5fdW5sb2NrX2lycSgmdW5jb3Jl
LT5sb2NrKTsKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdW5jb3JlLT5sb2NrLCBmbGFncyk7
CiAJfQogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5n
YnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKaW5k
ZXggYWM1NWEwZDA1NGJkLi44NTVlOTdjY2FmOWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9yaW5nYnVmZmVyLmMKQEAgLTEzMzYsMTUgKzEzMzYsMTMgQEAgdm9pZCBpbnRlbF9y
aW5nX2ZyZWUoc3RydWN0IGtyZWYgKnJlZikKIHsKIAlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZyA9
IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqcmluZyksIHJlZik7CiAKLQlpOTE1X3ZtYV9jbG9z
ZShyaW5nLT52bWEpOwogCWk5MTVfdm1hX3B1dChyaW5nLT52bWEpOwotCiAJa2ZyZWUocmluZyk7
CiB9CiAKIHN0YXRpYyB2b2lkIF9fcmluZ19jb250ZXh0X2Zpbmkoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlKQogewotCWk5MTVfZ2VtX29iamVjdF9wdXQoY2UtPnN0YXRlLT5vYmopOworCWk5MTVf
dm1hX3B1dChjZS0+c3RhdGUpOwogfQogCiBzdGF0aWMgdm9pZCByaW5nX2NvbnRleHRfZGVzdHJv
eShzdHJ1Y3Qga3JlZiAqcmVmKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9o
YW5nY2hlY2suYwppbmRleCBhMDA5OGZjMzU5MjEuLmU1M2VlYTEwNTBmOCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTExMjcsMTUgKzExMjcs
MTQgQEAgc3RhdGljIGludCBldmljdF92bWEodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZXZpY3Rf
dm1hICphcmcgPSBkYXRhOwogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gYXJnLT52
bWEtPnZtOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm0tPmk5MTU7CiAJc3Ry
dWN0IGRybV9tbV9ub2RlIGV2aWN0ID0gYXJnLT52bWEtPm5vZGU7CiAJaW50IGVycjsKIAogCWNv
bXBsZXRlKCZhcmctPmNvbXBsZXRpb24pOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CisJbXV0ZXhfbG9jaygmdm0tPm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmlj
dF9mb3Jfbm9kZSh2bSwgJmV2aWN0LCAwKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmdm0tPm11dGV4KTsKIAogCXJldHVybiBlcnI7CiB9
CkBAIC0xMTQzLDM5ICsxMTQyLDMzIEBAIHN0YXRpYyBpbnQgZXZpY3Rfdm1hKHZvaWQgKmRhdGEp
CiBzdGF0aWMgaW50IGV2aWN0X2ZlbmNlKHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGV2aWN0X3Zt
YSAqYXJnID0gZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZy0+dm1h
LT52bS0+aTkxNTsKIAlpbnQgZXJyOwogCiAJY29tcGxldGUoJmFyZy0+Y29tcGxldGlvbik7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCS8qIE1hcmsgdGhlIGZl
bmNlIHJlZ2lzdGVyIGFzIGRpcnR5IHRvIGZvcmNlIHRoZSBtbWlvIHVwZGF0ZS4gKi8KIAllcnIg
PSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhhcmctPnZtYS0+b2JqLCBJOTE1X1RJTElOR19Z
LCA1MTIpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJJbnZhbGlkIFktdGlsaW5nIHNldHRpbmdz
OyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIGVycjsKIAl9
CiAKIAllcnIgPSBpOTE1X3ZtYV9waW4oYXJnLT52bWEsIDAsIDAsIFBJTl9HTE9CQUwgfCBQSU5f
TUFQUEFCTEUpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJVbmFibGUgdG8gcGluIHZtYSBmb3Ig
WS10aWxlZCBmZW5jZTsgZXJyOiVkXG4iLCBlcnIpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCXJl
dHVybiBlcnI7CiAJfQogCiAJZXJyID0gaTkxNV92bWFfcGluX2ZlbmNlKGFyZy0+dm1hKTsKIAlp
OTE1X3ZtYV91bnBpbihhcmctPnZtYSk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIlVuYWJsZSB0
byBwaW4gWS10aWxlZCBmZW5jZTsgZXJyOiVkXG4iLCBlcnIpOwotCQlnb3RvIG91dF91bmxvY2s7
CisJCXJldHVybiBlcnI7CiAJfQogCiAJaTkxNV92bWFfdW5waW5fZmVuY2UoYXJnLT52bWEpOwog
Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
LQlyZXR1cm4gZXJyOworCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2
aWN0X3ZtYShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1
cmVfZ20uYwppbmRleCA1ZmYyNDM3YjI5OTguLmQ5OTZiYmM3ZWE1OSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMKQEAgLTYxLDE0ICs2MSwxNCBAQCBzdGF0aWMgaW50IGFs
bG9jX2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCBib29sIGhpZ2hfZ20pCiAJCWZsYWdzID0g
UElOX01BUFBBQkxFOwogCX0KIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211
dGV4KTsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJbW1pb19od19h
Y2Nlc3NfcHJlKGRldl9wcml2KTsKIAlyZXQgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZkZXZfcHJp
di0+Z2d0dC52bSwgbm9kZSwKIAkJCQkgIHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRSwKIAkJCQkg
IEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCiAJCQkJICBzdGFydCwgZW5kLCBmbGFncyk7CiAJbW1p
b19od19hY2Nlc3NfcG9zdChkZXZfcHJpdik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7
CiAJaWYgKHJldCkKIAkJZ3Z0X2VycigiZmFpbCB0byBhbGxvYyAlcyBnbSBzcGFjZSBmcm9tIGhv
c3RcbiIsCiAJCQloaWdoX2dtID8gImhpZ2giIDogImxvdyIpOwpAQCAtOTgsOSArOTgsOSBAQCBz
dGF0aWMgaW50IGFsbG9jX3ZncHVfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAKIAlyZXR1
cm4gMDsKIG91dF9mcmVlX2FwZXJ0dXJlOgotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJZHJt
X21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5sb3dfZ21fbm9kZSk7Ci0JbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0
dC52bS5tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTA4LDEwICsxMDgsMTAgQEAgc3Rh
dGljIHZvaWQgZnJlZV92Z3B1X2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CiAKLQlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZGV2
X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCWRybV9tbV9yZW1vdmVfbm9kZSgmdmdwdS0+Z20ubG93
X2dtX25vZGUpOwogCWRybV9tbV9yZW1vdmVfbm9kZSgmdmdwdS0+Z20uaGlnaF9nbV9ub2RlKTsK
LQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxv
Y2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9hY3RpdmUuYwppbmRleCA2YTQ0N2YxZDAxMTAuLjZhMzdlZDUyOTU3YSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0xNDYsNiArMTQ2LDcgQEAgX19hY3RpdmVfcmV0aXJlKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogCWlmICghcmV0aXJlKQogCQlyZXR1cm47CiAKKwlHRU1f
QlVHX09OKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKTsKIAlyYnRyZWVfcG9zdG9yZGVy
X2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyb290LCBub2RlKSB7CiAJCUdFTV9CVUdfT04o
aTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmaXQtPmJhc2UpKTsKIAkJa21lbV9jYWNoZV9mcmVl
KGdsb2JhbC5zbGFiX2NhY2hlLCBpdCk7CkBAIC0yNDUsNiArMjQ2LDggQEAgdm9pZCBfX2k5MTVf
YWN0aXZlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmVmLT5mbGFncyA9
IDA7CiAJcmVmLT5hY3RpdmUgPSBhY3RpdmU7CiAJcmVmLT5yZXRpcmUgPSByZXRpcmU7CisKKwly
ZWYtPmV4Y2wgPSBOVUxMOwogCXJlZi0+dHJlZSA9IFJCX1JPT1Q7CiAJcmVmLT5jYWNoZSA9IE5V
TEw7CiAJaW5pdF9sbGlzdF9oZWFkKCZyZWYtPnByZWFsbG9jYXRlZF9iYXJyaWVycyk7CkBAIC0z
NDEsNiArMzQ0LDQ1IEBAIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpy
ZWYsCiAJcmV0dXJuIGVycjsKIH0KIAorc3RhdGljIHZvaWQgZXhjbF9jYihzdHJ1Y3QgZG1hX2Zl
bmNlICpmLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKK3sKKwlzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZiA9IGNvbnRhaW5lcl9vZihjYiwgdHlwZW9mKCpyZWYpLCBleGNsX2NiKTsKKworCVJDVV9J
TklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKKwlkbWFfZmVuY2VfcHV0KGYpOworCisJYWN0
aXZlX3JldGlyZShyZWYpOworfQorCit2b2lkIGk5MTVfYWN0aXZlX3NldF9leGNsdXNpdmUoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBkbWFfZmVuY2UgKmYpCit7CisJR0VNX0JVR19P
TihpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpOworCisJZG1hX2ZlbmNlX2dldChmKTsKKworCXJj
dV9yZWFkX2xvY2soKTsKKwlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpIHsKKwkJ
c3RydWN0IGRtYV9mZW5jZSAqb2xkOworCisJCW9sZCA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUo
JnJlZi0+ZXhjbCk7CisJCWlmIChvbGQpIHsKKwkJCWlmIChkbWFfZmVuY2VfcmVtb3ZlX2NhbGxi
YWNrKG9sZCwgJnJlZi0+ZXhjbF9jYikpCisJCQkJYXRvbWljX2RlYygmcmVmLT5jb3VudCk7CisJ
CQlkbWFfZmVuY2VfcHV0KG9sZCk7CisJCX0KKwl9CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwlh
dG9taWNfaW5jKCZyZWYtPmNvdW50KTsKKwlyY3VfYXNzaWduX3BvaW50ZXIocmVmLT5leGNsLCBm
KTsKKworCWlmIChkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYsICZyZWYtPmV4Y2xfY2IsIGV4Y2xf
Y2IpKSB7CisJCVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKKwkJYXRvbWljX2Rl
YygmcmVmLT5jb3VudCk7CisJCWRtYV9mZW5jZV9wdXQoZik7CisJfQorfQorCiBpbnQgaTkxNV9h
Y3RpdmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlpbnQgZXJyOwpAQCAt
Mzk5LDYgKzQ0MSwyNSBAQCB2b2lkIGk5MTVfYWN0aXZlX3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZikKIAlfX2FjdGl2ZV91bmdyYWIocmVmKTsKIH0KIAorc3RhdGljIGludCBleGNsX3dh
aXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJc3RydWN0IGRtYV9mZW5jZSAqb2xkOwor
CWludCBlcnIgPSAwOworCisJaWYgKCFyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkKKwkJ
cmV0dXJuIDA7CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJb2xkID0gZG1hX2ZlbmNlX2dldF9yY3Vf
c2FmZSgmcmVmLT5leGNsKTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKwlpZiAob2xkKSB7CisJCWVy
ciA9IGRtYV9mZW5jZV93YWl0KG9sZCwgdHJ1ZSk7CisJCWRtYV9mZW5jZV9wdXQob2xkKTsKKwl9
CisKKwlyZXR1cm4gZXJyOworfQorCiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKIHsKIAlzdHJ1Y3QgYWN0aXZlX25vZGUgKml0LCAqbjsKQEAgLTQxOSw2ICs0
ODAsMTAgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJ
CXJldHVybiAwOwogCX0KIAorCWVyciA9IGV4Y2xfd2FpdChyZWYpOworCWlmIChlcnIpCisJCWdv
dG8gb3V0OworCiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAm
cmVmLT50cmVlLCBub2RlKSB7CiAJCWlmIChpc19iYXJyaWVyKCZpdC0+YmFzZSkpIHsgLyogdW5j
b25uZWN0ZWQgaWRsZS1iYXJyaWVyICovCiAJCQllcnIgPSAtRUJVU1k7CkBAIC00MzAsNiArNDk1
LDcgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJCQli
cmVhazsKIAl9CiAKK291dDoKIAlfX2FjdGl2ZV9yZXRpcmUocmVmKTsKIAlpZiAoZXJyKQogCQly
ZXR1cm4gZXJyOwpAQCAtNDU0LDI2ICs1MjAsMjIgQEAgaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9h
Y3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAogaW50IGk5MTVfcmVxdWVz
dF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKQogewotCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwotCWludCBlcnI7Ci0KLQlp
ZiAoUkJfRU1QVFlfUk9PVCgmcmVmLT50cmVlKSkKLQkJcmV0dXJuIDA7CisJaW50IGVyciA9IDA7
CiAKLQkvKiBhd2FpdCBhbGxvY2F0ZXMgYW5kIHNvIHdlIG5lZWQgdG8gYXZvaWQgaGl0dGluZyB0
aGUgc2hyaW5rZXIgKi8KLQllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7Ci0JaWYgKGVy
cikKLQkJcmV0dXJuIGVycjsKKwlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpIHsK
KwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQltdXRleF9sb2NrKCZyZWYtPm11dGV4KTsK
LQlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRyZWUs
IG5vZGUpIHsKLQkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHJxLCAm
aXQtPmJhc2UpOwotCQlpZiAoZXJyKQotCQkJYnJlYWs7CisJCXJjdV9yZWFkX2xvY2soKTsKKwkJ
ZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZyZWYtPmV4Y2wpOworCQlyY3VfcmVhZF91
bmxvY2soKTsKKwkJaWYgKGZlbmNlKSB7CisJCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1h
X2ZlbmNlKHJxLCBmZW5jZSk7CisJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJfQogCX0KLQlt
dXRleF91bmxvY2soJnJlZi0+bXV0ZXgpOwogCi0JaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYpOwor
CS8qIEluIHRoZSBmdXR1cmUgd2UgbWF5IGNob29zZSB0byBhd2FpdCBvbiBhbGwgZmVuY2VzICov
CisKIAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAppbmRleCBm
OTUwNThmOTkwNTcuLmJjMWM5ZDVkNGY2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5o
CkBAIC0zNzMsNiArMzczLDggQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZiwKIAkJICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCiAJCSAgICBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSk7CiAKK3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZik7CisKIGludCBpOTE1X2Fj
dGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAogaW50IGk5MTVfcmVxdWVzdF9h
d2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9hY3RpdmVfdHlwZXMuaAppbmRleCAxODU0ZTdkMTY4YzEuLjg2ZTdhMjMyZWEzYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCkBAIC04LDYgKzgsNyBAQAog
I2RlZmluZSBfSTkxNV9BQ1RJVkVfVFlQRVNfSF8KIAogI2luY2x1ZGUgPGxpbnV4L2F0b21pYy5o
PgorI2luY2x1ZGUgPGxpbnV4L2RtYS1mZW5jZS5oPgogI2luY2x1ZGUgPGxpbnV4L2xsaXN0Lmg+
CiAjaW5jbHVkZSA8bGludXgvbXV0ZXguaD4KICNpbmNsdWRlIDxsaW51eC9yYnRyZWUuaD4KQEAg
LTUxLDYgKzUyLDEwIEBAIHN0cnVjdCBpOTE1X2FjdGl2ZSB7CiAJc3RydWN0IG11dGV4IG11dGV4
OwogCWF0b21pY190IGNvdW50OwogCisJLyogUHJlYWxsb2NhdGVkICJleGNsdXNpdmUiIG5vZGUg
Ki8KKwlzdHJ1Y3QgZG1hX2ZlbmNlIF9fcmN1ICpleGNsOworCXN0cnVjdCBkbWFfZmVuY2VfY2Ig
ZXhjbF9jYjsKKwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAjZGVmaW5lIEk5MTVfQUNUSVZFX0dS
QUJfQklUIDAKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggODE0ZjYyZmNhNzI3Li42NmFi
YjQyN2FhNDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtNjIsMjAgKzYyLDMxIEBACiAj
aW5jbHVkZSAiaW50ZWxfcG0uaCIKIAogc3RhdGljIGludAotaW5zZXJ0X21hcHBhYmxlX25vZGUo
c3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwKLSAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkcm1f
bW1fbm9kZSAqbm9kZSwgdTMyIHNpemUpCitpbnNlcnRfbWFwcGFibGVfbm9kZShzdHJ1Y3QgaTkx
NV9nZ3R0ICpnZ3R0LCBzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUsIHUzMiBzaXplKQogeworCWlu
dCBlcnI7CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4
KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCiAJbWVtc2V0KG5vZGUsIDAsIHNpemVvZigq
bm9kZSkpOwotCXJldHVybiBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1t
LCBub2RlLAotCQkJCQkgICBzaXplLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAotCQkJCQkg
ICAwLCBnZ3R0LT5tYXBwYWJsZV9lbmQsCi0JCQkJCSAgIERSTV9NTV9JTlNFUlRfTE9XKTsKKwll
cnIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBub2RlLAorCQkJ
CQkgIHNpemUsIDAsIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCisJCQkJCSAgMCwgZ2d0dC0+bWFw
cGFibGVfZW5kLAorCQkJCQkgIERSTV9NTV9JTlNFUlRfTE9XKTsKKworCW11dGV4X3VubG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOworCisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGljIHZvaWQKLXJlbW92
ZV9tYXBwYWJsZV9ub2RlKHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKK3JlbW92ZV9tYXBwYWJs
ZV9ub2RlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQsIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkK
IHsKKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKG5v
ZGUpOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogfQogCiBpbnQKQEAgLTg3LDcg
Kzk4LDggQEAgaTkxNV9nZW1fZ2V0X2FwZXJ0dXJlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTY0IHBpbm5lZDsKIAot
CW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKKwlpZiAobXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZnZ3R0LT52bS5tdXRleCkpCisJCXJldHVybiAtRUlOVFI7CiAKIAlwaW5uZWQgPSBnZ3R0
LT52bS5yZXNlcnZlZDsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmdndHQtPnZtLmJvdW5k
X2xpc3QsIHZtX2xpbmspCkBAIC0xMDksMjAgKzEyMSwzMSBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0
X3VuYmluZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCUxJU1RfSEVBRChzdGls
bF9pbl9saXN0KTsKIAlpbnQgcmV0ID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+
YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci0KIAlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOwog
CXdoaWxlICghcmV0ICYmICh2bWEgPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoJm9iai0+dm1h
Lmxpc3QsCiAJCQkJCQkgICAgICAgc3RydWN0IGk5MTVfdm1hLAogCQkJCQkJICAgICAgIG9ial9s
aW5rKSkpIHsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSB2bWEtPnZtOworCisJ
CXJldCA9IC1FQlVTWTsKKwkJaWYgKCFpOTE1X3ZtX3RyeW9wZW4odm0pKQorCQkJYnJlYWs7CisK
IAkJbGlzdF9tb3ZlX3RhaWwoJnZtYS0+b2JqX2xpbmssICZzdGlsbF9pbl9saXN0KTsKIAkJc3Bp
bl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCi0JCXJldCA9IC1FQlVTWTsKIAkJaWYgKGZsYWdz
ICYgSTkxNV9HRU1fT0JKRUNUX1VOQklORF9BQ1RJVkUgfHwKLQkJICAgICFpOTE1X3ZtYV9pc19h
Y3RpdmUodm1hKSkKLQkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkgICAgIWk5MTVf
dm1hX2lzX2FjdGl2ZSh2bWEpKSB7CisJCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9
IHZtYS0+dm07CisKKwkJCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmdm0tPm11dGV4
KTsKKwkJCWlmICghcmV0KSB7CisJCQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQkJ
bXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOworCQkJfQorCQl9CiAKKwkJaTkxNV92bV9jbG9zZSh2
bSk7CiAJCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CiAJfQogCWxpc3Rfc3BsaWNlKCZzdGls
bF9pbl9saXN0LCAmb2JqLT52bWEubGlzdCk7CkBAIC0zMzgsMTAgKzM2MSw2IEBAIGk5MTVfZ2Vt
X2d0dF9wcmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXU2NCByZW1haW4s
IG9mZnNldDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJd2Fr
ZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAl2bWEgPSBF
UlJfUFRSKC1FTk9ERVYpOwogCWlmICghaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKG9iaikpCkBA
IC0zNTUsMTIgKzM3NCwxMCBAQCBpOTE1X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKIAl9IGVsc2UgewogCQlyZXQgPSBpbnNlcnRfbWFwcGFibGVfbm9kZShn
Z3R0LCAmbm9kZSwgUEFHRV9TSVpFKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gb3V0X3VubG9jazsK
KwkJCWdvdG8gb3V0X3JwbTsKIAkJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZu
b2RlKSk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CXJldCA9IGk5MTVfZ2VtX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsKIAlpZiAocmV0
KQogCQlnb3RvIG91dF91bnBpbjsKQEAgLTQxNCwxNyArNDMxLDE0IEBAIGk5MTVfZ2VtX2d0dF9w
cmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiAJaTkxNV9nZW1fb2JqZWN0
X3VubG9ja19mZW5jZShvYmosIGZlbmNlKTsKIG91dF91bnBpbjoKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZub2RlKSkg
ewogCQlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIG5vZGUuc3RhcnQsIG5vZGUuc2l6
ZSk7Ci0JCXJlbW92ZV9tYXBwYWJsZV9ub2RlKCZub2RlKTsKKwkJcmVtb3ZlX21hcHBhYmxlX25v
ZGUoZ2d0dCwgJm5vZGUpOwogCX0gZWxzZSB7CiAJCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJfQot
b3V0X3VubG9jazoKK291dF9ycG06CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRp
bWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0KIAlyZXR1cm4gcmV0OwogfQogCkBAIC01MzEsMTAgKzU0NSw2IEBAIGk5MTVfZ2VtX2d0dF9w
d3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXZvaWQgX191c2Vy
ICp1c2VyX2RhdGE7CiAJaW50IHJldDsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQog
CWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpIHsKIAkJLyoKIAkJICog
QXZvaWQgd2FraW5nIHRoZSBkZXZpY2UgdXAgaWYgd2UgY2FuIGZhbGxiYWNrLCBhcwpAQCAtNTQ0
LDEwICs1NTQsOCBAQCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKIAkJICogdXNpbmcgdGhlIGNhY2hlIGJ5cGFzcyBvZiBpbmRpcmVjdCBH
R1RUIGFjY2Vzcy4KIAkJICovCiAJCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9p
bl91c2UocnBtKTsKLQkJaWYgKCF3YWtlcmVmKSB7Ci0JCQlyZXQgPSAtRUZBVUxUOwotCQkJZ290
byBvdXRfdW5sb2NrOwotCQl9CisJCWlmICghd2FrZXJlZikKKwkJCXJldHVybiAtRUZBVUxUOwog
CX0gZWxzZSB7CiAJCS8qIE5vIGJhY2tpbmcgcGFnZXMsIG5vIGZhbGxiYWNrLCB3ZSBtdXN0IGZv
cmNlIEdHVFQgYWNjZXNzICovCiAJCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChycG0p
OwpAQCAtNTY5LDggKzU3Nyw2IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0
ZWQoJm5vZGUpKTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlm
IChyZXQpCiAJCWdvdG8gb3V0X3VucGluOwpAQCAtNjM0LDE4ICs2NDAsMTUgQEAgaTkxNV9nZW1f
Z3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1
X2dlbV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX2d0X2ZsdXNoX2dndHRfd3Jp
dGVzKGdndHQtPnZtLmd0KTsKIAlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZub2RlKSkgewog
CQlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIG5vZGUuc3RhcnQsIG5vZGUuc2l6ZSk7
Ci0JCXJlbW92ZV9tYXBwYWJsZV9ub2RlKCZub2RlKTsKKwkJcmVtb3ZlX21hcHBhYmxlX25vZGUo
Z2d0dCwgJm5vZGUpOwogCX0gZWxzZSB7CiAJCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJfQogb3V0
X3JwbToKIAlpbnRlbF9ydW50aW1lX3BtX3B1dChycG0sIHdha2VyZWYpOwotb3V0X3VubG9jazoK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9
CiAKQEAgLTk2Nyw4ICs5NzAsNiBAQCBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAlpbnQgcmV0
OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsK
LQogCWlmIChmbGFncyAmIFBJTl9NQVBQQUJMRSAmJgogCSAgICAoIXZpZXcgfHwgdmlldy0+dHlw
ZSA9PSBJOTE1X0dHVFRfVklFV19OT1JNQUwpKSB7CiAJCS8qIElmIHRoZSByZXF1aXJlZCBzcGFj
ZSBpcyBsYXJnZXIgdGhhbiB0aGUgYXZhaWxhYmxlCkBAIC0xMDIyLDcgKzEwMjMsOSBAQCBpOTE1
X2dlbV9vYmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJ
ICAgICBpOTE1X2dndHRfb2Zmc2V0KHZtYSksIGFsaWdubWVudCwKIAkJICAgICAhIShmbGFncyAm
IFBJTl9NQVBQQUJMRSksCiAJCSAgICAgaTkxNV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUodm1h
KSk7CisJCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJcmV0ID0gaTkxNV92bWFfdW5i
aW5kKHZtYSk7CisJCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCQlpZiAocmV0KQog
CQkJcmV0dXJuIEVSUl9QVFIocmV0KTsKIAl9CkBAIC0xMzI4LDcgKzEzMzEsOSBAQCBzdGF0aWMg
aW50IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiAJCSAqIGZyb20gdGhlIEdUVCB0byBwcmV2ZW50IHN1Y2ggYWNjaWRlbnRzIGFu
ZCByZWNsYWltIHRoZQogCQkgKiBzcGFjZS4KIAkJICovCisJCW11dGV4X2xvY2soJnN0YXRlLT52
bS0+bXV0ZXgpOwogCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQoc3RhdGUpOworCQltdXRleF91bmxv
Y2soJnN0YXRlLT52bS0+bXV0ZXgpOwogCQlpZiAoZXJyKQogCQkJZ290byBvdXQ7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCmluZGV4IDdhYmNhYzNiNWUyZS4uNDRmNWI2Mzhm
YTQzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ3LDggKzQ3LDcg
QEAgc3RhdGljIGludCBnZ3R0X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CSAqIGJvdW5kIGJ5IHRoZWlyIGFjdGl2ZSByZWZlcmVuY2UuCiAJICovCiAJcmV0dXJuIGk5MTVf
Z2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJM
RSB8Ci0JCQkJICAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKKwkJCQkgICAgICBJOTE1X1dBSVRfSU5U
RVJSVVBUSUJMRSwKIAkJCQkgICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiB9CiAKQEAgLTEw
NCw3ICsxMDMsNyBAQCBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0sCiAJc3RydWN0IGk5MTVfdm1hICphY3RpdmU7CiAJaW50IHJldDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwogCXRyYWNlX2k5MTVfZ2VtX2V2aWN0KHZtLCBtaW5f
c2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7CiAKIAkvKgpAQCAtMTI3LDE1ICsxMjYsNiBAQCBpOTE1
X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJ
ICAgIG1pbl9zaXplLCBhbGlnbm1lbnQsIGNhY2hlX2xldmVsLAogCQkJCSAgICBzdGFydCwgZW5k
LCBtb2RlKTsKIAotCS8qCi0JICogUmV0aXJlIGJlZm9yZSB3ZSBzZWFyY2ggdGhlIGFjdGl2ZSBs
aXN0LiBBbHRob3VnaCB3ZSBoYXZlCi0JICogcmVhc29uYWJsZSBhY2N1cmFjeSBpbiBvdXIgcmV0
aXJlbWVudCBsaXN0cywgd2UgbWF5IGhhdmUKLQkgKiBhIHN0cmF5IHBpbiAocHJldmVudGluZyBl
dmljdGlvbikgdGhhdCBjYW4gb25seSBiZSByZXNvbHZlZCBieQotCSAqIHJldGlyaW5nLgotCSAq
LwotCWlmICghKGZsYWdzICYgUElOX05PTkJMT0NLKSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMo
ZGV2X3ByaXYpOwotCiBzZWFyY2hfYWdhaW46CiAJYWN0aXZlID0gTlVMTDsKIAlJTklUX0xJU1Rf
SEVBRCgmZXZpY3Rpb25fbGlzdCk7CkBAIC0yNjksNyArMjU5LDcgQEAgaW50IGk5MTVfZ2VtX2V2
aWN0X2Zvcl9ub2RlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWJvb2wgY2hlY2tf
Y29sb3I7CiAJaW50IHJldCA9IDA7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4KTsKIAlH
RU1fQlVHX09OKCFJU19BTElHTkVEKHN0YXJ0LCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsKIAlHRU1f
QlVHX09OKCFJU19BTElHTkVEKGVuZCwgSTkxNV9HVFRfUEFHRV9TSVpFKSk7CiAKQEAgLTM3NSw3
ICszNjUsNyBAQCBpbnQgaTkxNV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0pCiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICpuZXh0OwogCWludCByZXQ7CiAKLQlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9h
c3NlcnRfaGVsZCgmdm0tPm11dGV4KTsKIAl0cmFjZV9pOTE1X2dlbV9ldmljdF92bSh2bSk7CiAK
IAkvKiBTd2l0Y2ggYmFjayB0byB0aGUgZGVmYXVsdCBjb250ZXh0IGluIG9yZGVyIHRvIHVucGlu
CkBAIC0zOTAsNyArMzgwLDYgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtKQogCX0KIAogCUlOSVRfTElTVF9IRUFEKCZldmljdGlvbl9saXN0KTsK
LQltdXRleF9sb2NrKCZ2bS0+bXV0ZXgpOwogCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmdm0t
PmJvdW5kX2xpc3QsIHZtX2xpbmspIHsKIAkJaWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKQog
CQkJY29udGludWU7CkBAIC0zOTgsNyArMzg3LDYgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X3ZtKHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwogCQls
aXN0X2FkZCgmdm1hLT5ldmljdF9saW5rLCAmZXZpY3Rpb25fbGlzdCk7CiAJfQotCW11dGV4X3Vu
bG9jaygmdm0tPm11dGV4KTsKIAogCXJldCA9IDA7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KHZtYSwgbmV4dCwgJmV2aWN0aW9uX2xpc3QsIGV2aWN0X2xpbmspIHsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKaW5kZXggNjE1YTlmNGVmMzBjLi40MTRkODM5NjY4
ZDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCkBAIC0yMzcs
NiArMjM3LDcgQEAgc3RhdGljIGludCBmZW5jZV91cGRhdGUoc3RydWN0IGk5MTVfZmVuY2VfcmVn
ICpmZW5jZSwKIAogCW9sZCA9IHhjaGcoJmZlbmNlLT52bWEsIE5VTEwpOwogCWlmIChvbGQpIHsK
KwkJLyogWFhYIElkZWFsbHkgd2Ugd291bGQgbW92ZSB0aGUgd2FpdGluZyB0byBvdXRzaWRlIHRo
ZSBtdXRleCAqLwogCQlyZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZvbGQtPmFjdGl2ZSk7CiAJCWlm
IChyZXQpIHsKIAkJCWZlbmNlLT52bWEgPSBvbGQ7CkBAIC0zMzEsMTMgKzMzMiwxNSBAQCBzdGF0
aWMgc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogCXJldHVybiBFUlJfUFRSKC1FREVBRExLKTsKIH0KIAotc3RhdGljIGludCBf
X2k5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK2ludCBfX2k5MTVfdm1h
X3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0ID0gaTkxNV92bV90b19nZ3R0KHZtYS0+dm0pOwogCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAq
ZmVuY2U7CiAJc3RydWN0IGk5MTVfdm1hICpzZXQgPSBpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQo
dm1hLT5vYmopID8gdm1hIDogTlVMTDsKIAlpbnQgZXJyOwogCisJbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmdm1hLT52bS0+bXV0ZXgpOworCiAJLyogSnVzdCB1cGRhdGUgb3VyIHBsYWNlIGluIHRoZSBM
UlUgaWYgb3VyIGZlbmNlIGlzIGdldHRpbmcgcmV1c2VkLiAqLwogCWlmICh2bWEtPmZlbmNlKSB7
CiAJCWZlbmNlID0gdm1hLT5mZW5jZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKaW5k
ZXggYmUxMDY4NjU3NmQ2Li45MWU0Y2E4NWQ4ZDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jCkBAIC0xNTAsMTYgKzE1MCwxOCBAQCBzdGF0aWMgdm9pZCBnbWNoX2dndHRfaW52YWxp
ZGF0ZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCiBzdGF0aWMgaW50IHBwZ3R0X2JpbmRfdm1h
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVf
bGV2ZWwsCi0JCQkgIHUzMiB1bnVzZWQpCisJCQkgIHUzMiBmbGFncykKIHsKIAl1MzIgcHRlX2Zs
YWdzOwogCWludCBlcnI7CiAKLQlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFf
TE9DQUxfQklORCkpIHsKKwlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9BTExPQykgewogCQllcnIgPSB2
bWEtPnZtLT5hbGxvY2F0ZV92YV9yYW5nZSh2bWEtPnZtLAogCQkJCQkJIHZtYS0+bm9kZS5zdGFy
dCwgdm1hLT5zaXplKTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7CisKKwkJc2V0X2JpdChJ
OTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSk7CiAJfQogCiAJLyogQXBw
bGljYWJsZSB0byBWTFYsIGFuZCBnZW44KyAqLwpAQCAtMTY3LDYgKzE2OSw3IEBAIHN0YXRpYyBp
bnQgcHBndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJaWYgKGk5MTVfZ2VtX29i
amVjdF9pc19yZWFkb25seSh2bWEtPm9iaikpCiAJCXB0ZV9mbGFncyB8PSBQVEVfUkVBRF9PTkxZ
OwogCisJR0VNX0JVR19PTighdGVzdF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1h
X2ZsYWdzKHZtYSkpKTsKIAl2bWEtPnZtLT5pbnNlcnRfZW50cmllcyh2bWEtPnZtLCB2bWEsIGNh
Y2hlX2xldmVsLCBwdGVfZmxhZ3MpOwogCXdtYigpOwogCkBAIC0xNzUsNyArMTc4LDggQEAgc3Rh
dGljIGludCBwcGd0dF9iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAogc3RhdGljIHZv
aWQgcHBndHRfdW5iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQl2bWEtPnZtLT5j
bGVhcl9yYW5nZSh2bWEtPnZtLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6ZSk7CisJaWYgKHRl
c3RfYW5kX2NsZWFyX2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1h
KSkpCisJCXZtYS0+dm0tPmNsZWFyX3JhbmdlKHZtYS0+dm0sIHZtYS0+bm9kZS5zdGFydCwgdm1h
LT5zaXplKTsKIH0KIAogc3RhdGljIGludCBwcGd0dF9zZXRfcGFnZXMoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCkBAIC01MDMsMTUgKzUwNywyNSBAQCBzdGF0aWMgdm9pZCBpOTE1X2FkZHJlc3Nfc3Bh
Y2VfZmluaShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAltdXRleF9kZXN0cm95KCZ2
bS0+bXV0ZXgpOwogfQogCi1zdGF0aWMgdm9pZCBwcGd0dF9kZXN0cm95X3ZtYShzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSkKK3ZvaWQgX19pOTE1X3ZtX2Nsb3NlKHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtKQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47CiAKLQltdXRl
eF9sb2NrKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JbGlzdF9mb3JfZWFjaF9lbnRy
eV9zYWZlKHZtYSwgdm4sICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykKKwltdXRleF9sb2NrKCZ2
bS0+bXV0ZXgpOworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmdm0tPmJvdW5k
X2xpc3QsIHZtX2xpbmspIHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZt
YS0+b2JqOworCisJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJm9iai0+YmFzZS5yZWZjb3Vu
dCkpCisJCQljb250aW51ZTsKKworCQlhdG9taWNfYW5kKH5JOTE1X1ZNQV9QSU5fTUFTSywgJnZt
YS0+ZmxhZ3MpOworCQlXQVJOX09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKIAkJaTkxNV92bWFf
ZGVzdHJveSh2bWEpOworCisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwl9CiAJR0VNX0JV
R19PTighbGlzdF9lbXB0eSgmdm0tPmJvdW5kX2xpc3QpKTsKLQltdXRleF91bmxvY2soJnZtLT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJnZtLT5tdXRleCk7CiB9CiAK
IHN0YXRpYyB2b2lkIF9faTkxNV92bV9yZWxlYXNlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykK
QEAgLTUxOSw4ICs1MzMsNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfdm1fcmVsZWFzZShzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspCiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPQogCQlj
b250YWluZXJfb2Yod29yaywgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSwgcmN1LndvcmspOwog
Ci0JcHBndHRfZGVzdHJveV92bWEodm0pOwotCiAJdm0tPmNsZWFudXAodm0pOwogCWk5MTVfYWRk
cmVzc19zcGFjZV9maW5pKHZtKTsKIApAQCAtNTM1LDcgKzU0Nyw2IEBAIHZvaWQgaTkxNV92bV9y
ZWxlYXNlKHN0cnVjdCBrcmVmICprcmVmKQogCUdFTV9CVUdfT04oaTkxNV9pc19nZ3R0KHZtKSk7
CiAJdHJhY2VfaTkxNV9wcGd0dF9yZWxlYXNlKHZtKTsKIAotCXZtLT5jbG9zZWQgPSB0cnVlOwog
CXF1ZXVlX3JjdV93b3JrKHZtLT5pOTE1LT53cSwgJnZtLT5yY3UpOwogfQogCkBAIC01NDMsNiAr
NTU0LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9hZGRyZXNzX3NwYWNlX2luaXQoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0sIGludCBzdWJjbGFzcykKIHsKIAlrcmVmX2luaXQoJnZtLT5yZWYp
OwogCUlOSVRfUkNVX1dPUksoJnZtLT5yY3UsIF9faTkxNV92bV9yZWxlYXNlKTsKKwlhdG9taWNf
c2V0KCZ2bS0+b3BlbiwgMSk7CiAKIAkvKgogCSAqIFRoZSB2bS0+bXV0ZXggbXVzdCBiZSByZWNs
YWltIHNhZmUgKGZvciB1c2UgaW4gdGhlIHNocmlua2VyKS4KQEAgLTE3NjksMTIgKzE3ODEsOCBA
QCBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2ZyZWVfcGQoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0
KQogc3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9jbGVhbnVwKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtKQogewogCXN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCA9IHRvX2dlbjZfcHBndHQoaTkx
NV92bV90b19wcGd0dCh2bSkpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm0t
Pmk5MTU7CiAKLQkvKiBGSVhNRSByZW1vdmUgdGhlIHN0cnVjdF9tdXRleCB0byBicmluZyB0aGUg
bG9ja2luZyB1bmRlciBjb250cm9sICovCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJaTkxNV92bWFfZGVzdHJveShwcGd0dC0+dm1hKTsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZ2VuNl9wcGd0dF9mcmVlX3BkKHBwZ3R0KTsKIAlm
cmVlX3NjcmF0Y2godm0pOwpAQCAtMTg2Myw3ICsxODcxLDggQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3ZtYSAqcGRfdm1hX2NyZWF0ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQsIGludCBzaXplKQog
CiAJaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmdm1hLT5hY3RpdmUsIE5VTEwsIE5VTEwpOwogCi0J
dm1hLT52bSA9ICZnZ3R0LT52bTsKKwltdXRleF9pbml0KCZ2bWEtPnBhZ2VzX211dGV4KTsKKwl2
bWEtPnZtID0gaTkxNV92bV9nZXQoJmdndHQtPnZtKTsKIAl2bWEtPm9wcyA9ICZwZF92bWFfb3Bz
OwogCXZtYS0+cHJpdmF0ZSA9IHBwZ3R0OwogCkBAIC0xODgzLDcgKzE4OTIsNyBAQCBpbnQgZ2Vu
Nl9wcGd0dF9waW4oc3RydWN0IGk5MTVfcHBndHQgKmJhc2UpCiAJc3RydWN0IGdlbjZfcHBndHQg
KnBwZ3R0ID0gdG9fZ2VuNl9wcGd0dChiYXNlKTsKIAlpbnQgZXJyID0gMDsKIAotCUdFTV9CVUdf
T04ocHBndHQtPmJhc2Uudm0uY2xvc2VkKTsKKwlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmcHBn
dHQtPmJhc2Uudm0ub3BlbikpOwogCiAJLyoKIAkgKiBXb3JrYXJvdW5kIHRoZSBsaW1pdGVkIG1h
eGltdW0gdm1hLT5waW5fY291bnQgYW5kIHRoZSBhbGlhc2luZ19wcGd0dApAQCAtMjQ2MCwxNCAr
MjQ2OSwxOCBAQCBzdGF0aWMgaW50IGFsaWFzaW5nX2d0dF9iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwKIAlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9MT0NBTF9CSU5EKSB7CiAJCXN0cnVjdCBp
OTE1X3BwZ3R0ICphbGlhcyA9IGk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZtKS0+YWxpYXM7CiAKLQkJ
aWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0xPQ0FMX0JJTkQpKSB7CisJCWlm
IChmbGFncyAmIEk5MTVfVk1BX0FMTE9DKSB7CiAJCQlyZXQgPSBhbGlhcy0+dm0uYWxsb2NhdGVf
dmFfcmFuZ2UoJmFsaWFzLT52bSwKIAkJCQkJCQkgIHZtYS0+bm9kZS5zdGFydCwKIAkJCQkJCQkg
IHZtYS0+c2l6ZSk7CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiByZXQ7CisKKwkJCXNldF9iaXQo
STkxNV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpOwogCQl9CiAKKwkJR0VN
X0JVR19PTighdGVzdF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULAorCQkJCSAgICAgX19pOTE1X3Zt
YV9mbGFncyh2bWEpKSk7CiAJCWFsaWFzLT52bS5pbnNlcnRfZW50cmllcygmYWxpYXMtPnZtLCB2
bWEsCiAJCQkJCSBjYWNoZV9sZXZlbCwgcHRlX2ZsYWdzKTsKIAl9CkBAIC0yNDk2LDcgKzI1MDks
NyBAQCBzdGF0aWMgdm9pZCBhbGlhc2luZ19ndHRfdW5iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIAkJCXZtLT5jbGVhcl9yYW5nZSh2bSwgdm1hLT5ub2RlLnN0YXJ0LCB2bWEtPnNpemUp
OwogCX0KIAotCWlmIChpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0xPQ0FMX0JJTkQp
KSB7CisJaWYgKHRlc3RfYW5kX2NsZWFyX2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92
bWFfZmxhZ3Modm1hKSkpIHsKIAkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPQogCQkJ
Jmk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZtKS0+YWxpYXMtPnZtOwogCkBAIC0yNTk3LDIyICsyNjEw
LDE2IEBAIHN0YXRpYyBpbnQgaW5pdF9hbGlhc2luZ19wcGd0dChzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KQogCiBzdGF0aWMgdm9pZCBmaW5pX2FsaWFzaW5nX3BwZ3R0KHN0cnVjdCBpOTE1X2dndHQg
KmdndHQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1
OwogCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCiAJcHBndHQgPSBmZXRjaF9hbmRfemVybygmZ2d0dC0+YWxpYXMpOwog
CWlmICghcHBndHQpCi0JCWdvdG8gb3V0OworCQlyZXR1cm47CiAKIAlpOTE1X3ZtX3B1dCgmcHBn
dHQtPnZtKTsKIAogCWdndHQtPnZtLnZtYV9vcHMuYmluZF92bWEgICA9IGdndHRfYmluZF92bWE7
CiAJZ2d0dC0+dm0udm1hX29wcy51bmJpbmRfdm1hID0gZ2d0dF91bmJpbmRfdm1hOwotCi1vdXQ6
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIH0KIAogc3RhdGljIGlu
dCBnZ3R0X3Jlc2VydmVfZ3VjX3RvcChzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQpAQCAtMjcyOSwx
NSArMjczNiwxNCBAQCBpbnQgaTkxNV9pbml0X2dndHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiAKIHN0YXRpYyB2b2lkIGdndHRfY2xlYW51cF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ2d0dC0+dm0uaTkxNTsK
IAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCi0JZ2d0dC0+dm0uY2xvc2VkID0gdHJ1ZTsK
KwlhdG9taWNfc2V0KCZnZ3R0LT52bS5vcGVuLCAwKTsKIAogCXJjdV9iYXJyaWVyKCk7IC8qIGZs
dXNoIHRoZSBSQ1UnZWRfX2k5MTVfdm1fcmVsZWFzZSAqLwotCWZsdXNoX3dvcmtxdWV1ZShpOTE1
LT53cSk7CisJZmx1c2hfd29ya3F1ZXVlKGdndHQtPnZtLmk5MTUtPndxKTsKIAotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4
KTsKIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmZ2d0dC0+dm0uYm91bmRf
bGlzdCwgdm1fbGluaykKIAkJV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQodm1hKSk7CkBAIC0yNzQ2
LDE1ICsyNzUyLDEyIEBAIHN0YXRpYyB2b2lkIGdndHRfY2xlYW51cF9odyhzdHJ1Y3QgaTkxNV9n
Z3R0ICpnZ3R0KQogCQlkcm1fbW1fcmVtb3ZlX25vZGUoJmdndHQtPmVycm9yX2NhcHR1cmUpOwog
CiAJZ2d0dF9yZWxlYXNlX2d1Y190b3AoZ2d0dCk7Ci0KLQlpZiAoZHJtX21tX2luaXRpYWxpemVk
KCZnZ3R0LT52bS5tbSkpIHsKLQkJaW50ZWxfdmd0X2RlYmFsbG9vbihnZ3R0KTsKLQkJaTkxNV9h
ZGRyZXNzX3NwYWNlX2ZpbmkoJmdndHQtPnZtKTsKLQl9CisJaW50ZWxfdmd0X2RlYmFsbG9vbihn
Z3R0KTsKIAogCWdndHQtPnZtLmNsZWFudXAoJmdndHQtPnZtKTsKIAotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CisJaTkxNV9hZGRyZXNzX3NwYWNlX2ZpbmkoJmdndHQtPnZtKTsKIAogCWFyY2hfcGh5c193Y19k
ZWwoZ2d0dC0+bXRycik7CiAJaW9fbWFwcGluZ19maW5pKCZnZ3R0LT5pb21hcCk7CkBAIC0zMTgz
LDkgKzMxODYsNiBAQCBpbnQgaTkxNV9nZ3R0X3Byb2JlX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogc3RhdGljIGludCBnZ3R0X2luaXRfaHcoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0
dCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGdndHQtPnZtLmk5MTU7Ci0J
aW50IHJldCA9IDA7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAog
CWk5MTVfYWRkcmVzc19zcGFjZV9pbml0KCZnZ3R0LT52bSwgVk1fQ0xBU1NfR0dUVCk7CiAKQEAg
LTMyMDEsMTggKzMyMDEsMTQgQEAgc3RhdGljIGludCBnZ3R0X2luaXRfaHcoc3RydWN0IGk5MTVf
Z2d0dCAqZ2d0dCkKIAkJCQlnZ3R0LT5nbWFkci5zdGFydCwKIAkJCQlnZ3R0LT5tYXBwYWJsZV9l
bmQpKSB7CiAJCWdndHQtPnZtLmNsZWFudXAoJmdndHQtPnZtKTsKLQkJcmV0ID0gLUVJTzsKLQkJ
Z290byBvdXQ7CisJCXJldHVybiAtRUlPOwogCX0KIAogCWdndHQtPm10cnIgPSBhcmNoX3BoeXNf
d2NfYWRkKGdndHQtPmdtYWRyLnN0YXJ0LCBnZ3R0LT5tYXBwYWJsZV9lbmQpOwogCiAJaTkxNV9n
Z3R0X2luaXRfZmVuY2VzKGdndHQpOwogCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKLQotCXJldHVybiByZXQ7CisJcmV0dXJuIDA7CiB9CiAKIC8qKgpAQCAt
MzI4NCw2ICszMjgwLDcgQEAgc3RhdGljIHZvaWQgZ2d0dF9yZXN0b3JlX21hcHBpbmdzKHN0cnVj
dCBpOTE1X2dndHQgKmdndHQpCiB7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICp2bjsKIAlib29s
IGZsdXNoID0gZmFsc2U7CisJaW50IG9wZW47CiAKIAlpbnRlbF9ndF9jaGVja19hbmRfY2xlYXJf
ZmF1bHRzKGdndHQtPnZtLmd0KTsKIApAQCAtMzI5MSw3ICszMjg4LDkgQEAgc3RhdGljIHZvaWQg
Z2d0dF9yZXN0b3JlX21hcHBpbmdzKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAKIAkvKiBGaXJz
dCBmaWxsIG91ciBwb3J0aW9uIG9mIHRoZSBHVFQgd2l0aCBzY3JhdGNoIHBhZ2VzICovCiAJZ2d0
dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCAwLCBnZ3R0LT52bS50b3RhbCk7Ci0JZ2d0dC0+
dm0uY2xvc2VkID0gdHJ1ZTsgLyogc2tpcCByZXdyaXRpbmcgUFRFIG9uIFZNQSB1bmJpbmQgKi8K
KworCS8qIFNraXAgcmV3cml0aW5nIFBURSBvbiBWTUEgdW5iaW5kLiAqLworCW9wZW4gPSBhdG9t
aWNfeGNoZygmZ2d0dC0+dm0ub3BlbiwgMCk7CiAKIAkvKiBjbGZsdXNoIG9iamVjdHMgYm91bmQg
aW50byB0aGUgR0dUVCBhbmQgcmViaW5kIHRoZW0uICovCiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlKHZtYSwgdm4sICZnZ3R0LT52bS5ib3VuZF9saXN0LCB2bV9saW5rKSB7CkBAIC0zMzAwLDI0
ICszMjk5LDIwIEBAIHN0YXRpYyB2b2lkIGdndHRfcmVzdG9yZV9tYXBwaW5ncyhzdHJ1Y3QgaTkx
NV9nZ3R0ICpnZ3R0KQogCQlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfR0xP
QkFMX0JJTkQpKQogCQkJY29udGludWU7CiAKLQkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRl
eCk7Ci0KIAkJaWYgKCFpOTE1X3ZtYV91bmJpbmQodm1hKSkKLQkJCWdvdG8gbG9jazsKKwkJCWNv
bnRpbnVlOwogCisJCWNsZWFyX2JpdChJOTE1X1ZNQV9HTE9CQUxfQklORF9CSVQsIF9faTkxNV92
bWFfZmxhZ3Modm1hKSk7CiAJCVdBUk5fT04oaTkxNV92bWFfYmluZCh2bWEsCiAJCQkJICAgICAg
b2JqID8gb2JqLT5jYWNoZV9sZXZlbCA6IDAsCi0JCQkJICAgICAgUElOX1VQREFURSkpOworCQkJ
CSAgICAgIFBJTl9HTE9CQUwsIE5VTEwpKTsKIAkJaWYgKG9iaikgeyAvKiBvbmx5IHVzZWQgZHVy
aW5nIHJlc3VtZSA9PiBleGNsdXNpdmUgYWNjZXNzICovCiAJCQlmbHVzaCB8PSBmZXRjaF9hbmRf
emVybygmb2JqLT53cml0ZV9kb21haW4pOwogCQkJb2JqLT5yZWFkX2RvbWFpbnMgfD0gSTkxNV9H
RU1fRE9NQUlOX0dUVDsKIAkJfQotCi1sb2NrOgotCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRl
eCk7CiAJfQogCi0JZ2d0dC0+dm0uY2xvc2VkID0gZmFsc2U7CisJYXRvbWljX3NldCgmZ2d0dC0+
dm0ub3Blbiwgb3Blbik7CiAJZ2d0dC0+aW52YWxpZGF0ZShnZ3R0KTsKIAogCW11dGV4X3VubG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwpAQCAtMzcwOSw3ICszNzA0LDggQEAgaW50IGk5MTVfZ2VtX2d0
dF9pbnNlcnQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJdTY0IG9mZnNldDsKIAlp
bnQgZXJyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CisKIAlHRU1fQlVHX09OKCFz
aXplKTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVEKHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRSkp
OwogCUdFTV9CVUdfT04oYWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdubWVudCkpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAppbmRleCAwMDdiZGFmNGJhMDAuLjNmOWQxODc3
YWZmZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKQEAgLTMwNyw3ICszMDcsNyBA
QCBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlIHsKIAogCXVuc2lnbmVkIGludCBiaW5kX2FsbG9j
OwogCi0JYm9vbCBjbG9zZWQ7CisJYXRvbWljX3Qgb3BlbjsKIAogCXN0cnVjdCBtdXRleCBtdXRl
eDsgLyogcHJvdGVjdHMgdm1hIGFuZCBvdXIgbGlzdHMgKi8KICNkZWZpbmUgVk1fQ0xBU1NfR0dU
VCAwCkBAIC01NzUsNiArNTc1LDM1IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ZtX3B1dChz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlrcmVmX3B1dCgmdm0tPnJlZiwgaTkxNV92
bV9yZWxlYXNlKTsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICoKK2k5MTVfdm1fb3BlbihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sKKwlHRU1f
QlVHX09OKCFhdG9taWNfcmVhZCgmdm0tPm9wZW4pKTsKKwlhdG9taWNfaW5jKCZ2bS0+b3Blbik7
CisJcmV0dXJuIGk5MTVfdm1fZ2V0KHZtKTsKK30KKworc3RhdGljIGlubGluZSBib29sCitpOTE1
X3ZtX3RyeW9wZW4oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7CisJaWYgKGF0b21p
Y19hZGRfdW5sZXNzKCZ2bS0+b3BlbiwgMSwgMCkpCisJCXJldHVybiBpOTE1X3ZtX2dldCh2bSk7
CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3ZvaWQgX19pOTE1X3ZtX2Nsb3NlKHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtKTsKKworc3RhdGljIGlubGluZSB2b2lkCitpOTE1X3ZtX2Nsb3Nl
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCUdFTV9CVUdfT04oIWF0b21pY19y
ZWFkKCZ2bS0+b3BlbikpOworCWlmIChhdG9taWNfZGVjX2FuZF90ZXN0KCZ2bS0+b3BlbikpCisJ
CV9faTkxNV92bV9jbG9zZSh2bSk7CisKKwlpOTE1X3ZtX3B1dCh2bSk7Cit9CisKIGludCBnZW42
X3BwZ3R0X3BpbihzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CiB2b2lkIGdlbjZfcHBndHRfdW5w
aW4oc3RydWN0IGk5MTVfcHBndHQgKmJhc2UpOwogdm9pZCBnZW42X3BwZ3R0X3VucGluX2FsbChz
dHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDJj
OWY0NmUxMjYyMi4uN2M2NWE2YTQwYTA0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAt
MTIwNCwxNSArMTIwNCwxMCBAQCBzdGF0aWMgaW50IGk5MTVfb2FfcmVhZChzdHJ1Y3QgaTkxNV9w
ZXJmX3N0cmVhbSAqc3RyZWFtLAogc3RhdGljIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpvYV9waW5f
Y29udGV4dChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewogCXN0cnVjdCBpOTE1
X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBz
dHJlYW0tPmRldl9wcml2OwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBzdHJlYW0t
PmN0eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVycjsKIAotCWVyciA9IGk5
MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0pOwotCWlmIChlcnIpCi0JCXJl
dHVybiBFUlJfUFRSKGVycik7Ci0KIAlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9j
b250ZXh0X2xvY2tfZW5naW5lcyhjdHgpLCBpdCkgewogCQlpZiAoY2UtPmVuZ2luZS0+Y2xhc3Mg
IT0gUkVOREVSX0NMQVNTKQogCQkJY29udGludWU7CkBAIC0xMjI5LDEwICsxMjI0LDYgQEAgc3Rh
dGljIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpvYV9waW5fY29udGV4dChzdHJ1Y3QgaTkxNV9wZXJm
X3N0cmVhbSAqc3RyZWFtKQogCX0KIAlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0
eCk7CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChlcnIp
Ci0JCXJldHVybiBFUlJfUFRSKGVycik7Ci0KIAlyZXR1cm4gc3RyZWFtLT5waW5uZWRfY3R4Owog
fQogCkBAIC0xMzMxLDMyICsxMzIyLDIyIEBAIHN0YXRpYyBpbnQgb2FfZ2V0X3JlbmRlcl9jdHhf
aWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKICAqLwogc3RhdGljIHZvaWQgb2Ff
cHV0X3JlbmRlcl9jdHhfaWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OwogCXN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAogCXN0cmVhbS0+c3BlY2lmaWNfY3R4X2lkID0gSU5W
QUxJRF9DVFhfSUQ7CiAJc3RyZWFtLT5zcGVjaWZpY19jdHhfaWRfbWFzayA9IDA7CiAKIAljZSA9
IGZldGNoX2FuZF96ZXJvKCZzdHJlYW0tPnBpbm5lZF9jdHgpOwotCWlmIChjZSkgewotCQltdXRl
eF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaWYgKGNlKQogCQlpbnRlbF9j
b250ZXh0X3VucGluKGNlKTsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0JfQogfQogCiBzdGF0aWMgdm9pZAogZnJlZV9vYV9idWZmZXIoc3RydWN0IGk5MTVf
cGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHN0cmVhbS0+ZGV2X3ByaXY7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZzdHJlYW0tPm9hX2J1ZmZlci52bWEs
CiAJCQkJICAgSTkxNV9WTUFfUkVMRUFTRV9NQVApOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQogCXN0cmVhbS0+b2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKIH0K
IApAQCAtMTUxMSwxOCArMTQ5MiwxMyBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCWlmIChXQVJOX09OKHN0cmVhbS0+b2FfYnVm
ZmVyLnZtYSkpCiAJCXJldHVybiAtRU5PREVWOwogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoJmRldl9wcml2LT5kcm0pOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0K
IAlCVUlMRF9CVUdfT05fTk9UX1BPV0VSX09GXzIoT0FfQlVGRkVSX1NJWkUpOwogCUJVSUxEX0JV
R19PTihPQV9CVUZGRVJfU0laRSA8IFNaXzEyOEsgfHwgT0FfQlVGRkVSX1NJWkUgPiBTWl8xNk0p
OwogCiAJYm8gPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBPQV9CVUZG
RVJfU0laRSk7CiAJaWYgKElTX0VSUihibykpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYWxs
b2NhdGUgT0EgYnVmZmVyXG4iKTsKLQkJcmV0ID0gUFRSX0VSUihibyk7Ci0JCWdvdG8gdW5sb2Nr
OworCQlyZXR1cm4gUFRSX0VSUihibyk7CiAJfQogCiAJaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNo
ZV9jb2hlcmVuY3koYm8sIEk5MTVfQ0FDSEVfTExDKTsKQEAgLTE1NDYsNyArMTUyMiw3IEBAIHN0
YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0p
CiAJCQkgaTkxNV9nZ3R0X29mZnNldChzdHJlYW0tPm9hX2J1ZmZlci52bWEpLAogCQkJIHN0cmVh
bS0+b2FfYnVmZmVyLnZhZGRyKTsKIAotCWdvdG8gdW5sb2NrOworCXJldHVybiAwOwogCiBlcnJf
dW5waW46CiAJX19pOTE1X3ZtYV91bnBpbih2bWEpOwpAQCAtMTU1Nyw4ICsxNTMzLDYgQEAgc3Rh
dGljIGludCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkK
IAlzdHJlYW0tPm9hX2J1ZmZlci52YWRkciA9IE5VTEw7CiAJc3RyZWFtLT5vYV9idWZmZXIudm1h
ID0gTlVMTDsKIAotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IDlh
ZGI4NWJhNmRhYS4uMTcyZjI0Mjc1NWU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTMy
LDYgKzMyLDcgQEAKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9nbG9i
YWxzLmgiCisjaW5jbHVkZSAiaTkxNV9zd19mZW5jZV93b3JrLmgiCiAjaW5jbHVkZSAiaTkxNV90
cmFjZS5oIgogI2luY2x1ZGUgImk5MTVfdm1hLmgiCiAKQEAgLTExMCw3ICsxMTEsOCBAQCB2bWFf
Y3JlYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJaWYgKHZtYSA9PSBOVUxM
KQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCXZtYS0+dm0gPSB2bTsKKwltdXRleF9p
bml0KCZ2bWEtPnBhZ2VzX211dGV4KTsKKwl2bWEtPnZtID0gaTkxNV92bV9nZXQodm0pOwogCXZt
YS0+b3BzID0gJnZtLT52bWFfb3BzOwogCXZtYS0+b2JqID0gb2JqOwogCXZtYS0+cmVzdiA9IG9i
ai0+YmFzZS5yZXN2OwpAQCAtMjYxLDggKzI2Myw2IEBAIHZtYV9sb29rdXAoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKICAqIE9uY2UgY3JlYXRlZCwgdGhlIFZNQSBpcyBrZXB0IHVu
dGlsIGVpdGhlciB0aGUgb2JqZWN0IGlzIGZyZWVkLCBvciB0aGUKICAqIGFkZHJlc3Mgc3BhY2Ug
aXMgY2xvc2VkLgogICoKLSAqIE11c3QgYmUgY2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhlbGQu
Ci0gKgogICogUmV0dXJucyB0aGUgdm1hLCBvciBhbiBlcnJvciBwb2ludGVyLgogICovCiBzdHJ1
Y3QgaTkxNV92bWEgKgpAQCAtMjczLDcgKzI3Myw3IEBAIGk5MTVfdm1hX2luc3RhbmNlKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAKIAlH
RU1fQlVHX09OKHZpZXcgJiYgIWk5MTVfaXNfZ2d0dCh2bSkpOwotCUdFTV9CVUdfT04odm0tPmNs
b3NlZCk7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnZtLT5vcGVuKSk7CiAKIAlzcGluX2xv
Y2soJm9iai0+dm1hLmxvY2spOwogCXZtYSA9IHZtYV9sb29rdXAob2JqLCB2bSwgdmlldyk7CkBA
IC0yODcsMTggKzI4Nyw2MyBAQCBpOTE1X3ZtYV9pbnN0YW5jZShzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAogCXJldHVybiB2bWE7CiB9CiAKK3N0cnVjdCBpOTE1X3ZtYV93b3JrIHsK
KwlzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgYmFzZTsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwll
bnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWw7CisJdW5zaWduZWQgaW50IGZsYWdzOwor
fTsKKworc3RhdGljIGludCBfX3ZtYV9iaW5kKHN0cnVjdCBkbWFfZmVuY2Vfd29yayAqd29yaykK
K3sKKwlzdHJ1Y3QgaTkxNV92bWFfd29yayAqdncgPSBjb250YWluZXJfb2Yod29yaywgdHlwZW9m
KCp2dyksIGJhc2UpOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gdnctPnZtYTsKKwlpbnQgZXJy
OworCisJZXJyID0gdm1hLT5vcHMtPmJpbmRfdm1hKHZtYSwgdnctPmNhY2hlX2xldmVsLCB2dy0+
ZmxhZ3MpOworCWlmIChlcnIpCisJCWF0b21pY19vcihJOTE1X1ZNQV9FUlJPUiwgJnZtYS0+Zmxh
Z3MpOworCisJaWYgKHZtYS0+b2JqKQorCQlfX2k5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyh2
bWEtPm9iaik7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGRtYV9m
ZW5jZV93b3JrX29wcyBiaW5kX29wcyA9IHsKKwkubmFtZSA9ICJiaW5kIiwKKwkud29yayA9IF9f
dm1hX2JpbmQsCit9OworCitzdHJ1Y3QgaTkxNV92bWFfd29yayAqaTkxNV92bWFfd29yayh2b2lk
KQoreworCXN0cnVjdCBpOTE1X3ZtYV93b3JrICp2dzsKKworCXZ3ID0ga3phbGxvYyhzaXplb2Yo
KnZ3KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCF2dykKKwkJcmV0dXJuIE5VTEw7CisKKwlkbWFfZmVu
Y2Vfd29ya19pbml0KCZ2dy0+YmFzZSwgJmJpbmRfb3BzKTsKKwl2dy0+YmFzZS5kbWEuZXJyb3Ig
PSAtRUFHQUlOOyAvKiBkaXNhYmxlIHRoZSB3b3JrZXIgYnkgZGVmYXVsdCAqLworCisJcmV0dXJu
IHZ3OworfQorCiAvKioKICAqIGk5MTVfdm1hX2JpbmQgLSBTZXRzIHVwIFBURXMgZm9yIGFuIFZN
QSBpbiBpdCdzIGNvcnJlc3BvbmRpbmcgYWRkcmVzcyBzcGFjZS4KICAqIEB2bWE6IFZNQSB0byBt
YXAKICAqIEBjYWNoZV9sZXZlbDogbWFwcGluZyBjYWNoZSBsZXZlbAogICogQGZsYWdzOiBmbGFn
cyBsaWtlIGdsb2JhbCBvciBsb2NhbCBtYXBwaW5nCisgKiBAd29yazogcHJlYWxsb2NhdGVkIHdv
cmtlciBmb3IgYWxsb2NhdGluZyBhbmQgYmluZGluZyB0aGUgUFRFCiAgKgogICogRE1BIGFkZHJl
c3NlcyBhcmUgdGFrZW4gZnJvbSB0aGUgc2NhdHRlci1nYXRoZXIgdGFibGUgb2YgdGhpcyBvYmpl
Y3QgKG9yIG9mCiAgKiB0aGlzIFZNQSBpbiBjYXNlIG9mIG5vbi1kZWZhdWx0IEdHVFQgdmlld3Mp
IGFuZCBQVEUgZW50cmllcyBzZXQgdXAuCiAgKiBOb3RlIHRoYXQgRE1BIGFkZHJlc3NlcyBhcmUg
YWxzbyB0aGUgb25seSBwYXJ0IG9mIHRoZSBTRyB0YWJsZSB3ZSBjYXJlIGFib3V0LgogICovCi1p
bnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgZW51bSBpOTE1X2NhY2hlX2xl
dmVsIGNhY2hlX2xldmVsLAotCQkgIHUzMiBmbGFncykKK2ludCBpOTE1X3ZtYV9iaW5kKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLAorCQkgIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwK
KwkJICB1MzIgZmxhZ3MsCisJCSAgc3RydWN0IGk5MTVfdm1hX3dvcmsgKndvcmspCiB7CiAJdTMy
IGJpbmRfZmxhZ3M7CiAJdTMyIHZtYV9mbGFnczsKQEAgLTMxNSwxMSArMzYwLDggQEAgaW50IGk5
MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBj
YWNoZV9sZXZlbCwKIAlpZiAoR0VNX0RFQlVHX1dBUk5fT04oIWZsYWdzKSkKIAkJcmV0dXJuIC1F
SU5WQUw7CiAKLQliaW5kX2ZsYWdzID0gMDsKLQlpZiAoZmxhZ3MgJiBQSU5fR0xPQkFMKQotCQli
aW5kX2ZsYWdzIHw9IEk5MTVfVk1BX0dMT0JBTF9CSU5EOwotCWlmIChmbGFncyAmIFBJTl9VU0VS
KQotCQliaW5kX2ZsYWdzIHw9IEk5MTVfVk1BX0xPQ0FMX0JJTkQ7CisJYmluZF9mbGFncyA9IGZs
YWdzOworCWJpbmRfZmxhZ3MgJj0gSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NB
TF9CSU5EOwogCiAJdm1hX2ZsYWdzID0gYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpOwogCXZtYV9m
bGFncyAmPSBJOTE1X1ZNQV9HTE9CQUxfQklORCB8IEk5MTVfVk1BX0xPQ0FMX0JJTkQ7CkBAIC0z
MzMsOSArMzc1LDMxIEBAIGludCBpOTE1X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBl
bnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCiAJR0VNX0JVR19PTighdm1hLT5wYWdl
cyk7CiAKIAl0cmFjZV9pOTE1X3ZtYV9iaW5kKHZtYSwgYmluZF9mbGFncyk7Ci0JcmV0ID0gdm1h
LT5vcHMtPmJpbmRfdm1hKHZtYSwgY2FjaGVfbGV2ZWwsIGJpbmRfZmxhZ3MpOwotCWlmIChyZXQp
Ci0JCXJldHVybiByZXQ7CisJaWYgKHdvcmsgJiYgKGJpbmRfZmxhZ3MgJiB+dm1hX2ZsYWdzKSAm
IHZtYS0+dm0tPmJpbmRfYWxsb2MpIHsKKwkJd29yay0+dm1hID0gdm1hOworCQl3b3JrLT5jYWNo
ZV9sZXZlbCA9IGNhY2hlX2xldmVsOworCQl3b3JrLT5mbGFncyA9IGJpbmRfZmxhZ3MgfCBJOTE1
X1ZNQV9BTExPQzsKKworCQkvKgorCQkgKiBOb3RlIHdlIG9ubHkgd2FudCB0byBjaGFpbiB1cCB0
byB0aGUgbWlncmF0aW9uIGZlbmNlIG9uCisJCSAqIHRoZSBwYWdlcyAobm90IHRoZSBvYmplY3Qg
aXRzZWxmKS4gQXMgd2UgZG9uJ3QgdHJhY2sgdGhhdCwKKwkJICogeWV0LCB3ZSBoYXZlIHRvIHVz
ZSB0aGUgZXhjbHVzaXZlIGZlbmNlIGluc3RlYWQuCisJCSAqCisJCSAqIEFsc28gbm90ZSB0aGF0
IHdlIGRvIG5vdCB3YW50IHRvIHRyYWNrIHRoZSBhc3luYyB2bWEgYXMKKwkJICogcGFydCBvZiB0
aGUgb2JqLT5yZXN2LT5leGNsX2ZlbmNlIGFzIGl0IG9ubHkgYWZmZWN0cworCQkgKiBleGVjdXRp
b24gYW5kIG5vdCBjb250ZW50IG9yIG9iamVjdCdzIGJhY2tpbmcgc3RvcmUgbGlmZXRpbWUuCisJ
CSAqLworCQlpOTE1X2FjdGl2ZV9zZXRfZXhjbHVzaXZlKCZ2bWEtPmFjdGl2ZSwgJndvcmstPmJh
c2UuZG1hKTsKKwkJd29yay0+YmFzZS5kbWEuZXJyb3IgPSAwOyAvKiBlbmFibGUgdGhlIHF1ZXVl
X3dvcmsoKSAqLworCisJCWlmICh2bWEtPm9iaikKKwkJCV9faTkxNV9nZW1fb2JqZWN0X3Bpbl9w
YWdlcyh2bWEtPm9iaik7CisJfSBlbHNlIHsKKwkJR0VNX0JVR19PTigoYmluZF9mbGFncyAmIH52
bWFfZmxhZ3MpICYgdm1hLT52bS0+YmluZF9hbGxvYyk7CisJCXJldCA9IHZtYS0+b3BzLT5iaW5k
X3ZtYSh2bWEsIGNhY2hlX2xldmVsLCBiaW5kX2ZsYWdzKTsKKwkJaWYgKHJldCkKKwkJCXJldHVy
biByZXQ7CisJfQogCiAJYXRvbWljX29yKGJpbmRfZmxhZ3MsICZ2bWEtPmZsYWdzKTsKIAlyZXR1
cm4gMDsKQEAgLTM0OCw5ICs0MTIsNyBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21h
cChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogCS8qIEFjY2VzcyB0aHJvdWdoIHRoZSBHVFQgcmVx
dWlyZXMgdGhlIGRldmljZSB0byBiZSBhd2FrZS4gKi8KIAlhc3NlcnRfcnBtX3dha2Vsb2NrX2hl
bGQoJnZtYS0+dm0tPmk5MTUtPnJ1bnRpbWVfcG0pOwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgm
dm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKFdBUk5fT04oIWk5MTVfdm1h
X2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpKSB7CisJaWYgKEdFTV9XQVJOX09OKCFpOTE1X3Zt
YV9pc19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKSkgewogCQllcnIgPSAtRU5PREVWOwogCQlnb3Rv
IGVycjsKIAl9CkBAIC0zNjgsNyArNDMwLDggQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5f
aW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJCQlnb3RvIGVycjsKIAkJfQogCi0JCXZtYS0+
aW9tYXAgPSBwdHI7CisJCWlmICh1bmxpa2VseShjbXB4Y2hnKCZ2bWEtPmlvbWFwLCBOVUxMLCBw
dHIpKSkKKwkJCWlvX21hcHBpbmdfdW5tYXAocHRyKTsKIAl9CiAKIAlfX2k5MTVfdm1hX3Bpbih2
bWEpOwpAQCAtMzg4LDE4ICs0NTEsMTIgQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9t
YXAoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIHZvaWQgaTkxNV92bWFfZmx1c2hfd3JpdGVzKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCWlmICghaTkxNV92bWFfaGFzX2dndHRfd3JpdGUodm1h
KSkKLQkJcmV0dXJuOwotCi0JaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXModm1hLT52bS0+Z3Qp
OwotCi0JaTkxNV92bWFfdW5zZXRfZ2d0dF93cml0ZSh2bWEpOworCWlmIChpOTE1X3ZtYV91bnNl
dF9nZ3R0X3dyaXRlKHZtYSkpCisJCWludGVsX2d0X2ZsdXNoX2dndHRfd3JpdGVzKHZtYS0+dm0t
Pmd0KTsKIH0KIAogdm9pZCBpOTE1X3ZtYV91bnBpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCUdFTV9CVUdfT04odm1hLT5pb21hcCA9PSBOVUxMKTsKIAogCWk5MTVfdm1hX2Zs
dXNoX3dyaXRlcyh2bWEpOwpAQCAtNTM4LDcgKzU5NSw2IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9i
aW5kX2NvdW50KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiBzdGF0aWMg
aW50CiBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQg
YWxpZ25tZW50LCB1NjQgZmxhZ3MpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdm1hLT52bS0+aTkxNTsKIAl1bnNpZ25lZCBpbnQgY2FjaGVfbGV2ZWw7CiAJdTY0IHN0
YXJ0LCBlbmQ7CiAJaW50IHJldDsKQEAgLTU2NCw3ICs2MjAsNyBAQCBpOTE1X3ZtYV9pbnNlcnQo
c3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3Mp
CiAKIAllbmQgPSB2bWEtPnZtLT50b3RhbDsKIAlpZiAoZmxhZ3MgJiBQSU5fTUFQUEFCTEUpCi0J
CWVuZCA9IG1pbl90KHU2NCwgZW5kLCBkZXZfcHJpdi0+Z2d0dC5tYXBwYWJsZV9lbmQpOworCQll
bmQgPSBtaW5fdCh1NjQsIGVuZCwgaTkxNV92bV90b19nZ3R0KHZtYS0+dm0pLT5tYXBwYWJsZV9l
bmQpOwogCWlmIChmbGFncyAmIFBJTl9aT05FXzRHKQogCQllbmQgPSBtaW5fdCh1NjQsIGVuZCwg
KDFVTEwgPDwgMzIpIC0gSTkxNV9HVFRfUEFHRV9TSVpFKTsKIAlHRU1fQlVHX09OKCFJU19BTElH
TkVEKGVuZCwgSTkxNV9HVFRfUEFHRV9TSVpFKSk7CkBAIC01ODAsMzUgKzYzNiwyMSBAQCBpOTE1
X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50
LCB1NjQgZmxhZ3MpCiAJCXJldHVybiAtRU5PU1BDOwogCX0KIAotCWlmICh2bWEtPm9iaikgewot
CQlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKHZtYS0+b2JqKTsKLQkJaWYgKHJldCkK
LQkJCXJldHVybiByZXQ7Ci0KKwljYWNoZV9sZXZlbCA9IDA7CisJaWYgKHZtYS0+b2JqKQogCQlj
YWNoZV9sZXZlbCA9IHZtYS0+b2JqLT5jYWNoZV9sZXZlbDsKLQl9IGVsc2UgewotCQljYWNoZV9s
ZXZlbCA9IDA7Ci0JfQotCi0JR0VNX0JVR19PTih2bWEtPnBhZ2VzKTsKLQotCXJldCA9IHZtYS0+
b3BzLT5zZXRfcGFnZXModm1hKTsKLQlpZiAocmV0KQotCQlnb3RvIGVycl91bnBpbjsKIAogCWlm
IChmbGFncyAmIFBJTl9PRkZTRVRfRklYRUQpIHsKIAkJdTY0IG9mZnNldCA9IGZsYWdzICYgUElO
X09GRlNFVF9NQVNLOwogCQlpZiAoIUlTX0FMSUdORUQob2Zmc2V0LCBhbGlnbm1lbnQpIHx8Ci0J
CSAgICByYW5nZV9vdmVyZmxvd3Mob2Zmc2V0LCBzaXplLCBlbmQpKSB7Ci0JCQlyZXQgPSAtRUlO
VkFMOwotCQkJZ290byBlcnJfY2xlYXI7Ci0JCX0KKwkJICAgIHJhbmdlX292ZXJmbG93cyhvZmZz
ZXQsIHNpemUsIGVuZCkpCisJCQlyZXR1cm4gLUVJTlZBTDsKIAogCQlyZXQgPSBpOTE1X2dlbV9n
dHRfcmVzZXJ2ZSh2bWEtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBzaXplLCBvZmZzZXQsIGNh
Y2hlX2xldmVsLAogCQkJCQkgICBmbGFncyk7CiAJCWlmIChyZXQpCi0JCQlnb3RvIGVycl9jbGVh
cjsKKwkJCXJldHVybiByZXQ7CiAJfSBlbHNlIHsKIAkJLyoKIAkJICogV2Ugb25seSBzdXBwb3J0
IGh1Z2UgZ3R0IHBhZ2VzIHRocm91Z2ggdGhlIDQ4YiBQUEdUVCwKQEAgLTY0Nyw3ICs2ODksNyBA
QCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxp
Z25tZW50LCB1NjQgZmxhZ3MpCiAJCQkJCSAgc2l6ZSwgYWxpZ25tZW50LCBjYWNoZV9sZXZlbCwK
IAkJCQkJICBzdGFydCwgZW5kLCBmbGFncyk7CiAJCWlmIChyZXQpCi0JCQlnb3RvIGVycl9jbGVh
cjsKKwkJCXJldHVybiByZXQ7CiAKIAkJR0VNX0JVR19PTih2bWEtPm5vZGUuc3RhcnQgPCBzdGFy
dCk7CiAJCUdFTV9CVUdfT04odm1hLT5ub2RlLnN0YXJ0ICsgdm1hLT5ub2RlLnNpemUgPiBlbmQp
OwpAQCAtNjU1LDIzICs2OTcsMTUgQEAgaTkxNV92bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAq
dm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogCUdFTV9CVUdfT04oIWRy
bV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAJR0VNX0JVR19PTighaTkxNV9nZW1f
dmFsaWRfZ3R0X3NwYWNlKHZtYSwgY2FjaGVfbGV2ZWwpKTsKIAotCW11dGV4X2xvY2soJnZtYS0+
dm0tPm11dGV4KTsKIAlsaXN0X2FkZF90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5ib3Vu
ZF9saXN0KTsKLQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAogCWlmICh2bWEtPm9i
aikgeworCQlhdG9taWNfaW5jKCZ2bWEtPm9iai0+bW0ucGFnZXNfcGluX2NvdW50KTsKIAkJYXRv
bWljX2luYygmdm1hLT5vYmotPmJpbmRfY291bnQpOwogCQlhc3NlcnRfYmluZF9jb3VudCh2bWEt
Pm9iaik7CiAJfQogCiAJcmV0dXJuIDA7Ci0KLWVycl9jbGVhcjoKLQl2bWEtPm9wcy0+Y2xlYXJf
cGFnZXModm1hKTsKLWVycl91bnBpbjoKLQlpZiAodm1hLT5vYmopCi0JCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9wYWdlcyh2bWEtPm9iaik7Ci0JcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIHZvaWQK
QEAgLTY4MCwxMiArNzE0LDcgQEAgaTkxNV92bWFfcmVtb3ZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQogCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAJR0VN
X0JVR19PTihpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0dMT0JBTF9CSU5EIHwgSTkx
NV9WTUFfTE9DQUxfQklORCkpOwogCi0Jdm1hLT5vcHMtPmNsZWFyX3BhZ2VzKHZtYSk7Ci0KLQlt
dXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7Ci0JZHJtX21tX3JlbW92ZV9ub2RlKCZ2bWEtPm5v
ZGUpOwogCWxpc3RfZGVsKCZ2bWEtPnZtX2xpbmspOwotCW11dGV4X3VubG9jaygmdm1hLT52bS0+
bXV0ZXgpOwogCiAJLyoKIAkgKiBTaW5jZSB0aGUgdW5ib3VuZCBsaXN0IGlzIGdsb2JhbCwgb25s
eSBtb3ZlIHRvIHRoYXQgbGlzdCBpZgpAQCAtNzA0LDUxICs3MzMsMjExIEBAIGk5MTVfdm1hX3Jl
bW92ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2Vz
KG9iaik7CiAJCWFzc2VydF9iaW5kX2NvdW50KG9iaik7CiAJfQorCisJZHJtX21tX3JlbW92ZV9u
b2RlKCZ2bWEtPm5vZGUpOwogfQogCi1pbnQgX19pOTE1X3ZtYV9kb19waW4oc3RydWN0IGk5MTVf
dm1hICp2bWEsCi0JCSAgICAgIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCitz
dGF0aWMgYm9vbCBhbHJlYWR5X2JvdW5kKHVuc2lnbmVkIGludCBib3VuZCwgdW5zaWduZWQgaW50
IGZsYWdzKQogewotCWNvbnN0IHVuc2lnbmVkIGludCBib3VuZCA9IGF0b21pY19yZWFkKCZ2bWEt
PmZsYWdzKTsKLQlpbnQgcmV0OworCXJldHVybiAoZmxhZ3MgJiB+Ym91bmQgJiBJOTE1X1ZNQV9C
SU5EX01BU0spID09IDA7Cit9CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlHRU1fQlVHX09OKChmbGFncyAmIChQSU5fR0xPQkFMIHwg
UElOX1VTRVIpKSA9PSAwKTsKLQlHRU1fQlVHX09OKChmbGFncyAmIFBJTl9HTE9CQUwpICYmICFp
OTE1X3ZtYV9pc19nZ3R0KHZtYSkpOworc3RhdGljIGJvb2wgdHJ5X2Zhc3RfcGluKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCit7CisJdW5zaWduZWQgaW50IGJvdW5k
LCBwaW47CisJYm9vbCBwaW5uZWQgPSB0cnVlOwogCi0JaWYgKFdBUk5fT04oYm91bmQgJiBJOTE1
X1ZNQV9QSU5fT1ZFUkZMT1cpKSB7Ci0JCXJldCA9IC1FQlVTWTsKLQkJZ290byBlcnJfdW5waW47
CisJYm91bmQgPSBhdG9taWNfcmVhZCgmdm1hLT5mbGFncyk7CisJZG8geworCQlpZiAodW5saWtl
bHkoIWFscmVhZHlfYm91bmQoYm91bmQsIGZsYWdzKSkpCisJCQlyZXR1cm4gZmFsc2U7CisKKwkJ
aWYgKChib3VuZCAmIDB4ZmYpIDwgMSkKKwkJCWdvdG8gc2xvdzsKKworCQlwaW4gPSBib3VuZCAr
IDE7CisJCWlmIChXQVJOX09OKHBpbiAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVykpCisJCQlyZXR1
cm4gZmFsc2U7CisJfSB3aGlsZSAoIWF0b21pY190cnlfY21weGNoZygmdm1hLT5mbGFncywgJmJv
dW5kLCBwaW4pKTsKKworCXJldHVybiB0cnVlOworCitzbG93OgorCS8qCisJICogSWYgcGluX2Nv
dW50PT0wLCBidXQgd2UgYXJlIGJvdW5kLCBjaGVjayB1bmRlciB0aGUgbG9jayB0byBhdm9pZAor
CSAqIHJhY2luZyB3aXRoIGEgY29uY3VycmVudCBpOTE1X3ZtYV91bmJpbmQoKS4KKwkgKi8KKwlt
dXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJZG8geworCQlpZiAodW5saWtlbHkoIWFscmVh
ZHlfYm91bmQoYm91bmQsIGZsYWdzKSkpIHsKKwkJCXBpbm5lZCA9IGZhbHNlOworCQkJYnJlYWs7
CisJCX0KKworCQlwaW4gPSBib3VuZCArIDE7CisJCWlmIChXQVJOX09OKHBpbiAmIEk5MTVfVk1B
X1BJTl9PVkVSRkxPVykpIHsKKwkJCXBpbm5lZCA9IGZhbHNlOworCQkJYnJlYWs7CisJCX0KKwl9
IHdoaWxlICghYXRvbWljX3RyeV9jbXB4Y2hnKCZ2bWEtPmZsYWdzLCAmYm91bmQsIHBpbikpOwor
CW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCisJcmV0dXJuIHBpbm5lZDsKK30KKwor
c3RhdGljIGludCB2bWFfZ2V0X3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCWludCBl
cnIgPSAwOworCisJaWYgKGF0b21pY19hZGRfdW5sZXNzKCZ2bWEtPnBhZ2VzX2NvdW50LCAxLCAw
KSkKKwkJcmV0dXJuIDA7CisKKwkvKiBYWFggUmVwbGFjZSBtdXRleCBieSBmaXJzdC1jb21lLCBm
aXJzdC1zZXJ2ZWQgYWxsb2NhdGlvbiAqLworCWlmIChtdXRleF9sb2NrX2ludGVycnVwdGlibGUo
JnZtYS0+cGFnZXNfbXV0ZXgpKQorCQlyZXR1cm4gLUVJTlRSOworCisJaWYgKCFhdG9taWNfcmVh
ZCgmdm1hLT5wYWdlc19jb3VudCkpIHsKKwkJaWYgKHZtYS0+b2JqKSB7CisJCQllcnIgPSBpOTE1
X2dlbV9vYmplY3RfcGluX3BhZ2VzKHZtYS0+b2JqKTsKKwkJCWlmIChlcnIpCisJCQkJZ290byB1
bmxvY2s7CisJCX0KKworCQllcnIgPSB2bWEtPm9wcy0+c2V0X3BhZ2VzKHZtYSk7CisJCWlmIChl
cnIpCisJCQlnb3RvIHVubG9jazsKIAl9CisJYXRvbWljX2luYygmdm1hLT5wYWdlc19jb3VudCk7
CiAKLQlpZiAoKGJvdW5kICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSB7Ci0JCXJldCA9IGk5
MTVfdm1hX2luc2VydCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOwotCQlpZiAocmV0KQot
CQkJZ290byBlcnJfdW5waW47Cit1bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZ2bWEtPnBhZ2VzX211
dGV4KTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyB2b2lkIF9fdm1hX3B1dF9wYWdlcyhz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgaW50IGNvdW50KQoreworCW11dGV4X2xvY2tf
bmVzdGVkKCZ2bWEtPnBhZ2VzX211dGV4LCBTSU5HTEVfREVQVEhfTkVTVElORyk7CisJR0VNX0JV
R19PTihhdG9taWNfcmVhZCgmdm1hLT5wYWdlc19jb3VudCkgPCBjb3VudCk7CisJaWYgKGF0b21p
Y19zdWJfcmV0dXJuKGNvdW50LCAmdm1hLT5wYWdlc19jb3VudCkgPT0gMCkgeworCQl2bWEtPm9w
cy0+Y2xlYXJfcGFnZXModm1hKTsKKwkJR0VNX0JVR19PTih2bWEtPnBhZ2VzKTsKKwkJaWYgKHZt
YS0+b2JqKQorCQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKHZtYS0+b2JqKTsKIAl9Ci0J
R0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKKwltdXRleF91
bmxvY2soJnZtYS0+cGFnZXNfbXV0ZXgpOworfQogCi0JcmV0ID0gaTkxNV92bWFfYmluZCh2bWEs
IHZtYS0+b2JqID8gdm1hLT5vYmotPmNhY2hlX2xldmVsIDogMCwgZmxhZ3MpOwotCWlmIChyZXQp
Ci0JCWdvdG8gZXJyX3JlbW92ZTsKK3N0YXRpYyB2b2lkIHZtYV9wdXRfcGFnZXMoc3RydWN0IGk5
MTVfdm1hICp2bWEpCit7CisJaWYgKGF0b21pY19hZGRfdW5sZXNzKCZ2bWEtPnBhZ2VzX2NvdW50
LCAtMSwgMSkpCisJCXJldHVybjsKKworCV9fdm1hX3B1dF9wYWdlcyh2bWEsIDEpOworfQorCitz
dGF0aWMgdm9pZCB2bWFfdW5iaW5kX3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCXVu
c2lnbmVkIGludCBjb3VudDsKKworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPm11dGV4
KTsKKworCWNvdW50ID0gYXRvbWljX3JlYWQoJnZtYS0+cGFnZXNfY291bnQpOworCWNvdW50ID4+
PSBJOTE1X1ZNQV9QQUdFU19CSUFTOworCUdFTV9CVUdfT04oIWNvdW50KTsKKworCV9fdm1hX3B1
dF9wYWdlcyh2bWEsIGNvdW50IHwgY291bnQgPDwgSTkxNV9WTUFfUEFHRVNfQklBUyk7Cit9CisK
K2ludCBpOTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxp
Z25tZW50LCB1NjQgZmxhZ3MpCit7CisJc3RydWN0IGk5MTVfdm1hX3dvcmsgKndvcmsgPSBOVUxM
OworCXVuc2lnbmVkIGludCBib3VuZDsKKwlpbnQgZXJyOwogCi0JR0VNX0JVR19PTighaTkxNV92
bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9CSU5EX01BU0spKTsKKwlCVUlMRF9CVUdfT04oUElO
X01CWiAhPSBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpOworCUJVSUxEX0JVR19PTihQSU5fR0xPQkFM
ICE9IEk5MTVfVk1BX0dMT0JBTF9CSU5EKTsKKwlCVUlMRF9CVUdfT04oUElOX1VTRVIgIT0gSTkx
NV9WTUFfTE9DQUxfQklORCk7CiAKLQlpZiAoKGJvdW5kIF4gYXRvbWljX3JlYWQoJnZtYS0+Zmxh
Z3MpKSAmIEk5MTVfVk1BX0dMT0JBTF9CSU5EKQotCQlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2Zl
bmNlYWJsZSh2bWEpOworCUdFTV9CVUdfT04oZmxhZ3MgJiBQSU5fVVBEQVRFKTsKKwlHRU1fQlVH
X09OKCEoZmxhZ3MgJiAoUElOX1VTRVIgfCBQSU5fR0xPQkFMKSkpOworCisJR0VNX0JVR19PTihm
bGFncyAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7CisJR0VNX0JVR19PTihmbGFncyAmIEk5MTVf
Vk1BX0VSUk9SKTsKKworCWlmICh0cnlfZmFzdF9waW4odm1hLCBmbGFncykpCisJCXJldHVybiAw
OworCisJZXJyID0gdm1hX2dldF9wYWdlcyh2bWEpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7
CisKKwlpZiAoZmxhZ3MgJiBQSU5fVVNFUikgeworCQl3b3JrID0gaTkxNV92bWFfd29yaygpOwor
CQlpZiAoIXdvcmspIHsKKwkJCWVyciA9IC1FTk9NRU07CisJCQlnb3RvIGVycl9wYWdlczsKKwkJ
fQorCX0KKworCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmdm1hLT52bS0+bXV0ZXgp
OworCWlmIChlcnIpCisJCWdvdG8gZXJyX2ZlbmNlOwogCisJYm91bmQgPSBhdG9taWNfcmVhZCgm
dm1hLT5mbGFncyk7CisJaWYgKHVubGlrZWx5KGFscmVhZHlfYm91bmQoYm91bmQsIGZsYWdzKSkp
IHsKKwkJX19pOTE1X3ZtYV9waW4odm1hKTsKKwkJZ290byBlcnJfdW5sb2NrOworCX0KKworCWlm
ICh1bmxpa2VseShib3VuZCAmIEk5MTVfVk1BX0VSUk9SKSkgeworCQllcnIgPSAtRU5PTUVNOwor
CQlnb3RvIGVycl91bmxvY2s7CisJfQorCisJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZSgmdm1h
LT5hY3RpdmUpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX3VubG9jazsKKworCWlmICghKGJvdW5k
ICYgSTkxNV9WTUFfQklORF9NQVNLKSkgeworCQllcnIgPSBpOTE1X3ZtYV9pbnNlcnQodm1hLCBz
aXplLCBhbGlnbm1lbnQsIGZsYWdzKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gZXJyX2FjdGl2ZTsK
KworCQlpZiAoaTkxNV9pc19nZ3R0KHZtYS0+dm0pKQorCQkJX19pOTE1X3ZtYV9zZXRfbWFwX2Fu
ZF9mZW5jZWFibGUodm1hKTsKKwl9CisKKwlHRU1fQlVHX09OKCF2bWEtPnBhZ2VzKTsKKwllcnIg
PSBpOTE1X3ZtYV9iaW5kKHZtYSwKKwkJCSAgICB2bWEtPm9iaiA/IHZtYS0+b2JqLT5jYWNoZV9s
ZXZlbCA6IDAsCisJCQkgICAgZmxhZ3MsIHdvcmspOworCWlmIChlcnIpCisJCWdvdG8gZXJyX3Jl
bW92ZTsKKworCS8qIFRoZXJlIHNob3VsZCBvbmx5IGJlIGF0IG1vc3QgMiBhY3RpdmUgYmluZGlu
Z3MgKHVzZXIsIGdsb2JhbCkgKi8KKwlHRU1fQlVHX09OKGJvdW5kICsgSTkxNV9WTUFfUEFHRVNf
QUNUSVZFIDwgYm91bmQpOworCWF0b21pY19hZGQoSTkxNV9WTUFfUEFHRVNfQUNUSVZFLCAmdm1h
LT5wYWdlc19jb3VudCk7CisJbGlzdF9tb3ZlX3RhaWwoJnZtYS0+dm1fbGluaywgJnZtYS0+dm0t
PmJvdW5kX2xpc3QpOworCisJX19pOTE1X3ZtYV9waW4odm1hKTsKKwlHRU1fQlVHX09OKCFpOTE1
X3ZtYV9pc19waW5uZWQodm1hKSk7CisJR0VNX0JVR19PTighaTkxNV92bWFfaXNfYm91bmQodm1h
LCBmbGFncykpOwogCUdFTV9CVUdfT04oaTkxNV92bWFfbWlzcGxhY2VkKHZtYSwgc2l6ZSwgYWxp
Z25tZW50LCBmbGFncykpOwotCXJldHVybiAwOwogCiBlcnJfcmVtb3ZlOgotCWlmICgoYm91bmQg
JiBJOTE1X1ZNQV9CSU5EX01BU0spID09IDApIHsKKwlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZt
YSwgSTkxNV9WTUFfQklORF9NQVNLKSkKIAkJaTkxNV92bWFfcmVtb3ZlKHZtYSk7Ci0JCUdFTV9C
VUdfT04odm1hLT5wYWdlcyk7Ci0JCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3Mp
ICYgSTkxNV9WTUFfQklORF9NQVNLKTsKLQl9Ci1lcnJfdW5waW46Ci0JX19pOTE1X3ZtYV91bnBp
bih2bWEpOwotCXJldHVybiByZXQ7CitlcnJfYWN0aXZlOgorCWk5MTVfYWN0aXZlX3JlbGVhc2Uo
JnZtYS0+YWN0aXZlKTsKK2Vycl91bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRl
eCk7CitlcnJfZmVuY2U6CisJaWYgKHdvcmspCisJCWRtYV9mZW5jZV93b3JrX2NvbW1pdCgmd29y
ay0+YmFzZSk7CitlcnJfcGFnZXM6CisJdm1hX3B1dF9wYWdlcyh2bWEpOworCXJldHVybiBlcnI7
CiB9CiAKIHZvaWQgaTkxNV92bWFfY2xvc2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCkBAIC03Nzks
OSArOTY4LDYgQEAgc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm1hLT52
bS0+aTkxNTsKIAotCWlmICghaTkxNV92bWFfaXNfY2xvc2VkKHZtYSkpCi0JCXJldHVybjsKLQog
CXNwaW5fbG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAlsaXN0X2RlbF9pbml0KCZ2
bWEtPmNsb3NlZF9saW5rKTsKIAlzcGluX3VubG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2Nr
KTsKQEAgLTc4OSw0MCArOTc1LDM1IEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfcmVtb3ZlX2Ns
b3NlZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogdm9pZCBpOTE1X3ZtYV9yZW9wZW4oc3RydWN0
IGk5MTVfdm1hICp2bWEpCiB7Ci0JX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7CisJaWYg
KGk5MTVfdm1hX2lzX2Nsb3NlZCh2bWEpKQorCQlfX2k5MTVfdm1hX3JlbW92ZV9jbG9zZWQodm1h
KTsKIH0KIAotc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQordm9pZCBpOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCUdF
TV9CVUdfT04oZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKLQlHRU1fQlVHX09O
KHZtYS0+ZmVuY2UpOworCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpIHsK
KwkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQlhdG9taWNfYW5kKH5JOTE1X1ZNQV9Q
SU5fTUFTSywgJnZtYS0+ZmxhZ3MpOworCQlXQVJOX09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsK
KwkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJCUdFTV9CVUdfT04oZHJtX21tX25v
ZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKKwl9CisJR0VNX0JVR19PTihpOTE1X3ZtYV9pc19h
Y3RpdmUodm1hKSk7CiAKIAlpZiAodm1hLT5vYmopIHsKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiA9IHZtYS0+b2JqOwogCiAJCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CiAJ
CWxpc3RfZGVsKCZ2bWEtPm9ial9saW5rKTsKLQkJcmJfZXJhc2UoJnZtYS0+b2JqX25vZGUsICZ2
bWEtPm9iai0+dm1hLnRyZWUpOworCQlyYl9lcmFzZSgmdm1hLT5vYmpfbm9kZSwgJm9iai0+dm1h
LnRyZWUpOwogCQlzcGluX3VubG9jaygmb2JqLT52bWEubG9jayk7CiAJfQogCi0JaTkxNV9hY3Rp
dmVfZmluaSgmdm1hLT5hY3RpdmUpOwotCi0JaTkxNV92bWFfZnJlZSh2bWEpOwotfQotCi12b2lk
IGk5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1hICp2bWEpCi17Ci0JbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlHRU1fQlVHX09O
KGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKTsKLQogCV9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZCh2
bWEpOworCWk5MTVfdm1fcHV0KHZtYS0+dm0pOwogCi0JV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQo
dm1hKSk7Ci0JR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7Ci0KLQlfX2k5MTVf
dm1hX2Rlc3Ryb3kodm1hKTsKKwlpOTE1X2FjdGl2ZV9maW5pKCZ2bWEtPmFjdGl2ZSk7CisJaTkx
NV92bWFfZnJlZSh2bWEpOwogfQogCiB2b2lkIGk5MTVfdm1hX3BhcmtlZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKQEAgLTgzMSwxMiArMTAxMiwzMiBAQCB2b2lkIGk5MTVfdm1hX3Bh
cmtlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCXNwaW5fbG9ja19pcnEoJmk5
MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCBuZXh0
LCAmaTkxNS0+Z3QuY2xvc2VkX3ZtYSwgY2xvc2VkX2xpbmspIHsKLQkJbGlzdF9kZWxfaW5pdCgm
dm1hLT5jbG9zZWRfbGluayk7CisJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2
bWEtPm9iajsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSB2bWEtPnZtOworCisJ
CS8qIFhYWCBBbGwgdG8gYXZvaWQga2VlcGluZyBhIHJlZmVyZW5jZSBvbiBpOTE1X3ZtYSBpdHNl
bGYgKi8KKworCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZvYmotPmJhc2UucmVmY291bnQp
KQorCQkJY29udGludWU7CisKKwkJaWYgKCFpOTE1X3ZtX3RyeW9wZW4odm0pKSB7CisJCQlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCQlvYmogPSBOVUxMOworCQl9CisKIAkJc3Bpbl91bmxv
Y2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CiAKLQkJaTkxNV92bWFfZGVzdHJveSh2bWEp
OworCQlpZiAob2JqKSB7CisJCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7CisJCQlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7CisJCX0KKworCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIAorCQkvKiBSZXN0
YXJ0IGFmdGVyIGRyb3BwaW5nIGxvY2sgKi8KIAkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+Z3QuY2xv
c2VkX2xvY2spOworCQluZXh0ID0gbGlzdF9maXJzdF9lbnRyeSgmaTkxNS0+Z3QuY2xvc2VkX3Zt
YSwKKwkJCQkJdHlwZW9mKCpuZXh0KSwgY2xvc2VkX2xpbmspOwogCX0KIAlzcGluX3VubG9ja19p
cnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIH0KQEAgLTg4Nyw2ICsxMDg4LDEwIEBAIGludCBp
OTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlhc3NlcnRfb2Jq
ZWN0X2hlbGQob2JqKTsKIAlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+
bm9kZSkpOwogCisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShycSwgJnZtYS0+YWN0
aXZlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCiAJLyoKIAkgKiBBZGQgYSByZWZlcmVu
Y2UgaWYgd2UncmUgbmV3bHkgZW50ZXJpbmcgdGhlIGFjdGl2ZSBsaXN0LgogCSAqIFRoZSBvcmRl
ciBpbiB3aGljaCB3ZSBhZGQgb3BlcmF0aW9ucyB0byB0aGUgcmV0aXJlbWVudCBxdWV1ZSBpcwpA
QCAtOTI3LDM0ICsxMTMyLDE5IEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiB7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPm11
dGV4KTsKIAogCS8qCiAJICogRmlyc3Qgd2FpdCB1cG9uIGFueSBhY3Rpdml0eSBhcyByZXRpcmlu
ZyB0aGUgcmVxdWVzdCBtYXkKIAkgKiBoYXZlIHNpZGUtZWZmZWN0cyBzdWNoIGFzIHVucGlubmlu
ZyBvciBldmVuIHVuYmluZGluZyB0aGlzIHZtYS4KKwkgKgorCSAqIFhYWCBBY3R1YWxseSB3YWl0
aW5nIHVuZGVyIHRoZSB2bS0+bXV0ZXggaXMgYSBoaW5kZXJhbmNlIGFuZAorCSAqIHNob3VsZCBi
ZSBwaXBlbGluZWQgd2hlcmV2ZXIgcG9zc2libGUuIEluIGNhc2VzIHdoZXJlIHRoYXQgaXMKKwkg
KiB1bmF2b2lkYWJsZSwgd2Ugc2hvdWxkIGxpZnQgdGhlIHdhaXQgdG8gYmVmb3JlIHRoZSBtdXRl
eC4KIAkgKi8KLQltaWdodF9zbGVlcCgpOwotCWlmIChpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkg
ewotCQkvKgotCQkgKiBXaGVuIGEgY2xvc2VkIFZNQSBpcyByZXRpcmVkLCBpdCBpcyB1bmJvdW5k
IC0gZWVrLgotCQkgKiBJbiBvcmRlciB0byBwcmV2ZW50IGl0IGZyb20gYmVpbmcgcmVjdXJzaXZl
bHkgY2xvc2VkLAotCQkgKiB0YWtlIGEgcGluIG9uIHRoZSB2bWEgc28gdGhhdCB0aGUgc2Vjb25k
IHVuYmluZCBpcwotCQkgKiBhYm9ydGVkLgotCQkgKgotCQkgKiBFdmVuIG1vcmUgc2NhcnkgaXMg
dGhhdCB0aGUgcmV0aXJlIGNhbGxiYWNrIG1heSBmcmVlCi0JCSAqIHRoZSBvYmplY3QgKGxhc3Qg
YWN0aXZlIHZtYSkuIFRvIHByZXZlbnQgdGhlIGV4cGxvc2lvbgotCQkgKiB3ZSBkZWZlciB0aGUg
YWN0dWFsIG9iamVjdCBmcmVlIHRvIGEgd29ya2VyIHRoYXQgY2FuCi0JCSAqIG9ubHkgcHJvY2Vl
ZCBvbmNlIGl0IGFjcXVpcmVzIHRoZSBzdHJ1Y3RfbXV0ZXggKHdoaWNoCi0JCSAqIHdlIGN1cnJl
bnRseSBob2xkLCB0aGVyZWZvcmUgaXQgY2Fubm90IGZyZWUgdGhpcyBvYmplY3QKLQkJICogYmVm
b3JlIHdlIGFyZSBmaW5pc2hlZCkuCi0JCSAqLwotCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwotCQly
ZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7Ci0JCV9faTkxNV92bWFfdW5waW4o
dm1hKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0JfQotCUdFTV9CVUdfT04oaTkxNV92
bWFfaXNfYWN0aXZlKHZtYSkpOworCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQoJnZtYS0+YWN0aXZl
KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJaWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2
bWEpKSB7CiAJCXZtYV9wcmludF9hbGxvY2F0b3Iodm1hLCAiaXMgcGlubmVkIik7CkBAIC05NzUs
MTYgKzExNjUsMTIgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IAkJR0VNX0JVR19PTihpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2bWEpKTsKIAogCQkvKiByZWxl
YXNlIHRoZSBmZW5jZSByZWcgX2FmdGVyXyBmbHVzaGluZyAqLwotCQltdXRleF9sb2NrKCZ2bWEt
PnZtLT5tdXRleCk7CiAJCXJldCA9IGk5MTVfdm1hX3Jldm9rZV9mZW5jZSh2bWEpOwotCQltdXRl
eF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAK
IAkJLyogRm9yY2UgYSBwYWdlZmF1bHQgZm9yIGRvbWFpbiB0cmFja2luZyBvbiBuZXh0IHVzZXIg
YWNjZXNzICovCi0JCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaTkxNV92bWFfcmV2
b2tlX21tYXAodm1hKTsKLQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAKIAkJX19p
OTE1X3ZtYV9pb3VubWFwKHZtYSk7CiAJCWNsZWFyX2JpdChJOTE1X1ZNQV9DQU5fRkVOQ0VfQklU
LCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpOwpAQCAtOTkyLDEyICsxMTc4LDEzIEBAIGludCBpOTE1
X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JVR19PTih2bWEtPmZlbmNl
KTsKIAlHRU1fQlVHX09OKGk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSk7CiAKLQlpZiAobGlr
ZWx5KCF2bWEtPnZtLT5jbG9zZWQpKSB7CisJaWYgKGxpa2VseShhdG9taWNfcmVhZCgmdm1hLT52
bS0+b3BlbikpKSB7CiAJCXRyYWNlX2k5MTVfdm1hX3VuYmluZCh2bWEpOwogCQl2bWEtPm9wcy0+
dW5iaW5kX3ZtYSh2bWEpOwogCX0KIAlhdG9taWNfYW5kKH5JOTE1X1ZNQV9CSU5EX01BU0ssICZ2
bWEtPmZsYWdzKTsKIAorCXZtYV91bmJpbmRfcGFnZXModm1hKTsKIAlpOTE1X3ZtYV9yZW1vdmUo
dm1hKTsKIAogCXJldHVybiAwOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKaW5kZXggMDJkN2Q4MTU0
MDdjLi4xOTBjZDVlYmQwNzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
dm1hLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaApAQCAtMTAzLDE4ICsx
MDMsMjQgQEAgc3RydWN0IGk5MTVfdm1hIHsKIAkvKiogRmxhZ3MgYW5kIGFkZHJlc3Mgc3BhY2Ug
dGhpcyBWTUEgaXMgYm91bmQgdG8gKi8KICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJTkRfQklU
IDkKICNkZWZpbmUgSTkxNV9WTUFfTE9DQUxfQklORF9CSVQgMTAKKyNkZWZpbmUgSTkxNV9WTUFf
RVJST1JfQklUCTExCiAKICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJTkQJKChpbnQpQklUKEk5
MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCkpCiAjZGVmaW5lIEk5MTVfVk1BX0xPQ0FMX0JJTkQJKChp
bnQpQklUKEk5MTVfVk1BX0xPQ0FMX0JJTkRfQklUKSkKKyNkZWZpbmUgSTkxNV9WTUFfRVJST1IJ
CSgoaW50KUJJVChJOTE1X1ZNQV9FUlJPUl9CSVQpKQogCiAjZGVmaW5lIEk5MTVfVk1BX0JJTkRf
TUFTSyAoSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBcCiAJCQkgICAgSTkxNV9WTUFfTE9DQUxfQklO
RCB8IFwKKwkJCSAgICBJOTE1X1ZNQV9FUlJPUiB8IFwKIAkJCSAgICBJOTE1X1ZNQV9QSU5fT1ZF
UkZMT1cpCiAKLSNkZWZpbmUgSTkxNV9WTUFfR0dUVF9CSVQJMTEKLSNkZWZpbmUgSTkxNV9WTUFf
Q0FOX0ZFTkNFX0JJVAkxMgotI2RlZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklUCTEzCi0jZGVm
aW5lIEk5MTVfVk1BX0dHVFRfV1JJVEVfQklUCTE0CisjZGVmaW5lIEk5MTVfVk1BX0FMTE9DX0JJ
VAkxMgorI2RlZmluZSBJOTE1X1ZNQV9BTExPQwkJKChpbnQpQklUKEk5MTVfVk1BX0FMTE9DX0JJ
VCkpCisKKyNkZWZpbmUgSTkxNV9WTUFfR0dUVF9CSVQJMTMKKyNkZWZpbmUgSTkxNV9WTUFfQ0FO
X0ZFTkNFX0JJVAkxNAorI2RlZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklUCTE1CisjZGVmaW5l
IEk5MTVfVk1BX0dHVFRfV1JJVEVfQklUCTE2CiAKICNkZWZpbmUgSTkxNV9WTUFfR0dUVAkJKChp
bnQpQklUKEk5MTVfVk1BX0dHVFRfQklUKSkKICNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFCSgo
aW50KUJJVChJOTE1X1ZNQV9DQU5fRkVOQ0VfQklUKSkKQEAgLTEyMyw2ICsxMjksMTEgQEAgc3Ry
dWN0IGk5MTVfdm1hIHsKIAogCXN0cnVjdCBpOTE1X2FjdGl2ZSBhY3RpdmU7CiAKKyNkZWZpbmUg
STkxNV9WTUFfUEFHRVNfQklBUyAyNAorI2RlZmluZSBJOTE1X1ZNQV9QQUdFU19BQ1RJVkUgKEJJ
VCgyNCkgfCAxKQorCWF0b21pY190IHBhZ2VzX2NvdW50OyAvKiBudW1iZXIgb2YgYWN0aXZlIGJp
bmRzIHRvIHRoZSBwYWdlcyAqLworCXN0cnVjdCBtdXRleCBwYWdlc19tdXRleDsgLyogcHJvdGVj
dCBhY3F1aXJlL3JlbGVhc2Ugb2YgYmFja2luZyBwYWdlcyAqLworCiAJLyoqCiAJICogU3VwcG9y
dCBkaWZmZXJlbnQgR0dUVCB2aWV3cyBpbnRvIHRoZSBzYW1lIG9iamVjdC4KIAkgKiBUaGlzIG1l
YW5zIHRoZXJlIGNhbiBiZSBtdWx0aXBsZSBWTUEgbWFwcGluZ3MgcGVyIG9iamVjdCBhbmQgcGVy
IFZNLgpAQCAtMzA4LDggKzMxOSwxMiBAQCBpOTE1X3ZtYV9jb21wYXJlKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hLAogCXJldHVybiBtZW1jbXAoJnZtYS0+Z2d0dF92aWV3LnBhcnRpYWwsICZ2aWV3LT5w
YXJ0aWFsLCB2aWV3LT50eXBlKTsKIH0KIAotaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVf
dm1hICp2bWEsIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKLQkJICB1MzIgZmxh
Z3MpOworc3RydWN0IGk5MTVfdm1hX3dvcmsgKmk5MTVfdm1hX3dvcmsodm9pZCk7CitpbnQgaTkx
NV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJICBlbnVtIGk5MTVfY2FjaGVfbGV2
ZWwgY2FjaGVfbGV2ZWwsCisJCSAgdTMyIGZsYWdzLAorCQkgIHN0cnVjdCBpOTE1X3ZtYV93b3Jr
ICp3b3JrKTsKKwogYm9vbCBpOTE1X2dlbV92YWxpZF9ndHRfc3BhY2Uoc3RydWN0IGk5MTVfdm1h
ICp2bWEsIHVuc2lnbmVkIGxvbmcgY2FjaGVfbGV2ZWwpOwogYm9vbCBpOTE1X3ZtYV9taXNwbGFj
ZWQoY29uc3Qgc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQl1NjQgc2l6ZSwgdTY0IGFsaWdubWVu
dCwgdTY0IGZsYWdzKTsKQEAgLTMzMywyNiArMzQ4LDggQEAgc3RhdGljIGlubGluZSB2b2lkIGk5
MTVfdm1hX3VubG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlkbWFfcmVzdl91bmxvY2sodm1h
LT5yZXN2KTsKIH0KIAotaW50IF9faTkxNV92bWFfZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LAotCQkgICAgICB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKTsKLXN0YXRpYyBp
bmxpbmUgaW50IF9fbXVzdF9jaGVjawotaTkxNV92bWFfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQotewotCUJVSUxEX0JVR19PTihQ
SU5fTUJaICE9IEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7Ci0JQlVJTERfQlVHX09OKFBJTl9HTE9C
QUwgIT0gSTkxNV9WTUFfR0xPQkFMX0JJTkQpOwotCUJVSUxEX0JVR19PTihQSU5fVVNFUiAhPSBJ
OTE1X1ZNQV9MT0NBTF9CSU5EKTsKLQotCS8qIFBpbiBlYXJseSB0byBwcmV2ZW50IHRoZSBzaHJp
bmtlci9ldmljdGlvbiBsb2dpYyBmcm9tIGRlc3Ryb3lpbmcKLQkgKiBvdXIgdm1hIGFzIHdlIGlu
c2VydCBhbmQgYmluZC4KLQkgKi8KLQlpZiAobGlrZWx5KCgoYXRvbWljX2luY19yZXR1cm4oJnZt
YS0+ZmxhZ3MpIF4gZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSkgewotCQlHRU1f
QlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwotCQlHRU1fQlVHX09O
KGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsKLQkJcmV0
dXJuIDA7Ci0JfQotCi0JcmV0dXJuIF9faTkxNV92bWFfZG9fcGluKHZtYSwgc2l6ZSwgYWxpZ25t
ZW50LCBmbGFncyk7Ci19CitpbnQgX19tdXN0X2NoZWNrCitpOTE1X3ZtYV9waW4oc3RydWN0IGk5
MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpOwogCiBzdGF0
aWMgaW5saW5lIGludCBpOTE1X3ZtYV9waW5fY291bnQoY29uc3Qgc3RydWN0IGk5MTVfdm1hICp2
bWEpCiB7CkBAIC0zOTcsOCArMzk0LDYgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfdm1hX2lz
X2JvdW5kKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogICogdGhlIGNhbGxlciBtdXN0IGNh
bGwgaTkxNV92bWFfdW5waW5faW9tYXAgdG8gcmVsaW5xdWlzaCB0aGUgcGlubmluZwogICogYWZ0
ZXIgdGhlIGlvbWFwcGluZyBpcyBubyBsb25nZXIgcmVxdWlyZWQuCiAgKgotICogQ2FsbGVycyBt
dXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRleC4KLSAqCiAgKiBSZXR1cm5zIGEgdmFsaWQgaW9tYXBw
ZWQgcG9pbnRlciBvciBFUlJfUFRSLgogICovCiB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9p
b21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CkBAIC00MTAsOCArNDA1LDggQEAgdm9pZCBfX2lv
bWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogICoKICAqIFVu
cGlucyB0aGUgcHJldmlvdXNseSBpb21hcHBlZCBWTUEgZnJvbSBpOTE1X3ZtYV9waW5faW9tYXAo
KS4KICAqCi0gKiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0X211dGV4LiBUaGlzIGZ1bmN0
aW9uIGlzIG9ubHkgdmFsaWQgdG8gYmUKLSAqIGNhbGxlZCBvbiBhIFZNQSBwcmV2aW91c2x5IGlv
bWFwcGVkIGJ5IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5faW9tYXAoKS4KKyAqIFRoaXMg
ZnVuY3Rpb24gaXMgb25seSB2YWxpZCB0byBiZSBjYWxsZWQgb24gYSBWTUEgcHJldmlvdXNseQor
ICogaW9tYXBwZWQgYnkgdGhlIGNhbGxlciB3aXRoIGk5MTVfdm1hX3Bpbl9pb21hcCgpLgogICov
CiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIApAQCAt
NDM5LDYgKzQzNCw4IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IHBhZ2UgKmk5MTVfdm1hX2ZpcnN0
X3BhZ2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Bp
bl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1h
X3Jldm9rZV9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKK2ludCBfX2k5MTVfdm1hX3Bp
bl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CisKIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5
MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCUdFTV9CVUdfT04o
YXRvbWljX3JlYWQoJnZtYS0+ZmVuY2UtPnBpbl9jb3VudCkgPD0gMCk7CkBAIC00NTYsNyArNDUz
LDYgQEAgc3RhdGljIGlubGluZSB2b2lkIF9faTkxNV92bWFfdW5waW5fZmVuY2Uoc3RydWN0IGk5
MTVfdm1hICp2bWEpCiBzdGF0aWMgaW5saW5lIHZvaWQKIGk5MTVfdm1hX3VucGluX2ZlbmNlKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCS8qIGxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0t
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOyAqLwogCWlmICh2bWEtPmZlbmNlKQogCQlfX2k5MTVf
dm1hX3VucGluX2ZlbmNlKHZtYSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IGNiMzBjNjY5YjFiNy4uYmE2MDY0MTQ3MTczIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3Qu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwpA
QCAtMTA2LDE0ICsxMDYsMTEgQEAgc3RhdGljIGludCBwb3B1bGF0ZV9nZ3R0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCiBzdGF0aWMgdm9pZCB1bnBpbl9nZ3R0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+
Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11
dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmk5MTUtPmdndHQudm0uYm91bmRfbGlz
dCwgdm1fbGluaykKIAkJaWYgKHZtYS0+b2JqLT5tbS5xdWlya2VkKQogCQkJaTkxNV92bWFfdW5w
aW4odm1hKTsKLQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIH0KIAogc3RhdGljIHZv
aWQgY2xlYW51cF9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LApAQCAtMTI3
LDExICsxMjQsNyBAQCBzdGF0aWMgdm9pZCBjbGVhbnVwX29iamVjdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAl9CiAKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJhaW5fZnJl
ZWRfb2JqZWN0cyhpOTE1KTsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogfQogCiBzdGF0aWMgaW50IGlndF9ldmljdF9zb21ldGhpbmcodm9pZCAqYXJnKQpAQCAtMTQ4
LDEwICsxNDEsMTIgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykK
IAkJZ290byBjbGVhbnVwOwogCiAJLyogRXZlcnl0aGluZyBpcyBwaW5uZWQsIG5vdGhpbmcgc2hv
dWxkIGhhcHBlbiAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBpOTE1
X2dlbV9ldmljdF9zb21ldGhpbmcoJmdndHQtPnZtLAogCQkJCSAgICAgICBJOTE1X0dUVF9QQUdF
X1NJWkUsIDAsIDAsCiAJCQkJICAgICAgIDAsIFU2NF9NQVgsCiAJCQkJICAgICAgIDApOworCW11
dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIgIT0gLUVOT1NQQykgewogCQlw
cl9lcnIoImk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdHVFQgd2l0
aCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMTYxLDEwICsxNTYsMTIgQEAgc3RhdGlj
IGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0KGk5MTUpOwog
CiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZXZpY3Qg
c29tZXRoaW5nICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVf
Z2VtX2V2aWN0X3NvbWV0aGluZygmZ2d0dC0+dm0sCiAJCQkJICAgICAgIEk5MTVfR1RUX1BBR0Vf
U0laRSwgMCwgMCwKIAkJCQkgICAgICAgMCwgVTY0X01BWCwKIAkJCQkgICAgICAgMCk7CisJbXV0
ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoImk5MTVf
Z2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9JWRcbiIs
CiAJCSAgICAgICBlcnIpOwpAQCAtMjMwLDcgKzIyNyw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0
X2Zvcl92bWEodm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5nIGlz
IHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRhcmdl
dCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVyciAhPSAtRU5P
U1BDKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUgb24gYSBmdWxsIEdHVFQg
cmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAgLTI0MCw3ICsyMzksOSBAQCBz
dGF0aWMgaW50IGlndF9ldmljdF9mb3Jfdm1hKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0KGk5MTUp
OwogCiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZXZp
Y3QgdGhlIG5vZGUgKi8KKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkx
NV9nZW1fZXZpY3RfZm9yX25vZGUoJmdndHQtPnZtLCAmdGFyZ2V0LCAwKTsKKwltdXRleF91bmxv
Y2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZp
Y3RfZm9yX25vZGUgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAgLTMxNyw3
ICszMTgsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9pZCAqYXJn
KQogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAKIAkvKiBSZW1vdmUganVzdCB0aGUgc2Vjb25kIHZt
YSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmlj
dF9mb3Jfbm9kZSgmZ2d0dC0+dm0sICZ0YXJnZXQsIDApOworCW11dGV4X3VubG9jaygmZ2d0dC0+
dm0ubXV0ZXgpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJbMF1pOTE1X2dlbV9ldmljdF9mb3Jf
bm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWdvdG8gY2xlYW51cDsKQEAgLTMyOCw3
ICszMzEsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9pZCAqYXJn
KQogCSAqLwogCXRhcmdldC5jb2xvciA9IEk5MTVfQ0FDSEVfTDNfTExDOwogCisJbXV0ZXhfbG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKCZnZ3R0
LT52bSwgJnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYg
KCFlcnIpIHsKIAkJcHJfZXJyKCJbMV1pOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1cm5lZCBl
cnI9JWRcbiIsIGVycik7CiAJCWVyciA9IC1FSU5WQUw7CkBAIC0zNTgsNyArMzYzLDkgQEAgc3Rh
dGljIGludCBpZ3RfZXZpY3Rfdm0odm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBF
dmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X3ZtKCZnZ3R0LT52bSk7
CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIo
Imk5MTVfZ2VtX2V2aWN0X3ZtIG9uIGEgZnVsbCBHR1RUIHJldHVybmVkIGVycj0lZF1cbiIsCiAJ
CSAgICAgICBlcnIpOwpAQCAtMzY3LDcgKzM3NCw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X3Zt
KHZvaWQgKmFyZykKIAogCXVucGluX2dndHQoaTkxNSk7CiAKKwltdXRleF9sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oJmdndHQtPnZtKTsKKwltdXRleF91
bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9nZW1f
ZXZpY3Rfdm0gb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVkXVxuIiwKIAkJICAgICAgIGVy
cik7CkBAIC00MDgsMTEgKzQxNywxMSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2
b2lkICphcmcpCiAJaWYgKCFIQVNfRlVMTF9QUEdUVChpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJLyogUmVzZXJ2ZSBhIGJsb2NrIHNv
IHRoYXQgd2Uga25vdyB3ZSBoYXZlIGVub3VnaCB0byBmaXQgYSBmZXcgcnEgKi8KIAltZW1zZXQo
JmhvbGUsIDAsIHNpemVvZihob2xlKSk7CisJbXV0ZXhfbG9jaygmaTkxNS0+Z2d0dC52bS5tdXRl
eCk7CiAJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmaTkxNS0+Z2d0dC52bSwgJmhvbGUsCiAJ
CQkJICBQUkVURU5EX0dHVFRfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkg
IDAsIGk5MTUtPmdndHQudm0udG90YWwsCkBAIC00MjUsNyArNDM0LDkgQEAgc3RhdGljIGludCBp
Z3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCWRvIHsKIAkJc3RydWN0IHJlc2VydmVkICpy
OwogCisJCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJCXIgPSBrY2FsbG9j
KDEsIHNpemVvZigqciksIEdGUF9LRVJORUwpOworCQltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZt
Lm11dGV4KTsKIAkJaWYgKCFyKSB7CiAJCQllcnIgPSAtRU5PTUVNOwogCQkJZ290byBvdXRfbG9j
a2VkOwpAQCAtNDQ1LDcgKzQ1Niw3IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZv
aWQgKmFyZykKIAkJY291bnQrKzsKIAl9IHdoaWxlICgxKTsKIAlkcm1fbW1fcmVtb3ZlX25vZGUo
JmhvbGUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlwcl9pbmZvKCJGaWxsZWQgR0dUVCB3aXRo
ICVsdSAxTWlCIG5vZGVzXG4iLCBjb3VudCk7CiAKIAkvKiBPdmVyZmlsbCB0aGUgR0dUVCB3aXRo
IGNvbnRleHQgb2JqZWN0cyBhbmQgc28gdHJ5IHRvIGV2aWN0IG9uZS4gKi8KQEAgLTUwOCw3ICs1
MTksNyBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJCQlicmVh
azsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9s
b2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6CiAJaWYgKGlndF9mbHVzaF90
ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwpAQCAtNTIyLDggKzUz
Myw4IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAl9CiAJaWYg
KGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmaG9sZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgmaG9s
ZSk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlpbnRlbF9ydW50aW1l
X3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC01NDUsMTIgKzU1Niw5
IEBAIGludCBpOTE1X2dlbV9ldmljdF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCWlmICghaTkxNSkK
IAkJcmV0dXJuIC1FTk9NRU07CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpCiAJ
CWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRybV9kZXZfcHV0KCZpOTE1LT5kcm0pOwogCXJldHVy
biBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0
LmMKaW5kZXggYTkwYzliZTk1ZjhjLi40MjM1ZmE0MDE5NTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTM1LDE2ICszNSw3IEBACiAKIHN0
YXRpYyB2b2lkIGNsZWFudXBfZnJlZWRfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQkvKgotCSAqIEFzIHdlIG1heSBob2xkIG9udG8gdGhlIHN0cnVjdF9tdXRleCBm
b3IgaW5vcmRpbmF0ZSBsZW5ndGhzIG9mCi0JICogdGltZSwgdGhlIE5NSSBraHVuZ3Rhc2tkIGRl
dGVjdG9yIG1heSBmaXJlIGZvciB0aGUgZnJlZSBvYmplY3RzCi0JICogd29ya2VyLgotCSAqLwot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcmFp
bl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiB9CiAKIHN0YXRpYyB2b2lkIGZha2VfZnJlZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLApAQCAtMzE4LDYgKzMwOSwxNyBAQCBzdGF0aWMgaW50IGxvd2xldmVs
X2hvbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIDA7CiB9CiAKK3N0
YXRpYyBpbnQgdW5sb2NrZWRfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlp
bnQgcmV0OworCisJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOworCXJldCA9IGk5MTVfdm1h
X3VuYmluZCh2bWEpOworCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCisJcmV0dXJu
IHJldDsKK30KKwogc3RhdGljIHZvaWQgY2xvc2Vfb2JqZWN0X2xpc3Qoc3RydWN0IGxpc3RfaGVh
ZCAqb2JqZWN0cywKIAkJCSAgICAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewpA
QCAtMzI5LDcgKzMzMSw3IEBAIHN0YXRpYyB2b2lkIGNsb3NlX29iamVjdF9saXN0KHN0cnVjdCBs
aXN0X2hlYWQgKm9iamVjdHMsCiAKIAkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwg
TlVMTCk7CiAJCWlmICghSVNfRVJSKHZtYSkpCi0JCQlpZ25vcmVkID0gaTkxNV92bWFfdW5iaW5k
KHZtYSk7CisJCQlpZ25vcmVkID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkvKiBPbmx5
IHBwZ3R0IHZtYSBtYXkgYmUgY2xvc2VkIGJlZm9yZSB0aGUgb2JqZWN0IGlzIGZyZWVkICovCiAJ
CWlmICghSVNfRVJSKHZtYSkgJiYgIWk5MTVfdm1hX2lzX2dndHQodm1hKSkKIAkJCWk5MTVfdm1h
X2Nsb3NlKHZtYSk7CkBAIC00NDQsNyArNDQ2LDcgQEAgc3RhdGljIGludCBmaWxsX2hvbGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQlnb3RvIGVycjsKIAkJCQkJfQogCi0J
CQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJCQllcnIgPSB1bmxvY2tlZF92bWFf
dW5iaW5kKHZtYSk7CiAJCQkJCWlmIChlcnIpIHsKIAkJCQkJCXByX2VycigiJXMoJXMpIChmb3J3
YXJkKSB1bmJpbmQgb2Ygdm1hLm5vZGU9JWxseCArICVsbHggZmFpbGVkIHdpdGggZXJyPSVkXG4i
LAogCQkJCQkJICAgICAgIF9fZnVuY19fLCBwLT5uYW1lLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+
bm9kZS5zaXplLApAQCAtNTE3LDcgKzUxOSw3IEBAIHN0YXRpYyBpbnQgZmlsbF9ob2xlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkJZ290byBlcnI7CiAJCQkJCX0KIAotCQkJ
CQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQkJZXJyID0gdW5sb2NrZWRfdm1hX3Vu
YmluZCh2bWEpOwogCQkJCQlpZiAoZXJyKSB7CiAJCQkJCQlwcl9lcnIoIiVzKCVzKSAoYmFja3dh
cmQpIHVuYmluZCBvZiB2bWEubm9kZT0lbGx4ICsgJWxseCBmYWlsZWQgd2l0aCBlcnI9JWRcbiIs
CiAJCQkJCQkgICAgICAgX19mdW5jX18sIHAtPm5hbWUsIHZtYS0+bm9kZS5zdGFydCwgdm1hLT5u
b2RlLnNpemUsCkBAIC02MDQsNyArNjA2LDcgQEAgc3RhdGljIGludCB3YWxrX2hvbGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJZ290byBlcnJfY2xvc2U7CiAJCQl9CiAKLQkJ
CWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmlu
ZCh2bWEpOwogCQkJaWYgKGVycikgewogCQkJCXByX2VycigiJXMgdW5iaW5kIGZhaWxlZCBhdCAl
bGx4ICsgJWxseCAgd2l0aCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIF9fZnVuY19fLCBhZGRyLCB2
bWEtPnNpemUsIGVycik7CkBAIC02ODUsMTMgKzY4NywxMyBAQCBzdGF0aWMgaW50IHBvdF9ob2xl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXByX2VycigiJXMgaW5jb3JyZWN0
IGF0ICVsbHggKyAlbGx4XG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgYWRkciwgdm1hLT5zaXpl
KTsKIAkJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwotCQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2
bWEpOworCQkJCWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJCQllcnIgPSAtRUlO
VkFMOwogCQkJCWdvdG8gZXJyOwogCQkJfQogCiAJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwotCQkJ
ZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5k
KHZtYSk7CiAJCQlHRU1fQlVHX09OKGVycik7CiAJCX0KIApAQCAtNzg5LDEzICs3OTEsMTMgQEAg
c3RhdGljIGludCBkcnVua19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
CXByX2VycigiJXMgaW5jb3JyZWN0IGF0ICVsbHggKyAlbGx4XG4iLAogCQkJCSAgICAgICBfX2Z1
bmNfXywgYWRkciwgQklUX1VMTChzaXplKSk7CiAJCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJ
CQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5i
aW5kKHZtYSk7CiAJCQkJZXJyID0gLUVJTlZBTDsKIAkJCQlnb3RvIGVycjsKIAkJCX0KIAogCQkJ
aTkxNV92bWFfdW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJ
ZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJR0VNX0JVR19PTihlcnIpOwogCiAJ
CQlpZiAoaWd0X3RpbWVvdXQoZW5kX3RpbWUsCkBAIC04NjcsNyArODY5LDcgQEAgc3RhdGljIGlu
dCBfX3Nocmlua19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJcHJfZXJy
KCIlcyBpbmNvcnJlY3QgYXQgJWxseCArICVsbHhcbiIsCiAJCQkgICAgICAgX19mdW5jX18sIGFk
ZHIsIHNpemUpOwogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVfdm1hX3Vu
YmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJZXJyID0g
LUVJTlZBTDsKIAkJCWJyZWFrOwogCQl9CkBAIC04NzUsNiArODc3LDE1IEBAIHN0YXRpYyBpbnQg
X19zaHJpbmtfaG9sZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaTkxNV92bWFf
dW5waW4odm1hKTsKIAkJYWRkciArPSBzaXplOwogCisJCS8qCisJCSAqIFNpbmNlIHdlIGFyZSBp
bmplY3RpbmcgYWxsb2NhdGlvbiBmYXVsdHMgYXQgcmFuZG9tIGludGVydmFscywKKwkJICogd2Fp
dCBmb3IgdGhpcyBhbGxvY2F0aW9uIHRvIGNvbXBsZXRlIGJlZm9yZSB3ZSBjaGFuZ2UgdGhlCisJ
CSAqIGZhdWx0aW5qZWN0aW9uLgorCQkgKi8KKwkJZXJyID0gaTkxNV9hY3RpdmVfd2FpdCgmdm1h
LT5hY3RpdmUpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisKIAkJaWYgKGlndF90aW1lb3V0KGVu
ZF90aW1lLAogCQkJCSIlcyB0aW1lZCBvdXQgYXQgb2ZzZXQgJWxseCBbJWxseCAtICVsbHhdXG4i
LAogCQkJCV9fZnVuY19fLCBhZGRyLCBob2xlX3N0YXJ0LCBob2xlX2VuZCkpIHsKQEAgLTEwMDgs
MjEgKzEwMTksMTkgQEAgc3RhdGljIGludCBleGVyY2lzZV9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIo
ZmlsZSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcHBn
dHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7CiAJaWYgKElTX0VSUihwcGd0dCkpIHsK
IAkJZXJyID0gUFRSX0VSUihwcGd0dCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRf
ZnJlZTsKIAl9CiAJR0VNX0JVR19PTihvZmZzZXRfaW5fcGFnZShwcGd0dC0+dm0udG90YWwpKTsK
LQlHRU1fQlVHX09OKHBwZ3R0LT52bS5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFk
KCZwcGd0dC0+dm0ub3BlbikpOwogCiAJZXJyID0gZnVuYyhkZXZfcHJpdiwgJnBwZ3R0LT52bSwg
MCwgcHBndHQtPnZtLnRvdGFsLCBlbmRfdGltZSk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZt
KTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKK291dF9mcmVlOgogCW1vY2tfZmlsZV9mcmVlKGRldl9wcml2LCBmaWxlKTsKIAlyZXR1
cm4gZXJyOwogfQpAQCAtMTA4NSw3ICsxMDk0LDYgQEAgc3RhdGljIGludCBleGVyY2lzZV9nZ3R0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsK
IAlpbnQgZXJyID0gMDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
cmVzdGFydDoKIAlsaXN0X3NvcnQoTlVMTCwgJmdndHQtPnZtLm1tLmhvbGVfc3RhY2ssIHNvcnRf
aG9sZXMpOwogCWRybV9tbV9mb3JfZWFjaF9ob2xlKG5vZGUsICZnZ3R0LT52bS5tbSwgaG9sZV9z
dGFydCwgaG9sZV9lbmQpIHsKQEAgLTExMDYsNyArMTExNCw2IEBAIHN0YXRpYyBpbnQgZXhlcmNp
c2VfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJbGFzdCA9IGhvbGVfZW5k
OwogCQlnb3RvIHJlc3RhcnQ7CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTE0OCwxMyArMTE1NSw5IEBAIHN0YXRpYyBp
bnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJdW5zaWduZWQgaW50ICpvcmRlciwgbjsKIAlp
bnQgZXJyOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlvYmog
PSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYg
KElTX0VSUihvYmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBvdXRfdW5sb2Nr
OwotCX0KKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAllcnIg
PSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CiAJaWYgKGVycikKQEAgLTEyMjIsOCAr
MTIyNSw2IEBAIHN0YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJaTkxNV9nZW1f
b2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiBvdXRfZnJlZToKIAlpOTE1X2dlbV9vYmplY3RfcHV0
KG9iaik7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTIzNCw2ICsxMjM1LDkgQEAgc3RhdGljIHZvaWQg
dHJhY2tfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJYXRvbWljX2luYygmb2JqLT5i
aW5kX2NvdW50KTsgLyogdHJhY2sgZm9yIGV2aWN0aW9uIGxhdGVyICovCiAJX19pOTE1X2dlbV9v
YmplY3RfcGluX3BhZ2VzKG9iaik7CiAKKwlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOworCWF0b21p
Y19zZXQoJnZtYS0+cGFnZXNfY291bnQsIEk5MTVfVk1BX1BBR0VTX0FDVElWRSk7CisJX19pOTE1
X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CiAJdm1hLT5wYWdlcyA9IG9iai0+bW0ucGFnZXM7
CiAKIAltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CkBAIC0xMzMwLDExICsxMzM0LDEzIEBA
IHN0YXRpYyBpbnQgaWd0X2d0dF9yZXNlcnZlKHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9
CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRf
cmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIG9iai0+YmFzZS5zaXplLAog
CQkJCQkgICB0b3RhbCwKIAkJCQkJICAgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAgMCk7CisJ
CW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIo
Imk5MTVfZ2VtX2d0dF9yZXNlcnZlIChwYXNzIDEpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0aCBl
cnI9JWRcbiIsCiAJCQkgICAgICAgdG90YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAtMTM4
MCwxMSArMTM4NiwxMyBAQCBzdGF0aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lkICphcmcpCiAJ
CQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJy
ID0gaTkxNV9nZW1fZ3R0X3Jlc2VydmUoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBv
YmotPmJhc2Uuc2l6ZSwKIAkJCQkJICAgdG90YWwsCiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWws
CiAJCQkJCSAgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVy
cikgewogCQkJcHJfZXJyKCJpOTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAyKSBmYWlsZWQgYXQg
JWxsdS8lbGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3Rh
bCwgZXJyKTsKQEAgLTE0MTQsNyArMTQyMiw3IEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9yZXNlcnZl
KHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKLQkJZXJyID0gaTkxNV92bWFfdW5iaW5k
KHZtYSk7CisJCWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJaWYgKGVycikgewog
CQkJcHJfZXJyKCJpOTE1X3ZtYV91bmJpbmQgZmFpbGVkIHdpdGggZXJyPSVkIVxuIiwgZXJyKTsK
IAkJCWdvdG8gb3V0OwpAQCAtMTQyNCwxMSArMTQzMiwxMyBAQCBzdGF0aWMgaW50IGlndF9ndHRf
cmVzZXJ2ZSh2b2lkICphcmcpCiAJCQkJICAgICAgIDIqSTkxNV9HVFRfUEFHRV9TSVpFLAogCQkJ
CSAgICAgICBJOTE1X0dUVF9NSU5fQUxJR05NRU5UKTsKIAorCQltdXRleF9sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJnZtYS0+
bm9kZSwKIAkJCQkJICAgb2JqLT5iYXNlLnNpemUsCiAJCQkJCSAgIG9mZnNldCwKIAkJCQkJICAg
b2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9yZXNlcnZlIChw
YXNzIDMpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0aCBlcnI9JWRcbiIsCiAJCQkgICAgICAgdG90
YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAtMTQ5NywxMSArMTUwNywxMyBAQCBzdGF0aWMg
aW50IGlndF9ndHRfaW5zZXJ0KHZvaWQgKmFyZykKIAogCS8qIENoZWNrIGEgY291cGxlIG9mIG9i
dmlvdXNseSBpbnZhbGlkIHJlcXVlc3RzICovCiAJZm9yIChpaSA9IGludmFsaWRfaW5zZXJ0OyBp
aS0+c2l6ZTsgaWkrKykgeworCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWVyciA9
IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmdndHQtPnZtLCAmdG1wLAogCQkJCQkgIGlpLT5zaXplLCBp
aS0+YWxpZ25tZW50LAogCQkJCQkgIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCiAJCQkJCSAgaWkt
PnN0YXJ0LCBpaS0+ZW5kLAogCQkJCQkgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11
dGV4KTsKIAkJaWYgKGVyciAhPSAtRU5PU1BDKSB7CiAJCQlwcl9lcnIoIkludmFsaWQgaTkxNV9n
ZW1fZ3R0X2luc2VydCguc2l6ZT0lbGx4LCAuYWxpZ25tZW50PSVsbHgsIC5zdGFydD0lbGx4LCAu
ZW5kPSVsbHgpIHN1Y2NlZWRlZCAoZXJyPSVkKVxuIiwKIAkJCSAgICAgICBpaS0+c2l6ZSwgaWkt
PmFsaWdubWVudCwgaWktPnN0YXJ0LCBpaS0+ZW5kLApAQCAtMTUzNywxMCArMTU0OSwxMiBAQCBz
dGF0aWMgaW50IGlndF9ndHRfaW5zZXJ0KHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAK
KwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfaW5z
ZXJ0KCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICBvYmotPmJhc2Uuc2l6ZSwgMCwgb2Jq
LT5jYWNoZV9sZXZlbCwKIAkJCQkJICAwLCBnZ3R0LT52bS50b3RhbCwKIAkJCQkJICAwKTsKKwkJ
bXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIgPT0gLUVOT1NQQykgewog
CQkJLyogbWF4ZWQgb3V0IHRoZSBHR1RUIHNwYWNlICovCiAJCQlpOTE1X2dlbV9vYmplY3RfcHV0
KG9iaik7CkBAIC0xNTg5LDE2ICsxNjAzLDE4IEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9pbnNlcnQo
dm9pZCAqYXJnKQogCQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9k
ZSkpOwogCQlvZmZzZXQgPSB2bWEtPm5vZGUuc3RhcnQ7CiAKLQkJZXJyID0gaTkxNV92bWFfdW5i
aW5kKHZtYSk7CisJCWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJaWYgKGVycikg
ewogCQkJcHJfZXJyKCJpOTE1X3ZtYV91bmJpbmQgZmFpbGVkIHdpdGggZXJyPSVkIVxuIiwgZXJy
KTsKIAkJCWdvdG8gb3V0OwogCQl9CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CQllcnIgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJ
ICBvYmotPmJhc2Uuc2l6ZSwgMCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAwLCBnZ3R0LT52
bS50b3RhbCwKIAkJCQkJICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJ
CWlmIChlcnIpIHsKIAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X2luc2VydCAocGFzcyAyKSBmYWls
ZWQgYXQgJWxsdS8lbGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52
bS50b3RhbCwgZXJyKTsKQEAgLTE2NDIsMTAgKzE2NTgsMTIgQEAgc3RhdGljIGludCBpZ3RfZ3R0
X2luc2VydCh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdn
dHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2
bWEtPm5vZGUsCiAJCQkJCSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJ
CQkJCSAgMCwgZ2d0dC0+dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0
dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9pbnNl
cnQgKHBhc3MgMykgZmFpbGVkIGF0ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAg
ICB0b3RhbCwgZ2d0dC0+dm0udG90YWwsIGVycik7CkBAIC0xNjg5LDggKzE3MDcsOSBAQCBpbnQg
aTkxNV9nZW1fZ3R0X21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJfQogCW1vY2tfaW5pdF9nZ3R0KGk5
MTUsIGdndHQpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJy
ID0gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgZ2d0dCk7CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKIAltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X3ZtYS5jCmluZGV4IDk3NzUyZGVlY2NjYi4uZTBjYTEyYzE3YTdmIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtMzM3LDcgKzMzNyw5IEBAIHN0
YXRpYyBpbnQgaWd0X3ZtYV9waW4xKHZvaWQgKmFyZykKIAogCQlpZiAoIWVycikgewogCQkJaTkx
NV92bWFfdW5waW4odm1hKTsKKwkJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWVy
ciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRl
eCk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gdW5iaW5kIHNpbmdsZSBw
YWdlIGZyb20gR0dUVCwgZXJyPSVkXG4iLCBlcnIpOwogCQkJCWdvdG8gb3V0OwpAQCAtODMxLDgg
KzgzMyw5IEBAIGludCBpOTE1X3ZtYV9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCX0KIAltb2NrX2lu
aXRfZ2d0dChpOTE1LCBnZ3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGdndHQpOworCisJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7CiAJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIApAQCAtODc5LDggKzg4Miw2IEBA
IHN0YXRpYyBpbnQgaWd0X3ZtYV9yZW1hcHBlZF9ndHQodm9pZCAqYXJnKQogCWlmIChJU19FUlIo
b2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5y
dW50aW1lX3BtKTsKIAogCWZvciAodCA9IHR5cGVzOyAqdDsgdCsrKSB7CkBAIC05NzYsNyArOTc3
LDYgQEAgc3RhdGljIGludCBpZ3Rfdm1hX3JlbWFwcGVkX2d0dCh2b2lkICphcmcpCiAKIG91dDoK
IAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9vYmplY3RfcHV0
KG9iaik7CiAKIAlyZXR1cm4gZXJyOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E4F8361E32
	for <lists+intel-gfx@lfdr.de>; Mon,  8 Jul 2019 14:10:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5B96F89C99;
	Mon,  8 Jul 2019 12:10:38 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 84D5E89C99
 for <intel-gfx@lists.freedesktop.org>; Mon,  8 Jul 2019 12:10:37 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 08 Jul 2019 05:10:37 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,466,1557212400"; d="scan'208";a="170270506"
Received: from dawalker-mobl.ger.corp.intel.com (HELO [10.251.80.131])
 ([10.251.80.131])
 by orsmga006.jf.intel.com with ESMTP; 08 Jul 2019 05:10:35 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190708111944.20095-1-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <90ade255-1338-0c87-4df9-f445b66cefaf@linux.intel.com>
Date: Mon, 8 Jul 2019 13:10:34 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.7.1
MIME-Version: 1.0
In-Reply-To: <20190708111944.20095-1-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH 1/2] drm/i915/oa: Reconfigure contexts on
 the fly
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDA4LzA3LzIwMTkgMTI6MTksIENocmlzIFdpbHNvbiB3cm90ZToKPiBBdm9pZCBhIGdsb2Jh
bCBpZGxlIGJhcnJpZXIgYnkgcmVjb25maWd1cmluZyBlYWNoIGNvbnRleHQgYnkgcmV3cml0aW5n
Cj4gdGhlbSB3aXRoIE1JX1NUT1JFX0RXT1JEIGZyb20gdGhlIGtlcm5lbCBjb250ZXh0Lgo+IAo+
IHYyOiBXZSBvbmx5IG5lZWQgdG8gZGV0ZXJtaW5lIHRoZSBkZXNpcmVkIHJlZ2lzdGVyIHZhbHVl
cyBvbmNlLCB0aGV5IGFyZQo+IHRoZSBzYW1lIGZvciBhbGwgY29udGV4dHMuCj4gCj4gU2lnbmVk
LW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Cj4gQ2M6IExp
b25lbCBMYW5kd2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNvbT4KPiBDYzogVHZy
dGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KPiBSZXZpZXdlZC1ieTogTGlv
bmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgo+IC0tLQo+ICAg
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAgMiArCj4gICBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgIHwgICA3ICstCj4gICBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgIHwgMjQ4ICsrKysrKysr
KysrKysrKy0tLS0tCj4gICAzIGZpbGVzIGNoYW5nZWQsIDE5NSBpbnNlcnRpb25zKCspLCA2MiBk
ZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0LmMKPiBpbmRleCBlMzY3ZGNlMmE2OTYuLjFmMGQxMGJiODhjMSAxMDA2NDQKPiAtLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCj4gKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwo+IEBAIC02MjQsNyArNjI0LDkg
QEAgaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCBpbnQgcHJpbykKPiAgIAljdHgtPnNjaGVkLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BS
SU9SSVRZKHByaW8pOwo+ICAgCWN0eC0+cmluZ19zaXplID0gUEFHRV9TSVpFOwo+ICAgCj4gKwkv
KiBJc29sYXRlIHRoZSBrZXJuZWwgY29udGV4dCBmcm9tIHByeWluZyBleWVzIGFuZCBzdGlja3kg
ZmluZ2VycyAqLwo+ICAgCUdFTV9CVUdfT04oIWk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKGN0
eCkpOwo+ICsJbGlzdF9kZWxfaW5pdCgmY3R4LT5saW5rKTsKCldoeSBleGFjdGx5PwoKQW55IHJl
cGVyY3Vzc2lvbnMgZm9yIGk5MTVfc3lzZnMvaTkxNV9sM193cml0ZT8gZGVidWdmcyBJIGdhdGhl
ciB5b3UgCndvbid0IGNhcmUgYWJvdXQ/CgpTaG91bGQgYWRkaW5nIHRvIGk5MTUtPmNvbnRleHRz
Lmxpc3QgYmUgZG9uZSBmcm9tIGdlbV9jb250ZXh0X3JlZ2lzdGVyPyAKV2hhdCByZW1haW5zIG5v
dCBhIGtlcm5lbCBjb250ZXh0LCBidXQgb24gYSBsaXN0PwoKV29uJ3QgcHJlZW1wdCBjb250ZXh0
IGJlIG1pc3NlZCBpbiByZS1jb25maWd1cmF0aW9uPwoKUmVnYXJkcywKClR2cnRrbwoKPiAgIAo+
ICAgCXJldHVybiBjdHg7Cj4gICB9Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKPiBp
bmRleCBlMWFlMTM5OWM3MmIuLjljYzUzNzQ0MDFlMSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jCj4gQEAgLTE1NTIsOSArMTU1MiwxMiBAQCBfX2V4ZWNsaXN0c191cGRhdGVf
cmVnX3N0YXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKPiAgIAlyZWdzW0NUWF9SSU5HX1RB
SUwgKyAxXSA9IHJpbmctPnRhaWw7Cj4gICAKPiAgIAkvKiBSUENTICovCj4gLQlpZiAoZW5naW5l
LT5jbGFzcyA9PSBSRU5ERVJfQ0xBU1MpCj4gKwlpZiAoZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJf
Q0xBU1MpIHsKPiAgIAkJcmVnc1tDVFhfUl9QV1JfQ0xLX1NUQVRFICsgMV0gPQo+ICAgCQkJaW50
ZWxfc3NldV9tYWtlX3JwY3MoZW5naW5lLT5pOTE1LCAmY2UtPnNzZXUpOwo+ICsKPiArCQlpOTE1
X29hX2luaXRfcmVnX3N0YXRlKGVuZ2luZSwgY2UsIHJlZ3MpOwo+ICsJfQo+ICAgfQo+ICAgCj4g
ICBzdGF0aWMgaW50Cj4gQEAgLTI5NjYsOCArMjk2OSw2IEBAIHN0YXRpYyB2b2lkIGV4ZWNsaXN0
c19pbml0X3JlZ19zdGF0ZSh1MzIgKnJlZ3MsCj4gICAJaWYgKHJjcykgewo+ICAgCQlyZWdzW0NU
WF9MUklfSEVBREVSXzJdID0gTUlfTE9BRF9SRUdJU1RFUl9JTU0oMSk7Cj4gICAJCUNUWF9SRUco
cmVncywgQ1RYX1JfUFdSX0NMS19TVEFURSwgR0VOOF9SX1BXUl9DTEtfU1RBVEUsIDApOwo+IC0K
PiAtCQlpOTE1X29hX2luaXRfcmVnX3N0YXRlKGVuZ2luZSwgY2UsIHJlZ3MpOwo+ICAgCX0KPiAg
IAo+ICAgCXJlZ3NbQ1RYX0VORF0gPSBNSV9CQVRDSF9CVUZGRVJfRU5EOwo+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcGVyZi5jCj4gaW5kZXggMzU3ZTYzYmViMzczLi4yNWMzNGEwYjUyMWUgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKPiArKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmYuYwo+IEBAIC0xNjMwLDYgKzE2MzAsMjcgQEAgc3RhdGljIHZv
aWQgaHN3X2Rpc2FibGVfbWV0cmljX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCj4gICAJCQkJICAgICAgfkdUX05PQV9FTkFCTEUpKTsKPiAgIH0KPiAgIAo+ICtzdGF0aWMg
dTMyIG9hX2NvbmZpZ19mbGV4X3JlZyhjb25zdCBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2Nv
bmZpZywKPiArCQkJICAgICAgaTkxNV9yZWdfdCByZWcpCj4gK3sKPiArCXUzMiBtbWlvID0gaTkx
NV9tbWlvX3JlZ19vZmZzZXQocmVnKTsKPiArCWludCBpOwo+ICsKPiArCS8qCj4gKwkgKiBUaGlz
IGFyYml0cmFyeSBkZWZhdWx0IHdpbGwgc2VsZWN0IHRoZSAnRVUgRlBVMCBQaXBlbGluZQo+ICsJ
ICogQWN0aXZlJyBldmVudC4gSW4gdGhlIGZ1dHVyZSBpdCdzIGFudGljaXBhdGVkIHRoYXQgdGhl
cmUKPiArCSAqIHdpbGwgYmUgYW4gZXhwbGljaXQgJ05vIEV2ZW50JyB3ZSBjYW4gc2VsZWN0LCBi
dXQgbm90IHlldC4uLgo+ICsJICovCj4gKwlpZiAoIW9hX2NvbmZpZykKPiArCQlyZXR1cm4gMDsK
PiArCj4gKwlmb3IgKGkgPSAwOyBpIDwgb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuOyBpKyspIHsK
PiArCQlpZiAoaTkxNV9tbWlvX3JlZ19vZmZzZXQob2FfY29uZmlnLT5mbGV4X3JlZ3NbaV0uYWRk
cikgPT0gbW1pbykKPiArCQkJcmV0dXJuIG9hX2NvbmZpZy0+ZmxleF9yZWdzW2ldLnZhbHVlOwo+
ICsJfQo+ICsKPiArCXJldHVybiAwOwo+ICt9Cj4gICAvKgo+ICAgICogTkI6IEl0IG11c3QgYWx3
YXlzIHJlbWFpbiBwb2ludGVyIHNhZmUgdG8gcnVuIHRoaXMgZXZlbiBpZiB0aGUgT0EgdW5pdAo+
ICAgICogaGFzIGJlZW4gZGlzYWJsZWQuCj4gQEAgLTE2NjMsMjggKzE2ODQsOCBAQCBnZW44X3Vw
ZGF0ZV9yZWdfc3RhdGVfdW5sb2NrZWQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAo+ICAgCQlH
RU44X09BX0NPVU5URVJfUkVTVU1FKTsKPiAgIAo+ICAgCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKGZsZXhfcmVncyk7IGkrKykgewo+IC0JCXUzMiBzdGF0ZV9vZmZzZXQgPSBjdHhfZmxleGV1
MCArIGkgKiAyOwo+IC0JCXUzMiBtbWlvID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoZmxleF9yZWdz
W2ldKTsKPiAtCj4gLQkJLyoKPiAtCQkgKiBUaGlzIGFyYml0cmFyeSBkZWZhdWx0IHdpbGwgc2Vs
ZWN0IHRoZSAnRVUgRlBVMCBQaXBlbGluZQo+IC0JCSAqIEFjdGl2ZScgZXZlbnQuIEluIHRoZSBm
dXR1cmUgaXQncyBhbnRpY2lwYXRlZCB0aGF0IHRoZXJlCj4gLQkJICogd2lsbCBiZSBhbiBleHBs
aWNpdCAnTm8gRXZlbnQnIHdlIGNhbiBzZWxlY3QsIGJ1dCBub3QgeWV0Li4uCj4gLQkJICovCj4g
LQkJdTMyIHZhbHVlID0gMDsKPiAtCj4gLQkJaWYgKG9hX2NvbmZpZykgewo+IC0JCQl1MzIgajsK
PiAtCj4gLQkJCWZvciAoaiA9IDA7IGogPCBvYV9jb25maWctPmZsZXhfcmVnc19sZW47IGorKykg
ewo+IC0JCQkJaWYgKGk5MTVfbW1pb19yZWdfb2Zmc2V0KG9hX2NvbmZpZy0+ZmxleF9yZWdzW2pd
LmFkZHIpID09IG1taW8pIHsKPiAtCQkJCQl2YWx1ZSA9IG9hX2NvbmZpZy0+ZmxleF9yZWdzW2pd
LnZhbHVlOwo+IC0JCQkJCWJyZWFrOwo+IC0JCQkJfQo+IC0JCQl9Cj4gLQkJfQo+IC0KPiAtCQlD
VFhfUkVHKHJlZ19zdGF0ZSwgc3RhdGVfb2Zmc2V0LCBmbGV4X3JlZ3NbaV0sIHZhbHVlKTsKPiAr
CQlDVFhfUkVHKHJlZ19zdGF0ZSwgY3R4X2ZsZXhldTAgKyBpICogMiwgZmxleF9yZWdzW2ldLAo+
ICsJCQlvYV9jb25maWdfZmxleF9yZWcob2FfY29uZmlnLCBmbGV4X3JlZ3NbaV0pKTsKPiAgIAl9
Cj4gICAKPiAgIAlDVFhfUkVHKHJlZ19zdGF0ZSwKPiBAQCAtMTY5Miw2ICsxNjkzLDEwNyBAQCBn
ZW44X3VwZGF0ZV9yZWdfc3RhdGVfdW5sb2NrZWQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAo+
ICAgCQlpbnRlbF9zc2V1X21ha2VfcnBjcyhpOTE1LCAmY2UtPnNzZXUpKTsKPiAgIH0KPiAgIAo+
ICtzdHJ1Y3QgZmxleCB7Cj4gKwlpOTE1X3JlZ190IHJlZzsKPiArCXUzMiBvZmZzZXQ7Cj4gKwl1
MzIgdmFsdWU7Cj4gK307Cj4gKwo+ICtzdGF0aWMgaW50Cj4gK2dlbjhfc3RvcmVfZmxleChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwKPiArCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCj4gKwkJ
Y29uc3Qgc3RydWN0IGZsZXggKmZsZXgsIHVuc2lnbmVkIGludCBjb3VudCkKPiArewo+ICsJdTMy
IG9mZnNldDsKPiArCXUzMiAqY3M7Cj4gKwo+ICsJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCA0
ICogY291bnQpOwo+ICsJaWYgKElTX0VSUihjcykpCj4gKwkJcmV0dXJuIFBUUl9FUlIoY3MpOwo+
ICsKPiArCW9mZnNldCA9IGk5MTVfZ2d0dF9vZmZzZXQoY2UtPnN0YXRlKSArIExSQ19TVEFURV9Q
TiAqIFBBR0VfU0laRTsKPiArCWRvIHsKPiArCQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9H
RU40IHwgTUlfVVNFX0dHVFQ7Cj4gKwkJKmNzKysgPSBvZmZzZXQgKyAoZmxleC0+b2Zmc2V0ICsg
MSkgKiBzaXplb2YodTMyKTsKPiArCQkqY3MrKyA9IDA7Cj4gKwkJKmNzKysgPSBmbGV4LT52YWx1
ZTsKPiArCX0gd2hpbGUgKGZsZXgrKywgLS1jb3VudCk7Cj4gKwo+ICsJaW50ZWxfcmluZ19hZHZh
bmNlKHJxLCBjcyk7Cj4gKwo+ICsJcmV0dXJuIDA7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQKPiAr
Z2VuOF9sb2FkX2ZsZXgoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCj4gKwkgICAgICAgc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAo+ICsJICAgICAgIGNvbnN0IHN0cnVjdCBmbGV4ICpmbGV4LCB1
bnNpZ25lZCBpbnQgY291bnQpCj4gK3sKPiArCXUzMiAqY3M7Cj4gKwo+ICsJR0VNX0JVR19PTigh
Y291bnQgfHwgY291bnQgPiA2Myk7Cj4gKwo+ICsJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCAy
ICogY291bnQgKyAyKTsKPiArCWlmIChJU19FUlIoY3MpKQo+ICsJCXJldHVybiBQVFJfRVJSKGNz
KTsKPiArCj4gKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKGNvdW50KTsKPiArCWRvIHsK
PiArCQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KGZsZXgtPnJlZyk7Cj4gKwkJKmNzKysg
PSBmbGV4LT52YWx1ZTsKPiArCX0gd2hpbGUgKGZsZXgrKywgLS1jb3VudCk7Cj4gKwkqY3MrKyA9
IE1JX05PT1A7Cj4gKwo+ICsJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7Cj4gKwo+ICsJcmV0
dXJuIDA7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQgZ2VuOF9tb2RpZnlfY29udGV4dChzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UsCj4gKwkJCSAgICAgICBjb25zdCBzdHJ1Y3QgZmxleCAqZmxleCwg
dW5zaWduZWQgaW50IGNvdW50KQo+ICt7Cj4gKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKPiAr
CWludCBlcnI7Cj4gKwo+ICsJbG9ja2RlcF9hc3NlcnRfaGVsZCgmY2UtPnBpbl9tdXRleCk7Cj4g
Kwo+ICsJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNlLT5lbmdpbmUtPmtlcm5lbF9jb250ZXh0
KTsKPiArCWlmIChJU19FUlIocnEpKQo+ICsJCXJldHVybiBQVFJfRVJSKHJxKTsKPiArCj4gKwkv
KiBTZXJpYWxpc2Ugd2l0aCB0aGUgcmVtb3RlIGNvbnRleHQgKi8KPiArCWVyciA9IGk5MTVfYWN0
aXZlX3JlcXVlc3Rfc2V0KCZjZS0+cmluZy0+dGltZWxpbmUtPmxhc3RfcmVxdWVzdCwgcnEpOwo+
ICsJaWYgKGVycikKPiArCQlnb3RvIG91dF9hZGQ7Cj4gKwo+ICsJLyogS2VlcCB0aGUgcmVtb3Rl
IGNvbnRleHQgYWxpdmUgdW50aWwgYWZ0ZXIgd2UgZmluaXNoIGVkaXRpbmcgKi8KPiArCWVyciA9
IGk5MTVfYWN0aXZlX3JlZigmY2UtPmFjdGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJxKTsKPiAr
CWlmIChlcnIpCj4gKwkJZ290byBvdXRfYWRkOwo+ICsKPiArCWVyciA9IGdlbjhfc3RvcmVfZmxl
eChycSwgY2UsIGZsZXgsIGNvdW50KTsKPiArCj4gK291dF9hZGQ6Cj4gKwlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKPiArCXJldHVybiBlcnI7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQgZ2VuOF9tb2Rp
Znlfc2VsZihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCj4gKwkJCSAgICBjb25zdCBzdHJ1Y3Qg
ZmxleCAqZmxleCwgdW5zaWduZWQgaW50IGNvdW50KQo+ICt7Cj4gKwlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKPiArCWludCBlcnI7Cj4gKwo+ICsJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNl
KTsKPiArCWlmIChJU19FUlIocnEpKQo+ICsJCXJldHVybiBQVFJfRVJSKHJxKTsKPiArCj4gKwll
cnIgPSBnZW44X2xvYWRfZmxleChycSwgY2UsIGZsZXgsIGNvdW50KTsKPiArCj4gKwlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKPiArCXJldHVybiBlcnI7Cj4gK30KPiArCj4gICAvKgo+ICAgICogTWFu
YWdlcyB1cGRhdGluZyB0aGUgcGVyLWNvbnRleHQgYXNwZWN0cyBvZiB0aGUgT0Egc3RyZWFtCj4g
ICAgKiBjb25maWd1cmF0aW9uIGFjcm9zcyBhbGwgY29udGV4dHMuCj4gQEAgLTE3MTYsMTUgKzE4
MTgsNDMgQEAgZ2VuOF91cGRhdGVfcmVnX3N0YXRlX3VubG9ja2VkKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwKPiAgICAqCj4gICAgKiBOb3RlOiBpdCdzIG9ubHkgdGhlIFJDUy9SZW5kZXIgY29u
dGV4dCB0aGF0IGhhcyBhbnkgT0Egc3RhdGUuCj4gICAgKi8KPiAtc3RhdGljIGludCBnZW44X2Nv
bmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAo+
ICtzdGF0aWMgaW50IGdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKPiAgIAkJCQkgICAgICAgY29uc3Qgc3RydWN0IGk5MTVfb2FfY29uZmln
ICpvYV9jb25maWcpCj4gICB7Cj4gLQl1bnNpZ25lZCBpbnQgbWFwX3R5cGUgPSBpOTE1X2NvaGVy
ZW50X21hcF90eXBlKGRldl9wcml2KTsKPiArCS8qIFRoZSBNTUlPIG9mZnNldHMgZm9yIEZsZXgg
RVUgcmVnaXN0ZXJzIGFyZW4ndCBjb250aWd1b3VzICovCj4gKwljb25zdCB1MzIgY3R4X2ZsZXhl
dTAgPSBpOTE1LT5wZXJmLm9hLmN0eF9mbGV4ZXUwX29mZnNldDsKPiArI2RlZmluZSBjdHhfZmxl
eGV1TihOKSAoY3R4X2ZsZXhldTAgKyAyICogKE4pKQo+ICsJc3RydWN0IGZsZXggcmVnc1tdID0g
ewo+ICsJCXsKPiArCQkJR0VOOF9SX1BXUl9DTEtfU1RBVEUsCj4gKwkJCUNUWF9SX1BXUl9DTEtf
U1RBVEUsCj4gKwkJfSwKPiArCQl7Cj4gKwkJCUdFTjhfT0FDVFhDT05UUk9MLAo+ICsJCQlpOTE1
LT5wZXJmLm9hLmN0eF9vYWN0eGN0cmxfb2Zmc2V0LAo+ICsJCQkoKGk5MTUtPnBlcmYub2EucGVy
aW9kX2V4cG9uZW50IDw8IEdFTjhfT0FfVElNRVJfUEVSSU9EX1NISUZUKSB8Cj4gKwkJCSAoaTkx
NS0+cGVyZi5vYS5wZXJpb2RpYyA/IEdFTjhfT0FfVElNRVJfRU5BQkxFIDogMCkgfAo+ICsJCQkg
R0VOOF9PQV9DT1VOVEVSX1JFU1VNRSkKPiArCQl9LAo+ICsJCXsgRVVfUEVSRl9DTlRMMCwgY3R4
X2ZsZXhldU4oMCkgfSwKPiArCQl7IEVVX1BFUkZfQ05UTDEsIGN0eF9mbGV4ZXVOKDEpIH0sCj4g
KwkJeyBFVV9QRVJGX0NOVEwyLCBjdHhfZmxleGV1TigyKSB9LAo+ICsJCXsgRVVfUEVSRl9DTlRM
MywgY3R4X2ZsZXhldU4oMykgfSwKPiArCQl7IEVVX1BFUkZfQ05UTDQsIGN0eF9mbGV4ZXVOKDQp
IH0sCj4gKwkJeyBFVV9QRVJGX0NOVEw1LCBjdHhfZmxleGV1Tig1KSB9LAo+ICsJCXsgRVVfUEVS
Rl9DTlRMNiwgY3R4X2ZsZXhldU4oNikgfSwKPiArCX07Cj4gKyN1bmRlZiBjdHhfZmxleGV1Tgo+
ICsJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwo+ICAgCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHg7Cj4gLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKPiAtCWludCByZXQ7Cj4g
KwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKPiArCWludCBlcnI7Cj4gKwlpbnQgaTsKPiArCj4g
Kwlmb3IgKGkgPSAyOyBpIDwgQVJSQVlfU0laRShyZWdzKTsgaSsrKQo+ICsJCXJlZ3NbaV0udmFs
dWUgPSBvYV9jb25maWdfZmxleF9yZWcob2FfY29uZmlnLCByZWdzW2ldLnJlZyk7Cj4gICAKPiAt
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKPiArCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwo+ICAgCj4gICAJLyoK
PiAgIAkgKiBUaGUgT0EgcmVnaXN0ZXIgY29uZmlnIGlzIHNldHVwIHRocm91Z2ggdGhlIGNvbnRl
eHQgaW1hZ2UuIFRoaXMgaW1hZ2UKPiBAQCAtMTczNiw1OCArMTg2Niw1OCBAQCBzdGF0aWMgaW50
IGdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCj4gICAJICogdGhpcyBtaWdodCBsZWF2ZSBzbWFsbCBpbnRlcnZhbCBvZiB0aW1lIHdo
ZXJlIHRoZSBPQSB1bml0IGlzCj4gICAJICogY29uZmlndXJlZCBhdCBhbiBpbnZhbGlkIHNhbXBs
aW5nIHBlcmlvZC4KPiAgIAkgKgo+IC0JICogU28gZmFyIHRoZSBiZXN0IHdheSB0byB3b3JrIGFy
b3VuZCB0aGlzIGlzc3VlIHNlZW1zIHRvIGJlIGRyYWluaW5nCj4gLQkgKiB0aGUgR1BVIGZyb20g
YW55IHN1Ym1pdHRlZCB3b3JrLgo+ICsJICogTm90ZSB0aGF0IHNpbmNlIHdlIGVtaXQgYWxsIHJl
cXVlc3RzIGZyb20gYSBzaW5nbGUgcmluZywgdGhlcmUKPiArCSAqIGlzIHN0aWxsIGFuIGltcGxp
Y2l0IGdsb2JhbCBiYXJyaWVyIGhlcmUgdGhhdCBtYXkgY2F1c2UgYSBoaWdoCj4gKwkgKiBwcmlv
cml0eSBjb250ZXh0IHRvIHdhaXQgZm9yIGFuIG90aGVyd2lzZSBpbmRlcGVuZGVudCBsb3cgcHJp
b3JpdHkKPiArCSAqIGNvbnRleHQuIENvbnRleHRzIGlkbGUgYXQgdGhlIHRpbWUgb2YgcmVjb25m
aWd1cmF0aW9uIGFyZSBub3QKPiArCSAqIHRyYXBwZWQgYmVoaW5kIHRoZSBiYXJyaWVyLgo+ICAg
CSAqLwo+IC0JcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShkZXZfcHJpdiwKPiAtCQkJCSAg
ICAgSTkxNV9XQUlUX0xPQ0tFRCwKPiAtCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwo+
IC0JaWYgKHJldCkKPiAtCQlyZXR1cm4gcmV0Owo+IC0KPiAtCS8qIFVwZGF0ZSBhbGwgY29udGV4
dHMgbm93IHRoYXQgd2UndmUgc3RhbGxlZCB0aGUgc3VibWlzc2lvbi4gKi8KPiAtCWxpc3RfZm9y
X2VhY2hfZW50cnkoY3R4LCAmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QsIGxpbmspIHsKPiArCWxp
c3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmaTkxNS0+Y29udGV4dHMubGlzdCwgbGluaykgewo+ICAg
CQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0Owo+ICAgCQlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2U7Cj4gICAKPiAgIAkJZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwKPiAgIAkJCQkgICAg
aTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwKPiAgIAkJCQkgICAgaXQpIHsKPiAt
CQkJdTMyICpyZWdzOwo+IC0KPiAgIAkJCWlmIChjZS0+ZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJf
Q0xBU1MpCj4gICAJCQkJY29udGludWU7Cj4gICAKPiAtCQkJLyogT0Egc2V0dGluZ3Mgd2lsbCBi
ZSBzZXQgdXBvbiBmaXJzdCB1c2UgKi8KPiAtCQkJaWYgKCFjZS0+c3RhdGUpCj4gLQkJCQljb250
aW51ZTsKPiAtCj4gLQkJCXJlZ3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChjZS0+c3RhdGUt
Pm9iaiwKPiAtCQkJCQkJICAgICAgIG1hcF90eXBlKTsKPiAtCQkJaWYgKElTX0VSUihyZWdzKSkg
ewo+IC0JCQkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwo+IC0JCQkJcmV0
dXJuIFBUUl9FUlIocmVncyk7Cj4gLQkJCX0KPiArCQkJZXJyID0gaW50ZWxfY29udGV4dF9sb2Nr
X3Bpbm5lZChjZSk7Cj4gKwkJCWlmIChlcnIpCj4gKwkJCQlicmVhazsKPiAgIAo+IC0JCQljZS0+
c3RhdGUtPm9iai0+bW0uZGlydHkgPSB0cnVlOwo+IC0JCQlyZWdzICs9IExSQ19TVEFURV9QTiAq
IFBBR0VfU0laRSAvIHNpemVvZigqcmVncyk7Cj4gKwkJCXJlZ3NbMF0udmFsdWUgPSBpbnRlbF9z
c2V1X21ha2VfcnBjcyhpOTE1LCAmY2UtPnNzZXUpOwo+ICAgCj4gLQkJCWdlbjhfdXBkYXRlX3Jl
Z19zdGF0ZV91bmxvY2tlZChjZSwgcmVncywgb2FfY29uZmlnKTsKPiArCQkJLyogT3RoZXJ3aXNl
IE9BIHNldHRpbmdzIHdpbGwgYmUgc2V0IHVwb24gZmlyc3QgdXNlICovCj4gKwkJCWlmIChpbnRl
bF9jb250ZXh0X2lzX3Bpbm5lZChjZSkpCj4gKwkJCQllcnIgPSBnZW44X21vZGlmeV9jb250ZXh0
KGNlLCByZWdzLCBBUlJBWV9TSVpFKHJlZ3MpKTsKPiAgIAo+IC0JCQlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fbWFwKGNlLT5zdGF0ZS0+b2JqKTsKPiArCQkJaW50ZWxfY29udGV4dF91bmxvY2tfcGlu
bmVkKGNlKTsKPiArCQkJaWYgKGVycikKPiArCQkJCWJyZWFrOwo+ICAgCQl9Cj4gICAJCWk5MTVf
Z2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKPiArCQlpZiAoZXJyKQo+ICsJCQlyZXR1
cm4gZXJyOwo+ICAgCX0KPiAgIAo+ICAgCS8qCj4gLQkgKiBBcHBseSB0aGUgY29uZmlndXJhdGlv
biBieSBkb2luZyBvbmUgY29udGV4dCByZXN0b3JlIG9mIHRoZSBlZGl0ZWQKPiAtCSAqIGNvbnRl
eHQgaW1hZ2UuCj4gKwkgKiBBZnRlciB1cGRhdGluZyBhbGwgb3RoZXIgY29udGV4dHMsIHdlIG5l
ZWQgdG8gbW9kaWZ5IG91cnNlbHZlcy4KPiArCSAqIElmIHdlIGRvbid0IG1vZGlmeSB0aGUga2Vy
bmVsX2NvbnRleHQsIHdlIGRvIG5vdCBnZXQgZXZlbnRzIHdoaWxlCj4gKwkgKiBpZGxlLgo+ICAg
CSAqLwo+IC0JcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGRldl9wcml2LT5lbmdpbmVbUkNTMF0t
Pmtlcm5lbF9jb250ZXh0KTsKPiAtCWlmIChJU19FUlIocnEpKQo+IC0JCXJldHVybiBQVFJfRVJS
KHJxKTsKPiArCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7Cj4gKwkJc3RydWN0
IGludGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKPiAgIAo+IC0JaTkx
NV9yZXF1ZXN0X2FkZChycSk7Cj4gKwkJaWYgKGVuZ2luZS0+Y2xhc3MgIT0gUkVOREVSX0NMQVNT
KQo+ICsJCQljb250aW51ZTsKPiArCj4gKwkJcmVnc1swXS52YWx1ZSA9IGludGVsX3NzZXVfbWFr
ZV9ycGNzKGk5MTUsICZjZS0+c3NldSk7Cj4gKwo+ICsJCWVyciA9IGdlbjhfbW9kaWZ5X3NlbGYo
Y2UsIHJlZ3MsIEFSUkFZX1NJWkUocmVncykpOwo+ICsJCWlmIChlcnIpCj4gKwkJCXJldHVybiBl
cnI7Cj4gKwl9Cj4gICAKPiAgIAlyZXR1cm4gMDsKPiAgIH0KPiAKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 95682F79E5
	for <lists+intel-gfx@lfdr.de>; Mon, 11 Nov 2019 18:27:24 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C47796E961;
	Mon, 11 Nov 2019 17:27:22 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B76FF6E95F
 for <intel-gfx@lists.freedesktop.org>; Mon, 11 Nov 2019 17:27:20 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19163127-1500050 
 for <intel-gfx@lists.freedesktop.org>; Mon, 11 Nov 2019 17:27:18 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 11 Nov 2019 17:27:16 +0000
Message-Id: <20191111172716.23733-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/selftests: Perform some basic cycle
 counting of MI ops
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U29tZSBiYXNpYyBpbmZvcm1hdGlvbiB0aGF0IGlzIHVzZWZ1bCB0byBrbm93LCBzdWNoIGFzIGhv
dyBtYW55IGN5Y2xlcwppcyBhIE1JX05PT1AuCgp2MjogS2VlcCB2b2xhdGlsZSBwYWdlcyBwaW5u
ZWQgYXQgYWxsIHRpbWVzISAoTWF0dGhldykKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogQW5uYSBLYXJhcyA8YW5uYS5rYXJhc0BpbnRl
bC5jb20+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpSZXZp
ZXdlZC1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIC4uLi9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jICB8ICAxNSArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMgIHwgMzQ4ICsrKysrKysrKysr
KysrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYyAgICAgICAgICAgICAgIHwg
ICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaCAgICAgICAgICB8ICAg
NCArCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZl9zZWxmdGVzdHMuaCAgfCAgMTMg
KwogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jICAgIHwgIDQzICsr
KwogNiBmaWxlcyBjaGFuZ2VkLCA0MjYgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJm
X3NlbGZ0ZXN0cy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYwppbmRleCA4YTBmYmE3ZDVkNGYuLmM4YThjMDdl
MDdhYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9vYmplY3RfYmx0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKQEAgLTUyNiw4ICs1MjYsNiBAQCBzdGF0aWMgaW50IGln
dF9jb3B5X2JsdF9jdHgwKHZvaWQgKmFyZykKIGludCBpOTE1X2dlbV9vYmplY3RfYmx0X2xpdmVf
c2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0YXRpYyBjb25z
dCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7Ci0JCVNVQlRFU1QocGVyZl9maWxsX2Js
dCksCi0JCVNVQlRFU1QocGVyZl9jb3B5X2JsdCksCiAJCVNVQlRFU1QoaWd0X2ZpbGxfYmx0KSwK
IAkJU1VCVEVTVChpZ3RfZmlsbF9ibHRfY3R4MCksCiAJCVNVQlRFU1QoaWd0X2NvcHlfYmx0KSwK
QEAgLTU0MiwzICs1NDAsMTYgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9ibHRfbGl2ZV9zZWxmdGVz
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAlyZXR1cm4gaTkxNV9saXZlX3N1
YnRlc3RzKHRlc3RzLCBpOTE1KTsKIH0KKworaW50IGk5MTVfZ2VtX29iamVjdF9ibHRfcGVyZl9z
ZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGNvbnN0
IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChwZXJmX2ZpbGxfYmx0
KSwKKwkJU1VCVEVTVChwZXJmX2NvcHlfYmx0KSwKKwl9OworCisJaWYgKGludGVsX2d0X2lzX3dl
ZGdlZCgmaTkxNS0+Z3QpKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBpOTE1X2xpdmVfc3VidGVz
dHModGVzdHMsIGk5MTUpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9l
bmdpbmVfY3MuYwppbmRleCAzODgwZjA3YzI5YjguLjU5ODFhN2I3MWVjOSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMKQEAgLTQsNyArNCwzNTMgQEAK
ICAqIENvcHlyaWdodCDCqSAyMDE4IEludGVsIENvcnBvcmF0aW9uCiAgKi8KIAotI2luY2x1ZGUg
Ii4uL2k5MTVfc2VsZnRlc3QuaCIKKyNpbmNsdWRlIDxsaW51eC9zb3J0Lmg+CisKKyNpbmNsdWRl
ICJpbnRlbF9ndF9wbS5oIgorI2luY2x1ZGUgImludGVsX3Jwcy5oIgorCisjaW5jbHVkZSAiaTkx
NV9zZWxmdGVzdC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oIgorCisj
ZGVmaW5lIENPVU5UIDUKKworc3RhdGljIGludCBjbXBfdTMyKGNvbnN0IHZvaWQgKkEsIGNvbnN0
IHZvaWQgKkIpCit7CisJY29uc3QgdTMyICphID0gQSwgKmIgPSBCOworCisJcmV0dXJuICphIC0g
KmI7Cit9CisKK3N0YXRpYyB2b2lkIHBlcmZfYmVnaW4oc3RydWN0IGludGVsX2d0ICpndCkKK3sK
KwlpbnRlbF9ndF9wbV9nZXQoZ3QpOworCisJLyogQm9vc3QgZ3B1ZnJlcSB0byBtYXggW3dhaXRi
b29zdF0gYW5kIGtlZXAgaXQgZml4ZWQgKi8KKwlhdG9taWNfaW5jKCZndC0+cnBzLm51bV93YWl0
ZXJzKTsKKwlzY2hlZHVsZV93b3JrKCZndC0+cnBzLndvcmspOworCWZsdXNoX3dvcmsoJmd0LT5y
cHMud29yayk7Cit9CisKK3N0YXRpYyBpbnQgcGVyZl9lbmQoc3RydWN0IGludGVsX2d0ICpndCkK
K3sKKwlhdG9taWNfZGVjKCZndC0+cnBzLm51bV93YWl0ZXJzKTsKKwlpbnRlbF9ndF9wbV9wdXQo
Z3QpOworCisJcmV0dXJuIGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKK30KKworc3RhdGljIGlu
dCB3cml0ZV90aW1lc3RhbXAoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGludCBzbG90KQorewor
CXUzMiBjbWQ7CisJdTMyICpjczsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCk7CisJ
aWYgKElTX0VSUihjcykpCisJCXJldHVybiBQVFJfRVJSKGNzKTsKKworCWNtZCA9IE1JX1NUT1JF
X1JFR0lTVEVSX01FTSB8IE1JX1VTRV9HR1RUOworCWlmIChJTlRFTF9HRU4ocnEtPmk5MTUpID49
IDgpCisJCWNtZCsrOworCSpjcysrID0gY21kOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZz
ZXQoUklOR19USU1FU1RBTVAocnEtPmVuZ2luZS0+bW1pb19iYXNlKSk7CisJKmNzKysgPSBpOTE1
X3JlcXVlc3RfdGltZWxpbmUocnEpLT5od3NwX29mZnNldCArIHNsb3QgKiBzaXplb2YodTMyKTsK
KwkqY3MrKyA9IDA7CisKKwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXJldHVybiAw
OworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfZW1wdHlfYmF0Y2goc3RydWN0
IGludGVsX2NvbnRleHQgKmNlKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7
CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdTMyICpjczsKKwlpbnQgZXJyOworCisJb2JqID0g
aTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChjZS0+ZW5naW5lLT5pOTE1LCBQQUdFX1NJ
WkUpOworCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwljcyA9
IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIo
Y3MpKSB7CisJCWVyciA9IFBUUl9FUlIoY3MpOworCQlnb3RvIGVycl9wdXQ7CisJfQorCisJY3Nb
MF0gPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChv
YmopOworCisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBjZS0+dm0sIE5VTEwpOworCWlm
IChJU19FUlIodm1hKSkgeworCQllcnIgPSBQVFJfRVJSKHZtYSk7CisJCWdvdG8gZXJyX3VucGlu
OworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKKwlpZiAo
ZXJyKQorCQlnb3RvIGVycl91bnBpbjsKKworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2Jq
KTsKKwlyZXR1cm4gdm1hOworCitlcnJfdW5waW46CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21h
cChvYmopOworZXJyX3B1dDoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcmV0dXJuIEVS
Ul9QVFIoZXJyKTsKK30KKworc3RhdGljIHUzMiB0cmlmaWx0ZXIodTMyICphKQoreworCXU2NCBz
dW07CisKKwlzb3J0KGEsIENPVU5ULCBzaXplb2YoKmEpLCBjbXBfdTMyLCBOVUxMKTsKKworCXN1
bSArPSBtdWxfdTMyX3UzMihhWzJdLCAyKTsKKwlzdW0gKz0gYVsxXTsKKwlzdW0gKz0gYVszXTsK
KworCXJldHVybiBzdW0gPj4gMjsKK30KKworc3RhdGljIGludCBwZXJmX21pX2JiX3N0YXJ0KHZv
aWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlpbnQgZXJyID0g
MDsKKworCWlmIChJTlRFTF9HRU4oZ3QtPmk5MTUpIDwgNykgLyogZm9yIHBlci1lbmdpbmUgQ1Nf
VElNRVNUQU1QICovCisJCXJldHVybiAwOworCisJcGVyZl9iZWdpbihndCk7CisJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGVu
Z2luZS0+a2VybmVsX2NvbnRleHQ7CisJCXN0cnVjdCBpOTE1X3ZtYSAqYmF0Y2g7CisJCXUzMiBj
eWNsZXNbQ09VTlRdOworCQlpbnQgaTsKKworCQliYXRjaCA9IGNyZWF0ZV9lbXB0eV9iYXRjaChj
ZSk7CisJCWlmIChJU19FUlIoYmF0Y2gpKSB7CisJCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKKwkJ
CWJyZWFrOworCQl9CisKKwkJZXJyID0gaTkxNV92bWFfc3luYyhiYXRjaCk7CisJCWlmIChlcnIp
IHsKKwkJCWk5MTVfdm1hX3B1dChiYXRjaCk7CisJCQlicmVhazsKKwkJfQorCisJCWZvciAoaSA9
IDA7IGkgPCBBUlJBWV9TSVpFKGN5Y2xlcyk7IGkrKykgeworCQkJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnE7CisKKwkJCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShjZSk7CisJCQlpZiAoSVNfRVJS
KHJxKSkgeworCQkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJCWJyZWFrOworCQkJfQorCisJCQll
cnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDIpOworCQkJaWYgKGVycikKKwkJCQlnb3RvIG91dDsK
KworCQkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9iYl9zdGFydChycSwKKwkJCQkJCQliYXRjaC0+
bm9kZS5zdGFydCwgOCwKKwkJCQkJCQkwKTsKKwkJCWlmIChlcnIpCisJCQkJZ290byBvdXQ7CisK
KwkJCWVyciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMyk7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8g
b3V0OworCitvdXQ6CisJCQlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwkJCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOworCisJCQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKQor
CQkJCWVyciA9IC1FSU87CisJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJCWlmIChlcnIpCisJ
CQkJYnJlYWs7CisKKwkJCWN5Y2xlc1tpXSA9IHJxLT5od3NwX3NlcW5vWzNdIC0gcnEtPmh3c3Bf
c2Vxbm9bMl07CisJCX0KKwkJaTkxNV92bWFfcHV0KGJhdGNoKTsKKwkJaWYgKGVycikKKwkJCWJy
ZWFrOworCisJCXByX2luZm8oIiVzOiBNSV9CQl9TVEFSVCBjeWNsZXM6ICV1XG4iLAorCQkJZW5n
aW5lLT5uYW1lLCB0cmlmaWx0ZXIoY3ljbGVzKSk7CisJfQorCWlmIChwZXJmX2VuZChndCkpCisJ
CWVyciA9IC1FSU87CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfdm1h
ICpjcmVhdGVfbm9wX2JhdGNoKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCXUzMiAq
Y3M7CisJaW50IGVycjsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwo
Y2UtPmVuZ2luZS0+aTkxNSwgU1pfNjRLKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBF
UlJfQ0FTVChvYmopOworCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVf
TUFQX1dCKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQllcnIgPSBQVFJfRVJSKGNzKTsKKwkJZ290
byBlcnJfcHV0OworCX0KKworCW1lbXNldChjcywgMCwgU1pfNjRLKTsKKwljc1tTWl82NEsgLyBz
aXplb2YoKmNzKSAtIDFdID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWk5MTVfZ2VtX29iamVj
dF9mbHVzaF9tYXAob2JqKTsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY2UtPnZt
LCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJZXJyID0gUFRSX0VSUih2bWEpOworCQln
b3RvIGVycl91bnBpbjsKKwl9CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5f
VVNFUik7CisJaWYgKGVycikKKwkJZ290byBlcnJfdW5waW47CisKKwlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fbWFwKG9iaik7CisJcmV0dXJuIHZtYTsKKworZXJyX3VucGluOgorCWk5MTVfZ2VtX29i
amVjdF91bnBpbl9tYXAob2JqKTsKK2Vycl9wdXQ6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmop
OworCXJldHVybiBFUlJfUFRSKGVycik7Cit9CisKK3N0YXRpYyBpbnQgcGVyZl9taV9ub29wKHZv
aWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlpbnQgZXJyID0g
MDsKKworCWlmIChJTlRFTF9HRU4oZ3QtPmk5MTUpIDwgNykgLyogZm9yIHBlci1lbmdpbmUgQ1Nf
VElNRVNUQU1QICovCisJCXJldHVybiAwOworCisJcGVyZl9iZWdpbihndCk7CisJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGVu
Z2luZS0+a2VybmVsX2NvbnRleHQ7CisJCXN0cnVjdCBpOTE1X3ZtYSAqYmFzZSwgKm5vcDsKKwkJ
dTMyIGN5Y2xlc1tDT1VOVF07CisJCWludCBpOworCisJCWJhc2UgPSBjcmVhdGVfZW1wdHlfYmF0
Y2goY2UpOworCQlpZiAoSVNfRVJSKGJhc2UpKSB7CisJCQllcnIgPSBQVFJfRVJSKGJhc2UpOwor
CQkJYnJlYWs7CisJCX0KKworCQllcnIgPSBpOTE1X3ZtYV9zeW5jKGJhc2UpOworCQlpZiAoZXJy
KSB7CisJCQlpOTE1X3ZtYV9wdXQoYmFzZSk7CisJCQlicmVhazsKKwkJfQorCisJCW5vcCA9IGNy
ZWF0ZV9ub3BfYmF0Y2goY2UpOworCQlpZiAoSVNfRVJSKG5vcCkpIHsKKwkJCWVyciA9IFBUUl9F
UlIobm9wKTsKKwkJCWk5MTVfdm1hX3B1dChiYXNlKTsKKwkJCWJyZWFrOworCQl9CisKKwkJZXJy
ID0gaTkxNV92bWFfc3luYyhub3ApOworCQlpZiAoZXJyKSB7CisJCQlpOTE1X3ZtYV9wdXQobm9w
KTsKKwkJCWk5MTVfdm1hX3B1dChiYXNlKTsKKwkJCWJyZWFrOworCQl9CisKKwkJZm9yIChpID0g
MDsgaSA8IEFSUkFZX1NJWkUoY3ljbGVzKTsgaSsrKSB7CisJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKKworCQkJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNlKTsKKwkJCWlmIChJU19FUlIo
cnEpKSB7CisJCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQkJYnJlYWs7CisJCQl9CisKKwkJCWVy
ciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMik7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gb3V0Owor
CisJCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAorCQkJCQkJCWJhc2UtPm5v
ZGUuc3RhcnQsIDgsCisJCQkJCQkJMCk7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gb3V0OworCisJ
CQllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDMpOworCQkJaWYgKGVycikKKwkJCQlnb3RvIG91
dDsKKworCQkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9iYl9zdGFydChycSwKKwkJCQkJCQlub3At
Pm5vZGUuc3RhcnQsCisJCQkJCQkJbm9wLT5ub2RlLnNpemUsCisJCQkJCQkJMCk7CisJCQlpZiAo
ZXJyKQorCQkJCWdvdG8gb3V0OworCisJCQllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDQpOwor
CQkJaWYgKGVycikKKwkJCQlnb3RvIG91dDsKKworb3V0OgorCQkJaTkxNV9yZXF1ZXN0X2dldChy
cSk7CisJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0
KHJxLCAwLCBIWiAvIDUpIDwgMCkKKwkJCQllcnIgPSAtRUlPOworCQkJaTkxNV9yZXF1ZXN0X3B1
dChycSk7CisJCQlpZiAoZXJyKQorCQkJCWJyZWFrOworCisJCQljeWNsZXNbaV0gPQorCQkJCShy
cS0+aHdzcF9zZXFub1s0XSAtIHJxLT5od3NwX3NlcW5vWzNdKSAtCisJCQkJKHJxLT5od3NwX3Nl
cW5vWzNdIC0gcnEtPmh3c3Bfc2Vxbm9bMl0pOworCQl9CisJCWk5MTVfdm1hX3B1dChub3ApOwor
CQlpOTE1X3ZtYV9wdXQoYmFzZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKworCQlwcl9pbmZv
KCIlczogMTZLIE1JX05PT1AgY3ljbGVzOiAldVxuIiwKKwkJCWVuZ2luZS0+bmFtZSwgdHJpZmls
dGVyKGN5Y2xlcykpOworCX0KKwlpZiAocGVyZl9lbmQoZ3QpKQorCQllcnIgPSAtRUlPOworCisJ
cmV0dXJuIGVycjsKK30KKworaW50IGludGVsX2VuZ2luZV9jc19wZXJmX3NlbGZ0ZXN0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVf
c3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKHBlcmZfbWlfYmJfc3RhcnQpLAorCQlTVUJU
RVNUKHBlcmZfbWlfbm9vcCksCisJfTsKKworCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUt
Pmd0KSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0
cywgJmk5MTUtPmd0KTsKK30KIAogc3RhdGljIGludCBpbnRlbF9tbWlvX2Jhc2VzX2NoZWNrKHZv
aWQgKmFyZykKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCmluZGV4IDFiYjcwMWQzMmE1ZC4uZGEz
ZTliNTc1MmFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKQEAgLTEwMDMsNiArMTAwMywxMiBA
QCBzdGF0aWMgaW50IGk5MTVfcGNpX3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBz
dHJ1Y3QgcGNpX2RldmljZV9pZCAqZW50KQogCQlyZXR1cm4gZXJyID4gMCA/IC1FTk9UVFkgOiBl
cnI7CiAJfQogCisJZXJyID0gaTkxNV9wZXJmX3NlbGZ0ZXN0cyhwZGV2KTsKKwlpZiAoZXJyKSB7
CisJCWk5MTVfcGNpX3JlbW92ZShwZGV2KTsKKwkJcmV0dXJuIGVyciA+IDAgPyAtRU5PVFRZIDog
ZXJyOworCX0KKwogCXJldHVybiAwOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3NlbGZ0ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0
LmgKaW5kZXggNGQ4ODIwNWRlNTFiLi45OGJjYjZmYTBhYjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3NlbGZ0ZXN0LmgKQEAgLTM2LDYgKzM2LDcgQEAgc3RydWN0IGk5MTVfc2VsZnRlc3Qgewog
CWNoYXIgKmZpbHRlcjsKIAlpbnQgbW9jazsKIAlpbnQgbGl2ZTsKKwlpbnQgcGVyZjsKIH07CiAK
ICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKQEAgLTQ1LDYgKzQ2LDcg
QEAgZXh0ZXJuIHN0cnVjdCBpOTE1X3NlbGZ0ZXN0IGk5MTVfc2VsZnRlc3Q7CiAKIGludCBpOTE1
X21vY2tfc2VsZnRlc3RzKHZvaWQpOwogaW50IGk5MTVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBj
aV9kZXYgKnBkZXYpOworaW50IGk5MTVfcGVyZl9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBk
ZXYpOwogCiAvKiBXZSBleHRyYWN0IHRoZSBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgZnJvbSBpOTE1
X21vY2tfc2VsZnRlc3RzLmggYW5kCiAgKiBpOTE1X2xpdmVfc2VsZnRlc3RzLmggQWRkIHlvdXIg
dW5pdCB0ZXN0IGRlY2xhcmF0aW9ucyB0aGVyZSEKQEAgLTYxLDYgKzYzLDcgQEAgaW50IGk5MTVf
bGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYpOwogI3VuZGVmIHNlbGZ0ZXN0CiAj
ZGVmaW5lIHNlbGZ0ZXN0KG5hbWUsIGZ1bmMpIGludCBmdW5jKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KTsKICNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIgor
I2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgiCiAjdW5kZWYgc2VsZnRl
c3QKIAogc3RydWN0IGk5MTVfc3VidGVzdCB7CkBAIC0xMDksNiArMTEyLDcgQEAgaW50IF9faTkx
NV9zdWJ0ZXN0cyhjb25zdCBjaGFyICpjYWxsZXIsCiAKIHN0YXRpYyBpbmxpbmUgaW50IGk5MTVf
bW9ja19zZWxmdGVzdHModm9pZCkgeyByZXR1cm4gMDsgfQogc3RhdGljIGlubGluZSBpbnQgaTkx
NV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikgeyByZXR1cm4gMDsgfQorc3Rh
dGljIGlubGluZSBpbnQgaTkxNV9wZXJmX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikg
eyByZXR1cm4gMDsgfQogCiAjZGVmaW5lIEk5MTVfU0VMRlRFU1RfREVDTEFSRSh4KQogI2RlZmlu
ZSBJOTE1X1NFTEZURVNUX09OTFkoeCkgMApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfcGVyZl9zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAwMDAwLi5mNzEyOWEyNDNkYWEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmX3NlbGZ0ZXN0cy5oCkBAIC0wLDAgKzEs
MTMgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wICovCisvKiBMaXN0IGVh
Y2ggdW5pdCB0ZXN0IGFzIHNlbGZ0ZXN0KG5hbWUsIGZ1bmN0aW9uKQorICoKKyAqIFRoZSBuYW1l
IGlzIHVzZWQgYXMgYm90aCBhbiBlbnVtIGFuZCBleHBhbmRlZCBhcyBzdWJ0ZXN0X19uYW1lIHRv
IGNyZWF0ZQorICogYSBtb2R1bGUgcGFyYW1ldGVyLiBJdCBtdXN0IGJlIHVuaXF1ZSBhbmQgbGVn
YWwgZm9yIGEgQyBpZGVudGlmaWVyLgorICoKKyAqIFRoZSBmdW5jdGlvbiBzaG91bGQgYmUgb2Yg
dHlwZSBpbnQgZnVuY3Rpb24odm9pZCkuIEl0IG1heSBiZSBjb25kaXRpb25hbGx5CisgKiBjb21w
aWxlZCB1c2luZyAjaWYgSVNfRU5BQkxFRChEUk1fSTkxNV9TRUxGVEVTVCkuCisgKgorICogVGVz
dHMgYXJlIGV4ZWN1dGVkIGluIG9yZGVyIGJ5IGlndC9pOTE1X3NlbGZ0ZXN0CisgKi8KK3NlbGZ0
ZXN0KGVuZ2luZV9jcywgaW50ZWxfZW5naW5lX2NzX3BlcmZfc2VsZnRlc3RzKQorc2VsZnRlc3Qo
Ymx0LCBpOTE1X2dlbV9vYmplY3RfYmx0X3BlcmZfc2VsZnRlc3RzKQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMKaW5kZXggYTZjY2E0YWQ5NmY2Li5k
M2JmOWVlZmI2ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X3NlbGZ0ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
c2VsZnRlc3QuYwpAQCAtNTcsNiArNTcsMTIgQEAgZW51bSB7CiAjdW5kZWYgc2VsZnRlc3QKIH07
CiAKK2VudW0geworI2RlZmluZSBzZWxmdGVzdChuYW1lLCBmdW5jKSBwZXJmXyMjbmFtZSwKKyNp
bmNsdWRlICJpOTE1X3BlcmZfc2VsZnRlc3RzLmgiCisjdW5kZWYgc2VsZnRlc3QKK307CisKIHN0
cnVjdCBzZWxmdGVzdCB7CiAJYm9vbCBlbmFibGVkOwogCWNvbnN0IGNoYXIgKm5hbWU7CkBAIC03
OCw2ICs4NCwxMiBAQCBzdGF0aWMgc3RydWN0IHNlbGZ0ZXN0IGxpdmVfc2VsZnRlc3RzW10gPSB7
CiB9OwogI3VuZGVmIHNlbGZ0ZXN0CiAKKyNkZWZpbmUgc2VsZnRlc3QobiwgZikgW3BlcmZfIyNu
XSA9IHsgLm5hbWUgPSAjbiwgeyAubGl2ZSA9IGYgfSB9LAorc3RhdGljIHN0cnVjdCBzZWxmdGVz
dCBwZXJmX3NlbGZ0ZXN0c1tdID0geworI2luY2x1ZGUgImk5MTVfcGVyZl9zZWxmdGVzdHMuaCIK
K307CisjdW5kZWYgc2VsZnRlc3QKKwogLyogRW1iZWQgdGhlIGxpbmUgbnVtYmVyIGludG8gdGhl
IHBhcmFtZXRlciBuYW1lIHNvIHRoYXQgd2UgY2FuIG9yZGVyIHRlc3RzICovCiAjZGVmaW5lIHNl
bGZ0ZXN0KG4sIGZ1bmMpIHNlbGZ0ZXN0XzAobiwgZnVuYywgcGFyYW0obikpCiAjZGVmaW5lIHBh
cmFtKG4pIF9fUEFTVEUoaWd0X18sIF9fUEFTVEUoX19MSU5FX18sIF9fbW9ja18jI24pKQpAQCAt
OTMsNiArMTA1LDEzIEBAIG1vZHVsZV9wYXJhbV9uYW1lZChpZCwgbGl2ZV9zZWxmdGVzdHNbbGl2
ZV8jI25dLmVuYWJsZWQsIGJvb2wsIDA0MDApOwogI2luY2x1ZGUgImk5MTVfbGl2ZV9zZWxmdGVz
dHMuaCIKICN1bmRlZiBzZWxmdGVzdF8wCiAjdW5kZWYgcGFyYW0KKworI2RlZmluZSBwYXJhbShu
KSBfX1BBU1RFKGlndF9fLCBfX1BBU1RFKF9fTElORV9fLCBfX3BlcmZfIyNuKSkKKyNkZWZpbmUg
c2VsZnRlc3RfMChuLCBmdW5jLCBpZCkgXAorbW9kdWxlX3BhcmFtX25hbWVkKGlkLCBwZXJmX3Nl
bGZ0ZXN0c1twZXJmXyMjbl0uZW5hYmxlZCwgYm9vbCwgMDQwMCk7CisjaW5jbHVkZSAiaTkxNV9w
ZXJmX3NlbGZ0ZXN0cy5oIgorI3VuZGVmIHNlbGZ0ZXN0XzAKKyN1bmRlZiBwYXJhbQogI3VuZGVm
IHNlbGZ0ZXN0CiAKIHN0YXRpYyB2b2lkIHNldF9kZWZhdWx0X3Rlc3RfYWxsKHN0cnVjdCBzZWxm
dGVzdCAqc3QsIHVuc2lnbmVkIGludCBjb3VudCkKQEAgLTIwMCw2ICsyMTksMjcgQEAgaW50IGk5
MTVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAJcmV0dXJuIDA7CiB9CiAK
K2ludCBpOTE1X3BlcmZfc2VsZnRlc3RzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQoreworCWludCBl
cnI7CisKKwlpZiAoIWk5MTVfc2VsZnRlc3QucGVyZikKKwkJcmV0dXJuIDA7CisKKwllcnIgPSBy
dW5fc2VsZnRlc3RzKHBlcmYsIHBkZXZfdG9faTkxNShwZGV2KSk7CisJaWYgKGVycikgeworCQlp
OTE1X3NlbGZ0ZXN0LnBlcmYgPSBlcnI7CisJCXJldHVybiBlcnI7CisJfQorCisJaWYgKGk5MTVf
c2VsZnRlc3QucGVyZiA8IDApIHsKKwkJaTkxNV9zZWxmdGVzdC5wZXJmID0gLUVOT1RUWTsKKwkJ
cmV0dXJuIDE7CisJfQorCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBib29sIGFwcGx5X3N1YnRl
c3RfZmlsdGVyKGNvbnN0IGNoYXIgKmNhbGxlciwgY29uc3QgY2hhciAqbmFtZSkKIHsKIAljaGFy
ICpmaWx0ZXIsICpzZXAsICp0b2s7CkBAIC0zNjUsMyArNDA1LDYgQEAgTU9EVUxFX1BBUk1fREVT
Qyhtb2NrX3NlbGZ0ZXN0cywgIlJ1biBzZWxmdGVzdHMgYmVmb3JlIGxvYWRpbmcsIHVzaW5nIG1v
Y2sgaGFyZHcKIAogbW9kdWxlX3BhcmFtX25hbWVkX3Vuc2FmZShsaXZlX3NlbGZ0ZXN0cywgaTkx
NV9zZWxmdGVzdC5saXZlLCBpbnQsIDA0MDApOwogTU9EVUxFX1BBUk1fREVTQyhsaXZlX3NlbGZ0
ZXN0cywgIlJ1biBzZWxmdGVzdHMgYWZ0ZXIgZHJpdmVyIGluaXRpYWxpc2F0aW9uIG9uIHRoZSBs
aXZlIHN5c3RlbSAoMDpkaXNhYmxlZCBbZGVmYXVsdF0sIDE6cnVuIHRlc3RzIHRoZW4gY29udGlu
dWUsIC0xOnJ1biB0ZXN0cyB0aGVuIGV4aXQgbW9kdWxlKSIpOworCittb2R1bGVfcGFyYW1fbmFt
ZWRfdW5zYWZlKHBlcmZfc2VsZnRlc3RzLCBpOTE1X3NlbGZ0ZXN0LnBlcmYsIGludCwgMDQwMCk7
CitNT0RVTEVfUEFSTV9ERVNDKHBlcmZfc2VsZnRlc3RzLCAiUnVuIHBlcmZvcm1hbmNlIG9yaWVu
dGF0ZWQgc2VsZnRlc3RzIGFmdGVyIGRyaXZlciBpbml0aWFsaXNhdGlvbiBvbiB0aGUgbGl2ZSBz
eXN0ZW0gKDA6ZGlzYWJsZWQgW2RlZmF1bHRdLCAxOnJ1biB0ZXN0cyB0aGVuIGNvbnRpbnVlLCAt
MTpydW4gdGVzdHMgdGhlbiBleGl0IG1vZHVsZSkiKTsKLS0gCjIuMjQuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

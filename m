Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1B1035E7DB
	for <lists+intel-gfx@lfdr.de>; Wed,  3 Jul 2019 17:31:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 57D526E15A;
	Wed,  3 Jul 2019 15:30:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E9AEE6E15A;
 Wed,  3 Jul 2019 15:30:57 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17117553-1500050 
 for multiple; Wed, 03 Jul 2019 16:30:37 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  3 Jul 2019 16:30:36 +0100
Message-Id: <20190703153036.14549-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] overlay: Drop legacy mmio access
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QmVmb3JlIHRoZSBpOTE1X3BtdSBrZXJuZWwgaW50ZXJmYWNlIHdhcyBhdmFpbGFibGUsIHdlIGhh
ZCB0byByZWx5IG9uCmRvaW5nIHNvbWUgZGVjaWRlZGx5IGRvZGd5IG1taW8gYWNjZXNzIHRvIHJl
Z2lzdGVycy4gSG93ZXZlciwgbm93IHRoYXQKd2UgaGF2ZSBhIHN0YWJsZSBpbnRlcmZhY2Ugdmlh
IHBlcmYgZm9yIGdyYWJiaW5nIGFsbCB0aGUgZGV0YWlscyB3ZQpuZWVkLCB0aGF0IGFuZCBpdHMg
c3VwcG9ydGluZyBpbmZyYXN0cnVjdHVyZSBjYW4gYmUgZGlzY2FyZGVkLgoKU2lnbmVkLW9mZi1i
eTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBBbnRvbmlvIEFy
Z2Vuemlhbm8gPGFudG9uaW8uYXJnZW56aWFub0BpbnRlbC5jb20+CkNjOiBUdnJ0a28gVXJzdWxp
biA8dHZydGtvLnVyc3VsaW5AbGludXguaW50ZWwuY29tPgotLS0KIG92ZXJsYXkvTWFrZWZpbGUu
YW0gfCAgIDIgLQogb3ZlcmxheS9ncHUtdG9wLmMgICB8IDE2NyArLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tCiBvdmVybGF5L2lnZnguYyAgICAgIHwgMjY0IC0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiBvdmVybGF5L2lnZnguaCAgICAgIHwgIDQ0IC0tLS0t
LS0tCiBvdmVybGF5L21lc29uLmJ1aWxkIHwgICAxIC0KIDUgZmlsZXMgY2hhbmdlZCwgMSBpbnNl
cnRpb24oKyksIDQ3NyBkZWxldGlvbnMoLSkKIGRlbGV0ZSBtb2RlIDEwMDY0NCBvdmVybGF5L2ln
ZnguYwogZGVsZXRlIG1vZGUgMTAwNjQ0IG92ZXJsYXkvaWdmeC5oCgpkaWZmIC0tZ2l0IGEvb3Zl
cmxheS9NYWtlZmlsZS5hbSBiL292ZXJsYXkvTWFrZWZpbGUuYW0KaW5kZXggNTE2NDNlNDk4Li5l
ZWVkZGJiYTQgMTAwNjQ0Ci0tLSBhL292ZXJsYXkvTWFrZWZpbGUuYW0KKysrIGIvb3ZlcmxheS9N
YWtlZmlsZS5hbQpAQCAtMzEsOCArMzEsNiBAQCBpbnRlbF9ncHVfb3ZlcmxheV9TT1VSQ0VTID0g
XAogCWdwdS1wZXJmLmMgXAogCWdwdS1mcmVxLmggXAogCWdwdS1mcmVxLmMgXAotCWlnZnguaCBc
Ci0JaWdmeC5jIFwKIAlvdmVybGF5LmggXAogCW92ZXJsYXkuYyBcCiAJcG93ZXIuaCBcCmRpZmYg
LS1naXQgYS9vdmVybGF5L2dwdS10b3AuYyBiL292ZXJsYXkvZ3B1LXRvcC5jCmluZGV4IDYxYjhm
NjJmZC4uNmNlYzJlOTQzIDEwMDY0NAotLS0gYS9vdmVybGF5L2dwdS10b3AuYworKysgYi9vdmVy
bGF5L2dwdS10b3AuYwpAQCAtMzMsNyArMzMsNiBAQAogCiAjaW5jbHVkZSAiaWd0X3BlcmYuaCIK
IAotI2luY2x1ZGUgImlnZnguaCIKICNpbmNsdWRlICJncHUtdG9wLmgiCiAKICNkZWZpbmUgUklO
R19UQUlMICAgICAgMHgwMApAQCAtOTksMTc2ICs5OCwxMiBAQCBzdGF0aWMgaW50IHBlcmZfaW5p
dChzdHJ1Y3QgZ3B1X3RvcCAqZ3QpCiAJcmV0dXJuIDA7CiB9CiAKLXN0cnVjdCBtbWlvX3Jpbmcg
ewotCWludCBpZDsKLQl1aW50MzJfdCBiYXNlOwotCXZvaWQgKm1taW87Ci0JaW50IGlkbGUsIHdh
aXQsIHNlbWE7Ci19OwotCi1zdGF0aWMgdWludDMyX3QgbW1pb19yaW5nX3JlYWQoc3RydWN0IG1t
aW9fcmluZyAqcmluZywgdWludDMyX3QgcmVnKQotewotCXJldHVybiBpZ2Z4X3JlYWQocmluZy0+
bW1pbywgcmluZy0+YmFzZSArIHJlZyk7Ci19Ci0KLXN0YXRpYyBpbnQgaGFzX2V4ZWNsaXN0cyh2
b2lkKQotewotCWludCBkZXRlY3RlZCA9IDA7Ci0JRklMRSAqZmlsZTsKLQotCWZpbGUgPSBmb3Bl
bigiL3N5cy9tb2R1bGUvaTkxNS9wYXJhbWV0ZXJzL2VuYWJsZV9leGVjbGlzdHMiLCAiciIpOwot
CWlmIChmaWxlKSB7Ci0JCWludCB2YWx1ZTsKLQkJaWYgKGZzY2FuZihmaWxlLCAiJWQiLCAmdmFs
dWUpID09IDEpCi0JCQlkZXRlY3RlZCA9IHZhbHVlICE9IDA7Ci0JCWZjbG9zZShmaWxlKTsKLQl9
Ci0KLQlyZXR1cm4gZGV0ZWN0ZWQ7Ci0KLX0KLQotc3RhdGljIHZvaWQgbW1pb19yaW5nX2luaXQo
c3RydWN0IG1taW9fcmluZyAqcmluZywgdm9pZCAqbW1pbykKLXsKLQl1aW50MzJfdCBjdGw7Ci0K
LQlyaW5nLT5tbWlvID0gbW1pbzsKLQotCWN0bCA9IG1taW9fcmluZ19yZWFkKHJpbmcsIFJJTkdf
Q1RMKTsKLQlpZiAoKGN0bCAmIDEpID09IDAgJiYgIWhhc19leGVjbGlzdHMoKSkKLQkJcmluZy0+
aWQgPSAtMTsKLX0KLQotc3RhdGljIHZvaWQgbW1pb19yaW5nX3Jlc2V0KHN0cnVjdCBtbWlvX3Jp
bmcgKnJpbmcpCi17Ci0JcmluZy0+aWRsZSA9IDA7Ci0JcmluZy0+d2FpdCA9IDA7Ci0JcmluZy0+
c2VtYSA9IDA7Ci19Ci0KLXN0YXRpYyB2b2lkIG1taW9fcmluZ19zYW1wbGUoc3RydWN0IG1taW9f
cmluZyAqcmluZykKLXsKLQl1aW50MzJfdCBoZWFkLCB0YWlsLCBjdGw7Ci0KLQlpZiAocmluZy0+
aWQgPT0gLTEpCi0JCXJldHVybjsKLQotCWhlYWQgPSBtbWlvX3JpbmdfcmVhZChyaW5nLCBSSU5H
X0hFQUQpICYgQUREUl9NQVNLOwotCXRhaWwgPSBtbWlvX3JpbmdfcmVhZChyaW5nLCBSSU5HX1RB
SUwpICYgQUREUl9NQVNLOwotCXJpbmctPmlkbGUgKz0gaGVhZCA9PSB0YWlsOwotCi0JY3RsID0g
bW1pb19yaW5nX3JlYWQocmluZywgUklOR19DVEwpOwotCXJpbmctPndhaXQgKz0gISEoY3RsICYg
UklOR19XQUlUKTsKLQlyaW5nLT5zZW1hICs9ICEhKGN0bCAmIFJJTkdfV0FJVF9TRU1BUEhPUkUp
OwotfQotCi1zdGF0aWMgdm9pZCBtbWlvX3JpbmdfZW1pdChzdHJ1Y3QgbW1pb19yaW5nICpyaW5n
LCBpbnQgc2FtcGxlcywgdW5pb24gZ3B1X3RvcF9wYXlsb2FkICpwYXlsb2FkKQotewotCWlmIChy
aW5nLT5pZCA9PSAtMSkKLQkJcmV0dXJuOwotCi0JcGF5bG9hZFtyaW5nLT5pZF0udS5idXN5ID0g
MTAwIC0gMTAwICogcmluZy0+aWRsZSAvIHNhbXBsZXM7Ci0JcGF5bG9hZFtyaW5nLT5pZF0udS53
YWl0ID0gMTAwICogcmluZy0+d2FpdCAvIHNhbXBsZXM7Ci0JcGF5bG9hZFtyaW5nLT5pZF0udS5z
ZW1hID0gMTAwICogcmluZy0+c2VtYSAvIHNhbXBsZXM7Ci19Ci0KLXN0YXRpYyB2b2lkIG1taW9f
aW5pdChzdHJ1Y3QgZ3B1X3RvcCAqZ3QpCi17Ci0Jc3RydWN0IG1taW9fcmluZyByZW5kZXJfcmlu
ZyA9IHsKLQkJLmJhc2UgPSAweDIwMzAsCi0JCS5pZCA9IDAsCi0JfSwgYnNkX3JpbmcgPSB7Ci0J
CS5iYXNlID0gMHg0MDMwLAotCQkuaWQgPSAxLAotCX0sIGJzZDZfcmluZyA9IHsKLQkJLmJhc2Ug
PSAweDEyMDMwLAotCQkuaWQgPSAxLAotCX0sIGJsdF9yaW5nID0gewotCQkuYmFzZSA9IDB4MjIw
MzAsCi0JCS5pZCA9IDIsCi0JfTsKLQljb25zdCBzdHJ1Y3QgaWdmeF9pbmZvICppbmZvOwotCXN0
cnVjdCBwY2lfZGV2aWNlICppZ2Z4OwotCXZvaWQgKm1taW87Ci0JaW50IGZkWzJdLCBpOwotCi0J
aWdmeCA9IGlnZnhfZ2V0KCk7Ci0JaWYgKCFpZ2Z4KQotCQlyZXR1cm47Ci0KLQlpZiAocGlwZShm
ZCkgPCAwKQotCQlyZXR1cm47Ci0KLQlpbmZvID0gaWdmeF9nZXRfaW5mbyhpZ2Z4KTsKLQotCXN3
aXRjaCAoZm9yaygpKSB7Ci0JY2FzZSAtMTogcmV0dXJuOwotCWRlZmF1bHQ6Ci0JCSBmY250bChm
ZFswXSwgRl9TRVRGTCwgZmNudGwoZmRbMF0sIEZfR0VURkwpIHwgT19OT05CTE9DSyk7Ci0JCSBn
dC0+ZmQgPSBmZFswXTsKLQkJIGd0LT50eXBlID0gTU1JTzsKLQkJIGd0LT5yaW5nWzBdLm5hbWUg
PSAicmVuZGVyIjsKLQkJIGd0LT5udW1fcmluZ3MgPSAxOwotCQkgaWYgKGluZm8tPmdlbiA+PSAw
NDApIHsKLQkJCSBndC0+cmluZ1sxXS5uYW1lID0gImJpdHN0cmVhbSI7Ci0JCQkgZ3QtPm51bV9y
aW5ncysrOwotCQkgfQotCQkgaWYgKGluZm8tPmdlbiA+PSAwNjApIHsKLQkJCSBndC0+cmluZ1sy
XS5uYW1lID0gImJsdCI7Ci0JCQkgZ3QtPm51bV9yaW5ncysrOwotCQkgfQotCQkgY2xvc2UoZmRb
MV0pOwotCQkgcmV0dXJuOwotCWNhc2UgMDoKLQkJIGNsb3NlKGZkWzBdKTsKLQkJIGJyZWFrOwot
CX0KLQotCW1taW8gPSBpZ2Z4X2dldF9tbWlvKGlnZngpOwotCWlmIChtbWlvID09IE5VTEwpCi0J
CWV4aXQoMTI3KTsKLQotCW1taW9fcmluZ19pbml0KCZyZW5kZXJfcmluZywgbW1pbyk7Ci0JaWYg
KGluZm8tPmdlbiA+PSAwNjApIHsKLQkJYnNkX3JpbmcgPSBic2Q2X3Jpbmc7Ci0JCW1taW9fcmlu
Z19pbml0KCZibHRfcmluZywgbW1pbyk7Ci0JfQotCWlmIChpbmZvLT5nZW4gPj0gMDQwKSB7Ci0J
CW1taW9fcmluZ19pbml0KCZic2RfcmluZywgbW1pbyk7Ci0JfQotCi0JZm9yICg7OykgewotCQl1
bmlvbiBncHVfdG9wX3BheWxvYWQgcGF5bG9hZFtNQVhfUklOR1NdOwotCi0JCW1taW9fcmluZ19y
ZXNldCgmcmVuZGVyX3JpbmcpOwotCQltbWlvX3JpbmdfcmVzZXQoJmJzZF9yaW5nKTsKLQkJbW1p
b19yaW5nX3Jlc2V0KCZibHRfcmluZyk7Ci0KLQkJZm9yIChpID0gMDsgaSA8IDEwMDA7IGkrKykg
ewotCQkJbW1pb19yaW5nX3NhbXBsZSgmcmVuZGVyX3JpbmcpOwotCQkJbW1pb19yaW5nX3NhbXBs
ZSgmYnNkX3JpbmcpOwotCQkJbW1pb19yaW5nX3NhbXBsZSgmYmx0X3JpbmcpOwotCQkJdXNsZWVw
KDEwMDApOwotCQl9Ci0KLQkJbWVtc2V0KHBheWxvYWQsIDAsIHNpemVvZihwYXlsb2FkKSk7Ci0J
CW1taW9fcmluZ19lbWl0KCZyZW5kZXJfcmluZywgMTAwMCwgcGF5bG9hZCk7Ci0JCW1taW9fcmlu
Z19lbWl0KCZic2RfcmluZywgMTAwMCwgcGF5bG9hZCk7Ci0JCW1taW9fcmluZ19lbWl0KCZibHRf
cmluZywgMTAwMCwgcGF5bG9hZCk7Ci0JCWFzc2VydCh3cml0ZShmZFsxXSwgcGF5bG9hZCwgc2l6
ZW9mKHBheWxvYWQpKQotCQkgICAgICAgPT0gc2l6ZW9mKHBheWxvYWQpKTsKLQl9Ci19Ci0KIHZv
aWQgZ3B1X3RvcF9pbml0KHN0cnVjdCBncHVfdG9wICpndCkKIHsKIAltZW1zZXQoZ3QsIDAsIHNp
emVvZigqZ3QpKTsKIAlndC0+ZmQgPSAtMTsKIAotCWlmIChwZXJmX2luaXQoZ3QpID09IDApCi0J
CXJldHVybjsKLQotCW1taW9faW5pdChndCk7CisJcGVyZl9pbml0KGd0KTsKIH0KIAogaW50IGdw
dV90b3BfdXBkYXRlKHN0cnVjdCBncHVfdG9wICpndCkKZGlmZiAtLWdpdCBhL292ZXJsYXkvaWdm
eC5jIGIvb3ZlcmxheS9pZ2Z4LmMKZGVsZXRlZCBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDZkODJi
YzhkMy4uMDAwMDAwMDAwCi0tLSBhL292ZXJsYXkvaWdmeC5jCisrKyAvZGV2L251bGwKQEAgLTEs
MjY0ICswLDAgQEAKLS8qCi0gKiBDb3B5cmlnaHQgwqkgMjAxMyBJbnRlbCBDb3Jwb3JhdGlvbgot
ICoKLSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBh
bnkgcGVyc29uIG9idGFpbmluZyBhCi0gKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29j
aWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAotICogdG8gZGVhbCBp
biB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGlt
aXRhdGlvbgotICogdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxp
c2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsCi0gKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhl
IFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKLSAqIFNvZnR3YXJl
IGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlv
bnM6Ci0gKgotICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lv
biBub3RpY2UgKGluY2x1ZGluZyB0aGUgbmV4dAotICogcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNs
dWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZQotICogU29m
dHdhcmUuCi0gKgotICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQg
V0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKLSAqIElNUExJRUQsIElOQ0xVRElORyBC
VVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAotICog
RklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElO
IE5PIEVWRU5UIFNIQUxMCi0gKiBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBM
SUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgotICogTElBQklMSVRZLCBXSEVU
SEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcK
LSAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRI
RSBVU0UgT1IgT1RIRVIgREVBTElOR1MKLSAqIElOIFRIRSBTT0ZUV0FSRS4KLSAqCi0gKi8KLQot
I2luY2x1ZGUgPHBjaWFjY2Vzcy5oPgotI2luY2x1ZGUgPHN5cy9zdGF0Lmg+Ci0jaW5jbHVkZSA8
dW5pc3RkLmg+Ci0jaW5jbHVkZSA8ZmNudGwuaD4KLSNpbmNsdWRlIDxzdGRpby5oPgotCi0jaW5j
bHVkZSAiaWdmeC5oIgotI2luY2x1ZGUgIi4uL2xpYi9pOTE1X3BjaWlkcy5oIgotCi1zdGF0aWMg
Y29uc3Qgc3RydWN0IGlnZnhfaW5mbyBnZW5lcmljX2luZm8gPSB7Ci0JLmdlbiA9IC0xLAotfTsK
LQotI2lmIDAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaWdmeF9pbmZvIGk4MXhfaW5mbyA9IHsKLQku
Z2VuID0gMDEwLAotfTsKLSNlbmRpZgotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGlnZnhfaW5mbyBp
ODMwX2luZm8gPSB7Ci0JLmdlbiA9IDAyMCwKLX07Ci1zdGF0aWMgY29uc3Qgc3RydWN0IGlnZnhf
aW5mbyBpODQ1X2luZm8gPSB7Ci0JLmdlbiA9IDAyMCwKLX07Ci1zdGF0aWMgY29uc3Qgc3RydWN0
IGlnZnhfaW5mbyBpODU1X2luZm8gPSB7Ci0JLmdlbiA9IDAyMSwKLX07Ci1zdGF0aWMgY29uc3Qg
c3RydWN0IGlnZnhfaW5mbyBpODY1X2luZm8gPSB7Ci0JLmdlbiA9IDAyMiwKLX07Ci0KLXN0YXRp
YyBjb25zdCBzdHJ1Y3QgaWdmeF9pbmZvIGk5MTVfaW5mbyA9IHsKLQkuZ2VuID0gMDMwLAotfTsK
LXN0YXRpYyBjb25zdCBzdHJ1Y3QgaWdmeF9pbmZvIGk5NDVfaW5mbyA9IHsKLQkuZ2VuID0gMDMx
LAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBpZ2Z4X2luZm8gZzMzX2luZm8gPSB7Ci0JLmdl
biA9IDAzMywKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaWdmeF9pbmZvIGk5NjVfaW5mbyA9
IHsKLQkuZ2VuID0gMDQwLAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBpZ2Z4X2luZm8gZzR4
X2luZm8gPSB7Ci0JLmdlbiA9IDA0NSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaWdmeF9p
bmZvIGlyb25sYWtlX2luZm8gPSB7Ci0JLmdlbiA9IDA1MCwKLX07Ci0KLXN0YXRpYyBjb25zdCBz
dHJ1Y3QgaWdmeF9pbmZvIHNhbmR5YnJpZGdlX2luZm8gPSB7Ci0JLmdlbiA9IDA2MCwKLX07Ci0K
LXN0YXRpYyBjb25zdCBzdHJ1Y3QgaWdmeF9pbmZvIGl2eWJyaWRnZV9pbmZvID0gewotCS5nZW4g
PSAwNzAsCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGlnZnhfaW5mbyB2YWxsZXl2aWV3X2lu
Zm8gPSB7Ci0JLmdlbiA9IDA3MSwKLX07Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgaWdmeF9pbmZv
IGhhc3dlbGxfaW5mbyA9IHsKLQkuZ2VuID0gMDc1LAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVj
dCBpZ2Z4X2luZm8gYnJvYWR3ZWxsX2luZm8gPSB7Ci0JLmdlbiA9IDAxMDAsCi19OwotCi1zdGF0
aWMgY29uc3Qgc3RydWN0IGlnZnhfaW5mbyBjaGVycnl2aWV3X2luZm8gPSB7Ci0JLmdlbiA9IDAx
MDEsCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGlnZnhfaW5mbyBza3lsYWtlX2luZm8gPSB7
Ci0JLmdlbiA9IDAxMTAsCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGlnZnhfaW5mbyBicm94
dG9uX2luZm8gPSB7Ci0JLmdlbiA9IDAxMTEsCi19OwotCi1zdGF0aWMgY29uc3Qgc3RydWN0IHBj
aV9pZF9tYXRjaCBtYXRjaFtdID0gewotI2lmIDAKLQlJTlRFTF9WR0FfREVWSUNFKFBDSV9DSElQ
X0k4MTAsICZpODF4X2luZm8pLAotCUlOVEVMX1ZHQV9ERVZJQ0UoUENJX0NISVBfSTgxMF9EQzEw
MCwgJmk4MXhfaW5mbyksCi0JSU5URUxfVkdBX0RFVklDRShQQ0lfQ0hJUF9JODEwX0UsICZpODF4
X2luZm8pLAotCUlOVEVMX1ZHQV9ERVZJQ0UoUENJX0NISVBfSTgxNSwgJmk4MXhfaW5mbyksCi0j
ZW5kaWYKLQotCUlOVEVMX0k4MzBfSURTKCZpODMwX2luZm8pLAotCUlOVEVMX0k4NDVHX0lEUygm
aTg0NV9pbmZvKSwKLQlJTlRFTF9JODVYX0lEUygmaTg1NV9pbmZvKSwKLQlJTlRFTF9JODY1R19J
RFMoJmk4NjVfaW5mbyksCi0KLQlJTlRFTF9JOTE1R19JRFMoJmk5MTVfaW5mbyksCi0JSU5URUxf
STkxNUdNX0lEUygmaTkxNV9pbmZvKSwKLQlJTlRFTF9JOTQ1R19JRFMoJmk5NDVfaW5mbyksCi0J
SU5URUxfSTk0NUdNX0lEUygmaTk0NV9pbmZvKSwKLQotCUlOVEVMX0czM19JRFMoJmczM19pbmZv
KSwKLQlJTlRFTF9QSU5FVklFV19JRFMoJmczM19pbmZvKSwKLQotCUlOVEVMX0k5NjVHX0lEUygm
aTk2NV9pbmZvKSwKLQlJTlRFTF9JOTY1R01fSURTKCZpOTY1X2luZm8pLAotCi0JSU5URUxfRzQ1
X0lEUygmZzR4X2luZm8pLAotCUlOVEVMX0dNNDVfSURTKCZnNHhfaW5mbyksCi0KLQlJTlRFTF9J
Uk9OTEFLRV9EX0lEUygmaXJvbmxha2VfaW5mbyksCi0JSU5URUxfSVJPTkxBS0VfTV9JRFMoJmly
b25sYWtlX2luZm8pLAotCi0JSU5URUxfU05CX0RfSURTKCZzYW5keWJyaWRnZV9pbmZvKSwKLQlJ
TlRFTF9TTkJfTV9JRFMoJnNhbmR5YnJpZGdlX2luZm8pLAotCi0JSU5URUxfSVZCX0RfSURTKCZp
dnlicmlkZ2VfaW5mbyksCi0JSU5URUxfSVZCX01fSURTKCZpdnlicmlkZ2VfaW5mbyksCi0KLQlJ
TlRFTF9IU1dfSURTKCZoYXN3ZWxsX2luZm8pLAotCi0JSU5URUxfVkxWX0lEUygmdmFsbGV5dmll
d19pbmZvKSwKLQotCUlOVEVMX0JEV19JRFMoJmJyb2Fkd2VsbF9pbmZvKSwKLQotCUlOVEVMX0NI
Vl9JRFMoJmNoZXJyeXZpZXdfaW5mbyksCi0KLQlJTlRFTF9TS0xfSURTKCZza3lsYWtlX2luZm8p
LAotCUlOVEVMX0JYVF9JRFMoJmJyb3h0b25faW5mbyksCi0KLQlJTlRFTF9WR0FfREVWSUNFKFBD
SV9NQVRDSF9BTlksICZnZW5lcmljX2luZm8pLAotCi0JeyAwLCAwLCAwIH0sCi19OwotCi1zdHJ1
Y3QgcGNpX2RldmljZSAqaWdmeF9nZXQodm9pZCkKLXsKLQlzdHJ1Y3QgcGNpX2RldmljZSAqZGV2
OwotCi0JaWYgKHBjaV9zeXN0ZW1faW5pdCgpKQotCQlyZXR1cm4gMDsKLQotCWRldiA9IHBjaV9k
ZXZpY2VfZmluZF9ieV9zbG90KDAsIDAsIDIsIDApOwotCWlmIChkZXYgPT0gTlVMTCB8fCBkZXYt
PnZlbmRvcl9pZCAhPSAweDgwODYpIHsKLQkJc3RydWN0IHBjaV9kZXZpY2VfaXRlcmF0b3IgKml0
ZXI7Ci0KLQkJaXRlciA9IHBjaV9pZF9tYXRjaF9pdGVyYXRvcl9jcmVhdGUobWF0Y2gpOwotCQlp
ZiAoIWl0ZXIpCi0JCQlyZXR1cm4gMDsKLQotCQlkZXYgPSBwY2lfZGV2aWNlX25leHQoaXRlcik7
Ci0JCXBjaV9pdGVyYXRvcl9kZXN0cm95KGl0ZXIpOwotCX0KLQotCXJldHVybiBkZXY7Ci19Ci0K
LWNvbnN0IHN0cnVjdCBpZ2Z4X2luZm8gKmlnZnhfZ2V0X2luZm8oc3RydWN0IHBjaV9kZXZpY2Ug
KmRldikKLXsKLQlpbnQgaTsKLQotCWlmICghZGV2KQotCQlyZXR1cm4gMDsKLQotCWZvciAoaSA9
IDA7IG1hdGNoW2ldLmRldmljZV9pZCAhPSBQQ0lfTUFUQ0hfQU5ZOyBpKyspCi0JCWlmIChkZXYt
PmRldmljZV9pZCA9PSBtYXRjaFtpXS5kZXZpY2VfaWQpCi0JCQlyZXR1cm4gKGNvbnN0IHN0cnVj
dCBpZ2Z4X2luZm8gKiltYXRjaFtpXS5tYXRjaF9kYXRhOwotCi0JcmV0dXJuICZnZW5lcmljX2lu
Zm87Ci19Ci0KLXN0YXRpYyBpbnQgZm9yY2V3YWtlID0gLTE7Ci0KLXN0YXRpYyB2b2lkCi1pZ2Z4
X2ZvcmNld2FrZSh2b2lkKQotewotCWNoYXIgYnVmWzEwMjRdOwotCWNvbnN0IGNoYXIgKnBhdGhb
XSA9IHsKLQkJIi9zeXMva2VybmVsL2RlYnVnL2RyaS8iLAotCQkiL2RlYnVnL2RyaS8iLAotCQkw
LAotCX07Ci0JaW50IGksIGo7Ci0KLQlmb3IgKGogPSAwOyBwYXRoW2pdOyBqKyspIHsKLQkJc3Ry
dWN0IHN0YXQgc3Q7Ci0KLQkJaWYgKHN0YXQocGF0aFtqXSwgJnN0KSkKLQkJCWNvbnRpbnVlOwot
Ci0JCWZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7Ci0JCQlzbnByaW50ZihidWYsIHNpemVvZihi
dWYpLAotCQkJCSAiJXMvJWkvaTkxNV9mb3JjZXdha2VfdXNlciIsCi0JCQkJIHBhdGhbal0sIGkp
OwotCQkJZm9yY2V3YWtlID0gb3BlbihidWYsIDApOwotCQkJaWYgKGZvcmNld2FrZSAhPSAtMSkK
LQkJCQlyZXR1cm47Ci0JCX0KLQl9Ci19Ci0KLXZvaWQgKmlnZnhfZ2V0X21taW8oc3RydWN0IHBj
aV9kZXZpY2UgKmRldikKLXsKLQljb25zdCBzdHJ1Y3QgaWdmeF9pbmZvICppbmZvOwotCWludCBt
bWlvX2JhciwgbW1pb19zaXplOwotCXZvaWQgKm1taW87Ci0KLQlpbmZvID0gaWdmeF9nZXRfaW5m
byhkZXYpOwotCWlmIChpbmZvLT5nZW4gPj4gMyA9PSAyKQotCQltbWlvX2JhciA9IDE7Ci0JZWxz
ZQotCQltbWlvX2JhciA9IDA7Ci0KLQlpZiAoaW5mby0+Z2VuIDwgMDMwKQotCQltbWlvX3NpemUg
PSA1MTIqMTAyNDsKLQllbHNlIGlmIChpbmZvLT5nZW4gPCAwNTApCi0JCW1taW9fc2l6ZSA9IDUx
MioxMDI0OwotCWVsc2UKLQkJbW1pb19zaXplID0gMioxMDI0KjEwMjQ7Ci0KLQlpZiAocGNpX2Rl
dmljZV9wcm9iZShkZXYpKQotCQlyZXR1cm4gMDsKLQotCWlmIChwY2lfZGV2aWNlX21hcF9yYW5n
ZShkZXYsCi0JCQkJIGRldi0+cmVnaW9uc1ttbWlvX2Jhcl0uYmFzZV9hZGRyLAotCQkJCSBtbWlv
X3NpemUsCi0JCQkJIFBDSV9ERVZfTUFQX0ZMQUdfV1JJVEFCTEUsCi0JCQkJICZtbWlvKSkKLQkJ
cmV0dXJuIDA7Ci0KLQlpZiAoaW5mby0+Z2VuID49IDA2MCkKLQkJaWdmeF9mb3JjZXdha2UoKTsK
LQotCXJldHVybiBtbWlvOwotfQotCmRpZmYgLS1naXQgYS9vdmVybGF5L2lnZnguaCBiL292ZXJs
YXkvaWdmeC5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBjOTlhZjE4NmMuLjAwMDAw
MDAwMAotLS0gYS9vdmVybGF5L2lnZnguaAorKysgL2Rldi9udWxsCkBAIC0xLDQ0ICswLDAgQEAK
LS8qCi0gKiBDb3B5cmlnaHQgwqkgMjAxMyBJbnRlbCBDb3Jwb3JhdGlvbgotICoKLSAqIFBlcm1p
c3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9i
dGFpbmluZyBhCi0gKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1l
bnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAotICogdG8gZGVhbCBpbiB0aGUgU29mdHdh
cmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgotICog
dGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1
dGUsIHN1YmxpY2Vuc2UsCi0gKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBh
bmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKLSAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hl
ZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci0gKgotICog
VGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGlu
Y2x1ZGluZyB0aGUgbmV4dAotICogcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwg
Y29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZQotICogU29mdHdhcmUuCi0gKgot
ICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0Yg
QU5ZIEtJTkQsIEVYUFJFU1MgT1IKLSAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlU
RUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAotICogRklUTkVTUyBGT1Ig
QSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNI
QUxMCi0gKiBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFO
WSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgotICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFD
VElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKLSAqIEZST00sIE9V
VCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RI
RVIgREVBTElOR1MKLSAqIElOIFRIRSBTT0ZUV0FSRS4KLSAqCi0gKi8KLQotI2lmbmRlZiBJR0ZY
X0gKLSNkZWZpbmUgSUdGWF9ICi0KLXN0cnVjdCBpZ2Z4X2luZm8gewotCWludCBnZW47Ci19Owot
Ci1zdHJ1Y3QgcGNpX2RldmljZTsKLQotc3RydWN0IHBjaV9kZXZpY2UgKmlnZnhfZ2V0KHZvaWQp
OwotY29uc3Qgc3RydWN0IGlnZnhfaW5mbyAqaWdmeF9nZXRfaW5mbyhzdHJ1Y3QgcGNpX2Rldmlj
ZSAqcGNpX2Rldik7Ci12b2lkICppZ2Z4X2dldF9tbWlvKHN0cnVjdCBwY2lfZGV2aWNlICpwY2lf
ZGV2KTsKLQotc3RhdGljIGlubGluZSB1aW50MzJfdAotaWdmeF9yZWFkKHZvaWQgKm1taW8sIHVp
bnQzMl90IHJlZykKLXsKLQlyZXR1cm4gKih2b2xhdGlsZSB1aW50MzJfdCAqKSgodm9sYXRpbGUg
Y2hhciAqKW1taW8gKyByZWcpOwotfQotCi0jZW5kaWYgLyogSUdGWF9IICovCmRpZmYgLS1naXQg
YS9vdmVybGF5L21lc29uLmJ1aWxkIGIvb3ZlcmxheS9tZXNvbi5idWlsZAppbmRleCBkMTMzYjZi
ZWQuLmQyZDJiMTZhOCAxMDA2NDQKLS0tIGEvb3ZlcmxheS9tZXNvbi5idWlsZAorKysgYi9vdmVy
bGF5L21lc29uLmJ1aWxkCkBAIC0xMSw3ICsxMSw2IEBAIGdwdV9vdmVybGF5X3NyYyA9IFsKIAkn
Z3B1LXRvcC5jJywKIAknZ3B1LXBlcmYuYycsCiAJJ2dwdS1mcmVxLmMnLAotCSdpZ2Z4LmMnLAog
CSdvdmVybGF5LmMnLAogCSdwb3dlci5jJywKIAkncmM2LmMnLAotLSAKMi4yMC4xCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

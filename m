Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AE5E0124CDC
	for <lists+intel-gfx@lfdr.de>; Wed, 18 Dec 2019 17:12:05 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 00A2C6E88A;
	Wed, 18 Dec 2019 16:12:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 45E766E8EE
 for <intel-gfx@lists.freedesktop.org>; Wed, 18 Dec 2019 16:11:51 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Dec 2019 08:11:51 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,330,1571727600"; d="scan'208";a="218189736"
Received: from ideak-desk.fi.intel.com ([10.237.72.183])
 by orsmga003.jf.intel.com with ESMTP; 18 Dec 2019 08:11:49 -0800
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 18 Dec 2019 18:11:03 +0200
Message-Id: <20191218161105.30638-14-imre.deak@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20191218161105.30638-1-imre.deak@intel.com>
References: <20191218161105.30638-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 13/15] drm/i915/tgl: Gen-12 display can
 decompress surfaces compressed by the media engine
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>,
 Nanley G Chery <nanley.g.chery@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpEZXRlY3QgdGhlIG1vZGlmaWVyIGNvcnJlc3BvbmRpbmcgdG8gbWVkaWEgY29tcHJlc3Npb24g
dG8gZW5hYmxlCmRpc3BsYXkgZGVjb21wcmVzc2lvbiBmb3IgWVVWIGFuZCB4UkdCIHBhY2tlZCBm
b3JtYXRzLiBBIG5ldyBtb2RpZmllciBpcwphZGRlZCBzbyB0aGF0IHRoZSBkcml2ZXIgY2FuIGRp
c3Rpbmd1aXNoIGJldHdlZW4gbWVkaWEgYW5kIHJlbmRlcgpjb21wcmVzc2VkIGJ1ZmZlcnMuIFVu
bGlrZSByZW5kZXIgZGVjb21wcmVzc2lvbiwgcGxhbmUgNiBhbmQgIHBsYW5lIDcgZG8gbm90CnN1
cHBvcnQgbWVkaWEgZGVjb21wcmVzc2lvbi4KCnYyOiBGaXggY2hlY2twYXRjaCB3YXJuaW5ncyBv
biBjb2RlIHN0eWxlIChMdWNhcykKCkZyb20gREs6ClNlcGFyYXRlIG1vZGlmaWVyIGFycmF5IGZv
ciBwbGFuZXMgdGhhdCBjYW5ub3QgZGVjb21wcmVzcyBtZWRpYSAoVmlsbGUpCgp2MzogU3VwcG9y
dCBwbGFuYXIgZm9ybWF0cwp2NDogU3dpdGNoIHBsYW5lIG9yZGVyCnY1OgotIFVzZSBmb3JtYXQg
YmxvY2sgZGVzY3JpcHRvcnMgdG8gZ2V0IENDUyBzdWJzYW1wbGluZyBjYWxjdWxhdGlvbiByaWdo
dAogIGV2ZXJ5d2hlcmUuCi0gRXh0ZW5kIHRoZSBwbGFuZSBzdGF0ZSBub3JtYWwgdmlldyBhcnJh
eSB0byBhY2NvbW1vZGF0ZSA0IGNvbG9yIHBsYW5lcy4KLSBVc2UgaGVscGVycyB0byBjb252ZXJ0
IGJldHdlZW4gbWFpbiBhbmQgQ0NTIHBsYW5lcy4KCkNjOiBOYW5sZXkgRyBDaGVyeSA8bmFubGV5
LmcuY2hlcnlAaW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxp
bnV4LmludGVsLmNvbT4KQ2M6IE1hdHQgUm9wZXIgPG1hdHRoZXcuZC5yb3BlckBpbnRlbC5jb20+
ClNpZ25lZC1vZmYtYnk6IERoaW5ha2FyYW4gUGFuZGl5YW4gPGRoaW5ha2FyYW4ucGFuZGl5YW5A
aW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBMdWNhcyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFyY2hp
QGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogSW1yZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8IDE4
MCArKysrKysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5oICB8ICAgMSArCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5
cGVzLmggICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmMgICB8ICA1NSArKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAg
ICAgICAgICAgICB8ICAgMSArCiA1IGZpbGVzIGNoYW5nZWQsIDE4OCBpbnNlcnRpb25zKCspLCA1
NSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCmluZGV4IDhiMzZjMzNiYjYzZS4uMWMyYmVjZjQ3YmZkIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTk0Myw3ICsxOTQzLDkgQEAg
c3RhdGljIGJvb2wgaXNfY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LCBpbnQgcGxhbmUpCiAKIHN0YXRpYyBib29sIGlzX2dlbjEyX2Njc19tb2RpZmllcih1NjQgbW9k
aWZpZXIpCiB7Ci0JcmV0dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dF
TjEyX1JDX0NDUzsKKwlyZXR1cm4gbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURf
R0VOMTJfUkNfQ0NTIHx8CisJICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX01DX0NDUzsKKwogfQogCiBzdGF0aWMgYm9vbCBpc19nZW4xMl9jY3NfcGxhbmUo
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFuZSkKQEAgLTE5NzYsOCAr
MTk3OCw3IEBAIHN0YXRpYyBpbnQgY2NzX3RvX21haW5fcGxhbmUoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUpCiB9CiAKIC8qIFJldHVybiBlaXRoZXIgdGhl
IG1haW4gcGxhbmUncyBDQ1Mgb3IgLSBpZiBub3QgYSBDQ1MgRkIgLSBVViBwbGFuZSAqLwotc3Rh
dGljIGludAotaW50ZWxfbWFpbl90b19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsIGludCBtYWluX3BsYW5lKQoraW50IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkKIHsKIAlpZiAo
aXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCiAJCXJldHVybiBtYWluX3RvX2Njc19wbGFu
ZShmYiwgbWFpbl9wbGFuZSk7CkBAIC0yMDEyLDYgKzIwMTMsNyBAQCBpbnRlbF90aWxlX3dpZHRo
X2J5dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUp
CiAJCQlyZXR1cm4gMTI4OwogCQkvKiBmYWxsIHRocm91Z2ggKi8KIAljYXNlIEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
X0dFTjEyX01DX0NDUzoKIAkJaWYgKGlzX2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpKQogCQkJ
cmV0dXJuIDY0OwogCQkvKiBmYWxsIHRocm91Z2ggKi8KQEAgLTIxNTIsNiArMjE1NCw3IEBAIHN0
YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsCiAJCQlyZXR1cm4gMjU2ICogMTAyNDsKIAkJcmV0dXJuIDA7CiAJY2Fz
ZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJY2FzZSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6CiAJCXJldHVybiAxNiAqIDEwMjQ7CiAJY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElM
RURfQ0NTOgpAQCAtMjUzNiw2ICsyNTM5LDcgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9m
Yl9tb2RpZmllcl90b190aWxpbmcodTY0IGZiX21vZGlmaWVyKQogCWNhc2UgSTkxNV9GT1JNQVRf
TU9EX1lfVElMRUQ6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6CiAJCXJldHVybiBJOTE1X1RJTElOR19ZOwogCWRlZmF1
bHQ6CiAJCXJldHVybiBJOTE1X1RJTElOR19OT05FOwpAQCAtMjU4Nyw2ICsyNTkxLDIxIEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvIGdlbjEyX2Njc19mb3JtYXRzW10gPSB7
CiAJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9BQkdSODg4OCwgLmRlcHRoID0gMzIsIC5udW1fcGxh
bmVzID0gMiwKIAkgIC5jaGFyX3Blcl9ibG9jayA9IHsgNCwgMSB9LCAuYmxvY2tfdyA9IHsgMSwg
MiB9LCAuYmxvY2tfaCA9IHsgMSwgMSB9LAogCSAgLmhzdWIgPSAxLCAudnN1YiA9IDEsIC5oYXNf
YWxwaGEgPSB0cnVlIH0sCisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9ZVVlWLCAubnVtX3BsYW5l
cyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDIsIDEgfSwgLmJsb2NrX3cgPSB7IDEsIDIg
fSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5oc3ViID0gMiwgLnZzdWIgPSAxLCAuaXNfeXV2
ID0gdHJ1ZSB9LAorCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfTlYxMiwgLm51bV9wbGFuZXMgPSA0
LAorCSAgLmNoYXJfcGVyX2Jsb2NrID0geyAxLCAyLCAxLCAxIH0sIC5ibG9ja193ID0geyAxLCAx
LCA0LCA0IH0sIC5ibG9ja19oID0geyAxLCAxLCAxLCAxIH0sCisJICAuaHN1YiA9IDIsIC52c3Vi
ID0gMiwgLmlzX3l1diA9IHRydWUgfSwKKwl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX1AwMTAsIC5u
dW1fcGxhbmVzID0gNCwKKwkgIC5jaGFyX3Blcl9ibG9jayA9IHsgMiwgNCwgMSwgMSB9LCAuYmxv
Y2tfdyA9IHsgMSwgMSwgMiwgMiB9LCAuYmxvY2tfaCA9IHsgMSwgMSwgMSwgMSB9LAorCSAgLmhz
dWIgPSAyLCAudnN1YiA9IDIsIC5pc195dXYgPSB0cnVlIH0sCisJeyAuZm9ybWF0ID0gRFJNX0ZP
Uk1BVF9QMDEyLCAubnVtX3BsYW5lcyA9IDQsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDIsIDQs
IDEsIDEgfSwgLmJsb2NrX3cgPSB7IDEsIDEsIDIsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEsIDEs
IDEgfSwKKwkgIC5oc3ViID0gMiwgLnZzdWIgPSAyLCAuaXNfeXV2ID0gdHJ1ZSB9LAorCXsgLmZv
cm1hdCA9IERSTV9GT1JNQVRfUDAxNiwgLm51bV9wbGFuZXMgPSA0LAorCSAgLmNoYXJfcGVyX2Js
b2NrID0geyAyLCA0LCAxLCAxIH0sIC5ibG9ja193ID0geyAxLCAxLCAyLCAyIH0sIC5ibG9ja19o
ID0geyAxLCAxLCAxLCAxIH0sCisJICAuaHN1YiA9IDIsIC52c3ViID0gMiwgLmlzX3l1diA9IHRy
dWUgfSwKIH07CiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICoKQEAgLTI2
MTMsNiArMjYzMiw3IEBAIGludGVsX2dldF9mb3JtYXRfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX21v
ZGVfZmJfY21kMiAqY21kKQogCQkJCQkgIEFSUkFZX1NJWkUoc2tsX2Njc19mb3JtYXRzKSwKIAkJ
CQkJICBjbWQtPnBpeGVsX2Zvcm1hdCk7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9SQ19DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6
CiAJCXJldHVybiBsb29rdXBfZm9ybWF0X2luZm8oZ2VuMTJfY2NzX2Zvcm1hdHMsCiAJCQkJCSAg
QVJSQVlfU0laRShnZW4xMl9jY3NfZm9ybWF0cyksCiAJCQkJCSAgY21kLT5waXhlbF9mb3JtYXQp
OwpAQCAtMjYyNCw2ICsyNjQ0LDcgQEAgaW50ZWxfZ2V0X2Zvcm1hdF9pbmZvKGNvbnN0IHN0cnVj
dCBkcm1fbW9kZV9mYl9jbWQyICpjbWQpCiBib29sIGlzX2Njc19tb2RpZmllcih1NjQgbW9kaWZp
ZXIpCiB7CiAJcmV0dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEy
X1JDX0NDUyB8fAorCSAgICAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9NQ19DQ1MgfHwKIAkgICAgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfQ0NTIHx8CiAJICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9D
Q1M7CiB9CkBAIC0yNjk1LDcgKzI3MTYsNyBAQCBpbnRlbF9mYl9zdHJpZGVfYWxpZ25tZW50KGNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUpCiAJfQogCiAJ
dGlsZV93aWR0aCA9IGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoZmIsIGNvbG9yX3BsYW5lKTsKLQlp
ZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikgJiYgY29sb3JfcGxhbmUgPT0gMCkgewor
CWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgewogCQkvKgogCQkgKiBEaXNwbGF5
IFdBICMwNTMxOiBza2wsYnh0LGtibCxnbGsKIAkJICoKQEAgLTI3MDUsNyArMjcyNiw3IEBAIGlu
dGVsX2ZiX3N0cmlkZV9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
IGludCBjb2xvcl9wbGFuZSkKIAkJICogcmVxdWlyZSB0aGUgZW50aXJlIGZiIHRvIGFjY29tbW9k
YXRlIHRoYXQgdG8gYXZvaWQKIAkJICogcG90ZW50aWFsIHJ1bnRpbWUgZXJyb3JzIGF0IHBsYW5l
IGNvbmZpZ3VyYXRpb24gdGltZS4KIAkJICovCi0JCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYm
IGZiLT53aWR0aCA+IDM4NDApCisJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmIGNvbG9yX3Bs
YW5lID09IDAgJiYgZmItPndpZHRoID4gMzg0MCkKIAkJCXRpbGVfd2lkdGggKj0gNDsKIAkJLyoK
IAkJICogVGhlIG1haW4gc3VyZmFjZSBwaXRjaCBtdXN0IGJlIHBhZGRlZCB0byBhIG11bHRpcGxl
IG9mIGZvdXIKQEAgLTI4MjcsOCArMjg0OCwxOSBAQCBpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2Ft
cGxpbmcoaW50ICpoc3ViLCBpbnQgKnZzdWIsCiAKIAkqdnN1YiA9IDMyOwogfQorCitzdGF0aWMg
dm9pZAoraW50ZWxfZmJfcGxhbmVfZGltcyhpbnQgKncsIGludCAqaCwgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKK3sKKwlpbnQgaHN1YiwgdnN1YjsKKworCWlu
dGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1wbGluZygmaHN1YiwgJnZzdWIsIGZiLCBjb2xvcl9wbGFu
ZSk7CisJKncgPSBmYi0+d2lkdGggLyBoc3ViOworCSpoID0gZmItPmhlaWdodCAvIHZzdWI7Cit9
CisKIHN0YXRpYyBpbnQKLWludGVsX2ZiX2NoZWNrX2Njc194eShzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiwgaW50IHgsIGludCB5KQoraW50ZWxfZmJfY2hlY2tfY2NzX3h5KHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLCBpbnQgY2NzX3BsYW5lLCBpbnQgeCwgaW50IHkpCiB7CiAJc3RydWN0
IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiA9IHRvX2ludGVsX2ZyYW1lYnVmZmVyKGZiKTsK
IAlpbnQgbWFpbl9wbGFuZTsKQEAgLTI4MzYsNyArMjg2OCw2IEBAIGludGVsX2ZiX2NoZWNrX2Nj
c194eShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHgsIGludCB5KQogCWludCB0aWxl
X3dpZHRoLCB0aWxlX2hlaWdodDsKIAlpbnQgY2NzX3gsIGNjc195OwogCWludCBtYWluX3gsIG1h
aW5feTsKLQlpbnQgY2NzX3BsYW5lID0gMTsKIAogCWlmICghaXNfY2NzX3BsYW5lKGZiLCBjY3Nf
cGxhbmUpKQogCQlyZXR1cm4gMDsKQEAgLTI4OTEsOCArMjkyMiw3IEBAIGludGVsX2ZpbGxfZmJf
aW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWludCByZXQ7CiAKIAkJ
Y3BwID0gZmItPmZvcm1hdC0+Y3BwW2ldOwotCQl3aWR0aCA9IGRybV9mcmFtZWJ1ZmZlcl9wbGFu
ZV93aWR0aChmYi0+d2lkdGgsIGZiLCBpKTsKLQkJaGVpZ2h0ID0gZHJtX2ZyYW1lYnVmZmVyX3Bs
YW5lX2hlaWdodChmYi0+aGVpZ2h0LCBmYiwgaSk7CisJCWludGVsX2ZiX3BsYW5lX2RpbXMoJndp
ZHRoLCAmaGVpZ2h0LCBmYiwgaSk7CiAKIAkJcmV0ID0gaW50ZWxfZmJfb2Zmc2V0X3RvX3h5KCZ4
LCAmeSwgZmIsIGkpOwogCQlpZiAocmV0KSB7CkBAIC0yOTAxLDcgKzI5MzEsNyBAQCBpbnRlbF9m
aWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJcmV0dXJu
IHJldDsKIAkJfQogCi0JCXJldCA9IGludGVsX2ZiX2NoZWNrX2Njc194eShmYiwgeCwgeSk7CisJ
CXJldCA9IGludGVsX2ZiX2NoZWNrX2Njc194eShmYiwgaSwgeCwgeSk7CiAJCWlmIChyZXQpCiAJ
CQlyZXR1cm4gcmV0OwogCkBAIC0zNTU1LDYgKzM1ODUsNyBAQCBzdGF0aWMgaW50IHNrbF9tYXhf
cGxhbmVfd2lkdGgoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJCQlyZXR1cm4g
NTEyMDsKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKIAljYXNlIEk5MTVfRk9S
TUFUX01PRF9ZZl9USUxFRF9DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4x
Ml9NQ19DQ1M6CiAJCS8qIEZJWE1FIEFVWCBwbGFuZT8gKi8KIAljYXNlIEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgpAQCAtMzYxNCwxMCAr
MzY0NSwxMCBAQCBzdGF0aWMgaW50IGljbF9tYXhfcGxhbmVfaGVpZ2h0KHZvaWQpCiB9CiAKIHN0
YXRpYyBib29sIHNrbF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlLAotCQkJCQkgICBpbnQgbWFpbl94LCBpbnQgbWFpbl95LCB1
MzIgbWFpbl9vZmZzZXQpCisJCQkJCSAgIGludCBtYWluX3gsIGludCBtYWluX3ksIHUzMiBtYWlu
X29mZnNldCwKKwkJCQkJICAgaW50IGNjc19wbGFuZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQlpbnQgY2NzX3BsYW5lID0gbWFp
bl90b19jY3NfcGxhbmUoZmIsIDApOwogCWludCBhdXhfeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9w
bGFuZVtjY3NfcGxhbmVdLng7CiAJaW50IGF1eF95ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
W2Njc19wbGFuZV0ueTsKIAl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVtjY3NfcGxhbmVdLm9mZnNldDsKQEAgLTM3MjMsNyArMzc1NCw4IEBAIHN0YXRpYyBpbnQgc2ts
X2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogCSAqIHRoZXkgbWF0Y2ggd2l0aCB0aGUgbWFpbiBzdXJmYWNlIHgveSBvZmZzZXRzLgogCSAq
LwogCWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgewotCQl3aGlsZSAoIXNrbF9j
aGVja19tYWluX2Njc19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSwgeCwgeSwgb2Zmc2V0KSkgewor
CQl3aGlsZSAoIXNrbF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSwgeCwg
eSwgb2Zmc2V0LAorCQkJCQkJICAgICAgIGF1eF9wbGFuZSkpIHsKIAkJCWlmIChvZmZzZXQgPT0g
MCkKIAkJCQlicmVhazsKIApAQCAtMzc1Niw3ICszNzg4LDggQEAgc3RhdGljIGludCBza2xfY2hl
Y2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogewogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3
LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsK
LQlpbnQgbWF4X3dpZHRoID0gc2tsX21heF9wbGFuZV93aWR0aChmYiwgMSwgcm90YXRpb24pOwor
CWludCB1dl9wbGFuZSA9IDE7CisJaW50IG1heF93aWR0aCA9IHNrbF9tYXhfcGxhbmVfd2lkdGgo
ZmIsIHV2X3BsYW5lLCByb3RhdGlvbik7CiAJaW50IG1heF9oZWlnaHQgPSA0MDk2OwogCWludCB4
ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLngxID4+IDE3OwogCWludCB5ID0gcGxhbmVfc3RhdGUt
PnVhcGkuc3JjLnkxID4+IDE3OwpAQCAtMzc2NCw4ICszNzk3LDkgQEAgc3RhdGljIGludCBza2xf
Y2hlY2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+
IDE3OwogCXUzMiBvZmZzZXQ7CiAKLQlpbnRlbF9hZGRfZmJfb2Zmc2V0cygmeCwgJnksIHBsYW5l
X3N0YXRlLCAxKTsKLQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0
KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDEpOworCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwg
cGxhbmVfc3RhdGUsIHV2X3BsYW5lKTsKKwlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2Fs
aWduZWRfb2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCSAgICBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOwog
CiAJLyogRklYTUUgbm90IHF1aXRlIHN1cmUgaG93L2lmIHRoZXNlIGFwcGx5IHRvIHRoZSBjaHJv
bWEgcGxhbmUgKi8KIAlpZiAodyA+IG1heF93aWR0aCB8fCBoID4gbWF4X2hlaWdodCkgewpAQCAt
Mzc3NCw5ICszODA4LDM5IEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNrX252MTJfYXV4X3N1cmZhY2Uo
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJcmV0dXJuIC1FSU5WQUw7
CiAJfQogCi0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLm9mZnNldCA9IG9mZnNldDsKLQlw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ueCA9IHg7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lWzFdLnkgPSB5OworCWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgeworCQlp
bnQgY2NzX3BsYW5lID0gbWFpbl90b19jY3NfcGxhbmUoZmIsIHV2X3BsYW5lKTsKKwkJaW50IGF1
eF9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQ7CisJ
CWludCBhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgdXZfcGxhbmUpOworCisJ
CWlmIChvZmZzZXQgPiBhdXhfb2Zmc2V0KQorCQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRqdXN0
X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCQkJICAgcGxhbmVfc3RhdGUsCisJCQkJCQkJ
CSAgIHV2X3BsYW5lLAorCQkJCQkJCQkgICBvZmZzZXQsCisJCQkJCQkJCSAgIGF1eF9vZmZzZXQg
JiB+KGFsaWdubWVudCAtIDEpKTsKKworCQl3aGlsZSAoIXNrbF9jaGVja19tYWluX2Njc19jb29y
ZGluYXRlcyhwbGFuZV9zdGF0ZSwgeCwgeSwKKwkJCQkJCSAgICAgICBvZmZzZXQsIGNjc19wbGFu
ZSkpIHsKKwkJCWlmIChvZmZzZXQgPT0gMCkKKwkJCQlicmVhazsKKworCQkJb2Zmc2V0ID0gaW50
ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCQkJICAgcGxhbmVf
c3RhdGUsCisJCQkJCQkJCSAgIHV2X3BsYW5lLAorCQkJCQkJCQkgICBvZmZzZXQsIG9mZnNldCAt
IGFsaWdubWVudCk7CisJCX0KKworCQlpZiAoeCAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVb
Y2NzX3BsYW5lXS54IHx8CisJCSAgICB5ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3Nf
cGxhbmVdLnkpIHsKKwkJCURSTV9ERUJVR19LTVMoIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRp
c3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIENDU1xuIik7CisJCQlyZXR1cm4gLUVJTlZBTDsK
KwkJfQorCX0KKworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ub2Zmc2V0ID0g
b2Zmc2V0OworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ueCA9IHg7CisJcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lW3V2X3BsYW5lXS55ID0geTsKIAogCXJldHVybiAwOwogfQpA
QCAtMzc4NiwyMSArMzg1MCw0MCBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19jY3NfYXV4X3N1cmZh
Y2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgc3JjX3ggPSBw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CiAJaW50IHNyY195ID0gcGxhbmVfc3RhdGUt
PnVhcGkuc3JjLnkxID4+IDE2OwotCWludCBoc3ViOwotCWludCB2c3ViOwotCWludCB4OwotCWlu
dCB5OwogCXUzMiBvZmZzZXQ7CisJaW50IGNjc19wbGFuZTsKIAotCWludGVsX2ZiX3BsYW5lX2dl
dF9zdWJzYW1wbGluZygmaHN1YiwgJnZzdWIsIGZiLCAxKTsKLQl4ID0gc3JjX3ggLyBoc3ViOwot
CXkgPSBzcmNfeSAvIHZzdWI7Ci0JaW50ZWxfYWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9z
dGF0ZSwgMSk7Ci0Jb2Zmc2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgm
eCwgJnksIHBsYW5lX3N0YXRlLCAxKTsKKwlmb3IgKGNjc19wbGFuZSA9IDA7IGNjc19wbGFuZSA8
IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7IGNjc19wbGFuZSsrKSB7CisJCWludCBtYWluX2hzdWIs
IG1haW5fdnN1YjsKKwkJaW50IGhzdWIsIHZzdWI7CisJCWludCB4LCB5OworCisJCWlmICghaXNf
Y2NzX3BsYW5lKGZiLCBjY3NfcGxhbmUpKQorCQkJY29udGludWU7CisKKwkJaW50ZWxfZmJfcGxh
bmVfZ2V0X3N1YnNhbXBsaW5nKCZtYWluX2hzdWIsICZtYWluX3ZzdWIsIGZiLAorCQkJCQkgICAg
ICAgY2NzX3RvX21haW5fcGxhbmUoZmIsIGNjc19wbGFuZSkpOworCQlpbnRlbF9mYl9wbGFuZV9n
ZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3BsYW5lKTsKKworCQloc3ViICo9
IG1haW5faHN1YjsKKwkJdnN1YiAqPSBtYWluX3ZzdWI7CisJCXggPSBzcmNfeCAvIGhzdWI7CisJ
CXkgPSBzcmNfeSAvIHZzdWI7CiAKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ub2Zmc2V0
ID0gb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS54ID0geCAqIGhzdWIgKyBz
cmNfeCAlIGhzdWI7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLnkgPSB5ICogdnN1YiAr
IHNyY195ICUgdnN1YjsKKwkJaW50ZWxfYWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0
ZSwgY2NzX3BsYW5lKTsKKworCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRf
b2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCQkgICAgcGxhbmVfc3RhdGUsCisJCQkJCQkJICAgIGNjc19w
bGFuZSk7CisKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zmc2V0ID0g
b2Zmc2V0OworCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS54ID0gKHggKiBo
c3ViICsKKwkJCQkJCQkgc3JjX3ggJSBoc3ViKSAvCisJCQkJCQkJbWFpbl9oc3ViOworCQlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0gKHkgKiB2c3ViICsKKwkJCQkJCQkg
c3JjX3kgJSB2c3ViKSAvCisJCQkJCQkJbWFpbl92c3ViOworCX0KIAogCXJldHVybiAwOwogfQpA
QCAtMzgwOSw2ICszODkyLDcgQEAgaW50IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50IHJldDsKKwlib29sIG5lZWRz
X2F1eCA9IGZhbHNlOwogCiAJcmV0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9ndHQocGxhbmVfc3Rh
dGUpOwogCWlmIChyZXQpCkBAIC0zODE4LDIyICszOTAyLDMyIEBAIGludCBza2xfY2hlY2tfcGxh
bmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCQlyZXR1
cm4gMDsKIAogCS8qCi0JICogSGFuZGxlIHRoZSBBVVggc3VyZmFjZSBmaXJzdCBzaW5jZQotCSAq
IHRoZSBtYWluIHN1cmZhY2Ugc2V0dXAgZGVwZW5kcyBvbiBpdC4KKwkgKiBIYW5kbGUgdGhlIEFV
WCBzdXJmYWNlIGZpcnN0IHNpbmNlIHRoZSBtYWluIHN1cmZhY2Ugc2V0dXAgZGVwZW5kcyBvbgor
CSAqIGl0LgogCSAqLworCWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgeworCQlu
ZWVkc19hdXggPSB0cnVlOworCQlyZXQgPSBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHBsYW5l
X3N0YXRlKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfQorCiAJaWYgKGludGVsX2Zv
cm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQsCiAJCQkJCSAgICAgICAgZmIt
Pm1vZGlmaWVyKSkgeworCQluZWVkc19hdXggPSB0cnVlOwogCQlyZXQgPSBza2xfY2hlY2tfbnYx
Ml9hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0Owot
CX0gZWxzZSBpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsKLQkJcmV0ID0gc2ts
X2NoZWNrX2Njc19hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1
cm4gcmV0OwotCX0gZWxzZSB7Ci0JCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS5vZmZzZXQg
PSB+MHhmZmY7Ci0JCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS54ID0gMDsKLQkJcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lWzFdLnkgPSAwOworCX0KKworCWlmICghbmVlZHNfYXV4KSB7CisJ
CWludCBpOworCisJCWZvciAoaSA9IDE7IGkgPCBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBpKysp
IHsKKwkJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS5vZmZzZXQgPSB+MHhmZmY7CisJCQlw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ueCA9IDA7CisJCQlwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbaV0ueSA9IDA7CisJCX0KIAl9CiAKIAlyZXQgPSBza2xfY2hlY2tfbWFpbl9zdXJmYWNl
KHBsYW5lX3N0YXRlKTsKQEAgLTQ0MjMsNiArNDUxNyw4IEBAIHN0YXRpYyB1MzIgc2tsX3BsYW5l
X2N0bF90aWxpbmcodTY0IGZiX21vZGlmaWVyKQogCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1kg
fAogCQkgICAgICAgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRSB8CiAJCSAg
ICAgICBQTEFORV9DVExfQ0xFQVJfQ09MT1JfRElTQUJMRTsKKwljYXNlIEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX01DX0NDUzoKKwkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZIHwgUExB
TkVfQ1RMX01FRElBX0RFQ09NUFJFU1NJT05fRU5BQkxFOwogCWNhc2UgSTkxNV9GT1JNQVRfTU9E
X1lmX1RJTEVEOgogCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1lGOwogCWNhc2UgSTkxNV9GT1JN
QVRfTU9EX1lmX1RJTEVEX0NDUzoKQEAgLTEwMTY1LDYgKzEwMjYxLDggQEAgc2t5bGFrZV9nZXRf
aW5pdGlhbF9wbGFuZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQlmYi0+bW9k
aWZpZXIgPSBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyID8KIAkJCQlJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9HRU4xMl9SQ19DQ1MgOgogCQkJCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzsK
KwkJZWxzZSBpZiAodmFsICYgUExBTkVfQ1RMX01FRElBX0RFQ09NUFJFU1NJT05fRU5BQkxFKQor
CQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOwog
CQllbHNlCiAJCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDsKIAkJYnJl
YWs7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCmluZGV4
IDBmZWY5MjYzY2RkYy4uYjgxMTIzNDA3NzNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuaApAQCAtNDc0LDYgKzQ3NCw3IEBAIHZvaWQgaW50ZWxfbGlu
a19jb21wdXRlX21fbih1MTYgYnBwLCBpbnQgbmxhbmVzLAogCQkJICAgIHN0cnVjdCBpbnRlbF9s
aW5rX21fbiAqbV9uLAogCQkJICAgIGJvb2wgY29uc3RhbnRfbiwgYm9vbCBmZWNfZW5hYmxlKTsK
IGJvb2wgaXNfY2NzX21vZGlmaWVyKHU2NCBtb2RpZmllcik7CitpbnQgaW50ZWxfbWFpbl90b19h
dXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBtYWluX3BsYW5l
KTsKIHZvaWQgbHB0X2Rpc2FibGVfY2xrb3V0X2RwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7CiB1MzIgaW50ZWxfcGxhbmVfZmJfbWF4X3N0cmlkZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAgICB1MzIgcGl4ZWxfZm9ybWF0LCB1NjQgbW9kaWZp
ZXIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
dHlwZXMuaAppbmRleCA4M2VhMDQxNDliNzcuLjNjZGY0NGZhNDE2NCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTkwLDgg
KzkwLDggQEAgc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyIHsKIAkvKiBmb3IgZWFjaCBwbGFuZSBp
biB0aGUgbm9ybWFsIEdUVCB2aWV3ICovCiAJc3RydWN0IHsKIAkJdW5zaWduZWQgaW50IHgsIHk7
Ci0JfSBub3JtYWxbMl07Ci0JLyogZm9yIGVhY2ggcGxhbmUgaW4gdGhlIHJvdGF0ZWQgR1RUIHZp
ZXcgKi8KKwl9IG5vcm1hbFs0XTsKKwkvKiBmb3IgZWFjaCBwbGFuZSBpbiB0aGUgcm90YXRlZCBH
VFQgdmlldyBmb3Igbm8tQ0NTIGZvcm1hdHMgKi8KIAlzdHJ1Y3QgewogCQl1bnNpZ25lZCBpbnQg
eCwgeTsKIAkJdW5zaWduZWQgaW50IHBpdGNoOyAvKiBwaXhlbHMgKi8KQEAgLTU1NSw3ICs1NTUs
NyBAQCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgewogCQkgKi8KIAkJdTMyIHN0cmlkZTsKIAkJ
aW50IHgsIHk7Ci0JfSBjb2xvcl9wbGFuZVsyXTsKKwl9IGNvbG9yX3BsYW5lWzRdOwogCiAJLyog
cGxhbmUgY29udHJvbCByZWdpc3RlciAqLwogCXUzMiBjdGw7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwppbmRleCBiN2YzYTFiMzM1OGYuLmJlNTZiNmY1NjQx
MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC01
ODMsMTUgKzU4MywxNiBAQCBza2xfcHJvZ3JhbV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxh
bmVfc3RhdGUtPmNrZXk7CiAJdTMyIHN1cmZfYWRkciA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVtjb2xvcl9wbGFuZV0ub2Zmc2V0OwogCXUzMiBzdHJpZGUgPSBza2xfcGxhbmVfc3RyaWRlKHBs
YW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7Ci0JdTMyIGF1eF9kaXN0ID0gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lWzFdLm9mZnNldCAtIHN1cmZfYWRkcjsKLQl1MzIgYXV4X3N0cmlkZSA9IHNrbF9w
bGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIDEpOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWludCBhdXhfcGxhbmUgPSBpbnRlbF9tYWlu
X3RvX2F1eF9wbGFuZShmYiwgY29sb3JfcGxhbmUpOworCXUzMiBhdXhfZGlzdCA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVdLm9mZnNldCAtIHN1cmZfYWRkcjsKKwl1MzIgYXV4
X3N0cmlkZSA9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIGF1eF9wbGFuZSk7CiAJaW50
IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKIAlpbnQgY3J0Y195ID0gcGxhbmVf
c3RhdGUtPnVhcGkuZHN0LnkxOwogCXUzMiB4ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Nv
bG9yX3BsYW5lXS54OwogCXUzMiB5ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3Bs
YW5lXS55OwogCXUzMiBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMpID4+IDE2OwogCXUzMiBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVh
cGkuc3JjKSA+PiAxNjsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5ody5mYjsKIAl1OCBhbHBoYSA9IHBsYW5lX3N0YXRlLT5ody5hbHBoYSA+PiA4Owog
CXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CkBAIC0y
MTA2LDcgKzIxMDcsOCBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgICAgIGZiLT5tb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQgfHwKIAkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9DQ1MgfHwKIAkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1B
VF9NT0RfWWZfVElMRURfQ0NTIHx8Ci0JICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTKSkgeworCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyB8fAorCSAgICAgZmItPm1vZGlmaWVyID09
IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUykpIHsKIAkJRFJNX0RFQlVHX0tN
UygiWS9ZZiB0aWxpbmcgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBtb2RlXG4iKTsKIAkJcmV0dXJu
IC1FSU5WQUw7CiAJfQpAQCAtMjU3Nyw3ICsyNTc5LDE2IEBAIHN0YXRpYyBjb25zdCB1NjQgc2ts
X3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfY2NzW10gPSB7CiAJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJ
RAogfTsKIAotc3RhdGljIGNvbnN0IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2Nj
c1tdID0geworc3RhdGljIGNvbnN0IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX21j
X2Njc1tdID0geworCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUywKKwlJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCisJSTkxNV9GT1JNQVRfTU9EX1lfVElM
RUQsCisJSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAor
CURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKK307CisKK3N0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxh
bmVfZm9ybWF0X21vZGlmaWVyc19yY19jY3NbXSA9IHsKIAlJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RF9HRU4xMl9SQ19DQ1MsCiAJSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCiAJSTkxNV9GT1JNQVRf
TU9EX1hfVElMRUQsCkBAIC0yNzQyLDEwICsyNzUzLDIxIEBAIHN0YXRpYyBib29sIHNrbF9wbGFu
ZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJfQogfQog
CitzdGF0aWMgYm9vbCBnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCkKK3sKKwlyZXR1cm4gcGxhbmVfaWQgPCBQTEFORV9TUFJJVEU0OworfQorCiBzdGF0
aWMgYm9vbCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5l
ICpfcGxhbmUsCiAJCQkJCSAgICAgdTMyIGZvcm1hdCwgdTY0IG1vZGlmaWVyKQogeworCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShfcGxhbmUpOworCiAJc3dpdGNo
IChtb2RpZmllcikgeworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NT
OgorCQlpZiAoIWdlbjEyX3BsYW5lX3N1cHBvcnRzX21jX2NjcyhwbGFuZS0+aWQpKQorCQkJcmV0
dXJuIGZhbHNlOworCQkvKiBmYWxsIHRocm91Z2ggKi8KIAljYXNlIERSTV9GT1JNQVRfTU9EX0xJ
TkVBUjoKIAljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgogCWNhc2UgSTkxNV9GT1JNQVRf
TU9EX1lfVElMRUQ6CkBAIC0yNzYzLDExICsyNzg1LDYgQEAgc3RhdGljIGJvb2wgZ2VuMTJfcGxh
bmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCQlpZiAo
aXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKIAkJCXJldHVybiB0cnVlOwogCQkvKiBmYWxsIHRo
cm91Z2ggKi8KLQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgotCWNhc2UgRFJNX0ZPUk1BVF9YUkdC
MjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFU
X0FSR0IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKIAljYXNlIERSTV9G
T1JNQVRfWVVZVjoKIAljYXNlIERSTV9GT1JNQVRfWVZZVToKIAljYXNlIERSTV9GT1JNQVRfVVlW
WToKQEAgLTI3NzYsNiArMjc5MywxNCBAQCBzdGF0aWMgYm9vbCBnZW4xMl9wbGFuZV9mb3JtYXRf
bW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJY2FzZSBEUk1fRk9STUFU
X1AwMTA6CiAJY2FzZSBEUk1fRk9STUFUX1AwMTI6CiAJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJ
CWlmIChtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MpCisJ
CQlyZXR1cm4gdHJ1ZTsKKwkJLyogZmFsbCB0aHJvdWdoICovCisJY2FzZSBEUk1fRk9STUFUX1JH
QjU2NToKKwljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hC
R1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JN
QVRfQUJHUjIxMDEwMTA6CiAJY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgogCWNhc2UgRFJN
X0ZPUk1BVF9DODoKIAljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKQEAgLTI5MDksNiAr
MjkzNCwxNCBAQCBzdGF0aWMgY29uc3QgdTMyICppY2xfZ2V0X3BsYW5lX2Zvcm1hdHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIH0KIAorc3RhdGljIGNvbnN0IHU2NCAq
Z2VuMTJfZ2V0X3BsYW5lX21vZGlmaWVycyhlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQoreworCWlm
IChnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MocGxhbmVfaWQpKQorCQlyZXR1cm4gZ2VuMTJf
cGxhbmVfZm9ybWF0X21vZGlmaWVyc19tY19jY3M7CisJZWxzZQorCQlyZXR1cm4gZ2VuMTJfcGxh
bmVfZm9ybWF0X21vZGlmaWVyc19yY19jY3M7Cit9CisKIHN0YXRpYyBib29sIHNrbF9wbGFuZV9o
YXNfY2NzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgICAgIGVudW0g
cGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQogewpAQCAtMjk3NCw3ICszMDA3LDcg
QEAgc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCiAJcGxhbmUtPmhhc19jY3MgPSBza2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwg
cGlwZSwgcGxhbmVfaWQpOwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7Ci0JCW1v
ZGlmaWVycyA9IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfY2NzOworCQltb2RpZmllcnMg
PSBnZW4xMl9nZXRfcGxhbmVfbW9kaWZpZXJzKHBsYW5lX2lkKTsKIAkJcGxhbmVfZnVuY3MgPSAm
Z2VuMTJfcGxhbmVfZnVuY3M7CiAJfSBlbHNlIHsKIAkJaWYgKHBsYW5lLT5oYXNfY2NzKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcmVnLmgKaW5kZXggYmJmZWRlYjAwYjdmLi5iNmRjNzM1ZTg1ZTEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9yZWcuaApAQCAtNjgwOCw2ICs2ODA4LDcgQEAgZW51bSB7CiAjZGVmaW5l
ICAgUExBTkVfQ1RMX1RJTEVEX1kJCQkoNCA8PCAxMCkKICNkZWZpbmUgICBQTEFORV9DVExfVElM
RURfWUYJCQkoNSA8PCAxMCkKICNkZWZpbmUgICBQTEFORV9DVExfRkxJUF9IT1JJWk9OVEFMCQko
MSA8PCA4KQorI2RlZmluZSAgIFBMQU5FX0NUTF9NRURJQV9ERUNPTVBSRVNTSU9OX0VOQUJMRQko
MSA8PCA0KSAvKiBUR0wrICovCiAjZGVmaW5lICAgUExBTkVfQ1RMX0FMUEhBX01BU0sJCQkoMHgz
IDw8IDQpIC8qIFByZS1HTEsgKi8KICNkZWZpbmUgICBQTEFORV9DVExfQUxQSEFfRElTQUJMRQkJ
KDAgPDwgNCkKICNkZWZpbmUgICBQTEFORV9DVExfQUxQSEFfU1dfUFJFTVVMVElQTFkJKDIgPDwg
NCkKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4Cg==

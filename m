Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9571A4C8B5
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 09:55:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 813E86E519;
	Thu, 20 Jun 2019 07:55:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CD8A26E519
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 07:55:24 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 16961923-1500050 for multiple; Thu, 20 Jun 2019 08:55:17 +0100
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20190620010021.20637-1-daniele.ceraolospurio@intel.com>
 <20190620010021.20637-6-daniele.ceraolospurio@intel.com>
In-Reply-To: <20190620010021.20637-6-daniele.ceraolospurio@intel.com>
Message-ID: <156101731904.664.328342541669662221@skylake-alporthouse-com>
Date: Thu, 20 Jun 2019 08:55:19 +0100
Subject: Re: [Intel-gfx] [PATCH v2 5/6] drm/i915: dynamically allocate
 forcewake domains
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBEYW5pZWxlIENlcmFvbG8gU3B1cmlvICgyMDE5LTA2LTIwIDAyOjAwOjIwKQo+IFdl
J2QgbGlrZSB0byBpbnRyb2R1Y2UgYSBkaXNwbGF5IHVuY29yZSB3aXRoIG5vIGZvcmNld2FrZSBk
b21haW5zLCBzbwo+IGxldCdzIGF2b2lkIHdhc3RpbmcgbWVtb3J5IGFuZCBiZSByZWFkeSB0byBh
bGxvY2F0ZSBvbmx5IHdoYXQgd2UgbmVlZC4KPiBFdmVuIHdpdGhvdXQgbXVsdGlwbGUgdW5jb3Jl
LCB3ZSBzdGlsbCBkb24ndCBuZWVkIGFsbCB0aGUgZG9tYWlucyBvbiBhbGwKPiBnZW5zLgo+IAo+
IHYyOiBhdm9pZCBoaWRkZW4gY29udHJvbCBmbG93LCBpbXByb3ZlIGNoZWNrcyAoVHZydGtvKSwg
Zml4IElWQiBzcGVjaWFsCj4gY2FzZSwgYWRkIGZhaWx1cmUgaW5qZWN0aW9uIHBvaW50Cj4gCj4g
U2lnbmVkLW9mZi1ieTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1
cmlvQGludGVsLmNvbT4KPiBDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGxpbnV4
LmludGVsLmNvbT4KPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMg
fCAxMDEgKysrKysrKysrKysrKysrKysrKystLS0tLS0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF91bmNvcmUuaCB8ICAxMyArKy0tCj4gIDIgZmlsZXMgY2hhbmdlZCwgNzcgaW5zZXJ0
aW9ucygrKSwgMzcgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3VuY29yZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3Jl
LmMKPiBpbmRleCAwMGJmNWUwODVhMmMuLjJiZDYwMmE0MWJiNyAxMDA2NDQKPiAtLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3VuY29yZS5jCj4gQEAgLTM0NCw3ICszNDQsNyBAQCBpbnRlbF91bmNvcmVfZndf
cmVsZWFzZV90aW1lcihzdHJ1Y3QgaHJ0aW1lciAqdGltZXIpCj4gIHsKPiAgICAgICAgIHN0cnVj
dCBpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2RvbWFpbiAqZG9tYWluID0KPiAgICAgICAgICAgICAg
ICBjb250YWluZXJfb2YodGltZXIsIHN0cnVjdCBpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2RvbWFp
biwgdGltZXIpOwo+IC0gICAgICAgc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZm9yY2V3
YWtlX2RvbWFpbl90b191bmNvcmUoZG9tYWluKTsKPiArICAgICAgIHN0cnVjdCBpbnRlbF91bmNv
cmUgKnVuY29yZSA9IGRvbWFpbi0+dW5jb3JlOwo+ICAgICAgICAgdW5zaWduZWQgbG9uZyBpcnFm
bGFnczsKPiAgCj4gICAgICAgICBhc3NlcnRfcnBtX2RldmljZV9ub3Rfc3VzcGVuZGVkKHVuY29y
ZS0+cnBtKTsKPiBAQCAtMTI5MywyMyArMTI5MywyNyBAQCBkbyB7IFwKPiAgICAgICAgICh1bmNv
cmUpLT5mdW5jcy5yZWFkX2Z3X2RvbWFpbnMgPSB4IyNfcmVnX3JlYWRfZndfZG9tYWluczsgXAo+
ICB9IHdoaWxlICgwKQo+ICAKPiAtc3RhdGljIHZvaWQgZndfZG9tYWluX2luaXQoc3RydWN0IGlu
dGVsX3VuY29yZSAqdW5jb3JlLAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgIGVudW0gZm9y
Y2V3YWtlX2RvbWFpbl9pZCBkb21haW5faWQsCj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAg
aTkxNV9yZWdfdCByZWdfc2V0LAo+IC0gICAgICAgICAgICAgICAgICAgICAgICAgIGk5MTVfcmVn
X3QgcmVnX2FjaykKPiArc3RhdGljIGludCBfX2Z3X2RvbWFpbl9pbml0KHN0cnVjdCBpbnRlbF91
bmNvcmUgKnVuY29yZSwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgZW51bSBmb3JjZXdh
a2VfZG9tYWluX2lkIGRvbWFpbl9pZCwKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgaTkx
NV9yZWdfdCByZWdfc2V0LAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICBpOTE1X3JlZ190
IHJlZ19hY2spCj4gIHsKPiAgICAgICAgIHN0cnVjdCBpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2Rv
bWFpbiAqZDsKPiAgCj4gLSAgICAgICBpZiAoV0FSTl9PTihkb21haW5faWQgPj0gRldfRE9NQUlO
X0lEX0NPVU5UKSkKPiAtICAgICAgICAgICAgICAgcmV0dXJuOwo+ICsgICAgICAgR0VNX0JVR19P
Tihkb21haW5faWQgPj0gRldfRE9NQUlOX0lEX0NPVU5UKTsKPiArICAgICAgIEdFTV9CVUdfT04o
dW5jb3JlLT5md19kb21haW5bZG9tYWluX2lkXSk7Cj4gIAo+IC0gICAgICAgZCA9ICZ1bmNvcmUt
PmZ3X2RvbWFpbltkb21haW5faWRdOwo+ICsgICAgICAgaWYgKGk5MTVfaW5qZWN0X2xvYWRfZmFp
bHVyZSgpKQo+ICsgICAgICAgICAgICAgICByZXR1cm4gLUVOT01FTTsKCldpbGwgYmUgYW4gaW50
ZXJlc3RpbmcgdGVzdCBmb3IgdGhlIHRlc3QgKHdlbGwgZG1lc2cgcGFyc2VyIHRvIHNlZSBpZiBp
dAppcyBzdGlsbCBnZXR0aW5nIHVwc2V0IG92ZXIgbm90aGluZykuCgo+IC0gICAgICAgV0FSTl9P
TihkLT53YWtlX2NvdW50KTsKPiArICAgICAgIGQgPSBremFsbG9jKHNpemVvZigqZCksIEdGUF9L
RVJORUwpOwo+ICsgICAgICAgaWYgKCFkKQo+ICsgICAgICAgICAgICAgICByZXR1cm4gLUVOT01F
TTsKPiAgCj4gICAgICAgICBXQVJOX09OKCFpOTE1X21taW9fcmVnX3ZhbGlkKHJlZ19zZXQpKTsK
PiAgICAgICAgIFdBUk5fT04oIWk5MTVfbW1pb19yZWdfdmFsaWQocmVnX2FjaykpOwo+ICAKPiAr
ICAgICAgIGQtPnVuY29yZSA9IHVuY29yZTsKPiAgICAgICAgIGQtPndha2VfY291bnQgPSAwOwo+
ICAgICAgICAgZC0+cmVnX3NldCA9IHVuY29yZS0+cmVncyArIGk5MTVfbW1pb19yZWdfb2Zmc2V0
KHJlZ19zZXQpOwo+ICAgICAgICAgZC0+cmVnX2FjayA9IHVuY29yZS0+cmVncyArIGk5MTVfbW1p
b19yZWdfb2Zmc2V0KHJlZ19hY2spOwo+IEBAIC0xMzI2LDcgKzEzMzAsNiBAQCBzdGF0aWMgdm9p
ZCBmd19kb21haW5faW5pdChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCj4gICAgICAgICBC
VUlMRF9CVUdfT04oRk9SQ0VXQUtFX01FRElBX1ZFQk9YMCAhPSAoMSA8PCBGV19ET01BSU5fSURf
TUVESUFfVkVCT1gwKSk7Cj4gICAgICAgICBCVUlMRF9CVUdfT04oRk9SQ0VXQUtFX01FRElBX1ZF
Qk9YMSAhPSAoMSA8PCBGV19ET01BSU5fSURfTUVESUFfVkVCT1gxKSk7Cj4gIAo+IC0KPiAgICAg
ICAgIGQtPm1hc2sgPSBCSVQoZG9tYWluX2lkKTsKPiAgCj4gICAgICAgICBocnRpbWVyX2luaXQo
JmQtPnRpbWVyLCBDTE9DS19NT05PVE9OSUMsIEhSVElNRVJfTU9ERV9SRUwpOwo+IEBAIC0xMzM1
LDYgKzEzMzgsMTAgQEAgc3RhdGljIHZvaWQgZndfZG9tYWluX2luaXQoc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlLAo+ICAgICAgICAgdW5jb3JlLT5md19kb21haW5zIHw9IEJJVChkb21haW5f
aWQpOwo+ICAKPiAgICAgICAgIGZ3X2RvbWFpbl9yZXNldChkKTsKPiArCj4gKyAgICAgICB1bmNv
cmUtPmZ3X2RvbWFpbltkb21haW5faWRdID0gZDsKCkZ3aXcsIEkgd291bGQgcGFpciB0aGlzIHdp
dGggc2V0dGluZyB0aGUgbWFzayBpbiB1bmNvcmUtPmZ3X2RvbWFpbnMuCgo+ICsKPiArICAgICAg
IHJldHVybiAwOwo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZCBmd19kb21haW5fZmluaShzdHJ1Y3Qg
aW50ZWxfdW5jb3JlICp1bmNvcmUsCj4gQEAgLTEzNDIsMjkgKzEzNDksNDEgQEAgc3RhdGljIHZv
aWQgZndfZG9tYWluX2Zpbmkoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAo+ICB7Cj4gICAg
ICAgICBzdHJ1Y3QgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9kb21haW4gKmQ7Cj4gIAo+IC0gICAg
ICAgaWYgKFdBUk5fT04oZG9tYWluX2lkID49IEZXX0RPTUFJTl9JRF9DT1VOVCkpCj4gLSAgICAg
ICAgICAgICAgIHJldHVybjsKPiArICAgICAgIEdFTV9CVUdfT04oZG9tYWluX2lkID49IEZXX0RP
TUFJTl9JRF9DT1VOVCk7Cj4gIAo+IC0gICAgICAgZCA9ICZ1bmNvcmUtPmZ3X2RvbWFpbltkb21h
aW5faWRdOwo+ICsgICAgICAgZCA9IGZldGNoX2FuZF96ZXJvKCZ1bmNvcmUtPmZ3X2RvbWFpbltk
b21haW5faWRdKTsKPiArICAgICAgIGlmICghZCkKPiArICAgICAgICAgICAgICAgcmV0dXJuOwo+
ICAKPiArICAgICAgIHVuY29yZS0+ZndfZG9tYWlucyAmPSB+QklUKGRvbWFpbl9pZCk7Cj4gICAg
ICAgICBXQVJOX09OKGQtPndha2VfY291bnQpOwo+ICAgICAgICAgV0FSTl9PTihocnRpbWVyX2Nh
bmNlbCgmZC0+dGltZXIpKTsKPiAtICAgICAgIG1lbXNldChkLCAwLCBzaXplb2YoKmQpKTsKPiAr
ICAgICAgIGtmcmVlKGQpOwo+ICt9Cj4gIAo+IC0gICAgICAgdW5jb3JlLT5md19kb21haW5zICY9
IH5CSVQoZG9tYWluX2lkKTsKPiArc3RhdGljIHZvaWQgaW50ZWxfdW5jb3JlX2Z3X2RvbWFpbnNf
ZmluaShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCj4gK3sKPiArICAgICAgIHN0cnVjdCBp
bnRlbF91bmNvcmVfZm9yY2V3YWtlX2RvbWFpbiAqZDsKPiArICAgICAgIGludCB0bXA7Cj4gKwo+
ICsgICAgICAgZm9yX2VhY2hfZndfZG9tYWluKGQsIHVuY29yZSwgdG1wKQo+ICsgICAgICAgICAg
ICAgICBmd19kb21haW5fZmluaSh1bmNvcmUsIGQtPmlkKTsKPiAgfQo+ICAKPiAtc3RhdGljIHZv
aWQgaW50ZWxfdW5jb3JlX2Z3X2RvbWFpbnNfaW5pdChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNv
cmUpCj4gK3N0YXRpYyBpbnQgaW50ZWxfdW5jb3JlX2Z3X2RvbWFpbnNfaW5pdChzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUpCj4gIHsKPiAgICAgICAgIHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdW5jb3JlLT5pOTE1Owo+ICsgICAgICAgaW50IHJldCA9IDA7Cj4gIAo+ICAgICAg
ICAgR0VNX0JVR19PTighaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSk7Cj4gIAo+
ICsjZGVmaW5lIGZ3X2RvbWFpbl9pbml0KHVuY29yZV9fLCBpZF9fLCBzZXRfXywgYWNrX18pIFwK
PiArICAgICAgIChyZXQgPzogKHJldCA9IF9fZndfZG9tYWluX2luaXQoKHVuY29yZV9fKSwgKGlk
X18pLCAoc2V0X18pLCAoYWNrX18pKSkpCgpTZWVtcyBhIHJlYXNvbmFibGUgY29tcHJvbWlzZSwg
dGhhdCBJJ20gc3VyZSB3ZSdsbCBsaXZlIHRvIHJlZ3JldC4gOikKCj4gICAgICAgICBpZiAoSU5U
RUxfR0VOKGk5MTUpID49IDExKSB7Cj4gICAgICAgICAgICAgICAgIGludCBpOwo+ICAKPiAtICAg
ICAgICAgICAgICAgdW5jb3JlLT5mdW5jcy5mb3JjZV93YWtlX2dldCA9Cj4gLSAgICAgICAgICAg
ICAgICAgICAgICAgZndfZG9tYWluc19nZXRfd2l0aF9mYWxsYmFjazsKPiArICAgICAgICAgICAg
ICAgdW5jb3JlLT5mdW5jcy5mb3JjZV93YWtlX2dldCA9IGZ3X2RvbWFpbnNfZ2V0X3dpdGhfZmFs
bGJhY2s7Cj4gICAgICAgICAgICAgICAgIHVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9wdXQgPSBm
d19kb21haW5zX3B1dDsKPiAgICAgICAgICAgICAgICAgZndfZG9tYWluX2luaXQodW5jb3JlLCBG
V19ET01BSU5fSURfUkVOREVSLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGT1JD
RVdBS0VfUkVOREVSX0dFTjksCj4gQEAgLTEzNzIsNiArMTM5MSw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3VuY29yZV9md19kb21haW5zX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQo+
ICAgICAgICAgICAgICAgICBmd19kb21haW5faW5pdCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9CTElU
VEVSLAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGT1JDRVdBS0VfQkxJVFRFUl9H
RU45LAo+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGT1JDRVdBS0VfQUNLX0JMSVRU
RVJfR0VOOSk7Cj4gKwo+ICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhf
VkNTOyBpKyspIHsKPiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUhBU19FTkdJTkUoaTkx
NSwgX1ZDUyhpKSkpCj4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK
PiBAQCAtMTM4OSw4ICsxNDA5LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdW5jb3JlX2Z3X2RvbWFp
bnNfaW5pdChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCj4gICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgRk9SQ0VXQUtFX0FDS19NRURJQV9WRUJPWF9HRU4xMShpKSk7
Cj4gICAgICAgICAgICAgICAgIH0KPiAgICAgICAgIH0gZWxzZSBpZiAoSVNfR0VOX1JBTkdFKGk5
MTUsIDksIDEwKSkgewo+IC0gICAgICAgICAgICAgICB1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2Vf
Z2V0ID0KPiAtICAgICAgICAgICAgICAgICAgICAgICBmd19kb21haW5zX2dldF93aXRoX2ZhbGxi
YWNrOwo+ICsgICAgICAgICAgICAgICB1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2VfZ2V0ID0gZndf
ZG9tYWluc19nZXRfd2l0aF9mYWxsYmFjazsKPiAgICAgICAgICAgICAgICAgdW5jb3JlLT5mdW5j
cy5mb3JjZV93YWtlX3B1dCA9IGZ3X2RvbWFpbnNfcHV0Owo+ICAgICAgICAgICAgICAgICBmd19k
b21haW5faW5pdCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9SRU5ERVIsCj4gICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIEZPUkNFV0FLRV9SRU5ERVJfR0VOOSwKPiBAQCAtMTQzOSw4ICsxNDU4
LDEwIEBAIHN0YXRpYyB2b2lkIGludGVsX3VuY29yZV9md19kb21haW5zX2luaXQoc3RydWN0IGlu
dGVsX3VuY29yZSAqdW5jb3JlKQo+ICAgICAgICAgICAgICAgICBfX3Jhd191bmNvcmVfd3JpdGUz
Mih1bmNvcmUsIEZPUkNFV0FLRSwgMCk7Cj4gICAgICAgICAgICAgICAgIF9fcmF3X3Bvc3Rpbmdf
cmVhZCh1bmNvcmUsIEVDT0JVUyk7Cj4gIAo+IC0gICAgICAgICAgICAgICBmd19kb21haW5faW5p
dCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9SRU5ERVIsCj4gLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIEZPUkNFV0FLRV9NVCwgRk9SQ0VXQUtFX01UX0FDSyk7Cj4gKyAgICAgICAgICAgICAg
IHJldCA9IF9fZndfZG9tYWluX2luaXQodW5jb3JlLCBGV19ET01BSU5fSURfUkVOREVSLAo+ICsg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZPUkNFV0FLRV9NVCwgRk9SQ0VX
QUtFX01UX0FDSyk7Cj4gKyAgICAgICAgICAgICAgIGlmIChyZXQpCj4gKyAgICAgICAgICAgICAg
ICAgICAgICAgZ290byBvdXQ7Cj4gIAo+ICAgICAgICAgICAgICAgICBzcGluX2xvY2tfaXJxKCZ1
bmNvcmUtPmxvY2spOwo+ICAgICAgICAgICAgICAgICBmd19kb21haW5zX2dldF93aXRoX3RocmVh
ZF9zdGF0dXModW5jb3JlLCBGT1JDRVdBS0VfUkVOREVSKTsKPiBAQCAtMTQ1MSw2ICsxNDcyLDcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfdW5jb3JlX2Z3X2RvbWFpbnNfaW5pdChzdHJ1Y3QgaW50ZWxf
dW5jb3JlICp1bmNvcmUpCj4gICAgICAgICAgICAgICAgIGlmICghKGVjb2J1cyAmIEZPUkNFV0FL
RV9NVF9FTkFCTEUpKSB7Cj4gICAgICAgICAgICAgICAgICAgICAgICAgRFJNX0lORk8oIk5vIE1U
IGZvcmNld2FrZSBhdmFpbGFibGUgb24gSXZ5YnJpZGdlLCB0aGlzIGNhbiByZXN1bHQgaW4gaXNz
dWVzXG4iKTsKPiAgICAgICAgICAgICAgICAgICAgICAgICBEUk1fSU5GTygid2hlbiB1c2luZyB2
Ymxhbmstc3luY2VkIHBhcnRpYWwgc2NyZWVuIHVwZGF0ZXMuXG4iKTsKPiArICAgICAgICAgICAg
ICAgICAgICAgICBmd19kb21haW5fZmluaSh1bmNvcmUsIEZXX0RPTUFJTl9JRF9SRU5ERVIpOwo+
ICAgICAgICAgICAgICAgICAgICAgICAgIGZ3X2RvbWFpbl9pbml0KHVuY29yZSwgRldfRE9NQUlO
X0lEX1JFTkRFUiwKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGT1JD
RVdBS0UsIEZPUkNFV0FLRV9BQ0spOwo+ICAgICAgICAgICAgICAgICB9Cj4gQEAgLTE0NjIsOCAr
MTQ4NCwxNiBAQCBzdGF0aWMgdm9pZCBpbnRlbF91bmNvcmVfZndfZG9tYWluc19pbml0KHN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSkKPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
Rk9SQ0VXQUtFLCBGT1JDRVdBS0VfQUNLKTsKPiAgICAgICAgIH0KPiAgCj4gKyN1bmRlZiBmd19k
b21haW5faW5pdAo+ICsKPiAgICAgICAgIC8qIEFsbCBmdXR1cmUgcGxhdGZvcm1zIGFyZSBleHBl
Y3RlZCB0byByZXF1aXJlIGNvbXBsZXggcG93ZXIgZ2F0aW5nICovCj4gLSAgICAgICBXQVJOX09O
KHVuY29yZS0+ZndfZG9tYWlucyA9PSAwKTsKPiArICAgICAgIFdBUk5fT04oIXJldCAmJiB1bmNv
cmUtPmZ3X2RvbWFpbnMgPT0gMCk7Cj4gKwo+ICtvdXQ6Cj4gKyAgICAgICBpZiAocmV0KQo+ICsg
ICAgICAgICAgICAgICBpbnRlbF91bmNvcmVfZndfZG9tYWluc19maW5pKHVuY29yZSk7Cj4gKwo+
ICsgICAgICAgcmV0dXJuIHJldDsKPiAgfQo+ICAKPiAgI2RlZmluZSBBU1NJR05fRldfRE9NQUlO
U19UQUJMRSh1bmNvcmUsIGQpIFwKPiBAQCAtMTU2NCwxMyArMTU5NCwxNyBAQCBzdGF0aWMgdm9p
ZCB1bmNvcmVfcmF3X2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQo+ICAgICAgICAg
fQo+ICB9Cj4gIAo+IC1zdGF0aWMgdm9pZCB1bmNvcmVfZm9yY2V3YWtlX2luaXQoc3RydWN0IGlu
dGVsX3VuY29yZSAqdW5jb3JlKQo+ICtzdGF0aWMgaW50IHVuY29yZV9mb3JjZXdha2VfaW5pdChz
dHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCj4gIHsKPiAgICAgICAgIHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdW5jb3JlLT5pOTE1Owo+ICsgICAgICAgaW50IHJldDsKPiAgCj4g
ICAgICAgICBHRU1fQlVHX09OKCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKTsK
PiAgCj4gLSAgICAgICBpbnRlbF91bmNvcmVfZndfZG9tYWluc19pbml0KHVuY29yZSk7Cj4gKyAg
ICAgICByZXQgPSBpbnRlbF91bmNvcmVfZndfZG9tYWluc19pbml0KHVuY29yZSk7Cj4gKyAgICAg
ICBpZiAocmV0KQo+ICsgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ICsKPiAgICAgICAgIGZv
cmNld2FrZV9lYXJseV9zYW5pdGl6ZSh1bmNvcmUsIDApOwo+ICAKPiAgICAgICAgIGlmIChJU19H
RU5fUkFOR0UoaTkxNSwgNiwgNykpIHsKPiBAQCAtMTYwMyw2ICsxNjM3LDggQEAgc3RhdGljIHZv
aWQgdW5jb3JlX2ZvcmNld2FrZV9pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKPiAg
Cj4gICAgICAgICB1bmNvcmUtPnBtaWNfYnVzX2FjY2Vzc19uYi5ub3RpZmllcl9jYWxsID0gaTkx
NV9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXI7Cj4gICAgICAgICBpb3NmX21iaV9yZWdpc3Rlcl9w
bWljX2J1c19hY2Nlc3Nfbm90aWZpZXIoJnVuY29yZS0+cG1pY19idXNfYWNjZXNzX25iKTsKPiAr
Cj4gKyAgICAgICByZXR1cm4gMDsKPiAgfQo+ICAKPiAgaW50IGludGVsX3VuY29yZV9pbml0X21t
aW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQo+IEBAIC0xNjIxLDEwICsxNjU3LDEzIEBA
IGludCBpbnRlbF91bmNvcmVfaW5pdF9tbWlvKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkK
PiAgCj4gICAgICAgICB1bmNvcmUtPnVuY2xhaW1lZF9tbWlvX2NoZWNrID0gMTsKPiAgCj4gLSAg
ICAgICBpZiAoIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkpCj4gKyAgICAgICBp
ZiAoIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkpIHsKPiAgICAgICAgICAgICAg
ICAgdW5jb3JlX3Jhd19pbml0KHVuY29yZSk7Cj4gLSAgICAgICBlbHNlCj4gLSAgICAgICAgICAg
ICAgIHVuY29yZV9mb3JjZXdha2VfaW5pdCh1bmNvcmUpOwo+ICsgICAgICAgfSBlbHNlIHsKPiAr
ICAgICAgICAgICAgICAgcmV0ID0gdW5jb3JlX2ZvcmNld2FrZV9pbml0KHVuY29yZSk7Cj4gKyAg
ICAgICAgICAgICAgIGlmIChyZXQpCj4gKyAgICAgICAgICAgICAgICAgICAgICAgZ290byBvdXRf
bW1pb19jbGVhbnVwOwo+ICsgICAgICAgfQo+ICAKPiAgICAgICAgIC8qIG1ha2Ugc3VyZSBmdyBm
dW5jcyBhcmUgc2V0IGlmIGFuZCBvbmx5IGlmIHdlIGhhdmUgZncqLwo+ICAgICAgICAgR0VNX0JV
R19PTihpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpICE9ICEhdW5jb3JlLT5mdW5j
cy5mb3JjZV93YWtlX2dldCk7Cj4gQEAgLTE2NDYsNiArMTY4NSwxMSBAQCBpbnQgaW50ZWxfdW5j
b3JlX2luaXRfbW1pbyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCj4gICAgICAgICAgICAg
ICAgIERSTV9ERUJVRygidW5jbGFpbWVkIG1taW8gZGV0ZWN0ZWQgb24gdW5jb3JlIGluaXQsIGNs
ZWFyaW5nXG4iKTsKPiAgCj4gICAgICAgICByZXR1cm4gMDsKPiArCj4gK291dF9tbWlvX2NsZWFu
dXA6Cj4gKyAgICAgICB1bmNvcmVfbW1pb19jbGVhbnVwKHVuY29yZSk7Cj4gKwo+ICsgICAgICAg
cmV0dXJuIHJldDsKPiAgfQo+ICAKPiAgLyoKPiBAQCAtMTY5MSw2ICsxNzM1LDcgQEAgdm9pZCBp
bnRlbF91bmNvcmVfZmluaV9tbWlvKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKPiAgICAg
ICAgICAgICAgICAgaW9zZl9tYmlfdW5yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXJf
dW5sb2NrZWQoCj4gICAgICAgICAgICAgICAgICAgICAgICAgJnVuY29yZS0+cG1pY19idXNfYWNj
ZXNzX25iKTsKPiAgICAgICAgICAgICAgICAgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9yZXNldCh1
bmNvcmUpOwo+ICsgICAgICAgICAgICAgICBpbnRlbF91bmNvcmVfZndfZG9tYWluc19maW5pKHVu
Y29yZSk7CgpPaywgbG9va3MgbGlrZSB0aGlzIGlzIHBhaXJlZCBjb3JyZWN0bHkuIEkgc3VwcG9z
ZSB3ZSBjYW4ndCBkbyB0aGUKYWxsb2NhdGlvbnMgYW55IGVhcmxpZXIsIGFuZCBpdCBkb2VzIG1h
a2Ugc2Vuc2UgdGhhdCB3ZSBjYW4ndCBkZXRlY3QgdGhlCmRvbWFpbnMgdW50aWwgd2UgY2FuIHBy
b2JlIHRoZSBIVyBzbyBtbWlvLgoKPiAgICAgICAgICAgICAgICAgaW9zZl9tYmlfcHVuaXRfcmVs
ZWFzZSgpOwo+ICAgICAgICAgfQo+ICAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfdW5jb3JlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuaAo+
IGluZGV4IDU5NTA1YTJmOTA5Ny4uNzEwODQ3NWQ5YjI0IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfdW5jb3JlLmgKPiBAQCAtMTI2LDYgKzEyNiw3IEBAIHN0cnVjdCBpbnRlbF91bmNvcmUg
ewo+ICAgICAgICAgZW51bSBmb3JjZXdha2VfZG9tYWlucyBmd19kb21haW5zX3NhdmVkOyAvKiB1
c2VyIGRvbWFpbnMgc2F2ZWQgZm9yIFMzICovCj4gIAo+ICAgICAgICAgc3RydWN0IGludGVsX3Vu
Y29yZV9mb3JjZXdha2VfZG9tYWluIHsKPiArICAgICAgICAgICAgICAgc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlOwo+ICAgICAgICAgICAgICAgICBlbnVtIGZvcmNld2FrZV9kb21haW5faWQg
aWQ7Cj4gICAgICAgICAgICAgICAgIGVudW0gZm9yY2V3YWtlX2RvbWFpbnMgbWFzazsKPiAgICAg
ICAgICAgICAgICAgdW5zaWduZWQgaW50IHdha2VfY291bnQ7Cj4gQEAgLTEzMyw3ICsxMzQsNyBA
QCBzdHJ1Y3QgaW50ZWxfdW5jb3JlIHsKPiAgICAgICAgICAgICAgICAgc3RydWN0IGhydGltZXIg
dGltZXI7Cj4gICAgICAgICAgICAgICAgIHUzMiBfX2lvbWVtICpyZWdfc2V0Owo+ICAgICAgICAg
ICAgICAgICB1MzIgX19pb21lbSAqcmVnX2FjazsKPiAtICAgICAgIH0gZndfZG9tYWluW0ZXX0RP
TUFJTl9JRF9DT1VOVF07Cj4gKyAgICAgICB9ICpmd19kb21haW5bRldfRE9NQUlOX0lEX0NPVU5U
XTsKCkhvdyBsb25nIGJlZm9yZSB3ZSBzdGFydCB1c2luZyBhIHRyZWUgZm9yIHRoZSBjb3VudGxl
c3MgZG9tYWlucyA6KQoKPiAgCj4gICAgICAgICBzdHJ1Y3Qgewo+ICAgICAgICAgICAgICAgICB1
bnNpZ25lZCBpbnQgY291bnQ7Cj4gQEAgLTE0NywxOCArMTQ4LDEyIEBAIHN0cnVjdCBpbnRlbF91
bmNvcmUgewo+ICAKPiAgLyogSXRlcmF0ZSBvdmVyIGluaXRpYWxpc2VkIGZ3IGRvbWFpbnMgKi8K
PiAgI2RlZmluZSBmb3JfZWFjaF9md19kb21haW5fbWFza2VkKGRvbWFpbl9fLCBtYXNrX18sIHVu
Y29yZV9fLCB0bXBfXykgXAo+IC0gICAgICAgZm9yICh0bXBfXyA9IChtYXNrX18pOyBcCj4gLSAg
ICAgICAgICAgIHRtcF9fID8gKGRvbWFpbl9fID0gJih1bmNvcmVfXyktPmZ3X2RvbWFpbltfX21h
c2tfbmV4dF9iaXQodG1wX18pXSksIDEgOiAwOykKPiArICAgICAgIGZvciAodG1wX18gPSAobWFz
a19fKTsgdG1wX18gOykgXAo+ICsgICAgICAgICAgICAgICBmb3JfZWFjaF9pZihkb21haW5fXyA9
ICh1bmNvcmVfXyktPmZ3X2RvbWFpbltfX21hc2tfbmV4dF9iaXQodG1wX18pXSkKPiAgCj4gICNk
ZWZpbmUgZm9yX2VhY2hfZndfZG9tYWluKGRvbWFpbl9fLCB1bmNvcmVfXywgdG1wX18pIFwKPiAg
ICAgICAgIGZvcl9lYWNoX2Z3X2RvbWFpbl9tYXNrZWQoZG9tYWluX18sICh1bmNvcmVfXyktPmZ3
X2RvbWFpbnMsIHVuY29yZV9fLCB0bXBfXykKPiAgCj4gLXN0YXRpYyBpbmxpbmUgc3RydWN0IGlu
dGVsX3VuY29yZSAqCj4gLWZvcmNld2FrZV9kb21haW5fdG9fdW5jb3JlKGNvbnN0IHN0cnVjdCBp
bnRlbF91bmNvcmVfZm9yY2V3YWtlX2RvbWFpbiAqZCkKPiAtewo+IC0gICAgICAgcmV0dXJuIGNv
bnRhaW5lcl9vZihkLCBzdHJ1Y3QgaW50ZWxfdW5jb3JlLCBmd19kb21haW5bZC0+aWRdKTsKPiAt
fQo+IC0KPiAgc3RhdGljIGlubGluZSBib29sCj4gIGludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtl
KGNvbnN0IHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKPiAgewoKUmV2aWV3ZWQtYnk6IENo
cmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotQ2hyaXMKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

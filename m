Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2E5CECB943
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 13:35:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AE8B76EB49;
	Fri,  4 Oct 2019 11:35:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 13D6A6EB34
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 11:35:22 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 13:34:58 +0200
Message-Id: <20191004113514.17064-9-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
References: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/24] drm/i915: Prepare to split crtc state in
 uapi and hw state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugd2FudCB0byBzcGxpdCBkcm1fY3J0Y19zdGF0ZSBpbnRvIHRoZSB1c2VyIHZpc2libGUgc3Rh
dGUKYW5kIGFjdHVhbCBoYXJkd2FyZSBzdGF0ZS4gVG8gcHJlcGFyZSBmb3IgdGhpcywgd2UgbmVl
ZCBzb21lCmdyb3VuZCBydWxlcyB3aGF0IHNob3VsZCBiZSBpbiBlYWNoIHN0YXRlOgoKSW4gdWFw
aSB3ZSB1c2U6Ci0gY3J0YywgKl9jaGFuZ2VkIGZsYWdzLCBldmVudCwgY29tbWl0LCBzdGF0ZSwg
bW9kZV9ibG9iLAogIChwbGFuZS9jb25uZWN0b3IvZW5jb2RlcilfbWFzay4KCkluIGh3IHN0YXRl
IHdlIHVzZSB3aGF0J3MgZGlzcGxheWVkIGluIGhhcmR3YXJlOgotIGVuYWJsZSwgYWN0aXZlLCAo
YWRqdXN0ZWQpIG1vZGUsIGNvbG9yIHByb3BlcnR5IGJsb2JzLgoKY2xlYXJfaW50ZWxfY3J0Y19z
dGF0ZSBhbmQgaHcgcmVhZG91dCBuZWVkIHRvIGJlIHVwZGF0ZWQgZm9yIHRoZXNlIHJ1bGVzLAp3
aGljaCB3aWxsIGFsbG93IHVzIHRvIGVuYWJsZSAyIGpvaW5lZCBwaXBlcy4KCk5vdGU6Ci0gV2hl
biBtYWtpbmcgY2FsbGluZyBhdG9taWNfY29tbWl0KCkgeW91IG5lZWQgdG8gbWFuaXB1bGF0ZSB0
aGUgdWFwaQogIHZhcmlhYmxlcywgYXRvbWljX2NoZWNrKCkgd2lsbCBjb3B5IGl0IHRvIGh3LiBU
aGlzIGlzIGJlY2F1c2UgeW91J3JlCiAganVzdCBhbm90aGVyIGF0b21pYyBjbGllbnQuIE9mIGNv
dXJzZSB5b3UgY2FuIHN0aWxsIGNoZWNrIGh3IG1lbWJlcnMKICBhdCB0aGF0IHBvaW50IHRvIGRl
Y2lkZSBpZiBhIHBpcGUgaXMgYWN0aXZlLgotIEluIGdlbmVyYWwgeW91IHNob3VsZCBsb29rIGF0
IHRoZSBodyBtZW1iZXJzIHdoZW4gYXZhaWxhYmxlLCB1bmxlc3MKICB0aGVyZSdzIGEgZ29vZCBy
ZWFzb24gdG8gZG8gc29tZXRoaW5nIGVsc2UuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmto
b3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogTWF0
dCBSb3BlciA8bWF0dGhldy5kLnJvcGVyQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ljbF9kc2kuYyAgICAgICAgfCAgMTggKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMgICB8ICAxNCArLQogLi4uL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2F1ZGlvLmMgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfYncuYyAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9jZGNsay5jICAgIHwgIDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2NvbG9yLmMgICAgfCAxODAgKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2NydC5jICAgICAgfCAgMjQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGRpLmMgICAgICB8ICAzNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgNTQ0ICsrKysrKysrKy0tLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggIHwgICA2ICstCiAuLi4vZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMjggKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyAgICAgICB8ICA0MiArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyAgIHwgICA2ICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmMgfCAgMTQgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBsbF9tZ3IuYyB8ICAyMCArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kdm8uYyAgICAgIHwgIDE0ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jICAgICB8ICA2NCArLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHNwY29uLmMgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9sdmRzLmMgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMgICAgfCAgMTQgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfcGlwZV9jcmMuYyB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9wc3IuYyAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Nkdm8uYyAgICAgfCAgMjIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgICB8ICAyNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF90di5jICAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Zkc2MuYyAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvdmx2X2RzaS5jICAgICAgICB8ICAyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgIDE0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9wbS5jICAgICAgICAgICAgICAgfCAxNzAgKysrLS0tCiAzMSBmaWxlcyBjaGFuZ2VkLCA3MDAg
aW5zZXJ0aW9ucygrKSwgNjY1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pY2xfZHNpLmMKaW5kZXggNmUzOThjMzNhNTI0Li4wZTI0YjhlMjU3ZTUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jCkBAIC0yNzYsNyArMjc2LDcgQEAgc3RhdGljIHZv
aWQgY29uZmlndXJlX2R1YWxfbGlua19tb2RlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCiAJaWYgKGludGVsX2RzaS0+ZHVhbF9saW5rID09IERTSV9EVUFMX0xJTktfRlJPTlRfQkFD
SykgewogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0J
CQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJCQkmcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGU7CiAJCXUzMiBkc3NfY3RsMjsKIAkJdTE2IGhhY3RpdmUgPSBhZGp1
c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5OwogCQl1MTYgZGxfYnVmZmVyX2RlcHRoOwpAQCAtNjI1
LDcgKzYyNSw3IEBAIGdlbjExX2RzaV9jb25maWd1cmVfdHJhbnNjb2RlcihzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9k
c2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJ
c3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmln
LT51YXBpLmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gaW50ZWxfY3J0Yy0+cGlwZTsKIAl1MzIg
dG1wOwogCWVudW0gcG9ydCBwb3J0OwpAQCAtNzY4LDcgKzc2OCw3IEBAIGdlbjExX2RzaV9zZXRf
dHJhbnNjb2Rlcl90aW1pbmdzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYp
OwogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19pbnRlbF9kc2koJmVuY29k
ZXItPmJhc2UpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2Rl
ID0KLQkJCQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCQkJCSZwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAllbnVtIHBvcnQgcG9ydDsKIAllbnVtIHRyYW5zY29k
ZXIgZHNpX3RyYW5zOwogCS8qIGhvcml6b250YWwgdGltaW5ncyAqLwpAQCAtMTIxNiw3ICsxMjE2
LDcgQEAgc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dldF90aW1pbmdzKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2RzaSA9IGVuY190b19p
bnRlbF9kc2koJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0KLQkJCQkJJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCQkJ
CSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCWlmIChpbnRlbF9kc2ktPmR1YWxf
bGluaykgewogCQlhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5ICo9IDI7CkBAIC0xMjQyLDE2
ICsxMjQyLDE2IEBAIHN0YXRpYyB2b2lkIGdlbjExX2RzaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNp
ICppbnRlbF9kc2kgPSBlbmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAogCS8qIEZJ
WE1FOiBhZGFwdCBpY2xfZGRpX2Nsb2NrX2dldCgpIGZvciBEU0kgYW5kIHVzZSB0aGF0PyAqLwog
CXBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrID0KIAkJY25sX2NhbGNfd3JwbGxfbGluayhkZXZfcHJp
diwgJnBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlKTsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFk
anVzdGVkX21vZGUuY3J0Y19jbG9jayA9IGludGVsX2RzaS0+cGNsazsKKwlwaXBlX2NvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gaW50ZWxfZHNpLT5wY2xrOwogCWlmIChpbnRl
bF9kc2ktPmR1YWxfbGluaykKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRj
X2Nsb2NrICo9IDI7CisJCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sg
Kj0gMjsKIAogCWdlbjExX2RzaV9nZXRfdGltaW5ncyhlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CiAJ
cGlwZV9jb25maWctPm91dHB1dF90eXBlcyB8PSBCSVQoSU5URUxfT1VUUFVUX0RTSSk7CkBAIC0x
MjY1LDExICsxMjY1LDExIEBAIHN0YXRpYyBpbnQgZ2VuMTFfZHNpX2NvbXB1dGVfY29uZmlnKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBpbnRlbF9kc2kgKmludGVsX2Rz
aSA9IGNvbnRhaW5lcl9vZihlbmNvZGVyLCBzdHJ1Y3QgaW50ZWxfZHNpLAogCQkJCQkJICAgYmFz
ZSk7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yID0gaW50ZWxfZHNp
LT5hdHRhY2hlZF9jb25uZWN0b3I7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqZml4ZWRfbW9kZSA9CiAJCQkJCWludGVsX2Nvbm5lY3Rvci0+cGFu
ZWwuZml4ZWRfbW9kZTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
Ci0JCQkJCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJCQkmcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlwaXBlX2NvbmZpZy0+b3V0cHV0X2Zvcm1hdCA9IElO
VEVMX09VVFBVVF9GT1JNQVRfUkdCOwogCWludGVsX2ZpeGVkX3BhbmVsX21vZGUoZml4ZWRfbW9k
ZSwgYWRqdXN0ZWRfbW9kZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9h
dG9taWMuYwppbmRleCBlNmNiODVkNDFjOGQuLjdjZjEzYjljN2QzOCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0xODYsMTMgKzE4NiwxNCBAQCBp
bnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9jb25uZWN0
b3IgKmNvbm5lY3RvcikKIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqCiBpbnRlbF9jcnRjX2R1cGxp
Y2F0ZV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCiB7CisJY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5z
dGF0ZSk7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CiAKLQljcnRjX3N0
YXRlID0ga21lbWR1cChjcnRjLT5zdGF0ZSwgc2l6ZW9mKCpjcnRjX3N0YXRlKSwgR0ZQX0tFUk5F
TCk7CisJY3J0Y19zdGF0ZSA9IGttZW1kdXAob2xkX2NydGNfc3RhdGUsIHNpemVvZigqY3J0Y19z
dGF0ZSksIEdGUF9LRVJORUwpOwogCWlmICghY3J0Y19zdGF0ZSkKIAkJcmV0dXJuIE5VTEw7CiAK
LQlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfZHVwbGljYXRlX3N0YXRlKGNydGMsICZjcnRjX3N0
YXRlLT5iYXNlKTsKKwlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfZHVwbGljYXRlX3N0YXRlKGNy
dGMsICZjcnRjX3N0YXRlLT51YXBpKTsKIAogCWNydGNfc3RhdGUtPnVwZGF0ZV9waXBlID0gZmFs
c2U7CiAJY3J0Y19zdGF0ZS0+ZGlzYWJsZV9scF93bSA9IGZhbHNlOwpAQCAtMjA0LDcgKzIwNSw3
IEBAIGludGVsX2NydGNfZHVwbGljYXRlX3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YykKIAlj
cnRjX3N0YXRlLT5mYl9iaXRzID0gMDsKIAljcnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzID0gMDsK
IAotCXJldHVybiAmY3J0Y19zdGF0ZS0+YmFzZTsKKwlyZXR1cm4gJmNydGNfc3RhdGUtPnVhcGk7
CiB9CiAKIC8qKgpAQCAtMjE5LDcgKzIyMCwxMCBAQCB2b2lkCiBpbnRlbF9jcnRjX2Rlc3Ryb3lf
c3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCQkJIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAq
c3RhdGUpCiB7Ci0JZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0YXRlKGNydGMsIHN0
YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2Ny
dGNfc3RhdGUoc3RhdGUpOworCisJX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX2Rlc3Ryb3lfc3Rh
dGUoJmNydGNfc3RhdGUtPnVhcGkpOworCWtmcmVlKGNydGNfc3RhdGUpOwogfQogCiBzdGF0aWMg
dm9pZCBpbnRlbF9hdG9taWNfc2V0dXBfc2NhbGVyKHN0cnVjdCBpbnRlbF9jcnRjX3NjYWxlcl9z
dGF0ZSAqc2NhbGVyX3N0YXRlLApAQCAtMzE1LDcgKzMxOSw3IEBAIGludCBpbnRlbF9hdG9taWNf
c2V0dXBfc2NhbGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB7CiAJc3Ry
dWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUgPQogCQkmY3J0Y19zdGF0
ZS0+c2NhbGVyX3N0YXRlOwotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpkcm1fc3RhdGUgPSBj
cnRjX3N0YXRlLT5iYXNlLnN0YXRlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpkcm1fc3Rh
dGUgPSBjcnRjX3N0YXRlLT51YXBpLnN0YXRlOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKGRybV9zdGF0ZSk7CiAJaW50IG51bV9zY2Fs
ZXJzX25lZWQ7CiAJaW50IGk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pY19wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9hdG9taWNfcGxhbmUuYwppbmRleCA0ZWFhYjBkZTk4YmYuLmNhODIxNjdkNGNlMyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5j
CkBAIC0yNzEsNyArMjcxLDcgQEAgdm9pZCBpbnRlbF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSwKIAkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFz
ZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjKTsKIAogCXRyYWNlX2ludGVsX3VwZGF0ZV9wbGFuZSgmcGxhbmUtPmJh
c2UsIGNydGMpOwogCXBsYW5lLT51cGRhdGVfcGxhbmUocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5l
X3N0YXRlKTsKQEAgLTI4MSw3ICsyODEsNyBAQCB2b2lkIGludGVsX3VwZGF0ZV9zbGF2ZShzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCiAJdHJhY2VfaW50ZWxfdXBkYXRlX3BsYW5lKCZw
bGFuZS0+YmFzZSwgY3J0Yyk7CiAJcGxhbmUtPnVwZGF0ZV9zbGF2ZShwbGFuZSwgY3J0Y19zdGF0
ZSwgcGxhbmVfc3RhdGUpOwpAQCAtMjkwLDcgKzI5MCw3IEBAIHZvaWQgaW50ZWxfdXBkYXRlX3Ns
YXZlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiB2b2lkIGludGVsX2Rpc2FibGVfcGxhbmUo
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAogCXRyYWNlX2ludGVsX2Rp
c2FibGVfcGxhbmUoJnBsYW5lLT5iYXNlLCBjcnRjKTsKIAlwbGFuZS0+ZGlzYWJsZV9wbGFuZShw
bGFuZSwgY3J0Y19zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F1ZGlvLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F1
ZGlvLmMKaW5kZXggNTQ2MzhkOTllMDIxLi4xOWIyYWY0YjlmODEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2F1ZGlvLmMKQEAgLTIzMyw3ICsyMzMsNyBAQCBzdGF0aWMg
Y29uc3Qgc3RydWN0IGhkbWlfYXVkX25jdHMgaGRtaV9hdWRfbmN0c18zNmJwcFtdID0gewogc3Rh
dGljIHUzMiBhdWRpb19jb25maWdfaGRtaV9waXhlbF9jbG9jayhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
CSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWludCBpOwogCiAJZm9yIChpID0gMDsg
aSA8IEFSUkFZX1NJWkUoaGRtaV9hdWRpb19jbG9jayk7IGkrKykgewpAQCAtNTU0LDcgKzU1NCw3
IEBAIHN0YXRpYyB2b2lkIGlsa19hdWRpb19jb2RlY19kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAq
b2xkX2Nvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAll
bnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5w
b3J0OwogCXUzMiB0bXAsIGVsZHY7CkBAIC02MDEsNyArNjAxLDcgQEAgc3RhdGljIHZvaWQgaWxr
X2F1ZGlvX2NvZGVjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkg
ICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0g
Y29ubl9zdGF0ZS0+Y29ubmVjdG9yOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAll
bnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CkBAIC02OTEsMTAgKzY5MSwxMCBAQCB2b2lk
IGludGVsX2F1ZGlvX2NvZGVjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaTkxNV9hdWRpb19jb21wb25lbnQgKmFjb21wID0gZGV2X3By
aXYtPmF1ZGlvX2NvbXBvbmVudDsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yID0gY29ubl9zdGF0ZS0+Y29ubmVjdG9yOwogCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRq
dXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJZW51bSBwb3J0
IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIApA
QCAtNzUyLDcgKzc1Miw3IEBAIHZvaWQgaW50ZWxfYXVkaW9fY29kZWNfZGlzYWJsZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaTkxNV9hdWRpb19j
b21wb25lbnQgKmFjb21wID0gZGV2X3ByaXYtPmF1ZGlvX2NvbXBvbmVudDsKLQlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7
CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRl
LT51YXBpLmNydGMpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAllbnVtIHBp
cGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfYncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
YncuYwppbmRleCAyMmU4M2Y4NTdkZTguLjNmNmUyOWY2MTMyMyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfYncuYwpAQCAtMjk3LDcgKzI5Nyw3IEBAIHN0YXRpYyB1bnNpZ25l
ZCBpbnQgaW50ZWxfYndfY3J0Y19udW1fYWN0aXZlX3BsYW5lcyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0CiAKIHN0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfYndfY3J0Y19kYXRhX3JhdGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7CiAJdW5zaWduZWQgaW50IGRhdGFfcmF0ZSA9IDA7CiAJZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZDsKIApAQCAtMzE4LDcgKzMxOCw3IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfYndf
Y3J0Y19kYXRhX3JhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfCiB2b2lk
IGludGVsX2J3X2NydGNfdXBkYXRlKHN0cnVjdCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGUsCiAJ
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMp
OworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51
YXBpLmNydGMpOwogCiAJYndfc3RhdGUtPmRhdGFfcmF0ZVtjcnRjLT5waXBlXSA9CiAJCWludGVs
X2J3X2NydGNfZGF0YV9yYXRlKGNydGNfc3RhdGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9jZGNsay5jCmluZGV4IDQyYmQwMjYzOGQzMi4uZTdlOTUyZjBlYWMwIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5jCkBAIC0xOTE3LDEwICsx
OTE3LDEwIEBAIHN0YXRpYyBpbnQgaW50ZWxfcGl4ZWxfcmF0ZV90b19jZGNsayhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiBpbnQgaW50ZWxfY3J0Y19jb21wdXRlX21pbl9jZGNs
ayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yy0+ZGV2KTsKKwkJdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJaW50
IG1pbl9jZGNsazsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJaWYgKCFjcnRj
X3N0YXRlLT5ody5lbmFibGUpCiAJCXJldHVybiAwOwogCiAJbWluX2NkY2xrID0gaW50ZWxfcGl4
ZWxfcmF0ZV90b19jZGNsayhkZXZfcHJpdiwgY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSk7CkBAIC0y
MDQzLDcgKzIwNDMsNyBAQCBzdGF0aWMgdTggYnh0X2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJICAgICAgIHNpemVvZihzdGF0ZS0+
bWluX3ZvbHRhZ2VfbGV2ZWwpKTsKIAogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0YXRl
KHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7Ci0JCWlmIChjcnRjX3N0YXRlLT5iYXNlLmVu
YWJsZSkKKwkJaWYgKGNydGNfc3RhdGUtPmh3LmVuYWJsZSkKIAkJCXN0YXRlLT5taW5fdm9sdGFn
ZV9sZXZlbFtpXSA9CiAJCQkJY3J0Y19zdGF0ZS0+bWluX3ZvbHRhZ2VfbGV2ZWw7CiAJCWVsc2UK
QEAgLTIxMjksNyArMjEyOSw3IEBAIHN0YXRpYyBpbnQgc2tsX2RwbGwwX3ZjbyhzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJdmNvID0gZGV2X3ByaXYtPnNrbF9wcmVmZXJyZWRf
dmNvX2ZyZXE7CiAKIAlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0
YywgY3J0Y19zdGF0ZSwgaSkgewotCQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCQlp
ZiAoIWNydGNfc3RhdGUtPmh3LmVuYWJsZSkKIAkJCWNvbnRpbnVlOwogCiAJCWlmICghaW50ZWxf
Y3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRURQKSkKQEAgLTIyNTYsMTEg
KzIyNTYsMTEgQEAgc3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2FsbF9waXBlcyhzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJaWYgKElTX0VSUihjcnRjX3N0YXRlKSkKIAkJCXJl
dHVybiBQVFJfRVJSKGNydGNfc3RhdGUpOwogCi0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3Rp
dmUgfHwKLQkJICAgIGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZjcnRjX3N0YXRlLT5i
YXNlKSkKKwkJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKKwkJICAgIGRybV9hdG9taWNf
Y3J0Y19uZWVkc19tb2Rlc2V0KCZjcnRjX3N0YXRlLT51YXBpKSkKIAkJCWNvbnRpbnVlOwogCi0J
CWNydGNfc3RhdGUtPmJhc2UubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKwkJY3J0Y19zdGF0ZS0+dWFw
aS5tb2RlX2NoYW5nZWQgPSB0cnVlOwogCiAJCXJldCA9IGRybV9hdG9taWNfYWRkX2FmZmVjdGVk
X2Nvbm5lY3RvcnMoJnN0YXRlLT5iYXNlLAogCQkJCQkJCSAmY3J0Yy0+YmFzZSk7CkBAIC0yMzEz
LDcgKzIzMTMsNyBAQCBpbnQgaW50ZWxfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlKQogCQljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2
X3ByaXYsIHBpcGUpOwogCQljcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19z
dGF0ZShzdGF0ZSwgY3J0Yyk7CiAJCWlmIChjcnRjX3N0YXRlICYmCi0JCSAgICBkcm1fYXRvbWlj
X2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+YmFzZSkpCisJCSAgICBkcm1fYXRvbWlj
X2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSkpCiAJCQlwaXBlID0gSU5WQUxJ
RF9QSVBFOwogCX0gZWxzZSB7CiAJCXBpcGUgPSBJTlZBTElEX1BJUEU7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKaW5kZXggMWUzYTYyM2VhZjgyLi43MDNlNWU3
MGI0ZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29s
b3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKQEAg
LTExNywxMCArMTE3LDEwIEBAIHN0YXRpYyBib29sIGx1dF9pc19sZWdhY3koY29uc3Qgc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpsdXQpCiAKIHN0YXRpYyBib29sIGNydGNfc3RhdGVfaXNfbGVn
YWN5X2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewot
CXJldHVybiAhY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dCAmJgotCQkhY3J0Y19zdGF0ZS0+
YmFzZS5jdG0gJiYKLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgJiYKLQkJbHV0X2lzX2xl
Z2FjeShjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCk7CisJcmV0dXJuICFjcnRjX3N0YXRlLT5o
dy5kZWdhbW1hX2x1dCAmJgorCQkhY3J0Y19zdGF0ZS0+aHcuY3RtICYmCisJCWNydGNfc3RhdGUt
Pmh3LmdhbW1hX2x1dCAmJgorCQlsdXRfaXNfbGVnYWN5KGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1
dCk7CiB9CiAKIC8qCkBAIC0yMDUsNyArMjA1LDcgQEAgc3RhdGljIHZvaWQgaWNsX3VwZGF0ZV9v
dXRwdXRfY3NjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMgYm9vbCBpbGtfY3Nj
X2xpbWl0ZWRfcmFuZ2UoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0
YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAkvKgogCSAqIEZJWE1F
IGlmIHRoZXJlJ3MgYSBnYW1tYSBMVVQgYWZ0ZXIgdGhlIENTQywgd2Ugc2hvdWxkCkBAIC0yMTks
NyArMjE5LDcgQEAgc3RhdGljIGJvb2wgaWxrX2NzY19saW1pdGVkX3JhbmdlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHZvaWQgaWxrX2NzY19jb252
ZXJ0X2N0bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQl1
MTYgY29lZmZzWzldKQogewotCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfY3RtICpjdG0gPSBjcnRj
X3N0YXRlLT5iYXNlLmN0bS0+ZGF0YTsKKwljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2N0bSAqY3Rt
ID0gY3J0Y19zdGF0ZS0+aHcuY3RtLT5kYXRhOwogCWNvbnN0IHU2NCAqaW5wdXQ7CiAJdTY0IHRl
bXBbOV07CiAJaW50IGk7CkBAIC0yNzAsMTEgKzI3MCwxMSBAQCBzdGF0aWMgdm9pZCBpbGtfY3Nj
X2NvbnZlcnRfY3RtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CiBzdGF0aWMgdm9pZCBpbGtfbG9hZF9jc2NfbWF0cml4KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWJvb2wgbGlt
aXRlZF9jb2xvcl9yYW5nZSA9IGlsa19jc2NfbGltaXRlZF9yYW5nZShjcnRjX3N0YXRlKTsKIAot
CWlmIChjcnRjX3N0YXRlLT5iYXNlLmN0bSkgeworCWlmIChjcnRjX3N0YXRlLT5ody5jdG0pIHsK
IAkJdTE2IGNvZWZmWzldOwogCiAJCWlsa19jc2NfY29udmVydF9jdG0oY3J0Y19zdGF0ZSwgY29l
ZmYpOwpAQCAtMzA5LDEwICszMDksMTAgQEAgc3RhdGljIHZvaWQgaWxrX2xvYWRfY3NjX21hdHJp
eChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogc3RhdGljIHZv
aWQgaWNsX2xvYWRfY3NjX21hdHJpeChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAotCWlmIChjcnRjX3N0YXRlLT5i
YXNlLmN0bSkgeworCWlmIChjcnRjX3N0YXRlLT5ody5jdG0pIHsKIAkJdTE2IGNvZWZmWzldOwog
CiAJCWlsa19jc2NfY29udmVydF9jdG0oY3J0Y19zdGF0ZSwgY29lZmYpOwpAQCAtMzM4LDEyICsz
MzgsMTIgQEAgc3RhdGljIHZvaWQgaWNsX2xvYWRfY3NjX21hdHJpeChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKICAqLwogc3RhdGljIHZvaWQgY2hlcnJ5dmlld19s
b2FkX2NzY19tYXRyaXgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBl
OwogCi0JaWYgKGNydGNfc3RhdGUtPmJhc2UuY3RtKSB7Ci0JCWNvbnN0IHN0cnVjdCBkcm1fY29s
b3JfY3RtICpjdG0gPSBjcnRjX3N0YXRlLT5iYXNlLmN0bS0+ZGF0YTsKKwlpZiAoY3J0Y19zdGF0
ZS0+aHcuY3RtKSB7CisJCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfY3RtICpjdG0gPSBjcnRjX3N0
YXRlLT5ody5jdG0tPmRhdGE7CiAJCXUxNiBjb2VmZnNbOV0gPSB7fTsKIAkJaW50IGk7CiAKQEAg
LTQwNCw3ICs0MDQsNyBAQCBzdGF0aWMgdTMyIGlsa19sdXRfMTAoY29uc3Qgc3RydWN0IGRybV9j
b2xvcl9sdXQgKmNvbG9yKQogc3RhdGljIHZvaWQgaTl4eF9sb2FkX2x1dHNfaW50ZXJuYWwoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgIGNvbnN0IHN0
cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxvYikKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
IAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJaW50IGk7CkBAIC00MzUsMTIgKzQzNSwx
MiBAQCBzdGF0aWMgdm9pZCBpOXh4X2xvYWRfbHV0c19pbnRlcm5hbChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIHZvaWQgaTl4eF9sb2FkX2x1dHMo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0JaTl4eF9sb2Fk
X2x1dHNfaW50ZXJuYWwoY3J0Y19zdGF0ZSwgY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQpOwor
CWk5eHhfbG9hZF9sdXRzX2ludGVybmFsKGNydGNfc3RhdGUsIGNydGNfc3RhdGUtPmh3LmdhbW1h
X2x1dCk7CiB9CiAKIHN0YXRpYyB2b2lkIGk5eHhfY29sb3JfY29tbWl0KGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwog
CWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgdmFsOwpAQCAtNDUzLDcgKzQ1Myw3
IEBAIHN0YXRpYyB2b2lkIGk5eHhfY29sb3JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgdm9pZCBpbGtfY29sb3JfY29tbWl0KGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgdmFsOwpAQCAtNDY4
LDcgKzQ2OCw3IEBAIHN0YXRpYyB2b2lkIGlsa19jb2xvcl9jb21taXQoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lkIGhzd19jb2xvcl9jb21t
aXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7
CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVh
cGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjLT5iYXNlLmRldik7CiAKIAlJOTE1X1dSSVRFKEdBTU1BX01PREUoY3J0Yy0+cGlwZSksIGNy
dGNfc3RhdGUtPmdhbW1hX21vZGUpOwpAQCAtNDc4LDcgKzQ3OCw3IEBAIHN0YXRpYyB2b2lkIGhz
d19jb2xvcl9jb21taXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiAKIHN0YXRpYyB2b2lkIHNrbF9jb2xvcl9jb21taXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBl
IHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiB2YWwgPSAwOwpAQCAtNTI0LDggKzUyNCw4IEBAIHN0
YXRpYyB2b2lkIGk5NjVfbG9hZF9sdXRfMTBwNihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAog
c3RhdGljIHZvaWQgaTk2NV9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9i
ICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwljb25z
dCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3Lmdh
bW1hX2x1dDsKIAogCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlID09IEdBTU1BX01PREVfTU9E
RV84QklUKQogCQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0YXRlKTsKQEAgLTU0Nyw4ICs1NDcsOCBA
QCBzdGF0aWMgdm9pZCBpbGtfbG9hZF9sdXRfMTAoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAK
IHN0YXRpYyB2b2lkIGlsa19sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9i
ICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwljb25z
dCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3Lmdh
bW1hX2x1dDsKIAogCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlID09IEdBTU1BX01PREVfTU9E
RV84QklUKQogCQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0YXRlKTsKQEAgLTY1NCw5ICs2NTQsOSBA
QCBzdGF0aWMgdm9pZCBpdmJfbG9hZF9sdXRfZXh0X21heChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YykKIAogc3RhdGljIHZvaWQgaXZiX2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5
X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OwotCWNvbnN0IHN0
cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZGVnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmRl
Z2FtbWFfbHV0OworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT51YXBpLmNydGMpOworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2Ft
bWFfbHV0ID0gY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0OworCWNvbnN0IHN0cnVjdCBkcm1fcHJv
cGVydHlfYmxvYiAqZGVnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dDsKIAog
CWlmIChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlID09IEdBTU1BX01PREVfTU9ERV84QklUKSB7CiAJ
CWk5eHhfbG9hZF9sdXRzKGNydGNfc3RhdGUpOwpAQCAtNjc3LDkgKzY3Nyw5IEBAIHN0YXRpYyB2
b2lkIGl2Yl9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCiAKIHN0YXRpYyB2b2lkIGJkd19sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0
eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dDsKLQljb25zdCBz
dHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5k
ZWdhbW1hX2x1dDsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdh
bW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKKwljb25zdCBzdHJ1Y3QgZHJtX3By
b3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0ID0gY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQ7CiAK
IAlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkgewog
CQlpOXh4X2xvYWRfbHV0cyhjcnRjX3N0YXRlKTsKQEAgLTcwMCwxMSArNzAwLDExIEBAIHN0YXRp
YyB2b2lkIGJkd19sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiAKIHN0YXRpYyB2b2lkIGdsa19sb2FkX2RlZ2FtbWFfbHV0KGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwog
CWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAljb25zdCB1MzIgbHV0X3NpemUgPSBJTlRF
TF9JTkZPKGRldl9wcml2KS0+Y29sb3IuZGVnYW1tYV9sdXRfc2l6ZTsKLQljb25zdCBzdHJ1Y3Qg
ZHJtX2NvbG9yX2x1dCAqbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5kZWdhbW1hX2x1dC0+ZGF0YTsK
Kwljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0ID0gY3J0Y19zdGF0ZS0+aHcuZGVnYW1t
YV9sdXQtPmRhdGE7CiAJdTMyIGk7CiAKIAkvKgpAQCAtNzM5LDcgKzczOSw3IEBAIHN0YXRpYyB2
b2lkIGdsa19sb2FkX2RlZ2FtbWFfbHV0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogCiBzdGF0aWMgdm9pZCBnbGtfbG9hZF9kZWdhbW1hX2x1dF9saW5lYXIoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWNvbnN0IHUzMiBsdXRf
c2l6ZSA9IElOVEVMX0lORk8oZGV2X3ByaXYpLT5jb2xvci5kZWdhbW1hX2x1dF9zaXplOwpAQCAt
NzY2LDggKzc2Niw4IEBAIHN0YXRpYyB2b2lkIGdsa19sb2FkX2RlZ2FtbWFfbHV0X2xpbmVhcihj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0CiAKIHN0YXRpYyB2b2lkIGds
a19sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRl
LT5iYXNlLmdhbW1hX2x1dDsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Js
b2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAogCS8q
CiAJICogT24gR0xLKyBib3RoIHBpcGUgQ1NDIGFuZCBkZWdhbW1hIExVVCBhcmUgY29udHJvbGxl
ZApAQCAtNzc3LDcgKzc3Nyw3IEBAIHN0YXRpYyB2b2lkIGdsa19sb2FkX2x1dHMoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICogdGhlIGRlZ2FtYSBMVVQgc28g
dGhhdCB3ZSBkb24ndCBoYXZlIHRvIHJlbG9hZAogCSAqIGl0IGV2ZXJ5IHRpbWUgdGhlIHBpcGUg
Q1NDIGlzIGJlaW5nIGVuYWJsZWQuCiAJICovCi0JaWYgKGNydGNfc3RhdGUtPmJhc2UuZGVnYW1t
YV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQlnbGtfbG9hZF9kZWdh
bW1hX2x1dChjcnRjX3N0YXRlKTsKIAllbHNlCiAJCWdsa19sb2FkX2RlZ2FtbWFfbHV0X2xpbmVh
cihjcnRjX3N0YXRlKTsKQEAgLTgwOCw3ICs4MDgsNyBAQCBzdGF0aWMgdm9pZAogaWNsX2xvYWRf
Z2NtYXgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICAgICAg
IGNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpjb2xvcikKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
IAlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCWVudW0gcGlw
ZSBwaXBlID0gY3J0Yy0+cGlwZTsKIApAQCAtODIyLDggKzgyMiw4IEBAIGljbF9sb2FkX2djbWF4
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIHZvaWQK
IGljbF9wcm9ncmFtX2dhbW1hX3N1cGVyZmluZV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJv
cGVydHlfYmxvYiAqYmxvYiA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0OworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwor
CWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxvYiA9IGNydGNfc3RhdGUtPmh3Lmdh
bW1hX2x1dDsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0ID0gYmxvYi0+ZGF0YTsK
IAlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCWVudW0gcGlw
ZSBwaXBlID0gY3J0Yy0+cGlwZTsKQEAgLTg1NCw4ICs4NTQsOCBAQCBpY2xfcHJvZ3JhbV9nYW1t
YV9zdXBlcmZpbmVfc2VnbWVudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHN0YXRpYyB2b2lkCiBpY2xfcHJvZ3JhbV9nYW1tYV9tdWx0aV9zZWdtZW50KGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwotCWNvbnN0
IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxvYiA9IGNydGNfc3RhdGUtPmJhc2UuZ2FtbWFf
bHV0OworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT51YXBpLmNydGMpOworCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxvYiA9IGNy
dGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqbHV0
ID0gYmxvYi0+ZGF0YTsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqZW50cnk7CiAJc3Ry
dWN0IGludGVsX2RzYiAqZHNiID0gaW50ZWxfZHNiX2dldChjcnRjKTsKQEAgLTkxMCwxMSArOTEw
LDExIEBAIGljbF9wcm9ncmFtX2dhbW1hX211bHRpX3NlZ21lbnQoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lkIGljbF9sb2FkX2x1dHMoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0
IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1
dDsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9
IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNiICpk
c2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCi0JaWYgKGNydGNfc3RhdGUtPmJhc2UuZGVnYW1t
YV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQlnbGtfbG9hZF9kZWdh
bW1hX2x1dChjcnRjX3N0YXRlKTsKIAogCXN3aXRjaCAoY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSAm
IEdBTU1BX01PREVfTU9ERV9NQVNLKSB7CkBAIC05OTAsOSArOTkwLDkgQEAgc3RhdGljIHZvaWQg
Y2h2X2xvYWRfY2dtX2dhbW1hKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMgdm9p
ZCBjaHZfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2FtbWFfbHV0
ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7Ci0JY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0
eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQ7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0
YXRlLT5ody5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpkZWdh
bW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0OwogCiAJY2hlcnJ5dmlld19sb2Fk
X2NzY19tYXRyaXgoY3J0Y19zdGF0ZSk7CiAKQEAgLTEwMTAsMjggKzEwMTAsMjggQEAgc3RhdGlj
IHZvaWQgY2h2X2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIAogdm9pZCBpbnRlbF9jb2xvcl9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRl
dik7CiAKIAlkZXZfcHJpdi0+ZGlzcGxheS5sb2FkX2x1dHMoY3J0Y19zdGF0ZSk7CiB9CiAKIHZv
aWQgaW50ZWxfY29sb3JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCiAJZGV2X3By
aXYtPmRpc3BsYXkuY29sb3JfY29tbWl0KGNydGNfc3RhdGUpOwogfQogCiBpbnQgaW50ZWxfY29s
b3JfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNy
dGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAlyZXR1cm4gZGV2X3ByaXYtPmRpc3BsYXku
Y29sb3JfY2hlY2soY3J0Y19zdGF0ZSk7CiB9CiAKIHZvaWQgaW50ZWxfY29sb3JfZ2V0X2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3Rh
dGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAogCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5yZWFkX2x1dHMp
CiAJCWRldl9wcml2LT5kaXNwbGF5LnJlYWRfbHV0cyhjcnRjX3N0YXRlKTsKQEAgLTEwNTUsMTYg
KzEwNTUsMTYgQEAgc3RhdGljIGJvb2wgbmVlZF9wbGFuZV91cGRhdGUoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKIHN0YXRpYyBpbnQKIGludGVsX2NvbG9yX2FkZF9hZmZlY3RlZF9wbGFuZXMo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQot
CQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCQl0
b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCWNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9CiAJCWludGVsX2F0b21p
Y19nZXRfb2xkX2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmU7CiAKLQlpZiAoIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSB8fAotCSAgICBkcm1f
YXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPmJhc2UpKQorCWlmICgh
bmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fAorCSAgICBkcm1fYXRvbWljX2NydGNfbmVlZHNf
bW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPnVhcGkpKQogCQlyZXR1cm4gMDsKIAogCWlmIChuZXdf
Y3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlID09IG9sZF9jcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUg
JiYKQEAgLTExMDcsOSArMTEwNyw5IEBAIHN0YXRpYyBpbnQgY2hlY2tfbHV0X3NpemUoY29uc3Qg
c3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpsdXQsIGludCBleHBlY3RlZCkKIAogc3RhdGljIGlu
dCBjaGVja19sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0
ZS0+YmFzZS5jcnRjLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqZ2Ft
bWFfbHV0ID0gY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQ7Ci0JY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQ7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT51YXBpLmNydGMtPmRldik7CisJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpnYW1t
YV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CisJY29uc3Qgc3RydWN0IGRybV9wcm9w
ZXJ0eV9ibG9iICpkZWdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0OwogCWlu
dCBnYW1tYV9sZW5ndGgsIGRlZ2FtbWFfbGVuZ3RoOwogCXUzMiBnYW1tYV90ZXN0cywgZGVnYW1t
YV90ZXN0czsKIApAQCAtMTE1Nyw3ICsxMTU3LDcgQEAgc3RhdGljIGludCBpOXh4X2NvbG9yX2No
ZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlyZXR1cm4gcmV0Owog
CiAJY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlID0KLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9s
dXQgJiYKKwkJY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0ICYmCiAJCSFjcnRjX3N0YXRlLT5jOF9w
bGFuZXM7CiAKIAljcnRjX3N0YXRlLT5nYW1tYV9tb2RlID0gaTl4eF9nYW1tYV9tb2RlKGNydGNf
c3RhdGUpOwpAQCAtMTE3NiwxMSArMTE3NiwxMSBAQCBzdGF0aWMgdTMyIGNodl9jZ21fbW9kZShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoY3J0Y19zdGF0
ZV9pc19sZWdhY3lfZ2FtbWEoY3J0Y19zdGF0ZSkpCiAJCXJldHVybiAwOwogCi0JaWYgKGNydGNf
c3RhdGUtPmJhc2UuZGVnYW1tYV9sdXQpCisJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0
KQogCQljZ21fbW9kZSB8PSBDR01fUElQRV9NT0RFX0RFR0FNTUE7Ci0JaWYgKGNydGNfc3RhdGUt
PmJhc2UuY3RtKQorCWlmIChjcnRjX3N0YXRlLT5ody5jdG0pCiAJCWNnbV9tb2RlIHw9IENHTV9Q
SVBFX01PREVfQ1NDOwotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCkKKwlpZiAoY3J0
Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0KQogCQljZ21fbW9kZSB8PSBDR01fUElQRV9NT0RFX0dBTU1B
OwogCiAJcmV0dXJuIGNnbV9tb2RlOwpAQCAtMTI1NCw3ICsxMjU0LDcgQEAgc3RhdGljIGludCBp
bGtfY29sb3JfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXJl
dHVybiByZXQ7CiAKIAljcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUgPQotCQljcnRjX3N0YXRlLT5i
YXNlLmdhbW1hX2x1dCAmJgorCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgJiYKIAkJIWNydGNf
c3RhdGUtPmM4X3BsYW5lczsKIAogCS8qCkBAIC0xMjgwLDggKzEyODAsOCBAQCBzdGF0aWMgdTMy
IGl2Yl9nYW1tYV9tb2RlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogCWlmICghY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlIHx8CiAJICAgIGNydGNfc3RhdGVfaXNf
bGVnYWN5X2dhbW1hKGNydGNfc3RhdGUpKQogCQlyZXR1cm4gR0FNTUFfTU9ERV9NT0RFXzhCSVQ7
Ci0JZWxzZSBpZiAoY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgJiYKLQkJIGNydGNfc3RhdGUt
PmJhc2UuZGVnYW1tYV9sdXQpCisJZWxzZSBpZiAoY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0ICYm
CisJCSBjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCkKIAkJcmV0dXJuIEdBTU1BX01PREVfTU9E
RV9TUExJVDsKIAllbHNlCiAJCXJldHVybiBHQU1NQV9NT0RFX01PREVfMTBCSVQ7CkBAIC0xMjk1
LDcgKzEyOTUsNyBAQCBzdGF0aWMgdTMyIGl2Yl9jc2NfbW9kZShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKiBDU0MgY29tZXMgYWZ0ZXIgdGhlIExVVCBpbiBk
ZWdhbW1hLCBSR0ItPllDYkNyLAogCSAqIGFuZCBSR0IgZnVsbC0+bGltaXRlZCByYW5nZSBtb2Rl
LgogCSAqLwotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0IHx8CisJaWYgKGNydGNf
c3RhdGUtPmh3LmRlZ2FtbWFfbHV0IHx8CiAJICAgIGNydGNfc3RhdGUtPm91dHB1dF9mb3JtYXQg
IT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9SR0IgfHwKIAkgICAgbGltaXRlZF9jb2xvcl9yYW5nZSkK
IAkJcmV0dXJuIDA7CkBAIC0xMzEzLDEzICsxMzEzLDEzIEBAIHN0YXRpYyBpbnQgaXZiX2NvbG9y
X2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQlyZXR1cm4gcmV0
OwogCiAJY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlID0KLQkJKGNydGNfc3RhdGUtPmJhc2UuZ2Ft
bWFfbHV0IHx8Ci0JCSBjcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0KSAmJgorCQkoY3J0Y19z
dGF0ZS0+aHcuZ2FtbWFfbHV0IHx8CisJCSBjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCkgJiYK
IAkJIWNydGNfc3RhdGUtPmM4X3BsYW5lczsKIAogCWNydGNfc3RhdGUtPmNzY19lbmFibGUgPQog
CQljcnRjX3N0YXRlLT5vdXRwdXRfZm9ybWF0ICE9IElOVEVMX09VVFBVVF9GT1JNQVRfUkdCIHx8
Ci0JCWNydGNfc3RhdGUtPmJhc2UuY3RtIHx8IGxpbWl0ZWRfY29sb3JfcmFuZ2U7CisJCWNydGNf
c3RhdGUtPmh3LmN0bSB8fCBsaW1pdGVkX2NvbG9yX3JhbmdlOwogCiAJY3J0Y19zdGF0ZS0+Z2Ft
bWFfbW9kZSA9IGl2Yl9nYW1tYV9tb2RlKGNydGNfc3RhdGUpOwogCkBAIC0xMzUwLDE0ICsxMzUw
LDE0IEBAIHN0YXRpYyBpbnQgZ2xrX2NvbG9yX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogCQlyZXR1cm4gcmV0OwogCiAJY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxl
ID0KLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgJiYKKwkJY3J0Y19zdGF0ZS0+aHcuZ2Ft
bWFfbHV0ICYmCiAJCSFjcnRjX3N0YXRlLT5jOF9wbGFuZXM7CiAKIAkvKiBPbiBHTEsrIGRlZ2Ft
bWEgTFVUIGlzIGNvbnRyb2xsZWQgYnkgY3NjX2VuYWJsZSAqLwogCWNydGNfc3RhdGUtPmNzY19l
bmFibGUgPQotCQljcnRjX3N0YXRlLT5iYXNlLmRlZ2FtbWFfbHV0IHx8CisJCWNydGNfc3RhdGUt
Pmh3LmRlZ2FtbWFfbHV0IHx8CiAJCWNydGNfc3RhdGUtPm91dHB1dF9mb3JtYXQgIT0gSU5URUxf
T1VUUFVUX0ZPUk1BVF9SR0IgfHwKLQkJY3J0Y19zdGF0ZS0+YmFzZS5jdG0gfHwgY3J0Y19zdGF0
ZS0+bGltaXRlZF9jb2xvcl9yYW5nZTsKKwkJY3J0Y19zdGF0ZS0+aHcuY3RtIHx8IGNydGNfc3Rh
dGUtPmxpbWl0ZWRfY29sb3JfcmFuZ2U7CiAKIAljcnRjX3N0YXRlLT5nYW1tYV9tb2RlID0gZ2xr
X2dhbW1hX21vZGUoY3J0Y19zdGF0ZSk7CiAKQEAgLTEzNzQsMTQgKzEzNzQsMTQgQEAgc3RhdGlj
IHUzMiBpY2xfZ2FtbWFfbW9kZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKIAl1MzIgZ2FtbWFfbW9kZSA9IDA7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5k
ZWdhbW1hX2x1dCkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZGVnYW1tYV9sdXQpCiAJCWdhbW1hX21v
ZGUgfD0gUFJFX0NTQ19HQU1NQV9FTkFCTEU7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5nYW1t
YV9sdXQgJiYKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0ICYmCiAJICAgICFjcnRjX3N0
YXRlLT5jOF9wbGFuZXMpCiAJCWdhbW1hX21vZGUgfD0gUE9TVF9DU0NfR0FNTUFfRU5BQkxFOwog
Ci0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCB8fAorCWlmICghY3J0Y19zdGF0ZS0+
aHcuZ2FtbWFfbHV0IHx8CiAJICAgIGNydGNfc3RhdGVfaXNfbGVnYWN5X2dhbW1hKGNydGNfc3Rh
dGUpKQogCQlnYW1tYV9tb2RlIHw9IEdBTU1BX01PREVfTU9ERV84QklUOwogCWVsc2UKQEAgLTEz
OTQsNyArMTM5NCw3IEBAIHN0YXRpYyB1MzIgaWNsX2NzY19tb2RlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXUzMiBjc2NfbW9kZSA9IDA7CiAKLQlpZiAo
Y3J0Y19zdGF0ZS0+YmFzZS5jdG0pCisJaWYgKGNydGNfc3RhdGUtPmh3LmN0bSkKIAkJY3NjX21v
ZGUgfD0gSUNMX0NTQ19FTkFCTEU7CiAKIAlpZiAoY3J0Y19zdGF0ZS0+b3V0cHV0X2Zvcm1hdCAh
PSBJTlRFTF9PVVRQVVRfRk9STUFUX1JHQiB8fApAQCAtMTQ3MSw3ICsxNDcxLDcgQEAgc3RhdGlj
IGludCBnbGtfZ2FtbWFfcHJlY2lzaW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogCiBpbnQgaW50ZWxfY29sb3JfZ2V0X2dhbW1hX2JpdF9wcmVjaXNpb24oY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAKIAlpZiAoIWNydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSkKQEAgLTE1ODAsNyAr
MTU4MCw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfY29sb3JfbHV0X3BhY2sodTMyIHZhbCwgdTMyIGJp
dF9wcmVjaXNpb24pCiBzdGF0aWMgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICoKIGk5eHhfcmVh
ZF9sdXRfOChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJc3Ry
dWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iOwpAQCAtMTYxNCwxMyArMTYxNCwxMyBAQCBpOXh4
X3JlYWRfbHV0XzgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAK
IHN0YXRpYyB2b2lkIGk5eHhfcmVhZF9sdXRzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewotCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1dF84
KGNydGNfc3RhdGUpOworCWNydGNfc3RhdGUtPnVhcGkuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1
dF84KGNydGNfc3RhdGUpOwogfQogCiBzdGF0aWMgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICoK
IGk5NjVfcmVhZF9sdXRfMTBwNihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIgbHV0X3NpemUgPSBJTlRFTF9J
TkZPKGRldl9wcml2KS0+Y29sb3IuZ2FtbWFfbHV0X3NpemU7CiAJZW51bSBwaXBlIHBpcGUgPSBj
cnRjLT5waXBlOwpAQCAtMTY2MSwxNSArMTY2MSwxNSBAQCBpOTY1X3JlYWRfbHV0XzEwcDYoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0aWMgdm9pZCBpOTY1
X3JlYWRfbHV0cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlpZiAo
Y3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfOEJJVCkKLQkJY3J0Y19z
dGF0ZS0+YmFzZS5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0ZSk7CisJCWNy
dGNfc3RhdGUtPnVhcGkuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1dF84KGNydGNfc3RhdGUpOwog
CWVsc2UKLQkJY3J0Y19zdGF0ZS0+YmFzZS5nYW1tYV9sdXQgPSBpOTY1X3JlYWRfbHV0XzEwcDYo
Y3J0Y19zdGF0ZSk7CisJCWNydGNfc3RhdGUtPnVhcGkuZ2FtbWFfbHV0ID0gaTk2NV9yZWFkX2x1
dF8xMHA2KGNydGNfc3RhdGUpOwogfQogCiBzdGF0aWMgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9i
ICoKIGNodl9yZWFkX2NnbV9sdXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyIGx1dF9zaXplID0gSU5URUxf
SU5GTyhkZXZfcHJpdiktPmNvbG9yLmdhbW1hX2x1dF9zaXplOwogCWVudW0gcGlwZSBwaXBlID0g
Y3J0Yy0+cGlwZTsKQEAgLTE3MDMsMTUgKzE3MDMsMTUgQEAgY2h2X3JlYWRfY2dtX2x1dChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGNodl9y
ZWFkX2x1dHMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJaWYgKGNy
dGNfc3RhdGUtPmdhbW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFXzhCSVQpCi0JCWNydGNfc3Rh
dGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1dF84KGNydGNfc3RhdGUpOworCQljcnRj
X3N0YXRlLT51YXBpLmdhbW1hX2x1dCA9IGk5eHhfcmVhZF9sdXRfOChjcnRjX3N0YXRlKTsKIAll
bHNlCi0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gY2h2X3JlYWRfY2dtX2x1dChjcnRj
X3N0YXRlKTsKKwkJY3J0Y19zdGF0ZS0+dWFwaS5nYW1tYV9sdXQgPSBjaHZfcmVhZF9jZ21fbHV0
KGNydGNfc3RhdGUpOwogfQogCiBzdGF0aWMgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICoKIGls
a19yZWFkX2x1dF8xMChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIgbHV0X3NpemUgPSBJTlRFTF9JTkZPKGRl
dl9wcml2KS0+Y29sb3IuZ2FtbWFfbHV0X3NpemU7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5w
aXBlOwpAQCAtMTc0NCwxNSArMTc0NCwxNSBAQCBpbGtfcmVhZF9sdXRfMTAoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0aWMgdm9pZCBpbGtfcmVhZF9sdXRz
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCWlmIChjcnRjX3N0YXRl
LT5nYW1tYV9tb2RlID09IEdBTU1BX01PREVfTU9ERV84QklUKQotCQljcnRjX3N0YXRlLT5iYXNl
LmdhbW1hX2x1dCA9IGk5eHhfcmVhZF9sdXRfOChjcnRjX3N0YXRlKTsKKwkJY3J0Y19zdGF0ZS0+
dWFwaS5nYW1tYV9sdXQgPSBpOXh4X3JlYWRfbHV0XzgoY3J0Y19zdGF0ZSk7CiAJZWxzZQotCQlj
cnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCA9IGlsa19yZWFkX2x1dF8xMChjcnRjX3N0YXRlKTsK
KwkJY3J0Y19zdGF0ZS0+dWFwaS5nYW1tYV9sdXQgPSBpbGtfcmVhZF9sdXRfMTAoY3J0Y19zdGF0
ZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKgogZ2xrX3JlYWRfbHV0
XzEwKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLCB1MzIgcHJlY19p
bmRleCkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlpbnQgaHdfbHV0X3NpemUgPSBpdmJf
bHV0XzEwX3NpemUocHJlY19pbmRleCk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwpA
QCAtMTc5MCw5ICsxNzkwLDkgQEAgZ2xrX3JlYWRfbHV0XzEwKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLCB1MzIgcHJlY19pbmRleCkKIHN0YXRpYyB2b2lkIGdsa19y
ZWFkX2x1dHMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJaWYgKGNy
dGNfc3RhdGUtPmdhbW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFXzhCSVQpCi0JCWNydGNfc3Rh
dGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1dF84KGNydGNfc3RhdGUpOworCQljcnRj
X3N0YXRlLT51YXBpLmdhbW1hX2x1dCA9IGk5eHhfcmVhZF9sdXRfOChjcnRjX3N0YXRlKTsKIAll
bHNlCi0JCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gZ2xrX3JlYWRfbHV0XzEwKGNydGNf
c3RhdGUsIFBBTF9QUkVDX0lOREVYX1ZBTFVFKDApKTsKKwkJY3J0Y19zdGF0ZS0+dWFwaS5nYW1t
YV9sdXQgPSBnbGtfcmVhZF9sdXRfMTAoY3J0Y19zdGF0ZSwgUEFMX1BSRUNfSU5ERVhfVkFMVUUo
MCkpOwogfQogCiB2b2lkIGludGVsX2NvbG9yX2luaXQoc3RydWN0IGludGVsX2NydGMgKmNydGMp
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnQuYwppbmRleCBmZjYxMjZlYTc5
M2MuLjE2NGFmMTkzNmQzOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9jcnQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Ny
dC5jCkBAIC0xMzIsOSArMTMyLDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0X2dldF9jb25maWco
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJcGlwZV9jb25maWctPm91dHB1dF90
eXBlcyB8PSBCSVQoSU5URUxfT1VUUFVUX0FOQUxPRyk7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5h
ZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGludGVsX2NydF9nZXRfZmxhZ3MoZW5jb2Rlcik7CisJcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gaW50ZWxfY3J0X2dldF9mbGFncyhl
bmNvZGVyKTsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9
IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2Rl
LmNydGNfY2xvY2sgPSBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jazsKIH0KIAogc3RhdGljIHZvaWQg
aHN3X2NydF9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMTQ0
LDEzICsxNDQsMTMgQEAgc3RhdGljIHZvaWQgaHN3X2NydF9nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCiAJaW50ZWxfZGRpX2dldF9jb25maWcoZW5jb2RlciwgcGlw
ZV9jb25maWcpOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyAmPSB+
KERSTV9NT0RFX0ZMQUdfUEhTWU5DIHwKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5m
bGFncyAmPSB+KERSTV9NT0RFX0ZMQUdfUEhTWU5DIHwKIAkJCQkJICAgICAgRFJNX01PREVfRkxB
R19OSFNZTkMgfAogCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX1BWU1lOQyB8CiAJCQkJCSAgICAg
IERSTV9NT0RFX0ZMQUdfTlZTWU5DKTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
LmZsYWdzIHw9IGludGVsX2NydF9nZXRfZmxhZ3MoZW5jb2Rlcik7CisJcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGUuZmxhZ3MgfD0gaW50ZWxfY3J0X2dldF9mbGFncyhlbmNvZGVyKTsKIAot
CXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IGxwdF9nZXRfaWNs
a2lwKGRldl9wcml2KTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2Nr
ID0gbHB0X2dldF9pY2xraXAoZGV2X3ByaXYpOwogfQogCiAvKiBOb3RlOiBUaGUgY2FsbGVyIGlz
IHJlcXVpcmVkIHRvIGZpbHRlciBvdXQgZHBtcyBtb2RlcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZQpA
QCAtMTYxLDggKzE2MSw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydF9zZXRfZHBtcyhzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0ICpj
cnQgPSBpbnRlbF9lbmNvZGVyX3RvX2NydChlbmNvZGVyKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5iYXNlLmFk
anVzdGVkX21vZGU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFk
anVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAl1MzIgYWRwYTsK
IAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDUpCkBAIC0yNzEsNyArMjcxLDcgQEAgc3Rh
dGljIHZvaWQgaHN3X3ByZV9lbmFibGVfY3J0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRl
KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+
cGlwZTsKIAogCVdBUk5fT04oIWNydGNfc3RhdGUtPmhhc19wY2hfZW5jb2Rlcik7CkBAIC0yODgs
NyArMjg4LDcgQEAgc3RhdGljIHZvaWQgaHN3X2VuYWJsZV9jcnQoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29u
bl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIHBpcGUgcGlwZSA9
IGNydGMtPnBpcGU7CiAKIAlXQVJOX09OKCFjcnRjX3N0YXRlLT5oYXNfcGNoX2VuY29kZXIpOwpA
QCAtMzU4LDcgKzM1OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfY3J0X2NvbXB1dGVfY29uZmlnKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0
ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoYWRqdXN0ZWRfbW9kZS0+ZmxhZ3MgJiBE
Uk1fTU9ERV9GTEFHX0RCTFNDQU4pCiAJCXJldHVybiAtRUlOVkFMOwpAQCAtMzczLDcgKzM3Myw3
IEBAIHN0YXRpYyBpbnQgcGNoX2NydF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAkJCQkgIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRl
KQogewogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJnBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAogCWlmIChhZGp1c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfREJMU0NB
TikKIAkJcmV0dXJuIC1FSU5WQUw7CkBAIC0zOTAsNyArMzkwLDcgQEAgc3RhdGljIGludCBoc3df
Y3J0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5k
ZXYpOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJnBpcGVf
Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZTsKIAogCWlmIChhZGp1c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfREJMU0NB
TikKIAkJcmV0dXJuIC1FSU5WQUw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
ZGkuYwppbmRleCAzYzFlODg1ZTAxODcuLjA1MmNhZjIzNzJkMCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBAIC0xNTI3LDcgKzE1MjcsNyBAQCBzdGF0aWMgdm9p
ZCBkZGlfZG90Y2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykK
IAlpZiAocGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIpCiAJCWRvdGNsb2NrIC89IHBpcGVf
Y29uZmlnLT5waXhlbF9tdWx0aXBsaWVyOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX2Nsb2NrID0gZG90Y2xvY2s7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y19jbG9jayA9IGRvdGNsb2NrOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfZGRpX2Nsb2Nr
X2dldChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKQEAgLTE3NDIsNyArMTc0Miw3IEBA
IHN0YXRpYyB2b2lkIGludGVsX2RkaV9jbG9ja19nZXQoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAKIHZvaWQgaW50ZWxfZGRpX3NldF9waXBlX3NldHRpbmdzKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwog
CWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2Nv
ZGVyOwogCXUzMiB0ZW1wOwpAQCAtMTgwMiw3ICsxODAyLDcgQEAgdm9pZCBpbnRlbF9kZGlfc2V0
X3BpcGVfc2V0dGluZ3MoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB2b2lkIGludGVsX2RkaV9zZXRfdmNfcGF5bG9hZF9hbGxvYyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgYm9vbCBzdGF0ZSkKIHsKLQlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRjX3N0
YXRlLT5jcHVfdHJhbnNjb2RlcjsKIAl1MzIgdGVtcDsKQEAgLTE4MjQsNyArMTgyNCw3IEBAIHZv
aWQgaW50ZWxfZGRpX3NldF92Y19wYXlsb2FkX2FsbG9jKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIHUzMgogaW50ZWxfZGRpX3RyYW5zY29kZXJfZnVu
Y19yZWdfdmFsX2dldChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9IGlu
dGVsX2RkaV9nZXRfY3J0Y19lbmNvZGVyKGNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0g
Y3J0Yy0+cGlwZTsKQEAgLTE4NTYsOSArMTg1Niw5IEBAIGludGVsX2RkaV90cmFuc2NvZGVyX2Z1
bmNfcmVnX3ZhbF9nZXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiAJCUJVRygpOwogCX0KIAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxh
Z3MgJiBEUk1fTU9ERV9GTEFHX1BWU1lOQykKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfUFZTWU5DKQogCQl0ZW1wIHw9IFRSQU5TX0RESV9Q
VlNZTkM7Ci0JaWYgKGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9N
T0RFX0ZMQUdfUEhTWU5DKQorCWlmIChjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdz
ICYgRFJNX01PREVfRkxBR19QSFNZTkMpCiAJCXRlbXAgfD0gVFJBTlNfRERJX1BIU1lOQzsKIAog
CWlmIChjcHVfdHJhbnNjb2RlciA9PSBUUkFOU0NPREVSX0VEUCkgewpAQCAtMTkxMSw3ICsxOTEx
LDcgQEAgaW50ZWxfZGRpX3RyYW5zY29kZXJfZnVuY19yZWdfdmFsX2dldChjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogdm9pZCBpbnRlbF9kZGlfZW5hYmxlX3Ry
YW5zY29kZXJfZnVuYyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29k
ZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKIAl1MzIgdGVtcDsKQEAgLTE5MjcsNyAr
MTkyNyw3IEBAIHZvaWQgaW50ZWxfZGRpX2VuYWJsZV90cmFuc2NvZGVyX2Z1bmMoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0aWMgdm9pZAogaW50ZWxfZGRp
X2NvbmZpZ190cmFuc2NvZGVyX2Z1bmMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNw
dV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAJdTMyIHRlbXA7CkBA
IC0xOTM5LDcgKzE5MzksNyBAQCBpbnRlbF9kZGlfY29uZmlnX3RyYW5zY29kZXJfZnVuYyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogdm9pZCBpbnRlbF9kZGlf
ZGlzYWJsZV90cmFuc2NvZGVyX2Z1bmMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNw
dV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAJaTkxNV9yZWdfdCBy
ZWcgPSBUUkFOU19ERElfRlVOQ19DVEwoY3B1X3RyYW5zY29kZXIpOwpAQCAtMjIzNyw3ICsyMjM3
LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX2dldF9wb3dlcl9kb21haW5zKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCiB2b2lkIGludGVsX2RkaV9lbmFibGVfcGlwZV9jbG9jayhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5j
cnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9IGludGVsX2RkaV9n
ZXRfY3J0Y19lbmNvZGVyKGNydGMpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsK
QEAgLTIyNTUsNyArMjI1NSw3IEBAIHZvaWQgaW50ZWxfZGRpX2VuYWJsZV9waXBlX2Nsb2NrKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiB2b2lkIGludGVsX2Rk
aV9kaXNhYmxlX3BpcGVfY2xvY2soY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJZW51bSB0cmFu
c2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAKIAlp
ZiAoY3B1X3RyYW5zY29kZXIgIT0gVFJBTlNDT0RFUl9FRFApIHsKQEAgLTM1NjIsNyArMzU2Miw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7
Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJh
c2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwog
CkBAIC0zOTg3LDcgKzM5ODcsNyBAQCBpbnRlbF9kZGlfdXBkYXRlX3ByZXBhcmUoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJV0FSTl9PTihjcnRjICYmIGNydGMtPmFjdGl2ZSk7
CiAKIAlpbnRlbF90Y19wb3J0X2dldF9saW5rKGVuY190b19kaWdfcG9ydCgmZW5jb2Rlci0+YmFz
ZSksIHJlcXVpcmVkX2xhbmVzKTsKLQlpZiAoY3J0Y19zdGF0ZSAmJiBjcnRjX3N0YXRlLT5iYXNl
LmFjdGl2ZSkKKwlpZiAoY3J0Y19zdGF0ZSAmJiBjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCWlu
dGVsX3VwZGF0ZV9hY3RpdmVfZHBsbChzdGF0ZSwgY3J0YywgZW5jb2Rlcik7CiB9CiAKQEAgLTQx
MTcsNyArNDExNyw3IEBAIHZvaWQgaW50ZWxfZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29k
ZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVs
X2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVs
X2NydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCWVudW0gdHJh
bnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlcjsKIAl1
MzIgdGVtcCwgZmxhZ3MgPSAwOwogCkBAIC00MTM1LDcgKzQxMzUsNyBAQCB2b2lkIGludGVsX2Rk
aV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWVsc2UKIAkJZmxh
Z3MgfD0gRFJNX01PREVfRkxBR19OVlNZTkM7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3Rl
ZF9tb2RlLmZsYWdzIHw9IGZsYWdzOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZs
YWdzIHw9IGZsYWdzOwogCiAJc3dpdGNoICh0ZW1wICYgVFJBTlNfRERJX0JQQ19NQVNLKSB7CiAJ
Y2FzZSBUUkFOU19ERElfQlBDXzY6CkBAIC00MjgxLDcgKzQyODEsNyBAQCBzdGF0aWMgaW50IGlu
dGVsX2RkaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJ
CQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCSAgICBzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKIAlpbnQgcmV0OwpA
QCAtNDQxMiw3ICs0NDEyLDcgQEAgc3RhdGljIGludCBpbnRlbF9oZG1pX3Jlc2V0X2xpbmsoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlXQVJOX09OKCFpbnRlbF9jcnRjX2hhc190
eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9IRE1JKSk7CiAKLQlpZiAoIWNydGNfc3RhdGUt
PmJhc2UuYWN0aXZlKQorCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1cm4gMDsK
IAogCWlmICghY3J0Y19zdGF0ZS0+aGRtaV9oaWdoX3RtZHNfY2xvY2tfcmF0aW8gJiYKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggZWNiMTU0MjBi
NWNhLi5mNTU1ZmY2YjFmNmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCkBAIC01MTYsNyArNTE2LDcgQEAgaWNsX3dhX3NjYWxlcmNsa2dhdGluZyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlLAogc3RhdGlj
IGJvb2wKIG5lZWRzX21vZGVzZXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnN0YXRl
KQogewotCXJldHVybiBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmc3RhdGUtPmJhc2Up
OworCXJldHVybiBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmc3RhdGUtPnVhcGkpOwog
fQogCiAvKgpAQCAtNjMwLDcgKzYzMCw3IEBAIGk5eHhfc2VsZWN0X3AyX2Rpdihjb25zdCBzdHJ1
Y3QgaW50ZWxfbGltaXQgKmxpbWl0LAogCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJICAgaW50IHRhcmdldCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVh
cGkuY3J0Yy0+ZGV2KTsKIAogCWlmIChpbnRlbF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElO
VEVMX09VVFBVVF9MVkRTKSkgewogCQkvKgpAQCAtNjY2LDcgKzY2Niw3IEBAIGk5eHhfZmluZF9i
ZXN0X2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKIAkJICAgIGludCB0YXJn
ZXQsIGludCByZWZjbGssIHN0cnVjdCBkcGxsICptYXRjaF9jbG9jaywKIAkJICAgIHN0cnVjdCBk
cGxsICpiZXN0X2Nsb2NrKQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjX3N0YXRl
LT5iYXNlLmNydGMtPmRldjsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjLT5kZXY7CiAJc3RydWN0IGRwbGwgY2xvY2s7CiAJaW50IGVyciA9IHRhcmdldDsK
IApAQCAtNzI0LDcgKzcyNCw3IEBAIHBudl9maW5kX2Jlc3RfZHBsbChjb25zdCBzdHJ1Y3QgaW50
ZWxfbGltaXQgKmxpbWl0LAogCQkgICBpbnQgdGFyZ2V0LCBpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBs
bCAqbWF0Y2hfY2xvY2ssCiAJCSAgIHN0cnVjdCBkcGxsICpiZXN0X2Nsb2NrKQogewotCXN0cnVj
dCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldjsKKwlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXY7CiAJc3RydWN0IGRw
bGwgY2xvY2s7CiAJaW50IGVyciA9IHRhcmdldDsKIApAQCAtNzgwLDcgKzc4MCw3IEBAIGc0eF9m
aW5kX2Jlc3RfZHBsbChjb25zdCBzdHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0LAogCQkgICBpbnQg
dGFyZ2V0LCBpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqbWF0Y2hfY2xvY2ssCiAJCSAgIHN0cnVj
dCBkcGxsICpiZXN0X2Nsb2NrKQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjX3N0
YXRlLT5iYXNlLmNydGMtPmRldjsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjLT5kZXY7CiAJc3RydWN0IGRwbGwgY2xvY2s7CiAJaW50IG1heF9uOwogCWJv
b2wgZm91bmQgPSBmYWxzZTsKQEAgLTg3NCw3ICs4NzQsNyBAQCB2bHZfZmluZF9iZXN0X2RwbGwo
Y29uc3Qgc3RydWN0IGludGVsX2xpbWl0ICpsaW1pdCwKIAkJICAgaW50IHRhcmdldCwgaW50IHJl
ZmNsaywgc3RydWN0IGRwbGwgKm1hdGNoX2Nsb2NrLAogCQkgICBzdHJ1Y3QgZHBsbCAqYmVzdF9j
bG9jaykKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0
Yy0+YmFzZS5kZXY7CiAJc3RydWN0IGRwbGwgY2xvY2s7CiAJdW5zaWduZWQgaW50IGJlc3RwcG0g
PSAxMDAwMDAwOwpAQCAtOTM0LDcgKzkzNCw3IEBAIGNodl9maW5kX2Jlc3RfZHBsbChjb25zdCBz
dHJ1Y3QgaW50ZWxfbGltaXQgKmxpbWl0LAogCQkgICBpbnQgdGFyZ2V0LCBpbnQgcmVmY2xrLCBz
dHJ1Y3QgZHBsbCAqbWF0Y2hfY2xvY2ssCiAJCSAgIHN0cnVjdCBkcGxsICpiZXN0X2Nsb2NrKQog
ewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5i
YXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNl
LmRldjsKIAl1bnNpZ25lZCBpbnQgYmVzdF9lcnJvcl9wcG07CiAJc3RydWN0IGRwbGwgY2xvY2s7
CkBAIC0xMDEzLDcgKzEwMTMsNyBAQCBib29sIGludGVsX2NydGNfYWN0aXZlKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjKQogCSAqIGZvciBhdG9taWMuCiAJICovCiAJcmV0dXJuIGNydGMtPmFjdGl2
ZSAmJiBjcnRjLT5iYXNlLnByaW1hcnktPnN0YXRlLT5mYiAmJgotCQljcnRjLT5jb25maWctPmJh
c2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCQljcnRjLT5jb25maWctPmh3LmFkanVzdGVk
X21vZGUuY3J0Y19jbG9jazsKIH0KIAogZW51bSB0cmFuc2NvZGVyIGludGVsX3BpcGVfdG9fY3B1
X3RyYW5zY29kZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LApAQCAtMTA2Nyw3
ICsxMDY3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfd2FpdF9mb3JfcGlwZV9zY2FubGluZV9tb3Zp
bmcoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiBzdGF0aWMgdm9pZAogaW50ZWxfd2FpdF9mb3Jf
cGlwZV9vZmYoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQog
ewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0
ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
b2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSA0KSB7CkBAIC0xNTI2LDcgKzE1MjYsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2VuYWJs
ZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIHN0YXRpYyB2b2lkIGk5eHhfZGlzYWJs
ZV9wbGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0
Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCkBAIC0x
NjE3LDcgKzE2MTcsNyBAQCB2b2lkIHZsdl93YWl0X3BvcnRfcmVhZHkoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9lbmFibGVfcGNoX3Ry
YW5zY29kZXIoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0J
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWk5
MTVfcmVnX3QgcmVnOwpAQCAtMTc2MSw3ICsxNzYxLDcgQEAgZW51bSBwaXBlIGludGVsX2NydGNf
cGNoX3RyYW5zY29kZXIoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAKIHN0YXRpYyB1MzIgaW50
ZWxfY3J0Y19tYXhfdmJsYW5rX2NvdW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCiAJLyoK
IAkgKiBPbiBpOTY1Z20gdGhlIGhhcmR3YXJlIGZyYW1lIGNvdW50ZXIgcmVhZHMKQEAgLTE3ODEs
NyArMTc4MSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfY3J0Y19tYXhfdmJsYW5rX2NvdW50KGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlCiAKIHN0YXRpYyB2b2lkIGludGVs
X2NydGNfdmJsYW5rX29uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpOwogCiAJZHJtX2NydGNfc2V0X21heF92YmxhbmtfY291bnQo
JmNydGMtPmJhc2UsCiAJCQkJICAgICAgaW50ZWxfY3J0Y19tYXhfdmJsYW5rX2NvdW50KGNydGNf
c3RhdGUpKTsKQEAgLTE3OTAsNyArMTc5MCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfdmJs
YW5rX29uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0
aWMgdm9pZCBpbnRlbF9lbmFibGVfcGlwZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
bmV3X2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKG5ld19jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVt
IHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBuZXdfY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29k
ZXI7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtMTg0OCw3ICsxODQ4LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX3BpcGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm5ld19jcnRjX3N0YXRlKQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kaXNhYmxlX3BpcGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQogewotCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3Rh
dGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0g
b2xkX2NydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+
cGlwZTsKQEAgLTMxMTQsMTQgKzMxMTQsMTQgQEAgaW50ZWxfc2V0X3BsYW5lX3Zpc2libGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJcGxhbmVfc3RhdGUtPmJhc2Uudmlz
aWJsZSA9IHZpc2libGU7CiAKIAlpZiAodmlzaWJsZSkKLQkJY3J0Y19zdGF0ZS0+YmFzZS5wbGFu
ZV9tYXNrIHw9IGRybV9wbGFuZV9tYXNrKCZwbGFuZS0+YmFzZSk7CisJCWNydGNfc3RhdGUtPnVh
cGkucGxhbmVfbWFzayB8PSBkcm1fcGxhbmVfbWFzaygmcGxhbmUtPmJhc2UpOwogCWVsc2UKLQkJ
Y3J0Y19zdGF0ZS0+YmFzZS5wbGFuZV9tYXNrICY9IH5kcm1fcGxhbmVfbWFzaygmcGxhbmUtPmJh
c2UpOworCQljcnRjX3N0YXRlLT51YXBpLnBsYW5lX21hc2sgJj0gfmRybV9wbGFuZV9tYXNrKCZw
bGFuZS0+YmFzZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGZpeHVwX2FjdGl2ZV9wbGFuZXMoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBp
LmNydGMtPmRldik7CiAJc3RydWN0IGRybV9wbGFuZSAqcGxhbmU7CiAKIAkvKgpAQCAtMzEzMiw3
ICszMTMyLDcgQEAgc3RhdGljIHZvaWQgZml4dXBfYWN0aXZlX3BsYW5lcyhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAljcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzID0gMDsK
IAogCWRybV9mb3JfZWFjaF9wbGFuZV9tYXNrKHBsYW5lLCAmZGV2X3ByaXYtPmRybSwKLQkJCQlj
cnRjX3N0YXRlLT5iYXNlLnBsYW5lX21hc2spCisJCQkJY3J0Y19zdGF0ZS0+dWFwaS5wbGFuZV9t
YXNrKQogCQljcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzIHw9IEJJVCh0b19pbnRlbF9wbGFuZShw
bGFuZSktPmlkKTsKIH0KIApAQCAtMzYwNiw3ICszNjA2LDcgQEAgaTl4eF9wbGFuZV9tYXhfc3Ry
aWRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAKIHN0YXRpYyB1MzIgaTl4eF9wbGFuZV9j
dGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIgZHNwY250ciA9IDA7CiAKQEAgLTM3NjAsNyArMzc2
MCw3IEBAIGk5eHhfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJCXJldHVybiByZXQ7CiAKIAlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19wbGFu
ZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UsCi0JCQkJCQkgICZjcnRjX3N0YXRlLT5iYXNlLAor
CQkJCQkJICAmY3J0Y19zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgRFJNX1BMQU5FX0hFTFBFUl9OT19T
Q0FMSU5HLAogCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCiAJCQkJCQkgIGk5
eHhfcGxhbmVfaGFzX3dpbmRvd2luZyhwbGFuZSksCkBAIC0zOTM2LDcgKzM5MzYsNyBAQCBzdGF0
aWMgdm9pZCBza2xfZGV0YWNoX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0Yywg
aW50IGlkKQogICovCiBzdGF0aWMgdm9pZCBza2xfZGV0YWNoX3NjYWxlcnMoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7CiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3Rh
dGUgPQogCQkmY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlOwogCWludCBpOwpAQCAtNDEzMSw3ICs0
MTMxLDcgQEAgc3RhdGljIHUzMiBjbmxfcGxhbmVfY3RsX2ZsaXAodW5zaWduZWQgaW50IHJlZmxl
Y3QpCiAKIHUzMiBza2xfcGxhbmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJ
dTMyIHBsYW5lX2N0bCA9IDA7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJ
U19HRU1JTklMQUtFKGRldl9wcml2KSkKQEAgLTQxODcsNyArNDE4Nyw3IEBAIHUzMiBza2xfcGxh
bmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiB1MzIg
Z2xrX3BsYW5lX2NvbG9yX2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCXUzMiBw
bGFuZV9jb2xvcl9jdGwgPSAwOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCkBA
IC00ODAzLDcgKzQ4MDMsNyBAQCBzdGF0aWMgdm9pZCBpdmJfbWFudWFsX2ZkaV9saW5rX3RyYWlu
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9mZGlfcGxs
X2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGludGVsX2NydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9
IGludGVsX2NydGMtPnBpcGU7CiAJaTkxNV9yZWdfdCByZWc7CkBAIC00OTY0LDkgKzQ5NjQsOSBA
QCB2b2lkIGxwdF9kaXNhYmxlX2ljbGtpcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAvKiBQcm9ncmFtIGlDTEtJUCBjbG9jayB0byB0aGUgZGVzaXJlZCBmcmVxdWVuY3kgKi8K
IHN0YXRpYyB2b2lkIGxwdF9wcm9ncmFtX2ljbGtpcChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQlpbnQgY2xvY2sg
PSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKwlpbnQgY2xvY2sg
PSBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CiAJdTMyIGRpdnNlbCwg
cGhhc2VpbmMsIGF1eGRpdiwgcGhhc2VkaXIgPSAwOwogCXUzMiB0ZW1wOwogCkBAIC01MDgwLDcg
KzUwODAsNyBAQCBpbnQgbHB0X2dldF9pY2xraXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX3RyYW5zY29kZXJfc2V0X3RpbWluZ3Mo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJCQllbnVtIHBp
cGUgcGNoX3RyYW5zY29kZXIpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSB0cmFu
c2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAKQEAg
LTUxMjMsNyArNTEyMyw3IEBAIHN0YXRpYyB2b2lkIGNwdF9zZXRfZmRpX2JjX2JpZnVyY2F0aW9u
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBlCiAKIHN0YXRpYyB2b2lk
IGl2eWJyaWRnZV91cGRhdGVfZmRpX2JjX2JpZnVyY2F0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJc3dp
dGNoIChjcnRjLT5waXBlKSB7CkBAIC01MTUzLDcgKzUxNTMsNyBAQCBzdGF0aWMgc3RydWN0IGlu
dGVsX2VuY29kZXIgKgogaW50ZWxfZ2V0X2NydGNfbmV3X2VuY29kZXIoY29uc3Qgc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAljb25zdCBzdHJ1Y3QgZHJt
X2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlOwogCWNvbnN0IHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3I7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSBOVUxM
OwpAQCAtNTE4NSw3ICs1MTg1LDcgQEAgaW50ZWxfZ2V0X2NydGNfbmV3X2VuY29kZXIoY29uc3Qg
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9w
Y2hfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCWNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNy
dGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJZW51bSBwaXBlIHBp
cGUgPSBjcnRjLT5waXBlOwpAQCAtNTIzOSw3ICs1MjM5LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxh
a2VfcGNoX2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlp
ZiAoSEFTX1BDSF9DUFQoZGV2X3ByaXYpICYmCiAJICAgIGludGVsX2NydGNfaGFzX2RwX2VuY29k
ZXIoY3J0Y19zdGF0ZSkpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPQotCQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRj
X3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCQl1MzIgYnBjID0gKEk5MTVfUkVBRChQSVBFQ09O
RihwaXBlKSkgJiBQSVBFQ09ORl9CUENfTUFTSykgPj4gNTsKIAkJaTkxNV9yZWdfdCByZWcgPSBU
UkFOU19EUF9DVEwocGlwZSk7CiAJCWVudW0gcG9ydCBwb3J0OwpAQCAtNTI2OSw3ICs1MjY5LDcg
QEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGNoX2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwKIHN0YXRpYyB2b2lkIGxwdF9wY2hfZW5hYmxlKGNvbnN0IHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSB0
cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAK
QEAgLTUzODYsMTAgKzUzODYsMTAgQEAgc2tsX3VwZGF0ZV9zY2FsZXIoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsIGJvb2wgZm9yY2VfZGV0YWNoLAogCXN0cnVjdCBpbnRlbF9j
cnRjX3NjYWxlcl9zdGF0ZSAqc2NhbGVyX3N0YXRlID0KIAkJJmNydGNfc3RhdGUtPnNjYWxlcl9z
dGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9Ci0JCXRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwkJdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBp
LmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50
ZWxfY3J0Yy0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNf
c3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAKIAkvKgogCSAqIFNyYyBjb29yZGluYXRlcyBhcmUg
YWxyZWFkeSByb3RhdGVkIGJ5IDI3MCBkZWdyZWVzIGZvcgpAQCAtNTQwNSw3ICs1NDA1LDcgQEAg
c2tsX3VwZGF0ZV9zY2FsZXIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsIGJv
b2wgZm9yY2VfZGV0YWNoLAogCSAqIE9uY2UgTlYxMiBpcyBlbmFibGVkLCBoYW5kbGUgaXQgaGVy
ZSB3aGlsZSBhbGxvY2F0aW5nIHNjYWxlcgogCSAqIGZvciBOVjEyLgogCSAqLwotCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDkgJiYgY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUgJiYKKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSA5ICYmIGNydGNfc3RhdGUtPmh3LmVuYWJsZSAmJgogCSAg
ICBuZWVkX3NjYWxlciAmJiBhZGp1c3RlZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5U
RVJMQUNFKSB7CiAJCURSTV9ERUJVR19LTVMoIlBpcGUvUGxhbmUgc2NhbGluZyBub3Qgc3VwcG9y
dGVkIHdpdGggSUYtSUQgbW9kZVxuIik7CiAJCXJldHVybiAtRUlOVkFMOwpAQCAtNTQ3NywxMyAr
NTQ3NywxMyBAQCBza2xfdXBkYXRlX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwgYm9vbCBmb3JjZV9kZXRhY2gsCiAgKi8KIGludCBza2xfdXBkYXRlX3NjYWxlcl9j
cnRjKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpzdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJt
X2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZzdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2Rl
OworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnN0YXRl
LT5ody5hZGp1c3RlZF9tb2RlOwogCWJvb2wgbmVlZF9zY2FsZXIgPSBmYWxzZTsKIAogCWlmIChz
dGF0ZS0+b3V0cHV0X2Zvcm1hdCA9PSBJTlRFTF9PVVRQVVRfRk9STUFUX1lDQkNSNDIwKQogCQlu
ZWVkX3NjYWxlciA9IHRydWU7CiAKLQlyZXR1cm4gc2tsX3VwZGF0ZV9zY2FsZXIoc3RhdGUsICFz
dGF0ZS0+YmFzZS5hY3RpdmUsIFNLTF9DUlRDX0lOREVYLAorCXJldHVybiBza2xfdXBkYXRlX3Nj
YWxlcihzdGF0ZSwgIXN0YXRlLT5ody5hY3RpdmUsIFNLTF9DUlRDX0lOREVYLAogCQkJCSAmc3Rh
dGUtPnNjYWxlcl9zdGF0ZS5zY2FsZXJfaWQsCiAJCQkJIHN0YXRlLT5waXBlX3NyY193LCBzdGF0
ZS0+cGlwZV9zcmNfaCwKIAkJCQkgYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheSwKQEAgLTU1
ODMsNyArNTU4Myw3IEBAIHN0YXRpYyB2b2lkIHNreWxha2Vfc2NhbGVyX2Rpc2FibGUoc3RydWN0
IGludGVsX2NydGMgKmNydGMpCiAKIHN0YXRpYyB2b2lkIHNreWxha2VfcGZpdF9lbmFibGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5i
YXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3NjYWxlcl9zdGF0ZSAqc2NhbGVyX3N0YXRlID0KQEAgLTU2MjAsNyArNTYyMCw3
IEBAIHN0YXRpYyB2b2lkIHNreWxha2VfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRpYyB2b2lkIGlyb25sYWtlX3BmaXRfZW5hYmxl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwor
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBp
LmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIApAQCAtNTY0MSw3
ICs1NjQxLDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHZvaWQgaHN3X2VuYWJsZV9pcHMoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIApAQCAtNTY3Nyw3ICs1
Njc3LDcgQEAgdm9pZCBoc3dfZW5hYmxlX2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIAogdm9pZCBoc3dfZGlzYWJsZV9pcHMoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIApAQCAtNTc4Nyw3ICs1Nzg3LDcgQEAgaW50ZWxf
cHJlX2Rpc2FibGVfcHJpbWFyeV9ub2F0b21pYyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMpCiBzdGF0
aWMgYm9vbCBoc3dfcHJlX3VwZGF0ZV9kaXNhYmxlX2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOwog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCiAJaWYgKCFvbGRfY3J0Y19zdGF0ZS0+aXBzX2VuYWJsZWQpCkBAIC01ODAzLDcgKzU4
MDMsNyBAQCBzdGF0aWMgYm9vbCBoc3dfcHJlX3VwZGF0ZV9kaXNhYmxlX2lwcyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfcwogCSAqIERpc2FibGUgSVBTIGJlZm9yZSB3
ZSBwcm9ncmFtIHRoZSBMVVQuCiAJICovCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmCi0J
ICAgIChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jb2xvcl9tZ210X2NoYW5nZWQgfHwKKwkgICAgKG5l
d19jcnRjX3N0YXRlLT51YXBpLmNvbG9yX21nbXRfY2hhbmdlZCB8fAogCSAgICAgbmV3X2NydGNf
c3RhdGUtPnVwZGF0ZV9waXBlKSAmJgogCSAgICBuZXdfY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9
PSBHQU1NQV9NT0RFX01PREVfU1BMSVQpCiAJCXJldHVybiB0cnVlOwpAQCAtNTgxNCw3ICs1ODE0
LDcgQEAgc3RhdGljIGJvb2wgaHN3X3ByZV91cGRhdGVfZGlzYWJsZV9pcHMoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3MKIHN0YXRpYyBib29sIGhzd19wb3N0X3VwZGF0
ZV9lbmFibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
ZSwKIAkJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0
YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAKIAlpZiAoIW5ld19jcnRj
X3N0YXRlLT5pcHNfZW5hYmxlZCkKQEAgLTU4MzAsNyArNTgzMCw3IEBAIHN0YXRpYyBib29sIGhz
d19wb3N0X3VwZGF0ZV9lbmFibGVfaXBzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpv
bGRfY3J0Y19zCiAJICogUmUtZW5hYmxlIElQUyBhZnRlciB0aGUgTFVUIGhhcyBiZWVuIHByb2dy
YW1tZWQuCiAJICovCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmCi0JICAgIChuZXdfY3J0
Y19zdGF0ZS0+YmFzZS5jb2xvcl9tZ210X2NoYW5nZWQgfHwKKwkgICAgKG5ld19jcnRjX3N0YXRl
LT51YXBpLmNvbG9yX21nbXRfY2hhbmdlZCB8fAogCSAgICAgbmV3X2NydGNfc3RhdGUtPnVwZGF0
ZV9waXBlKSAmJgogCSAgICBuZXdfY3J0Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RF
X01PREVfU1BMSVQpCiAJCXJldHVybiB0cnVlOwpAQCAtNTg0MCw3ICs1ODQwLDcgQEAgc3RhdGlj
IGJvb2wgaHN3X3Bvc3RfdXBkYXRlX2VuYWJsZV9pcHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm9sZF9jcnRjX3MKIAkgKiBmb3JjaWJseSBlbmFibGUgSVBTIG9uIHRoZSBmaXJzdCBm
YXN0c2V0LgogCSAqLwogCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgJiYKLQkgICAg
b2xkX2NydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9N
T0RFX0ZMQUdfSU5IRVJJVEVEKQorCSAgICBvbGRfY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9k
ZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKQogCQlyZXR1cm4gdHJ1
ZTsKIAogCXJldHVybiAhb2xkX2NydGNfc3RhdGUtPmlwc19lbmFibGVkOwpAQCAtNTg3MSwxMCAr
NTg3MSwxMCBAQCBzdGF0aWMgYm9vbCBuZWVkc19zY2FsZXJjbGtfd2Eoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgdm9pZCBpbnRlbF9wb3N0X3BsYW5lX3VwZGF0
ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMp
OworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IG9sZF9jcnRjX3N0YXRlLT5iYXNlLnN0YXRl
OworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IG9sZF9jcnRjX3N0YXRlLT51YXBp
LnN0YXRlOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZyA9CiAJCWludGVs
X2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUodG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKSwK
IAkJCQkJCWNydGMpOwpAQCAtNTg4NCw3ICs1ODg0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9z
dF9wbGFuZV91cGRhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQog
CiAJaW50ZWxfZnJvbnRidWZmZXJfZmxpcCh0b19pOTE1KGNydGMtPmJhc2UuZGV2KSwgcGlwZV9j
b25maWctPmZiX2JpdHMpOwogCi0JaWYgKHBpcGVfY29uZmlnLT51cGRhdGVfd21fcG9zdCAmJiBw
aXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUpCisJaWYgKHBpcGVfY29uZmlnLT51cGRhdGVfd21fcG9z
dCAmJiBwaXBlX2NvbmZpZy0+aHcuYWN0aXZlKQogCQlpbnRlbF91cGRhdGVfd2F0ZXJtYXJrcyhj
cnRjKTsKIAogCWlmIChoc3dfcG9zdF91cGRhdGVfZW5hYmxlX2lwcyhvbGRfY3J0Y19zdGF0ZSwg
cGlwZV9jb25maWcpKQpAQCAtNTkxNCwxMCArNTkxNCwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9w
b3N0X3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUp
CiBzdGF0aWMgdm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9s
ZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IG9s
ZF9jcnRjX3N0YXRlLT5iYXNlLnN0YXRlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0
ZSA9IG9sZF9jcnRjX3N0YXRlLT51YXBpLnN0YXRlOwogCXN0cnVjdCBkcm1fcGxhbmUgKnByaW1h
cnkgPSBjcnRjLT5iYXNlLnByaW1hcnk7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3By
aW1hcnlfc3RhdGUgPQogCQlkcm1fYXRvbWljX2dldF9vbGRfcGxhbmVfc3RhdGUoc3RhdGUsIHBy
aW1hcnkpOwpAQCAtNTk2Miw3ICs1OTYyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJlX3BsYW5l
X3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJICogZXZl
bnQgd2hpY2ggaXMgYWZ0ZXIgdGhlIHZibGFuayBzdGFydCBldmVudCwgc28gd2UgbmVlZCB0byBo
YXZlIGEKIAkgKiB3YWl0LWZvci12YmxhbmsgYmV0d2VlbiBkaXNhYmxpbmcgdGhlIHBsYW5lIGFu
ZCB0aGUgcGlwZS4KIAkgKi8KLQlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmIG9sZF9jcnRjX3N0
YXRlLT5iYXNlLmFjdGl2ZSAmJgorCWlmIChIQVNfR01DSChkZXZfcHJpdikgJiYgb2xkX2NydGNf
c3RhdGUtPmh3LmFjdGl2ZSAmJgogCSAgICBwaXBlX2NvbmZpZy0+ZGlzYWJsZV9jeHNyICYmIGlu
dGVsX3NldF9tZW1vcnlfY3hzcihkZXZfcHJpdiwgZmFsc2UpKQogCQlpbnRlbF93YWl0X2Zvcl92
YmxhbmsoZGV2X3ByaXYsIGNydGMtPnBpcGUpOwogCkBAIC01OTc0LDcgKzU5NzQsNyBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpv
bGRfY3J0Y19zdGF0ZSwKIAkgKiBXYUN4U1JEaXNhYmxlZEZvclNwcml0ZVNjYWxpbmc6aXZiCiAJ
ICovCiAJaWYgKHBpcGVfY29uZmlnLT5kaXNhYmxlX2xwX3dtICYmIGlsa19kaXNhYmxlX2xwX3dt
KGRldikgJiYKLQkgICAgb2xkX2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCSAgICBvbGRfY3J0
Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIGNy
dGMtPnBpcGUpOwogCiAJLyoKQEAgLTYyNjksNyArNjI2OSw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2VuY29kZXJzX3VwZGF0ZV9waXBlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiBzdGF0aWMg
dm9pZCBpbnRlbF9kaXNhYmxlX3ByaW1hcnlfcGxhbmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFyeSk7CiAKIAlwbGFu
ZS0+ZGlzYWJsZV9wbGFuZShwbGFuZSwgY3J0Y19zdGF0ZSk7CkBAIC02Mjc4LDcgKzYyNzgsNyBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9kaXNhYmxlX3ByaW1hcnlfcGxhbmUoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdAogc3RhdGljIHZvaWQgaXJvbmxha2VfY3J0Y19lbmFi
bGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCSBzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBl
X2NvbmZpZy0+YmFzZS5jcnRjOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmln
LT51YXBpLmNydGM7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwpAQCAtNjQxMiw3ICs2
NDEyLDcgQEAgc3RhdGljIHZvaWQgaWNsX3BpcGVfbWJ1c19lbmFibGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMpCiBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCQlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+YmFzZS5jcnRj
OworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmlnLT51YXBpLmNydGM7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5kZXYpOwogCXN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKIAllbnVt
IHBpcGUgcGlwZSA9IGludGVsX2NydGMtPnBpcGUsIGhzd193b3JrYXJvdW5kX3BpcGU7CkBAIC02
NTIxLDcgKzY1MjEsNyBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAogc3RhdGljIHZvaWQgaXJvbmxha2VfcGZp
dF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIApAQCAtNjUzNyw3ICs2NTM3LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfcGZp
dF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkK
IHN0YXRpYyB2b2lkIGlyb25sYWtlX2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSkKIHsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
OworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGM7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVs
X2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwpAQCAtNjU5Niw3ICs2NTk2LDcgQEAgc3RhdGlj
IHZvaWQgaXJvbmxha2VfY3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRf
Y3J0Y19zdGF0ZSwKIHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCQkgc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjID0gb2xkX2NydGNfc3RhdGUt
PmJhc2UuY3J0YzsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Yyk7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gb2xkX2NydGNfc3RhdGUt
PmNwdV90cmFuc2NvZGVyOwpAQCAtNjYzMCw3ICs2NjMwLDcgQEAgc3RhdGljIHZvaWQgaGFzd2Vs
bF9jcnRjX2Rpc2FibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAog
CiBzdGF0aWMgdm9pZCBpOXh4X3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJaWYgKCFjcnRj
X3N0YXRlLT5nbWNoX3BmaXQuY29udHJvbCkKQEAgLTY3NjAsMTQgKzY3NjAsMTQgQEAgaW50ZWxf
YXV4X3Bvd2VyX2RvbWFpbihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCkKIAog
c3RhdGljIHU2NCBnZXRfY3J0Y19wb3dlcl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fZW5j
b2RlciAqZW5jb2RlcjsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTY0IG1hc2s7
CiAJZW51bSB0cmFuc2NvZGVyIHRyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2Rl
cjsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRlLT5o
dy5hY3RpdmUpCiAJCXJldHVybiAwOwogCiAJbWFzayA9IEJJVF9VTEwoUE9XRVJfRE9NQUlOX1BJ
UEUocGlwZSkpOwpAQCAtNjc3Nyw3ICs2Nzc3LDcgQEAgc3RhdGljIHU2NCBnZXRfY3J0Y19wb3dl
cl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQltYXNrIHw9
IEJJVF9VTEwoUE9XRVJfRE9NQUlOX1BJUEVfUEFORUxfRklUVEVSKHBpcGUpKTsKIAogCWRybV9m
b3JfZWFjaF9lbmNvZGVyX21hc2soZW5jb2RlciwgJmRldl9wcml2LT5kcm0sCi0JCQkJICBjcnRj
X3N0YXRlLT5iYXNlLmVuY29kZXJfbWFzaykgeworCQkJCSAgY3J0Y19zdGF0ZS0+dWFwaS5lbmNv
ZGVyX21hc2spIHsKIAkJc3RydWN0IGludGVsX2VuY29kZXIgKmludGVsX2VuY29kZXIgPSB0b19p
bnRlbF9lbmNvZGVyKGVuY29kZXIpOwogCiAJCW1hc2sgfD0gQklUX1VMTChpbnRlbF9lbmNvZGVy
LT5wb3dlcl9kb21haW4pOwpAQCAtNjc5NSw3ICs2Nzk1LDcgQEAgc3RhdGljIHU2NCBnZXRfY3J0
Y19wb3dlcl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3Rh
dGljIHU2NAogbW9kZXNldF9nZXRfY3J0Y19wb3dlcl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gaW50
ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gZG9tYWluOwogCXU2NCBkb21haW5zLCBuZXdfZG9tYWlu
cywgb2xkX2RvbWFpbnM7CkBAIC02ODI0LDcgKzY4MjQsNyBAQCBzdGF0aWMgdm9pZCBtb2Rlc2V0
X3B1dF9wb3dlcl9kb21haW5zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIHN0
YXRpYyB2b2lkIHZhbGxleXZpZXdfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnLAogCQkJCSAgIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQog
ewotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmlnLT5iYXNlLmNydGM7CisJc3Ry
dWN0IGRybV9jcnRjICpjcnRjID0gcGlwZV9jb25maWctPnVhcGkuY3J0YzsKIAlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Yyk7CkBAIC02ODgwLDcgKzY4ODAsNyBAQCBzdGF0aWMgdm9pZCB2YWxs
ZXl2aWV3X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywK
IAogc3RhdGljIHZvaWQgaTl4eF9zZXRfcGxsX2RpdmlkZXJzKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJSTkx
NV9XUklURShGUDAoY3J0Yy0+cGlwZSksIGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGUuZnAwKTsK
QEAgLTY4OTAsNyArNjg5MCw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfc2V0X3BsbF9kaXZpZGVycyhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB2b2lkIGk5
eHhfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJ
ICAgICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+YmFzZS5jcnRjOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0
YyA9IHBpcGVfY29uZmlnLT51YXBpLmNydGM7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNy
dGMtPmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMp
OwpAQCAtNjk0MCw3ICs2OTQwLDcgQEAgc3RhdGljIHZvaWQgaTl4eF9jcnRjX2VuYWJsZShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAKIHN0YXRpYyB2b2lkIGk5eHhfcGZp
dF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJaWYgKCFvbGRfY3J0Y19zdGF0
ZS0+Z21jaF9wZml0LmNvbnRyb2wpCkBAIC02OTU2LDcgKzY5NTYsNyBAQCBzdGF0aWMgdm9pZCBp
OXh4X3BmaXRfZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUpCiBzdGF0aWMgdm9pZCBpOXh4X2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0Y19zdGF0ZS0+YmFz
ZS5jcnRjOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IG9sZF9jcnRjX3N0YXRlLT51YXBpLmNy
dGM7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2NydGMg
KmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwpAQCAtNzEyNCw4ICs3MTI0LDggQEAg
c3RhdGljIHZvaWQgaW50ZWxfY29ubmVjdG9yX3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJaWYgKCFjcnRjX3N0YXRlKQogCQkJcmV0dXJuOwogCi0J
CUk5MTVfU1RBVEVfV0FSTighY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUsCi0JCSAgICAgICJjb25u
ZWN0b3IgaXMgYWN0aXZlLCBidXQgYXR0YWNoZWQgY3J0YyBpc24ndFxuIik7CisJCUk5MTVfU1RB
VEVfV0FSTighY3J0Y19zdGF0ZS0+aHcuYWN0aXZlLAorCQkJCSJjb25uZWN0b3IgaXMgYWN0aXZl
LCBidXQgYXR0YWNoZWQgY3J0YyBpc24ndFxuIik7CiAKIAkJaWYgKCFlbmNvZGVyIHx8IGVuY29k
ZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0RQX01TVCkKIAkJCXJldHVybjsKQEAgLTcxMzYsOCAr
NzEzNiw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2Nvbm5lY3Rvcl92ZXJpZnlfc3RhdGUoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCUk5MTVfU1RBVEVfV0FSTihjb25uX3N0
YXRlLT5jcnRjICE9IGVuY29kZXItPmJhc2UuY3J0YywKIAkJCSJhdHRhY2hlZCBlbmNvZGVyIGNy
dGMgZGlmZmVycyBmcm9tIGNvbm5lY3RvciBjcnRjXG4iKTsKIAl9IGVsc2UgewotCQlJOTE1X1NU
QVRFX1dBUk4oY3J0Y19zdGF0ZSAmJiBjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwKLQkJCSJhdHRh
Y2hlZCBjcnRjIGlzIGFjdGl2ZSwgYnV0IGNvbm5lY3RvciBpc24ndFxuIik7CisJCUk5MTVfU1RB
VEVfV0FSTihjcnRjX3N0YXRlICYmIGNydGNfc3RhdGUtPmh3LmFjdGl2ZSwKKwkJCQkiYXR0YWNo
ZWQgY3J0YyBpcyBhY3RpdmUsIGJ1dCBjb25uZWN0b3IgaXNuJ3RcbiIpOwogCQlJOTE1X1NUQVRF
X1dBUk4oIWNydGNfc3RhdGUgJiYgY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVyLAogCQkJImJlc3Qg
ZW5jb2RlciBzZXQgd2l0aG91dCBjcnRjIVxuIik7CiAJfQpAQCAtNzE0NSw3ICs3MTQ1LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfY29ubmVjdG9yX3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIGludCBwaXBlX3JlcXVpcmVkX2ZkaV9sYW5l
cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlpZiAoY3J0Y19zdGF0
ZS0+YmFzZS5lbmFibGUgJiYgY3J0Y19zdGF0ZS0+aGFzX3BjaF9lbmNvZGVyKQorCWlmIChjcnRj
X3N0YXRlLT5ody5lbmFibGUgJiYgY3J0Y19zdGF0ZS0+aGFzX3BjaF9lbmNvZGVyKQogCQlyZXR1
cm4gY3J0Y19zdGF0ZS0+ZmRpX2xhbmVzOwogCiAJcmV0dXJuIDA7CkBAIC03MTU1LDcgKzcxNTUs
NyBAQCBzdGF0aWMgaW50IGlyb25sYWtlX2NoZWNrX2ZkaV9sYW5lcyhzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCBlbnVtIHBpcGUgcGlwZSwKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGRldik7Ci0Jc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gcGlwZV9jb25m
aWctPmJhc2Uuc3RhdGU7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gcGlwZV9j
b25maWctPnVhcGkuc3RhdGU7CiAJc3RydWN0IGludGVsX2NydGMgKm90aGVyX2NydGM7CiAJc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKm90aGVyX2NydGNfc3RhdGU7CiAKQEAgLTcyMjgsNyArNzIy
OCw3IEBAIHN0YXRpYyBpbnQgaXJvbmxha2VfZmRpX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjLAogCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGludGVsX2NydGMtPmJh
c2UuZGV2OwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0g
JnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7
CiAJaW50IGxhbmUsIGxpbmtfYncsIGZkaV9kb3RjbG9jaywgcmV0OwogCWJvb2wgbmVlZHNfcmVj
b21wdXRlID0gZmFsc2U7CiAKQEAgLTcyNzQsNyArNzI3NCw3IEBAIHN0YXRpYyBpbnQgaXJvbmxh
a2VfZmRpX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCiBi
b29sIGhzd19jcnRjX3N0YXRlX2lwc19jYXBhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJLyogSVBTIG9u
bHkgZXhpc3RzIG9uIFVMVCBtYWNoaW5lcyBhbmQgaXMgdGllZCB0byBwaXBlIEEuICovCkBAIC03
MzA0LDkgKzczMDQsOSBAQCBib29sIGhzd19jcnRjX3N0YXRlX2lwc19jYXBhYmxlKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIGJvb2wgaHN3X2NvbXB1
dGVfaXBzX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KGNydGNfc3RhdGUt
PmJhc2UuY3J0Yy0+ZGV2KTsKKwkJdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7
CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPQotCQl0b19pbnRlbF9h
dG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19z
dGF0ZShjcnRjX3N0YXRlLT51YXBpLnN0YXRlKTsKIAogCWlmICghaHN3X2NydGNfc3RhdGVfaXBz
X2NhcGFibGUoY3J0Y19zdGF0ZSkpCiAJCXJldHVybiBmYWxzZTsKQEAgLTczNDUsNyArNzM0NSw3
IEBAIHN0YXRpYyB1MzIgaWxrX3BpcGVfcGl4ZWxfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJdTMyIHBpeGVsX3JhdGU7CiAKLQlwaXhlbF9yYXRl
ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCXBpeGVsX3Jh
dGUgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOwogCiAJLyoKIAkg
KiBXZSBvbmx5IHVzZSBJRi1JRCBpbnRlcmxhY2luZy4gSWYgd2UgZXZlciB1c2UKQEAgLTczNzgs
MTIgKzczNzgsMTIgQEAgc3RhdGljIHUzMiBpbGtfcGlwZV9waXhlbF9yYXRlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIAogc3RhdGljIHZvaWQgaW50ZWxfY3J0
Y19jb21wdXRlX3BpeGVsX3JhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0
YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAlpZiAoSEFTX0dNQ0go
ZGV2X3ByaXYpKQogCQkvKiBGSVhNRSBjYWxjdWxhdGUgcHJvcGVyIHBpcGUgcGl4ZWwgcmF0ZSBm
b3IgR01DSCBwZml0ICovCiAJCWNydGNfc3RhdGUtPnBpeGVsX3JhdGUgPQotCQkJY3J0Y19zdGF0
ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJCQljcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlLmNydGNfY2xvY2s7CiAJZWxzZQogCQljcnRjX3N0YXRlLT5waXhlbF9yYXRlID0K
IAkJCWlsa19waXBlX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSk7CkBAIC03MzkzLDcgKzczOTMsNyBA
QCBzdGF0aWMgaW50IGludGVsX2NydGNfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAJCQkJICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAm
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsK
IAlpbnQgY2xvY2tfbGltaXQgPSBkZXZfcHJpdi0+bWF4X2RvdGNsa19mcmVxOwogCiAJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPCA0KSB7CkBAIC03NDE5LDcgKzc0MTksNyBAQCBzdGF0aWMgaW50
IGludGVsX2NydGNfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAlp
ZiAoKHBpcGVfY29uZmlnLT5vdXRwdXRfZm9ybWF0ID09IElOVEVMX09VVFBVVF9GT1JNQVRfWUNC
Q1I0MjAgfHwKIAkgICAgIHBpcGVfY29uZmlnLT5vdXRwdXRfZm9ybWF0ID09IElOVEVMX09VVFBV
VF9GT1JNQVRfWUNCQ1I0NDQpICYmCi0JICAgICBwaXBlX2NvbmZpZy0+YmFzZS5jdG0pIHsKKwkg
ICAgIHBpcGVfY29uZmlnLT5ody5jdG0pIHsKIAkJLyoKIAkJICogVGhlcmUgaXMgb25seSBvbmUg
cGlwZSBDU0MgdW5pdCBwZXIgcGlwZSwgYW5kIHdlIG5lZWQgdGhhdAogCQkgKiBmb3Igb3V0cHV0
IGNvbnZlcnNpb24gZnJvbSBSR0ItPllDQkNSLiBTbyBpZiBDVE0gaXMgYWxyZWFkeQpAQCAtNzYx
Myw3ICs3NjEzLDcgQEAgc3RhdGljIHZvaWQgdmx2X3BsbGJfcmVjYWxfb3BhbXAoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUKIHN0YXRpYyB2b2lkIGludGVsX3Bj
aF90cmFuc2NvZGVyX3NldF9tX24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm1fbikKIHsKLQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKQEAgLTc2
NDAsNyArNzY0MCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NwdV90cmFuc2NvZGVyX3NldF9tX24o
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhCiAJCQkJCSBjb25zdCBzdHJ1
Y3QgaW50ZWxfbGlua19tX24gKm1fbiwKIAkJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9saW5rX21f
biAqbTJfbjIpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBj
cnRjLT5waXBlOwogCWVudW0gdHJhbnNjb2RlciB0cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1
X3RyYW5zY29kZXI7CkBAIC03OTUzLDcgKzc5NTMsNyBAQCBpbnQgdmx2X2ZvcmNlX3BsbF9vbihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlLAogCWlmICgh
cGlwZV9jb25maWcpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JcGlwZV9jb25maWctPmJhc2UuY3J0
YyA9ICZjcnRjLT5iYXNlOworCXBpcGVfY29uZmlnLT51YXBpLmNydGMgPSAmY3J0Yy0+YmFzZTsK
IAlwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllciA9IDE7CiAJcGlwZV9jb25maWctPmRwbGwg
PSAqZHBsbDsKIApAQCAtODExMywxMSArODExMywxMSBAQCBzdGF0aWMgdm9pZCBpOHh4X2NvbXB1
dGVfZHBsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogc3RhdGljIHZvaWQgaW50ZWxfc2V0
X3BpcGVfdGltaW5ncyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7
CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5z
Y29kZXI7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAm
Y3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJ
dTMyIGNydGNfdnRvdGFsLCBjcnRjX3ZibGFua19lbmQ7CiAJaW50IHZzeW5jc2hpZnQgPSAwOwog
CkBAIC04MTc1LDcgKzgxNzUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZXRfcGlwZV90aW1pbmdz
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgdm9p
ZCBpbnRlbF9zZXRfcGlwZV9zcmNfc2l6ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9
IGNydGMtPnBpcGU7CiAKQEAgLTgxODksNyArODE4OSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nl
dF9waXBlX3NyY19zaXplKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogCiBzdGF0aWMgYm9vbCBpbnRlbF9waXBlX2lzX2ludGVybGFjZWQoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNy
dGMtPmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+
Y3B1X3RyYW5zY29kZXI7CiAKIAlpZiAoSVNfR0VOKGRldl9wcml2LCAyKSkKQEAgLTgyMTEsMzkg
KzgyMTEsMzkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZ2V0X3BpcGVfdGltaW5ncyhzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YywKIAl1MzIgdG1wOwogCiAJdG1wID0gSTkxNV9SRUFEKEhUT1RBTChjcHVf
dHJhbnNjb2RlcikpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oZGlz
cGxheSA9ICh0bXAgJiAweGZmZmYpICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfaHRvdGFsID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxheSA9ICh0bXAgJiAweGZmZmYpICsgMTsK
KwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCA9ICgodG1wID4+IDE2
KSAmIDB4ZmZmZikgKyAxOwogCiAJaWYgKCF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2Rl
cikpIHsKIAkJdG1wID0gSTkxNV9SRUFEKEhCTEFOSyhjcHVfdHJhbnNjb2RlcikpOwotCQlwaXBl
X2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGJsYW5rX3N0YXJ0ID0KKwkJcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfc3RhcnQgPQogCQkJCQkJCSh0bXAg
JiAweGZmZmYpICsgMTsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hi
bGFua19lbmQgPQorCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hibGFua19l
bmQgPQogCQkJCQkJKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CiAJfQogCXRtcCA9IEk5MTVf
UkVBRChIU1lOQyhjcHVfdHJhbnNjb2RlcikpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVk
X21vZGUuY3J0Y19oc3luY19zdGFydCA9ICh0bXAgJiAweGZmZmYpICsgMTsKLQlwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfZW5kID0gKCh0bXAgPj4gMTYpICYgMHhm
ZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19zdGFy
dCA9ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX2hzeW5jX2VuZCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCiAJdG1wID0gSTkx
NV9SRUFEKFZUT1RBTChjcHVfdHJhbnNjb2RlcikpOwotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVz
dGVkX21vZGUuY3J0Y192ZGlzcGxheSA9ICh0bXAgJiAweGZmZmYpICsgMTsKLQlwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsID0gKCh0bXAgPj4gMTYpICYgMHhmZmZm
KSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheSA9ICh0
bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3Z0
b3RhbCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwogCiAJaWYgKCF0cmFuc2NvZGVyX2lz
X2RzaShjcHVfdHJhbnNjb2RlcikpIHsKIAkJdG1wID0gSTkxNV9SRUFEKFZCTEFOSyhjcHVfdHJh
bnNjb2RlcikpOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5r
X3N0YXJ0ID0KKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192Ymxhbmtfc3Rh
cnQgPQogCQkJCQkJCSh0bXAgJiAweGZmZmYpICsgMTsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRq
dXN0ZWRfbW9kZS5jcnRjX3ZibGFua19lbmQgPQorCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZS5jcnRjX3ZibGFua19lbmQgPQogCQkJCQkJKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7
CiAJfQogCXRtcCA9IEk5MTVfUkVBRChWU1lOQyhjcHVfdHJhbnNjb2RlcikpOwotCXBpcGVfY29u
ZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192c3luY19zdGFydCA9ICh0bXAgJiAweGZmZmYp
ICsgMTsKLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfZW5kID0g
KCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuY3J0Y192c3luY19zdGFydCA9ICh0bXAgJiAweGZmZmYpICsgMTsKKwlwaXBlX2NvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZCA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikg
KyAxOwogCiAJaWYgKGludGVsX3BpcGVfaXNfaW50ZXJsYWNlZChwaXBlX2NvbmZpZykpIHsKLQkJ
cGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBEUk1fTU9ERV9GTEFHX0lO
VEVSTEFDRTsKLQkJcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCAr
PSAxOwotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5rX2VuZCAr
PSAxOworCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRTsKKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192dG90
YWwgKz0gMTsKKwkJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192YmxhbmtfZW5k
ICs9IDE7CiAJfQogfQogCkBAIC04MjU4LDI3ICs4MjU4LDI3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2dldF9waXBlX3NyY19zaXplKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCXBpcGVfY29uZmln
LT5waXBlX3NyY19oID0gKHRtcCAmIDB4ZmZmZikgKyAxOwogCXBpcGVfY29uZmlnLT5waXBlX3Ny
Y193ID0gKCh0bXAgPj4gMTYpICYgMHhmZmZmKSArIDE7CiAKLQlwaXBlX2NvbmZpZy0+YmFzZS5t
b2RlLnZkaXNwbGF5ID0gcGlwZV9jb25maWctPnBpcGVfc3JjX2g7Ci0JcGlwZV9jb25maWctPmJh
c2UubW9kZS5oZGlzcGxheSA9IHBpcGVfY29uZmlnLT5waXBlX3NyY193OworCXBpcGVfY29uZmln
LT5ody5tb2RlLnZkaXNwbGF5ID0gcGlwZV9jb25maWctPnBpcGVfc3JjX2g7CisJcGlwZV9jb25m
aWctPmh3Lm1vZGUuaGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdzsKIH0KIAogdm9p
ZCBpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25maWcoc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1v
ZGUsCiAJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKLQltb2Rl
LT5oZGlzcGxheSA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxh
eTsKLQltb2RlLT5odG90YWwgPSBwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNf
aHRvdGFsOwotCW1vZGUtPmhzeW5jX3N0YXJ0ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX2hzeW5jX3N0YXJ0OwotCW1vZGUtPmhzeW5jX2VuZCA9IHBpcGVfY29uZmlnLT5i
YXNlLmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQ7CisJbW9kZS0+aGRpc3BsYXkgPSBwaXBl
X2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OworCW1vZGUtPmh0b3RhbCA9
IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsOworCW1vZGUtPmhzeW5j
X3N0YXJ0ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19zdGFydDsK
Kwltb2RlLT5oc3luY19lbmQgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hz
eW5jX2VuZDsKIAotCW1vZGUtPnZkaXNwbGF5ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX3ZkaXNwbGF5OwotCW1vZGUtPnZ0b3RhbCA9IHBpcGVfY29uZmlnLT5iYXNlLmFk
anVzdGVkX21vZGUuY3J0Y192dG90YWw7Ci0JbW9kZS0+dnN5bmNfc3RhcnQgPSBwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfc3RhcnQ7Ci0JbW9kZS0+dnN5bmNfZW5k
ID0gcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZDsKKwltb2Rl
LT52ZGlzcGxheSA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3BsYXk7
CisJbW9kZS0+dnRvdGFsID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192dG90
YWw7CisJbW9kZS0+dnN5bmNfc3RhcnQgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX3ZzeW5jX3N0YXJ0OworCW1vZGUtPnZzeW5jX2VuZCA9IHBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlLmNydGNfdnN5bmNfZW5kOwogCi0JbW9kZS0+ZmxhZ3MgPSBwaXBlX2NvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzOworCW1vZGUtPmZsYWdzID0gcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGUuZmxhZ3M7CiAJbW9kZS0+dHlwZSA9IERSTV9NT0RFX1RZUEVfRFJJVkVS
OwogCi0JbW9kZS0+Y2xvY2sgPSBwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNf
Y2xvY2s7CisJbW9kZS0+Y2xvY2sgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X2Nsb2NrOwogCiAJbW9kZS0+aHN5bmMgPSBkcm1fbW9kZV9oc3luYyhtb2RlKTsKIAltb2RlLT52
cmVmcmVzaCA9IGRybV9tb2RlX3ZyZWZyZXNoKG1vZGUpOwpAQCAtODI4Nyw3ICs4Mjg3LDcgQEAg
dm9pZCBpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25maWcoc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUsCiAKIHN0YXRpYyB2b2lkIGk5eHhfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXUz
MiBwaXBlY29uZjsKIApAQCAtODMyNCw3ICs4MzI0LDcgQEAgc3RhdGljIHZvaWQgaTl4eF9zZXRf
cGlwZWNvbmYoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCX0K
IAl9CiAKLQlpZiAoY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01P
REVfRkxBR19JTlRFUkxBQ0UpIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5m
bGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKSB7CiAJCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpIDwgNCB8fAogCQkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9P
VVRQVVRfU0RWTykpCiAJCQlwaXBlY29uZiB8PSBQSVBFQ09ORl9JTlRFUkxBQ0VfV19GSUVMRF9J
TkRJQ0FUSU9OOwpAQCAtODczMyw3ICs4NzMzLDcgQEAgYmR3X2dldF9waXBlbWlzY19vdXRwdXRf
Zm9ybWF0KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCiBzdGF0aWMgdm9pZCBpOXh4X2dldF9w
aXBlX2NvbG9yX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFz
ZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxf
cGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIGk5eHhfcGxhbmVfaWQgaTl4
eF9wbGFuZSA9IHBsYW5lLT5pOXh4X3BsYW5lOwpAQCAtODg1Niw3ICs4ODU2LDcgQEAgc3RhdGlj
IGJvb2wgaTl4eF9nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJICog
YnV0IGluIGNhc2UgdGhlIHBpcGUgaXMgZW5hYmxlZCB3L28gYW55IHBvcnRzIHdlIG5lZWQgYSBz
YW5lCiAJICogZGVmYXVsdC4KIAkgKi8KLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
LmNydGNfY2xvY2sgPQorCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sg
PQogCQlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayAvIHBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBs
aWVyOwogCiAJcmV0ID0gdHJ1ZTsKQEAgLTkzNzEsNyArOTM3MSw3IEBAIHZvaWQgaW50ZWxfaW5p
dF9wY2hfcmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogc3RhdGlj
IHZvaWQgaXJvbmxha2Vfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBl
ID0gY3J0Yy0+cGlwZTsKIAl1MzIgdmFsOwpAQCAtOTM5OSw3ICs5Mzk5LDcgQEAgc3RhdGljIHZv
aWQgaXJvbmxha2Vfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogCWlmIChjcnRjX3N0YXRlLT5kaXRoZXIpCiAJCXZhbCB8PSAoUElQRUNPTkZf
RElUSEVSX0VOIHwgUElQRUNPTkZfRElUSEVSX1RZUEVfU1ApOwogCi0JaWYgKGNydGNfc3RhdGUt
PmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQorCWlm
IChjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRF
UkxBQ0UpCiAJCXZhbCB8PSBQSVBFQ09ORl9JTlRFUkxBQ0VEX0lMSzsKIAllbHNlCiAJCXZhbCB8
PSBQSVBFQ09ORl9QUk9HUkVTU0lWRTsKQEAgLTk0MjUsNyArOTQyNSw3IEBAIHN0YXRpYyB2b2lk
IGlyb25sYWtlX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIAogc3RhdGljIHZvaWQgaGFzd2VsbF9zZXRfcGlwZWNvbmYoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5z
Y29kZXI7CiAJdTMyIHZhbCA9IDA7CkBAIC05NDMzLDcgKzk0MzMsNyBAQCBzdGF0aWMgdm9pZCBo
YXN3ZWxsX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgJiYgY3J0Y19zdGF0ZS0+ZGl0aGVyKQog
CQl2YWwgfD0gKFBJUEVDT05GX0RJVEhFUl9FTiB8IFBJUEVDT05GX0RJVEhFUl9UWVBFX1NQKTsK
IAotCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9G
TEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQl2YWwgfD0gUElQRUNPTkZfSU5URVJMQUNFRF9J
TEs7CiAJZWxzZQogCQl2YWwgfD0gUElQRUNPTkZfUFJPR1JFU1NJVkU7CkBAIC05NDQ4LDcgKzk0
NDgsNyBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX3NldF9waXBlY29uZihjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogc3RhdGljIHZvaWQgYmR3X3NldF9waXBlbWlz
Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKIAl1MzIgdmFsID0gMDsKIApAQCAtOTYzNCw3ICs5NjM0LDcgQEAgc3Rh
dGljIGludCBpcm9ubGFrZV9jcnRjX2NvbXB1dGVfY2xvY2soc3RydWN0IGludGVsX2NydGMgKmNy
dGMsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQotCQl0b19p
bnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZSk7CisJCXRvX2ludGVsX2F0
b21pY19zdGF0ZShjcnRjX3N0YXRlLT51YXBpLnN0YXRlKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxf
bGltaXQgKmxpbWl0OwogCWludCByZWZjbGsgPSAxMjAwMDA7CiAKQEAgLTEwMDU5LDcgKzEwMDU5
LDcgQEAgc3RhdGljIGludCBoYXN3ZWxsX2NydGNfY29tcHV0ZV9jbG9jayhzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9
Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKKwkJdG9f
aW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCiAJaWYgKCFpbnRl
bF9jcnRjX2hhc190eXBlKGNydGNfc3RhdGUsIElOVEVMX09VVFBVVF9EU0kpIHx8CiAJICAgIElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKQEAgLTEwNjMwLDcgKzEwNjMwLDcgQEAgc3RhdGlj
IGludCBpbnRlbF9jaGVja19jdXJzb3Ioc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJfQogCiAJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBs
YW5lX3N0YXRlLT5iYXNlLAotCQkJCQkJICAmY3J0Y19zdGF0ZS0+YmFzZSwKKwkJCQkJCSAgJmNy
dGNfc3RhdGUtPnVhcGksCiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJ
CQkJCSAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLAogCQkJCQkJICB0cnVlLCB0cnVlKTsK
QEAgLTEwODE3LDcgKzEwODE3LDcgQEAgaTl4eF9jdXJzb3JfbWF4X3N0cmlkZShzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lLAogCiBzdGF0aWMgdTMyIGk5eHhfY3Vyc29yX2N0bF9jcnRjKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwogCXUzMiBjbnRsID0gMDsKIApAQCAtMTEyMjksMTIgKzExMjI5LDEyIEBAIGludCBp
bnRlbF9nZXRfbG9hZF9kZXRlY3RfcGlwZShzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
LAogCQlnb3RvIGZhaWw7CiAJfQogCi0JY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgPSBjcnRjX3N0
YXRlLT5iYXNlLmVuYWJsZSA9IHRydWU7CisJY3J0Y19zdGF0ZS0+dWFwaS5hY3RpdmUgPSBjcnRj
X3N0YXRlLT51YXBpLmVuYWJsZSA9IHRydWU7CiAKIAlpZiAoIW1vZGUpCiAJCW1vZGUgPSAmbG9h
ZF9kZXRlY3RfbW9kZTsKIAotCXJldCA9IGRybV9hdG9taWNfc2V0X21vZGVfZm9yX2NydGMoJmNy
dGNfc3RhdGUtPmJhc2UsIG1vZGUpOworCXJldCA9IGRybV9hdG9taWNfc2V0X21vZGVfZm9yX2Ny
dGMoJmNydGNfc3RhdGUtPnVhcGksIG1vZGUpOwogCWlmIChyZXQpCiAJCWdvdG8gZmFpbDsKIApA
QCAtMTE0NDIsNyArMTE0NDIsNyBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9wY2hfY2xvY2tfZ2V0
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCSAqIHdlIG1heSBuZWVkIHNvbWUgaWRlYSBmb3Ig
dGhlIGRvdGNsb2NrIGFueXdheS4KIAkgKiBDYWxjdWxhdGUgb25lIGJhc2VkIG9uIHRoZSBGREkg
Y29uZmlndXJhdGlvbi4KIAkgKi8KLQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmNy
dGNfY2xvY2sgPQorCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPQog
CQlpbnRlbF9kb3RjbG9ja19jYWxjdWxhdGUoaW50ZWxfZmRpX2xpbmtfZnJlcShkZXZfcHJpdiwg
cGlwZV9jb25maWcpLAogCQkJCQkgJnBpcGVfY29uZmlnLT5mZGlfbV9uKTsKIH0KQEAgLTExNDcy
LDcgKzExNDcyLDcgQEAgaW50ZWxfZW5jb2Rlcl9jdXJyZW50X21vZGUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIpCiAJCXJldHVybiBOVUxMOwogCX0KIAotCWNydGNfc3RhdGUtPmJhc2Uu
Y3J0YyA9ICZjcnRjLT5iYXNlOworCWNydGNfc3RhdGUtPnVhcGkuY3J0YyA9ICZjcnRjLT5iYXNl
OwogCiAJaWYgKCFkZXZfcHJpdi0+ZGlzcGxheS5nZXRfcGlwZV9jb25maWcoY3J0YywgY3J0Y19z
dGF0ZSkpIHsKIAkJa2ZyZWUoY3J0Y19zdGF0ZSk7CkBAIC0xMTU0MywxMiArMTE1NDMsMTIgQEAg
aW50IGludGVsX3BsYW5lX2F0b21pY19jYWxjX2NoYW5nZXMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKm9sZF9jcnRjX3N0YXQKIAkJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
IAlib29sIG1vZGVfY2hhbmdlZCA9IG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSk7Ci0JYm9vbCB3
YXNfY3J0Y19lbmFibGVkID0gb2xkX2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlOwotCWJvb2wgaXNf
Y3J0Y19lbmFibGVkID0gY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJYm9vbCB3YXNfY3J0Y19l
bmFibGVkID0gb2xkX2NydGNfc3RhdGUtPmh3LmFjdGl2ZTsKKwlib29sIGlzX2NydGNfZW5hYmxl
ZCA9IGNydGNfc3RhdGUtPmh3LmFjdGl2ZTsKIAlib29sIHR1cm5fb2ZmLCB0dXJuX29uLCB2aXNp
YmxlLCB3YXNfdmlzaWJsZTsKIAlpbnQgcmV0OwogCkBAIC0xMTcxNSw5ICsxMTcxNSw5IEBAIHN0
YXRpYyBpbnQgaWNsX2FkZF9saW5rZWRfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogCiBzdGF0aWMgaW50IGljbF9jaGVja19udjEyX3BsYW5lcyhzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRj
X3N0YXRlLT5iYXNlLnN0YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9
IHRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT51YXBpLnN0YXRlKTsKIAlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lLCAqbGlua2VkOwogCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGU7CiAJaW50IGk7CkBAIC0xMTc4Nyw5ICsxMTc4Nyw5IEBAIHN0YXRpYyBpbnQg
aWNsX2NoZWNrX252MTJfcGxhbmVzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogCiBzdGF0aWMgYm9vbCBjOF9wbGFuZXNfY2hhbmdlZChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0
ZShuZXdfY3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShu
ZXdfY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm9sZF9jcnRjX3N0YXRlID0KIAkJaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShz
dGF0ZSwgY3J0Yyk7CiAKQEAgLTExODA3LDEwICsxMTgwNywxMCBAQCBzdGF0aWMgaW50IGludGVs
X2NydGNfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY3J0YyAqX2NydGMsCiAJYm9vbCBtb2RlX2No
YW5nZWQgPSBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpOwogCiAJaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPCA1ICYmICFJU19HNFgoZGV2X3ByaXYpICYmCi0JICAgIG1vZGVfY2hhbmdlZCAmJiAh
Y3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJICAgIG1vZGVfY2hhbmdlZCAmJiAhY3J0Y19zdGF0
ZS0+aHcuYWN0aXZlKQogCQljcnRjX3N0YXRlLT51cGRhdGVfd21fcG9zdCA9IHRydWU7CiAKLQlp
ZiAobW9kZV9jaGFuZ2VkICYmIGNydGNfc3RhdGUtPmJhc2UuZW5hYmxlICYmCisJaWYgKG1vZGVf
Y2hhbmdlZCAmJiBjcnRjX3N0YXRlLT5ody5lbmFibGUgJiYKIAkgICAgZGV2X3ByaXYtPmRpc3Bs
YXkuY3J0Y19jb21wdXRlX2Nsb2NrICYmCiAJICAgICFXQVJOX09OKGNydGNfc3RhdGUtPnNoYXJl
ZF9kcGxsKSkgewogCQlyZXQgPSBkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2so
Y3J0YywgY3J0Y19zdGF0ZSk7CkBAIC0xMTgyMywxMCArMTE4MjMsMTAgQEAgc3RhdGljIGludCBp
bnRlbF9jcnRjX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKl9jcnRjLAogCSAqIHdoZW4g
QzggcGxhbmVzIGFyZSBnZXR0aW5nIGVuYWJsZWQvZGlzYWJsZWQuCiAJICovCiAJaWYgKGM4X3Bs
YW5lc19jaGFuZ2VkKGNydGNfc3RhdGUpKQotCQljcnRjX3N0YXRlLT5iYXNlLmNvbG9yX21nbXRf
Y2hhbmdlZCA9IHRydWU7CisJCWNydGNfc3RhdGUtPnVhcGkuY29sb3JfbWdtdF9jaGFuZ2VkID0g
dHJ1ZTsKIAogCWlmIChtb2RlX2NoYW5nZWQgfHwgY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgfHwK
LQkgICAgY3J0Y19zdGF0ZS0+YmFzZS5jb2xvcl9tZ210X2NoYW5nZWQpIHsKKwkgICAgY3J0Y19z
dGF0ZS0+dWFwaS5jb2xvcl9tZ210X2NoYW5nZWQpIHsKIAkJcmV0ID0gaW50ZWxfY29sb3JfY2hl
Y2soY3J0Y19zdGF0ZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwpAQCAtMTE5NDgsNyAr
MTE5NDgsNyBAQCBjb21wdXRlX2Jhc2VsaW5lX3BpcGVfYnBwKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAogCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
Ci0Jc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gcGlwZV9jb25maWctPmJhc2Uuc3Rh
dGU7CisJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gcGlwZV9jb25maWctPnVhcGku
c3RhdGU7CiAJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKIAlzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlOwogCWludCBicHAsIGk7CkBAIC0xMjEwMSw3
ICsxMjEwMSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGlwZV9jb25maWcoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJCSAgIHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCSAgIGNvbnN0IGNoYXIgKmNvbnRleHQpCiB7Ci0Jc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNy
dGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZp
Zy0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CkBAIC0xMjExMCwxNCArMTIx
MTAsMTQgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHVtcF9waXBlX2NvbmZpZyhjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAKIAlEUk1fREVCVUdfS01TKCJbQ1JUQzol
ZDolc10gZW5hYmxlOiAlcyAlc1xuIiwKIAkJICAgICAgY3J0Yy0+YmFzZS5iYXNlLmlkLCBjcnRj
LT5iYXNlLm5hbWUsCi0JCSAgICAgIHllc25vKHBpcGVfY29uZmlnLT5iYXNlLmVuYWJsZSksIGNv
bnRleHQpOworCQkgICAgICB5ZXNubyhwaXBlX2NvbmZpZy0+aHcuZW5hYmxlKSwgY29udGV4dCk7
CiAKLQlpZiAoIXBpcGVfY29uZmlnLT5iYXNlLmVuYWJsZSkKKwlpZiAoIXBpcGVfY29uZmlnLT5o
dy5lbmFibGUpCiAJCWdvdG8gZHVtcF9wbGFuZXM7CiAKIAlzbnByaW50Zl9vdXRwdXRfdHlwZXMo
YnVmLCBzaXplb2YoYnVmKSwgcGlwZV9jb25maWctPm91dHB1dF90eXBlcyk7CiAJRFJNX0RFQlVH
X0tNUygiYWN0aXZlOiAlcywgb3V0cHV0X3R5cGVzOiAlcyAoMHgleCksIG91dHB1dCBmb3JtYXQ6
ICVzXG4iLAotCQkgICAgICB5ZXNubyhwaXBlX2NvbmZpZy0+YmFzZS5hY3RpdmUpLAorCQkgICAg
ICB5ZXNubyhwaXBlX2NvbmZpZy0+aHcuYWN0aXZlKSwKIAkJICAgICAgYnVmLCBwaXBlX2NvbmZp
Zy0+b3V0cHV0X3R5cGVzLAogCQkgICAgICBvdXRwdXRfZm9ybWF0cyhwaXBlX2NvbmZpZy0+b3V0
cHV0X2Zvcm1hdCkpOwogCkBAIC0xMjE1NywxMCArMTIxNTcsMTAgQEAgc3RhdGljIHZvaWQgaW50
ZWxfZHVtcF9waXBlX2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcsCiAJCWludGVsX2R1bXBfaW5mb2ZyYW1lKGRldl9wcml2LCAmcGlwZV9jb25maWctPmlu
Zm9mcmFtZXMuaGRtaSk7CiAKIAlEUk1fREVCVUdfS01TKCJyZXF1ZXN0ZWQgbW9kZTpcbiIpOwot
CWRybV9tb2RlX2RlYnVnX3ByaW50bW9kZWxpbmUoJnBpcGVfY29uZmlnLT5iYXNlLm1vZGUpOwor
CWRybV9tb2RlX2RlYnVnX3ByaW50bW9kZWxpbmUoJnBpcGVfY29uZmlnLT5ody5tb2RlKTsKIAlE
Uk1fREVCVUdfS01TKCJhZGp1c3RlZCBtb2RlOlxuIik7Ci0JZHJtX21vZGVfZGVidWdfcHJpbnRt
b2RlbGluZSgmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZSk7Ci0JaW50ZWxfZHVtcF9j
cnRjX3RpbWluZ3MoJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUpOworCWRybV9tb2Rl
X2RlYnVnX3ByaW50bW9kZWxpbmUoJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlKTsKKwlp
bnRlbF9kdW1wX2NydGNfdGltaW5ncygmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUpOwog
CURSTV9ERUJVR19LTVMoInBvcnQgY2xvY2s6ICVkLCBwaXBlIHNyYyBzaXplOiAlZHglZCwgcGl4
ZWwgcmF0ZSAlZFxuIiwKIAkJICAgICAgcGlwZV9jb25maWctPnBvcnRfY2xvY2ssCiAJCSAgICAg
IHBpcGVfY29uZmlnLT5waXBlX3NyY193LCBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfaCwKQEAgLTEy
Mjc4LDcgKzEyMjc4LDcgQEAgc3RhdGljIGludAogY2xlYXJfaW50ZWxfY3J0Y19zdGF0ZShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsK
KwkJdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnNhdmVkX3N0YXRlOwogCiAJc2F2ZWRfc3RhdGUgPSBremFsbG9jKHNpemVvZigq
c2F2ZWRfc3RhdGUpLCBHRlBfS0VSTkVMKTsKQEAgLTEyMzAxLDkgKzEyMzAxLDEwIEBAIGNsZWFy
X2ludGVsX2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJ
CXNhdmVkX3N0YXRlLT53bSA9IGNydGNfc3RhdGUtPndtOwogCiAJLyogS2VlcCBiYXNlIGRybV9j
cnRjX3N0YXRlIGludGFjdCwgb25seSBjbGVhciBvdXIgZXh0ZW5kZWQgc3RydWN0ICovCi0JQlVJ
TERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlLCBiYXNlKSk7Ci0JbWVt
Y3B5KCZjcnRjX3N0YXRlLT5iYXNlICsgMSwgJnNhdmVkX3N0YXRlLT5iYXNlICsgMSwKLQkgICAg
ICAgc2l6ZW9mKCpjcnRjX3N0YXRlKSAtIHNpemVvZihjcnRjX3N0YXRlLT5iYXNlKSk7CisJQlVJ
TERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlLCB1YXBpKSk7CisJQlVJ
TERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlLCBodykpOworCW1lbWNw
eSgmY3J0Y19zdGF0ZS0+dWFwaSArIDEsICZzYXZlZF9zdGF0ZS0+dWFwaSArIDEsCisJICAgICAg
IHNpemVvZigqY3J0Y19zdGF0ZSkgLSBzaXplb2YoY3J0Y19zdGF0ZS0+dWFwaSkpOwogCiAJa2Zy
ZWUoc2F2ZWRfc3RhdGUpOwogCXJldHVybiAwOwpAQCAtMTIzMTIsOCArMTIzMTMsOCBAQCBjbGVh
cl9pbnRlbF9jcnRjX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
c3RhdGljIGludAogaW50ZWxfbW9kZXNldF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlwZV9jb25m
aWctPmJhc2UuY3J0YzsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBwaXBlX2Nv
bmZpZy0+YmFzZS5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+
dWFwaS5jcnRjOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IHBpcGVfY29uZmln
LT51YXBpLnN0YXRlOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCXN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNv
bm5lY3Rvcl9zdGF0ZTsKQEAgLTEyMzMzLDEzICsxMjMzNCwxMyBAQCBpbnRlbF9tb2Rlc2V0X3Bp
cGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIAkgKiBwb3Np
dGl2ZSBvciBuZWdhdGl2ZSBwb2xhcml0eSBpcyByZXF1ZXN0ZWQsIHRyZWF0IHRoaXMgYXMgbWVh
bmluZwogCSAqIG5lZ2F0aXZlIHBvbGFyaXR5LgogCSAqLwotCWlmICghKHBpcGVfY29uZmlnLT5i
YXNlLmFkanVzdGVkX21vZGUuZmxhZ3MgJgorCWlmICghKHBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlLmZsYWdzICYKIAkgICAgICAoRFJNX01PREVfRkxBR19QSFNZTkMgfCBEUk1fTU9ERV9G
TEFHX05IU1lOQykpKQotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9
IERSTV9NT0RFX0ZMQUdfTkhTWU5DOworCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5m
bGFncyB8PSBEUk1fTU9ERV9GTEFHX05IU1lOQzsKIAotCWlmICghKHBpcGVfY29uZmlnLT5iYXNl
LmFkanVzdGVkX21vZGUuZmxhZ3MgJgorCWlmICghKHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9t
b2RlLmZsYWdzICYKIAkgICAgICAoRFJNX01PREVfRkxBR19QVlNZTkMgfCBEUk1fTU9ERV9GTEFH
X05WU1lOQykpKQotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IERS
TV9NT0RFX0ZMQUdfTlZTWU5DOworCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFn
cyB8PSBEUk1fTU9ERV9GTEFHX05WU1lOQzsKIAogCXJldCA9IGNvbXB1dGVfYmFzZWxpbmVfcGlw
ZV9icHAodG9faW50ZWxfY3J0YyhjcnRjKSwKIAkJCQkJcGlwZV9jb25maWcpOwpAQCAtMTIzNTYs
NyArMTIzNTcsNyBAQCBpbnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpwaXBlX2NvbmZpZykKIAkgKiBjb21wdXRhdGlvbiB0byBjbGVhcmx5IGRpc3Rpbmd1
aXNoIGl0IGZyb20gdGhlIGFkanVzdGVkIG1vZGUsIHdoaWNoCiAJICogY2FuIGJlIGNoYW5nZWQg
YnkgdGhlIGNvbm5lY3RvcnMgaW4gdGhlIGJlbG93IHJldHJ5IGxvb3AuCiAJICovCi0JZHJtX21v
ZGVfZ2V0X2h2X3RpbWluZygmcGlwZV9jb25maWctPmJhc2UubW9kZSwKKwlkcm1fbW9kZV9nZXRf
aHZfdGltaW5nKCZwaXBlX2NvbmZpZy0+aHcubW9kZSwKIAkJCSAgICAgICAmcGlwZV9jb25maWct
PnBpcGVfc3JjX3csCiAJCQkgICAgICAgJnBpcGVfY29uZmlnLT5waXBlX3NyY19oKTsKIApAQCAt
MTIzODksNyArMTIzOTAsNyBAQCBpbnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIAlwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGll
ciA9IDE7CiAKIAkvKiBGaWxsIGluIGRlZmF1bHQgY3J0YyB0aW1pbmdzLCBhbGxvdyBlbmNvZGVy
cyB0byBvdmVyd3JpdGUgdGhlbS4gKi8KLQlkcm1fbW9kZV9zZXRfY3J0Y2luZm8oJnBpcGVfY29u
ZmlnLT5iYXNlLmFkanVzdGVkX21vZGUsCisJZHJtX21vZGVfc2V0X2NydGNpbmZvKCZwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZSwKIAkJCSAgICAgIENSVENfU1RFUkVPX0RPVUJMRSk7CiAK
IAkvKiBQYXNzIG91ciBtb2RlIHRvIHRoZSBjb25uZWN0b3JzIGFuZCB0aGUgQ1JUQyB0byBnaXZl
IHRoZW0gYSBjaGFuY2UgdG8KQEAgLTEyNDE0LDcgKzEyNDE1LDcgQEAgaW50ZWxfbW9kZXNldF9w
aXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJLyogU2V0
IGRlZmF1bHQgcG9ydCBjbG9jayBpZiBub3Qgb3ZlcndyaXR0ZW4gYnkgdGhlIGVuY29kZXIuIE5l
ZWRzIHRvIGJlCiAJICogZG9uZSBhZnRlcndhcmRzIGluIGNhc2UgdGhlIGVuY29kZXIgYWRqdXN0
cyB0aGUgbW9kZS4gKi8KIAlpZiAoIXBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrKQotCQlwaXBlX2Nv
bmZpZy0+cG9ydF9jbG9jayA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19j
bG9jaworCQlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3Rl
ZF9tb2RlLmNydGNfY2xvY2sKIAkJCSogcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXI7CiAK
IAlyZXQgPSBpbnRlbF9jcnRjX2NvbXB1dGVfY29uZmlnKHRvX2ludGVsX2NydGMoY3J0YyksIHBp
cGVfY29uZmlnKTsKQEAgLTEyNDU4LDcgKzEyNDU5LDcgQEAgYm9vbCBpbnRlbF9mdXp6eV9jbG9j
a19jaGVjayhpbnQgY2xvY2sxLCBpbnQgY2xvY2syKQogCiAJZGlmZiA9IGFicyhjbG9jazEgLSBj
bG9jazIpOwogCi0JaWYgKCgoKChkaWZmICsgY2xvY2sxICsgY2xvY2syKSAqIDEwMCkpIC8gKGNs
b2NrMSArIGNsb2NrMikpIDwgMTA1KQorCWlmICgoKCgoZGlmZiArIGNsb2NrMSArIGNsb2NrMikg
KiAxMDApKSAvIChjbG9jazEgKyBjbG9jazIpKSA8IDEwMSkKIAkJcmV0dXJuIHRydWU7CiAKIAly
ZXR1cm4gZmFsc2U7CkBAIC0xMjU3OCwxMiArMTI1NzksMTIgQEAgaW50ZWxfcGlwZV9jb25maWdf
Y29tcGFyZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3VycmVudF9jb25maWcsCiAJ
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCSAgYm9v
bCBmYXN0c2V0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3VycmVudF9jb25maWctPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGN1cnJlbnRfY29uZmlnLT51YXBpLmNydGMtPmRldik7
CiAJYm9vbCByZXQgPSB0cnVlOwogCXUzMiBicF9nYW1tYSA9IDA7CiAJYm9vbCBmaXh1cF9pbmhl
cml0ZWQgPSBmYXN0c2V0ICYmCi0JCShjdXJyZW50X2NvbmZpZy0+YmFzZS5tb2RlLnByaXZhdGVf
ZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklURUQpICYmCi0JCSEocGlwZV9jb25maWctPmJh
c2UubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVEKTsKKwkJKGN1
cnJlbnRfY29uZmlnLT5ody5tb2RlLnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhF
UklURUQpICYmCisJCSEocGlwZV9jb25maWctPmh3Lm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVf
TU9ERV9GTEFHX0lOSEVSSVRFRCk7CiAKIAlpZiAoZml4dXBfaW5oZXJpdGVkICYmICFmYXN0Ym9v
dF9lbmFibGVkKGRldl9wcml2KSkgewogCQlEUk1fREVCVUdfS01TKCJpbml0aWFsIG1vZGVzZXQg
YW5kIGZhc3Rib290IG5vdCBzZXRcbiIpOwpAQCAtMTI3NzIsMTkgKzEyNzczLDE5IEBAIGludGVs
X3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmN1cnJl
bnRfY29uZmlnLAogCiAJUElQRV9DT05GX0NIRUNLX1gob3V0cHV0X3R5cGVzKTsKIAotCVBJUEVf
Q09ORl9DSEVDS19JKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5KTsKLQlQSVBFX0NP
TkZfQ0hFQ0tfSShiYXNlLmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwpOwotCVBJUEVfQ09ORl9D
SEVDS19JKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hibGFua19zdGFydCk7Ci0JUElQRV9DT05G
X0NIRUNLX0koYmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGJsYW5rX2VuZCk7Ci0JUElQRV9DT05G
X0NIRUNLX0koYmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfc3RhcnQpOwotCVBJUEVfQ09O
Rl9DSEVDS19JKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX2VuZCk7CisJUElQRV9DT05G
X0NIRUNLX0koaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5KTsKKwlQSVBFX0NPTkZfQ0hF
Q0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSSho
dy5hZGp1c3RlZF9tb2RlLmNydGNfaGJsYW5rX3N0YXJ0KTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSSho
dy5hZGp1c3RlZF9tb2RlLmNydGNfaGJsYW5rX2VuZCk7CisJUElQRV9DT05GX0NIRUNLX0koaHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5jX3N0YXJ0KTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSShody5h
ZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfZW5kKTsKIAotCVBJUEVfQ09ORl9DSEVDS19JKGJhc2Uu
YWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShiYXNlLmFk
anVzdGVkX21vZGUuY3J0Y192dG90YWwpOwotCVBJUEVfQ09ORl9DSEVDS19JKGJhc2UuYWRqdXN0
ZWRfbW9kZS5jcnRjX3ZibGFua19zdGFydCk7Ci0JUElQRV9DT05GX0NIRUNLX0koYmFzZS5hZGp1
c3RlZF9tb2RlLmNydGNfdmJsYW5rX2VuZCk7Ci0JUElQRV9DT05GX0NIRUNLX0koYmFzZS5hZGp1
c3RlZF9tb2RlLmNydGNfdnN5bmNfc3RhcnQpOwotCVBJUEVfQ09ORl9DSEVDS19JKGJhc2UuYWRq
dXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZCk7CisJUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5KTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9t
b2RlLmNydGNfdnRvdGFsKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNy
dGNfdmJsYW5rX3N0YXJ0KTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNy
dGNfdmJsYW5rX2VuZCk7CisJUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X3ZzeW5jX3N0YXJ0KTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNf
dnN5bmNfZW5kKTsKIAogCVBJUEVfQ09ORl9DSEVDS19JKHBpeGVsX211bHRpcGxpZXIpOwogCVBJ
UEVfQ09ORl9DSEVDS19JKG91dHB1dF9mb3JtYXQpOwpAQCAtMTI4MDAsMTcgKzEyODAxLDE3IEBA
IGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmN1cnJlbnRfY29uZmlnLAogCiAJUElQRV9DT05GX0NIRUNLX0JPT0xfSU5DT01QTEVURShoYXNf
YXVkaW8pOwogCi0JUElQRV9DT05GX0NIRUNLX0ZMQUdTKGJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFn
cywKKwlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKIAkJCSAg
ICAgIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKTsKIAogCWlmICghUElQRV9DT05GX1FVSVJLKFBJ
UEVfQ09ORklHX1FVSVJLX01PREVfU1lOQ19GTEFHUykpIHsKLQkJUElQRV9DT05GX0NIRUNLX0ZM
QUdTKGJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncywKKwkJUElQRV9DT05GX0NIRUNLX0ZMQUdTKGh3
LmFkanVzdGVkX21vZGUuZmxhZ3MsCiAJCQkJICAgICAgRFJNX01PREVfRkxBR19QSFNZTkMpOwot
CQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoYmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzLAorCQlQSVBF
X0NPTkZfQ0hFQ0tfRkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKIAkJCQkgICAgICBEUk1f
TU9ERV9GTEFHX05IU1lOQyk7Ci0JCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhiYXNlLmFkanVzdGVk
X21vZGUuZmxhZ3MsCisJCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZs
YWdzLAogCQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfUFZTWU5DKTsKLQkJUElQRV9DT05GX0NIRUNL
X0ZMQUdTKGJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncywKKwkJUElQRV9DT05GX0NIRUNLX0ZMQUdT
KGh3LmFkanVzdGVkX21vZGUuZmxhZ3MsCiAJCQkJICAgICAgRFJNX01PREVfRkxBR19OVlNZTkMp
OwogCX0KIApAQCAtMTI4NDksNyArMTI4NTAsNyBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAogCQlicF9n
YW1tYSA9IGludGVsX2NvbG9yX2dldF9nYW1tYV9iaXRfcHJlY2lzaW9uKHBpcGVfY29uZmlnKTsK
IAkJaWYgKGJwX2dhbW1hKQotCQkJUElQRV9DT05GX0NIRUNLX0NPTE9SX0xVVChnYW1tYV9tb2Rl
LCBiYXNlLmdhbW1hX2x1dCwgYnBfZ2FtbWEpOworCQkJUElQRV9DT05GX0NIRUNLX0NPTE9SX0xV
VChnYW1tYV9tb2RlLCB1YXBpLmdhbW1hX2x1dCwgYnBfZ2FtbWEpOwogCiAJfQogCkBAIC0xMjg5
NCw3ICsxMjg5NSw3IEBAIGludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmN1cnJlbnRfY29uZmlnLAogCWlmIChJU19HNFgoZGV2X3ByaXYpIHx8
IElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkKIAkJUElQRV9DT05GX0NIRUNLX0kocGlwZV9icHAp
OwogCi0JUElQRV9DT05GX0NIRUNLX0NMT0NLX0ZVWlpZKGJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRj
X2Nsb2NrKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkoaHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX2Nsb2NrKTsKIAlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkocG9ydF9jbG9jayk7CiAK
IAlQSVBFX0NPTkZfQ0hFQ0tfSShtaW5fdm9sdGFnZV9sZXZlbCk7CkBAIC0xMjkyNSw3ICsxMjky
Niw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3BpcGVfY29uZmlnX3Nhbml0eV9jaGVjayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKHBpcGVfY29uZmlnLT5oYXNfcGNoX2Vu
Y29kZXIpIHsKIAkJaW50IGZkaV9kb3RjbG9jayA9IGludGVsX2RvdGNsb2NrX2NhbGN1bGF0ZShp
bnRlbF9mZGlfbGlua19mcmVxKGRldl9wcml2LCBwaXBlX2NvbmZpZyksCiAJCQkJCQkJICAgICZw
aXBlX2NvbmZpZy0+ZmRpX21fbik7Ci0JCWludCBkb3RjbG9jayA9IHBpcGVfY29uZmlnLT5iYXNl
LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKwkJaW50IGRvdGNsb2NrID0gcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKIAogCQkvKgogCQkgKiBGREkgYWxyZWFkeSBw
cm92aWRlZCBvbmUgaWRlYSBmb3IgdGhlIGRvdGNsb2NrLgpAQCAtMTI5NTMsNyArMTI5NTQsNyBA
QCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJ
Y29uc3QgZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWludCBwbGFuZSwgbGV2ZWwsIG1h
eF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOwogCi0JaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPCA5IHx8ICFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPCA5IHx8ICFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1
cm47CiAKIAlodyA9IGt6YWxsb2Moc2l6ZW9mKCpodyksIEdGUF9LRVJORUwpOwpAQCAtMTMxNjIs
MTIgKzEzMTYzLDEyIEBAIHZlcmlmeV9jcnRjX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
LAogCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZTsKIAlib29sIGFjdGl2ZTsKIAotCXN0
YXRlID0gb2xkX2NydGNfc3RhdGUtPmJhc2Uuc3RhdGU7Ci0JX19kcm1fYXRvbWljX2hlbHBlcl9j
cnRjX2Rlc3Ryb3lfc3RhdGUoJm9sZF9jcnRjX3N0YXRlLT5iYXNlKTsKKwlzdGF0ZSA9IG9sZF9j
cnRjX3N0YXRlLT51YXBpLnN0YXRlOworCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95
X3N0YXRlKCZvbGRfY3J0Y19zdGF0ZS0+dWFwaSk7CiAJcGlwZV9jb25maWcgPSBvbGRfY3J0Y19z
dGF0ZTsKIAltZW1zZXQocGlwZV9jb25maWcsIDAsIHNpemVvZigqcGlwZV9jb25maWcpKTsKLQlw
aXBlX2NvbmZpZy0+YmFzZS5jcnRjID0gJmNydGMtPmJhc2U7Ci0JcGlwZV9jb25maWctPmJhc2Uu
c3RhdGUgPSBzdGF0ZTsKKwlwaXBlX2NvbmZpZy0+dWFwaS5jcnRjID0gJmNydGMtPmJhc2U7CisJ
cGlwZV9jb25maWctPnVhcGkuc3RhdGUgPSBzdGF0ZTsKIAogCURSTV9ERUJVR19LTVMoIltDUlRD
OiVkOiVzXVxuIiwgY3J0Yy0+YmFzZS5iYXNlLmlkLCBjcnRjLT5iYXNlLm5hbWUpOwogCkBAIC0x
MzE3NSwyMyArMTMxNzYsMjYgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAKIAkvKiB3ZSBrZWVwIGJvdGggcGlwZXMgZW5hYmxlZCBvbiA4MzAgKi8KIAlpZiAo
SVNfSTgzMChkZXZfcHJpdikpCi0JCWFjdGl2ZSA9IG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2
ZTsKKwkJYWN0aXZlID0gbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZTsKIAotCUk5MTVfU1RBVEVf
V0FSTihuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgIT0gYWN0aXZlLAotCSAgICAgImNydGMg
YWN0aXZlIHN0YXRlIGRvZXNuJ3QgbWF0Y2ggd2l0aCBodyBzdGF0ZSAiCi0JICAgICAiKGV4cGVj
dGVkICVpLCBmb3VuZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgYWN0aXZl
KTsKKwlJOTE1X1NUQVRFX1dBUk4obmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAhPSBhY3RpdmUs
CisJCQkiY3J0YyBhY3RpdmUgc3RhdGUgZG9lc24ndCBtYXRjaCB3aXRoIGh3IHN0YXRlICIKKwkJ
CSIoZXhwZWN0ZWQgJWksIGZvdW5kICVpKVxuIiwKKwkJCW5ld19jcnRjX3N0YXRlLT5ody5hY3Rp
dmUsIGFjdGl2ZSk7CiAKLQlJOTE1X1NUQVRFX1dBUk4oY3J0Yy0+YWN0aXZlICE9IG5ld19jcnRj
X3N0YXRlLT5iYXNlLmFjdGl2ZSwKLQkgICAgICJ0cmFuc2l0aW9uYWwgYWN0aXZlIHN0YXRlIGRv
ZXMgbm90IG1hdGNoIGF0b21pYyBodyBzdGF0ZSAiCi0JICAgICAiKGV4cGVjdGVkICVpLCBmb3Vu
ZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgY3J0Yy0+YWN0aXZlKTsKKwlJ
OTE1X1NUQVRFX1dBUk4oY3J0Yy0+YWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUs
CisJCQkidHJhbnNpdGlvbmFsIGFjdGl2ZSBzdGF0ZSBkb2VzIG5vdCBtYXRjaCBhdG9taWMgaHcg
c3RhdGUgIgorCQkJIihleHBlY3RlZCAlaSwgZm91bmQgJWkpXG4iLAorCQkJbmV3X2NydGNfc3Rh
dGUtPmh3LmFjdGl2ZSwgY3J0Yy0+YWN0aXZlKTsKIAogCWZvcl9lYWNoX2VuY29kZXJfb25fY3J0
YyhkZXYsICZjcnRjLT5iYXNlLCBlbmNvZGVyKSB7CiAJCWVudW0gcGlwZSBwaXBlOwogCiAJCWFj
dGl2ZSA9IGVuY29kZXItPmdldF9od19zdGF0ZShlbmNvZGVyLCAmcGlwZSk7Ci0JCUk5MTVfU1RB
VEVfV0FSTihhY3RpdmUgIT0gbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlLAotCQkJIltFTkNP
REVSOiVpXSBhY3RpdmUgJWkgd2l0aCBjcnRjIGFjdGl2ZSAlaVxuIiwKLQkJCWVuY29kZXItPmJh
c2UuYmFzZS5pZCwgYWN0aXZlLCBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpOworCQlJOTE1
X1NUQVRFX1dBUk4oYWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUsCisJCQkJIltF
TkNPREVSOiVpXSBhY3RpdmUgJWkgd2l0aCBjcnRjIGFjdGl2ZSAlaVxuIiwKKwkJCQllbmNvZGVy
LT5iYXNlLmJhc2UuaWQsIGFjdGl2ZSwKKwkJCQluZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKTsK
IAogCQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICYmIGNydGMtPnBpcGUgIT0gcGlwZSwKIAkJCQki
RW5jb2RlciBjb25uZWN0ZWQgdG8gd3JvbmcgcGlwZSAlY1xuIiwKQEAgLTEzMjAzLDcgKzEzMjA3
LDcgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAlpbnRl
bF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShwaXBlX2NvbmZpZyk7CiAKLQlpZiAoIW5ld19jcnRj
X3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJ
CXJldHVybjsKIAogCWludGVsX3BpcGVfY29uZmlnX3Nhbml0eV9jaGVjayhkZXZfcHJpdiwgcGlw
ZV9jb25maWcpOwpAQCAtMTMyNjUsNyArMTMyNjksNyBAQCB2ZXJpZnlfc2luZ2xlX2RwbGxfc3Rh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJY3J0Y19tYXNrID0gZHJt
X2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CiAKLQlpZiAobmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0
aXZlKQorCWlmIChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQlJOTE1X1NUQVRFX1dBUk4o
IShwbGwtPmFjdGl2ZV9tYXNrICYgY3J0Y19tYXNrKSwKIAkJCQkicGxsIGFjdGl2ZSBtaXNtYXRj
aCAoZXhwZWN0ZWQgcGlwZSAlYyBpbiBhY3RpdmUgbWFzayAweCUwMngpXG4iLAogCQkJCXBpcGVf
bmFtZShkcm1fY3J0Y19pbmRleCgmY3J0Yy0+YmFzZSkpLCBwbGwtPmFjdGl2ZV9tYXNrKTsKQEAg
LTEzMzQzLDcgKzEzMzQ3LDcgQEAgaW50ZWxfbW9kZXNldF92ZXJpZnlfZGlzYWJsZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgdm9pZCB1cGRhdGVfc2Nhbmxp
bmVfb2Zmc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewot
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNl
LmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJLyoKQEAgLTEzMzc0LDcgKzEzMzc4LDcgQEAgc3Rh
dGljIHZvaWQgdXBkYXRlX3NjYW5saW5lX29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKiBhbnN3ZXIgdGhhdCdzIHNsaWdodGx5IGluIHRoZSBmdXR1
cmUuCiAJICovCiAJaWYgKElTX0dFTihkZXZfcHJpdiwgMikpIHsKLQkJY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3Rl
ZF9tb2RlOworCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9
ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCQlpbnQgdnRvdGFsOwogCiAJCXZ0b3Rh
bCA9IGFkanVzdGVkX21vZGUtPmNydGNfdnRvdGFsOwpAQCAtMTM0MjQsNyArMTM0MjgsNyBAQCBz
dGF0aWMgaW50IGhhc3dlbGxfbW9kZV9zZXRfcGxhbmVzX3dvcmthcm91bmQoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAkvKiBsb29rIGF0IGFsbCBjcnRjJ3MgdGhhdCBhcmUg
Z29pbmcgdG8gYmUgZW5hYmxlZCBpbiBkdXJpbmcgbW9kZXNldCAqLwogCWZvcl9lYWNoX25ld19p
bnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7Ci0JCWlmICgh
Y3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgfHwKKwkJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUg
fHwKIAkJICAgICFuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpKQogCQkJY29udGludWU7CiAKQEAg
LTEzNDQ5LDcgKzEzNDUzLDcgQEAgc3RhdGljIGludCBoYXN3ZWxsX21vZGVfc2V0X3BsYW5lc193
b3JrYXJvdW5kKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCiAJCWNydGNfc3Rh
dGUtPmhzd193b3JrYXJvdW5kX3BpcGUgPSBJTlZBTElEX1BJUEU7CiAKLQkJaWYgKCFjcnRjX3N0
YXRlLT5iYXNlLmFjdGl2ZSB8fAorCQlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fAogCQkg
ICAgbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKSkKIAkJCWNvbnRpbnVlOwogCkBAIC0xMzQ5Miwx
MiArMTM0OTYsMTIgQEAgc3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2NoZWNrcyhzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2lu
X3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0
YXRlLCBpKSB7Ci0JCWlmIChuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCWlmIChuZXdf
Y3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJc3RhdGUtPmFjdGl2ZV9waXBlcyB8PSBCSVQoY3J0
Yy0+cGlwZSk7CiAJCWVsc2UKIAkJCXN0YXRlLT5hY3RpdmVfcGlwZXMgJj0gfkJJVChjcnRjLT5w
aXBlKTsKIAotCQlpZiAob2xkX2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlICE9IG5ld19jcnRjX3N0
YXRlLT5iYXNlLmFjdGl2ZSkKKwkJaWYgKG9sZF9jcnRjX3N0YXRlLT5ody5hY3RpdmUgIT0gbmV3
X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCXN0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzIHw9
IEJJVChjcnRjLT5waXBlKTsKIAl9CiAKQEAgLTEzNTM2LDcgKzEzNTQwLDcgQEAgc3RhdGljIHZv
aWQgaW50ZWxfY3J0Y19jaGVja19mYXN0c2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpvbGRfY3J0Y19zdGEKIAlpZiAoIWludGVsX3BpcGVfY29uZmlnX2NvbXBhcmUob2xkX2NydGNf
c3RhdGUsIG5ld19jcnRjX3N0YXRlLCB0cnVlKSkKIAkJcmV0dXJuOwogCi0JbmV3X2NydGNfc3Rh
dGUtPmJhc2UubW9kZV9jaGFuZ2VkID0gZmFsc2U7CisJbmV3X2NydGNfc3RhdGUtPnVhcGkubW9k
ZV9jaGFuZ2VkID0gZmFsc2U7CiAJbmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9waXBlID0gdHJ1ZTsK
IAogCS8qCkBAIC0xMzU3MSw5ICsxMzU3NSw5IEBAIHN0YXRpYyBpbnQgaW50ZWxfYXRvbWljX2No
ZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJLyogQ2F0Y2ggSTkxNV9NT0RFX0ZMQUdfSU5I
RVJJVEVEICovCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNy
dGMsIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaWYg
KG5ld19jcnRjX3N0YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFncyAhPQotCQkgICAgb2xkX2Ny
dGNfc3RhdGUtPmJhc2UubW9kZS5wcml2YXRlX2ZsYWdzKQotCQkJbmV3X2NydGNfc3RhdGUtPmJh
c2UubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKwkJaWYgKG5ld19jcnRjX3N0YXRlLT5ody5tb2RlLnBy
aXZhdGVfZmxhZ3MgIT0KKwkJICAgIG9sZF9jcnRjX3N0YXRlLT5ody5tb2RlLnByaXZhdGVfZmxh
Z3MpCisJCQluZXdfY3J0Y19zdGF0ZS0+dWFwaS5tb2RlX2NoYW5nZWQgPSB0cnVlOwogCX0KIAog
CXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrX21vZGVzZXQoZGV2LCAmc3RhdGUtPmJhc2Up
OwpAQCAtMTM1ODUsNyArMTM1ODksNyBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jaGVjayhz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQlpZiAoIW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3Rh
dGUpKQogCQkJY29udGludWU7CiAKLQkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUp
IHsKKwkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUpIHsKIAkJCWFueV9tcyA9IHRy
dWU7CiAJCQljb250aW51ZTsKIAkJfQpAQCAtMTM2OTMsMTEgKzEzNjk3LDExIEBAIHZvaWQgaW50
ZWxfY3J0Y19hcm1fZmlmb191bmRlcnJ1bihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHN0YXRp
YyB2b2lkIGludGVsX3BpcGVfZmFzdHNldChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
b2xkX2NydGNfc3RhdGUsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
Km5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAKIAkv
KiBkcm1fYXRvbWljX2hlbHBlcl91cGRhdGVfbGVnYWN5X21vZGVzZXRfc3RhdGUgbWlnaHQgbm90
IGJlIGNhbGxlZC4gKi8KLQljcnRjLT5iYXNlLm1vZGUgPSBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5t
b2RlOworCWNydGMtPmJhc2UubW9kZSA9IG5ld19jcnRjX3N0YXRlLT5ody5tb2RlOwogCiAJLyoK
IAkgKiBVcGRhdGUgcGlwZSBzaXplIGFuZCBhZGp1c3QgZml0dGVyIGlmIG5lZWRlZDogdGhlIHJl
YXNvbiBmb3IgdGhpcyBpcwpAQCAtMTM3MzgsNyArMTM3NDIsNyBAQCBzdGF0aWMgdm9pZCBjb21t
aXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJICogQ1JU
QyB3YXMgZW5hYmxlZC4KIAkgKi8KIAlpZiAoIW1vZGVzZXQpIHsKLQkJaWYgKG5ld19jcnRjX3N0
YXRlLT5iYXNlLmNvbG9yX21nbXRfY2hhbmdlZCB8fAorCQlpZiAobmV3X2NydGNfc3RhdGUtPnVh
cGkuY29sb3JfbWdtdF9jaGFuZ2VkIHx8CiAJCSAgICBuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3Bp
cGUpCiAJCQlpbnRlbF9jb2xvcl9jb21taXQobmV3X2NydGNfc3RhdGUpOwogCkBAIC0xMzgwNSw3
ICsxMzgwOSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3VwZGF0ZV9jcnRjKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogICAgICAgICAgKiBvZiBlbmFibGluZyB0aGVtIG9uIHRoZSBDUlRDJ3MgZmly
c3QgZmFzdHNldC4KICAgICAgICAgICovCiAJaWYgKG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlw
ZSAmJiAhbW9kZXNldCAmJgotCSAgICBvbGRfY3J0Y19zdGF0ZS0+YmFzZS5tb2RlLnByaXZhdGVf
ZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklURUQpCisJICAgIG9sZF9jcnRjX3N0YXRlLT5o
dy5tb2RlLnByaXZhdGVfZmxhZ3MgJiBJOTE1X01PREVfRkxBR19JTkhFUklURUQpCiAJCWludGVs
X2NydGNfYXJtX2ZpZm9fdW5kZXJydW4oY3J0YywgbmV3X2NydGNfc3RhdGUpOwogfQogCkBAIC0x
MzgzNywxMSArMTM4NDEsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfb2xkX2NydGNfc3RhdGVfZGlz
YWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJaW50ZWxfY2hlY2tfcGNo
X2ZpZm9fdW5kZXJydW5zKGRldl9wcml2KTsKIAogCS8qIEZJWE1FIHVuaWZ5IHRoaXMgZm9yIGFs
bCBwbGF0Zm9ybXMgKi8KLQlpZiAoIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCWlm
ICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJgogCSAgICAhSEFTX0dNQ0goZGV2X3ByaXYp
ICYmCiAJICAgIGRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcykKLQkJZGV2X3By
aXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKHN0YXRlLAotCQkJCQkJICAgICBuZXdfY3J0
Y19zdGF0ZSk7CisJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0ZSwg
bmV3X2NydGNfc3RhdGUpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9jb21taXRfbW9kZXNldF9k
aXNhYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKQEAgLTEzODY0LDcgKzEz
ODY3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAkJaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShv
bGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOwogCi0JCWlmIChvbGRfY3J0Y19zdGF0ZS0+
YmFzZS5hY3RpdmUpCisJCWlmIChvbGRfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJaW50ZWxf
b2xkX2NydGNfc3RhdGVfZGlzYWJsZXMoc3RhdGUsCiAJCQkJCQkgICAgICBvbGRfY3J0Y19zdGF0
ZSwKIAkJCQkJCSAgICAgIG5ld19jcnRjX3N0YXRlLApAQCAtMTM4NzksNyArMTM4ODIsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogCWludCBpOwogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNf
aW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkg
ewotCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwkJaWYgKCFuZXdfY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlKQogCQkJY29udGludWU7CiAKIAkJaW50ZWxfdXBkYXRlX2NydGMoY3J0
Yywgc3RhdGUsIG9sZF9jcnRjX3N0YXRlLApAQCAtMTM5MDIsNyArMTM5MDUsNyBAQCBzdGF0aWMg
dm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBj
cnRjLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUsIGkpCiAJCS8qIGlnbm9yZSBhbGxv
Y2F0aW9ucyBmb3IgY3J0YydzIHRoYXQgaGF2ZSBiZWVuIHR1cm5lZCBvZmYuICovCi0JCWlmIChu
ZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCWlmIChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0
aXZlKQogCQkJZW50cmllc1tpXSA9IG9sZF9jcnRjX3N0YXRlLT53bS5za2wuZGRiOwogCiAJLyog
SWYgMm5kIERCdWYgc2xpY2UgcmVxdWlyZWQsIGVuYWJsZSBpdCBoZXJlICovCkBAIC0xMzkyNCw3
ICsxMzkyNyw3IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCiAJCQlwaXBlID0gY3J0Yy0+cGlwZTsKIAot
CQkJaWYgKHVwZGF0ZWQgJiBjbWFzayB8fCAhbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQor
CQkJaWYgKHVwZGF0ZWQgJiBjbWFzayB8fCAhbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJ
CQljb250aW51ZTsKIAogCQkJaWYgKHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcygmbmV3X2Ny
dGNfc3RhdGUtPndtLnNrbC5kZGIsCkBAIC0xMzk0Myw3ICsxMzk0Niw3IEBAIHN0YXRpYyB2b2lk
IHNrbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCQkJICovCiAJCQlpZiAoIXNrbF9kZGJfZW50cnlfZXF1YWwoJm5ld19jcnRjX3N0YXRl
LT53bS5za2wuZGRiLAogCQkJCQkJICZvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYikgJiYKLQkJ
CSAgICAhbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlX2NoYW5nZWQgJiYKKwkJCSAgICAhbmV3
X2NydGNfc3RhdGUtPnVhcGkuYWN0aXZlX2NoYW5nZWQgJiYKIAkJCSAgICBzdGF0ZS0+d21fcmVz
dWx0cy5kaXJ0eV9waXBlcyAhPSB1cGRhdGVkKQogCQkJCXZibF93YWl0ID0gdHJ1ZTsKIApAQCAt
MTQwNzYsMTIgKzE0MDc5LDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFp
bChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJYm9vbCBtb2Rlc2V0ID0gbmVl
ZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSk7CiAKIAkJLyogQ29tcGxldGUgZXZlbnRzIGZvciBu
b3cgZGlzYWJsZSBwaXBlcyBoZXJlLiAqLwotCQlpZiAobW9kZXNldCAmJiAhbmV3X2NydGNfc3Rh
dGUtPmJhc2UuYWN0aXZlICYmIG5ld19jcnRjX3N0YXRlLT5iYXNlLmV2ZW50KSB7CisJCWlmICht
b2Rlc2V0ICYmICFuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlICYmIG5ld19jcnRjX3N0YXRlLT51
YXBpLmV2ZW50KSB7CiAJCQlzcGluX2xvY2tfaXJxKCZkZXYtPmV2ZW50X2xvY2spOwotCQkJZHJt
X2NydGNfc2VuZF92YmxhbmtfZXZlbnQoJmNydGMtPmJhc2UsIG5ld19jcnRjX3N0YXRlLT5iYXNl
LmV2ZW50KTsKKwkJCWRybV9jcnRjX3NlbmRfdmJsYW5rX2V2ZW50KCZjcnRjLT5iYXNlLAorCQkJ
CQkJICAgbmV3X2NydGNfc3RhdGUtPnVhcGkuZXZlbnQpOwogCQkJc3Bpbl91bmxvY2tfaXJxKCZk
ZXYtPmV2ZW50X2xvY2spOwogCi0JCQluZXdfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudCA9IE5VTEw7
CisJCQluZXdfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCA9IE5VTEw7CiAJCX0KIAl9CiAKQEAgLTE0
MTEyLDkgKzE0MTE2LDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWRybV9hdG9taWNfaGVscGVyX3dhaXRf
Zm9yX2ZsaXBfZG9uZShkZXYsICZzdGF0ZS0+YmFzZSk7CiAKIAlmb3JfZWFjaF9uZXdfaW50ZWxf
Y3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaWYgKG5l
d19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCQlpZiAobmV3X2NydGNfc3RhdGUtPmh3LmFj
dGl2ZSAmJgogCQkgICAgIW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpICYmCi0JCSAgICAo
bmV3X2NydGNfc3RhdGUtPmJhc2UuY29sb3JfbWdtdF9jaGFuZ2VkIHx8CisJCSAgICAobmV3X2Ny
dGNfc3RhdGUtPnVhcGkuY29sb3JfbWdtdF9jaGFuZ2VkIHx8CiAJCSAgICAgbmV3X2NydGNfc3Rh
dGUtPnVwZGF0ZV9waXBlKSkKIAkJCWludGVsX2NvbG9yX2xvYWRfbHV0cyhuZXdfY3J0Y19zdGF0
ZSk7CiAJfQpAQCAtMTQ1NzMsMTYgKzE0NTc3LDE2IEBAIGludAogc2tsX21heF9zY2FsZShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgICAgICBjb25zdCBzdHJ1
Y3QgZHJtX2Zvcm1hdF9pbmZvICpmb3JtYXQpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJ
aW50IG1heF9zY2FsZTsKIAlpbnQgY3J0Y19jbG9jaywgbWF4X2RvdGNsaywgdG1wY2xrMSwgdG1w
Y2xrMjsKIAotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5lbmFibGUpCisJaWYgKCFjcnRjX3N0YXRl
LT5ody5lbmFibGUpCiAJCXJldHVybiBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkc7CiAKLQlj
cnRjX2Nsb2NrID0gY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7Ci0J
bWF4X2RvdGNsayA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRl
KS0+Y2RjbGsubG9naWNhbC5jZGNsazsKKwljcnRjX2Nsb2NrID0gY3J0Y19zdGF0ZS0+aHcuYWRq
dXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCW1heF9kb3RjbGsgPSB0b19pbnRlbF9hdG9taWNfc3Rh
dGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSktPmNkY2xrLmxvZ2ljYWwuY2RjbGs7CiAKIAlpZiAo
SVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKIAkJ
bWF4X2RvdGNsayAqPSAyOwpAQCAtMTQ3MTUsNyArMTQ3MTksNyBAQCBpbnRlbF9sZWdhY3lfY3Vy
c29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkgKiBXaGVuIGNydGMgaXMgaW5h
Y3RpdmUgb3IgdGhlcmUgaXMgYSBtb2Rlc2V0IHBlbmRpbmcsCiAJICogd2FpdCBmb3IgaXQgdG8g
Y29tcGxldGUgaW4gdGhlIHNsb3dwYXRoCiAJICovCi0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFj
dGl2ZSB8fCBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpIHx8CisJaWYgKCFjcnRjX3N0YXRlLT5o
dy5hY3RpdmUgfHwgbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKSB8fAogCSAgICBjcnRjX3N0YXRl
LT51cGRhdGVfcGlwZSkKIAkJZ290byBzbG93OwogCkBAIC0xNDgwOSw3ICsxNDgxMyw3IEBAIGlu
dGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0X2ZyZWU6CiAJaWYgKG5l
d19jcnRjX3N0YXRlKQotCQlpbnRlbF9jcnRjX2Rlc3Ryb3lfc3RhdGUoY3J0YywgJm5ld19jcnRj
X3N0YXRlLT5iYXNlKTsKKwkJaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlKGNydGMsICZuZXdfY3J0
Y19zdGF0ZS0+dWFwaSk7CiAJaWYgKHJldCkKIAkJaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZShw
bGFuZSwgbmV3X3BsYW5lX3N0YXRlKTsKIAllbHNlCkBAIC0xNTEzNSw3ICsxNTEzOSw3IEBAIHN0
YXRpYyBpbnQgaW50ZWxfY3J0Y19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgZW51bSBwaXBlIHBpcGUpCiAJCXJldCA9IC1FTk9NRU07CiAJCWdvdG8gZmFpbDsKIAl9Ci0J
X19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZpbnRlbF9jcnRjLT5iYXNlLCAmY3J0Y19z
dGF0ZS0+YmFzZSk7CisJX19kcm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZpbnRlbF9jcnRj
LT5iYXNlLCAmY3J0Y19zdGF0ZS0+dWFwaSk7CiAJaW50ZWxfY3J0Yy0+Y29uZmlnID0gY3J0Y19z
dGF0ZTsKIAogCXByaW1hcnkgPSBpbnRlbF9wcmltYXJ5X3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwg
cGlwZSk7CkBAIC0xNjQ5MCw3ICsxNjQ5NCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nhbml0aXpl
X2NydGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICBJOTE1X1JFQUQocmVnKSAmIH5Q
SVBFQ09ORl9GUkFNRV9TVEFSVF9ERUxBWV9NQVNLKTsKIAl9CiAKLQlpZiAoY3J0Y19zdGF0ZS0+
YmFzZS5hY3RpdmUpIHsKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmU7CiAKIAkJLyogRGlzYWJsZSBldmVyeXRoaW5nIGJ1dCB0aGUgcHJp
bWFyeSBwbGFuZSAqLwpAQCAtMTY1MTUsMTAgKzE2NTE5LDEwIEBAIHN0YXRpYyB2b2lkIGludGVs
X3Nhbml0aXplX2NydGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIAkvKiBBZGp1c3QgdGhl
IHN0YXRlIG9mIHRoZSBvdXRwdXQgcGlwZSBhY2NvcmRpbmcgdG8gd2hldGhlciB3ZQogCSAqIGhh
dmUgYWN0aXZlIGNvbm5lY3RvcnMvZW5jb2RlcnMuICovCi0JaWYgKGNydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlICYmICFpbnRlbF9jcnRjX2hhc19lbmNvZGVycyhjcnRjKSkKKwlpZiAoY3J0Y19zdGF0
ZS0+aHcuYWN0aXZlICYmICFpbnRlbF9jcnRjX2hhc19lbmNvZGVycyhjcnRjKSkKIAkJaW50ZWxf
Y3J0Y19kaXNhYmxlX25vYXRvbWljKCZjcnRjLT5iYXNlLCBjdHgpOwogCi0JaWYgKGNydGNfc3Rh
dGUtPmJhc2UuYWN0aXZlIHx8IEhBU19HTUNIKGRldl9wcml2KSkgeworCWlmIChjcnRjX3N0YXRl
LT5ody5hY3RpdmUgfHwgSEFTX0dNQ0goZGV2X3ByaXYpKSB7CiAJCS8qCiAJCSAqIFdlIHN0YXJ0
IG91dCB3aXRoIHVuZGVycnVuIHJlcG9ydGluZyBkaXNhYmxlZCB0byBhdm9pZCByYWNlcy4KIAkJ
ICogRm9yIGNvcnJlY3QgYm9va2tlZXBpbmcgbWFyayB0aGlzIG9uIGFjdGl2ZSBjcnRjcy4KQEAg
LTE2NTQ5LDcgKzE2NTUzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2FuaXRpemVfY3J0YyhzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogc3RhdGljIGJvb2wgaGFzX2JvZ3VzX2RwbGxfY29uZmln
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRj
LT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCiAJLyoKIAkgKiBTb21lIFNOQiBCSU9TZW4gKGVn
LiBBU1VTIEs1M1NWKSBhcmUga25vd24gdG8gbWlzcHJvZ3JhbQpAQCAtMTY1NjIsNyArMTY1NjYs
NyBAQCBzdGF0aWMgYm9vbCBoYXNfYm9ndXNfZHBsbF9jb25maWcoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICogcm9hZC4KIAkgKi8KIAlyZXR1cm4gSVNfR0VO
KGRldl9wcml2LCA2KSAmJgotCQljcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCQljcnRjX3N0
YXRlLT5ody5hY3RpdmUgJiYKIAkJY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwgJiYKIAkJY3J0Y19z
dGF0ZS0+cG9ydF9jbG9jayA9PSAwOwogfQpAQCAtMTY1NzksNyArMTY1ODMsNyBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9zYW5pdGl6ZV9lbmNvZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
KQogCSAqIGVuY29kZXIgaXMgYWN0aXZlIGFuZCB0cnlpbmcgdG8gcmVhZCBmcm9tIGEgcGlwZSkg
YW5kIHRoZQogCSAqIHBpcGUgaXRzZWxmIGJlaW5nIGFjdGl2ZS4gKi8KIAlib29sIGhhc19hY3Rp
dmVfY3J0YyA9IGNydGNfc3RhdGUgJiYKLQkJY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJCWNy
dGNfc3RhdGUtPmh3LmFjdGl2ZTsKIAogCWlmIChjcnRjX3N0YXRlICYmIGhhc19ib2d1c19kcGxs
X2NvbmZpZyhjcnRjX3N0YXRlKSkgewogCQlEUk1fREVCVUdfS01TKCJCSU9TIGhhcyBtaXNwcm9n
cmFtbWVkIHRoZSBoYXJkd2FyZS4gRGlzYWJsaW5nIHBpcGUgJWNcbiIsCkBAIC0xNjY4MywyMiAr
MTY2ODcsMjIgQEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlID0KIAkJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CiAKLQkJX19k
cm1fYXRvbWljX2hlbHBlcl9jcnRjX2Rlc3Ryb3lfc3RhdGUoJmNydGNfc3RhdGUtPmJhc2UpOwor
CQlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfZGVzdHJveV9zdGF0ZSgmY3J0Y19zdGF0ZS0+dWFw
aSk7CiAJCW1lbXNldChjcnRjX3N0YXRlLCAwLCBzaXplb2YoKmNydGNfc3RhdGUpKTsKLQkJX19k
cm1fYXRvbWljX2hlbHBlcl9jcnRjX3Jlc2V0KCZjcnRjLT5iYXNlLCAmY3J0Y19zdGF0ZS0+YmFz
ZSk7CisJCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19yZXNldCgmY3J0Yy0+YmFzZSwgJmNydGNf
c3RhdGUtPnVhcGkpOwogCi0JCWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlID0gY3J0Y19zdGF0ZS0+
YmFzZS5lbmFibGUgPQorCQljcnRjX3N0YXRlLT5ody5hY3RpdmUgPSBjcnRjX3N0YXRlLT5ody5l
bmFibGUgPQogCQkJZGV2X3ByaXYtPmRpc3BsYXkuZ2V0X3BpcGVfY29uZmlnKGNydGMsIGNydGNf
c3RhdGUpOwogCi0JCWNydGMtPmJhc2UuZW5hYmxlZCA9IGNydGNfc3RhdGUtPmJhc2UuZW5hYmxl
OwotCQljcnRjLT5hY3RpdmUgPSBjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZTsKKwkJY3J0Yy0+YmFz
ZS5lbmFibGVkID0gY3J0Y19zdGF0ZS0+aHcuZW5hYmxlOworCQljcnRjLT5hY3RpdmUgPSBjcnRj
X3N0YXRlLT5ody5hY3RpdmU7CiAKLQkJaWYgKGNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCQlp
ZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQogCQkJZGV2X3ByaXYtPmFjdGl2ZV9waXBlcyB8PSBC
SVQoY3J0Yy0+cGlwZSk7CiAKIAkJRFJNX0RFQlVHX0tNUygiW0NSVEM6JWQ6JXNdIGh3IHN0YXRl
IHJlYWRvdXQ6ICVzXG4iLAogCQkJICAgICAgY3J0Yy0+YmFzZS5iYXNlLmlkLCBjcnRjLT5iYXNl
Lm5hbWUsCi0JCQkgICAgICBlbmFibGVkZGlzYWJsZWQoY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUp
KTsKKwkJCSAgICAgIGVuYWJsZWRkaXNhYmxlZChjcnRjX3N0YXRlLT5ody5hY3RpdmUpKTsKIAl9
CiAKIAlyZWFkb3V0X3BsYW5lX3N0YXRlKGRldl9wcml2KTsKQEAgLTE2NzIwLDcgKzE2NzI0LDcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYpCiAJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CiAJ
CQkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIAotCQkJaWYgKGNydGNf
c3RhdGUtPmJhc2UuYWN0aXZlICYmCisJCQlpZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlICYmCiAJ
CQkgICAgY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwgPT0gcGxsKQogCQkJCXBsbC0+c3RhdGUuY3J0
Y19tYXNrIHw9IDEgPDwgY3J0Yy0+cGlwZTsKIAkJfQpAQCAtMTY3NTQsMjEgKzE2NzU4LDI0IEBA
IHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2KQogCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRl
cik7CiAJZm9yX2VhY2hfaW50ZWxfY29ubmVjdG9yX2l0ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVy
KSB7CiAJCWlmIChjb25uZWN0b3ItPmdldF9od19zdGF0ZShjb25uZWN0b3IpKSB7Ci0JCQljb25u
ZWN0b3ItPmJhc2UuZHBtcyA9IERSTV9NT0RFX0RQTVNfT047CisJCQlzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IE5VTEw7CiAKKwkJCWNvbm5lY3Rvci0+YmFzZS5kcG1zID0g
RFJNX01PREVfRFBNU19PTjsKIAkJCWVuY29kZXIgPSBjb25uZWN0b3ItPmVuY29kZXI7CiAJCQlj
b25uZWN0b3ItPmJhc2UuZW5jb2RlciA9ICZlbmNvZGVyLT5iYXNlOwogCi0JCQlpZiAoZW5jb2Rl
ci0+YmFzZS5jcnRjICYmCi0JCQkgICAgZW5jb2Rlci0+YmFzZS5jcnRjLT5zdGF0ZS0+YWN0aXZl
KSB7CisJCQlpZiAoZW5jb2Rlci0+YmFzZS5jcnRjKQorCQkJCWNydGNfc3RhdGUgPSB0b19pbnRl
bF9jcnRjX3N0YXRlKGVuY29kZXItPmJhc2UuY3J0Yy0+c3RhdGUpOworCisJCQlpZiAoY3J0Y19z
dGF0ZSAmJiBjcnRjX3N0YXRlLT5ody5hY3RpdmUpIHsKIAkJCQkvKgogCQkJCSAqIFRoaXMgaGFz
IHRvIGJlIGRvbmUgZHVyaW5nIGhhcmR3YXJlIHJlYWRvdXQKIAkJCQkgKiBiZWNhdXNlIGFueXRo
aW5nIGNhbGxpbmcgLmNydGNfZGlzYWJsZSBtYXkKIAkJCQkgKiByZWx5IG9uIHRoZSBjb25uZWN0
b3JfbWFzayBiZWluZyBhY2N1cmF0ZS4KIAkJCQkgKi8KLQkJCQllbmNvZGVyLT5iYXNlLmNydGMt
PnN0YXRlLT5jb25uZWN0b3JfbWFzayB8PQorCQkJCWNydGNfc3RhdGUtPnVhcGkuY29ubmVjdG9y
X21hc2sgfD0KIAkJCQkJZHJtX2Nvbm5lY3Rvcl9tYXNrKCZjb25uZWN0b3ItPmJhc2UpOwotCQkJ
CWVuY29kZXItPmJhc2UuY3J0Yy0+c3RhdGUtPmVuY29kZXJfbWFzayB8PQorCQkJCWNydGNfc3Rh
dGUtPnVhcGkuZW5jb2Rlcl9tYXNrIHw9CiAJCQkJCWRybV9lbmNvZGVyX21hc2soJmVuY29kZXIt
PmJhc2UpOwogCQkJfQogCkBAIC0xNjc5MSwxMSArMTY3OTgsMTIgQEAgc3RhdGljIHZvaWQgaW50
ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCWlu
dCBtaW5fY2RjbGsgPSAwOwogCiAJCW1lbXNldCgmY3J0Yy0+YmFzZS5tb2RlLCAwLCBzaXplb2Yo
Y3J0Yy0+YmFzZS5tb2RlKSk7Ci0JCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkgeworCQlp
ZiAoY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCQlpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25m
aWcoJmNydGMtPmJhc2UubW9kZSwgY3J0Y19zdGF0ZSk7CiAJCQljcnRjLT5iYXNlLm1vZGUuaGRp
c3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY193OwogCQkJY3J0Yy0+YmFzZS5tb2RlLnZkaXNw
bGF5ID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaDsKLQkJCWludGVsX21vZGVfZnJvbV9waXBlX2Nv
bmZpZygmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLCBjcnRjX3N0YXRlKTsKKwkJCWlu
dGVsX21vZGVfZnJvbV9waXBlX2NvbmZpZygmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSwK
KwkJCQkJCSAgICBjcnRjX3N0YXRlKTsKIAkJCVdBUk5fT04oZHJtX2F0b21pY19zZXRfbW9kZV9m
b3JfY3J0YyhjcnRjLT5iYXNlLnN0YXRlLCAmY3J0Yy0+YmFzZS5tb2RlKSk7CiAKIAkJCS8qCkBA
IC0xNjgwNyw3ICsxNjgxNSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9o
d19zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQkJICogc2V0IGEgZmxhZyB0byBpbmRp
Y2F0ZSB0aGF0IGEgZnVsbCByZWNhbGN1bGF0aW9uIGlzCiAJCQkgKiBuZWVkZWQgb24gdGhlIG5l
eHQgY29tbWl0LgogCQkJICovCi0JCQljcnRjX3N0YXRlLT5iYXNlLm1vZGUucHJpdmF0ZV9mbGFn
cyA9IEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRDsKKwkJCWNydGNfc3RhdGUtPmh3Lm1vZGUucHJp
dmF0ZV9mbGFncyA9IEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRDsKIAogCQkJaW50ZWxfY3J0Y19j
b21wdXRlX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSk7CiAKQEAgLTE2ODE4LDcgKzE2ODI2LDcgQEAg
c3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYpCiAJCQl9CiAKIAkJCWRybV9jYWxjX3RpbWVzdGFtcGluZ19jb25zdGFudHMoJmNy
dGMtPmJhc2UsCi0JCQkJCQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZSk7CisJCQkJ
CQkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUpOwogCQkJdXBkYXRlX3NjYW5saW5lX29m
ZnNldChjcnRjX3N0YXRlKTsKIAkJfQogCkBAIC0xNjk4OSw3ICsxNjk5Nyw3IEBAIGludGVsX21v
ZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCQlkcm1fY3J0
Y192YmxhbmtfcmVzZXQoJmNydGMtPmJhc2UpOwogCi0JCWlmIChjcnRjX3N0YXRlLT5iYXNlLmFj
dGl2ZSkKKwkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCWludGVsX2NydGNfdmJsYW5r
X29uKGNydGNfc3RhdGUpOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuaAppbmRleCBiYzJjZjRiZWMwZTguLjQ0YTFjMzMxZDZiOSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTQ0MywxMCArNDQz
LDEwIEBAIGVudW0gcGh5X2ZpYSB7CiAjZGVmaW5lIGludGVsX2F0b21pY19jcnRjX3N0YXRlX2Zv
cl9lYWNoX3BsYW5lX3N0YXRlKCBcCiAJCSAgcGxhbmUsIHBsYW5lX3N0YXRlLCBcCiAJCSAgY3J0
Y19zdGF0ZSkgXAotCWZvcl9lYWNoX2ludGVsX3BsYW5lX21hc2soKChjcnRjX3N0YXRlKS0+YmFz
ZS5zdGF0ZS0+ZGV2KSwgKHBsYW5lKSwgXAotCQkJCSgoY3J0Y19zdGF0ZSktPmJhc2UucGxhbmVf
bWFzaykpIFwKKwlmb3JfZWFjaF9pbnRlbF9wbGFuZV9tYXNrKCgoY3J0Y19zdGF0ZSktPnVhcGku
c3RhdGUtPmRldiksIChwbGFuZSksIFwKKwkJCQkoKGNydGNfc3RhdGUpLT51YXBpLnBsYW5lX21h
c2spKSBcCiAJCWZvcl9lYWNoX2lmICgocGxhbmVfc3RhdGUgPSBcCi0JCQkgICAgICB0b19pbnRl
bF9wbGFuZV9zdGF0ZShfX2RybV9hdG9taWNfZ2V0X2N1cnJlbnRfcGxhbmVfc3RhdGUoKGNydGNf
c3RhdGUpLT5iYXNlLnN0YXRlLCAmcGxhbmUtPmJhc2UpKSkpCisJCQkgICAgICB0b19pbnRlbF9w
bGFuZV9zdGF0ZShfX2RybV9hdG9taWNfZ2V0X2N1cnJlbnRfcGxhbmVfc3RhdGUoKGNydGNfc3Rh
dGUpLT51YXBpLnN0YXRlLCAmcGxhbmUtPmJhc2UpKSkpCiAKIHZvaWQgaW50ZWxfbGlua19jb21w
dXRlX21fbih1MTYgYnBwLCBpbnQgbmxhbmVzLAogCQkJICAgIGludCBwaXhlbF9jbG9jaywgaW50
IGxpbmtfY2xvY2ssCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV90eXBlcy5oCmluZGV4IDUyNjQyMzQzN2Y2My4uMGVlNjllOGYwOTQyIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApA
QCAtNzQ5LDcgKzc0OSwzMSBAQCBlbnVtIGludGVsX291dHB1dF9mb3JtYXQgewogfTsKIAogc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgewotCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSBiYXNlOworCXVu
aW9uIHsKKwkvKgorCSAqIHVhcGkgKGRybSkgc3RhdGUuIFRoaXMgaXMgdGhlIHNvZnR3YXJlIHN0
YXRlIHNob3duIHRvIHVzZXJzcGFjZS4KKwkgKiBJbiBwYXJ0aWN1bGFyLCB0aGUgZm9sbG93aW5n
IG1lbWJlcnMgYXJlIHVzZWQgZm9yIGJvb2trZWVwaW5nOgorCSAqIC0gY3J0YworCSAqIC0gc3Rh
dGUKKwkgKiAtICpfY2hhbmdlZAorCSAqIC0gZXZlbnQKKwkgKiAtIGNvbW1pdAorCSAqIC0gbW9k
ZV9ibG9iCisJICovCisJc3RydWN0IGRybV9jcnRjX3N0YXRlIHVhcGk7CisKKwkvKgorCSAqIGFj
dHVhbCBoYXJkd2FyZSBzdGF0ZSwgdGhlIHN0YXRlIHdlIHByb2dyYW0gdG8gdGhlIGhhcmR3YXJl
LgorCSAqIFRoZSBmb2xsb3dpbmcgbWVtYmVycyBhcmUgdXNlZCB0byB2ZXJpZnkgdGhlIGhhcmR3
YXJlIHN0YXRlOgorCSAqIC0gZW5hYmxlCisJICogLSBhY3RpdmUKKwkgKiAtIG1vZGUgLyBhZGp1
c3RlZF9tb2RlCisJICogLSBjb2xvciBwcm9wZXJ0eSBibG9icy4KKwkgKgorCSAqIER1cmluZyBp
bml0aWFsIGh3IHJlYWRvdXQsIHRoZXkgbmVlZCB0byBiZSBjb3BpZWQgdG8gdWFwaS4KKwkgKi8K
KwlzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgaHc7CisJfTsKIAogCS8qKgogCSAqIHF1aXJrcyAtIGJp
dGZpZWxkIHdpdGggaHcgc3RhdGUgcmVhZG91dCBxdWlya3MKQEAgLTEwOTMsNyArMTExNyw3IEBA
IHN0cnVjdCBjeHNyX2xhdGVuY3kgewogCiAjZGVmaW5lIHRvX2ludGVsX2F0b21pY19zdGF0ZSh4
KSBjb250YWluZXJfb2YoeCwgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSwgYmFzZSkKICNkZWZp
bmUgdG9faW50ZWxfY3J0Yyh4KSBjb250YWluZXJfb2YoeCwgc3RydWN0IGludGVsX2NydGMsIGJh
c2UpCi0jZGVmaW5lIHRvX2ludGVsX2NydGNfc3RhdGUoeCkgY29udGFpbmVyX29mKHgsIHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlLCBiYXNlKQorI2RlZmluZSB0b19pbnRlbF9jcnRjX3N0YXRlKHgp
IGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSwgdWFwaSkKICNkZWZpbmUg
dG9faW50ZWxfY29ubmVjdG9yKHgpIGNvbnRhaW5lcl9vZih4LCBzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yLCBiYXNlKQogI2RlZmluZSB0b19pbnRlbF9lbmNvZGVyKHgpIGNvbnRhaW5lcl9vZih4LCBz
dHJ1Y3QgaW50ZWxfZW5jb2RlciwgYmFzZSkKICNkZWZpbmUgdG9faW50ZWxfZnJhbWVidWZmZXIo
eCkgY29udGFpbmVyX29mKHgsIHN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciwgYmFzZSkKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwppbmRleCAxYWEzOWU5MmYwZGYuLjQyOTc3
Mzg2NTVjNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtMTk2
Nyw3ICsxOTY3LDcgQEAgaW50ZWxfZHBfY29tcHV0ZV9saW5rX2NvbmZpZ193aWRlKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcsCiAJCQkJICBjb25zdCBzdHJ1Y3QgbGlua19jb25maWdfbGltaXRzICpsaW1pdHMpCiB7
Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRf
bW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgYnBwLCBjbG9jaywg
bGFuZV9jb3VudDsKIAlpbnQgbW9kZV9yYXRlLCBsaW5rX2Nsb2NrLCBsaW5rX2F2YWlsOwogCkBA
IC0yMDIxLDcgKzIwMjEsNyBAQCBzdGF0aWMgaW50IGludGVsX2RwX2RzY19jb21wdXRlX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogewogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3Bv
cnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwot
CXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5i
YXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21v
ZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJdTggZHNjX21heF9icGM7CiAJ
aW50IHBpcGVfYnBwOwogCWludCByZXQ7CkBAIC0yMTMyLDcgKzIxMzIsNyBAQCBpbnRlbF9kcF9j
b21wdXRlX2xpbmtfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAg
ICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgIHN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJ
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGU7CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRl
bF9kcCgmZW5jb2Rlci0+YmFzZSk7CiAJc3RydWN0IGxpbmtfY29uZmlnX2xpbWl0cyBsaW1pdHM7
CiAJaW50IGNvbW1vbl9sZW47CkBAIC0yMjIwLDggKzIyMjAsOCBAQCBpbnRlbF9kcF95Y2JjcjQy
MF9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIHsKIAljb25zdCBzdHJ1Y3QgZHJt
X2Rpc3BsYXlfaW5mbyAqaW5mbyA9ICZjb25uZWN0b3ItPmRpc3BsYXlfaW5mbzsKIAljb25zdCBz
dHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5i
YXNlLmFkanVzdGVkX21vZGU7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9t
b2RlOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT51YXBpLmNydGMpOwogCWludCByZXQ7CiAKIAlpZiAoIWRybV9tb2RlX2lzXzQyMF9vbmx5KGlu
Zm8sIGFkanVzdGVkX21vZGUpIHx8CkBAIC0yMjQ5LDcgKzIyNDksNyBAQCBib29sIGludGVsX2Rw
X2xpbWl0ZWRfY29sb3JfcmFuZ2UoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJY29uc3Qgc3RydWN0IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRlICppbnRl
bF9jb25uX3N0YXRlID0KIAkJdG9faW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUoY29ubl9z
dGF0ZSk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQot
CQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRq
dXN0ZWRfbW9kZTsKIAogCS8qCiAJICogT3VyIFlDYkNyIG91dHB1dCBpcyBhbHdheXMgbGltaXRl
ZCByYW5nZS4KQEAgLTIyODIsMTEgKzIyODIsMTEgQEAgaW50ZWxfZHBfY29tcHV0ZV9jb25maWco
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9z
dGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAo
JmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9sc3Bjb24gKmxzcGNvbiA9IGVuY190b19p
bnRlbF9sc3Bjb24oJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+
cG9ydDsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlw
ZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCXN0cnVjdCBpbnRlbF9jb25u
ZWN0b3IgKmludGVsX2Nvbm5lY3RvciA9IGludGVsX2RwLT5hdHRhY2hlZF9jb25uZWN0b3I7CiAJ
c3RydWN0IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRlICppbnRlbF9jb25uX3N0YXRlID0K
IAkJdG9faW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUoY29ubl9zdGF0ZSk7CkBAIC0yNDAw
LDggKzI0MDAsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9wcmVwYXJlKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBl
bmNfdG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rl
ci0+cG9ydDsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9j
b25maWctPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CisJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpbnRlbF9kcF9zZXRfbGlua19wYXJhbXMoaW50ZWxf
ZHAsIHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrLAogCQkJCSBwaXBlX2NvbmZpZy0+bGFuZV9jb3Vu
dCwKQEAgLTI5OTgsNyArMjk5OCw3IEBAIHN0YXRpYyB2b2lkIGFzc2VydF9lZHBfcGxsKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgYm9vbCBzdGF0ZSkKIHN0YXRpYyB2b2lkIGly
b25sYWtlX2VkcF9wbGxfb24oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQljb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0Jc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRj
KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJh
c2UuZGV2KTsKIAogCWFzc2VydF9waXBlX2Rpc2FibGVkKGRldl9wcml2LCBjcnRjLT5waXBlKTsK
QEAgLTMwMzgsNyArMzAzOCw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2VkcF9wbGxfb24oc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKIHN0YXRpYyB2b2lkIGlyb25sYWtlX2VkcF9wbGxfb2Zm
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwogCiAJYXNzZXJ0X3BpcGVfZGlzYWJsZWQoZGV2X3ByaXYsIGNydGMtPnBpcGUpOwpAQCAtMzE5
OCw3ICszMTk4LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3Rv
X2ludGVsX2RwKCZlbmNvZGVyLT5iYXNlKTsKIAl1MzIgdG1wLCBmbGFncyA9IDA7CiAJZW51bSBw
b3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CiAKIAlpZiAoZW5j
b2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKQogCQlwaXBlX2NvbmZpZy0+b3V0cHV0X3R5
cGVzIHw9IEJJVChJTlRFTF9PVVRQVVRfRURQKTsKQEAgLTMyMzMsNyArMzIzMyw3IEBAIHN0YXRp
YyB2b2lkIGludGVsX2RwX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCQlmbGFncyB8PSBEUk1fTU9ERV9GTEFHX05WU1lOQzsKIAl9CiAKLQlwaXBlX2NvbmZpZy0+
YmFzZS5hZGp1c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOworCXBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlLmZsYWdzIHw9IGZsYWdzOwogCiAJaWYgKElTX0c0WChkZXZfcHJpdikgJiYgdG1w
ICYgRFBfQ09MT1JfUkFOR0VfMTZfMjM1KQogCQlwaXBlX2NvbmZpZy0+bGltaXRlZF9jb2xvcl9y
YW5nZSA9IHRydWU7CkBAIC0zMjUwLDcgKzMyNTAsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9n
ZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJcGlwZV9jb25maWct
PnBvcnRfY2xvY2sgPSAyNzAwMDA7CiAJfQogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5jcnRjX2Nsb2NrID0KKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Ns
b2NrID0KIAkJaW50ZWxfZG90Y2xvY2tfY2FsY3VsYXRlKHBpcGVfY29uZmlnLT5wb3J0X2Nsb2Nr
LAogCQkJCQkgJnBpcGVfY29uZmlnLT5kcF9tX24pOwogCkBAIC0zNDY1LDcgKzM0NjUsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9lbmFibGVfZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9k
cCgmZW5jb2Rlci0+YmFzZSk7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAl1MzIgZHBfcmVnID0gSTkx
NV9SRUFEKGludGVsX2RwLT5vdXRwdXRfcmVnKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBp
cGU7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CkBAIC0zNTk4LDcgKzM1OTgsNyBAQCBzdGF0
aWMgdm9pZCB2bHZfaW5pdF9wYW5lbF9wb3dlcl9zZXF1ZW5jZXIoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVu
Y190b19pbnRlbF9kcCgmZW5jb2Rlci0+YmFzZSk7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAKIAlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+cHBzX211dGV4KTsKIApAQCAtNDEyMCw3ICs0MTIw
LDcgQEAgaW50ZWxfZHBfbGlua19kb3duKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAo
JmVuY29kZXItPmJhc2UpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBwb3J0IHBv
cnQgPSBlbmNvZGVyLT5wb3J0OwogCXUzMiBEUCA9IGludGVsX2RwLT5EUDsKIApAQCAtNDg4MSw3
ICs0ODgxLDcgQEAgaW50IGludGVsX2RwX3JldHJhaW5fbGluayhzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlciwKIAogCVdBUk5fT04oIWludGVsX2NydGNfaGFzX2RwX2VuY29kZXIoY3J0Y19z
dGF0ZSkpOwogCi0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkKKwlpZiAoIWNydGNfc3Rh
dGUtPmh3LmFjdGl2ZSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoY29ubl9zdGF0ZS0+Y29tbWl0ICYm
CkBAIC02NzAwLDcgKzY3MDAsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9zZXRfZHJyc19zdGF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICAgIGludCByZWZyZXNo
X3JhdGUpCiB7CiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGRldl9wcml2LT5kcnJzLmRw
OwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWVudW0gZHJyc19yZWZyZXNoX3JhdGVf
dHlwZSBpbmRleCA9IERSUlNfSElHSF9SUjsKIAogCWlmIChyZWZyZXNoX3JhdGUgPD0gMCkgewpA
QCAtNjczMyw3ICs2NzMzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHBfc2V0X2RycnNfc3RhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJfQogCi0JaWYg
KCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkgeworCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
KSB7CiAJCURSTV9ERUJVR19LTVMoImVEUCBlbmNvZGVyIGRpc2FibGVkLiBDUlRDIG5vdCBBY3Rp
dmVcbiIpOwogCQlyZXR1cm47CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcF9tc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHBfbXN0LmMKaW5kZXggMjIwM2JlMjhlYTAxLi5jZWNiN2JhNWI0ODIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYwpAQCAtNDIsMTMgKzQyLDEzIEBA
IHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfbGlua19jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCQkJCSAgICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAq
Y29ubl9zdGF0ZSwKIAkJCQkJICAgIHN0cnVjdCBsaW5rX2NvbmZpZ19saW1pdHMgKmxpbWl0cykK
IHsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRlLT5iYXNlLnN0
YXRlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPnVhcGku
c3RhdGU7CiAJc3RydWN0IGludGVsX2RwX21zdF9lbmNvZGVyICppbnRlbF9tc3QgPSBlbmNfdG9f
bXN0KCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gJmludGVs
X21zdC0+cHJpbWFyeS0+ZHA7CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0K
IAkJdG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CiAJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFz
ZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAl2b2lk
ICpwb3J0ID0gY29ubmVjdG9yLT5wb3J0OwogCWJvb2wgY29uc3RhbnRfbiA9IGRybV9kcF9oYXNf
cXVpcmsoJmludGVsX2RwLT5kZXNjLAogCQkJCQkgICBEUF9EUENEX1FVSVJLX0NPTlNUQU5UX04p
OwpAQCAtOTksNyArOTksNyBAQCBzdGF0aWMgaW50IGludGVsX2RwX21zdF9jb21wdXRlX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9j
b25uZWN0b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQogCQl0b19pbnRlbF9kaWdpdGFsX2Nv
bm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOwor
CQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJdm9pZCAqcG9ydCA9IGNvbm5lY3Rv
ci0+cG9ydDsKIAlzdHJ1Y3QgbGlua19jb25maWdfbGltaXRzIGxpbWl0czsKIAlpbnQgcmV0Owpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGlvX3BoeS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGlvX3BoeS5jCmluZGV4IDU1
NmQxYjMwZjA2YS4uNzA0ZjM4NjgxYzRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kcGlvX3BoeS5jCkBAIC03MzksNyArNzM5LDcgQEAgdm9pZCBjaHZfZGF0YV9s
YW5lX3NvZnRfcmVzZXQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
CiAJZW51bSBkcGlvX2NoYW5uZWwgY2ggPSB2bHZfZHBvcnRfdG9fY2hhbm5lbChlbmNfdG9fZGln
X3BvcnQoJmVuY29kZXItPmJhc2UpKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIHBpcGUgcGlw
ZSA9IGNydGMtPnBpcGU7CiAJdTMyIHZhbDsKIApAQCAtNzgzLDcgKzc4Myw3IEBAIHZvaWQgY2h2
X3BoeV9wcmVfcGxsX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlz
dHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkcG9ydCA9IGVuY190b19kaWdfcG9ydCgmZW5jb2Rl
ci0+YmFzZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBkcGlvX2NoYW5uZWwg
Y2ggPSB2bHZfZHBvcnRfdG9fY2hhbm5lbChkcG9ydCk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRj
LT5waXBlOwogCXVuc2lnbmVkIGludCBsYW5lX21hc2sgPQpAQCAtODY0LDcgKzg2NCw3IEBAIHZv
aWQgY2h2X3BoeV9wcmVfZW5jb2Rlcl9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcCgmZW5jb2Rl
ci0+YmFzZSk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZHBvcnQgPSBkcF90b19kaWdf
cG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBkcGlvX2No
YW5uZWwgY2ggPSB2bHZfZHBvcnRfdG9fY2hhbm5lbChkcG9ydCk7CiAJZW51bSBwaXBlIHBpcGUg
PSBjcnRjLT5waXBlOwogCWludCBkYXRhLCBpLCBzdGFnZ2VyOwpAQCAtOTUzLDcgKzk1Myw3IEBA
IHZvaWQgY2h2X3BoeV9wb3N0X3BsbF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0
YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjKS0+cGlwZTsKKwllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2Ny
dGMob2xkX2NydGNfc3RhdGUtPnVhcGkuY3J0YyktPnBpcGU7CiAJdTMyIHZhbDsKIAogCXZsdl9k
cGlvX2dldChkZXZfcHJpdik7CkBAIC0xMDE2LDcgKzEwMTYsNyBAQCB2b2lkIHZsdl9waHlfcHJl
X3BsbF9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqZHBvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2Up
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWVudW0gZHBpb19jaGFubmVsIHBvcnQgPSB2
bHZfZHBvcnRfdG9fY2hhbm5lbChkcG9ydCk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBl
OwogCkBAIC0xMDQ2LDcgKzEwNDYsNyBAQCB2b2lkIHZsdl9waHlfcHJlX2VuY29kZXJfZW5hYmxl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAgPSBlbmNfdG9faW50ZWxfZHAoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBpbnRlbF9kaWdp
dGFsX3BvcnQgKmRwb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNy
dGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT51YXBpLmNydGMpOwogCWVudW0gZHBpb19jaGFubmVsIHBvcnQgPSB2bHZfZHBvcnRfdG9fY2hh
bm5lbChkcG9ydCk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiB2YWw7CkBA
IC0xMDc1LDcgKzEwNzUsNyBAQCB2b2lkIHZsdl9waHlfcmVzZXRfbGFuZXMoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZHBvcnQg
PSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CiAJZW51bSBkcGlvX2NoYW5uZWwgcG9ydCA9IHZsdl9kcG9ydF90b19jaGFu
bmVsKGRwb3J0KTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBsbF9tZ3IuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBsbF9tZ3IuYwppbmRleCA1ZTllODRjOTRhMTUu
LmMyNjAzYWE1Njc2NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcGxsX21nci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZHBsbF9tZ3IuYwpAQCAtMTM2LDcgKzEzNiw3IEBAIHZvaWQgYXNzZXJ0X3NoYXJlZF9kcGxsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqLwogdm9pZCBpbnRlbF9wcmVwYXJl
X3NoYXJlZF9kcGxsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5i
YXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxs
ID0gY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGw7CiAKQEAgLTE2Myw3ICsxNjMsNyBAQCB2b2lkIGlu
dGVsX3ByZXBhcmVfc2hhcmVkX2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiAgKi8KIHZvaWQgaW50ZWxfZW5hYmxlX3NoYXJlZF9kcGxsKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gY3J0Y19zdGF0ZS0+c2hhcmVkX2Rw
bGw7CiAJdW5zaWduZWQgaW50IGNydGNfbWFzayA9IGRybV9jcnRjX21hc2soJmNydGMtPmJhc2Up
OwpAQCAtMjA4LDcgKzIwOCw3IEBAIHZvaWQgaW50ZWxfZW5hYmxlX3NoYXJlZF9kcGxsKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogICovCiB2b2lkIGludGVsX2Rp
c2FibGVfc2hhcmVkX2RwbGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3NoYXJlZF9kcGxs
ICpwbGwgPSBjcnRjX3N0YXRlLT5zaGFyZWRfZHBsbDsKIAl1bnNpZ25lZCBpbnQgY3J0Y19tYXNr
ID0gZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CkBAIC04MjUsNyArODI1LDcgQEAgaHN3X2Rk
aV9oZG1pX2dldF9kcGxsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogc3RhdGlj
IHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqCiBoc3dfZGRpX2RwX2dldF9kcGxsKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5j
cnRjLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsOwogCWVudW0gaW50ZWxf
ZHBsbF9pZCBwbGxfaWQ7CiAJaW50IGNsb2NrID0gY3J0Y19zdGF0ZS0+cG9ydF9jbG9jazsKQEAg
LTE3MzQsNyArMTczNCw3IEBAIHN0YXRpYyBib29sCiBieHRfZGRpX2hkbWlfcGxsX2RpdmlkZXJz
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICBzdHJ1Y3QgYnh0X2Ns
a19kaXYgKmNsa19kaXYpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRwbGwgYmVzdF9j
bG9jazsKIAogCS8qIENhbGN1bGF0ZSBIRE1JIGRpdiAqLwpAQCAtMjI1Nyw3ICsyMjU3LDcgQEAg
c3RhdGljIGJvb2wKIGNubF9kZGlfY2FsY3VsYXRlX3dycGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogCQkJc3RydWN0IHNrbF93cnBsbF9wYXJhbXMgKndycGxsX3BhcmFt
cykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNf
c3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAl1MzIgYWZlX2Nsb2Nr
ID0gY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayAqIDU7CiAJdTMyIHJlZl9jbG9jazsKIAl1MzIgZGNv
X21pbiA9IDc5OTgwMDA7CkBAIC0yNTM1LDcgKzI1MzUsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IHNrbF93cnBsbF9wYXJhbXMgdGdsX3RidF9wbGxfMjRNSHpfdmFsdWVzID0gewogc3RhdGljIGJv
b2wgaWNsX2NhbGNfZHBfY29tYm9fcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQkJCSAgc3RydWN0IHNrbF93cnBsbF9wYXJhbXMgKnBsbF9wYXJhbXMpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNl
LmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJY29uc3Qgc3RydWN0IGljbF9jb21ib19w
bGxfcGFyYW1zICpwYXJhbXMgPQogCQlkZXZfcHJpdi0+Y2RjbGsuaHcucmVmID09IDI0MDAwID8K
IAkJaWNsX2RwX2NvbWJvX3BsbF8yNE1Iel92YWx1ZXMgOgpAQCAtMjU1Nyw3ICsyNTU3LDcgQEAg
c3RhdGljIGJvb2wgaWNsX2NhbGNfZHBfY29tYm9fcGxsKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogc3RhdGljIGJvb2wgaWNsX2NhbGNfdGJ0X3BsbChzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgc3RydWN0IHNrbF93cnBsbF9wYXJhbXMg
KnBsbF9wYXJhbXMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewogCQlzd2l0Y2ggKGRldl9wcml2LT5jZGNs
ay5ody5yZWYpIHsKQEAgLTI1OTQsNyArMjU5NCw3IEBAIHN0YXRpYyBib29sIGljbF9jYWxjX2Rw
bGxfc3RhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUg
KnBsbF9zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAl1MzIg
Y2ZnY3IwLCBjZmdjcjE7CiAJc3RydWN0IHNrbF93cnBsbF9wYXJhbXMgcGxsX3BhcmFtcyA9IHsg
MCB9OwogCWJvb2wgcmV0OwpAQCAtMjcyNiw3ICsyNzI2LDcgQEAgc3RhdGljIGJvb2wgaWNsX21n
X3BsbF9maW5kX2Rpdmlzb3JzKGludCBjbG9ja19raHosIGJvb2wgaXNfZHAsIGJvb2wgdXNlX3Nz
YywKIHN0YXRpYyBib29sIGljbF9jYWxjX21nX3BsbF9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgIHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpwbGxf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJaW50IHJlZmNs
a19raHogPSBkZXZfcHJpdi0+Y2RjbGsuaHcucmVmOwogCWludCBjbG9jayA9IGNydGNfc3RhdGUt
PnBvcnRfY2xvY2s7CiAJdTMyIGRjb19raHosIG0xZGl2LCBtMmRpdl9pbnQsIG0yZGl2X3JlbSwg
bTJkaXZfZnJhYzsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHZvLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2R2by5jCmluZGV4
IDk4MjdmOTk0OTFkMS4uMjg3NzBjNTc2NWFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2R2by5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHZvLmMKQEAgLTE3OCw5ICsxNzgsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kdm9f
Z2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAllbHNlCiAJCWZsYWdz
IHw9IERSTV9NT0RFX0ZMQUdfTlZTWU5DOwogCi0JcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRf
bW9kZS5mbGFncyB8PSBmbGFnczsKKwlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFn
cyB8PSBmbGFnczsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9j
ayA9IHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9t
b2RlLmNydGNfY2xvY2sgPSBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jazsKIH0KIAogc3RhdGljIHZv
aWQgaW50ZWxfZGlzYWJsZV9kdm8oc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCkBAIC0y
MDcsOCArMjA3LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX2R2byhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIAl1MzIgdGVtcCA9IEk5MTVfUkVBRChkdm9fcmVnKTsKIAogCWlu
dGVsX2R2by0+ZGV2LmRldl9vcHMtPm1vZGVfc2V0KCZpbnRlbF9kdm8tPmRldiwKLQkJCQkJICZw
aXBlX2NvbmZpZy0+YmFzZS5tb2RlLAotCQkJCQkgJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVk
X21vZGUpOworCQkJCQkgJnBpcGVfY29uZmlnLT5ody5tb2RlLAorCQkJCQkgJnBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlKTsKIAogCUk5MTVfV1JJVEUoZHZvX3JlZywgdGVtcCB8IERWT19F
TkFCTEUpOwogCUk5MTVfUkVBRChkdm9fcmVnKTsKQEAgLTI1Myw3ICsyNTMsNyBAQCBzdGF0aWMg
aW50IGludGVsX2R2b19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAlzdHJ1Y3QgaW50ZWxfZHZvICppbnRlbF9kdm8gPSBlbmNfdG9fZHZvKGVuY29kZXIpOwog
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlID0KIAkJaW50ZWxfZHZv
LT5hdHRhY2hlZF9jb25uZWN0b3ItPnBhbmVsLmZpeGVkX21vZGU7Ci0Jc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9k
ZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAogCS8qCiAJICogSWYgd2UgaGF2ZSB0aW1pbmdzIGZyb20g
dGhlIEJJT1MgZm9yIHRoZSBwYW5lbCwgcHV0IHRoZW0gaW4KQEAgLTI3Nyw4ICsyNzcsOCBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9kdm9fcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBp
cGVfY29uZmlnLT5iYXNlLmNydGMpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMp
OworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVf
Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBpbnRlbF9kdm8gKmludGVsX2R2byA9
IGVuY190b19kdm8oZW5jb2Rlcik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUz
MiBkdm9fdmFsOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9mYmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKaW5kZXgg
MzExMWVjYWVhYmQwLi5jNmNjMzc3NWYzYjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9mYmMuYwpAQCAtNjY3LDcgKzY2Nyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2ZiY191
cGRhdGVfc3RhdGVfY2FjaGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJY2FjaGUtPnZtYSA9
IE5VTEw7CiAJY2FjaGUtPmZsYWdzID0gMDsKIAotCWNhY2hlLT5jcnRjLm1vZGVfZmxhZ3MgPSBj
cnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuZmxhZ3M7CisJY2FjaGUtPmNydGMubW9kZV9m
bGFncyA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3M7CiAJaWYgKElTX0hBU1dF
TEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCiAJCWNhY2hlLT5jcnRjLmhz
d19iZHdfcGl4ZWxfcmF0ZSA9IGNydGNfc3RhdGUtPnBpeGVsX3JhdGU7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZG1pLmMKaW5kZXggMGE2ODQ2YzViYTk1Li5mZDc1MDE2
YmQxZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRt
aS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jCkBAIC0y
NzksNyArMjc5LDcgQEAgc3RhdGljIHZvaWQgaWJ4X3dyaXRlX2luZm9mcmFtZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAljb25zdCB1MzIgKmRhdGEgPSBmcmFtZTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlpOTE1X3JlZ190IHJlZyA9IFRWSURF
T19ESVBfQ1RMKGludGVsX2NydGMtPnBpcGUpOwogCXUzMiB2YWwgPSBJOTE1X1JFQUQocmVnKTsK
IAlpbnQgaTsKQEAgLTMxNSw3ICszMTUsNyBAQCBzdGF0aWMgdm9pZCBpYnhfcmVhZF9pbmZvZnJh
bWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgdm9pZCAqZnJhbWUs
IHNzaXplX3QgbGVuKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9f
aW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXUzMiB2YWwsICpk
YXRhID0gZnJhbWU7CiAJaW50IGk7CiAKQEAgLTMzNCw3ICszMzQsNyBAQCBzdGF0aWMgdTMyIGli
eF9pbmZvZnJhbWVzX2VuYWJsZWQoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJ
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
Ci0JZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMp
LT5waXBlOworCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFw
aS5jcnRjKS0+cGlwZTsKIAlpOTE1X3JlZ190IHJlZyA9IFRWSURFT19ESVBfQ1RMKHBpcGUpOwog
CXUzMiB2YWwgPSBJOTE1X1JFQUQocmVnKTsKIApAQCAtMzU2LDcgKzM1Niw3IEBAIHN0YXRpYyB2
b2lkIGNwdF93cml0ZV9pbmZvZnJhbWUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7
CiAJY29uc3QgdTMyICpkYXRhID0gZnJhbWU7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMg
KmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVh
cGkuY3J0Yyk7CiAJaTkxNV9yZWdfdCByZWcgPSBUVklERU9fRElQX0NUTChpbnRlbF9jcnRjLT5w
aXBlKTsKIAl1MzIgdmFsID0gSTkxNV9SRUFEKHJlZyk7CiAJaW50IGk7CkBAIC0zOTUsNyArMzk1
LDcgQEAgc3RhdGljIHZvaWQgY3B0X3JlYWRfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogCQkJICAgICAgIHZvaWQgKmZyYW1lLCBzc2l6ZV90IGxlbikKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2
KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAl1MzIgdmFsLCAqZGF0YSA9IGZyYW1lOwogCWludCBpOwog
CkBAIC00MTQsNyArNDE0LDcgQEAgc3RhdGljIHUzMiBjcHRfaW5mb2ZyYW1lc19lbmFibGVkKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gdG9f
aW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKS0+cGlwZTsKKwllbnVtIHBpcGUgcGlw
ZSA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0YyktPnBpcGU7CiAJdTMyIHZh
bCA9IEk5MTVfUkVBRChUVklERU9fRElQX0NUTChwaXBlKSk7CiAKIAlpZiAoKHZhbCAmIFZJREVP
X0RJUF9FTkFCTEUpID09IDApCkBAIC00MzIsNyArNDMyLDcgQEAgc3RhdGljIHZvaWQgdmx2X3dy
aXRlX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAljb25zdCB1
MzIgKmRhdGEgPSBmcmFtZTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
IAlpOTE1X3JlZ190IHJlZyA9IFZMVl9UVklERU9fRElQX0NUTChpbnRlbF9jcnRjLT5waXBlKTsK
IAl1MzIgdmFsID0gSTkxNV9SRUFEKHJlZyk7CiAJaW50IGk7CkBAIC00NjgsNyArNDY4LDcgQEAg
c3RhdGljIHZvaWQgdmx2X3JlYWRfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJICAgICAgIHZvaWQgKmZyYW1lLCBzc2l6ZV90IGxlbikKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAl1MzIgdmFsLCAqZGF0YSA9IGZyYW1lOwogCWludCBpOwogCkBAIC00
ODcsNyArNDg3LDcgQEAgc3RhdGljIHUzMiB2bHZfaW5mb2ZyYW1lc19lbmFibGVkKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKnBpcGVfY29uZmlnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxf
Y3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKS0+cGlwZTsKKwllbnVtIHBpcGUgcGlwZSA9IHRv
X2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0YyktPnBpcGU7CiAJdTMyIHZhbCA9IEk5
MTVfUkVBRChWTFZfVFZJREVPX0RJUF9DVEwocGlwZSkpOwogCiAJaWYgKCh2YWwgJiBWSURFT19E
SVBfRU5BQkxFKSA9PSAwKQpAQCAtNzAwLDcgKzcwMCw3IEBAIGludGVsX2hkbWlfY29tcHV0ZV9h
dmlfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0cnVjdCBo
ZG1pX2F2aV9pbmZvZnJhbWUgKmZyYW1lID0gJmNydGNfc3RhdGUtPmluZm9mcmFtZXMuYXZpLmF2
aTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZj
cnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3Rl
ZF9tb2RlOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0YXRlLT5j
b25uZWN0b3I7CiAJaW50IHJldDsKIApAQCAtNzk2LDcgKzc5Niw3IEBAIGludGVsX2hkbWlfY29t
cHV0ZV9oZG1pX2luZm9mcmFtZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCXJl
dCA9IGRybV9oZG1pX3ZlbmRvcl9pbmZvZnJhbWVfZnJvbV9kaXNwbGF5X21vZGUoZnJhbWUsCiAJ
CQkJCQkJICBjb25uX3N0YXRlLT5jb25uZWN0b3IsCi0JCQkJCQkJICAmY3J0Y19zdGF0ZS0+YmFz
ZS5hZGp1c3RlZF9tb2RlKTsKKwkJCQkJCQkgICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2Rl
KTsKIAlpZiAoV0FSTl9PTihyZXQpKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTk1Nyw3ICs5NTcs
NyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9oZG1pX3NldF9nY3BfaW5mb2ZyYW1lKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCQkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJaTkxNV9yZWdf
dCByZWc7CiAKIAlpZiAoKGNydGNfc3RhdGUtPmluZm9mcmFtZXMuZW5hYmxlICYKQEAgLTk4Miw3
ICs5ODIsNyBAQCB2b2lkIGludGVsX2hkbWlfcmVhZF9nY3BfaW5mb2ZyYW1lKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
ZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWk5MTVfcmVnX3QgcmVnOwog
CiAJaWYgKChjcnRjX3N0YXRlLT5pbmZvZnJhbWVzLmVuYWJsZSAmCkBAIC0xMDE5LDcgKzEwMTks
NyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9oZG1pX2NvbXB1dGVfZ2NwX2luZm9mcmFtZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAogCS8qIEVuYWJsZSBkZWZhdWx0X3BoYXNlIHdoZW5l
dmVyIHRoZSBkaXNwbGF5IG1vZGUgaXMgc3VpdGFibHkgYWxpZ25lZCAqLwogCWlmIChnY3BfZGVm
YXVsdF9waGFzZV9wb3NzaWJsZShjcnRjX3N0YXRlLT5waXBlX2JwcCwKLQkJCQkgICAgICAgJmNy
dGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZSkpCisJCQkJICAgICAgICZjcnRjX3N0YXRlLT5o
dy5hZGp1c3RlZF9tb2RlKSkKIAkJY3J0Y19zdGF0ZS0+aW5mb2ZyYW1lcy5nY3AgfD0gR0NQX0RF
RkFVTFRfUEhBU0VfRU5BQkxFOwogfQogCkBAIC0xMDI5LDcgKzEwMjksNyBAQCBzdGF0aWMgdm9p
ZCBpYnhfc2V0X2luZm9mcmFtZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkg
ICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX2RpZ2l0
YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBlbmNfdG9fZGlnX3BvcnQoJmVuY29kZXItPmJhc2Up
OwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1pID0gJmludGVsX2RpZ19wb3J0LT5oZG1p
OwogCWk5MTVfcmVnX3QgcmVnID0gVFZJREVPX0RJUF9DVEwoaW50ZWxfY3J0Yy0+cGlwZSk7CkBA
IC0xMDg4LDcgKzEwODgsNyBAQCBzdGF0aWMgdm9pZCBjcHRfc2V0X2luZm9mcmFtZXMoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25u
ZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMg
KmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVh
cGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBlbmNfdG9faW50ZWxf
aGRtaSgmZW5jb2Rlci0+YmFzZSk7CiAJaTkxNV9yZWdfdCByZWcgPSBUVklERU9fRElQX0NUTChp
bnRlbF9jcnRjLT5waXBlKTsKIAl1MzIgdmFsID0gSTkxNV9SRUFEKHJlZyk7CkBAIC0xMTM3LDcg
KzExMzcsNyBAQCBzdGF0aWMgdm9pZCB2bHZfc2V0X2luZm9mcmFtZXMoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2Ny
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVs
X2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7
CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBlbmNfdG9faW50ZWxfaGRtaSgmZW5j
b2Rlci0+YmFzZSk7CiAJaTkxNV9yZWdfdCByZWcgPSBWTFZfVFZJREVPX0RJUF9DVEwoaW50ZWxf
Y3J0Yy0+cGlwZSk7CiAJdTMyIHZhbCA9IEk5MTVfUkVBRChyZWcpOwpAQCAtMTczMyw5ICsxNzMz
LDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfaGRtaV9wcmVwYXJlKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBlbmNvZGVyLT5iYXNlLmRl
djsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0J
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3Rh
dGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX2hkbWkgKmludGVsX2hkbWkgPSBlbmNfdG9f
aW50ZWxfaGRtaSgmZW5jb2Rlci0+YmFzZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNv
bnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUt
Pmh3LmFkanVzdGVkX21vZGU7CiAJdTMyIGhkbWlfdmFsOwogCiAJaW50ZWxfZHBfZHVhbF9tb2Rl
X3NldF90bWRzX291dHB1dChpbnRlbF9oZG1pLCB0cnVlKTsKQEAgLTE4MjYsNyArMTgyNiw3IEBA
IHN0YXRpYyB2b2lkIGludGVsX2hkbWlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAkgICAgdG1wICYgSERNSV9DT0xPUl9SQU5HRV8xNl8yMzUpCiAJCXBpcGVfY29u
ZmlnLT5saW1pdGVkX2NvbG9yX3JhbmdlID0gdHJ1ZTsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFk
anVzdGVkX21vZGUuZmxhZ3MgfD0gZmxhZ3M7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21v
ZGUuZmxhZ3MgfD0gZmxhZ3M7CiAKIAlpZiAoKHRtcCAmIFNEVk9fQ09MT1JfRk9STUFUX01BU0sp
ID09IEhETUlfQ09MT1JfRk9STUFUXzEyYnBjKQogCQlkb3RjbG9jayA9IHBpcGVfY29uZmlnLT5w
b3J0X2Nsb2NrICogMiAvIDM7CkBAIC0xODM2LDcgKzE4MzYsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9oZG1pX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaWYgKHBp
cGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyKQogCQlkb3RjbG9jayAvPSBwaXBlX2NvbmZpZy0+
cGl4ZWxfbXVsdGlwbGllcjsKIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0
Y19jbG9jayA9IGRvdGNsb2NrOworCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNf
Y2xvY2sgPSBkb3RjbG9jazsKIAogCXBpcGVfY29uZmlnLT5sYW5lX2NvdW50ID0gNDsKIApAQCAt
MTg1Nyw3ICsxODU3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZW5hYmxlX2hkbWlfYXVkaW8oc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0
b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAogCVdBUk5fT04o
IXBpcGVfY29uZmlnLT5oYXNfaGRtaV9zaW5rKTsKIAlEUk1fREVCVUdfRFJJVkVSKCJFbmFibGlu
ZyBIRE1JIGF1ZGlvIG9uIHBpcGUgJWNcbiIsCkBAIC0xOTQzLDcgKzE5NDMsNyBAQCBzdGF0aWMg
dm9pZCBjcHRfZW5hYmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29kZXItPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMp
OwogCXN0cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1pID0gZW5jX3RvX2ludGVsX2hkbWkoJmVu
Y29kZXItPmJhc2UpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgdGVtcDsK
QEAgLTIwMDcsNyArMjAwNyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Rpc2FibGVfaGRtaShzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlzdHJ1Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRt
aSA9IGVuY190b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgaW50ZWxfZGln
aXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCA9CiAJCWhkbWlfdG9fZGlnX3BvcnQoaW50ZWxfaGRt
aSk7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0
YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAl1MzIgdGVtcDsKIAogCXRlbXAgPSBJOTE1
X1JFQUQoaW50ZWxfaGRtaS0+aGRtaV9yZWcpOwpAQCAtMjIwNywxMiArMjIwNywxMiBAQCBzdGF0
aWMgYm9vbCBoZG1pX2RlZXBfY29sb3JfcG9zc2libGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgICBpbnQgYnBjKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5k
ZXYpOwotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPmJhc2Uu
c3RhdGU7CisJCXRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOworCXN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0
IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rvcl9zdGF0ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3Rl
ZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3Rh
dGUtPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IGk7CiAKIAlpZiAoSEFTX0dNQ0goZGV2X3ByaXYp
KQpAQCAtMjIzNyw3ICsyMjM3LDcgQEAgc3RhdGljIGJvb2wgaGRtaV9kZWVwX2NvbG9yX3Bvc3Np
YmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWZvcl9lYWNo
X25ld19jb25uZWN0b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5lY3RvciwgY29ubmVjdG9yX3N0YXRl
LCBpKSB7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9pbmZvICppbmZvID0gJmNvbm5lY3Rv
ci0+ZGlzcGxheV9pbmZvOwogCi0JCWlmIChjb25uZWN0b3Jfc3RhdGUtPmNydGMgIT0gY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjKQorCQlpZiAoY29ubmVjdG9yX3N0YXRlLT5jcnRjICE9IGNydGNfc3Rh
dGUtPnVhcGkuY3J0YykKIAkJCWNvbnRpbnVlOwogCiAJCWlmIChjcnRjX3N0YXRlLT5vdXRwdXRf
Zm9ybWF0ID09IElOVEVMX09VVFBVVF9GT1JNQVRfWUNCQ1I0MjApIHsKQEAgLTIyNzgsNyArMjI3
OCw3IEBAIHN0YXRpYyBib29sCiBpbnRlbF9oZG1pX3ljYmNyNDIwX2NvbmZpZyhzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNv
bmZpZykKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMo
Y29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9f
aW50ZWxfY3J0Yyhjb25maWctPnVhcGkuY3J0Yyk7CiAKIAlpZiAoIWNvbm5lY3Rvci0+eWNiY3Jf
NDIwX2FsbG93ZWQpIHsKIAkJRFJNX0VSUk9SKCJQbGF0Zm9ybSBkb2Vzbid0IHN1cHBvcnQgWUNC
Q1I0MjAgb3V0cHV0XG4iKTsKQEAgLTIzMzMsNyArMjMzMyw3IEBAIHN0YXRpYyBpbnQgaW50ZWxf
aGRtaV9jb21wdXRlX2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCXN0
cnVjdCBpbnRlbF9oZG1pICppbnRlbF9oZG1pID0gZW5jX3RvX2ludGVsX2hkbWkoJmVuY29kZXIt
PmJhc2UpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0K
LQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFk
anVzdGVkX21vZGU7CiAJaW50IGJwYywgY2xvY2sgPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2Nr
OwogCiAJaWYgKGFkanVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19EQkxDTEspCkBA
IC0yMzc1LDcgKzIzNzUsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9oZG1pX2xpbWl0ZWRfY29sb3Jf
cmFuZ2UoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfcwogCWNvbnN0IHN0cnVj
dCBpbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZSAqaW50ZWxfY29ubl9zdGF0ZSA9CiAJCXRv
X2ludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRlKGNvbm5fc3RhdGUpOwogCWNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAKIAkvKgog
CSAqIE91ciBZQ2JDciBvdXRwdXQgaXMgYWx3YXlzIGxpbWl0ZWQgcmFuZ2UuCkBAIC0yNDAzLDcg
KzI0MDMsNyBAQCBpbnQgaW50ZWxfaGRtaV9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKIHsKIAlzdHJ1Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190
b19pbnRlbF9oZG1pKCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
OworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBj
b25uX3N0YXRlLT5jb25uZWN0b3I7CiAJc3RydWN0IGRybV9zY2RjICpzY2RjID0gJmNvbm5lY3Rv
ci0+ZGlzcGxheV9pbmZvLmhkbWkuc2NkYzsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0
b3Jfc3RhdGUgKmludGVsX2Nvbm5fc3RhdGUgPQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9sc3Bjb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfbHNwY29uLmMKaW5kZXggZjhmMTMwODY0M2E5Li41MTQ1ZmY4Yjk2MmIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHNwY29uLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9sc3Bjb24uYwpAQCAtMTg5LDcgKzE4
OSw3IEBAIHZvaWQgbHNwY29uX3ljYmNyNDIwX2NvbmZpZyhzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAq
Y29ubmVjdG9yLAogewogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9pbmZvICppbmZvID0gJmNv
bm5lY3Rvci0+ZGlzcGxheV9pbmZvOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0KLQkJCQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJ
CQkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAKIAlpZiAoZHJtX21vZGVfaXNfNDIw
X29ubHkoaW5mbywgYWRqdXN0ZWRfbW9kZSkgJiYKIAkgICAgY29ubmVjdG9yLT55Y2Jjcl80MjBf
YWxsb3dlZCkgewpAQCAtNDc1LDcgKzQ3NSw3IEBAIHZvaWQgbHNwY29uX3NldF9pbmZvZnJhbWVz
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3Bv
cnQgKmRpZ19wb3J0ID0gZW5jX3RvX2RpZ19wb3J0KCZlbmNvZGVyLT5iYXNlKTsKIAlzdHJ1Y3Qg
aW50ZWxfbHNwY29uICpsc3Bjb24gPSAmZGlnX3BvcnQtPmxzcGNvbjsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNlLmFk
anVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCiAJaWYgKCFs
c3Bjb24tPmFjdGl2ZSkgewogCQlEUk1fRVJST1IoIldyaXRpbmcgaW5mb2ZyYW1lcyB3aGlsZSBM
U1BDT04gZGlzYWJsZWQgP1xuIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2x2ZHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
bHZkcy5jCmluZGV4IDEzODQxZDdjNDU1Yi4uY2E0ZWJiMGYyMjMwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMuYwpAQCAtMTM1LDcgKzEzNSw3IEBAIHN0YXRpYyB2
b2lkIGludGVsX2x2ZHNfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAllbHNlCiAJCWZsYWdzIHw9IERSTV9NT0RFX0ZMQUdfUFZTWU5DOwogCi0JcGlwZV9jb25maWct
PmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKKwlwaXBlX2NvbmZpZy0+aHcuYWRq
dXN0ZWRfbW9kZS5mbGFncyB8PSBmbGFnczsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwg
NSkKIAkJcGlwZV9jb25maWctPmdtY2hfcGZpdC5sdmRzX2JvcmRlcl9iaXRzID0KQEAgLTE0OCw3
ICsxNDgsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9sdmRzX2dldF9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCXBpcGVfY29uZmlnLT5nbWNoX3BmaXQuY29udHJvbCB8PSB0
bXAgJiBQQU5FTF84VE82X0RJVEhFUl9FTkFCTEU7CiAJfQogCi0JcGlwZV9jb25maWctPmJhc2Uu
YWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrID0gcGlwZV9jb25maWctPnBvcnRfY2xvY2s7CisJcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IHBpcGVfY29uZmlnLT5wb3J0
X2Nsb2NrOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9sdmRzX3Bwc19nZXRfaHdfc3RhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LApAQCAtMjMwLDggKzIzMCw4IEBAIHN0YXRp
YyB2b2lkIGludGVsX3ByZV9lbmFibGVfbHZkcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIHsKIAlzdHJ1Y3QgaW50ZWxfbHZkc19lbmNvZGVyICpsdmRzX2VuY29kZXIgPSB0b19sdmRz
X2VuY29kZXIoJmVuY29kZXItPmJhc2UpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5h
ZGp1c3RlZF9tb2RlOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhw
aXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAllbnVtIHBp
cGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIHRlbXA7CiAKQEAgLTM5Miw4ICszOTIsOCBAQCBz
dGF0aWMgaW50IGludGVsX2x2ZHNfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIg
KmludGVsX2VuY29kZXIsCiAJCXRvX2x2ZHNfZW5jb2RlcigmaW50ZWxfZW5jb2Rlci0+YmFzZSk7
CiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yID0KIAkJbHZkc19lbmNv
ZGVyLT5hdHRhY2hlZF9jb25uZWN0b3I7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVz
dGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKLQlzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0
Yyk7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25m
aWctPmh3LmFkanVzdGVkX21vZGU7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCXVuc2lnbmVkIGludCBsdmRz
X2JwcDsKIAogCS8qIFNob3VsZCBuZXZlciBoYXBwZW4hISAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wYW5lbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9wYW5lbC5jCmluZGV4IGJjMTRlOWMwMjg1YS4uNmYzZWFhZTM3NjFm
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wYW5lbC5jCkBAIC0xNzgs
NyArMTc4LDcgQEAgaW50ZWxfcGNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGMsCiAJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQlp
bnQgZml0dGluZ19tb2RlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1
c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJY29uc3Qgc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGU7CiAJaW50IHggPSAwLCB5ID0gMCwgd2lkdGggPSAwLCBoZWlnaHQgPSAwOwog
CiAJLyogTmF0aXZlIG1vZGVzIGRvbid0IG5lZWQgZml0dGluZyAqLwpAQCAtMzAwLDcgKzMwMCw3
IEBAIHN0YXRpYyBpbmxpbmUgdTMyIHBhbmVsX2ZpdHRlcl9zY2FsaW5nKHUzMiBzb3VyY2UsIHUz
MiB0YXJnZXQpCiBzdGF0aWMgdm9pZCBpOTY1X3NjYWxlX2FzcGVjdChzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgICB1MzIgKnBmaXRfY29udHJvbCkKIHsKLQlj
b25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZp
Zy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCXUzMiBzY2Fs
ZWRfd2lkdGggPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5ICoKIAkJcGlwZV9jb25maWct
PnBpcGVfc3JjX2g7CiAJdTMyIHNjYWxlZF9oZWlnaHQgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNf
dyAqCkBAIC0zMjEsNyArMzIxLDcgQEAgc3RhdGljIHZvaWQgaTl4eF9zY2FsZV9hc3BlY3Qoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQkJICAgICAgdTMyICpwZml0X2Nv
bnRyb2wsIHUzMiAqcGZpdF9wZ21fcmF0aW9zLAogCQkJICAgICAgdTMyICpib3JkZXIpCiB7Ci0J
c3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmJh
c2UuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9k
ZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAl1MzIgc2NhbGVkX3dpZHRoID0g
YWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheSAqCiAJCXBpcGVfY29uZmlnLT5waXBlX3NyY19o
OwogCXUzMiBzY2FsZWRfaGVpZ2h0ID0gcGlwZV9jb25maWctPnBpcGVfc3JjX3cgKgpAQCAtMzgw
LDcgKzM4MCw3IEBAIHZvaWQgaW50ZWxfZ21jaF9wYW5lbF9maXR0aW5nKHN0cnVjdCBpbnRlbF9j
cnRjICppbnRlbF9jcnRjLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoaW50ZWxfY3J0Yy0+YmFzZS5kZXYpOwogCXUzMiBwZml0X2NvbnRyb2wgPSAwLCBw
Zml0X3BnbV9yYXRpb3MgPSAwLCBib3JkZXIgPSAwOwotCXN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFk
anVzdGVkX21vZGU7CiAKIAkvKiBOYXRpdmUgbW9kZXMgZG9uJ3QgbmVlZCBmaXR0aW5nICovCiAJ
aWYgKGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXkgPT0gcGlwZV9jb25maWctPnBpcGVfc3Jj
X3cgJiYKQEAgLTEwNDcsNyArMTA0Nyw3IEBAIHN0YXRpYyB2b2lkIHZsdl9lbmFibGVfYmFja2xp
Z2h0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVjdCBp
bnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRl
LT5jb25uZWN0b3IpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY29ubmVjdG9yLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3BhbmVsICpwYW5lbCA9ICZj
b25uZWN0b3ItPnBhbmVsOwotCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT5iYXNlLmNydGMpLT5waXBlOworCWVudW0gcGlwZSBwaXBlID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOwogCXUzMiBjdGwsIGN0bDI7CiAKIAljdGwyID0g
STkxNV9SRUFEKFZMVl9CTENfUFdNX0NUTDIocGlwZSkpOwpAQCAtMTA3Nyw3ICsxMDc3LDcgQEAg
c3RhdGljIHZvaWQgYnh0X2VuYWJsZV9iYWNrbGlnaHQoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yID0g
dG9faW50ZWxfY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmJhc2UuZGV2KTsKIAlz
dHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsID0gJmNvbm5lY3Rvci0+cGFuZWw7Ci0JZW51bSBwaXBl
IHBpcGUgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0YyktPnBpcGU7CisJZW51
bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0YyktPnBpcGU7
CiAJdTMyIHB3bV9jdGwsIHZhbDsKIAogCS8qIENvbnRyb2xsZXIgMSB1c2VzIHRoZSB1dGlsaXR5
IHBpbi4gKi8KQEAgLTExODksNyArMTE4OSw3IEBAIHZvaWQgaW50ZWxfcGFuZWxfZW5hYmxlX2Jh
Y2tsaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlzdHJ1
Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubl9z
dGF0ZS0+Y29ubmVjdG9yKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNvbm5lY3Rvci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWwg
PSAmY29ubmVjdG9yLT5wYW5lbDsKLQllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjKS0+cGlwZTsKKwllbnVtIHBpcGUgcGlwZSA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKIAogCWlmICghcGFuZWwtPmJhY2tsaWdo
dC5wcmVzZW50KQogCQlyZXR1cm47CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3BpcGVfY3JjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3BpcGVfY3JjLmMKaW5kZXggNjI2MGEyMDgyNzE5Li4yNzQ2NTEyZjQ0NjYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGlwZV9jcmMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BpcGVfY3JjLmMKQEAgLTMwOSwxMyAr
MzA5LDEzIEBAIGludGVsX2NydGNfY3JjX3NldHVwX3dvcmthcm91bmRzKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLCBib29sIGVuYWJsZSkKIAkJZ290byBwdXRfc3RhdGU7CiAJfQogCi0JcGlwZV9j
b25maWctPmJhc2UubW9kZV9jaGFuZ2VkID0gcGlwZV9jb25maWctPmhhc19wc3I7CisJcGlwZV9j
b25maWctPnVhcGkubW9kZV9jaGFuZ2VkID0gcGlwZV9jb25maWctPmhhc19wc3I7CiAJcGlwZV9j
b25maWctPmNyY19lbmFibGVkID0gZW5hYmxlOwogCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYp
ICYmCi0JICAgIHBpcGVfY29uZmlnLT5iYXNlLmFjdGl2ZSAmJiBjcnRjLT5waXBlID09IFBJUEVf
QSAmJgorCSAgICBwaXBlX2NvbmZpZy0+aHcuYWN0aXZlICYmIGNydGMtPnBpcGUgPT0gUElQRV9B
ICYmCiAJICAgIHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciA9PSBUUkFOU0NPREVSX0VEUCkK
LQkJcGlwZV9jb25maWctPmJhc2UubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKwkJcGlwZV9jb25maWct
PnVhcGkubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKIAogCXJldCA9IGRybV9hdG9taWNfY29tbWl0KHN0
YXRlKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9w
c3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKaW5kZXggYjNj
N2VlZjUzYmYzLi44OTg4ZGJlOGMxOWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfcHNyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9wc3IuYwpAQCAtNTM4LDggKzUzOCw4IEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29u
ZmlnX3ZhbGlkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJICAgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCWludCBjcnRjX2hkaXNwbGF5ID0gY3J0
Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaGRpc3BsYXk7Ci0JaW50IGNydGNfdmRp
c3BsYXkgPSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheTsKKwlp
bnQgY3J0Y19oZGlzcGxheSA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oZGlz
cGxheTsKKwlpbnQgY3J0Y192ZGlzcGxheSA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUu
Y3J0Y192ZGlzcGxheTsKIAlpbnQgcHNyX21heF9oID0gMCwgcHNyX21heF92ID0gMDsKIAogCWlm
ICghZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkKQEAgLTYwNSw3ICs2MDUsNyBAQCB2
b2lkIGludGVsX3Bzcl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
CXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50
ZWxfZHApOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUo
aW50ZWxfZHApOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2Rl
ID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3
LmFkanVzdGVkX21vZGU7CiAJaW50IHBzcl9zZXR1cF90aW1lOwogCiAJaWYgKCFDQU5fUFNSKGRl
dl9wcml2KSkKQEAgLTc0NSw3ICs3NDUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxl
X2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAlkZXZfcHJpdi0+
cHNyLnBzcjJfZW5hYmxlZCA9IGludGVsX3BzcjJfZW5hYmxlZChkZXZfcHJpdiwgY3J0Y19zdGF0
ZSk7CiAJZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgPSAwOwotCWRldl9wcml2
LT5wc3IucGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKS0+cGlwZTsK
KwlkZXZfcHJpdi0+cHNyLnBpcGUgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
YyktPnBpcGU7CiAJZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3Ry
YW5zY29kZXI7CiAKIAkvKgpAQCAtOTg4LDcgKzk4OCw3IEBAIHZvaWQgaW50ZWxfcHNyX3VwZGF0
ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogaW50IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwKIAkJCSAgICB1
MzIgKm91dF92YWx1ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCiAJaWYg
KCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQgfHwgIW5ld19jcnRjX3N0YXRlLT5oYXNfcHNyKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nkdm8uYwppbmRleCA0N2Y1ZDg3YTkzOGEu
LjEwNDczNTdjMTVjNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9zZHZvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZv
LmMKQEAgLTEwODcsNyArMTA4Nyw3IEBAIHN0YXRpYyBib29sIGludGVsX3Nkdm9fY29tcHV0ZV9h
dmlfaW5mb2ZyYW1lKHN0cnVjdCBpbnRlbF9zZHZvICppbnRlbF9zZHZvLAogewogCXN0cnVjdCBo
ZG1pX2F2aV9pbmZvZnJhbWUgKmZyYW1lID0gJmNydGNfc3RhdGUtPmluZm9mcmFtZXMuYXZpLmF2
aTsKIAljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZj
cnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3Rl
ZF9tb2RlOwogCWludCByZXQ7CiAKIAlpZiAoIWNydGNfc3RhdGUtPmhhc19oZG1pX3NpbmspCkBA
IC0xMjc2LDggKzEyNzYsOCBAQCBzdGF0aWMgaW50IGludGVsX3Nkdm9fY29tcHV0ZV9jb25maWco
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCXRvX2ludGVsX3Nkdm9fY29ubmVjdG9y
X3N0YXRlKGNvbm5fc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9zZHZvX2Nvbm5lY3RvciAqaW50ZWxf
c2R2b19jb25uZWN0b3IgPQogCQl0b19pbnRlbF9zZHZvX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5j
b25uZWN0b3IpOwotCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBp
cGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7Ci0Jc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUgPSAmcGlwZV9jb25maWctPmJhc2UubW9kZTsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9k
ZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKKwlzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcubW9kZTsKIAogCURS
TV9ERUJVR19LTVMoImZvcmNpbmcgYnBjIHRvIDggZm9yIFNEVk9cbiIpOwogCXBpcGVfY29uZmln
LT5waXBlX2JwcCA9IDgqMzsKQEAgLTE0MjksMTMgKzE0MjksMTMgQEAgc3RhdGljIHZvaWQgaW50
ZWxfc2R2b19wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyLAog
CQkJCSAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9lbmNvZGVy
LT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yyk7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFk
anVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwor
CWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3Rh
dGUtPmh3LmFkanVzdGVkX21vZGU7CiAJY29uc3Qgc3RydWN0IGludGVsX3Nkdm9fY29ubmVjdG9y
X3N0YXRlICpzZHZvX3N0YXRlID0KIAkJdG9faW50ZWxfc2R2b19jb25uZWN0b3Jfc3RhdGUoY29u
bl9zdGF0ZSk7CiAJY29uc3Qgc3RydWN0IGludGVsX3Nkdm9fY29ubmVjdG9yICppbnRlbF9zZHZv
X2Nvbm5lY3RvciA9CiAJCXRvX2ludGVsX3Nkdm9fY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5l
Y3Rvcik7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPSAmY3J0Y19zdGF0
ZS0+YmFzZS5tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJmNy
dGNfc3RhdGUtPmh3Lm1vZGU7CiAJc3RydWN0IGludGVsX3Nkdm8gKmludGVsX3Nkdm8gPSB0b19z
ZHZvKGludGVsX2VuY29kZXIpOwogCXUzMiBzZHZveDsKIAlzdHJ1Y3QgaW50ZWxfc2R2b19pbl9v
dXRfbWFwIGluX291dDsKQEAgLTE2MjksNyArMTYyOSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nk
dm9fZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCWZsYWdzIHw9
IERSTV9NT0RFX0ZMQUdfTlZTWU5DOwogCX0KIAotCXBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVk
X21vZGUuZmxhZ3MgfD0gZmxhZ3M7CisJcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuZmxh
Z3MgfD0gZmxhZ3M7CiAKIAkvKgogCSAqIHBpeGVsIG11bHRpcGxpZXIgcmVhZG91dCBpcyB0cmlj
a3k6IE9ubHkgb24gaTkxNWcvZ20gaXQgaXMgc3RvcmVkIGluCkBAIC0xNjQ5LDcgKzE2NDksNyBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9zZHZvX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJaWYgKHBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyKQogCQlkb3RjbG9j
ayAvPSBwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcjsKIAotCXBpcGVfY29uZmlnLT5iYXNl
LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IGRvdGNsb2NrOworCXBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9jazsKIAogCS8qIENyb3NzIGNoZWNrIHRo
ZSBwb3J0IHBpeGVsIG11bHRpcGxpZXIgd2l0aCB0aGUgc2R2byBlbmNvZGVyIHN0YXRlLiAqLwog
CWlmIChpbnRlbF9zZHZvX2dldF92YWx1ZShpbnRlbF9zZHZvLCBTRFZPX0NNRF9HRVRfQ0xPQ0tf
UkFURV9NVUxULApAQCAtMTcwMSw3ICsxNzAxLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2b19l
bmFibGVfYXVkaW8oc3RydWN0IGludGVsX3Nkdm8gKmludGVsX3Nkdm8sCiAJCQkJICAgIGNvbnN0
IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCWNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2Uu
YWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJc3RydWN0
IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9IGNvbm5fc3RhdGUtPmNvbm5lY3RvcjsKIAl1OCAq
ZWxkID0gY29ubmVjdG9yLT5lbGQ7CiAKQEAgLTE3MjMsNyArMTcyMyw3IEBAIHN0YXRpYyB2b2lk
IGludGVsX2Rpc2FibGVfc2R2byhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2byA9IHRvX3Nkdm8oZW5jb2Rlcik7
Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRl
LT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhv
bGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAl1MzIgdGVtcDsKIAogCWlmIChvbGRfY3J0Y19z
dGF0ZS0+aGFzX2F1ZGlvKQpAQCAtMTc4NSw3ICsxNzg1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
ZW5hYmxlX3Nkdm8oc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9IGVuY29kZXItPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2
byA9IHRvX3Nkdm8oZW5jb2Rlcik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAl1
MzIgdGVtcDsKIAlib29sIGlucHV0MSwgaW5wdXQyOwogCWludCBpOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKaW5kZXggNjMzZmE4MDY5MzQ4Li41MjZhOTM2
NmI2ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwpA
QCAtODEsOSArODEsOSBAQCBpbnQgaW50ZWxfdXNlY3NfdG9fc2NhbmxpbmVzKGNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlLAogICovCiB2b2lkIGludGVsX3BpcGVf
dXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0
ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNf
c3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1f
ZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJm5ld19jcnRjX3N0YXRlLT5iYXNlLmFkanVz
dGVkX21vZGU7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUg
PSAmbmV3X2NydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJbG9uZyB0aW1lb3V0ID0gbXNl
Y3NfdG9famlmZmllc190aW1lb3V0KDEpOwogCWludCBzY2FubGluZSwgbWluLCBtYXgsIHZibGFu
a19zdGFydDsKIAl3YWl0X3F1ZXVlX2hlYWRfdCAqd3EgPSBkcm1fY3J0Y192Ymxhbmtfd2FpdHF1
ZXVlKCZjcnRjLT5iYXNlKTsKQEAgLTE5MCw3ICsxOTAsNyBAQCB2b2lkIGludGVsX3BpcGVfdXBk
YXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkK
ICAqLwogdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9lbmQoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
Km5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhuZXdfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJZW51bSBwaXBl
IHBpcGUgPSBjcnRjLT5waXBlOwogCWludCBzY2FubGluZV9lbmQgPSBpbnRlbF9nZXRfY3J0Y19z
Y2FubGluZShjcnRjKTsKIAl1MzIgZW5kX3ZibF9jb3VudCA9IGludGVsX2NydGNfZ2V0X3ZibGFu
a19jb3VudGVyKGNydGMpOwpAQCAtMjAzLDE0ICsyMDMsMTUgQEAgdm9pZCBpbnRlbF9waXBlX3Vw
ZGF0ZV9lbmQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogCSAqIFdv
dWxkIGJlIHNsaWdodGx5IG5pY2UgdG8ganVzdCBncmFiIHRoZSB2YmxhbmsgY291bnQgYW5kIGFy
bSB0aGUKIAkgKiBldmVudCBvdXRzaWRlIG9mIHRoZSBjcml0aWNhbCBzZWN0aW9uIC0gdGhlIHNw
aW5sb2NrIG1pZ2h0IHNwaW4gZm9yIGEKIAkgKiB3aGlsZSAuLi4gKi8KLQlpZiAobmV3X2NydGNf
c3RhdGUtPmJhc2UuZXZlbnQpIHsKKwlpZiAobmV3X2NydGNfc3RhdGUtPnVhcGkuZXZlbnQpIHsK
IAkJV0FSTl9PTihkcm1fY3J0Y192YmxhbmtfZ2V0KCZjcnRjLT5iYXNlKSAhPSAwKTsKIAogCQlz
cGluX2xvY2soJmNydGMtPmJhc2UuZGV2LT5ldmVudF9sb2NrKTsKLQkJZHJtX2NydGNfYXJtX3Zi
bGFua19ldmVudCgmY3J0Yy0+YmFzZSwgbmV3X2NydGNfc3RhdGUtPmJhc2UuZXZlbnQpOworCQlk
cm1fY3J0Y19hcm1fdmJsYW5rX2V2ZW50KCZjcnRjLT5iYXNlLAorCQkJCSAgICAgICAgICBuZXdf
Y3J0Y19zdGF0ZS0+dWFwaS5ldmVudCk7CiAJCXNwaW5fdW5sb2NrKCZjcnRjLT5iYXNlLmRldi0+
ZXZlbnRfbG9jayk7CiAKLQkJbmV3X2NydGNfc3RhdGUtPmJhc2UuZXZlbnQgPSBOVUxMOworCQlu
ZXdfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCA9IE5VTEw7CiAJfQogCiAJbG9jYWxfaXJxX2VuYWJs
ZSgpOwpAQCAtMTUxNSw3ICsxNTE2LDcgQEAgZzR4X3Nwcml0ZV9jaGVja19zY2FsaW5nKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWNvbnN0IHN0cnVjdCBkcm1fcmVjdCAq
ZHN0ID0gJnBsYW5lX3N0YXRlLT5iYXNlLmRzdDsKIAlpbnQgc3JjX3gsIHNyY193LCBzcmNfaCwg
Y3J0Y193LCBjcnRjX2g7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVk
X21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAl1bnNpZ25lZCBpbnQgc3RyaWRlID0gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lWzBdLnN0cmlkZTsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmItPmZvcm1hdC0+
Y3BwWzBdOwogCXVuc2lnbmVkIGludCB3aWR0aF9ieXRlczsKQEAgLTE1ODgsNyArMTU4OSw3IEBA
IGc0eF9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
fQogCiAJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0
YXRlLT5iYXNlLAotCQkJCQkJICAmY3J0Y19zdGF0ZS0+YmFzZSwKKwkJCQkJCSAgJmNydGNfc3Rh
dGUtPnVhcGksCiAJCQkJCQkgIG1pbl9zY2FsZSwgbWF4X3NjYWxlLAogCQkJCQkJICB0cnVlLCB0
cnVlKTsKIAlpZiAocmV0KQpAQCAtMTY0NSw3ICsxNjQ2LDcgQEAgdmx2X3Nwcml0ZV9jaGVjayhz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIHJldDsKIAogCXJl
dCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+YmFz
ZSwKLQkJCQkJCSAgJmNydGNfc3RhdGUtPmJhc2UsCisJCQkJCQkgICZjcnRjX3N0YXRlLT51YXBp
LAogCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCiAJCQkJCQkgIERSTV9QTEFO
RV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJCSAgdHJ1ZSwgdHJ1ZSk7CkBAIC0xNzI5LDggKzE3
MzAsOCBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAl9CiAKIAkvKiBZLXRpbGluZyBpcyBub3Qgc3VwcG9y
dGVkIGluIElGLUlEIEludGVybGFjZSBtb2RlICovCi0JaWYgKGNydGNfc3RhdGUtPmJhc2UuZW5h
YmxlICYmCi0JICAgIGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9N
T0RFX0ZMQUdfSU5URVJMQUNFICYmCisJaWYgKGNydGNfc3RhdGUtPmh3LmVuYWJsZSAmJgorCSAg
ICBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRF
UkxBQ0UgJiYKIAkgICAgKGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCB8
fAogCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCB8fAogCSAg
ICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fApAQCAtMTgx
MCw3ICsxODExLDcgQEAgc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJfQogCiAJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hl
Y2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLAotCQkJCQkJICAmY3J0Y19zdGF0ZS0+
YmFzZSwKKwkJCQkJCSAgJmNydGNfc3RhdGUtPnVhcGksCiAJCQkJCQkgIG1pbl9zY2FsZSwgbWF4
X3NjYWxlLAogCQkJCQkJICB0cnVlLCB0cnVlKTsKIAlpZiAocmV0KQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF90di5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF90di5jCmluZGV4IDcwNzI2YjQ4MTI0NC4uNDQ5OWQ0MDJjMzE2IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3R2LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF90di5jCkBAIC05MjQsNyArOTI0LDcg
QEAgaW50ZWxfZW5hYmxlX3R2KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJLyog
UHJldmVudHMgdmJsYW5rIHdhaXRzIGZyb20gdGltaW5nIG91dCBpbiBpbnRlbF90dl9kZXRlY3Rf
dHlwZSgpICovCiAJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LAotCQkJICAgICAgdG9f
aW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKS0+cGlwZSk7CisJCQkgICAgICB0b19p
bnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpLT5waXBlKTsKIAogCUk5MTVfV1JJVEUo
VFZfQ1RMLCBJOTE1X1JFQUQoVFZfQ1RMKSB8IFRWX0VOQ19FTkFCTEUpOwogfQpAQCAtMTA4NSw3
ICsxMDg1LDcgQEAgaW50ZWxfdHZfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVu
Y29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9k
ZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkmcGlwZV9jb25maWct
Pmh3LmFkanVzdGVkX21vZGU7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgbW9kZSA9IHt9Owog
CXUzMiB0dl9jdGwsIGhjdGwxLCBoY3RsMywgdmN0bDEsIHZjdGwyLCB0bXA7CiAJc3RydWN0IHR2
X21vZGUgdHZfbW9kZSA9IHt9OwpAQCAtMTE4OCw3ICsxMTg4LDcgQEAgaW50ZWxfdHZfY29tcHV0
ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCXRvX2ludGVsX3R2X2Nv
bm5lY3Rvcl9zdGF0ZShjb25uX3N0YXRlKTsKIAljb25zdCBzdHJ1Y3QgdHZfbW9kZSAqdHZfbW9k
ZSA9IGludGVsX3R2X21vZGVfZmluZChjb25uX3N0YXRlKTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlf
bW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2Rl
OworCQkmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IGhkaXNwbGF5ID0gYWRq
dXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheTsKIAlpbnQgdmRpc3BsYXkgPSBhZGp1c3RlZF9tb2Rl
LT5jcnRjX3ZkaXNwbGF5OwogCkBAIC0xNDE3LDcgKzE0MTcsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF90dl9wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCWNvbnN0
IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhwaXBlX2NvbmZpZy0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2Ny
dGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX3R2ICppbnRlbF90diA9
IGVuY190b190dihlbmNvZGVyKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfdHZfY29ubmVjdG9yX3N0
YXRlICp0dl9jb25uX3N0YXRlID0KIAkJdG9faW50ZWxfdHZfY29ubmVjdG9yX3N0YXRlKGNvbm5f
c3RhdGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92
ZHNjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYwppbmRleCBk
NGZiN2YxNmY5ZjYuLjM4YzE4MTQ5OTUwNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF92ZHNjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF92ZHNjLmMKQEAgLTMyOSw4ICszMjksOCBAQCBpbnQgaW50ZWxfZHBfY29tcHV0ZV9k
c2NfcGFyYW1zKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaW50IGNvbHVtbl9pbmRleCA9
IDA7CiAJdTggbGluZV9idWZfZGVwdGggPSAwOwogCi0JdmRzY19jZmctPnBpY193aWR0aCA9IHBp
cGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19oZGlzcGxheTsKLQl2ZHNjX2NmZy0+
cGljX2hlaWdodCA9IHBpcGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxh
eTsKKwl2ZHNjX2NmZy0+cGljX3dpZHRoID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUu
Y3J0Y19oZGlzcGxheTsKKwl2ZHNjX2NmZy0+cGljX2hlaWdodCA9IHBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlLmNydGNfdmRpc3BsYXk7CiAJdmRzY19jZmctPnNsaWNlX3dpZHRoID0gRElW
X1JPVU5EX1VQKHZkc2NfY2ZnLT5waWNfd2lkdGgsCiAJCQkJCSAgICAgcGlwZV9jb25maWctPmRz
Y19wYXJhbXMuc2xpY2VfY291bnQpOwogCS8qCkBAIC00NTksNyArNDU5LDcgQEAgaW50IGludGVs
X2RwX2NvbXB1dGVfZHNjX3BhcmFtcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogZW51bSBp
bnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbgogaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNy
dGMtPmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+
Y3B1X3RyYW5zY29kZXI7CiAKIAkvKgpAQCAtNDgzLDcgKzQ4Myw3IEBAIGludGVsX2RzY19wb3dl
cl9kb21haW4oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiBzdGF0
aWMgdm9pZCBpbnRlbF9jb25maWd1cmVfcHBzX2Zvcl9kc2NfZW5jb2RlcihzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBk
cm1fZHNjX2NvbmZpZyAqdmRzY19jZmcgPSAmY3J0Y19zdGF0ZS0+ZHBfZHNjX2NmZzsKIAllbnVt
IHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CkBAIC05MDIsNyArOTAyLDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHBfd3JpdGVfZHNjX3Bwc19zZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiB2b2lkIGludGVsX2RzY19lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJ
CSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNy
dGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAlp
OTE1X3JlZ190IGRzc19jdGwxX3JlZywgZHNzX2N0bDJfcmVnOwpAQCAtOTM4LDcgKzkzOCw3IEBA
IHZvaWQgaW50ZWxfZHNjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAog
dm9pZCBpbnRlbF9kc2NfZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xk
X2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KG9sZF9jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAllbnVtIHBp
cGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJaTkxNV9yZWdfdCBkc3NfY3RsMV9yZWcsIGRzc19jdGwy
X3JlZzsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS92bHZfZHNpLmMKaW5kZXggNTAwNjRjZGUw
NzI0Li4xNmY5M2QxZTcxZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvdmx2X2RzaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5j
CkBAIC0yNjEsOSArMjYxLDkgQEAgc3RhdGljIGludCBpbnRlbF9kc2lfY29tcHV0ZV9jb25maWco
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxf
ZHNpID0gY29udGFpbmVyX29mKGVuY29kZXIsIHN0cnVjdCBpbnRlbF9kc2ksCiAJCQkJCQkgICBi
YXNlKTsKIAlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IgPSBpbnRlbF9k
c2ktPmF0dGFjaGVkX2Nvbm5lY3RvcjsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMocGlwZV9jb25maWctPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmlnLT51YXBpLmNydGMpOwogCWNvbnN0IHN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICpmaXhlZF9tb2RlID0gaW50ZWxfY29ubmVjdG9yLT5wYW5lbC5m
aXhlZF9tb2RlOwotCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBp
cGVfY29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
KmFkanVzdGVkX21vZGUgPSAmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IHJl
dDsKIAogCURSTV9ERUJVR19LTVMoIlxuIik7CkBAIC02MjQsNyArNjI0LDcgQEAgc3RhdGljIHZv
aWQgaW50ZWxfZHNpX3BvcnRfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAog
CQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpID0gZW5j
X3RvX2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7CiAJZW51bSBwb3J0IHBvcnQ7CiAKQEAgLTc0
Niw3ICs3NDYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kc2lfcHJlX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2RzaSAqaW50ZWxfZHNpID0gZW5jX3Rv
X2ludGVsX2RzaSgmZW5jb2Rlci0+YmFzZSk7Ci0Jc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlw
ZV9jb25maWctPmJhc2UuY3J0YzsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBwaXBlX2NvbmZp
Zy0+dWFwaS5jcnRjOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUgPSBpbnRlbF9jcnRjLT5waXBlOwpAQCAtMTAz
Miw5ICsxMDMyLDkgQEAgc3RhdGljIHZvaWQgYnh0X2RzaV9nZXRfcGlwZV9jb25maWcoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGVuY29k
ZXItPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCQkJ
CSZwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJCQkmcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGU7CiAJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGVf
c3c7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBpcGVfY29uZmln
LT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0Yyhw
aXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kgPSBl
bmNfdG9faW50ZWxfZHNpKCZlbmNvZGVyLT5iYXNlKTsKIAl1bnNpZ25lZCBpbnQgbGFuZV9jb3Vu
dCA9IGludGVsX2RzaS0+bGFuZV9jb3VudDsKIAl1bnNpZ25lZCBpbnQgYnBwLCBmbXQ7CkBAIC0x
MDQ1LDcgKzEwNDUsNyBAQCBzdGF0aWMgdm9pZCBieHRfZHNpX2dldF9waXBlX2NvbmZpZyhzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQljcnRjX2hibGFua19zdGFydF9zdywgY3J0
Y19oYmxhbmtfZW5kX3N3OwogCiAJLyogRklYTUU6IGh3IHJlYWRvdXQgc2hvdWxkIG5vdCBkZXBl
bmQgb24gU1cgc3RhdGUgKi8KLQlhZGp1c3RlZF9tb2RlX3N3ID0gJmNydGMtPmNvbmZpZy0+YmFz
ZS5hZGp1c3RlZF9tb2RlOworCWFkanVzdGVkX21vZGVfc3cgPSAmY3J0Yy0+Y29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlOwogCiAJLyoKIAkgKiBBdGxlYXN0IG9uZSBwb3J0IGlzIGFjdGl2ZSBhcyBl
bmNvZGVyLT5nZXRfY29uZmlnIGNhbGxlZCBvbmx5IGlmCkBAIC0xMjA0LDcgKzEyMDQsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9kc2lfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAl9CiAKIAlpZiAocGNsaykgewotCQlwaXBlX2NvbmZpZy0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfY2xvY2sgPSBwY2xrOworCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX2Nsb2NrID0gcGNsazsKIAkJcGlwZV9jb25maWctPnBvcnRfY2xvY2sgPSBwY2xrOwogCX0K
IH0KQEAgLTEzMTUsOSArMTMxNSw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2RzaV9wcmVwYXJlKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNvZGVyLAogCXN0cnVjdCBkcm1fZW5jb2RlciAq
ZW5jb2RlciA9ICZpbnRlbF9lbmNvZGVyLT5iYXNlOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBlbmNvZGVyLT5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShkZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0
YyhwaXBlX2NvbmZpZy0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0
YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGludGVs
X2RzaSAqaW50ZWxfZHNpID0gZW5jX3RvX2ludGVsX2RzaShlbmNvZGVyKTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9ICZwaXBlX2NvbmZpZy0+YmFzZS5h
ZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9t
b2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwogCWVudW0gcG9ydCBwb3J0Owog
CXVuc2lnbmVkIGludCBicHAgPSBtaXBpX2RzaV9waXhlbF9mb3JtYXRfdG9fYnBwKGludGVsX2Rz
aS0+cGl4ZWxfZm9ybWF0KTsKIAl1MzIgdmFsLCB0bXA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCmluZGV4IGZlYzlmYjdjYzM4NC4uN2NlM2FlMWVjNTg2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYwpAQCAtMjc1MiwxMSArMjc1MiwxMSBAQCBzdGF0aWMgaW50IGk5MTVf
ZGlzcGxheV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCiAJCXNlcV9w
cmludGYobSwgIkNSVEMgJWQ6IHBpcGU6ICVjLCBhY3RpdmU9JXMsIChzaXplPSVkeCVkKSwgZGl0
aGVyPSVzLCBicHA9JWRcbiIsCiAJCQkgICBjcnRjLT5iYXNlLmJhc2UuaWQsIHBpcGVfbmFtZShj
cnRjLT5waXBlKSwKLQkJCSAgIHllc25vKHBpcGVfY29uZmlnLT5iYXNlLmFjdGl2ZSksCisJCQkg
ICB5ZXNubyhwaXBlX2NvbmZpZy0+aHcuYWN0aXZlKSwKIAkJCSAgIHBpcGVfY29uZmlnLT5waXBl
X3NyY193LCBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfaCwKIAkJCSAgIHllc25vKHBpcGVfY29uZmln
LT5kaXRoZXIpLCBwaXBlX2NvbmZpZy0+cGlwZV9icHApOwogCi0JCWlmIChwaXBlX2NvbmZpZy0+
YmFzZS5hY3RpdmUpIHsKKwkJaWYgKHBpcGVfY29uZmlnLT5ody5hY3RpdmUpIHsKIAkJCXN0cnVj
dCBpbnRlbF9wbGFuZSAqY3Vyc29yID0KIAkJCQl0b19pbnRlbF9wbGFuZShjcnRjLT5iYXNlLmN1
cnNvcik7CiAKQEAgLTQyMDgsMTEgKzQyMDgsMTEgQEAgc3RhdGljIGludCBpOTE1X2RycnNfY3Rs
X3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogCiAJCWNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRj
X3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCi0JCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3Rp
dmUgfHwKKwkJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKIAkJICAgICFjcnRjX3N0YXRl
LT5oYXNfZHJycykKIAkJCWdvdG8gb3V0OwogCi0JCWNvbW1pdCA9IGNydGNfc3RhdGUtPmJhc2Uu
Y29tbWl0OworCQljb21taXQgPSBjcnRjX3N0YXRlLT51YXBpLmNvbW1pdDsKIAkJaWYgKGNvbW1p
dCkgewogCQkJcmV0ID0gd2FpdF9mb3JfY29tcGxldGlvbl9pbnRlcnJ1cHRpYmxlKCZjb21taXQt
Pmh3X2RvbmUpOwogCQkJaWYgKHJldCkKQEAgLTQyMjQsNyArNDIyNCw3IEBAIHN0YXRpYyBpbnQg
aTkxNV9kcnJzX2N0bF9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAkJCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyOwogCQkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcDsKIAotCQkJaWYg
KCEoY3J0Y19zdGF0ZS0+YmFzZS5jb25uZWN0b3JfbWFzayAmCisJCQlpZiAoIShjcnRjX3N0YXRl
LT51YXBpLmNvbm5lY3Rvcl9tYXNrICYKIAkJCSAgICAgIGRybV9jb25uZWN0b3JfbWFzayhjb25u
ZWN0b3IpKSkKIAkJCQljb250aW51ZTsKIApAQCAtNDI4MywxNCArNDI4MywxNCBAQCBpOTE1X2Zp
Zm9fdW5kZXJydW5fcmVzZXRfd3JpdGUoc3RydWN0IGZpbGUgKmZpbHAsCiAJCQlyZXR1cm4gcmV0
OwogCiAJCWNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGludGVsX2NydGMtPmJhc2Uu
c3RhdGUpOwotCQljb21taXQgPSBjcnRjX3N0YXRlLT5iYXNlLmNvbW1pdDsKKwkJY29tbWl0ID0g
Y3J0Y19zdGF0ZS0+dWFwaS5jb21taXQ7CiAJCWlmIChjb21taXQpIHsKIAkJCXJldCA9IHdhaXRf
Zm9yX2NvbXBsZXRpb25faW50ZXJydXB0aWJsZSgmY29tbWl0LT5od19kb25lKTsKIAkJCWlmICgh
cmV0KQogCQkJCXJldCA9IHdhaXRfZm9yX2NvbXBsZXRpb25faW50ZXJydXB0aWJsZSgmY29tbWl0
LT5mbGlwX2RvbmUpOwogCQl9CiAKLQkJaWYgKCFyZXQgJiYgY3J0Y19zdGF0ZS0+YmFzZS5hY3Rp
dmUpIHsKKwkJaWYgKCFyZXQgJiYgY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCQlEUk1fREVC
VUdfS01TKCJSZS1hcm1pbmcgRklGTyB1bmRlcnJ1bnMgb24gcGlwZSAlY1xuIiwKIAkJCQkgICAg
ICBwaXBlX25hbWUoaW50ZWxfY3J0Yy0+cGlwZSkpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpp
bmRleCA1ZTZlNTRjYjIyZmUuLjRjOTM1OTk4MWMyNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5j
CkBAIC00NjQsNyArNDY0LDcgQEAgc3RhdGljIGNvbnN0IGludCBwZXNzaW1hbF9sYXRlbmN5X25z
ID0gNTAwMDsKIAogc3RhdGljIHZvaWQgdmx2X2dldF9maWZvX3NpemUoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJc3RydWN0
IHZsdl9maWZvX3N0YXRlICpmaWZvX3N0YXRlID0gJmNydGNfc3RhdGUtPndtLnZsdi5maWZvX3N0
YXRlOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKQEAgLTc5OCw3ICs3OTgsNyBAQCBz
dGF0aWMgYm9vbCBpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAKIAkvKiBGSVhNRSBjaGVjayB0aGUg
J2VuYWJsZScgaW5zdGVhZCAqLwotCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYg
KCFjcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCXJldHVybiBmYWxzZTsKIAogCS8qCkBAIC04NTEs
NyArODUxLDcgQEAgc3RhdGljIHZvaWQgcGluZXZpZXdfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9j
cnRjICp1bnVzZWRfY3J0YykKIAljcnRjID0gc2luZ2xlX2VuYWJsZWRfY3J0YyhkZXZfcHJpdik7
CiAJaWYgKGNydGMpIHsKIAkJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVk
X21vZGUgPQotCQkJJmNydGMtPmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGMt
PmNvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPQogCQkJY3J0Yy0+YmFzZS5wcmltYXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjcHAgPSBm
Yi0+Zm9ybWF0LT5jcHBbMF07CkBAIC0xMDg3LDcgKzEwODcsNyBAQCBzdGF0aWMgdTE2IGc0eF9j
b21wdXRlX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFz
ZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShw
bGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3Rl
ZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJJmNydGNfc3Rh
dGUtPmh3LmFkanVzdGVkX21vZGU7CiAJdW5zaWduZWQgaW50IGxhdGVuY3kgPSBkZXZfcHJpdi0+
d20ucHJpX2xhdGVuY3lbbGV2ZWxdICogMTA7CiAJdW5zaWduZWQgaW50IGNsb2NrLCBodG90YWws
IGNwcCwgd2lkdGgsIHdtOwogCkBAIC0xMTQ0LDcgKzExNDQsNyBAQCBzdGF0aWMgdTE2IGc0eF9j
b21wdXRlX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogc3Rh
dGljIGJvb2wgZzR4X3Jhd19wbGFuZV93bV9zZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQkJIGludCBsZXZlbCwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCwgdTE2IHZh
bHVlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCWJvb2wgZGlydHkg
PSBmYWxzZTsKIAogCWZvciAoOyBsZXZlbCA8IGludGVsX3dtX251bV9sZXZlbHMoZGV2X3ByaXYp
OyBsZXZlbCsrKSB7CkBAIC0xMTYwLDcgKzExNjAsNyBAQCBzdGF0aWMgYm9vbCBnNHhfcmF3X3Bs
YW5lX3dtX3NldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyBi
b29sIGc0eF9yYXdfZmJjX3dtX3NldChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJCSAgICAgICBpbnQgbGV2ZWwsIHUxNiB2YWx1ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUt
PnVhcGkuY3J0Yy0+ZGV2KTsKIAlib29sIGRpcnR5ID0gZmFsc2U7CiAKIAkvKiBOT1JNQUwgbGV2
ZWwgZG9lc24ndCBoYXZlIGFuIEZCQyB3YXRlcm1hcmsgKi8KQEAgLTEyNjIsNyArMTI2Miw3IEBA
IHN0YXRpYyBib29sIGc0eF9yYXdfcGxhbmVfd21faXNfdmFsaWQoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgYm9vbCBnNHhfcmF3X2NydGNfd21faXNf
dmFsaWQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAg
ICBpbnQgbGV2ZWwpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAKIAlp
ZiAobGV2ZWwgPiBkZXZfcHJpdi0+d20ubWF4X2xldmVsKQogCQlyZXR1cm4gZmFsc2U7CkBAIC0x
MzAwLDkgKzEzMDAsOSBAQCBzdGF0aWMgdm9pZCBnNHhfaW52YWxpZGF0ZV93bXMoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiAKIHN0YXRpYyBpbnQgZzR4X2NvbXB1dGVfcGlwZV93bShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShj
cnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKKwkJdG9faW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3Rh
dGUtPnVhcGkuc3RhdGUpOwogCXN0cnVjdCBnNHhfd21fc3RhdGUgKndtX3N0YXRlID0gJmNydGNf
c3RhdGUtPndtLmc0eC5vcHRpbWFsOwogCWludCBudW1fYWN0aXZlX3BsYW5lcyA9IGh3ZWlnaHQ4
KGNydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgJgogCQkJCQkgfkJJVChQTEFORV9DVVJTT1IpKTsK
QEAgLTEzODksMTcgKzEzODksMTcgQEAgc3RhdGljIGludCBnNHhfY29tcHV0ZV9waXBlX3dtKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgaW50IGc0eF9jb21w
dXRlX2ludGVybWVkaWF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3Rh
dGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRj
X3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZzR4X3dtX3N0YXRlICpp
bnRlcm1lZGlhdGUgPSAmbmV3X2NydGNfc3RhdGUtPndtLmc0eC5pbnRlcm1lZGlhdGU7CiAJY29u
c3Qgc3RydWN0IGc0eF93bV9zdGF0ZSAqb3B0aW1hbCA9ICZuZXdfY3J0Y19zdGF0ZS0+d20uZzR4
Lm9wdGltYWw7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPQotCQl0
b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCQl0b19p
bnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCWNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9CiAJCWludGVsX2F0b21pY19n
ZXRfb2xkX2NydGNfc3RhdGUoaW50ZWxfc3RhdGUsIGNydGMpOwogCWNvbnN0IHN0cnVjdCBnNHhf
d21fc3RhdGUgKmFjdGl2ZSA9ICZvbGRfY3J0Y19zdGF0ZS0+d20uZzR4Lm9wdGltYWw7CiAJZW51
bSBwbGFuZV9pZCBwbGFuZV9pZDsKIAotCWlmICghbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZl
IHx8IGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdfY3J0Y19zdGF0ZS0+YmFzZSkp
IHsKKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwgZHJtX2F0b21pY19jcnRjX25l
ZWRzX21vZGVzZXQoJm5ld19jcnRjX3N0YXRlLT51YXBpKSkgewogCQkqaW50ZXJtZWRpYXRlID0g
Km9wdGltYWw7CiAKIAkJaW50ZXJtZWRpYXRlLT5jeHNyID0gZmFsc2U7CkBAIC0xNTMxLDggKzE1
MzEsOCBAQCBzdGF0aWMgdm9pZCBnNHhfcHJvZ3JhbV93YXRlcm1hcmtzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIHN0YXRpYyB2b2lkIGc0eF9pbml0aWFsX3dhdGVybWFya3Mo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBp
LmNydGMtPmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAKIAltdXRleF9sb2NrKCZkZXZfcHJpdi0+d20ud21fbXV0
ZXgpOwogCWNydGMtPndtLmFjdGl2ZS5nNHggPSBjcnRjX3N0YXRlLT53bS5nNHguaW50ZXJtZWRp
YXRlOwpAQCAtMTU0Myw4ICsxNTQzLDggQEAgc3RhdGljIHZvaWQgZzR4X2luaXRpYWxfd2F0ZXJt
YXJrcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIHN0YXRpYyB2b2lkIGc0eF9v
cHRpbWl6ZV93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJ
CSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+
ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAogCWlmICghY3J0Y19z
dGF0ZS0+d20ubmVlZF9wb3N0dmJsX3VwZGF0ZSkKIAkJcmV0dXJuOwpAQCAtMTU5Myw3ICsxNTkz
LDcgQEAgc3RhdGljIHUxNiB2bHZfY29tcHV0ZV93bV9sZXZlbChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCSZjcnRjX3N0YXRlLT5iYXNl
LmFkanVzdGVkX21vZGU7CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXVuc2ln
bmVkIGludCBjbG9jaywgaHRvdGFsLCBjcHAsIHdpZHRoLCB3bTsKIAogCWlmIChkZXZfcHJpdi0+
d20ucHJpX2xhdGVuY3lbbGV2ZWxdID09IDApCkBAIC0xNjMxLDcgKzE2MzEsNyBAQCBzdGF0aWMg
Ym9vbCB2bHZfbmVlZF9zcHJpdGUwX2ZpZm9fd29ya2Fyb3VuZCh1bnNpZ25lZCBpbnQgYWN0aXZl
X3BsYW5lcykKIAogc3RhdGljIGludCB2bHZfY29tcHV0ZV9maWZvKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCWNvbnN0IHN0cnVjdCBn
NHhfcGlwZV93bSAqcmF3ID0KIAkJJmNydGNfc3RhdGUtPndtLnZsdi5yYXdbVkxWX1dNX0xFVkVM
X1BNMl07CiAJc3RydWN0IHZsdl9maWZvX3N0YXRlICpmaWZvX3N0YXRlID0gJmNydGNfc3RhdGUt
PndtLnZsdi5maWZvX3N0YXRlOwpAQCAtMTc0Myw3ICsxNzQzLDcgQEAgc3RhdGljIHUxNiB2bHZf
aW52ZXJ0X3dtX3ZhbHVlKHUxNiB3bSwgdTE2IGZpZm9fc2l6ZSkKIHN0YXRpYyBib29sIHZsdl9y
YXdfcGxhbmVfd21fc2V0KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJ
CSBpbnQgbGV2ZWwsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsIHUxNiB2YWx1ZSkKIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2Uu
Y3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlpbnQgbnVtX2xldmVscyA9IGludGVsX3dt
X251bV9sZXZlbHMoZGV2X3ByaXYpOwogCWJvb2wgZGlydHkgPSBmYWxzZTsKIApAQCAtMTgxOCwx
NiArMTgxOCwxNiBAQCBzdGF0aWMgYm9vbCB2bHZfcmF3X2NydGNfd21faXNfdmFsaWQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIHN0YXRpYyBpbnQgdmx2X2Nv
bXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9
Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKKwkJdG9f
aW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCXN0cnVjdCB2bHZf
d21fc3RhdGUgKndtX3N0YXRlID0gJmNydGNfc3RhdGUtPndtLnZsdi5vcHRpbWFsOwogCWNvbnN0
IHN0cnVjdCB2bHZfZmlmb19zdGF0ZSAqZmlmb19zdGF0ZSA9CiAJCSZjcnRjX3N0YXRlLT53bS52
bHYuZmlmb19zdGF0ZTsKIAlpbnQgbnVtX2FjdGl2ZV9wbGFuZXMgPSBod2VpZ2h0OChjcnRjX3N0
YXRlLT5hY3RpdmVfcGxhbmVzICYKIAkJCQkJIH5CSVQoUExBTkVfQ1VSU09SKSk7Ci0JYm9vbCBu
ZWVkc19tb2Rlc2V0ID0gZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJmNydGNfc3RhdGUt
PmJhc2UpOworCWJvb2wgbmVlZHNfbW9kZXNldCA9IGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rl
c2V0KCZjcnRjX3N0YXRlLT51YXBpKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
Km9sZF9wbGFuZV9zdGF0ZTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19w
bGFuZV9zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwpAQCAtMTkyNiw3ICsxOTI2
LDcgQEAgc3RhdGljIGludCB2bHZfY29tcHV0ZV9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogc3RhdGljIHZvaWQgdmx2X2F0b21pY191cGRhdGVfZmlmbyhzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKIAljb25zdCBzdHJ1Y3Qgdmx2
X2ZpZm9fc3RhdGUgKmZpZm9fc3RhdGUgPQpAQCAtMjAyMiwxNyArMjAyMiwxNyBAQCBzdGF0aWMg
dm9pZCB2bHZfYXRvbWljX3VwZGF0ZV9maWZvKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlLAogCiBzdGF0aWMgaW50IHZsdl9jb21wdXRlX2ludGVybWVkaWF0ZV93bShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jcnRj
KTsKIAlzdHJ1Y3Qgdmx2X3dtX3N0YXRlICppbnRlcm1lZGlhdGUgPSAmbmV3X2NydGNfc3RhdGUt
PndtLnZsdi5pbnRlcm1lZGlhdGU7CiAJY29uc3Qgc3RydWN0IHZsdl93bV9zdGF0ZSAqb3B0aW1h
bCA9ICZuZXdfY3J0Y19zdGF0ZS0+d20udmx2Lm9wdGltYWw7CiAJc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqaW50ZWxfc3RhdGUgPQotCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNf
c3RhdGUtPmJhc2Uuc3RhdGUpOworCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3Rh
dGUtPnVhcGkuc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0
Y19zdGF0ZSA9CiAJCWludGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3RhdGUoaW50ZWxfc3RhdGUs
IGNydGMpOwogCWNvbnN0IHN0cnVjdCB2bHZfd21fc3RhdGUgKmFjdGl2ZSA9ICZvbGRfY3J0Y19z
dGF0ZS0+d20udmx2Lm9wdGltYWw7CiAJaW50IGxldmVsOwogCi0JaWYgKCFuZXdfY3J0Y19zdGF0
ZS0+YmFzZS5hY3RpdmUgfHwgZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJm5ld19jcnRj
X3N0YXRlLT5iYXNlKSkgeworCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fCBkcm1f
YXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmbmV3X2NydGNfc3RhdGUtPnVhcGkpKSB7CiAJCSpp
bnRlcm1lZGlhdGUgPSAqb3B0aW1hbDsKIAogCQlpbnRlcm1lZGlhdGUtPmN4c3IgPSBmYWxzZTsK
QEAgLTIxNTAsOCArMjE1MCw4IEBAIHN0YXRpYyB2b2lkIHZsdl9wcm9ncmFtX3dhdGVybWFya3Mo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogc3RhdGljIHZvaWQgdmx2X2luaXRp
YWxfd2F0ZXJtYXJrcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsK
LQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFz
ZS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAogCW11dGV4X2xvY2soJmRldl9w
cml2LT53bS53bV9tdXRleCk7CiAJY3J0Yy0+d20uYWN0aXZlLnZsdiA9IGNydGNfc3RhdGUtPndt
LnZsdi5pbnRlcm1lZGlhdGU7CkBAIC0yMTYyLDggKzIxNjIsOCBAQCBzdGF0aWMgdm9pZCB2bHZf
aW5pdGlhbF93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogc3Rh
dGljIHZvaWQgdmx2X29wdGltaXplX3dhdGVybWFya3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0
ZS0+YmFzZS5jcnRjLT5kZXYpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwog
CiAJaWYgKCFjcnRjX3N0YXRlLT53bS5uZWVkX3Bvc3R2YmxfdXBkYXRlKQogCQlyZXR1cm47CkBA
IC0yMTg4LDcgKzIxODgsNyBAQCBzdGF0aWMgdm9pZCBpOTY1X3VwZGF0ZV93bShzdHJ1Y3QgaW50
ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJCS8qIHNlbGYtcmVmcmVzaCBoYXMgbXVjaCBoaWdoZXIg
bGF0ZW5jeSAqLwogCQlzdGF0aWMgY29uc3QgaW50IHNyX2xhdGVuY3lfbnMgPSAxMjAwMDsKIAkJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkJJmNydGMt
PmNvbmZpZy0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGMtPmNvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZTsKIAkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPQogCQkJY3J0Yy0+
YmFzZS5wcmltYXJ5LT5zdGF0ZS0+ZmI7CiAJCWludCBjbG9jayA9IGFkanVzdGVkX21vZGUtPmNy
dGNfY2xvY2s7CkBAIC0yMjY5LDcgKzIyNjksNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV93
bShzdHJ1Y3QgaW50ZWxfY3J0YyAqdW51c2VkX2NydGMpCiAJY3J0YyA9IGludGVsX2dldF9jcnRj
X2Zvcl9wbGFuZShkZXZfcHJpdiwgUExBTkVfQSk7CiAJaWYgKGludGVsX2NydGNfYWN0aXZlKGNy
dGMpKSB7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0K
LQkJCSZjcnRjLT5jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9kZTsKKwkJCSZjcnRjLT5jb25maWct
Pmh3LmFkanVzdGVkX21vZGU7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0K
IAkJCWNydGMtPmJhc2UucHJpbWFyeS0+c3RhdGUtPmZiOwogCQlpbnQgY3BwOwpAQCAtMjI5Niw3
ICsyMjk2LDcgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfd20oc3RydWN0IGludGVsX2NydGMg
KnVudXNlZF9jcnRjKQogCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGxhbmUoZGV2X3ByaXYs
IFBMQU5FX0IpOwogCWlmIChpbnRlbF9jcnRjX2FjdGl2ZShjcnRjKSkgewogCQljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCQkmY3J0Yy0+Y29uZmlnLT5i
YXNlLmFkanVzdGVkX21vZGU7CisJCQkmY3J0Yy0+Y29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwog
CQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9CiAJCQljcnRjLT5iYXNlLnByaW1h
cnktPnN0YXRlLT5mYjsKIAkJaW50IGNwcDsKQEAgLTIzNDQsNyArMjM0NCw3IEBAIHN0YXRpYyB2
b2lkIGk5eHhfdXBkYXRlX3dtKHN0cnVjdCBpbnRlbF9jcnRjICp1bnVzZWRfY3J0YykKIAkJLyog
c2VsZi1yZWZyZXNoIGhhcyBtdWNoIGhpZ2hlciBsYXRlbmN5ICovCiAJCXN0YXRpYyBjb25zdCBp
bnQgc3JfbGF0ZW5jeV9ucyA9IDYwMDA7CiAJCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlID0KLQkJCSZlbmFibGVkLT5jb25maWctPmJhc2UuYWRqdXN0ZWRfbW9k
ZTsKKwkJCSZlbmFibGVkLT5jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0KIAkJCWVuYWJsZWQtPmJhc2UucHJpbWFyeS0+c3RhdGUt
PmZiOwogCQlpbnQgY2xvY2sgPSBhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrOwpAQCAtMjQwMiw3
ICsyNDAyLDcgQEAgc3RhdGljIHZvaWQgaTg0NV91cGRhdGVfd20oc3RydWN0IGludGVsX2NydGMg
KnVudXNlZF9jcnRjKQogCWlmIChjcnRjID09IE5VTEwpCiAJCXJldHVybjsKIAotCWFkanVzdGVk
X21vZGUgPSAmY3J0Yy0+Y29uZmlnLT5iYXNlLmFkanVzdGVkX21vZGU7CisJYWRqdXN0ZWRfbW9k
ZSA9ICZjcnRjLT5jb25maWctPmh3LmFkanVzdGVkX21vZGU7CiAJcGxhbmVhX3dtID0gaW50ZWxf
Y2FsY3VsYXRlX3dtKGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2ssCiAJCQkJICAgICAgICZpODQ1
X3dtX2luZm8sCiAJCQkJICAgICAgIGRldl9wcml2LT5kaXNwbGF5LmdldF9maWZvX3NpemUoZGV2
X3ByaXYsIFBMQU5FX0EpLApAQCAtMjQ5Miw3ICsyNDkyLDcgQEAgc3RhdGljIHUzMiBpbGtfY29t
cHV0ZV9wcmlfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CXJldHVybiBtZXRob2QxOwogCiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2QyKGNydGNfc3RhdGUt
PnBpeGVsX3JhdGUsCi0JCQkJIGNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0
b3RhbCwKKwkJCQkgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKIAkJ
CQkgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCksCiAJCQkJIGNwcCwgbWVt
X3ZhbHVlKTsKIApAQCAtMjUyMCw3ICsyNTIwLDcgQEAgc3RhdGljIHUzMiBpbGtfY29tcHV0ZV9z
cHJfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIAltZXRo
b2QxID0gaWxrX3dtX21ldGhvZDEoY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZSwgY3BwLCBtZW1fdmFs
dWUpOwogCW1ldGhvZDIgPSBpbGtfd21fbWV0aG9kMihjcnRjX3N0YXRlLT5waXhlbF9yYXRlLAot
CQkJCSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwsCisJCQkJIGNy
dGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwsCiAJCQkJIGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLAogCQkJCSBjcHAsIG1lbV92YWx1ZSk7CiAJcmV0
dXJuIG1pbihtZXRob2QxLCBtZXRob2QyKTsKQEAgLTI1NDUsNyArMjU0NSw3IEBAIHN0YXRpYyB1
MzIgaWxrX2NvbXB1dGVfY3VyX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCWNwcCA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKIAog
CXJldHVybiBpbGtfd21fbWV0aG9kMihjcnRjX3N0YXRlLT5waXhlbF9yYXRlLAotCQkJICAgICAg
Y3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsLAorCQkJICAgICAgY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKIAkJCSAgICAgIGRybV9yZWN0
X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLAogCQkJICAgICAgY3BwLCBtZW1fdmFsdWUp
OwogfQpAQCAtMjc2NywxMiArMjc2NywxMiBAQCBzdGF0aWMgdTMyCiBoc3dfY29tcHV0ZV9saW5l
dGltZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlj
b25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVs
X2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKKwkJdG9faW50ZWxfYXRvbWlj
X3N0YXRlKGNydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICphZGp1c3RlZF9tb2RlID0KLQkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9k
ZTsKKwkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJdTMyIGxpbmV0aW1lLCBpcHNf
bGluZXRpbWU7CiAKLQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCWlmICghY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlKQogCQlyZXR1cm4gMDsKIAlpZiAoV0FSTl9PTihhZGp1c3RlZF9tb2Rl
LT5jcnRjX2Nsb2NrID09IDApKQogCQlyZXR1cm4gMDsKQEAgLTMwODIsMTEgKzMwODIsOSBAQCBz
dGF0aWMgYm9vbCBpbGtfdmFsaWRhdGVfcGlwZV93bShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAvKiBDb21wdXRlIG5ldyB3YXRlcm1hcmtzIGZvciB0aGUgcGlwZSAq
Lwogc3RhdGljIGludCBpbGtfY29tcHV0ZV9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNf
c3RhdGUtPmJhc2Uuc3RhdGU7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19p
bnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CisJc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVh
cGkuY3J0Yyk7CiAJc3RydWN0IGludGVsX3BpcGVfd20gKnBpcGVfd207Ci0Jc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9IHN0YXRlLT5kZXY7Ci0JY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CiAJ
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKIAljb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnByaXN0YXRlID0gTlVMTDsKQEAgLTMxMDYsNyArMzEwNCw3
IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIAkJCWN1cnN0YXRlID0gcGxhbmVfc3RhdGU7CiAJfQogCi0JcGlwZV93
bS0+cGlwZV9lbmFibGVkID0gY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmU7CisJcGlwZV93bS0+cGlw
ZV9lbmFibGVkID0gY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwogCWlmIChzcHJzdGF0ZSkgewogCQlw
aXBlX3dtLT5zcHJpdGVzX2VuYWJsZWQgPSBzcHJzdGF0ZS0+YmFzZS52aXNpYmxlOwogCQlwaXBl
X3dtLT5zcHJpdGVzX3NjYWxlZCA9IHNwcnN0YXRlLT5iYXNlLnZpc2libGUgJiYKQEAgLTMxNjMs
MTEgKzMxNjEsMTEgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9waXBlX3dtKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogICovCiBzdGF0aWMgaW50IGlsa19jb21wdXRlX2lu
dGVybWVkaWF0ZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3c3RhdGUpCiB7Ci0Jc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKG5ld3N0YXRlLT5iYXNl
LmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0Yyhu
ZXdzdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGludGVsX2NydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGlwZV93bSAq
YSA9ICZuZXdzdGF0ZS0+d20uaWxrLmludGVybWVkaWF0ZTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICppbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdzdGF0ZS0+
YmFzZS5zdGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdzdGF0ZS0+dWFwaS5zdGF0
ZSk7CiAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZHN0YXRlID0KIAkJaW50ZWxf
YXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShpbnRlbF9zdGF0ZSwgaW50ZWxfY3J0Yyk7CiAJY29u
c3Qgc3RydWN0IGludGVsX3BpcGVfd20gKmIgPSAmb2xkc3RhdGUtPndtLmlsay5vcHRpbWFsOwpA
QCAtMzE3OSw3ICszMTc3LDcgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9pbnRlcm1lZGlhdGVf
d20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld3N0YXRlKQogCSAqIGFuZCBhZnRlciB0aGUg
dmJsYW5rLgogCSAqLwogCSphID0gbmV3c3RhdGUtPndtLmlsay5vcHRpbWFsOwotCWlmICghbmV3
c3RhdGUtPmJhc2UuYWN0aXZlIHx8IGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZuZXdz
dGF0ZS0+YmFzZSkgfHwKKwlpZiAoIW5ld3N0YXRlLT5ody5hY3RpdmUgfHwgZHJtX2F0b21pY19j
cnRjX25lZWRzX21vZGVzZXQoJm5ld3N0YXRlLT51YXBpKSB8fAogCSAgICBpbnRlbF9zdGF0ZS0+
c2tpcF9pbnRlcm1lZGlhdGVfd20pCiAJCXJldHVybiAwOwogCkBAIC0zNzU2LDcgKzM3NTQsNyBA
QCBib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOwog
CWNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCi0J
aWYgKGNydGMtPmJhc2Uuc3RhdGUtPmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFH
X0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERS
TV9NT0RFX0ZMQUdfSU5URVJMQUNFKQogCQlyZXR1cm4gZmFsc2U7CiAKIAlmb3JfZWFjaF9pbnRl
bF9wbGFuZV9vbl9jcnRjKGRldiwgY3J0YywgcGxhbmUpIHsKQEAgLTM4MDYsNyArMzgwNCw3IEBA
IHN0YXRpYyB1MTYgaW50ZWxfZ2V0X2RkYl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQogCQlyZXR1cm4gZGRiX3Np
emUgLSA0OyAvKiA0IGJsb2NrcyBmb3IgYnlwYXNzIHBhdGggYWxsb2NhdGlvbiAqLwogCi0JYWRq
dXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGU7CisJYWRqdXN0ZWRf
bW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCXRvdGFsX2RhdGFfYncgPSB0
b3RhbF9kYXRhX3JhdGUgKiBkcm1fbW9kZV92cmVmcmVzaChhZGp1c3RlZF9tb2RlKTsKIAogCS8q
CkBAIC0zODM1LDE2ICszODMzLDE2IEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1p
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCSAgIHN0cnVjdCBza2xf
ZGRiX2VudHJ5ICphbGxvYywgLyogb3V0ICovCiAJCQkJICAgaW50ICpudW1fYWN0aXZlIC8qIG91
dCAqLykKIHsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRlLT5i
YXNlLnN0YXRlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUt
PnVhcGkuc3RhdGU7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPSB0
b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpOwotCXN0cnVjdCBkcm1fY3J0YyAqZm9yX2NydGMg
PSBjcnRjX3N0YXRlLT5iYXNlLmNydGM7CisJc3RydWN0IGRybV9jcnRjICpmb3JfY3J0YyA9IGNy
dGNfc3RhdGUtPnVhcGkuY3J0YzsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAl1
MzIgcGlwZV93aWR0aCA9IDAsIHRvdGFsX3dpZHRoID0gMCwgd2lkdGhfYmVmb3JlX3BpcGUgPSAw
OwogCWVudW0gcGlwZSBmb3JfcGlwZSA9IHRvX2ludGVsX2NydGMoZm9yX2NydGMpLT5waXBlOwog
CXUxNiBkZGJfc2l6ZTsKIAl1MzIgaTsKIAotCWlmIChXQVJOX09OKCFzdGF0ZSkgfHwgIWNydGNf
c3RhdGUtPmJhc2UuYWN0aXZlKSB7CisJaWYgKFdBUk5fT04oIXN0YXRlKSB8fCAhY3J0Y19zdGF0
ZS0+aHcuYWN0aXZlKSB7CiAJCWFsbG9jLT5zdGFydCA9IDA7CiAJCWFsbG9jLT5lbmQgPSAwOwog
CQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGRldl9wcml2LT5hY3RpdmVfcGlwZXMpOwpAQCAtMzg4
MywxMSArMzg4MSwxMSBAQCBza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKi8KIAlmb3JfZWFjaF9uZXdfaW50ZWxf
Y3J0Y19pbl9zdGF0ZShpbnRlbF9zdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkgewogCQljb25z
dCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9Ci0JCQkmY3J0Y19zdGF0
ZS0+YmFzZS5hZGp1c3RlZF9tb2RlOworCQkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7
CiAJCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAkJaW50IGhkaXNwbGF5LCB2ZGlzcGxh
eTsKIAotCQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCQlpZiAoIWNydGNfc3RhdGUt
Pmh3LmVuYWJsZSkKIAkJCWNvbnRpbnVlOwogCiAJCWRybV9tb2RlX2dldF9odl90aW1pbmcoYWRq
dXN0ZWRfbW9kZSwgJmhkaXNwbGF5LCAmdmRpc3BsYXkpOwpAQCAtMzkxOCw3ICszOTE2LDcgQEAg
c3RhdGljIHVuc2lnbmVkIGludAogc2tsX2N1cnNvcl9hbGxvY2F0aW9uKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkgICAgICBpbnQgbnVtX2FjdGl2ZSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUt
PmJhc2UuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlpbnQgbGV2ZWwsIG1heF9sZXZl
bCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOwogCXN0cnVjdCBza2xfd21fbGV2ZWwgd20g
PSB7fTsKIAlpbnQgcmV0LCBtaW5fZGRiX2FsbG9jID0gMDsKQEAgLTQwNzYsNyArNDA3NCw3IEBA
IHNrbF9waXBlX2Rvd25zY2FsZV9hbW91bnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB7CiAJdWludF9maXhlZF8xNl8xNl90IHBpcGVfZG93bnNjYWxlID0gdTMy
X3RvX2ZpeGVkMTYoMSk7CiAKLQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCWlmICgh
Y3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQogCQlyZXR1cm4gcGlwZV9kb3duc2NhbGU7CiAKIAlpZiAo
Y3J0Y19zdGF0ZS0+cGNoX3BmaXQuZW5hYmxlZCkgewpAQCAtNDEwOCw3ICs0MTA2LDcgQEAgaW50
IHNrbF9jaGVja19waXBlX21heF9waXhlbF9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjLAogCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNl
LmRldik7Ci0Jc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3J0Y19zdGF0ZS0+YmFz
ZS5zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRlLT51
YXBpLnN0YXRlOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7
CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKIAlpbnQgY3J0Y19jbG9jaywgZG90Y2xrOwpA
QCAtNDExNiw3ICs0MTE0LDcgQEAgaW50IHNrbF9jaGVja19waXBlX21heF9waXhlbF9yYXRlKHN0
cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCXVpbnRfZml4ZWRfMTZfMTZfdCBwaXBlX2Rv
d25zY2FsZTsKIAl1aW50X2ZpeGVkXzE2XzE2X3QgbWF4X2Rvd25zY2FsZSA9IHUzMl90b19maXhl
ZDE2KDEpOwogCi0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmVuYWJsZSkKKwlpZiAoIWNydGNfc3Rh
dGUtPmh3LmVuYWJsZSkKIAkJcmV0dXJuIDA7CiAKIAlpbnRlbF9hdG9taWNfY3J0Y19zdGF0ZV9m
b3JfZWFjaF9wbGFuZV9zdGF0ZShwbGFuZSwgcGxhbmVfc3RhdGUsIGNydGNfc3RhdGUpIHsKQEAg
LTQxNDIsNyArNDE0MCw3IEBAIGludCBza2xfY2hlY2tfcGlwZV9tYXhfcGl4ZWxfcmF0ZShzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAogCXBpcGVfZG93bnNjYWxlID0gbXVsX2ZpeGVk
MTYocGlwZV9kb3duc2NhbGUsIG1heF9kb3duc2NhbGUpOwogCi0JY3J0Y19jbG9jayA9IGNydGNf
c3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworCWNydGNfY2xvY2sgPSBjcnRj
X3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CiAJZG90Y2xrID0gdG9faW50ZWxf
YXRvbWljX3N0YXRlKHN0YXRlKS0+Y2RjbGsubG9naWNhbC5jZGNsazsKIAogCWlmIChJU19HRU1J
TklMQUtFKGRldl9wcml2KSB8fCBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQpAQCAtNDIwOSw3
ICs0MjA3LDcgQEAgc2tsX2dldF90b3RhbF9yZWxhdGl2ZV9kYXRhX3JhdGUoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJIHU2NCAqcGxhbmVfZGF0YV9yYXRlLAogCQkJ
CSB1NjQgKnV2X3BsYW5lX2RhdGFfcmF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGUgPSBjcnRjX3N0YXRlLT5iYXNlLnN0YXRlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSA9IGNydGNfc3RhdGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOwogCXU2
NCB0b3RhbF9kYXRhX3JhdGUgPSAwOwpAQCAtNDI0NCw3ICs0MjQyLDcgQEAgaWNsX2dldF90b3Rh
bF9yZWxhdGl2ZV9kYXRhX3JhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKIAl1NjQgdG90
YWxfZGF0YV9yYXRlID0gMDsKIAotCWlmIChXQVJOX09OKCFjcnRjX3N0YXRlLT5iYXNlLnN0YXRl
KSkKKwlpZiAoV0FSTl9PTighY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSkpCiAJCXJldHVybiAwOwog
CiAJLyogQ2FsY3VsYXRlIGFuZCBjYWNoZSBkYXRhIHJhdGUgZm9yIGVhY2ggcGxhbmUgKi8KQEAg
LTQyODgsOCArNDI4Niw4IEBAIHN0YXRpYyBpbnQKIHNrbF9hbGxvY2F0ZV9waXBlX2RkYihzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJICAgICAgc3RydWN0IHNrbF9kZGJf
YWxsb2NhdGlvbiAqZGRiIC8qIG91dCAqLykKIHsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGUgPSBjcnRjX3N0YXRlLT5iYXNlLnN0YXRlOwotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9
IGNydGNfc3RhdGUtPmJhc2UuY3J0YzsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUg
PSBjcnRjX3N0YXRlLT51YXBpLnN0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNydGNf
c3RhdGUtPnVhcGkuY3J0YzsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19p
bnRlbF9jcnRjKGNydGMpOwogCXN0cnVjdCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjcnRjX3N0
YXRlLT53bS5za2wuZGRiOwpAQCAtNDMxMSw3ICs0MzA5LDcgQEAgc2tsX2FsbG9jYXRlX3BpcGVf
ZGRiKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChXQVJOX09OKCFz
dGF0ZSkpCiAJCXJldHVybiAwOwogCi0JaWYgKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSkgewor
CWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCWFsbG9jLT5zdGFydCA9IGFsbG9jLT5l
bmQgPSAwOwogCQlyZXR1cm4gMDsKIAl9CkBAIC00NTUzLDcgKzQ1NTEsNyBAQCBpbnRlbF9nZXRf
bGluZXRpbWVfdXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJ
dTMyIGNydGNfaHRvdGFsOwogCXVpbnRfZml4ZWRfMTZfMTZfdCBsaW5ldGltZV91czsKIAotCWlm
ICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUp
CiAJCXJldHVybiB1MzJfdG9fZml4ZWQxNigwKTsKIAogCXBpeGVsX3JhdGUgPSBjcnRjX3N0YXRl
LT5waXhlbF9yYXRlOwpAQCAtNDU2MSw3ICs0NTU5LDcgQEAgaW50ZWxfZ2V0X2xpbmV0aW1lX3Vz
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChXQVJOX09O
KHBpeGVsX3JhdGUgPT0gMCkpCiAJCXJldHVybiB1MzJfdG9fZml4ZWQxNigwKTsKIAotCWNydGNf
aHRvdGFsID0gY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsOworCWNy
dGNfaHRvdGFsID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbDsKIAls
aW5ldGltZV91cyA9IGRpdl9maXhlZDE2KGNydGNfaHRvdGFsICogMTAwMCwgcGl4ZWxfcmF0ZSk7
CiAKIAlyZXR1cm4gbGluZXRpbWVfdXM7CkBAIC00NTk2LDcgKzQ1OTQsNyBAQCBza2xfY29tcHV0
ZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CSAgICAgIHUzMiBwbGFuZV9waXhlbF9yYXRlLCBzdHJ1Y3Qgc2tsX3dtX3BhcmFtcyAqd3AsCiAJ
CSAgICAgIGludCBjb2xvcl9wbGFuZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIg
aW50ZXJtX3BicGw7CiAKQEAgLTQ3MTcsNyArNDcxNSw3IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21w
dXRlX3BsYW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJCSBjb25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHRfcHJldiwKIAkJCQkgc3RydWN0
IHNrbF93bV9sZXZlbCAqcmVzdWx0IC8qIG91dCAqLykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVh
cGkuY3J0Yy0+ZGV2KTsKIAl1MzIgbGF0ZW5jeSA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeVts
ZXZlbF07CiAJdWludF9maXhlZF8xNl8xNl90IG1ldGhvZDEsIG1ldGhvZDI7CiAJdWludF9maXhl
ZF8xNl8xNl90IHNlbGVjdGVkX3Jlc3VsdDsKQEAgLTQ3NDMsMTQgKzQ3NDEsMTQgQEAgc3RhdGlj
IHZvaWQgc2tsX2NvbXB1dGVfcGxhbmVfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJbWV0aG9kMSA9IHNrbF93bV9tZXRob2QxKGRldl9wcml2LCB3cC0+cGxh
bmVfcGl4ZWxfcmF0ZSwKIAkJCQkgd3AtPmNwcCwgbGF0ZW5jeSwgd3AtPmRidWZfYmxvY2tfc2l6
ZSk7CiAJbWV0aG9kMiA9IHNrbF93bV9tZXRob2QyKHdwLT5wbGFuZV9waXhlbF9yYXRlLAotCQkJ
CSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwsCisJCQkJIGNydGNf
c3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwsCiAJCQkJIGxhdGVuY3ksCiAJCQkJ
IHdwLT5wbGFuZV9ibG9ja3NfcGVyX2xpbmUpOwogCiAJaWYgKHdwLT55X3RpbGVkKSB7CiAJCXNl
bGVjdGVkX3Jlc3VsdCA9IG1heF9maXhlZDE2KG1ldGhvZDIsIHdwLT55X3RpbGVfbWluaW11bSk7
CiAJfSBlbHNlIHsKLQkJaWYgKCh3cC0+Y3BwICogY3J0Y19zdGF0ZS0+YmFzZS5hZGp1c3RlZF9t
b2RlLmNydGNfaHRvdGFsIC8KKwkJaWYgKCh3cC0+Y3BwICogY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX2h0b3RhbCAvCiAJCSAgICAgd3AtPmRidWZfYmxvY2tfc2l6ZSA8IDEpICYm
CiAJCSAgICAgKHdwLT5wbGFuZV9ieXRlc19wZXJfbGluZSAvIHdwLT5kYnVmX2Jsb2NrX3NpemUg
PCAxKSkgewogCQkJc2VsZWN0ZWRfcmVzdWx0ID0gbWV0aG9kMjsKQEAgLTQ4NDEsNyArNDgzOSw3
IEBAIHNrbF9jb21wdXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAkJICAgICAgY29uc3Qgc3RydWN0IHNrbF93bV9wYXJhbXMgKndtX3BhcmFt
cywKIAkJICAgICAgc3RydWN0IHNrbF93bV9sZXZlbCAqbGV2ZWxzKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5k
ZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwogCWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21h
eF9sZXZlbChkZXZfcHJpdik7CiAJc3RydWN0IHNrbF93bV9sZXZlbCAqcmVzdWx0X3ByZXYgPSAm
bGV2ZWxzWzBdOwogCkBAIC00ODU4LDcgKzQ4NTYsNyBAQCBza2xfY29tcHV0ZV93bV9sZXZlbHMo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgdTMyCiBz
a2xfY29tcHV0ZV9saW5ldGltZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRl
LT5iYXNlLnN0YXRlOworCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3Rh
dGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShzdGF0ZS0+ZGV2KTsKIAl1aW50X2ZpeGVkXzE2XzE2X3QgbGluZXRpbWVfdXM7CiAJdTMy
IGxpbmV0aW1lX3dtOwpAQCAtNDg3Nyw3ICs0ODc1LDcgQEAgc3RhdGljIHZvaWQgc2tsX2NvbXB1
dGVfdHJhbnNpdGlvbl93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJCQkgICAgICBjb25zdCBzdHJ1Y3Qgc2tsX3dtX3BhcmFtcyAqd3AsCiAJCQkJICAgICAg
c3RydWN0IHNrbF9wbGFuZV93bSAqd20pCiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNy
dGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2OworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRj
X3N0YXRlLT51YXBpLmNydGMtPmRldjsKIAljb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJdTE2IHRyYW5zX21pbiwgdHJhbnNfeV90aWxlX21p
bjsKIAljb25zdCB1MTYgdHJhbnNfYW1vdW50ID0gMTA7IC8qIFRoaXMgaXMgY29uZmlndXJhYmxl
IGFtb3VudCAqLwpAQCAtNTAzNyw3ICs1MDM1LDcgQEAgc3RhdGljIGludCBpY2xfYnVpbGRfcGxh
bmVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIHN0YXRpYyBpbnQg
c2tsX2J1aWxkX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT5iYXNlLmNydGMtPmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJc3RydWN0IHNrbF9waXBlX3dt
ICpwaXBlX3dtID0gJmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsOwogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmU7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZTsKQEAgLTUyMjcsOCArNTIyNSw4IEBAIHN0YXRpYyBpbnQKIHNrbF9kZGJfYWRkX2FmZmVjdGVk
X3BsYW5lcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJ
CQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewotCXN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19j
cnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMobmV3X2NydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X2NydGNfc3RhdGUtPnVh
cGkuc3RhdGUpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdf
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
OwogCkBAIC01NTI5LDcgKzU1MjcsNyBAQCBzdGF0aWMgaW50IHNrbF93bV9hZGRfYWZmZWN0ZWRf
cGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkgKiBwb3dlciB3ZWxs
IHRoZSBoYXJkd2FyZSBzdGF0ZSB3aWxsIGdvIG91dCBvZiBzeW5jCiAJCSAqIHdpdGggdGhlIHNv
ZnR3YXJlIHN0YXRlLgogCQkgKi8KLQkJaWYgKCFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNl
dCgmbmV3X2NydGNfc3RhdGUtPmJhc2UpICYmCisJCWlmICghZHJtX2F0b21pY19jcnRjX25lZWRz
X21vZGVzZXQoJm5ld19jcnRjX3N0YXRlLT51YXBpKSAmJgogCQkgICAgc2tsX3BsYW5lX3dtX2Vx
dWFscyhkZXZfcHJpdiwKIAkJCQkJJm9sZF9jcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbC5wbGFu
ZXNbcGxhbmVfaWRdLAogCQkJCQkmbmV3X2NydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5l
c1twbGFuZV9pZF0pKQpAQCAtNTU5Nyw3ICs1NTk1LDcgQEAgc2tsX2NvbXB1dGVfd20oc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiBzdGF0aWMgdm9pZCBza2xfYXRvbWljX3VwZGF0
ZV9jcnRjX3dtKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCSAgICAgIHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2Uu
ZGV2KTsKIAlzdHJ1Y3Qgc2tsX3BpcGVfd20gKnBpcGVfd20gPSAmY3J0Y19zdGF0ZS0+d20uc2ts
Lm9wdGltYWw7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtNTYxMSw3ICs1NjA5
LDcgQEAgc3RhdGljIHZvaWQgc2tsX2F0b21pY191cGRhdGVfY3J0Y193bShzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSwKIHN0YXRpYyB2b2lkIHNrbF9pbml0aWFsX3dtKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGMgKmludGVs
X2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGludGVsX2NydGMtPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3Qgc2tsX2RkYl92YWx1ZXMg
KnJlc3VsdHMgPSAmc3RhdGUtPndtX3Jlc3VsdHM7CkBAIC01NjIxLDcgKzU2MTksNyBAQCBzdGF0
aWMgdm9pZCBza2xfaW5pdGlhbF93bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwK
IAogCW11dGV4X2xvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CiAKLQlpZiAoY3J0Y19zdGF0
ZS0+YmFzZS5hY3RpdmVfY2hhbmdlZCkKKwlpZiAoY3J0Y19zdGF0ZS0+dWFwaS5hY3RpdmVfY2hh
bmdlZCkKIAkJc2tsX2F0b21pY191cGRhdGVfY3J0Y193bShzdGF0ZSwgY3J0Y19zdGF0ZSk7CiAK
IAltdXRleF91bmxvY2soJmRldl9wcml2LT53bS53bV9tdXRleCk7CkBAIC01NjgwLDggKzU2Nzgs
OCBAQCBzdGF0aWMgdm9pZCBpbGtfcHJvZ3JhbV93YXRlcm1hcmtzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIHN0YXRpYyB2b2lkIGlsa19pbml0aWFsX3dhdGVybWFya3Moc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjX3N0YXRlLT5iYXNlLmNydGMtPmRldik7Ci0Jc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNy
dGMtPmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CiAKIAltdXRleF9sb2NrKCZkZXZfcHJpdi0+d20ud21fbXV0ZXgp
OwogCWNydGMtPndtLmFjdGl2ZS5pbGsgPSBjcnRjX3N0YXRlLT53bS5pbGsuaW50ZXJtZWRpYXRl
OwpAQCAtNTY5Miw4ICs1NjkwLDggQEAgc3RhdGljIHZvaWQgaWxrX2luaXRpYWxfd2F0ZXJtYXJr
cyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIHN0YXRpYyB2b2lkIGlsa19vcHRp
bWl6ZV93YXRlcm1hcmtzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCSAg
ICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2
KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAogCWlmICghY3J0Y19zdGF0
ZS0+d20ubmVlZF9wb3N0dmJsX3VwZGF0ZSkKIAkJcmV0dXJuOwotLSAKMi4yMy4wCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

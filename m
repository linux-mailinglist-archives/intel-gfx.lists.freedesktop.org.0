Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 01A75FCA84
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 17:05:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C7F226EBD7;
	Thu, 14 Nov 2019 16:05:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9615D6E395
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Nov 2019 16:05:25 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Nov 2019 17:05:13 +0100
Message-Id: <20191114160522.9699-2-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
References: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 02/11] drm/i915: Remove hw.mode
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIG1lbWJlcnMgaW4gaHcubW9kZSBjYW4gYmUgdXNlZCBmcm9tIGFkanVzdGVkX21vZGUgYXMg
d2VsbCwKdXNlIHRoYXQgd2hlbiBhdmFpbGFibGUuCgpTb21lIHBsYWNlcyB0aGF0IHVzZSBody5t
b2RlIGNhbiBiZSBjb252ZXJ0ZWQgdG8gdXNlIGFkanVzdGVkX21vZGUKYXMgd2VsbC4KClNpZ25l
ZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRl
bC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMg
IHwgNDkgKysrKysrKysrKy0tLS0tLS0tLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheV90eXBlcy5oICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHZvLmMgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nkdm8uYyAgICAgfCAxNiArKystLS0KIDQgZmlsZXMgY2hhbmdlZCwgMzQgaW5zZXJ0aW9ucygr
KSwgMzUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYwppbmRleCBhZGY1MGM0YjM4YWQuLjE4YWNlY2MzNjQyZCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTg0NDAsOSArODQ0MCw2
IEBAIHN0YXRpYyB2b2lkIGludGVsX2dldF9waXBlX3NyY19zaXplKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCXRtcCA9IEk5MTVfUkVBRChQSVBFU1JDKGNydGMtPnBpcGUpKTsKIAlwaXBlX2Nv
bmZpZy0+cGlwZV9zcmNfaCA9ICh0bXAgJiAweGZmZmYpICsgMTsKIAlwaXBlX2NvbmZpZy0+cGlw
ZV9zcmNfdyA9ICgodG1wID4+IDE2KSAmIDB4ZmZmZikgKyAxOwotCi0JcGlwZV9jb25maWctPmh3
Lm1vZGUudmRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfaDsKLQlwaXBlX2NvbmZpZy0+
aHcubW9kZS5oZGlzcGxheSA9IHBpcGVfY29uZmlnLT5waXBlX3NyY193OwogfQogCiB2b2lkIGlu
dGVsX21vZGVfZnJvbV9waXBlX2NvbmZpZyhzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSwK
QEAgLTEyMDk4LDggKzEyMDk1LDggQEAgc3RhdGljIGludCBpY2xfYWRkX3N5bmNfbW9kZV9jcnRj
cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJCWNvbnRpbnVlOwogCQlp
ZiAoIWNvbm5lY3Rvci0+aGFzX3RpbGUpCiAJCQljb250aW51ZTsKLQkJaWYgKGNydGNfc3RhdGUt
Pmh3Lm1vZGUuaGRpc3BsYXkgIT0gY29ubmVjdG9yLT50aWxlX2hfc2l6ZSB8fAotCQkgICAgY3J0
Y19zdGF0ZS0+aHcubW9kZS52ZGlzcGxheSAhPSBjb25uZWN0b3ItPnRpbGVfdl9zaXplKQorCQlp
ZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5ICE9IGNvbm5lY3Rv
ci0+dGlsZV9oX3NpemUgfHwKKwkJICAgIGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0
Y192ZGlzcGxheSAhPSBjb25uZWN0b3ItPnRpbGVfdl9zaXplKQogCQkJcmV0dXJuIDA7CiAJCWlm
IChjb25uZWN0b3ItPnRpbGVfaF9sb2MgPT0gY29ubmVjdG9yLT5udW1faF90aWxlIC0gMSAmJgog
CQkgICAgY29ubmVjdG9yLT50aWxlX3ZfbG9jID09IGNvbm5lY3Rvci0+bnVtX3ZfdGlsZSAtIDEp
CkBAIC0xMjUwNiw3ICsxMjUwMyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGlwZV9jb25m
aWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQlpbnRlbF9k
dW1wX2luZm9mcmFtZShkZXZfcHJpdiwgJnBpcGVfY29uZmlnLT5pbmZvZnJhbWVzLmhkbWkpOwog
CiAJRFJNX0RFQlVHX0tNUygicmVxdWVzdGVkIG1vZGU6XG4iKTsKLQlkcm1fbW9kZV9kZWJ1Z19w
cmludG1vZGVsaW5lKCZwaXBlX2NvbmZpZy0+aHcubW9kZSk7CisJZHJtX21vZGVfZGVidWdfcHJp
bnRtb2RlbGluZSgmcGlwZV9jb25maWctPnVhcGkubW9kZSk7CiAJRFJNX0RFQlVHX0tNUygiYWRq
dXN0ZWQgbW9kZTpcbiIpOwogCWRybV9tb2RlX2RlYnVnX3ByaW50bW9kZWxpbmUoJnBpcGVfY29u
ZmlnLT5ody5hZGp1c3RlZF9tb2RlKTsKIAlpbnRlbF9kdW1wX2NydGNfdGltaW5ncygmcGlwZV9j
b25maWctPmh3LmFkanVzdGVkX21vZGUpOwpAQCAtMTI2NDAsMTYgKzEyNjM3LDE2IEBAIGludGVs
X2NydGNfY29weV91YXBpX3RvX2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewogCWNydGNfc3RhdGUtPmh3LmVuYWJsZSA9IGNydGNfc3RhdGUtPnVhcGkuZW5h
YmxlOwogCWNydGNfc3RhdGUtPmh3LmFjdGl2ZSA9IGNydGNfc3RhdGUtPnVhcGkuYWN0aXZlOwot
CWNydGNfc3RhdGUtPmh3Lm1vZGUgPSBjcnRjX3N0YXRlLT51YXBpLm1vZGU7CiAJY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZSA9IGNydGNfc3RhdGUtPnVhcGkuYWRqdXN0ZWRfbW9kZTsKIAlp
bnRlbF9jcnRjX2NvcHlfdWFwaV90b19od19zdGF0ZV9ub21vZGVzZXQoY3J0Y19zdGF0ZSk7CiB9
CiAKLXN0YXRpYyB2b2lkIGludGVsX2NydGNfY29weV9od190b191YXBpX3N0YXRlKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQorc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19jb3B5
X2h3X3RvX3VhcGlfc3RhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJ
CQkJCSAgICAgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKnVzZXJfbW9kZSkKIHsKIAljcnRjX3N0
YXRlLT51YXBpLmVuYWJsZSA9IGNydGNfc3RhdGUtPmh3LmVuYWJsZTsKIAljcnRjX3N0YXRlLT51
YXBpLmFjdGl2ZSA9IGNydGNfc3RhdGUtPmh3LmFjdGl2ZTsKLQlXQVJOX09OKGRybV9hdG9taWNf
c2V0X21vZGVfZm9yX2NydGMoJmNydGNfc3RhdGUtPnVhcGksICZjcnRjX3N0YXRlLT5ody5tb2Rl
KSA8IDApOworCVdBUk5fT04oZHJtX2F0b21pY19zZXRfbW9kZV9mb3JfY3J0YygmY3J0Y19zdGF0
ZS0+dWFwaSwgdXNlcl9tb2RlKSA8IDApOwogCiAJY3J0Y19zdGF0ZS0+dWFwaS5hZGp1c3RlZF9t
b2RlID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIApAQCAtMTI3MDIsNiArMTI2OTks
MTAgQEAgaW50ZWxfY3J0Y19wcmVwYXJlX2NsZWFyZWRfc3RhdGUoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiAJbWVtY3B5KGNydGNfc3RhdGUsIHNhdmVkX3N0YXRlLCBzaXpl
b2YoKmNydGNfc3RhdGUpKTsKIAlrZnJlZShzYXZlZF9zdGF0ZSk7CiAKKwkvKiBDbGVhciBJOTE1
X01PREVfRkxBR19JTkhFUklURUQgKi8KKwljcnRjX3N0YXRlLT51YXBpLm1vZGUucHJpdmF0ZV9m
bGFncyA9IDA7CisJY3J0Y19zdGF0ZS0+dWFwaS5hZGp1c3RlZF9tb2RlLnByaXZhdGVfZmxhZ3Mg
PSAwOworCiAJaW50ZWxfY3J0Y19jb3B5X3VhcGlfdG9faHdfc3RhdGUoY3J0Y19zdGF0ZSk7CiAK
IAlyZXR1cm4gMDsKQEAgLTEyNzUwLDcgKzEyNzUxLDcgQEAgaW50ZWxfbW9kZXNldF9waXBlX2Nv
bmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJICogY29tcHV0YXRp
b24gdG8gY2xlYXJseSBkaXN0aW5ndWlzaCBpdCBmcm9tIHRoZSBhZGp1c3RlZCBtb2RlLCB3aGlj
aAogCSAqIGNhbiBiZSBjaGFuZ2VkIGJ5IHRoZSBjb25uZWN0b3JzIGluIHRoZSBiZWxvdyByZXRy
eSBsb29wLgogCSAqLwotCWRybV9tb2RlX2dldF9odl90aW1pbmcoJnBpcGVfY29uZmlnLT5ody5t
b2RlLAorCWRybV9tb2RlX2dldF9odl90aW1pbmcoJnBpcGVfY29uZmlnLT5ody5waXBlX21vZGUs
CiAJCQkgICAgICAgJnBpcGVfY29uZmlnLT5waXBlX3NyY193LAogCQkJICAgICAgICZwaXBlX2Nv
bmZpZy0+cGlwZV9zcmNfaCk7CiAKQEAgLTEyODUyLDYgKzEyODUzLDggQEAgaW50ZWxfbW9kZXNl
dF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJICov
CiAJcGlwZV9jb25maWctPnVhcGkuYWRqdXN0ZWRfbW9kZSA9IHBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlOwogCisJLyogd2l0aG91dCBiaWdqb2luZXIsIHBpcGVfbW9kZSA9PSBhZGp1c3Rl
ZF9tb2RlICovCisJcGlwZV9jb25maWctPmh3LnBpcGVfbW9kZSA9IHBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlOwogCXJldHVybiAwOwogfQogCkBAIC0xMjk5NSw4ICsxMjk5OCw4IEBAIGlu
dGVsX3BpcGVfY29uZmlnX2NvbXBhcmUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmN1
cnJlbnRfY29uZmlnLAogCWJvb2wgcmV0ID0gdHJ1ZTsKIAl1MzIgYnBfZ2FtbWEgPSAwOwogCWJv
b2wgZml4dXBfaW5oZXJpdGVkID0gZmFzdHNldCAmJgotCQkoY3VycmVudF9jb25maWctPmh3Lm1v
ZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkgJiYKLQkJIShwaXBl
X2NvbmZpZy0+aHcubW9kZS5wcml2YXRlX2ZsYWdzICYgSTkxNV9NT0RFX0ZMQUdfSU5IRVJJVEVE
KTsKKwkJKGN1cnJlbnRfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLnByaXZhdGVfZmxhZ3MgJiBJ
OTE1X01PREVfRkxBR19JTkhFUklURUQpICYmCisJCSEocGlwZV9jb25maWctPmh3LmFkanVzdGVk
X21vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCk7CiAKIAlpZiAo
Zml4dXBfaW5oZXJpdGVkICYmICFmYXN0Ym9vdF9lbmFibGVkKGRldl9wcml2KSkgewogCQlEUk1f
REVCVUdfS01TKCJpbml0aWFsIG1vZGVzZXQgYW5kIGZhc3Rib290IG5vdCBzZXRcbiIpOwpAQCAt
MTQxMDYsOCArMTQxMDksOCBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jaGVjayhzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogCS8qIENhdGNoIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCAqLwog
CWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0
Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0YXRlLCBpKSB7Ci0JCWlmIChuZXdfY3J0Y19z
dGF0ZS0+aHcubW9kZS5wcml2YXRlX2ZsYWdzICE9Ci0JCSAgICBvbGRfY3J0Y19zdGF0ZS0+aHcu
bW9kZS5wcml2YXRlX2ZsYWdzKQorCQlpZiAobmV3X2NydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGUucHJpdmF0ZV9mbGFncyAhPQorCQkgICAgb2xkX2NydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGUucHJpdmF0ZV9mbGFncykKIAkJCW5ld19jcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZCA9
IHRydWU7CiAJfQogCkBAIC0xNDM2MSw3ICsxNDM2NCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Vw
ZGF0ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCSAqIG9mIGVuYWJsaW5nIHRoZW0g
b24gdGhlIENSVEMncyBmaXJzdCBmYXN0c2V0LgogCSAqLwogCWlmIChuZXdfY3J0Y19zdGF0ZS0+
dXBkYXRlX3BpcGUgJiYgIW1vZGVzZXQgJiYKLQkgICAgb2xkX2NydGNfc3RhdGUtPmh3Lm1vZGUu
cHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkKKwkgICAgb2xkX2NydGNf
c3RhdGUtPmh3LmFkanVzdGVkX21vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lO
SEVSSVRFRCkKIAkJaW50ZWxfY3J0Y19hcm1fZmlmb191bmRlcnJ1bihjcnRjLCBuZXdfY3J0Y19z
dGF0ZSk7CiB9CiAKQEAgLTE0NTU4LDcgKzE0NTYxLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9z
dF9jcnRjX2VuYWJsZV91cGRhdGVzKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCSAqIG9mIGVu
YWJsaW5nIHRoZW0gb24gdGhlIENSVEMncyBmaXJzdCBmYXN0c2V0LgogCSAqLwogCWlmIChuZXdf
Y3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgJiYgIW1vZGVzZXQgJiYKLQkgICAgb2xkX2NydGNfc3Rh
dGUtPmh3Lm1vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVfTU9ERV9GTEFHX0lOSEVSSVRFRCkKKwkg
ICAgb2xkX2NydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUucHJpdmF0ZV9mbGFncyAmIEk5MTVf
TU9ERV9GTEFHX0lOSEVSSVRFRCkKIAkJaW50ZWxfY3J0Y19hcm1fZmlmb191bmRlcnJ1bihjcnRj
LCBuZXdfY3J0Y19zdGF0ZSk7CiB9CiAKQEAgLTE3NTI0LDE1ICsxNzUyNywxMSBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9tb2Rlc2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRl
dikKIAkJaW50IG1pbl9jZGNsayA9IDA7CiAKIAkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkg
ewotCQkJc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPSAmY3J0Y19zdGF0ZS0+aHcubW9k
ZTsKKwkJCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlIG1vZGU7CiAKIAkJCWludGVsX21vZGVfZnJv
bV9waXBlX2NvbmZpZygmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSwKIAkJCQkJCSAgICBj
cnRjX3N0YXRlKTsKIAotCQkJKm1vZGUgPSBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwot
CQkJbW9kZS0+aGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY193OwotCQkJbW9kZS0+dmRp
c3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY19oOwotCiAJCQkvKgogCQkJICogVGhlIGluaXRp
YWwgbW9kZSBuZWVkcyB0byBiZSBzZXQgaW4gb3JkZXIgdG8ga2VlcAogCQkJICogdGhlIGF0b21p
YyBjb3JlIGhhcHB5LiBJdCB3YW50cyBhIHZhbGlkIG1vZGUgaWYgdGhlCkBAIC0xNzU0MiwxMyAr
MTc1NDEsMTcgQEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCQkgKiBzZXQgYSBmbGFnIHRvIGluZGljYXRlIHRoYXQg
YSBmdWxsIHJlY2FsY3VsYXRpb24gaXMKIAkJCSAqIG5lZWRlZCBvbiB0aGUgbmV4dCBjb21taXQu
CiAJCQkgKi8KLQkJCW1vZGUtPnByaXZhdGVfZmxhZ3MgPSBJOTE1X01PREVfRkxBR19JTkhFUklU
RUQ7CisJCQljcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLnByaXZhdGVfZmxhZ3MgPSBJOTE1
X01PREVfRkxBR19JTkhFUklURUQ7CisKKwkJCW1vZGUgPSBjcnRjX3N0YXRlLT5ody5hZGp1c3Rl
ZF9tb2RlOworCQkJbW9kZS5oZGlzcGxheSA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX3c7CisJCQlt
b2RlLnZkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaDsKIAogCQkJaW50ZWxfY3J0Y19j
b21wdXRlX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSk7CiAKIAkJCWludGVsX2NydGNfdXBkYXRlX2Fj
dGl2ZV90aW1pbmdzKGNydGNfc3RhdGUpOwogCi0JCQlpbnRlbF9jcnRjX2NvcHlfaHdfdG9fdWFw
aV9zdGF0ZShjcnRjX3N0YXRlKTsKKwkJCWludGVsX2NydGNfY29weV9od190b191YXBpX3N0YXRl
KGNydGNfc3RhdGUsICZtb2RlKTsKIAkJfQogCiAJCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2Ny
dGMoJmRldl9wcml2LT5kcm0sIGNydGMsIHBsYW5lKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IDgzZWEwNDE0OWI3Ny4u
MGYyMGM3MTkwZWVkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfdHlwZXMuaApAQCAtODAyLDcgKzgwMiw3IEBAIHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlIHsKIAlzdHJ1Y3QgewogCQlib29sIGFjdGl2ZSwgZW5hYmxlOwogCQlzdHJ1Y3QgZHJt
X3Byb3BlcnR5X2Jsb2IgKmRlZ2FtbWFfbHV0LCAqZ2FtbWFfbHV0LCAqY3RtOwotCQlzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSBtb2RlLCBhZGp1c3RlZF9tb2RlOworCQlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSBhZGp1c3RlZF9tb2RlOwogCX0gaHc7CiAKIAkvKioKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHZvLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2R2by5jCmluZGV4IGE3NGRjNWI5MTVkMS4uYWQ4ZTk5NTlkNmUxIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2R2by5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHZvLmMKQEAgLTIwNyw3ICsyMDcs
NyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9lbmFibGVfZHZvKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAogCXUzMiB0ZW1wID0gSTkxNV9SRUFEKGR2b19yZWcpOwogCiAJaW50ZWxfZHZvLT5k
ZXYuZGV2X29wcy0+bW9kZV9zZXQoJmludGVsX2R2by0+ZGV2LAotCQkJCQkgJnBpcGVfY29uZmln
LT5ody5tb2RlLAorCQkJCQkgJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLAogCQkJCQkg
JnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlKTsKIAogCUk5MTVfV1JJVEUoZHZvX3JlZywg
dGVtcCB8IERWT19FTkFCTEUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9zZHZvLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nk
dm8uYwppbmRleCBhNGIxMzM5ZmNjMDAuLjRiYTc2NDhhMzE0NSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMKQEAgLTEyMTMsNyArMTIxMyw2IEBAIGludGVsX3Nk
dm9fc2V0X291dHB1dF90aW1pbmdzX2Zyb21fbW9kZShzdHJ1Y3QgaW50ZWxfc2R2byAqaW50ZWxf
c2R2bywKIHN0YXRpYyBib29sCiBpbnRlbF9zZHZvX2dldF9wcmVmZXJyZWRfaW5wdXRfbW9kZShz
dHJ1Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2bywKIAkJCQkgICAgc3RydWN0IGludGVsX3Nkdm9f
Y29ubmVjdG9yICppbnRlbF9zZHZvX2Nvbm5lY3RvciwKLQkJCQkgICAgY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKm1vZGUsCiAJCQkJICAgIHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlKQogewogCXN0cnVjdCBpbnRlbF9zZHZvX2R0ZCBpbnB1dF9kdGQ7CkBAIC0x
MjI0LDkgKzEyMjMsOSBAQCBpbnRlbF9zZHZvX2dldF9wcmVmZXJyZWRfaW5wdXRfbW9kZShzdHJ1
Y3QgaW50ZWxfc2R2byAqaW50ZWxfc2R2bywKIAogCWlmICghaW50ZWxfc2R2b19jcmVhdGVfcHJl
ZmVycmVkX2lucHV0X3RpbWluZyhpbnRlbF9zZHZvLAogCQkJCQkJICAgICAgaW50ZWxfc2R2b19j
b25uZWN0b3IsCi0JCQkJCQkgICAgICBtb2RlLT5jbG9jayAvIDEwLAotCQkJCQkJICAgICAgbW9k
ZS0+aGRpc3BsYXksCi0JCQkJCQkgICAgICBtb2RlLT52ZGlzcGxheSkpCisJCQkJCQkgICAgICBh
ZGp1c3RlZF9tb2RlLT5jbG9jayAvIDEwLAorCQkJCQkJICAgICAgYWRqdXN0ZWRfbW9kZS0+aGRp
c3BsYXksCisJCQkJCQkgICAgICBhZGp1c3RlZF9tb2RlLT52ZGlzcGxheSkpCiAJCXJldHVybiBm
YWxzZTsKIAogCWlmICghaW50ZWxfc2R2b19nZXRfcHJlZmVycmVkX2lucHV0X3RpbWluZyhpbnRl
bF9zZHZvLApAQCAtMTI3Nyw3ICsxMjc2LDYgQEAgc3RhdGljIGludCBpbnRlbF9zZHZvX2NvbXB1
dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBpbnRlbF9z
ZHZvX2Nvbm5lY3RvciAqaW50ZWxfc2R2b19jb25uZWN0b3IgPQogCQl0b19pbnRlbF9zZHZvX2Nv
bm5lY3Rvcihjb25uX3N0YXRlLT5jb25uZWN0b3IpOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2Rl
ICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOwotCXN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlICptb2RlID0gJnBpcGVfY29uZmlnLT5ody5tb2RlOwogCiAJRFJN
X0RFQlVHX0tNUygiZm9yY2luZyBicGMgdG8gOCBmb3IgU0RWT1xuIik7CiAJcGlwZV9jb25maWct
PnBpcGVfYnBwID0gOCozOwpAQCAtMTI5MywxMiArMTI5MSwxMiBAQCBzdGF0aWMgaW50IGludGVs
X3Nkdm9fY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICog
dGhlIHNlcXVlbmNlIHRvIGRvIGl0LiBPaCB3ZWxsLgogCSAqLwogCWlmIChJU19UVihpbnRlbF9z
ZHZvX2Nvbm5lY3RvcikpIHsKLQkJaWYgKCFpbnRlbF9zZHZvX3NldF9vdXRwdXRfdGltaW5nc19m
cm9tX21vZGUoaW50ZWxfc2R2bywgbW9kZSkpCisJCWlmICghaW50ZWxfc2R2b19zZXRfb3V0cHV0
X3RpbWluZ3NfZnJvbV9tb2RlKGludGVsX3Nkdm8sCisJCQkJCQkJICAgICBhZGp1c3RlZF9tb2Rl
KSkKIAkJCXJldHVybiAtRUlOVkFMOwogCiAJCSh2b2lkKSBpbnRlbF9zZHZvX2dldF9wcmVmZXJy
ZWRfaW5wdXRfbW9kZShpbnRlbF9zZHZvLAogCQkJCQkJCSAgIGludGVsX3Nkdm9fY29ubmVjdG9y
LAotCQkJCQkJCSAgIG1vZGUsCiAJCQkJCQkJICAgYWRqdXN0ZWRfbW9kZSk7CiAJCXBpcGVfY29u
ZmlnLT5zZHZvX3R2X2Nsb2NrID0gdHJ1ZTsKIAl9IGVsc2UgaWYgKElTX0xWRFMoaW50ZWxfc2R2
b19jb25uZWN0b3IpKSB7CkBAIC0xMzA4LDcgKzEzMDYsNiBAQCBzdGF0aWMgaW50IGludGVsX3Nk
dm9fY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAkJKHZv
aWQpIGludGVsX3Nkdm9fZ2V0X3ByZWZlcnJlZF9pbnB1dF9tb2RlKGludGVsX3Nkdm8sCiAJCQkJ
CQkJICAgaW50ZWxfc2R2b19jb25uZWN0b3IsCi0JCQkJCQkJICAgbW9kZSwKIAkJCQkJCQkgICBh
ZGp1c3RlZF9tb2RlKTsKIAl9CiAKQEAgLTE0MzUsNyArMTQzMiw2IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3Nkdm9fcHJlX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlciwK
IAkJdG9faW50ZWxfc2R2b19jb25uZWN0b3Jfc3RhdGUoY29ubl9zdGF0ZSk7CiAJY29uc3Qgc3Ry
dWN0IGludGVsX3Nkdm9fY29ubmVjdG9yICppbnRlbF9zZHZvX2Nvbm5lY3RvciA9CiAJCXRvX2lu
dGVsX3Nkdm9fY29ubmVjdG9yKGNvbm5fc3RhdGUtPmNvbm5lY3Rvcik7Ci0JY29uc3Qgc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKm1vZGUgPSAmY3J0Y19zdGF0ZS0+aHcubW9kZTsKIAlzdHJ1Y3Qg
aW50ZWxfc2R2byAqaW50ZWxfc2R2byA9IHRvX3Nkdm8oaW50ZWxfZW5jb2Rlcik7CiAJdTMyIHNk
dm94OwogCXN0cnVjdCBpbnRlbF9zZHZvX2luX291dF9tYXAgaW5fb3V0OwpAQCAtMTQ2OCw3ICsx
NDY0LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2R2b19wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICppbnRlbF9lbmNvZGVyLAogCQlpbnRlbF9zZHZvX2dldF9kdGRfZnJvbV9tb2RlKCZv
dXRwdXRfZHRkLAogCQkJCQkgICAgIGludGVsX3Nkdm9fY29ubmVjdG9yLT5iYXNlLnBhbmVsLmZp
eGVkX21vZGUpOwogCWVsc2UKLQkJaW50ZWxfc2R2b19nZXRfZHRkX2Zyb21fbW9kZSgmb3V0cHV0
X2R0ZCwgbW9kZSk7CisJCWludGVsX3Nkdm9fZ2V0X2R0ZF9mcm9tX21vZGUoJm91dHB1dF9kdGQs
IGFkanVzdGVkX21vZGUpOwogCWlmICghaW50ZWxfc2R2b19zZXRfb3V0cHV0X3RpbWluZyhpbnRl
bF9zZHZvLCAmb3V0cHV0X2R0ZCkpCiAJCURSTV9JTkZPKCJTZXR0aW5nIG91dHB1dCB0aW1pbmdz
IG9uICVzIGZhaWxlZFxuIiwKIAkJCSBTRFZPX05BTUUoaW50ZWxfc2R2bykpOwotLSAKMi4yNC4w
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1n
ZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

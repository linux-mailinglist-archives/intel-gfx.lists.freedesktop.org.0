Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E54FDA3ADD
	for <lists+intel-gfx@lfdr.de>; Fri, 30 Aug 2019 17:48:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BAB606E107;
	Fri, 30 Aug 2019 15:48:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7901E6E107
 for <intel-gfx@lists.freedesktop.org>; Fri, 30 Aug 2019 15:48:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 18320135-1500050 for multiple; Fri, 30 Aug 2019 16:48:11 +0100
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Lionel Landwerlin <lionel.g.landwerlin@intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20190830144726.18291-1-lionel.g.landwerlin@intel.com>
 <20190830144726.18291-9-lionel.g.landwerlin@intel.com>
In-Reply-To: <20190830144726.18291-9-lionel.g.landwerlin@intel.com>
Message-ID: <156718008861.29078.13732818096753164115@skylake-alporthouse-com>
Date: Fri, 30 Aug 2019 16:48:08 +0100
Subject: Re: [Intel-gfx] [PATCH v12 08/11] drm/i915/perf: execute OA
 configuration from command stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBMaW9uZWwgTGFuZHdlcmxpbiAoMjAxOS0wOC0zMCAxNTo0NzoyMykKPiAgZXJyX3Vu
cGluOgo+IC0gICAgICAgX19pOTE1X3ZtYV91bnBpbih2bWEpOwo+ICsgICAgICAgbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Cj4gKyAgICAgICBpOTE1X3ZtYV91bnBpbl9hbmRf
cmVsZWFzZSgmdm1hLCAwKTsKPiArICAgICAgIG11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CgpTdHJhbmdlbHkgdW5waW5fYW5kX3JlbGVhc2UoKSBkb2Vzbid0IG5lZWQgdGhl
IG11dGV4LiBCdXQgSSBjYW4gY2xlYW4KdGhhdCB1cCBsYXRlci4KCj4gIAo+ICBlcnJfdW5yZWY6
Cj4gICAgICAgICBpOTE1X2dlbV9vYmplY3RfcHV0KGJvKTsKPiBAQCAtMTk0Nyw1MCArMTk2MSw2
OSBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0pCj4gICAgICAgICByZXR1cm4gcmV0Owo+ICB9Cj4gIAo+IC1zdGF0aWMgdm9pZCBjb25m
aWdfb2FfcmVncyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCj4gLSAgICAgICAg
ICAgICAgICAgICAgICAgICAgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdzLAo+IC0gICAg
ICAgICAgICAgICAgICAgICAgICAgIHUzMiBuX3JlZ3MpCj4gK3N0YXRpYyBpbnQgZW1pdF9vYV9j
b25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCj4gKyAgICAgICAgICAgICAgICAg
ICAgICAgICBzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQo+ICB7Cj4gLSAgICAgICB1
MzIgaTsKPiArICAgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwo+ICsgICAgICAgc3RydWN0
IGk5MTVfdm1hICp2bWE7Cj4gKyAgICAgICB1MzIgKmNzOwo+ICsgICAgICAgaW50IGVycjsKPiAg
Cj4gLSAgICAgICBmb3IgKGkgPSAwOyBpIDwgbl9yZWdzOyBpKyspIHsKPiAtICAgICAgICAgICAg
ICAgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWcgPSByZWdzICsgaTsKPiArICAgICAgIGxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKPiAgCj4gLSAgICAgICAg
ICAgICAgIEk5MTVfV1JJVEUocmVnLT5hZGRyLCByZWctPnZhbHVlKTsKPiArICAgICAgIHJxID0g
aTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJlYW0tPmVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwo+ICsg
ICAgICAgaWYgKElTX0VSUihycSkpCj4gKyAgICAgICAgICAgICAgIHJldHVybiBQVFJfRVJSKHJx
KTsKPiArCj4gKyAgICAgICBlcnIgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmc3RyZWFtLT5h
Y3RpdmVfY29uZmlnX3JxLAo+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
cnEpOwo+ICsgICAgICAgaWYgKGVycikKPiArICAgICAgICAgICAgICAgZ290byBlcnJfYWRkX3Jl
cXVlc3Q7Cj4gKwo+ICsgICAgICAgdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uoc3RyZWFtLT5pbml0
aWFsX29hX2NvbmZpZ19ibywKPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZpOTE1
LT5nZ3R0LnZtLCBOVUxMKTsKClNhZmVyIHdpdGggc3RyZWFtLT5lbmdpbmUtPmd0LT5nZ3R0LnZt
Cgo+ICsgICAgICAgaWYgKHVubGlrZWx5KElTX0VSUih2bWEpKSkgewo+ICsgICAgICAgICAgICAg
ICBlcnIgPSBQVFJfRVJSKHZtYSk7Cj4gKyAgICAgICAgICAgICAgIGdvdG8gZXJyX2FkZF9yZXF1
ZXN0Owo+ICAgICAgICAgfQo+IC19Cj4gIAo+IC1zdGF0aWMgdm9pZCBkZWxheV9hZnRlcl9tdXgo
dm9pZCkKPiAtewo+IC0gICAgICAgLyoKPiAtICAgICAgICAqIEl0IGFwcGFyZW50bHkgdGFrZXMg
YSBmYWlybHkgbG9uZyB0aW1lIGZvciBhIG5ldyBNVVgKPiAtICAgICAgICAqIGNvbmZpZ3VyYXRp
b24gdG8gYmUgYmUgYXBwbGllZCBhZnRlciB0aGVzZSByZWdpc3RlciB3cml0ZXMuCj4gLSAgICAg
ICAgKiBUaGlzIGRlbGF5IGR1cmF0aW9uIHdhcyBkZXJpdmVkIGVtcGlyaWNhbGx5IGJhc2VkIG9u
IHRoZQo+IC0gICAgICAgICogcmVuZGVyX2Jhc2ljIGNvbmZpZyBidXQgaG9wZWZ1bGx5IGl0IGNv
dmVycyB0aGUgbWF4aW11bQo+IC0gICAgICAgICogY29uZmlndXJhdGlvbiBsYXRlbmN5Lgo+IC0g
ICAgICAgICoKPiAtICAgICAgICAqIEFzIGEgZmFsbGJhY2ssIHRoZSBjaGVja3MgaW4gX2FwcGVu
ZF9vYV9yZXBvcnRzKCkgdG8gc2tpcAo+IC0gICAgICAgICogaW52YWxpZCBPQSByZXBvcnRzIGRv
IGFsc28gc2VlbSB0byB3b3JrIHRvIGRpc2NhcmQgcmVwb3J0cwo+IC0gICAgICAgICogZ2VuZXJh
dGVkIGJlZm9yZSB0aGlzIGNvbmZpZyBoYXMgY29tcGxldGVkIC0gYWxiZWl0IG5vdAo+IC0gICAg
ICAgICogc2lsZW50bHkuCj4gLSAgICAgICAgKgo+IC0gICAgICAgICogVW5mb3J0dW5hdGVseSB0
aGlzIGlzIGVzc2VudGlhbGx5IGEgbWFnaWMgbnVtYmVyLCBzaW5jZSB3ZQo+IC0gICAgICAgICog
ZG9uJ3QgY3VycmVudGx5IGtub3cgb2YgYSByZWxpYWJsZSBtZWNoYW5pc20gZm9yIHByZWRpY3Rp
bmcKPiAtICAgICAgICAqIGhvdyBsb25nIHRoZSBNVVggY29uZmlnIHdpbGwgdGFrZSB0byBhcHBs
eSBhbmQgYmVzaWRlcwo+IC0gICAgICAgICogc2VlaW5nIGludmFsaWQgcmVwb3J0cyB3ZSBkb24n
dCBrbm93IG9mIGEgcmVsaWFibGUgd2F5IHRvCj4gLSAgICAgICAgKiBleHBsaWNpdGx5IGNoZWNr
IHRoYXQgdGhlIE1VWCBjb25maWcgaGFzIGxhbmRlZC4KPiAtICAgICAgICAqCj4gLSAgICAgICAg
KiBJdCdzIGV2ZW4gcG9zc2libGUgd2UndmUgbWlzcyBjaGFyYWN0ZXJpemVkIHRoZSB1bmRlcmx5
aW5nCj4gLSAgICAgICAgKiBwcm9ibGVtIC0gaXQganVzdCBzZWVtcyBsaWtlIHRoZSBzaW1wbGVz
dCBleHBsYW5hdGlvbiB3aHkKPiAtICAgICAgICAqIGEgZGVsYXkgYXQgdGhpcyBsb2NhdGlvbiB3
b3VsZCBtaXRpZ2F0ZSBhbnkgaW52YWxpZCByZXBvcnRzLgo+IC0gICAgICAgICovCj4gLSAgICAg
ICB1c2xlZXBfcmFuZ2UoMTUwMDAsIDIwMDAwKTsKPiArICAgICAgIGVyciA9IGk5MTVfdm1hX3Bp
bih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOwo+ICsgICAgICAgaWYgKGVycikKPiArICAgICAgICAg
ICAgICAgZ290byBlcnJfYWRkX3JlcXVlc3Q7CgpEb24ndCBwaW4gaW5zaWRlIGEgcmVxdWVzdC4g
ZG8gdGhlIHBpbmluZyBiZWZvcmUgaTkxNV9yZXF1ZXN0X2NyZWF0ZSgpLgpPbmUgZGF5LCB3ZSBt
YXkgbmVlZCB0byBhbGxvY2F0ZSBhIHJlcXVlc3QgdG8gZG8gdGhlIHBpbi4KCkJlIHNhZmUsCgpp
OTE1X3ZtYV9sb2NrKHZtYSk7CmVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZt
YS0+b2JqLCAwKTsKKHllcywgd2UgbmVlZCBhIGJldHRlciB3cmFwcGVyIGhlcmUpCmlmIChlcnIp
Cj4gKyAgICAgICBlcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCAwKTsKaTkx
NV92bWFfdW5sb2NrKHZtYSk7Cj4gKyAgICAgICBpZiAoZXJyKQo+ICsgICAgICAgICAgICAgICBn
b3RvIGVycl92bWFfdW5waW47Cj4gKwoKCj4gQEAgLTI2NTgsMTYgKzI2ODQsMzEgQEAgc3RhdGlj
IGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0s
Cj4gICAgICAgICBzdHJlYW0tPm9wcyA9ICZpOTE1X29hX3N0cmVhbV9vcHM7Cj4gICAgICAgICBk
ZXZfcHJpdi0+cGVyZi5leGNsdXNpdmVfc3RyZWFtID0gc3RyZWFtOwo+ICAKPiArICAgICAgIG11
dGV4X2xvY2soJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKPiAgICAgICAgIHJldCA9IGRldl9wcml2
LT5wZXJmLm9wcy5lbmFibGVfbWV0cmljX3NldChzdHJlYW0pOwo+ICAgICAgICAgaWYgKHJldCkg
ewo+ICAgICAgICAgICAgICAgICBEUk1fREVCVUcoIlVuYWJsZSB0byBlbmFibGUgbWV0cmljIHNl
dFxuIik7Cj4gLSAgICAgICAgICAgICAgIGdvdG8gZXJyX2VuYWJsZTsKPiArICAgICAgICAgICAg
ICAgLyoKPiArICAgICAgICAgICAgICAgICogSWdub3JlIHRoZSByZXR1cm4gdmFsdWUgc2luY2Ug
d2UgYWxyZWFkeSBoYXZlIGFuIGVycm9yIGZyb20KPiArICAgICAgICAgICAgICAgICogdGhlIGVu
YWJsZSB2ZnVuYy4KPiArICAgICAgICAgICAgICAgICovCj4gKyAgICAgICAgICAgICAgIGk5MTVf
YWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZzdHJlYW0tPmFjdGl2ZV9jb25maWdfcnEsCj4gKyAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICZzdHJlYW0tPmNvbmZpZ19tdXRl
eCk7Cj4gKyAgICAgICB9IGVsc2Ugewo+ICsgICAgICAgICAgICAgICByZXQgPSBpOTE1X2FjdGl2
ZV9yZXF1ZXN0X3JldGlyZSgmc3RyZWFtLT5hY3RpdmVfY29uZmlnX3JxLAo+ICsgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmc3RyZWFtLT5jb25maWdfbXV0
ZXgpOwoKVGhpcyBmdW5jdGlvbiBkb2Vzbid0IGV4aXN0IGFueW1vcmUuIEl0J3MgYmFzaWNhbGx5
IGp1c3Qgd2FpdGluZyBmb3IgdGhlCm9sZCByZXF1ZXN0LiBXaHkgZG8geW91IG5lZWQgaXQ/IChZ
b3VyIHJlcXVlc3QgZmxvdyBpcyBvdGhlcndpc2Ugb3JkZXJlZC4pCgo+IC0gICAgICAgRFJNX0RF
QlVHKCJvcGVuaW5nIHN0cmVhbSBvYSBjb25maWcgdXVpZD0lc1xuIiwgc3RyZWFtLT5vYV9jb25m
aWctPnV1aWQpOwo+IC0KPiArICAgICAgIG11dGV4X3VubG9jaygmc3RyZWFtLT5jb25maWdfbXV0
ZXgpOwo+ICAgICAgICAgbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
Cj4gIAo+ICsgICAgICAgaTkxNV9nZW1fb2JqZWN0X3B1dChzdHJlYW0tPmluaXRpYWxfb2FfY29u
ZmlnX2JvKTsKPiArICAgICAgIHN0cmVhbS0+aW5pdGlhbF9vYV9jb25maWdfYm8gPSBOVUxMOwo+
ICsgICAgICAgaWYgKHJldCkKPiArICAgICAgICAgICAgICAgZ290byBlcnJfZW5hYmxlOwoKSXMg
aXQgYmVjYXVzZSBvZiB0aGlzIGVyciB0aGF0IG1heSBlbmQgdXAgZnJlZWluZyB0aGUgc3RyZWFt
PyBJIHdvdWxkCmV4cGVjdCBhIHNpbWlsYXIgd2FpdC1iZWZvcmUtZnJlZSBvbiBzdHJlYW0gZGVz
dHJveS4gSW4gd2hpY2ggY2FzZSBJCndvdWxkIGhhdmUgdGhlIGFjdGl2ZSByZXF1ZXN0IGhvbGQg
YSByZWZlcmVuY2Ugb24gdGhlIHN0cmVhbS4gKEFuZCB5b3UKbWlnaHQgZmluZCBpdCBtb3JlIGNv
bnZlbmllbnQgdG8gdXNlIGk5MTVfYWN0aXZlIHJhdGhlciB0aGFuIHRoZSByYXcKaTkxNV9hY3Rp
dmVfcmVxdWVzdC4gaTkxNV9hY3RpdmUgaXMgZ2VhcmVkIHRvIHRyYWNraW5nIG11bHRpcGxlCnRp
bWVsaW5lcywgc28gZGVmaW5pdGVseSBvdmVya2lsbCBmb3IgeW91IHVzZSBjYXNlLCBqdXN0IGhh
cyBtb3JlCnV0aWxpdHkvbWlkLWxheWVyISBidWlsdCBpbikKLUNocmlzCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

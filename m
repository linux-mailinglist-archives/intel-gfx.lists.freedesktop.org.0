Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 32FDE10A422
	for <lists+intel-gfx@lfdr.de>; Tue, 26 Nov 2019 19:43:59 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8A17A6E478;
	Tue, 26 Nov 2019 18:43:57 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 25BA76E478
 for <intel-gfx@lists.freedesktop.org>; Tue, 26 Nov 2019 18:43:55 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19348834-1500050 
 for multiple; Tue, 26 Nov 2019 18:43:47 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 26 Nov 2019 18:43:41 +0000
Message-Id: <20191126184341.2959765-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Serialise i915_active_fence_set()
 with itself
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGV4cGVjdGVkIGRvd25zaWRlIHRvIGNvbW1pdCA1OGI0YzFhMDdhZGEgKCJkcm0vaTkxNTog
UmVkdWNlIG5lc3RlZApwcmVwYXJlX3JlbW90ZV9jb250ZXh0KCkgdG8gYSB0cnlsb2NrIikgd2Fz
IHRoYXQgaXQgd291bGQgbmVlZCB0byByZXR1cm4KLUVBR0FJTiB0byB1c2Vyc3BhY2UgaW4gb3Jk
ZXIgdG8gcmVzb2x2ZSBwb3RlbnRpYWwgbXV0ZXggaW52ZXJzaW9uLiBTdWNoCmFuIHVuc2lnaHRs
eSByb3VuZCB0cmlwIGlzIHVubmVjZXNzYXJ5IGlmIHdlIGNvdWxkIGF0b21pY2FsbHkgaW5zZXJ0
IGEKYmFycmllciBpbnRvIHRoZSBpOTE1X2FjdGl2ZV9mZW5jZSwgc28gbWFrZSBpdCBoYXBwZW4u
CgpDdXJyZW50bHksIHdlIHVzZSB0aGUgdGltZWxpbmUtPm11dGV4IChvciBzb21lIG90aGVyIG5h
bWVkIG91dGVyIGxvY2spCnRvIG9yZGVyIGluc2VydGlvbiBpbnRvIHRoZSBpOTE1X2FjdGl2ZV9m
ZW5jZSAoYW5kIHNvIGluZGl2aWR1YWwgbm9kZXMKb2YgaTkxNV9hY3RpdmUpLiBJbnNpZGUgX19p
OTE1X2FjdGl2ZV9mZW5jZV9zZXQsIHdlIG9ubHkgbmVlZCB0aGVuCnNlcmlhbGlzZSB3aXRoIHRo
ZSBpbnRlcnJ1cHQgaGFuZGxlciBpbiBvcmRlciB0byBjbGFpbSB0aGUgdGltZWxpbmUgZm9yCm91
cnNlbHZlcy4KCkhvd2V2ZXIsIGlmIHdlIHJlbW92ZSB0aGUgb3V0ZXIgbG9jaywgd2UgbmVlZCB0
byBlbnN1cmUgdGhlIG9yZGVyIGlzCmludGFjdCBiZXR3ZWVuIG5vdCBvbmx5IG11bHRpcGxlIHRo
cmVhZHMgdHJ5aW5nIHRvIGluc2VydCB0aGVtc2VsdmVzCmludG8gdGhlIHRpbWVsaW5lLCBidXQg
YWxzbyB3aXRoIHRoZSBpbnRlcnJ1cHQgaGFuZGxlciBjb21wbGV0aW5nIHRoZQpwcmV2aW91cyBv
Y2N1cGFudC4gV2UgdXNlIHhjaGcoKSBvbiBpbnNlcnQgc28gdGhhdCB3ZSBoYXZlIGFuIG9yZGVy
ZWQKc2VxdWVuY2Ugb2YgaW5zZXJ0aW9ucyAoYW5kIGVhY2ggY2FsbGVyIGtub3dzIHRoZSBwcmV2
aW91cyBmZW5jZSBvbgp3aGljaCB0byB3YWl0LCBwcmVzZXJ2aW5nIHRoZSBjaGFpbiBvZiBhbGwg
ZmVuY2VzIGluIHRoZSB0aW1lbGluZSksIGJ1dAp3ZSB0aGVuIGhhdmUgdG8gY21weGNoZygpIGlu
IHRoZSBpbnRlcnJ1cHQgaGFuZGxlciB0byBhdm9pZCBvdmVyd3JpdGluZwp0aGUgbmV3IG9jY3Vw
YW50LiBUaGUgb25seSBuYXN0eSBzaWRlLWVmZmVjdCBpcyBoYXZpbmcgdG8gdGVtcG9yYXJpbHkK
c3RyaXAgb2ZmIHRoZSBSQ1UtYW5ub3RhdGlvbnMgdG8gYXBwbHkgdGhlIGF0b21pYyBvcGVyYXRp
b25zLCBvdGhlcndpc2UKdGhlIHJ1bGVzIGFyZSBtdWNoIG1vcmUgY29udmVudGlvbmFsIQoKRml4
ZXM6IDU4YjRjMWEwN2FkYSAoImRybS9pOTE1OiBSZWR1Y2UgbmVzdGVkIHByZXBhcmVfcmVtb3Rl
X2NvbnRleHQoKSB0byBhIHRyeWxvY2siKQpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNo
cmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxp
bkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5j
ICAgICAgIHwgMTkgLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5l
LmMgICAgICB8ICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVs
aW5lLmMgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyAgICAgICAg
ICAgIHwgNzEgKysrKysrKystLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuaCAgICAgICAgICAgIHwgMjUgKysrKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9hY3RpdmVfdHlwZXMuaCAgICAgIHwgMTUgLS0tLQogNiBmaWxlcyBjaGFuZ2VkLCA0OCBpbnNl
cnRpb25zKCspLCA4NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9j
b250ZXh0LmMKaW5kZXggZWY3YmM0MWZmZmZhLi5iNWU5YzM1ZWM2YjggMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTMxMCwyNyArMzEwLDggQEAgaW50IGludGVs
X2NvbnRleHRfcHJlcGFyZV9yZW1vdGVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Us
CiAJR0VNX0JVR19PTihycS0+aHdfY29udGV4dCA9PSBjZSk7CiAKIAlpZiAocmN1X2FjY2Vzc19w
b2ludGVyKHJxLT50aW1lbGluZSkgIT0gdGwpIHsgLyogdGltZWxpbmUgc2hhcmluZyEgKi8KLQkJ
LyoKLQkJICogSWRlYWxseSwgd2UganVzdCB3YW50IHRvIGluc2VydCBvdXIgZm9yZWlnbiBmZW5j
ZSBhcwotCQkgKiBhIGJhcnJpZXIgaW50byB0aGUgcmVtb3ZlIGNvbnRleHQsIHN1Y2ggdGhhdCB0
aGlzIG9wZXJhdGlvbgotCQkgKiBvY2N1cnMgYWZ0ZXIgYWxsIGN1cnJlbnQgb3BlcmF0aW9ucyBp
biB0aGF0IGNvbnRleHQsIGFuZAotCQkgKiBhbGwgZnV0dXJlIG9wZXJhdGlvbnMgbXVzdCBvY2N1
ciBhZnRlciB0aGlzLgotCQkgKgotCQkgKiBDdXJyZW50bHksIHRoZSB0aW1lbGluZS0+bGFzdF9y
ZXF1ZXN0IHRyYWNraW5nIGlzIGd1YXJkZWQKLQkJICogYnkgaXRzIG11dGV4IGFuZCBzbyB3ZSBt
dXN0IG9idGFpbiB0aGF0IHRvIGF0b21pY2FsbHkKLQkJICogaW5zZXJ0IG91ciBiYXJyaWVyLiBI
b3dldmVyLCBzaW5jZSB3ZSBhbHJlYWR5IGhvbGQgb3VyCi0JCSAqIHRpbWVsaW5lLT5tdXRleCwg
d2UgbXVzdCBiZSBjYXJlZnVsIGFnYWluc3QgcG90ZW50aWFsCi0JCSAqIGludmVyc2lvbiBpZiB3
ZSBhcmUgdGhlIGtlcm5lbF9jb250ZXh0IGFzIHRoZSByZW1vdGUgY29udGV4dAotCQkgKiB3aWxs
IGl0c2VsZiBwb2tlIGF0IHRoZSBrZXJuZWxfY29udGV4dCB3aGVuIGl0IG5lZWRzIHRvCi0JCSAq
IHVucGluLiBFcmdvLCBpZiBhbHJlYWR5IGxvY2tlZCwgd2UgZHJvcCBib3RoIGxvY2tzIGFuZAot
CQkgKiB0cnkgYWdhaW4gKHRocm91Z2ggdGhlIG1hZ2ljIG9mIHVzZXJzcGFjZSByZXBlYXRpbmcg
RUFHQUlOKS4KLQkJICovCi0JCWlmICghbXV0ZXhfdHJ5bG9jaygmdGwtPm11dGV4KSkKLQkJCXJl
dHVybiAtRUFHQUlOOwotCiAJCS8qIFF1ZXVlIHRoaXMgc3dpdGNoIGFmdGVyIGN1cnJlbnQgYWN0
aXZpdHkgYnkgdGhpcyBjb250ZXh0LiAqLwogCQllcnIgPSBpOTE1X2FjdGl2ZV9mZW5jZV9zZXQo
JnRsLT5sYXN0X3JlcXVlc3QsIHJxKTsKLQkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwogCQlp
ZiAoZXJyKQogCQkJcmV0dXJuIGVycjsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF90aW1lbGluZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
dGltZWxpbmUuYwppbmRleCBjMWQyNDE5NDQ0ZjguLjAzOGUwNWE2MzM2YyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jCkBAIC0yNTQsNyArMjU0LDcgQEAgaW50IGlu
dGVsX3RpbWVsaW5lX2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSwKIAogCW11
dGV4X2luaXQoJnRpbWVsaW5lLT5tdXRleCk7CiAKLQlJTklUX0FDVElWRV9GRU5DRSgmdGltZWxp
bmUtPmxhc3RfcmVxdWVzdCwgJnRpbWVsaW5lLT5tdXRleCk7CisJSU5JVF9BQ1RJVkVfRkVOQ0Uo
JnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QpOwogCUlOSVRfTElTVF9IRUFEKCZ0aW1lbGluZS0+cmVx
dWVzdHMpOwogCiAJaTkxNV9zeW5jbWFwX2luaXQoJnRpbWVsaW5lLT5zeW5jKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCmluZGV4IDJh
NzdjMDUxZjM2YS4uYWViMWQxZjYxNmU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMKQEAgLTE1LDcgKzE1LDcgQEAgdm9pZCBtb2Nr
X3RpbWVsaW5lX2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSwgdTY0IGNvbnRl
eHQpCiAKIAltdXRleF9pbml0KCZ0aW1lbGluZS0+bXV0ZXgpOwogCi0JSU5JVF9BQ1RJVkVfRkVO
Q0UoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsICZ0aW1lbGluZS0+bXV0ZXgpOworCUlOSVRfQUNU
SVZFX0ZFTkNFKCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmdGlt
ZWxpbmUtPnJlcXVlc3RzKTsKIAogCWk5MTVfc3luY21hcF9pbml0KCZ0aW1lbGluZS0+c3luYyk7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwppbmRleCBkY2ExNWFjZTg4ZjYuLjA1MTFlMWQ3
N2Y4ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0yNDQsNyArMjQ0LDcgQEAg
YWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKnRsKQogCX0KIAogCW5vZGUgPSBwcmVhbGxvYzsKLQlfX2k5MTVfYWN0aXZlX2ZlbmNl
X2luaXQoJm5vZGUtPmJhc2UsICZ0bC0+bXV0ZXgsIE5VTEwsIG5vZGVfcmV0aXJlKTsKKwlfX2k5
MTVfYWN0aXZlX2ZlbmNlX2luaXQoJm5vZGUtPmJhc2UsIE5VTEwsIG5vZGVfcmV0aXJlKTsKIAlu
b2RlLT5yZWYgPSByZWY7CiAJbm9kZS0+dGltZWxpbmUgPSBpZHg7CiAKQEAgLTI4MSw3ICsyODEs
NyBAQCB2b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAlp
bml0X2xsaXN0X2hlYWQoJnJlZi0+cHJlYWxsb2NhdGVkX2JhcnJpZXJzKTsKIAlhdG9taWNfc2V0
KCZyZWYtPmNvdW50LCAwKTsKIAlfX211dGV4X2luaXQoJnJlZi0+bXV0ZXgsICJpOTE1X2FjdGl2
ZSIsIGtleSk7Ci0JX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZyZWYtPmV4Y2wsICZyZWYtPm11
dGV4LCBOVUxMLCBleGNsX3JldGlyZSk7CisJX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZyZWYt
PmV4Y2wsIE5VTEwsIGV4Y2xfcmV0aXJlKTsKIAlJTklUX1dPUksoJnJlZi0+d29yaywgYWN0aXZl
X3dvcmspOwogfQogCkBAIC0zNzYsMTUgKzM3Niw4IEBAIHZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4
Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZikKIAkv
KiBXZSBleHBlY3QgdGhlIGNhbGxlciB0byBtYW5hZ2UgdGhlIGV4Y2x1c2l2ZSB0aW1lbGluZSBv
cmRlcmluZyAqLwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZShyZWYpKTsKIAotCS8q
Ci0JICogQXMgd2UgZG9uJ3Qga25vdyB3aGljaCBtdXRleCB0aGUgY2FsbGVyIGlzIHVzaW5nLCB3
ZSB0b2xkIGEgc21hbGwKLQkgKiBsaWUgdG8gdGhlIGRlYnVnIGNvZGUgdGhhdCBpdCBpcyB1c2lu
ZyB0aGUgaTkxNV9hY3RpdmUubXV0ZXg7Ci0JICogYW5kIG5vdyB3ZSBtdXN0IHN0aWNrIHRvIHRo
YXQgbGllLgotCSAqLwotCW11dGV4X2FjcXVpcmUoJnJlZi0+bXV0ZXguZGVwX21hcCwgMCwgMCwg
X1RISVNfSVBfKTsKIAlpZiAoIV9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCZyZWYtPmV4Y2wsIGYp
KQogCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKLQltdXRleF9yZWxlYXNlKCZyZWYtPm11dGV4
LmRlcF9tYXAsIDAsIF9USElTX0lQXyk7CiB9CiAKIGJvb2wgaTkxNV9hY3RpdmVfYWNxdWlyZV9p
Zl9idXN5KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQpAQCAtNjE1LDEwICs2MDgsNiBAQCBpbnQg
aTkxNV9hY3RpdmVfYWNxdWlyZV9wcmVhbGxvY2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmLAogCQkJCWdvdG8gdW53aW5kOwogCQkJfQogCi0jaWYgSVNfRU5BQkxFRChDT05GSUdf
RFJNX0k5MTVfREVCVUdfR0VNKQotCQkJbm9kZS0+YmFzZS5sb2NrID0KLQkJCQkmZW5naW5lLT5r
ZXJuZWxfY29udGV4dC0+dGltZWxpbmUtPm11dGV4OwotI2VuZGlmCiAJCQlSQ1VfSU5JVF9QT0lO
VEVSKG5vZGUtPmJhc2UuZmVuY2UsIE5VTEwpOwogCQkJbm9kZS0+YmFzZS5jYi5mdW5jID0gbm9k
ZV9yZXRpcmU7CiAJCQlub2RlLT50aW1lbGluZSA9IGlkeDsKQEAgLTcyOCwxMiArNzE3LDYgQEAg
dm9pZCBpOTE1X3JlcXVlc3RfYWRkX2FjdGl2ZV9iYXJyaWVycyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSkKIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZycS0+bG9jaywgZmxhZ3MpOwogfQogCi0j
aWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQotI2RlZmluZSBhY3RpdmVf
aXNfaGVsZChhY3RpdmUpIGxvY2tkZXBfaXNfaGVsZCgoYWN0aXZlKS0+bG9jaykKLSNlbHNlCi0j
ZGVmaW5lIGFjdGl2ZV9pc19oZWxkKGFjdGl2ZSkgdHJ1ZQotI2VuZGlmCi0KIC8qCiAgKiBfX2k5
MTVfYWN0aXZlX2ZlbmNlX3NldDogVXBkYXRlIHRoZSBsYXN0IGFjdGl2ZSBmZW5jZSBhbG9uZyBp
dHMgdGltZWxpbmUKICAqIEBhY3RpdmU6IHRoZSBhY3RpdmUgdHJhY2tlcgpAQCAtNzQ0LDcgKzcy
Nyw3IEBAIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZF9hY3RpdmVfYmFycmllcnMoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEpCiAgKiBmZW5jZSBvbnRvIHRoaXMgb25lLiBSZXR1cm5zIHRoZSBwcmV2aW91
cyBmZW5jZSAoaWYgbm90IGFscmVhZHkgY29tcGxldGVkKSwKICAqIHdoaWNoIHRoZSBjYWxsZXIg
bXVzdCBlbnN1cmUgaXMgZXhlY3V0ZWQgYmVmb3JlIHRoZSBuZXcgZmVuY2UuIFRvIGVuc3VyZQog
ICogdGhhdCB0aGUgb3JkZXIgb2YgZmVuY2VzIHdpdGhpbiB0aGUgdGltZWxpbmUgb2YgdGhlIGk5
MTVfYWN0aXZlX2ZlbmNlIGlzCi0gKiBtYWludGFpbmVkLCBpdCBtdXN0IGJlIGxvY2tlZCBieSB0
aGUgY2FsbGVyLgorICogdW5kZXJzdG9vZCwgaXQgc2hvdWxkIGJlIGxvY2tlZCBieSB0aGUgY2Fs
bGVyLgogICovCiBzdHJ1Y3QgZG1hX2ZlbmNlICoKIF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0
cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLApAQCAtNzUzLDM0ICs3MzYsNDAgQEAgX19p
OTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUsCiAJ
c3RydWN0IGRtYV9mZW5jZSAqcHJldjsKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0JLyogTkI6
IG11c3QgYmUgc2VyaWFsaXNlZCBieSBhbiBvdXRlciB0aW1lbGluZSBtdXRleCAoYWN0aXZlLT5s
b2NrKSAqLwotCXNwaW5fbG9ja19pcnFzYXZlKGZlbmNlLT5sb2NrLCBmbGFncyk7CisJaWYgKGZl
bmNlID09IHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPmZlbmNlKSkKKwkJcmV0dXJuIGZlbmNl
OworCiAJR0VNX0JVR19PTih0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZm
ZW5jZS0+ZmxhZ3MpKTsKIAotCXByZXYgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGFjdGl2
ZS0+ZmVuY2UsIGFjdGl2ZV9pc19oZWxkKGFjdGl2ZSkpOworCS8qCisJICogQ29uc2lkZXIgdGhh
dCB3ZSBoYXZlIHR3byB0aHJlYWRzIGFycml2aW5nIChBIGFuZCBCKSwgd2l0aAorCSAqIEMgYWxy
ZWFkeSByZXNpZGVudCBhcyB0aGUgYWN0aXZlLT5mZW5jZS4KKwkgKgorCSAqIEEgZG9lcyB0aGUg
eGNoZyBmaXJzdCwgYW5kIHNvIGl0IHNlZXMgQyBvciBOVUxMIGRlcGVuZGluZworCSAqIG9uIHRo
ZSB0aW1pbmcgb2YgdGhlIGludGVycnVwdCBoYW5kbGVyLiBJZiBpdCBpcyBOVUxMLCB0aGUKKwkg
KiBwcmV2aW91cyBmZW5jZSBtdXN0IGhhdmUgYmVlbiBzaWduYWxlZCBhbmQgd2Uga25vdyB0aGF0
CisJICogd2UgYXJlIGZpcnN0IG9uIHRoZSB0aW1lbGluZS4gSWYgaXQgaXMgc3RpbGwgcHJlc2Vu
dCwKKwkgKiB3ZSBhY3F1aXJlIHRoZSBsb2NrIG9uIHRoYXQgZmVuY2UgYW5kIHNlcmlhbGlzZSB3
aXRoIHRoZSBpbnRlcnJ1cHQKKwkgKiBoYW5kbGVyLCBpbiB0aGUgcHJvY2VzcyByZW1vdmluZyBp
dCBmcm9tIGFueSBmdXR1cmUgaW50ZXJydXB0CisJICogY2FsbGJhY2suIEEgd2lsbCB0aGVuIHdh
aXQgb24gQyBiZWZvcmUgZXhlY3V0aW5nIChpZiBwcmVzZW50KS4KKwkgKgorCSAqIEFzIEIgaXMg
c2Vjb25kLCBpdCBzZWVzIEEgYXMgdGhlIHByZXZpb3VzIGZlbmNlIGFuZCBzbyB3YWl0cyBmb3IK
KwkgKiBpdCB0byBjb21wbGV0ZSBpdHMgdHJhbnNpdGlvbiBhbmQgdGFrZXMgb3ZlciB0aGUgb2Nj
dXBhbmN5IGZvcgorCSAqIGl0c2VsZiAtLSByZW1lbWJlcmluZyB0aGF0IGl0IG5lZWRzIHRvIHdh
aXQgb24gQSBiZWZvcmUgZXhlY3V0aW5nLgorCSAqCisJICogTm90ZSB0aGUgc3Ryb25nIG9yZGVy
aW5nIG9mIHRoZSB0aW1lbGluZSBhbHNvIHByb3ZpZGVzIGNvbnNpc3RlbnQKKwkgKiBuZXN0aW5n
IHJ1bGVzIGZvciB0aGUgZmVuY2UtPmxvY2s7IHRoZSBvdXRlciBsb2NrIGlzIGFsd2F5cyB0aGUK
KwkgKiBvbGRlciBsb2NrLgorCSAqLworCXNwaW5fbG9ja19pcnFzYXZlKGZlbmNlLT5sb2NrLCBm
bGFncyk7CisJcHJldiA9IHhjaGcoX19pOTE1X2FjdGl2ZV9mZW5jZV9zbG90KGFjdGl2ZSksIGZl
bmNlKTsKIAlpZiAocHJldikgewogCQlHRU1fQlVHX09OKHByZXYgPT0gZmVuY2UpOwogCQlzcGlu
X2xvY2tfbmVzdGVkKHByZXYtPmxvY2ssIFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKIAkJX19saXN0
X2RlbF9lbnRyeSgmYWN0aXZlLT5jYi5ub2RlKTsKIAkJc3Bpbl91bmxvY2socHJldi0+bG9jayk7
IC8qIHNlcmlhbGlzZSB3aXRoIHByZXYtPmNiX2xpc3QgKi8KLQotCQkvKgotCQkgKiBhY3RpdmUt
PmZlbmNlIGlzIHJlc2V0IGJ5IHRoZSBjYWxsYmFjayBmcm9tIGluc2lkZQotCQkgKiBpbnRlcnJ1
cHQgY29udGV4dC4gV2UgbmVlZCB0byBzZXJpYWxpc2Ugb3VyIGxpc3QKLQkJICogbWFuaXB1bGF0
aW9uIHdpdGggdGhlIGZlbmNlLT5sb2NrIHRvIHByZXZlbnQgdGhlIHByZXYKLQkJICogYmVpbmcg
bG9zdCBpbnNpZGUgYW4gaW50ZXJydXB0IChpdCBjYW4ndCBiZSByZXBsYWNlZCBhcwotCQkgKiBu
byBvdGhlciBjYWxsZXIgaXMgYWxsb3dlZCB0byBlbnRlciBfX2k5MTVfYWN0aXZlX2ZlbmNlX3Nl
dAotCQkgKiBhcyB3ZSBob2xkIHRoZSB0aW1lbGluZSBsb2NrKS4gQWZ0ZXIgc2VyaWFsaXNpbmcg
d2l0aAotCQkgKiB0aGUgY2FsbGJhY2ssIHdlIG5lZWQgdG8gZG91YmxlIGNoZWNrIHdoaWNoIHJh
biBmaXJzdCwKLQkJICogb3VyIGxpc3RfZGVsKCkgW2RlY291cGxpbmcgcHJldiBmcm9tIHRoZSBj
YWxsYmFja10gb3IKLQkJICogdGhlIGNhbGxiYWNrLi4uCi0JCSAqLwotCQlwcmV2ID0gcmN1X2Fj
Y2Vzc19wb2ludGVyKGFjdGl2ZS0+ZmVuY2UpOwogCX0KLQotCXJjdV9hc3NpZ25fcG9pbnRlcihh
Y3RpdmUtPmZlbmNlLCBmZW5jZSk7CiAJbGlzdF9hZGRfdGFpbCgmYWN0aXZlLT5jYi5ub2RlLCAm
ZmVuY2UtPmNiX2xpc3QpOwotCiAJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZShmZW5jZS0+bG9jaywg
ZmxhZ3MpOwogCiAJcmV0dXJuIHByZXY7CkBAIC03OTIsMTAgKzc4MSw2IEBAIGludCBpOTE1X2Fj
dGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUsCiAJc3RydWN0
IGRtYV9mZW5jZSAqZmVuY2U7CiAJaW50IGVyciA9IDA7CiAKLSNpZiBJU19FTkFCTEVEKENPTkZJ
R19EUk1fSTkxNV9ERUJVR19HRU0pCi0JbG9ja2RlcF9hc3NlcnRfaGVsZChhY3RpdmUtPmxvY2sp
OwotI2VuZGlmCi0KIAkvKiBNdXN0IG1haW50YWluIHRpbWVsaW5lIG9yZGVyaW5nIHdydCBwcmV2
aW91cyBhY3RpdmUgcmVxdWVzdHMgKi8KIAlyY3VfcmVhZF9sb2NrKCk7CiAJZmVuY2UgPSBfX2k5
MTVfYWN0aXZlX2ZlbmNlX3NldChhY3RpdmUsICZycS0+ZmVuY2UpOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmgKaW5kZXggNWRkNjIzMjNiOTJhLi41ZDhmYzAwNGM0MDcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuaApAQCAtNjEsMTkgKzYxLDE1IEBAIHZvaWQgaTkxNV9hY3RpdmVf
bm9vcChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpOwog
ICovCiBzdGF0aWMgaW5saW5lIHZvaWQKIF9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdChzdHJ1Y3Qg
aTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKLQkJCSBzdHJ1Y3QgbXV0ZXggKmxvY2ssCiAJCQkg
dm9pZCAqZmVuY2UsCiAJCQkgZG1hX2ZlbmNlX2Z1bmNfdCBmbikKIHsKIAlSQ1VfSU5JVF9QT0lO
VEVSKGFjdGl2ZS0+ZmVuY2UsIGZlbmNlKTsKIAlhY3RpdmUtPmNiLmZ1bmMgPSBmbiA/OiBpOTE1
X2FjdGl2ZV9ub29wOwotI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkK
LQlhY3RpdmUtPmxvY2sgPSBsb2NrOwotI2VuZGlmCiB9CiAKLSNkZWZpbmUgSU5JVF9BQ1RJVkVf
RkVOQ0UoQSwgTE9DSykgXAotCV9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdCgoQSksIChMT0NLKSwg
TlVMTCwgTlVMTCkKKyNkZWZpbmUgSU5JVF9BQ1RJVkVfRkVOQ0UoQSkgXAorCV9faTkxNV9hY3Rp
dmVfZmVuY2VfaW5pdCgoQSksIE5VTEwsIE5VTEwpCiAKIHN0cnVjdCBkbWFfZmVuY2UgKgogX19p
OTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUsCkBA
IC0xMjcsMTMgKzEyMywyOCBAQCBpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldChjb25zdCBzdHJ1Y3Qg
aTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkKIAlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKGFj
dGl2ZS0+ZmVuY2UpOwogfQogCisvKioKKyAqIF9faTkxNV9hY3RpdmVfZmVuY2Vfc2xvdCAtIHBy
b3ZpZGUgcmF3IGFjY2VzcyB0byB0aGUgZG1hX2ZlbmNlIHBvaW50ZXIKKyAqIEBhY3RpdmUgLSB0
aGUgYWN0aXZlIHRyYWNrZXIKKyAqCisgKiBfX2k5MTVfYWN0aXZlX2ZlbmNlX3Nsb3QoKSBzdHJp
cHMgYXdheSB0aGUgUkNVLWFubm90YXRpb24gc28gYmUgY2FyZWZ1bAorICogYW5kIG9ubHkgdXNl
IGluIGNvbmp1bmN0aW9uIHdpdGggYXRvbWljIGFjY2VzcyB1bmRlcm5lYXRoIHNvbWUgc3Ryb25n
CisgKiBsb2NraW5nIHJ1bGVzLCBzdWNoIGFzIGhvbGRpbmcgYm90aCB0aGUgcGFzdCwgcHJlc2Vu
dCBhbmQgZnV0dXJlIGZlbmNlCisgKiBsb2Nrcy4KKyAqLworc3RhdGljIGlubGluZSBzdHJ1Y3Qg
ZG1hX2ZlbmNlICoqCitfX2k5MTVfYWN0aXZlX2ZlbmNlX3Nsb3Qoc3RydWN0IGk5MTVfYWN0aXZl
X2ZlbmNlICphY3RpdmUpCit7CisJcmV0dXJuIChzdHJ1Y3QgZG1hX2ZlbmNlICoqIF9fZm9yY2Up
JmFjdGl2ZS0+ZmVuY2U7Cit9CisKIHN0YXRpYyBpbmxpbmUgdm9pZAogaTkxNV9hY3RpdmVfZmVu
Y2VfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQog
ewogCXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlID0KIAkJY29udGFpbmVyX29mKGNi
LCB0eXBlb2YoKmFjdGl2ZSksIGNiKTsKIAotCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5mZW5j
ZSwgTlVMTCk7CisJY21weGNoZyhfX2k5MTVfYWN0aXZlX2ZlbmNlX3Nsb3QoYWN0aXZlKSwgZmVu
Y2UsIE5VTEwpOwogfQogCiAvKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9hY3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVz
LmgKaW5kZXggOTZhZWQwZWU3MDBhLi42MzYwYzNlNGI3NjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApAQCAtMjAsMjEgKzIwLDYgQEAKIHN0cnVjdCBpOTE1X2Fj
dGl2ZV9mZW5jZSB7CiAJc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqZmVuY2U7CiAJc3RydWN0IGRt
YV9mZW5jZV9jYiBjYjsKLSNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0p
Ci0JLyoKLQkgKiBJbmNvcnBvcmVhbCEKLQkgKgotCSAqIFVwZGF0ZXMgdG8gdGhlIGk5MTVfYWN0
aXZlX3JlcXVlc3QgbXVzdCBiZSBzZXJpYWxpc2VkIHVuZGVyIGEgbG9jawotCSAqIHRvIGVuc3Vy
ZSB0aGF0IHRoZSB0aW1lbGluZSBpcyBvcmRlcmVkLiBOb3JtYWxseSwgdGhpcyBpcyB0aGUKLQkg
KiB0aW1lbGluZS0+bXV0ZXgsIGJ1dCBhbm90aGVyIG11dGV4IG1heSBiZSB1c2VkIHNvIGxvbmcg
YXMgaXQgaXMKLQkgKiBkb25lIHNvIGNvbnNpc3RlbnRseS4KLQkgKgotCSAqIEZvciBsb2NrZGVw
IHRyYWNraW5nIG9mIHRoZSBhYm92ZSwgd2Ugc3RvcmUgdGhlIGxvY2sgd2UgaW50ZW5kCi0JICog
dG8gYWx3YXlzIHVzZSBmb3IgdXBkYXRlcyBvZiB0aGlzIGk5MTVfYWN0aXZlX3JlcXVlc3QgZHVy
aW5nCi0JICogY29uc3RydWN0aW9uIGFuZCBhc3NlcnQgdGhhdCBpcyBoZWxkIG9uIGV2ZXJ5IHVw
ZGF0ZS4KLQkgKi8KLQlzdHJ1Y3QgbXV0ZXggKmxvY2s7Ci0jZW5kaWYKIH07CiAKIHN0cnVjdCBh
Y3RpdmVfbm9kZTsKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

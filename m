Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2D2DD1037BA
	for <lists+intel-gfx@lfdr.de>; Wed, 20 Nov 2019 11:40:17 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 25A1B6E225;
	Wed, 20 Nov 2019 10:40:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BF5DC6E225
 for <intel-gfx@lists.freedesktop.org>; Wed, 20 Nov 2019 10:40:13 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 20 Nov 2019 02:40:13 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,221,1571727600"; d="scan'208";a="215753355"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga001.fm.intel.com with ESMTP; 20 Nov 2019 02:40:10 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 20 Nov 2019 12:37:43 +0200
Message-Id: <20191120103743.28148-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v8] drm/i915: Enable second dbuf slice for ICL
 and TGL
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxzbyBpbXBsZW1lbnRlZCBhbGdvcml0aG0gZm9yIGNob29zaW5nIERCdWYgc2xpY2UgY29uZmln
dXJhdGlvbgpiYXNlZCBvbiBhY3RpdmUgcGlwZXMsIHBpcGUgcmF0aW8gYXMgc3RhdGVkIGluIEJT
cGVjIDEyNzE2LgoKTm93IHBpcGUgYWxsb2NhdGlvbiBzdGlsbCBzdGF5cyBwcm9wb3J0aW9uYWwg
dG8gcGlwZSB3aWR0aCBhcyBiZWZvcmUsCmhvd2V2ZXIgd2l0aGluIGFsbG93ZWQgREJ1ZiBzbGlj
ZSBmb3IgdGhpcyBwYXJ0aWN1bGFyIGNvbmZpZ3VyYXRpb24uCgp2MjogUmVtb3ZlIHVubmVlZGVk
IGNoZWNrIGZyb20gY29tbWl0IGFzIGRkYiBlbmFibGVkIHNsaWNlcyBtaWdodAogICAgbm93IGRp
ZmZlciBmcm9tIGh3IHN0YXRlLgoKdjM6IC0gQWRkZWQgbmV3IGZpZWxkICJzdXBwb3J0ZWRfc2xp
Y2VzIiB0byBkZGIgdG8gc2VwYXJhdGUgbWF4CiAgICAgIHN1cHBvcnRlZCBzbGljZXMgdnMgY3Vy
cmVudGx5IGVuYWJsZWQsIHRvIGF2b2lkIGNvbmZ1c2lvbi4KICAgIC0gUmVtb3ZlZCBvYnNvbGV0
ZSBjb21tZW50cyBhbmQgY29kZSByZWxhdGVkIHRvIERCdWYoTWF0dGhldyBSb3BlcikuCiAgICAt
IFNvbWUgY29kZSBzdHlsZSBhbmQgbG9uZyBsaW5lIHJlbW92YWwoTWF0dGhldyBSb3BlcikuCiAg
ICAtIEFkZGVkIFdBUk5fT04gdG8gbmV3IGRkYiByYW5nZSBvZmZzZXQgY2FsYyBmdW5jdGlvbihN
YXR0aGV3IFJvcGVyKS4KICAgIC0gUmVtb3ZlZCBwbGF0Zm9ybSBzcGVjaWZpYyBjYWxsIHRvIGNh
bGMgcGlwZSByYXRpbyBmcm9tIGRkYgogICAgICBhbGxvY2F0aW9uIGZ1bmN0aW9uIGFuZCBmaXhl
ZCB0aGUgcmV0dXJuIHZhbHVlKE1hdHRoZXcgUm9wZXIpCiAgICAtIFJlZmFjdG9yZWQgREJVRiBz
bGljZSBhbGxvY2F0aW9uIHRhYmxlIHRvIGltcHJvdmUgcmVhZGFiaWxpdHkKICAgIC0gQWRkZWQg
REJVRiBzbGljZSBhbGxvY2F0aW9uIGZvciBUR0wgYXMgd2VsbC4KICAgIC0gSUNMKGhvd2V2ZXIg
bm90IFRHTCkgc2VlbXMgdG8gdm9sdW50YXJpbHkgZW5hYmxlIHNlY29uZCBEQnVmIHNsaWNlCiAg
ICAgIGFmdGVyIHBtIHN1c3BlbmQvcmVzdW1lIGNhdXNpbmcgYSBtaXNtYXRjaCBmYWlsdXJlLCBi
ZWNhdXNlIHdlCiAgICAgIHVwZGF0ZSBEQnVmIHNsaWNlcyBvbmx5IGlmIHdlIGRvIGEgbW9kZXNl
dCwgaG93ZXZlciB0aGlzIGNoZWNrCiAgICAgIGlzIGRvbmUgYWx3YXlzLiBGaXhlZCBpdCB0byBi
ZSBkb25lIG9ubHkgd2hlbiBtb2Rlc2V0IGZvciBJQ0wuCgp2NDogLSBOb3cgZW5hYmxlZCBzbGlj
ZXMgaXMgbm90IGFjdHVhbGx5IGEgbnVtYmVyLCBidXQgYSBiaXRtYXNrLAogICAgICBiZWNhdXNl
IHdlIG1pZ2h0IG5lZWQgdG8gZW5hYmxlIHNlY29uZCBzbGljZSBvbmx5IGFuZCBudW1iZXIKICAg
ICAgb2Ygc2xpY2VzIHdvdWxkIHN0aWxsIDEgYW5kIHRoYXQgY3VycmVudCBjb2RlIGRvZXNuJ3Qg
YWxsb3cuCiAgICAtIFJlbW92ZSByZWR1bmRhbnQgZHVwbGljYXRlIGNvZGUgdG8gaGF2ZSBzb21l
IHVuaWZpZWQgd2F5IG9mCiAgICAgIGVuYWJsaW5nIGRidWYgc2xpY2VzIGluc3RlYWQgb2YgaGFy
ZGNvZGluZy4KCnY1OiAtIEZpeCBmYWlsaW5nIGdlbjlfYXNzZXJ0X2RidWZfZW5hYmxlZCBhcyBp
dCB3YXMgbmFpdmVseSB0aGlua2luZwogICAgICB0aGF0IHdlIGhhdmUgb25seSBvbmUgREJVRl9D
VEwgc2xpY2UuIE5vdyBhbm90aGVyIHZlcnNpb24gZm9yCiAgICAgIGdlbjExIHdpbGwgY2hlY2sg
Ym90aCBzbGljZXMgYXMgb25seSBzZWNvbmQgb25lIGNhbiBiZSBlbmFibGVkLAogICAgICB0byBr
ZWVwIENJIGhhcHB5LgoKdjY6IC0gUmVtb3ZlZCBlbmFibGVkIGRidWYgYXNzZXJ0aW9uIGNvbXBs
ZXRlbHkuIFByZXZpb3VzIGNvZGUKICAgICAgd2FzIGtlZXBpbmcgZGJ1ZiBlbmFibGVkLCBldmVu
KCEpIHdoZW4gX2RidWZfZGlzYWJsZSBpcyBjYWxsZWQuCiAgICAgIEN1cnJlbnRseSB3ZSBlbmFi
bGUvZGlzYWJsZSBkYnVmIHNsaWNlcyBiYXNlZCBvbiByZXF1cmVtZW50CiAgICAgIHNvIG5vIHBv
aW50IGluIGFzc2VydGluZyB0aGlzIGhlcmUuCiAgICAtIFJlbW92ZWQgdW5uZWNlc3NhcnkgbW9k
ZXNldCBjaGVjayBmcm9tIHZlcmlmeV93bV9zdGF0ZShNYXR0aGV3IFJvcGVyKQogICAgLSBTbGlj
ZXMgaW50ZXJzZWN0aW9uIGFmdGVyIHVuaW9uIGlzIHNhbWUKICAgICAgYXMgZmluYWwgcmVzdWx0
KE1hdHRoZXcgUm9wZXIpCiAgICAtIE1vdmVkIERCdWYgc2xpY2VzIHRvIGludGVsX2RldmljZV9p
bmZvKE1hdHRoZXcgUm9wZXIpCiAgICAtIFNvbWUgbWFjcm9zIGFkZGVkKE1hdHRoZXcgUm9wZXIp
CiAgICAtIGRkYiByYW5nZSBpcyBub3cgYWx3YXlzIGxlc3Mgb3IgZXF1YWwgdG8gZGRiIHNpemUg
LSBubyBuZWVkCiAgICAgIGZvciBhZGRpdGlvbmFsIGNoZWNrcyhwcmV2aW91c2x5IG5lZWRlZCBh
cyB3ZSBoYWQgc29tZQogICAgICBiYW5kd2lkdGggY2hlY2tzIGluIHRoZXJlIHdoaWNoIGNvdWxk
ICJzdWRkZW5seSIgcmV0dXJuCiAgICAgIGRkYl9zaXplIHNtYWxsZXIgdGhhbiBpdCBpcy4KCnY3
OiBNaW5vciBjb3N0ZW1pYyBjaGFuZ2VzOgogICAgLSBDaGFuZ2VkIGljbF9kYnVmX3NsaWNlc19y
ZXN0b3JlIG5hbWUgdG8gaWNsX3Byb2dyYW1fZGJ1Zl9zbGljZXMKICAgICAgYXMgaXQgbW9yZSBj
b3JyZXNwb25kcyB0byB0aGUgYWN0dWFsIGZ1bmN0aW9uYWxpdHkuCiAgICAtIFNvbWUgc2ltcGxp
ZmljYXRpb24gd2l0aCBzdXBwb3J0ZWQgc2xpY2VzIGZvciBCWFQgYW5kIEdMSwogICAgLSBza2xf
cGlwZV9kb3duc2NhbGVfYW1vdW50IC0+IGljbF9waXBlX2Rvd25zY2FsZV9hbW91bnQgYXMKICAg
ICAgdGhpcyBpcyBub3QgdXNlZCBmb3Igc2tsIGFueW1vcmUuCiAgICAtIENoYW5nZWQgREJ1ZiBz
bGljZSBhc3NpZ25tZW50IG9yZGVyIGZvciBUR0wgY2FzZQoKdjg6IEZpeCBjaGVja3BhdGNoL3Nw
YXJzZSB3YXJuaW5ncy4KClJldmlld2VkLWJ5OiBNYXR0aGV3IFJvcGVyIDxtYXR0aGV3LmQucm9w
ZXJAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBTdGFuaXNsYXYgTGlzb3Zza2l5IDxzdGFuaXNs
YXYubGlzb3Zza2l5QGludGVsLmNvbT4KQ2M6IE1hdHRoZXcgUm9wZXIgPG1hdHRoZXcuZC5yb3Bl
ckBpbnRlbC5jb20+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAaW50ZWwuY29t
PgpDYzogSmFtZXMgQXVzbXVzIDxqYW1lcy5hdXNtdXNAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAyNiArLQogLi4uL2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jICAgIHwgIDk4ICsrLS0tCiAuLi4vZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmggICAgfCAgIDIgKwogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAgICAgICAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wY2kuYyAgICAgICAgICAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlZy5oICAgICAgICAgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmggICAgICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9wbS5jICAgICAgICAgICAgICAgfCAzODYgKysrKysrKysrKysrKysrKy0tCiA5
IGZpbGVzIGNoYW5nZWQsIDQzMCBpbnNlcnRpb25zKCspLCAxMDQgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBhZGY1MGM0
YjM4YWQuLmVlMzEzZTliOGUyMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMKQEAgLTEzMzg3LDcgKzEzMzg3LDcgQEAgc3RhdGljIHZvaWQgdmVyaWZ5
X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTEgJiYKIAkgICAgaHctPmRkYi5lbmFibGVkX3NsaWNlcyAhPSBzd19kZGItPmVu
YWJsZWRfc2xpY2VzKQotCQlEUk1fRVJST1IoIm1pc21hdGNoIGluIERCVUYgU2xpY2VzIChleHBl
Y3RlZCAldSwgZ290ICV1KVxuIiwKKwkJRFJNX0VSUk9SKCJtaXNtYXRjaCBpbiBEQlVGIFNsaWNl
cyAoZXhwZWN0ZWQgJXgsIGdvdCAleClcbiIsCiAJCQkgIHN3X2RkYi0+ZW5hYmxlZF9zbGljZXMs
CiAJCQkgIGh3LT5kZGIuZW5hYmxlZF9zbGljZXMpOwogCkBAIC0xNDYxOSwxNSArMTQ2MTksMjQg
QEAgc3RhdGljIHZvaWQgc2tsX2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUpCiAJdTggaHdfZW5hYmxlZF9zbGljZXMgPSBkZXZfcHJpdi0+d20u
c2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlczsKIAl1OCByZXF1aXJlZF9zbGljZXMgPSBzdGF0ZS0+
d21fcmVzdWx0cy5kZGIuZW5hYmxlZF9zbGljZXM7CiAJc3RydWN0IHNrbF9kZGJfZW50cnkgZW50
cmllc1tJOTE1X01BWF9QSVBFU10gPSB7fTsKKwl1OCBzbGljZXNfdW5pb24gPSBod19lbmFibGVk
X3NsaWNlcyB8IHJlcXVpcmVkX3NsaWNlczsKKwl1OCBzbGljZXNfaW50ZXJzZWN0aW9uID0gcmVx
dWlyZWRfc2xpY2VzOwogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3Rh
dGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkKIAkJLyogaWdub3Jl
IGFsbG9jYXRpb25zIGZvciBjcnRjJ3MgdGhhdCBoYXZlIGJlZW4gdHVybmVkIG9mZi4gKi8KIAkJ
aWYgKG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCiAJCQllbnRyaWVzW2ldID0gb2xkX2NydGNf
c3RhdGUtPndtLnNrbC5kZGI7CiAKLQkvKiBJZiAybmQgREJ1ZiBzbGljZSByZXF1aXJlZCwgZW5h
YmxlIGl0IGhlcmUgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJl
ZF9zbGljZXMgPiBod19lbmFibGVkX3NsaWNlcykKLQkJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShk
ZXZfcHJpdiwgcmVxdWlyZWRfc2xpY2VzKTsKKwlEUk1fREVCVUdfS01TKCJEQnVmIHJlcSBzbGlj
ZXMgJWQgaHcgc2xpY2VzICVkXG4iLAorCQkgICAgICByZXF1aXJlZF9zbGljZXMsIGh3X2VuYWJs
ZWRfc2xpY2VzKTsKKworCS8qCisJICogSWYgc29tZSBvdGhlciBEQnVmIHNsaWNlIHJlcXVpcmVk
LCBlbmFibGUgaXQgaGVyZSwKKwkgKiBhcyBoZXJlIHdlIG9ubHkgYWRkIG1vcmUgc2xpY2VzLCBi
dXQgbm90IHJlbW92ZSB0byBwcmV2ZW50CisJICogaXNzdWVzIGlmIHNvbWVib2R5IHN0aWxsIHVz
ZXMgdGhvc2UuCisJICovCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYgcmVxdWly
ZWRfc2xpY2VzICE9IGh3X2VuYWJsZWRfc2xpY2VzKQorCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRl
KGRldl9wcml2LCBzbGljZXNfdW5pb24pOwogCiAJLyoKIAkgKiBXaGVuZXZlciB0aGUgbnVtYmVy
IG9mIGFjdGl2ZSBwaXBlcyBjaGFuZ2VzLCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB3ZQpAQCAtMTQ2
ODYsOSArMTQ2OTUsMTIgQEAgc3RhdGljIHZvaWQgc2tsX2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCX0KIAl9IHdoaWxlIChwcm9ncmVz
cyk7CiAKLQkvKiBJZiAybmQgREJ1ZiBzbGljZSBpcyBubyBtb3JlIHJlcXVpcmVkIGRpc2FibGUg
aXQgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9zbGljZXMg
PCBod19lbmFibGVkX3NsaWNlcykKLQkJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwg
cmVxdWlyZWRfc2xpY2VzKTsKKwkvKgorCSAqIElmIHNvbWUgb3RoZXIgREJ1ZiBzbGljZSBpcyBu
b3QgbmVlZGVkLCBkaXNhYmxlIGl0IGhlcmUsCisJICogYXMgaGVyZSB3ZSBvbmx5IHJlbW92ZSBz
bGljZXMsIHdoaWNoIGFyZSBub3QgbmVlZGVkIGFueW1vcmUuCisJICovCisJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTEgJiYgcmVxdWlyZWRfc2xpY2VzICE9IGh3X2VuYWJsZWRfc2xpY2Vz
KQorCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCBzbGljZXNfaW50ZXJzZWN0aW9u
KTsKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2hlbHBlcl9mcmVlX3N0YXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKaW5kZXggY2UxYjY0ZjRkZDQ0Li5hNzhi
YzliNjE4NjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV9wb3dlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV9wb3dlci5jCkBAIC0xMDMxLDE1ICsxMDMxLDYgQEAgc3RhdGljIGJvb2wgZ2VuOV9k
Y19vZmZfcG93ZXJfd2VsbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJKEk5MTVfUkVBRChEQ19TVEFURV9FTikgJiBEQ19TVEFURV9FTl9VUFRPX0RDNV9EQzZf
TUFTSykgPT0gMCk7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjlfYXNzZXJ0X2RidWZfZW5hYmxlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCi17Ci0JdTMyIHRtcCA9IEk5MTVfUkVB
RChEQlVGX0NUTCk7Ci0KLQlXQVJOKCh0bXAgJiAoREJVRl9QT1dFUl9TVEFURSB8IERCVUZfUE9X
RVJfUkVRVUVTVCkpICE9Ci0JICAgICAoREJVRl9QT1dFUl9TVEFURSB8IERCVUZfUE9XRVJfUkVR
VUVTVCksCi0JICAgICAiVW5leHBlY3RlZCBEQnVmIHBvd2VyIHBvd2VyIHN0YXRlICgweCUwOHgp
XG4iLCB0bXApOwotfQotCiBzdGF0aWMgdm9pZCBnZW45X2Rpc2FibGVfZGNfc3RhdGVzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlzdHJ1Y3QgaW50ZWxfY2RjbGtfc3Rh
dGUgY2RjbGtfc3RhdGUgPSB7fTsKQEAgLTEwNTUsOCArMTA0Niw2IEBAIHN0YXRpYyB2b2lkIGdl
bjlfZGlzYWJsZV9kY19zdGF0ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CS8qIENhbid0IHJlYWQgb3V0IHZvbHRhZ2VfbGV2ZWwgc28gY2FuJ3QgdXNlIGludGVsX2NkY2xr
X2NoYW5nZWQoKSAqLwogCVdBUk5fT04oaW50ZWxfY2RjbGtfbmVlZHNfbW9kZXNldCgmZGV2X3By
aXYtPmNkY2xrLmh3LCAmY2RjbGtfc3RhdGUpKTsKIAotCWdlbjlfYXNzZXJ0X2RidWZfZW5hYmxl
ZChkZXZfcHJpdik7Ci0KIAlpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCiAJCWJ4dF92ZXJpZnlf
ZGRpX3BoeV9wb3dlcl93ZWxscyhkZXZfcHJpdik7CiAKQEAgLTQyNTQsMzEgKzQyNDMsNTEgQEAg
c3RhdGljIHZvaWQgZ2VuOV9kYnVmX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCWludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LCBEQlVGX0NUTCwgZmFsc2Up
OwogfQogCi1zdGF0aWMgdTggaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK2ludCBpbnRlbF9kYnVmX21heF9zbGljZXMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEp
Ci0JCXJldHVybiAxOwotCXJldHVybiAyOworCXJldHVybiBJTlRFTF9JTkZPKGRldl9wcml2KS0+
c3VwcG9ydGVkX3NsaWNlczsKK30KKwordm9pZCBpY2xfcHJvZ3JhbV9kYnVmX3NsaWNlcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit7CisJY29uc3QgdTggaHdfZW5hYmxlZF9z
bGljZXMgPSBkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlczsKKworCWljbF9k
YnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIGh3X2VuYWJsZWRfc2xpY2VzKTsKIH0KIAogdm9p
ZCBpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJCSAgICB1OCByZXFfc2xpY2VzKQogewotCWNvbnN0IHU4IGh3X2VuYWJsZWRfc2xpY2Vz
ID0gZGV2X3ByaXYtPndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXM7Ci0JYm9vbCByZXQ7CisJ
Ym9vbCByZXQgPSB0cnVlOworCWludCBpOworCWludCBtYXhfc2xpY2VzID0gaW50ZWxfZGJ1Zl9t
YXhfc2xpY2VzKGRldl9wcml2KTsKIAotCWlmIChyZXFfc2xpY2VzID4gaW50ZWxfZGJ1Zl9tYXhf
c2xpY2VzKGRldl9wcml2KSkgeworCWlmIChod2VpZ2h0OChyZXFfc2xpY2VzKSA+IGludGVsX2Ri
dWZfbWF4X3NsaWNlcyhkZXZfcHJpdikpIHsKIAkJRFJNX0VSUk9SKCJJbnZhbGlkIG51bWJlciBv
ZiBkYnVmIHNsaWNlcyByZXF1ZXN0ZWRcbiIpOwogCQlyZXR1cm47CiAJfQogCi0JaWYgKHJlcV9z
bGljZXMgPT0gaHdfZW5hYmxlZF9zbGljZXMgfHwgcmVxX3NsaWNlcyA9PSAwKQotCQlyZXR1cm47
CisJRFJNX0RFQlVHX0tNUygiVXBkYXRpbmcgZGJ1ZiBzbGljZXMgdG8gJXhcbiIsIHJlcV9zbGlj
ZXMpOwogCi0JaWYgKHJlcV9zbGljZXMgPiBod19lbmFibGVkX3NsaWNlcykKLQkJcmV0ID0gaW50
ZWxfZGJ1Zl9zbGljZV9zZXQoZGV2X3ByaXYsIERCVUZfQ1RMX1MyLCB0cnVlKTsKLQllbHNlCi0J
CXJldCA9IGludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LCBEQlVGX0NUTF9TMiwgZmFsc2Up
OworCWZvciAoaSA9IDA7IGkgPCBtYXhfc2xpY2VzOyBpKyspIHsKKwkJaW50IHNsaWNlX2JpdCA9
IEJJVChpKTsKKwkJYm9vbCBzbGljZV9zZXQgPSAoc2xpY2VfYml0ICYgcmVxX3NsaWNlcykgIT0g
MDsKKworCQlzd2l0Y2ggKHNsaWNlX2JpdCkgeworCQljYXNlIERCVUZfUzFfQklUOgorCQkJcmV0
ID0gcmV0ICYmIGludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LAorCQkJCQkJCSAgREJVRl9D
VExfUzEsCisJCQkJCQkJICBzbGljZV9zZXQpOworCQkJYnJlYWs7CisJCWNhc2UgREJVRl9TMl9C
SVQ6CisJCQlyZXQgPSByZXQgJiYgaW50ZWxfZGJ1Zl9zbGljZV9zZXQoZGV2X3ByaXYsCisJCQkJ
CQkJICBEQlVGX0NUTF9TMiwKKwkJCQkJCQkgIHNsaWNlX3NldCk7CisJCQlicmVhazsKKwkJZGVm
YXVsdDoKKwkJCU1JU1NJTkdfQ0FTRShzbGljZV9iaXQpOworCQl9CisJfQogCiAJaWYgKHJldCkK
IAkJZGV2X3ByaXYtPndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXMgPSByZXFfc2xpY2VzOwpA
QCAtNDI4Niw0MCArNDI5NSwyMSBAQCB2b2lkIGljbF9kYnVmX3NsaWNlc191cGRhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgdm9pZCBpY2xfZGJ1Zl9lbmFi
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCUk5MTVfV1JJVEUoREJV
Rl9DVExfUzEsIEk5MTVfUkVBRChEQlVGX0NUTF9TMSkgfCBEQlVGX1BPV0VSX1JFUVVFU1QpOwot
CUk5MTVfV1JJVEUoREJVRl9DVExfUzIsIEk5MTVfUkVBRChEQlVGX0NUTF9TMikgfCBEQlVGX1BP
V0VSX1JFUVVFU1QpOwotCVBPU1RJTkdfUkVBRChEQlVGX0NUTF9TMik7Ci0KLQl1ZGVsYXkoMTAp
OwotCi0JaWYgKCEoSTkxNV9SRUFEKERCVUZfQ1RMX1MxKSAmIERCVUZfUE9XRVJfU1RBVEUpIHx8
Ci0JICAgICEoSTkxNV9SRUFEKERCVUZfQ1RMX1MyKSAmIERCVUZfUE9XRVJfU1RBVEUpKQotCQlE
Uk1fRVJST1IoIkRCdWYgcG93ZXIgZW5hYmxlIHRpbWVvdXRcbiIpOwotCWVsc2UKLQkJLyoKLQkJ
ICogRklYTUU6IGZvciBub3cgcHJldGVuZCB0aGF0IHdlIG9ubHkgaGF2ZSAxIHNsaWNlLCBzZWUK
LQkJICogaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19udW0oKS4KLQkJICovCi0JCWRldl9wcml2
LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzID0gMTsKKwkvKgorCSAqIEp1c3QgcG93ZXIg
dXAgMSBzbGljZSwgd2Ugd2lsbAorCSAqIGZpZ3VyZSBvdXQgbGF0ZXIgd2hpY2ggc2xpY2VzIHdl
IGhhdmUgYW5kIHdoYXQgd2UgbmVlZC4KKwkgKi8KKwlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5l
bmFibGVkX3NsaWNlcyA9IERCVUZfUzFfQklUOworCWljbF9wcm9ncmFtX2RidWZfc2xpY2VzKGRl
dl9wcml2KTsKIH0KIAogc3RhdGljIHZvaWQgaWNsX2RidWZfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMSwgSTkxNV9S
RUFEKERCVUZfQ1RMX1MxKSAmIH5EQlVGX1BPV0VSX1JFUVVFU1QpOwotCUk5MTVfV1JJVEUoREJV
Rl9DVExfUzIsIEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiB+REJVRl9QT1dFUl9SRVFVRVNUKTsK
LQlQT1NUSU5HX1JFQUQoREJVRl9DVExfUzIpOwotCi0JdWRlbGF5KDEwKTsKLQotCWlmICgoSTkx
NV9SRUFEKERCVUZfQ1RMX1MxKSAmIERCVUZfUE9XRVJfU1RBVEUpIHx8Ci0JICAgIChJOTE1X1JF
QUQoREJVRl9DVExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkpCi0JCURSTV9FUlJPUigiREJ1ZiBw
b3dlciBkaXNhYmxlIHRpbWVvdXQhXG4iKTsKLQllbHNlCi0JCS8qCi0JCSAqIEZJWE1FOiBmb3Ig
bm93IHByZXRlbmQgdGhhdCB0aGUgZmlyc3Qgc2xpY2UgaXMgYWx3YXlzCi0JCSAqIGVuYWJsZWQs
IHNlZSBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bSgpLgotCQkgKi8KLQkJZGV2X3ByaXYt
PndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXMgPSAxOworCS8qCisJICogRGlzYWJsZSBhbGwg
c2xpY2VzCisJICovCisJZGV2X3ByaXYtPndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGljZXMgPSAw
OworCWljbF9wcm9ncmFtX2RidWZfc2xpY2VzKGRldl9wcml2KTsKIH0KIAogc3RhdGljIHZvaWQg
aWNsX21idXNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oCmluZGV4
IDFkYTA0ZjNlMGZiMy4uYjcwNTdkNjhhZDc4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuaApAQCAtMzExLDggKzMxMSwxMCBAQCBp
bnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF9hc3luYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAlmb3IgKCh3ZikgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldCgoaTkxNSksIChkb21haW4p
KTsgKHdmKTsgXAogCSAgICAgaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfYXN5bmMoKGk5MTUpLCAo
ZG9tYWluKSwgKHdmKSksICh3ZikgPSAwKQogCitpbnQgaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGljbF9kYnVmX3NsaWNlc191
cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICAgIHU4IHJlcV9z
bGljZXMpOwordm9pZCBpY2xfcHJvZ3JhbV9kYnVmX3NsaWNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpOwogCiB2b2lkIGNodl9waHlfcG93ZXJnYXRlX2xhbmVzKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgICBib29sIG92ZXJyaWRlLCB1bnNpZ25lZCBp
bnQgbWFzayk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCA4ZDcwNDk3OTJkNjIuLmNjMmIy
ZTU1ZWE2NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC01MSw2ICs1MSw3IEBACiAjaW5j
bHVkZSAiZGlzcGxheS9pbnRlbF9idy5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfY2RjbGsu
aCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCIKKyNpbmNsdWRlICJk
aXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2Rw
LmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9mYmRldi5oIgogI2luY2x1ZGUgImRpc3BsYXkv
aW50ZWxfaG90cGx1Zy5oIgpAQCAtMjU5MSw2ICsyNTkyLDEwIEBAIHN0YXRpYyBpbnQgaW50ZWxf
cnVudGltZV9yZXN1bWUoc3RydWN0IGRldmljZSAqa2RldikKIAlpZiAoSVNfVkFMTEVZVklFVyhk
ZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCiAJCXJldCA9IHZsdl9yZXN1bWVf
cHJlcGFyZShkZXZfcHJpdiwgdHJ1ZSk7CiAKKwkvKiBXZWlyZCBoYWNrIHRvIGZpeCBJQ0wgaGFy
ZHdhcmUgYnVnLCBhcyBpdCByZXNldHMgREJVRiBzbGljZXMgcmVnICovCisJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPT0gMTEpCisJCWljbF9wcm9ncmFtX2RidWZfc2xpY2VzKGRldl9wcml2KTsK
KwogCWludGVsX3VuY29yZV9ydW50aW1lX3Jlc3VtZSgmZGV2X3ByaXYtPnVuY29yZSk7CiAKIAlp
bnRlbF9ydW50aW1lX3BtX2VuYWJsZV9pbnRlcnJ1cHRzKGRldl9wcml2KTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oCmluZGV4IDE3NzlmNjAwZmNmYi4uODE3MmFiNzMxZGJjIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmgKQEAgLTc5OSw3ICs3OTksNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgc2tsX2Rk
Yl9lbnRyeV9lcXVhbChjb25zdCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZTEsCiB9CiAKIHN0cnVj
dCBza2xfZGRiX2FsbG9jYXRpb24gewotCXU4IGVuYWJsZWRfc2xpY2VzOyAvKiBHRU4xMSBoYXMg
Y29uZmlndXJhYmxlIDIgc2xpY2VzICovCisJdTggZW5hYmxlZF9zbGljZXM7ICAgLyogQml0bWFz
ayBvZiBjdXJyZW50bHkgZW5hYmxlZCBEQnVmIHNsaWNlcyAqLwogfTsKIAogc3RydWN0IHNrbF9k
ZGJfdmFsdWVzIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCmluZGV4IGRhM2U5YjU3NTJhYy4uYWEy
ZDk0MmRmYzZjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKQEAgLTYxNCw3ICs2MTQsOCBAQCBz
dGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2RldmljZV9pbmZvIGludGVsX2NoZXJyeXZpZXdfaW5m
byA9IHsKIAkuaGFzX2d0X3VjID0gMSwgXAogCS5kaXNwbGF5Lmhhc19oZGNwID0gMSwgXAogCS5k
aXNwbGF5Lmhhc19pcGMgPSAxLCBcCi0JLmRkYl9zaXplID0gODk2CisJLmRkYl9zaXplID0gODk2
LCBcCisJLnN1cHBvcnRlZF9zbGljZXMgPSAxCiAKICNkZWZpbmUgU0tMX1BMQVRGT1JNIFwKIAlH
RU45X0ZFQVRVUkVTLCBcCkBAIC02NTAsNiArNjUxLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBp
bnRlbF9kZXZpY2VfaW5mbyBpbnRlbF9za3lsYWtlX2d0NF9pbmZvID0gewogCUdFTig5KSwgXAog
CS5pc19scCA9IDEsIFwKIAkuZGlzcGxheS5oYXNfaG90cGx1ZyA9IDEsIFwKKwkuc3VwcG9ydGVk
X3NsaWNlcyA9IDEsIFwKIAkuZW5naW5lX21hc2sgPSBCSVQoUkNTMCkgfCBCSVQoVkNTMCkgfCBC
SVQoQkNTMCkgfCBCSVQoVkVDUzApLCBcCiAJLnBpcGVfbWFzayA9IEJJVChQSVBFX0EpIHwgQklU
KFBJUEVfQikgfCBCSVQoUElQRV9DKSwgXAogCS5oYXNfNjRiaXRfcmVsb2MgPSAxLCBcCkBAIC03
MzcsNiArNzM5LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyBpbnRl
bF9jb2ZmZWVsYWtlX2d0M19pbmZvID0gewogCUdFTjlfRkVBVFVSRVMsIFwKIAlHRU4oMTApLCBc
CiAJLmRkYl9zaXplID0gMTAyNCwgXAorCS5zdXBwb3J0ZWRfc2xpY2VzID0gMSwgXAogCS5kaXNw
bGF5Lmhhc19kc2MgPSAxLCBcCiAJLmhhc19jb2hlcmVudF9nZ3R0ID0gZmFsc2UsIFwKIAlHTEtf
Q09MT1JTCkBAIC03NzMsNiArNzc2LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZp
Y2VfaW5mbyBpbnRlbF9jYW5ub25sYWtlX2luZm8gPSB7CiAJfSwgXAogCUdFTigxMSksIFwKIAku
ZGRiX3NpemUgPSAyMDQ4LCBcCisJLnN1cHBvcnRlZF9zbGljZXMgPSAyLCBcCiAJLmhhc19sb2dp
Y2FsX3JpbmdfZWxzcSA9IDEsIFwKIAkuY29sb3IgPSB7IC5kZWdhbW1hX2x1dF9zaXplID0gMzMs
IC5nYW1tYV9sdXRfc2l6ZSA9IDI2MjE0NSB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4
IGE0ZTVhNGFlMzg4NS4uNDZjNTYwNjU0OTAzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlZy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAg
LTc3NTQsOSArNzc1NCwxMSBAQCBlbnVtIHsKICNkZWZpbmUgRElTUF9BUkJfQ1RMMglfTU1JTygw
eDQ1MDA0KQogI2RlZmluZSAgRElTUF9EQVRBX1BBUlRJVElPTl81XzYJKDEgPDwgNikKICNkZWZp
bmUgIERJU1BfSVBDX0VOQUJMRQkJKDEgPDwgMykKLSNkZWZpbmUgREJVRl9DVEwJX01NSU8oMHg0
NTAwOCkKLSNkZWZpbmUgREJVRl9DVExfUzEJX01NSU8oMHg0NTAwOCkKLSNkZWZpbmUgREJVRl9D
VExfUzIJX01NSU8oMHg0NEZFOCkKKyNkZWZpbmUgREJVRl9TMV9CSVQJCQlCSVQoMCkKKyNkZWZp
bmUgREJVRl9TMl9CSVQJCQlCSVQoMSkKKyNkZWZpbmUgREJVRl9DVEwJCQlfTU1JTygweDQ1MDA4
KQorI2RlZmluZSBEQlVGX0NUTF9TMQkJCV9NTUlPKDB4NDUwMDgpCisjZGVmaW5lIERCVUZfQ1RM
X1MyCQkJX01NSU8oMHg0NEZFOCkKICNkZWZpbmUgIERCVUZfUE9XRVJfUkVRVUVTVAkJKDEgPDwg
MzEpCiAjZGVmaW5lICBEQlVGX1BPV0VSX1NUQVRFCQkoMSA8PCAzMCkKICNkZWZpbmUgR0VON19N
U0dfQ1RMCV9NTUlPKDB4NDUwMTApCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9kZXZpY2VfaW5mby5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2lu
Zm8uaAppbmRleCA0YmRmOGE2Y2ZiNDcuLmJhMzRlMWE1YzU5MSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9kZXZpY2VfaW5mby5oCkBAIC0xODAsNiArMTgwLDcgQEAgc3RydWN0IGludGVs
X2RldmljZV9pbmZvIHsKIAl9IGRpc3BsYXk7CiAKIAl1MTYgZGRiX3NpemU7IC8qIGluIGJsb2Nr
cyAqLworCXU4IHN1cHBvcnRlZF9zbGljZXM7IC8qIG51bWJlciBvZiBEQnVmIHNsaWNlcyAqLwog
CiAJLyogUmVnaXN0ZXIgb2Zmc2V0cyBmb3IgdGhlIHZhcmlvdXMgZGlzcGxheSBwaXBlcyBhbmQg
dHJhbnNjb2RlcnMgKi8KIAlpbnQgcGlwZV9vZmZzZXRzW0k5MTVfTUFYX1RSQU5TQ09ERVJTXTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IDA1YmE5ZTFiZDI0Ny4uZDlmNzYwODI2NDliIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTM1OTQsMjQgKzM1OTQsMjAgQEAgYm9vbCBpbGtf
ZGlzYWJsZV9scF93bShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXJldHVybiBfaWxrX2Rpc2Fi
bGVfbHBfd20oZGV2X3ByaXYsIFdNX0RJUlRZX0xQX0FMTCk7CiB9CiAKLXN0YXRpYyB1OCBpbnRl
bF9lbmFibGVkX2RidWZfc2xpY2VzX251bShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitzdGF0aWMgdTggaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JdTggZW5hYmxlZF9zbGljZXM7Ci0KLQkvKiBTbGljZSAx
IHdpbGwgYWx3YXlzIGJlIGVuYWJsZWQgKi8KLQllbmFibGVkX3NsaWNlcyA9IDE7CisJdTggZW5h
YmxlZF9zbGljZXMgPSAwOwogCiAJLyogR2VuIHByaW9yIHRvIEdFTjExIGhhdmUgb25seSBvbmUg
REJ1ZiBzbGljZSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCi0JCXJldHVybiBl
bmFibGVkX3NsaWNlczsKKwkJcmV0dXJuIERCVUZfUzFfQklUOwogCi0JLyoKLQkgKiBGSVhNRTog
Zm9yIG5vdyB3ZSdsbCBvbmx5IGV2ZXIgdXNlIDEgc2xpY2U7IHByZXRlbmQgdGhhdCB3ZSBoYXZl
Ci0JICogb25seSB0aGF0IDEgc2xpY2UgZW5hYmxlZCB1bnRpbCB3ZSBoYXZlIGEgcHJvcGVyIHdh
eSBmb3Igb24tZGVtYW5kCi0JICogdG9nZ2xpbmcgb2YgdGhlIHNlY29uZCBzbGljZS4KLQkgKi8K
LQlpZiAoMCAmJiBJOTE1X1JFQUQoREJVRl9DVExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkKLQkJ
ZW5hYmxlZF9zbGljZXMrKzsKKwkvKiBDaGVjayBpZiBzZWNvbmQgREJ1ZiBzbGljZSBpcyBlbmFi
bGVkICovCisJaWYgKEk5MTVfUkVBRChEQlVGX0NUTF9TMSkgJiBEQlVGX1BPV0VSX1NUQVRFKQor
CQllbmFibGVkX3NsaWNlcyB8PSBEQlVGX1MxX0JJVDsKKworCWlmIChJOTE1X1JFQUQoREJVRl9D
VExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkKKwkJZW5hYmxlZF9zbGljZXMgfD0gREJVRl9TMl9C
SVQ7CiAKIAlyZXR1cm4gZW5hYmxlZF9zbGljZXM7CiB9CkBAIC0zODIwLDM2ICszODE2LDM4IEBA
IHN0YXRpYyB1MTYgaW50ZWxfZ2V0X2RkYl9zaXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJCSAgICAgIGNvbnN0IGludCBudW1fYWN0aXZlLAogCQkJICAgICAgc3RydWN0
IHNrbF9kZGJfYWxsb2NhdGlvbiAqZGRiKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9t
b2RlICphZGp1c3RlZF9tb2RlOwotCXU2NCB0b3RhbF9kYXRhX2J3OwogCXUxNiBkZGJfc2l6ZSA9
IElOVEVMX0lORk8oZGV2X3ByaXYpLT5kZGJfc2l6ZTsKLQogCVdBUk5fT04oZGRiX3NpemUgPT0g
MCk7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQogCQlyZXR1cm4gZGRiX3NpemUg
LSA0OyAvKiA0IGJsb2NrcyBmb3IgYnlwYXNzIHBhdGggYWxsb2NhdGlvbiAqLwogCi0JYWRqdXN0
ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwotCXRvdGFsX2RhdGFfYncg
PSB0b3RhbF9kYXRhX3JhdGUgKiBkcm1fbW9kZV92cmVmcmVzaChhZGp1c3RlZF9tb2RlKTsKKwly
ZXR1cm4gZGRiX3NpemU7Cit9CiAKLQkvKgotCSAqIDEyR0IvcyBpcyBtYXhpbXVtIEJXIHN1cHBv
cnRlZCBieSBzaW5nbGUgREJ1ZiBzbGljZS4KLQkgKgotCSAqIEZJWE1FIGRidWYgc2xpY2UgY29k
ZSBpcyBicm9rZW46Ci0JICogLSBtdXN0IHdhaXQgZm9yIHBsYW5lcyB0byBzdG9wIHVzaW5nIHRo
ZSBzbGljZSBiZWZvcmUgcG93ZXJpbmcgaXQgb2ZmCi0JICogLSBwbGFuZSBzdHJhZGRsaW5nIGJv
dGggc2xpY2VzIGlzIGlsbGVnYWwgaW4gbXVsdGktcGlwZSBzY2VuYXJpb3MKLQkgKiAtIHNob3Vs
ZCB2YWxpZGF0ZSB3ZSBzdGF5IHdpdGhpbiB0aGUgaHcgYmFuZHdpZHRoIGxpbWl0cwotCSAqLwot
CWlmICgwICYmIChudW1fYWN0aXZlID4gMSB8fCB0b3RhbF9kYXRhX2J3ID49IEdCcHMoMTIpKSkg
ewotCQlkZGItPmVuYWJsZWRfc2xpY2VzID0gMjsKLQl9IGVsc2UgewotCQlkZGItPmVuYWJsZWRf
c2xpY2VzID0gMTsKLQkJZGRiX3NpemUgLz0gMjsKLQl9CisvKgorICogQ2FsY3VsYXRlIGluaXRp
YWwgREJ1ZiBzbGljZSBvZmZzZXQsIGJhc2VkIG9uIHNsaWNlIHNpemUKKyAqIGFuZCBtYXNrKGku
ZSBpZiBzbGljZSBzaXplIGlzIDEwMjQgYW5kIHNlY29uZCBzbGljZSBpcyBlbmFibGVkCisgKiBv
ZmZzZXQgd291bGQgYmUgMTAyNCkKKyAqLworc3RhdGljIHUzMiBza2xfZ2V0X2ZpcnN0X2RidWZf
c2xpY2Vfb2Zmc2V0KHUzMiBkYnVmX3NsaWNlX21hc2ssCisJCQkJCSAgIHUzMiBzbGljZV9zaXpl
LCB1MzIgZGRiX3NpemUpCit7CisJdTMyIG9mZnNldCA9IDA7CiAKLQlyZXR1cm4gZGRiX3NpemU7
CisJaWYgKCFkYnVmX3NsaWNlX21hc2spCisJCXJldHVybiAwOworCisJb2Zmc2V0ID0gKGZmcyhk
YnVmX3NsaWNlX21hc2spIC0gMSkgKiBzbGljZV9zaXplOworCisJV0FSTl9PTihvZmZzZXQgPj0g
ZGRiX3NpemUpOworCXJldHVybiBvZmZzZXQ7CiB9CiAKK3N0YXRpYyB1MzIgaTkxNV9hbGxvd2Vk
X2RidWZfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkJICAgICAg
aW50IHBpcGUsIHUzMiBhY3RpdmVfcGlwZXMsCisJCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOworCiBzdGF0aWMgdm9pZAogc2tsX2RkYl9nZXRfcGlw
ZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
CQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC0zODY1
LDcgKzM4NjMsMTQgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdTMyIHBpcGVfd2lkdGggPSAwLCB0b3RhbF93
aWR0aCA9IDAsIHdpZHRoX2JlZm9yZV9waXBlID0gMDsKIAllbnVtIHBpcGUgZm9yX3BpcGUgPSB0
b19pbnRlbF9jcnRjKGZvcl9jcnRjKS0+cGlwZTsKIAl1MTYgZGRiX3NpemU7CisJdTMyIGRkYl9y
YW5nZV9zaXplOwogCXUzMiBpOworCXUzMiBkYnVmX3NsaWNlX21hc2s7CisJdTMyIGFjdGl2ZV9w
aXBlczsKKwl1MzIgb2Zmc2V0OworCXUzMiBzbGljZV9zaXplOworCXUzMiB0b3RhbF9zbGljZV9t
YXNrOworCXUzMiBzdGFydCwgZW5kOwogCiAJaWYgKFdBUk5fT04oIXN0YXRlKSB8fCAhY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlKSB7CiAJCWFsbG9jLT5zdGFydCA9IDA7CkBAIC0zODc0LDE0ICszODc5
LDIzIEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJfQogCi0JaWYgKGludGVsX3N0YXRlLT5h
Y3RpdmVfcGlwZV9jaGFuZ2VzKQorCWlmIChpbnRlbF9zdGF0ZS0+YWN0aXZlX3BpcGVfY2hhbmdl
cykgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGludGVsX3N0YXRlLT5hY3RpdmVfcGlwZXMp
OwotCWVsc2UKKwkJYWN0aXZlX3BpcGVzID0gaW50ZWxfc3RhdGUtPmFjdGl2ZV9waXBlczsKKwl9
IGVsc2UgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGRldl9wcml2LT5hY3RpdmVfcGlwZXMp
OworCQlhY3RpdmVfcGlwZXMgPSBkZXZfcHJpdi0+YWN0aXZlX3BpcGVzOworCX0KIAogCWRkYl9z
aXplID0gaW50ZWxfZ2V0X2RkYl9zaXplKGRldl9wcml2LCBjcnRjX3N0YXRlLCB0b3RhbF9kYXRh
X3JhdGUsCiAJCQkJICAgICAgKm51bV9hY3RpdmUsIGRkYik7CiAKKwlEUk1fREVCVUdfS01TKCJH
b3QgdG90YWwgZGRiIHNpemUgJWRcbiIsIGRkYl9zaXplKTsKKworCXNsaWNlX3NpemUgPSBkZGJf
c2l6ZSAvIElOVEVMX0lORk8oZGV2X3ByaXYpLT5zdXBwb3J0ZWRfc2xpY2VzOworCisJRFJNX0RF
QlVHX0tNUygiR290IERCdWYgc2xpY2Ugc2l6ZSAlZFxuIiwgc2xpY2Vfc2l6ZSk7CisKIAkvKgog
CSAqIElmIHRoZSBzdGF0ZSBkb2Vzbid0IGNoYW5nZSB0aGUgYWN0aXZlIENSVEMncyBvciB0aGVy
ZSBpcyBubwogCSAqIG1vZGVzZXQgcmVxdWVzdCwgdGhlbiB0aGVyZSdzIG5vIG5lZWQgdG8gcmVj
YWxjdWxhdGU7CkBAIC0zODk5LDIwICszOTEzLDY5IEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2Nh
dGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47
CiAJfQogCisJLyoKKwkgKiBHZXQgYWxsb3dlZCBEQnVmIHNsaWNlcyBmb3IgY29ycmVzcG9uZGVu
dCBwaXBlIGFuZCBwbGF0Zm9ybS4KKwkgKi8KKwlkYnVmX3NsaWNlX21hc2sgPSBpOTE1X2FsbG93
ZWRfZGJ1Zl9tYXNrKGRldl9wcml2LCBmb3JfcGlwZSwKKwkJCQkJCSBhY3RpdmVfcGlwZXMsIGNy
dGNfc3RhdGUpOworCisJRFJNX0RFQlVHX0tNUygiREJ1ZiBzbGljZSBtYXNrICV4IHBpcGUgJWQg
YWN0aXZlIHBpcGVzICV4XG4iLAorCQkgICAgICBkYnVmX3NsaWNlX21hc2ssCisJCSAgICAgIGZv
cl9waXBlLCBhY3RpdmVfcGlwZXMpOworCisJLyoKKwkgKiBGaWd1cmUgb3V0IGF0IHdoaWNoIERC
dWYgc2xpY2Ugd2Ugc3RhcnQsIGkuZSBpZiB3ZSBzdGFydCBhdCBEYnVmIFMyCisJICogYW5kIHNs
aWNlIHNpemUgaXMgMTAyNCwgdGhlIG9mZnNldCB3b3VsZCBiZSAxMDI0CisJICovCisJb2Zmc2V0
ID0gc2tsX2dldF9maXJzdF9kYnVmX3NsaWNlX29mZnNldChkYnVmX3NsaWNlX21hc2ssCisJCQkJ
CQkgc2xpY2Vfc2l6ZSwgZGRiX3NpemUpOworCisJLyoKKwkgKiBGaWd1cmUgb3V0IHRvdGFsIHNp
emUgb2YgYWxsb3dlZCBEQnVmIHNsaWNlcywgd2hpY2ggaXMgYmFzaWNhbGx5CisJICogYSBudW1i
ZXIgb2YgYWxsb3dlZCBzbGljZXMgZm9yIHRoYXQgcGlwZSBtdWx0aXBsaWVkIGJ5IHNsaWNlIHNp
emUuCisJICogSW5zaWRlIG9mIHRoaXMKKwkgKiByYW5nZSBkZGIgZW50cmllcyBhcmUgc3RpbGwg
YWxsb2NhdGVkIGluIHByb3BvcnRpb24gdG8gZGlzcGxheSB3aWR0aC4KKwkgKi8KKwlkZGJfcmFu
Z2Vfc2l6ZSA9IGh3ZWlnaHQ4KGRidWZfc2xpY2VfbWFzaykgKiBzbGljZV9zaXplOworCiAJLyoK
IAkgKiBXYXRlcm1hcmsvZGRiIHJlcXVpcmVtZW50IGhpZ2hseSBkZXBlbmRzIHVwb24gd2lkdGgg
b2YgdGhlCiAJICogZnJhbWVidWZmZXIsIFNvIGluc3RlYWQgb2YgYWxsb2NhdGluZyBEREIgZXF1
YWxseSBhbW9uZyBwaXBlcwogCSAqIGRpc3RyaWJ1dGUgRERCIGJhc2VkIG9uIHJlc29sdXRpb24v
d2lkdGggb2YgdGhlIGRpc3BsYXkuCiAJICovCisJdG90YWxfc2xpY2VfbWFzayA9IGRidWZfc2xp
Y2VfbWFzazsKIAlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShpbnRlbF9zdGF0ZSwg
Y3J0YywgY3J0Y19zdGF0ZSwgaSkgewogCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAq
YWRqdXN0ZWRfbW9kZSA9CiAJCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAkJZW51
bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCQlpbnQgaGRpc3BsYXksIHZkaXNwbGF5OworCQl1
MzIgcGlwZV9kYnVmX3NsaWNlX21hc2sgPSBpOTE1X2FsbG93ZWRfZGJ1Zl9tYXNrKGRldl9wcml2
LAorCQkJCQkJCQkgIHBpcGUsCisJCQkJCQkJCSAgYWN0aXZlX3BpcGVzLAorCQkJCQkJCQkgIGNy
dGNfc3RhdGUpOwogCiAJCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQogCQkJY29udGludWU7
CiAKKwkJLyoKKwkJICogQWNjb3JkaW5nIHRvIEJTcGVjIHBpcGUgY2FuIHNoYXJlIG9uZSBkYnVm
IHNsaWNlIHdpdGggYW5vdGhlcgorCQkgKiBwaXBlcyBvciBwaXBlIGNhbiB1c2UgbXVsdGlwbGUg
ZGJ1ZnMsIGluIGJvdGggY2FzZXMgd2UKKwkJICogYWNjb3VudCBmb3Igb3RoZXIgcGlwZXMgb25s
eSBpZiB0aGV5IGhhdmUgZXhhY3RseSBzYW1lIG1hc2suCisJCSAqIEhvd2V2ZXIgd2UgbmVlZCB0
byBhY2NvdW50IGhvdyBtYW55IHNsaWNlcyB3ZSBzaG91bGQgZW5hYmxlCisJCSAqIGluIHRvdGFs
LgorCQkgKi8KKwkJdG90YWxfc2xpY2VfbWFzayB8PSBwaXBlX2RidWZfc2xpY2VfbWFzazsKKwor
CQkvKgorCQkgKiBEbyBub3QgYWNjb3VudCBwaXBlcyB1c2luZyBvdGhlciBzbGljZSBzZXRzCisJ
CSAqIGx1Y2tpbHkgYXMgb2YgY3VycmVudCBCU3BlYyBzbGljZSBzZXRzIGRvIG5vdCBwYXJ0aWFs
bHkKKwkJICogaW50ZXJzZWN0KHBpcGVzIHNoYXJlIGVpdGhlciBzYW1lIG9uZSBzbGljZSBvciBz
YW1lIHNsaWNlIHNldAorCQkgKiBpLmUgbm8gcGFydGlhbCBpbnRlcnNlY3Rpb24pLCBzbyBpdCBp
cyBlbm91Z2ggdG8gY2hlY2sgZm9yCisJCSAqIGVxdWFsaXR5IGZvciBub3cuCisJCSAqLworCQlp
ZiAoZGJ1Zl9zbGljZV9tYXNrICE9IHBpcGVfZGJ1Zl9zbGljZV9tYXNrKQorCQkJY29udGludWU7
CisKIAkJZHJtX21vZGVfZ2V0X2h2X3RpbWluZyhhZGp1c3RlZF9tb2RlLCAmaGRpc3BsYXksICZ2
ZGlzcGxheSk7CiAJCXRvdGFsX3dpZHRoICs9IGhkaXNwbGF5OwogCkBAIC0zOTIyLDggKzM5ODUs
MTkgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQlwaXBlX3dpZHRoID0gaGRpc3BsYXk7CiAJfQogCi0JYWxs
b2MtPnN0YXJ0ID0gZGRiX3NpemUgKiB3aWR0aF9iZWZvcmVfcGlwZSAvIHRvdGFsX3dpZHRoOwot
CWFsbG9jLT5lbmQgPSBkZGJfc2l6ZSAqICh3aWR0aF9iZWZvcmVfcGlwZSArIHBpcGVfd2lkdGgp
IC8gdG90YWxfd2lkdGg7CisJZGRiLT5lbmFibGVkX3NsaWNlcyA9IHRvdGFsX3NsaWNlX21hc2s7
CisKKwlzdGFydCA9IGRkYl9yYW5nZV9zaXplICogd2lkdGhfYmVmb3JlX3BpcGUgLyB0b3RhbF93
aWR0aDsKKwllbmQgPSBkZGJfcmFuZ2Vfc2l6ZSAqICh3aWR0aF9iZWZvcmVfcGlwZSArIHBpcGVf
d2lkdGgpIC8gdG90YWxfd2lkdGg7CisKKwlhbGxvYy0+c3RhcnQgPSBvZmZzZXQgKyBzdGFydDsK
KwlhbGxvYy0+ZW5kID0gb2Zmc2V0ICsgZW5kOworCisJRFJNX0RFQlVHX0tNUygiUGlwZSAlZCBk
ZGIgJWQtJWRcbiIsIGZvcl9waXBlLAorCQkgICAgICBhbGxvYy0+c3RhcnQsIGFsbG9jLT5lbmQp
OworCURSTV9ERUJVR19LTVMoIkVuYWJsZWQgZGRiIHNsaWNlcyBtYXNrICV4IG51bSBzdXBwb3J0
ZWQgJWRcbiIsCisJCSAgICAgIGRkYi0+ZW5hYmxlZF9zbGljZXMsCisJCSAgICAgIElOVEVMX0lO
Rk8oZGV2X3ByaXYpLT5zdXBwb3J0ZWRfc2xpY2VzKTsKIH0KIAogc3RhdGljIGludCBza2xfY29t
cHV0ZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CkBAIC00MDQ0LDcgKzQxMTgsOCBAQCB2b2lkIHNrbF9waXBlX2RkYl9nZXRfaHdfc3RhdGUoc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCiB2b2lkIHNrbF9kZGJfZ2V0X2h3X3N0YXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgc3RydWN0IHNrbF9kZGJfYWxsb2NhdGlv
biAqZGRiIC8qIG91dCAqLykKIHsKLQlkZGItPmVuYWJsZWRfc2xpY2VzID0gaW50ZWxfZW5hYmxl
ZF9kYnVmX3NsaWNlc19udW0oZGV2X3ByaXYpOworCWRkYi0+ZW5hYmxlZF9zbGljZXMgPSBpbnRl
bF9lbmFibGVkX2RidWZfc2xpY2VzKGRldl9wcml2KTsKKwlEUk1fREVCVUdfS01TKCJHb3QgaHcg
ZGJ1ZiBzbGljZXMgbWFzayAleFxuIiwgZGRiLT5lbmFibGVkX3NsaWNlcyk7CiB9CiAKIC8qCkBA
IC00MTcyLDYgKzQyNDcsMjQxIEBAIHNrbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXJldHVybiB0b3RhbF9kYXRhX3Jh
dGU7CiB9CiAKK3N0YXRpYyB1aW50X2ZpeGVkXzE2XzE2X3QKK2ljbF9waXBlX2Rvd25zY2FsZV9h
bW91bnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJdTMy
IHNyY193LCBzcmNfaCwgZHN0X3csIGRzdF9oOworCXVpbnRfZml4ZWRfMTZfMTZfdCBmcF93X3Jh
dGlvLCBmcF9oX3JhdGlvOworCXVpbnRfZml4ZWRfMTZfMTZfdCBkb3duc2NhbGVfaCwgZG93bnNj
YWxlX3c7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPSAm
Y3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKKworCXNyY193ID0gY3J0Y19zdGF0ZS0+cGlw
ZV9zcmNfdzsKKwlzcmNfaCA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX2g7CisJZHN0X3cgPSBhZGp1
c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5OworCWRzdF9oID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y192
ZGlzcGxheTsKKworCWZwX3dfcmF0aW8gPSBkaXZfZml4ZWQxNihzcmNfdywgZHN0X3cpOworCWZw
X2hfcmF0aW8gPSBkaXZfZml4ZWQxNihzcmNfaCwgZHN0X2gpOworCWRvd25zY2FsZV93ID0gbWF4
X2ZpeGVkMTYoZnBfd19yYXRpbywgdTMyX3RvX2ZpeGVkMTYoMSkpOworCWRvd25zY2FsZV9oID0g
bWF4X2ZpeGVkMTYoZnBfaF9yYXRpbywgdTMyX3RvX2ZpeGVkMTYoMSkpOworCisJcmV0dXJuIG11
bF9maXhlZDE2KGRvd25zY2FsZV93LCBkb3duc2NhbGVfaCk7Cit9CisKK3N0YXRpYyB1aW50X2Zp
eGVkXzE2XzE2X3QKK2ljbF9nZXRfcGlwZV9yYXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZTsKKwljb25zdCBz
dHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpkcm1fcGxhbmVfc3RhdGU7CisJdWludF9maXhlZF8xNl8x
Nl90IHBpcGVfZG93bnNjYWxlLCBwaXBlX3JhdGlvOworCXVpbnRfZml4ZWRfMTZfMTZfdCBtYXhf
ZG93bnNjYWxlID0gdTMyX3RvX2ZpeGVkMTYoMSk7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisKKwlpZiAoIWNydGNfc3Rh
dGUtPnVhcGkuZW5hYmxlKQorCQlyZXR1cm4gbWF4X2Rvd25zY2FsZTsKKworCWRybV9hdG9taWNf
Y3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZShwbGFuZSwgZHJtX3BsYW5lX3N0YXRlLCAm
Y3J0Y19zdGF0ZS0+dWFwaSkgeworCQl1aW50X2ZpeGVkXzE2XzE2X3QgcGxhbmVfZG93bnNjYWxl
OworCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0KKwkJCXRv
X2ludGVsX3BsYW5lX3N0YXRlKGRybV9wbGFuZV9zdGF0ZSk7CisKKwkJaWYgKCFpbnRlbF93bV9w
bGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKKwkJCWNvbnRpbnVlOworCisJ
CXBsYW5lX2Rvd25zY2FsZSA9IHNrbF9wbGFuZV9kb3duc2NhbGVfYW1vdW50KGNydGNfc3RhdGUs
IHBsYW5lX3N0YXRlKTsKKworCQlEUk1fREVCVUdfS01TKCJQbGFuZSAlZCBkb3duc2NhbGUgYW1v
dW50ICVkLiVkXG4iLAorCQkJICAgICAgdG9faW50ZWxfcGxhbmUocGxhbmUpLT5pZCwKKwkJCSAg
ICAgIHBsYW5lX2Rvd25zY2FsZS52YWwgPj4gMTYsCisJCQkgICAgICBwbGFuZV9kb3duc2NhbGUu
dmFsICYgMHhmZmZmKTsKKworCQltYXhfZG93bnNjYWxlID0gbWF4X2ZpeGVkMTYocGxhbmVfZG93
bnNjYWxlLCBtYXhfZG93bnNjYWxlKTsKKwl9CisKKworCXBpcGVfZG93bnNjYWxlID0gaWNsX3Bp
cGVfZG93bnNjYWxlX2Ftb3VudChjcnRjX3N0YXRlKTsKKworCURSTV9ERUJVR19LTVMoIlBpcGUg
JWQgZG93bnNjYWxlIGFtb3VudCAlZC4lZFxuIiwKKwkJICAgICAgIGNydGMtPnBpcGUsIHBpcGVf
ZG93bnNjYWxlLnZhbCA+PiAxNiwKKwkJICAgICAgIHBpcGVfZG93bnNjYWxlLnZhbCAmIDB4ZmZm
Zik7CisKKwlwaXBlX2Rvd25zY2FsZSA9IG11bF9maXhlZDE2KHBpcGVfZG93bnNjYWxlLCBtYXhf
ZG93bnNjYWxlKTsKKworCS8qCisJICogQ29udmVydCByZXN1bHQgdG8gcGVyY2VudGFnZTogZ2V0
IHRoZSBhY3R1YWwgcmF0aW8gaW5zdGVhZCBvZiByYXRlLAorCSAqIHRoZW4gbXVsdGlwbHkgYnkg
MTAwIHRvIGdldCBwZXJjZW50YWdlLgorCSAqLworCXBpcGVfcmF0aW8gPSB1MzJfdG9fZml4ZWQx
NigxMDAgKiBkaXZfcm91bmRfdXBfdTMyX2ZpeGVkMTYoMSwgcGlwZV9kb3duc2NhbGUpKTsKKwor
CURSTV9ERUJVR19LTVMoIlBpcGUgJWQgcmF0aW8gJWQuJWRcbiIsIGNydGMtPnBpcGUsCisJCSAg
ICAgIHBpcGVfcmF0aW8udmFsID4+IDE2LCBwaXBlX3JhdGlvLnZhbCAmIDB4ZmZmZik7CisKKwly
ZXR1cm4gcGlwZV9yYXRpbzsKK30KKworc3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSB7CisJ
dTMyIGRidWZfbWFza1tJOTE1X01BWF9QSVBFU107CisJdTMyIGFjdGl2ZV9waXBlczsKK307CisK
KworI2RlZmluZSBJQ0xfUElQRV9BX0RCVUZfU0xJQ0VTKERidWYxKSAgXAorCXsgeyBEYnVmMSwg
MCwgMCwgMCB9LCBCSVQoUElQRV9BKSB9CisjZGVmaW5lIElDTF9QSVBFX0JfREJVRl9TTElDRVMo
RGJ1ZjEpICBcCisJeyB7IDAsIERidWYxLCAwLCAwIH0sIEJJVChQSVBFX0IpIH0KKyNkZWZpbmUg
SUNMX1BJUEVfQ19EQlVGX1NMSUNFUyhEYnVmMSkgIFwKKwl7IHsgMCwgMCwgRGJ1ZjEsIDAgfSwg
QklUKFBJUEVfQykgfQorI2RlZmluZSBJQ0xfUElQRV9EX0RCVUZfU0xJQ0VTKERidWYxKSAgXAor
CXsgeyAwLCAwLCAwLCBEYnVmMSB9LCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0FC
X0RCVUZfU0xJQ0VTKERidWYxLCBEYnVmMikgICBcCisJeyB7IERidWYxLCBEYnVmMiwgMCwgMCB9
LCBCSVQoUElQRV9BKSB8IEJJVChQSVBFX0IpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQkNfREJVRl9T
TElDRVMoRGJ1ZjEsIERidWYyKSAgIFwKKwl7IHsgMCwgRGJ1ZjEsIERidWYyLCAwIH0sIEJJVChQ
SVBFX0IpIHwgQklUKFBJUEVfQykgfQorI2RlZmluZSBJQ0xfUElQRV9CRF9EQlVGX1NMSUNFUyhE
YnVmMSwgRGJ1ZjIpICAgXAorCXsgeyAwLCBEYnVmMSwgMCwgRGJ1ZjIgfSwgQklUKFBJUEVfQikg
fCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0FDX0RCVUZfU0xJQ0VTKERidWYxLCBE
YnVmMikgICBcCisJeyB7IERidWYxLCAwLCBEYnVmMiwgMCB9LCBCSVQoUElQRV9BKSB8IEJJVChQ
SVBFX0MpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQURfREJVRl9TTElDRVMoRGJ1ZjEsIERidWYyKSAg
IFwKKwl7IHsgRGJ1ZjEsIDAsIDAsIERidWYyIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfRCkg
fQorI2RlZmluZSBJQ0xfUElQRV9DRF9EQlVGX1NMSUNFUyhEYnVmMSwgRGJ1ZjIpICAgXAorCXsg
eyAwLCAwLCBEYnVmMSwgRGJ1ZjIgfSwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSB9CisjZGVm
aW5lIElDTF9QSVBFX0FCQ19EQlVGX1NMSUNFUyhEYnVmMSwgRGJ1ZjIsIERidWYzKSAgXAorCXsg
eyBEYnVmMSwgRGJ1ZjIsIERidWYzLCAwIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfCBC
SVQoUElQRV9DKSB9CisjZGVmaW5lIElDTF9QSVBFX0FDRF9EQlVGX1NMSUNFUyhEYnVmMSwgRGJ1
ZjIsIERidWYzKSAgXAorCXsgeyBEYnVmMSwgMCwgRGJ1ZjIsIERidWYzIH0sIEJJVChQSVBFX0Ep
IHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0JDRF9EQlVG
X1NMSUNFUyhEYnVmMSwgRGJ1ZjIsIERidWYzKSAgXAorCXsgeyAwLCBEYnVmMSwgRGJ1ZjIsIERi
dWYzIH0sIEJJVChQSVBFX0IpIHwgQklUKFBJUEVfQykgfCBCSVQoUElQRV9EKSB9CisjZGVmaW5l
IElDTF9QSVBFX0FCRF9EQlVGX1NMSUNFUyhEYnVmMSwgRGJ1ZjIsIERidWYzKSAgXAorCXsgeyBE
YnVmMSwgRGJ1ZjIsIDAsIERidWYzIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfCBCSVQo
UElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0FCQ19EQlVGX1NMSUNFUyhEYnVmMSwgRGJ1ZjIs
IERidWYzKSAgXAorCXsgeyBEYnVmMSwgRGJ1ZjIsIERidWYzLCAwIH0sIEJJVChQSVBFX0EpIHwg
QklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSB9CisjZGVmaW5lIElDTF9QSVBFX0FCQ0RfREJVRl9T
TElDRVMoRGJ1ZjEsIERidWYyLCBEYnVmMywgRGJ1ZjQpICBcCisJeyB7IERidWYxLCBEYnVmMiwg
RGJ1ZjMsIERidWY0IH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfCBcCisJCQkJCSAgQklU
KFBJUEVfQykgfCBCSVQoUElQRV9EKSB9CisKKy8qCisgKiBUYWJsZSB0YWtlbiBmcm9tIEJzcGVj
IDEyNzE2CisgKiBQaXBlcyBkbyBoYXZlIHNvbWUgcHJlZmVycmVkIERCdWYgc2xpY2UgYWZmaW5p
dHksCisgKiBwbHVzIHRoZXJlIGFyZSBzb21lIGhhcmRjb2RlZCByZXF1aXJlbWVudHMgb24gaG93
CisgKiB0aG9zZSBzaG91bGQgYmUgZGlzdHJpYnV0ZWQgZm9yIG11bHRpcGlwZSBzY2VuYXJpb3Mu
CisgKiBGb3IgbW9yZSBEQnVmIHNsaWNlcyBhbGdvcml0aG0gY2FuIGdldCBldmVuIG1vcmUgbWVz
c3kKKyAqIGFuZCBsZXNzIHJlYWRhYmxlLCBzbyBkZWNpZGVkIHRvIHVzZSBhIHRhYmxlIGFsbW9z
dAorICogYXMgaXMgZnJvbSBCU3BlYyBpdHNlbGYgLSB0aGF0IHdheSBpdCBpcyBhdCBsZWFzdCBl
YXNpZXIKKyAqIHRvIGNvbXBhcmUsIGNoYW5nZSBhbmQgY2hlY2suCisgKi8KK3N0YXRpYyBzdHJ1
Y3QgZGJ1Zl9zbGljZV9jb25mX2VudHJ5IGljbF9hbGxvd2VkX2RidWZzW10gPSB7Cit7IHsgMCwg
MCwgMCwgMCB9LCAwIH0sCitJQ0xfUElQRV9BX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUIHwgREJV
Rl9TMl9CSVQpLCAgLyogcGlwZSByYXRpbyA8IDg4LjggKi8KK0lDTF9QSVBFX0FfREJVRl9TTElD
RVMoREJVRl9TMV9CSVQpLCAgICAgICAgICAgICAgICAvKiBmb3IgcGlwZSByYXRpbyA+PSA4OC44
ICovCitJQ0xfUElQRV9CX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUIHwgREJVRl9TMl9CSVQpLCAg
LyogcGlwZSByYXRpbyA8IDg4LjggKi8KK0lDTF9QSVBFX0JfREJVRl9TTElDRVMoREJVRl9TMV9C
SVQpLCAgICAgICAgICAgICAgICAvKiBmb3IgcGlwZSByYXRpbyA+PSA4OC44ICovCitJQ0xfUElQ
RV9DX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUIHwgREJVRl9TMl9CSVQpLCAgLyogcGlwZSByYXRp
byA8IDg4LjggKi8KK0lDTF9QSVBFX0NfREJVRl9TTElDRVMoREJVRl9TMl9CSVQpLCAgICAgICAg
ICAgICAgICAvKiBmb3IgcGlwZSByYXRpbyA+PSA4OC44ICovCitJQ0xfUElQRV9BQl9EQlVGX1NM
SUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfQUNfREJVRl9TTElDRVMo
REJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0JDX0RCVUZfU0xJQ0VTKERCVUZf
UzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9BQkNfREJVRl9TTElDRVMoREJVRl9TMV9C
SVQsIERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCit9OworCisvKgorICogVGFibGUgdGFrZW4g
ZnJvbSBCc3BlYyA0OTI1NQorICogUGlwZXMgZG8gaGF2ZSBzb21lIHByZWZlcnJlZCBEQnVmIHNs
aWNlIGFmZmluaXR5LAorICogcGx1cyB0aGVyZSBhcmUgc29tZSBoYXJkY29kZWQgcmVxdWlyZW1l
bnRzIG9uIGhvdworICogdGhvc2Ugc2hvdWxkIGJlIGRpc3RyaWJ1dGVkIGZvciBtdWx0aXBpcGUg
c2NlbmFyaW9zLgorICogRm9yIG1vcmUgREJ1ZiBzbGljZXMgYWxnb3JpdGhtIGNhbiBnZXQgZXZl
biBtb3JlIG1lc3N5CisgKiBhbmQgbGVzcyByZWFkYWJsZSwgc28gZGVjaWRlZCB0byB1c2UgYSB0
YWJsZSBhbG1vc3QKKyAqIGFzIGlzIGZyb20gQlNwZWMgaXRzZWxmIC0gdGhhdCB3YXkgaXQgaXMg
YXQgbGVhc3QgZWFzaWVyCisgKiB0byBjb21wYXJlLCBjaGFuZ2UgYW5kIGNoZWNrLgorICovCitz
dGF0aWMgc3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSB0Z2xfYWxsb3dlZF9kYnVmc1tdID0g
eworeyB7IDAsIDAsIDAsIDAgfSwgMCB9LAorSUNMX1BJUEVfQV9EQlVGX1NMSUNFUyhEQlVGX1Mx
X0JJVCB8IERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0JfREJVRl9TTElDRVMoREJVRl9TMV9CSVQg
fCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9DX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUIHwgREJV
Rl9TMl9CSVQpLAorSUNMX1BJUEVfRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCB8IERCVUZfUzJf
QklUKSwKK0lDTF9QSVBFX0FCX0RCVUZfU0xJQ0VTKERCVUZfUzJfQklULCBEQlVGX1MxX0JJVCks
CitJQ0xfUElQRV9BQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNM
X1BJUEVfQkNfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBF
X0FEX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9CRF9E
QlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfQ0RfREJVRl9T
TElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCRF9EQlVGX1NMSUNF
UyhEQlVGX1MxX0JJVCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCQ19E
QlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9Q
SVBFX0FDRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQsIERCVUZfUzJfQklU
KSwKK0lDTF9QSVBFX0JDRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQsIERC
VUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCQ0RfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZf
UzFfQklULCBEQlVGX1MyX0JJVCwgREJVRl9TMl9CSVQpLAorfTsKKworLyoKKyAqIFRoaXMgZnVu
Y3Rpb24gZmluZHMgYW4gZW50cnkgd2l0aCBzYW1lIGVuYWJsZWQgcGlwZSBjb25maWd1cmF0aW9u
IGFuZAorICogcmV0dXJucyBjb3JyZXNwb25kZW50IERCdWYgc2xpY2UgbWFzayBhcyBzdGF0ZWQg
aW4gQlNwZWMgZm9yIHBhcnRpY3VsYXIKKyAqIHBsYXRmb3JtLgorICovCitzdGF0aWMgdTMyIGlj
bF9hbGxvd2VkX2RidWZfbWFzayhpbnQgcGlwZSwKKwkJCQkgdTMyIGFjdGl2ZV9waXBlcywKKwkJ
CQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaW50IGk7
CisJdWludF9maXhlZF8xNl8xNl90IHBpcGVfcmF0aW87CisKKwkvKgorCSAqIENhbGN1bGF0ZSBw
aXBlIHJhdGlvIGFzIHN0YXRlZCBpbiBCU3BlYyAyODY5MgorCSAqLworCXBpcGVfcmF0aW8gPSBp
Y2xfZ2V0X3BpcGVfcmF0aW8oY3J0Y19zdGF0ZSk7CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlf
U0laRShpY2xfYWxsb3dlZF9kYnVmcyk7IGkrKykgeworCQlpZiAoaWNsX2FsbG93ZWRfZGJ1ZnNb
aV0uYWN0aXZlX3BpcGVzID09IGFjdGl2ZV9waXBlcykgeworCQkJaWYgKGh3ZWlnaHQzMihhY3Rp
dmVfcGlwZXMpID09IDEpIHsKKwkJCQkvKgorCQkJCSAqIEFjY29yZGluZyB0byBCU3BlYyAxMjcx
NjogaWYgcmF0aW8gPj0gODguOAorCQkJCSAqIGFsd2F5cyB1c2Ugc2luZ2xlIGRidWYgc2xpY2Uu
CisJCQkJICovCisJCQkJaWYgKHBpcGVfcmF0aW8udmFsID49IGRpdl9maXhlZDE2KDg4OCwgMTAp
LnZhbCkKKwkJCQkJKytpOworCQkJfQorCQkJcmV0dXJuIGljbF9hbGxvd2VkX2RidWZzW2ldLmRi
dWZfbWFza1twaXBlXTsKKwkJfQorCX0KKwlyZXR1cm4gMDsKK30KKworLyoKKyAqIFRoaXMgZnVu
Y3Rpb24gZmluZHMgYW4gZW50cnkgd2l0aCBzYW1lIGVuYWJsZWQgcGlwZSBjb25maWd1cmF0aW9u
IGFuZAorICogcmV0dXJucyBjb3JyZXNwb25kZW50IERCdWYgc2xpY2UgbWFzayBhcyBzdGF0ZWQg
aW4gQlNwZWMgZm9yIHBhcnRpY3VsYXIKKyAqIHBsYXRmb3JtLgorICovCitzdGF0aWMgdTMyIHRn
bF9hbGxvd2VkX2RidWZfbWFzayhpbnQgcGlwZSwKKwkJCQkgdTMyIGFjdGl2ZV9waXBlcywKKwkJ
CQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaW50IGk7
CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRSh0Z2xfYWxsb3dlZF9kYnVmcyk7IGkrKykg
eworCQlpZiAodGdsX2FsbG93ZWRfZGJ1ZnNbaV0uYWN0aXZlX3BpcGVzID09IGFjdGl2ZV9waXBl
cykKKwkJCXJldHVybiB0Z2xfYWxsb3dlZF9kYnVmc1tpXS5kYnVmX21hc2tbcGlwZV07CisJfQor
CXJldHVybiAwOworfQorCit1MzIgaTkxNV9hbGxvd2VkX2RidWZfbWFzayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgICBpbnQgcGlwZSwgdTMyIGFjdGl2ZV9waXBlcywK
KwkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWlm
IChJU19HRU4oZGV2X3ByaXYsIDExKSkKKwkJcmV0dXJuIGljbF9hbGxvd2VkX2RidWZfbWFzayhw
aXBlLAorCQkJCQkgICAgIGFjdGl2ZV9waXBlcywKKwkJCQkJICAgICBjcnRjX3N0YXRlKTsKKwll
bHNlIGlmIChJU19HRU4oZGV2X3ByaXYsIDEyKSkKKwkJcmV0dXJuIHRnbF9hbGxvd2VkX2RidWZf
bWFzayhwaXBlLAorCQkJCQkgICAgIGFjdGl2ZV9waXBlcywKKwkJCQkJICAgICBjcnRjX3N0YXRl
KTsKKwkvKgorCSAqIEZvciBhbnl0aGluZyBlbHNlIGp1c3QgcmV0dXJuIG9uZSBzbGljZSB5ZXQu
CisJICogU2hvdWxkIGJlIGV4dGVuZGVkIGZvciBvdGhlciBwbGF0Zm9ybXMuCisJICovCisJcmV0
dXJuIERCVUZfUzFfQklUOworfQorCiBzdGF0aWMgdTY0CiBpY2xfZ2V0X3RvdGFsX3JlbGF0aXZl
X2RhdGFfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgdTY0
ICpwbGFuZV9kYXRhX3JhdGUpCi0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeA==

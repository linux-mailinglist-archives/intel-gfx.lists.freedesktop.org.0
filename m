Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8C4D2124CD4
	for <lists+intel-gfx@lfdr.de>; Wed, 18 Dec 2019 17:11:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3EF566E8B8;
	Wed, 18 Dec 2019 16:11:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8B18F6E882
 for <intel-gfx@lists.freedesktop.org>; Wed, 18 Dec 2019 16:11:39 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Dec 2019 08:11:39 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,330,1571727600"; d="scan'208";a="218189641"
Received: from ideak-desk.fi.intel.com ([10.237.72.183])
 by orsmga003.jf.intel.com with ESMTP; 18 Dec 2019 08:11:37 -0800
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 18 Dec 2019 18:10:56 +0200
Message-Id: <20191218161105.30638-7-imre.deak@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20191218161105.30638-1-imre.deak@intel.com>
References: <20191218161105.30638-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/15] drm/i915/tgl: Gen-12 render decompression
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Nanley G Chery <nanley.g.chery@intel.com>,
 Lucas De Marchi <lucas.demarchi@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpHZW4tMTIgZGlzcGxheSBkZWNvbXByZXNzaW9uIG9wZXJhdGVzIG9uIFktdGlsZWQgY29tcHJl
c3NlZCBtYWluIHN1cmZhY2UuClRoZSBDQ1MgaXMgbGluZWFyIGFuZCBoYXMgNCBiaXRzIG9mIG1l
dGFkYXRhIGZvciBlYWNoIG1haW4gc3VyZmFjZSBjYWNoZQpsaW5lIHBhaXIsIGEgc2l6ZSByYXRp
byBvZiAxOjI1Ni4gR2VuLTEyIGRpc3BsYXkgZGVjb21wcmVzc2lvbiBpcwppbmNvbXBhdGlibGUg
d2l0aCBidWZmZXJzIGNvbXByZXNzZWQgYnkgZWFybGllciBHUFVzLCBzbyBtYWtlIHVzZSBvZiBh
IG5ldwptb2RpZmllciB0byBpZGVudGlmeSBnZW4tMTIgY29tcHJlc3Npb24uIEFub3RoZXIgbm90
YWJsZSBjaGFuZ2UgaXMgdGhhdApyZW5kZXIgZGVjb21wcmVzc2lvbiBpcyBzdXBwb3J0ZWQgb24g
YWxsIHBsYW5lcyBleGNlcHQgY3Vyc29yIGFuZCBvbiBhbGwKcGlwZXMuIFN0YXJ0IGJ5IGFkZGlu
ZyByZW5kZXIgZGVjb21wcmVzc2lvbiBzdXBwb3J0IGZvciBbQSxYXUJHUjg4OCBwaXhlbApmb3Jt
YXRzLgoKdjI6IEZpeCBjaGVja3BhdGNoIHdhcm5pbmdzIChMdWNhcykKdjM6ClJlYmFzZSwgZGlz
YWJsZSBjb2xvciBjbGVhciwgc3R5bGluZyBjaGFuZ2VzIGFuZCBtb2RpZnkKaW50ZWxfdGlsZV93
aWR0aF9ieXRlcyBhbmQgaW50ZWxfdGlsZV9oZWlnaHQgdG8gaGFuZGxlIGxpbmVhciBDQ1MKdjQ6
Ci0gVXNlIGZvcm1hdCBibG9jayBkZXNjcmlwdG9ycyBhbmQgdGhlIGk5MTUgc3BlY2lmaWMgZnVu
YyB0byBnZXQgdGhlCiAgc3Vic2FtcGxpbmcgZm9yIGVhY2ggY29sb3IgcGxhbmUuCi0gVXNlIGhl
bHBlcnMgdG8gY29udmVydCBiZXR3ZWVuIENDUyBhbmQgbWFpbiBwbGFuZXMuCgpDYzogVmlsbGUg
U3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6IE1hdHQgUm9wZXIg
PG1hdHRoZXcuZC5yb3BlckBpbnRlbC5jb20+CkNjOiBOYW5sZXkgRyBDaGVyeSA8bmFubGV5Lmcu
Y2hlcnlAaW50ZWwuY29tPgpDYzogSmFzb24gRWtzdHJhbmQgPGphc29uQGpsZWtzdHJhbmQubmV0
PgpTaWduZWQtb2ZmLWJ5OiBEaGluYWthcmFuIFBhbmRpeWFuIDxkaGluYWthcmFuLnBhbmRpeWFu
QGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTHVjYXMgRGUgTWFyY2hpIDxsdWNhcy5kZW1hcmNo
aUBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEltcmUgRGVhayA8aW1yZS5kZWFrQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyB8IDE4
NSArKysrKysrKysrKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nwcml0ZS5jICB8ICAyMyArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAg
ICAgICAgICAgIHwgICAxICsKIDMgZmlsZXMgY2hhbmdlZCwgMTY5IGluc2VydGlvbnMoKyksIDQw
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMKaW5kZXggNmJkYTM5N2FlNjc3Li42NDFlYTI0NTM5ZWIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xOTQxLDYgKzE5NDEsMTYgQEAg
c3RhdGljIGJvb2wgaXNfY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LCBpbnQgcGxhbmUpCiAJcmV0dXJuIHBsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAy
OwogfQogCitzdGF0aWMgYm9vbCBpc19nZW4xMl9jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQor
eworCXJldHVybiBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19D
Q1M7Cit9CisKK3N0YXRpYyBib29sIGlzX2dlbjEyX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQoreworCXJldHVybiBpc19nZW4xMl9jY3NfbW9k
aWZpZXIoZmItPm1vZGlmaWVyKSAmJiBpc19jY3NfcGxhbmUoZmIsIHBsYW5lKTsKK30KKwogc3Rh
dGljIGJvb2wgaXNfYXV4X3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBp
bnQgcGxhbmUpCiB7CiAJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQpAQCAtMTk1
Nyw2ICsxOTY3LDE0IEBAIHN0YXRpYyBpbnQgbWFpbl90b19jY3NfcGxhbmUoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBtYWluX3BsYW5lKQogCXJldHVybiBmYi0+Zm9ybWF0
LT5udW1fcGxhbmVzIC8gMiArIG1haW5fcGxhbmU7CiB9CiAKK3N0YXRpYyBpbnQgY2NzX3RvX21h
aW5fcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUp
Cit7CisJV0FSTl9PTighaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikgfHwKKwkJY2NzX3Bs
YW5lIDwgZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIpOworCisJcmV0dXJuIGNjc19wbGFuZSAt
IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyOworfQorCiAvKiBSZXR1cm4gZWl0aGVyIHRoZSBt
YWluIHBsYW5lJ3MgQ0NTIG9yIC0gaWYgbm90IGEgQ0NTIEZCIC0gVVYgcGxhbmUgKi8KIHN0YXRp
YyBpbnQKIGludGVsX21haW5fdG9fYXV4X3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkKQEAgLTE5ODUsNiArMjAwMywxMCBAQCBpbnRlbF90aWxl
X3dpZHRoX2J5dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3Jf
cGxhbmUpCiAJCWlmIChpc19jY3NfcGxhbmUoZmIsIGNvbG9yX3BsYW5lKSkKIAkJCXJldHVybiAx
Mjg7CiAJCS8qIGZhbGwgdGhyb3VnaCAqLworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURf
R0VOMTJfUkNfQ0NTOgorCQlpZiAoaXNfY2NzX3BsYW5lKGZiLCBjb2xvcl9wbGFuZSkpCisJCQly
ZXR1cm4gNjQ7CisJCS8qIGZhbGwgdGhyb3VnaCAqLwogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lf
VElMRUQ6CiAJCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpIHx8IEhBU18xMjhfQllURV9ZX1RJTElO
RyhkZXZfcHJpdikpCiAJCQlyZXR1cm4gMTI4OwpAQCAtMjAxOCw2ICsyMDQwLDkgQEAgaW50ZWxf
dGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNv
bG9yX3BsYW5lKQogc3RhdGljIHVuc2lnbmVkIGludAogaW50ZWxfdGlsZV9oZWlnaHQoY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIHsKKwlpZiAoaXNf
Z2VuMTJfY2NzX3BsYW5lKGZiLCBjb2xvcl9wbGFuZSkpCisJCXJldHVybiAxOworCiAJcmV0dXJu
IGludGVsX3RpbGVfc2l6ZSh0b19pOTE1KGZiLT5kZXYpKSAvCiAJCWludGVsX3RpbGVfd2lkdGhf
Ynl0ZXMoZmIsIGNvbG9yX3BsYW5lKTsKIH0KQEAgLTIxMTgsNiArMjE0Myw4IEBAIHN0YXRpYyB1
bnNpZ25lZCBpbnQgaW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsCiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCiAJCQlyZXR1cm4gMjU2
ICogMTAyNDsKIAkJcmV0dXJuIDA7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4x
Ml9SQ19DQ1M6CisJCXJldHVybiAxNiAqIDEwMjQ7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9DQ1M6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgogCWNhc2UgSTkx
NV9GT1JNQVRfTU9EX1lfVElMRUQ6CkBAIC0yMzEwLDkgKzIzMzcsMTAgQEAgc3RhdGljIHUzMiBp
bnRlbF9hZGp1c3RfdGlsZV9vZmZzZXQoaW50ICp4LCBpbnQgKnksCiAJcmV0dXJuIG5ld19vZmZz
ZXQ7CiB9CiAKLXN0YXRpYyBib29sIGlzX3N1cmZhY2VfbGluZWFyKHU2NCBtb2RpZmllciwgaW50
IGNvbG9yX3BsYW5lKQorc3RhdGljIGJvb2wgaXNfc3VyZmFjZV9saW5lYXIoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIHsKLQlyZXR1cm4gbW9kaWZp
ZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSOworCXJldHVybiBmYi0+bW9kaWZpZXIgPT0gRFJN
X0ZPUk1BVF9NT0RfTElORUFSIHx8CisJICAgICAgIGlzX2dlbjEyX2Njc19wbGFuZShmYiwgY29s
b3JfcGxhbmUpOwogfQogCiBzdGF0aWMgdTMyIGludGVsX2FkanVzdF9hbGlnbmVkX29mZnNldChp
bnQgKngsIGludCAqeSwKQEAgLTIzMjcsNyArMjM1NSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfYWRq
dXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAogCiAJV0FSTl9PTihuZXdfb2Zmc2V0
ID4gb2xkX29mZnNldCk7CiAKLQlpZiAoIWlzX3N1cmZhY2VfbGluZWFyKGZiLT5tb2RpZmllciwg
Y29sb3JfcGxhbmUpKSB7CisJaWYgKCFpc19zdXJmYWNlX2xpbmVhcihmYiwgY29sb3JfcGxhbmUp
KSB7CiAJCXVuc2lnbmVkIGludCB0aWxlX3NpemUsIHRpbGVfd2lkdGgsIHRpbGVfaGVpZ2h0Owog
CQl1bnNpZ25lZCBpbnQgcGl0Y2hfdGlsZXM7CiAKQEAgLTIzOTcsNyArMjQyNSw3IEBAIHN0YXRp
YyB1MzIgaW50ZWxfY29tcHV0ZV9hbGlnbmVkX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJaWYgKGFsaWdubWVudCkKIAkJYWxpZ25tZW50LS07CiAKLQlpZiAoIWlz
X3N1cmZhY2VfbGluZWFyKGZiLT5tb2RpZmllciwgY29sb3JfcGxhbmUpKSB7CisJaWYgKCFpc19z
dXJmYWNlX2xpbmVhcihmYiwgY29sb3JfcGxhbmUpKSB7CiAJCXVuc2lnbmVkIGludCB0aWxlX3Np
emUsIHRpbGVfd2lkdGgsIHRpbGVfaGVpZ2h0OwogCQl1bnNpZ25lZCBpbnQgdGlsZV9yb3dzLCB0
aWxlcywgcGl0Y2hfdGlsZXM7CiAKQEAgLTI0OTksNiArMjUyNyw3IEBAIHN0YXRpYyB1bnNpZ25l
ZCBpbnQgaW50ZWxfZmJfbW9kaWZpZXJfdG9fdGlsaW5nKHU2NCBmYl9tb2RpZmllcikKIAkJcmV0
dXJuIEk5MTVfVElMSU5HX1g7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKIAljYXNl
IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX1JDX0NDUzoKIAkJcmV0dXJuIEk5MTVfVElMSU5HX1k7CiAJZGVmYXVsdDoKIAkJ
cmV0dXJuIEk5MTVfVElMSU5HX05PTkU7CkBAIC0yNTE5LDcgKzI1NDgsNyBAQCBzdGF0aWMgdW5z
aWduZWQgaW50IGludGVsX2ZiX21vZGlmaWVyX3RvX3RpbGluZyh1NjQgZmJfbW9kaWZpZXIpCiAg
KiB1cyBhIHJhdGlvIG9mIG9uZSBieXRlIGluIHRoZSBDQ1MgZm9yIGVhY2ggOHgxNiBwaXhlbHMg
aW4gdGhlCiAgKiBtYWluIHN1cmZhY2UuCiAgKi8KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zv
cm1hdF9pbmZvIGNjc19mb3JtYXRzW10gPSB7CitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mb3Jt
YXRfaW5mbyBza2xfY2NzX2Zvcm1hdHNbXSA9IHsKIAl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX1hS
R0I4ODg4LCAuZGVwdGggPSAyNCwgLm51bV9wbGFuZXMgPSAyLAogCSAgLmNwcCA9IHsgNCwgMSwg
fSwgLmhzdWIgPSA4LCAudnN1YiA9IDE2LCB9LAogCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWEJH
Ujg4ODgsIC5kZXB0aCA9IDI0LCAubnVtX3BsYW5lcyA9IDIsCkBAIC0yNTMwLDYgKzI1NTksMjgg
QEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gY2NzX2Zvcm1hdHNbXSA9IHsK
IAkgIC5jcHAgPSB7IDQsIDEsIH0sIC5oc3ViID0gOCwgLnZzdWIgPSAxNiwgLmhhc19hbHBoYSA9
IHRydWUsIH0sCiB9OwogCisvKgorICogR2VuLTEyIGNvbXByZXNzaW9uIHVzZXMgNCBiaXRzIG9m
IENDUyBkYXRhIGZvciBlYWNoIGNhY2hlIGxpbmUgcGFpciBpbiB0aGUKKyAqIG1haW4gc3VyZmFj
ZS4gQW5kIGVhY2ggNjRCIENDUyBjYWNoZSBsaW5lIHJlcHJlc2VudHMgYW4gYXJlYSBvZiA0eDEg
WS10aWxlcworICogaW4gdGhlIG1haW4gc3VyZmFjZS4gV2l0aCA0IGJ5dGUgcGl4ZWxzIGFuZCBl
YWNoIFktdGlsZSBoYXZpbmcgZGltZW5zaW9ucyBvZgorICogMzJ4MzIgcGl4ZWxzLCB0aGUgcmF0
aW8gdHVybnMgb3V0IHRvIDFCIGluIHRoZSBDQ1MgZm9yIGV2ZXJ5IDJ4MzIgcGl4ZWxzIGluCisg
KiB0aGUgbWFpbiBzdXJmYWNlLgorICovCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRf
aW5mbyBnZW4xMl9jY3NfZm9ybWF0c1tdID0geworCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWFJH
Qjg4ODgsIC5kZXB0aCA9IDI0LCAubnVtX3BsYW5lcyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sg
PSB7IDQsIDEgfSwgLmJsb2NrX3cgPSB7IDEsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkg
IC5oc3ViID0gMSwgLnZzdWIgPSAxLCB9LAorCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWEJHUjg4
ODgsIC5kZXB0aCA9IDI0LCAubnVtX3BsYW5lcyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7
IDQsIDEgfSwgLmJsb2NrX3cgPSB7IDEsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5o
c3ViID0gMSwgLnZzdWIgPSAxLCB9LAorCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfQVJHQjg4ODgs
IC5kZXB0aCA9IDMyLCAubnVtX3BsYW5lcyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDQs
IDEgfSwgLmJsb2NrX3cgPSB7IDEsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5oc3Vi
ID0gMSwgLnZzdWIgPSAxLCAuaGFzX2FscGhhID0gdHJ1ZSB9LAorCXsgLmZvcm1hdCA9IERSTV9G
T1JNQVRfQUJHUjg4ODgsIC5kZXB0aCA9IDMyLCAubnVtX3BsYW5lcyA9IDIsCisJICAuY2hhcl9w
ZXJfYmxvY2sgPSB7IDQsIDEgfSwgLmJsb2NrX3cgPSB7IDEsIDIgfSwgLmJsb2NrX2ggPSB7IDEs
IDEgfSwKKwkgIC5oc3ViID0gMSwgLnZzdWIgPSAxLCAuaGFzX2FscGhhID0gdHJ1ZSB9LAorfTsK
Kwogc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gKgogbG9va3VwX2Zvcm1hdF9p
bmZvKGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gZm9ybWF0c1tdLAogCQkgICBpbnQgbnVt
X2Zvcm1hdHMsIHUzMiBmb3JtYXQpCkBAIC0yNTUwLDggKzI2MDEsMTIgQEAgaW50ZWxfZ2V0X2Zv
cm1hdF9pbmZvKGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyICpjbWQpCiAJc3dpdGNoIChj
bWQtPm1vZGlmaWVyWzBdKSB7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJ
Y2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgotCQlyZXR1cm4gbG9va3VwX2Zvcm1h
dF9pbmZvKGNjc19mb3JtYXRzLAotCQkJCQkgIEFSUkFZX1NJWkUoY2NzX2Zvcm1hdHMpLAorCQly
ZXR1cm4gbG9va3VwX2Zvcm1hdF9pbmZvKHNrbF9jY3NfZm9ybWF0cywKKwkJCQkJICBBUlJBWV9T
SVpFKHNrbF9jY3NfZm9ybWF0cyksCisJCQkJCSAgY21kLT5waXhlbF9mb3JtYXQpOworCWNhc2Ug
STkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTOgorCQlyZXR1cm4gbG9va3VwX2Zv
cm1hdF9pbmZvKGdlbjEyX2Njc19mb3JtYXRzLAorCQkJCQkgIEFSUkFZX1NJWkUoZ2VuMTJfY2Nz
X2Zvcm1hdHMpLAogCQkJCQkgIGNtZC0+cGl4ZWxfZm9ybWF0KTsKIAlkZWZhdWx0OgogCQlyZXR1
cm4gTlVMTDsKQEAgLTI1NjAsNyArMjYxNSw4IEBAIGludGVsX2dldF9mb3JtYXRfaW5mbyhjb25z
dCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiAqY21kKQogCiBib29sIGlzX2Njc19tb2RpZmllcih1
NjQgbW9kaWZpZXIpCiB7Ci0JcmV0dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0NDUyB8fAorCXJldHVybiBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9SQ19DQ1MgfHwKKwkgICAgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfQ0NTIHx8CiAJICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9D
Q1M7CiB9CiAKQEAgLTI2MDgsOCArMjY2NCw5IEBAIHN0YXRpYyB1MzIKIGludGVsX2ZiX3N0cmlk
ZV9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9w
bGFuZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGZi
LT5kZXYpOworCXUzMiB0aWxlX3dpZHRoOwogCi0JaWYgKGZiLT5tb2RpZmllciA9PSBEUk1fRk9S
TUFUX01PRF9MSU5FQVIpIHsKKwlpZiAoaXNfc3VyZmFjZV9saW5lYXIoZmIsIGNvbG9yX3BsYW5l
KSkgewogCQl1MzIgbWF4X3N0cmlkZSA9IGludGVsX3BsYW5lX2ZiX21heF9zdHJpZGUoZGV2X3By
aXYsCiAJCQkJCQkJICAgZmItPmZvcm1hdC0+Zm9ybWF0LAogCQkJCQkJCSAgIGZiLT5tb2RpZmll
cik7CkBAIC0yNjE4LDEzICsyNjc1LDE0IEBAIGludGVsX2ZiX3N0cmlkZV9hbGlnbm1lbnQoY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIAkJICogVG8g
bWFrZSByZW1hcHBpbmcgd2l0aCBsaW5lYXIgZ2VuZXJhbGx5IGZlYXNpYmxlCiAJCSAqIHdlIG5l
ZWQgdGhlIHN0cmlkZSB0byBiZSBwYWdlIGFsaWduZWQuCiAJCSAqLwotCQlpZiAoZmItPnBpdGNo
ZXNbY29sb3JfcGxhbmVdID4gbWF4X3N0cmlkZSkKKwkJaWYgKGZiLT5waXRjaGVzW2NvbG9yX3Bs
YW5lXSA+IG1heF9zdHJpZGUgJiYgIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQogCQkJ
cmV0dXJuIGludGVsX3RpbGVfc2l6ZShkZXZfcHJpdik7CiAJCWVsc2UKIAkJCXJldHVybiA2NDsK
LQl9IGVsc2UgewotCQl1MzIgdGlsZV93aWR0aCA9IGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoZmIs
IGNvbG9yX3BsYW5lKTsKKwl9CiAKKwl0aWxlX3dpZHRoID0gaW50ZWxfdGlsZV93aWR0aF9ieXRl
cyhmYiwgY29sb3JfcGxhbmUpOworCWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAm
JiBjb2xvcl9wbGFuZSA9PSAwKSB7CiAJCS8qCiAJCSAqIERpc3BsYXkgV0EgIzA1MzE6IHNrbCxi
eHQsa2JsLGdsawogCQkgKgpAQCAtMjYzNCwxMiArMjY5MiwxNiBAQCBpbnRlbF9mYl9zdHJpZGVf
YWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxh
bmUpCiAJCSAqIHJlcXVpcmUgdGhlIGVudGlyZSBmYiB0byBhY2NvbW1vZGF0ZSB0aGF0IHRvIGF2
b2lkCiAJCSAqIHBvdGVudGlhbCBydW50aW1lIGVycm9ycyBhdCBwbGFuZSBjb25maWd1cmF0aW9u
IHRpbWUuCiAJCSAqLwotCQlpZiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJiBpc19jY3NfbW9kaWZp
ZXIoZmItPm1vZGlmaWVyKSAmJgotCQkgICAgY29sb3JfcGxhbmUgPT0gMCAmJiBmYi0+d2lkdGgg
PiAzODQwKQorCQlpZiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJiBmYi0+d2lkdGggPiAzODQwKQor
CQkJdGlsZV93aWR0aCAqPSA0OworCQkvKgorCQkgKiBUaGUgbWFpbiBzdXJmYWNlIHBpdGNoIG11
c3QgYmUgcGFkZGVkIHRvIGEgbXVsdGlwbGUgb2YgZm91cgorCQkgKiB0aWxlIHdpZHRocy4KKwkJ
ICovCisJCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCiAJCQl0aWxlX3dpZHRo
ICo9IDQ7Ci0KLQkJcmV0dXJuIHRpbGVfd2lkdGg7CiAJfQorCXJldHVybiB0aWxlX3dpZHRoOwog
fQogCiBib29sIGludGVsX3BsYW5lX2Nhbl9yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQpAQCAtMjcxMCwyNSArMjc3Miw3NCBAQCBzdGF0aWMgYm9vbCBp
bnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogCXJldHVybiBzdHJpZGUgPiBtYXhfc3RyaWRlOwogfQogCitzdGF0aWMgdm9p
ZAoraW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKGludCAqaHN1YiwgaW50ICp2c3ViLAor
CQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJICAgICAgIGlu
dCBjb2xvcl9wbGFuZSkKK3sKKwlpbnQgbWFpbl9wbGFuZTsKKworCWlmIChjb2xvcl9wbGFuZSA9
PSAwKSB7CisJCSpoc3ViID0gMTsKKwkJKnZzdWIgPSAxOworCisJCXJldHVybjsKKwl9CisKKwkv
KgorCSAqIFRPRE86IERlZHVjdCB0aGUgc3Vic2FtcGxpbmcgZnJvbSB0aGUgY2hhciBibG9jayBm
b3IgYWxsIENDUworCSAqIGZvcm1hdHMgYW5kIHBsYW5lcy4KKwkgKi8KKwlpZiAoIWlzX2dlbjEy
X2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpKSB7CisJCSpoc3ViID0gZmItPmZvcm1hdC0+aHN1
YjsKKwkJKnZzdWIgPSBmYi0+Zm9ybWF0LT52c3ViOworCisJCXJldHVybjsKKwl9CisKKwltYWlu
X3BsYW5lID0gY2NzX3RvX21haW5fcGxhbmUoZmIsIGNvbG9yX3BsYW5lKTsKKwkqaHN1YiA9IGRy
bV9mb3JtYXRfaW5mb19ibG9ja193aWR0aChmYi0+Zm9ybWF0LCBjb2xvcl9wbGFuZSkgLworCSAg
ICAgICAgZHJtX2Zvcm1hdF9pbmZvX2Jsb2NrX3dpZHRoKGZiLT5mb3JtYXQsIG1haW5fcGxhbmUp
OworCisJLyoKKwkgKiBUaGUgbWluIHN0cmlkZSBjaGVjayBpbiB0aGUgY29yZSBmcmFtZWJ1ZmZl
cl9jaGVjaygpIGZ1bmN0aW9uCisJICogYXNzdW1lcyB0aGF0IGZvcm1hdC0+aHN1YiBhcHBsaWVz
IHRvIGV2ZXJ5IHBsYW5lIGV4Y2VwdCBmb3IgdGhlCisJICogZmlyc3QgcGxhbmUuIFRoYXQncyBp
bmNvcnJlY3QgZm9yIHRoZSBDQ1MgQVVYIHBsYW5lIG9mIHRoZSBmaXJzdAorCSAqIHBsYW5lLCBi
dXQgZm9yIHRoZSBhYm92ZSBjaGVjayB0byBwYXNzIHdlIG11c3QgZGVmaW5lIHRoZSBibG9jawor
CSAqIHdpZHRoIHdpdGggdGhhdCBzdWJzYW1wbGluZyBhcHBsaWVkIHRvIGl0LiBBZGp1c3QgdGhl
IHdpZHRoIGhlcmUKKwkgKiBhY2NvcmRpbmdseSwgc28gd2UgY2FuIGNhbGN1bGF0ZSB0aGUgYWN0
dWFsIHN1YnNhbXBsaW5nIGZhY3Rvci4KKwkgKi8KKwlpZiAoY29sb3JfcGxhbmUgPT0gMSkKKwkJ
KmhzdWIgKj0gZmItPmZvcm1hdC0+aHN1YjsKKworCSp2c3ViID0gMzI7Cit9CiBzdGF0aWMgaW50
CiBpbnRlbF9mYl9jaGVja19jY3NfeHkoc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCB4
LCBpbnQgeSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiID0gdG9faW50
ZWxfZnJhbWVidWZmZXIoZmIpOwotCWludCBoc3ViID0gZmItPmZvcm1hdC0+aHN1YjsKLQlpbnQg
dnN1YiA9IGZiLT5mb3JtYXQtPnZzdWI7CisJaW50IG1haW5fcGxhbmU7CisJaW50IGhzdWIsIHZz
dWI7CiAJaW50IHRpbGVfd2lkdGgsIHRpbGVfaGVpZ2h0OwogCWludCBjY3NfeCwgY2NzX3k7CiAJ
aW50IG1haW5feCwgbWFpbl95OworCWludCBjY3NfcGxhbmUgPSAxOwogCi0JaW50ZWxfdGlsZV9k
aW1zKGZiLCAxLCAmdGlsZV93aWR0aCwgJnRpbGVfaGVpZ2h0KTsKKwlpZiAoIWlzX2Njc19wbGFu
ZShmYiwgY2NzX3BsYW5lKSkKKwkJcmV0dXJuIDA7CisKKwlpbnRlbF90aWxlX2RpbXMoZmIsIGNj
c19wbGFuZSwgJnRpbGVfd2lkdGgsICZ0aWxlX2hlaWdodCk7CisJaW50ZWxfZmJfcGxhbmVfZ2V0
X3N1YnNhbXBsaW5nKCZoc3ViLCAmdnN1YiwgZmIsIGNjc19wbGFuZSk7CiAKIAl0aWxlX3dpZHRo
ICo9IGhzdWI7CiAJdGlsZV9oZWlnaHQgKj0gdnN1YjsKIAogCWNjc194ID0gKHggKiBoc3ViKSAl
IHRpbGVfd2lkdGg7CiAJY2NzX3kgPSAoeSAqIHZzdWIpICUgdGlsZV9oZWlnaHQ7Ci0JbWFpbl94
ID0gaW50ZWxfZmItPm5vcm1hbFswXS54ICUgdGlsZV93aWR0aDsKLQltYWluX3kgPSBpbnRlbF9m
Yi0+bm9ybWFsWzBdLnkgJSB0aWxlX2hlaWdodDsKKworCW1haW5fcGxhbmUgPSBjY3NfdG9fbWFp
bl9wbGFuZShmYiwgY2NzX3BsYW5lKTsKKwltYWluX3ggPSBpbnRlbF9mYi0+bm9ybWFsW21haW5f
cGxhbmVdLnggJSB0aWxlX3dpZHRoOworCW1haW5feSA9IGludGVsX2ZiLT5ub3JtYWxbbWFpbl9w
bGFuZV0ueSAlIHRpbGVfaGVpZ2h0OwogCiAJLyoKIAkgKiBDQ1MgZG9lc24ndCBoYXZlIGl0cyBv
d24geC95IG9mZnNldCByZWdpc3Rlciwgc28gdGhlIGludHJhIENDUyB0aWxlCkBAIC0yNzM4LDgg
KzI4NDksOCBAQCBpbnRlbF9mYl9jaGVja19jY3NfeHkoc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIsIGludCB4LCBpbnQgeSkKIAkJRFJNX0RFQlVHX0tNUygiQmFkIENDUyB4L3kgKG1haW4gJWQs
JWQgY2NzICVkLCVkKSBmdWxsIChtYWluICVkLCVkIGNjcyAlZCwlZClcbiIsCiAJCQkgICAgICBt
YWluX3gsIG1haW5feSwKIAkJCSAgICAgIGNjc194LCBjY3NfeSwKLQkJCSAgICAgIGludGVsX2Zi
LT5ub3JtYWxbMF0ueCwKLQkJCSAgICAgIGludGVsX2ZiLT5ub3JtYWxbMF0ueSwKKwkJCSAgICAg
IGludGVsX2ZiLT5ub3JtYWxbbWFpbl9wbGFuZV0ueCwKKwkJCSAgICAgIGludGVsX2ZiLT5ub3Jt
YWxbbWFpbl9wbGFuZV0ueSwKIAkJCSAgICAgIHgsIHkpOwogCQlyZXR1cm4gLUVJTlZBTDsKIAl9
CkBAIC0yODEwLDcgKzI5MjEsNyBAQCBpbnRlbF9maWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCQkJICAgICAgdGlsZV9zaXplKTsKIAkJb2Zmc2V0IC89
IHRpbGVfc2l6ZTsKIAotCQlpZiAoIWlzX3N1cmZhY2VfbGluZWFyKGZiLT5tb2RpZmllciwgaSkp
IHsKKwkJaWYgKCFpc19zdXJmYWNlX2xpbmVhcihmYiwgaSkpIHsKIAkJCXVuc2lnbmVkIGludCB0
aWxlX3dpZHRoLCB0aWxlX2hlaWdodDsKIAkJCXVuc2lnbmVkIGludCBwaXRjaF90aWxlczsKIAkJ
CXN0cnVjdCBkcm1fcmVjdCByOwpAQCAtMzQ4OSwxNCArMzYwMCwxNSBAQCBzdGF0aWMgYm9vbCBz
a2xfY2hlY2tfbWFpbl9jY3NfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZQogCQkJCQkgICBpbnQgbWFpbl94LCBpbnQgbWFpbl95LCB1MzIgbWFpbl9vZmZz
ZXQpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7Ci0JaW50IGhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOwotCWludCB2c3ViID0gZmItPmZv
cm1hdC0+dnN1YjsKIAlpbnQgY2NzX3BsYW5lID0gbWFpbl90b19jY3NfcGxhbmUoZmIsIDApOwog
CWludCBhdXhfeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLng7CiAJaW50
IGF1eF95ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueTsKIAl1MzIgYXV4
X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKIAl1
MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIGNjc19wbGFuZSk7CisJaW50
IGhzdWI7CisJaW50IHZzdWI7CiAKKwlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhz
dWIsICZ2c3ViLCBmYiwgY2NzX3BsYW5lKTsKIAl3aGlsZSAoYXV4X29mZnNldCA+PSBtYWluX29m
ZnNldCAmJiBhdXhfeSA8PSBtYWluX3kpIHsKIAkJaW50IHgsIHk7CiAKQEAgLTM2NTcsMTIgKzM3
NjksMTUgQEAgc3RhdGljIGludCBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50IHNyY194ID0gcGxhbmVfc3RhdGUtPnVh
cGkuc3JjLngxID4+IDE2OwogCWludCBzcmNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+
PiAxNjsKLQlpbnQgaHN1YiA9IGZiLT5mb3JtYXQtPmhzdWI7Ci0JaW50IHZzdWIgPSBmYi0+Zm9y
bWF0LT52c3ViOwotCWludCB4ID0gc3JjX3ggLyBoc3ViOwotCWludCB5ID0gc3JjX3kgLyB2c3Vi
OworCWludCBoc3ViOworCWludCB2c3ViOworCWludCB4OworCWludCB5OwogCXUzMiBvZmZzZXQ7
CiAKKwlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgMSk7
CisJeCA9IHNyY194IC8gaHN1YjsKKwl5ID0gc3JjX3kgLyB2c3ViOwogCWludGVsX2FkZF9mYl9v
ZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDEpOwogCW9mZnNldCA9IGludGVsX3BsYW5lX2Nv
bXB1dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMSk7CiAKQEAgLTQxNTgs
NyArNDI3Myw3IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCSAqIFRoZSBzdHJpZGUgaXMgZWl0aGVy
IGV4cHJlc3NlZCBhcyBhIG11bHRpcGxlIG9mIDY0IGJ5dGVzIGNodW5rcyBmb3IKIAkgKiBsaW5l
YXIgYnVmZmVycyBvciBpbiBudW1iZXIgb2YgdGlsZXMgZm9yIHRpbGVkIGJ1ZmZlcnMuCiAJICov
Ci0JaWYgKGZiLT5tb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIpCisJaWYgKGlzX3N1
cmZhY2VfbGluZWFyKGZiLCBjb2xvcl9wbGFuZSkpCiAJCXJldHVybiA2NDsKIAllbHNlIGlmIChk
cm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkKIAkJcmV0dXJuIGludGVsX3RpbGVfaGVp
Z2h0KGZiLCBjb2xvcl9wbGFuZSk7CkBAIC00Mjg2LDYgKzQ0MDEsMTAgQEAgc3RhdGljIHUzMiBz
a2xfcGxhbmVfY3RsX3RpbGluZyh1NjQgZmJfbW9kaWZpZXIpCiAJCXJldHVybiBQTEFORV9DVExf
VElMRURfWTsKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKIAkJcmV0dXJuIFBM
QU5FX0NUTF9USUxFRF9ZIHwgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsK
KwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwkJcmV0dXJuIFBM
QU5FX0NUTF9USUxFRF9ZIHwKKwkJICAgICAgIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lP
Tl9FTkFCTEUgfAorCQkgICAgICAgUExBTkVfQ1RMX0NMRUFSX0NPTE9SX0RJU0FCTEU7CiAJY2Fz
ZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ6CiAJCXJldHVybiBQTEFORV9DVExfVElMRURfWUY7
CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgpAQCAtMTAwMjEsNyArMTAxNDAs
OSBAQCBza3lsYWtlX2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAljYXNlIFBMQU5FX0NUTF9USUxFRF9ZOgogCQlwbGFuZV9jb25maWctPnRpbGluZyA9
IEk5MTVfVElMSU5HX1k7CiAJCWlmICh2YWwgJiBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJ
T05fRU5BQkxFKQotCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NT
OworCQkJZmItPm1vZGlmaWVyID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiA/CisJCQkJSTkx
NV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTIDoKKwkJCQlJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9DQ1M7CiAJCWVsc2UKIAkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9Z
X1RJTEVEOwogCQlicmVhazsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfc3ByaXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nw
cml0ZS5jCmluZGV4IDgzOTQ1MDJiMDkyZC4uNjdhOTAwNTk5MDBmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTU4Myw2ICs1ODMsNyBAQCBza2xf
cHJvZ3JhbV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCWNvbnN0IHN0cnVjdCBk
cm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CiAJdTMy
IHN1cmZfYWRkciA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ub2Zmc2V0
OwogCXUzMiBzdHJpZGUgPSBza2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRlLCBjb2xvcl9wbGFu
ZSk7CisJdTMyIGF1eF9kaXN0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLm9mZnNldCAt
IHN1cmZfYWRkcjsKIAl1MzIgYXV4X3N0cmlkZSA9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3Rh
dGUsIDEpOwogCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CiAJaW50IGNy
dGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKQEAgLTYyNCw4ICs2MjUsMTAgQEAgc2ts
X3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlJOTE1X1dSSVRFX0ZX
KFBMQU5FX1NUUklERShwaXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7CiAJSTkxNV9XUklURV9GVyhQ
TEFORV9QT1MocGlwZSwgcGxhbmVfaWQpLCAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CiAJSTkx
NV9XUklURV9GVyhQTEFORV9TSVpFKHBpcGUsIHBsYW5lX2lkKSwgKHNyY19oIDw8IDE2KSB8IHNy
Y193KTsKLQlJOTE1X1dSSVRFX0ZXKFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwKLQkJ
ICAgICAgKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS5vZmZzZXQgLSBzdXJmX2FkZHIpIHwg
YXV4X3N0cmlkZSk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEyKQorCQlhdXhfZGlz
dCB8PSBhdXhfc3RyaWRlOworCUk5MTVfV1JJVEVfRlcoUExBTkVfQVVYX0RJU1QocGlwZSwgcGxh
bmVfaWQpLCBhdXhfZGlzdCk7CiAKIAlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxh
bmVfaWQpKQogCQlJOTE1X1dSSVRFX0ZXKFBMQU5FX0NVU19DVEwocGlwZSwgcGxhbmVfaWQpLCBw
bGFuZV9zdGF0ZS0+Y3VzX2N0bCk7CkBAIC0yMTAyLDcgKzIxMDUsOCBAQCBzdGF0aWMgaW50IHNr
bF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkgICAgKGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCB8fAogCSAg
ICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCB8fAogCSAgICAgZmIt
Pm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fAotCSAgICAgZmItPm1v
ZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1MpKSB7CisJICAgICBmYi0+bW9k
aWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUyB8fAorCSAgICAgZmItPm1vZGlm
aWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUykpIHsKIAkJRFJNX0RF
QlVHX0tNUygiWS9ZZiB0aWxpbmcgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBtb2RlXG4iKTsKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAJfQpAQCAtMjU3Myw3ICsyNTc3LDggQEAgc3RhdGljIGNvbnN0IHU2
NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3NbXSA9IHsKIAlEUk1fRk9STUFUX01PRF9J
TlZBTElECiB9OwogCi1zdGF0aWMgY29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmll
cnNfbm9jY3NbXSA9IHsKK3N0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlm
aWVyc19jY3NbXSA9IHsKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCiAJ
STkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCiAJSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCiAJRFJN
X0ZPUk1BVF9NT0RfTElORUFSLApAQCAtMjc0NCw2ICsyNzQ5LDcgQEAgc3RhdGljIGJvb2wgZ2Vu
MTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAog
CWNhc2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElM
RUQ6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJcmV0dXJuIGZh
bHNlOwpAQCAtMjc1NCw2ICsyNzYwLDkgQEAgc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0
X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCWNhc2UgRFJNX0ZPUk1B
VF9YQkdSODg4ODoKIAljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CiAJY2FzZSBEUk1fRk9STUFU
X0FCR1I4ODg4OgorCQlpZiAoaXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKKwkJCXJldHVybiB0
cnVlOworCQkvKiBmYWxsIHRocm91Z2ggKi8KIAljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgogCWNh
c2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKIAljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6
CkBAIC0yOTYzLDEzICsyOTcyLDExIEBAIHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJZm9ybWF0cyA9IHNrbF9nZXRfcGxhbmVf
Zm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKIAkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOwog
CisJcGxhbmUtPmhhc19jY3MgPSBza2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwgcGxh
bmVfaWQpOwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7Ci0JCS8qIFRPRE86IElt
cGxlbWVudCBzdXBwb3J0IGZvciBnZW4tMTIgQ0NTIG1vZGlmaWVycyAqLwotCQlwbGFuZS0+aGFz
X2NjcyA9IGZhbHNlOwotCQltb2RpZmllcnMgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJz
X25vY2NzOworCQltb2RpZmllcnMgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2NjczsK
IAkJcGxhbmVfZnVuY3MgPSAmZ2VuMTJfcGxhbmVfZnVuY3M7CiAJfSBlbHNlIHsKLQkJcGxhbmUt
Pmhhc19jY3MgPSBza2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwog
CQlpZiAocGxhbmUtPmhhc19jY3MpCiAJCQltb2RpZmllcnMgPSBza2xfcGxhbmVfZm9ybWF0X21v
ZGlmaWVyc19jY3M7CiAJCWVsc2UKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IGNiYjQ2ODlh
ZjQzMi4uYmJmZWRlYjAwYjdmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlZy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAgLTY4MDAsNiAr
NjgwMCw3IEBAIGVudW0gewogI2RlZmluZSAgIFBMQU5FX0NUTF9ZVVY0MjJfVllVWQkJCSgzIDw8
IDE2KQogI2RlZmluZSAgIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUJKDEg
PDwgMTUpCiAjZGVmaW5lICAgUExBTkVfQ1RMX1RSSUNLTEVfRkVFRF9ESVNBQkxFCSgxIDw8IDE0
KQorI2RlZmluZSAgIFBMQU5FX0NUTF9DTEVBUl9DT0xPUl9ESVNBQkxFCQkoMSA8PCAxMykgLyog
VEdMKyAqLwogI2RlZmluZSAgIFBMQU5FX0NUTF9QTEFORV9HQU1NQV9ESVNBQkxFCQkoMSA8PCAx
MykgLyogUHJlLUdMSyAqLwogI2RlZmluZSAgIFBMQU5FX0NUTF9USUxFRF9NQVNLCQkJKDB4NyA8
PCAxMCkKICNkZWZpbmUgICBQTEFORV9DVExfVElMRURfTElORUFSCQkoMCA8PCAxMCkKLS0gCjIu
MjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

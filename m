Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B301CF6AFD
	for <lists+intel-gfx@lfdr.de>; Sun, 10 Nov 2019 19:58:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F2A4E6E7B2;
	Sun, 10 Nov 2019 18:58:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EA4F96E7A3
 for <intel-gfx@lists.freedesktop.org>; Sun, 10 Nov 2019 18:58:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19151904-1500050 
 for multiple; Sun, 10 Nov 2019 18:58:14 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 10 Nov 2019 18:58:05 +0000
Message-Id: <20191110185806.17413-24-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191110185806.17413-1-chris@chris-wilson.co.uk>
References: <20191110185806.17413-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 24/25] drm/i915/uc: Use an internal buffer for
 firmware images
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2luY2UgdGhlIGxpZmV0aW1lIG9mIHRoZSB1Y19mdyBpcyB2aXJ0dWFsbHkgaWRlbnRpY2FsIHRv
IHRoZSBjdXJyZW50CnBpbm5lZCByYW5nZSwgc2ltcGxpZnkgdGhlIHNldHVwIHRvIGF2b2lkIHVz
aW5nIGEgc3dhcHBhYmxlIHNobWVtIGZpbGUsCmFuZCBqdXN0IHVzZSBhbiBpbnRlcm5hbCBiby4g
VGhlIGltbWVkaWF0ZSBhZHZhbnRhZ2UgaXMgaW4gcmVtb3ZpbmcgdGhlCmV4dHJhIHBpbi91bnBp
biBzdGFnZXMgZHVyaW5nIGluaXQgdGhhdCBhcmUgdmVyeSBkaWZmaWN1bHQgdG8gYmFsYW5jZQph
bG9uZyBlcnJvciBwYXRocy4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9p
bnRlcm5hbC5jIHwgNDMgKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3QuaCAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9zaG1lbS5jICAgIHwgNTEgLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jICAgICAgIHwgMTIgKystLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3VjL2ludGVsX2h1Yy5jICAgICAgIHwgMTIgKystLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmMgICAgIHwgMzAgKy0tLS0tLS0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Y19mdy5oICAgICB8ICAyIC0KIDcgZmlsZXMg
Y2hhbmdlZCwgNTYgaW5zZXJ0aW9ucygrKSwgOTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2ludGVybmFsLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1faW50ZXJuYWwuYwppbmRleCA5Y2ZiMGU0MWZmMDYuLmE4
ZWIwZWIyNzM5MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2ludGVybmFsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2ludGVy
bmFsLmMKQEAgLTE5OCwzICsxOTgsNDYgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5h
bChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCXJldHVybiBvYmo7CiB9CisKKy8q
IEFsbG9jYXRlIGEgbmV3IEdFTSBvYmplY3QgYW5kIGZpbGwgaXQgd2l0aCB0aGUgc3VwcGxpZWQg
ZGF0YSAqLworc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgoraTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9mcm9tX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJIGNvbnN0
IHZvaWQgKmRhdGEsIHJlc291cmNlX3NpemVfdCBzaXplKQoreworCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmo7CisJcmVzb3VyY2Vfc2l6ZV90IG9mZnNldDsKKwlzdHJ1Y3Qgc2d0X2l0
ZXIgaXQ7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisJaW50IGVycjsKKworCW9iaiA9IGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgcm91bmRfdXAoc2l6ZSwgUEFHRV9TSVpFKSk7
CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gb2JqOworCisJR0VNX0JVR19PTihvYmotPndy
aXRlX2RvbWFpbiAhPSBJOTE1X0dFTV9ET01BSU5fQ1BVKTsKKworCWVyciA9IGk5MTVfZ2VtX29i
amVjdF9waW5fcGFnZXMob2JqKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycjsKKworCW9mZnNldCA9
IDA7CisJZm9yX2VhY2hfc2d0X3BhZ2UocGFnZSwgaXQsIG9iai0+bW0ucGFnZXMpIHsKKwkJaW50
IGxlbiA9IG1pbl90KHR5cGVvZihzaXplKSwgc2l6ZSAtIG9mZnNldCwgUEFHRV9TSVpFKTsKKwkJ
dm9pZCAqcHRyOworCisJCXB0ciA9IGttYXAocGFnZSk7CisKKwkJbWVtY3B5KHB0ciwgZGF0YSAr
IG9mZnNldCwgbGVuKTsKKwkJaWYgKCEob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FD
SEVfQ09IRVJFTlRfRk9SX1dSSVRFKSkKKwkJCWRybV9jbGZsdXNoX3ZpcnRfcmFuZ2UocHRyLCBs
ZW4pOworCisJCWt1bm1hcChwYWdlKTsKKwkJb2Zmc2V0ICs9IGxlbjsKKwl9CisKKwlyZXR1cm4g
b2JqOyAvKiBrZWVwIHBhZ2VzIHBpbm5lZCAqLworCitlcnI6CisJaTkxNV9nZW1fb2JqZWN0X3B1
dChvYmopOworCXJldHVybiBFUlJfUFRSKGVycik7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5kZXggZTU3NTBkNTA2Y2M5Li5hYzRmNDVmYTUyMzQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTI5LDggKzI5
LDggQEAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgogaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9zaG1lbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgcmVzb3VyY2Vf
c2l6ZV90IHNpemUpOwogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgotaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zaG1lbV9mcm9tX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
Ci0JCQkJICAgICAgIGNvbnN0IHZvaWQgKmRhdGEsIHJlc291cmNlX3NpemVfdCBzaXplKTsKK2k5
MTVfZ2VtX29iamVjdF9jcmVhdGVfZnJvbV9kYXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAorCQkJCSBjb25zdCB2b2lkICpkYXRhLCByZXNvdXJjZV9zaXplX3Qgc2l6ZSk7CiAKIGV4
dGVybiBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgaTkxNV9nZW1fc2htZW1f
b3BzOwogdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3NobWVtKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fc2htZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1l
bS5jCmluZGV4IDRkNjljM2ZjMzQzOS4uMGY0YzhmYzM4YmJhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYwpAQCAtNTMzLDU3ICs1MzMsNiBAQCBpOTE1X2dlbV9v
YmplY3RfY3JlYXRlX3NobWVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkg
ICAgIHNpemUsIDApOwogfQogCi0vKiBBbGxvY2F0ZSBhIG5ldyBHRU0gb2JqZWN0IGFuZCBmaWxs
IGl0IHdpdGggdGhlIHN1cHBsaWVkIGRhdGEgKi8KLXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICoKLWk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW1fZnJvbV9kYXRhKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgICAgICAgY29uc3Qgdm9pZCAqZGF0YSwgcmVzb3Vy
Y2Vfc2l6ZV90IHNpemUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlz
dHJ1Y3QgZmlsZSAqZmlsZTsKLQlyZXNvdXJjZV9zaXplX3Qgb2Zmc2V0OwotCWludCBlcnI7Ci0K
LQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCByb3VuZF91cChz
aXplLCBQQUdFX1NJWkUpKTsKLQlpZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBvYmo7Ci0KLQlH
RU1fQlVHX09OKG9iai0+d3JpdGVfZG9tYWluICE9IEk5MTVfR0VNX0RPTUFJTl9DUFUpOwotCi0J
ZmlsZSA9IG9iai0+YmFzZS5maWxwOwotCW9mZnNldCA9IDA7Ci0JZG8gewotCQl1bnNpZ25lZCBp
bnQgbGVuID0gbWluX3QodHlwZW9mKHNpemUpLCBzaXplLCBQQUdFX1NJWkUpOwotCQlzdHJ1Y3Qg
cGFnZSAqcGFnZTsKLQkJdm9pZCAqcGdkYXRhLCAqdmFkZHI7Ci0KLQkJZXJyID0gcGFnZWNhY2hl
X3dyaXRlX2JlZ2luKGZpbGUsIGZpbGUtPmZfbWFwcGluZywKLQkJCQkJICAgIG9mZnNldCwgbGVu
LCAwLAotCQkJCQkgICAgJnBhZ2UsICZwZ2RhdGEpOwotCQlpZiAoZXJyIDwgMCkKLQkJCWdvdG8g
ZmFpbDsKLQotCQl2YWRkciA9IGttYXAocGFnZSk7Ci0JCW1lbWNweSh2YWRkciwgZGF0YSwgbGVu
KTsKLQkJa3VubWFwKHBhZ2UpOwotCi0JCWVyciA9IHBhZ2VjYWNoZV93cml0ZV9lbmQoZmlsZSwg
ZmlsZS0+Zl9tYXBwaW5nLAotCQkJCQkgIG9mZnNldCwgbGVuLCBsZW4sCi0JCQkJCSAgcGFnZSwg
cGdkYXRhKTsKLQkJaWYgKGVyciA8IDApCi0JCQlnb3RvIGZhaWw7Ci0KLQkJc2l6ZSAtPSBsZW47
Ci0JCWRhdGEgKz0gbGVuOwotCQlvZmZzZXQgKz0gbGVuOwotCX0gd2hpbGUgKHNpemUpOwotCi0J
cmV0dXJuIG9iajsKLQotZmFpbDoKLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JcmV0dXJu
IEVSUl9QVFIoZXJyKTsKLX0KLQogc3RhdGljIGludCBpbml0X3NobWVtKHN0cnVjdCBpbnRlbF9t
ZW1vcnlfcmVnaW9uICptZW0pCiB7CiAJaW50IGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMv
aW50ZWxfZ3VjLmMKaW5kZXggMDE5YWU2NDg2ZThkLi4yOWMyYjQxNmJiMDMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Yy5jCkBAIC0zMzQsMTMgKzMzNCwxNCBAQCBpbnQgaW50
ZWxfZ3VjX2luaXQoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBndWNfdG9fZ3QoZ3VjKTsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaW50ZWxfdWNfZndfaW5pdCgm
Z3VjLT5mdyk7Ci0JaWYgKHJldCkKLQkJZ290byBlcnJfZmV0Y2g7CisJLyogVGhpcyBzaG91bGQg
aGFwcGVuIGJlZm9yZSB0aGUgbG9hZCEgKi8KKwlHRU1fQlVHX09OKGludGVsX3VjX2Z3X2lzX2xv
YWRlZCgmZ3VjLT5mdykpOworCWlmICghaW50ZWxfdWNfZndfaXNfYXZhaWxhYmxlKCZndWMtPmZ3
KSkKKwkJcmV0dXJuIC1FTk9FWEVDOwogCiAJcmV0ID0gaW50ZWxfZ3VjX2xvZ19jcmVhdGUoJmd1
Yy0+bG9nKTsKIAlpZiAocmV0KQotCQlnb3RvIGVycl9mdzsKKwkJZ290byBlcnJfZmV0Y2g7CiAK
IAlyZXQgPSBpbnRlbF9ndWNfYWRzX2NyZWF0ZShndWMpOwogCWlmIChyZXQpCkBAIC0zNzUsOCAr
Mzc2LDYgQEAgaW50IGludGVsX2d1Y19pbml0KHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAlpbnRl
bF9ndWNfYWRzX2Rlc3Ryb3koZ3VjKTsKIGVycl9sb2c6CiAJaW50ZWxfZ3VjX2xvZ19kZXN0cm95
KCZndWMtPmxvZyk7Ci1lcnJfZnc6Ci0JaW50ZWxfdWNfZndfZmluaSgmZ3VjLT5mdyk7CiBlcnJf
ZmV0Y2g6CiAJaW50ZWxfdWNfZndfY2xlYW51cF9mZXRjaCgmZ3VjLT5mdyk7CiAJRFJNX0RFVl9E
RUJVR19EUklWRVIoZ3QtPmk5MTUtPmRybS5kZXYsICJmYWlsZWQgd2l0aCAlZFxuIiwgcmV0KTsK
QEAgLTM5OSw3ICszOTgsNiBAQCB2b2lkIGludGVsX2d1Y19maW5pKHN0cnVjdCBpbnRlbF9ndWMg
Kmd1YykKIAogCWludGVsX2d1Y19hZHNfZGVzdHJveShndWMpOwogCWludGVsX2d1Y19sb2dfZGVz
dHJveSgmZ3VjLT5sb2cpOwotCWludGVsX3VjX2Z3X2ZpbmkoJmd1Yy0+ZncpOwogCWludGVsX3Vj
X2Z3X2NsZWFudXBfZmV0Y2goJmd1Yy0+ZncpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9odWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Vj
L2ludGVsX2h1Yy5jCmluZGV4IDMyYTA2OTg0MWMxNC4uZjBiNTU1ZmI2ZGQyIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9odWMuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9odWMuYwpAQCAtMTA4LDkgKzEwOCwxMCBAQCBpbnQgaW50
ZWxfaHVjX2luaXQoc3RydWN0IGludGVsX2h1YyAqaHVjKQogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gaHVjX3RvX2d0KGh1YyktPmk5MTU7CiAJaW50IGVycjsKIAotCWVyciA9IGlu
dGVsX3VjX2Z3X2luaXQoJmh1Yy0+ZncpOwotCWlmIChlcnIpCi0JCWdvdG8gb3V0OworCS8qIFRo
aXMgc2hvdWxkIGhhcHBlbiBiZWZvcmUgdGhlIGxvYWQhICovCisJR0VNX0JVR19PTihpbnRlbF91
Y19md19pc19sb2FkZWQoJmh1Yy0+ZncpKTsKKwlpZiAoIWludGVsX3VjX2Z3X2lzX2F2YWlsYWJs
ZSgmaHVjLT5mdykpCisJCXJldHVybiAtRU5PRVhFQzsKIAogCS8qCiAJICogSHVDIGZpcm13YXJl
IGltYWdlIGlzIG91dHNpZGUgR3VDIGFjY2Vzc2libGUgcmFuZ2UuCkBAIC0xMTksMTIgKzEyMCwx
MCBAQCBpbnQgaW50ZWxfaHVjX2luaXQoc3RydWN0IGludGVsX2h1YyAqaHVjKQogCSAqLwogCWVy
ciA9IGludGVsX2h1Y19yc2FfZGF0YV9jcmVhdGUoaHVjKTsKIAlpZiAoZXJyKQotCQlnb3RvIG91
dF9maW5pOworCQlnb3RvIG91dDsKIAogCXJldHVybiAwOwogCi1vdXRfZmluaToKLQlpbnRlbF91
Y19md19maW5pKCZodWMtPmZ3KTsKIG91dDoKIAlpbnRlbF91Y19md19jbGVhbnVwX2ZldGNoKCZo
dWMtPmZ3KTsKIAlEUk1fREVWX0RFQlVHX0RSSVZFUihpOTE1LT5kcm0uZGV2LCAiZmFpbGVkIHdp
dGggJWRcbiIsIGVycik7CkBAIC0xMzcsNyArMTM2LDYgQEAgdm9pZCBpbnRlbF9odWNfZmluaShz
dHJ1Y3QgaW50ZWxfaHVjICpodWMpCiAJCXJldHVybjsKIAogCWludGVsX2h1Y19yc2FfZGF0YV9k
ZXN0cm95KGh1Yyk7Ci0JaW50ZWxfdWNfZndfZmluaSgmaHVjLT5mdyk7CiB9CiAKIC8qKgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmMKaW5kZXggNjZhMzBhYjcwNDRhLi4z
ZTMwZDcxNjc4NzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVs
X3VjX2Z3LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuYwpA
QCAtMzYzLDcgKzM2Myw3IEBAIGludCBpbnRlbF91Y19md19mZXRjaChzdHJ1Y3QgaW50ZWxfdWNf
ZncgKnVjX2Z3LCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJfQogCX0KIAotCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW1fZnJvbV9kYXRhKGk5MTUsIGZ3LT5kYXRh
LCBmdy0+c2l6ZSk7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9mcm9tX2RhdGEoaTkx
NSwgZnctPmRhdGEsIGZ3LT5zaXplKTsKIAlpZiAoSVNfRVJSKG9iaikpIHsKIAkJZXJyID0gUFRS
X0VSUihvYmopOwogCQlnb3RvIGZhaWw7CkBAIC01MjUsMzQgKzUyNSw2IEBAIGludCBpbnRlbF91
Y19md191cGxvYWQoc3RydWN0IGludGVsX3VjX2Z3ICp1Y19mdywgc3RydWN0IGludGVsX2d0ICpn
dCwKIAlyZXR1cm4gZXJyOwogfQogCi1pbnQgaW50ZWxfdWNfZndfaW5pdChzdHJ1Y3QgaW50ZWxf
dWNfZncgKnVjX2Z3KQotewotCWludCBlcnI7Ci0KLQkvKiB0aGlzIHNob3VsZCBoYXBwZW4gYmVm
b3JlIHRoZSBsb2FkISAqLwotCUdFTV9CVUdfT04oaW50ZWxfdWNfZndfaXNfbG9hZGVkKHVjX2Z3
KSk7Ci0KLQlpZiAoIWludGVsX3VjX2Z3X2lzX2F2YWlsYWJsZSh1Y19mdykpCi0JCXJldHVybiAt
RU5PRVhFQzsKLQotCWVyciA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXModWNfZnctPm9iaik7
Ci0JaWYgKGVycikgewotCQlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBwaW4tcGFnZXMgZXJyPSVk
XG4iLAotCQkJCSBpbnRlbF91Y19md190eXBlX3JlcHIodWNfZnctPnR5cGUpLCBlcnIpOwotCQlp
bnRlbF91Y19md19jaGFuZ2Vfc3RhdHVzKHVjX2Z3LCBJTlRFTF9VQ19GSVJNV0FSRV9GQUlMKTsK
LQl9Ci0KLQlyZXR1cm4gZXJyOwotfQotCi12b2lkIGludGVsX3VjX2Z3X2Zpbmkoc3RydWN0IGlu
dGVsX3VjX2Z3ICp1Y19mdykKLXsKLQlpZiAoIWludGVsX3VjX2Z3X2lzX2F2YWlsYWJsZSh1Y19m
dykpCi0JCXJldHVybjsKLQotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyh1Y19mdy0+b2Jq
KTsKLX0KLQogLyoqCiAgKiBpbnRlbF91Y19md19jbGVhbnVwX2ZldGNoIC0gY2xlYW51cCB1QyBm
aXJtd2FyZQogICogQHVjX2Z3OiB1QyBmaXJtd2FyZQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Vj
L2ludGVsX3VjX2Z3LmgKaW5kZXggN2EwYTU5ODlhZmM5Li4xZDNiNzhjYzc3MGEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuaApAQCAtMjMzLDggKzIzMyw2IEBAIGlu
dCBpbnRlbF91Y19md19mZXRjaChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGludGVsX3VjX2Z3X2NsZWFudXBfZmV0Y2goc3Ry
dWN0IGludGVsX3VjX2Z3ICp1Y19mdyk7CiBpbnQgaW50ZWxfdWNfZndfdXBsb2FkKHN0cnVjdCBp
bnRlbF91Y19mdyAqdWNfZncsIHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCSAgICAgICB1MzIgd29w
Y21fb2Zmc2V0LCB1MzIgZG1hX2ZsYWdzKTsKLWludCBpbnRlbF91Y19md19pbml0KHN0cnVjdCBp
bnRlbF91Y19mdyAqdWNfZncpOwotdm9pZCBpbnRlbF91Y19md19maW5pKHN0cnVjdCBpbnRlbF91
Y19mdyAqdWNfZncpOwogc2l6ZV90IGludGVsX3VjX2Z3X2NvcHlfcnNhKHN0cnVjdCBpbnRlbF91
Y19mdyAqdWNfZncsIHZvaWQgKmRzdCwgdTMyIG1heF9sZW4pOwogdm9pZCBpbnRlbF91Y19md19k
dW1wKGNvbnN0IHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncsIHN0cnVjdCBkcm1fcHJpbnRlciAq
cCk7CiAKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 407F0A1349
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D21A289FA0;
	Thu, 29 Aug 2019 08:12:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4C9C489FA0
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:11:57 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299875-1500050 
 for multiple; Thu, 29 Aug 2019 09:11:56 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:31 +0100
Message-Id: <20190829081150.10271-18-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 17/36] drm/i915: Drop struct_mutex from around
 i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZG9uJ3QgbmVlZCB0byBob2xkIHN0cnVjdF9tdXRleCBub3cgZm9yIHJldGlyaW5nIHJlcXVl
c3RzLCBzbyBkcm9wIGl0CmZyb20gaTkxNV9yZXRpcmVfcmVxdWVzdHMoKSBhbmQgaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZSgpLCBmaW5hbGx5CnJlbW92aW5nIEk5MTVfV0FJVF9MT0NLRUQgZm9yIGdv
b2QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgICAgfCAg
IDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8ICAy
MCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8ICA0
NSArKystLS0tCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jICAg
fCAgMTEgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8
ICAgNCArLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgIHwg
ICA2ICstCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYyAgfCAg
IDQgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jICAgIHwgICA0
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyAgfCAgODkg
KysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAg
ICAgIHwgIDIxICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUu
YyAgIHwgIDkxICsrKysrKy0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29y
a2Fyb3VuZHMuYyAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2Zz
LmMgICAgICAgICAgIHwgIDQyICsrLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0u
YyAgICAgICAgICAgICAgIHwgIDE5ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmggICAgICAgICAgIHwgICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9hY3RpdmUuYyAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2V2aWN0LmMgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfZ2VtX2d0dC5jIHwgICA0IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3JlcXVlc3QuYyB8IDEyNSArKysrKy0tLS0tLS0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfdm1hLmMgICAgIHwgICA0IC0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9mbHVzaF90ZXN0LmMgICB8ICAzMCArKy0tLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaCAgIHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMgICAgfCAgIDkgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL21vY2tfZ2VtX2RldmljZS5jICB8ICAgNCAtCiAyNSBmaWxlcyBjaGFuZ2VkLCAxNzAgaW5z
ZXJ0aW9ucygrKSwgNDAyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IDU0MmY4ZTJjZmNjNy4uZWM0YWUyYzVlYjI5
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMK
QEAgLTE3NSw3ICsxNzUsNiBAQCBzdGF0aWMgaW50IG1vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHN0YXRpYyB2b2lkIGNsZWFyX3Bh
Z2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGNsZWFyX3Bh
Z2VzX3dvcmsgKncgPSBjb250YWluZXJfb2Yod29yaywgdHlwZW9mKCp3KSwgd29yayk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB3LT5jZS0+ZW5naW5lLT5pOTE1OwogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB3LT5zbGVldmUtPnZtYS0+b2JqOwogCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hID0gdy0+c2xlZXZlLT52bWE7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CkBAIC0xOTMsMTEgKzE5Miw5IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihz
dHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9H
UFVfRE9NQUlOUzsKIAlvYmotPndyaXRlX2RvbWFpbiA9IDA7CiAKLQkvKiBYWFg6IHdlIG5lZWQg
dG8ga2lsbCB0aGlzICovCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
ZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOwogCWlmICh1bmxpa2VseShl
cnIpKQotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X3NpZ25hbDsKIAogCWJhdGNoID0g
aW50ZWxfZW1pdF92bWFfZmlsbF9ibHQody0+Y2UsIHZtYSwgdy0+dmFsdWUpOwogCWlmIChJU19F
UlIoYmF0Y2gpKSB7CkBAIC0yNDksOCArMjQ2LDYgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNf
d29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlpbnRlbF9lbWl0X3ZtYV9yZWxlYXNl
KHctPmNlLCBiYXRjaCk7CiBvdXRfdW5waW46CiAJaTkxNV92bWFfdW5waW4odm1hKTsKLW91dF91
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIG91dF9zaWdu
YWw6CiAJaWYgKHVubGlrZWx5KGVycikpIHsKIAkJZG1hX2ZlbmNlX3NldF9lcnJvcigmdy0+ZG1h
LCBlcnIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5k
ZXggZDNjZThiNWJjY2M1Li5iZGJlZDA3NWMyMWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtMTE2MSw4ICsxMTYxLDcgQEAgZ2VuOF9tb2RpZnlf
cnBjcyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBpbnRlbF9zc2V1IHNzZXUpCiB9
CiAKIHN0YXRpYyBpbnQKLV9faW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSwKLQkJCQkgc3RydWN0IGludGVsX3NzZXUgc3NldSkKK2ludGVsX2Nv
bnRleHRfcmVjb25maWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBp
bnRlbF9zc2V1IHNzZXUpCiB7CiAJaW50IHJldDsKIApAQCAtMTE4NSwyMyArMTE4NCw2IEBAIF9f
aW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwK
IAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgaW50Ci1pbnRlbF9jb250ZXh0X3JlY29uZmlndXJl
X3NzZXUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1KQot
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY2UtPmVuZ2luZS0+aTkxNTsKLQlp
bnQgcmV0OwotCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gX19pbnRlbF9j
b250ZXh0X3JlY29uZmlndXJlX3NzZXUoY2UsIHNzZXUpOwotCi0JbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQotCXJldHVybiByZXQ7Ci19Ci0KIHN0YXRpYyBpbnQKIHVz
ZXJfdG9fY29udGV4dF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAg
IGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbV9zc2V1ICp1c2VyLApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCA2ZTRjYzE3N2NjN2EuLmZlYzBi
NDEwZDFkOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Bt
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTQ4LDEx
ICs0OCw3IEBAIHN0YXRpYyB2b2lkIHJldGlyZV93b3JrX2hhbmRsZXIoc3RydWN0IHdvcmtfc3Ry
dWN0ICp3b3JrKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVy
X29mKHdvcmssIHR5cGVvZigqaTkxNSksIGdlbS5yZXRpcmVfd29yay53b3JrKTsKIAotCS8qIENv
bWUgYmFjayBsYXRlciBpZiB0aGUgZGV2aWNlIGlzIGJ1c3kuLi4gKi8KLQlpZiAobXV0ZXhfdHJ5
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCkpIHsKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMo
aTkxNSk7Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JfQorCWk5
MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwogCiAJcXVldWVfZGVsYXllZF93b3JrKGk5MTUtPndx
LAogCQkJICAgJmk5MTUtPmdlbS5yZXRpcmVfd29yaywKQEAgLTg2LDI2ICs4MiwyMyBAQCBzdGF0
aWMgYm9vbCBzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KQogewogCWJvb2wgcmVzdWx0ID0gIWludGVsX2d0X2lzX3dlZGdlZChndCk7CiAKLQlkbyB7Ci0J
CWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1LAotCQkJCQkgICBJOTE1X1dBSVRf
TE9DS0VEIHwKLQkJCQkJICAgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NULAotCQkJCQkgICBJOTE1
X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgewotCQkJLyogWFhYIGhpZGUgd2FybmluZyBm
cm9tIGdlbV9laW8gKi8KLQkJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCkgewotCQkJCWRldl9l
cnIoZ3QtPmk5MTUtPmRybS5kZXYsCi0JCQkJCSJGYWlsZWQgdG8gaWRsZSBlbmdpbmVzLCBkZWNs
YXJpbmcgd2VkZ2VkIVxuIik7Ci0JCQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJCX0KLQotCQkJLyoK
LQkJCSAqIEZvcmNpYmx5IGNhbmNlbCBvdXRzdGFuZGluZyB3b3JrIGFuZCBsZWF2ZQotCQkJICog
dGhlIGdwdSBxdWlldC4KLQkJCSAqLwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JCQly
ZXN1bHQgPSBmYWxzZTsKKwlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShndC0+aTkxNSwKKwkJ
CQkgICBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QsCisJCQkJICAgSTkxNV9HRU1fSURMRV9USU1F
T1VUKSA9PSAtRVRJTUUpIHsKKwkJLyogWFhYIGhpZGUgd2FybmluZyBmcm9tIGdlbV9laW8gKi8K
KwkJaWYgKGk5MTVfbW9kcGFyYW1zLnJlc2V0KSB7CisJCQlkZXZfZXJyKGd0LT5pOTE1LT5kcm0u
ZGV2LAorCQkJCSJGYWlsZWQgdG8gaWRsZSBlbmdpbmVzLCBkZWNsYXJpbmcgd2VkZ2VkIVxuIik7
CisJCQlHRU1fVFJBQ0VfRFVNUCgpOwogCQl9Ci0JfSB3aGlsZSAoaTkxNV9yZXRpcmVfcmVxdWVz
dHMoZ3QtPmk5MTUpICYmIHJlc3VsdCk7CisKKwkJLyoKKwkJICogRm9yY2libHkgY2FuY2VsIG91
dHN0YW5kaW5nIHdvcmsgYW5kIGxlYXZlCisJCSAqIHRoZSBncHUgcXVpZXQuCisJCSAqLworCQlp
bnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKKwkJcmVzdWx0ID0gZmFsc2U7CisJfQogCiAJaWYgKGlu
dGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoZ3QpKQogCQlyZXN1bHQgPSBmYWxzZTsKQEAgLTEyNSw4
ICsxMTgsNiBAQCB2b2lkIGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiAJaW50ZWxfd2FrZXJlZl9hdXRvKCZpOTE1LT5nZ3R0LnVzZXJmYXVsdF93YWtlcmVm
LCAwKTsKIAlmbHVzaF93b3JrcXVldWUoaTkxNS0+d3EpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAkvKgogCSAqIFdlIGhhdmUgdG8gZmx1c2ggYWxsIHRoZSBl
eGVjdXRpbmcgY29udGV4dHMgdG8gbWFpbiBtZW1vcnkgc28KIAkgKiB0aGF0IHRoZXkgY2FuIHNh
dmVkIGluIHRoZSBoaWJlcm5hdGlvbiBpbWFnZS4gVG8gZW5zdXJlIHRoZSBsYXN0CkBAIC0xMzgs
OCArMTI5LDYgQEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCSAqLwogCXN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKCZpOTE1LT5ndCk7
CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY2FuY2VsX2Rl
bGF5ZWRfd29ya19zeW5jKCZpOTE1LT5ndC5oYW5nY2hlY2sud29yayk7CiAKIAlpOTE1X2dlbV9k
cmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKaW5kZXggMGZmN2E4OWFhZGNh
Li45ODlkNjZlZTliZmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYwpAQCAtMjgwLDcgKzI4MCw2IEBAIHN0YXRp
YyBpbnQgaWd0X2dlbV9jb2hlcmVuY3kodm9pZCAqYXJnKQogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gYXJnOwogCWNvbnN0IHN0cnVjdCBpZ3RfY29oZXJlbmN5X21vZGUgKnJlYWQs
ICp3cml0ZSwgKm92ZXI7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlpbnRl
bF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1bnNpZ25lZCBsb25nIGNvdW50LCBuOwogCXUzMiAqb2Zm
c2V0cywgKnZhbHVlczsKIAlpbnQgZXJyID0gMDsKQEAgLTI5OSw4ICsyOTgsNiBAQCBzdGF0aWMg
aW50IGlndF9nZW1fY29oZXJlbmN5KHZvaWQgKmFyZykKIAogCXZhbHVlcyA9IG9mZnNldHMgKyBu
Y2FjaGVsaW5lczsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdh
a2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAJZm9yIChv
dmVyID0gaWd0X2NvaGVyZW5jeV9tb2RlOyBvdmVyLT5uYW1lOyBvdmVyKyspIHsKIAkJaWYgKCFv
dmVyLT5zZXQpCiAJCQljb250aW51ZTsKQEAgLTMyNiw3ICszMjMsNyBAQCBzdGF0aWMgaW50IGln
dF9nZW1fY29oZXJlbmN5KHZvaWQgKmFyZykKIAkJCQkJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOwogCQkJCQlpZiAoSVNfRVJSKG9iaikpIHsK
IAkJCQkJCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJCQkJCWdvdG8gdW5sb2NrOworCQkJCQkJZ290
byBmcmVlOwogCQkJCQl9CiAKIAkJCQkJaTkxNV9yYW5kb21fcmVvcmRlcihvZmZzZXRzLCBuY2Fj
aGVsaW5lcywgJnBybmcpOwpAQCAtMzc3LDE1ICszNzQsMTMgQEAgc3RhdGljIGludCBpZ3RfZ2Vt
X2NvaGVyZW5jeSh2b2lkICphcmcpCiAJCQl9CiAJCX0KIAl9Ci11bmxvY2s6Ci0JaW50ZWxfcnVu
dGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CitmcmVlOgogCWtmcmVlKG9mZnNldHMpOwogCXJldHVy
biBlcnI7CiAKIHB1dF9vYmplY3Q6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCWdvdG8g
dW5sb2NrOworCWdvdG8gZnJlZTsKIH0KIAogaW50IGk5MTVfZ2VtX2NvaGVyZW5jeV9saXZlX3Nl
bGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggYWE2
N2MwMmJhOThjLi5iODdlMzVhNzEzYjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC05NDksNyArOTQ5LDcgQEAg
X19zc2V1X3Rlc3QoY29uc3QgY2hhciAqbmFtZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
Ci0JcmV0ID0gX19pbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoY2UsIHNzZXUpOworCXJl
dCA9IGludGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShjZSwgc3NldSk7CiAJaWYgKHJldCkK
IAkJZ290byBvdXRfc3BpbjsKIApAQCAtMTA1Myw3ICsxMDUzLDcgQEAgX19pZ3RfY3R4X3NzZXUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWdvdG8gb3V0X2ZhaWw7CiAKIG91dF9m
YWlsOgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAo
aWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCXJldCA9IC1FSU87CiAKIAlpbnRlbF9jb250ZXh0X3Vu
cGluKGNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9tbWFuLmMKaW5kZXggOWMyMTdkZmU5NmE5Li4zOWMwMWJjNGViNTEgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCkBAIC0z
OTMsMTIgKzM5Myw4IEBAIHN0YXRpYyB2b2lkIGRpc2FibGVfcmV0aXJlX3dvcmtlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogc3RhdGljIHZvaWQgcmVzdG9yZV9yZXRpcmVfd29y
a2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogeworCWlndF9mbHVzaF90ZXN0KGk5
MTUpOwogCWludGVsX2d0X3BtX3B1dCgmaTkxNS0+Z3QpOwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tF
RCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfZ2Vt
X2RyaXZlcl9yZWdpc3Rlcl9fc2hyaW5rZXIoaTkxNSk7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKaW5k
ZXggYzIxZDc0N2U3ZDA1Li45ZWM1NWIzYTM4MTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCkBAIC02NSw5
ICs2NSw3IEBAIHN0YXRpYyBpbnQgaWd0X2ZpbGxfYmx0KHZvaWQgKmFyZykKIAkJaWYgKCEob2Jq
LT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVfQ09IRVJFTlRfRk9SX1dSSVRFKSkKIAkJ
CW9iai0+Y2FjaGVfZGlydHkgPSB0cnVlOwogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9vYmplY3RfZmlsbF9ibHQob2JqLCBjZSwgdmFs
KTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikK
IAkJCWdvdG8gZXJyX3VucGluOwogCkBAIC0xNjYsOSArMTY0LDcgQEAgc3RhdGljIGludCBpZ3Rf
Y29weV9ibHQodm9pZCAqYXJnKQogCQlpZiAoIShkc3QtPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9C
T19DQUNIRV9DT0hFUkVOVF9GT1JfV1JJVEUpKQogCQkJZHN0LT5jYWNoZV9kaXJ0eSA9IHRydWU7
CiAKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IGk5MTVf
Z2VtX29iamVjdF9jb3B5X2JsdChzcmMsIGRzdCwgY2UpOwotCQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoZXJyKQogCQkJZ290byBlcnJfdW5waW47CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRleCAxNDIwNTMzZThm
ZDUuLjg4MzczOTM1NGIwNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2Nv
bnRleHQuYwpAQCAtMzEyLDcgKzMxMiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4
dCh2b2lkICphcmcpCiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hf
dGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0
KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTQyNSw3ICs0MjUsNyBA
QCBzdGF0aWMgaW50IGxpdmVfcmVtb3RlX2NvbnRleHQodm9pZCAqYXJnKQogCQlpZiAoZXJyKQog
CQkJYnJlYWs7CiAKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9M
T0NLRUQpOworCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJ
CQlicmVhazsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVj
ay5jCmluZGV4IGU1M2VlYTEwNTBmOC4uZmM0ZDAyNDA2NTM2IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtNTgsNyArNTgsOSBAQCBzdGF0aWMg
aW50IGhhbmdfaW5pdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2d0ICpndCkKIAltZW1z
ZXQoaCwgMCwgc2l6ZW9mKCpoKSk7CiAJaC0+Z3QgPSBndDsKIAorCW11dGV4X2xvY2soJmd0LT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAloLT5jdHggPSBrZXJuZWxfY29udGV4dChndC0+aTkx
NSk7CisJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElT
X0VSUihoLT5jdHgpKQogCQlyZXR1cm4gUFRSX0VSUihoLT5jdHgpOwogCkBAIC0yODUsNyArMjg3
LDcgQEAgc3RhdGljIHZvaWQgaGFuZ19maW5pKHN0cnVjdCBoYW5nICpoKQogCiAJa2VybmVsX2Nv
bnRleHRfY2xvc2UoaC0+Y3R4KTsKIAotCWlndF9mbHVzaF90ZXN0KGgtPmd0LT5pOTE1LCBJOTE1
X1dBSVRfTE9DS0VEKTsKKwlpZ3RfZmx1c2hfdGVzdChoLT5ndC0+aTkxNSk7CiB9CiAKIHN0YXRp
YyBib29sIHdhaXRfdW50aWxfcnVubmluZyhzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCkBAIC0zMDksMTAgKzMxMSw5IEBAIHN0YXRpYyBpbnQgaWd0X2hhbmdfc2FuaXR5
Y2hlY2sodm9pZCAqYXJnKQogCiAJLyogQmFzaWMgY2hlY2sgdGhhdCB3ZSBjYW4gZXhlY3V0ZSBv
dXIgaGFuZ2luZyBiYXRjaCAqLwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWVyciA9IGhhbmdfaW5pdCgmaCwgZ3QpOwogCWlmIChlcnIpCi0JCWdvdG8gdW5s
b2NrOworCQlyZXR1cm4gZXJyOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUs
IGlkKSB7CiAJCXN0cnVjdCBpbnRlbF93ZWRnZV9tZSB3OwpAQCAtMzU1LDggKzM1Niw2IEBAIHN0
YXRpYyBpbnQgaWd0X2hhbmdfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogCiBmaW5pOgogCWhhbmdf
ZmluaSgmaCk7Ci11bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMzk1LDggKzM5NCw2IEBAIHN0YXRpYyBpbnQg
aWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJcmVzZXRfY291bnQgPSBpOTE1X3Jlc2V0X2NvdW50
KGdsb2JhbCk7CiAJY291bnQgPSAwOwogCWRvIHsKLQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBp
ZCkgewogCQkJaW50IGk7CiAKQEAgLTQxNyw3ICs0MTQsNiBAQCBzdGF0aWMgaW50IGlndF9yZXNl
dF9ub3Aodm9pZCAqYXJnKQogCQlpbnRlbF9ndF9yZXNldChndCwgQUxMX0VOR0lORVMsIE5VTEwp
OwogCQlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhndCk7CiAKLQkJbXV0ZXhfdW5sb2NrKCZndC0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKSB7
CiAJCQllcnIgPSAtRUlPOwogCQkJYnJlYWs7CkBAIC00MjksMTYgKzQyNSwxMyBAQCBzdGF0aWMg
aW50IGlndF9yZXNldF9ub3Aodm9pZCAqYXJnKQogCQkJYnJlYWs7CiAJCX0KIAotCQllcnIgPSBp
Z3RfZmx1c2hfdGVzdChndC0+aTkxNSwgMCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5p
OTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0gd2hpbGUgKHRpbWVfYmVmb3JlKGppZmZp
ZXMsIGVuZF90aW1lKSk7CiAJcHJfaW5mbygiJXM6ICVkIHJlc2V0c1xuIiwgX19mdW5jX18sIGNv
dW50KTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQllcnIg
PSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5s
b2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KKwllcnIgPSBpZ3RfZmx1c2hfdGVz
dChndC0+aTkxNSk7CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwogCWlm
IChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQpAQCAtNDk0LDcgKzQ4Nyw2IEBAIHN0YXRpYyBpbnQg
aWd0X3Jlc2V0X25vcF9lbmdpbmUodm9pZCAqYXJnKQogCQkJCWJyZWFrOwogCQkJfQogCi0JCQlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQlmb3IgKGkgPSAwOyBp
IDwgMTY7IGkrKykgewogCQkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCkBAIC01MDcsNyAr
NDk5LDYgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJCQkJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCQl9CiAJCQllcnIgPSBpbnRlbF9lbmdpbmVfcmVzZXQo
ZW5naW5lLCBOVUxMKTsKLQkJCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCQkJaWYgKGVycikgewogCQkJCXByX2VycigiaTkxNV9yZXNldF9lbmdpbmUgZmFpbGVk
XG4iKTsKIAkJCQlicmVhazsKQEAgLTUzMywxNSArNTI0LDEyIEBAIHN0YXRpYyBpbnQgaWd0X3Jl
c2V0X25vcF9lbmdpbmUodm9pZCAqYXJnKQogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKLQkJZXJy
ID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIDApOworCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChn
dC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CiAKLQltdXRleF9sb2NrKCZndC0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUs
IEk5MTVfV0FJVF9MT0NLRUQpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCisJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogb3V0OgogCW1vY2tf
ZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKIAlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkK
QEAgLTU2Myw5ICs1NTEsNyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCBib29sIGFjdGl2ZSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoYWN0aXZlKSB7
Ci0JCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJZXJyID0gaGFu
Z19pbml0KCZoLCBndCk7Ci0JCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVycjsKIAl9CkBAIC01OTMsMTcgKzU3OSwxNCBA
QCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBib29s
IGFjdGl2ZSkKIAkJCWlmIChhY3RpdmUpIHsKIAkJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsK
IAotCQkJCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQlycSA9
IGhhbmdfY3JlYXRlX3JlcXVlc3QoJmgsIGVuZ2luZSk7CiAJCQkJaWYgKElTX0VSUihycSkpIHsK
IAkJCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQkJCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCQkJCQlicmVhazsKIAkJCQl9CiAKIAkJCQlpOTE1X3JlcXVlc3Rf
Z2V0KHJxKTsKIAkJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQkJCQltdXRleF91bmxvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQkJCWlmICghd2FpdF91bnRpbF9ydW5uaW5n
KCZoLCBycSkpIHsKIAkJCQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19wcmludGVy
KGd0LT5pOTE1LT5kcm0uZGV2KTsKQEAgLTY0Nyw3ICs2MzAsNyBAQCBzdGF0aWMgaW50IF9faWd0
X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBib29sIGFjdGl2ZSkKIAkJaWYgKGVy
cikKIAkJCWJyZWFrOwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKKwkJ
ZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJ
fQpAQCAtNjU1LDExICs2MzgsOCBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1
Y3QgaW50ZWxfZ3QgKmd0LCBib29sIGFjdGl2ZSkKIAlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0
KSkKIAkJZXJyID0gLUVJTzsKIAotCWlmIChhY3RpdmUpIHsKLQkJbXV0ZXhfbG9jaygmZ3QtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlmIChhY3RpdmUpCiAJCWhhbmdfZmluaSgmaCk7Ci0J
CW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCX0KIAogCXJldHVy
biBlcnI7CiB9CkBAIC03NDEsMTAgKzcyMSw4IEBAIHN0YXRpYyBpbnQgYWN0aXZlX2VuZ2luZSh2
b2lkICpkYXRhKQogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpvbGQgPSBycVtpZHhdOwogCQlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpuZXc7CiAKLQkJbXV0ZXhfbG9jaygmZW5naW5lLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAkJbmV3ID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4W2lkeF0sIGVuZ2lu
ZSk7CiAJCWlmIChJU19FUlIobmV3KSkgewotCQkJbXV0ZXhfdW5sb2NrKCZlbmdpbmUtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQkJZXJyID0gUFRSX0VSUihuZXcpOwogCQkJYnJlYWs7CiAJ
CX0KQEAgLTc1NSw3ICs3MzMsNiBAQCBzdGF0aWMgaW50IGFjdGl2ZV9lbmdpbmUodm9pZCAqZGF0
YSkKIAogCQlycVtpZHhdID0gaTkxNV9yZXF1ZXN0X2dldChuZXcpOwogCQlpOTE1X3JlcXVlc3Rf
YWRkKG5ldyk7Ci0JCW11dGV4X3VubG9jaygmZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAogCQllcnIgPSBhY3RpdmVfcmVxdWVzdF9wdXQob2xkKTsKIAkJaWYgKGVycikKQEAgLTc5
NSw5ICs3NzIsNyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVs
X2d0ICpndCwKIAkJcmV0dXJuIDA7CiAKIAlpZiAoZmxhZ3MgJiBURVNUX0FDVElWRSkgewotCQlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IGhhbmdfaW5p
dCgmaCwgZ3QpOwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7CiAKQEAgLTg1NSwxNyArODMwLDE0IEBAIHN0YXRp
YyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEgPSBOVUxMOwogCiAJCQlpZiAoZmxhZ3MgJiBURVNUX0FDVElWRSkg
ewotCQkJCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQlycSA9
IGhhbmdfY3JlYXRlX3JlcXVlc3QoJmgsIGVuZ2luZSk7CiAJCQkJaWYgKElTX0VSUihycSkpIHsK
IAkJCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQkJCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCQkJCQlicmVhazsKIAkJCQl9CiAKIAkJCQlpOTE1X3JlcXVlc3Rf
Z2V0KHJxKTsKIAkJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQkJCQltdXRleF91bmxvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQkJCWlmICghd2FpdF91bnRpbF9ydW5uaW5n
KCZoLCBycSkpIHsKIAkJCQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19wcmludGVy
KGd0LT5pOTE1LT5kcm0uZGV2KTsKQEAgLTk3Nyw5ICs5NDksNyBAQCBzdGF0aWMgaW50IF9faWd0
X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0ICpndCwKIAkJaWYgKGVycikKIAkJCWJyZWFr
OwogCi0JCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQkJZXJyID0g
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwotCQltdXRleF91bmxv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3Qo
Z3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAtOTg3LDExICs5NTcsOCBA
QCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0ICpndCwKIAlp
ZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKIAkJZXJyID0gLUVJTzsKIAotCWlmIChmbGFncyAm
IFRFU1RfQUNUSVZFKSB7Ci0JCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKKwlpZiAoZmxhZ3MgJiBURVNUX0FDVElWRSkKIAkJaGFuZ19maW5pKCZoKTsKLQkJbXV0ZXhf
dW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JfQogCiAJcmV0dXJuIGVycjsK
IH0KQEAgLTEwNjEsNyArMTAyOCw2IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X3dhaXQodm9pZCAq
YXJnKQogCiAJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKIAotCW11dGV4X2xvY2soJmd0LT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAo
ZXJyKQogCQlnb3RvIHVubG9jazsKQEAgLTExMDksNyArMTA3NSw2IEBAIHN0YXRpYyBpbnQgaWd0
X3Jlc2V0X3dhaXQodm9pZCAqYXJnKQogZmluaToKIAloYW5nX2ZpbmkoJmgpOwogdW5sb2NrOgot
CW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlndF9nbG9iYWxf
cmVzZXRfdW5sb2NrKGd0KTsKIAogCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQpAQCAtMTE4
OSwxMCArMTE1NCw5IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsCiAKIAkvKiBDaGVjayB0aGF0IHdlIGNhbiByZWNvdmVyIGFuIHVuYmluZCBz
dHVjayBvbiBhIGhhbmdpbmcgcmVxdWVzdCAqLwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IGhhbmdfaW5pdCgmaCwgZ3QpOwogCWlmIChlcnIpCi0J
CWdvdG8gdW5sb2NrOworCQlyZXR1cm4gZXJyOwogCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgU1pfMU0pOwogCWlmIChJU19FUlIob2JqKSkgewpAQCAt
MTI1NSw4ICsxMjE5LDYgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9ldmljdF92bWEoc3RydWN0
IGludGVsX2d0ICpndCwKIAlpZiAoZXJyKQogCQlnb3RvIG91dF9ycTsKIAotCW11dGV4X3VubG9j
aygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKCF3YWl0X3VudGlsX3J1bm5p
bmcoJmgsIHJxKSkgewogCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIo
Z3QtPmk5MTUtPmRybS5kZXYpOwogCkBAIC0xMzA1LDE2ICsxMjY3LDEyIEBAIHN0YXRpYyBpbnQg
X19pZ3RfcmVzZXRfZXZpY3Rfdm1hKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCXB1dF90YXNrX3N0
cnVjdCh0c2spOwogCX0KIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIG91dF9ycToKIAlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIG91dF9vYmo6CiAJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOwogZmluaToKIAloYW5nX2ZpbmkoJmgpOwotdW5sb2NrOgotCW11dGV4
X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKGludGVsX2d0X2lz
X3dlZGdlZChndCkpCiAJCXJldHVybiAtRUlPOwogCkBAIC0xMzk2LDcgKzEzNTQsNiBAQCBzdGF0
aWMgaW50IGlndF9yZXNldF9xdWV1ZSh2b2lkICphcmcpCiAKIAlpZ3RfZ2xvYmFsX3Jlc2V0X2xv
Y2soZ3QpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVy
ciA9IGhhbmdfaW5pdCgmaCwgZ3QpOwogCWlmIChlcnIpCiAJCWdvdG8gdW5sb2NrOwpAQCAtMTUx
MSw3ICsxNDY4LDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogCiAJ
CWk5MTVfcmVxdWVzdF9wdXQocHJldik7CiAKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5
MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7
CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBAIC0xNTE5LDcgKzE0NzYsNiBAQCBzdGF0aWMg
aW50IGlndF9yZXNldF9xdWV1ZSh2b2lkICphcmcpCiBmaW5pOgogCWhhbmdfZmluaSgmaCk7CiB1
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWd0
X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOwogCiAJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkp
CkBAIC0xNTQ2LDExICsxNTAyLDkgQEAgc3RhdGljIGludCBpZ3RfaGFuZGxlX2Vycm9yKHZvaWQg
KmFyZykKIAlpZiAoIWVuZ2luZSB8fCAhaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdp
bmUpKQogCQlyZXR1cm4gMDsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCWVyciA9IGhhbmdfaW5pdCgmaCwgZ3QpOwogCWlmIChlcnIpCi0JCWdvdG8gZXJy
X3VubG9jazsKKwkJcmV0dXJuIGVycjsKIAogCXJxID0gaGFuZ19jcmVhdGVfcmVxdWVzdCgmaCwg
ZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJxKSkgewpAQCAtMTU3NCw4ICsxNTI4LDYgQEAgc3RhdGlj
IGludCBpZ3RfaGFuZGxlX2Vycm9yKHZvaWQgKmFyZykKIAkJZ290byBlcnJfcmVxdWVzdDsKIAl9
CiAKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCS8qIFRl
bXBvcmFyaWx5IGRpc2FibGUgZXJyb3IgY2FwdHVyZSAqLwogCWVycm9yID0geGNoZygmZ2xvYmFs
LT5maXJzdF9lcnJvciwgKHZvaWQgKiktMSk7CiAKQEAgLTE1ODMsOCArMTUzNSw2IEBAIHN0YXRp
YyBpbnQgaWd0X2hhbmRsZV9lcnJvcih2b2lkICphcmcpCiAKIAl4Y2hnKCZnbG9iYWwtPmZpcnN0
X2Vycm9yLCBlcnJvcik7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAlpZiAocnEtPmZlbmNlLmVycm9yICE9IC1FSU8pIHsKIAkJcHJfZXJyKCJHdWlsdHkg
cmVxdWVzdCBub3QgaWRlbnRpZmllZCFcbiIpOwogCQllcnIgPSAtRUlOVkFMOwpAQCAtMTU5NSw4
ICsxNTQ1LDYgQEAgc3RhdGljIGludCBpZ3RfaGFuZGxlX2Vycm9yKHZvaWQgKmFyZykKIAlpOTE1
X3JlcXVlc3RfcHV0KHJxKTsKIGVycl9maW5pOgogCWhhbmdfZmluaSgmaCk7Ci1lcnJfdW5sb2Nr
OgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBl
cnI7CiB9CiAKQEAgLTE2ODksNyArMTYzNyw2IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X2VuZ2lu
ZXNfYXRvbWljKHZvaWQgKmFyZykKIAkJcmV0dXJuIDA7CiAKIAlpZ3RfZ2xvYmFsX3Jlc2V0X2xv
Y2soZ3QpOwotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCS8q
IEZsdXNoIGFueSByZXF1ZXN0cyBiZWZvcmUgd2UgZ2V0IHN0YXJ0ZWQgYW5kIGNoZWNrIGJhc2lj
cyAqLwogCWlmICghaWd0X2ZvcmNlX3Jlc2V0KGd0KSkKQEAgLTE3MDksOSArMTY1Niw3IEBAIHN0
YXRpYyBpbnQgaWd0X3Jlc2V0X2VuZ2luZXNfYXRvbWljKHZvaWQgKmFyZykKIG91dDoKIAkvKiBB
cyB3ZSBwb2tlIGFyb3VuZCB0aGUgZ3V0cywgZG8gYSBmdWxsIHJlc2V0IGJlZm9yZSBjb250aW51
aW5nLiAqLwogCWlndF9mb3JjZV9yZXNldChndCk7Ci0KIHVubG9jazoKLQltdXRleF91bmxvY2so
Jmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhn
dCk7CiAKIAlyZXR1cm4gZXJyOwpAQCAtMTc1MSwxMCArMTY5Niw2IEBAIGludCBpbnRlbF9oYW5n
Y2hlY2tfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAll
cnIgPSBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCBndCk7CiAKLQltdXRleF9sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5
MTVfV0FJVF9MT0NLRUQpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotCiAJaTkxNV9tb2RwYXJhbXMuZW5hYmxlX2hhbmdjaGVjayA9IHNhdmVkX2hhbmdjaGVj
azsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYp
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IGFjYTFiM2E5YzVk
ZS4uMjIyYTczNzVjNzg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpA
QCAtNjEsNyArNjEsNyBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQog
CQl9CiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsKLQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5
MTUsIEk5MTVfV0FJVF9MT0NLRUQpKSB7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkgewog
CQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eDsKIAkJfQpAQCAtMjA2LDggKzIwNiw3IEBA
IHNsaWNlX3NlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpvdXRlciwKIAlp
ZiAoZXJyKQogCQlnb3RvIG91dDsKIAotCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChoZWFkLAotCQkJ
ICAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQoaGVhZCwgMCwK
IAkJCSAgICAgIDIgKiBSVU5USU1FX0lORk8ob3V0ZXItPmk5MTUpLT5udW1fZW5naW5lcyAqIChj
b3VudCArIDIpICogKGNvdW50ICsgMykpIDwgMCkgewogCQlwcl9lcnIoIkZhaWxlZCB0byBzbGlj
ZSBhbG9uZyBzZW1hcGhvcmUgY2hhaW4gb2YgbGVuZ3RoICglZCwgJWQpIVxuIiwKIAkJICAgICAg
IGNvdW50LCBuKTsKQEAgLTI3OSw3ICsyNzgsNyBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNl
X3ByZWVtcHQodm9pZCAqYXJnKQogCQkJaWYgKGVycikKIAkJCQlnb3RvIGVycl9waW47CiAKLQkJ
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkgeworCQkJaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUpKSB7CiAJCQkJZXJyID0gLUVJTzsKIAkJCQlnb3RvIGVycl9waW47
CiAJCQl9CkBAIC04MzIsNyArODMxLDcgQEAgc3RhdGljIGludCBsaXZlX25vcHJlZW1wdCh2b2lk
ICphcmcpCiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAJCX0KIAotCQlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJ
CWdvdG8gZXJyX3dlZGdlZDsKIAl9CiAKQEAgLTk0OCw3ICs5NDcsNyBAQCBzdGF0aWMgaW50IGxp
dmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyX2NsaWVudF9i
OwogCQl9CiAKLQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQor
CQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAJfQogCkBA
IC0xMTA5LDcgKzExMDgsNyBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0
KHZvaWQgKmFyZykKIAkJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsaWVudCk7IGkrKykK
IAkJCQlpZ3Rfc3Bpbm5lcl9lbmQoJmNsaWVudFtpXS5zcGluKTsKIAotCQkJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5
MTUpKQogCQkJCWdvdG8gZXJyX3dlZGdlZDsKIAogCQkJaWYgKGVuZ2luZS0+ZXhlY2xpc3RzLnBy
ZWVtcHRfaGFuZy5jb3VudCkgewpAQCAtMTM4OCw3ICsxMzg3LDcgQEAgc3RhdGljIGludCBsaXZl
X3ByZWVtcHRfaGFuZyh2b2lkICphcmcpCiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2hpKTsK
IAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKLQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUs
IEk5MTVfV0FJVF9MT0NLRUQpKSB7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkgewogCQkJ
ZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eF9sbzsKIAkJfQpAQCAtMTc4NSw3ICsxNzg0LDcg
QEAgc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCXByaW1lLCBkaXY2NF91NjQoa3RpbWVfdG9fbnModGltZXNbMV0pLCBwcmltZSkp
OwogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQor
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobmMgPSAw
OyBuYyA8IG5jdHg7IG5jKyspIHsKQEAgLTE5MzAsNyArMTkyOSw3IEBAIHN0YXRpYyBpbnQgbWFz
a192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZ290byBv
dXQ7CiAKIG91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkp
CisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJZm9yIChuID0g
MDsgbiA8IG5zaWJsaW5nOyBuKyspCkBAIC0yMTA4LDcgKzIxMDcsNyBAQCBzdGF0aWMgaW50IGJv
bmRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiBvdXQ6CiAJ
Zm9yIChuID0gMDsgIUlTX0VSUihycVtuXSk7IG4rKykKIAkJaTkxNV9yZXF1ZXN0X3B1dChycVtu
XSk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChp
Z3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWtlcm5lbF9jb250ZXh0X2Ns
b3NlKGN0eCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90
aW1lbGluZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwpp
bmRleCAzMjE0ODE0MDMxNjUuLjE2YWJmYWJmMDhjNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCkBAIC02LDcgKzYsNyBAQAogCiAjaW5jbHVkZSA8bGlu
dXgvcHJpbWVfbnVtYmVycy5oPgogCi0jaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCisjaW5j
bHVkZSAiaW50ZWxfZW5naW5lX3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKIAogI2luY2x1
ZGUgIi4uL3NlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgpAQCAtMTM2LDcgKzEzNiw2IEBAIHN0YXRp
YyBpbnQgbW9ja19od3NwX2ZyZWVsaXN0KHZvaWQgKmFyZykKIAkJZ290byBlcnJfcHV0OwogCX0K
IAotCW11dGV4X2xvY2soJnN0YXRlLmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWZvciAocCA9
IHBoYXNlczsgcC0+bmFtZTsgcCsrKSB7CiAJCXByX2RlYnVnKCIlcyglcylcbiIsIF9fZnVuY19f
LCBwLT5uYW1lKTsKIAkJZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20obmEsIDEsIDIgKiBDQUNI
RUxJTkVTX1BFUl9QQUdFKSB7CkBAIC0xNDksNyArMTQ4LDYgQEAgc3RhdGljIGludCBtb2NrX2h3
c3BfZnJlZWxpc3Qodm9pZCAqYXJnKQogb3V0OgogCWZvciAobmEgPSAwOyBuYSA8IHN0YXRlLm1h
eDsgbmErKykKIAkJX19tb2NrX2h3c3BfcmVjb3JkKCZzdGF0ZSwgbmEsIE5VTEwpOwotCW11dGV4
X3VubG9jaygmc3RhdGUuaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJa2ZyZWUoc3RhdGUuaGlz
dG9yeSk7CiBlcnJfcHV0OgogCWRybV9kZXZfcHV0KCZzdGF0ZS5pOTE1LT5kcm0pOwpAQCAtNDQ5
LDggKzQ0Nyw2IEBAIHRsX3dyaXRlKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsIHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMyIHZhbHVlKQogCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxOwogCWludCBlcnI7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+Z3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOyAvKiBsYXp5IHJxIHJlZnMgKi8KLQogCWVyciA9IGludGVsX3RpbWVs
aW5lX3Bpbih0bCk7CiAJaWYgKGVycikgewogCQlycSA9IEVSUl9QVFIoZXJyKTsKQEAgLTQ2MSwx
MCArNDU3LDE0IEBAIHRsX3dyaXRlKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsIHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMyIHZhbHVlKQogCWlmIChJU19FUlIocnEpKQogCQln
b3RvIG91dF91bnBpbjsKIAorCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCiAJZXJyID0gZW1pdF9n
Z3R0X3N0b3JlX2R3KHJxLCB0bC0+aHdzcF9vZmZzZXQsIHZhbHVlKTsKIAlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKLQlpZiAoZXJyKQorCWlmIChlcnIpIHsKKwkJaTkxNV9yZXF1ZXN0X3B1dChycSk7
CiAJCXJxID0gRVJSX1BUUihlcnIpOworCX0KIAogb3V0X3VucGluOgogCWludGVsX3RpbWVsaW5l
X3VucGluKHRsKTsKQEAgLTUwMCw3ICs1MDAsNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9lbmdp
bmUodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqKnRpbWVsaW5lczsKIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0J
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJdW5zaWduZWQgbG9uZyBjb3VudCwgbjsKIAlpbnQg
ZXJyID0gMDsKIApAQCAtNTE1LDE0ICs1MTQsMTMgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfZW5n
aW5lKHZvaWQgKmFyZykKIAlpZiAoIXRpbWVsaW5lcykKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJY291bnQgPSAwOwogCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCWlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9y
ZV9kd29yZChlbmdpbmUpKQogCQkJY29udGludWU7CiAKKwkJaW50ZWxfZW5naW5lX3BtX2dldChl
bmdpbmUpOworCiAJCWZvciAobiA9IDA7IG4gPCBOVU1fVElNRUxJTkVTOyBuKyspIHsKIAkJCXN0
cnVjdCBpbnRlbF90aW1lbGluZSAqdGw7CiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKQEAg
LTUzMCwyMiArNTI4LDI2IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2VuZ2luZSh2b2lkICphcmcp
CiAJCQl0bCA9IGNoZWNrZWRfaW50ZWxfdGltZWxpbmVfY3JlYXRlKGk5MTUpOwogCQkJaWYgKElT
X0VSUih0bCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHRsKTsKLQkJCQlnb3RvIG91dDsKKwkJCQli
cmVhazsKIAkJCX0KIAogCQkJcnEgPSB0bF93cml0ZSh0bCwgZW5naW5lLCBjb3VudCk7CiAJCQlp
ZiAoSVNfRVJSKHJxKSkgewogCQkJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJCQkJZXJyID0g
UFRSX0VSUihycSk7Ci0JCQkJZ290byBvdXQ7CisJCQkJYnJlYWs7CiAJCQl9CiAKIAkJCXRpbWVs
aW5lc1tjb3VudCsrXSA9IHRsOworCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CiAJCX0KKworCQlp
bnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKIAl9CiAK
LW91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJZm9yIChuID0gMDsgbiA8
IGNvdW50OyBuKyspIHsKQEAgLTU1OSwxMSArNTYxLDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bf
ZW5naW5lKHZvaWQgKmFyZykKIAkJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKIAl9CiAKLQlpbnRl
bF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWt2ZnJlZSh0aW1lbGluZXMpOwotCiAJ
cmV0dXJuIGVycjsKICN1bmRlZiBOVU1fVElNRUxJTkVTCiB9CkBAIC01NzUsNyArNTczLDYgQEAg
c3RhdGljIGludCBsaXZlX2h3c3BfYWx0ZXJuYXRlKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgKip0aW1lbGluZXM7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwog
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXVu
c2lnbmVkIGxvbmcgY291bnQsIG47CiAJaW50IGVyciA9IDA7CiAKQEAgLTU5MSw5ICs1ODgsNiBA
QCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5hdGUodm9pZCAqYXJnKQogCWlmICghdGltZWxp
bmVzKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9w
bSk7Ci0KIAljb3VudCA9IDA7CiAJZm9yIChuID0gMDsgbiA8IE5VTV9USU1FTElORVM7IG4rKykg
ewogCQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewpAQCAtNjA1LDExICs1OTks
MTQgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfYWx0ZXJuYXRlKHZvaWQgKmFyZykKIAogCQkJdGwg
PSBjaGVja2VkX2ludGVsX3RpbWVsaW5lX2NyZWF0ZShpOTE1KTsKIAkJCWlmIChJU19FUlIodGwp
KSB7CisJCQkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQkJCWVyciA9IFBUUl9FUlIo
dGwpOwogCQkJCWdvdG8gb3V0OwogCQkJfQogCisJCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2lu
ZSk7CiAJCQlycSA9IHRsX3dyaXRlKHRsLCBlbmdpbmUsIGNvdW50KTsKKwkJCWludGVsX2VuZ2lu
ZV9wbV9wdXQoZW5naW5lKTsKIAkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJaW50ZWxfdGltZWxp
bmVfcHV0KHRsKTsKIAkJCQllcnIgPSBQVFJfRVJSKHJxKTsKQEAgLTYxNywxMSArNjE0LDEyIEBA
IHN0YXRpYyBpbnQgbGl2ZV9od3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiAJCQl9CiAKIAkJCXRp
bWVsaW5lc1tjb3VudCsrXSA9IHRsOworCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CiAJCX0KIAl9
CiAKIG91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJ
aWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJZm9yIChuID0gMDsg
biA8IGNvdW50OyBuKyspIHsKQEAgLTYzNSwxMSArNjMzLDcgQEAgc3RhdGljIGludCBsaXZlX2h3
c3BfYWx0ZXJuYXRlKHZvaWQgKmFyZykKIAkJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKIAl9CiAK
LQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWt2ZnJlZSh0aW1lbGluZXMp
OwotCiAJcmV0dXJuIGVycjsKICN1bmRlZiBOVU1fVElNRUxJTkVTCiB9CkBAIC02NTAsNyArNjQ0
LDYgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGw7CiAJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9
IDA7CiAKIAkvKgpAQCAtNjU4LDE0ICs2NTEsMTAgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3Jh
cCh2b2lkICphcmcpCiAJICogZm9yZWlnbiBHUFUgcmVmZXJlbmNlcy4KIAkgKi8KIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAl0bCA9IGludGVsX3RpbWVsaW5lX2NyZWF0
ZSgmaTkxNS0+Z3QsIE5VTEwpOwotCWlmIChJU19FUlIodGwpKSB7Ci0JCWVyciA9IFBUUl9FUlIo
dGwpOwotCQlnb3RvIG91dF9ycG07Ci0JfQorCWlmIChJU19FUlIodGwpKQorCQlyZXR1cm4gUFRS
X0VSUih0bCk7CisKIAlpZiAoIXRsLT5oYXNfaW5pdGlhbF9icmVhZGNydW1iIHx8ICF0bC0+aHdz
cF9jYWNoZWxpbmUpCiAJCWdvdG8gb3V0X2ZyZWU7CiAKQEAgLTY4MSw3ICs2NzAsOSBAQCBzdGF0
aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykKIAkJaWYgKCFpbnRlbF9lbmdpbmVfY2Fu
X3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAorCQlpbnRlbF9lbmdpbmVfcG1f
Z2V0KGVuZ2luZSk7CiAJCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9j
b250ZXh0KTsKKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQlpZiAoSVNfRVJSKHJx
KSkgewogCQkJZXJyID0gUFRSX0VSUihycSk7CiAJCQlnb3RvIG91dDsKQEAgLTc0NywxNiArNzM4
LDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCX0KIAogb3V0Ogot
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlpbnRlbF90aW1lbGluZV91bnBpbih0
bCk7CiBvdXRfZnJlZToKIAlpbnRlbF90aW1lbGluZV9wdXQodGwpOwotb3V0X3JwbToKLQlpbnRl
bF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldHVybiBlcnI7CiB9CiAKQEAgLTc2
NSw3ICs3NTIsNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50ZWxfd2FrZXJlZl90
IHdha2VyZWY7CiAJdW5zaWduZWQgbG9uZyBjb3VudDsKIAlpbnQgZXJyID0gMDsKIApAQCAtNzc1
LDkgKzc2MSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3JlY3ljbGUodm9pZCAqYXJnKQogCSAq
IHdhbnQgdG8gY29uZnVzZSBvdXJzZWx2ZXMgb3IgdGhlIEdQVS4KIAkgKi8KIAotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3Bt
X2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAljb3VudCA9IDA7CiAJZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwpAQCAtNzg1LDYg
Kzc2OCw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3JlY3ljbGUodm9pZCAqYXJnKQogCQlpZiAo
IWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVlOwogCisJ
CWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKwogCQlkbyB7CiAJCQlzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgKnRsOwogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC03OTIsMjEgKzc3
NywyMiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAkJCXRsID0g
Y2hlY2tlZF9pbnRlbF90aW1lbGluZV9jcmVhdGUoaTkxNSk7CiAJCQlpZiAoSVNfRVJSKHRsKSkg
ewogCQkJCWVyciA9IFBUUl9FUlIodGwpOwotCQkJCWdvdG8gb3V0OworCQkJCWJyZWFrOwogCQkJ
fQogCiAJCQlycSA9IHRsX3dyaXRlKHRsLCBlbmdpbmUsIGNvdW50KTsKIAkJCWlmIChJU19FUlIo
cnEpKSB7CiAJCQkJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKIAkJCQllcnIgPSBQVFJfRVJSKHJx
KTsKLQkJCQlnb3RvIG91dDsKKwkJCQlicmVhazsKIAkJCX0KIAogCQkJaWYgKGk5MTVfcmVxdWVz
dF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkgewogCQkJCXByX2VycigiV2FpdCBmb3IgdGltZWxp
bmUgd3JpdGVzIHRpbWVkIG91dCFcbiIpOworCQkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQkJ
CWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJCQkJZXJyID0gLUVJTzsKLQkJCQlnb3RvIG91dDsK
KwkJCQlicmVhazsKIAkJCX0KIAogCQkJaWYgKCp0bC0+aHdzcF9zZXFubyAhPSBjb3VudCkgewpA
QCAtODE1LDE3ICs4MDEsMTggQEAgc3RhdGljIGludCBsaXZlX2h3c3BfcmVjeWNsZSh2b2lkICph
cmcpCiAJCQkJZXJyID0gLUVJTlZBTDsKIAkJCX0KIAorCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7
CiAJCQlpbnRlbF90aW1lbGluZV9wdXQodGwpOwogCQkJY291bnQrKzsKIAogCQkJaWYgKGVycikK
LQkJCQlnb3RvIG91dDsKKwkJCQlicmVhazsKIAkJfSB3aGlsZSAoIV9faWd0X3RpbWVvdXQoZW5k
X3RpbWUsIE5VTEwpKTsKLQl9CiAKLW91dDoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+
cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQlpZiAoZXJyKQorCQkJYnJl
YWs7CisJfQogCiAJcmV0dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF93b3JrYXJvdW5kcy5jCmluZGV4IDk5OWE5OGYwMDQ5NC4uMDYzNTFmZWZiYmYzIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAg
LTY3Niw3ICs2NzYsNyBAQCBzdGF0aWMgaW50IGNoZWNrX2RpcnR5X3doaXRlbGlzdChzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJYnJlYWs7CiAJfQogCi0JaWYgKGlndF9mbHVzaF90
ZXN0KGN0eC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGN0
eC0+aTkxNSkpCiAJCWVyciA9IC1FSU87CiBvdXRfYmF0Y2g6CiAJaTkxNV92bWFfdW5waW5fYW5k
X3JlbGVhc2UoJmJhdGNoLCAwKTsKQEAgLTEwOTAsNyArMTA5MCw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9pc29sYXRlZF93aGl0ZWxpc3Qodm9pZCAqYXJnKQogCQlrZXJuZWxfY29udGV4dF9jbG9zZShj
bGllbnRbaV0uY3R4KTsKIAl9CiAKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJ
cmV0dXJuIGVycjsKQEAgLTEyNDgsNyArMTI0OCw3IEBAIGxpdmVfZW5naW5lX3Jlc2V0X3dvcmth
cm91bmRzKHZvaWQgKmFyZykKIAlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jaygmaTkxNS0+Z3QpOwog
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAKLQlpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1
X1dBSVRfTE9DS0VEKTsKKwlpZ3RfZmx1c2hfdGVzdChpOTE1KTsKIAogCXJldHVybiByZXQ7CiB9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDMwYjBiNTkyZTIwZC4uNTVmMGZj
MDNhYTNlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzYwMSw2ICszNjAx
LDcgQEAgc3RhdGljIGludAogaTkxNV9kcm9wX2NhY2hlc19zZXQodm9pZCAqZGF0YSwgdTY0IHZh
bCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisJaW50IHJldDsK
IAogCURSTV9ERUJVRygiRHJvcHBpbmcgY2FjaGVzOiAweCUwOGxseCBbMHglMDhsbHhdXG4iLAog
CQkgIHZhbCwgdmFsICYgRFJPUF9BTEwpOwpAQCAtMzYxMCw0MCArMzYxMSwyMSBAQCBpOTE1X2Ry
b3BfY2FjaGVzX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogCQkgICAgIEk5MTVfSURMRV9FTkdJ
TkVTX1RJTUVPVVQpKQogCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAKLQkvKiBO
byBuZWVkIHRvIGNoZWNrIGFuZCB3YWl0IGZvciBncHUgcmVzZXRzLCBvbmx5IGxpYmRybSBhdXRv
LXJlc3RhcnRzCi0JICogb24gaW9jdGxzIG9uIC1FQUdBSU4uICovCi0JaWYgKHZhbCAmIChEUk9Q
X0FDVElWRSB8IERST1BfSURMRSB8IERST1BfUkVUSVJFIHwgRFJPUF9SRVNFVF9TRVFOTykpIHsK
LQkJaW50IHJldDsKKwlpZiAodmFsICYgRFJPUF9SRVRJUkUpCisJCWk5MTVfcmV0aXJlX3JlcXVl
c3RzKGk5MTUpOwogCi0JCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJaWYgKHZhbCAmIChEUk9QX0lETEUgfCBEUk9QX0FDVElWRSkpIHsK
KwkJcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAorCQkJCQkgICAgIEk5MTVfV0FJ
VF9JTlRFUlJVUFRJQkxFLAorCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAkJaWYg
KHJldCkKIAkJCXJldHVybiByZXQ7CisJfQogCi0JCS8qCi0JCSAqIFRvIGZpbmlzaCB0aGUgZmx1
c2ggb2YgdGhlIGlkbGVfd29ya2VyLCB3ZSBtdXN0IGNvbXBsZXRlCi0JCSAqIHRoZSBzd2l0Y2gt
dG8ta2VybmVsLWNvbnRleHQsIHdoaWNoIHJlcXVpcmVzIGEgZG91YmxlCi0JCSAqIHBhc3MgdGhy
b3VnaCB3YWl0X2Zvcl9pZGxlOiBmaXJzdCBxdWV1ZXMgdGhlIHN3aXRjaCwKLQkJICogc2Vjb25k
IHdhaXRzIGZvciB0aGUgc3dpdGNoLgotCQkgKi8KLQkJaWYgKHJldCA9PSAwICYmIHZhbCAmIChE
Uk9QX0lETEUgfCBEUk9QX0FDVElWRSkpCi0JCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxl
KGk5MTUsCi0JCQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkJCSAgICAg
STkxNV9XQUlUX0xPQ0tFRCwKLQkJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCi0J
CWlmIChyZXQgPT0gMCAmJiB2YWwgJiBEUk9QX0lETEUpCi0JCQlyZXQgPSBpOTE1X2dlbV93YWl0
X2Zvcl9pZGxlKGk5MTUsCi0JCQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJ
CQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKLQkJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVP
VVQpOwotCi0JCWlmICh2YWwgJiBEUk9QX1JFVElSRSkKLQkJCWk5MTVfcmV0aXJlX3JlcXVlc3Rz
KGk5MTUpOwotCi0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQkJ
aWYgKHJldCA9PSAwICYmIHZhbCAmIERST1BfSURMRSkKLQkJCXJldCA9IGludGVsX2d0X3BtX3dh
aXRfZm9yX2lkbGUoJmk5MTUtPmd0KTsKKwlpZiAodmFsICYgRFJPUF9JRExFKSB7CisJCXJldCA9
IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoJmk5MTUtPmd0KTsKKwkJaWYgKHJldCkKKwkJCXJl
dHVybiByZXQ7CiAJfQogCiAJaWYgKHZhbCAmIERST1BfUkVTRVRfQUNUSVZFICYmIGludGVsX2d0
X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1LT5ndCkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRl
eCBkMjE2ZGJjNDA2ZmQuLmFhNmNmNTNjNDQyMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBA
IC05NTEsMTkgKzk1MSwxNiBAQCBpbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZiAoIWludGVsX2d0X3BtX2lzX2F3YWtlKCZpOTE1LT5n
dCkpCiAJCXJldHVybiAwOwogCi0JR0VNX1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVs
ZCVzXG4iLAotCQkgIGZsYWdzLCBmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQgPyAibG9ja2VkIiA6
ICJ1bmxvY2tlZCIsCi0JCSAgdGltZW91dCwgdGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9V
VCA/ICIgKGZvcmV2ZXIpIiA6ICIiKTsKLQotCXRpbWVvdXQgPSB3YWl0X2Zvcl90aW1lbGluZXMo
aTkxNSwgZmxhZ3MsIHRpbWVvdXQpOwotCWlmICh0aW1lb3V0IDwgMCkKLQkJcmV0dXJuIHRpbWVv
dXQ7CisJZG8geworCQl0aW1lb3V0ID0gd2FpdF9mb3JfdGltZWxpbmVzKGk5MTUsIGZsYWdzLCB0
aW1lb3V0KTsKKwkJaWYgKHRpbWVvdXQgPCAwKQorCQkJcmV0dXJuIHRpbWVvdXQ7CiAKLQlpZiAo
ZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VEKSB7Ci0JCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCQljb25kX3Jlc2NoZWQoKTsKKwkJaWYgKHNpZ25hbF9wZW5k
aW5nKGN1cnJlbnQpKQorCQkJcmV0dXJuIC1FSU5UUjsKIAotCQlpOTE1X3JldGlyZV9yZXF1ZXN0
cyhpOTE1KTsKLQl9CisJfSB3aGlsZSAoaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSkpOwogCiAJ
cmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCmluZGV4IDMyNTFkMmJk
YmVlYS4uNTdhMjE5M2M2NGQxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlcXVlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaApAQCAt
MzA4LDEwICszMDgsOSBAQCBsb25nIGk5MTVfcmVxdWVzdF93YWl0KHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxLAogCQkgICAgICAgbG9uZyB0aW1lb3V0KQogCV9fYXR0cmlidXRlX18oKG5vbm51bGwo
MSkpKTsKICNkZWZpbmUgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUJQklUKDApCi0jZGVmaW5lIEk5
MTVfV0FJVF9MT0NLRUQJQklUKDEpIC8qIHN0cnVjdF9tdXRleCBoZWxkLCBoYW5kbGUgR1BVIHJl
c2V0ICovCi0jZGVmaW5lIEk5MTVfV0FJVF9QUklPUklUWQlCSVQoMikgLyogc21hbGwgcHJpb3Jp
dHkgYnVtcCBmb3IgdGhlIHJlcXVlc3QgKi8KLSNkZWZpbmUgSTkxNV9XQUlUX0FMTAkJQklUKDMp
IC8qIHVzZWQgYnkgaTkxNV9nZW1fb2JqZWN0X3dhaXQoKSAqLwotI2RlZmluZSBJOTE1X1dBSVRf
Rk9SX0lETEVfQk9PU1QgQklUKDQpCisjZGVmaW5lIEk5MTVfV0FJVF9QUklPUklUWQlCSVQoMSkg
Lyogc21hbGwgcHJpb3JpdHkgYnVtcCBmb3IgdGhlIHJlcXVlc3QgKi8KKyNkZWZpbmUgSTkxNV9X
QUlUX0FMTAkJQklUKDIpIC8qIHVzZWQgYnkgaTkxNV9nZW1fb2JqZWN0X3dhaXQoKSAqLworI2Rl
ZmluZSBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QgQklUKDMpCiAKIHN0YXRpYyBpbmxpbmUgYm9v
bCBpOTE1X3JlcXVlc3Rfc2lnbmFsZWQoY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCmluZGV4IGFm
NTgyN2FhYzdiMi4uZmYxMzM3ZTM0NTIyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9hY3RpdmUuYwpAQCAtMTY0LDEwICsxNjQsOCBAQCBzdGF0aWMgaW50IGxpdmVf
YWN0aXZlX3dhaXQodm9pZCAqYXJnKQogCiAJX19saXZlX3B1dChhY3RpdmUpOwogCi0JbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUs
IEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0g
LUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJcmV0dXJu
IGVycjsKIH0KQEAgLTE4NSwxMCArMTgzLDggQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9yZXRp
cmUodm9pZCAqYXJnKQogCQlyZXR1cm4gUFRSX0VSUihhY3RpdmUpOwogCiAJLyogd2FpdHMgZm9y
ICYgcmV0aXJlcyBhbGwgcmVxdWVzdHMgKi8KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJ
aWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoIVJFQURfT05DRShhY3RpdmUtPnJldGly
ZWQpKSB7CiAJCXByX2VycigiaTkxNV9hY3RpdmUgbm90IHJldGlyZWQgYWZ0ZXIgZmx1c2hpbmch
XG4iKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0
LmMKaW5kZXggYmE2MDY0MTQ3MTczLi40MjEzOWRiMGQ2OWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCkBAIC01MjEsNyArNTIxLDcgQEAg
c3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCiAJbXV0ZXhfbG9jaygm
aTkxNS0+Z2d0dC52bS5tdXRleCk7CiBvdXRfbG9ja2VkOgotCWlmIChpZ3RfZmx1c2hfdGVzdChp
OTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVy
ciA9IC1FSU87CiAJd2hpbGUgKHJlc2VydmVkKSB7CiAJCXN0cnVjdCByZXNlcnZlZCAqbmV4dCA9
IHJlc2VydmVkLT5uZXh0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2d0dC5jCmluZGV4IGYxYTYzZDA0NWJjYi4uZWQ2ZTI3MjI1MmYzIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCkBAIC0xNzA5LDEyICsxNzA5
LDggQEAgaW50IGk5MTVfZ2VtX2d0dF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCiAJZXJyID0gaTkx
NV9zdWJ0ZXN0cyh0ZXN0cywgZ2d0dCk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1
KTsKLQogCW1vY2tfZmluaV9nZ3R0KGdndHQpOwogCWtmcmVlKGdndHQpOwogb3V0X3B1dDoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwppbmRleCBiMzY4
ODU0M2VkN2QuLmQwNDYzOTU4NDVkYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X3JlcXVlc3QuYwpAQCAtNDEsMjEgKzQxLDE2IEBAIHN0YXRpYyBpbnQgaWd0X2Fk
ZF9yZXF1ZXN0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGFyZzsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OwotCWludCBlcnIgPSAtRU5PTUVN
OwogCiAJLyogQmFzaWMgcHJlbGltaW5hcnkgdGVzdCB0byBjcmVhdGUgYSByZXF1ZXN0IGFuZCBs
ZXQgaXQgbG9vc2UhICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlyZXF1ZXN0ID0gbW9ja19yZXF1ZXN0KGk5MTUtPmVuZ2luZVtSQ1MwXS0+a2VybmVsX2NvbnRl
eHQsIEhaIC8gMTApOwogCWlmICghcmVxdWVzdCkKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1
cm4gLUVOT01FTTsKIAogCWk5MTVfcmVxdWVzdF9hZGQocmVxdWVzdCk7CiAKLQllcnIgPSAwOwot
b3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXJl
dHVybiBlcnI7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgaWd0X3dhaXRfcmVxdWVzdCh2
b2lkICphcmcpCkBAIC02NywxMiArNjIsMTAgQEAgc3RhdGljIGludCBpZ3Rfd2FpdF9yZXF1ZXN0
KHZvaWQgKmFyZykKIAogCS8qIFN1Ym1pdCBhIHJlcXVlc3QsIHRoZW4gd2FpdCB1cG9uIGl0ICov
CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXF1ZXN0ID0gbW9j
a19yZXF1ZXN0KGk5MTUtPmVuZ2luZVtSQ1MwXS0+a2VybmVsX2NvbnRleHQsIFQpOwotCWlmICgh
cmVxdWVzdCkgewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIG91dF91bmxvY2s7Ci0JfQorCWlm
ICghcmVxdWVzdCkKKwkJcmV0dXJuIC1FTk9NRU07CisKIAlpOTE1X3JlcXVlc3RfZ2V0KHJlcXVl
c3QpOwogCiAJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJlcXVlc3QsIDAsIDApICE9IC1FVElNRSkg
ewpAQCAtMTI1LDkgKzExOCw3IEBAIHN0YXRpYyBpbnQgaWd0X3dhaXRfcmVxdWVzdCh2b2lkICph
cmcpCiAJZXJyID0gMDsKIG91dF9yZXF1ZXN0OgogCWk5MTVfcmVxdWVzdF9wdXQocmVxdWVzdCk7
Ci1vdXRfdW5sb2NrOgogCW1vY2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTQwLDUyICsx
MzEsNDUgQEAgc3RhdGljIGludCBpZ3RfZmVuY2Vfd2FpdCh2b2lkICphcmcpCiAKIAkvKiBTdWJt
aXQgYSByZXF1ZXN0LCB0cmVhdCBpdCBhcyBhIGZlbmNlIGFuZCB3YWl0IHVwb24gaXQgKi8KIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJlcXVlc3QgPSBtb2NrX3Jl
cXVlc3QoaTkxNS0+ZW5naW5lW1JDUzBdLT5rZXJuZWxfY29udGV4dCwgVCk7Ci0JaWYgKCFyZXF1
ZXN0KSB7Ci0JCWVyciA9IC1FTk9NRU07Ci0JCWdvdG8gb3V0X2xvY2tlZDsKLQl9CisJaWYgKCFy
ZXF1ZXN0KQorCQlyZXR1cm4gLUVOT01FTTsKIAogCWlmIChkbWFfZmVuY2Vfd2FpdF90aW1lb3V0
KCZyZXF1ZXN0LT5mZW5jZSwgZmFsc2UsIFQpICE9IC1FVElNRSkgewogCQlwcl9lcnIoImZlbmNl
IHdhaXQgc3VjY2VzcyBiZWZvcmUgc3VibWl0IChleHBlY3RlZCB0aW1lb3V0KSFcbiIpOwotCQln
b3RvIG91dF9sb2NrZWQ7CisJCWdvdG8gb3V0OwogCX0KIAogCWk5MTVfcmVxdWVzdF9hZGQocmVx
dWVzdCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWlmIChk
bWFfZmVuY2VfaXNfc2lnbmFsZWQoJnJlcXVlc3QtPmZlbmNlKSkgewogCQlwcl9lcnIoImZlbmNl
IHNpZ25hbGVkIGltbWVkaWF0ZWx5IVxuIik7Ci0JCWdvdG8gb3V0X2RldmljZTsKKwkJZ290byBv
dXQ7CiAJfQogCiAJaWYgKGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoJnJlcXVlc3QtPmZlbmNlLCBm
YWxzZSwgVCAvIDIpICE9IC1FVElNRSkgewogCQlwcl9lcnIoImZlbmNlIHdhaXQgc3VjY2VzcyBh
ZnRlciBzdWJtaXQgKGV4cGVjdGVkIHRpbWVvdXQpIVxuIik7Ci0JCWdvdG8gb3V0X2RldmljZTsK
KwkJZ290byBvdXQ7CiAJfQogCiAJaWYgKGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoJnJlcXVlc3Qt
PmZlbmNlLCBmYWxzZSwgVCkgPD0gMCkgewogCQlwcl9lcnIoImZlbmNlIHdhaXQgdGltZWQgb3V0
IChleHBlY3RlZCBzdWNjZXNzKSFcbiIpOwotCQlnb3RvIG91dF9kZXZpY2U7CisJCWdvdG8gb3V0
OwogCX0KIAogCWlmICghZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKCZyZXF1ZXN0LT5mZW5jZSkpIHsK
IAkJcHJfZXJyKCJmZW5jZSB1bnNpZ25hbGVkIGFmdGVyIHdhaXRpbmchXG4iKTsKLQkJZ290byBv
dXRfZGV2aWNlOworCQlnb3RvIG91dDsKIAl9CiAKIAlpZiAoZG1hX2ZlbmNlX3dhaXRfdGltZW91
dCgmcmVxdWVzdC0+ZmVuY2UsIGZhbHNlLCBUKSA8PSAwKSB7CiAJCXByX2VycigiZmVuY2Ugd2Fp
dCB0aW1lZCBvdXQgd2hlbiBjb21wbGV0ZSAoZXhwZWN0ZWQgc3VjY2VzcykhXG4iKTsKLQkJZ290
byBvdXRfZGV2aWNlOworCQlnb3RvIG91dDsKIAl9CiAKIAllcnIgPSAwOwotb3V0X2RldmljZToK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLW91dF9sb2NrZWQ6CitvdXQ6
CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0xOTksNiArMTgzLDggQEAgc3RhdGlj
IGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJnKQogCiAJbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4WzBdID0gbW9ja19jb250ZXh0KGk5MTUsICJBIik7CisJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwogCWNlID0gaTkxNV9nZW1f
Y29udGV4dF9nZXRfZW5naW5lKGN0eFswXSwgUkNTMCk7CiAJR0VNX0JVR19PTihJU19FUlIoY2Up
KTsKIAlyZXF1ZXN0ID0gbW9ja19yZXF1ZXN0KGNlLCAyICogSFopOwpAQCAtMjExLDcgKzE5Nywx
MCBAQCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJaTkxNV9yZXF1
ZXN0X2dldChyZXF1ZXN0KTsKIAlpOTE1X3JlcXVlc3RfYWRkKHJlcXVlc3QpOwogCisJbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4WzFdID0gbW9ja19jb250ZXh0KGk5
MTUsICJCIik7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwogCWNl
ID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eFsxXSwgUkNTMCk7CiAJR0VNX0JVR19P
TihJU19FUlIoY2UpKTsKIAl2aXAgPSBtb2NrX3JlcXVlc3QoY2UsIDApOwpAQCAtMjMzLDcgKzIy
Miw2IEBAIHN0YXRpYyBpbnQgaWd0X3JlcXVlc3RfcmV3aW5kKHZvaWQgKmFyZykKIAlyZXF1ZXN0
LT5lbmdpbmUtPnN1Ym1pdF9yZXF1ZXN0KHJlcXVlc3QpOwogCXJjdV9yZWFkX3VubG9jaygpOwog
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWlmIChpOTE1X3Jl
cXVlc3Rfd2FpdCh2aXAsIDAsIEhaKSA9PSAtRVRJTUUpIHsKIAkJcHJfZXJyKCJ0aW1lZCBvdXQg
d2FpdGluZyBmb3IgaGlnaCBwcmlvcml0eSByZXF1ZXN0XG4iKTsKQEAgLTI0OCwxNCArMjM2LDEy
IEBAIHN0YXRpYyBpbnQgaWd0X3JlcXVlc3RfcmV3aW5kKHZvaWQgKmFyZykKIAllcnIgPSAwOwog
ZXJyOgogCWk5MTVfcmVxdWVzdF9wdXQodmlwKTsKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIGVycl9jb250ZXh0XzE6CiAJbW9ja19jb250ZXh0X2Nsb3NlKGN0eFsxXSk7
CiAJaTkxNV9yZXF1ZXN0X3B1dChyZXF1ZXN0KTsKIGVycl9jb250ZXh0XzA6CiAJbW9ja19jb250
ZXh0X2Nsb3NlKGN0eFswXSk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0yODIs
NyArMjY4LDYgQEAgX19saXZlX3JlcXVlc3RfYWxsb2Moc3RydWN0IGludGVsX2NvbnRleHQgKmNl
KQogc3RhdGljIGludCBfX2lndF9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogewog
CXN0cnVjdCBzbW9rZXRlc3QgKnQgPSBhcmc7Ci0Jc3RydWN0IG11dGV4ICogY29uc3QgQktMID0g
JnQtPmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleDsKIAljb25zdCB1bnNpZ25lZCBpbnQg
bWF4X2JhdGNoID0gbWluKHQtPm5jb250ZXh0cywgdC0+bWF4X2JhdGNoKSAtIDE7CiAJY29uc3Qg
dW5zaWduZWQgaW50IHRvdGFsID0gNCAqIHQtPm5jb250ZXh0cyArIDE7CiAJdW5zaWduZWQgaW50
IG51bV93YWl0cyA9IDAsIG51bV9mZW5jZXMgPSAwOwpAQCAtMzM3LDE0ICszMjIsMTEgQEAgc3Rh
dGljIGludCBfX2lndF9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCQkJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnE7CiAJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKLQkJCW11
dGV4X2xvY2soQktMKTsKLQogCQkJY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4
LCB0LT5lbmdpbmUtPmxlZ2FjeV9pZHgpOwogCQkJR0VNX0JVR19PTihJU19FUlIoY2UpKTsKIAkJ
CXJxID0gdC0+cmVxdWVzdF9hbGxvYyhjZSk7CiAJCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJ
CQlpZiAoSVNfRVJSKHJxKSkgewotCQkJCW11dGV4X3VubG9jayhCS0wpOwogCQkJCWVyciA9IFBU
Ul9FUlIocnEpOwogCQkJCWNvdW50ID0gbjsKIAkJCQlicmVhazsKQEAgLTM1Nyw4ICszMzksNiBA
QCBzdGF0aWMgaW50IF9faWd0X2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJCQly
ZXF1ZXN0c1tuXSA9IGk5MTVfcmVxdWVzdF9nZXQocnEpOwogCQkJaTkxNV9yZXF1ZXN0X2FkZChy
cSk7CiAKLQkJCW11dGV4X3VubG9jayhCS0wpOwotCiAJCQlpZiAoZXJyID49IDApCiAJCQkJZXJy
ID0gaTkxNV9zd19mZW5jZV9hd2FpdF9kbWFfZmVuY2Uod2FpdCwKIAkJCQkJCQkJICAgICZycS0+
ZmVuY2UsCkBAIC00NTcsMTUgKzQzNywxNSBAQCBzdGF0aWMgaW50IG1vY2tfYnJlYWRjcnVtYnNf
c21va2V0ZXN0KHZvaWQgKmFyZykKIAkJZ290byBvdXRfdGhyZWFkczsKIAl9CiAKLQltdXRleF9s
b2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZm9yIChuID0gMDsgbiA8
IHQubmNvbnRleHRzOyBuKyspIHsKKwkJbXV0ZXhfbG9jaygmdC5lbmdpbmUtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCQl0LmNvbnRleHRzW25dID0gbW9ja19jb250ZXh0KHQuZW5naW5lLT5p
OTE1LCAibW9jayIpOworCQltdXRleF91bmxvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJaWYgKCF0LmNvbnRleHRzW25dKSB7CiAJCQlyZXQgPSAtRU5PTUVNOwogCQkJ
Z290byBvdXRfY29udGV4dHM7CiAJCX0KIAl9Ci0JbXV0ZXhfdW5sb2NrKCZ0LmVuZ2luZS0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlmb3IgKG4gPSAwOyBuIDwgbmNwdXM7IG4rKykgewog
CQl0aHJlYWRzW25dID0ga3RocmVhZF9ydW4oX19pZ3RfYnJlYWRjcnVtYnNfc21va2V0ZXN0LApA
QCAtNDk1LDE4ICs0NzUsMTUgQEAgc3RhdGljIGludCBtb2NrX2JyZWFkY3J1bWJzX3Ntb2tldGVz
dCh2b2lkICphcmcpCiAJCWF0b21pY19sb25nX3JlYWQoJnQubnVtX2ZlbmNlcyksCiAJCW5jcHVz
KTsKIAotCW11dGV4X2xvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIG91
dF9jb250ZXh0czoKIAlmb3IgKG4gPSAwOyBuIDwgdC5uY29udGV4dHM7IG4rKykgewogCQlpZiAo
IXQuY29udGV4dHNbbl0pCiAJCQlicmVhazsKIAkJbW9ja19jb250ZXh0X2Nsb3NlKHQuY29udGV4
dHNbbl0pOwogCX0KLQltdXRleF91bmxvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAlrZnJlZSh0LmNvbnRleHRzKTsKIG91dF90aHJlYWRzOgogCWtmcmVlKHRocmVhZHMp
OwotCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtNTM5LDcgKzUxNiw2IEBAIHN0YXRpYyBpbnQgbGl2
ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWludGVsX3dha2Vy
ZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJdW5zaWduZWQgaW50IGlk
OwogCWludCBlcnIgPSAtRU5PREVWOwpAQCAtNTQ5LDkgKzUyNSw2IEBAIHN0YXRpYyBpbnQgbGl2
ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcpCiAJICogdGhlIG92ZXJoZWFkIG9mIHN1Ym1pdHRpbmcg
cmVxdWVzdHMgdG8gdGhlIGhhcmR3YXJlLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5y
dW50aW1lX3BtKTsKLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QgPSBOVUxMOwogCQl1bnNpZ25lZCBsb25nIG4sIHBy
aW1lOwpAQCAtNTYwLDE3ICs1MzMsMTUgQEAgc3RhdGljIGludCBsaXZlX25vcF9yZXF1ZXN0KHZv
aWQgKmFyZykKIAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNf
XywgZW5naW5lLT5uYW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCXJl
dHVybiBlcnI7CiAKIAkJZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20ocHJpbWUsIDEsIDgxOTIp
IHsKIAkJCXRpbWVzWzFdID0ga3RpbWVfZ2V0X3JhdygpOwogCiAJCQlmb3IgKG4gPSAwOyBuIDwg
cHJpbWU7IG4rKykgewogCQkJCXJlcXVlc3QgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+
a2VybmVsX2NvbnRleHQpOwotCQkJCWlmIChJU19FUlIocmVxdWVzdCkpIHsKLQkJCQkJZXJyID0g
UFRSX0VSUihyZXF1ZXN0KTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOwotCQkJCX0KKwkJCQlpZiAo
SVNfRVJSKHJlcXVlc3QpKQorCQkJCQlyZXR1cm4gUFRSX0VSUihyZXF1ZXN0KTsKIAogCQkJCS8q
IFRoaXMgc3BhY2UgaXMgbGVmdCBpbnRlbnRpb25hbGx5IGJsYW5rLgogCQkJCSAqCkBAIC01OTks
NyArNTcwLDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9yZXF1ZXN0KHZvaWQgKmFyZykKIAogCQll
cnIgPSBpZ3RfbGl2ZV90ZXN0X2VuZCgmdCk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxv
Y2s7CisJCQlyZXR1cm4gZXJyOwogCiAJCXByX2luZm8oIlJlcXVlc3QgbGF0ZW5jaWVzIG9uICVz
OiAxID0gJWxsdW5zLCAlbHUgPSAlbGx1bnNcbiIsCiAJCQllbmdpbmUtPm5hbWUsCkBAIC02MDcs
OSArNTc4LDYgQEAgc3RhdGljIGludCBsaXZlX25vcF9yZXF1ZXN0KHZvaWQgKmFyZykKIAkJCXBy
aW1lLCBkaXY2NF91NjQoa3RpbWVfdG9fbnModGltZXNbMV0pLCBwcmltZSkpOwogCX0KIAotb3V0
X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJl
Zik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJy
OwogfQogCkBAIC02ODEsNyArNjQ5LDYgQEAgc3RhdGljIGludCBsaXZlX2VtcHR5X3JlcXVlc3Qo
dm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsK
IAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCXN0cnVjdCBpOTE1X3ZtYSAqYmF0Y2g7CiAJdW5z
aWduZWQgaW50IGlkOwpAQCAtNjkyLDE0ICs2NTksOSBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlf
cmVxdWVzdCh2b2lkICphcmcpCiAJICogdGhlIG92ZXJoZWFkIG9mIHN1Ym1pdHRpbmcgcmVxdWVz
dHMgdG8gdGhlIGhhcmR3YXJlLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1l
X3BtKTsKLQogCWJhdGNoID0gZW1wdHlfYmF0Y2goaTkxNSk7Ci0JaWYgKElTX0VSUihiYXRjaCkp
IHsKLQkJZXJyID0gUFRSX0VSUihiYXRjaCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKLQl9CisJaWYg
KElTX0VSUihiYXRjaCkpCisJCXJldHVybiBQVFJfRVJSKGJhdGNoKTsKIAogCWZvcl9lYWNoX2Vu
Z2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKQEAgLTc1
Miw5ICs3MTQsNiBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiBv
dXRfYmF0Y2g6CiAJaTkxNV92bWFfdW5waW4oYmF0Y2gpOwogCWk5MTVfdm1hX3B1dChiYXRjaCk7
Ci1vdXRfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3
YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVy
biBlcnI7CiB9CiAKQEAgLTgzNCw3ICs3OTMsNiBAQCBzdGF0aWMgaW50IGxpdmVfYWxsX2VuZ2lu
ZXModm9pZCAqYXJnKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1
ZXN0W0k5MTVfTlVNX0VOR0lORVNdOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXN0cnVj
dCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAl1bnNpZ25lZCBp
bnQgaWQ7CkBAIC04NDUsMTggKzgwMywxNSBAQCBzdGF0aWMgaW50IGxpdmVfYWxsX2VuZ2luZXMo
dm9pZCAqYXJnKQogCSAqIGJsb2NrIGRvaW5nIHNvLCBhbmQgdGhhdCB0aGV5IGRvbid0IGNvbXBs
ZXRlIHRvbyBzb29uLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsK
LQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJ
aWYgKGVycikKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4gZXJyOwogCiAJYmF0Y2ggPSBy
ZWN1cnNpdmVfYmF0Y2goaTkxNSk7CiAJaWYgKElTX0VSUihiYXRjaCkpIHsKIAkJZXJyID0gUFRS
X0VSUihiYXRjaCk7CiAJCXByX2VycigiJXM6IFVuYWJsZSB0byBjcmVhdGUgYmF0Y2gsIGVycj0l
ZFxuIiwgX19mdW5jX18sIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIGVycjsK
IAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewpAQCAtOTI2LDkgKzg4
MSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9hbGxfZW5naW5lcyh2b2lkICphcmcpCiAJCQlpOTE1X3Jl
cXVlc3RfcHV0KHJlcXVlc3RbaWRdKTsKIAlpOTE1X3ZtYV91bnBpbihiYXRjaCk7CiAJaTkxNV92
bWFfcHV0KGJhdGNoKTsKLW91dF91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUt
PnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtOTM4LDcgKzg5MCw2IEBAIHN0YXRpYyBpbnQg
bGl2ZV9zZXF1ZW50aWFsX2VuZ2luZXModm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJlcXVlc3RbSTkxNV9OVU1fRU5HSU5FU10gPSB7fTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpw
cmV2ID0gTlVMTDsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JaW50ZWxfd2Fr
ZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAl1bnNpZ25lZCBpbnQg
aWQ7CiAJaW50IGVycjsKQEAgLTk0OSwxMiArOTAwLDkgQEAgc3RhdGljIGludCBsaXZlX3NlcXVl
bnRpYWxfZW5naW5lcyh2b2lkICphcmcpCiAJICogdGhleSBhcmUgcnVubmluZyBvbiBpbmRlcGVu
ZGVudCBlbmdpbmVzLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsK
LQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJ
aWYgKGVycikKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4gZXJyOwogCiAJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKQEAg
LTk2NCw3ICs5MTIsNyBAQCBzdGF0aWMgaW50IGxpdmVfc2VxdWVudGlhbF9lbmdpbmVzKHZvaWQg
KmFyZykKIAkJCWVyciA9IFBUUl9FUlIoYmF0Y2gpOwogCQkJcHJfZXJyKCIlczogVW5hYmxlIHRv
IGNyZWF0ZSBiYXRjaCBmb3IgJXMsIGVycj0lZFxuIiwKIAkJCSAgICAgICBfX2Z1bmNfXywgZW5n
aW5lLT5uYW1lLCBlcnIpOwotCQkJZ290byBvdXRfdW5sb2NrOworCQkJcmV0dXJuIGVycjsKIAkJ
fQogCiAJCXJlcXVlc3RbaWRdID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9j
b250ZXh0KTsKQEAgLTEwNTYsOSArMTAwNCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9zZXF1ZW50aWFs
X2VuZ2luZXModm9pZCAqYXJnKQogCQlpOTE1X3ZtYV9wdXQocmVxdWVzdFtpZF0tPmJhdGNoKTsK
IAkJaTkxNV9yZXF1ZXN0X3B1dChyZXF1ZXN0W2lkXSk7CiAJfQotb3V0X3VubG9jazoKLQlpbnRl
bF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0xMTQ5
LDkgKzEwOTQsMTAgQEAgc3RhdGljIGludCBsaXZlX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lk
ICphcmcpCiAJCWdvdG8gb3V0X3RocmVhZHM7CiAJfQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJZm9yIChuID0gMDsgbiA8IHRbMF0ubmNvbnRleHRzOyBuKyspIHsK
KwkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXRbMF0uY29udGV4dHNb
bl0gPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CisJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJCWlmICghdFswXS5jb250ZXh0c1tuXSkgewogCQkJcmV0ID0gLUVO
T01FTTsKIAkJCWdvdG8gb3V0X2NvbnRleHRzOwpAQCAtMTE2OCw3ICsxMTE0LDYgQEAgc3RhdGlj
IGludCBsaXZlX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJCXRbaWRdLm1heF9i
YXRjaCA9IG1heF9iYXRjaGVzKHRbMF0uY29udGV4dHNbMF0sIGVuZ2luZSk7CiAJCWlmICh0W2lk
XS5tYXhfYmF0Y2ggPCAwKSB7CiAJCQlyZXQgPSB0W2lkXS5tYXhfYmF0Y2g7Ci0JCQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQkJZ290byBvdXRfZmx1c2g7CiAJCX0K
IAkJLyogT25lIHJpbmcgaW50ZXJsZWF2ZWQgYmV0d2VlbiByZXF1ZXN0cyBmcm9tIGFsbCBjcHVz
ICovCkBAIC0xMTgzLDcgKzExMjgsNiBAQCBzdGF0aWMgaW50IGxpdmVfYnJlYWRjcnVtYnNfc21v
a2V0ZXN0KHZvaWQgKmFyZykKIAkJCQkJICAmdFtpZF0sICJpZ3QvJWQuJWQiLCBpZCwgbik7CiAJ
CQlpZiAoSVNfRVJSKHRzaykpIHsKIAkJCQlyZXQgPSBQVFJfRVJSKHRzayk7Ci0JCQkJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQlnb3RvIG91dF9mbHVzaDsKIAkJ
CX0KIApAQCAtMTE5MSw3ICsxMTM1LDYgQEAgc3RhdGljIGludCBsaXZlX2JyZWFkY3J1bWJzX3Nt
b2tldGVzdCh2b2lkICphcmcpCiAJCQl0aHJlYWRzW2lkICogbmNwdXMgKyBuXSA9IHRzazsKIAkJ
fQogCX0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJbXNsZWVw
KGppZmZpZXNfdG9fbXNlY3MoaTkxNV9zZWxmdGVzdC50aW1lb3V0X2ppZmZpZXMpKTsKIApAQCAt
MTIxOSwxMCArMTE2Miw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9icmVhZGNydW1ic19zbW9rZXRlc3Qo
dm9pZCAqYXJnKQogCXByX2luZm8oIkNvbXBsZXRlZCAlbHUgd2FpdHMgZm9yICVsdSBmZW5jZXMg
YWNyb3NzICVkIGVuZ2luZXMgYW5kICVkIGNwdXNcbiIsCiAJCW51bV93YWl0cywgbnVtX2ZlbmNl
cywgUlVOVElNRV9JTkZPKGk5MTUpLT5udW1fZW5naW5lcywgbmNwdXMpOwogCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0ID0gaWd0X2xpdmVfdGVzdF9lbmQoJmxp
dmUpID86IHJldDsKIG91dF9jb250ZXh0czoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWtmcmVlKHRbMF0uY29udGV4dHMpOwogb3V0X3RocmVhZHM6CiAJa2ZyZWUo
dGhyZWFkcyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9zZWxmdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRl
c3QuYwppbmRleCA0MzhlYTBlYWE0MTYuLjgyNWE4Mjg2Y2JlOCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jCkBAIC0yNjMsMTAgKzI2Myw4IEBA
IGludCBfX2k5MTVfbGl2ZV90ZWFyZG93bihpbnQgZXJyLCB2b2lkICpkYXRhKQogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9D
S0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVk
X29iamVjdHMoaTkxNSk7CiAKQEAgLTI4NCwxMCArMjgyLDggQEAgaW50IF9faW50ZWxfZ3RfbGl2
ZV90ZWFyZG93bihpbnQgZXJyLCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBkYXRhOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlm
IChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9m
bHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmd0LT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMo
Z3QtPmk5MTUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCmlu
ZGV4IGYxNDFjNjhlNzk3OC4uZGE5MjI3NDg5ZWZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtODM1LDEyICs4MzUsOCBAQCBpbnQgaTkxNV92bWFfbW9j
a19zZWxmdGVzdHModm9pZCkKIAogCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGdndHQpOwog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1
c2goaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5
MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7Ci0KIAltb2NrX2ZpbmlfZ2d0dChnZ3R0
KTsKIAlrZnJlZShnZ3R0KTsKIG91dF9wdXQ6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCmluZGV4IGQzYjVlYjQwMmQzMy4uMmE1ZmJlNDZlYTlm
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rl
c3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3Qu
YwpAQCAtMTIsMzEgKzEyLDI1IEBACiAKICNpbmNsdWRlICJpZ3RfZmx1c2hfdGVzdC5oIgogCi1p
bnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVuc2lnbmVk
IGludCBmbGFncykKK2ludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAlpbnQgcmV0ID0gaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkgPyAtRUlP
IDogMDsKLQlpbnQgcmVwZWF0ID0gISEoZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VEKTsKIAogCWNv
bmRfcmVzY2hlZCgpOwogCi0JZG8gewotCQlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1
LCBmbGFncywgSFogLyA1KSA9PSAtRVRJTUUpIHsKLQkJCXByX2VycigiJXBTIHRpbWVkIG91dCwg
Y2FuY2VsbGluZyBhbGwgZnVydGhlciB0ZXN0aW5nLlxuIiwKLQkJCSAgICAgICBfX2J1aWx0aW5f
cmV0dXJuX2FkZHJlc3MoMCkpOworCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOworCWlmIChp
OTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIDAsIEhaIC8gNSkgPT0gLUVUSU1FKSB7CisJCXBy
X2VycigiJXBTIHRpbWVkIG91dCwgY2FuY2VsbGluZyBhbGwgZnVydGhlciB0ZXN0aW5nLlxuIiwK
KwkJICAgICAgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7CiAKLQkJCUdFTV9UUkFDRSgi
JXBTIHRpbWVkIG91dC5cbiIsCi0JCQkJICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwot
CQkJR0VNX1RSQUNFX0RVTVAoKTsKKwkJR0VNX1RSQUNFKCIlcFMgdGltZWQgb3V0LlxuIiwKKwkJ
CSAgX19idWlsdGluX3JldHVybl9hZGRyZXNzKDApKTsKKwkJR0VNX1RSQUNFX0RVTVAoKTsKIAot
CQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwotCQkJcmVwZWF0ID0gMDsKLQkJCXJl
dCA9IC1FSU87Ci0JCX0KLQotCQkvKiBFbnN1cmUgd2UgYWxzbyBmbHVzaCBhZnRlciB3ZWRnaW5n
LiAqLwotCQlpZiAoZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VEKQotCQkJaTkxNV9yZXRpcmVfcmVx
dWVzdHMoaTkxNSk7Ci0JfSB3aGlsZSAocmVwZWF0LS0pOworCQlpbnRlbF9ndF9zZXRfd2VkZ2Vk
KCZpOTE1LT5ndCk7CisJCXJldCA9IC1FSU87CisJfQorCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5
MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9mbHVzaF90ZXN0LmgKaW5kZXggNjNlMDA5OTI3YzQzLi43NTQxZmE3NGU2NDEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oCkBA
IC05LDYgKzksNiBAQAogCiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIAotaW50IGlndF9mbHVz
aF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1bnNpZ25lZCBpbnQgZmxhZ3Mp
OworaW50IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAog
I2VuZGlmIC8qIElHVF9GTFVTSF9URVNUX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCmluZGV4IDNlOTAyNzYxY2QxNi4uMDRhNmY4OGZkZjY0
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVz
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMK
QEAgLTE5LDE1ICsxOSwxMiBAQCBpbnQgaWd0X2xpdmVfdGVzdF9iZWdpbihzdHJ1Y3QgaWd0X2xp
dmVfdGVzdCAqdCwKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQgZXJyOwogCi0JbG9j
a2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAl0LT5pOTE1ID0g
aTkxNTsKIAl0LT5mdW5jID0gZnVuYzsKIAl0LT5uYW1lID0gbmFtZTsKIAogCWVyciA9IGk5MTVf
Z2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxF
IHwKLQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCisJCQkJICAgICBJOTE1X1dBSVRfSU5URVJS
VVBUSUJMRSwKIAkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAlpZiAoZXJyKSB7CiAJ
CXByX2VycigiJXMoJXMpOiBmYWlsZWQgdG8gaWRsZSBiZWZvcmUsIHdpdGggZXJyPSVkISIsCkBA
IC01MCw5ICs0Nyw3IEBAIGludCBpZ3RfbGl2ZV90ZXN0X2VuZChzdHJ1Y3QgaWd0X2xpdmVfdGVz
dCAqdCkKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdp
bmVfaWQgaWQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAo
aWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCXJldHVybiAtRUlPOwogCiAJaWYgKHQtPnJlc2V0X2ds
b2JhbCAhPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpKSB7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5kZXggMDFhODlj
MDcxYmY1Li4xOTU2MDA2YTBkNWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTQxLDggKzQxLDYgQEAgdm9pZCBtb2NrX2Rldmlj
ZV9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRvIHsKIAkJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCQltb2NrX2VuZ2luZV9mbHVzaChlbmdpbmUpOwpA
QCAtNTUsOSArNTMsNyBAQCBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9yZWxlYXNlKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAogCWZsdXNoX3dvcmsoJmk5MTUtPmdlbS5pZGxlX3dvcmspOwogCWk5
MTVfZ2VtX2RyYWluX3dvcmtxdWV1ZShpOTE1KTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

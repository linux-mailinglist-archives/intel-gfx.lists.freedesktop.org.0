Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AA6DBDC64A
	for <lists+intel-gfx@lfdr.de>; Fri, 18 Oct 2019 15:39:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A3F056EB51;
	Fri, 18 Oct 2019 13:39:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B4FD86EB4C;
 Fri, 18 Oct 2019 13:39:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18883048-1500050 
 for multiple; Fri, 18 Oct 2019 14:38:58 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 18 Oct 2019 14:38:54 +0100
Message-Id: <20191018133855.31743-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191018133855.31743-1-chris@chris-wilson.co.uk>
References: <20191018133855.31743-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 2/3] i915: Exercise sysfs heartbeat
 controls
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0t
LQogdGVzdHMvTWFrZWZpbGUuc291cmNlcyAgICAgICAgICAgICAgICB8ICAgMSArCiB0ZXN0cy9p
OTE1L3N5c2ZzX2hlYXJ0YmVhdF9pbnRlcnZhbC5jIHwgNDMwICsrKysrKysrKysrKysrKysrKysr
KysrKysrCiB0ZXN0cy9tZXNvbi5idWlsZCAgICAgICAgICAgICAgICAgICAgIHwgICAxICsKIDMg
ZmlsZXMgY2hhbmdlZCwgNDMyIGluc2VydGlvbnMoKykKIGNyZWF0ZSBtb2RlIDEwMDY0NCB0ZXN0
cy9pOTE1L3N5c2ZzX2hlYXJ0YmVhdF9pbnRlcnZhbC5jCgpkaWZmIC0tZ2l0IGEvdGVzdHMvTWFr
ZWZpbGUuc291cmNlcyBiL3Rlc3RzL01ha2VmaWxlLnNvdXJjZXMKaW5kZXggZGZmN2RhYzA2Li40
NDk0ZDJjMDUgMTAwNjQ0Ci0tLSBhL3Rlc3RzL01ha2VmaWxlLnNvdXJjZXMKKysrIGIvdGVzdHMv
TWFrZWZpbGUuc291cmNlcwpAQCAtOTgsNiArOTgsNyBAQCBURVNUU19wcm9ncyA9IFwKIAl0b29s
c190ZXN0IFwKIAl2Z2VtX2Jhc2ljIFwKIAl2Z2VtX3Nsb3cgXAorCWk5MTUvc3lzZnNfaGVhcnRi
ZWF0X2ludGVydmFsIFwKIAlpOTE1L3N5c2ZzX3ByZWVtcHRpb25fdGltZW91dCBcCiAJJChOVUxM
KQogCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L3N5c2ZzX2hlYXJ0YmVhdF9pbnRlcnZhbC5jIGIv
dGVzdHMvaTkxNS9zeXNmc19oZWFydGJlYXRfaW50ZXJ2YWwuYwpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAuLjQ2NzMzYWNlZQotLS0gL2Rldi9udWxsCisrKyBiL3Rlc3RzL2k5
MTUvc3lzZnNfaGVhcnRiZWF0X2ludGVydmFsLmMKQEAgLTAsMCArMSw0MzAgQEAKKy8qCisgKiBD
b3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICoKKyAqIFBlcm1pc3Npb24gaXMg
aGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBh
CisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBm
aWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91
dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0
cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1Ymxp
Y2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVy
bWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBz
bywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3Zl
IGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0
aGUgbmV4dAorICogcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9y
IHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZQorICogU29mdHdhcmUuCisgKgorICogVEhFIFNP
RlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQs
IEVYUFJFU1MgT1IKKyAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhF
IFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNV
TEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBU
SEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwg
REFNQUdFUyBPUiBPVEhFUgorICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBD
T05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJ
TiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElO
R1MKKyAqIElOIFRIRSBTT0ZUV0FSRS4KKyAqLworCisjaW5jbHVkZSA8ZGlyZW50Lmg+CisjaW5j
bHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxmY250bC5oPgorI2luY2x1ZGUgPGludHR5cGVzLmg+
CisjaW5jbHVkZSA8c2lnbmFsLmg+CisjaW5jbHVkZSA8c3lzL3N0YXQuaD4KKyNpbmNsdWRlIDxz
eXMvdHlwZXMuaD4KKyNpbmNsdWRlIDxzeXMvd2FpdC5oPgorI2luY2x1ZGUgPHVuaXN0ZC5oPgor
CisjaW5jbHVkZSAiZHJtdGVzdC5oIiAvKiBnZW1fcXVpZXNjZW50X2dwdSgpISAqLworI2luY2x1
ZGUgImlndF9kdW1teWxvYWQuaCIKKyNpbmNsdWRlICJpZ3Rfc3lzZnMuaCIKKyNpbmNsdWRlICJp
b2N0bF93cmFwcGVycy5oIiAvKiBpZ3RfcmVxdWlyZV9nZW0oKSEgKi8KKyNpbmNsdWRlICJzd19z
eW5jLmgiCisKKyNpbmNsdWRlICJpZ3RfZGVidWdmcy5oIgorCitzdGF0aWMgYm9vbCBfX2VuYWJs
ZV9oYW5nY2hlY2soaW50IGRpciwgYm9vbCBzdGF0ZSkKK3sKKwlyZXR1cm4gaWd0X3N5c2ZzX3Nl
dChkaXIsICJlbmFibGVfaGFuZ2NoZWNrIiwgc3RhdGUgPyAiMSIgOiAiMCIpOworfQorCitzdGF0
aWMgdm9pZCBlbmFibGVfaGFuZ2NoZWNrKGludCBpOTE1LCBib29sIHN0YXRlKQoreworCWludCBk
aXI7CisKKwlkaXIgPSBpZ3Rfc3lzZnNfb3Blbl9wYXJhbWV0ZXJzKGk5MTUpOworCWlmIChkaXIg
PCAwKSAvKiBubyBwYXJhbWV0ZXJzLCBtdXN0IGJlIGRlZmF1bHQhICovCisJCXJldHVybjsKKwor
CV9fZW5hYmxlX2hhbmdjaGVjayhkaXIsIHN0YXRlKTsKKwljbG9zZShkaXIpOworfQorCitzdGF0
aWMgdm9pZCBzZXRfaGVhcnRiZWF0KGludCBlbmdpbmUsIHVuc2lnbmVkIGludCB2YWx1ZSkKK3sK
Kwl1bnNpZ25lZCBpbnQgZGVsYXk7CisKKwlpZ3Rfc3lzZnNfcHJpbnRmKGVuZ2luZSwgImhlYXJ0
YmVhdF9pbnRlcnZhbF9tcyIsICIldSIsIHZhbHVlKTsKKwlpZ3Rfc3lzZnNfc2NhbmYoZW5naW5l
LCAiaGVhcnRiZWF0X2ludGVydmFsX21zIiwgIiV1IiwgJmRlbGF5KTsKKwlpZ3RfYXNzZXJ0X2Vx
KGRlbGF5LCB2YWx1ZSk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfaWRlbXBvdGVudChpbnQgaTkx
NSwgaW50IGVuZ2luZSkKK3sKKwl1bnNpZ25lZCBpbnQgc2F2ZWQ7CisKKwlpZ3RfYXNzZXJ0KGln
dF9zeXNmc19zY2FuZihlbmdpbmUsICJoZWFydGJlYXRfaW50ZXJ2YWxfbXMiLCAiJXUiLCAmc2F2
ZWQpID09IDEpOworCWlndF9kZWJ1ZygiSW5pdGlhbCBoZWFydGJlYXRfaW50ZXJ2YWxfbXM6JXVc
biIsIHNhdmVkKTsKKworCXNldF9oZWFydGJlYXQoZW5naW5lLCAxKTsKKwlzZXRfaGVhcnRiZWF0
KGVuZ2luZSwgc2F2ZWQpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X2ludmFsaWQoaW50IGk5MTUs
IGludCBlbmdpbmUpCit7CisJdW5zaWduZWQgaW50IHNhdmVkLCBkZWxheTsKKworCWlndF9hc3Nl
cnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgImhlYXJ0YmVhdF9pbnRlcnZhbF9tcyIsICIldSIs
ICZzYXZlZCkgPT0gMSk7CisJaWd0X2RlYnVnKCJJbml0aWFsIGhlYXJ0YmVhdF9pbnRlcnZhbF9t
czoldVxuIiwgc2F2ZWQpOworCisJaWd0X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJoZWFydGJlYXRf
aW50ZXJ2YWxfbXMiLCBQUkl1NjQsIC0xKTsKKwlpZ3Rfc3lzZnNfc2NhbmYoZW5naW5lLCAiaGVh
cnRiZWF0X2ludGVydmFsX21zIiwgIiV1IiwgJmRlbGF5KTsKKwlpZ3RfYXNzZXJ0X2VxKGRlbGF5
LCBzYXZlZCk7CisKKwlpZ3Rfc3lzZnNfcHJpbnRmKGVuZ2luZSwgImhlYXJ0YmVhdF9pbnRlcnZh
bF9tcyIsIFBSSXU2NCwgMTB1bGwgPDwgMzIpOworCWlndF9zeXNmc19zY2FuZihlbmdpbmUsICJo
ZWFydGJlYXRfaW50ZXJ2YWxfbXMiLCAiJXUiLCAmZGVsYXkpOworCWlndF9hc3NlcnRfZXEoZGVs
YXksIHNhdmVkKTsKK30KKworc3RhdGljIHZvaWQgc2V0X3VuYmFubmFibGUoaW50IGk5MTUsIHVp
bnQzMl90IGN0eCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gcCA9IHsK
KwkJLmN0eF9pZCA9IGN0eCwKKwkJLnBhcmFtID0gSTkxNV9DT05URVhUX1BBUkFNX0JBTk5BQkxF
LAorCX07CisKKwlpZ3RfYXNzZXJ0X2VxKF9fZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZw
KSwgMCk7Cit9CisKK3N0YXRpYyB1aW50MzJfdCBjcmVhdGVfY29udGV4dChpbnQgaTkxNSwgdW5z
aWduZWQgaW50IGNsYXNzLCB1bnNpZ25lZCBpbnQgaW5zdCwgaW50IHByaW8pCit7CisJdWludDMy
X3QgY3R4OworCisJY3R4ID0gZ2VtX2NvbnRleHRfY3JlYXRlX2Zvcl9lbmdpbmUoaTkxNSwgY2xh
c3MsIGluc3QpOworCXNldF91bmJhbm5hYmxlKGk5MTUsIGN0eCk7CisJZ2VtX2NvbnRleHRfc2V0
X3ByaW9yaXR5KGk5MTUsIGN0eCwgcHJpbyk7CisKKwlyZXR1cm4gY3R4OworfQorCitzdGF0aWMg
dWludDY0X3QgX190ZXN0X3RpbWVvdXQoaW50IGk5MTUsIGludCBlbmdpbmUsIHVuc2lnbmVkIGlu
dCB0aW1lb3V0KQoreworCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKKwlzdHJ1Y3QgdGltZXNw
ZWMgdHMgPSB7fTsKKwlpZ3Rfc3Bpbl90ICpzcGluWzJdOworCXVpbnQ2NF90IGVsYXBzZWQ7CisJ
dWludDMyX3QgY3R4WzJdOworCisJaWd0X2Fzc2VydChpZ3Rfc3lzZnNfc2NhbmYoZW5naW5lLCAi
Y2xhc3MiLCAiJXUiLCAmY2xhc3MpID09IDEpOworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5m
KGVuZ2luZSwgImluc3RhbmNlIiwgIiV1IiwgJmluc3QpID09IDEpOworCisJc2V0X2hlYXJ0YmVh
dChlbmdpbmUsIHRpbWVvdXQpOworCisJY3R4WzBdID0gY3JlYXRlX2NvbnRleHQoaTkxNSwgY2xh
c3MsIGluc3QsIDEwMjMpOworCXNwaW5bMF0gPSBpZ3Rfc3Bpbl9uZXcoaTkxNSwgY3R4WzBdLAor
CQkJICAgICAgIC5mbGFncyA9IChJR1RfU1BJTl9OT19QUkVFTVBUSU9OIHwKKwkJCQkJIElHVF9T
UElOX1BPTExfUlVOIHwKKwkJCQkJIElHVF9TUElOX0ZFTkNFX09VVCkpOworCWlndF9zcGluX2J1
c3l3YWl0X3VudGlsX3N0YXJ0ZWQoc3BpblswXSk7CisKKwljdHhbMV0gPSBjcmVhdGVfY29udGV4
dChpOTE1LCBjbGFzcywgaW5zdCwgLTEwMjMpOworCWlndF9uc2VjX2VsYXBzZWQoJnRzKTsKKwlz
cGluWzFdID0gaWd0X3NwaW5fbmV3KGk5MTUsIGN0eFsxXSwgLmZsYWdzID0gSUdUX1NQSU5fUE9M
TF9SVU4pOworCWlndF9zcGluX2J1c3l3YWl0X3VudGlsX3N0YXJ0ZWQoc3BpblsxXSk7CisJZWxh
cHNlZCA9IGlndF9uc2VjX2VsYXBzZWQoJnRzKTsKKworCWlndF9zcGluX2ZyZWUoaTkxNSwgc3Bp
blsxXSk7CisKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfd2FpdChzcGluWzBdLT5vdXRfZmVu
Y2UsIDEpLCAwKTsKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfc3RhdHVzKHNwaW5bMF0tPm91
dF9mZW5jZSksIC1FSU8pOworCisJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluWzBdKTsKKworCWdl
bV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4WzFdKTsKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5
MTUsIGN0eFswXSk7CisJZ2VtX3F1aWVzY2VudF9ncHUoaTkxNSk7CisKKwlyZXR1cm4gZWxhcHNl
ZDsKK30KKworc3RhdGljIHZvaWQgdGVzdF9wcmVjaXNlKGludCBpOTE1LCBpbnQgZW5naW5lKQor
eworCWludCBkZWxheXNbXSA9IHsgMSwgNTAsIDEwMCwgNTAwIH07CisJdW5zaWduZWQgaW50IHNh
dmVkOworCisJaWd0X3JlcXVpcmUoaWd0X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJwcmVlbXB0X3Rp
bWVvdXRfbXMiLCAiJXUiLCAxKSA9PSAxKTsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5m
KGVuZ2luZSwgImhlYXJ0YmVhdF9pbnRlcnZhbF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJ
aWd0X2RlYnVnKCJJbml0aWFsIGhlYXJ0YmVhdF9pbnRlcnZhbF9tczoldVxuIiwgc2F2ZWQpOwor
CWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKGRlbGF5cyk7IGkrKykgeworCQl1aW50NjRfdCBlbGFwc2VkOworCisJCWVsYXBzZWQgPSBf
X3Rlc3RfdGltZW91dChpOTE1LCBlbmdpbmUsIGRlbGF5c1tpXSk7CisJCWlndF9pbmZvKCJoZWFy
dGJlYXRfaW50ZXJ2YWxfbXM6JWQsIGVsYXBzZWQ9JS4zZm1zWyVkXVxuIiwKKwkJCSBkZWxheXNb
aV0sIGVsYXBzZWQgKiAxZS02LAorCQkJCShpbnQpKGVsYXBzZWQgLyAxMDAwIC8gMTAwMCkKKwkJ
CSApOworCisJCS8qCisJCSAqIEl0IHRha2VzIGEgY291cGxlIG9mIG1pc3NlZCBoZWFydGJlYXRz
IGJlZm9yZSB3ZSBzdGFydAorCQkgKiB0ZXJtaW5hdGluZyBob2dzLCBhbmQgYSBsaXR0bGUgYml0
IG9mIGppZmZpZSBzbGFjayBmb3IKKwkJICogc2NoZWR1bGluZyBhdCBlYWNoIHN0ZXAuIDE1MG1z
IHNob3VsZCBjb3ZlciBhbGwgb2Ygb3VyCisJCSAqIHNpbnMgYW5kIGJlIHVzZWZ1bCB0b2xlcmFu
Y2UuCisJCSAqLworCQlpZ3RfYXNzZXJ0X2YoZWxhcHNlZCAvIDEwMDAgLyAxMDAwIDwgMyAqIGRl
bGF5c1tpXSArIDE1MCwKKwkJCSAgICAgIkhlYXJ0YmVhdCBpbnRlcnZhbCAoYW5kIENQUikgZXhj
ZWVkZWQgcmVxdWVzdCFcbiIpOworCX0KKworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCXNl
dF9oZWFydGJlYXQoZW5naW5lLCBzYXZlZCk7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3Rfbm9wcmVl
bXB0KGludCBpOTE1LCBpbnQgZW5naW5lKQoreworCWludCBkZWxheXNbXSA9IHsgMSwgNTAsIDEw
MCwgNTAwIH07CisJdW5zaWduZWQgaW50IHNhdmVkOworCisJLyogVGVzdCBoZWFydGJlYXRzIHdp
dGggZm9yY2VkIHByZWVtcHRpb24gIGRpc2FibGVkICovCisJaWd0X3N5c2ZzX3ByaW50Zihlbmdp
bmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAwKTsKKworCWlndF9hc3NlcnQoaWd0X3N5
c2ZzX3NjYW5mKGVuZ2luZSwgImhlYXJ0YmVhdF9pbnRlcnZhbF9tcyIsICIldSIsICZzYXZlZCkg
PT0gMSk7CisJaWd0X2RlYnVnKCJJbml0aWFsIGhlYXJ0YmVhdF9pbnRlcnZhbF9tczoldVxuIiwg
c2F2ZWQpOworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCisJZm9yIChpbnQgaSA9IDA7IGkg
PCBBUlJBWV9TSVpFKGRlbGF5cyk7IGkrKykgeworCQl1aW50NjRfdCBlbGFwc2VkOworCisJCWVs
YXBzZWQgPSBfX3Rlc3RfdGltZW91dChpOTE1LCBlbmdpbmUsIGRlbGF5c1tpXSk7CisJCWlndF9p
bmZvKCJoZWFydGJlYXRfaW50ZXJ2YWxfbXM6JWQsIGVsYXBzZWQ9JS4zZm1zWyVkXVxuIiwKKwkJ
CSBkZWxheXNbaV0sIGVsYXBzZWQgKiAxZS02LAorCQkJCShpbnQpKGVsYXBzZWQgLyAxMDAwIC8g
MTAwMCkKKwkJCSApOworCisJCS8qCisJCSAqIEl0IHRha2VzIGEgc2V2ZXJhbCBtaXNzZWQgaGVh
cnRiZWF0cyBiZWZvcmUgd2Ugc3RhcnQKKwkJICogdGVybWluYXRpbmcgaG9ncywgYW5kIGEgbGl0
dGxlIGJpdCBvZiBqaWZmaWUgc2xhY2sgZm9yCisJCSAqIHNjaGVkdWxpbmcgYXQgZWFjaCBzdGVw
LiAyNTBtcyBzaG91bGQgY292ZXIgYWxsIG9mIG91cgorCQkgKiBzaW5zIGFuZCBiZSB1c2VmdWwg
dG9sZXJhbmNlLgorCQkgKi8KKwkJaWd0X2Fzc2VydF9mKGVsYXBzZWQgLyAxMDAwIC8gMTAwMCA8
IDUgKiBkZWxheXNbaV0gKyAxNTAsCisJCQkgICAgICJIZWFydGJlYXQgaW50ZXJ2YWwgKGFuZCBD
UFIpIGV4Y2VlZGVkIHJlcXVlc3QhXG4iKTsKKwl9CisKKwlnZW1fcXVpZXNjZW50X2dwdShpOTE1
KTsKKwlzZXRfaGVhcnRiZWF0KGVuZ2luZSwgc2F2ZWQpOworfQorCitzdGF0aWMgdm9pZCBjbGll
bnQoaW50IGk5MTUsIGludCBlbmdpbmUsIGludCAqY3RsLCBpbnQgZHVyYXRpb24sIGludCBleHBl
Y3QpCit7CisJdW5zaWduZWQgaW50IGNsYXNzLCBpbnN0OworCXVuc2lnbmVkIGxvbmcgY291bnQg
PSAwOworCXVpbnQzMl90IGN0eDsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2lu
ZSwgImNsYXNzIiwgIiV1IiwgJmNsYXNzKSA9PSAxKTsKKwlpZ3RfYXNzZXJ0KGlndF9zeXNmc19z
Y2FuZihlbmdpbmUsICJpbnN0YW5jZSIsICIldSIsICZpbnN0KSA9PSAxKTsKKworCWN0eCA9IGNy
ZWF0ZV9jb250ZXh0KGk5MTUsIGNsYXNzLCBpbnN0LCAwKTsKKworCXdoaWxlICghUkVBRF9PTkNF
KCpjdGwpKSB7CisJCWlndF9zcGluX3QgKnNwaW47CisKKwkJc3BpbiA9IGlndF9zcGluX25ldyhp
OTE1LCBjdHgsCisJCQkJICAgIC5mbGFncyA9IChJR1RfU1BJTl9OT19QUkVFTVBUSU9OIHwKKwkJ
CQkJICAgICAgSUdUX1NQSU5fUE9MTF9SVU4gfAorCQkJCQkgICAgICBJR1RfU1BJTl9GRU5DRV9P
VVQpKTsKKwkJaWd0X3NwaW5fYnVzeXdhaXRfdW50aWxfc3RhcnRlZChzcGluKTsKKworCQlpZ3Rf
c3Bpbl9zZXRfdGltZW91dChzcGluLCAodWludDY0X3QpZHVyYXRpb24gKiAxMDAwICogMTAwMCk7
CisJCXN5bmNfZmVuY2Vfd2FpdChzcGluLT5vdXRfZmVuY2UsIC0xKTsKKworCQlpZ3RfYXNzZXJ0
X2VxKHN5bmNfZmVuY2Vfc3RhdHVzKHNwaW4tPm91dF9mZW5jZSksIGV4cGVjdCk7CisJCWNvdW50
Kys7CisJfQorCisJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjdHgpOworCWlndF9pbmZvKCIl
cyBjbGllbnQgY29tcGxldGVkICVsdSBzcGluc1xuIiwKKwkJIGV4cGVjdCA8IDAgPyAiQmFkIiA6
ICJHb29kIiwgY291bnQpOworfQorCitzdGF0aWMgdm9pZCBzaWdpZ24oaW50IHNpZykKK3sKK30K
Kworc3RhdGljIHZvaWQgd2FpdF91bnRpbChpbnQgZHVyYXRpb24pCit7CisJc2lnbmFsKFNJR0NI
TEQsIHNpZ2lnbik7CisJc2xlZXAoZHVyYXRpb24pOworCXNpZ25hbChTSUdDSExELCBTSUdfSUdO
KTsKK30KKworc3RhdGljIHZvaWQgX190ZXN0X21peGVkKGludCBpOTE1LCBpbnQgZW5naW5lLAor
CQkJIGludCBoZWFydGJlYXQsCisJCQkgaW50IGdvb2QsCisJCQkgaW50IGJhZCwKKwkJCSBpbnQg
ZHVyYXRpb24pCit7CisJdW5zaWduZWQgaW50IHNhdmVkOworCWludCAqc2hhcmVkOworCisJLyoK
KwkgKiBHaXZlbiB0d28gY2xpZW50cyBvZiB3aGljaCBvbmUgaXMgYSBob2csIGJlIHN1cmUgd2Ug
Y2xlYW5seQorCSAqIHRlcm1pbmF0ZSB0aGUgaG9nIGxlYXZpbmcgdGhlIGdvb2QgY2xpZW50IHRv
IHJ1bi4KKwkgKi8KKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgImhlYXJ0
YmVhdF9pbnRlcnZhbF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0X2RlYnVnKCJJbml0
aWFsIGhlYXJ0YmVhdF9pbnRlcnZhbF9tczoldVxuIiwgc2F2ZWQpOworCWdlbV9xdWllc2NlbnRf
Z3B1KGk5MTUpOworCisJc2hhcmVkID0gbW1hcChOVUxMLCA0MDk2LCBQUk9UX1dSSVRFLCBNQVBf
U0hBUkVEIHwgTUFQX0FOT04sIC0xLCAwKTsKKwlpZ3RfYXNzZXJ0KHNoYXJlZCAhPSBNQVBfRkFJ
TEVEKTsKKworCXNldF9oZWFydGJlYXQoZW5naW5lLCBoZWFydGJlYXQpOworCisJaWd0X2Zvcmso
Y2hpbGQsIDEpIC8qIGdvb2QgY2xpZW50ICovCisJCWNsaWVudChpOTE1LCBlbmdpbmUsIHNoYXJl
ZCwgZ29vZCwgMSk7CisJaWd0X2ZvcmsoY2hpbGQsIDEpIC8qIGJhZCBjbGllbnQgKi8KKwkJY2xp
ZW50KGk5MTUsIGVuZ2luZSwgc2hhcmVkLCBiYWQsIC1FSU8pOworCisJd2FpdF91bnRpbChkdXJh
dGlvbik7CisKKwkqc2hhcmVkID0gdHJ1ZTsKKwlpZ3Rfd2FpdGNoaWxkcmVuKCk7CisJbXVubWFw
KHNoYXJlZCwgNDA5Nik7CisKKwlnZW1fcXVpZXNjZW50X2dwdShpOTE1KTsKKwlzZXRfaGVhcnRi
ZWF0KGVuZ2luZSwgc2F2ZWQpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X21peGVkKGludCBpOTE1
LCBpbnQgZW5naW5lKQoreworCWlndF9zeXNmc19wcmludGYoZW5naW5lLCAicHJlZW1wdF90aW1l
b3V0X21zIiwgIiV1IiwgMSk7CisJX190ZXN0X21peGVkKGk5MTUsIGVuZ2luZSwgMTAsIDEwLCAx
MDAsIDUpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X2xvbmcoaW50IGk5MTUsIGludCBlbmdpbmUp
Cit7CisJaWd0X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUi
LCAwKTsKKwlfX3Rlc3RfbWl4ZWQoaTkxNSwgZW5naW5lLAorCQkgICAgIDYwICogMTAwMCwgLyog
NjBzICovCisJCSAgICAgNjAgKiAxMDAwLCAvKiA2MHMgKi8KKwkJICAgICAzMDAgKiAxMDAwLCAv
KiA1bWluICovCisJCSAgICAgMjQgKiAzNjAwIC8qIDI0aG91cnMgKi8pOworfQorCitzdGF0aWMg
dm9pZCB0ZXN0X29mZihpbnQgaTkxNSwgaW50IGVuZ2luZSkKK3sKKwl1bnNpZ25lZCBpbnQgY2xh
c3MsIGluc3Q7CisJdW5zaWduZWQgaW50IHNhdmVkLCBkZWxheTsKKwlpZ3Rfc3Bpbl90ICpzcGlu
OworCXVpbnQzMl90IGN0eDsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwg
ImhlYXJ0YmVhdF9pbnRlcnZhbF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0X2RlYnVn
KCJJbml0aWFsIGhlYXJ0YmVhdF9pbnRlcnZhbF9tczoldVxuIiwgc2F2ZWQpOworCWdlbV9xdWll
c2NlbnRfZ3B1KGk5MTUpOworCisJaWd0X2Fzc2VydChpZ3Rfc3lzZnNfc2NhbmYoZW5naW5lLCAi
Y2xhc3MiLCAiJXUiLCAmY2xhc3MpID09IDEpOworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5m
KGVuZ2luZSwgImluc3RhbmNlIiwgIiV1IiwgJmluc3QpID09IDEpOworCisJZGVsYXkgPSAtMTsK
KwlpZ3Rfc3lzZnNfcHJpbnRmKGVuZ2luZSwgImhlYXJ0YmVhdF9pbnRlcnZhbF9tcyIsICIldSIs
IDApOworCWlndF9zeXNmc19zY2FuZihlbmdpbmUsICJoZWFydGJlYXRfaW50ZXJ2YWxfbXMiLCAi
JXUiLCAmZGVsYXkpOworCWlndF9yZXF1aXJlKGRlbGF5ID09IDApOworCisJY3R4ID0gY3JlYXRl
X2NvbnRleHQoaTkxNSwgY2xhc3MsIGluc3QsIDApOworCisJc3BpbiA9IGlndF9zcGluX25ldyhp
OTE1LCBjdHgsCisJCQkgICAgLmZsYWdzID0gKElHVF9TUElOX1BPTExfUlVOIHwKKwkJCQkgICAg
ICBJR1RfU1BJTl9OT19QUkVFTVBUSU9OIHwKKwkJCQkgICAgICBJR1RfU1BJTl9GRU5DRV9PVVQp
KTsKKwlpZ3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVkKHNwaW4pOworCisJZm9yIChpbnQg
aSA9IDA7IGkgPCAxNTA7IGkrKykgeworCQlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfc3RhdHVz
KHNwaW4tPm91dF9mZW5jZSksIDApOworCQlzbGVlcCgxKTsKKwl9CisKKwlkZWxheSA9IC0xOwor
CWlndF9zeXNmc19wcmludGYoZW5naW5lLCAiaGVhcnRiZWF0X2ludGVydmFsX21zIiwgIiV1Iiwg
MSk7CisJaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgImhlYXJ0YmVhdF9pbnRlcnZhbF9tcyIsICIl
dSIsICZkZWxheSk7CisJaWd0X2Fzc2VydF9lcShkZWxheSwgMSk7CisKKwlpZ3RfYXNzZXJ0X2Vx
KHN5bmNfZmVuY2Vfd2FpdChzcGluLT5vdXRfZmVuY2UsIDI1MCksIDApOworCWlndF9hc3NlcnRf
ZXEoc3luY19mZW5jZV9zdGF0dXMoc3Bpbi0+b3V0X2ZlbmNlKSwgLUVJTyk7CisKKwlpZ3Rfc3Bp
bl9mcmVlKGk5MTUsIHNwaW4pOworCisJZ2VtX3F1aWVzY2VudF9ncHUoaTkxNSk7CisJaWd0X3N5
c2ZzX3ByaW50ZihlbmdpbmUsICJoZWFydGJlYXRfaW50ZXJ2YWxfbXMiLCAiJXUiLCBzYXZlZCk7
CisJaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgImhlYXJ0YmVhdF9pbnRlcnZhbF9tcyIsICIldSIs
ICZkZWxheSk7CisJaWd0X2Fzc2VydF9lcShkZWxheSwgc2F2ZWQpOworfQorCitpZ3RfbWFpbgor
eworCWludCBpOTE1LCBzeXMgPSAtMTsKKwlzdHJ1Y3QgZGlyZW50ICpkZTsKKwlpbnQgZW5naW5l
czsKKwlESVIgKmRpcjsKKworCWlndF9maXh0dXJlIHsKKwkJaTkxNSA9IGRybV9vcGVuX2RyaXZl
cihEUklWRVJfSU5URUwpOworCQlpZ3RfcmVxdWlyZV9nZW0oaTkxNSk7CisKKwkJc3lzID0gaWd0
X3N5c2ZzX29wZW4oaTkxNSk7CisJCWlndF9yZXF1aXJlKHN5cyAhPSAtMSk7CisKKwkJZW5hYmxl
X2hhbmdjaGVjayhpOTE1LCB0cnVlKTsKKwl9CisKKwllbmdpbmVzID0gb3BlbmF0KHN5cywgImVu
Z2luZSIsIE9fUkRPTkxZKTsKKwlkaXIgPSBmZG9wZW5kaXIoZW5naW5lcyk7CisJd2hpbGUgKGRp
ciAmJiAoZGUgPSByZWFkZGlyKGRpcikpKSB7CisJCWludCBlbmdpbmUgPSBvcGVuYXQoZW5naW5l
cywgZGUtPmRfbmFtZSwgT19SRE9OTFkpOworCQlzdHJ1Y3Qgc3RhdCBzdDsKKwkJY2hhciAqbmFt
ZTsKKworCQluYW1lID0gaWd0X3N5c2ZzX2dldChlbmdpbmUsICJuYW1lIik7CisJCWlmICghbmFt
ZSkKKwkJCWNvbnRpbnVlOworCisJCWlndF9zdWJ0ZXN0X2dyb3VwIHsKKwkJCWlndF9maXh0dXJl
IHsKKwkJCQlpZ3RfcmVxdWlyZShmc3RhdGF0KGVuZ2luZSwKKwkJCQkJCSAgICAiaGVhcnRiZWF0
X2ludGVydmFsX21zIiwKKwkJCQkJCSAgICAmc3QsIDApID09IDApOworCQkJfQorCisJCQlpZ3Rf
c3VidGVzdF9mKCIlcy1pZGVtcG90ZW50IiwgbmFtZSkKKwkJCQl0ZXN0X2lkZW1wb3RlbnQoaTkx
NSwgZW5naW5lKTsKKwkJCWlndF9zdWJ0ZXN0X2YoIiVzLWludmFsaWQiLCBuYW1lKQorCQkJCXRl
c3RfaW52YWxpZChpOTE1LCBlbmdpbmUpOworCisJCQlpZ3Rfc3VidGVzdF9mKCIlcy1wcmVjaXNl
IiwgbmFtZSkKKwkJCQl0ZXN0X3ByZWNpc2UoaTkxNSwgZW5naW5lKTsKKwkJCWlndF9zdWJ0ZXN0
X2YoIiVzLW5vcHJlZW1wdCIsIG5hbWUpCisJCQkJdGVzdF9ub3ByZWVtcHQoaTkxNSwgZW5naW5l
KTsKKwkJCWlndF9zdWJ0ZXN0X2YoIiVzLW1peGVkIiwgbmFtZSkKKwkJCQl0ZXN0X21peGVkKGk5
MTUsIGVuZ2luZSk7CisJCQlpZ3Rfc3VidGVzdF9mKCIlcy1vZmYiLCBuYW1lKQorCQkJCXRlc3Rf
b2ZmKGk5MTUsIGVuZ2luZSk7CisJCQlpZ3Rfc3VidGVzdF9mKCIlcy1sb25nIiwgbmFtZSkKKwkJ
CQl0ZXN0X2xvbmcoaTkxNSwgZW5naW5lKTsKKwkJfQorCisJCWZyZWUobmFtZSk7CisJCWNsb3Nl
KGVuZ2luZSk7CisJfQorCisJaWd0X2ZpeHR1cmUgeworCQljbG9zZShzeXMpOworCQljbG9zZShp
OTE1KTsKKwl9Cit9CmRpZmYgLS1naXQgYS90ZXN0cy9tZXNvbi5idWlsZCBiL3Rlc3RzL21lc29u
LmJ1aWxkCmluZGV4IGE2OTkzNzdlMy4uMjNmNzMwYzIwIDEwMDY0NAotLS0gYS90ZXN0cy9tZXNv
bi5idWlsZAorKysgYi90ZXN0cy9tZXNvbi5idWlsZApAQCAtMjM4LDYgKzIzOCw3IEBAIGk5MTVf
cHJvZ3MgPSBbCiAJJ2k5MTVfcXVlcnknLAogCSdpOTE1X3NlbGZ0ZXN0JywKIAknaTkxNV9zdXNw
ZW5kJywKKwknc3lzZnNfaGVhcnRiZWF0X2ludGVydmFsJywKIAknc3lzZnNfcHJlZW1wdGlvbl90
aW1lb3V0JywKIF0KIAotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9pbnRlbC1nZng=

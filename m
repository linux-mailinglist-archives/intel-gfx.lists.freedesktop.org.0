Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 67BF91155A6
	for <lists+intel-gfx@lfdr.de>; Fri,  6 Dec 2019 17:43:25 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E58E56FA55;
	Fri,  6 Dec 2019 16:43:22 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9206F6FA59
 for <intel-gfx@lists.freedesktop.org>; Fri,  6 Dec 2019 16:43:20 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  6 Dec 2019 17:43:16 +0100
Message-Id: <20191206164317.2489743-5-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191206164317.2489743-1-maarten.lankhorst@linux.intel.com>
References: <20191206164317.2489743-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/5] drm/i915: Remove locking from
 i915_gem_object_prepare_read/write
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RXhlY2J1ZmZlciBzdWJtaXNzaW9uIHdpbGwgcGVyZm9ybSBpdHMgb3duIFdXIGxvY2tpbmcsIGFu
ZCB3ZQpjYW5ub3QgcmVseSBvbiB0aGUgaW1wbGljaXQgbG9jayB0aGVyZS4KClRoaXMgYWxzbyBt
YWtlcyBpdCBjbGVhciB0aGF0IHRoZSBHVlQgY29kZSB3aWxsIGdldCBhIGxvY2tkZXAgc3BsYXQg
d2hlbgptdWx0aXBsZSBiYXRjaGJ1ZmZlciBzaGFkb3dzIG5lZWQgdG8gYmUgcGVyZm9ybWVkIGlu
IHRoZSBzYW1lIGluc3RhbmNlLApmaXggdGhhdCB1cC4KClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4g
TGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jICAgIHwgMjAgKysrKysrLS0tLS0t
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oICAgIHwg
IDEgLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYyAgIHwgIDUg
KysrKy0KIC4uLi9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMgICB8IDE0
ICsrKysrKysrKy0tLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRl
eHQuYyB8IDEyICsrKysrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZW5k
ZXJzdGF0ZS5jICAgfCAgOSArKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRf
cGFyc2VyLmMgICAgICAgICB8ICA5ICsrKysrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9jbWRfcGFyc2VyLmMgICAgICAgIHwgMTYgKysrKysrKysrKysrKystCiA4IGZpbGVzIGNoYW5n
ZWQsIDU5IGluc2VydGlvbnMoKyksIDI3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwppbmRleCAzMTgxNmJkY2VjYWYuLjhjNWMwNjk2M2Rl
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpAQCAtNTkx
LDE5ICs1OTEsMTcgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3JlYWQoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAoIWk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0
X3BhZ2Uob2JqKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rf
bG9ja19pbnRlcnJ1cHRpYmxlKE5VTEwsIG9iaik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsK
Kwlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKIAogCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0
KG9iaiwKIAkJCQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKIAkJCQkgICBNQVhfU0NIRURV
TEVfVElNRU9VVCk7CiAJaWYgKHJldCkKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gcmV0
OwogCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhvYmopOwogCWlmIChyZXQpCi0J
CWdvdG8gZXJyX3VubG9jazsKKwkJcmV0dXJuIHJldDsKIAogCWlmIChvYmotPmNhY2hlX2NvaGVy
ZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfUkVBRCB8fAogCSAgICAhc3RhdGljX2Nw
dV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKQEAgLTYzMSw4ICs2MjksNiBAQCBpbnQgaTkx
NV9nZW1fb2JqZWN0X3ByZXBhcmVfcmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCiBlcnJfdW5waW46CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7Ci1lcnJf
dW5sb2NrOgotCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAlyZXR1cm4gcmV0OwogfQog
CkBAIC02NDUsMjAgKzY0MSwxOCBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAoIWk5MTVfZ2VtX29iamVjdF9o
YXNfc3RydWN0X3BhZ2Uob2JqKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlyZXQgPSBpOTE1X2dl
bV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKE5VTEwsIG9iaik7Ci0JaWYgKHJldCkKLQkJcmV0
dXJuIHJldDsKKwlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKIAogCXJldCA9IGk5MTVfZ2VtX29i
amVjdF93YWl0KG9iaiwKIAkJCQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8CiAJCQkJICAg
STkxNV9XQUlUX0FMTCwKIAkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJaWYgKHJldCkK
LQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gcmV0OwogCiAJcmV0ID0gaTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9wYWdlcyhvYmopOwogCWlmIChyZXQpCi0JCWdvdG8gZXJyX3VubG9jazsKKwkJcmV0
dXJuIHJldDsKIAogCWlmIChvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hF
UkVOVF9GT1JfV1JJVEUgfHwKIAkgICAgIXN0YXRpY19jcHVfaGFzKFg4Nl9GRUFUVVJFX0NMRkxV
U0gpKSB7CkBAIC02OTUsNyArNjg5LDUgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dy
aXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIGVycl91bnBpbjoKIAlpOTE1
X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKLWVycl91bmxvY2s6Ci0JaTkxNV9nZW1fb2Jq
ZWN0X3VubG9jayhvYmopOwogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5kZXggYzdhNTU0YWUxNTFlLi42ODFhN2FmZWUyMGUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTQyNyw3ICs0
MjcsNiBAQCBzdGF0aWMgaW5saW5lIHZvaWQKIGk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNz
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJaTkxNV9nZW1fb2JqZWN0X3Vu
cGluX3BhZ2VzKG9iaik7Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogfQogCiBzdGF0
aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwppbmRleCA2OWNjNmQzOTgwNGYuLjAxZjMz
MThmYTFmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9o
dWdlX3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdl
X3BhZ2VzLmMKQEAgLTk5MSw5ICs5OTEsMTAgQEAgX19jcHVfY2hlY2tfc2htZW0oc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdTMyIGR3b3JkLCB1MzIgdmFsKQogCXVuc2lnbmVkIGxv
bmcgbjsKIAlpbnQgZXJyOwogCisJaTkxNV9nZW1fb2JqZWN0X2xvY2soTlVMTCwgb2JqKTsKIAll
cnIgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV9yZWFkKG9iaiwgJm5lZWRzX2ZsdXNoKTsKIAlp
ZiAoZXJyKQotCQlyZXR1cm4gZXJyOworCQlnb3RvIGVycl91bmxvY2s7CiAKIAlmb3IgKG4gPSAw
OyBuIDwgb2JqLT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVDsgKytuKSB7CiAJCXUzMiAqcHRyID0g
a21hcF9hdG9taWMoaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlKG9iaiwgbikpOwpAQCAtMTAxMyw2
ICsxMDE0LDggQEAgX19jcHVfY2hlY2tfc2htZW0oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwgdTMyIGR3b3JkLCB1MzIgdmFsKQogCX0KIAogCWk5MTVfZ2VtX29iamVjdF9maW5pc2hf
YWNjZXNzKG9iaik7CitlcnJfdW5sb2NrOgorCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsK
IAogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYwppbmRleCA3YmJkZDViZjFjZWMuLjUwNGRm
YTUwNjFmNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9jb2hlcmVuY3kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jCkBAIC0yNyw5ICsyNywxMCBAQCBzdGF0aWMgaW50IGNw
dV9zZXQoc3RydWN0IGNvbnRleHQgKmN0eCwgdW5zaWduZWQgbG9uZyBvZmZzZXQsIHUzMiB2KQog
CXUzMiAqY3B1OwogCWludCBlcnI7CiAKKwlpOTE1X2dlbV9vYmplY3RfbG9jayhOVUxMLCBjdHgt
Pm9iaik7CiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoY3R4LT5vYmosICZu
ZWVkc19jbGZsdXNoKTsKIAlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOworCQlnb3RvIG91dDsKIAog
CXBhZ2UgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2UoY3R4LT5vYmosIG9mZnNldCA+PiBQQUdF
X1NISUZUKTsKIAltYXAgPSBrbWFwX2F0b21pYyhwYWdlKTsKQEAgLTQ2LDcgKzQ3LDkgQEAgc3Rh
dGljIGludCBjcHVfc2V0KHN0cnVjdCBjb250ZXh0ICpjdHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0
LCB1MzIgdikKIAlrdW5tYXBfYXRvbWljKG1hcCk7CiAJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9h
Y2Nlc3MoY3R4LT5vYmopOwogCi0JcmV0dXJuIDA7CitvdXQ6CisJaTkxNV9nZW1fb2JqZWN0X3Vu
bG9jayhjdHgtPm9iaik7CisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGljIGludCBjcHVfZ2V0KHN0
cnVjdCBjb250ZXh0ICpjdHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgKnYpCkBAIC01Nyw5
ICs2MCwxMCBAQCBzdGF0aWMgaW50IGNwdV9nZXQoc3RydWN0IGNvbnRleHQgKmN0eCwgdW5zaWdu
ZWQgbG9uZyBvZmZzZXQsIHUzMiAqdikKIAl1MzIgKmNwdTsKIAlpbnQgZXJyOwogCisJaTkxNV9n
ZW1fb2JqZWN0X2xvY2soTlVMTCwgY3R4LT5vYmopOwogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9w
cmVwYXJlX3JlYWQoY3R4LT5vYmosICZuZWVkc19jbGZsdXNoKTsKIAlpZiAoZXJyKQotCQlyZXR1
cm4gZXJyOworCQlnb3RvIG91dDsKIAogCXBhZ2UgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2Uo
Y3R4LT5vYmosIG9mZnNldCA+PiBQQUdFX1NISUZUKTsKIAltYXAgPSBrbWFwX2F0b21pYyhwYWdl
KTsKQEAgLTczLDcgKzc3LDkgQEAgc3RhdGljIGludCBjcHVfZ2V0KHN0cnVjdCBjb250ZXh0ICpj
dHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgKnYpCiAJa3VubWFwX2F0b21pYyhtYXApOwog
CWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKGN0eC0+b2JqKTsKIAotCXJldHVybiAwOwor
b3V0OgorCWk5MTVfZ2VtX29iamVjdF91bmxvY2soY3R4LT5vYmopOworCXJldHVybiBlcnI7CiB9
CiAKIHN0YXRpYyBpbnQgZ3R0X3NldChzdHJ1Y3QgY29udGV4dCAqY3R4LCB1bnNpZ25lZCBsb25n
IG9mZnNldCwgdTMyIHYpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGQ3YjMwZGFjYTVjYi4uNjhmZTc0YWIwZDE5
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX2NvbnRleHQuYwpAQCAtNDYxLDkgKzQ2MSwxMCBAQCBzdGF0aWMgaW50IGNwdV9maWxsKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHUzMiB2YWx1ZSkKIAl1bnNpZ25lZCBpbnQg
biwgbSwgbmVlZF9mbHVzaDsKIAlpbnQgZXJyOwogCisJaTkxNV9nZW1fb2JqZWN0X2xvY2soTlVM
TCwgb2JqKTsKIAllcnIgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV93cml0ZShvYmosICZuZWVk
X2ZsdXNoKTsKIAlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOworCQlnb3RvIG91dDsKIAogCWZvciAo
biA9IDA7IG4gPCByZWFsX3BhZ2VfY291bnQob2JqKTsgbisrKSB7CiAJCXUzMiAqbWFwOwpAQCAt
NDc5LDcgKzQ4MCw5IEBAIHN0YXRpYyBpbnQgY3B1X2ZpbGwoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwgdTMyIHZhbHVlKQogCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKG9i
aik7CiAJb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fR1RUIHwgSTkxNV9HRU1f
RE9NQUlOX0NQVTsKIAlvYmotPndyaXRlX2RvbWFpbiA9IDA7Ci0JcmV0dXJuIDA7CitvdXQ6CisJ
aTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyBu
b2lubGluZSBpbnQgY3B1X2NoZWNrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCkBA
IC00ODgsOSArNDkxLDEwIEBAIHN0YXRpYyBub2lubGluZSBpbnQgY3B1X2NoZWNrKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdW5zaWduZWQgaW50IG4sIG0sIG5lZWRzX2ZsdXNo
OwogCWludCBlcnI7CiAKKwlpOTE1X2dlbV9vYmplY3RfbG9jayhOVUxMLCBvYmopOwogCWVyciA9
IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3JlYWQob2JqLCAmbmVlZHNfZmx1c2gpOwogCWlmIChl
cnIpCi0JCXJldHVybiBlcnI7CisJCWdvdG8gb3V0X3VubG9jazsKIAogCWZvciAobiA9IDA7IG4g
PCByZWFsX3BhZ2VfY291bnQob2JqKTsgbisrKSB7CiAJCXUzMiAqbWFwOwpAQCAtNTI3LDYgKzUz
MSw4IEBAIHN0YXRpYyBub2lubGluZSBpbnQgY3B1X2NoZWNrKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAJfQogCiAJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3Mob2JqKTsK
K291dF91bmxvY2s6CisJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCXJldHVybiBlcnI7
CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JlbmRlcnN0
YXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZW5kZXJzdGF0ZS5jCmluZGV4
IDU5NTRlY2MzMjA3Zi4uN2I4MTk1MzVlZDRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yZW5kZXJzdGF0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3JlbmRlcnN0YXRlLmMKQEAgLTE5Niw2ICsxOTYsOCBAQCBpbnQgaW50ZWxfcmVuZGVy
c3RhdGVfaW5pdChzdHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGUgKnNvLAogCWlmIChlcnIpCiAJCWdv
dG8gZXJyX3ZtYTsKIAorCWk5MTVfZ2VtX29iamVjdF9sb2NrKE5VTEwsIHNvLT52bWEtPm9iaik7
CisKIAllcnIgPSByZW5kZXJfc3RhdGVfc2V0dXAoc28sIGVuZ2luZS0+aTkxNSk7CiAJaWYgKGVy
cikKIAkJZ290byBlcnJfdW5waW47CkBAIC0yMDMsNiArMjA1LDcgQEAgaW50IGludGVsX3JlbmRl
cnN0YXRlX2luaXQoc3RydWN0IGludGVsX3JlbmRlcnN0YXRlICpzbywKIAlyZXR1cm4gMDsKIAog
ZXJyX3VucGluOgorCWk5MTVfZ2VtX29iamVjdF91bmxvY2soc28tPnZtYS0+b2JqKTsKIAlpOTE1
X3ZtYV91bnBpbihzby0+dm1hKTsKIGVycl92bWE6CiAJaTkxNV92bWFfY2xvc2Uoc28tPnZtYSk7
CkBAIC0yMzUsMTYgKzIzOCwxOCBAQCBpbnQgaW50ZWxfcmVuZGVyc3RhdGVfZW1pdChzdHJ1Y3Qg
aW50ZWxfcmVuZGVyc3RhdGUgKnNvLAogCQkJcmV0dXJuIGVycjsKIAl9CiAKLQlpOTE1X3ZtYV9s
b2NrKHNvLT52bWEpOwogCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHNvLT52
bWEtPm9iaiwgZmFsc2UpOwogCWlmIChlcnIgPT0gMCkKIAkJZXJyID0gaTkxNV92bWFfbW92ZV90
b19hY3RpdmUoc28tPnZtYSwgcnEsIDApOwotCWk5MTVfdm1hX3VubG9jayhzby0+dm1hKTsKIAog
CXJldHVybiBlcnI7CiB9CiAKIHZvaWQgaW50ZWxfcmVuZGVyc3RhdGVfZmluaShzdHJ1Y3QgaW50
ZWxfcmVuZGVyc3RhdGUgKnNvKQogeworCWlmICghc28tPnZtYSkKKwkJcmV0dXJuOworCisJaTkx
NV9nZW1fb2JqZWN0X3VubG9jayhzby0+dm1hLT5vYmopOwogCWk5MTVfdm1hX3VucGluX2FuZF9y
ZWxlYXNlKCZzby0+dm1hLCAwKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9jbWRfcGFyc2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5j
CmluZGV4IDg1Y2RlMTA1MjBlNC4uOWNlMDRkZjc3ZjZiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2
dC9jbWRfcGFyc2VyLmMKQEAgLTE4NjUsMTAgKzE4NjUsMTQgQEAgc3RhdGljIGludCBwZXJmb3Jt
X2JiX3NoYWRvdyhzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpCiAJCWdvdG8gZXJyX2ZyZWVf
YmI7CiAJfQogCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoYmItPm9iaiwg
JmJiLT5jbGZsdXNoKTsKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxl
KE5VTEwsIGJiLT5vYmopOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyX2ZyZWVfb2JqOwogCisJcmV0
ID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoYmItPm9iaiwgJmJiLT5jbGZsdXNoKTsK
KwlpZiAocmV0KQorCQlnb3RvIGVycl91bmxvY2s7CisKIAliYi0+dmEgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChiYi0+b2JqLCBJOTE1X01BUF9XQik7CiAJaWYgKElTX0VSUihiYi0+dmEpKSB7
CiAJCXJldCA9IFBUUl9FUlIoYmItPnZhKTsKQEAgLTE4OTMsNiArMTg5Nyw3IEBAIHN0YXRpYyBp
bnQgcGVyZm9ybV9iYl9zaGFkb3coc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKQogCWlmIChy
ZXQpCiAJCWdvdG8gZXJyX3VubWFwOwogCisJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhiYi0+b2Jq
KTsKIAlJTklUX0xJU1RfSEVBRCgmYmItPmxpc3QpOwogCWxpc3RfYWRkKCZiYi0+bGlzdCwgJnMt
Pndvcmtsb2FkLT5zaGFkb3dfYmIpOwogCkBAIC0xOTE5LDYgKzE5MjQsOCBAQCBzdGF0aWMgaW50
IHBlcmZvcm1fYmJfc2hhZG93KHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcykKIAlpOTE1X2dl
bV9vYmplY3RfdW5waW5fbWFwKGJiLT5vYmopOwogZXJyX2ZpbmlzaF9zaG1lbV9hY2Nlc3M6CiAJ
aTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3MoYmItPm9iaik7CitlcnJfdW5sb2NrOgorCWk5
MTVfZ2VtX29iamVjdF91bmxvY2soYmItPm9iaik7CiBlcnJfZnJlZV9vYmo6CiAJaTkxNV9nZW1f
b2JqZWN0X3B1dChiYi0+b2JqKTsKIGVycl9mcmVlX2JiOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9jbWRfcGFyc2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2NtZF9wYXJzZXIuYwppbmRleCAyZWQ0OTdlN2M5ZmQuLmM1YjllYzViM2QyNSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9jbWRfcGFyc2VyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9jbWRfcGFyc2VyLmMKQEAgLTExMzYsMTggKzExMzYsMzEgQEAgc3Rh
dGljIHUzMiAqY29weV9iYXRjaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqZHN0X29iaiwK
IAl2b2lkICpkc3QsICpzcmM7CiAJaW50IHJldDsKIAotCXJldCA9IGk5MTVfZ2VtX29iamVjdF9w
cmVwYXJlX3dyaXRlKGRzdF9vYmosICZkc3RfbmVlZHNfY2xmbHVzaCk7CisJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShOVUxMLCBkc3Rfb2JqKTsKIAlpZiAocmV0KQog
CQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVf
d3JpdGUoZHN0X29iaiwgJmRzdF9uZWVkc19jbGZsdXNoKTsKKwlpZiAocmV0KSB7CisJCWk5MTVf
Z2VtX29iamVjdF91bmxvY2soZHN0X29iaik7CisJCXJldHVybiBFUlJfUFRSKHJldCk7CisJfQor
CiAJZHN0ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoZHN0X29iaiwgSTkxNV9NQVBfRk9SQ0Vf
V0IpOwogCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKGRzdF9vYmopOworCWk5MTVfZ2Vt
X29iamVjdF91bmxvY2soZHN0X29iaik7CisKIAlpZiAoSVNfRVJSKGRzdCkpCiAJCXJldHVybiBk
c3Q7CiAKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKE5VTEwsIHNy
Y19vYmopOworCWlmIChyZXQpCisJCXJldHVybiBFUlJfUFRSKHJldCk7CisKIAlyZXQgPSBpOTE1
X2dlbV9vYmplY3RfcHJlcGFyZV9yZWFkKHNyY19vYmosICZzcmNfbmVlZHNfY2xmbHVzaCk7CiAJ
aWYgKHJldCkgewogCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGRzdF9vYmopOworCQlpOTE1
X2dlbV9vYmplY3RfdW5sb2NrKHNyY19vYmopOwogCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCX0K
IApAQCAtMTE5Niw2ICsxMjA5LDcgQEAgc3RhdGljIHUzMiAqY29weV9iYXRjaChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqZHN0X29iaiwKIAl9CiAKIAlpOTE1X2dlbV9vYmplY3RfZmluaXNo
X2FjY2VzcyhzcmNfb2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKHNyY19vYmopOwogCiAJ
LyogZHN0X29iaiBpcyByZXR1cm5lZCB3aXRoIHZtYXAgcGlubmVkICovCiAJKm5lZWRzX2NsZmx1
c2hfYWZ0ZXIgPSBkc3RfbmVlZHNfY2xmbHVzaCAmIENMRkxVU0hfQUZURVI7Ci0tIAoyLjI0LjAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

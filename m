Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A7AD307AEA
	for <lists+intel-gfx@lfdr.de>; Thu, 28 Jan 2021 17:27:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A55A76E9CB;
	Thu, 28 Jan 2021 16:27:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 69A826E99E
 for <intel-gfx@lists.freedesktop.org>; Thu, 28 Jan 2021 16:26:24 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 28 Jan 2021 17:25:33 +0100
Message-Id: <20210128162612.927917-25-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.30.0
In-Reply-To: <20210128162612.927917-1-maarten.lankhorst@linux.intel.com>
References: <20210128162612.927917-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v7 24/63] drm/i915: Move pinning to inside
 engine_wa_list_verify()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhpcyBzaG91bGQgYmUgZG9uZSBhcyBwYXJ0IG9mIHRoZSB3dyBsb29wLCBpbiBvcmRlciB0byBy
ZW1vdmUgYQppOTE1X3ZtYV9waW4gdGhhdCBuZWVkcyB3dyBoZWxkLgoKTm93IG9ubHkgaTkxNV9n
Z3R0X3BpbigpIGNhbGxlcnMgcmVtYWluaW5nLgoKU2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5r
aG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFRo
b21hcyBIZWxsc3Ryw7ZtIDx0aG9tYXMuaGVsbHN0cm9tQGxpbnV4LmludGVsLmNvbT4KLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndHQuYyAgICAgICAgICAgIHwgMTQgKysrKysr
KysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0dC5oICAgICAgICAgICAg
fCAgMyArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3dvcmthcm91bmRzLmMgICAg
fCAxMCArKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlz
dHMuYyAgIHwgIDUgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5j
ICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5j
ICAgICAgICB8ICAzICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fy
b3VuZHMuYyB8ICA2ICsrKy0tLQogNyBmaWxlcyBjaGFuZ2VkLCAzMyBpbnNlcnRpb25zKCspLCAx
MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0dC5jCmluZGV4IDA0YWE2
NjAxZTk4NC4uNDQ0ZDliYWNmYWZkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndHQuYwpA
QCAtNDI3LDcgKzQyNyw2IEBAIF9fdm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWQoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sIHVuc2lnbmVkIGxvbmcgc2l6ZSkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCWludCBlcnI7
CiAKIAlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKHZtLT5pOTE1LCBQQUdF
X0FMSUdOKHNpemUpKTsKIAlpZiAoSVNfRVJSKG9iaikpCkBAIC00NDEsNiArNDQwLDE5IEBAIF9f
dm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
IHVuc2lnbmVkIGxvbmcgc2l6ZSkKIAkJcmV0dXJuIHZtYTsKIAl9CiAKKwlyZXR1cm4gdm1hOwor
fQorCitzdHJ1Y3QgaTkxNV92bWEgKgorX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5u
ZWQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sIHVuc2lnbmVkIGxvbmcgc2l6ZSkKK3sK
KwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlpbnQgZXJyOworCisJdm1hID0gX192bV9jcmVhdGVf
c2NyYXRjaF9mb3JfcmVhZCh2bSwgc2l6ZSk7CisJaWYgKElTX0VSUih2bWEpKQorCQlyZXR1cm4g
dm1hOworCiAJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwKIAkJCSAgIGk5MTVfdm1hX2lz
X2dndHQodm1hKSA/IFBJTl9HTE9CQUwgOiBQSU5fVVNFUik7CiAJaWYgKGVycikgewpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3R0LmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndHQuaAppbmRleCAyOWMxMGZkZThjZTMuLmFmOTAwOTBjM2QxOCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3R0LmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3R0LmgKQEAgLTU3Niw2ICs1NzYsOSBAQCB2b2lk
IGk5MTVfdm1fZnJlZV9wdF9zdGFzaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIHN0
cnVjdCBpOTE1X3ZtYSAqCiBfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFkKHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtLCB1bnNpZ25lZCBsb25nIHNpemUpOwogCitzdHJ1Y3QgaTkxNV92
bWEgKgorX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5uZWQoc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0sIHVuc2lnbmVkIGxvbmcgc2l6ZSk7CisKIHN0YXRpYyBpbmxpbmUgc3Ry
dWN0IHNndF9kbWEgewogCXN0cnVjdCBzY2F0dGVybGlzdCAqc2c7CiAJZG1hX2FkZHJfdCBkbWEs
IG1heDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3dvcmthcm91
bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF93b3JrYXJvdW5kcy5jCmluZGV4
IDcxZDFjMTljODY4Yi4uNzIwNTA4MzM3ZGM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3dvcmthcm91bmRzLmMKQEAgLTIyMDMsMTAgKzIyMDMsMTUgQEAgc3RhdGljIGludCBl
bmdpbmVfd2FfbGlzdF92ZXJpZnkoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCWlmIChlcnIp
CiAJCWdvdG8gZXJyX3BtOwogCisJZXJyID0gaTkxNV92bWFfcGluX3d3KHZtYSwgJnd3LCAwLCAw
LAorCQkJICAgaTkxNV92bWFfaXNfZ2d0dCh2bWEpID8gUElOX0dMT0JBTCA6IFBJTl9VU0VSKTsK
KwlpZiAoZXJyKQorCQlnb3RvIGVycl91bnBpbjsKKwogCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0
ZShjZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJyID0gUFRSX0VSUihycSk7Ci0JCWdvdG8g
ZXJyX3VucGluOworCQlnb3RvIGVycl92bWE7CiAJfQogCiAJZXJyID0gaTkxNV9yZXF1ZXN0X2F3
YWl0X29iamVjdChycSwgdm1hLT5vYmosIHRydWUpOwpAQCAtMjI0Nyw2ICsyMjUyLDggQEAgc3Rh
dGljIGludCBlbmdpbmVfd2FfbGlzdF92ZXJpZnkoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAog
CiBlcnJfcnE6CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CitlcnJfdm1hOgorCWk5MTVfdm1hX3Vu
cGluKHZtYSk7CiBlcnJfdW5waW46CiAJaW50ZWxfY29udGV4dF91bnBpbihjZSk7CiBlcnJfcG06
CkBAIC0yMjU3LDcgKzIyNjQsNiBAQCBzdGF0aWMgaW50IGVuZ2luZV93YV9saXN0X3ZlcmlmeShz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJfQogCWk5MTVfZ2VtX3d3X2N0eF9maW5pKCZ3dyk7
CiAJaW50ZWxfZW5naW5lX3BtX3B1dChjZS0+ZW5naW5lKTsKLQlpOTE1X3ZtYV91bnBpbih2bWEp
OwogCWk5MTVfdm1hX3B1dCh2bWEpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2V4ZWNsaXN0cy5jCmluZGV4IDVkN2ZhYzM4M2FkZC4uOWRlZWQ5
MDQzNzFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVj
bGlzdHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMu
YwpAQCAtNDE4MSw4ICs0MTgxLDkgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdp
bmUoc3RydWN0IGludGVsX2d0ICpndCwKIAlpbnQgZXJyID0gMDsKIAl1MzIgKmNzOwogCi0Jc2Ny
YXRjaCA9IF9fdm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWQoJnNpYmxpbmdzWzBdLT5ndC0+Z2d0
dC0+dm0sCi0JCQkJCSAgICAgICBQQUdFX1NJWkUpOworCXNjcmF0Y2ggPQorCQlfX3ZtX2NyZWF0
ZV9zY3JhdGNoX2Zvcl9yZWFkX3Bpbm5lZCgmc2libGluZ3NbMF0tPmd0LT5nZ3R0LT52bSwKKwkJ
CQkJCSAgICBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIoc2NyYXRjaCkpCiAJCXJldHVybiBQVFJf
RVJSKHNjcmF0Y2gpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4
IDdiZjM0YzQzOTg3Ni4uZjc0YWRkYWQ5OGFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYwpAQCAtMjcsNyArMjcsNyBAQAogCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpj
cmVhdGVfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCXJldHVybiBfX3ZtX2NyZWF0
ZV9zY3JhdGNoX2Zvcl9yZWFkKCZndC0+Z2d0dC0+dm0sIFBBR0VfU0laRSk7CisJcmV0dXJuIF9f
dm1fY3JlYXRlX3NjcmF0Y2hfZm9yX3JlYWRfcGlubmVkKCZndC0+Z2d0dC0+dm0sIFBBR0VfU0la
RSk7CiB9CiAKIHN0YXRpYyBib29sIGlzX2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYwppbmRleCBlNmY2ODA3NDg3ZDQu
LjVkMmU1MTVmNGUyZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbW9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYwpA
QCAtNzQsNyArNzQsOCBAQCBzdGF0aWMgaW50IGxpdmVfbW9jc19pbml0KHN0cnVjdCBsaXZlX21v
Y3MgKmFyZywgc3RydWN0IGludGVsX2d0ICpndCkKIAlpZiAoZmxhZ3MgJiAoSEFTX0dMT0JBTF9N
T0NTIHwgSEFTX0VOR0lORV9NT0NTKSkKIAkJYXJnLT5tb2NzID0gdGFibGU7CiAKLQlhcmctPnNj
cmF0Y2ggPSBfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFkKCZndC0+Z2d0dC0+dm0sIFBBR0Vf
U0laRSk7CisJYXJnLT5zY3JhdGNoID0KKwkJX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9w
aW5uZWQoJmd0LT5nZ3R0LT52bSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJSKGFyZy0+c2NyYXRj
aCkpCiAJCXJldHVybiBQVFJfRVJSKGFyZy0+c2NyYXRjaCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCmluZGV4IGFmMzNhNzIwZGJmOC4uNDBi
Nzk3OTFjZTY5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93
b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmth
cm91bmRzLmMKQEAgLTQ4OSw3ICs0ODksNyBAQCBzdGF0aWMgaW50IGNoZWNrX2RpcnR5X3doaXRl
bGlzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJdTMyICpjcywgKnJlc3VsdHM7CiAKIAlz
eiA9ICgyICogQVJSQVlfU0laRSh2YWx1ZXMpICsgMSkgKiBzaXplb2YodTMyKTsKLQlzY3JhdGNo
ID0gX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZChjZS0+dm0sIHN6KTsKKwlzY3JhdGNoID0g
X192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5uZWQoY2UtPnZtLCBzeik7CiAJaWYgKElT
X0VSUihzY3JhdGNoKSkKIAkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKQEAgLTEwMjksMTQg
KzEwMjksMTQgQEAgc3RhdGljIGludCBsaXZlX2lzb2xhdGVkX3doaXRlbGlzdCh2b2lkICphcmcp
CiAKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjbGllbnQpOyBpKyspIHsKIAkJY2xpZW50
W2ldLnNjcmF0Y2hbMF0gPQotCQkJX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZChndC0+dm0s
IDQwOTYpOworCQkJX192bV9jcmVhdGVfc2NyYXRjaF9mb3JfcmVhZF9waW5uZWQoZ3QtPnZtLCA0
MDk2KTsKIAkJaWYgKElTX0VSUihjbGllbnRbaV0uc2NyYXRjaFswXSkpIHsKIAkJCWVyciA9IFBU
Ul9FUlIoY2xpZW50W2ldLnNjcmF0Y2hbMF0pOwogCQkJZ290byBlcnI7CiAJCX0KIAogCQljbGll
bnRbaV0uc2NyYXRjaFsxXSA9Ci0JCQlfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFkKGd0LT52
bSwgNDA5Nik7CisJCQlfX3ZtX2NyZWF0ZV9zY3JhdGNoX2Zvcl9yZWFkX3Bpbm5lZChndC0+dm0s
IDQwOTYpOwogCQlpZiAoSVNfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzFdKSkgewogCQkJZXJyID0g
UFRSX0VSUihjbGllbnRbaV0uc2NyYXRjaFsxXSk7CiAJCQlpOTE1X3ZtYV91bnBpbl9hbmRfcmVs
ZWFzZSgmY2xpZW50W2ldLnNjcmF0Y2hbMF0sIDApOwotLSAKMi4zMC4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

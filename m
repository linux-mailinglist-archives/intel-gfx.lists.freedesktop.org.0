Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C6215162A60
	for <lists+intel-gfx@lfdr.de>; Tue, 18 Feb 2020 17:25:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 02D436EA3F;
	Tue, 18 Feb 2020 16:25:51 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0B19D6EA3F
 for <intel-gfx@lists.freedesktop.org>; Tue, 18 Feb 2020 16:25:49 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Feb 2020 08:25:48 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,456,1574150400"; d="scan'208";a="228326338"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga007.fm.intel.com with ESMTP; 18 Feb 2020 08:25:46 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 18 Feb 2020 18:22:29 +0200
Message-Id: <20200218162232.14368-5-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200218162232.14368-1-stanislav.lisovskiy@intel.com>
References: <20200218162232.14368-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v16 4/7] drm/i915: Refactor intel_can_enable_sagv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGludGVsX2Nhbl9lbmFibGVfc2FndiBmdW5jdGlvbiBjb250YWlucwphIG1peCBv
ZiB3b3JrYXJvdW5kcyBmb3IgZGlmZmVyZW50IHBsYXRmb3Jtcwpzb21lIG9mIHRoZW0gYXJlIG5v
dCB2YWxpZCBmb3IgZ2VucyA+PSAxMSBhbHJlYWR5LApzbyBsZXRzIHNwbGl0IGl0IGludG8gc2Vw
YXJhdGUgZnVuY3Rpb25zLgoKdjI6CiAgICAtIFJld29yayB3YXRlcm1hcmsgY2FsY3VsYXRpb24g
YWxnb3JpdGhtIHRvCiAgICAgIGF0dGVtcHQgdG8gY2FsY3VsYXRlIExldmVsIDAgd2F0ZXJtYXJr
CiAgICAgIHdpdGggYWRkZWQgc2FndiBibG9jayB0aW1lIGxhdGVuY3kgYW5kCiAgICAgIGNoZWNr
IGlmIGl0IGZpdHMgaW4gREJ1ZiBpbiBvcmRlciB0bwogICAgICBkZXRlcm1pbmUgaWYgU0FHViBj
YW4gYmUgZW5hYmxlZCBhbHJlYWR5CiAgICAgIGF0IHRoaXMgc3RhZ2UsIGp1c3QgYXMgQlNwZWMg
NDkzMjUgc3RhdGVzLgogICAgICBpZiB0aGF0IGZhaWxzIHJvbGxiYWNrIHRvIHVzdWFsIExldmVs
IDAKICAgICAgbGF0ZW5jeSBhbmQgZGlzYWJsZSBTQUdWLgogICAgLSBSZW1vdmUgdW5uZWVkZWQg
dGFicyhKYW1lcyBBdXNtdXMpCgp2MzogUmViYXNlZCB0aGUgcGF0Y2gKCnY0OiAtIEFkZGVkIGJh
Y2sgaW50ZXJsYWNlZCBjaGVjayBmb3IgR2VuMTIgYW5kCiAgICAgIGFkZGVkIHNlcGFyYXRlIGZ1
bmN0aW9uIGZvciBUR0wgU0FHViBjaGVjawogICAgICAodGhhbmtzIHRvIEphbWVzIEF1c211cyBm
b3Igc3BvdHRpbmcpCiAgICAtIFJlbW92ZWQgdW5uZWVkZWQgZ2VuIGNoZWNrCiAgICAtIEV4dHJh
Y3RlZCBHZW4xMiBTQUdWIGRlY2lzaW9uIG1ha2luZyBjb2RlCiAgICAgIHRvIGEgc2VwYXJhdGUg
ZnVuY3Rpb24gZnJvbSBza2xfY29tcHV0ZV93bQoKdjU6IC0gQWRkZWQgU0FHViBnbG9iYWwgc3Rh
dGUgdG8gZGV2X3ByaXYsIGJlY2F1c2UKICAgICAgd2UgbmVlZCB0byB0cmFjayBhbGwgcGlwZXMs
IG5vdCBvbmx5IHRob3NlCiAgICAgIGluIGF0b21pYyBzdGF0ZS4gRWFjaCBwaXBlIGhhcyBub3cg
Y29ycmVzcG9uZGVudAogICAgICBiaXQgbWFzayByZWZsZWN0aW5nLCB3aGV0aGVyIGl0IGNhbiB0
b2xlcmF0ZQogICAgICBTQUdWIG9yIG5vdCh0aGFua3MgdG8gVmlsbGUgU3lyamFsYSBmb3Igc3Vn
Z2VzdGlvbnMpLgogICAgLSBOb3cgdXNpbmcgYWN0aXZlIGZsYWcgaW5zdGVhZCBvZiBlbmFibGUg
aW4gY3JjCiAgICAgIHVzYWdlIGNoZWNrLgoKdjY6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0cwoK
djc6IC0ga21zX2N1cnNvcl9sZWdhY3kgc2VlbXMgdG8gZ2V0IGJyb2tlbiBiZWNhdXNlIG9mIG11
bHRpcGxlIG1lbWNweQogICAgICBjYWxscyB3aGVuIGNvcHlpbmcgbGV2ZWwgMCB3YXRlciBtYXJr
cyBmb3IgZW5hYmxlZCBTQUdWLCB0bwogICAgICBmaXggdGhpcyBub3cgc2ltcGx5IHVzaW5nIHRo
YXQgZmllbGQgcmlnaHQgYXdheSwgd2l0aG91dCBjb3B5aW5nLAogICAgICBmb3IgdGhhdCBpbnRy
b2R1Y2VkIGEgbmV3IHdtX2xldmVsIGFjY2Vzc29yIHdoaWNoIGRlY2lkZXMgd2hpY2gKICAgICAg
d21fbGV2ZWwgdG8gcmV0dXJuIGJhc2VkIG9uIFNBR1Ygc3RhdGUuCgp2ODogLSBQcm90ZWN0IGNy
dGNfc2Fndl9tYXNrIHNhbWUgd2F5IGFzIHdlIGRvIGZvciBvdGhlciBnbG9iYWwgc3RhdGUKICAg
ICAgY2hhbmdlczogaS5lIGNoZWNrIGlmIGNoYW5nZXMgYXJlIG5lZWRlZCwgdGhlbiBncmFiIGFs
bCBjcnRjIGxvY2tzCiAgICAgIHRvIHNlcmlhbGl6ZSB0aGUgY2hhbmdlcyhWaWxsZSBTeXJqw6Rs
w6QpCiAgICAtIEFkZCBjcnRjX3NhZ3ZfbWFzayBjYWNoaW5nIGluIG9yZGVyIHRvIGF2b2lkIG5l
ZWRsZXNzIHJlY2FsY3VsYXRpb25zCiAgICAgIChNYXR0aGV3IFJvcGVyKQogICAgLSBQdXQgYmFj
ayBHZW4xMiBTQUdWIHN3aXRjaCBpbiBvcmRlciB0byBnZXQgaXQgZW5hYmxlZCBpbiBzZXBhcmF0
ZQogICAgICBwYXRjaChNYXR0aGV3IFJvcGVyKQogICAgLSBSZW5hbWUgKl9zZXRfc2Fndl9tYXNr
IHRvICpfY29tcHV0ZV9zYWd2X21hc2soTWF0dGhldyBSb3BlcikKICAgIC0gQ2hlY2sgaWYgdGhl
cmUgYXJlIG5vIGFjdGl2ZSBwaXBlcyBpbiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKICAgICAgaW5z
dGVhZCBvZiBwbGF0Zm9ybSBzcGVjaWZpYyBmdW5jdGlvbnMoTWF0dGhldyBSb3BlciksIHNhbWUK
ICAgICAgZm9yIGludGVsX2hhc19zYWd2IGNoZWNrLgoKdjkgIC0gU3dpdGNoZWQgdG8gdTggZm9y
IGNydGNfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gY3J0Y19zYWd2X21hc2sgbm93
IGlzIHBpcGVfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRXh0cmFjdGVkIHNhZ3Yg
Y2hlY2tpbmcgbG9naWMgZnJvbSBza2wvaWNsL3RnbF9jb21wdXRlX3NhZ3ZfbWFzawogICAgLSBF
eHRyYWN0ZWQgc2tsX3BsYW5lX3dtX2xldmVsIGZ1bmN0aW9uIGFuZCBwYXNzaW5nIGxhdGVuY3kg
dG8KICAgICAgc2VwYXJhdGUgcGF0Y2hlcyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIFJlbW92ZWQg
cGFydCBvZiB1bm5lZWRlZCBjb3B5LXBhc3RlIGZyb20gdGdsX2NoZWNrX3BpcGVfZml0c19zYWd2
X3dtCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIE5vdyB1c2luZyBzaW1wbGUgYXNzaWdu
bWVudCBmb3Igc2Fndl93bTAgYXMgaXQgY29udGFpbnMgb25seQogICAgICBwb2QgdHlwZXMgYW5k
IG5vIHBvaW50ZXJzKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRml4ZWQgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2IG5vdCB0byBkbyBkb3VibGUgZHV0eSwgbm93IGl0IG9ubHkKICAgICAgY2hlY2sgU0FH
ViBiaXRzIGJ5IEFORGluZyB0aG9zZSBiZXR3ZWVuIGxvY2FsIGFuZCBnbG9iYWwgc3RhdGUuCiAg
ICAgIFRoZSBTQUdWIG1hc2tzIGFyZSBub3cgY29tcHV0ZWQgYWZ0ZXIgd2F0ZXJtYXJrcyBhcmUg
YXZhaWxhYmxlLAogICAgICBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGZpZ3VyZSBvdXQgaWYgZGRi
IHJhbmdlcyBhcmUgZml0dGluZyBuaWNlbHkuCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IE5vdyBoYXZpbmcgdXZfc2Fndl93bTAgYW5kIHNhZ3Zfd20wLCBvdGhlcndpc2Ugd2UgaGF2ZSB3
cm9uZyBsb2dpYwogICAgICB3aGVuIHVzaW5nIHNrbF9wbGFuZV93bV9sZXZlbCBhY2Nlc3Nvciwg
YXMgd2UgaGFkIHByZXZpb3VzbHkgZm9yIEdlbjExKwogICAgICBjb2xvciBwbGFuZSBhbmQgcmVn
dWxhciB3bSBsZXZlbHMsIHNvIHByb2JhYmx5IGJvdGggaGFzIHRvIGJlIHJlY2FsY3VsYXRlZAog
ICAgICB3aXRoIGFkZGl0aW9uYWwgU0FHViBibG9jayB0aW1lIGZvciBMZXZlbCAwLgoKdjEwOiAt
IFN0YXJ0aW5nIHRvIHVzZSBuZXcgZ2xvYmFsIHN0YXRlIGZvciBzdG9yaW5nIHBpcGVfc2Fndl9t
YXNrCgp2MTE6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0IHdpdGggcmVjZW50IGRybS10aXAKICAg
ICAtIENoZWNrIGlmIHdlIHJlYWxseSBuZWVkIHRvIHJlY2FsY3VsYXRlIFNBR1YgbWFzaywgb3Ro
ZXJ3aXNlCiAgICAgICBiYWlsIG91dCB3aXRob3V0IG1ha2luZyBhbnkgY2hhbmdlcy4KClNpZ25l
ZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwu
Y29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGludGVsLmNvbT4KQ2M6IEph
bWVzIEF1c211cyA8amFtZXMuYXVzbXVzQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2J3LmggICAgICAgfCAgIDYgKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgIDIyICstCiAuLi4vZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDggKwogLi4uL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2dsb2JhbF9zdGF0ZS5oIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3BtLmMgICAgICAgICAgICAgICB8IDQyOCArKysrKysrKysrKysrKysrLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmggICAgICAgICAgICAgICB8ICAgNCArLQogNiBmaWxlcyBj
aGFuZ2VkLCA0MjcgaW5zZXJ0aW9ucygrKSwgNDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCmluZGV4IGFjMDA0ZDZmNDI3Ni4uNmMzM2QzYWY1MGE5
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCkBAIC0xOCw2ICsxOCwx
MiBAQCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZTsKIHN0cnVjdCBpbnRlbF9id19zdGF0ZSB7CiAJ
c3RydWN0IGludGVsX2dsb2JhbF9zdGF0ZSBiYXNlOwogCisJLyoKKwkgKiBDb250YWlucyBhIGJp
dCBtYXNrLCB3aGV0aGVyIGNvcnJlc3BvbmRlbnQKKwkgKiBwaXBlIGFsbG93cyBTQUdWIG9yIG5v
dC4KKwkgKi8KKwl1OCBwaXBlX3NhZ3ZfbWFzazsKKwogCXVuc2lnbmVkIGludCBkYXRhX3JhdGVb
STkxNV9NQVhfUElQRVNdOwogCXU4IG51bV9hY3RpdmVfcGxhbmVzW0k5MTVfTUFYX1BJUEVTXTsK
IH07CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4
IDI0NTQyMjgxYTczZS4uZWYyZTkxNTUwOTBmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTQxMDUsNyArMTQxMDUsMTAgQEAgc3RhdGljIHZv
aWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkvKiBXYXRlcm1h
cmtzICovCiAJCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhfbGV2ZWw7IGxldmVsKyspIHsK
IAkJCWlmIChza2xfd21fbGV2ZWxfZXF1YWxzKCZod19wbGFuZV93bS0+d21bbGV2ZWxdLAotCQkJ
CQkJJnN3X3BsYW5lX3dtLT53bVtsZXZlbF0pKQorCQkJCQkJJnN3X3BsYW5lX3dtLT53bVtsZXZl
bF0pIHx8CisJCQkgICAoc2tsX3dtX2xldmVsX2VxdWFscygmaHdfcGxhbmVfd20tPndtW2xldmVs
XSwKKwkJCQkJCSZzd19wbGFuZV93bS0+c2Fndl93bTApICYmCisJCQkgICAobGV2ZWwgPT0gMCkp
KQogCQkJCWNvbnRpbnVlOwogCiAJCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLApAQCAtMTQxNjAs
NyArMTQxNjMsMTAgQEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkvKiBXYXRlcm1hcmtzICovCiAJCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8
PSBtYXhfbGV2ZWw7IGxldmVsKyspIHsKIAkJCWlmIChza2xfd21fbGV2ZWxfZXF1YWxzKCZod19w
bGFuZV93bS0+d21bbGV2ZWxdLAotCQkJCQkJJnN3X3BsYW5lX3dtLT53bVtsZXZlbF0pKQorCQkJ
CQkJJnN3X3BsYW5lX3dtLT53bVtsZXZlbF0pIHx8CisJCQkgICAoc2tsX3dtX2xldmVsX2VxdWFs
cygmaHdfcGxhbmVfd20tPndtW2xldmVsXSwKKwkJCQkJCSZzd19wbGFuZV93bS0+c2Fndl93bTAp
ICYmCisJCQkgICAobGV2ZWwgPT0gMCkpKQogCQkJCWNvbnRpbnVlOwogCiAJCQlkcm1fZXJyKCZk
ZXZfcHJpdi0+ZHJtLApAQCAtMTU3MTIsOCArMTU3MTgsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9h
dG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCSAq
IFNLTCB3b3JrYXJvdW5kOiBic3BlYyByZWNvbW1lbmRzIHdlIGRpc2FibGUgdGhlIFNBR1Ygd2hl
biB3ZQogCQkgKiBoYXZlIG1vcmUgdGhlbiBvbmUgcGlwZSBlbmFibGVkCiAJCSAqLwotCQlpZiAo
IWludGVsX2Nhbl9lbmFibGVfc2FndihzdGF0ZSkpCi0JCQlpbnRlbF9kaXNhYmxlX3NhZ3YoZGV2
X3ByaXYpOworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQorCQkJaWYgKCFpbnRlbF9j
YW5fZW5hYmxlX3NhZ3YoZGV2X3ByaXYpKQorCQkJCWludGVsX2Rpc2FibGVfc2FndihkZXZfcHJp
dik7CiAKIAkJaW50ZWxfbW9kZXNldF92ZXJpZnlfZGlzYWJsZWQoZGV2X3ByaXYsIHN0YXRlKTsK
IAl9CkBAIC0xNTgxMyw4ICsxNTgyMCwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29t
bWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKHN0YXRlLT5t
b2Rlc2V0KQogCQlpbnRlbF92ZXJpZnlfcGxhbmVzKHN0YXRlKTsKIAotCWlmIChzdGF0ZS0+bW9k
ZXNldCAmJiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQotCQlpbnRlbF9lbmFibGVfc2Fn
dihkZXZfcHJpdik7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkgeworCQlpZiAoc3Rh
dGUtPm1vZGVzZXQgJiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGRldl9wcml2KSkKKwkJCWludGVs
X2VuYWJsZV9zYWd2KGRldl9wcml2KTsKKwl9CiAKIAlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRf
aHdfZG9uZSgmc3RhdGUtPmJhc2UpOwogCkBAIC0xNTk2Niw3ICsxNTk3NSw2IEBAIHN0YXRpYyBp
bnQgaW50ZWxfYXRvbWljX2NvbW1pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiAJaWYgKHN0
YXRlLT5nbG9iYWxfc3RhdGVfY2hhbmdlZCkgewogCQlhc3NlcnRfZ2xvYmFsX3N0YXRlX2xvY2tl
ZChkZXZfcHJpdik7Ci0KIAkJZGV2X3ByaXYtPmFjdGl2ZV9waXBlcyA9IHN0YXRlLT5hY3RpdmVf
cGlwZXM7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV90eXBlcy5oCmluZGV4IDI4M2M2MjJmOGJhMS4uYjVmNzk4NmRkMWRjIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApA
QCAtNDc4LDYgKzQ3OCwxMiBAQCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlIHsKIAkgKi8KIAl1
OCBhY3RpdmVfcGlwZV9jaGFuZ2VzOwogCisJLyoKKwkgKiBVc2VkIHRvIGRldGVybWluZSBpZiB3
ZSBhbHJlYWR5IGhhZCBjYWxjdWxhdGVkCisJICogU0FHViBtYXNrIGZvciB0aGlzIHN0YXRlIG9u
Y2UuCisJICovCisJYm9vbCBzYWd2X2NhbGN1bGF0ZWQ7CisKIAl1OCBhY3RpdmVfcGlwZXM7CiAK
IAlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGxfc3RhdGUgc2hhcmVkX2RwbGxbSTkxNV9OVU1fUExM
U107CkBAIC02NTEsNiArNjU3LDggQEAgc3RydWN0IHNrbF9wbGFuZV93bSB7CiAJc3RydWN0IHNr
bF93bV9sZXZlbCB3bVs4XTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHV2X3dtWzhdOwogCXN0cnVj
dCBza2xfd21fbGV2ZWwgdHJhbnNfd207CisJc3RydWN0IHNrbF93bV9sZXZlbCBzYWd2X3dtMDsK
KwlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHV2X3NhZ3Zfd20wOwogCWJvb2wgaXNfcGxhbmFyOwogfTsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9nbG9iYWxf
c3RhdGUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZ2xvYmFsX3N0YXRl
LmgKaW5kZXggZTYxNjNhNDY5MDI5Li40ODFiZjVlYTkwYTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZ2xvYmFsX3N0YXRlLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9nbG9iYWxfc3RhdGUuaApAQCAtODQsNCArODQsNSBA
QCB2b2lkIGludGVsX2F0b21pY19jbGVhcl9nbG9iYWxfc3RhdGUoc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUpOwogaW50IGludGVsX2F0b21pY19sb2NrX2dsb2JhbF9zdGF0ZShzdHJ1
Y3QgaW50ZWxfZ2xvYmFsX3N0YXRlICpvYmpfc3RhdGUpOwogaW50IGludGVsX2F0b21pY19zZXJp
YWxpemVfZ2xvYmFsX3N0YXRlKHN0cnVjdCBpbnRlbF9nbG9iYWxfc3RhdGUgKm9ial9zdGF0ZSk7
CiAKKwogI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCBlMWQxNjc0Mjk0ODkuLmU4
ZjEwYTQxMzgwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC00Miw2ICs0Miw3IEBACiAj
aW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2lycS5oIgogI2luY2x1ZGUgImk5
MTVfdHJhY2UuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2J3LmgiCiAjaW5jbHVkZSAiaW50
ZWxfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFuZC5oIgogI2luY2x1ZGUgIi4uLy4uLy4u
L3BsYXRmb3JtL3g4Ni9pbnRlbF9pcHMuaCIKQEAgLTM2MjAsNyArMzYyMSw3IEBAIHN0YXRpYyBi
b29sIHNrbF9uZWVkc19tZW1vcnlfYndfd2Eoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCXJldHVybiBJU19HRU45X0JDKGRldl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2
KTsKIH0KIAotc3RhdGljIGJvb2wKK2Jvb2wKIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAkvKiBIQUNLISAqLwpAQCAtMzc0MywzOSArMzc0NCwy
NCBAQCBpbnRlbF9kaXNhYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCXJldHVybiAwOwogfQogCi1ib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3N0YXRpYyBib29sIHNrbF9jYW5fZW5hYmxlX3NhZ3Zf
b25fcGlwZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkJZW51bSBwaXBl
IHBpcGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKLQllbnVtIHBpcGUgcGlwZTsKIAlpbnQgbGV2
ZWwsIGxhdGVuY3k7CiAKLQlpZiAoIWludGVsX2hhc19zYWd2KGRldl9wcml2KSkKLQkJcmV0dXJu
IGZhbHNlOwotCi0JLyoKLQkgKiBJZiB0aGVyZSBhcmUgbm8gYWN0aXZlIENSVENzLCBubyBhZGRp
dGlvbmFsIGNoZWNrcyBuZWVkIGJlIHBlcmZvcm1lZAotCSAqLwotCWlmIChod2VpZ2h0OChzdGF0
ZS0+YWN0aXZlX3BpcGVzKSA9PSAwKQotCQlyZXR1cm4gdHJ1ZTsKLQotCS8qCi0JICogU0tMKyB3
b3JrYXJvdW5kOiBic3BlYyByZWNvbW1lbmRzIHdlIGRpc2FibGUgU0FHViB3aGVuIHdlIGhhdmUK
LQkgKiBtb3JlIHRoZW4gb25lIHBpcGUgZW5hYmxlZAotCSAqLwotCWlmIChod2VpZ2h0OChzdGF0
ZS0+YWN0aXZlX3BpcGVzKSA+IDEpCi0JCXJldHVybiBmYWxzZTsKLQotCS8qIFNpbmNlIHdlJ3Jl
IG5vdyBndWFyYW50ZWVkIHRvIG9ubHkgaGF2ZSBvbmUgYWN0aXZlIENSVEMuLi4gKi8KLQlwaXBl
ID0gZmZzKHN0YXRlLT5hY3RpdmVfcGlwZXMpIC0gMTsKIAljcnRjID0gaW50ZWxfZ2V0X2NydGNf
Zm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOwogCWNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0
YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCi0JaWYgKGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21v
ZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcu
YWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKSB7CisJCURSTV9E
RUJVR19LTVMoIk5vIFNBR1YgZm9yIGludGVybGFjZWQgbW9kZSBvbiBwaXBlICVjXG4iLAorCQkJ
ICAgICAgcGlwZV9uYW1lKHBpcGUpKTsKIAkJcmV0dXJuIGZhbHNlOworCX0KIAogCWZvcl9lYWNo
X2ludGVsX3BsYW5lX29uX2NydGMoZGV2LCBjcnRjLCBwbGFuZSkgewogCQlzdHJ1Y3Qgc2tsX3Bs
YW5lX3dtICp3bSA9CkBAIC0zODAyLDcgKzM3ODgsMTU5IEBAIGJvb2wgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkgKiBpbmN1ciBtZW1v
cnkgbGF0ZW5jaWVzIGhpZ2hlciB0aGFuIHNhZ3ZfYmxvY2tfdGltZV91cyB3ZQogCQkgKiBjYW4n
dCBlbmFibGUgU0FHVi4KIAkJICovCi0JCWlmIChsYXRlbmN5IDwgZGV2X3ByaXYtPnNhZ3ZfYmxv
Y2tfdGltZV91cykKKwkJaWYgKGxhdGVuY3kgPCBkZXZfcHJpdi0+c2Fndl9ibG9ja190aW1lX3Vz
KSB7CisJCQlEUk1fREVCVUdfS01TKCJMYXRlbmN5ICVkIDwgc2FndiBibG9jayB0aW1lICVkLCBu
byBTQUdWIGZvciBwaXBlICVjXG4iLAorCQkJCSAgICAgIGxhdGVuY3ksIGRldl9wcml2LT5zYWd2
X2Jsb2NrX3RpbWVfdXMsIHBpcGVfbmFtZShwaXBlKSk7CisJCQlyZXR1cm4gZmFsc2U7CisJCX0K
Kwl9CisKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfc2Fndl9t
YXNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjOworCWVudW0gcGlwZSBwaXBlOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3
X2J3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9id19zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNf
RVJSKG5ld19id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxu
Iik7CisJCXJldHVybjsKKwl9CisKKworCWlmIChzdGF0ZS0+YWN0aXZlX3BpcGVzICE9IDEpIHsK
KwkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayA9IDA7CisJCURSTV9ERUJVR19LTVMoIk5v
IFNBR1YgZm9yIG11bHRpcGxlIHBpcGVzIG9uIEdlbiA5XG4iKTsKKwkJcmV0dXJuOworCX0KKwor
CS8qIFNpbmNlIHdlJ3JlIG5vdyBndWFyYW50ZWVkIHRvIG9ubHkgaGF2ZSBvbmUgYWN0aXZlIENS
VEMuLi4gKi8KKwlwaXBlID0gZmZzKHN0YXRlLT5hY3RpdmVfcGlwZXMpIC0gMTsKKworCWlmIChz
a2xfY2FuX2VuYWJsZV9zYWd2X29uX3BpcGUoc3RhdGUsIHBpcGUpKQorCQluZXdfYndfc3RhdGUt
PnBpcGVfc2Fndl9tYXNrIHw9IEJJVChjcnRjLT5waXBlKTsKKwllbHNlCisJCW5ld19id19zdGF0
ZS0+cGlwZV9zYWd2X21hc2sgJj0gfkJJVChjcnRjLT5waXBlKTsKK30KKworc3RhdGljIHZvaWQg
dGdsX2NvbXB1dGVfc2Fndl9tYXNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKTsK
Kworc3RhdGljIHZvaWQgaWNsX2NvbXB1dGVfc2Fndl9tYXNrKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCXN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlpbnQgaTsKKwlzdHJ1Y3QgaW50ZWxfYndf
c3RhdGUgKm5ld19id19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfYndfc3RhdGUoc3RhdGUpOwor
CisJaWYgKElTX0VSUihuZXdfYndfc3RhdGUpKSB7CisJCVdBUk4oMSwgIkNvdWxkIG5vdCBnZXQg
Yndfc3RhdGVcbiIpOworCQlyZXR1cm47CisJfQorCisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNf
aW5fc3RhdGUoc3RhdGUsIGNydGMsCisJCQkJCSBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAo
c2tsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBlKHN0YXRlLCBjcnRjLT5waXBlKSkKKwkJCW5ld19i
d19zdGF0ZS0+cGlwZV9zYWd2X21hc2sgfD0gQklUKGNydGMtPnBpcGUpOworCQllbHNlCisJCQlu
ZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9tYXNrICY9IH5CSVQoY3J0Yy0+cGlwZSk7CisJfQorfQor
Cit2b2lkIGludGVsX2NvbXB1dGVfc2Fndl9tYXNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlLCBpbnQgdG90YWxfYWZmZWN0ZWRfcGxhbmVzKQoreworCWludCByZXQ7CisJc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX2J3X3N0YXRlICpu
ZXdfYndfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X2J3X3N0YXRlKHN0YXRlKTsKKwlzdHJ1Y3Qg
aW50ZWxfYndfc3RhdGUgKm9sZF9id19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfb2xkX2J3X3N0
YXRlKHN0YXRlKTsKKworCWlmIChJU19FUlIobmV3X2J3X3N0YXRlKSB8fCBJU19FUlIob2xkX2J3
X3N0YXRlKSkgeworCQlXQVJOKDEsICJDb3VsZCBub3QgZ2V0IGJ3X3N0YXRlXG4iKTsKKwkJcmV0
dXJuOworCX0KKworCS8qCisJICogSWYgYWN0aXZlX3BpcGVzIGhhZCBjaGFuZ2VkLCBtZWFucyB3
ZSBoYXZlIGFkZGVkL3JlbW92ZWQgY3J0YywKKwkgKiBpZiB0b3RhbF9hZmZlY3RlZF9wbGFuZXMg
aGFkIGNoYW5nZWQgLSBtZWFucyB3ZSBoYXZlIGNoYW5nZWQgd20vZGRiLgorCSAqIEJvdGggcmVx
dWlyZSBTQUdWIHJlY2FsY3VsYXRpb24gLSBvdGhlcndpc2UganVzdCByZXR1cm4gYW5kIFNBR1Yg
bWFzaworCSAqIHdpbGwgc3RheSB0aGUgc2FtZS4KKwkgKiBBbHNvIHdlIHdpbGwgaGF2ZSBjcnRj
IGxvY2tzIGdyYWJiZWQgb25seSBpbiBtZW50aW9uZWQgYWJvdmUgY2FzZXMuCisJICovCisJaWYg
KChzdGF0ZS0+YWN0aXZlX3BpcGVzID09IGRldl9wcml2LT5hY3RpdmVfcGlwZXMpICYmCisJICAg
ICh0b3RhbF9hZmZlY3RlZF9wbGFuZXMgPT0gMCkpCisJCXJldHVybjsKKworCS8qCisJICogTm93
IG9uY2Ugd2UgZ290IHdtIGxldmVscyBjYWxjdWxhdGVkLAorCSAqIGNoZWNrIGlmIHdlIGNhbiBo
YXZlIFNBR1YuCisJICovCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCXRnbF9j
b21wdXRlX3NhZ3ZfbWFzayhzdGF0ZSk7CisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA9
PSAxMSkKKwkJaWNsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlKTsKKwllbHNlCisJCXNrbF9jb21w
dXRlX3NhZ3ZfbWFzayhzdGF0ZSk7CisKKwlzdGF0ZS0+c2Fndl9jYWxjdWxhdGVkID0gdHJ1ZTsK
KworCS8qCisJICogRm9yIFNBR1Ygd2UgbmVlZCB0byBhY2NvdW50IGFsbCB0aGUgcGlwZXMsCisJ
ICogbm90IG9ubHkgdGhlIG9uZXMgd2hpY2ggYXJlIGluIHN0YXRlIGN1cnJlbnRseS4KKwkgKiBH
cmFiIGFsbCBsb2NrcyBpZiB3ZSBkZXRlY3QgdGhhdCB3ZSBhcmUgYWN0dWFsbHkKKwkgKiBnb2lu
ZyB0byBkbyBzb21ldGhpbmcuCisJICovCisJaWYgKG5ld19id19zdGF0ZS0+cGlwZV9zYWd2X21h
c2sgIT0gb2xkX2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzaykgeworCQlyZXQgPSBpbnRlbF9hdG9t
aWNfc2VyaWFsaXplX2dsb2JhbF9zdGF0ZSgmbmV3X2J3X3N0YXRlLT5iYXNlKTsKKwkJaWYgKHJl
dCkgeworCQkJRFJNX0RFQlVHX0tNUygiQ291bGQgbm90IHNlcmlhbGl6ZSBnbG9iYWwgc3RhdGVc
biIpOworCQkJcmV0dXJuOworCQl9CisJfQorfQorCisvKgorICogVGhpcyBmdW5jdGlvbiB0byBi
ZSB1c2VkIGJlZm9yZSBzd2FwIHN0YXRlCisgKi8KK2Jvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2
X2Zvcl9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gc3RhdGUtPmJhc2UuZGV2OworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlpbnQgaTsKKwlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJc3Ry
dWN0IGludGVsX2J3X3N0YXRlICpuZXdfYndfc3RhdGUgID0gaW50ZWxfYXRvbWljX2dldF9id19z
dGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAi
Q291bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlpZiAo
IWludGVsX2hhc19zYWd2KGRldl9wcml2KSkgeworCQlEUk1fREVCVUdfS01TKCJObyBTQUdWIHN1
cHBvcnQgZGV0ZWN0ZWRcbiIpOworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJLyoKKwkgKiBTaG91
bGQgaGF2ZSB0aGlzIGNhbGN1bGF0ZWQgYnkgdGhhdCB0aW1lLAorCSAqIG1lYW5zIHNvbWV0aGlu
ZyBnb3QgY2hhbmdlZCBvciB3cm9uZyBpbiB0aGUgZHJpdmVyCisJICogY3VycmVudGx5LCBzdXBw
b3NlZCBwbGFjZXMgd2hpY2ggY2FsbCB0aGlzIGZ1bmN0aW9uIGFyZToKKwkgKiBpbnRlbF9hdG9t
aWNfY29tbWl0X3RhaWwsIGludGVsX2F0b21pY19id19jaGVjaywKKwkgKiBza2xfYWxsb2NhdGVf
cGlwZV9kZGIsIHNrbF93cml0ZV9wbGFuZV93bS4KKwkgKiBBbGwgb2YgdGhvc2UgYXJlIHN1cHBv
c2VkIHRvIGJlIGNhbGxlZCBhZnRlcgorCSAqIHNrbF9jb21wdXRlX3dtLT5pbnRlbF9jb21wdXRl
X3NhZ3ZfbWFzayBpcyBjYWxsZWQuCisJICovCisJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0s
ICFzdGF0ZS0+c2Fndl9jYWxjdWxhdGVkKTsKKworCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2lu
X3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQl1MzIgbWFzayA9IEJJ
VChjcnRjLT5waXBlKTsKKwkJYm9vbCBzdGF0ZV9zYWd2X21hc2tlZCA9IChtYXNrICYgbmV3X2J3
X3N0YXRlLT5waXBlX3NhZ3ZfbWFzaykgPT0gMDsKKworCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5o
dy5hY3RpdmUpCisJCQljb250aW51ZTsKKworCQlpZiAoc3RhdGVfc2Fndl9tYXNrZWQpCiAJCQly
ZXR1cm4gZmFsc2U7CiAJfQogCkBAIC0zODQyLDYgKzM5ODAsMzQgQEAgc3RhdGljIHUxNiBpbnRl
bF9nZXRfZGRiX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVy
biBkZGJfc2l6ZTsKIH0KIAorLyoKKyAqIFRvIGJlIHVzZWQgYWZ0ZXIgd2Ugc3dhcCBzdGF0ZQor
ICovCitib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCit7CisJaW50IGk7CisJc3RydWN0IGludGVsX2dsb2JhbF9zdGF0ZSAqZ2xvYmFs
X3N0YXRlOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGU7CisKKwlnbG9iYWxfc3Rh
dGUgPSBkZXZfcHJpdi0+Yndfb2JqLnN0YXRlOworCWlmIChJU19FUlIoZ2xvYmFsX3N0YXRlKSkg
eworCQlXQVJOKDEsICJDb3VsZCBub3QgZ2V0IGdsb2JhbCBzdGF0ZVxuIik7CisJCXJldHVybiBm
YWxzZTsKKwl9CisKKwlid19zdGF0ZSA9IHRvX2ludGVsX2J3X3N0YXRlKGdsb2JhbF9zdGF0ZSk7
CisKKwlmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhfUElQRVM7IGkrKykgeworCQlpbnQgYWN0aXZl
X3BpcGVfYml0ID0gZGV2X3ByaXYtPmFjdGl2ZV9waXBlcyAmIEJJVChpKTsKKwkJaWYgKGFjdGl2
ZV9waXBlX2JpdCkgeworCQkJaWYgKChid19zdGF0ZS0+cGlwZV9zYWd2X21hc2sgJiBCSVQoaSkp
ID09IDApCisJCQkJcmV0dXJuIGZhbHNlOworCQl9CisJfQorCisJcmV0dXJuIHRydWU7Cit9CisK
IHN0YXRpYyB1OCBza2xfY29tcHV0ZV9kYnVmX3NsaWNlcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgIHUzMiBhY3RpdmVfcGlwZXMpOwogCkBAIC00MDI4
LDYgKzQxOTQsNyBAQCBza2xfY3Vyc29yX2FsbG9jYXRpb24oY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXUzMiBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9s
YXRlbmN5W2xldmVsXTsKIAogCQlza2xfY29tcHV0ZV9wbGFuZV93bShjcnRjX3N0YXRlLCBsZXZl
bCwgbGF0ZW5jeSwgJndwLCAmd20sICZ3bSk7CisKIAkJaWYgKHdtLm1pbl9kZGJfYWxsb2MgPT0g
VTE2X01BWCkKIAkJCWJyZWFrOwogCkBAIC00NTU0LDEyICs0NzIxLDkzIEBAIHNrbF9wbGFuZV93
bV9sZXZlbChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkgICBpbnQgbGV2ZWwsCiAJCSAg
IGludCBjb2xvcl9wbGFuZSkKIHsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBj
cnRjX3N0YXRlLT51YXBpLnN0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNydGNfc3Rh
dGUtPnVhcGkuY3J0YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmRldik7CiAJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQogCQkmY3J0
Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3BsYW5lLT5pZF07CiAKKwlpZiAoIWxldmVs
KSB7CisJCWJvb2wgY2FuX3NhZ3YgPSBmYWxzZTsKKworCQkvKgorCQkgKiBJZiB3ZSBoYXZlbid0
IHlldCBzd2FwcGVkIG91ciBzdGF0ZSwgd2Ugc2hvdWxkIHVzZQorCQkgKiB0aGUgc3RhdGUgdG8g
ZGV0ZXJtaW5lIFNBR1YsIG90aGVyd2lzZSB1c2UgZ2xvYmFsCisJCSAqIHN0YXRlIGFzIGF0b21p
YyBzdGF0ZSBwb2ludGVyIG1pZ2h0IGJlY29tZSBzdGFsZQorCQkgKiBhbmQgemVyb2VkIG91dC4K
KwkJICovCisJCWlmIChzdGF0ZSkgeworCQkJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50
ZWxfc3RhdGUgPQorCQkJCXRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CisJCQljYW5fc2Fn
diA9IGludGVsX2Nhbl9lbmFibGVfc2Fndl9mb3Jfc3RhdGUoaW50ZWxfc3RhdGUpOworCQl9IGVs
c2UgeworCQkJY2FuX3NhZ3YgPSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YoZGV2X3ByaXYpOworCQl9
CisKKwkJaWYgKGNhbl9zYWd2KQorCQkJcmV0dXJuIGNvbG9yX3BsYW5lID8gJndtLT51dl9zYWd2
X3dtMCA6ICZ3bS0+c2Fndl93bTA7CisJfQorCiAJcmV0dXJuIGNvbG9yX3BsYW5lID8gJndtLT51
dl93bVtsZXZlbF0gOiAmd20tPndtW2xldmVsXTsKIH0KIAorc3RhdGljIGludAordGdsX2NoZWNr
X3BpcGVfZml0c19zYWd2X3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQor
eworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNydGNfc3RhdGUtPnVhcGkuY3J0YzsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CisJc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOworCXN0cnVj
dCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjcnRjX3N0YXRlLT53bS5za2wuZGRiOworCXUxNiBh
bGxvY19zaXplOworCXU2NCB0b3RhbF9kYXRhX3JhdGU7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZDsKKwlpbnQgbnVtX2FjdGl2ZTsKKwl1NjQgcGxhbmVfZGF0YV9yYXRlW0k5MTVfTUFYX1BMQU5F
U10gPSB7fTsKKwl1MzIgYmxvY2tzOworCisJLyoKKwkgKiBObyBuZWVkIHRvIGNoZWNrIGdlbiBo
ZXJlLCB3ZSBjYWxsIHRoaXMgb25seSBmb3IgZ2VuMTIKKwkgKi8KKwl0b3RhbF9kYXRhX3JhdGUg
PQorCQlpY2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShjcnRjX3N0YXRlLAorCQkJCQkJ
IHBsYW5lX2RhdGFfcmF0ZSk7CisKKwlza2xfZGRiX2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRz
KGRldl9wcml2LCBjcnRjX3N0YXRlLAorCQkJCQkgICB0b3RhbF9kYXRhX3JhdGUsCisJCQkJCSAg
IGFsbG9jLCAmbnVtX2FjdGl2ZSk7CisJYWxsb2Nfc2l6ZSA9IHNrbF9kZGJfZW50cnlfc2l6ZShh
bGxvYyk7CisJaWYgKGFsbG9jX3NpemUgPT0gMCkKKwkJcmV0dXJuIC1FTk9TUEM7CisKKwkvKgor
CSAqIERvIGNoZWNrIGlmIHdlIGNhbiBmaXQgTDAgKyBzYWd2X2Jsb2NrX3RpbWUgYW5kCisJICog
ZGlzYWJsZSBTQUdWIGlmIHdlIGNhbid0LgorCSAqLworCWJsb2NrcyA9IDA7CisJZm9yX2VhY2hf
cGxhbmVfaWRfb25fY3J0YyhpbnRlbF9jcnRjLCBwbGFuZV9pZCkgeworCQkvKgorCQkgKiBUaGUg
b25seSBwbGFjZSwgd2hlcmUgd2UgY2FuJ3QgdXNlIHNrbF9wbGFuZV93bV9sZXZlbAorCQkgKiBh
Y2Nlc3NvciwgYmVjYXVzZSBpZiBhY3R1YWxseSBjYWxscyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YK
KwkJICogd2hpY2ggZGVwZW5kcyBvbiB0aGF0IGZ1bmN0aW9uLgorCQkgKi8KKwkJY29uc3Qgc3Ry
dWN0IHNrbF9wbGFuZV93bSAqd20gPQorCQkJJmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBs
YW5lc1twbGFuZV9pZF07CisKKwkJYmxvY2tzICs9IHdtLT5zYWd2X3dtMC5taW5fZGRiX2FsbG9j
OworCQlibG9ja3MgKz0gd20tPnV2X3NhZ3Zfd20wLm1pbl9kZGJfYWxsb2M7CisKKwkJaWYgKGJs
b2NrcyA+IGFsbG9jX3NpemUpIHsKKwkJCURSTV9ERUJVR19LTVMoIk5vdCBlbm91Z2ggZGRiIGJs
b2NrcyglZDwlZCkgZm9yIFNBR1Ygb24gcGlwZSAlY1xuIiwKKwkJCQkgICAgICBhbGxvY19zaXpl
LCBibG9ja3MsIHBpcGVfbmFtZShpbnRlbF9jcnRjLT5waXBlKSk7CisJCQlyZXR1cm4gLUVOT1NQ
QzsKKwkJfQorCX0KKwlEUk1fREVCVUdfS01TKCIlZCB0b3RhbCBibG9ja3MgcmVxdWlyZWQgZm9y
IFNBR1YsIGRkYiBlbnRyeSBzaXplICVkXG4iLAorCQkgICAgICBibG9ja3MsIGFsbG9jX3NpemUp
OworCXJldHVybiAwOworfQorCisKIHN0YXRpYyBpbnQKIHNrbF9hbGxvY2F0ZV9waXBlX2RkYihz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKQEAgLTUxNDMsMTEgKzUzOTEs
MTkgQEAgc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfcGxhbmVfd20oY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgdm9pZAogc2tsX2NvbXB1dGVfd21fbGV2
ZWxzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkgICAgICBj
b25zdCBzdHJ1Y3Qgc2tsX3dtX3BhcmFtcyAqd21fcGFyYW1zLAotCQkgICAgICBzdHJ1Y3Qgc2ts
X3dtX2xldmVsICpsZXZlbHMpCisJCSAgICAgIHN0cnVjdCBza2xfcGxhbmVfd20gKnBsYW5lX3dt
LAorCQkgICAgICBib29sIHl1dikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlpbnQgbGV2ZWwsIG1h
eF9sZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOworCS8qCisJICogQ2hlY2sgd2hp
Y2gga2luZCBvZiBwbGFuZSBpcyBpdCBhbmQgYmFzZWQgb24gdGhhdCBjYWxjdWxhdGUKKwkgKiBj
b3JyZXNwb25kZW50IFdNIGxldmVscy4KKwkgKi8KKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpsZXZl
bHMgPSB5dXYgPyBwbGFuZV93bS0+dXZfd20gOiBwbGFuZV93bS0+d207CiAJc3RydWN0IHNrbF93
bV9sZXZlbCAqcmVzdWx0X3ByZXYgPSAmbGV2ZWxzWzBdOworCXN0cnVjdCBza2xfd21fbGV2ZWwg
KnNhZ3Zfd20gPSB5dXYgPworCQkJCSZwbGFuZV93bS0+dXZfc2Fndl93bTAgOiAmcGxhbmVfd20t
PnNhZ3Zfd20wOwogCiAJZm9yIChsZXZlbCA9IDA7IGxldmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwr
KykgewogCQlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHQgPSAmbGV2ZWxzW2xldmVsXTsKQEAg
LTUxNTgsNiArNTQxNCwyNyBAQCBza2xfY29tcHV0ZV93bV9sZXZlbHMoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIAkJcmVzdWx0X3ByZXYgPSByZXN1bHQ7CiAJ
fQorCS8qCisJICogRm9yIEdlbjEyIGlmIGl0IGlzIGFuIEwwIHdlIG5lZWQgdG8gYWxzbworCSAq
IGNvbnNpZGVyIHNhZ3ZfYmxvY2tfdGltZSB3aGVuIGNhbGN1bGF0aW5nCisJICogTDAgd2F0ZXJt
YXJrIC0gd2Ugd2lsbCBuZWVkIHRoYXQgd2hlbiBtYWtpbmcKKwkgKiBhIGRlY2lzaW9uIHdoZXRo
ZXIgZW5hYmxlIFNBR1Ygb3Igbm90LgorCSAqIEZvciBvbGRlciBnZW5zIHdlIGFncmVlZCB0byBj
b3B5IEwwIHZhbHVlIGZvcgorCSAqIGNvbXBhdGliaWxpdHkuCisJICovCisJaWYgKChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEyKSkgeworCQl1MzIgbGF0ZW5jeSA9IGRldl9wcml2LT53bS5za2xf
bGF0ZW5jeVswXTsKKworCQlsYXRlbmN5ICs9IGRldl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVfdXM7
CisJCXNrbF9jb21wdXRlX3BsYW5lX3dtKGNydGNfc3RhdGUsIDAsIGxhdGVuY3ksCisJCQkJICAg
ICB3bV9wYXJhbXMsICZsZXZlbHNbMF0sCisJCQkJICAgICBzYWd2X3dtKTsKKwkJRFJNX0RFQlVH
X0tNUygiJWQgTDAgYmxvY2tzIHJlcXVpcmVkIGZvciBTQUdWIHZzICVkIGZvciBub24tU0FHVlxu
IiwKKwkJCSAgICAgIHNhZ3Zfd20tPm1pbl9kZGJfYWxsb2MsIGxldmVsc1swXS5taW5fZGRiX2Fs
bG9jKTsKKwl9IGVsc2UgeworCQkvKiBTaW5jZSBhbGwgbWVtYmVycyBhcmUgUE9EICovCisJCSpz
YWd2X3dtID0gbGV2ZWxzWzBdOworCX0KIH0KIAogc3RhdGljIHZvaWQgc2tsX2NvbXB1dGVfdHJh
bnNpdGlvbl93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKQEAg
LTUyMzIsNyArNTUwOSw3IEBAIHN0YXRpYyBpbnQgc2tsX2J1aWxkX3BsYW5lX3dtX3NpbmdsZShz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCi0Jc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdt
LT53bSk7CisJc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdt
LCBmYWxzZSk7CiAJc2tsX2NvbXB1dGVfdHJhbnNpdGlvbl93bShjcnRjX3N0YXRlLCAmd21fcGFy
YW1zLCB3bSk7CiAKIAlyZXR1cm4gMDsKQEAgLTUyNTQsNyArNTUzMSw3IEBAIHN0YXRpYyBpbnQg
c2tsX2J1aWxkX3BsYW5lX3dtX3V2KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlza2xfY29tcHV0ZV93bV9sZXZlbHMoY3J0
Y19zdGF0ZSwgJndtX3BhcmFtcywgd20tPnV2X3dtKTsKKwlza2xfY29tcHV0ZV93bV9sZXZlbHMo
Y3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20sIHRydWUpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC01
NTg1LDEwICs1ODYyLDI5IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogCQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJp
di0+ZHJtLCBjcnRjLCBwbGFuZSkgewogCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5l
LT5pZDsKIAkJCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKm9sZF93bSwgKm5ld193bTsKKwkJ
CXUxNiBvbGRfcGxhbmVfcmVzX2wsIG5ld19wbGFuZV9yZXNfbDsKKwkJCXU4ICBvbGRfcGxhbmVf
cmVzX2IsIG5ld19wbGFuZV9yZXNfYjsKKwkJCXUxNiBvbGRfbWluX2RkYl9hbGxvYywgbmV3X21p
bl9kZGJfYWxsb2M7CiAKIAkJCW9sZF93bSA9ICZvbGRfcGlwZV93bS0+cGxhbmVzW3BsYW5lX2lk
XTsKIAkJCW5ld193bSA9ICZuZXdfcGlwZV93bS0+cGxhbmVzW3BsYW5lX2lkXTsKIAorCQkJb2xk
X3BsYW5lX3Jlc19sID0gaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGRldl9wcml2KSA/CisJCQkJCSAg
b2xkX3dtLT5zYWd2X3dtMC5wbGFuZV9yZXNfbCA6IG9sZF93bS0+d21bMF0ucGxhbmVfcmVzX2w7
CisJCQlvbGRfcGxhbmVfcmVzX2IgPSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YoZGV2X3ByaXYpID8K
KwkJCQkJICBvbGRfd20tPnNhZ3Zfd20wLnBsYW5lX3Jlc19iIDogb2xkX3dtLT53bVswXS5wbGFu
ZV9yZXNfYjsKKworCQkJbmV3X3BsYW5lX3Jlc19sID0gaW50ZWxfY2FuX2VuYWJsZV9zYWd2X2Zv
cl9zdGF0ZShzdGF0ZSkgPworCQkJCQkgIG5ld193bS0+c2Fndl93bTAucGxhbmVfcmVzX2wgOiBu
ZXdfd20tPndtWzBdLnBsYW5lX3Jlc19sOworCQkJbmV3X3BsYW5lX3Jlc19iID0gaW50ZWxfY2Fu
X2VuYWJsZV9zYWd2X2Zvcl9zdGF0ZShzdGF0ZSkgPworCQkJCQkgIG5ld193bS0+c2Fndl93bTAu
cGxhbmVfcmVzX2IgOiBuZXdfd20tPndtWzBdLnBsYW5lX3Jlc19iOworCisJCQlvbGRfbWluX2Rk
Yl9hbGxvYyA9IGludGVsX2Nhbl9lbmFibGVfc2FndihkZXZfcHJpdikgPworCQkJCQkgICAgb2xk
X3dtLT5zYWd2X3dtMC5taW5fZGRiX2FsbG9jIDogb2xkX3dtLT53bVswXS5taW5fZGRiX2FsbG9j
OworCisJCQluZXdfbWluX2RkYl9hbGxvYyA9IGludGVsX2Nhbl9lbmFibGVfc2Fndl9mb3Jfc3Rh
dGUoc3RhdGUpID8KKwkJCQkJICAgIG5ld193bS0+c2Fndl93bTAubWluX2RkYl9hbGxvYyA6IG5l
d193bS0+d21bMF0ubWluX2RkYl9hbGxvYzsKKwogCQkJaWYgKHNrbF9wbGFuZV93bV9lcXVhbHMo
ZGV2X3ByaXYsIG9sZF93bSwgbmV3X3dtKSkKIAkJCQljb250aW51ZTsKIApAQCAtNTYxMSw3ICs1
OTA3LDcgQEAgc2tsX3ByaW50X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiAJCQkJICAgICJbUExBTkU6JWQ6JXNdICAgbGluZXMgJWMlM2QsJWMlM2QsJWMlM2Qs
JWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QiCiAJCQkJICAgICAgIiAtPiAlYyUz
ZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZFxuIiwKIAkJ
CQkgICAgcGxhbmUtPmJhc2UuYmFzZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwKLQkJCQkgICAgZW5h
c3Qob2xkX3dtLT53bVswXS5pZ25vcmVfbGluZXMpLCBvbGRfd20tPndtWzBdLnBsYW5lX3Jlc19s
LAorCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzBdLmlnbm9yZV9saW5lcyksIG9sZF9wbGFuZV9y
ZXNfbCwKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVsxXS5pZ25vcmVfbGluZXMpLCBvbGRfd20t
PndtWzFdLnBsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzJdLmlnbm9yZV9s
aW5lcyksIG9sZF93bS0+d21bMl0ucGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+
d21bM10uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53bVszXS5wbGFuZV9yZXNfbCwKQEAgLTU2MjEs
NyArNTkxNyw3IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzddLmlnbm9yZV9saW5lcyksIG9s
ZF93bS0+d21bN10ucGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+dHJhbnNfd20u
aWdub3JlX2xpbmVzKSwgb2xkX3dtLT50cmFuc193bS5wbGFuZV9yZXNfbCwKIAotCQkJCSAgICBl
bmFzdChuZXdfd20tPndtWzBdLmlnbm9yZV9saW5lcyksIG5ld193bS0+d21bMF0ucGxhbmVfcmVz
X2wsCisJCQkJICAgIGVuYXN0KG5ld193bS0+d21bMF0uaWdub3JlX2xpbmVzKSwgbmV3X3BsYW5l
X3Jlc19sLAogCQkJCSAgICBlbmFzdChuZXdfd20tPndtWzFdLmlnbm9yZV9saW5lcyksIG5ld193
bS0+d21bMV0ucGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG5ld193bS0+d21bMl0uaWdub3Jl
X2xpbmVzKSwgbmV3X3dtLT53bVsyXS5wbGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3QobmV3X3dt
LT53bVszXS5pZ25vcmVfbGluZXMpLCBuZXdfd20tPndtWzNdLnBsYW5lX3Jlc19sLApAQCAtNTYz
NSwxMiArNTkzMSwxMiBAQCBza2xfcHJpbnRfd21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAkJCQkgICAgIltQTEFORTolZDolc10gIGJsb2NrcyAlNGQsJTRkLCU0
ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCIKIAkJCQkgICAgIiAtPiAlNGQsJTRkLCU0ZCwlNGQs
JTRkLCU0ZCwlNGQsJTRkLCU0ZFxuIiwKIAkJCQkgICAgcGxhbmUtPmJhc2UuYmFzZS5pZCwgcGxh
bmUtPmJhc2UubmFtZSwKLQkJCQkgICAgb2xkX3dtLT53bVswXS5wbGFuZV9yZXNfYiwgb2xkX3dt
LT53bVsxXS5wbGFuZV9yZXNfYiwKKwkJCQkgICAgb2xkX3BsYW5lX3Jlc19iLCBvbGRfd20tPndt
WzFdLnBsYW5lX3Jlc19iLAogCQkJCSAgICBvbGRfd20tPndtWzJdLnBsYW5lX3Jlc19iLCBvbGRf
d20tPndtWzNdLnBsYW5lX3Jlc19iLAogCQkJCSAgICBvbGRfd20tPndtWzRdLnBsYW5lX3Jlc19i
LCBvbGRfd20tPndtWzVdLnBsYW5lX3Jlc19iLAogCQkJCSAgICBvbGRfd20tPndtWzZdLnBsYW5l
X3Jlc19iLCBvbGRfd20tPndtWzddLnBsYW5lX3Jlc19iLAogCQkJCSAgICBvbGRfd20tPnRyYW5z
X3dtLnBsYW5lX3Jlc19iLAotCQkJCSAgICBuZXdfd20tPndtWzBdLnBsYW5lX3Jlc19iLCBuZXdf
d20tPndtWzFdLnBsYW5lX3Jlc19iLAorCQkJCSAgICBuZXdfcGxhbmVfcmVzX2IsIG5ld193bS0+
d21bMV0ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG5ld193bS0+d21bMl0ucGxhbmVfcmVzX2IsIG5l
d193bS0+d21bM10ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG5ld193bS0+d21bNF0ucGxhbmVfcmVz
X2IsIG5ld193bS0+d21bNV0ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG5ld193bS0+d21bNl0ucGxh
bmVfcmVzX2IsIG5ld193bS0+d21bN10ucGxhbmVfcmVzX2IsCkBAIC01NjUwLDEyICs1OTQ2LDEy
IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCQkJCSAgICAiW1BMQU5FOiVkOiVzXSBtaW5fZGRiICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRk
LCU0ZCwlNGQsJTRkIgogCQkJCSAgICAiIC0+ICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwl
NGQsJTRkXG4iLAogCQkJCSAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1l
LAotCQkJCSAgICBvbGRfd20tPndtWzBdLm1pbl9kZGJfYWxsb2MsIG9sZF93bS0+d21bMV0ubWlu
X2RkYl9hbGxvYywKKwkJCQkgICAgb2xkX21pbl9kZGJfYWxsb2MsIG9sZF93bS0+d21bMV0ubWlu
X2RkYl9hbGxvYywKIAkJCQkgICAgb2xkX3dtLT53bVsyXS5taW5fZGRiX2FsbG9jLCBvbGRfd20t
PndtWzNdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG9sZF93bS0+d21bNF0ubWluX2RkYl9hbGxv
Yywgb2xkX3dtLT53bVs1XS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRfd20tPndtWzZdLm1p
bl9kZGJfYWxsb2MsIG9sZF93bS0+d21bN10ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgb2xkX3dt
LT50cmFuc193bS5taW5fZGRiX2FsbG9jLAotCQkJCSAgICBuZXdfd20tPndtWzBdLm1pbl9kZGJf
YWxsb2MsIG5ld193bS0+d21bMV0ubWluX2RkYl9hbGxvYywKKwkJCQkgICAgbmV3X21pbl9kZGJf
YWxsb2MsIG5ld193bS0+d21bMV0ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgbmV3X3dtLT53bVsy
XS5taW5fZGRiX2FsbG9jLCBuZXdfd20tPndtWzNdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG5l
d193bS0+d21bNF0ubWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVs1XS5taW5fZGRiX2FsbG9jLAog
CQkJCSAgICBuZXdfd20tPndtWzZdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+d21bN10ubWluX2Rk
Yl9hbGxvYywKQEAgLTU3NTUsNyArNjA1MSw4IEBAIHNrbF9kZGJfYWRkX2FmZmVjdGVkX3BpcGVz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogICogZGVmYXVsdCB2YWx1ZSBvZiB0
aGUgd2F0ZXJtYXJrcyByZWdpc3RlcnMgaXMgbm90IHplcm8uCiAgKi8KIHN0YXRpYyBpbnQgc2ts
X3dtX2FkZF9hZmZlY3RlZF9wbGFuZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUs
Ci0JCQkJICAgICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpCisJCQkJICAgICAgc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCisJCQkJICAgICAgaW50ICpudW1fYWZmZWN0ZWRfcGxhbmVzKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9CkBA
IC01NzY0LDYgKzYwNjEsOCBAQCBzdGF0aWMgaW50IHNrbF93bV9hZGRfYWZmZWN0ZWRfcGxhbmVz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQlpbnRlbF9hdG9taWNfZ2V0X25l
d19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwog
CisJKm51bV9hZmZlY3RlZF9wbGFuZXMgPSAwOworCiAJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25f
Y3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YywgcGxhbmUpIHsKIAkJc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZTsKIAkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5p
ZDsKQEAgLTU3ODcsMTEgKzYwODYsNjQgQEAgc3RhdGljIGludCBza2xfd21fYWRkX2FmZmVjdGVk
X3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCXJldHVybiBQVFJf
RVJSKHBsYW5lX3N0YXRlKTsKIAogCQluZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BsYW5lcyB8PSBC
SVQocGxhbmVfaWQpOworCQkqbnVtX2FmZmVjdGVkX3BsYW5lcyArPSAxOwogCX0KIAogCXJldHVy
biAwOwogfQogCitzdGF0aWMgdm9pZCB0Z2xfY29tcHV0ZV9zYWd2X21hc2soc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
OworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGU7CisJaW50IHJldDsKKwlpbnQgaTsKKwlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3X2J3X3N0
YXRlICA9IGludGVsX2F0b21pY19nZXRfYndfc3RhdGUoc3RhdGUpOworCisJaWYgKElTX0VSUihu
ZXdfYndfc3RhdGUpKSB7CisJCVdBUk4oMSwgIkNvdWxkIG5vdCBnZXQgYndfc3RhdGVcbiIpOwor
CQlyZXR1cm47CisJfQorCisJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3Rh
dGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLAorCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsK
KwkJaW50IHBpcGVfYml0ID0gQklUKGNydGMtPnBpcGUpOworCQlib29sIHNraXAgPSB0cnVlOwor
CisJCS8qCisJCSAqIElmIHdlIGhhZCBzZXQgdGhpcyBtYXN0IGFscmVhZHkgb25jZSBmb3IgdGhp
cyBzdGF0ZSwKKwkJICogbm8gbmVlZCB0byB3YXN0ZSBDUFUgY3ljbGVzIGZvciBkb2luZyB0aGlz
IGFnYWluLgorCQkgKi8KKwkJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYt
PmRybSwgY3J0YywgcGxhbmUpIHsKKwkJCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+
aWQ7CisKKwkJCWlmICghc2tsX3BsYW5lX3dtX2VxdWFscyhkZXZfcHJpdiwKKwkJCQkJCSAmb2xk
X2NydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF0sCisJCQkJCQkgJm5l
d19jcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbC5wbGFuZXNbcGxhbmVfaWRdKSkgeworCQkJCXNr
aXAgPSBmYWxzZTsKKwkJCQlicmVhazsKKwkJCX0KKwkJfQorCisJCS8qCisJCSAqIENoZWNrIGlm
IHdtIGxldmVscyBhcmUgYWN0dWFsbHkgdGhlIHNhbWUgYXMgZm9yIHByZXZpb3VzCisJCSAqIHN0
YXRlLCB3aGljaCBtZWFucyB3ZSBjYW4ganVzdCBza2lwIGRvaW5nIHRoaXMgbG9uZyBjaGVjawor
CQkgKiBhbmQganVzdCAgY29weSBjb3JyZXNwb25kZW50IGJpdCBmcm9tIHByZXZpb3VzIHN0YXRl
LgorCQkgKi8KKwkJaWYgKHNraXApCisJCQljb250aW51ZTsKKworCQlyZXQgPSB0Z2xfY2hlY2tf
cGlwZV9maXRzX3NhZ3Zfd20obmV3X2NydGNfc3RhdGUpOworCQlpZiAoIXJldCkKKwkJCW5ld19i
d19zdGF0ZS0+cGlwZV9zYWd2X21hc2sgfD0gcGlwZV9iaXQ7CisJCWVsc2UKKwkJCW5ld19id19z
dGF0ZS0+cGlwZV9zYWd2X21hc2sgJj0gfnBpcGVfYml0OworCX0KK30KKwogc3RhdGljIGludAog
c2tsX2NvbXB1dGVfd20oc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CkBAIC01
Nzk5LDYgKzYxNTEsNyBAQCBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CiAJc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlOwogCWludCByZXQsIGk7CisJaW50
IGFmZmVjdGVkX3BsYW5lczsgaW50IHRvdGFsX2FmZmVjdGVkX3BsYW5lcyA9IDA7CiAKIAlyZXQg
PSBza2xfZGRiX2FkZF9hZmZlY3RlZF9waXBlcyhzdGF0ZSk7CiAJaWYgKHJldCkKQEAgLTU4MTUs
MTEgKzYxNjgsMTUgQEAgc2tsX2NvbXB1dGVfd20oc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCi0JCXJldCA9IHNrbF93bV9hZGRf
YWZmZWN0ZWRfcGxhbmVzKHN0YXRlLCBjcnRjKTsKKwkJcmV0ID0gc2tsX3dtX2FkZF9hZmZlY3Rl
ZF9wbGFuZXMoc3RhdGUsIGNydGMsICZhZmZlY3RlZF9wbGFuZXMpOwogCQlpZiAocmV0KQogCQkJ
cmV0dXJuIHJldDsKKworCQl0b3RhbF9hZmZlY3RlZF9wbGFuZXMgKz0gYWZmZWN0ZWRfcGxhbmVz
OwogCX0KIAorCWludGVsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlLCB0b3RhbF9hZmZlY3RlZF9w
bGFuZXMpOworCiAJcmV0ID0gc2tsX2NvbXB1dGVfZGRiKHN0YXRlKTsKIAlpZiAocmV0KQogCQly
ZXR1cm4gcmV0OwpAQCAtNTkzOSw2ICs2Mjk2LDkgQEAgdm9pZCBza2xfcGlwZV93bV9nZXRfaHdf
c3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJdmFsID0gSTkxNV9SRUFEKENVUl9X
TShwaXBlLCBsZXZlbCkpOwogCiAJCQlza2xfd21fbGV2ZWxfZnJvbV9yZWdfdmFsKHZhbCwgJndt
LT53bVtsZXZlbF0pOworCQkJaWYgKGxldmVsID09IDApCisJCQkJbWVtY3B5KCZ3bS0+c2Fndl93
bTAsICZ3bS0+d21bbGV2ZWxdLAorCQkJCSAgICAgICBzaXplb2Yoc3RydWN0IHNrbF93bV9sZXZl
bCkpOwogCQl9CiAKIAkJaWYgKHBsYW5lX2lkICE9IFBMQU5FX0NVUlNPUikKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5oCmluZGV4IGQ2MGE4NTQyMWM1YS4uNTYxYTE3YTVkNGUwIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3BtLmgKQEAgLTQxLDcgKzQxLDkgQEAgdm9pZCBza2xfcGlwZV93bV9nZXRfaHdfc3Rh
dGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAgICBzdHJ1Y3Qgc2tsX3BpcGVfd20g
Km91dCk7CiB2b2lkIGc0eF93bV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwogdm9pZCB2bHZfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KTsKLWJvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKTsKK2Jvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Citib29sIGludGVsX2Nhbl9lbmFibGVfc2Fndl9mb3Jfc3Rh
dGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOworYm9vbCBpbnRlbF9oYXNfc2Fn
dihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IGludGVsX2VuYWJsZV9z
YWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBpbnQgaW50ZWxfZGlzYWJs
ZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBib29sIHNrbF93bV9s
ZXZlbF9lcXVhbHMoY29uc3Qgc3RydWN0IHNrbF93bV9sZXZlbCAqbDEsCi0tIAoyLjI0LjEuNDg1
LmdhZDA1YTNkOGU1CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
ZngK

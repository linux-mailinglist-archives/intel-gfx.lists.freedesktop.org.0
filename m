Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CC9353B5AF4
	for <lists+intel-gfx@lfdr.de>; Mon, 28 Jun 2021 11:10:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D2BF56E30F;
	Mon, 28 Jun 2021 09:10:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2C8EF6E301;
 Mon, 28 Jun 2021 09:10:02 +0000 (UTC)
X-IronPort-AV: E=McAfee;i="6200,9189,10028"; a="271774866"
X-IronPort-AV: E=Sophos;i="5.83,305,1616482800"; d="scan'208";a="271774866"
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 28 Jun 2021 02:10:01 -0700
X-IronPort-AV: E=Sophos;i="5.83,305,1616482800"; d="scan'208";a="419097112"
Received: from danielmi-mobl2.ger.corp.intel.com (HELO
 thellst-mobl1.intel.com) ([10.249.254.242])
 by fmsmga007-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 28 Jun 2021 02:09:59 -0700
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
To: intel-gfx@lists.freedesktop.org,
	dri-devel@lists.freedesktop.org
Date: Mon, 28 Jun 2021 11:09:39 +0200
Message-Id: <20210628090943.45690-2-thomas.hellstrom@linux.intel.com>
X-Mailer: git-send-email 2.31.1
In-Reply-To: <20210628090943.45690-1-thomas.hellstrom@linux.intel.com>
References: <20210628090943.45690-1-thomas.hellstrom@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 1/5] drm/i915/gem: Implement object migration
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>,
 matthew.auld@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW50cm9kdWNlIGFuIGludGVyZmFjZSB0byBtaWdyYXRlIG9iamVjdHMgYmV0d2VlbiByZWdpb25z
LgpUaGlzIGlzIHByaW1hcmlseSBpbnRlbmRlZCB0byBtaWdyYXRlIG9iamVjdHMgdG8gTE1FTSBm
b3IgZGlzcGxheSBhbmQKdG8gU1lTVEVNIGZvciBkbWEtYnVmLCBidXQgbWlnaHQgYmUgcmV1c2Vk
IGluIG9uZSBmb3JtIG9yIGFub3RoZXIgZm9yCnBlcmZvcm1hbmRlLWJhc2VkIG1pZ3JhdGlvbi4K
CnYyOgotIFZlcmlmeSB0aGF0IHRoZSBtZW1vcnkgcmVnaW9uIGdpdmVuIGFzIGFuIGlkIHJlYWxs
eSBleGlzdHMuCiAgKFJlcG9ydGVkIGJ5IE1hdHRoZXcgQXVsZCkKLSBDYWxsIGk5MTVfZ2VtX29i
amVjdF97aW5pdCxyZWxlYXNlfV9tZW1vcnlfcmVnaW9uKCkgd2hlbiBzd2l0Y2hpbmcgcmVnaW9u
CiAgdG8gaGFuZGxlIGFsc28gc3dpdGNoaW5nIHJlZ2lvbiBsaXN0cy4gKFJlcG9ydGVkIGJ5IE1h
dHRoZXcgQXVsZCkKClNpZ25lZC1vZmYtYnk6IFRob21hcyBIZWxsc3Ryw7ZtIDx0aG9tYXMuaGVs
bHN0cm9tQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0LmMgICAgfCA5NiArKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAxMiArKysKIC4uLi9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oICB8ICA5ICsrCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fdHRtLmMgICAgICAgfCA2OSArKysrKysrKystLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fd2FpdC5jICAgICAgfCAxOSArKysrCiA1IGZpbGVz
IGNoYW5nZWQsIDE4OCBpbnNlcnRpb25zKCspLCAxNyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggMDdlOGZmOWE4YWFlLi41MmEz
NzYxOTA1NGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9v
YmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMK
QEAgLTUxMyw2ICs1MTMsMTAyIEBAIGJvb2wgaTkxNV9nZW1fb2JqZWN0X2hhc19pb21lbShjb25z
dCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXJldHVybiBvYmotPm1lbV9mbGFn
cyAmIEk5MTVfQk9fRkxBR19JT01FTTsKIH0KIAorLyoqCisgKiBpOTE1X2dlbV9vYmplY3RfY2Fu
X21pZ3JhdGUgLSBXaGV0aGVyIGFuIG9iamVjdCBsaWtlbHkgY2FuIGJlIG1pZ3JhdGVkCisgKgor
ICogQG9iajogVGhlIG9iamVjdCB0byBtaWdyYXRlCisgKiBAaWQ6IFRoZSByZWdpb24gaW50ZW5k
ZWQgdG8gbWlncmF0ZSB0bworICoKKyAqIENoZWNrIHdoZXRoZXIgdGhlIG9iamVjdCBiYWNrZW5k
IHN1cHBvcnRzIG1pZ3JhdGlvbiB0byB0aGUKKyAqIGdpdmVuIHJlZ2lvbi4gTm90ZSB0aGF0IHBp
bm5pbmcgbWF5IGFmZmVjdCB0aGUgYWJpbGl0eSB0byBtaWdyYXRlLgorICoKKyAqIFJldHVybjog
dHJ1ZSBpZiBtaWdyYXRpb24gaXMgcG9zc2libGUsIGZhbHNlIG90aGVyd2lzZS4KKyAqLworYm9v
bCBpOTE1X2dlbV9vYmplY3RfY2FuX21pZ3JhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKKwkJCQkgZW51bSBpbnRlbF9yZWdpb25faWQgaWQpCit7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXVuc2lnbmVkIGludCBu
dW1fYWxsb3dlZCA9IG9iai0+bW0ubl9wbGFjZW1lbnRzOworCXN0cnVjdCBpbnRlbF9tZW1vcnlf
cmVnaW9uICptcjsKKwl1bnNpZ25lZCBpbnQgaTsKKworCUdFTV9CVUdfT04oaWQgPj0gSU5URUxf
UkVHSU9OX1VOS05PV04pOworCUdFTV9CVUdfT04ob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9X
SUxMTkVFRCk7CisKKwlpZiAoIW9iai0+b3BzLT5taWdyYXRlKQorCQlyZXR1cm4gZmFsc2U7CisK
KwltciA9IGk5MTUtPm1tLnJlZ2lvbnNbaWRdOworCWlmICghbXIpCisJCXJldHVybiBmYWxzZTsK
KworCWlmIChvYmotPm1tLnJlZ2lvbiA9PSBtcikKKwkJcmV0dXJuIHRydWU7CisKKwlpZiAoIWk5
MTVfZ2VtX29iamVjdF9ldmljdGFibGUob2JqKSkKKwkJcmV0dXJuIGZhbHNlOworCisJaWYgKCEo
b2JqLT5mbGFncyAmIEk5MTVfQk9fQUxMT0NfVVNFUikpCisJCXJldHVybiB0cnVlOworCisJaWYg
KG51bV9hbGxvd2VkID09IDApCisJCXJldHVybiBmYWxzZTsKKworCWZvciAoaSA9IDA7IGkgPCBu
dW1fYWxsb3dlZDsgKytpKSB7CisJCWlmIChtciA9PSBvYmotPm1tLnBsYWNlbWVudHNbaV0pCisJ
CQlyZXR1cm4gdHJ1ZTsKKwl9CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKKy8qKgorICogaTkxNV9n
ZW1fb2JqZWN0X21pZ3JhdGUgLSBNaWdyYXRlIGFuIG9iamVjdCB0byB0aGUgZGVzaXJlZCByZWdp
b24gaWQKKyAqIEBvYmo6IFRoZSBvYmplY3QgdG8gbWlncmF0ZS4KKyAqIEB3dzogQW4gb3B0aW9u
YWwgc3RydWN0IGk5MTVfZ2VtX3d3X2N0eC4gSWYgTlVMTCwgdGhlIGJhY2tlbmQgbWF5CisgKiBu
b3QgYmUgc3VjY2Vzc2Z1bCBpbiBldmljdGluZyBvdGhlciBvYmplY3RzIHRvIG1ha2Ugcm9vbSBm
b3IgdGhpcyBvYmplY3QuCisgKiBAaWQ6IFRoZSByZWdpb24gaWQgdG8gbWlncmF0ZSB0by4KKyAq
CisgKiBBdHRlbXB0IHRvIG1pZ3JhdGUgdGhlIG9iamVjdCB0byB0aGUgZGVzaXJlZCBtZW1vcnkg
cmVnaW9uLiBUaGUKKyAqIG9iamVjdCBiYWNrZW5kIG11c3Qgc3VwcG9ydCBtaWdyYXRpb24gYW5k
IHRoZSBvYmplY3QgbWF5IG5vdCBiZQorICogcGlubmVkLCAoZXhwbGljaXRseSBwaW5uZWQgcGFn
ZXMgb3IgcGlubmVkIHZtYXMpLiBUaGUgb2JqZWN0IG11c3QKKyAqIGJlIGxvY2tlZC4KKyAqIE9u
IHN1Y2Nlc3NmdWwgY29tcGxldGlvbiwgdGhlIG9iamVjdCB3aWxsIGhhdmUgcGFnZXMgcG9pbnRp
bmcgdG8KKyAqIG1lbW9yeSBpbiB0aGUgbmV3IHJlZ2lvbiwgYnV0IGFuIGFzeW5jIG1pZ3JhdGlv
biB0YXNrIG1heSBub3QgaGF2ZQorICogY29tcGxldGVkIHlldCwgYW5kIHRvIGFjY29tcGxpc2gg
dGhhdCwgaTkxNV9nZW1fb2JqZWN0X3dhaXRfbWlncmF0aW9uKCkKKyAqIG11c3QgYmUgY2FsbGVk
LgorICoKKyAqIFJldHVybjogMCBvbiBzdWNjZXNzLiBOZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZh
aWx1cmUuIEluIHBhcnRpY3VsYXIgbWF5CisgKiByZXR1cm4gLUVOWElPIG9uIGxhY2sgb2YgcmVn
aW9uIHNwYWNlLCAtRURFQURMSyBmb3IgZGVhZGxvY2sgYXZvaWRhbmNlCisgKiBpZiBAd3cgaXMg
c2V0LCAtRUlOVFIgb3IgLUVSRVNUQVJUU1lTIGlmIHNpZ25hbCBwZW5kaW5nLCBhbmQKKyAqIC1F
QlVTWSBpZiB0aGUgb2JqZWN0IGlzIHBpbm5lZC4KKyAqLworaW50IGk5MTVfZ2VtX29iamVjdF9t
aWdyYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkgICAgc3RydWN0IGk5
MTVfZ2VtX3d3X2N0eCAqd3csCisJCQkgICAgZW51bSBpbnRlbF9yZWdpb25faWQgaWQpCit7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwor
CXN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9uICptcjsKKworCUdFTV9CVUdfT04oaWQgPj0gSU5U
RUxfUkVHSU9OX1VOS05PV04pOworCUdFTV9CVUdfT04ob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFE
Vl9XSUxMTkVFRCk7CisJYXNzZXJ0X29iamVjdF9oZWxkKG9iaik7CisKKwltciA9IGk5MTUtPm1t
LnJlZ2lvbnNbaWRdOworCUdFTV9CVUdfT04oIW1yKTsKKworCWlmIChvYmotPm1tLnJlZ2lvbiA9
PSBtcikKKwkJcmV0dXJuIDA7CisKKwlpZiAoIWk5MTVfZ2VtX29iamVjdF9ldmljdGFibGUob2Jq
KSkKKwkJcmV0dXJuIC1FQlVTWTsKKworCWlmICghb2JqLT5vcHMtPm1pZ3JhdGUpCisJCXJldHVy
biAtRU9QTk9UU1VQUDsKKworCXJldHVybiBvYmotPm9wcy0+bWlncmF0ZShvYmosIG1yKTsKK30K
Kwogdm9pZCBpOTE1X2dlbV9pbml0X19vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewogCUlOSVRfV09SSygmaTkxNS0+bW0uZnJlZV93b3JrLCBfX2k5MTVfZ2VtX2ZyZWVf
d29yayk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5kZXgg
ZWEzMjI0YTQ4MGM0Li44Y2JkN2E1MzM0ZTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmgKQEAgLTE3LDYgKzE3LDggQEAKICNpbmNsdWRlICJpOTE1X2dlbV93
dy5oIgogI2luY2x1ZGUgImk5MTVfdm1hX3R5cGVzLmgiCiAKK2VudW0gaW50ZWxfcmVnaW9uX2lk
OworCiAvKgogICogWFhYOiBUaGVyZSBpcyBhIHByZXZhbGVuY2Ugb2YgdGhlIGFzc3VtcHRpb24g
dGhhdCB3ZSBmaXQgdGhlCiAgKiBvYmplY3QncyBwYWdlIGNvdW50IGluc2lkZSBhIDMyYml0IF9z
aWduZWRfIHZhcmlhYmxlLiBMZXQncyBkb2N1bWVudApAQCAtNTk3LDYgKzU5OSwxNiBAQCBib29s
IGk5MTVfZ2VtX29iamVjdF9taWdyYXRhYmxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopOwogCiBib29sIGk5MTVfZ2VtX29iamVjdF92YWxpZGF0ZXNfdG9fbG1lbShzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKIAoraW50IGk5MTVfZ2VtX29iamVjdF9taWdyYXRlKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkgICAgc3RydWN0IGk5MTVfZ2VtX3d3
X2N0eCAqd3csCisJCQkgICAgZW51bSBpbnRlbF9yZWdpb25faWQgaWQpOworCitib29sIGk5MTVf
Z2VtX29iamVjdF9jYW5fbWlncmF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAor
CQkJCSBlbnVtIGludGVsX3JlZ2lvbl9pZCBpZCk7CisKK2ludCBpOTE1X2dlbV9vYmplY3Rfd2Fp
dF9taWdyYXRpb24oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgICB1bnNp
Z25lZCBpbnQgZmxhZ3MpOworCiAjaWZkZWYgQ09ORklHX01NVV9OT1RJRklFUgogc3RhdGljIGlu
bGluZSBib29sCiBpOTE1X2dlbV9vYmplY3RfaXNfdXNlcnB0cihzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdF90eXBlcy5oCmluZGV4IDQ0MWY5MTNjODdlNi4uZWYzZGUyYWU5NzIzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCkBAIC0xOCw2
ICsxOCw3IEBACiAKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0Owogc3RydWN0IGludGVsX2Zy
b25idWZmZXI7CitzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbjsKIAogLyoKICAqIHN0cnVjdCBp
OTE1X2x1dF9oYW5kbGUgdHJhY2tzIHRoZSBmYXN0IGxvb2t1cHMgZnJvbSBoYW5kbGUgdG8gdm1h
IHVzZWQKQEAgLTc3LDYgKzc4LDE0IEBAIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0X29wcyB7
CiAJICogZGVsYXllZF9mcmVlIC0gT3ZlcnJpZGUgdGhlIGRlZmF1bHQgZGVsYXllZCBmcmVlIGlt
cGxlbWVudGF0aW9uCiAJICovCiAJdm9pZCAoKmRlbGF5ZWRfZnJlZSkoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaik7CisKKwkvKioKKwkgKiBtaWdyYXRlIC0gTWlncmF0ZSBvYmplY3Qg
dG8gYSBkaWZmZXJlbnQgcmVnaW9uIGVpdGhlciBmb3IKKwkgKiBwaW5uaW5nIG9yIGZvciBhcyBs
b25nIGFzIHRoZSBvYmplY3QgbG9jayBpcyBoZWxkLgorCSAqLworCWludCAoKm1pZ3JhdGUpKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCSAgICAgICBzdHJ1Y3QgaW50ZWxfbWVt
b3J5X3JlZ2lvbiAqbXIpOworCiAJdm9pZCAoKnJlbGVhc2UpKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopOwogCiAJY29uc3Qgc3RydWN0IHZtX29wZXJhdGlvbnNfc3RydWN0ICptbWFw
X29wczsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90dG0u
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90dG0uYwppbmRleCBjMzlkOTgy
YzRmYTYuLjhmODkxODViNjUwNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3R0bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90
dG0uYwpAQCAtNjE3LDcgKzYxNyw4IEBAIHN0cnVjdCB0dG1fZGV2aWNlX2Z1bmNzICppOTE1X3R0
bV9kcml2ZXIodm9pZCkKIAlyZXR1cm4gJmk5MTVfdHRtX2JvX2RyaXZlcjsKIH0KIAotc3RhdGlj
IGludCBpOTE1X3R0bV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
K3N0YXRpYyBpbnQgX19pOTE1X3R0bV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKKwkJCQlzdHJ1Y3QgdHRtX3BsYWNlbWVudCAqcGxhY2VtZW50KQogewogCXN0cnVj
dCB0dG1fYnVmZmVyX29iamVjdCAqYm8gPSBpOTE1X2dlbV90b190dG0ob2JqKTsKIAlzdHJ1Y3Qg
dHRtX29wZXJhdGlvbl9jdHggY3R4ID0gewpAQCAtNjI1LDE5ICs2MjYsMTIgQEAgc3RhdGljIGlu
dCBpOTE1X3R0bV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJ
Lm5vX3dhaXRfZ3B1ID0gZmFsc2UsCiAJfTsKIAlzdHJ1Y3Qgc2dfdGFibGUgKnN0OwotCXN0cnVj
dCB0dG1fcGxhY2UgcmVxdWVzdGVkLCBidXN5W0k5MTVfVFRNX01BWF9QTEFDRU1FTlRTXTsKLQlz
dHJ1Y3QgdHRtX3BsYWNlbWVudCBwbGFjZW1lbnQ7CiAJaW50IHJlYWxfbnVtX2J1c3k7CiAJaW50
IHJldDsKIAotCUdFTV9CVUdfT04ob2JqLT5tbS5uX3BsYWNlbWVudHMgPiBJOTE1X1RUTV9NQVhf
UExBQ0VNRU5UUyk7Ci0KLQkvKiBNb3ZlIHRvIHRoZSByZXF1ZXN0ZWQgcGxhY2VtZW50LiAqLwot
CWk5MTVfdHRtX3BsYWNlbWVudF9mcm9tX29iaihvYmosICZyZXF1ZXN0ZWQsIGJ1c3ksICZwbGFj
ZW1lbnQpOwotCiAJLyogRmlyc3QgdHJ5IG9ubHkgdGhlIHJlcXVlc3RlZCBwbGFjZW1lbnQuIE5v
IGV2aWN0aW9uLiAqLwotCXJlYWxfbnVtX2J1c3kgPSBmZXRjaF9hbmRfemVybygmcGxhY2VtZW50
Lm51bV9idXN5X3BsYWNlbWVudCk7Ci0JcmV0ID0gdHRtX2JvX3ZhbGlkYXRlKGJvLCAmcGxhY2Vt
ZW50LCAmY3R4KTsKKwlyZWFsX251bV9idXN5ID0gZmV0Y2hfYW5kX3plcm8oJnBsYWNlbWVudC0+
bnVtX2J1c3lfcGxhY2VtZW50KTsKKwlyZXQgPSB0dG1fYm9fdmFsaWRhdGUoYm8sIHBsYWNlbWVu
dCwgJmN0eCk7CiAJaWYgKHJldCkgewogCQlyZXQgPSBpOTE1X3R0bV9lcnJfdG9fZ2VtKHJldCk7
CiAJCS8qCkBAIC02NTIsOCArNjQ2LDggQEAgc3RhdGljIGludCBpOTE1X3R0bV9nZXRfcGFnZXMo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJICogSWYgdGhlIGluaXRpYWwgYXR0
ZW1wdCBmYWlscywgYWxsb3cgYWxsIGFjY2VwdGVkIHBsYWNlbWVudHMsCiAJCSAqIGV2aWN0aW5n
IGlmIG5lY2Vzc2FyeS4KIAkJICovCi0JCXBsYWNlbWVudC5udW1fYnVzeV9wbGFjZW1lbnQgPSBy
ZWFsX251bV9idXN5OwotCQlyZXQgPSB0dG1fYm9fdmFsaWRhdGUoYm8sICZwbGFjZW1lbnQsICZj
dHgpOworCQlwbGFjZW1lbnQtPm51bV9idXN5X3BsYWNlbWVudCA9IHJlYWxfbnVtX2J1c3k7CisJ
CXJldCA9IHR0bV9ib192YWxpZGF0ZShibywgcGxhY2VtZW50LCAmY3R4KTsKIAkJaWYgKHJldCkK
IAkJCXJldHVybiBpOTE1X3R0bV9lcnJfdG9fZ2VtKHJldCk7CiAJfQpAQCAtNjY4LDE2ICs2NjIs
NTYgQEAgc3RhdGljIGludCBpOTE1X3R0bV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaikKIAkJaTkxNV90dG1fYWRqdXN0X2dlbV9hZnRlcl9tb3ZlKG9iaik7CiAJfQog
Ci0JLyogT2JqZWN0IGVpdGhlciBoYXMgYSBwYWdlIHZlY3RvciBvciBpcyBhbiBpb21lbSBvYmpl
Y3QgKi8KLQlzdCA9IGJvLT50dG0gPyBpOTE1X3R0bV90dF9nZXRfc3QoYm8tPnR0bSkgOiBvYmot
PnR0bS5jYWNoZWRfaW9fc3Q7Ci0JaWYgKElTX0VSUihzdCkpCi0JCXJldHVybiBQVFJfRVJSKHN0
KTsKKwlpZiAoIW9iai0+bW0ucGFnZXMpIHsKKwkJLyogT2JqZWN0IGVpdGhlciBoYXMgYSBwYWdl
IHZlY3RvciBvciBpcyBhbiBpb21lbSBvYmplY3QgKi8KKwkJc3QgPSBiby0+dHRtID8gaTkxNV90
dG1fdHRfZ2V0X3N0KGJvLT50dG0pIDogb2JqLT50dG0uY2FjaGVkX2lvX3N0OworCQlpZiAoSVNf
RVJSKHN0KSkKKwkJCXJldHVybiBQVFJfRVJSKHN0KTsKIAotCV9faTkxNV9nZW1fb2JqZWN0X3Nl
dF9wYWdlcyhvYmosIHN0LCBpOTE1X3NnX2RtYV9zaXplcyhzdC0+c2dsKSk7CisJCV9faTkxNV9n
ZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHN0LCBpOTE1X3NnX2RtYV9zaXplcyhzdC0+c2dsKSk7
CisJfQogCiAJcmV0dXJuIHJldDsKIH0KIAorc3RhdGljIGludCBpOTE1X3R0bV9nZXRfcGFnZXMo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlzdHJ1Y3QgdHRtX3BsYWNlIHJl
cXVlc3RlZCwgYnVzeVtJOTE1X1RUTV9NQVhfUExBQ0VNRU5UU107CisJc3RydWN0IHR0bV9wbGFj
ZW1lbnQgcGxhY2VtZW50OworCisJR0VNX0JVR19PTihvYmotPm1tLm5fcGxhY2VtZW50cyA+IEk5
MTVfVFRNX01BWF9QTEFDRU1FTlRTKTsKKworCS8qIE1vdmUgdG8gdGhlIHJlcXVlc3RlZCBwbGFj
ZW1lbnQuICovCisJaTkxNV90dG1fcGxhY2VtZW50X2Zyb21fb2JqKG9iaiwgJnJlcXVlc3RlZCwg
YnVzeSwgJnBsYWNlbWVudCk7CisKKwlyZXR1cm4gX19pOTE1X3R0bV9nZXRfcGFnZXMob2JqLCAm
cGxhY2VtZW50KTsKK30KKworc3RhdGljIGludCBpOTE1X3R0bV9taWdyYXRlKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkgICAgc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24g
Km1yKQoreworCXN0cnVjdCB0dG1fcGxhY2UgcmVxdWVzdGVkOworCXN0cnVjdCB0dG1fcGxhY2Vt
ZW50IHBsYWNlbWVudDsKKwlpbnQgcmV0OworCisJaTkxNV90dG1fcGxhY2VfZnJvbV9yZWdpb24o
bXIsICZyZXF1ZXN0ZWQsIG9iai0+ZmxhZ3MpOworCXBsYWNlbWVudC5udW1fcGxhY2VtZW50ID0g
MTsKKwlwbGFjZW1lbnQubnVtX2J1c3lfcGxhY2VtZW50ID0gMTsKKwlwbGFjZW1lbnQucGxhY2Vt
ZW50ID0gJnJlcXVlc3RlZDsKKwlwbGFjZW1lbnQuYnVzeV9wbGFjZW1lbnQgPSAmcmVxdWVzdGVk
OworCisJcmV0ID0gX19pOTE1X3R0bV9nZXRfcGFnZXMob2JqLCAmcGxhY2VtZW50KTsKKwlpZiAo
cmV0KQorCQlyZXR1cm4gcmV0OworCisJaWYgKG9iai0+bW0ucmVnaW9uICE9IG1yKSB7CisJCWk5
MTVfZ2VtX29iamVjdF9yZWxlYXNlX21lbW9yeV9yZWdpb24ob2JqKTsKKwkJaTkxNV9nZW1fb2Jq
ZWN0X2luaXRfbWVtb3J5X3JlZ2lvbihvYmosIG1yKTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwog
c3RhdGljIHZvaWQgaTkxNV90dG1fcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCQkgICAgICAgc3RydWN0IHNnX3RhYmxlICpzdCkKIHsKQEAgLTgxNCw2ICs4NDgs
NyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3BzIGk5MTVfZ2Vt
X3R0bV9vYmpfb3BzID0gewogCS50cnVuY2F0ZSA9IGk5MTVfdHRtX3B1cmdlLAogCS5hZGp1c3Rf
bHJ1ID0gaTkxNV90dG1fYWRqdXN0X2xydSwKIAkuZGVsYXllZF9mcmVlID0gaTkxNV90dG1fZGVs
YXllZF9mcmVlLAorCS5taWdyYXRlID0gaTkxNV90dG1fbWlncmF0ZSwKIAkubW1hcF9vZmZzZXQg
PSBpOTE1X3R0bV9tbWFwX29mZnNldCwKIAkubW1hcF9vcHMgPSAmdm1fb3BzX3R0bSwKIH07CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fd2FpdC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3dhaXQuYwppbmRleCAxMDcwZDNhZmRjZTcu
LmU5ZjdhOGQ5ZjBlMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3dhaXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fd2FpdC5j
CkBAIC0yOTAsMyArMjkwLDIyIEBAIGk5MTVfZ2VtX3dhaXRfaW9jdGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxlKQogCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKIAlyZXR1cm4gcmV0OwogfQorCisvKioKKyAqIGk5MTVfZ2VtX29iamVj
dF93YWl0X21pZ3JhdGUgLSBTeW5jIGFuIGFjY2VsZXJhdGVkIG1pZ3JhdGlvbiBvcGVyYXRpb24K
KyAqIEBvYmo6IFRoZSBtaWdyYXRpbmcgb2JqZWN0LgorICogQGZsYWdzOiB3YWl0aW5nIGZsYWdz
LiBDdXJyZW50bHkgc3VwcG9ydHMgb25seSBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRS4KKyAqCisg
KiBXYWl0IGZvciBhbnkgcGVuZGluZyBhc3luYyBtaWdyYXRpb24gb3BlcmF0aW9uIG9uIHRoZSBv
YmplY3QsCisgKiB3aGV0aGVyIGl0J3MgZXhwbGljaXRseSAoaTkxNV9nZW1fb2JqZWN0X21pZ3Jh
dGUoKSkgb3IgaW1wbGljaXRseQorICogKHN3YXBpbiwgaW5pdGlhbCBjbGVhcmluZykgaW5pdGlh
dGVkLgorICoKKyAqIFJldHVybjogMCBpZiBzdWNjZXNzZnVsLCAtRVJFU1RBUlRTWVMgaWYgYSBz
aWduYWwgd2FzIGhpdCBkdXJpbmcgd2FpdGluZy4KKyAqLworaW50IGk5MTVfZ2VtX29iamVjdF93
YWl0X21pZ3JhdGlvbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJCSAgIHVu
c2lnbmVkIGludCBmbGFncykKK3sKKwltaWdodF9zbGVlcCgpOworCS8qIE5PUCBmb3Igbm93LiAq
LworCXJldHVybiAwOworfQotLSAKMi4zMS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZngK

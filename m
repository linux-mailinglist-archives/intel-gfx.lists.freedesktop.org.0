Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1380ED31E9
	for <lists+intel-gfx@lfdr.de>; Thu, 10 Oct 2019 22:24:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 47FEB6EB78;
	Thu, 10 Oct 2019 20:24:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 90CF66EB78
 for <intel-gfx@lists.freedesktop.org>; Thu, 10 Oct 2019 20:24:26 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18796352-1500050 
 for multiple; Thu, 10 Oct 2019 21:24:15 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 10 Oct 2019 21:24:14 +0100
Message-Id: <20191010202414.5310-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191010194851.26592-5-chris@chris-wilson.co.uk>
References: <20191010194851.26592-5-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/perf: implement active wait for noa
 configurations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
Tk9BIGNvbmZpZ3VyYXRpb24gdGFrZSBzb21lIGFtb3VudCBvZiB0aW1lIHRvIGFwcGx5LiBUaGF0
IGFtb3VudCBvZgp0aW1lIGRlcGVuZHMgb24gdGhlIHNpemUgb2YgdGhlIEdULiBUaGVyZSBpcyBu
byBkb2N1bWVudGVkIHRpbWUgZm9yCnRoaXMuIEZvciBleGFtcGxlLCBwYXN0IGV4cGVyaW1lbnRh
dGlvbnMgd2l0aCBwb3dlcmdhdGluZwpjb25maWd1cmF0aW9uIGNoYW5nZXMgc2VlbSB0byBpbmRp
Y2F0ZSBhIDYwfjcwdXMgZGVsYXkuIFdlIGdvIHdpdGgKNTAwdXMgYXMgZGVmYXVsdCBmb3Igbm93
IHdoaWNoIHNob3VsZCBiZSBvdmVyIHRoZSByZXF1aXJlZCBhbW91bnQgb2YKdGltZSAoYWNjb3Jk
aW5nIHRvIEhXIGFyY2hpdGVjdHMpLgoKdjI6IERvbid0IGZvcmdldCB0byBzYXZlL3Jlc3RvcmUg
cmVnaXN0ZXJzIHVzZWQgZm9yIHRoZSB3YWl0IChDaHJpcykKCnYzOiBOYW1lIHVzZWQgQ1NfR1BS
IHJlZ2lzdGVycyAoQ2hyaXMpCiAgICBGaXggY29tcGlsZSBpc3N1ZSBkdWUgdG8gcmViYXNlIChM
aW9uZWwpCgp2NDogRml4IHNhdmUvcmVzdG9yZSBoZWxwZXJzIChVbWVzaCkKCnY1OiBNb3ZlIG5v
YV93YWl0IGZyb20gZHJtX2k5MTVfcHJpdmF0ZSB0byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwp
Cgp2NjogQWRkIG1pc3Npbmcgc3RydWN0IGRlY2xhcmF0aW9ucyBpbiBpOTE1X3BlcmYuaAoKU2ln
bmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
ICh2NCkKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28u
dWs+ICh2NCkKLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMu
aCAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggICAg
ICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAg
fCAgMzIgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAg
fCAyMjQgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZf
dHlwZXMuaCAgICAgICAgfCAgIDggKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAg
ICAgICAgICAgICAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9z
ZWxmdGVzdHMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
cGVyZi5jICAgIHwgMjE2ICsrKysrKysrKysrKysrKysrCiA4IGZpbGVzIGNoYW5nZWQsIDQ5MiBp
bnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKaW5kZXggMDk4NzEwMGM3ODZiLi44ZTYzY2ZmY2Fi
ZTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5k
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBA
IC0xNjMsNyArMTYzLDggQEAKICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUCU1JX0lOU1RS
KDB4MzEsIDApCiAjZGVmaW5lICAgTUlfQkFUQ0hfR1RUCQkgICAgKDI8PDYpIC8qIGFsaWFzZWQg
d2l0aCAoMTw8Nykgb24gZ2VuNCAqLwogI2RlZmluZSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VO
OAlNSV9JTlNUUigweDMxLCAxKQotI2RlZmluZSAgIE1JX0JBVENIX1JFU09VUkNFX1NUUkVBTUVS
ICgxPDwxMCkKKyNkZWZpbmUgICBNSV9CQVRDSF9SRVNPVVJDRV9TVFJFQU1FUiBSRUdfQklUKDEw
KQorI2RlZmluZSAgIE1JX0JBVENIX1BSRURJQ0FURSAgICAgICAgIFJFR19CSVQoMTUpIC8qIEhT
Vysgb24gUkNTIG9ubHkqLwogCiAvKgogICogM0QgaW5zdHJ1Y3Rpb25zIHVzZWQgYnkgdGhlIGtl
cm5lbApAQCAtMjI0LDYgKzIyNSw3IEBACiAjZGVmaW5lICAgUElQRV9DT05UUk9MX0NTX1NUQUxM
CQkJCSgxPDwyMCkKICNkZWZpbmUgICBQSVBFX0NPTlRST0xfVExCX0lOVkFMSURBVEUJCQkoMTw8
MTgpCiAjZGVmaW5lICAgUElQRV9DT05UUk9MX01FRElBX1NUQVRFX0NMRUFSCQkoMTw8MTYpCisj
ZGVmaW5lICAgUElQRV9DT05UUk9MX1dSSVRFX1RJTUVTVEFNUAkJCSgzPDwxNCkKICNkZWZpbmUg
ICBQSVBFX0NPTlRST0xfUVdfV1JJVEUJCQkJKDE8PDE0KQogI2RlZmluZSAgIFBJUEVfQ09OVFJP
TF9QT1NUX1NZTkNfT1BfTUFTSyAgICAgICAgICAgICAgICAoMzw8MTQpCiAjZGVmaW5lICAgUElQ
RV9DT05UUk9MX0RFUFRIX1NUQUxMCQkJKDE8PDEzKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3R5cGVzLmgKaW5kZXggODAyZjUxNmEzNDMwLi5iZTRiMjYzNjIxYzggMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAtMTA5LDYgKzEwOSwxMSBAQCBl
bnVtIGludGVsX2d0X3NjcmF0Y2hfZmllbGQgewogCS8qIDggYnl0ZXMgKi8KIAlJTlRFTF9HVF9T
Q1JBVENIX0ZJRUxEX0NPSEVSRU5UTDNfV0EgPSAyNTYsCiAKKwkvKiA2ICogOCBieXRlcyAqLwor
CUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgPSAyMDQ4LAorCisJLyogNCBieXRl
cyAqLworCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVESUNBVEVfUkVTVUxUXzEgPSAy
MDk2LAogfTsKIAogI2VuZGlmIC8qIF9fSU5URUxfR1RfVFlQRVNfSF9fICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDI3N2YzMTI5N2YyOS4uZDQ2M2EyOGI3NDc1IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzU5MCw2ICszNTkwLDM3IEBAIERFRklO
RV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfd2VkZ2VkX2ZvcHMsCiAJCQlpOTE1X3dlZGdlZF9nZXQs
IGk5MTVfd2VkZ2VkX3NldCwKIAkJCSIlbGx1XG4iKTsKIAorc3RhdGljIGludAoraTkxNV9wZXJm
X25vYV9kZWxheV9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisJY29uc3QgdTMyIGNsayA9IFJVTlRJTUVfSU5GTyhpOTE1
KS0+Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHo7CisKKwkvKgorCSAqIFRoaXMgd291bGQgbGVh
ZCB0byBpbmZpbml0ZSB3YWl0cyBhcyB3ZSdyZSBkb2luZyB0aW1lc3RhbXAKKwkgKiBkaWZmZXJl
bmNlIG9uIHRoZSBDUyB3aXRoIG9ubHkgMzJiaXRzLgorCSAqLworCWlmICh2YWwgPiBtdWxfdTMy
X3UzMihVMzJfTUFYLCBjbGspKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWF0b21pYzY0X3NldCgm
aTkxNS0+cGVyZi5ub2FfcHJvZ3JhbW1pbmdfZGVsYXksIHZhbCk7CisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQKK2k5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0KHZvaWQgKmRhdGEsIHU2NCAqdmFs
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKworCSp2YWwgPSBh
dG9taWM2NF9yZWFkKCZpOTE1LT5wZXJmLm5vYV9wcm9ncmFtbWluZ19kZWxheSk7CisJcmV0dXJu
IDA7Cit9CisKK0RFRklORV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfcGVyZl9ub2FfZGVsYXlfZm9w
cywKKwkJCWk5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0LAorCQkJaTkxNV9wZXJmX25vYV9kZWxheV9z
ZXQsCisJCQkiJWxsdVxuIik7CisKICNkZWZpbmUgRFJPUF9VTkJPVU5ECUJJVCgwKQogI2RlZmlu
ZSBEUk9QX0JPVU5ECUJJVCgxKQogI2RlZmluZSBEUk9QX1JFVElSRQlCSVQoMikKQEAgLTQzNDAs
NiArNDM3MSw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9kZWJ1Z2ZzX2ZpbGVzIHsKIAlj
b25zdCBjaGFyICpuYW1lOwogCWNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgKmZvcHM7CiB9
IGk5MTVfZGVidWdmc19maWxlc1tdID0geworCXsiaTkxNV9wZXJmX25vYV9kZWxheSIsICZpOTE1
X3BlcmZfbm9hX2RlbGF5X2ZvcHN9LAogCXsiaTkxNV93ZWRnZWQiLCAmaTkxNV93ZWRnZWRfZm9w
c30sCiAJeyJpOTE1X2NhY2hlX3NoYXJpbmciLCAmaTkxNV9jYWNoZV9zaGFyaW5nX2ZvcHN9LAog
CXsiaTkxNV9nZW1fZHJvcF9jYWNoZXMiLCAmaTkxNV9kcm9wX2NhY2hlc19mb3BzfSwKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggN2Q3YmFlZTdmZWJlLi5hYmI3YTcwZTE3ZWMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xOTgsNiArMTk4LDcgQEAKICNpbmNsdWRlICJnZW0v
aTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgogI2lu
Y2x1ZGUgImd0L2ludGVsX2VuZ2luZV91c2VyLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIK
ICNpbmNsdWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgpA
QCAtMTMzNyw2ICsxMzM4LDEyIEBAIGZyZWVfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCitzdGF0
aWMgdm9pZAorZnJlZV9ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQor
eworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZzdHJlYW0tPm5vYV93YWl0LCAwKTsKK30K
Kwogc3RhdGljIHZvaWQKIGZyZWVfb2FfY29uZmlncyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAq
c3RyZWFtKQogewpAQCAtMTM2OSw2ICsxMzc2LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9vYV9zdHJl
YW1fZGVzdHJveShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCQlvYV9wdXRfcmVu
ZGVyX2N0eF9pZChzdHJlYW0pOwogCiAJZnJlZV9vYV9jb25maWdzKHN0cmVhbSk7CisJZnJlZV9u
b2Ffd2FpdChzdHJlYW0pOwogCiAJaWYgKHBlcmYtPnNwdXJpb3VzX3JlcG9ydF9ycy5taXNzZWQp
IHsKIAkJRFJNX05PVEUoIiVkIHNwdXJpb3VzIE9BIHJlcG9ydCBub3RpY2VzIHN1cHByZXNzZWQg
ZHVlIHRvIHJhdGVsaW1pdGluZ1xuIiwKQEAgLTE1MjksNiArMTUzNywyMDYgQEAgc3RhdGljIGlu
dCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlyZXR1
cm4gcmV0OwogfQogCitzdGF0aWMgdTMyICpzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIoc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwgdTMyICpjcywKKwkJCQkgIGJvb2wgc2F2ZSwgaTkxNV9y
ZWdfdCByZWcsIHUzMiBvZmZzZXQsCisJCQkJICB1MzIgZHdvcmRfY291bnQpCit7CisJdTMyIGNt
ZDsKKwl1MzIgZDsKKworCWNtZCA9IHNhdmUgPyBNSV9TVE9SRV9SRUdJU1RFUl9NRU0gOiBNSV9M
T0FEX1JFR0lTVEVSX01FTTsKKwlpZiAoSU5URUxfR0VOKHN0cmVhbS0+cGVyZi0+aTkxNSkgPj0g
OCkKKwkJY21kKys7CisKKwlmb3IgKGQgPSAwOyBkIDwgZHdvcmRfY291bnQ7IGQrKykgeworCQkq
Y3MrKyA9IGNtZDsKKwkJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChyZWcpICsgNCAqIGQ7
CisJCSpjcysrID0gaW50ZWxfZ3Rfc2NyYXRjaF9vZmZzZXQoc3RyZWFtLT5lbmdpbmUtPmd0LAor
CQkJCQkJb2Zmc2V0KSArIDQgKiBkOworCQkqY3MrKyA9IDA7CisJfQorCisJcmV0dXJuIGNzOwor
fQorCitzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0pCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPnBlcmYt
Pmk5MTU7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmJvOworCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOworCWNvbnN0IHU2NCBkZWxheV90aWNrcyA9IDB4ZmZmZmZmZmZmZmZmZmZmZiAtCisJ
CURJVjY0X1U2NF9ST1VORF9VUCgKKwkJCWF0b21pYzY0X3JlYWQoJnN0cmVhbS0+cGVyZi0+bm9h
X3Byb2dyYW1taW5nX2RlbGF5KSAqCisJCQlSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFt
cF9mcmVxdWVuY3lfa2h6LAorCQkJMTAwMDAwMHVsbCk7CisJY29uc3QgdTMyIGJhc2UgPSBzdHJl
YW0tPmVuZ2luZS0+bW1pb19iYXNlOworI2RlZmluZSBDU19HUFIoeCkgR0VOOF9SSU5HX0NTX0dQ
UihiYXNlLCB4KQorCXUzMiAqYmF0Y2gsICp0czAsICpjcywgKmp1bXA7CisJaW50IHJldCwgaTsK
KwllbnVtIHsKKwkJU1RBUlRfVFMsCisJCU5PV19UUywKKwkJREVMVEFfVFMsCisJCUpVTVBfUFJF
RElDQVRFLAorCQlERUxUQV9UQVJHRVQsCisJCU5fQ1NfR1BSCisJfTsKKworCWJvID0gaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCA0MDk2KTsKKwlpZiAoSVNfRVJSKGJvKSkg
eworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBhbGxvY2F0ZSBOT0Egd2FpdCBiYXRjaGJ1ZmZlclxu
Iik7CisJCXJldHVybiBQVFJfRVJSKGJvKTsKKwl9CisKKwkvKgorCSAqIFdlIHBpbiBpbiBHR1RU
IGJlY2F1c2Ugd2UganVtcCBpbnRvIHRoaXMgYnVmZmVyIG5vdyBiZWNhdXNlCisJICogbXVsdGlw
bGUgT0EgY29uZmlnIEJPcyB3aWxsIGhhdmUgYSBqdW1wIHRvIHRoaXMgYWRkcmVzcyBhbmQgaXQK
KwkgKiBuZWVkcyB0byBiZSBmaXhlZCBkdXJpbmcgdGhlIGxpZmV0aW1lIG9mIHRoZSBpOTE1L3Bl
cmYgc3RyZWFtLgorCSAqLworCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihibywgTlVM
TCwgMCwgMCwgUElOX0hJR0gpOworCWlmIChJU19FUlIodm1hKSkgeworCQlyZXQgPSBQVFJfRVJS
KHZtYSk7CisJCWdvdG8gZXJyX3VucmVmOworCX0KKworCWJhdGNoID0gY3MgPSBpOTE1X2dlbV9v
YmplY3RfcGluX21hcChibywgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIoYmF0Y2gpKSB7CisJ
CXJldCA9IFBUUl9FUlIoYmF0Y2gpOworCQlnb3RvIGVycl91bnBpbjsKKwl9CisKKwkvKiBTYXZl
IHJlZ2lzdGVycy4gKi8KKwlmb3IgKGkgPSAwOyBpIDwgTl9DU19HUFI7IGkrKykKKwkJY3MgPSBz
YXZlX3Jlc3RvcmVfcmVnaXN0ZXIoCisJCQlzdHJlYW0sIGNzLCB0cnVlIC8qIHNhdmUgKi8sIENT
X0dQUihpKSwKKwkJCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgKyA4ICogaSwg
Mik7CisJY3MgPSBzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIoCisJCXN0cmVhbSwgY3MsIHRydWUgLyog
c2F2ZSAqLywgTUlfUFJFRElDQVRFX1JFU1VMVF8xLAorCQlJTlRFTF9HVF9TQ1JBVENIX0ZJRUxE
X1BFUkZfUFJFRElDQVRFX1JFU1VMVF8xLCAxKTsKKworCS8qIEZpcnN0IHRpbWVzdGFtcCBzbmFw
c2hvdCBsb2NhdGlvbi4gKi8KKwl0czAgPSBjczsKKworCS8qCisJICogSW5pdGlhbCBzbmFwc2hv
dCBvZiB0aGUgdGltZXN0YW1wIHJlZ2lzdGVyIHRvIGltcGxlbWVudCB0aGUgd2FpdC4KKwkgKiBX
ZSB3b3JrIHdpdGggMzJiIHZhbHVlcywgc28gY2xlYXIgb3V0IHRoZSB0b3AgMzJiIGJpdHMgb2Yg
dGhlCisJICogcmVnaXN0ZXIgYmVjYXVzZSB0aGUgQUxVIHdvcmtzIDY0Yml0cy4KKwkgKi8KKwkq
Y3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKDEpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19v
ZmZzZXQoQ1NfR1BSKFNUQVJUX1RTKSkgKyA0OworCSpjcysrID0gMDsKKwkqY3MrKyA9IE1JX0xP
QURfUkVHSVNURVJfUkVHIHwgKDMgLSAyKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0
KFJJTkdfVElNRVNUQU1QKGJhc2UpKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENT
X0dQUihTVEFSVF9UUykpOworCisJLyoKKwkgKiBUaGlzIGlzIHRoZSBsb2NhdGlvbiB3ZSdyZSBn
b2luZyB0byBqdW1wIGJhY2sgaW50byB1bnRpbCB0aGUKKwkgKiByZXF1aXJlZCBhbW91bnQgb2Yg
dGltZSBoYXMgcGFzc2VkLgorCSAqLworCWp1bXAgPSBjczsKKworCS8qCisJICogVGFrZSBhbm90
aGVyIHNuYXBzaG90IG9mIHRoZSB0aW1lc3RhbXAgcmVnaXN0ZXIuIFRha2UgY2FyZSB0byBjbGVh
cgorCSAqIHVwIHRoZSB0b3AgMzJiaXRzIG9mIENTX0dQUigxKSBhcyB3ZSdyZSB1c2luZyBpdCBm
b3Igb3RoZXIKKwkgKiBvcGVyYXRpb25zIGJlbG93LgorCSAqLworCSpjcysrID0gTUlfTE9BRF9S
RUdJU1RFUl9JTU0oMSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoTk9X
X1RTKSkgKyA0OworCSpjcysrID0gMDsKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVHIHwg
KDMgLSAyKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfVElNRVNUQU1QKGJh
c2UpKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihOT1dfVFMpKTsKKwor
CS8qCisJICogRG8gYSBkaWZmIGJldHdlZW4gdGhlIDIgdGltZXN0YW1wcyBhbmQgc3RvcmUgdGhl
IHJlc3VsdCBiYWNrIGludG8KKwkgKiBDU19HUFIoMSkuCisJICovCisJKmNzKysgPSBNSV9NQVRI
KDUpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVH
KE5PV19UUykpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0IsIE1JX01B
VEhfUkVHKFNUQVJUX1RTKSk7CisJKmNzKysgPSBNSV9NQVRIX1NVQjsKKwkqY3MrKyA9IE1JX01B
VEhfU1RPUkUoTUlfTUFUSF9SRUcoREVMVEFfVFMpLCBNSV9NQVRIX1JFR19BQ0NVKTsKKwkqY3Mr
KyA9IE1JX01BVEhfU1RPUkUoTUlfTUFUSF9SRUcoSlVNUF9QUkVESUNBVEUpLCBNSV9NQVRIX1JF
R19DRik7CisKKwkvKgorCSAqIFRyYW5zZmVyIHRoZSBjYXJyeSBmbGFnIChzZXQgdG8gMSBpZiB0
czEgPCB0czAsIG1lYW5pbmcgdGhlCisJICogdGltZXN0YW1wIGhhdmUgcm9sbGVkIG92ZXIgdGhl
IDMyYml0cykgaW50byB0aGUgcHJlZGljYXRlIHJlZ2lzdGVyCisJICogdG8gYmUgdXNlZCBmb3Ig
dGhlIHByZWRpY2F0ZWQganVtcC4KKwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVH
IHwgKDMgLSAyKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihKVU1QX1BS
RURJQ0FURSkpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoTUlfUFJFRElDQVRFX1JF
U1VMVF8xKTsKKworCS8qIFJlc3RhcnQgZnJvbSB0aGUgYmVnaW5uaW5nIGlmIHdlIGhhZCB0aW1l
c3RhbXBzIHJvbGwgb3Zlci4gKi8KKwkqY3MrKyA9IChJTlRFTF9HRU4oaTkxNSkgPCA4ID8KKwkJ
IE1JX0JBVENIX0JVRkZFUl9TVEFSVCA6CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VOOCkg
fAorCQlNSV9CQVRDSF9QUkVESUNBVEU7CisJKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSkg
KyAodHMwIC0gYmF0Y2gpICogNDsKKwkqY3MrKyA9IDA7CisKKwkvKgorCSAqIE5vdyBhZGQgdGhl
IGRpZmYgYmV0d2VlbiB0byBwcmV2aW91cyB0aW1lc3RhbXBzIGFuZCBhZGQgaXQgdG8gOgorCSAq
ICAgICAgKCgoMSAqIDw8IDY0KSAtIDEpIC0gZGVsYXlfbnMpCisJICoKKwkgKiBXaGVuIHRoZSBD
YXJyeSBGbGFnIGNvbnRhaW5zIDEgdGhpcyBtZWFucyB0aGUgZWxhcHNlZCB0aW1lIGlzCisJICog
bG9uZ2VyIHRoYW4gdGhlIGV4cGVjdGVkIGRlbGF5LCBhbmQgd2UgY2FuIGV4aXQgdGhlIHdhaXQg
bG9vcC4KKwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKDIpOworCSpjcysrID0g
aTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BSKERFTFRBX1RBUkdFVCkpOworCSpjcysrID0gbG93
ZXJfMzJfYml0cyhkZWxheV90aWNrcyk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChD
U19HUFIoREVMVEFfVEFSR0VUKSkgKyA0OworCSpjcysrID0gdXBwZXJfMzJfYml0cyhkZWxheV90
aWNrcyk7CisKKwkqY3MrKyA9IE1JX01BVEgoNCk7CisJKmNzKysgPSBNSV9NQVRIX0xPQUQoTUlf
TUFUSF9SRUdfU1JDQSwgTUlfTUFUSF9SRUcoREVMVEFfVFMpKTsKKwkqY3MrKyA9IE1JX01BVEhf
TE9BRChNSV9NQVRIX1JFR19TUkNCLCBNSV9NQVRIX1JFRyhERUxUQV9UQVJHRVQpKTsKKwkqY3Mr
KyA9IE1JX01BVEhfQUREOworCSpjcysrID0gTUlfTUFUSF9TVE9SRUlOVihNSV9NQVRIX1JFRyhK
VU1QX1BSRURJQ0FURSksIE1JX01BVEhfUkVHX0NGKTsKKworCS8qCisJICogVHJhbnNmZXIgdGhl
IHJlc3VsdCBpbnRvIHRoZSBwcmVkaWNhdGUgcmVnaXN0ZXIgdG8gYmUgdXNlZCBmb3IgdGhlCisJ
ICogcHJlZGljYXRlZCBqdW1wLgorCSAqLworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcg
fCAoMyAtIDIpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BSKEpVTVBfUFJF
RElDQVRFKSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChNSV9QUkVESUNBVEVfUkVT
VUxUXzEpOworCisJLyogUHJlZGljYXRlIHRoZSBqdW1wLiAgKi8KKwkqY3MrKyA9IChJTlRFTF9H
RU4oaTkxNSkgPCA4ID8KKwkJIE1JX0JBVENIX0JVRkZFUl9TVEFSVCA6CisJCSBNSV9CQVRDSF9C
VUZGRVJfU1RBUlRfR0VOOCkgfAorCQlNSV9CQVRDSF9QUkVESUNBVEU7CisJKmNzKysgPSBpOTE1
X2dndHRfb2Zmc2V0KHZtYSkgKyAoanVtcCAtIGJhdGNoKSAqIDQ7CisJKmNzKysgPSAwOworCisJ
LyogUmVzdG9yZSByZWdpc3RlcnMuICovCisJZm9yIChpID0gMDsgaSA8IE5fQ1NfR1BSOyBpKysp
CisJCWNzID0gc2F2ZV9yZXN0b3JlX3JlZ2lzdGVyKAorCQkJc3RyZWFtLCBjcywgZmFsc2UgLyog
cmVzdG9yZSAqLywgQ1NfR1BSKGkpLAorCQkJSU5URUxfR1RfU0NSQVRDSF9GSUVMRF9QRVJGX0NT
X0dQUiArIDggKiBpLCAyKTsKKwljcyA9IHNhdmVfcmVzdG9yZV9yZWdpc3RlcigKKwkJc3RyZWFt
LCBjcywgZmFsc2UgLyogcmVzdG9yZSAqLywgTUlfUFJFRElDQVRFX1JFU1VMVF8xLAorCQlJTlRF
TF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfUFJFRElDQVRFX1JFU1VMVF8xLCAxKTsKKworCS8qIEFu
ZCByZXR1cm4gdG8gdGhlIHJpbmcuICovCisJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOwor
CisJR0VNX0JVR19PTihjcyAtIGJhdGNoID4gUEFHRV9TSVpFIC8gc2l6ZW9mKCpiYXRjaCkpOwor
CisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChibyk7CisJaTkxNV9nZW1fb2JqZWN0X3VucGlu
X21hcChibyk7CisKKwlzdHJlYW0tPm5vYV93YWl0ID0gdm1hOworCXJldHVybiAwOworCitlcnJf
dW5waW46CisJX19pOTE1X3ZtYV91bnBpbih2bWEpOworZXJyX3VucmVmOgorCWk5MTVfZ2VtX29i
amVjdF9wdXQoYm8pOworCXJldHVybiByZXQ7Cit9CisKIHN0YXRpYyB2b2lkIGNvbmZpZ19vYV9y
ZWdzKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpOTE1
X29hX3JlZyAqcmVncywKIAkJCSAgIHUzMiBuX3JlZ3MpCkBAIC0yMjA2LDYgKzI0MTQsMTIgQEAg
c3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0sCiAJCX0KIAl9CiAKKwlyZXQgPSBhbGxvY19ub2Ffd2FpdChzdHJlYW0pOworCWlmIChy
ZXQpIHsKKwkJRFJNX0RFQlVHKCJVbmFibGUgdG8gYWxsb2NhdGUgTk9BIHdhaXQgYmF0Y2ggYnVm
ZmVyXG4iKTsKKwkJZ290byBlcnJfbm9hX3dhaXRfYWxsb2M7CisJfQorCiAJc3RyZWFtLT5vYV9j
b25maWcgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZyhwZXJmLCBwcm9wcy0+bWV0cmljc19zZXQp
OwogCWlmICghc3RyZWFtLT5vYV9jb25maWcpIHsKIAkJRFJNX0RFQlVHKCJJbnZhbGlkIE9BIGNv
bmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nfc2V0KTsKQEAgLTIyNjUsNiArMjQ3OSw5IEBA
IHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAq
c3RyZWFtLAogCWludGVsX2VuZ2luZV9wbV9wdXQoc3RyZWFtLT5lbmdpbmUpOwogCiBlcnJfY29u
ZmlnOgorCWZyZWVfbm9hX3dhaXQoc3RyZWFtKTsKKworZXJyX25vYV93YWl0X2FsbG9jOgogCWlm
IChzdHJlYW0tPmN0eCkKIAkJb2FfcHV0X3JlbmRlcl9jdHhfaWQoc3RyZWFtKTsKIApAQCAtMzY1
MCw2ICszODY3LDkgQEAgdm9pZCBpOTE1X3BlcmZfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAkJcmF0ZWxpbWl0X3NldF9mbGFncygmcGVyZi0+c3B1cmlvdXNfcmVwb3J0X3Jz
LAogCQkJCSAgICBSQVRFTElNSVRfTVNHX09OX1JFTEVBU0UpOwogCisJCWF0b21pYzY0X3NldCgm
cGVyZi0+bm9hX3Byb2dyYW1taW5nX2RlbGF5LAorCQkJICAgICA1MDAgKiAxMDAwIC8qIDUwMHVz
ICovKTsKKwogCQlwZXJmLT5pOTE1ID0gaTkxNTsKIAl9CiB9CkBAIC0zNjg5LDMgKzM5MDksNyBA
QCBpbnQgaTkxNV9wZXJmX2lvY3RsX3ZlcnNpb24odm9pZCkKIHsKIAlyZXR1cm4gMTsKIH0KKwor
I2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2luY2x1ZGUgInNlbGZ0
ZXN0cy9pOTE1X3BlcmYuYyIKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlw
ZXMuaAppbmRleCAzMzdjZDdkMmFkNzcuLmQzNWEzYzE5NDZjMyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmX3R5cGVzLmgKQEAgLTI2Niw2ICsyNjYsMTIgQEAgc3RydWN0IGk5MTVfcGVy
Zl9zdHJlYW0gewogCQkgKi8KIAkJdTMyIGhlYWQ7CiAJfSBvYV9idWZmZXI7CisKKwkvKioKKwkg
KiBBIGJhdGNoIGJ1ZmZlciBkb2luZyBhIHdhaXQgb24gdGhlIEdQVSBmb3IgdGhlIE5PQSBsb2dp
YyB0byBiZQorCSAqIHJlcHJvZ3JhbW1lZC4KKwkgKi8KKwlzdHJ1Y3QgaTkxNV92bWEgKm5vYV93
YWl0OwogfTsKIAogLyoqCkBAIC0zODUsNiArMzkxLDggQEAgc3RydWN0IGk5MTVfcGVyZiB7CiAK
IAlzdHJ1Y3QgaTkxNV9vYV9vcHMgb3BzOwogCWNvbnN0IHN0cnVjdCBpOTE1X29hX2Zvcm1hdCAq
b2FfZm9ybWF0czsKKworCWF0b21pYzY0X3Qgbm9hX3Byb2dyYW1taW5nX2RlbGF5OwogfTsKIAog
I2VuZGlmIC8qIF9JOTE1X1BFUkZfVFlQRVNfSF8gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmlu
ZGV4IDFkYzA2N2ZjNTdhYi4uOTlmOGEwOGRjMmIyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlZy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgK
QEAgLTU0NSw3ICs1NDUsOSBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9tbWlvX3JlZ192YWxp
ZChpOTE1X3JlZ190IHJlZykKICNkZWZpbmUgTUlfUFJFRElDQVRFX1NSQzBfVURXCV9NTUlPKDB4
MjQwMCArIDQpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9TUkMxCV9NTUlPKDB4MjQwOCkKICNkZWZp
bmUgTUlfUFJFRElDQVRFX1NSQzFfVURXCV9NTUlPKDB4MjQwOCArIDQpCi0KKyNkZWZpbmUgTUlf
UFJFRElDQVRFX0RBVEEgICAgICAgX01NSU8oMHgyNDEwKQorI2RlZmluZSBNSV9QUkVESUNBVEVf
UkVTVUxUICAgICBfTU1JTygweDI0MTgpCisjZGVmaW5lIE1JX1BSRURJQ0FURV9SRVNVTFRfMSAg
IF9NTUlPKDB4MjQxYykKICNkZWZpbmUgTUlfUFJFRElDQVRFX1JFU1VMVF8yCV9NTUlPKDB4MjIx
NCkKICNkZWZpbmUgIExPV0VSX1NMSUNFX0VOQUJMRUQJKDEgPDwgMCkKICNkZWZpbmUgIExPV0VS
X1NMSUNFX0RJU0FCTEVECSgwIDw8IDApCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAppbmRleCA2NzEzZWZlYTM1MGIuLjZkYWY2
NTk5ZWM3OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
bGl2ZV9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9saXZlX3NlbGZ0ZXN0cy5oCkBAIC0zNSwzICszNSw0IEBAIHNlbGZ0ZXN0KHJlc2V0LCBpbnRl
bF9yZXNldF9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGhhbmdjaGVjaywgaW50ZWxfaGFuZ2No
ZWNrX2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZXhlY2xpc3RzLCBpbnRlbF9leGVjbGlzdHNf
bGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndWMsIGludGVsX2d1Y19saXZlX3NlbGZ0ZXN0KQor
c2VsZnRlc3QocGVyZiwgaTkxNV9wZXJmX2xpdmVfc2VsZnRlc3RzKQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAw
MDAwMDAwMDAwMC4uZGM2ZDY4OWU0MjUxCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jCkBAIC0wLDAgKzEsMjE2IEBACisvKgorICog
U1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IElu
dGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2tyZWYuaD4KKworI2luY2x1
ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisKKyNpbmNs
dWRlICJpOTE1X3NlbGZ0ZXN0LmgiCisKKyNpbmNsdWRlICJpZ3RfZmx1c2hfdGVzdC5oIgorI2lu
Y2x1ZGUgImxpYl9zd19mZW5jZS5oIgorCitzdGF0aWMgc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KgordGVzdF9zdHJlYW0oc3RydWN0IGk5MTVfcGVyZiAqcGVyZikKK3sKKwlzdHJ1Y3QgZHJtX2k5
MTVfcGVyZl9vcGVuX3BhcmFtIHBhcmFtID0ge307CisJc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0
aWVzIHByb3BzID0geworCQkuZW5naW5lID0gaW50ZWxfZW5naW5lX2xvb2t1cF91c2VyKHBlcmYt
Pmk5MTUsCisJCQkJCQkgICBJOTE1X0VOR0lORV9DTEFTU19SRU5ERVIsCisJCQkJCQkgICAwKSwK
KwkJLnNhbXBsZV9mbGFncyA9IFNBTVBMRV9PQV9SRVBPUlQsCisJCS5vYV9mb3JtYXQgPSBJOTE1
X09BX0ZPUk1BVF9DNF9COCwKKwkJLm1ldHJpY3Nfc2V0ID0gMSwKKwl9OworCXN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW07CisKKwlzdHJlYW0gPSBremFsbG9jKHNpemVvZigqc3RyZWFt
KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzdHJlYW0pCisJCXJldHVybiBOVUxMOworCisJc3RyZWFt
LT5wZXJmID0gcGVyZjsKKworCW11dGV4X2xvY2soJnBlcmYtPmxvY2spOworCWlmIChpOTE1X29h
X3N0cmVhbV9pbml0KHN0cmVhbSwgJnBhcmFtLCAmcHJvcHMpKSB7CisJCWtmcmVlKHN0cmVhbSk7
CisJCXN0cmVhbSA9ICBOVUxMOworCX0KKwltdXRleF91bmxvY2soJnBlcmYtPmxvY2spOworCisJ
cmV0dXJuIHN0cmVhbTsKK30KKworc3RhdGljIHZvaWQgc3RyZWFtX2Rlc3Ryb3koc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKK3sKKwlzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmID0gc3Ry
ZWFtLT5wZXJmOworCisJbXV0ZXhfbG9jaygmcGVyZi0+bG9jayk7CisJaTkxNV9wZXJmX2Rlc3Ry
b3lfbG9ja2VkKHN0cmVhbSk7CisJbXV0ZXhfdW5sb2NrKCZwZXJmLT5sb2NrKTsKK30KKworc3Rh
dGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtOwor
CisJLyogUXVpY2sgY2hlY2sgd2UgY2FuIGNyZWF0ZSBhIHBlcmYgc3RyZWFtICovCisKKwlzdHJl
YW0gPSB0ZXN0X3N0cmVhbSgmaTkxNS0+cGVyZik7CisJaWYgKCFzdHJlYW0pCisJCXJldHVybiAt
RUlOVkFMOworCisJc3RyZWFtX2Rlc3Ryb3koc3RyZWFtKTsKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludCB3cml0ZV90aW1lc3RhbXAoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGludCBzbG90
KQoreworCXUzMiAqY3M7CisJaW50IGxlbjsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwg
Nik7CisJaWYgKElTX0VSUihjcykpCisJCXJldHVybiBQVFJfRVJSKGNzKTsKKworCWxlbiA9IDU7
CisJaWYgKElOVEVMX0dFTihycS0+aTkxNSkgPj0gOCkKKwkJbGVuKys7CisKKwkqY3MrKyA9IEdG
WF9PUF9QSVBFX0NPTlRST0wobGVuKTsKKwkqY3MrKyA9IFBJUEVfQ09OVFJPTF9HTE9CQUxfR1RU
X0lWQiB8CisJCVBJUEVfQ09OVFJPTF9TVE9SRV9EQVRBX0lOREVYIHwKKwkJUElQRV9DT05UUk9M
X1dSSVRFX1RJTUVTVEFNUDsKKwkqY3MrKyA9IHNsb3QgKiBzaXplb2YodTMyKTsKKwkqY3MrKyA9
IDA7CisJKmNzKysgPSAwOworCSpjcysrID0gMDsKKworCWludGVsX3JpbmdfYWR2YW5jZShycSwg
Y3MpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBrdGltZV90IHBvbGxfc3RhdHVzKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgc2xvdCkKK3sKKwl3aGlsZSAoIWludGVsX3JlYWRfc3Rh
dHVzX3BhZ2UocnEtPmVuZ2luZSwgc2xvdCkgJiYKKwkgICAgICAgIWk5MTVfcmVxdWVzdF9jb21w
bGV0ZWQocnEpKQorCQljcHVfcmVsYXgoKTsKKworCXJldHVybiBrdGltZV9nZXQoKTsKK30KKwor
c3RhdGljIGludCBsaXZlX25vYV9kZWxheSh2b2lkICphcmcpCit7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbTsK
KwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwlrdGltZV90IHQwLCB0MTsKKwl1NjQgZXhwZWN0
ZWQ7CisJdTMyIGRlbGF5OworCWludCBlcnI7CisJaW50IGk7CisKKwkvKiBDaGVjayB0aGF0IHRo
ZSBHUFUgZGVsYXlzIG1hdGNoZXMgZXhwZWN0YXRpb25zICovCisKKwlzdHJlYW0gPSB0ZXN0X3N0
cmVhbSgmaTkxNS0+cGVyZik7CisJaWYgKCFzdHJlYW0pCisJCXJldHVybiAtRU5PTUVNOworCisJ
ZXhwZWN0ZWQgPSBhdG9taWM2NF9yZWFkKCZzdHJlYW0tPnBlcmYtPm5vYV9wcm9ncmFtbWluZ19k
ZWxheSk7CisKKwlpZiAoc3RyZWFtLT5lbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykgewor
CQllcnIgPSAtRU5PREVWOworCQlnb3RvIG91dDsKKwl9CisKKwlmb3IgKGkgPSAwOyBpIDwgNDsg
aSsrKQorCQlpbnRlbF93cml0ZV9zdGF0dXNfcGFnZShzdHJlYW0tPmVuZ2luZSwgMHgxMDAgKyBp
LCAwKTsKKworCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJlYW0tPmVuZ2luZS0+a2VybmVs
X2NvbnRleHQpOworCWlmIChJU19FUlIocnEpKSB7CisJCWVyciA9IFBUUl9FUlIocnEpOworCQln
b3RvIG91dDsKKwl9CisKKwlpZiAocnEtPmVuZ2luZS0+ZW1pdF9pbml0X2JyZWFkY3J1bWIgJiYK
KwkgICAgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKS0+aGFzX2luaXRpYWxfYnJlYWRjcnVtYikg
eworCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYihycSk7CisJCWlmIChl
cnIpIHsKKwkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQkJZ290byBvdXQ7CisJCX0KKwl9CisK
KwllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDB4MTAwKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVf
cmVxdWVzdF9hZGQocnEpOworCQlnb3RvIG91dDsKKwl9CisKKwllcnIgPSBycS0+ZW5naW5lLT5l
bWl0X2JiX3N0YXJ0KHJxLAorCQkJCQlpOTE1X2dndHRfb2Zmc2V0KHN0cmVhbS0+bm9hX3dhaXQp
LCAwLAorCQkJCQlJOTE1X0RJU1BBVENIX1NFQ1VSRSk7CisJaWYgKGVycikgeworCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKKwkJZ290byBvdXQ7CisJfQorCisJZXJyID0gd3JpdGVfdGltZXN0YW1w
KHJxLCAweDEwMik7CisJaWYgKGVycikgeworCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJZ290
byBvdXQ7CisJfQorCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJaTkxNV9yZXF1ZXN0X2FkZChy
cSk7CisKKwlwcmVlbXB0X2Rpc2FibGUoKTsKKwl0MCA9IHBvbGxfc3RhdHVzKHJxLCAweDEwMCk7
CisJdDEgPSBwb2xsX3N0YXR1cyhycSwgMHgxMDIpOworCXByZWVtcHRfZW5hYmxlKCk7CisKKwlw
cl9pbmZvKCJDUFUgZGVsYXk6ICVsbHVucywgZXhwZWN0ZWQgJWxsdW5zXG4iLAorCQlrdGltZV9z
dWIodDEsIHQwKSwgZXhwZWN0ZWQpOworCisJZGVsYXkgPSBpbnRlbF9yZWFkX3N0YXR1c19wYWdl
KHN0cmVhbS0+ZW5naW5lLCAweDEwMik7CisJZGVsYXkgLT0gaW50ZWxfcmVhZF9zdGF0dXNfcGFn
ZShzdHJlYW0tPmVuZ2luZSwgMHgxMDApOworCWRlbGF5ID0gZGl2X3U2NChtdWxfdTMyX3UzMihk
ZWxheSwgMTAwMCAqIDEwMDApLAorCQkJUlVOVElNRV9JTkZPKGk5MTUpLT5jc190aW1lc3RhbXBf
ZnJlcXVlbmN5X2toeik7CisJcHJfaW5mbygiR1BVIGRlbGF5OiAldW5zLCBleHBlY3RlZCAlbGx1
bnNcbiIsCisJCWRlbGF5LCBleHBlY3RlZCk7CisKKwlpZiAoNCAqIGRlbGF5IDwgMyAqIGV4cGVj
dGVkIHx8IDIgKiBkZWxheSA+IDMgKiBleHBlY3RlZCkgeworCQlwcl9lcnIoIkdQVSBkZWxheSBb
JXV1c10gb3V0c2lkZSBvZiBleHBlY3RlZCB0aHJlc2hvbGQhIFslbGx1dXMsICVsbHV1c11cbiIs
CisJCSAgICAgICBkZWxheSAvIDEwMDAsCisJCSAgICAgICBkaXZfdTY0KDMgKiBleHBlY3RlZCwg
NDAwMCksCisJCSAgICAgICBkaXZfdTY0KDMgKiBleHBlY3RlZCwgMjAwMCkpOworCQllcnIgPSAt
RUlOVkFMOworCX0KKworCWk5MTVfcmVxdWVzdF9wdXQocnEpOworb3V0OgorCXN0cmVhbV9kZXN0
cm95KHN0cmVhbSk7CisJcmV0dXJuIGVycjsKK30KKworaW50IGk5MTVfcGVyZl9saXZlX3NlbGZ0
ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0aWMgY29uc3Qgc3Ry
dWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGxpdmVfc2FuaXR5Y2hlY2sp
LAorCQlTVUJURVNUKGxpdmVfbm9hX2RlbGF5KSwKKwl9OworCXN0cnVjdCBpOTE1X3BlcmYgKnBl
cmYgPSAmaTkxNS0+cGVyZjsKKworCWlmICghcGVyZi0+bWV0cmljc19rb2JqIHx8ICFwZXJmLT5v
cHMuZW5hYmxlX21ldHJpY19zZXQpCisJCXJldHVybiAwOworCisJaWYgKGludGVsX2d0X2lzX3dl
ZGdlZCgmaTkxNS0+Z3QpKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBpOTE1X3N1YnRlc3RzKHRl
c3RzLCBpOTE1KTsKK30KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

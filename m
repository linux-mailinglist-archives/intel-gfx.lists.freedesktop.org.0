Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 21A6EBDBB1
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 12:02:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 72BA46EB75;
	Wed, 25 Sep 2019 10:02:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A10BC6EB6E
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 10:02:02 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18609366-1500050 
 for multiple; Wed, 25 Sep 2019 11:01:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 11:01:15 +0100
Message-Id: <20190925100137.17956-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190925100137.17956-1-chris@chris-wilson.co.uk>
References: <20190925100137.17956-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/27] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
CkluIGFkZGluZyB0aGUgYXN5bmNocm9ub3VzIHZtYSBiaW5kaW5nLCBvbmUgc3VidGxlIHJlcXVp
cmVtZW50IGlzIHRvCmF2b2lkIGNvdXBsaW5nIHRoZSBiaW5kaW5nIGZlbmNlIGludG8gdGhlIGJh
Y2tpbmcgb2JqZWN0LT5yZXN2LiBUaGF0IGlzCnRoZSBhc3luY2hyb25vdXMgYmluZGluZyBvbmx5
IGFwcGxpZXMgdG8gdGhlIHZtYSB0aW1lbGluZSBpdHNlbGYgYW5kIG5vdAp0byB0aGUgcGFnZXMg
YXMgdGhhdCBpcyBhIG1vcmUgZ2xvYmFsIHRpbWVsaW5lICh0aGUgYmluZGluZyBvZiBvbmUgdm1h
CmRvZXMgbm90IG5lZWQgdG8gYmUgb3JkZXJlZCB3aXRoIGFub3RoZXIgdm1hLCBub3IgZG9lcyB0
aGUgaW1wbGljaXQgR0VNCmZlbmNpbmcgZGVwZW5kIG9uIGEgdm1hLCBvbmx5IG9uIHdyaXRlcyB0
byB0aGUgYmFja2luZyBzdG9yZSkuIEtlZXBpbmcKdGhlIHZtYSBiaW5kaW5nIGRpc3RpbmN0IGZy
b20gdGhlIGJhY2tpbmcgc3RvcmUgdGltZWxpbmVzIGlzIHZlcmlmaWVkIGJ5CmEgbnVtYmVyIG9m
IGFzeW5jIGdlbV9leGVjX2ZlbmNlIGFuZCBnZW1fZXhlY19zY2hlZHVsZSB0ZXN0cy4gVGhlIHdh
eSB3ZQpkbyB0aGlzIGlzIHF1aXRlIHNpbXBsZSwgd2Uga2VlcCB0aGUgZmVuY2UgZm9yIHRoZSB2
bWEgYmluZGluZyBzZXBhcmF0ZQphbmQgb25seSB3YWl0IG9uIGl0IGFzIHJlcXVpcmVkLCBhbmQg
bmV2ZXIgYWRkIGl0IHRvIHRoZSBvYmotPnJlc3YKaXRzZWxmLgoKQW5vdGhlciBjb25zZXF1ZW5j
ZSBpbiByZWR1Y2luZyB0aGUgbG9ja2luZyBhcm91bmQgdGhlIHZtYSBpcyB0aGUKZGVzdHJ1Y3Rp
b24gb2YgdGhlIHZtYSBpcyBubyBsb25nZXIgZ2xvYmFsbHkgc2VyaWFsaXNlZCBieSBzdHJ1Y3Rf
bXV0ZXguCkEgbmF0dXJhbCBzb2x1dGlvbiB3b3VsZCBiZSB0byBhZGQgYSBrcmVmIHRvIGk5MTVf
dm1hLCBidXQgdGhhdCByZXF1aXJlcwpkZWNvdXBsaW5nIHRoZSByZWZlcmVuY2UgY3ljbGVzLCBw
b3NzaWJseSBieSBpbnRyb2R1Y2luZyBhIG5ldwppOTE1X21tX3BhZ2VzIG9iamVjdCB0aGF0IGlz
IG93biBieSBib3RoIG9iai0+bW0gYW5kIHZtYS0+cGFnZXMuCkhvd2V2ZXIsIHdlIGhhdmUgbm90
IHRha2VuIHRoYXQgcm91dGUgZHVlIHRvIHRoZSBvdmVyc2hhZG93aW5nIGxtZW0vdHRtCmRpc2N1
c3Npb25zLCBhbmQgaW5zdGVhZCBwbGF5IGEgc2VyaWVzIG9mIGNvbXBsaWNhdGVkIGdhbWVzIHdp
dGgKdHJ5bG9ja3MgdG8gKGhvcGVmdWxseSkgZW5zdXJlIHRoYXQgb25seSBvbmUgZGVzdHJ1Y3Rp
b24gcGF0aCBpcyBjYWxsZWQhCgp2MjogQWRkIHNvbWUgY29tbWVudGFyeSwgYW5kIHNvbWUgaGVs
cGVycyB0byByZWR1Y2UgcGF0Y2ggY2h1cm4uCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJz
dWxpbkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMgIHwgIDI5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zi
ZGV2LmMgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jICB8ICAxMSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5jICAgfCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4u
YyAgICB8ICAxMyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5j
ICAgIHwgIDQzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jICAg
ICAgfCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyAg
ICB8ICAzMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oICAg
IHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jICB8
ICA3MyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyAgICB8
ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jICAgIHwg
IDI3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAg
MjcgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8ICAg
OSArLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIHwgIDEy
ICstCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCAgIDQg
LQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jICAgIHwgICA3ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jICAgICAgICAgICAgfCAgIDUgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyAgICB8ICAgNCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDE5ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyAgICAgICAgfCAgMTIgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8ICA5NSArKystCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAgICAgICAgfCAgIDcgKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCAgICAgIHwgICA1ICsKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAgICAgICAgICB8ICAgMiAtCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgODMgKystCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jICAgICAgICAgfCAgMjggKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jICAgICB8ICAgOSArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgIHwgMTA5ICsrLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oICAgICAgICAgICB8ICA0NSArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAgICAgIHwgIDMyICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAgICAgICAgfCA1MjQgKysrKysrKysrKysrLS0t
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oICAgICAgICAgICAgICAgfCAgODQg
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYyAgICAgfCAgIDIg
LQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyAgIHwgIDM2ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAgNTggKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyB8ICAgNyArCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyAgICAgfCAgIDYgKy0KIDM5
IGZpbGVzIGNoYW5nZWQsIDgyMyBpbnNlcnRpb25zKCspLCA3MDAgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA1ZWNmNTQy
NzAxODEuLjEyYWJjZDFlNDcxYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMKQEAgLTIwNzksNyArMjA3OSw2IEBAIGludGVsX3Bpbl9hbmRfZmVuY2Vf
ZmJfb2JqKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCXVuc2lnbmVkIGludCBwaW5jdGw7
CiAJdTMyIGFsaWdubWVudDsKIAotCVdBUk5fT04oIW11dGV4X2lzX2xvY2tlZCgmZGV2LT5zdHJ1
Y3RfbXV0ZXgpKTsKIAlpZiAoV0FSTl9PTighaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVy
KG9iaikpKQogCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIApAQCAtMjE2Myw4ICsyMTYyLDYg
QEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
CiAKIHZvaWQgaW50ZWxfdW5waW5fZmJfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25l
ZCBsb25nIGZsYWdzKQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fb2JqZWN0X2xvY2sodm1hLT5vYmopOwogCWlm
IChmbGFncyAmIFBMQU5FX0hBU19GRU5DRSkKIAkJaTkxNV92bWFfdW5waW5fZmVuY2Uodm1hKTsK
QEAgLTMwNjUsMTIgKzMwNjIsMTAgQEAgaW50ZWxfYWxsb2NfaW5pdGlhbF9wbGFuZV9vYmooc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQltdXRleF9sb2Nr
KCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9s
ZW5fZm9yX3ByZWFsbG9jYXRlZChkZXZfcHJpdiwKIAkJCQkJCQkgICAgIGJhc2VfYWxpZ25lZCwK
IAkJCQkJCQkgICAgIGJhc2VfYWxpZ25lZCwKIAkJCQkJCQkgICAgIHNpemVfYWxpZ25lZCk7Ci0J
bXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJaWYgKCFvYmopCiAJCXJldHVybiBm
YWxzZTsKIApAQCAtMzIzMiwxMyArMzIyNywxMSBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVf
b2JqKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCWludGVsX3N0YXRlLT5jb2xvcl9w
bGFuZVswXS5zdHJpZGUgPQogCQlpbnRlbF9mYl9waXRjaChmYiwgMCwgaW50ZWxfc3RhdGUtPmJh
c2Uucm90YXRpb24pOwogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWludGVs
X3N0YXRlLT52bWEgPQogCQlpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihmYiwKIAkJCQkJICAg
JmludGVsX3N0YXRlLT52aWV3LAogCQkJCQkgICBpbnRlbF9wbGFuZV91c2VzX2ZlbmNlKGludGVs
X3N0YXRlKSwKIAkJCQkJICAgJmludGVsX3N0YXRlLT5mbGFncyk7Ci0JbXV0ZXhfdW5sb2NrKCZk
ZXYtPnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihpbnRlbF9zdGF0ZS0+dm1hKSkgewogCQlE
Uk1fRVJST1IoImZhaWxlZCB0byBwaW4gYm9vdCBmYiBvbiBwaXBlICVkOiAlbGlcbiIsCiAJCQkg
IGludGVsX2NydGMtPnBpcGUsIFBUUl9FUlIoaW50ZWxfc3RhdGUtPnZtYSkpOwpAQCAtMTQzNjgs
OCArMTQzNjEsNiBAQCBzdGF0aWMgdm9pZCBmYl9vYmpfYnVtcF9yZW5kZXJfcHJpb3JpdHkoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKICAqIGJpdHMuICBTb21lIG9sZGVyIHBsYXRm
b3JtcyBuZWVkIHNwZWNpYWwgcGh5c2ljYWwgYWRkcmVzcyBoYW5kbGluZyBmb3IKICAqIGN1cnNv
ciBwbGFuZXMuCiAgKgotICogTXVzdCBiZSBjYWxsZWQgd2l0aCBzdHJ1Y3RfbXV0ZXggaGVsZC4K
LSAqCiAgKiBSZXR1cm5zIDAgb24gc3VjY2VzcywgbmVnYXRpdmUgZXJyb3IgY29kZSBvbiBmYWls
dXJlLgogICovCiBpbnQKQEAgLTE0NDI2LDE1ICsxNDQxNyw4IEBAIGludGVsX3ByZXBhcmVfcGxh
bmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCWlmIChyZXQpIHsKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7
Ci0JCXJldHVybiByZXQ7Ci0JfQotCiAJcmV0ID0gaW50ZWxfcGxhbmVfcGluX2ZiKHRvX2ludGVs
X3BsYW5lX3N0YXRlKG5ld19zdGF0ZSkpOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiAJaWYg
KHJldCkKIAkJcmV0dXJuIHJldDsKQEAgLTE0NDgzLDggKzE0NDY3LDYgQEAgaW50ZWxfcHJlcGFy
ZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKICAqIEBvbGRfc3RhdGU6IHRoZSBz
dGF0ZSBmcm9tIHRoZSBwcmV2aW91cyBtb2Rlc2V0CiAgKgogICogQ2xlYW5zIHVwIGEgZnJhbWVi
dWZmZXIgdGhhdCBoYXMganVzdCBiZWVuIHJlbW92ZWQgZnJvbSBhIHBsYW5lLgotICoKLSAqIE11
c3QgYmUgY2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhlbGQuCiAgKi8KIHZvaWQKIGludGVsX2Ns
ZWFudXBfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCkBAIC0xNDUwMCw5ICsxNDQ4
Miw3IEBAIGludGVsX2NsZWFudXBfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJ
fQogCiAJLyogU2hvdWxkIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGEgc3VjY2Vzc2Z1bCBpbnRlbF9w
cmVwYXJlX3BsYW5lX2ZiKCkhICovCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWludGVsX3BsYW5lX3VucGluX2ZiKHRvX2ludGVsX3BsYW5lX3N0YXRlKG9sZF9z
dGF0ZSkpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQog
CiBpbnQKQEAgLTE0NzA1LDcgKzE0Njg1LDYgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUo
c3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCQkgICB1MzIgc3JjX3csIHUzMiBzcmNfaCwKIAkJ
CSAgIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4KQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgZHJt
X3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsICpuZXdfcGxhbmVfc3RhdGU7CiAJc3RydWN0
IGludGVsX3BsYW5lICppbnRlbF9wbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lKTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CkBAIC0xNDc3MSwxMyArMTQ3NTAsOSBA
QCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlp
ZiAocmV0KQogCQlnb3RvIG91dF9mcmVlOwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJZ290byBvdXRf
ZnJlZTsKLQogCXJldCA9IGludGVsX3BsYW5lX3Bpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShu
ZXdfcGxhbmVfc3RhdGUpKTsKIAlpZiAocmV0KQotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8g
b3V0X2ZyZWU7CiAKIAlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCh0b19pbnRlbF9mcm9udGJ1ZmZl
cihmYiksIE9SSUdJTl9GTElQKTsKIAlpbnRlbF9mcm9udGJ1ZmZlcl90cmFjayh0b19pbnRlbF9m
cm9udGJ1ZmZlcihvbGRfcGxhbmVfc3RhdGUtPmZiKSwKQEAgLTE0ODA3LDggKzE0NzgyLDYgQEAg
aW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAKIAlp
bnRlbF9wbGFuZV91bnBpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShvbGRfcGxhbmVfc3RhdGUp
KTsKIAotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211
dGV4KTsKIG91dF9mcmVlOgogCWlmIChuZXdfY3J0Y19zdGF0ZSkKIAkJaW50ZWxfY3J0Y19kZXN0
cm95X3N0YXRlKGNydGMsICZuZXdfY3J0Y19zdGF0ZS0+YmFzZSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKaW5kZXggNjgzMzg2NjlmMDU0Li45N2NkZTAxNzY3
MGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJkZXYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKQEAgLTIw
NCw3ICsyMDQsNiBAQCBzdGF0aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVs
cGVyICpoZWxwZXIsCiAJCXNpemVzLT5mYl9oZWlnaHQgPSBpbnRlbF9mYi0+YmFzZS5oZWlnaHQ7
CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwogCiAJLyogUGluIHRoZSBH
R1RUIHZtYSBmb3Igb3VyIGFjY2VzcyB2aWEgaW5mby0+c2NyZWVuX2Jhc2UuCkBAIC0yNjYsNyAr
MjY1LDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAq
aGVscGVyLAogCWlmYmRldi0+dm1hX2ZsYWdzID0gZmxhZ3M7CiAKIAlpbnRlbF9ydW50aW1lX3Bt
X3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmZGV2
LT5zdHJ1Y3RfbXV0ZXgpOwogCXZnYV9zd2l0Y2hlcm9vX2NsaWVudF9mYl9zZXQocGRldiwgaW5m
byk7CiAJcmV0dXJuIDA7CiAKQEAgLTI3NCw3ICsyNzIsNiBAQCBzdGF0aWMgaW50IGludGVsZmJf
Y3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJaW50ZWxfdW5waW5fZmJfdm1h
KHZtYSwgZmxhZ3MpOwogb3V0X3VubG9jazoKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3By
aXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0
ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTI5MSwxMSArMjg4LDggQEAgc3RhdGljIHZvaWQg
aW50ZWxfZmJkZXZfZGVzdHJveShzdHJ1Y3QgaW50ZWxfZmJkZXYgKmlmYmRldikKIAogCWRybV9m
Yl9oZWxwZXJfZmluaSgmaWZiZGV2LT5oZWxwZXIpOwogCi0JaWYgKGlmYmRldi0+dm1hKSB7Ci0J
CW11dGV4X2xvY2soJmlmYmRldi0+aGVscGVyLmRldi0+c3RydWN0X211dGV4KTsKKwlpZiAoaWZi
ZGV2LT52bWEpCiAJCWludGVsX3VucGluX2ZiX3ZtYShpZmJkZXYtPnZtYSwgaWZiZGV2LT52bWFf
ZmxhZ3MpOwotCQltdXRleF91bmxvY2soJmlmYmRldi0+aGVscGVyLmRldi0+c3RydWN0X211dGV4
KTsKLQl9CiAKIAlpZiAoaWZiZGV2LT5mYikKIAkJZHJtX2ZyYW1lYnVmZmVyX3JlbW92ZSgmaWZi
ZGV2LT5mYi0+YmFzZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jCmluZGV4IDVlZmVmOWJhYmFkYi4uM2Y0YWMxZWU3NjY4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpAQCAtMTMwMywxNSArMTMwMywxMSBA
QCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXks
IGJvb2wgdXNlX3BoeXMpCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50IGVycjsKIAotCW11
dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zdG9sZW4oaTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAob2JqID09IE5VTEwpCiAJ
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsK
LQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRSX0VSUihvYmopOwotCQlnb3RvIGVycl91
bmxvY2s7Ci0JfQorCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIAog
CXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEwsIDAsIDAsIFBJTl9NQVBQ
QUJMRSk7CiAJaWYgKElTX0VSUih2bWEpKSB7CkBAIC0xMzMyLDEzICsxMzI4LDEwIEBAIHN0YXRp
YyBpbnQgZ2V0X3JlZ2lzdGVycyhzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwgYm9vbCB1
c2VfcGh5cykKIAl9CiAKIAlvdmVybGF5LT5yZWdfYm8gPSBvYmo7Ci0JbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gMDsKIAogZXJyX3B1dF9ibzoKIAlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1lcnJfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKaW5kZXggN2Y2MWE4MDI0MTMzLi5jMWZj
YTU3MjhlNmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
bGllbnRfYmx0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVu
dF9ibHQuYwpAQCAtMjExLDcgKzIxMSw3IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtl
cihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJICoga2VlcCB0cmFjayBvZiB0aGUgR1BVIGFj
dGl2aXR5IHdpdGhpbiB0aGlzIHZtYS9yZXF1ZXN0LCBhbmQKIAkgKiBwcm9wYWdhdGUgdGhlIHNp
Z25hbCBmcm9tIHRoZSByZXF1ZXN0IHRvIHctPmRtYS4KIAkgKi8KLQllcnIgPSBpOTE1X2FjdGl2
ZV9hZGRfcmVxdWVzdCgmdm1hLT5hY3RpdmUsIHJxKTsKKwllcnIgPSBfX2k5MTVfdm1hX21vdmVf
dG9fYWN0aXZlKHZtYSwgcnEpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3JlcXVlc3Q7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGY3YmEwOTM1
ZWQ2Ny4uOTVmOGU2NmU0NWRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMKQEAgLTMxMyw4ICszMTMsNiBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250
ZXh0X2ZyZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlHRU1fQlVHX09OKCFpOTE1
X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAogCXJlbGVhc2VfaHdfaWQoY3R4KTsKLQlp
ZiAoY3R4LT52bSkKLQkJaTkxNV92bV9wdXQoY3R4LT52bSk7CiAKIAlmcmVlX2VuZ2luZXMocmN1
X2FjY2Vzc19wb2ludGVyKGN0eC0+ZW5naW5lcykpOwogCW11dGV4X2Rlc3Ryb3koJmN0eC0+ZW5n
aW5lc19tdXRleCk7CkBAIC0zNzksOSArMzc3LDEzIEBAIHZvaWQgaTkxNV9nZW1fY29udGV4dF9y
ZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCiAKIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKKwlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9z
ZWQoY3R4KTsKKworCWlmIChjdHgtPnZtKQorCQlpOTE1X3ZtX2Nsb3NlKGN0eC0+dm0pOworCiAJ
bXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAKLQlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQo
Y3R4KTsKIAljdHgtPmZpbGVfcHJpdiA9IEVSUl9QVFIoLUVCQURGKTsKIAogCS8qCkBAIC00NzQs
NyArNDc2LDcgQEAgX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAKIAlHRU1fQlVHX09OKG9sZCAmJiBpOTE1X3Zt
X2lzXzRsdmwodm0pICE9IGk5MTVfdm1faXNfNGx2bChvbGQpKTsKIAotCWN0eC0+dm0gPSBpOTE1
X3ZtX2dldCh2bSk7CisJY3R4LT52bSA9IGk5MTVfdm1fb3Blbih2bSk7CiAJY29udGV4dF9hcHBs
eV9hbGwoY3R4LCBfX2FwcGx5X3BwZ3R0LCB2bSk7CiAKIAlyZXR1cm4gb2xkOwpAQCAtNDg4LDcg
KzQ5MCw3IEBAIHN0YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHgsCiAKIAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwogCWlmICh2bSkKLQkJaTkx
NV92bV9wdXQodm0pOworCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIH0KIAogc3RhdGljIHZvaWQgX19z
ZXRfdGltZWxpbmUoc3RydWN0IGludGVsX3RpbWVsaW5lICoqZHN0LApAQCAtOTUzLDcgKzk1NSw3
IEBAIHN0YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZp
bGVfcHJpdiwKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfdW5sb2NrOwogCi0JaTkxNV92bV9n
ZXQodm0pOworCWk5MTVfdm1fb3Blbih2bSk7CiAKIAlhcmdzLT5zaXplID0gMDsKIAlhcmdzLT52
YWx1ZSA9IHJldDsKQEAgLTk3Myw3ICs5NzUsNyBAQCBzdGF0aWMgdm9pZCBzZXRfcHBndHRfYmFy
cmllcih2b2lkICpkYXRhKQogCWlmIChJTlRFTF9HRU4ob2xkLT5pOTE1KSA8IDgpCiAJCWdlbjZf
cHBndHRfdW5waW5fYWxsKGk5MTVfdm1fdG9fcHBndHQob2xkKSk7CiAKLQlpOTE1X3ZtX3B1dChv
bGQpOworCWk5MTVfdm1fY2xvc2Uob2xkKTsKIH0KIAogc3RhdGljIGludCBlbWl0X3BwZ3R0X3Vw
ZGF0ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkKQEAgLTEwOTAsOCArMTA5
Miw4IEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUg
KmZpbGVfcHJpdiwKIAkJCQkgICBzZXRfcHBndHRfYmFycmllciwKIAkJCQkgICBvbGQpOwogCWlm
IChlcnIpIHsKLQkJaTkxNV92bV9wdXQoX19zZXRfcHBndHQoY3R4LCBvbGQpKTsKLQkJaTkxNV92
bV9wdXQob2xkKTsKKwkJaTkxNV92bV9jbG9zZShfX3NldF9wcGd0dChjdHgsIG9sZCkpOworCQlp
OTE1X3ZtX2Nsb3NlKG9sZCk7CiAJfQogCiB1bmxvY2s6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggNTVjM2FiNTllM2FhLi45OTM3YjRjMzQxZjEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKQEAgLTI4OCw3ICsy
ODgsMTIgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWlmICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEt
Pm5vZGUpKQogCQkJCWNvbnRpbnVlOwogCi0JCQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgY2Fj
aGVfbGV2ZWwsIFBJTl9VUERBVEUpOworCQkJLyogV2FpdCBmb3IgYW4gZWFybGllciBhc3luYyBi
aW5kLCBuZWVkIHRvIHJld3JpdGUgaXQgKi8KKwkJCXJldCA9IGk5MTVfdm1hX3N5bmModm1hKTsK
KwkJCWlmIChyZXQpCisJCQkJcmV0dXJuIHJldDsKKworCQkJcmV0ID0gaTkxNV92bWFfYmluZCh2
bWEsIGNhY2hlX2xldmVsLCBQSU5fVVBEQVRFLCBOVUxMKTsKIAkJCWlmIChyZXQpCiAJCQkJcmV0
dXJuIHJldDsKIAkJfQpAQCAtMzkxLDE2ICszOTYsMTEgQEAgaW50IGk5MTVfZ2VtX3NldF9jYWNo
aW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJaWYgKHJldCkK
IAkJZ290byBvdXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCiAJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQgPT0gMCkgewogCQly
ZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwgbGV2ZWwpOwogCQlpOTE1
X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAKIG91dDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CkBAIC00ODUs
NiArNDg1LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0
dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCQlpZiAoIWRybV9tbV9ub2RlX2Fs
bG9jYXRlZCgmdm1hLT5ub2RlKSkKIAkJCWNvbnRpbnVlOwogCisJCUdFTV9CVUdfT04odm1hLT52
bSAhPSAmaTkxNS0+Z2d0dC52bSk7CiAJCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2
bWEtPnZtLT5ib3VuZF9saXN0KTsKIAl9CiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11
dGV4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVj
YnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5j
CmluZGV4IGMwNDkxOTlhMWRmNS4uODhhODgxYmUxMmVjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTY5OCw3ICs2OTgsOSBAQCBzdGF0
aWMgaW50IGViX3Jlc2VydmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAKIAkJY2FzZSAx
OgogCQkJLyogVG9vIGZyYWdtZW50ZWQsIHVuYmluZCBldmVyeXRoaW5nIGFuZCByZXRyeSAqLwor
CQkJbXV0ZXhfbG9jaygmZWItPmNvbnRleHQtPnZtLT5tdXRleCk7CiAJCQllcnIgPSBpOTE1X2dl
bV9ldmljdF92bShlYi0+Y29udGV4dC0+dm0pOworCQkJbXV0ZXhfdW5sb2NrKCZlYi0+Y29udGV4
dC0+dm0tPm11dGV4KTsKIAkJCWlmIChlcnIpCiAJCQkJcmV0dXJuIGVycjsKIAkJCWJyZWFrOwpA
QCAtOTcyLDcgKzk3NCw5IEBAIHN0YXRpYyB2b2lkIHJlbG9jX2NhY2hlX3Jlc2V0KHN0cnVjdCBy
ZWxvY19jYWNoZSAqY2FjaGUpCiAJCQlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sCiAJ
CQkJCSAgICAgY2FjaGUtPm5vZGUuc3RhcnQsCiAJCQkJCSAgICAgY2FjaGUtPm5vZGUuc2l6ZSk7
CisJCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCQlkcm1fbW1fcmVtb3ZlX25vZGUo
JmNhY2hlLT5ub2RlKTsKKwkJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQl9IGVs
c2UgewogCQkJaTkxNV92bWFfdW5waW4oKHN0cnVjdCBpOTE1X3ZtYSAqKWNhY2hlLT5ub2RlLm1t
KTsKIAkJfQpAQCAtMTA0NywxMSArMTA1MSwxMyBAQCBzdGF0aWMgdm9pZCAqcmVsb2NfaW9tYXAo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCQkJICAgICAgIFBJTl9OT0VWSUNU
KTsKIAkJaWYgKElTX0VSUih2bWEpKSB7CiAJCQltZW1zZXQoJmNhY2hlLT5ub2RlLCAwLCBzaXpl
b2YoY2FjaGUtPm5vZGUpKTsKKwkJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWVy
ciA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9yYW5nZQogCQkJCSgmZ2d0dC0+dm0ubW0sICZjYWNo
ZS0+bm9kZSwKIAkJCQkgUEFHRV9TSVpFLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAogCQkJ
CSAwLCBnZ3R0LT5tYXBwYWJsZV9lbmQsCiAJCQkJIERSTV9NTV9JTlNFUlRfTE9XKTsKKwkJCW11
dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQkJaWYgKGVycikgLyogbm8gaW5hY3RpdmUg
YXBlcnR1cmUgc3BhY2UsIHVzZSBjcHUgcmVsb2MgKi8KIAkJCQlyZXR1cm4gTlVMTDsKIAkJfSBl
bHNlIHsKQEAgLTE0MTYsNyArMTQyMiw3IEBAIGViX3JlbG9jYXRlX2VudHJ5KHN0cnVjdCBpOTE1
X2V4ZWNidWZmZXIgKmViLAogCQlpZiAocmVsb2MtPndyaXRlX2RvbWFpbiA9PSBJOTE1X0dFTV9E
T01BSU5fSU5TVFJVQ1RJT04gJiYKIAkJICAgIElTX0dFTihlYi0+aTkxNSwgNikpIHsKIAkJCWVy
ciA9IGk5MTVfdm1hX2JpbmQodGFyZ2V0LCB0YXJnZXQtPm9iai0+Y2FjaGVfbGV2ZWwsCi0JCQkJ
CSAgICBQSU5fR0xPQkFMKTsKKwkJCQkJICAgIFBJTl9HTE9CQUwsIE5VTEwpOwogCQkJaWYgKFdB
Uk5fT05DRShlcnIsCiAJCQkJICAgICAgIlVuZXhwZWN0ZWQgZmFpbHVyZSB0byBiaW5kIHRhcmdl
dCBWTUEhIikpCiAJCQkJcmV0dXJuIGVycjsKQEAgLTIxNDAsMzUgKzIxNDYsNiBAQCBzdGF0aWMg
c3RydWN0IGk5MTVfcmVxdWVzdCAqZWJfdGhyb3R0bGUoc3RydWN0IGludGVsX2NvbnRleHQgKmNl
KQogCXJldHVybiBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIH0KIAotc3RhdGljIGludAotX19lYl9w
aW5fY29udGV4dChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwgc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlKQotewotCWludCBlcnI7Ci0KLQlpZiAobGlrZWx5KGF0b21pY19pbmNfbm90X3plcm8o
JmNlLT5waW5fY291bnQpKSkKLQkJcmV0dXJuIDA7Ci0KLQllcnIgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmViLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1
cm4gZXJyOwotCi0JZXJyID0gX19pbnRlbF9jb250ZXh0X2RvX3BpbihjZSk7Ci0JbXV0ZXhfdW5s
b2NrKCZlYi0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4gZXJyOwotfQotCi1z
dGF0aWMgdm9pZAotX19lYl91bnBpbl9jb250ZXh0KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmVi
LCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCi17Ci0JaWYgKGxpa2VseShhdG9taWNfYWRkX3Vu
bGVzcygmY2UtPnBpbl9jb3VudCwgLTEsIDEpKSkKLQkJcmV0dXJuOwotCi0JbXV0ZXhfbG9jaygm
ZWItPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwot
CW11dGV4X3VubG9jaygmZWItPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotfQotCiBzdGF0aWMg
aW50IF9fZWJfcGluX2VuZ2luZShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwgc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKQogewogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGw7CkBAIC0yMTg4
LDcgKzIxNjUsNyBAQCBzdGF0aWMgaW50IF9fZWJfcGluX2VuZ2luZShzdHJ1Y3QgaTkxNV9leGVj
YnVmZmVyICplYiwgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCSAqIEdHVFQgc3BhY2UsIHNv
IGRvIHRoaXMgZmlyc3QgYmVmb3JlIHdlIHJlc2VydmUgYSBzZXFubyBmb3IKIAkgKiBvdXJzZWx2
ZXMuCiAJICovCi0JZXJyID0gX19lYl9waW5fY29udGV4dChlYiwgY2UpOworCWVyciA9IGludGVs
X2NvbnRleHRfcGluKGNlKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCkBAIC0yMjMyLDcg
KzIyMDksNyBAQCBzdGF0aWMgaW50IF9fZWJfcGluX2VuZ2luZShzdHJ1Y3QgaTkxNV9leGVjYnVm
ZmVyICplYiwgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCWludGVsX2NvbnRleHRfZXhpdChj
ZSk7CiAJaW50ZWxfY29udGV4dF90aW1lbGluZV91bmxvY2sodGwpOwogZXJyX3VucGluOgotCV9f
ZWJfdW5waW5fY29udGV4dChlYiwgY2UpOworCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwogCXJl
dHVybiBlcnI7CiB9CiAKQEAgLTIyNDUsNyArMjIyMiw3IEBAIHN0YXRpYyB2b2lkIGViX3VucGlu
X2VuZ2luZShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIAlpbnRlbF9jb250ZXh0X2V4aXQo
Y2UpOwogCW11dGV4X3VubG9jaygmdGwtPm11dGV4KTsKIAotCV9fZWJfdW5waW5fY29udGV4dChl
YiwgY2UpOworCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwogfQogCiBzdGF0aWMgdW5zaWduZWQg
aW50CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwppbmRleCA4NjBiNzUx
YzUxZjEuLmM0NDYxNDg5NTQ4NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
bW1hbi5jCkBAIC0yNDksMTYgKzI0OSw2IEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3Ry
dWN0IHZtX2ZhdWx0ICp2bWYpCiAJaWYgKHJldCkKIAkJZ290byBlcnJfcnBtOwogCi0JcmV0ID0g
aTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlnb3RvIGVy
cl9yZXNldDsKLQotCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RU
IGlzIGluY29oZXJlbnQuICovCi0JaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9O
T05FICYmICFIQVNfTExDKGk5MTUpKSB7Ci0JCXJldCA9IC1FRkFVTFQ7Ci0JCWdvdG8gZXJyX3Vu
bG9jazsKLQl9Ci0KIAkvKiBOb3cgcGluIGl0IGludG8gdGhlIEdUVCBhcyBuZWVkZWQgKi8KIAl2
bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLAogCQkJCSAgICAg
ICBQSU5fTUFQUEFCTEUgfApAQCAtMjkxLDcgKzI4MSwxMyBAQCB2bV9mYXVsdF90IGk5MTVfZ2Vt
X2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCX0KIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJ
cmV0ID0gUFRSX0VSUih2bWEpOwotCQlnb3RvIGVycl91bmxvY2s7CisJCWdvdG8gZXJyX3Jlc2V0
OworCX0KKworCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlz
IGluY29oZXJlbnQuICovCisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9OT05F
ICYmICFIQVNfTExDKGk5MTUpKSB7CisJCXJldCA9IC1FRkFVTFQ7CisJCWdvdG8gZXJyX3VucGlu
OwogCX0KIAogCXJldCA9IGk5MTVfdm1hX3Bpbl9mZW5jZSh2bWEpOwpAQCAtMzI5LDggKzMyNSw2
IEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJaTkx
NV92bWFfdW5waW5fZmVuY2Uodm1hKTsKIGVycl91bnBpbjoKIAlfX2k5MTVfdm1hX3VucGluKHZt
YSk7Ci1lcnJfdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogZXJy
X3Jlc2V0OgogCWludGVsX2d0X3Jlc2V0X3VubG9jayhnZ3R0LT52bS5ndCwgc3JjdSk7CiBlcnJf
cnBtOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVj
dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCmluZGV4IDBl
ZjYwZGFlMjNhNy4uZGJmOWJlOWE3OWY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX29iamVjdC5jCkBAIC0xNTUsMjEgKzE1NSwzMCBAQCBzdGF0aWMgdm9pZCBfX2k5MTVf
Z2VtX2ZyZWVfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCXdha2Vy
ZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAJbGxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZShvYmosIG9uLCBmcmVlZCwgZnJlZWQpIHsKLQkJc3RydWN0IGk5MTVf
dm1hICp2bWEsICp2bjsKLQogCQl0cmFjZV9pOTE1X2dlbV9vYmplY3RfZGVzdHJveShvYmopOwog
Ci0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JCWxpc3RfZm9yX2Vh
Y2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmb2JqLT52bWEubGlzdCwgb2JqX2xpbmspIHsKLQkJCUdF
TV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwotCQkJYXRvbWljX2FuZCh+STkxNV9W
TUFfUElOX01BU0ssICZ2bWEtPmZsYWdzKTsKLQkJCWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwkJ
aWYgKCFsaXN0X2VtcHR5KCZvYmotPnZtYS5saXN0KSkgeworCQkJc3RydWN0IGk5MTVfdm1hICp2
bWE7CisKKwkJCS8qCisJCQkgKiBOb3RlIHRoYXQgdGhlIHZtYSBrZWVwcyBhbiBvYmplY3QgcmVm
ZXJlbmNlIHdoaWxlCisJCQkgKiBpdCBpcyBhY3RpdmUsIHNvIGl0ICpzaG91bGQqIG5vdCBzbGVl
cCB3aGlsZSB3ZQorCQkJICogZGVzdHJveSBpdC4gT3VyIGRlYnVnIGNvZGUgZXJycyBpbnNpdHMg
aXQgKm1pZ2h0Ki4KKwkJCSAqIEZvciB0aGUgbW9tZW50LCBwbGF5IGFsb25nLgorCQkJICovCisJ
CQlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOworCQkJd2hpbGUgKCh2bWEgPSBsaXN0X2ZpcnN0
X2VudHJ5X29yX251bGwoJm9iai0+dm1hLmxpc3QsCisJCQkJCQkJICAgICAgIHN0cnVjdCBpOTE1
X3ZtYSwKKwkJCQkJCQkgICAgICAgb2JqX2xpbmspKSkgeworCQkJCUdFTV9CVUdfT04odm1hLT5v
YmogIT0gb2JqKTsKKwkJCQlzcGluX3VubG9jaygmb2JqLT52bWEubG9jayk7CisKKwkJCQlpOTE1
X3ZtYV9kZXN0cm95KHZtYSk7CisKKwkJCQlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOworCQkJ
fQorCQkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCQl9Ci0JCUdFTV9CVUdfT04oIWxp
c3RfZW1wdHkoJm9iai0+dm1hLmxpc3QpKTsKLQkJR0VNX0JVR19PTighUkJfRU1QVFlfUk9PVCgm
b2JqLT52bWEudHJlZSkpOwotCi0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIAkJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmb2JqLT5iaW5kX2NvdW50KSk7CiAJCUdF
TV9CVUdfT04ob2JqLT51c2VyZmF1bHRfY291bnQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX29iamVjdC5oCmluZGV4IDI5YjllZGRjNGM3Zi4uYTc4YWYyNWRjZTM2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0xMDYsNiArMTA2
LDExIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9vYmplY3RfbG9jayhzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWRtYV9yZXN2X2xvY2sob2JqLT5iYXNlLnJlc3YsIE5V
TEwpOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9nZW1fb2JqZWN0X3RyeWxvY2soc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlyZXR1cm4gZG1hX3Jlc3ZfdHJ5bG9j
ayhvYmotPmJhc2UucmVzdik7Cit9CisKIHN0YXRpYyBpbmxpbmUgaW50CiBpOTE1X2dlbV9vYmpl
Y3RfbG9ja19pbnRlcnJ1cHRpYmxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCmluZGV4IGQy
YzA1ZDc1MjkwOS4uZmQzY2U2ZGE4NDk3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fc2hyaW5rZXIuYwpAQCAtMTYsNDAgKzE2LDYgQEAKIAogI2luY2x1ZGUgImk5MTVf
dHJhY2UuaCIKIAotc3RhdGljIGJvb2wgc2hyaW5rZXJfbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKLQkJCSAgdW5zaWduZWQgaW50IGZsYWdzLAotCQkJICBib29sICp1bmxvY2sp
Ci17Ci0Jc3RydWN0IG11dGV4ICptID0gJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXg7Ci0KLQlzd2l0
Y2ggKG11dGV4X3RyeWxvY2tfcmVjdXJzaXZlKG0pKSB7Ci0JY2FzZSBNVVRFWF9UUllMT0NLX1JF
Q1VSU0lWRToKLQkJKnVubG9jayA9IGZhbHNlOwotCQlyZXR1cm4gdHJ1ZTsKLQotCWNhc2UgTVVU
RVhfVFJZTE9DS19GQUlMRUQ6Ci0JCSp1bmxvY2sgPSBmYWxzZTsKLQkJaWYgKGZsYWdzICYgSTkx
NV9TSFJJTktfQUNUSVZFICYmCi0JCSAgICBtdXRleF9sb2NrX2tpbGxhYmxlX25lc3RlZChtLCBJ
OTE1X01NX1NIUklOS0VSKSA9PSAwKQotCQkJKnVubG9jayA9IHRydWU7Ci0JCXJldHVybiAqdW5s
b2NrOwotCi0JY2FzZSBNVVRFWF9UUllMT0NLX1NVQ0NFU1M6Ci0JCSp1bmxvY2sgPSB0cnVlOwot
CQlyZXR1cm4gdHJ1ZTsKLQl9Ci0KLQlCVUcoKTsKLX0KLQotc3RhdGljIHZvaWQgc2hyaW5rZXJf
dW5sb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29sIHVubG9jaykKLXsKLQlp
ZiAoIXVubG9jaykKLQkJcmV0dXJuOwotCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLX0KLQogc3RhdGljIGJvb2wgc3dhcF9hdmFpbGFibGUodm9pZCkKIHsKIAlyZXR1
cm4gZ2V0X25yX3N3YXBfcGFnZXMoKSA+IDA7CkBAIC0xNTUsMTAgKzEyMSw2IEBAIGk5MTVfZ2Vt
X3NocmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpbnRlbF93YWtlcmVmX3Qg
d2FrZXJlZiA9IDA7CiAJdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7CiAJdW5zaWduZWQgbG9uZyBz
Y2FubmVkID0gMDsKLQlib29sIHVubG9jazsKLQotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCBz
aHJpbmssICZ1bmxvY2spKQotCQlyZXR1cm4gMDsKIAogCS8qCiAJICogV2hlbiBzaHJpbmtpbmcg
dGhlIGFjdGl2ZSBsaXN0LCB3ZSBzaG91bGQgYWxzbyBjb25zaWRlciBhY3RpdmUKQEAgLTI2OCw4
ICsyMzAsNiBAQCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJaWYgKHNocmluayAmIEk5MTVfU0hSSU5LX0JPVU5EKQogCQlpbnRlbF9ydW50aW1lX3BtX3B1
dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAKLQlzaHJpbmtlcl91bmxvY2soaTkxNSwg
dW5sb2NrKTsKLQogCWlmIChucl9zY2FubmVkKQogCQkqbnJfc2Nhbm5lZCArPSBzY2FubmVkOwog
CXJldHVybiBjb3VudDsKQEAgLTMzOSwxOSArMjk5LDE0IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3Nj
YW4oc3RydWN0IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9sICpzYykK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNvbnRhaW5lcl9vZihzaHJpbmtl
ciwgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUsIG1tLnNocmlua2VyKTsKIAl1bnNpZ25lZCBsb25n
IGZyZWVkOwotCWJvb2wgdW5sb2NrOwogCiAJc2MtPm5yX3NjYW5uZWQgPSAwOwogCi0JaWYgKCFz
aHJpbmtlcl9sb2NrKGk5MTUsIDAsICZ1bmxvY2spKQotCQlyZXR1cm4gU0hSSU5LX1NUT1A7Ci0K
IAlmcmVlZCA9IGk5MTVfZ2VtX3NocmluayhpOTE1LAogCQkJCXNjLT5ucl90b19zY2FuLAogCQkJ
CSZzYy0+bnJfc2Nhbm5lZCwKIAkJCQlJOTE1X1NIUklOS19CT1VORCB8Ci0JCQkJSTkxNV9TSFJJ
TktfVU5CT1VORCB8Ci0JCQkJSTkxNV9TSFJJTktfV1JJVEVCQUNLKTsKKwkJCQlJOTE1X1NIUklO
S19VTkJPVU5EKTsKIAlpZiAoc2MtPm5yX3NjYW5uZWQgPCBzYy0+bnJfdG9fc2NhbiAmJiBjdXJy
ZW50X2lzX2tzd2FwZCgpKSB7CiAJCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCkBAIC0zNjYs
OCArMzIxLDYgQEAgaTkxNV9nZW1fc2hyaW5rZXJfc2NhbihzdHJ1Y3Qgc2hyaW5rZXIgKnNocmlu
a2VyLCBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQogCQl9CiAJfQogCi0Jc2hyaW5rZXJfdW5s
b2NrKGk5MTUsIHVubG9jayk7Ci0KIAlyZXR1cm4gc2MtPm5yX3NjYW5uZWQgPyBmcmVlZCA6IFNI
UklOS19TVE9QOwogfQogCkBAIC0zODQsNiArMzM3LDcgQEAgaTkxNV9nZW1fc2hyaW5rZXJfb29t
KHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVuc2lnbmVkIGxvbmcgZXZlbnQsIHZvaWQgKnB0
cikKIAlmcmVlZF9wYWdlcyA9IDA7CiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZpOTE1LT5ydW50
aW1lX3BtLCB3YWtlcmVmKQogCQlmcmVlZF9wYWdlcyArPSBpOTE1X2dlbV9zaHJpbmsoaTkxNSwg
LTFVTCwgTlVMTCwKKwkJCQkJICAgICAgIEk5MTVfU0hSSU5LX0FDVElWRSB8CiAJCQkJCSAgICAg
ICBJOTE1X1NIUklOS19CT1VORCB8CiAJCQkJCSAgICAgICBJOTE1X1NIUklOS19VTkJPVU5EIHwK
IAkJCQkJICAgICAgIEk5MTVfU0hSSU5LX1dSSVRFQkFDSyk7CkBAIC00MTksMTAgKzM3Myw2IEBA
IGk5MTVfZ2VtX3Nocmlua2VyX3ZtYXAoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwgdW5zaWdu
ZWQgbG9uZyBldmVudCwgdm9pZCAqcHRyCiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICpuZXh0Owog
CXVuc2lnbmVkIGxvbmcgZnJlZWRfcGFnZXMgPSAwOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVm
OwotCWJvb2wgdW5sb2NrOwotCi0JaWYgKCFzaHJpbmtlcl9sb2NrKGk5MTUsIDAsICZ1bmxvY2sp
KQotCQlyZXR1cm4gTk9USUZZX0RPTkU7CiAKIAl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmk5MTUt
PnJ1bnRpbWVfcG0sIHdha2VyZWYpCiAJCWZyZWVkX3BhZ2VzICs9IGk5MTVfZ2VtX3Nocmluayhp
OTE1LCAtMVVMLCBOVUxMLApAQCAtNDM5LDE1ICszODksMTEgQEAgaTkxNV9nZW1fc2hyaW5rZXJf
dm1hcChzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25lZCBsb25nIGV2ZW50LCB2b2lk
ICpwdHIKIAkJaWYgKCF2bWEtPmlvbWFwIHx8IGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKQogCQkJ
Y29udGludWU7CiAKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKLQkJaWYg
KGk5MTVfdm1hX3VuYmluZCh2bWEpID09IDApCisJCWlmIChfX2k5MTVfdm1hX3VuYmluZCh2bWEp
ID09IDApCiAJCQlmcmVlZF9wYWdlcyArPSBjb3VudDsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+Z2d0
dC52bS5tdXRleCk7CiAJfQogCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAK
LQlzaHJpbmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCSoodW5zaWduZWQgbG9uZyAqKXB0
ciArPSBmcmVlZF9wYWdlczsKIAlyZXR1cm4gTk9USUZZX0RPTkU7CiB9CkBAIC00OTAsMjIgKzQz
Niw5IEBAIHZvaWQgaTkxNV9nZW1fc2hyaW5rZXJfdGFpbnRzX211dGV4KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCiAJZnNfcmVjbGFpbV9hY3F1aXJlKEdGUF9LRVJORUwpOwogCi0J
LyoKLQkgKiBBcyB3ZSBpbnZhcmlhYmx5IHJlbHkgb24gdGhlIHN0cnVjdF9tdXRleCB3aXRoaW4g
dGhlIHNocmlua2VyLAotCSAqIGJ1dCBoYXZlIGEgY29tcGxpY2F0ZWQgcmVjdXJzaW9uIGRhbmNl
LCB0YWludCBhbGwgdGhlIG11dGV4ZXMgdXNlZAotCSAqIHdpdGhpbiB0aGUgc2hyaW5rZXIgd2l0
aCB0aGUgc3RydWN0X211dGV4LiBGb3IgY29tcGxldGVuZXNzLCB3ZQotCSAqIHRhaW50IHdpdGgg
YWxsIHN1YmNsYXNzIG9mIHN0cnVjdF9tdXRleCwgZXZlbiB0aG91Z2ggd2Ugc2hvdWxkCi0JICog
b25seSBuZWVkIHRhaW50aW5nIGJ5IEk5MTVfTU1fTk9STUFMIHRvIGNhdGNoIHBvc3NpYmxlIEFC
QkEKLQkgKiBkZWFkbG9ja3MgZnJvbSB1c2luZyBzdHJ1Y3RfbXV0ZXggaW5zaWRlIEBtdXRleC4K
LQkgKi8KLQltdXRleF9hY3F1aXJlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4LmRlcF9tYXAsCi0J
CSAgICAgIEk5MTVfTU1fU0hSSU5LRVIsIDAsIF9SRVRfSVBfKTsKLQogCW11dGV4X2FjcXVpcmUo
Jm11dGV4LT5kZXBfbWFwLCAwLCAwLCBfUkVUX0lQXyk7CiAJbXV0ZXhfcmVsZWFzZSgmbXV0ZXgt
PmRlcF9tYXAsIDAsIF9SRVRfSVBfKTsKIAotCW11dGV4X3JlbGVhc2UoJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXguZGVwX21hcCwgMCwgX1JFVF9JUF8pOwotCiAJZnNfcmVjbGFpbV9yZWxlYXNlKEdG
UF9LRVJORUwpOwogCiAJaWYgKHVubG9jaykKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9zdG9sZW4uYwppbmRleCBlNDVlYjg3MjE4NTAuLmZhZDk4YTkyMWNkZSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYwpAQCAtNjI0LDggKzYyNCw2IEBA
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2CiAJaWYgKCFkcm1fbW1faW5pdGlhbGl6ZWQoJmRldl9w
cml2LT5tbS5zdG9sZW4pKQogCQlyZXR1cm4gTlVMTDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQogCURSTV9ERUJVR19EUklWRVIoImNyZWF0
aW5nIHByZWFsbG9jYXRlZCBzdG9sZW4gb2JqZWN0OiBzdG9sZW5fb2Zmc2V0PSVwYSwgZ3R0X29m
ZnNldD0lcGEsIHNpemU9JXBhXG4iLAogCQkJICZzdG9sZW5fb2Zmc2V0LCAmZ3R0X29mZnNldCwg
JnNpemUpOwogCkBAIC02NzcsMjEgKzY3NSwyNSBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0
b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgog
CSAqIHNldHRpbmcgdXAgdGhlIEdUVCBzcGFjZS4gVGhlIGFjdHVhbCByZXNlcnZhdGlvbiB3aWxs
IG9jY3VyCiAJICogbGF0ZXIuCiAJICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CXJldCA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkg
ICBzaXplLCBndHRfb2Zmc2V0LCBvYmotPmNhY2hlX2xldmVsLAogCQkJCSAgIDApOwogCWlmIChy
ZXQpIHsKIAkJRFJNX0RFQlVHX0RSSVZFUigiZmFpbGVkIHRvIGFsbG9jYXRlIHN0b2xlbiBHVFQg
c3BhY2VcbiIpOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZ290byBlcnJf
cGFnZXM7CiAJfQogCiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKTsKIAorCUdFTV9CVUdfT04odm1hLT5wYWdlcyk7CiAJdm1hLT5wYWdlcyA9IG9iai0+bW0u
cGFnZXM7CisJYXRvbWljX3NldCgmdm1hLT5wYWdlc19jb3VudCwgSTkxNV9WTUFfUEFHRVNfQUNU
SVZFKTsKKwogCXNldF9iaXQoSTkxNV9WTUFfR0xPQkFMX0JJTkRfQklULCBfX2k5MTVfdm1hX2Zs
YWdzKHZtYSkpOwogCV9faTkxNV92bWFfc2V0X21hcF9hbmRfZmVuY2VhYmxlKHZtYSk7CiAKLQlt
dXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJbGlzdF9hZGRfdGFpbCgmdm1hLT52bV9saW5r
LCAmZ2d0dC0+dm0uYm91bmRfbGlzdCk7CiAJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYwppbmRleCBlNWQx
YWU4ZDRkYmEuLmRjMmE4M2NlNDRkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3RpbGluZy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV90aWxpbmcuYwpAQCAtMTgxLDIyICsxODEsMjUgQEAgc3RhdGljIGludAogaTkxNV9nZW1f
b2JqZWN0X2ZlbmNlX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJ
CSAgICAgIGludCB0aWxpbmdfbW9kZSwgdW5zaWduZWQgaW50IHN0cmlkZSkKIHsKKwlzdHJ1Y3Qg
aTkxNV9nZ3R0ICpnZ3R0ID0gJnRvX2k5MTUob2JqLT5iYXNlLmRldiktPmdndHQ7CiAJc3RydWN0
IGk5MTVfdm1hICp2bWE7Ci0JaW50IHJldDsKKwlpbnQgcmV0ID0gMDsKIAogCWlmICh0aWxpbmdf
bW9kZSA9PSBJOTE1X1RJTElOR19OT05FKQogCQlyZXR1cm4gMDsKIAorCW11dGV4X2xvY2soJmdn
dHQtPnZtLm11dGV4KTsKIAlmb3JfZWFjaF9nZ3R0X3ZtYSh2bWEsIG9iaikgewogCQlpZiAoaTkx
NV92bWFfZmVuY2VfcHJlcGFyZSh2bWEsIHRpbGluZ19tb2RlLCBzdHJpZGUpKQogCQkJY29udGlu
dWU7CiAKLQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCXJldCA9IF9faTkxNV92bWFf
dW5iaW5kKHZtYSk7CiAJCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OworCQkJYnJlYWs7CiAJfQor
CW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCi0JcmV0dXJuIDA7CisJcmV0dXJuIHJl
dDsKIH0KIAogaW50CkBAIC0yMTIsNyArMjE1LDYgQEAgaTkxNV9nZW1fb2JqZWN0X3NldF90aWxp
bmcoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogCUdFTV9CVUdfT04oIWk5MTVf
dGlsaW5nX29rKG9iaiwgdGlsaW5nLCBzdHJpZGUpKTsKIAlHRU1fQlVHX09OKCFzdHJpZGUgXiAo
dGlsaW5nID09IEk5MTVfVElMSU5HX05PTkUpKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWlmICgodGlsaW5nIHwgc3RyaWRlKSA9PSBvYmotPnRp
bGluZ19hbmRfc3RyaWRlKQogCQlyZXR1cm4gMDsKQEAgLTIzMywxNiArMjM1LDE4IEBAIGk5MTVf
Z2VtX29iamVjdF9zZXRfdGlsaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
ICogd2hpbHN0IGV4ZWN1dGluZyBhIGZlbmNlZCBjb21tYW5kIGZvciBhbiB1bnRpbGVkIG9iamVj
dC4KIAkgKi8KIAotCWVyciA9IGk5MTVfZ2VtX29iamVjdF9mZW5jZV9wcmVwYXJlKG9iaiwgdGls
aW5nLCBzdHJpZGUpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KIAlpOTE1X2dlbV9vYmpl
Y3RfbG9jayhvYmopOwogCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfZnJhbWVidWZmZXIob2JqKSkg
ewogCQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CiAJCXJldHVybiAtRUJVU1k7CiAJfQog
CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2ZlbmNlX3ByZXBhcmUob2JqLCB0aWxpbmcsIHN0cmlk
ZSk7CisJaWYgKGVycikgeworCQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CisJCXJldHVy
biBlcnI7CisJfQorCiAJLyogSWYgdGhlIG1lbW9yeSBoYXMgdW5rbm93biAoaS5lLiB2YXJ5aW5n
KSBzd2l6emxpbmcsIHdlIHBpbiB0aGUKIAkgKiBwYWdlcyB0byBwcmV2ZW50IHRoZW0gYmVpbmcg
c3dhcHBlZCBvdXQgYW5kIGNhdXNpbmcgY29ycnVwdGlvbgogCSAqIGR1ZSB0byB0aGUgY2hhbmdl
IGluIHN3aXp6bGluZy4KQEAgLTM2OCwxMiArMzcyLDcgQEAgaTkxNV9nZW1fc2V0X3RpbGluZ19p
b2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQl9CiAJfQogCi0JZXJy
ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVy
cikKLQkJZ290byBlcnI7Ci0KIAllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhvYmos
IGFyZ3MtPnRpbGluZ19tb2RlLCBhcmdzLT5zdHJpZGUpOwotCW11dGV4X3VubG9jaygmZGV2LT5z
dHJ1Y3RfbXV0ZXgpOwogCiAJLyogV2UgaGF2ZSB0byBtYWludGFpbiB0aGlzIGV4aXN0aW5nIEFC
SS4uLiAqLwogCWFyZ3MtPnN0cmlkZSA9IGk5MTVfZ2VtX29iamVjdF9nZXRfc3RyaWRlKG9iaik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwppbmRleCAxMWIy
MzFjMTg3YzUuLjI3NTczZWY5MDNiNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3VzZXJwdHIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fdXNlcnB0ci5jCkBAIC05Miw3ICs5Miw2IEBAIHVzZXJwdHJfbW5faW52YWxpZGF0ZV9y
YW5nZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJc3RydWN0IGk5MTVfbW11X25v
dGlmaWVyICptbiA9CiAJCWNvbnRhaW5lcl9vZihfbW4sIHN0cnVjdCBpOTE1X21tdV9ub3RpZmll
ciwgbW4pOwogCXN0cnVjdCBpbnRlcnZhbF90cmVlX25vZGUgKml0OwotCXN0cnVjdCBtdXRleCAq
dW5sb2NrID0gTlVMTDsKIAl1bnNpZ25lZCBsb25nIGVuZDsKIAlpbnQgcmV0ID0gMDsKIApAQCAt
MTI5LDMzICsxMjgsMTMgQEAgdXNlcnB0cl9tbl9pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0KHN0cnVj
dCBtbXVfbm90aWZpZXIgKl9tbiwKIAkJfQogCQlzcGluX3VubG9jaygmbW4tPmxvY2spOwogCi0J
CWlmICghdW5sb2NrKSB7Ci0JCQl1bmxvY2sgPSAmbW4tPm1tLT5pOTE1LT5kcm0uc3RydWN0X211
dGV4OwotCi0JCQlzd2l0Y2ggKG11dGV4X3RyeWxvY2tfcmVjdXJzaXZlKHVubG9jaykpIHsKLQkJ
CWRlZmF1bHQ6Ci0JCQljYXNlIE1VVEVYX1RSWUxPQ0tfRkFJTEVEOgotCQkJCWlmIChtdXRleF9s
b2NrX2tpbGxhYmxlX25lc3RlZCh1bmxvY2ssIEk5MTVfTU1fU0hSSU5LRVIpKSB7Ci0JCQkJCWk5
MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQkJCQkJcmV0dXJuIC1FSU5UUjsKLQkJCQl9Ci0JCQkJ
LyogZmFsbCB0aHJvdWdoICovCi0JCQljYXNlIE1VVEVYX1RSWUxPQ0tfU1VDQ0VTUzoKLQkJCQli
cmVhazsKLQotCQkJY2FzZSBNVVRFWF9UUllMT0NLX1JFQ1VSU0lWRToKLQkJCQl1bmxvY2sgPSBF
UlJfUFRSKC1FRVhJU1QpOwotCQkJCWJyZWFrOwotCQkJfQotCQl9Ci0KIAkJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X3VuYmluZChvYmosCiAJCQkJCSAgICAgSTkxNV9HRU1fT0JKRUNUX1VOQklORF9B
Q1RJVkUpOwogCQlpZiAocmV0ID09IDApCiAJCQlyZXQgPSBfX2k5MTVfZ2VtX29iamVjdF9wdXRf
cGFnZXMob2JqLCBJOTE1X01NX1NIUklOS0VSKTsKIAkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmop
OwogCQlpZiAocmV0KQotCQkJZ290byB1bmxvY2s7CisJCQlyZXR1cm4gcmV0OwogCiAJCXNwaW5f
bG9jaygmbW4tPmxvY2spOwogCkBAIC0xNjgsMTAgKzE0Nyw2IEBAIHVzZXJwdHJfbW5faW52YWxp
ZGF0ZV9yYW5nZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJfQogCXNwaW5fdW5s
b2NrKCZtbi0+bG9jayk7CiAKLXVubG9jazoKLQlpZiAoIUlTX0VSUl9PUl9OVUxMKHVubG9jaykp
Ci0JCW11dGV4X3VubG9jayh1bmxvY2spOwotCiAJcmV0dXJuIHJldDsKIAogfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwppbmRleCBjNWNlYTQz
NzkyMTYuLjk4YjJhNmNjZmNjMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9odWdlX3BhZ2VzLmMKQEAgLTMzMyw3ICszMzMsMTIgQEAgc3RhdGljIGludCBpZ3Rf
Y2hlY2tfcGFnZV9zaXplcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHZtYS0+dm0tPmk5MTU7CiAJdW5zaWduZWQgaW50IHN1cHBvcnRlZCA9
IElOVEVMX0lORk8oaTkxNSktPnBhZ2Vfc2l6ZXM7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiA9IHZtYS0+b2JqOwotCWludCBlcnIgPSAwOworCWludCBlcnI7CisKKwkvKiBXZSBo
YXZlIHRvIHdhaXQgZm9yIHRoZSBhc3luYyBiaW5kIHRvIGNvbXBsZXRlIGJlZm9yZSBvdXIgYXNz
ZXJ0cyAqLworCWVyciA9IGk5MTVfdm1hX3N5bmModm1hKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4g
ZXJyOwogCiAJaWYgKCFIQVNfUEFHRV9TSVpFUyhpOTE1LCB2bWEtPnBhZ2Vfc2l6ZXMuc2cpKSB7
CiAJCXByX2VycigidW5zdXBwb3J0ZWQgcGFnZV9zaXplcy5zZz0ldSwgc3VwcG9ydGVkPSV1XG4i
LApAQCAtMTM5MCw3ICsxMzk1LDcgQEAgc3RhdGljIGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2
b2lkICphcmcpCiAJCQlnb3RvIG91dF91bnBpbjsKIAkJfQogCi0JCWVyciA9IGk5MTVfdm1hX2Jp
bmQodm1hLCBJOTE1X0NBQ0hFX05PTkUsIFBJTl9VUERBVEUpOworCQllcnIgPSBpOTE1X3ZtYV9i
aW5kKHZtYSwgSTkxNV9DQUNIRV9OT05FLCBQSU5fVVBEQVRFLCBOVUxMKTsKIAkJaWYgKGVycikK
IAkJCWdvdG8gb3V0X3VucGluOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGRjMjViY2MzZTM3Mi4uNmVmM2Q3
NDVkYzhkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5
MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtNzQ3LDEwICs3NDcsNyBAQCBlbWl0X3JwY3NfcXVlcnko
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAoZXJyKQogCQlnb3RvIHNraXBf
cmVxdWVzdDsKIAotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsKLQlpOTE1X3ZtYV9jbG9zZShiYXRj
aCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKLQorCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNl
KCZiYXRjaCwgMCk7CiAJaTkxNV92bWFfdW5waW4odm1hKTsKIAogCSpycV9vdXQgPSBpOTE1X3Jl
cXVlc3RfZ2V0KHJxKTsKQEAgLTc2NCw4ICs3NjEsNyBAQCBlbWl0X3JwY3NfcXVlcnkoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIGVycl9yZXF1ZXN0OgogCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOwogZXJyX2JhdGNoOgotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsKLQlpOTE1X3ZtYV9w
dXQoYmF0Y2gpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZiYXRjaCwgMCk7CiBlcnJf
dm1hOgogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAKQEAgLTEzMDksOSArMTMwNSw3IEBAIHN0YXRp
YyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCWlm
IChlcnIpCiAJCWdvdG8gc2tpcF9yZXF1ZXN0OwogCi0JaTkxNV92bWFfdW5waW4odm1hKTsKLQlp
OTE1X3ZtYV9jbG9zZSh2bWEpOwotCWk5MTVfdm1hX3B1dCh2bWEpOworCWk5MTVfdm1hX3VucGlu
X2FuZF9yZWxlYXNlKCZ2bWEsIDApOwogCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKaW5k
ZXggYWVmZTU1NzUyN2Y4Li4zNmFjYTFjMTcyZTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCkBAIC0zMjIsNyArMzIyLDYgQEAg
c3RhdGljIGludCBpZ3RfcGFydGlhbF90aWxpbmcodm9pZCAqYXJnKQogCQlnb3RvIG91dDsKIAl9
CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50
ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJaWYgKDEpIHsKQEAgLTQx
NSw3ICs0MTQsNiBAQCBuZXh0X3RpbGluZzogOwogCiBvdXRfdW5sb2NrOgogCWludGVsX3J1bnRp
bWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
Owogb3V0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKQEAgLTQ1OCw3ICs0NTYsNiBAQCBz
dGF0aWMgaW50IGlndF9zbW9rZV90aWxpbmcodm9pZCAqYXJnKQogCQlnb3RvIG91dDsKIAl9CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJY291bnQgPSAwOwpAQCAtNTA4
LDcgKzUwNSw2IEBAIHN0YXRpYyBpbnQgaWd0X3Ntb2tlX3RpbGluZyh2b2lkICphcmcpCiAJcHJf
aW5mbygiJXM6IENvbXBsZXRlZCAlbHUgdHJpYWxzXG4iLCBfX2Z1bmNfXywgY291bnQpOwogCiAJ
aW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaTkxNV9nZW1fb2JqZWN0X3VucGlu
X3BhZ2VzKG9iaik7CiBvdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYwppbmRleCBl
ZTVkYzEzYTMwYjMuLjY3MThkYTIwZjM1ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMKQEAgLTE1NCw5ICsxNTQsNyBAQCBpbnQg
aWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAogCWk5MTVfcmVxdWVz
dF9hZGQocnEpOwogCi0JaTkxNV92bWFfdW5waW4oYmF0Y2gpOwotCWk5MTVfdm1hX2Nsb3NlKGJh
dGNoKTsKLQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNl
KCZiYXRjaCwgMCk7CiAKIAlyZXR1cm4gMDsKIApAQCAtMTY1LDcgKzE2Myw2IEBAIGludCBpZ3Rf
Z3B1X2ZpbGxfZHcoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogZXJyX3JlcXVlc3Q6CiAJaTkx
NV9yZXF1ZXN0X2FkZChycSk7CiBlcnJfYmF0Y2g6Ci0JaTkxNV92bWFfdW5waW4oYmF0Y2gpOwot
CWk5MTVfdm1hX3B1dChiYXRjaCk7CisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmJhdGNo
LCAwKTsKIAlyZXR1cm4gZXJyOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXgg
ZWVmOWJkYWU4ZWJiLi45NWU2N2RiNTI2NjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Qu
YwpAQCAtMzAxLDExICszMDEsMTIgQEAgdm9pZCBpbnRlbF9ndF9mbHVzaF9nZ3R0X3dyaXRlcyhz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZpOTE1LT5ydW50
aW1lX3BtLCB3YWtlcmVmKSB7CiAJCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51
bmNvcmU7CisJCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKLQkJc3Bpbl9sb2NrX2lycSgmdW5jb3Jl
LT5sb2NrKTsKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJnVuY29yZS0+bG9jaywgZmxhZ3MpOwogCQlp
bnRlbF91bmNvcmVfcG9zdGluZ19yZWFkX2Z3KHVuY29yZSwKIAkJCQkJICAgICBSSU5HX0hFQUQo
UkVOREVSX1JJTkdfQkFTRSkpOwotCQlzcGluX3VubG9ja19pcnEoJnVuY29yZS0+bG9jayk7CisJ
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnVuY29yZS0+bG9jaywgZmxhZ3MpOwogCX0KIH0KIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCmluZGV4IDA3NDdiOGM5
Zjc2OC4uZWMzMjk5NjI1NGMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z2J1ZmZlci5jCkBAIC0xMzM4LDE1ICsxMzM4LDEzIEBAIHZvaWQgaW50ZWxfcmluZ19mcmVlKHN0
cnVjdCBrcmVmICpyZWYpCiB7CiAJc3RydWN0IGludGVsX3JpbmcgKnJpbmcgPSBjb250YWluZXJf
b2YocmVmLCB0eXBlb2YoKnJpbmcpLCByZWYpOwogCi0JaTkxNV92bWFfY2xvc2UocmluZy0+dm1h
KTsKIAlpOTE1X3ZtYV9wdXQocmluZy0+dm1hKTsKLQogCWtmcmVlKHJpbmcpOwogfQogCiBzdGF0
aWMgdm9pZCBfX3JpbmdfY29udGV4dF9maW5pKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsK
LQlpOTE1X2dlbV9vYmplY3RfcHV0KGNlLT5zdGF0ZS0+b2JqKTsKKwlpOTE1X3ZtYV9wdXQoY2Ut
PnN0YXRlKTsKIH0KIAogc3RhdGljIHZvaWQgcmluZ19jb250ZXh0X2Rlc3Ryb3koc3RydWN0IGty
ZWYgKnJlZikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hh
bmdjaGVjay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMK
aW5kZXggYTAwOThmYzM1OTIxLi5lNTNlZWExMDUwZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCkBAIC0xMTI3LDE1ICsxMTI3LDE0IEBAIHN0YXRp
YyBpbnQgZXZpY3Rfdm1hKHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGV2aWN0X3ZtYSAqYXJnID0g
ZGF0YTsKIAlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGFyZy0+dm1hLT52bTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZtLT5pOTE1OwogCXN0cnVjdCBkcm1fbW1f
bm9kZSBldmljdCA9IGFyZy0+dm1hLT5ub2RlOwogCWludCBlcnI7CiAKIAljb21wbGV0ZSgmYXJn
LT5jb21wbGV0aW9uKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CW11dGV4X2xvY2soJnZtLT5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUo
dm0sICZldmljdCwgMCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
KwltdXRleF91bmxvY2soJnZtLT5tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTE0Mywz
OSArMTE0MiwzMyBAQCBzdGF0aWMgaW50IGV2aWN0X3ZtYSh2b2lkICpkYXRhKQogc3RhdGljIGlu
dCBldmljdF9mZW5jZSh2b2lkICpkYXRhKQogewogCXN0cnVjdCBldmljdF92bWEgKmFyZyA9IGRh
dGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmctPnZtYS0+dm0tPmk5MTU7
CiAJaW50IGVycjsKIAogCWNvbXBsZXRlKCZhcmctPmNvbXBsZXRpb24pOwogCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAkvKiBNYXJrIHRoZSBmZW5jZSByZWdpc3Rl
ciBhcyBkaXJ0eSB0byBmb3JjZSB0aGUgbW1pbyB1cGRhdGUuICovCiAJZXJyID0gaTkxNV9nZW1f
b2JqZWN0X3NldF90aWxpbmcoYXJnLT52bWEtPm9iaiwgSTkxNV9USUxJTkdfWSwgNTEyKTsKIAlp
ZiAoZXJyKSB7CiAJCXByX2VycigiSW52YWxpZCBZLXRpbGluZyBzZXR0aW5nczsgZXJyOiVkXG4i
LCBlcnIpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCXJldHVybiBlcnI7CiAJfQogCiAJZXJyID0g
aTkxNV92bWFfcGluKGFyZy0+dm1hLCAwLCAwLCBQSU5fR0xPQkFMIHwgUElOX01BUFBBQkxFKTsK
IAlpZiAoZXJyKSB7CiAJCXByX2VycigiVW5hYmxlIHRvIHBpbiB2bWEgZm9yIFktdGlsZWQgZmVu
Y2U7IGVycjolZFxuIiwgZXJyKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4gZXJyOwog
CX0KIAogCWVyciA9IGk5MTVfdm1hX3Bpbl9mZW5jZShhcmctPnZtYSk7CiAJaTkxNV92bWFfdW5w
aW4oYXJnLT52bWEpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJVbmFibGUgdG8gcGluIFktdGls
ZWQgZmVuY2U7IGVycjolZFxuIiwgZXJyKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4g
ZXJyOwogCX0KIAogCWk5MTVfdm1hX3VucGluX2ZlbmNlKGFyZy0+dm1hKTsKIAotb3V0X3VubG9j
azoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIGVy
cjsKKwlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBfX2lndF9yZXNldF9ldmljdF92bWEoc3Ry
dWN0IGludGVsX2d0ICpndCwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9h
cGVydHVyZV9nbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMKaW5k
ZXggNWZmMjQzN2IyOTk4Li5kOTk2YmJjN2VhNTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC9hcGVydHVyZV9nbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9h
cGVydHVyZV9nbS5jCkBAIC02MSwxNCArNjEsMTQgQEAgc3RhdGljIGludCBhbGxvY19nbShzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSwgYm9vbCBoaWdoX2dtKQogCQlmbGFncyA9IFBJTl9NQVBQQUJM
RTsKIAl9CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0
ZXhfbG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCW1taW9faHdfYWNjZXNzX3ByZShk
ZXZfcHJpdik7CiAJcmV0ID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZGV2X3ByaXYtPmdndHQudm0s
IG5vZGUsCiAJCQkJICBzaXplLCBJOTE1X0dUVF9QQUdFX1NJWkUsCiAJCQkJICBJOTE1X0NPTE9S
X1VORVZJQ1RBQkxFLAogCQkJCSAgc3RhcnQsIGVuZCwgZmxhZ3MpOwogCW1taW9faHdfYWNjZXNz
X3Bvc3QoZGV2X3ByaXYpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCWlmIChyZXQp
CiAJCWd2dF9lcnIoImZhaWwgdG8gYWxsb2MgJXMgZ20gc3BhY2UgZnJvbSBob3N0XG4iLAogCQkJ
aGlnaF9nbSA/ICJoaWdoIiA6ICJsb3ciKTsKQEAgLTk4LDkgKzk4LDkgQEAgc3RhdGljIGludCBh
bGxvY192Z3B1X2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCiAJcmV0dXJuIDA7CiBvdXRf
ZnJlZV9hcGVydHVyZToKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCWRybV9tbV9yZW1vdmVf
bm9kZSgmdmdwdS0+Z20ubG93X2dtX25vZGUpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgp
OwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTEwOCwxMCArMTA4LDEwIEBAIHN0YXRpYyB2b2lkIGZy
ZWVfdmdwdV9nbShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OwogCi0JbXV0ZXhfbG9jaygm
ZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0
LnZtLm11dGV4KTsKIAlkcm1fbW1fcmVtb3ZlX25vZGUoJnZncHUtPmdtLmxvd19nbV9ub2RlKTsK
IAlkcm1fbW1fcmVtb3ZlX25vZGUoJnZncHUtPmdtLmhpZ2hfZ21fbm9kZSk7Ci0JbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+Z2d0dC52bS5tdXRleCk7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMK
aW5kZXggZDVhYWM2ZmY4MDNhLi4wNzkxNzM2YTA4ZmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYwpAQCAtMTQ2LDYgKzE0Niw3IEBAIF9fYWN0aXZlX3JldGlyZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKIAlpZiAoIXJldGlyZSkKIAkJcmV0dXJuOwogCisJR0VNX0JVR19PTihyY3Vf
YWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSk7CiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9l
bnRyeV9zYWZlKGl0LCBuLCAmcm9vdCwgbm9kZSkgewogCQlHRU1fQlVHX09OKGk5MTVfYWN0aXZl
X3JlcXVlc3RfaXNzZXQoJml0LT5iYXNlKSk7CiAJCWttZW1fY2FjaGVfZnJlZShnbG9iYWwuc2xh
Yl9jYWNoZSwgaXQpOwpAQCAtMjQ1LDYgKzI0Niw4IEBAIHZvaWQgX19pOTE1X2FjdGl2ZV9pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXJlZi0+ZmxhZ3MgPSAwOwogCXJlZi0+
YWN0aXZlID0gYWN0aXZlOwogCXJlZi0+cmV0aXJlID0gcmV0aXJlOworCisJcmVmLT5leGNsID0g
TlVMTDsKIAlyZWYtPnRyZWUgPSBSQl9ST09UOwogCXJlZi0+Y2FjaGUgPSBOVUxMOwogCWluaXRf
bGxpc3RfaGVhZCgmcmVmLT5wcmVhbGxvY2F0ZWRfYmFycmllcnMpOwpAQCAtMzQxLDYgKzM0NCw0
NiBAQCBpbnQgaTkxNV9hY3RpdmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCXJldHVy
biBlcnI7CiB9CiAKK3N0YXRpYyB2b2lkIGV4Y2xfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZiwgc3Ry
dWN0IGRtYV9mZW5jZV9jYiAqY2IpCit7CisJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYgPSBjb250
YWluZXJfb2YoY2IsIHR5cGVvZigqcmVmKSwgZXhjbF9jYik7CisKKwlSQ1VfSU5JVF9QT0lOVEVS
KHJlZi0+ZXhjbCwgTlVMTCk7CisJZG1hX2ZlbmNlX3B1dChmKTsKKworCWFjdGl2ZV9yZXRpcmUo
cmVmKTsKK30KKwordm9pZCBpOTE1X2FjdGl2ZV9zZXRfZXhjbHVzaXZlKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmKQoreworCS8qIFdlIGV4cGVjdCB0aGUgY2Fs
bGVyIHRvIG1hbmFnZSB0aGUgZXhjbHVzaXZlIHRpbWVsaW5lIG9yZGVyaW5nICovCisJR0VNX0JV
R19PTihpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpOworCisJZG1hX2ZlbmNlX2dldChmKTsKKwor
CXJjdV9yZWFkX2xvY2soKTsKKwlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpIHsK
KwkJc3RydWN0IGRtYV9mZW5jZSAqb2xkOworCisJCW9sZCA9IGRtYV9mZW5jZV9nZXRfcmN1X3Nh
ZmUoJnJlZi0+ZXhjbCk7CisJCWlmIChvbGQpIHsKKwkJCWlmIChkbWFfZmVuY2VfcmVtb3ZlX2Nh
bGxiYWNrKG9sZCwgJnJlZi0+ZXhjbF9jYikpCisJCQkJYXRvbWljX2RlYygmcmVmLT5jb3VudCk7
CisJCQlkbWFfZmVuY2VfcHV0KG9sZCk7CisJCX0KKwl9CisJcmN1X3JlYWRfdW5sb2NrKCk7CisK
KwlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKKwlyY3VfYXNzaWduX3BvaW50ZXIocmVmLT5leGNs
LCBmKTsKKworCWlmIChkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYsICZyZWYtPmV4Y2xfY2IsIGV4
Y2xfY2IpKSB7CisJCVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKKwkJYXRvbWlj
X2RlYygmcmVmLT5jb3VudCk7CisJCWRtYV9mZW5jZV9wdXQoZik7CisJfQorfQorCiBpbnQgaTkx
NV9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlpbnQgZXJyOwpA
QCAtMzk5LDYgKzQ0MiwyNSBAQCB2b2lkIGk5MTVfYWN0aXZlX3VuZ3JhYihzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKIAlfX2FjdGl2ZV91bmdyYWIocmVmKTsKIH0KIAorc3RhdGljIGludCBleGNs
X3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJc3RydWN0IGRtYV9mZW5jZSAqb2xk
OworCWludCBlcnIgPSAwOworCisJaWYgKCFyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkK
KwkJcmV0dXJuIDA7CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJb2xkID0gZG1hX2ZlbmNlX2dldF9y
Y3Vfc2FmZSgmcmVmLT5leGNsKTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKwlpZiAob2xkKSB7CisJ
CWVyciA9IGRtYV9mZW5jZV93YWl0KG9sZCwgdHJ1ZSk7CisJCWRtYV9mZW5jZV9wdXQob2xkKTsK
Kwl9CisKKwlyZXR1cm4gZXJyOworfQorCiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZikKIHsKIAlzdHJ1Y3QgYWN0aXZlX25vZGUgKml0LCAqbjsKQEAgLTQxOSw2
ICs0ODEsMTAgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYp
CiAJCXJldHVybiAwOwogCX0KIAorCWVyciA9IGV4Y2xfd2FpdChyZWYpOworCWlmIChlcnIpCisJ
CWdvdG8gb3V0OworCiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBu
LCAmcmVmLT50cmVlLCBub2RlKSB7CiAJCWlmIChpc19iYXJyaWVyKCZpdC0+YmFzZSkpIHsgLyog
dW5jb25uZWN0ZWQgaWRsZS1iYXJyaWVyICovCiAJCQllcnIgPSAtRUJVU1k7CkBAIC00MzAsNiAr
NDk2LDcgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJ
CQlicmVhazsKIAl9CiAKK291dDoKIAlfX2FjdGl2ZV9yZXRpcmUocmVmKTsKIAlpZiAoZXJyKQog
CQlyZXR1cm4gZXJyOwpAQCAtNDU0LDI2ICs1MjEsMjIgQEAgaW50IGk5MTVfcmVxdWVzdF9hd2Fp
dF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAogaW50IGk5MTVfcmVx
dWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKQogewotCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwotCWludCBlcnI7Ci0K
LQlpZiAoUkJfRU1QVFlfUk9PVCgmcmVmLT50cmVlKSkKLQkJcmV0dXJuIDA7CisJaW50IGVyciA9
IDA7CiAKLQkvKiBhd2FpdCBhbGxvY2F0ZXMgYW5kIHNvIHdlIG5lZWQgdG8gYXZvaWQgaGl0dGlu
ZyB0aGUgc2hyaW5rZXIgKi8KLQllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7Ci0JaWYg
KGVycikKLQkJcmV0dXJuIGVycjsKKwlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkp
IHsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQltdXRleF9sb2NrKCZyZWYtPm11dGV4
KTsKLQlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRy
ZWUsIG5vZGUpIHsKLQkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHJx
LCAmaXQtPmJhc2UpOwotCQlpZiAoZXJyKQotCQkJYnJlYWs7CisJCXJjdV9yZWFkX2xvY2soKTsK
KwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZyZWYtPmV4Y2wpOworCQlyY3VfcmVh
ZF91bmxvY2soKTsKKwkJaWYgKGZlbmNlKSB7CisJCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRf
ZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CisJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJfQogCX0K
LQltdXRleF91bmxvY2soJnJlZi0+bXV0ZXgpOwogCi0JaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYp
OworCS8qIEluIHRoZSBmdXR1cmUgd2UgbWF5IGNob29zZSB0byBhd2FpdCBvbiBhbGwgZmVuY2Vz
ICovCisKIAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAppbmRl
eCA5NDljNjgzNTMzNWIuLjkwMDM0ZjYxYjdjMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2
ZS5oCkBAIC0zNzksNiArMzc5LDEzIEBAIGk5MTVfYWN0aXZlX2FkZF9yZXF1ZXN0KHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlyZXR1cm4gaTkxNV9h
Y3RpdmVfcmVmKHJlZiwgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwgcnEpOwogfQogCit2b2lk
IGk5MTVfYWN0aXZlX3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVj
dCBkbWFfZmVuY2UgKmYpOworCitzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9hY3RpdmVfaGFzX2V4
Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKK3sKKwlyZXR1cm4gcmN1X2FjY2Vzc19w
b2ludGVyKHJlZi0+ZXhjbCk7Cit9CisKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKTsKIAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Fj
dGl2ZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApp
bmRleCAxODU0ZTdkMTY4YzEuLjg2ZTdhMjMyZWEzYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZV90eXBlcy5oCkBAIC04LDYgKzgsNyBAQAogI2RlZmluZSBfSTkxNV9BQ1RJVkVf
VFlQRVNfSF8KIAogI2luY2x1ZGUgPGxpbnV4L2F0b21pYy5oPgorI2luY2x1ZGUgPGxpbnV4L2Rt
YS1mZW5jZS5oPgogI2luY2x1ZGUgPGxpbnV4L2xsaXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvbXV0
ZXguaD4KICNpbmNsdWRlIDxsaW51eC9yYnRyZWUuaD4KQEAgLTUxLDYgKzUyLDEwIEBAIHN0cnVj
dCBpOTE1X2FjdGl2ZSB7CiAJc3RydWN0IG11dGV4IG11dGV4OwogCWF0b21pY190IGNvdW50Owog
CisJLyogUHJlYWxsb2NhdGVkICJleGNsdXNpdmUiIG5vZGUgKi8KKwlzdHJ1Y3QgZG1hX2ZlbmNl
IF9fcmN1ICpleGNsOworCXN0cnVjdCBkbWFfZmVuY2VfY2IgZXhjbF9jYjsKKwogCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7CiAjZGVmaW5lIEk5MTVfQUNUSVZFX0dSQUJfQklUIDAKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmMKaW5kZXggYTllZTczYjYxZjRkLi5hYjAwYmE2ZjY5NWIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuYwpAQCAtMTg4MSwxMCArMTg4MSw4IEBAIHN0YXRpYyBpbnQgaTkxNV9kcm1f
cmVzdW1lKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJaWYgKHJldCkKIAkJRFJNX0VSUk9SKCJm
YWlsZWQgdG8gcmUtZW5hYmxlIEdHVFRcbiIpOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBpbmdzKGRldl9wcml2
KTsKIAlpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhkZXZfcHJpdik7Ci0JbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpbnRlbF9jc3JfdWNvZGVfcmVzdW1lKGRl
dl9wcml2KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggYjhmN2ZlMzExYjBhLi45MzRl
YTc3NmE0NmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtNjIsMjAgKzYyLDMxIEBACiAj
aW5jbHVkZSAiaW50ZWxfcG0uaCIKIAogc3RhdGljIGludAotaW5zZXJ0X21hcHBhYmxlX25vZGUo
c3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwKLSAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkcm1f
bW1fbm9kZSAqbm9kZSwgdTMyIHNpemUpCitpbnNlcnRfbWFwcGFibGVfbm9kZShzdHJ1Y3QgaTkx
NV9nZ3R0ICpnZ3R0LCBzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUsIHUzMiBzaXplKQogeworCWlu
dCBlcnI7CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4
KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCiAJbWVtc2V0KG5vZGUsIDAsIHNpemVvZigq
bm9kZSkpOwotCXJldHVybiBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1t
LCBub2RlLAotCQkJCQkgICBzaXplLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAotCQkJCQkg
ICAwLCBnZ3R0LT5tYXBwYWJsZV9lbmQsCi0JCQkJCSAgIERSTV9NTV9JTlNFUlRfTE9XKTsKKwll
cnIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBub2RlLAorCQkJ
CQkgIHNpemUsIDAsIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCisJCQkJCSAgMCwgZ2d0dC0+bWFw
cGFibGVfZW5kLAorCQkJCQkgIERSTV9NTV9JTlNFUlRfTE9XKTsKKworCW11dGV4X3VubG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOworCisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGljIHZvaWQKLXJlbW92
ZV9tYXBwYWJsZV9ub2RlKHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKK3JlbW92ZV9tYXBwYWJs
ZV9ub2RlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQsIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkK
IHsKKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKG5v
ZGUpOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogfQogCiBpbnQKQEAgLTg3LDcg
Kzk4LDggQEAgaTkxNV9nZW1fZ2V0X2FwZXJ0dXJlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTY0IHBpbm5lZDsKIAot
CW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKKwlpZiAobXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZnZ3R0LT52bS5tdXRleCkpCisJCXJldHVybiAtRUlOVFI7CiAKIAlwaW5uZWQgPSBnZ3R0
LT52bS5yZXNlcnZlZDsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmdndHQtPnZtLmJvdW5k
X2xpc3QsIHZtX2xpbmspCkBAIC0xMDksMjAgKzEyMSwyNCBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0
X3VuYmluZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCUxJU1RfSEVBRChzdGls
bF9pbl9saXN0KTsKIAlpbnQgcmV0ID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+
YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci0KIAlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOwog
CXdoaWxlICghcmV0ICYmICh2bWEgPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoJm9iai0+dm1h
Lmxpc3QsCiAJCQkJCQkgICAgICAgc3RydWN0IGk5MTVfdm1hLAogCQkJCQkJICAgICAgIG9ial9s
aW5rKSkpIHsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSB2bWEtPnZtOworCisJ
CXJldCA9IC1FQlVTWTsKKwkJaWYgKCFpOTE1X3ZtX3RyeW9wZW4odm0pKQorCQkJYnJlYWs7CisK
IAkJbGlzdF9tb3ZlX3RhaWwoJnZtYS0+b2JqX2xpbmssICZzdGlsbF9pbl9saXN0KTsKIAkJc3Bp
bl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCi0JCXJldCA9IC1FQlVTWTsKIAkJaWYgKGZsYWdz
ICYgSTkxNV9HRU1fT0JKRUNUX1VOQklORF9BQ1RJVkUgfHwKIAkJICAgICFpOTE1X3ZtYV9pc19h
Y3RpdmUodm1hKSkKIAkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOwogCisJCWk5MTVfdm1f
Y2xvc2Uodm0pOwogCQlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOwogCX0KIAlsaXN0X3NwbGlj
ZSgmc3RpbGxfaW5fbGlzdCwgJm9iai0+dm1hLmxpc3QpOwpAQCAtMzM4LDEwICszNTQsNiBAQCBp
OTE1X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl1NjQg
cmVtYWluLCBvZmZzZXQ7CiAJaW50IHJldDsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0
aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsK
LQogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAJ
dm1hID0gRVJSX1BUUigtRU5PREVWKTsKIAlpZiAoIWk5MTVfZ2VtX29iamVjdF9pc190aWxlZChv
YmopKQpAQCAtMzU1LDEyICszNjcsMTAgQEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfSBlbHNlIHsKIAkJcmV0ID0gaW5zZXJ0X21hcHBhYmxl
X25vZGUoZ2d0dCwgJm5vZGUsIFBBR0VfU0laRSk7CiAJCWlmIChyZXQpCi0JCQlnb3RvIG91dF91
bmxvY2s7CisJCQlnb3RvIG91dF9ycG07CiAJCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9j
YXRlZCgmbm9kZSkpOwogCX0KIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKG9iaik7CiAJ
aWYgKHJldCkKIAkJZ290byBvdXRfdW5waW47CkBAIC00MTQsMTcgKzQyNCwxNCBAQCBpOTE1X2dl
bV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogCWk5MTVfZ2Vt
X29iamVjdF91bmxvY2tfZmVuY2Uob2JqLCBmZW5jZSk7CiBvdXRfdW5waW46Ci0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgm
bm9kZSkpIHsKIAkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBub2RlLnN0YXJ0LCBu
b2RlLnNpemUpOwotCQlyZW1vdmVfbWFwcGFibGVfbm9kZSgmbm9kZSk7CisJCXJlbW92ZV9tYXBw
YWJsZV9ub2RlKGdndHQsICZub2RlKTsKIAl9IGVsc2UgewogCQlpOTE1X3ZtYV91bnBpbih2bWEp
OwogCX0KLW91dF91bmxvY2s6CitvdXRfcnBtOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1
LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJcmV0dXJuIHJldDsKIH0KIApAQCAtNTMxLDEwICs1MzgsNiBAQCBpOTE1X2dl
bV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl2b2lk
IF9fdXNlciAqdXNlcl9kYXRhOwogCWludCByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7Ci0KIAlpZiAoaTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFnZShvYmopKSB7CiAJCS8q
CiAJCSAqIEF2b2lkIHdha2luZyB0aGUgZGV2aWNlIHVwIGlmIHdlIGNhbiBmYWxsYmFjaywgYXMK
QEAgLTU0NCwxMCArNTQ3LDggQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCSAqIHVzaW5nIHRoZSBjYWNoZSBieXBhc3Mgb2YgaW5k
aXJlY3QgR0dUVCBhY2Nlc3MuCiAJCSAqLwogCQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXRfaWZfaW5fdXNlKHJwbSk7Ci0JCWlmICghd2FrZXJlZikgewotCQkJcmV0ID0gLUVGQVVMVDsK
LQkJCWdvdG8gb3V0X3VubG9jazsKLQkJfQorCQlpZiAoIXdha2VyZWYpCisJCQlyZXR1cm4gLUVG
QVVMVDsKIAl9IGVsc2UgewogCQkvKiBObyBiYWNraW5nIHBhZ2VzLCBubyBmYWxsYmFjaywgd2Ug
bXVzdCBmb3JjZSBHR1RUIGFjY2VzcyAqLwogCQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQocnBtKTsKQEAgLTU2OSw4ICs1NzAsNiBAQCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJR0VNX0JVR19PTighZHJtX21tX25vZGVf
YWxsb2NhdGVkKCZub2RlKSk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCXJldCA9IGk5MTVfZ2VtX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2Jq
KTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF91bnBpbjsKQEAgLTYzNCwxOCArNjMzLDE1IEBAIGk5
MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CiAJaTkxNV9nZW1fb2JqZWN0X3VubG9ja19mZW5jZShvYmosIGZlbmNlKTsKIG91dF91bnBpbjoK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpbnRlbF9ndF9mbHVzaF9n
Z3R0X3dyaXRlcyhnZ3R0LT52bS5ndCk7CiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmbm9k
ZSkpIHsKIAkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBub2RlLnN0YXJ0LCBub2Rl
LnNpemUpOwotCQlyZW1vdmVfbWFwcGFibGVfbm9kZSgmbm9kZSk7CisJCXJlbW92ZV9tYXBwYWJs
ZV9ub2RlKGdndHQsICZub2RlKTsKIAl9IGVsc2UgewogCQlpOTE1X3ZtYV91bnBpbih2bWEpOwog
CX0KIG91dF9ycG06CiAJaW50ZWxfcnVudGltZV9wbV9wdXQocnBtLCB3YWtlcmVmKTsKLW91dF91
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4g
cmV0OwogfQogCkBAIC05NjgsOCArOTY0LDYgQEAgaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJ
aW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9t
dXRleCk7Ci0KIAlpZiAoZmxhZ3MgJiBQSU5fTUFQUEFCTEUgJiYKIAkgICAgKCF2aWV3IHx8IHZp
ZXctPnR5cGUgPT0gSTkxNV9HR1RUX1ZJRVdfTk9STUFMKSkgewogCQkvKiBJZiB0aGUgcmVxdWly
ZWQgc3BhY2UgaXMgbGFyZ2VyIHRoYW4gdGhlIGF2YWlsYWJsZQpAQCAtMTAxNiwxMyArMTAxMCw2
IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCQkJCXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOwogCQl9CiAKLQkJV0FSTihpOTE1X3Zt
YV9pc19waW5uZWQodm1hKSwKLQkJICAgICAiYm8gaXMgYWxyZWFkeSBwaW5uZWQgaW4gZ2d0dCB3
aXRoIGluY29ycmVjdCBhbGlnbm1lbnQ6IgotCQkgICAgICIgb2Zmc2V0PSUwOHgsIHJlcS5hbGln
bm1lbnQ9JWxseCwiCi0JCSAgICAgIiByZXEubWFwX2FuZF9mZW5jZWFibGU9JWQsIHZtYS0+bWFw
X2FuZF9mZW5jZWFibGU9JWRcbiIsCi0JCSAgICAgaTkxNV9nZ3R0X29mZnNldCh2bWEpLCBhbGln
bm1lbnQsCi0JCSAgICAgISEoZmxhZ3MgJiBQSU5fTUFQUEFCTEUpLAotCQkgICAgIGk5MTVfdm1h
X2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpOwogCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1h
KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBFUlJfUFRSKHJldCk7CkBAIC0xNDQxLDggKzE0Mjgs
NiBAQCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJfQogCiAJaWYgKHJldCA9PSAtRUlPKSB7Ci0JCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0u
c3RydWN0X211dGV4KTsKLQogCQkvKgogCQkgKiBBbGxvdyBlbmdpbmVzIG9yIHVDIGluaXRpYWxp
c2F0aW9uIHRvIGZhaWwgYnkgbWFya2luZyB0aGUgR1BVCiAJCSAqIGFzIHdlZGdlZC4gQnV0IHdl
IG9ubHkgd2FudCB0byBkbyB0aGlzIHdoZW4gdGhlIEdQVSBpcyBhbmdyeSwKQEAgLTE0NTksOCAr
MTQ0NCw2IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3MoZGV2X3ByaXYpOwogCQlpOTE1
X2dlbV9yZXN0b3JlX2ZlbmNlcyhkZXZfcHJpdik7CiAJCWludGVsX2luaXRfY2xvY2tfZ2F0aW5n
KGRldl9wcml2KTsKLQotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4
KTsKIAl9CiAKIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGRldl9wcml2KTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCmluZGV4IDhjMWUwNGY0MDJiYy4uMDU1MmJmOTNl
ZWEzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ3LDggKzQ3LDcg
QEAgc3RhdGljIGludCBnZ3R0X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CSAqIGJvdW5kIGJ5IHRoZWlyIGFjdGl2ZSByZWZlcmVuY2UuCiAJICovCiAJcmV0dXJuIGk5MTVf
Z2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJM
RSB8Ci0JCQkJICAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKKwkJCQkgICAgICBJOTE1X1dBSVRfSU5U
RVJSVVBUSUJMRSwKIAkJCQkgICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiB9CiAKQEAgLTEw
NCw3ICsxMDMsNyBAQCBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0sCiAJc3RydWN0IGk5MTVfdm1hICphY3RpdmU7CiAJaW50IHJldDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwogCXRyYWNlX2k5MTVfZ2VtX2V2aWN0KHZtLCBtaW5f
c2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7CiAKIAkvKgpAQCAtMTI3LDE1ICsxMjYsNiBAQCBpOTE1
X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJ
ICAgIG1pbl9zaXplLCBhbGlnbm1lbnQsIGNvbG9yLAogCQkJCSAgICBzdGFydCwgZW5kLCBtb2Rl
KTsKIAotCS8qCi0JICogUmV0aXJlIGJlZm9yZSB3ZSBzZWFyY2ggdGhlIGFjdGl2ZSBsaXN0LiBB
bHRob3VnaCB3ZSBoYXZlCi0JICogcmVhc29uYWJsZSBhY2N1cmFjeSBpbiBvdXIgcmV0aXJlbWVu
dCBsaXN0cywgd2UgbWF5IGhhdmUKLQkgKiBhIHN0cmF5IHBpbiAocHJldmVudGluZyBldmljdGlv
bikgdGhhdCBjYW4gb25seSBiZSByZXNvbHZlZCBieQotCSAqIHJldGlyaW5nLgotCSAqLwotCWlm
ICghKGZsYWdzICYgUElOX05PTkJMT0NLKSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoZGV2X3By
aXYpOwotCiBzZWFyY2hfYWdhaW46CiAJYWN0aXZlID0gTlVMTDsKIAlJTklUX0xJU1RfSEVBRCgm
ZXZpY3Rpb25fbGlzdCk7CkBAIC0yMzUsMTIgKzIyNSwxMiBAQCBpOTE1X2dlbV9ldmljdF9zb21l
dGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJbGlzdF9mb3JfZWFjaF9lbnRy
eV9zYWZlKHZtYSwgbmV4dCwgJmV2aWN0aW9uX2xpc3QsIGV2aWN0X2xpbmspIHsKIAkJX19pOTE1
X3ZtYV91bnBpbih2bWEpOwogCQlpZiAocmV0ID09IDApCi0JCQlyZXQgPSBpOTE1X3ZtYV91bmJp
bmQodm1hKTsKKwkJCXJldCA9IF9faTkxNV92bWFfdW5iaW5kKHZtYSk7CiAJfQogCiAJd2hpbGUg
KHJldCA9PSAwICYmIChub2RlID0gZHJtX21tX3NjYW5fY29sb3JfZXZpY3QoJnNjYW4pKSkgewog
CQl2bWEgPSBjb250YWluZXJfb2Yobm9kZSwgc3RydWN0IGk5MTVfdm1hLCBub2RlKTsKLQkJcmV0
ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCXJldCA9IF9faTkxNV92bWFfdW5iaW5kKHZtYSk7
CiAJfQogCiAJcmV0dXJuIHJldDsKQEAgLTI2OCw3ICsyNTgsNyBAQCBpbnQgaTkxNV9nZW1fZXZp
Y3RfZm9yX25vZGUoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJc3RydWN0IGk5MTVf
dm1hICp2bWEsICpuZXh0OwogCWludCByZXQgPSAwOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgm
dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5t
dXRleCk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChzdGFydCwgSTkxNV9HVFRfUEFHRV9TSVpF
KSk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChlbmQsIEk5MTVfR1RUX1BBR0VfU0laRSkpOwog
CkBAIC0zNDksNyArMzM5LDcgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIG5l
eHQsICZldmljdGlvbl9saXN0LCBldmljdF9saW5rKSB7CiAJCV9faTkxNV92bWFfdW5waW4odm1h
KTsKIAkJaWYgKHJldCA9PSAwKQotCQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQly
ZXQgPSBfX2k5MTVfdm1hX3VuYmluZCh2bWEpOwogCX0KIAogCXJldHVybiByZXQ7CkBAIC0zNzMs
NyArMzYzLDcgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtKQogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqbmV4dDsKIAlpbnQgcmV0OwogCi0JbG9j
a2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CiAJdHJhY2VfaTkxNV9nZW1fZXZpY3Rfdm0odm0pOwog
CiAJLyogU3dpdGNoIGJhY2sgdG8gdGhlIGRlZmF1bHQgY29udGV4dCBpbiBvcmRlciB0byB1bnBp
bgpAQCAtMzg4LDcgKzM3OCw2IEBAIGludCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSkKIAl9CiAKIAlJTklUX0xJU1RfSEVBRCgmZXZpY3Rpb25fbGlzdCk7
Ci0JbXV0ZXhfbG9jaygmdm0tPm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJnZt
LT5ib3VuZF9saXN0LCB2bV9saW5rKSB7CiAJCWlmIChpOTE1X3ZtYV9pc19waW5uZWQodm1hKSkK
IAkJCWNvbnRpbnVlOwpAQCAtMzk2LDEzICszODUsMTIgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X3Zt
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwog
CQlsaXN0X2FkZCgmdm1hLT5ldmljdF9saW5rLCAmZXZpY3Rpb25fbGlzdCk7CiAJfQotCW11dGV4
X3VubG9jaygmdm0tPm11dGV4KTsKIAogCXJldCA9IDA7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlKHZtYSwgbmV4dCwgJmV2aWN0aW9uX2xpc3QsIGV2aWN0X2xpbmspIHsKIAkJX19pOTE1X3Zt
YV91bnBpbih2bWEpOwogCQlpZiAocmV0ID09IDApCi0JCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQo
dm1hKTsKKwkJCXJldCA9IF9faTkxNV92bWFfdW5iaW5kKHZtYSk7CiAJfQogCXJldHVybiByZXQ7
CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCmluZGV4IDYxNWE5
ZjRlZjMwYy4uNDg3YjcyNjFmN2VkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9mZW5jZV9yZWcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9m
ZW5jZV9yZWcuYwpAQCAtMjMwLDE0ICsyMzAsMTUgQEAgc3RhdGljIGludCBmZW5jZV91cGRhdGUo
c3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAkJCSBpOTE1X2dlbV9vYmplY3RfZ2V0X3Rp
bGluZyh2bWEtPm9iaikpKQogCQkJcmV0dXJuIC1FSU5WQUw7CiAKLQkJcmV0ID0gaTkxNV9hY3Rp
dmVfd2FpdCgmdm1hLT5hY3RpdmUpOworCQlyZXQgPSBpOTE1X3ZtYV9zeW5jKHZtYSk7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KIAogCW9sZCA9IHhjaGcoJmZlbmNlLT52bWEsIE5V
TEwpOwogCWlmIChvbGQpIHsKLQkJcmV0ID0gaTkxNV9hY3RpdmVfd2FpdCgmb2xkLT5hY3RpdmUp
OworCQkvKiBYWFggSWRlYWxseSB3ZSB3b3VsZCBtb3ZlIHRoZSB3YWl0aW5nIHRvIG91dHNpZGUg
dGhlIG11dGV4ICovCisJCXJldCA9IGk5MTVfdm1hX3N5bmMob2xkKTsKIAkJaWYgKHJldCkgewog
CQkJZmVuY2UtPnZtYSA9IG9sZDsKIAkJCXJldHVybiByZXQ7CkBAIC0zMzEsMTMgKzMzMiwxNSBA
QCBzdGF0aWMgc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogCXJldHVybiBFUlJfUFRSKC1FREVBRExLKTsKIH0KIAotc3RhdGlj
IGludCBfX2k5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK2ludCBfX2k5
MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlzdHJ1Y3QgaTkxNV9n
Z3R0ICpnZ3R0ID0gaTkxNV92bV90b19nZ3R0KHZtYS0+dm0pOwogCXN0cnVjdCBpOTE1X2ZlbmNl
X3JlZyAqZmVuY2U7CiAJc3RydWN0IGk5MTVfdm1hICpzZXQgPSBpOTE1X2dlbV9vYmplY3RfaXNf
dGlsZWQodm1hLT5vYmopID8gdm1hIDogTlVMTDsKIAlpbnQgZXJyOwogCisJbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmdm1hLT52bS0+bXV0ZXgpOworCiAJLyogSnVzdCB1cGRhdGUgb3VyIHBsYWNlIGlu
IHRoZSBMUlUgaWYgb3VyIGZlbmNlIGlzIGdldHRpbmcgcmV1c2VkLiAqLwogCWlmICh2bWEtPmZl
bmNlKSB7CiAJCWZlbmNlID0gdm1hLT5mZW5jZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmMKaW5kZXggNDgzZWVmZjg3MzBlLi5hMzUxYjk4YWZlMDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jCkBAIC0xNTAsMTYgKzE1MCwxOCBAQCBzdGF0aWMgdm9pZCBnbWNoX2dndHRf
aW52YWxpZGF0ZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCiBzdGF0aWMgaW50IHBwZ3R0X2Jp
bmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwg
Y2FjaGVfbGV2ZWwsCi0JCQkgIHUzMiB1bnVzZWQpCisJCQkgIHUzMiBmbGFncykKIHsKIAl1MzIg
cHRlX2ZsYWdzOwogCWludCBlcnI7CiAKLQlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkx
NV9WTUFfTE9DQUxfQklORCkpIHsKKwlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9BTExPQykgewogCQll
cnIgPSB2bWEtPnZtLT5hbGxvY2F0ZV92YV9yYW5nZSh2bWEtPnZtLAogCQkJCQkJIHZtYS0+bm9k
ZS5zdGFydCwgdm1hLT5zaXplKTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7CisKKwkJc2V0
X2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSk7CiAJfQogCiAJ
LyogQXBwbGljYWJsZSB0byBWTFYsIGFuZCBnZW44KyAqLwpAQCAtMTY3LDYgKzE2OSw3IEBAIHN0
YXRpYyBpbnQgcHBndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJaWYgKGk5MTVf
Z2VtX29iamVjdF9pc19yZWFkb25seSh2bWEtPm9iaikpCiAJCXB0ZV9mbGFncyB8PSBQVEVfUkVB
RF9PTkxZOwogCisJR0VNX0JVR19PTighdGVzdF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULCBfX2k5
MTVfdm1hX2ZsYWdzKHZtYSkpKTsKIAl2bWEtPnZtLT5pbnNlcnRfZW50cmllcyh2bWEtPnZtLCB2
bWEsIGNhY2hlX2xldmVsLCBwdGVfZmxhZ3MpOwogCXdtYigpOwogCkBAIC0xNzUsNyArMTc4LDgg
QEAgc3RhdGljIGludCBwcGd0dF9iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAogc3Rh
dGljIHZvaWQgcHBndHRfdW5iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQl2bWEt
PnZtLT5jbGVhcl9yYW5nZSh2bWEtPnZtLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6ZSk7CisJ
aWYgKHRlc3RfYW5kX2NsZWFyX2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxh
Z3Modm1hKSkpCisJCXZtYS0+dm0tPmNsZWFyX3JhbmdlKHZtYS0+dm0sIHZtYS0+bm9kZS5zdGFy
dCwgdm1hLT5zaXplKTsKIH0KIAogc3RhdGljIGludCBwcGd0dF9zZXRfcGFnZXMoc3RydWN0IGk5
MTVfdm1hICp2bWEpCkBAIC01MDMsMTUgKzUwNywyNiBAQCBzdGF0aWMgdm9pZCBpOTE1X2FkZHJl
c3Nfc3BhY2VfZmluaShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAltdXRleF9kZXN0
cm95KCZ2bS0+bXV0ZXgpOwogfQogCi1zdGF0aWMgdm9pZCBwcGd0dF9kZXN0cm95X3ZtYShzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3ZvaWQgX19pOTE1X3ZtX2Nsb3NlKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47CiAK
LQltdXRleF9sb2NrKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JbGlzdF9mb3JfZWFj
aF9lbnRyeV9zYWZlKHZtYSwgdm4sICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykKKwltdXRleF9s
b2NrKCZ2bS0+bXV0ZXgpOworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmdm0t
PmJvdW5kX2xpc3QsIHZtX2xpbmspIHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiA9IHZtYS0+b2JqOworCisJCS8qIEtlZXAgdGhlIG9iaiAoYW5kIGhlbmNlIHRoZSB2bWEpIGFs
aXZlIGFzIF93ZV8gZGVzdHJveSBpdCAqLworCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZv
YmotPmJhc2UucmVmY291bnQpKQorCQkJY29udGludWU7CisKKwkJYXRvbWljX2FuZCh+STkxNV9W
TUFfUElOX01BU0ssICZ2bWEtPmZsYWdzKTsKKwkJV0FSTl9PTihfX2k5MTVfdm1hX3VuYmluZCh2
bWEpKTsKIAkJaTkxNV92bWFfZGVzdHJveSh2bWEpOworCisJCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKKwl9CiAJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmdm0tPmJvdW5kX2xpc3QpKTsKLQlt
dXRleF91bmxvY2soJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2so
JnZtLT5tdXRleCk7CiB9CiAKIHN0YXRpYyB2b2lkIF9faTkxNV92bV9yZWxlYXNlKHN0cnVjdCB3
b3JrX3N0cnVjdCAqd29yaykKQEAgLTUxOSw4ICs1MzQsNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVf
dm1fcmVsZWFzZShzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0gPQogCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSwgcmN1LndvcmspOwogCi0JcHBndHRfZGVzdHJveV92bWEodm0pOwotCiAJdm0tPmNsZWFu
dXAodm0pOwogCWk5MTVfYWRkcmVzc19zcGFjZV9maW5pKHZtKTsKIApAQCAtNTM1LDcgKzU0OCw2
IEBAIHZvaWQgaTkxNV92bV9yZWxlYXNlKHN0cnVjdCBrcmVmICprcmVmKQogCUdFTV9CVUdfT04o
aTkxNV9pc19nZ3R0KHZtKSk7CiAJdHJhY2VfaTkxNV9wcGd0dF9yZWxlYXNlKHZtKTsKIAotCXZt
LT5jbG9zZWQgPSB0cnVlOwogCXF1ZXVlX3JjdV93b3JrKHZtLT5pOTE1LT53cSwgJnZtLT5yY3Up
OwogfQogCkBAIC01NDMsNiArNTU1LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9hZGRyZXNzX3NwYWNl
X2luaXQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sIGludCBzdWJjbGFzcykKIHsKIAlr
cmVmX2luaXQoJnZtLT5yZWYpOwogCUlOSVRfUkNVX1dPUksoJnZtLT5yY3UsIF9faTkxNV92bV9y
ZWxlYXNlKTsKKwlhdG9taWNfc2V0KCZ2bS0+b3BlbiwgMSk7CiAKIAkvKgogCSAqIFRoZSB2bS0+
bXV0ZXggbXVzdCBiZSByZWNsYWltIHNhZmUgKGZvciB1c2UgaW4gdGhlIHNocmlua2VyKS4KQEAg
LTE3NzEsMTIgKzE3ODQsOCBAQCBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2ZyZWVfcGQoc3RydWN0
IGdlbjZfcHBndHQgKnBwZ3R0KQogc3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9jbGVhbnVwKHN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewogCXN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCA9
IHRvX2dlbjZfcHBndHQoaTkxNV92bV90b19wcGd0dCh2bSkpOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdm0tPmk5MTU7CiAKLQkvKiBGSVhNRSByZW1vdmUgdGhlIHN0cnVjdF9t
dXRleCB0byBicmluZyB0aGUgbG9ja2luZyB1bmRlciBjb250cm9sICovCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaTkxNV92bWFfZGVzdHJveShwcGd0dC0+dm1hKTsK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZ2VuNl9wcGd0dF9m
cmVlX3BkKHBwZ3R0KTsKIAlmcmVlX3NjcmF0Y2godm0pOwpAQCAtMTg2NSw3ICsxODc0LDggQEAg
c3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcGRfdm1hX2NyZWF0ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAq
cHBndHQsIGludCBzaXplKQogCiAJaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmdm1hLT5hY3RpdmUs
IE5VTEwsIE5VTEwpOwogCi0Jdm1hLT52bSA9ICZnZ3R0LT52bTsKKwltdXRleF9pbml0KCZ2bWEt
PnBhZ2VzX211dGV4KTsKKwl2bWEtPnZtID0gaTkxNV92bV9nZXQoJmdndHQtPnZtKTsKIAl2bWEt
Pm9wcyA9ICZwZF92bWFfb3BzOwogCXZtYS0+cHJpdmF0ZSA9IHBwZ3R0OwogCkBAIC0xODg1LDcg
KzE4OTUsNyBAQCBpbnQgZ2VuNl9wcGd0dF9waW4oc3RydWN0IGk5MTVfcHBndHQgKmJhc2UpCiAJ
c3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0ID0gdG9fZ2VuNl9wcGd0dChiYXNlKTsKIAlpbnQgZXJy
ID0gMDsKIAotCUdFTV9CVUdfT04ocHBndHQtPmJhc2Uudm0uY2xvc2VkKTsKKwlHRU1fQlVHX09O
KCFhdG9taWNfcmVhZCgmcHBndHQtPmJhc2Uudm0ub3BlbikpOwogCiAJLyoKIAkgKiBXb3JrYXJv
dW5kIHRoZSBsaW1pdGVkIG1heGltdW0gdm1hLT5waW5fY291bnQgYW5kIHRoZSBhbGlhc2luZ19w
cGd0dApAQCAtMjQ2MywxNCArMjQ3MywxOCBAQCBzdGF0aWMgaW50IGFsaWFzaW5nX2d0dF9iaW5k
X3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9MT0NBTF9C
SU5EKSB7CiAJCXN0cnVjdCBpOTE1X3BwZ3R0ICphbGlhcyA9IGk5MTVfdm1fdG9fZ2d0dCh2bWEt
PnZtKS0+YWxpYXM7CiAKLQkJaWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0xP
Q0FMX0JJTkQpKSB7CisJCWlmIChmbGFncyAmIEk5MTVfVk1BX0FMTE9DKSB7CiAJCQlyZXQgPSBh
bGlhcy0+dm0uYWxsb2NhdGVfdmFfcmFuZ2UoJmFsaWFzLT52bSwKIAkJCQkJCQkgIHZtYS0+bm9k
ZS5zdGFydCwKIAkJCQkJCQkgIHZtYS0+c2l6ZSk7CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiBy
ZXQ7CisKKwkJCXNldF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZt
YSkpOwogCQl9CiAKKwkJR0VNX0JVR19PTighdGVzdF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULAor
CQkJCSAgICAgX19pOTE1X3ZtYV9mbGFncyh2bWEpKSk7CiAJCWFsaWFzLT52bS5pbnNlcnRfZW50
cmllcygmYWxpYXMtPnZtLCB2bWEsCiAJCQkJCSBjYWNoZV9sZXZlbCwgcHRlX2ZsYWdzKTsKIAl9
CkBAIC0yNDk5LDcgKzI1MTMsNyBAQCBzdGF0aWMgdm9pZCBhbGlhc2luZ19ndHRfdW5iaW5kX3Zt
YShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJCXZtLT5jbGVhcl9yYW5nZSh2bSwgdm1hLT5ub2Rl
LnN0YXJ0LCB2bWEtPnNpemUpOwogCX0KIAotCWlmIChpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5
MTVfVk1BX0xPQ0FMX0JJTkQpKSB7CisJaWYgKHRlc3RfYW5kX2NsZWFyX2JpdChJOTE1X1ZNQV9B
TExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSkpIHsKIAkJc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0gPQogCQkJJmk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZtKS0+YWxpYXMtPnZtOwog
CkBAIC0yNjAyLDIyICsyNjE2LDE2IEBAIHN0YXRpYyBpbnQgaW5pdF9hbGlhc2luZ19wcGd0dChz
dHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCiBzdGF0aWMgdm9pZCBmaW5pX2FsaWFzaW5nX3BwZ3R0
KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBnZ3R0LT52bS5pOTE1OwogCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcHBndHQgPSBmZXRjaF9hbmRfemVy
bygmZ2d0dC0+YWxpYXMpOwogCWlmICghcHBndHQpCi0JCWdvdG8gb3V0OworCQlyZXR1cm47CiAK
IAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIAogCWdndHQtPnZtLnZtYV9vcHMuYmluZF92bWEg
ICA9IGdndHRfYmluZF92bWE7CiAJZ2d0dC0+dm0udm1hX29wcy51bmJpbmRfdm1hID0gZ2d0dF91
bmJpbmRfdm1hOwotCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIH0KIAogc3RhdGljIGludCBnZ3R0X3Jlc2VydmVfZ3VjX3RvcChzdHJ1Y3QgaTkxNV9nZ3R0
ICpnZ3R0KQpAQCAtMjczNCwzMiArMjc0MiwyOCBAQCBpbnQgaTkxNV9pbml0X2dndHQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIHN0YXRpYyB2b2lkIGdndHRfY2xlYW51cF9odyhz
dHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gZ2d0dC0+dm0uaTkxNTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCi0JZ2d0dC0+
dm0uY2xvc2VkID0gdHJ1ZTsKKwlhdG9taWNfc2V0KCZnZ3R0LT52bS5vcGVuLCAwKTsKIAogCXJj
dV9iYXJyaWVyKCk7IC8qIGZsdXNoIHRoZSBSQ1UnZWRfX2k5MTVfdm1fcmVsZWFzZSAqLwotCWZs
dXNoX3dvcmtxdWV1ZShpOTE1LT53cSk7CisJZmx1c2hfd29ya3F1ZXVlKGdndHQtPnZtLmk5MTUt
PndxKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xv
Y2soJmdndHQtPnZtLm11dGV4KTsKIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZu
LCAmZ2d0dC0+dm0uYm91bmRfbGlzdCwgdm1fbGluaykKLQkJV0FSTl9PTihpOTE1X3ZtYV91bmJp
bmQodm1hKSk7CisJCVdBUk5fT04oX19pOTE1X3ZtYV91bmJpbmQodm1hKSk7CiAKIAlpZiAoZHJt
X21tX25vZGVfYWxsb2NhdGVkKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKSkKIAkJZHJtX21tX3JlbW92
ZV9ub2RlKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKTsKIAogCWdndHRfcmVsZWFzZV9ndWNfdG9wKGdn
dHQpOwotCi0JaWYgKGRybV9tbV9pbml0aWFsaXplZCgmZ2d0dC0+dm0ubW0pKSB7Ci0JCWludGVs
X3ZndF9kZWJhbGxvb24oZ2d0dCk7Ci0JCWk5MTVfYWRkcmVzc19zcGFjZV9maW5pKCZnZ3R0LT52
bSk7Ci0JfQorCWludGVsX3ZndF9kZWJhbGxvb24oZ2d0dCk7CiAKIAlnZ3R0LT52bS5jbGVhbnVw
KCZnZ3R0LT52bSk7CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOworCWk5MTVfYWRkcmVzc19zcGFjZV9maW5p
KCZnZ3R0LT52bSk7CiAKIAlhcmNoX3BoeXNfd2NfZGVsKGdndHQtPm10cnIpOwogCWlvX21hcHBp
bmdfZmluaSgmZ2d0dC0+aW9tYXApOwpAQCAtMzE4OCw5ICszMTkyLDYgQEAgaW50IGk5MTVfZ2d0
dF9wcm9iZV9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHN0YXRpYyBpbnQgZ2d0
dF9pbml0X2h3KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1OwotCWludCByZXQgPSAwOwotCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpOTE1X2FkZHJlc3Nfc3BhY2VfaW5pdCgm
Z2d0dC0+dm0sIFZNX0NMQVNTX0dHVFQpOwogCkBAIC0zMjA2LDE4ICszMjA3LDE0IEBAIHN0YXRp
YyBpbnQgZ2d0dF9pbml0X2h3KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCQkJZ2d0dC0+Z21h
ZHIuc3RhcnQsCiAJCQkJZ2d0dC0+bWFwcGFibGVfZW5kKSkgewogCQlnZ3R0LT52bS5jbGVhbnVw
KCZnZ3R0LT52bSk7Ci0JCXJldCA9IC1FSU87Ci0JCWdvdG8gb3V0OworCQlyZXR1cm4gLUVJTzsK
IAl9CiAKIAlnZ3R0LT5tdHJyID0gYXJjaF9waHlzX3djX2FkZChnZ3R0LT5nbWFkci5zdGFydCwg
Z2d0dC0+bWFwcGFibGVfZW5kKTsKIAogCWk5MTVfZ2d0dF9pbml0X2ZlbmNlcyhnZ3R0KTsKIAot
b3V0OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4g
cmV0OworCXJldHVybiAwOwogfQogCiAvKioKQEAgLTMyODksNiArMzI4Niw3IEBAIHN0YXRpYyB2
b2lkIGdndHRfcmVzdG9yZV9tYXBwaW5ncyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewogCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47CiAJYm9vbCBmbHVzaCA9IGZhbHNlOworCWludCBvcGVu
OwogCiAJaW50ZWxfZ3RfY2hlY2tfYW5kX2NsZWFyX2ZhdWx0cyhnZ3R0LT52bS5ndCk7CiAKQEAg
LTMyOTYsNyArMzI5NCw5IEBAIHN0YXRpYyB2b2lkIGdndHRfcmVzdG9yZV9tYXBwaW5ncyhzdHJ1
Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCiAJLyogRmlyc3QgZmlsbCBvdXIgcG9ydGlvbiBvZiB0aGUg
R1RUIHdpdGggc2NyYXRjaCBwYWdlcyAqLwogCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52
bSwgMCwgZ2d0dC0+dm0udG90YWwpOwotCWdndHQtPnZtLmNsb3NlZCA9IHRydWU7IC8qIHNraXAg
cmV3cml0aW5nIFBURSBvbiBWTUEgdW5iaW5kICovCisKKwkvKiBTa2lwIHJld3JpdGluZyBQVEUg
b24gVk1BIHVuYmluZC4gKi8KKwlvcGVuID0gYXRvbWljX3hjaGcoJmdndHQtPnZtLm9wZW4sIDAp
OwogCiAJLyogY2xmbHVzaCBvYmplY3RzIGJvdW5kIGludG8gdGhlIEdHVFQgYW5kIHJlYmluZCB0
aGVtLiAqLwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmZ2d0dC0+dm0uYm91
bmRfbGlzdCwgdm1fbGluaykgewpAQCAtMzMwNSwyNCArMzMwNSwyMCBAQCBzdGF0aWMgdm9pZCBn
Z3R0X3Jlc3RvcmVfbWFwcGluZ3Moc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAkJaWYgKCFpOTE1
X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0dMT0JBTF9CSU5EKSkKIAkJCWNvbnRpbnVlOwog
Ci0JCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwotCi0JCWlmICghaTkxNV92bWFfdW5i
aW5kKHZtYSkpCi0JCQlnb3RvIGxvY2s7CisJCWlmICghX19pOTE1X3ZtYV91bmJpbmQodm1hKSkK
KwkJCWNvbnRpbnVlOwogCisJCWNsZWFyX2JpdChJOTE1X1ZNQV9HTE9CQUxfQklORF9CSVQsIF9f
aTkxNV92bWFfZmxhZ3Modm1hKSk7CiAJCVdBUk5fT04oaTkxNV92bWFfYmluZCh2bWEsCiAJCQkJ
ICAgICAgb2JqID8gb2JqLT5jYWNoZV9sZXZlbCA6IDAsCi0JCQkJICAgICAgUElOX1VQREFURSkp
OworCQkJCSAgICAgIFBJTl9HTE9CQUwsIE5VTEwpKTsKIAkJaWYgKG9iaikgeyAvKiBvbmx5IHVz
ZWQgZHVyaW5nIHJlc3VtZSA9PiBleGNsdXNpdmUgYWNjZXNzICovCiAJCQlmbHVzaCB8PSBmZXRj
aF9hbmRfemVybygmb2JqLT53cml0ZV9kb21haW4pOwogCQkJb2JqLT5yZWFkX2RvbWFpbnMgfD0g
STkxNV9HRU1fRE9NQUlOX0dUVDsKIAkJfQotCi1sb2NrOgotCQltdXRleF9sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CiAJfQogCi0JZ2d0dC0+dm0uY2xvc2VkID0gZmFsc2U7CisJYXRvbWljX3NldCgm
Z2d0dC0+dm0ub3Blbiwgb3Blbik7CiAJZ2d0dC0+aW52YWxpZGF0ZShnZ3R0KTsKIAogCW11dGV4
X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwpAQCAtMzcxNCw3ICszNzEwLDggQEAgaW50IGk5MTVf
Z2VtX2d0dF9pbnNlcnQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJdTY0IG9mZnNl
dDsKIAlpbnQgZXJyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CisKIAlHRU1fQlVH
X09OKCFzaXplKTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVEKHNpemUsIEk5MTVfR1RUX1BBR0Vf
U0laRSkpOwogCUdFTV9CVUdfT04oYWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdubWVu
dCkpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAppbmRleCBkOGRmYTM4MTFlNTQuLjAz
NDE4ZGVkZTUwMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKQEAgLTMwNyw3ICsz
MDcsMTQgQEAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSB7CiAKIAl1bnNpZ25lZCBpbnQgYmlu
ZF9hbGxvYzsKIAotCWJvb2wgY2xvc2VkOworCS8qCisJICogRWFjaCBhY3RpdmUgdXNlciBjb250
ZXh0IGhhcyBpdHMgb3duIGFkZHJlc3Mgc3BhY2UgKGluIGZ1bGwtcHBndHQpLgorCSAqIFNpbmNl
IHRoZSB2bSBtYXkgYmUgc2hhcmVkIGJldHdlZW4gbXVsdGlwbGUgY29udGV4dHMsIHdlIGNvdW50
IGhvdworCSAqIG1hbnkgY29udGV4dHMga2VlcCB1cyAib3BlbiIuIE9uY2Ugb3BlbiBoaXRzIHpl
cm8sIHdlIGFyZSBjbG9zZWQKKwkgKiBhbmQgZG8gbm90IGFsbG93IGFueSBuZXcgYXR0YWNobWVu
dHMsIGFuZCBwcm9jZWVkIHRvIHNodXRkb3duIG91cgorCSAqIHZtYSBhbmQgcGFnZSBkaXJlY3Rv
cmllcy4KKwkgKi8KKwlhdG9taWNfdCBvcGVuOwogCiAJc3RydWN0IG11dGV4IG11dGV4OyAvKiBw
cm90ZWN0cyB2bWEgYW5kIG91ciBsaXN0cyAqLwogI2RlZmluZSBWTV9DTEFTU19HR1RUIDAKQEAg
LTU4MSw2ICs1ODgsMzUgQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1fcHV0KHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCWtyZWZfcHV0KCZ2bS0+cmVmLCBpOTE1X3ZtX3JlbGVh
c2UpOwogfQogCitzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgoraTkx
NV92bV9vcGVuKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCUdFTV9CVUdfT04o
IWF0b21pY19yZWFkKCZ2bS0+b3BlbikpOworCWF0b21pY19pbmMoJnZtLT5vcGVuKTsKKwlyZXR1
cm4gaTkxNV92bV9nZXQodm0pOworfQorCitzdGF0aWMgaW5saW5lIGJvb2wKK2k5MTVfdm1fdHJ5
b3BlbihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sKKwlpZiAoYXRvbWljX2FkZF91
bmxlc3MoJnZtLT5vcGVuLCAxLCAwKSkKKwkJcmV0dXJuIGk5MTVfdm1fZ2V0KHZtKTsKKworCXJl
dHVybiBmYWxzZTsKK30KKwordm9pZCBfX2k5MTVfdm1fY2xvc2Uoc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0pOworCitzdGF0aWMgaW5saW5lIHZvaWQKK2k5MTVfdm1fY2xvc2Uoc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnZt
LT5vcGVuKSk7CisJaWYgKGF0b21pY19kZWNfYW5kX3Rlc3QoJnZtLT5vcGVuKSkKKwkJX19pOTE1
X3ZtX2Nsb3NlKHZtKTsKKworCWk5MTVfdm1fcHV0KHZtKTsKK30KKwogaW50IGdlbjZfcHBndHRf
cGluKHN0cnVjdCBpOTE1X3BwZ3R0ICpiYXNlKTsKIHZvaWQgZ2VuNl9wcGd0dF91bnBpbihzdHJ1
Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CiB2b2lkIGdlbjZfcHBndHRfdW5waW5fYWxsKHN0cnVjdCBp
OTE1X3BwZ3R0ICpiYXNlKTsKQEAgLTYxMywxMCArNjQ5LDkgQEAgaW50IGk5MTVfZ2VtX2d0dF9p
bnNlcnQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAjZGVmaW5lIFBJTl9PRkZTRVRf
QklBUwkJQklUX1VMTCg2KQogI2RlZmluZSBQSU5fT0ZGU0VUX0ZJWEVECUJJVF9VTEwoNykKIAot
I2RlZmluZSBQSU5fTUJaCQkJQklUX1VMTCg4KSAvKiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cgKi8K
LSNkZWZpbmUgUElOX0dMT0JBTAkJQklUX1VMTCg5KSAvKiBJOTE1X1ZNQV9HTE9CQUxfQklORCAq
LwotI2RlZmluZSBQSU5fVVNFUgkJQklUX1VMTCgxMCkgLyogSTkxNV9WTUFfTE9DQUxfQklORCAq
LwotI2RlZmluZSBQSU5fVVBEQVRFCQlCSVRfVUxMKDExKQorI2RlZmluZSBQSU5fVVBEQVRFCQlC
SVRfVUxMKDkpCisjZGVmaW5lIFBJTl9HTE9CQUwJCUJJVF9VTEwoMTApIC8qIEk5MTVfVk1BX0dM
T0JBTF9CSU5EICovCisjZGVmaW5lIFBJTl9VU0VSCQlCSVRfVUxMKDExKSAvKiBJOTE1X1ZNQV9M
T0NBTF9CSU5EICovCiAKICNkZWZpbmUgUElOX09GRlNFVF9NQVNLCQkoLUk5MTVfR1RUX1BBR0Vf
U0laRSkKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCA1MjRmNjcxMGI3YWEuLjgwMDU1
NTAxZWNjYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTEyMDQsMTUgKzEyMDQsMTAg
QEAgc3RhdGljIGludCBpOTE1X29hX3JlYWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSwKIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqb2FfcGluX2NvbnRleHQoc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVy
IGl0OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5kZXZfcHJpdjsK
IAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gc3RyZWFtLT5jdHg7CiAJc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlOwogCWludCBlcnI7CiAKLQllcnIgPSBpOTE1X211dGV4X2xvY2tfaW50
ZXJydXB0aWJsZSgmaTkxNS0+ZHJtKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BUUihlcnIp
OwotCiAJZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2lu
ZXMoY3R4KSwgaXQpIHsKIAkJaWYgKGNlLT5lbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykK
IAkJCWNvbnRpbnVlOwpAQCAtMTIyOSwxMCArMTIyNCw2IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqb2FfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkK
IAl9CiAJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCi0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BU
UihlcnIpOwotCiAJcmV0dXJuIHN0cmVhbS0+cGlubmVkX2N0eDsKIH0KIApAQCAtMTMzMSwzMiAr
MTMyMiwyMiBAQCBzdGF0aWMgaW50IG9hX2dldF9yZW5kZXJfY3R4X2lkKHN0cnVjdCBpOTE1X3Bl
cmZfc3RyZWFtICpzdHJlYW0pCiAgKi8KIHN0YXRpYyB2b2lkIG9hX3B1dF9yZW5kZXJfY3R4X2lk
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gc3RyZWFtLT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2U7CiAKIAlzdHJlYW0tPnNwZWNpZmljX2N0eF9pZCA9IElOVkFMSURfQ1RYX0lEOwogCXN0
cmVhbS0+c3BlY2lmaWNfY3R4X2lkX21hc2sgPSAwOwogCiAJY2UgPSBmZXRjaF9hbmRfemVybygm
c3RyZWFtLT5waW5uZWRfY3R4KTsKLQlpZiAoY2UpIHsKLQkJbXV0ZXhfbG9jaygmZGV2X3ByaXYt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlmIChjZSkKIAkJaW50ZWxfY29udGV4dF91bnBpbihjZSk7
Ci0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCX0KIH0KIAog
c3RhdGljIHZvaWQKIGZyZWVfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJl
YW0pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPmRldl9wcml2
OwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X3ZtYV91
bnBpbl9hbmRfcmVsZWFzZSgmc3RyZWFtLT5vYV9idWZmZXIudm1hLAogCQkJCSAgIEk5MTVfVk1B
X1JFTEVBU0VfTUFQKTsKIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0KIAlzdHJlYW0tPm9hX2J1ZmZlci52YWRkciA9IE5VTEw7CiB9CiAKQEAgLTE1MTEsMTggKzE0
OTIsMTMgQEAgc3RhdGljIGludCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJl
YW0gKnN0cmVhbSkKIAlpZiAoV0FSTl9PTihzdHJlYW0tPm9hX2J1ZmZlci52bWEpKQogCQlyZXR1
cm4gLUVOT0RFVjsKIAotCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZf
cHJpdi0+ZHJtKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJQlVJTERfQlVHX09OX05P
VF9QT1dFUl9PRl8yKE9BX0JVRkZFUl9TSVpFKTsKIAlCVUlMRF9CVUdfT04oT0FfQlVGRkVSX1NJ
WkUgPCBTWl8xMjhLIHx8IE9BX0JVRkZFUl9TSVpFID4gU1pfMTZNKTsKIAogCWJvID0gaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZfcHJpdiwgT0FfQlVGRkVSX1NJWkUpOwogCWlmIChJ
U19FUlIoYm8pKSB7CiAJCURSTV9FUlJPUigiRmFpbGVkIHRvIGFsbG9jYXRlIE9BIGJ1ZmZlclxu
Iik7Ci0JCXJldCA9IFBUUl9FUlIoYm8pOwotCQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIFBUUl9F
UlIoYm8pOwogCX0KIAogCWk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KGJvLCBJ
OTE1X0NBQ0hFX0xMQyk7CkBAIC0xNTQ2LDcgKzE1MjIsNyBAQCBzdGF0aWMgaW50IGFsbG9jX29h
X2J1ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCQkJIGk5MTVfZ2d0dF9v
ZmZzZXQoc3RyZWFtLT5vYV9idWZmZXIudm1hKSwKIAkJCSBzdHJlYW0tPm9hX2J1ZmZlci52YWRk
cik7CiAKLQlnb3RvIHVubG9jazsKKwlyZXR1cm4gMDsKIAogZXJyX3VucGluOgogCV9faTkxNV92
bWFfdW5waW4odm1hKTsKQEAgLTE1NTcsOCArMTUzMyw2IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2Ff
YnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJc3RyZWFtLT5vYV9idWZm
ZXIudmFkZHIgPSBOVUxMOwogCXN0cmVhbS0+b2FfYnVmZmVyLnZtYSA9IE5VTEw7CiAKLXVubG9j
azoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4g
cmV0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCBkMDk3Zjc3ODkwYmEuLmRlZmVi
OWJiMWRhYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC0zMiw2ICszMiw3IEBACiAKICNp
bmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5MTVfZ2xvYmFscy5oIgorI2luY2x1ZGUg
Imk5MTVfc3dfZmVuY2Vfd29yay5oIgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKICNpbmNsdWRl
ICJpOTE1X3ZtYS5oIgogCkBAIC0xMTAsNyArMTExLDggQEAgdm1hX2NyZWF0ZShzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWlmICh2bWEgPT0gTlVMTCkKIAkJcmV0dXJuIEVSUl9Q
VFIoLUVOT01FTSk7CiAKLQl2bWEtPnZtID0gdm07CisJbXV0ZXhfaW5pdCgmdm1hLT5wYWdlc19t
dXRleCk7CisJdm1hLT52bSA9IGk5MTVfdm1fZ2V0KHZtKTsKIAl2bWEtPm9wcyA9ICZ2bS0+dm1h
X29wczsKIAl2bWEtPm9iaiA9IG9iajsKIAl2bWEtPnJlc3YgPSBvYmotPmJhc2UucmVzdjsKQEAg
LTI2MSw4ICsyNjMsNiBAQCB2bWFfbG9va3VwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmosCiAgKiBPbmNlIGNyZWF0ZWQsIHRoZSBWTUEgaXMga2VwdCB1bnRpbCBlaXRoZXIgdGhlIG9i
amVjdCBpcyBmcmVlZCwgb3IgdGhlCiAgKiBhZGRyZXNzIHNwYWNlIGlzIGNsb3NlZC4KICAqCi0g
KiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVjdF9tdXRleCBoZWxkLgotICoKICAqIFJldHVybnMg
dGhlIHZtYSwgb3IgYW4gZXJyb3IgcG9pbnRlci4KICAqLwogc3RydWN0IGk5MTVfdm1hICoKQEAg
LTI3Myw3ICsyNzMsNyBAQCBpOTE1X3ZtYV9pbnN0YW5jZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCiAJR0VNX0JVR19PTih2aWV3ICYm
ICFpOTE1X2lzX2dndHQodm0pKTsKLQlHRU1fQlVHX09OKHZtLT5jbG9zZWQpOworCUdFTV9CVUdf
T04oIWF0b21pY19yZWFkKCZ2bS0+b3BlbikpOwogCiAJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2Nr
KTsKIAl2bWEgPSB2bWFfbG9va3VwKG9iaiwgdm0sIHZpZXcpOwpAQCAtMjg3LDE4ICsyODcsNjMg
QEAgaTkxNV92bWFfaW5zdGFuY2Uoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAly
ZXR1cm4gdm1hOwogfQogCitzdHJ1Y3QgaTkxNV92bWFfd29yayB7CisJc3RydWN0IGRtYV9mZW5j
ZV93b3JrIGJhc2U7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJZW51bSBpOTE1X2NhY2hlX2xl
dmVsIGNhY2hlX2xldmVsOworCXVuc2lnbmVkIGludCBmbGFnczsKK307CisKK3N0YXRpYyBpbnQg
X192bWFfYmluZChzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgKndvcmspCit7CisJc3RydWN0IGk5MTVf
dm1hX3dvcmsgKnZ3ID0gY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqdncpLCBiYXNlKTsKKwlz
dHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHZ3LT52bWE7CisJaW50IGVycjsKKworCWVyciA9IHZtYS0+
b3BzLT5iaW5kX3ZtYSh2bWEsIHZ3LT5jYWNoZV9sZXZlbCwgdnctPmZsYWdzKTsKKwlpZiAoZXJy
KQorCQlhdG9taWNfb3IoSTkxNV9WTUFfRVJST1IsICZ2bWEtPmZsYWdzKTsKKworCWlmICh2bWEt
Pm9iaikKKwkJX19pOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXModm1hLT5vYmopOworCisJcmV0
dXJuIGVycjsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vfd29ya19vcHMgYmlu
ZF9vcHMgPSB7CisJLm5hbWUgPSAiYmluZCIsCisJLndvcmsgPSBfX3ZtYV9iaW5kLAorfTsKKwor
c3RydWN0IGk5MTVfdm1hX3dvcmsgKmk5MTVfdm1hX3dvcmsodm9pZCkKK3sKKwlzdHJ1Y3QgaTkx
NV92bWFfd29yayAqdnc7CisKKwl2dyA9IGt6YWxsb2Moc2l6ZW9mKCp2dyksIEdGUF9LRVJORUwp
OworCWlmICghdncpCisJCXJldHVybiBOVUxMOworCisJZG1hX2ZlbmNlX3dvcmtfaW5pdCgmdnct
PmJhc2UsICZiaW5kX29wcyk7CisJdnctPmJhc2UuZG1hLmVycm9yID0gLUVBR0FJTjsgLyogZGlz
YWJsZSB0aGUgd29ya2VyIGJ5IGRlZmF1bHQgKi8KKworCXJldHVybiB2dzsKK30KKwogLyoqCiAg
KiBpOTE1X3ZtYV9iaW5kIC0gU2V0cyB1cCBQVEVzIGZvciBhbiBWTUEgaW4gaXQncyBjb3JyZXNw
b25kaW5nIGFkZHJlc3Mgc3BhY2UuCiAgKiBAdm1hOiBWTUEgdG8gbWFwCiAgKiBAY2FjaGVfbGV2
ZWw6IG1hcHBpbmcgY2FjaGUgbGV2ZWwKICAqIEBmbGFnczogZmxhZ3MgbGlrZSBnbG9iYWwgb3Ig
bG9jYWwgbWFwcGluZworICogQHdvcms6IHByZWFsbG9jYXRlZCB3b3JrZXIgZm9yIGFsbG9jYXRp
bmcgYW5kIGJpbmRpbmcgdGhlIFBURQogICoKICAqIERNQSBhZGRyZXNzZXMgYXJlIHRha2VuIGZy
b20gdGhlIHNjYXR0ZXItZ2F0aGVyIHRhYmxlIG9mIHRoaXMgb2JqZWN0IChvciBvZgogICogdGhp
cyBWTUEgaW4gY2FzZSBvZiBub24tZGVmYXVsdCBHR1RUIHZpZXdzKSBhbmQgUFRFIGVudHJpZXMg
c2V0IHVwLgogICogTm90ZSB0aGF0IERNQSBhZGRyZXNzZXMgYXJlIGFsc28gdGhlIG9ubHkgcGFy
dCBvZiB0aGUgU0cgdGFibGUgd2UgY2FyZSBhYm91dC4KICAqLwotaW50IGk5MTVfdm1hX2JpbmQo
c3RydWN0IGk5MTVfdm1hICp2bWEsIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwK
LQkJICB1MzIgZmxhZ3MpCitpbnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwK
KwkJICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCisJCSAgdTMyIGZsYWdzLAor
CQkgIHN0cnVjdCBpOTE1X3ZtYV93b3JrICp3b3JrKQogewogCXUzMiBiaW5kX2ZsYWdzOwogCXUz
MiB2bWFfZmxhZ3M7CkBAIC0zMTUsMTEgKzM2MCw4IEBAIGludCBpOTE1X3ZtYV9iaW5kKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCiAJaWYg
KEdFTV9ERUJVR19XQVJOX09OKCFmbGFncykpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JYmluZF9m
bGFncyA9IDA7Ci0JaWYgKGZsYWdzICYgUElOX0dMT0JBTCkKLQkJYmluZF9mbGFncyB8PSBJOTE1
X1ZNQV9HTE9CQUxfQklORDsKLQlpZiAoZmxhZ3MgJiBQSU5fVVNFUikKLQkJYmluZF9mbGFncyB8
PSBJOTE1X1ZNQV9MT0NBTF9CSU5EOworCWJpbmRfZmxhZ3MgPSBmbGFnczsKKwliaW5kX2ZsYWdz
ICY9IEk5MTVfVk1BX0dMT0JBTF9CSU5EIHwgSTkxNV9WTUFfTE9DQUxfQklORDsKIAogCXZtYV9m
bGFncyA9IGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKTsKIAl2bWFfZmxhZ3MgJj0gSTkxNV9WTUFf
R0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NBTF9CSU5EOwpAQCAtMzMzLDkgKzM3NSwzMiBAQCBp
bnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgZW51bSBpOTE1X2NhY2hlX2xl
dmVsIGNhY2hlX2xldmVsLAogCUdFTV9CVUdfT04oIXZtYS0+cGFnZXMpOwogCiAJdHJhY2VfaTkx
NV92bWFfYmluZCh2bWEsIGJpbmRfZmxhZ3MpOwotCXJldCA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2
bWEsIGNhY2hlX2xldmVsLCBiaW5kX2ZsYWdzKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0Owor
CWlmICh3b3JrICYmIChiaW5kX2ZsYWdzICYgfnZtYV9mbGFncykgJiB2bWEtPnZtLT5iaW5kX2Fs
bG9jKSB7CisJCXdvcmstPnZtYSA9IHZtYTsKKwkJd29yay0+Y2FjaGVfbGV2ZWwgPSBjYWNoZV9s
ZXZlbDsKKwkJd29yay0+ZmxhZ3MgPSBiaW5kX2ZsYWdzIHwgSTkxNV9WTUFfQUxMT0M7CisKKwkJ
LyoKKwkJICogTm90ZSB3ZSBvbmx5IHdhbnQgdG8gY2hhaW4gdXAgdG8gdGhlIG1pZ3JhdGlvbiBm
ZW5jZSBvbgorCQkgKiB0aGUgcGFnZXMgKG5vdCB0aGUgb2JqZWN0IGl0c2VsZikuIEFzIHdlIGRv
bid0IHRyYWNrIHRoYXQsCisJCSAqIHlldCwgd2UgaGF2ZSB0byB1c2UgdGhlIGV4Y2x1c2l2ZSBm
ZW5jZSBpbnN0ZWFkLgorCQkgKgorCQkgKiBBbHNvIG5vdGUgdGhhdCB3ZSBkbyBub3Qgd2FudCB0
byB0cmFjayB0aGUgYXN5bmMgdm1hIGFzCisJCSAqIHBhcnQgb2YgdGhlIG9iai0+cmVzdi0+ZXhj
bF9mZW5jZSBhcyBpdCBvbmx5IGFmZmVjdHMKKwkJICogZXhlY3V0aW9uIGFuZCBub3QgY29udGVu
dCBvciBvYmplY3QncyBiYWNraW5nIHN0b3JlIGxpZmV0aW1lLgorCQkgKi8KKwkJR0VNX0JVR19P
TihpOTE1X2FjdGl2ZV9oYXNfZXhjbHVzaXZlKCZ2bWEtPmFjdGl2ZSkpOworCQlpOTE1X2FjdGl2
ZV9zZXRfZXhjbHVzaXZlKCZ2bWEtPmFjdGl2ZSwgJndvcmstPmJhc2UuZG1hKTsKKwkJd29yay0+
YmFzZS5kbWEuZXJyb3IgPSAwOyAvKiBlbmFibGUgdGhlIHF1ZXVlX3dvcmsoKSAqLworCisJCWlm
ICh2bWEtPm9iaikKKwkJCV9faTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh2bWEtPm9iaik7CisJ
fSBlbHNlIHsKKwkJR0VNX0JVR19PTigoYmluZF9mbGFncyAmIH52bWFfZmxhZ3MpICYgdm1hLT52
bS0+YmluZF9hbGxvYyk7CisJCXJldCA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2bWEsIGNhY2hlX2xl
dmVsLCBiaW5kX2ZsYWdzKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfQogCiAJYXRv
bWljX29yKGJpbmRfZmxhZ3MsICZ2bWEtPmZsYWdzKTsKIAlyZXR1cm4gMDsKQEAgLTM0OCw5ICs0
MTMsNyBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIAogCS8qIEFjY2VzcyB0aHJvdWdoIHRoZSBHVFQgcmVxdWlyZXMgdGhlIGRldmljZSB0
byBiZSBhd2FrZS4gKi8KIAlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoJnZtYS0+dm0tPmk5MTUt
PnJ1bnRpbWVfcG0pOwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0JaWYgKFdBUk5fT04oIWk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2Vh
YmxlKHZtYSkpKSB7CisJaWYgKEdFTV9XQVJOX09OKCFpOTE1X3ZtYV9pc19tYXBfYW5kX2ZlbmNl
YWJsZSh2bWEpKSkgewogCQllcnIgPSAtRU5PREVWOwogCQlnb3RvIGVycjsKIAl9CkBAIC0zNTgs
NyArNDIxLDcgQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVf
dm1hICp2bWEpCiAJR0VNX0JVR19PTighaTkxNV92bWFfaXNfZ2d0dCh2bWEpKTsKIAlHRU1fQlVH
X09OKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0dMT0JBTF9CSU5EKSk7CiAKLQlw
dHIgPSB2bWEtPmlvbWFwOworCXB0ciA9IFJFQURfT05DRSh2bWEtPmlvbWFwKTsKIAlpZiAocHRy
ID09IE5VTEwpIHsKIAkJcHRyID0gaW9fbWFwcGluZ19tYXBfd2MoJmk5MTVfdm1fdG9fZ2d0dCh2
bWEtPnZtKS0+aW9tYXAsCiAJCQkJCXZtYS0+bm9kZS5zdGFydCwKQEAgLTM2OCw3ICs0MzEsMTAg
QEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEp
CiAJCQlnb3RvIGVycjsKIAkJfQogCi0JCXZtYS0+aW9tYXAgPSBwdHI7CisJCWlmICh1bmxpa2Vs
eShjbXB4Y2hnKCZ2bWEtPmlvbWFwLCBOVUxMLCBwdHIpKSkgeworCQkJaW9fbWFwcGluZ191bm1h
cChwdHIpOworCQkJcHRyID0gdm1hLT5pb21hcDsKKwkJfQogCX0KIAogCV9faTkxNV92bWFfcGlu
KHZtYSk7CkBAIC0zODgsMTggKzQ1NCwxMiBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9p
b21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogdm9pZCBpOTE1X3ZtYV9mbHVzaF93cml0ZXMo
c3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0JaWYgKCFpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2
bWEpKQotCQlyZXR1cm47Ci0KLQlpbnRlbF9ndF9mbHVzaF9nZ3R0X3dyaXRlcyh2bWEtPnZtLT5n
dCk7Ci0KLQlpOTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSk7CisJaWYgKGk5MTVfdm1hX3Vu
c2V0X2dndHRfd3JpdGUodm1hKSkKKwkJaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXModm1hLT52
bS0+Z3QpOwogfQogCiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJR0VNX0JVR19PTih2bWEtPmlvbWFwID09IE5VTEwpOwogCiAJaTkxNV92bWFf
Zmx1c2hfd3JpdGVzKHZtYSk7CkBAIC00MzUsNiArNDk1LDkgQEAgYm9vbCBpOTE1X3ZtYV9taXNw
bGFjZWQoY29uc3Qgc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJaWYgKCFkcm1fbW1fbm9kZV9hbGxv
Y2F0ZWQoJnZtYS0+bm9kZSkpCiAJCXJldHVybiBmYWxzZTsKIAorCWlmICh0ZXN0X2JpdChJOTE1
X1ZNQV9FUlJPUl9CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSkpCisJCXJldHVybiB0cnVlOwor
CiAJaWYgKHZtYS0+bm9kZS5zaXplIDwgc2l6ZSkKIAkJcmV0dXJuIHRydWU7CiAKQEAgLTUzNSw3
ICs1OTgsNiBAQCBzdGF0aWMgdm9pZCBhc3NlcnRfYmluZF9jb3VudChjb25zdCBzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKQogc3RhdGljIGludAogaTkxNV92bWFfaW5zZXJ0KHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZtYS0+dm0tPmk5MTU7CiAJdW5z
aWduZWQgbG9uZyBjb2xvcjsKIAl1NjQgc3RhcnQsIGVuZDsKIAlpbnQgcmV0OwpAQCAtNTYxLDcg
KzYyMyw3IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUs
IHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAogCWVuZCA9IHZtYS0+dm0tPnRvdGFsOwogCWlm
IChmbGFncyAmIFBJTl9NQVBQQUJMRSkKLQkJZW5kID0gbWluX3QodTY0LCBlbmQsIGRldl9wcml2
LT5nZ3R0Lm1hcHBhYmxlX2VuZCk7CisJCWVuZCA9IG1pbl90KHU2NCwgZW5kLCBpOTE1X3ZtX3Rv
X2dndHQodm1hLT52bSktPm1hcHBhYmxlX2VuZCk7CiAJaWYgKGZsYWdzICYgUElOX1pPTkVfNEcp
CiAJCWVuZCA9IG1pbl90KHU2NCwgZW5kLCAoMVVMTCA8PCAzMikgLSBJOTE1X0dUVF9QQUdFX1NJ
WkUpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoZW5kLCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsK
QEAgLTU3OCwzNCArNjQwLDIwIEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAl9CiAKIAljb2xvciA9IDA7
Ci0JaWYgKHZtYS0+b2JqKSB7Ci0JCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXModm1h
LT5vYmopOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQlpZiAoaTkxNV92bV9oYXNf
Y2FjaGVfY29sb3Jpbmcodm1hLT52bSkpCi0JCQljb2xvciA9IHZtYS0+b2JqLT5jYWNoZV9sZXZl
bDsKLQl9Ci0KLQlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOwotCi0JcmV0ID0gdm1hLT5vcHMtPnNl
dF9wYWdlcyh2bWEpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX3VucGluOworCWlmICh2bWEtPm9i
aiAmJiBpOTE1X3ZtX2hhc19jYWNoZV9jb2xvcmluZyh2bWEtPnZtKSkKKwkJY29sb3IgPSB2bWEt
Pm9iai0+Y2FjaGVfbGV2ZWw7CiAKIAlpZiAoZmxhZ3MgJiBQSU5fT0ZGU0VUX0ZJWEVEKSB7CiAJ
CXU2NCBvZmZzZXQgPSBmbGFncyAmIFBJTl9PRkZTRVRfTUFTSzsKIAkJaWYgKCFJU19BTElHTkVE
KG9mZnNldCwgYWxpZ25tZW50KSB8fAotCQkgICAgcmFuZ2Vfb3ZlcmZsb3dzKG9mZnNldCwgc2l6
ZSwgZW5kKSkgewotCQkJcmV0ID0gLUVJTlZBTDsKLQkJCWdvdG8gZXJyX2NsZWFyOwotCQl9CisJ
CSAgICByYW5nZV9vdmVyZmxvd3Mob2Zmc2V0LCBzaXplLCBlbmQpKQorCQkJcmV0dXJuIC1FSU5W
QUw7CiAKIAkJcmV0ID0gaTkxNV9nZW1fZ3R0X3Jlc2VydmUodm1hLT52bSwgJnZtYS0+bm9kZSwK
IAkJCQkJICAgc2l6ZSwgb2Zmc2V0LCBjb2xvciwKIAkJCQkJICAgZmxhZ3MpOwogCQlpZiAocmV0
KQotCQkJZ290byBlcnJfY2xlYXI7CisJCQlyZXR1cm4gcmV0OwogCX0gZWxzZSB7CiAJCS8qCiAJ
CSAqIFdlIG9ubHkgc3VwcG9ydCBodWdlIGd0dCBwYWdlcyB0aHJvdWdoIHRoZSA0OGIgUFBHVFQs
CkBAIC02NDQsNyArNjkyLDcgQEAgaTkxNV92bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogCQkJCQkgIHNpemUsIGFsaWdu
bWVudCwgY29sb3IsCiAJCQkJCSAgc3RhcnQsIGVuZCwgZmxhZ3MpOwogCQlpZiAocmV0KQotCQkJ
Z290byBlcnJfY2xlYXI7CisJCQlyZXR1cm4gcmV0OwogCiAJCUdFTV9CVUdfT04odm1hLT5ub2Rl
LnN0YXJ0IDwgc3RhcnQpOwogCQlHRU1fQlVHX09OKHZtYS0+bm9kZS5zdGFydCArIHZtYS0+bm9k
ZS5zaXplID4gZW5kKTsKQEAgLTY1MiwyMyArNzAwLDE1IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAlH
RU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwogCUdFTV9CVUdf
T04oIWk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZSh2bWEsIGNvbG9yKSk7CiAKLQltdXRleF9sb2Nr
KCZ2bWEtPnZtLT5tdXRleCk7CiAJbGlzdF9hZGRfdGFpbCgmdm1hLT52bV9saW5rLCAmdm1hLT52
bS0+Ym91bmRfbGlzdCk7Ci0JbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAKIAlpZiAo
dm1hLT5vYmopIHsKKwkJYXRvbWljX2luYygmdm1hLT5vYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCk7
CiAJCWF0b21pY19pbmMoJnZtYS0+b2JqLT5iaW5kX2NvdW50KTsKIAkJYXNzZXJ0X2JpbmRfY291
bnQodm1hLT5vYmopOwogCX0KIAogCXJldHVybiAwOwotCi1lcnJfY2xlYXI6Ci0Jdm1hLT5vcHMt
PmNsZWFyX3BhZ2VzKHZtYSk7Ci1lcnJfdW5waW46Ci0JaWYgKHZtYS0+b2JqKQotCQlpOTE1X2dl
bV9vYmplY3RfdW5waW5fcGFnZXModm1hLT5vYmopOwotCXJldHVybiByZXQ7CiB9CiAKIHN0YXRp
YyB2b2lkCkBAIC02NzcsMTIgKzcxNyw3IEBAIGk5MTVfdm1hX3JlbW92ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKIAlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkp
OwogCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9HTE9CQUxfQklO
RCB8IEk5MTVfVk1BX0xPQ0FMX0JJTkQpKTsKIAotCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEp
OwotCi0JbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwotCWRybV9tbV9yZW1vdmVfbm9kZSgm
dm1hLT5ub2RlKTsKIAlsaXN0X2RlbCgmdm1hLT52bV9saW5rKTsKLQltdXRleF91bmxvY2soJnZt
YS0+dm0tPm11dGV4KTsKIAogCS8qCiAJICogU2luY2UgdGhlIHVuYm91bmQgbGlzdCBpcyBnbG9i
YWwsIG9ubHkgbW92ZSB0byB0aGF0IGxpc3QgaWYKQEAgLTcwMSw1MSArNzM2LDIxMSBAQCBpOTE1
X3ZtYV9yZW1vdmUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJCWk5MTVfZ2VtX29iamVjdF91bnBp
bl9wYWdlcyhvYmopOwogCQlhc3NlcnRfYmluZF9jb3VudChvYmopOwogCX0KKworCWRybV9tbV9y
ZW1vdmVfbm9kZSgmdm1hLT5ub2RlKTsKIH0KIAotaW50IF9faTkxNV92bWFfZG9fcGluKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLAotCQkgICAgICB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZs
YWdzKQorc3RhdGljIGJvb2wgdHJ5X3FhZF9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHVuc2ln
bmVkIGludCBmbGFncykKIHsKLQljb25zdCB1bnNpZ25lZCBpbnQgYm91bmQgPSBhdG9taWNfcmVh
ZCgmdm1hLT5mbGFncyk7Ci0JaW50IHJldDsKKwl1bnNpZ25lZCBpbnQgYm91bmQ7CisJYm9vbCBw
aW5uZWQgPSB0cnVlOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0JR0VNX0JVR19PTigoZmxhZ3MgJiAoUElOX0dMT0JBTCB8IFBJTl9V
U0VSKSkgPT0gMCk7Ci0JR0VNX0JVR19PTigoZmxhZ3MgJiBQSU5fR0xPQkFMKSAmJiAhaTkxNV92
bWFfaXNfZ2d0dCh2bWEpKTsKKwlib3VuZCA9IGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKTsKKwlk
byB7CisJCWlmICh1bmxpa2VseShmbGFncyAmIH5ib3VuZCkpCisJCQlyZXR1cm4gZmFsc2U7CiAK
LQlpZiAoV0FSTl9PTihib3VuZCAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVykpIHsKLQkJcmV0ID0g
LUVCVVNZOwotCQlnb3RvIGVycl91bnBpbjsKKwkJaWYgKHVubGlrZWx5KGJvdW5kICYgKEk5MTVf
Vk1BX09WRVJGTE9XIHwgSTkxNV9WTUFfRVJST1IpKSkKKwkJCXJldHVybiBmYWxzZTsKKworCQlp
ZiAoIShib3VuZCAmIEk5MTVfVk1BX1BJTl9NQVNLKSkKKwkJCWdvdG8gdW5waW5uZWQ7CisKKwkJ
R0VNX0JVR19PTigoKGJvdW5kICsgMSkgJiBJOTE1X1ZNQV9QSU5fTUFTSykgPT0gMCk7CisJfSB3
aGlsZSAoIWF0b21pY190cnlfY21weGNoZygmdm1hLT5mbGFncywgJmJvdW5kLCBib3VuZCArIDEp
KTsKKworCXJldHVybiB0cnVlOworCit1bnBpbm5lZDoKKwkvKgorCSAqIElmIHBpbl9jb3VudD09
MCwgYnV0IHdlIGFyZSBib3VuZCwgY2hlY2sgdW5kZXIgdGhlIGxvY2sgdG8gYXZvaWQKKwkgKiBy
YWNpbmcgd2l0aCBhIGNvbmN1cnJlbnQgaTkxNV92bWFfdW5iaW5kKCkuCisJICovCisJbXV0ZXhf
bG9jaygmdm1hLT52bS0+bXV0ZXgpOworCWRvIHsKKwkJaWYgKHVubGlrZWx5KGJvdW5kICYgKEk5
MTVfVk1BX09WRVJGTE9XIHwgSTkxNV9WTUFfRVJST1IpKSkgeworCQkJcGlubmVkID0gZmFsc2U7
CisJCQlicmVhazsKKwkJfQorCisJCWlmICh1bmxpa2VseShmbGFncyAmIH5ib3VuZCkpIHsKKwkJ
CXBpbm5lZCA9IGZhbHNlOworCQkJYnJlYWs7CisJCX0KKwl9IHdoaWxlICghYXRvbWljX3RyeV9j
bXB4Y2hnKCZ2bWEtPmZsYWdzLCAmYm91bmQsIGJvdW5kICsgMSkpOworCW11dGV4X3VubG9jaygm
dm1hLT52bS0+bXV0ZXgpOworCisJcmV0dXJuIHBpbm5lZDsKK30KKworc3RhdGljIGludCB2bWFf
Z2V0X3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCWludCBlcnIgPSAwOworCisJaWYg
KGF0b21pY19hZGRfdW5sZXNzKCZ2bWEtPnBhZ2VzX2NvdW50LCAxLCAwKSkKKwkJcmV0dXJuIDA7
CisKKwkvKiBBbGxvY2F0aW9ucyBhaG95ISAqLworCWlmIChtdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJnZtYS0+cGFnZXNfbXV0ZXgpKQorCQlyZXR1cm4gLUVJTlRSOworCisJaWYgKCFhdG9taWNf
cmVhZCgmdm1hLT5wYWdlc19jb3VudCkpIHsKKwkJaWYgKHZtYS0+b2JqKSB7CisJCQllcnIgPSBp
OTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKHZtYS0+b2JqKTsKKwkJCWlmIChlcnIpCisJCQkJZ290
byB1bmxvY2s7CisJCX0KKworCQllcnIgPSB2bWEtPm9wcy0+c2V0X3BhZ2VzKHZtYSk7CisJCWlm
IChlcnIpCisJCQlnb3RvIHVubG9jazsKIAl9CisJYXRvbWljX2luYygmdm1hLT5wYWdlc19jb3Vu
dCk7CiAKLQlpZiAoKGJvdW5kICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSB7Ci0JCXJldCA9
IGk5MTVfdm1hX2luc2VydCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOwotCQlpZiAocmV0
KQotCQkJZ290byBlcnJfdW5waW47Cit1bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZ2bWEtPnBhZ2Vz
X211dGV4KTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyB2b2lkIF9fdm1hX3B1dF9wYWdl
cyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgaW50IGNvdW50KQoreworCS8qIFdlIGFs
bG9jYXRlIHVuZGVyIHZtYV9nZXRfcGFnZXMsIHNvIGJld2FyZSB0aGUgc2hyaW5rZXIgKi8KKwlt
dXRleF9sb2NrX25lc3RlZCgmdm1hLT5wYWdlc19tdXRleCwgU0lOR0xFX0RFUFRIX05FU1RJTkcp
OworCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZtYS0+cGFnZXNfY291bnQpIDwgY291bnQpOwor
CWlmIChhdG9taWNfc3ViX3JldHVybihjb3VudCwgJnZtYS0+cGFnZXNfY291bnQpID09IDApIHsK
KwkJdm1hLT5vcHMtPmNsZWFyX3BhZ2VzKHZtYSk7CisJCUdFTV9CVUdfT04odm1hLT5wYWdlcyk7
CisJCWlmICh2bWEtPm9iaikKKwkJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyh2bWEtPm9i
aik7CiAJfQotCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7
CisJbXV0ZXhfdW5sb2NrKCZ2bWEtPnBhZ2VzX211dGV4KTsKK30KIAotCXJldCA9IGk5MTVfdm1h
X2JpbmQodm1hLCB2bWEtPm9iaiA/IHZtYS0+b2JqLT5jYWNoZV9sZXZlbCA6IDAsIGZsYWdzKTsK
LQlpZiAocmV0KQotCQlnb3RvIGVycl9yZW1vdmU7CitzdGF0aWMgdm9pZCB2bWFfcHV0X3BhZ2Vz
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCWlmIChhdG9taWNfYWRkX3VubGVzcygmdm1hLT5w
YWdlc19jb3VudCwgLTEsIDEpKQorCQlyZXR1cm47CisKKwlfX3ZtYV9wdXRfcGFnZXModm1hLCAx
KTsKK30KKworc3RhdGljIHZvaWQgdm1hX3VuYmluZF9wYWdlcyhzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKK3sKKwl1bnNpZ25lZCBpbnQgY291bnQ7CisKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEt
PnZtLT5tdXRleCk7CisKKwkvKiBUaGUgdXBwZXIgcG9ydGlvbiBvZiBwYWdlc19jb3VudCBpcyB0
aGUgbnVtYmVyIG9mIGJpbmRpbmdzICovCisJY291bnQgPSBhdG9taWNfcmVhZCgmdm1hLT5wYWdl
c19jb3VudCk7CisJY291bnQgPj49IEk5MTVfVk1BX1BBR0VTX0JJQVM7CisJR0VNX0JVR19PTigh
Y291bnQpOworCisJX192bWFfcHV0X3BhZ2VzKHZtYSwgY291bnQgfCBjb3VudCA8PCBJOTE1X1ZN
QV9QQUdFU19CSUFTKTsKK30KKworaW50IGk5MTVfdm1hX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKK3sKKwlzdHJ1Y3QgaTkxNV92
bWFfd29yayAqd29yayA9IE5VTEw7CisJdW5zaWduZWQgaW50IGJvdW5kOworCWludCBlcnI7CisK
KwlCVUlMRF9CVUdfT04oUElOX0dMT0JBTCAhPSBJOTE1X1ZNQV9HTE9CQUxfQklORCk7CisJQlVJ
TERfQlVHX09OKFBJTl9VU0VSICE9IEk5MTVfVk1BX0xPQ0FMX0JJTkQpOworCisJR0VNX0JVR19P
TihmbGFncyAmIFBJTl9VUERBVEUpOworCUdFTV9CVUdfT04oIShmbGFncyAmIChQSU5fVVNFUiB8
IFBJTl9HTE9CQUwpKSk7CisKKwkvKiBGaXJzdCB0cnkgYW5kIGdyYWIgdGhlIHBpbiB3aXRob3V0
IHJlYmluZGluZyB0aGUgdm1hICovCisJaWYgKHRyeV9xYWRfcGluKHZtYSwgZmxhZ3MgJiBJOTE1
X1ZNQV9CSU5EX01BU0spKQorCQlyZXR1cm4gMDsKKworCWVyciA9IHZtYV9nZXRfcGFnZXModm1h
KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJaWYgKGZsYWdzICYgdm1hLT52bS0+Ymlu
ZF9hbGxvYykgeworCQl3b3JrID0gaTkxNV92bWFfd29yaygpOworCQlpZiAoIXdvcmspIHsKKwkJ
CWVyciA9IC1FTk9NRU07CisJCQlnb3RvIGVycl9wYWdlczsKKwkJfQorCX0KKworCS8qIE5vIG1v
cmUgYWxsb2NhdGlvbnMgYWxsb3dlZCBvbmNlIHdlIGhvbGQgdm0tPm11dGV4ICovCisJZXJyID0g
bXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZ2bWEtPnZtLT5tdXRleCk7CisJaWYgKGVycikKKwkJ
Z290byBlcnJfZmVuY2U7CisKKwlib3VuZCA9IGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKTsKKwlp
ZiAodW5saWtlbHkoYm91bmQgJiBJOTE1X1ZNQV9FUlJPUikpIHsKKwkJZXJyID0gLUVOT01FTTsK
KwkJZ290byBlcnJfdW5sb2NrOworCX0KKworCWlmICh1bmxpa2VseSghKChib3VuZCArIDEpICYg
STkxNV9WTUFfUElOX01BU0spKSkgeworCQllcnIgPSAtRUFHQUlOOyAvKiBwaW5zIGFyZSBtZWFu
dCB0byBiZSBmYWlybHkgdGVtcG9yYXJ5ICovCisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwlp
ZiAodW5saWtlbHkoIShmbGFncyAmIH5ib3VuZCAmIEk5MTVfVk1BX0JJTkRfTUFTSykpKSB7CisJ
CV9faTkxNV92bWFfcGluKHZtYSk7CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwllcnIgPSBp
OTE1X2FjdGl2ZV9hY3F1aXJlKCZ2bWEtPmFjdGl2ZSk7CisJaWYgKGVycikKKwkJZ290byBlcnJf
dW5sb2NrOworCisJaWYgKCEoYm91bmQgJiBJOTE1X1ZNQV9CSU5EX01BU0spKSB7CisJCWVyciA9
IGk5MTVfdm1hX2luc2VydCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOworCQlpZiAoZXJy
KQorCQkJZ290byBlcnJfYWN0aXZlOworCisJCWlmIChpOTE1X2lzX2dndHQodm1hLT52bSkpCisJ
CQlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOworCX0KIAotCUdFTV9CVUdf
T04oIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfQklORF9NQVNLKSk7CisJR0VNX0JV
R19PTighdm1hLT5wYWdlcyk7CisJZXJyID0gaTkxNV92bWFfYmluZCh2bWEsCisJCQkgICAgdm1h
LT5vYmogPyB2bWEtPm9iai0+Y2FjaGVfbGV2ZWwgOiAwLAorCQkJICAgIGZsYWdzLCB3b3JrKTsK
KwlpZiAoZXJyKQorCQlnb3RvIGVycl9yZW1vdmU7CiAKLQlpZiAoKGJvdW5kIF4gYXRvbWljX3Jl
YWQoJnZtYS0+ZmxhZ3MpKSAmIEk5MTVfVk1BX0dMT0JBTF9CSU5EKQotCQlfX2k5MTVfdm1hX3Nl
dF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOworCS8qIFRoZXJlIHNob3VsZCBvbmx5IGJlIGF0IG1v
c3QgMiBhY3RpdmUgYmluZGluZ3MgKHVzZXIsIGdsb2JhbCkgKi8KKwlHRU1fQlVHX09OKGJvdW5k
ICsgSTkxNV9WTUFfUEFHRVNfQUNUSVZFIDwgYm91bmQpOworCWF0b21pY19hZGQoSTkxNV9WTUFf
UEFHRVNfQUNUSVZFLCAmdm1hLT5wYWdlc19jb3VudCk7CisJbGlzdF9tb3ZlX3RhaWwoJnZtYS0+
dm1fbGluaywgJnZtYS0+dm0tPmJvdW5kX2xpc3QpOwogCisJX19pOTE1X3ZtYV9waW4odm1hKTsK
KwlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19waW5uZWQodm1hKSk7CisJR0VNX0JVR19PTighaTkx
NV92bWFfaXNfYm91bmQodm1hLCBmbGFncykpOwogCUdFTV9CVUdfT04oaTkxNV92bWFfbWlzcGxh
Y2VkKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncykpOwotCXJldHVybiAwOwogCiBlcnJfcmVt
b3ZlOgotCWlmICgoYm91bmQgJiBJOTE1X1ZNQV9CSU5EX01BU0spID09IDApIHsKKwlpZiAoIWk5
MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfQklORF9NQVNLKSkKIAkJaTkxNV92bWFfcmVt
b3ZlKHZtYSk7Ci0JCUdFTV9CVUdfT04odm1hLT5wYWdlcyk7Ci0JCUdFTV9CVUdfT04oYXRvbWlj
X3JlYWQoJnZtYS0+ZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNLKTsKLQl9Ci1lcnJfdW5waW46
Ci0JX19pOTE1X3ZtYV91bnBpbih2bWEpOwotCXJldHVybiByZXQ7CitlcnJfYWN0aXZlOgorCWk5
MTVfYWN0aXZlX3JlbGVhc2UoJnZtYS0+YWN0aXZlKTsKK2Vycl91bmxvY2s6CisJbXV0ZXhfdW5s
b2NrKCZ2bWEtPnZtLT5tdXRleCk7CitlcnJfZmVuY2U6CisJaWYgKHdvcmspCisJCWRtYV9mZW5j
ZV93b3JrX2NvbW1pdCgmd29yay0+YmFzZSk7CitlcnJfcGFnZXM6CisJdm1hX3B1dF9wYWdlcyh2
bWEpOworCXJldHVybiBlcnI7CiB9CiAKIHZvaWQgaTkxNV92bWFfY2xvc2Uoc3RydWN0IGk5MTVf
dm1hICp2bWEpCkBAIC03NzYsOSArOTcxLDYgQEAgc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9yZW1v
dmVfY2xvc2VkKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdm1hLT52bS0+aTkxNTsKIAotCWlmICghaTkxNV92bWFfaXNfY2xvc2VkKHZt
YSkpCi0JCXJldHVybjsKLQogCXNwaW5fbG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsK
IAlsaXN0X2RlbF9pbml0KCZ2bWEtPmNsb3NlZF9saW5rKTsKIAlzcGluX3VubG9ja19pcnEoJmk5
MTUtPmd0LmNsb3NlZF9sb2NrKTsKQEAgLTc4Niw0MCArOTc4LDM1IEBAIHN0YXRpYyB2b2lkIF9f
aTkxNV92bWFfcmVtb3ZlX2Nsb3NlZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogdm9pZCBpOTE1
X3ZtYV9yZW9wZW4oc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0JX19pOTE1X3ZtYV9yZW1vdmVf
Y2xvc2VkKHZtYSk7CisJaWYgKGk5MTVfdm1hX2lzX2Nsb3NlZCh2bWEpKQorCQlfX2k5MTVfdm1h
X3JlbW92ZV9jbG9zZWQodm1hKTsKIH0KIAotc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9kZXN0cm95
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQordm9pZCBpOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogewotCUdFTV9CVUdfT04oZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKTsKLQlHRU1fQlVHX09OKHZtYS0+ZmVuY2UpOworCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0
ZWQoJnZtYS0+bm9kZSkpIHsKKwkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQlhdG9t
aWNfYW5kKH5JOTE1X1ZNQV9QSU5fTUFTSywgJnZtYS0+ZmxhZ3MpOworCQlXQVJOX09OKF9faTkx
NV92bWFfdW5iaW5kKHZtYSkpOworCQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKKwkJ
R0VNX0JVR19PTihkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOworCX0KKwlHRU1f
QlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKIAogCWlmICh2bWEtPm9iaikgewogCQlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7CiAKIAkJc3Bpbl9sb2Nr
KCZvYmotPnZtYS5sb2NrKTsKIAkJbGlzdF9kZWwoJnZtYS0+b2JqX2xpbmspOwotCQlyYl9lcmFz
ZSgmdm1hLT5vYmpfbm9kZSwgJnZtYS0+b2JqLT52bWEudHJlZSk7CisJCXJiX2VyYXNlKCZ2bWEt
Pm9ial9ub2RlLCAmb2JqLT52bWEudHJlZSk7CiAJCXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2Nr
KTsKIAl9CiAKLQlpOTE1X2FjdGl2ZV9maW5pKCZ2bWEtPmFjdGl2ZSk7Ci0KLQlpOTE1X3ZtYV9m
cmVlKHZtYSk7Ci19Ci0KLXZvaWQgaTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKLXsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQotCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpOwotCiAJX19pOTE1
X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7CisJaTkxNV92bV9wdXQodm1hLT52bSk7CiAKLQlXQVJO
X09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKLQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2
ZSh2bWEpKTsKLQotCV9faTkxNV92bWFfZGVzdHJveSh2bWEpOworCWk5MTVfYWN0aXZlX2Zpbmko
JnZtYS0+YWN0aXZlKTsKKwlpOTE1X3ZtYV9mcmVlKHZtYSk7CiB9CiAKIHZvaWQgaTkxNV92bWFf
cGFya2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpAQCAtODI4LDEyICsxMDE1LDMy
IEBAIHZvaWQgaTkxNV92bWFfcGFya2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CiAJc3Bpbl9sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOwogCWxpc3RfZm9yX2VhY2hf
ZW50cnlfc2FmZSh2bWEsIG5leHQsICZpOTE1LT5ndC5jbG9zZWRfdm1hLCBjbG9zZWRfbGluaykg
ewotCQlsaXN0X2RlbF9pbml0KCZ2bWEtPmNsb3NlZF9saW5rKTsKKwkJc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2JqOworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSA9IHZtYS0+dm07CisKKwkJLyogWFhYIEFsbCB0byBhdm9pZCBrZWVwaW5nIGEgcmVmZXJl
bmNlIG9uIGk5MTVfdm1hIGl0c2VsZiAqLworCisJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8o
Jm9iai0+YmFzZS5yZWZjb3VudCkpCisJCQljb250aW51ZTsKKworCQlpZiAoIWk5MTVfdm1fdHJ5
b3Blbih2bSkpIHsKKwkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJCW9iaiA9IE5VTEw7
CisJCX0KKwogCQlzcGluX3VubG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAotCQlp
OTE1X3ZtYV9kZXN0cm95KHZtYSk7CisJCWlmIChvYmopIHsKKwkJCWk5MTVfdm1hX2Rlc3Ryb3ko
dm1hKTsKKwkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJfQogCisJCWk5MTVfdm1fY2xv
c2Uodm0pOworCisJCS8qIFJlc3RhcnQgYWZ0ZXIgZHJvcHBpbmcgbG9jayAqLwogCQlzcGluX2xv
Y2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CisJCW5leHQgPSBsaXN0X2ZpcnN0X2VudHJ5
KCZpOTE1LT5ndC5jbG9zZWRfdm1hLAorCQkJCQl0eXBlb2YoKm5leHQpLCBjbG9zZWRfbGluayk7
CiAJfQogCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOwogfQpAQCAtODcz
LDYgKzEwODAsMjAgQEAgdm9pZCBpOTE1X3ZtYV9yZXZva2VfbW1hcChzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIAkJbGlzdF9kZWwoJnZtYS0+b2JqLT51c2VyZmF1bHRfbGluayk7CiB9CiAKK2ludCBf
X2k5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSkKK3sKKwlpbnQgZXJyOworCisJR0VNX0JVR19PTighaTkxNV92bWFfaXNf
cGlubmVkKHZtYSkpOworCisJLyogV2FpdCBmb3IgdGhlIHZtYSB0byBiZSBib3VuZCBiZWZvcmUg
d2Ugc3RhcnQhICovCisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShycSwgJnZtYS0+
YWN0aXZlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIGk5MTVfYWN0aXZl
X2FkZF9yZXF1ZXN0KCZ2bWEtPmFjdGl2ZSwgcnEpOworfQorCiBpbnQgaTkxNV92bWFfbW92ZV90
b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQkgICAgc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEsCiAJCQkgICAgdW5zaWduZWQgaW50IGZsYWdzKQpAQCAtODgwLDE5ICsxMTAxLDkgQEAg
aW50IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKIAlpbnQgZXJyOwogCi0JYXNz
ZXJ0X3ZtYV9oZWxkKHZtYSk7CiAJYXNzZXJ0X29iamVjdF9oZWxkKG9iaik7Ci0JR0VNX0JVR19P
TighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAotCS8qCi0JICogQWRkIGEg
cmVmZXJlbmNlIGlmIHdlJ3JlIG5ld2x5IGVudGVyaW5nIHRoZSBhY3RpdmUgbGlzdC4KLQkgKiBU
aGUgb3JkZXIgaW4gd2hpY2ggd2UgYWRkIG9wZXJhdGlvbnMgdG8gdGhlIHJldGlyZW1lbnQgcXVl
dWUgaXMKLQkgKiB2aXRhbCBoZXJlOiBtYXJrX2FjdGl2ZSBhZGRzIHRvIHRoZSBzdGFydCBvZiB0
aGUgY2FsbGJhY2sgbGlzdCwKLQkgKiBzdWNoIHRoYXQgc3Vic2VxdWVudCBjYWxsYmFja3MgYXJl
IGNhbGxlZCBmaXJzdC4gVGhlcmVmb3JlIHdlCi0JICogYWRkIHRoZSBhY3RpdmUgcmVmZXJlbmNl
IGZpcnN0IGFuZCBxdWV1ZSBmb3IgaXQgdG8gYmUgZHJvcHBlZAotCSAqICpsYXN0Ki4KLQkgKi8K
LQllcnIgPSBpOTE1X2FjdGl2ZV9hZGRfcmVxdWVzdCgmdm1hLT5hY3RpdmUsIHJxKTsKKwllcnIg
PSBfX2k5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEpOwogCWlmICh1bmxpa2VseShlcnIp
KQogCQlyZXR1cm4gZXJyOwogCkBAIC05MTgsMzggKzExMjksMjMgQEAgaW50IGk5MTVfdm1hX21v
dmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCXJldHVybiAwOwogfQogCi1pbnQg
aTkxNV92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoraW50IF9faTkxNV92bWFfdW5i
aW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZ2bWEtPnZtLT5tdXRleCk7CiAKIAkvKgogCSAqIEZpcnN0IHdhaXQgdXBvbiBhbnkg
YWN0aXZpdHkgYXMgcmV0aXJpbmcgdGhlIHJlcXVlc3QgbWF5CiAJICogaGF2ZSBzaWRlLWVmZmVj
dHMgc3VjaCBhcyB1bnBpbm5pbmcgb3IgZXZlbiB1bmJpbmRpbmcgdGhpcyB2bWEuCisJICoKKwkg
KiBYWFggQWN0dWFsbHkgd2FpdGluZyB1bmRlciB0aGUgdm0tPm11dGV4IGlzIGEgaGluZGVyYW5j
ZSBhbmQKKwkgKiBzaG91bGQgYmUgcGlwZWxpbmVkIHdoZXJldmVyIHBvc3NpYmxlLiBJbiBjYXNl
cyB3aGVyZSB0aGF0IGlzCisJICogdW5hdm9pZGFibGUsIHdlIHNob3VsZCBsaWZ0IHRoZSB3YWl0
IHRvIGJlZm9yZSB0aGUgbXV0ZXguCiAJICovCi0JbWlnaHRfc2xlZXAoKTsKLQlpZiAoaTkxNV92
bWFfaXNfYWN0aXZlKHZtYSkpIHsKLQkJLyoKLQkJICogV2hlbiBhIGNsb3NlZCBWTUEgaXMgcmV0
aXJlZCwgaXQgaXMgdW5ib3VuZCAtIGVlay4KLQkJICogSW4gb3JkZXIgdG8gcHJldmVudCBpdCBm
cm9tIGJlaW5nIHJlY3Vyc2l2ZWx5IGNsb3NlZCwKLQkJICogdGFrZSBhIHBpbiBvbiB0aGUgdm1h
IHNvIHRoYXQgdGhlIHNlY29uZCB1bmJpbmQgaXMKLQkJICogYWJvcnRlZC4KLQkJICoKLQkJICog
RXZlbiBtb3JlIHNjYXJ5IGlzIHRoYXQgdGhlIHJldGlyZSBjYWxsYmFjayBtYXkgZnJlZQotCQkg
KiB0aGUgb2JqZWN0IChsYXN0IGFjdGl2ZSB2bWEpLiBUbyBwcmV2ZW50IHRoZSBleHBsb3Npb24K
LQkJICogd2UgZGVmZXIgdGhlIGFjdHVhbCBvYmplY3QgZnJlZSB0byBhIHdvcmtlciB0aGF0IGNh
bgotCQkgKiBvbmx5IHByb2NlZWQgb25jZSBpdCBhY3F1aXJlcyB0aGUgc3RydWN0X211dGV4ICh3
aGljaAotCQkgKiB3ZSBjdXJyZW50bHkgaG9sZCwgdGhlcmVmb3JlIGl0IGNhbm5vdCBmcmVlIHRo
aXMgb2JqZWN0Ci0JCSAqIGJlZm9yZSB3ZSBhcmUgZmluaXNoZWQpLgotCQkgKi8KLQkJX19pOTE1
X3ZtYV9waW4odm1hKTsKLQkJcmV0ID0gaTkxNV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUpOwot
CQlfX2k5MTVfdm1hX3VucGluKHZtYSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0K
LQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKKwlyZXQgPSBpOTE1X3ZtYV9z
eW5jKHZtYSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKIAogCWlmIChpOTE1X3ZtYV9pc19w
aW5uZWQodm1hKSkgewogCQl2bWFfcHJpbnRfYWxsb2NhdG9yKHZtYSwgImlzIHBpbm5lZCIpOwpA
QCAtOTcwLDE2ICsxMTY2LDEyIEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiAJCUdFTV9CVUdfT04oaTkxNV92bWFfaGFzX2dndHRfd3JpdGUodm1hKSk7CiAKIAkJ
LyogcmVsZWFzZSB0aGUgZmVuY2UgcmVnIF9hZnRlcl8gZmx1c2hpbmcgKi8KLQkJbXV0ZXhfbG9j
aygmdm1hLT52bS0+bXV0ZXgpOwogCQlyZXQgPSBpOTE1X3ZtYV9yZXZva2VfZmVuY2Uodm1hKTsK
LQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4g
cmV0OwogCiAJCS8qIEZvcmNlIGEgcGFnZWZhdWx0IGZvciBkb21haW4gdHJhY2tpbmcgb24gbmV4
dCB1c2VyIGFjY2VzcyAqLwotCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCWk5MTVf
dm1hX3Jldm9rZV9tbWFwKHZtYSk7Ci0JCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwog
CiAJCV9faTkxNV92bWFfaW91bm1hcCh2bWEpOwogCQljbGVhcl9iaXQoSTkxNV9WTUFfQ0FOX0ZF
TkNFX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKTsKQEAgLTk4NywxNyArMTE3OSwzMyBAQCBp
bnQgaTkxNV92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCUdFTV9CVUdfT04odm1h
LT5mZW5jZSk7CiAJR0VNX0JVR19PTihpOTE1X3ZtYV9oYXNfdXNlcmZhdWx0KHZtYSkpOwogCi0J
aWYgKGxpa2VseSghdm1hLT52bS0+Y2xvc2VkKSkgeworCWlmIChsaWtlbHkoYXRvbWljX3JlYWQo
JnZtYS0+dm0tPm9wZW4pKSkgewogCQl0cmFjZV9pOTE1X3ZtYV91bmJpbmQodm1hKTsKIAkJdm1h
LT5vcHMtPnVuYmluZF92bWEodm1hKTsKIAl9Ci0JYXRvbWljX2FuZCh+STkxNV9WTUFfQklORF9N
QVNLLCAmdm1hLT5mbGFncyk7CisJYXRvbWljX2FuZCh+KEk5MTVfVk1BX0JJTkRfTUFTSyB8IEk5
MTVfVk1BX0VSUk9SKSwgJnZtYS0+ZmxhZ3MpOwogCisJdm1hX3VuYmluZF9wYWdlcyh2bWEpOwog
CWk5MTVfdm1hX3JlbW92ZSh2bWEpOwogCiAJcmV0dXJuIDA7CiB9CiAKK2ludCBpOTE1X3ZtYV91
bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0gPSB2bWEtPnZtOworCWludCBlcnI7CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJnZtLT5tdXRleCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IF9f
aTkxNV92bWFfdW5iaW5kKHZtYSk7CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOworCisJcmV0
dXJuIGVycjsKK30KKwogc3RydWN0IGk5MTVfdm1hICppOTE1X3ZtYV9tYWtlX3Vuc2hyaW5rYWJs
ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlpOTE1X2dlbV9vYmplY3RfbWFrZV91bnNocmlu
a2FibGUodm1hLT5vYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKaW5kZXggZTQ5YjE5OWY3ZGU3
Li44NTg5MDhlM2QxY2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaApAQCAtOTYsMjUgKzk2LDI4
IEBAIHN0cnVjdCBpOTE1X3ZtYSB7CiAJICogZXhjbHVzaXZlIGNhY2hlbGluZXMgb2YgYSBzaW5n
bGUgcGFnZSwgc28gYSBtYXhpbXVtIG9mIDY0IHBvc3NpYmxlCiAJICogdXNlcnMuCiAJICovCi0j
ZGVmaW5lIEk5MTVfVk1BX1BJTl9NQVNLIDB4ZmYKLSNkZWZpbmUgSTkxNV9WTUFfUElOX09WRVJG
TE9XX0JJVCA4Ci0jZGVmaW5lIEk5MTVfVk1BX1BJTl9PVkVSRkxPVwkoKGludClCSVQoSTkxNV9W
TUFfUElOX09WRVJGTE9XX0JJVCkpCisjZGVmaW5lIEk5MTVfVk1BX1BJTl9NQVNLIDB4M2ZmCisj
ZGVmaW5lIEk5MTVfVk1BX09WRVJGTE9XIDB4MjAwCiAKIAkvKiogRmxhZ3MgYW5kIGFkZHJlc3Mg
c3BhY2UgdGhpcyBWTUEgaXMgYm91bmQgdG8gKi8KLSNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJ
TkRfQklUIDkKLSNkZWZpbmUgSTkxNV9WTUFfTE9DQUxfQklORF9CSVQgMTAKKyNkZWZpbmUgSTkx
NV9WTUFfR0xPQkFMX0JJTkRfQklUIDEwCisjZGVmaW5lIEk5MTVfVk1BX0xPQ0FMX0JJTkRfQklU
ICAxMQogCiAjZGVmaW5lIEk5MTVfVk1BX0dMT0JBTF9CSU5ECSgoaW50KUJJVChJOTE1X1ZNQV9H
TE9CQUxfQklORF9CSVQpKQogI2RlZmluZSBJOTE1X1ZNQV9MT0NBTF9CSU5ECSgoaW50KUJJVChJ
OTE1X1ZNQV9MT0NBTF9CSU5EX0JJVCkpCiAKLSNkZWZpbmUgSTkxNV9WTUFfQklORF9NQVNLIChJ
OTE1X1ZNQV9HTE9CQUxfQklORCB8IFwKLQkJCSAgICBJOTE1X1ZNQV9MT0NBTF9CSU5EIHwgXAot
CQkJICAgIEk5MTVfVk1BX1BJTl9PVkVSRkxPVykKKyNkZWZpbmUgSTkxNV9WTUFfQklORF9NQVNL
IChJOTE1X1ZNQV9HTE9CQUxfQklORCB8IEk5MTVfVk1BX0xPQ0FMX0JJTkQpCiAKLSNkZWZpbmUg
STkxNV9WTUFfR0dUVF9CSVQJMTEKLSNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVAkxMgot
I2RlZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklUCTEzCi0jZGVmaW5lIEk5MTVfVk1BX0dHVFRf
V1JJVEVfQklUCTE0CisjZGVmaW5lIEk5MTVfVk1BX0FMTE9DX0JJVAkxMgorI2RlZmluZSBJOTE1
X1ZNQV9BTExPQwkJKChpbnQpQklUKEk5MTVfVk1BX0FMTE9DX0JJVCkpCisKKyNkZWZpbmUgSTkx
NV9WTUFfRVJST1JfQklUCTEzCisjZGVmaW5lIEk5MTVfVk1BX0VSUk9SCQkoKGludClCSVQoSTkx
NV9WTUFfRVJST1JfQklUKSkKKworI2RlZmluZSBJOTE1X1ZNQV9HR1RUX0JJVAkxNAorI2RlZmlu
ZSBJOTE1X1ZNQV9DQU5fRkVOQ0VfQklUCTE1CisjZGVmaW5lIEk5MTVfVk1BX1VTRVJGQVVMVF9C
SVQJMTYKKyNkZWZpbmUgSTkxNV9WTUFfR0dUVF9XUklURV9CSVQJMTcKIAogI2RlZmluZSBJOTE1
X1ZNQV9HR1RUCQkoKGludClCSVQoSTkxNV9WTUFfR0dUVF9CSVQpKQogI2RlZmluZSBJOTE1X1ZN
QV9DQU5fRkVOQ0UJKChpbnQpQklUKEk5MTVfVk1BX0NBTl9GRU5DRV9CSVQpKQpAQCAtMTIzLDYg
KzEyNiwxMSBAQCBzdHJ1Y3QgaTkxNV92bWEgewogCiAJc3RydWN0IGk5MTVfYWN0aXZlIGFjdGl2
ZTsKIAorI2RlZmluZSBJOTE1X1ZNQV9QQUdFU19CSUFTIDI0CisjZGVmaW5lIEk5MTVfVk1BX1BB
R0VTX0FDVElWRSAoQklUKDI0KSB8IDEpCisJYXRvbWljX3QgcGFnZXNfY291bnQ7IC8qIG51bWJl
ciBvZiBhY3RpdmUgYmluZHMgdG8gdGhlIHBhZ2VzICovCisJc3RydWN0IG11dGV4IHBhZ2VzX211
dGV4OyAvKiBwcm90ZWN0IGFjcXVpcmUvcmVsZWFzZSBvZiBiYWNraW5nIHBhZ2VzICovCisKIAkv
KioKIAkgKiBTdXBwb3J0IGRpZmZlcmVudCBHR1RUIHZpZXdzIGludG8gdGhlIHNhbWUgb2JqZWN0
LgogCSAqIFRoaXMgbWVhbnMgdGhlcmUgY2FuIGJlIG11bHRpcGxlIFZNQSBtYXBwaW5ncyBwZXIg
b2JqZWN0IGFuZCBwZXIgVk0uCkBAIC0xNjksNiArMTc3LDggQEAgc3RhdGljIGlubGluZSBib29s
IGk5MTVfdm1hX2lzX2FjdGl2ZShjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlyZXR1cm4g
IWk5MTVfYWN0aXZlX2lzX2lkbGUoJnZtYS0+YWN0aXZlKTsKIH0KIAoraW50IF9fbXVzdF9jaGVj
ayBfX2k5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAorCQkJCQkg
ICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX21v
dmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJCQkgc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEsCiAJCQkJCSB1bnNpZ25lZCBpbnQgZmxhZ3MpOwpAQCAtMzA3LDEzICszMTcsMTgg
QEAgaTkxNV92bWFfY29tcGFyZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlyZXR1cm4gbWVtY21w
KCZ2bWEtPmdndHRfdmlldy5wYXJ0aWFsLCAmdmlldy0+cGFydGlhbCwgdmlldy0+dHlwZSk7CiB9
CiAKLWludCBpOTE1X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2Fj
aGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCi0JCSAgdTMyIGZsYWdzKTsKK3N0cnVjdCBpOTE1X3ZtYV93
b3JrICppOTE1X3ZtYV93b3JrKHZvaWQpOworaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVf
dm1hICp2bWEsCisJCSAgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAorCQkgIHUz
MiBmbGFncywKKwkJICBzdHJ1Y3QgaTkxNV92bWFfd29yayAqd29yayk7CisKIGJvb2wgaTkxNV9n
ZW1fdmFsaWRfZ3R0X3NwYWNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGNv
bG9yKTsKIGJvb2wgaTkxNV92bWFfbWlzcGxhY2VkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LAogCQkJdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7CiB2b2lkIF9faTkxNV92
bWFfc2V0X21hcF9hbmRfZmVuY2VhYmxlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIHZvaWQgaTkx
NV92bWFfcmV2b2tlX21tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpOworaW50IF9faTkxNV92bWFf
dW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIGludCBfX211c3RfY2hlY2sgaTkxNV92bWFf
dW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIHZvaWQgaTkxNV92bWFfdW5saW5rX2N0eChz
dHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiB2b2lkIGk5MTVfdm1hX2Nsb3NlKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKTsKQEAgLTMzMiwyNiArMzQ3LDggQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1h
X3VubG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlkbWFfcmVzdl91bmxvY2sodm1hLT5yZXN2
KTsKIH0KIAotaW50IF9faTkxNV92bWFfZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkg
ICAgICB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKTsKLXN0YXRpYyBpbmxpbmUg
aW50IF9fbXVzdF9jaGVjawotaTkxNV92bWFfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQg
c2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQotewotCUJVSUxEX0JVR19PTihQSU5fTUJa
ICE9IEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7Ci0JQlVJTERfQlVHX09OKFBJTl9HTE9CQUwgIT0g
STkxNV9WTUFfR0xPQkFMX0JJTkQpOwotCUJVSUxEX0JVR19PTihQSU5fVVNFUiAhPSBJOTE1X1ZN
QV9MT0NBTF9CSU5EKTsKLQotCS8qIFBpbiBlYXJseSB0byBwcmV2ZW50IHRoZSBzaHJpbmtlci9l
dmljdGlvbiBsb2dpYyBmcm9tIGRlc3Ryb3lpbmcKLQkgKiBvdXIgdm1hIGFzIHdlIGluc2VydCBh
bmQgYmluZC4KLQkgKi8KLQlpZiAobGlrZWx5KCgoYXRvbWljX2luY19yZXR1cm4oJnZtYS0+Zmxh
Z3MpIF4gZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSkgewotCQlHRU1fQlVHX09O
KCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwotCQlHRU1fQlVHX09OKGk5MTVf
dm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsKLQkJcmV0dXJuIDA7
Ci0JfQotCi0JcmV0dXJuIF9faTkxNV92bWFfZG9fcGluKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBm
bGFncyk7Ci19CitpbnQgX19tdXN0X2NoZWNrCitpOTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1h
ICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpOwogCiBzdGF0aWMgaW5s
aW5lIGludCBpOTE1X3ZtYV9waW5fY291bnQoY29uc3Qgc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7
CkBAIC0zNjYsMTcgKzM2MywxNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV92bWFfaXNfcGlu
bmVkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogc3RhdGljIGlubGluZSB2b2lkIF9faTkx
NV92bWFfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCWF0b21pY19pbmMoJnZtYS0+Zmxh
Z3MpOwotCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpICYgSTkxNV9WTUFfUElO
X09WRVJGTE9XKTsKKwlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19waW5uZWQodm1hKSk7CiB9CiAK
IHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQogeworCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKTsKIAlhdG9taWNfZGVj
KCZ2bWEtPmZsYWdzKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1hX3VucGluKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX3Bpbm5lZCh2
bWEpKTsKIAlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwog
CV9faTkxNV92bWFfdW5waW4odm1hKTsKIH0KQEAgLTQwMiw4ICszOTksNiBAQCBzdGF0aWMgaW5s
aW5lIGJvb2wgaTkxNV9ub2RlX2NvbG9yX2RpZmZlcnMoY29uc3Qgc3RydWN0IGRybV9tbV9ub2Rl
ICpub2RlLAogICogdGhlIGNhbGxlciBtdXN0IGNhbGwgaTkxNV92bWFfdW5waW5faW9tYXAgdG8g
cmVsaW5xdWlzaCB0aGUgcGlubmluZwogICogYWZ0ZXIgdGhlIGlvbWFwcGluZyBpcyBubyBsb25n
ZXIgcmVxdWlyZWQuCiAgKgotICogQ2FsbGVycyBtdXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRleC4K
LSAqCiAgKiBSZXR1cm5zIGEgdmFsaWQgaW9tYXBwZWQgcG9pbnRlciBvciBFUlJfUFRSLgogICov
CiB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7
CkBAIC00MTUsOCArNDEwLDggQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpOwogICoKICAqIFVucGlucyB0aGUgcHJldmlvdXNseSBpb21hcHBl
ZCBWTUEgZnJvbSBpOTE1X3ZtYV9waW5faW9tYXAoKS4KICAqCi0gKiBDYWxsZXJzIG11c3QgaG9s
ZCB0aGUgc3RydWN0X211dGV4LiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgdmFsaWQgdG8gYmUKLSAq
IGNhbGxlZCBvbiBhIFZNQSBwcmV2aW91c2x5IGlvbWFwcGVkIGJ5IHRoZSBjYWxsZXIgd2l0aCBp
OTE1X3ZtYV9waW5faW9tYXAoKS4KKyAqIFRoaXMgZnVuY3Rpb24gaXMgb25seSB2YWxpZCB0byBi
ZSBjYWxsZWQgb24gYSBWTUEgcHJldmlvdXNseQorICogaW9tYXBwZWQgYnkgdGhlIGNhbGxlciB3
aXRoIGk5MTVfdm1hX3Bpbl9pb21hcCgpLgogICovCiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFw
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIApAQCAtNDQ0LDYgKzQzOSw4IEBAIHN0YXRpYyBpbmxp
bmUgc3RydWN0IHBhZ2UgKmk5MTVfdm1hX2ZpcnN0X3BhZ2Uoc3RydWN0IGk5MTVfdm1hICp2bWEp
CiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSk7CiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Jldm9rZV9mZW5jZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSk7CiAKK2ludCBfX2k5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSk7CisKIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewogCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZtYS0+ZmVuY2UtPnBp
bl9jb3VudCkgPD0gMCk7CkBAIC00NjEsNyArNDU4LDYgQEAgc3RhdGljIGlubGluZSB2b2lkIF9f
aTkxNV92bWFfdW5waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiBzdGF0aWMgaW5saW5l
IHZvaWQKIGk5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCS8q
IGxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOyAq
LwogCWlmICh2bWEtPmZlbmNlKQogCQlfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CiB9CkBA
IC00OTAsNCArNDg2LDEwIEBAIHN0cnVjdCBpOTE1X3ZtYSAqaTkxNV92bWFfbWFrZV91bnNocmlu
a2FibGUoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogdm9pZCBpOTE1X3ZtYV9tYWtlX3Nocmlua2Fi
bGUoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogdm9pZCBpOTE1X3ZtYV9tYWtlX3B1cmdlYWJsZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKK3N0YXRpYyBpbmxpbmUgaW50IGk5MTVfdm1hX3N5bmMo
c3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJLyogV2FpdCBmb3IgdGhlIGFzeW5jaHJvbm91cyBi
aW5kaW5ncyBhbmQgcGVuZGluZyBHUFUgcmVhZHMgKi8KKwlyZXR1cm4gaTkxNV9hY3RpdmVfd2Fp
dCgmdm1hLT5hY3RpdmUpOworfQorCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtLmMKaW5kZXggMzc1OTM4MzFiNTM5Li4wMzQ2YzNlNWI2YjYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCkBAIC0xMTksMTAgKzExOSw4IEBA
IHN0YXRpYyB2b2lkIHBtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJ
aW50ZWxfZ3Rfc2FuaXRpemUoJmk5MTUtPmd0LCBmYWxzZSk7CiAJCWk5MTVfZ2VtX3Nhbml0aXpl
KGk5MTUpOwogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpOTE1
X2dlbV9yZXN0b3JlX2d0dF9tYXBwaW5ncyhpOTE1KTsKIAkJaTkxNV9nZW1fcmVzdG9yZV9mZW5j
ZXMoaTkxNSk7Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJ
aTkxNV9nZW1fcmVzdW1lKGk5MTUpOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKaW5kZXggMjkwNWZiMjFkODY2Li43NWE0Njk1YjgyYmIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmlj
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5j
CkBAIC0xMDYsMTQgKzEwNiwxMSBAQCBzdGF0aWMgaW50IHBvcHVsYXRlX2dndHQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIHN0YXRpYyB2b2lkIHVucGluX2dndHQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZpOTE1
LT5nZ3R0OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCi0JbXV0ZXhfbG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmaTkxNS0+Z2d0dC52bS5ib3VuZF9s
aXN0LCB2bV9saW5rKQogCQlpZiAodm1hLT5vYmotPm1tLnF1aXJrZWQpCiAJCQlpOTE1X3ZtYV91
bnBpbih2bWEpOwotCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogfQogCiBzdGF0aWMg
dm9pZCBjbGVhbnVwX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCkBAIC0x
MjcsMTEgKzEyNCw3IEBAIHN0YXRpYyB2b2lkIGNsZWFudXBfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCX0KIAotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcmFpbl9m
cmVlZF9vYmplY3RzKGk5MTUpOwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiB9CiAKIHN0YXRpYyBpbnQgaWd0X2V2aWN0X3NvbWV0aGluZyh2b2lkICphcmcpCkBAIC0x
NDgsMTAgKzE0MSwxMiBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9zb21ldGhpbmcodm9pZCAqYXJn
KQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90aGluZyBz
aG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5
MTVfZ2VtX2V2aWN0X3NvbWV0aGluZygmZ2d0dC0+dm0sCiAJCQkJICAgICAgIEk5MTVfR1RUX1BB
R0VfU0laRSwgMCwgMCwKIAkJCQkgICAgICAgMCwgVTY0X01BWCwKIAkJCQkgICAgICAgMCk7CisJ
bXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVyciAhPSAtRU5PU1BDKSB7CiAJ
CXByX2VycigiaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nIGZhaWxlZCBvbiBhIGZ1bGwgR0dUVCB3
aXRoIGVycj0lZFxuIiwKIAkJICAgICAgIGVycik7CkBAIC0xNjEsMTAgKzE1NiwxMiBAQCBzdGF0
aWMgaW50IGlndF9ldmljdF9zb21ldGhpbmcodm9pZCAqYXJnKQogCXVucGluX2dndHQoaTkxNSk7
CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHVucGlubmVkLCB3ZSBzaG91bGQgYmUgYWJsZSB0byBldmlj
dCBzb21ldGhpbmcgKi8KKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkx
NV9nZW1fZXZpY3Rfc29tZXRoaW5nKCZnZ3R0LT52bSwKIAkJCQkgICAgICAgSTkxNV9HVFRfUEFH
RV9TSVpFLCAwLCAwLAogCQkJCSAgICAgICAwLCBVNjRfTUFYLAogCQkJCSAgICAgICAwKTsKKwlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkx
NV9nZW1fZXZpY3Rfc29tZXRoaW5nIGZhaWxlZCBvbiBhIGZ1bGwgR0dUVCB3aXRoIGVycj0lZFxu
IiwKIAkJICAgICAgIGVycik7CkBAIC0yMzAsNyArMjI3LDkgQEAgc3RhdGljIGludCBpZ3RfZXZp
Y3RfZm9yX3ZtYSh2b2lkICphcmcpCiAJCWdvdG8gY2xlYW51cDsKIAogCS8qIEV2ZXJ5dGhpbmcg
aXMgcGlubmVkLCBub3RoaW5nIHNob3VsZCBoYXBwZW4gKi8KKwltdXRleF9sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoJmdndHQtPnZtLCAmdGFy
Z2V0LCAwKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyICE9IC1F
Tk9TUEMpIHsKIAkJcHJfZXJyKCJpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSBvbiBhIGZ1bGwgR0dU
VCByZXR1cm5lZCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMjQwLDcgKzIzOSw5IEBA
IHN0YXRpYyBpbnQgaWd0X2V2aWN0X2Zvcl92bWEodm9pZCAqYXJnKQogCXVucGluX2dndHQoaTkx
NSk7CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHVucGlubmVkLCB3ZSBzaG91bGQgYmUgYWJsZSB0byBl
dmljdCB0aGUgbm9kZSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBp
OTE1X2dlbV9ldmljdF9mb3Jfbm9kZSgmZ2d0dC0+dm0sICZ0YXJnZXQsIDApOworCW11dGV4X3Vu
bG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJpOTE1X2dlbV9l
dmljdF9mb3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMzE5
LDcgKzMyMCw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2Zvcl9jYWNoZV9jb2xvcih2b2lkICph
cmcpCiAJaTkxNV92bWFfdW5waW4odm1hKTsKIAogCS8qIFJlbW92ZSBqdXN0IHRoZSBzZWNvbmQg
dm1hICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2
aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIlswXWk5MTVfZ2VtX2V2aWN0X2Zv
cl9ub2RlIHJldHVybmVkIGVycj0lZFxuIiwgZXJyKTsKIAkJZ290byBjbGVhbnVwOwpAQCAtMzMw
LDcgKzMzMyw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2Zvcl9jYWNoZV9jb2xvcih2b2lkICph
cmcpCiAJICovCiAJdGFyZ2V0LmNvbG9yID0gSTkxNV9DQUNIRV9MM19MTEM7CiAKKwltdXRleF9s
b2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoJmdn
dHQtPnZtLCAmdGFyZ2V0LCAwKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlp
ZiAoIWVycikgewogCQlwcl9lcnIoIlsxXWk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlIHJldHVybmVk
IGVycj0lZFxuIiwgZXJyKTsKIAkJZXJyID0gLUVJTlZBTDsKQEAgLTM2MCw3ICszNjUsOSBAQCBz
dGF0aWMgaW50IGlndF9ldmljdF92bSh2b2lkICphcmcpCiAJCWdvdG8gY2xlYW51cDsKIAogCS8q
IEV2ZXJ5dGhpbmcgaXMgcGlubmVkLCBub3RoaW5nIHNob3VsZCBoYXBwZW4gKi8KKwltdXRleF9s
b2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oJmdndHQtPnZt
KTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2Vy
cigiaTkxNV9nZW1fZXZpY3Rfdm0gb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVkXVxuIiwK
IAkJICAgICAgIGVycik7CkBAIC0zNjksNyArMzc2LDkgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rf
dm0odm9pZCAqYXJnKQogCiAJdW5waW5fZ2d0dChpOTE1KTsKIAorCW11dGV4X2xvY2soJmdndHQt
PnZtLm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF92bSgmZ2d0dC0+dm0pOworCW11dGV4
X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJpOTE1X2dl
bV9ldmljdF92bSBvbiBhIGZ1bGwgR0dUVCByZXR1cm5lZCBlcnI9JWRdXG4iLAogCQkgICAgICAg
ZXJyKTsKQEAgLTQxMCwxMSArNDE5LDExIEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRz
KHZvaWQgKmFyZykKIAlpZiAoIUhBU19GVUxMX1BQR1RUKGk5MTUpKQogCQlyZXR1cm4gMDsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAKIAkvKiBSZXNlcnZlIGEgYmxvY2sg
c28gdGhhdCB3ZSBrbm93IHdlIGhhdmUgZW5vdWdoIHRvIGZpdCBhIGZldyBycSAqLwogCW1lbXNl
dCgmaG9sZSwgMCwgc2l6ZW9mKGhvbGUpKTsKKwltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11
dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZpOTE1LT5nZ3R0LnZtLCAmaG9sZSwK
IAkJCQkgIFBSRVRFTkRfR0dUVF9TSVpFLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAogCQkJ
CSAgMCwgaTkxNS0+Z2d0dC52bS50b3RhbCwKQEAgLTQyNyw3ICs0MzYsOSBAQCBzdGF0aWMgaW50
IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJZG8gewogCQlzdHJ1Y3QgcmVzZXJ2ZWQg
KnI7CiAKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAkJciA9IGtjYWxs
b2MoMSwgc2l6ZW9mKCpyKSwgR0ZQX0tFUk5FTCk7CisJCW11dGV4X2xvY2soJmk5MTUtPmdndHQu
dm0ubXV0ZXgpOwogCQlpZiAoIXIpIHsKIAkJCWVyciA9IC1FTk9NRU07CiAJCQlnb3RvIG91dF9s
b2NrZWQ7CkBAIC00NDcsNyArNDU4LDcgQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHMo
dm9pZCAqYXJnKQogCQljb3VudCsrOwogCX0gd2hpbGUgKDEpOwogCWRybV9tbV9yZW1vdmVfbm9k
ZSgmaG9sZSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRl
eF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCXByX2luZm8oIkZpbGxlZCBHR1RUIHdp
dGggJWx1IDFNaUIgbm9kZXNcbiIsIGNvdW50KTsKIAogCS8qIE92ZXJmaWxsIHRoZSBHR1RUIHdp
dGggY29udGV4dCBvYmplY3RzIGFuZCBzbyB0cnkgdG8gZXZpY3Qgb25lLiAqLwpAQCAtNTEwLDcg
KzUyMSw3IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAkJCWJy
ZWFrOwogCX0KIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4
X2xvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogb3V0X2xvY2tlZDoKIAlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCiAJCWVyciA9IC1FSU87CkBAIC01MjQsOCAr
NTM1LDggQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCX0KIAlp
ZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZob2xlKSkKIAkJZHJtX21tX3JlbW92ZV9ub2RlKCZo
b2xlKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCWludGVsX3J1bnRp
bWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTU0NywxMiArNTU4
LDkgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJaWYgKCFpOTE1
KQogCQlyZXR1cm4gLUVOT01FTTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZikK
IAkJZXJyID0gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CiAKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZHJtX2Rldl9wdXQoJmk5MTUtPmRybSk7CiAJcmV0
dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9n
dHQuYwppbmRleCA4NGQ5NGVhYmM3ZGQuLjM3M2ZiZDU4YTE3YSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwpAQCAtMzgsMTYgKzM4LDcgQEAKIAog
c3RhdGljIHZvaWQgY2xlYW51cF9mcmVlZF9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCS8qCi0JICogQXMgd2UgbWF5IGhvbGQgb250byB0aGUgc3RydWN0X211dGV4
IGZvciBpbm9yZGluYXRlIGxlbmd0aHMgb2YKLQkgKiB0aW1lLCB0aGUgTk1JIGtodW5ndGFza2Qg
ZGV0ZWN0b3IgbWF5IGZpcmUgZm9yIHRoZSBmcmVlIG9iamVjdHMKLQkgKiB3b3JrZXIuCi0JICov
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfZ2VtX2Ry
YWluX2ZyZWVkX29iamVjdHMoaTkxNSk7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgZmFrZV9mcmVlX3BhZ2VzKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCkBAIC04ODAsNiArODcxLDE1IEBAIHN0YXRpYyBpbnQgX19zaHJp
bmtfaG9sZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaTkxNV92bWFfdW5waW4o
dm1hKTsKIAkJYWRkciArPSBzaXplOwogCisJCS8qCisJCSAqIFNpbmNlIHdlIGFyZSBpbmplY3Rp
bmcgYWxsb2NhdGlvbiBmYXVsdHMgYXQgcmFuZG9tIGludGVydmFscywKKwkJICogd2FpdCBmb3Ig
dGhpcyBhbGxvY2F0aW9uIHRvIGNvbXBsZXRlIGJlZm9yZSB3ZSBjaGFuZ2UgdGhlCisJCSAqIGZh
dWx0aW5qZWN0aW9uLgorCQkgKi8KKwkJZXJyID0gaTkxNV92bWFfc3luYyh2bWEpOworCQlpZiAo
ZXJyKQorCQkJYnJlYWs7CisKIAkJaWYgKGlndF90aW1lb3V0KGVuZF90aW1lLAogCQkJCSIlcyB0
aW1lZCBvdXQgYXQgb2ZzZXQgJWxseCBbJWxseCAtICVsbHhdXG4iLAogCQkJCV9fZnVuY19fLCBh
ZGRyLCBob2xlX3N0YXJ0LCBob2xlX2VuZCkpIHsKQEAgLTEwMTMsMjEgKzEwMTMsMTkgQEAgc3Rh
dGljIGludCBleGVyY2lzZV9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9s
b2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcHBndHQgPSBpOTE1X3BwZ3R0X2Ny
ZWF0ZShkZXZfcHJpdik7CiAJaWYgKElTX0VSUihwcGd0dCkpIHsKIAkJZXJyID0gUFRSX0VSUihw
cGd0dCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZnJlZTsKIAl9CiAJR0VNX0JV
R19PTihvZmZzZXRfaW5fcGFnZShwcGd0dC0+dm0udG90YWwpKTsKLQlHRU1fQlVHX09OKHBwZ3R0
LT52bS5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZwcGd0dC0+dm0ub3Blbikp
OwogCiAJZXJyID0gZnVuYyhkZXZfcHJpdiwgJnBwZ3R0LT52bSwgMCwgcHBndHQtPnZtLnRvdGFs
LCBlbmRfdGltZSk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKLW91dF91bmxvY2s6Ci0J
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKK291dF9mcmVlOgog
CW1vY2tfZmlsZV9mcmVlKGRldl9wcml2LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTA5
MCw3ICsxMDg4LDYgQEAgc3RhdGljIGludCBleGVyY2lzZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAlpbnQgZXJyID0gMDsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogcmVzdGFydDoKIAlsaXN0X3Nv
cnQoTlVMTCwgJmdndHQtPnZtLm1tLmhvbGVfc3RhY2ssIHNvcnRfaG9sZXMpOwogCWRybV9tbV9m
b3JfZWFjaF9ob2xlKG5vZGUsICZnZ3R0LT52bS5tbSwgaG9sZV9zdGFydCwgaG9sZV9lbmQpIHsK
QEAgLTExMTEsNyArMTEwOCw2IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfZ2d0dChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJbGFzdCA9IGhvbGVfZW5kOwogCQlnb3RvIHJlc3RhcnQ7
CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4g
ZXJyOwogfQpAQCAtMTE1MywxMyArMTE0OSw5IEBAIHN0YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2
b2lkICphcmcpCiAJdW5zaWduZWQgaW50ICpvcmRlciwgbjsKIAlpbnQgZXJyOwogCi0JbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0J
CWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJS
KG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAllcnIgPSBpOTE1X2dlbV9vYmplY3Rf
cGluX3BhZ2VzKG9iaik7CiAJaWYgKGVycikKQEAgLTEyMjcsOCArMTIxOSw2IEBAIHN0YXRpYyBp
bnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2Vz
KG9iaik7CiBvdXRfZnJlZToKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1vdXRfdW5sb2Nr
OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsK
IH0KIApAQCAtMTIzOSw2ICsxMjI5LDkgQEAgc3RhdGljIHZvaWQgdHJhY2tfdm1hX2JpbmQoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCiAJYXRvbWljX2luYygmb2JqLT5iaW5kX2NvdW50KTsgLyogdHJh
Y2sgZm9yIGV2aWN0aW9uIGxhdGVyICovCiAJX19pOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9i
aik7CiAKKwlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOworCWF0b21pY19zZXQoJnZtYS0+cGFnZXNf
Y291bnQsIEk5MTVfVk1BX1BBR0VTX0FDVElWRSk7CisJX19pOTE1X2dlbV9vYmplY3RfcGluX3Bh
Z2VzKG9iaik7CiAJdm1hLT5wYWdlcyA9IG9iai0+bW0ucGFnZXM7CiAKIAltdXRleF9sb2NrKCZ2
bWEtPnZtLT5tdXRleCk7CkBAIC0xMzM1LDExICsxMzI4LDEzIEBAIHN0YXRpYyBpbnQgaWd0X2d0
dF9yZXNlcnZlKHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKKwkJbXV0ZXhfbG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0s
ICZ2bWEtPm5vZGUsCiAJCQkJCSAgIG9iai0+YmFzZS5zaXplLAogCQkJCQkgICB0b3RhbCwKIAkJ
CQkJICAgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0
dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9yZXNl
cnZlIChwYXNzIDEpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0aCBlcnI9JWRcbiIsCiAJCQkgICAg
ICAgdG90YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAtMTM4NSwxMSArMTM4MCwxMyBAQCBz
dGF0aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQog
CisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X3Jl
c2VydmUoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBvYmotPmJhc2Uuc2l6ZSwKIAkJ
CQkJICAgdG90YWwsCiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgIDApOworCQlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJp
OTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAyKSBmYWlsZWQgYXQgJWxsdS8lbGx1IHdpdGggZXJy
PSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJyKTsKQEAgLTE0Mjks
MTEgKzE0MjYsMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0X3Jlc2VydmUodm9pZCAqYXJnKQogCQkJ
CSAgICAgICAyKkk5MTVfR1RUX1BBR0VfU0laRSwKIAkJCQkgICAgICAgSTkxNV9HVFRfTUlOX0FM
SUdOTUVOVCk7CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1
X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIG9iai0+YmFz
ZS5zaXplLAogCQkJCQkgICBvZmZzZXQsCiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJ
CSAgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewog
CQkJcHJfZXJyKCJpOTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAzKSBmYWlsZWQgYXQgJWxsdS8l
bGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJy
KTsKQEAgLTE1MDIsMTEgKzE1MDEsMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0X2luc2VydCh2b2lk
ICphcmcpCiAKIAkvKiBDaGVjayBhIGNvdXBsZSBvZiBvYnZpb3VzbHkgaW52YWxpZCByZXF1ZXN0
cyAqLwogCWZvciAoaWkgPSBpbnZhbGlkX2luc2VydDsgaWktPnNpemU7IGlpKyspIHsKKwkJbXV0
ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZn
Z3R0LT52bSwgJnRtcCwKIAkJCQkJICBpaS0+c2l6ZSwgaWktPmFsaWdubWVudCwKIAkJCQkJICBJ
OTE1X0NPTE9SX1VORVZJQ1RBQkxFLAogCQkJCQkgIGlpLT5zdGFydCwgaWktPmVuZCwKIAkJCQkJ
ICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIgIT0gLUVO
T1NQQykgewogCQkJcHJfZXJyKCJJbnZhbGlkIGk5MTVfZ2VtX2d0dF9pbnNlcnQoLnNpemU9JWxs
eCwgLmFsaWdubWVudD0lbGx4LCAuc3RhcnQ9JWxseCwgLmVuZD0lbGx4KSBzdWNjZWVkZWQgKGVy
cj0lZClcbiIsCiAJCQkgICAgICAgaWktPnNpemUsIGlpLT5hbGlnbm1lbnQsIGlpLT5zdGFydCwg
aWktPmVuZCwKQEAgLTE1NDIsMTAgKzE1NDMsMTIgQEAgc3RhdGljIGludCBpZ3RfZ3R0X2luc2Vy
dCh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZt
Lm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2bWEtPm5v
ZGUsCiAJCQkJCSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAg
MCwgZ2d0dC0+dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCQlpZiAoZXJyID09IC1FTk9TUEMpIHsKIAkJCS8qIG1heGVkIG91dCB0aGUgR0dU
VCBzcGFjZSAqLwogCQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwpAQCAtMTYwMCwxMCArMTYw
MywxMiBAQCBzdGF0aWMgaW50IGlndF9ndHRfaW5zZXJ0KHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0
OwogCQl9CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dl
bV9ndHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICBvYmotPmJhc2Uuc2l6
ZSwgMCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAwLCBnZ3R0LT52bS50b3RhbCwKIAkJCQkJ
ICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIpIHsKIAkJ
CXByX2VycigiaTkxNV9nZW1fZ3R0X2luc2VydCAocGFzcyAyKSBmYWlsZWQgYXQgJWxsdS8lbGx1
IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJyKTsK
QEAgLTE2NDcsMTAgKzE2NTIsMTIgQEAgc3RhdGljIGludCBpZ3RfZ3R0X2luc2VydCh2b2lkICph
cmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsK
IAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJ
CSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgMCwgZ2d0dC0+
dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9pbnNlcnQgKHBhc3MgMykgZmFp
bGVkIGF0ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3RhbCwgZ2d0dC0+
dm0udG90YWwsIGVycik7CkBAIC0xNjk0LDggKzE3MDEsOSBAQCBpbnQgaTkxNV9nZW1fZ3R0X21v
Y2tfc2VsZnRlc3RzKHZvaWQpCiAJfQogCW1vY2tfaW5pdF9nZ3R0KGk5MTUsIGdndHQpOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaTkxNV9zdWJ0ZXN0
cyh0ZXN0cywgZ2d0dCk7CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1
ZXN0LmMKaW5kZXggYjM2ODg1NDNlZDdkLi42YjViMDMwODE4ODAgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTY0Nyw4ICs2NDcsMTUgQEAg
c3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqZW1wdHlfYmF0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiAJaWYgKGVycikKIAkJZ290byBlcnI7CiAKKwkvKiBGb3JjZSB0aGUgd2FpdCB3
YWl0IG5vdyB0byBhdm9pZCBpbmNsdWRpbmcgaXQgaW4gdGhlIGJlbmNobWFyayAqLworCWVyciA9
IGk5MTVfdm1hX3N5bmModm1hKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9waW47CisKIAlyZXR1
cm4gdm1hOwogCitlcnJfcGluOgorCWk5MTVfdm1hX3VucGluKHZtYSk7CiBlcnI6CiAJaTkxNV9n
ZW1fb2JqZWN0X3B1dChvYmopOwogCXJldHVybiBFUlJfUFRSKGVycik7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCmluZGV4IDk3NzUyZGVlY2NjYi4uMGU0ZjY2MzEy
YjM5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtODMx
LDggKzgzMSw5IEBAIGludCBpOTE1X3ZtYV9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCX0KIAltb2Nr
X2luaXRfZ2d0dChpOTE1LCBnZ3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGdndHQpOworCisJbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7CiAJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIApAQCAtODc5LDggKzg4MCw2
IEBAIHN0YXRpYyBpbnQgaWd0X3ZtYV9yZW1hcHBlZF9ndHQodm9pZCAqYXJnKQogCWlmIChJU19F
UlIob2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1
LT5ydW50aW1lX3BtKTsKIAogCWZvciAodCA9IHR5cGVzOyAqdDsgdCsrKSB7CkBAIC05NzYsNyAr
OTc1LDYgQEAgc3RhdGljIGludCBpZ3Rfdm1hX3JlbWFwcGVkX2d0dCh2b2lkICphcmcpCiAKIG91
dDoKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9vYmplY3Rf
cHV0KG9iaik7CiAKIAlyZXR1cm4gZXJyOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

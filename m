Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CA2877DDAF
	for <lists+intel-gfx@lfdr.de>; Thu,  1 Aug 2019 16:21:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 331B76E65C;
	Thu,  1 Aug 2019 14:21:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3F9946E65C
 for <intel-gfx@lists.freedesktop.org>; Thu,  1 Aug 2019 14:21:20 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Aug 2019 07:21:19 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,334,1559545200"; d="scan'208";a="184257399"
Received: from gadevlin-mobl.ger.corp.intel.com (HELO [10.251.95.57])
 ([10.251.95.57])
 by orsmga002.jf.intel.com with ESMTP; 01 Aug 2019 07:21:18 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190801121533.14057-1-chris@chris-wilson.co.uk>
 <20190801122002.24248-1-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <8ed53b04-9dae-3430-9b4f-7ce233101218@linux.intel.com>
Date: Thu, 1 Aug 2019 15:21:17 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190801122002.24248-1-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH] drm/i915/pmu: Atomically acquire the gt_pm
 wakeref
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDAxLzA4LzIwMTkgMTM6MjAsIENocmlzIFdpbHNvbiB3cm90ZToKPiBDdXJyZW50bHksIHdl
IG9ubHkgc2FtcGxlIGlmIHRoZSBpbnRlbF9ndCBpcyBhd2FrZSwgYnV0IHdlIGFjcXVpcmUgb3Vy
Cj4gb3duIHJ1bnRpbWVfcG0gd2FrZXJlZi4gU2luY2UgaW50ZWxfZ3QgaGFzIHRyYW5zaXRpb25l
ZCB0byB0cmFja2luZyBpdHMKPiBvd24gd2FrZXJlZiwgd2UgY2FuIGF0b21pY2FsbHkgdGVzdCBh
bmQgYWNxdWlyZSB0aGF0IHdha2VyZWYgaW5zdGVhZC4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBDaHJp
cyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KPiBDYzogVHZydGtvIFVyc3VsaW4g
PHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KPiAtLS0KPiBObyBhdXRvbWFnaWMgZHJvcCEKPiAt
LS0KPiAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmggfCAgOCArKysrKysr
LQo+ICAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuYyAgICAgICB8IDIzICsrKysrKysr
LS0tLS0tLS0tLS0tLS0tCj4gICAyIGZpbGVzIGNoYW5nZWQsIDE1IGluc2VydGlvbnMoKyksIDE2
IGRlbGV0aW9ucygtKQo+IAo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAo+IGlu
ZGV4IGJhOTYwZTFmYzIwOS4uMDE2Mjk4NDgzZGU3IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF9wbS5oCj4gQEAgLTksNyArOSw4IEBACj4gICAKPiAgICNpbmNsdWRlIDxsaW51
eC90eXBlcy5oPgo+ICAgCj4gLXN0cnVjdCBpbnRlbF9ndDsKPiArI2luY2x1ZGUgImludGVsX2d0
X3R5cGVzLmgiCj4gKyNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgiCj4gICAKPiAgIGVudW0gewo+
ICAgCUlOVEVMX0dUX1VOUEFSSywKPiBAQCAtMTksNiArMjAsMTEgQEAgZW51bSB7Cj4gICB2b2lk
IGludGVsX2d0X3BtX2dldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKPiAgIHZvaWQgaW50ZWxfZ3Rf
cG1fcHV0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwo+ICAgCj4gK3N0YXRpYyBpbmxpbmUgYm9vbCBp
bnRlbF9ndF9wbV9nZXRfaWZfYXdha2Uoc3RydWN0IGludGVsX2d0ICpndCkKPiArewo+ICsJcmV0
dXJuIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZSgmZ3QtPndha2VyZWYpOwo+ICt9Cj4gKwo+
ICAgdm9pZCBpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwo+ICAg
Cj4gICB2b2lkIGludGVsX2d0X3Nhbml0aXplKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgZm9y
Y2UpOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuYwo+IGluZGV4IGVmZjg2NDgzYmVjMC4uZTcxMTky
ODA0OTk2IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmMKPiAr
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jCj4gQEAgLTgsNiArOCw3IEBACj4g
ICAjaW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgo+ICAgCj4gICAjaW5jbHVkZSAiZ3QvaW50
ZWxfZW5naW5lLmgiCj4gKyNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgo+ICAgCj4gICAjaW5j
bHVkZSAiaTkxNV9kcnYuaCIKPiAgICNpbmNsdWRlICJpOTE1X3BtdS5oIgo+IEBAIC0xNjEsMTYg
KzE2MiwxMiBAQCBlbmdpbmVzX3NhbXBsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHVuc2lnbmVkIGludCBwZXJpb2RfbnMpCj4gICB7Cj4gICAJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lOwo+ICAgCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwo+IC0JaW50ZWxfd2Fr
ZXJlZl90IHdha2VyZWY7Cj4gICAJdW5zaWduZWQgbG9uZyBmbGFnczsKPiAgIAo+ICAgCWlmICgo
ZGV2X3ByaXYtPnBtdS5lbmFibGUgJiBFTkdJTkVfU0FNUExFX01BU0spID09IDApCj4gICAJCXJl
dHVybjsKPiAgIAo+IC0Jd2FrZXJlZiA9IDA7Cj4gLQlpZiAoUkVBRF9PTkNFKGRldl9wcml2LT5n
dC5hd2FrZSkpCj4gLQkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0X2lmX2luX3VzZSgm
ZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwo+IC0JaWYgKCF3YWtlcmVmKQo+ICsJaWYgKCFpbnRlbF9n
dF9wbV9nZXRfaWZfYXdha2UoJmRldl9wcml2LT5ndCkpCj4gICAJCXJldHVybjsKPiAgIAo+ICAg
CXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGZsYWdzKTsKPiBAQCAt
MjA1LDcgKzIwMiw3IEBAIGVuZ2luZXNfc2FtcGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgdW5zaWduZWQgaW50IHBlcmlvZF9ucykKPiAgIAl9Cj4gICAJc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBmbGFncyk7Cj4gICAKPiAtCWludGVs
X3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7Cj4gKwlpbnRl
bF9ndF9wbV9wdXQoJmRldl9wcml2LT5ndCk7Cj4gICB9Cj4gICAKPiAgIHN0YXRpYyB2b2lkCj4g
QEAgLTIyMiwxNSArMjE5LDExIEBAIGZyZXF1ZW5jeV9zYW1wbGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBpbnQgcGVyaW9kX25zKQo+ICAgCQl1MzIgdmFsOwo+
ICAgCj4gICAJCXZhbCA9IGRldl9wcml2LT5ndF9wbS5ycHMuY3VyX2ZyZXE7Cj4gLQkJaWYgKGRl
dl9wcml2LT5ndC5hd2FrZSkgewo+IC0JCQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKPiAtCj4g
LQkJCXdpdGhfaW50ZWxfcnVudGltZV9wbV9pZl9pbl91c2UoJmRldl9wcml2LT5ydW50aW1lX3Bt
LAo+IC0JCQkJCQkJd2FrZXJlZikgewo+IC0JCQkJdmFsID0gaW50ZWxfdW5jb3JlX3JlYWRfbm90
cmFjZSgmZGV2X3ByaXYtPnVuY29yZSwKPiAtCQkJCQkJCQlHRU42X1JQU1RBVDEpOwo+IC0JCQkJ
dmFsID0gaW50ZWxfZ2V0X2NhZ2YoZGV2X3ByaXYsIHZhbCk7Cj4gLQkJCX0KPiArCQlpZiAoaW50
ZWxfZ3RfcG1fZ2V0X2lmX2F3YWtlKCZkZXZfcHJpdi0+Z3QpKSB7Cj4gKwkJCXZhbCA9IGludGVs
X3VuY29yZV9yZWFkX25vdHJhY2UoJmRldl9wcml2LT51bmNvcmUsCj4gKwkJCQkJCQlHRU42X1JQ
U1RBVDEpOwo+ICsJCQl2YWwgPSBpbnRlbF9nZXRfY2FnZihkZXZfcHJpdiwgdmFsKTsKPiArCQkJ
aW50ZWxfZ3RfcG1fcHV0KCZkZXZfcHJpdi0+Z3QpOwo+ICAgCQl9Cj4gICAKPiAgIAkJYWRkX3Nh
bXBsZV9tdWx0KCZkZXZfcHJpdi0+cG11LnNhbXBsZVtfX0k5MTVfU0FNUExFX0ZSRVFfQUNUXSwK
PiAKCkkgZ3Vlc3MgSSdsbCBiZSByZWJhc2luZyBtaW5lLCBhdCBzb21lIHBvaW50LiA6KQoKUmV2
aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+CgpSZWdh
cmRzLAoKVHZydGtvCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

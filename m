Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E6CE9DD7E4
	for <lists+intel-gfx@lfdr.de>; Sat, 19 Oct 2019 12:05:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4D9D589194;
	Sat, 19 Oct 2019 10:05:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AE45889D7C
 for <intel-gfx@lists.freedesktop.org>; Sat, 19 Oct 2019 10:05:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18893440-1500050 
 for multiple; Sat, 19 Oct 2019 11:04:40 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 19 Oct 2019 11:04:37 +0100
Message-Id: <20191019100439.24640-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 1/3] i915: Exercise preemption timeout
 controls in sysfs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgW3dpbGxdIGV4cG9zZSB2YXJpb3VzIHBlci1lbmdpbmUgc2NoZWR1bGluZyBjb250cm9scy4g
T25lIG9mIHdoaWNoLAoncHJlZW1wdF90aW1lb3V0X21zJywgZGVmaW5lcyBob3cgd2Ugd2FpdCBm
b3IgYSBwcmVlbXB0aW9uIHJlcXVlc3QgdG8gYmUKaG9ub3VyZWQgYnkgdGhlIGN1cnJlbnRseSBl
eGVjdXRpbmcgY29udGV4dC4gSWYgaXQgZmFpbHMgdG8gcmVsaWV2ZSB0aGUKR1BVIHdpdGhpbiB0
aGUgcmVxdWlyZWQgdGltZW91dCwgdGhlIGVuZ2luZSBpcyByZXNldCBhbmQgdGhlIG1pc2NyZWFu
dApmb3JjaWJseSBldmljdGVkLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+Ci0tLQogbGliL2k5MTUvZ2VtX2NvbnRleHQuYyAgICAgICAgICAg
ICAgICB8ICA0MSArKysrCiBsaWIvaTkxNS9nZW1fY29udGV4dC5oICAgICAgICAgICAgICAgIHwg
ICAyICsKIHRlc3RzL01ha2VmaWxlLnNvdXJjZXMgICAgICAgICAgICAgICAgfCAgIDEgKwogdGVz
dHMvaTkxNS9zeXNmc19wcmVlbXB0aW9uX3RpbWVvdXQuYyB8IDMzNiArKysrKysrKysrKysrKysr
KysrKysrKysrKwogdGVzdHMvbWVzb24uYnVpbGQgICAgICAgICAgICAgICAgICAgICB8ICAgMSAr
CiA1IGZpbGVzIGNoYW5nZWQsIDM4MSBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQg
dGVzdHMvaTkxNS9zeXNmc19wcmVlbXB0aW9uX3RpbWVvdXQuYwoKZGlmZiAtLWdpdCBhL2xpYi9p
OTE1L2dlbV9jb250ZXh0LmMgYi9saWIvaTkxNS9nZW1fY29udGV4dC5jCmluZGV4IDFmYWU1MTkx
Zi4uYWEwODNjMmYwIDEwMDY0NAotLS0gYS9saWIvaTkxNS9nZW1fY29udGV4dC5jCisrKyBiL2xp
Yi9pOTE1L2dlbV9jb250ZXh0LmMKQEAgLTQwMywzICs0MDMsNDQgQEAgYm9vbCBnZW1fY29udGV4
dF9oYXNfZW5naW5lKGludCBmZCwgdWludDMyX3QgY3R4LCB1aW50NjRfdCBlbmdpbmUpCiAKIAly
ZXR1cm4gX19nZW1fZXhlY2J1ZihmZCwgJmV4ZWNidWYpID09IC1FTk9FTlQ7CiB9CisKK3N0YXRp
YyBpbnQgY3JlYXRlX2V4dF9pb2N0bChpbnQgaTkxNSwKKwkJCSAgICBzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX2NvbnRleHRfY3JlYXRlX2V4dCAqYXJnKQoreworCWludCBlcnI7CisKKwllcnIgPSAwOwor
CWlmIChpZ3RfaW9jdGwoaTkxNSwgRFJNX0lPQ1RMX0k5MTVfR0VNX0NPTlRFWFRfQ1JFQVRFX0VY
VCwgYXJnKSkgeworCQllcnIgPSAtZXJybm87CisJCWlndF9hc3N1bWUoZXJyKTsKKwl9CisKKwll
cnJubyA9IDA7CisJcmV0dXJuIGVycjsKK30KKwordWludDMyX3QgZ2VtX2NvbnRleHRfY3JlYXRl
X2Zvcl9lbmdpbmUoaW50IGk5MTUsIHVuc2lnbmVkIGludCBjbGFzcywgdW5zaWduZWQgaW50IGlu
c3QpCit7CisJSTkxNV9ERUZJTkVfQ09OVEVYVF9QQVJBTV9FTkdJTkVTKGVuZ2luZXMsIDEpID0g
eworCQkuZW5naW5lcyA9IHsgeyAuZW5naW5lX2NsYXNzID0gY2xhc3MsIC5lbmdpbmVfaW5zdGFu
Y2UgPSBpbnN0IH0gfQorCX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9l
eHRfc2V0cGFyYW0gcF9lbmdpbmVzID0geworCQkuYmFzZSA9IHsKKwkJCS5uYW1lID0gSTkxNV9D
T05URVhUX0NSRUFURV9FWFRfU0VUUEFSQU0sCisJCQkubmV4dF9leHRlbnNpb24gPSAwLCAvKiBl
bmQgb2YgY2hhaW4gKi8KKwkJfSwKKwkJLnBhcmFtID0geworCQkJLnBhcmFtID0gSTkxNV9DT05U
RVhUX1BBUkFNX0VOR0lORVMsCisJCQkudmFsdWUgPSB0b191c2VyX3BvaW50ZXIoJmVuZ2luZXMp
LAorCQkJLnNpemUgPSBzaXplb2YoZW5naW5lcyksCisJCX0sCisJfTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2V4dCBjcmVhdGUgPSB7CisJCS5mbGFncyA9IEk5MTVfQ09O
VEVYVF9DUkVBVEVfRkxBR1NfVVNFX0VYVEVOU0lPTlMsCisJCS5leHRlbnNpb25zID0gdG9fdXNl
cl9wb2ludGVyKCZwX2VuZ2luZXMpLAorCX07CisKKwlpZ3RfYXNzZXJ0X2VxKGNyZWF0ZV9leHRf
aW9jdGwoaTkxNSwgJmNyZWF0ZSksIDApOworCWlndF9hc3NlcnRfbmVxKGNyZWF0ZS5jdHhfaWQs
IDApOworCXJldHVybiBjcmVhdGUuY3R4X2lkOworfQpkaWZmIC0tZ2l0IGEvbGliL2k5MTUvZ2Vt
X2NvbnRleHQuaCBiL2xpYi9pOTE1L2dlbV9jb250ZXh0LmgKaW5kZXggYzBkNGM5NjE1Li45ZTBh
MDgzZjAgMTAwNjQ0Ci0tLSBhL2xpYi9pOTE1L2dlbV9jb250ZXh0LmgKKysrIGIvbGliL2k5MTUv
Z2VtX2NvbnRleHQuaApAQCAtMzQsNiArMzQsOCBAQCBpbnQgX19nZW1fY29udGV4dF9jcmVhdGUo
aW50IGZkLCB1aW50MzJfdCAqY3R4X2lkKTsKIHZvaWQgZ2VtX2NvbnRleHRfZGVzdHJveShpbnQg
ZmQsIHVpbnQzMl90IGN0eF9pZCk7CiBpbnQgX19nZW1fY29udGV4dF9kZXN0cm95KGludCBmZCwg
dWludDMyX3QgY3R4X2lkKTsKIAordWludDMyX3QgZ2VtX2NvbnRleHRfY3JlYXRlX2Zvcl9lbmdp
bmUoaW50IGZkLCB1bnNpZ25lZCBpbnQgY2xhc3MsIHVuc2lnbmVkIGludCBpbnN0KTsKKwogaW50
IF9fZ2VtX2NvbnRleHRfY2xvbmUoaW50IGk5MTUsCiAJCQl1aW50MzJfdCBzcmMsIHVuc2lnbmVk
IGludCBzaGFyZSwKIAkJCXVuc2lnbmVkIGludCBmbGFncywKZGlmZiAtLWdpdCBhL3Rlc3RzL01h
a2VmaWxlLnNvdXJjZXMgYi90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCmluZGV4IDA5M2ViNTdmMy4u
ZGZmN2RhYzA2IDEwMDY0NAotLS0gYS90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCisrKyBiL3Rlc3Rz
L01ha2VmaWxlLnNvdXJjZXMKQEAgLTk4LDYgKzk4LDcgQEAgVEVTVFNfcHJvZ3MgPSBcCiAJdG9v
bHNfdGVzdCBcCiAJdmdlbV9iYXNpYyBcCiAJdmdlbV9zbG93IFwKKwlpOTE1L3N5c2ZzX3ByZWVt
cHRpb25fdGltZW91dCBcCiAJJChOVUxMKQogCiBURVNUU19wcm9ncyArPSBnZW1fYmFkX3JlbG9j
CmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L3N5c2ZzX3ByZWVtcHRpb25fdGltZW91dC5jIGIvdGVz
dHMvaTkxNS9zeXNmc19wcmVlbXB0aW9uX3RpbWVvdXQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAuLjBkMjRmNzUxZgotLS0gL2Rldi9udWxsCisrKyBiL3Rlc3RzL2k5MTUv
c3lzZnNfcHJlZW1wdGlvbl90aW1lb3V0LmMKQEAgLTAsMCArMSwzMzYgQEAKKy8qCisgKiBDb3B5
cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICoKKyAqIFBlcm1pc3Npb24gaXMgaGVy
ZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCisg
KiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxl
cyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCBy
ZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0cyB0
byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vu
c2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0
IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywg
c3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3ZlIGNv
cHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUg
bmV4dAorICogcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1
YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZQorICogU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRX
QVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVY
UFJFU1MgT1IKKyAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdB
UlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFS
IFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUg
QVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFN
QUdFUyBPUiBPVEhFUgorICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05U
UkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBD
T05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MK
KyAqIElOIFRIRSBTT0ZUV0FSRS4KKyAqLworCisjaW5jbHVkZSA8ZGlyZW50Lmg+CisjaW5jbHVk
ZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxmY250bC5oPgorI2luY2x1ZGUgPGludHR5cGVzLmg+Cisj
aW5jbHVkZSA8c3lzL3N0YXQuaD4KKyNpbmNsdWRlIDxzeXMvdHlwZXMuaD4KKyNpbmNsdWRlIDx1
bmlzdGQuaD4KKworI2luY2x1ZGUgImRybXRlc3QuaCIgLyogZ2VtX3F1aWVzY2VudF9ncHUoKSEg
Ki8KKyNpbmNsdWRlICJpOTE1L2dlbV9lbmdpbmVfdG9wb2xvZ3kuaCIKKyNpbmNsdWRlICJpZ3Rf
ZHVtbXlsb2FkLmgiCisjaW5jbHVkZSAiaWd0X3N5c2ZzLmgiCisjaW5jbHVkZSAiaW9jdGxfd3Jh
cHBlcnMuaCIgLyogaWd0X3JlcXVpcmVfZ2VtKCkhICovCisjaW5jbHVkZSAic3dfc3luYy5oIgor
CisjaW5jbHVkZSAiaWd0X2RlYnVnZnMuaCIKKworc3RhdGljIGJvb2wgX19lbmFibGVfaGFuZ2No
ZWNrKGludCBkaXIsIGJvb2wgc3RhdGUpCit7CisJcmV0dXJuIGlndF9zeXNmc19zZXQoZGlyLCAi
ZW5hYmxlX2hhbmdjaGVjayIsIHN0YXRlID8gIjEiIDogIjAiKTsKK30KKworc3RhdGljIGJvb2wg
ZW5hYmxlX2hhbmdjaGVjayhpbnQgaTkxNSwgYm9vbCBzdGF0ZSkKK3sKKwlib29sIHN1Y2Nlc3M7
CisJaW50IGRpcjsKKworCWRpciA9IGlndF9zeXNmc19vcGVuX3BhcmFtZXRlcnMoaTkxNSk7CisJ
aWYgKGRpciA8IDApIC8qIG5vIHBhcmFtZXRlcnMsIG11c3QgYmUgZGVmYXVsdCEgKi8KKwkJcmV0
dXJuIGZhbHNlOworCisJc3VjY2VzcyA9IF9fZW5hYmxlX2hhbmdjaGVjayhkaXIsIHN0YXRlKTsK
KwljbG9zZShkaXIpOworCisJcmV0dXJuIHN1Y2Nlc3M7Cit9CisKK3N0YXRpYyB2b2lkIHNldF9w
cmVlbXB0X3RpbWVvdXQoaW50IGVuZ2luZSwgdW5zaWduZWQgaW50IHZhbHVlKQoreworCXVuc2ln
bmVkIGludCBkZWxheTsKKworCWlndF9zeXNmc19wcmludGYoZW5naW5lLCAicHJlZW1wdF90aW1l
b3V0X21zIiwgIiV1IiwgdmFsdWUpOworCWlndF9zeXNmc19zY2FuZihlbmdpbmUsICJwcmVlbXB0
X3RpbWVvdXRfbXMiLCAiJXUiLCAmZGVsYXkpOworCWlndF9hc3NlcnRfZXEoZGVsYXksIHZhbHVl
KTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9pZGVtcG90ZW50KGludCBpOTE1LCBpbnQgZW5naW5l
KQoreworCXVuc2lnbmVkIGludCBzYXZlZDsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5m
KGVuZ2luZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0
X2RlYnVnKCJJbml0aWFsIHByZWVtcHRfdGltZW91dF9tczoldVxuIiwgc2F2ZWQpOworCisJc2V0
X3ByZWVtcHRfdGltZW91dChlbmdpbmUsIDApOworCXNldF9wcmVlbXB0X3RpbWVvdXQoZW5naW5l
LCAxKTsKKwlzZXRfcHJlZW1wdF90aW1lb3V0KGVuZ2luZSwgMTAwMCk7CisJc2V0X3ByZWVtcHRf
dGltZW91dChlbmdpbmUsIDEyMzQpOworCXNldF9wcmVlbXB0X3RpbWVvdXQoZW5naW5lLCA2NTQz
MjEpOworCisJc2V0X3ByZWVtcHRfdGltZW91dChlbmdpbmUsIHNhdmVkKTsKK30KKworc3RhdGlj
IHZvaWQgdGVzdF9pbnZhbGlkKGludCBpOTE1LCBpbnQgZW5naW5lKQoreworCXVuc2lnbmVkIGlu
dCBzYXZlZCwgZGVsYXk7CisKKwlpZ3RfYXNzZXJ0KGlndF9zeXNmc19zY2FuZihlbmdpbmUsICJw
cmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAmc2F2ZWQpID09IDEpOworCWlndF9kZWJ1ZygiSW5p
dGlhbCBwcmVlbXB0X3RpbWVvdXRfbXM6JXVcbiIsIHNhdmVkKTsKKworCWlndF9zeXNmc19wcmlu
dGYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgUFJJdTY0LCAtMSk7CisJaWd0X3N5c2Zz
X3NjYW5mKGVuZ2luZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZkZWxheSk7CisJaWd0
X2Fzc2VydF9lcShkZWxheSwgc2F2ZWQpOworCisJaWd0X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJw
cmVlbXB0X3RpbWVvdXRfbXMiLCAiJWQiLCAtMSk7CisJaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwg
InByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZkZWxheSk7CisJaWd0X2Fzc2VydF9lcShkZWxh
eSwgc2F2ZWQpOworCisJaWd0X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRf
bXMiLCBQUkl1NjQsIDQwdWxsIDw8IDMyKTsKKwlpZ3Rfc3lzZnNfc2NhbmYoZW5naW5lLCAicHJl
ZW1wdF90aW1lb3V0X21zIiwgIiV1IiwgJmRlbGF5KTsKKwlpZ3RfYXNzZXJ0X2VxKGRlbGF5LCBz
YXZlZCk7Cit9CisKK3N0YXRpYyB2b2lkIHNldF91bmJhbm5hYmxlKGludCBpOTE1LCB1aW50MzJf
dCBjdHgpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFtIHAgPSB7CisJCS5j
dHhfaWQgPSBjdHgsCisJCS5wYXJhbSA9IEk5MTVfQ09OVEVYVF9QQVJBTV9CQU5OQUJMRSwKKwl9
OworCisJaWd0X2Fzc2VydF9lcShfX2dlbV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCksIDAp
OworfQorCitzdGF0aWMgdWludDMyX3QgY3JlYXRlX2NvbnRleHQoaW50IGk5MTUsIHVuc2lnbmVk
IGludCBjbGFzcywgdW5zaWduZWQgaW50IGluc3QsIGludCBwcmlvKQoreworCXVpbnQzMl90IGN0
eDsKKworCWN0eCA9IGdlbV9jb250ZXh0X2NyZWF0ZV9mb3JfZW5naW5lKGk5MTUsIGNsYXNzLCBp
bnN0KTsKKwlzZXRfdW5iYW5uYWJsZShpOTE1LCBjdHgpOworCWdlbV9jb250ZXh0X3NldF9wcmlv
cml0eShpOTE1LCBjdHgsIHByaW8pOworCisJcmV0dXJuIGN0eDsKK30KKworc3RhdGljIHVpbnQ2
NF90IF9fdGVzdF90aW1lb3V0KGludCBpOTE1LCBpbnQgZW5naW5lLCB1bnNpZ25lZCBpbnQgdGlt
ZW91dCkKK3sKKwl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7CisJc3RydWN0IHRpbWVzcGVjIHRz
ID0ge307CisJaWd0X3NwaW5fdCAqc3BpblsyXTsKKwl1aW50NjRfdCBlbGFwc2VkOworCXVpbnQz
Ml90IGN0eFsyXTsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgImNsYXNz
IiwgIiV1IiwgJmNsYXNzKSA9PSAxKTsKKwlpZ3RfYXNzZXJ0KGlndF9zeXNmc19zY2FuZihlbmdp
bmUsICJpbnN0YW5jZSIsICIldSIsICZpbnN0KSA9PSAxKTsKKworCXNldF9wcmVlbXB0X3RpbWVv
dXQoZW5naW5lLCB0aW1lb3V0KTsKKworCWN0eFswXSA9IGNyZWF0ZV9jb250ZXh0KGk5MTUsIGNs
YXNzLCBpbnN0LCAtMTAyMyk7CisJc3BpblswXSA9IGlndF9zcGluX25ldyhpOTE1LCBjdHhbMF0s
CisJCQkgICAgICAgLmZsYWdzID0gKElHVF9TUElOX05PX1BSRUVNUFRJT04gfAorCQkJCQkgSUdU
X1NQSU5fUE9MTF9SVU4gfAorCQkJCQkgSUdUX1NQSU5fRkVOQ0VfT1VUKSk7CisJaWd0X3NwaW5f
YnVzeXdhaXRfdW50aWxfc3RhcnRlZChzcGluWzBdKTsKKworCWN0eFsxXSA9IGNyZWF0ZV9jb250
ZXh0KGk5MTUsIGNsYXNzLCBpbnN0LCAxMDIzKTsKKwlpZ3RfbnNlY19lbGFwc2VkKCZ0cyk7CisJ
c3BpblsxXSA9IGlndF9zcGluX25ldyhpOTE1LCBjdHhbMV0sIC5mbGFncyA9IElHVF9TUElOX1BP
TExfUlVOKTsKKwlpZ3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVkKHNwaW5bMV0pOworCWVs
YXBzZWQgPSBpZ3RfbnNlY19lbGFwc2VkKCZ0cyk7CisKKwlpZ3Rfc3Bpbl9mcmVlKGk5MTUsIHNw
aW5bMV0pOworCisJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3dhaXQoc3BpblswXS0+b3V0X2Zl
bmNlLCAxKSwgMCk7CisJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3N0YXR1cyhzcGluWzBdLT5v
dXRfZmVuY2UpLCAtRUlPKTsKKworCWlndF9zcGluX2ZyZWUoaTkxNSwgc3BpblswXSk7CisKKwln
ZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eFsxXSk7CisJZ2VtX2NvbnRleHRfZGVzdHJveShp
OTE1LCBjdHhbMF0pOworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCisJcmV0dXJuIGVsYXBz
ZWQ7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfdGltZW91dChpbnQgaTkxNSwgaW50IGVuZ2luZSkK
K3sKKwlpbnQgZGVsYXlzW10gPSB7IDEsIDUwLCAxMDAsIDUwMCB9OworCXVuc2lnbmVkIGludCBz
YXZlZDsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgInByZWVtcHRfdGlt
ZW91dF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0X2RlYnVnKCJJbml0aWFsIHByZWVt
cHRfdGltZW91dF9tczoldVxuIiwgc2F2ZWQpOworCisJZ2VtX3F1aWVzY2VudF9ncHUoaTkxNSk7
CisJaWd0X3JlcXVpcmUoZW5hYmxlX2hhbmdjaGVjayhpOTE1LCBmYWxzZSkpOworCisJZm9yIChp
bnQgaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRlbGF5cyk7IGkrKykgeworCQl1aW50NjRfdCBlbGFw
c2VkOworCisJCWVsYXBzZWQgPSBfX3Rlc3RfdGltZW91dChpOTE1LCBlbmdpbmUsIGRlbGF5c1tp
XSk7CisJCWlndF9pbmZvKCJwcmVlbXB0X3RpbWVvdXRfbXM6JWQsIGVsYXBzZWQ9JS4zZm1zXG4i
LAorCQkJIGRlbGF5c1tpXSwgZWxhcHNlZCAqIDFlLTYpOworCisJCS8qCisJCSAqIFdlIG5lZWQg
dG8gZ2l2ZSBhIGNvdXBsZSBvZiBqaWZmaWVzIHNsYWNrIGZvciB0aGUgc2NoZWR1bGVyIHRpbWVv
dXRzCisJCSAqIGFuZCB0aGVuIGEgbGl0dGxlIG1vcmUgc2xhY2sgZnIgdGhlIG92ZXJoZWFkIGlu
IHN1Ym1pdHRpbmcgYW5kCisJCSAqIG1lYXN1cmluZy4gNTBtcyBzaG91bGQgY292ZXIgYWxsIG9m
IG91ciBzaW5zIGFuZCBiZSB1c2VmdWwKKwkJICogdG9sZXJhbmNlLgorCQkgKi8KKwkJaWd0X2Fz
c2VydF9mKGVsYXBzZWQgLyAxMDAwIC8gMTAwMCA8IGRlbGF5c1tpXSArIDUwLAorCQkJICAgICAi
Rm9yY2VkIHByZWVtcHRpb24gdGltZW91dCBleGNlZWRlZCByZXF1ZXN0IVxuIik7CisJfQorCisJ
aWd0X2Fzc2VydChlbmFibGVfaGFuZ2NoZWNrKGk5MTUsIHRydWUpKTsKKwlnZW1fcXVpZXNjZW50
X2dwdShpOTE1KTsKKworCXNldF9wcmVlbXB0X3RpbWVvdXQoZW5naW5lLCBzYXZlZCk7Cit9CisK
K3N0YXRpYyB2b2lkIHRlc3Rfb2ZmKGludCBpOTE1LCBpbnQgZW5naW5lKQoreworCXVuc2lnbmVk
IGludCBjbGFzcywgaW5zdDsKKwlpZ3Rfc3Bpbl90ICpzcGluWzJdOworCXVuc2lnbmVkIGludCBz
YXZlZDsKKwl1aW50MzJfdCBjdHhbMl07CisKKwlpZ3RfYXNzZXJ0KGlndF9zeXNmc19zY2FuZihl
bmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAmc2F2ZWQpID09IDEpOworCWlndF9k
ZWJ1ZygiSW5pdGlhbCBwcmVlbXB0X3RpbWVvdXRfbXM6JXVcbiIsIHNhdmVkKTsKKworCWdlbV9x
dWllc2NlbnRfZ3B1KGk5MTUpOworCWlndF9yZXF1aXJlKGVuYWJsZV9oYW5nY2hlY2soaTkxNSwg
ZmFsc2UpKTsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgImNsYXNzIiwg
IiV1IiwgJmNsYXNzKSA9PSAxKTsKKwlpZ3RfYXNzZXJ0KGlndF9zeXNmc19zY2FuZihlbmdpbmUs
ICJpbnN0YW5jZSIsICIldSIsICZpbnN0KSA9PSAxKTsKKworCXNldF9wcmVlbXB0X3RpbWVvdXQo
ZW5naW5lLCAwKTsKKworCWN0eFswXSA9IGNyZWF0ZV9jb250ZXh0KGk5MTUsIGNsYXNzLCBpbnN0
LCAtMTAyMyk7CisJc3BpblswXSA9IGlndF9zcGluX25ldyhpOTE1LCBjdHhbMF0sCisJCQkgICAg
ICAgLmZsYWdzID0gKElHVF9TUElOX05PX1BSRUVNUFRJT04gfAorCQkJCQkgSUdUX1NQSU5fUE9M
TF9SVU4gfAorCQkJCQkgSUdUX1NQSU5fRkVOQ0VfT1VUKSk7CisJaWd0X3NwaW5fYnVzeXdhaXRf
dW50aWxfc3RhcnRlZChzcGluWzBdKTsKKworCWN0eFsxXSA9IGNyZWF0ZV9jb250ZXh0KGk5MTUs
IGNsYXNzLCBpbnN0LCAxMDIzKTsKKwlzcGluWzFdID0gaWd0X3NwaW5fbmV3KGk5MTUsIGN0eFsx
XSwgLmZsYWdzID0gSUdUX1NQSU5fUE9MTF9SVU4pOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCAx
NTA7IGkrKykgeworCQlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfc3RhdHVzKHNwaW5bMF0tPm91
dF9mZW5jZSksIDApOworCQlzbGVlcCgxKTsKKwl9CisKKwlzZXRfcHJlZW1wdF90aW1lb3V0KGVu
Z2luZSwgMSk7CisKKwlpZ3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVkKHNwaW5bMV0pOwor
CWlndF9zcGluX2ZyZWUoaTkxNSwgc3BpblsxXSk7CisKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVu
Y2Vfd2FpdChzcGluWzBdLT5vdXRfZmVuY2UsIDEpLCAwKTsKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNf
ZmVuY2Vfc3RhdHVzKHNwaW5bMF0tPm91dF9mZW5jZSksIC1FSU8pOworCisJaWd0X3NwaW5fZnJl
ZShpOTE1LCBzcGluWzBdKTsKKworCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4WzFdKTsK
KwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eFswXSk7CisKKwlpZ3RfYXNzZXJ0KGVuYWJs
ZV9oYW5nY2hlY2soaTkxNSwgdHJ1ZSkpOworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCisJ
c2V0X3ByZWVtcHRfdGltZW91dChlbmdpbmUsIHNhdmVkKTsKK30KKworI2lmIDAKK3N0YXRpYyB2
b2lkIGVhY2hfZW5naW5lcyhpbnQgZmQpCit7CisJc3RydWN0IGRpcmVudCAqZGU7CisJRElSICpk
aXI7CisKKwlkaXIgPSBmZG9wZW5kaXIoZmQpOworCXdoaWxlIChkaXIgJiYgKGRlID0gcmVhZGRp
cihkaXIpKSkgeworCQlpbnQgZW5naW5lID0gb3BlbmF0KGVuZ2luZXMsIGRlLT5kX25hbWUsIE9f
UkRPTkxZKTsKKwkJY2hhciAqbmFtZTsKKworCQluYW1lID0gaWd0X3N5c2ZzX2dldChlbmdpbmUs
ICJuYW1lIik7CisJCWlmICghbmFtZSkKKwkJCWNvbnRpbnVlOworCisJCWlndF9zdWJ0ZXN0X2dy
b3VwIHsKKwkJCWlndF9maXh0dXJlIHsKKwkJCQlpZ3RfcmVxdWlyZShmc3RhdGF0KGVuZ2luZSwK
KwkJCQkJCQkicHJlZW1wdF90aW1lb3V0X21zIiwKKwkJCQkJCQkmc3QsIDApID09IDApOworCQkJ
fQorCQl9CisJfQorCWNsb3NlZGlyKGRpcik7Cit9CisjZW5kaWYKKworaWd0X21haW4KK3sKKwlj
b25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKml0OworCWludCBpOTE1ID0gLTEs
IGVuZ2luZXMgPSAtMTsKKworCWlndF9maXh0dXJlIHsKKwkJaW50IHN5czsKKworCQlpOTE1ID0g
ZHJtX29wZW5fZHJpdmVyKERSSVZFUl9JTlRFTCk7CisJCWlndF9yZXF1aXJlX2dlbShpOTE1KTsK
KworCQlzeXMgPSBpZ3Rfc3lzZnNfb3BlbihpOTE1KTsKKwkJaWd0X3JlcXVpcmUoc3lzICE9IC0x
KTsKKworCQllbmdpbmVzID0gb3BlbmF0KHN5cywgImVuZ2luZSIsIE9fUkRPTkxZKTsKKwkJaWd0
X3JlcXVpcmUoZW5naW5lcyAhPSAtMSk7CisKKwkJY2xvc2Uoc3lzKTsKKwl9CisKKwlfX2Zvcl9l
YWNoX3N0YXRpY19lbmdpbmUoaXQpIHsKKwkJaWd0X3N1YnRlc3RfZ3JvdXAgeworCQkJaW50IGVu
Z2luZSA9IC0xOworCQkJY2hhciAqbmFtZSA9IE5VTEw7CisKKwkJCWlndF9maXh0dXJlIHsKKwkJ
CQlzdHJ1Y3Qgc3RhdCBzdDsKKworCQkJCWVuZ2luZSA9IG9wZW5hdChlbmdpbmVzLCBpdC0+bmFt
ZSwgT19SRE9OTFkpOworCQkJCWlndF9yZXF1aXJlKGZzdGF0YXQoZW5naW5lLAorCQkJCQkJICAg
ICJwcmVlbXB0X3RpbWVvdXRfbXMiLAorCQkJCQkJICAgICZzdCwgMCkgPT0gMCk7CisKKwkJCQlu
YW1lID0gaWd0X3N5c2ZzX2dldChlbmdpbmUsICJuYW1lIik7CisJCQl9CisJCQlpZiAoIW5hbWUp
CisJCQkJY29udGludWU7CisKKwkJCWlndF9zdWJ0ZXN0X2YoIiVzLWlkZW1wb3RlbnQiLCBuYW1l
KQorCQkJCXRlc3RfaWRlbXBvdGVudChpOTE1LCBlbmdpbmUpOworCQkJaWd0X3N1YnRlc3RfZigi
JXMtaW52YWxpZCIsIG5hbWUpCisJCQkJdGVzdF9pbnZhbGlkKGk5MTUsIGVuZ2luZSk7CisJCQlp
Z3Rfc3VidGVzdF9mKCIlcy10aW1lb3V0IiwgbmFtZSkKKwkJCQl0ZXN0X3RpbWVvdXQoaTkxNSwg
ZW5naW5lKTsKKwkJCWlndF9zdWJ0ZXN0X2YoIiVzLW9mZiIsIG5hbWUpCisJCQkJdGVzdF9vZmYo
aTkxNSwgZW5naW5lKTsKKworCQkJZnJlZShuYW1lKTsKKwkJCWNsb3NlKGVuZ2luZSk7CisJCX0K
Kwl9CisKKwlpZ3RfZml4dHVyZSB7CisJCWNsb3NlKGVuZ2luZXMpOworCQljbG9zZShpOTE1KTsK
Kwl9Cit9CmRpZmYgLS1naXQgYS90ZXN0cy9tZXNvbi5idWlsZCBiL3Rlc3RzL21lc29uLmJ1aWxk
CmluZGV4IDNmM2VlZTI3Ny4uYTY5OTM3N2UzIDEwMDY0NAotLS0gYS90ZXN0cy9tZXNvbi5idWls
ZAorKysgYi90ZXN0cy9tZXNvbi5idWlsZApAQCAtMjM4LDYgKzIzOCw3IEBAIGk5MTVfcHJvZ3Mg
PSBbCiAJJ2k5MTVfcXVlcnknLAogCSdpOTE1X3NlbGZ0ZXN0JywKIAknaTkxNV9zdXNwZW5kJywK
Kwknc3lzZnNfcHJlZW1wdGlvbl90aW1lb3V0JywKIF0KIAogdGVzdF9kZXBzID0gWyBpZ3RfZGVw
cyBdCi0tIAoyLjI0LjAucmMwCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

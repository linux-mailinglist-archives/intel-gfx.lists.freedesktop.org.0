Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 70E6D57D97
	for <lists+intel-gfx@lfdr.de>; Thu, 27 Jun 2019 10:01:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 172656E826;
	Thu, 27 Jun 2019 08:01:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0626E6E7E2
 for <intel-gfx@lists.freedesktop.org>; Thu, 27 Jun 2019 08:00:54 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 Jun 2019 01:00:53 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,423,1557212400"; d="scan'208";a="313709790"
Received: from lswidere-mobl.ger.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.249.140.121])
 by orsmga004.jf.intel.com with ESMTP; 27 Jun 2019 01:00:52 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 27 Jun 2019 11:00:38 +0300
Message-Id: <20190627080045.8814-4-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190627080045.8814-1-lionel.g.landwerlin@intel.com>
References: <20190627080045.8814-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v5 03/10] drm/i915/perf: allow for CS OA configs
 to be created lazily
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SGVyZSB3ZSBpbnRyb2R1Y2UgYSBtZWNoYW5pc20gYnkgd2hpY2ggdGhlIGV4ZWNidWYgcGFydCBv
ZiB0aGUgaTkxNQpkcml2ZXIgd2lsbCBiZSBhYmxlIHRvIHJlcXVlc3QgdGhhdCBhIGJhdGNoIGJ1
ZmZlciBjb250YWluaW5nIHRoZQpwcm9ncmFtbWluZyBmb3IgYSBwYXJ0aWN1bGFyIE9BIGNvbmZp
ZyBiZSBjcmVhdGVkLgoKV2UnbGwgZXhlY3V0ZSB0aGVzZSBPQSBjb25maWd1cmF0aW9uIGJ1ZmZl
cnMgcmlnaHQgYmVmb3JlIGV4ZWN1dGluZyBhCnNldCBvZiB1c2Vyc3BhY2UgY29tbWFuZHMgc28g
dGhhdCBhIHBhcnRpY3VsYXIgdXNlciBiYXRjaGJ1ZmZlciBiZQpleGVjdXRlZCB3aXRoIGEgZ2l2
ZW4gT0EgY29uZmlndXJhdGlvbi4KClRoaXMgbWVjaGFuaXNtIGVzc2VudGlhbGx5IGFsbG93cyB0
aGUgdXNlcnNwYWNlIGRyaXZlciB0byBnbyB0aHJvdWdoCnNldmVyYWwgT0EgY29uZmlndXJhdGlv
biB3aXRob3V0IGhhdmluZyB0byBvcGVuL2Nsb3NlIHRoZSBpOTE1L3BlcmYKc3RyZWFtLgoKdjI6
IE5vIG5lZWQgZm9yIGxvY2tpbmcgb24gb2JqZWN0IE9BIGNvbmZpZyBvYmplY3QgY3JlYXRpb24g
KENocmlzKQogICAgRmx1c2ggY3B1IG1hcHBpbmcgb2YgT0EgY29uZmlnIChDaHJpcykKClNpZ25l
ZC1vZmYtYnk6IExpb25lbCBMYW5kd2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCB8ICAg
MSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICB8ICAyMiAr
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgIHwgMTcxICsr
KysrKysrKysrKysrKy0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTYyIGluc2VydGlvbnMoKyksIDMy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2NvbW1h
bmRzLmgKaW5kZXggZWVjMzFlMzZhY2E3Li5lN2VmZjlkYjM0M2UgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBAIC0xMjYsNiArMTI2LDcgQEAKICAq
LwogI2RlZmluZSBNSV9MT0FEX1JFR0lTVEVSX0lNTSh4KQlNSV9JTlNUUigweDIyLCAyKih4KS0x
KQogI2RlZmluZSAgIE1JX0xSSV9GT1JDRV9QT1NURUQJCSgxPDwxMikKKyNkZWZpbmUgTUlfTE9B
RF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MgKDEyNikKICNkZWZpbmUgTUlfU1RPUkVfUkVHSVNURVJf
TUVNICAgICAgICBNSV9JTlNUUigweDI0LCAxKQogI2RlZmluZSBNSV9TVE9SRV9SRUdJU1RFUl9N
RU1fR0VOOCAgIE1JX0lOU1RSKDB4MjQsIDIpCiAjZGVmaW5lICAgTUlfU1JNX0xSTV9HTE9CQUxf
R1RUCQkoMTw8MjIpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA2MmU3YzVlOGFlZTUuLjMz
M2NjM2M3NjkwYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xMTEwLDYgKzExMTAsMTAg
QEAgc3RydWN0IGk5MTVfb2FfY29uZmlnIHsKIAlzdHJ1Y3QgYXR0cmlidXRlICphdHRyc1syXTsK
IAlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSBzeXNmc19tZXRyaWNfaWQ7CiAKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOworCisJc3RydWN0IGxpc3RfaGVhZCB2bWFfbGluazsKKwog
CWF0b21pY190IHJlZl9jb3VudDsKIH07CiAKQEAgLTE2OTYsMTEgKzE3MDAsMjEgQEAgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgewogCQlzdHJ1Y3QgbXV0ZXggbWV0cmljc19sb2NrOwogCiAJCS8q
Ci0JCSAqIExpc3Qgb2YgZHluYW1pYyBjb25maWd1cmF0aW9ucywgeW91IG5lZWQgdG8gaG9sZAot
CQkgKiBkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgorCQkgKiBMaXN0
IG9mIGR5bmFtaWMgY29uZmlndXJhdGlvbnMgKHN0cnVjdCBpOTE1X29hX2NvbmZpZyksIHlvdQor
CQkgKiBuZWVkIHRvIGhvbGQgZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFjY2VzcyBp
dC4KIAkJICovCiAJCXN0cnVjdCBpZHIgbWV0cmljc19pZHI7CiAKKwkJLyoKKwkJICogTGlzdCBv
ZiBkeW5hbWljIGNvbmZpZ3VyYXRpb25zIChzdHJ1Y3QgaTkxNV9vYV9jb25maWcpCisJCSAqIHdo
aWNoIGhhdmUgYW4gYWxsb2NhdGVkIGJ1ZmZlciBpbiBHR1RUIGZvciByZWNvbmZpZ3VyYXRpb24s
CisJCSAqIHlvdSBuZWVkIHRvIGhvbGQgZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFj
Y2VzcyBpdC4KKwkJICogRWxlbWVudHMgYXJlIGFkZGVkIHRvIHRoZSBsaXN0IGxhemlsbHkgb24g
ZXhlY2J1ZiAod2hlbiBhCisJCSAqIHBhcnRpY3VsYXIgY29uZmlndXJhdGlvbiBpcyByZXF1ZXN0
ZWQpLiBUaGUgbGlzdCBpcyBmcmVlZAorCQkgKiB1cG9uIGNsb3NpbmcgdGhlIHBlcmYgc3RyZWFt
LgorCQkgKi8KKwkJc3RydWN0IGxpc3RfaGVhZCBtZXRyaWNzX2J1ZmZlcnM7CisKIAkJLyoKIAkJ
ICogTG9jayBhc3NvY2lhdGVkIHdpdGggYW55dGhpbmcgYmVsb3cgd2l0aGluIHRoaXMgc3RydWN0
dXJlCiAJCSAqIGV4Y2VwdCBleGNsdXNpdmVfc3RyZWFtLgpAQCAtMjU4Niw2ICsyNjAwLDEwIEBA
IGludCBpOTE1X3BlcmZfcmVtb3ZlX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogdm9pZCBpOTE1X29hX2luaXRfcmVnX3N0YXRlKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkg
ICAgdTMyICpyZWdfc3RhdGUpOworaW50IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJICAgIGludCBtZXRyaWNzX3NldCwKKwkJCSAgICBz
dHJ1Y3QgaTkxNV9vYV9jb25maWcgKipvdXRfY29uZmlnLAorCQkJICAgIHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICoqb3V0X29iaik7CiAKIC8qIGk5MTVfZ2VtX2V2aWN0LmMgKi8KIGludCBf
X211c3RfY2hlY2sgaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCA5MDllMjI4MzVlODQuLjJm
MWRjOWJlM2JmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTM2Niw5ICszNjYsMTYg
QEAgc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIHsKIAlpbnQgb2FfcGVyaW9kX2V4cG9uZW50
OwogfTsKIAotc3RhdGljIHZvaWQgZnJlZV9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAotCQkJICAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitz
dGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmln
KQogeworCWlmICghYXRvbWljX2RlY19hbmRfdGVzdCgmb2FfY29uZmlnLT5yZWZfY291bnQpKQor
CQlyZXR1cm47CisKKwlpZiAob2FfY29uZmlnLT5vYmopIHsKKwkJbGlzdF9kZWwoJm9hX2NvbmZp
Zy0+dm1hX2xpbmspOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9hX2NvbmZpZy0+b2JqKTsKKwl9
CisKIAlpZiAoIVBUUl9FUlIob2FfY29uZmlnLT5mbGV4X3JlZ3MpKQogCQlrZnJlZShvYV9jb25m
aWctPmZsZXhfcmVncyk7CiAJaWYgKCFQVFJfRVJSKG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3Mp
KQpAQCAtMzc4LDM4ICszODUsMTI2IEBAIHN0YXRpYyB2b2lkIGZyZWVfb2FfY29uZmlnKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlrZnJlZShvYV9jb25maWcpOwogfQogCi1z
dGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKLQkJCSAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitzdGF0aWMgdTMyICp3
cml0ZV9jc19taV9scmkodTMyICpjcywgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdfZGF0
YSwgdTMyIG5fcmVncykKIHsKLQlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJm9hX2NvbmZpZy0+
cmVmX2NvdW50KSkKLQkJcmV0dXJuOworCXUzMiBpOwogCi0JZnJlZV9vYV9jb25maWcoZGV2X3By
aXYsIG9hX2NvbmZpZyk7CisJZm9yIChpID0gMDsgaSA8IG5fcmVnczsgaSsrKSB7CisJCWlmICgo
aSAlIE1JX0xPQURfUkVHSVNURVJfSU1NX01BWF9SRUdTKSA9PSAwKSB7CisJCQl1MzIgbl9scmkg
PSBtaW4obl9yZWdzIC0gaSwKKwkJCQkJKHUzMikgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JF
R1MpOworCisJCQkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKG5fbHJpKTsKKwkJfQorCQkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZ19kYXRhW2ldLmFkZHIpOworCQkqY3MrKyA9
IHJlZ19kYXRhW2ldLnZhbHVlOworCX0KKworCXJldHVybiBjczsKIH0KIAotc3RhdGljIGludCBn
ZXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSBpbnQg
bWV0cmljc19zZXQsCi0JCQkgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZykKK3N0
YXRpYyBpbnQgYWxsb2Nfb2FfY29uZmlnX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKKwkJCQkgIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnKQogewotCWludCBy
ZXQ7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmJvOworCXNpemVfdCBjb25maWdfbGVu
Z3RoID0gMDsKKwl1MzIgKmNzOwogCi0JaWYgKG1ldHJpY3Nfc2V0ID09IDEpIHsKLQkJKm91dF9j
b25maWcgPSAmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWc7Ci0JCWF0b21pY19pbmMoJmRl
dl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnJlZl9jb3VudCk7Ci0JCXJldHVybiAwOworCWlm
IChvYV9jb25maWctPm11eF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xlbmd0aCArPSBESVZf
Uk9VTkRfVVAob2FfY29uZmlnLT5tdXhfcmVnc19sZW4sCisJCQkJCSAgICAgIE1JX0xPQURfUkVH
SVNURVJfSU1NX01BWF9SRUdTKSAqIDQ7CisJCWNvbmZpZ19sZW5ndGggKz0gb2FfY29uZmlnLT5t
dXhfcmVnc19sZW4gKiA4OworCX0KKwlpZiAob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4g
PiAwKSB7CisJCWNvbmZpZ19sZW5ndGggKz0gRElWX1JPVU5EX1VQKG9hX2NvbmZpZy0+Yl9jb3Vu
dGVyX3JlZ3NfbGVuLAorCQkJCQkgICAgICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUykg
KiA0OworCQljb25maWdfbGVuZ3RoICs9IG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuICog
ODsKKwl9CisJaWYgKG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xl
bmd0aCArPSBESVZfUk9VTkRfVVAob2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuLAorCQkJCQkgICAg
ICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUykgKiA0OworCQljb25maWdfbGVuZ3RoICs9
IG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiAqIDg7CiAJfQorCWNvbmZpZ19sZW5ndGggKz0gNDsg
LyogTUlfQkFUQ0hfQlVGRkVSX0VORCAqLworCWNvbmZpZ19sZW5ndGggPSBBTElHTihjb25maWdf
bGVuZ3RoLCBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOworCWJvID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBjb25maWdfbGVuZ3RoKTsKKwlpZiAoSVNfRVJSKGJvKSkK
KwkJcmV0dXJuIFBUUl9FUlIoYm8pOworCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChi
bywgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9w
dXQoYm8pOworCQlyZXR1cm4gUFRSX0VSUihjcyk7CisJfQorCisJY3MgPSB3cml0ZV9jc19taV9s
cmkoY3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKKwlj
cyA9IHdyaXRlX2NzX21pX2xyaShjcywgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywgb2FfY29u
ZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOworCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLCBvYV9j
b25maWctPmZsZXhfcmVncywgb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuKTsKKworCSpjcysrID0g
TUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoYm8pOwor
CWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoYm8pOworCisJb2FfY29uZmlnLT5vYmogPSBibzsK
KworCXJldHVybiAwOworfQorCitpbnQgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgaW50IG1ldHJpY3Nfc2V0LAorCQkJICAgIHN0
cnVjdCBpOTE1X29hX2NvbmZpZyAqKm91dF9jb25maWcsCisJCQkgICAgc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKipvdXRfb2JqKQoreworCWludCByZXQgPSAwOworCXN0cnVjdCBpOTE1X29h
X2NvbmZpZyAqb2FfY29uZmlnOworCisJaWYgKCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKQorCQly
ZXR1cm4gLUVOT0RFVjsKKworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+
cGVyZi5tZXRyaWNzX2xvY2spOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQkqb3V0X2Nv
bmZpZyA9IGlkcl9maW5kKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgbWV0cmljc19zZXQp
OwotCWlmICghKm91dF9jb25maWcpCi0JCXJldCA9IC1FSU5WQUw7Ci0JZWxzZQotCQlhdG9taWNf
aW5jKCYoKm91dF9jb25maWcpLT5yZWZfY291bnQpOworCWlmIChtZXRyaWNzX3NldCA9PSAxKSB7
CisJCW9hX2NvbmZpZyA9ICZpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnOworCX0gZWxzZSB7CisJ
CW9hX2NvbmZpZyA9IGlkcl9maW5kKCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCBtZXRyaWNzX3Nl
dCk7CisJCWlmICghb2FfY29uZmlnKSB7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290byB1bmxv
Y2s7CisJCX0KKwl9CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9j
ayk7CisJaWYgKG91dF9jb25maWcpIHsKKwkJYXRvbWljX2luYygmb2FfY29uZmlnLT5yZWZfY291
bnQpOworCQkqb3V0X2NvbmZpZyA9IG9hX2NvbmZpZzsKKwl9CisKKwlpZiAob3V0X29iaikgewor
CQlpZiAob2FfY29uZmlnLT5vYmopIHsKKwkJCSpvdXRfb2JqID0gaTkxNV9nZW1fb2JqZWN0X2dl
dChvYV9jb25maWctPm9iaik7CisJCX0gZWxzZSB7CisJCQlyZXQgPSBhbGxvY19vYV9jb25maWdf
YnVmZmVyKGk5MTUsIG9hX2NvbmZpZyk7CisJCQlpZiAocmV0KQorCQkJCWdvdG8gZXJyX2J1Zl9h
bGxvYzsKKworCQkJbGlzdF9hZGQoJm9hX2NvbmZpZy0+dm1hX2xpbmssCisJCQkJICZpOTE1LT5w
ZXJmLm1ldHJpY3NfYnVmZmVycyk7CisJCQkqb3V0X29iaiA9IGk5MTVfZ2VtX29iamVjdF9nZXQo
b2FfY29uZmlnLT5vYmopOworCQl9CisJfQorCisJZ290byB1bmxvY2s7CisKK2Vycl9idWZfYWxs
b2M6CisJaWYgKG91dF9jb25maWcpIHsKKwkJcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOworCQkq
b3V0X2NvbmZpZyA9IE5VTEw7CisJfQordW5sb2NrOgorCW11dGV4X3VubG9jaygmaTkxNS0+cGVy
Zi5tZXRyaWNzX2xvY2spOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTEzODAsNyArMTQ3NSw3IEBA
IHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3RyZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJl
YW0gKnN0cmVhbSkKIAlpZiAoc3RyZWFtLT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0
cmVhbSk7CiAKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJ
cHV0X29hX2NvbmZpZyhzdHJlYW0tPm9hX2NvbmZpZyk7CiAKIAlpZiAoZGV2X3ByaXYtPnBlcmYu
b2Euc3B1cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgewogCQlEUk1fTk9URSgiJWQgc3B1cmlvdXMg
T0EgcmVwb3J0IG5vdGljZXMgc3VwcHJlc3NlZCBkdWUgdG8gcmF0ZWxpbWl0aW5nXG4iLApAQCAt
MjExNyw3ICsyMjEyLDggQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCX0KIAl9CiAKLQlyZXQgPSBnZXRfb2FfY29uZmln
KGRldl9wcml2LCBwcm9wcy0+bWV0cmljc19zZXQsICZzdHJlYW0tPm9hX2NvbmZpZyk7CisJcmV0
ID0gaTkxNV9wZXJmX2dldF9vYV9jb25maWcoZGV2X3ByaXYsIHByb3BzLT5tZXRyaWNzX3NldCwK
KwkJCQkgICAgICAmc3RyZWFtLT5vYV9jb25maWcsIE5VTEwpOwogCWlmIChyZXQpIHsKIAkJRFJN
X0RFQlVHKCJJbnZhbGlkIE9BIGNvbmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nfc2V0KTsK
IAkJZ290byBlcnJfY29uZmlnOwpAQCAtMjE1NSw2ICsyMjUxLDggQEAgc3RhdGljIGludCBpOTE1
X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCWdvdG8g
ZXJyX2VuYWJsZTsKIAl9CiAKKwlEUk1fREVCVUcoIm9wZW5pbmcgc3RyZWFtIG9hIGNvbmZpZyB1
dWlkPSVzXG4iLCBzdHJlYW0tPm9hX2NvbmZpZy0+dXVpZCk7CisKIAltdXRleF91bmxvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiAwOwpAQCAtMjE2OCw3ICsyMjY2
LDcgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0sCiAJZnJlZV9vYV9idWZmZXIoZGV2X3ByaXYpOwogCiBlcnJfb2FfYnVmX2Fs
bG9jOgotCXB1dF9vYV9jb25maWcoZGV2X3ByaXYsIHN0cmVhbS0+b2FfY29uZmlnKTsKKwlwdXRf
b2FfY29uZmlnKHN0cmVhbS0+b2FfY29uZmlnKTsKIAogCWludGVsX3VuY29yZV9mb3JjZXdha2Vf
cHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAlpbnRlbF9ydW50aW1lX3Bt
X3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHN0cmVhbS0+d2FrZXJlZik7CkBAIC0yNTM1LDkg
KzI2MzMsMjEgQEAgc3RhdGljIGludCBpOTE1X3BlcmZfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlu
b2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIHsKIAlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHN0cmVhbS0+ZGV2X3ByaXY7CisJc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25m
aWcsICpuZXh0OwogCiAJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBlcmYubG9jayk7CisKIAlpOTE1
X3BlcmZfZGVzdHJveV9sb2NrZWQoc3RyZWFtKTsKKworCS8qIERpc3Bvc2Ugb2YgYWxsIG9hIGNv
bmZpZyBiYXRjaCBidWZmZXJzLiAqLworCW11dGV4X2xvY2soJmRldl9wcml2LT5wZXJmLm1ldHJp
Y3NfbG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKG9hX2NvbmZpZywgbmV4dCwgJmRl
dl9wcml2LT5wZXJmLm1ldHJpY3NfYnVmZmVycywgdm1hX2xpbmspIHsKKwkJbGlzdF9kZWwoJm9h
X2NvbmZpZy0+dm1hX2xpbmspOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9hX2NvbmZpZy0+b2Jq
KTsKKwkJb2FfY29uZmlnLT5vYmogPSBOVUxMOworCX0KKwltdXRleF91bmxvY2soJmRldl9wcml2
LT5wZXJmLm1ldHJpY3NfbG9jayk7CisKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLmxv
Y2spOwogCiAJcmV0dXJuIDA7CkBAIC0zMzIwLDcgKzM0MzAsNyBAQCBpbnQgaTkxNV9wZXJmX2Fk
ZF9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIHN5c2Zz
X2VycjoKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7CiByZWdf
ZXJyOgotCXB1dF9vYV9jb25maWcoZGV2X3ByaXYsIG9hX2NvbmZpZyk7CisJcHV0X29hX2NvbmZp
ZyhvYV9jb25maWcpOwogCURSTV9ERUJVRygiRmFpbGVkIHRvIGFkZCBuZXcgT0EgY29uZmlnXG4i
KTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMzM3NCw3ICszNDg0LDcgQEAgaW50IGk5MTVfcGVyZl9y
ZW1vdmVfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAK
IAlEUk1fREVCVUcoIlJlbW92ZWQgY29uZmlnICVzIGlkPSVpXG4iLCBvYV9jb25maWctPnV1aWQs
IG9hX2NvbmZpZy0+aWQpOwogCi0JcHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmlnKTsK
KwlwdXRfb2FfY29uZmlnKG9hX2NvbmZpZyk7CiAKIGNvbmZpZ19lcnI6CiAJbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOwpAQCAtMzUyMCw2ICszNjMwLDggQEAgdm9p
ZCBpOTE1X3BlcmZfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWlu
aXRfd2FpdHF1ZXVlX2hlYWQoJmRldl9wcml2LT5wZXJmLm9hLnBvbGxfd3EpOwogCiAJCUlOSVRf
TElTVF9IRUFEKCZkZXZfcHJpdi0+cGVyZi5zdHJlYW1zKTsKKwkJSU5JVF9MSVNUX0hFQUQoJmRl
dl9wcml2LT5wZXJmLm1ldHJpY3NfYnVmZmVycyk7CisKIAkJbXV0ZXhfaW5pdCgmZGV2X3ByaXYt
PnBlcmYubG9jayk7CiAJCXNwaW5fbG9ja19pbml0KCZkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZm
ZXIucHRyX2xvY2spOwogCkBAIC0zNTM2LDEwICszNjQ4LDkgQEAgdm9pZCBpOTE1X3BlcmZfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIHN0YXRpYyBpbnQgZGVzdHJv
eV9jb25maWcoaW50IGlkLCB2b2lkICpwLCB2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7CiAJc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9j
b25maWcgPSBwOwogCi0JcHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmlnKTsKKwlwdXRf
b2FfY29uZmlnKG9hX2NvbmZpZyk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTM1NTMsNyArMzY2NCw3
IEBAIHZvaWQgaTkxNV9wZXJmX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCWlmICghZGV2X3ByaXYtPnBlcmYuaW5pdGlhbGl6ZWQpCiAJCXJldHVybjsKIAotCWlkcl9m
b3JfZWFjaCgmZGV2X3ByaXYtPnBlcmYubWV0cmljc19pZHIsIGRlc3Ryb3lfY29uZmlnLCBkZXZf
cHJpdik7CisJaWRyX2Zvcl9lYWNoKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgZGVzdHJv
eV9jb25maWcsIE5VTEwpOwogCWlkcl9kZXN0cm95KCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lk
cik7CiAKIAl1bnJlZ2lzdGVyX3N5c2N0bF90YWJsZShkZXZfcHJpdi0+cGVyZi5zeXNjdGxfaGVh
ZGVyKTsKLS0gCjIuMjEuMC4zOTIuZ2Y4ZjY3ODcxNTllCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

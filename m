Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id ED3E8EF87D
	for <lists+intel-gfx@lfdr.de>; Tue,  5 Nov 2019 10:21:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B54826E949;
	Tue,  5 Nov 2019 09:21:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 74D8889A32
 for <intel-gfx@lists.freedesktop.org>; Tue,  5 Nov 2019 09:21:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19084822-1500050 
 for multiple; Tue, 05 Nov 2019 09:21:17 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  5 Nov 2019 09:21:11 +0000
Message-Id: <20191105092115.11451-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191105092115.11451-1-chris@chris-wilson.co.uk>
References: <20191105092115.11451-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/10] drm/i915: Remove i915->kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsb2NhdGUgb25seSBhbiBpbnRlcm5hbCBpbnRlbF9jb250ZXh0IGZvciB0aGUga2VybmVsX2Nv
bnRleHQsIGZvcmdvaW5nCmEgZ2xvYmFsIEdFTSBjb250ZXh0IGZvciBpbnRlcm5hbCB1c2UgYXMg
d2Ugb25seSByZXF1aXJlIGEgc2VwYXJhdGUKYWRkcmVzcyBzcGFjZSAoZm9yIG91ciBvd24gcHJv
dGVjdGlvbikuCgpOb3cgaGF2aW5nIHdlYW5lZCBHVCBmcm9tIHJlcXVpcmluZyBjZS0+Z2VtX2Nv
bnRleHQsIHdlIGNhbiBzdG9wCnJlZmVyZW5jaW5nIGl0IGVudGlyZWx5LiBUaGlzIGFsc28gbWVh
bnMgd2Ugbm8gbG9uZ2VyIGhhdmUgdG8gY3JlYXRlIHJhbmRvbQphbmQgdW5uZWNlc3NhcnkgR0VN
IGNvbnRleHRzIGZvciBpbnRlcm5hbCB1c2UuCgpHRU0gY29udGV4dHMgYXJlIG5vdyBlbnRpcmVs
eSBmb3IgdHJhY2tpbmcgR0VNIGNsaWVudHMsIGFuZCBpbnRlbF9jb250ZXh0CnRoZSBleGVjdXRp
b24gZW52aXJvbm1lbnQgb24gdGhlIEdQVS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgICB8ICA5MSArKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgIDYgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgMzIgKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfY3MuYyAgICAgfCAgMjEgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndC5jICAgICAgICAgICAgfCAgMjYgKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3RfdHlwZXMuaCAgICAgIHwgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jICAgICAgICAgICB8ICAxOCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5oICAgICAgICAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfcmVzZXQuYyAgICAgICAgIHwgICA2ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3Jpbmdfc3VibWlzc2lvbi5jICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2NvbnRleHQuYyAgICB8ICA1OSArKystLS0tLQogLi4uL2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2VuZ2luZV9oZWFydGJlYXQuYyAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9oYW5nY2hlY2suYyAgfCAgMjkgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgMTM3ICsrKysrKy0tLS0tLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwgIDE2ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgIDMgLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgIDE2ICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyAgICAgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAgICAgIHwgICAzIC0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcmVxdWVzdC5jICAgICAgICAgICB8ICAgNSArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIHwgICA2ICstCiAuLi4vZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAgIDggKy0KIDI4IGZpbGVzIGNoYW5nZWQs
IDIxNiBpbnNlcnRpb25zKCspLCAzMzEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggODNiMDIwNWY5MDBjLi5lYjBhODA2YTNm
ZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAt
MTcwLDYgKzE3MCwyNiBAQCBsb29rdXBfdXNlcl9lbmdpbmUoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCwKIAlyZXR1cm4gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgaWR4KTsK
IH0KIAorc3RhdGljIHZvaWQgaW50ZWxfY29udGV4dF9zZXRfZ2VtKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwKKwkJCQkgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCit7CisJY2UtPmdl
bV9jb250ZXh0ID0gY3R4OworCisJY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmluZ19zaXpl
KFNaXzE2Syk7CisKKwlpZiAoY3R4LT52bSkgeworCQlpOTE1X3ZtX3B1dChjZS0+dm0pOworCQlj
ZS0+dm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtKTsKKwl9CisKKwlpZiAoY3R4LT50aW1lbGluZSkK
KwkJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfZ2V0KGN0eC0+dGltZWxpbmUpOworCisJ
aWYgKGN0eC0+c2NoZWQucHJpb3JpdHkgPj0gSTkxNV9QUklPUklUWV9OT1JNQUwgJiYKKwkgICAg
aW50ZWxfZW5naW5lX2hhc19zZW1hcGhvcmVzKGNlLT5lbmdpbmUpKQorCQlfX3NldF9iaXQoQ09O
VEVYVF9VU0VfU0VNQVBIT1JFUywgJmNlLT5mbGFncyk7Cit9CisKIHN0YXRpYyB2b2lkIF9fZnJl
ZV9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzICplLCB1bnNpZ25lZCBpbnQgY291bnQp
CiB7CiAJd2hpbGUgKGNvdW50LS0pIHsKQEAgLTIxMiwxMiArMjMyLDE0IEBAIHN0YXRpYyBzdHJ1
Y3QgaTkxNV9nZW1fZW5naW5lcyAqZGVmYXVsdF9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHgpCiAJCUdFTV9CVUdfT04oZW5naW5lLT5sZWdhY3lfaWR4ID49IEk5MTVfTlVNX0VO
R0lORVMpOwogCQlHRU1fQlVHX09OKGUtPmVuZ2luZXNbZW5naW5lLT5sZWdhY3lfaWR4XSk7CiAK
LQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShjdHgsIGVuZ2luZSk7CisJCWNlID0gaW50ZWxf
Y29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihjZSkpIHsKIAkJCV9fZnJlZV9l
bmdpbmVzKGUsIGUtPm51bV9lbmdpbmVzICsgMSk7CiAJCQlyZXR1cm4gRVJSX0NBU1QoY2UpOwog
CQl9CiAKKwkJaW50ZWxfY29udGV4dF9zZXRfZ2VtKGNlLCBjdHgpOworCiAJCWUtPmVuZ2luZXNb
ZW5naW5lLT5sZWdhY3lfaWR4XSA9IGNlOwogCQllLT5udW1fZW5naW5lcyA9IG1heChlLT5udW1f
ZW5naW5lcywgZW5naW5lLT5sZWdhY3lfaWR4KTsKIAl9CkBAIC02NTEsMzcgKzY3Myw2IEBAIGk5
MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1bnNp
Z25lZCBpbnQgZmxhZ3MpCiAJcmV0dXJuIGN0eDsKIH0KIAotc3RhdGljIHZvaWQKLWRlc3Ryb3lf
a2VybmVsX2NvbnRleHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKipjdHhwKQotewotCXN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0KLQkvKiBLZWVwIHRoZSBjb250ZXh0IHJlZiBzbyB0
aGF0IHdlIGNhbiBmcmVlIGl0IGltbWVkaWF0ZWx5IG91cnNlbHZlcyAqLwotCWN0eCA9IGk5MTVf
Z2VtX2NvbnRleHRfZ2V0KGZldGNoX2FuZF96ZXJvKGN0eHApKTsKLQlHRU1fQlVHX09OKCFpOTE1
X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjdHgpKTsKLQotCWNvbnRleHRfY2xvc2UoY3R4KTsKLQlp
OTE1X2dlbV9jb250ZXh0X2ZyZWUoY3R4KTsKLX0KLQotc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KgotaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCBpbnQgcHJpbykKLXsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCi0J
Y3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkxNSwgMCk7Ci0JaWYgKElTX0VSUihjdHgp
KQotCQlyZXR1cm4gY3R4OwotCi0JaTkxNV9nZW1fY29udGV4dF9jbGVhcl9iYW5uYWJsZShjdHgp
OwotCWk5MTVfZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlKGN0eCk7Ci0JY3R4LT5zY2hlZC5w
cmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWShwcmlvKTsKLQotCUdFTV9CVUdfT04oIWk5MTVf
Z2VtX2NvbnRleHRfaXNfa2VybmVsKGN0eCkpOwotCi0JcmV0dXJuIGN0eDsKLX0KLQogc3RhdGlj
IHZvaWQgaW5pdF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogewogCXNw
aW5fbG9ja19pbml0KCZnYy0+bG9jayk7CkBAIC02OTEsMzIgKzY4MiwxMiBAQCBzdGF0aWMgdm9p
ZCBpbml0X2NvbnRleHRzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiAJaW5pdF9sbGlz
dF9oZWFkKCZnYy0+ZnJlZV9saXN0KTsKIH0KIAotaW50IGk5MTVfZ2VtX2luaXRfY29udGV4dHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit2b2lkIGk5MTVfZ2VtX2luaXRfY29udGV4
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eDsKLQotCS8qIFJlYXNzdXJlIG91cnNlbHZlcyB3ZSBhcmUgb25seSBjYWxsZWQg
b25jZSAqLwotCUdFTV9CVUdfT04oaTkxNS0+a2VybmVsX2NvbnRleHQpOwotCiAJaW5pdF9jb250
ZXh0cygmaTkxNS0+Z2VtLmNvbnRleHRzKTsKLQotCS8qIGxvd2VzdCBwcmlvcml0eTsgaWRsZSB0
YXNrICovCi0JY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVf
UFJJT1JJVFlfTUlOKTsKLQlpZiAoSVNfRVJSKGN0eCkpIHsKLQkJRFJNX0VSUk9SKCJGYWlsZWQg
dG8gY3JlYXRlIGRlZmF1bHQgZ2xvYmFsIGNvbnRleHRcbiIpOwotCQlyZXR1cm4gUFRSX0VSUihj
dHgpOwotCX0KLQlpOTE1LT5rZXJuZWxfY29udGV4dCA9IGN0eDsKLQogCURSTV9ERUJVR19EUklW
RVIoIiVzIGNvbnRleHQgc3VwcG9ydCBpbml0aWFsaXplZFxuIiwKIAkJCSBEUklWRVJfQ0FQUyhp
OTE1KS0+aGFzX2xvZ2ljYWxfY29udGV4dHMgPwogCQkJICJsb2dpY2FsIiA6ICJmYWtlIik7Ci0J
cmV0dXJuIDA7Ci19Ci0KLXZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQotewotCWRlc3Ryb3lfa2VybmVsX2NvbnRleHQo
Jmk5MTUtPmtlcm5lbF9jb250ZXh0KTsKIH0KIAogc3RhdGljIGludCBjb250ZXh0X2lkcl9jbGVh
bnVwKGludCBpZCwgdm9pZCAqcCwgdm9pZCAqZGF0YSkKQEAgLTE0NzQsMTIgKzE0NDUsMTQgQEAg
c2V0X2VuZ2luZXNfX2xvYWRfYmFsYW5jZShzdHJ1Y3QgaTkxNV91c2VyX2V4dGVuc2lvbiBfX3Vz
ZXIgKmJhc2UsIHZvaWQgKmRhdGEpCiAJCX0KIAl9CiAKLQljZSA9IGludGVsX2V4ZWNsaXN0c19j
cmVhdGVfdmlydHVhbChzZXQtPmN0eCwgc2libGluZ3MsIG4pOworCWNlID0gaW50ZWxfZXhlY2xp
c3RzX2NyZWF0ZV92aXJ0dWFsKHNpYmxpbmdzLCBuKTsKIAlpZiAoSVNfRVJSKGNlKSkgewogCQll
cnIgPSBQVFJfRVJSKGNlKTsKIAkJZ290byBvdXRfc2libGluZ3M7CiAJfQogCisJaW50ZWxfY29u
dGV4dF9zZXRfZ2VtKGNlLCBzZXQtPmN0eCk7CisKIAlpZiAoY21weGNoZygmc2V0LT5lbmdpbmVz
LT5lbmdpbmVzW2lkeF0sIE5VTEwsIGNlKSkgewogCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJ
CWVyciA9IC1FRVhJU1Q7CkBAIC0xNjQ5LDEyICsxNjIyLDE0IEBAIHNldF9lbmdpbmVzKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQlyZXR1cm4gLUVOT0VOVDsKIAkJfQogCi0JCWNl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUpOworCQljZSA9IGludGVsX2NvbnRl
eHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQlfX2ZyZWVfZW5naW5l
cyhzZXQuZW5naW5lcywgbik7CiAJCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAJCX0KIAorCQlpbnRl
bF9jb250ZXh0X3NldF9nZW0oY2UsIGN0eCk7CisKIAkJc2V0LmVuZ2luZXMtPmVuZ2luZXNbbl0g
PSBjZTsKIAl9CiAJc2V0LmVuZ2luZXMtPm51bV9lbmdpbmVzID0gbnVtX2VuZ2luZXM7CkBAIC0x
OTU1LDEzICsxOTMwLDE1IEBAIHN0YXRpYyBpbnQgY2xvbmVfZW5naW5lcyhzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqZHN0LAogCQkgKi8KIAkJaWYgKGludGVsX2VuZ2luZV9pc192aXJ0dWFsKGVu
Z2luZSkpCiAJCQljbG9uZS0+ZW5naW5lc1tuXSA9Ci0JCQkJaW50ZWxfZXhlY2xpc3RzX2Nsb25l
X3ZpcnR1YWwoZHN0LCBlbmdpbmUpOworCQkJCWludGVsX2V4ZWNsaXN0c19jbG9uZV92aXJ0dWFs
KGVuZ2luZSk7CiAJCWVsc2UKLQkJCWNsb25lLT5lbmdpbmVzW25dID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoZHN0LCBlbmdpbmUpOworCQkJY2xvbmUtPmVuZ2luZXNbbl0gPSBpbnRlbF9jb250ZXh0
X2NyZWF0ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSX09SX05VTEwoY2xvbmUtPmVuZ2luZXNbbl0p
KSB7CiAJCQlfX2ZyZWVfZW5naW5lcyhjbG9uZSwgbik7CiAJCQlnb3RvIGVycl91bmxvY2s7CiAJ
CX0KKworCQlpbnRlbF9jb250ZXh0X3NldF9nZW0oY2xvbmUtPmVuZ2luZXNbbl0sIGRzdCk7CiAJ
fQogCWNsb25lLT5udW1fZW5naW5lcyA9IG47CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5oCmluZGV4IDY5OTMyODk5ODAzZS4uZDk5ZmZmNDgxZDU5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKQEAgLTExNSw4ICsx
MTUsNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIH0KIAogLyogaTkxNV9nZW1fY29udGV4dC5jICov
Ci1pbnQgX19tdXN0X2NoZWNrIGk5MTVfZ2VtX2luaXRfY29udGV4dHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpOwotdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpOTE1X2dlbV9pbml0X2NvbnRl
eHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogaW50IGk5MTVfZ2VtX2NvbnRl
eHRfb3BlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgc3RydWN0IGRybV9m
aWxlICpmaWxlKTsKQEAgLTE0MCw5ICsxMzksNiBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9zZXRw
YXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogaW50IGk5MTVf
Z2VtX2NvbnRleHRfcmVzZXRfc3RhdHNfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJCQkgICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlKTsKIAotc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKgotaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgcHJpbyk7Ci0KIHN0YXRpYyBpbmxpbmUgc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKgogaTkxNV9nZW1fY29udGV4dF9nZXQoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZXhlY2J1ZmZlci5jCmluZGV4IDZkYzg2YzEyOWVlZS4uNGY2Yjg0N2VhMDExIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTEyNjEsOCAr
MTI2MSw3IEBAIHN0YXRpYyB1MzIgKnJlbG9jX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICpl
YiwKIAkJCSAqIG1lbW9yeSBsb2NhdGlvbi4KIAkJCSAqLwogCQkJaWYgKGNhY2hlLT5nZW4gPj0g
MTIpCi0JCQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlYi0+Y29udGV4dC0+Z2VtX2NvbnRl
eHQsCi0JCQkJCQkJICBlYi0+ZW5naW5lKTsKKwkJCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGViLT5lbmdpbmUpOwogCQkJZWxzZQogCQkJCWNlID0gaW50ZWxfY29udGV4dF9nZXQoZWItPmNv
bnRleHQpOwogCQkJaWYgKElTX0VSUihjZSkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3VzZXJwdHIuYwppbmRleCAxZTA0NWMzMzcwNDQuLjQzMmYyODI4YjA5MyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCkBAIC03NTMsMTUgKzc1
MywxMSBAQCBpOTE1X2dlbV91c2VycHRyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJ
CXJldHVybiAtRUZBVUxUOwogCiAJaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9VU0VSUFRSX1JFQURf
T05MWSkgewotCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKLQogCQkvKgogCQkgKiBP
biBhbG1vc3QgYWxsIG9mIHRoZSBvbGRlciBodywgd2UgY2Fubm90IHRlbGwgdGhlIEdQVSB0aGF0
CiAJCSAqIGEgcGFnZSBpcyByZWFkb25seS4KIAkJICovCi0JCXZtID0gcmN1X2RlcmVmZXJlbmNl
X3Byb3RlY3RlZChkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQtPnZtLAotCQkJCQkgICAgICAgdHJ1
ZSk7IC8qIHN0YXRpYyB2bSAqLwotCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkKKwkJ
aWYgKCFkZXZfcHJpdi0+Z3Qudm0tPmhhc19yZWFkX29ubHkpCiAJCQlyZXR1cm4gLUVOT0RFVjsK
IAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9jb250ZXh0LmMKaW5kZXggNjJmYWJjMDIzYTgzLi4xNjY1ZTM5M2NjMWUgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4
dC5jCkBAIC0zMDksNyArMzA5LDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2
b2lkICphcmcpCiAJCQlpZiAoIWRhdGFbbV0uY2VbMF0pCiAJCQkJY29udGludWU7CiAKLQkJCWNl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBkYXRhW21dLmNlWzBdLT5lbmdpbmUpOworCQkJ
Y2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShkYXRhW21dLmNlWzBdLT5lbmdpbmUpOwogCQkJaWYg
KElTX0VSUihjZSkpCiAJCQkJZ290byBvdXQ7CiAKQEAgLTEyMzIsOCArMTIzMiw3IEBAIF9faWd0
X2N0eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJaHdlaWdodDMyKGVu
Z2luZS0+c3NldS5zbGljZV9tYXNrKSwKIAkJCWh3ZWlnaHQzMihwZ19zc2V1LnNsaWNlX21hc2sp
KTsKIAotCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQt
PmdlbV9jb250ZXh0LAotCQkJCQkgIGVuZ2luZSk7CisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVh
dGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihjZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIoY2UpOwog
CQkJZ290byBvdXRfcHV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9tb2NrX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvbW9ja19jb250ZXh0LmMKaW5kZXggMjliODk4NGYwZTQ3Li5mNDcyZmM5MjQwZDUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYwpA
QCAtOTcsNyArOTcsMTYgQEAgbGl2ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqCiBr
ZXJuZWxfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1cm4g
aTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlfTk9STUFM
KTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCisJY3R4ID0gaTkxNV9nZW1fY3Jl
YXRlX2NvbnRleHQoaTkxNSwgMCk7CisJaWYgKElTX0VSUihjdHgpKQorCQlyZXR1cm4gY3R4Owor
CisJR0VNX0JVR19PTighaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwoY3R4KSk7CisJaTkxNV9n
ZW1fY29udGV4dF9jbGVhcl9iYW5uYWJsZShjdHgpOworCisJcmV0dXJuIGN0eDsKIH0KIAogdm9p
ZCBrZXJuZWxfY29udGV4dF9jbG9zZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IDcwNzVkMDNmNTA4Zi4uOGI3
MWIyY2NiZjI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250
ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC0z
MSw4ICszMSw3IEBAIHZvaWQgaW50ZWxfY29udGV4dF9mcmVlKHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSkKIH0KIAogc3RydWN0IGludGVsX2NvbnRleHQgKgotaW50ZWxfY29udGV4dF9jcmVhdGUo
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCitpbnRlbF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCkBAIC00MCw3ICszOSw3
IEBAIGludGVsX2NvbnRleHRfY3JlYXRlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJ
aWYgKCFjZSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKLQlpbnRlbF9jb250ZXh0X2lu
aXQoY2UsIGN0eCwgZW5naW5lKTsKKwlpbnRlbF9jb250ZXh0X2luaXQoY2UsIGVuZ2luZSk7CiAJ
cmV0dXJuIGNlOwogfQogCkBAIC03Miw4ICs3MSw2IEBAIGludCBfX2ludGVsX2NvbnRleHRfZG9f
cGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAkJCSAgY2UtPmVuZ2luZS0+bmFtZSwgY2Ut
PnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0LAogCQkJICBjZS0+cmluZy0+aGVhZCwgY2UtPnJpbmct
PnRhaWwpOwogCi0JCWk5MTVfZ2VtX2NvbnRleHRfZ2V0KGNlLT5nZW1fY29udGV4dCk7IC8qIGZv
ciBjdHgtPnBwZ3R0ICovCi0KIAkJc21wX21iX19iZWZvcmVfYXRvbWljKCk7IC8qIGZsdXNoIHBp
biBiZWZvcmUgaXQgaXMgdmlzaWJsZSAqLwogCX0KIApAQCAtMTAzLDcgKzEwMCw2IEBAIHZvaWQg
aW50ZWxfY29udGV4dF91bnBpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIAkJY2UtPm9w
cy0+dW5waW4oY2UpOwogCi0JCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGNlLT5nZW1fY29udGV4dCk7
CiAJCWludGVsX2NvbnRleHRfYWN0aXZlX3JlbGVhc2UoY2UpOwogCX0KIApAQCAtMTk4LDcgKzE5
NCw3IEBAIGludCBpbnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSkKIAkJcmV0dXJuIGVycjsKIAogCS8qIFByZWFsbG9jYXRlIHRyYWNraW5nIG5vZGVz
ICovCi0JaWYgKCFpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjZS0+Z2VtX2NvbnRleHQpKSB7
CisJaWYgKGNlLT5nZW1fY29udGV4dCkgewogCQllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlX3By
ZWFsbG9jYXRlX2JhcnJpZXIoJmNlLT5hY3RpdmUsCiAJCQkJCQkJICAgICAgY2UtPmVuZ2luZSk7
CiAJCWlmIChlcnIpIHsKQEAgLTIxOSwzMyArMjE1LDE5IEBAIHZvaWQgaW50ZWxfY29udGV4dF9h
Y3RpdmVfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIHZvaWQKIGludGVsX2Nv
bnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCi0JCSAgIHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgsCiAJCSAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsK
LQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKLQogCUdFTV9CVUdfT04oIWVuZ2luZS0+
Y29wcyk7CisJR0VNX0JVR19PTighZW5naW5lLT5ndC0+dm0pOwogCiAJa3JlZl9pbml0KCZjZS0+
cmVmKTsKIAotCWNlLT5nZW1fY29udGV4dCA9IGN0eDsKLQlyY3VfcmVhZF9sb2NrKCk7Ci0Jdm0g
PSByY3VfZGVyZWZlcmVuY2UoY3R4LT52bSk7Ci0JaWYgKHZtKQotCQljZS0+dm0gPSBpOTE1X3Zt
X2dldCh2bSk7Ci0JZWxzZQotCQljZS0+dm0gPSBpOTE1X3ZtX2dldCgmZW5naW5lLT5ndC0+Z2d0
dC0+dm0pOwotCXJjdV9yZWFkX3VubG9jaygpOwotCWlmIChjdHgtPnRpbWVsaW5lKQotCQljZS0+
dGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7Ci0JaWYgKGN0eC0+
c2NoZWQucHJpb3JpdHkgPj0gSTkxNV9QUklPUklUWV9OT1JNQUwgJiYKLQkgICAgaW50ZWxfZW5n
aW5lX2hhc19zZW1hcGhvcmVzKGVuZ2luZSkpCi0JCV9fc2V0X2JpdChDT05URVhUX1VTRV9TRU1B
UEhPUkVTLCAmY2UtPmZsYWdzKTsKLQogCWNlLT5lbmdpbmUgPSBlbmdpbmU7CiAJY2UtPm9wcyA9
IGVuZ2luZS0+Y29wczsKIAljZS0+c3NldSA9IGVuZ2luZS0+c3NldTsKLQljZS0+cmluZyA9IF9f
aW50ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfMTZLKTsKKwljZS0+cmluZyA9IF9faW50ZWxfY29u
dGV4dF9yaW5nX3NpemUoU1pfNEspOworCisJY2UtPnZtID0gaTkxNV92bV9nZXQoZW5naW5lLT5n
dC0+dm0pOwogCiAJSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGluayk7CiAJSU5JVF9MSVNU
X0hFQUQoJmNlLT5zaWduYWxzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQu
aAppbmRleCBkN2I2NjdhMjZlMDguLjE1YmM0NmUxYjMwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2NvbnRleHQuaApAQCAtMTgsMTMgKzE4LDExIEBACiAjaW5jbHVkZSAiaW50ZWxf
dGltZWxpbmVfdHlwZXMuaCIKIAogdm9pZCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVs
X2NvbnRleHQgKmNlLAotCQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CiB2b2lkIGludGVsX2NvbnRleHRfZmluaShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9j
b250ZXh0X2NyZWF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkgICAgIHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CitpbnRlbF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCiB2b2lkIGludGVsX2NvbnRleHRfZnJlZShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9jcy5jCmluZGV4IGVmZGUzZjhlMDU1OS4uYjM4ZWE0NGFiNzYxIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtNzU2LDEyICs3NTYsMTAgQEAgY3Jl
YXRlX2tlcm5lbF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVycjsKIAotCWNlID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoZW5naW5lLT5pOTE1LT5rZXJuZWxfY29udGV4dCwgZW5naW5lKTsKKwljZSA9IGludGVs
X2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihjZSkpCiAJCXJldHVybiBjZTsK
IAotCWNlLT5yaW5nID0gX19pbnRlbF9jb250ZXh0X3Jpbmdfc2l6ZShTWl80Syk7Ci0KIAllcnIg
PSBpbnRlbF9jb250ZXh0X3BpbihjZSk7CiAJaWYgKGVycikgewogCQlpbnRlbF9jb250ZXh0X3B1
dChjZSk7CkBAIC03OTcsNiArNzk1LDEyIEBAIGludCBpbnRlbF9lbmdpbmVfaW5pdF9jb21tb24o
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJZW5naW5lLT5zZXRfZGVmYXVsdF9z
dWJtaXNzaW9uKGVuZ2luZSk7CiAKKwlyZXQgPSBtZWFzdXJlX2JyZWFkY3J1bWJfZHcoZW5naW5l
KTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCWVuZ2luZS0+ZW1pdF9maW5pX2Jy
ZWFkY3J1bWJfZHcgPSByZXQ7CisKIAkvKgogCSAqIFdlIG1heSBuZWVkIHRvIGRvIHRoaW5ncyB3
aXRoIHRoZSBzaHJpbmtlciB3aGljaAogCSAqIHJlcXVpcmUgdXMgdG8gaW1tZWRpYXRlbHkgc3dp
dGNoIGJhY2sgdG8gdGhlIGRlZmF1bHQKQEAgLTgxMSwxOCArODE1LDcgQEAgaW50IGludGVsX2Vu
Z2luZV9pbml0X2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAllbmdp
bmUtPmtlcm5lbF9jb250ZXh0ID0gY2U7CiAKLQlyZXQgPSBtZWFzdXJlX2JyZWFkY3J1bWJfZHco
ZW5naW5lKTsKLQlpZiAocmV0IDwgMCkKLQkJZ290byBlcnJfdW5waW47Ci0KLQllbmdpbmUtPmVt
aXRfZmluaV9icmVhZGNydW1iX2R3ID0gcmV0OwotCiAJcmV0dXJuIDA7Ci0KLWVycl91bnBpbjoK
LQlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKLQlpbnRlbF9jb250ZXh0X3B1dChjZSk7Ci0JcmV0
dXJuIHJldDsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9ndC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBjMzli
MjFjOGQzMjguLjAyNDg0ODYwY2FhOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBA
IC03NCw3ICs3NCw2IEBAIGludCBpbnRlbF9ndF9pbml0X2h3KHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
CiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKIAlpbnQgcmV0Owog
Ci0JQlVHX09OKCFpOTE1LT5rZXJuZWxfY29udGV4dCk7CiAJcmV0ID0gaW50ZWxfZ3RfdGVybWlu
YWxseV93ZWRnZWQoZ3QpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC0zNjUsNiArMzY0
LDE0IEBAIHN0YXRpYyB2b2lkIGludGVsX2d0X2Zpbmlfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0KQogCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZndC0+c2NyYXRjaCwgMCk7CiB9CiAK
K3N0YXRpYyBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICprZXJuZWxfdm0oc3RydWN0IGludGVs
X2d0ICpndCkKK3sKKwlpZiAoSU5URUxfUFBHVFQoZ3QtPmk5MTUpID4gSU5URUxfUFBHVFRfQUxJ
QVNJTkcpCisJCXJldHVybiAmaTkxNV9wcGd0dF9jcmVhdGUoZ3QtPmk5MTUpLT52bTsKKwllbHNl
CisJCXJldHVybiBpOTE1X3ZtX2dldCgmZ3QtPmdndHQtPnZtKTsKK30KKwogaW50IGludGVsX2d0
X2luaXQoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlpbnQgZXJyOwpAQCAtMzc1LDcgKzM4Miwx
NyBAQCBpbnQgaW50ZWxfZ3RfaW5pdChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCiAJaW50ZWxfZ3Rf
cG1faW5pdChndCk7CiAKKwlndC0+dm0gPSBrZXJuZWxfdm0oZ3QpOworCWlmICghZ3QtPnZtKSB7
CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3NjcmF0Y2g7CisJfQorCiAJcmV0dXJuIDA7
CisKK2Vycl9zY3JhdGNoOgorCWludGVsX2d0X2Zpbmlfc2NyYXRjaChndCk7CisJcmV0dXJuIGVy
cjsKIH0KIAogdm9pZCBpbnRlbF9ndF9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
CkBAIC0zOTAsNiArNDA3LDEzIEBAIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3VucmVnaXN0ZXIoc3Ry
dWN0IGludGVsX2d0ICpndCkKIAogdm9pZCBpbnRlbF9ndF9kcml2ZXJfcmVsZWFzZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQogeworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCisJdm0g
PSBmZXRjaF9hbmRfemVybygmZ3QtPnZtKTsKKwlpZiAoIXZtKSAvKiBGSVhNRSBiZWluZyBjYWxs
ZWQgdHdpY2Ugb24gZXJyb3IgcGF0aHMgOiggKi8KKwkJcmV0dXJuOworCisJaTkxNV92bV9wdXQo
dm0pOwogCWludGVsX2d0X3BtX2ZpbmkoZ3QpOwogCWludGVsX2d0X2Zpbmlfc2NyYXRjaChndCk7
CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAppbmRleCBkNGUxNGRi
ZDE3MmUuLjk2ODkwZGQxMmI1ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90
eXBlcy5oCkBAIC05MCw2ICs5MCwxMyBAQCBzdHJ1Y3QgaW50ZWxfZ3QgewogCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZVtJOTE1X05VTV9FTkdJTkVTXTsKIAlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmVfY2xhc3NbTUFYX0VOR0lORV9DTEFTUyArIDFdCiAJCQkJCSAgICBbTUFY
X0VOR0lORV9JTlNUQU5DRSArIDFdOworCisJLyoKKwkgKiBEZWZhdWx0IGFkZHJlc3Mgc3BhY2Ug
KGVpdGhlciBHR1RUIG9yIHBwR1RUIGRlcGVuZGluZyBvbiBhcmNoKS4KKwkgKgorCSAqIFJlc2Vy
dmVkIGZvciBleGNsdXNpdmUgdXNlIGJ5IHRoZSBrZXJuZWwuCisJICovCisJc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm07CiB9OwogCiBlbnVtIGludGVsX2d0X3NjcmF0Y2hfZmllbGQgewpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCBmODljMDU2Mjc5YTIuLmQyNTVlOTA3
Zjg2YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTEzMywxMiArMTMzLDEx
IEBACiAgKi8KICNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KIAotI2luY2x1ZGUgImdlbS9p
OTE1X2dlbV9jb250ZXh0LmgiCi0KICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5
MTVfcGVyZi5oIgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKICNpbmNsdWRlICJpOTE1X3ZncHUu
aCIKKyNpbmNsdWRlICJpbnRlbF9jb250ZXh0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZW5naW5lX3Bt
LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJpbnRlbF9ndF9wbS5oIgpAQCAt
NDQzMiw4ICs0NDMxLDcgQEAgdmlydHVhbF9ib25kX2V4ZWN1dGUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEsIHN0cnVjdCBkbWFfZmVuY2UgKnNpZ25hbCkKIH0KIAogc3RydWN0IGludGVsX2NvbnRl
eHQgKgotaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHgsCi0JCQkgICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAor
aW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipz
aWJsaW5ncywKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgY291bnQpCiB7CiAJc3RydWN0IHZpcnR1
YWxfZW5naW5lICp2ZTsKQEAgLTQ0NDQsMTMgKzQ0NDIsMTMgQEAgaW50ZWxfZXhlY2xpc3RzX2Ny
ZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCXJldHVybiBFUlJf
UFRSKC1FSU5WQUwpOwogCiAJaWYgKGNvdW50ID09IDEpCi0JCXJldHVybiBpbnRlbF9jb250ZXh0
X2NyZWF0ZShjdHgsIHNpYmxpbmdzWzBdKTsKKwkJcmV0dXJuIGludGVsX2NvbnRleHRfY3JlYXRl
KHNpYmxpbmdzWzBdKTsKIAogCXZlID0ga3phbGxvYyhzdHJ1Y3Rfc2l6ZSh2ZSwgc2libGluZ3Ms
IGNvdW50KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCF2ZSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01F
TSk7CiAKLQl2ZS0+YmFzZS5pOTE1ID0gY3R4LT5pOTE1OworCXZlLT5iYXNlLmk5MTUgPSBzaWJs
aW5nc1swXS0+aTkxNTsKIAl2ZS0+YmFzZS5ndCA9IHNpYmxpbmdzWzBdLT5ndDsKIAl2ZS0+YmFz
ZS51bmNvcmUgPSBzaWJsaW5nc1swXS0+dW5jb3JlOwogCXZlLT5iYXNlLmlkID0gLTE7CkBAIC00
NDkzLDcgKzQ0OTEsNyBAQCBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJICAgICB2aXJ0dWFsX3N1Ym1pc3Npb25fdGFza2xldCwK
IAkJICAgICAodW5zaWduZWQgbG9uZyl2ZSk7CiAKLQlpbnRlbF9jb250ZXh0X2luaXQoJnZlLT5j
b250ZXh0LCBjdHgsICZ2ZS0+YmFzZSk7CisJaW50ZWxfY29udGV4dF9pbml0KCZ2ZS0+Y29udGV4
dCwgJnZlLT5iYXNlKTsKIAogCWZvciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CiAJCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKnNpYmxpbmcgPSBzaWJsaW5nc1tuXTsKQEAgLTQ1NzQsMTQgKzQ1
NzIsMTIgQEAgaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsCiB9CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2V4ZWNsaXN0
c19jbG9uZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkgICAgICBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpCitpbnRlbF9leGVjbGlzdHNfY2xvbmVfdmlydHVh
bChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpCiB7CiAJc3RydWN0IHZpcnR1YWxfZW5naW5l
ICpzZSA9IHRvX3ZpcnR1YWxfZW5naW5lKHNyYyk7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmRz
dDsKIAotCWRzdCA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHgsCi0JCQkJCSAg
ICAgc2UtPnNpYmxpbmdzLAorCWRzdCA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChz
ZS0+c2libGluZ3MsCiAJCQkJCSAgICAgc2UtPm51bV9zaWJsaW5ncyk7CiAJaWYgKElTX0VSUihk
c3QpKQogCQlyZXR1cm4gZHN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuaAppbmRleCAw
NDUxMWQ4ZWJkYzEuLjA4MTUyMWYxN2M3NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJj
LmgKQEAgLTExMSwxMyArMTExLDExIEBAIHZvaWQgaW50ZWxfZXhlY2xpc3RzX3Nob3dfcmVxdWVz
dHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJCSAgIHVuc2lnbmVkIGludCBt
YXgpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9leGVjbGlzdHNfY3JlYXRlX3Zp
cnR1YWwoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJCSAgICAgICBzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCitpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAogCQkJICAgICAgIHVuc2lnbmVkIGlu
dCBjb3VudCk7CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2V4ZWNsaXN0c19jbG9u
ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkgICAgICBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICpzcmMpOworaW50ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1YWwoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKTsKIAogaW50IGludGVsX3ZpcnR1YWxfZW5naW5lX2F0
dGFjaF9ib25kKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKm1hc3RlciwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yZXNldC5jCmluZGV4IGI0YzBhZDRhNjA4MS4uOThlN2JiYTU5NzllIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTg2LDYgKzg2LDkgQEAgc3RhdGljIGJvb2wgbWFy
a19ndWlsdHkoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJYm9vbCBiYW5uZWQ7CiAJaW50IGk7
CiAKKwlpZiAoIWN0eCkKKwkJcmV0dXJuIGZhbHNlOworCiAJYXRvbWljX2luYygmY3R4LT5ndWls
dHlfY291bnQpOwogCiAJLyogQ29vbCBjb250ZXh0cyBhcmUgdG9vIGNvb2wgdG8gYmUgYmFubmVk
ISAoVXNlZCBmb3IgcmVzZXQgdGVzdGluZy4pICovCkBAIC0xMTUsNyArMTE4LDggQEAgc3RhdGlj
IGJvb2wgbWFya19ndWlsdHkoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAKIHN0YXRpYyB2b2lk
IG1hcmtfaW5ub2NlbnQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JYXRvbWljX2luYygm
cnEtPmNvbnRleHQtPmdlbV9jb250ZXh0LT5hY3RpdmVfY291bnQpOworCWlmIChycS0+Y29udGV4
dC0+Z2VtX2NvbnRleHQpCisJCWF0b21pY19pbmMoJnJxLT5jb250ZXh0LT5nZW1fY29udGV4dC0+
YWN0aXZlX2NvdW50KTsKIH0KIAogdm9pZCBfX2k5MTVfcmVxdWVzdF9yZXNldChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwgYm9vbCBndWlsdHkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jCmluZGV4IDFjMmYzYzNhODg0MC4uNmRkZmU4YTg2ZGJl
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Np
b24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24u
YwpAQCAtMTU1OCw3ICsxNTU4LDcgQEAgc3RhdGljIGludCByZW1hcF9sMyhzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gcnEtPmNvbnRleHQt
PmdlbV9jb250ZXh0OwogCWludCBpLCBlcnI7CiAKLQlpZiAoIWN0eC0+cmVtYXBfc2xpY2UpCisJ
aWYgKCFjdHggfHwgIWN0eC0+cmVtYXBfc2xpY2UpCiAJCXJldHVybiAwOwogCiAJZm9yIChpID0g
MDsgaSA8IE1BWF9MM19TTElDRVM7IGkrKykgewpAQCAtMTYwMSw3ICsxNjAxLDcgQEAgc3RhdGlj
IGludCBzd2l0Y2hfY29udGV4dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJICogaXMgcHVy
ZWx5IHVzZWQgZm9yIGZsdXNoaW5nIHVzZXIgY29udGV4dHMuCiAJCSAqLwogCQlod19mbGFncyA9
IDA7Ci0JCWlmIChpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChycS0+Y29udGV4dC0+Z2VtX2Nv
bnRleHQpKQorCQlpZiAoIXJxLT5jb250ZXh0LT5nZW1fY29udGV4dCkKIAkJCWh3X2ZsYWdzID0g
TUlfUkVTVE9SRV9JTkhJQklUOwogCiAJCXJldCA9IG1pX3NldF9jb250ZXh0KHJxLCBod19mbGFn
cyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggYmM3
MjBkZWZjNmI4Li44MzA4YmU4ZGJhZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9jb250ZXh0LmMKQEAgLTY3LDE1ICs2NywxNCBAQCBzdGF0aWMgaW50IGNvbnRleHRfc3lu
YyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGlu
dCBfX2xpdmVfY29udGV4dF9zaXplKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJ
CSAgICAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWUpCitzdGF0aWMgaW50IF9fbGl2
ZV9jb250ZXh0X3NpemUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAl2b2lkICp2
YWRkcjsKIAlpbnQgZXJyOwogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5n
aW5lKTsKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihj
ZSkpCiAJCXJldHVybiBQVFJfRVJSKGNlKTsKIApAQCAtMTQzLDcgKzE0Miw2IEBAIHN0YXRpYyBp
bnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpmaXhtZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQgZXJyID0g
MDsKIApAQCAtMTUyLDEwICsxNTAsNiBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZv
aWQgKmFyZykKIAkgKiBIVyB0cmllcyB0byB3cml0ZSBwYXN0IHRoZSBlbmQgb2Ygb25lLgogCSAq
LwogCi0JZml4bWUgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaXht
ZSkpCi0JCXJldHVybiBQVFJfRVJSKGZpeG1lKTsKLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGd0LCBpZCkgewogCQlzdHJ1Y3QgewogCQkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKnN0
YXRlOwpAQCAtMTgwLDcgKzE3NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9p
ZCAqYXJnKQogCQkvKiBPdmVybGFwcyB3aXRoIHRoZSBleGVjbGlzdHMgcmVkem9uZSAqLwogCQll
bmdpbmUtPmNvbnRleHRfc2l6ZSArPSBJOTE1X0dUVF9QQUdFX1NJWkU7CiAKLQkJZXJyID0gX19s
aXZlX2NvbnRleHRfc2l6ZShlbmdpbmUsIGZpeG1lKTsKKwkJZXJyID0gX19saXZlX2NvbnRleHRf
c2l6ZShlbmdpbmUpOwogCiAJCWVuZ2luZS0+Y29udGV4dF9zaXplIC09IEk5MTVfR1RUX1BBR0Vf
U0laRTsKIApAQCAtMTkzLDEyICsxODcsMTAgQEAgc3RhdGljIGludCBsaXZlX2NvbnRleHRfc2l6
ZSh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLQlrZXJuZWxfY29udGV4dF9jbG9zZShmaXht
ZSk7CiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBfX2xpdmVfYWN0aXZlX2NvbnRleHQo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJCSBzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqZml4bWUpCitzdGF0aWMgaW50IF9fbGl2ZV9hY3RpdmVfY29udGV4dChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCWlu
dCBwYXNzOwpAQCAtMjIzLDEwICsyMTUsMTUgQEAgc3RhdGljIGludCBfX2xpdmVfYWN0aXZlX2Nv
bnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQlyZXR1cm4gLUVJTlZBTDsK
IAl9CiAKLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdpbmUpOworCWNlID0g
aW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0dXJu
IFBUUl9FUlIoY2UpOwogCisJLyogUHJldGVuZCB0byBiZSBhIHVzZXIgY29udGV4dCB0byBwYXJ0
YWtlIGluIGlkbGUgYmFycmllcnMgKi8KKwljZS0+Z2VtX2NvbnRleHQgPSBrZXJuZWxfY29udGV4
dChlbmdpbmUtPmk5MTUpOworCWlmIChJU19FUlIoY2UtPmdlbV9jb250ZXh0KSkKKwkJZ290byBl
cnJfY2U7CisKIAlmb3IgKHBhc3MgPSAwOyBwYXNzIDw9IDI7IHBhc3MrKykgewogCQlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycTsKIApAQCAtMjc5LDYgKzI3Niw4IEBAIHN0YXRpYyBpbnQgX19saXZl
X2FjdGl2ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAl9CiAKIGVy
cjoKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjZS0+Z2VtX2NvbnRleHQpOworZXJyX2NlOgogCWlu
dGVsX2NvbnRleHRfcHV0KGNlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMjg3LDcgKzI4Niw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGlu
dGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwog
CXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlpbnQgZXJyID0gMDsKQEAgLTI5NiwxNCArMjk0LDgg
QEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJS
KGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCWZpeG1lID0gbGl2ZV9jb250ZXh0
KGd0LT5pOTE1LCBmaWxlKTsKLQlpZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIgPSBQVFJfRVJS
KGZpeG1lKTsKLQkJZ290byBvdXRfZmlsZTsKLQl9Ci0KIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBndCwgaWQpIHsKLQkJZXJyID0gX19saXZlX2FjdGl2ZV9jb250ZXh0KGVuZ2luZSwgZml4bWUp
OworCQllcnIgPSBfX2xpdmVfYWN0aXZlX2NvbnRleHQoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJ
CWJyZWFrOwogCkBAIC0zMTIsNyArMzA0LDYgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9jb250
ZXh0KHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCX0KIAotb3V0X2ZpbGU6CiAJbW9ja19maWxlX2Zy
ZWUoZ3QtPmk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CkBAIC0zNDUsOCArMzM2LDcgQEAg
c3RhdGljIGludCBfX3JlbW90ZV9zeW5jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0
IGludGVsX2NvbnRleHQgKnJlbW90ZSkKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IF9f
bGl2ZV9yZW1vdGVfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCQkJ
IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZSkKK3N0YXRpYyBpbnQgX19saXZlX3JlbW90
ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqbG9jYWwsICpyZW1vdGU7CiAJaW50IHBhc3M7CkBAIC0zNjAsMTEgKzM1MCwx
NiBAQCBzdGF0aWMgaW50IF9fbGl2ZV9yZW1vdGVfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUsCiAJICogY2xvYmJlciB0aGUgaWRsZS1iYXJyaWVyLgogCSAqLwogCi0JcmVt
b3RlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJcmVtb3RlID0gaW50
ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJlbW90ZSkpCiAJCXJldHVy
biBQVFJfRVJSKHJlbW90ZSk7CiAKLQlsb2NhbCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1l
LCBlbmdpbmUpOworCS8qIFByZXRlbmQgdG8gYmUgYSB1c2VyIGNvbnRleHQgdG8gcGFydGFrZSBp
biBpZGxlIGJhcnJpZXJzICovCisJcmVtb3RlLT5nZW1fY29udGV4dCA9IGtlcm5lbF9jb250ZXh0
KGVuZ2luZS0+aTkxNSk7CisJaWYgKElTX0VSUihyZW1vdGUtPmdlbV9jb250ZXh0KSkKKwkJZ290
byBlcnJfcmVtb3RlX2NlOworCisJbG9jYWwgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUp
OwogCWlmIChJU19FUlIobG9jYWwpKSB7CiAJCWVyciA9IFBUUl9FUlIobG9jYWwpOwogCQlnb3Rv
IGVycl9yZW1vdGU7CkBAIC0zODksNiArMzg0LDggQEAgc3RhdGljIGludCBfX2xpdmVfcmVtb3Rl
X2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCiAJaW50ZWxfY29udGV4
dF9wdXQobG9jYWwpOwogZXJyX3JlbW90ZToKKwlrZXJuZWxfY29udGV4dF9jbG9zZShyZW1vdGUt
PmdlbV9jb250ZXh0KTsKK2Vycl9yZW1vdGVfY2U6CiAJaW50ZWxfY29udGV4dF9wdXQocmVtb3Rl
KTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMzk3LDcgKzM5NCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9y
ZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsK
IAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmZpeG1lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCXN0cnVjdCBkcm1fZmlsZSAq
ZmlsZTsKIAlpbnQgZXJyID0gMDsKQEAgLTQwNiwxNCArNDAyLDggQEAgc3RhdGljIGludCBsaXZl
X3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4g
UFRSX0VSUihmaWxlKTsKIAotCWZpeG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsK
LQlpZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byBv
dXRfZmlsZTsKLQl9Ci0KIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKLQkJZXJy
ID0gX19saXZlX3JlbW90ZV9jb250ZXh0KGVuZ2luZSwgZml4bWUpOworCQllcnIgPSBfX2xpdmVf
cmVtb3RlX2NvbnRleHQoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCkBAIC00MjIs
NyArNDEyLDYgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJ
CWJyZWFrOwogCX0KIAotb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUp
OwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMKaW5kZXggZjY2NWEwZTIzYzYxLi4yZmVlYWQ5YjQ0N2Eg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFy
dGJlYXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVh
cnRiZWF0LmMKQEAgLTE3Myw4ICsxNzMsNyBAQCBzdGF0aWMgaW50IF9fbGl2ZV9oZWFydGJlYXRf
ZmFzdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50IGVycjsKIAlpbnQgaTsK
IAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2Vt
X2NvbnRleHQsCi0JCQkJICBlbmdpbmUpOworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5n
aW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IDg1ZTljY2Y1YzMw
NC4uNzhlNzMyNDI1ZTY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9o
YW5nY2hlY2suYwpAQCAtMzc3LDM2ICszNzcsMzAgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9w
KHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dw
dV9lcnJvciAqZ2xvYmFsID0gJmd0LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJdW5zaWdu
ZWQgaW50IHJlc2V0X2NvdW50LCBjb3VudDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7CiAJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwogCWludCBlcnIg
PSAwOwogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVzZXQgZHVyaW5nIG5vbi11c2VyIHBvcnRp
b25zIG9mIHJlcXVlc3RzICovCiAKLQlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsKLQlpZiAo
SVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKLQotCWN0eCA9IGxpdmVfY29u
dGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCWVyciA9IFBUUl9F
UlIoY3R4KTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9nZW1fY29udGV4dF9jbGVhcl9iYW5u
YWJsZShjdHgpOwogCXJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudChnbG9iYWwpOwogCWNv
dW50ID0gMDsKIAlkbyB7CiAJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQkJ
c3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQkJaW50IGk7CiAKKwkJCWNlID0gaW50ZWxfY29u
dGV4dF9jcmVhdGUoZW5naW5lKTsKKwkJCWlmIChJU19FUlIoY2UpKSB7CisJCQkJZXJyID0gUFRS
X0VSUihjZSk7CisJCQkJYnJlYWs7CisJCQl9CisKIAkJCWZvciAoaSA9IDA7IGkgPCAxNjsgaSsr
KSB7CiAJCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKLQkJCQlycSA9IGlndF9yZXF1ZXN0
X2FsbG9jKGN0eCwgZW5naW5lKTsKKwkJCQlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVl
c3QoY2UpOwogCQkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwog
CQkJCQlicmVhazsKQEAgLTQxNCw2ICs0MDgsOCBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3Ao
dm9pZCAqYXJnKQogCiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCQl9CisKKwkJCWludGVs
X2NvbnRleHRfcHV0KGNlKTsKIAkJfQogCiAJCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CkBA
IC00MzcsMTAgKzQzMyw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJ
fSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3RpbWUpKTsKIAlwcl9pbmZvKCIlczog
JWQgcmVzZXRzXG4iLCBfX2Z1bmNfXywgY291bnQpOwogCi0JZXJyID0gaWd0X2ZsdXNoX3Rlc3Qo
Z3QtPmk5MTUpOwotb3V0OgotCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKLQlpZiAo
aW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQog
CQllcnIgPSAtRUlPOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2xyYy5jCmluZGV4IDdkNTcxM2VhNmJkZS4uZWM5ZGZiY2YwMjIyIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtNTMsMTEgKzUzLDEwIEBAIHN0YXRpYyBzdHJ1
Y3QgaTkxNV92bWEgKmNyZWF0ZV9zY3JhdGNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiBzdGF0aWMg
aW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBhcmc7Ci0Jc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKLQlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4OwotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKKwlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJc3RydWN0
IGlndF9zcGlubmVyIHNwaW47Ci0JaW50IGVyciA9IC1FTk9NRU07CisJaW50IGVyciA9IDA7CiAK
IAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMoZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsK
QEAgLTY1LDE3ICs2NCwyMCBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJn
KQogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluLCBndCkpCiAJCXJldHVybiAtRU5PTUVNOwog
Ci0JY3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmICghY3R4KQotCQlnb3RvIGVy
cl9zcGluOwotCi0JZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2Nr
X2VuZ2luZXMoY3R4KSwgaXQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsK
KwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsK
IAorCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CisJCWlmIChJU19FUlIoY2Up
KSB7CisJCQllcnIgPSBQVFJfRVJSKGNlKTsKKwkJCWJyZWFrOworCQl9CisKIAkJcnEgPSBpZ3Rf
c3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwgY2UsIE1JX05PT1ApOwogCQlpZiAoSVNfRVJS
KHJxKSkgewogCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQlnb3RvIGVycl9jdHg7CisJCQlnb3Rv
IG91dF9jdHg7CiAJCX0KIAogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKQEAgLTg0LDIxICs4Niwy
MSBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogCQkJR0VNX1RSQUNF
X0RVTVAoKTsKIAkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJZXJyID0gLUVJTzsKLQkJ
CWdvdG8gZXJyX2N0eDsKKwkJCWdvdG8gb3V0X2N0eDsKIAkJfQogCiAJCWlndF9zcGlubmVyX2Vu
ZCgmc3Bpbik7CiAJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpIHsKIAkJCWVyciA9IC1F
SU87Ci0JCQlnb3RvIGVycl9jdHg7CisJCQlnb3RvIG91dF9jdHg7CiAJCX0KKworb3V0X2N0eDoK
KwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CiAJfQogCi0J
ZXJyID0gMDsKLWVycl9jdHg6Ci0JaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgp
OwotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci1lcnJfc3BpbjoKIAlpZ3Rfc3Bpbm5lcl9m
aW5pKCZzcGluKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTQ0LDcgKzE0Niw3IEBAIHN0YXRpYyBp
bnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKIAkJ
Zm9yIChuID0gMDsgbiA8IEFSUkFZX1NJWkUoY2UpOyBuKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9j
b250ZXh0ICp0bXA7CiAKLQkJCXRtcCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5l
KTsKKwkJCXRtcCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCQlpZiAoSVNfRVJS
KHRtcCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHRtcCk7CiAJCQkJZ290byBlcnJfY2U7CkBAIC0z
MDksMTcgKzMxMSwxNyBAQCBlbWl0X3NlbWFwaG9yZV9jaGFpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSwgc3RydWN0IGk5MTVfdm1hICp2bWEsIGludCBpZHgpCiBzdGF0aWMgc3RydWN0IGk5MTVf
cmVxdWVzdCAqCiBzZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
LCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlkeCkKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKIAlpbnQgZXJyOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZW5naW5lLT5pOTE1
KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJY2UgPSBpbnRlbF9j
b250ZXh0X2NyZWF0ZShlbmdpbmUpOworCWlmIChJU19FUlIoY2UpKQorCQlyZXR1cm4gRVJSX0NB
U1QoY2UpOwogCi0JcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHgsIGVuZ2luZSk7CisJcnEgPSBp
bnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKIAlpZiAoSVNfRVJSKHJxKSkKLQkJZ290
byBvdXRfY3R4OworCQlnb3RvIG91dF9jZTsKIAogCWVyciA9IDA7CiAJaWYgKHJxLT5lbmdpbmUt
PmVtaXRfaW5pdF9icmVhZGNydW1iKQpAQCAtMzMyLDggKzMzNCw4IEBAIHNlbWFwaG9yZV9xdWV1
ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBp
bnQgaWR4KQogCWlmIChlcnIpCiAJCXJxID0gRVJSX1BUUihlcnIpOwogCi1vdXRfY3R4OgotCWtl
cm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CitvdXRfY2U6CisJaW50ZWxfY29udGV4dF9wdXQoY2Up
OwogCXJldHVybiBycTsKIH0KIApAQCAtMjM5MiwyNyArMjM5NCwxNyBAQCBzdGF0aWMgaW50IG5v
cF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogewogCUlHVF9USU1FT1VUKGVu
ZF90aW1lKTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0WzE2XTsKLQlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4WzE2XTsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmVbMTZdOwog
CXVuc2lnbmVkIGxvbmcgbiwgcHJpbWUsIG5jOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJ
a3RpbWVfdCB0aW1lc1syXSA9IHt9OwogCWludCBlcnI7CiAKLQlHRU1fQlVHX09OKCFuY3R4IHx8
IG5jdHggPiBBUlJBWV9TSVpFKGN0eCkpOworCUdFTV9CVUdfT04oIW5jdHggfHwgbmN0eCA+IEFS
UkFZX1NJWkUodmUpKTsKIAogCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsKLQkJY3R4W25d
ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCQlpZiAoIWN0eFtuXSkgewotCQkJZXJyID0g
LUVOT01FTTsKLQkJCW5jdHggPSBuOwotCQkJZ290byBvdXQ7Ci0JCX0KLQotCQl2ZVtuXSA9IGlu
dGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHhbbl0sCi0JCQkJCQkgICAgICAgc2libGlu
Z3MsIG5zaWJsaW5nKTsKKwkJdmVbbl0gPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwo
c2libGluZ3MsIG5zaWJsaW5nKTsKIAkJaWYgKElTX0VSUih2ZVtuXSkpIHsKLQkJCWtlcm5lbF9j
b250ZXh0X2Nsb3NlKGN0eFtuXSk7CiAJCQllcnIgPSBQVFJfRVJSKHZlW25dKTsKIAkJCW5jdHgg
PSBuOwogCQkJZ290byBvdXQ7CkBAIC0yNDIxLDcgKzI0MTMsNiBAQCBzdGF0aWMgaW50IG5vcF92
aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQllcnIgPSBpbnRlbF9jb250ZXh0
X3Bpbih2ZVtuXSk7CiAJCWlmIChlcnIpIHsKIAkJCWludGVsX2NvbnRleHRfcHV0KHZlW25dKTsK
LQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtuXSk7CiAJCQluY3R4ID0gbjsKIAkJCWdvdG8g
b3V0OwogCQl9CkBAIC0yNTAyLDcgKzI0OTMsNiBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2Vu
Z2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWZvciAobmMgPSAwOyBuYyA8IG5jdHg7IG5jKysp
IHsKIAkJaW50ZWxfY29udGV4dF91bnBpbih2ZVtuY10pOwogCQlpbnRlbF9jb250ZXh0X3B1dCh2
ZVtuY10pOwotCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbmNdKTsKIAl9CiAJcmV0dXJuIGVy
cjsKIH0KQEAgLTI1NjEsNyArMjU1MSw2IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2lu
ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICAgIHVuc2lnbmVkIGludCBuc2libGluZykK
IHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0W01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAx
XTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCXN0cnVjdCBpbnRlbF9jb250ZXh0
ICp2ZTsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCXVuc2lnbmVkIGludCBuOwpAQCAtMjU3
MiwxMSArMjU2MSw3IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50
ZWxfZ3QgKmd0LAogCSAqIHJlc3RyaWN0IGl0IHRvIG91ciBkZXNpcmVkIGVuZ2luZSB3aXRoaW4g
dGhlIHZpcnR1YWwgZW5naW5lLgogCSAqLwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5
MTUpOwotCWlmICghY3R4KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXZlID0gaW50ZWxfZXhlY2xp
c3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwl2ZSA9IGludGVs
X2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbnNpYmxpbmcpOwogCWlmIChJU19F
UlIodmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUpOwogCQlnb3RvIG91dF9jbG9zZTsKQEAgLTI2
NDQsNyArMjYyOSw2IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50
ZWxfZ3QgKmd0LAogb3V0X3B1dDoKIAlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CiBvdXRfY2xvc2U6
Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0yNjg0
LDcgKzI2NjgsNiBAQCBzdGF0aWMgaW50IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcpCiB7CiAJc3RydWN0
IGk5MTVfcmVxdWVzdCAqbGFzdCA9IE5VTEw7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7CiAJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNo
OwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CkBAIC0yNjkyLDE3ICsyNjc1LDExIEBAIHN0YXRp
YyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJaW50
IGVyciA9IDA7CiAJdTMyICpjczsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsK
LQlpZiAoIWN0eCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KIAlzY3JhdGNoID0gY3JlYXRlX3NjcmF0
Y2goc2libGluZ3NbMF0tPmd0KTsKLQlpZiAoSVNfRVJSKHNjcmF0Y2gpKSB7Ci0JCWVyciA9IFBU
Ul9FUlIoc2NyYXRjaCk7Ci0JCWdvdG8gb3V0X2Nsb3NlOwotCX0KKwlpZiAoSVNfRVJSKHNjcmF0
Y2gpKQorCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIAotCXZlID0gaW50ZWxfZXhlY2xpc3Rz
X2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwl2ZSA9IGludGVsX2V4
ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbnNpYmxpbmcpOwogCWlmIChJU19FUlIo
dmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUpOwogCQlnb3RvIG91dF9zY3JhdGNoOwpAQCAtMjc4
NSw4ICsyNzYyLDYgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0
IGludGVsX2d0ICpndCwKIAlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CiBvdXRfc2NyYXRjaDoKIAlp
OTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2Vy
bmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0yODgwLDkgKzI4
NTUsNyBAQCBzdGF0aWMgaW50IGJvbmRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpn
dCwKIAkJZm9yIChuID0gMDsgbiA8IG5zaWJsaW5nOyBuKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9j
b250ZXh0ICp2ZTsKIAotCQkJdmUgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoY3R4
LAotCQkJCQkJCSAgICBzaWJsaW5ncywKLQkJCQkJCQkgICAgbnNpYmxpbmcpOworCQkJdmUgPSBp
bnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc2libGluZ3MsIG5zaWJsaW5nKTsKIAkJCWlm
IChJU19FUlIodmUpKSB7CiAJCQkJZXJyID0gUFRSX0VSUih2ZSk7CiAJCQkJb25zdGFja19mZW5j
ZV9maW5pKCZmZW5jZSk7CkBAIC0zMjcwLDggKzMyNDMsNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJj
X2ZpeGVkKHZvaWQgKmFyZykKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IF9fbGl2ZV9s
cmNfc3RhdGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAotCQkJICAgIHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKK3N0YXRpYyBpbnQgX19saXZlX2xyY19zdGF0ZShzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgICAgc3RydWN0IGk5MTVfdm1hICpzY3Jh
dGNoKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKQEAgLTMyODYsNyArMzI1OCw3IEBA
IHN0YXRpYyBpbnQgX19saXZlX2xyY19zdGF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4
bWUsCiAJaW50IGVycjsKIAlpbnQgbjsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4
bWUsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJ
U19FUlIoY2UpKQogCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAKQEAgLTMzNjAsNyArMzMzMiw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CiAJZW51
bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9IDA7CkBAIC0zMzcwLDE4ICszMzQxLDEy
IEBAIHN0YXRpYyBpbnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQogCSAqIGludGVsX2NvbnRl
eHQuCiAJICovCiAKLQlmaXhtZSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlpZiAoIWZp
eG1lKQotCQlyZXR1cm4gLUVOT01FTTsKLQogCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRjaChndCk7
Ci0JaWYgKElTX0VSUihzY3JhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gpOwotCQln
b3RvIG91dF9jbG9zZTsKLQl9CisJaWYgKElTX0VSUihzY3JhdGNoKSkKKwkJcmV0dXJuIFBUUl9F
UlIoc2NyYXRjaCk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKLQkJZXJy
ID0gX19saXZlX2xyY19zdGF0ZShmaXhtZSwgZW5naW5lLCBzY3JhdGNoKTsKKwkJZXJyID0gX19s
aXZlX2xyY19zdGF0ZShlbmdpbmUsIHNjcmF0Y2gpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJ
fQpAQCAtMzM5MCw4ICszMzU1LDYgQEAgc3RhdGljIGludCBsaXZlX2xyY19zdGF0ZSh2b2lkICph
cmcpCiAJCWVyciA9IC1FSU87CiAKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRj
aCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwogCXJldHVy
biBlcnI7CiB9CiAKQEAgLTM0MjQsOCArMzM4Nyw3IEBAIHN0YXRpYyBpbnQgZ3ByX21ha2VfZGly
dHkoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXJldHVybiAwOwogfQogCi1zdGF0
aWMgaW50IF9fbGl2ZV9ncHJfY2xlYXIoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAot
CQkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKK3N0YXRpYyBpbnQgX19saXZl
X2dwcl9jbGVhcihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgICAgc3RydWN0
IGk5MTVfdm1hICpzY3JhdGNoKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKQEAgLTM0
NDEsNyArMzQwMyw3IEBAIHN0YXRpYyBpbnQgX19saXZlX2dwcl9jbGVhcihzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqZml4bWUsCiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCWNlID0gaW50
ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2Ny
ZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAK
QEAgLTM1MDMsNyArMzQ2NSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9ncHJfY2xlYXIodm9pZCAqYXJn
KQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAlzdHJ1Y3QgaTkx
NV92bWEgKnNjcmF0Y2g7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9IDA7
CkBAIC0zNTEzLDE4ICszNDc0LDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV9ncHJfY2xlYXIodm9pZCAq
YXJnKQogCSAqIHRvIGF2b2lkIGxlYWtpbmcgYW55IGluZm9ybWF0aW9uIGZyb20gcHJldmlvdXMg
Y29udGV4dHMuCiAJICovCiAKLQlmaXhtZSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlp
ZiAoIWZpeG1lKQotCQlyZXR1cm4gLUVOT01FTTsKLQogCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRj
aChndCk7Ci0JaWYgKElTX0VSUihzY3JhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gp
OwotCQlnb3RvIG91dF9jbG9zZTsKLQl9CisJaWYgKElTX0VSUihzY3JhdGNoKSkKKwkJcmV0dXJu
IFBUUl9FUlIoc2NyYXRjaCk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsK
LQkJZXJyID0gX19saXZlX2dwcl9jbGVhcihmaXhtZSwgZW5naW5lLCBzY3JhdGNoKTsKKwkJZXJy
ID0gX19saXZlX2dwcl9jbGVhcihlbmdpbmUsIHNjcmF0Y2gpOwogCQlpZiAoZXJyKQogCQkJYnJl
YWs7CiAJfQpAQCAtMzUzMyw4ICszNDg4LDYgQEAgc3RhdGljIGludCBsaXZlX2dwcl9jbGVhcih2
b2lkICphcmcpCiAJCWVyciA9IC1FSU87CiAKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgm
c2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwog
CXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9z
Y2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwppbmRleCAy
MjhjNjY1MzRlMjEuLmIzMjk5Zjg4ZTI0ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVs
ZXIuYwpAQCAtMzUsMTIgKzM1LDEyIEBACiAKICNpbmNsdWRlIDxsaW51eC9rdGhyZWFkLmg+CiAK
LSNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImdlbS9pOTE1X2dl
bV9wbS5oIgogI2luY2x1ZGUgImd0L2ludGVsX2NvbnRleHQuaCIKICNpbmNsdWRlICJndC9pbnRl
bF9yaW5nLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX2d0
dC5oIgogI2luY2x1ZGUgImd2dC5oIgogCiAjZGVmaW5lIFJJTkdfQ1RYX09GRih4KSBcCkBAIC0x
MjIwLDE2ICsxMjIwLDE0IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0
IGludGVsX3ZncHUgKnZncHUpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2Z3B1
LT5ndnQtPmRldl9wcml2OwogCXN0cnVjdCBpbnRlbF92Z3B1X3N1Ym1pc3Npb24gKnMgPSAmdmdw
dS0+c3VibWlzc2lvbjsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQ7CiAJZW51
bSBpbnRlbF9lbmdpbmVfaWQgaTsKIAlpbnQgcmV0OwogCi0JY3R4ID0gaTkxNV9nZW1fY29udGV4
dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlfTUFYKTsKLQlpZiAoSVNfRVJSKGN0
eCkpCi0JCXJldHVybiBQVFJfRVJSKGN0eCk7CisJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShp
OTE1KTsKKwlpZiAoSVNfRVJSKHBwZ3R0KSkKKwkJcmV0dXJuIFBUUl9FUlIocHBndHQpOwogCi0J
cHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgp
KTsKIAlpOTE1X2NvbnRleHRfcHBndHRfcm9vdF9zYXZlKHMsIHBwZ3R0KTsKIAogCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGk5MTUsIGkpIHsKQEAgLTEyMzgsMTIgKzEyMzYsMTQgQEAgaW50IGlu
dGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAkJSU5J
VF9MSVNUX0hFQUQoJnMtPndvcmtsb2FkX3FfaGVhZFtpXSk7CiAJCXMtPnNoYWRvd1tpXSA9IEVS
Ul9QVFIoLUVJTlZBTCk7CiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShjdHgsIGVuZ2lu
ZSk7CisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihj
ZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIoY2UpOwogCQkJZ290byBvdXRfc2hhZG93X2N0eDsKIAkJ
fQogCisJCWk5MTVfdm1fcHV0KGNlLT52bSk7CisJCWNlLT52bSA9IGk5MTVfdm1fZ2V0KCZwcGd0
dC0+dm0pOwogCQlpbnRlbF9jb250ZXh0X3NldF9zaW5nbGVfc3VibWlzc2lvbihjZSk7CiAKIAkJ
aWYgKCFVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKSB7IC8qIE1heCByaW5nIGJ1ZmZlciBzaXpl
ICovCkBAIC0xMjc4LDcgKzEyNzgsNiBAQCBpbnQgaW50ZWxfdmdwdV9zZXR1cF9zdWJtaXNzaW9u
KHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCWJpdG1hcF96ZXJvKHMtPnRsYl9oYW5kbGVfcGVu
ZGluZywgSTkxNV9OVU1fRU5HSU5FUyk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKLQlp
OTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwogCXJldHVybiAwOwogCiBvdXRfc2hhZG93X2N0eDoK
QEAgLTEyOTEsNyArMTI5MCw2IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3Ry
dWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWludGVsX2NvbnRleHRfcHV0KHMtPnNoYWRvd1tpXSk7
CiAJfQogCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwotCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGN0
eCk7CiAJcmV0dXJuIHJldDsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggN2UwZjY3
YmFiZTIwLi43ZThhMDM5ZTRmMjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtOTYwLDkg
Kzk2MCw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlIHsKIAogCXN0cnVjdCBwY2lfZGV2ICpi
cmlkZ2VfZGV2OwogCi0JLyogQ29udGV4dCB1c2VkIGludGVybmFsbHkgdG8gaWRsZSB0aGUgR1BV
IGFuZCBzZXR1cCBpbml0aWFsIHN0YXRlICovCi0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmtl
cm5lbF9jb250ZXh0OwotCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lW0k5MTVfTlVN
X0VOR0lORVNdOwogCXN0cnVjdCByYl9yb290IHVhYmlfZW5naW5lczsKIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtLmMKaW5kZXggZjRjYmQzNzlkYjk1Li5iMjQ4MjVjNjkxZjcgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW0uYwpAQCAtMTA2Myw4ICsxMDYzLDcgQEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2lu
ZXNfcmVjb3JkX2RlZmF1bHRzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJCUdFTV9CVUdfT04oIWVu
Z2luZS0+a2VybmVsX2NvbnRleHQpOwogCQllbmdpbmUtPnNlcmlhbCsrOyAvKiBmb3JjZSB0aGUg
a2VybmVsIGNvbnRleHQgc3dpdGNoICovCiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShl
bmdpbmUtPmtlcm5lbF9jb250ZXh0LT5nZW1fY29udGV4dCwKLQkJCQkJICBlbmdpbmUpOworCQlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJ
CQllcnIgPSBQVFJfRVJSKGNlKTsKIAkJCWdvdG8gb3V0OwpAQCAtMTIxNyw2ICsxMjE2LDcgQEAg
aW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0K
IAogCWludGVsX2d0X2luaXQoJmRldl9wcml2LT5ndCk7CisJaTkxNV9nZW1faW5pdF9jb250ZXh0
cyhkZXZfcHJpdik7CiAKIAlyZXQgPSBpbnRlbF9lbmdpbmVzX3NldHVwKCZkZXZfcHJpdi0+Z3Qp
OwogCWlmIChyZXQpIHsKQEAgLTEyMjQsMTYgKzEyMjQsMTAgQEAgaW50IGk5MTVfZ2VtX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlnb3RvIGVycl91bmxvY2s7CiAJ
fQogCi0JcmV0ID0gaTkxNV9nZW1faW5pdF9jb250ZXh0cyhkZXZfcHJpdik7Ci0JaWYgKHJldCkg
ewotCQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsKLQkJZ290byBlcnJfc2NyYXRjaDsKLQl9Ci0K
IAlyZXQgPSBpbnRlbF9lbmdpbmVzX2luaXQoJmRldl9wcml2LT5ndCk7CiAJaWYgKHJldCkgewog
CQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsKLQkJZ290byBlcnJfY29udGV4dDsKKwkJZ290byBl
cnJfc2NyYXRjaDsKIAl9CiAKIAlpbnRlbF91Y19pbml0KCZkZXZfcHJpdi0+Z3QudWMpOwpAQCAt
MTI5Nyw5ICsxMjkxLDYgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCQlpbnRlbF91Y19maW5pKCZkZXZfcHJpdi0+Z3QudWMpOwogCQlpbnRl
bF9lbmdpbmVzX2NsZWFudXAoJmRldl9wcml2LT5ndCk7CiAJfQotZXJyX2NvbnRleHQ6Ci0JaWYg
KHJldCAhPSAtRUlPKQotCQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2X3By
aXYpOwogZXJyX3NjcmF0Y2g6CiAJaW50ZWxfZ3RfZHJpdmVyX3JlbGVhc2UoJmRldl9wcml2LT5n
dCk7CiBlcnJfdW5sb2NrOgpAQCAtMTM2NCw3ICsxMzU1LDYgQEAgdm9pZCBpOTE1X2dlbV9kcml2
ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHZvaWQgaTkxNV9n
ZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewog
CWludGVsX2VuZ2luZXNfY2xlYW51cCgmZGV2X3ByaXYtPmd0KTsKLQlpOTE1X2dlbV9kcml2ZXJf
cmVsZWFzZV9fY29udGV4dHMoZGV2X3ByaXYpOwogCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZk
ZXZfcHJpdi0+Z3QpOwogCiAJaW50ZWxfd2FfbGlzdF9mcmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlz
dCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDg4MTc5MjAyYzU1Ni4uNWUy
MDc0MTJhNDU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMTM2MywxMiAr
MTM2Myw4IEBAIHN0YXRpYyBpbnQgZ2VuOF9pbml0X3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0pCiAJICogSWYgZXZlcnlib2R5IGFncmVlcyB0byBub3QgdG8gd3JpdGUgaW50
byB0aGUgc2NyYXRjaCBwYWdlLAogCSAqIHdlIGNhbiByZXVzZSBpdCBmb3IgYWxsIHZtLCBrZWVw
aW5nIGNvbnRleHRzIGFuZCBwcm9jZXNzZXMgc2VwYXJhdGUuCiAJICovCi0JaWYgKHZtLT5oYXNf
cmVhZF9vbmx5ICYmCi0JICAgIHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dCAmJgotCSAgICB2bS0+
aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtKSB7Ci0JCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KmNsb25lID0KLQkJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQodm0tPmk5MTUtPmtlcm5lbF9j
b250ZXh0LT52bSwKLQkJCQkJCSAgdHJ1ZSk7IC8qIHN0YXRpYyAqLworCWlmICh2bS0+aGFzX3Jl
YWRfb25seSAmJiB2bS0+Z3QtPnZtICYmICFpOTE1X2lzX2dndHQodm0tPmd0LT52bSkpIHsKKwkJ
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xvbmUgPSB2bS0+Z3QtPnZtOwogCiAJCUdFTV9C
VUdfT04oIWNsb25lLT5oYXNfcmVhZF9vbmx5KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1
X2Vycm9yLmMKaW5kZXggYjQwMTU3Y2ZhZTE0Li41OTg0MjVhMmJlNjIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9ncHVfZXJyb3IuYwpAQCAtMTIzMSw5ICsxMjMxLDExIEBAIHN0YXRpYyB2b2lk
IHJlY29yZF9yZXF1ZXN0KGNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsCiAJZXJx
LT5oZWFkID0gcmVxdWVzdC0+aGVhZDsKIAllcnEtPnRhaWwgPSByZXF1ZXN0LT50YWlsOwogCi0J
cmN1X3JlYWRfbG9jaygpOwotCWVycS0+cGlkID0gY3R4ICYmIGN0eC0+cGlkID8gcGlkX25yKGN0
eC0+cGlkKSA6IDA7Ci0JcmN1X3JlYWRfdW5sb2NrKCk7CisJaWYgKGN0eCkgeworCQlyY3VfcmVh
ZF9sb2NrKCk7CisJCWVycS0+cGlkID0gY3R4ICYmIGN0eC0+cGlkID8gcGlkX25yKGN0eC0+cGlk
KSA6IDA7CisJCXJjdV9yZWFkX3VubG9jaygpOworCX0KIH0KIAogc3RhdGljIHZvaWQgZW5naW5l
X3JlY29yZF9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jCmluZGV4IDE5MjRkNDQwODFlOS4uMjVkYmQwMWI4MjJmIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMjM0MCw5ICsyMzQwLDYgQEAgc3RhdGljIGludCBscmNf
Y29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAog
CSAqLwogCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCWxpc3RfZm9yX2Vh
Y2hfZW50cnlfc2FmZShjdHgsIGNuLCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QsIGxpbmspIHsK
LQkJaWYgKGN0eCA9PSBpOTE1LT5rZXJuZWxfY29udGV4dCkKLQkJCWNvbnRpbnVlOwotCiAJCWlm
ICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJmN0eC0+cmVmKSkKIAkJCWNvbnRpbnVlOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IDY3OGIzMjA4OTUwNy4uMjBlZWVmMzg2NTc3
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMTIzNiw4ICsxMjM2LDggQEAg
dm9pZCBfX2k5MTVfcmVxdWVzdF9xdWV1ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAogdm9p
ZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCXN0cnVjdCBp
OTE1X3NjaGVkX2F0dHIgYXR0ciA9IHJxLT5jb250ZXh0LT5nZW1fY29udGV4dC0+c2NoZWQ7CiAJ
c3RydWN0IGludGVsX3RpbWVsaW5lICogY29uc3QgdGwgPSBpOTE1X3JlcXVlc3RfdGltZWxpbmUo
cnEpOworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHt9OwogCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnByZXY7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwpAQCAtMTI0
Nyw2ICsxMjQ3LDkgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKQogCiAJcHJldiA9IF9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7CiAKKwlpZiAocnEtPmNv
bnRleHQtPmdlbV9jb250ZXh0KQorCQlhdHRyID0gcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0LT5z
Y2hlZDsKKwogCS8qCiAJICogQm9vc3QgYWN0dWFsIHdvcmtsb2FkcyBwYXN0IHNlbWFwaG9yZXMh
CiAJICoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3Jl
cXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwpp
bmRleCA5ZTZkMzE1OWNkODAuLjlkZDU4NmE5ZGYwNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwpAQCAtNzQxLDEwICs3NDEsOCBAQCBzdGF0aWMg
aW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92
bWEgKnJlY3Vyc2l2ZV9iYXRjaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gaTkxNS0+a2VybmVsX2NvbnRleHQ7CiAJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25zdCBpbnQgZ2VuID0gSU5URUxfR0VO
KGk5MTUpOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwogCXUzMiAqY21kOwogCWludCBlcnI7CkBAIC03NTMsOSArNzUxLDcgQEAgc3RhdGlj
IHN0cnVjdCBpOTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKLQl2
bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwotCXZtYSA9IGk5MTVfdm1hX2lu
c3RhbmNlKG9iaiwgdm0sIE5VTEwpOwotCWk5MTVfdm1fcHV0KHZtKTsKKwl2bWEgPSBpOTE1X3Zt
YV9pbnN0YW5jZShvYmosIGk5MTUtPmd0LnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsK
IAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRleCBlNThiMGJjOWNkYjYuLmE1
MzlkOGIzOTY4MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21v
Y2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2Nr
X2dlbV9kZXZpY2UuYwpAQCAtNjMsNyArNjMsNiBAQCBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9y
ZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCAmaTkxNS0+Z3QsIGlkKQogCQltb2NrX2VuZ2luZV9mcmVlKGVuZ2luZSk7Ci0JaTkxNV9nZW1f
ZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwogCiAJZHJhaW5fd29ya3F1ZXVlKGk5MTUt
PndxKTsKIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwpAQCAtMTc5LDYgKzE3
OCw3IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9kZXZpY2Uodm9pZCkKIAlt
b2NrX2luaXRfY29udGV4dHMoaTkxNSk7CiAKIAltb2NrX2luaXRfZ2d0dChpOTE1LCAmaTkxNS0+
Z2d0dCk7CisJaTkxNS0+Z3Qudm0gPSBpOTE1X3ZtX2dldCgmaTkxNS0+Z2d0dC52bSk7CiAKIAlt
a3dyaXRlX2RldmljZV9pbmZvKGk5MTUpLT5lbmdpbmVfbWFzayA9IEJJVCgwKTsKIApAQCAtMTg2
LDEwICsxODYsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19nZW1fZGV2aWNlKHZv
aWQpCiAJaWYgKCFpOTE1LT5lbmdpbmVbUkNTMF0pCiAJCWdvdG8gZXJyX3VubG9jazsKIAotCWk5
MTUtPmtlcm5lbF9jb250ZXh0ID0gbW9ja19jb250ZXh0KGk5MTUsIE5VTEwpOwotCWlmICghaTkx
NS0+a2VybmVsX2NvbnRleHQpCi0JCWdvdG8gZXJyX2VuZ2luZTsKLQogCWlmIChtb2NrX2VuZ2lu
ZV9pbml0KGk5MTUtPmVuZ2luZVtSQ1MwXSkpCiAJCWdvdG8gZXJyX2NvbnRleHQ7CiAKQEAgLTE5
OCw4ICsxOTQsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19nZW1fZGV2aWNlKHZv
aWQpCiAJcmV0dXJuIGk5MTU7CiAKIGVycl9jb250ZXh0OgotCWk5MTVfZ2VtX2RyaXZlcl9yZWxl
YXNlX19jb250ZXh0cyhpOTE1KTsKLWVycl9lbmdpbmU6CiAJbW9ja19lbmdpbmVfZnJlZShpOTE1
LT5lbmdpbmVbUkNTMF0pOwogZXJyX3VubG9jazoKIAlkZXN0cm95X3dvcmtxdWV1ZShpOTE1LT53
cSk7Ci0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

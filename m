Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D24C482785
	for <lists+intel-gfx@lfdr.de>; Tue,  6 Aug 2019 00:20:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 37CC26E207;
	Mon,  5 Aug 2019 22:20:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2F9156E207
 for <intel-gfx@lists.freedesktop.org>; Mon,  5 Aug 2019 22:20:56 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17897825-1500050 
 for multiple; Mon, 05 Aug 2019 23:19:58 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  5 Aug 2019 23:19:56 +0100
Message-Id: <20190805221956.17277-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Cancel persistent contexts if
 !hangcheck
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm9ybWFsbHksIHdlIHJlbHkgb24gb3VyIGhhbmdjaGVjayB0byBwcmV2ZW50IHBlcnNpc3RlbnQg
YmF0Y2hlcyBmcm9tCmhvZ2dpbmcgdGhlIEdQVS4gSG93ZXZlciwgaWYgdGhlIHVzZXIgZGlzYWJs
ZXMgaGFuZ2NoZWNrLCB0aGlzIG1lY2hhbmlzbQpicmVha3MgZG93bi4gRGVzcGl0ZSBvdXIgaW5z
aXN0ZW5jZSB0aGF0IHRoaXMgaXMgdW5zYWZlLCB0aGUgdXNlcnMgYXJlCmVxdWFsbHkgaW5zaXN0
ZW50IHRoYXQgdGhleSB3YW50IHRvIHVzZSBlbmRsZXNzIGJhdGNoZXMgYW5kIHdpbGwgZGlzYWJs
ZQp0aGUgaGFuZ2NoZWNrIG1lY2hhbmlzbS4gV2UgYXJlIGxvb2tpbmcgYXJlIHBlcmhhcHMgcmVw
bGFjaW5nIGhhbmdjaGVjawp3aXRoIGEgc29mdGVyIG1lY2hhbmlzbSwgdGhhdCBzZW5kcyBhIHB1
bHNlIGRvd24gdGhlIGVuZ2luZSB0byBjaGVjayBpZgppdCBpcyB3ZWxsLiBXZSBjYW4gdXNlIHRo
ZSBzYW1lIHByZWVtcHRpdmUgcHVsc2UgdG8gZmx1c2ggYW4gYWN0aXZlCnBlcnNpc3RlbnQgY29u
dGV4dCBvZmYgdGhlIEdQVSB1cG9uIGNvbnRleHQgY2xvc2UsIHByZXZlbnRpbmcgcmVzb3VyY2Vz
CmJlaW5nIGxvc3QgYW5kIHVua2lsbGFibGUgcmVxdWVzdHMgcmVtYWluaW5nIG9uIHRoZSBHUFUs
IGFmdGVyIHByb2Nlc3MKdGVybWluYXRpb24uCgpYWFggRml4dXAgYmFubmVkIGNvbnRleHRzIG9u
IHNjaGVkdWxlLW91dCwgc28gdGhhdCB3ZSBkb24ndCBqdW1wIGJhY2sKaW50byB0aGUgbWlkZGxl
IG9mIGFuIGluZmluaXRlIGxvb3Agb24gcmVzdW1lLgoKWFhYIFRoaXMgZG9lcyBuZWVkIGEgcHJl
ZW1wdC10by1pZGxlIHN0eWxlIG9mIHB1bHNlLCBJIG5lZWQgdG8gc2V0IGEKZmxhZyBvbiB0aGUg
cmVxdWVzdCB0byBwcmV2ZW50IHF1ZXVpbmcgaW50byB0aGUgc2Vjb25kIHBvcnQsIHNvIHRoYXQg
d2UKaGF2ZSBhIGNvbnRleHQtb3V0IGV2ZWJ0IHdoZXJlIHdlIGNhbiBwYXRjaCB1cCB0aGUgY29u
dGV4dCBpbWFnZS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2ls
c29uLmNvLnVrPgpDYzogSm9vbmFzIExhaHRpbmVuIDxqb29uYXMubGFodGluZW5AbGludXguaW50
ZWwuY29tPgpDYzogTWljaGHFgiBXaW5pYXJza2kgPG1pY2hhbC53aW5pYXJza2lAaW50ZWwuY29t
PgpDYzogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVsLmNvbT4KCi0tLQpTYW1l
IHNvcnQgb2YgY2F2ZWF0cyBhcyBmb3IgaGFuZ2NoZWNrLCBhIGZldyBjb3JuZXIgY2FzZXMgbmVl
ZApzdHJ1Y3RfbXV0ZXggYW5kIHNvbWUgcHJlYWxsb2NhdGlvbi4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9NYWtlZmlsZSAgICAgICAgICAgICAgICAgfCAgMyArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwgNDYgKysrKysrKysrKysrKysrKwogLi4u
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmMgIHwgNTMgKysrKysrKysr
KysrKysrKysrKwogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0Lmgg
IHwgMTQgKysrKysKIDQgZmlsZXMgY2hhbmdlZCwgMTE1IGluc2VydGlvbnMoKyksIDEgZGVsZXRp
b24oLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfaGVhcnRiZWF0LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGEx
MDE2ODU4ZDAxNC4uNDU1ZjVjNjIxM2VlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtNzEsOCAr
NzEsOSBAQCBvYmoteSArPSBndC8KIGd0LXkgKz0gXAogCWd0L2ludGVsX2JyZWFkY3J1bWJzLm8g
XAogCWd0L2ludGVsX2NvbnRleHQubyBcCi0JZ3QvaW50ZWxfZW5naW5lX3Bvb2wubyBcCiAJZ3Qv
aW50ZWxfZW5naW5lX2NzLm8gXAorCWd0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQubyBcCisJZ3Qv
aW50ZWxfZW5naW5lX3Bvb2wubyBcCiAJZ3QvaW50ZWxfZW5naW5lX3BtLm8gXAogCWd0L2ludGVs
X2d0Lm8gXAogCWd0L2ludGVsX2d0X3BtLm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMKaW5kZXggNjRmN2E1MzNlODg2Li5iZGYyMWNmOWNlM2MgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtNzAsNiArNzAs
NyBAQAogI2luY2x1ZGUgPGRybS9pOTE1X2RybS5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfbHJj
X3JlZy5oIgorI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaCIKIAogI2luY2x1
ZGUgImk5MTVfZ2VtX2NvbnRleHQuaCIKICNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKQEAgLTM3
Myw2ICszNzQsNDIgQEAgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3JlbGVhc2Uoc3RydWN0IGtyZWYg
KnJlZikKIAkJcXVldWVfd29yayhpOTE1LT53cSwgJmk5MTUtPmNvbnRleHRzLmZyZWVfd29yayk7
CiB9CiAKK3N0YXRpYyB2b2lkIGtpbGxfY29udGV4dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4KQoreworCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CisJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lOworCWludGVsX2VuZ2luZV9tYXNrX3QgdG1wLCBhY3RpdmU7CisJ
c3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCisJaWYgKGk5MTVfZ2VtX2NvbnRleHRfaXNfYmFu
bmVkKGN0eCkpCisJCXJldHVybjsKKworCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Jhbm5lZChjdHgp
OworCisJYWN0aXZlID0gMDsKKwlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9jb250
ZXh0X2xvY2tfZW5naW5lcyhjdHgpLCBpdCkgeworCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsK
KworCQlycSA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3VubG9ja2VkKCZjZS0+cmluZy0+dGlt
ZWxpbmUtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghcnEpCisJCQljb250aW51ZTsKKworCQlhY3Rp
dmUgfD0gcnEtPmVuZ2luZS0+bWFzazsKKwkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJfQorCWk5
MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKKworCS8qCisJICogU2VuZCBhICJo
aWdoIHByaW9yaXR5IHB1bHNlIiBkb3duIHRoZSBlbmdpbmUgdG8gY2F1c2UgdGhlCisJICogY3Vy
cmVudCByZXF1ZXN0IHRvIGJlIG1vbWVudGFyaWx5IHByZWVtcHRlZC4gKElmIGl0IGZhaWxzIHRv
CisJICogYmUgcHJlZW1wdGVkLCBpdCB3aWxsIGJlIHJlc2V0KS4gQXMgd2UgaGF2ZSBtYXJrZWQg
b3VyIGNvbnRleHQKKwkgKiBhcyBiYW5uZWQsIGFueSBpbmNvbXBsZXRlIHJlcXVlc3QsIGluY2x1
ZGluZyBhbnkgcnVubmluZywgd2lsbAorCSAqIGJlIHNraXBwZWQuCisJICovCisJZm9yX2VhY2hf
ZW5naW5lX21hc2tlZChlbmdpbmUsIGN0eC0+aTkxNSwgYWN0aXZlLCB0bXApCisJCWludGVsX2Vu
Z2luZV9wdWxzZShlbmdpbmUpOworfQorCiBzdGF0aWMgdm9pZCBjb250ZXh0X2Nsb3NlKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7CiAJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CkBA
IC0zOTQsNiArNDMxLDE1IEBAIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKIAlsdXRfY2xvc2UoY3R4KTsKIAogCW11dGV4X3VubG9jaygmY3R4
LT5tdXRleCk7CisKKwkvKgorCSAqIElmIHRoZSB1c2VyIGhhcyBkaXNhYmxlZCBoYW5nY2hlY2tp
bmcsIHdlIGNhbiBub3QgYmUgc3VyZSB0aGF0CisJICogdGhlIGJhdGNoZXMgd2lsbCBldmVyIGNv
bXBsZXRlIGFuZCBsZXQgdGhlIGNvbnRleHQgYmUgZnJlZWQuCisJICogRm9yY2libHkga2lsbCBv
ZmYgYW55IHJlbWFpbmluZyByZXF1ZXN0cyBpbiB0aGlzIGNhc2UuCisJICovCisJaWYgKCFpOTE1
X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrKQorCQlraWxsX2NvbnRleHQoY3R4KTsKKwogCWk5
MTVfZ2VtX2NvbnRleHRfcHV0KGN0eCk7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAw
MDAwMDAwMDAwMDAuLjBjNmVhOTc1MDA0OAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuYwpAQCAtMCwwICsxLDUzIEBACisv
KgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAy
MDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgor
CisjaW5jbHVkZSAiaW50ZWxfY29udGV4dC5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9oZWFy
dGJlYXQuaCIKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKKyNpbmNsdWRlICJpbnRlbF9l
bmdpbmUuaCIKKyNpbmNsdWRlICJpbnRlbF9ndC5oIgorCit2b2lkIGludGVsX2VuZ2luZV9wdWxz
ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKKwlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRy
IGF0dHIgPSB7IC5wcmlvcml0eSA9IElOVF9NQVggfTsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKKwlpbnQgZXJyOworCisJR0VNX0JVR19PTighZW5naW5lLT5zY2hlZHVsZSk7CisKKwlpZiAo
IWludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdha2UoZW5naW5lKSkKKwkJcmV0dXJuOworCisJbXV0
ZXhfbG9jaygmY2UtPnJpbmctPnRpbWVsaW5lLT5tdXRleCk7CisKKwlpbnRlbF9jb250ZXh0X2Vu
dGVyKGNlKTsKKwlycSA9IF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShjZSwgR0ZQX05PV0FJVCB8IF9f
R0ZQX05PV0FSTik7CisJaW50ZWxfY29udGV4dF9leGl0KGNlKTsKKwlpZiAoSVNfRVJSKHJxKSkg
eworCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJZ290byBvdXRfdW5sb2NrOworCX0KKwlpOTE1X3Jl
cXVlc3RfZ2V0KHJxKTsKKworCWVuZ2luZS0+d2FrZXJlZl9zZXJpYWwgPSBlbmdpbmUtPnNlcmlh
bCArIDE7CisJX19pOTE1X3JlcXVlc3RfY29tbWl0KHJxKTsKKworCWxvY2FsX2JoX2Rpc2FibGUo
KTsKKwllbmdpbmUtPnNjaGVkdWxlKHJxLCAmYXR0cik7CisJbG9jYWxfYmhfZW5hYmxlKCk7CisK
KwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKworb3V0X3VubG9jazoKKwltdXRleF91bmxvY2soJmNl
LT5yaW5nLT50aW1lbGluZS0+bXV0ZXgpOworCWludGVsX2NvbnRleHRfdGltZWxpbmVfdW5sb2Nr
KGNlKTsKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisJaWYgKGVycikgLyogWFhYIG11
c3Qgbm90IGJlIGFsbG93ZWQgdG8gZmFpbCAqLworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBwaW5n
ICVzLCBlcnI9JWRcbiIsIGVuZ2luZS0+bmFtZSwgZXJyKTsKK30KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaApuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLjg2NzYxNzQ4ZGMyMQotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaApAQCAtMCwwICsx
LDE0IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHly
aWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBJTlRFTF9FTkdJ
TkVfSEVBUlRCRUFUX0gKKyNkZWZpbmUgSU5URUxfRU5HSU5FX0hFQVJUQkVBVF9ICisKK3N0cnVj
dCBpbnRlbF9lbmdpbmVfY3M7CisKK3ZvaWQgaW50ZWxfZW5naW5lX3B1bHNlKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSk7CisKKyNlbmRpZiAvKiBJTlRFTF9FTkdJTkVfSEVBUlRCRUFU
X0ggKi8KLS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeA==

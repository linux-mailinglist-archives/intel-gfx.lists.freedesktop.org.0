Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 926F1103D3C
	for <lists+intel-gfx@lfdr.de>; Wed, 20 Nov 2019 15:25:40 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2E58E6EA50;
	Wed, 20 Nov 2019 14:25:38 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AB4C86EA50
 for <intel-gfx@lists.freedesktop.org>; Wed, 20 Nov 2019 14:25:33 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 19272791-1500050 for multiple; Wed, 20 Nov 2019 14:25:32 +0000
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20191120093302.3723715-1-chris@chris-wilson.co.uk>
 <20191120093302.3723715-9-chris@chris-wilson.co.uk>
 <63602b43-06bb-aa55-5ac4-06ba45046160@linux.intel.com>
 <157425717389.13839.1416435425305498787@skylake-alporthouse-com>
 <b072e40f-def9-41fa-a673-577aedcc3340@linux.intel.com>
In-Reply-To: <b072e40f-def9-41fa-a673-577aedcc3340@linux.intel.com>
Message-ID: <157425992882.13839.1903902101225711803@skylake-alporthouse-com>
Date: Wed, 20 Nov 2019 14:25:28 +0000
Subject: Re: [Intel-gfx] [PATCH 9/9] drm/i915/gt: Schedule request
 retirement when timeline idles
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBUdnJ0a28gVXJzdWxpbiAoMjAxOS0xMS0yMCAxNDoxNjoxNykKPiAKPiBPbiAyMC8x
MS8yMDE5IDEzOjM5LCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBRdW90aW5nIFR2cnRrbyBVcnN1
bGluICgyMDE5LTExLTIwIDEzOjE2OjUxKQo+ID4+Cj4gPj4gT24gMjAvMTEvMjAxOSAwOTozMywg
Q2hyaXMgV2lsc29uIHdyb3RlOgo+ID4+PiArCj4gPj4+ICsgICAgICAgICAgICAgLyoKPiA+Pj4g
KyAgICAgICAgICAgICAgKiBPdXIgZ29hbCBoZXJlIGlzIHRvIHJldGlyZSBfaWRsZV8gdGltZWxp
bmVzIGFzIHNvb24gYXMKPiA+Pj4gKyAgICAgICAgICAgICAgKiBwb3NzaWJsZSAoYXMgdGhleSBh
cmUgaWRsZSwgd2UgZG8gbm90IGV4cGVjdCB1c2Vyc3BhY2UKPiA+Pj4gKyAgICAgICAgICAgICAg
KiB0byBiZSBjbGVhbmluZyB1cCBhbnl0aW1lIHNvb24pLgo+ID4+PiArICAgICAgICAgICAgICAq
Cj4gPj4+ICsgICAgICAgICAgICAgICogSWYgdGhlIHRsLT5hY3RpdmVfY291bnQgaXMgYWxyZWFk
eSB6ZXJvLCBzb21lb25lIGVsc2UKPiA+Pj4gKyAgICAgICAgICAgICAgKiBzaG91bGQgaGF2ZSBy
ZXRpcmVkIHRoZSB0aW1lbGluZS4gRXF1YWxseSBpZiB0aGUgdGltZWxpbmUKPiA+Pj4gKyAgICAg
ICAgICAgICAgKiBpcyBjdXJyZW50bHkgbG9ja2VkLCBlaXRoZXIgaXQgaXMgYmVpbmcgcmV0aXJl
ZCBlbHNld2hlcmUKPiA+Pj4gKyAgICAgICAgICAgICAgKiBvciBhYm91dCB0byBiZSEKPiA+Pj4g
KyAgICAgICAgICAgICAgKi8KPiA+Pj4gKyAgICAgICAgICAgICBpZiAoYXRvbWljX3JlYWQoJnRs
LT5hY3RpdmVfY291bnQpICYmCj4gPj4+ICsgICAgICAgICAgICAgICAgIG11dGV4X3RyeWxvY2so
JnRsLT5tdXRleCkpIHsKPiA+Pj4gKyAgICAgICAgICAgICAgICAgICAgIHJldGlyZV9yZXF1ZXN0
cyh0bCk7Cj4gPj4+ICsgICAgICAgICAgICAgICAgICAgICBtdXRleF91bmxvY2soJnRsLT5tdXRl
eCk7Cj4gPj4+ICsgICAgICAgICAgICAgfQo+ID4+PiArICAgICAgICAgICAgIGludGVsX3RpbWVs
aW5lX3B1dCh0bCk7Cj4gPj4+ICsKPiA+Pj4gKyAgICAgICAgICAgICBHRU1fQlVHX09OKCFuZXh0
KTsKPiA+Pj4gKyAgICAgICAgICAgICB0bCA9IHB0cl9tYXNrX2JpdHMobmV4dCwgMSk7Cj4gPj4K
PiA+PiBZb3Ugc29tZXRpbWVzIGV4cGVjdCBlbmdpbmUtPnJldGlyZSB0byBjb250YWluIDB4MT8K
PiA+IAo+ID4gWWVzLCBpbWFnaW5lIHRoYXQgd2UgYXJlIHN1Ym1pdHRpbmcgdmVyeSBmYXN0IHN1
Y2ggdGhhdCB3ZSBzY2hlZHVsZV9vdXQKPiA+IHRoZSBzYW1lIGNvbnRleHQgYmVmb3JlIHRoZSB3
b3JrZXIgcmFuLCB3ZSB3b3VsZCB0aGVuIHRyeSB0bwo+ID4gYWRkX3JldGlyZSgpIHRoZSBzYW1l
IHRpbWVsaW5lIGFnYWluLiBTbyBJIHdhcyB1c2luZyBCSVQoMCkgdG8gdGFnIGFuCj4gPiBhY3Rp
dmUgZWxlbWVudCBpbiB0aGUgcmV0aXJlbWVudCBsaXN0Lgo+IAo+IElmIHdlIGhhdmUgc2NoZWR1
bGVfb3V0IG9uIHRoZSBzYW1lIGNvbnRleHQgYmVmb3JlIHRoZSByZXRpcmUgcmFuIHRoZW4gCj4g
YWRkX3JldGlyZSBpcyBhIG5vLW9wIGR1ZSB0bC0+cmV0aXJlIGJlaW5nIHNldC4KClRoZSBmaXJz
dCBlbGVtZW50IGluIHRoZSBsaXN0IGhhcyB0aW1lbGluZS0+cmV0aXJlID0gTlVMTC4gV2Ugb25s
eSBrbm93Cml0IGlzIHNldCBiZWNhdXNlIHdlIG1ha2UgaXQgdGltZWxpbmUtPnJldGlyZSA9IDEg
aW5zdGVhZC4KCj4gSXQgY291bGQgYmUgYSByYWNlIGJldHdlZW4gZW5naW5lX3JldGlyZSBhbmQg
YWRkX3JldGlyZSB3aGVyZSAKPiBlbmdpbmUtPnJldGlyZSBpcyBzZXQgdG8gTlVMTCBzbyBsYXR0
ZXIgd291bGQgc2V0IHRsLT5yZXRpcmUgdG8gTlVMTCB8IAo+IEJJVCgwKS4KPiAKPiBCdXQgQklU
KDApIGlzIG9ubHkgZmlsdGVyZWQgb3V0IGFuZCBub3QgYWN0ZWQgdXBvbiBhbnl3aGVyZSBzbyBJ
IGFtIAo+IHN0aWxsIGxvc3QuCj4gCj4gU28gbWF5YmUgZnJvbSB0aGUgb3Bwb3NpdGUgYW5nbGUs
IHdoYXQgZ29lcyB3cm9uZyBpZiB5b3UgZHJvcCBhbGwgQklUKDApIAo+IGJ1c2luZXNzPwoKWW91
IGluc2VydCB0aGUgZWxlbWVudCBpbnRvIHRoZSBsaXN0IHR3aWNlIGNhdXNpbmcgYSBsb29wLiBO
b3cgdGhhdCBsb29wCmlzIHNob3J0IGxpdmVkIGFzIHdlIGNsZWFyIHRpbWVsaW5lLT5yZXRpcmUg
b24gcHJvY2Vzc2luZywgYnV0IHdlIG1heQpzdGlsbCBlbmQgdXAgZHJvcHBpbmcgYSByZWZlcmVu
Y2UgdHdpY2UuCgo+IAo+ID4gCj4gPj4+ICsgICAgIH0gd2hpbGUgKHRsKTsKPiA+Pj4gK30KPiA+
Pj4gKwo+ID4+PiArc3RhdGljIGJvb2wgYWRkX3JldGlyZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsCj4gPj4+ICsgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBpbnRlbF90aW1lbGlu
ZSAqdGwpCj4gPj4+ICt7Cj4gPj4+ICsgICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqZmlyc3Qg
PSBSRUFEX09OQ0UoZW5naW5lLT5yZXRpcmUpOwo+ID4+PiArCj4gPj4+ICsgICAgIC8qCj4gPj4+
ICsgICAgICAqIFdlIG9wZW4tY29kZSBhIGxsaXN0IGhlcmUgdG8gaW5jbHVkZSB0aGUgYWRkaXRp
b25hbCB0YWcgW0JJVCgwKV0KPiA+Pj4gKyAgICAgICogc28gdGhhdCB3ZSBrbm93IHdoZW4gdGhl
IHRpbWVsaW5lIGlzIGFscmVhZHkgb24gYQo+ID4+PiArICAgICAgKiByZXRpcmVtZW50IHF1ZXVl
OiBlaXRoZXIgdGhpcyBlbmdpbmUgb3IgYW5vdGhlci4KPiA+Pj4gKyAgICAgICoKPiA+Pj4gKyAg
ICAgICogSG93ZXZlciwgd2UgcmVseSBvbiB0aGF0IGEgdGltZWxpbmUgY2FuIG9ubHkgYmUgYWN0
aXZlIG9uIGEgc2luZ2xlCj4gPj4+ICsgICAgICAqIGVuZ2luZSBhdCBhbnkgb25lIHRpbWUgYW5k
IHRoYXQgYWRkX3JldGlyZSgpIGlzIGNhbGxlZCBiZWZvcmUgdGhlCj4gPj4+ICsgICAgICAqIGVu
Z2luZSByZWxlYXNlcyB0aGUgdGltZWxpbmUgYW5kIHRyYW5zZmVycmVkIHRvIGFub3RoZXIgdG8g
cmV0aXJlLgo+ID4+PiArICAgICAgKi8KPiA+Pj4gKwo+ID4+PiArICAgICBpZiAoUkVBRF9PTkNF
KHRsLT5yZXRpcmUpKSAvKiBhbHJlYWR5IHF1ZXVlZCAqLwo+ID4+PiArICAgICAgICAgICAgIHJl
dHVybiBmYWxzZTsKPiA+Pgo+ID4+IENhbid0IHRoaXMgZ28gZmlyc3QgaW4gdGhlIGZ1bmN0aW9u
Pwo+ID4gCj4gPiBDb25jZXB0dWFsbHkgaXQgaXMuIEFuZCBJIG1hZGUgaXQgc28gYmVjYXVzZSBJ
IGFsc28gZGVjaWRlZCBhZ2FpbnN0Cj4gPiBoYXZpbmcgdGhlIFJFQURfT05DRSgpIGF0IHRoZSB0
b3AuCj4gCj4gQnV0IFJFQURfT05DRSBpcyBhdCB0aGUgdG9wLCBqdXN0IGEgZGlmZmVyZW50IG9u
ZSB3aGljaCBpcyBkaXNjYXJkZWQgaWYgCj4gdGhpcyBvbmUgaXMgTlVMTC4KCnN0YXRpYyBib29s
IGFkZF9yZXRpcmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCnsKICAgICAgICBzdHJ1Y3QgaW50
ZWxfdGltZWxpbmUgKmZpcnN0OwoKICAgICAgICAvKgogICAgICAgICAqIFdlIG9wZW4tY29kZSBh
IGxsaXN0IGhlcmUgdG8gaW5jbHVkZSB0aGUgYWRkaXRpb25hbCB0YWcgW0JJVCgwKV0KICAgICAg
ICAgKiBzbyB0aGF0IHdlIGtub3cgd2hlbiB0aGUgdGltZWxpbmUgaXMgYWxyZWFkeSBvbiBhCiAg
ICAgICAgICogcmV0aXJlbWVudCBxdWV1ZTogZWl0aGVyIHRoaXMgZW5naW5lIG9yIGFub3RoZXIu
CiAgICAgICAgICoKICAgICAgICAgKiBIb3dldmVyLCB3ZSByZWx5IG9uIHRoYXQgYSB0aW1lbGlu
ZSBjYW4gb25seSBiZSBhY3RpdmUgb24gYSBzaW5nbGUKICAgICAgICAgKiBlbmdpbmUgYXQgYW55
IG9uZSB0aW1lIGFuZCB0aGF0IGFkZF9yZXRpcmUoKSBpcyBjYWxsZWQgYmVmb3JlIHRoZQogICAg
ICAgICAqIGVuZ2luZSByZWxlYXNlcyB0aGUgdGltZWxpbmUgYW5kIHRyYW5zZmVycmVkIHRvIGFu
b3RoZXIgdG8gcmV0aXJlLgogICAgICAgICAqLwoKICAgICAgICBpZiAoUkVBRF9PTkNFKHRsLT5y
ZXRpcmUpKSAvKiBhbHJlYWR5IHF1ZXVlZCAqLwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl
OwoKICAgICAgICBpZiAoIWF0b21pY19yZWFkKCZ0bC0+YWN0aXZlX2NvdW50KSkgLyogYWxyZWFk
eSByZXRpcmVkICovCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgogICAgICAgIGludGVs
X3RpbWVsaW5lX2dldCh0bCk7CiAgICAgICAgZmlyc3QgPSBSRUFEX09OQ0UoZW5naW5lLT5yZXRp
cmUpOwogICAgICAgIGRvCiAgICAgICAgICAgICAgICB0bC0+cmV0aXJlID0gcHRyX3BhY2tfYml0
cyhmaXJzdCwgMSwgMSk7CiAgICAgICAgd2hpbGUgKCF0cnlfY21weGNoZygmZW5naW5lLT5yZXRp
cmUsICZmaXJzdCwgdGwpKTsKCiAgICAgICAgcmV0dXJuICFmaXJzdDsKfQoKaXMgdGhlIGN1cnJl
bnQgaW5jYXJuYXRpb24uCgo+ID4+PiArCj4gPj4+ICsgICAgIGludGVsX3RpbWVsaW5lX2dldCh0
bCk7Cj4gPj4+ICsgICAgIGRvCj4gPj4+ICsgICAgICAgICAgICAgdGwtPnJldGlyZSA9IHB0cl9w
YWNrX2JpdHMoZmlyc3QsIDEsIDEpOwo+ID4+Cj4gPj4gSGVyZSB5b3UgcmVseSBvbiBhc3NpZ25t
ZW50IGJlaW5nIGF0b21pYyByaWdodD8KPiA+IAo+ID4gSXNoLiBIZXJlIHdlIHJlbHkgb24gdGhl
IHRpbWVsaW5lIGJlaW5nIG93bmVkIGJ5IHRoZSBlbmdpbmUgc28gaXQgY2Fubm90Cj4gPiBiZSBz
dWJtaXR0ZWQgYnkgYW5vdGhlciAoYW5kIHNvIHNjaGVkdWxlX291dCBjYWxsZWQpIHVudGlsIHRo
aXMgZW5naW5lCj4gPiBoYXMgcmVsZWFzZWQgaXQuCj4gPiAKPiA+IEl0IGlzIGEgd2VhayBwb2lu
dCBmb3IgZ2VuZXJhbGl0eSwgYnV0IHRoZSBvcmRlcmluZyBpcyBzdHJvbmcgaW4KPiA+IGV4ZWNs
aXN0cy4KPiA+IAo+ID4+PiArICAgICB3aGlsZSAoIXRyeV9jbXB4Y2hnKCZlbmdpbmUtPnJldGly
ZSwgJmZpcnN0LCB0bCkpOwo+ID4+Cj4gPj4gU28gdGhlIGxvb3AgaXMgZWZmZWN0aXZlbHkgY3Jl
YXRpbmcgYSBjaGFpbiBvZiB0aW1lbGluZXMgdG8gcmV0aXJlIG9uCj4gPj4gdGhpcyBlbmdpbmUu
Cj4gPj4KPiA+PiBXaGF0IGhhcHBlbnMgd2l0aCB2aXJ0dWFsIGVuZ2luZXMgd2hlbiBhIHRpbWVs
aW5lIGdvZXMgdG8gZGlmZmVyZW50Cj4gPj4gZW5naW5lIGJlZm9yZSAod2VsbCBvciBhbnkgc2lu
Z2xlIHRpbWVsaW5lIGNvbnRleHQpIHRoZSByZXRpcmUgd29ya2VyCj4gPj4gcnVucz8gQWggb2th
eSwgaXQgZ2V0cyByZS1hc3NpZ25lZCB0byB0aGUgbW9zdCByZWNlbnQgZW5naW5lLgo+ID4gCj4g
PiBSaWdodC4gVGhlIGVuZ2luZV9yZXRpcmUoKSBkb2Vzbid0IGNhcmUgd2hpY2ggZW5naW5lIHRo
ZSB0aW1lbGluZXMgd2VyZQo+ID4gcnVuIG9uLCBpdCdzIGp1c3QgYSBsaXN0IG9mIHN1c3BlY3Rl
ZCBpZGxlIHRpbWVsaW5lcy4KPiA+IAo+ID4+IEkgYW0gbm90IHN1cmUgYWJvdXQgdGhlIEJJVCgw
KSBidXNpbmVzcy4gSXQncyBhbHdheXMgc2V0IG9uIHdyaXRlIHNvIEkKPiA+PiBhbSBub3QgZ2V0
dGluZyB3aHkgaXQgaXMgdXNlZnVsLgo+ID4gCj4gPiBJdCdzIGFsc28gc2V0IHRvIDAgb24gY29u
c3VtcHRpb24gOikKPiAKPiBBbm90aGVyIHRoaW5nIC0gYXNzZXJ0IHRoYXQgZW5naW5lLT5yZXRp
cmUgaXMgTlVMTCBhZnRlciBmbHVzaF93b3JrIGluIAo+IGludGVsX2VuZ2luZV9maW5pX3JldGly
ZSBjb3VsZCBiZSB1c2VmdWwuCgpZdXAsIHdpbGNvLgotQ2hyaXMKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

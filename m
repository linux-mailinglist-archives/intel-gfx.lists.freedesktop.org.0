Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C68A52C33E
	for <lists+intel-gfx@lfdr.de>; Tue, 28 May 2019 11:30:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DA7436E1BA;
	Tue, 28 May 2019 09:30:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E521189D44
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 09:30:00 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16703188-1500050 
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 10:29:59 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 May 2019 10:29:47 +0100
Message-Id: <20190528092956.14910-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190528092956.14910-1-chris@chris-wilson.co.uk>
References: <20190528092956.14910-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 06/15] drm/i915: Move mmap and friends to its own
 file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29udGludWluZyB0aGUgZGVjbHV0dGVyaW5nIG9mIGk5MTVfZ2VtLmMsIG5vdyB0aGUgdHVybiBv
ZiBkb19tbWFwIGFuZAp0aGUgZmF1bHRoYW5kbGVycwoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2ls
c29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJldmlld2VkLWJ5OiBNYXR0aGV3IEF1bGQg
PG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZp
bGUgICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9tbWFuLmMgICAgICB8IDUwNyArKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAgNTYgKysKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCAgICB8ICAgNyArCiAuLi4vZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCA1MDMgKysrKysrKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDU2NCArLS0tLS0tLS0tLS0t
LS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3RpbGluZy5jICAgICAgICB8ICAg
MiArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMgIHwgNDg3
IC0tLS0tLS0tLS0tLS0tLQogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRl
c3RzLmggIHwgICAxICsKIDEwIGZpbGVzIGNoYW5nZWQsIDEwOTAgaW5zZXJ0aW9ucygrKSwgMTAz
OSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fbW1hbi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4
IGE1ODRmZmY1M2U2My4uNGMxNDYyOGRjOTQzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtODgs
NiArODgsNyBAQCBpOTE1LXkgKz0gJChndC15KQogb2JqLXkgKz0gZ2VtLwogZ2VtLXkgKz0gXAog
CWdlbS9pOTE1X2dlbV9vYmplY3QubyBcCisJZ2VtL2k5MTVfZ2VtX21tYW4ubyBcCiAJZ2VtL2k5
MTVfZ2VtX3BhZ2VzLm8gXAogCWdlbS9pOTE1X2dlbV9waHlzLm8gXAogCWdlbS9pOTE1X2dlbV9z
aG1lbS5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1h
bi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmM3YjliMzRkZTAxYgotLS0gL2Rldi9udWxs
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKQEAgLTAsMCAr
MSw1MDcgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29w
eXJpZ2h0IMKpIDIwMTQtMjAxNiBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxs
aW51eC9tbWFuLmg+CisjaW5jbHVkZSA8bGludXgvc2l6ZXMuaD4KKworI2luY2x1ZGUgImk5MTVf
ZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0LmgiCisjaW5jbHVkZSAiaTkxNV9nZW1faW9j
dGxzLmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fb2JqZWN0LmgiCisjaW5jbHVkZSAiaTkxNV92bWEu
aCIKKyNpbmNsdWRlICJpbnRlbF9kcnYuaCIKKworc3RhdGljIGlubGluZSBib29sCitfX3ZtYV9t
YXRjaGVzKHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hLCBzdHJ1Y3QgZmlsZSAqZmlscCwKKwkg
ICAgICB1bnNpZ25lZCBsb25nIGFkZHIsIHVuc2lnbmVkIGxvbmcgc2l6ZSkKK3sKKwlpZiAodm1h
LT52bV9maWxlICE9IGZpbHApCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiB2bWEtPnZtX3N0
YXJ0ID09IGFkZHIgJiYKKwkgICAgICAgKHZtYS0+dm1fZW5kIC0gdm1hLT52bV9zdGFydCkgPT0g
UEFHRV9BTElHTihzaXplKTsKK30KKworLyoqCisgKiBpOTE1X2dlbV9tbWFwX2lvY3RsIC0gTWFw
cyB0aGUgY29udGVudHMgb2YgYW4gb2JqZWN0LCByZXR1cm5pbmcgdGhlIGFkZHJlc3MKKyAqCQkJ
IGl0IGlzIG1hcHBlZCB0by4KKyAqIEBkZXY6IGRybSBkZXZpY2UKKyAqIEBkYXRhOiBpb2N0bCBk
YXRhIGJsb2IKKyAqIEBmaWxlOiBkcm0gZmlsZQorICoKKyAqIFdoaWxlIHRoZSBtYXBwaW5nIGhv
bGRzIGEgcmVmZXJlbmNlIG9uIHRoZSBjb250ZW50cyBvZiB0aGUgb2JqZWN0LCBpdCBkb2Vzbid0
CisgKiBpbXBseSBhIHJlZiBvbiB0aGUgb2JqZWN0IGl0c2VsZi4KKyAqCisgKiBJTVBPUlRBTlQ6
CisgKgorICogRFJNIGRyaXZlciB3cml0ZXJzIHdobyBsb29rIGEgdGhpcyBmdW5jdGlvbiBhcyBh
biBleGFtcGxlIGZvciBob3cgdG8gZG8gR0VNCisgKiBtbWFwIHN1cHBvcnQsIHBsZWFzZSBkb24n
dCBpbXBsZW1lbnQgbW1hcCBzdXBwb3J0IGxpa2UgaGVyZS4gVGhlIG1vZGVybiB3YXkKKyAqIHRv
IGltcGxlbWVudCBEUk0gbW1hcCBzdXBwb3J0IGlzIHdpdGggYW4gbW1hcCBvZmZzZXQgaW9jdGwg
KGxpa2UKKyAqIGk5MTVfZ2VtX21tYXBfZ3R0KSBhbmQgdGhlbiB1c2luZyB0aGUgbW1hcCBzeXNj
YWxsIG9uIHRoZSBEUk0gZmQgZGlyZWN0bHkuCisgKiBUaGF0IHdheSBkZWJ1ZyB0b29saW5nIGxp
a2UgdmFsZ3JpbmQgd2lsbCB1bmRlcnN0YW5kIHdoYXQncyBnb2luZyBvbiwgaGlkaW5nCisgKiB0
aGUgbW1hcCBjYWxsIGluIGEgZHJpdmVyIHByaXZhdGUgaW9jdGwgd2lsbCBicmVhayB0aGF0LiBU
aGUgaTkxNSBkcml2ZXIgb25seQorICogZG9lcyBjcHUgbW1hcHMgdGhpcyB3YXkgYmVjYXVzZSB3
ZSBkaWRuJ3Qga25vdyBiZXR0ZXIuCisgKi8KK2ludAoraTkxNV9nZW1fbW1hcF9pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAorCQkgICAgc3RydWN0IGRybV9maWxlICpm
aWxlKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fbW1hcCAqYXJncyA9IGRhdGE7CisJc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwl1bnNpZ25lZCBsb25nIGFkZHI7CisKKwlpZiAo
YXJncy0+ZmxhZ3MgJiB+KEk5MTVfTU1BUF9XQykpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYg
KGFyZ3MtPmZsYWdzICYgSTkxNV9NTUFQX1dDICYmICFib290X2NwdV9oYXMoWDg2X0ZFQVRVUkVf
UEFUKSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfbG9va3Vw
KGZpbGUsIGFyZ3MtPmhhbmRsZSk7CisJaWYgKCFvYmopCisJCXJldHVybiAtRU5PRU5UOworCisJ
LyogcHJpbWUgb2JqZWN0cyBoYXZlIG5vIGJhY2tpbmcgZmlscCB0byBHRU0gbW1hcAorCSAqIHBh
Z2VzIGZyb20uCisJICovCisJaWYgKCFvYmotPmJhc2UuZmlscCkgeworCQlhZGRyID0gLUVOWElP
OworCQlnb3RvIGVycjsKKwl9CisKKwlpZiAocmFuZ2Vfb3ZlcmZsb3dzKGFyZ3MtPm9mZnNldCwg
YXJncy0+c2l6ZSwgKHU2NClvYmotPmJhc2Uuc2l6ZSkpIHsKKwkJYWRkciA9IC1FSU5WQUw7CisJ
CWdvdG8gZXJyOworCX0KKworCWFkZHIgPSB2bV9tbWFwKG9iai0+YmFzZS5maWxwLCAwLCBhcmdz
LT5zaXplLAorCQkgICAgICAgUFJPVF9SRUFEIHwgUFJPVF9XUklURSwgTUFQX1NIQVJFRCwKKwkJ
ICAgICAgIGFyZ3MtPm9mZnNldCk7CisJaWYgKElTX0VSUl9WQUxVRShhZGRyKSkKKwkJZ290byBl
cnI7CisKKwlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X01NQVBfV0MpIHsKKwkJc3RydWN0IG1tX3N0
cnVjdCAqbW0gPSBjdXJyZW50LT5tbTsKKwkJc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWE7CisK
KwkJaWYgKGRvd25fd3JpdGVfa2lsbGFibGUoJm1tLT5tbWFwX3NlbSkpIHsKKwkJCWFkZHIgPSAt
RUlOVFI7CisJCQlnb3RvIGVycjsKKwkJfQorCQl2bWEgPSBmaW5kX3ZtYShtbSwgYWRkcik7CisJ
CWlmICh2bWEgJiYgX192bWFfbWF0Y2hlcyh2bWEsIG9iai0+YmFzZS5maWxwLCBhZGRyLCBhcmdz
LT5zaXplKSkKKwkJCXZtYS0+dm1fcGFnZV9wcm90ID0KKwkJCQlwZ3Byb3Rfd3JpdGVjb21iaW5l
KHZtX2dldF9wYWdlX3Byb3Qodm1hLT52bV9mbGFncykpOworCQllbHNlCisJCQlhZGRyID0gLUVO
T01FTTsKKwkJdXBfd3JpdGUoJm1tLT5tbWFwX3NlbSk7CisJCWlmIChJU19FUlJfVkFMVUUoYWRk
cikpCisJCQlnb3RvIGVycjsKKworCQkvKiBUaGlzIG1heSByYWNlLCBidXQgdGhhdCdzIG9rLCBp
dCBvbmx5IGdldHMgc2V0ICovCisJCVdSSVRFX09OQ0Uob2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29y
aWdpbiwgT1JJR0lOX0NQVSk7CisJfQorCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKworCWFy
Z3MtPmFkZHJfcHRyID0gKHU2NClhZGRyOworCXJldHVybiAwOworCitlcnI6CisJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOworCXJldHVybiBhZGRyOworfQorCitzdGF0aWMgdW5zaWduZWQgaW50
IHRpbGVfcm93X3BhZ2VzKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7
CisJcmV0dXJuIGk5MTVfZ2VtX29iamVjdF9nZXRfdGlsZV9yb3dfc2l6ZShvYmopID4+IFBBR0Vf
U0hJRlQ7Cit9CisKKy8qKgorICogaTkxNV9nZW1fbW1hcF9ndHRfdmVyc2lvbiAtIHJlcG9ydCB0
aGUgY3VycmVudCBmZWF0dXJlIHNldCBmb3IgR1RUIG1tYXBzCisgKgorICogQSBoaXN0b3J5IG9m
IHRoZSBHVFQgbW1hcCBpbnRlcmZhY2U6CisgKgorICogMCAtIEV2ZXJ5dGhpbmcgaGFkIHRvIGZp
dCBpbnRvIHRoZSBHVFQuIEJvdGggcGFydGllcyBvZiBhIG1lbWNweSBoYWQgdG8KKyAqICAgICBh
bGlnbmVkIGFuZCBzdWl0YWJsZSBmb3IgZmVuY2luZywgYW5kIHN0aWxsIGZpdCBpbnRvIHRoZSBh
dmFpbGFibGUKKyAqICAgICBtYXBwYWJsZSBzcGFjZSBsZWZ0IGJ5IHRoZSBwaW5uZWQgZGlzcGxh
eSBvYmplY3RzLiBBIGNsYXNzaWMgcHJvYmxlbQorICogICAgIHdlIGNhbGxlZCB0aGUgcGFnZS1m
YXVsdC1vZi1kb29tIHdoZXJlIHdlIHdvdWxkIHBpbmctcG9uZyBiZXR3ZWVuCisgKiAgICAgdHdv
IG9iamVjdHMgdGhhdCBjb3VsZCBub3QgZml0IGluc2lkZSB0aGUgR1RUIGFuZCBzbyB0aGUgbWVt
Y3B5CisgKiAgICAgd291bGQgcGFnZSBvbmUgb2JqZWN0IGluIGF0IHRoZSBleHBlbnNlIG9mIHRo
ZSBvdGhlciBiZXR3ZWVuIGV2ZXJ5CisgKiAgICAgc2luZ2xlIGJ5dGUuCisgKgorICogMSAtIE9i
amVjdHMgY2FuIGJlIGFueSBzaXplLCBhbmQgaGF2ZSBhbnkgY29tcGF0aWJsZSBmZW5jaW5nIChY
IFksIG9yIG5vbmUKKyAqICAgICBhcyBzZXQgdmlhIGk5MTVfZ2VtX3NldF90aWxpbmcoKSBbRFJN
X0k5MTVfR0VNX1NFVF9USUxJTkddKS4gSWYgdGhlCisgKiAgICAgb2JqZWN0IGlzIHRvbyBsYXJn
ZSBmb3IgdGhlIGF2YWlsYWJsZSBzcGFjZSAob3Igc2ltcGx5IHRvbyBsYXJnZQorICogICAgIGZv
ciB0aGUgbWFwcGFibGUgYXBlcnR1cmUhKSwgYSB2aWV3IGlzIGNyZWF0ZWQgaW5zdGVhZCBhbmQg
ZmF1bHRlZAorICogICAgIGludG8gdXNlcnNwYWNlLiAoVGhpcyB2aWV3IGlzIGFsaWduZWQgYW5k
IHNpemVkIGFwcHJvcHJpYXRlbHkgZm9yCisgKiAgICAgZmVuY2VkIGFjY2Vzcy4pCisgKgorICog
MiAtIFJlY29nbmlzZSBXQyBhcyBhIHNlcGFyYXRlIGNhY2hlIGRvbWFpbiBzbyB0aGF0IHdlIGNh
biBmbHVzaCB0aGUKKyAqICAgICBkZWxheWVkIHdyaXRlcyB2aWEgR1RUIGJlZm9yZSBwZXJmb3Jt
aW5nIGRpcmVjdCBhY2Nlc3MgdmlhIFdDLgorICoKKyAqIDMgLSBSZW1vdmUgaW1wbGljaXQgc2V0
LWRvbWFpbihHVFQpIGFuZCBzeW5jaHJvbmlzYXRpb24gb24gaW5pdGlhbAorICogICAgIHBhZ2Vm
YXVsdDsgc3dhcGluIHJlbWFpbnMgdHJhbnNwYXJlbnQuCisgKgorICogUmVzdHJpY3Rpb25zOgor
ICoKKyAqICAqIHNub29wYWJsZSBvYmplY3RzIGNhbm5vdCBiZSBhY2Nlc3NlZCB2aWEgdGhlIEdU
VC4gSXQgY2FuIGNhdXNlIG1hY2hpbmUKKyAqICAgIGhhbmdzIG9uIHNvbWUgYXJjaGl0ZWN0dXJl
cywgY29ycnVwdGlvbiBvbiBvdGhlcnMuIEFuIGF0dGVtcHQgdG8gc2VydmljZQorICogICAgYSBH
VFQgcGFnZSBmYXVsdCBmcm9tIGEgc25vb3BhYmxlIG9iamVjdCB3aWxsIGdlbmVyYXRlIGEgU0lH
QlVTLgorICoKKyAqICAqIHRoZSBvYmplY3QgbXVzdCBiZSBhYmxlIHRvIGZpdCBpbnRvIFJBTSAo
cGh5c2ljYWwgbWVtb3J5LCB0aG91Z2ggbm8KKyAqICAgIGxpbWl0ZWQgdG8gdGhlIG1hcHBhYmxl
IGFwZXJ0dXJlKS4KKyAqCisgKgorICogQ2F2ZWF0czoKKyAqCisgKiAgKiBhIG5ldyBHVFQgcGFn
ZSBmYXVsdCB3aWxsIHN5bmNocm9uaXplIHJlbmRlcmluZyBmcm9tIHRoZSBHUFUgYW5kIGZsdXNo
CisgKiAgICBhbGwgZGF0YSB0byBzeXN0ZW0gbWVtb3J5LiBTdWJzZXF1ZW50IGFjY2VzcyB3aWxs
IG5vdCBiZSBzeW5jaHJvbml6ZWQuCisgKgorICogICogYWxsIG1hcHBpbmdzIGFyZSByZXZva2Vk
IG9uIHJ1bnRpbWUgZGV2aWNlIHN1c3BlbmQuCisgKgorICogICogdGhlcmUgYXJlIG9ubHkgOCwg
MTYgb3IgMzIgZmVuY2UgcmVnaXN0ZXJzIHRvIHNoYXJlIGJldHdlZW4gYWxsIHVzZXJzCisgKiAg
ICAob2xkZXIgbWFjaGluZXMgcmVxdWlyZSBmZW5jZSByZWdpc3RlciBmb3IgZGlzcGxheSBhbmQg
YmxpdHRlciBhY2Nlc3MKKyAqICAgIGFzIHdlbGwpLiBDb250ZW50aW9uIG9mIHRoZSBmZW5jZSBy
ZWdpc3RlcnMgd2lsbCBjYXVzZSB0aGUgcHJldmlvdXMgdXNlcnMKKyAqICAgIHRvIGJlIHVubWFw
cGVkIGFuZCBhbnkgbmV3IGFjY2VzcyB3aWxsIGdlbmVyYXRlIG5ldyBwYWdlIGZhdWx0cy4KKyAq
CisgKiAgKiBydW5uaW5nIG91dCBvZiBtZW1vcnkgd2hpbGUgc2VydmljaW5nIGEgZmF1bHQgbWF5
IGdlbmVyYXRlIGEgU0lHQlVTLAorICogICAgcmF0aGVyIHRoYW4gdGhlIGV4cGVjdGVkIFNJR1NF
R1YuCisgKi8KK2ludCBpOTE1X2dlbV9tbWFwX2d0dF92ZXJzaW9uKHZvaWQpCit7CisJcmV0dXJu
IDM7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfZ2d0dF92aWV3Citjb21wdXRlX3Bh
cnRpYWxfdmlldyhjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkgICAg
IHBnb2ZmX3QgcGFnZV9vZmZzZXQsCisJCSAgICAgdW5zaWduZWQgaW50IGNodW5rKQoreworCXN0
cnVjdCBpOTE1X2dndHRfdmlldyB2aWV3OworCisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc190aWxl
ZChvYmopKQorCQljaHVuayA9IHJvdW5kdXAoY2h1bmssIHRpbGVfcm93X3BhZ2VzKG9iaikpOwor
CisJdmlldy50eXBlID0gSTkxNV9HR1RUX1ZJRVdfUEFSVElBTDsKKwl2aWV3LnBhcnRpYWwub2Zm
c2V0ID0gcm91bmRkb3duKHBhZ2Vfb2Zmc2V0LCBjaHVuayk7CisJdmlldy5wYXJ0aWFsLnNpemUg
PQorCQltaW5fdCh1bnNpZ25lZCBpbnQsIGNodW5rLAorCQkgICAgICAob2JqLT5iYXNlLnNpemUg
Pj4gUEFHRV9TSElGVCkgLSB2aWV3LnBhcnRpYWwub2Zmc2V0KTsKKworCS8qIElmIHRoZSBwYXJ0
aWFsIGNvdmVycyB0aGUgZW50aXJlIG9iamVjdCwganVzdCBjcmVhdGUgYSBub3JtYWwgVk1BLiAq
LworCWlmIChjaHVuayA+PSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUKQorCQl2aWV3LnR5
cGUgPSBJOTE1X0dHVFRfVklFV19OT1JNQUw7CisKKwlyZXR1cm4gdmlldzsKK30KKworLyoqCisg
KiBpOTE1X2dlbV9mYXVsdCAtIGZhdWx0IGEgcGFnZSBpbnRvIHRoZSBHVFQKKyAqIEB2bWY6IGZh
dWx0IGluZm8KKyAqCisgKiBUaGUgZmF1bHQgaGFuZGxlciBpcyBzZXQgdXAgYnkgZHJtX2dlbV9t
bWFwKCkgd2hlbiBhIG9iamVjdCBpcyBHVFQgbWFwcGVkCisgKiBmcm9tIHVzZXJzcGFjZS4gIFRo
ZSBmYXVsdCBoYW5kbGVyIHRha2VzIGNhcmUgb2YgYmluZGluZyB0aGUgb2JqZWN0IHRvCisgKiB0
aGUgR1RUIChpZiBuZWVkZWQpLCBhbGxvY2F0aW5nIGFuZCBwcm9ncmFtbWluZyBhIGZlbmNlIHJl
Z2lzdGVyIChhZ2FpbiwKKyAqIG9ubHkgaWYgbmVlZGVkIGJhc2VkIG9uIHdoZXRoZXIgdGhlIG9s
ZCByZWcgaXMgc3RpbGwgdmFsaWQgb3IgdGhlIG9iamVjdAorICogaXMgdGlsZWQpIGFuZCBpbnNl
cnRpbmcgYSBuZXcgUFRFIGludG8gdGhlIGZhdWx0aW5nIHByb2Nlc3MuCisgKgorICogTm90ZSB0
aGF0IHRoZSBmYXVsdGluZyBwcm9jZXNzIG1heSBpbnZvbHZlIGV2aWN0aW5nIGV4aXN0aW5nIG9i
amVjdHMKKyAqIGZyb20gdGhlIEdUVCBhbmQvb3IgZmVuY2UgcmVnaXN0ZXJzIHRvIG1ha2Ugcm9v
bS4gIFNvIHBlcmZvcm1hbmNlIG1heQorICogc3VmZmVyIGlmIHRoZSBHVFQgd29ya2luZyBzZXQg
aXMgbGFyZ2Ugb3IgdGhlcmUgYXJlIGZldyBmZW5jZSByZWdpc3RlcnMKKyAqIGxlZnQuCisgKgor
ICogVGhlIGN1cnJlbnQgZmVhdHVyZSBzZXQgc3VwcG9ydGVkIGJ5IGk5MTVfZ2VtX2ZhdWx0KCkg
YW5kIHRodXMgR1RUIG1tYXBzCisgKiBpcyBleHBvc2VkIHZpYSBJOTE1X1BBUkFNX01NQVBfR1RU
X1ZFUlNJT04gKHNlZSBpOTE1X2dlbV9tbWFwX2d0dF92ZXJzaW9uKS4KKyAqLwordm1fZmF1bHRf
dCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKK3sKKyNkZWZpbmUgTUlOX0NI
VU5LX1BBR0VTIChTWl8xTSA+PiBQQUdFX1NISUZUKQorCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAq
YXJlYSA9IHZtZi0+dm1hOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB0b19p
bnRlbF9ibyhhcmVhLT52bV9wcml2YXRlX2RhdGEpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBvYmotPmJhc2UuZGV2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShkZXYpOworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKKwlib29sIHdy
aXRlID0gYXJlYS0+dm1fZmxhZ3MgJiBWTV9XUklURTsKKwlpbnRlbF93YWtlcmVmX3Qgd2FrZXJl
ZjsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlwZ29mZl90IHBhZ2Vfb2Zmc2V0OworCWludCBz
cmN1OworCWludCByZXQ7CisKKwkvKiBTYW5pdHkgY2hlY2sgdGhhdCB3ZSBhbGxvdyB3cml0aW5n
IGludG8gdGhpcyBvYmplY3QgKi8KKwlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3JlYWRvbmx5KG9i
aikgJiYgd3JpdGUpCisJCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7CisKKwkvKiBXZSBkb24ndCB1
c2Ugdm1mLT5wZ29mZiBzaW5jZSB0aGF0IGhhcyB0aGUgZmFrZSBvZmZzZXQgKi8KKwlwYWdlX29m
ZnNldCA9ICh2bWYtPmFkZHJlc3MgLSBhcmVhLT52bV9zdGFydCkgPj4gUEFHRV9TSElGVDsKKwor
CXRyYWNlX2k5MTVfZ2VtX29iamVjdF9mYXVsdChvYmosIHBhZ2Vfb2Zmc2V0LCB0cnVlLCB3cml0
ZSk7CisKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKHJldCkK
KwkJZ290byBlcnI7CisKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CisK
KwlzcmN1ID0gaTkxNV9yZXNldF90cnlsb2NrKGk5MTUpOworCWlmIChzcmN1IDwgMCkgeworCQly
ZXQgPSBzcmN1OworCQlnb3RvIGVycl9ycG07CisJfQorCisJcmV0ID0gaTkxNV9tdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoZGV2KTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9yZXNldDsKKworCS8q
IEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlzIGluY29oZXJlbnQu
ICovCisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9OT05FICYmICFIQVNfTExD
KGk5MTUpKSB7CisJCXJldCA9IC1FRkFVTFQ7CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwkv
KiBOb3cgcGluIGl0IGludG8gdGhlIEdUVCBhcyBuZWVkZWQgKi8KKwl2bWEgPSBpOTE1X2dlbV9v
YmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLAorCQkJCSAgICAgICBQSU5fTUFQUEFCTEUg
fAorCQkJCSAgICAgICBQSU5fTk9OQkxPQ0sgfAorCQkJCSAgICAgICBQSU5fTk9ORkFVTFQpOwor
CWlmIChJU19FUlIodm1hKSkgeworCQkvKiBVc2UgYSBwYXJ0aWFsIHZpZXcgaWYgaXQgaXMgYmln
Z2VyIHRoYW4gYXZhaWxhYmxlIHNwYWNlICovCisJCXN0cnVjdCBpOTE1X2dndHRfdmlldyB2aWV3
ID0KKwkJCWNvbXB1dGVfcGFydGlhbF92aWV3KG9iaiwgcGFnZV9vZmZzZXQsIE1JTl9DSFVOS19Q
QUdFUyk7CisJCXVuc2lnbmVkIGludCBmbGFnczsKKworCQlmbGFncyA9IFBJTl9NQVBQQUJMRTsK
KwkJaWYgKHZpZXcudHlwZSA9PSBJOTE1X0dHVFRfVklFV19OT1JNQUwpCisJCQlmbGFncyB8PSBQ
SU5fTk9OQkxPQ0s7IC8qIGF2b2lkIHdhcm5pbmdzIGZvciBwaW5uZWQgKi8KKworCQkvKgorCQkg
KiBVc2Vyc3BhY2UgaXMgbm93IHdyaXRpbmcgdGhyb3VnaCBhbiB1bnRyYWNrZWQgVk1BLCBhYmFu
ZG9uCisJCSAqIGFsbCBob3BlIHRoYXQgdGhlIGhhcmR3YXJlIGlzIGFibGUgdG8gdHJhY2sgZnV0
dXJlIHdyaXRlcy4KKwkJICovCisJCW9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4gPSBPUklH
SU5fQ1BVOworCisJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosICZ2aWV3LCAw
LCAwLCBmbGFncyk7CisJCWlmIChJU19FUlIodm1hKSAmJiAhdmlldy50eXBlKSB7CisJCQlmbGFn
cyA9IFBJTl9NQVBQQUJMRTsKKwkJCXZpZXcudHlwZSA9IEk5MTVfR0dUVF9WSUVXX1BBUlRJQUw7
CisJCQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCAmdmlldywgMCwgMCwgZmxh
Z3MpOworCQl9CisJfQorCWlmIChJU19FUlIodm1hKSkgeworCQlyZXQgPSBQVFJfRVJSKHZtYSk7
CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwlyZXQgPSBpOTE1X3ZtYV9waW5fZmVuY2Uodm1h
KTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl91bnBpbjsKKworCS8qIEZpbmFsbHksIHJlbWFwIGl0
IHVzaW5nIHRoZSBuZXcgR1RUIG9mZnNldCAqLworCXJldCA9IHJlbWFwX2lvX21hcHBpbmcoYXJl
YSwKKwkJCSAgICAgICBhcmVhLT52bV9zdGFydCArICh2bWEtPmdndHRfdmlldy5wYXJ0aWFsLm9m
ZnNldCA8PCBQQUdFX1NISUZUKSwKKwkJCSAgICAgICAoZ2d0dC0+Z21hZHIuc3RhcnQgKyB2bWEt
Pm5vZGUuc3RhcnQpID4+IFBBR0VfU0hJRlQsCisJCQkgICAgICAgbWluX3QodTY0LCB2bWEtPnNp
emUsIGFyZWEtPnZtX2VuZCAtIGFyZWEtPnZtX3N0YXJ0KSwKKwkJCSAgICAgICAmZ2d0dC0+aW9t
YXApOworCWlmIChyZXQpCisJCWdvdG8gZXJyX2ZlbmNlOworCisJLyogTWFyayBhcyBiZWluZyBt
bWFwcGVkIGludG8gdXNlcnNwYWNlIGZvciBsYXRlciByZXZvY2F0aW9uICovCisJYXNzZXJ0X3Jw
bV93YWtlbG9ja19oZWxkKGk5MTUpOworCWlmICghaTkxNV92bWFfc2V0X3VzZXJmYXVsdCh2bWEp
ICYmICFvYmotPnVzZXJmYXVsdF9jb3VudCsrKQorCQlsaXN0X2FkZCgmb2JqLT51c2VyZmF1bHRf
bGluaywgJmk5MTUtPm1tLnVzZXJmYXVsdF9saXN0KTsKKwlpZiAoQ09ORklHX0RSTV9JOTE1X1VT
RVJGQVVMVF9BVVRPU1VTUEVORCkKKwkJaW50ZWxfd2FrZXJlZl9hdXRvKCZpOTE1LT5tbS51c2Vy
ZmF1bHRfd2FrZXJlZiwKKwkJCQkgICBtc2Vjc190b19qaWZmaWVzX3RpbWVvdXQoQ09ORklHX0RS
TV9JOTE1X1VTRVJGQVVMVF9BVVRPU1VTUEVORCkpOworCUdFTV9CVUdfT04oIW9iai0+dXNlcmZh
dWx0X2NvdW50KTsKKworCWk5MTVfdm1hX3NldF9nZ3R0X3dyaXRlKHZtYSk7CisKK2Vycl9mZW5j
ZToKKwlpOTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOworZXJyX3VucGluOgorCV9faTkxNV92bWFf
dW5waW4odm1hKTsKK2Vycl91bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRl
eCk7CitlcnJfcmVzZXQ6CisJaTkxNV9yZXNldF91bmxvY2soaTkxNSwgc3JjdSk7CitlcnJfcnBt
OgorCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOworCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9wYWdlcyhvYmopOworZXJyOgorCXN3aXRjaCAocmV0KSB7CisJY2FzZSAtRUlPOgor
CQkvKgorCQkgKiBXZSBlYXQgZXJyb3JzIHdoZW4gdGhlIGdwdSBpcyB0ZXJtaW5hbGx5IHdlZGdl
ZCB0byBhdm9pZAorCQkgKiB1c2Vyc3BhY2UgdW5kdWx5IGNyYXNoaW5nIChnbCBoYXMgbm8gcHJv
dmlzaW9ucyBmb3IgbW1hcHMgdG8KKwkJICogZmFpbCkuIEJ1dCBhbnkgb3RoZXIgLUVJTyBpc24n
dCBvdXJzIChlLmcuIHN3YXAgaW4gZmFpbHVyZSkKKwkJICogYW5kIHNvIG5lZWRzIHRvIGJlIHJl
cG9ydGVkLgorCQkgKi8KKwkJaWYgKCFpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQorCQkJ
cmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKKwkJLyogZWxzZTogZmFsbCB0aHJvdWdoICovCisJY2Fz
ZSAtRUFHQUlOOgorCQkvKgorCQkgKiBFQUdBSU4gbWVhbnMgdGhlIGdwdSBpcyBodW5nIGFuZCB3
ZSdsbCB3YWl0IGZvciB0aGUgZXJyb3IKKwkJICogaGFuZGxlciB0byByZXNldCBldmVyeXRoaW5n
IHdoZW4gcmUtZmF1bHRpbmcgaW4KKwkJICogaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUu
CisJCSAqLworCWNhc2UgMDoKKwljYXNlIC1FUkVTVEFSVFNZUzoKKwljYXNlIC1FSU5UUjoKKwlj
YXNlIC1FQlVTWToKKwkJLyoKKwkJICogRUJVU1kgaXMgb2s6IHRoaXMganVzdCBtZWFucyB0aGF0
IGFub3RoZXIgdGhyZWFkCisJCSAqIGFscmVhZHkgZGlkIHRoZSBqb2IuCisJCSAqLworCQlyZXR1
cm4gVk1fRkFVTFRfTk9QQUdFOworCWNhc2UgLUVOT01FTToKKwkJcmV0dXJuIFZNX0ZBVUxUX09P
TTsKKwljYXNlIC1FTk9TUEM6CisJY2FzZSAtRUZBVUxUOgorCQlyZXR1cm4gVk1fRkFVTFRfU0lH
QlVTOworCWRlZmF1bHQ6CisJCVdBUk5fT05DRShyZXQsICJ1bmhhbmRsZWQgZXJyb3IgaW4gJXM6
ICVpXG4iLCBfX2Z1bmNfXywgcmV0KTsKKwkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKKwl9Cit9
CisKK3ZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCit7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisKKwlHRU1fQlVHX09O
KCFvYmotPnVzZXJmYXVsdF9jb3VudCk7CisKKwlvYmotPnVzZXJmYXVsdF9jb3VudCA9IDA7CisJ
bGlzdF9kZWwoJm9iai0+dXNlcmZhdWx0X2xpbmspOworCWRybV92bWFfbm9kZV91bm1hcCgmb2Jq
LT5iYXNlLnZtYV9ub2RlLAorCQkJICAgb2JqLT5iYXNlLmRldi0+YW5vbl9pbm9kZS0+aV9tYXBw
aW5nKTsKKworCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKQorCQlpOTE1X3ZtYV91bnNldF91
c2VyZmF1bHQodm1hKTsKK30KKworLyoqCisgKiBpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFw
IC0gcmVtb3ZlIHBoeXNpY2FsIHBhZ2UgbWFwcGluZ3MKKyAqIEBvYmo6IG9iaiBpbiBxdWVzdGlv
bgorICoKKyAqIFByZXNlcnZlIHRoZSByZXNlcnZhdGlvbiBvZiB0aGUgbW1hcHBpbmcgd2l0aCB0
aGUgRFJNIGNvcmUgY29kZSwgYnV0CisgKiByZWxpbnF1aXNoIG93bmVyc2hpcCBvZiB0aGUgcGFn
ZXMgYmFjayB0byB0aGUgc3lzdGVtLgorICoKKyAqIEl0IGlzIHZpdGFsIHRoYXQgd2UgcmVtb3Zl
IHRoZSBwYWdlIG1hcHBpbmcgaWYgd2UgaGF2ZSBtYXBwZWQgYSB0aWxlZAorICogb2JqZWN0IHRo
cm91Z2ggdGhlIEdUVCBhbmQgdGhlbiBsb3NlIHRoZSBmZW5jZSByZWdpc3RlciBkdWUgdG8KKyAq
IHJlc291cmNlIHByZXNzdXJlLiBTaW1pbGFybHkgaWYgdGhlIG9iamVjdCBoYXMgYmVlbiBtb3Zl
ZCBvdXQgb2YgdGhlCisgKiBhcGVydHVyZSwgdGhhbiBwYWdlcyBtYXBwZWQgaW50byB1c2Vyc3Bh
Y2UgbXVzdCBiZSByZXZva2VkLiBSZW1vdmluZyB0aGUKKyAqIG1hcHBpbmcgd2lsbCB0aGVuIHRy
aWdnZXIgYSBwYWdlIGZhdWx0IG9uIHRoZSBuZXh0IHVzZXIgYWNjZXNzLCBhbGxvd2luZworICog
Zml4dXAgYnkgaTkxNV9nZW1fZmF1bHQoKS4KKyAqLwordm9pZCBpOTE1X2dlbV9vYmplY3RfcmVs
ZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCWludGVsX3dh
a2VyZWZfdCB3YWtlcmVmOworCisJLyogU2VyaWFsaXNhdGlvbiBiZXR3ZWVuIHVzZXIgR1RUIGFj
Y2VzcyBhbmQgb3VyIGNvZGUgZGVwZW5kcyB1cG9uCisJICogcmV2b2tpbmcgdGhlIENQVSdzIFBU
RSB3aGlsc3QgdGhlIG11dGV4IGlzIGhlbGQuIFRoZSBuZXh0IHVzZXIKKwkgKiBwYWdlZmF1bHQg
dGhlbiBoYXMgdG8gd2FpdCB1bnRpbCB3ZSByZWxlYXNlIHRoZSBtdXRleC4KKwkgKgorCSAqIE5v
dGUgdGhhdCBSUE0gY29tcGxpY2F0ZXMgc29tZXdoYXQgYnkgYWRkaW5nIGFuIGFkZGl0aW9uYWwK
KwkgKiByZXF1aXJlbWVudCB0aGF0IG9wZXJhdGlvbnMgdG8gdGhlIEdHVFQgYmUgbWFkZSBob2xk
aW5nIHRoZSBSUE0KKwkgKiB3YWtlcmVmLgorCSAqLworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChp
OTE1KTsKKworCWlmICghb2JqLT51c2VyZmF1bHRfY291bnQpCisJCWdvdG8gb3V0OworCisJX19p
OTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKG9iaik7CisKKwkvKiBFbnN1cmUgdGhhdCB0aGUg
Q1BVJ3MgUFRFIGFyZSByZXZva2VkIGFuZCB0aGVyZSBhcmUgbm90IG91dHN0YW5kaW5nCisJICog
bWVtb3J5IHRyYW5zYWN0aW9ucyBmcm9tIHVzZXJzcGFjZSBiZWZvcmUgd2UgcmV0dXJuLiBUaGUg
VExCCisJICogZmx1c2hpbmcgaW1wbGllZCBhYm92ZSBieSBjaGFuZ2luZyB0aGUgUFRFIGFib3Zl
ICpzaG91bGQqIGJlCisJICogc3VmZmljaWVudCwgYW4gZXh0cmEgYmFycmllciBoZXJlIGp1c3Qg
cHJvdmlkZXMgdXMgd2l0aCBhIGJpdAorCSAqIG9mIHBhcmFub2lkIGRvY3VtZW50YXRpb24gYWJv
dXQgb3VyIHJlcXVpcmVtZW50IHRvIHNlcmlhbGlzZQorCSAqIG1lbW9yeSB3cml0ZXMgYmVmb3Jl
IHRvdWNoaW5nIHJlZ2lzdGVycyAvIEdTTS4KKwkgKi8KKwl3bWIoKTsKKworb3V0OgorCWludGVs
X3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOworfQorCitzdGF0aWMgaW50IGNyZWF0ZV9t
bWFwX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwlpbnQgZXJy
OworCisJZXJyID0gZHJtX2dlbV9jcmVhdGVfbW1hcF9vZmZzZXQoJm9iai0+YmFzZSk7CisJaWYg
KGxpa2VseSghZXJyKSkKKwkJcmV0dXJuIDA7CisKKwkvKiBBdHRlbXB0IHRvIHJlYXAgc29tZSBt
bWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3RzICovCisJZG8geworCQllcnIgPSBpOTE1X2dlbV93
YWl0X2Zvcl9pZGxlKGk5MTUsCisJCQkJCSAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCisJ
CQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisK
KwkJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKKwkJZXJyID0gZHJtX2dlbV9j
cmVhdGVfbW1hcF9vZmZzZXQoJm9iai0+YmFzZSk7CisJCWlmICghZXJyKQorCQkJYnJlYWs7CisK
Kwl9IHdoaWxlIChmbHVzaF9kZWxheWVkX3dvcmsoJmk5MTUtPmdlbS5yZXRpcmVfd29yaykpOwor
CisJcmV0dXJuIGVycjsKK30KKworaW50CitpOTE1X2dlbV9tbWFwX2d0dChzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUsCisJCSAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJICB1MzIgaGFuZGxlLAor
CQkgIHU2NCAqb2Zmc2V0KQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJ
aW50IHJldDsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXAoZmlsZSwgaGFuZGxlKTsK
KwlpZiAoIW9iaikKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwlyZXQgPSBjcmVhdGVfbW1hcF9vZmZz
ZXQob2JqKTsKKwlpZiAocmV0ID09IDApCisJCSpvZmZzZXQgPSBkcm1fdm1hX25vZGVfb2Zmc2V0
X2FkZHIoJm9iai0+YmFzZS52bWFfbm9kZSk7CisKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7
CisJcmV0dXJuIHJldDsKK30KKworLyoqCisgKiBpOTE1X2dlbV9tbWFwX2d0dF9pb2N0bCAtIHBy
ZXBhcmUgYW4gb2JqZWN0IGZvciBHVFQgbW1hcCdpbmcKKyAqIEBkZXY6IERSTSBkZXZpY2UKKyAq
IEBkYXRhOiBHVFQgbWFwcGluZyBpb2N0bCBkYXRhCisgKiBAZmlsZTogR0VNIG9iamVjdCBpbmZv
CisgKgorICogU2ltcGx5IHJldHVybnMgdGhlIGZha2Ugb2Zmc2V0IHRvIHVzZXJzcGFjZSBzbyBp
dCBjYW4gbW1hcCBpdC4KKyAqIFRoZSBtbWFwIGNhbGwgd2lsbCBlbmQgdXAgaW4gZHJtX2dlbV9t
bWFwKCksIHdoaWNoIHdpbGwgc2V0IHRoaW5ncworICogdXAgc28gd2UgY2FuIGdldCBmYXVsdHMg
aW4gdGhlIGhhbmRsZXIgYWJvdmUuCisgKgorICogVGhlIGZhdWx0IGhhbmRsZXIgd2lsbCB0YWtl
IGNhcmUgb2YgYmluZGluZyB0aGUgb2JqZWN0IGludG8gdGhlIEdUVAorICogKHNpbmNlIGl0IG1h
eSBoYXZlIGJlZW4gZXZpY3RlZCB0byBtYWtlIHJvb20gZm9yIHNvbWV0aGluZyksIGFsbG9jYXRp
bmcKKyAqIGEgZmVuY2UgcmVnaXN0ZXIsIGFuZCBtYXBwaW5nIHRoZSBhcHByb3ByaWF0ZSBhcGVy
dHVyZSBhZGRyZXNzIGludG8KKyAqIHVzZXJzcGFjZS4KKyAqLworaW50CitpOTE1X2dlbV9tbWFw
X2d0dF9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAorCQkJc3RydWN0
IGRybV9maWxlICpmaWxlKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fbW1hcF9ndHQgKmFyZ3Mg
PSBkYXRhOworCisJcmV0dXJuIGk5MTVfZ2VtX21tYXBfZ3R0KGZpbGUsIGRldiwgYXJncy0+aGFu
ZGxlLCAmYXJncy0+b2Zmc2V0KTsKK30KKworI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1
X1NFTEZURVNUKQorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMiCisjZW5kaWYK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwppbmRleCAzMDAwYjI2
YjRiYmYuLjRlZDI4YWM5YWIzYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3QuYwpAQCAtMjQsNiArMjQsNyBAQAogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNp
bmNsdWRlICJpOTE1X2dlbV9vYmplY3QuaCIKKyNpbmNsdWRlICJpOTE1X2dlbV9jbGZsdXNoLmgi
CiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCiAjaW5jbHVkZSAiaW50ZWxfZnJvbnRidWZmZXIu
aCIKIApAQCAtMzU2LDYgKzM1Nyw2MSBAQCB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X3JlbGVhc2Vf
dW5sZXNzX2FjdGl2ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCQlpOTE1X2dl
bV9vYmplY3RfcHV0KG9iaik7CiB9CiAKK3N0YXRpYyBpbmxpbmUgZW51bSBmYl9vcF9vcmlnaW4K
K2ZiX3dyaXRlX29yaWdpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1bnNpZ25l
ZCBpbnQgZG9tYWluKQoreworCXJldHVybiAoZG9tYWluID09IEk5MTVfR0VNX0RPTUFJTl9HVFQg
PworCQlvYmotPmZyb250YnVmZmVyX2dndHRfb3JpZ2luIDogT1JJR0lOX0NQVSk7Cit9CisKK3N0
YXRpYyBib29sIGdwdV93cml0ZV9uZWVkc19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopCit7CisJcmV0dXJuICEob2JqLT5jYWNoZV9sZXZlbCA9PSBJOTE1X0NBQ0hFX05P
TkUgfHwKKwkJIG9iai0+Y2FjaGVfbGV2ZWwgPT0gSTkxNV9DQUNIRV9XVCk7Cit9CisKK3ZvaWQK
K2k5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKKwkJCQkgICB1bnNpZ25lZCBpbnQgZmx1c2hfZG9tYWlucykKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwor
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCisJaWYgKCEob2JqLT53cml0ZV9kb21haW4gJiBmbHVz
aF9kb21haW5zKSkKKwkJcmV0dXJuOworCisJc3dpdGNoIChvYmotPndyaXRlX2RvbWFpbikgewor
CWNhc2UgSTkxNV9HRU1fRE9NQUlOX0dUVDoKKwkJaTkxNV9nZW1fZmx1c2hfZ2d0dF93cml0ZXMo
ZGV2X3ByaXYpOworCisJCWludGVsX2ZiX29ial9mbHVzaChvYmosCisJCQkJICAgZmJfd3JpdGVf
b3JpZ2luKG9iaiwgSTkxNV9HRU1fRE9NQUlOX0dUVCkpOworCisJCWZvcl9lYWNoX2dndHRfdm1h
KHZtYSwgb2JqKSB7CisJCQlpZiAodm1hLT5pb21hcCkKKwkJCQljb250aW51ZTsKKworCQkJaTkx
NV92bWFfdW5zZXRfZ2d0dF93cml0ZSh2bWEpOworCQl9CisJCWJyZWFrOworCisJY2FzZSBJOTE1
X0dFTV9ET01BSU5fV0M6CisJCXdtYigpOworCQlicmVhazsKKworCWNhc2UgSTkxNV9HRU1fRE9N
QUlOX0NQVToKKwkJaTkxNV9nZW1fY2xmbHVzaF9vYmplY3Qob2JqLCBJOTE1X0NMRkxVU0hfU1lO
Qyk7CisJCWJyZWFrOworCisJY2FzZSBJOTE1X0dFTV9ET01BSU5fUkVOREVSOgorCQlpZiAoZ3B1
X3dyaXRlX25lZWRzX2NsZmx1c2gob2JqKSkKKwkJCW9iai0+Y2FjaGVfZGlydHkgPSB0cnVlOwor
CQlicmVhazsKKwl9CisKKwlvYmotPndyaXRlX2RvbWFpbiA9IDA7Cit9CisKIHZvaWQgaTkxNV9n
ZW1faW5pdF9fb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlJTklU
X1dPUksoJmk5MTUtPm1tLmZyZWVfd29yaywgX19pOTE1X2dlbV9mcmVlX3dvcmspOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCmluZGV4IDg4NDk1NTMwZWJkOS4u
MDdmNDg3Y2JmZjc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVj
dC5oCkBAIC0zNTEsNiArMzUxLDEzIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJaTkxNV9nZW1f
b2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiB9CiAKK3ZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVs
ZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOwordm9pZCBpOTE1X2dl
bV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOwor
Cit2b2lkCitpOTE1X2dlbV9vYmplY3RfZmx1c2hfd3JpdGVfZG9tYWluKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCisJCQkJICAgdW5zaWduZWQgaW50IGZsdXNoX2RvbWFpbnMpOwor
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgogaTkxNV9nZW1fb2JqZWN0
X2xhc3Rfd3JpdGVfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5j
Cm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uODdkYTAxMjMwMTc5Ci0t
LSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9tbWFuLmMKQEAgLTAsMCArMSw1MDMgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRp
ZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTYgSW50ZWwgQ29ycG9yYXRpb24KKyAq
LworCisjaW5jbHVkZSA8bGludXgvcHJpbWVfbnVtYmVycy5oPgorCisjaW5jbHVkZSAiZ3QvaW50
ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSAic2VsZnRl
c3RzL2h1Z2VfZ2VtX29iamVjdC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVz
dC5oIgorCitzdHJ1Y3QgdGlsZSB7CisJdW5zaWduZWQgaW50IHdpZHRoOworCXVuc2lnbmVkIGlu
dCBoZWlnaHQ7CisJdW5zaWduZWQgaW50IHN0cmlkZTsKKwl1bnNpZ25lZCBpbnQgc2l6ZTsKKwl1
bnNpZ25lZCBpbnQgdGlsaW5nOworCXVuc2lnbmVkIGludCBzd2l6emxlOworfTsKKworc3RhdGlj
IHU2NCBzd2l6emxlX2JpdCh1bnNpZ25lZCBpbnQgYml0LCB1NjQgb2Zmc2V0KQoreworCXJldHVy
biAob2Zmc2V0ICYgQklUX1VMTChiaXQpKSA+PiAoYml0IC0gNik7Cit9CisKK3N0YXRpYyB1NjQg
dGlsZWRfb2Zmc2V0KGNvbnN0IHN0cnVjdCB0aWxlICp0aWxlLCB1NjQgdikKK3sKKwl1NjQgeCwg
eTsKKworCWlmICh0aWxlLT50aWxpbmcgPT0gSTkxNV9USUxJTkdfTk9ORSkKKwkJcmV0dXJuIHY7
CisKKwl5ID0gZGl2NjRfdTY0X3JlbSh2LCB0aWxlLT5zdHJpZGUsICZ4KTsKKwl2ID0gZGl2NjRf
dTY0X3JlbSh5LCB0aWxlLT5oZWlnaHQsICZ5KSAqIHRpbGUtPnN0cmlkZSAqIHRpbGUtPmhlaWdo
dDsKKworCWlmICh0aWxlLT50aWxpbmcgPT0gSTkxNV9USUxJTkdfWCkgeworCQl2ICs9IHkgKiB0
aWxlLT53aWR0aDsKKwkJdiArPSBkaXY2NF91NjRfcmVtKHgsIHRpbGUtPndpZHRoLCAmeCkgPDwg
dGlsZS0+c2l6ZTsKKwkJdiArPSB4OworCX0gZWxzZSBpZiAodGlsZS0+d2lkdGggPT0gMTI4KSB7
CisJCWNvbnN0IHVuc2lnbmVkIGludCB5dGlsZV9zcGFuID0gMTY7CisJCWNvbnN0IHVuc2lnbmVk
IGludCB5dGlsZV9oZWlnaHQgPSA1MTI7CisKKwkJdiArPSB5ICogeXRpbGVfc3BhbjsKKwkJdiAr
PSBkaXY2NF91NjRfcmVtKHgsIHl0aWxlX3NwYW4sICZ4KSAqIHl0aWxlX2hlaWdodDsKKwkJdiAr
PSB4OworCX0gZWxzZSB7CisJCWNvbnN0IHVuc2lnbmVkIGludCB5dGlsZV9zcGFuID0gMzI7CisJ
CWNvbnN0IHVuc2lnbmVkIGludCB5dGlsZV9oZWlnaHQgPSAyNTY7CisKKwkJdiArPSB5ICogeXRp
bGVfc3BhbjsKKwkJdiArPSBkaXY2NF91NjRfcmVtKHgsIHl0aWxlX3NwYW4sICZ4KSAqIHl0aWxl
X2hlaWdodDsKKwkJdiArPSB4OworCX0KKworCXN3aXRjaCAodGlsZS0+c3dpenpsZSkgeworCWNh
c2UgSTkxNV9CSVRfNl9TV0laWkxFXzk6CisJCXYgXj0gc3dpenpsZV9iaXQoOSwgdik7CisJCWJy
ZWFrOworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFXzlfMTA6CisJCXYgXj0gc3dpenpsZV9iaXQo
OSwgdikgXiBzd2l6emxlX2JpdCgxMCwgdik7CisJCWJyZWFrOworCWNhc2UgSTkxNV9CSVRfNl9T
V0laWkxFXzlfMTE6CisJCXYgXj0gc3dpenpsZV9iaXQoOSwgdikgXiBzd2l6emxlX2JpdCgxMSwg
dik7CisJCWJyZWFrOworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFXzlfMTBfMTE6CisJCXYgXj0g
c3dpenpsZV9iaXQoOSwgdikgXiBzd2l6emxlX2JpdCgxMCwgdikgXiBzd2l6emxlX2JpdCgxMSwg
dik7CisJCWJyZWFrOworCX0KKworCXJldHVybiB2OworfQorCitzdGF0aWMgaW50IGNoZWNrX3Bh
cnRpYWxfbWFwcGluZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJCSBjb25z
dCBzdHJ1Y3QgdGlsZSAqdGlsZSwKKwkJCQkgdW5zaWduZWQgbG9uZyBlbmRfdGltZSkKK3sKKwlj
b25zdCB1bnNpZ25lZCBpbnQgbnJlYWwgPSBvYmotPnNjcmF0Y2ggLyBQQUdFX1NJWkU7CisJY29u
c3QgdW5zaWduZWQgbG9uZyBucGFnZXMgPSBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRTsKKwlz
dHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl1bnNpZ25lZCBsb25nIHBhZ2U7CisJaW50IGVycjsKKwor
CWlmIChpZ3RfdGltZW91dChlbmRfdGltZSwKKwkJCSIlczogdGltZWQgb3V0IGJlZm9yZSB0aWxp
bmc9JWQgc3RyaWRlPSVkXG4iLAorCQkJX19mdW5jX18sIHRpbGUtPnRpbGluZywgdGlsZS0+c3Ry
aWRlKSkKKwkJcmV0dXJuIC1FSU5UUjsKKworCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdGls
aW5nKG9iaiwgdGlsZS0+dGlsaW5nLCB0aWxlLT5zdHJpZGUpOworCWlmIChlcnIpIHsKKwkJcHJf
ZXJyKCJGYWlsZWQgdG8gc2V0IHRpbGluZyBtb2RlPSV1LCBzdHJpZGU9JXUsIGVycj0lZFxuIiwK
KwkJICAgICAgIHRpbGUtPnRpbGluZywgdGlsZS0+c3RyaWRlLCBlcnIpOworCQlyZXR1cm4gZXJy
OworCX0KKworCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2dldF90aWxpbmcob2JqKSAhPSB0
aWxlLT50aWxpbmcpOworCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2dldF9zdHJpZGUob2Jq
KSAhPSB0aWxlLT5zdHJpZGUpOworCisJZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20ocGFnZSwg
MSwgbnBhZ2VzKSB7CisJCXN0cnVjdCBpOTE1X2dndHRfdmlldyB2aWV3ID0KKwkJCWNvbXB1dGVf
cGFydGlhbF92aWV3KG9iaiwgcGFnZSwgTUlOX0NIVU5LX1BBR0VTKTsKKwkJdTMyIF9faW9tZW0g
KmlvOworCQlzdHJ1Y3QgcGFnZSAqcDsKKwkJdW5zaWduZWQgaW50IG47CisJCXU2NCBvZmZzZXQ7
CisJCXUzMiAqY3B1OworCisJCUdFTV9CVUdfT04odmlldy5wYXJ0aWFsLnNpemUgPiBucmVhbCk7
CisJCWNvbmRfcmVzY2hlZCgpOworCisJCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0
X2RvbWFpbihvYmosIHRydWUpOworCQlpZiAoZXJyKSB7CisJCQlwcl9lcnIoIkZhaWxlZCB0byBm
bHVzaCB0byBHVFQgd3JpdGUgZG9tYWluOyBlcnI9JWRcbiIsCisJCQkgICAgICAgZXJyKTsKKwkJ
CXJldHVybiBlcnI7CisJCX0KKworCQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2Jq
LCAmdmlldywgMCwgMCwgUElOX01BUFBBQkxFKTsKKwkJaWYgKElTX0VSUih2bWEpKSB7CisJCQlw
cl9lcnIoIkZhaWxlZCB0byBwaW4gcGFydGlhbCB2aWV3OiBvZmZzZXQ9JWx1OyBlcnI9JWRcbiIs
CisJCQkgICAgICAgcGFnZSwgKGludClQVFJfRVJSKHZtYSkpOworCQkJcmV0dXJuIFBUUl9FUlIo
dm1hKTsKKwkJfQorCisJCW4gPSBwYWdlIC0gdmlldy5wYXJ0aWFsLm9mZnNldDsKKwkJR0VNX0JV
R19PTihuID49IHZpZXcucGFydGlhbC5zaXplKTsKKworCQlpbyA9IGk5MTVfdm1hX3Bpbl9pb21h
cCh2bWEpOworCQlpOTE1X3ZtYV91bnBpbih2bWEpOworCQlpZiAoSVNfRVJSKGlvKSkgeworCQkJ
cHJfZXJyKCJGYWlsZWQgdG8gaW9tYXAgcGFydGlhbCB2aWV3OiBvZmZzZXQ9JWx1OyBlcnI9JWRc
biIsCisJCQkgICAgICAgcGFnZSwgKGludClQVFJfRVJSKGlvKSk7CisJCQlyZXR1cm4gUFRSX0VS
Uihpbyk7CisJCX0KKworCQlpb3dyaXRlMzIocGFnZSwgaW8gKyBuICogUEFHRV9TSVpFIC8gc2l6
ZW9mKCppbykpOworCQlpOTE1X3ZtYV91bnBpbl9pb21hcCh2bWEpOworCisJCW9mZnNldCA9IHRp
bGVkX29mZnNldCh0aWxlLCBwYWdlIDw8IFBBR0VfU0hJRlQpOworCQlpZiAob2Zmc2V0ID49IG9i
ai0+YmFzZS5zaXplKQorCQkJY29udGludWU7CisKKwkJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dy
aXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKKworCQlwID0gaTkxNV9nZW1f
b2JqZWN0X2dldF9wYWdlKG9iaiwgb2Zmc2V0ID4+IFBBR0VfU0hJRlQpOworCQljcHUgPSBrbWFw
KHApICsgb2Zmc2V0X2luX3BhZ2Uob2Zmc2V0KTsKKwkJZHJtX2NsZmx1c2hfdmlydF9yYW5nZShj
cHUsIHNpemVvZigqY3B1KSk7CisJCWlmICgqY3B1ICE9ICh1MzIpcGFnZSkgeworCQkJcHJfZXJy
KCJQYXJ0aWFsIHZpZXcgZm9yICVsdSBbJXVdIChvZmZzZXQ9JWxsdSwgc2l6ZT0ldSBbJWxsdSwg
cm93IHNpemUgJXVdLCBmZW5jZT0lZCwgdGlsaW5nPSVkLCBzdHJpZGU9JWQpIG1pc2FsaWdubWVu
dCwgZXhwZWN0ZWQgd3JpdGUgdG8gcGFnZSAoJWxsdSArICV1IFsweCVsbHhdKSBvZiAweCV4LCBm
b3VuZCAweCV4XG4iLAorCQkJICAgICAgIHBhZ2UsIG4sCisJCQkgICAgICAgdmlldy5wYXJ0aWFs
Lm9mZnNldCwKKwkJCSAgICAgICB2aWV3LnBhcnRpYWwuc2l6ZSwKKwkJCSAgICAgICB2bWEtPnNp
emUgPj4gUEFHRV9TSElGVCwKKwkJCSAgICAgICB0aWxlLT50aWxpbmcgPyB0aWxlX3Jvd19wYWdl
cyhvYmopIDogMCwKKwkJCSAgICAgICB2bWEtPmZlbmNlID8gdm1hLT5mZW5jZS0+aWQgOiAtMSwg
dGlsZS0+dGlsaW5nLCB0aWxlLT5zdHJpZGUsCisJCQkgICAgICAgb2Zmc2V0ID4+IFBBR0VfU0hJ
RlQsCisJCQkgICAgICAgKHVuc2lnbmVkIGludClvZmZzZXRfaW5fcGFnZShvZmZzZXQpLAorCQkJ
ICAgICAgIG9mZnNldCwKKwkJCSAgICAgICAodTMyKXBhZ2UsICpjcHUpOworCQkJZXJyID0gLUVJ
TlZBTDsKKwkJfQorCQkqY3B1ID0gMDsKKwkJZHJtX2NsZmx1c2hfdmlydF9yYW5nZShjcHUsIHNp
emVvZigqY3B1KSk7CisJCWt1bm1hcChwKTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7CisK
KwkJaTkxNV92bWFfZGVzdHJveSh2bWEpOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGlndF9wYXJ0aWFsX3RpbGluZyh2b2lkICphcmcpCit7CisJY29uc3QgdW5zaWduZWQgaW50
IG5yZWFsID0gMSA8PCAxMjsgLyogbGFyZ2VzdCB0aWxlIHJvdyB4MiAqLworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisJaW50IHRpbGluZzsKKwlpbnQgZXJyOwor
CisJLyogV2Ugd2FudCB0byBjaGVjayB0aGUgcGFnZSBtYXBwaW5nIGFuZCBmZW5jaW5nIG9mIGEg
bGFyZ2Ugb2JqZWN0CisJICogbW1hcHBlZCB0aHJvdWdoIHRoZSBHVFQuIFRoZSBvYmplY3Qgd2Ug
Y3JlYXRlIGlzIGxhcmdlciB0aGFuIGNhbgorCSAqIHBvc3NpYmx5IGJlIG1tYXBlZCBhcyBhIHdo
b2xlLCBhbmQgc28gd2UgbXVzdCB1c2UgcGFydGlhbCBHR1RUIHZtYS4KKwkgKiBXZSB0aGVuIGNo
ZWNrIHRoYXQgYSB3cml0ZSB0aHJvdWdoIGVhY2ggcGFydGlhbCBHR1RUIHZtYSBlbmRzIHVwCisJ
ICogaW4gdGhlIHJpZ2h0IHNldCBvZiBwYWdlcyB3aXRoaW4gdGhlIG9iamVjdCwgYW5kIHdpdGgg
dGhlIGV4cGVjdGVkCisJICogdGlsaW5nLCB3aGljaCB3ZSB2ZXJpZnkgYnkgbWFudWFsIHN3aXp6
bGluZy4KKwkgKi8KKworCW9iaiA9IGh1Z2VfZ2VtX29iamVjdChpOTE1LAorCQkJICAgICAgbnJl
YWwgPDwgUEFHRV9TSElGVCwKKwkJCSAgICAgICgxICsgbmV4dF9wcmltZV9udW1iZXIoaTkxNS0+
Z2d0dC52bS50b3RhbCA+PiBQQUdFX1NISUZUKSkgPDwgUEFHRV9TSElGVCk7CisJaWYgKElTX0VS
UihvYmopKQorCQlyZXR1cm4gUFRSX0VSUihvYmopOworCisJZXJyID0gaTkxNV9nZW1fb2JqZWN0
X3Bpbl9wYWdlcyhvYmopOworCWlmIChlcnIpIHsKKwkJcHJfZXJyKCJGYWlsZWQgdG8gYWxsb2Nh
dGUgJXUgcGFnZXMgKCVsdSB0b3RhbCksIGVycj0lZFxuIiwKKwkJICAgICAgIG5yZWFsLCBvYmot
PmJhc2Uuc2l6ZSAvIFBBR0VfU0laRSwgZXJyKTsKKwkJZ290byBvdXQ7CisJfQorCisJbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KGk5MTUpOworCisJaWYgKDEpIHsKKwkJSUdUX1RJTUVPVVQoZW5kKTsKKwkJc3RydWN0
IHRpbGUgdGlsZTsKKworCQl0aWxlLmhlaWdodCA9IDE7CisJCXRpbGUud2lkdGggPSAxOworCQl0
aWxlLnNpemUgPSAwOworCQl0aWxlLnN0cmlkZSA9IDA7CisJCXRpbGUuc3dpenpsZSA9IEk5MTVf
QklUXzZfU1dJWlpMRV9OT05FOworCQl0aWxlLnRpbGluZyA9IEk5MTVfVElMSU5HX05PTkU7CisK
KwkJZXJyID0gY2hlY2tfcGFydGlhbF9tYXBwaW5nKG9iaiwgJnRpbGUsIGVuZCk7CisJCWlmIChl
cnIgJiYgZXJyICE9IC1FSU5UUikKKwkJCWdvdG8gb3V0X3VubG9jazsKKwl9CisKKwlmb3IgKHRp
bGluZyA9IEk5MTVfVElMSU5HX1g7IHRpbGluZyA8PSBJOTE1X1RJTElOR19ZOyB0aWxpbmcrKykg
eworCQlJR1RfVElNRU9VVChlbmQpOworCQl1bnNpZ25lZCBpbnQgbWF4X3BpdGNoOworCQl1bnNp
Z25lZCBpbnQgcGl0Y2g7CisJCXN0cnVjdCB0aWxlIHRpbGU7CisKKwkJaWYgKGk5MTUtPnF1aXJr
cyAmIFFVSVJLX1BJTl9TV0laWkxFRF9QQUdFUykKKwkJCS8qCisJCQkgKiBUaGUgc3dpenpsaW5n
IHBhdHRlcm4gaXMgYWN0dWFsbHkgdW5rbm93biBhcyBpdAorCQkJICogdmFyaWVzIGJhc2VkIG9u
IHBoeXNpY2FsIGFkZHJlc3Mgb2YgZWFjaCBwYWdlLgorCQkJICogU2VlIGk5MTVfZ2VtX2RldGVj
dF9iaXRfNl9zd2l6emxlKCkuCisJCQkgKi8KKwkJCWJyZWFrOworCisJCXRpbGUudGlsaW5nID0g
dGlsaW5nOworCQlzd2l0Y2ggKHRpbGluZykgeworCQljYXNlIEk5MTVfVElMSU5HX1g6CisJCQl0
aWxlLnN3aXp6bGUgPSBpOTE1LT5tbS5iaXRfNl9zd2l6emxlX3g7CisJCQlicmVhazsKKwkJY2Fz
ZSBJOTE1X1RJTElOR19ZOgorCQkJdGlsZS5zd2l6emxlID0gaTkxNS0+bW0uYml0XzZfc3dpenps
ZV95OworCQkJYnJlYWs7CisJCX0KKworCQlHRU1fQlVHX09OKHRpbGUuc3dpenpsZSA9PSBJOTE1
X0JJVF82X1NXSVpaTEVfVU5LTk9XTik7CisJCWlmICh0aWxlLnN3aXp6bGUgPT0gSTkxNV9CSVRf
Nl9TV0laWkxFXzlfMTcgfHwKKwkJICAgIHRpbGUuc3dpenpsZSA9PSBJOTE1X0JJVF82X1NXSVpa
TEVfOV8xMF8xNykKKwkJCWNvbnRpbnVlOworCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPD0gMikg
eworCQkJdGlsZS5oZWlnaHQgPSAxNjsKKwkJCXRpbGUud2lkdGggPSAxMjg7CisJCQl0aWxlLnNp
emUgPSAxMTsKKwkJfSBlbHNlIGlmICh0aWxlLnRpbGluZyA9PSBJOTE1X1RJTElOR19ZICYmCisJ
CQkgICBIQVNfMTI4X0JZVEVfWV9USUxJTkcoaTkxNSkpIHsKKwkJCXRpbGUuaGVpZ2h0ID0gMzI7
CisJCQl0aWxlLndpZHRoID0gMTI4OworCQkJdGlsZS5zaXplID0gMTI7CisJCX0gZWxzZSB7CisJ
CQl0aWxlLmhlaWdodCA9IDg7CisJCQl0aWxlLndpZHRoID0gNTEyOworCQkJdGlsZS5zaXplID0g
MTI7CisJCX0KKworCQlpZiAoSU5URUxfR0VOKGk5MTUpIDwgNCkKKwkJCW1heF9waXRjaCA9IDgx
OTIgLyB0aWxlLndpZHRoOworCQllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPCA3KQorCQkJbWF4
X3BpdGNoID0gMTI4ICogSTk2NV9GRU5DRV9NQVhfUElUQ0hfVkFMIC8gdGlsZS53aWR0aDsKKwkJ
ZWxzZQorCQkJbWF4X3BpdGNoID0gMTI4ICogR0VON19GRU5DRV9NQVhfUElUQ0hfVkFMIC8gdGls
ZS53aWR0aDsKKworCQlmb3IgKHBpdGNoID0gbWF4X3BpdGNoOyBwaXRjaDsgcGl0Y2ggPj49IDEp
IHsKKwkJCXRpbGUuc3RyaWRlID0gdGlsZS53aWR0aCAqIHBpdGNoOworCQkJZXJyID0gY2hlY2tf
cGFydGlhbF9tYXBwaW5nKG9iaiwgJnRpbGUsIGVuZCk7CisJCQlpZiAoZXJyID09IC1FSU5UUikK
KwkJCQlnb3RvIG5leHRfdGlsaW5nOworCQkJaWYgKGVycikKKwkJCQlnb3RvIG91dF91bmxvY2s7
CisKKwkJCWlmIChwaXRjaCA+IDIgJiYgSU5URUxfR0VOKGk5MTUpID49IDQpIHsKKwkJCQl0aWxl
LnN0cmlkZSA9IHRpbGUud2lkdGggKiAocGl0Y2ggLSAxKTsKKwkJCQllcnIgPSBjaGVja19wYXJ0
aWFsX21hcHBpbmcob2JqLCAmdGlsZSwgZW5kKTsKKwkJCQlpZiAoZXJyID09IC1FSU5UUikKKwkJ
CQkJZ290byBuZXh0X3RpbGluZzsKKwkJCQlpZiAoZXJyKQorCQkJCQlnb3RvIG91dF91bmxvY2s7
CisJCQl9CisKKwkJCWlmIChwaXRjaCA8IG1heF9waXRjaCAmJiBJTlRFTF9HRU4oaTkxNSkgPj0g
NCkgeworCQkJCXRpbGUuc3RyaWRlID0gdGlsZS53aWR0aCAqIChwaXRjaCArIDEpOworCQkJCWVy
ciA9IGNoZWNrX3BhcnRpYWxfbWFwcGluZyhvYmosICZ0aWxlLCBlbmQpOworCQkJCWlmIChlcnIg
PT0gLUVJTlRSKQorCQkJCQlnb3RvIG5leHRfdGlsaW5nOworCQkJCWlmIChlcnIpCisJCQkJCWdv
dG8gb3V0X3VubG9jazsKKwkJCX0KKwkJfQorCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkg
eworCQkJZm9yX2VhY2hfcHJpbWVfbnVtYmVyKHBpdGNoLCBtYXhfcGl0Y2gpIHsKKwkJCQl0aWxl
LnN0cmlkZSA9IHRpbGUud2lkdGggKiBwaXRjaDsKKwkJCQllcnIgPSBjaGVja19wYXJ0aWFsX21h
cHBpbmcob2JqLCAmdGlsZSwgZW5kKTsKKwkJCQlpZiAoZXJyID09IC1FSU5UUikKKwkJCQkJZ290
byBuZXh0X3RpbGluZzsKKwkJCQlpZiAoZXJyKQorCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQl9
CisJCX0KKworbmV4dF90aWxpbmc6IDsKKwl9CisKK291dF91bmxvY2s6CisJaW50ZWxfcnVudGlt
ZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKK291dDoKKwlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBtYWtl
X29ial9idXN5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwl2
bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosICZpOTE1LT5nZ3R0LnZtLCBOVUxMKTsKKwlpZiAo
SVNfRVJSKHZtYSkpCisJCXJldHVybiBQVFJfRVJSKHZtYSk7CisKKwllcnIgPSBpOTE1X3ZtYV9w
aW4odm1hLCAwLCAwLCBQSU5fVVNFUik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXJx
ID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0
KTsKKwlpZiAoSVNfRVJSKHJxKSkgeworCQlpOTE1X3ZtYV91bnBpbih2bWEpOworCQlyZXR1cm4g
UFRSX0VSUihycSk7CisJfQorCisJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBy
cSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisKKwlfX2k5
MTVfZ2VtX29iamVjdF9yZWxlYXNlX3VubGVzc19hY3RpdmUob2JqKTsKKwlpOTE1X3ZtYV91bnBp
bih2bWEpOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGJvb2wgYXNzZXJ0X21tYXBfb2Zm
c2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJICAgICAgIHVuc2lnbmVkIGxv
bmcgc2l6ZSwKKwkJCSAgICAgICBpbnQgZXhwZWN0ZWQpCit7CisJc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iajsKKwlpbnQgZXJyOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9pbnRlcm5hbChpOTE1LCBzaXplKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJf
RVJSKG9iaik7CisKKwllcnIgPSBjcmVhdGVfbW1hcF9vZmZzZXQob2JqKTsKKwlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7CisKKwlyZXR1cm4gZXJyID09IGV4cGVjdGVkOworfQorCitzdGF0aWMg
dm9pZCBkaXNhYmxlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Cit7CisJaTkxNV9nZW1fc2hyaW5rZXJfdW5yZWdpc3RlcihpOTE1KTsKKworCWludGVsX2d0X3Bt
X2dldChpOTE1KTsKKworCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaTkxNS0+Z2VtLnJldGly
ZV93b3JrKTsKKwlmbHVzaF93b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsKK30KKworc3RhdGlj
IHZvaWQgcmVzdG9yZV9yZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQoreworCWludGVsX2d0X3BtX3B1dChpOTE1KTsKKworCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworCWlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwor
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKKwlpOTE1X2dlbV9zaHJp
bmtlcl9yZWdpc3RlcihpOTE1KTsKK30KKworc3RhdGljIGludCBpZ3RfbW1hcF9vZmZzZXRfZXho
YXVzdGlvbih2b2lkICphcmcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBh
cmc7CisJc3RydWN0IGRybV9tbSAqbW0gPSAmaTkxNS0+ZHJtLnZtYV9vZmZzZXRfbWFuYWdlci0+
dm1fYWRkcl9zcGFjZV9tbTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0
cnVjdCBkcm1fbW1fbm9kZSByZXN2LCAqaG9sZTsKKwl1NjQgaG9sZV9zdGFydCwgaG9sZV9lbmQ7
CisJaW50IGxvb3AsIGVycjsKKworCS8qIERpc2FibGUgYmFja2dyb3VuZCByZWFwZXIgKi8KKwlk
aXNhYmxlX3JldGlyZV93b3JrZXIoaTkxNSk7CisJR0VNX0JVR19PTighaTkxNS0+Z3QuYXdha2Up
OworCisJLyogVHJpbSB0aGUgZGV2aWNlIG1tYXAgc3BhY2UgdG8gb25seSBhIHBhZ2UgKi8KKwlt
ZW1zZXQoJnJlc3YsIDAsIHNpemVvZihyZXN2KSk7CisJZHJtX21tX2Zvcl9lYWNoX2hvbGUoaG9s
ZSwgbW0sIGhvbGVfc3RhcnQsIGhvbGVfZW5kKSB7CisJCXJlc3Yuc3RhcnQgPSBob2xlX3N0YXJ0
OworCQlyZXN2LnNpemUgPSBob2xlX2VuZCAtIGhvbGVfc3RhcnQgLSAxOyAvKiBQQUdFX1NJWkUg
dW5pdHMgKi8KKwkJZXJyID0gZHJtX21tX3Jlc2VydmVfbm9kZShtbSwgJnJlc3YpOworCQlpZiAo
ZXJyKSB7CisJCQlwcl9lcnIoIkZhaWxlZCB0byB0cmltIFZNQSBtYW5hZ2VyLCBlcnI9JWRcbiIs
IGVycik7CisJCQlnb3RvIG91dF9wYXJrOworCQl9CisJCWJyZWFrOworCX0KKworCS8qIEp1c3Qg
Zml0cyEgKi8KKwlpZiAoIWFzc2VydF9tbWFwX29mZnNldChpOTE1LCBQQUdFX1NJWkUsIDApKSB7
CisJCXByX2VycigiVW5hYmxlIHRvIGluc2VydCBvYmplY3QgaW50byBzaW5nbGUgcGFnZSBob2xl
XG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBvdXQ7CisJfQorCisJLyogVG9vIGxhcmdl
ICovCisJaWYgKCFhc3NlcnRfbW1hcF9vZmZzZXQoaTkxNSwgMiAqIFBBR0VfU0laRSwgLUVOT1NQ
QykpIHsKKwkJcHJfZXJyKCJVbmV4cGVjdGVkbHkgc3VjY2VlZGVkIGluIGluc2VydGluZyB0b28g
bGFyZ2Ugb2JqZWN0IGludG8gc2luZ2xlIHBhZ2UgaG9sZVxuIik7CisJCWVyciA9IC1FSU5WQUw7
CisJCWdvdG8gb3V0OworCX0KKworCS8qIEZpbGwgdGhlIGhvbGUsIGZ1cnRoZXIgYWxsb2NhdGlv
biBhdHRlbXB0cyBzaG91bGQgdGhlbiBmYWlsICovCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIob2JqKSkgeworCQll
cnIgPSBQVFJfRVJSKG9iaik7CisJCWdvdG8gb3V0OworCX0KKworCWVyciA9IGNyZWF0ZV9tbWFw
X29mZnNldChvYmopOworCWlmIChlcnIpIHsKKwkJcHJfZXJyKCJVbmFibGUgdG8gaW5zZXJ0IG9i
amVjdCBpbnRvIHJlY2xhaW1lZCBob2xlXG4iKTsKKwkJZ290byBlcnJfb2JqOworCX0KKworCWlm
ICghYXNzZXJ0X21tYXBfb2Zmc2V0KGk5MTUsIFBBR0VfU0laRSwgLUVOT1NQQykpIHsKKwkJcHJf
ZXJyKCJVbmV4cGVjdGVkbHkgc3VjY2VlZGVkIGluIGluc2VydGluZyBvYmplY3QgaW50byBubyBo
b2xlcyFcbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIGVycl9vYmo7CisJfQorCisJaTkx
NV9nZW1fb2JqZWN0X3B1dChvYmopOworCisJLyogTm93IGZpbGwgd2l0aCBidXN5IGRlYWQgb2Jq
ZWN0cyB0aGF0IHdlIGV4cGVjdCB0byByZWFwICovCisJZm9yIChsb29wID0gMDsgbG9vcCA8IDM7
IGxvb3ArKykgeworCQlpZiAoaTkxNV90ZXJtaW5hbGx5X3dlZGdlZChpOTE1KSkKKwkJCWJyZWFr
OworCisJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9T
SVpFKTsKKwkJaWYgKElTX0VSUihvYmopKSB7CisJCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCQln
b3RvIG91dDsKKwkJfQorCisJCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CQllcnIgPSBtYWtlX29ial9idXN5KG9iaik7CisJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJCWlmIChlcnIpIHsKKwkJCXByX2VycigiW2xvb3AgJWRdIEZhaWxlZCB0
byBidXN5IHRoZSBvYmplY3RcbiIsIGxvb3ApOworCQkJZ290byBlcnJfb2JqOworCQl9CisKKwkJ
LyogTkIgd2UgcmVseSBvbiB0aGUgX2FjdGl2ZV8gcmVmZXJlbmNlIHRvIGFjY2VzcyBvYmogbm93
ICovCisJCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2JqKSk7CisJCWVy
ciA9IGNyZWF0ZV9tbWFwX29mZnNldChvYmopOworCQlpZiAoZXJyKSB7CisJCQlwcl9lcnIoIlts
b29wICVkXSBjcmVhdGVfbW1hcF9vZmZzZXQgZmFpbGVkIHdpdGggZXJyPSVkXG4iLAorCQkJICAg
ICAgIGxvb3AsIGVycik7CisJCQlnb3RvIG91dDsKKwkJfQorCX0KKworb3V0OgorCWRybV9tbV9y
ZW1vdmVfbm9kZSgmcmVzdik7CitvdXRfcGFyazoKKwlyZXN0b3JlX3JldGlyZV93b3JrZXIoaTkx
NSk7CisJcmV0dXJuIGVycjsKK2Vycl9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwor
CWdvdG8gb3V0OworfQorCitpbnQgaTkxNV9nZW1fbW1hbl9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3Vi
dGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGlndF9wYXJ0aWFsX3RpbGluZyksCisJCVNVQlRF
U1QoaWd0X21tYXBfb2Zmc2V0X2V4aGF1c3Rpb24pLAorCX07CisKKwlyZXR1cm4gaTkxNV9zdWJ0
ZXN0cyh0ZXN0cywgaTkxNSk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCAwZjAxOGZk
NThhNjAuLjU4NGViYjkwMWUxOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0yODA2LDcg
KzI4MDYsNiBAQCBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKIAkJCSB1NjQgZmxhZ3MpOwogCiBpbnQgaTkxNV9nZW1fb2JqZWN0X3VuYmlu
ZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKLXZvaWQgaTkxNV9nZW1fcmVsZWFz
ZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOwogCiB2b2lkIGk5MTVfZ2Vt
X3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA2ZjNlOTM5NGU4MDYuLmJkZTI1ZDUzMjZiYSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC00MDQsMTIgKzQwNCw2IEBAIGk5MTVfZ2VtX2R1bWJf
Y3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJCSAgICAgICAmYXJncy0+c2l6ZSwgJmFy
Z3MtPmhhbmRsZSk7CiB9CiAKLXN0YXRpYyBib29sIGdwdV93cml0ZV9uZWVkc19jbGZsdXNoKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JcmV0dXJuICEob2JqLT5jYWNoZV9s
ZXZlbCA9PSBJOTE1X0NBQ0hFX05PTkUgfHwKLQkJIG9iai0+Y2FjaGVfbGV2ZWwgPT0gSTkxNV9D
QUNIRV9XVCk7Ci19Ci0KIC8qKgogICogQ3JlYXRlcyBhIG5ldyBtbSBvYmplY3QgYW5kIHJldHVy
bnMgYSBoYW5kbGUgdG8gaXQuCiAgKiBAZGV2OiBkcm0gZGV2aWNlIHBvaW50ZXIKQEAgLTQyOSwx
MyArNDIzLDYgQEAgaTkxNV9nZW1fY3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHZvaWQgKmRhdGEsCiAJCQkgICAgICAgJmFyZ3MtPnNpemUsICZhcmdzLT5oYW5kbGUpOwogfQog
Ci1zdGF0aWMgaW5saW5lIGVudW0gZmJfb3Bfb3JpZ2luCi1mYl93cml0ZV9vcmlnaW4oc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdW5zaWduZWQgaW50IGRvbWFpbikKLXsKLQlyZXR1
cm4gKGRvbWFpbiA9PSBJOTE1X0dFTV9ET01BSU5fR1RUID8KLQkJb2JqLT5mcm9udGJ1ZmZlcl9n
Z3R0X29yaWdpbiA6IE9SSUdJTl9DUFUpOwotfQotCiB2b2lkIGk5MTVfZ2VtX2ZsdXNoX2dndHRf
d3JpdGVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlpbnRlbF93YWtl
cmVmX3Qgd2FrZXJlZjsKQEAgLTQ3NSw0NyArNDYyLDYgQEAgdm9pZCBpOTE1X2dlbV9mbHVzaF9n
Z3R0X3dyaXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1z
dGF0aWMgdm9pZAotZmx1c2hfd3JpdGVfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosIHVuc2lnbmVkIGludCBmbHVzaF9kb21haW5zKQotewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVf
dm1hICp2bWE7Ci0KLQlpZiAoIShvYmotPndyaXRlX2RvbWFpbiAmIGZsdXNoX2RvbWFpbnMpKQot
CQlyZXR1cm47Ci0KLQlzd2l0Y2ggKG9iai0+d3JpdGVfZG9tYWluKSB7Ci0JY2FzZSBJOTE1X0dF
TV9ET01BSU5fR1RUOgotCQlpOTE1X2dlbV9mbHVzaF9nZ3R0X3dyaXRlcyhkZXZfcHJpdik7Ci0K
LQkJaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwKLQkJCQkgICBmYl93cml0ZV9vcmlnaW4ob2JqLCBJ
OTE1X0dFTV9ET01BSU5fR1RUKSk7Ci0KLQkJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopIHsK
LQkJCWlmICh2bWEtPmlvbWFwKQotCQkJCWNvbnRpbnVlOwotCi0JCQlpOTE1X3ZtYV91bnNldF9n
Z3R0X3dyaXRlKHZtYSk7Ci0JCX0KLQkJYnJlYWs7Ci0KLQljYXNlIEk5MTVfR0VNX0RPTUFJTl9X
QzoKLQkJd21iKCk7Ci0JCWJyZWFrOwotCi0JY2FzZSBJOTE1X0dFTV9ET01BSU5fQ1BVOgotCQlp
OTE1X2dlbV9jbGZsdXNoX29iamVjdChvYmosIEk5MTVfQ0xGTFVTSF9TWU5DKTsKLQkJYnJlYWs7
Ci0KLQljYXNlIEk5MTVfR0VNX0RPTUFJTl9SRU5ERVI6Ci0JCWlmIChncHVfd3JpdGVfbmVlZHNf
Y2xmbHVzaChvYmopKQotCQkJb2JqLT5jYWNoZV9kaXJ0eSA9IHRydWU7Ci0JCWJyZWFrOwotCX0K
LQotCW9iai0+d3JpdGVfZG9tYWluID0gMDsKLX0KLQogLyoKICAqIFBpbnMgdGhlIHNwZWNpZmll
ZCBvYmplY3QncyBwYWdlcyBhbmQgc3luY2hyb25pemVzIHRoZSBvYmplY3Qgd2l0aAogICogR1BV
IGFjY2Vzc2VzLiBTZXRzIG5lZWRzX2NsZmx1c2ggdG8gbm9uLXplcm8gaWYgdGhlIGNhbGxlciBz
aG91bGQKQEAgLTU1Miw3ICs0OTgsNyBAQCBpbnQgaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2htZW1f
cmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJZ290byBvdXQ7CiAJfQog
Ci0JZmx1c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOworCWk5MTVf
Z2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7
CiAKIAkvKiBJZiB3ZSdyZSBub3QgaW4gdGhlIGNwdSByZWFkIGRvbWFpbiwgc2V0IG91cnNlbGYg
aW50byB0aGUgZ3R0CiAJICogcmVhZCBkb21haW4gYW5kIG1hbnVhbGx5IGZsdXNoIGNhY2hlbGlu
ZXMgKGlmIHJlcXVpcmVkKS4gVGhpcwpAQCAtNjA0LDcgKzU1MCw3IEBAIGludCBpOTE1X2dlbV9v
YmpfcHJlcGFyZV9zaG1lbV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CQkJZ290byBvdXQ7CiAJfQogCi0JZmx1c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RP
TUFJTl9DUFUpOworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkx
NV9HRU1fRE9NQUlOX0NQVSk7CiAKIAkvKiBJZiB3ZSdyZSBub3QgaW4gdGhlIGNwdSB3cml0ZSBk
b21haW4sIHNldCBvdXJzZWxmIGludG8gdGhlCiAJICogZ3R0IHdyaXRlIGRvbWFpbiBhbmQgbWFu
dWFsbHkgZmx1c2ggY2FjaGVsaW5lcyAoYXMgcmVxdWlyZWQpLgpAQCAtMTIwNyw2ICsxMTUzLDEz
IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dndHQoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xv
Y2spOwogfQogCitzdGF0aWMgaW5saW5lIGVudW0gZmJfb3Bfb3JpZ2luCitmYl93cml0ZV9vcmln
aW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdW5zaWduZWQgaW50IGRvbWFpbikK
K3sKKwlyZXR1cm4gKGRvbWFpbiA9PSBJOTE1X0dFTV9ET01BSU5fR1RUID8KKwkJb2JqLT5mcm9u
dGJ1ZmZlcl9nZ3R0X29yaWdpbiA6IE9SSUdJTl9DUFUpOworfQorCiAvKioKICAqIENhbGxlZCB3
aGVuIHVzZXIgc3BhY2UgcHJlcGFyZXMgdG8gdXNlIGFuIG9iamVjdCB3aXRoIHRoZSBDUFUsIGVp
dGhlcgogICogdGhyb3VnaCB0aGUgbW1hcCBpb2N0bCdzIG1hcHBpbmcgb3IgYSBHVFQgbWFwcGlu
Zy4KQEAgLTEzNTAsNDIzICsxMzAzLDYgQEAgaTkxNV9nZW1fc3dfZmluaXNoX2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBp
bmxpbmUgYm9vbAotX192bWFfbWF0Y2hlcyhzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwgc3Ry
dWN0IGZpbGUgKmZpbHAsCi0JICAgICAgdW5zaWduZWQgbG9uZyBhZGRyLCB1bnNpZ25lZCBsb25n
IHNpemUpCi17Ci0JaWYgKHZtYS0+dm1fZmlsZSAhPSBmaWxwKQotCQlyZXR1cm4gZmFsc2U7Ci0K
LQlyZXR1cm4gdm1hLT52bV9zdGFydCA9PSBhZGRyICYmCi0JICAgICAgICh2bWEtPnZtX2VuZCAt
IHZtYS0+dm1fc3RhcnQpID09IFBBR0VfQUxJR04oc2l6ZSk7Ci19Ci0KLS8qKgotICogaTkxNV9n
ZW1fbW1hcF9pb2N0bCAtIE1hcHMgdGhlIGNvbnRlbnRzIG9mIGFuIG9iamVjdCwgcmV0dXJuaW5n
IHRoZSBhZGRyZXNzCi0gKgkJCSBpdCBpcyBtYXBwZWQgdG8uCi0gKiBAZGV2OiBkcm0gZGV2aWNl
Ci0gKiBAZGF0YTogaW9jdGwgZGF0YSBibG9iCi0gKiBAZmlsZTogZHJtIGZpbGUKLSAqCi0gKiBX
aGlsZSB0aGUgbWFwcGluZyBob2xkcyBhIHJlZmVyZW5jZSBvbiB0aGUgY29udGVudHMgb2YgdGhl
IG9iamVjdCwgaXQgZG9lc24ndAotICogaW1wbHkgYSByZWYgb24gdGhlIG9iamVjdCBpdHNlbGYu
Ci0gKgotICogSU1QT1JUQU5UOgotICoKLSAqIERSTSBkcml2ZXIgd3JpdGVycyB3aG8gbG9vayBh
IHRoaXMgZnVuY3Rpb24gYXMgYW4gZXhhbXBsZSBmb3IgaG93IHRvIGRvIEdFTQotICogbW1hcCBz
dXBwb3J0LCBwbGVhc2UgZG9uJ3QgaW1wbGVtZW50IG1tYXAgc3VwcG9ydCBsaWtlIGhlcmUuIFRo
ZSBtb2Rlcm4gd2F5Ci0gKiB0byBpbXBsZW1lbnQgRFJNIG1tYXAgc3VwcG9ydCBpcyB3aXRoIGFu
IG1tYXAgb2Zmc2V0IGlvY3RsIChsaWtlCi0gKiBpOTE1X2dlbV9tbWFwX2d0dCkgYW5kIHRoZW4g
dXNpbmcgdGhlIG1tYXAgc3lzY2FsbCBvbiB0aGUgRFJNIGZkIGRpcmVjdGx5LgotICogVGhhdCB3
YXkgZGVidWcgdG9vbGluZyBsaWtlIHZhbGdyaW5kIHdpbGwgdW5kZXJzdGFuZCB3aGF0J3MgZ29p
bmcgb24sIGhpZGluZwotICogdGhlIG1tYXAgY2FsbCBpbiBhIGRyaXZlciBwcml2YXRlIGlvY3Rs
IHdpbGwgYnJlYWsgdGhhdC4gVGhlIGk5MTUgZHJpdmVyIG9ubHkKLSAqIGRvZXMgY3B1IG1tYXBz
IHRoaXMgd2F5IGJlY2F1c2Ugd2UgZGlkbid0IGtub3cgYmV0dGVyLgotICovCi1pbnQKLWk5MTVf
Z2VtX21tYXBfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKLQkJICAg
IHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX21tYXAgKmFy
Z3MgPSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0JdW5zaWduZWQg
bG9uZyBhZGRyOwotCi0JaWYgKGFyZ3MtPmZsYWdzICYgfihJOTE1X01NQVBfV0MpKQotCQlyZXR1
cm4gLUVJTlZBTDsKLQotCWlmIChhcmdzLT5mbGFncyAmIEk5MTVfTU1BUF9XQyAmJiAhYm9vdF9j
cHVfaGFzKFg4Nl9GRUFUVVJFX1BBVCkpCi0JCXJldHVybiAtRU5PREVWOwotCi0Jb2JqID0gaTkx
NV9nZW1fb2JqZWN0X2xvb2t1cChmaWxlLCBhcmdzLT5oYW5kbGUpOwotCWlmICghb2JqKQotCQly
ZXR1cm4gLUVOT0VOVDsKLQotCS8qIHByaW1lIG9iamVjdHMgaGF2ZSBubyBiYWNraW5nIGZpbHAg
dG8gR0VNIG1tYXAKLQkgKiBwYWdlcyBmcm9tLgotCSAqLwotCWlmICghb2JqLT5iYXNlLmZpbHAp
IHsKLQkJYWRkciA9IC1FTlhJTzsKLQkJZ290byBlcnI7Ci0JfQotCi0JaWYgKHJhbmdlX292ZXJm
bG93cyhhcmdzLT5vZmZzZXQsIGFyZ3MtPnNpemUsICh1NjQpb2JqLT5iYXNlLnNpemUpKSB7Ci0J
CWFkZHIgPSAtRUlOVkFMOwotCQlnb3RvIGVycjsKLQl9Ci0KLQlhZGRyID0gdm1fbW1hcChvYmot
PmJhc2UuZmlscCwgMCwgYXJncy0+c2l6ZSwKLQkJICAgICAgIFBST1RfUkVBRCB8IFBST1RfV1JJ
VEUsIE1BUF9TSEFSRUQsCi0JCSAgICAgICBhcmdzLT5vZmZzZXQpOwotCWlmIChJU19FUlJfVkFM
VUUoYWRkcikpCi0JCWdvdG8gZXJyOwotCi0JaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9NTUFQX1dD
KSB7Ci0JCXN0cnVjdCBtbV9zdHJ1Y3QgKm1tID0gY3VycmVudC0+bW07Ci0JCXN0cnVjdCB2bV9h
cmVhX3N0cnVjdCAqdm1hOwotCi0JCWlmIChkb3duX3dyaXRlX2tpbGxhYmxlKCZtbS0+bW1hcF9z
ZW0pKSB7Ci0JCQlhZGRyID0gLUVJTlRSOwotCQkJZ290byBlcnI7Ci0JCX0KLQkJdm1hID0gZmlu
ZF92bWEobW0sIGFkZHIpOwotCQlpZiAodm1hICYmIF9fdm1hX21hdGNoZXModm1hLCBvYmotPmJh
c2UuZmlscCwgYWRkciwgYXJncy0+c2l6ZSkpCi0JCQl2bWEtPnZtX3BhZ2VfcHJvdCA9Ci0JCQkJ
cGdwcm90X3dyaXRlY29tYmluZSh2bV9nZXRfcGFnZV9wcm90KHZtYS0+dm1fZmxhZ3MpKTsKLQkJ
ZWxzZQotCQkJYWRkciA9IC1FTk9NRU07Ci0JCXVwX3dyaXRlKCZtbS0+bW1hcF9zZW0pOwotCQlp
ZiAoSVNfRVJSX1ZBTFVFKGFkZHIpKQotCQkJZ290byBlcnI7Ci0KLQkJLyogVGhpcyBtYXkgcmFj
ZSwgYnV0IHRoYXQncyBvaywgaXQgb25seSBnZXRzIHNldCAqLwotCQlXUklURV9PTkNFKG9iai0+
ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4sIE9SSUdJTl9DUFUpOwotCX0KLQlpOTE1X2dlbV9vYmpl
Y3RfcHV0KG9iaik7Ci0KLQlhcmdzLT5hZGRyX3B0ciA9ICh1NjQpYWRkcjsKLQlyZXR1cm4gMDsK
LQotZXJyOgotCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQlyZXR1cm4gYWRkcjsKLX0KLQot
c3RhdGljIHVuc2lnbmVkIGludCB0aWxlX3Jvd19wYWdlcyhjb25zdCBzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQotewotCXJldHVybiBpOTE1X2dlbV9vYmplY3RfZ2V0X3RpbGVfcm93
X3NpemUob2JqKSA+PiBQQUdFX1NISUZUOwotfQotCi0vKioKLSAqIGk5MTVfZ2VtX21tYXBfZ3R0
X3ZlcnNpb24gLSByZXBvcnQgdGhlIGN1cnJlbnQgZmVhdHVyZSBzZXQgZm9yIEdUVCBtbWFwcwot
ICoKLSAqIEEgaGlzdG9yeSBvZiB0aGUgR1RUIG1tYXAgaW50ZXJmYWNlOgotICoKLSAqIDAgLSBF
dmVyeXRoaW5nIGhhZCB0byBmaXQgaW50byB0aGUgR1RULiBCb3RoIHBhcnRpZXMgb2YgYSBtZW1j
cHkgaGFkIHRvCi0gKiAgICAgYWxpZ25lZCBhbmQgc3VpdGFibGUgZm9yIGZlbmNpbmcsIGFuZCBz
dGlsbCBmaXQgaW50byB0aGUgYXZhaWxhYmxlCi0gKiAgICAgbWFwcGFibGUgc3BhY2UgbGVmdCBi
eSB0aGUgcGlubmVkIGRpc3BsYXkgb2JqZWN0cy4gQSBjbGFzc2ljIHByb2JsZW0KLSAqICAgICB3
ZSBjYWxsZWQgdGhlIHBhZ2UtZmF1bHQtb2YtZG9vbSB3aGVyZSB3ZSB3b3VsZCBwaW5nLXBvbmcg
YmV0d2VlbgotICogICAgIHR3byBvYmplY3RzIHRoYXQgY291bGQgbm90IGZpdCBpbnNpZGUgdGhl
IEdUVCBhbmQgc28gdGhlIG1lbWNweQotICogICAgIHdvdWxkIHBhZ2Ugb25lIG9iamVjdCBpbiBh
dCB0aGUgZXhwZW5zZSBvZiB0aGUgb3RoZXIgYmV0d2VlbiBldmVyeQotICogICAgIHNpbmdsZSBi
eXRlLgotICoKLSAqIDEgLSBPYmplY3RzIGNhbiBiZSBhbnkgc2l6ZSwgYW5kIGhhdmUgYW55IGNv
bXBhdGlibGUgZmVuY2luZyAoWCBZLCBvciBub25lCi0gKiAgICAgYXMgc2V0IHZpYSBpOTE1X2dl
bV9zZXRfdGlsaW5nKCkgW0RSTV9JOTE1X0dFTV9TRVRfVElMSU5HXSkuIElmIHRoZQotICogICAg
IG9iamVjdCBpcyB0b28gbGFyZ2UgZm9yIHRoZSBhdmFpbGFibGUgc3BhY2UgKG9yIHNpbXBseSB0
b28gbGFyZ2UKLSAqICAgICBmb3IgdGhlIG1hcHBhYmxlIGFwZXJ0dXJlISksIGEgdmlldyBpcyBj
cmVhdGVkIGluc3RlYWQgYW5kIGZhdWx0ZWQKLSAqICAgICBpbnRvIHVzZXJzcGFjZS4gKFRoaXMg
dmlldyBpcyBhbGlnbmVkIGFuZCBzaXplZCBhcHByb3ByaWF0ZWx5IGZvcgotICogICAgIGZlbmNl
ZCBhY2Nlc3MuKQotICoKLSAqIDIgLSBSZWNvZ25pc2UgV0MgYXMgYSBzZXBhcmF0ZSBjYWNoZSBk
b21haW4gc28gdGhhdCB3ZSBjYW4gZmx1c2ggdGhlCi0gKiAgICAgZGVsYXllZCB3cml0ZXMgdmlh
IEdUVCBiZWZvcmUgcGVyZm9ybWluZyBkaXJlY3QgYWNjZXNzIHZpYSBXQy4KLSAqCi0gKiAzIC0g
UmVtb3ZlIGltcGxpY2l0IHNldC1kb21haW4oR1RUKSBhbmQgc3luY2hyb25pc2F0aW9uIG9uIGlu
aXRpYWwKLSAqICAgICBwYWdlZmF1bHQ7IHN3YXBpbiByZW1haW5zIHRyYW5zcGFyZW50LgotICoK
LSAqIFJlc3RyaWN0aW9uczoKLSAqCi0gKiAgKiBzbm9vcGFibGUgb2JqZWN0cyBjYW5ub3QgYmUg
YWNjZXNzZWQgdmlhIHRoZSBHVFQuIEl0IGNhbiBjYXVzZSBtYWNoaW5lCi0gKiAgICBoYW5ncyBv
biBzb21lIGFyY2hpdGVjdHVyZXMsIGNvcnJ1cHRpb24gb24gb3RoZXJzLiBBbiBhdHRlbXB0IHRv
IHNlcnZpY2UKLSAqICAgIGEgR1RUIHBhZ2UgZmF1bHQgZnJvbSBhIHNub29wYWJsZSBvYmplY3Qg
d2lsbCBnZW5lcmF0ZSBhIFNJR0JVUy4KLSAqCi0gKiAgKiB0aGUgb2JqZWN0IG11c3QgYmUgYWJs
ZSB0byBmaXQgaW50byBSQU0gKHBoeXNpY2FsIG1lbW9yeSwgdGhvdWdoIG5vCi0gKiAgICBsaW1p
dGVkIHRvIHRoZSBtYXBwYWJsZSBhcGVydHVyZSkuCi0gKgotICoKLSAqIENhdmVhdHM6Ci0gKgot
ICogICogYSBuZXcgR1RUIHBhZ2UgZmF1bHQgd2lsbCBzeW5jaHJvbml6ZSByZW5kZXJpbmcgZnJv
bSB0aGUgR1BVIGFuZCBmbHVzaAotICogICAgYWxsIGRhdGEgdG8gc3lzdGVtIG1lbW9yeS4gU3Vi
c2VxdWVudCBhY2Nlc3Mgd2lsbCBub3QgYmUgc3luY2hyb25pemVkLgotICoKLSAqICAqIGFsbCBt
YXBwaW5ncyBhcmUgcmV2b2tlZCBvbiBydW50aW1lIGRldmljZSBzdXNwZW5kLgotICoKLSAqICAq
IHRoZXJlIGFyZSBvbmx5IDgsIDE2IG9yIDMyIGZlbmNlIHJlZ2lzdGVycyB0byBzaGFyZSBiZXR3
ZWVuIGFsbCB1c2VycwotICogICAgKG9sZGVyIG1hY2hpbmVzIHJlcXVpcmUgZmVuY2UgcmVnaXN0
ZXIgZm9yIGRpc3BsYXkgYW5kIGJsaXR0ZXIgYWNjZXNzCi0gKiAgICBhcyB3ZWxsKS4gQ29udGVu
dGlvbiBvZiB0aGUgZmVuY2UgcmVnaXN0ZXJzIHdpbGwgY2F1c2UgdGhlIHByZXZpb3VzIHVzZXJz
Ci0gKiAgICB0byBiZSB1bm1hcHBlZCBhbmQgYW55IG5ldyBhY2Nlc3Mgd2lsbCBnZW5lcmF0ZSBu
ZXcgcGFnZSBmYXVsdHMuCi0gKgotICogICogcnVubmluZyBvdXQgb2YgbWVtb3J5IHdoaWxlIHNl
cnZpY2luZyBhIGZhdWx0IG1heSBnZW5lcmF0ZSBhIFNJR0JVUywKLSAqICAgIHJhdGhlciB0aGFu
IHRoZSBleHBlY3RlZCBTSUdTRUdWLgotICovCi1pbnQgaTkxNV9nZW1fbW1hcF9ndHRfdmVyc2lv
bih2b2lkKQotewotCXJldHVybiAzOwotfQotCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2dn
dHRfdmlldwotY29tcHV0ZV9wYXJ0aWFsX3ZpZXcoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKLQkJICAgICBwZ29mZl90IHBhZ2Vfb2Zmc2V0LAotCQkgICAgIHVuc2lnbmVk
IGludCBjaHVuaykKLXsKLQlzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcgdmlldzsKLQotCWlmIChpOTE1
X2dlbV9vYmplY3RfaXNfdGlsZWQob2JqKSkKLQkJY2h1bmsgPSByb3VuZHVwKGNodW5rLCB0aWxl
X3Jvd19wYWdlcyhvYmopKTsKLQotCXZpZXcudHlwZSA9IEk5MTVfR0dUVF9WSUVXX1BBUlRJQUw7
Ci0Jdmlldy5wYXJ0aWFsLm9mZnNldCA9IHJvdW5kZG93bihwYWdlX29mZnNldCwgY2h1bmspOwot
CXZpZXcucGFydGlhbC5zaXplID0KLQkJbWluX3QodW5zaWduZWQgaW50LCBjaHVuaywKLQkJICAg
ICAgKG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJRlQpIC0gdmlldy5wYXJ0aWFsLm9mZnNldCk7
Ci0KLQkvKiBJZiB0aGUgcGFydGlhbCBjb3ZlcnMgdGhlIGVudGlyZSBvYmplY3QsIGp1c3QgY3Jl
YXRlIGEgbm9ybWFsIFZNQS4gKi8KLQlpZiAoY2h1bmsgPj0gb2JqLT5iYXNlLnNpemUgPj4gUEFH
RV9TSElGVCkKLQkJdmlldy50eXBlID0gSTkxNV9HR1RUX1ZJRVdfTk9STUFMOwotCi0JcmV0dXJu
IHZpZXc7Ci19Ci0KLS8qKgotICogaTkxNV9nZW1fZmF1bHQgLSBmYXVsdCBhIHBhZ2UgaW50byB0
aGUgR1RUCi0gKiBAdm1mOiBmYXVsdCBpbmZvCi0gKgotICogVGhlIGZhdWx0IGhhbmRsZXIgaXMg
c2V0IHVwIGJ5IGRybV9nZW1fbW1hcCgpIHdoZW4gYSBvYmplY3QgaXMgR1RUIG1hcHBlZAotICog
ZnJvbSB1c2Vyc3BhY2UuICBUaGUgZmF1bHQgaGFuZGxlciB0YWtlcyBjYXJlIG9mIGJpbmRpbmcg
dGhlIG9iamVjdCB0bwotICogdGhlIEdUVCAoaWYgbmVlZGVkKSwgYWxsb2NhdGluZyBhbmQgcHJv
Z3JhbW1pbmcgYSBmZW5jZSByZWdpc3RlciAoYWdhaW4sCi0gKiBvbmx5IGlmIG5lZWRlZCBiYXNl
ZCBvbiB3aGV0aGVyIHRoZSBvbGQgcmVnIGlzIHN0aWxsIHZhbGlkIG9yIHRoZSBvYmplY3QKLSAq
IGlzIHRpbGVkKSBhbmQgaW5zZXJ0aW5nIGEgbmV3IFBURSBpbnRvIHRoZSBmYXVsdGluZyBwcm9j
ZXNzLgotICoKLSAqIE5vdGUgdGhhdCB0aGUgZmF1bHRpbmcgcHJvY2VzcyBtYXkgaW52b2x2ZSBl
dmljdGluZyBleGlzdGluZyBvYmplY3RzCi0gKiBmcm9tIHRoZSBHVFQgYW5kL29yIGZlbmNlIHJl
Z2lzdGVycyB0byBtYWtlIHJvb20uICBTbyBwZXJmb3JtYW5jZSBtYXkKLSAqIHN1ZmZlciBpZiB0
aGUgR1RUIHdvcmtpbmcgc2V0IGlzIGxhcmdlIG9yIHRoZXJlIGFyZSBmZXcgZmVuY2UgcmVnaXN0
ZXJzCi0gKiBsZWZ0LgotICoKLSAqIFRoZSBjdXJyZW50IGZlYXR1cmUgc2V0IHN1cHBvcnRlZCBi
eSBpOTE1X2dlbV9mYXVsdCgpIGFuZCB0aHVzIEdUVCBtbWFwcwotICogaXMgZXhwb3NlZCB2aWEg
STkxNV9QQVJBTV9NTUFQX0dUVF9WRVJTSU9OIChzZWUgaTkxNV9nZW1fbW1hcF9ndHRfdmVyc2lv
bikuCi0gKi8KLXZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYp
Ci17Ci0jZGVmaW5lIE1JTl9DSFVOS19QQUdFUyAoU1pfMU0gPj4gUEFHRV9TSElGVCkKLQlzdHJ1
Y3Qgdm1fYXJlYV9zdHJ1Y3QgKmFyZWEgPSB2bWYtPnZtYTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqID0gdG9faW50ZWxfYm8oYXJlYS0+dm1fcHJpdmF0ZV9kYXRhKTsKLQlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gb2JqLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9
ICZkZXZfcHJpdi0+Z2d0dDsKLQlib29sIHdyaXRlID0gYXJlYS0+dm1fZmxhZ3MgJiBWTV9XUklU
RTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlw
Z29mZl90IHBhZ2Vfb2Zmc2V0OwotCWludCBzcmN1OwotCWludCByZXQ7Ci0KLQkvKiBTYW5pdHkg
Y2hlY2sgdGhhdCB3ZSBhbGxvdyB3cml0aW5nIGludG8gdGhpcyBvYmplY3QgKi8KLQlpZiAoaTkx
NV9nZW1fb2JqZWN0X2lzX3JlYWRvbmx5KG9iaikgJiYgd3JpdGUpCi0JCXJldHVybiBWTV9GQVVM
VF9TSUdCVVM7Ci0KLQkvKiBXZSBkb24ndCB1c2Ugdm1mLT5wZ29mZiBzaW5jZSB0aGF0IGhhcyB0
aGUgZmFrZSBvZmZzZXQgKi8KLQlwYWdlX29mZnNldCA9ICh2bWYtPmFkZHJlc3MgLSBhcmVhLT52
bV9zdGFydCkgPj4gUEFHRV9TSElGVDsKLQotCXRyYWNlX2k5MTVfZ2VtX29iamVjdF9mYXVsdChv
YmosIHBhZ2Vfb2Zmc2V0LCB0cnVlLCB3cml0ZSk7Ci0KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rf
cGluX3BhZ2VzKG9iaik7Ci0JaWYgKHJldCkKLQkJZ290byBlcnI7Ci0KLQl3YWtlcmVmID0gaW50
ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOwotCi0Jc3JjdSA9IGk5MTVfcmVzZXRfdHJ5bG9j
ayhkZXZfcHJpdik7Ci0JaWYgKHNyY3UgPCAwKSB7Ci0JCXJldCA9IHNyY3U7Ci0JCWdvdG8gZXJy
X3JwbTsKLQl9Ci0KLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwot
CWlmIChyZXQpCi0JCWdvdG8gZXJyX3Jlc2V0OwotCi0JLyogQWNjZXNzIHRvIHNub29wYWJsZSBw
YWdlcyB0aHJvdWdoIHRoZSBHVFQgaXMgaW5jb2hlcmVudC4gKi8KLQlpZiAob2JqLT5jYWNoZV9s
ZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUgJiYgIUhBU19MTEMoZGV2X3ByaXYpKSB7Ci0JCXJldCA9
IC1FRkFVTFQ7Ci0JCWdvdG8gZXJyX3VubG9jazsKLQl9Ci0KLQkvKiBOb3cgcGluIGl0IGludG8g
dGhlIEdUVCBhcyBuZWVkZWQgKi8KLQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2Jq
LCBOVUxMLCAwLCAwLAotCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfAotCQkJCSAgICAgICBQSU5f
Tk9OQkxPQ0sgfAotCQkJCSAgICAgICBQSU5fTk9ORkFVTFQpOwotCWlmIChJU19FUlIodm1hKSkg
ewotCQkvKiBVc2UgYSBwYXJ0aWFsIHZpZXcgaWYgaXQgaXMgYmlnZ2VyIHRoYW4gYXZhaWxhYmxl
IHNwYWNlICovCi0JCXN0cnVjdCBpOTE1X2dndHRfdmlldyB2aWV3ID0KLQkJCWNvbXB1dGVfcGFy
dGlhbF92aWV3KG9iaiwgcGFnZV9vZmZzZXQsIE1JTl9DSFVOS19QQUdFUyk7Ci0JCXVuc2lnbmVk
IGludCBmbGFnczsKLQotCQlmbGFncyA9IFBJTl9NQVBQQUJMRTsKLQkJaWYgKHZpZXcudHlwZSA9
PSBJOTE1X0dHVFRfVklFV19OT1JNQUwpCi0JCQlmbGFncyB8PSBQSU5fTk9OQkxPQ0s7IC8qIGF2
b2lkIHdhcm5pbmdzIGZvciBwaW5uZWQgKi8KLQotCQkvKgotCQkgKiBVc2Vyc3BhY2UgaXMgbm93
IHdyaXRpbmcgdGhyb3VnaCBhbiB1bnRyYWNrZWQgVk1BLCBhYmFuZG9uCi0JCSAqIGFsbCBob3Bl
IHRoYXQgdGhlIGhhcmR3YXJlIGlzIGFibGUgdG8gdHJhY2sgZnV0dXJlIHdyaXRlcy4KLQkJICov
Ci0JCW9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4gPSBPUklHSU5fQ1BVOwotCi0JCXZtYSA9
IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosICZ2aWV3LCAwLCAwLCBmbGFncyk7Ci0JCWlm
IChJU19FUlIodm1hKSAmJiAhdmlldy50eXBlKSB7Ci0JCQlmbGFncyA9IFBJTl9NQVBQQUJMRTsK
LQkJCXZpZXcudHlwZSA9IEk5MTVfR0dUVF9WSUVXX1BBUlRJQUw7Ci0JCQl2bWEgPSBpOTE1X2dl
bV9vYmplY3RfZ2d0dF9waW4ob2JqLCAmdmlldywgMCwgMCwgZmxhZ3MpOwotCQl9Ci0JfQotCWlm
IChJU19FUlIodm1hKSkgewotCQlyZXQgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyX3VubG9j
azsKLQl9Ci0KLQlyZXQgPSBpOTE1X3ZtYV9waW5fZmVuY2Uodm1hKTsKLQlpZiAocmV0KQotCQln
b3RvIGVycl91bnBpbjsKLQotCS8qIEZpbmFsbHksIHJlbWFwIGl0IHVzaW5nIHRoZSBuZXcgR1RU
IG9mZnNldCAqLwotCXJldCA9IHJlbWFwX2lvX21hcHBpbmcoYXJlYSwKLQkJCSAgICAgICBhcmVh
LT52bV9zdGFydCArICh2bWEtPmdndHRfdmlldy5wYXJ0aWFsLm9mZnNldCA8PCBQQUdFX1NISUZU
KSwKLQkJCSAgICAgICAoZ2d0dC0+Z21hZHIuc3RhcnQgKyB2bWEtPm5vZGUuc3RhcnQpID4+IFBB
R0VfU0hJRlQsCi0JCQkgICAgICAgbWluX3QodTY0LCB2bWEtPnNpemUsIGFyZWEtPnZtX2VuZCAt
IGFyZWEtPnZtX3N0YXJ0KSwKLQkJCSAgICAgICAmZ2d0dC0+aW9tYXApOwotCWlmIChyZXQpCi0J
CWdvdG8gZXJyX2ZlbmNlOwotCi0JLyogTWFyayBhcyBiZWluZyBtbWFwcGVkIGludG8gdXNlcnNw
YWNlIGZvciBsYXRlciByZXZvY2F0aW9uICovCi0JYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKGRl
dl9wcml2KTsKLQlpZiAoIWk5MTVfdm1hX3NldF91c2VyZmF1bHQodm1hKSAmJiAhb2JqLT51c2Vy
ZmF1bHRfY291bnQrKykKLQkJbGlzdF9hZGQoJm9iai0+dXNlcmZhdWx0X2xpbmssICZkZXZfcHJp
di0+bW0udXNlcmZhdWx0X2xpc3QpOwotCWlmIChDT05GSUdfRFJNX0k5MTVfVVNFUkZBVUxUX0FV
VE9TVVNQRU5EKQotCQlpbnRlbF93YWtlcmVmX2F1dG8oJmRldl9wcml2LT5tbS51c2VyZmF1bHRf
d2FrZXJlZiwKLQkJCQkgICBtc2Vjc190b19qaWZmaWVzX3RpbWVvdXQoQ09ORklHX0RSTV9JOTE1
X1VTRVJGQVVMVF9BVVRPU1VTUEVORCkpOwotCUdFTV9CVUdfT04oIW9iai0+dXNlcmZhdWx0X2Nv
dW50KTsKLQotCWk5MTVfdm1hX3NldF9nZ3R0X3dyaXRlKHZtYSk7Ci0KLWVycl9mZW5jZToKLQlp
OTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOwotZXJyX3VucGluOgotCV9faTkxNV92bWFfdW5waW4o
dm1hKTsKLWVycl91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci1l
cnJfcmVzZXQ6Ci0JaTkxNV9yZXNldF91bmxvY2soZGV2X3ByaXYsIHNyY3UpOwotZXJyX3JwbToK
LQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7Ci0JaTkxNV9nZW1fb2Jq
ZWN0X3VucGluX3BhZ2VzKG9iaik7Ci1lcnI6Ci0Jc3dpdGNoIChyZXQpIHsKLQljYXNlIC1FSU86
Ci0JCS8qCi0JCSAqIFdlIGVhdCBlcnJvcnMgd2hlbiB0aGUgZ3B1IGlzIHRlcm1pbmFsbHkgd2Vk
Z2VkIHRvIGF2b2lkCi0JCSAqIHVzZXJzcGFjZSB1bmR1bHkgY3Jhc2hpbmcgKGdsIGhhcyBubyBw
cm92aXNpb25zIGZvciBtbWFwcyB0bwotCQkgKiBmYWlsKS4gQnV0IGFueSBvdGhlciAtRUlPIGlz
bid0IG91cnMgKGUuZy4gc3dhcCBpbiBmYWlsdXJlKQotCQkgKiBhbmQgc28gbmVlZHMgdG8gYmUg
cmVwb3J0ZWQuCi0JCSAqLwotCQlpZiAoIWk5MTVfdGVybWluYWxseV93ZWRnZWQoZGV2X3ByaXYp
KQotCQkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKLQkJLyogZWxzZTogZmFsbCB0aHJvdWdoICov
Ci0JY2FzZSAtRUFHQUlOOgotCQkvKgotCQkgKiBFQUdBSU4gbWVhbnMgdGhlIGdwdSBpcyBodW5n
IGFuZCB3ZSdsbCB3YWl0IGZvciB0aGUgZXJyb3IKLQkJICogaGFuZGxlciB0byByZXNldCBldmVy
eXRoaW5nIHdoZW4gcmUtZmF1bHRpbmcgaW4KLQkJICogaTkxNV9tdXRleF9sb2NrX2ludGVycnVw
dGlibGUuCi0JCSAqLwotCWNhc2UgMDoKLQljYXNlIC1FUkVTVEFSVFNZUzoKLQljYXNlIC1FSU5U
UjoKLQljYXNlIC1FQlVTWToKLQkJLyoKLQkJICogRUJVU1kgaXMgb2s6IHRoaXMganVzdCBtZWFu
cyB0aGF0IGFub3RoZXIgdGhyZWFkCi0JCSAqIGFscmVhZHkgZGlkIHRoZSBqb2IuCi0JCSAqLwot
CQlyZXR1cm4gVk1fRkFVTFRfTk9QQUdFOwotCWNhc2UgLUVOT01FTToKLQkJcmV0dXJuIFZNX0ZB
VUxUX09PTTsKLQljYXNlIC1FTk9TUEM6Ci0JY2FzZSAtRUZBVUxUOgotCQlyZXR1cm4gVk1fRkFV
TFRfU0lHQlVTOwotCWRlZmF1bHQ6Ci0JCVdBUk5fT05DRShyZXQsICJ1bmhhbmRsZWQgZXJyb3Ig
aW4gaTkxNV9nZW1fZmF1bHQ6ICVpXG4iLCByZXQpOwotCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVT
OwotCX0KLX0KLQotc3RhdGljIHZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7
Ci0KLQlHRU1fQlVHX09OKCFvYmotPnVzZXJmYXVsdF9jb3VudCk7Ci0KLQlvYmotPnVzZXJmYXVs
dF9jb3VudCA9IDA7Ci0JbGlzdF9kZWwoJm9iai0+dXNlcmZhdWx0X2xpbmspOwotCWRybV92bWFf
bm9kZV91bm1hcCgmb2JqLT5iYXNlLnZtYV9ub2RlLAotCQkJICAgb2JqLT5iYXNlLmRldi0+YW5v
bl9pbm9kZS0+aV9tYXBwaW5nKTsKLQotCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKQotCQlp
OTE1X3ZtYV91bnNldF91c2VyZmF1bHQodm1hKTsKLX0KLQotLyoqCi0gKiBpOTE1X2dlbV9yZWxl
YXNlX21tYXAgLSByZW1vdmUgcGh5c2ljYWwgcGFnZSBtYXBwaW5ncwotICogQG9iajogb2JqIGlu
IHF1ZXN0aW9uCi0gKgotICogUHJlc2VydmUgdGhlIHJlc2VydmF0aW9uIG9mIHRoZSBtbWFwcGlu
ZyB3aXRoIHRoZSBEUk0gY29yZSBjb2RlLCBidXQKLSAqIHJlbGlucXVpc2ggb3duZXJzaGlwIG9m
IHRoZSBwYWdlcyBiYWNrIHRvIHRoZSBzeXN0ZW0uCi0gKgotICogSXQgaXMgdml0YWwgdGhhdCB3
ZSByZW1vdmUgdGhlIHBhZ2UgbWFwcGluZyBpZiB3ZSBoYXZlIG1hcHBlZCBhIHRpbGVkCi0gKiBv
YmplY3QgdGhyb3VnaCB0aGUgR1RUIGFuZCB0aGVuIGxvc2UgdGhlIGZlbmNlIHJlZ2lzdGVyIGR1
ZSB0bwotICogcmVzb3VyY2UgcHJlc3N1cmUuIFNpbWlsYXJseSBpZiB0aGUgb2JqZWN0IGhhcyBi
ZWVuIG1vdmVkIG91dCBvZiB0aGUKLSAqIGFwZXJ0dXJlLCB0aGFuIHBhZ2VzIG1hcHBlZCBpbnRv
IHVzZXJzcGFjZSBtdXN0IGJlIHJldm9rZWQuIFJlbW92aW5nIHRoZQotICogbWFwcGluZyB3aWxs
IHRoZW4gdHJpZ2dlciBhIHBhZ2UgZmF1bHQgb24gdGhlIG5leHQgdXNlciBhY2Nlc3MsIGFsbG93
aW5nCi0gKiBmaXh1cCBieSBpOTE1X2dlbV9mYXVsdCgpLgotICovCi12b2lkCi1pOTE1X2dlbV9y
ZWxlYXNlX21tYXAoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0JaW50ZWxf
d2FrZXJlZl90IHdha2VyZWY7Ci0KLQkvKiBTZXJpYWxpc2F0aW9uIGJldHdlZW4gdXNlciBHVFQg
YWNjZXNzIGFuZCBvdXIgY29kZSBkZXBlbmRzIHVwb24KLQkgKiByZXZva2luZyB0aGUgQ1BVJ3Mg
UFRFIHdoaWxzdCB0aGUgbXV0ZXggaXMgaGVsZC4gVGhlIG5leHQgdXNlcgotCSAqIHBhZ2VmYXVs
dCB0aGVuIGhhcyB0byB3YWl0IHVudGlsIHdlIHJlbGVhc2UgdGhlIG11dGV4LgotCSAqCi0JICog
Tm90ZSB0aGF0IFJQTSBjb21wbGljYXRlcyBzb21ld2hhdCBieSBhZGRpbmcgYW4gYWRkaXRpb25h
bAotCSAqIHJlcXVpcmVtZW50IHRoYXQgb3BlcmF0aW9ucyB0byB0aGUgR0dUVCBiZSBtYWRlIGhv
bGRpbmcgdGhlIFJQTQotCSAqIHdha2VyZWYuCi0JICovCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0
KGk5MTUpOwotCi0JaWYgKCFvYmotPnVzZXJmYXVsdF9jb3VudCkKLQkJZ290byBvdXQ7Ci0KLQlf
X2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX21tYXAob2JqKTsKLQotCS8qIEVuc3VyZSB0aGF0IHRo
ZSBDUFUncyBQVEUgYXJlIHJldm9rZWQgYW5kIHRoZXJlIGFyZSBub3Qgb3V0c3RhbmRpbmcKLQkg
KiBtZW1vcnkgdHJhbnNhY3Rpb25zIGZyb20gdXNlcnNwYWNlIGJlZm9yZSB3ZSByZXR1cm4uIFRo
ZSBUTEIKLQkgKiBmbHVzaGluZyBpbXBsaWVkIGFib3ZlIGJ5IGNoYW5naW5nIHRoZSBQVEUgYWJv
dmUgKnNob3VsZCogYmUKLQkgKiBzdWZmaWNpZW50LCBhbiBleHRyYSBiYXJyaWVyIGhlcmUganVz
dCBwcm92aWRlcyB1cyB3aXRoIGEgYml0Ci0JICogb2YgcGFyYW5vaWQgZG9jdW1lbnRhdGlvbiBh
Ym91dCBvdXIgcmVxdWlyZW1lbnQgdG8gc2VyaWFsaXNlCi0JICogbWVtb3J5IHdyaXRlcyBiZWZv
cmUgdG91Y2hpbmcgcmVnaXN0ZXJzIC8gR1NNLgotCSAqLwotCXdtYigpOwotCi1vdXQ6Ci0JaW50
ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7Ci19Ci0KIHZvaWQgaTkxNV9nZW1fcnVu
dGltZV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCAqb247CkBAIC0xODA5LDc4ICsxMzQ1LDYgQEAg
dm9pZCBpOTE1X2dlbV9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCX0KIH0KIAotc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX21tYXBf
b2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKLQlpbnQgZXJy
OwotCi0JZXJyID0gZHJtX2dlbV9jcmVhdGVfbW1hcF9vZmZzZXQoJm9iai0+YmFzZSk7Ci0JaWYg
KGxpa2VseSghZXJyKSkKLQkJcmV0dXJuIDA7Ci0KLQkvKiBBdHRlbXB0IHRvIHJlYXAgc29tZSBt
bWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3RzICovCi0JZG8gewotCQllcnIgPSBpOTE1X2dlbV93
YWl0X2Zvcl9pZGxlKGRldl9wcml2LAotCQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxF
LAotCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQkJaWYgKGVycikKLQkJCWJyZWFr
OwotCi0JCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoZGV2X3ByaXYpOwotCQllcnIgPSBk
cm1fZ2VtX2NyZWF0ZV9tbWFwX29mZnNldCgmb2JqLT5iYXNlKTsKLQkJaWYgKCFlcnIpCi0JCQli
cmVhazsKLQotCX0gd2hpbGUgKGZsdXNoX2RlbGF5ZWRfd29yaygmZGV2X3ByaXYtPmdlbS5yZXRp
cmVfd29yaykpOwotCi0JcmV0dXJuIGVycjsKLX0KLQotaW50Ci1pOTE1X2dlbV9tbWFwX2d0dChz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCi0JCSAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICB1
MzIgaGFuZGxlLAotCQkgIHU2NCAqb2Zmc2V0KQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmo7Ci0JaW50IHJldDsKLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXAoZmls
ZSwgaGFuZGxlKTsKLQlpZiAoIW9iaikKLQkJcmV0dXJuIC1FTk9FTlQ7Ci0KLQlyZXQgPSBpOTE1
X2dlbV9vYmplY3RfY3JlYXRlX21tYXBfb2Zmc2V0KG9iaik7Ci0JaWYgKHJldCA9PSAwKQotCQkq
b2Zmc2V0ID0gZHJtX3ZtYV9ub2RlX29mZnNldF9hZGRyKCZvYmotPmJhc2Uudm1hX25vZGUpOwot
Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCXJldHVybiByZXQ7Ci19Ci0KLS8qKgotICog
aTkxNV9nZW1fbW1hcF9ndHRfaW9jdGwgLSBwcmVwYXJlIGFuIG9iamVjdCBmb3IgR1RUIG1tYXAn
aW5nCi0gKiBAZGV2OiBEUk0gZGV2aWNlCi0gKiBAZGF0YTogR1RUIG1hcHBpbmcgaW9jdGwgZGF0
YQotICogQGZpbGU6IEdFTSBvYmplY3QgaW5mbwotICoKLSAqIFNpbXBseSByZXR1cm5zIHRoZSBm
YWtlIG9mZnNldCB0byB1c2Vyc3BhY2Ugc28gaXQgY2FuIG1tYXAgaXQuCi0gKiBUaGUgbW1hcCBj
YWxsIHdpbGwgZW5kIHVwIGluIGRybV9nZW1fbW1hcCgpLCB3aGljaCB3aWxsIHNldCB0aGluZ3MK
LSAqIHVwIHNvIHdlIGNhbiBnZXQgZmF1bHRzIGluIHRoZSBoYW5kbGVyIGFib3ZlLgotICoKLSAq
IFRoZSBmYXVsdCBoYW5kbGVyIHdpbGwgdGFrZSBjYXJlIG9mIGJpbmRpbmcgdGhlIG9iamVjdCBp
bnRvIHRoZSBHVFQKLSAqIChzaW5jZSBpdCBtYXkgaGF2ZSBiZWVuIGV2aWN0ZWQgdG8gbWFrZSBy
b29tIGZvciBzb21ldGhpbmcpLCBhbGxvY2F0aW5nCi0gKiBhIGZlbmNlIHJlZ2lzdGVyLCBhbmQg
bWFwcGluZyB0aGUgYXBwcm9wcmlhdGUgYXBlcnR1cmUgYWRkcmVzcyBpbnRvCi0gKiB1c2Vyc3Bh
Y2UuCi0gKi8KLWludAotaTkxNV9nZW1fbW1hcF9ndHRfaW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdm9pZCAqZGF0YSwKLQkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX21tYXBfZ3R0ICphcmdzID0gZGF0YTsKLQotCXJldHVybiBpOTE1X2dlbV9t
bWFwX2d0dChmaWxlLCBkZXYsIGFyZ3MtPmhhbmRsZSwgJmFyZ3MtPm9mZnNldCk7Ci19Ci0KIGJv
b2wgaTkxNV9zZ190cmltKHN0cnVjdCBzZ190YWJsZSAqb3JpZ19zdCkKIHsKIAlzdHJ1Y3Qgc2df
dGFibGUgbmV3X3N0OwpAQCAtMjA4NCw3ICsxNTQ4LDcgQEAgc3RhdGljIHZvaWQgX19pOTE1X2dl
bV9vYmplY3RfZmx1c2hfZm9yX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aikKIAkgKiBXZSBtYW51YWxseSBmbHVzaCB0aGUgQ1BVIGRvbWFpbiBzbyB0aGF0IHdlIGNhbiBv
dmVycmlkZSBhbmQKIAkgKiBmb3JjZSB0aGUgZmx1c2ggZm9yIHRoZSBkaXNwbGF5LCBhbmQgcGVy
Zm9ybSBpdCBhc3luY3Job25vdXNseS4KIAkgKi8KLQlmbHVzaF93cml0ZV9kb21haW4ob2JqLCB+
STkxNV9HRU1fRE9NQUlOX0NQVSk7CisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRlX2RvbWFp
bihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKIAlpZiAob2JqLT5jYWNoZV9kaXJ0eSkKIAkJ
aTkxNV9nZW1fY2xmbHVzaF9vYmplY3Qob2JqLCBJOTE1X0NMRkxVU0hfRk9SQ0UpOwogCW9iai0+
d3JpdGVfZG9tYWluID0gMDsKQEAgLTIxMzgsNyArMTYwMiw3IEBAIGk5MTVfZ2VtX29iamVjdF9z
ZXRfdG9fd2NfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGJvb2wgd3Jp
dGUpCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWZsdXNoX3dyaXRlX2RvbWFpbihvYmos
IH5JOTE1X0dFTV9ET01BSU5fV0MpOworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21h
aW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX1dDKTsKIAogCS8qIFNlcmlhbGlzZSBkaXJlY3QgYWNj
ZXNzIHRvIHRoaXMgb2JqZWN0IHdpdGggdGhlIGJhcnJpZXJzIGZvcgogCSAqIGNvaGVyZW50IHdy
aXRlcyBmcm9tIHRoZSBHUFUsIGJ5IGVmZmVjdGl2ZWx5IGludmFsaWRhdGluZyB0aGUKQEAgLTIy
MDAsNyArMTY2NCw3IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBib29sIHdyaXRlKQogCWlmIChyZXQpCiAJCXJldHVy
biByZXQ7CiAKLQlmbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0dUVCk7
CisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01B
SU5fR1RUKTsKIAogCS8qIFNlcmlhbGlzZSBkaXJlY3QgYWNjZXNzIHRvIHRoaXMgb2JqZWN0IHdp
dGggdGhlIGJhcnJpZXJzIGZvcgogCSAqIGNvaGVyZW50IHdyaXRlcyBmcm9tIHRoZSBHUFUsIGJ5
IGVmZmVjdGl2ZWx5IGludmFsaWRhdGluZyB0aGUKQEAgLTIzMDksNyArMTc3Myw3IEBAIGludCBp
OTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCQkgKiB0aGVuIGRvdWJsZSBjaGVjayBpZiB0aGUgR1RUIG1hcHBpbmcgaXMgc3Rp
bGwKIAkJCSAqIHZhbGlkIGZvciB0aGF0IHBvaW50ZXIgYWNjZXNzLgogCQkJICovCi0JCQlpOTE1
X2dlbV9yZWxlYXNlX21tYXAob2JqKTsKKwkJCWk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX21tYXAo
b2JqKTsKIAogCQkJLyogQXMgd2Ugbm8gbG9uZ2VyIG5lZWQgYSBmZW5jZSBmb3IgR1RUIGFjY2Vz
cywKIAkJCSAqIHdlIGNhbiByZWxpbnF1aXNoIGl0IG5vdyAoYW5kIHNvIHByZXZlbnQgaGF2aW5n
CkBAIC0yNTY0LDcgKzIwMjgsNyBAQCBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4o
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSkKIAlpZiAocmV0KQog
CQlyZXR1cm4gcmV0OwogCi0JZmx1c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJ
Tl9DUFUpOworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9H
RU1fRE9NQUlOX0NQVSk7CiAKIAkvKiBGbHVzaCB0aGUgQ1BVIGNhY2hlIGlmIGl0J3Mgc3RpbGwg
aW52YWxpZC4gKi8KIAlpZiAoKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlOX0NQ
VSkgPT0gMCkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fdGls
aW5nLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV90aWxpbmcuYwppbmRleCA3ZDVj
YzljY2Y2ZGQuLjg2ZDZkOTJjY2JjOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fdGlsaW5nLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fdGls
aW5nLmMKQEAgLTI5OSw3ICsyOTksNyBAQCBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2Jq
KTsKIAogCS8qIEZvcmNlIHRoZSBmZW5jZSB0byBiZSByZWFjcXVpcmVkIGZvciBHVFQgYWNjZXNz
ICovCi0JaTkxNV9nZW1fcmVsZWFzZV9tbWFwKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3JlbGVh
c2VfbW1hcChvYmopOwogCiAJLyogVHJ5IHRvIHByZWFsbG9jYXRlIG1lbW9yeSByZXF1aXJlZCB0
byBzYXZlIHN3aXp6bGluZyBvbiBwdXQtcGFnZXMgKi8KIAlpZiAoaTkxNV9nZW1fb2JqZWN0X25l
ZWRzX2JpdDE3X3N3aXp6bGUob2JqKSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jCmluZGV4IGI5OGEyODZhOGJlNS4uYTNkZDJmMWJlOTVi
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2Jq
ZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVj
dC5jCkBAIC04OSw0OTEgKzg5LDYgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2h1Z2Uodm9pZCAqYXJn
KQogCXJldHVybiBlcnI7CiB9CiAKLXN0cnVjdCB0aWxlIHsKLQl1bnNpZ25lZCBpbnQgd2lkdGg7
Ci0JdW5zaWduZWQgaW50IGhlaWdodDsKLQl1bnNpZ25lZCBpbnQgc3RyaWRlOwotCXVuc2lnbmVk
IGludCBzaXplOwotCXVuc2lnbmVkIGludCB0aWxpbmc7Ci0JdW5zaWduZWQgaW50IHN3aXp6bGU7
Ci19OwotCi1zdGF0aWMgdTY0IHN3aXp6bGVfYml0KHVuc2lnbmVkIGludCBiaXQsIHU2NCBvZmZz
ZXQpCi17Ci0JcmV0dXJuIChvZmZzZXQgJiBCSVRfVUxMKGJpdCkpID4+IChiaXQgLSA2KTsKLX0K
LQotc3RhdGljIHU2NCB0aWxlZF9vZmZzZXQoY29uc3Qgc3RydWN0IHRpbGUgKnRpbGUsIHU2NCB2
KQotewotCXU2NCB4LCB5OwotCi0JaWYgKHRpbGUtPnRpbGluZyA9PSBJOTE1X1RJTElOR19OT05F
KQotCQlyZXR1cm4gdjsKLQotCXkgPSBkaXY2NF91NjRfcmVtKHYsIHRpbGUtPnN0cmlkZSwgJngp
OwotCXYgPSBkaXY2NF91NjRfcmVtKHksIHRpbGUtPmhlaWdodCwgJnkpICogdGlsZS0+c3RyaWRl
ICogdGlsZS0+aGVpZ2h0OwotCi0JaWYgKHRpbGUtPnRpbGluZyA9PSBJOTE1X1RJTElOR19YKSB7
Ci0JCXYgKz0geSAqIHRpbGUtPndpZHRoOwotCQl2ICs9IGRpdjY0X3U2NF9yZW0oeCwgdGlsZS0+
d2lkdGgsICZ4KSA8PCB0aWxlLT5zaXplOwotCQl2ICs9IHg7Ci0JfSBlbHNlIGlmICh0aWxlLT53
aWR0aCA9PSAxMjgpIHsKLQkJY29uc3QgdW5zaWduZWQgaW50IHl0aWxlX3NwYW4gPSAxNjsKLQkJ
Y29uc3QgdW5zaWduZWQgaW50IHl0aWxlX2hlaWdodCA9IDUxMjsKLQotCQl2ICs9IHkgKiB5dGls
ZV9zcGFuOwotCQl2ICs9IGRpdjY0X3U2NF9yZW0oeCwgeXRpbGVfc3BhbiwgJngpICogeXRpbGVf
aGVpZ2h0OwotCQl2ICs9IHg7Ci0JfSBlbHNlIHsKLQkJY29uc3QgdW5zaWduZWQgaW50IHl0aWxl
X3NwYW4gPSAzMjsKLQkJY29uc3QgdW5zaWduZWQgaW50IHl0aWxlX2hlaWdodCA9IDI1NjsKLQot
CQl2ICs9IHkgKiB5dGlsZV9zcGFuOwotCQl2ICs9IGRpdjY0X3U2NF9yZW0oeCwgeXRpbGVfc3Bh
biwgJngpICogeXRpbGVfaGVpZ2h0OwotCQl2ICs9IHg7Ci0JfQotCi0Jc3dpdGNoICh0aWxlLT5z
d2l6emxlKSB7Ci0JY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOToKLQkJdiBePSBzd2l6emxlX2Jp
dCg5LCB2KTsKLQkJYnJlYWs7Ci0JY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMDoKLQkJdiBe
PSBzd2l6emxlX2JpdCg5LCB2KSBeIHN3aXp6bGVfYml0KDEwLCB2KTsKLQkJYnJlYWs7Ci0JY2Fz
ZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMToKLQkJdiBePSBzd2l6emxlX2JpdCg5LCB2KSBeIHN3
aXp6bGVfYml0KDExLCB2KTsKLQkJYnJlYWs7Ci0JY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8x
MF8xMToKLQkJdiBePSBzd2l6emxlX2JpdCg5LCB2KSBeIHN3aXp6bGVfYml0KDEwLCB2KSBeIHN3
aXp6bGVfYml0KDExLCB2KTsKLQkJYnJlYWs7Ci0JfQotCi0JcmV0dXJuIHY7Ci19Ci0KLXN0YXRp
YyBpbnQgY2hlY2tfcGFydGlhbF9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmosCi0JCQkJIGNvbnN0IHN0cnVjdCB0aWxlICp0aWxlLAotCQkJCSB1bnNpZ25lZCBsb25nIGVu
ZF90aW1lKQotewotCWNvbnN0IHVuc2lnbmVkIGludCBucmVhbCA9IG9iai0+c2NyYXRjaCAvIFBB
R0VfU0laRTsKLQljb25zdCB1bnNpZ25lZCBsb25nIG5wYWdlcyA9IG9iai0+YmFzZS5zaXplIC8g
UEFHRV9TSVpFOwotCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCXVuc2lnbmVkIGxvbmcgcGFnZTsK
LQlpbnQgZXJyOwotCi0JaWYgKGlndF90aW1lb3V0KGVuZF90aW1lLAotCQkJIiVzOiB0aW1lZCBv
dXQgYmVmb3JlIHRpbGluZz0lZCBzdHJpZGU9JWRcbiIsCi0JCQlfX2Z1bmNfXywgdGlsZS0+dGls
aW5nLCB0aWxlLT5zdHJpZGUpKQotCQlyZXR1cm4gLUVJTlRSOwotCi0JZXJyID0gaTkxNV9nZW1f
b2JqZWN0X3NldF90aWxpbmcob2JqLCB0aWxlLT50aWxpbmcsIHRpbGUtPnN0cmlkZSk7Ci0JaWYg
KGVycikgewotCQlwcl9lcnIoIkZhaWxlZCB0byBzZXQgdGlsaW5nIG1vZGU9JXUsIHN0cmlkZT0l
dSwgZXJyPSVkXG4iLAotCQkgICAgICAgdGlsZS0+dGlsaW5nLCB0aWxlLT5zdHJpZGUsIGVycik7
Ci0JCXJldHVybiBlcnI7Ci0JfQotCi0JR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3RfZ2V0X3Rp
bGluZyhvYmopICE9IHRpbGUtPnRpbGluZyk7Ci0JR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3Rf
Z2V0X3N0cmlkZShvYmopICE9IHRpbGUtPnN0cmlkZSk7Ci0KLQlmb3JfZWFjaF9wcmltZV9udW1i
ZXJfZnJvbShwYWdlLCAxLCBucGFnZXMpIHsKLQkJc3RydWN0IGk5MTVfZ2d0dF92aWV3IHZpZXcg
PQotCQkJY29tcHV0ZV9wYXJ0aWFsX3ZpZXcob2JqLCBwYWdlLCBNSU5fQ0hVTktfUEFHRVMpOwot
CQl1MzIgX19pb21lbSAqaW87Ci0JCXN0cnVjdCBwYWdlICpwOwotCQl1bnNpZ25lZCBpbnQgbjsK
LQkJdTY0IG9mZnNldDsKLQkJdTMyICpjcHU7Ci0KLQkJR0VNX0JVR19PTih2aWV3LnBhcnRpYWwu
c2l6ZSA+IG5yZWFsKTsKLQkJY29uZF9yZXNjaGVkKCk7Ci0KLQkJZXJyID0gaTkxNV9nZW1fb2Jq
ZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgdHJ1ZSk7Ci0JCWlmIChlcnIpIHsKLQkJCXByX2Vy
cigiRmFpbGVkIHRvIGZsdXNoIHRvIEdUVCB3cml0ZSBkb21haW47IGVycj0lZFxuIiwKLQkJCSAg
ICAgICBlcnIpOwotCQkJcmV0dXJuIGVycjsKLQkJfQotCi0JCXZtYSA9IGk5MTVfZ2VtX29iamVj
dF9nZ3R0X3BpbihvYmosICZ2aWV3LCAwLCAwLCBQSU5fTUFQUEFCTEUpOwotCQlpZiAoSVNfRVJS
KHZtYSkpIHsKLQkJCXByX2VycigiRmFpbGVkIHRvIHBpbiBwYXJ0aWFsIHZpZXc6IG9mZnNldD0l
bHU7IGVycj0lZFxuIiwKLQkJCSAgICAgICBwYWdlLCAoaW50KVBUUl9FUlIodm1hKSk7Ci0JCQly
ZXR1cm4gUFRSX0VSUih2bWEpOwotCQl9Ci0KLQkJbiA9IHBhZ2UgLSB2aWV3LnBhcnRpYWwub2Zm
c2V0OwotCQlHRU1fQlVHX09OKG4gPj0gdmlldy5wYXJ0aWFsLnNpemUpOwotCi0JCWlvID0gaTkx
NV92bWFfcGluX2lvbWFwKHZtYSk7Ci0JCWk5MTVfdm1hX3VucGluKHZtYSk7Ci0JCWlmIChJU19F
UlIoaW8pKSB7Ci0JCQlwcl9lcnIoIkZhaWxlZCB0byBpb21hcCBwYXJ0aWFsIHZpZXc6IG9mZnNl
dD0lbHU7IGVycj0lZFxuIiwKLQkJCSAgICAgICBwYWdlLCAoaW50KVBUUl9FUlIoaW8pKTsKLQkJ
CXJldHVybiBQVFJfRVJSKGlvKTsKLQkJfQotCi0JCWlvd3JpdGUzMihwYWdlLCBpbyArIG4gKiBQ
QUdFX1NJWkUvc2l6ZW9mKCppbykpOwotCQlpOTE1X3ZtYV91bnBpbl9pb21hcCh2bWEpOwotCi0J
CW9mZnNldCA9IHRpbGVkX29mZnNldCh0aWxlLCBwYWdlIDw8IFBBR0VfU0hJRlQpOwotCQlpZiAo
b2Zmc2V0ID49IG9iai0+YmFzZS5zaXplKQotCQkJY29udGludWU7Ci0KLQkJZmx1c2hfd3JpdGVf
ZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOwotCi0JCXAgPSBpOTE1X2dlbV9vYmpl
Y3RfZ2V0X3BhZ2Uob2JqLCBvZmZzZXQgPj4gUEFHRV9TSElGVCk7Ci0JCWNwdSA9IGttYXAocCkg
KyBvZmZzZXRfaW5fcGFnZShvZmZzZXQpOwotCQlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKGNwdSwg
c2l6ZW9mKCpjcHUpKTsKLQkJaWYgKCpjcHUgIT0gKHUzMilwYWdlKSB7Ci0JCQlwcl9lcnIoIlBh
cnRpYWwgdmlldyBmb3IgJWx1IFsldV0gKG9mZnNldD0lbGx1LCBzaXplPSV1IFslbGx1LCByb3cg
c2l6ZSAldV0sIGZlbmNlPSVkLCB0aWxpbmc9JWQsIHN0cmlkZT0lZCkgbWlzYWxpZ25tZW50LCBl
eHBlY3RlZCB3cml0ZSB0byBwYWdlICglbGx1ICsgJXUgWzB4JWxseF0pIG9mIDB4JXgsIGZvdW5k
IDB4JXhcbiIsCi0JCQkgICAgICAgcGFnZSwgbiwKLQkJCSAgICAgICB2aWV3LnBhcnRpYWwub2Zm
c2V0LAotCQkJICAgICAgIHZpZXcucGFydGlhbC5zaXplLAotCQkJICAgICAgIHZtYS0+c2l6ZSA+
PiBQQUdFX1NISUZULAotCQkJICAgICAgIHRpbGUtPnRpbGluZyA/IHRpbGVfcm93X3BhZ2VzKG9i
aikgOiAwLAotCQkJICAgICAgIHZtYS0+ZmVuY2UgPyB2bWEtPmZlbmNlLT5pZCA6IC0xLCB0aWxl
LT50aWxpbmcsIHRpbGUtPnN0cmlkZSwKLQkJCSAgICAgICBvZmZzZXQgPj4gUEFHRV9TSElGVCwK
LQkJCSAgICAgICAodW5zaWduZWQgaW50KW9mZnNldF9pbl9wYWdlKG9mZnNldCksCi0JCQkgICAg
ICAgb2Zmc2V0LAotCQkJICAgICAgICh1MzIpcGFnZSwgKmNwdSk7Ci0JCQllcnIgPSAtRUlOVkFM
OwotCQl9Ci0JCSpjcHUgPSAwOwotCQlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKGNwdSwgc2l6ZW9m
KCpjcHUpKTsKLQkJa3VubWFwKHApOwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQotCQlp
OTE1X3ZtYV9kZXN0cm95KHZtYSk7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQg
aWd0X3BhcnRpYWxfdGlsaW5nKHZvaWQgKmFyZykKLXsKLQljb25zdCB1bnNpZ25lZCBpbnQgbnJl
YWwgPSAxIDw8IDEyOyAvKiBsYXJnZXN0IHRpbGUgcm93IHgyICovCi0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBhcmc7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsK
LQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQlpbnQgdGlsaW5nOwotCWludCBlcnI7Ci0KLQkv
KiBXZSB3YW50IHRvIGNoZWNrIHRoZSBwYWdlIG1hcHBpbmcgYW5kIGZlbmNpbmcgb2YgYSBsYXJn
ZSBvYmplY3QKLQkgKiBtbWFwcGVkIHRocm91Z2ggdGhlIEdUVC4gVGhlIG9iamVjdCB3ZSBjcmVh
dGUgaXMgbGFyZ2VyIHRoYW4gY2FuCi0JICogcG9zc2libHkgYmUgbW1hcGVkIGFzIGEgd2hvbGUs
IGFuZCBzbyB3ZSBtdXN0IHVzZSBwYXJ0aWFsIEdHVFQgdm1hLgotCSAqIFdlIHRoZW4gY2hlY2sg
dGhhdCBhIHdyaXRlIHRocm91Z2ggZWFjaCBwYXJ0aWFsIEdHVFQgdm1hIGVuZHMgdXAKLQkgKiBp
biB0aGUgcmlnaHQgc2V0IG9mIHBhZ2VzIHdpdGhpbiB0aGUgb2JqZWN0LCBhbmQgd2l0aCB0aGUg
ZXhwZWN0ZWQKLQkgKiB0aWxpbmcsIHdoaWNoIHdlIHZlcmlmeSBieSBtYW51YWwgc3dpenpsaW5n
LgotCSAqLwotCi0Jb2JqID0gaHVnZV9nZW1fb2JqZWN0KGk5MTUsCi0JCQkgICAgICBucmVhbCA8
PCBQQUdFX1NISUZULAotCQkJICAgICAgKDEgKyBuZXh0X3ByaW1lX251bWJlcihpOTE1LT5nZ3R0
LnZtLnRvdGFsID4+IFBBR0VfU0hJRlQpKSA8PCBQQUdFX1NISUZUKTsKLQlpZiAoSVNfRVJSKG9i
aikpCi0JCXJldHVybiBQVFJfRVJSKG9iaik7Ci0KLQllcnIgPSBpOTE1X2dlbV9vYmplY3RfcGlu
X3BhZ2VzKG9iaik7Ci0JaWYgKGVycikgewotCQlwcl9lcnIoIkZhaWxlZCB0byBhbGxvY2F0ZSAl
dSBwYWdlcyAoJWx1IHRvdGFsKSwgZXJyPSVkXG4iLAotCQkgICAgICAgbnJlYWwsIG9iai0+YmFz
ZS5zaXplIC8gUEFHRV9TSVpFLCBlcnIpOwotCQlnb3RvIG91dDsKLQl9Ci0KLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoaTkxNSk7Ci0KLQlpZiAoMSkgewotCQlJR1RfVElNRU9VVChlbmQpOwotCQlzdHJ1Y3QgdGls
ZSB0aWxlOwotCi0JCXRpbGUuaGVpZ2h0ID0gMTsKLQkJdGlsZS53aWR0aCA9IDE7Ci0JCXRpbGUu
c2l6ZSA9IDA7Ci0JCXRpbGUuc3RyaWRlID0gMDsKLQkJdGlsZS5zd2l6emxlID0gSTkxNV9CSVRf
Nl9TV0laWkxFX05PTkU7Ci0JCXRpbGUudGlsaW5nID0gSTkxNV9USUxJTkdfTk9ORTsKLQotCQll
cnIgPSBjaGVja19wYXJ0aWFsX21hcHBpbmcob2JqLCAmdGlsZSwgZW5kKTsKLQkJaWYgKGVyciAm
JiBlcnIgIT0gLUVJTlRSKQotCQkJZ290byBvdXRfdW5sb2NrOwotCX0KLQotCWZvciAodGlsaW5n
ID0gSTkxNV9USUxJTkdfWDsgdGlsaW5nIDw9IEk5MTVfVElMSU5HX1k7IHRpbGluZysrKSB7Ci0J
CUlHVF9USU1FT1VUKGVuZCk7Ci0JCXVuc2lnbmVkIGludCBtYXhfcGl0Y2g7Ci0JCXVuc2lnbmVk
IGludCBwaXRjaDsKLQkJc3RydWN0IHRpbGUgdGlsZTsKLQotCQlpZiAoaTkxNS0+cXVpcmtzICYg
UVVJUktfUElOX1NXSVpaTEVEX1BBR0VTKQotCQkJLyoKLQkJCSAqIFRoZSBzd2l6emxpbmcgcGF0
dGVybiBpcyBhY3R1YWxseSB1bmtub3duIGFzIGl0Ci0JCQkgKiB2YXJpZXMgYmFzZWQgb24gcGh5
c2ljYWwgYWRkcmVzcyBvZiBlYWNoIHBhZ2UuCi0JCQkgKiBTZWUgaTkxNV9nZW1fZGV0ZWN0X2Jp
dF82X3N3aXp6bGUoKS4KLQkJCSAqLwotCQkJYnJlYWs7Ci0KLQkJdGlsZS50aWxpbmcgPSB0aWxp
bmc7Ci0JCXN3aXRjaCAodGlsaW5nKSB7Ci0JCWNhc2UgSTkxNV9USUxJTkdfWDoKLQkJCXRpbGUu
c3dpenpsZSA9IGk5MTUtPm1tLmJpdF82X3N3aXp6bGVfeDsKLQkJCWJyZWFrOwotCQljYXNlIEk5
MTVfVElMSU5HX1k6Ci0JCQl0aWxlLnN3aXp6bGUgPSBpOTE1LT5tbS5iaXRfNl9zd2l6emxlX3k7
Ci0JCQlicmVhazsKLQkJfQotCi0JCUdFTV9CVUdfT04odGlsZS5zd2l6emxlID09IEk5MTVfQklU
XzZfU1dJWlpMRV9VTktOT1dOKTsKLQkJaWYgKHRpbGUuc3dpenpsZSA9PSBJOTE1X0JJVF82X1NX
SVpaTEVfOV8xNyB8fAotCQkgICAgdGlsZS5zd2l6emxlID09IEk5MTVfQklUXzZfU1dJWlpMRV85
XzEwXzE3KQotCQkJY29udGludWU7Ci0KLQkJaWYgKElOVEVMX0dFTihpOTE1KSA8PSAyKSB7Ci0J
CQl0aWxlLmhlaWdodCA9IDE2OwotCQkJdGlsZS53aWR0aCA9IDEyODsKLQkJCXRpbGUuc2l6ZSA9
IDExOwotCQl9IGVsc2UgaWYgKHRpbGUudGlsaW5nID09IEk5MTVfVElMSU5HX1kgJiYKLQkJCSAg
IEhBU18xMjhfQllURV9ZX1RJTElORyhpOTE1KSkgewotCQkJdGlsZS5oZWlnaHQgPSAzMjsKLQkJ
CXRpbGUud2lkdGggPSAxMjg7Ci0JCQl0aWxlLnNpemUgPSAxMjsKLQkJfSBlbHNlIHsKLQkJCXRp
bGUuaGVpZ2h0ID0gODsKLQkJCXRpbGUud2lkdGggPSA1MTI7Ci0JCQl0aWxlLnNpemUgPSAxMjsK
LQkJfQotCi0JCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA0KQotCQkJbWF4X3BpdGNoID0gODE5MiAv
IHRpbGUud2lkdGg7Ci0JCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA8IDcpCi0JCQltYXhfcGl0
Y2ggPSAxMjggKiBJOTY1X0ZFTkNFX01BWF9QSVRDSF9WQUwgLyB0aWxlLndpZHRoOwotCQllbHNl
Ci0JCQltYXhfcGl0Y2ggPSAxMjggKiBHRU43X0ZFTkNFX01BWF9QSVRDSF9WQUwgLyB0aWxlLndp
ZHRoOwotCi0JCWZvciAocGl0Y2ggPSBtYXhfcGl0Y2g7IHBpdGNoOyBwaXRjaCA+Pj0gMSkgewot
CQkJdGlsZS5zdHJpZGUgPSB0aWxlLndpZHRoICogcGl0Y2g7Ci0JCQllcnIgPSBjaGVja19wYXJ0
aWFsX21hcHBpbmcob2JqLCAmdGlsZSwgZW5kKTsKLQkJCWlmIChlcnIgPT0gLUVJTlRSKQotCQkJ
CWdvdG8gbmV4dF90aWxpbmc7Ci0JCQlpZiAoZXJyKQotCQkJCWdvdG8gb3V0X3VubG9jazsKLQot
CQkJaWYgKHBpdGNoID4gMiAmJiBJTlRFTF9HRU4oaTkxNSkgPj0gNCkgewotCQkJCXRpbGUuc3Ry
aWRlID0gdGlsZS53aWR0aCAqIChwaXRjaCAtIDEpOwotCQkJCWVyciA9IGNoZWNrX3BhcnRpYWxf
bWFwcGluZyhvYmosICZ0aWxlLCBlbmQpOwotCQkJCWlmIChlcnIgPT0gLUVJTlRSKQotCQkJCQln
b3RvIG5leHRfdGlsaW5nOwotCQkJCWlmIChlcnIpCi0JCQkJCWdvdG8gb3V0X3VubG9jazsKLQkJ
CX0KLQotCQkJaWYgKHBpdGNoIDwgbWF4X3BpdGNoICYmIElOVEVMX0dFTihpOTE1KSA+PSA0KSB7
Ci0JCQkJdGlsZS5zdHJpZGUgPSB0aWxlLndpZHRoICogKHBpdGNoICsgMSk7Ci0JCQkJZXJyID0g
Y2hlY2tfcGFydGlhbF9tYXBwaW5nKG9iaiwgJnRpbGUsIGVuZCk7Ci0JCQkJaWYgKGVyciA9PSAt
RUlOVFIpCi0JCQkJCWdvdG8gbmV4dF90aWxpbmc7Ci0JCQkJaWYgKGVycikKLQkJCQkJZ290byBv
dXRfdW5sb2NrOwotCQkJfQotCQl9Ci0KLQkJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KSB7Ci0J
CQlmb3JfZWFjaF9wcmltZV9udW1iZXIocGl0Y2gsIG1heF9waXRjaCkgewotCQkJCXRpbGUuc3Ry
aWRlID0gdGlsZS53aWR0aCAqIHBpdGNoOwotCQkJCWVyciA9IGNoZWNrX3BhcnRpYWxfbWFwcGlu
ZyhvYmosICZ0aWxlLCBlbmQpOwotCQkJCWlmIChlcnIgPT0gLUVJTlRSKQotCQkJCQlnb3RvIG5l
eHRfdGlsaW5nOwotCQkJCWlmIChlcnIpCi0JCQkJCWdvdG8gb3V0X3VubG9jazsKLQkJCX0KLQkJ
fQotCi1uZXh0X3RpbGluZzogOwotCX0KLQotb3V0X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3Bt
X3B1dChpOTE1LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotb3V0OgotCWk5MTVfZ2Vt
X29iamVjdF9wdXQob2JqKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IG1ha2Vfb2Jq
X2J1c3koc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0JaW50IGVycjsKLQotCXZtYSA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmk5MTUtPmdndHQudm0sIE5VTEwpOwotCWlmIChJU19F
UlIodm1hKSkKLQkJcmV0dXJuIFBUUl9FUlIodm1hKTsKLQotCWVyciA9IGk5MTVfdm1hX3Bpbih2
bWEsIDAsIDAsIFBJTl9VU0VSKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JcnEgPSBp
OTE1X3JlcXVlc3RfY3JlYXRlKGk5MTUtPmVuZ2luZVtSQ1MwXS0+a2VybmVsX2NvbnRleHQpOwot
CWlmIChJU19FUlIocnEpKSB7Ci0JCWk5MTVfdm1hX3VucGluKHZtYSk7Ci0JCXJldHVybiBQVFJf
RVJSKHJxKTsKLQl9Ci0KLQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBF
WEVDX09CSkVDVF9XUklURSk7Ci0KLQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQotCV9faTkxNV9n
ZW1fb2JqZWN0X3JlbGVhc2VfdW5sZXNzX2FjdGl2ZShvYmopOwotCWk5MTVfdm1hX3VucGluKHZt
YSk7Ci0KLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgYm9vbCBhc3NlcnRfbW1hcF9vZmZzZXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCQkgICAgICAgdW5zaWduZWQgbG9uZyBz
aXplLAotCQkJICAgICAgIGludCBleHBlY3RlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqOwotCWludCBlcnI7Ci0KLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2lu
dGVybmFsKGk5MTUsIHNpemUpOwotCWlmIChJU19FUlIob2JqKSkKLQkJcmV0dXJuIFBUUl9FUlIo
b2JqKTsKLQotCWVyciA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfbW1hcF9vZmZzZXQob2JqKTsK
LQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0KLQlyZXR1cm4gZXJyID09IGV4cGVjdGVkOwot
fQotCi1zdGF0aWMgdm9pZCBkaXNhYmxlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCi17Ci0JaTkxNV9nZW1fc2hyaW5rZXJfdW5yZWdpc3RlcihpOTE1KTsKLQot
CWludGVsX2d0X3BtX2dldChpOTE1KTsKLQotCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaTkx
NS0+Z2VtLnJldGlyZV93b3JrKTsKLQlmbHVzaF93b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsK
LX0KLQotc3RhdGljIHZvaWQgcmVzdG9yZV9yZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQotewotCWludGVsX2d0X3BtX3B1dChpOTE1KTsKLQotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJ
VF9MT0NLRUQpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlp
OTE1X2dlbV9zaHJpbmtlcl9yZWdpc3RlcihpOTE1KTsKLX0KLQotc3RhdGljIGludCBpZ3RfbW1h
cF9vZmZzZXRfZXhoYXVzdGlvbih2b2lkICphcmcpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBhcmc7Ci0Jc3RydWN0IGRybV9tbSAqbW0gPSAmaTkxNS0+ZHJtLnZtYV9vZmZz
ZXRfbWFuYWdlci0+dm1fYWRkcl9zcGFjZV9tbTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqOwotCXN0cnVjdCBkcm1fbW1fbm9kZSByZXN2LCAqaG9sZTsKLQl1NjQgaG9sZV9zdGFy
dCwgaG9sZV9lbmQ7Ci0JaW50IGxvb3AsIGVycjsKLQotCS8qIERpc2FibGUgYmFja2dyb3VuZCBy
ZWFwZXIgKi8KLQlkaXNhYmxlX3JldGlyZV93b3JrZXIoaTkxNSk7Ci0JR0VNX0JVR19PTighaTkx
NS0+Z3QuYXdha2UpOwotCi0JLyogVHJpbSB0aGUgZGV2aWNlIG1tYXAgc3BhY2UgdG8gb25seSBh
IHBhZ2UgKi8KLQltZW1zZXQoJnJlc3YsIDAsIHNpemVvZihyZXN2KSk7Ci0JZHJtX21tX2Zvcl9l
YWNoX2hvbGUoaG9sZSwgbW0sIGhvbGVfc3RhcnQsIGhvbGVfZW5kKSB7Ci0JCXJlc3Yuc3RhcnQg
PSBob2xlX3N0YXJ0OwotCQlyZXN2LnNpemUgPSBob2xlX2VuZCAtIGhvbGVfc3RhcnQgLSAxOyAv
KiBQQUdFX1NJWkUgdW5pdHMgKi8KLQkJZXJyID0gZHJtX21tX3Jlc2VydmVfbm9kZShtbSwgJnJl
c3YpOwotCQlpZiAoZXJyKSB7Ci0JCQlwcl9lcnIoIkZhaWxlZCB0byB0cmltIFZNQSBtYW5hZ2Vy
LCBlcnI9JWRcbiIsIGVycik7Ci0JCQlnb3RvIG91dF9wYXJrOwotCQl9Ci0JCWJyZWFrOwotCX0K
LQotCS8qIEp1c3QgZml0cyEgKi8KLQlpZiAoIWFzc2VydF9tbWFwX29mZnNldChpOTE1LCBQQUdF
X1NJWkUsIDApKSB7Ci0JCXByX2VycigiVW5hYmxlIHRvIGluc2VydCBvYmplY3QgaW50byBzaW5n
bGUgcGFnZSBob2xlXG4iKTsKLQkJZXJyID0gLUVJTlZBTDsKLQkJZ290byBvdXQ7Ci0JfQotCi0J
LyogVG9vIGxhcmdlICovCi0JaWYgKCFhc3NlcnRfbW1hcF9vZmZzZXQoaTkxNSwgMipQQUdFX1NJ
WkUsIC1FTk9TUEMpKSB7Ci0JCXByX2VycigiVW5leHBlY3RlZGx5IHN1Y2NlZWRlZCBpbiBpbnNl
cnRpbmcgdG9vIGxhcmdlIG9iamVjdCBpbnRvIHNpbmdsZSBwYWdlIGhvbGVcbiIpOwotCQllcnIg
PSAtRUlOVkFMOwotCQlnb3RvIG91dDsKLQl9Ci0KLQkvKiBGaWxsIHRoZSBob2xlLCBmdXJ0aGVy
IGFsbG9jYXRpb24gYXR0ZW1wdHMgc2hvdWxkIHRoZW4gZmFpbCAqLwotCW9iaiA9IGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9i
aikpIHsKLQkJZXJyID0gUFRSX0VSUihvYmopOwotCQlnb3RvIG91dDsKLQl9Ci0KLQllcnIgPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX21tYXBfb2Zmc2V0KG9iaik7Ci0JaWYgKGVycikgewotCQlw
cl9lcnIoIlVuYWJsZSB0byBpbnNlcnQgb2JqZWN0IGludG8gcmVjbGFpbWVkIGhvbGVcbiIpOwot
CQlnb3RvIGVycl9vYmo7Ci0JfQotCi0JaWYgKCFhc3NlcnRfbW1hcF9vZmZzZXQoaTkxNSwgUEFH
RV9TSVpFLCAtRU5PU1BDKSkgewotCQlwcl9lcnIoIlVuZXhwZWN0ZWRseSBzdWNjZWVkZWQgaW4g
aW5zZXJ0aW5nIG9iamVjdCBpbnRvIG5vIGhvbGVzIVxuIik7Ci0JCWVyciA9IC1FSU5WQUw7Ci0J
CWdvdG8gZXJyX29iajsKLQl9Ci0KLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0KLQkvKiBO
b3cgZmlsbCB3aXRoIGJ1c3kgZGVhZCBvYmplY3RzIHRoYXQgd2UgZXhwZWN0IHRvIHJlYXAgKi8K
LQlmb3IgKGxvb3AgPSAwOyBsb29wIDwgMzsgbG9vcCsrKSB7Ci0JCWludGVsX3dha2VyZWZfdCB3
YWtlcmVmOwotCi0JCWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQotCQkJYnJlYWs7
Ci0KLQkJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJ
WkUpOwotCQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJCWdv
dG8gb3V0OwotCQl9Ci0KLQkJZXJyID0gMDsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0JCXdpdGhfaW50ZWxfcnVudGltZV9wbShpOTE1LCB3YWtlcmVmKQotCQkJZXJy
ID0gbWFrZV9vYmpfYnVzeShvYmopOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCQlpZiAoZXJyKSB7Ci0JCQlwcl9lcnIoIltsb29wICVkXSBGYWlsZWQgdG8gYnVz
eSB0aGUgb2JqZWN0XG4iLCBsb29wKTsKLQkJCWdvdG8gZXJyX29iajsKLQkJfQotCi0JCS8qIE5C
IHdlIHJlbHkgb24gdGhlIF9hY3RpdmVfIHJlZmVyZW5jZSB0byBhY2Nlc3Mgb2JqIG5vdyAqLwot
CQlHRU1fQlVHX09OKCFpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpOwotCQllcnIgPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX21tYXBfb2Zmc2V0KG9iaik7Ci0JCWlmIChlcnIpIHsKLQkJ
CXByX2VycigiW2xvb3AgJWRdIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfbW1hcF9vZmZzZXQgZmFp
bGVkIHdpdGggZXJyPSVkXG4iLAotCQkJICAgICAgIGxvb3AsIGVycik7Ci0JCQlnb3RvIG91dDsK
LQkJfQotCX0KLQotb3V0OgotCWRybV9tbV9yZW1vdmVfbm9kZSgmcmVzdik7Ci1vdXRfcGFyazoK
LQlyZXN0b3JlX3JldGlyZV93b3JrZXIoaTkxNSk7Ci0JcmV0dXJuIGVycjsKLWVycl9vYmo6Ci0J
aTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCWdvdG8gb3V0OwotfQotCiBpbnQgaTkxNV9nZW1f
b2JqZWN0X21vY2tfc2VsZnRlc3RzKHZvaWQpCiB7CiAJc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1
X3N1YnRlc3QgdGVzdHNbXSA9IHsKQEAgLTU5Niw4ICsxMTEsNiBAQCBpbnQgaTkxNV9nZW1fb2Jq
ZWN0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0
YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CiAJCVNVQlRFU1QoaWd0
X2dlbV9odWdlKSwKLQkJU1VCVEVTVChpZ3RfcGFydGlhbF90aWxpbmcpLAotCQlTVUJURVNUKGln
dF9tbWFwX29mZnNldF9leGhhdXN0aW9uKSwKIAl9OwogCiAJcmV0dXJuIGk5MTVfc3VidGVzdHMo
dGVzdHMsIGk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2xpdmVfc2VsZnRlc3RzLmgKaW5kZXggYTk1MzEyNWIxNGM0Li45YmRhMzZhNTk4YjMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRl
c3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxm
dGVzdHMuaApAQCAtMTYsNiArMTYsNyBAQCBzZWxmdGVzdCh0aW1lbGluZXMsIGk5MTVfdGltZWxp
bmVfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChyZXF1ZXN0cywgaTkxNV9yZXF1ZXN0X2xpdmVf
c2VsZnRlc3RzKQogc2VsZnRlc3QoYWN0aXZlLCBpOTE1X2FjdGl2ZV9saXZlX3NlbGZ0ZXN0cykK
IHNlbGZ0ZXN0KG9iamVjdHMsIGk5MTVfZ2VtX29iamVjdF9saXZlX3NlbGZ0ZXN0cykKK3NlbGZ0
ZXN0KG1tYW4sIGk5MTVfZ2VtX21tYW5fbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChkbWFidWYs
IGk5MTVfZ2VtX2RtYWJ1Zl9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KHZtYSwgaTkxNV92bWFf
bGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChjb2hlcmVuY3ksIGk5MTVfZ2VtX2NvaGVyZW5jeV9s
aXZlX3NlbGZ0ZXN0cykKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D8C8A5BACC
	for <lists+intel-gfx@lfdr.de>; Mon,  1 Jul 2019 13:35:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3BE0B89BCD;
	Mon,  1 Jul 2019 11:34:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C46E189CBA
 for <intel-gfx@lists.freedesktop.org>; Mon,  1 Jul 2019 11:34:57 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Jul 2019 04:34:57 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,439,1557212400"; d="scan'208";a="186455099"
Received: from unknown (HELO delly.ger.corp.intel.com) ([10.249.141.63])
 by fmsmga004.fm.intel.com with ESMTP; 01 Jul 2019 04:34:56 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  1 Jul 2019 14:34:35 +0300
Message-Id: <20190701113437.4043-10-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
References: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6 09/11] drm/i915/perf: allow holding
 preemption on filtered ctx
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugd291bGQgbGlrZSB0byBtYWtlIHVzZSBvZiBwZXJmIGluIFZ1bGthbi4gVGhlIFZ1bGthbiBB
UEkgaXMgbXVjaApsb3dlciBsZXZlbCB0aGFuIE9wZW5HTCwgd2l0aCBhcHBsaWNhdGlvbnMgZGly
ZWN0bHkgZXhwb3NlZCB0byB0aGUKY29uY2VwdCBvZiBjb21tYW5kIGJ1ZmZlcnMgKHByZXR0eSBt
dWNoIGVxdWl2YWxlbnQgdG8gb3VyIGJhdGNoCmJ1ZmZlcnMpLiBJbiBWdWxrYW4sIHF1ZXJpZXMg
YXJlIGFsd2F5cyBsaW1pdGVkIGluIHNjb3BlIHRvIGEgY29tbWFuZApidWZmZXIuIEluIE9wZW5H
TCwgdGhlIGxhY2sgb2YgY29tbWFuZCBidWZmZXIgY29uY2VwdCBtZWFudCB0aGF0CnF1ZXJpZXMn
IGR1cmF0aW9uIGNvdWxkIHNwYW4gbXVsdGlwbGUgY29tbWFuZCBidWZmZXJzLgoKV2l0aCB0aGF0
IHJlc3RyaWN0aW9uIGdvbmUgaW4gVnVsa2FuLCB3ZSB3b3VsZCBsaWtlIHRvIHNpbXBsaWZ5Cm1l
YXN1cmluZyBwZXJmb3JtYW5jZSBqdXN0IGJ5IG1lYXN1cmluZyB0aGUgZGVsdGFzIGJldHdlZW4g
dGhlIGNvdW50ZXIKc25hcHNob3RzIHdyaXR0ZW4gYnkgMiBNSV9SRUNPUkRfUEVSRl9DT1VOVCBj
b21tYW5kcywgcmF0aGVyIHRoYW4gdGhlCm1vcmUgY29tcGxleCBzY2hlbWUgd2UgY3VycmVudGx5
IGhhdmUgaW4gdGhlIEdMIGRyaXZlciwgdXNpbmcgMgpNSV9SRUNPUkRfUEVSRl9DT1VOVCBjb21t
YW5kcyBhbmQgZG9pbmcgc29tZSBwb3N0IHByb2Nlc3Npbmcgb24gdGhlCnN0cmVhbSBvZiBPQSBy
ZXBvcnRzLCBjb21pbmcgZnJvbSB0aGUgZ2xvYmFsIE9BIGJ1ZmZlciwgdG8gcmVtb3ZlIGFueQp1
bnJlbGF0ZWQgZGVsdGFzIGluIGJldHdlZW4gdGhlIDIgTUlfUkVDT1JEX1BFUkZfQ09VTlQuCgpE
aXNhYmxpbmcgcHJlZW1wdGlvbiBvbmx5IGFwcGx5IHRvIGEgc2luZ2xlIGNvbnRleHQgd2l0aCB3
aGljaCB3YW50IHRvCnF1ZXJ5IHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciBhbmQgaXMgY29uc2lk
ZXJlZCBhIHByaXZpbGVnZWQKb3BlcmF0aW9uLCBieSBkZWZhdWx0IHByb3RlY3RlZCBieSBDQVBf
U1lTX0FETUlOLiBJdCBpcyBwb3NzaWJsZSB0bwplbmFibGUgaXQgZm9yIGEgbm9ybWFsIHVzZXIg
YnkgZGlzYWJsaW5nIHRoZSBwYXJhbm9pZCBzdHJlYW0gc2V0dGluZy4KCnYyOiBTdG9yZSBwcmVl
bXB0aW9uIHNldHRpbmcgaW4gaW50ZWxfY29udGV4dCAoQ2hyaXMpCgp2MzogVXNlIHByaW9yaXRp
ZXMgdG8gYXZvaWQgcHJlZW1wdGlvbiByYXRoZXIgdGhhbiB0aGUgSFcgbWVjaGFuaXNtCgp2NDog
SnVzdCBtb2RpZnkgdGhlIHBvcnQgcHJpb3JpdHkgcmVwb3J0aW5nIGZ1bmN0aW9uCgpTaWduZWQt
b2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+
Ci0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgIDgg
KysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgIHwg
IDcgKysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAg
fCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwg
IDggKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAgICAg
IHwgMjIgKysrKysrKysrKysrKysrKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wcmlv
bGlzdF90eXBlcy5oICAgIHwgIDcgKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYyAgICAgICAgICAgfCAgNCArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuaCAgICAgICAgICAgfCAxNCArKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2d1Y19zdWJtaXNzaW9uLmMgICB8IDEwICsrKysrKysrLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfcG0uYyAgICAgICAgICAgICAgIHwgIDUgKysrLS0KIGluY2x1ZGUvdWFwaS9k
cm0vaTkxNV9kcm0uaCAgICAgICAgICAgICAgICAgICB8IDExICsrKysrKysrKysKIDExIGZpbGVz
IGNoYW5nZWQsIDg4IGluc2VydGlvbnMoKyksIDEwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IGY5MmJhY2U5Y2Fm
Zi4uMDEyZDZkN2Y1NGUyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9leGVjYnVmZmVyLmMKQEAgLTIxMDQsNiArMjEwNCwxNCBAQCBzdGF0aWMgaW50IGViX29hX2Nv
bmZpZyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJy
OwogCisJLyoKKwkgKiBJZiB0aGUgcGVyZiBzdHJlYW0gd2FzIG9wZW5lZCB3aXRoIGhvbGQgcHJl
ZW1wdGlvbiwgZmxhZyB0aGUKKwkgKiByZXF1ZXN0IHByb3Blcmx5IHNvIHRoYXQgdGhlIHByaW9y
aXR5IG9mIHRoZSByZXF1ZXN0IGlzIGJ1bXBlZCBvbmNlCisJICogaXQgcmVhY2hlcyB0aGUgZXhl
Y2xpc3QgcG9ydHMuCisJICovCisJaWYgKGViLT5pOTE1LT5wZXJmLm9hLmV4Y2x1c2l2ZV9zdHJl
YW0tPmhvbGRfcHJlZW1wdGlvbikKKwkJZWItPnJlcXVlc3QtPmZsYWdzIHw9IEk5MTVfUkVRVUVT
VF9GTEFHU19QRVJGOworCiAJLyoKIAkgKiBJZiB0aGUgY29uZmlnIGhhc24ndCBjaGFuZ2VkLCBz
a2lwIHJlY29uZmlndXJpbmcgdGhlIEhXICh0aGlzIGlzCiAJICogc3ViamVjdCB0byBhIGRlbGF5
IHdlIHdhbnQgdG8gYXZvaWQgaGFzIG11Y2ggYXMgcG9zc2libGUpLgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYwppbmRleCAwMDFiNjk2ODM0ZjIuLjNlYzdmZTZkMjc5MCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTI1Niw3ICsyNTYsMTIgQEAgc3RhdGljIGlubGlu
ZSBpbnQgcnFfcHJpbyhjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogc3RhdGljIGlu
dCBlZmZlY3RpdmVfcHJpbyhjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlpbnQg
cHJpbyA9IHJxX3ByaW8ocnEpOworCWludCBwcmlvOworCisJaWYgKGk5MTVfcmVxdWVzdF9oYXNf
cGVyZihycSkpCisJCXByaW8gPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9QRVJG
KTsKKwllbHNlCisJCXByaW8gPSBycV9wcmlvKHJxKTsKIAogCS8qCiAJICogT24gdW53aW5kaW5n
IHRoZSBhY3RpdmUgcmVxdWVzdCwgd2UgZ2l2ZSBpdCBhIHByaW9yaXR5IGJ1bXAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5jCmluZGV4IGEwOGM2MTIzYmYzOC4uNjM5NWRlYWRmNzNmIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmMKQEAgLTQ4NSw3ICs0ODUsNyBAQCBzdGF0aWMgaW50IGk5MTVfZ2V0cGFy
YW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJdmFsdWUgPSBJ
TlRFTF9JTkZPKGRldl9wcml2KS0+aGFzX2NvaGVyZW50X2dndHQ7CiAJCWJyZWFrOwogCWNhc2Ug
STkxNV9QQVJBTV9QRVJGX1JFVklTSU9OOgotCQl2YWx1ZSA9IDE7CisJCXZhbHVlID0gMjsKIAkJ
YnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX0hBU19FWEVDX1BFUkZfQ09ORklHOgogCQkvKiBPYnZp
b3VzbHkgcmVxdWlyZXMgcGVyZiBzdXBwb3J0LiAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5k
ZXggNjY0NTU0MTE0NzE4Li44NGY5ZGVjNTlhMTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApA
QCAtMTIzMiw2ICsxMjMyLDE0IEBAIHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtIHsKIAkgKi8KIAli
b29sIGVuYWJsZWQ7CiAKKwkvKioKKwkgKiBAaG9sZF9wcmVlbXB0aW9uOiBXaGV0aGVyIHByZWVt
cHRpb24gaXMgcHV0IG9uIGhvbGQgZm9yIGNvbW1hbmQKKwkgKiBzdWJtaXNzaW9ucyBkb25lIG9u
IHRoZSBAY3R4LiBUaGlzIGlzIHVzZWZ1bCBmb3Igc29tZSBkcml2ZXJzIHRoYXQKKwkgKiBjYW5u
b3QgZWFzaWx5IHBvc3QgcHJvY2VzcyB0aGUgT0EgYnVmZmVyIGNvbnRleHQgdG8gc3VidHJhY3Qg
ZGVsdGEKKwkgKiBvZiBwZXJmb3JtYW5jZSBjb3VudGVycyBub3QgYXNzb2NpYXRlZCB3aXRoIEBj
dHguCisJICovCisJYm9vbCBob2xkX3ByZWVtcHRpb247CisKIAkvKioKIAkgKiBAb3BzOiBUaGUg
Y2FsbGJhY2tzIHByb3ZpZGluZyB0aGUgaW1wbGVtZW50YXRpb24gb2YgdGhpcyBzcGVjaWZpYwog
CSAqIHR5cGUgb2YgY29uZmlndXJlZCBzdHJlYW0uCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmlu
ZGV4IDZiNjU5YjVmMTk0OC4uMjcyMDM2MzE2MTkyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYu
YwpAQCAtMzQ0LDYgKzM0NCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9vYV9mb3JtYXQg
Z2VuOF9wbHVzX29hX2Zvcm1hdHNbSTkxNV9PQV9GT1JNQVRfTUFYXSA9IHsKICAqIHN0cnVjdCBw
ZXJmX29wZW5fcHJvcGVydGllcyAtIGZvciB2YWxpZGF0ZWQgcHJvcGVydGllcyBnaXZlbiB0byBv
cGVuIGEgc3RyZWFtCiAgKiBAc2FtcGxlX2ZsYWdzOiBgRFJNX0k5MTVfUEVSRl9QUk9QX1NBTVBM
RV8qYCBwcm9wZXJ0aWVzIGFyZSB0cmFja2VkIGFzIGZsYWdzCiAgKiBAc2luZ2xlX2NvbnRleHQ6
IFdoZXRoZXIgYSBzaW5nbGUgb3IgYWxsIGdwdSBjb250ZXh0cyBzaG91bGQgYmUgbW9uaXRvcmVk
CisgKiBAaG9sZF9wcmVlbXB0aW9uOiBXaGV0aGVyIHRoZSBwcmVlbXB0aW9uIGlzIGRpc2FibGVk
IGZvciB0aGUgZmlsdGVyZWQKKyAqICAgICAgICAgICAgICAgICAgIGNvbnRleHQKICAqIEBjdHhf
aGFuZGxlOiBBIGdlbSBjdHggaGFuZGxlIGZvciB1c2Ugd2l0aCBAc2luZ2xlX2NvbnRleHQKICAq
IEBtZXRyaWNzX3NldDogQW4gSUQgZm9yIGFuIE9BIHVuaXQgbWV0cmljIHNldCBhZHZlcnRpc2Vk
IHZpYSBzeXNmcwogICogQG9hX2Zvcm1hdDogQW4gT0EgdW5pdCBIVyByZXBvcnQgZm9ybWF0CkBA
IC0zNTgsNiArMzYwLDcgQEAgc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIHsKIAl1MzIgc2Ft
cGxlX2ZsYWdzOwogCiAJdTY0IHNpbmdsZV9jb250ZXh0OjE7CisJdTY0IGhvbGRfcHJlZW1wdGlv
bjoxOwogCXU2NCBjdHhfaGFuZGxlOwogCiAJLyogT0Egc2FtcGxpbmcgc3RhdGUgKi8KQEAgLTIz
OTksNiArMjQwMiw4IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCXN0cmVhbS0+c2FtcGxlX2ZsYWdzIHw9IFNBTVBMRV9P
QV9SRVBPUlQ7CiAJc3RyZWFtLT5zYW1wbGVfc2l6ZSArPSBmb3JtYXRfc2l6ZTsKIAorCXN0cmVh
bS0+aG9sZF9wcmVlbXB0aW9uID0gcHJvcHMtPmhvbGRfcHJlZW1wdGlvbjsKKwogCWRldl9wcml2
LT5wZXJmLm9hLm9hX2J1ZmZlci5mb3JtYXRfc2l6ZSA9IGZvcm1hdF9zaXplOwogCWlmIChXQVJO
X09OKGRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5mb3JtYXRfc2l6ZSA9PSAwKSkKIAkJcmV0
dXJuIC1FSU5WQUw7CkBAIC0yOTM3LDYgKzI5NDIsMTUgQEAgaTkxNV9wZXJmX29wZW5faW9jdGxf
bG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJfQogCX0KIAorCWlm
IChwcm9wcy0+aG9sZF9wcmVlbXB0aW9uKSB7CisJCWlmICghcHJvcHMtPnNpbmdsZV9jb250ZXh0
KSB7CisJCQlEUk1fREVCVUcoInByZWVtcHRpb24gZGlzYWJsZSB3aXRoIG5vIGNvbnRleHRcbiIp
OworCQkJcmV0ID0gLUVJTlZBTDsKKwkJCWdvdG8gZXJyOworCQl9CisJCXByaXZpbGVnZWRfb3Ag
PSB0cnVlOworCX0KKwogCS8qCiAJICogT24gSGFzd2VsbCB0aGUgT0EgdW5pdCBzdXBwb3J0cyBj
bG9jayBnYXRpbmcgb2ZmIGZvciBhIHNwZWNpZmljCiAJICogY29udGV4dCBhbmQgaW4gdGhpcyBt
b2RlIHRoZXJlJ3Mgbm8gdmlzaWJpbGl0eSBvZiBtZXRyaWNzIGZvciB0aGUKQEAgLTI5NTEsOCAr
Mjk2NSw5IEBAIGk5MTVfcGVyZl9vcGVuX2lvY3RsX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJICogTUlfUkVQT1JUX1BFUkZfQ09VTlQgY29tbWFuZHMgYW5kIHNv
IGNvbnNpZGVyIGl0IGEgcHJpdmlsZWdlZCBvcCB0bwogCSAqIGVuYWJsZSB0aGUgT0EgdW5pdCBi
eSBkZWZhdWx0LgogCSAqLwotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSAmJiBzcGVjaWZpY19j
dHgpCisJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmIHNwZWNpZmljX2N0eCAmJiAhcHJvcHMt
PmhvbGRfcHJlZW1wdGlvbikgewogCQlwcml2aWxlZ2VkX29wID0gZmFsc2U7CisJfQogCiAJLyog
U2ltaWxhciB0byBwZXJmJ3Mga2VybmVsLnBlcmZfcGFyYW5vaWRfY3B1IHN5c2N0bCBvcHRpb24K
IAkgKiB3ZSBjaGVjayBhIGRldi5pOTE1LnBlcmZfc3RyZWFtX3BhcmFub2lkIHN5c2N0bCBvcHRp
b24KQEAgLTI5NjEsNyArMjk3Niw3IEBAIGk5MTVfcGVyZl9vcGVuX2lvY3RsX2xvY2tlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICovCiAJaWYgKHByaXZpbGVnZWRfb3Ag
JiYKIAkgICAgaTkxNV9wZXJmX3N0cmVhbV9wYXJhbm9pZCAmJiAhY2FwYWJsZShDQVBfU1lTX0FE
TUlOKSkgewotCQlEUk1fREVCVUcoIkluc3VmZmljaWVudCBwcml2aWxlZ2VzIHRvIG9wZW4gc3lz
dGVtLXdpZGUgaTkxNSBwZXJmIHN0cmVhbVxuIik7CisJCURSTV9ERUJVRygiSW5zdWZmaWNpZW50
IHByaXZpbGVnZXMgdG8gb3BlbiBpOTE1IHBlcmYgc3RyZWFtXG4iKTsKIAkJcmV0ID0gLUVBQ0NF
UzsKIAkJZ290byBlcnJfY3R4OwogCX0KQEAgLTMxNTMsNiArMzE2OCw5IEBAIHN0YXRpYyBpbnQg
cmVhZF9wcm9wZXJ0aWVzX3VubG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJCXByb3BzLT5vYV9wZXJpb2RpYyA9IHRydWU7CiAJCQlwcm9wcy0+b2FfcGVyaW9kX2V4
cG9uZW50ID0gdmFsdWU7CiAJCQlicmVhazsKKwkJY2FzZSBEUk1fSTkxNV9QRVJGX1BST1BfSE9M
RF9QUkVFTVBUSU9OOgorCQkJcHJvcHMtPmhvbGRfcHJlZW1wdGlvbiA9ICEhdmFsdWU7CisJCQli
cmVhazsKIAkJY2FzZSBEUk1fSTkxNV9QRVJGX1BST1BfTUFYOgogCQkJTUlTU0lOR19DQVNFKGlk
KTsKIAkJCXJldHVybiAtRUlOVkFMOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9wcmlvbGlzdF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wcmlvbGlz
dF90eXBlcy5oCmluZGV4IDQ5NzA5ZGU2OTg3NS4uYmI5ZDFlMWZiOTRhIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ByaW9saXN0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9wcmlvbGlzdF90eXBlcy5oCkBAIC0xNyw2ICsxNywxMyBAQCBlbnVt
IHsKIAlJOTE1X1BSSU9SSVRZX05PUk1BTCA9IEk5MTVfQ09OVEVYVF9ERUZBVUxUX1BSSU9SSVRZ
LAogCUk5MTVfUFJJT1JJVFlfTUFYID0gSTkxNV9DT05URVhUX01BWF9VU0VSX1BSSU9SSVRZICsg
MSwKIAorCS8qIFJlcXVlc3RzIGNvbnRhaW5pbmcgcGVyZm9ybWFuY2UgcXVlcmllcyBtdXN0IG5v
dCBiZSBwcmVlbXB0ZWQgYnkKKwkgKiBhbm90aGVyIGNvbnRleHQuIFRoZXkgZ2V0IHNjaGVkdWxl
ZCB3aXRoIHRoZWlyIGRlZmF1bHQgcHJpb3JpdHkgYW5kCisJICogb25jZSB0aGV5IHJlYWNoIHRo
ZSBleGVjbGlzdCBwb3J0cyB3ZSBidW1wIHRoZW0gdG8KKwkgKiBJOTE1X1BSSU9SSVRZX1BFUkYg
c28gdGhhdCB0aGV5IHN0aWNrIHRvIHRoZSBIVyB1bnRpbCB0aGV5IGZpbmlzaC4KKwkgKi8KKwlJ
OTE1X1BSSU9SSVRZX1BFUkYsCisKIAlJOTE1X1BSSU9SSVRZX0lOVkFMSUQgPSBJTlRfTUlOCiB9
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IDVmZjg3YzRhMGNkNS4uMjIy
YzljNTZlOWRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3Qu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMjkyLDcgKzI5
Miw3IEBAIHN0YXRpYyBib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpCiAJCWRtYV9mZW5jZV9zaWduYWxfbG9ja2VkKCZycS0+ZmVuY2UpOwogCWlmICh0ZXN0
X2JpdChETUFfRkVOQ0VfRkxBR19FTkFCTEVfU0lHTkFMX0JJVCwgJnJxLT5mZW5jZS5mbGFncykp
CiAJCWk5MTVfcmVxdWVzdF9jYW5jZWxfYnJlYWRjcnVtYihycSk7Ci0JaWYgKHJxLT53YWl0Ym9v
c3QpIHsKKwlpZiAoaTkxNV9yZXF1ZXN0X2hhc193YWl0Ym9vc3QocnEpKSB7CiAJCUdFTV9CVUdf
T04oIWF0b21pY19yZWFkKCZycS0+aTkxNS0+Z3RfcG0ucnBzLm51bV93YWl0ZXJzKSk7CiAJCWF0
b21pY19kZWMoJnJxLT5pOTE1LT5ndF9wbS5ycHMubnVtX3dhaXRlcnMpOwogCX0KQEAgLTY4NCw3
ICs2ODQsNyBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0IGludGVsX2NvbnRleHQgKmNl
LCBnZnBfdCBnZnApCiAJcnEtPmZpbGVfcHJpdiA9IE5VTEw7CiAJcnEtPmJhdGNoID0gTlVMTDsK
IAlycS0+Y2FwdHVyZV9saXN0ID0gTlVMTDsKLQlycS0+d2FpdGJvb3N0ID0gZmFsc2U7CisJcnEt
PmZsYWdzID0gMDsKIAlycS0+ZXhlY3V0aW9uX21hc2sgPSBBTExfRU5HSU5FUzsKIAogCUlOSVRf
TElTVF9IRUFEKCZycS0+YWN0aXZlX2xpc3QpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3Qu
aAppbmRleCBiNThjZWVmOTJlMjAuLjNiYzJhM2I4YjljYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZXF1ZXN0LmgKQEAgLTIxNiw3ICsyMTYsOSBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0IHsKIAkv
KiogVGltZSBhdCB3aGljaCB0aGlzIHJlcXVlc3Qgd2FzIGVtaXR0ZWQsIGluIGppZmZpZXMuICov
CiAJdW5zaWduZWQgbG9uZyBlbWl0dGVkX2ppZmZpZXM7CiAKLQlib29sIHdhaXRib29zdDsKKyNk
ZWZpbmUgSTkxNV9SRVFVRVNUX0ZMQUdTX1dBSVRCT09TVCBCSVQoMCkKKyNkZWZpbmUgSTkxNV9S
RVFVRVNUX0ZMQUdTX1BFUkYgICAgICBCSVQoMSkKKwl1MzIgZmxhZ3M7CiAKIAkvKiogdGltZWxp
bmUtPnJlcXVlc3QgZW50cnkgZm9yIHRoaXMgcmVxdWVzdCAqLwogCXN0cnVjdCBsaXN0X2hlYWQg
bGluazsKQEAgLTQzMCw2ICs0MzIsMTYgQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfcmVxdWVz
dF9tYXJrX2NvbXBsZXRlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCXJxLT5od3NwX3NlcW5v
ID0gKHUzMiAqKSZycS0+ZmVuY2Uuc2Vxbm87IC8qIGRlY291cGxlIGZyb20gSFdTUCAqLwogfQog
CitzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9yZXF1ZXN0X2hhc193YWl0Ym9vc3QoY29uc3Qgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJcmV0dXJuIHJxLT5mbGFncyAmIEk5MTVfUkVRVUVT
VF9GTEFHU19XQUlUQk9PU1Q7Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3JlcXVlc3Rf
aGFzX3BlcmYoY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJcmV0dXJuIHJxLT5m
bGFncyAmIEk5MTVfUkVRVUVTVF9GTEFHU19QRVJGOworfQorCiBib29sIGk5MTVfcmV0aXJlX3Jl
cXVlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogI2VuZGlmIC8qIEk5MTVf
UkVRVUVTVF9IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNf
c3VibWlzc2lvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24u
YwppbmRleCAxMmMyMjM1OWZkYWMuLjQ4ZTdhZTNkNjdhMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCkBAIC03MDcsNiArNzA3LDE0IEBAIHN0YXRpYyBp
bmxpbmUgaW50IHJxX3ByaW8oY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJcmV0dXJu
IHJxLT5zY2hlZC5hdHRyLnByaW9yaXR5IHwgX19OT19QUkVFTVBUSU9OOwogfQogCitzdGF0aWMg
aW5saW5lIGludCBlZmZlY3RpdmVfcHJpbyhjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
K3sKKwlpZiAoaTkxNV9yZXF1ZXN0X2hhc19wZXJmKHJxKSkKKwkJcmV0dXJuIEk5MTVfVVNFUl9Q
UklPUklUWShJOTE1X1BSSU9SSVRZX1BFUkYpIHwgX19OT19QUkVFTVBUSU9OOworCisJcmV0dXJu
IHJxX3ByaW8ocnEpOworfQorCiBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqc2NoZWR1bGVf
aW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGludCBpZHgpCiB7CiAJdHJhY2VfaTkxNV9yZXF1
ZXN0X2luKHJxLCBpZHgpOwpAQCAtNzQ3LDcgKzc1NSw3IEBAIHN0YXRpYyB2b2lkIF9fZ3VjX2Rl
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQkJCSZlbmdpbmUtPmk5MTUt
Pmd1Yy5wcmVlbXB0X3dvcmtbZW5naW5lLT5pZF07CiAJCQlpbnQgcHJpbyA9IGV4ZWNsaXN0cy0+
cXVldWVfcHJpb3JpdHlfaGludDsKIAotCQkJaWYgKGk5MTVfc2NoZWR1bGVyX25lZWRfcHJlZW1w
dChwcmlvLCBycV9wcmlvKGxhc3QpKSkgeworCQkJaWYgKGk5MTVfc2NoZWR1bGVyX25lZWRfcHJl
ZW1wdChwcmlvLCBlZmZlY3RpdmVfcHJpbyhsYXN0KSkpIHsKIAkJCQlpbnRlbF93cml0ZV9zdGF0
dXNfcGFnZShlbmdpbmUsCiAJCQkJCQkJSTkxNV9HRU1fSFdTX1BSRUVNUFQsCiAJCQkJCQkJR1VD
X1BSRUVNUFRfSU5QUk9HUkVTUyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCBkOWE3YTEz
Y2UzMmEuLjQ5MTI1MTQxOWM2NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC02ODkxLDkg
KzY4OTEsMTAgQEAgdm9pZCBnZW42X3Jwc19ib29zdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
IAkvKiBTZXJpYWxpemVzIHdpdGggaTkxNV9yZXF1ZXN0X3JldGlyZSgpICovCiAJYm9vc3QgPSBm
YWxzZTsKIAlzcGluX2xvY2tfaXJxc2F2ZSgmcnEtPmxvY2ssIGZsYWdzKTsKLQlpZiAoIXJxLT53
YWl0Ym9vc3QgJiYgIWRtYV9mZW5jZV9pc19zaWduYWxlZF9sb2NrZWQoJnJxLT5mZW5jZSkpIHsK
KwlpZiAoIWk5MTVfcmVxdWVzdF9oYXNfd2FpdGJvb3N0KHJxKSAmJgorCSAgICAhZG1hX2ZlbmNl
X2lzX3NpZ25hbGVkX2xvY2tlZCgmcnEtPmZlbmNlKSkgewogCQlib29zdCA9ICFhdG9taWNfZmV0
Y2hfaW5jKCZycHMtPm51bV93YWl0ZXJzKTsKLQkJcnEtPndhaXRib29zdCA9IHRydWU7CisJCXJx
LT5mbGFncyB8PSBJOTE1X1JFUVVFU1RfRkxBR1NfV0FJVEJPT1NUOwogCX0KIAlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZycS0+bG9jaywgZmxhZ3MpOwogCWlmICghYm9vc3QpCmRpZmYgLS1naXQg
YS9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJt
LmgKaW5kZXggOTZiYzA5YWY4Y2M0Li5mMmI3YTZjMWU4NzAgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUv
dWFwaS9kcm0vaTkxNV9kcm0uaAorKysgYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKQEAg
LTE5ODMsNiArMTk4MywxNyBAQCBlbnVtIGRybV9pOTE1X3BlcmZfcHJvcGVydHlfaWQgewogCSAq
LwogCURSTV9JOTE1X1BFUkZfUFJPUF9PQV9FWFBPTkVOVCwKIAorCS8qKgorCSAqIFNwZWNpZnlp
bmcgdGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHZhbGlkIHdoZW4gc3BlY2lmeSBhIGNvbnRleHQgdG8K
KwkgKiBmaWx0ZXIgd2l0aCBEUk1fSTkxNV9QRVJGX1BST1BfQ1RYX0hBTkRMRS4gU3BlY2lmeWlu
ZyB0aGlzIHByb3BlcnR5CisJICogd2lsbCBob2xkIHByZWVtcHRpb24gb2YgdGhlIHBhcnRpY3Vs
YXIgY29udGV4dCB3ZSB3YW50IHRvIGdhdGhlcgorCSAqIHBlcmZvcm1hbmNlIGRhdGEgYWJvdXQu
IFRoZSBleGVjYnVmMiBzdWJtaXNzaW9ucyBtdXN0IGluY2x1ZGUgYQorCSAqIGRybV9pOTE1X2dl
bV9leGVjYnVmZmVyX2V4dF9wZXJmIHBhcmFtZXRlciBmb3IgdGhpcyB0byBhcHBseS4KKwkgKgor
CSAqIFRoaXMgcHJvcGVydHkgaXMgYXZhaWxhYmxlIGluIHBlcmYgcmV2aXNpb24gMi4KKwkgKi8K
KwlEUk1fSTkxNV9QRVJGX1BST1BfSE9MRF9QUkVFTVBUSU9OLAorCiAJRFJNX0k5MTVfUEVSRl9Q
Uk9QX01BWCAvKiBub24tQUJJICovCiB9OwogCi0tIAoyLjIxLjAuMzkyLmdmOGY2Nzg3MTU5ZQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 33B7E75ACC
	for <lists+intel-gfx@lfdr.de>; Fri, 26 Jul 2019 00:38:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 729416E839;
	Thu, 25 Jul 2019 22:38:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 36C8C6E838
 for <intel-gfx@lists.freedesktop.org>; Thu, 25 Jul 2019 22:38:47 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17610856-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 25 Jul 2019 23:38:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 25 Jul 2019 23:38:43 +0100
Message-Id: <20190725223843.8971-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915: Capture vma contents outside of spinlock
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IHdlIHVzZSB0aGUgZW5naW5lLT5hY3RpdmUubG9jayB0byBlbnN1cmUgdGhhdCB0
aGUgcmVxdWVzdCBpcwpub3QgcmV0aXJlZCBhcyB3ZSBjYXB0dXJlIHRoZSBkYXRhLiBIb3dldmVy
LCB3ZSBvbmx5IG5lZWQgdG8gZW5zdXJlIHRoYXQKdGhlIHZtYSBhcmUgbm90IHJlbW92ZWQgcHJp
b3IgdG8gdXNlIGFjcXVpcmluZyB0aGVpciBjb250ZW50cywgYW5kCnNpbmNlIHdlIGhhdmUgYWxy
ZWFkeSByZWxpbnF1aXNoZWQgb3VyIHN0b3AtbWFjaGluZSBwcm90ZWN0aW9uLCB3ZQphc3N1bWUg
dGhhdCB0aGUgdXNlciB3aWxsIG5vdCBiZSBvdmVyd3JpdGluZyB0aGUgY29udGVudHMgYmVmb3Jl
IHdlIGFyZQphYmxlIHRvIHJlY29yZCB0aGVtLgoKSW4gb3JkZXIgdG8gY2FwdHVyZSB0aGUgdm1h
IG91dHNpZGUgb2YgdGhlIHNwaW5sb2NrLCB3ZSBhY3F1aXJlIGEKcmVmZXJlbmNlIGFuZCBtYXJr
IHRoZSB2bWEgYXMgYWN0aXZlIHRvIHByZXZlbnQgaXQgZnJvbSBiZWluZyB1bmJvdW5kLgpIb3dl
dmVyLCBzaW5jZSBpdCBpcyB0cmlja3kgYWxsb2NhdGUgYW4gZW50cnkgaW4gdGhlIGZlbmNlIHRy
ZWUgKGRvaW5nCnNvIHdvdWxkIHJlcXVpcmUgdGFraW5nIGEgbXV0ZXgpIHdoaWxlIGluc2lkZSB0
aGUgZW5naW5lIHNwaW5sb2NrLCB3ZQp1c2UgYW4gYXRvbWljIGJpdCBhbmQgc3BlY2lhbCBjYXNl
IHRoZSBoYW5kbGluZyBmb3IgaTkxNV9hY3RpdmVfd2FpdC4KClRoZSBjb3JlIGJlbmVmaXQgaXMg
dGhhdCB3ZSBjYW4gdXNlIHNvbWUgbm9uLWF0b21pYyBtZXRob2RzIGZvciBtYXBwaW5nCnRoZSBk
ZXZpY2UgcGFnZXMsIHdlIGNhbiByZW1vdmUgdGhlIHNsb3cgY29tcHJlc3Npb24gcGhhc2Ugb3V0
IG9mIGF0b21pYwpjb250ZXh0IChpLmUuIHN0b3AgYW50YWdvbmlzaW5nIHRoZSBubWktd2F0Y2hk
b2cpLCBhbmQgbm8gd2UgbG9uZ2VyIG5lZWQKbGFyZ2UgcmVzZXJ2ZXMgb2YgYXRvbWljIHBhZ2Vz
LgoKQnVnemlsbGE6IGh0dHBzOi8vYnVncy5mcmVlZGVza3RvcC5vcmcvc2hvd19idWcuY2dpP2lk
PTExMTIxNQpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5j
by51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy53aWxsaWFtLmF1bGRAZ21h
aWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgfCAg
MzQgKysrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCAgICAgICB8ICAg
MyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oIHwgICAzICsKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgICAgfCAxMTIgKysrKysrKysrKysr
KysrKy0tLS0tLS0KIDQgZmlsZXMgY2hhbmdlZCwgMTE3IGluc2VydGlvbnMoKyksIDM1IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCmluZGV4IDEzZjMwNGEyOWZjOC4u
MjIzNDFjNjJjMjA0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2
ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKQEAgLTE5Niw2ICsx
OTYsNyBAQCB2b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAlkZWJ1Z19hY3RpdmVfaW5pdChyZWYpOwogCiAJcmVmLT5pOTE1ID0gaTkxNTsKKwly
ZWYtPmZsYWdzID0gMDsKIAlyZWYtPmFjdGl2ZSA9IGFjdGl2ZTsKIAlyZWYtPnJldGlyZSA9IHJl
dGlyZTsKIAlyZWYtPnRyZWUgPSBSQl9ST09UOwpAQCAtMjYyLDYgKzI2MywzNCBAQCB2b2lkIGk5
MTVfYWN0aXZlX3JlbGVhc2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJYWN0aXZlX3JldGly
ZShyZWYpOwogfQogCitzdGF0aWMgdm9pZCBfX2FjdGl2ZV91bmdyYWIoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYpCit7CisJY2xlYXJfYW5kX3dha2VfdXBfYml0KEk5MTVfQUNUSVZFX0dSQUJfQklU
LCAmcmVmLT5mbGFncyk7Cit9CisKK2Jvb2wgaTkxNV9hY3RpdmVfdHJ5Z3JhYihzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZikKK3sKKwlkZWJ1Z19hY3RpdmVfYXNzZXJ0KHJlZik7CisKKwlpZiAodGVz
dF9hbmRfc2V0X2JpdChJOTE1X0FDVElWRV9HUkFCX0JJVCwgJnJlZi0+ZmxhZ3MpKQorCQlyZXR1
cm4gZmFsc2U7CisKKwlpZiAoIWF0b21pY19hZGRfdW5sZXNzKCZyZWYtPmNvdW50LCAxLCAwKSkg
eworCQlfX2FjdGl2ZV91bmdyYWIocmVmKTsKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXJldHVy
biB0cnVlOworfQorCit2b2lkIGk5MTVfYWN0aXZlX3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZikKK3sKKwlHRU1fQlVHX09OKCF0ZXN0X2JpdChJOTE1X0FDVElWRV9HUkFCX0JJVCwgJnJl
Zi0+ZmxhZ3MpKTsKKworCWFjdGl2ZV9yZXRpcmUocmVmKTsKKwlfX2FjdGl2ZV91bmdyYWIocmVm
KTsKK30KKwogaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7
CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47CkBAIC0yNzAsNyArMjk5LDcgQEAgaW50IGk5
MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJbWlnaHRfc2xlZXAoKTsK
IAltaWdodF9sb2NrKCZyZWYtPm11dGV4KTsKIAotCWlmIChSQl9FTVBUWV9ST09UKCZyZWYtPnRy
ZWUpKQorCWlmIChpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpCiAJCXJldHVybiAwOwogCiAJZXJy
ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZyZWYtPm11dGV4KTsKQEAgLTI5Miw2ICszMjEs
OSBAQCBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIAlpZiAo
ZXJyKQogCQlyZXR1cm4gZXJyOwogCisJaWYgKHdhaXRfb25fYml0KCZyZWYtPmZsYWdzLCBJOTE1
X0FDVElWRV9HUkFCX0JJVCwgVEFTS19LSUxMQUJMRSkpCisJCXJldHVybiAtRUlOVFI7CisKIAlp
ZiAoIWk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSkKIAkJcmV0dXJuIC1FQlVTWTsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfYWN0aXZlLmgKaW5kZXggMTM0MTY2ZDMxMjUxLi5iYTY4YjA3N2VjNmMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaApAQCAtMzk1LDYgKzM5NSw5IEBAIGludCBpOTE1
X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIHZvaWQgaTkxNV9hY3Rp
dmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiB2b2lkIF9faTkxNV9hY3RpdmVf
cmVsZWFzZV9uZXN0ZWQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIGludCBzdWJjbGFzcyk7CiAK
K2Jvb2wgaTkxNV9hY3RpdmVfdHJ5Z3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Cit2b2lk
IGk5MTVfYWN0aXZlX3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CisKIHN0YXRpYyBp
bmxpbmUgYm9vbAogaTkxNV9hY3RpdmVfaXNfaWRsZShjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZikKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5
cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCmluZGV4IDVi
MGEzMDI0Y2UyNC4uNzQ3NDNkZDBkNWYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlX3R5cGVzLmgKQEAgLTM2LDYgKzM2LDkgQEAgc3RydWN0IGk5MTVfYWN0aXZlIHsKIAlzdHJ1
Y3QgbXV0ZXggbXV0ZXg7CiAJYXRvbWljX3QgY291bnQ7CiAKKwl1bnNpZ25lZCBsb25nIGZsYWdz
OworI2RlZmluZSBJOTE1X0FDVElWRV9HUkFCX0JJVCAwCisKIAlpbnQgKCphY3RpdmUpKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9y
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCmluZGV4IDU2ZGZjMjY1
MDgzNi4uNjc0ZDM0MWEyM2Y2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dwdV9lcnJvci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMK
QEAgLTI5OCw3ICsyOTgsNyBAQCBzdGF0aWMgdm9pZCAqY29tcHJlc3NfbmV4dF9wYWdlKHN0cnVj
dCBjb21wcmVzcyAqYywKIAlpZiAoZHN0LT5wYWdlX2NvdW50ID49IGRzdC0+bnVtX3BhZ2VzKQog
CQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsKIAotCXBhZ2UgPSBwb29sX2FsbG9jKCZjLT5wb29s
LCBBVE9NSUNfTUFZRkFJTCk7CisJcGFnZSA9IHBvb2xfYWxsb2MoJmMtPnBvb2wsIEFMTE9XX0ZB
SUwpOwogCWlmICghcGFnZSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKQEAgLTMyNyw4
ICszMjcsNiBAQCBzdGF0aWMgaW50IGNvbXByZXNzX3BhZ2Uoc3RydWN0IGNvbXByZXNzICpjLAog
CiAJCWlmICh6bGliX2RlZmxhdGUoenN0cmVhbSwgWl9OT19GTFVTSCkgIT0gWl9PSykKIAkJCXJl
dHVybiAtRUlPOwotCi0JCXRvdWNoX25taV93YXRjaGRvZygpOwogCX0gd2hpbGUgKHpzdHJlYW0t
PmF2YWlsX2luKTsKIAogCS8qIEZhbGxiYWNrIHRvIHVuY29tcHJlc3NlZCBpZiB3ZSBpbmNyZWFz
ZSBzaXplPyAqLwpAQCAtNDA3LDcgKzQwNSw3IEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShz
dHJ1Y3QgY29tcHJlc3MgKmMsCiB7CiAJdm9pZCAqcHRyOwogCi0JcHRyID0gcG9vbF9hbGxvYygm
Yy0+cG9vbCwgQVRPTUlDX01BWUZBSUwpOworCXB0ciA9IHBvb2xfYWxsb2MoJmMtPnBvb2wsIEFM
TE9XX0ZBSUwpOwogCWlmICghcHRyKQogCQlyZXR1cm4gLUVOT01FTTsKIApAQCAtMTAwMSwxMiAr
OTk5LDE0IEBAIGk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAlkbWFfYWRkcl90IGRtYTsKIAlpbnQgcmV0OwogCisJbWlnaHRfc2xlZXAoKTsK
KwogCWlmICghdm1hIHx8ICF2bWEtPnBhZ2VzKQogCQlyZXR1cm4gTlVMTDsKIAogCW51bV9wYWdl
cyA9IG1pbl90KHU2NCwgdm1hLT5zaXplLCB2bWEtPm9iai0+YmFzZS5zaXplKSA+PiBQQUdFX1NI
SUZUOwogCW51bV9wYWdlcyA9IERJVl9ST1VORF9VUCgxMCAqIG51bV9wYWdlcywgOCk7IC8qIHdv
cnN0Y2FzZSB6bGliIGdyb3d0aCAqLwotCWRzdCA9IGttYWxsb2Moc2l6ZW9mKCpkc3QpICsgbnVt
X3BhZ2VzICogc2l6ZW9mKHUzMiAqKSwgQVRPTUlDX01BWUZBSUwpOworCWRzdCA9IGttYWxsb2Mo
c2l6ZW9mKCpkc3QpICsgbnVtX3BhZ2VzICogc2l6ZW9mKHUzMiAqKSwgQUxMT1dfRkFJTCk7CiAJ
aWYgKCFkc3QpCiAJCXJldHVybiBOVUxMOwogCkBAIC0xMDI3LDkgKzEwMjcsOSBAQCBpOTE1X2Vy
cm9yX29iamVjdF9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAkJZ2d0
dC0+dm0uaW5zZXJ0X3BhZ2UoJmdndHQtPnZtLCBkbWEsIHNsb3QsIEk5MTVfQ0FDSEVfTk9ORSwg
MCk7CiAKLQkJcyA9IGlvX21hcHBpbmdfbWFwX2F0b21pY193YygmZ2d0dC0+aW9tYXAsIHNsb3Qp
OworCQlzID0gaW9fbWFwcGluZ19tYXBfd2MoJmdndHQtPmlvbWFwLCBzbG90LCBQQUdFX1NJWkUp
OwogCQlyZXQgPSBjb21wcmVzc19wYWdlKGNvbXByZXNzLCAodm9pZCAgX19mb3JjZSAqKXMsIGRz
dCk7Ci0JCWlvX21hcHBpbmdfdW5tYXBfYXRvbWljKHMpOworCQlpb19tYXBwaW5nX3VubWFwKHMp
OwogCQlpZiAocmV0KQogCQkJYnJlYWs7CiAJfQpAQCAtMTMwMiwxMCArMTMwMiw0MiBAQCBzdGF0
aWMgdm9pZCByZWNvcmRfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfY29udGV4dCAqZSwK
IAllLT5hY3RpdmUgPSBhdG9taWNfcmVhZCgmY3R4LT5hY3RpdmVfY291bnQpOwogfQogCi1zdGF0
aWMgdm9pZAorc3RydWN0IGNhcHR1cmVfdm1hIHsKKwlzdHJ1Y3QgY2FwdHVyZV92bWEgKm5leHQ7
CisJdm9pZCAqKnNsb3Q7Cit9OworCitzdGF0aWMgc3RydWN0IGNhcHR1cmVfdm1hICoKK2NhcHR1
cmVfdm1hKHN0cnVjdCBjYXB0dXJlX3ZtYSAqbmV4dCwKKwkgICAgc3RydWN0IGk5MTVfdm1hICp2
bWEsCisJICAgIHN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmplY3QgKipvdXQpCit7CisJc3RydWN0
IGNhcHR1cmVfdm1hICpjOworCisJKm91dCA9IE5VTEw7CisJaWYgKCF2bWEpCisJCXJldHVybiBu
ZXh0OworCisJYyA9IGttYWxsb2Moc2l6ZW9mKCpjKSwgQVRPTUlDX01BWUZBSUwpOworCWlmICgh
YykKKwkJcmV0dXJuIG5leHQ7CisKKwlpZiAoIWk5MTVfYWN0aXZlX3RyeWdyYWIoJnZtYS0+YWN0
aXZlKSkgeworCQlrZnJlZShjKTsKKwkJcmV0dXJuIG5leHQ7CisJfQorCisJYy0+c2xvdCA9ICh2
b2lkICoqKW91dDsKKwkqYy0+c2xvdCA9IGk5MTVfdm1hX2dldCh2bWEpOworCisJYy0+bmV4dCA9
IG5leHQ7CisJcmV0dXJuIGM7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgY2FwdHVyZV92bWEgKgogcmVx
dWVzdF9yZWNvcmRfdXNlcl9ibyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LAogCQkgICAg
ICAgc3RydWN0IGRybV9pOTE1X2Vycm9yX2VuZ2luZSAqZWUsCi0JCSAgICAgICBzdHJ1Y3QgY29t
cHJlc3MgKmNvbXByZXNzKQorCQkgICAgICAgc3RydWN0IGNhcHR1cmVfdm1hICpjYXB0dXJlKQog
ewogCXN0cnVjdCBpOTE1X2NhcHR1cmVfbGlzdCAqYzsKIAlzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jf
b2JqZWN0ICoqYm87CkBAIC0xMzE1LDcgKzEzNDcsNyBAQCByZXF1ZXN0X3JlY29yZF91c2VyX2Jv
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsCiAJZm9yIChjID0gcmVxdWVzdC0+Y2FwdHVy
ZV9saXN0OyBjOyBjID0gYy0+bmV4dCkKIAkJbWF4Kys7CiAJaWYgKCFtYXgpCi0JCXJldHVybjsK
KwkJcmV0dXJuIGNhcHR1cmU7CiAKIAlibyA9IGttYWxsb2NfYXJyYXkobWF4LCBzaXplb2YoKmJv
KSwgQVRPTUlDX01BWUZBSUwpOwogCWlmICghYm8pIHsKQEAgLTEzMjQsMjEgKzEzNTYsMTkgQEAg
cmVxdWVzdF9yZWNvcmRfdXNlcl9ibyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LAogCQli
byA9IGttYWxsb2NfYXJyYXkobWF4LCBzaXplb2YoKmJvKSwgQVRPTUlDX01BWUZBSUwpOwogCX0K
IAlpZiAoIWJvKQotCQlyZXR1cm47CisJCXJldHVybiBjYXB0dXJlOwogCiAJY291bnQgPSAwOwog
CWZvciAoYyA9IHJlcXVlc3QtPmNhcHR1cmVfbGlzdDsgYzsgYyA9IGMtPm5leHQpIHsKLQkJYm9b
Y291bnRdID0gaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHJlcXVlc3QtPmk5MTUsCi0JCQkJCQkg
ICAgIGMtPnZtYSwKLQkJCQkJCSAgICAgY29tcHJlc3MpOwotCQlpZiAoIWJvW2NvdW50XSkKLQkJ
CWJyZWFrOworCQljYXB0dXJlID0gY2FwdHVyZV92bWEoY2FwdHVyZSwgYy0+dm1hLCAmYm9bY291
bnRdKTsKIAkJaWYgKCsrY291bnQgPT0gbWF4KQogCQkJYnJlYWs7CiAJfQogCiAJZWUtPnVzZXJf
Ym8gPSBibzsKIAllZS0+dXNlcl9ib19jb3VudCA9IGNvdW50OworCisJcmV0dXJuIGNhcHR1cmU7
CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICoKQEAgLTEzNjksNiAr
MTM5OSw3IEBAIGdlbV9yZWNvcmRfcmluZ3Moc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvciwg
c3RydWN0IGNvbXByZXNzICpjb21wcmVzcykKIAlmb3IgKGkgPSAwOyBpIDwgSTkxNV9OVU1fRU5H
SU5FUzsgaSsrKSB7CiAJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IGk5MTUtPmVu
Z2luZVtpXTsKIAkJc3RydWN0IGRybV9pOTE1X2Vycm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVu
Z2luZVtpXTsKKwkJc3RydWN0IGNhcHR1cmVfdm1hICpjYXB0dXJlID0gTlVMTDsKIAkJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKIAkJdW5zaWduZWQgbG9uZyBmbGFnczsKIApAQCAtMTM5
MywyNiArMTQyNCwyOSBAQCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAq
ZXJyb3IsIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCiAKIAkJCXJlY29yZF9jb250ZXh0KCZl
ZS0+Y29udGV4dCwgY3R4KTsKIAotCQkJLyogV2UgbmVlZCB0byBjb3B5IHRoZXNlIHRvIGFuIGFu
b255bW91cyBidWZmZXIKKwkJCS8qCisJCQkgKiBXZSBuZWVkIHRvIGNvcHkgdGhlc2UgdG8gYW4g
YW5vbnltb3VzIGJ1ZmZlcgogCQkJICogYXMgdGhlIHNpbXBsZXN0IG1ldGhvZCB0byBhdm9pZCBi
ZWluZyBvdmVyd3JpdHRlbgogCQkJICogYnkgdXNlcnNwYWNlLgogCQkJICovCi0JCQllZS0+YmF0
Y2hidWZmZXIgPQotCQkJCWk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LAotCQkJCQkJCSBy
ZXF1ZXN0LT5iYXRjaCwKLQkJCQkJCQkgY29tcHJlc3MpOworCQkJY2FwdHVyZSA9IGNhcHR1cmVf
dm1hKGNhcHR1cmUsCisJCQkJCSAgICAgIHJlcXVlc3QtPmJhdGNoLAorCQkJCQkgICAgICAmZWUt
PmJhdGNoYnVmZmVyKTsKIAogCQkJaWYgKEhBU19CUk9LRU5fQ1NfVExCKGk5MTUpKQotCQkJCWVl
LT53YV9iYXRjaGJ1ZmZlciA9Ci0JCQkJICBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwK
LQkJCQkJCQkgICBlbmdpbmUtPmd0LT5zY3JhdGNoLAotCQkJCQkJCSAgIGNvbXByZXNzKTsKLQkJ
CXJlcXVlc3RfcmVjb3JkX3VzZXJfYm8ocmVxdWVzdCwgZWUsIGNvbXByZXNzKTsKKwkJCQljYXB0
dXJlID0gY2FwdHVyZV92bWEoY2FwdHVyZSwKKwkJCQkJCSAgICAgIGVuZ2luZS0+Z3QtPnNjcmF0
Y2gsCisJCQkJCQkgICAgICAmZWUtPndhX2JhdGNoYnVmZmVyKTsKKworCQkJY2FwdHVyZSA9IHJl
cXVlc3RfcmVjb3JkX3VzZXJfYm8ocmVxdWVzdCwgZWUsIGNhcHR1cmUpOwogCi0JCQllZS0+Y3R4
ID0KLQkJCQlpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwKLQkJCQkJCQkgcmVxdWVzdC0+
aHdfY29udGV4dC0+c3RhdGUsCi0JCQkJCQkJIGNvbXByZXNzKTsKKwkJCWNhcHR1cmUgPSBjYXB0
dXJlX3ZtYShjYXB0dXJlLAorCQkJCQkgICAgICByZXF1ZXN0LT5od19jb250ZXh0LT5zdGF0ZSwK
KwkJCQkJICAgICAgJmVlLT5jdHgpOworCisJCQljYXB0dXJlID0gY2FwdHVyZV92bWEoY2FwdHVy
ZSwKKwkJCQkJICAgICAgcmluZy0+dm1hLAorCQkJCQkgICAgICAmZWUtPnJpbmdidWZmZXIpOwog
CiAJCQllcnJvci0+c2ltdWxhdGVkIHw9CiAJCQkJaTkxNV9nZW1fY29udGV4dF9ub19lcnJvcl9j
YXB0dXJlKGN0eCk7CkBAIC0xNDIzLDE1ICsxNDU3LDI1IEBAIGdlbV9yZWNvcmRfcmluZ3Moc3Ry
dWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvciwgc3RydWN0IGNvbXByZXNzICpjb21wcmVzcykKIAog
CQkJZWUtPmNwdV9yaW5nX2hlYWQgPSByaW5nLT5oZWFkOwogCQkJZWUtPmNwdV9yaW5nX3RhaWwg
PSByaW5nLT50YWlsOwotCQkJZWUtPnJpbmdidWZmZXIgPQotCQkJCWk5MTVfZXJyb3Jfb2JqZWN0
X2NyZWF0ZShpOTE1LAotCQkJCQkJCSByaW5nLT52bWEsCi0JCQkJCQkJIGNvbXByZXNzKTsKIAog
CQkJZW5naW5lX3JlY29yZF9yZXF1ZXN0cyhlbmdpbmUsIHJlcXVlc3QsIGVlKTsKIAkJfQogCQlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CiAKKwkJ
d2hpbGUgKGNhcHR1cmUpIHsKKwkJCXN0cnVjdCBjYXB0dXJlX3ZtYSAqdGhpcyA9IGNhcHR1cmU7
CisJCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9ICp0aGlzLT5zbG90OworCisJCQkqdGhpcy0+c2xv
dCA9CisJCQkJaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsIHZtYSwgY29tcHJlc3MpOwor
CisJCQlpOTE1X2FjdGl2ZV91bmdyYWIoJnZtYS0+YWN0aXZlKTsKKwkJCWk5MTVfdm1hX3B1dCh2
bWEpOworCisJCQljYXB0dXJlID0gdGhpcy0+bmV4dDsKKwkJCWtmcmVlKHRoaXMpOworCQl9CisK
IAkJZWUtPmh3c19wYWdlID0KIAkJCWk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LAogCQkJ
CQkJIGVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hLAotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

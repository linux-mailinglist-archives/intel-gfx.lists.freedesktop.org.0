Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 990C514F127
	for <lists+intel-gfx@lfdr.de>; Fri, 31 Jan 2020 18:15:00 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 95C126FBA3;
	Fri, 31 Jan 2020 17:14:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 138F96FBA3
 for <intel-gfx@lists.freedesktop.org>; Fri, 31 Jan 2020 17:14:57 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 31 Jan 2020 09:14:49 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,386,1574150400"; d="scan'208";a="253389940"
Received: from labuser-z97x-ud5h.jf.intel.com ([10.165.21.211])
 by fmsmga004.fm.intel.com with ESMTP; 31 Jan 2020 09:14:49 -0800
From: Manasi Navare <manasi.d.navare@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 31 Jan 2020 09:15:46 -0800
Message-Id: <20200131171547.25938-2-manasi.d.navare@intel.com>
X-Mailer: git-send-email 2.19.1
In-Reply-To: <20200131171547.25938-1-manasi.d.navare@intel.com>
References: <20200131171547.25938-1-manasi.d.navare@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/3] drm/i915/dp: Compute port sync crtc states
 post compute_config()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhpcyBwYXRjaCBwdXNoZXMgb3V0IHRoZSBjb21wdXRhdGlvbiBvZiBtYXN0ZXIgYW5kIHNsYXZl
CnRyYW5zY29kZXJzIGluIGNydGMgc3RhdGVzIGFmdGVyIGVuY29kZXIncyBjb21wdXRlX2NvbmZp
ZyBob29rLgpUaGlzIGVuc3VyZXMgdGhhdCB0aGUgYXNzaWduZWQgbWFzdGVyIHNsYXZlIGNydGNz
IGhhdmUgZXhhY3Qgc2FtZQptb2RlIGFuZCB0aW1pbmdzIHdoaWNoIGlzIGEgcmVxdWlyZW1lbnQg
Zm9yIFBvcnQgc3luYyBtb2RlCnRvIGJlIGVuYWJsZWQuCgpTdWdnZXN0ZWQtYnk6IFZpbGxlIFN5
cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBWaWxsZSBTeXJqw6Rs
w6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBNYW5hc2kg
TmF2YXJlIDxtYW5hc2kuZC5uYXZhcmVAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgICAgIHwgMTI1ICsrKysrKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgfCAxNTYgLS0tLS0tLS0tLS0t
LS0tLS0tLQogMiBmaWxlcyBjaGFuZ2VkLCAxMjUgaW5zZXJ0aW9ucygrKSwgMTU2IGRlbGV0aW9u
cygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRp
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IGM5NmY2
MjljZGRjMy4uNGVjMzZlYjVjZTI4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RkaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGRpLmMKQEAgLTQ0NDAsNiArNDQ0MCwxMzAgQEAgc3RhdGljIGludCBpbnRlbF9kZGlfY29t
cHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJcmV0dXJuIDA7CiB9
CiAKK3N0YXRpYyBib29sIG1vZGVfZXF1YWwoY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
Km1vZGUxLAorCQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUyKQor
eworCXJldHVybiBkcm1fbW9kZV9tYXRjaChtb2RlMSwgbW9kZTIsCisJCQkgICAgICBEUk1fTU9E
RV9NQVRDSF9USU1JTkdTIHwKKwkJCSAgICAgIERSTV9NT0RFX01BVENIX0ZMQUdTIHwKKwkJCSAg
ICAgIERSTV9NT0RFX01BVENIXzNEX0ZMQUdTKSAmJgorCQltb2RlMS0+Y2xvY2sgPT0gbW9kZTIt
PmNsb2NrOyAvKiB3ZSB3YW50IGFuIGV4YWN0IG1hdGNoICovCit9CisKK3N0YXRpYyBib29sIG1f
bl9lcXVhbChjb25zdCBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm1fbl8xLAorCQkgICAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm1fbl8yKQoreworCXJldHVybiBtX25fMS0+dHUgPT0g
bV9uXzItPnR1ICYmCisJCW1fbl8xLT5nbWNoX20gPT0gbV9uXzItPmdtY2hfbSAmJgorCQltX25f
MS0+Z21jaF9uID09IG1fbl8yLT5nbWNoX24gJiYKKwkJbV9uXzEtPmxpbmtfbSA9PSBtX25fMi0+
bGlua19tICYmCisJCW1fbl8xLT5saW5rX24gPT0gbV9uXzItPmxpbmtfbjsKK30KKworc3RhdGlj
IGJvb2wgY3J0Y3NfcG9ydF9zeW5jX2NvbXBhdGlibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUxLAorCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZTIpCit7CisJcmV0dXJuIGNydGNfc3RhdGUxLT5ody5hY3RpdmUgJiYgY3J0Y19zdGF0ZTIt
Pmh3LmFjdGl2ZSAmJgorCQljcnRjX3N0YXRlMS0+b3V0cHV0X3R5cGVzID09IGNydGNfc3RhdGUy
LT5vdXRwdXRfdHlwZXMgJiYKKwkJY3J0Y19zdGF0ZTEtPm91dHB1dF9mb3JtYXQgPT0gY3J0Y19z
dGF0ZTItPm91dHB1dF9mb3JtYXQgJiYKKwkJY3J0Y19zdGF0ZTEtPmxhbmVfY291bnQgPT0gY3J0
Y19zdGF0ZTItPmxhbmVfY291bnQgJiYKKwkJY3J0Y19zdGF0ZTEtPnBvcnRfY2xvY2sgPT0gY3J0
Y19zdGF0ZTItPnBvcnRfY2xvY2sgJiYKKwkJbW9kZV9lcXVhbCgmY3J0Y19zdGF0ZTEtPmh3LmFk
anVzdGVkX21vZGUsCisJCQkgICAmY3J0Y19zdGF0ZTItPmh3LmFkanVzdGVkX21vZGUpICYmCisJ
CW1fbl9lcXVhbCgmY3J0Y19zdGF0ZTEtPmRwX21fbiwgJmNydGNfc3RhdGUyLT5kcF9tX24pOwor
fQorCitzdGF0aWMgdTgKK2ludGVsX2RkaV9jb21wdXRlX3BvcnRfc3luY19jcnRjX3N0YXRlKHN0
cnVjdCBkcm1fY29ubmVjdG9yICpyZWZfY29ubmVjdG9yLAorCQkJCSAgICAgICBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqcmVmX2NydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHJlZl9jcnRjX3N0YXRl
LT51YXBpLmNydGMtPmRldik7CisJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQor
CQl0b19pbnRlbF9hdG9taWNfc3RhdGUocmVmX2NydGNfc3RhdGUtPnVhcGkuc3RhdGUpOworCXN0
cnVjdCBpbnRlbF9jcnRjICpyZWZfY3J0YyA9IHRvX2ludGVsX2NydGMocmVmX2NydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CisJdTggdHJhbnNjb2RlcnMgPSAwOworCWludCBpOworCisJRFJNX0RFQlVH
X0tNUygiZm9yIFtDUlRDOiVkOiVzXVxuIiwKKwkJICAgICAgcmVmX2NydGNfc3RhdGUtPnVhcGku
Y3J0Yy0+YmFzZS5pZCwKKwkJICAgICAgcmVmX2NydGNfc3RhdGUtPnVhcGkuY3J0Yy0+bmFtZSk7
CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQorCQlyZXR1cm4gMDsKKworCWlmICgh
aW50ZWxfY3J0Y19oYXNfdHlwZShyZWZfY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RQKSkKKwkJ
cmV0dXJuIDA7CisKKwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKCZzdGF0ZS0+YmFz
ZSwgY29ubmVjdG9yLCBjb25uX3N0YXRlLCBpKSB7CisJCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
ID0gdG9faW50ZWxfY3J0Yyhjb25uX3N0YXRlLT5jcnRjKTsKKwkJc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUgPSBOVUxMOworCisJCWlmICghY3J0YykKKwkJCWNvbnRpbnVlOwor
CisJCWlmICghKGNvbm5lY3Rvci0+aGFzX3RpbGUgJiYKKwkJICAgICAgY29ubmVjdG9yLT50aWxl
X2dyb3VwLT5pZCA9PQorCQkgICAgICByZWZfY29ubmVjdG9yLT50aWxlX2dyb3VwLT5pZCkpCisJ
CQljb250aW51ZTsKKworCQljcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19z
dGF0ZShzdGF0ZSwKKwkJCQkJCQkgICAgIGNydGMpOworCQlpZiAoIWNydGNzX3BvcnRfc3luY19j
b21wYXRpYmxlKHJlZl9jcnRjX3N0YXRlLAorCQkJCQkJY3J0Y19zdGF0ZSkpIHsKKwkJCURSTV9E
RUJVR19LTVMoIltDUlRDOiVkOiVzXSBhbmQgW0NSVEM6JWQ6JXNdIG5vdCBQb3J0IFN5bmMgQ29t
cGF0aWJsZVxuIiwKKwkJCQkgICAgICByZWZfY3J0Yy0+YmFzZS5iYXNlLmlkLAorCQkJCSAgICAg
IHJlZl9jcnRjLT5iYXNlLm5hbWUsCisJCQkJICAgICAgY3J0Yy0+YmFzZS5iYXNlLmlkLCBjcnRj
LT5iYXNlLm5hbWUpOworCQkJY29udGludWU7CisJCX0KKworCQl0cmFuc2NvZGVycyB8PSBCSVQo
Y3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIpOworCX0KKworCQlyZXR1cm4gdHJhbnNjb2RlcnM7
Cit9CisKK3N0YXRpYyBpbnQgaW50ZWxfZGRpX2NvbXB1dGVfY29uZmlnX2xhdGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKKwkJCQkJIHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQor
eworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBjb25uX3N0YXRlLT5jb25uZWN0
b3I7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0
YXRlLT51YXBpLmNydGMtPmRldik7CisJdTggcG9ydF9zeW5jX3RyYW5zY29kZXJzID0gMDsKKwor
CURSTV9ERUJVR19LTVMoIltFTkNPREVSOiVkOiVzXSBbQ1JUQzolZDolc10iLAorCQkgICAgICBl
bmNvZGVyLT5iYXNlLmJhc2UuaWQsIGVuY29kZXItPmJhc2UubmFtZSwKKwkJICAgICAgY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjLT5iYXNlLmlkLCBjcnRjX3N0YXRlLT51YXBpLmNydGMtPm5hbWUpOwor
CisJaWYgKGNvbm5lY3Rvci0+aGFzX3RpbGUpCisJCXBvcnRfc3luY190cmFuc2NvZGVycyA9IGlu
dGVsX2RkaV9jb21wdXRlX3BvcnRfc3luY19jcnRjX3N0YXRlKGNvbm5lY3RvciwKKwkJCQkJCQkJ
CSAgICAgICBjcnRjX3N0YXRlKTsKKworCS8qCisJICogRURQIFRyYW5zY29kZXJzIGNhbm5vdCBi
ZSBlbnNhbHZlZAorCSAqIG1ha2UgdGhlbSBhIG1hc3RlciBhbHdheXMgd2hlbiBwcmVzZW50CisJ
ICovCisJaWYgKHBvcnRfc3luY190cmFuc2NvZGVycyAmIEJJVChUUkFOU0NPREVSX0VEUCkpCisJ
CWNydGNfc3RhdGUtPm1hc3Rlcl90cmFuc2NvZGVyID0gVFJBTlNDT0RFUl9FRFA7CisJZWxzZQor
CQljcnRjX3N0YXRlLT5tYXN0ZXJfdHJhbnNjb2RlciA9IGZmcyhwb3J0X3N5bmNfdHJhbnNjb2Rl
cnMpIC0gMTsKKworCWlmIChjcnRjX3N0YXRlLT5tYXN0ZXJfdHJhbnNjb2RlciA9PSBjcnRjX3N0
YXRlLT5jcHVfdHJhbnNjb2RlcikgeworCQljcnRjX3N0YXRlLT5tYXN0ZXJfdHJhbnNjb2RlciA9
IElOVkFMSURfVFJBTlNDT0RFUjsKKwkJY3J0Y19zdGF0ZS0+c3luY19tb2RlX3NsYXZlc19tYXNr
ID0KKwkJCXBvcnRfc3luY190cmFuc2NvZGVycyAmIH5CSVQoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5z
Y29kZXIpOworCX0KKworCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkgICAgIk1hc3Rl
ciBUcmFuc2NvZGVyID0gJXMgLCBTbGF2ZSB0cmFuc2NvZGVyIGJpdG1hc2sgPSAweCUwOHhcbiIs
CisJCSAgICB0cmFuc2NvZGVyX25hbWUoY3J0Y19zdGF0ZS0+bWFzdGVyX3RyYW5zY29kZXIpLAor
CQkgICAgY3J0Y19zdGF0ZS0+c3luY19tb2RlX3NsYXZlc19tYXNrKTsKKworCXJldHVybiAwOwor
fQorCiBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfZW5jb2Rlcl9kZXN0cm95KHN0cnVjdCBkcm1fZW5j
b2RlciAqZW5jb2RlcikKIHsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9
IGVuY190b19kaWdfcG9ydCh0b19pbnRlbF9lbmNvZGVyKGVuY29kZXIpKTsKQEAgLTQ3NDksNiAr
NDg3Myw3IEBAIHZvaWQgaW50ZWxfZGRpX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKIAllbmNvZGVyLT5ob3RwbHVnID0gaW50ZWxfZGRpX2hv
dHBsdWc7CiAJZW5jb2Rlci0+Y29tcHV0ZV9vdXRwdXRfdHlwZSA9IGludGVsX2RkaV9jb21wdXRl
X291dHB1dF90eXBlOwogCWVuY29kZXItPmNvbXB1dGVfY29uZmlnID0gaW50ZWxfZGRpX2NvbXB1
dGVfY29uZmlnOworCWVuY29kZXItPmNvbXB1dGVfY29uZmlnX2xhdGUgPSBpbnRlbF9kZGlfY29t
cHV0ZV9jb25maWdfbGF0ZTsKIAllbmNvZGVyLT5lbmFibGUgPSBpbnRlbF9lbmFibGVfZGRpOwog
CWVuY29kZXItPnByZV9wbGxfZW5hYmxlID0gaW50ZWxfZGRpX3ByZV9wbGxfZW5hYmxlOwogCWVu
Y29kZXItPnByZV9lbmFibGUgPSBpbnRlbF9kZGlfcHJlX2VuYWJsZTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggZGU0YWI1MTIxNmY2Li5lNjM4
NTQzZjVmODcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCkBAIC0xMjU0NSwxMjYgKzEyNTQ1LDYgQEAgc3RhdGljIGJvb2wgYzhfcGxhbmVzX2NoYW5n
ZWQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogCXJldHVy
biAhb2xkX2NydGNfc3RhdGUtPmM4X3BsYW5lcyAhPSAhbmV3X2NydGNfc3RhdGUtPmM4X3BsYW5l
czsKIH0KIAotc3RhdGljIGJvb2wKLWludGVsX2F0b21pY19pc19tYXN0ZXJfY29ubmVjdG9yKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQotewotCXN0cnVjdCBkcm1fY3J0YyAq
Y3J0YyA9IGNydGNfc3RhdGUtPnVhcGkuY3J0YzsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAq
c3RhdGUgPSBjcnRjX3N0YXRlLT51YXBpLnN0YXRlOwotCXN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3I7Ci0Jc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5lY3Rvcl9zdGF0ZTsK
LQlpbnQgaTsKLQotCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5l
Y3RvciwgY29ubmVjdG9yX3N0YXRlLCBpKSB7Ci0JCWlmIChjb25uZWN0b3Jfc3RhdGUtPmNydGMg
IT0gY3J0YykKLQkJCWNvbnRpbnVlOwotCQlpZiAoY29ubmVjdG9yLT5oYXNfdGlsZSAmJgotCQkg
ICAgY29ubmVjdG9yLT50aWxlX2hfbG9jID09IGNvbm5lY3Rvci0+bnVtX2hfdGlsZSAtIDEgJiYK
LQkJICAgIGNvbm5lY3Rvci0+dGlsZV92X2xvYyA9PSBjb25uZWN0b3ItPm51bV92X3RpbGUgLSAx
KQotCQkJcmV0dXJuIHRydWU7Ci0JfQotCi0JcmV0dXJuIGZhbHNlOwotfQotCi1zdGF0aWMgdm9p
ZCByZXNldF9wb3J0X3N5bmNfbW9kZV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKLXsKLQljcnRjX3N0YXRlLT5tYXN0ZXJfdHJhbnNjb2RlciA9IElOVkFMSURfVFJB
TlNDT0RFUjsKLQljcnRjX3N0YXRlLT5zeW5jX21vZGVfc2xhdmVzX21hc2sgPSAwOwotfQotCi1z
dGF0aWMgaW50IGljbF9jb21wdXRlX3BvcnRfc3luY19jcnRjX3N0YXRlKHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IsCi0JCQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKLQkJCQkJICAgIGludCBudW1fdGlsZWRfY29ubnMpCi17Ci0Jc3RydWN0IGRybV9j
cnRjICpjcnRjID0gY3J0Y19zdGF0ZS0+dWFwaS5jcnRjOwotCXN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPnVhcGkuc3Rh
dGUpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwotCXN0cnVjdCBkcm1fY29ubmVjdG9yICptYXN0ZXJfY29u
bmVjdG9yOwotCXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3RfaXRlciBjb25uX2l0ZXI7Ci0Jc3Ry
dWN0IGRybV9jcnRjICptYXN0ZXJfY3J0YyA9IE5VTEw7Ci0Jc3RydWN0IGRybV9jcnRjX3N0YXRl
ICptYXN0ZXJfY3J0Y19zdGF0ZTsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbWFzdGVyX3Bp
cGVfY29uZmlnOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKLQkJcmV0dXJuIDA7
Ci0KLQlpZiAoIWludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RQ
KSkKLQkJcmV0dXJuIDA7Ci0KLQkvKgotCSAqIEluIGNhc2Ugb2YgdGlsZWQgZGlzcGxheXMgdGhl
cmUgY291bGQgYmUgb25lIG9yIG1vcmUgc2xhdmVzIGJ1dCB0aGVyZSBpcwotCSAqIG9ubHkgb25l
IG1hc3Rlci4gTGV0cyBtYWtlIHRoZSBDUlRDIHVzZWQgYnkgdGhlIGNvbm5lY3RvciBjb3JyZXNw
b25kaW5nCi0JICogdG8gdGhlIGxhc3QgaG9yaXpvbmFsIGFuZCBsYXN0IHZlcnRpY2FsIHRpbGUg
YSBtYXN0ZXIvZ2VubG9jayBDUlRDLgotCSAqIEFsbCB0aGUgb3RoZXIgQ1JUQ3MgY29ycmVzcG9u
ZGluZyB0byBvdGhlciB0aWxlcyBvZiB0aGUgc2FtZSBUaWxlIGdyb3VwCi0JICogYXJlIHRoZSBz
bGF2ZSBDUlRDcyBhbmQgaG9sZCBhIHBvaW50ZXIgdG8gdGhlaXIgZ2VubG9jayBDUlRDLgotCSAq
IElmIGFsbCB0aWxlcyBub3QgcHJlc2VudCBkbyBub3QgbWFrZSBtYXN0ZXIgc2xhdmUgYXNzaWdu
bWVudHMuCi0JICovCi0JaWYgKCFjb25uZWN0b3ItPmhhc190aWxlIHx8Ci0JICAgIGNydGNfc3Rh
dGUtPmh3Lm1vZGUuaGRpc3BsYXkgIT0gY29ubmVjdG9yLT50aWxlX2hfc2l6ZSB8fAotCSAgICBj
cnRjX3N0YXRlLT5ody5tb2RlLnZkaXNwbGF5ICE9IGNvbm5lY3Rvci0+dGlsZV92X3NpemUgfHwK
LQkgICAgbnVtX3RpbGVkX2Nvbm5zIDwgY29ubmVjdG9yLT5udW1faF90aWxlICogY29ubmVjdG9y
LT5udW1fdl90aWxlKSB7Ci0JCXJlc2V0X3BvcnRfc3luY19tb2RlX3N0YXRlKGNydGNfc3RhdGUp
OwotCQlyZXR1cm4gMDsKLQl9Ci0JLyogTGFzdCBIb3Jpem9udGFsIGFuZCBsYXN0IHZlcnRpY2Fs
IHRpbGUgY29ubmVjdG9yIGlzIGEgbWFzdGVyCi0JICogTWFzdGVyJ3MgY3J0YyBzdGF0ZSBpcyBh
bHJlYWR5IHBvcHVsYXRlZCBpbiBzbGF2ZSBmb3IgcG9ydCBzeW5jCi0JICovCi0JaWYgKGNvbm5l
Y3Rvci0+dGlsZV9oX2xvYyA9PSBjb25uZWN0b3ItPm51bV9oX3RpbGUgLSAxICYmCi0JICAgIGNv
bm5lY3Rvci0+dGlsZV92X2xvYyA9PSBjb25uZWN0b3ItPm51bV92X3RpbGUgLSAxKQotCQlyZXR1
cm4gMDsKLQotCS8qIExvb3AgdGhyb3VnaCBhbGwgY29ubmVjdG9ycyBhbmQgY29uZmlndXJlIHRo
ZSBTbGF2ZSBjcnRjX3N0YXRlCi0JICogdG8gcG9pbnQgdG8gdGhlIGNvcnJlY3QgbWFzdGVyLgot
CSAqLwotCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKCZkZXZfcHJpdi0+ZHJtLCAmY29u
bl9pdGVyKTsKLQlkcm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0ZXIobWFzdGVyX2Nvbm5lY3Rvciwg
JmNvbm5faXRlcikgewotCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqbWFzdGVyX2Nvbm5f
c3RhdGUgPSBOVUxMOwotCi0JCWlmICghKG1hc3Rlcl9jb25uZWN0b3ItPmhhc190aWxlICYmCi0J
CSAgICAgIG1hc3Rlcl9jb25uZWN0b3ItPnRpbGVfZ3JvdXAtPmlkID09IGNvbm5lY3Rvci0+dGls
ZV9ncm91cC0+aWQpKQotCQkJY29udGludWU7Ci0JCWlmIChtYXN0ZXJfY29ubmVjdG9yLT50aWxl
X2hfbG9jICE9IG1hc3Rlcl9jb25uZWN0b3ItPm51bV9oX3RpbGUgLSAxIHx8Ci0JCSAgICBtYXN0
ZXJfY29ubmVjdG9yLT50aWxlX3ZfbG9jICE9IG1hc3Rlcl9jb25uZWN0b3ItPm51bV92X3RpbGUg
LSAxKQotCQkJY29udGludWU7Ci0KLQkJbWFzdGVyX2Nvbm5fc3RhdGUgPSBkcm1fYXRvbWljX2dl
dF9jb25uZWN0b3Jfc3RhdGUoJnN0YXRlLT5iYXNlLAotCQkJCQkJCQkgICBtYXN0ZXJfY29ubmVj
dG9yKTsKLQkJaWYgKElTX0VSUihtYXN0ZXJfY29ubl9zdGF0ZSkpIHsKLQkJCWRybV9jb25uZWN0
b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKLQkJCXJldHVybiBQVFJfRVJSKG1hc3Rlcl9j
b25uX3N0YXRlKTsKLQkJfQotCQlpZiAobWFzdGVyX2Nvbm5fc3RhdGUtPmNydGMpIHsKLQkJCW1h
c3Rlcl9jcnRjID0gbWFzdGVyX2Nvbm5fc3RhdGUtPmNydGM7Ci0JCQlicmVhazsKLQkJfQotCX0K
LQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5faXRlcik7Ci0KLQlpZiAoIW1hc3Rl
cl9jcnRjKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJDb3VsZCBu
b3QgZmluZCBNYXN0ZXIgQ1JUQyBmb3IgU2xhdmUgQ1JUQyAlZFxuIiwKLQkJCSAgICBjcnRjLT5i
YXNlLmlkKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JbWFzdGVyX2NydGNfc3RhdGUgPSBk
cm1fYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwKLQkJCQkJCSAgICAgIG1hc3Rl
cl9jcnRjKTsKLQlpZiAoSVNfRVJSKG1hc3Rlcl9jcnRjX3N0YXRlKSkKLQkJcmV0dXJuIFBUUl9F
UlIobWFzdGVyX2NydGNfc3RhdGUpOwotCi0JbWFzdGVyX3BpcGVfY29uZmlnID0gdG9faW50ZWxf
Y3J0Y19zdGF0ZShtYXN0ZXJfY3J0Y19zdGF0ZSk7Ci0JY3J0Y19zdGF0ZS0+bWFzdGVyX3RyYW5z
Y29kZXIgPSBtYXN0ZXJfcGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyOwotCW1hc3Rlcl9waXBl
X2NvbmZpZy0+c3luY19tb2RlX3NsYXZlc19tYXNrIHw9Ci0JCUJJVChjcnRjX3N0YXRlLT5jcHVf
dHJhbnNjb2Rlcik7Ci0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCSAgICAiTWFzdGVy
IFRyYW5zY29kZXIgPSAlcyBhZGRlZCBmb3IgU2xhdmUgQ1JUQyA9ICVkLCBzbGF2ZSB0cmFuc2Nv
ZGVyIGJpdG1hc2sgPSAlZFxuIiwKLQkJICAgIHRyYW5zY29kZXJfbmFtZShjcnRjX3N0YXRlLT5t
YXN0ZXJfdHJhbnNjb2RlciksCi0JCSAgICBjcnRjLT5iYXNlLmlkLAotCQkgICAgbWFzdGVyX3Bp
cGVfY29uZmlnLT5zeW5jX21vZGVfc2xhdmVzX21hc2spOwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0
YXRpYyBpbnQgaW50ZWxfY3J0Y19hdG9taWNfY2hlY2soc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7CkBAIC0xMzIyNiwx
NSArMTMxMDYsNiBAQCBpbnRlbF9jcnRjX3ByZXBhcmVfY2xlYXJlZF9zdGF0ZShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpZiAoSVNfRzRYKGRldl9wcml2KSB8fAogCSAg
ICBJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkKIAkJ
c2F2ZWRfc3RhdGUtPndtID0gY3J0Y19zdGF0ZS0+d207Ci0JLyoKLQkgKiBTYXZlIHRoZSBzbGF2
ZSBiaXRtYXNrIHdoaWNoIGdldHMgZmlsbGVkIGZvciBtYXN0ZXIgY3J0YyBzdGF0ZSBkdXJpbmcK
LQkgKiBzbGF2ZSBhdG9taWMgY2hlY2sgY2FsbC4gRm9yIGFsbCBvdGhlciBDUlRDcyByZXNldCB0
aGUgcG9ydCBzeW5jIHZhcmlhYmxlcwotCSAqIGNydGNfc3RhdGUtPm1hc3Rlcl90cmFuc2NvZGVy
IG5lZWRzIHRvIGJlIHNldCB0byBJTlZBTElECi0JICovCi0JcmVzZXRfcG9ydF9zeW5jX21vZGVf
c3RhdGUoc2F2ZWRfc3RhdGUpOwotCWlmIChpbnRlbF9hdG9taWNfaXNfbWFzdGVyX2Nvbm5lY3Rv
cihjcnRjX3N0YXRlKSkKLQkJc2F2ZWRfc3RhdGUtPnN5bmNfbW9kZV9zbGF2ZXNfbWFzayA9Ci0J
CQljcnRjX3N0YXRlLT5zeW5jX21vZGVfc2xhdmVzX21hc2s7CiAKIAltZW1jcHkoY3J0Y19zdGF0
ZSwgc2F2ZWRfc3RhdGUsIHNpemVvZigqY3J0Y19zdGF0ZSkpOwogCWtmcmVlKHNhdmVkX3N0YXRl
KTsKQEAgLTEzMzI1LDI0ICsxMzE5Niw2IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCWRybV9tb2RlX3NldF9jcnRjaW5m
bygmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUsCiAJCQkgICAgICBDUlRDX1NURVJFT19E
T1VCTEUpOwogCi0JLyogR2V0IHRpbGVfZ3JvdXBfaWQgb2YgdGlsZWQgY29ubmVjdG9yICovCi0J
Zm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yLCBjb25uZWN0
b3Jfc3RhdGUsIGkpIHsKLQkJaWYgKGNvbm5lY3Rvcl9zdGF0ZS0+Y3J0YyA9PSBjcnRjICYmCi0J
CSAgICBjb25uZWN0b3ItPmhhc190aWxlKSB7Ci0JCQl0aWxlX2dyb3VwX2lkID0gY29ubmVjdG9y
LT50aWxlX2dyb3VwLT5pZDsKLQkJCWJyZWFrOwotCQl9Ci0JfQotCi0JLyogR2V0IHRvdGFsIG51
bWJlciBvZiB0aWxlZCBjb25uZWN0b3JzIGluIHN0YXRlIHRoYXQgYmVsb25nIHRvCi0JICogdGhp
cyB0aWxlIGdyb3VwLgotCSAqLwotCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoc3Rh
dGUsIGNvbm5lY3RvciwgY29ubmVjdG9yX3N0YXRlLCBpKSB7Ci0JCWlmIChjb25uZWN0b3ItPmhh
c190aWxlICYmCi0JCSAgICBjb25uZWN0b3ItPnRpbGVfZ3JvdXAtPmlkID09IHRpbGVfZ3JvdXBf
aWQpCi0JCQludW1fdGlsZWRfY29ubnMrKzsKLQl9Ci0KIAkvKiBQYXNzIG91ciBtb2RlIHRvIHRo
ZSBjb25uZWN0b3JzIGFuZCB0aGUgQ1JUQyB0byBnaXZlIHRoZW0gYSBjaGFuY2UgdG8KIAkgKiBh
ZGp1c3QgaXQgYWNjb3JkaW5nIHRvIGxpbWl0YXRpb25zIG9yIGNvbm5lY3RvciBwcm9wZXJ0aWVz
LCBhbmQgYWxzbwogCSAqIGEgY2hhbmNlIHRvIHJlamVjdCB0aGUgbW9kZSBlbnRpcmVseS4KQEAg
LTEzMzU0LDE1ICsxMzIwNyw2IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCQlpZiAoY29ubmVjdG9yX3N0YXRlLT5jcnRj
ICE9IGNydGMpCiAJCQljb250aW51ZTsKIAotCQlyZXQgPSBpY2xfY29tcHV0ZV9wb3J0X3N5bmNf
Y3J0Y19zdGF0ZShjb25uZWN0b3IsIHBpcGVfY29uZmlnLAotCQkJCQkJICAgICAgIG51bV90aWxl
ZF9jb25ucyk7Ci0JCWlmIChyZXQpIHsKLQkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCi0JCQkJ
ICAgICJDYW5ub3QgYXNzaWduIFN5bmMgTW9kZSBDUlRDczogJWRcbiIsCi0JCQkJICAgIHJldCk7
Ci0JCQlyZXR1cm4gcmV0OwotCQl9Ci0KIAkJcmV0ID0gZW5jb2Rlci0+Y29tcHV0ZV9jb25maWco
ZW5jb2RlciwgcGlwZV9jb25maWcsCiAJCQkJCSAgICAgIGNvbm5lY3Rvcl9zdGF0ZSk7CiAJCWlm
IChyZXQgPCAwKSB7Ci0tIAoyLjE5LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeAo=

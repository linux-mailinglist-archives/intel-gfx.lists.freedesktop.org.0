Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2F69391E72
	for <lists+intel-gfx@lfdr.de>; Mon, 19 Aug 2019 09:59:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E74216E0C2;
	Mon, 19 Aug 2019 07:59:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D41EC6E0AF
 for <intel-gfx@lists.freedesktop.org>; Mon, 19 Aug 2019 07:58:42 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18185109-1500050 
 for multiple; Mon, 19 Aug 2019 08:58:40 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 19 Aug 2019 08:58:33 +0100
Message-Id: <20190819075835.20065-17-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190819075835.20065-1-chris@chris-wilson.co.uk>
References: <20190819075835.20065-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 16/18] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRi
dWZmZXIuYyAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jICB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5jICAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YyAgICB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVz
LmggIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAg
ICB8ICAgOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAg
IHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jICAg
fCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmggICB8
ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyAgICAgICAgIHwg
IDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jICAgICAgfCAg
IDkgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCAgICB8ICAg
MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jICAgIHwgIDE2
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyAgICAgICAgfCAgMTAg
Ky0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYyB8ICAgMiAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwgICAzIC0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8IDE3OCArKysr
Ky0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAgICAgICAgfCAz
MTEgKysrKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90
eXBlcy5oICAgICAgfCAgMTYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAg
ICAgICAgICAgICB8ICA0MiArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5j
ICAgICAgICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMg
ICAgICAgICAgIHwgIDM5ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0Lmgg
ICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAgICAg
ICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0
aXZlLmMgIHwgIDM2ICstCiAyNiBmaWxlcyBjaGFuZ2VkLCAyNDUgaW5zZXJ0aW9ucygrKSwgNDgw
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZnJvbnRidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZnJvbnRidWZmZXIuYwppbmRleCBkNjI4MTBjMTI1NmEuLmVlYjU5NjQ3OTdhNyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYwpAQCAtMjUw
LDcgKzI1MCw3IEBAIGludGVsX2Zyb250YnVmZmVyX2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQogCWZyb250LT5vYmogPSBvYmo7CiAJa3JlZl9pbml0KCZmcm9udC0+cmVmKTsK
IAlhdG9taWNfc2V0KCZmcm9udC0+Yml0cywgMCk7Ci0JaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAm
ZnJvbnQtPndyaXRlLAorCWk5MTVfYWN0aXZlX2luaXQoJmZyb250LT53cml0ZSwKIAkJCSBmcm9u
dGJ1ZmZlcl9hY3RpdmUsCiAJCQkgaTkxNV9hY3RpdmVfbWF5X3NsZWVwKGZyb250YnVmZmVyX3Jl
dGlyZSkpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5j
CmluZGV4IDRmMzY1NTdiM2YzYi4uNTQ0ZTk1MzM0MmVhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpAQCAtMjMwLDcgKzIzMCw3IEBAIGFsbG9jX3Jl
cXVlc3Qoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksIHZvaWQgKCpmbikoc3RydWN0IGlu
dGVsX292ZXJsYXkgKikpCiAJaWYgKElTX0VSUihycSkpCiAJCXJldHVybiBycTsKIAotCWVyciA9
IGk5MTVfYWN0aXZlX3JlZigmb3ZlcmxheS0+bGFzdF9mbGlwLCBycS0+dGltZWxpbmUsIHJxKTsK
KwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJm92ZXJsYXktPmxhc3RfZmxpcCwgcnEtPnRpbWVsaW5l
LCAmcnEtPmZlbmNlKTsKIAlpZiAoZXJyKSB7CiAJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCQly
ZXR1cm4gRVJSX1BUUihlcnIpOwpAQCAtMTM2MCw4ICsxMzYwLDcgQEAgdm9pZCBpbnRlbF9vdmVy
bGF5X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlvdmVybGF5LT5j
b250cmFzdCA9IDc1OwogCW92ZXJsYXktPnNhdHVyYXRpb24gPSAxNDY7CiAKLQlpOTE1X2FjdGl2
ZV9pbml0KGRldl9wcml2LAotCQkJICZvdmVybGF5LT5sYXN0X2ZsaXAsCisJaTkxNV9hY3RpdmVf
aW5pdCgmb3ZlcmxheS0+bGFzdF9mbGlwLAogCQkJIE5VTEwsIGludGVsX292ZXJsYXlfbGFzdF9m
bGlwX3JldGlyZSk7CiAKIAlyZXQgPSBnZXRfcmVnaXN0ZXJzKG92ZXJsYXksIE9WRVJMQVlfTkVF
RFNfUEhZU0lDQUwoZGV2X3ByaXYpKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IGY5OTkyMDY1Mjc1MS4uYzM0NWQzZDYyZGYxIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKQEAgLTIx
MSw3ICsyMTEsNyBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKQogCSAqIGtlZXAgdHJhY2sgb2YgdGhlIEdQVSBhY3Rpdml0eSB3aXRoaW4g
dGhpcyB2bWEvcmVxdWVzdCwgYW5kCiAJICogcHJvcGFnYXRlIHRoZSBzaWduYWwgZnJvbSB0aGUg
cmVxdWVzdCB0byB3LT5kbWEuCiAJICovCi0JZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFj
dGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFj
dGl2ZSwgcnEtPnRpbWVsaW5lLCAmcnEtPmZlbmNlKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dF9y
ZXF1ZXN0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
Y29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpp
bmRleCA4YzllNGY5NzhkOTEuLjY1OTdkOTg0NThkYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC04NjQsMjAgKzg2NCwxOCBAQCBzdGF0aWMgaW50
IGNvbnRleHRfYmFycmllcl90YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQkJ
dm9pZCAoKnRhc2spKHZvaWQgKmRhdGEpLAogCQkJCXZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJc3RydWN0IGNvbnRleHRfYmFycmll
cl90YXNrICpjYjsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwogCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCUdFTV9CVUdfT04oIXRhc2spOwogCiAJY2IgPSBr
bWFsbG9jKHNpemVvZigqY2IpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWNiKQogCQlyZXR1cm4gLUVO
T01FTTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmNiLT5iYXNlLCBOVUxMLCBjYl9yZXRp
cmUpOworCWk5MTVfYWN0aXZlX2luaXQoJmNiLT5iYXNlLCBOVUxMLCBjYl9yZXRpcmUpOwogCWVy
ciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJmNiLT5iYXNlKTsKIAlpZiAoZXJyKSB7CiAJCWtmcmVl
KGNiKTsKQEAgLTkwOSw3ICs5MDcsOSBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFycmllcl90YXNr
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCWlmIChlbWl0KQogCQkJZXJyID0gZW1p
dChycSwgZGF0YSk7CiAJCWlmIChlcnIgPT0gMCkKLQkJCWVyciA9IGk5MTVfYWN0aXZlX3JlZigm
Y2ItPmJhc2UsIHJxLT50aW1lbGluZSwgcnEpOworCQkJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZj
Yi0+YmFzZSwKKwkJCQkJICAgICAgcnEtPnRpbWVsaW5lLAorCQkJCQkgICAgICAmcnEtPmZlbmNl
KTsKIAogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJaWYgKGVycikKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IGE5MDg1YzAzMDdmNC4u
NjgyYjA5MWQxOGMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9l
eGVjYnVmZmVyLmMKQEAgLTEyNjgsNyArMTI2OCw3IEBAIHJlbG9jYXRlX2VudHJ5KHN0cnVjdCBp
OTE1X3ZtYSAqdm1hLAogCiAJaWYgKCFlYi0+cmVsb2NfY2FjaGUudmFkZHIgJiYKIAkgICAgKERC
R19GT1JDRV9SRUxPQyA9PSBGT1JDRV9HUFVfUkVMT0MgfHwKLQkgICAgICFkbWFfcmVzdl90ZXN0
X3NpZ25hbGVkX3JjdSh2bWEtPnJlc3YsIHRydWUpKSkgeworCSAgICAgaTkxNV92bWFfaXNfYWN0
aXZlKHZtYSkpKSB7CiAJCWNvbnN0IHVuc2lnbmVkIGludCBnZW4gPSBlYi0+cmVsb2NfY2FjaGUu
Z2VuOwogCQl1bnNpZ25lZCBpbnQgbGVuOwogCQl1MzIgKmJhdGNoOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCmluZGV4IDUxMWZjZTc5MTNl
Yy4uY2RiNTk2ZmJjZDg5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdF90eXBlcy5oCkBAIC04LDYgKzgsNyBAQAogI2RlZmluZSBfX0k5MTVfR0VNX09C
SkVDVF9UWVBFU19IX18KIAogI2luY2x1ZGUgPGRybS9kcm1fZ2VtLmg+CisjaW5jbHVkZSA8dWFw
aS9kcm0vaTkxNV9kcm0uaD4KIAogI2luY2x1ZGUgImk5MTVfYWN0aXZlLmgiCiAjaW5jbHVkZSAi
aTkxNV9zZWxmdGVzdC5oIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRl
eCA5MmU1M2MyNTQyNGMuLjkyNTU4ZmE0NzEwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3BtLmMKQEAgLTE2LDE0ICsxNiwxMSBAQCBzdGF0aWMgdm9pZCBjYWxsX2lkbGVfYmFy
cmllcnMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBsbGlzdF9ub2Rl
ICpub2RlLCAqbmV4dDsKIAogCWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbGxpc3Rf
ZGVsX2FsbCgmZW5naW5lLT5iYXJyaWVyX3Rhc2tzKSkgewotCQlzdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCAqYWN0aXZlID0KKwkJc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IgPQogCQkJY29udGFp
bmVyX29mKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwKLQkJCQkgICAgIHR5cGVvZigqYWN0aXZl
KSwgbGluayk7CisJCQkJICAgICB0eXBlb2YoKmNiKSwgbm9kZSk7CiAKLQkJSU5JVF9MSVNUX0hF
QUQoJmFjdGl2ZS0+bGluayk7Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBO
VUxMKTsKLQotCQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIE5VTEwpOworCQljYi0+ZnVuYyhOVUxM
LCBjYik7CiAJfQogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5k
ZXggYWU3YzI2ODllZjMwLi41N2UxM2M2ZjU5YzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9jb250ZXh0LmMKQEAgLTI0MCw3ICsyNDAsNyBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAJbXV0ZXhfaW5pdCgmY2UtPnBpbl9tdXRleCk7CiAK
LQlpOTE1X2FjdGl2ZV9pbml0KGN0eC0+aTkxNSwgJmNlLT5hY3RpdmUsCisJaTkxNV9hY3RpdmVf
aW5pdCgmY2UtPmFjdGl2ZSwKIAkJCSBfX2ludGVsX2NvbnRleHRfYWN0aXZlLCBfX2ludGVsX2Nv
bnRleHRfcmV0aXJlKTsKIH0KIApAQCAtMzA3LDcgKzMwNyw3IEBAIGludCBpbnRlbF9jb250ZXh0
X3ByZXBhcmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJcmV0
dXJuIGVycjsKIAogCQkvKiBRdWV1ZSB0aGlzIHN3aXRjaCBhZnRlciBjdXJyZW50IGFjdGl2aXR5
IGJ5IHRoaXMgY29udGV4dC4gKi8KLQkJZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJnRs
LT5sYXN0X3JlcXVlc3QsIHJxKTsKKwkJZXJyID0gaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCZ0bC0+
bGFzdF9yZXF1ZXN0LCBycSk7CiAJCW11dGV4X3VubG9jaygmdGwtPm11dGV4KTsKIAkJaWYgKGVy
cikKIAkJCXJldHVybiBlcnI7CkBAIC0zMjEsNyArMzIxLDcgQEAgaW50IGludGVsX2NvbnRleHRf
cHJlcGFyZV9yZW1vdGVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJICogd29y
ZHMgdHJhbnNmZXIgdGhlIHBpbm5lZCBjZSBvYmplY3QgdG8gdHJhY2tlZCBhY3RpdmUgcmVxdWVz
dC4KIAkgKi8KIAlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUoJmNlLT5hY3RpdmUpKTsK
LQlyZXR1cm4gaTkxNV9hY3RpdmVfcmVmKCZjZS0+YWN0aXZlLCBycS0+dGltZWxpbmUsIHJxKTsK
KwlyZXR1cm4gaTkxNV9hY3RpdmVfcmVmKCZjZS0+YWN0aXZlLCBycS0+dGltZWxpbmUsICZycS0+
ZmVuY2UpOwogfQogCiBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICppbnRlbF9jb250ZXh0X2NyZWF0ZV9y
ZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfcG9vbC5jCmluZGV4IDM2ZmE4YjdlNTI0ZC4uMjViMDVjM2RiNjM3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMKQEAgLTk1LDcg
Kzk1LDcgQEAgbm9kZV9jcmVhdGUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sLCBzaXpl
X3Qgc3opCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJbm9kZS0+cG9vbCA9IHBvb2w7
Ci0JaTkxNV9hY3RpdmVfaW5pdChlbmdpbmUtPmk5MTUsICZub2RlLT5hY3RpdmUsIHBvb2xfYWN0
aXZlLCBwb29sX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgmbm9kZS0+YWN0aXZlLCBwb29s
X2FjdGl2ZSwgcG9vbF9yZXRpcmUpOwogCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9p
bnRlcm5hbChlbmdpbmUtPmk5MTUsIHN6KTsKIAlpZiAoSVNfRVJSKG9iaikpIHsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oCmluZGV4IDhkMDY5ZWZkOTQ1Ny4u
N2U4MzQ1OWI4ZGE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfcG9vbC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9w
b29sLmgKQEAgLTE4LDcgKzE4LDcgQEAgc3RhdGljIGlubGluZSBpbnQKIGludGVsX2VuZ2luZV9w
b29sX21hcmtfYWN0aXZlKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpub2RlLAogCQkJ
ICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfYWN0aXZlX3Jl
Zigmbm9kZS0+YWN0aXZlLCBycS0+dGltZWxpbmUsIHJxKTsKKwlyZXR1cm4gaTkxNV9hY3RpdmVf
cmVmKCZub2RlLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgJnJxLT5mZW5jZSk7CiB9CiAKIHN0YXRp
YyBpbmxpbmUgdm9pZApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmVzZXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXggMDc3
NzE2NDQyYzkwLi4wZGYzYjhjMTI0NzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3Jlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVz
ZXQuYwpAQCAtODEzLDEwICs4MTMsMTAgQEAgc3RhdGljIGJvb2wgX19pbnRlbF9ndF91bnNldF93
ZWRnZWQoc3RydWN0IGludGVsX2d0ICpndCkKIAkgKi8KIAlzcGluX2xvY2soJnRpbWVsaW5lcy0+
bG9jayk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh0bCwgJnRpbWVsaW5lcy0+YWN0aXZlX2xpc3Qs
IGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJCXN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQoJnRsLT5s
YXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQorCQlmZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dl
dCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghZmVuY2UpCiAJCQljb250aW51ZTsKIAogCQlz
cGluX3VubG9jaygmdGltZWxpbmVzLT5sb2NrKTsKQEAgLTgyOCw4ICs4MjgsOCBAQCBzdGF0aWMg
Ym9vbCBfX2ludGVsX2d0X3Vuc2V0X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCQkgKiAo
STkxNV9GRU5DRV9USU1FT1VUKSBzbyB0aGlzIHdhaXQgc2hvdWxkIG5vdCBiZSB1bmJvdW5kZWQK
IAkJICogaW4gdGhlIHdvcnN0IGNhc2UuCiAJCSAqLwotCQlkbWFfZmVuY2VfZGVmYXVsdF93YWl0
KCZycS0+ZmVuY2UsIGZhbHNlLCBNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0JCWk5MTVfcmVxdWVz
dF9wdXQocnEpOworCQlkbWFfZmVuY2VfZGVmYXVsdF93YWl0KGZlbmNlLCBmYWxzZSwgTUFYX1ND
SEVEVUxFX1RJTUVPVVQpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKIAogCQkvKiBSZXN0YXJ0
IGl0ZXJhdGlvbiBhZnRlciBkcm9waW5nIGxvY2sgKi8KIAkJc3Bpbl9sb2NrKCZ0aW1lbGluZXMt
PmxvY2spOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxp
bmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKaW5kZXggMjMw
MWEwZmZkZmJkLi42MWVlMWYyNDdhYjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
dGltZWxpbmUuYwpAQCAtMTc4LDggKzE3OCw3IEBAIGNhY2hlbGluZV9hbGxvYyhzdHJ1Y3QgaW50
ZWxfdGltZWxpbmVfaHdzcCAqaHdzcCwgdW5zaWduZWQgaW50IGNhY2hlbGluZSkKIAljbC0+aHdz
cCA9IGh3c3A7CiAJY2wtPnZhZGRyID0gcGFnZV9wYWNrX2JpdHModmFkZHIsIGNhY2hlbGluZSk7
CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGh3c3AtPmd0LT5pOTE1LCAmY2wtPmFjdGl2ZSwKLQkJCSBf
X2NhY2hlbGluZV9hY3RpdmUsIF9fY2FjaGVsaW5lX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5p
dCgmY2wtPmFjdGl2ZSwgX19jYWNoZWxpbmVfYWN0aXZlLCBfX2NhY2hlbGluZV9yZXRpcmUpOwog
CiAJcmV0dXJuIGNsOwogfQpAQCAtMjU1LDcgKzI1NCw3IEBAIGludCBpbnRlbF90aW1lbGluZV9p
bml0KHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUsCiAKIAltdXRleF9pbml0KCZ0aW1l
bGluZS0+bXV0ZXgpOwogCi0JSU5JVF9BQ1RJVkVfUkVRVUVTVCgmdGltZWxpbmUtPmxhc3RfcmVx
dWVzdCwgJnRpbWVsaW5lLT5tdXRleCk7CisJSU5JVF9BQ1RJVkVfRkVOQ0UoJnRpbWVsaW5lLT5s
YXN0X3JlcXVlc3QsICZ0aW1lbGluZS0+bXV0ZXgpOwogCUlOSVRfTElTVF9IRUFEKCZ0aW1lbGlu
ZS0+cmVxdWVzdHMpOwogCiAJaTkxNV9zeW5jbWFwX2luaXQoJnRpbWVsaW5lLT5zeW5jKTsKQEAg
LTQ0MSw3ICs0NDAsNyBAQCBfX2ludGVsX3RpbWVsaW5lX2dldF9zZXFubyhzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgKnRsLAogCSAqIGZyZWUgaXQgYWZ0ZXIgdGhlIGN1cnJlbnQgcmVxdWVzdCBpcyBy
ZXRpcmVkLCB3aGljaCBlbnN1cmVzIHRoYXQKIAkgKiBhbGwgd3JpdGVzIGludG8gdGhlIGNhY2hl
bGluZSBmcm9tIHByZXZpb3VzIHJlcXVlc3RzIGFyZSBjb21wbGV0ZS4KIAkgKi8KLQllcnIgPSBp
OTE1X2FjdGl2ZV9yZWYoJnRsLT5od3NwX2NhY2hlbGluZS0+YWN0aXZlLCB0bCwgcnEpOworCWVy
ciA9IGk5MTVfYWN0aXZlX3JlZigmdGwtPmh3c3BfY2FjaGVsaW5lLT5hY3RpdmUsIHRsLCAmcnEt
PmZlbmNlKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9jYWNoZWxpbmU7CiAKQEAgLTQ5Miw3ICs0
OTEsNyBAQCBpbnQgaW50ZWxfdGltZWxpbmVfZ2V0X3NlcW5vKHN0cnVjdCBpbnRlbF90aW1lbGlu
ZSAqdGwsCiBzdGF0aWMgaW50IGNhY2hlbGluZV9yZWYoc3RydWN0IGludGVsX3RpbWVsaW5lX2Nh
Y2hlbGluZSAqY2wsCiAJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5
MTVfYWN0aXZlX3JlZigmY2wtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7CisJcmV0dXJuIGk5
MTVfYWN0aXZlX3JlZigmY2wtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCAmcnEtPmZlbmNlKTsKIH0K
IAogaW50IGludGVsX3RpbWVsaW5lX3JlYWRfaHdzcChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpmcm9t
LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlw
ZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKaW5k
ZXggMmIxYmFmMmZjYzhlLi42ZDdhYzEyOWNlOGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaApAQCAtNjMsNyArNjMsNyBAQCBzdHJ1Y3QgaW50
ZWxfdGltZWxpbmUgewogCSAqIHRoZSByZXF1ZXN0IHVzaW5nIGk5MTVfYWN0aXZlX3JlcXVlc3Rf
Z2V0X3JlcXVlc3RfcmN1KCksIG9yIGhvbGQgdGhlCiAJICogc3RydWN0X211dGV4LgogCSAqLwot
CXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGxhc3RfcmVxdWVzdDsKKwlzdHJ1Y3QgaTkxNV9h
Y3RpdmVfZmVuY2UgbGFzdF9yZXF1ZXN0OwogCiAJLyoqCiAJICogV2UgdHJhY2sgdGhlIG1vc3Qg
cmVjZW50IHNlcW5vIHRoYXQgd2Ugd2FpdCBvbiBpbiBldmVyeSBjb250ZXh0IHNvCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggOWQxZWEyNmM3YTJkLi4x
NDIwNTMzZThmZDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0
LmMKQEAgLTQxLDI0ICs0MSwyMCBAQCBzdGF0aWMgaW50IGNvbnRleHRfc3luYyhzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UpCiAKIAltdXRleF9sb2NrKCZ0bC0+bXV0ZXgpOwogCWRvIHsKLQkJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCQlsb25n
IHRpbWVvdXQ7CiAKLQkJcmN1X3JlYWRfbG9jaygpOwotCQlycSA9IHJjdV9kZXJlZmVyZW5jZSh0
bC0+bGFzdF9yZXF1ZXN0LnJlcXVlc3QpOwotCQlpZiAocnEpCi0JCQlycSA9IGk5MTVfcmVxdWVz
dF9nZXRfcmN1KHJxKTsKLQkJcmN1X3JlYWRfdW5sb2NrKCk7Ci0JCWlmICghcnEpCisJCWZlbmNl
ID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJaWYgKCFmZW5j
ZSkKIAkJCWJyZWFrOwogCi0JCXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFog
LyAxMCk7CisJCXRpbWVvdXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLCBmYWxzZSwg
SFogLyAxMCk7CiAJCWlmICh0aW1lb3V0IDwgMCkKIAkJCWVyciA9IHRpbWVvdXQ7CiAJCWVsc2UK
LQkJCWk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhycSk7CisJCQlpOTE1X3JlcXVlc3RfcmV0aXJl
X3VwdG8odG9fcmVxdWVzdChmZW5jZSkpOwogCi0JCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlk
bWFfZmVuY2VfcHV0KGZlbmNlKTsKIAl9IHdoaWxlICghZXJyKTsKIAltdXRleF91bmxvY2soJnRs
LT5tdXRleCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggYjc5
N2JlMTYyN2U5Li4xYWVmZjUyOWNjMDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2xyYy5jCkBAIC05ODQsOSArOTg0LDEzIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpk
dW1teV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpZiAoIXJxKQog
CQlyZXR1cm4gTlVMTDsKIAotCUlOSVRfTElTVF9IRUFEKCZycS0+YWN0aXZlX2xpc3QpOwogCXJx
LT5lbmdpbmUgPSBlbmdpbmU7CiAKKwlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOworCUlOSVRf
TElTVF9IRUFEKCZycS0+ZmVuY2UuY2JfbGlzdCk7CisJcnEtPmZlbmNlLmxvY2sgPSAmcnEtPmxv
Y2s7CisJcnEtPmZlbmNlLm9wcyA9ICZpOTE1X2ZlbmNlX29wczsKKwogCWk5MTVfc2NoZWRfbm9k
ZV9pbml0KCZycS0+c2NoZWQpOwogCiAJLyogbWFyayB0aGlzIHJlcXVlc3QgYXMgcGVybWFuZW50
bHkgaW5jb21wbGV0ZSAqLwpAQCAtMTA3OSw4ICsxMDgzLDggQEAgc3RhdGljIGludCBsaXZlX3N1
cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJCQkJfQogCiAJCQkJLyogRGlzYWJsZSBO
RVdDTElFTlQgcHJvbW90aW9uICovCi0JCQkJX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmcnFb
aV0tPnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsCi0JCQkJCQkJICBkdW1teSk7CisJCQkJX19pOTE1
X2FjdGl2ZV9mZW5jZV9zZXQoJnJxW2ldLT50aW1lbGluZS0+bGFzdF9yZXF1ZXN0LAorCQkJCQkJ
CSZkdW1teS0+ZmVuY2UpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQocnFbaV0pOwogCQkJfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGlu
ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYwpp
bmRleCA1OTgxNzBlZmNhZjYuLjJhNzdjMDUxZjM2YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCkBAIC0xNSw3ICsxNSw3IEBAIHZv
aWQgbW9ja190aW1lbGluZV9pbml0KHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUsIHU2
NCBjb250ZXh0KQogCiAJbXV0ZXhfaW5pdCgmdGltZWxpbmUtPm11dGV4KTsKIAotCUlOSVRfQUNU
SVZFX1JFUVVFU1QoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsICZ0aW1lbGluZS0+bXV0ZXgpOwor
CUlOSVRfQUNUSVZFX0ZFTkNFKCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LCAmdGltZWxpbmUtPm11
dGV4KTsKIAlJTklUX0xJU1RfSEVBRCgmdGltZWxpbmUtPnJlcXVlc3RzKTsKIAogCWk5MTVfc3lu
Y21hcF9pbml0KCZ0aW1lbGluZS0+c3luYyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvc2NoZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVy
LmMKaW5kZXggODk0MGZhOGQzOTFhLi42YmViNzUzYjFlYTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvc2NoZWR1bGVyLmMKQEAgLTM4NSwxMSArMzg1LDggQEAgaW50ZWxfZ3Z0X3dvcmtsb2FkX3Jl
cV9hbGxvYyhzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiB7CiAJc3RydWN0
IGludGVsX3ZncHUgKnZncHUgPSB3b3JrbG9hZC0+dmdwdTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9z
dWJtaXNzaW9uICpzID0gJnZncHUtPnN1Ym1pc3Npb247Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWlmICh3b3JrbG9hZC0+cmVxKQogCQlyZXR1cm4gMDsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmMKaW5kZXggZmJhNzdkMjg0ZmJhLi4zYTE2ZmZmYjVhOGMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuYwpAQCAtMTIsOCArMTIsNiBAQAogI2luY2x1ZGUgImk5MTVfYWN0
aXZlLmgiCiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCiAKLSNkZWZpbmUgQktMKHJlZikgKCYo
cmVmKS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCkKLQogLyoKICAqIEFjdGl2ZSByZWZzIG1lbW9y
eSBtYW5hZ2VtZW50CiAgKgpAQCAtMjcsMzUgKzI1LDM1IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9n
bG9iYWxfYWN0aXZlIHsKIH0gZ2xvYmFsOwogCiBzdHJ1Y3QgYWN0aXZlX25vZGUgewotCXN0cnVj
dCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGJhc2U7CisJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlIGJh
c2U7CiAJc3RydWN0IGk5MTVfYWN0aXZlICpyZWY7CiAJc3RydWN0IHJiX25vZGUgbm9kZTsKIAl1
NjQgdGltZWxpbmU7CiB9OwogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBhY3RpdmVfbm9kZSAqCi1u
b2RlX2Zyb21fYWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitub2Rl
X2Zyb21fYWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKQogewogCXJldHVy
biBjb250YWluZXJfb2YoYWN0aXZlLCBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UpOwogfQogCiAj
ZGVmaW5lIHRha2VfcHJlYWxsb2NhdGVkX2JhcnJpZXJzKHgpIGxsaXN0X2RlbF9hbGwoJih4KS0+
cHJlYWxsb2NhdGVkX2JhcnJpZXJzKQogCi1zdGF0aWMgaW5saW5lIGJvb2wgaXNfYmFycmllcihj
b25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQorc3RhdGljIGlubGluZSBi
b29sIGlzX2JhcnJpZXIoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpCiB7
Ci0JcmV0dXJuIElTX0VSUihyY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0KSk7CisJ
cmV0dXJuIElTX0VSUihyY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5mZW5jZSkpOwogfQogCiBz
dGF0aWMgaW5saW5lIHN0cnVjdCBsbGlzdF9ub2RlICpiYXJyaWVyX3RvX2xsKHN0cnVjdCBhY3Rp
dmVfbm9kZSAqbm9kZSkKIHsKIAlHRU1fQlVHX09OKCFpc19iYXJyaWVyKCZub2RlLT5iYXNlKSk7
Ci0JcmV0dXJuIChzdHJ1Y3QgbGxpc3Rfbm9kZSAqKSZub2RlLT5iYXNlLmxpbms7CisJcmV0dXJu
IChzdHJ1Y3QgbGxpc3Rfbm9kZSAqKSZub2RlLT5iYXNlLmNiLm5vZGU7CiB9CiAKIHN0YXRpYyBp
bmxpbmUgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqCiBfX2JhcnJpZXJfdG9fZW5naW5lKHN0cnVj
dCBhY3RpdmVfbm9kZSAqbm9kZSkKIHsKLQlyZXR1cm4gKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KilSRUFEX09OQ0Uobm9kZS0+YmFzZS5saW5rLnByZXYpOworCXJldHVybiAoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqKVJFQURfT05DRShub2RlLT5iYXNlLmNiLm5vZGUucHJldik7CiB9CiAKIHN0
YXRpYyBpbmxpbmUgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqCkBAIC02OCw3ICs2Niw3IEBAIGJh
cnJpZXJfdG9fZW5naW5lKHN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSkKIHN0YXRpYyBpbmxpbmUg
c3RydWN0IGFjdGl2ZV9ub2RlICpiYXJyaWVyX2Zyb21fbGwoc3RydWN0IGxsaXN0X25vZGUgKngp
CiB7CiAJcmV0dXJuIGNvbnRhaW5lcl9vZigoc3RydWN0IGxpc3RfaGVhZCAqKXgsCi0JCQkgICAg
c3RydWN0IGFjdGl2ZV9ub2RlLCBiYXNlLmxpbmspOworCQkJICAgIHN0cnVjdCBhY3RpdmVfbm9k
ZSwgYmFzZS5jYi5ub2RlKTsKIH0KIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RF
QlVHX0dFTSkgJiYgSVNfRU5BQkxFRChDT05GSUdfREVCVUdfT0JKRUNUUykKQEAgLTE0NSw3ICsx
NDMsNyBAQCBfX2FjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAKIAlHRU1f
QlVHX09OKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKTsKIAlyYnRyZWVfcG9zdG9yZGVy
X2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyb290LCBub2RlKSB7Ci0JCUdFTV9CVUdfT04o
aTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmaXQtPmJhc2UpKTsKKwkJR0VNX0JVR19PTihpOTE1
X2FjdGl2ZV9mZW5jZV9pc3NldCgmaXQtPmJhc2UpKTsKIAkJa21lbV9jYWNoZV9mcmVlKGdsb2Jh
bC5zbGFiX2NhY2hlLCBpdCk7CiAJfQogCkBAIC0xODUsMTIgKzE4MywxMyBAQCBhY3RpdmVfcmV0
aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogfQogCiBzdGF0aWMgdm9pZAotbm9kZV9yZXRp
cmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmJhc2UsIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKQorbm9kZV9yZXRpcmUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVu
Y2VfY2IgKmNiKQogewotCWFjdGl2ZV9yZXRpcmUobm9kZV9mcm9tX2FjdGl2ZShiYXNlKS0+cmVm
KTsKKwlpOTE1X2FjdGl2ZV9mZW5jZV9jYihmZW5jZSwgY2IpOworCWFjdGl2ZV9yZXRpcmUoY29u
dGFpbmVyX29mKGNiLCBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UuY2IpLT5yZWYpOwogfQogCi1z
dGF0aWMgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKgorc3RhdGljIHN0cnVjdCBpOTE1X2Fj
dGl2ZV9mZW5jZSAqCiBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0
cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlLCAq
cHJlYWxsb2M7CkBAIC0yMzQsNyArMjMzLDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQogCX0KIAogCW5vZGUgPSBw
cmVhbGxvYzsKLQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJm5vZGUtPmJhc2UsICZ0bC0+bXV0
ZXgsIE5VTEwsIG5vZGVfcmV0aXJlKTsKKwlfX2k5MTVfYWN0aXZlX2ZlbmNlX2luaXQoJm5vZGUt
PmJhc2UsICZ0bC0+bXV0ZXgsIE5VTEwsIG5vZGVfcmV0aXJlKTsKIAlub2RlLT5yZWYgPSByZWY7
CiAJbm9kZS0+dGltZWxpbmUgPSBpZHg7CiAKQEAgLTI0OSw4ICsyNDgsNyBAQCBhY3RpdmVfaW5z
dGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwp
CiAJcmV0dXJuICZub2RlLT5iYXNlOwogfQogCi12b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAor
dm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQlpbnQg
KCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKIAkJCXZvaWQgKCpyZXRpcmUpKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKIAkJCXN0cnVjdCBsb2NrX2NsYXNzX2tleSAqa2V5KQpA
QCAtMjU5LDcgKzI1Nyw2IEBAIHZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCiAJZGVidWdfYWN0aXZlX2luaXQocmVmKTsKIAotCXJlZi0+aTkx
NSA9IGk5MTU7CiAJcmVmLT5mbGFncyA9IDA7CiAJcmVmLT5hY3RpdmUgPSBhY3RpdmU7CiAJcmVm
LT5yZXRpcmUgPSBwdHJfdW5wYWNrX2JpdHMocmV0aXJlLCAmYml0cywgMik7CkBAIC0zMjUsOSAr
MzIyLDkgQEAgX19hY3RpdmVfZGVsX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0
cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSkKIAogaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZiwKIAkJICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCi0JCSAgICBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKKwkJICAgIHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQog
ewotCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmU7CisJc3RydWN0IGk5MTVfYWN0
aXZlX2ZlbmNlICphY3RpdmU7CiAJaW50IGVycjsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnRs
LT5tdXRleCk7CkBAIC0zNTAsMTQgKzM0NywxMSBAQCBpbnQgaTkxNV9hY3RpdmVfcmVmKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkgKiByZXF1ZXN0IHRoYXQgd2Ugd2FudCB0byBlbWl0IG9u
IHRoZSBrZXJuZWxfY29udGV4dC4KIAkJICovCiAJCV9fYWN0aXZlX2RlbF9iYXJyaWVyKHJlZiwg
bm9kZV9mcm9tX2FjdGl2ZShhY3RpdmUpKTsKLQkJUkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPnJl
cXVlc3QsIE5VTEwpOwotCQlJTklUX0xJU1RfSEVBRCgmYWN0aXZlLT5saW5rKTsKLQl9IGVsc2Ug
ewotCQlpZiAoIWk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoYWN0aXZlKSkKLQkJCWF0b21pY19p
bmMoJnJlZi0+Y291bnQpOworCQlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIE5VTEwp
OworCQlhdG9taWNfZGVjKCZyZWYtPmNvdW50KTsKIAl9Ci0JR0VNX0JVR19PTighYXRvbWljX3Jl
YWQoJnJlZi0+Y291bnQpKTsKLQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KGFjdGl2ZSwgcnEp
OworCWlmICghX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoYWN0aXZlLCBmZW5jZSkpCisJCWF0b21p
Y19pbmMoJnJlZi0+Y291bnQpOwogCiBvdXQ6CiAJaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYpOwpA
QCAtNTA1LDEyICs0OTksMTkgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYpCiAJCWdvdG8gb3V0OwogCiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRy
eV9zYWZlKGl0LCBuLCAmcmVmLT50cmVlLCBub2RlKSB7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZl
bmNlOworCiAJCWlmIChpc19iYXJyaWVyKCZpdC0+YmFzZSkpIHsgLyogdW5jb25uZWN0ZWQgaWRs
ZS1iYXJyaWVyICovCiAJCQllcnIgPSAtRUJVU1k7CiAJCQlicmVhazsKIAkJfQogCi0JCWVyciA9
IGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZpdC0+YmFzZSwgQktMKHJlZikpOworCQlmZW5j
ZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgmaXQtPmJhc2UpOworCQlpZiAoIWZlbmNlKQorCQkJ
Y29udGludWU7CisKKwkJZXJyID0gZG1hX2ZlbmNlX3dhaXQoZmVuY2UsIHRydWUpOworCQlkbWFf
ZmVuY2VfcHV0KGZlbmNlKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTUzMCw0MCAr
NTMxLDYgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJ
cmV0dXJuIDA7CiB9CiAKLWludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlX3JlcXVlc3Qoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0JCQkJICAgICAgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVl
c3QgKmFjdGl2ZSkKLXsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpiYXJyaWVyID0KLQkJaTkxNV9h
Y3RpdmVfcmVxdWVzdF9yYXcoYWN0aXZlLCAmcnEtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
Ci0JcmV0dXJuIGJhcnJpZXIgPyBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCAmYmFy
cmllci0+ZmVuY2UpIDogMDsKLX0KLQotaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCXN0cnVj
dCBhY3RpdmVfbm9kZSAqaXQsICpuOwotCWludCBlcnI7Ci0KLQlpZiAoUkJfRU1QVFlfUk9PVCgm
cmVmLT50cmVlKSkKLQkJcmV0dXJuIDA7Ci0KLQkvKiBhd2FpdCBhbGxvY2F0ZXMgYW5kIHNvIHdl
IG5lZWQgdG8gYXZvaWQgaGl0dGluZyB0aGUgc2hyaW5rZXIgKi8KLQllcnIgPSBpOTE1X2FjdGl2
ZV9hY3F1aXJlKHJlZik7Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKLQotCW11dGV4X2xvY2so
JnJlZi0+bXV0ZXgpOwotCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwg
biwgJnJlZi0+dHJlZSwgbm9kZSkgewotCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZl
X3JlcXVlc3QocnEsICZpdC0+YmFzZSk7Ci0JCWlmIChlcnIpCi0JCQlicmVhazsKLQl9Ci0JbXV0
ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsKLQotCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKLQly
ZXR1cm4gZXJyOwotfQotCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VN
KQogdm9pZCBpOTE1X2FjdGl2ZV9maW5pKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewpAQCAt
NTc3LDcgKzU0NCw3IEBAIHZvaWQgaTkxNV9hY3RpdmVfZmluaShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZikKIAogc3RhdGljIGlubGluZSBib29sIGlzX2lkbGVfYmFycmllcihzdHJ1Y3QgYWN0aXZl
X25vZGUgKm5vZGUsIHU2NCBpZHgpCiB7Ci0JcmV0dXJuIG5vZGUtPnRpbWVsaW5lID09IGlkeCAm
JiAhaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmbm9kZS0+YmFzZSk7CisJcmV0dXJuIG5vZGUt
PnRpbWVsaW5lID09IGlkeCAmJiAhaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQoJm5vZGUtPmJhc2Up
OwogfQogCiBzdGF0aWMgc3RydWN0IGFjdGl2ZV9ub2RlICpyZXVzZV9pZGxlX2JhcnJpZXIoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCkBAIC02OTcsMTMgKzY2NCwxMyBAQCBpbnQg
aTkxNV9hY3RpdmVfYWNxdWlyZV9wcmVhbGxvY2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmLAogCQkJbm9kZS0+YmFzZS5sb2NrID0KIAkJCQkmZW5naW5lLT5rZXJuZWxfY29udGV4
dC0+dGltZWxpbmUtPm11dGV4OwogI2VuZGlmCi0JCQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJh
c2UucmVxdWVzdCwgTlVMTCk7Ci0JCQlub2RlLT5iYXNlLnJldGlyZSA9IG5vZGVfcmV0aXJlOwor
CQkJUkNVX0lOSVRfUE9JTlRFUihub2RlLT5iYXNlLmZlbmNlLCBOVUxMKTsKKwkJCW5vZGUtPmJh
c2UuY2IuZnVuYyA9IG5vZGVfcmV0aXJlOwogCQkJbm9kZS0+dGltZWxpbmUgPSBpZHg7CiAJCQlu
b2RlLT5yZWYgPSByZWY7CiAJCX0KIAotCQlpZiAoIWk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQo
Jm5vZGUtPmJhc2UpKSB7CisJCWlmICghaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQoJm5vZGUtPmJh
c2UpKSB7CiAJCQkvKgogCQkJICogTWFyayB0aGlzIGFzIGJlaW5nICpvdXIqIHVuY29ubmVjdGVk
IHByb3RvLW5vZGUuCiAJCQkgKgpAQCAtNzEzLDggKzY4MCw4IEBAIGludCBpOTE1X2FjdGl2ZV9h
Y3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQkg
KiBhbmQgdGhlbiB3ZSBjYW4gdXNlIHRoZSByYl9ub2RlIGFuZCBsaXN0IHBvaW50ZXJzCiAJCQkg
KiBmb3Igb3VyIHRyYWNraW5nIG9mIHRoZSBwZW5kaW5nIGJhcnJpZXIuCiAJCQkgKi8KLQkJCVJD
VV9JTklUX1BPSU5URVIobm9kZS0+YmFzZS5yZXF1ZXN0LCBFUlJfUFRSKC1FQUdBSU4pKTsKLQkJ
CW5vZGUtPmJhc2UubGluay5wcmV2ID0gKHZvaWQgKillbmdpbmU7CisJCQlSQ1VfSU5JVF9QT0lO
VEVSKG5vZGUtPmJhc2UuZmVuY2UsIEVSUl9QVFIoLUVBR0FJTikpOworCQkJbm9kZS0+YmFzZS5j
Yi5ub2RlLnByZXYgPSAodm9pZCAqKWVuZ2luZTsKIAkJCWF0b21pY19pbmMoJnJlZi0+Y291bnQp
OwogCQl9CiAKQEAgLTc4MSwyNSArNzQ4LDcxIEBAIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZF9hY3Rp
dmVfYmFycmllcnMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CiAJc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2luZTsKIAlzdHJ1Y3QgbGxpc3Rfbm9kZSAqbm9kZSwg
Km5leHQ7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKIAogCUdFTV9CVUdfT04oaW50ZWxfZW5naW5l
X2lzX3ZpcnR1YWwoZW5naW5lKSk7CiAJR0VNX0JVR19PTihycS0+dGltZWxpbmUgIT0gZW5naW5l
LT5rZXJuZWxfY29udGV4dC0+dGltZWxpbmUpOwogCisJbm9kZSA9IGxsaXN0X2RlbF9hbGwoJmVu
Z2luZS0+YmFycmllcl90YXNrcyk7CisJaWYgKCFub2RlKQorCQlyZXR1cm47CiAJLyoKIAkgKiBB
dHRhY2ggdGhlIGxpc3Qgb2YgcHJvdG8tZmVuY2VzIHRvIHRoZSBpbi1mbGlnaHQgcmVxdWVzdCBz
dWNoCiAJICogdGhhdCB0aGUgcGFyZW50IGk5MTVfYWN0aXZlIHdpbGwgYmUgcmVsZWFzZWQgd2hl
biB0aGlzIHJlcXVlc3QKIAkgKiBpcyByZXRpcmVkLgogCSAqLwotCWxsaXN0X2Zvcl9lYWNoX3Nh
ZmUobm9kZSwgbmV4dCwgbGxpc3RfZGVsX2FsbCgmZW5naW5lLT5iYXJyaWVyX3Rhc2tzKSkgewot
CQlSQ1VfSU5JVF9QT0lOVEVSKGJhcnJpZXJfZnJvbV9sbChub2RlKS0+YmFzZS5yZXF1ZXN0LCBy
cSk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJnJxLT5sb2NrLCBmbGFncyk7CisJbGxpc3RfZm9yX2Vh
Y2hfc2FmZShub2RlLCBuZXh0LCBub2RlKSB7CisJCVJDVV9JTklUX1BPSU5URVIoYmFycmllcl9m
cm9tX2xsKG5vZGUpLT5iYXNlLmZlbmNlLCAmcnEtPmZlbmNlKTsKIAkJc21wX3dtYigpOyAvKiBz
ZXJpYWxpc2Ugd2l0aCByZXVzZV9pZGxlX2JhcnJpZXIgKi8KLQkJbGlzdF9hZGRfdGFpbCgoc3Ry
dWN0IGxpc3RfaGVhZCAqKW5vZGUsICZycS0+YWN0aXZlX2xpc3QpOworCQlsaXN0X2FkZF90YWls
KChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwgJnJxLT5mZW5jZS5jYl9saXN0KTsKKwl9CisJc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmcnEtPmxvY2ssIGZsYWdzKTsKK30KKworI2lmIElTX0VOQUJM
RUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKK3N0YXRpYyBib29sIGFjdGl2ZV9pc19oZWxk
KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKQoreworCXJldHVybiBsb2NrZGVwX2lz
X2hlbGQoYWN0aXZlLT5sb2NrKTsKK30KKyNlbHNlCitzdGF0aWMgYm9vbCBhY3RpdmVfaXNfaGVs
ZChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkKK3sKKwlyZXR1cm4gdHJ1ZTsKK30K
KyNlbmRpZgorCitzdHJ1Y3QgZG1hX2ZlbmNlICoKK19faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0
cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2UpCit7CisJc3RydWN0IGRtYV9mZW5jZSAqcHJldjsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOwor
CisJLyogTkI6IHVwZGF0ZXMgbXVzdCBiZSBzZXJpYWxpc2VkIGJ5IGFuIG91dGVyIHRpbWVsaW5l
IG11dGV4ICovCisJc3Bpbl9sb2NrX2lycXNhdmUoZmVuY2UtPmxvY2ssIGZsYWdzKTsKKwlHRU1f
QlVHX09OKHRlc3RfYml0KERNQV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5mbGFn
cykpOworCisJcHJldiA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoYWN0aXZlLT5mZW5jZSwg
YWN0aXZlX2lzX2hlbGQoYWN0aXZlKSk7CisJaWYgKHByZXYpIHsKKwkJc3Bpbl9sb2NrX25lc3Rl
ZChwcmV2LT5sb2NrLCBTSU5HTEVfREVQVEhfTkVTVElORyk7CisJCV9fbGlzdF9kZWxfZW50cnko
JmFjdGl2ZS0+Y2Iubm9kZSk7CisJCXNwaW5fdW5sb2NrKHByZXYtPmxvY2spOyAvKiBzZXJpYWxp
c2Ugd2l0aCBwcmV2LT5jYl9saXN0ICovCisJCXByZXYgPSByY3VfYWNjZXNzX3BvaW50ZXIoYWN0
aXZlLT5mZW5jZSk7CiAJfQorCisJcmN1X2Fzc2lnbl9wb2ludGVyKGFjdGl2ZS0+ZmVuY2UsIGZl
bmNlKTsKKwlsaXN0X2FkZF90YWlsKCZhY3RpdmUtPmNiLm5vZGUsICZmZW5jZS0+Y2JfbGlzdCk7
CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CisKKwlyZXR1
cm4gcHJldjsKIH0KIAotaW50IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitp
bnQgaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZl
LAorCQkJICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZTsKIAlpbnQgZXJyOwogCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdf
R0VNKQpAQCAtODA3LDE4ICs4MjAsMjUgQEAgaW50IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KHN0
cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAjZW5kaWYKIAogCS8qIE11c3QgbWFp
bnRhaW4gb3JkZXJpbmcgd3J0IHByZXZpb3VzIGFjdGl2ZSByZXF1ZXN0cyAqLwotCWVyciA9IGk5
MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChycSwgYWN0aXZlKTsKLQlpZiAoZXJyKQot
CQlyZXR1cm4gZXJyOworCXJjdV9yZWFkX2xvY2soKTsKKwlmZW5jZSA9IF9faTkxNV9hY3RpdmVf
ZmVuY2Vfc2V0KGFjdGl2ZSwgJnJxLT5mZW5jZSk7CisJaWYgKGZlbmNlKQorCQlmZW5jZSA9IGRt
YV9mZW5jZV9nZXRfcmN1KGZlbmNlKTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCWlmIChmZW5j
ZSkgeworCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CisJ
CWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CiAK
LQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KGFjdGl2ZSwgcnEpOwogCXJldHVybiAwOwogfQog
Ci12b2lkIGk5MTVfYWN0aXZlX3JldGlyZV9ub29wKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0
ICphY3RpdmUsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCit2b2lkIGk5
MTVfYWN0aXZlX25vb3Aoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2Vf
Y2IgKmNiKQogewotCS8qIFNwYWNlIGxlZnQgaW50ZW50aW9uYWxseSBibGFuayAqLworCWk5MTVf
YWN0aXZlX2ZlbmNlX2NiKGZlbmNlLCBjYik7CiB9CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19E
Uk1fSTkxNV9TRUxGVEVTVCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCmluZGV4IGJjMWM5
ZDVkNGY2My4uZTkyZTE4NjY1NTJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKQEAg
LTEwLDcgKzEwLDEwIEBACiAjaW5jbHVkZSA8bGludXgvbG9ja2RlcC5oPgogCiAjaW5jbHVkZSAi
aTkxNV9hY3RpdmVfdHlwZXMuaCIKLSNpbmNsdWRlICJpOTE1X3JlcXVlc3QuaCIKKworc3RydWN0
IGk5MTVfcmVxdWVzdDsKK3N0cnVjdCBpbnRlbF9lbmdpbmVfY3M7CitzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmU7CiAKIC8qCiAgKiBXZSB0cmVhdCByZXF1ZXN0cyBhcyBmZW5jZXMuIFRoaXMgaXMgbm90
IGJlIHRvIGNvbmZ1c2VkIHdpdGggb3VyCkBAIC0yOCwzMDggKzMxLDEwOCBAQAogICogd3JpdGUg
YWNjZXNzIHNvIHRoYXQgd2UgY2FuIHBlcmZvcm0gY29uY3VycmVudCByZWFkIG9wZXJhdGlvbnMg
YmV0d2VlbgogICogdGhlIENQVSBhbmQgR1BVIGVuZ2luZXMsIGFzIHdlbGwgYXMgd2FpdGluZyBm
b3IgYWxsIHJlbmRlcmluZyB0bwogICogY29tcGxldGUsIG9yIHdhaXRpbmcgZm9yIHRoZSBsYXN0
IEdQVSB1c2VyIG9mIGEgImZlbmNlIHJlZ2lzdGVyIi4gVGhlCi0gKiBvYmplY3QgdGhlbiBlbWJl
ZHMgYSAjaTkxNV9hY3RpdmVfcmVxdWVzdCB0byB0cmFjayB0aGUgbW9zdCByZWNlbnQgKGluCisg
KiBvYmplY3QgdGhlbiBlbWJlZHMgYSAjaTkxNV9hY3RpdmVfZmVuY2UgdG8gdHJhY2sgdGhlIG1v
c3QgcmVjZW50IChpbgogICogcmV0aXJlbWVudCBvcmRlcikgcmVxdWVzdCByZWxldmFudCBmb3Ig
dGhlIGRlc2lyZWQgbW9kZSBvZiBhY2Nlc3MuCi0gKiBUaGUgI2k5MTVfYWN0aXZlX3JlcXVlc3Qg
aXMgdXBkYXRlZCB3aXRoIGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCkgdG8KKyAqIFRoZSAjaTkx
NV9hY3RpdmVfZmVuY2UgaXMgdXBkYXRlZCB3aXRoIGk5MTVfYWN0aXZlX2ZlbmNlX3NldCgpIHRv
CiAgKiB0cmFjayB0aGUgbW9zdCByZWNlbnQgZmVuY2UgcmVxdWVzdCwgdHlwaWNhbGx5IHRoaXMg
aXMgZG9uZSBhcyBwYXJ0IG9mCiAgKiBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSgpLgogICoKLSAq
IFdoZW4gdGhlICNpOTE1X2FjdGl2ZV9yZXF1ZXN0IGNvbXBsZXRlcyAoaXMgcmV0aXJlZCksIGl0
IHdpbGwKKyAqIFdoZW4gdGhlICNpOTE1X2FjdGl2ZV9mZW5jZSBjb21wbGV0ZXMgKGlzIHJldGly
ZWQpLCBpdCB3aWxsCiAgKiBzaWduYWwgaXRzIGNvbXBsZXRpb24gdG8gdGhlIG93bmVyIHRocm91
Z2ggYSBjYWxsYmFjayBhcyB3ZWxsIGFzIG1hcmsKLSAqIGl0c2VsZiBhcyBpZGxlIChpOTE1X2Fj
dGl2ZV9yZXF1ZXN0LnJlcXVlc3QgPT0gTlVMTCkuIFRoZSBvd25lcgorICogaXRzZWxmIGFzIGlk
bGUgKGk5MTVfYWN0aXZlX2ZlbmNlLnJlcXVlc3QgPT0gTlVMTCkuIFRoZSBvd25lcgogICogY2Fu
IHRoZW4gcGVyZm9ybSBhbnkgYWN0aW9uLCBzdWNoIGFzIGRlbGF5ZWQgZnJlZWluZyBvZiBhbiBh
Y3RpdmUKICAqIHJlc291cmNlIGluY2x1ZGluZyBpdHNlbGYuCiAgKi8KIAotdm9pZCBpOTE1X2Fj
dGl2ZV9yZXRpcmVfbm9vcChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJ
ICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KTsKK3ZvaWQgaTkxNV9hY3RpdmVfbm9v
cChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpOwogCiAv
KioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdCAtIHByZXBhcmVzIHRoZSBhY3Rpdml0eSB0
cmFja2VyIGZvciB1c2UKKyAqIF9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdCAtIHByZXBhcmVzIHRo
ZSBhY3Rpdml0eSB0cmFja2VyIGZvciB1c2UKICAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNr
ZXIKLSAqIEBycSAtIGluaXRpYWwgcmVxdWVzdCB0byB0cmFjaywgY2FuIGJlIE5VTEwKKyAqIEBm
ZW5jZSAtIGluaXRpYWwgZmVuY2UgdG8gdHJhY2ssIGNhbiBiZSBOVUxMCiAgKiBAZnVuYyAtIGEg
Y2FsbGJhY2sgd2hlbiB0aGVuIHRoZSB0cmFja2VyIGlzIHJldGlyZWQgKGJlY29tZXMgaWRsZSks
CiAgKiAgICAgICAgIGNhbiBiZSBOVUxMCiAgKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0
KCkgcHJlcGFyZXMgdGhlIGVtYmVkZGVkIEBhY3RpdmUgc3RydWN0IGZvciB1c2UgYXMKLSAqIGFu
IGFjdGl2aXR5IHRyYWNrZXIsIHRoYXQgaXMgZm9yIHRyYWNraW5nIHRoZSBsYXN0IGtub3duIGFj
dGl2ZSByZXF1ZXN0Ci0gKiBhc3NvY2lhdGVkIHdpdGggaXQuIFdoZW4gdGhlIGxhc3QgcmVxdWVz
dCBiZWNvbWVzIGlkbGUsIHdoZW4gaXQgaXMgcmV0aXJlZAorICogaTkxNV9hY3RpdmVfZmVuY2Vf
aW5pdCgpIHByZXBhcmVzIHRoZSBlbWJlZGRlZCBAYWN0aXZlIHN0cnVjdCBmb3IgdXNlIGFzCisg
KiBhbiBhY3Rpdml0eSB0cmFja2VyLCB0aGF0IGlzIGZvciB0cmFja2luZyB0aGUgbGFzdCBrbm93
biBhY3RpdmUgZmVuY2UKKyAqIGFzc29jaWF0ZWQgd2l0aCBpdC4gV2hlbiB0aGUgbGFzdCBmZW5j
ZSBiZWNvbWVzIGlkbGUsIHdoZW4gaXQgaXMgcmV0aXJlZAogICogYWZ0ZXIgY29tcGxldGlvbiwg
dGhlIG9wdGlvbmFsIGNhbGxiYWNrIEBmdW5jIGlzIGludm9rZWQuCiAgKi8KIHN0YXRpYyBpbmxp
bmUgdm9pZAotaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0ICphY3RpdmUsCitfX2k5MTVfYWN0aXZlX2ZlbmNlX2luaXQoc3RydWN0IGk5MTVfYWN0aXZl
X2ZlbmNlICphY3RpdmUsCiAJCQkgc3RydWN0IG11dGV4ICpsb2NrLAotCQkJIHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxLAotCQkJIGk5MTVfYWN0aXZlX3JldGlyZV9mbiByZXRpcmUpCisJCQkgdm9p
ZCAqZmVuY2UsCisJCQkgZG1hX2ZlbmNlX2Z1bmNfdCBmbikKIHsKLQlSQ1VfSU5JVF9QT0lOVEVS
KGFjdGl2ZS0+cmVxdWVzdCwgcnEpOwotCUlOSVRfTElTVF9IRUFEKCZhY3RpdmUtPmxpbmspOwot
CWFjdGl2ZS0+cmV0aXJlID0gcmV0aXJlID86IGk5MTVfYWN0aXZlX3JldGlyZV9ub29wOworCVJD
VV9JTklUX1BPSU5URVIoYWN0aXZlLT5mZW5jZSwgZmVuY2UpOworCWFjdGl2ZS0+Y2IuZnVuYyA9
IGZuID86IGk5MTVfYWN0aXZlX25vb3A7CiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVf
REVCVUdfR0VNKQogCWFjdGl2ZS0+bG9jayA9IGxvY2s7CiAjZW5kaWYKIH0KIAotI2RlZmluZSBJ
TklUX0FDVElWRV9SRVFVRVNUKG5hbWUsIGxvY2spIFwKLQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lu
aXQoKG5hbWUpLCAobG9jayksIE5VTEwsIE5VTEwpCi0KLS8qKgotICogaTkxNV9hY3RpdmVfcmVx
dWVzdF9zZXQgLSB1cGRhdGVzIHRoZSB0cmFja2VyIHRvIHdhdGNoIHRoZSBjdXJyZW50IHJlcXVl
c3QKLSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKLSAqIEByZXF1ZXN0IC0gdGhlIHJl
cXVlc3QgdG8gd2F0Y2gKLSAqCi0gKiBfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCkgd2F0Y2hl
cyB0aGUgZ2l2ZW4gQHJlcXVlc3QgZm9yIGNvbXBsZXRpb24uIFdoaWxzdAotICogdGhhdCBAcmVx
dWVzdCBpcyBidXN5LCB0aGUgQGFjdGl2ZSByZXBvcnRzIGJ1c3kuIFdoZW4gdGhhdCBAcmVxdWVz
dCBpcwotICogcmV0aXJlZCwgdGhlIEBhY3RpdmUgdHJhY2tlciBpcyB1cGRhdGVkIHRvIHJlcG9y
dCBpZGxlLgotICovCi1zdGF0aWMgaW5saW5lIHZvaWQKLV9faTkxNV9hY3RpdmVfcmVxdWVzdF9z
ZXQoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSAgc3RydWN0IGk5MTVf
cmVxdWVzdCAqcmVxdWVzdCkKLXsKLSNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJV
R19HRU0pCi0JbG9ja2RlcF9hc3NlcnRfaGVsZChhY3RpdmUtPmxvY2spOwotI2VuZGlmCi0JbGlz
dF9tb3ZlKCZhY3RpdmUtPmxpbmssICZyZXF1ZXN0LT5hY3RpdmVfbGlzdCk7Ci0JcmN1X2Fzc2ln
bl9wb2ludGVyKGFjdGl2ZS0+cmVxdWVzdCwgcmVxdWVzdCk7Ci19Ci0KLWludCBfX211c3RfY2hl
Y2sKLWk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICph
Y3RpdmUsCi0JCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7Ci0KLS8qKgotICogaTkxNV9hY3Rp
dmVfcmVxdWVzdF9yYXcgLSByZXR1cm4gdGhlIGFjdGl2ZSByZXF1ZXN0Ci0gKiBAYWN0aXZlIC0g
dGhlIGFjdGl2ZSB0cmFja2VyCi0gKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoKSByZXR1
cm5zIHRoZSBjdXJyZW50IHJlcXVlc3QgYmVpbmcgdHJhY2tlZCwgb3IgTlVMTC4KLSAqIEl0IGRv
ZXMgbm90IG9idGFpbiBhIHJlZmVyZW5jZSBvbiB0aGUgcmVxdWVzdCBmb3IgdGhlIGNhbGxlciwg
c28gdGhlIGNhbGxlcgotICogbXVzdCBob2xkIHN0cnVjdF9tdXRleC4KLSAqLwotc3RhdGljIGlu
bGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGNvbnN0
IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQlzdHJ1Y3QgbXV0ZXggKm11
dGV4KQotewotCXJldHVybiByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGFjdGl2ZS0+cmVxdWVz
dCwKLQkJCQkJIGxvY2tkZXBfaXNfaGVsZChtdXRleCkpOwotfQotCi0vKioKLSAqIGk5MTVfYWN0
aXZlX3JlcXVlc3RfcGVlayAtIHJlcG9ydCB0aGUgYWN0aXZlIHJlcXVlc3QgYmVpbmcgbW9uaXRv
cmVkCi0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKgotICogaTkxNV9hY3RpdmVf
cmVxdWVzdF9wZWVrKCkgcmV0dXJucyB0aGUgY3VycmVudCByZXF1ZXN0IGJlaW5nIHRyYWNrZWQg
aWYKLSAqIHN0aWxsIGFjdGl2ZSwgb3IgTlVMTC4gSXQgZG9lcyBub3Qgb2J0YWluIGEgcmVmZXJl
bmNlIG9uIHRoZSByZXF1ZXN0Ci0gKiBmb3IgdGhlIGNhbGxlciwgc28gdGhlIGNhbGxlciBtdXN0
IGhvbGQgc3RydWN0X211dGV4LgotICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVl
c3QgKgotaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0ICphY3RpdmUsCi0JCQkgc3RydWN0IG11dGV4ICptdXRleCkKLXsKLQlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpyZXF1ZXN0OwotCi0JcmVxdWVzdCA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3
KGFjdGl2ZSwgbXV0ZXgpOwotCWlmICghcmVxdWVzdCB8fCBpOTE1X3JlcXVlc3RfY29tcGxldGVk
KHJlcXVlc3QpKQotCQlyZXR1cm4gTlVMTDsKKyNkZWZpbmUgSU5JVF9BQ1RJVkVfRkVOQ0UoQSwg
TE9DSykgXAorCV9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdCgoQSksIChMT0NLKSwgTlVMTCwgTlVM
TCkKIAotCXJldHVybiByZXF1ZXN0OwotfQorc3RydWN0IGRtYV9mZW5jZSAqCitfX2k5MTVfYWN0
aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKKwkJCXN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlKTsKIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldCAt
IHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJlcXVlc3QKKyAqIGk5MTVfYWN0aXZl
X2ZlbmNlX3NldCAtIHVwZGF0ZXMgdGhlIHRyYWNrZXIgdG8gd2F0Y2ggdGhlIGN1cnJlbnQgZmVu
Y2UKICAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKKyAqIEBycSAtIHRoZSByZXF1ZXN0
IHRvIHdhdGNoCiAgKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoKSByZXR1cm5zIGEgcmVm
ZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwgb3IgTlVMTAotICogaWYgdGhlIGFjdGl2ZSB0
cmFja2VyIGlzIGlkbGUuIFRoZSBjYWxsZXIgbXVzdCBob2xkIHN0cnVjdF9tdXRleC4KKyAqIGk5
MTVfYWN0aXZlX2ZlbmNlX3NldCgpIHdhdGNoZXMgdGhlIGdpdmVuIEBycSBmb3IgY29tcGxldGlv
bi4gV2hpbGUKKyAqIHRoYXQgQHJxIGlzIGJ1c3ksIHRoZSBAYWN0aXZlIHJlcG9ydHMgYnVzeS4g
V2hlbiB0aGF0IEBycSBpcyBzaWduYWxlZAorICogKG9yIGVsc2UgcmV0aXJlZCkgdGhlIEBhY3Rp
dmUgdHJhY2tlciBpcyB1cGRhdGVkIHRvIHJlcG9ydCBpZGxlLgogICovCi1zdGF0aWMgaW5saW5l
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoY29uc3Qgc3Ry
dWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCXN0cnVjdCBtdXRleCAqbXV0ZXgp
Ci17Ci0JcmV0dXJuIGk5MTVfcmVxdWVzdF9nZXQoaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrKGFj
dGl2ZSwgbXV0ZXgpKTsKLX0KLQotLyoqCi0gKiBfX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3Jj
dSAtIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJlcXVlc3QKLSAqIEBhY3RpdmUg
LSB0aGUgYWN0aXZlIHRyYWNrZXIKLSAqCi0gKiBfX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0KCkg
cmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJlcXVlc3QsCi0gKiBvciBOVUxMIGlm
IHRoZSBhY3RpdmUgdHJhY2tlciBpcyBpZGxlLiBUaGUgY2FsbGVyIG11c3QgaG9sZCB0aGUgUkNV
IHJlYWQKLSAqIGxvY2ssIGJ1dCB0aGUgcmV0dXJuZWQgcG9pbnRlciBpcyBzYWZlIHRvIHVzZSBv
dXRzaWRlIG9mIFJDVS4KLSAqLwotc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoK
LV9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmN1KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0ICphY3RpdmUpCi17Ci0JLyoKLQkgKiBQZXJmb3JtaW5nIGEgbG9ja2xlc3MgcmV0cmll
dmFsIG9mIHRoZSBhY3RpdmUgcmVxdWVzdCBpcyBzdXBlcgotCSAqIHRyaWNreS4gU0xBQl9UWVBF
U0FGRV9CWV9SQ1UgbWVyZWx5IGd1YXJhbnRlZXMgdGhhdCB0aGUgYmFja2luZwotCSAqIHNsYWIg
b2YgcmVxdWVzdCBvYmplY3RzIHdpbGwgbm90IGJlIGZyZWVkIHdoaWxzdCB3ZSBob2xkIHRoZQot
CSAqIFJDVSByZWFkIGxvY2suIEl0IGRvZXMgbm90IGd1YXJhbnRlZSB0aGF0IHRoZSByZXF1ZXN0
IGl0c2VsZgotCSAqIHdpbGwgbm90IGJlIGZyZWVkIGFuZCB0aGVuICpyZXVzZWQqLiBWaXosCi0J
ICoKLQkgKiBUaHJlYWQgQQkJCVRocmVhZCBCCi0JICoKLQkgKiBycSA9IGFjdGl2ZS5yZXF1ZXN0
Ci0JICoJCQkJcmV0aXJlKHJxKSAtPiBmcmVlKHJxKTsKLQkgKgkJCQkocnEgaXMgbm93IGZpcnN0
IG9uIHRoZSBzbGFiIGZyZWVsaXN0KQotCSAqCQkJCWFjdGl2ZS5yZXF1ZXN0ID0gTlVMTAotCSAq
Ci0JICoJCQkJcnEgPSBuZXcgc3VibWlzc2lvbiBvbiBhIG5ldyBvYmplY3QKLQkgKiByZWYocnEp
Ci0JICoKLQkgKiBUbyBwcmV2ZW50IHRoZSByZXF1ZXN0IGZyb20gYmVpbmcgcmV1c2VkIHdoaWxz
dCB0aGUgY2FsbGVyCi0JICogdXNlcyBpdCwgd2UgdGFrZSBhIHJlZmVyZW5jZSBsaWtlIG5vcm1h
bC4gV2hpbHN0IGFjcXVpcmluZwotCSAqIHRoZSByZWZlcmVuY2Ugd2UgY2hlY2sgdGhhdCBpdCBp
cyBub3QgaW4gYSBkZXN0cm95ZWQgc3RhdGUKLQkgKiAocmVmY250ID09IDApLiBUaGF0IHByZXZl
bnRzIHRoZSByZXF1ZXN0IGJlaW5nIHJlYWxsb2NhdGVkCi0JICogd2hpbHN0IHRoZSBjYWxsZXIg
aG9sZHMgb24gdG8gaXQuIFRvIGNoZWNrIHRoYXQgdGhlIHJlcXVlc3QKLQkgKiB3YXMgbm90IHJl
YWxsb2NhdGVkIGFzIHdlIGFjcXVpcmVkIHRoZSByZWZlcmVuY2Ugd2UgaGF2ZSB0bwotCSAqIGNo
ZWNrIHRoYXQgb3VyIHJlcXVlc3QgcmVtYWlucyB0aGUgYWN0aXZlIHJlcXVlc3QgYWNyb3NzCi0J
ICogdGhlIGxvb2t1cCwgaW4gdGhlIHNhbWUgbWFubmVyIGFzIGEgc2VxbG9jay4gVGhlIHZpc2li
aWxpdHkKLQkgKiBvZiB0aGUgcG9pbnRlciB2ZXJzdXMgdGhlIHJlZmVyZW5jZSBjb3VudGluZyBp
cyBjb250cm9sbGVkCi0JICogYnkgdXNpbmcgUkNVIGJhcnJpZXJzIChyY3VfZGVyZWZlcmVuY2Ug
YW5kIHJjdV9hc3NpZ25fcG9pbnRlcikuCi0JICoKLQkgKiBJbiB0aGUgbWlkZGxlIG9mIGFsbCB0
aGF0LCB3ZSBpbnNwZWN0IHdoZXRoZXIgdGhlIHJlcXVlc3QgaXMKLQkgKiBjb21wbGV0ZS4gUmV0
aXJpbmcgaXMgbGF6eSBzbyB0aGUgcmVxdWVzdCBtYXkgYmUgY29tcGxldGVkIGxvbmcKLQkgKiBi
ZWZvcmUgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIHVwZGF0ZWQuIFF1ZXJ5aW5nIHdoZXRoZXIgdGhl
Ci0JICogcmVxdWVzdCBpcyBjb21wbGV0ZSBpcyBmYXIgY2hlYXBlciAoYXMgaXQgaW52b2x2ZXMg
bm8gbG9ja2VkCi0JICogaW5zdHJ1Y3Rpb25zIHNldHRpbmcgY2FjaGVsaW5lcyB0byBleGNsdXNp
dmUpIHRoYW4gYWNxdWlyaW5nCi0JICogdGhlIHJlZmVyZW5jZSwgc28gd2UgZG8gaXQgZmlyc3Qu
IFRoZSBSQ1UgcmVhZCBsb2NrIGVuc3VyZXMgdGhlCi0JICogcG9pbnRlciBkZXJlZmVyZW5jZSBp
cyB2YWxpZCwgYnV0IGRvZXMgbm90IGVuc3VyZSB0aGF0IHRoZQotCSAqIHNlcW5vIG5vciBIV1Mg
aXMgdGhlIHJpZ2h0IG9uZSEgSG93ZXZlciwgaWYgdGhlIHJlcXVlc3Qgd2FzCi0JICogcmVhbGxv
Y2F0ZWQsIHRoYXQgbWVhbnMgdGhlIGFjdGl2ZSB0cmFja2VyJ3MgcmVxdWVzdCB3YXMgY29tcGxl
dGUuCi0JICogSWYgdGhlIG5ldyByZXF1ZXN0IGlzIGFsc28gY29tcGxldGUsIHRoZW4gYm90aCBh
cmUgYW5kIHdlIGNhbgotCSAqIGp1c3QgcmVwb3J0IHRoZSBhY3RpdmUgdHJhY2tlciBpcyBpZGxl
LiBJZiB0aGUgbmV3IHJlcXVlc3QgaXMKLQkgKiBpbmNvbXBsZXRlLCB0aGVuIHdlIGFjcXVpcmUg
YSByZWZlcmVuY2Ugb24gaXQgYW5kIGNoZWNrIHRoYXQKLQkgKiBpdCByZW1haW5lZCB0aGUgYWN0
aXZlIHJlcXVlc3QuCi0JICoKLQkgKiBJdCBpcyB0aGVuIGltcGVyYXRpdmUgdGhhdCB3ZSBkbyBu
b3QgemVybyB0aGUgcmVxdWVzdCBvbgotCSAqIHJlYWxsb2NhdGlvbiwgc28gdGhhdCB3ZSBjYW4g
Y2hhc2UgdGhlIGRhbmdsaW5nIHBvaW50ZXJzIQotCSAqIFNlZSBpOTE1X3JlcXVlc3RfYWxsb2Mo
KS4KLQkgKi8KLQlkbyB7Ci0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7Ci0KLQkJcmVx
dWVzdCA9IHJjdV9kZXJlZmVyZW5jZShhY3RpdmUtPnJlcXVlc3QpOwotCQlpZiAoIXJlcXVlc3Qg
fHwgaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChyZXF1ZXN0KSkKLQkJCXJldHVybiBOVUxMOwotCi0J
CS8qCi0JCSAqIEFuIGVzcGVjaWFsbHkgc2lsbHkgY29tcGlsZXIgY291bGQgZGVjaWRlIHRvIHJl
Y29tcHV0ZSB0aGUKLQkJICogcmVzdWx0IG9mIGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQsIG1vcmUg
c3BlY2lmaWNhbGx5Ci0JCSAqIHJlLWVtaXQgdGhlIGxvYWQgZm9yIHJlcXVlc3QtPmZlbmNlLnNl
cW5vLiBBIHJhY2Ugd291bGQgY2F0Y2gKLQkJICogYSBsYXRlciBzZXFubyB2YWx1ZSwgd2hpY2gg
Y291bGQgZmxpcCB0aGUgcmVzdWx0IGZyb20gdHJ1ZSB0bwotCQkgKiBmYWxzZS4gV2hpY2ggbWVh
bnMgcGFydCBvZiB0aGUgaW5zdHJ1Y3Rpb25zIGJlbG93IG1pZ2h0IG5vdAotCQkgKiBiZSBleGVj
dXRlZCwgd2hpbGUgbGF0ZXIgb24gaW5zdHJ1Y3Rpb25zIGFyZSBleGVjdXRlZC4gRHVlIHRvCi0J
CSAqIGJhcnJpZXJzIHdpdGhpbiB0aGUgcmVmY291bnRpbmcgdGhlIGluY29uc2lzdGVuY3kgY2Fu
J3QgcmVhY2gKLQkJICogcGFzdCB0aGUgY2FsbCB0byBpOTE1X3JlcXVlc3RfZ2V0X3JjdSwgYnV0
IG5vdCBleGVjdXRpbmcKLQkJICogdGhhdCB3aGlsZSBzdGlsbCBleGVjdXRpbmcgaTkxNV9yZXF1
ZXN0X3B1dCgpIGNyZWF0ZXMKLQkJICogaGF2b2MgZW5vdWdoLiAgUHJldmVudCB0aGlzIHdpdGgg
YSBjb21waWxlciBiYXJyaWVyLgotCQkgKi8KLQkJYmFycmllcigpOwotCi0JCXJlcXVlc3QgPSBp
OTE1X3JlcXVlc3RfZ2V0X3JjdShyZXF1ZXN0KTsKLQotCQkvKgotCQkgKiBXaGF0IHN0b3BzIHRo
ZSBmb2xsb3dpbmcgcmN1X2FjY2Vzc19wb2ludGVyKCkgZnJvbSBvY2N1cnJpbmcKLQkJICogYmVm
b3JlIHRoZSBhYm92ZSBpOTE1X3JlcXVlc3RfZ2V0X3JjdSgpPyBJZiB3ZSB3ZXJlCi0JCSAqIHRv
IHJlYWQgdGhlIHZhbHVlIGJlZm9yZSBwYXVzaW5nIHRvIGdldCB0aGUgcmVmZXJlbmNlIHRvCi0J
CSAqIHRoZSByZXF1ZXN0LCB3ZSBtYXkgbm90IG5vdGljZSBhIGNoYW5nZSBpbiB0aGUgYWN0aXZl
Ci0JCSAqIHRyYWNrZXIuCi0JCSAqCi0JCSAqIFRoZSByY3VfYWNjZXNzX3BvaW50ZXIoKSBpcyBh
IG1lcmUgY29tcGlsZXIgYmFycmllciwgd2hpY2gKLQkJICogbWVhbnMgYm90aCB0aGUgQ1BVIGFu
ZCBjb21waWxlciBhcmUgZnJlZSB0byBwZXJmb3JtIHRoZQotCQkgKiBtZW1vcnkgcmVhZCB3aXRo
b3V0IGNvbnN0cmFpbnQuIFRoZSBjb21waWxlciBvbmx5IGhhcyB0bwotCQkgKiBlbnN1cmUgdGhh
dCBhbnkgb3BlcmF0aW9ucyBhZnRlciB0aGUgcmN1X2FjY2Vzc19wb2ludGVyKCkKLQkJICogb2Nj
dXIgYWZ0ZXJ3YXJkcyBpbiBwcm9ncmFtIG9yZGVyLiBUaGlzIG1lYW5zIHRoZSByZWFkIG1heQot
CQkgKiBiZSBwZXJmb3JtZWQgZWFybGllciBieSBhbiBvdXQtb2Ytb3JkZXIgQ1BVLCBvciBhZHZl
bnR1cm91cwotCQkgKiBjb21waWxlci4KLQkJICoKLQkJICogVGhlIGF0b21pYyBvcGVyYXRpb24g
YXQgdGhlIGhlYXJ0IG9mCi0JCSAqIGk5MTVfcmVxdWVzdF9nZXRfcmN1KCksIHNlZSBkbWFfZmVu
Y2VfZ2V0X3JjdSgpLCBpcwotCQkgKiBhdG9taWNfaW5jX25vdF96ZXJvKCkgd2hpY2ggaXMgb25s
eSBhIGZ1bGwgbWVtb3J5IGJhcnJpZXIKLQkJICogd2hlbiBzdWNjZXNzZnVsLiBUaGF0IGlzLCBp
ZiBpOTE1X3JlcXVlc3RfZ2V0X3JjdSgpCi0JCSAqIHJldHVybnMgdGhlIHJlcXVlc3QgKGFuZCBz
byB3aXRoIHRoZSByZWZlcmVuY2UgY291bnRlZAotCQkgKiBpbmNyZW1lbnRlZCkgdGhlbiB0aGUg
Zm9sbG93aW5nIHJlYWQgZm9yIHJjdV9hY2Nlc3NfcG9pbnRlcigpCi0JCSAqIG11c3Qgb2NjdXIg
YWZ0ZXIgdGhlIGF0b21pYyBvcGVyYXRpb24gYW5kIHNvIGNvbmZpcm0KLQkJICogdGhhdCB0aGlz
IHJlcXVlc3QgaXMgdGhlIG9uZSBjdXJyZW50bHkgYmVpbmcgdHJhY2tlZC4KLQkJICoKLQkJICog
VGhlIGNvcnJlc3BvbmRpbmcgd3JpdGUgYmFycmllciBpcyBwYXJ0IG9mCi0JCSAqIHJjdV9hc3Np
Z25fcG9pbnRlcigpLgotCQkgKi8KLQkJaWYgKCFyZXF1ZXN0IHx8IHJlcXVlc3QgPT0gcmN1X2Fj
Y2Vzc19wb2ludGVyKGFjdGl2ZS0+cmVxdWVzdCkpCi0JCQlyZXR1cm4gcmN1X3BvaW50ZXJfaGFu
ZG9mZihyZXF1ZXN0KTsKLQotCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOwotCX0gd2hpbGUg
KDEpOwotfQotCitpbnQgX19tdXN0X2NoZWNrCitpOTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0
IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUsCisJCSAgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKTsKIC8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQgLSByZXR1cm4g
YSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0CisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9n
ZXQgLSByZXR1cm4gYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSBmZW5jZQogICogQGFjdGl2ZSAt
IHRoZSBhY3RpdmUgdHJhY2tlcgogICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3VubG9j
a2VkKCkgcmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJlcXVlc3QsCisgKiBpOTE1
X2FjdGl2ZV9mZW5jZV9nZXQoKSByZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgZmVu
Y2UsCiAgKiBvciBOVUxMIGlmIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBpZGxlLiBUaGUgcmVmZXJl
bmNlIGlzIG9idGFpbmVkIHVuZGVyIFJDVSwKICAqIHNvIG5vIGxvY2tpbmcgaXMgcmVxdWlyZWQg
YnkgdGhlIGNhbGxlci4KICAqCi0gKiBUaGUgcmVmZXJlbmNlIHNob3VsZCBiZSBmcmVlZCB3aXRo
IGk5MTVfcmVxdWVzdF9wdXQoKS4KKyAqIFRoZSByZWZlcmVuY2Ugc2hvdWxkIGJlIGZyZWVkIHdp
dGggZG1hX2ZlbmNlX3B1dCgpLgogICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVl
c3QgKgotaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQoY29uc3Qgc3RydWN0IGk5MTVf
YWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRtYV9mZW5jZSAq
CitpOTE1X2FjdGl2ZV9mZW5jZV9nZXQoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUp
CiB7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZTsKIAogCXJjdV9yZWFkX2xvY2soKTsKLQlyZXF1ZXN0ID0gX19pOTE1X2FjdGl2ZV9yZXF1
ZXN0X2dldF9yY3UoYWN0aXZlKTsKKwlmZW5jZSA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJmFj
dGl2ZS0+ZmVuY2UpOwogCXJjdV9yZWFkX3VubG9jaygpOwogCi0JcmV0dXJuIHJlcXVlc3Q7CisJ
cmV0dXJuIGZlbmNlOwogfQogCiAvKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQgLSBy
ZXBvcnQgd2hldGhlciB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgYXNzaWduZWQKKyAqIGk5MTVfYWN0
aXZlX2ZlbmNlX2lzc2V0IC0gcmVwb3J0IHdoZXRoZXIgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGFz
c2lnbmVkCiAgKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCiAgKgotICogaTkxNV9hY3Rp
dmVfcmVxdWVzdF9pc3NldCgpIHJldHVybnMgdHJ1ZSBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMg
Y3VycmVudGx5Ci0gKiBhc3NpZ25lZCB0byBhIHJlcXVlc3QuIER1ZSB0byB0aGUgbGF6eSByZXRp
cmluZywgdGhhdCByZXF1ZXN0IG1heSBiZSBpZGxlCisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9pc3Nl
dCgpIHJldHVybnMgdHJ1ZSBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgY3VycmVudGx5CisgKiBh
c3NpZ25lZCB0byBhIGZlbmNlLiBEdWUgdG8gdGhlIGxhenkgcmV0aXJpbmcsIHRoYXQgZmVuY2Ug
bWF5IGJlIGlkbGUKICAqIGFuZCB0aGlzIG1heSByZXBvcnQgc3RhbGUgaW5mb3JtYXRpb24uCiAg
Ki8KIHN0YXRpYyBpbmxpbmUgYm9vbAotaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldChjb25zdCBz
dHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQoraTkxNV9hY3RpdmVfZmVuY2VfaXNz
ZXQoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpCiB7Ci0JcmV0dXJuIHJj
dV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPnJlcXVlc3QpOworCXJldHVybiByY3VfYWNjZXNzX3Bv
aW50ZXIoYWN0aXZlLT5mZW5jZSk7CiB9CiAKLS8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9y
ZXRpcmUgLSB3YWl0cyB1bnRpbCB0aGUgcmVxdWVzdCBpcyByZXRpcmVkCi0gKiBAYWN0aXZlIC0g
dGhlIGFjdGl2ZSByZXF1ZXN0IG9uIHdoaWNoIHRvIHdhaXQKLSAqCi0gKiBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X3JldGlyZSgpIHdhaXRzIHVudGlsIHRoZSByZXF1ZXN0IGlzIGNvbXBsZXRlZCwKLSAq
IGFuZCB0aGVuIGVuc3VyZXMgdGhhdCBhdCBsZWFzdCB0aGUgcmV0aXJlbWVudCBoYW5kbGVyIGZv
ciB0aGlzCi0gKiBAYWN0aXZlIHRyYWNrZXIgaXMgY2FsbGVkIGJlZm9yZSByZXR1cm5pbmcuIElm
IHRoZSBAYWN0aXZlCi0gKiB0cmFja2VyIGlzIGlkbGUsIHRoZSBmdW5jdGlvbiByZXR1cm5zIGlt
bWVkaWF0ZWx5LgotICovCi1zdGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKLWk5MTVfYWN0
aXZlX3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0J
CQkgICBzdHJ1Y3QgbXV0ZXggKm11dGV4KQorc3RhdGljIGlubGluZSB2b2lkCitpOTE1X2FjdGl2
ZV9mZW5jZV9jYihzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAq
Y2IpCiB7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKLQlsb25nIHJldDsKLQotCXJl
cXVlc3QgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdyhhY3RpdmUsIG11dGV4KTsKLQlpZiAoIXJl
cXVlc3QpCi0JCXJldHVybiAwOwotCi0JcmV0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocmVxdWVzdCwK
LQkJCQlJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKLQkJCQlNQVhfU0NIRURVTEVfVElNRU9VVCk7
Ci0JaWYgKHJldCA8IDApCi0JCXJldHVybiByZXQ7Ci0KLQlsaXN0X2RlbF9pbml0KCZhY3RpdmUt
PmxpbmspOwotCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQotCWFj
dGl2ZS0+cmV0aXJlKGFjdGl2ZSwgcmVxdWVzdCk7CisJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNl
ICphY3RpdmUgPQorCQljb250YWluZXJfb2YoY2IsIHR5cGVvZigqYWN0aXZlKSwgY2IpOwogCi0J
cmV0dXJuIDA7CisJUkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPmZlbmNlLCBOVUxMKTsKIH0KIAog
LyoKQEAgLTM1OCwyMCArMTYxLDE5IEBAIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKHN0cnVj
dCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAgKiBzeW5jaHJvbmlzYXRpb24uCiAgKi8K
IAotdm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
Ci0JCQlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKK3ZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkJaW50ICgqYWN0aXZlKShzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZiksCiAJCQl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiksCiAJ
CQlzdHJ1Y3QgbG9ja19jbGFzc19rZXkgKmtleSk7Ci0jZGVmaW5lIGk5MTVfYWN0aXZlX2luaXQo
aTkxNSwgcmVmLCBhY3RpdmUsIHJldGlyZSkgZG8gewkJXAorI2RlZmluZSBpOTE1X2FjdGl2ZV9p
bml0KHJlZiwgYWN0aXZlLCByZXRpcmUpIGRvIHsJCVwKIAlzdGF0aWMgc3RydWN0IGxvY2tfY2xh
c3Nfa2V5IF9fa2V5OwkJCQlcCiAJCQkJCQkJCQlcCi0JX19pOTE1X2FjdGl2ZV9pbml0KGk5MTUs
IHJlZiwgYWN0aXZlLCByZXRpcmUsICZfX2tleSk7CQlcCisJX19pOTE1X2FjdGl2ZV9pbml0KHJl
ZiwgYWN0aXZlLCByZXRpcmUsICZfX2tleSk7CQlcCiB9IHdoaWxlICgwKQogCiBpbnQgaTkxNV9h
Y3RpdmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkgICAgc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0bCwKLQkJICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKTsKKwkJICAgIHN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlKTsKIAogdm9pZCBpOTE1X2FjdGl2ZV9zZXRfZXhjbHVzaXZlKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmKTsKIApAQCAtMzc5LDEy
ICsxODEsMTEgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYp
OwogCiBpbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSwKIAkJCSAgICAgIHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKLWludCBpOTE1X3JlcXVlc3Rf
YXdhaXRfYWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0JCQkJICAgICAg
c3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSk7CitpbnQgaTkxNV9yZXF1ZXN0X2F3
YWl0X2FjdGl2ZV9mZW5jZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJCQkgICAgc3RydWN0
IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpOwogCiBpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiB2b2lkIGk5MTVfYWN0aXZlX3JlbGVhc2Uoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpOwotdm9pZCBfX2k5MTVfYWN0aXZlX3JlbGVhc2VfbmVzdGVkKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBpbnQgc3ViY2xhc3MpOwogCiBib29sIGk5MTVfYWN0aXZl
X3RyeWdyYWIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwogdm9pZCBpOTE1X2FjdGl2ZV91bmdy
YWIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlX3R5cGVzLmgKaW5kZXggMDIxMTY3ZjAwMDRkLi43NGEzMmNjYTE0ZGYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApAQCAtMTcsMTcgKzE3LDkgQEAKIAogI2lu
Y2x1ZGUgImk5MTVfdXRpbHMuaCIKIAotc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7Ci1zdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdDsKLXN0cnVjdCBpOTE1X3JlcXVlc3Q7Ci0KLXR5cGVkZWYgdm9p
ZCAoKmk5MTVfYWN0aXZlX3JldGlyZV9mbikoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKiwK
LQkJCQkgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICopOwotCi1zdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCB7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCBfX3JjdSAqcmVxdWVzdDsKLQlzdHJ1Y3Qg
bGlzdF9oZWFkIGxpbms7Ci0JaTkxNV9hY3RpdmVfcmV0aXJlX2ZuIHJldGlyZTsKK3N0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSB7CisJc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqZmVuY2U7CisJc3Ry
dWN0IGRtYV9mZW5jZV9jYiBjYjsKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJV
R19HRU0pCiAJLyoKIAkgKiBJbmNvcnBvcmVhbCEKQEAgLTUzLDggKzQ1LDYgQEAgc3RydWN0IGFj
dGl2ZV9ub2RlOwogI2RlZmluZSBpOTE1X2FjdGl2ZV9tYXlfc2xlZXAoZm4pIHB0cl9wYWNrX2Jp
dHMoJihmbiksIEk5MTVfQUNUSVZFX01BWV9TTEVFUCwgMikKIAogc3RydWN0IGk5MTVfYWN0aXZl
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKLQogCXN0cnVjdCBhY3RpdmVfbm9k
ZSAqY2FjaGU7CiAJc3RydWN0IHJiX3Jvb3QgdHJlZTsKIAlzdHJ1Y3QgbXV0ZXggbXV0ZXg7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCAzNDViNmFjZTc1OTQuLmFmNjQ5ZWNlNzlmYSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC04OTEsMjggKzg5MSwzOCBAQCB3YWl0X2Zvcl90aW1l
bGluZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAlzcGluX2xvY2soJnRpbWVs
aW5lcy0+bG9jayk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh0bCwgJnRpbWVsaW5lcy0+YWN0aXZl
X2xpc3QsIGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJCXN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQo
JnRsLT5sYXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQorCQlmZW5jZSA9IGk5MTVfYWN0aXZlX2Zl
bmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghZmVuY2UpCiAJCQljb250aW51ZTsK
IAogCQlzcGluX3VubG9jaygmdGltZWxpbmVzLT5sb2NrKTsKIAotCQkvKgotCQkgKiAiUmFjZS10
by1pZGxlIi4KLQkJICoKLQkJICogU3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBv
ZnRlbiB1c2VkIGEgc3luY2hyb25vdXMKLQkJICogc3RlcCBwcmlvciB0byBpZGxpbmcsIGUuZy4g
aW4gc3VzcGVuZCBmb3IgZmx1c2hpbmcgYWxsCi0JCSAqIGN1cnJlbnQgb3BlcmF0aW9ucyB0byBt
ZW1vcnkgYmVmb3JlIHNsZWVwaW5nLiBUaGVzZSB3ZQotCQkgKiB3YW50IHRvIGNvbXBsZXRlIGFz
IHF1aWNrbHkgYXMgcG9zc2libGUgdG8gYXZvaWQgcHJvbG9uZ2VkCi0JCSAqIHN0YWxscywgc28g
YWxsb3cgdGhlIGdwdSB0byBib29zdCB0byBtYXhpbXVtIGNsb2Nrcy4KLQkJICovCi0JCWlmIChm
bGFncyAmIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCkKLQkJCWdlbjZfcnBzX2Jvb3N0KHJxKTsK
KwkJaWYgKCFkbWFfZmVuY2VfaXNfaTkxNShmZW5jZSkpIHsKKwkJCXRpbWVvdXQgPSBkbWFfZmVu
Y2Vfd2FpdF90aW1lb3V0KGZlbmNlLAorCQkJCQkJCSBmbGFncyAmIEk5MTVfV0FJVF9JTlRFUlJV
UFRJQkxFLAorCQkJCQkJCSB0aW1lb3V0KTsKKwkJfSBlbHNlIHsKKwkJCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxID0gdG9fcmVxdWVzdChmZW5jZSk7CisKKwkJCS8qCisJCQkgKiAiUmFjZS10by1p
ZGxlIi4KKwkJCSAqCisJCQkgKiBTd2l0Y2hpbmcgdG8gdGhlIGtlcm5lbCBjb250ZXh0IGlzIG9m
dGVuIHVzZWQgYXMKKwkJCSAqIGEgc3luY2hyb25vdXMgc3RlcCBwcmlvciB0byBpZGxpbmcsIGUu
Zy4gaW4gc3VzcGVuZAorCQkJICogZm9yIGZsdXNoaW5nIGFsbCBjdXJyZW50IG9wZXJhdGlvbnMg
dG8gbWVtb3J5IGJlZm9yZQorCQkJICogc2xlZXBpbmcuIFRoZXNlIHdlIHdhbnQgdG8gY29tcGxl
dGUgYXMgcXVpY2tseSBhcworCQkJICogcG9zc2libGUgdG8gYXZvaWQgcHJvbG9uZ2VkIHN0YWxs
cywgc28gYWxsb3cgdGhlIGdwdQorCQkJICogdG8gYm9vc3QgdG8gbWF4aW11bSBjbG9ja3MuCisJ
CQkgKi8KKwkJCWlmIChmbGFncyAmIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCkKKwkJCQlnZW42
X3Jwc19ib29zdChycSk7CisKKwkJCXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgZmxh
Z3MsIHRpbWVvdXQpOworCQl9CiAKLQkJdGltZW91dCA9IGk5MTVfcmVxdWVzdF93YWl0KHJxLCBm
bGFncywgdGltZW91dCk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlkbWFfZmVuY2VfcHV0
KGZlbmNlKTsKIAkJaWYgKHRpbWVvdXQgPCAwKQogCQkJcmV0dXJuIHRpbWVvdXQ7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKaW5kZXggMDJlNjliMzY2NDAyLi4wNjExM2EzMGQxZDUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0xODM4LDcgKzE4MzgsNiBAQCBz
dGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfdm1hX29wcyBwZF92bWFfb3BzID0gewogCiBzdGF0aWMg
c3RydWN0IGk5MTVfdm1hICpwZF92bWFfY3JlYXRlKHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCwg
aW50IHNpemUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBwcGd0dC0+YmFz
ZS52bS5pOTE1OwogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBwcGd0dC0+YmFzZS52bS5ndC0+
Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIApAQCAtMTg0OSw3ICsxODQ4LDcgQEAgc3Rh
dGljIHN0cnVjdCBpOTE1X3ZtYSAqcGRfdm1hX2NyZWF0ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBn
dHQsIGludCBzaXplKQogCWlmICghdm1hKQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAot
CWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJnZtYS0+YWN0aXZlLCBOVUxMLCBOVUxMKTsKKwlpOTE1
X2FjdGl2ZV9pbml0KCZ2bWEtPmFjdGl2ZSwgTlVMTCwgTlVMTCk7CiAKIAl2bWEtPnZtID0gJmdn
dHQtPnZtOwogCXZtYS0+b3BzID0gJnBkX3ZtYV9vcHM7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVx
dWVzdC5jCmluZGV4IDg2YzhkZDQ0MjE2Yi4uMjZkNzI0MTAyMDM4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuYwpAQCAtMTk2LDkgKzE5Niw4IEBAIHN0YXRpYyB2b2lkIGZyZWVfY2Fw
dHVyZV9saXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCiAKIHN0YXRpYyBib29sIGk5
MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0Jc3RydWN0IGk5
MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwgKm5leHQ7Ci0KIAlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZycS0+dGltZWxpbmUtPm11dGV4KTsKKwogCWlmICghaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChy
cSkpCiAJCXJldHVybiBmYWxzZTsKIApAQCAtMjIyLDM1ICsyMjEsNiBAQCBzdGF0aWMgYm9vbCBp
OTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCUdFTV9CVUdfT04o
IWxpc3RfaXNfZmlyc3QoJnJxLT5saW5rLCAmcnEtPnRpbWVsaW5lLT5yZXF1ZXN0cykpOwogCXJx
LT5yaW5nLT5oZWFkID0gcnEtPnBvc3RmaXg7CiAKLQkvKgotCSAqIFdhbGsgdGhyb3VnaCB0aGUg
YWN0aXZlIGxpc3QsIGNhbGxpbmcgcmV0aXJlIG9uIGVhY2guIFRoaXMgYWxsb3dzCi0JICogb2Jq
ZWN0cyB0byB0cmFjayB0aGVpciBHUFUgYWN0aXZpdHkgYW5kIG1hcmsgdGhlbXNlbHZlcyBhcyBp
ZGxlCi0JICogd2hlbiB0aGVpciAqbGFzdCogYWN0aXZlIHJlcXVlc3QgaXMgY29tcGxldGVkICh1
cGRhdGluZyBzdGF0ZQotCSAqIHRyYWNraW5nIGxpc3RzIGZvciBldmljdGlvbiwgYWN0aXZlIHJl
ZmVyZW5jZXMgZm9yIEdFTSwgZXRjKS4KLQkgKgotCSAqIEFzIHRoZSAtPnJldGlyZSgpIG1heSBm
cmVlIHRoZSBub2RlLCB3ZSBkZWNvdXBsZSBpdCBmaXJzdCBhbmQKLQkgKiBwYXNzIGFsb25nIHRo
ZSBhdXhpbGlhcnkgaW5mb3JtYXRpb24gKHRvIGF2b2lkIGRlcmVmZXJlbmNpbmcKLQkgKiB0aGUg
bm9kZSBhZnRlciB0aGUgY2FsbGJhY2spLgotCSAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2Fm
ZShhY3RpdmUsIG5leHQsICZycS0+YWN0aXZlX2xpc3QsIGxpbmspIHsKLQkJLyoKLQkJICogSW4g
bWljcm9iZW5jaG1hcmtzIG9yIGZvY3VzaW5nIHVwb24gdGltZSBpbnNpZGUgdGhlIGtlcm5lbCwK
LQkJICogd2UgbWF5IHNwZW5kIGFuIGlub3JkaW5hdGUgYW1vdW50IG9mIHRpbWUgc2ltcGx5IGhh
bmRsaW5nCi0JCSAqIHRoZSByZXRpcmVtZW50IG9mIHJlcXVlc3RzIGFuZCBwcm9jZXNzaW5nIHRo
ZWlyIGNhbGxiYWNrcy4KLQkJICogT2Ygd2hpY2gsIHRoaXMgbG9vcCBpdHNlbGYgaXMgcGFydGlj
dWxhcmx5IGhvdCBkdWUgdG8gdGhlCi0JCSAqIGNhY2hlIG1pc3NlcyB3aGVuIGp1bXBpbmcgYXJv
dW5kIHRoZSBsaXN0IG9mCi0JCSAqIGk5MTVfYWN0aXZlX3JlcXVlc3QuICBTbyB3ZSB0cnkgdG8g
a2VlcCB0aGlzIGxvb3AgYXMKLQkJICogc3RyZWFtbGluZWQgYXMgcG9zc2libGUgYW5kIGFsc28g
cHJlZmV0Y2ggdGhlIG5leHQKLQkJICogaTkxNV9hY3RpdmVfcmVxdWVzdCB0byB0cnkgYW5kIGhp
ZGUgdGhlIGxpa2VseSBjYWNoZSBtaXNzLgotCQkgKi8KLQkJcHJlZmV0Y2h3KG5leHQpOwotCi0J
CUlOSVRfTElTVF9IRUFEKCZhY3RpdmUtPmxpbmspOwotCQlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2
ZS0+cmVxdWVzdCwgTlVMTCk7Ci0KLQkJYWN0aXZlLT5yZXRpcmUoYWN0aXZlLCBycSk7Ci0JfQot
CiAJbG9jYWxfaXJxX2Rpc2FibGUoKTsKIAogCS8qCkBAIC02NjMsNyArNjMzLDYgQEAgX19pOTE1
X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgZ2ZwX3QgZ2ZwKQogCXJx
LT5mbGFncyA9IDA7CiAJcnEtPmV4ZWN1dGlvbl9tYXNrID0gQUxMX0VOR0lORVM7CiAKLQlJTklU
X0xJU1RfSEVBRCgmcnEtPmFjdGl2ZV9saXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmcnEtPmV4ZWN1
dGVfY2IpOwogCiAJLyoKQEAgLTcwMiw3ICs2NzEsNiBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBnZnBfdCBnZnApCiAJY2UtPnJpbmctPmVtaXQgPSBy
cS0+aGVhZDsKIAogCS8qIE1ha2Ugc3VyZSB3ZSBkaWRuJ3QgYWRkIG91cnNlbHZlcyB0byBleHRl
cm5hbCBzdGF0ZSBiZWZvcmUgZnJlZWluZyAqLwotCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnJx
LT5hY3RpdmVfbGlzdCkpOwogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnJxLT5zY2hlZC5zaWdu
YWxlcnNfbGlzdCkpOwogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnJxLT5zY2hlZC53YWl0ZXJz
X2xpc3QpKTsKIApAQCAtMTA5NSw4ICsxMDYzLDggQEAgX19pOTE1X3JlcXVlc3RfYWRkX3RvX3Rp
bWVsaW5lKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCSAqIHByZWNsdWRlcyBvcHRpbWlzaW5n
IHRvIHVzZSBzZW1hcGhvcmVzIHNlcmlhbGlzYXRpb24gb2YgYSBzaW5nbGUKIAkgKiB0aW1lbGlu
ZSBhY3Jvc3MgZW5naW5lcy4KIAkgKi8KLQlwcmV2ID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3Rl
ZCh0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LnJlcXVlc3QsCi0JCQkJCSBsb2NrZGVwX2lzX2hlbGQo
JnRpbWVsaW5lLT5tdXRleCkpOworCXByZXYgPSB0b19yZXF1ZXN0KF9faTkxNV9hY3RpdmVfZmVu
Y2Vfc2V0KCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LAorCQkJCQkJICAmcnEtPmZlbmNlKSk7CiAJ
aWYgKHByZXYgJiYgIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocHJldikpIHsKIAkJaWYgKGlzX3Bv
d2VyX29mXzIocHJldi0+ZW5naW5lLT5tYXNrIHwgcnEtPmVuZ2luZS0+bWFzaykpCiAJCQlpOTE1
X3N3X2ZlbmNlX2F3YWl0X3N3X2ZlbmNlKCZycS0+c3VibWl0LApAQCAtMTEyMSw3ICsxMDg5LDYg
QEAgX19pOTE1X3JlcXVlc3RfYWRkX3RvX3RpbWVsaW5lKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KQogCSAqIHVzLCB0aGUgdGltZWxpbmUgd2lsbCBob2xkIGl0cyBzZXFubyB3aGljaCBpcyBsYXRl
ciB0aGFuIG91cnMuCiAJICovCiAJR0VNX0JVR19PTih0aW1lbGluZS0+c2Vxbm8gIT0gcnEtPmZl
bmNlLnNlcW5vKTsKLQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZ0aW1lbGluZS0+bGFzdF9y
ZXF1ZXN0LCBycSk7CiAKIAlyZXR1cm4gcHJldjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmgKaW5kZXggOGFjNmUxMjI2YTU2Li4zMjUxZDJiZGJlZWEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcmVxdWVzdC5oCkBAIC0yMTEsNyArMjExLDYgQEAgc3RydWN0IGk5MTVfcmVxdWVzdCB7
CiAJICogb24gdGhlIGFjdGl2ZV9saXN0IChvZiB0aGVpciBmaW5hbCByZXF1ZXN0KS4KIAkgKi8K
IAlzdHJ1Y3QgaTkxNV9jYXB0dXJlX2xpc3QgKmNhcHR1cmVfbGlzdDsKLQlzdHJ1Y3QgbGlzdF9o
ZWFkIGFjdGl2ZV9saXN0OwogCiAJLyoqIFRpbWUgYXQgd2hpY2ggdGhpcyByZXF1ZXN0IHdhcyBl
bWl0dGVkLCBpbiBqaWZmaWVzLiAqLwogCXVuc2lnbmVkIGxvbmcgZW1pdHRlZF9qaWZmaWVzOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggODc4YWJhNjA4YzcwLi41MTNkNjllZTdjOTggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMTIwLDggKzEyMCw3IEBAIHZtYV9jcmVhdGUoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl2bWEtPnNpemUgPSBvYmotPmJhc2Uuc2l6
ZTsKIAl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gSTkxNV9HVFRfTUlOX0FMSUdOTUVOVDsKIAot
CWk5MTVfYWN0aXZlX2luaXQodm0tPmk5MTUsICZ2bWEtPmFjdGl2ZSwKLQkJCSBfX2k5MTVfdm1h
X2FjdGl2ZSwgX19pOTE1X3ZtYV9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoJnZtYS0+YWN0
aXZlLCBfX2k5MTVfdm1hX2FjdGl2ZSwgX19pOTE1X3ZtYV9yZXRpcmUpOwogCiAJLyogRGVjbGFy
ZSBvdXJzZWx2ZXMgc2FmZSBmb3IgdXNlIGluc2lkZSBzaHJpbmtlcnMgKi8KIAlpZiAoSVNfRU5B
QkxFRChDT05GSUdfTE9DS0RFUCkpIHsKQEAgLTk4OSw3ICs5ODgsNyBAQCBpbnQgaTkxNV92bWFf
bW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJICogYWRkIHRoZSBhY3RpdmUg
cmVmZXJlbmNlIGZpcnN0IGFuZCBxdWV1ZSBmb3IgaXQgdG8gYmUgZHJvcHBlZAogCSAqICpsYXN0
Ki4KIAkgKi8KLQllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnZtYS0+YWN0aXZlLCBycS0+dGltZWxp
bmUsIHJxKTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnZtYS0+YWN0aXZlLCBycS0+dGltZWxp
bmUsICZycS0+ZmVuY2UpOwogCWlmICh1bmxpa2VseShlcnIpKQogCQlyZXR1cm4gZXJyOwogCkBA
IC05OTcsNyArOTk2LDcgQEAgaW50IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hLAogCQlpZiAoaW50ZWxfZnJvbnRidWZmZXJfaW52YWxpZGF0ZShvYmotPmZyb250
YnVmZmVyLCBPUklHSU5fQ1MpKQogCQkJaTkxNV9hY3RpdmVfcmVmKCZvYmotPmZyb250YnVmZmVy
LT53cml0ZSwKIAkJCQkJcnEtPnRpbWVsaW5lLAotCQkJCQlycSk7CisJCQkJCSZycS0+ZmVuY2Up
OwogCiAJCWRtYV9yZXN2X2FkZF9leGNsX2ZlbmNlKHZtYS0+cmVzdiwgJnJxLT5mZW5jZSk7CiAJ
CW9iai0+d3JpdGVfZG9tYWluID0gSTkxNV9HRU1fRE9NQUlOX1JFTkRFUjsKQEAgLTEwMzEsNiAr
MTAzMCw3IEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJaWYg
KHJldCkKIAkJcmV0dXJuIHJldDsKIAorCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZt
YSkpOwogCWlmIChpOTE1X3ZtYV9pc19waW5uZWQodm1hKSkgewogCQl2bWFfcHJpbnRfYWxsb2Nh
dG9yKHZtYSwgImlzIHBpbm5lZCIpOwogCQlyZXR1cm4gLUVCVVNZOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwppbmRleCA3N2Q4NDRhYzhiNzEuLmQxZGQ1
ZTI5MzZiOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
YWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZl
LmMKQEAgLTY4LDcgKzY4LDcgQEAgc3RhdGljIHN0cnVjdCBsaXZlX2FjdGl2ZSAqX19saXZlX2Fs
bG9jKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlyZXR1cm4gTlVMTDsKIAogCWty
ZWZfaW5pdCgmYWN0aXZlLT5yZWYpOwotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmFjdGl2ZS0+
YmFzZSwgX19saXZlX2FjdGl2ZSwgX19saXZlX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgm
YWN0aXZlLT5iYXNlLCBfX2xpdmVfYWN0aXZlLCBfX2xpdmVfcmV0aXJlKTsKIAogCXJldHVybiBh
Y3RpdmU7CiB9CkBAIC0xMTAsNyArMTEwLDkgQEAgX19saXZlX2FjdGl2ZV9zZXR1cChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJCQkJCSAgICAgICBzdWJtaXQsCiAJCQkJCQkgICAg
ICAgR0ZQX0tFUk5FTCk7CiAJCWlmIChlcnIgPj0gMCkKLQkJCWVyciA9IGk5MTVfYWN0aXZlX3Jl
ZigmYWN0aXZlLT5iYXNlLCBycS0+dGltZWxpbmUsIHJxKTsKKwkJCWVyciA9IGk5MTVfYWN0aXZl
X3JlZigmYWN0aXZlLT5iYXNlLAorCQkJCQkgICAgICBycS0+dGltZWxpbmUsCisJCQkJCSAgICAg
ICZycS0+ZmVuY2UpOwogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJaWYgKGVycikgewogCQkJ
cHJfZXJyKCJGYWlsZWQgdG8gdHJhY2sgYWN0aXZlIHJlZiFcbiIpOwpAQCAtMTQ2LDE5ICsxNDgs
MTMgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV93YWl0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgbGl2ZV9hY3RpdmUgKmFjdGl2
ZTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlpbnQgZXJyID0gMDsKIAogCS8qIENoZWNr
IHRoYXQgd2UgZ2V0IGEgY2FsbGJhY2sgd2hlbiByZXF1ZXN0cyByZXRpcmUgdXBvbiB3YWl0aW5n
ICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0g
aW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJYWN0aXZlID0gX19s
aXZlX2FjdGl2ZV9zZXR1cChpOTE1KTsKLQlpZiAoSVNfRVJSKGFjdGl2ZSkpIHsKLQkJZXJyID0g
UFRSX0VSUihhY3RpdmUpOwotCQlnb3RvIGVycjsKLQl9CisJaWYgKElTX0VSUihhY3RpdmUpKQor
CQlyZXR1cm4gUFRSX0VSUihhY3RpdmUpOwogCiAJaTkxNV9hY3RpdmVfd2FpdCgmYWN0aXZlLT5i
YXNlKTsKIAlpZiAoIWFjdGl2ZS0+cmV0aXJlZCkgewpAQCAtMTY4LDExICsxNjQsOSBAQCBzdGF0
aWMgaW50IGxpdmVfYWN0aXZlX3dhaXQodm9pZCAqYXJnKQogCiAJX19saXZlX3B1dChhY3RpdmUp
OwogCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwotCi1lcnI6Ci0J
aW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwpAQCAtMTgy
LDIzICsxNzYsMTkgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBsaXZlX2Fj
dGl2ZSAqYWN0aXZlOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAwOwog
CiAJLyogQ2hlY2sgdGhhdCB3ZSBnZXQgYSBjYWxsYmFjayB3aGVuIHJlcXVlc3RzIGFyZSBpbmRp
cmVjdGx5IHJldGlyZWQgKi8KIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0K
IAlhY3RpdmUgPSBfX2xpdmVfYWN0aXZlX3NldHVwKGk5MTUpOwotCWlmIChJU19FUlIoYWN0aXZl
KSkgewotCQllcnIgPSBQVFJfRVJSKGFjdGl2ZSk7Ci0JCWdvdG8gZXJyOwotCX0KKwlpZiAoSVNf
RVJSKGFjdGl2ZSkpCisJCXJldHVybiBQVFJfRVJSKGFjdGl2ZSk7CiAKIAkvKiB3YWl0cyBmb3Ig
JiByZXRpcmVzIGFsbCByZXF1ZXN0cyAqLworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKIAkJ
ZXJyID0gLUVJTzsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJ
aWYgKCFhY3RpdmUtPnJldGlyZWQpIHsKIAkJcHJfZXJyKCJpOTE1X2FjdGl2ZSBub3QgcmV0aXJl
ZCBhZnRlciBmbHVzaGluZyFcbiIpOwpAQCAtMjA3LDEwICsxOTcsNiBAQCBzdGF0aWMgaW50IGxp
dmVfYWN0aXZlX3JldGlyZSh2b2lkICphcmcpCiAKIAlfX2xpdmVfcHV0KGFjdGl2ZSk7CiAKLWVy
cjoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldHVybiBlcnI7CiB9
CiAKLS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

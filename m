Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 724443A7EF3
	for <lists+intel-gfx@lfdr.de>; Tue, 15 Jun 2021 15:15:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 94D1D6E323;
	Tue, 15 Jun 2021 13:15:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 58DCE6E3D8
 for <intel-gfx@lists.freedesktop.org>; Tue, 15 Jun 2021 13:15:22 +0000 (UTC)
IronPort-SDR: uwEawcFrS/HwxR1Gfkoz3XpoTzg6pdlV1ETfvrGUp22LzV7yM3lfvlpstXb9OFdPYDRtZU7fIy
 HtfSsYG7S+vg==
X-IronPort-AV: E=McAfee;i="6200,9189,10015"; a="205804401"
X-IronPort-AV: E=Sophos;i="5.83,275,1616482800"; d="scan'208";a="205804401"
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 15 Jun 2021 06:15:22 -0700
IronPort-SDR: hAUpvJxgabeShuuYQ4K/WpsUca/C2ejfMMrJGUagoBckHirr3X8x1U1NpGxqJvdOz1tPiUZKru
 MOg4m4Is1IEQ==
X-IronPort-AV: E=Sophos;i="5.83,275,1616482800"; d="scan'208";a="554443395"
Received: from vgribano-mobl.ccr.corp.intel.com (HELO thellst-mobl1.intel.com)
 ([10.249.254.53])
 by fmsmga001-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 15 Jun 2021 06:15:20 -0700
From: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 15 Jun 2021 15:14:49 +0200
Message-Id: <20210615131451.61023-11-thomas.hellstrom@linux.intel.com>
X-Mailer: git-send-email 2.31.1
In-Reply-To: <20210615131451.61023-1-thomas.hellstrom@linux.intel.com>
References: <20210615131451.61023-1-thomas.hellstrom@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 10/12] drm/i915/ttm: accelerated move
 implementation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com,
 =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogUmFtYWxpbmdhbSBDIDxyYW1hbGluZ2FtLmNAaW50ZWwuY29tPgoKSW52b2tlcyB0aGUg
cGlwZWxpbmVkIHBhZ2UgbWlncmF0aW9uIHRocm91Z2ggYmx0LCBmb3IKaTkxNV90dG1fbW92ZSBy
ZXF1ZXN0cyBvZiBldmljdGlvbiBhbmQgYWxzbyBvYmogY2xlYXIuCgpTaWduZWQtb2ZmLWJ5OiBS
YW1hbGluZ2FtIEMgPHJhbWFsaW5nYW0uY0BpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBUaG9tYXMg
SGVsbHN0csO2bSA8dGhvbWFzLmhlbGxzdHJvbUBsaW51eC5pbnRlbC5jb20+Ci0tLQp2MjoKIC0g
c3ViZnVuY3Rpb24gZm9yIGFjY2VsX21vdmUgKFRob21hcykKIC0gZW5naW5lX3BtX2dldC9wdXQg
YXJvdW5kIGNvbnRleHRfbW92ZS9jbGVhciAoVGhvbWFzKQogLSBJbnZhbGlkYXRpb24gYXQgYWNj
ZWxfY2xlYXIgKFRob21hcykKdjM6CiAtIGNvbmZsaWN0IHJlc29sdXRpb24gcy8mYm8tPm1lbS9i
by0+cmVzb3VyY2UvZwp2NDoKIC0gVGltZW91dCBpcyBzZXQgZm9yIE1BWF9TQ0hFRFVMRV9USU1F
T1VUIChUaG9tYXMpCiAtIHMvVFRNX1BMX1BSSVYvSTkxNV9QTF9MTUVNMCAoVGhvbWFzKQotLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90dG0uYyB8IDg4ICsrKysrKysrKysr
KysrKysrKysrKy0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA3NSBpbnNlcnRpb25zKCspLCAxMyBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
dHRtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdHRtLmMKaW5kZXggYmYz
MzcyNGJlZDVjLi42YjlkNDI2NTVhMDAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV90dG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fdHRtLmMKQEAgLTE1LDYgKzE1LDkgQEAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fdHRtLmgi
CiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX21tYW4uaCIKIAorI2luY2x1ZGUgImd0L2ludGVsX21p
Z3JhdGUuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKKwogI2RlZmluZSBJOTE1
X1BMX0xNRU0wIFRUTV9QTF9QUklWCiAjZGVmaW5lIEk5MTVfUExfU1lTVEVNIFRUTV9QTF9TWVNU
RU0KICNkZWZpbmUgSTkxNV9QTF9TVE9MRU4gVFRNX1BMX1ZSQU0KQEAgLTI4Miw2ICsyODUsNjIg
QEAgaTkxNV90dG1fcmVzb3VyY2VfZ2V0X3N0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmosCiAJcmV0dXJuIGludGVsX3JlZ2lvbl90dG1fbm9kZV90b19zdChvYmotPm1tLnJlZ2lvbiwg
cmVzKTsKIH0KIAorc3RhdGljIGludCBpOTE1X3R0bV9hY2NlbF9tb3ZlKHN0cnVjdCB0dG1fYnVm
ZmVyX29iamVjdCAqYm8sCisJCQkgICAgICAgc3RydWN0IHR0bV9yZXNvdXJjZSAqZHN0X21lbSwK
KwkJCSAgICAgICBzdHJ1Y3Qgc2dfdGFibGUgKmRzdF9zdCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGNvbnRhaW5lcl9vZihiby0+YmRldiwgdHlwZW9mKCppOTE1KSwKKwkJ
CQkJCSAgICAgYmRldik7CisJc3RydWN0IHR0bV9yZXNvdXJjZV9tYW5hZ2VyICpzcmNfbWFuID0K
KwkJdHRtX21hbmFnZXJfdHlwZShiby0+YmRldiwgYm8tPnJlc291cmNlLT5tZW1fdHlwZSk7CisJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGk5MTVfdHRtX3RvX2dlbShibyk7CisJ
c3RydWN0IHNnX3RhYmxlICpzcmNfc3Q7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50
IHJldDsKKworCWlmICghaTkxNS0+Z3QubWlncmF0ZS5jb250ZXh0KQorCQlyZXR1cm4gLUVJTlZB
TDsKKworCWlmICghYm8tPnR0bSB8fCAhdHRtX3R0X2lzX3BvcHVsYXRlZChiby0+dHRtKSkgewor
CQlpZiAoYm8tPnR5cGUgPT0gdHRtX2JvX3R5cGVfa2VybmVsKQorCQkJcmV0dXJuIC1FSU5WQUw7
CisKKwkJaWYgKGJvLT50dG0gJiYKKwkJICAgICEoYm8tPnR0bS0+cGFnZV9mbGFncyAmIFRUTV9Q
QUdFX0ZMQUdfWkVST19BTExPQykpCisJCQlyZXR1cm4gMDsKKworCQlpbnRlbF9lbmdpbmVfcG1f
Z2V0KGk5MTUtPmd0Lm1pZ3JhdGUuY29udGV4dC0+ZW5naW5lKTsKKwkJcmV0ID0gaW50ZWxfY29u
dGV4dF9taWdyYXRlX2NsZWFyKGk5MTUtPmd0Lm1pZ3JhdGUuY29udGV4dCwgTlVMTCwKKwkJCQkJ
CSAgZHN0X3N0LT5zZ2wsIEk5MTVfQ0FDSEVfTk9ORSwKKwkJCQkJCSAgZHN0X21lbS0+bWVtX3R5
cGUgPj0gSTkxNV9QTF9MTUVNMCwKKwkJCQkJCSAgMCwgJnJxKTsKKworCQlpZiAoIXJldCAmJiBy
cSkgeworCQkJaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsK
KwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQl9CisJCWludGVsX2VuZ2luZV9wbV9wdXQoaTkx
NS0+Z3QubWlncmF0ZS5jb250ZXh0LT5lbmdpbmUpOworCX0gZWxzZSB7CisJCXNyY19zdCA9IHNy
Y19tYW4tPnVzZV90dCA/IGk5MTVfdHRtX3R0X2dldF9zdChiby0+dHRtKSA6CisJCQkJCQlvYmot
PnR0bS5jYWNoZWRfaW9fc3Q7CisKKwkJaW50ZWxfZW5naW5lX3BtX2dldChpOTE1LT5ndC5taWdy
YXRlLmNvbnRleHQtPmVuZ2luZSk7CisJCXJldCA9IGludGVsX2NvbnRleHRfbWlncmF0ZV9jb3B5
KGk5MTUtPmd0Lm1pZ3JhdGUuY29udGV4dCwKKwkJCQkJCSBOVUxMLCBzcmNfc3QtPnNnbCwgSTkx
NV9DQUNIRV9OT05FLAorCQkJCQkJIGJvLT5yZXNvdXJjZS0+bWVtX3R5cGUgPj0gSTkxNV9QTF9M
TUVNMCwKKwkJCQkJCSBkc3Rfc3QtPnNnbCwgSTkxNV9DQUNIRV9OT05FLAorCQkJCQkJIGRzdF9t
ZW0tPm1lbV90eXBlID49IEk5MTVfUExfTE1FTTAsCisJCQkJCQkgJnJxKTsKKwkJaWYgKCFyZXQg
JiYgcnEpIHsKKwkJCWk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBNQVhfU0NIRURVTEVfVElNRU9V
VCk7CisJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJfQorCQlpbnRlbF9lbmdpbmVfcG1fcHV0
KGk5MTUtPmd0Lm1pZ3JhdGUuY29udGV4dC0+ZW5naW5lKTsKKwl9CisKKwlyZXR1cm4gcmV0Owor
fQorCiBzdGF0aWMgaW50IGk5MTVfdHRtX21vdmUoc3RydWN0IHR0bV9idWZmZXJfb2JqZWN0ICpi
bywgYm9vbCBldmljdCwKIAkJCSBzdHJ1Y3QgdHRtX29wZXJhdGlvbl9jdHggKmN0eCwKIAkJCSBz
dHJ1Y3QgdHRtX3Jlc291cmNlICpkc3RfbWVtLApAQCAtMzMyLDE5ICszOTEsMjIgQEAgc3RhdGlj
IGludCBpOTE1X3R0bV9tb3ZlKHN0cnVjdCB0dG1fYnVmZmVyX29iamVjdCAqYm8sIGJvb2wgZXZp
Y3QsCiAJaWYgKElTX0VSUihkc3Rfc3QpKQogCQlyZXR1cm4gUFRSX0VSUihkc3Rfc3QpOwogCi0J
LyogSWYgd2Ugc3RhcnQgbWFwcGluZyBHR1RULCB3ZSBjYW4gbm8gbG9uZ2VyIHVzZSBtYW46OnVz
ZV90dCBoZXJlLiAqLwotCWRzdF9pdGVyID0gZHN0X21hbi0+dXNlX3R0ID8KLQkJdHRtX2ttYXBf
aXRlcl90dF9pbml0KCZfZHN0X2l0ZXIudHQsIGJvLT50dG0pIDoKLQkJdHRtX2ttYXBfaXRlcl9p
b21hcF9pbml0KCZfZHN0X2l0ZXIuaW8sICZkc3RfcmVnLT5pb21hcCwKLQkJCQkJIGRzdF9zdCwg
ZHN0X3JlZy0+cmVnaW9uLnN0YXJ0KTsKLQotCXNyY19pdGVyID0gc3JjX21hbi0+dXNlX3R0ID8K
LQkJdHRtX2ttYXBfaXRlcl90dF9pbml0KCZfc3JjX2l0ZXIudHQsIGJvLT50dG0pIDoKLQkJdHRt
X2ttYXBfaXRlcl9pb21hcF9pbml0KCZfc3JjX2l0ZXIuaW8sICZzcmNfcmVnLT5pb21hcCwKLQkJ
CQkJIG9iai0+dHRtLmNhY2hlZF9pb19zdCwKLQkJCQkJIHNyY19yZWctPnJlZ2lvbi5zdGFydCk7
Ci0KLQl0dG1fbW92ZV9tZW1jcHkoYm8sIGRzdF9tZW0tPm51bV9wYWdlcywgZHN0X2l0ZXIsIHNy
Y19pdGVyKTsKKwlyZXQgPSBpOTE1X3R0bV9hY2NlbF9tb3ZlKGJvLCBkc3RfbWVtLCBkc3Rfc3Qp
OworCWlmIChyZXQpIHsKKwkJLyogSWYgd2Ugc3RhcnQgbWFwcGluZyBHR1RULCB3ZSBjYW4gbm8g
bG9uZ2VyIHVzZSBtYW46OnVzZV90dCBoZXJlLiAqLworCQlkc3RfaXRlciA9IGRzdF9tYW4tPnVz
ZV90dCA/CisJCQl0dG1fa21hcF9pdGVyX3R0X2luaXQoJl9kc3RfaXRlci50dCwgYm8tPnR0bSkg
OgorCQkJdHRtX2ttYXBfaXRlcl9pb21hcF9pbml0KCZfZHN0X2l0ZXIuaW8sICZkc3RfcmVnLT5p
b21hcCwKKwkJCQkJCSBkc3Rfc3QsIGRzdF9yZWctPnJlZ2lvbi5zdGFydCk7CisKKwkJc3JjX2l0
ZXIgPSBzcmNfbWFuLT51c2VfdHQgPworCQkJdHRtX2ttYXBfaXRlcl90dF9pbml0KCZfc3JjX2l0
ZXIudHQsIGJvLT50dG0pIDoKKwkJCXR0bV9rbWFwX2l0ZXJfaW9tYXBfaW5pdCgmX3NyY19pdGVy
LmlvLCAmc3JjX3JlZy0+aW9tYXAsCisJCQkJCQkgb2JqLT50dG0uY2FjaGVkX2lvX3N0LAorCQkJ
CQkJIHNyY19yZWctPnJlZ2lvbi5zdGFydCk7CisKKwkJdHRtX21vdmVfbWVtY3B5KGJvLCBkc3Rf
bWVtLT5udW1fcGFnZXMsIGRzdF9pdGVyLCBzcmNfaXRlcik7CisJfQogCXR0bV9ib19tb3ZlX3N5
bmNfY2xlYW51cChibywgZHN0X21lbSk7CiAJaTkxNV90dG1fZnJlZV9jYWNoZWRfaW9fc3Qob2Jq
KTsKIAotLSAKMi4zMS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZngK

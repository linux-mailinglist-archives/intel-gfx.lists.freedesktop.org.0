Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1E4F3CA037
	for <lists+intel-gfx@lfdr.de>; Thu,  3 Oct 2019 16:20:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7354D6E126;
	Thu,  3 Oct 2019 14:20:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0D0C56E126
 for <intel-gfx@lists.freedesktop.org>; Thu,  3 Oct 2019 14:20:39 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18709102-1500050 
 for multiple; Thu, 03 Oct 2019 15:20:28 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  3 Oct 2019 15:20:26 +0100
Message-Id: <20191003142026.10971-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191003093639.10186-17-chris@chris-wilson.co.uk>
References: <20191003093639.10186-17-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Move context management under GEM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0cmFjayBvZiB0aGUgR0VNIGNvbnRleHRzIHVuZGVybmVhdGggaTkxNS0+Z2VtLmNvbnRl
eHRzIGFuZCBhc3NpZ24KdGhlbSB0aGVpciBvd24gbG9jayBmb3IgdGhlIHB1cnBvc2VzIG9mIGxp
c3QgbWFuYWdlbWVudC4KCnYyOiBGb2N1cyBvbiBsb2NrIHRyYWNraW5nOyBjdHgtPnZtIGlzIHBy
b3RlY3RlZCBieSBjdHgtPm11dGV4CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBp
bnRlbC5jb20+Ci0tLQpBbm90aGVyIG1pc3NlZCBfX2Fzc2lnbl9wcGd0dCBpbnNpZGUgdGhlIG1v
Y2suCi0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwg
MTgzICsrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHQuaCAgIHwgIDI3ICsrLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dF90eXBlcy5oIHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVj
YnVmZmVyLmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91
c2VycHRyLmMgICB8ICAgMyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2Vf
cGFnZXMuYyAgIHwgIDM2ICsrLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X2NvbnRleHQuYyB8IDE2OCArKysrKysrKy0tLS0tLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvbW9ja19jb250ZXh0LmMgfCAgIDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2NvbnRleHQuYyAgICAgICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMgICAgICAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAyNCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAzOSArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9scmMuYyAgICAgICAgfCAgIDYgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3Rfd29ya2Fyb3VuZHMuYyAgICB8ICAyMiArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9z
Y2hlZHVsZXIuYyAgICAgICAgICB8ICAyNCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZGVidWdmcy5jICAgICAgICAgICB8ICA1MCArKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuYyAgICAgICAgICAgICAgIHwgICAyIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmggICAgICAgICAgICAgICB8ICAyNyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtLmMgICAgICAgICAgICAgICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmMgICAgICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmYuYyAgICAgICAgICAgICAgfCAgMjQgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5
c2ZzLmMgICAgICAgICAgICAgfCAgNzcgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdHJhY2UuaCAgICAgICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfZ2VtLmMgICAgIHwgICA4IC0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfZ2VtX2V2aWN0LmMgICB8ICAgMyAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fZ3R0LmMgfCAgMTUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X3JlcXVlc3QuYyB8ICAxMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfdm1hLmMgICAgIHwgICA3ICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2Nr
X2dlbV9kZXZpY2UuYyAgfCAgIDYgKy0KIDI5IGZpbGVzIGNoYW5nZWQsIDQxNSBpbnNlcnRpb25z
KCspLCAzOTAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMKaW5kZXggYWU1ODg1NDRiZjNhLi5kYWRiODIwYjA1MDIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtMjE4LDkgKzIxOCwxMiBA
QCBzdGF0aWMgc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXMgKmRlZmF1bHRfZW5naW5lcyhzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4KQogCiBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2Zy
ZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZjdHgtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCUdFTV9CVUdfT04oIWk5MTVfZ2VtX2Nv
bnRleHRfaXNfY2xvc2VkKGN0eCkpOwogCisJc3Bpbl9sb2NrKCZjdHgtPmk5MTUtPmdlbS5jb250
ZXh0cy5sb2NrKTsKKwlsaXN0X2RlbCgmY3R4LT5saW5rKTsKKwlzcGluX3VubG9jaygmY3R4LT5p
OTE1LT5nZW0uY29udGV4dHMubG9jayk7CisKIAlmcmVlX2VuZ2luZXMocmN1X2FjY2Vzc19wb2lu
dGVyKGN0eC0+ZW5naW5lcykpOwogCW11dGV4X2Rlc3Ryb3koJmN0eC0+ZW5naW5lc19tdXRleCk7
CiAKQEAgLTIzMCw2NyArMjMzLDU0IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfZnJl
ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCWtmcmVlKGN0eC0+bmFtZSk7CiAJcHV0
X3BpZChjdHgtPnBpZCk7CiAKLQlsaXN0X2RlbCgmY3R4LT5saW5rKTsKIAltdXRleF9kZXN0cm95
KCZjdHgtPm11dGV4KTsKIAogCWtmcmVlX3JjdShjdHgsIHJjdSk7CiB9CiAKLXN0YXRpYyB2b2lk
IGNvbnRleHRzX2ZyZWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9p
ZCBjb250ZXh0c19mcmVlX2FsbChzdHJ1Y3QgbGxpc3Rfbm9kZSAqbGlzdCkKIHsKLQlzdHJ1Y3Qg
bGxpc3Rfbm9kZSAqZnJlZWQgPSBsbGlzdF9kZWxfYWxsKCZpOTE1LT5jb250ZXh0cy5mcmVlX2xp
c3QpOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsICpjbjsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JbGxpc3RfZm9yX2VhY2hfZW50
cnlfc2FmZShjdHgsIGNuLCBmcmVlZCwgZnJlZV9saW5rKQorCWxsaXN0X2Zvcl9lYWNoX2VudHJ5
X3NhZmUoY3R4LCBjbiwgbGlzdCwgZnJlZV9saW5rKQogCQlpOTE1X2dlbV9jb250ZXh0X2ZyZWUo
Y3R4KTsKIH0KIAotc3RhdGljIHZvaWQgY29udGV4dHNfZnJlZV9maXJzdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyB2b2lkIGNvbnRleHRzX2ZsdXNoX2ZyZWUoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHRzICpnYykKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
OwotCXN0cnVjdCBsbGlzdF9ub2RlICpmcmVlZDsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JZnJlZWQgPSBsbGlzdF9kZWxfZmlyc3QoJmk5MTUt
PmNvbnRleHRzLmZyZWVfbGlzdCk7Ci0JaWYgKCFmcmVlZCkKLQkJcmV0dXJuOwotCi0JY3R4ID0g
Y29udGFpbmVyX29mKGZyZWVkLCB0eXBlb2YoKmN0eCksIGZyZWVfbGluayk7Ci0JaTkxNV9nZW1f
Y29udGV4dF9mcmVlKGN0eCk7CisJY29udGV4dHNfZnJlZV9hbGwobGxpc3RfZGVsX2FsbCgmZ2Mt
PmZyZWVfbGlzdCkpOwogfQogCiBzdGF0aWMgdm9pZCBjb250ZXh0c19mcmVlX3dvcmtlcihzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PQotCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwgY29udGV4dHMuZnJlZV93b3Jr
KTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjID0KKwkJY29udGFpbmVyX29mKHdvcmss
IHR5cGVvZigqZ2MpLCBmcmVlX3dvcmspOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0JY29udGV4dHNfZnJlZShpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCWNvbnRleHRzX2ZsdXNoX2ZyZWUoZ2MpOwogfQogCiB2b2lkIGk5
MTVfZ2VtX2NvbnRleHRfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqcmVmKQogewogCXN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHggPSBjb250YWluZXJfb2YocmVmLCB0eXBlb2YoKmN0eCksIHJlZik7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CisJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHRzICpnYyA9ICZjdHgtPmk5MTUtPmdlbS5jb250ZXh0czsKIAogCXRyYWNl
X2k5MTVfY29udGV4dF9mcmVlKGN0eCk7Ci0JaWYgKGxsaXN0X2FkZCgmY3R4LT5mcmVlX2xpbmss
ICZpOTE1LT5jb250ZXh0cy5mcmVlX2xpc3QpKQotCQlxdWV1ZV93b3JrKGk5MTUtPndxLCAmaTkx
NS0+Y29udGV4dHMuZnJlZV93b3JrKTsKKwlpZiAobGxpc3RfYWRkKCZjdHgtPmZyZWVfbGluaywg
JmdjLT5mcmVlX2xpc3QpKQorCQlxdWV1ZV93b3JrKGN0eC0+aTkxNS0+d3EsICZnYy0+ZnJlZV93
b3JrKTsKIH0KIAogc3RhdGljIHZvaWQgY29udGV4dF9jbG9zZShzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4KQogewotCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Nsb3NlZChjdHgpOworCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCi0JaWYgKGN0eC0+dm0pCi0JCWk5MTVfdm1fY2xv
c2UoY3R4LT52bSk7CisJaTkxNV9nZW1fY29udGV4dF9zZXRfY2xvc2VkKGN0eCk7CiAKIAltdXRl
eF9sb2NrKCZjdHgtPm11dGV4KTsKIAorCXZtID0gaTkxNV9nZW1fY29udGV4dF92bShjdHgpOwor
CWlmICh2bSkKKwkJaTkxNV92bV9jbG9zZSh2bSk7CisKIAljdHgtPmZpbGVfcHJpdiA9IEVSUl9Q
VFIoLUVCQURGKTsKIAogCS8qCkBAIC0zMTcsNyArMzA3LDYgQEAgX19jcmVhdGVfY29udGV4dChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7
CiAKIAlrcmVmX2luaXQoJmN0eC0+cmVmKTsKLQlsaXN0X2FkZF90YWlsKCZjdHgtPmxpbmssICZp
OTE1LT5jb250ZXh0cy5saXN0KTsKIAljdHgtPmk5MTUgPSBpOTE1OwogCWN0eC0+c2NoZWQucHJp
b3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9OT1JNQUwpOwogCW11dGV4
X2luaXQoJmN0eC0+bXV0ZXgpOwpAQCAtMzQzLDYgKzMzMiwxMCBAQCBfX2NyZWF0ZV9jb250ZXh0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKGN0eC0+aGFuZ190aW1lc3RhbXApOyBpKyspCiAJCWN0eC0+aGFuZ190aW1lc3RhbXBbaV0g
PSBqaWZmaWVzIC0gQ09OVEVYVF9GQVNUX0hBTkdfSklGRklFUzsKIAorCXNwaW5fbG9jaygmaTkx
NS0+Z2VtLmNvbnRleHRzLmxvY2spOworCWxpc3RfYWRkX3RhaWwoJmN0eC0+bGluaywgJmk5MTUt
PmdlbS5jb250ZXh0cy5saXN0KTsKKwlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxv
Y2spOworCiAJcmV0dXJuIGN0eDsKIAogZXJyX2ZyZWU6CkBAIC0zNzIsMTEgKzM2NSwxMSBAQCBz
dGF0aWMgdm9pZCBfX2FwcGx5X3BwZ3R0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdm9pZCAq
dm0pCiBzdGF0aWMgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqCiBfX3NldF9wcGd0dChzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkK
IHsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICpvbGQgPSBjdHgtPnZtOworCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKm9sZCA9IGk5MTVfZ2VtX2NvbnRleHRfdm0oY3R4KTsKIAogCUdF
TV9CVUdfT04ob2xkICYmIGk5MTVfdm1faXNfNGx2bCh2bSkgIT0gaTkxNV92bV9pc180bHZsKG9s
ZCkpOwogCi0JY3R4LT52bSA9IGk5MTVfdm1fb3Blbih2bSk7CisJcmN1X2Fzc2lnbl9wb2ludGVy
KGN0eC0+dm0sIGk5MTVfdm1fb3Blbih2bSkpOwogCWNvbnRleHRfYXBwbHlfYWxsKGN0eCwgX19h
cHBseV9wcGd0dCwgdm0pOwogCiAJcmV0dXJuIG9sZDsKQEAgLTM4NSw3ICszNzgsNyBAQCBfX3Nl
dF9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSkKIHN0YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsCiAJCQkgICBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHsKLQlp
ZiAodm0gPT0gY3R4LT52bSkKKwlpZiAodm0gPT0gcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0p
KQogCQlyZXR1cm47CiAKIAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwpAQCAtNDE3LDI3ICs0
MTAsMjUgQEAgc3RhdGljIHZvaWQgX19hc3NpZ25fdGltZWxpbmUoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwKIH0KIAogc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoKLWk5MTVf
Z2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdW5z
aWduZWQgaW50IGZsYWdzKQoraTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIHVuc2lnbmVkIGludCBmbGFncykKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCiAJaWYgKGZsYWdzICYgSTkxNV9DT05URVhUX0NSRUFURV9GTEFHU19TSU5H
TEVfVElNRUxJTkUgJiYKLQkgICAgIUhBU19FWEVDTElTVFMoZGV2X3ByaXYpKQorCSAgICAhSEFT
X0VYRUNMSVNUUyhpOTE1KSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CiAKLQkvKiBSZWFw
IHRoZSBtb3N0IHN0YWxlIGNvbnRleHQgKi8KLQljb250ZXh0c19mcmVlX2ZpcnN0KGRldl9wcml2
KTsKKwkvKiBSZWFwIHRoZSBzdGFsZSBjb250ZXh0cyAqLworCWNvbnRleHRzX2ZsdXNoX2ZyZWUo
Jmk5MTUtPmdlbS5jb250ZXh0cyk7CiAKLQljdHggPSBfX2NyZWF0ZV9jb250ZXh0KGRldl9wcml2
KTsKKwljdHggPSBfX2NyZWF0ZV9jb250ZXh0KGk5MTUpOwogCWlmIChJU19FUlIoY3R4KSkKIAkJ
cmV0dXJuIGN0eDsKIAotCWlmIChIQVNfRlVMTF9QUEdUVChkZXZfcHJpdikpIHsKKwlpZiAoSEFT
X0ZVTExfUFBHVFQoaTkxNSkpIHsKIAkJc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0OwogCi0JCXBw
Z3R0ID0gaTkxNV9wcGd0dF9jcmVhdGUoZGV2X3ByaXYpOworCQlwcGd0dCA9IGk5MTVfcHBndHRf
Y3JlYXRlKGk5MTUpOwogCQlpZiAoSVNfRVJSKHBwZ3R0KSkgewogCQkJRFJNX0RFQlVHX0RSSVZF
UigiUFBHVFQgc2V0dXAgZmFpbGVkICglbGQpXG4iLAogCQkJCQkgUFRSX0VSUihwcGd0dCkpOwpA
QCAtNDQ1LDE0ICs0MzYsMTcgQEAgaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAJCQlyZXR1cm4gRVJS
X0NBU1QocHBndHQpOwogCQl9CiAKKwkJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAJCV9fYXNz
aWduX3BwZ3R0KGN0eCwgJnBwZ3R0LT52bSk7CisJCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7
CisKIAkJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7CiAJfQogCiAJaWYgKGZsYWdzICYgSTkxNV9D
T05URVhUX0NSRUFURV9GTEFHU19TSU5HTEVfVElNRUxJTkUpIHsKIAkJc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0aW1lbGluZTsKIAotCQl0aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2NyZWF0ZSgm
ZGV2X3ByaXYtPmd0LCBOVUxMKTsKKwkJdGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9jcmVhdGUo
Jmk5MTUtPmd0LCBOVUxMKTsKIAkJaWYgKElTX0VSUih0aW1lbGluZSkpIHsKIAkJCWNvbnRleHRf
Y2xvc2UoY3R4KTsKIAkJCXJldHVybiBFUlJfQ0FTVCh0aW1lbGluZSk7CkBAIC00OTcsNDggKzQ5
MSw0MCBAQCBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIGludCBwcmlvKQogCXJldHVybiBjdHg7CiB9CiAKLXN0YXRpYyB2b2lkIGlu
aXRfY29udGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9pZCBp
bml0X2NvbnRleHRzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiB7Ci0JbXV0ZXhfaW5p
dCgmaTkxNS0+Y29udGV4dHMubXV0ZXgpOwotCUlOSVRfTElTVF9IRUFEKCZpOTE1LT5jb250ZXh0
cy5saXN0KTsKLQotCS8qIFVzaW5nIHRoZSBzaW1wbGUgaWRhIGludGVyZmFjZSwgdGhlIG1heCBp
cyBsaW1pdGVkIGJ5IHNpemVvZihpbnQpICovCi0JQlVJTERfQlVHX09OKE1BWF9DT05URVhUX0hX
X0lEID4gSU5UX01BWCk7Ci0JQlVJTERfQlVHX09OKEdFTjExX01BWF9DT05URVhUX0hXX0lEID4g
SU5UX01BWCk7Ci0JaWRhX2luaXQoJmk5MTUtPmNvbnRleHRzLmh3X2lkYSk7Ci0JSU5JVF9MSVNU
X0hFQUQoJmk5MTUtPmNvbnRleHRzLmh3X2lkX2xpc3QpOworCXNwaW5fbG9ja19pbml0KCZnYy0+
bG9jayk7CisJSU5JVF9MSVNUX0hFQUQoJmdjLT5saXN0KTsKIAotCUlOSVRfV09SSygmaTkxNS0+
Y29udGV4dHMuZnJlZV93b3JrLCBjb250ZXh0c19mcmVlX3dvcmtlcik7Ci0JaW5pdF9sbGlzdF9o
ZWFkKCZpOTE1LT5jb250ZXh0cy5mcmVlX2xpc3QpOworCUlOSVRfV09SSygmZ2MtPmZyZWVfd29y
aywgY29udGV4dHNfZnJlZV93b3JrZXIpOworCWluaXRfbGxpc3RfaGVhZCgmZ2MtPmZyZWVfbGlz
dCk7CiB9CiAKLWludCBpOTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK2ludCBpOTE1X2dlbV9pbml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAKIAkv
KiBSZWFzc3VyZSBvdXJzZWx2ZXMgd2UgYXJlIG9ubHkgY2FsbGVkIG9uY2UgKi8KLQlHRU1fQlVH
X09OKGRldl9wcml2LT5rZXJuZWxfY29udGV4dCk7CisJR0VNX0JVR19PTihpOTE1LT5rZXJuZWxf
Y29udGV4dCk7CiAKLQlpbml0X2NvbnRleHRzKGRldl9wcml2KTsKKwlpbml0X2NvbnRleHRzKCZp
OTE1LT5nZW0uY29udGV4dHMpOwogCiAJLyogbG93ZXN0IHByaW9yaXR5OyBpZGxlIHRhc2sgKi8K
LQljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoZGV2X3ByaXYsIEk5MTVfUFJJ
T1JJVFlfTUlOKTsKKwljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoaTkxNSwg
STkxNV9QUklPUklUWV9NSU4pOwogCWlmIChJU19FUlIoY3R4KSkgewogCQlEUk1fRVJST1IoIkZh
aWxlZCB0byBjcmVhdGUgZGVmYXVsdCBnbG9iYWwgY29udGV4dFxuIik7CiAJCXJldHVybiBQVFJf
RVJSKGN0eCk7CiAJfQotCWRldl9wcml2LT5rZXJuZWxfY29udGV4dCA9IGN0eDsKKwlpOTE1LT5r
ZXJuZWxfY29udGV4dCA9IGN0eDsKIAogCURSTV9ERUJVR19EUklWRVIoIiVzIGNvbnRleHQgc3Vw
cG9ydCBpbml0aWFsaXplZFxuIiwKLQkJCSBEUklWRVJfQ0FQUyhkZXZfcHJpdiktPmhhc19sb2dp
Y2FsX2NvbnRleHRzID8KKwkJCSBEUklWRVJfQ0FQUyhpOTE1KS0+aGFzX2xvZ2ljYWxfY29udGV4
dHMgPwogCQkJICJsb2dpY2FsIiA6ICJmYWtlIik7CiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaTkx
NV9nZW1fY29udGV4dHNfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQg
aTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJZGVzdHJveV9rZXJuZWxfY29udGV4dCgmaTkxNS0+a2VybmVsX2NvbnRleHQpOwogfQog
CkBAIC01NTcsMTEgKzU0MywxNiBAQCBzdGF0aWMgaW50IHZtX2lkcl9jbGVhbnVwKGludCBpZCwg
dm9pZCAqcCwgdm9pZCAqZGF0YSkKIHN0YXRpYyBpbnQgZ2VtX2NvbnRleHRfcmVnaXN0ZXIoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCQlzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2
YXRlICpmcHJpdikKIHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlpbnQgcmV0
OwogCiAJY3R4LT5maWxlX3ByaXYgPSBmcHJpdjsKLQlpZiAoY3R4LT52bSkKLQkJY3R4LT52bS0+
ZmlsZSA9IGZwcml2OworCisJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CisJdm0gPSBpOTE1X2dl
bV9jb250ZXh0X3ZtKGN0eCk7CisJaWYgKHZtKQorCQlXUklURV9PTkNFKHZtLT5maWxlLCBmcHJp
dik7IC8qIFhYWCAqLworCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CiAKIAljdHgtPnBpZCA9
IGdldF90YXNrX3BpZChjdXJyZW50LCBQSURUWVBFX1BJRCk7CiAJY3R4LT5uYW1lID0ga2FzcHJp
bnRmKEdGUF9LRVJORUwsICIlc1slZF0iLApAQCAtNTk4LDkgKzU4OSw3IEBAIGludCBpOTE1X2dl
bV9jb250ZXh0X29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWRyX2luaXQo
JmZpbGVfcHJpdi0+Y29udGV4dF9pZHIpOwogCWlkcl9pbml0X2Jhc2UoJmZpbGVfcHJpdi0+dm1f
aWRyLCAxKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9
IGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KGk5MTUsIDApOwotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIo
Y3R4KTsKIAkJZ290byBlcnI7CkBAIC02MjgsNiArNjE3LDcgQEAgaW50IGk5MTVfZ2VtX2NvbnRl
eHRfb3BlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIHZvaWQgaTkxNV9nZW1fY29u
dGV4dF9jbG9zZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2Zp
bGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBmaWxlX3ByaXYtPmRldl9wcml2OwogCiAJaWRyX2Zvcl9lYWNo
KCZmaWxlX3ByaXYtPmNvbnRleHRfaWRyLCBjb250ZXh0X2lkcl9jbGVhbnVwLCBOVUxMKTsKIAlp
ZHJfZGVzdHJveSgmZmlsZV9wcml2LT5jb250ZXh0X2lkcik7CkBAIC02MzYsNiArNjI2LDggQEAg
dm9pZCBpOTE1X2dlbV9jb250ZXh0X2Nsb3NlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIAlpZHJf
Zm9yX2VhY2goJmZpbGVfcHJpdi0+dm1faWRyLCB2bV9pZHJfY2xlYW51cCwgTlVMTCk7CiAJaWRy
X2Rlc3Ryb3koJmZpbGVfcHJpdi0+dm1faWRyKTsKIAltdXRleF9kZXN0cm95KCZmaWxlX3ByaXYt
PnZtX2lkcl9sb2NrKTsKKworCWNvbnRleHRzX2ZsdXNoX2ZyZWUoJmk5MTUtPmdlbS5jb250ZXh0
cyk7CiB9CiAKIGludCBpOTE1X2dlbV92bV9jcmVhdGVfaW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdm9pZCAqZGF0YSwKQEAgLTgxNCwxNiArODA2LDEyIEBAIHN0YXRpYyBpbnQgZ2V0X3Bw
Z3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bTsKIAlpbnQgcmV0OwogCi0JaWYgKCFjdHgtPnZtKQorCWlmICgh
cmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCS8qIFhY
WCByY3UgYWNxdWlyZT8gKi8KLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmN0eC0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQorCXJj
dV9yZWFkX2xvY2soKTsKIAl2bSA9IGk5MTVfdm1fZ2V0KGN0eC0+dm0pOwotCW11dGV4X3VubG9j
aygmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlyY3VfcmVhZF91bmxvY2soKTsKIAog
CXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZmlsZV9wcml2LT52bV9pZHJfbG9jayk7
CiAJaWYgKHJldCkKQEAgLTkzMiw3ICs5MjAsNyBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChzdHJ1
Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJaWYgKGFyZ3MtPnNpemUpCiAJ
CXJldHVybiAtRUlOVkFMOwogCi0JaWYgKCFjdHgtPnZtKQorCWlmICghcmN1X2FjY2Vzc19wb2lu
dGVyKGN0eC0+dm0pKQogCQlyZXR1cm4gLUVOT0RFVjsKIAogCWlmICh1cHBlcl8zMl9iaXRzKGFy
Z3MtPnZhbHVlKSkKQEAgLTk0NiwxNyArOTM0LDIwIEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0
cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAlpZiAoIXZtKQogCQlyZXR1
cm4gLUVOT0VOVDsKIAotCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmY3R4LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmN0
eC0+bXV0ZXgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCi0JaWYgKHZtID09IGN0eC0+dm0p
CisJaWYgKGk5MTVfZ2VtX2NvbnRleHRfaXNfY2xvc2VkKGN0eCkpIHsKKwkJZXJyID0gLUVOT0VO
VDsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHZtID09IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgt
PnZtKSkKIAkJZ290byB1bmxvY2s7CiAKIAkvKiBUZWFyZG93biB0aGUgZXhpc3Rpbmcgb2JqOnZt
YSBjYWNoZSwgaXQgd2lsbCBoYXZlIHRvIGJlIHJlYnVpbHQuICovCi0JbXV0ZXhfbG9jaygmY3R4
LT5tdXRleCk7CiAJbHV0X2Nsb3NlKGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsK
IAogCW9sZCA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwogCkBAIC05NzYsOCArOTY3LDcgQEAgc3Rh
dGljIGludCBzZXRfcHBndHQoc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2
LAogCX0KIAogdW5sb2NrOgotCW11dGV4X3VubG9jaygmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQorCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CiBvdXQ6CiAJaTkxNV92bV9wdXQo
dm0pOwogCXJldHVybiBlcnI7CkBAIC0xODMzLDEwICsxODIzLDExIEBAIHN0YXRpYyBpbnQgY2xv
bmVfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwKIAkJICAgIHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpzcmMpCiB7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisJaW50
IGVyciA9IDA7CiAKIAlyY3VfcmVhZF9sb2NrKCk7CiAJZG8gewotCQl2bSA9IFJFQURfT05DRShz
cmMtPnZtKTsKKwkJdm0gPSByY3VfZGVyZWZlcmVuY2Uoc3JjLT52bSk7CiAJCWlmICghdm0pCiAJ
CQlicmVhazsKIApAQCAtMTg1OCw3ICsxODQ5LDcgQEAgc3RhdGljIGludCBjbG9uZV92bShzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCQkgKiBpdCBjYW5ub3QgYmUgcmVhbGxvY2F0ZWQg
ZWxzZXdoZXJlLgogCQkgKi8KIAotCQlpZiAodm0gPT0gUkVBRF9PTkNFKHNyYy0+dm0pKQorCQlp
ZiAodm0gPT0gcmN1X2FjY2Vzc19wb2ludGVyKHNyYy0+dm0pKQogCQkJYnJlYWs7CiAKIAkJaTkx
NV92bV9wdXQodm0pOwpAQCAtMTg2NiwxMSArMTg1NywxNiBAQCBzdGF0aWMgaW50IGNsb25lX3Zt
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpkc3QsCiAJcmN1X3JlYWRfdW5sb2NrKCk7CiAKIAlp
ZiAodm0pIHsKLQkJX19hc3NpZ25fcHBndHQoZHN0LCB2bSk7CisJCWlmICghbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZkc3QtPm11dGV4KSkgeworCQkJX19hc3NpZ25fcHBndHQoZHN0LCB2bSk7
CisJCQltdXRleF91bmxvY2soJmRzdC0+bXV0ZXgpOworCQl9IGVsc2UgeworCQkJZXJyID0gLUVJ
TlRSOworCQl9CiAJCWk5MTVfdm1fcHV0KHZtKTsKIAl9CiAKLQlyZXR1cm4gMDsKKwlyZXR1cm4g
ZXJyOwogfQogCiBzdGF0aWMgaW50IGNyZWF0ZV9jbG9uZShzdHJ1Y3QgaTkxNV91c2VyX2V4dGVu
c2lvbiBfX3VzZXIgKmV4dCwgdm9pZCAqZGF0YSkKQEAgLTE5NjAsMTIgKzE5NTYsNyBAQCBpbnQg
aTkxNV9nZW1fY29udGV4dF9jcmVhdGVfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJcmV0dXJuIC1FSU87CiAJfQogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJZXh0X2RhdGEu
Y3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkxNSwgYXJncy0+ZmxhZ3MpOwotCW11dGV4
X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoZXh0X2RhdGEuY3R4KSkK
IAkJcmV0dXJuIFBUUl9FUlIoZXh0X2RhdGEuY3R4KTsKIApAQCAtMjA5MiwxMCArMjA4MywxMiBA
QCBpbnQgaTkxNV9nZW1fY29udGV4dF9nZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LCB2b2lkICpkYXRhLAogCiAJY2FzZSBJOTE1X0NPTlRFWFRfUEFSQU1fR1RUX1NJWkU6CiAJ
CWFyZ3MtPnNpemUgPSAwOwotCQlpZiAoY3R4LT52bSkKLQkJCWFyZ3MtPnZhbHVlID0gY3R4LT52
bS0+dG90YWw7CisJCXJjdV9yZWFkX2xvY2soKTsKKwkJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihj
dHgtPnZtKSkKKwkJCWFyZ3MtPnZhbHVlID0gcmN1X2RlcmVmZXJlbmNlKGN0eC0+dm0pLT50b3Rh
bDsKIAkJZWxzZQogCQkJYXJncy0+dmFsdWUgPSB0b19pOTE1KGRldiktPmdndHQudm0udG90YWw7
CisJCXJjdV9yZWFkX3VubG9jaygpOwogCQlicmVhazsKIAogCWNhc2UgSTkxNV9DT05URVhUX1BB
UkFNX05PX0VSUk9SX0NBUFRVUkU6CkBAIC0yMTYxLDcgKzIxNTQsNyBAQCBpbnQgaTkxNV9nZW1f
Y29udGV4dF9zZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogaW50IGk5MTVfZ2VtX2NvbnRleHRfcmVzZXRfc3RhdHNfaW9jdGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwKIAkJCQkgICAgICAgdm9pZCAqZGF0YSwgc3RydWN0IGRybV9maWxlICpmaWxlKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcmVzZXRfc3RhdHMgKmFyZ3MgPSBkYXRhOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHg7CiAJaW50IHJldDsKQEAgLTIxODMsNyArMjE3Niw3IEBAIGludCBpOTE1X2dlbV9jb250
ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJICovCiAKIAlp
ZiAoY2FwYWJsZShDQVBfU1lTX0FETUlOKSkKLQkJYXJncy0+cmVzZXRfY291bnQgPSBpOTE1X3Jl
c2V0X2NvdW50KCZkZXZfcHJpdi0+Z3B1X2Vycm9yKTsKKwkJYXJncy0+cmVzZXRfY291bnQgPSBp
OTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpOwogCWVsc2UKIAkJYXJncy0+cmVzZXRf
Y291bnQgPSAwOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
aAppbmRleCA1MGJjMjdkMzBjMDMuLjkyMzQ1ODY4MzBkMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCkBAIC0xMSw3ICsxMSw5IEBACiAKICNpbmNsdWRl
ICJndC9pbnRlbF9jb250ZXh0LmgiCiAKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUg
Imk5MTVfZ2VtLmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0LmgiCiAjaW5jbHVkZSAiaTkxNV9z
Y2hlZHVsZXIuaCIKICNpbmNsdWRlICJpbnRlbF9kZXZpY2VfaW5mby5oIgogCkBAIC0xMTgsOCAr
MTIwLDggQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB9CiAKIC8qIGk5MTVfZ2VtX2NvbnRleHQuYyAq
LwotaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2Zpbmkoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2ludCBfX211c3RfY2hlY2sgaTkxNV9nZW1f
aW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGk5MTVf
Z2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSk7CiAKIGludCBpOTE1X2dlbV9jb250ZXh0X29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CkBAIC0xNTgsNiArMTYwLDI3IEBA
IHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3B1dChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4KQogCWtyZWZfcHV0KCZjdHgtPnJlZiwgaTkxNV9nZW1fY29udGV4dF9yZWxl
YXNlKTsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICoKK2k5
MTVfZ2VtX2NvbnRleHRfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKK3sKKwlyZXR1
cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCBsb2NrZGVwX2lzX2hlbGQoJmN0
eC0+bXV0ZXgpKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICoKK2k5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4KQoreworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCisJcmN1X3JlYWRfbG9j
aygpOworCXZtID0gcmN1X2RlcmVmZXJlbmNlKGN0eC0+dm0pOworCWlmICghdm0pCisJCXZtID0g
JmN0eC0+aTkxNS0+Z2d0dC52bTsKKwl2bSA9IGk5MTVfdm1fZ2V0KHZtKTsKKwlyY3VfcmVhZF91
bmxvY2soKTsKKworCXJldHVybiB2bTsKK30KKwogc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9n
ZW1fZW5naW5lcyAqCiBpOTE1X2dlbV9jb250ZXh0X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jb250ZXh0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
Y29udGV4dF90eXBlcy5oCmluZGV4IDg3YmUyNzg3N2UyMi4uYWI4ZTEzNjdkZmM4IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKQEAg
LTg4LDcgKzg4LDcgQEAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgewogCSAqIEluIG90aGVyIG1v
ZGVzLCB0aGlzIGlzIGEgTlVMTCBwb2ludGVyIHdpdGggdGhlIGV4cGVjdGF0aW9uIHRoYXQKIAkg
KiB0aGUgY2FsbGVyIHVzZXMgdGhlIHNoYXJlZCBnbG9iYWwgR1RULgogCSAqLwotCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgX19yY3Ug
KnZtOwogCiAJLyoqCiAJICogQHBpZDogcHJvY2VzcyBpZCBvZiBjcmVhdG9yCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCA4OGE4ODFiZTEy
ZWMuLjk4ODE2YzM1ZmZjMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZXhlY2J1ZmZlci5jCkBAIC03MjgsNyArNzI4LDcgQEAgc3RhdGljIGludCBlYl9zZWxlY3Rf
Y29udGV4dChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIAkJcmV0dXJuIC1FTk9FTlQ7CiAK
IAllYi0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JaWYgKGN0eC0+dm0pCisJaWYgKHJjdV9hY2Nlc3Nf
cG9pbnRlcihjdHgtPnZtKSkKIAkJZWItPmludmFsaWRfZmxhZ3MgfD0gRVhFQ19PQkpFQ1RfTkVF
RFNfR1RUOwogCiAJZWItPmNvbnRleHRfZmxhZ3MgPSAwOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXggMTczOGExNWViOTExLi40Zjk3MDQ3NDAxM2Yg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtNzU4
LDcgKzc1OCw4IEBAIGk5MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKIAkJICogT24gYWxtb3N0IGFsbCBvZiB0aGUgb2xkZXIgaHcsIHdlIGNhbm5vdCB0ZWxsIHRo
ZSBHUFUgdGhhdAogCQkgKiBhIHBhZ2UgaXMgcmVhZG9ubHkuCiAJCSAqLwotCQl2bSA9IGRldl9w
cml2LT5rZXJuZWxfY29udGV4dC0+dm07CisJCXZtID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3Rl
ZChkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQtPnZtLAorCQkJCQkgICAgICAgdHJ1ZSk7IC8qIHN0
YXRpYyB2bSAqLwogCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkKIAkJCXJldHVybiAt
RU5PREVWOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdl
X3BhZ2VzLmMKaW5kZXggOThiMmE2Y2NmY2MxLi4zMzE0ODU4ZjMwNDYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0xMzIyLDE1ICsx
MzIyLDE1IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gY3R4LT5pOTE1OwogCXVuc2lnbmVkIGxvbmcgc3VwcG9ydGVkID0gSU5U
RUxfSU5GTyhkZXZfcHJpdiktPnBhZ2Vfc2l6ZXM7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0gPSBjdHgtPnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3Ry
dWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bTsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7
CiAJdW5zaWduZWQgaW50IGZsYWdzID0gUElOX1VTRVIgfCBQSU5fT0ZGU0VUX0ZJWEVEOwogCXVu
c2lnbmVkIGludCBuOwogCWludCBmaXJzdCwgbGFzdDsKLQlpbnQgZXJyOworCWludCBlcnIgPSAw
OwogCiAJLyoKIAkgKiBNYWtlIHN1cmUgdGhlcmUncyBubyBmdW5ueSBidXNpbmVzcyB3aGVuIGRv
aW5nIGEgUElOX1VQREFURSAtLSBpbiB0aGUKQEAgLTEzNDAsOSArMTM0MCwxMCBAQCBzdGF0aWMg
aW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAkgKiBodWdlLWd0dC1wYWdlcy4K
IAkgKi8KIAotCWlmICghdm0gfHwgIWk5MTVfdm1faXNfNGx2bCh2bSkpIHsKKwl2bSA9IGk5MTVf
Z2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCWlmICghaTkxNV92bV9pc180bHZsKHZtKSkg
ewogCQlwcl9pbmZvKCI0OGIgUFBHVFQgbm90IHN1cHBvcnRlZCwgc2tpcHBpbmdcbiIpOwotCQly
ZXR1cm4gMDsKKwkJZ290byBvdXRfdm07CiAJfQogCiAJZmlyc3QgPSBpbG9nMihJOTE1X0dUVF9Q
QUdFX1NJWkVfNjRLKTsKQEAgLTE0NTEsNiArMTQ1Miw4IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0
X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCWk5MTVfdm1hX2Nsb3NlKHZtYSk7CiBvdXRfcHV0Ogog
CWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKK291dF92bToKKwlpOTE1X3ZtX3B1dCh2bSk7CiAK
IAlyZXR1cm4gZXJyOwogfQpAQCAtMTQ2MCw3ICsxNDYzLDcgQEAgc3RhdGljIGludCBpZ3RfdG1w
ZnNfZmFsbGJhY2sodm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBh
cmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJc3RydWN0
IHZmc21vdW50ICpnZW1mcyA9IGk5MTUtPm1tLmdlbWZzOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMy
ICp2YWRkcjsKQEAgLTE1MTAsNiArMTUxMyw3IEBAIHN0YXRpYyBpbnQgaWd0X3RtcGZzX2ZhbGxi
YWNrKHZvaWQgKmFyZykKIG91dF9yZXN0b3JlOgogCWk5MTUtPm1tLmdlbWZzID0gZ2VtZnM7CiAK
KwlpOTE1X3ZtX3B1dCh2bSk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTUxNywxNCArMTUyMSwx
NCBAQCBzdGF0aWMgaW50IGlndF9zaHJpbmtfdGhwKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4ID0gYXJnOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gY3R4LT5pOTE1OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/
OiAmaTkxNS0+Z2d0dC52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGk5MTVf
Z2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmo7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKIAlzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdW5zaWduZWQgaW50IGZsYWdz
ID0gUElOX1VTRVI7CiAJdW5zaWduZWQgaW50IG47Ci0JaW50IGVycjsKKwlpbnQgZXJyID0gMDsK
IAogCS8qCiAJICogU2FuaXR5IGNoZWNrIHNocmlua2luZyBodWdlLXBhZ2VkIG9iamVjdCAtLSBt
YWtlIHN1cmUgbm90aGluZyBibG93cwpAQCAtMTUzMywxMiArMTUzNywxNCBAQCBzdGF0aWMgaW50
IGlndF9zaHJpbmtfdGhwKHZvaWQgKmFyZykKIAogCWlmICghaWd0X2Nhbl9hbGxvY2F0ZV90aHAo
aTkxNSkpIHsKIAkJcHJfaW5mbygibWlzc2luZyBUSFAgc3VwcG9ydCwgc2tpcHBpbmdcbiIpOwot
CQlyZXR1cm4gMDsKKwkJZ290byBvdXRfdm07CiAJfQogCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9zaG1lbShpOTE1LCBTWl8yTSk7Ci0JaWYgKElTX0VSUihvYmopKQotCQlyZXR1cm4g
UFRSX0VSUihvYmopOworCWlmIChJU19FUlIob2JqKSkgeworCQllcnIgPSBQVFJfRVJSKG9iaik7
CisJCWdvdG8gb3V0X3ZtOworCX0KIAogCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0s
IE5VTEwpOwogCWlmIChJU19FUlIodm1hKSkgewpAQCAtMTYwNyw2ICsxNjEzLDggQEAgc3RhdGlj
IGludCBpZ3Rfc2hyaW5rX3RocCh2b2lkICphcmcpCiAJaTkxNV92bWFfY2xvc2Uodm1hKTsKIG91
dF9wdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworb3V0X3ZtOgorCWk5MTVfdm1fcHV0
KHZtKTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC0xNjc1LDYgKzE2ODMsNyBAQCBpbnQgaTkxNV9n
ZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCX07CiAJc3RydWN0IGRybV9maWxlICpmaWxlOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHg7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJaW50ZWxfd2FrZXJlZl90
IHdha2VyZWY7CiAJaW50IGVycjsKIApAQCAtMTY5OSw4ICsxNzA4LDExIEBAIGludCBpOTE1X2dl
bV9odWdlX3BhZ2VfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAJCWdvdG8gb3V0X3VubG9jazsKIAl9CiAKLQlpZiAoY3R4LT52bSkKLQkJY3R4LT52bS0+c2Ny
dWJfNjRLID0gdHJ1ZTsKKwltdXRleF9sb2NrKCZjdHgtPm11dGV4KTsKKwl2bSA9IGk5MTVfZ2Vt
X2NvbnRleHRfdm0oY3R4KTsKKwlpZiAodm0pCisJCVdSSVRFX09OQ0Uodm0tPnNjcnViXzY0Sywg
dHJ1ZSk7CisJbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsKIAogCWVyciA9IGk5MTVfc3VidGVz
dHModGVzdHMsIGN0eCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggMmZiMzFhZGEyZmE3Li5kNDRmYTlkMzU2
ZjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fY29udGV4dC5jCkBAIC01MywxOSArNTMsMTcgQEAgc3RhdGljIGludCBsaXZlX25vcF9z
d2l0Y2godm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZp
bGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBr
Y2FsbG9jKG5jdHgsIHNpemVvZigqY3R4KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFjdHgpIHsKIAkJ
ZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0K
IAogCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsKIAkJY3R4W25dID0gbGl2ZV9jb250ZXh0
KGk5MTUsIGZpbGUpOwogCQlpZiAoSVNfRVJSKGN0eFtuXSkpIHsKIAkJCWVyciA9IFBUUl9FUlIo
Y3R4W25dKTsKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAJCX0KIAl9
CiAKQEAgLTc5LDcgKzc3LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0Y2godm9pZCAqYXJn
KQogCQkJcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHhbbl0sIGVuZ2luZSk7CiAJCQlpZiAoSVNf
RVJSKHJxKSkgewogCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCWdvdG8gb3V0X3VubG9jazsK
KwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCX0K
QEAgLTg3LDcgKzg1LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0Y2godm9pZCAqYXJnKQog
CQkJcHJfZXJyKCJGYWlsZWQgdG8gcG9wdWxhdGVkICVkIGNvbnRleHRzXG4iLCBuY3R4KTsKIAkJ
CWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCWVyciA9IC1FSU87Ci0JCQlnb3Rv
IG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCQl9CiAKIAkJdGltZXNbMV0gPSBrdGlt
ZV9nZXRfcmF3KCk7CkBAIC05Nyw3ICs5NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNo
KHZvaWQgKmFyZykKIAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1
bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJ
CWdvdG8gb3V0X2ZpbGU7CiAKIAkJZW5kX3RpbWUgPSBqaWZmaWVzICsgaTkxNV9zZWxmdGVzdC50
aW1lb3V0X2ppZmZpZXM7CiAJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9tKHByaW1lLCAyLCA4
MTkyKSB7CkBAIC0xMDcsNyArMTA1LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0Y2godm9p
ZCAqYXJnKQogCQkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4W24gJSBuY3R4XSwgZW5naW5l
KTsKIAkJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCQkJ
Z290byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJCX0KIAogCQkJCS8qCkBA
IC0xNDMsNyArMTQxLDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0Y2godm9pZCAqYXJnKQog
CiAJCWVyciA9IGlndF9saXZlX3Rlc3RfZW5kKCZ0KTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0
X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJcHJfaW5mbygiU3dpdGNoIGxhdGVuY2ll
cyBvbiAlczogMSA9ICVsbHVucywgJWx1ID0gJWxsdW5zXG4iLAogCQkJZW5naW5lLT5uYW1lLApA
QCAtMTUxLDggKzE0OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykK
IAkJCXByaW1lIC0gMSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJpbWUgLSAx
KSk7CiAJfQogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4g
ZXJyOwogfQpAQCAtMjUzLDEyICsyNTAsMTAgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3
aXRjaCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmls
ZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IGxp
dmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRS
X0VSUihjdHgpOwotCQlnb3RvIG91dF9sb2NrZWQ7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJ
ZW5naW5lcyA9IGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCk7CkBAIC0yNjgsNyAr
MjYzLDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAJaWYg
KCFkYXRhKSB7CiAJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKIAkJZXJy
ID0gLUVOT01FTTsKLQkJZ290byBvdXRfbG9ja2VkOworCQlnb3RvIG91dDsKIAl9CiAKIAltID0g
MDsgLyogVXNlIHRoZSBmaXJzdCBjb250ZXh0IGFzIG91ciB0ZW1wbGF0ZSBmb3IgdGhlIGVuZ2lu
ZXMgKi8KQEAgLTI3Niw3ICsyNzEsNyBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxsZWxfc3dpdGNo
KHZvaWQgKmFyZykKIAkJZXJyID0gaW50ZWxfY29udGV4dF9waW4oY2UpOwogCQlpZiAoZXJyKSB7
CiAJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7Ci0JCQlnb3RvIG91dF9s
b2NrZWQ7CisJCQlnb3RvIG91dDsKIAkJfQogCQlkYXRhW20rK10uY2VbMF0gPSBpbnRlbF9jb250
ZXh0X2dldChjZSk7CiAJfQpAQCAtMjg3LDcgKzI4Miw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJh
bGxlbF9zd2l0Y2godm9pZCAqYXJnKQogCQljdHggPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7
CiAJCWlmIChJU19FUlIoY3R4KSkgewogCQkJZXJyID0gUFRSX0VSUihjdHgpOwotCQkJZ290byBv
dXRfbG9ja2VkOworCQkJZ290byBvdXQ7CiAJCX0KIAogCQlmb3IgKG0gPSAwOyBtIDwgY291bnQ7
IG0rKykgewpAQCAtMjk2LDIwICsyOTEsMTggQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3
aXRjaCh2b2lkICphcmcpCiAKIAkJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBkYXRh
W21dLmNlWzBdLT5lbmdpbmUpOwogCQkJaWYgKElTX0VSUihjZSkpCi0JCQkJZ290byBvdXRfbG9j
a2VkOworCQkJCWdvdG8gb3V0OwogCiAJCQllcnIgPSBpbnRlbF9jb250ZXh0X3BpbihjZSk7CiAJ
CQlpZiAoZXJyKSB7CiAJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCQkJCWdvdG8gb3V0X2xv
Y2tlZDsKKwkJCQlnb3RvIG91dDsKIAkJCX0KIAogCQkJZGF0YVttXS5jZVtuXSA9IGNlOwogCQl9
CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWZvciAo
Zm4gPSBmdW5jOyAhZXJyICYmICpmbjsgZm4rKykgewogCQlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0
OwogCQlpbnQgbjsKQEAgLTM1NCw4ICszNDcsNyBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxsZWxf
c3dpdGNoKHZvaWQgKmFyZykKIAkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLW91dF9sb2Nr
ZWQ6CitvdXQ6CiAJZm9yIChuID0gMDsgbiA8IGNvdW50OyBuKyspIHsKIAkJZm9yIChtID0gMDsg
bSA8IEFSUkFZX1NJWkUoZGF0YS0+Y2UpOyBtKyspIHsKIAkJCWlmICghZGF0YVtuXS5jZVttXSkK
QEAgLTM2NSw4ICszNTcsOCBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxsZWxfc3dpdGNoKHZvaWQg
KmFyZykKIAkJCWludGVsX2NvbnRleHRfcHV0KGRhdGFbbl0uY2VbbV0pOwogCQl9CiAJfQotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJa2ZyZWUoZGF0YSk7CitvdXRf
ZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAt
NjI2LDExICs2MTgsOSBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCWlm
IChJU19FUlIoZmlsZSkpCiAJCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2lu
KCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8g
b3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJbmNvbnRleHRzID0gMDsKIAkJbmR3
b3JkcyA9IDA7CkBAIC02NDIsNyArNjMyLDcgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9p
ZCAqYXJnKQogCQkJY3R4ID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CiAJCQlpZiAoSVNfRVJSKGN0
eCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKGN0eCk7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJ
CWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5n
aW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKQEAgLTY1NCw3ICs2NDQsNyBAQCBzdGF0aWMg
aW50IGlndF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQkJCWVyciA9IFBUUl9FUlIob2JqKTsKIAkJ
CQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgp
OwotCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQkJfQogCQkJ
fQogCkBAIC02NjMsMTcgKzY1MywxOCBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2b2lkICph
cmcpCiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAlbHUgWyVsdS8lbHVdIHdpdGgg
Z3B1ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJCSAgICAgICBuZHdvcmRz
LCBkdywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsCi0JCQkJICAg
ICAgIHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJICAgICAgIHllc25vKCEhcmN1X2FjY2Vz
c19wb2ludGVyKGN0eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsKIAkJCQlpbnRlbF9jb250ZXh0
X3B1dChjZSk7CiAJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKLQkJCQlnb3RvIG91dF91
bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJZXJyID0gdGhyb3R0bGUoY2Us
IHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJaW50ZWxfY29udGV4dF9w
dXQoY2UpOwogCQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci0JCQkJZ290byBvdXRfdW5s
b2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWlmICgrK2R3ID09IG1heF9kd29y
ZHMob2JqKSkgewpAQCAtNzAzLDExICs2OTQsMTAgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWMo
dm9pZCAqYXJnKQogCQkJZHcgKz0gcmVtOwogCQl9CiAKLW91dF91bmxvY2s6CitvdXRfZmlsZToK
IAkJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwogCQlpZiAoaWd0X2xpdmVf
dGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAogCQltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAkJaWYgKGVy
cikKQEAgLTc0MiwyMiArNzMyLDIwIEBAIHN0YXRpYyBpbnQgaWd0X3NoYXJlZF9jdHhfZXhlYyh2
b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXBhcmVudCA9IGxpdmVf
Y29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKHBhcmVudCkpIHsKIAkJZXJyID0gUFRS
X0VSUihwYXJlbnQpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQog
CiAJaWYgKCFwYXJlbnQtPnZtKSB7IC8qIG5vdCBmdWxsLXBwZ3R0OyBub3RoaW5nIHRvIHNoYXJl
ICovCiAJCWVyciA9IDA7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9
CiAKIAllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgIiIpOwog
CWlmIChlcnIpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAogCWZvcl9l
YWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXVuc2lnbmVkIGxvbmcgbmNvbnRleHRz
LCBuZHdvcmRzLCBkdzsKQEAgLTc4MSw3ICs3NjksOSBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRf
Y3R4X2V4ZWModm9pZCAqYXJnKQogCQkJCWdvdG8gb3V0X3Rlc3Q7CiAJCQl9CiAKKwkJCW11dGV4
X2xvY2soJmN0eC0+bXV0ZXgpOwogCQkJX19hc3NpZ25fcHBndHQoY3R4LCBwYXJlbnQtPnZtKTsK
KwkJCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CiAKIAkJCWNlID0gaTkxNV9nZW1fY29udGV4
dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKIAkJCUdFTV9CVUdfT04oSVNf
RVJSKGNlKSk7CkBAIC04MDEsNyArNzkxLDggQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVkX2N0eF9l
eGVjKHZvaWQgKmFyZykKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxsIGR3b3JkICVsdSBbJWx1
LyVsdV0gd2l0aCBncHUgKCVzKSBbZnVsbC1wcGd0dD8gJXNdLCBlcnI9JWRcbiIsCiAJCQkJICAg
ICAgIG5kd29yZHMsIGR3LCBtYXhfZHdvcmRzKG9iaiksCiAJCQkJICAgICAgIGVuZ2luZS0+bmFt
ZSwKLQkJCQkgICAgICAgeWVzbm8oISFjdHgtPnZtKSwgZXJyKTsKKwkJCQkgICAgICAgeWVzbm8o
ISFyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpLAorCQkJCSAgICAgICBlcnIpOwogCQkJCWlu
dGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCQkJ
CWdvdG8gb3V0X3Rlc3Q7CkBAIC04NDAsMTcgKzgzMSwxMyBAQCBzdGF0aWMgaW50IGlndF9zaGFy
ZWRfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJZHcgKz0gcmVtOwogCQl9CiAKLQkJbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2Jq
ZWN0cyhpOTE1KTsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJfQog
b3V0X3Rlc3Q6CiAJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwogCWlmIChp
Z3RfbGl2ZV90ZXN0X2VuZCgmdCkpCiAJCWVyciA9IC1FSU87Ci1vdXRfdW5sb2NrOgotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KK291dF9maWxlOgogCW1vY2tfZmls
ZV9mcmVlKGk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CkBAIC0xMjIyLDggKzEyMDksNiBA
QCBfX2lndF9jdHhfc3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZiAoZmxh
Z3MgJiBURVNUX1JFU0VUKQogCQlpZ3RfZ2xvYmFsX3Jlc2V0X2xvY2soJmk5MTUtPmd0KTsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0gbGl2ZV9jb250
ZXh0KGk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQlyZXQgPSBQVFJfRVJSKGN0
eCk7CkBAIC0xMjc4LDggKzEyNjMsNiBAQCBfX2lndF9jdHhfc3NldShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAKIG91dF91bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmIChmbGFncyAm
IFRFU1RfUkVTRVQpCiAJCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKCZpOTE1LT5ndCk7CiAKQEAg
LTEzMzksMjMgKzEzMjIsMjQgQEAgc3RhdGljIGludCBpZ3RfY3R4X3JlYWRvbmx5KHZvaWQgKmFy
ZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZXJyID0gaWd0X2xpdmVfdGVzdF9i
ZWdpbigmdCwgaTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQotCQlnb3RvIG91dF91bmxv
Y2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAljdHggPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7
CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXRf
dW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAotCXZtID0gY3R4LT52bSA/OiAmaTkxNS0+
Z2d0dC5hbGlhcy0+dm07CisJcmN1X3JlYWRfbG9jaygpOworCXZtID0gcmN1X2RlcmVmZXJlbmNl
KGN0eC0+dm0pID86ICZpOTE1LT5nZ3R0LmFsaWFzLT52bTsKIAlpZiAoIXZtIHx8ICF2bS0+aGFz
X3JlYWRfb25seSkgeworCQlyY3VfcmVhZF91bmxvY2soKTsKIAkJZXJyID0gMDsKLQkJZ290byBv
dXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KKwlyY3VfcmVhZF91bmxvY2soKTsKIAog
CW5kd29yZHMgPSAwOwogCWR3ID0gMDsKQEAgLTEzNzMsNyArMTM1Nyw3IEBAIHN0YXRpYyBpbnQg
aWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJCQkJaWYgKElTX0VSUihvYmopKSB7CiAJCQkJ
CWVyciA9IFBUUl9FUlIob2JqKTsKIAkJCQkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5l
cyhjdHgpOwotCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQkJ
fQogCiAJCQkJaWYgKHByYW5kb21fdTMyX3N0YXRlKCZwcm5nKSAmIDEpCkBAIC0xMzg0LDE1ICsx
MzY4LDE3IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJCQlpZiAo
ZXJyKSB7CiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAlbHUgWyVsdS8lbHVdIHdp
dGggZ3B1ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJCSAgICAgICBuZHdv
cmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAotCQkJCSAgICAgICBjZS0+ZW5naW5lLT5uYW1lLCB5
ZXNubyghIWN0eC0+dm0pLCBlcnIpOworCQkJCSAgICAgICBjZS0+ZW5naW5lLT5uYW1lLAorCQkJ
CSAgICAgICB5ZXNubyghIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSksCisJCQkJICAgICAg
IGVycik7CiAJCQkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwotCQkJCWdv
dG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCiAJCQllcnIgPSB0aHJv
dHRsZShjZSwgdHEsIEFSUkFZX1NJWkUodHEpKTsKIAkJCWlmIChlcnIpIHsKIAkJCQlpOTE1X2dl
bV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJ
CWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWlmICgrK2R3ID09IG1heF9kd29yZHMob2JqKSkg
ewpAQCAtMTQyNCwyMCArMTQxMCwxOSBAQCBzdGF0aWMgaW50IGlndF9jdHhfcmVhZG9ubHkodm9p
ZCAqYXJnKQogCQlkdyArPSByZW07CiAJfQogCi1vdXRfdW5sb2NrOgorb3V0X2ZpbGU6CiAJdGhy
b3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwogCWlmIChpZ3RfbGl2ZV90ZXN0X2Vu
ZCgmdCkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CiAK
LXN0YXRpYyBpbnQgY2hlY2tfc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCB1
NjQgb2Zmc2V0KQorc3RhdGljIGludCBjaGVja19zY3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLCB1NjQgb2Zmc2V0KQogewogCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSA9Ci0J
CV9fZHJtX21tX2ludGVydmFsX2ZpcnN0KCZjdHgtPnZtLT5tbSwKKwkJX19kcm1fbW1faW50ZXJ2
YWxfZmlyc3QoJnZtLT5tbSwKIAkJCQkJb2Zmc2V0LCBvZmZzZXQgKyBzaXplb2YodTMyKSAtIDEp
OwogCWlmICghbm9kZSB8fCBub2RlLT5zdGFydCA+IG9mZnNldCkKIAkJcmV0dXJuIDA7CkBAIC0x
NDU1LDYgKzE0NDAsNyBAQCBzdGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0
eC0+aTkxNTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwogCXUzMiAqY21kOwpAQCAtMTQ4NywxNyArMTQ3MywxOCBAQCBzdGF0aWMg
aW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAogCWlu
dGVsX2d0X2NoaXBzZXRfZmx1c2goZW5naW5lLT5ndCk7CiAKLQl2bWEgPSBpOTE1X3ZtYV9pbnN0
YW5jZShvYmosIGN0eC0+dm0sIE5VTEwpOworCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1f
cmN1KGN0eCk7CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CiAJaWYg
KElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKLQkJZ290byBlcnI7CisJCWdv
dG8gZXJyX3ZtOwogCX0KIAogCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VS
IHwgUElOX09GRlNFVF9GSVhFRCk7CiAJaWYgKGVycikKLQkJZ290byBlcnI7CisJCWdvdG8gZXJy
X3ZtOwogCi0JZXJyID0gY2hlY2tfc2NyYXRjaChjdHgsIG9mZnNldCk7CisJZXJyID0gY2hlY2tf
c2NyYXRjaCh2bSwgb2Zmc2V0KTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl91bnBpbjsKIApAQCAt
MTUyMyw2ICsxNTEwLDcgQEAgc3RhdGljIGludCB3cml0ZV90b19zY3JhdGNoKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAorCWk5MTVfdm1f
cHV0KHZtKTsKIAlyZXR1cm4gMDsKIAogc2tpcF9yZXF1ZXN0OgpAQCAtMTUzMSw2ICsxNTE5LDgg
QEAgc3RhdGljIGludCB3cml0ZV90b19zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHgsCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiBlcnJfdW5waW46CiAJaTkxNV92bWFfdW5waW4o
dm1hKTsKK2Vycl92bToKKwlpOTE1X3ZtX3B1dCh2bSk7CiBlcnI6CiAJaTkxNV9nZW1fb2JqZWN0
X3B1dChvYmopOwogCXJldHVybiBlcnI7CkBAIC0xNTQyLDYgKzE1MzIsNyBAQCBzdGF0aWMgaW50
IHJlYWRfZnJvbV9zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAljb25z
dCB1MzIgUkNTX0dQUjAgPSAweDI2MDA7IC8qIG5vdCBhbGwgZW5naW5lcyBoYXZlIHRoZWlyIG93
biBHUFIhICovCiAJY29uc3QgdTMyIHJlc3VsdCA9IDB4MTAwOwogCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxOwpAQCAtMTU4NiwxNyArMTU3NywxOCBAQCBzdGF0aWMgaW50IHJlYWRfZnJvbV9zY3Jh
dGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlpbnRlbF9ndF9jaGlwc2V0X2Zs
dXNoKGVuZ2luZS0+Z3QpOwogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBjdHgtPnZt
LCBOVUxMKTsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCXZtYSA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOwogCWlmIChJU19FUlIodm1hKSkgewog
CQllcnIgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyOworCQlnb3RvIGVycl92bTsKIAl9CiAK
IAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUiB8IFBJTl9PRkZTRVRfRklY
RUQpOwogCWlmIChlcnIpCi0JCWdvdG8gZXJyOworCQlnb3RvIGVycl92bTsKIAotCWVyciA9IGNo
ZWNrX3NjcmF0Y2goY3R4LCBvZmZzZXQpOworCWVyciA9IGNoZWNrX3NjcmF0Y2godm0sIG9mZnNl
dCk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfdW5waW47CiAKQEAgLTE2MjcsMTIgKzE2MTksMTIg
QEAgc3RhdGljIGludCByZWFkX2Zyb21fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4LAogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fY3B1X2RvbWFpbihvYmosIGZhbHNl
KTsKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CiAJaWYgKGVycikKLQkJZ290byBlcnI7
CisJCWdvdG8gZXJyX3ZtOwogCiAJY21kID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2JqLCBJ
OTE1X01BUF9XQik7CiAJaWYgKElTX0VSUihjbWQpKSB7CiAJCWVyciA9IFBUUl9FUlIoY21kKTsK
LQkJZ290byBlcnI7CisJCWdvdG8gZXJyX3ZtOwogCX0KIAogCSp2YWx1ZSA9IGNtZFtyZXN1bHQg
LyBzaXplb2YoKmNtZCldOwpAQCAtMTY0Nyw2ICsxNjM5LDggQEAgc3RhdGljIGludCByZWFkX2Zy
b21fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOwogZXJyX3VucGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7CitlcnJfdm06CisJaTkx
NV92bV9wdXQodm0pOwogZXJyOgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAlyZXR1cm4g
ZXJyOwpAQCAtMTY3NywyNyArMTY3MSwyNSBAQCBzdGF0aWMgaW50IGlndF92bV9pc29sYXRpb24o
dm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAllcnIgPSBpZ3RfbGl2
ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgIiIpOwogCWlmIChlcnIpCi0JCWdvdG8g
b3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAogCWN0eF9hID0gbGl2ZV9jb250ZXh0KGk5
MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4X2EpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4X2Ep
OwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJY3R4X2IgPSBs
aXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHhfYikpIHsKIAkJZXJyID0g
UFRSX0VSUihjdHhfYik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9
CiAKIAkvKiBXZSBjYW4gb25seSB0ZXN0IHZtIGlzb2xhdGlvbiwgaWYgdGhlIHZtIGFyZSBkaXN0
aW5jdCAqLwogCWlmIChjdHhfYS0+dm0gPT0gY3R4X2ItPnZtKQotCQlnb3RvIG91dF91bmxvY2s7
CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAl2bV90b3RhbCA9IGN0eF9hLT52bS0+dG90YWw7CiAJR0VN
X0JVR19PTihjdHhfYi0+dm0tPnRvdGFsICE9IHZtX3RvdGFsKTsKQEAgLTE3MjYsNyArMTcxOCw3
IEBAIHN0YXRpYyBpbnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcpCiAJCQkJZXJyID0gcmVh
ZF9mcm9tX3NjcmF0Y2goY3R4X2IsIGVuZ2luZSwKIAkJCQkJCQlvZmZzZXQsICZ2YWx1ZSk7CiAJ
CQlpZiAoZXJyKQotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCiAJ
CQlpZiAodmFsdWUpIHsKIAkJCQlwcl9lcnIoIiVzOiBSZWFkICUwOHggZnJvbSBzY3JhdGNoIChv
ZmZzZXQgMHglMDh4XyUwOHgpLCBhZnRlciAlbHUgcmVhZHMhXG4iLApAQCAtMTczNSw3ICsxNzI3
LDcgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0aW9uKHZvaWQgKmFyZykKIAkJCQkgICAgICAg
bG93ZXJfMzJfYml0cyhvZmZzZXQpLAogCQkJCSAgICAgICB0aGlzKTsKIAkJCQllcnIgPSAtRUlO
VkFMOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCiAJ
CQl0aGlzKys7CkBAIC0xNzQ1LDExICsxNzM3LDkgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0
aW9uKHZvaWQgKmFyZykKIAlwcl9pbmZvKCJDaGVja2VkICVsdSBzY3JhdGNoIG9mZnNldHMgYWNy
b3NzICVkIGVuZ2luZXNcbiIsCiAJCWNvdW50LCBSVU5USU1FX0lORk8oaTkxNSktPm51bV9lbmdp
bmVzKTsKIAotb3V0X3VubG9jazoKK291dF9maWxlOgogCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgm
dCkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CkBAIC0x
NzgxLDEzICsxNzcxLDkgQEAgc3RhdGljIGludCBtb2NrX2NvbnRleHRfYmFycmllcih2b2lkICph
cmcpCiAJICogYSByZXF1ZXN0OyB1c2VmdWwgZm9yIHJldGlyaW5nIG9sZCBzdGF0ZSBhZnRlciBs
b2FkaW5nIG5ldy4KIAkgKi8KIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJY3R4ID0gbW9ja19jb250ZXh0KGk5MTUsICJtb2NrIik7Ci0JaWYgKCFjdHgpIHsKLQkJ
ZXJyID0gLUVOT01FTTsKLQkJZ290byB1bmxvY2s7Ci0JfQorCWlmICghY3R4KQorCQlyZXR1cm4g
LUVOT01FTTsKIAogCWNvdW50ZXIgPSAwOwogCWVyciA9IGNvbnRleHRfYmFycmllcl90YXNrKGN0
eCwgMCwKQEAgLTE4NjAsOCArMTg0Niw2IEBAIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X2JhcnJp
ZXIodm9pZCAqYXJnKQogCiBvdXQ6CiAJbW9ja19jb250ZXh0X2Nsb3NlKGN0eCk7Ci11bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwog
I3VuZGVmIHByX2ZtdAogI2RlZmluZSBwcl9mbXQoeCkgeApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMKaW5kZXggMDEwNGYxNmIxMzI3Li43
NGRkZDY4MmM5Y2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvbW9ja19jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9tb2NrX2NvbnRleHQuYwpAQCAtNDIsNyArNDIsMTAgQEAgbW9ja19jb250ZXh0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQlpZiAoIXBwZ3R0KQogCQkJZ290byBlcnJfcHV0Owog
CisJCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCQlfX3NldF9wcGd0dChjdHgsICZwcGd0dC0+
dm0pOworCQltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOworCiAJCWk5MTVfdm1fcHV0KCZwcGd0
dC0+dm0pOwogCX0KIApAQCAtNjUsNyArNjgsNyBAQCB2b2lkIG1vY2tfY29udGV4dF9jbG9zZShz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCiB2b2lkIG1vY2tfaW5pdF9jb250ZXh0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbml0X2NvbnRleHRzKGk5MTUpOwor
CWluaXRfY29udGV4dHMoJmk5MTUtPmdlbS5jb250ZXh0cyk7CiB9CiAKIHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICoKQEAgLTc0LDggKzc3LDYgQEAgbGl2ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eDsKIAlpbnQgZXJyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChpOTE1
LCAwKTsKIAlpZiAoSVNfRVJSKGN0eCkpCiAJCXJldHVybiBjdHg7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggMzVhNDBjMjgyMGEyLi5iZTM0ZDk3YWMxOGYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTIyMSwxMiArMjIxLDIw
IEBAIGludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCSAgIHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCSAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKIHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKwogCUdFTV9CVUdf
T04oIWVuZ2luZS0+Y29wcyk7CiAKIAlrcmVmX2luaXQoJmNlLT5yZWYpOwogCiAJY2UtPmdlbV9j
b250ZXh0ID0gY3R4OwotCWNlLT52bSA9IGk5MTVfdm1fZ2V0KGN0eC0+dm0gPzogJmVuZ2luZS0+
Z3QtPmdndHQtPnZtKTsKKwlyY3VfcmVhZF9sb2NrKCk7CisJdm0gPSByY3VfZGVyZWZlcmVuY2Uo
Y3R4LT52bSk7CisJaWYgKHZtKQorCQljZS0+dm0gPSBpOTE1X3ZtX2dldCh2bSk7CisJZWxzZQor
CQljZS0+dm0gPSBpOTE1X3ZtX2dldCgmZW5naW5lLT5ndC0+Z2d0dC0+dm0pOworCXJjdV9yZWFk
X3VubG9jaygpOwogCWlmIChjdHgtPnRpbWVsaW5lKQogCQljZS0+dGltZWxpbmUgPSBpbnRlbF90
aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJj
LmMKaW5kZXggNDY4NDM4ZmI0N2FmLi40NzFjMjNkMGNmZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jCkBAIC05ODEsNiArOTgxLDExIEBAIF9fZXhlY2xpc3RzX3NjaGVkdWxlX2lu
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQljZS0+bHJjX2Rlc2MgfD0KIAkJCSh1NjQpKGVu
Z2luZS0+Y29udGV4dF90YWcrKyAlIE5VTV9DT05URVhUX1RBRykgPDwKIAkJCUdFTjExX1NXX0NU
WF9JRF9TSElGVDsKKworI2RlZmluZSBHRU4xMV9NQVhfQ09OVEVYVF9IV19JRCAoMTw8MTEpIC8q
IGV4Y2x1c2l2ZSAqLworLyogaW4gR2VuMTIgSUQgMHg3RkYgaXMgcmVzZXJ2ZWQgdG8gaW5kaWNh
dGUgaWRsZSAqLworI2RlZmluZSBHRU4xMl9NQVhfQ09OVEVYVF9IV19JRCAgICAgICAgKEdFTjEx
X01BWF9DT05URVhUX0hXX0lEIC0gMSkKKwogCQlCVUlMRF9CVUdfT04oTlVNX0NPTlRFWFRfVEFH
ID4gR0VOMTJfTUFYX0NPTlRFWFRfSFdfSUQpOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfY29udGV4dC5jCmluZGV4IDg2Y2ZmYmIwYTljYi4uN2M4MzhhNTdlMTc0IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCkBAIC0xNTUsMTMg
KzE1NSw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAqYXJnKQogCSAqIEhX
IHRyaWVzIHRvIHdyaXRlIHBhc3QgdGhlIGVuZCBvZiBvbmUuCiAJICovCiAKLQltdXRleF9sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmaXhtZSA9IGtlcm5lbF9jb250ZXh0
KGd0LT5pOTE1KTsKLQlpZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIgPSBQVFJfRVJSKGZpeG1l
KTsKLQkJZ290byB1bmxvY2s7Ci0JfQorCWlmIChJU19FUlIoZml4bWUpKQorCQlyZXR1cm4gUFRS
X0VSUihmaXhtZSk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsK
IAkJc3RydWN0IHsKQEAgLTIwMSw4ICsxOTcsNiBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9z
aXplKHZvaWQgKmFyZykKIAl9CiAKIAlrZXJuZWxfY29udGV4dF9jbG9zZShmaXhtZSk7Ci11bmxv
Y2s6Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJu
IGVycjsKIH0KIApAQCAtMzA1LDEyICsyOTksMTAgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9j
b250ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihm
aWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWZp
eG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGZpeG1lKSkg
ewogCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byB1bmxvY2s7CisJCWdvdG8gb3V0X2Zp
bGU7CiAJfQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CkBAIC0z
MjMsOCArMzE1LDcgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9jb250ZXh0KHZvaWQgKmFyZykK
IAkJCWJyZWFrOwogCX0KIAotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUp
OwogCXJldHVybiBlcnI7CiB9CkBAIC00MTgsMTIgKzQwOSwxMCBAQCBzdGF0aWMgaW50IGxpdmVf
cmVtb3RlX2NvbnRleHQodm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQ
VFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJZml4bWUgPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIo
Zml4bWUpKSB7CiAJCWVyciA9IFBUUl9FUlIoZml4bWUpOwotCQlnb3RvIHVubG9jazsKKwkJZ290
byBvdXRfZmlsZTsKIAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQp
IHsKQEAgLTQzNiw4ICs0MjUsNyBAQCBzdGF0aWMgaW50IGxpdmVfcmVtb3RlX2NvbnRleHQodm9p
ZCAqYXJnKQogCQkJYnJlYWs7CiAJfQogCi11bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkx
NSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggZmZiYjNkMjNiODg3Li5lOGE0MGRmNzliZDAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCkBAIC01OCw5ICs1
OCw3IEBAIHN0YXRpYyBpbnQgaGFuZ19pbml0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQogCW1lbXNldChoLCAwLCBzaXplb2YoKmgpKTsKIAloLT5ndCA9IGd0OwogCi0JbXV0
ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWgtPmN0eCA9IGtlcm5lbF9j
b250ZXh0KGd0LT5pOTE1KTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAlpZiAoSVNfRVJSKGgtPmN0eCkpCiAJCXJldHVybiBQVFJfRVJSKGgtPmN0eCk7CiAK
QEAgLTEzMyw3ICsxMzEsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqCiBoYW5nX2Ny
ZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGgtPmd0OwotCXN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtID0gaC0+Y3R4LT52bSA/OiAmZW5naW5lLT5ndC0+Z2d0dC0+dm07CisJc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3Uo
aC0+Y3R4KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxID0gTlVMTDsKIAlzdHJ1Y3QgaTkxNV92bWEgKmh3cywgKnZtYTsKQEAgLTE0
MywxMiArMTQxLDE1IEBAIGhhbmdfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhhbmcgKmgsIHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpbnQgZXJyOwogCiAJb2JqID0gaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJS
KG9iaikpCisJaWYgKElTX0VSUihvYmopKSB7CisJCWk5MTVfdm1fcHV0KHZtKTsKIAkJcmV0dXJu
IEVSUl9DQVNUKG9iaik7CisJfQogCiAJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChv
YmosIGk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZ3QtPmk5MTUpKTsKIAlpZiAoSVNfRVJSKHZhZGRy
KSkgewogCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCWk5MTVfdm1fcHV0KHZtKTsKIAkJ
cmV0dXJuIEVSUl9DQVNUKHZhZGRyKTsKIAl9CiAKQEAgLTE1OSwxNiArMTYwLDIyIEBAIGhhbmdf
Y3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhhbmcgKmgsIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKIAloLT5iYXRjaCA9IHZhZGRyOwogCiAJdm1hID0gaTkxNV92bWFfaW5zdGFuY2UoaC0+
b2JqLCB2bSwgTlVMTCk7Ci0JaWYgKElTX0VSUih2bWEpKQorCWlmIChJU19FUlIodm1hKSkgewor
CQlpOTE1X3ZtX3B1dCh2bSk7CiAJCXJldHVybiBFUlJfQ0FTVCh2bWEpOworCX0KIAogCWh3cyA9
IGk5MTVfdm1hX2luc3RhbmNlKGgtPmh3cywgdm0sIE5VTEwpOwotCWlmIChJU19FUlIoaHdzKSkK
KwlpZiAoSVNfRVJSKGh3cykpIHsKKwkJaTkxNV92bV9wdXQodm0pOwogCQlyZXR1cm4gRVJSX0NB
U1QoaHdzKTsKKwl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUik7
Ci0JaWYgKGVycikKKwlpZiAoZXJyKSB7CisJCWk5MTVfdm1fcHV0KHZtKTsKIAkJcmV0dXJuIEVS
Ul9QVFIoZXJyKTsKKwl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW4oaHdzLCAwLCAwLCBQSU5fVVNF
Uik7CiAJaWYgKGVycikKQEAgLTI2Niw2ICsyNzMsNyBAQCBoYW5nX2NyZWF0ZV9yZXF1ZXN0KHN0
cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaTkxNV92bWFf
dW5waW4oaHdzKTsKIHVucGluX3ZtYToKIAlpOTE1X3ZtYV91bnBpbih2bWEpOworCWk5MTVfdm1f
cHV0KHZtKTsKIAlyZXR1cm4gZXJyID8gRVJSX1BUUihlcnIpIDogcnE7CiB9CiAKQEAgLTM4Miw5
ICszOTAsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3Aodm9pZCAqYXJnKQogCWlmIChJU19F
UlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmls
ZSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElT
X0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKIAkJZ290byBvdXQ7CkBAIC00NTgs
OSArNDY0LDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJ
aWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5p
OTE1LCBmaWxlKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwogCQlnb3RvIG91dDsK
QEAgLTcwNSw5ICs3MDksNyBAQCBzdGF0aWMgaW50IGFjdGl2ZV9lbmdpbmUodm9pZCAqZGF0YSkK
IAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKIAlmb3IgKGNvdW50ID0gMDsgY291bnQgPCBBUlJB
WV9TSVpFKGN0eCk7IGNvdW50KyspIHsKLQkJbXV0ZXhfbG9jaygmZW5naW5lLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAkJY3R4W2NvdW50XSA9IGxpdmVfY29udGV4dChlbmdpbmUtPmk5MTUs
IGZpbGUpOwotCQltdXRleF91bmxvY2soJmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJCWlmIChJU19FUlIoY3R4W2NvdW50XSkpIHsKIAkJCWVyciA9IFBUUl9FUlIoY3R4W2NvdW50
XSk7CiAJCQl3aGlsZSAoLS1jb3VudCkKQEAgLTEyOTEsNiArMTI5Myw3IEBAIHN0YXRpYyBpbnQg
aWd0X3Jlc2V0X2V2aWN0X3BwZ3R0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0
ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisJc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm07CiAJc3RydWN0IGRybV9maWxlICpmaWxlOwogCWludCBlcnI7CiAKQEAg
LTEyOTgsMTggKzEzMDEsMjAgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfZXZpY3RfcHBndHQodm9p
ZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0J
bXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29u
dGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKIAkJ
Z290byBvdXQ7CiAJfQogCiAJZXJyID0gMDsKLQlpZiAoY3R4LT52bSkgLyogYWxpYXNpbmcgPT0g
Z2xvYmFsIGd0dCBsb2NraW5nLCBjb3ZlcmVkIGFib3ZlICovCi0JCWVyciA9IF9faWd0X3Jlc2V0
X2V2aWN0X3ZtYShndCwgY3R4LT52bSwKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3Jj
dShjdHgpOworCWlmICghaTkxNV9pc19nZ3R0KHZtKSkgeworCQkvKiBhbGlhc2luZyA9PSBnbG9i
YWwgZ3R0IGxvY2tpbmcsIGNvdmVyZWQgYWJvdmUgKi8KKwkJZXJyID0gX19pZ3RfcmVzZXRfZXZp
Y3Rfdm1hKGd0LCB2bSwKIAkJCQkJICAgIGV2aWN0X3ZtYSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwor
CX0KKwlpOTE1X3ZtX3B1dCh2bSk7CiAKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkxNSwg
ZmlsZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IDA0YzFjZjU3
MzY0Mi4uOGRjNDJjNWM3NTY5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMu
YwpAQCAtMTYzMSw3ICsxNjMxLDExIEBAIHN0YXRpYyBpbnQgc21va2Vfc3VibWl0KHN0cnVjdCBw
cmVlbXB0X3Ntb2tlICpzbW9rZSwKIAlpbnQgZXJyID0gMDsKIAogCWlmIChiYXRjaCkgewotCQl2
bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShiYXRjaCwgY3R4LT52bSwgTlVMTCk7CisJCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCisJCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1f
cmN1KGN0eCk7CisJCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKGJhdGNoLCB2bSwgTlVMTCk7CisJ
CWk5MTVfdm1fcHV0KHZtKTsKIAkJaWYgKElTX0VSUih2bWEpKQogCQkJcmV0dXJuIFBUUl9FUlIo
dm1hKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29y
a2Fyb3VuZHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRz
LmMKaW5kZXggNGVlMmUyYmFiZDBkLi43YzdhY2ViODVhNzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwpAQCAtMjYwLDcgKzI2MCw2IEBAIHN3
aXRjaF90b19zY3JhdGNoX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAog
CQlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KHNwaW4sIGNlLCBNSV9OT09QKTsKIAog
CWludGVsX2NvbnRleHRfcHV0KGNlKTsKLQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCiAJ
aWYgKElTX0VSUihycSkpIHsKIAkJc3BpbiA9IE5VTEw7CkBAIC0yNzksNiArMjc4LDcgQEAgc3dp
dGNoX3RvX3NjcmF0Y2hfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJ
aWYgKGVyciAmJiBzcGluKQogCQlpZ3Rfc3Bpbm5lcl9lbmQoc3Bpbik7CiAKKwlrZXJuZWxfY29u
dGV4dF9jbG9zZShjdHgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTM1NSw2ICszNTUsNyBAQCBz
dGF0aWMgaW50IGNoZWNrX3doaXRlbGlzdF9hY3Jvc3NfcmVzZXQoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX2JhdGNoKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkxNV92bWEg
KnZtYTsKIAlpbnQgZXJyOwogCkBAIC0zNjIsNyArMzYzLDkgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3ZtYSAqY3JlYXRlX2JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiAJaWYgKElT
X0VSUihvYmopKQogCQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsKIAotCXZtYSA9IGk5MTVfdm1hX2lu
c3RhbmNlKG9iaiwgY3R4LT52bSwgTlVMTCk7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92
bV9yY3UoY3R4KTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsKKwlp
OTE1X3ZtX3B1dCh2bSk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1h
KTsKIAkJZ290byBlcnJfb2JqOwpAQCAtNDYzLDEyICs0NjYsMTUgQEAgc3RhdGljIGludCBjaGVj
a19kaXJ0eV93aGl0ZWxpc3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJMHhmZmZm
MDBmZiwKIAkJMHhmZmZmZmZmZiwKIAl9OworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
OwogCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKIAlzdHJ1Y3QgaTkxNV92bWEgKmJhdGNoOwog
CWludCBlcnIgPSAwLCBpLCB2OwogCXUzMiAqY3MsICpyZXN1bHRzOwogCi0Jc2NyYXRjaCA9IGNy
ZWF0ZV9zY3JhdGNoKGN0eC0+dm0sIDIgKiBBUlJBWV9TSVpFKHZhbHVlcykgKyAxKTsKKwl2bSA9
IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCXNjcmF0Y2ggPSBjcmVhdGVfc2Ny
YXRjaCh2bSwgMiAqIEFSUkFZX1NJWkUodmFsdWVzKSArIDEpOworCWk5MTVfdm1fcHV0KHZtKTsK
IAlpZiAoSVNfRVJSKHNjcmF0Y2gpKQogCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIApAQCAt
MTAxMCw2ICsxMDE2LDcgQEAgc3RhdGljIGludCBsaXZlX2lzb2xhdGVkX3doaXRlbGlzdCh2b2lk
ICphcmcpCiAJCXJldHVybiAwOwogCiAJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xpZW50
KTsgaSsrKSB7CisJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCQlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqYzsKIAogCQljID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CkBAIC0xMDE4
LDIyICsxMDI1LDI3IEBAIHN0YXRpYyBpbnQgbGl2ZV9pc29sYXRlZF93aGl0ZWxpc3Qodm9pZCAq
YXJnKQogCQkJZ290byBlcnI7CiAJCX0KIAotCQljbGllbnRbaV0uc2NyYXRjaFswXSA9IGNyZWF0
ZV9zY3JhdGNoKGMtPnZtLCAxMDI0KTsKKwkJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9y
Y3UoYyk7CisKKwkJY2xpZW50W2ldLnNjcmF0Y2hbMF0gPSBjcmVhdGVfc2NyYXRjaCh2bSwgMTAy
NCk7CiAJCWlmIChJU19FUlIoY2xpZW50W2ldLnNjcmF0Y2hbMF0pKSB7CiAJCQllcnIgPSBQVFJf
RVJSKGNsaWVudFtpXS5zY3JhdGNoWzBdKTsKKwkJCWk5MTVfdm1fcHV0KHZtKTsKIAkJCWtlcm5l
bF9jb250ZXh0X2Nsb3NlKGMpOwogCQkJZ290byBlcnI7CiAJCX0KIAotCQljbGllbnRbaV0uc2Ny
YXRjaFsxXSA9IGNyZWF0ZV9zY3JhdGNoKGMtPnZtLCAxMDI0KTsKKwkJY2xpZW50W2ldLnNjcmF0
Y2hbMV0gPSBjcmVhdGVfc2NyYXRjaCh2bSwgMTAyNCk7CiAJCWlmIChJU19FUlIoY2xpZW50W2ld
LnNjcmF0Y2hbMV0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzFdKTsK
IAkJCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZjbGllbnRbaV0uc2NyYXRjaFswXSwgMCk7
CisJCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjKTsKIAkJCWdv
dG8gZXJyOwogCQl9CiAKIAkJY2xpZW50W2ldLmN0eCA9IGM7CisJCWk5MTVfdm1fcHV0KHZtKTsK
IAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L3NjaGVkdWxlci5jCmluZGV4IDAzZjU2NzA4NDU0OC4uNjg1MGYxZjQwMjQxIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC0zNjUsNyArMzY1LDggQEAgc3RhdGlj
IHZvaWQgc2V0X2NvbnRleHRfcHBndHRfZnJvbV9zaGFkb3coc3RydWN0IGludGVsX3ZncHVfd29y
a2xvYWQgKndvcmtsb2FkLAogCQkJCQkgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7
CiAJc3RydWN0IGludGVsX3ZncHVfbW0gKm1tID0gd29ya2xvYWQtPnNoYWRvd19tbTsKLQlzdHJ1
Y3QgaTkxNV9wcGd0dCAqcHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pOworCXN0cnVj
dCBpOTE1X3BwZ3R0ICpwcGd0dCA9CisJCWk5MTVfdm1fdG9fcHBndHQoaTkxNV9nZW1fY29udGV4
dF9nZXRfdm1fcmN1KGN0eCkpOwogCWludCBpID0gMDsKIAogCWlmIChtbS0+cHBndHRfbW0ucm9v
dF9lbnRyeV90eXBlID09IEdUVF9UWVBFX1BQR1RUX1JPT1RfTDRfRU5UUlkpIHsKQEAgLTM3OCw2
ICszNzksOCBAQCBzdGF0aWMgdm9pZCBzZXRfY29udGV4dF9wcGd0dF9mcm9tX3NoYWRvdyhzdHJ1
Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQsCiAJCQlweF9kbWEocGQpID0gbW0tPnBw
Z3R0X21tLnNoYWRvd19wZHBzW2ldOwogCQl9CiAJfQorCisJaTkxNV92bV9wdXQoJnBwZ3R0LT52
bSk7CiB9CiAKIHN0YXRpYyBpbnQKQEAgLTEyMzAsMjAgKzEyMzMsMTggQEAgaW50IGludGVsX3Zn
cHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAlzdHJ1Y3QgaW50
ZWxfdmdwdV9zdWJtaXNzaW9uICpzID0gJnZncHUtPnN1Ym1pc3Npb247CiAJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisJc3Ry
dWN0IGk5MTVfcHBndHQgKnBwZ3R0OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGk7CiAJaW50IHJl
dDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0gaTkx
NV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlfTUFYKTsKLQlp
ZiAoSVNfRVJSKGN0eCkpIHsKLQkJcmV0ID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dF91bmxv
Y2s7Ci0JfQorCWlmIChJU19FUlIoY3R4KSkKKwkJcmV0dXJuIFBUUl9FUlIoY3R4KTsKIAogCWk5
MTVfZ2VtX2NvbnRleHRfc2V0X2ZvcmNlX3NpbmdsZV9zdWJtaXNzaW9uKGN0eCk7CiAKLQlpOTE1
X2NvbnRleHRfcHBndHRfcm9vdF9zYXZlKHMsIGk5MTVfdm1fdG9fcHBndHQoY3R4LT52bSkpOwor
CXBwZ3R0ID0gaTkxNV92bV90b19wcGd0dChpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4
KSk7CisJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBwcGd0dCk7CiAKIAlmb3JfZWFj
aF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpKSB7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsK
QEAgLTEyODgsMTIgKzEyODksMTIgQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihz
dHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAlhdG9taWNfc2V0KCZzLT5ydW5uaW5nX3dvcmtsb2Fk
X251bSwgMCk7CiAJYml0bWFwX3plcm8ocy0+dGxiX2hhbmRsZV9wZW5kaW5nLCBJOTE1X05VTV9F
TkdJTkVTKTsKIAorCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCWk5MTVfZ2VtX2NvbnRleHRf
cHV0KGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1
cm4gMDsKIAogb3V0X3NoYWRvd19jdHg6Ci0JaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3RfcmVzdG9y
ZShzLCBpOTE1X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pKTsKKwlpOTE1X2NvbnRleHRfcHBndHRfcm9v
dF9yZXN0b3JlKHMsIHBwZ3R0KTsKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpKSB7
CiAJCWlmIChJU19FUlIocy0+c2hhZG93W2ldKSkKIAkJCWJyZWFrOwpAQCAtMTMwMSw5ICsxMzAy
LDggQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAq
dmdwdSkKIAkJaW50ZWxfY29udGV4dF91bnBpbihzLT5zaGFkb3dbaV0pOwogCQlpbnRlbF9jb250
ZXh0X3B1dChzLT5zaGFkb3dbaV0pOwogCX0KKwlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIAlp
OTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kZWJ1Z2ZzLmMKaW5kZXggMGU5MGFjNjA4ZTA3Li5iMDRjZWJjMjZlY2EgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0zMTYsMTIgKzMxNiwxOCBAQCBzdGF0aWMgdm9p
ZCBwcmludF9jb250ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKIAkJCQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgZmlsZV9zdGF0cyBrc3RhdHMgPSB7fTsK
LQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHgsICpjbjsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmaTkxNS0+Y29udGV4dHMu
bGlzdCwgbGluaykgeworCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCWxp
c3RfZm9yX2VhY2hfZW50cnlfc2FmZShjdHgsIGNuLCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3Qs
IGxpbmspIHsKIAkJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKIAkJc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlOwogCisJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJmN0eC0+cmVm
KSkKKwkJCWNvbnRpbnVlOworCisJCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9j
ayk7CisKIAkJZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwKIAkJCQkgICAgaTkxNV9nZW1fY29udGV4
dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKIAkJCWludGVsX2NvbnRleHRfbG9ja19waW5uZWQo
Y2UpOwpAQCAtMzM4LDcgKzM0NCw5IEBAIHN0YXRpYyB2b2lkIHByaW50X2NvbnRleHRfc3RhdHMo
c3RydWN0IHNlcV9maWxlICptLAogCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0
eCk7CiAKIAkJaWYgKCFJU19FUlJfT1JfTlVMTChjdHgtPmZpbGVfcHJpdikpIHsKLQkJCXN0cnVj
dCBmaWxlX3N0YXRzIHN0YXRzID0geyAudm0gPSBjdHgtPnZtLCB9OworCQkJc3RydWN0IGZpbGVf
c3RhdHMgc3RhdHMgPSB7CisJCQkJLnZtID0gcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pLAor
CQkJfTsKIAkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSA9IGN0eC0+ZmlsZV9wcml2LT5maWxlOwog
CQkJc3RydWN0IHRhc2tfc3RydWN0ICp0YXNrOwogCQkJY2hhciBuYW1lWzgwXTsKQEAgLTM1NSw3
ICszNjMsMTIgQEAgc3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9zdGF0cyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sCiAKIAkJCXByaW50X2ZpbGVfc3RhdHMobSwgbmFtZSwgc3RhdHMpOwogCQl9CisKKwkJ
c3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJCWxpc3Rfc2FmZV9yZXNldF9u
ZXh0KGN0eCwgY24sIGxpbmspOworCQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwogCX0KKwlz
cGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCiAJcHJpbnRfZmlsZV9zdGF0
cyhtLCAiW2tdY29udGV4dHMiLCBrc3RhdHMpOwogfQpAQCAtMzYzLDcgKzM3Niw2IEBAIHN0YXRp
YyB2b2lkIHByaW50X2NvbnRleHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAogc3RhdGljIGlu
dCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0
ZSk7Ci0JaW50IHJldDsKIAogCXNlcV9wcmludGYobSwgIiV1IHNocmlua2FibGUgWyV1IGZyZWVd
IG9iamVjdHMsICVsbHUgYnl0ZXNcbiIsCiAJCSAgIGk5MTUtPm1tLnNocmlua19jb3VudCwKQEAg
LTM3MiwxMiArMzg0LDcgQEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIAlzZXFfcHV0YyhtLCAnXG4nKTsKIAotCXJldCA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYg
KHJldCkKLQkJcmV0dXJuIHJldDsKLQogCXByaW50X2NvbnRleHRfc3RhdHMobSwgaTkxNSk7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiAwOwogfQpA
QCAtMTU3OSwxOSArMTU4NiwxOSBAQCBzdGF0aWMgdm9pZCBkZXNjcmliZV9jdHhfcmluZyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKQogCiBzdGF0aWMgaW50IGk5
MTVfY29udGV4dF9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZh
dGUpOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKLQlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4OwotCWludCByZXQ7Ci0KLQlyZXQgPSBtdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoJmRldi0+c3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZh
dGUpOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsICpjbjsKIAotCWxpc3RfZm9yX2Vh
Y2hfZW50cnkoY3R4LCAmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QsIGxpbmspIHsKKwlzcGluX2xv
Y2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUo
Y3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0LCBsaW5rKSB7CiAJCXN0cnVjdCBpOTE1
X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAorCQlp
ZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCisJCQljb250aW51ZTsKKworCQlz
cGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJCXNlcV9wdXRzKG0sICJI
VyBjb250ZXh0ICIpOwogCQlpZiAoY3R4LT5waWQpIHsKIAkJCXN0cnVjdCB0YXNrX3N0cnVjdCAq
dGFzazsKQEAgLTE2MjYsOSArMTYzMywxMiBAQCBzdGF0aWMgaW50IGk5MTVfY29udGV4dF9zdGF0
dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJCWk5MTVfZ2VtX2NvbnRleHRf
dW5sb2NrX2VuZ2luZXMoY3R4KTsKIAogCQlzZXFfcHV0YyhtLCAnXG4nKTsKLQl9CiAKLQltdXRl
eF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKwkJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29u
dGV4dHMubG9jayk7CisJCWxpc3Rfc2FmZV9yZXNldF9uZXh0KGN0eCwgY24sIGxpbmspOworCQlp
OTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOworCX0KKwlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNv
bnRleHRzLmxvY2spOwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRl
eCA1MzIzZTRmYTU1ZDkuLjAyNGRhNTgyYmEwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBA
IC0xNjY1LDEwICsxNjY1LDggQEAgc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfcG9zdGNsb3NlKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsKIAot
CW11dGV4X2xvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9jb250ZXh0X2Nsb3Nl
KGZpbGUpOwogCWk5MTVfZ2VtX3JlbGVhc2UoZGV2LCBmaWxlKTsKLQltdXRleF91bmxvY2soJmRl
di0+c3RydWN0X211dGV4KTsKIAogCWtmcmVlX3JjdShmaWxlX3ByaXYsIHJjdSk7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oCmluZGV4IGNiNjNiMmJkMGNlOC4uMzViNjEwZDUyMzc5IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE1MzYsMjUgKzE1MzYsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSB7CiAJaW50IGF1ZGlvX3Bvd2VyX3JlZmNvdW50OwogCXUzMiBhdWRpb19mcmVxX2Nu
dHJsOwogCi0Jc3RydWN0IHsKLQkJc3RydWN0IG11dGV4IG11dGV4OwotCQlzdHJ1Y3QgbGlzdF9o
ZWFkIGxpc3Q7Ci0JCXN0cnVjdCBsbGlzdF9oZWFkIGZyZWVfbGlzdDsKLQkJc3RydWN0IHdvcmtf
c3RydWN0IGZyZWVfd29yazsKLQotCQkvKiBUaGUgaHcgd2FudHMgdG8gaGF2ZSBhIHN0YWJsZSBj
b250ZXh0IGlkZW50aWZpZXIgZm9yIHRoZQotCQkgKiBsaWZldGltZSBvZiB0aGUgY29udGV4dCAo
Zm9yIE9BLCBQQVNJRCwgZmF1bHRzLCBldGMpLgotCQkgKiBUaGlzIGlzIGxpbWl0ZWQgaW4gZXhl
Y2xpc3RzIHRvIDIxIGJpdHMuCi0JCSAqLwotCQlzdHJ1Y3QgaWRhIGh3X2lkYTsKLSNkZWZpbmUg
TUFYX0NPTlRFWFRfSFdfSUQgKDE8PDIxKSAvKiBleGNsdXNpdmUgKi8KLSNkZWZpbmUgTUFYX0dV
Q19DT05URVhUX0hXX0lEICgxIDw8IDIwKSAvKiBleGNsdXNpdmUgKi8KLSNkZWZpbmUgR0VOMTFf
TUFYX0NPTlRFWFRfSFdfSUQgKDE8PDExKSAvKiBleGNsdXNpdmUgKi8KLS8qIGluIEdlbjEyIElE
IDB4N0ZGIGlzIHJlc2VydmVkIHRvIGluZGljYXRlIGlkbGUgKi8KLSNkZWZpbmUgR0VOMTJfTUFY
X0NPTlRFWFRfSFdfSUQJKEdFTjExX01BWF9DT05URVhUX0hXX0lEIC0gMSkKLQkJc3RydWN0IGxp
c3RfaGVhZCBod19pZF9saXN0OwotCX0gY29udGV4dHM7Ci0KIAl1MzIgZmRpX3J4X2NvbmZpZzsK
IAogCS8qIFNoYWRvdyBmb3IgRElTUExBWV9QSFlfQ09OVFJPTCB3aGljaCBjYW4ndCBiZSBzYWZl
bHkgcmVhZCAqLwpAQCAtMTcxMCw2ICsxNjkxLDE0IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
IHsKIAogCXN0cnVjdCB7CiAJCXN0cnVjdCBub3RpZmllcl9ibG9jayBwbV9ub3RpZmllcjsKKwor
CQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgeworCQkJc3BpbmxvY2tfdCBsb2NrOyAvKiBsb2Nr
cyBsaXN0ICovCisJCQlzdHJ1Y3QgbGlzdF9oZWFkIGxpc3Q7CisKKwkJCXN0cnVjdCBsbGlzdF9o
ZWFkIGZyZWVfbGlzdDsKKwkJCXN0cnVjdCB3b3JrX3N0cnVjdCBmcmVlX3dvcms7CisJCX0gY29u
dGV4dHM7CiAJfSBnZW07CiAKIAkvKiBGb3IgaTk0NWdtIHZibGFuayBpcnEgdnMuIEMzIHdvcmth
cm91bmQgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDVhNjY0YmRlYWQ4Yy4uZjZkYjQx
NTk4NWQ1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEyNjYsNyArMTI2Niw3IEBAIGlu
dCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJZ290
byBlcnJfdW5sb2NrOwogCX0KIAotCXJldCA9IGk5MTVfZ2VtX2NvbnRleHRzX2luaXQoZGV2X3By
aXYpOworCXJldCA9IGk5MTVfZ2VtX2luaXRfY29udGV4dHMoZGV2X3ByaXYpOwogCWlmIChyZXQp
IHsKIAkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7CiAJCWdvdG8gZXJyX3NjcmF0Y2g7CkBAIC0x
MzQ4LDcgKzEzNDgsNyBAQCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJfQogZXJyX2NvbnRleHQ6CiAJaWYgKHJldCAhPSAtRUlPKQotCQlpOTE1
X2dlbV9jb250ZXh0c19maW5pKGRldl9wcml2KTsKKwkJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Vf
X2NvbnRleHRzKGRldl9wcml2KTsKIGVycl9zY3JhdGNoOgogCWludGVsX2d0X2RyaXZlcl9yZWxl
YXNlKCZkZXZfcHJpdi0+Z3QpOwogZXJyX3VubG9jazoKQEAgLTE0MTYsMTEgKzE0MTYsOSBAQCB2
b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZW1vdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIHsKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJaW50ZWxfZW5naW5lc19jbGVhbnVwKGRldl9wcml2KTsKLQlpOTE1X2dlbV9jb250ZXh0
c19maW5pKGRldl9wcml2KTsKKwlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2
X3ByaXYpOwogCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+Z3QpOwotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaW50ZWxfd2FfbGlzdF9m
cmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlzdCk7CiAKQEAgLTE0MzAsNyArMTQyOCw3IEBAIHZvaWQg
aTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhkZXZfcHJpdik7CiAKLQlXQVJOX09O
KCFsaXN0X2VtcHR5KCZkZXZfcHJpdi0+Y29udGV4dHMubGlzdCkpOworCVdBUk5fT04oIWxpc3Rf
ZW1wdHkoJmRldl9wcml2LT5nZW0uY29udGV4dHMubGlzdCkpOwogfQogCiB2b2lkIGk5MTVfZ2Vt
X2luaXRfbW1pbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZ3R0LmMKaW5kZXggMWQyNjYzNGNhNTk3Li43YjE1YmI4OTE5NzAgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0xMzY2LDcgKzEzNjYsOSBAQCBzdGF0aWMgaW50
IGdlbjhfaW5pdF9zY3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCWlmICh2
bS0+aGFzX3JlYWRfb25seSAmJgogCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQgJiYKIAkg
ICAgdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSkgewotCQlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICpjbG9uZSA9IHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dC0+dm07CisJCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKmNsb25lID0KKwkJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQo
dm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSwKKwkJCQkJCSAgdHJ1ZSk7IC8qIHN0YXRpYyAq
LwogCiAJCUdFTV9CVUdfT04oIWNsb25lLT5oYXNfcmVhZF9vbmx5KTsKIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmYuYwppbmRleCBlY2ZiYzM3YjczOGIuLjIzMTM4OGQwNmM4MiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMKQEAgLTE4NTMsOCArMTg1Myw4IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25m
aWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJfTsK
ICN1bmRlZiBjdHhfZmxleGV1TgogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCWludCBpOworCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsICpjbjsKKwlpbnQgaSwgZXJyOwogCiAJZm9yIChpID0gMjsgaSA8IEFSUkFZ
X1NJWkUocmVncyk7IGkrKykKIAkJcmVnc1tpXS52YWx1ZSA9IG9hX2NvbmZpZ19mbGV4X3JlZyhv
YV9jb25maWcsIHJlZ3NbaV0ucmVnKTsKQEAgLTE4NzcsMTYgKzE4NzcsMjcgQEAgc3RhdGljIGlu
dCBnZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0
cmVhbSwKIAkgKiBjb250ZXh0LiBDb250ZXh0cyBpZGxlIGF0IHRoZSB0aW1lIG9mIHJlY29uZmln
dXJhdGlvbiBhcmUgbm90CiAJICogdHJhcHBlZCBiZWhpbmQgdGhlIGJhcnJpZXIuCiAJICovCi0J
bGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7Ci0J
CWludCBlcnI7Ci0KKwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0
X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0LCBs
aW5rKSB7CiAJCWlmIChjdHggPT0gaTkxNS0+a2VybmVsX2NvbnRleHQpCiAJCQljb250aW51ZTsK
IAorCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCisJCQljb250aW51ZTsK
KworCQlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJCWVyciA9IGdl
bjhfY29uZmlndXJlX2NvbnRleHQoY3R4LCByZWdzLCBBUlJBWV9TSVpFKHJlZ3MpKTsKLQkJaWYg
KGVycikKKwkJaWYgKGVycikgeworCQkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAkJCXJl
dHVybiBlcnI7CisJCX0KKworCQlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsK
KwkJbGlzdF9zYWZlX3Jlc2V0X25leHQoY3R4LCBjbiwgbGluayk7CisJCWk5MTVfZ2VtX2NvbnRl
eHRfcHV0KGN0eCk7CiAJfQorCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7
CiAKIAkvKgogCSAqIEFmdGVyIHVwZGF0aW5nIGFsbCBvdGhlciBjb250ZXh0cywgd2UgbmVlZCB0
byBtb2RpZnkgb3Vyc2VsdmVzLgpAQCAtMTg5NSw3ICsxOTA2LDYgQEAgc3RhdGljIGludCBnZW44
X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwK
IAkgKi8KIAlmb3JfZWFjaF91YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpIHsKIAkJc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKLQkJaW50IGVycjsKIAog
CQlpZiAoZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xBU1MpCiAJCQljb250aW51ZTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfc3lzZnMuYwppbmRleCAwMzRiOGFiYzUwNjIuLjJhNzI0MDdhNjM4MCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYwpAQCAtMTQ0LDkgKzE0NCw5IEBAIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIG1lZGlhX3JjNl9hdHRyX2dyb3VwID0gewogfTsKICNl
bmRpZgogCi1zdGF0aWMgaW50IGwzX2FjY2Vzc192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIGxvZmZfdCBvZmZzZXQpCitzdGF0aWMgaW50IGwzX2FjY2Vzc192YWxpZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgbG9mZl90IG9mZnNldCkKIHsKLQlpZiAoIUhB
U19MM19EUEYoZGV2X3ByaXYpKQorCWlmICghSEFTX0wzX0RQRihpOTE1KSkKIAkJcmV0dXJuIC1F
UEVSTTsKIAogCWlmIChvZmZzZXQgJSA0ICE9IDApCkBAIC0xNjQsMzEgKzE2NCwyNCBAQCBpOTE1
X2wzX3JlYWQoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCSAgICAg
bG9mZl90IG9mZnNldCwgc2l6ZV90IGNvdW50KQogewogCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSBr
b2JqX3RvX2Rldihrb2JqKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBr
ZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZf
cHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl9taW5vcl90
b19pOTE1KGtkZXYpOwogCWludCBzbGljZSA9IChpbnQpKHVpbnRwdHJfdClhdHRyLT5wcml2YXRl
OwogCWludCByZXQ7CiAKLQljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOwotCi0JcmV0ID0g
bDNfYWNjZXNzX3ZhbGlkKGRldl9wcml2LCBvZmZzZXQpOworCXJldCA9IGwzX2FjY2Vzc192YWxp
ZChpOTE1LCBvZmZzZXQpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwljb3VudCA9IHJv
dW5kX2Rvd24oY291bnQsIDQpOwogCWNvdW50ID0gbWluX3Qoc2l6ZV90LCBHRU43X0wzTE9HX1NJ
WkUgLSBvZmZzZXQsIGNvdW50KTsKKwltZW1zZXQoYnVmLCAwLCBjb3VudCk7CiAKLQlyZXQgPSBp
OTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwotCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7Ci0KLQlpZiAoZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSkKKwlzcGlu
X2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlpZiAoaTkxNS0+bDNfcGFyaXR5LnJl
bWFwX2luZm9bc2xpY2VdKQogCQltZW1jcHkoYnVmLAotCQkgICAgICAgZGV2X3ByaXYtPmwzX3Bh
cml0eS5yZW1hcF9pbmZvW3NsaWNlXSArIChvZmZzZXQvNCksCisJCSAgICAgICBpOTE1LT5sM19w
YXJpdHkucmVtYXBfaW5mb1tzbGljZV0gKyBvZmZzZXQgLyA0LAogCQkgICAgICAgY291bnQpOwot
CWVsc2UKLQkJbWVtc2V0KGJ1ZiwgMCwgY291bnQpOwotCi0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0
cnVjdF9tdXRleCk7CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAog
CXJldHVybiBjb3VudDsKIH0KQEAgLTE5OSw0NiArMTkyLDQ2IEBAIGk5MTVfbDNfd3JpdGUoc3Ry
dWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCSAgICAgIGxvZmZfdCBvZmZz
ZXQsIHNpemVfdCBjb3VudCkKIHsKIAlzdHJ1Y3QgZGV2aWNlICprZGV2ID0ga29ial90b19kZXYo
a29iaik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl9taW5vcl90
b19pOTE1KGtkZXYpOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2
KTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCWludCBzbGljZSA9IChpbnQpKHVp
bnRwdHJfdClhdHRyLT5wcml2YXRlOwotCXUzMiAqKnJlbWFwX2luZm87CisJdTMyICpyZW1hcF9p
bmZvLCAqZnJlZW1lID0gTlVMTDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbDNfYWNjZXNzX3ZhbGlk
KGRldl9wcml2LCBvZmZzZXQpOworCXJldCA9IGwzX2FjY2Vzc192YWxpZChpOTE1LCBvZmZzZXQp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50
ZXJydXB0aWJsZShkZXYpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJcmVtYXBfaW5mbyA9
IGt6YWxsb2MoR0VON19MM0xPR19TSVpFLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXJlbWFwX2luZm8p
CisJCXJldHVybiAtRU5PTUVNOwogCi0JcmVtYXBfaW5mbyA9ICZkZXZfcHJpdi0+bDNfcGFyaXR5
LnJlbWFwX2luZm9bc2xpY2VdOwotCWlmICghKnJlbWFwX2luZm8pIHsKLQkJKnJlbWFwX2luZm8g
PSBremFsbG9jKEdFTjdfTDNMT0dfU0laRSwgR0ZQX0tFUk5FTCk7Ci0JCWlmICghKnJlbWFwX2lu
Zm8pIHsKLQkJCXJldCA9IC1FTk9NRU07Ci0JCQlnb3RvIG91dDsKLQkJfQorCXNwaW5fbG9jaygm
aTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCisJaWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9p
bmZvW3NsaWNlXSkgeworCQlmcmVlbWUgPSByZW1hcF9pbmZvOworCQlyZW1hcF9pbmZvID0gaTkx
NS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdOworCX0gZWxzZSB7CisJCWk5MTUtPmwzX3Bh
cml0eS5yZW1hcF9pbmZvW3NsaWNlXSA9IHJlbWFwX2luZm87CiAJfQogCi0JLyogVE9ETzogSWRl
YWxseSB3ZSByZWFsbHkgd2FudCBhIEdQVSByZXNldCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJvcnMK
LQkgKiBhcmVuJ3QgcHJvcGFnYXRlZC4gU2luY2UgSSBjYW5ub3QgZmluZCBhIHN0YWJsZSB3YXkg
dG8gcmVzZXQgdGhlIEdQVQotCSAqIGF0IHRoaXMgcG9pbnQgaXQgaXMgbGVmdCBhcyBhIFRPRE8u
Ci0JKi8KLQltZW1jcHkoKnJlbWFwX2luZm8gKyAob2Zmc2V0LzQpLCBidWYsIGNvdW50KTsKKwlj
b3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOworCW1lbWNweShyZW1hcF9pbmZvICsgb2Zmc2V0
IC8gNCwgYnVmLCBjb3VudCk7CiAKIAkvKiBOQjogV2UgZGVmZXIgdGhlIHJlbWFwcGluZyB1bnRp
bCB3ZSBzd2l0Y2ggdG8gdGhlIGNvbnRleHQgKi8KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwg
JmRldl9wcml2LT5jb250ZXh0cy5saXN0LCBsaW5rKQotCQljdHgtPnJlbWFwX3NsaWNlIHw9ICgx
PDxzbGljZSk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5nZW0uY29udGV4dHMu
bGlzdCwgbGluaykKKwkJY3R4LT5yZW1hcF9zbGljZSB8PSBCSVQoc2xpY2UpOwogCi0JcmV0ID0g
Y291bnQ7CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlrZnJlZShm
cmVlbWUpOwogCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJLyoK
KwkgKiBUT0RPOiBJZGVhbGx5IHdlIHJlYWxseSB3YW50IGEgR1BVIHJlc2V0IGhlcmUgdG8gbWFr
ZSBzdXJlIGVycm9ycworCSAqIGFyZW4ndCBwcm9wYWdhdGVkLiBTaW5jZSBJIGNhbm5vdCBmaW5k
IGEgc3RhYmxlIHdheSB0byByZXNldCB0aGUgR1BVCisJICogYXQgdGhpcyBwb2ludCBpdCBpcyBs
ZWZ0IGFzIGEgVE9ETy4KKwkgKi8KIAotCXJldHVybiByZXQ7CisJcmV0dXJuIGNvdW50OwogfQog
CiBzdGF0aWMgY29uc3Qgc3RydWN0IGJpbl9hdHRyaWJ1dGUgZHBmX2F0dHJzID0gewpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90cmFjZS5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV90cmFjZS5oCmluZGV4IDFmMmNmNmNmYWZiNS4uN2VmN2ExZTE2NjRjIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV90cmFjZS5oCkBAIC05NTIsNyArOTUyLDcgQEAgREVDTEFSRV9FVkVO
VF9DTEFTUyhpOTE1X2NvbnRleHQsCiAJVFBfZmFzdF9hc3NpZ24oCiAJCQlfX2VudHJ5LT5kZXYg
PSBjdHgtPmk5MTUtPmRybS5wcmltYXJ5LT5pbmRleDsKIAkJCV9fZW50cnktPmN0eCA9IGN0eDsK
LQkJCV9fZW50cnktPnZtID0gY3R4LT52bTsKKwkJCV9fZW50cnktPnZtID0gcmN1X2FjY2Vzc19w
b2ludGVyKGN0eC0+dm0pOwogCSksCiAKIAlUUF9wcmludGsoImRldj0ldSwgY3R4PSVwLCBjdHhf
dm09JXAiLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwppbmRleCAw
MzQ2YzNlNWI2YjYuLmJmYTQwYTViNmQ5OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtLmMKQEAgLTEzOCwxMSArMTM4LDkgQEAgc3RhdGljIGludCBpZ3RfZ2VtX3N1
c3BlbmQodm9pZCAqYXJnKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAogCWVyciA9IC1FTk9N
RU07Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2ZV9j
b250ZXh0KGk5MTUsIGZpbGUpOwogCWlmICghSVNfRVJSKGN0eCkpCiAJCWVyciA9IHN3aXRjaF90
b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIApAQCAtMTU3LDkgKzE1NSw3IEBAIHN0YXRp
YyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQgKmFyZykKIAogCXBtX3Jlc3VtZShpOTE1KTsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IHN3aXRjaF90b19j
b250ZXh0KGk5MTUsIGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwpAQCAt
MTc3LDExICsxNzMsOSBAQCBzdGF0aWMgaW50IGlndF9nZW1faGliZXJuYXRlKHZvaWQgKmFyZykK
IAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKIAllcnIgPSAtRU5PTUVNOwotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxl
KTsKIAlpZiAoIUlTX0VSUihjdHgpKQogCQllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBj
dHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVycikK
IAkJZ290byBvdXQ7CiAKQEAgLTE5Niw5ICsxOTAsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1faGli
ZXJuYXRlKHZvaWQgKmFyZykKIAogCXBtX3Jlc3VtZShpOTE1KTsKIAotCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IHN3aXRjaF90b19jb250ZXh0KGk5MTUsIGN0
eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIG91dDoKIAltb2Nr
X2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwppbmRleCBmMzlmMDI4MmU3OGMuLjBh
ZjlhNThkMDExZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2V2aWN0LmMKQEAgLTQ3Myw3ICs0NzMsNiBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250
ZXh0cyh2b2lkICphcmcpCiAJCX0KIAogCQljb3VudCA9IDA7Ci0JCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlvbnN0YWNrX2ZlbmNlX2luaXQoJmZlbmNlKTsKIAkJZG8g
ewogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC01MTAsOCArNTA5LDYgQEAgc3RhdGlj
IGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCQkJY291bnQrKzsKIAkJCWVyciA9
IDA7CiAJCX0gd2hpbGUoMSk7Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7CiAJCXByX2luZm8oIlN1Ym1pdHRl
ZCAlbHUgY29udGV4dHMvcmVxdWVzdHMgb24gJXNcbiIsCiAJCQljb3VudCwgZW5naW5lLT5uYW1l
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9n
dHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwppbmRl
eCBlNDBlNmNmYTUxZjEuLjhkODEyMWMwMjE2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwpAQCAtMTI0Niw2ICsxMjQ2LDcgQEAgc3RhdGljIGlu
dCBleGVyY2lzZV9tb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAg
dW5zaWduZWQgbG9uZyBlbmRfdGltZSkpCiB7CiAJY29uc3QgdTY0IGxpbWl0ID0gdG90YWxyYW1f
cGFnZXMoKSA8PCBQQUdFX1NISUZUOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwog
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwog
CWludCBlcnI7CkBAIC0xMjU0LDcgKzEyNTUsOSBAQCBzdGF0aWMgaW50IGV4ZXJjaXNlX21vY2so
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKCFjdHgpCiAJCXJldHVybiAtRU5P
TUVNOwogCi0JZXJyID0gZnVuYyhpOTE1LCBjdHgtPnZtLCAwLCBtaW4oY3R4LT52bS0+dG90YWws
IGxpbWl0KSwgZW5kX3RpbWUpOworCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0
eCk7CisJZXJyID0gZnVuYyhpOTE1LCB2bSwgMCwgbWluKHZtLT50b3RhbCwgbGltaXQpLCBlbmRf
dGltZSk7CisJaTkxNV92bV9wdXQodm0pOwogCiAJbW9ja19jb250ZXh0X2Nsb3NlKGN0eCk7CiAJ
cmV0dXJuIGVycjsKQEAgLTE4MDEsMTUgKzE4MDQsMTUgQEAgc3RhdGljIGludCBpZ3RfY3NfdGxi
KHZvaWQgKmFyZykKIAkJZ290byBvdXRfdW5sb2NrOwogCX0KIAotCXZtID0gY3R4LT52bTsKLQlp
ZiAoIXZtKQotCQlnb3RvIG91dF91bmxvY2s7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92
bV9yY3UoY3R4KTsKKwlpZiAoaTkxNV9pc19nZ3R0KHZtKSkKKwkJZ290byBvdXRfdm07CiAKIAkv
KiBDcmVhdGUgdHdvIHBhZ2VzOyBkdW1teSB3ZSBwcmVmaWxsIHRoZSBUTEIsIGFuZCBpbnRlbmRl
ZCAqLwogCWJiZSA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9T
SVpFKTsKIAlpZiAoSVNfRVJSKGJiZSkpIHsKIAkJZXJyID0gUFRSX0VSUihiYmUpOwotCQlnb3Rv
IG91dF91bmxvY2s7CisJCWdvdG8gb3V0X3ZtOwogCX0KIAogCWJhdGNoID0gaTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9tYXAoYmJlLCBJOTE1X01BUF9XQyk7CkBAIC0yMDE0LDYgKzIwMTcsOCBAQCBzdGF0
aWMgaW50IGlndF9jc190bGIodm9pZCAqYXJnKQogCWk5MTVfZ2VtX29iamVjdF9wdXQoYWN0KTsK
IG91dF9wdXRfYmJlOgogCWk5MTVfZ2VtX29iamVjdF9wdXQoYmJlKTsKK291dF92bToKKwlpOTE1
X3ZtX3B1dCh2bSk7CiBvdXRfdW5sb2NrOgogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggZDdkNjhjNmE2YmQ1Li4wODk3
YTdiMDQ5NDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1
ZXN0LmMKQEAgLTE4MSw5ICsxODEsNyBAQCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2
b2lkICphcmcpCiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCWludCBlcnIgPSAtRUlOVkFM
OwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4WzBdID0gbW9j
a19jb250ZXh0KGk5MTUsICJBIik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAogCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eFswXSwgUkNTMCk7
CiAJR0VNX0JVR19PTihJU19FUlIoY2UpKTsKQEAgLTE5Nyw5ICsxOTUsNyBAQCBzdGF0aWMgaW50
IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJaTkxNV9yZXF1ZXN0X2dldChyZXF1ZXN0
KTsKIAlpOTE1X3JlcXVlc3RfYWRkKHJlcXVlc3QpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJY3R4WzFdID0gbW9ja19jb250ZXh0KGk5MTUsICJCIik7Ci0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWNlID0gaTkxNV9nZW1fY29u
dGV4dF9nZXRfZW5naW5lKGN0eFsxXSwgUkNTMCk7CiAJR0VNX0JVR19PTihJU19FUlIoY2UpKTsK
QEAgLTQzOCw5ICs0MzQsNyBAQCBzdGF0aWMgaW50IG1vY2tfYnJlYWRjcnVtYnNfc21va2V0ZXN0
KHZvaWQgKmFyZykKIAl9CiAKIAlmb3IgKG4gPSAwOyBuIDwgdC5uY29udGV4dHM7IG4rKykgewot
CQltdXRleF9sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXQuY29u
dGV4dHNbbl0gPSBtb2NrX2NvbnRleHQodC5lbmdpbmUtPmk5MTUsICJtb2NrIik7Ci0JCW11dGV4
X3VubG9jaygmdC5lbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoIXQuY29u
dGV4dHNbbl0pIHsKIAkJCXJldCA9IC1FTk9NRU07CiAJCQlnb3RvIG91dF9jb250ZXh0czsKQEAg
LTczNCw5ICs3MjgsOSBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcp
CiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0Y2goc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGk5MTUt
Pmtlcm5lbF9jb250ZXh0OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52
bSA/OiAmaTkxNS0+Z2d0dC52bTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwog
CWNvbnN0IGludCBnZW4gPSBJTlRFTF9HRU4oaTkxNSk7CisJc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm07CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMyICpjbWQ7CiAJaW50IGVycjsK
QEAgLTc0NSw3ICs3MzksOSBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0
Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaWYgKElTX0VSUihvYmopKQogCQly
ZXR1cm4gRVJSX0NBU1Qob2JqKTsKIAorCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1
KGN0eCk7CiAJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CisJaTkxNV92
bV9wdXQodm0pOwogCWlmIChJU19FUlIodm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJ
CWdvdG8gZXJyOwpAQCAtMTIyMCw5ICsxMjE2LDcgQEAgc3RhdGljIGludCBsaXZlX2JyZWFkY3J1
bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJfQogCiAJZm9yIChuID0gMDsgbiA8IHRbMF0ubmNv
bnRleHRzOyBuKyspIHsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
CXRbMF0uY29udGV4dHNbbl0gPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7Ci0JCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmICghdFswXS5jb250ZXh0c1tuXSkg
ewogCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8gb3V0X2NvbnRleHRzOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwppbmRleCBhYzFmZjU1OGViOTAuLjU4YjVmNDBh
MDdkZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1h
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKQEAgLTI0
LDYgKzI0LDcgQEAKIAogI2luY2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4KIAorI2luY2x1
ZGUgImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2Nr
X2NvbnRleHQuaCIKIAogI2luY2x1ZGUgImk5MTVfc2NhdHRlcmxpc3QuaCIKQEAgLTM4LDcgKzM5
LDcgQEAgc3RhdGljIGJvb2wgYXNzZXJ0X3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIHsKIAli
b29sIG9rID0gdHJ1ZTsKIAotCWlmICh2bWEtPnZtICE9IGN0eC0+dm0pIHsKKwlpZiAodm1hLT52
bSAhPSByY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpIHsKIAkJcHJfZXJyKCJWTUEgY3JlYXRl
ZCB3aXRoIHdyb25nIFZNXG4iKTsKIAkJb2sgPSBmYWxzZTsKIAl9CkBAIC0xMTMsMTEgKzExNCwx
MyBAQCBzdGF0aWMgaW50IGNyZWF0ZV92bWFzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLCBvYmplY3RzLCBzdF9saW5rKSB7CiAJCWZvciAo
cGlubmVkID0gMDsgcGlubmVkIDw9IDE7IHBpbm5lZCsrKSB7CiAJCQlsaXN0X2Zvcl9lYWNoX2Vu
dHJ5KGN0eCwgY29udGV4dHMsIGxpbmspIHsKLQkJCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSA9IGN0eC0+dm07CisJCQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJCQkJ
c3RydWN0IGk5MTVfdm1hICp2bWE7CiAJCQkJaW50IGVycjsKIAorCQkJCXZtID0gaTkxNV9nZW1f
Y29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CiAJCQkJdm1hID0gY2hlY2tlZF92bWFfaW5zdGFuY2Uo
b2JqLCB2bSwgTlVMTCk7CisJCQkJaTkxNV92bV9wdXQodm0pOwogCQkJCWlmIChJU19FUlIodm1h
KSkKIAkJCQkJcmV0dXJuIFBUUl9FUlIodm1hKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCmluZGV4IDRlNmNkZTBkNDg1OS4uMzM1ZjM3
YmE5OGRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19n
ZW1fZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2Vt
X2RldmljZS5jCkBAIC01OSwxMSArNTksOSBAQCBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9yZWxl
YXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIAlpOTE1X2dlbV9kcmFpbl93b3JrcXVldWUo
aTkxNSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmb3JfZWFj
aF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJbW9ja19lbmdpbmVfZnJlZShlbmdpbmUpOwot
CWk5MTVfZ2VtX2NvbnRleHRzX2ZpbmkoaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKKwlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7
CiAKIAlpbnRlbF90aW1lbGluZXNfZmluaShpOTE1KTsKIApAQCAtMjA2LDcgKzIwNCw3IEBAIHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9kZXZpY2Uodm9pZCkKIAlyZXR1cm4gaTkx
NTsKIAogZXJyX2NvbnRleHQ6Ci0JaTkxNV9nZW1fY29udGV4dHNfZmluaShpOTE1KTsKKwlpOTE1
X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7CiBlcnJfZW5naW5lOgogCW1vY2tf
ZW5naW5lX2ZyZWUoaTkxNS0+ZW5naW5lW1JDUzBdKTsKIGVycl91bmxvY2s6Ci0tIAoyLjIzLjAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

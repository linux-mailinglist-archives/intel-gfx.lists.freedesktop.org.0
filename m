Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 93035F4D86
	for <lists+intel-gfx@lfdr.de>; Fri,  8 Nov 2019 14:47:50 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D70366F993;
	Fri,  8 Nov 2019 13:47:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1CF7D6F993
 for <intel-gfx@lists.freedesktop.org>; Fri,  8 Nov 2019 13:47:46 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 08 Nov 2019 05:47:46 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,281,1569308400"; d="scan'208";a="196904294"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by orsmga008.jf.intel.com with ESMTP; 08 Nov 2019 05:47:41 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  8 Nov 2019 15:45:00 +0200
Message-Id: <20191108134500.29212-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6] drm/i915: Enable second dbuf slice for ICL
 and TGL
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxzbyBpbXBsZW1lbnRlZCBhbGdvcml0aG0gZm9yIGNob29zaW5nIERCdWYgc2xpY2UgY29uZmln
dXJhdGlvbgpiYXNlZCBvbiBhY3RpdmUgcGlwZXMsIHBpcGUgcmF0aW8gYXMgc3RhdGVkIGluIEJT
cGVjIDEyNzE2LgoKTm93IHBpcGUgYWxsb2NhdGlvbiBzdGlsbCBzdGF5cyBwcm9wb3J0aW9uYWwg
dG8gcGlwZSB3aWR0aCBhcyBiZWZvcmUsCmhvd2V2ZXIgd2l0aGluIGFsbG93ZWQgREJ1ZiBzbGlj
ZSBmb3IgdGhpcyBwYXJ0aWN1bGFyIGNvbmZpZ3VyYXRpb24uCgp2MjogUmVtb3ZlIHVubmVlZGVk
IGNoZWNrIGZyb20gY29tbWl0IGFzIGRkYiBlbmFibGVkIHNsaWNlcyBtaWdodAogICAgbm93IGRp
ZmZlciBmcm9tIGh3IHN0YXRlLgoKdjM6IC0gQWRkZWQgbmV3IGZpZWxkICJzdXBwb3J0ZWRfc2xp
Y2VzIiB0byBkZGIgdG8gc2VwYXJhdGUgbWF4CiAgICAgIHN1cHBvcnRlZCBzbGljZXMgdnMgY3Vy
cmVudGx5IGVuYWJsZWQsIHRvIGF2b2lkIGNvbmZ1c2lvbi4KICAgIC0gUmVtb3ZlZCBvYnNvbGV0
ZSBjb21tZW50cyBhbmQgY29kZSByZWxhdGVkIHRvIERCdWYoTWF0dGhldyBSb3BlcikuCiAgICAt
IFNvbWUgY29kZSBzdHlsZSBhbmQgbG9uZyBsaW5lIHJlbW92YWwoTWF0dGhldyBSb3BlcikuCiAg
ICAtIEFkZGVkIFdBUk5fT04gdG8gbmV3IGRkYiByYW5nZSBvZmZzZXQgY2FsYyBmdW5jdGlvbihN
YXR0aGV3IFJvcGVyKS4KICAgIC0gUmVtb3ZlZCBwbGF0Zm9ybSBzcGVjaWZpYyBjYWxsIHRvIGNh
bGMgcGlwZSByYXRpbyBmcm9tIGRkYgogICAgICBhbGxvY2F0aW9uIGZ1bmN0aW9uIGFuZCBmaXhl
ZCB0aGUgcmV0dXJuIHZhbHVlKE1hdHRoZXcgUm9wZXIpCiAgICAtIFJlZmFjdG9yZWQgREJVRiBz
bGljZSBhbGxvY2F0aW9uIHRhYmxlIHRvIGltcHJvdmUgcmVhZGFiaWxpdHkKICAgIC0gQWRkZWQg
REJVRiBzbGljZSBhbGxvY2F0aW9uIGZvciBUR0wgYXMgd2VsbC4KICAgIC0gSUNMKGhvd2V2ZXIg
bm90IFRHTCkgc2VlbXMgdG8gdm9sdW50YXJpbHkgZW5hYmxlIHNlY29uZCBEQnVmIHNsaWNlCiAg
ICAgIGFmdGVyIHBtIHN1c3BlbmQvcmVzdW1lIGNhdXNpbmcgYSBtaXNtYXRjaCBmYWlsdXJlLCBi
ZWNhdXNlIHdlCiAgICAgIHVwZGF0ZSBEQnVmIHNsaWNlcyBvbmx5IGlmIHdlIGRvIGEgbW9kZXNl
dCwgaG93ZXZlciB0aGlzIGNoZWNrCiAgICAgIGlzIGRvbmUgYWx3YXlzLiBGaXhlZCBpdCB0byBi
ZSBkb25lIG9ubHkgd2hlbiBtb2Rlc2V0IGZvciBJQ0wuCgp2NDogLSBOb3cgZW5hYmxlZCBzbGlj
ZXMgaXMgbm90IGFjdHVhbGx5IGEgbnVtYmVyLCBidXQgYSBiaXRtYXNrLAogICAgICBiZWNhdXNl
IHdlIG1pZ2h0IG5lZWQgdG8gZW5hYmxlIHNlY29uZCBzbGljZSBvbmx5IGFuZCBudW1iZXIKICAg
ICAgb2Ygc2xpY2VzIHdvdWxkIHN0aWxsIDEgYW5kIHRoYXQgY3VycmVudCBjb2RlIGRvZXNuJ3Qg
YWxsb3cuCiAgICAtIFJlbW92ZSByZWR1bmRhbnQgZHVwbGljYXRlIGNvZGUgdG8gaGF2ZSBzb21l
IHVuaWZpZWQgd2F5IG9mCiAgICAgIGVuYWJsaW5nIGRidWYgc2xpY2VzIGluc3RlYWQgb2YgaGFy
ZGNvZGluZy4KCnY1OiAtIEZpeCBmYWlsaW5nIGdlbjlfYXNzZXJ0X2RidWZfZW5hYmxlZCBhcyBp
dCB3YXMgbmFpdmVseSB0aGlua2luZwogICAgICB0aGF0IHdlIGhhdmUgb25seSBvbmUgREJVRl9D
VEwgc2xpY2UuIE5vdyBhbm90aGVyIHZlcnNpb24gZm9yCiAgICAgIGdlbjExIHdpbGwgY2hlY2sg
Ym90aCBzbGljZXMgYXMgb25seSBzZWNvbmQgb25lIGNhbiBiZSBlbmFibGVkLAogICAgICB0byBr
ZWVwIENJIGhhcHB5LgoKdjY6IC0gUmVtb3ZlZCBlbmFibGVkIGRidWYgYXNzZXJ0aW9uIGNvbXBs
ZXRlbHkuIFByZXZpb3VzIGNvZGUKICAgICAgd2FzIGtlZXBpbmcgZGJ1ZiBlbmFibGVkLCBldmVu
KCEpIHdoZW4gX2RidWZfZGlzYWJsZSBpcyBjYWxsZWQuCiAgICAgIEN1cnJlbnRseSB3ZSBlbmFi
bGUvZGlzYWJsZSBkYnVmIHNsaWNlcyBiYXNlZCBvbiByZXF1cmVtZW50CiAgICAgIHNvIG5vIHBv
aW50IGluIGFzc2VydGluZyB0aGlzIGhlcmUuCiAgICAtIFJlbW92ZWQgdW5uZWNlc3NhcnkgbW9k
ZXNldCBjaGVjayBmcm9tIHZlcmlmeV93bV9zdGF0ZShNYXR0aGV3IFJvcGVyKQogICAgLSBTbGlj
ZXMgaW50ZXJzZWN0aW9uIGFmdGVyIHVuaW9uIGlzIHNhbWUgYXMgZmluYWwgcmVzdWx0KE1hdHRo
ZXcgUm9wZXIpCiAgICAtIE1vdmVkIERCdWYgc2xpY2VzIHRvIGludGVsX2RldmljZV9pbmZvKE1h
dHRoZXcgUm9wZXIpCiAgICAtIFNvbWUgbWFjcm9zIGFkZGVkKE1hdHRoZXcgUm9wZXIpCiAgICAt
IGRkYiByYW5nZSBpcyBub3cgYWx3YXlzIGxlc3Mgb3IgZXF1YWwgdG8gZGRiIHNpemUgLSBubyBu
ZWVkIGZvciBhZGRpdGlvbmFsCiAgICAgIGNoZWNrcyhwcmV2aW91c2x5IG5lZWRlZCBhcyB3ZSBo
YWQgc29tZSBiYW5kd2lkdGggY2hlY2tzIGluIHRoZXJlIHdoaWNoCiAgICAgIGNvdWxkICJzdWRk
ZW5seSIgcmV0dXJuIGRkYl9zaXplIHNtYWxsZXIgdGhhbiBpdCBpcy4KClNpZ25lZC1vZmYtYnk6
IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwuY29tPgpDYzog
TWF0dGhldyBSb3BlciA8bWF0dGhldy5kLnJvcGVyQGludGVsLmNvbT4KQ2M6IFZpbGxlIFN5cmrD
pGzDpCA8dmlsbGUuc3lyamFsYUBpbnRlbC5jb20+CkNjOiBKYW1lcyBBdXNtdXMgPGphbWVzLmF1
c211c0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMgIHwgIDI2ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bv
d2VyLmMgICAgfCAgOTggKystLS0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
cG93ZXIuaCAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAg
ICAgICAgICAgfCAgIDUgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAg
ICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jICAgICAgICAg
ICAgICAgfCAgIDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAg
ICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uaCAg
ICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAg
ICB8IDM4NCArKysrKysrKysrKysrKysrLS0KIDkgZmlsZXMgY2hhbmdlZCwgNDI5IGluc2VydGlv
bnMoKyksIDEwNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheS5jCmluZGV4IDg3NmZjMjU5NjhiZi4uYmQ3YWZmNjc1MTk4IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTMzODcsNyAr
MTMzODcsNyBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgogCSAgICBody0+ZGRi
LmVuYWJsZWRfc2xpY2VzICE9IHN3X2RkYi0+ZW5hYmxlZF9zbGljZXMpCi0JCURSTV9FUlJPUigi
bWlzbWF0Y2ggaW4gREJVRiBTbGljZXMgKGV4cGVjdGVkICV1LCBnb3QgJXUpXG4iLAorCQlEUk1f
RVJST1IoIm1pc21hdGNoIGluIERCVUYgU2xpY2VzIChleHBlY3RlZCAleCwgZ290ICV4KVxuIiwK
IAkJCSAgc3dfZGRiLT5lbmFibGVkX3NsaWNlcywKIAkJCSAgaHctPmRkYi5lbmFibGVkX3NsaWNl
cyk7CiAKQEAgLTE0NjE0LDE1ICsxNDYxNCwyNCBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0X21v
ZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAl1OCBod19l
bmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzOwog
CXU4IHJlcXVpcmVkX3NsaWNlcyA9IHN0YXRlLT53bV9yZXN1bHRzLmRkYi5lbmFibGVkX3NsaWNl
czsKIAlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBlbnRyaWVzW0k5MTVfTUFYX1BJUEVTXSA9IHt9Owor
CXU4IHNsaWNlc191bmlvbiA9IGh3X2VuYWJsZWRfc2xpY2VzIHwgcmVxdWlyZWRfc2xpY2VzOwor
CXU4IHNsaWNlc19pbnRlcnNlY3Rpb24gPSByZXF1aXJlZF9zbGljZXM7CiAKIAlmb3JfZWFjaF9v
bGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsIG5l
d19jcnRjX3N0YXRlLCBpKQogCQkvKiBpZ25vcmUgYWxsb2NhdGlvbnMgZm9yIGNydGMncyB0aGF0
IGhhdmUgYmVlbiB0dXJuZWQgb2ZmLiAqLwogCQlpZiAobmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2
ZSkKIAkJCWVudHJpZXNbaV0gPSBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsKIAotCS8qIElm
IDJuZCBEQnVmIHNsaWNlIHJlcXVpcmVkLCBlbmFibGUgaXQgaGVyZSAqLwotCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA+IGh3X2VuYWJsZWRfc2xpY2Vz
KQotCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOwor
CURSTV9ERUJVR19LTVMoIkRCdWYgcmVxIHNsaWNlcyAlZCBodyBzbGljZXMgJWRcbiIsCisJCSAg
ICAgIHJlcXVpcmVkX3NsaWNlcywgaHdfZW5hYmxlZF9zbGljZXMpOworCisJLyoKKwkgKiBJZiBz
b21lIG90aGVyIERCdWYgc2xpY2UgcmVxdWlyZWQsIGVuYWJsZSBpdCBoZXJlLAorCSAqIGFzIGhl
cmUgd2Ugb25seSBhZGQgbW9yZSBzbGljZXMsIGJ1dCBub3QgcmVtb3ZlIHRvIHByZXZlbnQKKwkg
KiBpc3N1ZXMgaWYgc29tZWJvZHkgc3RpbGwgdXNlcyB0aG9zZS4KKwkgKi8KKwlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9zbGljZXMgIT0gaHdfZW5hYmxlZF9zbGlj
ZXMpCisJCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIHNsaWNlc191bmlvbik7CiAK
IAkvKgogCSAqIFdoZW5ldmVyIHRoZSBudW1iZXIgb2YgYWN0aXZlIHBpcGVzIGNoYW5nZXMsIHdl
IG5lZWQgdG8gbWFrZSBzdXJlIHdlCkBAIC0xNDY4MSw5ICsxNDY5MCwxMiBAQCBzdGF0aWMgdm9p
ZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAkJfQogCX0gd2hpbGUgKHByb2dyZXNzKTsKIAotCS8qIElmIDJuZCBEQnVmIHNsaWNl
IGlzIG5vIG1vcmUgcmVxdWlyZWQgZGlzYWJsZSBpdCAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA8IGh3X2VuYWJsZWRfc2xpY2VzKQotCQlpY2xf
ZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOworCS8qCisJICog
SWYgc29tZSBvdGhlciBEQnVmIHNsaWNlIGlzIG5vdCBuZWVkZWQsIGRpc2FibGUgaXQgaGVyZSwK
KwkgKiBhcyBoZXJlIHdlIG9ubHkgcmVtb3ZlIHNsaWNlcywgd2hpY2ggYXJlIG5vdCBuZWVkZWQg
YW55bW9yZS4KKwkgKi8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJl
ZF9zbGljZXMgIT0gaHdfZW5hYmxlZF9zbGljZXMpCisJCWljbF9kYnVmX3NsaWNlc191cGRhdGUo
ZGV2X3ByaXYsIHNsaWNlc19pbnRlcnNlY3Rpb24pOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9h
dG9taWNfaGVscGVyX2ZyZWVfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
X3Bvd2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93
ZXIuYwppbmRleCBjZTFiNjRmNGRkNDQuLmY0MDZlZTUzMjliMCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKQEAgLTEwMzEsMTUg
KzEwMzEsNiBAQCBzdGF0aWMgYm9vbCBnZW45X2RjX29mZl9wb3dlcl93ZWxsX2VuYWJsZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkoSTkxNV9SRUFEKERDX1NUQVRFX0VO
KSAmIERDX1NUQVRFX0VOX1VQVE9fREM1X0RDNl9NQVNLKSA9PSAwKTsKIH0KIAotc3RhdGljIHZv
aWQgZ2VuOV9hc3NlcnRfZGJ1Zl9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKLXsKLQl1MzIgdG1wID0gSTkxNV9SRUFEKERCVUZfQ1RMKTsKLQotCVdBUk4oKHRtcCAm
IChEQlVGX1BPV0VSX1NUQVRFIHwgREJVRl9QT1dFUl9SRVFVRVNUKSkgIT0KLQkgICAgIChEQlVG
X1BPV0VSX1NUQVRFIHwgREJVRl9QT1dFUl9SRVFVRVNUKSwKLQkgICAgICJVbmV4cGVjdGVkIERC
dWYgcG93ZXIgcG93ZXIgc3RhdGUgKDB4JTA4eClcbiIsIHRtcCk7Ci19Ci0KIHN0YXRpYyB2b2lk
IGdlbjlfZGlzYWJsZV9kY19zdGF0ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogewogCXN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSBjZGNsa19zdGF0ZSA9IHt9OwpAQCAtMTA1
NSw4ICsxMDQ2LDYgQEAgc3RhdGljIHZvaWQgZ2VuOV9kaXNhYmxlX2RjX3N0YXRlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJLyogQ2FuJ3QgcmVhZCBvdXQgdm9sdGFnZV9s
ZXZlbCBzbyBjYW4ndCB1c2UgaW50ZWxfY2RjbGtfY2hhbmdlZCgpICovCiAJV0FSTl9PTihpbnRl
bF9jZGNsa19uZWVkc19tb2Rlc2V0KCZkZXZfcHJpdi0+Y2RjbGsuaHcsICZjZGNsa19zdGF0ZSkp
OwogCi0JZ2VuOV9hc3NlcnRfZGJ1Zl9lbmFibGVkKGRldl9wcml2KTsKLQogCWlmIChJU19HRU45
X0xQKGRldl9wcml2KSkKIAkJYnh0X3ZlcmlmeV9kZGlfcGh5X3Bvd2VyX3dlbGxzKGRldl9wcml2
KTsKIApAQCAtNDI1NCwzMSArNDI0Myw1MSBAQCBzdGF0aWMgdm9pZCBnZW45X2RidWZfZGlzYWJs
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaW50ZWxfZGJ1Zl9zbGljZV9z
ZXQoZGV2X3ByaXYsIERCVUZfQ1RMLCBmYWxzZSk7CiB9CiAKLXN0YXRpYyB1OCBpbnRlbF9kYnVm
X21heF9zbGljZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoraW50IGludGVs
X2RidWZfbWF4X3NsaWNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKLQkJcmV0dXJuIDE7Ci0JcmV0dXJuIDI7CisJ
cmV0dXJuIElOVEVMX0lORk8oZGV2X3ByaXYpLT5zdXBwb3J0ZWRfc2xpY2VzOworfQorCit2b2lk
IGljbF9kYnVmX3NsaWNlc19yZXN0b3JlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKK3sKKwljb25zdCB1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT53bS5za2xfaHcu
ZGRiLmVuYWJsZWRfc2xpY2VzOworCisJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwg
aHdfZW5hYmxlZF9zbGljZXMpOwogfQogCiB2b2lkIGljbF9kYnVmX3NsaWNlc191cGRhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICAgIHU4IHJlcV9zbGljZXMpCiB7
Ci0JY29uc3QgdTggaHdfZW5hYmxlZF9zbGljZXMgPSBkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5l
bmFibGVkX3NsaWNlczsKLQlib29sIHJldDsKKwlib29sIHJldCA9IHRydWU7CisJaW50IGk7CisJ
aW50IG1heF9zbGljZXMgPSBpbnRlbF9kYnVmX21heF9zbGljZXMoZGV2X3ByaXYpOwogCi0JaWYg
KHJlcV9zbGljZXMgPiBpbnRlbF9kYnVmX21heF9zbGljZXMoZGV2X3ByaXYpKSB7CisJaWYgKGh3
ZWlnaHQ4KHJlcV9zbGljZXMpID4gaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKGRldl9wcml2KSkgewog
CQlEUk1fRVJST1IoIkludmFsaWQgbnVtYmVyIG9mIGRidWYgc2xpY2VzIHJlcXVlc3RlZFxuIik7
CiAJCXJldHVybjsKIAl9CiAKLQlpZiAocmVxX3NsaWNlcyA9PSBod19lbmFibGVkX3NsaWNlcyB8
fCByZXFfc2xpY2VzID09IDApCi0JCXJldHVybjsKKwlEUk1fREVCVUdfS01TKCJVcGRhdGluZyBk
YnVmIHNsaWNlcyB0byAleFxuIiwgcmVxX3NsaWNlcyk7CiAKLQlpZiAocmVxX3NsaWNlcyA+IGh3
X2VuYWJsZWRfc2xpY2VzKQotCQlyZXQgPSBpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwg
REJVRl9DVExfUzIsIHRydWUpOwotCWVsc2UKLQkJcmV0ID0gaW50ZWxfZGJ1Zl9zbGljZV9zZXQo
ZGV2X3ByaXYsIERCVUZfQ1RMX1MyLCBmYWxzZSk7CisJZm9yIChpID0gMDsgaSA8IG1heF9zbGlj
ZXM7IGkrKykgeworCQlpbnQgc2xpY2VfYml0ID0gQklUKGkpOworCQlib29sIHNsaWNlX3NldCA9
IChzbGljZV9iaXQgJiByZXFfc2xpY2VzKSAhPSAwOworCisJCXN3aXRjaCAoc2xpY2VfYml0KSB7
CisJCWNhc2UgREJVRl9TMV9CSVQ6CisJCQlyZXQgPSByZXQgJiYgaW50ZWxfZGJ1Zl9zbGljZV9z
ZXQoZGV2X3ByaXYsCisJCQkJCQkJICBEQlVGX0NUTF9TMSwKKwkJCQkJCQkgIHNsaWNlX3NldCk7
CisJCQlicmVhazsKKwkJY2FzZSBEQlVGX1MyX0JJVDoKKwkJCXJldCA9IHJldCAmJiBpbnRlbF9k
YnVmX3NsaWNlX3NldChkZXZfcHJpdiwKKwkJCQkJCQkgIERCVUZfQ1RMX1MyLAorCQkJCQkJCSAg
c2xpY2Vfc2V0KTsKKwkJCWJyZWFrOworCQlkZWZhdWx0OgorCQkJTUlTU0lOR19DQVNFKHNsaWNl
X2JpdCk7CisJCX0KKwl9CiAKIAlpZiAocmV0KQogCQlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5l
bmFibGVkX3NsaWNlcyA9IHJlcV9zbGljZXM7CkBAIC00Mjg2LDQwICs0Mjk1LDIxIEBAIHZvaWQg
aWNsX2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAKIHN0YXRpYyB2b2lkIGljbF9kYnVmX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiB7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMSwgSTkxNV9SRUFEKERCVUZfQ1RM
X1MxKSB8IERCVUZfUE9XRVJfUkVRVUVTVCk7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMiwgSTkx
NV9SRUFEKERCVUZfQ1RMX1MyKSB8IERCVUZfUE9XRVJfUkVRVUVTVCk7Ci0JUE9TVElOR19SRUFE
KERCVUZfQ1RMX1MyKTsKLQotCXVkZWxheSgxMCk7Ci0KLQlpZiAoIShJOTE1X1JFQUQoREJVRl9D
VExfUzEpICYgREJVRl9QT1dFUl9TVEFURSkgfHwKLQkgICAgIShJOTE1X1JFQUQoREJVRl9DVExf
UzIpICYgREJVRl9QT1dFUl9TVEFURSkpCi0JCURSTV9FUlJPUigiREJ1ZiBwb3dlciBlbmFibGUg
dGltZW91dFxuIik7Ci0JZWxzZQotCQkvKgotCQkgKiBGSVhNRTogZm9yIG5vdyBwcmV0ZW5kIHRo
YXQgd2Ugb25seSBoYXZlIDEgc2xpY2UsIHNlZQotCQkgKiBpbnRlbF9lbmFibGVkX2RidWZfc2xp
Y2VzX251bSgpLgotCQkgKi8KLQkJZGV2X3ByaXYtPndtLnNrbF9ody5kZGIuZW5hYmxlZF9zbGlj
ZXMgPSAxOworCS8qCisJICogSnVzdCBwb3dlciB1cCAxIHNsaWNlLCB3ZSB3aWxsCisJICogZmln
dXJlIG91dCBsYXRlciB3aGljaCBzbGljZXMgd2UgaGF2ZSBhbmQgd2hhdCB3ZSBuZWVkLgorCSAq
LworCWRldl9wcml2LT53bS5za2xfaHcuZGRiLmVuYWJsZWRfc2xpY2VzID0gREJVRl9TMV9CSVQ7
CisJaWNsX2RidWZfc2xpY2VzX3Jlc3RvcmUoZGV2X3ByaXYpOwogfQogCiBzdGF0aWMgdm9pZCBp
Y2xfZGJ1Zl9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlJ
OTE1X1dSSVRFKERCVUZfQ1RMX1MxLCBJOTE1X1JFQUQoREJVRl9DVExfUzEpICYgfkRCVUZfUE9X
RVJfUkVRVUVTVCk7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMiwgSTkxNV9SRUFEKERCVUZfQ1RM
X1MyKSAmIH5EQlVGX1BPV0VSX1JFUVVFU1QpOwotCVBPU1RJTkdfUkVBRChEQlVGX0NUTF9TMik7
Ci0KLQl1ZGVsYXkoMTApOwotCi0JaWYgKChJOTE1X1JFQUQoREJVRl9DVExfUzEpICYgREJVRl9Q
T1dFUl9TVEFURSkgfHwKLQkgICAgKEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VS
X1NUQVRFKSkKLQkJRFJNX0VSUk9SKCJEQnVmIHBvd2VyIGRpc2FibGUgdGltZW91dCFcbiIpOwot
CWVsc2UKLQkJLyoKLQkJICogRklYTUU6IGZvciBub3cgcHJldGVuZCB0aGF0IHRoZSBmaXJzdCBz
bGljZSBpcyBhbHdheXMKLQkJICogZW5hYmxlZCwgc2VlIGludGVsX2VuYWJsZWRfZGJ1Zl9zbGlj
ZXNfbnVtKCkuCi0JCSAqLwotCQlkZXZfcHJpdi0+d20uc2tsX2h3LmRkYi5lbmFibGVkX3NsaWNl
cyA9IDE7CisJLyoKKwkgKiBEaXNhYmxlIGFsbCBzbGljZXMKKwkgKi8KKwlkZXZfcHJpdi0+d20u
c2tsX2h3LmRkYi5lbmFibGVkX3NsaWNlcyA9IDA7CisJaWNsX2RidWZfc2xpY2VzX3Jlc3RvcmUo
ZGV2X3ByaXYpOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfbWJ1c19pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmgKaW5kZXggMWRhMDRmM2UwZmIzLi5jNWFmYjMxMjk1NzEg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9w
b3dlci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9w
b3dlci5oCkBAIC0zMTEsOCArMzExLDEwIEBAIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2FzeW5j
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWZvciAoKHdmKSA9IGludGVsX2Rpc3Bs
YXlfcG93ZXJfZ2V0KChpOTE1KSwgKGRvbWFpbikpOyAod2YpOyBcCiAJICAgICBpbnRlbF9kaXNw
bGF5X3Bvd2VyX3B1dF9hc3luYygoaTkxNSksIChkb21haW4pLCAod2YpKSwgKHdmKSA9IDApCiAK
K2ludCBpbnRlbF9kYnVmX21heF9zbGljZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KTsKIHZvaWQgaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCQkgICAgdTggcmVxX3NsaWNlcyk7Cit2b2lkIGljbF9kYnVmX3NsaWNl
c19yZXN0b3JlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiAKIHZvaWQgY2h2
X3BoeV9wb3dlcmdhdGVfbGFuZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkg
ICAgIGJvb2wgb3ZlcnJpZGUsIHVuc2lnbmVkIGludCBtYXNrKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5jCmluZGV4IDgyZTRlNmJmMDhjMy4uMDMwN2FlYzJjOTI4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmMKQEAgLTUxLDYgKzUxLDcgQEAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2J3LmgiCiAj
aW5jbHVkZSAiZGlzcGxheS9pbnRlbF9jZGNsay5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxf
ZGlzcGxheV90eXBlcy5oIgorI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5o
IgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHAuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVs
X2ZiZGV2LmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9ob3RwbHVnLmgiCkBAIC0yNTg4LDYg
KzI1ODksMTAgQEAgc3RhdGljIGludCBpbnRlbF9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgZGV2aWNl
ICprZGV2KQogCWlmIChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRl
dl9wcml2KSkKIAkJcmV0ID0gdmx2X3Jlc3VtZV9wcmVwYXJlKGRldl9wcml2LCB0cnVlKTsKIAor
CS8qIFdlaXJkIGhhY2sgdG8gZml4IElDTCBoYXJkd2FyZSBidWcsIGFzIGl0IHJlc2V0cyBEQlVG
IHNsaWNlcyByZWcgKi8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA9PSAxMSkKKwkJaWNsX2Ri
dWZfc2xpY2VzX3Jlc3RvcmUoZGV2X3ByaXYpOworCiAJaW50ZWxfdW5jb3JlX3J1bnRpbWVfcmVz
dW1lKCZkZXZfcHJpdi0+dW5jb3JlKTsKIAogCWludGVsX3J1bnRpbWVfcG1fZW5hYmxlX2ludGVy
cnVwdHMoZGV2X3ByaXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggN2UwZjY3YmFiZTIw
Li5hMzk2OTc3YzljMmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtODA0LDcgKzgwNCw3
IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBza2xfZGRiX2VudHJ5X2VxdWFsKGNvbnN0IHN0cnVjdCBz
a2xfZGRiX2VudHJ5ICplMSwKIH0KIAogc3RydWN0IHNrbF9kZGJfYWxsb2NhdGlvbiB7Ci0JdTgg
ZW5hYmxlZF9zbGljZXM7IC8qIEdFTjExIGhhcyBjb25maWd1cmFibGUgMiBzbGljZXMgKi8KKwl1
OCBlbmFibGVkX3NsaWNlczsgICAvKiBCaXRtYXNrIG9mIGN1cnJlbnRseSBlbmFibGVkIERCdWYg
c2xpY2VzICovCiB9OwogCiBzdHJ1Y3Qgc2tsX2RkYl92YWx1ZXMgewpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGNpLmMKaW5kZXggMWJiNzAxZDMyYTVkLi4zOWMzZGI0ZWY3ZGEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wY2kuYwpAQCAtNjE0LDcgKzYxNCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2
aWNlX2luZm8gaW50ZWxfY2hlcnJ5dmlld19pbmZvID0gewogCS5oYXNfZ3RfdWMgPSAxLCBcCiAJ
LmRpc3BsYXkuaGFzX2hkY3AgPSAxLCBcCiAJLmRpc3BsYXkuaGFzX2lwYyA9IDEsIFwKLQkuZGRi
X3NpemUgPSA4OTYKKwkuZGRiX3NpemUgPSA4OTYsIFwKKwkuc3VwcG9ydGVkX3NsaWNlcyA9IDEK
IAogI2RlZmluZSBTS0xfUExBVEZPUk0gXAogCUdFTjlfRkVBVFVSRVMsIFwKQEAgLTY4MiwxMiAr
NjgzLDE0IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfYnJv
eHRvbl9pbmZvID0gewogCUdFTjlfTFBfRkVBVFVSRVMsCiAJUExBVEZPUk0oSU5URUxfQlJPWFRP
TiksCiAJLmRkYl9zaXplID0gNTEyLAorCS5zdXBwb3J0ZWRfc2xpY2VzID0gMSwKIH07CiAKIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfZ2VtaW5pbGFrZV9pbmZv
ID0gewogCUdFTjlfTFBfRkVBVFVSRVMsCiAJUExBVEZPUk0oSU5URUxfR0VNSU5JTEFLRSksCiAJ
LmRkYl9zaXplID0gMTAyNCwKKwkuc3VwcG9ydGVkX3NsaWNlcyA9IDEsCiAJR0xLX0NPTE9SUywK
IH07CiAKQEAgLTczNyw2ICs3NDAsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2Rldmlj
ZV9pbmZvIGludGVsX2NvZmZlZWxha2VfZ3QzX2luZm8gPSB7CiAJR0VOOV9GRUFUVVJFUywgXAog
CUdFTigxMCksIFwKIAkuZGRiX3NpemUgPSAxMDI0LCBcCisJLnN1cHBvcnRlZF9zbGljZXMgPSAx
LCBcCiAJLmRpc3BsYXkuaGFzX2RzYyA9IDEsIFwKIAkuaGFzX2NvaGVyZW50X2dndHQgPSBmYWxz
ZSwgXAogCUdMS19DT0xPUlMKQEAgLTc3Myw2ICs3NzcsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0
IGludGVsX2RldmljZV9pbmZvIGludGVsX2Nhbm5vbmxha2VfaW5mbyA9IHsKIAl9LCBcCiAJR0VO
KDExKSwgXAogCS5kZGJfc2l6ZSA9IDIwNDgsIFwKKwkuc3VwcG9ydGVkX3NsaWNlcyA9IDIsIFwK
IAkuaGFzX2xvZ2ljYWxfcmluZ19lbHNxID0gMSwgXAogCS5jb2xvciA9IHsgLmRlZ2FtbWFfbHV0
X3NpemUgPSAzMywgLmdhbW1hX2x1dF9zaXplID0gMjYyMTQ1IH0KIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cmVnLmgKaW5kZXggYTYwN2VhNTIwODI5Li5mYmE1NzMxMDYzZDggMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZWcuaApAQCAtNzczNCw5ICs3NzM0LDExIEBAIGVudW0gewogI2RlZmluZSBESVNQX0FSQl9D
VEwyCV9NTUlPKDB4NDUwMDQpCiAjZGVmaW5lICBESVNQX0RBVEFfUEFSVElUSU9OXzVfNgkoMSA8
PCA2KQogI2RlZmluZSAgRElTUF9JUENfRU5BQkxFCQkoMSA8PCAzKQotI2RlZmluZSBEQlVGX0NU
TAlfTU1JTygweDQ1MDA4KQotI2RlZmluZSBEQlVGX0NUTF9TMQlfTU1JTygweDQ1MDA4KQotI2Rl
ZmluZSBEQlVGX0NUTF9TMglfTU1JTygweDQ0RkU4KQorI2RlZmluZSBEQlVGX1MxX0JJVAkJCUJJ
VCgwKQorI2RlZmluZSBEQlVGX1MyX0JJVAkJCUJJVCgxKQorI2RlZmluZSBEQlVGX0NUTAkJCV9N
TUlPKDB4NDUwMDgpCisjZGVmaW5lIERCVUZfQ1RMX1MxCQkJX01NSU8oMHg0NTAwOCkKKyNkZWZp
bmUgREJVRl9DVExfUzIJCQlfTU1JTygweDQ0RkU4KQogI2RlZmluZSAgREJVRl9QT1dFUl9SRVFV
RVNUCQkoMSA8PCAzMSkKICNkZWZpbmUgIERCVUZfUE9XRVJfU1RBVEUJCSgxIDw8IDMwKQogI2Rl
ZmluZSBHRU43X01TR19DVEwJX01NSU8oMHg0NTAxMCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9kZXZpY2VfaW5mby5oCmluZGV4IDRiZGY4YTZjZmI0Ny4uYmEzNGUxYTVjNTkxIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kZXZpY2VfaW5mby5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmgKQEAgLTE4MCw2ICsxODAsNyBAQCBz
dHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gewogCX0gZGlzcGxheTsKIAogCXUxNiBkZGJfc2l6ZTsg
LyogaW4gYmxvY2tzICovCisJdTggc3VwcG9ydGVkX3NsaWNlczsgLyogbnVtYmVyIG9mIERCdWYg
c2xpY2VzICovCiAKIAkvKiBSZWdpc3RlciBvZmZzZXRzIGZvciB0aGUgdmFyaW91cyBkaXNwbGF5
IHBpcGVzIGFuZCB0cmFuc2NvZGVycyAqLwogCWludCBwaXBlX29mZnNldHNbSTkxNV9NQVhfVFJB
TlNDT0RFUlNdOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggMmQzODllNDM3ZTg3Li5iNjYy
N2M4NDVmMWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtMzU4NiwyNCArMzU4NiwyMCBA
QCBib29sIGlsa19kaXNhYmxlX2xwX3dtKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJcmV0dXJu
IF9pbGtfZGlzYWJsZV9scF93bShkZXZfcHJpdiwgV01fRElSVFlfTFBfQUxMKTsKIH0KIAotc3Rh
dGljIHU4IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyB1OCBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQl1OCBlbmFibGVkX3NsaWNlczsKLQot
CS8qIFNsaWNlIDEgd2lsbCBhbHdheXMgYmUgZW5hYmxlZCAqLwotCWVuYWJsZWRfc2xpY2VzID0g
MTsKKwl1OCBlbmFibGVkX3NsaWNlcyA9IDA7CiAKIAkvKiBHZW4gcHJpb3IgdG8gR0VOMTEgaGF2
ZSBvbmx5IG9uZSBEQnVmIHNsaWNlICovCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkK
LQkJcmV0dXJuIGVuYWJsZWRfc2xpY2VzOworCQlyZXR1cm4gREJVRl9TMV9CSVQ7CiAKLQkvKgot
CSAqIEZJWE1FOiBmb3Igbm93IHdlJ2xsIG9ubHkgZXZlciB1c2UgMSBzbGljZTsgcHJldGVuZCB0
aGF0IHdlIGhhdmUKLQkgKiBvbmx5IHRoYXQgMSBzbGljZSBlbmFibGVkIHVudGlsIHdlIGhhdmUg
YSBwcm9wZXIgd2F5IGZvciBvbi1kZW1hbmQKLQkgKiB0b2dnbGluZyBvZiB0aGUgc2Vjb25kIHNs
aWNlLgotCSAqLwotCWlmICgwICYmIEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VS
X1NUQVRFKQotCQllbmFibGVkX3NsaWNlcysrOworCS8qIENoZWNrIGlmIHNlY29uZCBEQnVmIHNs
aWNlIGlzIGVuYWJsZWQgKi8KKwlpZiAoSTkxNV9SRUFEKERCVUZfQ1RMX1MxKSAmIERCVUZfUE9X
RVJfU1RBVEUpCisJCWVuYWJsZWRfc2xpY2VzIHw9IERCVUZfUzFfQklUOworCisJaWYgKEk5MTVf
UkVBRChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VSX1NUQVRFKQorCQllbmFibGVkX3NsaWNlcyB8
PSBEQlVGX1MyX0JJVDsKIAogCXJldHVybiBlbmFibGVkX3NsaWNlczsKIH0KQEAgLTM4MTIsMzYg
KzM4MDgsMzggQEAgc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRiX3NpemUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICAgICAgY29uc3QgaW50IG51bV9hY3RpdmUsCiAJCQkg
ICAgICBzdHJ1Y3Qgc2tsX2RkYl9hbGxvY2F0aW9uICpkZGIpCiB7Ci0JY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGU7Ci0JdTY0IHRvdGFsX2RhdGFfYnc7CiAJdTE2
IGRkYl9zaXplID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPmRkYl9zaXplOwotCiAJV0FSTl9PTihk
ZGJfc2l6ZSA9PSAwKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCiAJCXJldHVy
biBkZGJfc2l6ZSAtIDQ7IC8qIDQgYmxvY2tzIGZvciBieXBhc3MgcGF0aCBhbGxvY2F0aW9uICov
CiAKLQlhZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7Ci0JdG90
YWxfZGF0YV9idyA9IHRvdGFsX2RhdGFfcmF0ZSAqIGRybV9tb2RlX3ZyZWZyZXNoKGFkanVzdGVk
X21vZGUpOworCXJldHVybiBkZGJfc2l6ZTsKK30KIAotCS8qCi0JICogMTJHQi9zIGlzIG1heGlt
dW0gQlcgc3VwcG9ydGVkIGJ5IHNpbmdsZSBEQnVmIHNsaWNlLgotCSAqCi0JICogRklYTUUgZGJ1
ZiBzbGljZSBjb2RlIGlzIGJyb2tlbjoKLQkgKiAtIG11c3Qgd2FpdCBmb3IgcGxhbmVzIHRvIHN0
b3AgdXNpbmcgdGhlIHNsaWNlIGJlZm9yZSBwb3dlcmluZyBpdCBvZmYKLQkgKiAtIHBsYW5lIHN0
cmFkZGxpbmcgYm90aCBzbGljZXMgaXMgaWxsZWdhbCBpbiBtdWx0aS1waXBlIHNjZW5hcmlvcwot
CSAqIC0gc2hvdWxkIHZhbGlkYXRlIHdlIHN0YXkgd2l0aGluIHRoZSBodyBiYW5kd2lkdGggbGlt
aXRzCi0JICovCi0JaWYgKDAgJiYgKG51bV9hY3RpdmUgPiAxIHx8IHRvdGFsX2RhdGFfYncgPj0g
R0JwcygxMikpKSB7Ci0JCWRkYi0+ZW5hYmxlZF9zbGljZXMgPSAyOwotCX0gZWxzZSB7Ci0JCWRk
Yi0+ZW5hYmxlZF9zbGljZXMgPSAxOwotCQlkZGJfc2l6ZSAvPSAyOwotCX0KKy8qCisgKiBDYWxj
dWxhdGUgaW5pdGlhbCBEQnVmIHNsaWNlIG9mZnNldCwgYmFzZWQgb24gc2xpY2Ugc2l6ZQorICog
YW5kIG1hc2soaS5lIGlmIHNsaWNlIHNpemUgaXMgMTAyNCBhbmQgc2Vjb25kIHNsaWNlIGlzIGVu
YWJsZWQKKyAqIG9mZnNldCB3b3VsZCBiZSAxMDI0KQorICovCitzdGF0aWMgdTMyIHNrbF9nZXRf
Zmlyc3RfZGJ1Zl9zbGljZV9vZmZzZXQodTMyIGRidWZfc2xpY2VfbWFzaywKKwkJCQkJICAgdTMy
IHNsaWNlX3NpemUsIHUzMiBkZGJfc2l6ZSkKK3sKKwl1MzIgb2Zmc2V0ID0gMDsKIAotCXJldHVy
biBkZGJfc2l6ZTsKKwlpZiAoIWRidWZfc2xpY2VfbWFzaykKKwkJcmV0dXJuIDA7CisKKwlvZmZz
ZXQgPSAoZmZzKGRidWZfc2xpY2VfbWFzaykgLSAxKSAqIHNsaWNlX3NpemU7CisKKwlXQVJOX09O
KG9mZnNldCA+PSBkZGJfc2l6ZSk7CisJcmV0dXJuIG9mZnNldDsKIH0KIAorc3RhdGljIHUzMiBp
OTE1X2dldF9hbGxvd2VkX2RidWZfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCisJCQkJICAgICAgaW50IHBpcGUsIHUzMiBhY3RpdmVfcGlwZXMsCisJCQkJICAgICAgY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOworCiBzdGF0aWMgdm9pZAog
c2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCkBAIC0zODU3LDcgKzM4NTUsMTQgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9u
X2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdTMyIHBpcGVfd2lk
dGggPSAwLCB0b3RhbF93aWR0aCA9IDAsIHdpZHRoX2JlZm9yZV9waXBlID0gMDsKIAllbnVtIHBp
cGUgZm9yX3BpcGUgPSB0b19pbnRlbF9jcnRjKGZvcl9jcnRjKS0+cGlwZTsKIAl1MTYgZGRiX3Np
emU7CisJdTMyIGRkYl9yYW5nZV9zaXplOwogCXUzMiBpOworCXUzMiBkYnVmX3NsaWNlX21hc2s7
CisJdTMyIGFjdGl2ZV9waXBlczsKKwl1MzIgb2Zmc2V0OworCXUzMiBzbGljZV9zaXplOworCXUz
MiB0b3RhbF9zbGljZV9tYXNrOworCXUzMiBzdGFydCwgZW5kOwogCiAJaWYgKFdBUk5fT04oIXN0
YXRlKSB8fCAhY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSB7CiAJCWFsbG9jLT5zdGFydCA9IDA7CkBA
IC0zODY2LDE0ICszODcxLDIzIEBAIHNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm47CiAJfQogCi0JaWYg
KGludGVsX3N0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzKQorCWlmIChpbnRlbF9zdGF0ZS0+YWN0
aXZlX3BpcGVfY2hhbmdlcykgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGludGVsX3N0YXRl
LT5hY3RpdmVfcGlwZXMpOwotCWVsc2UKKwkJYWN0aXZlX3BpcGVzID0gaW50ZWxfc3RhdGUtPmFj
dGl2ZV9waXBlczsKKwl9IGVsc2UgewogCQkqbnVtX2FjdGl2ZSA9IGh3ZWlnaHQ4KGRldl9wcml2
LT5hY3RpdmVfcGlwZXMpOworCQlhY3RpdmVfcGlwZXMgPSBkZXZfcHJpdi0+YWN0aXZlX3BpcGVz
OworCX0KIAogCWRkYl9zaXplID0gaW50ZWxfZ2V0X2RkYl9zaXplKGRldl9wcml2LCBjcnRjX3N0
YXRlLCB0b3RhbF9kYXRhX3JhdGUsCiAJCQkJICAgICAgKm51bV9hY3RpdmUsIGRkYik7CiAKKwlE
Uk1fREVCVUdfS01TKCJHb3QgdG90YWwgZGRiIHNpemUgJWRcbiIsIGRkYl9zaXplKTsKKworCXNs
aWNlX3NpemUgPSBkZGJfc2l6ZSAvIElOVEVMX0lORk8oZGV2X3ByaXYpLT5zdXBwb3J0ZWRfc2xp
Y2VzOworCisJRFJNX0RFQlVHX0tNUygiR290IERCdWYgc2xpY2Ugc2l6ZSAlZFxuIiwgc2xpY2Vf
c2l6ZSk7CisKIAkvKgogCSAqIElmIHRoZSBzdGF0ZSBkb2Vzbid0IGNoYW5nZSB0aGUgYWN0aXZl
IENSVEMncyBvciB0aGVyZSBpcyBubwogCSAqIG1vZGVzZXQgcmVxdWVzdCwgdGhlbiB0aGVyZSdz
IG5vIG5lZWQgdG8gcmVjYWxjdWxhdGU7CkBAIC0zODkxLDIwICszOTA1LDcwIEBAIHNrbF9kZGJf
Z2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQlyZXR1cm47CiAJfQogCisJLyoKKwkgKiBHZXQgYWxsb3dlZCBEQnVmIHNsaWNlcyBm
b3IgY29ycmVzcG9uZGVudCBwaXBlIGFuZCBwbGF0Zm9ybS4KKwkgKi8KKwlkYnVmX3NsaWNlX21h
c2sgPSBpOTE1X2dldF9hbGxvd2VkX2RidWZfbWFzayhkZXZfcHJpdiwgZm9yX3BpcGUsCisJCQkJ
CQkgICAgIGFjdGl2ZV9waXBlcywgY3J0Y19zdGF0ZSk7CisKKwlEUk1fREVCVUdfS01TKCJEQnVm
IHNsaWNlIG1hc2sgJXggcGlwZSAlZCBhY3RpdmUgcGlwZXMgJXhcbiIsCisJCSAgICAgIGRidWZf
c2xpY2VfbWFzaywKKwkJICAgICAgZm9yX3BpcGUsIGFjdGl2ZV9waXBlcyk7CisKKwkvKgorCSAq
IEZpZ3VyZSBvdXQgYXQgd2hpY2ggREJ1ZiBzbGljZSB3ZSBzdGFydCwgaS5lIGlmIHdlIHN0YXJ0
IGF0IERidWYgUzIKKwkgKiBhbmQgc2xpY2Ugc2l6ZSBpcyAxMDI0LCB0aGUgb2Zmc2V0IHdvdWxk
IGJlIDEwMjQKKwkgKi8KKwlvZmZzZXQgPSBza2xfZ2V0X2ZpcnN0X2RidWZfc2xpY2Vfb2Zmc2V0
KGRidWZfc2xpY2VfbWFzaywKKwkJCQkJCSBzbGljZV9zaXplLCBkZGJfc2l6ZSk7CisKKwkvKgor
CSAqIEZpZ3VyZSBvdXQgdG90YWwgc2l6ZSBvZiBhbGxvd2VkIERCdWYgc2xpY2VzLCB3aGljaCBp
cyBiYXNpY2FsbHkKKwkgKiBhIG51bWJlciBvZiBhbGxvd2VkIHNsaWNlcyBmb3IgdGhhdCBwaXBl
IG11bHRpcGxpZWQgYnkgc2xpY2Ugc2l6ZS4KKwkgKiBJbnNpZGUgb2YgdGhpcworCSAqIHJhbmdl
IGRkYiBlbnRyaWVzIGFyZSBzdGlsbCBhbGxvY2F0ZWQgaW4gcHJvcG9ydGlvbiB0byBkaXNwbGF5
IHdpZHRoLgorCSAqLworCWRkYl9yYW5nZV9zaXplID0gaHdlaWdodDgoZGJ1Zl9zbGljZV9tYXNr
KSAqIHNsaWNlX3NpemU7CisKIAkvKgogCSAqIFdhdGVybWFyay9kZGIgcmVxdWlyZW1lbnQgaGln
aGx5IGRlcGVuZHMgdXBvbiB3aWR0aCBvZiB0aGUKIAkgKiBmcmFtZWJ1ZmZlciwgU28gaW5zdGVh
ZCBvZiBhbGxvY2F0aW5nIEREQiBlcXVhbGx5IGFtb25nIHBpcGVzCiAJICogZGlzdHJpYnV0ZSBE
REIgYmFzZWQgb24gcmVzb2x1dGlvbi93aWR0aCBvZiB0aGUgZGlzcGxheS4KIAkgKi8KKwl0b3Rh
bF9zbGljZV9tYXNrID0gZGJ1Zl9zbGljZV9tYXNrOwogCWZvcl9lYWNoX25ld19pbnRlbF9jcnRj
X2luX3N0YXRlKGludGVsX3N0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7CiAJCWNvbnN0IHN0
cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KIAkJCSZjcnRjX3N0YXRlLT5o
dy5hZGp1c3RlZF9tb2RlOwogCQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJCWludCBo
ZGlzcGxheSwgdmRpc3BsYXk7CisJCXUzMiBwaXBlX2RidWZfc2xpY2VfbWFzayA9IFwKKwkJCWk5
MTVfZ2V0X2FsbG93ZWRfZGJ1Zl9tYXNrKGRldl9wcml2LAorCQkJCQkJcGlwZSwKKwkJCQkJCWFj
dGl2ZV9waXBlcywKKwkJCQkJCWNydGNfc3RhdGUpOwogCiAJCWlmICghY3J0Y19zdGF0ZS0+aHcu
ZW5hYmxlKQogCQkJY29udGludWU7CiAKKwkJLyoKKwkJICogQWNjb3JkaW5nIHRvIEJTcGVjIHBp
cGUgY2FuIHNoYXJlIG9uZSBkYnVmIHNsaWNlIHdpdGggYW5vdGhlcgorCQkgKiBwaXBlcyBvciBw
aXBlIGNhbiB1c2UgbXVsdGlwbGUgZGJ1ZnMsIGluIGJvdGggY2FzZXMgd2UKKwkJICogYWNjb3Vu
dCBmb3Igb3RoZXIgcGlwZXMgb25seSBpZiB0aGV5IGhhdmUgZXhhY3RseSBzYW1lIG1hc2suCisJ
CSAqIEhvd2V2ZXIgd2UgbmVlZCB0byBhY2NvdW50IGhvdyBtYW55IHNsaWNlcyB3ZSBzaG91bGQg
ZW5hYmxlCisJCSAqIGluIHRvdGFsLgorCQkgKi8KKwkJdG90YWxfc2xpY2VfbWFzayB8PSBwaXBl
X2RidWZfc2xpY2VfbWFzazsKKworCQkvKgorCQkgKiBEbyBub3QgYWNjb3VudCBwaXBlcyB1c2lu
ZyBvdGhlciBzbGljZSBzZXRzCisJCSAqIGx1Y2tpbHkgYXMgb2YgY3VycmVudCBCU3BlYyBzbGlj
ZSBzZXRzIGRvIG5vdCBwYXJ0aWFsbHkKKwkJICogaW50ZXJzZWN0KHBpcGVzIHNoYXJlIGVpdGhl
ciBzYW1lIG9uZSBzbGljZSBvciBzYW1lIHNsaWNlIHNldAorCQkgKiBpLmUgbm8gcGFydGlhbCBp
bnRlcnNlY3Rpb24pLCBzbyBpdCBpcyBlbm91Z2ggdG8gY2hlY2sgZm9yCisJCSAqIGVxdWFsaXR5
IGZvciBub3cuCisJCSAqLworCQlpZiAoZGJ1Zl9zbGljZV9tYXNrICE9IHBpcGVfZGJ1Zl9zbGlj
ZV9tYXNrKQorCQkJY29udGludWU7CisKIAkJZHJtX21vZGVfZ2V0X2h2X3RpbWluZyhhZGp1c3Rl
ZF9tb2RlLCAmaGRpc3BsYXksICZ2ZGlzcGxheSk7CiAJCXRvdGFsX3dpZHRoICs9IGhkaXNwbGF5
OwogCkBAIC0zOTE0LDggKzM5NzgsMTkgQEAgc2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xp
bWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQlwaXBlX3dpZHRoID0g
aGRpc3BsYXk7CiAJfQogCi0JYWxsb2MtPnN0YXJ0ID0gZGRiX3NpemUgKiB3aWR0aF9iZWZvcmVf
cGlwZSAvIHRvdGFsX3dpZHRoOwotCWFsbG9jLT5lbmQgPSBkZGJfc2l6ZSAqICh3aWR0aF9iZWZv
cmVfcGlwZSArIHBpcGVfd2lkdGgpIC8gdG90YWxfd2lkdGg7CisJZGRiLT5lbmFibGVkX3NsaWNl
cyA9IHRvdGFsX3NsaWNlX21hc2s7CisKKwlzdGFydCA9IGRkYl9yYW5nZV9zaXplICogd2lkdGhf
YmVmb3JlX3BpcGUgLyB0b3RhbF93aWR0aDsKKwllbmQgPSBkZGJfcmFuZ2Vfc2l6ZSAqICh3aWR0
aF9iZWZvcmVfcGlwZSArIHBpcGVfd2lkdGgpIC8gdG90YWxfd2lkdGg7CisKKwlhbGxvYy0+c3Rh
cnQgPSBvZmZzZXQgKyBzdGFydDsKKwlhbGxvYy0+ZW5kID0gb2Zmc2V0ICsgZW5kOworCisJRFJN
X0RFQlVHX0tNUygiUGlwZSAlZCBkZGIgJWQtJWRcbiIsIGZvcl9waXBlLAorCQkgICAgICBhbGxv
Yy0+c3RhcnQsIGFsbG9jLT5lbmQpOworCURSTV9ERUJVR19LTVMoIkVuYWJsZWQgZGRiIHNsaWNl
cyBtYXNrICV4IG51bSBzdXBwb3J0ZWQgJWRcbiIsCisJCSAgICAgIGRkYi0+ZW5hYmxlZF9zbGlj
ZXMsCisJCSAgICAgIElOVEVMX0lORk8oZGV2X3ByaXYpLT5zdXBwb3J0ZWRfc2xpY2VzKTsKIH0K
IAogc3RhdGljIGludCBza2xfY29tcHV0ZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC00MDM2LDcgKzQxMTEsOCBAQCB2b2lkIHNrbF9waXBl
X2RkYl9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiB2b2lkIHNrbF9kZGJf
Z2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgc3Ry
dWN0IHNrbF9kZGJfYWxsb2NhdGlvbiAqZGRiIC8qIG91dCAqLykKIHsKLQlkZGItPmVuYWJsZWRf
c2xpY2VzID0gaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19udW0oZGV2X3ByaXYpOworCWRkYi0+
ZW5hYmxlZF9zbGljZXMgPSBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzKGRldl9wcml2KTsKKwlE
Uk1fREVCVUdfS01TKCJHb3QgaHcgZGJ1ZiBzbGljZXMgbWFzayAleFxuIiwgZGRiLT5lbmFibGVk
X3NsaWNlcyk7CiB9CiAKIC8qCkBAIC00MTY0LDYgKzQyNDAsMjM4IEBAIHNrbF9nZXRfdG90YWxf
cmVsYXRpdmVfZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CXJldHVybiB0b3RhbF9kYXRhX3JhdGU7CiB9CiAKK3VpbnRfZml4ZWRfMTZfMTZfdAorc2tsX3Bp
cGVfZG93bnNjYWxlX2Ftb3VudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKK3sKKwl1MzIgc3JjX3csIHNyY19oLCBkc3RfdywgZHN0X2g7CisJdWludF9maXhlZF8x
Nl8xNl90IGZwX3dfcmF0aW8sIGZwX2hfcmF0aW87CisJdWludF9maXhlZF8xNl8xNl90IGRvd25z
Y2FsZV9oLCBkb3duc2NhbGVfdzsKKwljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRq
dXN0ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOworCisJc3JjX3cgPSBj
cnRjX3N0YXRlLT5waXBlX3NyY193OworCXNyY19oID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaDsK
Kwlkc3RfdyA9IGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXk7CisJZHN0X2ggPSBhZGp1c3Rl
ZF9tb2RlLT5jcnRjX3ZkaXNwbGF5OworCisJZnBfd19yYXRpbyA9IGRpdl9maXhlZDE2KHNyY193
LCBkc3Rfdyk7CisJZnBfaF9yYXRpbyA9IGRpdl9maXhlZDE2KHNyY19oLCBkc3RfaCk7CisJZG93
bnNjYWxlX3cgPSBtYXhfZml4ZWQxNihmcF93X3JhdGlvLCB1MzJfdG9fZml4ZWQxNigxKSk7CisJ
ZG93bnNjYWxlX2ggPSBtYXhfZml4ZWQxNihmcF9oX3JhdGlvLCB1MzJfdG9fZml4ZWQxNigxKSk7
CisKKwlyZXR1cm4gbXVsX2ZpeGVkMTYoZG93bnNjYWxlX3csIGRvd25zY2FsZV9oKTsKK30KKwor
dWludF9maXhlZF8xNl8xNl90CitpY2xfZ2V0X3BpcGVfcmF0aW8oY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9wbGFuZSAqcGxhbmU7CisJ
Y29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqZHJtX3BsYW5lX3N0YXRlOworCXVpbnRfZml4
ZWRfMTZfMTZfdCBwaXBlX2Rvd25zY2FsZSwgcGlwZV9yYXRpbzsKKwl1aW50X2ZpeGVkXzE2XzE2
X3QgbWF4X2Rvd25zY2FsZSA9IHUzMl90b19maXhlZDE2KDEpOworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCisJaWYgKCFj
cnRjX3N0YXRlLT51YXBpLmVuYWJsZSkKKwkJcmV0dXJuIG1heF9kb3duc2NhbGU7CisKKwlkcm1f
YXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIGRybV9wbGFuZV9z
dGF0ZSwgJmNydGNfc3RhdGUtPnVhcGkpIHsKKwkJdWludF9maXhlZF8xNl8xNl90IHBsYW5lX2Rv
d25zY2FsZTsKKwkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9
CisJCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShkcm1fcGxhbmVfc3RhdGUpOworCisJCWlmICghaW50
ZWxfd21fcGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSkpCisJCQljb250aW51
ZTsKKworCQlwbGFuZV9kb3duc2NhbGUgPSBza2xfcGxhbmVfZG93bnNjYWxlX2Ftb3VudChjcnRj
X3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisKKwkJRFJNX0RFQlVHX0tNUygiUGxhbmUgJWQgZG93bnNj
YWxlIGFtb3VudCAlZC4lZFxuIiwKKwkJCSAgICAgIHRvX2ludGVsX3BsYW5lKHBsYW5lKS0+aWQs
CisJCQkgICAgICBwbGFuZV9kb3duc2NhbGUudmFsID4+IDE2LAorCQkJICAgICAgcGxhbmVfZG93
bnNjYWxlLnZhbCAmIDB4ZmZmZik7CisKKwkJbWF4X2Rvd25zY2FsZSA9IG1heF9maXhlZDE2KHBs
YW5lX2Rvd25zY2FsZSwgbWF4X2Rvd25zY2FsZSk7CisJfQorCisKKwlwaXBlX2Rvd25zY2FsZSA9
IHNrbF9waXBlX2Rvd25zY2FsZV9hbW91bnQoY3J0Y19zdGF0ZSk7CisKKwlEUk1fREVCVUdfS01T
KCJQaXBlICVkIGRvd25zY2FsZSBhbW91bnQgJWQuJWRcbiIsCisJCSAgICAgICBjcnRjLT5waXBl
LCBwaXBlX2Rvd25zY2FsZS52YWwgPj4gMTYsCisJCSAgICAgICBwaXBlX2Rvd25zY2FsZS52YWwg
JiAweGZmZmYpOworCisJcGlwZV9kb3duc2NhbGUgPSBtdWxfZml4ZWQxNihwaXBlX2Rvd25zY2Fs
ZSwgbWF4X2Rvd25zY2FsZSk7CisKKwkvKiBDb252ZXJ0IHJlc3VsdCB0byBwZXJjZW50YWdlICov
CisJcGlwZV9yYXRpbyA9IHUzMl90b19maXhlZDE2KDEwMCAqIGRpdl9yb3VuZF91cF91MzJfZml4
ZWQxNigxLCBwaXBlX2Rvd25zY2FsZSkpOworCisJRFJNX0RFQlVHX0tNUygiUGlwZSAlZCByYXRp
byAlZC4lZFxuIiwgY3J0Yy0+cGlwZSwKKwkJICAgICAgcGlwZV9yYXRpby52YWwgPj4gMTYsIHBp
cGVfcmF0aW8udmFsICYgMHhmZmZmKTsKKworCXJldHVybiBwaXBlX3JhdGlvOworfQorCitzdHJ1
Y3QgZGJ1Zl9zbGljZV9jb25mX2VudHJ5IHsKKwl1MzIgZGJ1Zl9tYXNrW0k5MTVfTUFYX1BJUEVT
XTsKKwl1MzIgYWN0aXZlX3BpcGVzOworfTsKKworCisjZGVmaW5lIElDTF9QSVBFX0FfREJVRl9T
TElDRVMoREJ1ZjEpICBcCisJeyB7IERCdWYxLCAwLCAwLCAwIH0sIEJJVChQSVBFX0EpIH0KKyNk
ZWZpbmUgSUNMX1BJUEVfQl9EQlVGX1NMSUNFUyhEQnVmMSkgIFwKKwl7IHsgMCwgREJ1ZjEsIDAs
IDAgfSwgQklUKFBJUEVfQikgfQorI2RlZmluZSBJQ0xfUElQRV9DX0RCVUZfU0xJQ0VTKERCdWYx
KSAgXAorCXsgeyAwLCAwLCBEQnVmMSwgMCB9LCBCSVQoUElQRV9DKSB9CisjZGVmaW5lIElDTF9Q
SVBFX0RfREJVRl9TTElDRVMoREJ1ZjEpICBcCisJeyB7IDAsIDAsIDAsIERCdWYxIH0sIEJJVChQ
SVBFX0QpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQUJfREJVRl9TTElDRVMoREJ1ZjEsIERCdWYyKSAg
IFwKKwl7IHsgREJ1ZjEsIERCdWYyLCAwLCAwIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikg
fQorI2RlZmluZSBJQ0xfUElQRV9CQ19EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIpICAgXAorCXsg
eyAwLCBEQnVmMSwgREJ1ZjIsIDAgfSwgQklUKFBJUEVfQikgfCBCSVQoUElQRV9DKSB9CisjZGVm
aW5lIElDTF9QSVBFX0JEX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMikgICBcCisJeyB7IDAsIERC
dWYxLCAwLCBEQnVmMiB9LCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0QpIH0KKyNkZWZpbmUgSUNM
X1BJUEVfQUNfREJVRl9TTElDRVMoREJ1ZjEsIERCdWYyKSAgIFwKKwl7IHsgREJ1ZjEsIDAsIERC
dWYyLCAwIH0sIEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQykgfQorI2RlZmluZSBJQ0xfUElQRV9B
RF9EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIpICAgXAorCXsgeyBEQnVmMSwgMCwgMCwgREJ1ZjIg
fSwgQklUKFBJUEVfQSkgfCBCSVQoUElQRV9EKSB9CisjZGVmaW5lIElDTF9QSVBFX0NEX0RCVUZf
U0xJQ0VTKERCdWYxLCBEQnVmMikgICBcCisJeyB7IDAsIDAsIERCdWYxLCBEQnVmMiB9LCBCSVQo
UElQRV9DKSB8IEJJVChQSVBFX0QpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQUJDX0RCVUZfU0xJQ0VT
KERCdWYxLCBEQnVmMiwgREJ1ZjMpICBcCisJeyB7IERCdWYxLCBEQnVmMiwgREJ1ZjMsIDAgfSwg
QklUKFBJUEVfQSkgfCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpIH0KKyNkZWZpbmUgSUNMX1BJ
UEVfQUNEX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMiwgREJ1ZjMpICBcCisJeyB7IERCdWYxLCAw
LCBEQnVmMiwgREJ1ZjMgfSwgQklUKFBJUEVfQSkgfCBCSVQoUElQRV9DKSB8IEJJVChQSVBFX0Qp
IH0KKyNkZWZpbmUgSUNMX1BJUEVfQkNEX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMiwgREJ1ZjMp
ICBcCisJeyB7IDAsIERCdWYxLCBEQnVmMiwgREJ1ZjMgfSwgQklUKFBJUEVfQikgfCBCSVQoUElQ
RV9DKSB8IEJJVChQSVBFX0QpIH0KKyNkZWZpbmUgSUNMX1BJUEVfQUJEX0RCVUZfU0xJQ0VTKERC
dWYxLCBEQnVmMiwgREJ1ZjMpICBcCisJeyB7IERCdWYxLCBEQnVmMiwgMCwgREJ1ZjMgfSwgQklU
KFBJUEVfQSkgfCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0QpIH0KKyNkZWZpbmUgSUNMX1BJUEVf
QUJDX0RCVUZfU0xJQ0VTKERCdWYxLCBEQnVmMiwgREJ1ZjMpICBcCisJeyB7IERCdWYxLCBEQnVm
MiwgREJ1ZjMsIDAgfSwgQklUKFBJUEVfQSkgfCBCSVQoUElQRV9CKSB8IEJJVChQSVBFX0MpIH0K
KyNkZWZpbmUgSUNMX1BJUEVfQUJDRF9EQlVGX1NMSUNFUyhEQnVmMSwgREJ1ZjIsIERCdWYzLCBE
QnVmNCkgIFwKKwl7IHsgREJ1ZjEsIERCdWYyLCBEQnVmMywgREJ1ZjQgfSwgQklUKFBJUEVfQSkg
fCBCSVQoUElQRV9CKSB8IFwKKwkJCQkJICBCSVQoUElQRV9DKSB8IEJJVChQSVBFX0QpIH0KKwor
LyoKKyAqIFRhYmxlIHRha2VuIGZyb20gQnNwZWMgMTI3MTYKKyAqIFBpcGVzIGRvIGhhdmUgc29t
ZSBwcmVmZXJyZWQgREJ1ZiBzbGljZSBhZmZpbml0eSwKKyAqIHBsdXMgdGhlcmUgYXJlIHNvbWUg
aGFyZGNvZGVkIHJlcXVpcmVtZW50cyBvbiBob3cKKyAqIHRob3NlIHNob3VsZCBiZSBkaXN0cmli
dXRlZCBmb3IgbXVsdGlwaXBlIHNjZW5hcmlvcy4KKyAqIEZvciBtb3JlIERCdWYgc2xpY2VzIGFs
Z29yaXRobSBjYW4gZ2V0IGV2ZW4gbW9yZSBtZXNzeQorICogYW5kIGxlc3MgcmVhZGFibGUsIHNv
IGRlY2lkZWQgdG8gdXNlIGEgdGFibGUgYWxtb3N0CisgKiBhcyBpcyBmcm9tIEJTcGVjIGl0c2Vs
ZiAtIHRoYXQgd2F5IGl0IGlzIGF0IGxlYXN0IGVhc2llcgorICogdG8gY29tcGFyZSwgY2hhbmdl
IGFuZCBjaGVjay4KKyAqLworc3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSBpY2xfYWxsb3dl
ZF9kYnVmc1tdID0geworeyB7IDAsIDAsIDAsIDAgfSwgMCB9LAorSUNMX1BJUEVfQV9EQlVGX1NM
SUNFUyhEQlVGX1MxX0JJVCB8IERCVUZfUzJfQklUKSwgIC8qIHBpcGUgcmF0aW8gPCA4OC44ICov
CitJQ0xfUElQRV9BX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUKSwgICAgICAgICAgICAgICAgLyog
Zm9yIHBpcGUgcmF0aW8gPj0gODguOCAqLworSUNMX1BJUEVfQl9EQlVGX1NMSUNFUyhEQlVGX1Mx
X0JJVCB8IERCVUZfUzJfQklUKSwgIC8qIHBpcGUgcmF0aW8gPCA4OC44ICovCitJQ0xfUElQRV9C
X0RCVUZfU0xJQ0VTKERCVUZfUzFfQklUKSwgICAgICAgICAgICAgICAgLyogZm9yIHBpcGUgcmF0
aW8gPj0gODguOCAqLworSUNMX1BJUEVfQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCB8IERCVUZf
UzJfQklUKSwgIC8qIHBpcGUgcmF0aW8gPCA4OC44ICovCitJQ0xfUElQRV9DX0RCVUZfU0xJQ0VT
KERCVUZfUzJfQklUKSwgICAgICAgICAgICAgICAgLyogZm9yIHBpcGUgcmF0aW8gPj0gODguOCAq
LworSUNMX1BJUEVfQUJfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lD
TF9QSVBFX0FDX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCksCitJQ0xfUElQ
RV9CQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfQUJD
X0RCVUZfU0xJQ0VTKERCVUZfUzFfQklULCBEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorfTsK
KworLyoKKyAqIFRhYmxlIHRha2VuIGZyb20gQnNwZWMgNDkyNTUKKyAqIFBpcGVzIGRvIGhhdmUg
c29tZSBwcmVmZXJyZWQgREJ1ZiBzbGljZSBhZmZpbml0eSwKKyAqIHBsdXMgdGhlcmUgYXJlIHNv
bWUgaGFyZGNvZGVkIHJlcXVpcmVtZW50cyBvbiBob3cKKyAqIHRob3NlIHNob3VsZCBiZSBkaXN0
cmlidXRlZCBmb3IgbXVsdGlwaXBlIHNjZW5hcmlvcy4KKyAqIEZvciBtb3JlIERCdWYgc2xpY2Vz
IGFsZ29yaXRobSBjYW4gZ2V0IGV2ZW4gbW9yZSBtZXNzeQorICogYW5kIGxlc3MgcmVhZGFibGUs
IHNvIGRlY2lkZWQgdG8gdXNlIGEgdGFibGUgYWxtb3N0CisgKiBhcyBpcyBmcm9tIEJTcGVjIGl0
c2VsZiAtIHRoYXQgd2F5IGl0IGlzIGF0IGxlYXN0IGVhc2llcgorICogdG8gY29tcGFyZSwgY2hh
bmdlIGFuZCBjaGVjay4KKyAqLworc3RydWN0IGRidWZfc2xpY2VfY29uZl9lbnRyeSB0Z2xfYWxs
b3dlZF9kYnVmc1tdID0geworeyB7IDAsIDAsIDAsIDAgfSwgMCB9LAorSUNMX1BJUEVfQV9EQlVG
X1NMSUNFUyhEQlVGX1MxX0JJVCB8IERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0JfREJVRl9TTElD
RVMoREJVRl9TMV9CSVQgfCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9DX0RCVUZfU0xJQ0VTKERC
VUZfUzFfQklUIHwgREJVRl9TMl9CSVQpLAorSUNMX1BJUEVfRF9EQlVGX1NMSUNFUyhEQlVGX1Mx
X0JJVCB8IERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklU
LCBEQlVGX1MyX0JJVCksCitJQ0xfUElQRV9BQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJV
Rl9TMl9CSVQpLAorSUNMX1BJUEVfQkNfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJf
QklUKSwKK0lDTF9QSVBFX0FEX0RCVUZfU0xJQ0VTKERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCks
CitJQ0xfUElQRV9CRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9CSVQpLAorSUNM
X1BJUEVfQ0RfREJVRl9TTElDRVMoREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBF
X0FCRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMV9CSVQsIERCVUZfUzJfQklUKSwK
K0lDTF9QSVBFX0FCQ19EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMV9CSVQsIERCVUZf
UzJfQklUKSwKK0lDTF9QSVBFX0FDRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwgREJVRl9TMl9C
SVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0JDRF9EQlVGX1NMSUNFUyhEQlVGX1MxX0JJVCwg
REJVRl9TMl9CSVQsIERCVUZfUzJfQklUKSwKK0lDTF9QSVBFX0FCQ0RfREJVRl9TTElDRVMoREJV
Rl9TMV9CSVQsIERCVUZfUzFfQklULCBEQlVGX1MyX0JJVCwgREJVRl9TMl9CSVQpLAorfTsKKwor
LyoKKyAqIFRoaXMgZnVuY3Rpb24gZmluZHMgYW4gZW50cnkgd2l0aCBzYW1lIGVuYWJsZWQgcGlw
ZSBjb25maWd1cmF0aW9uIGFuZAorICogcmV0dXJucyBjb3JyZXNwb25kZW50IERCdWYgc2xpY2Ug
bWFzayBhcyBzdGF0ZWQgaW4gQlNwZWMgZm9yIHBhcnRpY3VsYXIKKyAqIHBsYXRmb3JtLgorICov
CitzdGF0aWMgdTMyIGljbF9nZXRfYWxsb3dlZF9kYnVmX21hc2soaW50IHBpcGUsCisJCQkJICAg
ICB1MzIgYWN0aXZlX3BpcGVzLAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCit7CisJaW50IGk7CisJdWludF9maXhlZF8xNl8xNl90IHBpcGVfcmF0
aW87CisKKwkvKgorCSAqIENhbGN1bGF0ZSBwaXBlIHJhdGlvIGFzIHN0YXRlZCBpbiBCU3BlYyAy
ODY5MgorCSAqLworCXBpcGVfcmF0aW8gPSBpY2xfZ2V0X3BpcGVfcmF0aW8oY3J0Y19zdGF0ZSk7
CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShpY2xfYWxsb3dlZF9kYnVmcyk7IGkrKykg
eworCQlpZiAoaWNsX2FsbG93ZWRfZGJ1ZnNbaV0uYWN0aXZlX3BpcGVzID09IGFjdGl2ZV9waXBl
cykgeworCQkJaWYgKGh3ZWlnaHQzMihhY3RpdmVfcGlwZXMpID09IDEpIHsKKwkJCQkvKgorCQkJ
CSAqIEFjY29yZGluZyB0byBCU3BlYyAxMjcxNjogaWYgcmF0aW8gPj0gODguOAorCQkJCSAqIGFs
d2F5cyB1c2Ugc2luZ2xlIGRidWYgc2xpY2UuCisJCQkJICovCisJCQkJaWYgKHBpcGVfcmF0aW8u
dmFsID49IGRpdl9maXhlZDE2KDg4OCwgMTApLnZhbCkKKwkJCQkJKytpOworCQkJfQorCQkJcmV0
dXJuIGljbF9hbGxvd2VkX2RidWZzW2ldLmRidWZfbWFza1twaXBlXTsKKwkJfQorCX0KKwlyZXR1
cm4gMDsKK30KKworLyoKKyAqIFRoaXMgZnVuY3Rpb24gZmluZHMgYW4gZW50cnkgd2l0aCBzYW1l
IGVuYWJsZWQgcGlwZSBjb25maWd1cmF0aW9uIGFuZAorICogcmV0dXJucyBjb3JyZXNwb25kZW50
IERCdWYgc2xpY2UgbWFzayBhcyBzdGF0ZWQgaW4gQlNwZWMgZm9yIHBhcnRpY3VsYXIKKyAqIHBs
YXRmb3JtLgorICovCitzdGF0aWMgdTMyIHRnbF9nZXRfYWxsb3dlZF9kYnVmX21hc2soaW50IHBp
cGUsCisJCQkJICAgICB1MzIgYWN0aXZlX3BpcGVzLAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBp
IDwgQVJSQVlfU0laRSh0Z2xfYWxsb3dlZF9kYnVmcyk7IGkrKykgeworCQlpZiAodGdsX2FsbG93
ZWRfZGJ1ZnNbaV0uYWN0aXZlX3BpcGVzID09IGFjdGl2ZV9waXBlcykKKwkJCXJldHVybiB0Z2xf
YWxsb3dlZF9kYnVmc1tpXS5kYnVmX21hc2tbcGlwZV07CisJfQorCXJldHVybiAwOworfQorCit1
MzIgaTkxNV9nZXRfYWxsb3dlZF9kYnVmX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAorCQkJCSAgICAgIGludCBwaXBlLCB1MzIgYWN0aXZlX3BpcGVzLAorCQkJCSAgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWlmIChJU19H
RU4oZGV2X3ByaXYsIDExKSkKKwkJcmV0dXJuIGljbF9nZXRfYWxsb3dlZF9kYnVmX21hc2socGlw
ZSwKKwkJCQkJCSBhY3RpdmVfcGlwZXMsCisJCQkJCQkgY3J0Y19zdGF0ZSk7CisJZWxzZSBpZiAo
SVNfR0VOKGRldl9wcml2LCAxMikpCisJCXJldHVybiB0Z2xfZ2V0X2FsbG93ZWRfZGJ1Zl9tYXNr
KHBpcGUsCisJCQkJCQkgYWN0aXZlX3BpcGVzLAorCQkJCQkJIGNydGNfc3RhdGUpOworCS8qCisJ
ICogRm9yIGFueXRoaW5nIGVsc2UganVzdCByZXR1cm4gb25lIHNsaWNlIHlldC4KKwkgKiBTaG91
bGQgYmUgZXh0ZW5kZWQgZm9yIG90aGVyIHBsYXRmb3Jtcy4KKwkgKi8KKwlyZXR1cm4gREJVRl9T
MV9CSVQ7Cit9CisKIHN0YXRpYyB1NjQKIGljbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRl
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSB1NjQgKnBsYW5lX2Rh
dGFfcmF0ZSkKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1C845171656
	for <lists+intel-gfx@lfdr.de>; Thu, 27 Feb 2020 12:49:34 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 50CD36E857;
	Thu, 27 Feb 2020 11:49:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4BB1B89E2A
 for <intel-gfx@lists.freedesktop.org>; Thu, 27 Feb 2020 11:49:30 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 Feb 2020 03:49:29 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,491,1574150400"; d="scan'208";a="285316140"
Received: from unknown (HELO slisovsk-Lenovo-ideapad-720S-13IKB.fi.intel.com)
 ([10.237.72.89])
 by FMSMGA003.fm.intel.com with ESMTP; 27 Feb 2020 03:49:27 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 27 Feb 2020 13:46:30 +0200
Message-Id: <20200227114630.28697-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200225145925.32303-1-stanislav.lisovskiy@intel.com>
References: <20200225145925.32303-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v18 5/8] drm/i915: Refactor intel_can_enable_sagv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGludGVsX2Nhbl9lbmFibGVfc2FndiBmdW5jdGlvbiBjb250YWlucwphIG1peCBv
ZiB3b3JrYXJvdW5kcyBmb3IgZGlmZmVyZW50IHBsYXRmb3Jtcwpzb21lIG9mIHRoZW0gYXJlIG5v
dCB2YWxpZCBmb3IgZ2VucyA+PSAxMSBhbHJlYWR5LApzbyBsZXRzIHNwbGl0IGl0IGludG8gc2Vw
YXJhdGUgZnVuY3Rpb25zLgoKdjI6CiAgICAtIFJld29yayB3YXRlcm1hcmsgY2FsY3VsYXRpb24g
YWxnb3JpdGhtIHRvCiAgICAgIGF0dGVtcHQgdG8gY2FsY3VsYXRlIExldmVsIDAgd2F0ZXJtYXJr
CiAgICAgIHdpdGggYWRkZWQgc2FndiBibG9jayB0aW1lIGxhdGVuY3kgYW5kCiAgICAgIGNoZWNr
IGlmIGl0IGZpdHMgaW4gREJ1ZiBpbiBvcmRlciB0bwogICAgICBkZXRlcm1pbmUgaWYgU0FHViBj
YW4gYmUgZW5hYmxlZCBhbHJlYWR5CiAgICAgIGF0IHRoaXMgc3RhZ2UsIGp1c3QgYXMgQlNwZWMg
NDkzMjUgc3RhdGVzLgogICAgICBpZiB0aGF0IGZhaWxzIHJvbGxiYWNrIHRvIHVzdWFsIExldmVs
IDAKICAgICAgbGF0ZW5jeSBhbmQgZGlzYWJsZSBTQUdWLgogICAgLSBSZW1vdmUgdW5uZWVkZWQg
dGFicyhKYW1lcyBBdXNtdXMpCgp2MzogUmViYXNlZCB0aGUgcGF0Y2gKCnY0OiAtIEFkZGVkIGJh
Y2sgaW50ZXJsYWNlZCBjaGVjayBmb3IgR2VuMTIgYW5kCiAgICAgIGFkZGVkIHNlcGFyYXRlIGZ1
bmN0aW9uIGZvciBUR0wgU0FHViBjaGVjawogICAgICAodGhhbmtzIHRvIEphbWVzIEF1c211cyBm
b3Igc3BvdHRpbmcpCiAgICAtIFJlbW92ZWQgdW5uZWVkZWQgZ2VuIGNoZWNrCiAgICAtIEV4dHJh
Y3RlZCBHZW4xMiBTQUdWIGRlY2lzaW9uIG1ha2luZyBjb2RlCiAgICAgIHRvIGEgc2VwYXJhdGUg
ZnVuY3Rpb24gZnJvbSBza2xfY29tcHV0ZV93bQoKdjU6IC0gQWRkZWQgU0FHViBnbG9iYWwgc3Rh
dGUgdG8gZGV2X3ByaXYsIGJlY2F1c2UKICAgICAgd2UgbmVlZCB0byB0cmFjayBhbGwgcGlwZXMs
IG5vdCBvbmx5IHRob3NlCiAgICAgIGluIGF0b21pYyBzdGF0ZS4gRWFjaCBwaXBlIGhhcyBub3cg
Y29ycmVzcG9uZGVudAogICAgICBiaXQgbWFzayByZWZsZWN0aW5nLCB3aGV0aGVyIGl0IGNhbiB0
b2xlcmF0ZQogICAgICBTQUdWIG9yIG5vdCh0aGFua3MgdG8gVmlsbGUgU3lyamFsYSBmb3Igc3Vn
Z2VzdGlvbnMpLgogICAgLSBOb3cgdXNpbmcgYWN0aXZlIGZsYWcgaW5zdGVhZCBvZiBlbmFibGUg
aW4gY3JjCiAgICAgIHVzYWdlIGNoZWNrLgoKdjY6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0cwoK
djc6IC0ga21zX2N1cnNvcl9sZWdhY3kgc2VlbXMgdG8gZ2V0IGJyb2tlbiBiZWNhdXNlIG9mIG11
bHRpcGxlIG1lbWNweQogICAgICBjYWxscyB3aGVuIGNvcHlpbmcgbGV2ZWwgMCB3YXRlciBtYXJr
cyBmb3IgZW5hYmxlZCBTQUdWLCB0bwogICAgICBmaXggdGhpcyBub3cgc2ltcGx5IHVzaW5nIHRo
YXQgZmllbGQgcmlnaHQgYXdheSwgd2l0aG91dCBjb3B5aW5nLAogICAgICBmb3IgdGhhdCBpbnRy
b2R1Y2VkIGEgbmV3IHdtX2xldmVsIGFjY2Vzc29yIHdoaWNoIGRlY2lkZXMgd2hpY2gKICAgICAg
d21fbGV2ZWwgdG8gcmV0dXJuIGJhc2VkIG9uIFNBR1Ygc3RhdGUuCgp2ODogLSBQcm90ZWN0IGNy
dGNfc2Fndl9tYXNrIHNhbWUgd2F5IGFzIHdlIGRvIGZvciBvdGhlciBnbG9iYWwgc3RhdGUKICAg
ICAgY2hhbmdlczogaS5lIGNoZWNrIGlmIGNoYW5nZXMgYXJlIG5lZWRlZCwgdGhlbiBncmFiIGFs
bCBjcnRjIGxvY2tzCiAgICAgIHRvIHNlcmlhbGl6ZSB0aGUgY2hhbmdlcyhWaWxsZSBTeXJqw6Rs
w6QpCiAgICAtIEFkZCBjcnRjX3NhZ3ZfbWFzayBjYWNoaW5nIGluIG9yZGVyIHRvIGF2b2lkIG5l
ZWRsZXNzIHJlY2FsY3VsYXRpb25zCiAgICAgIChNYXR0aGV3IFJvcGVyKQogICAgLSBQdXQgYmFj
ayBHZW4xMiBTQUdWIHN3aXRjaCBpbiBvcmRlciB0byBnZXQgaXQgZW5hYmxlZCBpbiBzZXBhcmF0
ZQogICAgICBwYXRjaChNYXR0aGV3IFJvcGVyKQogICAgLSBSZW5hbWUgKl9zZXRfc2Fndl9tYXNr
IHRvICpfY29tcHV0ZV9zYWd2X21hc2soTWF0dGhldyBSb3BlcikKICAgIC0gQ2hlY2sgaWYgdGhl
cmUgYXJlIG5vIGFjdGl2ZSBwaXBlcyBpbiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKICAgICAgaW5z
dGVhZCBvZiBwbGF0Zm9ybSBzcGVjaWZpYyBmdW5jdGlvbnMoTWF0dGhldyBSb3BlciksIHNhbWUK
ICAgICAgZm9yIGludGVsX2hhc19zYWd2IGNoZWNrLgoKdjkgIC0gU3dpdGNoZWQgdG8gdTggZm9y
IGNydGNfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gY3J0Y19zYWd2X21hc2sgbm93
IGlzIHBpcGVfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRXh0cmFjdGVkIHNhZ3Yg
Y2hlY2tpbmcgbG9naWMgZnJvbSBza2wvaWNsL3RnbF9jb21wdXRlX3NhZ3ZfbWFzawogICAgLSBF
eHRyYWN0ZWQgc2tsX3BsYW5lX3dtX2xldmVsIGZ1bmN0aW9uIGFuZCBwYXNzaW5nIGxhdGVuY3kg
dG8KICAgICAgc2VwYXJhdGUgcGF0Y2hlcyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIFJlbW92ZWQg
cGFydCBvZiB1bm5lZWRlZCBjb3B5LXBhc3RlIGZyb20gdGdsX2NoZWNrX3BpcGVfZml0c19zYWd2
X3dtCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIE5vdyB1c2luZyBzaW1wbGUgYXNzaWdu
bWVudCBmb3Igc2Fndl93bTAgYXMgaXQgY29udGFpbnMgb25seQogICAgICBwb2QgdHlwZXMgYW5k
IG5vIHBvaW50ZXJzKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRml4ZWQgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2IG5vdCB0byBkbyBkb3VibGUgZHV0eSwgbm93IGl0IG9ubHkKICAgICAgY2hlY2sgU0FH
ViBiaXRzIGJ5IEFORGluZyB0aG9zZSBiZXR3ZWVuIGxvY2FsIGFuZCBnbG9iYWwgc3RhdGUuCiAg
ICAgIFRoZSBTQUdWIG1hc2tzIGFyZSBub3cgY29tcHV0ZWQgYWZ0ZXIgd2F0ZXJtYXJrcyBhcmUg
YXZhaWxhYmxlLAogICAgICBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGZpZ3VyZSBvdXQgaWYgZGRi
IHJhbmdlcyBhcmUgZml0dGluZyBuaWNlbHkuCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IE5vdyBoYXZpbmcgdXZfc2Fndl93bTAgYW5kIHNhZ3Zfd20wLCBvdGhlcndpc2Ugd2UgaGF2ZSB3
cm9uZyBsb2dpYwogICAgICB3aGVuIHVzaW5nIHNrbF9wbGFuZV93bV9sZXZlbCBhY2Nlc3Nvciwg
YXMgd2UgaGFkIHByZXZpb3VzbHkgZm9yCiAgICAgIEdlbjExKyBjb2xvciBwbGFuZSBhbmQgcmVn
dWxhciB3bSBsZXZlbHMsIHNvIHByb2JhYmx5IGJvdGgKICAgICAgaGFzIHRvIGJlIHJlY2FsY3Vs
YXRlZCB3aXRoIGFkZGl0aW9uYWwgU0FHViBibG9jayB0aW1lIGZvciBMZXZlbCAwLgoKdjEwOiAt
IFN0YXJ0aW5nIHRvIHVzZSBuZXcgZ2xvYmFsIHN0YXRlIGZvciBzdG9yaW5nIHBpcGVfc2Fndl9t
YXNrCgp2MTE6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0IHdpdGggcmVjZW50IGRybS10aXAKICAg
ICAtIENoZWNrIGlmIHdlIHJlYWxseSBuZWVkIHRvIHJlY2FsY3VsYXRlIFNBR1YgbWFzaywgb3Ro
ZXJ3aXNlCiAgICAgICBiYWlsIG91dCB3aXRob3V0IG1ha2luZyBhbnkgY2hhbmdlcy4KICAgICAt
IFVzZSBjYWNoZWQgU0FHViByZXN1bHQsIGluc3RlYWQgb2YgcmVjYWxjdWxhdGluZyBpdCBldmVy
eXRpbWUsCiAgICAgICBpZiBid19zdGF0ZSBoYXNuJ3QgY2hhbmdlZC4KCnYxMjogLSBSZW1vdmVk
IFdBUk4gZnJvbSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YsIGluIHNvbWUgb2YgdGhlIGNvbW1pdHMK
ICAgICAgIGlmIHdlIGRvbid0IHJlY2FsY3VsYXRlZCB3YXRlcm1hcmtzLCBid19zdGF0ZSBpcyBu
b3QgcmVjYWxjdWxhdGVkLAogICAgICAgdGh1cyBsZWFkaW5nIHRvIFNBR1Ygc3RhdGUgbm90IHJl
Y2FsY3VsYXRlZCBieSB0aGUgY29tbWl0IHN0YXRlLAogICAgICAgd2hpY2ggaXMgc3RpbGwgY2Fs
bGluZyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YgZnVuY3Rpb24uIEZpeCB0aGF0CiAgICAgICBieSBq
dXN0IGFuYWx5emluZyB0aGUgY3VycmVudCBnbG9iYWwgYndfc3RhdGUgb2JqZWN0IC0gYmVjYXVz
ZQogICAgICAgd2Ugc2ltcGx5IGhhdmUgbm8gb3RoZXIgb2JqZWN0cyByZWxhdGVkIHRvIHRoYXQu
Cgp2MTM6IC0gUmViYXNlZCwgZml4ZWQgd2FybmluZ3MgcmVnYXJkaW5nIGxvbmcgbGluZXMKICAg
ICAtIENoYW5nZWQgZnVuY3Rpb24gY2FsbCBzaXRlcyBmcm9tIGludGVsX2F0b21pY19idyogdG8K
ICAgICAgIGludGVsX3diXyogYXMgd2FzIHN1Z2dlc3RlZC4oSmFuaSBOaWt1bGEpCiAgICAgLSBU
YWtlbiBkZGJfc3RhdGVfY2hhbmdlZCBhbmQgYndfc3RhdGVfY2hhbmdlZCBpbnRvIHVzZS4KCnYx
NDogLSB0b3RhbF9hZmZlY3RlZF9wbGFuZXMgaXMgbm8gbG9uZ2VyIG5lZWRlZCB0byBjaGVjayBm
b3IgZGRiIGNoYW5nZXMsCiAgICAgICBqdXN0IGFzIGFjdGl2ZV9waXBlX2NoYW5nZXMuCgp2MTU6
IC0gRml4ZWQgc3R1cGlkIG1pc3Rha2Ugd2l0aCB1bmluaXRpYWxpemVkIGNydGMgaW4KICAgICAg
IHNrbF9jb21wdXRlX3NhZ3ZfbWFzay4KClNpZ25lZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNr
aXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2
aWxsZS5zeXJqYWxhQGludGVsLmNvbT4KQ2M6IEphbWVzIEF1c211cyA8amFtZXMuYXVzbXVzQGlu
dGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmggICAg
ICAgfCAgMTggKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMg
IHwgIDI3ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAg
fCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyAgICAgICAgICAgICAgIHwg
NDI3ICsrKysrKysrKysrKysrKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCAg
ICAgICAgICAgICAgIHwgICA0ICstCiA1IGZpbGVzIGNoYW5nZWQsIDQzNiBpbnNlcnRpb25zKCsp
LCA0MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2J3LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmgK
aW5kZXggYjVmNjE0NjM5MjJmLi5jMzJiNTI4NWMxMmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2J3LmgKQEAgLTE4LDYgKzE4LDI0IEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlOwogc3RydWN0IGludGVsX2J3X3N0YXRlIHsKIAlzdHJ1Y3QgaW50ZWxfZ2xvYmFsX3N0YXRl
IGJhc2U7CiAKKwkvKgorCSAqIENvbnRhaW5zIGEgYml0IG1hc2ssIHVzZWQgdG8gZGV0ZXJtaW5l
LCB3aGV0aGVyIGNvcnJlc3BvbmRlbnQKKwkgKiBwaXBlIGFsbG93cyBTQUdWIG9yIG5vdC4KKwkg
Ki8KKwl1OCBwaXBlX3NhZ3ZfbWFzazsKKworCS8qCisJICogVXNlZCB0byBkZXRlcm1pbmUgaWYg
d2UgYWxyZWFkeSBoYWQgY2FsY3VsYXRlZAorCSAqIFNBR1YgbWFzayBmb3IgdGhpcyBzdGF0ZSBv
bmNlLgorCSAqLworCWJvb2wgc2Fndl9jYWxjdWxhdGVkOworCisJLyoKKwkgKiBDb250YWlucyBm
aW5hbCBTQUdWIGRlY2lzaW9uIGJhc2VkIG9uIGN1cnJlbnQgbWFzaywKKwkgKiB0byBwcmV2ZW50
IGRvaW5nIHRoZSBzYW1lIGpvYiBvdmVyIGFuZCBvdmVyIGFnYWluLgorCSAqLworCWJvb2wgY2Fu
X3NhZ3Y7CisKIAl1bnNpZ25lZCBpbnQgZGF0YV9yYXRlW0k5MTVfTUFYX1BJUEVTXTsKIAl1OCBu
dW1fYWN0aXZlX3BsYW5lc1tJOTE1X01BWF9QSVBFU107CiB9OwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA1ZmNhODBiMjNhMGUuLjI0OTFmNDY0
YmViOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
QEAgLTE0MDE2LDcgKzE0MDE2LDEwIEBAIHN0YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJLyogV2F0ZXJtYXJrcyAqLwogCQlmb3IgKGxldmVsID0g
MDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7CiAJCQlpZiAoc2tsX3dtX2xldmVsX2Vx
dWFscygmaHdfcGxhbmVfd20tPndtW2xldmVsXSwKLQkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2
ZWxdKSkKKwkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxdKSB8fAorCQkJICAgKHNrbF93bV9s
ZXZlbF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53bVtsZXZlbF0sCisJCQkJCQkmc3dfcGxhbmVfd20t
PnNhZ3Zfd20wKSAmJgorCQkJICAgKGxldmVsID09IDApKSkKIAkJCQljb250aW51ZTsKIAogCQkJ
ZHJtX2VycigmZGV2X3ByaXYtPmRybSwKQEAgLTE0MDcxLDcgKzE0MDc0LDEwIEBAIHN0YXRpYyB2
b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJLyogV2F0ZXJt
YXJrcyAqLwogCQlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7
CiAJCQlpZiAoc2tsX3dtX2xldmVsX2VxdWFscygmaHdfcGxhbmVfd20tPndtW2xldmVsXSwKLQkJ
CQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxdKSkKKwkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2
ZWxdKSB8fAorCQkJICAgKHNrbF93bV9sZXZlbF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53bVtsZXZl
bF0sCisJCQkJCQkmc3dfcGxhbmVfd20tPnNhZ3Zfd20wKSAmJgorCQkJICAgKGxldmVsID09IDAp
KSkKIAkJCQljb250aW51ZTsKIAogCQkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKQEAgLTE1NTQ4
LDkgKzE1NTU0LDExIEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJICogU0tMIHdvcmthcm91bmQ6IGJzcGVj
IHJlY29tbWVuZHMgd2UgZGlzYWJsZSB0aGUgU0FHViB3aGVuIHdlCiAJCSAqIGhhdmUgbW9yZSB0
aGVuIG9uZSBwaXBlIGVuYWJsZWQKIAkJICovCi0JCWlmIChzdGF0ZS0+Yndfc3RhdGVfY2hhbmdl
ZCkgewotCQkJaWYgKCFpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQotCQkJCWludGVsX2Rp
c2FibGVfc2FndihkZXZfcHJpdik7CisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpIHsK
KwkJCWlmIChzdGF0ZS0+Yndfc3RhdGVfY2hhbmdlZCkgeworCQkJCWlmICghaW50ZWxfY2FuX2Vu
YWJsZV9zYWd2KGRldl9wcml2KSkKKwkJCQkJaW50ZWxfZGlzYWJsZV9zYWd2KGRldl9wcml2KTsK
KwkJCX0KIAkJfQogCiAJCWludGVsX21vZGVzZXRfdmVyaWZ5X2Rpc2FibGVkKGRldl9wcml2LCBz
dGF0ZSk7CkBAIC0xNTY1MSw5ICsxNTY1OSwxMSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNf
Y29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKHN0YXRl
LT5tb2Rlc2V0KQogCQlpbnRlbF92ZXJpZnlfcGxhbmVzKHN0YXRlKTsKIAotCWlmIChzdGF0ZS0+
Yndfc3RhdGVfY2hhbmdlZCkgewotCQlpZiAoaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKQot
CQkJaW50ZWxfZW5hYmxlX3NhZ3YoZGV2X3ByaXYpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
IDwgMTEpIHsKKwkJaWYgKHN0YXRlLT5id19zdGF0ZV9jaGFuZ2VkKSB7CisJCQlpZiAoaW50ZWxf
Y2FuX2VuYWJsZV9zYWd2KGRldl9wcml2KSkKKwkJCQlpbnRlbF9lbmFibGVfc2FndihkZXZfcHJp
dik7CisJCX0KIAl9CiAKIAlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfaHdfZG9uZSgmc3RhdGUt
PmJhc2UpOwpAQCAtMTU4MDYsNyArMTU4MTYsNiBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19j
b21taXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAogCWlmIChzdGF0ZS0+Z2xvYmFsX3N0YXRl
X2NoYW5nZWQpIHsKIAkJYXNzZXJ0X2dsb2JhbF9zdGF0ZV9sb2NrZWQoZGV2X3ByaXYpOwotCiAJ
CWRldl9wcml2LT5hY3RpdmVfcGlwZXMgPSBzdGF0ZS0+YWN0aXZlX3BpcGVzOwogCX0KIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVz
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApp
bmRleCBjNTdkZTk4NTUzYTguLjg5YTczZTczNWIyMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTY2Myw2ICs2NjMsOCBA
QCBzdHJ1Y3Qgc2tsX3BsYW5lX3dtIHsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHdtWzhdOwogCXN0
cnVjdCBza2xfd21fbGV2ZWwgdXZfd21bOF07CiAJc3RydWN0IHNrbF93bV9sZXZlbCB0cmFuc193
bTsKKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHNhZ3Zfd20wOworCXN0cnVjdCBza2xfd21fbGV2ZWwg
dXZfc2Fndl93bTA7CiAJYm9vbCBpc19wbGFuYXI7CiB9OwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0u
YwppbmRleCBhYzRiMzE3ZWExYmYuLjAxMWM5ZDRiYTAxNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9w
bS5jCkBAIC00Miw2ICs0Miw3IEBACiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJp
OTE1X2lycS5oIgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2lu
dGVsX2J3LmgiCiAjaW5jbHVkZSAiaW50ZWxfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFu
ZC5oIgogI2luY2x1ZGUgIi4uLy4uLy4uL3BsYXRmb3JtL3g4Ni9pbnRlbF9pcHMuaCIKQEAgLTM2
MjAsNyArMzYyMSw3IEBAIHN0YXRpYyBib29sIHNrbF9uZWVkc19tZW1vcnlfYndfd2Eoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBJU19HRU45X0JDKGRldl9wcml2
KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KTsKIH0KIAotc3RhdGljIGJvb2wKK2Jvb2wKIGludGVs
X2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAkvKiBIQUNL
ISAqLwpAQCAtMzc0MywzOSArMzc0NCwyNCBAQCBpbnRlbF9kaXNhYmxlX3NhZ3Yoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiAwOwogfQogCi1ib29sIGludGVsX2Nh
bl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3N0YXRpYyBi
b29sIHNrbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlwZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSwKKwkJCQkJZW51bSBwaXBlIHBpcGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IHN0YXRlLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKLQll
bnVtIHBpcGUgcGlwZTsKIAlpbnQgbGV2ZWwsIGxhdGVuY3k7CiAKLQlpZiAoIWludGVsX2hhc19z
YWd2KGRldl9wcml2KSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JLyoKLQkgKiBJZiB0aGVyZSBhcmUg
bm8gYWN0aXZlIENSVENzLCBubyBhZGRpdGlvbmFsIGNoZWNrcyBuZWVkIGJlIHBlcmZvcm1lZAot
CSAqLwotCWlmIChod2VpZ2h0OChzdGF0ZS0+YWN0aXZlX3BpcGVzKSA9PSAwKQotCQlyZXR1cm4g
dHJ1ZTsKLQotCS8qCi0JICogU0tMKyB3b3JrYXJvdW5kOiBic3BlYyByZWNvbW1lbmRzIHdlIGRp
c2FibGUgU0FHViB3aGVuIHdlIGhhdmUKLQkgKiBtb3JlIHRoZW4gb25lIHBpcGUgZW5hYmxlZAot
CSAqLwotCWlmIChod2VpZ2h0OChzdGF0ZS0+YWN0aXZlX3BpcGVzKSA+IDEpCi0JCXJldHVybiBm
YWxzZTsKLQotCS8qIFNpbmNlIHdlJ3JlIG5vdyBndWFyYW50ZWVkIHRvIG9ubHkgaGF2ZSBvbmUg
YWN0aXZlIENSVEMuLi4gKi8KLQlwaXBlID0gZmZzKHN0YXRlLT5hY3RpdmVfcGlwZXMpIC0gMTsK
IAljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOwogCWNydGNf
c3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCi0JaWYgKGNy
dGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFD
RSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZM
QUdfSU5URVJMQUNFKSB7CisJCURSTV9ERUJVR19LTVMoIk5vIFNBR1YgZm9yIGludGVybGFjZWQg
bW9kZSBvbiBwaXBlICVjXG4iLAorCQkJICAgICAgcGlwZV9uYW1lKHBpcGUpKTsKIAkJcmV0dXJu
IGZhbHNlOworCX0KIAogCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoZGV2LCBjcnRjLCBw
bGFuZSkgewogCQlzdHJ1Y3Qgc2tsX3BsYW5lX3dtICp3bSA9CkBAIC0zODAyLDEzICszNzg4LDE3
MyBAQCBib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAkJICogaW5jdXIgbWVtb3J5IGxhdGVuY2llcyBoaWdoZXIgdGhhbiBzYWd2X2Js
b2NrX3RpbWVfdXMgd2UKIAkJICogY2FuJ3QgZW5hYmxlIFNBR1YuCiAJCSAqLwotCQlpZiAobGF0
ZW5jeSA8IGRldl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVfdXMpCisJCWlmIChsYXRlbmN5IDwgZGV2
X3ByaXYtPnNhZ3ZfYmxvY2tfdGltZV91cykgeworCQkJRFJNX0RFQlVHX0tNUygiTGF0ZW5jeSAl
ZCA8IHNhZ3YgYmxvY2sgdGltZSAlZCwgbm8gU0FHViBmb3IgcGlwZSAlY1xuIiwKKwkJCQkgICAg
ICBsYXRlbmN5LCBkZXZfcHJpdi0+c2Fndl9ibG9ja190aW1lX3VzLCBwaXBlX25hbWUocGlwZSkp
OwogCQkJcmV0dXJuIGZhbHNlOworCQl9CiAJfQogCiAJcmV0dXJuIHRydWU7CiB9CiAKK3N0YXRp
YyB2b2lkIHNrbF9jb21wdXRlX3NhZ3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKK3sKKwllbnVtIHBpcGUgcGlwZTsKKwlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKm5ld19i
d19zdGF0ZSA9IGludGVsX2J3X2dldF9zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19i
d19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCXJl
dHVybjsKKwl9CisKKwlpZiAoc3RhdGUtPmFjdGl2ZV9waXBlcyAhPSAxKSB7CisJCW5ld19id19z
dGF0ZS0+cGlwZV9zYWd2X21hc2sgPSAwOworCQlEUk1fREVCVUdfS01TKCJObyBTQUdWIGZvciBt
dWx0aXBsZSBwaXBlcyBvbiBHZW4gOVxuIik7CisJCXJldHVybjsKKwl9CisKKwkvKiBTaW5jZSB3
ZSdyZSBub3cgZ3VhcmFudGVlZCB0byBvbmx5IGhhdmUgb25lIGFjdGl2ZSBDUlRDLi4uICovCisJ
cGlwZSA9IGZmcyhzdGF0ZS0+YWN0aXZlX3BpcGVzKSAtIDE7CisKKwlpZiAoc2tsX2Nhbl9lbmFi
bGVfc2Fndl9vbl9waXBlKHN0YXRlLCBwaXBlKSkKKwkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3Zf
bWFzayB8PSBCSVQocGlwZSk7CisJZWxzZQorCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9tYXNr
ICY9IH5CSVQocGlwZSk7Cit9CisKK3N0YXRpYyB2b2lkIHRnbF9jb21wdXRlX3NhZ3ZfbWFzayhz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7CisKK3N0YXRpYyB2b2lkIGljbF9jb21w
dXRlX3NhZ3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNf
c3RhdGU7CisJaW50IGk7CisJc3RydWN0IGludGVsX2J3X3N0YXRlICpuZXdfYndfc3RhdGUgPSBp
bnRlbF9id19nZXRfc3RhdGUoc3RhdGUpOworCisJaWYgKElTX0VSUihuZXdfYndfc3RhdGUpKSB7
CisJCVdBUk4oMSwgIkNvdWxkIG5vdCBnZXQgYndfc3RhdGVcbiIpOworCQlyZXR1cm47CisJfQor
CisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsCisJCQkJCSBu
ZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAoc2tsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBlKHN0
YXRlLCBjcnRjLT5waXBlKSkKKwkJCW5ld19id19zdGF0ZS0+cGlwZV9zYWd2X21hc2sgfD0gQklU
KGNydGMtPnBpcGUpOworCQllbHNlCisJCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9tYXNrICY9
IH5CSVQoY3J0Yy0+cGlwZSk7CisJfQorfQorCitzdGF0aWMgdm9pZCBpbnRlbF9jb21wdXRlX3Nh
Z3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlpbnQgcmV0Owor
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBpbnRlbF9id19z
dGF0ZSAqbmV3X2J3X3N0YXRlOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqb2xkX2J3X3N0YXRl
OworCisJLyoKKwkgKiBJZiB3ZSBhcmUgaGVyZSAtIG1lYW5zIGVpdGhlciBhY3RpdmVfcGlwZXMg
Y29uZmlnIGhhZCBjaGFuZ2VkLAorCSAqIG9yIHdhdGVybWFya3MvZGRiIGhhcyBiZWVuIGNoYW5n
ZWQsIHdoaWNoIG1lYW5zIG1vc3QgbGlrZWx5CisJICogd2UgaGFkIGNydGNzIGFkZGVkIHRvIHRo
ZSBzdGF0ZShhdCBsZWFzdCBzdGF0ZSBpcyByZWFkIGxvY2tlZCkKKwkgKiBhbmQgd2UgZGVmaW5p
dGVseSBuZWVkIHRvIHJlY2FsY3VsYXRlIFNBR1Ygc3RhdGUgbm93LgorCSAqLworCW5ld19id19z
dGF0ZSA9IGludGVsX2J3X2dldF9zdGF0ZShzdGF0ZSk7CisJb2xkX2J3X3N0YXRlID0gaW50ZWxf
YndfZ2V0X29sZF9zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkgfHwg
SVNfRVJSKG9sZF9id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0
ZVxuIik7CisJCXJldHVybjsKKwl9CisKKwluZXdfYndfc3RhdGUtPnNhZ3ZfY2FsY3VsYXRlZCA9
IGZhbHNlOworCisJLyoKKwkgKiBOb3cgb25jZSB3ZSBnb3Qgd20gbGV2ZWxzIGNhbGN1bGF0ZWQs
CisJICogY2hlY2sgaWYgd2UgY2FuIGhhdmUgU0FHVi4KKwkgKi8KKwlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMikKKwkJdGdsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlKTsKKwllbHNlIGlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDExKQorCQlpY2xfY29tcHV0ZV9zYWd2X21hc2soc3Rh
dGUpOworCWVsc2UKKwkJc2tsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlKTsKKworCS8qCisJICog
Rm9yIFNBR1Ygd2UgbmVlZCB0byBhY2NvdW50IGFsbCB0aGUgcGlwZXMsCisJICogbm90IG9ubHkg
dGhlIG9uZXMgd2hpY2ggYXJlIGluIHN0YXRlIGN1cnJlbnRseS4KKwkgKiBHcmFiIGFsbCBsb2Nr
cyBpZiB3ZSBkZXRlY3QgdGhhdCB3ZSBhcmUgYWN0dWFsbHkKKwkgKiBnb2luZyB0byBkbyBzb21l
dGhpbmcuCisJICovCisJaWYgKG5ld19id19zdGF0ZS0+cGlwZV9zYWd2X21hc2sgIT0gb2xkX2J3
X3N0YXRlLT5waXBlX3NhZ3ZfbWFzaykgeworCQlyZXQgPSBpbnRlbF9hdG9taWNfc2VyaWFsaXpl
X2dsb2JhbF9zdGF0ZSgmbmV3X2J3X3N0YXRlLT5iYXNlKTsKKwkJaWYgKHJldCkgeworCQkJRFJN
X0RFQlVHX0tNUygiQ291bGQgbm90IHNlcmlhbGl6ZSBnbG9iYWwgc3RhdGVcbiIpOworCQkJcmV0
dXJuOworCQl9CisKKwkJRFJNX0RFQlVHX0tNUygiTWFya2luZyBidyBzdGF0ZSBjaGFuZ2VkIGZv
ciBhdG9taWMgc3RhdGUgJXBcbiIsIHN0YXRlKTsKKworCQlzdGF0ZS0+Yndfc3RhdGVfY2hhbmdl
ZCA9IHRydWU7CisJfQorfQorCitzdGF0aWMgYm9vbCBpbnRlbF9jYWxjdWxhdGVfc2Fndl9yZXN1
bHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCQlzdHJ1Y3QgaW50ZWxf
Yndfc3RhdGUgKmJ3X3N0YXRlKQoreworCWJvb2wgc2Fndl9yZXN1bHQgPSB0cnVlOworCWVudW0g
cGlwZSBwaXBlOworCisJZm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCQkvKgorCQkg
KiBUT0RPOiBXZSBhcmUgZGVwZW5kaW5nIG9uIGFjdGl2ZV9waXBlcyBoZXJlLAorCQkgKiBwcm9i
YWJseSBpdCBzaG91bGQgYmUgcGFydCBvZiBzb21lIG90aGVyIGdsb2JhbCBzdGF0ZQorCQkgKiBv
YmosIGxpa2UgbW9kZXNldF9zdGF0ZSBvciBzbXRoLCB3aGljaCB3ZSBzaG91bGQgZGVwZW5kIG9u
LgorCQkgKiBEb24ndCB3YW50IHRvIGNsb25lIGl0IGhlcmUsIHJlYWxseS4KKwkJICovCisJCWlu
dCBhY3RpdmVfcGlwZV9iaXQgPSBkZXZfcHJpdi0+YWN0aXZlX3BpcGVzICYgQklUKHBpcGUpOwor
CisJCWlmIChhY3RpdmVfcGlwZV9iaXQpIHsKKwkJCWlmICgoYndfc3RhdGUtPnBpcGVfc2Fndl9t
YXNrICYgQklUKHBpcGUpKSA9PSAwKSB7CisJCQkJc2Fndl9yZXN1bHQgPSBmYWxzZTsKKwkJCQli
cmVhazsKKwkJCX0KKwkJfQorCX0KKworCXJldHVybiBzYWd2X3Jlc3VsdDsKK30KKworLyoKKyAq
IFRoaXMgZnVuY3Rpb24gdG8gYmUgdXNlZCBiZWZvcmUgc3dhcCBzdGF0ZQorICovCitib29sIGlu
dGVsX2Nhbl9lbmFibGVfc2Fndl9mb3Jfc3RhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0
IGludGVsX2J3X3N0YXRlICpid19zdGF0ZSAgPSBpbnRlbF9id19nZXRfc3RhdGUoc3RhdGUpOwor
CisJaWYgKElTX0VSUihid19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19z
dGF0ZVxuIik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlpZiAoIWludGVsX2hhc19zYWd2KGRl
dl9wcml2KSkgeworCQlEUk1fREVCVUdfS01TKCJObyBTQUdWIHN1cHBvcnQgZGV0ZWN0ZWRcbiIp
OworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJaWYgKGJ3X3N0YXRlLT5zYWd2X2NhbGN1bGF0ZWQp
CisJCWdvdG8gb3V0OworCisJYndfc3RhdGUtPmNhbl9zYWd2ID0gaW50ZWxfY2FsY3VsYXRlX3Nh
Z3ZfcmVzdWx0KGRldl9wcml2LCBid19zdGF0ZSk7CisJYndfc3RhdGUtPnNhZ3ZfY2FsY3VsYXRl
ZCA9IHRydWU7CisKK291dDoKKwlyZXR1cm4gYndfc3RhdGUtPmNhbl9zYWd2OworfQorCiAvKgog
ICogQ2FsY3VsYXRlIGluaXRpYWwgREJ1ZiBzbGljZSBvZmZzZXQsIGJhc2VkIG9uIHNsaWNlIHNp
emUKICAqIGFuZCBtYXNrKGkuZSBpZiBzbGljZSBzaXplIGlzIDEwMjQgYW5kIHNlY29uZCBzbGlj
ZSBpcyBlbmFibGVkCkBAIC0zODQyLDYgKzM5ODgsMzUgQEAgc3RhdGljIHUxNiBpbnRlbF9nZXRf
ZGRiX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBkZGJf
c2l6ZTsKIH0KIAorLyoKKyAqIFRvIGJlIHVzZWQgYWZ0ZXIgd2Ugc3dhcCBzdGF0ZQorICovCiti
b29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCit7CisJc3RydWN0IGludGVsX2dsb2JhbF9zdGF0ZSAqZ2xvYmFsX3N0YXRlOworCXN0cnVj
dCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGU7CisKKwlnbG9iYWxfc3RhdGUgPSBkZXZfcHJpdi0+
Yndfb2JqLnN0YXRlOworCWlmIChJU19FUlIoZ2xvYmFsX3N0YXRlKSkgeworCQlXQVJOKDEsICJD
b3VsZCBub3QgZ2V0IGdsb2JhbCBzdGF0ZVxuIik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwkv
KgorCSAqIFRPRE86IFNob3VsZCB3ZSBzdGlsbCBtYXkgYmUgbG9jayBnbG9iYWwgc3RhdGUgaGVy
ZT8KKwkgKi8KKwlid19zdGF0ZSA9IHRvX2ludGVsX2J3X3N0YXRlKGdsb2JhbF9zdGF0ZSk7CisK
KwlpZiAoYndfc3RhdGUtPnNhZ3ZfY2FsY3VsYXRlZCkKKwkJZ290byBvdXQ7CisKKwlid19zdGF0
ZS0+Y2FuX3NhZ3YgPSBpbnRlbF9jYWxjdWxhdGVfc2Fndl9yZXN1bHQoZGV2X3ByaXYsIGJ3X3N0
YXRlKTsKKwlid19zdGF0ZS0+c2Fndl9jYWxjdWxhdGVkID0gdHJ1ZTsKKworb3V0OgorCXJldHVy
biBid19zdGF0ZS0+Y2FuX3NhZ3Y7Cit9CisKIHN0YXRpYyB1OCBza2xfY29tcHV0ZV9kYnVmX3Ns
aWNlcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgIHUz
MiBhY3RpdmVfcGlwZXMpOwogCkBAIC00MDI4LDYgKzQyMDMsNyBAQCBza2xfY3Vyc29yX2FsbG9j
YXRpb24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXUzMiBs
YXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5W2xldmVsXTsKIAogCQlza2xfY29tcHV0
ZV9wbGFuZV93bShjcnRjX3N0YXRlLCBsZXZlbCwgbGF0ZW5jeSwgJndwLCAmd20sICZ3bSk7CisK
IAkJaWYgKHdtLm1pbl9kZGJfYWxsb2MgPT0gVTE2X01BWCkKIAkJCWJyZWFrOwogCkBAIC00NTU0
LDEyICs0NzMwLDkyIEBAIHNrbF9wbGFuZV93bV9sZXZlbChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAogCQkgICBpbnQgbGV2ZWwsCiAJCSAgIGludCBjb2xvcl9wbGFuZSkKIHsKKwlzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRlLT51YXBpLnN0YXRlOworCXN0cnVj
dCBkcm1fY3J0YyAqY3J0YyA9IGNydGNfc3RhdGUtPnVhcGkuY3J0YzsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CiAJY29uc3Qgc3RydWN0
IHNrbF9wbGFuZV93bSAqd20gPQogCQkmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxhbmVz
W3BsYW5lLT5pZF07CiAKKwlpZiAoIWxldmVsKSB7CisJCWJvb2wgY2FuX3NhZ3YgPSBmYWxzZTsK
KworCQkvKgorCQkgKiBJZiB3ZSBoYXZlbid0IHlldCBzd2FwcGVkIG91ciBzdGF0ZSwgd2Ugc2hv
dWxkIHVzZQorCQkgKiB0aGUgc3RhdGUgdG8gZGV0ZXJtaW5lIFNBR1YsIG90aGVyd2lzZSB1c2Ug
Z2xvYmFsCisJCSAqIHN0YXRlIGFzIGF0b21pYyBzdGF0ZSBwb2ludGVyIG1pZ2h0IGJlY29tZSBz
dGFsZQorCQkgKiBhbmQgemVyb2VkIG91dC4KKwkJICovCisJCWlmIChzdGF0ZSkgeworCQkJc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPQorCQkJCXRvX2ludGVsX2F0b21p
Y19zdGF0ZShzdGF0ZSk7CisJCQljYW5fc2FndiA9IGludGVsX2Nhbl9lbmFibGVfc2Fndl9mb3Jf
c3RhdGUoaW50ZWxfc3RhdGUpOworCQl9IGVsc2UgeworCQkJY2FuX3NhZ3YgPSBpbnRlbF9jYW5f
ZW5hYmxlX3NhZ3YoZGV2X3ByaXYpOworCQl9CisKKwkJaWYgKGNhbl9zYWd2KQorCQkJcmV0dXJu
IGNvbG9yX3BsYW5lID8gJndtLT51dl9zYWd2X3dtMCA6ICZ3bS0+c2Fndl93bTA7CisJfQorCiAJ
cmV0dXJuIGNvbG9yX3BsYW5lID8gJndtLT51dl93bVtsZXZlbF0gOiAmd20tPndtW2xldmVsXTsK
IH0KIAorc3RhdGljIGludAordGdsX2NoZWNrX3BpcGVfZml0c19zYWd2X3dtKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNy
dGNfc3RhdGUtPnVhcGkuY3J0YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGMtPmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKGNydGMpOworCXN0cnVjdCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjcnRj
X3N0YXRlLT53bS5za2wuZGRiOworCXUxNiBhbGxvY19zaXplOworCXU2NCB0b3RhbF9kYXRhX3Jh
dGU7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZDsKKwlpbnQgbnVtX2FjdGl2ZTsKKwl1NjQgcGxh
bmVfZGF0YV9yYXRlW0k5MTVfTUFYX1BMQU5FU10gPSB7fTsKKwl1MzIgYmxvY2tzOworCisJLyoK
KwkgKiBObyBuZWVkIHRvIGNoZWNrIGdlbiBoZXJlLCB3ZSBjYWxsIHRoaXMgb25seSBmb3IgZ2Vu
MTIKKwkgKi8KKwl0b3RhbF9kYXRhX3JhdGUgPQorCQlpY2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2Rh
dGFfcmF0ZShjcnRjX3N0YXRlLAorCQkJCQkJIHBsYW5lX2RhdGFfcmF0ZSk7CisKKwlza2xfZGRi
X2dldF9waXBlX2FsbG9jYXRpb25fbGltaXRzKGRldl9wcml2LCBjcnRjX3N0YXRlLAorCQkJCQkg
ICB0b3RhbF9kYXRhX3JhdGUsCisJCQkJCSAgIGFsbG9jLCAmbnVtX2FjdGl2ZSk7CisJYWxsb2Nf
c2l6ZSA9IHNrbF9kZGJfZW50cnlfc2l6ZShhbGxvYyk7CisJaWYgKGFsbG9jX3NpemUgPT0gMCkK
KwkJcmV0dXJuIC1FTk9TUEM7CisKKwkvKgorCSAqIERvIGNoZWNrIGlmIHdlIGNhbiBmaXQgTDAg
KyBzYWd2X2Jsb2NrX3RpbWUgYW5kCisJICogZGlzYWJsZSBTQUdWIGlmIHdlIGNhbid0LgorCSAq
LworCWJsb2NrcyA9IDA7CisJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhpbnRlbF9jcnRjLCBw
bGFuZV9pZCkgeworCQkvKgorCQkgKiBUaGUgb25seSBwbGFjZSwgd2hlcmUgd2UgY2FuJ3QgdXNl
IHNrbF9wbGFuZV93bV9sZXZlbAorCQkgKiBhY2Nlc3NvciwgYmVjYXVzZSBpZiBhY3R1YWxseSBj
YWxscyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKKwkJICogd2hpY2ggZGVwZW5kcyBvbiB0aGF0IGZ1
bmN0aW9uLgorCQkgKi8KKwkJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQorCQkJJmNy
dGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisKKwkJYmxvY2tzICs9
IHdtLT5zYWd2X3dtMC5taW5fZGRiX2FsbG9jOworCQlibG9ja3MgKz0gd20tPnV2X3NhZ3Zfd20w
Lm1pbl9kZGJfYWxsb2M7CisKKwkJaWYgKGJsb2NrcyA+IGFsbG9jX3NpemUpIHsKKwkJCURSTV9E
RUJVR19LTVMoIk5vdCBlbm91Z2ggZGRiIGJsb2NrcyglZDwlZCkgZm9yIFNBR1Ygb24gcGlwZSAl
Y1xuIiwKKwkJCQkgICAgICBhbGxvY19zaXplLCBibG9ja3MsIHBpcGVfbmFtZShpbnRlbF9jcnRj
LT5waXBlKSk7CisJCQlyZXR1cm4gLUVOT1NQQzsKKwkJfQorCX0KKwlEUk1fREVCVUdfS01TKCIl
ZCB0b3RhbCBibG9ja3MgcmVxdWlyZWQgZm9yIFNBR1YsIGRkYiBlbnRyeSBzaXplICVkXG4iLAor
CQkgICAgICBibG9ja3MsIGFsbG9jX3NpemUpOworCXJldHVybiAwOworfQorCiBzdGF0aWMgaW50
CiBza2xfYWxsb2NhdGVfcGlwZV9kZGIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCiB7CkBAIC01MTQzLDExICs1Mzk5LDE5IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21wdXRlX3Bs
YW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGlj
IHZvaWQKIHNrbF9jb21wdXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJICAgICAgY29uc3Qgc3RydWN0IHNrbF93bV9wYXJhbXMgKndtX3Bh
cmFtcywKLQkJICAgICAgc3RydWN0IHNrbF93bV9sZXZlbCAqbGV2ZWxzKQorCQkgICAgICBzdHJ1
Y3Qgc2tsX3BsYW5lX3dtICpwbGFuZV93bSwKKwkJICAgICAgYm9vbCB5dXYpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNy
dGMtPmRldik7CiAJaW50IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9w
cml2KTsKKwkvKgorCSAqIENoZWNrIHdoaWNoIGtpbmQgb2YgcGxhbmUgaXMgaXQgYW5kIGJhc2Vk
IG9uIHRoYXQgY2FsY3VsYXRlCisJICogY29ycmVzcG9uZGVudCBXTSBsZXZlbHMuCisJICovCisJ
c3RydWN0IHNrbF93bV9sZXZlbCAqbGV2ZWxzID0geXV2ID8gcGxhbmVfd20tPnV2X3dtIDogcGxh
bmVfd20tPndtOwogCXN0cnVjdCBza2xfd21fbGV2ZWwgKnJlc3VsdF9wcmV2ID0gJmxldmVsc1sw
XTsKKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpzYWd2X3dtID0geXV2ID8KKwkJCQkmcGxhbmVfd20t
PnV2X3NhZ3Zfd20wIDogJnBsYW5lX3dtLT5zYWd2X3dtMDsKIAogCWZvciAobGV2ZWwgPSAwOyBs
ZXZlbCA8PSBtYXhfbGV2ZWw7IGxldmVsKyspIHsKIAkJc3RydWN0IHNrbF93bV9sZXZlbCAqcmVz
dWx0ID0gJmxldmVsc1tsZXZlbF07CkBAIC01MTU4LDYgKzU0MjIsMjcgQEAgc2tsX2NvbXB1dGVf
d21fbGV2ZWxzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJ
CXJlc3VsdF9wcmV2ID0gcmVzdWx0OwogCX0KKwkvKgorCSAqIEZvciBHZW4xMiBpZiBpdCBpcyBh
biBMMCB3ZSBuZWVkIHRvIGFsc28KKwkgKiBjb25zaWRlciBzYWd2X2Jsb2NrX3RpbWUgd2hlbiBj
YWxjdWxhdGluZworCSAqIEwwIHdhdGVybWFyayAtIHdlIHdpbGwgbmVlZCB0aGF0IHdoZW4gbWFr
aW5nCisJICogYSBkZWNpc2lvbiB3aGV0aGVyIGVuYWJsZSBTQUdWIG9yIG5vdC4KKwkgKiBGb3Ig
b2xkZXIgZ2VucyB3ZSBhZ3JlZWQgdG8gY29weSBMMCB2YWx1ZSBmb3IKKwkgKiBjb21wYXRpYmls
aXR5LgorCSAqLworCWlmICgoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikpIHsKKwkJdTMyIGxh
dGVuY3kgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3lbMF07CisKKwkJbGF0ZW5jeSArPSBkZXZf
cHJpdi0+c2Fndl9ibG9ja190aW1lX3VzOworCQlza2xfY29tcHV0ZV9wbGFuZV93bShjcnRjX3N0
YXRlLCAwLCBsYXRlbmN5LAorCQkJCSAgICAgd21fcGFyYW1zLCAmbGV2ZWxzWzBdLAorCQkJCSAg
ICAgc2Fndl93bSk7CisJCURSTV9ERUJVR19LTVMoIiVkIEwwIGJsb2NrcyByZXF1aXJlZCBmb3Ig
U0FHViB2cyAlZCBmb3Igbm9uLVNBR1ZcbiIsCisJCQkgICAgICBzYWd2X3dtLT5taW5fZGRiX2Fs
bG9jLCBsZXZlbHNbMF0ubWluX2RkYl9hbGxvYyk7CisJfSBlbHNlIHsKKwkJLyogU2luY2UgYWxs
IG1lbWJlcnMgYXJlIFBPRCAqLworCQkqc2Fndl93bSA9IGxldmVsc1swXTsKKwl9CiB9CiAKIHN0
YXRpYyB2b2lkIHNrbF9jb21wdXRlX3RyYW5zaXRpb25fd20oY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC01MjMyLDcgKzU1MTcsNyBAQCBzdGF0aWMgaW50IHNr
bF9idWlsZF9wbGFuZV93bV9zaW5nbGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXNrbF9jb21wdXRlX3dtX2xldmVscyhj
cnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bS0+d20pOworCXNrbF9jb21wdXRlX3dtX2xldmVscyhj
cnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bSwgZmFsc2UpOwogCXNrbF9jb21wdXRlX3RyYW5zaXRp
b25fd20oY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20pOwogCiAJcmV0dXJuIDA7CkBAIC01MjU0
LDcgKzU1MzksNyBAQCBzdGF0aWMgaW50IHNrbF9idWlsZF9wbGFuZV93bV91dihzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0J
c2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtLT51dl93bSk7
CisJc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtLCB0cnVl
KTsKIAogCXJldHVybiAwOwogfQpAQCAtNTU4NSw5ICs1ODcwLDI0IEBAIHNrbF9wcmludF93bV9j
aGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQlmb3JfZWFjaF9pbnRl
bF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjLCBwbGFuZSkgewogCQkJZW51bSBw
bGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAkJCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVf
d20gKm9sZF93bSwgKm5ld193bTsKKwkJCWNvbnN0IHN0cnVjdCBza2xfd21fbGV2ZWwgKm9sZF93
bV9sZXZlbCwgKm5ld193bV9sZXZlbDsKKwkJCXUxNiBvbGRfcGxhbmVfcmVzX2wsIG5ld19wbGFu
ZV9yZXNfbDsKKwkJCXU4ICBvbGRfcGxhbmVfcmVzX2IsIG5ld19wbGFuZV9yZXNfYjsKKwkJCXUx
NiBvbGRfbWluX2RkYl9hbGxvYywgbmV3X21pbl9kZGJfYWxsb2M7CiAKIAkJCW9sZF93bSA9ICZv
bGRfcGlwZV93bS0+cGxhbmVzW3BsYW5lX2lkXTsKIAkJCW5ld193bSA9ICZuZXdfcGlwZV93bS0+
cGxhbmVzW3BsYW5lX2lkXTsKKwkJCW9sZF93bV9sZXZlbCA9IHNrbF9wbGFuZV93bV9sZXZlbChw
bGFuZSwgb2xkX2NydGNfc3RhdGUsIDAsIGZhbHNlKTsKKwkJCW5ld193bV9sZXZlbCA9IHNrbF9w
bGFuZV93bV9sZXZlbChwbGFuZSwgbmV3X2NydGNfc3RhdGUsIDAsIGZhbHNlKTsKKworCQkJb2xk
X3BsYW5lX3Jlc19sID0gb2xkX3dtX2xldmVsLT5wbGFuZV9yZXNfbDsKKwkJCW9sZF9wbGFuZV9y
ZXNfYiA9IG9sZF93bV9sZXZlbC0+cGxhbmVfcmVzX2I7CisKKwkJCW5ld19wbGFuZV9yZXNfbCA9
IG5ld193bV9sZXZlbC0+cGxhbmVfcmVzX2w7CisJCQluZXdfcGxhbmVfcmVzX2IgPSBuZXdfd21f
bGV2ZWwtPnBsYW5lX3Jlc19iOworCisJCQlvbGRfbWluX2RkYl9hbGxvYyA9IG9sZF93bV9sZXZl
bC0+bWluX2RkYl9hbGxvYzsKKwkJCW5ld19taW5fZGRiX2FsbG9jID0gbmV3X3dtX2xldmVsLT5t
aW5fZGRiX2FsbG9jOwogCiAJCQlpZiAoc2tsX3BsYW5lX3dtX2VxdWFscyhkZXZfcHJpdiwgb2xk
X3dtLCBuZXdfd20pKQogCQkJCWNvbnRpbnVlOwpAQCAtNTYxMSw3ICs1OTExLDcgQEAgc2tsX3By
aW50X3dtX2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJICAg
ICJbUExBTkU6JWQ6JXNdICAgbGluZXMgJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMl
M2QsJWMlM2QsJWMlM2QsJWMlM2QiCiAJCQkJICAgICAgIiAtPiAlYyUzZCwlYyUzZCwlYyUzZCwl
YyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZFxuIiwKIAkJCQkgICAgcGxhbmUtPmJh
c2UuYmFzZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwKLQkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVsw
XS5pZ25vcmVfbGluZXMpLCBvbGRfd20tPndtWzBdLnBsYW5lX3Jlc19sLAorCQkJCSAgICBlbmFz
dChvbGRfd20tPndtWzBdLmlnbm9yZV9saW5lcyksIG9sZF9wbGFuZV9yZXNfbCwKIAkJCQkgICAg
ZW5hc3Qob2xkX3dtLT53bVsxXS5pZ25vcmVfbGluZXMpLCBvbGRfd20tPndtWzFdLnBsYW5lX3Jl
c19sLAogCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzJdLmlnbm9yZV9saW5lcyksIG9sZF93bS0+
d21bMl0ucGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+d21bM10uaWdub3JlX2xp
bmVzKSwgb2xkX3dtLT53bVszXS5wbGFuZV9yZXNfbCwKQEAgLTU2MjEsNyArNTkyMSw3IEBAIHNr
bF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJ
CSAgICBlbmFzdChvbGRfd20tPndtWzddLmlnbm9yZV9saW5lcyksIG9sZF93bS0+d21bN10ucGxh
bmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+dHJhbnNfd20uaWdub3JlX2xpbmVzKSwg
b2xkX3dtLT50cmFuc193bS5wbGFuZV9yZXNfbCwKIAotCQkJCSAgICBlbmFzdChuZXdfd20tPndt
WzBdLmlnbm9yZV9saW5lcyksIG5ld193bS0+d21bMF0ucGxhbmVfcmVzX2wsCisJCQkJICAgIGVu
YXN0KG5ld193bS0+d21bMF0uaWdub3JlX2xpbmVzKSwgbmV3X3BsYW5lX3Jlc19sLAogCQkJCSAg
ICBlbmFzdChuZXdfd20tPndtWzFdLmlnbm9yZV9saW5lcyksIG5ld193bS0+d21bMV0ucGxhbmVf
cmVzX2wsCiAJCQkJICAgIGVuYXN0KG5ld193bS0+d21bMl0uaWdub3JlX2xpbmVzKSwgbmV3X3dt
LT53bVsyXS5wbGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3QobmV3X3dtLT53bVszXS5pZ25vcmVf
bGluZXMpLCBuZXdfd20tPndtWzNdLnBsYW5lX3Jlc19sLApAQCAtNTYzNSwxMiArNTkzNSwxMiBA
QCBza2xfcHJpbnRfd21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAkJCQkgICAgIltQTEFORTolZDolc10gIGJsb2NrcyAlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwl
NGQsJTRkLCU0ZCIKIAkJCQkgICAgIiAtPiAlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRk
LCU0ZFxuIiwKIAkJCQkgICAgcGxhbmUtPmJhc2UuYmFzZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwK
LQkJCQkgICAgb2xkX3dtLT53bVswXS5wbGFuZV9yZXNfYiwgb2xkX3dtLT53bVsxXS5wbGFuZV9y
ZXNfYiwKKwkJCQkgICAgb2xkX3BsYW5lX3Jlc19iLCBvbGRfd20tPndtWzFdLnBsYW5lX3Jlc19i
LAogCQkJCSAgICBvbGRfd20tPndtWzJdLnBsYW5lX3Jlc19iLCBvbGRfd20tPndtWzNdLnBsYW5l
X3Jlc19iLAogCQkJCSAgICBvbGRfd20tPndtWzRdLnBsYW5lX3Jlc19iLCBvbGRfd20tPndtWzVd
LnBsYW5lX3Jlc19iLAogCQkJCSAgICBvbGRfd20tPndtWzZdLnBsYW5lX3Jlc19iLCBvbGRfd20t
PndtWzddLnBsYW5lX3Jlc19iLAogCQkJCSAgICBvbGRfd20tPnRyYW5zX3dtLnBsYW5lX3Jlc19i
LAotCQkJCSAgICBuZXdfd20tPndtWzBdLnBsYW5lX3Jlc19iLCBuZXdfd20tPndtWzFdLnBsYW5l
X3Jlc19iLAorCQkJCSAgICBuZXdfcGxhbmVfcmVzX2IsIG5ld193bS0+d21bMV0ucGxhbmVfcmVz
X2IsCiAJCQkJICAgIG5ld193bS0+d21bMl0ucGxhbmVfcmVzX2IsIG5ld193bS0+d21bM10ucGxh
bmVfcmVzX2IsCiAJCQkJICAgIG5ld193bS0+d21bNF0ucGxhbmVfcmVzX2IsIG5ld193bS0+d21b
NV0ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG5ld193bS0+d21bNl0ucGxhbmVfcmVzX2IsIG5ld193
bS0+d21bN10ucGxhbmVfcmVzX2IsCkBAIC01NjUwLDEyICs1OTUwLDEyIEBAIHNrbF9wcmludF93
bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJCSAgICAiW1BM
QU5FOiVkOiVzXSBtaW5fZGRiICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkIgog
CQkJCSAgICAiIC0+ICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkXG4iLAogCQkJ
CSAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJCSAgICBvbGRf
d20tPndtWzBdLm1pbl9kZGJfYWxsb2MsIG9sZF93bS0+d21bMV0ubWluX2RkYl9hbGxvYywKKwkJ
CQkgICAgb2xkX21pbl9kZGJfYWxsb2MsIG9sZF93bS0+d21bMV0ubWluX2RkYl9hbGxvYywKIAkJ
CQkgICAgb2xkX3dtLT53bVsyXS5taW5fZGRiX2FsbG9jLCBvbGRfd20tPndtWzNdLm1pbl9kZGJf
YWxsb2MsCiAJCQkJICAgIG9sZF93bS0+d21bNF0ubWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVs1
XS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRfd20tPndtWzZdLm1pbl9kZGJfYWxsb2MsIG9s
ZF93bS0+d21bN10ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgb2xkX3dtLT50cmFuc193bS5taW5f
ZGRiX2FsbG9jLAotCQkJCSAgICBuZXdfd20tPndtWzBdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+
d21bMV0ubWluX2RkYl9hbGxvYywKKwkJCQkgICAgbmV3X21pbl9kZGJfYWxsb2MsIG5ld193bS0+
d21bMV0ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgbmV3X3dtLT53bVsyXS5taW5fZGRiX2FsbG9j
LCBuZXdfd20tPndtWzNdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG5ld193bS0+d21bNF0ubWlu
X2RkYl9hbGxvYywgbmV3X3dtLT53bVs1XS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBuZXdfd20t
PndtWzZdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+d21bN10ubWluX2RkYl9hbGxvYywKQEAgLTU3
OTUsNiArNjA5NSw1OSBAQCBzdGF0aWMgaW50IHNrbF93bV9hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCXJldHVybiAwOwogfQogCitzdGF0aWMg
dm9pZCB0Z2xfY29tcHV0ZV9zYWd2X21hc2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0
ZS0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCXN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xk
X2NydGNfc3RhdGU7CisJaW50IHJldDsKKwlpbnQgaTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3X2J3X3N0YXRlICA9IGludGVsX2J3X2dl
dF9zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkpIHsKKwkJV0FSTigx
LCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCXJldHVybjsKKwl9CisKKwlmb3JfZWFj
aF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUs
CisJCQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpbnQgcGlwZV9iaXQgPSBCSVQoY3J0
Yy0+cGlwZSk7CisJCWJvb2wgc2tpcCA9IHRydWU7CisKKwkJZm9yX2VhY2hfaW50ZWxfcGxhbmVf
b25fY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YywgcGxhbmUpIHsKKwkJCWVudW0gcGxhbmVfaWQg
cGxhbmVfaWQgPSBwbGFuZS0+aWQ7CisJCQljb25zdCBzdHJ1Y3Qgc2tsX3BsYW5lX3dtICpvbGRf
d20sICpuZXdfd207CisJCQlib29sIGVxdWFsX3dtOworCisJCQlvbGRfd20gPSAmb2xkX2NydGNf
c3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisJCQluZXdfd20gPSAmbmV3
X2NydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisKKwkJCWVxdWFs
X3dtID0gc2tsX3BsYW5lX3dtX2VxdWFscyhkZXZfcHJpdiwgb2xkX3dtLCBuZXdfd20pOworCisJ
CQlpZiAoIWVxdWFsX3dtKSB7CisJCQkJc2tpcCA9IGZhbHNlOworCQkJCWJyZWFrOworCQkJfQor
CQl9CisKKwkJLyoKKwkJICogQ2hlY2sgaWYgd20gbGV2ZWxzIGFyZSBhY3R1YWxseSB0aGUgc2Ft
ZSBhcyBmb3IgcHJldmlvdXMKKwkJICogc3RhdGUsIHdoaWNoIG1lYW5zIHdlIGNhbiBqdXN0IHNr
aXAgZG9pbmcgdGhpcyBsb25nIGNoZWNrCisJCSAqIGFuZCBqdXN0ICBjb3B5IGNvcnJlc3BvbmRl
bnQgYml0IGZyb20gcHJldmlvdXMgc3RhdGUuCisJCSAqLworCQlpZiAoc2tpcCkKKwkJCWNvbnRp
bnVlOworCisJCXJldCA9IHRnbF9jaGVja19waXBlX2ZpdHNfc2Fndl93bShuZXdfY3J0Y19zdGF0
ZSk7CisJCWlmICghcmV0KQorCQkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayB8PSBwaXBl
X2JpdDsKKwkJZWxzZQorCQkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayAmPSB+cGlwZV9i
aXQ7CisJfQorfQorCiBzdGF0aWMgaW50CiBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkKIHsKQEAgLTU4MjMsNiArNjE3NiwxMyBAQCBza2xfY29tcHV0ZV93
bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJCXJldHVybiByZXQ7CiAJfQog
CisJLyoKKwkgKiBObyBhY3RpdmVfcGlwZV9jaGFuZ2VzIGFuZCBubyB3bS9kZGIgY2hhbmdlcyBt
ZWFucworCSAqIHdlIGNhbiBqdXN0IHNraXAgcmVjYWxjdWxhdGluZyBTQUdWIG1hc2suCisJICov
CisJaWYgKChzdGF0ZS0+YWN0aXZlX3BpcGVfY2hhbmdlcyAhPSAwKSB8fCBzdGF0ZS0+ZGRiX3N0
YXRlX2NoYW5nZWQpCisJCWludGVsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlKTsKKwogCXJldCA9
IHNrbF9jb21wdXRlX2RkYihzdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKQEAgLTU5
NDIsNiArNjMwMiw5IEBAIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCQkJCXZhbCA9IEk5MTVfUkVBRChDVVJfV00ocGlwZSwgbGV2ZWwpKTsK
IAogCQkJc2tsX3dtX2xldmVsX2Zyb21fcmVnX3ZhbCh2YWwsICZ3bS0+d21bbGV2ZWxdKTsKKwkJ
CWlmIChsZXZlbCA9PSAwKQorCQkJCW1lbWNweSgmd20tPnNhZ3Zfd20wLCAmd20tPndtW2xldmVs
XSwKKwkJCQkgICAgICAgc2l6ZW9mKHN0cnVjdCBza2xfd21fbGV2ZWwpKTsKIAkJfQogCiAJCWlm
IChwbGFuZV9pZCAhPSBQTEFORV9DVVJTT1IpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaAppbmRleCBk
NjBhODU0MjFjNWEuLjU2MWExN2E1ZDRlMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oCkBAIC00
MSw3ICs0MSw5IEBAIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkJICAgICAgc3RydWN0IHNrbF9waXBlX3dtICpvdXQpOwogdm9pZCBnNHhf
d21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgdmx2
X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1ib29sIGlu
dGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7Citi
b29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpOworYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3ZfZm9yX3N0YXRlKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlKTsKK2Jvb2wgaW50ZWxfaGFzX3NhZ3Yoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KTsKIGludCBpbnRlbF9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IGludGVsX2Rpc2FibGVfc2FndihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogYm9vbCBza2xfd21fbGV2ZWxfZXF1YWxzKGNvbnN0
IHN0cnVjdCBza2xfd21fbGV2ZWwgKmwxLAotLSAKMi4yNC4xLjQ4NS5nYWQwNWEzZDhlNQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2271BDBE32
	for <lists+intel-gfx@lfdr.de>; Fri, 18 Oct 2019 09:20:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3AD0C6E02C;
	Fri, 18 Oct 2019 07:20:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 237BE6E02C
 for <intel-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 07:20:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18877833-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 08:20:28 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 18 Oct 2019 08:20:27 +0100
Message-Id: <20191018072027.31948-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/execlists: Don't merely skip submission
 if maybe timeslicing
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm9ybWFsbHksIHdlIHRyeSBhbmQgc2tpcCBzdWJtaXNzaW9uIGlmIEVMU1BbMV0gaXMgZmlsbGVk
LiBIb3dldmVyLCB3ZQptYXkgZGVzaXJlIHRvIGVuYWJsZSB0aW1lc2xpY2luZyBkdWUgdG8gdGhl
IHF1ZXVlIHByaW9yaXR5LCBldmVuIGlmCkVMU1BbMV0gaXRzZWxmIGRvZXMgbm90IHJlcXVpcmUg
dGltZXNsaWNpbmcuIFRoYXQgaXMgdGhlIHF1ZXVlIGlzIGVxdWFsCnByaW9yaXR5IHRvIEVMU1Bb
MF0gYW5kIGhpZ2hlciBwcmlvcml0eSB0aGVuIEVMU1BbMV0uIFByZXZpb3VzbHksIHdlCndvdWxk
IHdhaXQgdW50aWwgdGhlIGNvbnRleHQgc3dpdGNoIHRvIHByZWVtcHQgdGhlIGN1cnJlbnQgRUxT
UFsxXSwgYnV0CndpdGggdGltZXNsaWNpbmcsIHdlIHdhbnQgdG8gcHJlZW1wdCBFTFNQWzBdIGFu
ZCByZXBsYWNlIGl0IHdpdGggdGhlCnF1ZXVlLgoKSW4gd3JpdGluZyB0aGUgdGVzdCBjYXNlLCBp
dCBiZWNvbWUgcXVpY2tseSBhcHBhcmVudCB0aGF0IHdlIHdlcmUgYWxzbwpzdXBwcmVzc2luZyB0
aGUgdGFza2xldCBkdXJpbmcgcHJvbW90aW9uIGFuZCBzbyBmYWlsaW5nIHRvIG5vdGljZSB3aGVu
CnRoZSBxdWV1ZSBzdGFydGVkIHJlcXVpcmluZyB0aW1lc2xpY2luZy4KCkZpeGVzOiAyMjI5YWRj
ODEzODAgKCJkcm0vaTkxNS9leGVjbGlzdDogVHJpbSBpbW1lZGlhdGUgdGltZXNsaWNlIGV4cGly
eSIpClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICB8ICAyMiArKystCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyB8IDE2OCArKysrKysrKysrKysrKysrKysrKysr
KystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jICB8ICAxNyArKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmggIHwgIDE4IC0tLQogNCBmaWxlcyBj
aGFuZ2VkLCAxOTYgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwppbmRleCBlOWZlOWY3OWNlZGQuLmQwMDg4ZDAyMDIyMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTM1MiwxMCArMzUyLDE1IEBAIHN0YXRpYyBp
bmxpbmUgYm9vbCBuZWVkX3ByZWVtcHQoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCSAqIEhvd2V2ZXIsIHRoZSBwcmlvcml0eSBoaW50IGlzIGEgbWVyZSBoaW50IHRoYXQg
d2UgbWF5IG5lZWQgdG8KIAkgKiBwcmVlbXB0LiBJZiB0aGF0IGhpbnQgaXMgc3RhbGUgb3Igd2Ug
bWF5IGJlIHRyeWluZyB0byBwcmVlbXB0CiAJICogb3Vyc2VsdmVzLCBpZ25vcmUgdGhlIHJlcXVl
c3QuCisJICoKKwkgKiBNb3JlIG5hdHVyYWxseSB3ZSB3b3VsZCB3cml0ZQorCSAqICAgICAgcHJp
byA+PSBtYXgoMCwgbGFzdCk7CisJICogZXhjZXB0IHRoYXQgd2Ugd2lzaCB0byBwcmV2ZW50IHRy
aWdnZXJpbmcgcHJlZW1wdGlvbiBhdCB0aGUgc2FtZQorCSAqIHByaW9yaXR5IGxldmVsOiB0aGUg
dGFzayB0aGF0IGlzIHJ1bm5pbmcgc2hvdWxkIHJlbWFpbiBydW5uaW5nCisJICogdG8gcHJlc2Vy
dmUgRklGTyBvcmRlcmluZyBvZiBkZXBlbmRlbmNpZXMuCiAJICovCi0JbGFzdF9wcmlvID0gZWZm
ZWN0aXZlX3ByaW8ocnEpOwotCWlmICghaTkxNV9zY2hlZHVsZXJfbmVlZF9wcmVlbXB0KGVuZ2lu
ZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQsCi0JCQkJCSBsYXN0X3ByaW8pKQorCWxh
c3RfcHJpbyA9IG1heChlZmZlY3RpdmVfcHJpbyhycSksIEk5MTVfUFJJT1JJVFlfTk9STUFMIC0g
MSk7CisJaWYgKGVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgPD0gbGFzdF9w
cmlvKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKgpAQCAtMTUwOSw4ICsxNTE0LDE3IEBAIHN0YXRp
YyB2b2lkIGV4ZWNsaXN0c19kZXF1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAkJCSAqIHN1Ym1pc3Npb24uCiAJCQkgKi8KIAkJCWlmICghbGlzdF9pc19sYXN0KCZsYXN0LT5z
Y2hlZC5saW5rLAotCQkJCQkgICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cykpCisJCQkJCSAgJmVu
Z2luZS0+YWN0aXZlLnJlcXVlc3RzKSkgeworCQkJCS8qCisJCQkJICogRXZlbiBpZiBFTFNQWzFd
IGlzIG9jY3VwaWVkIGFuZCBub3Qgd29ydGh5CisJCQkJICogb2YgdGltZXNsaWNlcywgb3VyIHF1
ZXVlIG1pZ2h0IGJlLgorCQkJCSAqLworCQkJCWlmICghZXhlY2xpc3RzLT50aW1lci5leHBpcmVz
ICYmCisJCQkJICAgIG5lZWRfdGltZXNsaWNlKGVuZ2luZSwgbGFzdCkpCisJCQkJCW1vZF90aW1l
cigmZXhlY2xpc3RzLT50aW1lciwKKwkJCQkJCSAgamlmZmllcyArIDEpOwogCQkJCXJldHVybjsK
KwkJCX0KIAogCQkJLyoKIAkJCSAqIFdhSWRsZUxpdGVSZXN0b3JlOmJkdyxza2wKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggMDA3ZDYyMDNmZTBlLi41ZGM2Nzk3ODFh
MDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0zMjUsNyArMzI1
LDEzIEBAIHNlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQogCWlmIChJU19FUlIocnEpKQogCQlnb3RvIG91
dF9jdHg7CiAKLQllcnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWVy
ciA9IDA7CisJaWYgKHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQorCQllcnIgPSBy
cS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYihycSk7CisJaWYgKGVyciA9PSAwKQorCQll
cnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWlmIChlcnIgPT0gMCkK
KwkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJaWYgKGVy
cikKIAkJcnEgPSBFUlJfUFRSKGVycik7CkBAIC0zMzgsMTAgKzM0NCwxMCBAQCBzZW1hcGhvcmVf
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgaW50IGlkeCkKIHN0YXRpYyBpbnQKIHJlbGVhc2VfcXVldWUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAogCSAgICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCSAgICAgIGludCBp
ZHgpCisJICAgICAgaW50IGlkeCwgaW50IHByaW8pCiB7CiAJc3RydWN0IGk5MTVfc2NoZWRfYXR0
ciBhdHRyID0gewotCQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklU
WV9NQVgpLAorCQkucHJpb3JpdHkgPSBwcmlvLAogCX07CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CiAJdTMyICpjczsKQEAgLTM2Miw5ICszNjgsMTUgQEAgcmVsZWFzZV9xdWV1ZShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJKmNzKysgPSAxOwogCiAJaW50ZWxfcmluZ19hZHZh
bmNlKHJxLCBjcyk7CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIAlpOTE1X3JlcXVlc3RfYWRk
KHJxKTsKIAorCWxvY2FsX2JoX2Rpc2FibGUoKTsKIAllbmdpbmUtPnNjaGVkdWxlKHJxLCAmYXR0
cik7CisJbG9jYWxfYmhfZW5hYmxlKCk7IC8qIGtpY2sgdGFza2xldCAqLworCisJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTM4Myw3ICszOTUsNiBAQCBzbGljZV9z
ZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqb3V0ZXIsCiAJaWYgKElTX0VS
UihoZWFkKSkKIAkJcmV0dXJuIFBUUl9FUlIoaGVhZCk7CiAKLQlpOTE1X3JlcXVlc3RfZ2V0KGhl
YWQpOwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIG91dGVyLT5ndCwgaWQpIHsKIAkJZm9yIChp
ID0gMDsgaSA8IGNvdW50OyBpKyspIHsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAt
MzkzLDEwICs0MDQsMTIgQEAgc2xpY2Vfc2VtYXBob3JlX3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKm91dGVyLAogCQkJCWVyciA9IFBUUl9FUlIocnEpOwogCQkJCWdvdG8gb3V0OwogCQkJ
fQorCisJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIAkJfQogCX0KIAotCWVyciA9IHJlbGVhc2Vf
cXVldWUob3V0ZXIsIHZtYSwgbik7CisJZXJyID0gcmVsZWFzZV9xdWV1ZShvdXRlciwgdm1hLCBu
LCBJTlRfTUFYKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIApAQCAtNDgyLDYgKzQ5NSwxNTAg
QEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAlyZXR1cm4g
ZXJyOwogfQogCitzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqbm9wX3JlcXVlc3Qoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwor
CisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCWlm
IChJU19FUlIocnEpKQorCQlyZXR1cm4gcnE7CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwlp
OTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCXJldHVybiBycTsKK30KKworc3RhdGljIHZvaWQgd2Fp
dF9mb3Jfc3VibWl0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3sKKwlkbyB7CisJCWNvbmRfcmVzY2hlZCgpOworCQlpbnRl
bF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdpbmUpOworCX0gd2hpbGUgKCFpOTE1X3JlcXVl
c3RfaXNfYWN0aXZlKHJxKSk7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcXVldWUo
dm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJ
ZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdm9pZCAq
dmFkZHI7CisJaW50IGVyciA9IDA7CisKKwkvKgorCSAqIE1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYg
RUxTUFswXSBhbmQgRUxTUFsxXSBhcmUgZmlsbGVkIHdpdGgKKwkgKiB0aW1lc2xpY2luZyBiZXR3
ZWVuIHRoZW0gZGlzYWJsZWQsIHdlICpkbyogZW5hYmxlIHRpbWVzbGljaW5nCisJICogaWYgdGhl
IHF1ZXVlIGRlbWFuZHMgaXQuIChOb3JtYWxseSwgd2UgZG8gbm90IHN1Ym1pdCBpZgorCSAqIEVM
U1BbMV0gaXMgYWxyZWFkeSBvY2N1cGllZCwgc28gbXVzdCByZWx5IG9uIHRpbWVzbGljaW5nIHRv
CisJICogZWplY3QgRUxTUFswXSBpbiBmYXZvdXIgb2YgdGhlIHF1ZXVlLikKKwkgKi8KKworCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7
CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VSUihvYmopOworCisJdm1hID0gaTkx
NV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZt
YSkpIHsKKwkJZXJyID0gUFRSX0VSUih2bWEpOworCQlnb3RvIGVycl9vYmo7CisJfQorCisJdmFk
ZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNf
RVJSKHZhZGRyKSkgeworCQllcnIgPSBQVFJfRVJSKHZhZGRyKTsKKwkJZ290byBlcnJfb2JqOwor
CX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlmIChl
cnIpCisJCWdvdG8gZXJyX21hcDsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkg
eworCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7CisJCQkucHJpb3JpdHkgPSBJOTE1
X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9NQVgpLAorCQl9OworCQlzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwgKm5vcDsKKworCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihl
bmdpbmUpKQorCQkJY29udGludWU7CisKKwkJbWVtc2V0KHZhZGRyLCAwLCBQQUdFX1NJWkUpOwor
CisJCS8qIEVMU1BbMF06IHNlbWFwaG9yZSB3YWl0ICovCisJCXJxID0gc2VtYXBob3JlX3F1ZXVl
KGVuZ2luZSwgdm1hLCAwKTsKKwkJaWYgKElTX0VSUihycSkpIHsKKwkJCWVyciA9IFBUUl9FUlIo
cnEpOworCQkJZ290byBlcnJfcGluOworCQl9CisJCWVuZ2luZS0+c2NoZWR1bGUocnEsICZhdHRy
KTsKKwkJd2FpdF9mb3Jfc3VibWl0KGVuZ2luZSwgcnEpOworCisJCS8qIEVMU1BbMV06IG5vcCBy
ZXF1ZXN0ICovCisJCW5vcCA9IG5vcF9yZXF1ZXN0KGVuZ2luZSk7CisJCWlmIChJU19FUlIobm9w
KSkgeworCQkJZXJyID0gUFRSX0VSUihub3ApOworCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJ
CQlnb3RvIGVycl9waW47CisJCX0KKwkJd2FpdF9mb3Jfc3VibWl0KGVuZ2luZSwgbm9wKTsKKwkJ
aTkxNV9yZXF1ZXN0X3B1dChub3ApOworCisJCUdFTV9CVUdfT04oaTkxNV9yZXF1ZXN0X2NvbXBs
ZXRlZChycSkpOworCQlHRU1fQlVHX09OKGV4ZWNsaXN0c19hY3RpdmUoJmVuZ2luZS0+ZXhlY2xp
c3RzKSAhPSBycSk7CisKKwkJLyogUXVldWU6IHNlbWFwaG9yZSBzaWduYWwsIG1hdGNoaW5nIHBy
aW9yaXR5IGFzIHNlbWFwaG9yZSAqLworCQllcnIgPSByZWxlYXNlX3F1ZXVlKGVuZ2luZSwgdm1h
LCAxLCBlZmZlY3RpdmVfcHJpbyhycSkpOworCQlpZiAoZXJyKSB7CisJCQlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKKwkJCWdvdG8gZXJyX3BpbjsKKwkJfQorCisJCWludGVsX2VuZ2luZV9mbHVzaF9z
dWJtaXNzaW9uKGVuZ2luZSk7CisJCWlmICghUkVBRF9PTkNFKGVuZ2luZS0+ZXhlY2xpc3RzLnRp
bWVyLmV4cGlyZXMpICYmCisJCSAgICAhaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpIHsKKwkJ
CXN0cnVjdCBkcm1fcHJpbnRlciBwID0KKwkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5k
cm0uZGV2KTsKKworCQkJR0VNX1RSQUNFX0VSUigiJXM6IEZhaWxlZCB0byBlbmFibGUgdGltZXNs
aWNpbmchXG4iLAorCQkJCSAgICAgIGVuZ2luZS0+bmFtZSk7CisJCQlpbnRlbF9lbmdpbmVfZHVt
cChlbmdpbmUsICZwLAorCQkJCQkgICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKKwkJCUdFTV9UUkFD
RV9EVU1QKCk7CisKKwkJCW1lbXNldCh2YWRkciwgMHhmZiwgUEFHRV9TSVpFKTsKKwkJCWVyciA9
IC1FSU5WQUw7CisJCX0KKworCQkvKiBUaW1lc2xpY2UgZXZlcnkgamlmZmllLCBzbyB3aXRoaW4g
MiB3ZSBzaG91bGQgc2lnbmFsICovCisJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgMykg
PCAwKSB7CisJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9CisJCQkJZHJtX2luZm9fcHJpbnRlcihn
dC0+aTkxNS0+ZHJtLmRldik7CisKKwkJCXByX2VycigiJXM6IEZhaWxlZCB0byB0aW1lc2xpY2Ug
aW50byBxdWV1ZVxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQkJaW50ZWxfZW5naW5l
X2R1bXAoZW5naW5lLCAmcCwKKwkJCQkJICAiJXNcbiIsIGVuZ2luZS0+bmFtZSk7CisKKwkJCW1l
bXNldCh2YWRkciwgMHhmZiwgUEFHRV9TSVpFKTsKKwkJCWVyciA9IC1FSU87CisJCX0KKwkJaTkx
NV9yZXF1ZXN0X3B1dChycSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKwl9CisKK2Vycl9waW46
CisJaTkxNV92bWFfdW5waW4odm1hKTsKK2Vycl9tYXA6CisJaTkxNV9nZW1fb2JqZWN0X3VucGlu
X21hcChvYmopOworZXJyX29iajoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcmV0dXJu
IGVycjsKK30KKwogc3RhdGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQog
ewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CkBAIC0yNDM3LDYgKzI1OTQsNyBAQCBpbnQg
aW50ZWxfZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCQlTVUJURVNUKGxpdmVfdW5saXRlX3N3aXRjaCksCiAJCVNVQlRFU1QobGl2ZV91bmxp
dGVfcHJlZW1wdCksCiAJCVNVQlRFU1QobGl2ZV90aW1lc2xpY2VfcHJlZW1wdCksCisJCVNVQlRF
U1QobGl2ZV90aW1lc2xpY2VfcXVldWUpLAogCQlTVUJURVNUKGxpdmVfYnVzeXdhaXRfcHJlZW1w
dCksCiAJCVNVQlRFU1QobGl2ZV9wcmVlbXB0KSwKIAkJU1VCVEVTVChsaXZlX2xhdGVfcHJlZW1w
dCksCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYwppbmRleCA3Yjg0ZWJjYTI5MDEu
LjBjYTQwZjZiZjA4YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hl
ZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCkBAIC0x
NzcsOSArMTc3LDIyIEBAIHN0YXRpYyBpbmxpbmUgaW50IHJxX3ByaW8oY29uc3Qgc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCiAJcmV0dXJuIHJxLT5zY2hlZC5hdHRyLnByaW9yaXR5IHwgX19OT19Q
UkVFTVBUSU9OOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wgbmVlZF9wcmVlbXB0KGludCBwcmlv
LCBpbnQgYWN0aXZlKQoreworCS8qCisJICogQWxsb3cgcHJlZW1wdGlvbiBvZiBsb3cgLT4gbm9y
bWFsIC0+IGhpZ2gsIGJ1dCB3ZSBkbworCSAqIG5vdCBhbGxvdyBsb3cgcHJpb3JpdHkgdGFza3Mg
dG8gcHJlZW1wdCBvdGhlciBsb3cgcHJpb3JpdHkKKwkgKiB0YXNrcyB1bmRlciB0aGUgaW1wcmVz
c2lvbiB0aGF0IGxhdGVuY3kgZm9yIGxvdyBwcmlvcml0eQorCSAqIHRhc2tzIGRvZXMgbm90IG1h
dHRlciAoYXMgbXVjaCBhcyBiYWNrZ3JvdW5kIHRocm91Z2hwdXQpLAorCSAqIHNvIGtpc3MuCisJ
ICovCisJcmV0dXJuIHByaW8gPj0gbWF4KEk5MTVfUFJJT1JJVFlfTk9STUFMLCBhY3RpdmUpOwor
fQorCiBzdGF0aWMgdm9pZCBraWNrX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLCBpbnQgcHJpbykKIHsKLQljb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICppbmZsaWdo
dCA9ICplbmdpbmUtPmV4ZWNsaXN0cy5hY3RpdmU7CisJY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVz
dCAqaW5mbGlnaHQgPQorCQlleGVjbGlzdHNfYWN0aXZlKCZlbmdpbmUtPmV4ZWNsaXN0cyk7CiAK
IAkvKgogCSAqIElmIHdlIGFyZSBhbHJlYWR5IHRoZSBjdXJyZW50bHkgZXhlY3V0aW5nIGNvbnRl
eHQsIGRvbid0CkBAIC0xODgsNyArMjAxLDcgQEAgc3RhdGljIHZvaWQga2lja19zdWJtaXNzaW9u
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IHByaW8pCiAJICogdGFza2xldCwg
aS5lLiB3ZSBoYXZlIG5vdCBjaGFuZ2UgdGhlIHByaW9yaXR5IHF1ZXVlCiAJICogc3VmZmljaWVu
dGx5IHRvIG91c3QgdGhlIHJ1bm5pbmcgY29udGV4dC4KIAkgKi8KLQlpZiAoIWluZmxpZ2h0IHx8
ICFpOTE1X3NjaGVkdWxlcl9uZWVkX3ByZWVtcHQocHJpbywgcnFfcHJpbyhpbmZsaWdodCkpKQor
CWlmICghaW5mbGlnaHQgfHwgIW5lZWRfcHJlZW1wdChwcmlvLCBycV9wcmlvKGluZmxpZ2h0KSkp
CiAJCXJldHVybjsKIAogCXRhc2tsZXRfaGlfc2NoZWR1bGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRh
c2tsZXQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmgKaW5kZXggN2VlZmNjZmYz
OWJmLi4wN2QyNDNhY2Y1NTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
c2NoZWR1bGVyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuaApA
QCAtNTIsMjIgKzUyLDQgQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfcHJpb2xpc3RfZnJlZShz
dHJ1Y3QgaTkxNV9wcmlvbGlzdCAqcCkKIAkJX19pOTE1X3ByaW9saXN0X2ZyZWUocCk7CiB9CiAK
LXN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3NjaGVkdWxlcl9uZWVkX3ByZWVtcHQoaW50IHByaW8s
IGludCBhY3RpdmUpCi17Ci0JLyoKLQkgKiBBbGxvdyBwcmVlbXB0aW9uIG9mIGxvdyAtPiBub3Jt
YWwgLT4gaGlnaCwgYnV0IHdlIGRvCi0JICogbm90IGFsbG93IGxvdyBwcmlvcml0eSB0YXNrcyB0
byBwcmVlbXB0IG90aGVyIGxvdyBwcmlvcml0eQotCSAqIHRhc2tzIHVuZGVyIHRoZSBpbXByZXNz
aW9uIHRoYXQgbGF0ZW5jeSBmb3IgbG93IHByaW9yaXR5Ci0JICogdGFza3MgZG9lcyBub3QgbWF0
dGVyIChhcyBtdWNoIGFzIGJhY2tncm91bmQgdGhyb3VnaHB1dCksCi0JICogc28ga2lzcy4KLQkg
KgotCSAqIE1vcmUgbmF0dXJhbGx5IHdlIHdvdWxkIHdyaXRlCi0JICoJcHJpbyA+PSBtYXgoMCwg
bGFzdCk7Ci0JICogZXhjZXB0IHRoYXQgd2Ugd2lzaCB0byBwcmV2ZW50IHRyaWdnZXJpbmcgcHJl
ZW1wdGlvbiBhdCB0aGUgc2FtZQotCSAqIHByaW9yaXR5IGxldmVsOiB0aGUgdGFzayB0aGF0IGlz
IHJ1bm5pbmcgc2hvdWxkIHJlbWFpbiBydW5uaW5nCi0JICogdG8gcHJlc2VydmUgRklGTyBvcmRl
cmluZyBvZiBkZXBlbmRlbmNpZXMuCi0JICovCi0JcmV0dXJuIHByaW8gPiBtYXgoSTkxNV9QUklP
UklUWV9OT1JNQUwgLSAxLCBhY3RpdmUpOwotfQotCiAjZW5kaWYgLyogX0k5MTVfU0NIRURVTEVS
X0hfICovCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

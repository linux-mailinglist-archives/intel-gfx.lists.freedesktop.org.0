Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C7EB6464CD
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 18:46:12 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 263E889B66;
	Fri, 14 Jun 2019 16:46:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6648289B66
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 16:46:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16905374-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 17:46:07 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 17:46:04 +0100
Message-Id: <20190614164606.15633-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 1/3] drm/i915: Keep contexts pinned until after the
 next kernel context switch
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgbmVlZCB0byBrZWVwIHRoZSBjb250ZXh0IGltYWdlIHBpbm5lZCBpbiBtZW1vcnkgdW50aWwg
YWZ0ZXIgdGhlIEdQVQpoYXMgZmluaXNoZWQgd3JpdGluZyBpbnRvIGl0LiBTaW5jZSBpdCBjb250
aW51ZXMgdG8gd3JpdGUgYXMgd2Ugc2lnbmFsCnRoZSBmaW5hbCBicmVhZGNydW1iLCB3ZSBuZWVk
IHRvIGtlZXAgaXQgcGlubmVkIHVudGlsIHRoZSByZXF1ZXN0IGFmdGVyCml0IGlzIGNvbXBsZXRl
LiBDdXJyZW50bHkgd2Uga25vdyB0aGUgb3JkZXIgaW4gd2hpY2ggcmVxdWVzdHMgZXhlY3V0ZSBv
bgplYWNoIGVuZ2luZSwgYW5kIHNvIHRvIHJlbW92ZSB0aGF0IHByZXN1bXB0aW9uIHdlIG5lZWQg
dG8gaWRlbnRpZnkgYQpyZXF1ZXN0L2NvbnRleHQtc3dpdGNoIHdlIGtub3cgbXVzdCBvY2N1ciBh
ZnRlciBvdXIgY29tcGxldGlvbi4gQW55CnJlcXVlc3QgcXVldWVkIGFmdGVyIHRoZSBzaWduYWwg
bXVzdCBpbXBseSBhIGNvbnRleHQgc3dpdGNoLCBmb3IKc2ltcGxpY2l0eSB3ZSB1c2UgYSBmcmVz
aCByZXF1ZXN0IGZyb20gdGhlIGtlcm5lbCBjb250ZXh0LgoKVGhlIHNlcXVlbmNlIG9mIG9wZXJh
dGlvbnMgZm9yIGtlZXBpbmcgdGhlIGNvbnRleHQgcGlubmVkIHVudGlsIHNhdmVkIGlzOgoKIC0g
T24gY29udGV4dCBhY3RpdmF0aW9uLCB3ZSBwcmVhbGxvY2F0ZSBhIG5vZGUgZm9yIGVhY2ggcGh5
c2ljYWwgZW5naW5lCiAgIHRoZSBjb250ZXh0IG1heSBvcGVyYXRlIG9uLiBUaGlzIGlzIHRvIGF2
b2lkIGFsbG9jYXRpb25zIGR1cmluZwogICB1bnBpbm5pbmcsIHdoaWNoIG1heSBiZSBmcm9tIGlu
c2lkZSBGU19SRUNMQUlNIGNvbnRleHQgKGFrYSB0aGUKICAgc2hyaW5rZXIpCgogLSBPbiBjb250
ZXh0IGRlYWN0aXZhdGlvbiBvbiByZXRpcmVtZW50IG9mIHRoZSBsYXN0IGFjdGl2ZSByZXF1ZXN0
ICh3aGljaAogICBpcyBiZWZvcmUgd2Uga25vdyB0aGUgY29udGV4dCBoYXMgYmVlbiBzYXZlZCks
IHdlIGFkZCB0aGUKICAgcHJlYWxsb2NhdGVkIG5vZGUgb250byBhIGJhcnJpZXIgbGlzdCBvbiBl
YWNoIGVuZ2luZQoKIC0gT24gZW5naW5lIGlkbGluZywgd2UgZW1pdCBhIHN3aXRjaCB0byBrZXJu
ZWwgY29udGV4dC4gV2hlbiB0aGlzCiAgIHN3aXRjaCBjb21wbGV0ZXMsIHdlIGtub3cgdGhhdCBh
bGwgcHJldmlvdXMgY29udGV4dHMgbXVzdCBoYXZlIGJlZW4KICAgc2F2ZWQsIGFuZCBzbyBvbiBy
ZXRpcmluZyB0aGlzIHJlcXVlc3Qgd2UgY2FuIGZpbmFsbHkgdW5waW4gYWxsIHRoZQogICBjb250
ZXh0cyB0aGF0IHdlcmUgbWFya2VkIGFzIGRlYWN0aXZhdGVkIHByaW9yIHRvIHRoZSBzd2l0Y2gu
CgpXZSBjYW4gZW5oYW5jZSB0aGlzIGluIGZ1dHVyZSBieSBmbHVzaGluZyBhbGwgdGhlIGlkbGUg
Y29udGV4dHMgb24gYQpyZWd1bGFyIGhlYXJ0YmVhdCBwdWxzZSBvZiBhIHN3aXRjaCB0byBrZXJu
ZWwgY29udGV4dCwgd2hpY2ggd2lsbCBhbHNvCmJlIHVzZWQgdG8gY2hlY2sgZm9yIGh1bmcgZW5n
aW5lcy4KCnYyOiBpbnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlL19yZWxlYXNlCgpTaWduZWQt
b2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IE1pa2Eg
S3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogTWlr
YSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwgMjQgKystLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oICAgfCAgMSAtCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAgICAgICAgfCAyMCArKysrLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgIHwgMTcgKystLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAgIHwgODAgKysrKysrKysrKysrKysr
Ky0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oICAgICAgIHwgIDMg
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oIHwgIDYgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oICAgICAgICB8ICAyIC0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jICAgICB8IDIzICstLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgICAgIHwgIDIgKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggIHwgMTMgKy0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCA2MiArKy0tLS0tLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jICAgIHwgNDQg
Ky0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYyAgICAgICAg
IHwgMTEgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAg
fCA3OCArKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZl
LmggICAgICAgICAgICB8ICA1ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90
eXBlcy5oICAgICAgfCAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAg
ICAgICAgICAgfCAgNCAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAg
ICAgICAgfCAxNSAtLS0tCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZp
Y2UuYyAgfCAgMSAtCiAyMCBmaWxlcyBjaGFuZ2VkLCAyMTkgaW5zZXJ0aW9ucygrKSwgMTk1IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
CmluZGV4IGM4NmNhOWYyMTUzMi4uNjIwMDA2MGFlZjA1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTY5MiwxNyArNjkyLDYgQEAgaW50IGk5MTVf
Z2VtX2NvbnRleHRzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJl
dHVybiAwOwogfQogCi12b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2xvc3Qoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQotewotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
LQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9w
cml2LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9w
cml2LCBpZCkKLQkJaW50ZWxfZW5naW5lX2xvc3RfY29udGV4dChlbmdpbmUpOwotfQotCiB2b2lk
IGk5MTVfZ2VtX2NvbnRleHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7
CiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CkBAIC0xMjAz
LDEwICsxMTkyLDYgQEAgZ2VuOF9tb2RpZnlfcnBjcyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Us
IHN0cnVjdCBpbnRlbF9zc2V1IHNzZXUpCiAJaWYgKHJldCkKIAkJZ290byBvdXRfYWRkOwogCi0J
cmV0ID0gZ2VuOF9lbWl0X3JwY3NfY29uZmlnKHJxLCBjZSwgc3NldSk7Ci0JaWYgKHJldCkKLQkJ
Z290byBvdXRfYWRkOwotCiAJLyoKIAkgKiBHdWFyYW50ZWUgY29udGV4dCBpbWFnZSBhbmQgdGhl
IHRpbWVsaW5lIHJlbWFpbnMgcGlubmVkIHVudGlsIHRoZQogCSAqIG1vZGlmeWluZyByZXF1ZXN0
IGlzIHJldGlyZWQgYnkgc2V0dGluZyB0aGUgY2UgYWN0aXZpdHkgdHJhY2tlci4KQEAgLTEyMTQs
OSArMTE5OSwxMiBAQCBnZW44X21vZGlmeV9ycGNzKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwg
c3RydWN0IGludGVsX3NzZXUgc3NldSkKIAkgKiBCdXQgd2Ugb25seSBuZWVkIHRvIHRha2Ugb25l
IHBpbiBvbiB0aGUgYWNjb3VudCBvZiBpdC4gT3IgaW4gb3RoZXIKIAkgKiB3b3JkcyB0cmFuc2Zl
ciB0aGUgcGlubmVkIGNlIG9iamVjdCB0byB0cmFja2VkIGFjdGl2ZSByZXF1ZXN0LgogCSAqLwot
CWlmICghaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmY2UtPmFjdGl2ZV90cmFja2VyKSkKLQkJ
X19pbnRlbF9jb250ZXh0X3BpbihjZSk7Ci0JX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmY2Ut
PmFjdGl2ZV90cmFja2VyLCBycSk7CisJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9pc19pZGxlKCZj
ZS0+YWN0aXZlKSk7CisJcmV0ID0gaTkxNV9hY3RpdmVfcmVmKCZjZS0+YWN0aXZlLCBycS0+ZmVu
Y2UuY29udGV4dCwgcnEpOworCWlmIChyZXQpCisJCWdvdG8gb3V0X2FkZDsKKworCXJldCA9IGdl
bjhfZW1pdF9ycGNzX2NvbmZpZyhycSwgY2UsIHNzZXUpOwogCiBvdXRfYWRkOgogCWk5MTVfcmVx
dWVzdF9hZGQocnEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmgKaW5kZXggNjMwMzkyYzc3ZTQ4Li45NjkxZGQwNjJmNzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaApAQCAtMTM0LDcgKzEzNCw2IEBAIHN0YXRpYyBp
bmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4KQogCiAvKiBpOTE1X2dlbV9jb250ZXh0LmMgKi8KIGludCBfX211c3RfY2hlY2sg
aTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
Owotdm9pZCBpOTE1X2dlbV9jb250ZXh0c19sb3N0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7CiB2b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KTsKIAogaW50IGk5MTVfZ2VtX2NvbnRleHRfb3BlbihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMK
aW5kZXggNmU3NTcwMmM1NjcxLi4xNDFmM2VhMzQ5YTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9wbS5jCkBAIC0xMCw2ICsxMCwyMiBAQAogI2luY2x1ZGUgImk5MTVfZHJ2Lmgi
CiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCiAKK3N0YXRpYyB2b2lkIGNhbGxfaWRsZV9iYXJy
aWVycyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJc3RydWN0IGxsaXN0X25v
ZGUgKm5vZGUsICpuZXh0OworCisJbGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0LCBsbGlz
dF9kZWxfYWxsKCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKSB7CisJCXN0cnVjdCBpOTE1X2FjdGl2
ZV9yZXF1ZXN0ICphY3RpdmUgPQorCQkJY29udGFpbmVyX29mKChzdHJ1Y3QgbGlzdF9oZWFkICop
bm9kZSwKKwkJCQkgICAgIHR5cGVvZigqYWN0aXZlKSwgbGluayk7CisKKwkJSU5JVF9MSVNUX0hF
QUQoJmFjdGl2ZS0+bGluayk7CisJCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBO
VUxMKTsKKworCQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIE5VTEwpOworCX0KK30KKwogc3RhdGlj
IHZvaWQgaTkxNV9nZW1fcGFyayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CkBAIC0xNyw4ICszMywxMCBAQCBzdGF0aWMg
dm9pZCBpOTE1X2dlbV9wYXJrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJbG9j
a2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQlmb3JfZWFjaF9l
bmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBp
ZCkgeworCQljYWxsX2lkbGVfYmFycmllcnMoZW5naW5lKTsgLyogY2xlYW51cCBhZnRlciB3ZWRn
aW5nICovCiAJCWk5MTVfZ2VtX2JhdGNoX3Bvb2xfZmluaSgmZW5naW5lLT5iYXRjaF9wb29sKTsK
Kwl9CiAKIAlpOTE1X3RpbWVsaW5lc19wYXJrKGk5MTUpOwogCWk5MTVfdm1hX3BhcmtlZChpOTE1
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtl
ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKaW5kZXgg
YTUyMWYyM2MxOGFkLi5jODUxYzQwMjk1OTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9zaHJpbmtlci5jCkBAIC0xNjAsMTggKzE2MCwxMyBAQCBpOTE1X2dlbV9zaHJp
bmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCXJldHVybiAwOwogCiAJLyoKLQkg
KiBXaGVuIHNocmlua2luZyB0aGUgYWN0aXZlIGxpc3QsIGFsc28gY29uc2lkZXIgYWN0aXZlIGNv
bnRleHRzLgotCSAqIEFjdGl2ZSBjb250ZXh0cyBhcmUgcGlubmVkIHVudGlsIHRoZXkgYXJlIHJl
dGlyZWQsIGFuZCBzbyBjYW4KLQkgKiBub3QgYmUgc2ltcGx5IHVuYm91bmQgdG8gcmV0aXJlIGFu
ZCB1bnBpbiB0aGVpciBwYWdlcy4gVG8gc2hyaW5rCi0JICogdGhlIGNvbnRleHRzLCB3ZSBtdXN0
IHdhaXQgdW50aWwgdGhlIGdwdSBpcyBpZGxlLgotCSAqCi0JICogV2UgZG9uJ3QgY2FyZSBhYm91
dCBlcnJvcnMgaGVyZTsgaWYgd2UgY2Fubm90IHdhaXQgdXBvbiB0aGUgR1BVLAotCSAqIHdlIHdp
bGwgZnJlZSBhcyBtdWNoIGFzIHdlIGNhbiBhbmQgaG9wZSB0byBnZXQgYSBzZWNvbmQgY2hhbmNl
LgorCSAqIFdoZW4gc2hyaW5raW5nIHRoZSBhY3RpdmUgbGlzdCwgd2Ugc2hvdWxkIGFsc28gY29u
c2lkZXIgYWN0aXZlCisJICogY29udGV4dHMuIEFjdGl2ZSBjb250ZXh0cyBhcmUgcGlubmVkIHVu
dGlsIHRoZXkgYXJlIHJldGlyZWQsIGFuZAorCSAqIHNvIGNhbiBub3QgYmUgc2ltcGx5IHVuYm91
bmQgdG8gcmV0aXJlIGFuZCB1bnBpbiB0aGVpciBwYWdlcy4gVG8KKwkgKiBzaHJpbmsgdGhlIGNv
bnRleHRzLCB3ZSBtdXN0IHdhaXQgdW50aWwgdGhlIGdwdSBpcyBpZGxlIGFuZAorCSAqIGNvbXBs
ZXRlZCBpdHMgc3dpdGNoIHRvIHRoZSBrZXJuZWwgY29udGV4dC4gSW4gc2hvcnQsIHdlIGRvCisJ
ICogbm90IGhhdmUgYSBnb29kIG1lY2hhbmlzbSBmb3IgaWRsaW5nIGEgc3BlY2lmaWMgY29udGV4
dC4KIAkgKi8KLQlpZiAoc2hyaW5rICYgSTkxNV9TSFJJTktfQUNUSVZFKQotCQlpOTE1X2dlbV93
YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJICAgICAgIEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJICAg
ICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAogCXRyYWNlX2k5MTVfZ2VtX3NocmluayhpOTE1
LCB0YXJnZXQsIHNocmluayk7CiAJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggMjg1ZTg2OTcxM2U4Li40MmY0NTc0
NGQ4NTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTYxLDcg
KzYxLDYgQEAgaW50IF9faW50ZWxfY29udGV4dF9kb19waW4oc3RydWN0IGludGVsX2NvbnRleHQg
KmNlKQogCiAJCWk5MTVfZ2VtX2NvbnRleHRfZ2V0KGNlLT5nZW1fY29udGV4dCk7IC8qIGZvciBj
dHgtPnBwZ3R0ICovCiAKLQkJaW50ZWxfY29udGV4dF9nZXQoY2UpOwogCQlzbXBfbWJfX2JlZm9y
ZV9hdG9taWMoKTsgLyogZmx1c2ggcGluIGJlZm9yZSBpdCBpcyB2aXNpYmxlICovCiAJfQogCkBA
IC04OSwyMCArODgsNDUgQEAgdm9pZCBpbnRlbF9jb250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSkKIAkJY2UtPm9wcy0+dW5waW4oY2UpOwogCiAJCWk5MTVfZ2VtX2NvbnRleHRf
cHV0KGNlLT5nZW1fY29udGV4dCk7Ci0JCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJaW50ZWxf
Y29udGV4dF9hY3RpdmVfcmVsZWFzZShjZSk7CiAJfQogCiAJbXV0ZXhfdW5sb2NrKCZjZS0+cGlu
X211dGV4KTsKIAlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVs
X2NvbnRleHRfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkJ
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQorc3RhdGljIGludCBfX2NvbnRleHRfcGluX3N0YXRl
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGZsYWdzKQogewotCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSA9Ci0JCWNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigqY2UpLCBh
Y3RpdmVfdHJhY2tlcik7CisJaW50IGVycjsKIAotCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwor
CWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIGZsYWdzIHwgUElOX0dMT0JBTCk7CisJaWYg
KGVycikKKwkJcmV0dXJuIGVycjsKKworCS8qCisJICogQW5kIG1hcmsgaXQgYXMgYSBnbG9iYWxs
eSBwaW5uZWQgb2JqZWN0IHRvIGxldCB0aGUgc2hyaW5rZXIga25vdworCSAqIGl0IGNhbm5vdCBy
ZWNsYWltIHRoZSBvYmplY3QgdW50aWwgd2UgcmVsZWFzZSBpdC4KKwkgKi8KKwl2bWEtPm9iai0+
cGluX2dsb2JhbCsrOworCXZtYS0+b2JqLT5tbS5kaXJ0eSA9IHRydWU7CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIHZvaWQgX19jb250ZXh0X3VucGluX3N0YXRlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQoreworCXZtYS0+b2JqLT5waW5fZ2xvYmFsLS07CisJX19pOTE1X3ZtYV91bnBpbih2bWEp
OworfQorCitzdGF0aWMgdm9pZCBpbnRlbF9jb250ZXh0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKmFjdGl2ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBjb250YWluZXJfb2Yo
YWN0aXZlLCB0eXBlb2YoKmNlKSwgYWN0aXZlKTsKKworCWlmIChjZS0+c3RhdGUpCisJCV9fY29u
dGV4dF91bnBpbl9zdGF0ZShjZS0+c3RhdGUpOworCisJaW50ZWxfY29udGV4dF9wdXQoY2UpOwog
fQogCiB2b2lkCkBAIC0xMjUsOCArMTQ5LDQ2IEBAIGludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UsCiAKIAltdXRleF9pbml0KCZjZS0+cGluX211dGV4KTsKIAotCWk5
MTVfYWN0aXZlX3JlcXVlc3RfaW5pdCgmY2UtPmFjdGl2ZV90cmFja2VyLAotCQkJCSBOVUxMLCBp
bnRlbF9jb250ZXh0X3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdChjdHgtPmk5MTUsICZjZS0+
YWN0aXZlLCBpbnRlbF9jb250ZXh0X3JldGlyZSk7Cit9CisKK2ludCBpbnRlbF9jb250ZXh0X2Fj
dGl2ZV9hY3F1aXJlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdW5zaWduZWQgbG9uZyBmbGFn
cykKK3sKKwlpbnQgZXJyOworCisJaWYgKCFpOTE1X2FjdGl2ZV9hY3F1aXJlKCZjZS0+YWN0aXZl
KSkKKwkJcmV0dXJuIDA7CisKKwlpbnRlbF9jb250ZXh0X2dldChjZSk7CisKKwlpZiAoIWNlLT5z
dGF0ZSkKKwkJcmV0dXJuIDA7CisKKwllcnIgPSBfX2NvbnRleHRfcGluX3N0YXRlKGNlLT5zdGF0
ZSwgZmxhZ3MpOworCWlmIChlcnIpIHsKKwkJaTkxNV9hY3RpdmVfY2FuY2VsKCZjZS0+YWN0aXZl
KTsKKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlyZXR1cm4gZXJyOworCX0KKworCS8qIFBy
ZWFsbG9jYXRlIHRyYWNraW5nIG5vZGVzICovCisJaWYgKCFpOTE1X2dlbV9jb250ZXh0X2lzX2tl
cm5lbChjZS0+Z2VtX2NvbnRleHQpKSB7CisJCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmVfcHJl
YWxsb2NhdGVfYmFycmllcigmY2UtPmFjdGl2ZSwKKwkJCQkJCQkgICAgICBjZS0+ZW5naW5lKTsK
KwkJaWYgKGVycikgeworCQkJaTkxNV9hY3RpdmVfcmVsZWFzZSgmY2UtPmFjdGl2ZSk7CisJCQly
ZXR1cm4gZXJyOworCQl9CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgaW50ZWxfY29udGV4
dF9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJLyogTm9kZXMg
cHJlYWxsb2NhdGVkIGluIGludGVsX2NvbnRleHRfYWN0aXZlKCkgKi8KKwlpOTE1X2FjdGl2ZV9h
Y3F1aXJlX2JhcnJpZXIoJmNlLT5hY3RpdmUpOworCWk5MTVfYWN0aXZlX3JlbGVhc2UoJmNlLT5h
Y3RpdmUpOwogfQogCiBzdGF0aWMgdm9pZCBpOTE1X2dsb2JhbF9jb250ZXh0X3Nocmluayh2b2lk
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCmluZGV4IDZkNTQ1M2JhMmMx
ZS4uYTQ3Mjc1YmM0ZjAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5o
CkBAIC0xMDIsNiArMTAyLDkgQEAgc3RhdGljIGlubGluZSB2b2lkIGludGVsX2NvbnRleHRfZXhp
dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJCWNlLT5vcHMtPmV4aXQoY2UpOwogfQogCitp
bnQgaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Us
IHVuc2lnbmVkIGxvbmcgZmxhZ3MpOwordm9pZCBpbnRlbF9jb250ZXh0X2FjdGl2ZV9yZWxlYXNl
KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSk7CisKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGludGVs
X2NvbnRleHQgKmludGVsX2NvbnRleHRfZ2V0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsK
IAlrcmVmX2dldCgmY2UtPnJlZik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9j
b250ZXh0X3R5cGVzLmgKaW5kZXggODI1ZmNmMGFjOWM0Li5lOTViZTRiZTk2MTIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5cGVzLmgKQEAgLTU2LDEwICs1
NiwxMCBAQCBzdHJ1Y3QgaW50ZWxfY29udGV4dCB7CiAJaW50ZWxfZW5naW5lX21hc2tfdCBzYXR1
cmF0ZWQ7IC8qIHN1Ym1pdHRpbmcgc2VtYXBob3JlcyB0b28gbGF0ZT8gKi8KIAogCS8qKgotCSAq
IGFjdGl2ZV90cmFja2VyOiBBY3RpdmUgdHJhY2tlciBmb3IgdGhlIGV4dGVybmFsIHJxIGFjdGl2
aXR5Ci0JICogb24gdGhpcyBpbnRlbF9jb250ZXh0IG9iamVjdC4KKwkgKiBhY3RpdmU6IEFjdGl2
ZSB0cmFja2VyIGZvciB0aGUgcnEgYWN0aXZpdHkgKGluYy4gZXh0ZXJuYWwpIG9uIHRoaXMKKwkg
KiBpbnRlbF9jb250ZXh0IG9iamVjdC4KIAkgKi8KLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVz
dCBhY3RpdmVfdHJhY2tlcjsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmUgYWN0aXZlOwogCiAJY29uc3Qg
c3RydWN0IGludGVsX2NvbnRleHRfb3BzICpvcHM7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lLmgKaW5kZXggMTQzOWZhNDA5M2FjLi4zYjVhNmQxNTI5OTcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCkBAIC00NjcsOCArNDY3LDYgQEAgc3RhdGljIGlu
bGluZSB2b2lkIGludGVsX2VuZ2luZV9yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUsCiBib29sIGludGVsX2VuZ2luZV9pc19pZGxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSk7CiBib29sIGludGVsX2VuZ2luZXNfYXJlX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKIAotdm9pZCBpbnRlbF9lbmdpbmVfbG9zdF9jb250ZXh0KHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7Ci0KIHZvaWQgaW50ZWxfZW5naW5lc19yZXNldF9kZWZh
dWx0X3N1Ym1pc3Npb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdW5zaWduZWQg
aW50IGludGVsX2VuZ2luZXNfaGFzX2NvbnRleHRfaXNvbGF0aW9uKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3Mu
YwppbmRleCAzOTIyMGUxNmVhMjYuLjIyMjQyZTkyN2JhYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTYxMSw2ICs2MTEsOCBAQCBzdGF0aWMgaW50IGlu
dGVsX2VuZ2luZV9zZXR1cF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
ewogCWludCBlcnI7CiAKKwlpbml0X2xsaXN0X2hlYWQoJmVuZ2luZS0+YmFycmllcl90YXNrcyk7
CisKIAllcnIgPSBpbml0X3N0YXR1c19wYWdlKGVuZ2luZSk7CiAJaWYgKGVycikKIAkJcmV0dXJu
IGVycjsKQEAgLTg3MCw2ICs4NzIsNyBAQCB2b2lkIGludGVsX2VuZ2luZV9jbGVhbnVwX2NvbW1v
bihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaWYgKGVuZ2luZS0+cHJlZW1wdF9j
b250ZXh0KQogCQlpbnRlbF9jb250ZXh0X3VucGluKGVuZ2luZS0+cHJlZW1wdF9jb250ZXh0KTsK
IAlpbnRlbF9jb250ZXh0X3VucGluKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCUdFTV9CVUdf
T04oIWxsaXN0X2VtcHR5KCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKTsKIAogCWk5MTVfdGltZWxp
bmVfZmluaSgmZW5naW5lLT50aW1lbGluZSk7CiAKQEAgLTEyMDEsMjYgKzEyMDQsNiBAQCB2b2lk
IGludGVsX2VuZ2luZXNfcmVzZXRfZGVmYXVsdF9zdWJtaXNzaW9uKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogCQllbmdpbmUtPnNldF9kZWZhdWx0X3N1Ym1pc3Npb24oZW5naW5lKTsK
IH0KIAotLyoqCi0gKiBpbnRlbF9lbmdpbmVfbG9zdF9jb250ZXh0OiBjYWxsZWQgd2hlbiB0aGUg
R1BVIGlzIHJlc2V0IGludG8gdW5rbm93biBzdGF0ZQotICogQGVuZ2luZTogdGhlIGVuZ2luZQot
ICoKLSAqIFdlIGhhdmUgZWl0aGVyIHJlc2V0IHRoZSBHUFUgb3Igb3RoZXJ3aXNlIGFib3V0IHRv
IGxvc2Ugc3RhdGUgdHJhY2tpbmcgb2YKLSAqIHRoZSBjdXJyZW50IEdQVSBsb2dpY2FsIHN0YXRl
IChlLmcuIHN1c3BlbmQpLiBPbiBuZXh0IHVzZSwgaXQgaXMgdGhlcmVmb3JlCi0gKiBpbXBlcmF0
aXZlIHRoYXQgd2UgbWFrZSBubyBwcmVzdW1wdGlvbnMgYWJvdXQgdGhlIGN1cnJlbnQgc3RhdGUg
YW5kIGxvYWQKLSAqIGZyb20gc2NyYXRjaC4KLSAqLwotdm9pZCBpbnRlbF9lbmdpbmVfbG9zdF9j
b250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2U7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCi0JY2UgPSBmZXRjaF9hbmRfemVybygmZW5naW5lLT5sYXN0X3JldGly
ZWRfY29udGV4dCk7Ci0JaWYgKGNlKQotCQlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKLX0KLQog
Ym9vbCBpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKIHsKIAlzd2l0Y2ggKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpKSB7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4IDkwM2JlZTNkNmM2ZC4uZDE0
ZTM1MmIwYjE3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwpA
QCAtODgsNiArODgsOCBAQCBzdGF0aWMgYm9vbCBzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHQoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJLyogQ2hlY2sgYWdhaW4gb24gdGhlIG5l
eHQgcmV0aXJlbWVudC4gKi8KIAllbmdpbmUtPndha2VyZWZfc2VyaWFsID0gZW5naW5lLT5zZXJp
YWwgKyAxOworCisJaTkxNV9yZXF1ZXN0X2FkZF9iYXJyaWVycyhycSk7CiAJX19pOTE1X3JlcXVl
c3RfY29tbWl0KHJxKTsKIAogCXJldHVybiBmYWxzZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKaW5kZXggMDEyMjM4NjQyMzdhLi4zM2EzMWFhMmQyYWUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCkBAIC0x
MSw2ICsxMSw3IEBACiAjaW5jbHVkZSA8bGludXgvaXJxX3dvcmsuaD4KICNpbmNsdWRlIDxsaW51
eC9rcmVmLmg+CiAjaW5jbHVkZSA8bGludXgvbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L2xsaXN0
Lmg+CiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAogI2luY2x1ZGUgImk5MTVfZ2VtLmgiCkBA
IC0yODgsNiArMjg5LDcgQEAgc3RydWN0IGludGVsX2VuZ2luZV9jcyB7CiAJc3RydWN0IGludGVs
X3JpbmcgKmJ1ZmZlcjsKIAogCXN0cnVjdCBpOTE1X3RpbWVsaW5lIHRpbWVsaW5lOworCXN0cnVj
dCBsbGlzdF9oZWFkIGJhcnJpZXJfdGFza3M7CiAKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqa2Vy
bmVsX2NvbnRleHQ7IC8qIHBpbm5lZCAqLwogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpwcmVlbXB0
X2NvbnRleHQ7IC8qIHBpbm5lZDsgb3B0aW9uYWwgKi8KQEAgLTQzNSwxNyArNDM3LDYgQEAgc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyB7CiAKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyBl
eGVjbGlzdHM7CiAKLQkvKiBDb250ZXh0cyBhcmUgcGlubmVkIHdoaWxzdCB0aGV5IGFyZSBhY3Rp
dmUgb24gdGhlIEdQVS4gVGhlIGxhc3QKLQkgKiBjb250ZXh0IGV4ZWN1dGVkIHJlbWFpbnMgYWN0
aXZlIHdoaWxzdCB0aGUgR1BVIGlzIGlkbGUgLSB0aGUKLQkgKiBzd2l0Y2ggYXdheSBhbmQgd3Jp
dGUgdG8gdGhlIGNvbnRleHQgb2JqZWN0IG9ubHkgb2NjdXJzIG9uIHRoZQotCSAqIG5leHQgZXhl
Y3V0aW9uLiAgQ29udGV4dHMgYXJlIG9ubHkgdW5waW5uZWQgb24gcmV0aXJlbWVudCBvZiB0aGUK
LQkgKiBmb2xsb3dpbmcgcmVxdWVzdCBlbnN1cmluZyB0aGF0IHdlIGNhbiBhbHdheXMgd3JpdGUg
dG8gdGhlIG9iamVjdAotCSAqIG9uIHRoZSBjb250ZXh0IHN3aXRjaCBldmVuIGFmdGVyIGlkbGlu
Zy4gQWNyb3NzIHN1c3BlbmQsIHdlIHN3aXRjaAotCSAqIHRvIHRoZSBrZXJuZWwgY29udGV4dCBh
bmQgdHJhc2ggaXQgYXMgdGhlIHNhdmUgbWF5IG5vdCBoYXBwZW4KLQkgKiBiZWZvcmUgdGhlIGhh
cmR3YXJlIGlzIHBvd2VyZWQgZG93bi4KLQkgKi8KLQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqbGFz
dF9yZXRpcmVkX2NvbnRleHQ7Ci0KIAkvKiBzdGF0dXNfbm90aWZpZXI6IGxpc3Qgb2YgY2FsbGJh
Y2tzIGZvciBjb250ZXh0LXN3aXRjaCBjaGFuZ2VzICovCiAJc3RydWN0IGF0b21pY19ub3RpZmll
cl9oZWFkIGNvbnRleHRfc3RhdHVzX25vdGlmaWVyOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2xyYy5jCmluZGV4IGI4ZjU1OTJkYTE4Zi4uZDBhNTE3NTIzODZmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwpAQCAtMTQyMiw2MCArMTQyMiwxMSBAQCBzdGF0aWMgdm9pZCBleGVj
bGlzdHNfY29udGV4dF9kZXN0cm95KHN0cnVjdCBrcmVmICprcmVmKQogCWludGVsX2NvbnRleHRf
ZnJlZShjZSk7CiB9CiAKLXN0YXRpYyBpbnQgX19jb250ZXh0X3BpbihzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKLXsKLQl1bnNpZ25lZCBpbnQgZmxhZ3M7Ci0JaW50IGVycjsKLQotCWZsYWdzID0gUElO
X0dMT0JBTCB8IFBJTl9ISUdIOwotCWZsYWdzIHw9IFBJTl9PRkZTRVRfQklBUyB8IGk5MTVfZ2d0
dF9waW5fYmlhcyh2bWEpOwotCi0JZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgZmxhZ3Mp
OwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQl2bWEtPm9iai0+cGluX2dsb2JhbCsrOwot
CXZtYS0+b2JqLT5tbS5kaXJ0eSA9IHRydWU7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZv
aWQgX19jb250ZXh0X3VucGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQotewotCXZtYS0+b2JqLT5w
aW5fZ2xvYmFsLS07Ci0JX19pOTE1X3ZtYV91bnBpbih2bWEpOwotfQotCiBzdGF0aWMgdm9pZCBl
eGVjbGlzdHNfY29udGV4dF91bnBpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7Ci0Jc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCi0JLyoKLQkgKiBUaGUgdGFza2xldCBtYXkg
c3RpbGwgYmUgdXNpbmcgYSBwb2ludGVyIHRvIG91ciBzdGF0ZSwgdmlhIGFuCi0JICogb2xkIHJl
cXVlc3QuIEhvd2V2ZXIsIHNpbmNlIHdlIGtub3cgd2Ugb25seSB1bnBpbiB0aGUgY29udGV4dAot
CSAqIG9uIHJldGlyZW1lbnQgb2YgdGhlIGZvbGxvd2luZyByZXF1ZXN0LCB3ZSBrbm93IHRoYXQg
dGhlIGxhc3QKLQkgKiByZXF1ZXN0IHJlZmVyZW5jaW5nIHVzIHdpbGwgaGF2ZSBoYWQgYSBjb21w
bGV0aW9uIENTIGludGVycnVwdC4KLQkgKiBJZiB3ZSBzZWUgdGhhdCBpdCBpcyBzdGlsbCBhY3Rp
dmUsIGl0IG1lYW5zIHRoYXQgdGhlIHRhc2tsZXQgaGFzbid0Ci0JICogaGFkIHRoZSBjaGFuY2Ug
dG8gcnVuIHlldDsgbGV0IGl0IHJ1biBiZWZvcmUgd2UgdGVhcmRvd24gdGhlCi0JICogcmVmZXJl
bmNlIGl0IG1heSB1c2UuCi0JICovCi0JZW5naW5lID0gUkVBRF9PTkNFKGNlLT5pbmZsaWdodCk7
Ci0JaWYgKHVubGlrZWx5KGVuZ2luZSkpIHsKLQkJdW5zaWduZWQgbG9uZyBmbGFnczsKLQotCQlz
cGluX2xvY2tfaXJxc2F2ZSgmZW5naW5lLT50aW1lbGluZS5sb2NrLCBmbGFncyk7Ci0JCXByb2Nl
c3NfY3NiKGVuZ2luZSk7Ci0JCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+dGltZWxp
bmUubG9jaywgZmxhZ3MpOwotCi0JCUdFTV9CVUdfT04oUkVBRF9PTkNFKGNlLT5pbmZsaWdodCkp
OwotCX0KLQogCWk5MTVfZ2VtX2NvbnRleHRfdW5waW5faHdfaWQoY2UtPmdlbV9jb250ZXh0KTsK
LQotCWludGVsX3JpbmdfdW5waW4oY2UtPnJpbmcpOwotCiAJaTkxNV9nZW1fb2JqZWN0X3VucGlu
X21hcChjZS0+c3RhdGUtPm9iaik7Ci0JX19jb250ZXh0X3VucGluKGNlLT5zdGF0ZSk7CisJaW50
ZWxfcmluZ191bnBpbihjZS0+cmluZyk7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC0xNTEyLDcgKzE0
NjMsMTAgQEAgX19leGVjbGlzdHNfY29udGV4dF9waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNl
LAogCQlnb3RvIGVycjsKIAlHRU1fQlVHX09OKCFjZS0+c3RhdGUpOwogCi0JcmV0ID0gX19jb250
ZXh0X3BpbihjZS0+c3RhdGUpOworCXJldCA9IGludGVsX2NvbnRleHRfYWN0aXZlX2FjcXVpcmUo
Y2UsCisJCQkJCSAgIGVuZ2luZS0+aTkxNS0+Z2d0dC5waW5fYmlhcyB8CisJCQkJCSAgIFBJTl9P
RkZTRVRfQklBUyB8CisJCQkJCSAgIFBJTl9ISUdIKTsKIAlpZiAocmV0KQogCQlnb3RvIGVycjsK
IApAQCAtMTUyMSw3ICsxNDc1LDcgQEAgX19leGVjbGlzdHNfY29udGV4dF9waW4oc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlLAogCQkJCQlJOTE1X01BUF9PVkVSUklERSk7CiAJaWYgKElTX0VSUih2
YWRkcikpIHsKIAkJcmV0ID0gUFRSX0VSUih2YWRkcik7Ci0JCWdvdG8gdW5waW5fdm1hOworCQln
b3RvIHVucGluX2FjdGl2ZTsKIAl9CiAKIAlyZXQgPSBpbnRlbF9yaW5nX3BpbihjZS0+cmluZyk7
CkBAIC0xNTQyLDggKzE0OTYsOCBAQCBfX2V4ZWNsaXN0c19jb250ZXh0X3BpbihzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UsCiAJaW50ZWxfcmluZ191bnBpbihjZS0+cmluZyk7CiB1bnBpbl9tYXA6
CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChjZS0+c3RhdGUtPm9iaik7Ci11bnBpbl92bWE6
Ci0JX19jb250ZXh0X3VucGluKGNlLT5zdGF0ZSk7Cit1bnBpbl9hY3RpdmU6CisJaW50ZWxfY29u
dGV4dF9hY3RpdmVfcmVsZWFzZShjZSk7CiBlcnI6CiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCBiM2JmNDdlODE2MmYuLmNj
OTAxZWRlYzA5YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIu
YwpAQCAtMTM0OSw0NSArMTM0OSw5IEBAIHN0YXRpYyB2b2lkIF9fY29udGV4dF91bnBpbl9wcGd0
dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCQlnZW42X3BwZ3R0X3VucGluKGk5MTVf
dm1fdG9fcHBndHQodm0pKTsKIH0KIAotc3RhdGljIGludCBfX2NvbnRleHRfcGluKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSkKLXsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlpbnQgZXJyOwot
Ci0Jdm1hID0gY2UtPnN0YXRlOwotCWlmICghdm1hKQotCQlyZXR1cm4gMDsKLQotCWVyciA9IGk5
MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwgfCBQSU5fSElHSCk7Ci0JaWYgKGVycikK
LQkJcmV0dXJuIGVycjsKLQotCS8qCi0JICogQW5kIG1hcmsgaXMgYXMgYSBnbG9iYWxseSBwaW5u
ZWQgb2JqZWN0IHRvIGxldCB0aGUgc2hyaW5rZXIga25vdwotCSAqIGl0IGNhbm5vdCByZWNsYWlt
IHRoZSBvYmplY3QgdW50aWwgd2UgcmVsZWFzZSBpdC4KLQkgKi8KLQl2bWEtPm9iai0+cGluX2ds
b2JhbCsrOwotCXZtYS0+b2JqLT5tbS5kaXJ0eSA9IHRydWU7Ci0KLQlyZXR1cm4gMDsKLX0KLQot
c3RhdGljIHZvaWQgX19jb250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKLXsK
LQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQotCXZtYSA9IGNlLT5zdGF0ZTsKLQlpZiAoIXZtYSkK
LQkJcmV0dXJuOwotCi0Jdm1hLT5vYmotPnBpbl9nbG9iYWwtLTsKLQlpOTE1X3ZtYV91bnBpbih2
bWEpOwotfQotCiBzdGF0aWMgdm9pZCByaW5nX2NvbnRleHRfdW5waW4oc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlKQogewogCV9fY29udGV4dF91bnBpbl9wcGd0dChjZS0+Z2VtX2NvbnRleHQpOwot
CV9fY29udGV4dF91bnBpbihjZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKgpAQCAt
MTQ3NywxOCArMTQ0MSwxOCBAQCBzdGF0aWMgaW50IHJpbmdfY29udGV4dF9waW4oc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKQogCQljZS0+c3RhdGUgPSB2bWE7CiAJfQogCi0JZXJyID0gX19jb250
ZXh0X3BpbihjZSk7CisJZXJyID0gaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShjZSwgUElO
X0hJR0gpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKIAllcnIgPSBfX2NvbnRleHRfcGlu
X3BwZ3R0KGNlLT5nZW1fY29udGV4dCk7CiAJaWYgKGVycikKLQkJZ290byBlcnJfdW5waW47CisJ
CWdvdG8gZXJyX2FjdGl2ZTsKIAogCXJldHVybiAwOwogCi1lcnJfdW5waW46Ci0JX19jb250ZXh0
X3VucGluKGNlKTsKK2Vycl9hY3RpdmU6CisJaW50ZWxfY29udGV4dF9hY3RpdmVfcmVsZWFzZShj
ZSk7CiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvbW9ja19lbmdpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMK
aW5kZXggNmQ3NTYyNzY5ZWIyLi5kMWVmNTE1YmFjOGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
bW9ja19lbmdpbmUuYwpAQCAtMTQ2LDEyICsxNDYsMTggQEAgc3RhdGljIHZvaWQgbW9ja19jb250
ZXh0X2Rlc3Ryb3koc3RydWN0IGtyZWYgKnJlZikKIAogc3RhdGljIGludCBtb2NrX2NvbnRleHRf
cGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKKwlpbnQgcmV0OworCiAJaWYgKCFjZS0+
cmluZykgewogCQljZS0+cmluZyA9IG1vY2tfcmluZyhjZS0+ZW5naW5lKTsKIAkJaWYgKCFjZS0+
cmluZykKIAkJCXJldHVybiAtRU5PTUVNOwogCX0KIAorCXJldCA9IGludGVsX2NvbnRleHRfYWN0
aXZlX2FjcXVpcmUoY2UsIFBJTl9ISUdIKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCiAJ
bW9ja190aW1lbGluZV9waW4oY2UtPnJpbmctPnRpbWVsaW5lKTsKIAlyZXR1cm4gMDsKIH0KQEAg
LTMyOCwxNCArMzM0LDkgQEAgdm9pZCBtb2NrX2VuZ2luZV9mcmVlKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgbW9ja19lbmdpbmUgKm1vY2sgPQogCQljb250YWlu
ZXJfb2YoZW5naW5lLCB0eXBlb2YoKm1vY2spLCBiYXNlKTsKLQlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2U7CiAKIAlHRU1fQlVHX09OKHRpbWVyX3BlbmRpbmcoJm1vY2stPmh3X2RlbGF5KSk7CiAK
LQljZSA9IGZldGNoX2FuZF96ZXJvKCZlbmdpbmUtPmxhc3RfcmV0aXJlZF9jb250ZXh0KTsKLQlp
ZiAoY2UpCi0JCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwotCiAJaW50ZWxfY29udGV4dF91bnBp
bihlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKIAogCWludGVsX2VuZ2luZV9maW5pX2JyZWFkY3J1
bWJzKGVuZ2luZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2
ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwppbmRleCA4NjNhZTEyNzA3
YmEuLjJkMDE5YWM2ZGIyMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0xNTcs
NiArMTU3LDcgQEAgdm9pZCBpOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCXJlZi0+cmV0aXJlID0gcmV0aXJlOwogCXJlZi0+dHJlZSA9IFJCX1JPT1Q7CiAJ
aTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KCZyZWYtPmxhc3QsIE5VTEwsIGxhc3RfcmV0aXJlKTsK
Kwlpbml0X2xsaXN0X2hlYWQoJnJlZi0+YmFycmllcnMpOwogCXJlZi0+Y291bnQgPSAwOwogfQog
CkBAIC0yNjMsNiArMjY0LDgzIEBAIHZvaWQgaTkxNV9hY3RpdmVfZmluaShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKIH0KICNlbmRpZgogCitpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZV9wcmVhbGxv
Y2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAorCQkJCQkgICAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gZW5naW5lLT5pOTE1OworCXVuc2lnbmVkIGxvbmcgdG1wOworCWludCBlcnIgPSAwOworCisJ
R0VNX0JVR19PTighZW5naW5lLT5tYXNrKTsKKwlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgaTkxNSwgZW5naW5lLT5tYXNrLCB0bXApIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmtj
dHggPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0OworCQlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGU7
CisKKwkJbm9kZSA9IGttZW1fY2FjaGVfYWxsb2MoZ2xvYmFsLnNsYWJfY2FjaGUsIEdGUF9LRVJO
RUwpOworCQlpZiAodW5saWtlbHkoIW5vZGUpKSB7CisJCQllcnIgPSAtRU5PTUVNOworCQkJYnJl
YWs7CisJCX0KKworCQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJm5vZGUtPmJhc2UsCisJCQkJ
CSAodm9pZCAqKWVuZ2luZSwgbm9kZV9yZXRpcmUpOworCQlub2RlLT50aW1lbGluZSA9IGtjdHgt
PnJpbmctPnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0OworCQlub2RlLT5yZWYgPSByZWY7CisJCXJl
Zi0+Y291bnQrKzsKKworCQlsbGlzdF9hZGQoKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJh
c2UubGluaywKKwkJCSAgJnJlZi0+YmFycmllcnMpOworCX0KKworCXJldHVybiBlcnI7Cit9CisK
K3ZvaWQgaTkxNV9hY3RpdmVfYWNxdWlyZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KQoreworCXN0cnVjdCBsbGlzdF9ub2RlICpwb3MsICpuZXh0OworCisJaTkxNV9hY3RpdmVfYWNx
dWlyZShyZWYpOworCisJbGxpc3RfZm9yX2VhY2hfc2FmZShwb3MsIG5leHQsIGxsaXN0X2RlbF9h
bGwoJnJlZi0+YmFycmllcnMpKSB7CisJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
KwkJc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlOworCQlzdHJ1Y3QgcmJfbm9kZSAqKnAsICpwYXJl
bnQ7CisKKwkJbm9kZSA9IGNvbnRhaW5lcl9vZigoc3RydWN0IGxpc3RfaGVhZCAqKXBvcywKKwkJ
CQkgICAgdHlwZW9mKCpub2RlKSwgYmFzZS5saW5rKTsKKworCQllbmdpbmUgPSAodm9pZCAqKXJj
dV9hY2Nlc3NfcG9pbnRlcihub2RlLT5iYXNlLnJlcXVlc3QpOworCQlSQ1VfSU5JVF9QT0lOVEVS
KG5vZGUtPmJhc2UucmVxdWVzdCwgRVJSX1BUUigtRUFHQUlOKSk7CisKKwkJcGFyZW50ID0gTlVM
TDsKKwkJcCA9ICZyZWYtPnRyZWUucmJfbm9kZTsKKwkJd2hpbGUgKCpwKSB7CisJCQlwYXJlbnQg
PSAqcDsKKwkJCWlmIChyYl9lbnRyeShwYXJlbnQsCisJCQkJICAgICBzdHJ1Y3QgYWN0aXZlX25v
ZGUsCisJCQkJICAgICBub2RlKS0+dGltZWxpbmUgPCBub2RlLT50aW1lbGluZSkKKwkJCQlwID0g
JnBhcmVudC0+cmJfcmlnaHQ7CisJCQllbHNlCisJCQkJcCA9ICZwYXJlbnQtPnJiX2xlZnQ7CisJ
CX0KKwkJcmJfbGlua19ub2RlKCZub2RlLT5ub2RlLCBwYXJlbnQsIHApOworCQlyYl9pbnNlcnRf
Y29sb3IoJm5vZGUtPm5vZGUsICZyZWYtPnRyZWUpOworCisJCWxsaXN0X2FkZCgoc3RydWN0IGxs
aXN0X25vZGUgKikmbm9kZS0+YmFzZS5saW5rLAorCQkJICAmZW5naW5lLT5iYXJyaWVyX3Rhc2tz
KTsKKwl9CisJaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYpOworfQorCit2b2lkIGk5MTVfcmVxdWVz
dF9hZGRfYmFycmllcnMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2luZTsKKwlzdHJ1Y3QgbGxpc3Rfbm9kZSAqbm9k
ZSwgKm5leHQ7CisKKwlsbGlzdF9mb3JfZWFjaF9zYWZlKG5vZGUsIG5leHQsIGxsaXN0X2RlbF9h
bGwoJmVuZ2luZS0+YmFycmllcl90YXNrcykpCisJCWxpc3RfYWRkX3RhaWwoKHN0cnVjdCBsaXN0
X2hlYWQgKilub2RlLCAmcnEtPmFjdGl2ZV9saXN0KTsKK30KKwogaW50IGk5MTVfYWN0aXZlX3Jl
cXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAJCQkgICAgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAppbmRl
eCA3ZDc1ODcxOWNlMzkuLmQ1NWQzNzY3Mzk0NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2
ZS5oCkBAIC00MDYsNCArNDA2LDkgQEAgdm9pZCBpOTE1X2FjdGl2ZV9maW5pKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKTsKIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2FjdGl2ZV9maW5pKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKSB7IH0KICNlbmRpZgogCitpbnQgaTkxNV9hY3RpdmVfYWNxdWly
ZV9wcmVhbGxvY2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAorCQkJCQkgICAg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKK3ZvaWQgaTkxNV9hY3RpdmVfYWNxdWly
ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKK3ZvaWQgaTkxNV9yZXF1ZXN0X2Fk
ZF9iYXJyaWVycyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CisKICNlbmRpZiAvKiBfSTkxNV9B
Q1RJVkVfSF8gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZl
X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCmluZGV4
IGI2NzkyNTNiNTNhNS4uYzAyNTk5MWI5MjMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlX3R5cGVzLmgKQEAgLTcsNiArNyw3IEBACiAjaWZuZGVmIF9JOTE1X0FDVElWRV9UWVBF
U19IXwogI2RlZmluZSBfSTkxNV9BQ1RJVkVfVFlQRVNfSF8KIAorI2luY2x1ZGUgPGxpbnV4L2xs
aXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvcmJ0cmVlLmg+CiAjaW5jbHVkZSA8bGludXgvcmN1cGRh
dGUuaD4KIApAQCAtMzEsNiArMzIsOCBAQCBzdHJ1Y3QgaTkxNV9hY3RpdmUgewogCXVuc2lnbmVk
IGludCBjb3VudDsKIAogCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsK
KworCXN0cnVjdCBsbGlzdF9oZWFkIGJhcnJpZXJzOwogfTsKIAogI2VuZGlmIC8qIF9JOTE1X0FD
VElWRV9UWVBFU19IXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggMjE3MjM2NTk2MjAy
Li4zMzVlZmVhYWQ0ZjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTE5OSwxMCArMTE5
OSw2IEBAIHZvaWQgaTkxNV9nZW1fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAKIAlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJl
Zik7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpOTE1X2dlbV9j
b250ZXh0c19sb3N0KGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiB9CiAKIHZvaWQgaTkxNV9nZW1faW5pdF9zd2l6emxpbmcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCBkYTc2
ZTRkMWM3ZjEuLjM4ZDExMmQ4YWJhNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMK
QEAgLTIxMywxOCArMjEzLDYgQEAgc3RhdGljIHZvaWQgX19yZXRpcmVfZW5naW5lX3JlcXVlc3Qo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCXNwaW5fdW5sb2NrKCZycS0+bG9jayk7
CiAKIAlsb2NhbF9pcnFfZW5hYmxlKCk7Ci0KLQkvKgotCSAqIFRoZSBiYWNraW5nIG9iamVjdCBm
b3IgdGhlIGNvbnRleHQgaXMgZG9uZSBhZnRlciBzd2l0Y2hpbmcgdG8gdGhlCi0JICogKm5leHQq
IGNvbnRleHQuIFRoZXJlZm9yZSB3ZSBjYW5ub3QgcmV0aXJlIHRoZSBwcmV2aW91cyBjb250ZXh0
IHVudGlsCi0JICogdGhlIG5leHQgY29udGV4dCBoYXMgYWxyZWFkeSBzdGFydGVkIHJ1bm5pbmcu
IEhvd2V2ZXIsIHNpbmNlIHdlCi0JICogY2Fubm90IHRha2UgdGhlIHJlcXVpcmVkIGxvY2tzIGF0
IGk5MTVfcmVxdWVzdF9zdWJtaXQoKSB3ZQotCSAqIGRlZmVyIHRoZSB1bnBpbm5pbmcgb2YgdGhl
IGFjdGl2ZSBjb250ZXh0IHRvIG5vdywgcmV0aXJlbWVudCBvZgotCSAqIHRoZSBzdWJzZXF1ZW50
IHJlcXVlc3QuCi0JICovCi0JaWYgKGVuZ2luZS0+bGFzdF9yZXRpcmVkX2NvbnRleHQpCi0JCWlu
dGVsX2NvbnRleHRfdW5waW4oZW5naW5lLT5sYXN0X3JldGlyZWRfY29udGV4dCk7Ci0JZW5naW5l
LT5sYXN0X3JldGlyZWRfY29udGV4dCA9IHJxLT5od19jb250ZXh0OwogfQogCiBzdGF0aWMgdm9p
ZCBfX3JldGlyZV9lbmdpbmVfdXB0byhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCkBA
IC03NTksOSArNzQ3LDYgQEAgX19pOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwgZ2ZwX3QgZ2ZwKQogCiAJcnEtPmluZml4ID0gcnEtPnJpbmctPmVtaXQ7IC8qIGVu
ZCBvZiBoZWFkZXI7IHN0YXJ0IG9mIHVzZXIgcGF5bG9hZCAqLwogCi0JLyogS2VlcCBhIHNlY29u
ZCBwaW4gZm9yIHRoZSBkdWFsIHJldGlyZW1lbnQgYWxvbmcgZW5naW5lIGFuZCByaW5nICovCi0J
X19pbnRlbF9jb250ZXh0X3BpbihjZSk7Ci0KIAlpbnRlbF9jb250ZXh0X21hcmtfYWN0aXZlKGNl
KTsKIAlyZXR1cm4gcnE7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9t
b2NrX2dlbV9kZXZpY2UuYwppbmRleCA4MmYyYmU2Y2VjNWIuLjY0YmM1MTQwMGFlNyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAt
NTYsNyArNTYsNiBAQCBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9yZWxlYXNlKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYpCiAKIAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlt
b2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQlpOTE1X2dlbV9jb250ZXh0c19sb3N0KGk5MTUpOwog
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlmbHVzaF93b3JrKCZp
OTE1LT5nZW0uaWRsZV93b3JrKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vaW50ZWwtZ2Z4

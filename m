Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6EEF7B99A5
	for <lists+intel-gfx@lfdr.de>; Sat, 21 Sep 2019 00:26:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7D1FE6FE0B;
	Fri, 20 Sep 2019 22:26:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4735F6FE0A;
 Fri, 20 Sep 2019 22:26:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18564794-1500050 
 for multiple; Fri, 20 Sep 2019 23:26:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 23:26:10 +0100
Message-Id: <20190920222610.29282-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] i915/gem_exec_balancer: Check for
 scheduling bonded-pairs on the same engine
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGV4cGVjdGF0aW9uIGZvciBib25kZWQgc3VibWlzc2lvbiBpcyB0aGF0IHRoZXkgYXJlIHJ1
biBjb25jdXJyZW50bHksCmluIHBhcmFsbGVsIG9uIG11bHRpcGxlIGVuZ2luZXMuIEhvd2V2ZXIs
IGdpdmVuIGEgbGFjayBvZiBjb25zdHJhaW50cyBpbgp0aGUgc2NoZWR1bGVyJ3Mgc2VsZWN0aW9u
IGNvbWJpbmVkIHdpdGggdGltZXNsaWNpbmcgY291bGQgbWVhbiB0aGF0IHRoZQpib25kZWQgcmVx
dWVzdHMgY291bGQgYmUgcnVuIGluIG9wcG9zaXRlIG9yZGVyIG9uIHRoZSBzYW1lIGVuZ2luZS4g
V2l0aApqdXN0IHRoZSByaWdodCBwYWlyIG9mIHJlcXVlc3RzLCB0aGlzIGNhbiBjYXVzZSBhIEdQ
VSBoYW5nIChvciBhdCBsZWFzdAp0cmlnZ2VyIGhhbmdjaGVja2VyKSwgYmVzdCAod29yc3QpIGNh
c2Ugd291bGQgYmUgZXhlY3V0aW9uIHJ1bm5pbmcKc2V2ZXJhbCB0aW1lcyBzbG93ZXIgdGhhbiBp
ZGVhbC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiB0
ZXN0cy9pOTE1L2dlbV9leGVjX2JhbGFuY2VyLmMgfCAxNTEgKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrKysrCiAxIGZpbGUgY2hhbmdlZCwgMTUxIGluc2VydGlvbnMoKykKCmRpZmYgLS1n
aXQgYS90ZXN0cy9pOTE1L2dlbV9leGVjX2JhbGFuY2VyLmMgYi90ZXN0cy9pOTE1L2dlbV9leGVj
X2JhbGFuY2VyLmMKaW5kZXggNDA3ZGMwZWNhLi5lNGZlNzU3NDcgMTAwNjQ0Ci0tLSBhL3Rlc3Rz
L2k5MTUvZ2VtX2V4ZWNfYmFsYW5jZXIuYworKysgYi90ZXN0cy9pOTE1L2dlbV9leGVjX2JhbGFu
Y2VyLmMKQEAgLTMwLDYgKzMwLDE1IEBACiAKIElHVF9URVNUX0RFU0NSSVBUSU9OKCJFeGVyY2lz
ZSBpbi1rZXJuZWwgbG9hZC1iYWxhbmNpbmciKTsKIAorI2RlZmluZSBNSV9TRU1BUEhPUkVfV0FJ
VAkJKDB4MWMgPDwgMjMpCisjZGVmaW5lICAgTUlfU0VNQVBIT1JFX1BPTEwgICAgICAgICAgICAg
KDEgPDwgMTUpCisjZGVmaW5lICAgTUlfU0VNQVBIT1JFX1NBRF9HVF9TREQgICAgICAgKDAgPDwg
MTIpCisjZGVmaW5lICAgTUlfU0VNQVBIT1JFX1NBRF9HVEVfU0REICAgICAgKDEgPDwgMTIpCisj
ZGVmaW5lICAgTUlfU0VNQVBIT1JFX1NBRF9MVF9TREQgICAgICAgKDIgPDwgMTIpCisjZGVmaW5l
ICAgTUlfU0VNQVBIT1JFX1NBRF9MVEVfU0REICAgICAgKDMgPDwgMTIpCisjZGVmaW5lICAgTUlf
U0VNQVBIT1JFX1NBRF9FUV9TREQgICAgICAgKDQgPDwgMTIpCisjZGVmaW5lICAgTUlfU0VNQVBI
T1JFX1NBRF9ORVFfU0REICAgICAgKDUgPDwgMTIpCisKICNkZWZpbmUgSU5TVEFOQ0VfQ09VTlQg
KDEgPDwgSTkxNV9QTVVfU0FNUExFX0lOU1RBTkNFX0JJVFMpCiAKIHN0YXRpYyBzaXplX3Qgc2l6
ZW9mX2xvYWRfYmFsYW5jZShpbnQgY291bnQpCkBAIC02OTQsNiArNzAzLDE0NSBAQCBzdGF0aWMg
dm9pZCBib25kZWQoaW50IGk5MTUsIHVuc2lnbmVkIGludCBmbGFncykKIAlnZW1fY29udGV4dF9k
ZXN0cm95KGk5MTUsIG1hc3Rlcik7CiB9CiAKK3N0YXRpYyB1bnNpZ25lZCBpbnQgb2Zmc2V0X2lu
X3BhZ2Uodm9pZCAqYWRkcikKK3sKKwlyZXR1cm4gKHVpbnRwdHJfdClhZGRyICYgNDA5NTsKK30K
Kworc3RhdGljIHVpbnQzMl90IGNyZWF0ZV9zZW1hcGhvcmVfdG9fc3Bpbm5lcihpbnQgaTkxNSwg
aWd0X3NwaW5fdCAqc3BpbikKK3sKKwl1aW50MzJfdCAqY3MsICptYXA7CisJdWludDMyX3QgaGFu
ZGxlOworCisJaGFuZGxlID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KTsKKwljcyA9IG1hcCA9IGdl
bV9tbWFwX19jcHUoaTkxNSwgaGFuZGxlLCAwLCA0MDk2LCBQUk9UX1dSSVRFKTsKKworCS8qIFdh
aXQgdW50aWwgdGhlIHNwaW5uZXIgaXMgcnVubmluZyAqLworCSpjcysrID0gTUlfU0VNQVBIT1JF
X1dBSVQgfAorCQlNSV9TRU1BUEhPUkVfUE9MTCB8CisJCU1JX1NFTUFQSE9SRV9TQURfTkVRX1NE
RCB8CisJCSg0IC0gMik7CisJKmNzKysgPSAwOworCSpjcysrID0gc3Bpbi0+b2JqWzBdLm9mZnNl
dCArIDQgKiBTUElOX1BPTExfU1RBUlRfSURYOworCSpjcysrID0gMDsKKworCS8qIFRoZW4gY2Fu
Y2VsIHRoZSBzcGlubmVyICovCisJKmNzKysgPSBNSV9TVE9SRV9EV09SRF9JTU07CisJKmNzKysg
PSBzcGluLT5vYmpbSUdUX1NQSU5fQkFUQ0hdLm9mZnNldCArCisJCW9mZnNldF9pbl9wYWdlKHNw
aW4tPmNvbmRpdGlvbik7CisJKmNzKysgPSAwOworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VO
RDsKKworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwltdW5tYXAobWFwLCA0MDk2KTsK
KworCXJldHVybiBoYW5kbGU7Cit9CisKK3N0YXRpYyB2b2lkIGJvbmRlZF9zbGljZShpbnQgaTkx
NSkKK3sKKwl1aW50MzJfdCBjdHg7CisJaW50ICpzdG9wOworCisJaWd0X3JlcXVpcmUoZ2VtX3Nj
aGVkdWxlcl9oYXNfc2VtYXBob3JlcyhpOTE1KSk7CisKKwlzdG9wID0gbW1hcCgwLCA0MDk2LCBQ
Uk9UX1dSSVRFLCBNQVBfU0hBUkVEIHwgTUFQX0FOT04sIC0xLCAwKTsKKwlpZ3RfYXNzZXJ0KHN0
b3AgIT0gTUFQX0ZBSUxFRCk7CisKKwljdHggPSBnZW1fY29udGV4dF9jcmVhdGUoaTkxNSk7CisK
Kwlmb3IgKGludCBjbGFzcyA9IDA7IGNsYXNzIDwgMzI7IGNsYXNzKyspIHsKKwkJc3RydWN0IGk5
MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICpzaWJsaW5nczsKKwkJc3RydWN0IGRybV9pOTE1X2dl
bV9leGVjX29iamVjdDIgb2JqWzNdID0ge307CisJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1
ZmZlcjIgZWIgPSB7fTsKKwkJdW5zaWduZWQgaW50IGNvdW50OworCQlpZ3Rfc3Bpbl90ICpzcGlu
OworCisJCXNpYmxpbmdzID0gbGlzdF9lbmdpbmVzKGk5MTUsIDF1IDw8IGNsYXNzLCAmY291bnQp
OworCQlpZiAoIXNpYmxpbmdzKQorCQkJY29udGludWU7CisKKwkJaWYgKGNvdW50IDwgMikgewor
CQkJZnJlZShzaWJsaW5ncyk7CisJCQljb250aW51ZTsKKwkJfQorCisJCS8qCisJCSAqIEE6IHNl
bWFwaG9yZSB3YWl0IG9uIHNwaW5uZXI7IGNhbmNlbCBzcGlubmVyCisJCSAqIEI6IHVucHJlZW1w
dGFibGUgc3Bpbm5lcgorCQkgKgorCQkgKiBBIHdhaXRzIGZvciBydW5uaW5nIGFjayBmcm9tIEIs
IGlmIHNjaGVkdWxlZCBvbiB0aGUgc2FtZQorCQkgKiBlbmdpbmUgLT4gaGFuZy4KKwkJICoKKwkJ
ICogQys6IGJhY2tncm91bmQgbG9hZCBhY3Jvc3MgZW5naW5lcworCQkgKi8KKworCQlzZXRfbG9h
ZF9iYWxhbmNlcihpOTE1LCBjdHgsIHNpYmxpbmdzLCBjb3VudCwgTlVMTCk7CisKKwkJc3BpbiA9
IF9faWd0X3NwaW5fbmV3KGk5MTUsCisJCQkJICAgICAgLmN0eCA9IGN0eCwKKwkJCQkgICAgICAu
ZmxhZ3MgPSAoSUdUX1NQSU5fTk9fUFJFRU1QVElPTiB8CisJCQkJCQlJR1RfU1BJTl9QT0xMX1JV
TikpOworCQlpZ3Rfc3Bpbl9lbmQoc3Bpbik7IC8qIHdlIGp1c3Qgd2FudCBpdHMgYWRkcmVzcyBm
b3IgbGF0ZXIgKi8KKwkJZ2VtX3N5bmMoaTkxNSwgc3Bpbi0+aGFuZGxlKTsKKwkJaWd0X3NwaW5f
cmVzZXQoc3Bpbik7CisKKwkJb2JqWzBdID0gc3Bpbi0+b2JqWzBdOworCQlvYmpbMV0gPSBzcGlu
LT5vYmpbMV07CisJCW9ialsyXS5oYW5kbGUgPSBjcmVhdGVfc2VtYXBob3JlX3RvX3NwaW5uZXIo
aTkxNSwgc3Bpbik7CisKKwkJZWIuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIob2JqKTsK
KwkJZWIucnN2ZDEgPSBjdHg7CisKKwkJKnN0b3AgPSAwOworCQlpZ3RfZm9yayhjaGlsZCwgY291
bnQgKyAxKSB7CisJCQlpZ3RfbGlzdF9kZWwoJnNwaW4tPmxpbmspOworCisJCQljdHggPSBnZW1f
Y29udGV4dF9jbG9uZShpOTE1LCBjdHgsCisJCQkJCQlJOTE1X0NPTlRFWFRfQ0xPTkVfRU5HSU5F
UywgMCk7CisKKwkJCXdoaWxlICghUkVBRF9PTkNFKCpzdG9wKSkgeworCQkJCXNwaW4gPSBpZ3Rf
c3Bpbl9uZXcoaTkxNSwKKwkJCQkJCSAgICAuY3R4ID0gY3R4LAorCQkJCQkJICAgIC5lbmdpbmUg
PSAoMSArIHJhbmQoKSAlIGNvdW50KSwKKwkJCQkJCSAgICAuZmxhZ3MgPSBJR1RfU1BJTl9QT0xM
X1JVTik7CisJCQkJaWd0X3NwaW5fYnVzeXdhaXRfdW50aWxfc3RhcnRlZChzcGluKTsKKwkJCQl1
c2xlZXAoNTAwMDApOworCQkJCWlndF9zcGluX2ZyZWUoaTkxNSwgc3Bpbik7CisJCQl9CisKKwkJ
CWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4KTsKKwkJfQorCisJCWlndF91bnRpbF90aW1l
b3V0KDUpIHsKKwkJCWlndF9zcGluX3Jlc2V0KHNwaW4pOworCisJCQkvKiBBOiBTdWJtaXQgdGhl
IHNlbWFwaG9yZSB3YWl0ICovCisJCQllYi5idWZmZXJfY291bnQgPSAzOworCQkJZWIuZmxhZ3Mg
PSAoMSArIHJhbmQoKSAlIGNvdW50KSB8IEk5MTVfRVhFQ19GRU5DRV9PVVQ7CisJCQlnZW1fZXhl
Y2J1Zl93cihpOTE1LCAmZWIpOworCisJCQkvKiBCOiBTdWJtaXQgdGhlIHNwaW5uZXIgKGluIHBh
cmFsbGVsKSAqLworCQkJZWIuYnVmZmVyX2NvdW50ID0gMjsKKwkJCWViLmZsYWdzID0gMCB8IEk5
MTVfRVhFQ19GRU5DRV9TVUJNSVQ7CisJCQllYi5yc3ZkMiA+Pj0gMzI7CisJCQlnZW1fZXhlY2J1
ZihpOTE1LCAmZWIpOworCQkJY2xvc2UoZWIucnN2ZDIpOworCisJCQlnZW1fc3luYyhpOTE1LCBv
YmpbMl0uaGFuZGxlKTsKKwkJfQorCisJCSpzdG9wID0gMTsKKwkJaWd0X3dhaXRjaGlsZHJlbigp
OworCisJCWdlbV9jbG9zZShpOTE1LCBvYmpbMl0uaGFuZGxlKTsKKwkJaWd0X3NwaW5fZnJlZShp
OTE1LCBzcGluKTsKKwl9CisKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eCk7CisJbXVu
bWFwKHN0b3AsIDQwOTYpOworfQorCiBzdGF0aWMgdm9pZCBpbmRpY2VzKGludCBpOTE1KQogewog
CUk5MTVfREVGSU5FX0NPTlRFWFRfUEFSQU1fRU5HSU5FUyhlbmdpbmVzLCBJOTE1X0VYRUNfUklO
R19NQVNLICsgMSk7CkBAIC0xMzIwLDYgKzE0NjgsOSBAQCBpZ3RfbWFpbgogCWlndF9zdWJ0ZXN0
KCJib25kZWQtY29yayIpCiAJCWJvbmRlZChpOTE1LCBDT1JLKTsKIAorCWlndF9zdWJ0ZXN0KCJi
b25kZWQtc2xpY2UiKQorCQlib25kZWRfc2xpY2UoaTkxNSk7CisKIAlpZ3RfZml4dHVyZSB7CiAJ
CWlndF9zdG9wX2hhbmdfZGV0ZWN0b3IoKTsKIAl9Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

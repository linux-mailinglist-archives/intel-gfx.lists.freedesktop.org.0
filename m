Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2016B716D5
	for <lists+intel-gfx@lfdr.de>; Tue, 23 Jul 2019 13:19:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6CC6B89A57;
	Tue, 23 Jul 2019 11:19:39 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 78A2089A5C
 for <intel-gfx@lists.freedesktop.org>; Tue, 23 Jul 2019 11:19:38 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17532000-1500050 
 for multiple; Tue, 23 Jul 2019 12:19:15 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 23 Jul 2019 12:19:13 +0100
Message-Id: <20190723111913.20475-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] mei: Abort writes if incomplete after 1s
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Tomas Winkler <tomas.winkler@intel.com>,
 Alexander Usyskin <alexander.usyskin@intel.com>, linux-kernel@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RHVyaW5nIGk5MTUgdW5sb2FkLCBpdCBhcHBlYXJzIHRoYXQgaXQgbWF5IGdldCBzdHVjayB3YWl0
aW5nIG9uIGEKd29ya3F1ZXVlIGJlaW5nIGhvZ2dlZCBieSBtZWk6Cgo8Nz4gWzIxMi42NjY5MTJd
IGk5MTUgMDAwMDowMDowMi4wOiBbZHJtOmRybV9jbGllbnRfcmVsZWFzZV0gZHJtX2ZiX2hlbHBl
cgo8Mz4gWzMwOC41NDQ5NDNdIElORk86IHRhc2sgaTkxNV9tb2R1bGVfbG9hOjI2MTIgYmxvY2tl
ZCBmb3IgbW9yZSB0aGFuIDYxIHNlY29uZHMuCjwzPiBbMzA4LjU0NTA0N10gICAgICAgVGFpbnRl
ZDogRyAgICAgVSAgVyAgICAgICAgIDUuMy4wLXJjMS1DSS1DSV9EUk1fNjUzNysgIzEKPDM+IFsz
MDguNTQ1MDg1XSAiZWNobyAwID4gL3Byb2Mvc3lzL2tlcm5lbC9odW5nX3Rhc2tfdGltZW91dF9z
ZWNzIiBkaXNhYmxlcyB0aGlzIG1lc3NhZ2UuCjw2PiBbMzA4LjU0NTEyOF0gaTkxNV9tb2R1bGVf
bG9hIEQxMzI1NiAgMjYxMiAgICA5NjAgMHgwMDAwNDAwNAo8ND4gWzMwOC41NDUxMzddIENhbGwg
VHJhY2U6Cjw0PiBbMzA4LjU0NTE1MF0gID8gX19zY2hlZHVsZSsweDMyNi8weDg5MAo8ND4gWzMw
OC41NDUxNTldICA/IHdhaXRfZm9yX2NvbW1vbisweDExNi8weDFmMAo8ND4gWzMwOC41NDUxNjRd
ICBzY2hlZHVsZSsweDJiLzB4YjAKPDQ+IFszMDguNTQ1MTY5XSAgc2NoZWR1bGVfdGltZW91dCsw
eDIxOS8weDNjMAo8ND4gWzMwOC41NDUxNzZdICA/IHdhaXRfZm9yX2NvbW1vbisweDEzMi8weDFm
MAo8ND4gWzMwOC41NDUxODNdICA/IF9yYXdfc3Bpbl91bmxvY2tfaXJxKzB4MjQvMHgzMAo8ND4g
WzMwOC41NDUxODldICA/IHdhaXRfZm9yX2NvbW1vbisweDExNi8weDFmMAo8ND4gWzMwOC41NDUx
OTNdICB3YWl0X2Zvcl9jb21tb24rMHgxM2EvMHgxZjAKPDQ+IFszMDguNTQ1MjAwXSAgPyB3YWtl
X3VwX3ErMHg4MC8weDgwCjw0PiBbMzA4LjU0NTIwOV0gIGZsdXNoX3dvcmtxdWV1ZSsweDE5ZC8w
eDU0MAo8ND4gWzMwOC41NDUzMzRdICA/IGludGVsX21vZGVzZXRfZHJpdmVyX3JlbW92ZSsweGIz
LzB4MTQwIFtpOTE1XQo8ND4gWzMwOC41NDU0MDddICBpbnRlbF9tb2Rlc2V0X2RyaXZlcl9yZW1v
dmUrMHhiMy8weDE0MCBbaTkxNV0KPDQ+IFszMDguNTQ1NDY0XSAgaTkxNV9kcml2ZXJfcmVtb3Zl
KzB4YWUvMHgxMTAgW2k5MTVdCjw0PiBbMzA4LjU0NTUyMl0gIGk5MTVfcGNpX3JlbW92ZSsweDE5
LzB4MzAgW2k5MTVdCjw0PiBbMzA4LjU0NTUyOV0gIHBjaV9kZXZpY2VfcmVtb3ZlKzB4MzYvMHhi
MAoKPDY+IFszMDguNTY1NDIyXSBTaG93aW5nIGJ1c3kgd29ya3F1ZXVlcyBhbmQgd29ya2VyIHBv
b2xzOgo8Nj4gWzMwOC41NjU0MjVdIHdvcmtxdWV1ZSBldmVudHM6IGZsYWdzPTB4MAo8Nj4gWzMw
OC41NjU1NzJdICAgcHdxIDI6IGNwdXM9MSBub2RlPTAgZmxhZ3M9MHgwIG5pY2U9MCBhY3RpdmU9
Mi8yNTYKPDY+IFszMDguNTY1NjM1XSAgICAgaW4tZmxpZ2h0OiA0NDE6bWVpX2NsX2J1c19yZXNj
YW5fd29yayBbbWVpXQo8Nj4gWzMwOC41NjU2NDFdICAgICBwZW5kaW5nOiBkYnNfd29ya19oYW5k
bGVyCjw2PiBbMzA4LjU2NTY4Nl0gcG9vbCAyOiBjcHVzPTEgbm9kZT0wIGZsYWdzPTB4MCBuaWNl
PTAgaHVuZz0wcyB3b3JrZXJzPTUgaWRsZTogMjI0OCAyMSAxNyAxNjkKCjw2PiBbMzA4LjU1Mzc4
OF0gV29ya3F1ZXVlOiBldmVudHMgbWVpX2NsX2J1c19yZXNjYW5fd29yayBbbWVpXQo8ND4gWzMw
OC41NTM3OTJdIENhbGwgVHJhY2U6Cjw0PiBbMzA4LjU1Mzc5OV0gID8gX19zY2hlZHVsZSsweDMy
Ni8weDg5MAo8ND4gWzMwOC41NTM4MDhdICBzY2hlZHVsZSsweDJiLzB4YjAKPDQ+IFszMDguNTUz
ODE1XSAgbWVpX2NsX3dyaXRlKzB4NDMwLzB4NWEwIFttZWldCjw0PiBbMzA4LjU1MzgyMF0gID8g
X19rbWFsbG9jKzB4MmI2LzB4MzMwCjw0PiBbMzA4LjU1MzgyNF0gID8gd2FpdF93b2tlbisweGEw
LzB4YTAKPDQ+IFszMDguNTUzODM1XSAgX19tZWlfY2xfc2VuZCsweDFmNC8weDI0MCBbbWVpXQo8
ND4gWzMwOC41NTM4NDhdICBtZWlfbWtoaV9maXgrMHg5MS8weDI4MCBbbWVpXQo8ND4gWzMwOC41
NTM4NTldICBtZWlfY2xfYnVzX2Rldl9maXh1cCsweGJhLzB4MTAwIFttZWldCjw0PiBbMzA4LjU1
Mzg2OF0gID8gZGV2aWNlX2FkZCsweDE1Ni8weDY3MAo8ND4gWzMwOC41NTM4ODldICA/IG1laV9j
bF9idXNfcmVzY2FuX3dvcmsrMHgxYmMvMHgzNTAgW21laV0KPDQ+IFszMDguNTUzODk2XSAgbWVp
X2NsX2J1c19yZXNjYW5fd29yaysweDFiYy8weDM1MCBbbWVpXQo8ND4gWzMwOC41NTM5MDVdICBw
cm9jZXNzX29uZV93b3JrKzB4MjQ1LzB4NWYwCjw0PiBbMzA4LjU1MzkxNV0gIHdvcmtlcl90aHJl
YWQrMHgzNy8weDM4MAo8ND4gWzMwOC41NTM5MjFdICA/IHByb2Nlc3Nfb25lX3dvcmsrMHg1ZjAv
MHg1ZjAKPDQ+IFszMDguNTUzOTI0XSAga3RocmVhZCsweDExOS8weDEzMAo8ND4gWzMwOC41NTM5
MjhdICA/IGt0aHJlYWRfcGFyaysweGEwLzB4YTAKPDQ+IFszMDguNTUzOTM0XSAgcmV0X2Zyb21f
Zm9yaysweDNhLzB4NTAKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMt
d2lsc29uLmNvLnVrPgpDYzogQWxleGFuZGVyIFVzeXNraW4gPGFsZXhhbmRlci51c3lza2luQGlu
dGVsLmNvbT4KQ2M6IFRvbWFzIFdpbmtsZXIgPHRvbWFzLndpbmtsZXJAaW50ZWwuY29tPgotLS0K
IGRyaXZlcnMvbWlzYy9tZWkvYnVzLmMgICAgfCAgOSArKysrKysrLS0KIGRyaXZlcnMvbWlzYy9t
ZWkvY2xpZW50LmMgfCAgNSArKystLQogZHJpdmVycy9taXNjL21laS9tYWluLmMgICB8IDE4ICsr
KysrKysrKysrKysrLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCAyNCBpbnNlcnRpb25zKCspLCA4IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvbWlzYy9tZWkvYnVzLmMgYi9kcml2ZXJz
L21pc2MvbWVpL2J1cy5jCmluZGV4IDk4NWJkNGZkMzMyOC4uNWIyZGI3N2Q0OGRiIDEwMDY0NAot
LS0gYS9kcml2ZXJzL21pc2MvbWVpL2J1cy5jCisrKyBiL2RyaXZlcnMvbWlzYy9tZWkvYnVzLmMK
QEAgLTY2LDkgKzY2LDEwIEBAIHNzaXplX3QgX19tZWlfY2xfc2VuZChzdHJ1Y3QgbWVpX2NsICpj
bCwgdTggKmJ1Ziwgc2l6ZV90IGxlbmd0aCwKIAogCXdoaWxlIChjbC0+dHhfY2JfcXVldWVkID49
IGJ1cy0+dHhfcXVldWVfbGltaXQpIHsKIAkJbXV0ZXhfdW5sb2NrKCZidXMtPmRldmljZV9sb2Nr
KTsKLQkJcmV0cyA9IHdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZShjbC0+dHhfd2FpdCwKKwkJcmV0
cyA9IHdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZV90aW1lb3V0KGNsLT50eF93YWl0LAogCQkJCWNs
LT53cml0aW5nX3N0YXRlID09IE1FSV9XUklURV9DT01QTEVURSB8fAotCQkJCSghbWVpX2NsX2lz
X2Nvbm5lY3RlZChjbCkpKTsKKwkJCQkhbWVpX2NsX2lzX2Nvbm5lY3RlZChjbCksCisJCQkJSFop
OwogCQltdXRleF9sb2NrKCZidXMtPmRldmljZV9sb2NrKTsKIAkJaWYgKHJldHMpIHsKIAkJCWlm
IChzaWduYWxfcGVuZGluZyhjdXJyZW50KSkKQEAgLTc5LDYgKzgwLDEwIEBAIHNzaXplX3QgX19t
ZWlfY2xfc2VuZChzdHJ1Y3QgbWVpX2NsICpjbCwgdTggKmJ1Ziwgc2l6ZV90IGxlbmd0aCwKIAkJ
CXJldHMgPSAtRU5PREVWOwogCQkJZ290byBvdXQ7CiAJCX0KKwkJaWYgKGNsLT53cml0aW5nX3N0
YXRlICE9IE1FSV9XUklURV9DT01QTEVURSkgeworCQkJcmV0cyA9IC1FRkFVTFQ7CisJCQlnb3Rv
IG91dDsKKwkJfQogCX0KIAogCWNiID0gbWVpX2NsX2FsbG9jX2NiKGNsLCBsZW5ndGgsIE1FSV9G
T1BfV1JJVEUsIE5VTEwpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9taXNjL21laS9jbGllbnQuYyBi
L2RyaXZlcnMvbWlzYy9tZWkvY2xpZW50LmMKaW5kZXggMWUzZWRiYmFjYjFlLi5lN2FjYzhhYTli
MTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvbWlzYy9tZWkvY2xpZW50LmMKKysrIGIvZHJpdmVycy9t
aXNjL21laS9jbGllbnQuYwpAQCAtMTc2Nyw5ICsxNzY3LDEwIEBAIHNzaXplX3QgbWVpX2NsX3dy
aXRlKHN0cnVjdCBtZWlfY2wgKmNsLCBzdHJ1Y3QgbWVpX2NsX2NiICpjYikKIAlpZiAoYmxvY2tp
bmcgJiYgY2wtPndyaXRpbmdfc3RhdGUgIT0gTUVJX1dSSVRFX0NPTVBMRVRFKSB7CiAKIAkJbXV0
ZXhfdW5sb2NrKCZkZXYtPmRldmljZV9sb2NrKTsKLQkJcmV0cyA9IHdhaXRfZXZlbnRfaW50ZXJy
dXB0aWJsZShjbC0+dHhfd2FpdCwKKwkJcmV0cyA9IHdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZV90
aW1lb3V0KGNsLT50eF93YWl0LAogCQkJCWNsLT53cml0aW5nX3N0YXRlID09IE1FSV9XUklURV9D
T01QTEVURSB8fAotCQkJCSghbWVpX2NsX2lzX2Nvbm5lY3RlZChjbCkpKTsKKwkJCQkhbWVpX2Ns
X2lzX2Nvbm5lY3RlZChjbCksCisJCQkJSFopOwogCQltdXRleF9sb2NrKCZkZXYtPmRldmljZV9s
b2NrKTsKIAkJLyogd2FpdF9ldmVudF9pbnRlcnJ1cHRpYmxlIHJldHVybnMgLUVSRVNUQVJUU1lT
ICovCiAJCWlmIChyZXRzKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL21pc2MvbWVpL21haW4uYyBi
L2RyaXZlcnMvbWlzYy9tZWkvbWFpbi5jCmluZGV4IGY4OTRkMWY4YTUzZS4uMGViN2JmZDg5YTkw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL21pc2MvbWVpL21haW4uYworKysgYi9kcml2ZXJzL21pc2Mv
bWVpL21haW4uYwpAQCAtMjk0LDkgKzI5NCwxMCBAQCBzdGF0aWMgc3NpemVfdCBtZWlfd3JpdGUo
c3RydWN0IGZpbGUgKmZpbGUsIGNvbnN0IGNoYXIgX191c2VyICp1YnVmLAogCQkJZ290byBvdXQ7
CiAJCX0KIAkJbXV0ZXhfdW5sb2NrKCZkZXYtPmRldmljZV9sb2NrKTsKLQkJcmV0cyA9IHdhaXRf
ZXZlbnRfaW50ZXJydXB0aWJsZShjbC0+dHhfd2FpdCwKKwkJcmV0cyA9IHdhaXRfZXZlbnRfaW50
ZXJydXB0aWJsZV90aW1lb3V0KGNsLT50eF93YWl0LAogCQkJCWNsLT53cml0aW5nX3N0YXRlID09
IE1FSV9XUklURV9DT01QTEVURSB8fAotCQkJCSghbWVpX2NsX2lzX2Nvbm5lY3RlZChjbCkpKTsK
KwkJCQkhbWVpX2NsX2lzX2Nvbm5lY3RlZChjbCksCisJCQkJSFopOwogCQltdXRleF9sb2NrKCZk
ZXYtPmRldmljZV9sb2NrKTsKIAkJaWYgKHJldHMpIHsKIAkJCWlmIChzaWduYWxfcGVuZGluZyhj
dXJyZW50KSkKQEAgLTMwNyw2ICszMDgsMTAgQEAgc3RhdGljIHNzaXplX3QgbWVpX3dyaXRlKHN0
cnVjdCBmaWxlICpmaWxlLCBjb25zdCBjaGFyIF9fdXNlciAqdWJ1ZiwKIAkJCXJldHMgPSAtRU5P
REVWOwogCQkJZ290byBvdXQ7CiAJCX0KKwkJaWYgKGNsLT53cml0aW5nX3N0YXRlICE9IE1FSV9X
UklURV9DT01QTEVURSkgeworCQkJcmV0cyA9IC1FRkFVTFQ7CisJCQlnb3RvIG91dDsKKwkJfQog
CX0KIAogCWNiID0gbWVpX2NsX2FsbG9jX2NiKGNsLCBsZW5ndGgsIE1FSV9GT1BfV1JJVEUsIGZp
bGUpOwpAQCAtNjU4LDkgKzY2MywxMCBAQCBzdGF0aWMgaW50IG1laV9mc3luYyhzdHJ1Y3QgZmls
ZSAqZnAsIGxvZmZfdCBzdGFydCwgbG9mZl90IGVuZCwgaW50IGRhdGFzeW5jKQogCiAJd2hpbGUg
KG1laV9jbF9pc193cml0ZV9xdWV1ZWQoY2wpKSB7CiAJCW11dGV4X3VubG9jaygmZGV2LT5kZXZp
Y2VfbG9jayk7Ci0JCXJldHMgPSB3YWl0X2V2ZW50X2ludGVycnVwdGlibGUoY2wtPnR4X3dhaXQs
CisJCXJldHMgPSB3YWl0X2V2ZW50X2ludGVycnVwdGlibGVfdGltZW91dChjbC0+dHhfd2FpdCwK
IAkJCQljbC0+d3JpdGluZ19zdGF0ZSA9PSBNRUlfV1JJVEVfQ09NUExFVEUgfHwKLQkJCQkhbWVp
X2NsX2lzX2Nvbm5lY3RlZChjbCkpOworCQkJCSFtZWlfY2xfaXNfY29ubmVjdGVkKGNsKSwKKwkJ
CQlIWik7CiAJCW11dGV4X2xvY2soJmRldi0+ZGV2aWNlX2xvY2spOwogCQlpZiAocmV0cykgewog
CQkJaWYgKHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKQpAQCAtNjcxLDYgKzY3NywxMCBAQCBzdGF0
aWMgaW50IG1laV9mc3luYyhzdHJ1Y3QgZmlsZSAqZnAsIGxvZmZfdCBzdGFydCwgbG9mZl90IGVu
ZCwgaW50IGRhdGFzeW5jKQogCQkJcmV0cyA9IC1FTk9ERVY7CiAJCQlnb3RvIG91dDsKIAkJfQor
CQlpZiAoY2wtPndyaXRpbmdfc3RhdGUgIT0gTUVJX1dSSVRFX0NPTVBMRVRFKSB7CisJCQlyZXRz
ID0gLUVGQVVMVDsKKwkJCWdvdG8gb3V0OworCQl9CiAJfQogCXJldHMgPSAwOwogb3V0OgotLSAK
Mi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

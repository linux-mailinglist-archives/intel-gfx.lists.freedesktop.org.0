Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 73CE5B0F12
	for <lists+intel-gfx@lfdr.de>; Thu, 12 Sep 2019 14:48:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D47F26ED29;
	Thu, 12 Sep 2019 12:48:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D46DD6ED28
 for <intel-gfx@lists.freedesktop.org>; Thu, 12 Sep 2019 12:48:16 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18464157-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 12 Sep 2019 13:48:14 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 12 Sep 2019 13:48:13 +0100
Message-Id: <20190912124813.19225-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/pmu: Use GT parked for estimating RC6
 while asleep
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2UgdHJhY2sgd2hlbiB3ZSBwdXQgdGhlIEdUIGRldmljZSB0byBzbGVlcCB1cG9uIGlkbGlu
Zywgd2UgY2FuIHVzZQp0aGF0IGNhbGxiYWNrIHRvIHNhbXBsZSB0aGUgY3VycmVudCByYzYgY291
bnRlcnMgYW5kIHJlY29yZCB0aGUKdGltZXN0YW1wIGZvciBlc3RpbWF0aW5nIHNhbXBsZXMgYWZ0
ZXIgdGhhdCBwb2ludCB3aGlsZSBhc2xlZXAuCgp2MjogU3RpY2sgdG8gdXNpbmcga3RpbWVfdAp2
MzogVHJhY2sgdXNlcl93YWtlcmVmcyB0aGF0IGludGVyZmVyZSB3aXRoIHRoZSBuZXcKaW50ZWxf
Z3RfcG1fd2FpdF9mb3JfaWRsZQp2NDogTm8gbmVlZCBmb3IgcGFya2VkL3VucGFya2VkIGVzdGlt
YXRpb24gaWYgIUNPTkZJR19QTQp2NTogS2VlcCB0aW1lciBwYXJrL3VucGFyayBsb2dpYyBhcyB3
YXMKdjY6IFJlZmFjdG9yIGR1cGxpY2F0ZWQgZXN0aW1hdGUvdXBkYXRlIHJjNiBsb2dpYwp2Nzog
UHVsbCBpbnRlbF9nZXRfcG1fZ2V0X2lmX2F3YWtlKCkgb3V0IGZyb20gdGhlIHBtdS0+bG9jay4K
CkJ1Z3ppbGxhOiBodHRwczovL2J1Z3MuZnJlZWRlc2t0b3Aub3JnL3Nob3dfYnVnLmNnaT9pZD0x
MDUwMTAKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28u
dWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgfCAgMjIgKysrCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oIHwgICAxICsKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgfCAgMjIgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BtdS5jICAgICAgICAgIHwgMjQyICsrKysrKysrKysrKystLS0tLS0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5oICAgICAgICAgIHwgICA0ICstCiA1IGZpbGVzIGNo
YW5nZWQsIDE3MCBpbnNlcnRpb25zKCspLCAxMjEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCAzYmQ3NjQxMDRkNDEuLmExMWFkNGQ5MTRjYSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTE0MSw2ICsxNDEsMjQg
QEAgYm9vbCBpOTE1X2dlbV9sb2FkX3Bvd2VyX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiAJcmV0dXJuIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKCZpOTE1LT5n
dCk7CiB9CiAKK3N0YXRpYyB2b2lkIHVzZXJfZm9yY2V3YWtlKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
IGJvb2wgc3VzcGVuZCkKK3sKKwlpbnQgY291bnQgPSBhdG9taWNfcmVhZCgmZ3QtPnVzZXJfd2Fr
ZXJlZik7CisKKwkvKiBJbnNpZGUgc3VzcGVuZC9yZXN1bWUgc28gc2luZ2xlIHRocmVhZGVkLCBu
byByYWNlcyB0byB3b3JyeSBhYm91dC4gKi8KKwlpZiAobGlrZWx5KCFjb3VudCkpCisJCXJldHVy
bjsKKworCWludGVsX2d0X3BtX2dldChndCk7CisJaWYgKHN1c3BlbmQpIHsKKwkJR0VNX0JVR19P
Tihjb3VudCA+IGF0b21pY19yZWFkKCZndC0+d2FrZXJlZi5jb3VudCkpOworCQlhdG9taWNfc3Vi
KGNvdW50LCAmZ3QtPndha2VyZWYuY291bnQpOworCX0gZWxzZSB7CisJCWF0b21pY19hZGQoY291
bnQsICZndC0+d2FrZXJlZi5jb3VudCk7CisJfQorCWludGVsX2d0X3BtX3B1dChndCk7Cit9CisK
IHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
IAlHRU1fVFJBQ0UoIlxuIik7CkBAIC0xNDgsNiArMTY2LDggQEAgdm9pZCBpOTE1X2dlbV9zdXNw
ZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWludGVsX3dha2VyZWZfYXV0bygm
aTkxNS0+Z2d0dC51c2VyZmF1bHRfd2FrZXJlZiwgMCk7CiAJZmx1c2hfd29ya3F1ZXVlKGk5MTUt
PndxKTsKIAorCXVzZXJfZm9yY2V3YWtlKCZpOTE1LT5ndCwgdHJ1ZSk7CisKIAltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCS8qCkBAIC0yNTksNiArMjc5LDggQEAgdm9p
ZCBpOTE1X2dlbV9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaWYgKCFp
OTE1X2dlbV9sb2FkX3Bvd2VyX2NvbnRleHQoaTkxNSkpCiAJCWdvdG8gZXJyX3dlZGdlZDsKIAor
CXVzZXJfZm9yY2V3YWtlKCZpOTE1LT5ndCwgZmFsc2UpOworCiBvdXRfdW5sb2NrOgogCWludGVs
X3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3RfdHlwZXMuaAppbmRleCBkYzI5NWMxOTZkMTEuLjMwMzljZWY2NGIxMSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCkBAIC01MCw2ICs1MCw3IEBA
IHN0cnVjdCBpbnRlbF9ndCB7CiAJfSB0aW1lbGluZXM7CiAKIAlzdHJ1Y3QgaW50ZWxfd2FrZXJl
ZiB3YWtlcmVmOworCWF0b21pY190IHVzZXJfd2FrZXJlZjsKIAogCXN0cnVjdCBsaXN0X2hlYWQg
Y2xvc2VkX3ZtYTsKIAlzcGlubG9ja190IGNsb3NlZF9sb2NrOyAvKiBndWFyZHMgdGhlIGxpc3Qg
b2YgY2xvc2VkX3ZtYSAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
ZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCBlNTgz
NTMzN2YwMjIuLmYzYWU1MjViNzdjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMK
QEAgLTM5OTUsMTMgKzM5OTUsMTIgQEAgc3RhdGljIGludCBpOTE1X3NzZXVfc3RhdHVzKHN0cnVj
dCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogc3RhdGljIGludCBpOTE1X2ZvcmNld2FrZV9v
cGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gaW5vZGUtPmlfcHJpdmF0ZTsKKwlzdHJ1Y3QgaW50ZWxf
Z3QgKmd0ID0gJmk5MTUtPmd0OwogCi0JaWYgKElOVEVMX0dFTihpOTE1KSA8IDYpCi0JCXJldHVy
biAwOwotCi0JZmlsZS0+cHJpdmF0ZV9kYXRhID0KLQkJKHZvaWQgKikodWludHB0cl90KWludGVs
X3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQlpbnRlbF91bmNvcmVfZm9yY2V3
YWtlX3VzZXJfZ2V0KCZpOTE1LT51bmNvcmUpOworCWF0b21pY19pbmMoJmd0LT51c2VyX3dha2Vy
ZWYpOworCWludGVsX2d0X3BtX2dldChndCk7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KQor
CQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3VzZXJfZ2V0KGd0LT51bmNvcmUpOwogCiAJcmV0dXJu
IDA7CiB9CkBAIC00MDA5LDEzICs0MDA4LDEyIEBAIHN0YXRpYyBpbnQgaTkxNV9mb3JjZXdha2Vf
b3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIHN0YXRpYyBpbnQg
aTkxNV9mb3JjZXdha2VfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAq
ZmlsZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGlub2RlLT5pX3ByaXZh
dGU7CisJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAotCWlmIChJTlRFTF9HRU4o
aTkxNSkgPCA2KQotCQlyZXR1cm4gMDsKLQotCWludGVsX3VuY29yZV9mb3JjZXdha2VfdXNlcl9w
dXQoJmk5MTUtPnVuY29yZSk7Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVf
cG0sCi0JCQkgICAgIChpbnRlbF93YWtlcmVmX3QpKHVpbnRwdHJfdClmaWxlLT5wcml2YXRlX2Rh
dGEpOworCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikKKwkJaW50ZWxfdW5jb3JlX2ZvcmNld2Fr
ZV91c2VyX3B1dCgmaTkxNS0+dW5jb3JlKTsKKwlpbnRlbF9ndF9wbV9wdXQoZ3QpOworCWF0b21p
Y19kZWMoJmd0LT51c2VyX3dha2VyZWYpOwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wbXUuYwppbmRleCA2MjNhZDMyMzAzYTEuLjMzMTAzNTM4OTBmYiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BtdS5jCkBAIC0xMTYsMjIgKzExNiwxMjQgQEAgc3RhdGljIGJvb2wgcG11X25lZWRzX3Rp
bWVyKHN0cnVjdCBpOTE1X3BtdSAqcG11LCBib29sIGdwdV9hY3RpdmUpCiAJcmV0dXJuIGVuYWJs
ZTsKIH0KIAotdm9pZCBpOTE1X3BtdV9ndF9wYXJrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCitzdGF0aWMgdTY0IF9fZ2V0X3JjNihjb25zdCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQog
ewotCXN0cnVjdCBpOTE1X3BtdSAqcG11ID0gJmk5MTUtPnBtdTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OworCXU2NCB2YWw7CiAKLQlpZiAoIXBtdS0+YmFzZS5l
dmVudF9pbml0KQotCQlyZXR1cm47CisJdmFsID0gaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhpOTE1
LAorCQkJCSAgICAgSVNfVkFMTEVZVklFVyhpOTE1KSA/CisJCQkJICAgICBWTFZfR1RfUkVOREVS
X1JDNiA6CisJCQkJICAgICBHRU42X0dUX0dGWF9SQzYpOworCisJaWYgKEhBU19SQzZwKGk5MTUp
KQorCQl2YWwgKz0gaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhpOTE1LCBHRU42X0dUX0dGWF9SQzZw
KTsKKworCWlmIChIQVNfUkM2cHAoaTkxNSkpCisJCXZhbCArPSBpbnRlbF9yYzZfcmVzaWRlbmN5
X25zKGk5MTUsIEdFTjZfR1RfR0ZYX1JDNnBwKTsKKworCXJldHVybiB2YWw7Cit9CisKKyNpZiBJ
U19FTkFCTEVEKENPTkZJR19QTSkKKworc3RhdGljIGlubGluZSBzNjQga3RpbWVfc2luY2UoY29u
c3Qga3RpbWVfdCBrdCkKK3sKKwlyZXR1cm4ga3RpbWVfdG9fbnMoa3RpbWVfc3ViKGt0aW1lX2dl
dCgpLCBrdCkpOworfQorCitzdGF0aWMgdTY0IF9fcG11X2VzdGltYXRlX3JjNihzdHJ1Y3QgaTkx
NV9wbXUgKnBtdSkKK3sKKwl1NjQgdmFsOwogCi0Jc3Bpbl9sb2NrX2lycSgmcG11LT5sb2NrKTsK
IAkvKgotCSAqIFNpZ25hbCBzYW1wbGluZyB0aW1lciB0byBzdG9wIGlmIG9ubHkgZW5naW5lIGV2
ZW50cyBhcmUgZW5hYmxlZCBhbmQKLQkgKiBHUFUgd2VudCBpZGxlLgorCSAqIFdlIHRoaW5rIHdl
IGFyZSBydW50aW1lIHN1c3BlbmRlZC4KKwkgKgorCSAqIFJlcG9ydCB0aGUgZGVsdGEgZnJvbSB3
aGVuIHRoZSBkZXZpY2Ugd2FzIHN1c3BlbmRlZCB0byBub3csCisJICogb24gdG9wIG9mIHRoZSBs
YXN0IGtub3duIHJlYWwgdmFsdWUsIGFzIHRoZSBhcHByb3hpbWF0ZWQgUkM2CisJICogY291bnRl
ciB2YWx1ZS4KIAkgKi8KLQlwbXUtPnRpbWVyX2VuYWJsZWQgPSBwbXVfbmVlZHNfdGltZXIocG11
LCBmYWxzZSk7Ci0Jc3Bpbl91bmxvY2tfaXJxKCZwbXUtPmxvY2spOworCXZhbCA9IGt0aW1lX3Np
bmNlKHBtdS0+c2xlZXBfbGFzdCk7CisJdmFsICs9IHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVf
UkM2XS5jdXI7CisKKwlwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1
ciA9IHZhbDsKKworCXJldHVybiB2YWw7Cit9CisKK3N0YXRpYyB1NjQgX19wbXVfdXBkYXRlX3Jj
NihzdHJ1Y3QgaTkxNV9wbXUgKnBtdSwgdTY0IHZhbCkKK3sKKwkvKgorCSAqIElmIHdlIGFyZSBj
b21pbmcgYmFjayBmcm9tIGJlaW5nIHJ1bnRpbWUgc3VzcGVuZGVkIHdlIG11c3QKKwkgKiBiZSBj
YXJlZnVsIG5vdCB0byByZXBvcnQgYSBsYXJnZXIgdmFsdWUgdGhhbiByZXR1cm5lZAorCSAqIHBy
ZXZpb3VzbHkuCisJICovCisJaWYgKHZhbCA+PSBwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JD
Nl9FU1RJTUFURURdLmN1cikgeworCQlwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJ
TUFURURdLmN1ciA9IDA7CisJCXBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2XS5jdXIgPSB2
YWw7CisJfSBlbHNlIHsKKwkJdmFsID0gcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZfRVNU
SU1BVEVEXS5jdXI7CisJfQorCisJcmV0dXJuIHZhbDsKK30KKworc3RhdGljIHU2NCBnZXRfcmM2
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBndC0+aTkxNTsKKwlzdHJ1Y3QgaTkxNV9wbXUgKnBtdSA9ICZpOTE1LT5wbXU7CisJdW5zaWdu
ZWQgbG9uZyBmbGFnczsKKwl1NjQgdmFsOworCisJdmFsID0gMDsKKwlpZiAoaW50ZWxfZ3RfcG1f
Z2V0X2lmX2F3YWtlKGd0KSkgeworCQl2YWwgPSBfX2dldF9yYzYoZ3QpOworCQlpbnRlbF9ndF9w
bV9wdXQoZ3QpOworCX0KKworCXNwaW5fbG9ja19pcnFzYXZlKCZwbXUtPmxvY2ssIGZsYWdzKTsK
KworCWlmICh2YWwpCisJCXZhbCA9IF9fcG11X3VwZGF0ZV9yYzYocG11LCB2YWwpOworCWVsc2UK
KwkJdmFsID0gX19wbXVfZXN0aW1hdGVfcmM2KHBtdSk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZwbXUtPmxvY2ssIGZsYWdzKTsKKworCXJldHVybiB2YWw7Cit9CisKK3N0YXRpYyB2b2lk
IHBhcmtfcmM2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0cnVjdCBpOTE1
X3BtdSAqcG11ID0gJmk5MTUtPnBtdTsKKworCWlmIChwbXUtPmVuYWJsZSAmIGNvbmZpZ19lbmFi
bGVkX21hc2soSTkxNV9QTVVfUkM2X1JFU0lERU5DWSkpCisJCV9fcG11X3VwZGF0ZV9yYzYocG11
LCBfX2dldF9yYzYoJmk5MTUtPmd0KSk7CisKKwlwbXUtPnNsZWVwX2xhc3QgPSBrdGltZV9nZXQo
KTsKK30KKworc3RhdGljIHZvaWQgdW5wYXJrX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKK3sKKwlzdHJ1Y3QgaTkxNV9wbXUgKnBtdSA9ICZpOTE1LT5wbXU7CisKKwkvKiBFc3Rp
bWF0ZSBob3cgbG9uZyB3ZSBzbGVwdCBhbmQgYWNjdW11bGF0ZSB0aGF0IGludG8gcmM2IGNvdW50
ZXJzICovCisJaWYgKHBtdS0+ZW5hYmxlICYgY29uZmlnX2VuYWJsZWRfbWFzayhJOTE1X1BNVV9S
QzZfUkVTSURFTkNZKSkKKwkJX19wbXVfZXN0aW1hdGVfcmM2KHBtdSk7Cit9CisKKyNlbHNlCisK
K3N0YXRpYyB1NjQgZ2V0X3JjNihzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXJldHVybiBfX2dl
dF9yYzYoZ3QpOwogfQogCitzdGF0aWMgdm9pZCBwYXJrX3JjNihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkge30KK3N0YXRpYyB2b2lkIHVucGFya19yYzYoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpIHt9CisKKyNlbmRpZgorCiBzdGF0aWMgdm9pZCBfX2k5MTVfcG11X21heWJl
X3N0YXJ0X3RpbWVyKHN0cnVjdCBpOTE1X3BtdSAqcG11KQogewogCWlmICghcG11LT50aW1lcl9l
bmFibGVkICYmIHBtdV9uZWVkc190aW1lcihwbXUsIHRydWUpKSB7CkBAIC0xNDMsNiArMjQ1LDI2
IEBAIHN0YXRpYyB2b2lkIF9faTkxNV9wbXVfbWF5YmVfc3RhcnRfdGltZXIoc3RydWN0IGk5MTVf
cG11ICpwbXUpCiAJfQogfQogCit2b2lkIGk5MTVfcG11X2d0X3BhcmtlZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdHJ1Y3QgaTkxNV9wbXUgKnBtdSA9ICZpOTE1LT5wbXU7
CisKKwlpZiAoIXBtdS0+YmFzZS5ldmVudF9pbml0KQorCQlyZXR1cm47CisKKwlzcGluX2xvY2tf
aXJxKCZwbXUtPmxvY2spOworCisJcGFya19yYzYoaTkxNSk7CisKKwkvKgorCSAqIFNpZ25hbCBz
YW1wbGluZyB0aW1lciB0byBzdG9wIGlmIG9ubHkgZW5naW5lIGV2ZW50cyBhcmUgZW5hYmxlZCBh
bmQKKwkgKiBHUFUgd2VudCBpZGxlLgorCSAqLworCXBtdS0+dGltZXJfZW5hYmxlZCA9IHBtdV9u
ZWVkc190aW1lcihwbXUsIGZhbHNlKTsKKworCXNwaW5fdW5sb2NrX2lycSgmcG11LT5sb2NrKTsK
K30KKwogdm9pZCBpOTE1X3BtdV9ndF91bnBhcmtlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV9wbXUgKnBtdSA9ICZpOTE1LT5wbXU7CkBAIC0xNTEsMTAg
KzI3MywxNCBAQCB2b2lkIGk5MTVfcG11X2d0X3VucGFya2VkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogCQlyZXR1cm47CiAKIAlzcGluX2xvY2tfaXJxKCZwbXUtPmxvY2spOworCiAJ
LyoKIAkgKiBSZS1lbmFibGUgc2FtcGxpbmcgdGltZXIgd2hlbiBHUFUgZ29lcyBhY3RpdmUuCiAJ
ICovCiAJX19pOTE1X3BtdV9tYXliZV9zdGFydF90aW1lcihwbXUpOworCisJdW5wYXJrX3JjNihp
OTE1KTsKKwogCXNwaW5fdW5sb2NrX2lycSgmcG11LT5sb2NrKTsKIH0KIApAQCAtNDMwLDEwNCAr
NTU2LDYgQEAgc3RhdGljIGludCBpOTE1X3BtdV9ldmVudF9pbml0KHN0cnVjdCBwZXJmX2V2ZW50
ICpldmVudCkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHU2NCBfX2dldF9yYzYoc3RydWN0IGlu
dGVsX2d0ICpndCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1
OwotCXU2NCB2YWw7Ci0KLQl2YWwgPSBpbnRlbF9yYzZfcmVzaWRlbmN5X25zKGk5MTUsCi0JCQkJ
ICAgICBJU19WQUxMRVlWSUVXKGk5MTUpID8KLQkJCQkgICAgIFZMVl9HVF9SRU5ERVJfUkM2IDoK
LQkJCQkgICAgIEdFTjZfR1RfR0ZYX1JDNik7Ci0KLQlpZiAoSEFTX1JDNnAoaTkxNSkpCi0JCXZh
bCArPSBpbnRlbF9yYzZfcmVzaWRlbmN5X25zKGk5MTUsIEdFTjZfR1RfR0ZYX1JDNnApOwotCi0J
aWYgKEhBU19SQzZwcChpOTE1KSkKLQkJdmFsICs9IGludGVsX3JjNl9yZXNpZGVuY3lfbnMoaTkx
NSwgR0VONl9HVF9HRlhfUkM2cHApOwotCi0JcmV0dXJuIHZhbDsKLX0KLQotc3RhdGljIHU2NCBn
ZXRfcmM2KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0jaWYgSVNfRU5BQkxFRChDT05GSUdfUE0p
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndC0+aTkxNTsKLQlzdHJ1Y3QgaW50
ZWxfcnVudGltZV9wbSAqcnBtID0gJmk5MTUtPnJ1bnRpbWVfcG07Ci0Jc3RydWN0IGk5MTVfcG11
ICpwbXUgPSAmaTkxNS0+cG11OwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7Ci0JdTY0IHZhbDsKLQotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dl
dF9pZl9pbl91c2UocnBtKTsKLQlpZiAod2FrZXJlZikgewotCQl2YWwgPSBfX2dldF9yYzYoZ3Qp
OwotCQlpbnRlbF9ydW50aW1lX3BtX3B1dChycG0sIHdha2VyZWYpOwotCi0JCS8qCi0JCSAqIElm
IHdlIGFyZSBjb21pbmcgYmFjayBmcm9tIGJlaW5nIHJ1bnRpbWUgc3VzcGVuZGVkIHdlIG11c3QK
LQkJICogYmUgY2FyZWZ1bCBub3QgdG8gcmVwb3J0IGEgbGFyZ2VyIHZhbHVlIHRoYW4gcmV0dXJu
ZWQKLQkJICogcHJldmlvdXNseS4KLQkJICovCi0KLQkJc3Bpbl9sb2NrX2lycXNhdmUoJnBtdS0+
bG9jaywgZmxhZ3MpOwotCi0JCWlmICh2YWwgPj0gcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9S
QzZfRVNUSU1BVEVEXS5jdXIpIHsKLQkJCXBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VT
VElNQVRFRF0uY3VyID0gMDsKLQkJCXBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2XS5jdXIg
PSB2YWw7Ci0JCX0gZWxzZSB7Ci0JCQl2YWwgPSBwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JD
Nl9FU1RJTUFURURdLmN1cjsKLQkJfQotCi0JCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBtdS0+
bG9jaywgZmxhZ3MpOwotCX0gZWxzZSB7Ci0JCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSBycG0tPmtk
ZXY7Ci0KLQkJLyoKLQkJICogV2UgYXJlIHJ1bnRpbWUgc3VzcGVuZGVkLgotCQkgKgotCQkgKiBS
ZXBvcnQgdGhlIGRlbHRhIGZyb20gd2hlbiB0aGUgZGV2aWNlIHdhcyBzdXNwZW5kZWQgdG8gbm93
LAotCQkgKiBvbiB0b3Agb2YgdGhlIGxhc3Qga25vd24gcmVhbCB2YWx1ZSwgYXMgdGhlIGFwcHJv
eGltYXRlZCBSQzYKLQkJICogY291bnRlciB2YWx1ZS4KLQkJICovCi0JCXNwaW5fbG9ja19pcnFz
YXZlKCZwbXUtPmxvY2ssIGZsYWdzKTsKLQotCQkvKgotCQkgKiBBZnRlciB0aGUgYWJvdmUgYnJh
bmNoIGludGVsX3J1bnRpbWVfcG1fZ2V0X2lmX2luX3VzZSBmYWlsZWQKLQkJICogdG8gZ2V0IHRo
ZSBydW50aW1lIFBNIHJlZmVyZW5jZSB3ZSBjYW5ub3QgYXNzdW1lIHdlIGFyZSBpbgotCQkgKiBy
dW50aW1lIHN1c3BlbmQgc2luY2Ugd2UgY2FuIGVpdGhlcjogYSkgcmFjZSB3aXRoIGNvbWluZyBv
dXQKLQkJICogb2YgaXQgYmVmb3JlIHdlIHRvb2sgdGhlIHBvd2VyLmxvY2ssIG9yIGIpIHRoZXJl
IGFyZSBvdGhlcgotCQkgKiBzdGF0ZXMgdGhhbiBzdXNwZW5kZWQgd2hpY2ggY2FuIGJyaW5nIHVz
IGhlcmUuCi0JCSAqCi0JCSAqIFdlIG5lZWQgdG8gZG91YmxlLWNoZWNrIHRoYXQgd2UgYXJlIGlu
ZGVlZCBjdXJyZW50bHkgcnVudGltZQotCQkgKiBzdXNwZW5kZWQgYW5kIGlmIG5vdCB3ZSBjYW5u
b3QgZG8gYmV0dGVyIHRoYW4gcmVwb3J0IHRoZSBsYXN0Ci0JCSAqIGtub3duIFJDNiB2YWx1ZS4K
LQkJICovCi0JCWlmIChwbV9ydW50aW1lX3N0YXR1c19zdXNwZW5kZWQoa2RldikpIHsKLQkJCXZh
bCA9IHBtX3J1bnRpbWVfc3VzcGVuZGVkX3RpbWUoa2Rldik7Ci0KLQkJCWlmICghcG11LT5zYW1w
bGVbX19JOTE1X1NBTVBMRV9SQzZfRVNUSU1BVEVEXS5jdXIpCi0JCQkJcG11LT5zdXNwZW5kZWRf
dGltZV9sYXN0ID0gdmFsOwotCi0JCQl2YWwgLT0gcG11LT5zdXNwZW5kZWRfdGltZV9sYXN0Owot
CQkJdmFsICs9IHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2XS5jdXI7Ci0KLQkJCXBtdS0+
c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyID0gdmFsOwotCQl9IGVsc2Ug
aWYgKHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyKSB7Ci0JCQl2
YWwgPSBwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1cjsKLQkJfSBl
bHNlIHsKLQkJCXZhbCA9IHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2XS5jdXI7Ci0JCX0K
LQotCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwbXUtPmxvY2ssIGZsYWdzKTsKLQl9Ci0KLQly
ZXR1cm4gdmFsOwotI2Vsc2UKLQlyZXR1cm4gX19nZXRfcmM2KGd0KTsKLSNlbmRpZgotfQotCiBz
dGF0aWMgdTY0IF9faTkxNV9wbXVfZXZlbnRfcmVhZChzdHJ1Y3QgcGVyZl9ldmVudCAqZXZlbnQp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11
LmgKaW5kZXggNGZjNGYyNDc4MzAxLi4wNjdkYmJmM2JkZmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcG11LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
bXUuaApAQCAtOTcsOSArOTcsOSBAQCBzdHJ1Y3QgaTkxNV9wbXUgewogCSAqLwogCXN0cnVjdCBp
OTE1X3BtdV9zYW1wbGUgc2FtcGxlW19fSTkxNV9OVU1fUE1VX1NBTVBMRVJTXTsKIAkvKioKLQkg
KiBAc3VzcGVuZGVkX3RpbWVfbGFzdDogQ2FjaGVkIHN1c3BlbmQgdGltZSBmcm9tIFBNIGNvcmUu
CisJICogQHNsZWVwX2xhc3Q6IExhc3QgdGltZSBHVCBwYXJrZWQgZm9yIFJDNiBlc3RpbWF0aW9u
LgogCSAqLwotCXU2NCBzdXNwZW5kZWRfdGltZV9sYXN0OworCWt0aW1lX3Qgc2xlZXBfbGFzdDsK
IAkvKioKIAkgKiBAaTkxNV9hdHRyOiBNZW1vcnkgYmxvY2sgaG9sZGluZyBkZXZpY2UgYXR0cmli
dXRlcy4KIAkgKi8KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BA9D6D6219
	for <lists+intel-gfx@lfdr.de>; Mon, 14 Oct 2019 14:11:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D412E6E1B3;
	Mon, 14 Oct 2019 12:11:53 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2DE2F6E1B3
 for <intel-gfx@lists.freedesktop.org>; Mon, 14 Oct 2019 12:11:52 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Oct 2019 05:11:51 -0700
X-IronPort-AV: E=Sophos;i="5.67,295,1566889200"; d="scan'208";a="185476057"
Received: from dwiesing-mobl.ger.corp.intel.com (HELO [10.252.31.172])
 ([10.252.31.172])
 by orsmga007-auth.jf.intel.com with ESMTP/TLS/AES256-SHA;
 14 Oct 2019 05:11:50 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20191014090757.32111-1-chris@chris-wilson.co.uk>
 <20191014090757.32111-12-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <8947bb82-2d5e-05b6-634c-4669476876d2@linux.intel.com>
Date: Mon, 14 Oct 2019 13:11:46 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20191014090757.32111-12-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH 12/15] drm/i915/gem: Cancel non-persistent
 contexts on close
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDE0LzEwLzIwMTkgMTA6MDcsIENocmlzIFdpbHNvbiB3cm90ZToKPiBOb3JtYWxseSwgd2Ug
cmVseSBvbiBvdXIgaGFuZ2NoZWNrIHRvIHByZXZlbnQgcGVyc2lzdGVudCBiYXRjaGVzIGZyb20K
PiBob2dnaW5nIHRoZSBHUFUuIEhvd2V2ZXIsIGlmIHRoZSB1c2VyIGRpc2FibGVzIGhhbmdjaGVj
aywgdGhpcyBtZWNoYW5pc20KPiBicmVha3MgZG93bi4gRGVzcGl0ZSBvdXIgaW5zaXN0ZW5jZSB0
aGF0IHRoaXMgaXMgdW5zYWZlLCB0aGUgdXNlcnMgYXJlCj4gZXF1YWxseSBpbnNpc3RlbnQgdGhh
dCB0aGV5IHdhbnQgdG8gdXNlIGVuZGxlc3MgYmF0Y2hlcyBhbmQgd2lsbCBkaXNhYmxlCj4gdGhl
IGhhbmdjaGVjayBtZWNoYW5pc20uIFdlIGFyZSBsb29raW5nIGF0IHBlcmhhcHMgcmVwbGFjaW5n
IGhhbmdjaGVjawo+IHdpdGggYSBzb2Z0ZXIgbWVjaGFuaXNtLCB0aGF0IHNlbmRzIGEgcHVsc2Ug
ZG93biB0aGUgZW5naW5lIHRvIGNoZWNrIGlmCj4gaXQgaXMgd2VsbC4gV2UgY2FuIHVzZSB0aGUg
c2FtZSBwcmVlbXB0aXZlIHB1bHNlIHRvIGZsdXNoIGFuIGFjdGl2ZQo+IHBlcnNpc3RlbnQgY29u
dGV4dCBvZmYgdGhlIEdQVSB1cG9uIGNvbnRleHQgY2xvc2UsIHByZXZlbnRpbmcgcmVzb3VyY2Vz
Cj4gYmVpbmcgbG9zdCBhbmQgdW5raWxsYWJsZSByZXF1ZXN0cyByZW1haW5pbmcgb24gdGhlIEdQ
VSBhZnRlciBwcm9jZXNzCj4gdGVybWluYXRpb24uIFRvIGF2b2lkIGNoYW5naW5nIHRoZSBBQkkg
YW5kIGFjY2lkZW50YWxseSBicmVha2luZwo+IGV4aXN0aW5nIHVzZXJzcGFjZSwgd2UgbWFrZSB0
aGUgcGVyc2lzdGVuY2Ugb2YgYSBjb250ZXh0IGV4cGxpY2l0IGFuZAo+IGVuYWJsZSBpdCBieSBk
ZWZhdWx0IChtYXRjaGluZyBjdXJyZW50IEFCSSkuIFVzZXJzcGFjZSBjYW4gb3B0IG91dCBvZgo+
IHBlcnNpc3RlbnQgbW9kZSAoZm9yY2luZyByZXF1ZXN0cyB0byBiZSBjYW5jZWxsZWQgd2hlbiB0
aGUgY29udGV4dCBpcwo+IGNsb3NlZCBieSBwcm9jZXNzIHRlcm1pbmF0aW9uIG9yIGV4cGxpY2l0
bHkpIGJ5IGEgY29udGV4dCBwYXJhbWV0ZXIuIFRvCj4gZmFjaWxpdGF0ZSBleGlzdGluZyB1c2Ut
Y2FzZXMgb2YgZGlzYWJsaW5nIGhhbmdjaGVjaywgaWYgdGhlIG1vZHBhcmFtIGlzCj4gZGlzYWJs
ZWQgKGk5MTUuZW5hYmxlX2hhbmdjaGVjaz0wKSwgd2UgZGlzYWJsZSBwZXJzaXN0ZW5jZSBtb2Rl
IGJ5Cj4gZGVmYXVsdC4gIChOb3RlLCBvbmUgb2YgdGhlIG91dGNvbWVzIGZvciBzdXBwb3J0aW5n
IGVuZGxlc3MgbW9kZSB3aWxsIGJlCj4gdGhlIHJlbW92YWwgb2YgaGFuZ2NoZWNraW5nLCBhdCB3
aGljaCBwb2ludCBvcHRpbmcgaW50byBwZXJzaXN0ZW50IG1vZGUKPiB3aWxsIGJlIG1hbmRhdG9y
eSwgb3IgbWF5YmUgdGhlIGRlZmF1bHQgcGVyaGFwcyBjb250cm9sbGVkIGJ5IGNncm91cHMuKQo+
IAo+IHYyOiBDaGVjayBmb3IgaGFuZ2NoZWNraW5nIGF0IGNvbnRleHQgdGVybWluYXRpb24sIHNv
IHRoYXQgd2UgYXJlIG5vdAo+IGxlZnQgd2l0aCB1bmR5aW5nIGNvbnRleHRzIGZyb20gYSBjcmFm
dHkgdXNlci4KPiB2MzogRm9yY2UgY29udGV4dCB0ZXJtaW5hdGlvbiBldmVuIGlmIGZvcmNlZC1w
cmVlbXB0aW9uIGlzIGRpc2FibGVkLgo+IAo+IFRlc3RjYXNlOiBpZ3QvZ2VtX2N0eF9wZXJzaXN0
ZW5jZQo+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgo+IENjOiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5j
b20+Cj4gQ2M6IE1pY2hhxYIgV2luaWFyc2tpIDxtaWNoYWwud2luaWFyc2tpQGludGVsLmNvbT4K
PiBDYzogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVsLmNvbT4KPiBSZXZpZXdl
ZC1ieTogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVsLmNvbT4KPiAtLS0KPiAg
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8IDE4MiArKysr
KysrKysrKysrKysrKysKPiAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0LmggICB8ICAxNSArKwo+ICAgLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dF90eXBlcy5oIHwgICAxICsKPiAgIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2Nr
X2NvbnRleHQuYyB8ICAgMiArCj4gICBpbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggICAgICAg
ICAgICAgICAgICAgfCAgMTUgKysKPiAgIDUgZmlsZXMgY2hhbmdlZCwgMjE1IGluc2VydGlvbnMo
KykKPiAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKPiBp
bmRleCA1ZDgyMjFjN2JhODMuLjcwYjcyNDU2ZTJjNCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwo+IEBAIC03MCw2ICs3MCw3IEBACj4gICAjaW5j
bHVkZSA8ZHJtL2k5MTVfZHJtLmg+Cj4gICAKPiAgICNpbmNsdWRlICJndC9pbnRlbF9scmNfcmVn
LmgiCj4gKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgiCj4gICAjaW5jbHVk
ZSAiZ3QvaW50ZWxfZW5naW5lX3VzZXIuaCIKPiAgIAo+ICAgI2luY2x1ZGUgImk5MTVfZ2VtX2Nv
bnRleHQuaCIKPiBAQCAtMjY5LDYgKzI3MCwxMjggQEAgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3Jl
bGVhc2Uoc3RydWN0IGtyZWYgKnJlZikKPiAgIAkJc2NoZWR1bGVfd29yaygmZ2MtPmZyZWVfd29y
ayk7Cj4gICB9Cj4gICAKPiArc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAq
Cj4gK19fY29udGV4dF9lbmdpbmVzX3N0YXRpYyhjb25zdCBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4KQo+ICt7Cj4gKwlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPmVu
Z2luZXMsIHRydWUpOwo+ICt9Cj4gKwo+ICtzdGF0aWMgYm9vbCBfX3Jlc2V0X2VuZ2luZShzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gK3sKPiArCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBlbmdpbmUtPmd0Owo+ICsJYm9vbCBzdWNjZXNzID0gZmFsc2U7Cj4gKwo+ICsJaWYgKCFpbnRl
bF9oYXNfcmVzZXRfZW5naW5lKGd0KSkKPiArCQlyZXR1cm4gZmFsc2U7Cj4gKwo+ICsJaWYgKCF0
ZXN0X2FuZF9zZXRfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgZW5naW5lLT5pZCwKPiArCQkJICAg
ICAgJmd0LT5yZXNldC5mbGFncykpIHsKPiArCQlzdWNjZXNzID0gaW50ZWxfZW5naW5lX3Jlc2V0
KGVuZ2luZSwgTlVMTCkgPT0gMDsKPiArCQljbGVhcl9hbmRfd2FrZV91cF9iaXQoSTkxNV9SRVNF
VF9FTkdJTkUgKyBlbmdpbmUtPmlkLAo+ICsJCQkJICAgICAgJmd0LT5yZXNldC5mbGFncyk7Cj4g
Kwl9Cj4gKwo+ICsJcmV0dXJuIHN1Y2Nlc3M7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIF9fcmVz
ZXRfY29udGV4dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAo+ICsJCQkgICAgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ICt7Cj4gKwlpbnRlbF9ndF9oYW5kbGVfZXJyb3Io
ZW5naW5lLT5ndCwgZW5naW5lLT5tYXNrLCAwLAo+ICsJCQkgICAgICAiY29udGV4dCBjbG9zdXJl
IGluICVzIiwgY3R4LT5uYW1lKTsKPiArfQo+ICsKPiArc3RhdGljIGJvb2wgX19jYW5jZWxfZW5n
aW5lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKPiArewo+ICsJLyoKPiArCSAqIFNl
bmQgYSAiaGlnaCBwcmlvcml0eSBwdWxzZSIgZG93biB0aGUgZW5naW5lIHRvIGNhdXNlIHRoZQo+
ICsJICogY3VycmVudCByZXF1ZXN0IHRvIGJlIG1vbWVudGFyaWx5IHByZWVtcHRlZC4gKElmIGl0
IGZhaWxzIHRvCj4gKwkgKiBiZSBwcmVlbXB0ZWQsIGl0IHdpbGwgYmUgcmVzZXQpLiBBcyB3ZSBo
YXZlIG1hcmtlZCBvdXIgY29udGV4dAo+ICsJICogYXMgYmFubmVkLCBhbnkgaW5jb21wbGV0ZSBy
ZXF1ZXN0LCBpbmNsdWRpbmcgYW55IHJ1bm5pbmcsIHdpbGwKPiArCSAqIGJlIHNraXBwZWQgZm9s
bG93aW5nIHRoZSBwcmVlbXB0aW9uLgo+ICsJICovCj4gKwlpZiAoQ09ORklHX0RSTV9JOTE1X1BS
RUVNUFRfVElNRU9VVCAmJiAhaW50ZWxfZW5naW5lX3B1bHNlKGVuZ2luZSkpCj4gKwkJcmV0dXJu
IHRydWU7CgpNYXliZSBJIGxvc3QgdGhlIHRyYWluIG9mIHRob3VnaHQgaGVyZS4uIEJ1dCB3aHkg
bm90IGV2ZW4gdHJ5IHdpdGggdGhlIApwdWxzZSBldmVuIGlmIGZvcmNlZCBwcmVlbXB0aW9uIGlz
IG5vdCBjb21waWxlZCBpbj8gVGhlcmUgaXMgYSBjaGFuY2UgaXQgCm1heSBwcmVlbXB0IG5vcm1h
bGx5LCBubz8KCkhtLCBvciBmcm9tIHRoZSBvdGhlciBhbmdsZSwgd2h5IGJvdGhlciB3aXRoIHBy
ZWVtcHRpb24gYW5kIG5vdCBqdXN0IApyZXNldD8gV2hhdCBpcyB0aGUgdmFsdWUgaW4gbGV0dGlu
ZyB0aGUgY2xvc2VkIGNvbnRleHQgY29tcGxldGUgaWYgYXQgCnRoZSBzYW1lIHRpbWUsIGlmIGl0
IGlzIHByZWVtcHRhYmxlLCB3ZSB3aWxsIGNhbmNlbCBhbGwgb3V0c3RhbmRpbmcgd29yayAKYW55
d2F5PwoKPiArCj4gKwkvKiBJZiB3ZSBhcmUgdW5hYmxlIHRvIHNlbmQgYSBwdWxzZSwgdHJ5IHJl
c3NldGluZyB0aGlzIGVuZ2luZS4gKi8KClR5cG8gaW4gcmVzZXR0aW5nLgoKUmVnYXJkcywKClR2
cnRrbwoKPiArCXJldHVybiBfX3Jlc2V0X2VuZ2luZShlbmdpbmUpOwo+ICt9Cj4gKwo+ICtzdGF0
aWMgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqCj4gK2FjdGl2ZV9lbmdpbmUoc3RydWN0IGRtYV9m
ZW5jZSAqZmVuY2UsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKPiArewo+ICsJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEgPSB0b19yZXF1ZXN0KGZlbmNlKTsKPiArCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSwgKmxvY2tlZDsKPiArCj4gKwkvKgo+ICsJICogU2VyaWFsaXNlIHdpdGgg
X19pOTE1X3JlcXVlc3Rfc3VibWl0KCkgc28gdGhhdCBpdCBzZWVzCj4gKwkgKiBpcy1iYW5uZWQ/
LCBvciB3ZSBrbm93IHRoZSByZXF1ZXN0IGlzIGFscmVhZHkgaW5mbGlnaHQuCj4gKwkgKi8KPiAr
CWxvY2tlZCA9IFJFQURfT05DRShycS0+ZW5naW5lKTsKPiArCXNwaW5fbG9ja19pcnEoJmxvY2tl
ZC0+YWN0aXZlLmxvY2spOwo+ICsJd2hpbGUgKHVubGlrZWx5KGxvY2tlZCAhPSAoZW5naW5lID0g
UkVBRF9PTkNFKHJxLT5lbmdpbmUpKSkpIHsKPiArCQlzcGluX3VubG9jaygmbG9ja2VkLT5hY3Rp
dmUubG9jayk7Cj4gKwkJc3Bpbl9sb2NrKCZlbmdpbmUtPmFjdGl2ZS5sb2NrKTsKPiArCQlsb2Nr
ZWQgPSBlbmdpbmU7Cj4gKwl9Cj4gKwo+ICsJZW5naW5lID0gTlVMTDsKPiArCWlmIChpOTE1X3Jl
cXVlc3RfaXNfYWN0aXZlKHJxKSAmJiAhcnEtPmZlbmNlLmVycm9yKQo+ICsJCWVuZ2luZSA9IHJx
LT5lbmdpbmU7Cj4gKwo+ICsJc3Bpbl91bmxvY2tfaXJxKCZsb2NrZWQtPmFjdGl2ZS5sb2NrKTsK
PiArCj4gKwlyZXR1cm4gZW5naW5lOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCBraWxsX2NvbnRl
eHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKPiArewo+ICsJc3RydWN0IGk5MTVfZ2Vt
X2VuZ2luZXNfaXRlciBpdDsKPiArCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKPiArCj4gKwkv
Kgo+ICsJICogSWYgd2UgYXJlIGFscmVhZHkgYmFubmVkLCBpdCB3YXMgZHVlIHRvIGEgZ3VpbHR5
IHJlcXVlc3QgY2F1c2luZwo+ICsJICogYSByZXNldCBhbmQgdGhlIGVudGlyZSBjb250ZXh0IGJl
aW5nIGV2aWN0ZWQgZnJvbSB0aGUgR1BVLgo+ICsJICovCj4gKwlpZiAoaTkxNV9nZW1fY29udGV4
dF9pc19iYW5uZWQoY3R4KSkKPiArCQlyZXR1cm47Cj4gKwo+ICsJaTkxNV9nZW1fY29udGV4dF9z
ZXRfYmFubmVkKGN0eCk7Cj4gKwo+ICsJLyoKPiArCSAqIE1hcCB0aGUgdXNlcidzIGVuZ2luZSBi
YWNrIHRvIHRoZSBhY3R1YWwgZW5naW5lczsgb25lIHZpcnR1YWwKPiArCSAqIGVuZ2luZSB3aWxs
IGJlIG1hcHBlZCB0byBtdWx0aXBsZSBlbmdpbmVzLCBhbmQgdXNpbmcgY3R4LT5lbmdpbmVbXQo+
ICsJICogdGhlIHNhbWUgZW5naW5lIG1heSBiZSBoYXZlIG11bHRpcGxlIGluc3RhbmNlcyBpbiB0
aGUgdXNlcidzIG1hcC4KPiArCSAqIEhvd2V2ZXIsIHdlIG9ubHkgY2FyZSBhYm91dCBwZW5kaW5n
IHJlcXVlc3RzLCBzbyBvbmx5IGluY2x1ZGUKPiArCSAqIGVuZ2luZXMgb24gd2hpY2ggdGhlcmUg
YXJlIGluY29tcGxldGUgcmVxdWVzdHMuCj4gKwkgKi8KPiArCWZvcl9lYWNoX2dlbV9lbmdpbmUo
Y2UsIF9fY29udGV4dF9lbmdpbmVzX3N0YXRpYyhjdHgpLCBpdCkgewo+ICsJCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKPiArCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKPiArCj4g
KwkJaWYgKCFjZS0+dGltZWxpbmUpCj4gKwkJCWNvbnRpbnVlOwo+ICsKPiArCQlmZW5jZSA9IGk5
MTVfYWN0aXZlX2ZlbmNlX2dldCgmY2UtPnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QpOwo+ICsJCWlm
ICghZmVuY2UpCj4gKwkJCWNvbnRpbnVlOwo+ICsKPiArCQkvKiBDaGVjayB3aXRoIHRoZSBiYWNr
ZW5kIGlmIHRoZSByZXF1ZXN0IGlzIHN0aWxsIGluZmxpZ2h0ICovCj4gKwkJZW5naW5lID0gYWN0
aXZlX2VuZ2luZShmZW5jZSwgY2UpOwo+ICsKPiArCQkvKiBGaXJzdCBhdHRlbXB0IHRvIGdyYWNl
ZnVsbHkgY2FuY2VsIHRoZSBjb250ZXh0ICovCj4gKwkJaWYgKGVuZ2luZSAmJiAhX19jYW5jZWxf
ZW5naW5lKGVuZ2luZSkpCj4gKwkJCS8qCj4gKwkJCSAqIElmIHdlIGFyZSB1bmFibGUgdG8gc2Vu
ZCBhIHByZWVtcHRpdmUgcHVsc2UgdG8gYnVtcAo+ICsJCQkgKiB0aGUgY29udGV4dCBmcm9tIHRo
ZSBHUFUsIHdlIGhhdmUgdG8gcmVzb3J0IHRvIGEgZnVsbAo+ICsJCQkgKiByZXNldC4gV2UgaG9w
ZSB0aGUgY29sbGF0ZXJhbCBkYW1hZ2UgaXMgd29ydGggaXQuCj4gKwkJCSAqLwo+ICsJCQlfX3Jl
c2V0X2NvbnRleHQoY3R4LCBlbmdpbmUpOwo+ICsKPiArCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsK
PiArCX0KPiArfQo+ICsKPiAgIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKPiAgIHsKPiAgIAlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bTsKPiBAQCAtMjkxLDkgKzQxNCw0NyBAQCBzdGF0aWMgdm9pZCBjb250ZXh0X2Nsb3NlKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCj4gICAJbHV0X2Nsb3NlKGN0eCk7Cj4gICAKPiAgIAlt
dXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwo+ICsKPiArCS8qCj4gKwkgKiBJZiB0aGUgdXNlciBo
YXMgZGlzYWJsZWQgaGFuZ2NoZWNraW5nLCB3ZSBjYW4gbm90IGJlIHN1cmUgdGhhdAo+ICsJICog
dGhlIGJhdGNoZXMgd2lsbCBldmVyIGNvbXBsZXRlIGFmdGVyIHRoZSBjb250ZXh0IGlzIGNsb3Nl
ZCwKPiArCSAqIGtlZXBpbmcgdGhlIGNvbnRleHQgYW5kIGFsbCByZXNvdXJjZXMgcGlubmVkIGZv
cmV2ZXIuIFNvIGluIHRoaXMKPiArCSAqIGNhc2Ugd2Ugb3B0IHRvIGZvcmNpYmx5IGtpbGwgb2Zm
IGFsbCByZW1haW5pbmcgcmVxdWVzdHMgb24KPiArCSAqIGNvbnRleHQgY2xvc2UuCj4gKwkgKi8K
PiArCWlmICghaTkxNV9nZW1fY29udGV4dF9pc19wZXJzaXN0ZW50KGN0eCkgfHwKPiArCSAgICAh
aTkxNV9tb2RwYXJhbXMuZW5hYmxlX2hhbmdjaGVjaykKPiArCQlraWxsX2NvbnRleHQoY3R4KTsK
PiArCj4gICAJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKPiAgIH0KPiAgIAo+ICtzdGF0aWMg
aW50IF9fY29udGV4dF9zZXRfcGVyc2lzdGVuY2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eCwgYm9vbCBzdGF0ZSkKPiArewo+ICsJaWYgKGk5MTVfZ2VtX2NvbnRleHRfaXNfcGVyc2lzdGVu
dChjdHgpID09IHN0YXRlKQo+ICsJCXJldHVybiAwOwo+ICsKPiArCWlmIChzdGF0ZSkgewo+ICsJ
CS8qCj4gKwkJICogT25seSBjb250ZXh0cyB0aGF0IGFyZSBzaG9ydC1saXZlZCBbdGhhdCB3aWxs
IGV4cGlyZSBvciBiZQo+ICsJCSAqIHJlc2V0XSBhcmUgYWxsb3dlZCB0byBzdXJ2aXZlIHBhc3Qg
dGVybWluYXRpb24uIFdlIHJlcXVpcmUKPiArCQkgKiBoYW5nY2hlY2sgdG8gZW5zdXJlIHRoYXQg
dGhlIHBlcnNpc3RlbnQgcmVxdWVzdHMgYXJlIGhlYWx0aHkuCj4gKwkJICovCj4gKwkJaWYgKCFp
OTE1X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrKQo+ICsJCQlyZXR1cm4gLUVJTlZBTDsKPiAr
Cj4gKwkJaTkxNV9nZW1fY29udGV4dF9zZXRfcGVyc2lzdGVuY2UoY3R4KTsKPiArCX0gZWxzZSB7
Cj4gKwkJLyogVG8gY2FuY2VsIGEgY29udGV4dCB3ZSB1c2UgInByZWVtcHQtdG8taWRsZSIgKi8K
PiArCQlpZiAoIShjdHgtPmk5MTUtPmNhcHMuc2NoZWR1bGVyICYgSTkxNV9TQ0hFRFVMRVJfQ0FQ
X1BSRUVNUFRJT04pKQo+ICsJCQlyZXR1cm4gLUVOT0RFVjsKPiArCj4gKwkJaTkxNV9nZW1fY29u
dGV4dF9jbGVhcl9wZXJzaXN0ZW5jZShjdHgpOwo+ICsJfQo+ICsKPiArCXJldHVybiAwOwo+ICt9
Cj4gKwo+ICAgc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoKPiAgIF9fY3JlYXRlX2Nv
bnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCj4gICB7Cj4gQEAgLTMyOCw2ICs0
ODksNyBAQCBfX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQo+
ICAgCj4gICAJaTkxNV9nZW1fY29udGV4dF9zZXRfYmFubmFibGUoY3R4KTsKPiAgIAlpOTE1X2dl
bV9jb250ZXh0X3NldF9yZWNvdmVyYWJsZShjdHgpOwo+ICsJX19jb250ZXh0X3NldF9wZXJzaXN0
ZW5jZShjdHgsIHRydWUgLyogY2dyb3VwIGhvb2s/ICovKTsKPiAgIAo+ICAgCWZvciAoaSA9IDA7
IGkgPCBBUlJBWV9TSVpFKGN0eC0+aGFuZ190aW1lc3RhbXApOyBpKyspCj4gICAJCWN0eC0+aGFu
Z190aW1lc3RhbXBbaV0gPSBqaWZmaWVzIC0gQ09OVEVYVF9GQVNUX0hBTkdfSklGRklFUzsKPiBA
QCAtNDg0LDYgKzY0Niw3IEBAIGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHByaW8pCj4gICAJCXJldHVybiBjdHg7Cj4gICAK
PiAgIAlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7Cj4gKwlpOTE1X2dlbV9j
b250ZXh0X3NldF9wZXJzaXN0ZW5jZShjdHgpOwo+ICAgCWN0eC0+c2NoZWQucHJpb3JpdHkgPSBJ
OTE1X1VTRVJfUFJJT1JJVFkocHJpbyk7Cj4gICAKPiAgIAlHRU1fQlVHX09OKCFpOTE1X2dlbV9j
b250ZXh0X2lzX2tlcm5lbChjdHgpKTsKPiBAQCAtMTU5NCw2ICsxNzU3LDE2IEBAIGdldF9lbmdp
bmVzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCj4gICAJcmV0dXJuIGVycjsKPiAgIH0K
PiAgIAo+ICtzdGF0aWMgaW50Cj4gK3NldF9wZXJzaXN0ZW5jZShzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4LAo+ICsJCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSAq
YXJncykKPiArewo+ICsJaWYgKGFyZ3MtPnNpemUpCj4gKwkJcmV0dXJuIC1FSU5WQUw7Cj4gKwo+
ICsJcmV0dXJuIF9fY29udGV4dF9zZXRfcGVyc2lzdGVuY2UoY3R4LCBhcmdzLT52YWx1ZSk7Cj4g
K30KPiArCj4gICBzdGF0aWMgaW50IGN0eF9zZXRwYXJhbShzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9w
cml2YXRlICpmcHJpdiwKPiAgIAkJCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCj4gICAJ
CQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gKmFyZ3MpCj4gQEAgLTE2NzEsNiAr
MTg0NCwxMCBAQCBzdGF0aWMgaW50IGN0eF9zZXRwYXJhbShzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9w
cml2YXRlICpmcHJpdiwKPiAgIAkJcmV0ID0gc2V0X2VuZ2luZXMoY3R4LCBhcmdzKTsKPiAgIAkJ
YnJlYWs7Cj4gICAKPiArCWNhc2UgSTkxNV9DT05URVhUX1BBUkFNX1BFUlNJU1RFTkNFOgo+ICsJ
CXJldCA9IHNldF9wZXJzaXN0ZW5jZShjdHgsIGFyZ3MpOwo+ICsJCWJyZWFrOwo+ICsKPiAgIAlj
YXNlIEk5MTVfQ09OVEVYVF9QQVJBTV9CQU5fUEVSSU9EOgo+ICAgCWRlZmF1bHQ6Cj4gICAJCXJl
dCA9IC1FSU5WQUw7Cj4gQEAgLTIxMjMsNiArMjMwMCwxMSBAQCBpbnQgaTkxNV9nZW1fY29udGV4
dF9nZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAo+ICAg
CQlyZXQgPSBnZXRfZW5naW5lcyhjdHgsIGFyZ3MpOwo+ICAgCQlicmVhazsKPiAgIAo+ICsJY2Fz
ZSBJOTE1X0NPTlRFWFRfUEFSQU1fUEVSU0lTVEVOQ0U6Cj4gKwkJYXJncy0+c2l6ZSA9IDA7Cj4g
KwkJYXJncy0+dmFsdWUgPSBpOTE1X2dlbV9jb250ZXh0X2lzX3BlcnNpc3RlbnQoY3R4KTsKPiAr
CQlicmVhazsKPiArCj4gICAJY2FzZSBJOTE1X0NPTlRFWFRfUEFSQU1fQkFOX1BFUklPRDoKPiAg
IAlkZWZhdWx0Ogo+ICAgCQlyZXQgPSAtRUlOVkFMOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHQuaAo+IGluZGV4IDkyMzQ1ODY4MzBkMS4uMmVlYzAzNTM4MmEy
IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCj4g
QEAgLTc2LDYgKzc2LDIxIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2Ns
ZWFyX3JlY292ZXJhYmxlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjCj4gICAJY2xlYXJfYml0
KFVDT05URVhUX1JFQ09WRVJBQkxFLCAmY3R4LT51c2VyX2ZsYWdzKTsKPiAgIH0KPiAgIAo+ICtz
dGF0aWMgaW5saW5lIGJvb2wgaTkxNV9nZW1fY29udGV4dF9pc19wZXJzaXN0ZW50KGNvbnN0IHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCj4gK3sKPiArCXJldHVybiB0ZXN0X2JpdChVQ09O
VEVYVF9QRVJTSVNURU5DRSwgJmN0eC0+dXNlcl9mbGFncyk7Cj4gK30KPiArCj4gK3N0YXRpYyBp
bmxpbmUgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4KQo+ICt7Cj4gKwlzZXRfYml0KFVDT05URVhUX1BFUlNJU1RFTkNFLCAm
Y3R4LT51c2VyX2ZsYWdzKTsKPiArfQo+ICsKPiArc3RhdGljIGlubGluZSB2b2lkIGk5MTVfZ2Vt
X2NvbnRleHRfY2xlYXJfcGVyc2lzdGVuY2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkK
PiArewo+ICsJY2xlYXJfYml0KFVDT05URVhUX1BFUlNJU1RFTkNFLCAmY3R4LT51c2VyX2ZsYWdz
KTsKPiArfQo+ICsKPiAgIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2Jh
bm5lZChjb25zdCBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQo+ICAgewo+ICAgCXJldHVy
biB0ZXN0X2JpdChDT05URVhUX0JBTk5FRCwgJmN0eC0+ZmxhZ3MpOwo+IGRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaAo+IGluZGV4IGFiOGUx
MzY3ZGZjOC4uYTNlY2QxOWYyMzAzIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCj4gQEAgLTEzNyw2ICsxMzcsNyBAQCBzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCB7Cj4gICAjZGVmaW5lIFVDT05URVhUX05PX0VSUk9SX0NBUFRV
UkUJMQo+ICAgI2RlZmluZSBVQ09OVEVYVF9CQU5OQUJMRQkJMgo+ICAgI2RlZmluZSBVQ09OVEVY
VF9SRUNPVkVSQUJMRQkJMwo+ICsjZGVmaW5lIFVDT05URVhUX1BFUlNJU1RFTkNFCQk0Cj4gICAK
PiAgIAkvKioKPiAgIAkgKiBAZmxhZ3M6IHNtYWxsIHNldCBvZiBib29sZWFucwo+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYwo+IGluZGV4
IDc0ZGRkNjgyYzljZC4uMjliODk4NGYwZTQ3IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMKPiArKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCj4gQEAgLTIyLDYgKzIyLDggQEAg
bW9ja19jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAo+ICAgCUlOSVRfTElT
VF9IRUFEKCZjdHgtPmxpbmspOwo+ICAgCWN0eC0+aTkxNSA9IGk5MTU7Cj4gICAKPiArCWk5MTVf
Z2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlKGN0eCk7Cj4gKwo+ICAgCW11dGV4X2luaXQoJmN0
eC0+ZW5naW5lc19tdXRleCk7Cj4gICAJZSA9IGRlZmF1bHRfZW5naW5lcyhjdHgpOwo+ICAgCWlm
IChJU19FUlIoZSkpCj4gZGlmZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCBi
L2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAo+IGluZGV4IDMwYzU0MjE0NDAxNi4uZWI5ZTcw
NGQ3MTdhIDEwMDY0NAo+IC0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAo+ICsrKyBi
L2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAo+IEBAIC0xNTY1LDYgKzE1NjUsMjEgQEAgc3Ry
dWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFtIHsKPiAgICAqICAgaTkxNV9jb250ZXh0X2Vu
Z2luZXNfYm9uZCAoSTkxNV9DT05URVhUX0VOR0lORVNfRVhUX0JPTkQpCj4gICAgKi8KPiAgICNk
ZWZpbmUgSTkxNV9DT05URVhUX1BBUkFNX0VOR0lORVMJMHhhCj4gKwo+ICsvKgo+ICsgKiBJOTE1
X0NPTlRFWFRfUEFSQU1fUEVSU0lTVEVOQ0U6Cj4gKyAqCj4gKyAqIEFsbG93IHRoZSBjb250ZXh0
IGFuZCBhY3RpdmUgcmVuZGVyaW5nIHRvIHN1cnZpdmUgdGhlIHByb2Nlc3MgdW50aWwKPiArICog
Y29tcGxldGlvbi4gUGVyc2lzdGVuY2UgYWxsb3dzIGZpcmUtYW5kLWZvcmdldCBjbGllbnRzIHRv
IHF1ZXVlIHVwIGEKPiArICogYnVuY2ggb2Ygd29yaywgaGFuZCB0aGUgb3V0cHV0IG92ZXIgdG8g
YSBkaXNwbGF5IHNlcnZlciBhbmQgdGhlIHF1aXQuCj4gKyAqIElmIHRoZSBjb250ZXh0IGlzIG5v
dCBtYXJrZWQgYXMgcGVyc2lzdGVudCwgdXBvbiBjbG9zaW5nIChlaXRoZXIgdmlhCj4gKyAqIGFu
IGV4cGxpY2l0IERSTV9JOTE1X0dFTV9DT05URVhUX0RFU1RST1kgb3IgaW1wbGljaXRseSBmcm9t
IGZpbGUgY2xvc3VyZQo+ICsgKiBvciBwcm9jZXNzIHRlcm1pbmF0aW9uKSwgdGhlIGNvbnRleHQg
YW5kIGFueSBvdXRzdGFuZGluZyByZXF1ZXN0cyB3aWxsIGJlCj4gKyAqIGNhbmNlbGxlZCAoYW5k
IGV4cG9ydGVkIGZlbmNlcyBmb3IgY2FuY2VsbGVkIHJlcXVlc3RzIG1hcmtlZCBhcyAtRUlPKS4K
PiArICoKPiArICogQnkgZGVmYXVsdCwgbmV3IGNvbnRleHRzIGFsbG93IHBlcnNpc3RlbmNlLgo+
ICsgKi8KPiArI2RlZmluZSBJOTE1X0NPTlRFWFRfUEFSQU1fUEVSU0lTVEVOQ0UJMHhiCj4gICAv
KiBNdXN0IGJlIGtlcHQgY29tcGFjdCAtLSBubyBob2xlcyBhbmQgd2VsbCBkb2N1bWVudGVkICov
Cj4gICAKPiAgIAlfX3U2NCB2YWx1ZTsKPiAKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

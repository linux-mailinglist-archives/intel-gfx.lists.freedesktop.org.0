Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 23896151D0A
	for <lists+intel-gfx@lfdr.de>; Tue,  4 Feb 2020 16:18:24 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 06E096E864;
	Tue,  4 Feb 2020 15:18:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 382C26E861
 for <intel-gfx@lists.freedesktop.org>; Tue,  4 Feb 2020 15:18:19 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 04 Feb 2020 07:18:17 -0800
X-IronPort-AV: E=Sophos;i="5.70,402,1574150400"; d="scan'208";a="235194468"
Received: from jnikula-mobl3.fi.intel.com (HELO localhost) ([10.237.66.161])
 by orsmga006-auth.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 04 Feb 2020 07:18:14 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  4 Feb 2020 17:18:10 +0200
Message-Id: <20200204151810.8189-1-jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Organization: Intel Finland Oy - BIC 0357606-4 - Westendinkatu 7, 02160 Espoo
Subject: [Intel-gfx] [PATCH] drm/i915: split out display debugfs to a
 separate file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGk5MTVfZGVidWdmcy5jIGhhcyBncm93biBtb3JlIHRoYW4gYSBsaXR0bGUgdW53aWVsZHku
IFNwbGl0IG91dCB0aGUKZGlzcGxheSByZWxhdGVkIGRlYnVnZnMgY29kZSB0byBhIGZpbGUgb2Yg
aXRzIG93biB1bmRlciBkaXNwbGF5LywKaW5pdGlhbGl6ZWQgd2l0aCBhIHNlcGFyYXRlIGNhbGwu
IE5vIGZ1bmN0aW9uYWwgY2hhbmdlcy4KClNpZ25lZC1vZmYtYnk6IEphbmkgTmlrdWxhIDxqYW5p
Lm5pa3VsYUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAg
ICAgICAgICAgICAgIHwgICAgMSArCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
X2RlYnVnZnMuYyAgfCAxOTIxICsrKysrKysrKysrKysrKysKIC4uLi9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5oICB8ICAgMjAgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcC5jICAgICAgIHwgICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9oZG1pLmMgICAgIHwgICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgMjAzMiArLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmggICAgICAgICAgIHwgICAgMiAtCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAgfCAgICAyICsKIDggZmlsZXMg
Y2hhbmdlZCwgMjAyOCBpbnNlcnRpb25zKCspLCAxOTU2IGRlbGV0aW9ucygtKQogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1
Z2ZzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfZGVidWdmcy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
TWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCA3ODdmZmU2Njk4
MTAuLmVkOTFmNmJlMTljNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZp
bGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTY5LDYgKzY5LDcgQEAg
aTkxNS0kKENPTkZJR19DT01QQVQpICAgKz0gaTkxNV9pb2MzMi5vCiBpOTE1LSQoQ09ORklHX0RF
QlVHX0ZTKSArPSBcCiAJaTkxNV9kZWJ1Z2ZzLm8gXAogCWk5MTVfZGVidWdmc19wYXJhbXMubyBc
CisJZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMubyBcCiAJZGlzcGxheS9pbnRlbF9waXBl
X2NyYy5vCiBpOTE1LSQoQ09ORklHX1BFUkZfRVZFTlRTKSArPSBpOTE1X3BtdS5vCiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2Zz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5j
Cm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uOWUyNTJiNTA4NDc5Ci0t
LSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X2RlYnVnZnMuYwpAQCAtMCwwICsxLDE5MjEgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICov
CisKKyNpbmNsdWRlIDxkcm0vZHJtX2RlYnVnZnMuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX2ZvdXJj
Yy5oPgorCisjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmgiCisjaW5jbHVkZSAiaW50
ZWxfZGlzcGxheV90eXBlcy5oIgorI2luY2x1ZGUgImludGVsX2RwLmgiCisjaW5jbHVkZSAiaW50
ZWxfZmJjLmgiCisjaW5jbHVkZSAiaW50ZWxfaGRjcC5oIgorI2luY2x1ZGUgImludGVsX2hkbWku
aCIKKyNpbmNsdWRlICJpbnRlbF9wbS5oIgorI2luY2x1ZGUgImludGVsX3Bzci5oIgorI2luY2x1
ZGUgImludGVsX3NpZGViYW5kLmgiCisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKm5vZGVfdG9faTkxNShzdHJ1Y3QgZHJtX2luZm9fbm9kZSAqbm9kZSkKK3sKKwlyZXR1
cm4gdG9faTkxNShub2RlLT5taW5vci0+ZGV2KTsKK30KKworc3RhdGljIGludCBpOTE1X2ZiY19z
dGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCit7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVj
dCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJpdi0+ZmJjOworCWludGVsX3dha2VyZWZfdCB3YWtl
cmVmOworCisJaWYgKCFIQVNfRkJDKGRldl9wcml2KSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKKwlt
dXRleF9sb2NrKCZmYmMtPmxvY2spOworCisJaWYgKGludGVsX2ZiY19pc19hY3RpdmUoZGV2X3By
aXYpKQorCQlzZXFfcHV0cyhtLCAiRkJDIGVuYWJsZWRcbiIpOworCWVsc2UKKwkJc2VxX3ByaW50
ZihtLCAiRkJDIGRpc2FibGVkOiAlc1xuIiwgZmJjLT5ub19mYmNfcmVhc29uKTsKKworCWlmIChp
bnRlbF9mYmNfaXNfYWN0aXZlKGRldl9wcml2KSkgeworCQl1MzIgbWFzazsKKworCQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA4KQorCQkJbWFzayA9IEk5MTVfUkVBRChJVkJfRkJDX1NUQVRV
UzIpICYgQkRXX0ZCQ19DT01QX1NFR19NQVNLOworCQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDcpCisJCQltYXNrID0gSTkxNV9SRUFEKElWQl9GQkNfU1RBVFVTMikgJiBJVkJfRkJD
X0NPTVBfU0VHX01BU0s7CisJCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNSkKKwkJ
CW1hc2sgPSBJOTE1X1JFQUQoSUxLX0RQRkNfU1RBVFVTKSAmIElMS19EUEZDX0NPTVBfU0VHX01B
U0s7CisJCWVsc2UgaWYgKElTX0c0WChkZXZfcHJpdikpCisJCQltYXNrID0gSTkxNV9SRUFEKERQ
RkNfU1RBVFVTKSAmIERQRkNfQ09NUF9TRUdfTUFTSzsKKwkJZWxzZQorCQkJbWFzayA9IEk5MTVf
UkVBRChGQkNfU1RBVFVTKSAmIChGQkNfU1RBVF9DT01QUkVTU0lORyB8CisJCQkJCQkJRkJDX1NU
QVRfQ09NUFJFU1NFRCk7CisKKwkJc2VxX3ByaW50ZihtLCAiQ29tcHJlc3Npbmc6ICVzXG4iLCB5
ZXNubyhtYXNrKSk7CisJfQorCisJbXV0ZXhfdW5sb2NrKCZmYmMtPmxvY2spOworCWludGVsX3J1
bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7CisKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIGludCBpOTE1X2ZiY19mYWxzZV9jb2xvcl9nZXQodm9pZCAqZGF0YSwg
dTY0ICp2YWwpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsK
KworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNyB8fCAhSEFTX0ZCQyhkZXZfcHJpdikpCisJ
CXJldHVybiAtRU5PREVWOworCisJKnZhbCA9IGRldl9wcml2LT5mYmMuZmFsc2VfY29sb3I7CisK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBpOTE1X2ZiY19mYWxzZV9jb2xvcl9zZXQodm9p
ZCAqZGF0YSwgdTY0IHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkYXRhOworCXUzMiByZWc7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDcgfHwgIUhB
U19GQkMoZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCW11dGV4X2xvY2soJmRldl9w
cml2LT5mYmMubG9jayk7CisKKwlyZWcgPSBJOTE1X1JFQUQoSUxLX0RQRkNfQ09OVFJPTCk7CisJ
ZGV2X3ByaXYtPmZiYy5mYWxzZV9jb2xvciA9IHZhbDsKKworCUk5MTVfV1JJVEUoSUxLX0RQRkNf
Q09OVFJPTCwgdmFsID8KKwkJICAgKHJlZyB8IEZCQ19DVExfRkFMU0VfQ09MT1IpIDoKKwkJICAg
KHJlZyAmIH5GQkNfQ1RMX0ZBTFNFX0NPTE9SKSk7CisKKwltdXRleF91bmxvY2soJmRldl9wcml2
LT5mYmMubG9jayk7CisJcmV0dXJuIDA7Cit9CisKK0RFRklORV9TSU1QTEVfQVRUUklCVVRFKGk5
MTVfZmJjX2ZhbHNlX2NvbG9yX2ZvcHMsCisJCQlpOTE1X2ZiY19mYWxzZV9jb2xvcl9nZXQsIGk5
MTVfZmJjX2ZhbHNlX2NvbG9yX3NldCwKKwkJCSIlbGx1XG4iKTsKKworc3RhdGljIGludCBpOTE1
X2lwc19zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCit7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwor
CWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworCisJaWYgKCFIQVNfSVBTKGRldl9wcml2KSkKKwkJ
cmV0dXJuIC1FTk9ERVY7CisKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRldl9w
cml2LT5ydW50aW1lX3BtKTsKKworCXNlcV9wcmludGYobSwgIkVuYWJsZWQgYnkga2VybmVsIHBh
cmFtZXRlcjogJXNcbiIsCisJCSAgIHllc25vKGk5MTVfbW9kcGFyYW1zLmVuYWJsZV9pcHMpKTsK
KworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpIHsKKwkJc2VxX3B1dHMobSwgIkN1cnJl
bnRseTogdW5rbm93blxuIik7CisJfSBlbHNlIHsKKwkJaWYgKEk5MTVfUkVBRChJUFNfQ1RMKSAm
IElQU19FTkFCTEUpCisJCQlzZXFfcHV0cyhtLCAiQ3VycmVudGx5OiBlbmFibGVkXG4iKTsKKwkJ
ZWxzZQorCQkJc2VxX3B1dHMobSwgIkN1cnJlbnRseTogZGlzYWJsZWRcbiIpOworCX0KKworCWlu
dGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIGludCBpOTE1X3NyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sIHZvaWQgKnVudXNlZCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisJ
Ym9vbCBzcl9lbmFibGVkID0gZmFsc2U7CisKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dl
cl9nZXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9JTklUKTsKKworCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDkpCisJCS8qIG5vIGdsb2JhbCBTUiBzdGF0dXM7IGluc3BlY3QgcGVyLXBsYW5l
IFdNICovOworCWVsc2UgaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKQorCQlzcl9lbmFibGVk
ID0gSTkxNV9SRUFEKFdNMV9MUF9JTEspICYgV00xX0xQX1NSX0VOOworCWVsc2UgaWYgKElTX0k5
NjVHTShkZXZfcHJpdikgfHwgSVNfRzRYKGRldl9wcml2KSB8fAorCQkgSVNfSTk0NUcoZGV2X3By
aXYpIHx8IElTX0k5NDVHTShkZXZfcHJpdikpCisJCXNyX2VuYWJsZWQgPSBJOTE1X1JFQUQoRldf
QkxDX1NFTEYpICYgRldfQkxDX1NFTEZfRU47CisJZWxzZSBpZiAoSVNfSTkxNUdNKGRldl9wcml2
KSkKKwkJc3JfZW5hYmxlZCA9IEk5MTVfUkVBRChJTlNUUE0pICYgSU5TVFBNX1NFTEZfRU47CisJ
ZWxzZSBpZiAoSVNfUElORVZJRVcoZGV2X3ByaXYpKQorCQlzcl9lbmFibGVkID0gSTkxNV9SRUFE
KERTUEZXMykgJiBQSU5FVklFV19TRUxGX1JFRlJFU0hfRU47CisJZWxzZSBpZiAoSVNfVkFMTEVZ
VklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJCXNyX2VuYWJsZWQg
PSBJOTE1X1JFQUQoRldfQkxDX1NFTEZfVkxWKSAmIEZXX0NTUFdSRFdORU47CisKKwlpbnRlbF9k
aXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX0lOSVQsIHdha2VyZWYpOwor
CisJc2VxX3ByaW50ZihtLCAic2VsZi1yZWZyZXNoOiAlc1xuIiwgZW5hYmxlZGRpc2FibGVkKHNy
X2VuYWJsZWQpKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGk5MTVfb3ByZWdpb24o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCit7CisJc3RydWN0IGludGVsX29wcmVn
aW9uICpvcHJlZ2lvbiA9ICZub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSktPm9wcmVnaW9uOworCisJ
aWYgKG9wcmVnaW9uLT5oZWFkZXIpCisJCXNlcV93cml0ZShtLCBvcHJlZ2lvbi0+aGVhZGVyLCBP
UFJFR0lPTl9TSVpFKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGk5MTVfdmJ0KHN0
cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQoreworCXN0cnVjdCBpbnRlbF9vcHJlZ2lv
biAqb3ByZWdpb24gPSAmbm9kZV90b19pOTE1KG0tPnByaXZhdGUpLT5vcHJlZ2lvbjsKKworCWlm
IChvcHJlZ2lvbi0+dmJ0KQorCQlzZXFfd3JpdGUobSwgb3ByZWdpb24tPnZidCwgb3ByZWdpb24t
PnZidF9zaXplKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGk5MTVfcHNyX3Npbmtf
c3RhdHVzX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQoreworCXU4IHZhbDsK
KwlzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IHNpbmtfc3RhdHVzW10gPSB7CisJCSJpbmFjdGl2
ZSIsCisJCSJ0cmFuc2l0aW9uIHRvIGFjdGl2ZSwgY2FwdHVyZSBhbmQgZGlzcGxheSIsCisJCSJh
Y3RpdmUsIGRpc3BsYXkgZnJvbSBSRkIiLAorCQkiYWN0aXZlLCBjYXB0dXJlIGFuZCBkaXNwbGF5
IG9uIHNpbmsgZGV2aWNlIHRpbWluZ3MiLAorCQkidHJhbnNpdGlvbiB0byBpbmFjdGl2ZSwgY2Fw
dHVyZSBhbmQgZGlzcGxheSwgdGltaW5nIHJlLXN5bmMiLAorCQkicmVzZXJ2ZWQiLAorCQkicmVz
ZXJ2ZWQiLAorCQkic2luayBpbnRlcm5hbCBlcnJvciIsCisJfTsKKwlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwID0KKwkJaW50ZWxfYXR0YWNoZWRfZHAodG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3Rv
cikpOworCWludCByZXQ7CisKKwlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKSB7CisJCXNlcV9wdXRz
KG0sICJQU1IgVW5zdXBwb3J0ZWRcbiIpOworCQlyZXR1cm4gLUVOT0RFVjsKKwl9CisKKwlpZiAo
Y29ubmVjdG9yLT5zdGF0dXMgIT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpCisJCXJldHVy
biAtRU5PREVWOworCisJcmV0ID0gZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsIERQ
X1BTUl9TVEFUVVMsICZ2YWwpOworCisJaWYgKHJldCA9PSAxKSB7CisJCWNvbnN0IGNoYXIgKnN0
ciA9ICJ1bmtub3duIjsKKworCQl2YWwgJj0gRFBfUFNSX1NJTktfU1RBVEVfTUFTSzsKKwkJaWYg
KHZhbCA8IEFSUkFZX1NJWkUoc2lua19zdGF0dXMpKQorCQkJc3RyID0gc2lua19zdGF0dXNbdmFs
XTsKKwkJc2VxX3ByaW50ZihtLCAiU2luayBQU1Igc3RhdHVzOiAweCV4IFslc11cbiIsIHZhbCwg
c3RyKTsKKwl9IGVsc2UgeworCQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQorREVG
SU5FX1NIT1dfQVRUUklCVVRFKGk5MTVfcHNyX3Npbmtfc3RhdHVzKTsKKworc3RhdGljIHZvaWQK
K3Bzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgc3Ry
dWN0IHNlcV9maWxlICptKQoreworCXUzMiB2YWwsIHN0YXR1c192YWw7CisJY29uc3QgY2hhciAq
c3RhdHVzID0gInVua25vd24iOworCisJaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSB7
CisJCXN0YXRpYyBjb25zdCBjaGFyICogY29uc3QgbGl2ZV9zdGF0dXNbXSA9IHsKKwkJCSJJRExF
IiwKKwkJCSJDQVBUVVJFIiwKKwkJCSJDQVBUVVJFX0ZTIiwKKwkJCSJTTEVFUCIsCisJCQkiQlVG
T05fRlciLAorCQkJIk1MX1VQIiwKKwkJCSJTVV9TVEFOREJZIiwKKwkJCSJGQVNUX1NMRUVQIiwK
KwkJCSJERUVQX1NMRUVQIiwKKwkJCSJCVUZfT04iLAorCQkJIlRHX09OIgorCQl9OworCQl2YWwg
PSBJOTE1X1JFQUQoRURQX1BTUjJfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOwor
CQlzdGF0dXNfdmFsID0gKHZhbCAmIEVEUF9QU1IyX1NUQVRVU19TVEFURV9NQVNLKSA+PgorCQkJ
ICAgICAgRURQX1BTUjJfU1RBVFVTX1NUQVRFX1NISUZUOworCQlpZiAoc3RhdHVzX3ZhbCA8IEFS
UkFZX1NJWkUobGl2ZV9zdGF0dXMpKQorCQkJc3RhdHVzID0gbGl2ZV9zdGF0dXNbc3RhdHVzX3Zh
bF07CisJfSBlbHNlIHsKKwkJc3RhdGljIGNvbnN0IGNoYXIgKiBjb25zdCBsaXZlX3N0YXR1c1td
ID0geworCQkJIklETEUiLAorCQkJIlNSRE9OQUNLIiwKKwkJCSJTUkRFTlQiLAorCQkJIkJVRk9G
RiIsCisJCQkiQlVGT04iLAorCQkJIkFVWEFDSyIsCisJCQkiU1JET0ZGQUNLIiwKKwkJCSJTUkRF
TlRfT04iLAorCQl9OworCQl2YWwgPSBJOTE1X1JFQUQoRURQX1BTUl9TVEFUVVMoZGV2X3ByaXYt
PnBzci50cmFuc2NvZGVyKSk7CisJCXN0YXR1c192YWwgPSAodmFsICYgRURQX1BTUl9TVEFUVVNf
U1RBVEVfTUFTSykgPj4KKwkJCSAgICAgIEVEUF9QU1JfU1RBVFVTX1NUQVRFX1NISUZUOworCQlp
ZiAoc3RhdHVzX3ZhbCA8IEFSUkFZX1NJWkUobGl2ZV9zdGF0dXMpKQorCQkJc3RhdHVzID0gbGl2
ZV9zdGF0dXNbc3RhdHVzX3ZhbF07CisJfQorCisJc2VxX3ByaW50ZihtLCAiU291cmNlIFBTUiBz
dGF0dXM6ICVzIFsweCUwOHhdXG4iLCBzdGF0dXMsIHZhbCk7Cit9CisKK3N0YXRpYyBpbnQgaTkx
NV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUp
OworCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJaW50ZWxfd2FrZXJl
Zl90IHdha2VyZWY7CisJY29uc3QgY2hhciAqc3RhdHVzOworCWJvb2wgZW5hYmxlZDsKKwl1MzIg
dmFsOworCisJaWYgKCFIQVNfUFNSKGRldl9wcml2KSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlz
ZXFfcHJpbnRmKG0sICJTaW5rIHN1cHBvcnQ6ICVzIiwgeWVzbm8ocHNyLT5zaW5rX3N1cHBvcnQp
KTsKKwlpZiAocHNyLT5kcCkKKwkJc2VxX3ByaW50ZihtLCAiIFsweCUwMnhdIiwgcHNyLT5kcC0+
cHNyX2RwY2RbMF0pOworCXNlcV9wdXRzKG0sICJcbiIpOworCisJaWYgKCFwc3ItPnNpbmtfc3Vw
cG9ydCkKKwkJcmV0dXJuIDA7CisKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRl
dl9wcml2LT5ydW50aW1lX3BtKTsKKwltdXRleF9sb2NrKCZwc3ItPmxvY2spOworCisJaWYgKHBz
ci0+ZW5hYmxlZCkKKwkJc3RhdHVzID0gcHNyLT5wc3IyX2VuYWJsZWQgPyAiUFNSMiBlbmFibGVk
IiA6ICJQU1IxIGVuYWJsZWQiOworCWVsc2UKKwkJc3RhdHVzID0gImRpc2FibGVkIjsKKwlzZXFf
cHJpbnRmKG0sICJQU1IgbW9kZTogJXNcbiIsIHN0YXR1cyk7CisKKwlpZiAoIXBzci0+ZW5hYmxl
ZCkgeworCQlzZXFfcHJpbnRmKG0sICJQU1Igc2luayBub3QgcmVsaWFibGU6ICVzXG4iLAorCQkJ
ICAgeWVzbm8ocHNyLT5zaW5rX25vdF9yZWxpYWJsZSkpOworCisJCWdvdG8gdW5sb2NrOworCX0K
KworCWlmIChwc3ItPnBzcjJfZW5hYmxlZCkgeworCQl2YWwgPSBJOTE1X1JFQUQoRURQX1BTUjJf
Q1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQllbmFibGVkID0gdmFsICYgRURQX1BT
UjJfRU5BQkxFOworCX0gZWxzZSB7CisJCXZhbCA9IEk5MTVfUkVBRChFRFBfUFNSX0NUTChkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJZW5hYmxlZCA9IHZhbCAmIEVEUF9QU1JfRU5BQkxF
OworCX0KKwlzZXFfcHJpbnRmKG0sICJTb3VyY2UgUFNSIGN0bDogJXMgWzB4JTA4eF1cbiIsCisJ
CSAgIGVuYWJsZWRkaXNhYmxlZChlbmFibGVkKSwgdmFsKTsKKwlwc3Jfc291cmNlX3N0YXR1cyhk
ZXZfcHJpdiwgbSk7CisJc2VxX3ByaW50ZihtLCAiQnVzeSBmcm9udGJ1ZmZlciBiaXRzOiAweCUw
OHhcbiIsCisJCSAgIHBzci0+YnVzeV9mcm9udGJ1ZmZlcl9iaXRzKTsKKworCS8qCisJICogU0tM
KyBQZXJmIGNvdW50ZXIgaXMgcmVzZXQgdG8gMCBldmVyeXRpbWUgREMgc3RhdGUgaXMgZW50ZXJl
ZAorCSAqLworCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2X3By
aXYpKSB7CisJCXZhbCA9IEk5MTVfUkVBRChFRFBfUFNSX1BFUkZfQ05UKGRldl9wcml2LT5wc3Iu
dHJhbnNjb2RlcikpOworCQl2YWwgJj0gRURQX1BTUl9QRVJGX0NOVF9NQVNLOworCQlzZXFfcHJp
bnRmKG0sICJQZXJmb3JtYW5jZSBjb3VudGVyOiAldVxuIiwgdmFsKTsKKwl9CisKKwlpZiAocHNy
LT5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX0lSUSkgeworCQlzZXFfcHJpbnRmKG0sICJMYXN0IGF0
dGVtcHRlZCBlbnRyeSBhdDogJWxsZFxuIiwKKwkJCSAgIHBzci0+bGFzdF9lbnRyeV9hdHRlbXB0
KTsKKwkJc2VxX3ByaW50ZihtLCAiTGFzdCBleGl0IGF0OiAlbGxkXG4iLCBwc3ItPmxhc3RfZXhp
dCk7CisJfQorCisJaWYgKHBzci0+cHNyMl9lbmFibGVkKSB7CisJCXUzMiBzdV9mcmFtZXNfdmFs
WzNdOworCQlpbnQgZnJhbWU7CisKKwkJLyoKKwkJICogUmVhZGluZyBhbGwgMyByZWdpc3RlcnMg
YmVmb3JlIGhhbmQgdG8gbWluaW1pemUgY3Jvc3NpbmcgYQorCQkgKiBmcmFtZSBib3VuZGFyeSBi
ZXR3ZWVuIHJlZ2lzdGVyIHJlYWRzCisJCSAqLworCQlmb3IgKGZyYW1lID0gMDsgZnJhbWUgPCBQ
U1IyX1NVX1NUQVRVU19GUkFNRVM7IGZyYW1lICs9IDMpIHsKKwkJCXZhbCA9IEk5MTVfUkVBRChQ
U1IyX1NVX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIsCisJCQkJCQkgICAgICAgZnJh
bWUpKTsKKwkJCXN1X2ZyYW1lc192YWxbZnJhbWUgLyAzXSA9IHZhbDsKKwkJfQorCisJCXNlcV9w
dXRzKG0sICJGcmFtZTpcdFBTUjIgU1UgYmxvY2tzOlxuIik7CisKKwkJZm9yIChmcmFtZSA9IDA7
IGZyYW1lIDwgUFNSMl9TVV9TVEFUVVNfRlJBTUVTOyBmcmFtZSsrKSB7CisJCQl1MzIgc3VfYmxv
Y2tzOworCisJCQlzdV9ibG9ja3MgPSBzdV9mcmFtZXNfdmFsW2ZyYW1lIC8gM10gJgorCQkJCSAg
ICBQU1IyX1NVX1NUQVRVU19NQVNLKGZyYW1lKTsKKwkJCXN1X2Jsb2NrcyA9IHN1X2Jsb2NrcyA+
PiBQU1IyX1NVX1NUQVRVU19TSElGVChmcmFtZSk7CisJCQlzZXFfcHJpbnRmKG0sICIlZFx0JWRc
biIsIGZyYW1lLCBzdV9ibG9ja3MpOworCQl9CisJfQorCit1bmxvY2s6CisJbXV0ZXhfdW5sb2Nr
KCZwc3ItPmxvY2spOworCWludGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9w
bSwgd2FrZXJlZik7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludAoraTkxNV9lZHBfcHNy
X2RlYnVnX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRhdGE7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisJaW50IHJl
dDsKKworCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCisJCXJldHVybiAtRU5PREVWOworCisJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJTZXR0aW5nIFBTUiBkZWJ1ZyB0byAlbGx4XG4iLCB2
YWwpOworCisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZkZXZfcHJpdi0+cnVudGlt
ZV9wbSk7CisKKwlyZXQgPSBpbnRlbF9wc3JfZGVidWdfc2V0KGRldl9wcml2LCB2YWwpOworCisJ
aW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKKwor
CXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQKK2k5MTVfZWRwX3Bzcl9kZWJ1Z19nZXQodm9p
ZCAqZGF0YSwgdTY0ICp2YWwpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZGF0YTsKKworCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCisJCXJldHVybiAtRU5PREVWOwor
CisJKnZhbCA9IFJFQURfT05DRShkZXZfcHJpdi0+cHNyLmRlYnVnKTsKKwlyZXR1cm4gMDsKK30K
KworREVGSU5FX1NJTVBMRV9BVFRSSUJVVEUoaTkxNV9lZHBfcHNyX2RlYnVnX2ZvcHMsCisJCQlp
OTE1X2VkcF9wc3JfZGVidWdfZ2V0LCBpOTE1X2VkcF9wc3JfZGVidWdfc2V0LAorCQkJIiVsbHVc
biIpOworCitzdGF0aWMgdm9pZCBpbnRlbF9zZXFfcHJpbnRfbW9kZShzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sIGludCB0YWJzLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSkK
K3sKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCB0YWJzOyBpKyspCisJCXNlcV9wdXRjKG0s
ICdcdCcpOworCisJc2VxX3ByaW50ZihtLCBEUk1fTU9ERV9GTVQgIlxuIiwgRFJNX01PREVfQVJH
KG1vZGUpKTsKK30KKworc3RhdGljIHZvaWQgaW50ZWxfZW5jb2Rlcl9pbmZvKHN0cnVjdCBzZXFf
ZmlsZSAqbSwKKwkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgICAgICBz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IGRybV9jb25u
ZWN0b3JfbGlzdF9pdGVyIGNvbm5faXRlcjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVj
dG9yOworCisJc2VxX3ByaW50ZihtLCAiXHRbRU5DT0RFUjolZDolc106IGNvbm5lY3RvcnM6XG4i
LAorCQkgICBlbmNvZGVyLT5iYXNlLmJhc2UuaWQsIGVuY29kZXItPmJhc2UubmFtZSk7CisKKwlk
cm1fY29ubmVjdG9yX2xpc3RfaXRlcl9iZWdpbigmZGV2X3ByaXYtPmRybSwgJmNvbm5faXRlcik7
CisJZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5faXRlcikgewor
CQljb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSA9CisJCQljb25u
ZWN0b3ItPnN0YXRlOworCisJCWlmIChjb25uX3N0YXRlLT5iZXN0X2VuY29kZXIgIT0gJmVuY29k
ZXItPmJhc2UpCisJCQljb250aW51ZTsKKworCQlzZXFfcHJpbnRmKG0sICJcdFx0W0NPTk5FQ1RP
UjolZDolc11cbiIsCisJCQkgICBjb25uZWN0b3ItPmJhc2UuaWQsIGNvbm5lY3Rvci0+bmFtZSk7
CisJfQorCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKK30KKworc3Rh
dGljIHZvaWQgaW50ZWxfcGFuZWxfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRl
bF9wYW5lbCAqcGFuZWwpCit7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGUg
PSBwYW5lbC0+Zml4ZWRfbW9kZTsKKworCXNlcV9wcmludGYobSwgIlx0Zml4ZWQgbW9kZTogIiBE
Uk1fTU9ERV9GTVQgIlxuIiwgRFJNX01PREVfQVJHKG1vZGUpKTsKK30KKworc3RhdGljIHZvaWQg
aW50ZWxfaGRjcF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwKKwkJCSAgICBzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCit7CisJYm9vbCBoZGNwX2NhcCwgaGRjcDJfY2Fw
OworCisJaGRjcF9jYXAgPSBpbnRlbF9oZGNwX2NhcGFibGUoaW50ZWxfY29ubmVjdG9yKTsKKwlo
ZGNwMl9jYXAgPSBpbnRlbF9oZGNwMl9jYXBhYmxlKGludGVsX2Nvbm5lY3Rvcik7CisKKwlpZiAo
aGRjcF9jYXApCisJCXNlcV9wdXRzKG0sICJIRENQMS40ICIpOworCWlmIChoZGNwMl9jYXApCisJ
CXNlcV9wdXRzKG0sICJIRENQMi4yICIpOworCisJaWYgKCFoZGNwX2NhcCAmJiAhaGRjcDJfY2Fw
KQorCQlzZXFfcHV0cyhtLCAiTm9uZSIpOworCisJc2VxX3B1dHMobSwgIlxuIik7Cit9CisKK3N0
YXRpYyB2b2lkIGludGVsX2RwX2luZm8oc3RydWN0IHNlcV9maWxlICptLAorCQkJICBzdHJ1Y3Qg
aW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCit7CisJc3RydWN0IGludGVsX2VuY29k
ZXIgKmludGVsX2VuY29kZXIgPSBpbnRlbF9hdHRhY2hlZF9lbmNvZGVyKGludGVsX2Nvbm5lY3Rv
cik7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChpbnRlbF9l
bmNvZGVyKTsKKworCXNlcV9wcmludGYobSwgIlx0RFBDRCByZXY6ICV4XG4iLCBpbnRlbF9kcC0+
ZHBjZFtEUF9EUENEX1JFVl0pOworCXNlcV9wcmludGYobSwgIlx0YXVkaW8gc3VwcG9ydDogJXNc
biIsIHllc25vKGludGVsX2RwLT5oYXNfYXVkaW8pKTsKKwlpZiAoaW50ZWxfY29ubmVjdG9yLT5i
YXNlLmNvbm5lY3Rvcl90eXBlID09IERSTV9NT0RFX0NPTk5FQ1RPUl9lRFApCisJCWludGVsX3Bh
bmVsX2luZm8obSwgJmludGVsX2Nvbm5lY3Rvci0+cGFuZWwpOworCisJZHJtX2RwX2Rvd25zdHJl
YW1fZGVidWcobSwgaW50ZWxfZHAtPmRwY2QsIGludGVsX2RwLT5kb3duc3RyZWFtX3BvcnRzLAor
CQkJCSZpbnRlbF9kcC0+YXV4KTsKKwlpZiAoaW50ZWxfY29ubmVjdG9yLT5oZGNwLnNoaW0pIHsK
KwkJc2VxX3B1dHMobSwgIlx0SERDUCB2ZXJzaW9uOiAiKTsKKwkJaW50ZWxfaGRjcF9pbmZvKG0s
IGludGVsX2Nvbm5lY3Rvcik7CisJfQorfQorCitzdGF0aWMgdm9pZCBpbnRlbF9kcF9tc3RfaW5m
byhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCisJCQkgIHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVs
X2Nvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlciA9IGlu
dGVsX2F0dGFjaGVkX2VuY29kZXIoaW50ZWxfY29ubmVjdG9yKTsKKwlzdHJ1Y3QgaW50ZWxfZHBf
bXN0X2VuY29kZXIgKmludGVsX21zdCA9CisJCWVuY190b19tc3QoaW50ZWxfZW5jb2Rlcik7CisJ
c3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQgPSBpbnRlbF9tc3QtPnBy
aW1hcnk7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9ICZpbnRlbF9kaWdfcG9ydC0+ZHA7
CisJYm9vbCBoYXNfYXVkaW8gPSBkcm1fZHBfbXN0X3BvcnRfaGFzX2F1ZGlvKCZpbnRlbF9kcC0+
bXN0X21nciwKKwkJCQkJaW50ZWxfY29ubmVjdG9yLT5wb3J0KTsKKworCXNlcV9wcmludGYobSwg
Ilx0YXVkaW8gc3VwcG9ydDogJXNcbiIsIHllc25vKGhhc19hdWRpbykpOworfQorCitzdGF0aWMg
dm9pZCBpbnRlbF9oZG1pX2luZm8oc3RydWN0IHNlcV9maWxlICptLAorCQkJICAgIHN0cnVjdCBp
bnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcikKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqaW50ZWxfZW5jb2RlciA9IGludGVsX2F0dGFjaGVkX2VuY29kZXIoaW50ZWxfY29ubmVjdG9y
KTsKKwlzdHJ1Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKGlu
dGVsX2VuY29kZXIpOworCisJc2VxX3ByaW50ZihtLCAiXHRhdWRpbyBzdXBwb3J0OiAlc1xuIiwg
eWVzbm8oaW50ZWxfaGRtaS0+aGFzX2F1ZGlvKSk7CisJaWYgKGludGVsX2Nvbm5lY3Rvci0+aGRj
cC5zaGltKSB7CisJCXNlcV9wdXRzKG0sICJcdEhEQ1AgdmVyc2lvbjogIik7CisJCWludGVsX2hk
Y3BfaW5mbyhtLCBpbnRlbF9jb25uZWN0b3IpOworCX0KK30KKworc3RhdGljIHZvaWQgaW50ZWxf
bHZkc19pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwKKwkJCSAgICBzdHJ1Y3QgaW50ZWxfY29ubmVj
dG9yICppbnRlbF9jb25uZWN0b3IpCit7CisJaW50ZWxfcGFuZWxfaW5mbyhtLCAmaW50ZWxfY29u
bmVjdG9yLT5wYW5lbCk7Cit9CisKK3N0YXRpYyB2b2lkIGludGVsX2Nvbm5lY3Rvcl9pbmZvKHN0
cnVjdCBzZXFfZmlsZSAqbSwKKwkJCQkgc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikK
K3sKKwlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IgPSB0b19pbnRlbF9j
b25uZWN0b3IoY29ubmVjdG9yKTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAq
Y29ubl9zdGF0ZSA9IGNvbm5lY3Rvci0+c3RhdGU7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIgPQorCQl0b19pbnRlbF9lbmNvZGVyKGNvbm5fc3RhdGUtPmJlc3RfZW5jb2Rlcik7CisJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKm1vZGU7CisKKwlzZXFfcHJpbnRmKG0sICJb
Q09OTkVDVE9SOiVkOiVzXTogc3RhdHVzOiAlc1xuIiwKKwkJICAgY29ubmVjdG9yLT5iYXNlLmlk
LCBjb25uZWN0b3ItPm5hbWUsCisJCSAgIGRybV9nZXRfY29ubmVjdG9yX3N0YXR1c19uYW1lKGNv
bm5lY3Rvci0+c3RhdHVzKSk7CisKKwlpZiAoY29ubmVjdG9yLT5zdGF0dXMgPT0gY29ubmVjdG9y
X3N0YXR1c19kaXNjb25uZWN0ZWQpCisJCXJldHVybjsKKworCXNlcV9wcmludGYobSwgIlx0cGh5
c2ljYWwgZGltZW5zaW9uczogJWR4JWRtbVxuIiwKKwkJICAgY29ubmVjdG9yLT5kaXNwbGF5X2lu
Zm8ud2lkdGhfbW0sCisJCSAgIGNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLmhlaWdodF9tbSk7CisJ
c2VxX3ByaW50ZihtLCAiXHRzdWJwaXhlbCBvcmRlcjogJXNcbiIsCisJCSAgIGRybV9nZXRfc3Vi
cGl4ZWxfb3JkZXJfbmFtZShjb25uZWN0b3ItPmRpc3BsYXlfaW5mby5zdWJwaXhlbF9vcmRlcikp
OworCXNlcV9wcmludGYobSwgIlx0Q0VBIHJldjogJWRcbiIsIGNvbm5lY3Rvci0+ZGlzcGxheV9p
bmZvLmNlYV9yZXYpOworCisJaWYgKCFlbmNvZGVyKQorCQlyZXR1cm47CisKKwlzd2l0Y2ggKGNv
bm5lY3Rvci0+Y29ubmVjdG9yX3R5cGUpIHsKKwljYXNlIERSTV9NT0RFX0NPTk5FQ1RPUl9EaXNw
bGF5UG9ydDoKKwljYXNlIERSTV9NT0RFX0NPTk5FQ1RPUl9lRFA6CisJCWlmIChlbmNvZGVyLT50
eXBlID09IElOVEVMX09VVFBVVF9EUF9NU1QpCisJCQlpbnRlbF9kcF9tc3RfaW5mbyhtLCBpbnRl
bF9jb25uZWN0b3IpOworCQllbHNlCisJCQlpbnRlbF9kcF9pbmZvKG0sIGludGVsX2Nvbm5lY3Rv
cik7CisJCWJyZWFrOworCWNhc2UgRFJNX01PREVfQ09OTkVDVE9SX0xWRFM6CisJCWlmIChlbmNv
ZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9MVkRTKQorCQkJaW50ZWxfbHZkc19pbmZvKG0sIGlu
dGVsX2Nvbm5lY3Rvcik7CisJCWJyZWFrOworCWNhc2UgRFJNX01PREVfQ09OTkVDVE9SX0hETUlB
OgorCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfSERNSSB8fAorCQkgICAgZW5j
b2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRERJKQorCQkJaW50ZWxfaGRtaV9pbmZvKG0sIGlu
dGVsX2Nvbm5lY3Rvcik7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCWJyZWFrOworCX0KKworCXNl
cV9wcmludGYobSwgIlx0bW9kZXM6XG4iKTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KG1vZGUsICZj
b25uZWN0b3ItPm1vZGVzLCBoZWFkKQorCQlpbnRlbF9zZXFfcHJpbnRfbW9kZShtLCAyLCBtb2Rl
KTsKK30KKworc3RhdGljIGNvbnN0IGNoYXIgKnBsYW5lX3R5cGUoZW51bSBkcm1fcGxhbmVfdHlw
ZSB0eXBlKQoreworCXN3aXRjaCAodHlwZSkgeworCWNhc2UgRFJNX1BMQU5FX1RZUEVfT1ZFUkxB
WToKKwkJcmV0dXJuICJPVkwiOworCWNhc2UgRFJNX1BMQU5FX1RZUEVfUFJJTUFSWToKKwkJcmV0
dXJuICJQUkkiOworCWNhc2UgRFJNX1BMQU5FX1RZUEVfQ1VSU09SOgorCQlyZXR1cm4gIkNVUiI7
CisJLyoKKwkgKiBEZWxpYmVyYXRlbHkgb21pdHRpbmcgZGVmYXVsdDogdG8gZ2VuZXJhdGUgY29t
cGlsZXIgd2FybmluZ3MKKwkgKiB3aGVuIGEgbmV3IGRybV9wbGFuZV90eXBlIGdldHMgYWRkZWQu
CisJICovCisJfQorCisJcmV0dXJuICJ1bmtub3duIjsKK30KKworc3RhdGljIHZvaWQgcGxhbmVf
cm90YXRpb24oY2hhciAqYnVmLCBzaXplX3QgYnVmc2l6ZSwgdW5zaWduZWQgaW50IHJvdGF0aW9u
KQoreworCS8qCisJICogQWNjb3JkaW5nIHRvIGRvYyBvbmx5IG9uZSBEUk1fTU9ERV9ST1RBVEVf
IGlzIGFsbG93ZWQgYnV0IHRoaXMKKwkgKiB3aWxsIHByaW50IHRoZW0gYWxsIHRvIHZpc3VhbGl6
ZSBpZiB0aGUgdmFsdWVzIGFyZSBtaXN1c2VkCisJICovCisJc25wcmludGYoYnVmLCBidWZzaXpl
LAorCQkgIiVzJXMlcyVzJXMlcygweCUwOHgpIiwKKwkJIChyb3RhdGlvbiAmIERSTV9NT0RFX1JP
VEFURV8wKSA/ICIwICIgOiAiIiwKKwkJIChyb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV85MCkg
PyAiOTAgIiA6ICIiLAorCQkgKHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkgPyAiMTgw
ICIgOiAiIiwKKwkJIChyb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV8yNzApID8gIjI3MCAiIDog
IiIsCisJCSAocm90YXRpb24gJiBEUk1fTU9ERV9SRUZMRUNUX1gpID8gIkZMSVBYICIgOiAiIiwK
KwkJIChyb3RhdGlvbiAmIERSTV9NT0RFX1JFRkxFQ1RfWSkgPyAiRkxJUFkgIiA6ICIiLAorCQkg
cm90YXRpb24pOworfQorCitzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV91YXBpX2luZm8oc3RydWN0
IHNlcV9maWxlICptLCBzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lKQoreworCWNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQorCQl0b19pbnRlbF9wbGFuZV9zdGF0
ZShwbGFuZS0+YmFzZS5zdGF0ZSk7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+dWFwaS5mYjsKKwlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBmb3Jt
YXRfbmFtZTsKKwlzdHJ1Y3QgZHJtX3JlY3Qgc3JjLCBkc3Q7CisJY2hhciByb3Rfc3RyWzQ4XTsK
KworCXNyYyA9IGRybV9wbGFuZV9zdGF0ZV9zcmMoJnBsYW5lX3N0YXRlLT51YXBpKTsKKwlkc3Qg
PSBkcm1fcGxhbmVfc3RhdGVfZGVzdCgmcGxhbmVfc3RhdGUtPnVhcGkpOworCisJaWYgKGZiKQor
CQlkcm1fZ2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKTsK
KworCXBsYW5lX3JvdGF0aW9uKHJvdF9zdHIsIHNpemVvZihyb3Rfc3RyKSwKKwkJICAgICAgIHBs
YW5lX3N0YXRlLT51YXBpLnJvdGF0aW9uKTsKKworCXNlcV9wcmludGYobSwgIlx0XHR1YXBpOiBm
Yj0lZCwlcywlZHglZCwgc3JjPSIgRFJNX1JFQ1RfRlBfRk1UICIsIGRzdD0iIERSTV9SRUNUX0ZN
VCAiLCByb3RhdGlvbj0lc1xuIiwKKwkJICAgZmIgPyBmYi0+YmFzZS5pZCA6IDAsIGZiID8gZm9y
bWF0X25hbWUuc3RyIDogIm4vYSIsCisJCSAgIGZiID8gZmItPndpZHRoIDogMCwgZmIgPyBmYi0+
aGVpZ2h0IDogMCwKKwkJICAgRFJNX1JFQ1RfRlBfQVJHKCZzcmMpLAorCQkgICBEUk1fUkVDVF9B
UkcoJmRzdCksCisJCSAgIHJvdF9zdHIpOworfQorCitzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9o
d19pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSkKK3sK
Kwljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0KKwkJdG9faW50
ZWxfcGxhbmVfc3RhdGUocGxhbmUtPmJhc2Uuc3RhdGUpOworCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXN0cnVjdCBkcm1fZm9ybWF0X25h
bWVfYnVmIGZvcm1hdF9uYW1lOworCWNoYXIgcm90X3N0cls0OF07CisKKwlpZiAoIWZiKQorCQly
ZXR1cm47CisKKwlkcm1fZ2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1h
dF9uYW1lKTsKKworCXBsYW5lX3JvdGF0aW9uKHJvdF9zdHIsIHNpemVvZihyb3Rfc3RyKSwKKwkJ
ICAgICAgIHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbik7CisKKwlzZXFfcHJpbnRmKG0sICJcdFx0
aHc6IGZiPSVkLCVzLCVkeCVkLCB2aXNpYmxlPSVzLCBzcmM9IiBEUk1fUkVDVF9GUF9GTVQgIiwg
ZHN0PSIgRFJNX1JFQ1RfRk1UICIsIHJvdGF0aW9uPSVzXG4iLAorCQkgICBmYi0+YmFzZS5pZCwg
Zm9ybWF0X25hbWUuc3RyLAorCQkgICBmYi0+d2lkdGgsIGZiLT5oZWlnaHQsCisJCSAgIHllc25v
KHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpLAorCQkgICBEUk1fUkVDVF9GUF9BUkcoJnBsYW5l
X3N0YXRlLT51YXBpLnNyYyksCisJCSAgIERSTV9SRUNUX0FSRygmcGxhbmVfc3RhdGUtPnVhcGku
ZHN0KSwKKwkJICAgcm90X3N0cik7Cit9CisKK3N0YXRpYyB2b2lkIGludGVsX3BsYW5lX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJ
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKKworCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2Ny
dGMoJmRldl9wcml2LT5kcm0sIGNydGMsIHBsYW5lKSB7CisJCXNlcV9wcmludGYobSwgIlx0W1BM
QU5FOiVkOiVzXTogdHlwZT0lc1xuIiwKKwkJCSAgIHBsYW5lLT5iYXNlLmJhc2UuaWQsIHBsYW5l
LT5iYXNlLm5hbWUsCisJCQkgICBwbGFuZV90eXBlKHBsYW5lLT5iYXNlLnR5cGUpKTsKKwkJaW50
ZWxfcGxhbmVfdWFwaV9pbmZvKG0sIHBsYW5lKTsKKwkJaW50ZWxfcGxhbmVfaHdfaW5mbyhtLCBw
bGFuZSk7CisJfQorfQorCitzdGF0aWMgdm9pZCBpbnRlbF9zY2FsZXJfaW5mbyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQoreworCWNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0KKwkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5i
YXNlLnN0YXRlKTsKKwlpbnQgbnVtX3NjYWxlcnMgPSBjcnRjLT5udW1fc2NhbGVyczsKKwlpbnQg
aTsKKworCS8qIE5vdCBhbGwgcGxhdGZvcm1hcyBoYXZlIGEgc2NhbGVyICovCisJaWYgKG51bV9z
Y2FsZXJzKSB7CisJCXNlcV9wcmludGYobSwgIlx0bnVtX3NjYWxlcnM9JWQsIHNjYWxlcl91c2Vy
cz0leCBzY2FsZXJfaWQ9JWQiLAorCQkJICAgbnVtX3NjYWxlcnMsCisJCQkgICBjcnRjX3N0YXRl
LT5zY2FsZXJfc3RhdGUuc2NhbGVyX3VzZXJzLAorCQkJICAgY3J0Y19zdGF0ZS0+c2NhbGVyX3N0
YXRlLnNjYWxlcl9pZCk7CisKKwkJZm9yIChpID0gMDsgaSA8IG51bV9zY2FsZXJzOyBpKyspIHsK
KwkJCWNvbnN0IHN0cnVjdCBpbnRlbF9zY2FsZXIgKnNjID0KKwkJCQkmY3J0Y19zdGF0ZS0+c2Nh
bGVyX3N0YXRlLnNjYWxlcnNbaV07CisKKwkJCXNlcV9wcmludGYobSwgIiwgc2NhbGVyc1slZF06
IHVzZT0lcywgbW9kZT0leCIsCisJCQkJICAgaSwgeWVzbm8oc2MtPmluX3VzZSksIHNjLT5tb2Rl
KTsKKwkJfQorCQlzZXFfcHV0cyhtLCAiXG4iKTsKKwl9IGVsc2UgeworCQlzZXFfcHV0cyhtLCAi
XHRObyBzY2FsZXJzIGF2YWlsYWJsZSBvbiB0aGlzIHBsYXRmb3JtXG4iKTsKKwl9Cit9CisKK3N0
YXRpYyB2b2lkIGludGVsX2NydGNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5v
ZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSA9CisJCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CisJ
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CisKKwlzZXFfcHJpbnRmKG0sICJbQ1JUQzol
ZDolc106XG4iLAorCQkgICBjcnRjLT5iYXNlLmJhc2UuaWQsIGNydGMtPmJhc2UubmFtZSk7CisK
KwlzZXFfcHJpbnRmKG0sICJcdHVhcGk6IGVuYWJsZT0lcywgYWN0aXZlPSVzLCBtb2RlPSIgRFJN
X01PREVfRk1UICJcbiIsCisJCSAgIHllc25vKGNydGNfc3RhdGUtPnVhcGkuZW5hYmxlKSwKKwkJ
ICAgeWVzbm8oY3J0Y19zdGF0ZS0+dWFwaS5hY3RpdmUpLAorCQkgICBEUk1fTU9ERV9BUkcoJmNy
dGNfc3RhdGUtPnVhcGkubW9kZSkpOworCisJaWYgKGNydGNfc3RhdGUtPmh3LmVuYWJsZSkgewor
CQlzZXFfcHJpbnRmKG0sICJcdGh3OiBhY3RpdmU9JXMsIGFkanVzdGVkX21vZGU9IiBEUk1fTU9E
RV9GTVQgIlxuIiwKKwkJCSAgIHllc25vKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSksCisJCQkgICBE
Uk1fTU9ERV9BUkcoJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUpKTsKKworCQlzZXFfcHJp
bnRmKG0sICJcdHBpcGUgc3JjIHNpemU9JWR4JWQsIGRpdGhlcj0lcywgYnBwPSVkXG4iLAorCQkJ
ICAgY3J0Y19zdGF0ZS0+cGlwZV9zcmNfdywgY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaCwKKwkJCSAg
IHllc25vKGNydGNfc3RhdGUtPmRpdGhlciksIGNydGNfc3RhdGUtPnBpcGVfYnBwKTsKKworCQlp
bnRlbF9zY2FsZXJfaW5mbyhtLCBjcnRjKTsKKwl9CisKKwlmb3JfZWFjaF9pbnRlbF9lbmNvZGVy
X21hc2soJmRldl9wcml2LT5kcm0sIGVuY29kZXIsCisJCQkJICAgIGNydGNfc3RhdGUtPnVhcGku
ZW5jb2Rlcl9tYXNrKQorCQlpbnRlbF9lbmNvZGVyX2luZm8obSwgY3J0YywgZW5jb2Rlcik7CisK
KwlpbnRlbF9wbGFuZV9pbmZvKG0sIGNydGMpOworCisJc2VxX3ByaW50ZihtLCAiXHR1bmRlcnJ1
biByZXBvcnRpbmc6IGNwdT0lcyBwY2g9JXNcbiIsCisJCSAgIHllc25vKCFjcnRjLT5jcHVfZmlm
b191bmRlcnJ1bl9kaXNhYmxlZCksCisJCSAgIHllc25vKCFjcnRjLT5wY2hfZmlmb191bmRlcnJ1
bl9kaXNhYmxlZCkpOworfQorCitzdGF0aWMgaW50IGk5MTVfZGlzcGxheV9pbmZvKHN0cnVjdCBz
ZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisJc3RydWN0
IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0
ZXIgY29ubl9pdGVyOworCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworCisJd2FrZXJlZiA9IGlu
dGVsX3J1bnRpbWVfcG1fZ2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CisKKwlkcm1fbW9kZXNl
dF9sb2NrX2FsbChkZXYpOworCisJc2VxX3ByaW50ZihtLCAiQ1JUQyBpbmZvXG4iKTsKKwlzZXFf
cHJpbnRmKG0sICItLS0tLS0tLS1cbiIpOworCWZvcl9lYWNoX2ludGVsX2NydGMoZGV2LCBjcnRj
KQorCQlpbnRlbF9jcnRjX2luZm8obSwgY3J0Yyk7CisKKwlzZXFfcHJpbnRmKG0sICJcbiIpOwor
CXNlcV9wcmludGYobSwgIkNvbm5lY3RvciBpbmZvXG4iKTsKKwlzZXFfcHJpbnRmKG0sICItLS0t
LS0tLS0tLS0tLVxuIik7CisJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfYmVnaW4oZGV2LCAmY29u
bl9pdGVyKTsKKwlkcm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0ZXIoY29ubmVjdG9yLCAmY29ubl9p
dGVyKQorCQlpbnRlbF9jb25uZWN0b3JfaW5mbyhtLCBjb25uZWN0b3IpOworCWRybV9jb25uZWN0
b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKKworCWRybV9tb2Rlc2V0X3VubG9ja19hbGwo
ZGV2KTsKKworCWludGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2Fr
ZXJlZik7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBpOTE1X3NoYXJlZF9kcGxsc19p
bmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQoreworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJaW50IGk7CisKKwlkcm1fbW9kZXNl
dF9sb2NrX2FsbChkZXYpOworCWZvciAoaSA9IDA7IGkgPCBkZXZfcHJpdi0+bnVtX3NoYXJlZF9k
cGxsOyBpKyspIHsKKwkJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwgPSAmZGV2X3ByaXYt
PnNoYXJlZF9kcGxsc1tpXTsKKworCQlzZXFfcHJpbnRmKG0sICJEUExMJWk6ICVzLCBpZDogJWlc
biIsIGksIHBsbC0+aW5mby0+bmFtZSwKKwkJCSAgIHBsbC0+aW5mby0+aWQpOworCQlzZXFfcHJp
bnRmKG0sICIgY3J0Y19tYXNrOiAweCUwOHgsIGFjdGl2ZTogMHgleCwgb246ICVzXG4iLAorCQkJ
ICAgcGxsLT5zdGF0ZS5jcnRjX21hc2ssIHBsbC0+YWN0aXZlX21hc2ssIHllc25vKHBsbC0+b24p
KTsKKwkJc2VxX3ByaW50ZihtLCAiIHRyYWNrZWQgaGFyZHdhcmUgc3RhdGU6XG4iKTsKKwkJc2Vx
X3ByaW50ZihtLCAiIGRwbGw6ICAgIDB4JTA4eFxuIiwgcGxsLT5zdGF0ZS5od19zdGF0ZS5kcGxs
KTsKKwkJc2VxX3ByaW50ZihtLCAiIGRwbGxfbWQ6IDB4JTA4eFxuIiwKKwkJCSAgIHBsbC0+c3Rh
dGUuaHdfc3RhdGUuZHBsbF9tZCk7CisJCXNlcV9wcmludGYobSwgIiBmcDA6ICAgICAweCUwOHhc
biIsIHBsbC0+c3RhdGUuaHdfc3RhdGUuZnAwKTsKKwkJc2VxX3ByaW50ZihtLCAiIGZwMTogICAg
IDB4JTA4eFxuIiwgcGxsLT5zdGF0ZS5od19zdGF0ZS5mcDEpOworCQlzZXFfcHJpbnRmKG0sICIg
d3JwbGw6ICAgMHglMDh4XG4iLCBwbGwtPnN0YXRlLmh3X3N0YXRlLndycGxsKTsKKwkJc2VxX3By
aW50ZihtLCAiIGNmZ2NyMDogIDB4JTA4eFxuIiwgcGxsLT5zdGF0ZS5od19zdGF0ZS5jZmdjcjAp
OworCQlzZXFfcHJpbnRmKG0sICIgY2ZnY3IxOiAgMHglMDh4XG4iLCBwbGwtPnN0YXRlLmh3X3N0
YXRlLmNmZ2NyMSk7CisJCXNlcV9wcmludGYobSwgIiBtZ19yZWZjbGtpbl9jdGw6ICAgICAgICAw
eCUwOHhcbiIsCisJCQkgICBwbGwtPnN0YXRlLmh3X3N0YXRlLm1nX3JlZmNsa2luX2N0bCk7CisJ
CXNlcV9wcmludGYobSwgIiBtZ19jbGt0b3AyX2NvcmVjbGtjdGwxOiAweCUwOHhcbiIsCisJCQkg
ICBwbGwtPnN0YXRlLmh3X3N0YXRlLm1nX2Nsa3RvcDJfY29yZWNsa2N0bDEpOworCQlzZXFfcHJp
bnRmKG0sICIgbWdfY2xrdG9wMl9oc2Nsa2N0bDogICAgMHglMDh4XG4iLAorCQkJICAgcGxsLT5z
dGF0ZS5od19zdGF0ZS5tZ19jbGt0b3AyX2hzY2xrY3RsKTsKKwkJc2VxX3ByaW50ZihtLCAiIG1n
X3BsbF9kaXYwOiAgMHglMDh4XG4iLAorCQkJICAgcGxsLT5zdGF0ZS5od19zdGF0ZS5tZ19wbGxf
ZGl2MCk7CisJCXNlcV9wcmludGYobSwgIiBtZ19wbGxfZGl2MTogIDB4JTA4eFxuIiwKKwkJCSAg
IHBsbC0+c3RhdGUuaHdfc3RhdGUubWdfcGxsX2RpdjEpOworCQlzZXFfcHJpbnRmKG0sICIgbWdf
cGxsX2xmOiAgICAweCUwOHhcbiIsCisJCQkgICBwbGwtPnN0YXRlLmh3X3N0YXRlLm1nX3BsbF9s
Zik7CisJCXNlcV9wcmludGYobSwgIiBtZ19wbGxfZnJhY19sb2NrOiAweCUwOHhcbiIsCisJCQkg
ICBwbGwtPnN0YXRlLmh3X3N0YXRlLm1nX3BsbF9mcmFjX2xvY2spOworCQlzZXFfcHJpbnRmKG0s
ICIgbWdfcGxsX3NzYzogICAweCUwOHhcbiIsCisJCQkgICBwbGwtPnN0YXRlLmh3X3N0YXRlLm1n
X3BsbF9zc2MpOworCQlzZXFfcHJpbnRmKG0sICIgbWdfcGxsX2JpYXM6ICAweCUwOHhcbiIsCisJ
CQkgICBwbGwtPnN0YXRlLmh3X3N0YXRlLm1nX3BsbF9iaWFzKTsKKwkJc2VxX3ByaW50ZihtLCAi
IG1nX3BsbF90ZGNfY29sZHN0X2JpYXM6IDB4JTA4eFxuIiwKKwkJCSAgIHBsbC0+c3RhdGUuaHdf
c3RhdGUubWdfcGxsX3RkY19jb2xkc3RfYmlhcyk7CisJfQorCWRybV9tb2Rlc2V0X3VubG9ja19h
bGwoZGV2KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGk5MTVfZGRiX2luZm8oc3Ry
dWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZW50cnk7
CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8
IDkpCisJCXJldHVybiAtRU5PREVWOworCisJZHJtX21vZGVzZXRfbG9ja19hbGwoZGV2KTsKKwor
CXNlcV9wcmludGYobSwgIiUtMTVzJThzJThzJThzXG4iLCAiIiwgIlN0YXJ0IiwgIkVuZCIsICJT
aXplIik7CisKKwlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjKSB7CisJ
CXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0KKwkJCXRvX2ludGVsX2NydGNf
c3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CisJCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsK
KwkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZDsKKworCQlzZXFfcHJpbnRmKG0sICJQaXBlICVjXG4i
LCBwaXBlX25hbWUocGlwZSkpOworCisJCWZvcl9lYWNoX3BsYW5lX2lkX29uX2NydGMoY3J0Yywg
cGxhbmVfaWQpIHsKKwkJCWVudHJ5ID0gJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeVtw
bGFuZV9pZF07CisJCQlzZXFfcHJpbnRmKG0sICIgIFBsYW5lJS04ZCU4dSU4dSU4dVxuIiwgcGxh
bmVfaWQgKyAxLAorCQkJCSAgIGVudHJ5LT5zdGFydCwgZW50cnktPmVuZCwKKwkJCQkgICBza2xf
ZGRiX2VudHJ5X3NpemUoZW50cnkpKTsKKwkJfQorCisJCWVudHJ5ID0gJmNydGNfc3RhdGUtPndt
LnNrbC5wbGFuZV9kZGJfeVtQTEFORV9DVVJTT1JdOworCQlzZXFfcHJpbnRmKG0sICIgICUtMTNz
JTh1JTh1JTh1XG4iLCAiQ3Vyc29yIiwgZW50cnktPnN0YXJ0LAorCQkJICAgZW50cnktPmVuZCwg
c2tsX2RkYl9lbnRyeV9zaXplKGVudHJ5KSk7CisJfQorCisJZHJtX21vZGVzZXRfdW5sb2NrX2Fs
bChkZXYpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIGRycnNfc3RhdHVzX3Blcl9j
cnRjKHN0cnVjdCBzZXFfZmlsZSAqbSwKKwkJCQkgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJ
CQkgc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMpCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBpOTE1X2RycnMgKmRycnMg
PSAmZGV2X3ByaXYtPmRycnM7CisJaW50IHZyZWZyZXNoID0gMDsKKwlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yOworCXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3RfaXRlciBjb25uX2l0
ZXI7CisKKwlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9iZWdpbihkZXYsICZjb25uX2l0ZXIpOwor
CWRybV9mb3JfZWFjaF9jb25uZWN0b3JfaXRlcihjb25uZWN0b3IsICZjb25uX2l0ZXIpIHsKKwkJ
aWYgKGNvbm5lY3Rvci0+c3RhdGUtPmNydGMgIT0gJmludGVsX2NydGMtPmJhc2UpCisJCQljb250
aW51ZTsKKworCQlzZXFfcHJpbnRmKG0sICIlczpcbiIsIGNvbm5lY3Rvci0+bmFtZSk7CisJfQor
CWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKKworCXNlcV9wdXRzKG0s
ICJcbiIpOworCisJaWYgKHRvX2ludGVsX2NydGNfc3RhdGUoaW50ZWxfY3J0Yy0+YmFzZS5zdGF0
ZSktPmhhc19kcnJzKSB7CisJCXN0cnVjdCBpbnRlbF9wYW5lbCAqcGFuZWw7CisKKwkJbXV0ZXhf
bG9jaygmZHJycy0+bXV0ZXgpOworCQkvKiBEUlJTIFN1cHBvcnRlZCAqLworCQlzZXFfcHV0cyht
LCAiXHREUlJTIFN1cHBvcnRlZDogWWVzXG4iKTsKKworCQkvKiBkaXNhYmxlX2RycnMoKSB3aWxs
IG1ha2UgZHJycy0+ZHAgTlVMTCAqLworCQlpZiAoIWRycnMtPmRwKSB7CisJCQlzZXFfcHV0cyht
LCAiSWRsZW5lc3MgRFJSUzogRGlzYWJsZWRcbiIpOworCQkJaWYgKGRldl9wcml2LT5wc3IuZW5h
YmxlZCkKKwkJCQlzZXFfcHV0cyhtLAorCQkJCSJcdEFzIFBTUiBpcyBlbmFibGVkLCBEUlJTIGlz
IG5vdCBlbmFibGVkXG4iKTsKKwkJCW11dGV4X3VubG9jaygmZHJycy0+bXV0ZXgpOworCQkJcmV0
dXJuOworCQl9CisKKwkJcGFuZWwgPSAmZHJycy0+ZHAtPmF0dGFjaGVkX2Nvbm5lY3Rvci0+cGFu
ZWw7CisJCXNlcV9wcmludGYobSwgIlx0XHRCdXN5X2Zyb250YnVmZmVyX2JpdHM6IDB4JVgiLAor
CQkJCQlkcnJzLT5idXN5X2Zyb250YnVmZmVyX2JpdHMpOworCisJCXNlcV9wdXRzKG0sICJcblx0
XHQiKTsKKwkJaWYgKGRycnMtPnJlZnJlc2hfcmF0ZV90eXBlID09IERSUlNfSElHSF9SUikgewor
CQkJc2VxX3B1dHMobSwgIkRSUlNfU3RhdGU6IERSUlNfSElHSF9SUlxuIik7CisJCQl2cmVmcmVz
aCA9IHBhbmVsLT5maXhlZF9tb2RlLT52cmVmcmVzaDsKKwkJfSBlbHNlIGlmIChkcnJzLT5yZWZy
ZXNoX3JhdGVfdHlwZSA9PSBEUlJTX0xPV19SUikgeworCQkJc2VxX3B1dHMobSwgIkRSUlNfU3Rh
dGU6IERSUlNfTE9XX1JSXG4iKTsKKwkJCXZyZWZyZXNoID0gcGFuZWwtPmRvd25jbG9ja19tb2Rl
LT52cmVmcmVzaDsKKwkJfSBlbHNlIHsKKwkJCXNlcV9wcmludGYobSwgIkRSUlNfU3RhdGU6IFVu
a25vd24oJWQpXG4iLAorCQkJCQkJZHJycy0+cmVmcmVzaF9yYXRlX3R5cGUpOworCQkJbXV0ZXhf
dW5sb2NrKCZkcnJzLT5tdXRleCk7CisJCQlyZXR1cm47CisJCX0KKwkJc2VxX3ByaW50ZihtLCAi
XHRcdFZyZWZyZXNoOiAlZCIsIHZyZWZyZXNoKTsKKworCQlzZXFfcHV0cyhtLCAiXG5cdFx0Iik7
CisJCW11dGV4X3VubG9jaygmZHJycy0+bXV0ZXgpOworCX0gZWxzZSB7CisJCS8qIERSUlMgbm90
IHN1cHBvcnRlZC4gUHJpbnQgdGhlIFZCVCBwYXJhbWV0ZXIqLworCQlzZXFfcHV0cyhtLCAiXHRE
UlJTIFN1cHBvcnRlZCA6IE5vIik7CisJfQorCXNlcV9wdXRzKG0sICJcbiIpOworfQorCitzdGF0
aWMgaW50IGk5MTVfZHJyc19zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQp
Cit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0t
PnByaXZhdGUpOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlz
dHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YzsKKwlpbnQgYWN0aXZlX2NydGNfY250ID0gMDsK
KworCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGRldik7CisJZm9yX2VhY2hfaW50ZWxfY3J0YyhkZXYs
IGludGVsX2NydGMpIHsKKwkJaWYgKGludGVsX2NydGMtPmJhc2Uuc3RhdGUtPmFjdGl2ZSkgewor
CQkJYWN0aXZlX2NydGNfY250Kys7CisJCQlzZXFfcHJpbnRmKG0sICJcbkNSVEMgJWQ6ICAiLCBh
Y3RpdmVfY3J0Y19jbnQpOworCisJCQlkcnJzX3N0YXR1c19wZXJfY3J0YyhtLCBkZXYsIGludGVs
X2NydGMpOworCQl9CisJfQorCWRybV9tb2Rlc2V0X3VubG9ja19hbGwoZGV2KTsKKworCWlmICgh
YWN0aXZlX2NydGNfY250KQorCQlzZXFfcHV0cyhtLCAiTm8gYWN0aXZlIGNydGMgZm91bmRcbiIp
OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgaTkxNV9kcF9tc3RfaW5mbyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICppbnRlbF9lbmNv
ZGVyOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0OworCXN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CisJc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9p
dGVyIGNvbm5faXRlcjsKKworCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNv
bm5faXRlcik7CisJZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5f
aXRlcikgeworCQlpZiAoY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSAhPSBEUk1fTU9ERV9DT05O
RUNUT1JfRGlzcGxheVBvcnQpCisJCQljb250aW51ZTsKKworCQlpbnRlbF9lbmNvZGVyID0gaW50
ZWxfYXR0YWNoZWRfZW5jb2Rlcih0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKSk7CisJCWlm
ICghaW50ZWxfZW5jb2RlciB8fCBpbnRlbF9lbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9E
UF9NU1QpCisJCQljb250aW51ZTsKKworCQlpbnRlbF9kaWdfcG9ydCA9IGVuY190b19kaWdfcG9y
dChpbnRlbF9lbmNvZGVyKTsKKwkJaWYgKCFpbnRlbF9kaWdfcG9ydC0+ZHAuY2FuX21zdCkKKwkJ
CWNvbnRpbnVlOworCisJCXNlcV9wcmludGYobSwgIk1TVCBTb3VyY2UgUG9ydCBbRU5DT0RFUjol
ZDolc11cbiIsCisJCQkgICBpbnRlbF9kaWdfcG9ydC0+YmFzZS5iYXNlLmJhc2UuaWQsCisJCQkg
ICBpbnRlbF9kaWdfcG9ydC0+YmFzZS5iYXNlLm5hbWUpOworCQlkcm1fZHBfbXN0X2R1bXBfdG9w
b2xvZ3kobSwgJmludGVsX2RpZ19wb3J0LT5kcC5tc3RfbWdyKTsKKwl9CisJZHJtX2Nvbm5lY3Rv
cl9saXN0X2l0ZXJfZW5kKCZjb25uX2l0ZXIpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBz
c2l6ZV90IGk5MTVfZGlzcGxheXBvcnRfdGVzdF9hY3RpdmVfd3JpdGUoc3RydWN0IGZpbGUgKmZp
bGUsCisJCQkJCQkgIGNvbnN0IGNoYXIgX191c2VyICp1YnVmLAorCQkJCQkJICBzaXplX3QgbGVu
LCBsb2ZmX3QgKm9mZnApCit7CisJY2hhciAqaW5wdXRfYnVmZmVyOworCWludCBzdGF0dXMgPSAw
OworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXY7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5l
Y3RvcjsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOworCXN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHA7CisJaW50IHZhbCA9IDA7CisKKwlkZXYgPSAoKHN0cnVjdCBz
ZXFfZmlsZSAqKWZpbGUtPnByaXZhdGVfZGF0YSktPnByaXZhdGU7CisKKwlpZiAobGVuID09IDAp
CisJCXJldHVybiAwOworCisJaW5wdXRfYnVmZmVyID0gbWVtZHVwX3VzZXJfbnVsKHVidWYsIGxl
bik7CisJaWYgKElTX0VSUihpbnB1dF9idWZmZXIpKQorCQlyZXR1cm4gUFRSX0VSUihpbnB1dF9i
dWZmZXIpOworCisJZHJtX2RiZygmdG9faTkxNShkZXYpLT5kcm0sCisJCSJDb3BpZWQgJWQgYnl0
ZXMgZnJvbSB1c2VyXG4iLCAodW5zaWduZWQgaW50KWxlbik7CisKKwlkcm1fY29ubmVjdG9yX2xp
c3RfaXRlcl9iZWdpbihkZXYsICZjb25uX2l0ZXIpOworCWRybV9mb3JfZWFjaF9jb25uZWN0b3Jf
aXRlcihjb25uZWN0b3IsICZjb25uX2l0ZXIpIHsKKwkJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXI7CisKKwkJaWYgKGNvbm5lY3Rvci0+Y29ubmVjdG9yX3R5cGUgIT0KKwkJICAgIERSTV9N
T0RFX0NPTk5FQ1RPUl9EaXNwbGF5UG9ydCkKKwkJCWNvbnRpbnVlOworCisJCWVuY29kZXIgPSB0
b19pbnRlbF9lbmNvZGVyKGNvbm5lY3Rvci0+ZW5jb2Rlcik7CisJCWlmIChlbmNvZGVyICYmIGVu
Y29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0RQX01TVCkKKwkJCWNvbnRpbnVlOworCisJCWlm
IChlbmNvZGVyICYmIGNvbm5lY3Rvci0+c3RhdHVzID09IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVj
dGVkKSB7CisJCQlpbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKwkJCXN0YXR1
cyA9IGtzdHJ0b2ludChpbnB1dF9idWZmZXIsIDEwLCAmdmFsKTsKKwkJCWlmIChzdGF0dXMgPCAw
KQorCQkJCWJyZWFrOworCQkJZHJtX2RiZygmdG9faTkxNShkZXYpLT5kcm0sCisJCQkJIkdvdCAl
ZCBmb3IgdGVzdCBhY3RpdmVcbiIsIHZhbCk7CisJCQkvKiBUbyBwcmV2ZW50IGVycm9uZW91cyBh
Y3RpdmF0aW9uIG9mIHRoZSBjb21wbGlhbmNlCisJCQkgKiB0ZXN0aW5nIGNvZGUsIG9ubHkgYWNj
ZXB0IGFuIGFjdHVhbCB2YWx1ZSBvZiAxIGhlcmUKKwkJCSAqLworCQkJaWYgKHZhbCA9PSAxKQor
CQkJCWludGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfYWN0aXZlID0gdHJ1ZTsKKwkJCWVsc2UKKwkJ
CQlpbnRlbF9kcC0+Y29tcGxpYW5jZS50ZXN0X2FjdGl2ZSA9IGZhbHNlOworCQl9CisJfQorCWRy
bV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKKwlrZnJlZShpbnB1dF9idWZm
ZXIpOworCWlmIChzdGF0dXMgPCAwKQorCQlyZXR1cm4gc3RhdHVzOworCisJKm9mZnAgKz0gbGVu
OworCXJldHVybiBsZW47Cit9CisKK3N0YXRpYyBpbnQgaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2Fj
dGl2ZV9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2YXRlOworCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9y
OworCXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3RfaXRlciBjb25uX2l0ZXI7CisJc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcDsKKworCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwg
JmNvbm5faXRlcik7CisJZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNv
bm5faXRlcikgeworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKworCQlpZiAoY29u
bmVjdG9yLT5jb25uZWN0b3JfdHlwZSAhPQorCQkgICAgRFJNX01PREVfQ09OTkVDVE9SX0Rpc3Bs
YXlQb3J0KQorCQkJY29udGludWU7CisKKwkJZW5jb2RlciA9IHRvX2ludGVsX2VuY29kZXIoY29u
bmVjdG9yLT5lbmNvZGVyKTsKKwkJaWYgKGVuY29kZXIgJiYgZW5jb2Rlci0+dHlwZSA9PSBJTlRF
TF9PVVRQVVRfRFBfTVNUKQorCQkJY29udGludWU7CisKKwkJaWYgKGVuY29kZXIgJiYgY29ubmVj
dG9yLT5zdGF0dXMgPT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpIHsKKwkJCWludGVsX2Rw
ID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCQkJaWYgKGludGVsX2RwLT5jb21wbGlhbmNl
LnRlc3RfYWN0aXZlKQorCQkJCXNlcV9wdXRzKG0sICIxIik7CisJCQllbHNlCisJCQkJc2VxX3B1
dHMobSwgIjAiKTsKKwkJfSBlbHNlCisJCQlzZXFfcHV0cyhtLCAiMCIpOworCX0KKwlkcm1fY29u
bmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5faXRlcik7CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludCBpOTE1X2Rpc3BsYXlwb3J0X3Rlc3RfYWN0aXZlX29wZW4oc3RydWN0IGlub2RlICpp
bm9kZSwKKwkJCQkJICAgICBzdHJ1Y3QgZmlsZSAqZmlsZSkKK3sKKwlyZXR1cm4gc2luZ2xlX29w
ZW4oZmlsZSwgaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2FjdGl2ZV9zaG93LAorCQkJICAgaW5vZGUt
PmlfcHJpdmF0ZSk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5
MTVfZGlzcGxheXBvcnRfdGVzdF9hY3RpdmVfZm9wcyA9IHsKKwkub3duZXIgPSBUSElTX01PRFVM
RSwKKwkub3BlbiA9IGk5MTVfZGlzcGxheXBvcnRfdGVzdF9hY3RpdmVfb3BlbiwKKwkucmVhZCA9
IHNlcV9yZWFkLAorCS5sbHNlZWsgPSBzZXFfbHNlZWssCisJLnJlbGVhc2UgPSBzaW5nbGVfcmVs
ZWFzZSwKKwkud3JpdGUgPSBpOTE1X2Rpc3BsYXlwb3J0X3Rlc3RfYWN0aXZlX3dyaXRlCit9Owor
CitzdGF0aWMgaW50IGk5MTVfZGlzcGxheXBvcnRfdGVzdF9kYXRhX3Nob3coc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IG0tPnByaXZhdGU7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJt
OworCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CisJc3RydWN0IGRybV9jb25uZWN0
b3JfbGlzdF9pdGVyIGNvbm5faXRlcjsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOworCisJ
ZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfYmVnaW4oZGV2LCAmY29ubl9pdGVyKTsKKwlkcm1fZm9y
X2VhY2hfY29ubmVjdG9yX2l0ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7CisJCXN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyOworCisJCWlmIChjb25uZWN0b3ItPmNvbm5lY3Rvcl90eXBl
ICE9CisJCSAgICBEUk1fTU9ERV9DT05ORUNUT1JfRGlzcGxheVBvcnQpCisJCQljb250aW51ZTsK
KworCQllbmNvZGVyID0gdG9faW50ZWxfZW5jb2Rlcihjb25uZWN0b3ItPmVuY29kZXIpOworCQlp
ZiAoZW5jb2RlciAmJiBlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9EUF9NU1QpCisJCQlj
b250aW51ZTsKKworCQlpZiAoZW5jb2RlciAmJiBjb25uZWN0b3ItPnN0YXR1cyA9PSBjb25uZWN0
b3Jfc3RhdHVzX2Nvbm5lY3RlZCkgeworCQkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5j
b2Rlcik7CisJCQlpZiAoaW50ZWxfZHAtPmNvbXBsaWFuY2UudGVzdF90eXBlID09CisJCQkgICAg
RFBfVEVTVF9MSU5LX0VESURfUkVBRCkKKwkJCQlzZXFfcHJpbnRmKG0sICIlbHgiLAorCQkJCQkg
ICBpbnRlbF9kcC0+Y29tcGxpYW5jZS50ZXN0X2RhdGEuZWRpZCk7CisJCQllbHNlIGlmIChpbnRl
bF9kcC0+Y29tcGxpYW5jZS50ZXN0X3R5cGUgPT0KKwkJCQkgRFBfVEVTVF9MSU5LX1ZJREVPX1BB
VFRFUk4pIHsKKwkJCQlzZXFfcHJpbnRmKG0sICJoZGlzcGxheTogJWRcbiIsCisJCQkJCSAgIGlu
dGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfZGF0YS5oZGlzcGxheSk7CisJCQkJc2VxX3ByaW50Ziht
LCAidmRpc3BsYXk6ICVkXG4iLAorCQkJCQkgICBpbnRlbF9kcC0+Y29tcGxpYW5jZS50ZXN0X2Rh
dGEudmRpc3BsYXkpOworCQkJCXNlcV9wcmludGYobSwgImJwYzogJXVcbiIsCisJCQkJCSAgIGlu
dGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfZGF0YS5icGMpOworCQkJfQorCQl9IGVsc2UKKwkJCXNl
cV9wdXRzKG0sICIwIik7CisJfQorCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9p
dGVyKTsKKworCXJldHVybiAwOworfQorREVGSU5FX1NIT1dfQVRUUklCVVRFKGk5MTVfZGlzcGxh
eXBvcnRfdGVzdF9kYXRhKTsKKworc3RhdGljIGludCBpOTE1X2Rpc3BsYXlwb3J0X3Rlc3RfdHlw
ZV9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2YXRlOworCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwor
CXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3RfaXRlciBjb25uX2l0ZXI7CisJc3RydWN0IGludGVs
X2RwICppbnRlbF9kcDsKKworCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNv
bm5faXRlcik7CisJZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5f
aXRlcikgeworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKworCQlpZiAoY29ubmVj
dG9yLT5jb25uZWN0b3JfdHlwZSAhPQorCQkgICAgRFJNX01PREVfQ09OTkVDVE9SX0Rpc3BsYXlQ
b3J0KQorCQkJY29udGludWU7CisKKwkJZW5jb2RlciA9IHRvX2ludGVsX2VuY29kZXIoY29ubmVj
dG9yLT5lbmNvZGVyKTsKKwkJaWYgKGVuY29kZXIgJiYgZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9P
VVRQVVRfRFBfTVNUKQorCQkJY29udGludWU7CisKKwkJaWYgKGVuY29kZXIgJiYgY29ubmVjdG9y
LT5zdGF0dXMgPT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpIHsKKwkJCWludGVsX2RwID0g
ZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCQkJc2VxX3ByaW50ZihtLCAiJTAybHgiLCBpbnRl
bF9kcC0+Y29tcGxpYW5jZS50ZXN0X3R5cGUpOworCQl9IGVsc2UKKwkJCXNlcV9wdXRzKG0sICIw
Iik7CisJfQorCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKKworCXJl
dHVybiAwOworfQorREVGSU5FX1NIT1dfQVRUUklCVVRFKGk5MTVfZGlzcGxheXBvcnRfdGVzdF90
eXBlKTsKKworc3RhdGljIHZvaWQgd21fbGF0ZW5jeV9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwg
Y29uc3QgdTE2IHdtWzhdKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IG0tPnByaXZhdGU7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwor
CWludCBsZXZlbDsKKwlpbnQgbnVtX2xldmVsczsKKworCWlmIChJU19DSEVSUllWSUVXKGRldl9w
cml2KSkKKwkJbnVtX2xldmVscyA9IDM7CisJZWxzZSBpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJp
dikpCisJCW51bV9sZXZlbHMgPSAxOworCWVsc2UgaWYgKElTX0c0WChkZXZfcHJpdikpCisJCW51
bV9sZXZlbHMgPSAzOworCWVsc2UKKwkJbnVtX2xldmVscyA9IGlsa193bV9tYXhfbGV2ZWwoZGV2
X3ByaXYpICsgMTsKKworCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGRldik7CisKKwlmb3IgKGxldmVs
ID0gMDsgbGV2ZWwgPCBudW1fbGV2ZWxzOyBsZXZlbCsrKSB7CisJCXVuc2lnbmVkIGludCBsYXRl
bmN5ID0gd21bbGV2ZWxdOworCisJCS8qCisJCSAqIC0gV00xKyBsYXRlbmN5IHZhbHVlcyBpbiAw
LjV1cyB1bml0cworCQkgKiAtIGxhdGVuY2llcyBhcmUgaW4gdXMgb24gZ2VuOS92bHYvY2h2CisJ
CSAqLworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5IHx8CisJCSAgICBJU19WQUxMRVlW
SUVXKGRldl9wcml2KSB8fAorCQkgICAgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikgfHwKKwkJICAg
IElTX0c0WChkZXZfcHJpdikpCisJCQlsYXRlbmN5ICo9IDEwOworCQllbHNlIGlmIChsZXZlbCA+
IDApCisJCQlsYXRlbmN5ICo9IDU7CisKKwkJc2VxX3ByaW50ZihtLCAiV00lZCAldSAoJXUuJXUg
dXNlYylcbiIsCisJCQkgICBsZXZlbCwgd21bbGV2ZWxdLCBsYXRlbmN5IC8gMTAsIGxhdGVuY3kg
JSAxMCk7CisJfQorCisJZHJtX21vZGVzZXRfdW5sb2NrX2FsbChkZXYpOworfQorCitzdGF0aWMg
aW50IHByaV93bV9sYXRlbmN5X3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQor
eworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisJY29u
c3QgdTE2ICpsYXRlbmNpZXM7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCQls
YXRlbmNpZXMgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3k7CisJZWxzZQorCQlsYXRlbmNpZXMg
PSBkZXZfcHJpdi0+d20ucHJpX2xhdGVuY3k7CisKKwl3bV9sYXRlbmN5X3Nob3cobSwgbGF0ZW5j
aWVzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHNwcl93bV9sYXRlbmN5X3Nob3co
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisJY29uc3QgdTE2ICpsYXRlbmNpZXM7CisKKwlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+d20u
c2tsX2xhdGVuY3k7CisJZWxzZQorCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+d20uc3ByX2xhdGVu
Y3k7CisKKwl3bV9sYXRlbmN5X3Nob3cobSwgbGF0ZW5jaWVzKTsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IGN1cl93bV9sYXRlbmN5X3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lk
ICpkYXRhKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZh
dGU7CisJY29uc3QgdTE2ICpsYXRlbmNpZXM7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA5KQorCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3k7CisJZWxzZQorCQls
YXRlbmNpZXMgPSBkZXZfcHJpdi0+d20uY3VyX2xhdGVuY3k7CisKKwl3bV9sYXRlbmN5X3Nob3co
bSwgbGF0ZW5jaWVzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHByaV93bV9sYXRl
bmN5X29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gaW5vZGUtPmlfcHJpdmF0ZTsKKworCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNSAmJiAhSVNfRzRYKGRldl9wcml2KSkKKwkJcmV0dXJu
IC1FTk9ERVY7CisKKwlyZXR1cm4gc2luZ2xlX29wZW4oZmlsZSwgcHJpX3dtX2xhdGVuY3lfc2hv
dywgZGV2X3ByaXYpOworfQorCitzdGF0aWMgaW50IHNwcl93bV9sYXRlbmN5X29wZW4oc3RydWN0
IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gaW5vZGUtPmlfcHJpdmF0ZTsKKworCWlmIChIQVNfR01DSChkZXZf
cHJpdikpCisJCXJldHVybiAtRU5PREVWOworCisJcmV0dXJuIHNpbmdsZV9vcGVuKGZpbGUsIHNw
cl93bV9sYXRlbmN5X3Nob3csIGRldl9wcml2KTsKK30KKworc3RhdGljIGludCBjdXJfd21fbGF0
ZW5jeV9vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQoreworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGlub2RlLT5pX3ByaXZhdGU7CisKKwlp
ZiAoSEFTX0dNQ0goZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCXJldHVybiBzaW5n
bGVfb3BlbihmaWxlLCBjdXJfd21fbGF0ZW5jeV9zaG93LCBkZXZfcHJpdik7Cit9CisKK3N0YXRp
YyBzc2l6ZV90IHdtX2xhdGVuY3lfd3JpdGUoc3RydWN0IGZpbGUgKmZpbGUsIGNvbnN0IGNoYXIg
X191c2VyICp1YnVmLAorCQkJCXNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCwgdTE2IHdtWzhdKQor
eworCXN0cnVjdCBzZXFfZmlsZSAqbSA9IGZpbGUtPnByaXZhdGVfZGF0YTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2YXRlOworCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwl1MTYgbmV3WzhdID0geyAwIH07CisJaW50IG51bV9s
ZXZlbHM7CisJaW50IGxldmVsOworCWludCByZXQ7CisJY2hhciB0bXBbMzJdOworCisJaWYgKElT
X0NIRVJSWVZJRVcoZGV2X3ByaXYpKQorCQludW1fbGV2ZWxzID0gMzsKKwllbHNlIGlmIChJU19W
QUxMRVlWSUVXKGRldl9wcml2KSkKKwkJbnVtX2xldmVscyA9IDE7CisJZWxzZSBpZiAoSVNfRzRY
KGRldl9wcml2KSkKKwkJbnVtX2xldmVscyA9IDM7CisJZWxzZQorCQludW1fbGV2ZWxzID0gaWxr
X3dtX21heF9sZXZlbChkZXZfcHJpdikgKyAxOworCisJaWYgKGxlbiA+PSBzaXplb2YodG1wKSkK
KwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoY29weV9mcm9tX3VzZXIodG1wLCB1YnVmLCBsZW4p
KQorCQlyZXR1cm4gLUVGQVVMVDsKKworCXRtcFtsZW5dID0gJ1wwJzsKKworCXJldCA9IHNzY2Fu
Zih0bXAsICIlaHUgJWh1ICVodSAlaHUgJWh1ICVodSAlaHUgJWh1IiwKKwkJICAgICAmbmV3WzBd
LCAmbmV3WzFdLCAmbmV3WzJdLCAmbmV3WzNdLAorCQkgICAgICZuZXdbNF0sICZuZXdbNV0sICZu
ZXdbNl0sICZuZXdbN10pOworCWlmIChyZXQgIT0gbnVtX2xldmVscykKKwkJcmV0dXJuIC1FSU5W
QUw7CisKKwlkcm1fbW9kZXNldF9sb2NrX2FsbChkZXYpOworCisJZm9yIChsZXZlbCA9IDA7IGxl
dmVsIDwgbnVtX2xldmVsczsgbGV2ZWwrKykKKwkJd21bbGV2ZWxdID0gbmV3W2xldmVsXTsKKwor
CWRybV9tb2Rlc2V0X3VubG9ja19hbGwoZGV2KTsKKworCXJldHVybiBsZW47Cit9CisKKworc3Rh
dGljIHNzaXplX3QgcHJpX3dtX2xhdGVuY3lfd3JpdGUoc3RydWN0IGZpbGUgKmZpbGUsIGNvbnN0
IGNoYXIgX191c2VyICp1YnVmLAorCQkJCSAgICBzaXplX3QgbGVuLCBsb2ZmX3QgKm9mZnApCit7
CisJc3RydWN0IHNlcV9maWxlICptID0gZmlsZS0+cHJpdmF0ZV9kYXRhOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisJdTE2ICpsYXRlbmNpZXM7CisK
KwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+
d20uc2tsX2xhdGVuY3k7CisJZWxzZQorCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+d20ucHJpX2xh
dGVuY3k7CisKKwlyZXR1cm4gd21fbGF0ZW5jeV93cml0ZShmaWxlLCB1YnVmLCBsZW4sIG9mZnAs
IGxhdGVuY2llcyk7Cit9CisKK3N0YXRpYyBzc2l6ZV90IHNwcl93bV9sYXRlbmN5X3dyaXRlKHN0
cnVjdCBmaWxlICpmaWxlLCBjb25zdCBjaGFyIF9fdXNlciAqdWJ1ZiwKKwkJCQkgICAgc2l6ZV90
IGxlbiwgbG9mZl90ICpvZmZwKQoreworCXN0cnVjdCBzZXFfZmlsZSAqbSA9IGZpbGUtPnByaXZh
dGVfZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2YXRl
OworCXUxNiAqbGF0ZW5jaWVzOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwkJ
bGF0ZW5jaWVzID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5OworCWVsc2UKKwkJbGF0ZW5jaWVz
ID0gZGV2X3ByaXYtPndtLnNwcl9sYXRlbmN5OworCisJcmV0dXJuIHdtX2xhdGVuY3lfd3JpdGUo
ZmlsZSwgdWJ1ZiwgbGVuLCBvZmZwLCBsYXRlbmNpZXMpOworfQorCitzdGF0aWMgc3NpemVfdCBj
dXJfd21fbGF0ZW5jeV93cml0ZShzdHJ1Y3QgZmlsZSAqZmlsZSwgY29uc3QgY2hhciBfX3VzZXIg
KnVidWYsCisJCQkJICAgIHNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkKK3sKKwlzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0gPSBmaWxlLT5wcml2YXRlX2RhdGE7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKKwl1MTYgKmxhdGVuY2llczsKKworCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDkpCisJCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5j
eTsKKwllbHNlCisJCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5jdXJfbGF0ZW5jeTsKKworCXJl
dHVybiB3bV9sYXRlbmN5X3dyaXRlKGZpbGUsIHVidWYsIGxlbiwgb2ZmcCwgbGF0ZW5jaWVzKTsK
K30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9wcmlfd21fbGF0
ZW5jeV9mb3BzID0geworCS5vd25lciA9IFRISVNfTU9EVUxFLAorCS5vcGVuID0gcHJpX3dtX2xh
dGVuY3lfb3BlbiwKKwkucmVhZCA9IHNlcV9yZWFkLAorCS5sbHNlZWsgPSBzZXFfbHNlZWssCisJ
LnJlbGVhc2UgPSBzaW5nbGVfcmVsZWFzZSwKKwkud3JpdGUgPSBwcmlfd21fbGF0ZW5jeV93cml0
ZQorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9zcHJfd21f
bGF0ZW5jeV9mb3BzID0geworCS5vd25lciA9IFRISVNfTU9EVUxFLAorCS5vcGVuID0gc3ByX3dt
X2xhdGVuY3lfb3BlbiwKKwkucmVhZCA9IHNlcV9yZWFkLAorCS5sbHNlZWsgPSBzZXFfbHNlZWss
CisJLnJlbGVhc2UgPSBzaW5nbGVfcmVsZWFzZSwKKwkud3JpdGUgPSBzcHJfd21fbGF0ZW5jeV93
cml0ZQorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9jdXJf
d21fbGF0ZW5jeV9mb3BzID0geworCS5vd25lciA9IFRISVNfTU9EVUxFLAorCS5vcGVuID0gY3Vy
X3dtX2xhdGVuY3lfb3BlbiwKKwkucmVhZCA9IHNlcV9yZWFkLAorCS5sbHNlZWsgPSBzZXFfbHNl
ZWssCisJLnJlbGVhc2UgPSBzaW5nbGVfcmVsZWFzZSwKKwkud3JpdGUgPSBjdXJfd21fbGF0ZW5j
eV93cml0ZQorfTsKKworc3RhdGljIGludCBpOTE1X2hwZF9zdG9ybV9jdGxfc2hvdyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gbS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgaTkxNV9ob3RwbHVnICpob3RwbHVnID0gJmRl
dl9wcml2LT5ob3RwbHVnOworCisJLyogU3luY2hyb25pemUgd2l0aCBldmVyeXRoaW5nIGZpcnN0
IGluIGNhc2UgdGhlcmUncyBiZWVuIGFuIEhQRAorCSAqIHN0b3JtLCBidXQgd2UgaGF2ZW4ndCBm
aW5pc2hlZCBoYW5kbGluZyBpdCBpbiB0aGUga2VybmVsIHlldAorCSAqLworCWludGVsX3N5bmNo
cm9uaXplX2lycShkZXZfcHJpdik7CisJZmx1c2hfd29yaygmZGV2X3ByaXYtPmhvdHBsdWcuZGln
X3BvcnRfd29yayk7CisJZmx1c2hfZGVsYXllZF93b3JrKCZkZXZfcHJpdi0+aG90cGx1Zy5ob3Rw
bHVnX3dvcmspOworCisJc2VxX3ByaW50ZihtLCAiVGhyZXNob2xkOiAlZFxuIiwgaG90cGx1Zy0+
aHBkX3N0b3JtX3RocmVzaG9sZCk7CisJc2VxX3ByaW50ZihtLCAiRGV0ZWN0ZWQ6ICVzXG4iLAor
CQkgICB5ZXNubyhkZWxheWVkX3dvcmtfcGVuZGluZygmaG90cGx1Zy0+cmVlbmFibGVfd29yaykp
KTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgc3NpemVfdCBpOTE1X2hwZF9zdG9ybV9jdGxf
d3JpdGUoc3RydWN0IGZpbGUgKmZpbGUsCisJCQkJCWNvbnN0IGNoYXIgX191c2VyICp1YnVmLCBz
aXplX3QgbGVuLAorCQkJCQlsb2ZmX3QgKm9mZnApCit7CisJc3RydWN0IHNlcV9maWxlICptID0g
ZmlsZS0+cHJpdmF0ZV9kYXRhOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IG0tPnByaXZhdGU7CisJc3RydWN0IGk5MTVfaG90cGx1ZyAqaG90cGx1ZyA9ICZkZXZfcHJpdi0+
aG90cGx1ZzsKKwl1bnNpZ25lZCBpbnQgbmV3X3RocmVzaG9sZDsKKwlpbnQgaTsKKwljaGFyICpu
ZXdsaW5lOworCWNoYXIgdG1wWzE2XTsKKworCWlmIChsZW4gPj0gc2l6ZW9mKHRtcCkpCisJCXJl
dHVybiAtRUlOVkFMOworCisJaWYgKGNvcHlfZnJvbV91c2VyKHRtcCwgdWJ1ZiwgbGVuKSkKKwkJ
cmV0dXJuIC1FRkFVTFQ7CisKKwl0bXBbbGVuXSA9ICdcMCc7CisKKwkvKiBTdHJpcCBuZXdsaW5l
LCBpZiBhbnkgKi8KKwluZXdsaW5lID0gc3RyY2hyKHRtcCwgJ1xuJyk7CisJaWYgKG5ld2xpbmUp
CisJCSpuZXdsaW5lID0gJ1wwJzsKKworCWlmIChzdHJjbXAodG1wLCAicmVzZXQiKSA9PSAwKQor
CQluZXdfdGhyZXNob2xkID0gSFBEX1NUT1JNX0RFRkFVTFRfVEhSRVNIT0xEOworCWVsc2UgaWYg
KGtzdHJ0b3VpbnQodG1wLCAxMCwgJm5ld190aHJlc2hvbGQpICE9IDApCisJCXJldHVybiAtRUlO
VkFMOworCisJaWYgKG5ld190aHJlc2hvbGQgPiAwKQorCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKKwkJCSAgICAiU2V0dGluZyBIUEQgc3Rvcm0gZGV0ZWN0aW9uIHRocmVzaG9sZCB0byAl
ZFxuIiwKKwkJCSAgICBuZXdfdGhyZXNob2xkKTsKKwllbHNlCisJCWRybV9kYmdfa21zKCZkZXZf
cHJpdi0+ZHJtLCAiRGlzYWJsaW5nIEhQRCBzdG9ybSBkZXRlY3Rpb25cbiIpOworCisJc3Bpbl9s
b2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlob3RwbHVnLT5ocGRfc3Rvcm1fdGhyZXNo
b2xkID0gbmV3X3RocmVzaG9sZDsKKwkvKiBSZXNldCB0aGUgSFBEIHN0b3JtIHN0YXRzIHNvIHdl
IGRvbid0IGFjY2lkZW50YWxseSB0cmlnZ2VyIGEgc3Rvcm0gKi8KKwlmb3JfZWFjaF9ocGRfcGlu
KGkpCisJCWhvdHBsdWctPnN0YXRzW2ldLmNvdW50ID0gMDsKKwlzcGluX3VubG9ja19pcnEoJmRl
dl9wcml2LT5pcnFfbG9jayk7CisKKwkvKiBSZS1lbmFibGUgaHBkIGltbWVkaWF0ZWx5IGlmIHdl
IHdlcmUgaW4gYW4gaXJxIHN0b3JtICovCisJZmx1c2hfZGVsYXllZF93b3JrKCZkZXZfcHJpdi0+
aG90cGx1Zy5yZWVuYWJsZV93b3JrKTsKKworCXJldHVybiBsZW47Cit9CisKK3N0YXRpYyBpbnQg
aTkxNV9ocGRfc3Rvcm1fY3RsX29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUg
KmZpbGUpCit7CisJcmV0dXJuIHNpbmdsZV9vcGVuKGZpbGUsIGk5MTVfaHBkX3N0b3JtX2N0bF9z
aG93LCBpbm9kZS0+aV9wcml2YXRlKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29w
ZXJhdGlvbnMgaTkxNV9ocGRfc3Rvcm1fY3RsX2ZvcHMgPSB7CisJLm93bmVyID0gVEhJU19NT0RV
TEUsCisJLm9wZW4gPSBpOTE1X2hwZF9zdG9ybV9jdGxfb3BlbiwKKwkucmVhZCA9IHNlcV9yZWFk
LAorCS5sbHNlZWsgPSBzZXFfbHNlZWssCisJLnJlbGVhc2UgPSBzaW5nbGVfcmVsZWFzZSwKKwku
d3JpdGUgPSBpOTE1X2hwZF9zdG9ybV9jdGxfd3JpdGUKK307CisKK3N0YXRpYyBpbnQgaTkxNV9o
cGRfc2hvcnRfc3Rvcm1fY3RsX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQor
eworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CisKKwlz
ZXFfcHJpbnRmKG0sICJFbmFibGVkOiAlc1xuIiwKKwkJICAgeWVzbm8oZGV2X3ByaXYtPmhvdHBs
dWcuaHBkX3Nob3J0X3N0b3JtX2VuYWJsZWQpKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50CitpOTE1X2hwZF9zaG9ydF9zdG9ybV9jdGxfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBz
dHJ1Y3QgZmlsZSAqZmlsZSkKK3sKKwlyZXR1cm4gc2luZ2xlX29wZW4oZmlsZSwgaTkxNV9ocGRf
c2hvcnRfc3Rvcm1fY3RsX3Nob3csCisJCQkgICBpbm9kZS0+aV9wcml2YXRlKTsKK30KKworc3Rh
dGljIHNzaXplX3QgaTkxNV9ocGRfc2hvcnRfc3Rvcm1fY3RsX3dyaXRlKHN0cnVjdCBmaWxlICpm
aWxlLAorCQkJCQkgICAgICBjb25zdCBjaGFyIF9fdXNlciAqdWJ1ZiwKKwkJCQkJICAgICAgc2l6
ZV90IGxlbiwgbG9mZl90ICpvZmZwKQoreworCXN0cnVjdCBzZXFfZmlsZSAqbSA9IGZpbGUtPnBy
aXZhdGVfZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2
YXRlOworCXN0cnVjdCBpOTE1X2hvdHBsdWcgKmhvdHBsdWcgPSAmZGV2X3ByaXYtPmhvdHBsdWc7
CisJY2hhciAqbmV3bGluZTsKKwljaGFyIHRtcFsxNl07CisJaW50IGk7CisJYm9vbCBuZXdfc3Rh
dGU7CisKKwlpZiAobGVuID49IHNpemVvZih0bXApKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlm
IChjb3B5X2Zyb21fdXNlcih0bXAsIHVidWYsIGxlbikpCisJCXJldHVybiAtRUZBVUxUOworCisJ
dG1wW2xlbl0gPSAnXDAnOworCisJLyogU3RyaXAgbmV3bGluZSwgaWYgYW55ICovCisJbmV3bGlu
ZSA9IHN0cmNocih0bXAsICdcbicpOworCWlmIChuZXdsaW5lKQorCQkqbmV3bGluZSA9ICdcMCc7
CisKKwkvKiBSZXNldCB0byB0aGUgImRlZmF1bHQiIHN0YXRlIGZvciB0aGlzIHN5c3RlbSAqLwor
CWlmIChzdHJjbXAodG1wLCAicmVzZXQiKSA9PSAwKQorCQluZXdfc3RhdGUgPSAhSEFTX0RQX01T
VChkZXZfcHJpdik7CisJZWxzZSBpZiAoa3N0cnRvYm9vbCh0bXAsICZuZXdfc3RhdGUpICE9IDAp
CisJCXJldHVybiAtRUlOVkFMOworCisJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICIlc2Fi
bGluZyBIUEQgc2hvcnQgc3Rvcm0gZGV0ZWN0aW9uXG4iLAorCQkgICAgbmV3X3N0YXRlID8gIkVu
IiA6ICJEaXMiKTsKKworCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJaG90
cGx1Zy0+aHBkX3Nob3J0X3N0b3JtX2VuYWJsZWQgPSBuZXdfc3RhdGU7CisJLyogUmVzZXQgdGhl
IEhQRCBzdG9ybSBzdGF0cyBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgdHJpZ2dlciBhIHN0b3Jt
ICovCisJZm9yX2VhY2hfaHBkX3BpbihpKQorCQlob3RwbHVnLT5zdGF0c1tpXS5jb3VudCA9IDA7
CisJc3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCisJLyogUmUtZW5hYmxl
IGhwZCBpbW1lZGlhdGVseSBpZiB3ZSB3ZXJlIGluIGFuIGlycSBzdG9ybSAqLworCWZsdXNoX2Rl
bGF5ZWRfd29yaygmZGV2X3ByaXYtPmhvdHBsdWcucmVlbmFibGVfd29yayk7CisKKwlyZXR1cm4g
bGVuOworfQorCitzdGF0aWMgY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBpOTE1X2hwZF9z
aG9ydF9zdG9ybV9jdGxfZm9wcyA9IHsKKwkub3duZXIgPSBUSElTX01PRFVMRSwKKwkub3BlbiA9
IGk5MTVfaHBkX3Nob3J0X3N0b3JtX2N0bF9vcGVuLAorCS5yZWFkID0gc2VxX3JlYWQsCisJLmxs
c2VlayA9IHNlcV9sc2VlaywKKwkucmVsZWFzZSA9IHNpbmdsZV9yZWxlYXNlLAorCS53cml0ZSA9
IGk5MTVfaHBkX3Nob3J0X3N0b3JtX2N0bF93cml0ZSwKK307CisKK3N0YXRpYyBpbnQgaTkxNV9k
cnJzX2N0bF9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBkYXRhOworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3By
aXYtPmRybTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKworCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpIDwgNykKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlmb3JfZWFjaF9pbnRlbF9jcnRjKGRl
diwgY3J0YykgeworCQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOwor
CQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwkJc3RydWN0IGRybV9jb25u
ZWN0b3IgKmNvbm5lY3RvcjsKKwkJc3RydWN0IGRybV9jcnRjX2NvbW1pdCAqY29tbWl0OworCQlp
bnQgcmV0OworCisJCXJldCA9IGRybV9tb2Rlc2V0X2xvY2tfc2luZ2xlX2ludGVycnVwdGlibGUo
JmNydGMtPmJhc2UubXV0ZXgpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQljcnRj
X3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKKworCQlpZiAo
IWNydGNfc3RhdGUtPmh3LmFjdGl2ZSB8fAorCQkgICAgIWNydGNfc3RhdGUtPmhhc19kcnJzKQor
CQkJZ290byBvdXQ7CisKKwkJY29tbWl0ID0gY3J0Y19zdGF0ZS0+dWFwaS5jb21taXQ7CisJCWlm
IChjb21taXQpIHsKKwkJCXJldCA9IHdhaXRfZm9yX2NvbXBsZXRpb25faW50ZXJydXB0aWJsZSgm
Y29tbWl0LT5od19kb25lKTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBvdXQ7CisJCX0KKworCQlk
cm1fY29ubmVjdG9yX2xpc3RfaXRlcl9iZWdpbihkZXYsICZjb25uX2l0ZXIpOworCQlkcm1fZm9y
X2VhY2hfY29ubmVjdG9yX2l0ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7CisJCQlzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKwkJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHA7CisK
KwkJCWlmICghKGNydGNfc3RhdGUtPnVhcGkuY29ubmVjdG9yX21hc2sgJgorCQkJICAgICAgZHJt
X2Nvbm5lY3Rvcl9tYXNrKGNvbm5lY3RvcikpKQorCQkJCWNvbnRpbnVlOworCisJCQllbmNvZGVy
ID0gaW50ZWxfYXR0YWNoZWRfZW5jb2Rlcih0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKSk7
CisJCQlpZiAoZW5jb2Rlci0+dHlwZSAhPSBJTlRFTF9PVVRQVVRfRURQKQorCQkJCWNvbnRpbnVl
OworCisJCQlkcm1fZGJnKCZkZXZfcHJpdi0+ZHJtLAorCQkJCSJNYW51YWxseSAlc2FibGluZyBE
UlJTLiAlbGx1XG4iLAorCQkJCXZhbCA/ICJlbiIgOiAiZGlzIiwgdmFsKTsKKworCQkJaW50ZWxf
ZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisJCQlpZiAodmFsKQorCQkJCWludGVsX2Vk
cF9kcnJzX2VuYWJsZShpbnRlbF9kcCwKKwkJCQkJCSAgICAgIGNydGNfc3RhdGUpOworCQkJZWxz
ZQorCQkJCWludGVsX2VkcF9kcnJzX2Rpc2FibGUoaW50ZWxfZHAsCisJCQkJCQkgICAgICAgY3J0
Y19zdGF0ZSk7CisJCX0KKwkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2l0ZXIp
OworCitvdXQ6CisJCWRybV9tb2Rlc2V0X3VubG9jaygmY3J0Yy0+YmFzZS5tdXRleCk7CisJCWlm
IChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQorCitERUZJTkVfU0lN
UExFX0FUVFJJQlVURShpOTE1X2RycnNfY3RsX2ZvcHMsIE5VTEwsIGk5MTVfZHJyc19jdGxfc2V0
LCAiJWxsdVxuIik7CisKK3N0YXRpYyBzc2l6ZV90CitpOTE1X2ZpZm9fdW5kZXJydW5fcmVzZXRf
d3JpdGUoc3RydWN0IGZpbGUgKmZpbHAsCisJCQkgICAgICAgY29uc3QgY2hhciBfX3VzZXIgKnVi
dWYsCisJCQkgICAgICAgc2l6ZV90IGNudCwgbG9mZl90ICpwcG9zKQoreworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGZpbHAtPnByaXZhdGVfZGF0YTsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YzsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2
LT5kcm07CisJaW50IHJldDsKKwlib29sIHJlc2V0OworCisJcmV0ID0ga3N0cnRvYm9vbF9mcm9t
X3VzZXIodWJ1ZiwgY250LCAmcmVzZXQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlp
ZiAoIXJlc2V0KQorCQlyZXR1cm4gY250OworCisJZm9yX2VhY2hfaW50ZWxfY3J0YyhkZXYsIGlu
dGVsX2NydGMpIHsKKwkJc3RydWN0IGRybV9jcnRjX2NvbW1pdCAqY29tbWl0OworCQlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKworCQlyZXQgPSBkcm1fbW9kZXNldF9sb2Nr
X3NpbmdsZV9pbnRlcnJ1cHRpYmxlKCZpbnRlbF9jcnRjLT5iYXNlLm11dGV4KTsKKwkJaWYgKHJl
dCkKKwkJCXJldHVybiByZXQ7CisKKwkJY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUo
aW50ZWxfY3J0Yy0+YmFzZS5zdGF0ZSk7CisJCWNvbW1pdCA9IGNydGNfc3RhdGUtPnVhcGkuY29t
bWl0OworCQlpZiAoY29tbWl0KSB7CisJCQlyZXQgPSB3YWl0X2Zvcl9jb21wbGV0aW9uX2ludGVy
cnVwdGlibGUoJmNvbW1pdC0+aHdfZG9uZSk7CisJCQlpZiAoIXJldCkKKwkJCQlyZXQgPSB3YWl0
X2Zvcl9jb21wbGV0aW9uX2ludGVycnVwdGlibGUoJmNvbW1pdC0+ZmxpcF9kb25lKTsKKwkJfQor
CisJCWlmICghcmV0ICYmIGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgeworCQkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sCisJCQkJICAgICJSZS1hcm1pbmcgRklGTyB1bmRlcnJ1bnMgb24gcGlw
ZSAlY1xuIiwKKwkJCQkgICAgcGlwZV9uYW1lKGludGVsX2NydGMtPnBpcGUpKTsKKworCQkJaW50
ZWxfY3J0Y19hcm1fZmlmb191bmRlcnJ1bihpbnRlbF9jcnRjLCBjcnRjX3N0YXRlKTsKKwkJfQor
CisJCWRybV9tb2Rlc2V0X3VubG9jaygmaW50ZWxfY3J0Yy0+YmFzZS5tdXRleCk7CisKKwkJaWYg
KHJldCkKKwkJCXJldHVybiByZXQ7CisJfQorCisJcmV0ID0gaW50ZWxfZmJjX3Jlc2V0X3VuZGVy
cnVuKGRldl9wcml2KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0dXJuIGNudDsK
K30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9maWZvX3VuZGVy
cnVuX3Jlc2V0X29wcyA9IHsKKwkub3duZXIgPSBUSElTX01PRFVMRSwKKwkub3BlbiA9IHNpbXBs
ZV9vcGVuLAorCS53cml0ZSA9IGk5MTVfZmlmb191bmRlcnJ1bl9yZXNldF93cml0ZSwKKwkubGxz
ZWVrID0gZGVmYXVsdF9sbHNlZWssCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9pbmZv
X2xpc3QgaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzX2xpc3RbXSA9IHsKKwl7Imk5MTVfZGRiX2luZm8i
LCBpOTE1X2RkYl9pbmZvLCAwfSwKKwl7Imk5MTVfZGlzcGxheV9pbmZvIiwgaTkxNV9kaXNwbGF5
X2luZm8sIDB9LAorCXsiaTkxNV9kcF9tc3RfaW5mbyIsIGk5MTVfZHBfbXN0X2luZm8sIDB9LAor
CXsiaTkxNV9kcnJzX3N0YXR1cyIsIGk5MTVfZHJyc19zdGF0dXMsIDB9LAorCXsiaTkxNV9lZHBf
cHNyX3N0YXR1cyIsIGk5MTVfZWRwX3Bzcl9zdGF0dXMsIDB9LAorCXsiaTkxNV9mYmNfc3RhdHVz
IiwgaTkxNV9mYmNfc3RhdHVzLCAwfSwKKwl7Imk5MTVfaXBzX3N0YXR1cyIsIGk5MTVfaXBzX3N0
YXR1cywgMH0sCisJeyJpOTE1X29wcmVnaW9uIiwgaTkxNV9vcHJlZ2lvbiwgMH0sCisJeyJpOTE1
X3NoYXJlZF9kcGxsc19pbmZvIiwgaTkxNV9zaGFyZWRfZHBsbHNfaW5mbywgMH0sCisJeyJpOTE1
X3NyX3N0YXR1cyIsIGk5MTVfc3Jfc3RhdHVzLCAwfSwKKwl7Imk5MTVfdmJ0IiwgaTkxNV92YnQs
IDB9LAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCB7CisJY29uc3QgY2hhciAqbmFtZTsKKwlj
b25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zICpmb3BzOworfSBpbnRlbF9kaXNwbGF5X2RlYnVn
ZnNfZmlsZXNbXSA9IHsKKwl7Imk5MTVfY3VyX3dtX2xhdGVuY3kiLCAmaTkxNV9jdXJfd21fbGF0
ZW5jeV9mb3BzfSwKKwl7Imk5MTVfZHBfdGVzdF9hY3RpdmUiLCAmaTkxNV9kaXNwbGF5cG9ydF90
ZXN0X2FjdGl2ZV9mb3BzfSwKKwl7Imk5MTVfZHBfdGVzdF9kYXRhIiwgJmk5MTVfZGlzcGxheXBv
cnRfdGVzdF9kYXRhX2ZvcHN9LAorCXsiaTkxNV9kcF90ZXN0X3R5cGUiLCAmaTkxNV9kaXNwbGF5
cG9ydF90ZXN0X3R5cGVfZm9wc30sCisJeyJpOTE1X2RycnNfY3RsIiwgJmk5MTVfZHJyc19jdGxf
Zm9wc30sCisJeyJpOTE1X2VkcF9wc3JfZGVidWciLCAmaTkxNV9lZHBfcHNyX2RlYnVnX2ZvcHN9
LAorCXsiaTkxNV9mYmNfZmFsc2VfY29sb3IiLCAmaTkxNV9mYmNfZmFsc2VfY29sb3JfZm9wc30s
CisJeyJpOTE1X2ZpZm9fdW5kZXJydW5fcmVzZXQiLCAmaTkxNV9maWZvX3VuZGVycnVuX3Jlc2V0
X29wc30sCisJeyJpOTE1X2hwZF9zaG9ydF9zdG9ybV9jdGwiLCAmaTkxNV9ocGRfc2hvcnRfc3Rv
cm1fY3RsX2ZvcHN9LAorCXsiaTkxNV9ocGRfc3Rvcm1fY3RsIiwgJmk5MTVfaHBkX3N0b3JtX2N0
bF9mb3BzfSwKKwl7Imk5MTVfcHJpX3dtX2xhdGVuY3kiLCAmaTkxNV9wcmlfd21fbGF0ZW5jeV9m
b3BzfSwKKwl7Imk5MTVfc3ByX3dtX2xhdGVuY3kiLCAmaTkxNV9zcHJfd21fbGF0ZW5jeV9mb3Bz
fSwKK307CisKK2ludCBpbnRlbF9kaXNwbGF5X2RlYnVnZnNfcmVnaXN0ZXIoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RydWN0IGRybV9taW5vciAqbWlub3IgPSBpOTE1LT5k
cm0ucHJpbWFyeTsKKwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGludGVs
X2Rpc3BsYXlfZGVidWdmc19maWxlcyk7IGkrKykgeworCQlkZWJ1Z2ZzX2NyZWF0ZV9maWxlKGlu
dGVsX2Rpc3BsYXlfZGVidWdmc19maWxlc1tpXS5uYW1lLAorCQkJCSAgICBTX0lSVUdPIHwgU19J
V1VTUiwKKwkJCQkgICAgbWlub3ItPmRlYnVnZnNfcm9vdCwKKwkJCQkgICAgdG9faTkxNShtaW5v
ci0+ZGV2KSwKKwkJCQkgICAgaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzX2ZpbGVzW2ldLmZvcHMpOwor
CX0KKworCXJldHVybiBkcm1fZGVidWdmc19jcmVhdGVfZmlsZXMoaW50ZWxfZGlzcGxheV9kZWJ1
Z2ZzX2xpc3QsCisJCQkJCUFSUkFZX1NJWkUoaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzX2xpc3QpLAor
CQkJCQltaW5vci0+ZGVidWdmc19yb290LCBtaW5vcik7Cit9CisKK3N0YXRpYyBpbnQgaTkxNV9w
YW5lbF9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwID0KKwkJaW50ZWxfYXR0YWNoZWRfZHAodG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3Rv
cikpOworCisJaWYgKGNvbm5lY3Rvci0+c3RhdHVzICE9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVj
dGVkKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCXNlcV9wcmludGYobSwgIlBhbmVsIHBvd2VyIHVw
IGRlbGF5OiAlZFxuIiwKKwkJICAgaW50ZWxfZHAtPnBhbmVsX3Bvd2VyX3VwX2RlbGF5KTsKKwlz
ZXFfcHJpbnRmKG0sICJQYW5lbCBwb3dlciBkb3duIGRlbGF5OiAlZFxuIiwKKwkJICAgaW50ZWxf
ZHAtPnBhbmVsX3Bvd2VyX2Rvd25fZGVsYXkpOworCXNlcV9wcmludGYobSwgIkJhY2tsaWdodCBv
biBkZWxheTogJWRcbiIsCisJCSAgIGludGVsX2RwLT5iYWNrbGlnaHRfb25fZGVsYXkpOworCXNl
cV9wcmludGYobSwgIkJhY2tsaWdodCBvZmYgZGVsYXk6ICVkXG4iLAorCQkgICBpbnRlbF9kcC0+
YmFja2xpZ2h0X29mZl9kZWxheSk7CisKKwlyZXR1cm4gMDsKK30KK0RFRklORV9TSE9XX0FUVFJJ
QlVURShpOTE1X3BhbmVsKTsKKworc3RhdGljIGludCBpOTE1X2hkY3Bfc2lua19jYXBhYmlsaXR5
X3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IgPSBtLT5wcml2YXRlOworCXN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmludGVsX2Nvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uZWN0b3IpOworCisJaWYg
KGNvbm5lY3Rvci0+c3RhdHVzICE9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkKQorCQlyZXR1
cm4gLUVOT0RFVjsKKworCS8qIEhEQ1AgaXMgc3VwcG9ydGVkIGJ5IGNvbm5lY3RvciAqLworCWlm
ICghaW50ZWxfY29ubmVjdG9yLT5oZGNwLnNoaW0pCisJCXJldHVybiAtRUlOVkFMOworCisJc2Vx
X3ByaW50ZihtLCAiJXM6JWQgSERDUCB2ZXJzaW9uOiAiLCBjb25uZWN0b3ItPm5hbWUsCisJCSAg
IGNvbm5lY3Rvci0+YmFzZS5pZCk7CisJaW50ZWxfaGRjcF9pbmZvKG0sIGludGVsX2Nvbm5lY3Rv
cik7CisKKwlyZXR1cm4gMDsKK30KK0RFRklORV9TSE9XX0FUVFJJQlVURShpOTE1X2hkY3Bfc2lu
a19jYXBhYmlsaXR5KTsKKworc3RhdGljIGludCBpOTE1X2RzY19mZWNfc3VwcG9ydF9zaG93KHN0
cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAq
Y29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY29ubmVj
dG9yLT5kZXY7CisJc3RydWN0IGRybV9jcnRjICpjcnRjOworCXN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHA7CisJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVpcmVfY3R4IGN0eDsKKwlzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IE5VTEw7CisJaW50IHJldCA9IDA7CisJYm9vbCB0
cnlfYWdhaW4gPSBmYWxzZTsKKworCWRybV9tb2Rlc2V0X2FjcXVpcmVfaW5pdCgmY3R4LCBEUk1f
TU9ERVNFVF9BQ1FVSVJFX0lOVEVSUlVQVElCTEUpOworCisJZG8geworCQl0cnlfYWdhaW4gPSBm
YWxzZTsKKwkJcmV0ID0gZHJtX21vZGVzZXRfbG9jaygmZGV2LT5tb2RlX2NvbmZpZy5jb25uZWN0
aW9uX211dGV4LAorCQkJCSAgICAgICAmY3R4KTsKKwkJaWYgKHJldCkgeworCQkJaWYgKHJldCA9
PSAtRURFQURMSyAmJiAhZHJtX21vZGVzZXRfYmFja29mZigmY3R4KSkgeworCQkJCXRyeV9hZ2Fp
biA9IHRydWU7CisJCQkJY29udGludWU7CisJCQl9CisJCQlicmVhazsKKwkJfQorCQljcnRjID0g
Y29ubmVjdG9yLT5zdGF0ZS0+Y3J0YzsKKwkJaWYgKGNvbm5lY3Rvci0+c3RhdHVzICE9IGNvbm5l
Y3Rvcl9zdGF0dXNfY29ubmVjdGVkIHx8ICFjcnRjKSB7CisJCQlyZXQgPSAtRU5PREVWOworCQkJ
YnJlYWs7CisJCX0KKwkJcmV0ID0gZHJtX21vZGVzZXRfbG9jaygmY3J0Yy0+bXV0ZXgsICZjdHgp
OworCQlpZiAocmV0ID09IC1FREVBRExLKSB7CisJCQlyZXQgPSBkcm1fbW9kZXNldF9iYWNrb2Zm
KCZjdHgpOworCQkJaWYgKCFyZXQpIHsKKwkJCQl0cnlfYWdhaW4gPSB0cnVlOworCQkJCWNvbnRp
bnVlOworCQkJfQorCQkJYnJlYWs7CisJCX0gZWxzZSBpZiAocmV0KSB7CisJCQlicmVhazsKKwkJ
fQorCQlpbnRlbF9kcCA9IGludGVsX2F0dGFjaGVkX2RwKHRvX2ludGVsX2Nvbm5lY3Rvcihjb25u
ZWN0b3IpKTsKKwkJY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+c3RhdGUp
OworCQlzZXFfcHJpbnRmKG0sICJEU0NfRW5hYmxlZDogJXNcbiIsCisJCQkgICB5ZXNubyhjcnRj
X3N0YXRlLT5kc2MuY29tcHJlc3Npb25fZW5hYmxlKSk7CisJCXNlcV9wcmludGYobSwgIkRTQ19T
aW5rX1N1cHBvcnQ6ICVzXG4iLAorCQkJICAgeWVzbm8oZHJtX2RwX3Npbmtfc3VwcG9ydHNfZHNj
KGludGVsX2RwLT5kc2NfZHBjZCkpKTsKKwkJc2VxX3ByaW50ZihtLCAiRm9yY2VfRFNDX0VuYWJs
ZTogJXNcbiIsCisJCQkgICB5ZXNubyhpbnRlbF9kcC0+Zm9yY2VfZHNjX2VuKSk7CisJCWlmICgh
aW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKKwkJCXNlcV9wcmludGYobSwgIkZFQ19TaW5rX1N1
cHBvcnQ6ICVzXG4iLAorCQkJCSAgIHllc25vKGRybV9kcF9zaW5rX3N1cHBvcnRzX2ZlYyhpbnRl
bF9kcC0+ZmVjX2NhcGFibGUpKSk7CisJfSB3aGlsZSAodHJ5X2FnYWluKTsKKworCWRybV9tb2Rl
c2V0X2Ryb3BfbG9ja3MoJmN0eCk7CisJZHJtX21vZGVzZXRfYWNxdWlyZV9maW5pKCZjdHgpOwor
CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHNzaXplX3QgaTkxNV9kc2NfZmVjX3N1cHBvcnRf
d3JpdGUoc3RydWN0IGZpbGUgKmZpbGUsCisJCQkJCSAgY29uc3QgY2hhciBfX3VzZXIgKnVidWYs
CisJCQkJCSAgc2l6ZV90IGxlbiwgbG9mZl90ICpvZmZwKQoreworCWJvb2wgZHNjX2VuYWJsZSA9
IGZhbHNlOworCWludCByZXQ7CisJc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9CisJ
CSgoc3RydWN0IHNlcV9maWxlICopZmlsZS0+cHJpdmF0ZV9kYXRhKS0+cHJpdmF0ZTsKKwlzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9IGludGVsX2F0dGFjaGVkX2VuY29kZXIodG9faW50
ZWxfY29ubmVjdG9yKGNvbm5lY3RvcikpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKworCWlmIChsZW4gPT0gMCkKKwkJcmV0dXJu
IDA7CisKKwlkcm1fZGJnKCZpOTE1LT5kcm0sCisJCSJDb3BpZWQgJXp1IGJ5dGVzIGZyb20gdXNl
ciB0byBmb3JjZSBEU0NcbiIsIGxlbik7CisKKwlyZXQgPSBrc3RydG9ib29sX2Zyb21fdXNlcih1
YnVmLCBsZW4sICZkc2NfZW5hYmxlKTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKwor
CWRybV9kYmcoJmk5MTUtPmRybSwgIkdvdCAlcyBmb3IgRFNDIEVuYWJsZVxuIiwKKwkJKGRzY19l
bmFibGUpID8gInRydWUiIDogImZhbHNlIik7CisJaW50ZWxfZHAtPmZvcmNlX2RzY19lbiA9IGRz
Y19lbmFibGU7CisKKwkqb2ZmcCArPSBsZW47CisJcmV0dXJuIGxlbjsKK30KKworc3RhdGljIGlu
dCBpOTE1X2RzY19mZWNfc3VwcG9ydF9vcGVuKHN0cnVjdCBpbm9kZSAqaW5vZGUsCisJCQkJICAg
ICBzdHJ1Y3QgZmlsZSAqZmlsZSkKK3sKKwlyZXR1cm4gc2luZ2xlX29wZW4oZmlsZSwgaTkxNV9k
c2NfZmVjX3N1cHBvcnRfc2hvdywKKwkJCSAgIGlub2RlLT5pX3ByaXZhdGUpOworfQorCitzdGF0
aWMgY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBpOTE1X2RzY19mZWNfc3VwcG9ydF9mb3Bz
ID0geworCS5vd25lciA9IFRISVNfTU9EVUxFLAorCS5vcGVuID0gaTkxNV9kc2NfZmVjX3N1cHBv
cnRfb3BlbiwKKwkucmVhZCA9IHNlcV9yZWFkLAorCS5sbHNlZWsgPSBzZXFfbHNlZWssCisJLnJl
bGVhc2UgPSBzaW5nbGVfcmVsZWFzZSwKKwkud3JpdGUgPSBpOTE1X2RzY19mZWNfc3VwcG9ydF93
cml0ZQorfTsKKworLyoqCisgKiBpbnRlbF9jb25uZWN0b3JfZGVidWdmc19hZGQgLSBhZGQgaTkx
NSBzcGVjaWZpYyBjb25uZWN0b3IgZGVidWdmcyBmaWxlcworICogQGNvbm5lY3RvcjogcG9pbnRl
ciB0byBhIHJlZ2lzdGVyZWQgZHJtX2Nvbm5lY3RvcgorICoKKyAqIENsZWFudXAgd2lsbCBiZSBk
b25lIGJ5IGRybV9jb25uZWN0b3JfdW5yZWdpc3RlcigpIHRocm91Z2ggYSBjYWxsIHRvCisgKiBk
cm1fZGVidWdmc19jb25uZWN0b3JfcmVtb3ZlKCkuCisgKgorICogUmV0dXJucyAwIG9uIHN1Y2Nl
c3MsIG5lZ2F0aXZlIGVycm9yIGNvZGVzIG9uIGVycm9yLgorICovCitpbnQgaW50ZWxfY29ubmVj
dG9yX2RlYnVnZnNfYWRkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCit7CisJc3Ry
dWN0IGRlbnRyeSAqcm9vdCA9IGNvbm5lY3Rvci0+ZGVidWdmc19lbnRyeTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKKworCS8q
IFRoZSBjb25uZWN0b3IgbXVzdCBoYXZlIGJlZW4gcmVnaXN0ZXJlZCBiZWZvcmVoYW5kcy4gKi8K
KwlpZiAoIXJvb3QpCisJCXJldHVybiAtRU5PREVWOworCisJaWYgKGNvbm5lY3Rvci0+Y29ubmVj
dG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVDVE9SX2VEUCkgeworCQlkZWJ1Z2ZzX2NyZWF0ZV9m
aWxlKCJpOTE1X3BhbmVsX3RpbWluZ3MiLCBTX0lSVUdPLCByb290LAorCQkJCSAgICBjb25uZWN0
b3IsICZpOTE1X3BhbmVsX2ZvcHMpOworCQlkZWJ1Z2ZzX2NyZWF0ZV9maWxlKCJpOTE1X3Bzcl9z
aW5rX3N0YXR1cyIsIFNfSVJVR08sIHJvb3QsCisJCQkJICAgIGNvbm5lY3RvciwgJmk5MTVfcHNy
X3Npbmtfc3RhdHVzX2ZvcHMpOworCX0KKworCWlmIChjb25uZWN0b3ItPmNvbm5lY3Rvcl90eXBl
ID09IERSTV9NT0RFX0NPTk5FQ1RPUl9EaXNwbGF5UG9ydCB8fAorCSAgICBjb25uZWN0b3ItPmNv
bm5lY3Rvcl90eXBlID09IERSTV9NT0RFX0NPTk5FQ1RPUl9IRE1JQSB8fAorCSAgICBjb25uZWN0
b3ItPmNvbm5lY3Rvcl90eXBlID09IERSTV9NT0RFX0NPTk5FQ1RPUl9IRE1JQikgeworCQlkZWJ1
Z2ZzX2NyZWF0ZV9maWxlKCJpOTE1X2hkY3Bfc2lua19jYXBhYmlsaXR5IiwgU19JUlVHTywgcm9v
dCwKKwkJCQkgICAgY29ubmVjdG9yLCAmaTkxNV9oZGNwX3NpbmtfY2FwYWJpbGl0eV9mb3BzKTsK
Kwl9CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCAmJgorCSAgICAoY29ubmVjdG9y
LT5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNUT1JfRGlzcGxheVBvcnQgfHwKKwkg
ICAgIGNvbm5lY3Rvci0+Y29ubmVjdG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVDVE9SX2VEUCkp
CisJCWRlYnVnZnNfY3JlYXRlX2ZpbGUoImk5MTVfZHNjX2ZlY19zdXBwb3J0IiwgU19JUlVHTywg
cm9vdCwKKwkJCQkgICAgY29ubmVjdG9yLCAmaTkxNV9kc2NfZmVjX3N1cHBvcnRfZm9wcyk7CisK
KwlyZXR1cm4gMDsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfZGVidWdmcy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uYTNiZWExY2UwNGMyCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuaApAQCAtMCwwICsxLDIwIEBACisvKiBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjAg
SW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIF9fSU5URUxfRElTUExBWV9ERUJVR0ZT
X0hfXworI2RlZmluZSBfX0lOVEVMX0RJU1BMQVlfREVCVUdGU19IX18KKworc3RydWN0IGRybV9j
b25uZWN0b3I7CitzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKKworI2lmZGVmIENPTkZJR19ERUJV
R19GUworaW50IGludGVsX2Rpc3BsYXlfZGVidWdmc19yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSk7CitpbnQgaW50ZWxfY29ubmVjdG9yX2RlYnVnZnNfYWRkKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IpOworI2Vsc2UKK3N0YXRpYyBpbmxpbmUgaW50IGludGVs
X2Rpc3BsYXlfZGVidWdmc19yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkg
eyByZXR1cm4gMDsgfQorc3RhdGljIGlubGluZSBpbnQgaW50ZWxfY29ubmVjdG9yX2RlYnVnZnNf
YWRkKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpIHsgcmV0dXJuIDA7IH0KKyNlbmRp
ZgorCisjZW5kaWYgLyogX19JTlRFTF9ESVNQTEFZX0RFQlVHRlNfSF9fICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKaW5kZXggZjRkZWRlNjI1M2Y4Li45NTQxYWIxMTYy
NGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKQEAgLTQ5LDYgKzQ5
LDcgQEAKICNpbmNsdWRlICJpbnRlbF9hdWRpby5oIgogI2luY2x1ZGUgImludGVsX2Nvbm5lY3Rv
ci5oIgogI2luY2x1ZGUgImludGVsX2RkaS5oIgorI2luY2x1ZGUgImludGVsX2Rpc3BsYXlfZGVi
dWdmcy5oIgogI2luY2x1ZGUgImludGVsX2Rpc3BsYXlfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRl
bF9kcC5oIgogI2luY2x1ZGUgImludGVsX2RwX2xpbmtfdHJhaW5pbmcuaCIKQEAgLTU4NTEsNyAr
NTg1Miw3IEBAIGludGVsX2RwX2Nvbm5lY3Rvcl9yZWdpc3RlcihzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlpOTE1X2RlYnVnZnNf
Y29ubmVjdG9yX2FkZChjb25uZWN0b3IpOworCWludGVsX2Nvbm5lY3Rvcl9kZWJ1Z2ZzX2FkZChj
b25uZWN0b3IpOwogCiAJRFJNX0RFQlVHX0tNUygicmVnaXN0ZXJpbmcgJXMgYnVzIGZvciAlc1xu
IiwKIAkJICAgICAgaW50ZWxfZHAtPmF1eC5uYW1lLCBjb25uZWN0b3ItPmtkZXYtPmtvYmoubmFt
ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2hkbWku
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRtaS5jCmluZGV4IGU2OGJh
ZmI3NmNiMS4uYTNhNWNmZTQ5YWJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2hkbWkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2hkbWkuYwpAQCAtNDUsNiArNDUsNyBAQAogI2luY2x1ZGUgImludGVsX2F1ZGlvLmgiCiAj
aW5jbHVkZSAiaW50ZWxfY29ubmVjdG9yLmgiCiAjaW5jbHVkZSAiaW50ZWxfZGRpLmgiCisjaW5j
bHVkZSAiaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmgiCiAjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV90
eXBlcy5oIgogI2luY2x1ZGUgImludGVsX2RwLmgiCiAjaW5jbHVkZSAiaW50ZWxfZHBpb19waHku
aCIKQEAgLTI4MjMsNyArMjgyNCw3IEBAIGludGVsX2hkbWlfY29ubmVjdG9yX3JlZ2lzdGVyKHN0
cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IAotCWk5MTVfZGVidWdmc19jb25uZWN0b3JfYWRkKGNvbm5lY3Rvcik7CisJaW50ZWxfY29ubmVj
dG9yX2RlYnVnZnNfYWRkKGNvbm5lY3Rvcik7CiAKIAlpbnRlbF9oZG1pX2NyZWF0ZV9pMmNfc3lt
bGluayhjb25uZWN0b3IpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IGMz
MTNjOTA0MDVjYi4uN2QxZDNkMTZjMDllIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YwpAQCAtMTIzMiwxNDAgKzEyMzIsNiBAQCBzdGF0aWMgaW50IGk5MTVfZnJvbnRidWZmZXJfdHJh
Y2tpbmcoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJcmV0dXJuIDA7CiB9CiAK
LXN0YXRpYyBpbnQgaTkxNV9mYmNfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51
c2VkKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkx
NShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsK
LQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQotCWlmICghSEFTX0ZCQyhkZXZfcHJpdikpCi0J
CXJldHVybiAtRU5PREVWOwotCi0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZkZXZf
cHJpdi0+cnVudGltZV9wbSk7Ci0JbXV0ZXhfbG9jaygmZmJjLT5sb2NrKTsKLQotCWlmIChpbnRl
bF9mYmNfaXNfYWN0aXZlKGRldl9wcml2KSkKLQkJc2VxX3B1dHMobSwgIkZCQyBlbmFibGVkXG4i
KTsKLQllbHNlCi0JCXNlcV9wcmludGYobSwgIkZCQyBkaXNhYmxlZDogJXNcbiIsIGZiYy0+bm9f
ZmJjX3JlYXNvbik7Ci0KLQlpZiAoaW50ZWxfZmJjX2lzX2FjdGl2ZShkZXZfcHJpdikpIHsKLQkJ
dTMyIG1hc2s7Ci0KLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKLQkJCW1hc2sgPSBJ
OTE1X1JFQUQoSVZCX0ZCQ19TVEFUVVMyKSAmIEJEV19GQkNfQ09NUF9TRUdfTUFTSzsKLQkJZWxz
ZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA3KQotCQkJbWFzayA9IEk5MTVfUkVBRChJVkJf
RkJDX1NUQVRVUzIpICYgSVZCX0ZCQ19DT01QX1NFR19NQVNLOwotCQllbHNlIGlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDUpCi0JCQltYXNrID0gSTkxNV9SRUFEKElMS19EUEZDX1NUQVRVUykg
JiBJTEtfRFBGQ19DT01QX1NFR19NQVNLOwotCQllbHNlIGlmIChJU19HNFgoZGV2X3ByaXYpKQot
CQkJbWFzayA9IEk5MTVfUkVBRChEUEZDX1NUQVRVUykgJiBEUEZDX0NPTVBfU0VHX01BU0s7Ci0J
CWVsc2UKLQkJCW1hc2sgPSBJOTE1X1JFQUQoRkJDX1NUQVRVUykgJiAoRkJDX1NUQVRfQ09NUFJF
U1NJTkcgfAotCQkJCQkJCUZCQ19TVEFUX0NPTVBSRVNTRUQpOwotCi0JCXNlcV9wcmludGYobSwg
IkNvbXByZXNzaW5nOiAlc1xuIiwgeWVzbm8obWFzaykpOwotCX0KLQotCW11dGV4X3VubG9jaygm
ZmJjLT5sb2NrKTsKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0s
IHdha2VyZWYpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9mYmNfZmFsc2Vf
Y29sb3JfZ2V0KHZvaWQgKmRhdGEsIHU2NCAqdmFsKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRhdGE7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDcgfHwg
IUhBU19GQkMoZGV2X3ByaXYpKQotCQlyZXR1cm4gLUVOT0RFVjsKLQotCSp2YWwgPSBkZXZfcHJp
di0+ZmJjLmZhbHNlX2NvbG9yOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9m
YmNfZmFsc2VfY29sb3Jfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsKLQl1MzIgcmVnOwotCi0JaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPCA3IHx8ICFIQVNfRkJDKGRldl9wcml2KSkKLQkJcmV0dXJuIC1FTk9ERVY7
Ci0KLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZmJjLmxvY2spOwotCi0JcmVnID0gSTkxNV9SRUFE
KElMS19EUEZDX0NPTlRST0wpOwotCWRldl9wcml2LT5mYmMuZmFsc2VfY29sb3IgPSB2YWw7Ci0K
LQlJOTE1X1dSSVRFKElMS19EUEZDX0NPTlRST0wsIHZhbCA/Ci0JCSAgIChyZWcgfCBGQkNfQ1RM
X0ZBTFNFX0NPTE9SKSA6Ci0JCSAgIChyZWcgJiB+RkJDX0NUTF9GQUxTRV9DT0xPUikpOwotCi0J
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZmJjLmxvY2spOwotCXJldHVybiAwOwotfQotCi1ERUZJ
TkVfU0lNUExFX0FUVFJJQlVURShpOTE1X2ZiY19mYWxzZV9jb2xvcl9mb3BzLAotCQkJaTkxNV9m
YmNfZmFsc2VfY29sb3JfZ2V0LCBpOTE1X2ZiY19mYWxzZV9jb2xvcl9zZXQsCi0JCQkiJWxsdVxu
Iik7Ci0KLXN0YXRpYyBpbnQgaTkxNV9pcHNfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9p
ZCAqdW51c2VkKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVf
dG9faTkxNShtLT5wcml2YXRlKTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQotCWlmICgh
SEFTX0lQUyhkZXZfcHJpdikpCi0JCXJldHVybiAtRU5PREVWOwotCi0Jd2FrZXJlZiA9IGludGVs
X3J1bnRpbWVfcG1fZ2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7Ci0KLQlzZXFfcHJpbnRmKG0s
ICJFbmFibGVkIGJ5IGtlcm5lbCBwYXJhbWV0ZXI6ICVzXG4iLAotCQkgICB5ZXNubyhpOTE1X21v
ZHBhcmFtcy5lbmFibGVfaXBzKSk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KSB7
Ci0JCXNlcV9wdXRzKG0sICJDdXJyZW50bHk6IHVua25vd25cbiIpOwotCX0gZWxzZSB7Ci0JCWlm
IChJOTE1X1JFQUQoSVBTX0NUTCkgJiBJUFNfRU5BQkxFKQotCQkJc2VxX3B1dHMobSwgIkN1cnJl
bnRseTogZW5hYmxlZFxuIik7Ci0JCWVsc2UKLQkJCXNlcV9wdXRzKG0sICJDdXJyZW50bHk6IGRp
c2FibGVkXG4iKTsKLQl9Ci0KLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRp
bWVfcG0sIHdha2VyZWYpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9zcl9z
dGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCWludGVs
X3dha2VyZWZfdCB3YWtlcmVmOwotCWJvb2wgc3JfZW5hYmxlZCA9IGZhbHNlOwotCi0Jd2FrZXJl
ZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGRldl9wcml2LCBQT1dFUl9ET01BSU5fSU5JVCk7
Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQotCQkvKiBubyBnbG9iYWwgU1Igc3Rh
dHVzOyBpbnNwZWN0IHBlci1wbGFuZSBXTSAqLzsKLQllbHNlIGlmIChIQVNfUENIX1NQTElUKGRl
dl9wcml2KSkKLQkJc3JfZW5hYmxlZCA9IEk5MTVfUkVBRChXTTFfTFBfSUxLKSAmIFdNMV9MUF9T
Ul9FTjsKLQllbHNlIGlmIChJU19JOTY1R00oZGV2X3ByaXYpIHx8IElTX0c0WChkZXZfcHJpdikg
fHwKLQkJIElTX0k5NDVHKGRldl9wcml2KSB8fCBJU19JOTQ1R00oZGV2X3ByaXYpKQotCQlzcl9l
bmFibGVkID0gSTkxNV9SRUFEKEZXX0JMQ19TRUxGKSAmIEZXX0JMQ19TRUxGX0VOOwotCWVsc2Ug
aWYgKElTX0k5MTVHTShkZXZfcHJpdikpCi0JCXNyX2VuYWJsZWQgPSBJOTE1X1JFQUQoSU5TVFBN
KSAmIElOU1RQTV9TRUxGX0VOOwotCWVsc2UgaWYgKElTX1BJTkVWSUVXKGRldl9wcml2KSkKLQkJ
c3JfZW5hYmxlZCA9IEk5MTVfUkVBRChEU1BGVzMpICYgUElORVZJRVdfU0VMRl9SRUZSRVNIX0VO
OwotCWVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2
X3ByaXYpKQotCQlzcl9lbmFibGVkID0gSTkxNV9SRUFEKEZXX0JMQ19TRUxGX1ZMVikgJiBGV19D
U1BXUkRXTkVOOwotCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIFBPV0VSX0RP
TUFJTl9JTklULCB3YWtlcmVmKTsKLQotCXNlcV9wcmludGYobSwgInNlbGYtcmVmcmVzaDogJXNc
biIsIGVuYWJsZWRkaXNhYmxlZChzcl9lbmFibGVkKSk7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3Rh
dGljIGludCBpOTE1X3JpbmdfZnJlcV90YWJsZShzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVu
dXNlZCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5
MTUobS0+cHJpdmF0ZSk7CkBAIC0xNDA3LDI2ICsxMjczLDYgQEAgc3RhdGljIGludCBpOTE1X3Jp
bmdfZnJlcV90YWJsZShzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIAlyZXR1cm4g
MDsKIH0KIAotc3RhdGljIGludCBpOTE1X29wcmVnaW9uKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9p
ZCAqdW51c2VkKQotewotCXN0cnVjdCBpbnRlbF9vcHJlZ2lvbiAqb3ByZWdpb24gPSAmbm9kZV90
b19pOTE1KG0tPnByaXZhdGUpLT5vcHJlZ2lvbjsKLQotCWlmIChvcHJlZ2lvbi0+aGVhZGVyKQot
CQlzZXFfd3JpdGUobSwgb3ByZWdpb24tPmhlYWRlciwgT1BSRUdJT05fU0laRSk7Ci0KLQlyZXR1
cm4gMDsKLX0KLQotc3RhdGljIGludCBpOTE1X3ZidChzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KnVudXNlZCkKLXsKLQlzdHJ1Y3QgaW50ZWxfb3ByZWdpb24gKm9wcmVnaW9uID0gJm5vZGVfdG9f
aTkxNShtLT5wcml2YXRlKS0+b3ByZWdpb247Ci0KLQlpZiAob3ByZWdpb24tPnZidCkKLQkJc2Vx
X3dyaXRlKG0sIG9wcmVnaW9uLT52YnQsIG9wcmVnaW9uLT52YnRfc2l6ZSk7Ci0KLQlyZXR1cm4g
MDsKLX0KLQogc3RhdGljIGludCBpOTE1X2dlbV9mcmFtZWJ1ZmZlcl9pbmZvKHN0cnVjdCBzZXFf
ZmlsZSAqbSwgdm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CkBAIC0xOTY0LDIzMCArMTgxMCw2IEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVfZ3VjX2xvZ19yZWxheV9mb3Bz
ID0gewogCS5yZWxlYXNlID0gaTkxNV9ndWNfbG9nX3JlbGF5X3JlbGVhc2UsCiB9OwogCi1zdGF0
aWMgaW50IGk5MTVfcHNyX3Npbmtfc3RhdHVzX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lk
ICpkYXRhKQotewotCXU4IHZhbDsKLQlzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IHNpbmtfc3Rh
dHVzW10gPSB7Ci0JCSJpbmFjdGl2ZSIsCi0JCSJ0cmFuc2l0aW9uIHRvIGFjdGl2ZSwgY2FwdHVy
ZSBhbmQgZGlzcGxheSIsCi0JCSJhY3RpdmUsIGRpc3BsYXkgZnJvbSBSRkIiLAotCQkiYWN0aXZl
LCBjYXB0dXJlIGFuZCBkaXNwbGF5IG9uIHNpbmsgZGV2aWNlIHRpbWluZ3MiLAotCQkidHJhbnNp
dGlvbiB0byBpbmFjdGl2ZSwgY2FwdHVyZSBhbmQgZGlzcGxheSwgdGltaW5nIHJlLXN5bmMiLAot
CQkicmVzZXJ2ZWQiLAotCQkicmVzZXJ2ZWQiLAotCQkic2luayBpbnRlcm5hbCBlcnJvciIsCi0J
fTsKLQlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsK
LQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KLQkJaW50ZWxfYXR0YWNoZWRfZHAodG9faW50
ZWxfY29ubmVjdG9yKGNvbm5lY3RvcikpOwotCWludCByZXQ7Ci0KLQlpZiAoIUNBTl9QU1IoZGV2
X3ByaXYpKSB7Ci0JCXNlcV9wdXRzKG0sICJQU1IgVW5zdXBwb3J0ZWRcbiIpOwotCQlyZXR1cm4g
LUVOT0RFVjsKLQl9Ci0KLQlpZiAoY29ubmVjdG9yLT5zdGF0dXMgIT0gY29ubmVjdG9yX3N0YXR1
c19jb25uZWN0ZWQpCi0JCXJldHVybiAtRU5PREVWOwotCi0JcmV0ID0gZHJtX2RwX2RwY2RfcmVh
ZGIoJmludGVsX2RwLT5hdXgsIERQX1BTUl9TVEFUVVMsICZ2YWwpOwotCi0JaWYgKHJldCA9PSAx
KSB7Ci0JCWNvbnN0IGNoYXIgKnN0ciA9ICJ1bmtub3duIjsKLQotCQl2YWwgJj0gRFBfUFNSX1NJ
TktfU1RBVEVfTUFTSzsKLQkJaWYgKHZhbCA8IEFSUkFZX1NJWkUoc2lua19zdGF0dXMpKQotCQkJ
c3RyID0gc2lua19zdGF0dXNbdmFsXTsKLQkJc2VxX3ByaW50ZihtLCAiU2luayBQU1Igc3RhdHVz
OiAweCV4IFslc11cbiIsIHZhbCwgc3RyKTsKLQl9IGVsc2UgewotCQlyZXR1cm4gcmV0OwotCX0K
LQotCXJldHVybiAwOwotfQotREVGSU5FX1NIT1dfQVRUUklCVVRFKGk5MTVfcHNyX3Npbmtfc3Rh
dHVzKTsKLQotc3RhdGljIHZvaWQKLXBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNlcV9maWxlICptKQotewotCXUzMiB2YWwsIHN0YXR1
c192YWw7Ci0JY29uc3QgY2hhciAqc3RhdHVzID0gInVua25vd24iOwotCi0JaWYgKGRldl9wcml2
LT5wc3IucHNyMl9lbmFibGVkKSB7Ci0JCXN0YXRpYyBjb25zdCBjaGFyICogY29uc3QgbGl2ZV9z
dGF0dXNbXSA9IHsKLQkJCSJJRExFIiwKLQkJCSJDQVBUVVJFIiwKLQkJCSJDQVBUVVJFX0ZTIiwK
LQkJCSJTTEVFUCIsCi0JCQkiQlVGT05fRlciLAotCQkJIk1MX1VQIiwKLQkJCSJTVV9TVEFOREJZ
IiwKLQkJCSJGQVNUX1NMRUVQIiwKLQkJCSJERUVQX1NMRUVQIiwKLQkJCSJCVUZfT04iLAotCQkJ
IlRHX09OIgotCQl9OwotCQl2YWwgPSBJOTE1X1JFQUQoRURQX1BTUjJfU1RBVFVTKGRldl9wcml2
LT5wc3IudHJhbnNjb2RlcikpOwotCQlzdGF0dXNfdmFsID0gKHZhbCAmIEVEUF9QU1IyX1NUQVRV
U19TVEFURV9NQVNLKSA+PgotCQkJICAgICAgRURQX1BTUjJfU1RBVFVTX1NUQVRFX1NISUZUOwot
CQlpZiAoc3RhdHVzX3ZhbCA8IEFSUkFZX1NJWkUobGl2ZV9zdGF0dXMpKQotCQkJc3RhdHVzID0g
bGl2ZV9zdGF0dXNbc3RhdHVzX3ZhbF07Ci0JfSBlbHNlIHsKLQkJc3RhdGljIGNvbnN0IGNoYXIg
KiBjb25zdCBsaXZlX3N0YXR1c1tdID0gewotCQkJIklETEUiLAotCQkJIlNSRE9OQUNLIiwKLQkJ
CSJTUkRFTlQiLAotCQkJIkJVRk9GRiIsCi0JCQkiQlVGT04iLAotCQkJIkFVWEFDSyIsCi0JCQki
U1JET0ZGQUNLIiwKLQkJCSJTUkRFTlRfT04iLAotCQl9OwotCQl2YWwgPSBJOTE1X1JFQUQoRURQ
X1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7Ci0JCXN0YXR1c192YWwgPSAo
dmFsICYgRURQX1BTUl9TVEFUVVNfU1RBVEVfTUFTSykgPj4KLQkJCSAgICAgIEVEUF9QU1JfU1RB
VFVTX1NUQVRFX1NISUZUOwotCQlpZiAoc3RhdHVzX3ZhbCA8IEFSUkFZX1NJWkUobGl2ZV9zdGF0
dXMpKQotCQkJc3RhdHVzID0gbGl2ZV9zdGF0dXNbc3RhdHVzX3ZhbF07Ci0JfQotCi0Jc2VxX3By
aW50ZihtLCAiU291cmNlIFBTUiBzdGF0dXM6ICVzIFsweCUwOHhdXG4iLCBzdGF0dXMsIHZhbCk7
Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHZvaWQgKmRhdGEpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9k
ZV90b19pOTE1KG0tPnByaXZhdGUpOwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2
LT5wc3I7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0JY29uc3QgY2hhciAqc3RhdHVzOwot
CWJvb2wgZW5hYmxlZDsKLQl1MzIgdmFsOwotCi0JaWYgKCFIQVNfUFNSKGRldl9wcml2KSkKLQkJ
cmV0dXJuIC1FTk9ERVY7Ci0KLQlzZXFfcHJpbnRmKG0sICJTaW5rIHN1cHBvcnQ6ICVzIiwgeWVz
bm8ocHNyLT5zaW5rX3N1cHBvcnQpKTsKLQlpZiAocHNyLT5kcCkKLQkJc2VxX3ByaW50ZihtLCAi
IFsweCUwMnhdIiwgcHNyLT5kcC0+cHNyX2RwY2RbMF0pOwotCXNlcV9wdXRzKG0sICJcbiIpOwot
Ci0JaWYgKCFwc3ItPnNpbmtfc3VwcG9ydCkKLQkJcmV0dXJuIDA7Ci0KLQl3YWtlcmVmID0gaW50
ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKLQltdXRleF9sb2NrKCZw
c3ItPmxvY2spOwotCi0JaWYgKHBzci0+ZW5hYmxlZCkKLQkJc3RhdHVzID0gcHNyLT5wc3IyX2Vu
YWJsZWQgPyAiUFNSMiBlbmFibGVkIiA6ICJQU1IxIGVuYWJsZWQiOwotCWVsc2UKLQkJc3RhdHVz
ID0gImRpc2FibGVkIjsKLQlzZXFfcHJpbnRmKG0sICJQU1IgbW9kZTogJXNcbiIsIHN0YXR1cyk7
Ci0KLQlpZiAoIXBzci0+ZW5hYmxlZCkgewotCQlzZXFfcHJpbnRmKG0sICJQU1Igc2luayBub3Qg
cmVsaWFibGU6ICVzXG4iLAotCQkJICAgeWVzbm8ocHNyLT5zaW5rX25vdF9yZWxpYWJsZSkpOwot
Ci0JCWdvdG8gdW5sb2NrOwotCX0KLQotCWlmIChwc3ItPnBzcjJfZW5hYmxlZCkgewotCQl2YWwg
PSBJOTE1X1JFQUQoRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOwotCQll
bmFibGVkID0gdmFsICYgRURQX1BTUjJfRU5BQkxFOwotCX0gZWxzZSB7Ci0JCXZhbCA9IEk5MTVf
UkVBRChFRFBfUFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKLQkJZW5hYmxlZCA9
IHZhbCAmIEVEUF9QU1JfRU5BQkxFOwotCX0KLQlzZXFfcHJpbnRmKG0sICJTb3VyY2UgUFNSIGN0
bDogJXMgWzB4JTA4eF1cbiIsCi0JCSAgIGVuYWJsZWRkaXNhYmxlZChlbmFibGVkKSwgdmFsKTsK
LQlwc3Jfc291cmNlX3N0YXR1cyhkZXZfcHJpdiwgbSk7Ci0Jc2VxX3ByaW50ZihtLCAiQnVzeSBm
cm9udGJ1ZmZlciBiaXRzOiAweCUwOHhcbiIsCi0JCSAgIHBzci0+YnVzeV9mcm9udGJ1ZmZlcl9i
aXRzKTsKLQotCS8qCi0JICogU0tMKyBQZXJmIGNvdW50ZXIgaXMgcmVzZXQgdG8gMCBldmVyeXRp
bWUgREMgc3RhdGUgaXMgZW50ZXJlZAotCSAqLwotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8
fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7Ci0JCXZhbCA9IEk5MTVfUkVBRChFRFBfUFNSX1BF
UkZfQ05UKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOwotCQl2YWwgJj0gRURQX1BTUl9QRVJG
X0NOVF9NQVNLOwotCQlzZXFfcHJpbnRmKG0sICJQZXJmb3JtYW5jZSBjb3VudGVyOiAldVxuIiwg
dmFsKTsKLQl9Ci0KLQlpZiAocHNyLT5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX0lSUSkgewotCQlz
ZXFfcHJpbnRmKG0sICJMYXN0IGF0dGVtcHRlZCBlbnRyeSBhdDogJWxsZFxuIiwKLQkJCSAgIHBz
ci0+bGFzdF9lbnRyeV9hdHRlbXB0KTsKLQkJc2VxX3ByaW50ZihtLCAiTGFzdCBleGl0IGF0OiAl
bGxkXG4iLCBwc3ItPmxhc3RfZXhpdCk7Ci0JfQotCi0JaWYgKHBzci0+cHNyMl9lbmFibGVkKSB7
Ci0JCXUzMiBzdV9mcmFtZXNfdmFsWzNdOwotCQlpbnQgZnJhbWU7Ci0KLQkJLyoKLQkJICogUmVh
ZGluZyBhbGwgMyByZWdpc3RlcnMgYmVmb3JlIGhhbmQgdG8gbWluaW1pemUgY3Jvc3NpbmcgYQot
CQkgKiBmcmFtZSBib3VuZGFyeSBiZXR3ZWVuIHJlZ2lzdGVyIHJlYWRzCi0JCSAqLwotCQlmb3Ig
KGZyYW1lID0gMDsgZnJhbWUgPCBQU1IyX1NVX1NUQVRVU19GUkFNRVM7IGZyYW1lICs9IDMpIHsK
LQkJCXZhbCA9IEk5MTVfUkVBRChQU1IyX1NVX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29k
ZXIsCi0JCQkJCQkgICAgICAgZnJhbWUpKTsKLQkJCXN1X2ZyYW1lc192YWxbZnJhbWUgLyAzXSA9
IHZhbDsKLQkJfQotCi0JCXNlcV9wdXRzKG0sICJGcmFtZTpcdFBTUjIgU1UgYmxvY2tzOlxuIik7
Ci0KLQkJZm9yIChmcmFtZSA9IDA7IGZyYW1lIDwgUFNSMl9TVV9TVEFUVVNfRlJBTUVTOyBmcmFt
ZSsrKSB7Ci0JCQl1MzIgc3VfYmxvY2tzOwotCi0JCQlzdV9ibG9ja3MgPSBzdV9mcmFtZXNfdmFs
W2ZyYW1lIC8gM10gJgotCQkJCSAgICBQU1IyX1NVX1NUQVRVU19NQVNLKGZyYW1lKTsKLQkJCXN1
X2Jsb2NrcyA9IHN1X2Jsb2NrcyA+PiBQU1IyX1NVX1NUQVRVU19TSElGVChmcmFtZSk7Ci0JCQlz
ZXFfcHJpbnRmKG0sICIlZFx0JWRcbiIsIGZyYW1lLCBzdV9ibG9ja3MpOwotCQl9Ci0JfQotCi11
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZwc3ItPmxvY2spOwotCWludGVsX3J1bnRpbWVfcG1fcHV0
KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3Rh
dGljIGludAotaTkxNV9lZHBfcHNyX2RlYnVnX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQotewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7Ci0JaW50ZWxfd2FrZXJl
Zl90IHdha2VyZWY7Ci0JaW50IHJldDsKLQotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJl
dHVybiAtRU5PREVWOwotCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJTZXR0aW5nIFBT
UiBkZWJ1ZyB0byAlbGx4XG4iLCB2YWwpOwotCi0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1f
Z2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7Ci0KLQlyZXQgPSBpbnRlbF9wc3JfZGVidWdfc2V0
KGRldl9wcml2LCB2YWwpOwotCi0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50
aW1lX3BtLCB3YWtlcmVmKTsKLQotCXJldHVybiByZXQ7Ci19Ci0KLXN0YXRpYyBpbnQKLWk5MTVf
ZWRwX3Bzcl9kZWJ1Z19nZXQodm9pZCAqZGF0YSwgdTY0ICp2YWwpCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsKLQotCWlmICghQ0FOX1BTUihkZXZfcHJpdikp
Ci0JCXJldHVybiAtRU5PREVWOwotCi0JKnZhbCA9IFJFQURfT05DRShkZXZfcHJpdi0+cHNyLmRl
YnVnKTsKLQlyZXR1cm4gMDsKLX0KLQotREVGSU5FX1NJTVBMRV9BVFRSSUJVVEUoaTkxNV9lZHBf
cHNyX2RlYnVnX2ZvcHMsCi0JCQlpOTE1X2VkcF9wc3JfZGVidWdfZ2V0LCBpOTE1X2VkcF9wc3Jf
ZGVidWdfc2V0LAotCQkJIiVsbHVcbiIpOwotCiBzdGF0aWMgaW50IGk5MTVfZW5lcmd5X3VKKHN0
cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CkBAIC0yMzI2LDExMjMgKzE5
NDgsMTI5IEBAIHN0YXRpYyBpbnQgaTkxNV9kbWNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZv
aWQgKnVudXNlZCkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfc2VxX3ByaW50
X21vZGUoc3RydWN0IHNlcV9maWxlICptLCBpbnQgdGFicywKLQkJCQkgY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKm1vZGUpCitzdGF0aWMgaW50IGk5MTVfZW5naW5lX2luZm8oc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiB7Ci0JaW50IGk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKKwlzdHJ1
Y3QgZHJtX3ByaW50ZXIgcDsKKworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmZGV2
X3ByaXYtPnJ1bnRpbWVfcG0pOworCisJc2VxX3ByaW50ZihtLCAiR1QgYXdha2U/ICVzIFslZF1c
biIsCisJCSAgIHllc25vKGRldl9wcml2LT5ndC5hd2FrZSksCisJCSAgIGF0b21pY19yZWFkKCZk
ZXZfcHJpdi0+Z3Qud2FrZXJlZi5jb3VudCkpOworCXNlcV9wcmludGYobSwgIkNTIHRpbWVzdGFt
cCBmcmVxdWVuY3k6ICV1IGtIelxuIiwKKwkJICAgUlVOVElNRV9JTkZPKGRldl9wcml2KS0+Y3Nf
dGltZXN0YW1wX2ZyZXF1ZW5jeV9raHopOworCisJcCA9IGRybV9zZXFfZmlsZV9wcmludGVyKG0p
OworCWZvcl9lYWNoX3VhYmlfZW5naW5lKGVuZ2luZSwgZGV2X3ByaXYpCisJCWludGVsX2VuZ2lu
ZV9kdW1wKGVuZ2luZSwgJnAsICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKIAotCWZvciAoaSA9IDA7
IGkgPCB0YWJzOyBpKyspCi0JCXNlcV9wdXRjKG0sICdcdCcpOworCWludGVsX3J1bnRpbWVfcG1f
cHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAKLQlzZXFfcHJpbnRmKG0sIERS
TV9NT0RFX0ZNVCAiXG4iLCBEUk1fTU9ERV9BUkcobW9kZSkpOworCXJldHVybiAwOwogfQogCi1z
dGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyX2luZm8oc3RydWN0IHNlcV9maWxlICptLAotCQkJICAg
ICAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJICAgICAgIHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyKQorc3RhdGljIGludCBpOTE1X3Jjc190b3BvbG9neShzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGRybV9jb25uZWN0b3JfbGlz
dF9pdGVyIGNvbm5faXRlcjsKLQlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwotCi0J
c2VxX3ByaW50ZihtLCAiXHRbRU5DT0RFUjolZDolc106IGNvbm5lY3RvcnM6XG4iLAotCQkgICBl
bmNvZGVyLT5iYXNlLmJhc2UuaWQsIGVuY29kZXItPmJhc2UubmFtZSk7Ci0KLQlkcm1fY29ubmVj
dG9yX2xpc3RfaXRlcl9iZWdpbigmZGV2X3ByaXYtPmRybSwgJmNvbm5faXRlcik7Ci0JZHJtX2Zv
cl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5faXRlcikgewotCQljb25zdCBz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSA9Ci0JCQljb25uZWN0b3ItPnN0
YXRlOworCXN0cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX3NlcV9maWxlX3ByaW50ZXIobSk7CiAK
LQkJaWYgKGNvbm5fc3RhdGUtPmJlc3RfZW5jb2RlciAhPSAmZW5jb2Rlci0+YmFzZSkKLQkJCWNv
bnRpbnVlOworCWludGVsX2RldmljZV9pbmZvX3ByaW50X3RvcG9sb2d5KCZSVU5USU1FX0lORk8o
ZGV2X3ByaXYpLT5zc2V1LCAmcCk7CiAKLQkJc2VxX3ByaW50ZihtLCAiXHRcdFtDT05ORUNUT1I6
JWQ6JXNdXG4iLAotCQkJICAgY29ubmVjdG9yLT5iYXNlLmlkLCBjb25uZWN0b3ItPm5hbWUpOwot
CX0KLQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5faXRlcik7CisJcmV0dXJuIDA7
CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3BhbmVsX2luZm8oc3RydWN0IHNlcV9maWxlICptLCBz
dHJ1Y3QgaW50ZWxfcGFuZWwgKnBhbmVsKQorc3RhdGljIGludCBpOTE1X3Nocmlua2VyX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKm1vZGUgPSBwYW5lbC0+Zml4ZWRfbW9kZTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKworCXNlcV9wcmludGYo
bSwgInNlZWtzID0gJWRcbiIsIGk5MTUtPm1tLnNocmlua2VyLnNlZWtzKTsKKwlzZXFfcHJpbnRm
KG0sICJiYXRjaCA9ICVsdVxuIiwgaTkxNS0+bW0uc2hyaW5rZXIuYmF0Y2gpOwogCi0Jc2VxX3By
aW50ZihtLCAiXHRmaXhlZCBtb2RlOiAiIERSTV9NT0RFX0ZNVCAiXG4iLCBEUk1fTU9ERV9BUkco
bW9kZSkpOworCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9oZGNwX2luZm8oc3Ry
dWN0IHNlcV9maWxlICptLAotCQkJICAgIHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nv
bm5lY3RvcikKK3N0YXRpYyBpbnQgaTkxNV93YV9yZWdpc3RlcnMoc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICp1bnVzZWQpCiB7Ci0JYm9vbCBoZGNwX2NhcCwgaGRjcDJfY2FwOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAotCWhkY3BfY2FwID0gaW50ZWxfaGRjcF9jYXBh
YmxlKGludGVsX2Nvbm5lY3Rvcik7Ci0JaGRjcDJfY2FwID0gaW50ZWxfaGRjcDJfY2FwYWJsZShp
bnRlbF9jb25uZWN0b3IpOworCWZvcl9lYWNoX3VhYmlfZW5naW5lKGVuZ2luZSwgaTkxNSkgewor
CQljb25zdCBzdHJ1Y3QgaTkxNV93YV9saXN0ICp3YWwgPSAmZW5naW5lLT5jdHhfd2FfbGlzdDsK
KwkJY29uc3Qgc3RydWN0IGk5MTVfd2EgKndhOworCQl1bnNpZ25lZCBpbnQgY291bnQ7CiAKLQlp
ZiAoaGRjcF9jYXApCi0JCXNlcV9wdXRzKG0sICJIRENQMS40ICIpOwotCWlmIChoZGNwMl9jYXAp
Ci0JCXNlcV9wdXRzKG0sICJIRENQMi4yICIpOworCQljb3VudCA9IHdhbC0+Y291bnQ7CisJCWlm
ICghY291bnQpCisJCQljb250aW51ZTsKIAotCWlmICghaGRjcF9jYXAgJiYgIWhkY3AyX2NhcCkK
LQkJc2VxX3B1dHMobSwgIk5vbmUiKTsKKwkJc2VxX3ByaW50ZihtLCAiJXM6IFdvcmthcm91bmRz
IGFwcGxpZWQ6ICV1XG4iLAorCQkJICAgZW5naW5lLT5uYW1lLCBjb3VudCk7CiAKLQlzZXFfcHV0
cyhtLCAiXG4iKTsKLX0KKwkJZm9yICh3YSA9IHdhbC0+bGlzdDsgY291bnQtLTsgd2ErKykKKwkJ
CXNlcV9wcmludGYobSwgIjB4JVg6IDB4JTA4WCwgbWFzazogMHglMDhYXG4iLAorCQkJCSAgIGk5
MTVfbW1pb19yZWdfb2Zmc2V0KHdhLT5yZWcpLAorCQkJCSAgIHdhLT5zZXQsIHdhLT5jbHIpOwog
Ci1zdGF0aWMgdm9pZCBpbnRlbF9kcF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwKLQkJCSAgc3Ry
dWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yKQotewotCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICppbnRlbF9lbmNvZGVyID0gaW50ZWxfYXR0YWNoZWRfZW5jb2RlcihpbnRlbF9jb25u
ZWN0b3IpOwotCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoaW50
ZWxfZW5jb2Rlcik7Ci0KLQlzZXFfcHJpbnRmKG0sICJcdERQQ0QgcmV2OiAleFxuIiwgaW50ZWxf
ZHAtPmRwY2RbRFBfRFBDRF9SRVZdKTsKLQlzZXFfcHJpbnRmKG0sICJcdGF1ZGlvIHN1cHBvcnQ6
ICVzXG4iLCB5ZXNubyhpbnRlbF9kcC0+aGFzX2F1ZGlvKSk7Ci0JaWYgKGludGVsX2Nvbm5lY3Rv
ci0+YmFzZS5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNUT1JfZURQKQotCQlpbnRl
bF9wYW5lbF9pbmZvKG0sICZpbnRlbF9jb25uZWN0b3ItPnBhbmVsKTsKLQotCWRybV9kcF9kb3du
c3RyZWFtX2RlYnVnKG0sIGludGVsX2RwLT5kcGNkLCBpbnRlbF9kcC0+ZG93bnN0cmVhbV9wb3J0
cywKLQkJCQkmaW50ZWxfZHAtPmF1eCk7Ci0JaWYgKGludGVsX2Nvbm5lY3Rvci0+aGRjcC5zaGlt
KSB7Ci0JCXNlcV9wdXRzKG0sICJcdEhEQ1AgdmVyc2lvbjogIik7Ci0JCWludGVsX2hkY3BfaW5m
byhtLCBpbnRlbF9jb25uZWN0b3IpOworCQlzZXFfcHJpbnRmKG0sICJcbiIpOwogCX0KLX0KIAot
c3RhdGljIHZvaWQgaW50ZWxfZHBfbXN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLAotCQkJICBz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCi17Ci0Jc3RydWN0IGludGVs
X2VuY29kZXIgKmludGVsX2VuY29kZXIgPSBpbnRlbF9hdHRhY2hlZF9lbmNvZGVyKGludGVsX2Nv
bm5lY3Rvcik7Ci0Jc3RydWN0IGludGVsX2RwX21zdF9lbmNvZGVyICppbnRlbF9tc3QgPQotCQll
bmNfdG9fbXN0KGludGVsX2VuY29kZXIpOwotCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmlu
dGVsX2RpZ19wb3J0ID0gaW50ZWxfbXN0LT5wcmltYXJ5OwotCXN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAgPSAmaW50ZWxfZGlnX3BvcnQtPmRwOwotCWJvb2wgaGFzX2F1ZGlvID0gZHJtX2RwX21z
dF9wb3J0X2hhc19hdWRpbygmaW50ZWxfZHAtPm1zdF9tZ3IsCi0JCQkJCWludGVsX2Nvbm5lY3Rv
ci0+cG9ydCk7Ci0KLQlzZXFfcHJpbnRmKG0sICJcdGF1ZGlvIHN1cHBvcnQ6ICVzXG4iLCB5ZXNu
byhoYXNfYXVkaW8pKTsKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfaGRtaV9p
bmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwKLQkJCSAgICBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpp
bnRlbF9jb25uZWN0b3IpCitzdGF0aWMgaW50IGk5MTVfaXBjX3N0YXR1c19zaG93KHN0cnVjdCBz
ZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxf
ZW5jb2RlciA9IGludGVsX2F0dGFjaGVkX2VuY29kZXIoaW50ZWxfY29ubmVjdG9yKTsKLQlzdHJ1
Y3QgaW50ZWxfaGRtaSAqaW50ZWxfaGRtaSA9IGVuY190b19pbnRlbF9oZG1pKGludGVsX2VuY29k
ZXIpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7CiAK
LQlzZXFfcHJpbnRmKG0sICJcdGF1ZGlvIHN1cHBvcnQ6ICVzXG4iLCB5ZXNubyhpbnRlbF9oZG1p
LT5oYXNfYXVkaW8pKTsKLQlpZiAoaW50ZWxfY29ubmVjdG9yLT5oZGNwLnNoaW0pIHsKLQkJc2Vx
X3B1dHMobSwgIlx0SERDUCB2ZXJzaW9uOiAiKTsKLQkJaW50ZWxfaGRjcF9pbmZvKG0sIGludGVs
X2Nvbm5lY3Rvcik7Ci0JfQorCXNlcV9wcmludGYobSwgIklzb2Nocm9ub3VzIFByaW9yaXR5IENv
bnRyb2w6ICVzXG4iLAorCQkJeWVzbm8oZGV2X3ByaXYtPmlwY19lbmFibGVkKSk7CisJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX2x2ZHNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
Ci0JCQkgICAgc3RydWN0IGludGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yKQorc3RhdGlj
IGludCBpOTE1X2lwY19zdGF0dXNfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmls
ZSAqZmlsZSkKIHsKLQlpbnRlbF9wYW5lbF9pbmZvKG0sICZpbnRlbF9jb25uZWN0b3ItPnBhbmVs
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBpbm9kZS0+aV9wcml2YXRl
OworCisJaWYgKCFIQVNfSVBDKGRldl9wcml2KSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlyZXR1
cm4gc2luZ2xlX29wZW4oZmlsZSwgaTkxNV9pcGNfc3RhdHVzX3Nob3csIGRldl9wcml2KTsKIH0K
IAotc3RhdGljIHZvaWQgaW50ZWxfY29ubmVjdG9yX2luZm8oc3RydWN0IHNlcV9maWxlICptLAot
CQkJCSBzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yKQorc3RhdGljIHNzaXplX3QgaTkx
NV9pcGNfc3RhdHVzX3dyaXRlKHN0cnVjdCBmaWxlICpmaWxlLCBjb25zdCBjaGFyIF9fdXNlciAq
dWJ1ZiwKKwkJCQkgICAgIHNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkKIHsKLQlzdHJ1Y3QgaW50
ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubmVj
dG9yKTsKLQljb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSA9IGNv
bm5lY3Rvci0+c3RhdGU7Ci0Jc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPQotCQl0b19p
bnRlbF9lbmNvZGVyKGNvbm5fc3RhdGUtPmJlc3RfZW5jb2Rlcik7Ci0JY29uc3Qgc3RydWN0IGRy
bV9kaXNwbGF5X21vZGUgKm1vZGU7CisJc3RydWN0IHNlcV9maWxlICptID0gZmlsZS0+cHJpdmF0
ZV9kYXRhOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7
CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisJYm9vbCBlbmFibGU7CisJaW50IHJldDsKIAot
CXNlcV9wcmludGYobSwgIltDT05ORUNUT1I6JWQ6JXNdOiBzdGF0dXM6ICVzXG4iLAotCQkgICBj
b25uZWN0b3ItPmJhc2UuaWQsIGNvbm5lY3Rvci0+bmFtZSwKLQkJICAgZHJtX2dldF9jb25uZWN0
b3Jfc3RhdHVzX25hbWUoY29ubmVjdG9yLT5zdGF0dXMpKTsKKwlyZXQgPSBrc3RydG9ib29sX2Zy
b21fdXNlcih1YnVmLCBsZW4sICZlbmFibGUpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0
OwogCi0JaWYgKGNvbm5lY3Rvci0+c3RhdHVzID09IGNvbm5lY3Rvcl9zdGF0dXNfZGlzY29ubmVj
dGVkKQotCQlyZXR1cm47Ci0KLQlzZXFfcHJpbnRmKG0sICJcdHBoeXNpY2FsIGRpbWVuc2lvbnM6
ICVkeCVkbW1cbiIsCi0JCSAgIGNvbm5lY3Rvci0+ZGlzcGxheV9pbmZvLndpZHRoX21tLAotCQkg
ICBjb25uZWN0b3ItPmRpc3BsYXlfaW5mby5oZWlnaHRfbW0pOwotCXNlcV9wcmludGYobSwgIlx0
c3VicGl4ZWwgb3JkZXI6ICVzXG4iLAotCQkgICBkcm1fZ2V0X3N1YnBpeGVsX29yZGVyX25hbWUo
Y29ubmVjdG9yLT5kaXNwbGF5X2luZm8uc3VicGl4ZWxfb3JkZXIpKTsKLQlzZXFfcHJpbnRmKG0s
ICJcdENFQSByZXY6ICVkXG4iLCBjb25uZWN0b3ItPmRpc3BsYXlfaW5mby5jZWFfcmV2KTsKLQot
CWlmICghZW5jb2RlcikKLQkJcmV0dXJuOwotCi0Jc3dpdGNoIChjb25uZWN0b3ItPmNvbm5lY3Rv
cl90eXBlKSB7Ci0JY2FzZSBEUk1fTU9ERV9DT05ORUNUT1JfRGlzcGxheVBvcnQ6Ci0JY2FzZSBE
Uk1fTU9ERV9DT05ORUNUT1JfZURQOgotCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQ
VVRfRFBfTVNUKQotCQkJaW50ZWxfZHBfbXN0X2luZm8obSwgaW50ZWxfY29ubmVjdG9yKTsKLQkJ
ZWxzZQotCQkJaW50ZWxfZHBfaW5mbyhtLCBpbnRlbF9jb25uZWN0b3IpOwotCQlicmVhazsKLQlj
YXNlIERSTV9NT0RFX0NPTk5FQ1RPUl9MVkRTOgotCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRF
TF9PVVRQVVRfTFZEUykKLQkJCWludGVsX2x2ZHNfaW5mbyhtLCBpbnRlbF9jb25uZWN0b3IpOwot
CQlicmVhazsKLQljYXNlIERSTV9NT0RFX0NPTk5FQ1RPUl9IRE1JQToKLQkJaWYgKGVuY29kZXIt
PnR5cGUgPT0gSU5URUxfT1VUUFVUX0hETUkgfHwKLQkJICAgIGVuY29kZXItPnR5cGUgPT0gSU5U
RUxfT1VUUFVUX0RESSkKLQkJCWludGVsX2hkbWlfaW5mbyhtLCBpbnRlbF9jb25uZWN0b3IpOwot
CQlicmVhazsKLQlkZWZhdWx0OgotCQlicmVhazsKLQl9Ci0KLQlzZXFfcHJpbnRmKG0sICJcdG1v
ZGVzOlxuIik7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeShtb2RlLCAmY29ubmVjdG9yLT5tb2Rlcywg
aGVhZCkKLQkJaW50ZWxfc2VxX3ByaW50X21vZGUobSwgMiwgbW9kZSk7Ci19Ci0KLXN0YXRpYyBj
b25zdCBjaGFyICpwbGFuZV90eXBlKGVudW0gZHJtX3BsYW5lX3R5cGUgdHlwZSkKLXsKLQlzd2l0
Y2ggKHR5cGUpIHsKLQljYXNlIERSTV9QTEFORV9UWVBFX09WRVJMQVk6Ci0JCXJldHVybiAiT1ZM
IjsKLQljYXNlIERSTV9QTEFORV9UWVBFX1BSSU1BUlk6Ci0JCXJldHVybiAiUFJJIjsKLQljYXNl
IERSTV9QTEFORV9UWVBFX0NVUlNPUjoKLQkJcmV0dXJuICJDVVIiOwotCS8qCi0JICogRGVsaWJl
cmF0ZWx5IG9taXR0aW5nIGRlZmF1bHQ6IHRvIGdlbmVyYXRlIGNvbXBpbGVyIHdhcm5pbmdzCi0J
ICogd2hlbiBhIG5ldyBkcm1fcGxhbmVfdHlwZSBnZXRzIGFkZGVkLgotCSAqLwotCX0KLQotCXJl
dHVybiAidW5rbm93biI7Ci19Ci0KLXN0YXRpYyB2b2lkIHBsYW5lX3JvdGF0aW9uKGNoYXIgKmJ1
Ziwgc2l6ZV90IGJ1ZnNpemUsIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQkvKgotCSAqIEFj
Y29yZGluZyB0byBkb2Mgb25seSBvbmUgRFJNX01PREVfUk9UQVRFXyBpcyBhbGxvd2VkIGJ1dCB0
aGlzCi0JICogd2lsbCBwcmludCB0aGVtIGFsbCB0byB2aXN1YWxpemUgaWYgdGhlIHZhbHVlcyBh
cmUgbWlzdXNlZAotCSAqLwotCXNucHJpbnRmKGJ1ZiwgYnVmc2l6ZSwKLQkJICIlcyVzJXMlcyVz
JXMoMHglMDh4KSIsCi0JCSAocm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfMCkgPyAiMCAiIDog
IiIsCi0JCSAocm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfOTApID8gIjkwICIgOiAiIiwKLQkJ
IChyb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV8xODApID8gIjE4MCAiIDogIiIsCi0JCSAocm90
YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfMjcwKSA/ICIyNzAgIiA6ICIiLAotCQkgKHJvdGF0aW9u
ICYgRFJNX01PREVfUkVGTEVDVF9YKSA/ICJGTElQWCAiIDogIiIsCi0JCSAocm90YXRpb24gJiBE
Uk1fTU9ERV9SRUZMRUNUX1kpID8gIkZMSVBZICIgOiAiIiwKLQkJIHJvdGF0aW9uKTsKLX0KLQot
c3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfdWFwaV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSkKLXsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlID0KLQkJdG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmUtPmJhc2Uuc3Rh
dGUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPnVh
cGkuZmI7Ci0Jc3RydWN0IGRybV9mb3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7Ci0Jc3RydWN0
IGRybV9yZWN0IHNyYywgZHN0OwotCWNoYXIgcm90X3N0cls0OF07Ci0KLQlzcmMgPSBkcm1fcGxh
bmVfc3RhdGVfc3JjKCZwbGFuZV9zdGF0ZS0+dWFwaSk7Ci0JZHN0ID0gZHJtX3BsYW5lX3N0YXRl
X2Rlc3QoJnBsYW5lX3N0YXRlLT51YXBpKTsKLQotCWlmIChmYikKLQkJZHJtX2dldF9mb3JtYXRf
bmFtZShmYi0+Zm9ybWF0LT5mb3JtYXQsICZmb3JtYXRfbmFtZSk7Ci0KLQlwbGFuZV9yb3RhdGlv
bihyb3Rfc3RyLCBzaXplb2Yocm90X3N0ciksCi0JCSAgICAgICBwbGFuZV9zdGF0ZS0+dWFwaS5y
b3RhdGlvbik7Ci0KLQlzZXFfcHJpbnRmKG0sICJcdFx0dWFwaTogZmI9JWQsJXMsJWR4JWQsIHNy
Yz0iIERSTV9SRUNUX0ZQX0ZNVCAiLCBkc3Q9IiBEUk1fUkVDVF9GTVQgIiwgcm90YXRpb249JXNc
biIsCi0JCSAgIGZiID8gZmItPmJhc2UuaWQgOiAwLCBmYiA/IGZvcm1hdF9uYW1lLnN0ciA6ICJu
L2EiLAotCQkgICBmYiA/IGZiLT53aWR0aCA6IDAsIGZiID8gZmItPmhlaWdodCA6IDAsCi0JCSAg
IERSTV9SRUNUX0ZQX0FSRygmc3JjKSwKLQkJICAgRFJNX1JFQ1RfQVJHKCZkc3QpLAotCQkgICBy
b3Rfc3RyKTsKLX0KLQotc3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfaHdfaW5mbyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUpCi17Ci0JY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9Ci0JCXRvX2ludGVsX3BsYW5lX3N0YXRlKHBs
YW5lLT5iYXNlLnN0YXRlKTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKLQlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBmb3JtYXRfbmFt
ZTsKLQljaGFyIHJvdF9zdHJbNDhdOwotCi0JaWYgKCFmYikKLQkJcmV0dXJuOwotCi0JZHJtX2dl
dF9mb3JtYXRfbmFtZShmYi0+Zm9ybWF0LT5mb3JtYXQsICZmb3JtYXRfbmFtZSk7Ci0KLQlwbGFu
ZV9yb3RhdGlvbihyb3Rfc3RyLCBzaXplb2Yocm90X3N0ciksCi0JCSAgICAgICBwbGFuZV9zdGF0
ZS0+aHcucm90YXRpb24pOwotCi0Jc2VxX3ByaW50ZihtLCAiXHRcdGh3OiBmYj0lZCwlcywlZHgl
ZCwgdmlzaWJsZT0lcywgc3JjPSIgRFJNX1JFQ1RfRlBfRk1UICIsIGRzdD0iIERSTV9SRUNUX0ZN
VCAiLCByb3RhdGlvbj0lc1xuIiwKLQkJICAgZmItPmJhc2UuaWQsIGZvcm1hdF9uYW1lLnN0ciwK
LQkJICAgZmItPndpZHRoLCBmYi0+aGVpZ2h0LAotCQkgICB5ZXNubyhwbGFuZV9zdGF0ZS0+dWFw
aS52aXNpYmxlKSwKLQkJICAgRFJNX1JFQ1RfRlBfQVJHKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMp
LAotCQkgICBEUk1fUkVDVF9BUkcoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCksCi0JCSAgIHJvdF9z
dHIpOwotfQotCi1zdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAq
bSwgc3RydWN0IGludGVsX2NydGMgKmNydGMpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCXN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmU7Ci0KLQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+ZHJt
LCBjcnRjLCBwbGFuZSkgewotCQlzZXFfcHJpbnRmKG0sICJcdFtQTEFORTolZDolc106IHR5cGU9
JXNcbiIsCi0JCQkgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJ
ICAgcGxhbmVfdHlwZShwbGFuZS0+YmFzZS50eXBlKSk7Ci0JCWludGVsX3BsYW5lX3VhcGlfaW5m
byhtLCBwbGFuZSk7Ci0JCWludGVsX3BsYW5lX2h3X2luZm8obSwgcGxhbmUpOwotCX0KLX0KLQot
c3RhdGljIHZvaWQgaW50ZWxfc2NhbGVyX2luZm8oc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YykKLXsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSA9Ci0JCXRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7Ci0JaW50
IG51bV9zY2FsZXJzID0gY3J0Yy0+bnVtX3NjYWxlcnM7Ci0JaW50IGk7Ci0KLQkvKiBOb3QgYWxs
IHBsYXRmb3JtYXMgaGF2ZSBhIHNjYWxlciAqLwotCWlmIChudW1fc2NhbGVycykgewotCQlzZXFf
cHJpbnRmKG0sICJcdG51bV9zY2FsZXJzPSVkLCBzY2FsZXJfdXNlcnM9JXggc2NhbGVyX2lkPSVk
IiwKLQkJCSAgIG51bV9zY2FsZXJzLAotCQkJICAgY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlLnNj
YWxlcl91c2VycywKLQkJCSAgIGNydGNfc3RhdGUtPnNjYWxlcl9zdGF0ZS5zY2FsZXJfaWQpOwot
Ci0JCWZvciAoaSA9IDA7IGkgPCBudW1fc2NhbGVyczsgaSsrKSB7Ci0JCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfc2NhbGVyICpzYyA9Ci0JCQkJJmNydGNfc3RhdGUtPnNjYWxlcl9zdGF0ZS5zY2FsZXJz
W2ldOwotCi0JCQlzZXFfcHJpbnRmKG0sICIsIHNjYWxlcnNbJWRdOiB1c2U9JXMsIG1vZGU9JXgi
LAotCQkJCSAgIGksIHllc25vKHNjLT5pbl91c2UpLCBzYy0+bW9kZSk7Ci0JCX0KLQkJc2VxX3B1
dHMobSwgIlxuIik7Ci0JfSBlbHNlIHsKLQkJc2VxX3B1dHMobSwgIlx0Tm8gc2NhbGVycyBhdmFp
bGFibGUgb24gdGhpcyBwbGF0Zm9ybVxuIik7Ci0JfQotfQotCi1zdGF0aWMgdm9pZCBpbnRlbF9j
cnRjX2luZm8oc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKLXsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJp
dmF0ZSk7Ci0JY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQotCQl0
b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwotCXN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyOwotCi0Jc2VxX3ByaW50ZihtLCAiW0NSVEM6JWQ6JXNdOlxuIiwKLQkJICAg
Y3J0Yy0+YmFzZS5iYXNlLmlkLCBjcnRjLT5iYXNlLm5hbWUpOwotCi0Jc2VxX3ByaW50ZihtLCAi
XHR1YXBpOiBlbmFibGU9JXMsIGFjdGl2ZT0lcywgbW9kZT0iIERSTV9NT0RFX0ZNVCAiXG4iLAot
CQkgICB5ZXNubyhjcnRjX3N0YXRlLT51YXBpLmVuYWJsZSksCi0JCSAgIHllc25vKGNydGNfc3Rh
dGUtPnVhcGkuYWN0aXZlKSwKLQkJICAgRFJNX01PREVfQVJHKCZjcnRjX3N0YXRlLT51YXBpLm1v
ZGUpKTsKLQotCWlmIChjcnRjX3N0YXRlLT5ody5lbmFibGUpIHsKLQkJc2VxX3ByaW50ZihtLCAi
XHRodzogYWN0aXZlPSVzLCBhZGp1c3RlZF9tb2RlPSIgRFJNX01PREVfRk1UICJcbiIsCi0JCQkg
ICB5ZXNubyhjcnRjX3N0YXRlLT5ody5hY3RpdmUpLAotCQkJICAgRFJNX01PREVfQVJHKCZjcnRj
X3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlKSk7Ci0KLQkJc2VxX3ByaW50ZihtLCAiXHRwaXBlIHNy
YyBzaXplPSVkeCVkLCBkaXRoZXI9JXMsIGJwcD0lZFxuIiwKLQkJCSAgIGNydGNfc3RhdGUtPnBp
cGVfc3JjX3csIGNydGNfc3RhdGUtPnBpcGVfc3JjX2gsCi0JCQkgICB5ZXNubyhjcnRjX3N0YXRl
LT5kaXRoZXIpLCBjcnRjX3N0YXRlLT5waXBlX2JwcCk7Ci0KLQkJaW50ZWxfc2NhbGVyX2luZm8o
bSwgY3J0Yyk7Ci0JfQotCi0JZm9yX2VhY2hfaW50ZWxfZW5jb2Rlcl9tYXNrKCZkZXZfcHJpdi0+
ZHJtLCBlbmNvZGVyLAotCQkJCSAgICBjcnRjX3N0YXRlLT51YXBpLmVuY29kZXJfbWFzaykKLQkJ
aW50ZWxfZW5jb2Rlcl9pbmZvKG0sIGNydGMsIGVuY29kZXIpOwotCi0JaW50ZWxfcGxhbmVfaW5m
byhtLCBjcnRjKTsKLQotCXNlcV9wcmludGYobSwgIlx0dW5kZXJydW4gcmVwb3J0aW5nOiBjcHU9
JXMgcGNoPSVzXG4iLAotCQkgICB5ZXNubyghY3J0Yy0+Y3B1X2ZpZm9fdW5kZXJydW5fZGlzYWJs
ZWQpLAotCQkgICB5ZXNubyghY3J0Yy0+cGNoX2ZpZm9fdW5kZXJydW5fZGlzYWJsZWQpKTsKLX0K
LQotc3RhdGljIGludCBpOTE1X2Rpc3BsYXlfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KnVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3Rv
X2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+
ZHJtOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwotCXN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3I7Ci0Jc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNvbm5faXRlcjsKLQlp
bnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dl
dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwotCi0JZHJtX21vZGVzZXRfbG9ja19hbGwoZGV2KTsK
LQotCXNlcV9wcmludGYobSwgIkNSVEMgaW5mb1xuIik7Ci0Jc2VxX3ByaW50ZihtLCAiLS0tLS0t
LS0tXG4iKTsKLQlmb3JfZWFjaF9pbnRlbF9jcnRjKGRldiwgY3J0YykKLQkJaW50ZWxfY3J0Y19p
bmZvKG0sIGNydGMpOwotCi0Jc2VxX3ByaW50ZihtLCAiXG4iKTsKLQlzZXFfcHJpbnRmKG0sICJD
b25uZWN0b3IgaW5mb1xuIik7Ci0Jc2VxX3ByaW50ZihtLCAiLS0tLS0tLS0tLS0tLS1cbiIpOwot
CWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRlcik7Ci0JZHJtX2Zv
cl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5faXRlcikKLQkJaW50ZWxfY29u
bmVjdG9yX2luZm8obSwgY29ubmVjdG9yKTsKLQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQo
JmNvbm5faXRlcik7Ci0KLQlkcm1fbW9kZXNldF91bmxvY2tfYWxsKGRldik7Ci0KLQlpbnRlbF9y
dW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCi0JcmV0dXJu
IDA7Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9lbmdpbmVfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHZvaWQgKnVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBu
b2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCXN0cnVjdCBkcm1fcHJpbnRlciBwOwotCi0J
d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7Ci0K
LQlzZXFfcHJpbnRmKG0sICJHVCBhd2FrZT8gJXMgWyVkXVxuIiwKLQkJICAgeWVzbm8oZGV2X3By
aXYtPmd0LmF3YWtlKSwKLQkJICAgYXRvbWljX3JlYWQoJmRldl9wcml2LT5ndC53YWtlcmVmLmNv
dW50KSk7Ci0Jc2VxX3ByaW50ZihtLCAiQ1MgdGltZXN0YW1wIGZyZXF1ZW5jeTogJXUga0h6XG4i
LAotCQkgICBSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5jc190aW1lc3RhbXBfZnJlcXVlbmN5X2to
eik7Ci0KLQlwID0gZHJtX3NlcV9maWxlX3ByaW50ZXIobSk7Ci0JZm9yX2VhY2hfdWFiaV9lbmdp
bmUoZW5naW5lLCBkZXZfcHJpdikKLQkJaW50ZWxfZW5naW5lX2R1bXAoZW5naW5lLCAmcCwgIiVz
XG4iLCBlbmdpbmUtPm5hbWUpOwotCi0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5y
dW50aW1lX3BtLCB3YWtlcmVmKTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGk5MTVf
cmNzX3RvcG9sb2d5KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQotewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsK
LQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9zZXFfZmlsZV9wcmludGVyKG0pOwotCi0JaW50
ZWxfZGV2aWNlX2luZm9fcHJpbnRfdG9wb2xvZ3koJlJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPnNz
ZXUsICZwKTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGk5MTVfc2hyaW5rZXJfaW5m
byhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQotCXNlcV9wcmludGYo
bSwgInNlZWtzID0gJWRcbiIsIGk5MTUtPm1tLnNocmlua2VyLnNlZWtzKTsKLQlzZXFfcHJpbnRm
KG0sICJiYXRjaCA9ICVsdVxuIiwgaTkxNS0+bW0uc2hyaW5rZXIuYmF0Y2gpOwotCi0JcmV0dXJu
IDA7Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9zaGFyZWRfZHBsbHNfaW5mbyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKnVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
ICZkZXZfcHJpdi0+ZHJtOwotCWludCBpOwotCi0JZHJtX21vZGVzZXRfbG9ja19hbGwoZGV2KTsK
LQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPm51bV9zaGFyZWRfZHBsbDsgaSsrKSB7Ci0JCXN0
cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gJmRldl9wcml2LT5zaGFyZWRfZHBsbHNbaV07
Ci0KLQkJc2VxX3ByaW50ZihtLCAiRFBMTCVpOiAlcywgaWQ6ICVpXG4iLCBpLCBwbGwtPmluZm8t
Pm5hbWUsCi0JCQkgICBwbGwtPmluZm8tPmlkKTsKLQkJc2VxX3ByaW50ZihtLCAiIGNydGNfbWFz
azogMHglMDh4LCBhY3RpdmU6IDB4JXgsIG9uOiAlc1xuIiwKLQkJCSAgIHBsbC0+c3RhdGUuY3J0
Y19tYXNrLCBwbGwtPmFjdGl2ZV9tYXNrLCB5ZXNubyhwbGwtPm9uKSk7Ci0JCXNlcV9wcmludGYo
bSwgIiB0cmFja2VkIGhhcmR3YXJlIHN0YXRlOlxuIik7Ci0JCXNlcV9wcmludGYobSwgIiBkcGxs
OiAgICAweCUwOHhcbiIsIHBsbC0+c3RhdGUuaHdfc3RhdGUuZHBsbCk7Ci0JCXNlcV9wcmludGYo
bSwgIiBkcGxsX21kOiAweCUwOHhcbiIsCi0JCQkgICBwbGwtPnN0YXRlLmh3X3N0YXRlLmRwbGxf
bWQpOwotCQlzZXFfcHJpbnRmKG0sICIgZnAwOiAgICAgMHglMDh4XG4iLCBwbGwtPnN0YXRlLmh3
X3N0YXRlLmZwMCk7Ci0JCXNlcV9wcmludGYobSwgIiBmcDE6ICAgICAweCUwOHhcbiIsIHBsbC0+
c3RhdGUuaHdfc3RhdGUuZnAxKTsKLQkJc2VxX3ByaW50ZihtLCAiIHdycGxsOiAgIDB4JTA4eFxu
IiwgcGxsLT5zdGF0ZS5od19zdGF0ZS53cnBsbCk7Ci0JCXNlcV9wcmludGYobSwgIiBjZmdjcjA6
ICAweCUwOHhcbiIsIHBsbC0+c3RhdGUuaHdfc3RhdGUuY2ZnY3IwKTsKLQkJc2VxX3ByaW50Ziht
LCAiIGNmZ2NyMTogIDB4JTA4eFxuIiwgcGxsLT5zdGF0ZS5od19zdGF0ZS5jZmdjcjEpOwotCQlz
ZXFfcHJpbnRmKG0sICIgbWdfcmVmY2xraW5fY3RsOiAgICAgICAgMHglMDh4XG4iLAotCQkJICAg
cGxsLT5zdGF0ZS5od19zdGF0ZS5tZ19yZWZjbGtpbl9jdGwpOwotCQlzZXFfcHJpbnRmKG0sICIg
bWdfY2xrdG9wMl9jb3JlY2xrY3RsMTogMHglMDh4XG4iLAotCQkJICAgcGxsLT5zdGF0ZS5od19z
dGF0ZS5tZ19jbGt0b3AyX2NvcmVjbGtjdGwxKTsKLQkJc2VxX3ByaW50ZihtLCAiIG1nX2Nsa3Rv
cDJfaHNjbGtjdGw6ICAgIDB4JTA4eFxuIiwKLQkJCSAgIHBsbC0+c3RhdGUuaHdfc3RhdGUubWdf
Y2xrdG9wMl9oc2Nsa2N0bCk7Ci0JCXNlcV9wcmludGYobSwgIiBtZ19wbGxfZGl2MDogIDB4JTA4
eFxuIiwKLQkJCSAgIHBsbC0+c3RhdGUuaHdfc3RhdGUubWdfcGxsX2RpdjApOwotCQlzZXFfcHJp
bnRmKG0sICIgbWdfcGxsX2RpdjE6ICAweCUwOHhcbiIsCi0JCQkgICBwbGwtPnN0YXRlLmh3X3N0
YXRlLm1nX3BsbF9kaXYxKTsKLQkJc2VxX3ByaW50ZihtLCAiIG1nX3BsbF9sZjogICAgMHglMDh4
XG4iLAotCQkJICAgcGxsLT5zdGF0ZS5od19zdGF0ZS5tZ19wbGxfbGYpOwotCQlzZXFfcHJpbnRm
KG0sICIgbWdfcGxsX2ZyYWNfbG9jazogMHglMDh4XG4iLAotCQkJICAgcGxsLT5zdGF0ZS5od19z
dGF0ZS5tZ19wbGxfZnJhY19sb2NrKTsKLQkJc2VxX3ByaW50ZihtLCAiIG1nX3BsbF9zc2M6ICAg
MHglMDh4XG4iLAotCQkJICAgcGxsLT5zdGF0ZS5od19zdGF0ZS5tZ19wbGxfc3NjKTsKLQkJc2Vx
X3ByaW50ZihtLCAiIG1nX3BsbF9iaWFzOiAgMHglMDh4XG4iLAotCQkJICAgcGxsLT5zdGF0ZS5o
d19zdGF0ZS5tZ19wbGxfYmlhcyk7Ci0JCXNlcV9wcmludGYobSwgIiBtZ19wbGxfdGRjX2NvbGRz
dF9iaWFzOiAweCUwOHhcbiIsCi0JCQkgICBwbGwtPnN0YXRlLmh3X3N0YXRlLm1nX3BsbF90ZGNf
Y29sZHN0X2JpYXMpOwotCX0KLQlkcm1fbW9kZXNldF91bmxvY2tfYWxsKGRldik7Ci0KLQlyZXR1
cm4gMDsKLX0KLQotc3RhdGljIGludCBpOTE1X3dhX3JlZ2lzdGVycyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sIHZvaWQgKnVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5v
ZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
Ci0KLQlmb3JfZWFjaF91YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpIHsKLQkJY29uc3Qgc3RydWN0
IGk5MTVfd2FfbGlzdCAqd2FsID0gJmVuZ2luZS0+Y3R4X3dhX2xpc3Q7Ci0JCWNvbnN0IHN0cnVj
dCBpOTE1X3dhICp3YTsKLQkJdW5zaWduZWQgaW50IGNvdW50OwotCi0JCWNvdW50ID0gd2FsLT5j
b3VudDsKLQkJaWYgKCFjb3VudCkKLQkJCWNvbnRpbnVlOwotCi0JCXNlcV9wcmludGYobSwgIiVz
OiBXb3JrYXJvdW5kcyBhcHBsaWVkOiAldVxuIiwKLQkJCSAgIGVuZ2luZS0+bmFtZSwgY291bnQp
OwotCi0JCWZvciAod2EgPSB3YWwtPmxpc3Q7IGNvdW50LS07IHdhKyspCi0JCQlzZXFfcHJpbnRm
KG0sICIweCVYOiAweCUwOFgsIG1hc2s6IDB4JTA4WFxuIiwKLQkJCQkgICBpOTE1X21taW9fcmVn
X29mZnNldCh3YS0+cmVnKSwKLQkJCQkgICB3YS0+c2V0LCB3YS0+Y2xyKTsKLQotCQlzZXFfcHJp
bnRmKG0sICJcbiIpOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGk5MTVfaXBj
X3N0YXR1c19zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2YXRlOwotCi0Jc2VxX3ByaW50Ziht
LCAiSXNvY2hyb25vdXMgUHJpb3JpdHkgQ29udHJvbDogJXNcbiIsCi0JCQl5ZXNubyhkZXZfcHJp
di0+aXBjX2VuYWJsZWQpKTsKLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBpOTE1X2lwY19z
dGF0dXNfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKLXsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBpbm9kZS0+aV9wcml2YXRlOwotCi0J
aWYgKCFIQVNfSVBDKGRldl9wcml2KSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQlyZXR1cm4gc2lu
Z2xlX29wZW4oZmlsZSwgaTkxNV9pcGNfc3RhdHVzX3Nob3csIGRldl9wcml2KTsKLX0KLQotc3Rh
dGljIHNzaXplX3QgaTkxNV9pcGNfc3RhdHVzX3dyaXRlKHN0cnVjdCBmaWxlICpmaWxlLCBjb25z
dCBjaGFyIF9fdXNlciAqdWJ1ZiwKLQkJCQkgICAgIHNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkK
LXsKLQlzdHJ1Y3Qgc2VxX2ZpbGUgKm0gPSBmaWxlLT5wcml2YXRlX2RhdGE7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQlpbnRlbF93YWtlcmVmX3Qg
d2FrZXJlZjsKLQlib29sIGVuYWJsZTsKLQlpbnQgcmV0OwotCi0JcmV0ID0ga3N0cnRvYm9vbF9m
cm9tX3VzZXIodWJ1ZiwgbGVuLCAmZW5hYmxlKTsKLQlpZiAocmV0IDwgMCkKLQkJcmV0dXJuIHJl
dDsKLQotCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2Vy
ZWYpIHsKLQkJaWYgKCFkZXZfcHJpdi0+aXBjX2VuYWJsZWQgJiYgZW5hYmxlKQotCQkJZHJtX2lu
Zm8oJmRldl9wcml2LT5kcm0sCi0JCQkJICJFbmFibGluZyBJUEM6IFdNIHdpbGwgYmUgcHJvcGVy
IG9ubHkgYWZ0ZXIgbmV4dCBjb21taXRcbiIpOwotCQlkZXZfcHJpdi0+d20uZGlzdHJ1c3RfYmlv
c193bSA9IHRydWU7Ci0JCWRldl9wcml2LT5pcGNfZW5hYmxlZCA9IGVuYWJsZTsKLQkJaW50ZWxf
ZW5hYmxlX2lwYyhkZXZfcHJpdik7Ci0JfQotCi0JcmV0dXJuIGxlbjsKLX0KLQotc3RhdGljIGNv
bnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9pcGNfc3RhdHVzX2ZvcHMgPSB7Ci0JLm93
bmVyID0gVEhJU19NT0RVTEUsCi0JLm9wZW4gPSBpOTE1X2lwY19zdGF0dXNfb3BlbiwKLQkucmVh
ZCA9IHNlcV9yZWFkLAotCS5sbHNlZWsgPSBzZXFfbHNlZWssCi0JLnJlbGVhc2UgPSBzaW5nbGVf
cmVsZWFzZSwKLQkud3JpdGUgPSBpOTE1X2lwY19zdGF0dXNfd3JpdGUKLX07Ci0KLXN0YXRpYyBp
bnQgaTkxNV9kZGJfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKLXsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0
ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwotCXN0cnVjdCBz
a2xfZGRiX2VudHJ5ICplbnRyeTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKLQotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpIDwgOSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQlkcm1fbW9kZXNl
dF9sb2NrX2FsbChkZXYpOwotCi0Jc2VxX3ByaW50ZihtLCAiJS0xNXMlOHMlOHMlOHNcbiIsICIi
LCAiU3RhcnQiLCAiRW5kIiwgIlNpemUiKTsKLQotCWZvcl9lYWNoX2ludGVsX2NydGMoJmRldl9w
cml2LT5kcm0sIGNydGMpIHsKLQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUg
PQotCQkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKLQkJZW51bSBwaXBl
IHBpcGUgPSBjcnRjLT5waXBlOwotCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkOwotCi0JCXNlcV9w
cmludGYobSwgIlBpcGUgJWNcbiIsIHBpcGVfbmFtZShwaXBlKSk7Ci0KLQkJZm9yX2VhY2hfcGxh
bmVfaWRfb25fY3J0YyhjcnRjLCBwbGFuZV9pZCkgewotCQkJZW50cnkgPSAmY3J0Y19zdGF0ZS0+
d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsKLQkJCXNlcV9wcmludGYobSwgIiAgUGxhbmUl
LThkJTh1JTh1JTh1XG4iLCBwbGFuZV9pZCArIDEsCi0JCQkJICAgZW50cnktPnN0YXJ0LCBlbnRy
eS0+ZW5kLAotCQkJCSAgIHNrbF9kZGJfZW50cnlfc2l6ZShlbnRyeSkpOwotCQl9Ci0KLQkJZW50
cnkgPSAmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W1BMQU5FX0NVUlNPUl07Ci0JCXNl
cV9wcmludGYobSwgIiAgJS0xM3MlOHUlOHUlOHVcbiIsICJDdXJzb3IiLCBlbnRyeS0+c3RhcnQs
Ci0JCQkgICBlbnRyeS0+ZW5kLCBza2xfZGRiX2VudHJ5X3NpemUoZW50cnkpKTsKLQl9Ci0KLQlk
cm1fbW9kZXNldF91bmxvY2tfYWxsKGRldik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHZv
aWQgZHJyc19zdGF0dXNfcGVyX2NydGMoc3RydWN0IHNlcV9maWxlICptLAotCQkJCSBzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAotCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YykKLXsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3Ry
dWN0IGk5MTVfZHJycyAqZHJycyA9ICZkZXZfcHJpdi0+ZHJyczsKLQlpbnQgdnJlZnJlc2ggPSAw
OwotCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7Ci0Jc3RydWN0IGRybV9jb25uZWN0
b3JfbGlzdF9pdGVyIGNvbm5faXRlcjsKLQotCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2lu
KGRldiwgJmNvbm5faXRlcik7Ci0JZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3Rv
ciwgJmNvbm5faXRlcikgewotCQlpZiAoY29ubmVjdG9yLT5zdGF0ZS0+Y3J0YyAhPSAmaW50ZWxf
Y3J0Yy0+YmFzZSkKLQkJCWNvbnRpbnVlOwotCi0JCXNlcV9wcmludGYobSwgIiVzOlxuIiwgY29u
bmVjdG9yLT5uYW1lKTsKLQl9Ci0JZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2l0
ZXIpOwotCi0Jc2VxX3B1dHMobSwgIlxuIik7Ci0KLQlpZiAodG9faW50ZWxfY3J0Y19zdGF0ZShp
bnRlbF9jcnRjLT5iYXNlLnN0YXRlKS0+aGFzX2RycnMpIHsKLQkJc3RydWN0IGludGVsX3BhbmVs
ICpwYW5lbDsKLQotCQltdXRleF9sb2NrKCZkcnJzLT5tdXRleCk7Ci0JCS8qIERSUlMgU3VwcG9y
dGVkICovCi0JCXNlcV9wdXRzKG0sICJcdERSUlMgU3VwcG9ydGVkOiBZZXNcbiIpOwotCi0JCS8q
IGRpc2FibGVfZHJycygpIHdpbGwgbWFrZSBkcnJzLT5kcCBOVUxMICovCi0JCWlmICghZHJycy0+
ZHApIHsKLQkJCXNlcV9wdXRzKG0sICJJZGxlbmVzcyBEUlJTOiBEaXNhYmxlZFxuIik7Ci0JCQlp
ZiAoZGV2X3ByaXYtPnBzci5lbmFibGVkKQotCQkJCXNlcV9wdXRzKG0sCi0JCQkJIlx0QXMgUFNS
IGlzIGVuYWJsZWQsIERSUlMgaXMgbm90IGVuYWJsZWRcbiIpOwotCQkJbXV0ZXhfdW5sb2NrKCZk
cnJzLT5tdXRleCk7Ci0JCQlyZXR1cm47Ci0JCX0KLQotCQlwYW5lbCA9ICZkcnJzLT5kcC0+YXR0
YWNoZWRfY29ubmVjdG9yLT5wYW5lbDsKLQkJc2VxX3ByaW50ZihtLCAiXHRcdEJ1c3lfZnJvbnRi
dWZmZXJfYml0czogMHglWCIsCi0JCQkJCWRycnMtPmJ1c3lfZnJvbnRidWZmZXJfYml0cyk7Ci0K
LQkJc2VxX3B1dHMobSwgIlxuXHRcdCIpOwotCQlpZiAoZHJycy0+cmVmcmVzaF9yYXRlX3R5cGUg
PT0gRFJSU19ISUdIX1JSKSB7Ci0JCQlzZXFfcHV0cyhtLCAiRFJSU19TdGF0ZTogRFJSU19ISUdI
X1JSXG4iKTsKLQkJCXZyZWZyZXNoID0gcGFuZWwtPmZpeGVkX21vZGUtPnZyZWZyZXNoOwotCQl9
IGVsc2UgaWYgKGRycnMtPnJlZnJlc2hfcmF0ZV90eXBlID09IERSUlNfTE9XX1JSKSB7Ci0JCQlz
ZXFfcHV0cyhtLCAiRFJSU19TdGF0ZTogRFJSU19MT1dfUlJcbiIpOwotCQkJdnJlZnJlc2ggPSBw
YW5lbC0+ZG93bmNsb2NrX21vZGUtPnZyZWZyZXNoOwotCQl9IGVsc2UgewotCQkJc2VxX3ByaW50
ZihtLCAiRFJSU19TdGF0ZTogVW5rbm93biglZClcbiIsCi0JCQkJCQlkcnJzLT5yZWZyZXNoX3Jh
dGVfdHlwZSk7Ci0JCQltdXRleF91bmxvY2soJmRycnMtPm11dGV4KTsKLQkJCXJldHVybjsKLQkJ
fQotCQlzZXFfcHJpbnRmKG0sICJcdFx0VnJlZnJlc2g6ICVkIiwgdnJlZnJlc2gpOwotCi0JCXNl
cV9wdXRzKG0sICJcblx0XHQiKTsKLQkJbXV0ZXhfdW5sb2NrKCZkcnJzLT5tdXRleCk7Ci0JfSBl
bHNlIHsKLQkJLyogRFJSUyBub3Qgc3VwcG9ydGVkLiBQcmludCB0aGUgVkJUIHBhcmFtZXRlciov
Ci0JCXNlcV9wdXRzKG0sICJcdERSUlMgU3VwcG9ydGVkIDogTm8iKTsKLQl9Ci0Jc2VxX3B1dHMo
bSwgIlxuIik7Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9kcnJzX3N0YXR1cyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKnVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9
ICZkZXZfcHJpdi0+ZHJtOwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjOwotCWludCBh
Y3RpdmVfY3J0Y19jbnQgPSAwOwotCi0JZHJtX21vZGVzZXRfbG9ja19hbGwoZGV2KTsKLQlmb3Jf
ZWFjaF9pbnRlbF9jcnRjKGRldiwgaW50ZWxfY3J0YykgewotCQlpZiAoaW50ZWxfY3J0Yy0+YmFz
ZS5zdGF0ZS0+YWN0aXZlKSB7Ci0JCQlhY3RpdmVfY3J0Y19jbnQrKzsKLQkJCXNlcV9wcmludGYo
bSwgIlxuQ1JUQyAlZDogICIsIGFjdGl2ZV9jcnRjX2NudCk7Ci0KLQkJCWRycnNfc3RhdHVzX3Bl
cl9jcnRjKG0sIGRldiwgaW50ZWxfY3J0Yyk7Ci0JCX0KLQl9Ci0JZHJtX21vZGVzZXRfdW5sb2Nr
X2FsbChkZXYpOwotCi0JaWYgKCFhY3RpdmVfY3J0Y19jbnQpCi0JCXNlcV9wdXRzKG0sICJObyBh
Y3RpdmUgY3J0YyBmb3VuZFxuIik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBpOTE1
X2RwX21zdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQotewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsK
LQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGludGVs
X2VuY29kZXIgKmludGVsX2VuY29kZXI7Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50
ZWxfZGlnX3BvcnQ7Ci0Jc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsKLQlzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOwotCi0JZHJtX2Nvbm5lY3Rvcl9saXN0
X2l0ZXJfYmVnaW4oZGV2LCAmY29ubl9pdGVyKTsKLQlkcm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0
ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7Ci0JCWlmIChjb25uZWN0b3ItPmNvbm5lY3Rvcl90
eXBlICE9IERSTV9NT0RFX0NPTk5FQ1RPUl9EaXNwbGF5UG9ydCkKLQkJCWNvbnRpbnVlOwotCi0J
CWludGVsX2VuY29kZXIgPSBpbnRlbF9hdHRhY2hlZF9lbmNvZGVyKHRvX2ludGVsX2Nvbm5lY3Rv
cihjb25uZWN0b3IpKTsKLQkJaWYgKCFpbnRlbF9lbmNvZGVyIHx8IGludGVsX2VuY29kZXItPnR5
cGUgPT0gSU5URUxfT1VUUFVUX0RQX01TVCkKLQkJCWNvbnRpbnVlOwotCi0JCWludGVsX2RpZ19w
b3J0ID0gZW5jX3RvX2RpZ19wb3J0KGludGVsX2VuY29kZXIpOwotCQlpZiAoIWludGVsX2RpZ19w
b3J0LT5kcC5jYW5fbXN0KQotCQkJY29udGludWU7Ci0KLQkJc2VxX3ByaW50ZihtLCAiTVNUIFNv
dXJjZSBQb3J0IFtFTkNPREVSOiVkOiVzXVxuIiwKLQkJCSAgIGludGVsX2RpZ19wb3J0LT5iYXNl
LmJhc2UuYmFzZS5pZCwKLQkJCSAgIGludGVsX2RpZ19wb3J0LT5iYXNlLmJhc2UubmFtZSk7Ci0J
CWRybV9kcF9tc3RfZHVtcF90b3BvbG9neShtLCAmaW50ZWxfZGlnX3BvcnQtPmRwLm1zdF9tZ3Ip
OwotCX0KLQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5faXRlcik7Ci0KLQlyZXR1
cm4gMDsKLX0KLQotc3RhdGljIHNzaXplX3QgaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2FjdGl2ZV93
cml0ZShzdHJ1Y3QgZmlsZSAqZmlsZSwKLQkJCQkJCSAgY29uc3QgY2hhciBfX3VzZXIgKnVidWYs
Ci0JCQkJCQkgIHNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkKLXsKLQljaGFyICppbnB1dF9idWZm
ZXI7Ci0JaW50IHN0YXR1cyA9IDA7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldjsKLQlzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwotCXN0cnVjdCBkcm1fY29ubmVjdG9yX2xpc3RfaXRl
ciBjb25uX2l0ZXI7Ci0Jc3RydWN0IGludGVsX2RwICppbnRlbF9kcDsKLQlpbnQgdmFsID0gMDsK
LQotCWRldiA9ICgoc3RydWN0IHNlcV9maWxlICopZmlsZS0+cHJpdmF0ZV9kYXRhKS0+cHJpdmF0
ZTsKLQotCWlmIChsZW4gPT0gMCkKLQkJcmV0dXJuIDA7Ci0KLQlpbnB1dF9idWZmZXIgPSBtZW1k
dXBfdXNlcl9udWwodWJ1ZiwgbGVuKTsKLQlpZiAoSVNfRVJSKGlucHV0X2J1ZmZlcikpCi0JCXJl
dHVybiBQVFJfRVJSKGlucHV0X2J1ZmZlcik7Ci0KLQlkcm1fZGJnKCZ0b19pOTE1KGRldiktPmRy
bSwKLQkJIkNvcGllZCAlZCBieXRlcyBmcm9tIHVzZXJcbiIsICh1bnNpZ25lZCBpbnQpbGVuKTsK
LQotCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRlcik7Ci0JZHJt
X2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5faXRlcikgewotCQlzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKLQotCQlpZiAoY29ubmVjdG9yLT5jb25uZWN0b3Jf
dHlwZSAhPQotCQkgICAgRFJNX01PREVfQ09OTkVDVE9SX0Rpc3BsYXlQb3J0KQotCQkJY29udGlu
dWU7Ci0KLQkJZW5jb2RlciA9IHRvX2ludGVsX2VuY29kZXIoY29ubmVjdG9yLT5lbmNvZGVyKTsK
LQkJaWYgKGVuY29kZXIgJiYgZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRFBfTVNUKQot
CQkJY29udGludWU7Ci0KLQkJaWYgKGVuY29kZXIgJiYgY29ubmVjdG9yLT5zdGF0dXMgPT0gY29u
bmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpIHsKLQkJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2Rw
KGVuY29kZXIpOwotCQkJc3RhdHVzID0ga3N0cnRvaW50KGlucHV0X2J1ZmZlciwgMTAsICZ2YWwp
OwotCQkJaWYgKHN0YXR1cyA8IDApCi0JCQkJYnJlYWs7Ci0JCQlkcm1fZGJnKCZ0b19pOTE1KGRl
diktPmRybSwKLQkJCQkiR290ICVkIGZvciB0ZXN0IGFjdGl2ZVxuIiwgdmFsKTsKLQkJCS8qIFRv
IHByZXZlbnQgZXJyb25lb3VzIGFjdGl2YXRpb24gb2YgdGhlIGNvbXBsaWFuY2UKLQkJCSAqIHRl
c3RpbmcgY29kZSwgb25seSBhY2NlcHQgYW4gYWN0dWFsIHZhbHVlIG9mIDEgaGVyZQotCQkJICov
Ci0JCQlpZiAodmFsID09IDEpCi0JCQkJaW50ZWxfZHAtPmNvbXBsaWFuY2UudGVzdF9hY3RpdmUg
PSB0cnVlOwotCQkJZWxzZQotCQkJCWludGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfYWN0aXZlID0g
ZmFsc2U7Ci0JCX0KLQl9Ci0JZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2l0ZXIp
OwotCWtmcmVlKGlucHV0X2J1ZmZlcik7Ci0JaWYgKHN0YXR1cyA8IDApCi0JCXJldHVybiBzdGF0
dXM7Ci0KLQkqb2ZmcCArPSBsZW47Ci0JcmV0dXJuIGxlbjsKLX0KLQotc3RhdGljIGludCBpOTE1
X2Rpc3BsYXlwb3J0X3Rlc3RfYWN0aXZlX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpk
YXRhKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7
Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwotCXN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uZWN0b3I7Ci0Jc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNv
bm5faXRlcjsKLQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwotCi0JZHJtX2Nvbm5lY3Rvcl9s
aXN0X2l0ZXJfYmVnaW4oZGV2LCAmY29ubl9pdGVyKTsKLQlkcm1fZm9yX2VhY2hfY29ubmVjdG9y
X2l0ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7Ci0JCXN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyOwotCi0JCWlmIChjb25uZWN0b3ItPmNvbm5lY3Rvcl90eXBlICE9Ci0JCSAgICBEUk1f
TU9ERV9DT05ORUNUT1JfRGlzcGxheVBvcnQpCi0JCQljb250aW51ZTsKLQotCQllbmNvZGVyID0g
dG9faW50ZWxfZW5jb2Rlcihjb25uZWN0b3ItPmVuY29kZXIpOwotCQlpZiAoZW5jb2RlciAmJiBl
bmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9EUF9NU1QpCi0JCQljb250aW51ZTsKLQotCQlp
ZiAoZW5jb2RlciAmJiBjb25uZWN0b3ItPnN0YXR1cyA9PSBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5l
Y3RlZCkgewotCQkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7Ci0JCQlpZiAo
aW50ZWxfZHAtPmNvbXBsaWFuY2UudGVzdF9hY3RpdmUpCi0JCQkJc2VxX3B1dHMobSwgIjEiKTsK
LQkJCWVsc2UKLQkJCQlzZXFfcHV0cyhtLCAiMCIpOwotCQl9IGVsc2UKLQkJCXNlcV9wdXRzKG0s
ICIwIik7Ci0JfQotCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKLQot
CXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGk5MTVfZGlzcGxheXBvcnRfdGVzdF9hY3RpdmVf
b3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLAotCQkJCQkgICAgIHN0cnVjdCBmaWxlICpmaWxlKQot
ewotCXJldHVybiBzaW5nbGVfb3BlbihmaWxlLCBpOTE1X2Rpc3BsYXlwb3J0X3Rlc3RfYWN0aXZl
X3Nob3csCi0JCQkgICBpbm9kZS0+aV9wcml2YXRlKTsKLX0KLQotc3RhdGljIGNvbnN0IHN0cnVj
dCBmaWxlX29wZXJhdGlvbnMgaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2FjdGl2ZV9mb3BzID0gewot
CS5vd25lciA9IFRISVNfTU9EVUxFLAotCS5vcGVuID0gaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2Fj
dGl2ZV9vcGVuLAotCS5yZWFkID0gc2VxX3JlYWQsCi0JLmxsc2VlayA9IHNlcV9sc2VlaywKLQku
cmVsZWFzZSA9IHNpbmdsZV9yZWxlYXNlLAotCS53cml0ZSA9IGk5MTVfZGlzcGxheXBvcnRfdGVz
dF9hY3RpdmVfd3JpdGUKLX07Ci0KLXN0YXRpYyBpbnQgaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2Rh
dGFfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcjsK
LQlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXIgY29ubl9pdGVyOwotCXN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHA7Ci0KLQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9iZWdpbihkZXYsICZj
b25uX2l0ZXIpOwotCWRybV9mb3JfZWFjaF9jb25uZWN0b3JfaXRlcihjb25uZWN0b3IsICZjb25u
X2l0ZXIpIHsKLQkJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7Ci0KLQkJaWYgKGNvbm5l
Y3Rvci0+Y29ubmVjdG9yX3R5cGUgIT0KLQkJICAgIERSTV9NT0RFX0NPTk5FQ1RPUl9EaXNwbGF5
UG9ydCkKLQkJCWNvbnRpbnVlOwotCi0JCWVuY29kZXIgPSB0b19pbnRlbF9lbmNvZGVyKGNvbm5l
Y3Rvci0+ZW5jb2Rlcik7Ci0JCWlmIChlbmNvZGVyICYmIGVuY29kZXItPnR5cGUgPT0gSU5URUxf
T1VUUFVUX0RQX01TVCkKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChlbmNvZGVyICYmIGNvbm5lY3Rv
ci0+c3RhdHVzID09IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkKSB7Ci0JCQlpbnRlbF9kcCA9
IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKLQkJCWlmIChpbnRlbF9kcC0+Y29tcGxpYW5jZS50
ZXN0X3R5cGUgPT0KLQkJCSAgICBEUF9URVNUX0xJTktfRURJRF9SRUFEKQotCQkJCXNlcV9wcmlu
dGYobSwgIiVseCIsCi0JCQkJCSAgIGludGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfZGF0YS5lZGlk
KTsKLQkJCWVsc2UgaWYgKGludGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfdHlwZSA9PQotCQkJCSBE
UF9URVNUX0xJTktfVklERU9fUEFUVEVSTikgewotCQkJCXNlcV9wcmludGYobSwgImhkaXNwbGF5
OiAlZFxuIiwKLQkJCQkJICAgaW50ZWxfZHAtPmNvbXBsaWFuY2UudGVzdF9kYXRhLmhkaXNwbGF5
KTsKLQkJCQlzZXFfcHJpbnRmKG0sICJ2ZGlzcGxheTogJWRcbiIsCi0JCQkJCSAgIGludGVsX2Rw
LT5jb21wbGlhbmNlLnRlc3RfZGF0YS52ZGlzcGxheSk7Ci0JCQkJc2VxX3ByaW50ZihtLCAiYnBj
OiAldVxuIiwKLQkJCQkJICAgaW50ZWxfZHAtPmNvbXBsaWFuY2UudGVzdF9kYXRhLmJwYyk7Ci0J
CQl9Ci0JCX0gZWxzZQotCQkJc2VxX3B1dHMobSwgIjAiKTsKLQl9Ci0JZHJtX2Nvbm5lY3Rvcl9s
aXN0X2l0ZXJfZW5kKCZjb25uX2l0ZXIpOwotCi0JcmV0dXJuIDA7Ci19Ci1ERUZJTkVfU0hPV19B
VFRSSUJVVEUoaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2RhdGEpOwotCi1zdGF0aWMgaW50IGk5MTVf
ZGlzcGxheXBvcnRfdGVzdF90eXBlX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRh
KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7Ci0J
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwotCXN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3I7Ci0Jc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNvbm5f
aXRlcjsKLQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwotCi0JZHJtX2Nvbm5lY3Rvcl9saXN0
X2l0ZXJfYmVnaW4oZGV2LCAmY29ubl9pdGVyKTsKLQlkcm1fZm9yX2VhY2hfY29ubmVjdG9yX2l0
ZXIoY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7Ci0JCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyOwotCi0JCWlmIChjb25uZWN0b3ItPmNvbm5lY3Rvcl90eXBlICE9Ci0JCSAgICBEUk1fTU9E
RV9DT05ORUNUT1JfRGlzcGxheVBvcnQpCi0JCQljb250aW51ZTsKLQotCQllbmNvZGVyID0gdG9f
aW50ZWxfZW5jb2Rlcihjb25uZWN0b3ItPmVuY29kZXIpOwotCQlpZiAoZW5jb2RlciAmJiBlbmNv
ZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9EUF9NU1QpCi0JCQljb250aW51ZTsKLQotCQlpZiAo
ZW5jb2RlciAmJiBjb25uZWN0b3ItPnN0YXR1cyA9PSBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3Rl
ZCkgewotCQkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7Ci0JCQlzZXFfcHJp
bnRmKG0sICIlMDJseCIsIGludGVsX2RwLT5jb21wbGlhbmNlLnRlc3RfdHlwZSk7Ci0JCX0gZWxz
ZQotCQkJc2VxX3B1dHMobSwgIjAiKTsKLQl9Ci0JZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5k
KCZjb25uX2l0ZXIpOwotCi0JcmV0dXJuIDA7Ci19Ci1ERUZJTkVfU0hPV19BVFRSSUJVVEUoaTkx
NV9kaXNwbGF5cG9ydF90ZXN0X3R5cGUpOwotCi1zdGF0aWMgdm9pZCB3bV9sYXRlbmN5X3Nob3co
c3RydWN0IHNlcV9maWxlICptLCBjb25zdCB1MTYgd21bOF0pCi17Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gJmRldl9wcml2LT5kcm07Ci0JaW50IGxldmVsOwotCWludCBudW1fbGV2ZWxzOwotCi0JaWYg
KElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKQotCQludW1fbGV2ZWxzID0gMzsKLQllbHNlIGlmIChJ
U19WQUxMRVlWSUVXKGRldl9wcml2KSkKLQkJbnVtX2xldmVscyA9IDE7Ci0JZWxzZSBpZiAoSVNf
RzRYKGRldl9wcml2KSkKLQkJbnVtX2xldmVscyA9IDM7Ci0JZWxzZQotCQludW1fbGV2ZWxzID0g
aWxrX3dtX21heF9sZXZlbChkZXZfcHJpdikgKyAxOwotCi0JZHJtX21vZGVzZXRfbG9ja19hbGwo
ZGV2KTsKLQotCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8IG51bV9sZXZlbHM7IGxldmVsKyspIHsK
LQkJdW5zaWduZWQgaW50IGxhdGVuY3kgPSB3bVtsZXZlbF07Ci0KLQkJLyoKLQkJICogLSBXTTEr
IGxhdGVuY3kgdmFsdWVzIGluIDAuNXVzIHVuaXRzCi0JCSAqIC0gbGF0ZW5jaWVzIGFyZSBpbiB1
cyBvbiBnZW45L3Zsdi9jaHYKLQkJICovCi0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkg
fHwKLQkJICAgIElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8Ci0JCSAgICBJU19DSEVSUllWSUVX
KGRldl9wcml2KSB8fAotCQkgICAgSVNfRzRYKGRldl9wcml2KSkKLQkJCWxhdGVuY3kgKj0gMTA7
Ci0JCWVsc2UgaWYgKGxldmVsID4gMCkKLQkJCWxhdGVuY3kgKj0gNTsKLQotCQlzZXFfcHJpbnRm
KG0sICJXTSVkICV1ICgldS4ldSB1c2VjKVxuIiwKLQkJCSAgIGxldmVsLCB3bVtsZXZlbF0sIGxh
dGVuY3kgLyAxMCwgbGF0ZW5jeSAlIDEwKTsKLQl9Ci0KLQlkcm1fbW9kZXNldF91bmxvY2tfYWxs
KGRldik7Ci19Ci0KLXN0YXRpYyBpbnQgcHJpX3dtX2xhdGVuY3lfc2hvdyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKmRhdGEpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gbS0+cHJpdmF0ZTsKLQljb25zdCB1MTYgKmxhdGVuY2llczsKLQotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDkpCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeTsK
LQllbHNlCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeTsKLQotCXdtX2xh
dGVuY3lfc2hvdyhtLCBsYXRlbmNpZXMpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQg
c3ByX3dtX2xhdGVuY3lfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCi17Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQljb25zdCB1
MTYgKmxhdGVuY2llczsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCi0JCWxhdGVu
Y2llcyA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeTsKLQllbHNlCi0JCWxhdGVuY2llcyA9IGRl
dl9wcml2LT53bS5zcHJfbGF0ZW5jeTsKLQotCXdtX2xhdGVuY3lfc2hvdyhtLCBsYXRlbmNpZXMp
OwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgY3VyX3dtX2xhdGVuY3lfc2hvdyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQljb25zdCB1MTYgKmxhdGVuY2llczsKLQotCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5za2xf
bGF0ZW5jeTsKLQllbHNlCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5jdXJfbGF0ZW5jeTsK
LQotCXdtX2xhdGVuY3lfc2hvdyhtLCBsYXRlbmNpZXMpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0
YXRpYyBpbnQgcHJpX3dtX2xhdGVuY3lfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3Qg
ZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBpbm9k
ZS0+aV9wcml2YXRlOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA1ICYmICFJU19HNFgo
ZGV2X3ByaXYpKQotCQlyZXR1cm4gLUVOT0RFVjsKLQotCXJldHVybiBzaW5nbGVfb3BlbihmaWxl
LCBwcmlfd21fbGF0ZW5jeV9zaG93LCBkZXZfcHJpdik7Ci19Ci0KLXN0YXRpYyBpbnQgc3ByX3dt
X2xhdGVuY3lfb3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKLXsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBpbm9kZS0+aV9wcml2YXRlOwot
Ci0JaWYgKEhBU19HTUNIKGRldl9wcml2KSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQlyZXR1cm4g
c2luZ2xlX29wZW4oZmlsZSwgc3ByX3dtX2xhdGVuY3lfc2hvdywgZGV2X3ByaXYpOwotfQotCi1z
dGF0aWMgaW50IGN1cl93bV9sYXRlbmN5X29wZW4oc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0
IGZpbGUgKmZpbGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gaW5v
ZGUtPmlfcHJpdmF0ZTsKLQotCWlmIChIQVNfR01DSChkZXZfcHJpdikpCi0JCXJldHVybiAtRU5P
REVWOwotCi0JcmV0dXJuIHNpbmdsZV9vcGVuKGZpbGUsIGN1cl93bV9sYXRlbmN5X3Nob3csIGRl
dl9wcml2KTsKLX0KLQotc3RhdGljIHNzaXplX3Qgd21fbGF0ZW5jeV93cml0ZShzdHJ1Y3QgZmls
ZSAqZmlsZSwgY29uc3QgY2hhciBfX3VzZXIgKnVidWYsCi0JCQkJc2l6ZV90IGxlbiwgbG9mZl90
ICpvZmZwLCB1MTYgd21bOF0pCi17Ci0Jc3RydWN0IHNlcV9maWxlICptID0gZmlsZS0+cHJpdmF0
ZV9kYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7
Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwotCXUxNiBuZXdbOF0g
PSB7IDAgfTsKLQlpbnQgbnVtX2xldmVsczsKLQlpbnQgbGV2ZWw7Ci0JaW50IHJldDsKLQljaGFy
IHRtcFszMl07Ci0KLQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCi0JCW51bV9sZXZlbHMg
PSAzOwotCWVsc2UgaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQotCQludW1fbGV2ZWxzID0g
MTsKLQllbHNlIGlmIChJU19HNFgoZGV2X3ByaXYpKQotCQludW1fbGV2ZWxzID0gMzsKLQllbHNl
Ci0JCW51bV9sZXZlbHMgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KSArIDE7Ci0KLQlpZiAo
bGVuID49IHNpemVvZih0bXApKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWlmIChjb3B5X2Zyb21f
dXNlcih0bXAsIHVidWYsIGxlbikpCi0JCXJldHVybiAtRUZBVUxUOwotCi0JdG1wW2xlbl0gPSAn
XDAnOwotCi0JcmV0ID0gc3NjYW5mKHRtcCwgIiVodSAlaHUgJWh1ICVodSAlaHUgJWh1ICVodSAl
aHUiLAotCQkgICAgICZuZXdbMF0sICZuZXdbMV0sICZuZXdbMl0sICZuZXdbM10sCi0JCSAgICAg
Jm5ld1s0XSwgJm5ld1s1XSwgJm5ld1s2XSwgJm5ld1s3XSk7Ci0JaWYgKHJldCAhPSBudW1fbGV2
ZWxzKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWRybV9tb2Rlc2V0X2xvY2tfYWxsKGRldik7Ci0K
LQlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPCBudW1fbGV2ZWxzOyBsZXZlbCsrKQotCQl3bVtsZXZl
bF0gPSBuZXdbbGV2ZWxdOwotCi0JZHJtX21vZGVzZXRfdW5sb2NrX2FsbChkZXYpOworCXdpdGhf
aW50ZWxfcnVudGltZV9wbSgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpIHsKKwkJaWYg
KCFkZXZfcHJpdi0+aXBjX2VuYWJsZWQgJiYgZW5hYmxlKQorCQkJZHJtX2luZm8oJmRldl9wcml2
LT5kcm0sCisJCQkJICJFbmFibGluZyBJUEM6IFdNIHdpbGwgYmUgcHJvcGVyIG9ubHkgYWZ0ZXIg
bmV4dCBjb21taXRcbiIpOworCQlkZXZfcHJpdi0+d20uZGlzdHJ1c3RfYmlvc193bSA9IHRydWU7
CisJCWRldl9wcml2LT5pcGNfZW5hYmxlZCA9IGVuYWJsZTsKKwkJaW50ZWxfZW5hYmxlX2lwYyhk
ZXZfcHJpdik7CisJfQogCiAJcmV0dXJuIGxlbjsKIH0KIAotCi1zdGF0aWMgc3NpemVfdCBwcmlf
d21fbGF0ZW5jeV93cml0ZShzdHJ1Y3QgZmlsZSAqZmlsZSwgY29uc3QgY2hhciBfX3VzZXIgKnVi
dWYsCi0JCQkJICAgIHNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkKLXsKLQlzdHJ1Y3Qgc2VxX2Zp
bGUgKm0gPSBmaWxlLT5wcml2YXRlX2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gbS0+cHJpdmF0ZTsKLQl1MTYgKmxhdGVuY2llczsKLQotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDkpCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeTsK
LQllbHNlCi0JCWxhdGVuY2llcyA9IGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeTsKLQotCXJldHVy
biB3bV9sYXRlbmN5X3dyaXRlKGZpbGUsIHVidWYsIGxlbiwgb2ZmcCwgbGF0ZW5jaWVzKTsKLX0K
LQotc3RhdGljIHNzaXplX3Qgc3ByX3dtX2xhdGVuY3lfd3JpdGUoc3RydWN0IGZpbGUgKmZpbGUs
IGNvbnN0IGNoYXIgX191c2VyICp1YnVmLAotCQkJCSAgICBzaXplX3QgbGVuLCBsb2ZmX3QgKm9m
ZnApCi17Ci0Jc3RydWN0IHNlcV9maWxlICptID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7Ci0JdTE2ICpsYXRlbmNp
ZXM7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQotCQlsYXRlbmNpZXMgPSBkZXZf
cHJpdi0+d20uc2tsX2xhdGVuY3k7Ci0JZWxzZQotCQlsYXRlbmNpZXMgPSBkZXZfcHJpdi0+d20u
c3ByX2xhdGVuY3k7Ci0KLQlyZXR1cm4gd21fbGF0ZW5jeV93cml0ZShmaWxlLCB1YnVmLCBsZW4s
IG9mZnAsIGxhdGVuY2llcyk7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IGN1cl93bV9sYXRlbmN5X3dy
aXRlKHN0cnVjdCBmaWxlICpmaWxlLCBjb25zdCBjaGFyIF9fdXNlciAqdWJ1ZiwKLQkJCQkgICAg
c2l6ZV90IGxlbiwgbG9mZl90ICpvZmZwKQotewotCXN0cnVjdCBzZXFfZmlsZSAqbSA9IGZpbGUt
PnByaXZhdGVfZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5w
cml2YXRlOwotCXUxNiAqbGF0ZW5jaWVzOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSkKLQkJbGF0ZW5jaWVzID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5OwotCWVsc2UKLQkJbGF0
ZW5jaWVzID0gZGV2X3ByaXYtPndtLmN1cl9sYXRlbmN5OwotCi0JcmV0dXJuIHdtX2xhdGVuY3lf
d3JpdGUoZmlsZSwgdWJ1ZiwgbGVuLCBvZmZwLCBsYXRlbmNpZXMpOwotfQotCi1zdGF0aWMgY29u
c3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBpOTE1X3ByaV93bV9sYXRlbmN5X2ZvcHMgPSB7Ci0J
Lm93bmVyID0gVEhJU19NT0RVTEUsCi0JLm9wZW4gPSBwcmlfd21fbGF0ZW5jeV9vcGVuLAotCS5y
ZWFkID0gc2VxX3JlYWQsCi0JLmxsc2VlayA9IHNlcV9sc2VlaywKLQkucmVsZWFzZSA9IHNpbmds
ZV9yZWxlYXNlLAotCS53cml0ZSA9IHByaV93bV9sYXRlbmN5X3dyaXRlCi19OwotCi1zdGF0aWMg
Y29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBpOTE1X3Nwcl93bV9sYXRlbmN5X2ZvcHMgPSB7
Ci0JLm93bmVyID0gVEhJU19NT0RVTEUsCi0JLm9wZW4gPSBzcHJfd21fbGF0ZW5jeV9vcGVuLAot
CS5yZWFkID0gc2VxX3JlYWQsCi0JLmxsc2VlayA9IHNlcV9sc2VlaywKLQkucmVsZWFzZSA9IHNp
bmdsZV9yZWxlYXNlLAotCS53cml0ZSA9IHNwcl93bV9sYXRlbmN5X3dyaXRlCi19OwotCi1zdGF0
aWMgY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBpOTE1X2N1cl93bV9sYXRlbmN5X2ZvcHMg
PSB7CitzdGF0aWMgY29uc3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBpOTE1X2lwY19zdGF0dXNf
Zm9wcyA9IHsKIAkub3duZXIgPSBUSElTX01PRFVMRSwKLQkub3BlbiA9IGN1cl93bV9sYXRlbmN5
X29wZW4sCisJLm9wZW4gPSBpOTE1X2lwY19zdGF0dXNfb3BlbiwKIAkucmVhZCA9IHNlcV9yZWFk
LAogCS5sbHNlZWsgPSBzZXFfbHNlZWssCiAJLnJlbGVhc2UgPSBzaW5nbGVfcmVsZWFzZSwKLQku
d3JpdGUgPSBjdXJfd21fbGF0ZW5jeV93cml0ZQorCS53cml0ZSA9IGk5MTVfaXBjX3N0YXR1c193
cml0ZQogfTsKIAogc3RhdGljIGludApAQCAtMzk0MywyOTUgKzI1NzEsNiBAQCBzdGF0aWMgY29u
c3Qgc3RydWN0IGZpbGVfb3BlcmF0aW9ucyBpOTE1X2ZvcmNld2FrZV9mb3BzID0gewogCS5yZWxl
YXNlID0gaTkxNV9mb3JjZXdha2VfcmVsZWFzZSwKIH07CiAKLXN0YXRpYyBpbnQgaTkxNV9ocGRf
c3Rvcm1fY3RsX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQotewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG0tPnByaXZhdGU7Ci0Jc3RydWN0IGk5MTVf
aG90cGx1ZyAqaG90cGx1ZyA9ICZkZXZfcHJpdi0+aG90cGx1ZzsKLQotCS8qIFN5bmNocm9uaXpl
IHdpdGggZXZlcnl0aGluZyBmaXJzdCBpbiBjYXNlIHRoZXJlJ3MgYmVlbiBhbiBIUEQKLQkgKiBz
dG9ybSwgYnV0IHdlIGhhdmVuJ3QgZmluaXNoZWQgaGFuZGxpbmcgaXQgaW4gdGhlIGtlcm5lbCB5
ZXQKLQkgKi8KLQlpbnRlbF9zeW5jaHJvbml6ZV9pcnEoZGV2X3ByaXYpOwotCWZsdXNoX3dvcmso
JmRldl9wcml2LT5ob3RwbHVnLmRpZ19wb3J0X3dvcmspOwotCWZsdXNoX2RlbGF5ZWRfd29yaygm
ZGV2X3ByaXYtPmhvdHBsdWcuaG90cGx1Z193b3JrKTsKLQotCXNlcV9wcmludGYobSwgIlRocmVz
aG9sZDogJWRcbiIsIGhvdHBsdWctPmhwZF9zdG9ybV90aHJlc2hvbGQpOwotCXNlcV9wcmludGYo
bSwgIkRldGVjdGVkOiAlc1xuIiwKLQkJICAgeWVzbm8oZGVsYXllZF93b3JrX3BlbmRpbmcoJmhv
dHBsdWctPnJlZW5hYmxlX3dvcmspKSk7Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIHNzaXpl
X3QgaTkxNV9ocGRfc3Rvcm1fY3RsX3dyaXRlKHN0cnVjdCBmaWxlICpmaWxlLAotCQkJCQljb25z
dCBjaGFyIF9fdXNlciAqdWJ1Ziwgc2l6ZV90IGxlbiwKLQkJCQkJbG9mZl90ICpvZmZwKQotewot
CXN0cnVjdCBzZXFfZmlsZSAqbSA9IGZpbGUtPnByaXZhdGVfZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBtLT5wcml2YXRlOwotCXN0cnVjdCBpOTE1X2hvdHBsdWcg
KmhvdHBsdWcgPSAmZGV2X3ByaXYtPmhvdHBsdWc7Ci0JdW5zaWduZWQgaW50IG5ld190aHJlc2hv
bGQ7Ci0JaW50IGk7Ci0JY2hhciAqbmV3bGluZTsKLQljaGFyIHRtcFsxNl07Ci0KLQlpZiAobGVu
ID49IHNpemVvZih0bXApKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWlmIChjb3B5X2Zyb21fdXNl
cih0bXAsIHVidWYsIGxlbikpCi0JCXJldHVybiAtRUZBVUxUOwotCi0JdG1wW2xlbl0gPSAnXDAn
OwotCi0JLyogU3RyaXAgbmV3bGluZSwgaWYgYW55ICovCi0JbmV3bGluZSA9IHN0cmNocih0bXAs
ICdcbicpOwotCWlmIChuZXdsaW5lKQotCQkqbmV3bGluZSA9ICdcMCc7Ci0KLQlpZiAoc3RyY21w
KHRtcCwgInJlc2V0IikgPT0gMCkKLQkJbmV3X3RocmVzaG9sZCA9IEhQRF9TVE9STV9ERUZBVUxU
X1RIUkVTSE9MRDsKLQllbHNlIGlmIChrc3RydG91aW50KHRtcCwgMTAsICZuZXdfdGhyZXNob2xk
KSAhPSAwKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWlmIChuZXdfdGhyZXNob2xkID4gMCkKLQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlNldHRpbmcgSFBEIHN0b3JtIGRl
dGVjdGlvbiB0aHJlc2hvbGQgdG8gJWRcbiIsCi0JCQkgICAgbmV3X3RocmVzaG9sZCk7Ci0JZWxz
ZQotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkRpc2FibGluZyBIUEQgc3Rvcm0gZGV0
ZWN0aW9uXG4iKTsKLQotCXNwaW5fbG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JaG90
cGx1Zy0+aHBkX3N0b3JtX3RocmVzaG9sZCA9IG5ld190aHJlc2hvbGQ7Ci0JLyogUmVzZXQgdGhl
IEhQRCBzdG9ybSBzdGF0cyBzbyB3ZSBkb24ndCBhY2NpZGVudGFsbHkgdHJpZ2dlciBhIHN0b3Jt
ICovCi0JZm9yX2VhY2hfaHBkX3BpbihpKQotCQlob3RwbHVnLT5zdGF0c1tpXS5jb3VudCA9IDA7
Ci0Jc3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOwotCi0JLyogUmUtZW5hYmxl
IGhwZCBpbW1lZGlhdGVseSBpZiB3ZSB3ZXJlIGluIGFuIGlycSBzdG9ybSAqLwotCWZsdXNoX2Rl
bGF5ZWRfd29yaygmZGV2X3ByaXYtPmhvdHBsdWcucmVlbmFibGVfd29yayk7Ci0KLQlyZXR1cm4g
bGVuOwotfQotCi1zdGF0aWMgaW50IGk5MTVfaHBkX3N0b3JtX2N0bF9vcGVuKHN0cnVjdCBpbm9k
ZSAqaW5vZGUsIHN0cnVjdCBmaWxlICpmaWxlKQotewotCXJldHVybiBzaW5nbGVfb3BlbihmaWxl
LCBpOTE1X2hwZF9zdG9ybV9jdGxfc2hvdywgaW5vZGUtPmlfcHJpdmF0ZSk7Ci19Ci0KLXN0YXRp
YyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVfaHBkX3N0b3JtX2N0bF9mb3BzID0g
ewotCS5vd25lciA9IFRISVNfTU9EVUxFLAotCS5vcGVuID0gaTkxNV9ocGRfc3Rvcm1fY3RsX29w
ZW4sCi0JLnJlYWQgPSBzZXFfcmVhZCwKLQkubGxzZWVrID0gc2VxX2xzZWVrLAotCS5yZWxlYXNl
ID0gc2luZ2xlX3JlbGVhc2UsCi0JLndyaXRlID0gaTkxNV9ocGRfc3Rvcm1fY3RsX3dyaXRlCi19
OwotCi1zdGF0aWMgaW50IGk5MTVfaHBkX3Nob3J0X3N0b3JtX2N0bF9zaG93KHN0cnVjdCBzZXFf
ZmlsZSAqbSwgdm9pZCAqZGF0YSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBtLT5wcml2YXRlOwotCi0Jc2VxX3ByaW50ZihtLCAiRW5hYmxlZDogJXNcbiIsCi0JCSAg
IHllc25vKGRldl9wcml2LT5ob3RwbHVnLmhwZF9zaG9ydF9zdG9ybV9lbmFibGVkKSk7Ci0KLQly
ZXR1cm4gMDsKLX0KLQotc3RhdGljIGludAotaTkxNV9ocGRfc2hvcnRfc3Rvcm1fY3RsX29wZW4o
c3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCi17Ci0JcmV0dXJuIHNpbmds
ZV9vcGVuKGZpbGUsIGk5MTVfaHBkX3Nob3J0X3N0b3JtX2N0bF9zaG93LAotCQkJICAgaW5vZGUt
PmlfcHJpdmF0ZSk7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90IGk5MTVfaHBkX3Nob3J0X3N0b3JtX2N0
bF93cml0ZShzdHJ1Y3QgZmlsZSAqZmlsZSwKLQkJCQkJICAgICAgY29uc3QgY2hhciBfX3VzZXIg
KnVidWYsCi0JCQkJCSAgICAgIHNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkKLXsKLQlzdHJ1Y3Qg
c2VxX2ZpbGUgKm0gPSBmaWxlLT5wcml2YXRlX2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgaTkxNV9ob3RwbHVnICpob3RwbHVn
ID0gJmRldl9wcml2LT5ob3RwbHVnOwotCWNoYXIgKm5ld2xpbmU7Ci0JY2hhciB0bXBbMTZdOwot
CWludCBpOwotCWJvb2wgbmV3X3N0YXRlOwotCi0JaWYgKGxlbiA+PSBzaXplb2YodG1wKSkKLQkJ
cmV0dXJuIC1FSU5WQUw7Ci0KLQlpZiAoY29weV9mcm9tX3VzZXIodG1wLCB1YnVmLCBsZW4pKQot
CQlyZXR1cm4gLUVGQVVMVDsKLQotCXRtcFtsZW5dID0gJ1wwJzsKLQotCS8qIFN0cmlwIG5ld2xp
bmUsIGlmIGFueSAqLwotCW5ld2xpbmUgPSBzdHJjaHIodG1wLCAnXG4nKTsKLQlpZiAobmV3bGlu
ZSkKLQkJKm5ld2xpbmUgPSAnXDAnOwotCi0JLyogUmVzZXQgdG8gdGhlICJkZWZhdWx0IiBzdGF0
ZSBmb3IgdGhpcyBzeXN0ZW0gKi8KLQlpZiAoc3RyY21wKHRtcCwgInJlc2V0IikgPT0gMCkKLQkJ
bmV3X3N0YXRlID0gIUhBU19EUF9NU1QoZGV2X3ByaXYpOwotCWVsc2UgaWYgKGtzdHJ0b2Jvb2wo
dG1wLCAmbmV3X3N0YXRlKSAhPSAwKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLCAiJXNhYmxpbmcgSFBEIHNob3J0IHN0b3JtIGRldGVjdGlvblxuIiwK
LQkJICAgIG5ld19zdGF0ZSA/ICJFbiIgOiAiRGlzIik7Ci0KLQlzcGluX2xvY2tfaXJxKCZkZXZf
cHJpdi0+aXJxX2xvY2spOwotCWhvdHBsdWctPmhwZF9zaG9ydF9zdG9ybV9lbmFibGVkID0gbmV3
X3N0YXRlOwotCS8qIFJlc2V0IHRoZSBIUEQgc3Rvcm0gc3RhdHMgc28gd2UgZG9uJ3QgYWNjaWRl
bnRhbGx5IHRyaWdnZXIgYSBzdG9ybSAqLwotCWZvcl9lYWNoX2hwZF9waW4oaSkKLQkJaG90cGx1
Zy0+c3RhdHNbaV0uY291bnQgPSAwOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9s
b2NrKTsKLQotCS8qIFJlLWVuYWJsZSBocGQgaW1tZWRpYXRlbHkgaWYgd2Ugd2VyZSBpbiBhbiBp
cnEgc3Rvcm0gKi8KLQlmbHVzaF9kZWxheWVkX3dvcmsoJmRldl9wcml2LT5ob3RwbHVnLnJlZW5h
YmxlX3dvcmspOwotCi0JcmV0dXJuIGxlbjsKLX0KLQotc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxl
X29wZXJhdGlvbnMgaTkxNV9ocGRfc2hvcnRfc3Rvcm1fY3RsX2ZvcHMgPSB7Ci0JLm93bmVyID0g
VEhJU19NT0RVTEUsCi0JLm9wZW4gPSBpOTE1X2hwZF9zaG9ydF9zdG9ybV9jdGxfb3BlbiwKLQku
cmVhZCA9IHNlcV9yZWFkLAotCS5sbHNlZWsgPSBzZXFfbHNlZWssCi0JLnJlbGVhc2UgPSBzaW5n
bGVfcmVsZWFzZSwKLQkud3JpdGUgPSBpOTE1X2hwZF9zaG9ydF9zdG9ybV9jdGxfd3JpdGUsCi19
OwotCi1zdGF0aWMgaW50IGk5MTVfZHJyc19jdGxfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCi17
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsKLQlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGM7
Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDcpCi0JCXJldHVybiAtRU5PREVWOwotCi0J
Zm9yX2VhY2hfaW50ZWxfY3J0YyhkZXYsIGNydGMpIHsKLQkJc3RydWN0IGRybV9jb25uZWN0b3Jf
bGlzdF9pdGVyIGNvbm5faXRlcjsKLQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGU7Ci0JCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7Ci0JCXN0cnVjdCBkcm1fY3J0
Y19jb21taXQgKmNvbW1pdDsKLQkJaW50IHJldDsKLQotCQlyZXQgPSBkcm1fbW9kZXNldF9sb2Nr
X3NpbmdsZV9pbnRlcnJ1cHRpYmxlKCZjcnRjLT5iYXNlLm11dGV4KTsKLQkJaWYgKHJldCkKLQkJ
CXJldHVybiByZXQ7Ci0KLQkJY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+
YmFzZS5zdGF0ZSk7Ci0KLQkJaWYgKCFjcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKLQkJICAgICFj
cnRjX3N0YXRlLT5oYXNfZHJycykKLQkJCWdvdG8gb3V0OwotCi0JCWNvbW1pdCA9IGNydGNfc3Rh
dGUtPnVhcGkuY29tbWl0OwotCQlpZiAoY29tbWl0KSB7Ci0JCQlyZXQgPSB3YWl0X2Zvcl9jb21w
bGV0aW9uX2ludGVycnVwdGlibGUoJmNvbW1pdC0+aHdfZG9uZSk7Ci0JCQlpZiAocmV0KQotCQkJ
CWdvdG8gb3V0OwotCQl9Ci0KLQkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfYmVnaW4oZGV2LCAm
Y29ubl9pdGVyKTsKLQkJZHJtX2Zvcl9lYWNoX2Nvbm5lY3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNv
bm5faXRlcikgewotCQkJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7Ci0JCQlzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwOwotCi0JCQlpZiAoIShjcnRjX3N0YXRlLT51YXBpLmNvbm5lY3Rv
cl9tYXNrICYKLQkJCSAgICAgIGRybV9jb25uZWN0b3JfbWFzayhjb25uZWN0b3IpKSkKLQkJCQlj
b250aW51ZTsKLQotCQkJZW5jb2RlciA9IGludGVsX2F0dGFjaGVkX2VuY29kZXIodG9faW50ZWxf
Y29ubmVjdG9yKGNvbm5lY3RvcikpOwotCQkJaWYgKGVuY29kZXItPnR5cGUgIT0gSU5URUxfT1VU
UFVUX0VEUCkKLQkJCQljb250aW51ZTsKLQotCQkJZHJtX2RiZygmZGV2X3ByaXYtPmRybSwKLQkJ
CQkiTWFudWFsbHkgJXNhYmxpbmcgRFJSUy4gJWxsdVxuIiwKLQkJCQl2YWwgPyAiZW4iIDogImRp
cyIsIHZhbCk7Ci0KLQkJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOwotCQkJ
aWYgKHZhbCkKLQkJCQlpbnRlbF9lZHBfZHJyc19lbmFibGUoaW50ZWxfZHAsCi0JCQkJCQkgICAg
ICBjcnRjX3N0YXRlKTsKLQkJCWVsc2UKLQkJCQlpbnRlbF9lZHBfZHJyc19kaXNhYmxlKGludGVs
X2RwLAotCQkJCQkJICAgICAgIGNydGNfc3RhdGUpOwotCQl9Ci0JCWRybV9jb25uZWN0b3JfbGlz
dF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKLQotb3V0OgotCQlkcm1fbW9kZXNldF91bmxvY2soJmNy
dGMtPmJhc2UubXV0ZXgpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQl9Ci0KLQlyZXR1
cm4gMDsKLX0KLQotREVGSU5FX1NJTVBMRV9BVFRSSUJVVEUoaTkxNV9kcnJzX2N0bF9mb3BzLCBO
VUxMLCBpOTE1X2RycnNfY3RsX3NldCwgIiVsbHVcbiIpOwotCi1zdGF0aWMgc3NpemVfdAotaTkx
NV9maWZvX3VuZGVycnVuX3Jlc2V0X3dyaXRlKHN0cnVjdCBmaWxlICpmaWxwLAotCQkJICAgICAg
IGNvbnN0IGNoYXIgX191c2VyICp1YnVmLAotCQkJICAgICAgIHNpemVfdCBjbnQsIGxvZmZfdCAq
cHBvcykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBmaWxwLT5wcml2
YXRlX2RhdGE7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGM7Ci0Jc3RydWN0IGRybV9k
ZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwotCWludCByZXQ7Ci0JYm9vbCByZXNldDsKLQot
CXJldCA9IGtzdHJ0b2Jvb2xfZnJvbV91c2VyKHVidWYsIGNudCwgJnJlc2V0KTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKCFyZXNldCkKLQkJcmV0dXJuIGNudDsKLQotCWZvcl9l
YWNoX2ludGVsX2NydGMoZGV2LCBpbnRlbF9jcnRjKSB7Ci0JCXN0cnVjdCBkcm1fY3J0Y19jb21t
aXQgKmNvbW1pdDsKLQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7Ci0KLQkJ
cmV0ID0gZHJtX21vZGVzZXRfbG9ja19zaW5nbGVfaW50ZXJydXB0aWJsZSgmaW50ZWxfY3J0Yy0+
YmFzZS5tdXRleCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCWNydGNfc3RhdGUg
PSB0b19pbnRlbF9jcnRjX3N0YXRlKGludGVsX2NydGMtPmJhc2Uuc3RhdGUpOwotCQljb21taXQg
PSBjcnRjX3N0YXRlLT51YXBpLmNvbW1pdDsKLQkJaWYgKGNvbW1pdCkgewotCQkJcmV0ID0gd2Fp
dF9mb3JfY29tcGxldGlvbl9pbnRlcnJ1cHRpYmxlKCZjb21taXQtPmh3X2RvbmUpOwotCQkJaWYg
KCFyZXQpCi0JCQkJcmV0ID0gd2FpdF9mb3JfY29tcGxldGlvbl9pbnRlcnJ1cHRpYmxlKCZjb21t
aXQtPmZsaXBfZG9uZSk7Ci0JCX0KLQotCQlpZiAoIXJldCAmJiBjcnRjX3N0YXRlLT5ody5hY3Rp
dmUpIHsKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAiUmUtYXJtaW5n
IEZJRk8gdW5kZXJydW5zIG9uIHBpcGUgJWNcbiIsCi0JCQkJICAgIHBpcGVfbmFtZShpbnRlbF9j
cnRjLT5waXBlKSk7Ci0KLQkJCWludGVsX2NydGNfYXJtX2ZpZm9fdW5kZXJydW4oaW50ZWxfY3J0
YywgY3J0Y19zdGF0ZSk7Ci0JCX0KLQotCQlkcm1fbW9kZXNldF91bmxvY2soJmludGVsX2NydGMt
PmJhc2UubXV0ZXgpOwotCi0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCXJldCA9
IGludGVsX2ZiY19yZXNldF91bmRlcnJ1bihkZXZfcHJpdik7Ci0JaWYgKHJldCkKLQkJcmV0dXJu
IHJldDsKLQotCXJldHVybiBjbnQ7Ci19Ci0KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVy
YXRpb25zIGk5MTVfZmlmb191bmRlcnJ1bl9yZXNldF9vcHMgPSB7Ci0JLm93bmVyID0gVEhJU19N
T0RVTEUsCi0JLm9wZW4gPSBzaW1wbGVfb3BlbiwKLQkud3JpdGUgPSBpOTE1X2ZpZm9fdW5kZXJy
dW5fcmVzZXRfd3JpdGUsCi0JLmxsc2VlayA9IGRlZmF1bHRfbGxzZWVrLAotfTsKLQogc3RhdGlj
IGNvbnN0IHN0cnVjdCBkcm1faW5mb19saXN0IGk5MTVfZGVidWdmc19saXN0W10gPSB7CiAJeyJp
OTE1X2NhcGFiaWxpdGllcyIsIGk5MTVfY2FwYWJpbGl0aWVzLCAwfSwKIAl7Imk5MTVfZ2VtX29i
amVjdHMiLCBpOTE1X2dlbV9vYmplY3RfaW5mbywgMH0sCkBAIC00MjQ3LDMxICsyNTg2LDIwIEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2luZm9fbGlzdCBpOTE1X2RlYnVnZnNfbGlzdFtdID0g
ewogCXsiaTkxNV9kcnBjX2luZm8iLCBpOTE1X2RycGNfaW5mbywgMH0sCiAJeyJpOTE1X3Jpbmdf
ZnJlcV90YWJsZSIsIGk5MTVfcmluZ19mcmVxX3RhYmxlLCAwfSwKIAl7Imk5MTVfZnJvbnRidWZm
ZXJfdHJhY2tpbmciLCBpOTE1X2Zyb250YnVmZmVyX3RyYWNraW5nLCAwfSwKLQl7Imk5MTVfZmJj
X3N0YXR1cyIsIGk5MTVfZmJjX3N0YXR1cywgMH0sCi0JeyJpOTE1X2lwc19zdGF0dXMiLCBpOTE1
X2lwc19zdGF0dXMsIDB9LAotCXsiaTkxNV9zcl9zdGF0dXMiLCBpOTE1X3NyX3N0YXR1cywgMH0s
Ci0JeyJpOTE1X29wcmVnaW9uIiwgaTkxNV9vcHJlZ2lvbiwgMH0sCi0JeyJpOTE1X3ZidCIsIGk5
MTVfdmJ0LCAwfSwKIAl7Imk5MTVfZ2VtX2ZyYW1lYnVmZmVyIiwgaTkxNV9nZW1fZnJhbWVidWZm
ZXJfaW5mbywgMH0sCiAJeyJpOTE1X2NvbnRleHRfc3RhdHVzIiwgaTkxNV9jb250ZXh0X3N0YXR1
cywgMH0sCiAJeyJpOTE1X2ZvcmNld2FrZV9kb21haW5zIiwgaTkxNV9mb3JjZXdha2VfZG9tYWlu
cywgMH0sCiAJeyJpOTE1X3N3aXp6bGVfaW5mbyIsIGk5MTVfc3dpenpsZV9pbmZvLCAwfSwKIAl7
Imk5MTVfbGxjIiwgaTkxNV9sbGMsIDB9LAotCXsiaTkxNV9lZHBfcHNyX3N0YXR1cyIsIGk5MTVf
ZWRwX3Bzcl9zdGF0dXMsIDB9LAogCXsiaTkxNV9lbmVyZ3lfdUoiLCBpOTE1X2VuZXJneV91Siwg
MH0sCiAJeyJpOTE1X3J1bnRpbWVfcG1fc3RhdHVzIiwgaTkxNV9ydW50aW1lX3BtX3N0YXR1cywg
MH0sCiAJeyJpOTE1X3Bvd2VyX2RvbWFpbl9pbmZvIiwgaTkxNV9wb3dlcl9kb21haW5faW5mbywg
MH0sCiAJeyJpOTE1X2RtY19pbmZvIiwgaTkxNV9kbWNfaW5mbywgMH0sCi0JeyJpOTE1X2Rpc3Bs
YXlfaW5mbyIsIGk5MTVfZGlzcGxheV9pbmZvLCAwfSwKIAl7Imk5MTVfZW5naW5lX2luZm8iLCBp
OTE1X2VuZ2luZV9pbmZvLCAwfSwKIAl7Imk5MTVfcmNzX3RvcG9sb2d5IiwgaTkxNV9yY3NfdG9w
b2xvZ3ksIDB9LAogCXsiaTkxNV9zaHJpbmtlcl9pbmZvIiwgaTkxNV9zaHJpbmtlcl9pbmZvLCAw
fSwKLQl7Imk5MTVfc2hhcmVkX2RwbGxzX2luZm8iLCBpOTE1X3NoYXJlZF9kcGxsc19pbmZvLCAw
fSwKLQl7Imk5MTVfZHBfbXN0X2luZm8iLCBpOTE1X2RwX21zdF9pbmZvLCAwfSwKIAl7Imk5MTVf
d2FfcmVnaXN0ZXJzIiwgaTkxNV93YV9yZWdpc3RlcnMsIDB9LAotCXsiaTkxNV9kZGJfaW5mbyIs
IGk5MTVfZGRiX2luZm8sIDB9LAogCXsiaTkxNV9zc2V1X3N0YXR1cyIsIGk5MTVfc3NldV9zdGF0
dXMsIDB9LAotCXsiaTkxNV9kcnJzX3N0YXR1cyIsIGk5MTVfZHJyc19zdGF0dXMsIDB9LAogCXsi
aTkxNV9ycHNfYm9vc3RfaW5mbyIsIGk5MTVfcnBzX2Jvb3N0X2luZm8sIDB9LAogfTsKICNkZWZp
bmUgSTkxNV9ERUJVR0ZTX0VOVFJJRVMgQVJSQVlfU0laRShpOTE1X2RlYnVnZnNfbGlzdCkKQEAg
LTQyODgsMjEgKzI2MTYsOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfZGVidWdmc19maWxl
cyB7CiAJeyJpOTE1X2Vycm9yX3N0YXRlIiwgJmk5MTVfZXJyb3Jfc3RhdGVfZm9wc30sCiAJeyJp
OTE1X2dwdV9pbmZvIiwgJmk5MTVfZ3B1X2luZm9fZm9wc30sCiAjZW5kaWYKLQl7Imk5MTVfZmlm
b191bmRlcnJ1bl9yZXNldCIsICZpOTE1X2ZpZm9fdW5kZXJydW5fcmVzZXRfb3BzfSwKLQl7Imk5
MTVfcHJpX3dtX2xhdGVuY3kiLCAmaTkxNV9wcmlfd21fbGF0ZW5jeV9mb3BzfSwKLQl7Imk5MTVf
c3ByX3dtX2xhdGVuY3kiLCAmaTkxNV9zcHJfd21fbGF0ZW5jeV9mb3BzfSwKLQl7Imk5MTVfY3Vy
X3dtX2xhdGVuY3kiLCAmaTkxNV9jdXJfd21fbGF0ZW5jeV9mb3BzfSwKLQl7Imk5MTVfZmJjX2Zh
bHNlX2NvbG9yIiwgJmk5MTVfZmJjX2ZhbHNlX2NvbG9yX2ZvcHN9LAotCXsiaTkxNV9kcF90ZXN0
X2RhdGEiLCAmaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2RhdGFfZm9wc30sCi0JeyJpOTE1X2RwX3Rl
c3RfdHlwZSIsICZpOTE1X2Rpc3BsYXlwb3J0X3Rlc3RfdHlwZV9mb3BzfSwKLQl7Imk5MTVfZHBf
dGVzdF9hY3RpdmUiLCAmaTkxNV9kaXNwbGF5cG9ydF90ZXN0X2FjdGl2ZV9mb3BzfSwKIAl7Imk5
MTVfZ3VjX2xvZ19sZXZlbCIsICZpOTE1X2d1Y19sb2dfbGV2ZWxfZm9wc30sCiAJeyJpOTE1X2d1
Y19sb2dfcmVsYXkiLCAmaTkxNV9ndWNfbG9nX3JlbGF5X2ZvcHN9LAotCXsiaTkxNV9ocGRfc3Rv
cm1fY3RsIiwgJmk5MTVfaHBkX3N0b3JtX2N0bF9mb3BzfSwKLQl7Imk5MTVfaHBkX3Nob3J0X3N0
b3JtX2N0bCIsICZpOTE1X2hwZF9zaG9ydF9zdG9ybV9jdGxfZm9wc30sCiAJeyJpOTE1X2lwY19z
dGF0dXMiLCAmaTkxNV9pcGNfc3RhdHVzX2ZvcHN9LAotCXsiaTkxNV9kcnJzX2N0bCIsICZpOTE1
X2RycnNfY3RsX2ZvcHN9LAotCXsiaTkxNV9lZHBfcHNyX2RlYnVnIiwgJmk5MTVfZWRwX3Bzcl9k
ZWJ1Z19mb3BzfQogfTsKIAogaW50IGk5MTVfZGVidWdmc19yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC00MzI2LDE5MSArMjY0MiwzIEBAIGludCBpOTE1X2Rl
YnVnZnNfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJCQlJ
OTE1X0RFQlVHRlNfRU5UUklFUywKIAkJCQkJbWlub3ItPmRlYnVnZnNfcm9vdCwgbWlub3IpOwog
fQotCi1zdGF0aWMgaW50IGk5MTVfcGFuZWxfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KmRhdGEpCi17Ci0Jc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9IG0tPnByaXZhdGU7
Ci0Jc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9Ci0JCWludGVsX2F0dGFjaGVkX2RwKHRvX2lu
dGVsX2Nvbm5lY3Rvcihjb25uZWN0b3IpKTsKLQotCWlmIChjb25uZWN0b3ItPnN0YXR1cyAhPSBj
b25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZCkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQlzZXFfcHJp
bnRmKG0sICJQYW5lbCBwb3dlciB1cCBkZWxheTogJWRcbiIsCi0JCSAgIGludGVsX2RwLT5wYW5l
bF9wb3dlcl91cF9kZWxheSk7Ci0Jc2VxX3ByaW50ZihtLCAiUGFuZWwgcG93ZXIgZG93biBkZWxh
eTogJWRcbiIsCi0JCSAgIGludGVsX2RwLT5wYW5lbF9wb3dlcl9kb3duX2RlbGF5KTsKLQlzZXFf
cHJpbnRmKG0sICJCYWNrbGlnaHQgb24gZGVsYXk6ICVkXG4iLAotCQkgICBpbnRlbF9kcC0+YmFj
a2xpZ2h0X29uX2RlbGF5KTsKLQlzZXFfcHJpbnRmKG0sICJCYWNrbGlnaHQgb2ZmIGRlbGF5OiAl
ZFxuIiwKLQkJICAgaW50ZWxfZHAtPmJhY2tsaWdodF9vZmZfZGVsYXkpOwotCi0JcmV0dXJuIDA7
Ci19Ci1ERUZJTkVfU0hPV19BVFRSSUJVVEUoaTkxNV9wYW5lbCk7Ci0KLXN0YXRpYyBpbnQgaTkx
NV9oZGNwX3NpbmtfY2FwYWJpbGl0eV9zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0
YSkKLXsKLQlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKLQlz
dHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0
b3IoY29ubmVjdG9yKTsKLQotCWlmIChjb25uZWN0b3ItPnN0YXR1cyAhPSBjb25uZWN0b3Jfc3Rh
dHVzX2Nvbm5lY3RlZCkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQkvKiBIRENQIGlzIHN1cHBvcnRl
ZCBieSBjb25uZWN0b3IgKi8KLQlpZiAoIWludGVsX2Nvbm5lY3Rvci0+aGRjcC5zaGltKQotCQly
ZXR1cm4gLUVJTlZBTDsKLQotCXNlcV9wcmludGYobSwgIiVzOiVkIEhEQ1AgdmVyc2lvbjogIiwg
Y29ubmVjdG9yLT5uYW1lLAotCQkgICBjb25uZWN0b3ItPmJhc2UuaWQpOwotCWludGVsX2hkY3Bf
aW5mbyhtLCBpbnRlbF9jb25uZWN0b3IpOwotCi0JcmV0dXJuIDA7Ci19Ci1ERUZJTkVfU0hPV19B
VFRSSUJVVEUoaTkxNV9oZGNwX3NpbmtfY2FwYWJpbGl0eSk7Ci0KLXN0YXRpYyBpbnQgaTkxNV9k
c2NfZmVjX3N1cHBvcnRfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCi17Ci0J
c3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciA9IG0tPnByaXZhdGU7Ci0Jc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+ZGV2OwotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsK
LQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwotCXN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJl
X2N0eCBjdHg7Ci0Jc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSBOVUxMOwot
CWludCByZXQgPSAwOwotCWJvb2wgdHJ5X2FnYWluID0gZmFsc2U7Ci0KLQlkcm1fbW9kZXNldF9h
Y3F1aXJlX2luaXQoJmN0eCwgRFJNX01PREVTRVRfQUNRVUlSRV9JTlRFUlJVUFRJQkxFKTsKLQot
CWRvIHsKLQkJdHJ5X2FnYWluID0gZmFsc2U7Ci0JCXJldCA9IGRybV9tb2Rlc2V0X2xvY2soJmRl
di0+bW9kZV9jb25maWcuY29ubmVjdGlvbl9tdXRleCwKLQkJCQkgICAgICAgJmN0eCk7Ci0JCWlm
IChyZXQpIHsKLQkJCWlmIChyZXQgPT0gLUVERUFETEsgJiYgIWRybV9tb2Rlc2V0X2JhY2tvZmYo
JmN0eCkpIHsKLQkJCQl0cnlfYWdhaW4gPSB0cnVlOwotCQkJCWNvbnRpbnVlOwotCQkJfQotCQkJ
YnJlYWs7Ci0JCX0KLQkJY3J0YyA9IGNvbm5lY3Rvci0+c3RhdGUtPmNydGM7Ci0JCWlmIChjb25u
ZWN0b3ItPnN0YXR1cyAhPSBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZCB8fCAhY3J0Yykgewot
CQkJcmV0ID0gLUVOT0RFVjsKLQkJCWJyZWFrOwotCQl9Ci0JCXJldCA9IGRybV9tb2Rlc2V0X2xv
Y2soJmNydGMtPm11dGV4LCAmY3R4KTsKLQkJaWYgKHJldCA9PSAtRURFQURMSykgewotCQkJcmV0
ID0gZHJtX21vZGVzZXRfYmFja29mZigmY3R4KTsKLQkJCWlmICghcmV0KSB7Ci0JCQkJdHJ5X2Fn
YWluID0gdHJ1ZTsKLQkJCQljb250aW51ZTsKLQkJCX0KLQkJCWJyZWFrOwotCQl9IGVsc2UgaWYg
KHJldCkgewotCQkJYnJlYWs7Ci0JCX0KLQkJaW50ZWxfZHAgPSBpbnRlbF9hdHRhY2hlZF9kcCh0
b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKSk7Ci0JCWNydGNfc3RhdGUgPSB0b19pbnRlbF9j
cnRjX3N0YXRlKGNydGMtPnN0YXRlKTsKLQkJc2VxX3ByaW50ZihtLCAiRFNDX0VuYWJsZWQ6ICVz
XG4iLAotCQkJICAgeWVzbm8oY3J0Y19zdGF0ZS0+ZHNjLmNvbXByZXNzaW9uX2VuYWJsZSkpOwot
CQlzZXFfcHJpbnRmKG0sICJEU0NfU2lua19TdXBwb3J0OiAlc1xuIiwKLQkJCSAgIHllc25vKGRy
bV9kcF9zaW5rX3N1cHBvcnRzX2RzYyhpbnRlbF9kcC0+ZHNjX2RwY2QpKSk7Ci0JCXNlcV9wcmlu
dGYobSwgIkZvcmNlX0RTQ19FbmFibGU6ICVzXG4iLAotCQkJICAgeWVzbm8oaW50ZWxfZHAtPmZv
cmNlX2RzY19lbikpOwotCQlpZiAoIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCi0JCQlzZXFf
cHJpbnRmKG0sICJGRUNfU2lua19TdXBwb3J0OiAlc1xuIiwKLQkJCQkgICB5ZXNubyhkcm1fZHBf
c2lua19zdXBwb3J0c19mZWMoaW50ZWxfZHAtPmZlY19jYXBhYmxlKSkpOwotCX0gd2hpbGUgKHRy
eV9hZ2Fpbik7Ci0KLQlkcm1fbW9kZXNldF9kcm9wX2xvY2tzKCZjdHgpOwotCWRybV9tb2Rlc2V0
X2FjcXVpcmVfZmluaSgmY3R4KTsKLQotCXJldHVybiByZXQ7Ci19Ci0KLXN0YXRpYyBzc2l6ZV90
IGk5MTVfZHNjX2ZlY19zdXBwb3J0X3dyaXRlKHN0cnVjdCBmaWxlICpmaWxlLAotCQkJCQkgIGNv
bnN0IGNoYXIgX191c2VyICp1YnVmLAotCQkJCQkgIHNpemVfdCBsZW4sIGxvZmZfdCAqb2ZmcCkK
LXsKLQlib29sIGRzY19lbmFibGUgPSBmYWxzZTsKLQlpbnQgcmV0OwotCXN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IgPQotCQkoKHN0cnVjdCBzZXFfZmlsZSAqKWZpbGUtPnByaXZhdGVf
ZGF0YSktPnByaXZhdGU7Ci0Jc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSBpbnRlbF9h
dHRhY2hlZF9lbmNvZGVyKHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uZWN0b3IpKTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwotCXN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7Ci0KLQlp
ZiAobGVuID09IDApCi0JCXJldHVybiAwOwotCi0JZHJtX2RiZygmaTkxNS0+ZHJtLAotCQkiQ29w
aWVkICV6dSBieXRlcyBmcm9tIHVzZXIgdG8gZm9yY2UgRFNDXG4iLCBsZW4pOwotCi0JcmV0ID0g
a3N0cnRvYm9vbF9mcm9tX3VzZXIodWJ1ZiwgbGVuLCAmZHNjX2VuYWJsZSk7Ci0JaWYgKHJldCA8
IDApCi0JCXJldHVybiByZXQ7Ci0KLQlkcm1fZGJnKCZpOTE1LT5kcm0sICJHb3QgJXMgZm9yIERT
QyBFbmFibGVcbiIsCi0JCShkc2NfZW5hYmxlKSA/ICJ0cnVlIiA6ICJmYWxzZSIpOwotCWludGVs
X2RwLT5mb3JjZV9kc2NfZW4gPSBkc2NfZW5hYmxlOwotCi0JKm9mZnAgKz0gbGVuOwotCXJldHVy
biBsZW47Ci19Ci0KLXN0YXRpYyBpbnQgaTkxNV9kc2NfZmVjX3N1cHBvcnRfb3BlbihzdHJ1Y3Qg
aW5vZGUgKmlub2RlLAotCQkJCSAgICAgc3RydWN0IGZpbGUgKmZpbGUpCi17Ci0JcmV0dXJuIHNp
bmdsZV9vcGVuKGZpbGUsIGk5MTVfZHNjX2ZlY19zdXBwb3J0X3Nob3csCi0JCQkgICBpbm9kZS0+
aV9wcml2YXRlKTsKLX0KLQotc3RhdGljIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkx
NV9kc2NfZmVjX3N1cHBvcnRfZm9wcyA9IHsKLQkub3duZXIgPSBUSElTX01PRFVMRSwKLQkub3Bl
biA9IGk5MTVfZHNjX2ZlY19zdXBwb3J0X29wZW4sCi0JLnJlYWQgPSBzZXFfcmVhZCwKLQkubGxz
ZWVrID0gc2VxX2xzZWVrLAotCS5yZWxlYXNlID0gc2luZ2xlX3JlbGVhc2UsCi0JLndyaXRlID0g
aTkxNV9kc2NfZmVjX3N1cHBvcnRfd3JpdGUKLX07Ci0KLS8qKgotICogaTkxNV9kZWJ1Z2ZzX2Nv
bm5lY3Rvcl9hZGQgLSBhZGQgaTkxNSBzcGVjaWZpYyBjb25uZWN0b3IgZGVidWdmcyBmaWxlcwot
ICogQGNvbm5lY3RvcjogcG9pbnRlciB0byBhIHJlZ2lzdGVyZWQgZHJtX2Nvbm5lY3RvcgotICoK
LSAqIENsZWFudXAgd2lsbCBiZSBkb25lIGJ5IGRybV9jb25uZWN0b3JfdW5yZWdpc3RlcigpIHRo
cm91Z2ggYSBjYWxsIHRvCi0gKiBkcm1fZGVidWdmc19jb25uZWN0b3JfcmVtb3ZlKCkuCi0gKgot
ICogUmV0dXJucyAwIG9uIHN1Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGVzIG9uIGVycm9yLgot
ICovCi1pbnQgaTkxNV9kZWJ1Z2ZzX2Nvbm5lY3Rvcl9hZGQoc3RydWN0IGRybV9jb25uZWN0b3Ig
KmNvbm5lY3RvcikKLXsKLQlzdHJ1Y3QgZGVudHJ5ICpyb290ID0gY29ubmVjdG9yLT5kZWJ1Z2Zz
X2VudHJ5OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29u
bmVjdG9yLT5kZXYpOwotCi0JLyogVGhlIGNvbm5lY3RvciBtdXN0IGhhdmUgYmVlbiByZWdpc3Rl
cmVkIGJlZm9yZWhhbmRzLiAqLwotCWlmICghcm9vdCkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQlp
ZiAoY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSA9PSBEUk1fTU9ERV9DT05ORUNUT1JfZURQKSB7
Ci0JCWRlYnVnZnNfY3JlYXRlX2ZpbGUoImk5MTVfcGFuZWxfdGltaW5ncyIsIFNfSVJVR08sIHJv
b3QsCi0JCQkJICAgIGNvbm5lY3RvciwgJmk5MTVfcGFuZWxfZm9wcyk7Ci0JCWRlYnVnZnNfY3Jl
YXRlX2ZpbGUoImk5MTVfcHNyX3Npbmtfc3RhdHVzIiwgU19JUlVHTywgcm9vdCwKLQkJCQkgICAg
Y29ubmVjdG9yLCAmaTkxNV9wc3Jfc2lua19zdGF0dXNfZm9wcyk7Ci0JfQotCi0JaWYgKGNvbm5l
Y3Rvci0+Y29ubmVjdG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVDVE9SX0Rpc3BsYXlQb3J0IHx8
Ci0JICAgIGNvbm5lY3Rvci0+Y29ubmVjdG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVDVE9SX0hE
TUlBIHx8Ci0JICAgIGNvbm5lY3Rvci0+Y29ubmVjdG9yX3R5cGUgPT0gRFJNX01PREVfQ09OTkVD
VE9SX0hETUlCKSB7Ci0JCWRlYnVnZnNfY3JlYXRlX2ZpbGUoImk5MTVfaGRjcF9zaW5rX2NhcGFi
aWxpdHkiLCBTX0lSVUdPLCByb290LAotCQkJCSAgICBjb25uZWN0b3IsICZpOTE1X2hkY3Bfc2lu
a19jYXBhYmlsaXR5X2ZvcHMpOwotCX0KLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEw
ICYmCi0JICAgIChjb25uZWN0b3ItPmNvbm5lY3Rvcl90eXBlID09IERSTV9NT0RFX0NPTk5FQ1RP
Ul9EaXNwbGF5UG9ydCB8fAotCSAgICAgY29ubmVjdG9yLT5jb25uZWN0b3JfdHlwZSA9PSBEUk1f
TU9ERV9DT05ORUNUT1JfZURQKSkKLQkJZGVidWdmc19jcmVhdGVfZmlsZSgiaTkxNV9kc2NfZmVj
X3N1cHBvcnQiLCBTX0lSVUdPLCByb290LAotCQkJCSAgICBjb25uZWN0b3IsICZpOTE1X2RzY19m
ZWNfc3VwcG9ydF9mb3BzKTsKLQotCXJldHVybiAwOwotfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rl
YnVnZnMuaAppbmRleCBjMGNkMjJlYjkxNmQuLmYwMzA5MjE5ZWQ0YyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kZWJ1Z2ZzLmgKQEAgLTExLDEwICsxMSw4IEBAIHN0cnVjdCBkcm1fY29ubmVjdG9y
OwogCiAjaWZkZWYgQ09ORklHX0RFQlVHX0ZTCiBpbnQgaTkxNV9kZWJ1Z2ZzX3JlZ2lzdGVyKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1pbnQgaTkxNV9kZWJ1Z2ZzX2Nvbm5l
Y3Rvcl9hZGQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3Rvcik7CiAjZWxzZQogc3RhdGlj
IGlubGluZSBpbnQgaTkxNV9kZWJ1Z2ZzX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikgeyByZXR1cm4gMDsgfQotc3RhdGljIGlubGluZSBpbnQgaTkxNV9kZWJ1Z2Zz
X2Nvbm5lY3Rvcl9hZGQoc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvcikgeyByZXR1cm4g
MDsgfQogI2VuZGlmCiAKICNlbmRpZiAvKiBfX0k5MTVfREVCVUdGU19IX18gKi8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5jCmluZGV4IDUxNjUzNjIzNGU5Ny4uNGFiMzY4OTQyMGU2IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmMKQEAgLTUwLDYgKzUwLDcgQEAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVs
X2F1ZGlvLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9idy5oIgogI2luY2x1ZGUgImRpc3Bs
YXkvaW50ZWxfY2RjbGsuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdm
cy5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIgogI2luY2x1ZGUg
ImRpc3BsYXkvaW50ZWxfZHAuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2ZiZGV2LmgiCkBA
IC0xMzMwLDYgKzEzMzEsNyBAQCBzdGF0aWMgdm9pZCBpOTE1X2RyaXZlcl9yZWdpc3RlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJLyogUmV2ZWFsIG91ciBwcmVzZW5jZSB0
byB1c2Vyc3BhY2UgKi8KIAlpZiAoZHJtX2Rldl9yZWdpc3RlcihkZXYsIDApID09IDApIHsKIAkJ
aTkxNV9kZWJ1Z2ZzX3JlZ2lzdGVyKGRldl9wcml2KTsKKwkJaW50ZWxfZGlzcGxheV9kZWJ1Z2Zz
X3JlZ2lzdGVyKGRldl9wcml2KTsKIAkJaTkxNV9zZXR1cF9zeXNmcyhkZXZfcHJpdik7CiAKIAkJ
LyogRGVwZW5kcyBvbiBzeXNmcyBoYXZpbmcgYmVlbiBpbml0aWFsaXplZCAqLwotLSAKMi4yMC4x
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1n
ZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

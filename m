Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 807192E9591
	for <lists+intel-gfx@lfdr.de>; Mon,  4 Jan 2021 14:07:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 98CBE8953E;
	Mon,  4 Jan 2021 13:07:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8DC6B8953E
 for <intel-gfx@lists.freedesktop.org>; Mon,  4 Jan 2021 13:07:49 +0000 (UTC)
IronPort-SDR: gn/6r6/rB2B01vSiaYJmcrqm9nLii7EmL3vOh68+/sTqgTm4RKU0EyvMF49Q0W/nX2j9/41pNn
 BvU956cqMiLQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9853"; a="241032572"
X-IronPort-AV: E=Sophos;i="5.78,474,1599548400"; d="scan'208";a="241032572"
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga105.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Jan 2021 05:07:48 -0800
IronPort-SDR: 4yo74w4ZEyWD768DLm4H6XIHCVrLmn/3GrAzVJwQyI3YMym8YvsW0CyG9HgzRfcXokd1BW9M6S
 lI8KRbvdnv3g==
X-IronPort-AV: E=Sophos;i="5.78,474,1599548400"; d="scan'208";a="378415927"
Received: from helsinki.fi.intel.com ([10.237.66.162])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Jan 2021 05:07:44 -0800
From: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  4 Jan 2021 15:07:19 +0200
Message-Id: <20210104130720.1151496-1-gwan-gyeong.mun@intel.com>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v10 1/2] drm/i915/display: Support PSR Multiple
 Instances
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgaXMgYSBwcmVsaW1pbmFyeSB3b3JrIGZvciBzdXBwb3J0aW5nIG11bHRpcGxlIEVEUCBQU1Ig
YW5kCkRQIFBhbmVsUmVwbGF5LiBBbmQgaXQgcmVmYWN0b3JzIHNpbmdsZXRvbiBQU1IgdG8gTXVs
dGkgVHJhbnNjb2RlcgpzdXBwb3J0YWJsZSBQU1IuCkFuZCB0aGlzIG1vdmVzIGFuZCByZW5hbWVz
IHRoZSBpOTE1X3BzciBzdHJ1Y3R1cmUgb2YgZHJtX2k5MTVfcHJpdmF0ZSdzIHRvCmludGVsX2Rw
J3MgaW50ZWxfcHNyIHN0cnVjdHVyZS4KSXQgYWxzbyBjYXVzZXMgY2hhbmdlcyBpbiBQU1IgaW50
ZXJydXB0IGhhbmRsaW5nIHJvdXRpbmUgZm9yIHN1cHBvcnRpbmcKbXVsdGlwbGUgdHJhbnNjb2Rl
cnMuIEJ1dCBpdCBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNjZW5hcmlvIGFuZCB0aW1pbmcgb2YKZW5h
YmxpbmcgYW5kIGRpc2FibGluZyBQU1IuIEFuZCBpdCBub3Qgc3VwcG9ydCBtdWx0aXBsZSBwaXBl
cyB3aXRoCmEgc2luZ2xlIHRyYW5zY29kZXIgUFNSIGNhc2UgeWV0LgoKdjI6IEZpeCBpbmRlbnRh
dGlvbiBhbmQgYWRkIGNvbW1lbnRzCnYzOiBSZW1vdmUgQmxhbmsgbGluZQp2NDogUmViYXNlZAp2
NTogUmViYXNlZCBhbmQgQWRkcmVzc2VkIEFuc2h1bWFuJ3MgcmV2aWV3IGNvbW1lbnQuCiAgICAt
IE1vdmUgY2FsbGluZyBvZiBpbnRlbF9wc3JfaW5pdCgpIHRvIGludGVsX2RwX2luaXRfY29ubmVj
dG9yKCkKdjY6IEFkZHJlc3MgQW5zaHVtYW4ncyByZXZpZXcgY29tbWVudHMKICAgLSBSZW1vdmUg
d3JvbmcgY29tbWVudHMgYW5kIGFkZCBjb21tZW50cyBmb3IgYSBsaW1pdCBvZiBzdXBwb3J0aW5n
IG9mCiAgICAgYSBzaW5nbGUgcGlwZSBQU1IKdjc6IFVwZGF0ZSBpbnRlbF9wc3JfY29tcHV0ZV9j
b25maWcoKSBmb3Igc3VwcG9ydGluZyBtdWx0aXBsZSB0cmFuc2NvZGVyCiAgICBQU1Igb24gQkRX
Kwp2ODogQWRkcmVzcyBBbnNodW1hbidzIHJldmlldyBjb21tZW50cwogICAtIFJlcGxhY2UgRFJN
X0RFQlVHX0tNUyB3aXRoIGRybV9kYmdfa21zKCkgLyBEUk1fV0FSTiB3aXRoIGRybV93YXJuKCkK
djk6IEZpeCBjb21taXQgbWVzc2FnZQp2MTA6IFJlYmFzZWQKClNpZ25lZC1vZmYtYnk6IEd3YW4t
Z3llb25nIE11biA8Z3dhbi1neWVvbmcubXVuQGludGVsLmNvbT4KQ2M6IEpvc8OpIFJvYmVydG8g
ZGUgU291emEgPGpvc2Uuc291emFAaW50ZWwuY29tPgpDYzogSnVoYS1QZWtrYSBIZWlra2lsYSA8
anVoYXBla2thLmhlaWtraWxhQGdtYWlsLmNvbT4KQ2M6IEFuc2h1bWFuIEd1cHRhIDxhbnNodW1h
bi5ndXB0YUBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBBbnNodW1hbiBHdXB0YSA8YW5zaHVtYW4u
Z3VwdGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMgICAgICB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXkuYyAgfCAgIDQgLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1
Z2ZzLmMgIHwgMTExICsrLS0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlw
ZXMuaCAgICB8ICAzOCArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5j
ICAgICAgIHwgIDIzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5j
ICAgICAgfCA1NzYgKysrKysrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX3Bzci5oICAgICAgfCAgMTQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfc3ByaXRlLmMgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuaCAgICAgICAgICAgICAgIHwgIDM4IC0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2ly
cS5jICAgICAgICAgICAgICAgfCAgNDkgKy0KIDEwIGZpbGVzIGNoYW5nZWQsIDQ4NSBpbnNlcnRp
b25zKCspLCAzNzcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGRpLmMKaW5kZXggMTdlYWE1NmM1YTk5Li5hZTc4MTY3MDEzZDEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtNDMyNCw3ICs0MzI0LDEwIEBAIHN0YXRp
YyB2b2lkIGludGVsX2RkaV91cGRhdGVfcGlwZV9kcChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSwKIAogCWludGVsX2RkaV9zZXRfZHBfbXNhKGNydGNfc3RhdGUsIGNvbm5fc3RhdGUp
OwogCisJLy9UT0RPOiBtb3ZlIFBTUiByZWxhdGVkIGZ1bmN0aW9ucyBpbnRvIGludGVsX3Bzcl91
cGRhdGUoKQorCWludGVsX3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChpbnRlbF9kcCwg
Y3J0Y19zdGF0ZSk7CiAJaW50ZWxfcHNyX3VwZGF0ZShpbnRlbF9kcCwgY3J0Y19zdGF0ZSwgY29u
bl9zdGF0ZSk7CisKIAlpbnRlbF9kcF9zZXRfaW5mb2ZyYW1lcyhlbmNvZGVyLCB0cnVlLCBjcnRj
X3N0YXRlLCBjb25uX3N0YXRlKTsKIAlpbnRlbF9lZHBfZHJyc191cGRhdGUoaW50ZWxfZHAsIGNy
dGNfc3RhdGUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCmluZGV4IGYyYzQ4ZTVjZGI0My4uYzg1NzQ4OWYyY2NkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTQ4MjEsOCArMTQ4MjEsNiBAQCBz
dGF0aWMgdm9pZCBjb21taXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUsCiAKIAkJaWYgKG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSkKIAkJCWludGVsX3Bp
cGVfZmFzdHNldChvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOwotCi0JCWludGVsX3Bz
cjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChuZXdfY3J0Y19zdGF0ZSk7CiAJfQogCiAJaWYg
KGRldl9wcml2LT5kaXNwbGF5LmF0b21pY191cGRhdGVfd2F0ZXJtYXJrcykKQEAgLTE2MzQ4LDgg
KzE2MzQ2LDYgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2V0dXBfb3V0cHV0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWludGVsX2R2b19pbml0KGRldl9wcml2KTsKIAl9CiAK
LQlpbnRlbF9wc3JfaW5pdChkZXZfcHJpdik7Ci0KIAlmb3JfZWFjaF9pbnRlbF9lbmNvZGVyKCZk
ZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CiAJCWVuY29kZXItPmJhc2UucG9zc2libGVfY3J0Y3Mg
PQogCQkJaW50ZWxfZW5jb2Rlcl9wb3NzaWJsZV9jcnRjcyhlbmNvZGVyKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jCmluZGV4
IGNkN2U1NTE5ZWU3ZC4uMDQxMDUzMTY3ZDdmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMKQEAgLTI0OSwxOCArMjQ5LDE3
IEBAIHN0YXRpYyBpbnQgaTkxNV9wc3Jfc2lua19zdGF0dXNfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sIHZvaWQgKmRhdGEpCiAJCSJzaW5rIGludGVybmFsIGVycm9yIiwKIAl9OwogCXN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBtLT5wcml2YXRlOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOwogCXN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAgPQogCQlpbnRlbF9hdHRhY2hlZF9kcCh0b19pbnRlbF9jb25uZWN0b3Io
Y29ubmVjdG9yKSk7CiAJaW50IHJldDsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpIHsKLQkJ
c2VxX3B1dHMobSwgIlBTUiBVbnN1cHBvcnRlZFxuIik7CisJaWYgKGNvbm5lY3Rvci0+c3RhdHVz
ICE9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkKQogCQlyZXR1cm4gLUVOT0RFVjsKLQl9CiAK
LQlpZiAoY29ubmVjdG9yLT5zdGF0dXMgIT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpCisJ
aWYgKCFDQU5fUFNSKGludGVsX2RwKSkgeworCQlzZXFfcHV0cyhtLCAiUFNSIFVuc3VwcG9ydGVk
XG4iKTsKIAkJcmV0dXJuIC1FTk9ERVY7CisJfQogCiAJcmV0ID0gZHJtX2RwX2RwY2RfcmVhZGIo
JmludGVsX2RwLT5hdXgsIERQX1BTUl9TVEFUVVMsICZ2YWwpOwogCkBAIC0yODAsMTIgKzI3OSwx
MyBAQCBzdGF0aWMgaW50IGk5MTVfcHNyX3Npbmtfc3RhdHVzX3Nob3coc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICpkYXRhKQogREVGSU5FX1NIT1dfQVRUUklCVVRFKGk5MTVfcHNyX3Npbmtfc3Rh
dHVzKTsKIAogc3RhdGljIHZvaWQKLXBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNlcV9maWxlICptKQorcHNyX3NvdXJjZV9zdGF0dXMo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgc3RydWN0IHNlcV9maWxlICptKQogewogCXUzMiB2
YWwsIHN0YXR1c192YWw7CiAJY29uc3QgY2hhciAqc3RhdHVzID0gInVua25vd24iOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCi0J
aWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3IucHNy
Ml9lbmFibGVkKSB7CiAJCXN0YXRpYyBjb25zdCBjaGFyICogY29uc3QgbGl2ZV9zdGF0dXNbXSA9
IHsKIAkJCSJJRExFIiwKIAkJCSJDQVBUVVJFIiwKQEAgLTMwMCw3ICszMDAsNyBAQCBwc3Jfc291
cmNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFf
ZmlsZSAqbSkKIAkJCSJUR19PTiIKIAkJfTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJp
diwKLQkJCQkgICAgRURQX1BTUjJfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOwor
CQkJCSAgICBFRFBfUFNSMl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXN0
YXR1c192YWwgPSAodmFsICYgRURQX1BTUjJfU1RBVFVTX1NUQVRFX01BU0spID4+CiAJCQkgICAg
ICBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfU0hJRlQ7CiAJCWlmIChzdGF0dXNfdmFsIDwgQVJSQVlf
U0laRShsaXZlX3N0YXR1cykpCkBAIC0zMTcsNyArMzE3LDcgQEAgcHNyX3NvdXJjZV9zdGF0dXMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJ
CQkiU1JERU5UX09OIiwKIAkJfTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJ
CQkgICAgRURQX1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAg
IEVEUF9QU1JfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlzdGF0dXNfdmFs
ID0gKHZhbCAmIEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0spID4+CiAJCQkgICAgICBFRFBfUFNS
X1NUQVRVU19TVEFURV9TSElGVDsKIAkJaWYgKHN0YXR1c192YWwgPCBBUlJBWV9TSVpFKGxpdmVf
c3RhdHVzKSkKQEAgLTMyNywyMSArMzI3LDE4IEBAIHBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNlcV9maWxlICptKQogCXNlcV9wcmlu
dGYobSwgIlNvdXJjZSBQU1Igc3RhdHVzOiAlcyBbMHglMDh4XVxuIiwgc3RhdHVzLCB2YWwpOwog
fQogCi1zdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQorc3RhdGljIGludCBpbnRlbF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAq
bSwgc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGk5MTVfcHNy
ICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50
ZWxfZHAtPnBzcjsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAljb25zdCBjaGFyICpzdGF0
dXM7CiAJYm9vbCBlbmFibGVkOwogCXUzMiB2YWw7CiAKLQlpZiAoIUhBU19QU1IoZGV2X3ByaXYp
KQotCQlyZXR1cm4gLUVOT0RFVjsKLQogCXNlcV9wcmludGYobSwgIlNpbmsgc3VwcG9ydDogJXMi
LCB5ZXNubyhwc3ItPnNpbmtfc3VwcG9ydCkpOwotCWlmIChwc3ItPmRwKQotCQlzZXFfcHJpbnRm
KG0sICIgWzB4JTAyeF0iLCBwc3ItPmRwLT5wc3JfZHBjZFswXSk7CisJaWYgKHBzci0+c2lua19z
dXBwb3J0KQorCQlzZXFfcHJpbnRmKG0sICIgWzB4JTAyeF0iLCBpbnRlbF9kcC0+cHNyX2RwY2Rb
MF0pOwogCXNlcV9wdXRzKG0sICJcbiIpOwogCiAJaWYgKCFwc3ItPnNpbmtfc3VwcG9ydCkKQEAg
LTM2NSwxNiArMzYyLDE2IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIAlpZiAocHNyLT5wc3IyX2VuYWJsZWQpIHsKIAkJ
dmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUjJfQ1RMKGRldl9w
cml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBz
ci50cmFuc2NvZGVyKSk7CiAJCWVuYWJsZWQgPSB2YWwgJiBFRFBfUFNSMl9FTkFCTEU7CiAJfSBl
bHNlIHsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9D
VEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RMKGludGVs
X2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQllbmFibGVkID0gdmFsICYgRURQX1BTUl9FTkFCTEU7
CiAJfQogCXNlcV9wcmludGYobSwgIlNvdXJjZSBQU1IgY3RsOiAlcyBbMHglMDh4XVxuIiwKIAkJ
ICAgZW5hYmxlZGRpc2FibGVkKGVuYWJsZWQpLCB2YWwpOwotCXBzcl9zb3VyY2Vfc3RhdHVzKGRl
dl9wcml2LCBtKTsKKwlwc3Jfc291cmNlX3N0YXR1cyhpbnRlbF9kcCwgbSk7CiAJc2VxX3ByaW50
ZihtLCAiQnVzeSBmcm9udGJ1ZmZlciBiaXRzOiAweCUwOHhcbiIsCiAJCSAgIHBzci0+YnVzeV9m
cm9udGJ1ZmZlcl9iaXRzKTsKIApAQCAtMzgzLDcgKzM4MCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9l
ZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJICovCiAJaWYg
KElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKIAkJdmFs
ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChpbnRlbF9k
cC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJdmFsICY9IEVEUF9QU1JfUEVSRl9DTlRfTUFTSzsKIAkJ
c2VxX3ByaW50ZihtLCAiUGVyZm9ybWFuY2UgY291bnRlcjogJXVcbiIsIHZhbCk7CiAJfQpAQCAt
NDA0LDcgKzQwMSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJCSAqLwogCQlmb3IgKGZyYW1lID0gMDsgZnJhbWUgPCBQ
U1IyX1NVX1NUQVRVU19GUkFNRVM7IGZyYW1lICs9IDMpIHsKIAkJCXZhbCA9IGludGVsX2RlX3Jl
YWQoZGV2X3ByaXYsCi0JCQkJCSAgICBQU1IyX1NVX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5z
Y29kZXIsIGZyYW1lKSk7CisJCQkJCSAgICBQU1IyX1NVX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIsIGZyYW1lKSk7CiAJCQlzdV9mcmFtZXNfdmFsW2ZyYW1lIC8gM10gPSB2YWw7CiAJ
CX0KIApAQCAtNDMwLDIzICs0MjcsNTcgQEAgc3RhdGljIGludCBpOTE1X2VkcF9wc3Jfc3RhdHVz
KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGlj
IGludCBpOTE1X2VkcF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkK
K3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+
cHJpdmF0ZSk7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CisJc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCA9IE5VTEw7CisKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQorCQlyZXR1
cm4gLUVOT0RFVjsKKworCS8qIEZpbmQgdGhlIGZpcnN0IEVEUCAqLworCWZvcl9lYWNoX2ludGVs
X2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCWlmIChlbmNvZGVyLT50eXBlID09IElO
VEVMX09VVFBVVF9FRFApIHsKKwkJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIp
OworCQkJYnJlYWs7CisJCX0KKwl9CisKKwlpZiAoIWludGVsX2RwKQorCQlyZXR1cm4gLUVOT0RF
VjsKKworCXJldHVybiBpbnRlbF9wc3Jfc3RhdHVzKG0sIGludGVsX2RwKTsKK30KKwogc3RhdGlj
IGludAogaTkxNV9lZHBfcHNyX2RlYnVnX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7CiAJaW50ZWxfd2FrZXJlZl90
IHdha2VyZWY7Ci0JaW50IHJldDsKKwlpbnQgcmV0ID0gLUVOT0RFVjsKKwlzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlcjsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVybiAt
RU5PREVWOworCWlmICghSEFTX1BTUihkZXZfcHJpdikpCisJCXJldHVybiByZXQ7CiAKLQlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlNldHRpbmcgUFNSIGRlYnVnIHRvICVsbHhcbiIsIHZh
bCk7CisJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKIAotCXdh
a2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOworCQlp
ZiAoIUNBTl9QU1IoaW50ZWxfZHApKQorCQkJY29udGludWU7CiAKLQlyZXQgPSBpbnRlbF9wc3Jf
ZGVidWdfc2V0KGRldl9wcml2LCB2YWwpOworCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9P
VVRQVVRfRURQKSB7CisJCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlNldHRpbmcgUFNS
IGRlYnVnIHRvICVsbHhcbiIsIHZhbCk7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3By
aXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOworCQkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1f
Z2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CisKKwkJCS8vIFRPRE86IHNwbGl0IHRvIGVhY2gg
dHJhbnNjb2RlcidzIFBTUiBkZWJ1ZyBzdGF0ZQorCQkJcmV0ID0gaW50ZWxfcHNyX2RlYnVnX3Nl
dChpbnRlbF9kcCwgdmFsKTsKKworCQkJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5y
dW50aW1lX3BtLCB3YWtlcmVmKTsKKwkJfQorCX0KIAogCXJldHVybiByZXQ7CiB9CkBAIC00NTUs
MTIgKzQ4NiwyNSBAQCBzdGF0aWMgaW50CiBpOTE1X2VkcF9wc3JfZGVidWdfZ2V0KHZvaWQgKmRh
dGEsIHU2NCAqdmFsKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRh
dGE7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAKLQlpZiAoIUNBTl9QU1IoZGV2
X3ByaXYpKQorCWlmICghSEFTX1BTUihkZXZfcHJpdikpCiAJCXJldHVybiAtRU5PREVWOwogCi0J
KnZhbCA9IFJFQURfT05DRShkZXZfcHJpdi0+cHNyLmRlYnVnKTsKLQlyZXR1cm4gMDsKKwlmb3Jf
ZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgeworCQlzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCisJCWlmICghQ0FOX1BT
UihpbnRlbF9kcCkpCisJCQljb250aW51ZTsKKworCQkvLyBUT0RPOiBzcGxpdCB0byBlYWNoIHRy
YW5zY29kZXIncyBQU1IgZGVidWcgc3RhdGUKKwkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxf
T1VUUFVUX0VEUCkgeworCQkJKnZhbCA9IFJFQURfT05DRShpbnRlbF9kcC0+cHNyLmRlYnVnKTsK
KwkJCXJldHVybiAwOworCQl9CisJfQorCisJcmV0dXJuIC1FTk9ERVY7CiB9CiAKIERFRklORV9T
SU1QTEVfQVRUUklCVVRFKGk5MTVfZWRwX3Bzcl9kZWJ1Z19mb3BzLApAQCAtMTIzNCw5ICsxMjc4
LDYgQEAgc3RhdGljIHZvaWQgZHJyc19zdGF0dXNfcGVyX2NydGMoc3RydWN0IHNlcV9maWxlICpt
LAogCQkvKiBkaXNhYmxlX2RycnMoKSB3aWxsIG1ha2UgZHJycy0+ZHAgTlVMTCAqLwogCQlpZiAo
IWRycnMtPmRwKSB7CiAJCQlzZXFfcHV0cyhtLCAiSWRsZW5lc3MgRFJSUzogRGlzYWJsZWRcbiIp
OwotCQkJaWYgKGRldl9wcml2LT5wc3IuZW5hYmxlZCkKLQkJCQlzZXFfcHV0cyhtLAotCQkJCSJc
dEFzIFBTUiBpcyBlbmFibGVkLCBEUlJTIGlzIG5vdCBlbmFibGVkXG4iKTsKIAkJCW11dGV4X3Vu
bG9jaygmZHJycy0+bXV0ZXgpOwogCQkJcmV0dXJuOwogCQl9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IDEwNjdiZDA3M2M5
NS4uZTJmNzE4NThlMGJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApAQCAtMTM0NCw2ICsxMzQ0LDQyIEBAIHN0cnVjdCBpbnRl
bF9kcF9wY29uX2ZybCB7CiAJaW50IHRyYWluZWRfcmF0ZV9nYnBzOwogfTsKIAorc3RydWN0IGlu
dGVsX3BzciB7CisJLyogTXV0ZXggZm9yIFBTUiBzdGF0ZSBvZiB0aGUgdHJhbnNjb2RlciAqLwor
CXN0cnVjdCBtdXRleCBsb2NrOworCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSwkw
eDBmCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0RFRkFVTFQJCTB4MDAKKyNkZWZpbmUgSTkxNV9Q
U1JfREVCVUdfRElTQUJMRQkJMHgwMQorI2RlZmluZSBJOTE1X1BTUl9ERUJVR19FTkFCTEUJCTB4
MDIKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMQkweDAzCisjZGVmaW5lIEk5MTVf
UFNSX0RFQlVHX0lSUQkJMHgxMAorCisJdTMyIGRlYnVnOworCWJvb2wgc2lua19zdXBwb3J0Owor
CWJvb2wgZW5hYmxlZDsKKwllbnVtIHBpcGUgcGlwZTsKKwllbnVtIHRyYW5zY29kZXIgdHJhbnNj
b2RlcjsKKwlib29sIGFjdGl2ZTsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3Qgd29yazsKKwl1bnNpZ25l
ZCBpbnQgYnVzeV9mcm9udGJ1ZmZlcl9iaXRzOworCWJvb2wgc2lua19wc3IyX3N1cHBvcnQ7CisJ
Ym9vbCBsaW5rX3N0YW5kYnk7CisJYm9vbCBjb2xvcmltZXRyeV9zdXBwb3J0OworCWJvb2wgcHNy
Ml9lbmFibGVkOworCWJvb2wgcHNyMl9zZWxfZmV0Y2hfZW5hYmxlZDsKKwl1OCBzaW5rX3N5bmNf
bGF0ZW5jeTsKKwlrdGltZV90IGxhc3RfZW50cnlfYXR0ZW1wdDsKKwlrdGltZV90IGxhc3RfZXhp
dDsKKwlib29sIHNpbmtfbm90X3JlbGlhYmxlOworCWJvb2wgaXJxX2F1eF9lcnJvcjsKKwl1MTYg
c3VfeF9ncmFudWxhcml0eTsKKwlib29sIGRjM2NvX2VuYWJsZWQ7CisJdTMyIGRjM2NvX2V4aXRf
ZGVsYXk7CisJc3RydWN0IGRlbGF5ZWRfd29yayBkYzNjb193b3JrOworCXN0cnVjdCBkcm1fZHBf
dnNjX3NkcCB2c2M7Cit9OworCiBzdHJ1Y3QgaW50ZWxfZHAgewogCWk5MTVfcmVnX3Qgb3V0cHV0
X3JlZzsKIAl1MzIgRFA7CkBAIC0xNDczLDYgKzE1MDksOCBAQCBzdHJ1Y3QgaW50ZWxfZHAgewog
CWJvb2wgaG9ibF9hY3RpdmU7CiAKIAlzdHJ1Y3QgaW50ZWxfZHBfcGNvbl9mcmwgZnJsOworCisJ
c3RydWN0IGludGVsX3BzciBwc3I7CiB9OwogCiBlbnVtIGxzcGNvbl92ZW5kb3IgewpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCmluZGV4IDhhMDBlNjA5MDg1Zi4uNjQyYWNh
ZTg3Y2YzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC0yNzI5
LDEyICsyNzI5LDEwIEBAIHZvaWQgaW50ZWxfZHBfY29tcHV0ZV9wc3JfdnNjX3NkcChzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKmNvbm5fc3RhdGUsCiAJCQkJICBzdHJ1Y3QgZHJtX2RwX3ZzY19zZHAgKnZzYykKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
LQogCXZzYy0+c2RwX3R5cGUgPSBEUF9TRFBfVlNDOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNy
Ml9lbmFibGVkKSB7Ci0JCWlmIChkZXZfcHJpdi0+cHNyLmNvbG9yaW1ldHJ5X3N1cHBvcnQgJiYK
KwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJaWYgKGludGVsX2RwLT5wc3Iu
Y29sb3JpbWV0cnlfc3VwcG9ydCAmJgogCQkgICAgaW50ZWxfZHBfbmVlZHNfdnNjX3NkcChjcnRj
X3N0YXRlLCBjb25uX3N0YXRlKSkgewogCQkJLyogW1BTUjIsICtDb2xvcmltZXRyeV0gKi8KIAkJ
CWludGVsX2RwX2NvbXB1dGVfdnNjX2NvbG9yaW1ldHJ5KGNydGNfc3RhdGUsIGNvbm5fc3RhdGUs
CkBAIC0zODk4LDcgKzM4OTYsNyBAQCBib29sIGludGVsX2RwX2luaXRpYWxfZmFzdHNldF9jaGVj
ayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAot
CWlmIChDQU5fUFNSKGk5MTUpICYmIGludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpIHsKKwlpZiAo
Q0FOX1BTUihpbnRlbF9kcCkgJiYgaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkgewogCQlkcm1f
ZGJnX2ttcygmaTkxNS0+ZHJtLCAiRm9yY2luZyBmdWxsIG1vZGVzZXQgdG8gY29tcHV0ZSBQU1Ig
c3RhdGVcbiIpOwogCQljcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZCA9IHRydWU7CiAJCXJl
dHVybiBmYWxzZTsKQEAgLTg1MTAsNiArODUwOCwxNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9t
b2Rlc2V0X3JldHJ5X3dvcmtfZm4oc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWRybV9rbXNf
aGVscGVyX2hvdHBsdWdfZXZlbnQoY29ubmVjdG9yLT5kZXYpOwogfQogCitzdGF0aWMgdm9pZCBp
bnRlbF9kcF91cGRhdGVfcGlwZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJ
CQkgc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5j
X3RvX2ludGVsX2RwKGVuY29kZXIpOworCisJaW50ZWxfcGFuZWxfdXBkYXRlX2JhY2tsaWdodChz
dGF0ZSwgZW5jb2RlciwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJaW50ZWxfcHNyMl9wcm9n
cmFtX3RyYW5zX21hbl90cmtfY3RsKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKK30KKwogYm9vbAog
aW50ZWxfZHBfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3Bv
cnQsCiAJCQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCkBAIC04NjI3
LDYgKzg2MzYsOCBAQCBpbnRlbF9kcF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICpkaWdfcG9ydCwKIAlpbnRlbF9kcC0+ZnJsLmlzX3RyYWluZWQgPSBmYWxzZTsKIAlp
bnRlbF9kcC0+ZnJsLnRyYWluZWRfcmF0ZV9nYnBzID0gMDsKIAorCWludGVsX3Bzcl9pbml0KGlu
dGVsX2RwKTsKKwogCXJldHVybiB0cnVlOwogCiBmYWlsOgpAQCAtODY2OCw3ICs4Njc5LDcgQEAg
Ym9vbCBpbnRlbF9kcF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlp
bnRlbF9lbmNvZGVyLT5nZXRfY29uZmlnID0gaW50ZWxfZHBfZ2V0X2NvbmZpZzsKIAlpbnRlbF9l
bmNvZGVyLT5zeW5jX3N0YXRlID0gaW50ZWxfZHBfc3luY19zdGF0ZTsKIAlpbnRlbF9lbmNvZGVy
LT5pbml0aWFsX2Zhc3RzZXRfY2hlY2sgPSBpbnRlbF9kcF9pbml0aWFsX2Zhc3RzZXRfY2hlY2s7
Ci0JaW50ZWxfZW5jb2Rlci0+dXBkYXRlX3BpcGUgPSBpbnRlbF9wYW5lbF91cGRhdGVfYmFja2xp
Z2h0OworCWludGVsX2VuY29kZXItPnVwZGF0ZV9waXBlID0gaW50ZWxfZHBfdXBkYXRlX3BpcGU7
CiAJaW50ZWxfZW5jb2Rlci0+c3VzcGVuZCA9IGludGVsX2RwX2VuY29kZXJfc3VzcGVuZDsKIAlp
bnRlbF9lbmNvZGVyLT5zaHV0ZG93biA9IGludGVsX2RwX2VuY29kZXJfc2h1dGRvd247CiAJaWYg
KElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9wc3IuYwppbmRleCBkOWEzOTVjNDg2ZDMuLmJhZGRmNjM1NDdlNyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCkBAIC03OSwxMSArNzksMTMgQEAKICAqIHVz
ZSBwYWdlIGZsaXBzLgogICovCiAKLXN0YXRpYyBib29sIHBzcl9nbG9iYWxfZW5hYmxlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBib29sIHBzcl9nbG9iYWxfZW5hYmxl
ZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN3aXRjaCAoaTkxNS0+cHNyLmRlYnVn
ICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisKKwlzd2l0Y2ggKGludGVsX2RwLT5w
c3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHsKIAljYXNlIEk5MTVfUFNSX0RF
QlVHX0RFRkFVTFQ6Ci0JCXJldHVybiBpOTE1LT5wYXJhbXMuZW5hYmxlX3BzcjsKKwkJcmV0dXJu
IGRldl9wcml2LT5wYXJhbXMuZW5hYmxlX3BzcjsKIAljYXNlIEk5MTVfUFNSX0RFQlVHX0RJU0FC
TEU6CiAJCXJldHVybiBmYWxzZTsKIAlkZWZhdWx0OgpAQCAtOTEsOSArOTMsOSBAQCBzdGF0aWMg
Ym9vbCBwc3JfZ2xvYmFsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJ
fQogfQogCi1zdGF0aWMgYm9vbCBwc3IyX2dsb2JhbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBib29sIHBzcjJfZ2xvYmFsX2VuYWJsZWQoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzd2l0Y2ggKGRldl9wcml2LT5wc3IuZGVidWcgJiBJ
OTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHsKKwlzd2l0Y2ggKGludGVsX2RwLT5wc3IuZGVidWcg
JiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHsKIAljYXNlIEk5MTVfUFNSX0RFQlVHX0RJU0FC
TEU6CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxOgogCQlyZXR1cm4gZmFsc2U7CkBA
IC0xMDIsMTEgKzEwNCwxMiBAQCBzdGF0aWMgYm9vbCBwc3IyX2dsb2JhbF9lbmFibGVkKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIHBzcl9p
cnFfY29udHJvbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCBwc3JfaXJxX2NvbnRyb2woc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAllbnVtIHRy
YW5zY29kZXIgdHJhbnNfc2hpZnQ7CiAJdTMyIG1hc2ssIHZhbDsKIAlpOTE1X3JlZ190IGltcl9y
ZWc7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRl
bF9kcCk7CiAKIAkvKgogCSAqIGdlbjEyKyBoYXMgcmVnaXN0ZXJzIHJlbGF0aXZlIHRvIHRyYW5z
Y29kZXIgYW5kIG9uZSBwZXIgdHJhbnNjb2RlcgpAQCAtMTE1LDE0ICsxMTgsMTQgQEAgc3RhdGlj
IHZvaWQgcHNyX2lycV9jb250cm9sKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkgKi8KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewogCQl0cmFuc19zaGlmdCA9
IDA7Ci0JCWltcl9yZWcgPSBUUkFOU19QU1JfSU1SKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcik7
CisJCWltcl9yZWcgPSBUUkFOU19QU1JfSU1SKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJ
fSBlbHNlIHsKLQkJdHJhbnNfc2hpZnQgPSBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXI7CisJCXRy
YW5zX3NoaWZ0ID0gaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyOwogCQlpbXJfcmVnID0gRURQX1BT
Ul9JTVI7CiAJfQogCiAJbWFzayA9IEVEUF9QU1JfRVJST1IodHJhbnNfc2hpZnQpOwotCWlmIChk
ZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfSVJRKQorCWlmIChpbnRlbF9kcC0+
cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfSVJRKQogCQltYXNrIHw9IEVEUF9QU1JfUE9TVF9F
WElUKHRyYW5zX3NoaWZ0KSB8CiAJCQlFRFBfUFNSX1BSRV9FTlRSWSh0cmFuc19zaGlmdCk7CiAK
QEAgLTE3MSwzMCArMTc0LDMxIEBAIHN0YXRpYyB2b2lkIHBzcl9ldmVudF9wcmludChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgIlx0UFNS
IGRpc2FibGVkXG4iKTsKIH0KIAotdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKK3ZvaWQgaW50ZWxfcHNyX2ly
cV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiBwc3JfaWlyKQogewotCWVu
dW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGRldl9wcml2LT5wc3IudHJhbnNjb2RlcjsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2Rw
KTsKKwllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBpbnRlbF9kcC0+cHNyLnRyYW5z
Y29kZXI7CiAJZW51bSB0cmFuc2NvZGVyIHRyYW5zX3NoaWZ0OwogCWk5MTVfcmVnX3QgaW1yX3Jl
ZzsKIAlrdGltZV90IHRpbWVfbnMgPSAga3RpbWVfZ2V0KCk7CiAKIAlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMikgewogCQl0cmFuc19zaGlmdCA9IDA7Ci0JCWltcl9yZWcgPSBUUkFOU19Q
U1JfSU1SKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcik7CisJCWltcl9yZWcgPSBUUkFOU19QU1Jf
SU1SKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJfSBlbHNlIHsKLQkJdHJhbnNfc2hpZnQg
PSBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXI7CisJCXRyYW5zX3NoaWZ0ID0gaW50ZWxfZHAtPnBz
ci50cmFuc2NvZGVyOwogCQlpbXJfcmVnID0gRURQX1BTUl9JTVI7CiAJfQogCiAJaWYgKHBzcl9p
aXIgJiBFRFBfUFNSX1BSRV9FTlRSWSh0cmFuc19zaGlmdCkpIHsKLQkJZGV2X3ByaXYtPnBzci5s
YXN0X2VudHJ5X2F0dGVtcHQgPSB0aW1lX25zOworCQlpbnRlbF9kcC0+cHNyLmxhc3RfZW50cnlf
YXR0ZW1wdCA9IHRpbWVfbnM7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJICAg
ICJbdHJhbnNjb2RlciAlc10gUFNSIGVudHJ5IGF0dGVtcHQgaW4gMiB2YmxhbmtzXG4iLAogCQkJ
ICAgIHRyYW5zY29kZXJfbmFtZShjcHVfdHJhbnNjb2RlcikpOwogCX0KIAogCWlmIChwc3JfaWly
ICYgRURQX1BTUl9QT1NUX0VYSVQodHJhbnNfc2hpZnQpKSB7Ci0JCWRldl9wcml2LT5wc3IubGFz
dF9leGl0ID0gdGltZV9uczsKKwkJaW50ZWxfZHAtPnBzci5sYXN0X2V4aXQgPSB0aW1lX25zOwog
CQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAgICAiW3RyYW5zY29kZXIgJXNdIFBT
UiBleGl0IGNvbXBsZXRlZFxuIiwKIAkJCSAgICB0cmFuc2NvZGVyX25hbWUoY3B1X3RyYW5zY29k
ZXIpKTsKQEAgLTIwMiw3ICsyMDYsNyBAQCB2b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKQogCQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA5KSB7CiAJCQl1MzIgdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJp
diwKIAkJCQkJCVBTUl9FVkVOVChjcHVfdHJhbnNjb2RlcikpOwotCQkJYm9vbCBwc3IyX2VuYWJs
ZWQgPSBkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZDsKKwkJCWJvb2wgcHNyMl9lbmFibGVkID0g
aW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQ7CiAKIAkJCWludGVsX2RlX3dyaXRlKGRldl9wcml2
LCBQU1JfRVZFTlQoY3B1X3RyYW5zY29kZXIpLAogCQkJCSAgICAgICB2YWwpOwpAQCAtMjE2LDcg
KzIyMCw3IEBAIHZvaWQgaW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIpCiAJCWRybV93YXJuKCZkZXZfcHJpdi0+ZHJtLCAi
W3RyYW5zY29kZXIgJXNdIFBTUiBhdXggZXJyb3JcbiIsCiAJCQkgdHJhbnNjb2Rlcl9uYW1lKGNw
dV90cmFuc2NvZGVyKSk7CiAKLQkJZGV2X3ByaXYtPnBzci5pcnFfYXV4X2Vycm9yID0gdHJ1ZTsK
KwkJaW50ZWxfZHAtPnBzci5pcnFfYXV4X2Vycm9yID0gdHJ1ZTsKIAogCQkvKgogCQkgKiBJZiB0
aGlzIGludGVycnVwdGlvbiBpcyBub3QgbWFza2VkIGl0IHdpbGwga2VlcApAQCAtMjMwLDcgKzIz
NCw3IEBAIHZvaWQgaW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgdTMyIHBzcl9paXIpCiAJCXZhbCB8PSBFRFBfUFNSX0VSUk9SKHRyYW5zX3No
aWZ0KTsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIGltcl9yZWcsIHZhbCk7CiAKLQkJc2No
ZWR1bGVfd29yaygmZGV2X3ByaXYtPnBzci53b3JrKTsKKwkJc2NoZWR1bGVfd29yaygmaW50ZWxf
ZHAtPnBzci53b3JrKTsKIAl9CiB9CiAKQEAgLTI5MSwxMiArMjk1LDYgQEAgdm9pZCBpbnRlbF9w
c3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0KIAkJdG9faTkxNShkcF90b19kaWdfcG9ydChpbnRlbF9kcCkt
PmJhc2UuYmFzZS5kZXYpOwogCi0JaWYgKGRldl9wcml2LT5wc3IuZHApIHsKLQkJZHJtX3dhcm4o
JmRldl9wcml2LT5kcm0sCi0JCQkgIk1vcmUgdGhhbiBvbmUgZURQIHBhbmVsIGZvdW5kLCBQU1Ig
c3VwcG9ydCBzaG91bGQgYmUgZXh0ZW5kZWRcbiIpOwotCQlyZXR1cm47Ci0JfQotCiAJZHJtX2Rw
X2RwY2RfcmVhZCgmaW50ZWxfZHAtPmF1eCwgRFBfUFNSX1NVUFBPUlQsIGludGVsX2RwLT5wc3Jf
ZHBjZCwKIAkJCSBzaXplb2YoaW50ZWxfZHAtPnBzcl9kcGNkKSk7CiAKQEAgLTMxNywxMiArMzE1
LDEwIEBAIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogCQlyZXR1cm47CiAJfQogCi0JZGV2X3ByaXYtPnBzci5zaW5rX3N1cHBvcnQgPSB0cnVlOwot
CWRldl9wcml2LT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgPQorCWludGVsX2RwLT5wc3Iuc2lua19z
dXBwb3J0ID0gdHJ1ZTsKKwlpbnRlbF9kcC0+cHNyLnNpbmtfc3luY19sYXRlbmN5ID0KIAkJaW50
ZWxfZHBfZ2V0X3Npbmtfc3luY19sYXRlbmN5KGludGVsX2RwKTsKIAotCWRldl9wcml2LT5wc3Iu
ZHAgPSBpbnRlbF9kcDsKLQogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkgJiYKIAkgICAg
KGludGVsX2RwLT5wc3JfZHBjZFswXSA9PSBEUF9QU1IyX1dJVEhfWV9DT09SRF9JU19TVVBQT1JU
RUQpKSB7CiAJCWJvb2wgeV9yZXEgPSBpbnRlbF9kcC0+cHNyX2RwY2RbMV0gJgpAQCAtMzQwLDE0
ICszMzYsMTQgQEAgdm9pZCBpbnRlbF9wc3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApCiAJCSAqIFktY29vcmRpbmF0ZSByZXF1aXJlbWVudCBwYW5lbHMgd2Ugd291bGQgbmVl
ZCB0byBlbmFibGUKIAkJICogR1RDIGZpcnN0LgogCQkgKi8KLQkJZGV2X3ByaXYtPnBzci5zaW5r
X3BzcjJfc3VwcG9ydCA9IHlfcmVxICYmIGFscG07CisJCWludGVsX2RwLT5wc3Iuc2lua19wc3Iy
X3N1cHBvcnQgPSB5X3JlcSAmJiBhbHBtOwogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwg
IlBTUjIgJXNzdXBwb3J0ZWRcbiIsCi0JCQkgICAgZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3Vw
cG9ydCA/ICIiIDogIm5vdCAiKTsKKwkJCSAgICBpbnRlbF9kcC0+cHNyLnNpbmtfcHNyMl9zdXBw
b3J0ID8gIiIgOiAibm90ICIpOwogCi0JCWlmIChkZXZfcHJpdi0+cHNyLnNpbmtfcHNyMl9zdXBw
b3J0KSB7Ci0JCQlkZXZfcHJpdi0+cHNyLmNvbG9yaW1ldHJ5X3N1cHBvcnQgPQorCQlpZiAoaW50
ZWxfZHAtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkgeworCQkJaW50ZWxfZHAtPnBzci5jb2xvcmlt
ZXRyeV9zdXBwb3J0ID0KIAkJCQlpbnRlbF9kcF9nZXRfY29sb3JpbWV0cnlfc3RhdHVzKGludGVs
X2RwKTsKLQkJCWRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSA9CisJCQlpbnRlbF9kcC0+
cHNyLnN1X3hfZ3JhbnVsYXJpdHkgPQogCQkJCWludGVsX2RwX2dldF9zdV94X2dyYW51bGFydGl5
KGludGVsX2RwKTsKIAkJfQogCX0KQEAgLTM3Myw3ICszNjksNyBAQCBzdGF0aWMgdm9pZCBoc3df
cHNyX3NldHVwX2F1eChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCUJVSUxEX0JVR19PTihz
aXplb2YoYXV4X21zZykgPiAyMCk7CiAJZm9yIChpID0gMDsgaSA8IHNpemVvZihhdXhfbXNnKTsg
aSArPSA0KQogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAgICAgICBFRFBfUFNSX0FV
WF9EQVRBKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciwgaSA+PiAyKSwKKwkJCSAgICAgICBFRFBf
UFNSX0FVWF9EQVRBKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciwgaSA+PiAyKSwKIAkJCSAgICAg
ICBpbnRlbF9kcF9wYWNrX2F1eCgmYXV4X21zZ1tpXSwgc2l6ZW9mKGF1eF9tc2cpIC0gaSkpOwog
CiAJYXV4X2Nsb2NrX2RpdmlkZXIgPSBpbnRlbF9kcC0+Z2V0X2F1eF9jbG9ja19kaXZpZGVyKGlu
dGVsX2RwLCAwKTsKQEAgLTM4NCw3ICszODAsNyBAQCBzdGF0aWMgdm9pZCBoc3dfcHNyX3NldHVw
X2F1eChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCiAJLyogU2VsZWN0IG9ubHkgdmFsaWQg
Yml0cyBmb3IgU1JEX0FVWF9DVEwgKi8KIAlhdXhfY3RsICY9IHBzcl9hdXhfbWFzazsKLQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9BVVhfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNj
b2RlciksCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQVVYX0NUTChpbnRlbF9k
cC0+cHNyLnRyYW5zY29kZXIpLAogCQkgICAgICAgYXV4X2N0bCk7CiB9CiAKQEAgLTM5NCwxNCAr
MzkwLDE0IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc2luayhzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQogCXU4IGRwY2RfdmFsID0gRFBfUFNSX0VOQUJMRTsKIAogCS8qIEVuYWJs
ZSBBTFBNIGF0IHNpbmsgZm9yIHBzcjIgKi8KLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJs
ZWQpIHsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKIAkJZHJtX2RwX2RwY2Rf
d3JpdGViKCZpbnRlbF9kcC0+YXV4LCBEUF9SRUNFSVZFUl9BTFBNX0NPTkZJRywKIAkJCQkgICBE
UF9BTFBNX0VOQUJMRSB8CiAJCQkJICAgRFBfQUxQTV9MT0NLX0VSUk9SX0lSUV9IUERfRU5BQkxF
KTsKIAogCQlkcGNkX3ZhbCB8PSBEUF9QU1JfRU5BQkxFX1BTUjIgfCBEUF9QU1JfSVJRX0hQRF9X
SVRIX0NSQ19FUlJPUlM7CiAJfSBlbHNlIHsKLQkJaWYgKGRldl9wcml2LT5wc3IubGlua19zdGFu
ZGJ5KQorCQlpZiAoaW50ZWxfZHAtPnBzci5saW5rX3N0YW5kYnkpCiAJCQlkcGNkX3ZhbCB8PSBE
UF9QU1JfTUFJTl9MSU5LX0FDVElWRTsKIAogCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4
KQpAQCAtNDY0LDcgKzQ2MCw3IEBAIHN0YXRpYyB1OCBwc3JfY29tcHV0ZV9pZGxlX2ZyYW1lcyhz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCSAqIG9mZi1ieS1vbmUgaXNzdWUgdGhhdCBIVyBo
YXMgaW4gc29tZSBjYXNlcy4KIAkgKi8KIAlpZGxlX2ZyYW1lcyA9IG1heCg2LCBkZXZfcHJpdi0+
dmJ0LnBzci5pZGxlX2ZyYW1lcyk7Ci0JaWRsZV9mcmFtZXMgPSBtYXgoaWRsZV9mcmFtZXMsIGRl
dl9wcml2LT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgKyAxKTsKKwlpZGxlX2ZyYW1lcyA9IG1heChp
ZGxlX2ZyYW1lcywgaW50ZWxfZHAtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOwogCiAJaWYg
KGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBpZGxlX2ZyYW1lcyA+IDB4ZikpCiAJCWlkbGVf
ZnJhbWVzID0gMHhmOwpAQCAtNDg0LDcgKzQ4MCw3IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0
ZV9wc3IxKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYgKElTX0hBU1dFTEwoZGV2X3By
aXYpKQogCQl2YWwgfD0gRURQX1BTUl9NSU5fTElOS19FTlRSWV9USU1FXzhfTElORVM7CiAKLQlp
ZiAoZGV2X3ByaXYtPnBzci5saW5rX3N0YW5kYnkpCisJaWYgKGludGVsX2RwLT5wc3IubGlua19z
dGFuZGJ5KQogCQl2YWwgfD0gRURQX1BTUl9MSU5LX1NUQU5EQlk7CiAKIAl2YWwgfD0gaW50ZWxf
cHNyMV9nZXRfdHBfdGltZShpbnRlbF9kcCk7CkBAIC00OTIsOSArNDg4LDkgQEAgc3RhdGljIHZv
aWQgaHN3X2FjdGl2YXRlX3BzcjEoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA4KQogCQl2YWwgfD0gRURQX1BTUl9DUkNfRU5BQkxFOwogCi0J
dmFsIHw9IChpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSX0NUTChkZXZfcHJpdi0+cHNy
LnRyYW5zY29kZXIpKSAmCisJdmFsIHw9IChpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNS
X0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKSAmCiAJCUVEUF9QU1JfUkVTVE9SRV9QU1Jf
QUNUSVZFX0NUWF9NQVNLKTsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwo
ZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIH0KIAogc3Rh
dGljIHUzMiBpbnRlbF9wc3IyX2dldF90cF90aW1lKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAp
CkBAIC01MjksNyArNTI1LDcgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjIoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCkKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJ
U19HRU1JTklMQUtFKGRldl9wcml2KSkKIAkJdmFsIHw9IEVEUF9ZX0NPT1JESU5BVEVfRU5BQkxF
OwogCi0JdmFsIHw9IEVEUF9QU1IyX0ZSQU1FX0JFRk9SRV9TVShkZXZfcHJpdi0+cHNyLnNpbmtf
c3luY19sYXRlbmN5ICsgMSk7CisJdmFsIHw9IEVEUF9QU1IyX0ZSQU1FX0JFRk9SRV9TVShpbnRl
bF9kcC0+cHNyLnNpbmtfc3luY19sYXRlbmN5ICsgMSk7CiAJdmFsIHw9IGludGVsX3BzcjJfZ2V0
X3RwX3RpbWUoaW50ZWxfZHApOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsK
QEAgLTU0OCw3ICs1NDQsNyBAQCBzdGF0aWMgdm9pZCBoc3dfYWN0aXZhdGVfcHNyMihzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwKQogCQl2YWwgfD0gRURQX1BTUjJfRkFTVF9XQUtFKDcpOwogCX0K
IAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQpIHsKKwlpZiAoaW50
ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkKSB7CiAJCS8qIFdBIDE0MDgzMzA4NDcg
Ki8KIAkJaWYgKElTX1RHTF9ESVNQX1JFVklEKGRldl9wcml2LCBUR0xfUkVWSURfQTAsIFRHTF9S
RVZJRF9BMCkgfHwKIAkJICAgIElTX1JLTF9SRVZJRChkZXZfcHJpdiwgUktMX1JFVklEX0EwLCBS
S0xfUkVWSURfQTApKQpAQCAtNTU3LDIwICs1NTMsMjAgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2
YXRlX3BzcjIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJCQkgICAgIERJU19SQU1fQllQ
QVNTX1BTUjJfTUFOX1RSQUNLKTsKIAogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAg
ICAgICBQU1IyX01BTl9UUktfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJCQkgICAg
ICAgUFNSMl9NQU5fVFJLX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLAogCQkJICAgICAg
IFBTUjJfTUFOX1RSS19DVExfRU5BQkxFKTsKIAl9IGVsc2UgaWYgKEhBU19QU1IyX1NFTF9GRVRD
SChkZXZfcHJpdikpIHsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgICAgUFNS
Ml9NQU5fVFJLX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLCAwKTsKKwkJCSAgICAgICBQ
U1IyX01BTl9UUktfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksIDApOwogCX0KIAogCS8q
CiAJICogUFNSMiBIVyBpcyBpbmNvcnJlY3RseSB1c2luZyBFRFBfUFNSX1RQMV9UUDNfU0VMIGFu
ZCBCU3BlYyBpcwogCSAqIHJlY29tbWVuZGluZyBrZWVwIHRoaXMgYml0IHVuc2V0IHdoaWxlIFBT
UjIgaXMgZW5hYmxlZC4KIAkgKi8KLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9D
VEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgMCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksIDApOwogCi0JaW50ZWxf
ZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIp
LCB2YWwpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSMl9DVEwoaW50ZWxfZHAt
PnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIH0KIAogc3RhdGljIGJvb2wKQEAgLTU5Myw1NSArNTg5
LDU4IEBAIHN0YXRpYyB1MzIgaW50ZWxfZ2V0X2ZyYW1lX3RpbWVfdXMoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkKIAkJCSAgICBkcm1fbW9kZV92cmVmcmVzaCgmY3N0YXRl
LT5ody5hZGp1c3RlZF9tb2RlKSk7CiB9CiAKLXN0YXRpYyB2b2lkIHBzcjJfcHJvZ3JhbV9pZGxl
X2ZyYW1lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBw
c3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkg
ICAgIHUzMiBpZGxlX2ZyYW1lcykKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAl1MzIgdmFsOwogCiAJaWRsZV9mcmFtZXMgPDw9
ICBFRFBfUFNSMl9JRExFX0ZSQU1FX1NISUZUOwotCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwl2YWwgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVy
KSk7CiAJdmFsICY9IH5FRFBfUFNSMl9JRExFX0ZSQU1FX01BU0s7CiAJdmFsIHw9IGlkbGVfZnJh
bWVzOwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyKSwgdmFsKTsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUjJf
Q1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksIHZhbCk7CiB9CiAKLXN0YXRpYyB2b2lkIHRn
bF9wc3IyX2VuYWJsZV9kYzNjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitz
dGF0aWMgdm9pZCB0Z2xfcHNyMl9lbmFibGVfZGMzY28oc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIHsKLQlwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoZGV2X3ByaXYsIDApOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCisJcHNy
Ml9wcm9ncmFtX2lkbGVfZnJhbWVzKGludGVsX2RwLCAwKTsKIAlpbnRlbF9kaXNwbGF5X3Bvd2Vy
X3NldF90YXJnZXRfZGNfc3RhdGUoZGV2X3ByaXYsIERDX1NUQVRFX0VOX0RDM0NPKTsKIH0KIAot
c3RhdGljIHZvaWQgdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGRldl9w
cml2LT5wc3IuZHA7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9f
aTkxNShpbnRlbF9kcCk7CiAKIAlpbnRlbF9kaXNwbGF5X3Bvd2VyX3NldF90YXJnZXRfZGNfc3Rh
dGUoZGV2X3ByaXYsIERDX1NUQVRFX0VOX1VQVE9fREM2KTsKLQlwc3IyX3Byb2dyYW1faWRsZV9m
cmFtZXMoZGV2X3ByaXYsIHBzcl9jb21wdXRlX2lkbGVfZnJhbWVzKGludGVsX2RwKSk7CisJcHNy
Ml9wcm9ncmFtX2lkbGVfZnJhbWVzKGludGVsX2RwLCBwc3JfY29tcHV0ZV9pZGxlX2ZyYW1lcyhp
bnRlbF9kcCkpOwogfQogCiBzdGF0aWMgdm9pZCB0Z2xfZGMzY29fZGlzYWJsZV93b3JrKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPQotCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpkZXZfcHJpdiksIHBzci5kYzNjb193
b3JrLndvcmspOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPQorCQljb250YWluZXJfb2Yo
d29yaywgdHlwZW9mKCppbnRlbF9kcCksIHBzci5kYzNjb193b3JrLndvcmspOwogCi0JbXV0ZXhf
bG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxv
Y2spOwogCS8qIElmIGRlbGF5ZWQgd29yayBpcyBwZW5kaW5nLCBpdCBpcyBub3QgaWRsZSAqLwot
CWlmIChkZWxheWVkX3dvcmtfcGVuZGluZygmZGV2X3ByaXYtPnBzci5kYzNjb193b3JrKSkKKwlp
ZiAoZGVsYXllZF93b3JrX3BlbmRpbmcoJmludGVsX2RwLT5wc3IuZGMzY29fd29yaykpCiAJCWdv
dG8gdW5sb2NrOwogCi0JdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhkZXZfcHJpdik7CisJdGdsX3Bz
cjJfZGlzYWJsZV9kYzNjbyhpbnRlbF9kcCk7CiB1bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIH0K
IAotc3RhdGljIHZvaWQgdGdsX2Rpc2FsbG93X2RjM2NvX29uX3BzcjJfZXhpdChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB0Z2xfZGlzYWxsb3dfZGMzY29f
b25fcHNyMl9leGl0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0JaWYgKCFkZXZfcHJp
di0+cHNyLmRjM2NvX2VuYWJsZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmRjM2NvX2VuYWJsZWQp
CiAJCXJldHVybjsKIAotCWNhbmNlbF9kZWxheWVkX3dvcmsoJmRldl9wcml2LT5wc3IuZGMzY29f
d29yayk7CisJY2FuY2VsX2RlbGF5ZWRfd29yaygmaW50ZWxfZHAtPnBzci5kYzNjb193b3JrKTsK
IAkvKiBCZWZvcmUgUFNSMiBleGl0IGRpc2FsbG93IGRjM2NvKi8KLQl0Z2xfcHNyMl9kaXNhYmxl
X2RjM2NvKGRldl9wcml2KTsKKwl0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKGludGVsX2RwKTsKIH0K
IAogc3RhdGljIHZvaWQKQEAgLTcxNCw3ICs3MTMsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wc3Iy
X2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCWludCBjcnRjX3ZkaXNw
bGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwogCWludCBw
c3JfbWF4X2ggPSAwLCBwc3JfbWF4X3YgPSAwLCBtYXhfYnBwID0gMDsKIAotCWlmICghZGV2X3By
aXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkKKwlpZiAoIWludGVsX2RwLT5wc3Iuc2lua19wc3Iy
X3N1cHBvcnQpCiAJCXJldHVybiBmYWxzZTsKIAogCWlmICghdHJhbnNjb2Rlcl9oYXNfcHNyMihk
ZXZfcHJpdiwgY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIpKSB7CkBAIC03MjQsNyArNzIzLDcg
QEAgc3RhdGljIGJvb2wgaW50ZWxfcHNyMl9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAotCWlmICghcHNyMl9nbG9iYWxfZW5hYmxl
ZChkZXZfcHJpdikpIHsKKwlpZiAoIXBzcjJfZ2xvYmFsX2VuYWJsZWQoaW50ZWxfZHApKSB7CiAJ
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiUFNSMiBkaXNhYmxlZCBieSBmbGFnXG4iKTsK
IAkJcmV0dXJuIGZhbHNlOwogCX0KQEAgLTc3MywxMCArNzcyLDEwIEBAIHN0YXRpYyBib29sIGlu
dGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJICogb25s
eSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBTVSBibG9jayB3aWR0aCBpcyBhIG11bHRpcGxlIG9mCiAJ
ICogeCBncmFudWxhcml0eS4KIAkgKi8KLQlpZiAoY3J0Y19oZGlzcGxheSAlIGRldl9wcml2LT5w
c3Iuc3VfeF9ncmFudWxhcml0eSkgeworCWlmIChjcnRjX2hkaXNwbGF5ICUgaW50ZWxfZHAtPnBz
ci5zdV94X2dyYW51bGFyaXR5KSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJ
ICAgICJQU1IyIG5vdCBlbmFibGVkLCBoZGlzcGxheSglZCkgbm90IG11bHRpcGxlIG9mICVkXG4i
LAotCQkJICAgIGNydGNfaGRpc3BsYXksIGRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSk7
CisJCQkgICAgY3J0Y19oZGlzcGxheSwgaW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFyaXR5KTsK
IAkJcmV0dXJuIGZhbHNlOwogCX0KIApAQCAtODExLDMwICs4MTAsMjUgQEAgdm9pZCBpbnRlbF9w
c3JfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJJmNydGNfc3Rh
dGUtPmh3LmFkanVzdGVkX21vZGU7CiAJaW50IHBzcl9zZXR1cF90aW1lOwogCi0JaWYgKCFDQU5f
UFNSKGRldl9wcml2KSkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHApKQogCQlyZXR1cm47CiAKLQlp
ZiAoaW50ZWxfZHAgIT0gZGV2X3ByaXYtPnBzci5kcCkKLQkJcmV0dXJuOwotCi0JaWYgKCFwc3Jf
Z2xvYmFsX2VuYWJsZWQoZGV2X3ByaXYpKSB7CisJaWYgKCFwc3JfZ2xvYmFsX2VuYWJsZWQoaW50
ZWxfZHApKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiUFNSIGRpc2FibGVkIGJ5
IGZsYWdcbiIpOwogCQlyZXR1cm47CiAJfQogCiAJLyoKIAkgKiBIU1cgc3BlYyBleHBsaWNpdGx5
IHNheXMgUFNSIGlzIHRpZWQgdG8gcG9ydCBBLgotCSAqIEJEVysgcGxhdGZvcm1zIGhhdmUgYSBp
bnN0YW5jZSBvZiBQU1IgcmVnaXN0ZXJzIHBlciB0cmFuc2NvZGVyIGJ1dAotCSAqIGZvciBub3cg
aXQgb25seSBzdXBwb3J0cyBvbmUgaW5zdGFuY2Ugb2YgUFNSLCBzbyBsZXRzIGtlZXAgaXQKLQkg
KiBoYXJkY29kZWQgdG8gUE9SVF9BCisJICogQkRXKyBwbGF0Zm9ybXMgaGF2ZSBhIGluc3RhbmNl
IG9mIFBTUiByZWdpc3RlcnMgcGVyIHRyYW5zY29kZXIuCiAJICovCi0JaWYgKGRpZ19wb3J0LT5i
YXNlLnBvcnQgIT0gUE9SVF9BKSB7CisJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmIGRpZ19w
b3J0LT5iYXNlLnBvcnQgIT0gUE9SVF9BKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJt
LAogCQkJICAgICJQU1IgY29uZGl0aW9uIGZhaWxlZDogUG9ydCBub3Qgc3VwcG9ydGVkXG4iKTsK
IAkJcmV0dXJuOwogCX0KIAotCWlmIChkZXZfcHJpdi0+cHNyLnNpbmtfbm90X3JlbGlhYmxlKSB7
CisJaWYgKGludGVsX2RwLT5wc3Iuc2lua19ub3RfcmVsaWFibGUpIHsKIAkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sCiAJCQkgICAgIlBTUiBzaW5rIGltcGxlbWVudGF0aW9uIGlzIG5vdCBy
ZWxpYWJsZVxuIik7CiAJCXJldHVybjsKQEAgLTg3MCwyMyArODY0LDI0IEBAIHZvaWQgaW50ZWxf
cHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiBzdGF0aWMgdm9p
ZCBpbnRlbF9wc3JfYWN0aXZhdGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwll
bnVtIHRyYW5zY29kZXIgdHJhbnNjb2RlciA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsKIAot
CWlmICh0cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2LCBkZXZfcHJpdi0+cHNyLnRyYW5zY29k
ZXIpKQorCWlmICh0cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2LCB0cmFuc2NvZGVyKSkKIAkJ
ZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sCi0JCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJp
diwgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpICYgRURQX1BTUjJfRU5B
QkxFKTsKKwkJCSAgICBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSMl9DVEwodHJhbnNj
b2RlcikpICYgRURQX1BTUjJfRU5BQkxFKTsKIAogCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJt
LAotCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyKSkgJiBFRFBfUFNSX0VOQUJMRSk7Ci0JZHJtX1dBUk5fT04oJmRldl9wcml2
LT5kcm0sIGRldl9wcml2LT5wc3IuYWN0aXZlKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZf
cHJpdi0+cHNyLmxvY2spOworCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9D
VEwodHJhbnNjb2RlcikpICYgRURQX1BTUl9FTkFCTEUpOworCWRybV9XQVJOX09OKCZkZXZfcHJp
di0+ZHJtLCBpbnRlbF9kcC0+cHNyLmFjdGl2ZSk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaW50
ZWxfZHAtPnBzci5sb2NrKTsKIAogCS8qIHBzcjEgYW5kIHBzcjIgYXJlIG11dHVhbGx5IGV4Y2x1
c2l2ZS4qLwotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkKKwlpZiAoaW50ZWxfZHAt
PnBzci5wc3IyX2VuYWJsZWQpCiAJCWhzd19hY3RpdmF0ZV9wc3IyKGludGVsX2RwKTsKIAllbHNl
CiAJCWhzd19hY3RpdmF0ZV9wc3IxKGludGVsX2RwKTsKIAotCWRldl9wcml2LT5wc3IuYWN0aXZl
ID0gdHJ1ZTsKKwlpbnRlbF9kcC0+cHNyLmFjdGl2ZSA9IHRydWU7CiB9CiAKIHN0YXRpYyB2b2lk
IGludGVsX3Bzcl9lbmFibGVfc291cmNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCkBAIC05
MDIsNyArODk3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJP
QURXRUxMKGRldl9wcml2KSkKIAkJaHN3X3Bzcl9zZXR1cF9hdXgoaW50ZWxfZHApOwogCi0JaWYg
KGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkICYmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCisJ
aWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkICYmIChJU19HRU4oZGV2X3ByaXYsIDkpICYm
CiAJCQkJCSAgICFJU19HRU1JTklMQUtFKGRldl9wcml2KSkpIHsKIAkJaTkxNV9yZWdfdCByZWcg
PSBDSElDS0VOX1RSQU5TKGNwdV90cmFuc2NvZGVyKTsKIAkJdTMyIGNoaWNrZW4gPSBpbnRlbF9k
ZV9yZWFkKGRldl9wcml2LCByZWcpOwpAQCAtOTI2LDEwICs5MjEsMTAgQEAgc3RhdGljIHZvaWQg
aW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA8IDExKQogCQltYXNrIHw9IEVEUF9QU1JfREVCVUdfTUFTS19E
SVNQX1JFR19XUklURTsKIAotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0RFQlVH
KGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVE
UF9QU1JfREVCVUcoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwKIAkJICAgICAgIG1hc2spOwog
Ci0JcHNyX2lycV9jb250cm9sKGRldl9wcml2KTsKKwlwc3JfaXJxX2NvbnRyb2woaW50ZWxfZHAp
OwogCiAJaWYgKGNydGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lKSB7CiAJCXUzMiB2YWw7CkBAIC05
NDcsMzAgKzk0MiwzMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCiAJaWYgKEhBU19QU1JfSFdfVFJBQ0tJTkcoZGV2X3By
aXYpICYmIEhBU19QU1IyX1NFTF9GRVRDSChkZXZfcHJpdikpCiAJCWludGVsX2RlX3JtdyhkZXZf
cHJpdiwgQ0hJQ0tFTl9QQVIxXzEsIElHTk9SRV9QU1IyX0hXX1RSQUNLSU5HLAotCQkJICAgICBk
ZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgPworCQkJICAgICBpbnRlbF9kcC0+
cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgPwogCQkJICAgICBJR05PUkVfUFNSMl9IV19UUkFD
S0lORyA6IDApOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX2xvY2tlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5h
YmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRy
bV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCA9IGRldl9wcml2LT5wc3IuZHA7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
ZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIgPSAmZGlnX3BvcnQtPmJhc2U7CiAJdTMyIHZhbDsKIAotCWRybV9XQVJOX09O
KCZkZXZfcHJpdi0+ZHJtLCBkZXZfcHJpdi0+cHNyLmVuYWJsZWQpOworCWRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLCBpbnRlbF9kcC0+cHNyLmVuYWJsZWQpOwogCi0JZGV2X3ByaXYtPnBzci5w
c3IyX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5oYXNfcHNyMjsKLQlkZXZfcHJpdi0+cHNyLmJ1c3lf
ZnJvbnRidWZmZXJfYml0cyA9IDA7Ci0JZGV2X3ByaXYtPnBzci5waXBlID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOwotCWRldl9wcml2LT5wc3IuZGMzY29fZW5h
YmxlZCA9ICEhY3J0Y19zdGF0ZS0+ZGMzY29fZXhpdGxpbmU7Ci0JZGV2X3ByaXYtPnBzci50cmFu
c2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CisJaW50ZWxfZHAtPnBzci5wc3Iy
X2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5oYXNfcHNyMjsKKwlpbnRlbF9kcC0+cHNyLmJ1c3lfZnJv
bnRidWZmZXJfYml0cyA9IDA7CisJaW50ZWxfZHAtPnBzci5waXBlID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOworCWludGVsX2RwLT5wc3IuZGMzY29fZW5hYmxl
ZCA9ICEhY3J0Y19zdGF0ZS0+ZGMzY29fZXhpdGxpbmU7CisJaW50ZWxfZHAtPnBzci50cmFuc2Nv
ZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAJLyogREM1L0RDNiByZXF1aXJlcyBh
dCBsZWFzdCA2IGlkbGUgZnJhbWVzICovCiAJdmFsID0gdXNlY3NfdG9famlmZmllcyhpbnRlbF9n
ZXRfZnJhbWVfdGltZV91cyhjcnRjX3N0YXRlKSAqIDYpOwotCWRldl9wcml2LT5wc3IuZGMzY29f
ZXhpdF9kZWxheSA9IHZhbDsKLQlkZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQg
PSBjcnRjX3N0YXRlLT5lbmFibGVfcHNyMl9zZWxfZmV0Y2g7CisJaW50ZWxfZHAtPnBzci5kYzNj
b19leGl0X2RlbGF5ID0gdmFsOworCWludGVsX2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxl
ZCA9IGNydGNfc3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9mZXRjaDsKIAogCS8qCiAJICogSWYgYSBQ
U1IgZXJyb3IgaGFwcGVuZWQgYW5kIHRoZSBkcml2ZXIgaXMgcmVsb2FkZWQsIHRoZSBFRFBfUFNS
X0lJUgpAQCAtOTgyLDI3ICs5NzcsMjcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9s
b2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqLwogCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYs
Ci0JCQkJICAgIFRSQU5TX1BTUl9JSVIoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJ
ICAgIFRSQU5TX1BTUl9JSVIoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXZhbCAmPSBF
RFBfUFNSX0VSUk9SKDApOwogCX0gZWxzZSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsIEVEUF9QU1JfSUlSKTsKLQkJdmFsICY9IEVEUF9QU1JfRVJST1IoZGV2X3ByaXYtPnBzci50
cmFuc2NvZGVyKTsKKwkJdmFsICY9IEVEUF9QU1JfRVJST1IoaW50ZWxfZHAtPnBzci50cmFuc2Nv
ZGVyKTsKIAl9CiAJaWYgKHZhbCkgewotCQlkZXZfcHJpdi0+cHNyLnNpbmtfbm90X3JlbGlhYmxl
ID0gdHJ1ZTsKKwkJaW50ZWxfZHAtPnBzci5zaW5rX25vdF9yZWxpYWJsZSA9IHRydWU7CiAJCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1IgaW50ZXJydXB0aW9uIGVycm9y
IHNldCwgbm90IGVuYWJsaW5nIFBTUlxuIik7CiAJCXJldHVybjsKIAl9CiAKIAlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwgIkVuYWJsaW5nIFBTUiVzXG4iLAotCQkgICAgZGV2X3ByaXYtPnBz
ci5wc3IyX2VuYWJsZWQgPyAiMiIgOiAiMSIpOworCQkgICAgaW50ZWxfZHAtPnBzci5wc3IyX2Vu
YWJsZWQgPyAiMiIgOiAiMSIpOwogCWludGVsX2RwX2NvbXB1dGVfcHNyX3ZzY19zZHAoaW50ZWxf
ZHAsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUsCi0JCQkJICAgICAmZGV2X3ByaXYtPnBzci52c2Mp
OwotCWludGVsX3dyaXRlX2RwX3ZzY19zZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgJmRldl9wcml2
LT5wc3IudnNjKTsKKwkJCQkgICAgICZpbnRlbF9kcC0+cHNyLnZzYyk7CisJaW50ZWxfd3JpdGVf
ZHBfdnNjX3NkcChlbmNvZGVyLCBjcnRjX3N0YXRlLCAmaW50ZWxfZHAtPnBzci52c2MpOwogCWlu
dGVsX3Bzcl9lbmFibGVfc2luayhpbnRlbF9kcCk7CiAJaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uo
aW50ZWxfZHAsIGNydGNfc3RhdGUpOwotCWRldl9wcml2LT5wc3IuZW5hYmxlZCA9IHRydWU7CisJ
aW50ZWxfZHAtPnBzci5lbmFibGVkID0gdHJ1ZTsKIAogCWludGVsX3Bzcl9hY3RpdmF0ZShpbnRl
bF9kcCk7CiB9CkBAIC0xMDIxLDcgKzEwMTYsNyBAQCB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikg
fHwgZGV2X3ByaXYtPnBzci5kcCAhPSBpbnRlbF9kcCkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHAp
KQogCQlyZXR1cm47CiAKIAlpZiAoIWNydGNfc3RhdGUtPmhhc19wc3IpCkBAIC0xMDI5LDQ2ICsx
MDI0LDQ3IEBAIHZvaWQgaW50ZWxfcHNyX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
LAogCiAJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRldl9wcml2LT5kcnJzLmRwKTsKIAot
CW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7Ci0JaW50ZWxfcHNyX2VuYWJsZV9sb2Nr
ZWQoZGV2X3ByaXYsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOwotCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCWlu
dGVsX3Bzcl9lbmFibGVfbG9ja2VkKGludGVsX2RwLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsK
KwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIGlu
dGVsX3Bzcl9leGl0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIGludGVsX3Bzcl9leGl0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTMy
IHZhbDsKIAotCWlmICghZGV2X3ByaXYtPnBzci5hY3RpdmUpIHsKLQkJaWYgKHRyYW5zY29kZXJf
aGFzX3BzcjIoZGV2X3ByaXYsIGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpIHsKKwlpZiAoIWlu
dGVsX2RwLT5wc3IuYWN0aXZlKSB7CisJCWlmICh0cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2
LCBpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKSB7CiAJCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRl
dl9wcml2LAotCQkJCQkgICAgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcikp
OworCQkJCQkgICAgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQkJ
ZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHZhbCAmIEVEUF9QU1IyX0VOQUJMRSk7CiAJCX0K
IAogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAgICBFRFBfUFNSX0NUTChk
ZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAt
PnBzci50cmFuc2NvZGVyKSk7CiAJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCB2YWwgJiBF
RFBfUFNSX0VOQUJMRSk7CiAKIAkJcmV0dXJuOwogCX0KIAotCWlmIChkZXZfcHJpdi0+cHNyLnBz
cjJfZW5hYmxlZCkgewotCQl0Z2xfZGlzYWxsb3dfZGMzY29fb25fcHNyMl9leGl0KGRldl9wcml2
KTsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJdGdsX2Rpc2FsbG93X2Rj
M2NvX29uX3BzcjJfZXhpdChpbnRlbF9kcCk7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsCi0JCQkJICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJ
CQkgICAgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlkcm1fV0FS
Tl9PTigmZGV2X3ByaXYtPmRybSwgISh2YWwgJiBFRFBfUFNSMl9FTkFCTEUpKTsKIAkJdmFsICY9
IH5FRFBfUFNSMl9FTkFCTEU7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LAotCQkJICAgICAg
IEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOworCQkJICAgICAg
IEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOwogCX0gZWxzZSB7
CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1JfQ1RMKGRl
dl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSX0NUTChpbnRlbF9kcC0+
cHNyLnRyYW5zY29kZXIpKTsKIAkJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICEodmFsICYg
RURQX1BTUl9FTkFCTEUpKTsKIAkJdmFsICY9IH5FRFBfUFNSX0VOQUJMRTsKIAkJaW50ZWxfZGVf
d3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgICAgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFu
c2NvZGVyKSwgdmFsKTsKKwkJCSAgICAgICBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5z
Y29kZXIpLCB2YWwpOwogCX0KLQlkZXZfcHJpdi0+cHNyLmFjdGl2ZSA9IGZhbHNlOworCWludGVs
X2RwLT5wc3IuYWN0aXZlID0gZmFsc2U7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9kaXNh
YmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQpAQCAtMTA3NywyMSArMTA3Mywy
MSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIAlpOTE1X3JlZ190IHBzcl9zdGF0dXM7CiAJdTMyIHBzcl9zdGF0dXNfbWFz
azsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5wc3IubG9jayk7CisJbG9ja2Rl
cF9hc3NlcnRfaGVsZCgmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAotCWlmICghZGV2X3ByaXYtPnBz
ci5lbmFibGVkKQorCWlmICghaW50ZWxfZHAtPnBzci5lbmFibGVkKQogCQlyZXR1cm47CiAKIAlk
cm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkRpc2FibGluZyBQU1Ilc1xuIiwKLQkJICAgIGRl
dl9wcml2LT5wc3IucHNyMl9lbmFibGVkID8gIjIiIDogIjEiKTsKKwkJICAgIGludGVsX2RwLT5w
c3IucHNyMl9lbmFibGVkID8gIjIiIDogIjEiKTsKIAotCWludGVsX3Bzcl9leGl0KGRldl9wcml2
KTsKKwlpbnRlbF9wc3JfZXhpdChpbnRlbF9kcCk7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3Iy
X2VuYWJsZWQpIHsKLQkJcHNyX3N0YXR1cyA9IEVEUF9QU1IyX1NUQVRVUyhkZXZfcHJpdi0+cHNy
LnRyYW5zY29kZXIpOworCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgeworCQlwc3Jf
c3RhdHVzID0gRURQX1BTUjJfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCXBz
cl9zdGF0dXNfbWFzayA9IEVEUF9QU1IyX1NUQVRVU19TVEFURV9NQVNLOwogCX0gZWxzZSB7Ci0J
CXBzcl9zdGF0dXMgPSBFRFBfUFNSX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOwor
CQlwc3Jfc3RhdHVzID0gRURQX1BTUl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsK
IAkJcHNyX3N0YXR1c19tYXNrID0gRURQX1BTUl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9CiAKQEAg
LTExMDEsNyArMTA5Nyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAiVGlt
ZWQgb3V0IHdhaXRpbmcgUFNSIGlkbGUgc3RhdGVcbiIpOwogCiAJLyogV0EgMTQwODMzMDg0NyAq
LwotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgJiYKKwlpZiAoaW50
ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkICYmCiAJICAgIChJU19UR0xfRElTUF9S
RVZJRChkZXZfcHJpdiwgVEdMX1JFVklEX0EwLCBUR0xfUkVWSURfQTApIHx8CiAJICAgICBJU19S
S0xfUkVWSUQoZGV2X3ByaXYsIFJLTF9SRVZJRF9BMCwgUktMX1JFVklEX0EwKSkpCiAJCWludGVs
X2RlX3JtdyhkZXZfcHJpdiwgQ0hJQ0tFTl9QQVIxXzEsCkBAIC0xMTEwLDEwICsxMTA2LDEwIEBA
IHN0YXRpYyB2b2lkIGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwKQogCS8qIERpc2FibGUgUFNSIG9uIFNpbmsgKi8KIAlkcm1fZHBfZHBjZF93cml0ZWIo
JmludGVsX2RwLT5hdXgsIERQX1BTUl9FTl9DRkcsIDApOwogCi0JaWYgKGRldl9wcml2LT5wc3Iu
cHNyMl9lbmFibGVkKQorCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkKIAkJZHJtX2Rw
X2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LCBEUF9SRUNFSVZFUl9BTFBNX0NPTkZJRywgMCk7
CiAKLQlkZXZfcHJpdi0+cHNyLmVuYWJsZWQgPSBmYWxzZTsKKwlpbnRlbF9kcC0+cHNyLmVuYWJs
ZWQgPSBmYWxzZTsKIH0KIAogLyoqCkBAIC0xMTMxLDIwICsxMTI3LDIyIEBAIHZvaWQgaW50ZWxf
cHNyX2Rpc2FibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAoIW9sZF9jcnRjX3N0
YXRlLT5oYXNfcHNyKQogCQlyZXR1cm47CiAKLQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5k
cm0sICFDQU5fUFNSKGRldl9wcml2KSkpCisJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJt
LCAhQ0FOX1BTUihpbnRlbF9kcCkpKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZkZXZfcHJp
di0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAlpbnRl
bF9wc3JfZGlzYWJsZV9sb2NrZWQoaW50ZWxfZHApOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+cHNyLmxvY2spOwotCWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5wc3Iud29yayk7Ci0J
Y2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZkZXZfcHJpdi0+cHNyLmRjM2NvX3dvcmspOworCW11
dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwljYW5jZWxfd29ya19zeW5jKCZpbnRl
bF9kcC0+cHNyLndvcmspOworCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaW50ZWxfZHAtPnBz
ci5kYzNjb193b3JrKTsKIH0KIAotc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2Zv
cmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwog
CWlmIChJU19USUdFUkxBS0UoZGV2X3ByaXYpKQogCQkvKgogCQkgKiBXcml0ZXMgdG8gQ1VSU1VS
RkxJVkUgaW4gVEdMIGFyZSBjYXVzaW5nIElPTU1VIGVycm9ycyBhbmQKQEAgLTExNTgsNyArMTE1
Niw3IEBAIHN0YXRpYyB2b2lkIHBzcl9mb3JjZV9od190cmFja2luZ19leGl0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICogU28gdXNpbmcgdGhpcyB3b3JrYXJvdW5kIHVu
dGlsIHRoaXMgaXNzdWUgaXMgcm9vdCBjYXVzZWQKIAkJICogYW5kIGEgYmV0dGVyIGZpeCBpcyBm
b3VuZC4KIAkJICovCi0JCWludGVsX3Bzcl9leGl0KGRldl9wcml2KTsKKwkJaW50ZWxfcHNyX2V4
aXQoaW50ZWxfZHApOwogCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKIAkJLyoK
IAkJICogRGlzcGxheSBXQSAjMDg4NDogc2tsKwpAQCAtMTE2OSwxMyArMTE2NywxMyBAQCBzdGF0
aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJCSAqIGJ1dCBpdCBtYWtlcyBtb3JlIHNlbnNlIHdyaXRlIHRvIHRoZSBj
dXJyZW50IGFjdGl2ZQogCQkgKiBwaXBlLgogCQkgKi8KLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIENVUlNVUkZMSVZFKGRldl9wcml2LT5wc3IucGlwZSksIDApOworCQlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwgQ1VSU1VSRkxJVkUoaW50ZWxfZHAtPnBzci5waXBlKSwgMCk7CiAJZWxzZQog
CQkvKgogCQkgKiBBIHdyaXRlIHRvIENVUlNVUkZMSVZFIGRvIG5vdCBjYXVzZSBIVyB0cmFja2lu
ZyB0byBleGl0IFBTUgogCQkgKiBvbiBvbGRlciBnZW5zIHNvIGRvaW5nIHRoZSBtYW51YWwgZXhp
dCBpbnN0ZWFkLgogCQkgKi8KLQkJaW50ZWxfcHNyX2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9w
c3JfZXhpdChpbnRlbF9kcCk7CiB9CiAKIHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3Nl
bF9mZXRjaChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLApAQCAtMTIxNSwxMSArMTIxMywxMSBA
QCB2b2lkIGludGVsX3BzcjJfcHJvZ3JhbV9wbGFuZV9zZWxfZmV0Y2goc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKIAlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU0VMX0ZFVENI
X1NJWkUocGlwZSwgcGxhbmUtPmlkKSwgdmFsKTsKIH0KIAotdm9pZCBpbnRlbF9wc3IyX3Byb2dy
YW1fdHJhbnNfbWFuX3Rya19jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCit2b2lkIGludGVsX3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLAorCQkJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0g
JmRldl9wcml2LT5wc3I7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBf
dG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5w
c3I7CiAKIAlpZiAoIUhBU19QU1IyX1NFTF9GRVRDSChkZXZfcHJpdikgfHwKIAkgICAgIWNydGNf
c3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9mZXRjaCkKQEAgLTEzMzYsMTMgKzEzMzQsMTMgQEAgdm9p
ZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCSAgICAgIGNv
bnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVj
dCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGludGVsX3BzciAqcHNy
ID0gJmludGVsX2RwLT5wc3I7CiAJYm9vbCBlbmFibGUsIHBzcjJfZW5hYmxlOwogCi0JaWYgKCFD
QU5fUFNSKGRldl9wcml2KSB8fCBSRUFEX09OQ0UocHNyLT5kcCkgIT0gaW50ZWxfZHApCisJaWYg
KCFDQU5fUFNSKGludGVsX2RwKSkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYt
PnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJZW5hYmxl
ID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjsKIAlwc3IyX2VuYWJsZSA9IGNydGNfc3RhdGUtPmhhc19w
c3IyOwpAQCAtMTM1MCwxNSArMTM0OCwxNSBAQCB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAoZW5hYmxlID09IHBzci0+ZW5hYmxlZCAmJiBwc3Iy
X2VuYWJsZSA9PSBwc3ItPnBzcjJfZW5hYmxlZCkgewogCQkvKiBGb3JjZSBhIFBTUiBleGl0IHdo
ZW4gZW5hYmxpbmcgQ1JDIHRvIGF2b2lkIENSQyB0aW1lb3V0cyAqLwogCQlpZiAoY3J0Y19zdGF0
ZS0+Y3JjX2VuYWJsZWQgJiYgcHNyLT5lbmFibGVkKQotCQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5n
X2V4aXQoZGV2X3ByaXYpOworCQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoaW50ZWxfZHAp
OwogCQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSAmJiBwc3ItPmVuYWJsZWQpIHsK
IAkJCS8qCiAJCQkgKiBBY3RpdmF0ZSBQU1IgYWdhaW4gYWZ0ZXIgYSBmb3JjZSBleGl0IHdoZW4g
ZW5hYmxpbmcKIAkJCSAqIENSQyBpbiBvbGRlciBnZW5zCiAJCQkgKi8KLQkJCWlmICghZGV2X3By
aXYtPnBzci5hY3RpdmUgJiYKLQkJCSAgICAhZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVy
X2JpdHMpCi0JCQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPnBzci53b3JrKTsKKwkJCWlmICgh
aW50ZWxfZHAtPnBzci5hY3RpdmUgJiYKKwkJCSAgICAhaW50ZWxfZHAtPnBzci5idXN5X2Zyb250
YnVmZmVyX2JpdHMpCisJCQkJc2NoZWR1bGVfd29yaygmaW50ZWxfZHAtPnBzci53b3JrKTsKIAkJ
fQogCiAJCWdvdG8gdW5sb2NrOwpAQCAtMTM2OCwzNCArMTM2NiwyMyBAQCB2b2lkIGludGVsX3Bz
cl91cGRhdGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJaW50ZWxfcHNyX2Rpc2FibGVf
bG9ja2VkKGludGVsX2RwKTsKIAogCWlmIChlbmFibGUpCi0JCWludGVsX3Bzcl9lbmFibGVfbG9j
a2VkKGRldl9wcml2LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKKwkJaW50ZWxfcHNyX2VuYWJs
ZV9sb2NrZWQoaW50ZWxfZHAsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOwogCiB1bmxvY2s6Ci0J
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50ZWxf
ZHAtPnBzci5sb2NrKTsKIH0KIAogLyoqCi0gKiBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZSAtIHdh
aXQgZm9yIFBTUjEgdG8gaWRsZQotICogQG5ld19jcnRjX3N0YXRlOiBuZXcgQ1JUQyBzdGF0ZQor
ICogcHNyX3dhaXRfZm9yX2lkbGUgLSB3YWl0IGZvciBQU1IxIHRvIGlkbGUKKyAqIEBpbnRlbF9k
cDogSW50ZWwgRFAKICAqIEBvdXRfdmFsdWU6IFBTUiBzdGF0dXMgaW4gY2FzZSBvZiBmYWlsdXJl
CiAgKgotICogVGhpcyBmdW5jdGlvbiBpcyBleHBlY3RlZCB0byBiZSBjYWxsZWQgZnJvbSBwaXBl
X3VwZGF0ZV9zdGFydCgpIHdoZXJlIGl0IGlzCi0gKiBub3QgZXhwZWN0ZWQgdG8gcmFjZSB3aXRo
IFBTUiBlbmFibGUgb3IgZGlzYWJsZS4KLSAqCiAgKiBSZXR1cm5zOiAwIG9uIHN1Y2Nlc3Mgb3Ig
LUVUSU1FT1VUIGlmIFBTUiBzdGF0dXMgZG9lcyBub3QgaWRsZS4KKyAqCiAgKi8KLWludCBpbnRl
bF9wc3Jfd2FpdF9mb3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGUsCi0JCQkgICAgdTMyICpvdXRfdmFsdWUpCitzdGF0aWMgaW50IHBzcl93YWl0X2Zv
cl9pZGxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiAqb3V0X3ZhbHVlKQogewotCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKLQotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkIHx8ICFuZXdfY3J0
Y19zdGF0ZS0+aGFzX3BzcikKLQkJcmV0dXJuIDA7Ci0KLQkvKiBGSVhNRTogVXBkYXRlIHRoaXMg
Zm9yIFBTUjIgaWYgd2UgbmVlZCB0byB3YWl0IGZvciBpZGxlICovCi0JaWYgKFJFQURfT05DRShk
ZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkpCi0JCXJldHVybiAwOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJLyoKIAkgKiBG
cm9tIGJzcGVjOiBQYW5lbCBTZWxmIFJlZnJlc2ggKEJEVyspCkBAIC0xNDAzLDMyICsxMzkwLDY0
IEBAIGludCBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqbmV3X2NydGNfc3RhdGUsCiAJICogZXhpdCB0cmFpbmluZyB0aW1lICsgMS41IG1zIG9m
IGF1eCBjaGFubmVsIGhhbmRzaGFrZS4gNTAgbXMgaXMKIAkgKiBkZWZlbnNpdmUgZW5vdWdoIHRv
IGNvdmVyIGV2ZXJ5dGhpbmcuCiAJICovCi0KIAlyZXR1cm4gX19pbnRlbF93YWl0X2Zvcl9yZWdp
c3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkJIEVEUF9QU1JfU1RBVFVTKGRldl9wcml2LT5w
c3IudHJhbnNjb2RlciksCisJCQkJCSBFRFBfUFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5z
Y29kZXIpLAogCQkJCQkgRURQX1BTUl9TVEFUVVNfU1RBVEVfTUFTSywKIAkJCQkJIEVEUF9QU1Jf
U1RBVFVTX1NUQVRFX0lETEUsIDIsIDUwLAogCQkJCQkgb3V0X3ZhbHVlKTsKIH0KIAotc3RhdGlj
IGJvb2wgX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQorLyoqCisgKiBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZSAtIHdhaXQgZm9yIFBT
UjEgdG8gaWRsZQorICogQG5ld19jcnRjX3N0YXRlOiBuZXcgQ1JUQyBzdGF0ZQorICoKKyAqIFRo
aXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQgdG8gYmUgY2FsbGVkIGZyb20gcGlwZV91cGRhdGVfc3Rh
cnQoKSB3aGVyZSBpdCBpcworICogbm90IGV4cGVjdGVkIHRvIHJhY2Ugd2l0aCBQU1IgZW5hYmxl
IG9yIGRpc2FibGUuCisgKi8KK3ZvaWQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yy0+
ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKwl1MzIgcHNyX3N0YXR1czsK
KworCWlmICghbmV3X2NydGNfc3RhdGUtPmhhc19wc3IpCisJCXJldHVybjsKKworCWZvcl9lYWNo
X2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCXN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisKKwkJaWYgKGVuY29kZXItPnR5
cGUgIT0gSU5URUxfT1VUUFVUX0VEUCkKKwkJCWNvbnRpbnVlOworCisJCS8qIHdoZW4gdGhlIFBT
UjEgaXMgZW5hYmxlZCAqLworCQlpZiAoaW50ZWxfZHAtPnBzci5lbmFibGVkICYmICFpbnRlbF9k
cC0+cHNyLnBzcjJfZW5hYmxlZCkgeworCQkJaWYgKHBzcl93YWl0X2Zvcl9pZGxlKGludGVsX2Rw
LCAmcHNyX3N0YXR1cykpCisJCQkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKKwkJCQkJIlBTUiBp
ZGxlIHRpbWVkIG91dCAweCV4LCBhdG9taWMgdXBkYXRlIG1heSBmYWlsXG4iLAorCQkJCQlwc3Jf
c3RhdHVzKTsKKwkJfQorCX0KK30KKworc3RhdGljIGJvb2wgX19wc3Jfd2FpdF9mb3JfaWRsZV9s
b2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlpOTE1X3JlZ190IHJlZzsKIAl1
MzIgbWFzazsKIAlpbnQgZXJyOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCisJ
aWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJsZWQpCiAJCXJldHVybiBmYWxzZTsKIAotCWlmIChkZXZf
cHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkgewotCQlyZWcgPSBFRFBfUFNSMl9TVEFUVVMoZGV2X3By
aXYtPnBzci50cmFuc2NvZGVyKTsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsK
KwkJcmVnID0gRURQX1BTUjJfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCW1h
c2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9IGVsc2UgewotCQlyZWcgPSBFRFBf
UFNSX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlyZWcgPSBFRFBfUFNSX1NU
QVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCQltYXNrID0gRURQX1BTUl9TVEFUVVNf
U1RBVEVfTUFTSzsKIAl9CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJ
bXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJZXJyID0gaW50ZWxfZGVfd2Fp
dF9mb3JfY2xlYXIoZGV2X3ByaXYsIHJlZywgbWFzaywgNTApOwogCWlmIChlcnIpCkBAIC0xNDM2
LDggKzE0NTUsOCBAQCBzdGF0aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCQkiVGltZWQgb3V0IHdhaXRpbmcgZm9y
IFBTUiBJZGxlIGZvciByZS1lbmFibGVcbiIpOwogCiAJLyogQWZ0ZXIgdGhlIHVubG9ja2VkIHdh
aXQsIHZlcmlmeSB0aGF0IFBTUiBpcyBzdGlsbCB3YW50ZWQhICovCi0JbXV0ZXhfbG9jaygmZGV2
X3ByaXYtPnBzci5sb2NrKTsKLQlyZXR1cm4gZXJyID09IDAgJiYgZGV2X3ByaXYtPnBzci5lbmFi
bGVkOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJcmV0dXJuIGVyciA9PSAw
ICYmIGludGVsX2RwLT5wc3IuZW5hYmxlZDsKIH0KIAogc3RhdGljIGludCBpbnRlbF9wc3JfZmFz
dHNldF9mb3JjZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xNTAzLDEx
ICsxNTIyLDEyIEBAIHN0YXRpYyBpbnQgaW50ZWxfcHNyX2Zhc3RzZXRfZm9yY2Uoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBlcnI7CiB9CiAKLWludCBpbnRlbF9w
c3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHZhbCkK
K2ludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHU2NCB2
YWwpCiB7CiAJY29uc3QgdTMyIG1vZGUgPSB2YWwgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0s7
CiAJdTMyIG9sZF9tb2RlOwogCWludCByZXQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKIAlpZiAodmFsICYgfihJOTE1X1BTUl9E
RUJVR19JUlEgfCBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHx8CiAJICAgIG1vZGUgPiBJOTE1
X1BTUl9ERUJVR19GT1JDRV9QU1IxKSB7CkBAIC0xNTE1LDIxICsxNTM1LDIxIEBAIGludCBpbnRl
bF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHZh
bCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZSgmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0Jb2xk
X21vZGUgPSBkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLOwot
CWRldl9wcml2LT5wc3IuZGVidWcgPSB2YWw7CisJb2xkX21vZGUgPSBpbnRlbF9kcC0+cHNyLmRl
YnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLOworCWludGVsX2RwLT5wc3IuZGVidWcgPSB2
YWw7CiAKIAkvKgogCSAqIERvIGl0IHJpZ2h0IGF3YXkgaWYgaXQncyBhbHJlYWR5IGVuYWJsZWQs
IG90aGVyd2lzZSBpdCB3aWxsIGJlIGRvbmUKIAkgKiB3aGVuIGVuYWJsaW5nIHRoZSBzb3VyY2Uu
CiAJICovCi0JaWYgKGRldl9wcml2LT5wc3IuZW5hYmxlZCkKLQkJcHNyX2lycV9jb250cm9sKGRl
dl9wcml2KTsKKwlpZiAoaW50ZWxfZHAtPnBzci5lbmFibGVkKQorCQlwc3JfaXJxX2NvbnRyb2wo
aW50ZWxfZHApOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4
X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCWlmIChvbGRfbW9kZSAhPSBtb2RlKQog
CQlyZXQgPSBpbnRlbF9wc3JfZmFzdHNldF9mb3JjZShkZXZfcHJpdik7CkBAIC0xNTM3LDI4ICsx
NTU3LDI4IEBAIGludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgdTY0IHZhbCkKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9pZCBpbnRl
bF9wc3JfaGFuZGxlX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0
aWMgdm9pZCBpbnRlbF9wc3JfaGFuZGxlX2lycShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQog
ewotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGludGVs
X3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAKLQlpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQo
cHNyLT5kcCk7CisJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAlwc3ItPnNp
bmtfbm90X3JlbGlhYmxlID0gdHJ1ZTsKIAkvKiBsZXQncyBtYWtlIHN1cmUgdGhhdCBzaW5rIGlz
IGF3YWtlbiAqLwotCWRybV9kcF9kcGNkX3dyaXRlYigmcHNyLT5kcC0+YXV4LCBEUF9TRVRfUE9X
RVIsIERQX1NFVF9QT1dFUl9EMCk7CisJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4
LCBEUF9TRVRfUE9XRVIsIERQX1NFVF9QT1dFUl9EMCk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVs
X3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpkZXZfcHJp
diksIHBzci53b3JrKTsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KKwkJY29udGFpbmVy
X29mKHdvcmssIHR5cGVvZigqaW50ZWxfZHApLCBwc3Iud29yayk7CiAKLQltdXRleF9sb2NrKCZk
ZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAK
LQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxl
ZCkKIAkJZ290byB1bmxvY2s7CiAKLQlpZiAoUkVBRF9PTkNFKGRldl9wcml2LT5wc3IuaXJxX2F1
eF9lcnJvcikpCi0JCWludGVsX3Bzcl9oYW5kbGVfaXJxKGRldl9wcml2KTsKKwlpZiAoUkVBRF9P
TkNFKGludGVsX2RwLT5wc3IuaXJxX2F1eF9lcnJvcikpCisJCWludGVsX3Bzcl9oYW5kbGVfaXJx
KGludGVsX2RwKTsKIAogCS8qCiAJICogV2UgaGF2ZSB0byBtYWtlIHN1cmUgUFNSIGlzIHJlYWR5
IGZvciByZS1lbmFibGUKQEAgLTE1NjYsNyArMTU4Niw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bz
cl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiBQU1IgbWlnaHQgdGFrZSBzb21l
IHRpbWUgdG8gZ2V0IGZ1bGx5IGRpc2FibGVkCiAJICogYW5kIGJlIHJlYWR5IGZvciByZS1lbmFi
bGUuCiAJICovCi0JaWYgKCFfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChkZXZfcHJpdikpCisJ
aWYgKCFfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChpbnRlbF9kcCkpCiAJCWdvdG8gdW5sb2Nr
OwogCiAJLyoKQEAgLTE1NzQsMTIgKzE1OTQsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX3dv
cmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCSAqIHJlY2hlY2suIFNpbmNlIHBzcl9mbHVz
aCBmaXJzdCBjbGVhcnMgdGhpcyBhbmQgdGhlbiByZXNjaGVkdWxlcyB3ZQogCSAqIHdvbid0IGV2
ZXIgbWlzcyBhIGZsdXNoIHdoZW4gYmFpbGluZyBvdXQgaGVyZS4KIAkgKi8KLQlpZiAoZGV2X3By
aXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfHwgZGV2X3ByaXYtPnBzci5hY3RpdmUpCisJ
aWYgKGludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHx8IGludGVsX2RwLT5wc3Iu
YWN0aXZlKQogCQlnb3RvIHVubG9jazsKIAotCWludGVsX3Bzcl9hY3RpdmF0ZShkZXZfcHJpdi0+
cHNyLmRwKTsKKwlpbnRlbF9wc3JfYWN0aXZhdGUoaW50ZWxfZHApOwogdW5sb2NrOgotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5w
c3IubG9jayk7CiB9CiAKIC8qKgpAQCAtMTU5OCwyNyArMTYxOCwzNSBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB2b2lkIGludGVsX3Bzcl9p
bnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgdW5zaWdu
ZWQgZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewotCWlmICgh
Q0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVybjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlcjsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwogCi0JaWYgKG9yaWdpbiA9PSBPUklH
SU5fRkxJUCkKLQkJcmV0dXJuOworCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBl
bmNvZGVyKSB7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWlmICghZGV2
X3ByaXYtPnBzci5lbmFibGVkKSB7Ci0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2Nr
KTsKLQkJcmV0dXJuOwotCX0KKwkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7
CisJCWlmIChlbmNvZGVyLT50eXBlICE9IElOVEVMX09VVFBVVF9FRFApCisJCQljb250aW51ZTsK
KwkJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKKwkJCWNvbnRpbnVlOwogCi0JZnJvbnRidWZmZXJf
Yml0cyAmPSBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJpdi0+cHNyLnBpcGUpOwot
CWRldl9wcml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHw9IGZyb250YnVmZmVyX2JpdHM7
CisJCWlmIChvcmlnaW4gPT0gT1JJR0lOX0ZMSVApCisJCQljb250aW51ZTsKKworCQltdXRleF9s
b2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkg
eworCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQkJY29udGludWU7CisJ
CX0KIAotCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7
CisJCWZyb250YnVmZmVyX2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxf
ZHAtPnBzci5waXBlKTsKKwkJaW50ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfD0g
ZnJvbnRidWZmZXJfYml0czsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsK
LX0KKwkJaWYgKGZyb250YnVmZmVyX2JpdHMpCisJCQlpbnRlbF9wc3JfZXhpdChpbnRlbF9kcCk7
CiAKKwkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCX0KK30KIC8qCiAgKiBX
aGVuIHdlIHdpbGwgYmUgY29tcGxldGVseSByZWx5IG9uIFBTUjIgUy9XIHRyYWNraW5nIGluIGZ1
dHVyZSwKICAqIGludGVsX3Bzcl9mbHVzaCgpIHdpbGwgaW52YWxpZGF0ZSBhbmQgZmx1c2ggdGhl
IFBTUiBmb3IgT1JJR0lOX0ZMSVAKQEAgLTE2MjYsMTUgKzE2NTQsMTUgQEAgdm9pZCBpbnRlbF9w
c3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBhY2Nv
cmRpbmdseSBpbiBmdXR1cmUuCiAgKi8KIHN0YXRpYyB2b2lkCi10Z2xfZGMzY29fZmx1c2goc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQl1bnNpZ25lZCBpbnQgZnJvbnRidWZm
ZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQordGdsX2RjM2NvX2ZsdXNoKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzLAorCQll
bnVtIGZiX29wX29yaWdpbiBvcmlnaW4pCiB7Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5s
b2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCi0JaWYgKCFkZXZfcHJp
di0+cHNyLmRjM2NvX2VuYWJsZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmRjM2NvX2VuYWJsZWQp
CiAJCWdvdG8gdW5sb2NrOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCB8fCAh
ZGV2X3ByaXYtPnBzci5hY3RpdmUpCisJaWYgKCFpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCB8
fCAhaW50ZWxfZHAtPnBzci5hY3RpdmUpCiAJCWdvdG8gdW5sb2NrOwogCiAJLyoKQEAgLTE2NDIs
MTUgKzE2NzAsMTUgQEAgdGdsX2RjM2NvX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkgKiB3aGVuIGRlbGF5ZWQgd29yayBzY2hlZHVsZXMgdGhhdCBtZWFucyBkaXNw
bGF5IGhhcyBiZWVuIGlkbGUuCiAJICovCiAJaWYgKCEoZnJvbnRidWZmZXJfYml0cyAmCi0JICAg
IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGRldl9wcml2LT5wc3IucGlwZSkpKQorCSAgICBJ
TlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhpbnRlbF9kcC0+cHNyLnBpcGUpKSkKIAkJZ290byB1
bmxvY2s7CiAKLQl0Z2xfcHNyMl9lbmFibGVfZGMzY28oZGV2X3ByaXYpOwotCW1vZF9kZWxheWVk
X3dvcmsoc3lzdGVtX3dxLCAmZGV2X3ByaXYtPnBzci5kYzNjb193b3JrLAotCQkJIGRldl9wcml2
LT5wc3IuZGMzY29fZXhpdF9kZWxheSk7CisJdGdsX3BzcjJfZW5hYmxlX2RjM2NvKGludGVsX2Rw
KTsKKwltb2RfZGVsYXllZF93b3JrKHN5c3RlbV93cSwgJmludGVsX2RwLT5wc3IuZGMzY29fd29y
aywKKwkJCSBpbnRlbF9kcC0+cHNyLmRjM2NvX2V4aXRfZGVsYXkpOwogCiB1bmxvY2s6Ci0JbXV0
ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAt
PnBzci5sb2NrKTsKIH0KIAogLyoqCkBAIC0xNjY5LDQ1ICsxNjk3LDU0IEBAIHRnbF9kYzNjb19m
bHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB2b2lkIGludGVsX3Bzcl9m
bHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAgICAgdW5zaWduZWQg
ZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewotCWlmICghQ0FO
X1BTUihkZXZfcHJpdikpCi0JCXJldHVybjsKLQotCWlmIChvcmlnaW4gPT0gT1JJR0lOX0ZMSVAp
IHsKLQkJdGdsX2RjM2NvX2ZsdXNoKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4p
OwotCQlyZXR1cm47Ci0JfQotCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlp
ZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCkgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5w
c3IubG9jayk7Ci0JCXJldHVybjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKwlz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOworCisJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2
LT5kcm0sIGVuY29kZXIpIHsKKwkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7
CisKKwkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCAmJiBDQU5fUFNSKGlu
dGVsX2RwKSkgeworCQkJaWYgKG9yaWdpbiA9PSBPUklHSU5fRkxJUCkgeworCQkJCXRnbF9kYzNj
b19mbHVzaChpbnRlbF9kcCwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKKwkJCQljb250aW51
ZTsKKwkJCX0KKworCQkJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJCWlmICgh
aW50ZWxfZHAtPnBzci5lbmFibGVkKSB7CisJCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNy
LmxvY2spOworCQkJCWNvbnRpbnVlOworCQkJfQorCisJCQlmcm9udGJ1ZmZlcl9iaXRzICY9IElO
VEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGludGVsX2RwLT5wc3IucGlwZSk7CisJCQlpbnRlbF9k
cC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKKworCQkJ
LyogQnkgZGVmaW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUgKyBmbHVzaCAqLworCQkJaWYgKGZy
b250YnVmZmVyX2JpdHMpCisJCQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoaW50ZWxfZHAp
OworCisJCQlpZiAoIWludGVsX2RwLT5wc3IuYWN0aXZlICYmICFpbnRlbF9kcC0+cHNyLmJ1c3lf
ZnJvbnRidWZmZXJfYml0cykKKwkJCQlzY2hlZHVsZV93b3JrKCZpbnRlbF9kcC0+cHNyLndvcmsp
OworCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQl9CiAJfQotCi0JZnJv
bnRidWZmZXJfYml0cyAmPSBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJpdi0+cHNy
LnBpcGUpOwotCWRldl9wcml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzICY9IH5mcm9udGJ1
ZmZlcl9iaXRzOwotCi0JLyogQnkgZGVmaW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUgKyBmbHVz
aCAqLwotCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhp
dChkZXZfcHJpdik7Ci0KLQlpZiAoIWRldl9wcml2LT5wc3IuYWN0aXZlICYmICFkZXZfcHJpdi0+
cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cykKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPnBz
ci53b3JrKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CiB9CiAKIC8qKgog
ICogaW50ZWxfcHNyX2luaXQgLSBJbml0IGJhc2ljIFBTUiB3b3JrIGFuZCBtdXRleC4KLSAqIEBk
ZXZfcHJpdjogaTkxNSBkZXZpY2UgcHJpdmF0ZQorICogQGludGVsX2RwOiBJbnRlbCBEUAogICoK
LSAqIFRoaXMgZnVuY3Rpb24gaXMgIGNhbGxlZCBvbmx5IG9uY2UgYXQgZHJpdmVyIGxvYWQgdG8g
aW5pdGlhbGl6ZSBiYXNpYwotICogUFNSIHN0dWZmLgorICogVGhpcyBmdW5jdGlvbiBpcyBjYWxs
ZWQgYWZ0ZXIgdGhlIGluaXRpYWxpemluZyBjb25uZWN0b3IuCisgKiAodGhlIGluaXRpYWxpemlu
ZyBvZiBjb25uZWN0b3IgdHJlYXRzIHRoZSBoYW5kbGluZyBvZiBjb25uZWN0b3IgY2FwYWJpbGl0
aWVzKQorICogQW5kIGl0IGluaXRpYWxpemVzIGJhc2ljIFBTUiBzdHVmZiBmb3IgZWFjaCBEUCBF
bmNvZGVyLgogICovCi12b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfcHNyX2luaXQoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKKwogCWlmICghSEFTX1BTUihkZXZfcHJpdikpCiAJCXJldHVybjsKIAotCWlmICgh
ZGV2X3ByaXYtPnBzci5zaW5rX3N1cHBvcnQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLnNpbmtfc3Vw
cG9ydCkKIAkJcmV0dXJuOwogCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQpAQCAtMTcyNSwx
NCArMTc2MiwxNCBAQCB2b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAkvKiBTZXQgbGlua19zdGFuZGJ5IHggbGlua19vZmYgZGVmYXVsdHMgKi8K
IAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKIAkJ
LyogSFNXIGFuZCBCRFcgcmVxdWlyZSB3b3JrYXJvdW5kcyB0aGF0IHdlIGRvbid0IGltcGxlbWVu
dC4gKi8KLQkJZGV2X3ByaXYtPnBzci5saW5rX3N0YW5kYnkgPSBmYWxzZTsKKwkJaW50ZWxfZHAt
PnBzci5saW5rX3N0YW5kYnkgPSBmYWxzZTsKIAllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
IDwgMTIpCiAJCS8qIEZvciBuZXcgcGxhdGZvcm1zIHVwIHRvIFRHTCBsZXQncyByZXNwZWN0IFZC
VCBiYWNrIGFnYWluICovCi0JCWRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5ID0gZGV2X3ByaXYt
PnZidC5wc3IuZnVsbF9saW5rOworCQlpbnRlbF9kcC0+cHNyLmxpbmtfc3RhbmRieSA9IGRldl9w
cml2LT52YnQucHNyLmZ1bGxfbGluazsKIAotCUlOSVRfV09SSygmZGV2X3ByaXYtPnBzci53b3Jr
LCBpbnRlbF9wc3Jfd29yayk7Ci0JSU5JVF9ERUxBWUVEX1dPUksoJmRldl9wcml2LT5wc3IuZGMz
Y29fd29yaywgdGdsX2RjM2NvX2Rpc2FibGVfd29yayk7Ci0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYt
PnBzci5sb2NrKTsKKwlJTklUX1dPUksoJmludGVsX2RwLT5wc3Iud29yaywgaW50ZWxfcHNyX3dv
cmspOworCUlOSVRfREVMQVlFRF9XT1JLKCZpbnRlbF9kcC0+cHNyLmRjM2NvX3dvcmssIHRnbF9k
YzNjb19kaXNhYmxlX3dvcmspOworCW11dGV4X2luaXQoJmludGVsX2RwLT5wc3IubG9jayk7CiB9
CiAKIHN0YXRpYyBpbnQgcHNyX2dldF9zdGF0dXNfYW5kX2Vycm9yX3N0YXR1cyhzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLApAQCAtMTc1OCw3ICsxNzk1LDcgQEAgc3RhdGljIHZvaWQgcHNyX2Fs
cG1fY2hlY2soc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1Y3QgZHJtX2Rw
X2F1eCAqYXV4ID0gJmludGVsX2RwLT5hdXg7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2
X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAl1
OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE3ODUsNyArMTgyMiw3IEBAIHN0YXRpYyB2b2lkIHBzcl9h
bHBtX2NoZWNrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiBzdGF0aWMgdm9pZCBwc3JfY2Fw
YWJpbGl0eV9jaGFuZ2VkX2NoZWNrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0J
c3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNy
ICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAl1OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE4MDksMTgg
KzE4NDYsMTggQEAgc3RhdGljIHZvaWQgcHNyX2NhcGFiaWxpdHlfY2hhbmdlZF9jaGVjayhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogdm9pZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZf
cHJpdi0+cHNyOworCXN0cnVjdCBpbnRlbF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCXU4
IHN0YXR1cywgZXJyb3Jfc3RhdHVzOwogCWNvbnN0IHU4IGVycm9ycyA9IERQX1BTUl9SRkJfU1RP
UkFHRV9FUlJPUiB8CiAJCQkgIERQX1BTUl9WU0NfU0RQX1VOQ09SUkVDVEFCTEVfRVJST1IgfAog
CQkJICBEUF9QU1JfTElOS19DUkNfRVJST1I7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpIHx8
ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkgfHwg
IWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCiAJCXJldHVybjsKIAogCW11dGV4X2xvY2soJnBz
ci0+bG9jayk7CiAKLQlpZiAoIXBzci0+ZW5hYmxlZCB8fCBwc3ItPmRwICE9IGludGVsX2RwKQor
CWlmICghcHNyLT5lbmFibGVkKQogCQlnb3RvIGV4aXQ7CiAKIAlpZiAocHNyX2dldF9zdGF0dXNf
YW5kX2Vycm9yX3N0YXR1cyhpbnRlbF9kcCwgJnN0YXR1cywgJmVycm9yX3N0YXR1cykpIHsKQEAg
LTE4NjMsMTUgKzE5MDAsMTQgQEAgdm9pZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIAogYm9vbCBpbnRlbF9wc3JfZW5hYmxlZChzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOwogCWJvb2wgcmV0OwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2
KSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHAp
IHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKQogCQlyZXR1cm4gZmFsc2U7CiAKLQltdXRl
eF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCXJldCA9IChkZXZfcHJpdi0+cHNyLmRwID09
IGludGVsX2RwICYmIGRldl9wcml2LT5wc3IuZW5hYmxlZCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJcmV0
ID0gaW50ZWxfZHAtPnBzci5lbmFibGVkOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5s
b2NrKTsKIAogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Bzci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9wc3IuaAppbmRleCAwYTUxNzk3OGU4YWYuLjAzZWIxOTU0N2QwOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oCkBAIC0xOCw3ICsxOCw3IEBAIHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxf
cGxhbmU7CiAKLSNkZWZpbmUgQ0FOX1BTUihkZXZfcHJpdikgKEhBU19QU1IoZGV2X3ByaXYpICYm
IGRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0KQorI2RlZmluZSBDQU5fUFNSKGludGVsX2RwKSAo
SEFTX1BTUihkcF90b19pOTE1KGludGVsX2RwKSkgJiYgaW50ZWxfZHAtPnBzci5zaW5rX3N1cHBv
cnQpCiB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7
CiB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAg
ICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC0yOCwyNCAr
MjgsMjQgQEAgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
LAogdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCSAg
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkgICAgICBj
b25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7Ci1pbnQgaW50ZWxf
cHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2NCB2YWx1
ZSk7CitpbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1
NjQgdmFsdWUpOwogdm9pZCBpbnRlbF9wc3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMsCiAJCQkgIGVu
dW0gZmJfb3Bfb3JpZ2luIG9yaWdpbik7CiB2b2lkIGludGVsX3Bzcl9mbHVzaChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0
cywKIAkJICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pOwotdm9pZCBpbnRlbF9wc3JfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9wc3JfaW5p
dChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29u
ZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Ci12b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKTsKK3ZvaWQgaW50ZWxfcHNy
X2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiBwc3JfaWlyKTsKIHZv
aWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwotaW50
IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpu
ZXdfY3J0Y19zdGF0ZSwKLQkJCSAgICB1MzIgKm91dF92YWx1ZSk7Cit2b2lkIGludGVsX3Bzcl93
YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0
ZSk7CiBib29sIGludGVsX3Bzcl9lbmFibGVkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwog
aW50IGludGVsX3BzcjJfc2VsX2ZldGNoX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSwKIAkJCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7Ci12b2lkIGludGVsX3BzcjJf
cHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSk7Cit2b2lkIGludGVsX3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKTsKIHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3NlbF9m
ZXRjaChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkJCQljb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfc3ByaXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nw
cml0ZS5jCmluZGV4IGNmMzU4OWZkMGRkYi4uNTlmNGM3NzRmOThlIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTg1LDcgKzg1LDYgQEAgdm9pZCBp
bnRlbF9waXBlX3VwZGF0ZV9zdGFydChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2NydGNfc3RhdGUpCiAJYm9vbCBuZWVkX3Zsdl9kc2lfd2EgPSAoSVNfVkFMTEVZVklFVyhkZXZf
cHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpICYmCiAJCWludGVsX2NydGNfaGFzX3R5
cGUobmV3X2NydGNfc3RhdGUsIElOVEVMX09VVFBVVF9EU0kpOwogCURFRklORV9XQUlUKHdhaXQp
OwotCXUzMiBwc3Jfc3RhdHVzOwogCiAJaWYgKG5ld19jcnRjX3N0YXRlLT51YXBpLmFzeW5jX2Zs
aXApCiAJCXJldHVybjsKQEAgLTExMCwxMCArMTA5LDcgQEAgdm9pZCBpbnRlbF9waXBlX3VwZGF0
ZV9zdGFydChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJ
ICogVkJMIGludGVycnVwdHMgd2lsbCBzdGFydCB0aGUgUFNSIGV4aXQgYW5kIHByZXZlbnQgYSBQ
U1IKIAkgKiByZS1lbnRyeSBhcyB3ZWxsLgogCSAqLwotCWlmIChpbnRlbF9wc3Jfd2FpdF9mb3Jf
aWRsZShuZXdfY3J0Y19zdGF0ZSwgJnBzcl9zdGF0dXMpKQotCQlkcm1fZXJyKCZkZXZfcHJpdi0+
ZHJtLAotCQkJIlBTUiBpZGxlIHRpbWVkIG91dCAweCV4LCBhdG9taWMgdXBkYXRlIG1heSBmYWls
XG4iLAotCQkJcHNyX3N0YXR1cyk7CisJaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUobmV3X2NydGNf
c3RhdGUpOwogCiAJbG9jYWxfaXJxX2Rpc2FibGUoKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgK
aW5kZXggNWU1YmNlZjIwZTMzLi4yMTE1ODBlZjMwMjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aApAQCAtNDc1LDQyICs0NzUsNiBAQCBzdHJ1Y3QgaTkxNV9kcnJzIHsKIAllbnVtIGRycnNfc3Vw
cG9ydF90eXBlIHR5cGU7CiB9OwogCi1zdHJ1Y3QgaTkxNV9wc3IgewotCXN0cnVjdCBtdXRleCBs
b2NrOwotCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSwkweDBmCi0jZGVmaW5lIEk5
MTVfUFNSX0RFQlVHX0RFRkFVTFQJCTB4MDAKLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRElTQUJM
RQkJMHgwMQotI2RlZmluZSBJOTE1X1BTUl9ERUJVR19FTkFCTEUJCTB4MDIKLSNkZWZpbmUgSTkx
NV9QU1JfREVCVUdfRk9SQ0VfUFNSMQkweDAzCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0lSUQkJ
MHgxMAotCi0JdTMyIGRlYnVnOwotCWJvb2wgc2lua19zdXBwb3J0OwotCWJvb2wgZW5hYmxlZDsK
LQlzdHJ1Y3QgaW50ZWxfZHAgKmRwOwotCWVudW0gcGlwZSBwaXBlOwotCWVudW0gdHJhbnNjb2Rl
ciB0cmFuc2NvZGVyOwotCWJvb2wgYWN0aXZlOwotCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOwot
CXVuc2lnbmVkIGJ1c3lfZnJvbnRidWZmZXJfYml0czsKLQlib29sIHNpbmtfcHNyMl9zdXBwb3J0
OwotCWJvb2wgbGlua19zdGFuZGJ5OwotCWJvb2wgY29sb3JpbWV0cnlfc3VwcG9ydDsKLQlib29s
IHBzcjJfZW5hYmxlZDsKLQlib29sIHBzcjJfc2VsX2ZldGNoX2VuYWJsZWQ7Ci0JdTggc2lua19z
eW5jX2xhdGVuY3k7Ci0Ja3RpbWVfdCBsYXN0X2VudHJ5X2F0dGVtcHQ7Ci0Ja3RpbWVfdCBsYXN0
X2V4aXQ7Ci0JYm9vbCBzaW5rX25vdF9yZWxpYWJsZTsKLQlib29sIGlycV9hdXhfZXJyb3I7Ci0J
dTE2IHN1X3hfZ3JhbnVsYXJpdHk7Ci0JYm9vbCBkYzNjb19lbmFibGVkOwotCXUzMiBkYzNjb19l
eGl0X2RlbGF5OwotCXN0cnVjdCBkZWxheWVkX3dvcmsgZGMzY29fd29yazsKLQlzdHJ1Y3QgZHJt
X2RwX3ZzY19zZHAgdnNjOwotfTsKLQogI2RlZmluZSBRVUlSS19MVkRTX1NTQ19ESVNBQkxFICgx
PDwxKQogI2RlZmluZSBRVUlSS19JTlZFUlRfQlJJR0hUTkVTUyAoMTw8MikKICNkZWZpbmUgUVVJ
UktfQkFDS0xJR0hUX1BSRVNFTlQgKDE8PDMpCkBAIC0xMDM4LDggKzEwMDIsNiBAQCBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSB7CiAKIAlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zIHBvd2VyX2Rv
bWFpbnM7CiAKLQlzdHJ1Y3QgaTkxNV9wc3IgcHNyOwotCiAJc3RydWN0IGk5MTVfZ3B1X2Vycm9y
IGdwdV9lcnJvcjsKIAogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICp2bHZfcGN0eDsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2lycS5jCmluZGV4IGRkMTk3MTA0MGJiYy4uYTAxZmNiMDQ3NGE2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfaXJxLmMKQEAgLTIwNjYsMTAgKzIwNjYsMjIgQEAgc3RhdGljIHZvaWQg
aXZiX2Rpc3BsYXlfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQlpdmJfZXJyX2ludF9oYW5kbGVyKGRldl9wcml2KTsKIAogCWlmIChkZV9paXIgJiBERV9F
RFBfUFNSX0lOVF9IU1cpIHsKLQkJdTMyIHBzcl9paXIgPSBpbnRlbF91bmNvcmVfcmVhZCgmZGV2
X3ByaXYtPnVuY29yZSwgRURQX1BTUl9JSVIpOworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlcjsKIAotCQlpbnRlbF9wc3JfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBzcl9paXIpOwotCQlp
bnRlbF91bmNvcmVfd3JpdGUoJmRldl9wcml2LT51bmNvcmUsIEVEUF9QU1JfSUlSLCBwc3JfaWly
KTsKKwkJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJCXN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisKKwkJ
CWlmIChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFAgJiYKKwkJCSAgICBDQU5fUFNS
KGludGVsX2RwKSkgeworCQkJCXUzMiBwc3JfaWlyID0gaW50ZWxfdW5jb3JlX3JlYWQoJmRldl9w
cml2LT51bmNvcmUsCisJCQkJCQkJCUVEUF9QU1JfSUlSKTsKKworCQkJCWludGVsX3Bzcl9pcnFf
aGFuZGxlcihpbnRlbF9kcCwgcHNyX2lpcik7CisJCQkJaW50ZWxfdW5jb3JlX3dyaXRlKCZkZXZf
cHJpdi0+dW5jb3JlLAorCQkJCQkJICAgRURQX1BTUl9JSVIsIHBzcl9paXIpOworCQkJCWJyZWFr
OworCQkJfQorCQl9CiAJfQogCiAJaWYgKGRlX2lpciAmIERFX0FVWF9DSEFOTkVMX0FfSVZCKQpA
QCAtMjI3OSwyMSArMjI5MSwzNCBAQCBnZW44X2RlX21pc2NfaXJxX2hhbmRsZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgaWlyKQogCX0KIAogCWlmIChpaXIgJiBHRU44
X0RFX0VEUF9QU1IpIHsKKwkJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAJCXUzMiBw
c3JfaWlyOwogCQlpOTE1X3JlZ190IGlpcl9yZWc7CiAKLQkJaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTIpCi0JCQlpaXJfcmVnID0gVFJBTlNfUFNSX0lJUihkZXZfcHJpdi0+cHNyLnRyYW5z
Y29kZXIpOwotCQllbHNlCi0JCQlpaXJfcmVnID0gRURQX1BTUl9JSVI7CisJCWZvcl9lYWNoX2lu
dGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCQlzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOwogCi0JCXBzcl9paXIgPSBpbnRlbF91
bmNvcmVfcmVhZCgmZGV2X3ByaXYtPnVuY29yZSwgaWlyX3JlZyk7Ci0JCWludGVsX3VuY29yZV93
cml0ZSgmZGV2X3ByaXYtPnVuY29yZSwgaWlyX3JlZywgcHNyX2lpcik7CisJCQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMiAmJiBDQU5fUFNSKGludGVsX2RwKSkgeworCQkJCWlpcl9yZWcg
PSBUUkFOU19QU1JfSUlSKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CisJCQl9IGVsc2UgaWYg
KGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCAmJgorCQkJCSAgIENBTl9QU1IoaW50
ZWxfZHApKSB7CisJCQkJaWlyX3JlZyA9IEVEUF9QU1JfSUlSOworCQkJfSBlbHNlIHsKKwkJCQlj
b250aW51ZTsKKwkJCX0KKworCQkJcHNyX2lpciA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJp
di0+dW5jb3JlLCBpaXJfcmVnKTsKKwkJCWludGVsX3VuY29yZV93cml0ZSgmZGV2X3ByaXYtPnVu
Y29yZSwgaWlyX3JlZywgcHNyX2lpcik7CisKKwkJCWlmIChwc3JfaWlyKQorCQkJCWZvdW5kID0g
dHJ1ZTsKIAotCQlpZiAocHNyX2lpcikKLQkJCWZvdW5kID0gdHJ1ZTsKKwkJCWludGVsX3Bzcl9p
cnFfaGFuZGxlcihpbnRlbF9kcCwgcHNyX2lpcik7CiAKLQkJaW50ZWxfcHNyX2lycV9oYW5kbGVy
KGRldl9wcml2LCBwc3JfaWlyKTsKKwkJCS8qIHByaW9yIEdFTjEyIG9ubHkgaGF2ZSBvbmUgRURQ
IFBTUiAqLworCQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMikKKwkJCQlicmVhazsKKwkJ
fQogCX0KIAogCWlmICghZm91bmQpCi0tIAoyLjI1LjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

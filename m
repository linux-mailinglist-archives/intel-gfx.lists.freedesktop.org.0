Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 567B6EF884
	for <lists+intel-gfx@lfdr.de>; Tue,  5 Nov 2019 10:21:43 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9396F6E94F;
	Tue,  5 Nov 2019 09:21:41 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CB1B56E94F
 for <intel-gfx@lists.freedesktop.org>; Tue,  5 Nov 2019 09:21:39 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19084818-1500050 
 for multiple; Tue, 05 Nov 2019 09:21:16 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  5 Nov 2019 09:21:07 +0000
Message-Id: <20191105092115.11451-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191105092115.11451-1-chris@chris-wilson.co.uk>
References: <20191105092115.11451-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 02/10] drm/i915/selftests: Perform some basic
 cycle counting of MI ops
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Anna Karas <anna.karas@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U29tZSBiYXNpYyBpbmZvcm1hdGlvbiB0aGF0IGlzIHVzZWZ1bCB0byBrbm93LCBzdWNoIGFzIGhv
dyBtYW55IGN5Y2xlcwppcyBhIE1JX05PT1AuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEFubmEgS2FyYXMgPGFubmEua2FyYXNAaW50
ZWwuY29tPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0t
CiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYyAgfCAgMTUgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jICB8IDMzOSArKysr
KysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgICAgICAgICAg
ICAgICB8ICAgNiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmggICAgICAg
ICAgfCAgIDQgKwogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgg
IHwgIDEzICsKIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyAgICB8
ICA0MyArKysKIDYgZmlsZXMgY2hhbmdlZCwgNDE3IGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25z
KC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcGVyZl9zZWxmdGVzdHMuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKaW5kZXggZTgxMzJhY2EwYmI2Li5h
M2RmNTFhYjQwYTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCkBAIC01MDcsOCArNTA3LDYgQEAgc3RhdGlj
IGludCBpZ3RfY29weV9ibHQodm9pZCAqYXJnKQogaW50IGk5MTVfZ2VtX29iamVjdF9ibHRfbGl2
ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RhdGljIGNv
bnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKLQkJU1VCVEVTVChwZXJmX2ZpbGxf
Ymx0KSwKLQkJU1VCVEVTVChwZXJmX2NvcHlfYmx0KSwKIAkJU1VCVEVTVChpZ3RfZmlsbF9ibHQp
LAogCQlTVUJURVNUKGlndF9jb3B5X2JsdCksCiAJfTsKQEAgLTUyMSwzICs1MTksMTYgQEAgaW50
IGk5MTVfZ2VtX29iamVjdF9ibHRfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiAKIAlyZXR1cm4gaTkxNV9saXZlX3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKIH0K
KworaW50IGk5MTVfZ2VtX29iamVjdF9ibHRfcGVyZl9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVz
dHNbXSA9IHsKKwkJU1VCVEVTVChwZXJmX2ZpbGxfYmx0KSwKKwkJU1VCVEVTVChwZXJmX2NvcHlf
Ymx0KSwKKwl9OworCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQorCQlyZXR1
cm4gMDsKKworCXJldHVybiBpOTE1X2xpdmVfc3VidGVzdHModGVzdHMsIGk5MTUpOworfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfY3MuYwppbmRleCAzODgwZjA3
YzI5YjguLmFhNmIxOTk3ZWRkYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfZW5naW5lX2NzLmMKQEAgLTQsNyArNCwzNDQgQEAKICAqIENvcHlyaWdodCDCqSAyMDE4IElu
dGVsIENvcnBvcmF0aW9uCiAgKi8KIAotI2luY2x1ZGUgIi4uL2k5MTVfc2VsZnRlc3QuaCIKKyNp
bmNsdWRlIDxsaW51eC9zb3J0Lmg+CisKKyNpbmNsdWRlICJpbnRlbF9ndF9wbS5oIgorI2luY2x1
ZGUgImludGVsX3Jwcy5oIgorCisjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgorI2luY2x1ZGUg
InNlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oIgorCisjZGVmaW5lIENPVU5UIDUKKworc3RhdGlj
IGludCBjbXBfdTMyKGNvbnN0IHZvaWQgKkEsIGNvbnN0IHZvaWQgKkIpCit7CisJY29uc3QgdTMy
ICphID0gQSwgKmIgPSBCOworCisJcmV0dXJuICphIC0gKmI7Cit9CisKK3N0YXRpYyB2b2lkIHBl
cmZfYmVnaW4oc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlpbnRlbF9ndF9wbV9nZXQoZ3QpOwor
CisJLyogQm9vc3QgZ3B1ZnJlcSB0byBtYXggW3dhaXRib29zdF0gYW5kIGtlZXAgaXQgZml4ZWQg
Ki8KKwlhdG9taWNfaW5jKCZndC0+cnBzLm51bV93YWl0ZXJzKTsKKwlzY2hlZHVsZV93b3JrKCZn
dC0+cnBzLndvcmspOworCWZsdXNoX3dvcmsoJmd0LT5ycHMud29yayk7Cit9CisKK3N0YXRpYyBp
bnQgcGVyZl9lbmQoc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlhdG9taWNfZGVjKCZndC0+cnBz
Lm51bV93YWl0ZXJzKTsKKwlpbnRlbF9ndF9wbV9wdXQoZ3QpOworCisJcmV0dXJuIGlndF9mbHVz
aF90ZXN0KGd0LT5pOTE1KTsKK30KKworc3RhdGljIGludCB3cml0ZV90aW1lc3RhbXAoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEsIGludCBzbG90KQoreworCXUzMiBjbWQ7CisJdTMyICpjczsKKwor
CWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCk7CisJaWYgKElTX0VSUihjcykpCisJCXJldHVy
biBQVFJfRVJSKGNzKTsKKworCWNtZCA9IE1JX1NUT1JFX1JFR0lTVEVSX01FTSB8IE1JX1VTRV9H
R1RUOworCWlmIChJTlRFTF9HRU4ocnEtPmk5MTUpID49IDgpCisJCWNtZCsrOworCSpjcysrID0g
Y21kOworCSpjcysrID0gcnEtPmVuZ2luZS0+bW1pb19iYXNlICsgMHgzNTg7CisJKmNzKysgPSBp
OTE1X3JlcXVlc3RfdGltZWxpbmUocnEpLT5od3NwX29mZnNldCArIHNsb3QgKiBzaXplb2YodTMy
KTsKKwkqY3MrKyA9IDA7CisKKwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXJldHVy
biAwOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfZW1wdHlfYmF0Y2goc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdTMyICpjczsKKwlpbnQgZXJyOworCisJb2Jq
ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChjZS0+ZW5naW5lLT5pOTE1LCBQQUdF
X1NJWkUpOworCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwlj
cyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19F
UlIoY3MpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9DQVNU
KGNzKTsKKwl9CisKKwljc1swXSA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7CisKKwlpOTE1X2dlbV9v
YmplY3RfZmx1c2hfbWFwKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOwor
CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBjZS0+dm0sIE5VTEwpOworCWlmIChJU19F
UlIodm1hKSkgeworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCXJldHVybiB2bWE7CisJ
fQorCisJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOworCWlmIChlcnIp
IHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX1BUUihlcnIpOwor
CX0KKworCXJldHVybiB2bWE7Cit9CisKK3N0YXRpYyB1MzIgdHJpZmlsdGVyKHUzMiAqYSkKK3sK
Kwl1NjQgc3VtOworCisJc29ydChhLCBDT1VOVCwgc2l6ZW9mKCphKSwgY21wX3UzMiwgTlVMTCk7
CisKKwlzdW0gKz0gbXVsX3UzMl91MzIoYVsyXSwgMik7CisJc3VtICs9IGFbMV07CisJc3VtICs9
IGFbM107CisKKwlyZXR1cm4gc3VtID4+IDI7Cit9CisKK3N0YXRpYyBpbnQgcGVyZl9taV9iYl9z
dGFydCh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50
IGVyciA9IDA7CisKKwlpZiAoSU5URUxfR0VOKGd0LT5pOTE1KSA8IDcpIC8qIGZvciBwZXItZW5n
aW5lIENTX1RJTUVTVEFNUCAqLworCQlyZXR1cm4gMDsKKworCXBlcmZfYmVnaW4oZ3QpOworCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UgPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0OworCQlzdHJ1Y3QgaTkxNV92bWEgKmJhdGNoOwor
CQl1MzIgY3ljbGVzW0NPVU5UXTsKKwkJaW50IGk7CisKKwkJYmF0Y2ggPSBjcmVhdGVfZW1wdHlf
YmF0Y2goY2UpOworCQlpZiAoSVNfRVJSKGJhdGNoKSkgeworCQkJZXJyID0gUFRSX0VSUihiYXRj
aCk7CisJCQlicmVhazsKKwkJfQorCisJCWVyciA9IGk5MTVfdm1hX3N5bmMoYmF0Y2gpOworCQlp
ZiAoZXJyKSB7CisJCQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCQkJYnJlYWs7CisJCX0KKworCQlm
b3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjeWNsZXMpOyBpKyspIHsKKwkJCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxOworCisJCQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2UpOworCQkJaWYg
KElTX0VSUihycSkpIHsKKwkJCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJCQlicmVhazsKKwkJCX0K
KworCQkJZXJyID0gd3JpdGVfdGltZXN0YW1wKHJxLCAyKTsKKwkJCWlmIChlcnIpCisJCQkJZ290
byBvdXQ7CisKKwkJCWVyciA9IHJxLT5lbmdpbmUtPmVtaXRfYmJfc3RhcnQocnEsCisJCQkJCQkJ
YmF0Y2gtPm5vZGUuc3RhcnQsIDgsCisJCQkJCQkJMCk7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8g
b3V0OworCisJCQllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDMpOworCQkJaWYgKGVycikKKwkJ
CQlnb3RvIG91dDsKKworb3V0OgorCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKKworCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUp
IDwgMCkKKwkJCQllcnIgPSAtRUlPOworCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJCQlpZiAo
ZXJyKQorCQkJCWJyZWFrOworCisJCQljeWNsZXNbaV0gPSBycS0+aHdzcF9zZXFub1szXSAtIHJx
LT5od3NwX3NlcW5vWzJdOworCQl9CisJCWk5MTVfdm1hX3B1dChiYXRjaCk7CisJCWlmIChlcnIp
CisJCQlicmVhazsKKworCQlwcl9pbmZvKCIlczogTUlfQkJfU1RBUlQgY3ljbGVzOiAldVxuIiwK
KwkJCWVuZ2luZS0+bmFtZSwgdHJpZmlsdGVyKGN5Y2xlcykpOworCX0KKwlpZiAocGVyZl9lbmQo
Z3QpKQorCQllcnIgPSAtRUlPOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIHN0cnVjdCBp
OTE1X3ZtYSAqY3JlYXRlX25vcF9iYXRjaChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsK
Kwl1MzIgKmNzOworCWludCBlcnI7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2lu
dGVybmFsKGNlLT5lbmdpbmUtPmk5MTUsIFNaXzY0Syk7CisJaWYgKElTX0VSUihvYmopKQorCQly
ZXR1cm4gRVJSX0NBU1Qob2JqKTsKKworCWNzID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2Jq
LCBJOTE1X01BUF9XQik7CisJaWYgKElTX0VSUihjcykpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1
dChvYmopOworCQlyZXR1cm4gRVJSX0NBU1QoY3MpOworCX0KKworCW1lbXNldChjcywgMCwgU1pf
NjRLKTsKKwljc1tTWl82NEsgLyBzaXplb2YoKmNzKSAtIDFdID0gTUlfQkFUQ0hfQlVGRkVSX0VO
RDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAob2JqKTsKKwlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fbWFwKG9iaik7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGNlLT52bSwg
TlVMTCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsK
KwkJcmV0dXJuIHZtYTsKKwl9CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5f
VVNFUik7CisJaWYgKGVycikgeworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCXJldHVy
biBFUlJfUFRSKGVycik7CisJfQorCisJcmV0dXJuIHZtYTsKK30KKworc3RhdGljIGludCBwZXJm
X21pX25vb3Aodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwor
CWludCBlcnIgPSAwOworCisJaWYgKElOVEVMX0dFTihndC0+aTkxNSkgPCA3KSAvKiBmb3IgcGVy
LWVuZ2luZSBDU19USU1FU1RBTVAgKi8KKwkJcmV0dXJuIDA7CisKKwlwZXJmX2JlZ2luKGd0KTsK
Kwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKKwkJc3RydWN0IGk5MTVfdm1hICpiYXNl
LCAqbm9wOworCQl1MzIgY3ljbGVzW0NPVU5UXTsKKwkJaW50IGk7CisKKwkJYmFzZSA9IGNyZWF0
ZV9lbXB0eV9iYXRjaChjZSk7CisJCWlmIChJU19FUlIoYmFzZSkpIHsKKwkJCWVyciA9IFBUUl9F
UlIoYmFzZSk7CisJCQlicmVhazsKKwkJfQorCisJCWVyciA9IGk5MTVfdm1hX3N5bmMoYmFzZSk7
CisJCWlmIChlcnIpIHsKKwkJCWk5MTVfdm1hX3B1dChiYXNlKTsKKwkJCWJyZWFrOworCQl9CisK
KwkJbm9wID0gY3JlYXRlX25vcF9iYXRjaChjZSk7CisJCWlmIChJU19FUlIobm9wKSkgeworCQkJ
ZXJyID0gUFRSX0VSUihub3ApOworCQkJaTkxNV92bWFfcHV0KGJhc2UpOworCQkJYnJlYWs7CisJ
CX0KKworCQllcnIgPSBpOTE1X3ZtYV9zeW5jKG5vcCk7CisJCWlmIChlcnIpIHsKKwkJCWk5MTVf
dm1hX3B1dChub3ApOworCQkJaTkxNV92bWFfcHV0KGJhc2UpOworCQkJYnJlYWs7CisJCX0KKwor
CQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjeWNsZXMpOyBpKyspIHsKKwkJCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOworCisJCQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2UpOworCQkJ
aWYgKElTX0VSUihycSkpIHsKKwkJCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJCQlicmVhazsKKwkJ
CX0KKworCQkJZXJyID0gd3JpdGVfdGltZXN0YW1wKHJxLCAyKTsKKwkJCWlmIChlcnIpCisJCQkJ
Z290byBvdXQ7CisKKwkJCWVyciA9IHJxLT5lbmdpbmUtPmVtaXRfYmJfc3RhcnQocnEsCisJCQkJ
CQkJYmFzZS0+bm9kZS5zdGFydCwgOCwKKwkJCQkJCQkwKTsKKwkJCWlmIChlcnIpCisJCQkJZ290
byBvdXQ7CisKKwkJCWVyciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMyk7CisJCQlpZiAoZXJyKQor
CQkJCWdvdG8gb3V0OworCisJCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAor
CQkJCQkJCW5vcC0+bm9kZS5zdGFydCwgNDA5NiwKKwkJCQkJCQkwKTsKKwkJCWlmIChlcnIpCisJ
CQkJZ290byBvdXQ7CisKKwkJCWVyciA9IHdyaXRlX3RpbWVzdGFtcChycSwgNCk7CisJCQlpZiAo
ZXJyKQorCQkJCWdvdG8gb3V0OworCitvdXQ6CisJCQlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwkJ
CWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJCQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAs
IEhaIC8gNSkgPCAwKQorCQkJCWVyciA9IC1FSU87CisJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsK
KwkJCWlmIChlcnIpCisJCQkJYnJlYWs7CisKKwkJCWN5Y2xlc1tpXSA9CisJCQkJKHJxLT5od3Nw
X3NlcW5vWzRdIC0gcnEtPmh3c3Bfc2Vxbm9bM10pIC0KKwkJCQkocnEtPmh3c3Bfc2Vxbm9bM10g
LSBycS0+aHdzcF9zZXFub1syXSk7CisJCX0KKwkJaTkxNV92bWFfcHV0KG5vcCk7CisJCWk5MTVf
dm1hX3B1dChiYXNlKTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCisJCXByX2luZm8oIiVzOiAx
NksgTUlfTk9PUCBjeWNsZXM6ICV1XG4iLAorCQkJZW5naW5lLT5uYW1lLCB0cmlmaWx0ZXIoY3lj
bGVzKSk7CisJfQorCWlmIChwZXJmX2VuZChndCkpCisJCWVyciA9IC1FSU87CisKKwlyZXR1cm4g
ZXJyOworfQorCitpbnQgaW50ZWxfZW5naW5lX2NzX3BlcmZfc2VsZnRlc3RzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0
IHRlc3RzW10gPSB7CisJCVNVQlRFU1QocGVyZl9taV9iYl9zdGFydCksCisJCVNVQlRFU1QocGVy
Zl9taV9ub29wKSwKKwl9OworCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQor
CQlyZXR1cm4gMDsKKworCXJldHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCAmaTkx
NS0+Z3QpOworfQogCiBzdGF0aWMgaW50IGludGVsX21taW9fYmFzZXNfY2hlY2sodm9pZCAqYXJn
KQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKaW5kZXggMWJiNzAxZDMyYTVkLi5kYTNlOWI1NzUy
YWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYwpAQCAtMTAwMyw2ICsxMDAzLDEyIEBAIHN0YXRp
YyBpbnQgaTkxNV9wY2lfcHJvYmUoc3RydWN0IHBjaV9kZXYgKnBkZXYsIGNvbnN0IHN0cnVjdCBw
Y2lfZGV2aWNlX2lkICplbnQpCiAJCXJldHVybiBlcnIgPiAwID8gLUVOT1RUWSA6IGVycjsKIAl9
CiAKKwllcnIgPSBpOTE1X3BlcmZfc2VsZnRlc3RzKHBkZXYpOworCWlmIChlcnIpIHsKKwkJaTkx
NV9wY2lfcmVtb3ZlKHBkZXYpOworCQlyZXR1cm4gZXJyID4gMCA/IC1FTk9UVFkgOiBlcnI7CisJ
fQorCiAJcmV0dXJuIDA7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfc2VsZnRlc3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaAppbmRl
eCA0ZDg4MjA1ZGU1MWIuLjk4YmNiNmZhMGFiNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9zZWxmdGVzdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2Vs
ZnRlc3QuaApAQCAtMzYsNiArMzYsNyBAQCBzdHJ1Y3QgaTkxNV9zZWxmdGVzdCB7CiAJY2hhciAq
ZmlsdGVyOwogCWludCBtb2NrOwogCWludCBsaXZlOworCWludCBwZXJmOwogfTsKIAogI2lmIElT
X0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQpAQCAtNDUsNiArNDYsNyBAQCBleHRl
cm4gc3RydWN0IGk5MTVfc2VsZnRlc3QgaTkxNV9zZWxmdGVzdDsKIAogaW50IGk5MTVfbW9ja19z
ZWxmdGVzdHModm9pZCk7CiBpbnQgaTkxNV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAq
cGRldik7CitpbnQgaTkxNV9wZXJmX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldik7CiAK
IC8qIFdlIGV4dHJhY3QgdGhlIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBmcm9tIGk5MTVfbW9ja19z
ZWxmdGVzdHMuaCBhbmQKICAqIGk5MTVfbGl2ZV9zZWxmdGVzdHMuaCBBZGQgeW91ciB1bml0IHRl
c3QgZGVjbGFyYXRpb25zIHRoZXJlIQpAQCAtNjEsNiArNjMsNyBAQCBpbnQgaTkxNV9saXZlX3Nl
bGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldik7CiAjdW5kZWYgc2VsZnRlc3QKICNkZWZpbmUg
c2VsZnRlc3QobmFtZSwgZnVuYykgaW50IGZ1bmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpOwogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgiCisjaW5jbHVk
ZSAic2VsZnRlc3RzL2k5MTVfcGVyZl9zZWxmdGVzdHMuaCIKICN1bmRlZiBzZWxmdGVzdAogCiBz
dHJ1Y3QgaTkxNV9zdWJ0ZXN0IHsKQEAgLTEwOSw2ICsxMTIsNyBAQCBpbnQgX19pOTE1X3N1YnRl
c3RzKGNvbnN0IGNoYXIgKmNhbGxlciwKIAogc3RhdGljIGlubGluZSBpbnQgaTkxNV9tb2NrX3Nl
bGZ0ZXN0cyh2b2lkKSB7IHJldHVybiAwOyB9CiBzdGF0aWMgaW5saW5lIGludCBpOTE1X2xpdmVf
c2VsZnRlc3RzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KSB7IHJldHVybiAwOyB9CitzdGF0aWMgaW5s
aW5lIGludCBpOTE1X3BlcmZfc2VsZnRlc3RzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KSB7IHJldHVy
biAwOyB9CiAKICNkZWZpbmUgSTkxNV9TRUxGVEVTVF9ERUNMQVJFKHgpCiAjZGVmaW5lIEk5MTVf
U0VMRlRFU1RfT05MWSh4KSAwCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9wZXJmX3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfcGVyZl9zZWxmdGVzdHMuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAw
MDAwMDAwMDAuLmY3MTI5YTI0M2RhYQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgKQEAgLTAsMCArMSwxMyBAQAor
LyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAgKi8KKy8qIExpc3QgZWFjaCB1bml0
IHRlc3QgYXMgc2VsZnRlc3QobmFtZSwgZnVuY3Rpb24pCisgKgorICogVGhlIG5hbWUgaXMgdXNl
ZCBhcyBib3RoIGFuIGVudW0gYW5kIGV4cGFuZGVkIGFzIHN1YnRlc3RfX25hbWUgdG8gY3JlYXRl
CisgKiBhIG1vZHVsZSBwYXJhbWV0ZXIuIEl0IG11c3QgYmUgdW5pcXVlIGFuZCBsZWdhbCBmb3Ig
YSBDIGlkZW50aWZpZXIuCisgKgorICogVGhlIGZ1bmN0aW9uIHNob3VsZCBiZSBvZiB0eXBlIGlu
dCBmdW5jdGlvbih2b2lkKS4gSXQgbWF5IGJlIGNvbmRpdGlvbmFsbHkKKyAqIGNvbXBpbGVkIHVz
aW5nICNpZiBJU19FTkFCTEVEKERSTV9JOTE1X1NFTEZURVNUKS4KKyAqCisgKiBUZXN0cyBhcmUg
ZXhlY3V0ZWQgaW4gb3JkZXIgYnkgaWd0L2k5MTVfc2VsZnRlc3QKKyAqLworc2VsZnRlc3QoZW5n
aW5lX2NzLCBpbnRlbF9lbmdpbmVfY3NfcGVyZl9zZWxmdGVzdHMpCitzZWxmdGVzdChibHQsIGk5
MTVfZ2VtX29iamVjdF9ibHRfcGVyZl9zZWxmdGVzdHMpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYwppbmRleCBhNmNjYTRhZDk2ZjYuLmQzYmY5ZWVm
YjY4MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2Vs
ZnRlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVz
dC5jCkBAIC01Nyw2ICs1NywxMiBAQCBlbnVtIHsKICN1bmRlZiBzZWxmdGVzdAogfTsKIAorZW51
bSB7CisjZGVmaW5lIHNlbGZ0ZXN0KG5hbWUsIGZ1bmMpIHBlcmZfIyNuYW1lLAorI2luY2x1ZGUg
Imk5MTVfcGVyZl9zZWxmdGVzdHMuaCIKKyN1bmRlZiBzZWxmdGVzdAorfTsKKwogc3RydWN0IHNl
bGZ0ZXN0IHsKIAlib29sIGVuYWJsZWQ7CiAJY29uc3QgY2hhciAqbmFtZTsKQEAgLTc4LDYgKzg0
LDEyIEBAIHN0YXRpYyBzdHJ1Y3Qgc2VsZnRlc3QgbGl2ZV9zZWxmdGVzdHNbXSA9IHsKIH07CiAj
dW5kZWYgc2VsZnRlc3QKIAorI2RlZmluZSBzZWxmdGVzdChuLCBmKSBbcGVyZl8jI25dID0geyAu
bmFtZSA9ICNuLCB7IC5saXZlID0gZiB9IH0sCitzdGF0aWMgc3RydWN0IHNlbGZ0ZXN0IHBlcmZf
c2VsZnRlc3RzW10gPSB7CisjaW5jbHVkZSAiaTkxNV9wZXJmX3NlbGZ0ZXN0cy5oIgorfTsKKyN1
bmRlZiBzZWxmdGVzdAorCiAvKiBFbWJlZCB0aGUgbGluZSBudW1iZXIgaW50byB0aGUgcGFyYW1l
dGVyIG5hbWUgc28gdGhhdCB3ZSBjYW4gb3JkZXIgdGVzdHMgKi8KICNkZWZpbmUgc2VsZnRlc3Qo
biwgZnVuYykgc2VsZnRlc3RfMChuLCBmdW5jLCBwYXJhbShuKSkKICNkZWZpbmUgcGFyYW0obikg
X19QQVNURShpZ3RfXywgX19QQVNURShfX0xJTkVfXywgX19tb2NrXyMjbikpCkBAIC05Myw2ICsx
MDUsMTMgQEAgbW9kdWxlX3BhcmFtX25hbWVkKGlkLCBsaXZlX3NlbGZ0ZXN0c1tsaXZlXyMjbl0u
ZW5hYmxlZCwgYm9vbCwgMDQwMCk7CiAjaW5jbHVkZSAiaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIgog
I3VuZGVmIHNlbGZ0ZXN0XzAKICN1bmRlZiBwYXJhbQorCisjZGVmaW5lIHBhcmFtKG4pIF9fUEFT
VEUoaWd0X18sIF9fUEFTVEUoX19MSU5FX18sIF9fcGVyZl8jI24pKQorI2RlZmluZSBzZWxmdGVz
dF8wKG4sIGZ1bmMsIGlkKSBcCittb2R1bGVfcGFyYW1fbmFtZWQoaWQsIHBlcmZfc2VsZnRlc3Rz
W3BlcmZfIyNuXS5lbmFibGVkLCBib29sLCAwNDAwKTsKKyNpbmNsdWRlICJpOTE1X3BlcmZfc2Vs
ZnRlc3RzLmgiCisjdW5kZWYgc2VsZnRlc3RfMAorI3VuZGVmIHBhcmFtCiAjdW5kZWYgc2VsZnRl
c3QKIAogc3RhdGljIHZvaWQgc2V0X2RlZmF1bHRfdGVzdF9hbGwoc3RydWN0IHNlbGZ0ZXN0ICpz
dCwgdW5zaWduZWQgaW50IGNvdW50KQpAQCAtMjAwLDYgKzIxOSwyNyBAQCBpbnQgaTkxNV9saXZl
X3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikKIAlyZXR1cm4gMDsKIH0KIAoraW50IGk5
MTVfcGVyZl9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCit7CisJaW50IGVycjsKKwor
CWlmICghaTkxNV9zZWxmdGVzdC5wZXJmKQorCQlyZXR1cm4gMDsKKworCWVyciA9IHJ1bl9zZWxm
dGVzdHMocGVyZiwgcGRldl90b19pOTE1KHBkZXYpKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfc2Vs
ZnRlc3QucGVyZiA9IGVycjsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwlpZiAoaTkxNV9zZWxmdGVz
dC5wZXJmIDwgMCkgeworCQlpOTE1X3NlbGZ0ZXN0LnBlcmYgPSAtRU5PVFRZOworCQlyZXR1cm4g
MTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKwogc3RhdGljIGJvb2wgYXBwbHlfc3VidGVzdF9maWx0
ZXIoY29uc3QgY2hhciAqY2FsbGVyLCBjb25zdCBjaGFyICpuYW1lKQogewogCWNoYXIgKmZpbHRl
ciwgKnNlcCwgKnRvazsKQEAgLTM2NSwzICs0MDUsNiBAQCBNT0RVTEVfUEFSTV9ERVNDKG1vY2tf
c2VsZnRlc3RzLCAiUnVuIHNlbGZ0ZXN0cyBiZWZvcmUgbG9hZGluZywgdXNpbmcgbW9jayBoYXJk
dwogCiBtb2R1bGVfcGFyYW1fbmFtZWRfdW5zYWZlKGxpdmVfc2VsZnRlc3RzLCBpOTE1X3NlbGZ0
ZXN0LmxpdmUsIGludCwgMDQwMCk7CiBNT0RVTEVfUEFSTV9ERVNDKGxpdmVfc2VsZnRlc3RzLCAi
UnVuIHNlbGZ0ZXN0cyBhZnRlciBkcml2ZXIgaW5pdGlhbGlzYXRpb24gb24gdGhlIGxpdmUgc3lz
dGVtICgwOmRpc2FibGVkIFtkZWZhdWx0XSwgMTpydW4gdGVzdHMgdGhlbiBjb250aW51ZSwgLTE6
cnVuIHRlc3RzIHRoZW4gZXhpdCBtb2R1bGUpIik7CisKK21vZHVsZV9wYXJhbV9uYW1lZF91bnNh
ZmUocGVyZl9zZWxmdGVzdHMsIGk5MTVfc2VsZnRlc3QucGVyZiwgaW50LCAwNDAwKTsKK01PRFVM
RV9QQVJNX0RFU0MocGVyZl9zZWxmdGVzdHMsICJSdW4gcGVyZm9ybWFuY2Ugb3JpZW50YXRlZCBz
ZWxmdGVzdHMgYWZ0ZXIgZHJpdmVyIGluaXRpYWxpc2F0aW9uIG9uIHRoZSBsaXZlIHN5c3RlbSAo
MDpkaXNhYmxlZCBbZGVmYXVsdF0sIDE6cnVuIHRlc3RzIHRoZW4gY29udGludWUsIC0xOnJ1biB0
ZXN0cyB0aGVuIGV4aXQgbW9kdWxlKSIpOwotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

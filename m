Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9D69733F5A2
	for <lists+intel-gfx@lfdr.de>; Wed, 17 Mar 2021 17:37:13 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E2D476E158;
	Wed, 17 Mar 2021 16:37:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E23AE6E158
 for <intel-gfx@lists.freedesktop.org>; Wed, 17 Mar 2021 16:37:10 +0000 (UTC)
IronPort-SDR: sm3Jb+CKaOkvN4ruv6gy3Ib/XdxhqfFPHhd+RQlGrCR8pBETrmprC9Z9jPLQ7k+Cev5QFe12yp
 4gwmYiX4FrFQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9926"; a="186141825"
X-IronPort-AV: E=Sophos;i="5.81,256,1610438400"; d="scan'208";a="186141825"
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga102.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 17 Mar 2021 09:37:10 -0700
IronPort-SDR: ky39DdHPB6S9I02xoftXHWSwZPEhfguaZPQXZkEiTL2UEvnqVUj4pJk52bDSKBSe4QlOAtHeLI
 KJ3C1ZKVNCBQ==
X-IronPort-AV: E=Sophos;i="5.81,256,1610438400"; d="scan'208";a="405994482"
Received: from jpferrer-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.249.46.99])
 by fmsmga008-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 17 Mar 2021 09:37:05 -0700
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 17 Mar 2021 18:36:40 +0200
Message-Id: <93fe9e8be2e6120b085d09e49aafdf52f5ccd725.1615998927.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1615998927.git.jani.nikula@intel.com>
References: <cover.1615998927.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 01/14] drm/i915/bios: mass convert dev_priv
 to i915
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, lucas.demarchi@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGltZSB0byBqdXN0IHlhbmsgb3V0IHRoZSBiYW5kYWdlLiBObyBmdW5jdGlvbmFsIGNoYW5nZXMu
Cgp2MjogUmViYXNlZAoKQ2M6IEx1Y2FzIERlIE1hcmNoaSA8bHVjYXMuZGVtYXJjaGlAaW50ZWwu
Y29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4K
UmV2aWV3ZWQtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5j
b20+ICMgdjEKU2lnbmVkLW9mZi1ieTogSmFuaSBOaWt1bGEgPGphbmkubmlrdWxhQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Jpb3MuYyB8IDc2NiAr
KysrKysrKysrKy0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzgzIGluc2VydGlvbnMoKyks
IDM4MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Jpb3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmlv
cy5jCmluZGV4IGYzZmExNDQxY2UxNi4uNmU0NjUwYTdjNjA0IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Jpb3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Jpb3MuYwpAQCAtMjExLDcgKzIxMSw3IEBAIGdldF9sdmRzX2Zw
X3RpbWluZyhjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiLAogCiAvKiBQYXJzZSBnZW5lcmFs
IHBhbmVsIG9wdGlvbnMgKi8KIHN0YXRpYyB2b2lkCi1wYXJzZV9wYW5lbF9vcHRpb25zKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3BhcnNlX3BhbmVsX29wdGlvbnMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAq
YmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfbHZkc19vcHRpb25zICpsdmRzX29wdGlvbnM7CkBA
IC0yMjMsMjcgKzIyMywyNyBAQCBwYXJzZV9wYW5lbF9vcHRpb25zKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAlpZiAoIWx2ZHNfb3B0aW9ucykKIAkJcmV0dXJuOwogCi0JZGV2
X3ByaXYtPnZidC5sdmRzX2RpdGhlciA9IGx2ZHNfb3B0aW9ucy0+cGl4ZWxfZGl0aGVyOworCWk5
MTUtPnZidC5sdmRzX2RpdGhlciA9IGx2ZHNfb3B0aW9ucy0+cGl4ZWxfZGl0aGVyOwogCi0JcmV0
ID0gaW50ZWxfb3ByZWdpb25fZ2V0X3BhbmVsX3R5cGUoZGV2X3ByaXYpOworCXJldCA9IGludGVs
X29wcmVnaW9uX2dldF9wYW5lbF90eXBlKGk5MTUpOwogCWlmIChyZXQgPj0gMCkgewotCQlkcm1f
V0FSTl9PTigmZGV2X3ByaXYtPmRybSwgcmV0ID4gMHhmKTsKKwkJZHJtX1dBUk5fT04oJmk5MTUt
PmRybSwgcmV0ID4gMHhmKTsKIAkJcGFuZWxfdHlwZSA9IHJldDsKLQkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sICJQYW5lbCB0eXBlOiAlZCAoT3BSZWdpb24pXG4iLAorCQlkcm1fZGJnX2tt
cygmaTkxNS0+ZHJtLCAiUGFuZWwgdHlwZTogJWQgKE9wUmVnaW9uKVxuIiwKIAkJCSAgICBwYW5l
bF90eXBlKTsKIAl9IGVsc2UgewogCQlpZiAobHZkc19vcHRpb25zLT5wYW5lbF90eXBlID4gMHhm
KSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCWRybV9kYmdfa21zKCZpOTE1
LT5kcm0sCiAJCQkJICAgICJJbnZhbGlkIFZCVCBwYW5lbCB0eXBlIDB4JXhcbiIsCiAJCQkJICAg
IGx2ZHNfb3B0aW9ucy0+cGFuZWxfdHlwZSk7CiAJCQlyZXR1cm47CiAJCX0KIAkJcGFuZWxfdHlw
ZSA9IGx2ZHNfb3B0aW9ucy0+cGFuZWxfdHlwZTsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5k
cm0sICJQYW5lbCB0eXBlOiAlZCAoVkJUKVxuIiwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwg
IlBhbmVsIHR5cGU6ICVkIChWQlQpXG4iLAogCQkJICAgIHBhbmVsX3R5cGUpOwogCX0KIAotCWRl
dl9wcml2LT52YnQucGFuZWxfdHlwZSA9IHBhbmVsX3R5cGU7CisJaTkxNS0+dmJ0LnBhbmVsX3R5
cGUgPSBwYW5lbF90eXBlOwogCiAJZHJyc19tb2RlID0gKGx2ZHNfb3B0aW9ucy0+ZHBzX3BhbmVs
X3R5cGVfYml0cwogCQkJCT4+IChwYW5lbF90eXBlICogMikpICYgTU9ERV9NQVNLOwpAQCAtMjU0
LDE3ICsyNTQsMTcgQEAgcGFyc2VfcGFuZWxfb3B0aW9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJICovCiAJc3dpdGNoIChkcnJzX21vZGUpIHsKIAljYXNlIDA6Ci0JCWRl
dl9wcml2LT52YnQuZHJyc190eXBlID0gU1RBVElDX0RSUlNfU1VQUE9SVDsKLQkJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sICJEUlJTIHN1cHBvcnRlZCBtb2RlIGlzIHN0YXRpY1xuIik7CisJ
CWk5MTUtPnZidC5kcnJzX3R5cGUgPSBTVEFUSUNfRFJSU19TVVBQT1JUOworCQlkcm1fZGJnX2tt
cygmaTkxNS0+ZHJtLCAiRFJSUyBzdXBwb3J0ZWQgbW9kZSBpcyBzdGF0aWNcbiIpOwogCQlicmVh
azsKIAljYXNlIDI6Ci0JCWRldl9wcml2LT52YnQuZHJyc190eXBlID0gU0VBTUxFU1NfRFJSU19T
VVBQT1JUOwotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJaTkxNS0+dmJ0LmRycnNf
dHlwZSA9IFNFQU1MRVNTX0RSUlNfU1VQUE9SVDsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwK
IAkJCSAgICAiRFJSUyBzdXBwb3J0ZWQgbW9kZSBpcyBzZWFtbGVzc1xuIik7CiAJCWJyZWFrOwog
CWRlZmF1bHQ6Ci0JCWRldl9wcml2LT52YnQuZHJyc190eXBlID0gRFJSU19OT1RfU1VQUE9SVEVE
OwotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJaTkxNS0+dmJ0LmRycnNfdHlwZSA9
IERSUlNfTk9UX1NVUFBPUlRFRDsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAi
RFJSUyBub3Qgc3VwcG9ydGVkIChWQlQgaW5wdXQpXG4iKTsKIAkJYnJlYWs7CiAJfQpAQCAtMjcy
LDcgKzI3Miw3IEBAIHBhcnNlX3BhbmVsX29wdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCiAvKiBUcnkgdG8gZmluZCBpbnRlZ3JhdGVkIHBhbmVsIHRpbWluZyBkYXRh
ICovCiBzdGF0aWMgdm9pZAotcGFyc2VfbGZwX3BhbmVsX2R0ZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9sZnBfcGFuZWxfZHRkKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkgICAgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25z
dCBzdHJ1Y3QgYmRiX2x2ZHNfbGZwX2RhdGEgKmx2ZHNfbGZwX2RhdGE7CkBAIC0yODAsNyArMjgw
LDcgQEAgcGFyc2VfbGZwX3BhbmVsX2R0ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJY29uc3Qgc3RydWN0IGx2ZHNfZHZvX3RpbWluZyAqcGFuZWxfZHZvX3RpbWluZzsKIAlj
b25zdCBzdHJ1Y3QgbHZkc19mcF90aW1pbmcgKmZwX3RpbWluZzsKIAlzdHJ1Y3QgZHJtX2Rpc3Bs
YXlfbW9kZSAqcGFuZWxfZml4ZWRfbW9kZTsKLQlpbnQgcGFuZWxfdHlwZSA9IGRldl9wcml2LT52
YnQucGFuZWxfdHlwZTsKKwlpbnQgcGFuZWxfdHlwZSA9IGk5MTUtPnZidC5wYW5lbF90eXBlOwog
CiAJbHZkc19sZnBfZGF0YSA9IGZpbmRfc2VjdGlvbihiZGIsIEJEQl9MVkRTX0xGUF9EQVRBKTsK
IAlpZiAoIWx2ZHNfbGZwX2RhdGEpCkBAIC0zMDAsOSArMzAwLDkgQEAgcGFyc2VfbGZwX3BhbmVs
X2R0ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAlmaWxsX2RldGFpbF90
aW1pbmdfZGF0YShwYW5lbF9maXhlZF9tb2RlLCBwYW5lbF9kdm9fdGltaW5nKTsKIAotCWRldl9w
cml2LT52YnQubGZwX2x2ZHNfdmJ0X21vZGUgPSBwYW5lbF9maXhlZF9tb2RlOworCWk5MTUtPnZi
dC5sZnBfbHZkc192YnRfbW9kZSA9IHBhbmVsX2ZpeGVkX21vZGU7CiAKLQlkcm1fZGJnX2ttcygm
ZGV2X3ByaXYtPmRybSwKKwlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkgICAgIkZvdW5kIHBh
bmVsIG1vZGUgaW4gQklPUyBWQlQgbGVnYWN5IGxmcCB0YWJsZTpcbiIpOwogCWRybV9tb2RlX2Rl
YnVnX3ByaW50bW9kZWxpbmUocGFuZWxfZml4ZWRfbW9kZSk7CiAKQEAgLTMxMywxNiArMzEzLDE2
IEBAIHBhcnNlX2xmcF9wYW5lbF9kdGQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQkvKiBjaGVjayB0aGUgcmVzb2x1dGlvbiwganVzdCB0byBiZSBzdXJlICovCiAJCWlmIChm
cF90aW1pbmctPnhfcmVzID09IHBhbmVsX2ZpeGVkX21vZGUtPmhkaXNwbGF5ICYmCiAJCSAgICBm
cF90aW1pbmctPnlfcmVzID09IHBhbmVsX2ZpeGVkX21vZGUtPnZkaXNwbGF5KSB7Ci0JCQlkZXZf
cHJpdi0+dmJ0LmJpb3NfbHZkc192YWwgPSBmcF90aW1pbmctPmx2ZHNfcmVnX3ZhbDsKLQkJCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJaTkxNS0+dmJ0LmJpb3NfbHZkc192YWwgPSBm
cF90aW1pbmctPmx2ZHNfcmVnX3ZhbDsKKwkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkJ
ICAgICJWQlQgaW5pdGlhbCBMVkRTIHZhbHVlICV4XG4iLAotCQkJCSAgICBkZXZfcHJpdi0+dmJ0
LmJpb3NfbHZkc192YWwpOworCQkJCSAgICBpOTE1LT52YnQuYmlvc19sdmRzX3ZhbCk7CiAJCX0K
IAl9CiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9nZW5lcmljX2R0ZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9nZW5lcmljX2R0ZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJICBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewogCWNvbnN0
IHN0cnVjdCBiZGJfZ2VuZXJpY19kdGQgKmdlbmVyaWNfZHRkOwpAQCAtMzM1LDI2ICszMzUsMjYg
QEAgcGFyc2VfZ2VuZXJpY19kdGQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CQlyZXR1cm47CiAKIAlpZiAoZ2VuZXJpY19kdGQtPmdkdGRfc2l6ZSA8IHNpemVvZihzdHJ1Y3Qg
Z2VuZXJpY19kdGRfZW50cnkpKSB7Ci0JCWRybV9lcnIoJmRldl9wcml2LT5kcm0sICJHRFREIHNp
emUgJXUgaXMgdG9vIHNtYWxsLlxuIiwKKwkJZHJtX2VycigmaTkxNS0+ZHJtLCAiR0RURCBzaXpl
ICV1IGlzIHRvbyBzbWFsbC5cbiIsCiAJCQlnZW5lcmljX2R0ZC0+Z2R0ZF9zaXplKTsKIAkJcmV0
dXJuOwogCX0gZWxzZSBpZiAoZ2VuZXJpY19kdGQtPmdkdGRfc2l6ZSAhPQogCQkgICBzaXplb2Yo
c3RydWN0IGdlbmVyaWNfZHRkX2VudHJ5KSkgewotCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAi
VW5leHBlY3RlZCBHRFREIHNpemUgJXVcbiIsCisJCWRybV9lcnIoJmk5MTUtPmRybSwgIlVuZXhw
ZWN0ZWQgR0RURCBzaXplICV1XG4iLAogCQkJZ2VuZXJpY19kdGQtPmdkdGRfc2l6ZSk7CiAJCS8q
IERURCBoYXMgdW5rbm93biBmaWVsZHMsIGJ1dCBrZWVwIGdvaW5nICovCiAJfQogCiAJbnVtX2R0
ZCA9IChnZXRfYmxvY2tzaXplKGdlbmVyaWNfZHRkKSAtCiAJCSAgIHNpemVvZihzdHJ1Y3QgYmRi
X2dlbmVyaWNfZHRkKSkgLyBnZW5lcmljX2R0ZC0+Z2R0ZF9zaXplOwotCWlmIChkZXZfcHJpdi0+
dmJ0LnBhbmVsX3R5cGUgPj0gbnVtX2R0ZCkgewotCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAor
CWlmIChpOTE1LT52YnQucGFuZWxfdHlwZSA+PSBudW1fZHRkKSB7CisJCWRybV9lcnIoJmk5MTUt
PmRybSwKIAkJCSJQYW5lbCB0eXBlICVkIG5vdCBmb3VuZCBpbiB0YWJsZSBvZiAlZCBEVEQnc1xu
IiwKLQkJCWRldl9wcml2LT52YnQucGFuZWxfdHlwZSwgbnVtX2R0ZCk7CisJCQlpOTE1LT52YnQu
cGFuZWxfdHlwZSwgbnVtX2R0ZCk7CiAJCXJldHVybjsKIAl9CiAKLQlkdGQgPSAmZ2VuZXJpY19k
dGQtPmR0ZFtkZXZfcHJpdi0+dmJ0LnBhbmVsX3R5cGVdOworCWR0ZCA9ICZnZW5lcmljX2R0ZC0+
ZHRkW2k5MTUtPnZidC5wYW5lbF90eXBlXTsKIAogCXBhbmVsX2ZpeGVkX21vZGUgPSBremFsbG9j
KHNpemVvZigqcGFuZWxfZml4ZWRfbW9kZSksIEdGUF9LRVJORUwpOwogCWlmICghcGFuZWxfZml4
ZWRfbW9kZSkKQEAgLTM5MywxNSArMzkzLDE1IEBAIHBhcnNlX2dlbmVyaWNfZHRkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAllbHNlCiAJCXBhbmVsX2ZpeGVkX21vZGUtPmZs
YWdzIHw9IERSTV9NT0RFX0ZMQUdfTlZTWU5DOwogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5k
cm0sCisJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJICAgICJGb3VuZCBwYW5lbCBtb2RlIGlu
IEJJT1MgVkJUIGdlbmVyaWMgZHRkIHRhYmxlOlxuIik7CiAJZHJtX21vZGVfZGVidWdfcHJpbnRt
b2RlbGluZShwYW5lbF9maXhlZF9tb2RlKTsKIAotCWRldl9wcml2LT52YnQubGZwX2x2ZHNfdmJ0
X21vZGUgPSBwYW5lbF9maXhlZF9tb2RlOworCWk5MTUtPnZidC5sZnBfbHZkc192YnRfbW9kZSA9
IHBhbmVsX2ZpeGVkX21vZGU7CiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9wYW5lbF9kdGQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2VfcGFuZWxfZHRkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQljb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQog
ewogCS8qCkBAIC00MTMsMTggKzQxMywxOCBAQCBwYXJzZV9wYW5lbF9kdGQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqIGJhY2sgdG8gdHJ5aW5nIHRoZSBvbGQgTEZQIGJs
b2NrIGlmIHRoYXQgZmFpbHMuCiAJICovCiAJaWYgKGJkYi0+dmVyc2lvbiA+PSAyMjkpCi0JCXBh
cnNlX2dlbmVyaWNfZHRkKGRldl9wcml2LCBiZGIpOwotCWlmICghZGV2X3ByaXYtPnZidC5sZnBf
bHZkc192YnRfbW9kZSkKLQkJcGFyc2VfbGZwX3BhbmVsX2R0ZChkZXZfcHJpdiwgYmRiKTsKKwkJ
cGFyc2VfZ2VuZXJpY19kdGQoaTkxNSwgYmRiKTsKKwlpZiAoIWk5MTUtPnZidC5sZnBfbHZkc192
YnRfbW9kZSkKKwkJcGFyc2VfbGZwX3BhbmVsX2R0ZChpOTE1LCBiZGIpOwogfQogCiBzdGF0aWMg
dm9pZAotcGFyc2VfbGZwX2JhY2tsaWdodChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCitwYXJzZV9sZnBfYmFja2xpZ2h0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkgICAgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1Y3QgYmRi
X2xmcF9iYWNrbGlnaHRfZGF0YSAqYmFja2xpZ2h0X2RhdGE7CiAJY29uc3Qgc3RydWN0IGxmcF9i
YWNrbGlnaHRfZGF0YV9lbnRyeSAqZW50cnk7Ci0JaW50IHBhbmVsX3R5cGUgPSBkZXZfcHJpdi0+
dmJ0LnBhbmVsX3R5cGU7CisJaW50IHBhbmVsX3R5cGUgPSBpOTE1LT52YnQucGFuZWxfdHlwZTsK
IAl1MTYgbGV2ZWw7CiAKIAliYWNrbGlnaHRfZGF0YSA9IGZpbmRfc2VjdGlvbihiZGIsIEJEQl9M
VkRTX0JBQ0tMSUdIVCk7CkBAIC00MzIsNyArNDMyLDcgQEAgcGFyc2VfbGZwX2JhY2tsaWdodChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsKIAogCWlmIChiYWNr
bGlnaHRfZGF0YS0+ZW50cnlfc2l6ZSAhPSBzaXplb2YoYmFja2xpZ2h0X2RhdGEtPmRhdGFbMF0p
KSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+
ZHJtLAogCQkJICAgICJVbnN1cHBvcnRlZCBiYWNrbGlnaHQgZGF0YSBlbnRyeSBzaXplICV1XG4i
LAogCQkJICAgIGJhY2tsaWdodF9kYXRhLT5lbnRyeV9zaXplKTsKIAkJcmV0dXJuOwpAQCAtNDQw
LDI2ICs0NDAsMjYgQEAgcGFyc2VfbGZwX2JhY2tsaWdodChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAKIAllbnRyeSA9ICZiYWNrbGlnaHRfZGF0YS0+ZGF0YVtwYW5lbF90eXBl
XTsKIAotCWRldl9wcml2LT52YnQuYmFja2xpZ2h0LnByZXNlbnQgPSBlbnRyeS0+dHlwZSA9PSBC
REJfQkFDS0xJR0hUX1RZUEVfUFdNOwotCWlmICghZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQucHJl
c2VudCkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwlpOTE1LT52YnQuYmFja2xp
Z2h0LnByZXNlbnQgPSBlbnRyeS0+dHlwZSA9PSBCREJfQkFDS0xJR0hUX1RZUEVfUFdNOworCWlm
ICghaTkxNS0+dmJ0LmJhY2tsaWdodC5wcmVzZW50KSB7CisJCWRybV9kYmdfa21zKCZpOTE1LT5k
cm0sCiAJCQkgICAgIlBXTSBiYWNrbGlnaHQgbm90IHByZXNlbnQgaW4gVkJUICh0eXBlICV1KVxu
IiwKIAkJCSAgICBlbnRyeS0+dHlwZSk7CiAJCXJldHVybjsKIAl9CiAKLQlkZXZfcHJpdi0+dmJ0
LmJhY2tsaWdodC50eXBlID0gSU5URUxfQkFDS0xJR0hUX0RJU1BMQVlfRERJOworCWk5MTUtPnZi
dC5iYWNrbGlnaHQudHlwZSA9IElOVEVMX0JBQ0tMSUdIVF9ESVNQTEFZX0RESTsKIAlpZiAoYmRi
LT52ZXJzaW9uID49IDE5MSAmJgogCSAgICBnZXRfYmxvY2tzaXplKGJhY2tsaWdodF9kYXRhKSA+
PSBzaXplb2YoKmJhY2tsaWdodF9kYXRhKSkgewogCQljb25zdCBzdHJ1Y3QgbGZwX2JhY2tsaWdo
dF9jb250cm9sX21ldGhvZCAqbWV0aG9kOwogCiAJCW1ldGhvZCA9ICZiYWNrbGlnaHRfZGF0YS0+
YmFja2xpZ2h0X2NvbnRyb2xbcGFuZWxfdHlwZV07Ci0JCWRldl9wcml2LT52YnQuYmFja2xpZ2h0
LnR5cGUgPSBtZXRob2QtPnR5cGU7Ci0JCWRldl9wcml2LT52YnQuYmFja2xpZ2h0LmNvbnRyb2xs
ZXIgPSBtZXRob2QtPmNvbnRyb2xsZXI7CisJCWk5MTUtPnZidC5iYWNrbGlnaHQudHlwZSA9IG1l
dGhvZC0+dHlwZTsKKwkJaTkxNS0+dmJ0LmJhY2tsaWdodC5jb250cm9sbGVyID0gbWV0aG9kLT5j
b250cm9sbGVyOwogCX0KIAotCWRldl9wcml2LT52YnQuYmFja2xpZ2h0LnB3bV9mcmVxX2h6ID0g
ZW50cnktPnB3bV9mcmVxX2h6OwotCWRldl9wcml2LT52YnQuYmFja2xpZ2h0LmFjdGl2ZV9sb3df
cHdtID0gZW50cnktPmFjdGl2ZV9sb3dfcHdtOworCWk5MTUtPnZidC5iYWNrbGlnaHQucHdtX2Zy
ZXFfaHogPSBlbnRyeS0+cHdtX2ZyZXFfaHo7CisJaTkxNS0+dmJ0LmJhY2tsaWdodC5hY3RpdmVf
bG93X3B3bSA9IGVudHJ5LT5hY3RpdmVfbG93X3B3bTsKIAogCWlmIChiZGItPnZlcnNpb24gPj0g
MjM0KSB7CiAJCXUxNiBtaW5fbGV2ZWw7CkBAIC00NzcsMzcgKzQ3NywzNyBAQCBwYXJzZV9sZnBf
YmFja2xpZ2h0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCW1pbl9sZXZl
bCA9IG1pbl9sZXZlbCAvIDI1NTsKIAogCQlpZiAobWluX2xldmVsID4gMjU1KSB7Ci0JCQlkcm1f
d2FybigmZGV2X3ByaXYtPmRybSwgIkJyaWdodG5lc3MgbWluIGxldmVsID4gMjU1XG4iKTsKKwkJ
CWRybV93YXJuKCZpOTE1LT5kcm0sICJCcmlnaHRuZXNzIG1pbiBsZXZlbCA+IDI1NVxuIik7CiAJ
CQlsZXZlbCA9IDI1NTsKIAkJfQotCQlkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0
bmVzcyA9IG1pbl9sZXZlbDsKKwkJaTkxNS0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0bmVzcyA9
IG1pbl9sZXZlbDsKIAl9IGVsc2UgewogCQlsZXZlbCA9IGJhY2tsaWdodF9kYXRhLT5sZXZlbFtw
YW5lbF90eXBlXTsKLQkJZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQubWluX2JyaWdodG5lc3MgPSBl
bnRyeS0+bWluX2JyaWdodG5lc3M7CisJCWk5MTUtPnZidC5iYWNrbGlnaHQubWluX2JyaWdodG5l
c3MgPSBlbnRyeS0+bWluX2JyaWdodG5lc3M7CiAJfQogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2
LT5kcm0sCisJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJICAgICJWQlQgYmFja2xpZ2h0IFBX
TSBtb2R1bGF0aW9uIGZyZXF1ZW5jeSAldSBIeiwgIgogCQkgICAgImFjdGl2ZSAlcywgbWluIGJy
aWdodG5lc3MgJXUsIGxldmVsICV1LCBjb250cm9sbGVyICV1XG4iLAotCQkgICAgZGV2X3ByaXYt
PnZidC5iYWNrbGlnaHQucHdtX2ZyZXFfaHosCi0JCSAgICBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdo
dC5hY3RpdmVfbG93X3B3bSA/ICJsb3ciIDogImhpZ2giLAotCQkgICAgZGV2X3ByaXYtPnZidC5i
YWNrbGlnaHQubWluX2JyaWdodG5lc3MsCisJCSAgICBpOTE1LT52YnQuYmFja2xpZ2h0LnB3bV9m
cmVxX2h6LAorCQkgICAgaTkxNS0+dmJ0LmJhY2tsaWdodC5hY3RpdmVfbG93X3B3bSA/ICJsb3ci
IDogImhpZ2giLAorCQkgICAgaTkxNS0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0bmVzcywKIAkJ
ICAgIGxldmVsLAotCQkgICAgZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQuY29udHJvbGxlcik7CisJ
CSAgICBpOTE1LT52YnQuYmFja2xpZ2h0LmNvbnRyb2xsZXIpOwogfQogCiAvKiBUcnkgdG8gZmlu
ZCBzZHZvIHBhbmVsIGRhdGEgKi8KIHN0YXRpYyB2b2lkCi1wYXJzZV9zZHZvX3BhbmVsX2RhdGEo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2Vfc2R2b19wYW5lbF9kYXRh
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgICBjb25zdCBzdHJ1Y3QgYmRi
X2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfc2R2b19wYW5lbF9kdGRzICpkdGRz
OwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpwYW5lbF9maXhlZF9tb2RlOwogCWludCBpbmRl
eDsKIAotCWluZGV4ID0gZGV2X3ByaXYtPnBhcmFtcy52YnRfc2R2b19wYW5lbF90eXBlOworCWlu
ZGV4ID0gaTkxNS0+cGFyYW1zLnZidF9zZHZvX3BhbmVsX3R5cGU7CiAJaWYgKGluZGV4ID09IC0y
KSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+
ZHJtLAogCQkJICAgICJJZ25vcmUgU0RWTyBwYW5lbCBtb2RlIGZyb20gQklPUyBWQlQgdGFibGVz
LlxuIik7CiAJCXJldHVybjsKIAl9CkBAIC01MzIsMTcgKzUzMiwxNyBAQCBwYXJzZV9zZHZvX3Bh
bmVsX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAJZmlsbF9kZXRh
aWxfdGltaW5nX2RhdGEocGFuZWxfZml4ZWRfbW9kZSwgJmR0ZHMtPmR0ZHNbaW5kZXhdKTsKIAot
CWRldl9wcml2LT52YnQuc2R2b19sdmRzX3ZidF9tb2RlID0gcGFuZWxfZml4ZWRfbW9kZTsKKwlp
OTE1LT52YnQuc2R2b19sdmRzX3ZidF9tb2RlID0gcGFuZWxfZml4ZWRfbW9kZTsKIAotCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCSAgICAi
Rm91bmQgU0RWTyBwYW5lbCBtb2RlIGluIEJJT1MgVkJUIHRhYmxlczpcbiIpOwogCWRybV9tb2Rl
X2RlYnVnX3ByaW50bW9kZWxpbmUocGFuZWxfZml4ZWRfbW9kZSk7CiB9CiAKLXN0YXRpYyBpbnQg
aW50ZWxfYmlvc19zc2NfZnJlcXVlbmN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKK3N0YXRpYyBpbnQgaW50ZWxfYmlvc19zc2NfZnJlcXVlbmN5KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJCSAgICBib29sIGFsdGVybmF0ZSkKIHsKLQlzd2l0Y2ggKElOVEVM
X0dFTihkZXZfcHJpdikpIHsKKwlzd2l0Y2ggKElOVEVMX0dFTihpOTE1KSkgewogCWNhc2UgMjoK
IAkJcmV0dXJuIGFsdGVybmF0ZSA/IDY2NjY3IDogNDgwMDA7CiAJY2FzZSAzOgpAQCAtNTU0LDcg
KzU1NCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfYmlvc19zc2NfZnJlcXVlbmN5KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIH0KIAogc3RhdGljIHZvaWQKLXBhcnNlX2dlbmVyYWxf
ZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2VfZ2VuZXJh
bF9mZWF0dXJlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgICAgIGNvbnN0
IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7CiAJY29uc3Qgc3RydWN0IGJkYl9nZW5lcmFsX2Zl
YXR1cmVzICpnZW5lcmFsOwpAQCAtNTYzLDMxICs1NjMsMzEgQEAgcGFyc2VfZ2VuZXJhbF9mZWF0
dXJlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKCFnZW5lcmFsKQog
CQlyZXR1cm47CiAKLQlkZXZfcHJpdi0+dmJ0LmludF90dl9zdXBwb3J0ID0gZ2VuZXJhbC0+aW50
X3R2X3N1cHBvcnQ7CisJaTkxNS0+dmJ0LmludF90dl9zdXBwb3J0ID0gZ2VuZXJhbC0+aW50X3R2
X3N1cHBvcnQ7CiAJLyogaW50X2NydF9zdXBwb3J0IGNhbid0IGJlIHRydXN0ZWQgb24gZWFybGll
ciBwbGF0Zm9ybXMgKi8KIAlpZiAoYmRiLT52ZXJzaW9uID49IDE1NSAmJgotCSAgICAoSEFTX0RE
SShkZXZfcHJpdikgfHwgSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpKQotCQlkZXZfcHJpdi0+dmJ0
LmludF9jcnRfc3VwcG9ydCA9IGdlbmVyYWwtPmludF9jcnRfc3VwcG9ydDsKLQlkZXZfcHJpdi0+
dmJ0Lmx2ZHNfdXNlX3NzYyA9IGdlbmVyYWwtPmVuYWJsZV9zc2M7Ci0JZGV2X3ByaXYtPnZidC5s
dmRzX3NzY19mcmVxID0KLQkJaW50ZWxfYmlvc19zc2NfZnJlcXVlbmN5KGRldl9wcml2LCBnZW5l
cmFsLT5zc2NfZnJlcSk7Ci0JZGV2X3ByaXYtPnZidC5kaXNwbGF5X2Nsb2NrX21vZGUgPSBnZW5l
cmFsLT5kaXNwbGF5X2Nsb2NrX21vZGU7Ci0JZGV2X3ByaXYtPnZidC5mZGlfcnhfcG9sYXJpdHlf
aW52ZXJ0ZWQgPSBnZW5lcmFsLT5mZGlfcnhfcG9sYXJpdHlfaW52ZXJ0ZWQ7CisJICAgIChIQVNf
RERJKGk5MTUpIHx8IElTX1ZBTExFWVZJRVcoaTkxNSkpKQorCQlpOTE1LT52YnQuaW50X2NydF9z
dXBwb3J0ID0gZ2VuZXJhbC0+aW50X2NydF9zdXBwb3J0OworCWk5MTUtPnZidC5sdmRzX3VzZV9z
c2MgPSBnZW5lcmFsLT5lbmFibGVfc3NjOworCWk5MTUtPnZidC5sdmRzX3NzY19mcmVxID0KKwkJ
aW50ZWxfYmlvc19zc2NfZnJlcXVlbmN5KGk5MTUsIGdlbmVyYWwtPnNzY19mcmVxKTsKKwlpOTE1
LT52YnQuZGlzcGxheV9jbG9ja19tb2RlID0gZ2VuZXJhbC0+ZGlzcGxheV9jbG9ja19tb2RlOwor
CWk5MTUtPnZidC5mZGlfcnhfcG9sYXJpdHlfaW52ZXJ0ZWQgPSBnZW5lcmFsLT5mZGlfcnhfcG9s
YXJpdHlfaW52ZXJ0ZWQ7CiAJaWYgKGJkYi0+dmVyc2lvbiA+PSAxODEpIHsKLQkJZGV2X3ByaXYt
PnZidC5vcmllbnRhdGlvbiA9IGdlbmVyYWwtPnJvdGF0ZV8xODAgPworCQlpOTE1LT52YnQub3Jp
ZW50YXRpb24gPSBnZW5lcmFsLT5yb3RhdGVfMTgwID8KIAkJCURSTV9NT0RFX1BBTkVMX09SSUVO
VEFUSU9OX0JPVFRPTV9VUCA6CiAJCQlEUk1fTU9ERV9QQU5FTF9PUklFTlRBVElPTl9OT1JNQUw7
CiAJfSBlbHNlIHsKLQkJZGV2X3ByaXYtPnZidC5vcmllbnRhdGlvbiA9IERSTV9NT0RFX1BBTkVM
X09SSUVOVEFUSU9OX1VOS05PV047CisJCWk5MTUtPnZidC5vcmllbnRhdGlvbiA9IERSTV9NT0RF
X1BBTkVMX09SSUVOVEFUSU9OX1VOS05PV047CiAJfQotCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLAorCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCSAgICAiQkRCX0dFTkVSQUxfRkVBVFVS
RVMgaW50X3R2X3N1cHBvcnQgJWQgaW50X2NydF9zdXBwb3J0ICVkIGx2ZHNfdXNlX3NzYyAlZCBs
dmRzX3NzY19mcmVxICVkIGRpc3BsYXlfY2xvY2tfbW9kZSAlZCBmZGlfcnhfcG9sYXJpdHlfaW52
ZXJ0ZWQgJWRcbiIsCi0JCSAgICBkZXZfcHJpdi0+dmJ0LmludF90dl9zdXBwb3J0LAotCQkgICAg
ZGV2X3ByaXYtPnZidC5pbnRfY3J0X3N1cHBvcnQsCi0JCSAgICBkZXZfcHJpdi0+dmJ0Lmx2ZHNf
dXNlX3NzYywKLQkJICAgIGRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcSwKLQkJICAgIGRldl9w
cml2LT52YnQuZGlzcGxheV9jbG9ja19tb2RlLAotCQkgICAgZGV2X3ByaXYtPnZidC5mZGlfcnhf
cG9sYXJpdHlfaW52ZXJ0ZWQpOworCQkgICAgaTkxNS0+dmJ0LmludF90dl9zdXBwb3J0LAorCQkg
ICAgaTkxNS0+dmJ0LmludF9jcnRfc3VwcG9ydCwKKwkJICAgIGk5MTUtPnZidC5sdmRzX3VzZV9z
c2MsCisJCSAgICBpOTE1LT52YnQubHZkc19zc2NfZnJlcSwKKwkJICAgIGk5MTUtPnZidC5kaXNw
bGF5X2Nsb2NrX21vZGUsCisJCSAgICBpOTE1LT52YnQuZmRpX3J4X3BvbGFyaXR5X2ludmVydGVk
KTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICoKQEAgLTU5
Nyw3ICs1OTcsNyBAQCBjaGlsZF9kZXZpY2VfcHRyKGNvbnN0IHN0cnVjdCBiZGJfZ2VuZXJhbF9k
ZWZpbml0aW9ucyAqZGVmcywgaW50IGkpCiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9zZHZvX2Rl
dmljZV9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggYmRiX3Zl
cnNpb24pCitwYXJzZV9zZHZvX2RldmljZV9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCB1OCBiZGJfdmVyc2lvbikKIHsKIAlzdHJ1Y3Qgc2R2b19kZXZpY2VfbWFwcGluZyAq
bWFwcGluZzsKIAljb25zdCBzdHJ1Y3QgZGlzcGxheV9kZXZpY2VfZGF0YSAqZGV2ZGF0YTsKQEAg
LTYwOCwxMiArNjA4LDEyIEBAIHBhcnNlX3Nkdm9fZGV2aWNlX21hcHBpbmcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJfdmVyc2lvbikKIAkgKiBPbmx5IHBhcnNlIFNE
Vk8gbWFwcGluZ3Mgb24gZ2VucyB0aGF0IGNvdWxkIGhhdmUgU0RWTy4gVGhpcyBpc24ndAogCSAq
IGFjY3VyYXRlIGFuZCBkb2Vzbid0IGhhdmUgdG8gYmUsIGFzIGxvbmcgYXMgaXQncyBub3QgdG9v
IHN0cmljdC4KIAkgKi8KLQlpZiAoIUlTX0dFTl9SQU5HRShkZXZfcHJpdiwgMywgNykpIHsKLQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJTa2lwcGluZyBTRFZPIGRldmljZSBtYXBwaW5n
XG4iKTsKKwlpZiAoIUlTX0dFTl9SQU5HRShpOTE1LCAzLCA3KSkgeworCQlkcm1fZGJnX2ttcygm
aTkxNS0+ZHJtLCAiU2tpcHBpbmcgU0RWTyBkZXZpY2UgbWFwcGluZ1xuIik7CiAJCXJldHVybjsK
IAl9CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGRldmRhdGEsICZkZXZfcHJpdi0+dmJ0LmRpc3Bs
YXlfZGV2aWNlcywgbm9kZSkgeworCWxpc3RfZm9yX2VhY2hfZW50cnkoZGV2ZGF0YSwgJmk5MTUt
PnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsKIAkJY2hpbGQgPSAmZGV2ZGF0YS0+Y2hpbGQ7
CiAKIAkJaWYgKGNoaWxkLT5zbGF2ZV9hZGRyICE9IFNMQVZFX0FERFIxICYmCkBAIC02MjcsMTcg
KzYyNywxNyBAQCBwYXJzZV9zZHZvX2RldmljZV9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgdTggYmRiX3ZlcnNpb24pCiAJCWlmIChjaGlsZC0+ZHZvX3BvcnQgIT0g
REVWSUNFX1BPUlRfRFZPQiAmJgogCQkgICAgY2hpbGQtPmR2b19wb3J0ICE9IERFVklDRV9QT1JU
X0RWT0MpIHsKIAkJCS8qIHNraXAgdGhlIGluY29ycmVjdCBTRFZPIHBvcnQgKi8KLQkJCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCQkg
ICAgIkluY29ycmVjdCBTRFZPIHBvcnQuIFNraXAgaXRcbiIpOwogCQkJY29udGludWU7CiAJCX0K
LQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0s
CiAJCQkgICAgInRoZSBTRFZPIGRldmljZSB3aXRoIHNsYXZlIGFkZHIgJTJ4IGlzIGZvdW5kIG9u
IgogCQkJICAgICIgJXMgcG9ydFxuIiwKIAkJCSAgICBjaGlsZC0+c2xhdmVfYWRkciwKIAkJCSAg
ICAoY2hpbGQtPmR2b19wb3J0ID09IERFVklDRV9QT1JUX0RWT0IpID8KIAkJCSAgICAiU0RWT0Ii
IDogIlNEVk9DIik7Ci0JCW1hcHBpbmcgPSAmZGV2X3ByaXYtPnZidC5zZHZvX21hcHBpbmdzW2No
aWxkLT5kdm9fcG9ydCAtIDFdOworCQltYXBwaW5nID0gJmk5MTUtPnZidC5zZHZvX21hcHBpbmdz
W2NoaWxkLT5kdm9fcG9ydCAtIDFdOwogCQlpZiAoIW1hcHBpbmctPmluaXRpYWxpemVkKSB7CiAJ
CQltYXBwaW5nLT5kdm9fcG9ydCA9IGNoaWxkLT5kdm9fcG9ydDsKIAkJCW1hcHBpbmctPnNsYXZl
X2FkZHIgPSBjaGlsZC0+c2xhdmVfYWRkcjsKQEAgLTY0NSwyMCArNjQ1LDIwIEBAIHBhcnNlX3Nk
dm9fZGV2aWNlX21hcHBpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBi
ZGJfdmVyc2lvbikKIAkJCW1hcHBpbmctPmRkY19waW4gPSBjaGlsZC0+ZGRjX3BpbjsKIAkJCW1h
cHBpbmctPmkyY19waW4gPSBjaGlsZC0+aTJjX3BpbjsKIAkJCW1hcHBpbmctPmluaXRpYWxpemVk
ID0gMTsKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJZHJtX2RiZ19rbXMoJmk5
MTUtPmRybSwKIAkJCQkgICAgIlNEVk8gZGV2aWNlOiBkdm89JXgsIGFkZHI9JXgsIHdpcmluZz0l
ZCwgZGRjX3Bpbj0lZCwgaTJjX3Bpbj0lZFxuIiwKIAkJCQkgICAgbWFwcGluZy0+ZHZvX3BvcnQs
IG1hcHBpbmctPnNsYXZlX2FkZHIsCiAJCQkJICAgIG1hcHBpbmctPmR2b193aXJpbmcsIG1hcHBp
bmctPmRkY19waW4sCiAJCQkJICAgIG1hcHBpbmctPmkyY19waW4pOwogCQl9IGVsc2UgewotCQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAog
CQkJCSAgICAiTWF5YmUgb25lIFNEVk8gcG9ydCBpcyBzaGFyZWQgYnkgIgogCQkJCSAgICAidHdv
IFNEVk8gZGV2aWNlLlxuIik7CiAJCX0KIAkJaWYgKGNoaWxkLT5zbGF2ZTJfYWRkcikgewogCQkJ
LyogTWF5YmUgdGhpcyBpcyBhIFNEVk8gZGV2aWNlIHdpdGggbXVsdGlwbGUgaW5wdXRzICovCiAJ
CQkvKiBBbmQgdGhlIG1hcHBpbmcgaW5mbyBpcyBub3QgYWRkZWQgKi8KLQkJCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAorCQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCQkgICAgInRo
ZXJlIGV4aXN0cyB0aGUgc2xhdmUyX2FkZHIuIE1heWJlIHRoaXMiCiAJCQkJICAgICIgaXMgYSBT
RFZPIGRldmljZSB3aXRoIG11bHRpcGxlIGlucHV0cy5cbiIpOwogCQl9CkBAIC02NjcsMTMgKzY2
NywxMyBAQCBwYXJzZV9zZHZvX2RldmljZV9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgdTggYmRiX3ZlcnNpb24pCiAKIAlpZiAoIWNvdW50KSB7CiAJCS8qIE5vIFNE
Vk8gZGV2aWNlIGluZm8gaXMgZm91bmQgKi8KLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIk5vIFNEVk8gZGV2aWNlIGluZm8g
aXMgZm91bmQgaW4gVkJUXG4iKTsKIAl9CiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9kcml2ZXJf
ZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2VfZHJpdmVy
X2ZlYXR1cmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgICBjb25zdCBz
dHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfZHJpdmVyX2ZlYXR1
cmVzICpkcml2ZXI7CkBAIC02ODIsMTQgKzY4MiwxNCBAQCBwYXJzZV9kcml2ZXJfZmVhdHVyZXMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlmICghZHJpdmVyKQogCQlyZXR1
cm47CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA1KSB7CisJaWYgKElOVEVMX0dFTihp
OTE1KSA+PSA1KSB7CiAJCS8qCiAJCSAqIE5vdGUgdGhhdCB3ZSBjb25zaWRlciBCREJfRFJJVkVS
X0ZFQVRVUkVfSU5UX1NEVk9fTFZEUwogCQkgKiB0byBtZWFuICJlRFAiLiBUaGUgVkJUIHNwZWMg
ZG9lc24ndCBhZ3JlZSB3aXRoIHRoYXQKIAkJICogaW50ZXJwcmV0YXRpb24sIGJ1dCByZWFsIHdv
cmxkIFZCVHMgc2VlbSB0by4KIAkJICovCiAJCWlmIChkcml2ZXItPmx2ZHNfY29uZmlnICE9IEJE
Ql9EUklWRVJfRkVBVFVSRV9JTlRfTFZEUykKLQkJCWRldl9wcml2LT52YnQuaW50X2x2ZHNfc3Vw
cG9ydCA9IDA7CisJCQlpOTE1LT52YnQuaW50X2x2ZHNfc3VwcG9ydCA9IDA7CiAJfSBlbHNlIHsK
IAkJLyoKIAkJICogRklYTUUgaXQncyBub3QgY2xlYXIgd2hpY2ggQkRCIHZlcnNpb24gaGFzIHRo
ZSBMVkRTIGNvbmZpZwpAQCAtNzA1LDExICs3MDUsMTEgQEAgcGFyc2VfZHJpdmVyX2ZlYXR1cmVz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaWYgKGJkYi0+dmVyc2lvbiA+
PSAxMzQgJiYKIAkJICAgIGRyaXZlci0+bHZkc19jb25maWcgIT0gQkRCX0RSSVZFUl9GRUFUVVJF
X0lOVF9MVkRTICYmCiAJCSAgICBkcml2ZXItPmx2ZHNfY29uZmlnICE9IEJEQl9EUklWRVJfRkVB
VFVSRV9JTlRfU0RWT19MVkRTKQotCQkJZGV2X3ByaXYtPnZidC5pbnRfbHZkc19zdXBwb3J0ID0g
MDsKKwkJCWk5MTUtPnZidC5pbnRfbHZkc19zdXBwb3J0ID0gMDsKIAl9CiAKIAlpZiAoYmRiLT52
ZXJzaW9uIDwgMjI4KSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiRFJSUyBTdGF0
ZSBFbmFibGVkOiVkXG4iLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiRFJSUyBTdGF0ZSBF
bmFibGVkOiVkXG4iLAogCQkJICAgIGRyaXZlci0+ZHJyc19lbmFibGVkKTsKIAkJLyoKIAkJICog
SWYgRFJSUyBpcyBub3Qgc3VwcG9ydGVkLCBkcnJzX3R5cGUgaGFzIHRvIGJlIHNldCB0byAwLgpA
QCAtNzE4LDE4ICs3MTgsMTggQEAgcGFyc2VfZHJpdmVyX2ZlYXR1cmVzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkJICogZHJpdmVyLT5kcnJzX2VuYWJsZWQ9ZmFsc2UKIAkJ
ICovCiAJCWlmICghZHJpdmVyLT5kcnJzX2VuYWJsZWQpCi0JCQlkZXZfcHJpdi0+dmJ0LmRycnNf
dHlwZSA9IERSUlNfTk9UX1NVUFBPUlRFRDsKKwkJCWk5MTUtPnZidC5kcnJzX3R5cGUgPSBEUlJT
X05PVF9TVVBQT1JURUQ7CiAKLQkJZGV2X3ByaXYtPnZidC5wc3IuZW5hYmxlID0gZHJpdmVyLT5w
c3JfZW5hYmxlZDsKKwkJaTkxNS0+dmJ0LnBzci5lbmFibGUgPSBkcml2ZXItPnBzcl9lbmFibGVk
OwogCX0KIH0KIAogc3RhdGljIHZvaWQKLXBhcnNlX3Bvd2VyX2NvbnNlcnZhdGlvbl9mZWF0dXJl
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9wb3dlcl9jb25zZXJ2
YXRpb25fZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICBjb25z
dCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfbGZwX3Bvd2Vy
ICpwb3dlcjsKLQl1OCBwYW5lbF90eXBlID0gZGV2X3ByaXYtPnZidC5wYW5lbF90eXBlOworCXU4
IHBhbmVsX3R5cGUgPSBpOTE1LT52YnQucGFuZWxfdHlwZTsKIAogCWlmIChiZGItPnZlcnNpb24g
PCAyMjgpCiAJCXJldHVybjsKQEAgLTczOCw3ICs3MzgsNyBAQCBwYXJzZV9wb3dlcl9jb25zZXJ2
YXRpb25fZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlmICgh
cG93ZXIpCiAJCXJldHVybjsKIAotCWRldl9wcml2LT52YnQucHNyLmVuYWJsZSA9IHBvd2VyLT5w
c3IgJiBCSVQocGFuZWxfdHlwZSk7CisJaTkxNS0+dmJ0LnBzci5lbmFibGUgPSBwb3dlci0+cHNy
ICYgQklUKHBhbmVsX3R5cGUpOwogCiAJLyoKIAkgKiBJZiBEUlJTIGlzIG5vdCBzdXBwb3J0ZWQs
IGRycnNfdHlwZSBoYXMgdG8gYmUgc2V0IHRvIDAuCkBAIC03NDcsMTkgKzc0NywxOSBAQCBwYXJz
ZV9wb3dlcl9jb25zZXJ2YXRpb25fZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCSAqIHBvd2VyLT5kcnJzICYgQklUKHBhbmVsX3R5cGUpPWZhbHNlCiAJICovCiAJ
aWYgKCEocG93ZXItPmRycnMgJiBCSVQocGFuZWxfdHlwZSkpKQotCQlkZXZfcHJpdi0+dmJ0LmRy
cnNfdHlwZSA9IERSUlNfTk9UX1NVUFBPUlRFRDsKKwkJaTkxNS0+dmJ0LmRycnNfdHlwZSA9IERS
UlNfTk9UX1NVUFBPUlRFRDsKIAogCWlmIChiZGItPnZlcnNpb24gPj0gMjMyKQotCQlkZXZfcHJp
di0+dmJ0LmVkcC5ob2JsID0gcG93ZXItPmhvYmwgJiBCSVQocGFuZWxfdHlwZSk7CisJCWk5MTUt
PnZidC5lZHAuaG9ibCA9IHBvd2VyLT5ob2JsICYgQklUKHBhbmVsX3R5cGUpOwogfQogCiBzdGF0
aWMgdm9pZAotcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgY29u
c3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKK3BhcnNlX2VkcChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1
Y3QgYmRiX2VkcCAqZWRwOwogCWNvbnN0IHN0cnVjdCBlZHBfcG93ZXJfc2VxICplZHBfcHBzOwog
CWNvbnN0IHN0cnVjdCBlZHBfZmFzdF9saW5rX3BhcmFtcyAqZWRwX2xpbmtfcGFyYW1zOwotCWlu
dCBwYW5lbF90eXBlID0gZGV2X3ByaXYtPnZidC5wYW5lbF90eXBlOworCWludCBwYW5lbF90eXBl
ID0gaTkxNS0+dmJ0LnBhbmVsX3R5cGU7CiAKIAllZHAgPSBmaW5kX3NlY3Rpb24oYmRiLCBCREJf
RURQKTsKIAlpZiAoIWVkcCkKQEAgLTc2NywxMyArNzY3LDEzIEBAIHBhcnNlX2VkcChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIp
CiAKIAlzd2l0Y2ggKChlZHAtPmNvbG9yX2RlcHRoID4+IChwYW5lbF90eXBlICogMikpICYgMykg
ewogCWNhc2UgRURQXzE4QlBQOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5icHAgPSAxODsKKwkJaTkx
NS0+dmJ0LmVkcC5icHAgPSAxODsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfMjRCUFA6Ci0JCWRldl9w
cml2LT52YnQuZWRwLmJwcCA9IDI0OworCQlpOTE1LT52YnQuZWRwLmJwcCA9IDI0OwogCQlicmVh
azsKIAljYXNlIEVEUF8zMEJQUDoKLQkJZGV2X3ByaXYtPnZidC5lZHAuYnBwID0gMzA7CisJCWk5
MTUtPnZidC5lZHAuYnBwID0gMzA7CiAJCWJyZWFrOwogCX0KIApAQCAtNzgxLDE3ICs3ODEsMTcg
QEAgcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3Qgc3Ry
dWN0IGJkYl9oZWFkZXIgKmJkYikKIAllZHBfcHBzID0gJmVkcC0+cG93ZXJfc2Vxc1twYW5lbF90
eXBlXTsKIAllZHBfbGlua19wYXJhbXMgPSAmZWRwLT5mYXN0X2xpbmtfcGFyYW1zW3BhbmVsX3R5
cGVdOwogCi0JZGV2X3ByaXYtPnZidC5lZHAucHBzID0gKmVkcF9wcHM7CisJaTkxNS0+dmJ0LmVk
cC5wcHMgPSAqZWRwX3BwczsKIAogCXN3aXRjaCAoZWRwX2xpbmtfcGFyYW1zLT5yYXRlKSB7CiAJ
Y2FzZSBFRFBfUkFURV8xXzYyOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5yYXRlID0gRFBfTElOS19C
V18xXzYyOworCQlpOTE1LT52YnQuZWRwLnJhdGUgPSBEUF9MSU5LX0JXXzFfNjI7CiAJCWJyZWFr
OwogCWNhc2UgRURQX1JBVEVfMl83OgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5yYXRlID0gRFBfTElO
S19CV18yXzc7CisJCWk5MTUtPnZidC5lZHAucmF0ZSA9IERQX0xJTktfQldfMl83OwogCQlicmVh
azsKIAlkZWZhdWx0OgotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZ19r
bXMoJmk5MTUtPmRybSwKIAkJCSAgICAiVkJUIGhhcyB1bmtub3duIGVEUCBsaW5rIHJhdGUgdmFs
dWUgJXVcbiIsCiAJCQkgICAgIGVkcF9saW5rX3BhcmFtcy0+cmF0ZSk7CiAJCWJyZWFrOwpAQCAt
Nzk5LDE2ICs3OTksMTYgQEAgcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAogCXN3aXRjaCAoZWRwX2xpbmtf
cGFyYW1zLT5sYW5lcykgewogCWNhc2UgRURQX0xBTkVfMToKLQkJZGV2X3ByaXYtPnZidC5lZHAu
bGFuZXMgPSAxOworCQlpOTE1LT52YnQuZWRwLmxhbmVzID0gMTsKIAkJYnJlYWs7CiAJY2FzZSBF
RFBfTEFORV8yOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5sYW5lcyA9IDI7CisJCWk5MTUtPnZidC5l
ZHAubGFuZXMgPSAyOwogCQlicmVhazsKIAljYXNlIEVEUF9MQU5FXzQ6Ci0JCWRldl9wcml2LT52
YnQuZWRwLmxhbmVzID0gNDsKKwkJaTkxNS0+dmJ0LmVkcC5sYW5lcyA9IDQ7CiAJCWJyZWFrOwog
CWRlZmF1bHQ6Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2ttcygm
aTkxNS0+ZHJtLAogCQkJICAgICJWQlQgaGFzIHVua25vd24gZURQIGxhbmUgY291bnQgdmFsdWUg
JXVcbiIsCiAJCQkgICAgZWRwX2xpbmtfcGFyYW1zLT5sYW5lcyk7CiAJCWJyZWFrOwpAQCAtODE2
LDE5ICs4MTYsMTkgQEAgcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAogCXN3aXRjaCAoZWRwX2xpbmtfcGFy
YW1zLT5wcmVlbXBoYXNpcykgewogCWNhc2UgRURQX1BSRUVNUEhBU0lTX05PTkU6Ci0JCWRldl9w
cml2LT52YnQuZWRwLnByZWVtcGhhc2lzID0gRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxfMDsKKwkJ
aTkxNS0+dmJ0LmVkcC5wcmVlbXBoYXNpcyA9IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzA7CiAJ
CWJyZWFrOwogCWNhc2UgRURQX1BSRUVNUEhBU0lTXzNfNWRCOgotCQlkZXZfcHJpdi0+dmJ0LmVk
cC5wcmVlbXBoYXNpcyA9IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzE7CisJCWk5MTUtPnZidC5l
ZHAucHJlZW1waGFzaXMgPSBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8xOwogCQlicmVhazsKIAlj
YXNlIEVEUF9QUkVFTVBIQVNJU182ZEI6Ci0JCWRldl9wcml2LT52YnQuZWRwLnByZWVtcGhhc2lz
ID0gRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxfMjsKKwkJaTkxNS0+dmJ0LmVkcC5wcmVlbXBoYXNp
cyA9IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzI7CiAJCWJyZWFrOwogCWNhc2UgRURQX1BSRUVN
UEhBU0lTXzlfNWRCOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5wcmVlbXBoYXNpcyA9IERQX1RSQUlO
X1BSRV9FTVBIX0xFVkVMXzM7CisJCWk5MTUtPnZidC5lZHAucHJlZW1waGFzaXMgPSBEUF9UUkFJ
Tl9QUkVfRU1QSF9MRVZFTF8zOwogCQlicmVhazsKIAlkZWZhdWx0OgotCQlkcm1fZGJnX2ttcygm
ZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAiVkJUIGhh
cyB1bmtub3duIGVEUCBwcmUtZW1waGFzaXMgdmFsdWUgJXVcbiIsCiAJCQkgICAgZWRwX2xpbmtf
cGFyYW1zLT5wcmVlbXBoYXNpcyk7CiAJCWJyZWFrOwpAQCAtODM2LDE5ICs4MzYsMTkgQEAgcGFy
c2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3Qgc3RydWN0IGJk
Yl9oZWFkZXIgKmJkYikKIAogCXN3aXRjaCAoZWRwX2xpbmtfcGFyYW1zLT52c3dpbmcpIHsKIAlj
YXNlIEVEUF9WU1dJTkdfMF80VjoKLQkJZGV2X3ByaXYtPnZidC5lZHAudnN3aW5nID0gRFBfVFJB
SU5fVk9MVEFHRV9TV0lOR19MRVZFTF8wOworCQlpOTE1LT52YnQuZWRwLnZzd2luZyA9IERQX1RS
QUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMDsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfVlNXSU5HXzBf
NlY6Ci0JCWRldl9wcml2LT52YnQuZWRwLnZzd2luZyA9IERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdf
TEVWRUxfMTsKKwkJaTkxNS0+dmJ0LmVkcC52c3dpbmcgPSBEUF9UUkFJTl9WT0xUQUdFX1NXSU5H
X0xFVkVMXzE7CiAJCWJyZWFrOwogCWNhc2UgRURQX1ZTV0lOR18wXzhWOgotCQlkZXZfcHJpdi0+
dmJ0LmVkcC52c3dpbmcgPSBEUF9UUkFJTl9WT0xUQUdFX1NXSU5HX0xFVkVMXzI7CisJCWk5MTUt
PnZidC5lZHAudnN3aW5nID0gRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8yOwogCQlicmVh
azsKIAljYXNlIEVEUF9WU1dJTkdfMV8yVjoKLQkJZGV2X3ByaXYtPnZidC5lZHAudnN3aW5nID0g
RFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8zOworCQlpOTE1LT52YnQuZWRwLnZzd2luZyA9
IERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMzsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJ
CQkgICAgIlZCVCBoYXMgdW5rbm93biBlRFAgdm9sdGFnZSBzd2luZyB2YWx1ZSAldVxuIiwKIAkJ
CSAgICBlZHBfbGlua19wYXJhbXMtPnZzd2luZyk7CiAJCWJyZWFrOwpAQCAtODU4LDUzICs4NTgs
NTMgQEAgcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3Qg
c3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAkJdTggdnN3aW5nOwogCiAJCS8qIERvbid0IHJlYWQg
ZnJvbSBWQlQgaWYgbW9kdWxlIHBhcmFtZXRlciBoYXMgdmFsaWQgdmFsdWUqLwotCQlpZiAoZGV2
X3ByaXYtPnBhcmFtcy5lZHBfdnN3aW5nKSB7Ci0JCQlkZXZfcHJpdi0+dmJ0LmVkcC5sb3dfdnN3
aW5nID0KLQkJCQlkZXZfcHJpdi0+cGFyYW1zLmVkcF92c3dpbmcgPT0gMTsKKwkJaWYgKGk5MTUt
PnBhcmFtcy5lZHBfdnN3aW5nKSB7CisJCQlpOTE1LT52YnQuZWRwLmxvd192c3dpbmcgPQorCQkJ
CWk5MTUtPnBhcmFtcy5lZHBfdnN3aW5nID09IDE7CiAJCX0gZWxzZSB7CiAJCQl2c3dpbmcgPSAo
ZWRwLT5lZHBfdnN3aW5nX3ByZWVtcGggPj4gKHBhbmVsX3R5cGUgKiA0KSkgJiAweEY7Ci0JCQlk
ZXZfcHJpdi0+dmJ0LmVkcC5sb3dfdnN3aW5nID0gdnN3aW5nID09IDA7CisJCQlpOTE1LT52YnQu
ZWRwLmxvd192c3dpbmcgPSB2c3dpbmcgPT0gMDsKIAkJfQogCX0KIH0KIAogc3RhdGljIHZvaWQK
LXBhcnNlX3BzcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGNvbnN0IHN0cnVj
dCBiZGJfaGVhZGVyICpiZGIpCitwYXJzZV9wc3Ioc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7CiAJY29uc3Qgc3RydWN0IGJkYl9w
c3IgKnBzcjsKIAljb25zdCBzdHJ1Y3QgcHNyX3RhYmxlICpwc3JfdGFibGU7Ci0JaW50IHBhbmVs
X3R5cGUgPSBkZXZfcHJpdi0+dmJ0LnBhbmVsX3R5cGU7CisJaW50IHBhbmVsX3R5cGUgPSBpOTE1
LT52YnQucGFuZWxfdHlwZTsKIAogCXBzciA9IGZpbmRfc2VjdGlvbihiZGIsIEJEQl9QU1IpOwog
CWlmICghcHNyKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiTm8gUFNSIEJEQiBm
b3VuZC5cbiIpOworCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiTm8gUFNSIEJEQiBmb3VuZC5c
biIpOwogCQlyZXR1cm47CiAJfQogCiAJcHNyX3RhYmxlID0gJnBzci0+cHNyX3RhYmxlW3BhbmVs
X3R5cGVdOwogCi0JZGV2X3ByaXYtPnZidC5wc3IuZnVsbF9saW5rID0gcHNyX3RhYmxlLT5mdWxs
X2xpbms7Ci0JZGV2X3ByaXYtPnZidC5wc3IucmVxdWlyZV9hdXhfd2FrZXVwID0gcHNyX3RhYmxl
LT5yZXF1aXJlX2F1eF90b193YWtldXA7CisJaTkxNS0+dmJ0LnBzci5mdWxsX2xpbmsgPSBwc3Jf
dGFibGUtPmZ1bGxfbGluazsKKwlpOTE1LT52YnQucHNyLnJlcXVpcmVfYXV4X3dha2V1cCA9IHBz
cl90YWJsZS0+cmVxdWlyZV9hdXhfdG9fd2FrZXVwOwogCiAJLyogQWxsb3dlZCBWQlQgdmFsdWVz
IGdvZXMgZnJvbSAwIHRvIDE1ICovCi0JZGV2X3ByaXYtPnZidC5wc3IuaWRsZV9mcmFtZXMgPSBw
c3JfdGFibGUtPmlkbGVfZnJhbWVzIDwgMCA/IDAgOgorCWk5MTUtPnZidC5wc3IuaWRsZV9mcmFt
ZXMgPSBwc3JfdGFibGUtPmlkbGVfZnJhbWVzIDwgMCA/IDAgOgogCQlwc3JfdGFibGUtPmlkbGVf
ZnJhbWVzID4gMTUgPyAxNSA6IHBzcl90YWJsZS0+aWRsZV9mcmFtZXM7CiAKIAlzd2l0Y2ggKHBz
cl90YWJsZS0+bGluZXNfdG9fd2FpdCkgewogCWNhc2UgMDoKLQkJZGV2X3ByaXYtPnZidC5wc3Iu
bGluZXNfdG9fd2FpdCA9IFBTUl8wX0xJTkVTX1RPX1dBSVQ7CisJCWk5MTUtPnZidC5wc3IubGlu
ZXNfdG9fd2FpdCA9IFBTUl8wX0xJTkVTX1RPX1dBSVQ7CiAJCWJyZWFrOwogCWNhc2UgMToKLQkJ
ZGV2X3ByaXYtPnZidC5wc3IubGluZXNfdG9fd2FpdCA9IFBTUl8xX0xJTkVfVE9fV0FJVDsKKwkJ
aTkxNS0+dmJ0LnBzci5saW5lc190b193YWl0ID0gUFNSXzFfTElORV9UT19XQUlUOwogCQlicmVh
azsKIAljYXNlIDI6Ci0JCWRldl9wcml2LT52YnQucHNyLmxpbmVzX3RvX3dhaXQgPSBQU1JfNF9M
SU5FU19UT19XQUlUOworCQlpOTE1LT52YnQucHNyLmxpbmVzX3RvX3dhaXQgPSBQU1JfNF9MSU5F
U19UT19XQUlUOwogCQlicmVhazsKIAljYXNlIDM6Ci0JCWRldl9wcml2LT52YnQucHNyLmxpbmVz
X3RvX3dhaXQgPSBQU1JfOF9MSU5FU19UT19XQUlUOworCQlpOTE1LT52YnQucHNyLmxpbmVzX3Rv
X3dhaXQgPSBQU1JfOF9MSU5FU19UT19XQUlUOwogCQlicmVhazsKIAlkZWZhdWx0OgotCQlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAg
ICAiVkJUIGhhcyB1bmtub3duIFBTUiBsaW5lcyB0byB3YWl0ICV1XG4iLAogCQkJICAgIHBzcl90
YWJsZS0+bGluZXNfdG9fd2FpdCk7CiAJCWJyZWFrOwpAQCAtOTE1LDUwICs5MTUsNTAgQEAgcGFy
c2VfcHNyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3Qgc3RydWN0IGJk
Yl9oZWFkZXIgKmJkYikKIAkgKiBPbGQgZGVjaW1hbCB2YWx1ZSBpcyB3YWtlIHVwIHRpbWUgaW4g
bXVsdGlwbGVzIG9mIDEwMCB1cy4KIAkgKi8KIAlpZiAoYmRiLT52ZXJzaW9uID49IDIwNSAmJgot
CSAgICAoSVNfR0VOOV9CQyhkZXZfcHJpdikgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwK
LQkgICAgIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApKSB7CisJICAgIChJU19HRU45X0JDKGk5
MTUpIHx8IElTX0dFTUlOSUxBS0UoaTkxNSkgfHwKKwkgICAgIElOVEVMX0dFTihpOTE1KSA+PSAx
MCkpIHsKIAkJc3dpdGNoIChwc3JfdGFibGUtPnRwMV93YWtldXBfdGltZSkgewogCQljYXNlIDA6
Ci0JCQlkZXZfcHJpdi0+dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMgPSA1MDA7CisJCQlpOTE1
LT52YnQucHNyLnRwMV93YWtldXBfdGltZV91cyA9IDUwMDsKIAkJCWJyZWFrOwogCQljYXNlIDE6
Ci0JCQlkZXZfcHJpdi0+dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMgPSAxMDA7CisJCQlpOTE1
LT52YnQucHNyLnRwMV93YWtldXBfdGltZV91cyA9IDEwMDsKIAkJCWJyZWFrOwogCQljYXNlIDM6
Ci0JCQlkZXZfcHJpdi0+dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMgPSAwOworCQkJaTkxNS0+
dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMgPSAwOwogCQkJYnJlYWs7CiAJCWRlZmF1bHQ6Ci0J
CQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0s
CiAJCQkJICAgICJWQlQgdHAxIHdha2V1cCB0aW1lIHZhbHVlICVkIGlzIG91dHNpZGUgcmFuZ2Vb
MC0zXSwgZGVmYXVsdGluZyB0byBtYXggdmFsdWUgMjUwMHVzXG4iLAogCQkJCSAgICBwc3JfdGFi
bGUtPnRwMV93YWtldXBfdGltZSk7CiAJCQlmYWxsdGhyb3VnaDsKIAkJY2FzZSAyOgotCQkJZGV2
X3ByaXYtPnZidC5wc3IudHAxX3dha2V1cF90aW1lX3VzID0gMjUwMDsKKwkJCWk5MTUtPnZidC5w
c3IudHAxX3dha2V1cF90aW1lX3VzID0gMjUwMDsKIAkJCWJyZWFrOwogCQl9CiAKIAkJc3dpdGNo
IChwc3JfdGFibGUtPnRwMl90cDNfd2FrZXVwX3RpbWUpIHsKIAkJY2FzZSAwOgotCQkJZGV2X3By
aXYtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IDUwMDsKKwkJCWk5MTUtPnZidC5w
c3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IDUwMDsKIAkJCWJyZWFrOwogCQljYXNlIDE6Ci0J
CQlkZXZfcHJpdi0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1lX3VzID0gMTAwOworCQkJaTkx
NS0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1lX3VzID0gMTAwOwogCQkJYnJlYWs7CiAJCWNh
c2UgMzoKLQkJCWRldl9wcml2LT52YnQucHNyLnRwMl90cDNfd2FrZXVwX3RpbWVfdXMgPSAwOwor
CQkJaTkxNS0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1lX3VzID0gMDsKIAkJCWJyZWFrOwog
CQlkZWZhdWx0OgotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQlkcm1fZGJnX2tt
cygmaTkxNS0+ZHJtLAogCQkJCSAgICAiVkJUIHRwMl90cDMgd2FrZXVwIHRpbWUgdmFsdWUgJWQg
aXMgb3V0c2lkZSByYW5nZVswLTNdLCBkZWZhdWx0aW5nIHRvIG1heCB2YWx1ZSAyNTAwdXNcbiIs
CiAJCQkJICAgIHBzcl90YWJsZS0+dHAyX3RwM193YWtldXBfdGltZSk7CiAJCQlmYWxsdGhyb3Vn
aDsKIAkJY2FzZSAyOgotCQkJZGV2X3ByaXYtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGltZV91
cyA9IDI1MDA7CisJCQlpOTE1LT52YnQucHNyLnRwMl90cDNfd2FrZXVwX3RpbWVfdXMgPSAyNTAw
OwogCQlicmVhazsKIAkJfQogCX0gZWxzZSB7Ci0JCWRldl9wcml2LT52YnQucHNyLnRwMV93YWtl
dXBfdGltZV91cyA9IHBzcl90YWJsZS0+dHAxX3dha2V1cF90aW1lICogMTAwOwotCQlkZXZfcHJp
di0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1lX3VzID0gcHNyX3RhYmxlLT50cDJfdHAzX3dh
a2V1cF90aW1lICogMTAwOworCQlpOTE1LT52YnQucHNyLnRwMV93YWtldXBfdGltZV91cyA9IHBz
cl90YWJsZS0+dHAxX3dha2V1cF90aW1lICogMTAwOworCQlpOTE1LT52YnQucHNyLnRwMl90cDNf
d2FrZXVwX3RpbWVfdXMgPSBwc3JfdGFibGUtPnRwMl90cDNfd2FrZXVwX3RpbWUgKiAxMDA7CiAJ
fQogCiAJaWYgKGJkYi0+dmVyc2lvbiA+PSAyMjYpIHsKQEAgLTk4MCw3NCArOTgwLDc0IEBAIHBh
cnNlX3BzcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGNvbnN0IHN0cnVjdCBi
ZGJfaGVhZGVyICpiZGIpCiAJCQl3YWtldXBfdGltZSA9IDI1MDA7CiAJCQlicmVhazsKIAkJfQot
CQlkZXZfcHJpdi0+dmJ0LnBzci5wc3IyX3RwMl90cDNfd2FrZXVwX3RpbWVfdXMgPSB3YWtldXBf
dGltZTsKKwkJaTkxNS0+dmJ0LnBzci5wc3IyX3RwMl90cDNfd2FrZXVwX3RpbWVfdXMgPSB3YWtl
dXBfdGltZTsKIAl9IGVsc2UgewogCQkvKiBSZXVzaW5nIFBTUjEgd2FrZXVwIHRpbWUgZm9yIFBT
UjIgaW4gb2xkZXIgVkJUcyAqLwotCQlkZXZfcHJpdi0+dmJ0LnBzci5wc3IyX3RwMl90cDNfd2Fr
ZXVwX3RpbWVfdXMgPSBkZXZfcHJpdi0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1lX3VzOwor
CQlpOTE1LT52YnQucHNyLnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA9IGk5MTUtPnZidC5w
c3IudHAyX3RwM193YWtldXBfdGltZV91czsKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIHBhcnNlX2Rz
aV9iYWNrbGlnaHRfcG9ydHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3Rh
dGljIHZvaWQgcGFyc2VfZHNpX2JhY2tsaWdodF9wb3J0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCQkgICAgICB1MTYgdmVyc2lvbiwgZW51bSBwb3J0IHBvcnQpCiB7Ci0JaWYg
KCFkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPmR1YWxfbGluayB8fCB2ZXJzaW9uIDwgMTk3KSB7
Ci0JCWRldl9wcml2LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKHBvcnQpOwotCQlpZiAoZGV2X3By
aXYtPnZidC5kc2kuY29uZmlnLT5jYWJjX3N1cHBvcnRlZCkKLQkJCWRldl9wcml2LT52YnQuZHNp
LmNhYmNfcG9ydHMgPSBCSVQocG9ydCk7CisJaWYgKCFpOTE1LT52YnQuZHNpLmNvbmZpZy0+ZHVh
bF9saW5rIHx8IHZlcnNpb24gPCAxOTcpIHsKKwkJaTkxNS0+dmJ0LmRzaS5ibF9wb3J0cyA9IEJJ
VChwb3J0KTsKKwkJaWYgKGk5MTUtPnZidC5kc2kuY29uZmlnLT5jYWJjX3N1cHBvcnRlZCkKKwkJ
CWk5MTUtPnZidC5kc2kuY2FiY19wb3J0cyA9IEJJVChwb3J0KTsKIAogCQlyZXR1cm47CiAJfQog
Ci0Jc3dpdGNoIChkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPmRsX2Rjc19iYWNrbGlnaHRfcG9y
dHMpIHsKKwlzd2l0Y2ggKGk5MTUtPnZidC5kc2kuY29uZmlnLT5kbF9kY3NfYmFja2xpZ2h0X3Bv
cnRzKSB7CiAJY2FzZSBETF9EQ1NfUE9SVF9BOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5ibF9wb3J0
cyA9IEJJVChQT1JUX0EpOworCQlpOTE1LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKFBPUlRfQSk7
CiAJCWJyZWFrOwogCWNhc2UgRExfRENTX1BPUlRfQzoKLQkJZGV2X3ByaXYtPnZidC5kc2kuYmxf
cG9ydHMgPSBCSVQoUE9SVF9DKTsKKwkJaTkxNS0+dmJ0LmRzaS5ibF9wb3J0cyA9IEJJVChQT1JU
X0MpOwogCQlicmVhazsKIAlkZWZhdWx0OgogCWNhc2UgRExfRENTX1BPUlRfQV9BTkRfQzoKLQkJ
ZGV2X3ByaXYtPnZidC5kc2kuYmxfcG9ydHMgPSBCSVQoUE9SVF9BKSB8IEJJVChQT1JUX0MpOwor
CQlpOTE1LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKFBPUlRfQSkgfCBCSVQoUE9SVF9DKTsKIAkJ
YnJlYWs7CiAJfQogCi0JaWYgKCFkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPmNhYmNfc3VwcG9y
dGVkKQorCWlmICghaTkxNS0+dmJ0LmRzaS5jb25maWctPmNhYmNfc3VwcG9ydGVkKQogCQlyZXR1
cm47CiAKLQlzd2l0Y2ggKGRldl9wcml2LT52YnQuZHNpLmNvbmZpZy0+ZGxfZGNzX2NhYmNfcG9y
dHMpIHsKKwlzd2l0Y2ggKGk5MTUtPnZidC5kc2kuY29uZmlnLT5kbF9kY3NfY2FiY19wb3J0cykg
ewogCWNhc2UgRExfRENTX1BPUlRfQToKLQkJZGV2X3ByaXYtPnZidC5kc2kuY2FiY19wb3J0cyA9
IEJJVChQT1JUX0EpOworCQlpOTE1LT52YnQuZHNpLmNhYmNfcG9ydHMgPSBCSVQoUE9SVF9BKTsK
IAkJYnJlYWs7CiAJY2FzZSBETF9EQ1NfUE9SVF9DOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5jYWJj
X3BvcnRzID0gQklUKFBPUlRfQyk7CisJCWk5MTUtPnZidC5kc2kuY2FiY19wb3J0cyA9IEJJVChQ
T1JUX0MpOwogCQlicmVhazsKIAlkZWZhdWx0OgogCWNhc2UgRExfRENTX1BPUlRfQV9BTkRfQzoK
LQkJZGV2X3ByaXYtPnZidC5kc2kuY2FiY19wb3J0cyA9CisJCWk5MTUtPnZidC5kc2kuY2FiY19w
b3J0cyA9CiAJCQkJCUJJVChQT1JUX0EpIHwgQklUKFBPUlRfQyk7CiAJCWJyZWFrOwogCX0KIH0K
IAogc3RhdGljIHZvaWQKLXBhcnNlX21pcGlfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3BhcnNlX21pcGlfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkgIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7CiAJY29uc3Qgc3RydWN0
IGJkYl9taXBpX2NvbmZpZyAqc3RhcnQ7CiAJY29uc3Qgc3RydWN0IG1pcGlfY29uZmlnICpjb25m
aWc7CiAJY29uc3Qgc3RydWN0IG1pcGlfcHBzX2RhdGEgKnBwczsKLQlpbnQgcGFuZWxfdHlwZSA9
IGRldl9wcml2LT52YnQucGFuZWxfdHlwZTsKKwlpbnQgcGFuZWxfdHlwZSA9IGk5MTUtPnZidC5w
YW5lbF90eXBlOwogCWVudW0gcG9ydCBwb3J0OwogCiAJLyogcGFyc2UgTUlQSSBibG9ja3Mgb25s
eSBpZiBMRlAgdHlwZSBpcyBNSVBJICovCi0JaWYgKCFpbnRlbF9iaW9zX2lzX2RzaV9wcmVzZW50
KGRldl9wcml2LCAmcG9ydCkpCisJaWYgKCFpbnRlbF9iaW9zX2lzX2RzaV9wcmVzZW50KGk5MTUs
ICZwb3J0KSkKIAkJcmV0dXJuOwogCiAJLyogSW5pdGlhbGl6ZSB0aGlzIHRvIHVuZGVmaW5lZCBp
bmRpY2F0aW5nIG5vIGdlbmVyaWMgTUlQSSBzdXBwb3J0ICovCi0JZGV2X3ByaXYtPnZidC5kc2ku
cGFuZWxfaWQgPSBNSVBJX0RTSV9VTkRFRklORURfUEFORUxfSUQ7CisJaTkxNS0+dmJ0LmRzaS5w
YW5lbF9pZCA9IE1JUElfRFNJX1VOREVGSU5FRF9QQU5FTF9JRDsKIAogCS8qIEJsb2NrICM0MCBp
cyBhbHJlYWR5IHBhcnNlZCBhbmQgcGFuZWxfZml4ZWRfbW9kZSBpcwotCSAqIHN0b3JlZCBpbiBk
ZXZfcHJpdi0+bGZwX2x2ZHNfdmJ0X21vZGUKKwkgKiBzdG9yZWQgaW4gaTkxNS0+bGZwX2x2ZHNf
dmJ0X21vZGUKIAkgKiByZXN1c2UgdGhpcyB3aGVuIG5lZWRlZAogCSAqLwogCkBAIC0xMDU2LDEx
ICsxMDU2LDExIEBAIHBhcnNlX21pcGlfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkgKi8KIAlzdGFydCA9IGZpbmRfc2VjdGlvbihiZGIsIEJEQl9NSVBJX0NPTkZJ
Ryk7CiAJaWYgKCFzdGFydCkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIk5vIE1J
UEkgY29uZmlnIEJEQiBmb3VuZCIpOworCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiTm8gTUlQ
SSBjb25maWcgQkRCIGZvdW5kIik7CiAJCXJldHVybjsKIAl9CiAKLQlkcm1fZGJnKCZkZXZfcHJp
di0+ZHJtLCAiRm91bmQgTUlQSSBDb25maWcgYmxvY2ssIHBhbmVsIGluZGV4ID0gJWRcbiIsCisJ
ZHJtX2RiZygmaTkxNS0+ZHJtLCAiRm91bmQgTUlQSSBDb25maWcgYmxvY2ssIHBhbmVsIGluZGV4
ID0gJWRcbiIsCiAJCXBhbmVsX3R5cGUpOwogCiAJLyoKQEAgLTEwNzEsMTcgKzEwNzEsMTcgQEAg
cGFyc2VfbWlwaV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXBw
cyA9ICZzdGFydC0+cHBzW3BhbmVsX3R5cGVdOwogCiAJLyogc3RvcmUgYXMgb2Ygbm93IGZ1bGwg
ZGF0YS4gVHJpbSB3aGVuIHdlIHJlYWxpc2UgYWxsIGlzIG5vdCBuZWVkZWQgKi8KLQlkZXZfcHJp
di0+dmJ0LmRzaS5jb25maWcgPSBrbWVtZHVwKGNvbmZpZywgc2l6ZW9mKHN0cnVjdCBtaXBpX2Nv
bmZpZyksIEdGUF9LRVJORUwpOwotCWlmICghZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnKQorCWk5
MTUtPnZidC5kc2kuY29uZmlnID0ga21lbWR1cChjb25maWcsIHNpemVvZihzdHJ1Y3QgbWlwaV9j
b25maWcpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWk5MTUtPnZidC5kc2kuY29uZmlnKQogCQlyZXR1
cm47CiAKLQlkZXZfcHJpdi0+dmJ0LmRzaS5wcHMgPSBrbWVtZHVwKHBwcywgc2l6ZW9mKHN0cnVj
dCBtaXBpX3Bwc19kYXRhKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFkZXZfcHJpdi0+dmJ0LmRzaS5w
cHMpIHsKLQkJa2ZyZWUoZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnKTsKKwlpOTE1LT52YnQuZHNp
LnBwcyA9IGttZW1kdXAocHBzLCBzaXplb2Yoc3RydWN0IG1pcGlfcHBzX2RhdGEpLCBHRlBfS0VS
TkVMKTsKKwlpZiAoIWk5MTUtPnZidC5kc2kucHBzKSB7CisJCWtmcmVlKGk5MTUtPnZidC5kc2ku
Y29uZmlnKTsKIAkJcmV0dXJuOwogCX0KIAotCXBhcnNlX2RzaV9iYWNrbGlnaHRfcG9ydHMoZGV2
X3ByaXYsIGJkYi0+dmVyc2lvbiwgcG9ydCk7CisJcGFyc2VfZHNpX2JhY2tsaWdodF9wb3J0cyhp
OTE1LCBiZGItPnZlcnNpb24sIHBvcnQpOwogCiAJLyogRklYTUUgaXMgdGhlIDkwIHZzLiAyNzAg
Y29ycmVjdD8gKi8KIAlzd2l0Y2ggKGNvbmZpZy0+cm90YXRpb24pIHsKQEAgLTEwOTAsMjUgKzEw
OTAsMjUgQEAgcGFyc2VfbWlwaV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQkgKiBNb3N0IChhbGw/KSBWQlRzIGNsYWltIDAgZGVncmVlcyBkZXNwaXRlIGhhdmlu
ZwogCQkgKiBhbiB1cHNpZGUgZG93biBwYW5lbCwgdGh1cyB3ZSBkbyBub3QgdHJ1c3QgdGhpcy4K
IAkJICovCi0JCWRldl9wcml2LT52YnQuZHNpLm9yaWVudGF0aW9uID0KKwkJaTkxNS0+dmJ0LmRz
aS5vcmllbnRhdGlvbiA9CiAJCQlEUk1fTU9ERV9QQU5FTF9PUklFTlRBVElPTl9VTktOT1dOOwog
CQlicmVhazsKIAljYXNlIEVOQUJMRV9ST1RBVElPTl85MDoKLQkJZGV2X3ByaXYtPnZidC5kc2ku
b3JpZW50YXRpb24gPQorCQlpOTE1LT52YnQuZHNpLm9yaWVudGF0aW9uID0KIAkJCURSTV9NT0RF
X1BBTkVMX09SSUVOVEFUSU9OX1JJR0hUX1VQOwogCQlicmVhazsKIAljYXNlIEVOQUJMRV9ST1RB
VElPTl8xODA6Ci0JCWRldl9wcml2LT52YnQuZHNpLm9yaWVudGF0aW9uID0KKwkJaTkxNS0+dmJ0
LmRzaS5vcmllbnRhdGlvbiA9CiAJCQlEUk1fTU9ERV9QQU5FTF9PUklFTlRBVElPTl9CT1RUT01f
VVA7CiAJCWJyZWFrOwogCWNhc2UgRU5BQkxFX1JPVEFUSU9OXzI3MDoKLQkJZGV2X3ByaXYtPnZi
dC5kc2kub3JpZW50YXRpb24gPQorCQlpOTE1LT52YnQuZHNpLm9yaWVudGF0aW9uID0KIAkJCURS
TV9NT0RFX1BBTkVMX09SSUVOVEFUSU9OX0xFRlRfVVA7CiAJCWJyZWFrOwogCX0KIAogCS8qIFdl
IGhhdmUgbWFuZGF0b3J5IG1pcGkgY29uZmlnIGJsb2Nrcy4gSW5pdGlhbGl6ZSBhcyBnZW5lcmlj
IHBhbmVsICovCi0JZGV2X3ByaXYtPnZidC5kc2kucGFuZWxfaWQgPSBNSVBJX0RTSV9HRU5FUklD
X1BBTkVMX0lEOworCWk5MTUtPnZidC5kc2kucGFuZWxfaWQgPSBNSVBJX0RTSV9HRU5FUklDX1BB
TkVMX0lEOwogfQogCiAvKiBGaW5kIHRoZSBzZXF1ZW5jZSBibG9jayBhbmQgc2l6ZSBmb3IgdGhl
IGdpdmVuIHBhbmVsLiAqLwpAQCAtMTI3MSwxMyArMTI3MSwxMyBAQCBzdGF0aWMgaW50IGdvdG9f
bmV4dF9zZXF1ZW5jZV92Myhjb25zdCB1OCAqZGF0YSwgaW50IGluZGV4LCBpbnQgdG90YWwpCiAg
KiBHZXQgbGVuIG9mIHByZS1maXhlZCBkZWFzc2VydCBmcmFnbWVudCBmcm9tIGEgdjEgaW5pdCBP
VFAgc2VxdWVuY2UsCiAgKiBza2lwIGFsbCBkZWxheSArIGdwaW8gb3BlcmFuZHMgYW5kIHN0b3Ag
YXQgdGhlIGZpcnN0IERTSSBwYWNrZXQgb3AuCiAgKi8KLXN0YXRpYyBpbnQgZ2V0X2luaXRfb3Rw
X2RlYXNzZXJ0X2ZyYWdtZW50X2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgaW50IGdldF9pbml0X290cF9kZWFzc2VydF9mcmFnbWVudF9sZW4oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JY29uc3QgdTggKmRhdGEgPSBkZXZfcHJpdi0+dmJ0
LmRzaS5zZXF1ZW5jZVtNSVBJX1NFUV9JTklUX09UUF07CisJY29uc3QgdTggKmRhdGEgPSBpOTE1
LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0lOSVRfT1RQXTsKIAlpbnQgaW5kZXgsIGxlbjsK
IAotCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwKLQkJCSFkYXRhIHx8IGRldl9wcml2
LT52YnQuZHNpLnNlcV92ZXJzaW9uICE9IDEpKQorCWlmIChkcm1fV0FSTl9PTigmaTkxNS0+ZHJt
LAorCQkJIWRhdGEgfHwgaTkxNS0+dmJ0LmRzaS5zZXFfdmVyc2lvbiAhPSAxKSkKIAkJcmV0dXJu
IDA7CiAKIAkvKiBpbmRleCA9IDEgdG8gc2tpcCBzZXF1ZW5jZSBieXRlICovCkBAIC0xMzA1LDU1
ICsxMzA1LDU1IEBAIHN0YXRpYyBpbnQgZ2V0X2luaXRfb3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xl
bihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAgKiB0aGVzZSBkZXZpY2VzIHdl
IHNwbGl0IHRoZSBpbml0IE9UUCBzZXF1ZW5jZSBpbnRvIGEgZGVhc3NlcnQgc2VxdWVuY2UgYW5k
CiAgKiB0aGUgYWN0dWFsIGluaXQgT1RQIHBhcnQuCiAgKi8KLXN0YXRpYyB2b2lkIGZpeHVwX21p
cGlfc2VxdWVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2
b2lkIGZpeHVwX21pcGlfc2VxdWVuY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewogCXU4ICppbml0X290cDsKIAlpbnQgbGVuOwogCiAJLyogTGltaXQgdGhpcyB0byBWTFYgZm9y
IG5vdy4gKi8KLQlpZiAoIUlTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQorCWlmICghSVNfVkFMTEVZ
VklFVyhpOTE1KSkKIAkJcmV0dXJuOwogCiAJLyogTGltaXQgdGhpcyB0byB2MSB2aWQtbW9kZSBz
ZXF1ZW5jZXMgKi8KLQlpZiAoZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnLT5pc19jbWRfbW9kZSB8
fAotCSAgICBkZXZfcHJpdi0+dmJ0LmRzaS5zZXFfdmVyc2lvbiAhPSAxKQorCWlmIChpOTE1LT52
YnQuZHNpLmNvbmZpZy0+aXNfY21kX21vZGUgfHwKKwkgICAgaTkxNS0+dmJ0LmRzaS5zZXFfdmVy
c2lvbiAhPSAxKQogCQlyZXR1cm47CiAKIAkvKiBPbmx5IGRvIHRoaXMgaWYgdGhlcmUgYXJlIG90
cCBhbmQgYXNzZXJ0IHNlcXMgYW5kIG5vIGRlYXNzZXJ0IHNlcSAqLwotCWlmICghZGV2X3ByaXYt
PnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdIHx8Ci0JICAgICFkZXZfcHJpdi0+
dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJX1NFUV9BU1NFUlRfUkVTRVRdIHx8Ci0JICAgIGRldl9wcml2
LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0RFQVNTRVJUX1JFU0VUXSkKKwlpZiAoIWk5MTUt
PnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdIHx8CisJICAgICFpOTE1LT52YnQu
ZHNpLnNlcXVlbmNlW01JUElfU0VRX0FTU0VSVF9SRVNFVF0gfHwKKwkgICAgaTkxNS0+dmJ0LmRz
aS5zZXF1ZW5jZVtNSVBJX1NFUV9ERUFTU0VSVF9SRVNFVF0pCiAJCXJldHVybjsKIAogCS8qIFRo
ZSBkZWFzc2VydC1zZXF1ZW5jZSBlbmRzIGF0IHRoZSBmaXJzdCBEU0kgcGFja2V0ICovCi0JbGVu
ID0gZ2V0X2luaXRfb3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xlbihkZXZfcHJpdik7CisJbGVuID0g
Z2V0X2luaXRfb3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xlbihpOTE1KTsKIAlpZiAoIWxlbikKIAkJ
cmV0dXJuOwogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJZHJtX2RiZ19rbXMoJmk5
MTUtPmRybSwKIAkJICAgICJVc2luZyBpbml0IE9UUCBmcmFnbWVudCB0byBkZWFzc2VydCByZXNl
dFxuIik7CiAKIAkvKiBDb3B5IHRoZSBmcmFnbWVudCwgdXBkYXRlIHNlcSBieXRlIGFuZCB0ZXJt
aW5hdGUgaXQgKi8KLQlpbml0X290cCA9ICh1OCAqKWRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNl
W01JUElfU0VRX0lOSVRfT1RQXTsKLQlkZXZfcHJpdi0+dmJ0LmRzaS5kZWFzc2VydF9zZXEgPSBr
bWVtZHVwKGluaXRfb3RwLCBsZW4gKyAxLCBHRlBfS0VSTkVMKTsKLQlpZiAoIWRldl9wcml2LT52
YnQuZHNpLmRlYXNzZXJ0X3NlcSkKKwlpbml0X290cCA9ICh1OCAqKWk5MTUtPnZidC5kc2kuc2Vx
dWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdOworCWk5MTUtPnZidC5kc2kuZGVhc3NlcnRfc2VxID0g
a21lbWR1cChpbml0X290cCwgbGVuICsgMSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFpOTE1LT52YnQu
ZHNpLmRlYXNzZXJ0X3NlcSkKIAkJcmV0dXJuOwotCWRldl9wcml2LT52YnQuZHNpLmRlYXNzZXJ0
X3NlcVswXSA9IE1JUElfU0VRX0RFQVNTRVJUX1JFU0VUOwotCWRldl9wcml2LT52YnQuZHNpLmRl
YXNzZXJ0X3NlcVtsZW5dID0gTUlQSV9TRVFfRUxFTV9FTkQ7CisJaTkxNS0+dmJ0LmRzaS5kZWFz
c2VydF9zZXFbMF0gPSBNSVBJX1NFUV9ERUFTU0VSVF9SRVNFVDsKKwlpOTE1LT52YnQuZHNpLmRl
YXNzZXJ0X3NlcVtsZW5dID0gTUlQSV9TRVFfRUxFTV9FTkQ7CiAJLyogVXNlIHRoZSBjb3B5IGZv
ciBkZWFzc2VydCAqLwotCWRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0RFQVNT
RVJUX1JFU0VUXSA9Ci0JCWRldl9wcml2LT52YnQuZHNpLmRlYXNzZXJ0X3NlcTsKKwlpOTE1LT52
YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0RFQVNTRVJUX1JFU0VUXSA9CisJCWk5MTUtPnZidC5k
c2kuZGVhc3NlcnRfc2VxOwogCS8qIFJlcGxhY2UgdGhlIGxhc3QgYnl0ZSBvZiB0aGUgZnJhZ21l
bnQgd2l0aCBpbml0IE9UUCBzZXEgYnl0ZSAqLwogCWluaXRfb3RwW2xlbiAtIDFdID0gTUlQSV9T
RVFfSU5JVF9PVFA7CiAJLyogQW5kIG1ha2UgTUlQSV9NSVBJX1NFUV9JTklUX09UUCBwb2ludCB0
byBpdCAqLwotCWRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0lOSVRfT1RQXSA9
IGluaXRfb3RwICsgbGVuIC0gMTsKKwlpOTE1LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0lO
SVRfT1RQXSA9IGluaXRfb3RwICsgbGVuIC0gMTsKIH0KIAogc3RhdGljIHZvaWQKLXBhcnNlX21p
cGlfc2VxdWVuY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2VfbWlw
aV9zZXF1ZW5jZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgIGNvbnN0IHN0
cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7Ci0JaW50IHBhbmVsX3R5cGUgPSBkZXZfcHJpdi0+dmJ0
LnBhbmVsX3R5cGU7CisJaW50IHBhbmVsX3R5cGUgPSBpOTE1LT52YnQucGFuZWxfdHlwZTsKIAlj
b25zdCBzdHJ1Y3QgYmRiX21pcGlfc2VxdWVuY2UgKnNlcXVlbmNlOwogCWNvbnN0IHU4ICpzZXFf
ZGF0YTsKIAl1MzIgc2VxX3NpemU7CkBAIC0xMzYxLDI1ICsxMzYxLDI1IEBAIHBhcnNlX21pcGlf
c2VxdWVuY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWludCBpbmRleCA9
IDA7CiAKIAkvKiBPbmx5IG91ciBnZW5lcmljIHBhbmVsIGRyaXZlciB1c2VzIHRoZSBzZXF1ZW5j
ZSBibG9jay4gKi8KLQlpZiAoZGV2X3ByaXYtPnZidC5kc2kucGFuZWxfaWQgIT0gTUlQSV9EU0lf
R0VORVJJQ19QQU5FTF9JRCkKKwlpZiAoaTkxNS0+dmJ0LmRzaS5wYW5lbF9pZCAhPSBNSVBJX0RT
SV9HRU5FUklDX1BBTkVMX0lEKQogCQlyZXR1cm47CiAKIAlzZXF1ZW5jZSA9IGZpbmRfc2VjdGlv
bihiZGIsIEJEQl9NSVBJX1NFUVVFTkNFKTsKIAlpZiAoIXNlcXVlbmNlKSB7Ci0JCWRybV9kYmdf
a21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJO
byBNSVBJIFNlcXVlbmNlIGZvdW5kLCBwYXJzaW5nIGNvbXBsZXRlXG4iKTsKIAkJcmV0dXJuOwog
CX0KIAogCS8qIEZhaWwgZ3JhY2VmdWxseSBmb3IgZm9yd2FyZCBpbmNvbXBhdGlibGUgc2VxdWVu
Y2UgYmxvY2suICovCiAJaWYgKHNlcXVlbmNlLT52ZXJzaW9uID49IDQpIHsKLQkJZHJtX2Vycigm
ZGV2X3ByaXYtPmRybSwKKwkJZHJtX2VycigmaTkxNS0+ZHJtLAogCQkJIlVuYWJsZSB0byBwYXJz
ZSBNSVBJIFNlcXVlbmNlIEJsb2NrIHYldVxuIiwKIAkJCXNlcXVlbmNlLT52ZXJzaW9uKTsKIAkJ
cmV0dXJuOwogCX0KIAotCWRybV9kYmcoJmRldl9wcml2LT5kcm0sICJGb3VuZCBNSVBJIHNlcXVl
bmNlIGJsb2NrIHYldVxuIiwKKwlkcm1fZGJnKCZpOTE1LT5kcm0sICJGb3VuZCBNSVBJIHNlcXVl
bmNlIGJsb2NrIHYldVxuIiwKIAkJc2VxdWVuY2UtPnZlcnNpb24pOwogCiAJc2VxX2RhdGEgPSBm
aW5kX3BhbmVsX3NlcXVlbmNlX2Jsb2NrKHNlcXVlbmNlLCBwYW5lbF90eXBlLCAmc2VxX3NpemUp
OwpAQCAtMTM5Nyw0MSArMTM5Nyw0MSBAQCBwYXJzZV9taXBpX3NlcXVlbmNlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCWJyZWFrOwogCiAJCWlmIChzZXFfaWQgPj0gTUlQ
SV9TRVFfTUFYKSB7Ci0JCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAiVW5rbm93biBzZXF1ZW5j
ZSAldVxuIiwKKwkJCWRybV9lcnIoJmk5MTUtPmRybSwgIlVua25vd24gc2VxdWVuY2UgJXVcbiIs
CiAJCQkJc2VxX2lkKTsKIAkJCWdvdG8gZXJyOwogCQl9CiAKIAkJLyogTG9nIGFib3V0IHByZXNl
bmNlIG9mIHNlcXVlbmNlcyB3ZSB3b24ndCBydW4uICovCiAJCWlmIChzZXFfaWQgPT0gTUlQSV9T
RVFfVEVBUl9PTiB8fCBzZXFfaWQgPT0gTUlQSV9TRVFfVEVBUl9PRkYpCi0JCQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwKKwkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkJICAgICJV
bnN1cHBvcnRlZCBzZXF1ZW5jZSAldVxuIiwgc2VxX2lkKTsKIAotCQlkZXZfcHJpdi0+dmJ0LmRz
aS5zZXF1ZW5jZVtzZXFfaWRdID0gZGF0YSArIGluZGV4OworCQlpOTE1LT52YnQuZHNpLnNlcXVl
bmNlW3NlcV9pZF0gPSBkYXRhICsgaW5kZXg7CiAKIAkJaWYgKHNlcXVlbmNlLT52ZXJzaW9uID49
IDMpCiAJCQlpbmRleCA9IGdvdG9fbmV4dF9zZXF1ZW5jZV92MyhkYXRhLCBpbmRleCwgc2VxX3Np
emUpOwogCQllbHNlCiAJCQlpbmRleCA9IGdvdG9fbmV4dF9zZXF1ZW5jZShkYXRhLCBpbmRleCwg
c2VxX3NpemUpOwogCQlpZiAoIWluZGV4KSB7Ci0JCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAi
SW52YWxpZCBzZXF1ZW5jZSAldVxuIiwKKwkJCWRybV9lcnIoJmk5MTUtPmRybSwgIkludmFsaWQg
c2VxdWVuY2UgJXVcbiIsCiAJCQkJc2VxX2lkKTsKIAkJCWdvdG8gZXJyOwogCQl9CiAJfQogCi0J
ZGV2X3ByaXYtPnZidC5kc2kuZGF0YSA9IGRhdGE7Ci0JZGV2X3ByaXYtPnZidC5kc2kuc2l6ZSA9
IHNlcV9zaXplOwotCWRldl9wcml2LT52YnQuZHNpLnNlcV92ZXJzaW9uID0gc2VxdWVuY2UtPnZl
cnNpb247CisJaTkxNS0+dmJ0LmRzaS5kYXRhID0gZGF0YTsKKwlpOTE1LT52YnQuZHNpLnNpemUg
PSBzZXFfc2l6ZTsKKwlpOTE1LT52YnQuZHNpLnNlcV92ZXJzaW9uID0gc2VxdWVuY2UtPnZlcnNp
b247CiAKLQlmaXh1cF9taXBpX3NlcXVlbmNlcyhkZXZfcHJpdik7CisJZml4dXBfbWlwaV9zZXF1
ZW5jZXMoaTkxNSk7CiAKLQlkcm1fZGJnKCZkZXZfcHJpdi0+ZHJtLCAiTUlQSSByZWxhdGVkIFZC
VCBwYXJzaW5nIGNvbXBsZXRlXG4iKTsKKwlkcm1fZGJnKCZpOTE1LT5kcm0sICJNSVBJIHJlbGF0
ZWQgVkJUIHBhcnNpbmcgY29tcGxldGVcbiIpOwogCXJldHVybjsKIAogZXJyOgogCWtmcmVlKGRh
dGEpOwotCW1lbXNldChkZXZfcHJpdi0+dmJ0LmRzaS5zZXF1ZW5jZSwgMCwgc2l6ZW9mKGRldl9w
cml2LT52YnQuZHNpLnNlcXVlbmNlKSk7CisJbWVtc2V0KGk5MTUtPnZidC5kc2kuc2VxdWVuY2Us
IDAsIHNpemVvZihpOTE1LT52YnQuZHNpLnNlcXVlbmNlKSk7CiB9CiAKIHN0YXRpYyB2b2lkCkBA
IC0xNTE1LDE4ICsxNTE1LDE4IEBAIHN0YXRpYyBlbnVtIHBvcnQgZ2V0X3BvcnRfYnlfZGRjX3Bp
bihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTggZGRjX3BpbikKIAlyZXR1cm4gUE9S
VF9OT05FOwogfQogCi1zdGF0aWMgdm9pZCBzYW5pdGl6ZV9kZGNfcGluKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIHNhbml0aXplX2RkY19waW4oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgIGVudW0gcG9ydCBwb3J0KQogewotCXN0
cnVjdCBkZGlfdmJ0X3BvcnRfaW5mbyAqaW5mbyA9ICZkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2lu
Zm9bcG9ydF07CisJc3RydWN0IGRkaV92YnRfcG9ydF9pbmZvICppbmZvID0gJmk5MTUtPnZidC5k
ZGlfcG9ydF9pbmZvW3BvcnRdOwogCWVudW0gcG9ydCBwOwogCiAJaWYgKCFpbmZvLT5hbHRlcm5h
dGVfZGRjX3BpbikKIAkJcmV0dXJuOwogCi0JcCA9IGdldF9wb3J0X2J5X2RkY19waW4oZGV2X3By
aXYsIGluZm8tPmFsdGVybmF0ZV9kZGNfcGluKTsKKwlwID0gZ2V0X3BvcnRfYnlfZGRjX3Bpbihp
OTE1LCBpbmZvLT5hbHRlcm5hdGVfZGRjX3Bpbik7CiAJaWYgKHAgIT0gUE9SVF9OT05FKSB7Ci0J
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAog
CQkJICAgICJwb3J0ICVjIHRyeWluZyB0byB1c2UgdGhlIHNhbWUgRERDIHBpbiAoMHgleCkgYXMg
cG9ydCAlYywgIgogCQkJICAgICJkaXNhYmxpbmcgcG9ydCAlYyBEVkkvSERNSSBzdXBwb3J0XG4i
LAogCQkJICAgIHBvcnRfbmFtZShwb3J0KSwgaW5mby0+YWx0ZXJuYXRlX2RkY19waW4sCkBAIC0x
NTQ0LDcgKzE1NDQsNyBAQCBzdGF0aWMgdm9pZCBzYW5pdGl6ZV9kZGNfcGluKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJICogcG9ydCBBIGFuZCBwb3J0IEUgd2l0aCB0aGUg
c2FtZSBBVVggY2ggYW5kCiAJCSAqIHdlIG11c3QgcGljayBwb3J0IEUgOigKIAkJICovCi0JCWlu
Zm8gPSAmZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BdOworCQlpbmZvID0gJmk5MTUtPnZi
dC5kZGlfcG9ydF9pbmZvW3BdOwogCiAJCWluZm8tPnN1cHBvcnRzX2R2aSA9IGZhbHNlOwogCQlp
bmZvLT5zdXBwb3J0c19oZG1pID0gZmFsc2U7CkBAIC0xNTY3LDE4ICsxNTY3LDE4IEBAIHN0YXRp
YyBlbnVtIHBvcnQgZ2V0X3BvcnRfYnlfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LCB1OCBhdXhfY2gpCiAJcmV0dXJuIFBPUlRfTk9ORTsKIH0KIAotc3RhdGljIHZvaWQgc2Fu
aXRpemVfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2
b2lkIHNhbml0aXplX2F1eF9jaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAg
ICBlbnVtIHBvcnQgcG9ydCkKIHsKLQlzdHJ1Y3QgZGRpX3ZidF9wb3J0X2luZm8gKmluZm8gPSAm
ZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOworCXN0cnVjdCBkZGlfdmJ0X3BvcnRf
aW5mbyAqaW5mbyA9ICZpOTE1LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKIAllbnVtIHBvcnQg
cDsKIAogCWlmICghaW5mby0+YWx0ZXJuYXRlX2F1eF9jaGFubmVsKQogCQlyZXR1cm47CiAKLQlw
ID0gZ2V0X3BvcnRfYnlfYXV4X2NoKGRldl9wcml2LCBpbmZvLT5hbHRlcm5hdGVfYXV4X2NoYW5u
ZWwpOworCXAgPSBnZXRfcG9ydF9ieV9hdXhfY2goaTkxNSwgaW5mby0+YWx0ZXJuYXRlX2F1eF9j
aGFubmVsKTsKIAlpZiAocCAhPSBQT1JUX05PTkUpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2
LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgInBvcnQgJWMgdHJ5aW5n
IHRvIHVzZSB0aGUgc2FtZSBBVVggQ0ggKDB4JXgpIGFzIHBvcnQgJWMsICIKIAkJCSAgICAiZGlz
YWJsaW5nIHBvcnQgJWMgRFAgc3VwcG9ydFxuIiwKIAkJCSAgICBwb3J0X25hbWUocG9ydCksIGlu
Zm8tPmFsdGVybmF0ZV9hdXhfY2hhbm5lbCwKQEAgLTE1OTYsNyArMTU5Niw3IEBAIHN0YXRpYyB2
b2lkIHNhbml0aXplX2F1eF9jaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
CSAqIHBvcnQgQSBhbmQgcG9ydCBFIHdpdGggdGhlIHNhbWUgQVVYIGNoIGFuZAogCQkgKiB3ZSBt
dXN0IHBpY2sgcG9ydCBFIDooCiAJCSAqLwotCQlpbmZvID0gJmRldl9wcml2LT52YnQuZGRpX3Bv
cnRfaW5mb1twXTsKKwkJaW5mbyA9ICZpOTE1LT52YnQuZGRpX3BvcnRfaW5mb1twXTsKIAogCQlp
bmZvLT5zdXBwb3J0c19kcCA9IGZhbHNlOwogCQlpbmZvLT5hbHRlcm5hdGVfYXV4X2NoYW5uZWwg
PSAwOwpAQCAtMTY0NCwyNiArMTY0NCwyNiBAQCBzdGF0aWMgY29uc3QgdTggZ2VuOWJjX3RncF9k
ZGNfcGluX21hcFtdID0gewogCVtERENfQlVTX0RESV9EXSA9IEdNQlVTX1BJTl8xMF9UQzJfSUNQ
LAogfTsKIAotc3RhdGljIHU4IG1hcF9kZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgdTggdmJ0X3BpbikKK3N0YXRpYyB1OCBtYXBfZGRjX3BpbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgdTggdmJ0X3BpbikKIHsKIAljb25zdCB1OCAqZGRjX3Bpbl9tYXA7
CiAJaW50IG5fZW50cmllczsKIAotCWlmIChIQVNfUENIX0FEUChkZXZfcHJpdikpIHsKKwlpZiAo
SEFTX1BDSF9BRFAoaTkxNSkpIHsKIAkJZGRjX3Bpbl9tYXAgPSBhZGxzX2RkY19waW5fbWFwOwog
CQluX2VudHJpZXMgPSBBUlJBWV9TSVpFKGFkbHNfZGRjX3Bpbl9tYXApOwotCX0gZWxzZSBpZiAo
SU5URUxfUENIX1RZUEUoZGV2X3ByaXYpID49IFBDSF9ERzEpIHsKKwl9IGVsc2UgaWYgKElOVEVM
X1BDSF9UWVBFKGk5MTUpID49IFBDSF9ERzEpIHsKIAkJcmV0dXJuIHZidF9waW47Ci0JfSBlbHNl
IGlmIChJU19ST0NLRVRMQUtFKGRldl9wcml2KSAmJiBJTlRFTF9QQ0hfVFlQRShkZXZfcHJpdikg
PT0gUENIX1RHUCkgeworCX0gZWxzZSBpZiAoSVNfUk9DS0VUTEFLRShpOTE1KSAmJiBJTlRFTF9Q
Q0hfVFlQRShpOTE1KSA9PSBQQ0hfVEdQKSB7CiAJCWRkY19waW5fbWFwID0gcmtsX3BjaF90Z3Bf
ZGRjX3Bpbl9tYXA7CiAJCW5fZW50cmllcyA9IEFSUkFZX1NJWkUocmtsX3BjaF90Z3BfZGRjX3Bp
bl9tYXApOwotCX0gZWxzZSBpZiAoSEFTX1BDSF9UR1AoZGV2X3ByaXYpICYmIElTX0dFTjlfQkMo
ZGV2X3ByaXYpKSB7CisJfSBlbHNlIGlmIChIQVNfUENIX1RHUChpOTE1KSAmJiBJU19HRU45X0JD
KGk5MTUpKSB7CiAJCWRkY19waW5fbWFwID0gZ2VuOWJjX3RncF9kZGNfcGluX21hcDsKIAkJbl9l
bnRyaWVzID0gQVJSQVlfU0laRShnZW45YmNfdGdwX2RkY19waW5fbWFwKTsKLQl9IGVsc2UgaWYg
KElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA+PSBQQ0hfSUNQKSB7CisJfSBlbHNlIGlmIChJTlRF
TF9QQ0hfVFlQRShpOTE1KSA+PSBQQ0hfSUNQKSB7CiAJCWRkY19waW5fbWFwID0gaWNwX2RkY19w
aW5fbWFwOwogCQluX2VudHJpZXMgPSBBUlJBWV9TSVpFKGljcF9kZGNfcGluX21hcCk7Ci0JfSBl
bHNlIGlmIChIQVNfUENIX0NOUChkZXZfcHJpdikpIHsKKwl9IGVsc2UgaWYgKEhBU19QQ0hfQ05Q
KGk5MTUpKSB7CiAJCWRkY19waW5fbWFwID0gY25wX2RkY19waW5fbWFwOwogCQluX2VudHJpZXMg
PSBBUlJBWV9TSVpFKGNucF9kZGNfcGluX21hcCk7CiAJfSBlbHNlIHsKQEAgLTE2NzQsNyArMTY3
NCw3IEBAIHN0YXRpYyB1OCBtYXBfZGRjX3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsIHU4IHZidF9waW4pCiAJaWYgKHZidF9waW4gPCBuX2VudHJpZXMgJiYgZGRjX3Bpbl9t
YXBbdmJ0X3Bpbl0gIT0gMCkKIAkJcmV0dXJuIGRkY19waW5fbWFwW3ZidF9waW5dOwogCi0JZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJICAg
ICJJZ25vcmluZyBhbHRlcm5hdGUgcGluOiBWQlQgY2xhaW1zIEREQyBwaW4gJWQsIHdoaWNoIGlz
IG5vdCB2YWxpZCBmb3IgdGhpcyBwbGF0Zm9ybVxuIiwKIAkJICAgIHZidF9waW4pOwogCXJldHVy
biAwOwpAQCAtMTY5OSw3ICsxNjk5LDcgQEAgc3RhdGljIGVudW0gcG9ydCBfX2R2b19wb3J0X3Rv
X3BvcnQoaW50IG5fcG9ydHMsIGludCBuX2R2bywKIAlyZXR1cm4gUE9SVF9OT05FOwogfQogCi1z
dGF0aWMgZW51bSBwb3J0IGR2b19wb3J0X3RvX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAorc3RhdGljIGVudW0gcG9ydCBkdm9fcG9ydF90b19wb3J0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgdTggZHZvX3BvcnQpCiB7CiAJLyoKQEAgLTE3NDIs
MTIgKzE3NDIsMTIgQEAgc3RhdGljIGVudW0gcG9ydCBkdm9fcG9ydF90b19wb3J0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJW1BPUlRfVEM0XSA9IHsgRFZPX1BPUlRfSERN
SUUsIERWT19QT1JUX0RQRSwgLTEgfSwKIAl9OwogCi0JaWYgKElTX0FMREVSTEFLRV9TKGRldl9w
cml2KSkKKwlpZiAoSVNfQUxERVJMQUtFX1MoaTkxNSkpCiAJCXJldHVybiBfX2R2b19wb3J0X3Rv
X3BvcnQoQVJSQVlfU0laRShhZGxzX3BvcnRfbWFwcGluZyksCiAJCQkJCSAgQVJSQVlfU0laRShh
ZGxzX3BvcnRfbWFwcGluZ1swXSksCiAJCQkJCSAgYWRsc19wb3J0X21hcHBpbmcsCiAJCQkJCSAg
ZHZvX3BvcnQpOwotCWVsc2UgaWYgKElTX0RHMShkZXZfcHJpdikgfHwgSVNfUk9DS0VUTEFLRShk
ZXZfcHJpdikpCisJZWxzZSBpZiAoSVNfREcxKGk5MTUpIHx8IElTX1JPQ0tFVExBS0UoaTkxNSkp
CiAJCXJldHVybiBfX2R2b19wb3J0X3RvX3BvcnQoQVJSQVlfU0laRShya2xfcG9ydF9tYXBwaW5n
KSwKIAkJCQkJICBBUlJBWV9TSVpFKHJrbF9wb3J0X21hcHBpbmdbMF0pLAogCQkJCQkgIHJrbF9w
b3J0X21hcHBpbmcsCkBAIC0xNzk3LDcgKzE3OTcsNyBAQCBzdGF0aWMgaW50IHBhcnNlX2JkYl8y
MTZfZHBfbWF4X2xpbmtfcmF0ZShjb25zdCBpbnQgdmJ0X21heF9saW5rX3JhdGUpCiAJfQogfQog
Ci1zdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJCSAgIHN0cnVjdCBkaXNwbGF5X2RldmljZV9kYXRhICpkZXZkYXRhLAogCQkJ
ICAgdTggYmRiX3ZlcnNpb24pCiB7CkBAIC0xODA2LDE0ICsxODA2LDE0IEBAIHN0YXRpYyB2b2lk
IHBhcnNlX2RkaV9wb3J0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlib29s
IGlzX2R2aSwgaXNfaGRtaSwgaXNfZHAsIGlzX2VkcCwgaXNfY3J0OwogCWVudW0gcG9ydCBwb3J0
OwogCi0JcG9ydCA9IGR2b19wb3J0X3RvX3BvcnQoZGV2X3ByaXYsIGNoaWxkLT5kdm9fcG9ydCk7
CisJcG9ydCA9IGR2b19wb3J0X3RvX3BvcnQoaTkxNSwgY2hpbGQtPmR2b19wb3J0KTsKIAlpZiAo
cG9ydCA9PSBQT1JUX05PTkUpCiAJCXJldHVybjsKIAotCWluZm8gPSAmZGV2X3ByaXYtPnZidC5k
ZGlfcG9ydF9pbmZvW3BvcnRdOworCWluZm8gPSAmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9y
dF07CiAKIAlpZiAoaW5mby0+Y2hpbGQpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIk1vcmUgdGhhbiBvbmUgY2hpbGQg
ZGV2aWNlIGZvciBwb3J0ICVjIGluIFZCVCwgdXNpbmcgdGhlIGZpcnN0LlxuIiwKIAkJCSAgICBw
b3J0X25hbWUocG9ydCkpOwogCQlyZXR1cm47CkBAIC0xODI1LDggKzE4MjUsOCBAQCBzdGF0aWMg
dm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
aXNfaGRtaSA9IGlzX2R2aSAmJiAoY2hpbGQtPmRldmljZV90eXBlICYgREVWSUNFX1RZUEVfTk9U
X0hETUlfT1VUUFVUKSA9PSAwOwogCWlzX2VkcCA9IGlzX2RwICYmIChjaGlsZC0+ZGV2aWNlX3R5
cGUgJiBERVZJQ0VfVFlQRV9JTlRFUk5BTF9DT05ORUNUT1IpOwogCi0JaWYgKHBvcnQgPT0gUE9S
VF9BICYmIGlzX2R2aSAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpIHsKLQkJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sCisJaWYgKHBvcnQgPT0gUE9SVF9BICYmIGlzX2R2aSAmJiBJTlRF
TF9HRU4oaTkxNSkgPCAxMikgeworCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJW
QlQgY2xhaW1zIHBvcnQgQSBzdXBwb3J0cyBEVkklcywgaWdub3JpbmdcbiIsCiAJCQkgICAgaXNf
aGRtaSA/ICIvSERNSSIgOiAiIik7CiAJCWlzX2R2aSA9IGZhbHNlOwpAQCAtMTg0NCwyMiArMTg0
NCwyMiBAQCBzdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJaWYgKGJkYl92ZXJzaW9uID49IDIwOSkKIAkJaW5mby0+c3VwcG9ydHNf
dGJ0ID0gY2hpbGQtPnRidDsKIAotCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCWRybV9k
Ymdfa21zKCZpOTE1LT5kcm0sCiAJCSAgICAiUG9ydCAlYyBWQlQgaW5mbzogQ1JUOiVkIERWSTol
ZCBIRE1JOiVkIERQOiVkIGVEUDolZCBMU1BDT046JWQgVVNCLVR5cGUtQzolZCBUQlQ6JWQgRFND
OiVkXG4iLAogCQkgICAgcG9ydF9uYW1lKHBvcnQpLCBpc19jcnQsIGlzX2R2aSwgaXNfaGRtaSwg
aXNfZHAsIGlzX2VkcCwKLQkJICAgIEhBU19MU1BDT04oZGV2X3ByaXYpICYmIGNoaWxkLT5sc3Bj
b24sCisJCSAgICBIQVNfTFNQQ09OKGk5MTUpICYmIGNoaWxkLT5sc3Bjb24sCiAJCSAgICBpbmZv
LT5zdXBwb3J0c190eXBlY191c2IsIGluZm8tPnN1cHBvcnRzX3RidCwKIAkJICAgIGRldmRhdGEt
PmRzYyAhPSBOVUxMKTsKIAogCWlmIChpc19kdmkpIHsKIAkJdTggZGRjX3BpbjsKIAotCQlkZGNf
cGluID0gbWFwX2RkY19waW4oZGV2X3ByaXYsIGNoaWxkLT5kZGNfcGluKTsKLQkJaWYgKGludGVs
X2dtYnVzX2lzX3ZhbGlkX3BpbihkZXZfcHJpdiwgZGRjX3BpbikpIHsKKwkJZGRjX3BpbiA9IG1h
cF9kZGNfcGluKGk5MTUsIGNoaWxkLT5kZGNfcGluKTsKKwkJaWYgKGludGVsX2dtYnVzX2lzX3Zh
bGlkX3BpbihpOTE1LCBkZGNfcGluKSkgewogCQkJaW5mby0+YWx0ZXJuYXRlX2RkY19waW4gPSBk
ZGNfcGluOwotCQkJc2FuaXRpemVfZGRjX3BpbihkZXZfcHJpdiwgcG9ydCk7CisJCQlzYW5pdGl6
ZV9kZGNfcGluKGk5MTUsIHBvcnQpOwogCQl9IGVsc2UgewotCQkJZHJtX2RiZ19rbXMoJmRldl9w
cml2LT5kcm0sCisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJCSAgICAiUG9ydCAlYyBo
YXMgaW52YWxpZCBEREMgcGluICVkLCAiCiAJCQkJICAgICJzdGlja2luZyB0byBkZWZhdWx0c1xu
IiwKIAkJCQkgICAgcG9ydF9uYW1lKHBvcnQpLCBkZGNfcGluKTsKQEAgLTE4NjksMTMgKzE4Njks
MTMgQEAgc3RhdGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCWlmIChpc19kcCkgewogCQlpbmZvLT5hbHRlcm5hdGVfYXV4X2NoYW5uZWwg
PSBjaGlsZC0+YXV4X2NoYW5uZWw7CiAKLQkJc2FuaXRpemVfYXV4X2NoKGRldl9wcml2LCBwb3J0
KTsKKwkJc2FuaXRpemVfYXV4X2NoKGk5MTUsIHBvcnQpOwogCX0KIAogCWlmIChiZGJfdmVyc2lv
biA+PSAxNTgpIHsKIAkJLyogVGhlIFZCVCBIRE1JIGxldmVsIHNoaWZ0IHZhbHVlcyBtYXRjaCB0
aGUgdGFibGUgd2UgaGF2ZS4gKi8KIAkJdTggaGRtaV9sZXZlbF9zaGlmdCA9IGNoaWxkLT5oZG1p
X2xldmVsX3NoaWZ0ZXJfdmFsdWU7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlk
cm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJQb3J0ICVjIFZCVCBIRE1JIGxldmVsIHNo
aWZ0OiAlZFxuIiwKIAkJCSAgICBwb3J0X25hbWUocG9ydCksCiAJCQkgICAgaGRtaV9sZXZlbF9z
aGlmdCk7CkBAIC0xOTAyLDcgKzE5MDIsNyBAQCBzdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCX0KIAogCQlpZiAobWF4X3RtZHNf
Y2xvY2spCi0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCWRybV9kYmdfa21zKCZp
OTE1LT5kcm0sCiAJCQkJICAgICJQb3J0ICVjIFZCVCBIRE1JIG1heCBUTURTIGNsb2NrOiAlZCBr
SHpcbiIsCiAJCQkJICAgIHBvcnRfbmFtZShwb3J0KSwgbWF4X3RtZHNfY2xvY2spOwogCQlpbmZv
LT5tYXhfdG1kc19jbG9jayA9IG1heF90bWRzX2Nsb2NrOwpAQCAtMTkxMSwxMSArMTkxMSwxMSBA
QCBzdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJLyogUGFyc2UgdGhlIElfYm9vc3QgY29uZmlnIGZvciBTS0wgYW5kIGFib3ZlICov
CiAJaWYgKGJkYl92ZXJzaW9uID49IDE5NiAmJiBjaGlsZC0+aWJvb3N0KSB7CiAJCWluZm8tPmRw
X2Jvb3N0X2xldmVsID0gdHJhbnNsYXRlX2lib29zdChjaGlsZC0+ZHBfaWJvb3N0X2xldmVsKTsK
LQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0s
CiAJCQkgICAgIlBvcnQgJWMgVkJUIChlKURQIGJvb3N0IGxldmVsOiAlZFxuIiwKIAkJCSAgICBw
b3J0X25hbWUocG9ydCksIGluZm8tPmRwX2Jvb3N0X2xldmVsKTsKIAkJaW5mby0+aGRtaV9ib29z
dF9sZXZlbCA9IHRyYW5zbGF0ZV9pYm9vc3QoY2hpbGQtPmhkbWlfaWJvb3N0X2xldmVsKTsKLQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJ
CQkgICAgIlBvcnQgJWMgVkJUIEhETUkgYm9vc3QgbGV2ZWw6ICVkXG4iLAogCQkJICAgIHBvcnRf
bmFtZShwb3J0KSwgaW5mby0+aGRtaV9ib29zdF9sZXZlbCk7CiAJfQpAQCAtMTkyNyw3ICsxOTI3
LDcgQEAgc3RhdGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQllbHNlCiAJCQlpbmZvLT5kcF9tYXhfbGlua19yYXRlID0gcGFyc2VfYmRi
XzIxNl9kcF9tYXhfbGlua19yYXRlKGNoaWxkLT5kcF9tYXhfbGlua19yYXRlKTsKIAotCQlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAg
ICAiUG9ydCAlYyBWQlQgRFAgbWF4IGxpbmsgcmF0ZTogJWRcbiIsCiAJCQkgICAgcG9ydF9uYW1l
KHBvcnQpLCBpbmZvLT5kcF9tYXhfbGlua19yYXRlKTsKIAl9CkBAIC0xOTM1LDIyICsxOTM1LDIy
IEBAIHN0YXRpYyB2b2lkIHBhcnNlX2RkaV9wb3J0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAlpbmZvLT5jaGlsZCA9IGNoaWxkOwogfQogCi1zdGF0aWMgdm9pZCBwYXJzZV9k
ZGlfcG9ydHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJfdmVyc2lv
bikKK3N0YXRpYyB2b2lkIHBhcnNlX2RkaV9wb3J0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwgdTggYmRiX3ZlcnNpb24pCiB7CiAJc3RydWN0IGRpc3BsYXlfZGV2aWNlX2RhdGEgKmRl
dmRhdGE7CiAKLQlpZiAoIUhBU19EREkoZGV2X3ByaXYpICYmICFJU19DSEVSUllWSUVXKGRldl9w
cml2KSkKKwlpZiAoIUhBU19EREkoaTkxNSkgJiYgIUlTX0NIRVJSWVZJRVcoaTkxNSkpCiAJCXJl
dHVybjsKIAogCWlmIChiZGJfdmVyc2lvbiA8IDE1NSkKIAkJcmV0dXJuOwogCi0JbGlzdF9mb3Jf
ZWFjaF9lbnRyeShkZXZkYXRhLCAmZGV2X3ByaXYtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUp
Ci0JCXBhcnNlX2RkaV9wb3J0KGRldl9wcml2LCBkZXZkYXRhLCBiZGJfdmVyc2lvbik7CisJbGlz
dF9mb3JfZWFjaF9lbnRyeShkZXZkYXRhLCAmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2aWNlcywgbm9k
ZSkKKwkJcGFyc2VfZGRpX3BvcnQoaTkxNSwgZGV2ZGF0YSwgYmRiX3ZlcnNpb24pOwogfQogCiBz
dGF0aWMgdm9pZAotcGFyc2VfZ2VuZXJhbF9kZWZpbml0aW9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9nZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJICBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewog
CWNvbnN0IHN0cnVjdCBiZGJfZ2VuZXJhbF9kZWZpbml0aW9ucyAqZGVmczsKQEAgLTE5NjMsMjMg
KzE5NjMsMjMgQEAgcGFyc2VfZ2VuZXJhbF9kZWZpbml0aW9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAKIAlkZWZzID0gZmluZF9zZWN0aW9uKGJkYiwgQkRCX0dFTkVSQUxf
REVGSU5JVElPTlMpOwogCWlmICghZGVmcykgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAiTm8gZ2VuZXJhbCBkZWZpbml0
aW9uIGJsb2NrIGlzIGZvdW5kLCBubyBkZXZpY2VzIGRlZmluZWQuXG4iKTsKIAkJcmV0dXJuOwog
CX0KIAogCWJsb2NrX3NpemUgPSBnZXRfYmxvY2tzaXplKGRlZnMpOwogCWlmIChibG9ja19zaXpl
IDwgc2l6ZW9mKCpkZWZzKSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJZHJt
X2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAiR2VuZXJhbCBkZWZpbml0aW9ucyBibG9jayB0
b28gc21hbGwgKCV1KVxuIiwKIAkJCSAgICBibG9ja19zaXplKTsKIAkJcmV0dXJuOwogCX0KIAog
CWJ1c19waW4gPSBkZWZzLT5jcnRfZGRjX2dtYnVzX3BpbjsKLQlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwgImNydF9kZGNfYnVzX3BpbjogJWRcbiIsIGJ1c19waW4pOwotCWlmIChpbnRlbF9n
bWJ1c19pc192YWxpZF9waW4oZGV2X3ByaXYsIGJ1c19waW4pKQotCQlkZXZfcHJpdi0+dmJ0LmNy
dF9kZGNfcGluID0gYnVzX3BpbjsKKwlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiY3J0X2RkY19i
dXNfcGluOiAlZFxuIiwgYnVzX3Bpbik7CisJaWYgKGludGVsX2dtYnVzX2lzX3ZhbGlkX3Bpbihp
OTE1LCBidXNfcGluKSkKKwkJaTkxNS0+dmJ0LmNydF9kZGNfcGluID0gYnVzX3BpbjsKIAogCWlm
IChiZGItPnZlcnNpb24gPCAxMDYpIHsKIAkJZXhwZWN0ZWRfc2l6ZSA9IDIyOwpAQCAtMTk5Niwy
MCArMTk5NiwyMCBAQCBwYXJzZV9nZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAl9IGVsc2UgewogCQlleHBlY3RlZF9zaXplID0gc2l6ZW9mKCpj
aGlsZCk7CiAJCUJVSUxEX0JVR19PTihzaXplb2YoKmNoaWxkKSA8IDM5KTsKLQkJZHJtX2RiZygm
ZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZygmaTkxNS0+ZHJtLAogCQkJIkV4cGVjdGVkIGNoaWxk
IGRldmljZSBjb25maWcgc2l6ZSBmb3IgVkJUIHZlcnNpb24gJXUgbm90IGtub3duOyBhc3N1bWlu
ZyAldVxuIiwKIAkJCWJkYi0+dmVyc2lvbiwgZXhwZWN0ZWRfc2l6ZSk7CiAJfQogCiAJLyogRmxh
ZyBhbiBlcnJvciBmb3IgdW5leHBlY3RlZCBzaXplLCBidXQgY29udGludWUgYW55d2F5LiAqLwog
CWlmIChkZWZzLT5jaGlsZF9kZXZfc2l6ZSAhPSBleHBlY3RlZF9zaXplKQotCQlkcm1fZXJyKCZk
ZXZfcHJpdi0+ZHJtLAorCQlkcm1fZXJyKCZpOTE1LT5kcm0sCiAJCQkiVW5leHBlY3RlZCBjaGls
ZCBkZXZpY2UgY29uZmlnIHNpemUgJXUgKGV4cGVjdGVkICV1IGZvciBWQlQgdmVyc2lvbiAldSlc
biIsCiAJCQlkZWZzLT5jaGlsZF9kZXZfc2l6ZSwgZXhwZWN0ZWRfc2l6ZSwgYmRiLT52ZXJzaW9u
KTsKIAogCS8qIFRoZSBsZWdhY3kgc2l6ZWQgY2hpbGQgZGV2aWNlIGNvbmZpZyBpcyB0aGUgbWlu
aW11bSB3ZSBuZWVkLiAqLwogCWlmIChkZWZzLT5jaGlsZF9kZXZfc2l6ZSA8IExFR0FDWV9DSElM
RF9ERVZJQ0VfQ09ORklHX1NJWkUpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJ
CWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIkNoaWxkIGRldmljZSBjb25maWcgc2l6
ZSAldSBpcyB0b28gc21hbGwuXG4iLAogCQkJICAgIGRlZnMtPmNoaWxkX2Rldl9zaXplKTsKIAkJ
cmV0dXJuOwpAQCAtMjAyMyw3ICsyMDIzLDcgQEAgcGFyc2VfZ2VuZXJhbF9kZWZpbml0aW9ucyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWlmICghY2hpbGQtPmRldmljZV90
eXBlKQogCQkJY29udGludWU7CiAKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRy
bV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIkZvdW5kIFZCVCBjaGlsZCBkZXZpY2Ugd2l0
aCB0eXBlIDB4JXhcbiIsCiAJCQkgICAgY2hpbGQtPmRldmljZV90eXBlKTsKIApAQCAtMjAzOSw2
NCArMjAzOSw2NCBAQCBwYXJzZV9nZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkJbWVtY3B5KCZkZXZkYXRhLT5jaGlsZCwgY2hpbGQsCiAJCSAg
ICAgICBtaW5fdChzaXplX3QsIGRlZnMtPmNoaWxkX2Rldl9zaXplLCBzaXplb2YoKmNoaWxkKSkp
OwogCi0JCWxpc3RfYWRkX3RhaWwoJmRldmRhdGEtPm5vZGUsICZkZXZfcHJpdi0+dmJ0LmRpc3Bs
YXlfZGV2aWNlcyk7CisJCWxpc3RfYWRkX3RhaWwoJmRldmRhdGEtPm5vZGUsICZpOTE1LT52YnQu
ZGlzcGxheV9kZXZpY2VzKTsKIAl9CiAKLQlpZiAobGlzdF9lbXB0eSgmZGV2X3ByaXYtPnZidC5k
aXNwbGF5X2RldmljZXMpKQotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwlpZiAobGlz
dF9lbXB0eSgmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2aWNlcykpCisJCWRybV9kYmdfa21zKCZpOTE1
LT5kcm0sCiAJCQkgICAgIm5vIGNoaWxkIGRldiBpcyBwYXJzZWQgZnJvbSBWQlRcbiIpOwogfQog
CiAvKiBDb21tb24gZGVmYXVsdHMgd2hpY2ggbWF5IGJlIG92ZXJyaWRkZW4gYnkgVkJULiAqLwog
c3RhdGljIHZvaWQKLWluaXRfdmJ0X2RlZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKK2luaXRfdmJ0X2RlZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewotCWRldl9wcml2LT52YnQuY3J0X2RkY19waW4gPSBHTUJVU19QSU5fVkdBRERDOworCWk5
MTUtPnZidC5jcnRfZGRjX3BpbiA9IEdNQlVTX1BJTl9WR0FEREM7CiAKIAkvKiBEZWZhdWx0IHRv
IGhhdmluZyBiYWNrbGlnaHQgKi8KLQlkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wcmVzZW50ID0g
dHJ1ZTsKKwlpOTE1LT52YnQuYmFja2xpZ2h0LnByZXNlbnQgPSB0cnVlOwogCiAJLyogTEZQIHBh
bmVsIGRhdGEgKi8KLQlkZXZfcHJpdi0+dmJ0Lmx2ZHNfZGl0aGVyID0gMTsKKwlpOTE1LT52YnQu
bHZkc19kaXRoZXIgPSAxOwogCiAJLyogU0RWTyBwYW5lbCBkYXRhICovCi0JZGV2X3ByaXYtPnZi
dC5zZHZvX2x2ZHNfdmJ0X21vZGUgPSBOVUxMOworCWk5MTUtPnZidC5zZHZvX2x2ZHNfdmJ0X21v
ZGUgPSBOVUxMOwogCiAJLyogZ2VuZXJhbCBmZWF0dXJlcyAqLwotCWRldl9wcml2LT52YnQuaW50
X3R2X3N1cHBvcnQgPSAxOwotCWRldl9wcml2LT52YnQuaW50X2NydF9zdXBwb3J0ID0gMTsKKwlp
OTE1LT52YnQuaW50X3R2X3N1cHBvcnQgPSAxOworCWk5MTUtPnZidC5pbnRfY3J0X3N1cHBvcnQg
PSAxOwogCiAJLyogZHJpdmVyIGZlYXR1cmVzICovCi0JZGV2X3ByaXYtPnZidC5pbnRfbHZkc19z
dXBwb3J0ID0gMTsKKwlpOTE1LT52YnQuaW50X2x2ZHNfc3VwcG9ydCA9IDE7CiAKIAkvKiBEZWZh
dWx0IHRvIHVzaW5nIFNTQyAqLwotCWRldl9wcml2LT52YnQubHZkc191c2Vfc3NjID0gMTsKKwlp
OTE1LT52YnQubHZkc191c2Vfc3NjID0gMTsKIAkvKgogCSAqIENvcmUvU2FuZHlCcmlkZ2UvSXZ5
QnJpZGdlIHVzZSBhbHRlcm5hdGl2ZSAoMTIwTUh6KSByZWZlcmVuY2UKIAkgKiBjbG9jayBmb3Ig
TFZEUy4KIAkgKi8KLQlkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2ZyZXEgPSBpbnRlbF9iaW9zX3Nz
Y19mcmVxdWVuY3koZGV2X3ByaXYsCi0JCQkhSEFTX1BDSF9TUExJVChkZXZfcHJpdikpOwotCWRy
bV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiU2V0IGRlZmF1bHQgdG8gU1NDIGF0ICVkIGtIelxu
IiwKLQkJICAgIGRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcSk7CisJaTkxNS0+dmJ0Lmx2ZHNf
c3NjX2ZyZXEgPSBpbnRlbF9iaW9zX3NzY19mcmVxdWVuY3koaTkxNSwKKwkJCQkJCQkgICAhSEFT
X1BDSF9TUExJVChpOTE1KSk7CisJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgIlNldCBkZWZhdWx0
IHRvIFNTQyBhdCAlZCBrSHpcbiIsCisJCSAgICBpOTE1LT52YnQubHZkc19zc2NfZnJlcSk7CiB9
CiAKIC8qIERlZmF1bHRzIHRvIGluaXRpYWxpemUgb25seSBpZiB0aGVyZSBpcyBubyBWQlQuICov
CiBzdGF0aWMgdm9pZAotaW5pdF92YnRfbWlzc2luZ19kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitpbml0X3ZidF9taXNzaW5nX2RlZmF1bHRzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogewogCWVudW0gcG9ydCBwb3J0OwogCiAJZm9yX2VhY2hfcG9y
dChwb3J0KSB7CiAJCXN0cnVjdCBkZGlfdmJ0X3BvcnRfaW5mbyAqaW5mbyA9Ci0JCQkmZGV2X3By
aXYtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOwotCQllbnVtIHBoeSBwaHkgPSBpbnRlbF9wb3J0
X3RvX3BoeShkZXZfcHJpdiwgcG9ydCk7CisJCQkmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9y
dF07CisJCWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGk5MTUsIHBvcnQpOwogCiAJ
CS8qCiAJCSAqIFZCVCBoYXMgdGhlIFR5cGVDIG1vZGUgKG5hdGl2ZSxUQlQvVVNCKSBhbmQgd2Ug
ZG9uJ3Qgd2FudAogCQkgKiB0byBkZXRlY3QgaXQuCiAJCSAqLwotCQlpZiAoaW50ZWxfcGh5X2lz
X3RjKGRldl9wcml2LCBwaHkpKQorCQlpZiAoaW50ZWxfcGh5X2lzX3RjKGk5MTUsIHBoeSkpCiAJ
CQljb250aW51ZTsKIAogCQlpbmZvLT5zdXBwb3J0c19kdmkgPSAocG9ydCAhPSBQT1JUX0EgJiYg
cG9ydCAhPSBQT1JUX0UpOwpAQCAtMjE2Miw5ICsyMTYyLDkgQEAgYm9vbCBpbnRlbF9iaW9zX2lz
X3ZhbGlkX3ZidChjb25zdCB2b2lkICpidWYsIHNpemVfdCBzaXplKQogCXJldHVybiB2YnQ7CiB9
CiAKLXN0YXRpYyBzdHJ1Y3QgdmJ0X2hlYWRlciAqb3Byb21fZ2V0X3ZidChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgc3RydWN0IHZidF9oZWFkZXIgKm9wcm9tX2dl
dF92YnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IHBjaV9kZXYg
KnBkZXYgPSB0b19wY2lfZGV2KGRldl9wcml2LT5kcm0uZGV2KTsKKwlzdHJ1Y3QgcGNpX2RldiAq
cGRldiA9IHRvX3BjaV9kZXYoaTkxNS0+ZHJtLmRldik7CiAJdm9pZCBfX2lvbWVtICpwID0gTlVM
TCwgKm9wcm9tOwogCXN0cnVjdCB2YnRfaGVhZGVyICp2YnQ7CiAJdTE2IHZidF9zaXplOwpAQCAt
MjE4OCwxMyArMjE4OCwxMyBAQCBzdGF0aWMgc3RydWN0IHZidF9oZWFkZXIgKm9wcm9tX2dldF92
YnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlnb3RvIGVycl91bm1hcF9v
cHJvbTsKIAogCWlmIChzaXplb2Yoc3RydWN0IHZidF9oZWFkZXIpID4gc2l6ZSkgewotCQlkcm1f
ZGJnKCZkZXZfcHJpdi0+ZHJtLCAiVkJUIGhlYWRlciBpbmNvbXBsZXRlXG4iKTsKKwkJZHJtX2Ri
ZygmaTkxNS0+ZHJtLCAiVkJUIGhlYWRlciBpbmNvbXBsZXRlXG4iKTsKIAkJZ290byBlcnJfdW5t
YXBfb3Byb207CiAJfQogCiAJdmJ0X3NpemUgPSBpb3JlYWQxNihwICsgb2Zmc2V0b2Yoc3RydWN0
IHZidF9oZWFkZXIsIHZidF9zaXplKSk7CiAJaWYgKHZidF9zaXplID4gc2l6ZSkgewotCQlkcm1f
ZGJnKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnKCZpOTE1LT5kcm0sCiAJCQkiVkJUIGluY29t
cGxldGUgKHZidF9zaXplIG92ZXJmbG93cylcbiIpOwogCQlnb3RvIGVycl91bm1hcF9vcHJvbTsK
IAl9CkBAIC0yMjIzLDcxICsyMjIzLDcxIEBAIHN0YXRpYyBzdHJ1Y3QgdmJ0X2hlYWRlciAqb3By
b21fZ2V0X3ZidChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIC8qKgogICog
aW50ZWxfYmlvc19pbml0IC0gZmluZCBWQlQgYW5kIGluaXRpYWxpemUgc2V0dGluZ3MgZnJvbSB0
aGUgQklPUwotICogQGRldl9wcml2OiBpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6IGk5
MTUgZGV2aWNlIGluc3RhbmNlCiAgKgogICogUGFyc2UgYW5kIGluaXRpYWxpemUgc2V0dGluZ3Mg
ZnJvbSB0aGUgVmlkZW8gQklPUyBUYWJsZXMgKFZCVCkuIElmIHRoZSBWQlQKICAqIHdhcyBub3Qg
Zm91bmQgaW4gQUNQSSBPcFJlZ2lvbiwgdHJ5IHRvIGZpbmQgaXQgaW4gUENJIFJPTSBmaXJzdC4g
QWxzbwogICogaW5pdGlhbGl6ZSBzb21lIGRlZmF1bHRzIGlmIHRoZSBWQlQgaXMgbm90IHByZXNl
bnQgYXQgYWxsLgogICovCi12b2lkIGludGVsX2Jpb3NfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2Jpb3NfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIHsKLQljb25zdCBzdHJ1Y3QgdmJ0X2hlYWRlciAqdmJ0ID0gZGV2X3ByaXYt
Pm9wcmVnaW9uLnZidDsKKwljb25zdCBzdHJ1Y3QgdmJ0X2hlYWRlciAqdmJ0ID0gaTkxNS0+b3By
ZWdpb24udmJ0OwogCXN0cnVjdCB2YnRfaGVhZGVyICpvcHJvbV92YnQgPSBOVUxMOwogCWNvbnN0
IHN0cnVjdCBiZGJfaGVhZGVyICpiZGI7CiAKLQlJTklUX0xJU1RfSEVBRCgmZGV2X3ByaXYtPnZi
dC5kaXNwbGF5X2RldmljZXMpOworCUlOSVRfTElTVF9IRUFEKCZpOTE1LT52YnQuZGlzcGxheV9k
ZXZpY2VzKTsKIAotCWlmICghSEFTX0RJU1BMQVkoZGV2X3ByaXYpKSB7Ci0JCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAorCWlmICghSEFTX0RJU1BMQVkoaTkxNSkpIHsKKwkJZHJtX2RiZ19r
bXMoJmk5MTUtPmRybSwKIAkJCSAgICAiU2tpcHBpbmcgVkJUIGluaXQgZHVlIHRvIGRpc2FibGVk
IGRpc3BsYXkuXG4iKTsKIAkJcmV0dXJuOwogCX0KIAotCWluaXRfdmJ0X2RlZmF1bHRzKGRldl9w
cml2KTsKKwlpbml0X3ZidF9kZWZhdWx0cyhpOTE1KTsKIAogCS8qIElmIHRoZSBPcFJlZ2lvbiBk
b2VzIG5vdCBoYXZlIFZCVCwgbG9vayBpbiBQQ0kgUk9NLiAqLwogCWlmICghdmJ0KSB7Ci0JCW9w
cm9tX3ZidCA9IG9wcm9tX2dldF92YnQoZGV2X3ByaXYpOworCQlvcHJvbV92YnQgPSBvcHJvbV9n
ZXRfdmJ0KGk5MTUpOwogCQlpZiAoIW9wcm9tX3ZidCkKIAkJCWdvdG8gb3V0OwogCiAJCXZidCA9
IG9wcm9tX3ZidDsKIAotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkZvdW5kIHZhbGlk
IFZCVCBpbiBQQ0kgUk9NXG4iKTsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgIkZvdW5kIHZh
bGlkIFZCVCBpbiBQQ0kgUk9NXG4iKTsKIAl9CiAKIAliZGIgPSBnZXRfYmRiX2hlYWRlcih2YnQp
OwogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJZHJtX2RiZ19rbXMoJmk5MTUtPmRy
bSwKIAkJICAgICJWQlQgc2lnbmF0dXJlIFwiJS4qc1wiLCBCREIgdmVyc2lvbiAlZFxuIiwKIAkJ
ICAgIChpbnQpc2l6ZW9mKHZidC0+c2lnbmF0dXJlKSwgdmJ0LT5zaWduYXR1cmUsIGJkYi0+dmVy
c2lvbik7CiAKIAkvKiBHcmFiIHVzZWZ1bCBnZW5lcmFsIGRlZmluaXRpb25zICovCi0JcGFyc2Vf
Z2VuZXJhbF9mZWF0dXJlcyhkZXZfcHJpdiwgYmRiKTsKLQlwYXJzZV9nZW5lcmFsX2RlZmluaXRp
b25zKGRldl9wcml2LCBiZGIpOwotCXBhcnNlX3BhbmVsX29wdGlvbnMoZGV2X3ByaXYsIGJkYik7
Ci0JcGFyc2VfcGFuZWxfZHRkKGRldl9wcml2LCBiZGIpOwotCXBhcnNlX2xmcF9iYWNrbGlnaHQo
ZGV2X3ByaXYsIGJkYik7Ci0JcGFyc2Vfc2R2b19wYW5lbF9kYXRhKGRldl9wcml2LCBiZGIpOwot
CXBhcnNlX2RyaXZlcl9mZWF0dXJlcyhkZXZfcHJpdiwgYmRiKTsKLQlwYXJzZV9wb3dlcl9jb25z
ZXJ2YXRpb25fZmVhdHVyZXMoZGV2X3ByaXYsIGJkYik7Ci0JcGFyc2VfZWRwKGRldl9wcml2LCBi
ZGIpOwotCXBhcnNlX3BzcihkZXZfcHJpdiwgYmRiKTsKLQlwYXJzZV9taXBpX2NvbmZpZyhkZXZf
cHJpdiwgYmRiKTsKLQlwYXJzZV9taXBpX3NlcXVlbmNlKGRldl9wcml2LCBiZGIpOworCXBhcnNl
X2dlbmVyYWxfZmVhdHVyZXMoaTkxNSwgYmRiKTsKKwlwYXJzZV9nZW5lcmFsX2RlZmluaXRpb25z
KGk5MTUsIGJkYik7CisJcGFyc2VfcGFuZWxfb3B0aW9ucyhpOTE1LCBiZGIpOworCXBhcnNlX3Bh
bmVsX2R0ZChpOTE1LCBiZGIpOworCXBhcnNlX2xmcF9iYWNrbGlnaHQoaTkxNSwgYmRiKTsKKwlw
YXJzZV9zZHZvX3BhbmVsX2RhdGEoaTkxNSwgYmRiKTsKKwlwYXJzZV9kcml2ZXJfZmVhdHVyZXMo
aTkxNSwgYmRiKTsKKwlwYXJzZV9wb3dlcl9jb25zZXJ2YXRpb25fZmVhdHVyZXMoaTkxNSwgYmRi
KTsKKwlwYXJzZV9lZHAoaTkxNSwgYmRiKTsKKwlwYXJzZV9wc3IoaTkxNSwgYmRiKTsKKwlwYXJz
ZV9taXBpX2NvbmZpZyhpOTE1LCBiZGIpOworCXBhcnNlX21pcGlfc2VxdWVuY2UoaTkxNSwgYmRi
KTsKIAogCS8qIERlcGVuZHMgb24gY2hpbGQgZGV2aWNlIGxpc3QgKi8KLQlwYXJzZV9jb21wcmVz
c2lvbl9wYXJhbWV0ZXJzKGRldl9wcml2LCBiZGIpOworCXBhcnNlX2NvbXByZXNzaW9uX3BhcmFt
ZXRlcnMoaTkxNSwgYmRiKTsKIAogCS8qIEZ1cnRoZXIgcHJvY2Vzc2luZyBvbiBwcmUtcGFyc2Vk
IGRhdGEgKi8KLQlwYXJzZV9zZHZvX2RldmljZV9tYXBwaW5nKGRldl9wcml2LCBiZGItPnZlcnNp
b24pOwotCXBhcnNlX2RkaV9wb3J0cyhkZXZfcHJpdiwgYmRiLT52ZXJzaW9uKTsKKwlwYXJzZV9z
ZHZvX2RldmljZV9tYXBwaW5nKGk5MTUsIGJkYi0+dmVyc2lvbik7CisJcGFyc2VfZGRpX3BvcnRz
KGk5MTUsIGJkYi0+dmVyc2lvbik7CiAKIG91dDoKIAlpZiAoIXZidCkgewotCQlkcm1faW5mbygm
ZGV2X3ByaXYtPmRybSwKKwkJZHJtX2luZm8oJmk5MTUtPmRybSwKIAkJCSAiRmFpbGVkIHRvIGZp
bmQgVkJJT1MgdGFibGVzIChWQlQpXG4iKTsKLQkJaW5pdF92YnRfbWlzc2luZ19kZWZhdWx0cyhk
ZXZfcHJpdik7CisJCWluaXRfdmJ0X21pc3NpbmdfZGVmYXVsdHMoaTkxNSk7CiAJfQogCiAJa2Zy
ZWUob3Byb21fdmJ0KTsKQEAgLTIyOTUsNTEgKzIyOTUsNTEgQEAgdm9pZCBpbnRlbF9iaW9zX2lu
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAvKioKICAqIGludGVsX2Jp
b3NfZHJpdmVyX3JlbW92ZSAtIEZyZWUgYW55IHJlc291cmNlcyBhbGxvY2F0ZWQgYnkgaW50ZWxf
Ymlvc19pbml0KCkKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1
OiBpOTE1IGRldmljZSBpbnN0YW5jZQogICovCi12b2lkIGludGVsX2Jpb3NfZHJpdmVyX3JlbW92
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX2Jpb3NfZHJp
dmVyX3JlbW92ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgZGlz
cGxheV9kZXZpY2VfZGF0YSAqZGV2ZGF0YSwgKm47CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUoZGV2ZGF0YSwgbiwgJmRldl9wcml2LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CisJ
bGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGRldmRhdGEsIG4sICZpOTE1LT52YnQuZGlzcGxheV9k
ZXZpY2VzLCBub2RlKSB7CiAJCWxpc3RfZGVsKCZkZXZkYXRhLT5ub2RlKTsKIAkJa2ZyZWUoZGV2
ZGF0YS0+ZHNjKTsKIAkJa2ZyZWUoZGV2ZGF0YSk7CiAJfQogCi0Ja2ZyZWUoZGV2X3ByaXYtPnZi
dC5zZHZvX2x2ZHNfdmJ0X21vZGUpOwotCWRldl9wcml2LT52YnQuc2R2b19sdmRzX3ZidF9tb2Rl
ID0gTlVMTDsKLQlrZnJlZShkZXZfcHJpdi0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlKTsKLQlkZXZf
cHJpdi0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlID0gTlVMTDsKLQlrZnJlZShkZXZfcHJpdi0+dmJ0
LmRzaS5kYXRhKTsKLQlkZXZfcHJpdi0+dmJ0LmRzaS5kYXRhID0gTlVMTDsKLQlrZnJlZShkZXZf
cHJpdi0+dmJ0LmRzaS5wcHMpOwotCWRldl9wcml2LT52YnQuZHNpLnBwcyA9IE5VTEw7Ci0Ja2Zy
ZWUoZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnKTsKLQlkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWcg
PSBOVUxMOwotCWtmcmVlKGRldl9wcml2LT52YnQuZHNpLmRlYXNzZXJ0X3NlcSk7Ci0JZGV2X3By
aXYtPnZidC5kc2kuZGVhc3NlcnRfc2VxID0gTlVMTDsKKwlrZnJlZShpOTE1LT52YnQuc2R2b19s
dmRzX3ZidF9tb2RlKTsKKwlpOTE1LT52YnQuc2R2b19sdmRzX3ZidF9tb2RlID0gTlVMTDsKKwlr
ZnJlZShpOTE1LT52YnQubGZwX2x2ZHNfdmJ0X21vZGUpOworCWk5MTUtPnZidC5sZnBfbHZkc192
YnRfbW9kZSA9IE5VTEw7CisJa2ZyZWUoaTkxNS0+dmJ0LmRzaS5kYXRhKTsKKwlpOTE1LT52YnQu
ZHNpLmRhdGEgPSBOVUxMOworCWtmcmVlKGk5MTUtPnZidC5kc2kucHBzKTsKKwlpOTE1LT52YnQu
ZHNpLnBwcyA9IE5VTEw7CisJa2ZyZWUoaTkxNS0+dmJ0LmRzaS5jb25maWcpOworCWk5MTUtPnZi
dC5kc2kuY29uZmlnID0gTlVMTDsKKwlrZnJlZShpOTE1LT52YnQuZHNpLmRlYXNzZXJ0X3NlcSk7
CisJaTkxNS0+dmJ0LmRzaS5kZWFzc2VydF9zZXEgPSBOVUxMOwogfQogCiAvKioKICAqIGludGVs
X2Jpb3NfaXNfdHZfcHJlc2VudCAtIGlzIGludGVncmF0ZWQgVFYgcHJlc2VudCBpbiBWQlQKLSAq
IEBkZXZfcHJpdjoJaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBp
bnN0YW5jZQogICoKICAqIFJldHVybiB0cnVlIGlmIFRWIGlzIHByZXNlbnQuIElmIG5vIGNoaWxk
IGRldmljZXMgd2VyZSBwYXJzZWQgZnJvbSBWQlQsCiAgKiBhc3N1bWUgVFYgaXMgcHJlc2VudC4K
ICAqLwotYm9vbCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorYm9vbCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJY29uc3Qgc3RydWN0IGRpc3BsYXlfZGV2aWNlX2RhdGEg
KmRldmRhdGE7CiAJY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZV9jb25maWcgKmNoaWxkOwogCi0J
aWYgKCFkZXZfcHJpdi0+dmJ0LmludF90dl9zdXBwb3J0KQorCWlmICghaTkxNS0+dmJ0LmludF90
dl9zdXBwb3J0KQogCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAobGlzdF9lbXB0eSgmZGV2X3ByaXYt
PnZidC5kaXNwbGF5X2RldmljZXMpKQorCWlmIChsaXN0X2VtcHR5KCZpOTE1LT52YnQuZGlzcGxh
eV9kZXZpY2VzKSkKIAkJcmV0dXJuIHRydWU7CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGRldmRh
dGEsICZkZXZfcHJpdi0+dmJ0LmRpc3BsYXlfZGV2aWNlcywgbm9kZSkgeworCWxpc3RfZm9yX2Vh
Y2hfZW50cnkoZGV2ZGF0YSwgJmk5MTUtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsKIAkJ
Y2hpbGQgPSAmZGV2ZGF0YS0+Y2hpbGQ7CiAKIAkJLyoKQEAgLTIzNjUsMjEgKzIzNjUsMjEgQEAg
Ym9vbCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCiAvKioKICAqIGludGVsX2Jpb3NfaXNfbHZkc19wcmVzZW50IC0gaXMgTFZEUyBw
cmVzZW50IGluIFZCVAotICogQGRldl9wcml2OglpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5
MTU6CWk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAaTJjX3BpbjoJaTJjIHBpbiBmb3IgTFZEUyBp
ZiBwcmVzZW50CiAgKgogICogUmV0dXJuIHRydWUgaWYgTFZEUyBpcyBwcmVzZW50LiBJZiBubyBj
aGlsZCBkZXZpY2VzIHdlcmUgcGFyc2VkIGZyb20gVkJULAogICogYXNzdW1lIExWRFMgaXMgcHJl
c2VudC4KICAqLwotYm9vbCBpbnRlbF9iaW9zX2lzX2x2ZHNfcHJlc2VudChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4ICppMmNfcGluKQorYm9vbCBpbnRlbF9iaW9zX2lzX2x2
ZHNfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTggKmkyY19waW4pCiB7
CiAJY29uc3Qgc3RydWN0IGRpc3BsYXlfZGV2aWNlX2RhdGEgKmRldmRhdGE7CiAJY29uc3Qgc3Ry
dWN0IGNoaWxkX2RldmljZV9jb25maWcgKmNoaWxkOwogCi0JaWYgKGxpc3RfZW1wdHkoJmRldl9w
cml2LT52YnQuZGlzcGxheV9kZXZpY2VzKSkKKwlpZiAobGlzdF9lbXB0eSgmaTkxNS0+dmJ0LmRp
c3BsYXlfZGV2aWNlcykpCiAJCXJldHVybiB0cnVlOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShk
ZXZkYXRhLCAmZGV2X3ByaXYtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsKKwlsaXN0X2Zv
cl9lYWNoX2VudHJ5KGRldmRhdGEsICZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7
CiAJCWNoaWxkID0gJmRldmRhdGEtPmNoaWxkOwogCiAJCS8qIElmIHRoZSBkZXZpY2UgdHlwZSBp
cyBub3QgTEZQLCBjb250aW51ZS4KQEAgLTIzOTAsNyArMjM5MCw3IEBAIGJvb2wgaW50ZWxfYmlv
c19pc19sdmRzX3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCAq
aTJjX3BpbikKIAkJICAgIGNoaWxkLT5kZXZpY2VfdHlwZSAhPSBERVZJQ0VfVFlQRV9MRlApCiAJ
CQljb250aW51ZTsKIAotCQlpZiAoaW50ZWxfZ21idXNfaXNfdmFsaWRfcGluKGRldl9wcml2LCBj
aGlsZC0+aTJjX3BpbikpCisJCWlmIChpbnRlbF9nbWJ1c19pc192YWxpZF9waW4oaTkxNSwgY2hp
bGQtPmkyY19waW4pKQogCQkJKmkyY19waW4gPSBjaGlsZC0+aTJjX3BpbjsKIAogCQkvKiBIb3dl
dmVyLCB3ZSBjYW5ub3QgdHJ1c3QgdGhlIEJJT1Mgd3JpdGVycyB0byBwb3B1bGF0ZQpAQCAtMjQw
Niw3ICsyNDA2LDcgQEAgYm9vbCBpbnRlbF9iaW9zX2lzX2x2ZHNfcHJlc2VudChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4ICppMmNfcGluKQogCQkgKiBhZGRpdGlvbmFsIGRh
dGEuICBUcnVzdCB0aGF0IGlmIHRoZSBWQlQgd2FzIHdyaXR0ZW4gaW50bwogCQkgKiB0aGUgT3BS
ZWdpb24gdGhlbiB0aGV5IGhhdmUgdmFsaWRhdGVkIHRoZSBMVkRTJ3MgZXhpc3RlbmNlLgogCQkg
Ki8KLQkJaWYgKGRldl9wcml2LT5vcHJlZ2lvbi52YnQpCisJCWlmIChpOTE1LT5vcHJlZ2lvbi52
YnQpCiAJCQlyZXR1cm4gdHJ1ZTsKIAl9CiAKQEAgLTI0MTUsMTIgKzI0MTUsMTIgQEAgYm9vbCBp
bnRlbF9iaW9zX2lzX2x2ZHNfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHU4ICppMmNfcGluKQogCiAvKioKICAqIGludGVsX2Jpb3NfaXNfcG9ydF9wcmVzZW50IC0g
aXMgdGhlIHNwZWNpZmllZCBkaWdpdGFsIHBvcnQgcHJlc2VudAotICogQGRldl9wcml2OglpOTE1
IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6CWk5MTUgZGV2aWNlIGluc3RhbmNlCiAgKiBAcG9y
dDoJcG9ydCB0byBjaGVjawogICoKICAqIFJldHVybiB0cnVlIGlmIHRoZSBkZXZpY2UgaW4gJXBv
cnQgaXMgcHJlc2VudC4KICAqLwotYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfcHJlc2VudChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQorYm9vbCBpbnRl
bF9iaW9zX2lzX3BvcnRfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51
bSBwb3J0IHBvcnQpCiB7CiAJY29uc3Qgc3RydWN0IGRpc3BsYXlfZGV2aWNlX2RhdGEgKmRldmRh
dGE7CiAJY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZV9jb25maWcgKmNoaWxkOwpAQCAtMjQzNCwx
OSArMjQzNCwxOSBAQCBib29sIGludGVsX2Jpb3NfaXNfcG9ydF9wcmVzZW50KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcgogCQlbUE9SVF9GXSA9IHsgRFZP
X1BPUlRfRFBGLCBEVk9fUE9SVF9IRE1JRiwgfSwKIAl9OwogCi0JaWYgKEhBU19EREkoZGV2X3By
aXYpKSB7CisJaWYgKEhBU19EREkoaTkxNSkpIHsKIAkJY29uc3Qgc3RydWN0IGRkaV92YnRfcG9y
dF9pbmZvICpwb3J0X2luZm8gPQotCQkJJmRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0
XTsKKwkJCSZpOTE1LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKIAogCQlyZXR1cm4gcG9ydF9p
bmZvLT5jaGlsZDsKIAl9CiAKIAkvKiBGSVhNRSBtYXliZSBkZWFsIHdpdGggcG9ydCBBIGFzIHdl
bGw/ICovCi0JaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAorCWlmIChkcm1fV0FSTl9P
TigmaTkxNS0+ZHJtLAogCQkJcG9ydCA9PSBQT1JUX0EpIHx8IHBvcnQgPj0gQVJSQVlfU0laRShw
b3J0X21hcHBpbmcpKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGRl
dmRhdGEsICZkZXZfcHJpdi0+dmJ0LmRpc3BsYXlfZGV2aWNlcywgbm9kZSkgeworCWxpc3RfZm9y
X2VhY2hfZW50cnkoZGV2ZGF0YSwgJmk5MTUtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsK
IAkJY2hpbGQgPSAmZGV2ZGF0YS0+Y2hpbGQ7CiAKIAkJaWYgKChjaGlsZC0+ZHZvX3BvcnQgPT0g
cG9ydF9tYXBwaW5nW3BvcnRdLmRwIHx8CkBAIC0yNDYxLDEyICsyNDYxLDEyIEBAIGJvb2wgaW50
ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBlbnVtIHBvcnQgcG9yCiAKIC8qKgogICogaW50ZWxfYmlvc19pc19wb3J0X2VkcCAtIGlzIHRo
ZSBkZXZpY2UgaW4gZ2l2ZW4gcG9ydCBlRFAKLSAqIEBkZXZfcHJpdjoJaTkxNSBkZXZpY2UgaW5z
dGFuY2UKKyAqIEBpOTE1OglpOTE1IGRldmljZSBpbnN0YW5jZQogICogQHBvcnQ6CXBvcnQgdG8g
Y2hlY2sKICAqCiAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZGV2aWNlIGluICVwb3J0IGlzIGVEUC4K
ICAqLwotYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCitib29sIGludGVsX2Jpb3NfaXNfcG9ydF9lZHAo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0gcG9ydCBwb3J0KQogewogCWNvbnN0
IHN0cnVjdCBkaXNwbGF5X2RldmljZV9kYXRhICpkZXZkYXRhOwogCWNvbnN0IHN0cnVjdCBjaGls
ZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKQEAgLTI0NzgsMTAgKzI0NzgsMTAgQEAgYm9vbCBpbnRl
bF9iaW9zX2lzX3BvcnRfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51
bSBwb3J0IHBvcnQpCiAJCVtQT1JUX0ZdID0gRFZPX1BPUlRfRFBGLAogCX07CiAKLQlpZiAoSEFT
X0RESShkZXZfcHJpdikpCi0JCXJldHVybiBkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9y
dF0uc3VwcG9ydHNfZWRwOworCWlmIChIQVNfRERJKGk5MTUpKQorCQlyZXR1cm4gaTkxNS0+dmJ0
LmRkaV9wb3J0X2luZm9bcG9ydF0uc3VwcG9ydHNfZWRwOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRy
eShkZXZkYXRhLCAmZGV2X3ByaXYtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsKKwlsaXN0
X2Zvcl9lYWNoX2VudHJ5KGRldmRhdGEsICZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2Rl
KSB7CiAJCWNoaWxkID0gJmRldmRhdGEtPmNoaWxkOwogCiAJCWlmIChjaGlsZC0+ZHZvX3BvcnQg
PT0gcG9ydF9tYXBwaW5nW3BvcnRdICYmCkBAIC0yNTI4LDEyICsyNTI4LDEyIEBAIHN0YXRpYyBi
b29sIGNoaWxkX2Rldl9pc19kcF9kdWFsX21vZGUoY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZV9j
b25maWcgKmNoaWxkLAogCXJldHVybiBmYWxzZTsKIH0KIAotYm9vbCBpbnRlbF9iaW9zX2lzX3Bv
cnRfZHBfZHVhbF9tb2RlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK2Jvb2wg
aW50ZWxfYmlvc19pc19wb3J0X2RwX2R1YWxfbW9kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJCQkgICAgIGVudW0gcG9ydCBwb3J0KQogewogCWNvbnN0IHN0cnVjdCBkaXNwbGF5
X2RldmljZV9kYXRhICpkZXZkYXRhOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShkZXZkYXRhLCAm
ZGV2X3ByaXYtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsKKwlsaXN0X2Zvcl9lYWNoX2Vu
dHJ5KGRldmRhdGEsICZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CiAJCWlmIChj
aGlsZF9kZXZfaXNfZHBfZHVhbF9tb2RlKCZkZXZkYXRhLT5jaGlsZCwgcG9ydCkpCiAJCQlyZXR1
cm4gdHJ1ZTsKIAl9CkBAIC0yNTQzLDE5ICsyNTQzLDE5IEBAIGJvb2wgaW50ZWxfYmlvc19pc19w
b3J0X2RwX2R1YWxfbW9kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIC8q
KgogICogaW50ZWxfYmlvc19pc19kc2lfcHJlc2VudCAtIGlzIERTSSBwcmVzZW50IGluIFZCVAot
ICogQGRldl9wcml2OglpOTE1IGRldmljZSBpbnN0YW5jZQorICogQGk5MTU6CWk5MTUgZGV2aWNl
IGluc3RhbmNlCiAgKiBAcG9ydDoJcG9ydCBmb3IgRFNJIGlmIHByZXNlbnQKICAqCiAgKiBSZXR1
cm4gdHJ1ZSBpZiBEU0kgaXMgcHJlc2VudCwgYW5kIHJldHVybiB0aGUgcG9ydCBpbiAlcG9ydC4K
ICAqLwotYm9vbCBpbnRlbF9iaW9zX2lzX2RzaV9wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK2Jvb2wgaW50ZWxfYmlvc19pc19kc2lfcHJlc2VudChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgICBlbnVtIHBvcnQgKnBvcnQpCiB7CiAJY29u
c3Qgc3RydWN0IGRpc3BsYXlfZGV2aWNlX2RhdGEgKmRldmRhdGE7CiAJY29uc3Qgc3RydWN0IGNo
aWxkX2RldmljZV9jb25maWcgKmNoaWxkOwogCXU4IGR2b19wb3J0OwogCi0JbGlzdF9mb3JfZWFj
aF9lbnRyeShkZXZkYXRhLCAmZGV2X3ByaXYtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsK
KwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGRldmRhdGEsICZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2Vz
LCBub2RlKSB7CiAJCWNoaWxkID0gJmRldmRhdGEtPmNoaWxkOwogCiAJCWlmICghKGNoaWxkLT5k
ZXZpY2VfdHlwZSAmIERFVklDRV9UWVBFX01JUElfT1VUUFVUKSkKQEAgLTI1NjQsMTUgKzI1NjQs
MTUgQEAgYm9vbCBpbnRlbF9iaW9zX2lzX2RzaV9wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAkJZHZvX3BvcnQgPSBjaGlsZC0+ZHZvX3BvcnQ7CiAKIAkJaWYgKGR2
b19wb3J0ID09IERWT19QT1JUX01JUElBIHx8Ci0JCSAgICAoZHZvX3BvcnQgPT0gRFZPX1BPUlRf
TUlQSUIgJiYgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgfHwKLQkJICAgIChkdm9fcG9ydCA9
PSBEVk9fUE9SVF9NSVBJQyAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpKSB7CisJCSAgICAo
ZHZvX3BvcnQgPT0gRFZPX1BPUlRfTUlQSUIgJiYgSU5URUxfR0VOKGk5MTUpID49IDExKSB8fAor
CQkgICAgKGR2b19wb3J0ID09IERWT19QT1JUX01JUElDICYmIElOVEVMX0dFTihpOTE1KSA8IDEx
KSkgewogCQkJaWYgKHBvcnQpCiAJCQkJKnBvcnQgPSBkdm9fcG9ydCAtIERWT19QT1JUX01JUElB
OwogCQkJcmV0dXJuIHRydWU7CiAJCX0gZWxzZSBpZiAoZHZvX3BvcnQgPT0gRFZPX1BPUlRfTUlQ
SUIgfHwKIAkJCSAgIGR2b19wb3J0ID09IERWT19QT1JUX01JUElDIHx8CiAJCQkgICBkdm9fcG9y
dCA9PSBEVk9fUE9SVF9NSVBJRCkgewotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJ
CQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJCSAgICAiVkJUIGhhcyB1bnN1cHBvcnRlZCBE
U0kgcG9ydCAlY1xuIiwKIAkJCQkgICAgcG9ydF9uYW1lKGR2b19wb3J0IC0gRFZPX1BPUlRfTUlQ
SUEpKTsKIAkJfQpAQCAtMjcyOCwxNyArMjcyOCwxNyBAQCBpbnRlbF9iaW9zX2lzX2xhbmVfcmV2
ZXJzYWxfbmVlZGVkKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXJldHVy
biBjaGlsZCAmJiBjaGlsZC0+bGFuZV9yZXZlcnNhbDsKIH0KIAotZW51bSBhdXhfY2ggaW50ZWxf
Ymlvc19wb3J0X2F1eF9jaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitlbnVt
IGF1eF9jaCBpbnRlbF9iaW9zX3BvcnRfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkJCSAgIGVudW0gcG9ydCBwb3J0KQogewogCWNvbnN0IHN0cnVjdCBkZGlfdmJ0X3Bv
cnRfaW5mbyAqaW5mbyA9Ci0JCSZkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CisJ
CSZpOTE1LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKIAllbnVtIGF1eF9jaCBhdXhfY2g7CiAK
IAlpZiAoIWluZm8tPmFsdGVybmF0ZV9hdXhfY2hhbm5lbCkgewogCQlhdXhfY2ggPSAoZW51bSBh
dXhfY2gpcG9ydDsKIAotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZ19r
bXMoJmk5MTUtPmRybSwKIAkJCSAgICAidXNpbmcgQVVYICVjIGZvciBwb3J0ICVjIChwbGF0Zm9y
bSBkZWZhdWx0KVxuIiwKIAkJCSAgICBhdXhfY2hfbmFtZShhdXhfY2gpLCBwb3J0X25hbWUocG9y
dCkpOwogCQlyZXR1cm4gYXV4X2NoOwpAQCAtMjc1NiwyOSArMjc1NiwyOSBAQCBlbnVtIGF1eF9j
aCBpbnRlbF9iaW9zX3BvcnRfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJYXV4X2NoID0gQVVYX0NIX0E7CiAJCWJyZWFrOwogCWNhc2UgRFBfQVVYX0I6Ci0JCWlm
IChJU19BTERFUkxBS0VfUyhkZXZfcHJpdikpCisJCWlmIChJU19BTERFUkxBS0VfUyhpOTE1KSkK
IAkJCWF1eF9jaCA9IEFVWF9DSF9VU0JDMTsKIAkJZWxzZQogCQkJYXV4X2NoID0gQVVYX0NIX0I7
CiAJCWJyZWFrOwogCWNhc2UgRFBfQVVYX0M6Ci0JCWlmIChJU19BTERFUkxBS0VfUyhkZXZfcHJp
dikpCisJCWlmIChJU19BTERFUkxBS0VfUyhpOTE1KSkKIAkJCWF1eF9jaCA9IEFVWF9DSF9VU0JD
MjsKLQkJZWxzZSBpZiAoSVNfREcxKGRldl9wcml2KSB8fCBJU19ST0NLRVRMQUtFKGRldl9wcml2
KSkKKwkJZWxzZSBpZiAoSVNfREcxKGk5MTUpIHx8IElTX1JPQ0tFVExBS0UoaTkxNSkpCiAJCQlh
dXhfY2ggPSBBVVhfQ0hfVVNCQzE7CiAJCWVsc2UKIAkJCWF1eF9jaCA9IEFVWF9DSF9DOwogCQli
cmVhazsKIAljYXNlIERQX0FVWF9EOgotCQlpZiAoSVNfQUxERVJMQUtFX1MoZGV2X3ByaXYpKQor
CQlpZiAoSVNfQUxERVJMQUtFX1MoaTkxNSkpCiAJCQlhdXhfY2ggPSBBVVhfQ0hfVVNCQzM7Ci0J
CWVsc2UgaWYgKElTX0RHMShkZXZfcHJpdikgfHwgSVNfUk9DS0VUTEFLRShkZXZfcHJpdikpCisJ
CWVsc2UgaWYgKElTX0RHMShpOTE1KSB8fCBJU19ST0NLRVRMQUtFKGk5MTUpKQogCQkJYXV4X2No
ID0gQVVYX0NIX1VTQkMyOwogCQllbHNlCiAJCQlhdXhfY2ggPSBBVVhfQ0hfRDsKIAkJYnJlYWs7
CiAJY2FzZSBEUF9BVVhfRToKLQkJaWYgKElTX0FMREVSTEFLRV9TKGRldl9wcml2KSkKKwkJaWYg
KElTX0FMREVSTEFLRV9TKGk5MTUpKQogCQkJYXV4X2NoID0gQVVYX0NIX1VTQkM0OwogCQllbHNl
CiAJCQlhdXhfY2ggPSBBVVhfQ0hfRTsKQEAgLTI4MDEsNyArMjgwMSw3IEBAIGVudW0gYXV4X2No
IGludGVsX2Jpb3NfcG9ydF9hdXhfY2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQlicmVhazsKIAl9CiAKLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgInVzaW5nIEFV
WCAlYyBmb3IgcG9ydCAlYyAoVkJUKVxuIiwKKwlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAidXNp
bmcgQVVYICVjIGZvciBwb3J0ICVjIChWQlQpXG4iLAogCQkgICAgYXV4X2NoX25hbWUoYXV4X2No
KSwgcG9ydF9uYW1lKHBvcnQpKTsKIAogCXJldHVybiBhdXhfY2g7Ci0tIAoyLjIwLjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWls
aW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

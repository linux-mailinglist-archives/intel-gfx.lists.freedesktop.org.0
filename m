Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 356944DCF5
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 23:46:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2A0F46E7EA;
	Thu, 20 Jun 2019 21:46:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C87E36E7E6
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 21:46:16 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 20 Jun 2019 23:46:06 +0200
Message-Id: <20190620214613.14481-3-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
References: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/9] drm/i915: Convert most of atomic commit to
 take more intel state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiBwYXNzaW5nIGFsb25nIGRybV9jcnRjX3N0YXRlIGFuZCBkcm1fYXRvbWljX3N0
YXRlLCBwYXNzCmFsb25nIG1vcmUgaW50ZWxfYXRvbWljX3N0YXRlIGFuZCBpbnRlbF9jcnRjX3N0
YXRlLiBUaGlzIHdpbGwKbWFrZSB0aGUgY29kZSBtb3JlIHJlYWRhYmxlIGJ5IG5vdCBjYXN0aW5n
IGJldHdlZW4gZHJtIHN0YXRlCmFuZCBpbnRlbCBzdGF0ZSBhbGwgdGhlIHRpbWUuCgpTaWduZWQt
b2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwg
NDAzICsrKysrKysrKy0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2Lmgg
ICAgICAgICAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jICAg
ICAgICAgICAgICB8ICAxMSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCAgICAg
ICAgICAgICAgfCAgIDQgKy0KIDQgZmlsZXMgY2hhbmdlZCwgMTk2IGluc2VydGlvbnMoKyksIDIy
OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCmluZGV4IDAyNTY1ZTk3OTk1YS4uODU1ZjkwYTgxMzk2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtNjAzNiwxOSArNjAzNiwxOSBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2Rpc2FibGVfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlLAogCWludGVsX2Zyb250YnVmZmVyX2ZsaXAoZGV2X3ByaXYsIGZiX2Jp
dHMpOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyc19wcmVfcGxsX2VuYWJsZShzdHJ1
Y3QgZHJtX2NydGMgKmNydGMsCitzdGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyc19wcmVfcGxsX2Vu
YWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCQkJICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0
YXRlKQorCQkJCQkgIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKIAlz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubjsKIAlpbnQgaTsKIAotCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUo
b2xkX3N0YXRlLCBjb25uLCBjb25uX3N0YXRlLCBpKSB7CisJZm9yX2VhY2hfbmV3X2Nvbm5lY3Rv
cl9pbl9zdGF0ZSgmb2xkX3N0YXRlLT5iYXNlLCBjb25uLCBjb25uX3N0YXRlLCBpKSB7CiAJCXN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0KIAkJCXRvX2ludGVsX2VuY29kZXIoY29ubl9z
dGF0ZS0+YmVzdF9lbmNvZGVyKTsKIAotCQlpZiAoY29ubl9zdGF0ZS0+Y3J0YyAhPSBjcnRjKQor
CQlpZiAoY29ubl9zdGF0ZS0+Y3J0YyAhPSAmY3J0Yy0+YmFzZSkKIAkJCWNvbnRpbnVlOwogCiAJ
CWlmIChlbmNvZGVyLT5wcmVfcGxsX2VuYWJsZSkKQEAgLTYwNTYsMTkgKzYwNTYsMTkgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZW5jb2RlcnNfcHJlX3BsbF9lbmFibGUoc3RydWN0IGRybV9jcnRjICpj
cnRjLAogCX0KIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJsZShzdHJ1
Y3QgZHJtX2NydGMgKmNydGMsCitzdGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyc19wcmVfZW5hYmxl
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAotCQkJCSAgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRf
c3RhdGUpCisJCQkJICAgICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQog
ewogCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlOwogCXN0cnVjdCBkcm1f
Y29ubmVjdG9yICpjb25uOwogCWludCBpOwogCi0JZm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9z
dGF0ZShvbGRfc3RhdGUsIGNvbm4sIGNvbm5fc3RhdGUsIGkpIHsKKwlmb3JfZWFjaF9uZXdfY29u
bmVjdG9yX2luX3N0YXRlKCZvbGRfc3RhdGUtPmJhc2UsIGNvbm4sIGNvbm5fc3RhdGUsIGkpIHsK
IAkJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPQogCQkJdG9faW50ZWxfZW5jb2Rlcihj
b25uX3N0YXRlLT5iZXN0X2VuY29kZXIpOwogCi0JCWlmIChjb25uX3N0YXRlLT5jcnRjICE9IGNy
dGMpCisJCWlmIChjb25uX3N0YXRlLT5jcnRjICE9ICZjcnRjLT5iYXNlKQogCQkJY29udGludWU7
CiAKIAkJaWYgKGVuY29kZXItPnByZV9lbmFibGUpCkBAIC02MDc2LDE5ICs2MDc2LDE5IEBAIHN0
YXRpYyB2b2lkIGludGVsX2VuY29kZXJzX3ByZV9lbmFibGUoc3RydWN0IGRybV9jcnRjICpjcnRj
LAogCX0KIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfZW5jb2RlcnNfZW5hYmxlKHN0cnVjdCBkcm1f
Y3J0YyAqY3J0YywKK3N0YXRpYyB2b2lkIGludGVsX2VuY29kZXJzX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YywKIAkJCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAotCQkJCSAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKKwkJCQkgIHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubjsKIAlpbnQg
aTsKIAotCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUob2xkX3N0YXRlLCBjb25uLCBj
b25uX3N0YXRlLCBpKSB7CisJZm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZSgmb2xkX3N0
YXRlLT5iYXNlLCBjb25uLCBjb25uX3N0YXRlLCBpKSB7CiAJCXN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyID0KIAkJCXRvX2ludGVsX2VuY29kZXIoY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVy
KTsKIAotCQlpZiAoY29ubl9zdGF0ZS0+Y3J0YyAhPSBjcnRjKQorCQlpZiAoY29ubl9zdGF0ZS0+
Y3J0YyAhPSAmY3J0Yy0+YmFzZSkKIAkJCWNvbnRpbnVlOwogCiAJCWlmIChlbmNvZGVyLT5lbmFi
bGUpCkBAIC02MDk3LDE5ICs2MDk3LDE5IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuY29kZXJzX2Vu
YWJsZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJfQogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9l
bmNvZGVyc19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKK3N0YXRpYyB2b2lkIGludGVs
X2VuY29kZXJzX2Rpc2FibGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAotCQkJCSAgIHN0cnVjdCBkcm1fYXRv
bWljX3N0YXRlICpvbGRfc3RhdGUpCisJCQkJICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
b2xkX3N0YXRlKQogewogCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0
ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubjsKIAlpbnQgaTsKIAotCWZvcl9lYWNoX29s
ZF9jb25uZWN0b3JfaW5fc3RhdGUob2xkX3N0YXRlLCBjb25uLCBvbGRfY29ubl9zdGF0ZSwgaSkg
eworCWZvcl9lYWNoX29sZF9jb25uZWN0b3JfaW5fc3RhdGUoJm9sZF9zdGF0ZS0+YmFzZSwgY29u
biwgb2xkX2Nvbm5fc3RhdGUsIGkpIHsKIAkJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIg
PQogCQkJdG9faW50ZWxfZW5jb2RlcihvbGRfY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVyKTsKIAot
CQlpZiAob2xkX2Nvbm5fc3RhdGUtPmNydGMgIT0gY3J0YykKKwkJaWYgKG9sZF9jb25uX3N0YXRl
LT5jcnRjICE9ICZjcnRjLT5iYXNlKQogCQkJY29udGludWU7CiAKIAkJaW50ZWxfb3ByZWdpb25f
bm90aWZ5X2VuY29kZXIoZW5jb2RlciwgZmFsc2UpOwpAQCAtNjExOCwxOSArNjExOCwxOSBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyc19kaXNhYmxlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywK
IAl9CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX2VuY29kZXJzX3Bvc3RfZGlzYWJsZShzdHJ1Y3Qg
ZHJtX2NydGMgKmNydGMsCitzdGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyc19wb3N0X2Rpc2FibGUo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpv
bGRfY3J0Y19zdGF0ZSwKLQkJCQkJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkK
KwkJCQkJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogewogCXN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubjsKIAlpbnQgaTsKIAotCWZvcl9lYWNoX29sZF9jb25uZWN0b3JfaW5fc3RhdGUob2xk
X3N0YXRlLCBjb25uLCBvbGRfY29ubl9zdGF0ZSwgaSkgeworCWZvcl9lYWNoX29sZF9jb25uZWN0
b3JfaW5fc3RhdGUoJm9sZF9zdGF0ZS0+YmFzZSwgY29ubiwgb2xkX2Nvbm5fc3RhdGUsIGkpIHsK
IAkJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPQogCQkJdG9faW50ZWxfZW5jb2Rlcihv
bGRfY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVyKTsKIAotCQlpZiAob2xkX2Nvbm5fc3RhdGUtPmNy
dGMgIT0gY3J0YykKKwkJaWYgKG9sZF9jb25uX3N0YXRlLT5jcnRjICE9ICZjcnRjLT5iYXNlKQog
CQkJY29udGludWU7CiAKIAkJaWYgKGVuY29kZXItPnBvc3RfZGlzYWJsZSkKQEAgLTYxMzgsMTkg
KzYxMzgsMTkgQEAgc3RhdGljIHZvaWQgaW50ZWxfZW5jb2RlcnNfcG9zdF9kaXNhYmxlKHN0cnVj
dCBkcm1fY3J0YyAqY3J0YywKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX2VuY29kZXJzX3Bv
c3RfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAorc3RhdGljIHZvaWQgaW50ZWxf
ZW5jb2RlcnNfcG9zdF9wbGxfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkJ
ICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKLQkJCQkJICAgIHN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCisJCQkJCSAgICBzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUg
Km9sZF9jb25uX3N0YXRlOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uOwogCWludCBpOwog
Ci0JZm9yX2VhY2hfb2xkX2Nvbm5lY3Rvcl9pbl9zdGF0ZShvbGRfc3RhdGUsIGNvbm4sIG9sZF9j
b25uX3N0YXRlLCBpKSB7CisJZm9yX2VhY2hfb2xkX2Nvbm5lY3Rvcl9pbl9zdGF0ZSgmb2xkX3N0
YXRlLT5iYXNlLCBjb25uLCBvbGRfY29ubl9zdGF0ZSwgaSkgewogCQlzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciA9CiAJCQl0b19pbnRlbF9lbmNvZGVyKG9sZF9jb25uX3N0YXRlLT5iZXN0
X2VuY29kZXIpOwogCi0JCWlmIChvbGRfY29ubl9zdGF0ZS0+Y3J0YyAhPSBjcnRjKQorCQlpZiAo
b2xkX2Nvbm5fc3RhdGUtPmNydGMgIT0gJmNydGMtPmJhc2UpCiAJCQljb250aW51ZTsKIAogCQlp
ZiAoZW5jb2Rlci0+cG9zdF9wbGxfZGlzYWJsZSkKQEAgLTYxNTgsMTkgKzYxNTgsMTkgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZW5jb2RlcnNfcG9zdF9wbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsCiAJfQogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyc191cGRhdGVfcGlwZShz
dHJ1Y3QgZHJtX2NydGMgKmNydGMsCitzdGF0aWMgdm9pZCBpbnRlbF9lbmNvZGVyc191cGRhdGVf
cGlwZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkgICAgICAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJICAgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpvbGRfc3RhdGUpCisJCQkJICAgICAgIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9z
dGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZTsKIAlzdHJ1
Y3QgZHJtX2Nvbm5lY3RvciAqY29ubjsKIAlpbnQgaTsKIAotCWZvcl9lYWNoX25ld19jb25uZWN0
b3JfaW5fc3RhdGUob2xkX3N0YXRlLCBjb25uLCBjb25uX3N0YXRlLCBpKSB7CisJZm9yX2VhY2hf
bmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZSgmb2xkX3N0YXRlLT5iYXNlLCBjb25uLCBjb25uX3N0YXRl
LCBpKSB7CiAJCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyID0KIAkJCXRvX2ludGVsX2Vu
Y29kZXIoY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVyKTsKIAotCQlpZiAoY29ubl9zdGF0ZS0+Y3J0
YyAhPSBjcnRjKQorCQlpZiAoY29ubl9zdGF0ZS0+Y3J0YyAhPSAmY3J0Yy0+YmFzZSkKIAkJCWNv
bnRpbnVlOwogCiAJCWlmIChlbmNvZGVyLT51cGRhdGVfcGlwZSkKQEAgLTYxODcsMTUgKzYxODcs
MTMgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJsZV9wcmltYXJ5X3BsYW5lKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXQKIH0KIAogc3RhdGljIHZvaWQgaXJvbmxha2Vf
Y3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAotCQkJCSBz
dHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQorCQkJCSBzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpvbGRfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlwZV9j
b25maWctPmJhc2UuY3J0YzsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+ZGV2Owog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7CiAJaW50IHBp
cGUgPSBpbnRlbF9jcnRjLT5waXBlOwotCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9p
bnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShvbGRfc3RhdGUpOwogCiAJaWYg
KFdBUk5fT04oaW50ZWxfY3J0Yy0+YWN0aXZlKSkKIAkJcmV0dXJuOwpAQCAtNjIzMSw3ICs2MjI5
LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKnBpcGVfY29uZmlnLAogCiAJaW50ZWxfY3J0Yy0+YWN0aXZlID0gdHJ1ZTsKIAotCWlu
dGVsX2VuY29kZXJzX3ByZV9lbmFibGUoY3J0YywgcGlwZV9jb25maWcsIG9sZF9zdGF0ZSk7CisJ
aW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJsZShpbnRlbF9jcnRjLCBwaXBlX2NvbmZpZywgb2xkX3N0
YXRlKTsKIAogCWlmIChwaXBlX2NvbmZpZy0+aGFzX3BjaF9lbmNvZGVyKSB7CiAJCS8qIE5vdGU6
IEZESSBQTEwgZW5hYmxpbmcgX211c3RfIGJlIGRvbmUgYmVmb3JlIHdlIGVuYWJsZSB0aGUKQEAg
LTYyNTUsMTYgKzYyNTMsMTYgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfY3J0Y19lbmFibGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCWludGVsX2Rpc2FibGVfcHJpbWFy
eV9wbGFuZShwaXBlX2NvbmZpZyk7CiAKIAlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93
YXRlcm1hcmtzICE9IE5VTEwpCi0JCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJr
cyhvbGRfaW50ZWxfc3RhdGUsIHBpcGVfY29uZmlnKTsKKwkJZGV2X3ByaXYtPmRpc3BsYXkuaW5p
dGlhbF93YXRlcm1hcmtzKG9sZF9zdGF0ZSwgcGlwZV9jb25maWcpOwogCWludGVsX2VuYWJsZV9w
aXBlKHBpcGVfY29uZmlnKTsKIAogCWlmIChwaXBlX2NvbmZpZy0+aGFzX3BjaF9lbmNvZGVyKQot
CQlpcm9ubGFrZV9wY2hfZW5hYmxlKG9sZF9pbnRlbF9zdGF0ZSwgcGlwZV9jb25maWcpOworCQlp
cm9ubGFrZV9wY2hfZW5hYmxlKG9sZF9zdGF0ZSwgcGlwZV9jb25maWcpOwogCiAJYXNzZXJ0X3Zi
bGFua19kaXNhYmxlZChjcnRjKTsKIAlpbnRlbF9jcnRjX3ZibGFua19vbihwaXBlX2NvbmZpZyk7
CiAKLQlpbnRlbF9lbmNvZGVyc19lbmFibGUoY3J0YywgcGlwZV9jb25maWcsIG9sZF9zdGF0ZSk7
CisJaW50ZWxfZW5jb2RlcnNfZW5hYmxlKGludGVsX2NydGMsIHBpcGVfY29uZmlnLCBvbGRfc3Rh
dGUpOwogCiAJaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSkKIAkJY3B0X3ZlcmlmeV9tb2Rlc2V0
KGRldiwgaW50ZWxfY3J0Yy0+cGlwZSk7CkBAIC02MzE3LDI2ICs2MzE1LDI0IEBAIHN0YXRpYyB2
b2lkIGljbF9waXBlX21idXNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogfQogCiBz
dGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpw
aXBlX2NvbmZpZywKLQkJCQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQorCQkJ
CXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMgPSBwaXBlX2NvbmZpZy0+YmFzZS5jcnRjOwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7CiAJaW50IHBpcGUgPSBpbnRlbF9jcnRj
LT5waXBlLCBoc3dfd29ya2Fyb3VuZF9waXBlOwogCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNj
b2RlciA9IHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlcjsKLQlzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpvbGRfaW50ZWxfc3RhdGUgPQotCQl0b19pbnRlbF9hdG9taWNfc3RhdGUob2xkX3N0
YXRlKTsKIAlib29sIHBzbF9jbGtnYXRlX3dhOwogCiAJaWYgKFdBUk5fT04oaW50ZWxfY3J0Yy0+
YWN0aXZlKSkKIAkJcmV0dXJuOwogCi0JaW50ZWxfZW5jb2RlcnNfcHJlX3BsbF9lbmFibGUoY3J0
YywgcGlwZV9jb25maWcsIG9sZF9zdGF0ZSk7CisJaW50ZWxfZW5jb2RlcnNfcHJlX3BsbF9lbmFi
bGUoaW50ZWxfY3J0YywgcGlwZV9jb25maWcsIG9sZF9zdGF0ZSk7CiAKIAlpZiAocGlwZV9jb25m
aWctPnNoYXJlZF9kcGxsKQogCQlpbnRlbF9lbmFibGVfc2hhcmVkX2RwbGwocGlwZV9jb25maWcp
OwogCi0JaW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJsZShjcnRjLCBwaXBlX2NvbmZpZywgb2xkX3N0
YXRlKTsKKwlpbnRlbF9lbmNvZGVyc19wcmVfZW5hYmxlKGludGVsX2NydGMsIHBpcGVfY29uZmln
LCBvbGRfc3RhdGUpOwogCiAJaWYgKGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIocGlwZV9jb25m
aWcpKQogCQlpbnRlbF9kcF9zZXRfbV9uKHBpcGVfY29uZmlnLCBNMV9OMSk7CkBAIC02Mzk0LDcg
KzYzOTAsNyBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJaW50ZWxfZGRpX2VuYWJsZV90cmFuc2NvZGVyX2Z1
bmMocGlwZV9jb25maWcpOwogCiAJaWYgKGRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJt
YXJrcyAhPSBOVUxMKQotCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3Mob2xk
X2ludGVsX3N0YXRlLCBwaXBlX2NvbmZpZyk7CisJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxf
d2F0ZXJtYXJrcyhvbGRfc3RhdGUsIHBpcGVfY29uZmlnKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDExKQogCQlpY2xfcGlwZV9tYnVzX2VuYWJsZShpbnRlbF9jcnRjKTsKQEAgLTY0
MDQsNyArNjQwMCw3IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQlpbnRlbF9lbmFibGVfcGlwZShwaXBlX2Nv
bmZpZyk7CiAKIAlpZiAocGlwZV9jb25maWctPmhhc19wY2hfZW5jb2RlcikKLQkJbHB0X3BjaF9l
bmFibGUob2xkX2ludGVsX3N0YXRlLCBwaXBlX2NvbmZpZyk7CisJCWxwdF9wY2hfZW5hYmxlKG9s
ZF9zdGF0ZSwgcGlwZV9jb25maWcpOwogCiAJaWYgKGludGVsX2NydGNfaGFzX3R5cGUocGlwZV9j
b25maWcsIElOVEVMX09VVFBVVF9EUF9NU1QpKQogCQlpbnRlbF9kZGlfc2V0X3ZjX3BheWxvYWRf
YWxsb2MocGlwZV9jb25maWcsIHRydWUpOwpAQCAtNjQxMiw3ICs2NDA4LDcgQEAgc3RhdGljIHZv
aWQgaGFzd2VsbF9jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25m
aWcsCiAJYXNzZXJ0X3ZibGFua19kaXNhYmxlZChjcnRjKTsKIAlpbnRlbF9jcnRjX3ZibGFua19v
bihwaXBlX2NvbmZpZyk7CiAKLQlpbnRlbF9lbmNvZGVyc19lbmFibGUoY3J0YywgcGlwZV9jb25m
aWcsIG9sZF9zdGF0ZSk7CisJaW50ZWxfZW5jb2RlcnNfZW5hYmxlKGludGVsX2NydGMsIHBpcGVf
Y29uZmlnLCBvbGRfc3RhdGUpOwogCiAJaWYgKHBzbF9jbGtnYXRlX3dhKSB7CiAJCWludGVsX3dh
aXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgcGlwZSk7CkBAIC02NDQ0LDcgKzY0NDAsNyBAQCBzdGF0
aWMgdm9pZCBpcm9ubGFrZV9wZml0X2Rpc2FibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm9sZF9jcnRjX3N0YXRlKQogfQogCiBzdGF0aWMgdm9pZCBpcm9ubGFrZV9jcnRjX2Rpc2Fi
bGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAotCQkJCSAgc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKKwkJCQkgIHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKm9sZF9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGMgPSBvbGRfY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7CkBA
IC02NDYwLDcgKzY0NTYsNyBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9jcnRjX2Rpc2FibGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCWludGVsX3NldF9jcHVfZmlm
b191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBpcGUsIGZhbHNlKTsKIAlpbnRlbF9zZXRf
cGNoX2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBwaXBlLCBmYWxzZSk7CiAKLQlp
bnRlbF9lbmNvZGVyc19kaXNhYmxlKGNydGMsIG9sZF9jcnRjX3N0YXRlLCBvbGRfc3RhdGUpOwor
CWludGVsX2VuY29kZXJzX2Rpc2FibGUoaW50ZWxfY3J0Yywgb2xkX2NydGNfc3RhdGUsIG9sZF9z
dGF0ZSk7CiAKIAlkcm1fY3J0Y192Ymxhbmtfb2ZmKGNydGMpOwogCWFzc2VydF92YmxhbmtfZGlz
YWJsZWQoY3J0Yyk7CkBAIC02NDcyLDcgKzY0NjgsNyBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9j
cnRjX2Rpc2FibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCWlm
IChvbGRfY3J0Y19zdGF0ZS0+aGFzX3BjaF9lbmNvZGVyKQogCQlpcm9ubGFrZV9mZGlfZGlzYWJs
ZShjcnRjKTsKIAotCWludGVsX2VuY29kZXJzX3Bvc3RfZGlzYWJsZShjcnRjLCBvbGRfY3J0Y19z
dGF0ZSwgb2xkX3N0YXRlKTsKKwlpbnRlbF9lbmNvZGVyc19wb3N0X2Rpc2FibGUoaW50ZWxfY3J0
Yywgb2xkX2NydGNfc3RhdGUsIG9sZF9zdGF0ZSk7CiAKIAlpZiAob2xkX2NydGNfc3RhdGUtPmhh
c19wY2hfZW5jb2RlcikgewogCQlpcm9ubGFrZV9kaXNhYmxlX3BjaF90cmFuc2NvZGVyKGRldl9w
cml2LCBwaXBlKTsKQEAgLTY1MDMsMTQgKzY0OTksMTQgQEAgc3RhdGljIHZvaWQgaXJvbmxha2Vf
Y3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIH0K
IAogc3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2Rpc2FibGUoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm9sZF9jcnRjX3N0YXRlLAotCQkJCSBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0
YXRlKQorCQkJCSBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCiB7CiAJc3Ry
dWN0IGRybV9jcnRjICpjcnRjID0gb2xkX2NydGNfc3RhdGUtPmJhc2UuY3J0YzsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwogCWVudW0gdHJh
bnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IG9sZF9jcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsK
IAotCWludGVsX2VuY29kZXJzX2Rpc2FibGUoY3J0Yywgb2xkX2NydGNfc3RhdGUsIG9sZF9zdGF0
ZSk7CisJaW50ZWxfZW5jb2RlcnNfZGlzYWJsZShpbnRlbF9jcnRjLCBvbGRfY3J0Y19zdGF0ZSwg
b2xkX3N0YXRlKTsKIAogCWRybV9jcnRjX3ZibGFua19vZmYoY3J0Yyk7CiAJYXNzZXJ0X3ZibGFu
a19kaXNhYmxlZChjcnRjKTsKQEAgLTY1MzIsOSArNjUyOCw5IEBAIHN0YXRpYyB2b2lkIGhhc3dl
bGxfY3J0Y19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwK
IAllbHNlCiAJCWlyb25sYWtlX3BmaXRfZGlzYWJsZShvbGRfY3J0Y19zdGF0ZSk7CiAKLQlpbnRl
bF9lbmNvZGVyc19wb3N0X2Rpc2FibGUoY3J0Yywgb2xkX2NydGNfc3RhdGUsIG9sZF9zdGF0ZSk7
CisJaW50ZWxfZW5jb2RlcnNfcG9zdF9kaXNhYmxlKGludGVsX2NydGMsIG9sZF9jcnRjX3N0YXRl
LCBvbGRfc3RhdGUpOwogCi0JaW50ZWxfZW5jb2RlcnNfcG9zdF9wbGxfZGlzYWJsZShjcnRjLCBv
bGRfY3J0Y19zdGF0ZSwgb2xkX3N0YXRlKTsKKwlpbnRlbF9lbmNvZGVyc19wb3N0X3BsbF9kaXNh
YmxlKGludGVsX2NydGMsIG9sZF9jcnRjX3N0YXRlLCBvbGRfc3RhdGUpOwogfQogCiBzdGF0aWMg
dm9pZCBpOXh4X3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQpAQCAtNjYzMywxNCArNjYyOSwxMyBAQCBpbnRlbF9hdXhfcG93ZXJfZG9tYWluKHN0
cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0KQogCX0KIH0KIAotc3RhdGljIHU2NCBn
ZXRfY3J0Y19wb3dlcl9kb21haW5zKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKK3N0YXRpYyB1NjQg
Z2V0X2NydGNfcG93ZXJfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkgIHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYgPSBjcnRjLT5kZXY7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2Uu
ZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsK
IAlzdHJ1Y3QgZHJtX2VuY29kZXIgKmVuY29kZXI7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVs
X2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwotCWVudW0gcGlwZSBwaXBlID0gaW50ZWxfY3J0
Yy0+cGlwZTsKKwllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTY0IG1hc2s7CiAJZW51
bSB0cmFuc2NvZGVyIHRyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKIApA
QCAtNjY2OSwxNiArNjY2NCwxNSBAQCBzdGF0aWMgdTY0IGdldF9jcnRjX3Bvd2VyX2RvbWFpbnMo
c3RydWN0IGRybV9jcnRjICpjcnRjLAogfQogCiBzdGF0aWMgdTY0Ci1tb2Rlc2V0X2dldF9jcnRj
X3Bvd2VyX2RvbWFpbnMoc3RydWN0IGRybV9jcnRjICpjcnRjLAorbW9kZXNldF9nZXRfY3J0Y19w
b3dlcl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgICAgIHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50
ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBpbnRlbF9kaXNwbGF5
X3Bvd2VyX2RvbWFpbiBkb21haW47CiAJdTY0IGRvbWFpbnMsIG5ld19kb21haW5zLCBvbGRfZG9t
YWluczsKIAotCW9sZF9kb21haW5zID0gaW50ZWxfY3J0Yy0+ZW5hYmxlZF9wb3dlcl9kb21haW5z
OwotCWludGVsX2NydGMtPmVuYWJsZWRfcG93ZXJfZG9tYWlucyA9IG5ld19kb21haW5zID0KKwlv
bGRfZG9tYWlucyA9IGNydGMtPmVuYWJsZWRfcG93ZXJfZG9tYWluczsKKwljcnRjLT5lbmFibGVk
X3Bvd2VyX2RvbWFpbnMgPSBuZXdfZG9tYWlucyA9CiAJCWdldF9jcnRjX3Bvd2VyX2RvbWFpbnMo
Y3J0YywgY3J0Y19zdGF0ZSk7CiAKIAlkb21haW5zID0gbmV3X2RvbWFpbnMgJiB+b2xkX2RvbWFp
bnM7CkBAIC02Njk5LDEwICs2NjkzLDggQEAgc3RhdGljIHZvaWQgbW9kZXNldF9wdXRfcG93ZXJf
ZG9tYWlucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAKIHN0YXRpYyB2
b2lkIHZhbGxleXZpZXdfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnLAotCQkJCSAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpCisJCQkJ
ICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKm9sZF9pbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0
ZShvbGRfc3RhdGUpOwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmlnLT5iYXNl
LmNydGM7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CkBAIC02NzI5LDcgKzY3MjEs
NyBAQCBzdGF0aWMgdm9pZCB2YWxsZXl2aWV3X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpwaXBlX2NvbmZpZywKIAogCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBv
cnRpbmcoZGV2X3ByaXYsIHBpcGUsIHRydWUpOwogCi0JaW50ZWxfZW5jb2RlcnNfcHJlX3BsbF9l
bmFibGUoY3J0YywgcGlwZV9jb25maWcsIG9sZF9zdGF0ZSk7CisJaW50ZWxfZW5jb2RlcnNfcHJl
X3BsbF9lbmFibGUoaW50ZWxfY3J0YywgcGlwZV9jb25maWcsIG9sZF9zdGF0ZSk7CiAKIAlpZiAo
SVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKIAkJY2h2X3ByZXBhcmVfcGxsKGludGVsX2NydGMs
IHBpcGVfY29uZmlnKTsKQEAgLTY3MzksNyArNjczMSw3IEBAIHN0YXRpYyB2b2lkIHZhbGxleXZp
ZXdfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQl2
bHZfZW5hYmxlX3BsbChpbnRlbF9jcnRjLCBwaXBlX2NvbmZpZyk7CiAJfQogCi0JaW50ZWxfZW5j
b2RlcnNfcHJlX2VuYWJsZShjcnRjLCBwaXBlX2NvbmZpZywgb2xkX3N0YXRlKTsKKwlpbnRlbF9l
bmNvZGVyc19wcmVfZW5hYmxlKGludGVsX2NydGMsIHBpcGVfY29uZmlnLCBvbGRfc3RhdGUpOwog
CiAJaTl4eF9wZml0X2VuYWJsZShwaXBlX2NvbmZpZyk7CiAKQEAgLTY3NDgsMTQgKzY3NDAsMTMg
QEAgc3RhdGljIHZvaWQgdmFsbGV5dmlld19jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcsCiAJLyogdXBkYXRlIERTUENOVFIgdG8gY29uZmlndXJlIGdhbW1h
IGZvciBwaXBlIGJvdHRvbSBjb2xvciAqLwogCWludGVsX2Rpc2FibGVfcHJpbWFyeV9wbGFuZShw
aXBlX2NvbmZpZyk7CiAKLQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3Mob2xk
X2ludGVsX3N0YXRlLAotCQkJCQkgICAgIHBpcGVfY29uZmlnKTsKKwlkZXZfcHJpdi0+ZGlzcGxh
eS5pbml0aWFsX3dhdGVybWFya3Mob2xkX3N0YXRlLCBwaXBlX2NvbmZpZyk7CiAJaW50ZWxfZW5h
YmxlX3BpcGUocGlwZV9jb25maWcpOwogCiAJYXNzZXJ0X3ZibGFua19kaXNhYmxlZChjcnRjKTsK
IAlpbnRlbF9jcnRjX3ZibGFua19vbihwaXBlX2NvbmZpZyk7CiAKLQlpbnRlbF9lbmNvZGVyc19l
bmFibGUoY3J0YywgcGlwZV9jb25maWcsIG9sZF9zdGF0ZSk7CisJaW50ZWxfZW5jb2RlcnNfZW5h
YmxlKGludGVsX2NydGMsIHBpcGVfY29uZmlnLCBvbGRfc3RhdGUpOwogfQogCiBzdGF0aWMgdm9p
ZCBpOXh4X3NldF9wbGxfZGl2aWRlcnMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCkBAIC02NzY4LDEwICs2NzU5LDggQEAgc3RhdGljIHZvaWQgaTl4eF9zZXRfcGxs
X2RpdmlkZXJzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogfQog
CiBzdGF0aWMgdm9pZCBpOXh4X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpw
aXBlX2NvbmZpZywKLQkJCSAgICAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkK
KwkJCSAgICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKQogewotCXN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9pbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21p
Y19zdGF0ZShvbGRfc3RhdGUpOwogCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IHBpcGVfY29uZmln
LT5iYXNlLmNydGM7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmRldjsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CkBAIC02Nzk2LDcg
KzY3ODUsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpwaXBlX2NvbmZpZywKIAlpZiAoIUlTX0dFTihkZXZfcHJpdiwgMikpCiAJCWludGVs
X3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBpcGUsIHRydWUpOwog
Ci0JaW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJsZShjcnRjLCBwaXBlX2NvbmZpZywgb2xkX3N0YXRl
KTsKKwlpbnRlbF9lbmNvZGVyc19wcmVfZW5hYmxlKGludGVsX2NydGMsIHBpcGVfY29uZmlnLCBv
bGRfc3RhdGUpOwogCiAJaTl4eF9lbmFibGVfcGxsKGludGVsX2NydGMsIHBpcGVfY29uZmlnKTsK
IApAQCAtNjgwOCw3ICs2Nzk3LDcgQEAgc3RhdGljIHZvaWQgaTl4eF9jcnRjX2VuYWJsZShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJaW50ZWxfZGlzYWJsZV9wcmltYXJ5
X3BsYW5lKHBpcGVfY29uZmlnKTsKIAogCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dh
dGVybWFya3MgIT0gTlVMTCkKLQkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtz
KG9sZF9pbnRlbF9zdGF0ZSwKKwkJZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtz
KG9sZF9zdGF0ZSwKIAkJCQkJCSAgICAgcGlwZV9jb25maWcpOwogCWVsc2UKIAkJaW50ZWxfdXBk
YXRlX3dhdGVybWFya3MoaW50ZWxfY3J0Yyk7CkBAIC02ODE3LDcgKzY4MDYsNyBAQCBzdGF0aWMg
dm9pZCBpOXh4X2NydGNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZywKIAlhc3NlcnRfdmJsYW5rX2Rpc2FibGVkKGNydGMpOwogCWludGVsX2NydGNfdmJsYW5rX29u
KHBpcGVfY29uZmlnKTsKIAotCWludGVsX2VuY29kZXJzX2VuYWJsZShjcnRjLCBwaXBlX2NvbmZp
Zywgb2xkX3N0YXRlKTsKKwlpbnRlbF9lbmNvZGVyc19lbmFibGUoaW50ZWxfY3J0YywgcGlwZV9j
b25maWcsIG9sZF9zdGF0ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGk5eHhfcGZpdF9kaXNhYmxlKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKQEAgLTY4MzYsNyAr
NjgyNSw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfcGZpdF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKIH0KIAogc3RhdGljIHZvaWQgaTl4eF9jcnRj
X2Rpc2FibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAotCQkJICAg
ICAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKKwkJCSAgICAgIHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGMg
PSBvbGRfY3J0Y19zdGF0ZS0+YmFzZS5jcnRjOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
cnRjLT5kZXY7CkBAIC02ODUxLDcgKzY4NDAsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2NydGNfZGlz
YWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJaWYgKElTX0dF
TihkZXZfcHJpdiwgMikpCiAJCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgcGlwZSk7
CiAKLQlpbnRlbF9lbmNvZGVyc19kaXNhYmxlKGNydGMsIG9sZF9jcnRjX3N0YXRlLCBvbGRfc3Rh
dGUpOworCWludGVsX2VuY29kZXJzX2Rpc2FibGUoaW50ZWxfY3J0Yywgb2xkX2NydGNfc3RhdGUs
IG9sZF9zdGF0ZSk7CiAKIAlkcm1fY3J0Y192Ymxhbmtfb2ZmKGNydGMpOwogCWFzc2VydF92Ymxh
bmtfZGlzYWJsZWQoY3J0Yyk7CkBAIC02ODYwLDcgKzY4NDksNyBAQCBzdGF0aWMgdm9pZCBpOXh4
X2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAK
IAlpOXh4X3BmaXRfZGlzYWJsZShvbGRfY3J0Y19zdGF0ZSk7CiAKLQlpbnRlbF9lbmNvZGVyc19w
b3N0X2Rpc2FibGUoY3J0Yywgb2xkX2NydGNfc3RhdGUsIG9sZF9zdGF0ZSk7CisJaW50ZWxfZW5j
b2RlcnNfcG9zdF9kaXNhYmxlKGludGVsX2NydGMsIG9sZF9jcnRjX3N0YXRlLCBvbGRfc3RhdGUp
OwogCiAJaWYgKCFpbnRlbF9jcnRjX2hhc190eXBlKG9sZF9jcnRjX3N0YXRlLCBJTlRFTF9PVVRQ
VVRfRFNJKSkgewogCQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCkBAIC02ODcxLDcgKzY4
NjAsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X2NydGNfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQlpOXh4X2Rpc2FibGVfcGxsKG9sZF9jcnRjX3N0YXRl
KTsKIAl9CiAKLQlpbnRlbF9lbmNvZGVyc19wb3N0X3BsbF9kaXNhYmxlKGNydGMsIG9sZF9jcnRj
X3N0YXRlLCBvbGRfc3RhdGUpOworCWludGVsX2VuY29kZXJzX3Bvc3RfcGxsX2Rpc2FibGUoaW50
ZWxfY3J0Yywgb2xkX2NydGNfc3RhdGUsIG9sZF9zdGF0ZSk7CiAKIAlpZiAoIUlTX0dFTihkZXZf
cHJpdiwgMikpCiAJCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3By
aXYsIHBpcGUsIGZhbHNlKTsKQEAgLTY5MjUsNyArNjkxNCw3IEBAIHN0YXRpYyB2b2lkIGludGVs
X2NydGNfZGlzYWJsZV9ub2F0b21pYyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAKIAlXQVJOX09O
KElTX0VSUihjcnRjX3N0YXRlKSB8fCByZXQpOwogCi0JZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19k
aXNhYmxlKGNydGNfc3RhdGUsIHN0YXRlKTsKKwlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rpc2Fi
bGUoY3J0Y19zdGF0ZSwgdG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKSk7CiAKIAlkcm1fYXRv
bWljX3N0YXRlX3B1dChzdGF0ZSk7CiAKQEAgLTEzMDgzLDE5ICsxMzA3MiwxOCBAQCB2ZXJpZnlf
c2hhcmVkX2RwbGxfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9jcnRj
ICpjcnRjLAogfQogCiBzdGF0aWMgdm9pZAotaW50ZWxfbW9kZXNldF92ZXJpZnlfY3J0YyhzdHJ1
Y3QgZHJtX2NydGMgKmNydGMsCi0JCQkgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwK
LQkJCSAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfc3RhdGUsCi0JCQkgIHN0cnVjdCBkcm1f
Y3J0Y19zdGF0ZSAqbmV3X3N0YXRlKQoraW50ZWxfbW9kZXNldF92ZXJpZnlfY3J0YyhzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUs
CisJCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfc3RhdGUsCisJCQkgIHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpuZXdfc3RhdGUpCiB7Ci0JaWYgKCFuZWVkc19tb2Rlc2V0KHRvX2lu
dGVsX2NydGNfc3RhdGUobmV3X3N0YXRlKSkgJiYKLQkgICAgIXRvX2ludGVsX2NydGNfc3RhdGUo
bmV3X3N0YXRlKS0+dXBkYXRlX3BpcGUpCisJaWYgKCFuZWVkc19tb2Rlc2V0KG5ld19zdGF0ZSkg
JiYgIW5ld19zdGF0ZS0+dXBkYXRlX3BpcGUpCiAJCXJldHVybjsKIAotCXZlcmlmeV93bV9zdGF0
ZShjcnRjLCBuZXdfc3RhdGUpOwotCXZlcmlmeV9jb25uZWN0b3Jfc3RhdGUoY3J0Yy0+ZGV2LCBz
dGF0ZSwgY3J0Yyk7Ci0JdmVyaWZ5X2NydGNfc3RhdGUoY3J0Yywgb2xkX3N0YXRlLCBuZXdfc3Rh
dGUpOwotCXZlcmlmeV9zaGFyZWRfZHBsbF9zdGF0ZShjcnRjLT5kZXYsIGNydGMsIG9sZF9zdGF0
ZSwgbmV3X3N0YXRlKTsKKwl2ZXJpZnlfd21fc3RhdGUoJmNydGMtPmJhc2UsICZuZXdfc3RhdGUt
PmJhc2UpOworCXZlcmlmeV9jb25uZWN0b3Jfc3RhdGUoY3J0Yy0+YmFzZS5kZXYsICZzdGF0ZS0+
YmFzZSwgJmNydGMtPmJhc2UpOworCXZlcmlmeV9jcnRjX3N0YXRlKCZjcnRjLT5iYXNlLCAmb2xk
X3N0YXRlLT5iYXNlLCAmbmV3X3N0YXRlLT5iYXNlKTsKKwl2ZXJpZnlfc2hhcmVkX2RwbGxfc3Rh
dGUoY3J0Yy0+YmFzZS5kZXYsICZjcnRjLT5iYXNlLCAmb2xkX3N0YXRlLT5iYXNlLCAmbmV3X3N0
YXRlLT5iYXNlKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTEzMTEwLDEwICsxMzA5OCwxMCBAQCB2
ZXJpZnlfZGlzYWJsZWRfZHBsbF9zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiBzdGF0
aWMgdm9pZAogaW50ZWxfbW9kZXNldF92ZXJpZnlfZGlzYWJsZWQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKLQkJCSAgICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKKwkJCSAgICAg
IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXZlcmlmeV9lbmNvZGVyX3N0
YXRlKGRldiwgc3RhdGUpOwotCXZlcmlmeV9jb25uZWN0b3Jfc3RhdGUoZGV2LCBzdGF0ZSwgTlVM
TCk7CisJdmVyaWZ5X2VuY29kZXJfc3RhdGUoZGV2LCAmc3RhdGUtPmJhc2UpOworCXZlcmlmeV9j
b25uZWN0b3Jfc3RhdGUoZGV2LCAmc3RhdGUtPmJhc2UsIE5VTEwpOwogCXZlcmlmeV9kaXNhYmxl
ZF9kcGxsX3N0YXRlKGRldik7CiB9CiAKQEAgLTEzNTcwLDU3ICsxMzU1OCw1NCBAQCB1MzIgaW50
ZWxfY3J0Y19nZXRfdmJsYW5rX2NvdW50ZXIoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJcmV0
dXJuIGRldi0+ZHJpdmVyLT5nZXRfdmJsYW5rX2NvdW50ZXIoZGV2LCBjcnRjLT5waXBlKTsKIH0K
IAotc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX2NydGMoc3RydWN0IGRybV9jcnRjICpjcnRjLAot
CQkJICAgICAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAotCQkJICAgICAgc3RydWN0
IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKLQkJCSAgICAgIHN0cnVjdCBkcm1fY3J0
Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCitzdGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3J0Yyhz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgICAgIHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlLAorCQkJICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0
YXRlLAorCQkJICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQog
ewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5kZXY7CisJc3RydWN0IGRybV9kZXZp
Y2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKGNydGMpOwotCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZyA9IHRvX2ludGVsX2NydGNfc3RhdGUobmV3X2NydGNfc3RhdGUpOwotCWJvb2wgbW9kZXNldCA9
IG5lZWRzX21vZGVzZXQocGlwZV9jb25maWcpOworCWJvb2wgbW9kZXNldCA9IG5lZWRzX21vZGVz
ZXQobmV3X2NydGNfc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5l
X3N0YXRlID0KLQkJaW50ZWxfYXRvbWljX2dldF9uZXdfcGxhbmVfc3RhdGUodG9faW50ZWxfYXRv
bWljX3N0YXRlKHN0YXRlKSwKLQkJCQkJCSB0b19pbnRlbF9wbGFuZShjcnRjLT5wcmltYXJ5KSk7
CisJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLAorCQkJCQkJIHRvX2lu
dGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFyeSkpOwogCiAJaWYgKG1vZGVzZXQpIHsKLQkJdXBk
YXRlX3NjYW5saW5lX29mZnNldChwaXBlX2NvbmZpZyk7Ci0JCWRldl9wcml2LT5kaXNwbGF5LmNy
dGNfZW5hYmxlKHBpcGVfY29uZmlnLCBzdGF0ZSk7CisJCXVwZGF0ZV9zY2FubGluZV9vZmZzZXQo
bmV3X2NydGNfc3RhdGUpOworCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2VuYWJsZShuZXdfY3J0
Y19zdGF0ZSwgc3RhdGUpOwogCiAJCS8qIHZibGFua3Mgd29yayBhZ2FpbiwgcmUtZW5hYmxlIHBp
cGUgQ1JDLiAqLwotCQlpbnRlbF9jcnRjX2VuYWJsZV9waXBlX2NyYyhpbnRlbF9jcnRjKTsKKwkJ
aW50ZWxfY3J0Y19lbmFibGVfcGlwZV9jcmMoY3J0Yyk7CiAJfSBlbHNlIHsKLQkJaW50ZWxfcHJl
X3BsYW5lX3VwZGF0ZSh0b19pbnRlbF9jcnRjX3N0YXRlKG9sZF9jcnRjX3N0YXRlKSwKLQkJCQkg
ICAgICAgcGlwZV9jb25maWcpOworCQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9jcnRjX3N0
YXRlLCBuZXdfY3J0Y19zdGF0ZSk7CiAKLQkJaWYgKHBpcGVfY29uZmlnLT51cGRhdGVfcGlwZSkK
LQkJCWludGVsX2VuY29kZXJzX3VwZGF0ZV9waXBlKGNydGMsIHBpcGVfY29uZmlnLCBzdGF0ZSk7
CisJCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpCisJCQlpbnRlbF9lbmNvZGVyc191
cGRhdGVfcGlwZShjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgc3RhdGUpOwogCX0KIAotCWlmIChwaXBl
X2NvbmZpZy0+dXBkYXRlX3BpcGUgJiYgIXBpcGVfY29uZmlnLT5lbmFibGVfZmJjKQotCQlpbnRl
bF9mYmNfZGlzYWJsZShpbnRlbF9jcnRjKTsKKwlpZiAobmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9w
aXBlICYmICFuZXdfY3J0Y19zdGF0ZS0+ZW5hYmxlX2ZiYykKKwkJaW50ZWxfZmJjX2Rpc2FibGUo
Y3J0Yyk7CiAJZWxzZSBpZiAobmV3X3BsYW5lX3N0YXRlKQotCQlpbnRlbF9mYmNfZW5hYmxlKGlu
dGVsX2NydGMsIHBpcGVfY29uZmlnLCBuZXdfcGxhbmVfc3RhdGUpOworCQlpbnRlbF9mYmNfZW5h
YmxlKGNydGMsIG5ld19jcnRjX3N0YXRlLCBuZXdfcGxhbmVfc3RhdGUpOwogCi0JaW50ZWxfYmVn
aW5fY3J0Y19jb21taXQodG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKSwgaW50ZWxfY3J0Yyk7
CisJaW50ZWxfYmVnaW5fY3J0Y19jb21taXQoc3RhdGUsIGNydGMpOwogCiAJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gOSkKLQkJc2tsX3VwZGF0ZV9wbGFuZXNfb25fY3J0Yyh0b19pbnRlbF9h
dG9taWNfc3RhdGUoc3RhdGUpLCBpbnRlbF9jcnRjKTsKKwkJc2tsX3VwZGF0ZV9wbGFuZXNfb25f
Y3J0YyhzdGF0ZSwgY3J0Yyk7CiAJZWxzZQotCQlpOXh4X3VwZGF0ZV9wbGFuZXNfb25fY3J0Yyh0
b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpLCBpbnRlbF9jcnRjKTsKKwkJaTl4eF91cGRhdGVf
cGxhbmVzX29uX2NydGMoc3RhdGUsIGNydGMpOwogCi0JaW50ZWxfZmluaXNoX2NydGNfY29tbWl0
KHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSksIGludGVsX2NydGMpOworCWludGVsX2Zpbmlz
aF9jcnRjX2NvbW1pdChzdGF0ZSwgY3J0Yyk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3VwZGF0
ZV9jcnRjcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCitzdGF0aWMgdm9pZCBpbnRl
bF91cGRhdGVfY3J0Y3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3Ry
dWN0IGRybV9jcnRjICpjcnRjOwotCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3Rh
dGUsICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZTsKIAlpbnQg
aTsKIAotCWZvcl9lYWNoX29sZG5ld19jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0
Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YWN0
aXZlKQorCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBv
bGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUsIGkpIHsKKwkJaWYgKCFuZXdfY3J0Y19zdGF0
ZS0+YmFzZS5hY3RpdmUpCiAJCQljb250aW51ZTsKIAogCQlpbnRlbF91cGRhdGVfY3J0YyhjcnRj
LCBzdGF0ZSwgb2xkX2NydGNfc3RhdGUsCkBAIC0xMzYyOCwyNiArMTM2MTMsMjMgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfdXBkYXRlX2NydGNzKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAl9CiB9CiAKLXN0YXRpYyB2b2lkIHNrbF91cGRhdGVfY3J0Y3Moc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKnN0YXRlKQorc3RhdGljIHZvaWQgc2tsX3VwZGF0ZV9jcnRjcyhzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KHN0YXRlLT5kZXYpOwotCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmlu
dGVsX3N0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKTsKLQlzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGM7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGM7Ci0Jc3RydWN0IGRybV9j
cnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRlOwotCXN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjc3RhdGU7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwor
CXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRl
OwogCXVuc2lnbmVkIGludCB1cGRhdGVkID0gMDsKIAlib29sIHByb2dyZXNzOwogCWVudW0gcGlw
ZSBwaXBlOwogCWludCBpOwogCXU4IGh3X2VuYWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPndtLnNr
bF9ody5kZGIuZW5hYmxlZF9zbGljZXM7Ci0JdTggcmVxdWlyZWRfc2xpY2VzID0gaW50ZWxfc3Rh
dGUtPndtX3Jlc3VsdHMuZGRiLmVuYWJsZWRfc2xpY2VzOworCXU4IHJlcXVpcmVkX3NsaWNlcyA9
IHN0YXRlLT53bV9yZXN1bHRzLmRkYi5lbmFibGVkX3NsaWNlczsKIAlzdHJ1Y3Qgc2tsX2RkYl9l
bnRyeSBlbnRyaWVzW0k5MTVfTUFYX1BJUEVTXSA9IHt9OwogCi0JZm9yX2VhY2hfb2xkbmV3X2Ny
dGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwg
aSkKKwlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xk
X2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKQogCQkvKiBpZ25vcmUgYWxsb2NhdGlvbnMg
Zm9yIGNydGMncyB0aGF0IGhhdmUgYmVlbiB0dXJuZWQgb2ZmLiAqLwotCQlpZiAobmV3X2NydGNf
c3RhdGUtPmFjdGl2ZSkKLQkJCWVudHJpZXNbaV0gPSB0b19pbnRlbF9jcnRjX3N0YXRlKG9sZF9j
cnRjX3N0YXRlKS0+d20uc2tsLmRkYjsKKwkJaWYgKG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2
ZSkKKwkJCWVudHJpZXNbaV0gPSBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsKIAogCS8qIElm
IDJuZCBEQnVmIHNsaWNlIHJlcXVpcmVkLCBlbmFibGUgaXQgaGVyZSAqLwogCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA+IGh3X2VuYWJsZWRfc2xpY2Vz
KQpAQCAtMTM2NjIsMjQgKzEzNjQ0LDIyIEBAIHN0YXRpYyB2b2lkIHNrbF91cGRhdGVfY3J0Y3Mo
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWRvIHsKIAkJcHJvZ3Jlc3MgPSBmYWxz
ZTsKIAotCQlmb3JfZWFjaF9vbGRuZXdfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2Ny
dGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCWZvcl9lYWNoX29sZG5ld19pbnRlbF9j
cnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUs
IGkpIHsKIAkJCWJvb2wgdmJsX3dhaXQgPSBmYWxzZTsKLQkJCXVuc2lnbmVkIGludCBjbWFzayA9
IGRybV9jcnRjX21hc2soY3J0Yyk7CisJCQl1bnNpZ25lZCBpbnQgY21hc2sgPSBkcm1fY3J0Y19t
YXNrKCZjcnRjLT5iYXNlKTsKIAotCQkJaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Yyk7
Ci0JCQljc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKG5ld19jcnRjX3N0YXRlKTsKLQkJCXBp
cGUgPSBpbnRlbF9jcnRjLT5waXBlOworCQkJcGlwZSA9IGNydGMtPnBpcGU7CiAKLQkJCWlmICh1
cGRhdGVkICYgY21hc2sgfHwgIWNzdGF0ZS0+YmFzZS5hY3RpdmUpCisJCQlpZiAodXBkYXRlZCAm
IGNtYXNrIHx8ICFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCiAJCQkJY29udGludWU7CiAK
LQkJCWlmIChza2xfZGRiX2FsbG9jYXRpb25fb3ZlcmxhcHMoJmNzdGF0ZS0+d20uc2tsLmRkYiwK
KwkJCWlmIChza2xfZGRiX2FsbG9jYXRpb25fb3ZlcmxhcHMoJm5ld19jcnRjX3N0YXRlLT53bS5z
a2wuZGRiLAogCQkJCQkJCWVudHJpZXMsCiAJCQkJCQkJSU5URUxfSU5GTyhkZXZfcHJpdiktPm51
bV9waXBlcywgaSkpCiAJCQkJY29udGludWU7CiAKIAkJCXVwZGF0ZWQgfD0gY21hc2s7Ci0JCQll
bnRyaWVzW2ldID0gY3N0YXRlLT53bS5za2wuZGRiOworCQkJZW50cmllc1tpXSA9IG5ld19jcnRj
X3N0YXRlLT53bS5za2wuZGRiOwogCiAJCQkvKgogCQkJICogSWYgdGhpcyBpcyBhbiBhbHJlYWR5
IGFjdGl2ZSBwaXBlLCBpdCdzIEREQiBjaGFuZ2VkLApAQCAtMTM2ODcsMTAgKzEzNjY3LDEwIEBA
IHN0YXRpYyB2b2lkIHNrbF91cGRhdGVfY3J0Y3Moc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCQkJICogdGhlbiB3ZSBuZWVkIHRvIHdhaXQgZm9yIGEgdmJsYW5rIHRvIHBhc3MgZm9y
IHRoZQogCQkJICogbmV3IGRkYiBhbGxvY2F0aW9uIHRvIHRha2UgZWZmZWN0LgogCQkJICovCi0J
CQlpZiAoIXNrbF9kZGJfZW50cnlfZXF1YWwoJmNzdGF0ZS0+d20uc2tsLmRkYiwKLQkJCQkJCSAm
dG9faW50ZWxfY3J0Y19zdGF0ZShvbGRfY3J0Y19zdGF0ZSktPndtLnNrbC5kZGIpICYmCi0JCQkg
ICAgIW5ld19jcnRjX3N0YXRlLT5hY3RpdmVfY2hhbmdlZCAmJgotCQkJICAgIGludGVsX3N0YXRl
LT53bV9yZXN1bHRzLmRpcnR5X3BpcGVzICE9IHVwZGF0ZWQpCisJCQlpZiAoIXNrbF9kZGJfZW50
cnlfZXF1YWwoJm5ld19jcnRjX3N0YXRlLT53bS5za2wuZGRiLAorCQkJCQkJICZvbGRfY3J0Y19z
dGF0ZS0+d20uc2tsLmRkYikgJiYKKwkJCSAgICAhbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZl
X2NoYW5nZWQgJiYKKwkJCSAgICBzdGF0ZS0+d21fcmVzdWx0cy5kaXJ0eV9waXBlcyAhPSB1cGRh
dGVkKQogCQkJCXZibF93YWl0ID0gdHJ1ZTsKIAogCQkJaW50ZWxfdXBkYXRlX2NydGMoY3J0Yywg
c3RhdGUsIG9sZF9jcnRjX3N0YXRlLApAQCAtMTM3NjMsNTcgKzEzNzQzLDUwIEBAIHN0YXRpYyB2
b2lkIGludGVsX2F0b21pY19jbGVhbnVwX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQog
CWludGVsX2F0b21pY19oZWxwZXJfZnJlZV9zdGF0ZShpOTE1KTsKIH0KIAotc3RhdGljIHZvaWQg
aW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkK
K3N0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gc3RhdGUtPmRldjsK
LQlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSA9IHRvX2ludGVsX2F0b21p
Y19zdGF0ZShzdGF0ZSk7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRl
djsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0J
c3RydWN0IGRybV9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRlOwot
CXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfaW50ZWxfY3J0Y19zdGF0ZSwgKm9sZF9pbnRl
bF9jcnRjX3N0YXRlOwotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqaW50ZWxfY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUs
ICpvbGRfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAl1NjQgcHV0X2Rv
bWFpbnNbSTkxNV9NQVhfUElQRVNdID0ge307CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWYgPSAw
OwogCWludCBpOwogCi0JaW50ZWxfYXRvbWljX2NvbW1pdF9mZW5jZV93YWl0KGludGVsX3N0YXRl
KTsKKwlpbnRlbF9hdG9taWNfY29tbWl0X2ZlbmNlX3dhaXQoc3RhdGUpOwogCi0JZHJtX2F0b21p
Y19oZWxwZXJfd2FpdF9mb3JfZGVwZW5kZW5jaWVzKHN0YXRlKTsKKwlkcm1fYXRvbWljX2hlbHBl
cl93YWl0X2Zvcl9kZXBlbmRlbmNpZXMoJnN0YXRlLT5iYXNlKTsKIAotCWlmIChpbnRlbF9zdGF0
ZS0+bW9kZXNldCkKKwlpZiAoc3RhdGUtPm1vZGVzZXQpCiAJCXdha2VyZWYgPSBpbnRlbF9kaXNw
bGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX01PREVTRVQpOwogCi0JZm9yX2Vh
Y2hfb2xkbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdf
Y3J0Y19zdGF0ZSwgaSkgewotCQlvbGRfaW50ZWxfY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNf
c3RhdGUob2xkX2NydGNfc3RhdGUpOwotCQluZXdfaW50ZWxfY3J0Y19zdGF0ZSA9IHRvX2ludGVs
X2NydGNfc3RhdGUobmV3X2NydGNfc3RhdGUpOwotCQlpbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjKTsKLQotCQlpZiAobmVlZHNfbW9kZXNldChuZXdfaW50ZWxfY3J0Y19zdGF0ZSkgfHwK
LQkJICAgIG5ld19pbnRlbF9jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSkgeworCWZvcl9lYWNoX29s
ZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgbmV3
X2NydGNfc3RhdGUsIGkpIHsKKwkJaWYgKG5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpIHx8
CisJCSAgICBuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpIHsKIAotCQkJcHV0X2RvbWFpbnNb
aW50ZWxfY3J0Yy0+cGlwZV0gPQorCQkJcHV0X2RvbWFpbnNbY3J0Yy0+cGlwZV0gPQogCQkJCW1v
ZGVzZXRfZ2V0X2NydGNfcG93ZXJfZG9tYWlucyhjcnRjLAotCQkJCQluZXdfaW50ZWxfY3J0Y19z
dGF0ZSk7CisJCQkJCW5ld19jcnRjX3N0YXRlKTsKIAkJfQogCi0JCWlmICghbmVlZHNfbW9kZXNl
dChuZXdfaW50ZWxfY3J0Y19zdGF0ZSkpCisJCWlmICghbmVlZHNfbW9kZXNldChuZXdfY3J0Y19z
dGF0ZSkpCiAJCQljb250aW51ZTsKIAotCQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9pbnRl
bF9jcnRjX3N0YXRlLCBuZXdfaW50ZWxfY3J0Y19zdGF0ZSk7CisJCWludGVsX3ByZV9wbGFuZV91
cGRhdGUob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsKIAotCQlpZiAob2xkX2NydGNf
c3RhdGUtPmFjdGl2ZSkgewotCQkJaW50ZWxfY3J0Y19kaXNhYmxlX3BsYW5lcyhpbnRlbF9zdGF0
ZSwgaW50ZWxfY3J0Yyk7CisJCWlmIChvbGRfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpIHsKKwkJ
CWludGVsX2NydGNfZGlzYWJsZV9wbGFuZXMoc3RhdGUsIGNydGMpOwogCiAJCQkvKgogCQkJICog
V2UgbmVlZCB0byBkaXNhYmxlIHBpcGUgQ1JDIGJlZm9yZSBkaXNhYmxpbmcgdGhlIHBpcGUsCiAJ
CQkgKiBvciB3ZSByYWNlIGFnYWluc3QgdmJsYW5rIG9mZi4KIAkJCSAqLwotCQkJaW50ZWxfY3J0
Y19kaXNhYmxlX3BpcGVfY3JjKGludGVsX2NydGMpOworCQkJaW50ZWxfY3J0Y19kaXNhYmxlX3Bp
cGVfY3JjKGNydGMpOwogCi0JCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rpc2FibGUob2xkX2lu
dGVsX2NydGNfc3RhdGUsIHN0YXRlKTsKLQkJCWludGVsX2NydGMtPmFjdGl2ZSA9IGZhbHNlOwot
CQkJaW50ZWxfZmJjX2Rpc2FibGUoaW50ZWxfY3J0Yyk7Ci0JCQlpbnRlbF9kaXNhYmxlX3NoYXJl
ZF9kcGxsKG9sZF9pbnRlbF9jcnRjX3N0YXRlKTsKKwkJCWRldl9wcml2LT5kaXNwbGF5LmNydGNf
ZGlzYWJsZShvbGRfY3J0Y19zdGF0ZSwgc3RhdGUpOworCQkJY3J0Yy0+YWN0aXZlID0gZmFsc2U7
CisJCQlpbnRlbF9mYmNfZGlzYWJsZShjcnRjKTsKKwkJCWludGVsX2Rpc2FibGVfc2hhcmVkX2Rw
bGwob2xkX2NydGNfc3RhdGUpOwogCiAJCQkvKgogCQkJICogVW5kZXJydW5zIGRvbid0IGFsd2F5
cyByYWlzZQpAQCAtMTM4MjMsMjUgKzEzNzk2LDI1IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21p
Y19jb21taXRfdGFpbChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQlpbnRlbF9j
aGVja19wY2hfZmlmb191bmRlcnJ1bnMoZGV2X3ByaXYpOwogCiAJCQkvKiBGSVhNRSB1bmlmeSB0
aGlzIGZvciBhbGwgcGxhdGZvcm1zICovCi0JCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5hY3RpdmUg
JiYKKwkJCWlmICghbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlICYmCiAJCQkgICAgIUhBU19H
TUNIKGRldl9wcml2KSAmJgogCQkJICAgIGRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJt
YXJrcykKLQkJCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3MoaW50ZWxfc3Rh
dGUsCi0JCQkJCQkJCSAgICAgbmV3X2ludGVsX2NydGNfc3RhdGUpOworCQkJCWRldl9wcml2LT5k
aXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0ZSwKKwkJCQkJCQkJICAgICBuZXdfY3J0Y19z
dGF0ZSk7CiAJCX0KIAl9CiAKLQkvKiBGSVhNRTogRXZlbnR1YWxseSBnZXQgcmlkIG9mIG91ciBp
bnRlbF9jcnRjLT5jb25maWcgcG9pbnRlciAqLwotCWZvcl9lYWNoX25ld19jcnRjX2luX3N0YXRl
KHN0YXRlLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgaSkKLQkJdG9faW50ZWxfY3J0YyhjcnRjKS0+
Y29uZmlnID0gdG9faW50ZWxfY3J0Y19zdGF0ZShuZXdfY3J0Y19zdGF0ZSk7CisJLyogRklYTUU6
IEV2ZW50dWFsbHkgZ2V0IHJpZCBvZiBvdXIgY3J0Yy0+Y29uZmlnIHBvaW50ZXIgKi8KKwlmb3Jf
ZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgbmV3X2NydGNfc3RhdGUs
IGkpCisJCWNydGMtPmNvbmZpZyA9IG5ld19jcnRjX3N0YXRlOwogCi0JaWYgKGludGVsX3N0YXRl
LT5tb2Rlc2V0KSB7Ci0JCWRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9sZWdhY3lfbW9kZXNldF9z
dGF0ZShzdGF0ZS0+ZGV2LCBzdGF0ZSk7CisJaWYgKHN0YXRlLT5tb2Rlc2V0KSB7CisJCWRybV9h
dG9taWNfaGVscGVyX3VwZGF0ZV9sZWdhY3lfbW9kZXNldF9zdGF0ZShkZXYsICZzdGF0ZS0+YmFz
ZSk7CiAKIAkJaW50ZWxfc2V0X2NkY2xrX3ByZV9wbGFuZV91cGRhdGUoZGV2X3ByaXYsCi0JCQkJ
CQkgJmludGVsX3N0YXRlLT5jZGNsay5hY3R1YWwsCisJCQkJCQkgJnN0YXRlLT5jZGNsay5hY3R1
YWwsCiAJCQkJCQkgJmRldl9wcml2LT5jZGNsay5hY3R1YWwsCi0JCQkJCQkgaW50ZWxfc3RhdGUt
PmNkY2xrLnBpcGUpOworCQkJCQkJIHN0YXRlLT5jZGNsay5waXBlKTsKIAogCQkvKgogCQkgKiBT
S0wgd29ya2Fyb3VuZDogYnNwZWMgcmVjb21tZW5kcyB3ZSBkaXNhYmxlIHRoZSBTQUdWIHdoZW4g
d2UKQEAgLTEzODU0LDI3ICsxMzgyNywyNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29t
bWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCX0KIAogCS8qIENvbXBs
ZXRlIHRoZSBldmVudHMgZm9yIHBpcGVzIHRoYXQgaGF2ZSBub3cgYmVlbiBkaXNhYmxlZCAqLwot
CWZvcl9lYWNoX25ld19jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSwg
aSkgewotCQlib29sIG1vZGVzZXQgPSBuZWVkc19tb2Rlc2V0KHRvX2ludGVsX2NydGNfc3RhdGUo
bmV3X2NydGNfc3RhdGUpKTsKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0
ZSwgY3J0YywgbmV3X2NydGNfc3RhdGUsIGkpIHsKKwkJYm9vbCBtb2Rlc2V0ID0gbmVlZHNfbW9k
ZXNldChuZXdfY3J0Y19zdGF0ZSk7CiAKIAkJLyogQ29tcGxldGUgZXZlbnRzIGZvciBub3cgZGlz
YWJsZSBwaXBlcyBoZXJlLiAqLwotCQlpZiAobW9kZXNldCAmJiAhbmV3X2NydGNfc3RhdGUtPmFj
dGl2ZSAmJiBuZXdfY3J0Y19zdGF0ZS0+ZXZlbnQpIHsKKwkJaWYgKG1vZGVzZXQgJiYgIW5ld19j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJiBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5ldmVudCkgewog
CQkJc3Bpbl9sb2NrX2lycSgmZGV2LT5ldmVudF9sb2NrKTsKLQkJCWRybV9jcnRjX3NlbmRfdmJs
YW5rX2V2ZW50KGNydGMsIG5ld19jcnRjX3N0YXRlLT5ldmVudCk7CisJCQlkcm1fY3J0Y19zZW5k
X3ZibGFua19ldmVudCgmY3J0Yy0+YmFzZSwgbmV3X2NydGNfc3RhdGUtPmJhc2UuZXZlbnQpOwog
CQkJc3Bpbl91bmxvY2tfaXJxKCZkZXYtPmV2ZW50X2xvY2spOwogCi0JCQluZXdfY3J0Y19zdGF0
ZS0+ZXZlbnQgPSBOVUxMOworCQkJbmV3X2NydGNfc3RhdGUtPmJhc2UuZXZlbnQgPSBOVUxMOwog
CQl9CiAJfQogCiAJLyogTm93IGVuYWJsZSB0aGUgY2xvY2tzLCBwbGFuZSwgcGlwZSwgYW5kIGNv
bm5lY3RvcnMgdGhhdCB3ZSBzZXQgdXAuICovCiAJZGV2X3ByaXYtPmRpc3BsYXkudXBkYXRlX2Ny
dGNzKHN0YXRlKTsKIAotCWlmIChpbnRlbF9zdGF0ZS0+bW9kZXNldCkKKwlpZiAoc3RhdGUtPm1v
ZGVzZXQpCiAJCWludGVsX3NldF9jZGNsa19wb3N0X3BsYW5lX3VwZGF0ZShkZXZfcHJpdiwKLQkJ
CQkJCSAgJmludGVsX3N0YXRlLT5jZGNsay5hY3R1YWwsCisJCQkJCQkgICZzdGF0ZS0+Y2RjbGsu
YWN0dWFsLAogCQkJCQkJICAmZGV2X3ByaXYtPmNkY2xrLmFjdHVhbCwKLQkJCQkJCSAgaW50ZWxf
c3RhdGUtPmNkY2xrLnBpcGUpOworCQkJCQkJICBzdGF0ZS0+Y2RjbGsucGlwZSk7CiAKIAkvKiBG
SVhNRTogV2Ugc2hvdWxkIGNhbGwgZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2h3X2RvbmUoKSBo
ZXJlCiAJICogYWxyZWFkeSwgYnV0IHN0aWxsIG5lZWQgdGhlIHN0YXRlIGZvciB0aGUgZGVsYXll
ZCBvcHRpbWl6YXRpb24uIFRvCkBAIC0xMzg4NSwxNiArMTM4NTgsMTQgQEAgc3RhdGljIHZvaWQg
aW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAkgKiAtIHN3aXRjaCBvdmVyIHRvIHRoZSB2Ymxhbmsgd2FpdCBoZWxwZXIgaW4gdGhlIGNvcmUg
YWZ0ZXIgdGhhdCBzaW5jZQogCSAqICAgd2UgZG9uJ3QgbmVlZCBvdXQgc3BlY2lhbCBoYW5kbGlu
ZyBhbnkgbW9yZS4KIAkgKi8KLQlkcm1fYXRvbWljX2hlbHBlcl93YWl0X2Zvcl9mbGlwX2RvbmUo
ZGV2LCBzdGF0ZSk7Ci0KLQlmb3JfZWFjaF9uZXdfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywg
bmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJbmV3X2ludGVsX2NydGNfc3RhdGUgPSB0b19pbnRlbF9j
cnRjX3N0YXRlKG5ld19jcnRjX3N0YXRlKTsKKwlkcm1fYXRvbWljX2hlbHBlcl93YWl0X2Zvcl9m
bGlwX2RvbmUoZGV2LCAmc3RhdGUtPmJhc2UpOwogCi0JCWlmIChuZXdfY3J0Y19zdGF0ZS0+YWN0
aXZlICYmCi0JCSAgICAhbmVlZHNfbW9kZXNldCh0b19pbnRlbF9jcnRjX3N0YXRlKG5ld19jcnRj
X3N0YXRlKSkgJiYKLQkJICAgIChuZXdfaW50ZWxfY3J0Y19zdGF0ZS0+YmFzZS5jb2xvcl9tZ210
X2NoYW5nZWQgfHwKLQkJICAgICBuZXdfaW50ZWxfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpKQot
CQkJaW50ZWxfY29sb3JfbG9hZF9sdXRzKG5ld19pbnRlbF9jcnRjX3N0YXRlKTsKKwlmb3JfZWFj
aF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgbmV3X2NydGNfc3RhdGUsIGkp
IHsKKwkJaWYgKG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSAmJgorCQkgICAgIW5lZWRzX21v
ZGVzZXQobmV3X2NydGNfc3RhdGUpICYmCisJCSAgICAobmV3X2NydGNfc3RhdGUtPmJhc2UuY29s
b3JfbWdtdF9jaGFuZ2VkIHx8CisJCSAgICAgbmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9waXBlKSkK
KwkJCWludGVsX2NvbG9yX2xvYWRfbHV0cyhuZXdfY3J0Y19zdGF0ZSk7CiAJfQogCiAJLyoKQEAg
LTEzOTA0LDE2ICsxMzg3NSwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3Rh
aWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCSAqCiAJICogVE9ETzogTW92ZSB0
aGlzIChhbmQgb3RoZXIgY2xlYW51cCkgdG8gYW4gYXN5bmMgd29ya2VyIGV2ZW50dWFsbHkuCiAJ
ICovCi0JZm9yX2VhY2hfbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG5ld19jcnRjX3N0
YXRlLCBpKSB7Ci0JCW5ld19pbnRlbF9jcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShu
ZXdfY3J0Y19zdGF0ZSk7Ci0KKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0
ZSwgY3J0YywgbmV3X2NydGNfc3RhdGUsIGkpIHsKIAkJaWYgKGRldl9wcml2LT5kaXNwbGF5Lm9w
dGltaXplX3dhdGVybWFya3MpCi0JCQlkZXZfcHJpdi0+ZGlzcGxheS5vcHRpbWl6ZV93YXRlcm1h
cmtzKGludGVsX3N0YXRlLAotCQkJCQkJCSAgICAgIG5ld19pbnRlbF9jcnRjX3N0YXRlKTsKKwkJ
CWRldl9wcml2LT5kaXNwbGF5Lm9wdGltaXplX3dhdGVybWFya3Moc3RhdGUsCisJCQkJCQkJICAg
ICAgbmV3X2NydGNfc3RhdGUpOwogCX0KIAotCWZvcl9lYWNoX29sZG5ld19jcnRjX2luX3N0YXRl
KHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaW50
ZWxfcG9zdF9wbGFuZV91cGRhdGUodG9faW50ZWxfY3J0Y19zdGF0ZShvbGRfY3J0Y19zdGF0ZSkp
OworCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRf
Y3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUsIGkpIHsKKwkJaW50ZWxfcG9zdF9wbGFuZV91cGRh
dGUob2xkX2NydGNfc3RhdGUpOwogCiAJCWlmIChwdXRfZG9tYWluc1tpXSkKIAkJCW1vZGVzZXRf
cHV0X3Bvd2VyX2RvbWFpbnMoZGV2X3ByaXYsIHB1dF9kb21haW5zW2ldKTsKQEAgLTEzOTIxLDE1
ICsxMzg5MCwxNSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQlpbnRlbF9tb2Rlc2V0X3ZlcmlmeV9jcnRjKGNy
dGMsIHN0YXRlLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOwogCX0KIAotCWlmIChp
bnRlbF9zdGF0ZS0+bW9kZXNldCkKLQkJaW50ZWxfdmVyaWZ5X3BsYW5lcyhpbnRlbF9zdGF0ZSk7
CisJaWYgKHN0YXRlLT5tb2Rlc2V0KQorCQlpbnRlbF92ZXJpZnlfcGxhbmVzKHN0YXRlKTsKIAot
CWlmIChpbnRlbF9zdGF0ZS0+bW9kZXNldCAmJiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUp
KQorCWlmIChzdGF0ZS0+bW9kZXNldCAmJiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RhdGUpKQog
CQlpbnRlbF9lbmFibGVfc2FndihkZXZfcHJpdik7CiAKLQlkcm1fYXRvbWljX2hlbHBlcl9jb21t
aXRfaHdfZG9uZShzdGF0ZSk7CisJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2h3X2RvbmUoJnN0
YXRlLT5iYXNlKTsKIAotCWlmIChpbnRlbF9zdGF0ZS0+bW9kZXNldCkgeworCWlmIChzdGF0ZS0+
bW9kZXNldCkgewogCQkvKiBBcyBvbmUgb2YgdGhlIHByaW1hcnkgbW1pbyBhY2Nlc3NvcnMsIEtN
UyBoYXMgYSBoaWdoCiAJCSAqIGxpa2VsaWhvb2Qgb2YgdHJpZ2dlcmluZyBidWdzIGluIHVuY2xh
aW1lZCBhY2Nlc3MuIEFmdGVyIHdlCiAJCSAqIGZpbmlzaCBtb2Rlc2V0dGluZywgc2VlIGlmIGFu
IGVycm9yIGhhcyBiZWVuIGZsYWdnZWQsIGFuZCBpZgpAQCAtMTM5MzksNyArMTM5MDgsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGRybV9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCQlpbnRlbF91bmNvcmVfYXJtX3VuY2xhaW1lZF9tbWlvX2RldGVjdGlvbigm
ZGV2X3ByaXYtPnVuY29yZSk7CiAJCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBQ
T1dFUl9ET01BSU5fTU9ERVNFVCwgd2FrZXJlZik7CiAJfQotCWludGVsX3J1bnRpbWVfcG1fcHV0
KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgaW50ZWxfc3RhdGUtPndha2VyZWYpOworCWludGVsX3J1
bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgc3RhdGUtPndha2VyZWYpOwogCiAJ
LyoKIAkgKiBEZWZlciB0aGUgY2xlYW51cCBvZiB0aGUgb2xkIHN0YXRlIHRvIGEgc2VwYXJhdGUg
d29ya2VyIHRvIG5vdApAQCAtMTM5NDksMTQgKzEzOTE4LDE0IEBAIHN0YXRpYyB2b2lkIGludGVs
X2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJICog
c2NoZWR1bGUgcG9pbnQgKGNvbmRfcmVzY2hlZCgpKSBoZXJlIGFueXdheSB0byBrZWVwIGxhdGVu
Y2llcwogCSAqIGRvd24uCiAJICovCi0JSU5JVF9XT1JLKCZzdGF0ZS0+Y29tbWl0X3dvcmssIGlu
dGVsX2F0b21pY19jbGVhbnVwX3dvcmspOwotCXF1ZXVlX3dvcmsoc3lzdGVtX2hpZ2hwcmlfd3Es
ICZzdGF0ZS0+Y29tbWl0X3dvcmspOworCUlOSVRfV09SSygmc3RhdGUtPmJhc2UuY29tbWl0X3dv
cmssIGludGVsX2F0b21pY19jbGVhbnVwX3dvcmspOworCXF1ZXVlX3dvcmsoc3lzdGVtX2hpZ2hw
cmlfd3EsICZzdGF0ZS0+YmFzZS5jb21taXRfd29yayk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVs
X2F0b21pY19jb21taXRfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0
IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0KLQkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBk
cm1fYXRvbWljX3N0YXRlLCBjb21taXRfd29yayk7CisJc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUgPQorCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSwgYmFzZS5jb21taXRfd29yayk7CiAKIAlpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RhdGUp
OwogfQpAQCAtMTQwOTksNyArMTQwNjgsNyBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jb21t
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAl9IGVsc2UgewogCQlpZiAoaW50ZWxfc3RhdGUt
Pm1vZGVzZXQpCiAJCQlmbHVzaF93b3JrcXVldWUoZGV2X3ByaXYtPm1vZGVzZXRfd3EpOwotCQlp
bnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RhdGUpOworCQlpbnRlbF9hdG9taWNfY29tbWl0X3Rh
aWwoaW50ZWxfc3RhdGUpOwogCX0KIAogCXJldHVybiAwOwpAQCAtMTY4MDQsNyArMTY3NzMsNyBA
QCBpbnRlbF9tb2Rlc2V0X3NldHVwX2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJ
CXU2NCBwdXRfZG9tYWluczsKIAogCQljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShj
cnRjLT5iYXNlLnN0YXRlKTsKLQkJcHV0X2RvbWFpbnMgPSBtb2Rlc2V0X2dldF9jcnRjX3Bvd2Vy
X2RvbWFpbnMoJmNydGMtPmJhc2UsIGNydGNfc3RhdGUpOworCQlwdXRfZG9tYWlucyA9IG1vZGVz
ZXRfZ2V0X2NydGNfcG93ZXJfZG9tYWlucyhjcnRjLCBjcnRjX3N0YXRlKTsKIAkJaWYgKFdBUk5f
T04ocHV0X2RvbWFpbnMpKQogCQkJbW9kZXNldF9wdXRfcG93ZXJfZG9tYWlucyhkZXZfcHJpdiwg
cHV0X2RvbWFpbnMpOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IDI3MzRmNjJhYjE5
YS4uNDBjNmRmOTUyZmQyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTMwNiwxMCArMzA2
LDEwIEBAIHN0cnVjdCBkcm1faTkxNV9kaXNwbGF5X2Z1bmNzIHsKIAlpbnQgKCpjcnRjX2NvbXB1
dGVfY2xvY2spKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCXZvaWQgKCpjcnRjX2VuYWJsZSkoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAotCQkJICAgIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpvbGRfc3RhdGUpOworCQkJICAgIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKm9sZF9zdGF0
ZSk7CiAJdm9pZCAoKmNydGNfZGlzYWJsZSkoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YXRlLAotCQkJICAgICBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqb2xkX3N0YXRlKTsK
LQl2b2lkICgqdXBkYXRlX2NydGNzKShzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwor
CQkJICAgICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpvbGRfc3RhdGUpOworCXZvaWQgKCp1
cGRhdGVfY3J0Y3MpKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKTsKIAl2b2lkICgq
YXVkaW9fY29kZWNfZW5hYmxlKShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICBjb25z
dCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfcG0uYwppbmRleCBkOWE3YTEzY2UzMmEuLjQxMTZkZTJhNzdmZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jCkBAIC0zNzM2LDExICszNzM2LDEwIEBAIGludGVsX2Rpc2FibGVfc2FndihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIDA7CiB9CiAKLWJvb2wgaW50
ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKK2Jvb2wg
aW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQog
ewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+ZGV2OworCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVs
X3N0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjc3RhdGU7CkBAIC0zNzYxLDE4ICszNzYwLDE4IEBAIGJvb2wgaW50ZWxfY2FuX2Vu
YWJsZV9zYWd2KHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkvKgogCSAqIElmIHRo
ZXJlIGFyZSBubyBhY3RpdmUgQ1JUQ3MsIG5vIGFkZGl0aW9uYWwgY2hlY2tzIG5lZWQgYmUgcGVy
Zm9ybWVkCiAJICovCi0JaWYgKGh3ZWlnaHQzMihpbnRlbF9zdGF0ZS0+YWN0aXZlX2NydGNzKSA9
PSAwKQorCWlmIChod2VpZ2h0MzIoc3RhdGUtPmFjdGl2ZV9jcnRjcykgPT0gMCkKIAkJcmV0dXJu
IHRydWU7CiAKIAkvKgogCSAqIFNLTCsgd29ya2Fyb3VuZDogYnNwZWMgcmVjb21tZW5kcyB3ZSBk
aXNhYmxlIFNBR1Ygd2hlbiB3ZSBoYXZlCiAJICogbW9yZSB0aGVuIG9uZSBwaXBlIGVuYWJsZWQK
IAkgKi8KLQlpZiAoaHdlaWdodDMyKGludGVsX3N0YXRlLT5hY3RpdmVfY3J0Y3MpID4gMSkKKwlp
ZiAoaHdlaWdodDMyKHN0YXRlLT5hY3RpdmVfY3J0Y3MpID4gMSkKIAkJcmV0dXJuIGZhbHNlOwog
CiAJLyogU2luY2Ugd2UncmUgbm93IGd1YXJhbnRlZWQgdG8gb25seSBoYXZlIG9uZSBhY3RpdmUg
Q1JUQy4uLiAqLwotCXBpcGUgPSBmZnMoaW50ZWxfc3RhdGUtPmFjdGl2ZV9jcnRjcykgLSAxOwor
CXBpcGUgPSBmZnMoc3RhdGUtPmFjdGl2ZV9jcnRjcykgLSAxOwogCWNydGMgPSBpbnRlbF9nZXRf
Y3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CiAJY3N0YXRlID0gdG9faW50ZWxfY3J0Y19z
dGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfcG0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKaW5kZXggMWI0
ODlmYTM5OWUxLi5lMzU3M2UxZTE2ZTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3BtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaApAQCAtMTAs
MTAgKzEwLDEwIEBACiAKICNpbmNsdWRlICJpOTE1X3JlZy5oIgogCi1zdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZTsKIHN0cnVjdCBkcm1fZGV2aWNlOwogc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CiBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0Oworc3RydWN0IGludGVsX2F0b21pY19zdGF0ZTsKIHN0cnVjdCBp
bnRlbF9jcnRjOwogc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmU7
CkBAIC01Miw3ICs1Miw3IEBAIHZvaWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAogCQkJICAgICAgc3RydWN0IHNrbF9waXBlX3dtICpvdXQpOwogdm9p
ZCBnNHhfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZv
aWQgdmx2X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1i
b29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUp
OworYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpOwogaW50IGludGVsX2VuYWJsZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7CiBpbnQgaW50ZWxfZGlzYWJsZV9zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdik7CiBib29sIHNrbF93bV9sZXZlbF9lcXVhbHMoY29uc3Qgc3RydWN0IHNrbF93
bV9sZXZlbCAqbDEsCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BF7F1105281
	for <lists+intel-gfx@lfdr.de>; Thu, 21 Nov 2019 13:58:03 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 136C06E0C5;
	Thu, 21 Nov 2019 12:58:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 499C96E0C5
 for <intel-gfx@lists.freedesktop.org>; Thu, 21 Nov 2019 12:58:01 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 Nov 2019 04:58:00 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,224,1571727600"; d="scan'208";a="232293961"
Received: from aquilante.fi.intel.com (HELO teofilatto.example.org)
 ([10.237.72.186])
 by fmsmga004.fm.intel.com with ESMTP; 21 Nov 2019 04:57:58 -0800
From: Andi Shyti <andi.shyti@intel.com>
To: Chris Wilson <chris@chris-wilson.co.uk>
Date: Thu, 21 Nov 2019 14:57:47 +0200
Message-Id: <20191121125747.37232-1-andi.shyti@intel.com>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC] drm/i915/selftests: add basic selftests for rc6
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Intel GFX <intel-gfx@lists.freedesktop.org>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkIHRocmVlIGJhc2ljIHRlc3RzIGZvciByYzYgcG93ZXIgc3RhdHVzOgoKMS4gbGl2ZV9yYzZf
YmFzaWMgLSBzaW1wbHkgY2hlY2tzIGlmIHJjNiB3b3JrcyB3aGVuIGl0J3MgZW5hYmxlZAogICBv
ciBzdG9wcyB3aGVuIGl0J3MgZGlzYWJsZWQuCgoyLiBsaXZlX3JjNl90aHJlc2hvbGQgLSByYzYg
c2hvdWxkIG5vdCB3b3JrIHdoZW4gdGhlIGV2YWx1YXRpb24KICAgaW50ZXJ2YWwgaXMgbGVzcyB0
aGFuIHRoZSB0aHJlc2hvbGQgYW5kIHNob3VsZCB3b3JrIG90aGVyd2lzZS4KCjMuIGxpdmVfcmM2
X2J1c3kgLSBrZWVwcyB0aGUgZ3B1IGJ1c3kgYW5kIHRoZW4gZ29lcyBpbiBpZGxlOwogICBjaGVj
a3MgdGhhdCB3ZSBkb24ndCBmYWxsIGluIHJjNiB3aGVuIGJ1c3kgYW5kIHRoYXQgd2UgZG8gZmFs
bAogICBpbiByYzYgd2hlbiBpZGxpbmcuCgpUaGUgdGhyZWUgdGVzdHMgYXJlIGFkZGVkIGFzIHN1
dGVzdCBvZiB0aGUgYmlnZ2VyIGxpdmVfbGF0ZV9ndF9wbQpzZWxmdGVzdC4KClRoZSBiYXNpYyBy
YzYgZnVuY3Rpb25hbGl0eSBpcyB0ZXN0ZWQgYnkgY2hlY2tpbmcgdGhlIHJlZmVyZW5jZQpjb3Vu
dGVyIHdpdGhpbiB0aGUgZXZhbHVhdGlvbiBpbnRlcnZhbC4KClNpZ25lZC1vZmYtYnk6IEFuZGkg
U2h5dGkgPGFuZGkuc2h5dGlAaW50ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJp
cy13aWxzb24uY28udWs+Ci0tLQpIaSwKCmluIHRoaXMgUkM2IHRlc3QgdGhlIGxpdmVfcmM2X3Ro
cmVzaG9sZCBkb2Vzbid0IHdvcmssIGVpdGhlcgpiZWNhdXNlIEkgbWlzaW50ZXJwcmV0ZWQgdGhl
IGNvbmNlcHQsIG9yIHRoZSBHUFUgSSBhbSB1c2luZyBkb2VzCm5vdCBzdXBwb3J0IHNvbWV0aGlu
ZyBvciB0aGUgY29kZSBJIGFtIHBvc3RpbmcgaXMganVuay4gRWl0aGVyCndheSwgaWRlYXM/CgpU
aGFua3MsCkFuZGkKCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ndF9wbS5jIHwg
ICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3JjNi5jICAgfCAxODAgKysr
KysrKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3Jj
Ni5oICAgfCAgIDMgKwogMyBmaWxlcyBjaGFuZ2VkLCAxODYgaW5zZXJ0aW9ucygrKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2d0X3BtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ndF9wbS5jCmluZGV4IDVlNTYzYjg3NzM2OC4uYjVh
ODcyYWZmYTg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9n
dF9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2d0X3BtLmMKQEAg
LTY4LDcgKzY4LDEwIEBAIGludCBpbnRlbF9ndF9wbV9sYXRlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJICogVGhleSBhcmUgaW50ZW5kZWQgdG8gYmUgcnVuIGxh
c3QgaW4gQ0kgYW5kIHRoZSBzeXN0ZW0KIAkJICogcmVib290ZWQgYWZ0ZXJ3YXJkcy4KIAkJICov
CisJCVNVQlRFU1QobGl2ZV9yYzZfYmFzaWMpLAorCQlTVUJURVNUKGxpdmVfcmM2X3RocmVzaG9s
ZCksCiAJCVNVQlRFU1QobGl2ZV9yYzZfY3R4X3dhKSwKKwkJU1VCVEVTVChsaXZlX3JjNl9idXN5
KSwKIAl9OwogCiAJaWYgKGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfcmM2LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9yYzYuYwppbmRleCA2N2I3YTZiYzY0ZjUuLmM4MGQxN2YzZGEx
MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfcmM2LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfcmM2LmMKQEAgLTExLDYgKzExLDMx
IEBACiAjaW5jbHVkZSAic2VsZnRlc3RfcmM2LmgiCiAKICNpbmNsdWRlICJzZWxmdGVzdHMvaTkx
NV9yYW5kb20uaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5uZXIuaCIKKworc3RhdGlj
IGJvb2wgdGVzdF9yYzYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIGVu
YWJsZWQpCit7CisJdTMyIGVjMSwgZWMyOworCXU2NCBpbnRlcnZhbDsKKworCWludGVydmFsID0g
STkxNV9SRUFEKEdFTjZfUkNfRVZBTFVBVElPTl9JTlRFUlZBTCk7CisKKwkvKgorCSAqIHRoZSBp
bnRlcnZhbCBpcyBzdG9yZWQgaW4gc3RlcHMgb2YgMS4yOHVzCisJICovCisJaW50ZXJ2YWwgPSBp
bnRlcnZhbCAqIDEyOCAvIDEwMCAvIDEwMDA7IC8qIG1pbGlzZWNvbmRzICovCisKKwllYzEgPSBJ
OTE1X1JFQUQoR0VONl9HVF9HRlhfUkM2KTsKKwkvKgorCSAqIGl0J3Mgbm90IGltcG9ydGFudCB0
byBwcmVjaXNlbHkgd2FpdCB0aGUgaW50ZXJ2YWwgdGltZS4KKwkgKiBJJ2xsIHdhaXQgYXQgbGVh
c3QgdHdpY2UgdGhlIHRpbWUgaW4gb3JkZXIgdG8gYmUgc3VyZQorCSAqIHRoYXQgdGhlIGNvdW50
aW5nIGhhcHBlbnMgaW4gdGhlIHJlZmVyZW5jZSBjb3VudGVyLgorCSAqLworCW1zbGVlcCgyICog
aW50ZXJ2YWwpOworCWVjMiA9IEk5MTVfUkVBRChHRU42X0dUX0dGWF9SQzYpOworCisJcmV0dXJu
IGVuYWJsZWQgIT0gKGVjMSA+PSBlYzIpOworfQogCiBzdGF0aWMgY29uc3QgdTMyICpfX2xpdmVf
cmM2X2N0eChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7CkBAIC0xNDQsMyArMTY5LDE1OCBA
QCBpbnQgbGl2ZV9yYzZfY3R4X3dhKHZvaWQgKmFyZykKIAlrZnJlZShlbmdpbmVzKTsKIAlyZXR1
cm4gZXJyOwogfQorCitpbnQgbGl2ZV9yYzZfYmFzaWModm9pZCAqYXJnKQoreworCXN0cnVjdCBp
bnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX3JjNiAqcmM2ID0gJmd0LT5yYzY7CisJ
aW50IGksIGVyciA9IDA7CisKKwlpZiAoIUhBU19SQzYoZ3QtPmk5MTUpKQorCQlyZXR1cm4gLUVO
T0RFVjsKKworCS8qCisJICogdGhlIHR3byBsb29wcyB0ZXN0IHJjNiBib3RoIGluIGNhc2UgaXQn
cyBlbmFibGVkCisJICogYW5kIGluIHRoZSBjYXNlIGl0J3MgZGlzYWJsZWQuIEl0IHJlc3RvcmVz
IHRoZSBwcnZpb3VzCisJICogc3RhdHVzCisJICovCisJZm9yIChpID0gMDsgaSA8IDI7IGkrKykg
eworCQlpZiAoIXRlc3RfcmM2KGd0LT5pOTE1LCByYzYtPmVuYWJsZWQpKSB7CisJCQlpZiAoIWkp
CisJCQkJcmV0dXJuIC1FSU5WQUw7CisKKwkJCS8qIHJlc3RvcmUgYmVmb3JlIGxlYXZpbmcgKi8K
KwkJCWVyciA9IC1FSU5WQUw7CisJCX0KKworCQlpZiAocmM2LT5lbmFibGVkKQorCQkJaW50ZWxf
cmM2X2Rpc2FibGUoJmd0LT5yYzYpOworCQllbHNlCisJCQlpbnRlbF9yYzZfZW5hYmxlKCZndC0+
cmM2KTsKKwl9CisKKwlyZXR1cm4gZXJyOworfQorCitpbnQgbGl2ZV9yYzZfdGhyZXNob2xkKHZv
aWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGd0LT5pOTE1OworCXUzMiB0aHJlc2hvbGQsIGludGVydmFs
OworCXUzMiB0X29yaWcsIGlfb3JpZzsKKwlpbnQgZXJyID0gMDsKKworCXRfb3JpZyA9IEk5MTVf
UkVBRChHRU42X1JDNl9USFJFU0hPTEQpOworCWlfb3JpZyA9IEk5MTVfUkVBRChHRU42X1JDX0VW
QUxVQVRJT05fSU5URVJWQUwpOworCisJLyoKKwkgKiBzZXQgdGhlIHRocmVzaG9sZCB0byA1MG1z
CisJICoKKwkgKiA1MG1zICogMTAwMCA9IDUwMDAwdXMKKwkgKiA1MDAwMCAvICgxLjI4ICogMTAw
KSAvIDEwMCAod2UgZG9uJ3QgaGF2ZSBmbG9hdGluZyBwb2ludCkKKwkgKi8KKwl0aHJlc2hvbGQg
PSA1MCAqIDEwMDAgLyAxMjggKiAxMDA7CisJSTkxNV9XUklURShHRU42X1JDNl9USFJFU0hPTEQs
IHRocmVzaG9sZCk7CisKKwkvKiBzZXQgaW50ZXJ2YWwgaW5kaWNhdGl2ZWx5IHRvIGhhbGYgdGhl
IHRocmVzaG9sZCAqLworCWludGVydmFsID0gdGhyZXNob2xkIC8gMjsKKwlJOTE1X1dSSVRFKEdF
TjZfUkNfRVZBTFVBVElPTl9JTlRFUlZBTCwgaW50ZXJ2YWwpOworCisJLyogaW50ZXJ2YWwgPCB0
aHJlc2hvbGQgKi8KKwlpZiAoIXRlc3RfcmM2KGd0LT5pOTE1LCBmYWxzZSkpIHsKKwkJZXJyID0g
LUVJTlZBTDsKKwkJcHJfZXJyKCJpOTE1IG1pc21hdGNoOiByYzYgd2l0aCBpbnRlcnZhbCA8IHRo
cmVzaG9sZFxuIik7CisJCWdvdG8gb3V0OworCX0KKworCS8qIHNldCBpbnRlcnZhbCBpbmRpY2F0
aXZlbHkgdG8gdHdpY2UgdGhlIHRocmVzaG9sZCAqLworCWludGVydmFsID0gdGhyZXNob2xkICog
MjsKKwlJOTE1X1dSSVRFKEdFTjZfUkNfRVZBTFVBVElPTl9JTlRFUlZBTCwgaW50ZXJ2YWwpOwor
CisJLyogaW50ZXJ2YWwgPiB0aHJlc2hvbGQgKi8KKwlpZiAoIXRlc3RfcmM2KGd0LT5pOTE1LCB0
cnVlKSkgeworCQllcnIgPSAtRUlOVkFMOworCQlwcl9lcnIoImk5MTUgbWlzbWF0Y2g6IG5vdCBp
biByYzYgd2l0aCBpbnRlcnZhbCA+IHRocmVzaG9sZFxuIik7CisJfQorCitvdXQ6CisJSTkxNV9X
UklURShHRU42X1JDNl9USFJFU0hPTEQsIHRfb3JpZyk7CisJSTkxNV9XUklURShHRU42X1JDX0VW
QUxVQVRJT05fSU5URVJWQUwsIGlfb3JpZyk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IHJjNl9idXN5X3RocmVhZCh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGlndF9zcGlu
bmVyIHNwaW47CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnE7CisJaW50IGVyciA9IDA7CisKKwkvKiBhbnkgZXhpc3RpbmcgZW5naW5lIGluIHRoZSBj
dXJyZW50IGd0IGlzIGdvb2QgKi8KKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpCisJ
CWJyZWFrOworCisJZXJyID0gaWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgZ3QpOworCWlmIChlcnIp
CisJCXJldHVybiBlcnI7CisKKwlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGlu
LCBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LCBNSV9OT09QKTsKKwlpZiAoSVNfRVJSKHJxKSkgewor
CQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJZ290byBvdXQ7CisJfQorCisJaTkxNV9yZXF1ZXN0X2dl
dChycSk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNw
aW4sIHJxKTsgLyogaXQncyBlbm91Z2ggd2FpdGluZyAqLworCWlndF9zcGlubmVyX2VuZCgmc3Bp
bik7CisKKwlpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KTsKKwlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKKworb3V0OgorCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOworCXJldHVybiBlcnI7
Cit9CisKK2ludCBsaXZlX3JjNl9idXN5KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0ID0gYXJnOworCXN0cnVjdCB0YXNrX3N0cnVjdCAqdGhyZWFkOworCWludCBlcnIgPSAwOwor
CisJdGhyZWFkID0ga21hbGxvYyhzaXplb2YoKnRocmVhZCksIEdGUF9LRVJORUwpOworCWlmICgh
dGhyZWFkKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXRocmVhZCA9IGt0aHJlYWRfcnVuKHJjNl9i
dXN5X3RocmVhZCwgYXJnLCAicmM2X2J1c3lfc2VsZnRlc3QiKTsKKwlpZiAoSVNfRVJSKHRocmVh
ZCkpCisJCXJldHVybiBQVFJfRVJSKHRocmVhZCk7CisKKwlnZXRfdGFza19zdHJ1Y3QodGhyZWFk
KTsKKworCS8qIGdwdSBpcyBidXN5LCB3ZSBzaG91bGRuJ3QgYmUgaW4gcmM2ICovCisJaWYgKCF0
ZXN0X3JjNihndC0+aTkxNSwgZmFsc2UpKSB7CisJCWVyciA9IC1FSU5WQUw7CisJCXByX2Vycigi
bmV2ZXIgYnVzeSBlbm91Z2ggZm9yIGhhdmluZyBhIG5hcFxuIik7CisJfQorCisJZXJyID0ga3Ro
cmVhZF9zdG9wKHRocmVhZCk7CisJaWYgKGVyciA8IDApCisJCXByX2VycigiZmFpbCBhbmQgZXhp
dFxuIik7CisKKwlwdXRfdGFza19zdHJ1Y3QodGhyZWFkKTsKKworCWludGVsX2d0X3BtX3dhaXRf
Zm9yX2lkbGUoZ3QpOworCisJLyogZ3B1IGlzIGJ1c3ksIHdlIHNob3VsZCBiZSBpbiByYzYgKi8K
KwlpZiAoIXRlc3RfcmM2KGd0LT5pOTE1LCB0cnVlKSkgeworCQllcnIgPSAtRUlOVkFMOworCQlw
cl9lcnIoImk5MTUgaXMgaWRsZSBidXQgZG9lc24ndCBnbyBpbiByYzZcbiIpOworCX0KKworCXJl
dHVybiBlcnI7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9yYzYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3JjNi5oCmluZGV4IGY5
MDdlN2IwMzVhYi4uMjNlNzk0NWU5ZWVkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9yYzYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9yYzYuaApAQCAtNyw2ICs3LDkgQEAKICNpZm5kZWYgU0VMRlRFU1RfUkM2X0gKICNkZWZpbmUg
U0VMRlRFU1RfUkM2X0gKIAoraW50IGxpdmVfcmM2X2Jhc2ljKHZvaWQgKmFyZyk7CitpbnQgbGl2
ZV9yYzZfdGhyZXNob2xkKHZvaWQgKmFyZyk7CitpbnQgbGl2ZV9yYzZfYnVzeSh2b2lkICphcmcp
OwogaW50IGxpdmVfcmM2X2N0eF93YSh2b2lkICphcmcpOwogCiAjZW5kaWYgLyogU0VMRlRFU1Rf
UkM2X0ggKi8KLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

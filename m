Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AAFE463377
	for <lists+intel-gfx@lfdr.de>; Tue,  9 Jul 2019 11:32:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E70D36E064;
	Tue,  9 Jul 2019 09:32:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 12ECD6E05A
 for <intel-gfx@lists.freedesktop.org>; Tue,  9 Jul 2019 09:32:45 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Jul 2019 02:32:44 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,470,1557212400"; d="scan'208";a="185876238"
Received: from unknown (HELO delly.ger.corp.intel.com) ([10.252.37.9])
 by fmsmga001.fm.intel.com with ESMTP; 09 Jul 2019 02:32:43 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  9 Jul 2019 12:32:08 +0300
Message-Id: <20190709093208.20470-13-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190709093208.20470-1-lionel.g.landwerlin@intel.com>
References: <20190709093208.20470-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v7 12/12] drm/i915: add support for perf
 configuration queries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGlzdGluZyBjb25maWd1cmF0aW9ucyBhdCB0aGUgbW9tZW50IGlzIHN1cHBvcnRlZCBvbmx5IHRo
cm91Z2ggc3lzZnMuClRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIGZvciBhcHBsaWNhdGlvbnMgd2Fu
dGluZyB0byBsaXN0CmNvbmZpZ3VyYXRpb25zIGZyb20gYSBjb250YWluZXIgd2hlcmUgc3lzZnMg
aXNuJ3QgYXZhaWxhYmxlLgoKVGhpcyBjaGFuZ2UgYWRkcyBhIHdheSB0byBxdWVyeSB0aGUgbnVt
YmVyIG9mIGNvbmZpZ3VyYXRpb25zIGFuZCB0aGVpcgpjb250ZW50IHRocm91Z2ggdGhlIGk5MTUg
cXVlcnkgdUFQSS4KCnYyOiBGaXggc3BhcnNlIHdhcm5pbmdzIChMaW9uZWwpCiAgICBBZGQgc3Vw
cG9ydCB0byBxdWVyeSBjb25maWd1cmF0aW9uIHVzaW5nIHV1aWQgKExpb25lbCkKCnYzOiBGaXgg
c29tZSBpbmNvbnNpc3RlbmN5IGluIHVhcGkgaGVhZGVyIChMaW9uZWwpCiAgICBGaXggdW5sb2Nr
aW5nIHdoZW4gbm90IGxvY2tlZCBpc3N1ZSAoTGlvbmVsKQogICAgQWRkIGRlYnVnIG1lc3NhZ2Vz
IChMaW9uZWwpCgp2NDogRml4IG1pc3NpbmcgdW5sb2NrIChEYW4pCgpTaWduZWQtb2ZmLWJ5OiBM
aW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgIHwgICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jICB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5
LmMgfCAyNzkgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL3VhcGkvZHJt
L2k5MTVfZHJtLmggICAgICAgfCAgNjUgKysrKysrLQogNCBmaWxlcyBjaGFuZ2VkLCAzNTAgaW5z
ZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCBj
NzJlN2M3NDZiNTcuLjI4ZjBmNDkwYjdiMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0x
NzI5LDYgKzE3MjksMTIgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCQkgKi8KIAkJc3Ry
dWN0IGxpc3RfaGVhZCBtZXRyaWNzX2J1ZmZlcnM7CiAKKwkJLyoKKwkJICogTnVtYmVyIG9mIGR5
bmFtaWMgY29uZmlndXJhdGlvbnMsIHlvdSBuZWVkIHRvIGhvbGQKKwkJICogZGV2X3ByaXYtPnBl
cmYubWV0cmljc19sb2NrIHRvIGFjY2VzcyBpdC4KKwkJICovCisJCXUzMiBuX21ldHJpY3M7CisK
IAkJLyoKIAkJICogTG9jayBhc3NvY2lhdGVkIHdpdGggYW55dGhpbmcgYmVsb3cgd2l0aGluIHRo
aXMgc3RydWN0dXJlCiAJCSAqIGV4Y2VwdCBleGNsdXNpdmVfc3RyZWFtLgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmYuYwppbmRleCAwNDhhOWFiYWQyNmEuLmY1MTY3NGE2MTc0MiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMKQEAgLTM3MTcsNiArMzcxNyw4IEBAIGludCBpOTE1X3BlcmZfYWRkX2Nv
bmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQlnb3RvIHN5
c2ZzX2VycjsKIAl9CiAKKwlkZXZfcHJpdi0+cGVyZi5uX21ldHJpY3MrKzsKKwogCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKIAogCURSTV9ERUJVRygiQWRkZWQg
Y29uZmlnICVzIGlkPSVpXG4iLCBvYV9jb25maWctPnV1aWQsIG9hX2NvbmZpZy0+aWQpOwpAQCAt
Mzc3Nyw2ICszNzc5LDcgQEAgaW50IGk5MTVfcGVyZl9yZW1vdmVfY29uZmlnX2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkgICAmb2FfY29uZmlnLT5zeXNmc19t
ZXRyaWMpOwogCiAJaWRyX3JlbW92ZSgmZGV2X3ByaXYtPnBlcmYubWV0cmljc19pZHIsICphcmcp
OworCWRldl9wcml2LT5wZXJmLm5fbWV0cmljcy0tOwogCiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+cGVyZi5tZXRyaWNzX2xvY2spOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3F1ZXJ5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKaW5kZXgg
N2I3MDE2MTcxMDU3Li5jMWUyMDNjN2IyYzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcXVlcnkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMK
QEAgLTE0MywxMCArMTQzLDI4OSBAQCBxdWVyeV9lbmdpbmVfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAlyZXR1cm4gbGVuOwogfQogCitzdGF0aWMgaW50IGNhbl9jb3B5X3Bl
cmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIodTMyIHVzZXJfbl9yZWdzLAorCQkJCQkJICAg
IHU2NCB1c2VyX3JlZ3NfcHRyLAorCQkJCQkJICAgIHUzMiBrZXJuZWxfbl9yZWdzKQoreworCS8q
CisJICogV2UnbGwganVzdCBwdXQgdGhlIG51bWJlciBvZiByZWdpc3RlcnMsIGFuZCB3b24ndCBj
b3B5IHRoZQorCSAqIHJlZ2lzdGVyLgorCSAqLworCWlmICh1c2VyX25fcmVncyA9PSAwKQorCQly
ZXR1cm4gMDsKKworCWlmICh1c2VyX25fcmVncyA8IGtlcm5lbF9uX3JlZ3MpCisJCXJldHVybiAt
RUlOVkFMOworCisJaWYgKCFhY2Nlc3Nfb2sodTY0X3RvX3VzZXJfcHRyKHVzZXJfcmVnc19wdHIp
LAorCQkgICAgICAgMiAqIHNpemVvZih1MzIpICoga2VybmVsX25fcmVncykpCisJCXJldHVybiAt
RUZBVUxUOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY29weV9wZXJmX2NvbmZpZ19y
ZWdpc3RlcnNfb3JfbnVtYmVyKGNvbnN0IHN0cnVjdCBpOTE1X29hX3JlZyAqa2VybmVsX3JlZ3Ms
CisJCQkJCQl1MzIga2VybmVsX25fcmVncywKKwkJCQkJCXU2NCB1c2VyX3JlZ3NfcHRyLAorCQkJ
CQkJdTMyICp1c2VyX25fcmVncykKK3sKKwl1MzIgcjsKKworCWlmICgqdXNlcl9uX3JlZ3MgPT0g
MCkgeworCQkqdXNlcl9uX3JlZ3MgPSBrZXJuZWxfbl9yZWdzOworCQlyZXR1cm4gMDsKKwl9CisK
KwkqdXNlcl9uX3JlZ3MgPSBrZXJuZWxfbl9yZWdzOworCisJZm9yIChyID0gMDsgciA8IGtlcm5l
bF9uX3JlZ3M7IHIrKykgeworCQl1MzIgX191c2VyICp1c2VyX3JlZ19wdHIgPQorCQkJdTY0X3Rv
X3VzZXJfcHRyKHVzZXJfcmVnc19wdHIgKyBzaXplb2YodTMyKSAqIHIgKiAyKTsKKwkJdTMyIF9f
dXNlciAqdXNlcl92YWxfcHRyID0KKwkJCXU2NF90b191c2VyX3B0cih1c2VyX3JlZ3NfcHRyICsg
c2l6ZW9mKHUzMikgKiByICogMiArCisJCQkJCXNpemVvZih1MzIpKTsKKwkJaW50IHJldDsKKwor
CQlyZXQgPSBfX3B1dF91c2VyKGk5MTVfbW1pb19yZWdfb2Zmc2V0KGtlcm5lbF9yZWdzW3JdLmFk
ZHIpLAorCQkJCSB1c2VyX3JlZ19wdHIpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIC1FRkFVTFQ7
CisKKwkJcmV0ID0gX19wdXRfdXNlcihrZXJuZWxfcmVnc1tyXS52YWx1ZSwgdXNlcl92YWxfcHRy
KTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiAtRUZBVUxUOworCX0KKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IHF1ZXJ5X3BlcmZfY29uZmlnX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCisJCQkJICBzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRlbSwK
KwkJCQkgIGJvb2wgdXNlX3V1aWQpCit7CisJc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29u
ZmlnIF9fdXNlciAqdXNlcl9xdWVyeV9jb25maWdfcHRyID0KKwkJdTY0X3RvX3VzZXJfcHRyKHF1
ZXJ5X2l0ZW0tPmRhdGFfcHRyKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9vYV9jb25maWcgX191
c2VyICp1c2VyX2NvbmZpZ19wdHIgPQorCQl1NjRfdG9fdXNlcl9wdHIocXVlcnlfaXRlbS0+ZGF0
YV9wdHIgKworCQkJCXNpemVvZihzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfcGVyZl9jb25maWcpKTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9vYV9jb25maWcgdXNlcl9jb25maWc7CisJc3RydWN0IGk5
MTVfb2FfY29uZmlnICpvYV9jb25maWcgPSBOVUxMOworCXUzMiBmbGFncywgdG90YWxfc2l6ZTsK
KwlpbnQgcmV0OworCisJaWYgKCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKQorCQlyZXR1cm4gLUVO
T0RFVjsKKworCXRvdGFsX3NpemUgPSBzaXplb2Yoc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZf
Y29uZmlnKSArCisJCXNpemVvZihzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9vYV9jb25maWcpOworCisJ
aWYgKHF1ZXJ5X2l0ZW0tPmxlbmd0aCA9PSAwKQorCQlyZXR1cm4gdG90YWxfc2l6ZTsKKworCWlm
IChxdWVyeV9pdGVtLT5sZW5ndGggPCB0b3RhbF9zaXplKSB7CisJCURSTV9ERUJVRygiSW52YWxp
ZCBxdWVyeSBjb25maWcgZGF0YSBpdGVtIHNpemU9JXUgZXhwZWN0ZWQ9JXVcbiIsCisJCQkgIHF1
ZXJ5X2l0ZW0tPmxlbmd0aCwgdG90YWxfc2l6ZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwor
CWlmICghYWNjZXNzX29rKHVzZXJfcXVlcnlfY29uZmlnX3B0ciwgdG90YWxfc2l6ZSkpCisJCXJl
dHVybiAtRUZBVUxUOworCisJaWYgKF9fZ2V0X3VzZXIoZmxhZ3MsICZ1c2VyX3F1ZXJ5X2NvbmZp
Z19wdHItPmZsYWdzKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoZmxhZ3MgIT0gMCkKKwkJ
cmV0dXJuIC1FSU5WQUw7CisKKwlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUt
PnBlcmYubWV0cmljc19sb2NrKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJaWYgKHVz
ZV91dWlkKSB7CisJCWNoYXIgdXVpZFtVVUlEX1NUUklOR19MRU4gKyAxXSA9IHsgMCwgfTsKKwkJ
c3RydWN0IGk5MTVfb2FfY29uZmlnICp0bXA7CisJCWludCBpZDsKKworCQlCVUlMRF9CVUdfT04o
c2l6ZW9mKHVzZXJfcXVlcnlfY29uZmlnX3B0ci0+dXVpZCkgPj0gc2l6ZW9mKHV1aWQpKTsKKwor
CQlpZiAoX19jb3B5X2Zyb21fdXNlcih1dWlkLCB1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPnV1aWQs
CisJCQkJICAgICBzaXplb2YodXNlcl9xdWVyeV9jb25maWdfcHRyLT51dWlkKSkpIHsKKwkJCXJl
dCA9IC1FRkFVTFQ7CisJCQlnb3RvIG91dDsKKwkJfQorCisJCWlkcl9mb3JfZWFjaF9lbnRyeSgm
aTkxNS0+cGVyZi5tZXRyaWNzX2lkciwgdG1wLCBpZCkgeworCQkJaWYgKCFzdHJjbXAodG1wLT51
dWlkLCB1dWlkKSkgeworCQkJCW9hX2NvbmZpZyA9IHRtcDsKKwkJCQlicmVhazsKKwkJCX0KKwkJ
fQorCX0gZWxzZSB7CisJCXU2NCBjb25maWdfaWQ7CisKKwkJaWYgKF9fZ2V0X3VzZXIoY29uZmln
X2lkLCAmdXNlcl9xdWVyeV9jb25maWdfcHRyLT5jb25maWcpKSB7CisJCQlyZXQgPSAtRUZBVUxU
OworCQkJZ290byBvdXQ7CisJCX0KKworCQlpZiAoY29uZmlnX2lkID09IDEpCisJCQlvYV9jb25m
aWcgPSAmaTkxNS0+cGVyZi5vYS50ZXN0X2NvbmZpZzsKKwkJZWxzZQorCQkJb2FfY29uZmlnID0g
aWRyX2ZpbmQoJmk5MTUtPnBlcmYubWV0cmljc19pZHIsIGNvbmZpZ19pZCk7CisJfQorCisJaWYg
KCFvYV9jb25maWcpIHsKKwkJcmV0ID0gLUVOT0VOVDsKKwkJZ290byBvdXQ7CisJfQorCisJaWYg
KF9fY29weV9mcm9tX3VzZXIoJnVzZXJfY29uZmlnLCB1c2VyX2NvbmZpZ19wdHIsCisJCQkgICAg
IHNpemVvZih1c2VyX2NvbmZpZykpKSB7CisJCXJldCA9IC1FRkFVTFQ7CisJCWdvdG8gb3V0Owor
CX0KKworCXJldCA9IGNhbl9jb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIodXNl
cl9jb25maWcubl9ib29sZWFuX3JlZ3MsCisJCQkJCQkgICAgICAgdXNlcl9jb25maWcuYm9vbGVh
bl9yZWdzX3B0ciwKKwkJCQkJCSAgICAgICBvYV9jb25maWctPmJfY291bnRlcl9yZWdzX2xlbik7
CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBjYW5fY29weV9wZXJmX2NvbmZpZ19y
ZWdpc3RlcnNfb3JfbnVtYmVyKHVzZXJfY29uZmlnLm5fZmxleF9yZWdzLAorCQkJCQkJICAgICAg
IHVzZXJfY29uZmlnLmZsZXhfcmVnc19wdHIsCisJCQkJCQkgICAgICAgb2FfY29uZmlnLT5mbGV4
X3JlZ3NfbGVuKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNhbl9jb3B5X3Bl
cmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIodXNlcl9jb25maWcubl9tdXhfcmVncywKKwkJ
CQkJCSAgICAgICB1c2VyX2NvbmZpZy5tdXhfcmVnc19wdHIsCisJCQkJCQkgICAgICAgb2FfY29u
ZmlnLT5tdXhfcmVnc19sZW4pOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0ID0gY29w
eV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKG9hX2NvbmZpZy0+Yl9jb3VudGVyX3Jl
Z3MsCisJCQkJCQkgICBvYV9jb25maWctPmJfY291bnRlcl9yZWdzX2xlbiwKKwkJCQkJCSAgIHVz
ZXJfY29uZmlnLmJvb2xlYW5fcmVnc19wdHIsCisJCQkJCQkgICAmdXNlcl9jb25maWcubl9ib29s
ZWFuX3JlZ3MpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0ID0gY29weV9wZXJmX2Nv
bmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKG9hX2NvbmZpZy0+ZmxleF9yZWdzLAorCQkJCQkJICAg
b2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuLAorCQkJCQkJICAgdXNlcl9jb25maWcuZmxleF9yZWdz
X3B0ciwKKwkJCQkJCSAgICZ1c2VyX2NvbmZpZy5uX2ZsZXhfcmVncyk7CisJaWYgKHJldCkKKwkJ
Z290byBvdXQ7CisKKwlyZXQgPSBjb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIo
b2FfY29uZmlnLT5tdXhfcmVncywKKwkJCQkJCSAgIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuLAor
CQkJCQkJICAgdXNlcl9jb25maWcubXV4X3JlZ3NfcHRyLAorCQkJCQkJICAgJnVzZXJfY29uZmln
Lm5fbXV4X3JlZ3MpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJbWVtY3B5KHVzZXJfY29u
ZmlnLnV1aWQsIG9hX2NvbmZpZy0+dXVpZCwgc2l6ZW9mKHVzZXJfY29uZmlnLnV1aWQpKTsKKwor
CWlmIChfX2NvcHlfdG9fdXNlcih1c2VyX2NvbmZpZ19wdHIsICZ1c2VyX2NvbmZpZywKKwkJCSAg
IHNpemVvZih1c2VyX2NvbmZpZykpKSB7CisJCXJldCA9IC1FRkFVTFQ7CisJCWdvdG8gb3V0Owor
CX0KKworCXJldCA9IHRvdGFsX3NpemU7CisKK291dDoKKwltdXRleF91bmxvY2soJmk5MTUtPnBl
cmYubWV0cmljc19sb2NrKTsKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgaW50IHF1ZXJ5X3Bl
cmZfY29uZmlnX2xpc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJICBzdHJ1
Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRlbSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cXVlcnlfcGVyZl9jb25maWcgX191c2VyICp1c2VyX3F1ZXJ5X2NvbmZpZ19wdHIgPQorCQl1NjRf
dG9fdXNlcl9wdHIocXVlcnlfaXRlbS0+ZGF0YV9wdHIpOworCXN0cnVjdCBpOTE1X29hX2NvbmZp
ZyAqb2FfY29uZmlnOworCXUzMiBmbGFncywgdG90YWxfc2l6ZTsKKwl1NjQgbl9jb25maWdzOwor
CWludCByZXQsIGlkOworCisJaWYgKCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKQorCQlyZXR1cm4g
LUVOT0RFVjsKKworCS8qIENvdW50IHRoZSBkZWZhdWx0IHRlc3QgY29uZmlndXJhdGlvbiAqLwor
CW5fY29uZmlncyA9IGk5MTUtPnBlcmYubl9tZXRyaWNzICsgMTsKKwl0b3RhbF9zaXplID0gc2l6
ZW9mKHN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZykgKworCQlzaXplb2YodTY0KSAq
IG5fY29uZmlnczsKKworCWlmIChxdWVyeV9pdGVtLT5sZW5ndGggPT0gMCkKKwkJcmV0dXJuIHRv
dGFsX3NpemU7CisKKwlpZiAocXVlcnlfaXRlbS0+bGVuZ3RoIDwgdG90YWxfc2l6ZSkgeworCQlE
Uk1fREVCVUcoIkludmFsaWQgcXVlcnkgY29uZmlnIGxpc3QgaXRlbSBzaXplPSV1IGV4cGVjdGVk
PSV1XG4iLAorCQkJICBxdWVyeV9pdGVtLT5sZW5ndGgsIHRvdGFsX3NpemUpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisKKwlpZiAoIWFjY2Vzc19vayh1c2VyX3F1ZXJ5X2NvbmZpZ19wdHIsIHRv
dGFsX3NpemUpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWlmIChfX2dldF91c2VyKGZsYWdzLCAm
dXNlcl9xdWVyeV9jb25maWdfcHRyLT5mbGFncykpCisJCXJldHVybiAtRUZBVUxUOworCisJaWYg
KGZsYWdzICE9IDApCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKF9fcHV0X3VzZXIobl9jb25m
aWdzLCAmdXNlcl9xdWVyeV9jb25maWdfcHRyLT5jb25maWcpKQorCQlyZXR1cm4gLUVGQVVMVDsK
KworCWlmIChfX3B1dF91c2VyKCh1NjQpMVVMTCwgJnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+ZGF0
YVswXSkpCisJCXJldHVybiAtRUZBVUxUOworCisJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZpOTE1LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsK
KworCW5fY29uZmlncyA9IDE7CisJaWRyX2Zvcl9lYWNoX2VudHJ5KCZpOTE1LT5wZXJmLm1ldHJp
Y3NfaWRyLCBvYV9jb25maWcsIGlkKSB7CisJCXU2NCBfX3VzZXIgKml0ZW0gPQorCQkJdTY0X3Rv
X3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyICsKKwkJCQkJc2l6ZW9mKHN0cnVjdCBkcm1f
aTkxNV9xdWVyeV9wZXJmX2NvbmZpZykgKworCQkJCQluX2NvbmZpZ3MgKiBzaXplb2YodTY0KSk7
CisKKwkJaWYgKF9fcHV0X3VzZXIoKHU2NClpZCwgaXRlbSkpIHsKKwkJCXJldCA9IC1FRkFVTFQ7
CisJCQlnb3RvIG91dDsKKwkJfQorCQluX2NvbmZpZ3MrKzsKKwl9CisKKwlyZXQgPSB0b3RhbF9z
aXplOworCitvdXQ6CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJ
cmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJmX2NvbmZpZyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCSAgICAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0g
KnF1ZXJ5X2l0ZW0pCit7CisJc3dpdGNoIChxdWVyeV9pdGVtLT5mbGFncykgeworCWNhc2UgRFJN
X0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29uZmln
X2xpc3QoaTkxNSwgcXVlcnlfaXRlbSk7CisJY2FzZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJ
R19EQVRBX0ZPUl9VVUlEOgorCQlyZXR1cm4gcXVlcnlfcGVyZl9jb25maWdfZGF0YShpOTE1LCBx
dWVyeV9pdGVtLCB0cnVlKTsKKwljYXNlIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RBVEFf
Rk9SX0lEOgorCQlyZXR1cm4gcXVlcnlfcGVyZl9jb25maWdfZGF0YShpOTE1LCBxdWVyeV9pdGVt
LCBmYWxzZSk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorfQorCiBzdGF0aWMg
aW50ICgqIGNvbnN0IGk5MTVfcXVlcnlfZnVuY3NbXSkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkJCQlzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRlbSkg
PSB7CiAJcXVlcnlfdG9wb2xvZ3lfaW5mbywKIAlxdWVyeV9lbmdpbmVfaW5mbywKKwlxdWVyeV9w
ZXJmX2NvbmZpZywKIH07CiAKIGludCBpOTE1X3F1ZXJ5X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKZGlmZiAtLWdpdCBhL2lu
Y2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaApp
bmRleCA3MzU5ZjE5MDcyOGMuLjU0NWQ4N2E3MjJiNCAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBp
L2RybS9pOTE1X2RybS5oCisrKyBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaApAQCAtMTAz
Nyw4ICsxMDM3LDcgQEAgZW51bSBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcl9leHQgewogCURSTV9J
OTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9USU1FTElORV9GRU5DRVMgPSAwLAogCiAJLyoqCi0JICog
VGhpcyBpZGVudGlmaWVyIGlzIGFzc29jaWF0ZWQgd2l0aAotCSAqIGRybV9pOTE1X2dlbV9leGVj
YnVmZmVyX3BlcmZfZXh0LgorCSAqIFNlZSBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcl9wZXJmX2V4
dC4KIAkgKi8KIAlEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRfUEVSRiwKIApAQCAtMjExMCw2
ICsyMTA5LDcgQEAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gewogCV9fdTY0IHF1ZXJ5X2lk
OwogI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9UT1BPTE9HWV9JTkZPICAgIDEKICNkZWZpbmUgRFJN
X0k5MTVfUVVFUllfRU5HSU5FX0lORk8JMgorI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NP
TkZJRyAgICAgIDMKIC8qIE11c3QgYmUga2VwdCBjb21wYWN0IC0tIG5vIGhvbGVzIGFuZCB3ZWxs
IGRvY3VtZW50ZWQgKi8KIAogCS8qCkBAIC0yMTIxLDkgKzIxMjEsMTggQEAgc3RydWN0IGRybV9p
OTE1X3F1ZXJ5X2l0ZW0gewogCV9fczMyIGxlbmd0aDsKIAogCS8qCi0JICogVW51c2VkIGZvciBu
b3cuIE11c3QgYmUgY2xlYXJlZCB0byB6ZXJvLgorCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5
MTVfUVVFUllfVE9QT0xPR1lfSU5GTywgbXVzdCBiZSAwLgorCSAqCisJICogV2hlbiBxdWVyeV9p
ZCA9PSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJRywgbXVzdCBiZSBvbmUgb2YgdGhlCisJICog
Zm9sbG93aW5nIDoKKwkgKiAgICAgICAgIC0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElT
VAorCSAqICAgICAgICAgLSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlE
CisJICogICAgICAgICAtIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0ZPUl9VVUlECiAJICov
CiAJX191MzIgZmxhZ3M7CisjZGVmaW5lIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1Qg
ICAgICAgICAgMQorI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9V
VUlEIDIKKyNkZWZpbmUgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQgICAz
CiAKIAkvKgogCSAqIERhdGEgd2lsbCBiZSB3cml0dGVuIGF0IHRoZSBsb2NhdGlvbiBwb2ludGVk
IGJ5IGRhdGFfcHRyIHdoZW4gdGhlCkBAIC0yMjQ5LDYgKzIyNTgsNTYgQEAgc3RydWN0IGRybV9p
OTE1X3F1ZXJ5X2VuZ2luZV9pbmZvIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZW5naW5lX2luZm8gZW5n
aW5lc1tdOwogfTsKIAorLyoKKyAqIERhdGEgd3JpdHRlbiBieSB0aGUga2VybmVsIHdpdGggcXVl
cnkgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUcuCisgKi8KK3N0cnVjdCBkcm1faTkxNV9xdWVy
eV9wZXJmX2NvbmZpZyB7CisJdW5pb24geworCQkvKgorCQkgKiBXaGVuIHF1ZXJ5X2l0ZW0uZmxh
Z3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVCwgaTkxNSBzZXRzCisJCSAqIHRo
aXMgZmllbGRzIHRvIHRoZSBudW1iZXIgb2YgY29uZmlndXJhdGlvbnMgYXZhaWxhYmxlLgorCQkg
Ki8KKwkJX191NjQgbl9jb25maWdzOworCisJCS8qCisJCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJN
X0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQsCisJCSAqIGk5MTUgd2lsbCB1c2Ug
dGhlIHZhbHVlIGluIHRoaXMgZmllbGQgYXMgY29uZmlndXJhdGlvbgorCQkgKiBpZGVudGlmaWVy
IHRvIGRlY2lkZSB3aGF0IGRhdGEgdG8gd3JpdGUgaW50byBjb25maWdfcHRyLgorCQkgKi8KKwkJ
X191NjQgY29uZmlnOworCisJCS8qCisJCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVfUVVF
UllfUEVSRl9DT05GSUdfREFUQV9GT1JfVVVJRCwKKwkJICogaTkxNSB3aWxsIHVzZSB0aGUgdmFs
dWUgaW4gdGhpcyBmaWVsZCBhcyBjb25maWd1cmF0aW9uCisJCSAqIGlkZW50aWZpZXIgdG8gZGVj
aWRlIHdoYXQgZGF0YSB0byB3cml0ZSBpbnRvIGNvbmZpZ19wdHIuCisJCSAqCisJCSAqIFN0cmlu
ZyBmb3JtYXR0ZWQgbGlrZSAiJTA4eC0lMDR4LSUwNHgtJTA0eC0lMDEyeCIKKwkJICovCisJCWNo
YXIgdXVpZFszNl07CisJfTsKKworCS8qCisJICogVW51c2VkIGZvciBub3cuIE11c3QgYmUgY2xl
YXJlZCB0byB6ZXJvLgorCSAqLworCV9fdTMyIGZsYWdzOworCisJLyoKKwkgKiBXaGVuIHF1ZXJ5
X2l0ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVCwgaTkxNSB3aWxs
CisJICogd3JpdGUgYW4gYXJyYXkgb2YgX191NjQgb2YgY29uZmlndXJhdGlvbiBpZGVudGlmaWVy
cy4KKwkgKgorCSAqIFdoZW4gcXVlcnlfaXRlbS5mbGFncyA9PSBEUk1fSTkxNV9RVUVSWV9QRVJG
X0NPTkZJR19EQVRBLCBpOTE1IHdpbGwKKwkgKiB3cml0ZSBhIHN0cnVjdCBkcm1faTkxNV9wZXJm
X29hX2NvbmZpZy4gSWYgdGhlIGZvbGxvd2luZyBmaWVsZHMgb2YKKwkgKiBkcm1faTkxNV9wZXJm
X29hX2NvbmZpZyBhcmUgc2V0IG5vdCBzZXQgdG8gMCwgaTkxNSB3aWxsIHdyaXRlIGludG8KKwkg
KiB0aGUgYXNzb2NpYXRlZCBwb2ludGVycyB0aGUgdmFsdWVzIG9mIHN1Ym1pdHRlZCB3aGVuIHRo
ZQorCSAqIGNvbmZpZ3VyYXRpb24gd2FzIGNyZWF0ZWQgOgorCSAqCisJICogICAgICAgICAtIG5f
bXV4X3JlZ3MKKwkgKiAgICAgICAgIC0gbl9ib29sZWFuX3JlZ3MKKwkgKiAgICAgICAgIC0gbl9m
bGV4X3JlZ3MKKwkgKi8KKwlfX3U4IGRhdGFbXTsKK307CisKICNpZiBkZWZpbmVkKF9fY3BsdXNw
bHVzKQogfQogI2VuZGlmCi0tIAoyLjIxLjAuMzkyLmdmOGY2Nzg3MTU5ZQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

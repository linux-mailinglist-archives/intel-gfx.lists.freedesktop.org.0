Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 59CB2193D4
	for <lists+intel-gfx@lfdr.de>; Thu,  9 May 2019 22:52:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C168B89CA0;
	Thu,  9 May 2019 20:52:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 925E989CA0
 for <intel-gfx@lists.freedesktop.org>; Thu,  9 May 2019 20:52:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16508384-1500050 
 for multiple; Thu, 09 May 2019 21:51:56 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  9 May 2019 21:51:54 +0100
Message-Id: <20190509205154.6299-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Truly bump ready tasks ahead of
 busywaits
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Dmitry Ermilov <dmitry.ermilov@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gY29tbWl0IGI3NDA0YzdlY2IzOCAoImRybS9pOTE1OiBCdW1wIHJlYWR5IHRhc2tzIGFoZWFk
IG9mCmJ1c3l3YWl0cyIpLCBJIHRyaWVkIGN1dHRpbmcgYSBjb3JuZXIgaW4gb3JkZXIgdG8gbm90
IGluc3RhbGwgYSBzaWduYWwKZm9yIGVhY2ggb2Ygb3VyIGRlcGVuZGVuY2llcywgYW5kIG9ubHkg
bGlzdGVuZWQgdG8gcmVxdWVzdHMgb24gd2hpY2ggd2UKd2VyZSBpbnRlbmRpbmcgdG8gYnVzeXdh
aXQuIFRoZSBjb21wcm9taXNlIHRoYXQgd2FzIG1hZGUgd2FzIHRoYXQKaW5zdGVhZCBvZiB0aGVu
IGJlaW5nIGFibGUgdG8gcHJvbWl0ZSB0aGUgcmVxdWVzdCB3aXRoIGEgZnVsbApOT1NFTUFQSE9S
RSBsaWtlIGl0cyBub24tYnVzeXdhaXRpbmcgYnJldGhyZW4sIGFzIHdlIGhhZCBub3QgZW5zdXJl
ZCB3ZQpoYWQgY2xlYXJlZCB0aGUgc2VtYXBob3JlIGNoYWluLCB3ZSBzZXR0bGVkIGZvciBvbmx5
IHVzaW5nIHRoZSBORVdDTElFTlQKYm9vc3QuIFdpdGggYW4gb3ZlciBzYXR1cmF0ZWQgc3lzdGVt
IHdpdGggbXVsdGlwbGUgTkVXQ0xJRU5UUyBpbiBmbGlnaHQKYXQgYW55IHRpbWUsIHRoaXMgd2Fz
IGZvdW5kIHRvIGJlIGFuIGluYWRlcXVhdGUgcHJvbW90aW9uIGFuZCBsZWZ0IHVzCndpdGggYSBt
dWNoIHBvb3JlciBzY2hlZHVsaW5nIG9yZGVyIHRoYW4gcHJpb3IgdG8gdXNpbmcgc2VtYXBob3Jl
cy4KClRoZSBvdXRjb21lIG9mIHRoaXMgcGF0Y2gsIGlzIHRoYXQgYWxsIHJlcXVlc3RzIGhhdmUg
Tk9TRU1BUEhPUkUKcHJpb3JpdHkgd2hlbiB0aGV5IGhhdmUgbm8gZGVwZW5kZW5jaWVzIGFuZCBh
cmUgcmVhZHkgdG8gcnVuIGFuZCBub3QKYnVzeXdhaXQsIHJlc3RvcmluZyB0aGUgcHJlLXNlbWFw
aG9yZSBvcmRlcmluZyBvbiBzYXR1cmF0ZWQgc3lzdGVtcy4KCkZpeGVzOiBiNzQwNGM3ZWNiMzgg
KCJkcm0vaTkxNTogQnVtcCByZWFkeSB0YXNrcyBhaGVhZCBvZiBidXN5d2FpdHMiKQpTaWduZWQt
b2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRr
byBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+CkNjOiBEbWl0cnkgUm9nb3poa2lu
IDxkbWl0cnkudi5yb2dvemhraW5AaW50ZWwuY29tPgpDYzogRG1pdHJ5IEVybWlsb3YgPGRtaXRy
eS5lcm1pbG92QGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuYyB8IDMxICsrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
MTIgaW5zZXJ0aW9ucygrKSwgMTkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYwppbmRleCBiZWQyMTMxNDhjYmIuLjU1NjlkZmYzODg3YiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTU2OSwxOCArNTY5LDcgQEAgc2VtYXBob3JlX25vdGlmeShz
dHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UsIGVudW0gaTkxNV9zd19mZW5jZV9ub3RpZnkgc3Rh
dGUpCiAKIAlzd2l0Y2ggKHN0YXRlKSB7CiAJY2FzZSBGRU5DRV9DT01QTEVURToKLQkJLyoKLQkJ
ICogV2Ugb25seSBjaGVjayBhIHNtYWxsIHBvcnRpb24gb2Ygb3VyIGRlcGVuZGVuY2llcwotCQkg
KiBhbmQgc28gY2Fubm90IGd1YXJhbnRlZSB0aGF0IHRoZXJlIHJlbWFpbnMgbm8KLQkJICogc2Vt
YXBob3JlIGNoYWluIGFjcm9zcyBhbGwuIEluc3RlYWQgb2Ygb3B0aW5nCi0JCSAqIGZvciB0aGUg
ZnVsbCBOT1NFTUFQSE9SRSBib29zdCwgd2UgZ28gZm9yIHRoZQotCQkgKiBzbWFsbGVyIChidXQg
c3RpbGwgcHJlZW1wdGluZykgYm9vc3Qgb2YKLQkJICogTkVXQ0xJRU5ULiBUaGlzIHdpbGwgYmUg
ZW5vdWdoIHRvIGJvb3N0IG92ZXIKLQkJICogYSBidXN5d2FpdGluZyByZXF1ZXN0IChhcyB0aGF0
IGNhbm5vdCBiZQotCQkgKiBORVdDTElFTlQpIHdpdGhvdXQgYWNjaWRlbnRhbGx5IGJvb3N0aW5n
Ci0JCSAqIGEgYnVzeXdhaXQgb3ZlciByZWFsIHdvcmsgZWxzZXdoZXJlLgotCQkgKi8KLQkJaTkx
NV9zY2hlZHVsZV9idW1wX3ByaW9yaXR5KHJlcXVlc3QsIEk5MTVfUFJJT1JJVFlfTkVXQ0xJRU5U
KTsKKwkJaTkxNV9zY2hlZHVsZV9idW1wX3ByaW9yaXR5KHJlcXVlc3QsIEk5MTVfUFJJT1JJVFlf
Tk9TRU1BUEhPUkUpOwogCQlicmVhazsKIAogCWNhc2UgRkVOQ0VfRlJFRToKQEAgLTg0NiwxMiAr
ODM1LDYgQEAgZW1pdF9zZW1hcGhvcmVfd2FpdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICp0bywKIAlp
ZiAoZXJyIDwgMCkKIAkJcmV0dXJuIGVycjsKIAotCWVyciA9IGk5MTVfc3dfZmVuY2VfYXdhaXRf
ZG1hX2ZlbmNlKCZ0by0+c2VtYXBob3JlLAotCQkJCQkgICAgJmZyb20tPmZlbmNlLCAwLAotCQkJ
CQkgICAgSTkxNV9GRU5DRV9HRlApOwotCWlmIChlcnIgPCAwKQotCQlyZXR1cm4gZXJyOwotCiAJ
LyogT25seSBzdWJtaXQgb3VyIHNwaW5uZXIgYWZ0ZXIgdGhlIHNpZ25hbGVyIGlzIHJ1bm5pbmch
ICovCiAJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2V4ZWN1dGlvbih0bywgZnJvbSwgZ2ZwKTsK
IAlpZiAoZXJyKQpAQCAtOTE3LDggKzkwMCwxOCBAQCBpOTE1X3JlcXVlc3RfYXdhaXRfcmVxdWVz
dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICp0bywgc3RydWN0IGk5MTVfcmVxdWVzdCAqZnJvbSkKIAkJ
CQkJCSAgICAmZnJvbS0+ZmVuY2UsIDAsCiAJCQkJCQkgICAgSTkxNV9GRU5DRV9HRlApOwogCX0K
KwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCWlmICh0by0+c2NoZWQuZmxhZ3MgJiBJ
OTE1X1NDSEVEX0hBU19TRU1BUEhPUkVfQ0hBSU4pIHsKKwkJcmV0ID0gaTkxNV9zd19mZW5jZV9h
d2FpdF9kbWFfZmVuY2UoJnRvLT5zZW1hcGhvcmUsCisJCQkJCQkgICAgJmZyb20tPmZlbmNlLCAw
LAorCQkJCQkJICAgIEk5MTVfRkVOQ0VfR0ZQKTsKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4g
cmV0OworCX0KIAotCXJldHVybiByZXQgPCAwID8gcmV0IDogMDsKKwlyZXR1cm4gMDsKIH0KIAog
aW50Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

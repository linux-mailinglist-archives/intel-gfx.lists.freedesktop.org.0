Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A19F716EC3B
	for <lists+intel-gfx@lfdr.de>; Tue, 25 Feb 2020 18:13:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DF1F06EB50;
	Tue, 25 Feb 2020 17:13:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6CC206EB50
 for <intel-gfx@lists.freedesktop.org>; Tue, 25 Feb 2020 17:13:27 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Feb 2020 09:12:27 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,484,1574150400"; d="scan'208";a="271385318"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga002.fm.intel.com with SMTP; 25 Feb 2020 09:12:24 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Tue, 25 Feb 2020 19:12:24 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 25 Feb 2020 19:11:24 +0200
Message-Id: <20200225171125.28885-20-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200225171125.28885-1-ville.syrjala@linux.intel.com>
References: <20200225171125.28885-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 19/20] drm/i915: Do a bit more initial
 readout for dbuf
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClJl
YWRvdXQgdGhlIGRidWYgcmVsYXRlZCBzdHVmZiBkdXJpbmcgZHJpdmVyIGluaXQvcmVzdW1lIGFu
ZApzdGljayBpdCBpbnRvIG91ciBkYnVmIHN0YXRlLgoKQ2M6IFN0YW5pc2xhdiBMaXNvdnNraXkg
PHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBWaWxsZSBTeXJq
w6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgIDQgLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgIHwgNDggKysrKysrKysrKysrKysrKysrKy0KIDIg
ZmlsZXMgY2hhbmdlZCwgNDYgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGUzZGY0M2YzOTMy
ZC4uMjFhZDFhZGNjMWViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYwpAQCAtMTc0NzUsMTQgKzE3NDc1LDEwIEBAIHZvaWQgaW50ZWxfbW9kZXNldF9p
bml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpbnRlbF9j
ZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUgPQogCQl0b19pbnRlbF9jZGNsa19zdGF0ZShpOTE1LT5j
ZGNsay5vYmouc3RhdGUpOwotCXN0cnVjdCBpbnRlbF9kYnVmX3N0YXRlICpkYnVmX3N0YXRlID0K
LQkJdG9faW50ZWxfZGJ1Zl9zdGF0ZShpOTE1LT5kYnVmLm9iai5zdGF0ZSk7CiAKIAlpbnRlbF91
cGRhdGVfY2RjbGsoaTkxNSk7CiAJaW50ZWxfZHVtcF9jZGNsa19jb25maWcoJmk5MTUtPmNkY2xr
Lmh3LCAiQ3VycmVudCBDRENMSyIpOwogCWNkY2xrX3N0YXRlLT5sb2dpY2FsID0gY2RjbGtfc3Rh
dGUtPmFjdHVhbCA9IGk5MTUtPmNkY2xrLmh3OwotCi0JZGJ1Zl9zdGF0ZS0+ZW5hYmxlZF9zbGlj
ZXMgPSBpOTE1LT5kYnVmLmVuYWJsZWRfc2xpY2VzOwogfQogCiBzdGF0aWMgaW50IHNhbml0aXpl
X3dhdGVybWFya3NfYWRkX2FmZmVjdGVkKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IGMxMTUwOGZiM2ZhYy4uN2VkYWM1MDZkMzQzIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTUzNjMsNiArNTM2MywxOCBAQCBzdGF0aWMgaW5s
aW5lIGJvb2wgc2tsX2RkYl9lbnRyaWVzX292ZXJsYXAoY29uc3Qgc3RydWN0IHNrbF9kZGJfZW50
cnkgKmEsCiAJcmV0dXJuIGEtPnN0YXJ0IDwgYi0+ZW5kICYmIGItPnN0YXJ0IDwgYS0+ZW5kOwog
fQogCitzdGF0aWMgdm9pZCBza2xfZGRiX2VudHJ5X3VuaW9uKHN0cnVjdCBza2xfZGRiX2VudHJ5
ICphLAorCQkJCWNvbnN0IHN0cnVjdCBza2xfZGRiX2VudHJ5ICpiKQoreworCWlmIChhLT5lbmQg
JiYgYi0+ZW5kKSB7CisJCWEtPnN0YXJ0ID0gbWluKGEtPnN0YXJ0LCBiLT5zdGFydCk7CisJCWEt
PmVuZCA9IG1heChhLT5lbmQsIGItPmVuZCk7CisJfSBlbHNlIGlmIChiLT5lbmQpIHsKKwkJYS0+
c3RhcnQgPSBiLT5zdGFydDsKKwkJYS0+ZW5kID0gYi0+ZW5kOworCX0KK30KKwogYm9vbCBza2xf
ZGRiX2FsbG9jYXRpb25fb3ZlcmxhcHMoY29uc3Qgc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYiwK
IAkJCQkgY29uc3Qgc3RydWN0IHNrbF9kZGJfZW50cnkgKmVudHJpZXMsCiAJCQkJIGludCBudW1f
ZW50cmllcywgaW50IGlnbm9yZV9pZHgpCkBAIC01ODU3LDE0ICs1ODY5LDQ2IEBAIHZvaWQgc2ts
X3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiB2b2lkIHNr
bF93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewor
CXN0cnVjdCBpbnRlbF9kYnVmX3N0YXRlICpkYnVmX3N0YXRlID0KKwkJdG9faW50ZWxfZGJ1Zl9z
dGF0ZShkZXZfcHJpdi0+ZGJ1Zi5vYmouc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
OwotCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlOwogCiAJZm9yX2VhY2hfaW50
ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YykgewotCQljcnRjX3N0YXRlID0gdG9faW50ZWxf
Y3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKKwkJc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUgPQorCQkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsK
KwkJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOworCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lk
OwogCiAJCXNrbF9waXBlX3dtX2dldF9od19zdGF0ZShjcnRjLCAmY3J0Y19zdGF0ZS0+d20uc2ts
Lm9wdGltYWwpOworCisJCW1lbXNldCgmZGJ1Zl9zdGF0ZS0+ZGRiW3BpcGVdLCAwLCBzaXplb2Yo
ZGJ1Zl9zdGF0ZS0+ZGRiW3BpcGVdKSk7CisKKwkJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0Yyhj
cnRjLCBwbGFuZV9pZCkgeworCQkJc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYl95ID0KKwkJCQkm
Y3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsKKwkJCXN0cnVjdCBza2xf
ZGRiX2VudHJ5ICpkZGJfdXYgPQorCQkJCSZjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3V2
W3BsYW5lX2lkXTsKKworCQkJc2tsX2RkYl9nZXRfaHdfcGxhbmVfc3RhdGUoZGV2X3ByaXYsIGNy
dGMtPnBpcGUsCisJCQkJCQkgICBwbGFuZV9pZCwgZGRiX3ksIGRkYl91dik7CisKKwkJCXNrbF9k
ZGJfZW50cnlfdW5pb24oJmRidWZfc3RhdGUtPmRkYltwaXBlXSwgZGRiX3kpOworCQkJc2tsX2Rk
Yl9lbnRyeV91bmlvbigmZGJ1Zl9zdGF0ZS0+ZGRiW3BpcGVdLCBkZGJfdXYpOworCQl9CisKKwkJ
ZGJ1Zl9zdGF0ZS0+c2xpY2VzW3BpcGVdID0KKwkJCXNrbF9jb21wdXRlX2RidWZfc2xpY2VzKGNy
dGMsIGRidWZfc3RhdGUtPmFjdGl2ZV9waXBlcyk7CisKKwkJZGJ1Zl9zdGF0ZS0+d2VpZ2h0W3Bp
cGVdID0gaW50ZWxfY3J0Y19kZGJfd2VpZ2h0KGNydGNfc3RhdGUpOworCisJCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJbQ1JUQzolZDolc10gZGJ1ZiBzbGljZXMgMHgleCwg
ZGRiICglZCAtICVkKSwgYWN0aXZlIHBpcGVzIDB4JXhcbiIsCisJCQkgICAgY3J0Yy0+YmFzZS5i
YXNlLmlkLCBjcnRjLT5iYXNlLm5hbWUsCisJCQkgICAgZGJ1Zl9zdGF0ZS0+c2xpY2VzW3BpcGVd
LCBkYnVmX3N0YXRlLT5kZGJbcGlwZV0uc3RhcnQsCisJCQkgICAgZGJ1Zl9zdGF0ZS0+ZGRiW3Bp
cGVdLmVuZCwgZGJ1Zl9zdGF0ZS0+YWN0aXZlX3BpcGVzKTsKIAl9CisKKwlkYnVmX3N0YXRlLT5l
bmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT5kYnVmLmVuYWJsZWRfc2xpY2VzOwogfQogCiBzdGF0
aWMgdm9pZCBpbGtfcGlwZV93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMp
Ci0tIAoyLjI0LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eAo=

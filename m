Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AE15C82CFF
	for <lists+intel-gfx@lfdr.de>; Tue,  6 Aug 2019 09:42:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 254446E31E;
	Tue,  6 Aug 2019 07:42:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 63E706E31E
 for <intel-gfx@lists.freedesktop.org>; Tue,  6 Aug 2019 07:42:36 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17900284-1500050 
 for multiple; Tue, 06 Aug 2019 08:42:20 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  6 Aug 2019 08:42:19 +0100
Message-Id: <20190806074219.11043-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Use drm_i915_private directly from
 drv_get_drvdata()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2Ugc3RvcmUgYSBwb2ludGVyIHRvIGk5MTUgaW4gdGhlIGRydmRhdGEgZmllbGQgKGFzIHRo
ZSBwb2ludGVyIGlzIGJvdGgKYW4gYWxpYXMgdG8gdGhlIGRybV9kZXZpY2UgYW5kIGRybV9pOTE1
X3ByaXZhdGUpLCB3ZSBjYW4gdXNlIHRoZSBzdG9yZWQKcG9pbnRlciBkaXJlY3RseSBhcyB0aGUg
aTkxNSBkZXZpY2UuCgp2MjogU3RvcmUgYW5kIHVzZSBpOTE1IGluc2lkZSBkcnZfZ2V0X2RydmRh
dGEoKQp2MzogT25seSBleHBlY3QgaTkxNSBpbnNpZGUgZHJ2X2dldF9kcnZkYXRhKCkgc28gZHJv
cCB0aGUgYXNzdW1lZAppOTE1L2RybSBlcXVpdmFsZW5jZS4KClNpZ25lZC1vZmYtYnk6IENocmlz
IFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogQW5kaSBTaHl0aSA8YW5kaS5z
aHl0aUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAg
ICAgICAgICAgIHwgMTUzICsrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BjaS5jICAgICAgICAgICAgICAgfCAgMTQgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfc2VsZnRlc3QuYyAgICB8ICAgMiArLQogNCBmaWxlcyBjaGFuZ2VkLCA5MSBpbnNl
cnRpb25zKCspLCA4NyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCAy
YWY2NThhOThhYmQuLmFjNTg2OGMxMmI5NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC02
NDIsMzkgKzY0Miw0NSBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGk5MTVfdmdhX3NldF9kZWNvZGUo
dm9pZCAqY29va2llLCBib29sIHN0YXRlKQogCQlyZXR1cm4gVkdBX1JTUkNfTk9STUFMX0lPIHwg
VkdBX1JTUkNfTk9STUFMX01FTTsKIH0KIAotc3RhdGljIGludCBpOTE1X3Jlc3VtZV9zd2l0Y2hl
cm9vKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwotc3RhdGljIGludCBpOTE1X3N1c3BlbmRfc3dp
dGNoZXJvbyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBwbV9tZXNzYWdlX3Qgc3RhdGUpOworc3Rh
dGljIGludCBpOTE1X3Jlc3VtZV9zd2l0Y2hlcm9vKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKK3N0YXRpYyBpbnQgaTkxNV9zdXNwZW5kX3N3aXRjaGVyb28oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCisJCQkJICAgcG1fbWVzc2FnZV90IHN0YXRlKTsKIAogc3RhdGljIHZv
aWQgaTkxNV9zd2l0Y2hlcm9vX3NldF9zdGF0ZShzdHJ1Y3QgcGNpX2RldiAqcGRldiwgZW51bSB2
Z2Ffc3dpdGNoZXJvb19zdGF0ZSBzdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
cGNpX2dldF9kcnZkYXRhKHBkZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
cGRldl90b19pOTE1KHBkZXYpOwogCXBtX21lc3NhZ2VfdCBwbW0gPSB7IC5ldmVudCA9IFBNX0VW
RU5UX1NVU1BFTkQgfTsKIAorCWlmICghaTkxNSkgeworCQlkZXZfZXJyKCZwZGV2LT5kZXYsICJE
Uk0gbm90IGluaXRpYWxpemVkLCBhYm9ydGluZyBzd2l0Y2guXG4iKTsKKwkJcmV0dXJuOworCX0K
KwogCWlmIChzdGF0ZSA9PSBWR0FfU1dJVENIRVJPT19PTikgewogCQlwcl9pbmZvKCJzd2l0Y2hl
ZCBvblxuIik7Ci0JCWRldi0+c3dpdGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRDSF9QT1dFUl9D
SEFOR0lORzsKKwkJaTkxNS0+ZHJtLnN3aXRjaF9wb3dlcl9zdGF0ZSA9IERSTV9TV0lUQ0hfUE9X
RVJfQ0hBTkdJTkc7CiAJCS8qIGk5MTUgcmVzdW1lIGhhbmRsZXIgZG9lc24ndCBzZXQgdG8gRDAg
Ki8KIAkJcGNpX3NldF9wb3dlcl9zdGF0ZShwZGV2LCBQQ0lfRDApOwotCQlpOTE1X3Jlc3VtZV9z
d2l0Y2hlcm9vKGRldik7Ci0JCWRldi0+c3dpdGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRDSF9Q
T1dFUl9PTjsKKwkJaTkxNV9yZXN1bWVfc3dpdGNoZXJvbyhpOTE1KTsKKwkJaTkxNS0+ZHJtLnN3
aXRjaF9wb3dlcl9zdGF0ZSA9IERSTV9TV0lUQ0hfUE9XRVJfT047CiAJfSBlbHNlIHsKIAkJcHJf
aW5mbygic3dpdGNoZWQgb2ZmXG4iKTsKLQkJZGV2LT5zd2l0Y2hfcG93ZXJfc3RhdGUgPSBEUk1f
U1dJVENIX1BPV0VSX0NIQU5HSU5HOwotCQlpOTE1X3N1c3BlbmRfc3dpdGNoZXJvbyhkZXYsIHBt
bSk7Ci0JCWRldi0+c3dpdGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRDSF9QT1dFUl9PRkY7CisJ
CWk5MTUtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUgPSBEUk1fU1dJVENIX1BPV0VSX0NIQU5HSU5H
OworCQlpOTE1X3N1c3BlbmRfc3dpdGNoZXJvbyhpOTE1LCBwbW0pOworCQlpOTE1LT5kcm0uc3dp
dGNoX3Bvd2VyX3N0YXRlID0gRFJNX1NXSVRDSF9QT1dFUl9PRkY7CiAJfQogfQogCiBzdGF0aWMg
Ym9vbCBpOTE1X3N3aXRjaGVyb29fY2FuX3N3aXRjaChzdHJ1Y3QgcGNpX2RldiAqcGRldikKIHsK
LQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gcGNpX2dldF9kcnZkYXRhKHBkZXYpOworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gcGRldl90b19pOTE1KHBkZXYpOwogCiAJLyoKIAkg
KiBGSVhNRTogb3Blbl9jb3VudCBpcyBwcm90ZWN0ZWQgYnkgZHJtX2dsb2JhbF9tdXRleCBidXQg
dGhhdCB3b3VsZCBsZWFkIHRvCiAJICogbG9ja2luZyBpbnZlcnNpb24gd2l0aCB0aGUgZHJpdmVy
IGxvYWQgcGF0aC4gQW5kIHRoZSBhY2Nlc3MgaGVyZSBpcwogCSAqIGNvbXBsZXRlbHkgcmFjeSBh
bnl3YXkuIFNvIGRvbid0IGJvdGhlciB3aXRoIGxvY2tpbmcgZm9yIG5vdy4KIAkgKi8KLQlyZXR1
cm4gZGV2LT5vcGVuX2NvdW50ID09IDA7CisJcmV0dXJuIGk5MTUgJiYgaTkxNS0+ZHJtLm9wZW5f
Y291bnQgPT0gMDsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCB2Z2Ffc3dpdGNoZXJvb19jbGll
bnRfb3BzIGk5MTVfc3dpdGNoZXJvb19vcHMgPSB7CkBAIC0xODQxLDkgKzE4NDcsMTAgQEAgaTkx
NV9kcml2ZXJfY3JlYXRlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1Y3QgcGNpX2Rl
dmljZV9pZCAqZW50KQogCQlyZXR1cm4gRVJSX1BUUihlcnIpOwogCX0KIAotCWk5MTUtPmRybS5w
ZGV2ID0gcGRldjsKIAlpOTE1LT5kcm0uZGV2X3ByaXZhdGUgPSBpOTE1OwotCXBjaV9zZXRfZHJ2
ZGF0YShwZGV2LCAmaTkxNS0+ZHJtKTsKKworCWk5MTUtPmRybS5wZGV2ID0gcGRldjsKKwlwY2lf
c2V0X2RydmRhdGEocGRldiwgaTkxNSk7CiAKIAkvKiBTZXR1cCB0aGUgd3JpdGUtb25jZSAiY29u
c3RhbnQiIGRldmljZSBpbmZvICovCiAJZGV2aWNlX2luZm8gPSBta3dyaXRlX2RldmljZV9pbmZv
KGk5MTUpOwpAQCAtMTk0Myw1MSArMTk1MCw1MCBAQCBpbnQgaTkxNV9kcml2ZXJfcHJvYmUoc3Ry
dWN0IHBjaV9kZXYgKnBkZXYsIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lkICplbnQpCiAJcmV0
dXJuIHJldDsKIH0KIAotdm9pZCBpOTE1X2RyaXZlcl9yZW1vdmUoc3RydWN0IGRybV9kZXZpY2Ug
KmRldikKK3ZvaWQgaTkxNV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2
KTsKLQlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGRldl9wcml2LT5kcm0ucGRldjsKKwlzdHJ1Y3Qg
cGNpX2RldiAqcGRldiA9IGk5MTUtPmRybS5wZGV2OwogCi0JZGlzYWJsZV9ycG1fd2FrZXJlZl9h
c3NlcnRzKCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CisJZGlzYWJsZV9ycG1fd2FrZXJlZl9hc3Nl
cnRzKCZpOTE1LT5ydW50aW1lX3BtKTsKIAotCWk5MTVfZHJpdmVyX3VucmVnaXN0ZXIoZGV2X3By
aXYpOworCWk5MTVfZHJpdmVyX3VucmVnaXN0ZXIoaTkxNSk7CiAKIAkvKgogCSAqIEFmdGVyIHVu
cmVnaXN0ZXJpbmcgdGhlIGRldmljZSB0byBwcmV2ZW50IGFueSBuZXcgdXNlcnMsIGNhbmNlbAog
CSAqIGFsbCBpbi1mbGlnaHQgcmVxdWVzdHMgc28gdGhhdCB3ZSBjYW4gcXVpY2tseSB1bmJpbmQg
dGhlIGFjdGl2ZQogCSAqIHJlc291cmNlcy4KIAkgKi8KLQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZk
ZXZfcHJpdi0+Z3QpOworCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAogCS8qIEZs
dXNoIGFueSBleHRlcm5hbCBjb2RlIHRoYXQgc3RpbGwgbWF5IGJlIHVuZGVyIHRoZSBSQ1UgbG9j
ayAqLwogCXN5bmNocm9uaXplX3JjdSgpOwogCi0JaTkxNV9nZW1fc3VzcGVuZChkZXZfcHJpdik7
CisJaTkxNV9nZW1fc3VzcGVuZChpOTE1KTsKIAotCWRybV9hdG9taWNfaGVscGVyX3NodXRkb3du
KGRldik7CisJZHJtX2F0b21pY19oZWxwZXJfc2h1dGRvd24oJmk5MTUtPmRybSk7CiAKLQlpbnRl
bF9ndnRfZHJpdmVyX3JlbW92ZShkZXZfcHJpdik7CisJaW50ZWxfZ3Z0X2RyaXZlcl9yZW1vdmUo
aTkxNSk7CiAKLQlpbnRlbF9tb2Rlc2V0X2RyaXZlcl9yZW1vdmUoZGV2KTsKKwlpbnRlbF9tb2Rl
c2V0X2RyaXZlcl9yZW1vdmUoJmk5MTUtPmRybSk7CiAKLQlpbnRlbF9iaW9zX2RyaXZlcl9yZW1v
dmUoZGV2X3ByaXYpOworCWludGVsX2Jpb3NfZHJpdmVyX3JlbW92ZShpOTE1KTsKIAogCXZnYV9z
d2l0Y2hlcm9vX3VucmVnaXN0ZXJfY2xpZW50KHBkZXYpOwogCXZnYV9jbGllbnRfcmVnaXN0ZXIo
cGRldiwgTlVMTCwgTlVMTCwgTlVMTCk7CiAKLQlpbnRlbF9jc3JfdWNvZGVfZmluaShkZXZfcHJp
dik7CisJaW50ZWxfY3NyX3Vjb2RlX2ZpbmkoaTkxNSk7CiAKIAkvKiBGcmVlIGVycm9yIHN0YXRl
IGFmdGVyIGludGVycnVwdHMgYXJlIGZ1bGx5IGRpc2FibGVkLiAqLwotCWNhbmNlbF9kZWxheWVk
X3dvcmtfc3luYygmZGV2X3ByaXYtPmd0LmhhbmdjaGVjay53b3JrKTsKLQlpOTE1X3Jlc2V0X2Vy
cm9yX3N0YXRlKGRldl9wcml2KTsKKwljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmk5MTUtPmd0
LmhhbmdjaGVjay53b3JrKTsKKwlpOTE1X3Jlc2V0X2Vycm9yX3N0YXRlKGk5MTUpOwogCi0JaTkx
NV9nZW1fZHJpdmVyX3JlbW92ZShkZXZfcHJpdik7CisJaTkxNV9nZW1fZHJpdmVyX3JlbW92ZShp
OTE1KTsKIAotCWludGVsX3Bvd2VyX2RvbWFpbnNfZHJpdmVyX3JlbW92ZShkZXZfcHJpdik7CisJ
aW50ZWxfcG93ZXJfZG9tYWluc19kcml2ZXJfcmVtb3ZlKGk5MTUpOwogCi0JaTkxNV9kcml2ZXJf
aHdfcmVtb3ZlKGRldl9wcml2KTsKKwlpOTE1X2RyaXZlcl9od19yZW1vdmUoaTkxNSk7CiAKLQll
bmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0cygmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOworCWVuYWJs
ZV9ycG1fd2FrZXJlZl9hc3NlcnRzKCZpOTE1LT5ydW50aW1lX3BtKTsKIH0KIAogc3RhdGljIHZv
aWQgaTkxNV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQpAQCAtMjIxMCwy
OCArMjIxNiwyMyBAQCBzdGF0aWMgaW50IGk5MTVfZHJtX3N1c3BlbmRfbGF0ZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCBib29sIGhpYmVybmF0aW9uKQogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRp
YyBpbnQgaTkxNV9zdXNwZW5kX3N3aXRjaGVyb28oc3RydWN0IGRybV9kZXZpY2UgKmRldiwgcG1f
bWVzc2FnZV90IHN0YXRlKQorc3RhdGljIGludAoraTkxNV9zdXNwZW5kX3N3aXRjaGVyb28oc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHBtX21lc3NhZ2VfdCBzdGF0ZSkKIHsKIAlpbnQg
ZXJyb3I7CiAKLQlpZiAoIWRldikgewotCQlEUk1fRVJST1IoImRldjogJXBcbiIsIGRldik7Ci0J
CURSTV9FUlJPUigiRFJNIG5vdCBpbml0aWFsaXplZCwgYWJvcnRpbmcgc3VzcGVuZC5cbiIpOwot
CQlyZXR1cm4gLUVOT0RFVjsKLQl9Ci0KIAlpZiAoV0FSTl9PTl9PTkNFKHN0YXRlLmV2ZW50ICE9
IFBNX0VWRU5UX1NVU1BFTkQgJiYKIAkJCSBzdGF0ZS5ldmVudCAhPSBQTV9FVkVOVF9GUkVFWkUp
KQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWlmIChkZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9PSBE
Uk1fU1dJVENIX1BPV0VSX09GRikKKwlpZiAoaTkxNS0+ZHJtLnN3aXRjaF9wb3dlcl9zdGF0ZSA9
PSBEUk1fU1dJVENIX1BPV0VSX09GRikKIAkJcmV0dXJuIDA7CiAKLQllcnJvciA9IGk5MTVfZHJt
X3N1c3BlbmQoZGV2KTsKKwllcnJvciA9IGk5MTVfZHJtX3N1c3BlbmQoJmk5MTUtPmRybSk7CiAJ
aWYgKGVycm9yKQogCQlyZXR1cm4gZXJyb3I7CiAKLQlyZXR1cm4gaTkxNV9kcm1fc3VzcGVuZF9s
YXRlKGRldiwgZmFsc2UpOworCXJldHVybiBpOTE1X2RybV9zdXNwZW5kX2xhdGUoJmk5MTUtPmRy
bSwgZmFsc2UpOwogfQogCiBzdGF0aWMgaW50IGk5MTVfZHJtX3Jlc3VtZShzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2KQpAQCAtMjM4NCw1MyArMjM4NSw1MyBAQCBzdGF0aWMgaW50IGk5MTVfZHJtX3Jl
c3VtZV9lYXJseShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXJldHVybiByZXQ7CiB9CiAKLXN0
YXRpYyBpbnQgaTkxNV9yZXN1bWVfc3dpdGNoZXJvbyhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQor
c3RhdGljIGludCBpOTE1X3Jlc3VtZV9zd2l0Y2hlcm9vKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogewogCWludCByZXQ7CiAKLQlpZiAoZGV2LT5zd2l0Y2hfcG93ZXJfc3RhdGUgPT0g
RFJNX1NXSVRDSF9QT1dFUl9PRkYpCisJaWYgKGk5MTUtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUg
PT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpCiAJCXJldHVybiAwOwogCi0JcmV0ID0gaTkxNV9kcm1f
cmVzdW1lX2Vhcmx5KGRldik7CisJcmV0ID0gaTkxNV9kcm1fcmVzdW1lX2Vhcmx5KCZpOTE1LT5k
cm0pOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXR1cm4gaTkxNV9kcm1fcmVzdW1l
KGRldik7CisJcmV0dXJuIGk5MTVfZHJtX3Jlc3VtZSgmaTkxNS0+ZHJtKTsKIH0KIAogc3RhdGlj
IGludCBpOTE1X3BtX3ByZXBhcmUoc3RydWN0IGRldmljZSAqa2RldikKIHsKLQlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gZGV2X2dldF9kcnZkYXRhKGtkZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0ga2Rldl90b19pOTE1KGtkZXYpOwogCi0JaWYgKCFkZXYpIHsKKwlpZiAo
IWk5MTUpIHsKIAkJZGV2X2VycihrZGV2LCAiRFJNIG5vdCBpbml0aWFsaXplZCwgYWJvcnRpbmcg
c3VzcGVuZC5cbiIpOwogCQlyZXR1cm4gLUVOT0RFVjsKIAl9CiAKLQlpZiAoZGV2LT5zd2l0Y2hf
cG93ZXJfc3RhdGUgPT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpCisJaWYgKGk5MTUtPmRybS5zd2l0
Y2hfcG93ZXJfc3RhdGUgPT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpCiAJCXJldHVybiAwOwogCi0J
cmV0dXJuIGk5MTVfZHJtX3ByZXBhcmUoZGV2KTsKKwlyZXR1cm4gaTkxNV9kcm1fcHJlcGFyZSgm
aTkxNS0+ZHJtKTsKIH0KIAogc3RhdGljIGludCBpOTE1X3BtX3N1c3BlbmQoc3RydWN0IGRldmlj
ZSAqa2RldikKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gZGV2X2dldF9kcnZkYXRhKGtk
ZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl90b19pOTE1KGtkZXYp
OwogCi0JaWYgKCFkZXYpIHsKKwlpZiAoIWk5MTUpIHsKIAkJZGV2X2VycihrZGV2LCAiRFJNIG5v
dCBpbml0aWFsaXplZCwgYWJvcnRpbmcgc3VzcGVuZC5cbiIpOwogCQlyZXR1cm4gLUVOT0RFVjsK
IAl9CiAKLQlpZiAoZGV2LT5zd2l0Y2hfcG93ZXJfc3RhdGUgPT0gRFJNX1NXSVRDSF9QT1dFUl9P
RkYpCisJaWYgKGk5MTUtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUgPT0gRFJNX1NXSVRDSF9QT1dF
Ul9PRkYpCiAJCXJldHVybiAwOwogCi0JcmV0dXJuIGk5MTVfZHJtX3N1c3BlbmQoZGV2KTsKKwly
ZXR1cm4gaTkxNV9kcm1fc3VzcGVuZCgmaTkxNS0+ZHJtKTsKIH0KIAogc3RhdGljIGludCBpOTE1
X3BtX3N1c3BlbmRfbGF0ZShzdHJ1Y3QgZGV2aWNlICprZGV2KQogewotCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSAma2Rldl90b19pOTE1KGtkZXYpLT5kcm07CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBrZGV2X3RvX2k5MTUoa2Rldik7CiAKIAkvKgogCSAqIFdlIGhhdmUgYSBz
dXNwZW5kIG9yZGVyaW5nIGlzc3VlIHdpdGggdGhlIHNuZC1oZGEgZHJpdmVyIGFsc28KQEAgLTI0
NDEsNTUgKzI0NDIsNTUgQEAgc3RhdGljIGludCBpOTE1X3BtX3N1c3BlbmRfbGF0ZShzdHJ1Y3Qg
ZGV2aWNlICprZGV2KQogCSAqIEZJWE1FOiBUaGlzIHNob3VsZCBiZSBzb2x2ZWQgd2l0aCBhIHNw
ZWNpYWwgaGRtaSBzaW5rIGRldmljZSBvcgogCSAqIHNpbWlsYXIgc28gdGhhdCBwb3dlciBkb21h
aW5zIGNhbiBiZSBlbXBsb3llZC4KIAkgKi8KLQlpZiAoZGV2LT5zd2l0Y2hfcG93ZXJfc3RhdGUg
PT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpCisJaWYgKGk5MTUtPmRybS5zd2l0Y2hfcG93ZXJfc3Rh
dGUgPT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpCiAJCXJldHVybiAwOwogCi0JcmV0dXJuIGk5MTVf
ZHJtX3N1c3BlbmRfbGF0ZShkZXYsIGZhbHNlKTsKKwlyZXR1cm4gaTkxNV9kcm1fc3VzcGVuZF9s
YXRlKCZpOTE1LT5kcm0sIGZhbHNlKTsKIH0KIAogc3RhdGljIGludCBpOTE1X3BtX3Bvd2Vyb2Zm
X2xhdGUoc3RydWN0IGRldmljZSAqa2RldikKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0g
JmtkZXZfdG9faTkxNShrZGV2KS0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0ga2Rldl90b19pOTE1KGtkZXYpOwogCi0JaWYgKGRldi0+c3dpdGNoX3Bvd2VyX3N0YXRlID09
IERSTV9TV0lUQ0hfUE9XRVJfT0ZGKQorCWlmIChpOTE1LT5kcm0uc3dpdGNoX3Bvd2VyX3N0YXRl
ID09IERSTV9TV0lUQ0hfUE9XRVJfT0ZGKQogCQlyZXR1cm4gMDsKIAotCXJldHVybiBpOTE1X2Ry
bV9zdXNwZW5kX2xhdGUoZGV2LCB0cnVlKTsKKwlyZXR1cm4gaTkxNV9kcm1fc3VzcGVuZF9sYXRl
KCZpOTE1LT5kcm0sIHRydWUpOwogfQogCiBzdGF0aWMgaW50IGk5MTVfcG1fcmVzdW1lX2Vhcmx5
KHN0cnVjdCBkZXZpY2UgKmtkZXYpCiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZrZGV2
X3RvX2k5MTUoa2RldiktPmRybTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtk
ZXZfdG9faTkxNShrZGV2KTsKIAotCWlmIChkZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSA9PSBEUk1f
U1dJVENIX1BPV0VSX09GRikKKwlpZiAoaTkxNS0+ZHJtLnN3aXRjaF9wb3dlcl9zdGF0ZSA9PSBE
Uk1fU1dJVENIX1BPV0VSX09GRikKIAkJcmV0dXJuIDA7CiAKLQlyZXR1cm4gaTkxNV9kcm1fcmVz
dW1lX2Vhcmx5KGRldik7CisJcmV0dXJuIGk5MTVfZHJtX3Jlc3VtZV9lYXJseSgmaTkxNS0+ZHJt
KTsKIH0KIAogc3RhdGljIGludCBpOTE1X3BtX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICprZGV2KQog
ewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAma2Rldl90b19pOTE1KGtkZXYpLT5kcm07CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBrZGV2X3RvX2k5MTUoa2Rldik7CiAKLQlp
ZiAoZGV2LT5zd2l0Y2hfcG93ZXJfc3RhdGUgPT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpCisJaWYg
KGk5MTUtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUgPT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpCiAJ
CXJldHVybiAwOwogCi0JcmV0dXJuIGk5MTVfZHJtX3Jlc3VtZShkZXYpOworCXJldHVybiBpOTE1
X2RybV9yZXN1bWUoJmk5MTUtPmRybSk7CiB9CiAKIC8qIGZyZWV6ZTogYmVmb3JlIGNyZWF0aW5n
IHRoZSBoaWJlcm5hdGlvbl9pbWFnZSAqLwogc3RhdGljIGludCBpOTE1X3BtX2ZyZWV6ZShzdHJ1
Y3QgZGV2aWNlICprZGV2KQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAma2Rldl90b19p
OTE1KGtkZXYpLT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBrZGV2X3Rv
X2k5MTUoa2Rldik7CiAJaW50IHJldDsKIAotCWlmIChkZXYtPnN3aXRjaF9wb3dlcl9zdGF0ZSAh
PSBEUk1fU1dJVENIX1BPV0VSX09GRikgewotCQlyZXQgPSBpOTE1X2RybV9zdXNwZW5kKGRldik7
CisJaWYgKGk5MTUtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUgIT0gRFJNX1NXSVRDSF9QT1dFUl9P
RkYpIHsKKwkJcmV0ID0gaTkxNV9kcm1fc3VzcGVuZCgmaTkxNS0+ZHJtKTsKIAkJaWYgKHJldCkK
IAkJCXJldHVybiByZXQ7CiAJfQogCi0JcmV0ID0gaTkxNV9nZW1fZnJlZXplKGtkZXZfdG9faTkx
NShrZGV2KSk7CisJcmV0ID0gaTkxNV9nZW1fZnJlZXplKGk5MTUpOwogCWlmIChyZXQpCiAJCXJl
dHVybiByZXQ7CiAKQEAgLTI0OTgsMTYgKzI0OTksMTYgQEAgc3RhdGljIGludCBpOTE1X3BtX2Zy
ZWV6ZShzdHJ1Y3QgZGV2aWNlICprZGV2KQogCiBzdGF0aWMgaW50IGk5MTVfcG1fZnJlZXplX2xh
dGUoc3RydWN0IGRldmljZSAqa2RldikKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmtk
ZXZfdG9faTkxNShrZGV2KS0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
a2Rldl90b19pOTE1KGtkZXYpOwogCWludCByZXQ7CiAKLQlpZiAoZGV2LT5zd2l0Y2hfcG93ZXJf
c3RhdGUgIT0gRFJNX1NXSVRDSF9QT1dFUl9PRkYpIHsKLQkJcmV0ID0gaTkxNV9kcm1fc3VzcGVu
ZF9sYXRlKGRldiwgdHJ1ZSk7CisJaWYgKGk5MTUtPmRybS5zd2l0Y2hfcG93ZXJfc3RhdGUgIT0g
RFJNX1NXSVRDSF9QT1dFUl9PRkYpIHsKKwkJcmV0ID0gaTkxNV9kcm1fc3VzcGVuZF9sYXRlKCZp
OTE1LT5kcm0sIHRydWUpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAl9CiAKLQlyZXQg
PSBpOTE1X2dlbV9mcmVlemVfbGF0ZShrZGV2X3RvX2k5MTUoa2RldikpOworCXJldCA9IGk5MTVf
Z2VtX2ZyZWV6ZV9sYXRlKGk5MTUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTI5
MDksOCArMjkxMCw3IEBAIHN0YXRpYyBpbnQgdmx2X3Jlc3VtZV9wcmVwYXJlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogc3RhdGljIGludCBpbnRlbF9ydW50aW1lX3N1c3Bl
bmQoc3RydWN0IGRldmljZSAqa2RldikKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gZGV2
X2dldF9kcnZkYXRhKGtkZXYpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBrZGV2
X3RvX2k5MTUoa2Rldik7CiAJc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSA9ICZkZXZfcHJp
di0+cnVudGltZV9wbTsKIAlpbnQgcmV0OwogCkBAIC0zMDA2LDggKzMwMDYsNyBAQCBzdGF0aWMg
aW50IGludGVsX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICprZGV2KQogCiBzdGF0aWMg
aW50IGludGVsX3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBkZXZpY2UgKmtkZXYpCiB7Ci0Jc3RydWN0
IGRybV9kZXZpY2UgKmRldiA9IGRldl9nZXRfZHJ2ZGF0YShrZGV2KTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0ga2Rldl90b19pOTE1KGtkZXYpOwogCXN0cnVjdCBpbnRlbF9ydW50
aW1lX3BtICpycG0gPSAmZGV2X3ByaXYtPnJ1bnRpbWVfcG07CiAJaW50IHJldCA9IDA7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGEzYmI1M2VkZTllNi4uZDFhNDAwZjY1NDMyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE4OTgsNyArMTg5OCwxMiBAQCBzdGF0aWMgaW5saW5l
IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICp0b19pOTE1KGNvbnN0IHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYpCiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmtkZXZfdG9f
aTkxNShzdHJ1Y3QgZGV2aWNlICprZGV2KQogewotCXJldHVybiB0b19pOTE1KGRldl9nZXRfZHJ2
ZGF0YShrZGV2KSk7CisJcmV0dXJuIGRldl9nZXRfZHJ2ZGF0YShrZGV2KTsKK30KKworc3RhdGlj
IGlubGluZSBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqcGRldl90b19pOTE1KHN0cnVjdCBwY2lf
ZGV2ICpwZGV2KQoreworCXJldHVybiBwY2lfZ2V0X2RydmRhdGEocGRldik7CiB9CiAKIHN0YXRp
YyBpbmxpbmUgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKndvcGNtX3RvX2k5MTUoc3RydWN0IGlu
dGVsX3dvcGNtICp3b3BjbSkKQEAgLTIzODUsNyArMjM5MCw3IEBAIGxvbmcgaTkxNV9jb21wYXRf
aW9jdGwoc3RydWN0IGZpbGUgKmZpbHAsIHVuc2lnbmVkIGludCBjbWQsIHVuc2lnbmVkIGxvbmcg
YXJnKTsKIGV4dGVybiBjb25zdCBzdHJ1Y3QgZGV2X3BtX29wcyBpOTE1X3BtX29wczsKIAogaW50
IGk5MTVfZHJpdmVyX3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1Y3QgcGNp
X2RldmljZV9pZCAqZW50KTsKLXZvaWQgaTkxNV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYpOwordm9pZCBpOTE1X2RyaXZlcl9yZW1vdmUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwogCiB2b2lkIGludGVsX2VuZ2luZV9pbml0X2hhbmdjaGVjayhzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpOwogaW50IHZsdl9mb3JjZV9nZnhfY2xvY2soc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIG9uKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5j
CmluZGV4IDIwZTU2MmNlZDhjYy4uMWZlYmRhMmE5MGU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BjaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNp
LmMKQEAgLTg3NCwxNiArODc0LDE2IEBAIE1PRFVMRV9ERVZJQ0VfVEFCTEUocGNpLCBwY2lpZGxp
c3QpOwogCiBzdGF0aWMgdm9pZCBpOTE1X3BjaV9yZW1vdmUoc3RydWN0IHBjaV9kZXYgKnBkZXYp
CiB7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNTsKIAotCWRldiA9IHBjaV9nZXRfZHJ2ZGF0YShwZGV2KTsKLQlpZiAoIWRldikgLyogZHJp
dmVyIGxvYWQgYWJvcnRlZCwgbm90aGluZyB0byBjbGVhbnVwICovCisJaTkxNSA9IHBjaV9nZXRf
ZHJ2ZGF0YShwZGV2KTsKKwlpZiAoIWk5MTUpIC8qIGRyaXZlciBsb2FkIGFib3J0ZWQsIG5vdGhp
bmcgdG8gY2xlYW51cCAqLwogCQlyZXR1cm47CiAKLQlpOTE1X2RyaXZlcl9yZW1vdmUoZGV2KTsK
LQlkcm1fZGV2X3B1dChkZXYpOwotCisJaTkxNV9kcml2ZXJfcmVtb3ZlKGk5MTUpOwogCXBjaV9z
ZXRfZHJ2ZGF0YShwZGV2LCBOVUxMKTsKKworCWRybV9kZXZfcHV0KCZpOTE1LT5kcm0pOwogfQog
CiAvKiBpcyBkZXZpY2VfaWQgcHJlc2VudCBpbiBjb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBpZHMg
Ki8KQEAgLTk1OSw3ICs5NTksNyBAQCBzdGF0aWMgaW50IGk5MTVfcGNpX3Byb2JlKHN0cnVjdCBw
Y2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1Y3QgcGNpX2RldmljZV9pZCAqZW50KQogCWlmIChlcnIp
CiAJCXJldHVybiBlcnI7CiAKLQlpZiAoaTkxNV9pbmplY3RfcHJvYmVfZmFpbHVyZSh0b19pOTE1
KHBjaV9nZXRfZHJ2ZGF0YShwZGV2KSkpKSB7CisJaWYgKGk5MTVfaW5qZWN0X3Byb2JlX2ZhaWx1
cmUocGNpX2dldF9kcnZkYXRhKHBkZXYpKSkgewogCQlpOTE1X3BjaV9yZW1vdmUocGRldik7CiAJ
CXJldHVybiAtRU5PREVWOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9zZWxmdGVzdC5jCmluZGV4IGRiOWM2NDViYmRmZS4uNDM4ZWEwZWFhNDE2IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMKQEAgLTE4NSw3
ICsxODUsNyBAQCBpbnQgaTkxNV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikK
IAlpZiAoIWk5MTVfc2VsZnRlc3QubGl2ZSkKIAkJcmV0dXJuIDA7CiAKLQllcnIgPSBydW5fc2Vs
ZnRlc3RzKGxpdmUsIHRvX2k5MTUocGNpX2dldF9kcnZkYXRhKHBkZXYpKSk7CisJZXJyID0gcnVu
X3NlbGZ0ZXN0cyhsaXZlLCBwZGV2X3RvX2k5MTUocGRldikpOwogCWlmIChlcnIpIHsKIAkJaTkx
NV9zZWxmdGVzdC5saXZlID0gZXJyOwogCQlyZXR1cm4gZXJyOwotLSAKMi4yMy4wLnJjMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

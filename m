Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B1F782FF666
	for <lists+intel-gfx@lfdr.de>; Thu, 21 Jan 2021 21:53:28 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 026FF6E957;
	Thu, 21 Jan 2021 20:53:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BC4D56E957
 for <intel-gfx@lists.freedesktop.org>; Thu, 21 Jan 2021 20:53:25 +0000 (UTC)
IronPort-SDR: XxrCosai1h3Zz8CfAoKAp3LTqbSW9fxG1z0opa/SocO3JVtH2mYCsE3UiIBCOmHIKV7FWUmsq1
 oP+R9Nkfk7RA==
X-IronPort-AV: E=McAfee;i="6000,8403,9871"; a="243418060"
X-IronPort-AV: E=Sophos;i="5.79,365,1602572400"; d="scan'208";a="243418060"
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by orsmga105.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 21 Jan 2021 12:53:21 -0800
IronPort-SDR: DawreQn7cI7yAxWhiS1pRVzwpt5TpSkAzf7h6KpQ8MAVxHKD1wC4xsVveZOVA8tbweHClsw0Fw
 +CJf13+hfZbQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.79,365,1602572400"; d="scan'208";a="356655550"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga008.fm.intel.com with SMTP; 21 Jan 2021 12:53:18 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 21 Jan 2021 22:53:17 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 21 Jan 2021 22:52:59 +0200
Message-Id: <20210121205302.24897-6-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20210121205302.24897-1-ville.syrjala@linux.intel.com>
References: <20210121205302.24897-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 5/8] drm/i915: Move pipe ddb entries into the
 dbuf state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClRo
ZSBkYnVmIHN0YXRlIHdpbGwgYmUgd2hlcmUgd2UgY29sbGVjdCBhbGwgdGhlIGludGVyLXBpcGUg
ZGJ1ZgphbGxvY2F0aW9uIHN0dWZmLiBTdGFydCBieSBtb3ZpbmcgdGhlIGFjdHVhbCBwZXItcGlw
ZSBkZGIgZW50cmllcwp0aGVyZS4KCnYyOiBSZWJhc2UKClJldmlld2VkLWJ5OiBTdGFuaXNsYXYg
TGlzb3Zza2l5IDxzdGFuaXNsYXYubGlzb3Zza2l5QGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTog
VmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAyMSArKysrKysrKysr
KystLS0tLS0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAg
fCAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jICAgICAgICAgICAgICAgfCAx
NCArKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oICAgICAgICAg
ICAgICAgfCAgNCArKysrCiA0IGZpbGVzIGNoYW5nZWQsIDIxIGluc2VydGlvbnMoKyksIDE5IGRl
bGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMKaW5kZXggYjczYmJlMjM4M2QwLi4xZTQwMDY1MzVkMzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xMjkyNSw2ICsxMjkyNSwxMCBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogc3RhdGljIHZvaWQgc2tsX2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCWNvbnN0IHN0cnVj
dCBpbnRlbF9kYnVmX3N0YXRlICpvbGRfZGJ1Zl9zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRf
b2xkX2RidWZfc3RhdGUoc3RhdGUpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9kYnVmX3N0YXRlICpu
ZXdfZGJ1Zl9zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfbmV3X2RidWZfc3RhdGUoc3RhdGUp
OwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpv
bGRfY3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRlOwogCXN0cnVjdCBza2xfZGRiX2VudHJ5IGVu
dHJpZXNbSTkxNV9NQVhfUElQRVNdID0ge307CkBAIC0xMjkzOSw3ICsxMjk0Myw3IEBAIHN0YXRp
YyB2b2lkIHNrbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCiAJCS8qIGlnbm9yZSBhbGxvY2F0aW9ucyBmb3IgY3J0YydzIHRoYXQgaGF2
ZSBiZWVuIHR1cm5lZCBvZmYuICovCiAJCWlmICghaW50ZWxfY3J0Y19uZWVkc19tb2Rlc2V0KG5l
d19jcnRjX3N0YXRlKSkgewotCQkJZW50cmllc1twaXBlXSA9IG9sZF9jcnRjX3N0YXRlLT53bS5z
a2wuZGRiOworCQkJZW50cmllc1twaXBlXSA9IG9sZF9kYnVmX3N0YXRlLT5kZGJbcGlwZV07CiAJ
CQl1cGRhdGVfcGlwZXMgfD0gQklUKHBpcGUpOwogCQl9IGVsc2UgewogCQkJbW9kZXNldF9waXBl
cyB8PSBCSVQocGlwZSk7CkBAIC0xMjk2MywxMSArMTI5NjcsMTEgQEAgc3RhdGljIHZvaWQgc2ts
X2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUp
CiAJCQlpZiAoKHVwZGF0ZV9waXBlcyAmIEJJVChwaXBlKSkgPT0gMCkKIAkJCQljb250aW51ZTsK
IAotCQkJaWYgKHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcygmbmV3X2NydGNfc3RhdGUtPndt
LnNrbC5kZGIsCisJCQlpZiAoc2tsX2RkYl9hbGxvY2F0aW9uX292ZXJsYXBzKCZuZXdfZGJ1Zl9z
dGF0ZS0+ZGRiW3BpcGVdLAogCQkJCQkJCWVudHJpZXMsIEk5MTVfTUFYX1BJUEVTLCBwaXBlKSkK
IAkJCQljb250aW51ZTsKIAotCQkJZW50cmllc1twaXBlXSA9IG5ld19jcnRjX3N0YXRlLT53bS5z
a2wuZGRiOworCQkJZW50cmllc1twaXBlXSA9IG5ld19kYnVmX3N0YXRlLT5kZGJbcGlwZV07CiAJ
CQl1cGRhdGVfcGlwZXMgJj0gfkJJVChwaXBlKTsKIAogCQkJaW50ZWxfdXBkYXRlX2NydGMoc3Rh
dGUsIGNydGMpOwpAQCAtMTI5NzgsOCArMTI5ODIsOCBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0
X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJCSAq
IHRoZW4gd2UgbmVlZCB0byB3YWl0IGZvciBhIHZibGFuayB0byBwYXNzIGZvciB0aGUKIAkJCSAq
IG5ldyBkZGIgYWxsb2NhdGlvbiB0byB0YWtlIGVmZmVjdC4KIAkJCSAqLwotCQkJaWYgKCFza2xf
ZGRiX2VudHJ5X2VxdWFsKCZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYiwKLQkJCQkJCSAmb2xk
X2NydGNfc3RhdGUtPndtLnNrbC5kZGIpICYmCisJCQlpZiAoIXNrbF9kZGJfZW50cnlfZXF1YWwo
Jm5ld19kYnVmX3N0YXRlLT5kZGJbcGlwZV0sCisJCQkJCQkgJm9sZF9kYnVmX3N0YXRlLT5kZGJb
cGlwZV0pICYmCiAJCQkgICAgKHVwZGF0ZV9waXBlcyB8IG1vZGVzZXRfcGlwZXMpKQogCQkJCWlu
dGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgcGlwZSk7CiAJCX0KQEAgLTEzMDMxLDEwICsx
MzAzNSwxMSBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJaWYgKCh1cGRhdGVfcGlwZXMgJiBCSVQocGlw
ZSkpID09IDApCiAJCQljb250aW51ZTsKIAotCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwg
c2tsX2RkYl9hbGxvY2F0aW9uX292ZXJsYXBzKCZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYiwK
LQkJCQkJCQkJCWVudHJpZXMsIEk5MTVfTUFYX1BJUEVTLCBwaXBlKSk7CisJCWRybV9XQVJOX09O
KCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgIHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcygmbmV3
X2RidWZfc3RhdGUtPmRkYltwaXBlXSwKKwkJCQkJCQllbnRyaWVzLCBJOTE1X01BWF9QSVBFUywg
cGlwZSkpOwogCi0JCWVudHJpZXNbcGlwZV0gPSBuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsK
KwkJZW50cmllc1twaXBlXSA9IG5ld19kYnVmX3N0YXRlLT5kZGJbcGlwZV07CiAJCXVwZGF0ZV9w
aXBlcyAmPSB+QklUKHBpcGUpOwogCiAJCWludGVsX3VwZGF0ZV9jcnRjKHN0YXRlLCBjcnRjKTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90
eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVz
LmgKaW5kZXggMWE5MjQzNDI2YTI1Li5kY2UzMmNmNDM2ZmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC03OTYsNyArNzk2
LDYgQEAgc3RydWN0IGludGVsX2NydGNfd21fc3RhdGUgewogCQkJc3RydWN0IHNrbF9waXBlX3dt
IHJhdzsKIAkJCS8qIGdlbjkrIG9ubHkgbmVlZHMgMS1zdGVwIHdtIHByb2dyYW1taW5nICovCiAJ
CQlzdHJ1Y3Qgc2tsX3BpcGVfd20gb3B0aW1hbDsKLQkJCXN0cnVjdCBza2xfZGRiX2VudHJ5IGRk
YjsKIAkJCXN0cnVjdCBza2xfZGRiX2VudHJ5IHBsYW5lX2RkYl95W0k5MTVfTUFYX1BMQU5FU107
CiAJCQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBwbGFuZV9kZGJfdXZbSTkxNV9NQVhfUExBTkVTXTsK
IAkJfSBza2w7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCA0ZWIyZDM2ZWQxMDguLjU1NWQ4
ZjA1OGYxZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC00MTQ2LDE2ICs0MTQ2LDggQEAg
c2tsX2RkYl9nZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJICogZ3JhYiBfYWxsXyBjcnRjIGxvY2tzLCBpbmNsdWRpbmcgdGhlIG9u
ZSB3ZSBjdXJyZW50bHkgaG9sZC4KIAkgKi8KIAlpZiAob2xkX2RidWZfc3RhdGUtPmFjdGl2ZV9w
aXBlcyA9PSBuZXdfZGJ1Zl9zdGF0ZS0+YWN0aXZlX3BpcGVzICYmCi0JICAgICFkZXZfcHJpdi0+
d20uZGlzdHJ1c3RfYmlvc193bSkgewotCQkvKgotCQkgKiBhbGxvYyBtYXkgYmUgY2xlYXJlZCBi
eSBjbGVhcl9pbnRlbF9jcnRjX3N0YXRlLAotCQkgKiBjb3B5IGZyb20gb2xkIHN0YXRlIHRvIGJl
IHN1cmUKLQkJICoKLQkJICogRklYTUUgZ2V0IHJpZCBvZiB0aGlzIG1lc3MKLQkJICovCi0JCSph
bGxvYyA9IHRvX2ludGVsX2NydGNfc3RhdGUoZm9yX2NydGMtPmJhc2Uuc3RhdGUpLT53bS5za2wu
ZGRiOworCSAgICAhZGV2X3ByaXYtPndtLmRpc3RydXN0X2Jpb3Nfd20pCiAJCXJldHVybiAwOwot
CX0KIAogCS8qCiAJICogR2V0IGFsbG93ZWQgREJ1ZiBzbGljZXMgZm9yIGNvcnJlc3BvbmRlbnQg
cGlwZSBhbmQgcGxhdGZvcm0uCkBAIC00Nzk4LDcgKzQ3OTAsOSBAQCBza2xfYWxsb2NhdGVfcGlw
ZV9kZGIoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRl
KHN0YXRlLCBjcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGMtPmJhc2UuZGV2KTsKLQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqYWxsb2MgPSAmY3J0
Y19zdGF0ZS0+d20uc2tsLmRkYjsKKwlzdHJ1Y3QgaW50ZWxfZGJ1Zl9zdGF0ZSAqZGJ1Zl9zdGF0
ZSA9CisJCWludGVsX2F0b21pY19nZXRfbmV3X2RidWZfc3RhdGUoc3RhdGUpOworCXN0cnVjdCBz
a2xfZGRiX2VudHJ5ICphbGxvYyA9ICZkYnVmX3N0YXRlLT5kZGJbY3J0Yy0+cGlwZV07CiAJdTE2
IGFsbG9jX3NpemUsIHN0YXJ0ID0gMDsKIAl1MTYgdG90YWxbSTkxNV9NQVhfUExBTkVTXSA9IHt9
OwogCXUxNiB1dl90b3RhbFtJOTE1X01BWF9QTEFORVNdID0ge307CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
cG0uaAppbmRleCAwMDkxMGJjMDE0MDcuLjcyNDIwNGJiODQ0MiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9wbS5oCkBAIC05LDggKzksMTAgQEAKICNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiAjaW5j
bHVkZSAiZGlzcGxheS9pbnRlbF9idy5oIgorI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxh
eS5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZ2xvYmFsX3N0YXRlLmgiCiAKKyNpbmNsdWRl
ICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5MTVfcmVnLmgiCiAKIHN0cnVjdCBkcm1fZGV2aWNl
OwpAQCAtNjgsNiArNzAsOCBAQCBib29sIGludGVsX3NldF9tZW1vcnlfY3hzcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgZW5hYmxlKTsKIHN0cnVjdCBpbnRlbF9kYnVm
X3N0YXRlIHsKIAlzdHJ1Y3QgaW50ZWxfZ2xvYmFsX3N0YXRlIGJhc2U7CiAKKwlzdHJ1Y3Qgc2ts
X2RkYl9lbnRyeSBkZGJbSTkxNV9NQVhfUElQRVNdOworCiAJdTggZW5hYmxlZF9zbGljZXM7CiAJ
dTggYWN0aXZlX3BpcGVzOwogfTsKLS0gCjIuMjYuMgoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1B7D03C9B48
	for <lists+intel-gfx@lfdr.de>; Thu, 15 Jul 2021 11:18:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 37DBB6E5CF;
	Thu, 15 Jul 2021 09:18:42 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5C3AD6E7D3;
 Thu, 15 Jul 2021 09:18:40 +0000 (UTC)
X-IronPort-AV: E=McAfee;i="6200,9189,10045"; a="232333025"
X-IronPort-AV: E=Sophos;i="5.84,240,1620716400"; d="scan'208";a="232333025"
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by fmsmga101.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 15 Jul 2021 02:18:40 -0700
X-IronPort-AV: E=Sophos;i="5.84,240,1620716400"; d="scan'208";a="572767990"
Received: from shyland-mobl2.ger.corp.intel.com (HELO tursulin-mobl2.home)
 ([10.213.241.81])
 by fmsmga001-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 15 Jul 2021 02:18:38 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Thu, 15 Jul 2021 10:18:19 +0100
Message-Id: <20210715091820.1613726-8-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.30.2
In-Reply-To: <20210715091820.1613726-1-tvrtko.ursulin@linux.intel.com>
References: <20210715091820.1613726-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 7/8] drm/i915: Expose client engine utilisation
 via fdinfo
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: David M Nieto <David.Nieto@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KClNpbWlsYXIg
dG8gQU1EIGNvbW1pdAo4NzQ0NDI1NDExMzMgKCJkcm0vYW1kZ3B1OiBBZGQgc2hvd19mZGluZm8o
KSBpbnRlcmZhY2UiKSwgdXNpbmcgdGhlCmluZnJhc3RydWN0dXJlIGFkZGVkIGluIHByZXZpb3Vz
IHBhdGNoZXMsIHdlIGFkZCBiYXNpYyBjbGllbnQgaW5mbwphbmQgR1BVIGVuZ2luZSB1dGlsaXNh
dGlvbiBmb3IgaTkxNS4KCkV4YW1wbGUgb2YgdGhlIG91dHB1dDoKCiAgcG9zOiAgICAwCiAgZmxh
Z3M6ICAwMTAwMDAyCiAgbW50X2lkOiAyMQogIGRybS1kcml2ZXI6IGk5MTUKICBkcm0tcGRldjog
ICAwMDAwOjAwOjAyLjAKICBkcm0tY2xpZW50LWlkOiAgICAgIDcKICBkcm0tZW5naW5lLXJlbmRl
cjogIDkyODg4NjQ3MjMgbnMKICBkcm0tZW5naW5lLWNvcHk6ICAgIDIwMzUwNzExMDggbnMKICBk
cm0tZW5naW5lLXZpZGVvOiAgIDAgbnMKICBkcm0tZW5naW5lLXZpZGVvLWVuaGFuY2U6ICAgMCBu
cwoKdjI6CiAqIFVwZGF0ZSBmb3IgcmVtb3ZhbCBvZiBuYW1lIGFuZCBwaWQuCgpTaWduZWQtb2Zm
LWJ5OiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpDYzogRGF2aWQg
TSBOaWV0byA8RGF2aWQuTmlldG9AYW1kLmNvbT4KQ2M6IENocmlzdGlhbiBLw7ZuaWcgPGNocmlz
dGlhbi5rb2VuaWdAYW1kLmNvbT4KQ2M6IERhbmllbCBWZXR0ZXIgPGRhbmllbEBmZndsbC5jaD4K
LS0tCiBEb2N1bWVudGF0aW9uL2dwdS9kcm0tdXNhZ2Utc3RhdHMucnN0ICB8ICA2ICsrKwogRG9j
dW1lbnRhdGlvbi9ncHUvaTkxNS5yc3QgICAgICAgICAgICAgfCAyNyArKysrKysrKysrCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RybV9jbGllbnQuYyB8IDczICsrKysrKysrKysrKysrKysr
KysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RybV9jbGllbnQuaCB8ICA0ICsr
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAgICB8ICAzICsrCiA1IGZpbGVz
IGNoYW5nZWQsIDExMyBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi9n
cHUvZHJtLXVzYWdlLXN0YXRzLnJzdCBiL0RvY3VtZW50YXRpb24vZ3B1L2RybS11c2FnZS1zdGF0
cy5yc3QKaW5kZXggNzhkYzAxYzMwZTIyLi5iODc1MDU0MzhhYWEgMTAwNjQ0Ci0tLSBhL0RvY3Vt
ZW50YXRpb24vZ3B1L2RybS11c2FnZS1zdGF0cy5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi9ncHUv
ZHJtLXVzYWdlLXN0YXRzLnJzdApAQCAtOTUsMyArOTUsOSBAQCBvYmplY3QgYmVsb25nIHRvIHRo
aXMgY2xpZW50LCBpbiB0aGUgcmVzcGVjdGl2ZSBtZW1vcnkgcmVnaW9uLgogCiBEZWZhdWx0IHVu
aXQgc2hhbGwgYmUgYnl0ZXMgd2l0aCBvcHRpb25hbCB1bml0IHNwZWNpZmllcnMgb2YgJ0tpQicg
b3IgJ01pQicKIGluZGljYXRpbmcga2liaS0gb3IgbWViaS1ieXRlcy4KKworPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQorRHJpdmVyIHNwZWNpZmljIGltcGxlbWVudGF0aW9ucworPT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PQorCis6cmVmOmBpOTE1LXVzYWdlLXN0YXRzYApk
aWZmIC0tZ2l0IGEvRG9jdW1lbnRhdGlvbi9ncHUvaTkxNS5yc3QgYi9Eb2N1bWVudGF0aW9uL2dw
dS9pOTE1LnJzdAppbmRleCAyMDRlYmRhYWRiNDUuLmIyOGNjMzE2ZGJkOSAxMDA2NDQKLS0tIGEv
RG9jdW1lbnRhdGlvbi9ncHUvaTkxNS5yc3QKKysrIGIvRG9jdW1lbnRhdGlvbi9ncHUvaTkxNS5y
c3QKQEAgLTcwMSwzICs3MDEsMzAgQEAgVGhlIHN0eWxlIGd1aWRlIGZvciBgYGk5MTVfcmVnLmhg
YC4KIAogLi4ga2VybmVsLWRvYzo6IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKICAg
IDpkb2M6IFRoZSBpOTE1IHJlZ2lzdGVyIG1hY3JvIGRlZmluaXRpb24gc3R5bGUgZ3VpZGUKKwor
Li4gX2k5MTUtdXNhZ2Utc3RhdHM6CisKK2k5MTUgRFJNIGNsaWVudCB1c2FnZSBzdGF0cyBpbXBs
ZW1lbnRhdGlvbgorPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CisK
K1RoZSBkcm0vaTkxNSBkcml2ZXIgaW1wbGVtZW50cyB0aGUgRFJNIGNsaWVudCB1c2FnZSBzdGF0
cyBzcGVjaWZpY2F0aW9uIGFzCitkb2N1bWVudGVkIGluIDpyZWY6YGRybS1jbGllbnQtdXNhZ2Ut
c3RhdHNgLgorCitFeGFtcGxlIG9mIHRoZSBvdXRwdXQgc2hvd2luZyB0aGUgaW1wbGVtZW50ZWQg
a2V5IHZhbHVlIHBhaXJzIGFuZCBlbnRpcmV0eSBvZgordGhlIGN1cnJlbmx5IHBvc3NpYmxlIGZv
cm1hdCBvcHRpb25zOgorCis6OgorCisgICAgICBwb3M6ICAgIDAKKyAgICAgIGZsYWdzOiAgMDEw
MDAwMgorICAgICAgbW50X2lkOiAyMQorICAgICAgZHJtLWRyaXZlcjogaTkxNQorICAgICAgZHJt
LXBkZXY6ICAgMDAwMDowMDowMi4wCisgICAgICBkcm0tY2xpZW50LWlkOiAgICAgIDcKKyAgICAg
IGRybS1lbmdpbmUtcmVuZGVyOiAgOTI4ODg2NDcyMyBucworICAgICAgZHJtLWVuZ2luZS1jb3B5
OiAgICAyMDM1MDcxMTA4IG5zCisgICAgICBkcm0tZW5naW5lLXZpZGVvOiAgIDAgbnMKKyAgICAg
IGRybS1lbmdpbmUtdmlkZW8tZW5oYW5jZTogICAwIG5zCisKK1Bvc3NpYmxlIGBkcm0tZW5naW5l
LWAga2V5IG5hbWVzIGFyZTogYHJlbmRlcmAsIGBjb3B5YCwgYHZpZGVvYCBhbmQKK2B2aWRlby1l
bmhhbmNlYC4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJtX2NsaWVu
dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcm1fY2xpZW50LmMKaW5kZXggOTFhODU1
OWJlYmY3Li44YTY3MDZlMDZlMzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJtX2NsaWVudC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJtX2NsaWVu
dC5jCkBAIC03LDYgKzcsMTEgQEAKICNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CiAjaW5jbHVkZSA8
bGludXgvdHlwZXMuaD4KIAorI2luY2x1ZGUgPHVhcGkvZHJtL2k5MTVfZHJtLmg+CisKKyNpbmNs
dWRlIDxkcm0vZHJtX3ByaW50Lmg+CisKKyNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5o
IgogI2luY2x1ZGUgImk5MTVfZHJtX2NsaWVudC5oIgogI2luY2x1ZGUgImk5MTVfZ2VtLmgiCiAj
aW5jbHVkZSAiaTkxNV91dGlscy5oIgpAQCAtNjgsMyArNzMsNzEgQEAgdm9pZCBpOTE1X2RybV9j
bGllbnRzX2Zpbmkoc3RydWN0IGk5MTVfZHJtX2NsaWVudHMgKmNsaWVudHMpCiAJR0VNX0JVR19P
TigheGFfZW1wdHkoJmNsaWVudHMtPnhhcnJheSkpOwogCXhhX2Rlc3Ryb3koJmNsaWVudHMtPnhh
cnJheSk7CiB9CisKKyNpZmRlZiBDT05GSUdfUFJPQ19GUworc3RhdGljIGNvbnN0IGNoYXIgKiBj
b25zdCB1YWJpX2NsYXNzX25hbWVzW10gPSB7CisJW0k5MTVfRU5HSU5FX0NMQVNTX1JFTkRFUl0g
PSAicmVuZGVyIiwKKwlbSTkxNV9FTkdJTkVfQ0xBU1NfQ09QWV0gPSAiY29weSIsCisJW0k5MTVf
RU5HSU5FX0NMQVNTX1ZJREVPXSA9ICJ2aWRlbyIsCisJW0k5MTVfRU5HSU5FX0NMQVNTX1ZJREVP
X0VOSEFOQ0VdID0gInZpZGVvLWVuaGFuY2UiLAorfTsKKworc3RhdGljIHU2NCBidXN5X2FkZChz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCB1bnNpZ25lZCBpbnQgY2xhc3MpCit7CisJc3Ry
dWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7
CisJdTY0IHRvdGFsID0gMDsKKworCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIHJjdV9kZXJlZmVy
ZW5jZShjdHgtPmVuZ2luZXMpLCBpdCkgeworCQlpZiAoY2UtPmVuZ2luZS0+dWFiaV9jbGFzcyAh
PSBjbGFzcykKKwkJCWNvbnRpbnVlOworCisJCXRvdGFsICs9IGludGVsX2NvbnRleHRfZ2V0X3Rv
dGFsX3J1bnRpbWVfbnMoY2UpOworCX0KKworCXJldHVybiB0b3RhbDsKK30KKworc3RhdGljIHZv
aWQKK3Nob3dfY2xpZW50X2NsYXNzKHN0cnVjdCBzZXFfZmlsZSAqbSwKKwkJICBzdHJ1Y3QgaTkx
NV9kcm1fY2xpZW50ICpjbGllbnQsCisJCSAgdW5zaWduZWQgaW50IGNsYXNzKQoreworCWNvbnN0
IHN0cnVjdCBsaXN0X2hlYWQgKmxpc3QgPSAmY2xpZW50LT5jdHhfbGlzdDsKKwl1NjQgdG90YWwg
PSBhdG9taWM2NF9yZWFkKCZjbGllbnQtPnBhc3RfcnVudGltZVtjbGFzc10pOworCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJbGlzdF9mb3JfZWFj
aF9lbnRyeV9yY3UoY3R4LCBsaXN0LCBjbGllbnRfbGluaykKKwkJdG90YWwgKz0gYnVzeV9hZGQo
Y3R4LCBjbGFzcyk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwlyZXR1cm4gc2VxX3ByaW50Ziht
LCAiZHJtLWVuZ2luZS0lczpcdCVsbHUgbnNcbiIsCisJCQkgIHVhYmlfY2xhc3NfbmFtZXNbY2xh
c3NdLCB0b3RhbCk7Cit9CisKK3ZvaWQgaTkxNV9kcm1fY2xpZW50X2ZkaW5mbyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHN0cnVjdCBmaWxlICpmKQoreworCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSA9IGYt
PnByaXZhdGVfZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYg
PSBmaWxlLT5kcml2ZXJfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGZp
bGVfcHJpdi0+ZGV2X3ByaXY7CisJc3RydWN0IGk5MTVfZHJtX2NsaWVudCAqY2xpZW50ID0gZmls
ZV9wcml2LT5jbGllbnQ7CisJc3RydWN0IHBjaV9kZXYgKnBkZXYgPSB0b19wY2lfZGV2KGk5MTUt
PmRybS5kZXYpOworCXVuc2lnbmVkIGludCBpOworCisJLyoKKwkgKiAqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKKwkgKiBG
b3IgdGV4dCBvdXRwdXQgZm9ybWF0IGRlc2NyaXB0aW9uIHBsZWFzZSBzZWUgZHJtLXVzYWdlLXN0
YXRzLnJzdCEKKwkgKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq
KioqKioqKioqKioqKioqKioqKioqKioKKwkgKi8KKworCXNlcV9wdXRzKG0sICJkcm0tZHJpdmVy
Olx0aTkxNVxuIik7CisJc2VxX3ByaW50ZihtLCAiZHJtLXBkZXY6XHQlMDR4OiUwMng6JTAyeC4l
ZFxuIiwKKwkJICAgcGNpX2RvbWFpbl9ucihwZGV2LT5idXMpLCBwZGV2LT5idXMtPm51bWJlciwK
KwkJICAgUENJX1NMT1QocGRldi0+ZGV2Zm4pLCBQQ0lfRlVOQyhwZGV2LT5kZXZmbikpOworCXNl
cV9wcmludGYobSwgImRybS1jbGllbnQtaWQ6XHQldVxuIiwgY2xpZW50LT5pZCk7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgQVJSQVlfU0laRSh1YWJpX2NsYXNzX25hbWVzKTsgaSsrKQorCQlzaG93X2Ns
aWVudF9jbGFzcyhtLCBjbGllbnQsIGkpOworfQorI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RybV9jbGllbnQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJtX2NsaWVudC5oCmluZGV4IDc0MTZlMThhYTMzYy4uZDk2ZDZhMDYzMDJlIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RybV9jbGllbnQuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RybV9jbGllbnQuaApAQCAtNTcsNiArNTcsMTAgQEAgc3RhdGlj
IGlubGluZSB2b2lkIGk5MTVfZHJtX2NsaWVudF9wdXQoc3RydWN0IGk5MTVfZHJtX2NsaWVudCAq
Y2xpZW50KQogCiBzdHJ1Y3QgaTkxNV9kcm1fY2xpZW50ICppOTE1X2RybV9jbGllbnRfYWRkKHN0
cnVjdCBpOTE1X2RybV9jbGllbnRzICpjbGllbnRzKTsKIAorI2lmZGVmIENPTkZJR19QUk9DX0ZT
Cit2b2lkIGk5MTVfZHJtX2NsaWVudF9mZGluZm8oc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3Qg
ZmlsZSAqZik7CisjZW5kaWYKKwogdm9pZCBpOTE1X2RybV9jbGllbnRzX2Zpbmkoc3RydWN0IGk5
MTVfZHJtX2NsaWVudHMgKmNsaWVudHMpOwogCiAjZW5kaWYgLyogIV9fSTkxNV9EUk1fQ0xJRU5U
X0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggYmI2MjhlYWRlOTJhLi5iMjczNmIx
ZTVhMDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtMTcwNiw2ICsxNzA2LDkgQEAgc3Rh
dGljIGNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9kcml2ZXJfZm9wcyA9IHsKIAku
cmVhZCA9IGRybV9yZWFkLAogCS5jb21wYXRfaW9jdGwgPSBpOTE1X2lvYzMyX2NvbXBhdF9pb2N0
bCwKIAkubGxzZWVrID0gbm9vcF9sbHNlZWssCisjaWZkZWYgQ09ORklHX1BST0NfRlMKKwkuc2hv
d19mZGluZm8gPSBpOTE1X2RybV9jbGllbnRfZmRpbmZvLAorI2VuZGlmCiB9OwogCiBzdGF0aWMg
aW50Ci0tIAoyLjMwLjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeAo=

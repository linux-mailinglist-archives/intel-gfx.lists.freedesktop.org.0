Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 95F3AC4A65
	for <lists+intel-gfx@lfdr.de>; Wed,  2 Oct 2019 11:18:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D4E5C6E920;
	Wed,  2 Oct 2019 09:18:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7123F6E920;
 Wed,  2 Oct 2019 09:18:42 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 02 Oct 2019 02:18:42 -0700
X-IronPort-AV: E=Sophos;i="5.64,573,1559545200"; d="scan'208";a="190885132"
Received: from paaron-mobl.ger.corp.intel.com (HELO [10.251.93.134])
 ([10.251.93.134])
 by fmsmga008-auth.fm.intel.com with ESMTP/TLS/AES256-SHA;
 02 Oct 2019 02:18:40 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20191001174924.20227-1-chris@chris-wilson.co.uk>
 <20191002085056.16444-1-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <0ca14116-4047-f948-ecdd-5114401284db@linux.intel.com>
Date: Wed, 2 Oct 2019 10:18:39 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20191002085056.16444-1-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [igt-dev] [PATCH i-g-t v2] i915/gem_userptr_blits:
 Check for allowed GTT mmaps
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDAyLzEwLzIwMTkgMDk6NTAsIENocmlzIFdpbHNvbiB3cm90ZToKPiBIYXZpbmcgZGVjaWRl
ZCB0byBjbG9zZSB0aGUgR1RUIG1tYXAgb2YgdXNlcnB0ciBvYmplY3RzIGxvb3Bob2xlIGluIHRo
ZQo+IGtlcm5lbCwgd2UgbmVlZCB0byBhZGp1c3QgdGhlIHRlc3Qgc3VpdGUgdG8gYXZvaWQgdHJp
cHBpbmcgb3ZlciBHVFQKPiBtbWFwcyB3aGVuIHJlcXVpcmVkLgo+IAo+IHYyOiBSZWZpbmUgcmVh
ZC1vbmx5IHRlc3QgdG8gb25seSBza2lwIGNoZWNraW5nIEdUVCBtbWFwIGludGVyZmFjZS4KPiAK
PiBTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4K
PiBDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KPiAtLS0KPiAg
IHRlc3RzL2k5MTUvZ2VtX3VzZXJwdHJfYmxpdHMuYyB8IDc4ICsrKysrKysrKysrKysrKysrKysr
KystLS0tLS0tLS0tLS0KPiAgIDEgZmlsZSBjaGFuZ2VkLCA1MiBpbnNlcnRpb25zKCspLCAyNiBk
ZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEvdGVzdHMvaTkxNS9nZW1fdXNlcnB0cl9ibGl0
cy5jIGIvdGVzdHMvaTkxNS9nZW1fdXNlcnB0cl9ibGl0cy5jCj4gaW5kZXggM2ZhZDdkMWIzLi4y
MzU5YzEzZjQgMTAwNjQ0Cj4gLS0tIGEvdGVzdHMvaTkxNS9nZW1fdXNlcnB0cl9ibGl0cy5jCj4g
KysrIGIvdGVzdHMvaTkxNS9nZW1fdXNlcnB0cl9ibGl0cy5jCj4gQEAgLTY5LDExICs2OSwzMyBA
QAo+ICAgCj4gICBzdGF0aWMgdWludDMyX3QgdXNlcnB0cl9mbGFncyA9IExPQ0FMX0k5MTVfVVNF
UlBUUl9VTlNZTkNIUk9OSVpFRDsKPiAgIAo+ICtzdGF0aWMgYm9vbCBjYW5fZ3R0X21tYXA7Cj4g
Kwo+ICAgI2RlZmluZSBXSURUSCA1MTIKPiAgICNkZWZpbmUgSEVJR0hUIDUxMgo+ICAgCj4gICBz
dGF0aWMgdWludDMyX3QgbGluZWFyW1dJRFRIKkhFSUdIVF07Cj4gICAKPiArc3RhdGljIGJvb2wg
aGFzX2d0dF9tbWFwKGludCBpOTE1KQo+ICt7Cj4gKwl2b2lkICpwdHIsICptYXA7Cj4gKwl1aW50
MzJfdCBoYW5kbGU7Cj4gKwo+ICsJaWd0X2Fzc2VydChwb3NpeF9tZW1hbGlnbigmcHRyLCBQQUdF
X1NJWkUsIFBBR0VfU0laRSkgPT0gMCk7Cj4gKwo+ICsJZ2VtX3VzZXJwdHIoaTkxNSwgcHRyLCA0
MDk2LCAwLCAwLCAmaGFuZGxlKTsKPiArCWlndF9hc3NlcnQoaGFuZGxlICE9IDApOwo+ICsKPiAr
CW1hcCA9IF9fZ2VtX21tYXBfX2d0dChpOTE1LCBoYW5kbGUsIDQwOTYsIFBST1RfV1JJVEUpOwo+
ICsJaWYgKG1hcCkKPiArCQltdW5tYXAobWFwLCA0MDk2KTsKPiArCj4gKwlnZW1fY2xvc2UoaTkx
NSwgaGFuZGxlKTsKPiArCWZyZWUocHRyKTsKPiArCj4gKwlyZXR1cm4gbWFwICE9IE5VTEw7Cj4g
K30KPiArCj4gICBzdGF0aWMgdm9pZCBnZW1fdXNlcnB0cl90ZXN0X3Vuc3luY2hyb25pemVkKHZv
aWQpCj4gICB7Cj4gICAJdXNlcnB0cl9mbGFncyA9IExPQ0FMX0k5MTVfVVNFUlBUUl9VTlNZTkNI
Uk9OSVpFRDsKPiBAQCAtNjE3LDcgKzYzOSw3IEBAIHN0YXRpYyBpbnQgdGVzdF9pbnZhbGlkX2d0
dF9tYXBwaW5nKGludCBmZCkKPiAgIHN0YXRpYyB2b2lkIHRlc3RfcHJvY2Vzc19leGl0KGludCBm
ZCwgaW50IGZsYWdzKQo+ICAgewo+ICAgCWlmIChmbGFncyAmIFBFX0dUVF9NQVApCj4gLQkJaWd0
X3JlcXVpcmUoZ2VtX2hhc19sbGMoZmQpKTsKPiArCQlpZ3RfcmVxdWlyZShjYW5fZ3R0X21tYXAp
Owo+ICAgCj4gICAJaWd0X2ZvcmsoY2hpbGQsIDEpIHsKPiAgIAkJdWludDMyX3QgaGFuZGxlOwo+
IEBAIC04NTMsNyArODc1LDcgQEAgc3RhdGljIHZvaWQgKnVtYXAoaW50IGZkLCB1aW50MzJfdCBo
YW5kbGUpCj4gICB7Cj4gICAJdm9pZCAqcHRyOwo+ICAgCj4gLQlpZiAoZ2VtX2hhc19sbGMoZmQp
KSB7Cj4gKwlpZiAoY2FuX2d0dF9tbWFwKSB7Cj4gICAJCXB0ciA9IGdlbV9tbWFwX19ndHQoZmQs
IGhhbmRsZSwgc2l6ZW9mKGxpbmVhciksCj4gICAJCQkJICAgIFBST1RfUkVBRCB8IFBST1RfV1JJ
VEUpOwo+ICAgCX0gZWxzZSB7Cj4gQEAgLTg4NCw3ICs5MDYsNyBAQCBjaGVja19ibyhpbnQgZmQx
LCB1aW50MzJfdCBoYW5kbGUxLCBpbnQgaXNfdXNlcnB0ciwgaW50IGZkMiwgdWludDMyX3QgaGFu
ZGxlMikKPiAgIAlzaWdidXNfc3RhcnQgPSAodW5zaWduZWQgbG9uZylwdHIyOwo+ICAgCWlndF9h
c3NlcnQobWVtY21wKHB0cjEsIHB0cjIsIHNpemVvZihsaW5lYXIpKSA9PSAwKTsKPiAgIAo+IC0J
aWYgKGdlbV9oYXNfbGxjKGZkMSkpIHsKPiArCWlmIChjYW5fZ3R0X21tYXApIHsKPiAgIAkJY291
bnRlcisrOwo+ICAgCQltZW1zZXQocHRyMSwgY291bnRlciwgc2l6ZSk7Cj4gICAJCW1lbXNldChw
dHIyLCBjb3VudGVyLCBzaXplKTsKPiBAQCAtOTcxLDcgKzk5Myw3IEBAIHN0YXRpYyBpbnQgdGVz
dF9kbWFidWYodm9pZCkKPiAgIAlmcmVlX3VzZXJwdHJfYm8oZmQxLCBoYW5kbGUpOwo+ICAgCWNs
b3NlKGZkMSk7Cj4gICAKPiAtCWlmIChnZW1faGFzX2xsYyhmZDIpKSB7Cj4gKwlpZiAoY2FuX2d0
dF9tbWFwKSB7Cj4gICAJCXN0cnVjdCBzaWdhY3Rpb24gc2lnYWN0LCBvcmlnX3NpZ2FjdDsKPiAg
IAo+ICAgCQltZW1zZXQoJnNpZ2FjdCwgMCwgc2l6ZW9mKHNpZ2FjdCkpOwo+IEBAIC0xMjI3LDMx
ICsxMjQ5LDMzIEBAIHN0YXRpYyB2b2lkIHRlc3RfcmVhZG9ubHlfbW1hcChpbnQgaTkxNSkKPiAg
IAlwdHIgPSBfX2dlbV9tbWFwX19ndHQoaTkxNSwgaGFuZGxlLCBzeiwgUFJPVF9XUklURSk7Cj4g
ICAJaWd0X2Fzc2VydChwdHIgPT0gTlVMTCk7Cj4gICAKPiAtCXB0ciA9IGdlbV9tbWFwX19ndHQo
aTkxNSwgaGFuZGxlLCBzeiwgUFJPVF9SRUFEKTsKPiArCS8qIE9wdGlvbmFsIGtlcm5lbCBzdXBw
b3J0IGZvciBHVFQgbW1hcHMgb2YgdXNlcnB0ciAqLwo+ICsJcHRyID0gX19nZW1fbW1hcF9fZ3R0
KGk5MTUsIGhhbmRsZSwgc3osIFBST1RfUkVBRCk7Cj4gICAJZ2VtX2Nsb3NlKGk5MTUsIGhhbmRs
ZSk7Cj4gICAKPiAtCS8qIENoZWNrIHRoYXQgYSB3cml0ZSBpbnRvIHRoZSBHVFQgcmVhZG9ubHkg
bWFwIGZhaWxzICovCj4gLQlpZiAoIShzaWcgPSBzaWdzZXRqbXAoc2lnam1wLCAxKSkpIHsKPiAt
CQlzaWduYWwoU0lHQlVTLCBzaWdqbXBfaGFuZGxlcik7Cj4gLQkJc2lnbmFsKFNJR1NFR1YsIHNp
Z2ptcF9oYW5kbGVyKTsKPiAtCQltZW1zZXQocHRyLCAweDVhLCBzeik7Cj4gLQkJaWd0X2Fzc2Vy
dCgwKTsKPiAtCX0KPiAtCWlndF9hc3NlcnRfZXEoc2lnLCBTSUdTRUdWKTsKPiAtCj4gLQkvKiBD
aGVjayB0aGF0IHdlIGRpc2FsbG93IHJlbW92aW5nIHRoZSByZWFkb25seSBwcm90ZWN0aW9uICov
Cj4gLQlpZ3RfYXNzZXJ0KG1wcm90ZWN0KHB0ciwgc3osIFBST1RfV1JJVEUpKTsKPiAtCWlmICgh
KHNpZyA9IHNpZ3NldGptcChzaWdqbXAsIDEpKSkgewo+IC0JCXNpZ25hbChTSUdCVVMsIHNpZ2pt
cF9oYW5kbGVyKTsKPiAtCQlzaWduYWwoU0lHU0VHViwgc2lnam1wX2hhbmRsZXIpOwo+IC0JCW1l
bXNldChwdHIsIDB4NWEsIHN6KTsKPiAtCQlpZ3RfYXNzZXJ0KDApOwo+IC0JfQo+IC0JaWd0X2Fz
c2VydF9lcShzaWcsIFNJR1NFR1YpOwo+ICsJaWYgKHB0cikgeyAvKiBDaGVjayB0aGF0IGEgd3Jp
dGUgaW50byB0aGUgR1RUIHJlYWRvbmx5IG1hcCBmYWlscyAqLwo+ICsJCWlmICghKHNpZyA9IHNp
Z3NldGptcChzaWdqbXAsIDEpKSkgewo+ICsJCQlzaWduYWwoU0lHQlVTLCBzaWdqbXBfaGFuZGxl
cik7Cj4gKwkJCXNpZ25hbChTSUdTRUdWLCBzaWdqbXBfaGFuZGxlcik7Cj4gKwkJCW1lbXNldChw
dHIsIDB4NWEsIHN6KTsKPiArCQkJaWd0X2Fzc2VydCgwKTsKPiArCQl9Cj4gKwkJaWd0X2Fzc2Vy
dF9lcShzaWcsIFNJR1NFR1YpOwo+ICsKPiArCQkvKiBDaGVjayB0aGF0IHdlIGRpc2FsbG93IHJl
bW92aW5nIHRoZSByZWFkb25seSBwcm90ZWN0aW9uICovCj4gKwkJaWd0X2Fzc2VydChtcHJvdGVj
dChwdHIsIHN6LCBQUk9UX1dSSVRFKSk7Cj4gKwkJaWYgKCEoc2lnID0gc2lnc2V0am1wKHNpZ2pt
cCwgMSkpKSB7Cj4gKwkJCXNpZ25hbChTSUdCVVMsIHNpZ2ptcF9oYW5kbGVyKTsKPiArCQkJc2ln
bmFsKFNJR1NFR1YsIHNpZ2ptcF9oYW5kbGVyKTsKPiArCQkJbWVtc2V0KHB0ciwgMHg1YSwgc3op
Owo+ICsJCQlpZ3RfYXNzZXJ0KDApOwo+ICsJCX0KPiArCQlpZ3RfYXNzZXJ0X2VxKHNpZywgU0lH
U0VHVik7Cj4gICAKPiAtCS8qIEEgc2luZ2xlIHJlYWQgZnJvbSB0aGUgR1RUIHBvaW50ZXIgdG8g
cHJvdmUgdGhhdCB3b3JrcyAqLwo+IC0JaWd0X2Fzc2VydF9lcV91MzIoKih1aW50OF90ICopcHRy
LCAweGE1KTsKPiAtCW11bm1hcChwdHIsIHN6KTsKPiArCQkvKiBBIHNpbmdsZSByZWFkIGZyb20g
dGhlIEdUVCBwb2ludGVyIHRvIHByb3ZlIHRoYXQgd29ya3MgKi8KPiArCQlpZ3RfYXNzZXJ0X2Vx
X3UzMigqKHVpbnQ4X3QgKilwdHIsIDB4YTUpOwo+ICsJCW11bm1hcChwdHIsIHN6KTsKPiArCX0K
PiAgIAo+ICAgCS8qIERvdWJsZSBjaGVjayB0aGF0IHRoZSBrZXJuZWwgZGlkIGluZGVlZCBub3Qg
bGV0IGFueSB3cml0ZXMgdGhyb3VnaCAqLwo+ICAgCWlndF9jbGZsdXNoX3JhbmdlKHBhZ2VzLCBz
eik7Cj4gQEAgLTE4MzQsNiArMTg1OCw4IEBAIGlndF9tYWluX2FyZ3MoImM6IiwgTlVMTCwgaGVs
cF9zdHIsIG9wdF9oYW5kbGVyLCBOVUxMKQo+ICAgCQlpZ3RfcmVxdWlyZV9nZW0oZmQpOwo+ICAg
CQlnZW1fcmVxdWlyZV9ibGl0dGVyKGZkKTsKPiAgIAo+ICsJCWNhbl9ndHRfbW1hcCA9IGhhc19n
dHRfbW1hcChmZCkgJiYgZ2VtX2hhc19sbGMoZmQpOwo+ICsKPiAgIAkJc2l6ZSA9IHNpemVvZihs
aW5lYXIpOwo+ICAgCj4gICAJCWFwZXJ0dXJlX3NpemUgPSBnZW1fYXBlcnR1cmVfc2l6ZShmZCk7
Cj4gCgpSZXZpZXdlZC1ieTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNv
bT4KClJlZ2FyZHMsCgpUdnJ0a28KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

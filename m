Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 03E0C82612
	for <lists+intel-gfx@lfdr.de>; Mon,  5 Aug 2019 22:30:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 699236E157;
	Mon,  5 Aug 2019 20:30:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 87E226E157
 for <intel-gfx@lists.freedesktop.org>; Mon,  5 Aug 2019 20:30:52 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17897253-1500050 
 for multiple; Mon, 05 Aug 2019 21:30:34 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  5 Aug 2019 21:30:31 +0100
Message-Id: <20190805203032.15747-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 1/2] drm/i915: Defer final intel_wakeref_put
 to process context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2UgbmVlZCB0byBhY3F1aXJlIGEgbXV0ZXggdG8gc2VyaWFsaXNlIHRoZSBmaW5hbAppbnRl
bF93YWtlcmVmX3B1dCwgd2UgbmVlZCB0byBlbnN1cmUgdGhhdCB3ZSBhcmUgaW4gcHJvY2VzcyBj
b250ZXh0IGF0CnRoYXQgdGltZS4gSG93ZXZlciwgd2Ugd2FudCB0byBhbGxvdyBvcGVyYXRpb24g
b24gdGhlIGludGVsX3dha2VyZWYgZnJvbQppbnNpZGUgdGltZXIgYW5kIG90aGVyIGhhcmRpcnEg
Y29udGV4dCwgd2hpY2ggbWVhbnMgdGhhdCBuZWVkIHRvIGRlZmVyCnRoYXQgZmluYWwgcHV0IHRv
IGEgd29ya3F1ZXVlLgoKSW5zaWRlIHRoZSBmaW5hbCB3YWtlcmVmIHB1dHMsIHdlIGFyZSBzYWZl
IHRvIG9wZXJhdGUgaW4gYW55IGNvbnRleHQsIGFzCndlIGFyZSBzaW1wbHkgbWFya2luZyB1cCB0
aGUgSFcgYW5kIHN0YXRlIHRyYWNraW5nIGZvciB0aGUgcG90ZW50aWFsCnNsZWVwLiBJdCdzIG9u
bHkgdGhlIHNlcmlhbGlzYXRpb24gd2l0aCB0aGUgcG90ZW50aWFsIHNsZWVwaW5nIGdldHRpbmcK
dGhhdCByZXF1aXJlcyBjYXJlZnVsIHdhaXQgYXZvaWRhbmNlLiBUaGlzIGFsbG93cyB1cyB0byBy
ZXRhaW4gdGhlCmltbWVkaWF0ZSBwcm9jZXNzaW5nIGFzIGJlZm9yZSAod2Ugb25seSBuZWVkIHRv
IHNsZWVwIG92ZXIgdGhlIHNhbWUKcmFjZXMgYXMgdGhlIGN1cnJlbnQgbXV0ZXhfbG9jaykuCgp2
MjogQWRkIGEgc2VsZnRlc3QgdG8gZW5zdXJlIHdlIGV4ZXJjaXNlIHRoZSBjb2RlIHdoaWxlIGxv
Y2tkZXAgd2F0Y2hlcy4KdjM6IFRoYXQgdGVzdCB3YXMgZXh0cmVtZWx5IGxvdWQgYW5kIGNvbXBs
YWluZWQgYWJvdXQgbWFueSB0aGluZ3MhCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNr
dG9wLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTExMjk1ClJlZmVyZW5jZXM6IGh0dHBzOi8vYnVncy5m
cmVlZGVza3RvcC5vcmcvc2hvd19idWcuY2dpP2lkPTExMTI0NQpGaXhlczogMTgzOTg5MDRjYTll
ICgiZHJtL2k5MTU6IE9ubHkgcmVjb3ZlciBhY3RpdmUgZW5naW5lcyIpCkZpeGVzOiA1MWZiZDhk
ZTg3ZGMgKCJkcm0vaTkxNS9wbXU6IEF0b21pY2FsbHkgYWNxdWlyZSB0aGUgZ3RfcG0gd2FrZXJl
ZiIpClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IE1pa2Eg
S3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8IDEzICstLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgIDEgKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgICAgIHwgMzggKysrLS0tLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaCAgICAgfCAxOCArKy0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jICAgICAgICAgfCAyOCArKystLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oICAgICAgICAgfCAyMiArKysrLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgIHwgIDQgKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jICAgICB8IDI4ICsrKysrKysKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5oICAgICB8IDE0ICsrKysKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9wbS5jICB8IDgzICsrKysrKysrKysr
KysrKysrKysKIC4uLi9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYyB8
ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAg
NCArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAyNiAr
LS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYyAgICAgICAgICB8IDgy
ICsrKysrKysrKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5o
ICAgICAgICAgIHwgNjIgKysrKysrKysrLS0tLS0KIC4uLi9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9saXZlX3NlbGZ0ZXN0cy5oICB8ICA1ICstCiAxNiBmaWxlcyBjaGFuZ2VkLCAzMDEgaW5zZXJ0
aW9ucygrKSwgMTMxIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lLmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfcG0uYwoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggNzI5MjI3MDNhZjQ5Li4xN2UzNjE4MjQxYzUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC0xMzAsNyArMTMwLDkg
QEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoc3RydWN0IGludGVs
X2d0ICpndCkKIAkJfQogCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3JlcXVlc3RzKGd0LT5pOTE1KSAm
JiByZXN1bHQpOwogCi0JR0VNX0JVR19PTihndC0+YXdha2UpOworCWlmIChpbnRlbF9ndF9wbV93
YWl0X2Zvcl9pZGxlKGd0KSkKKwkJcmVzdWx0ID0gZmFsc2U7CisKIAlyZXR1cm4gcmVzdWx0Owog
fQogCkBAIC0xNjEsMTMgKzE2Myw2IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKLQkvKgotCSAqIEFzc2VydCB0aGF0IHdlIHN1Y2Nlc3NmdWxseSBmbHVzaGVkIGFs
bCB0aGUgd29yayBhbmQKLQkgKiByZXNldCB0aGUgR1BVIGJhY2sgdG8gaXRzIGlkbGUsIGxvdyBw
b3dlciBzdGF0ZS4KLQkgKi8KLQlHRU1fQlVHX09OKGk5MTUtPmd0LmF3YWtlKTsKLQlmbHVzaF93
b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsKLQogCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygm
aTkxNS0+Z3QuaGFuZ2NoZWNrLndvcmspOwogCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0
cyhpOTE1KTsKQEAgLTI0NCw4ICsyMzksNiBAQCB2b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlHRU1fVFJBQ0UoIlxuIik7CiAKLQlXQVJOX09O
KGk5MTUtPmd0LmF3YWtlKTsKLQogCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
Y3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IGE5
MWYxNTcxN2NjMS4uNDE0YjBkYmIzYTIwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfY3MuYwpAQCAtMTY3Miw1ICsxNjcyLDYgQEAgaW50ZWxfZW5naW5lX2ZpbmRfYWN0
aXZlX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogfQogCiAjaWYgSVNf
RU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAic2VsZnRlc3RfZW5n
aW5lLmMiCiAjaW5jbHVkZSAic2VsZnRlc3RfZW5naW5lX2NzLmMiCiAjZW5kaWYKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXggMDMzNjIwNDk4OGQ2Li42YjE1
ZTMzMzVkZDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCkBA
IC0zNywyOCArMzcsNiBAQCBzdGF0aWMgaW50IF9fZW5naW5lX3VucGFyayhzdHJ1Y3QgaW50ZWxf
d2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZW5naW5lX3BtX2dldChz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50ZWxfd2FrZXJlZl9nZXQoJmVu
Z2luZS0+aTkxNS0+cnVudGltZV9wbSwgJmVuZ2luZS0+d2FrZXJlZiwgX19lbmdpbmVfdW5wYXJr
KTsKLX0KLQotdm9pZCBpbnRlbF9lbmdpbmVfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCi17Ci0JLyoKLQkgKiBXZSBhcmUgY29tbWl0dGVkIG5vdyB0byBwYXJraW5nIHRoaXMg
ZW5naW5lLCBtYWtlIHN1cmUgdGhlcmUKLQkgKiB3aWxsIGJlIG5vIG1vcmUgaW50ZXJydXB0cyBh
cnJpdmluZyBsYXRlciBhbmQgdGhlIGVuZ2luZQotCSAqIGlzIHRydWx5IGlkbGUuCi0JICovCi0J
aWYgKHdhaXRfZm9yKGludGVsX2VuZ2luZV9pc19pZGxlKGVuZ2luZSksIDEwKSkgewotCQlzdHJ1
Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9kZWJ1Z19wcmludGVyKF9fZnVuY19fKTsKLQotCQlkZXZf
ZXJyKGVuZ2luZS0+aTkxNS0+ZHJtLmRldiwKLQkJCSIlcyBpcyBub3QgaWRsZSBiZWZvcmUgcGFy
a2luZ1xuIiwKLQkJCWVuZ2luZS0+bmFtZSk7Ci0JCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwg
JnAsIE5VTEwpOwotCX0KLX0KLQogc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKQEAgLTEzNiwxMiArMTE0LDE4IEBAIHN0YXRpYyBpbnQgX19lbmdpbmVfcGFyayhzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZW5naW5l
X3BtX3B1dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50ZWxfd2FrZXJl
Zl9wdXQoJmVuZ2luZS0+aTkxNS0+cnVudGltZV9wbSwgJmVuZ2luZS0+d2FrZXJlZiwgX19lbmdp
bmVfcGFyayk7Ci19CitzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX3dha2VyZWZfb3BzIHdmX29w
cyA9IHsKKwkuZ2V0ID0gX19lbmdpbmVfdW5wYXJrLAorCS5wdXQgPSBfX2VuZ2luZV9wYXJrLAor
fTsKIAogdm9pZCBpbnRlbF9lbmdpbmVfaW5pdF9fcG0oc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogewotCWludGVsX3dha2VyZWZfaW5pdCgmZW5naW5lLT53YWtlcmVmKTsKKwlzdHJ1
Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtID0gJmVuZ2luZS0+aTkxNS0+cnVudGltZV9wbTsKKwor
CWludGVsX3dha2VyZWZfaW5pdCgmZW5naW5lLT53YWtlcmVmLCBycG0sICZ3Zl9vcHMpOwogfQor
CisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAic2Vs
ZnRlc3RfZW5naW5lX3BtLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX3BtLmgKaW5kZXggMDE1YWM3MmQ3YWQwLi43MzljNTBmZWZjZWYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCkBAIC0xMCwyNCArMTAsMjYgQEAKICNp
bmNsdWRlICJpbnRlbF9lbmdpbmVfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgi
CiAKLXN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwotCi12b2lkIGludGVsX2VuZ2luZV9wbV9nZXQo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKLXZvaWQgaW50ZWxfZW5naW5lX3BtX3B1
dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwotCiBzdGF0aWMgaW5saW5lIGJvb2wK
IGludGVsX2VuZ2luZV9wbV9pc19hd2FrZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfaXNfYWN0aXZlKCZlbmdpbmUtPndha2Vy
ZWYpOwogfQogCi1zdGF0aWMgaW5saW5lIGJvb2wKLWludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdh
a2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQorc3RhdGljIGlubGluZSB2b2lkIGlu
dGVsX2VuZ2luZV9wbV9nZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWlu
dGVsX3dha2VyZWZfZ2V0KCZlbmdpbmUtPndha2VyZWYpOworfQorCitzdGF0aWMgaW5saW5lIGJv
b2wgaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZSgmZW5naW5lLT53
YWtlcmVmKTsKIH0KIAotdm9pZCBpbnRlbF9lbmdpbmVfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpOworc3RhdGljIGlubGluZSB2b2lkIGludGVsX2VuZ2luZV9wbV9wdXQoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWludGVsX3dha2VyZWZfcHV0KCZlbmdp
bmUtPndha2VyZWYpOworfQogCiB2b2lkIGludGVsX2VuZ2luZV9pbml0X19wbShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ndF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0u
YwppbmRleCA2Yzg5NzAyNzFhN2YuLjEzNjNlMDY5ZWM4MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF9wbS5jCkBAIC0xNyw3ICsxNyw3IEBAIHN0YXRpYyB2b2lkIHBtX25vdGlmeShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHN0YXRlKQogCWJsb2NraW5nX25vdGlm
aWVyX2NhbGxfY2hhaW4oJmk5MTUtPmd0LnBtX25vdGlmaWNhdGlvbnMsIHN0YXRlLCBpOTE1KTsK
IH0KIAotc3RhdGljIGludCBpbnRlbF9ndF91bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndm
KQorc3RhdGljIGludCBfX2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CiAJ
c3RydWN0IGludGVsX2d0ICpndCA9IGNvbnRhaW5lcl9vZih3ZiwgdHlwZW9mKCpndCksIHdha2Vy
ZWYpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5MTU7CkBAIC01Mywx
NCArNTMsNyBAQCBzdGF0aWMgaW50IGludGVsX2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJl
ZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSA9ICZndC0+aTkxNS0+
cnVudGltZV9wbTsKLQotCWludGVsX3dha2VyZWZfZ2V0KHJwbSwgJmd0LT53YWtlcmVmLCBpbnRl
bF9ndF91bnBhcmspOwotfQotCi1zdGF0aWMgaW50IGludGVsX2d0X3Bhcmsoc3RydWN0IGludGVs
X3dha2VyZWYgKndmKQorc3RhdGljIGludCBfX2d0X3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVyX29m
KHdmLCB0eXBlb2YoKmk5MTUpLCBndC53YWtlcmVmKTsKQEAgLTc0LDIyICs2NywyNSBAQCBzdGF0
aWMgaW50IGludGVsX2d0X3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCWlmIChJTlRF
TF9HRU4oaTkxNSkgPj0gNikKIAkJZ2VuNl9ycHNfaWRsZShpOTE1KTsKIAorCS8qIEV2ZXJ5dGhp
bmcgc3dpdGNoZWQgb2ZmLCBmbHVzaCBhbnkgcmVzaWR1YWwgaW50ZXJydXB0IGp1c3QgaW4gY2Fz
ZSAqLworCWludGVsX3N5bmNocm9uaXplX2lycShpOTE1KTsKKwogCUdFTV9CVUdfT04oIXdha2Vy
ZWYpOwogCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGk5MTUsIFBPV0VSX0RPTUFJTl9HVF9JUlEs
IHdha2VyZWYpOwogCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaW50ZWxfZ3RfcG1fcHV0KHN0cnVj
dCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSA9ICZndC0+
aTkxNS0+cnVudGltZV9wbTsKLQotCWludGVsX3dha2VyZWZfcHV0KHJwbSwgJmd0LT53YWtlcmVm
LCBpbnRlbF9ndF9wYXJrKTsKLX0KK3N0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJlZl9v
cHMgd2Zfb3BzID0geworCS5nZXQgPSBfX2d0X3VucGFyaywKKwkucHV0ID0gX19ndF9wYXJrLAor
CS5mbGFncyA9IElOVEVMX1dBS0VSRUZfUFVUX0FTWU5DLAorfTsKIAogdm9pZCBpbnRlbF9ndF9w
bV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7Ci0JaW50ZWxfd2FrZXJlZl9pbml0
KCZndC0+d2FrZXJlZik7CisJaW50ZWxfd2FrZXJlZl9pbml0KCZndC0+d2FrZXJlZiwgJmd0LT5p
OTE1LT5ydW50aW1lX3BtLCAmd2Zfb3BzKTsKKwogCUJMT0NLSU5HX0lOSVRfTk9USUZJRVJfSEVB
RCgmZ3QtPnBtX25vdGlmaWNhdGlvbnMpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Z3RfcG0uaAppbmRleCBlOGExOGQ0YjI3YzkuLjU3NjMzZjUzOGRkYiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndF9wbS5oCkBAIC0xNywxNCArMTcsMzIgQEAgZW51bSB7CiAJSU5URUxf
R1RfUEFSSywKIH07CiAKLXZvaWQgaW50ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
Owotdm9pZCBpbnRlbF9ndF9wbV9wdXQoc3RydWN0IGludGVsX2d0ICpndCk7CitzdGF0aWMgaW5s
aW5lIGJvb2wKK2ludGVsX2d0X3BtX2lzX2F3YWtlKGNvbnN0IHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
Cit7CisJcmV0dXJuIGludGVsX3dha2VyZWZfaXNfYWN0aXZlKCZndC0+d2FrZXJlZik7Cit9CisK
K3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9ndF9wbV9nZXQoc3RydWN0IGludGVsX2d0ICpndCkK
K3sKKwlpbnRlbF93YWtlcmVmX2dldCgmZ3QtPndha2VyZWYpOworfQogCiBzdGF0aWMgaW5saW5l
IGJvb2wgaW50ZWxfZ3RfcG1fZ2V0X2lmX2F3YWtlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJ
cmV0dXJuIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZSgmZ3QtPndha2VyZWYpOwogfQogCitz
dGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZ3RfcG1fcHV0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7
CisJaW50ZWxfd2FrZXJlZl9wdXQoJmd0LT53YWtlcmVmKTsKK30KKworc3RhdGljIGlubGluZSBp
bnQgaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXJl
dHVybiBpbnRlbF93YWtlcmVmX3dhaXRfZm9yX2lkbGUoJmd0LT53YWtlcmVmKTsKK30KKwogdm9p
ZCBpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogCiB2b2lkIGlu
dGVsX2d0X3Nhbml0aXplKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgZm9yY2UpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCAyMzJmNDBmY2I0OTAuLjFhMDExNjc1MWQxOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTEzOSw2ICsxMzksNyBAQAogI2lu
Y2x1ZGUgImk5MTVfdmdwdS5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1
ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJpbnRl
bF9scmNfcmVnLmgiCiAjaW5jbHVkZSAiaW50ZWxfbW9jcy5oIgogI2luY2x1ZGUgImludGVsX3Jl
c2V0LmgiCkBAIC01NTYsNiArNTU3LDcgQEAgZXhlY2xpc3RzX3NjaGVkdWxlX2luKHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLCBpbnQgaWR4KQogCQlpbnRlbF9jb250ZXh0X2dldChjZSk7CiAJCWNl
LT5pbmZsaWdodCA9IHJxLT5lbmdpbmU7CiAKKwkJaW50ZWxfZ3RfcG1fZ2V0KGNlLT5pbmZsaWdo
dC0+Z3QpOwogCQlleGVjbGlzdHNfY29udGV4dF9zdGF0dXNfY2hhbmdlKHJxLCBJTlRFTF9DT05U
RVhUX1NDSEVEVUxFX0lOKTsKIAkJaW50ZWxfZW5naW5lX2NvbnRleHRfaW4oY2UtPmluZmxpZ2h0
KTsKIAl9CkBAIC01ODgsNiArNTkwLDcgQEAgZXhlY2xpc3RzX3NjaGVkdWxlX291dChzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIAlpZiAoIWludGVsX2NvbnRleHRfaW5mbGlnaHRfY291bnQoY2Up
KSB7CiAJCWludGVsX2VuZ2luZV9jb250ZXh0X291dChjZS0+aW5mbGlnaHQpOwogCQlleGVjbGlz
dHNfY29udGV4dF9zdGF0dXNfY2hhbmdlKHJxLCBJTlRFTF9DT05URVhUX1NDSEVEVUxFX09VVCk7
CisJCWludGVsX2d0X3BtX3B1dChjZS0+aW5mbGlnaHQtPmd0KTsKIAogCQkvKgogCQkgKiBJZiB0
aGlzIGlzIHBhcnQgb2YgYSB2aXJ0dWFsIGVuZ2luZSwgaXRzIG5leHQgcmVxdWVzdCBtYXkKQEAg
LTI3MTksNyArMjcyMiw2IEBAIHN0YXRpYyB1MzIgKmdlbjhfZW1pdF9maW5pX2JyZWFkY3J1bWJf
cmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAqY3MpCiBzdGF0aWMgdm9pZCBl
eGVjbGlzdHNfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJZGVsX3Rp
bWVyX3N5bmMoJmVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyKTsKLQlpbnRlbF9lbmdpbmVfcGFyayhl
bmdpbmUpOwogfQogCiB2b2lkIGludGVsX2V4ZWNsaXN0c19zZXRfZGVmYXVsdF9zdWJtaXNzaW9u
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfZW5naW5lLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAw
Li5mNjViMTE4ZTI2MWQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9lbmdpbmUuYwpAQCAtMCwwICsxLDI4IEBACisvKgorICogU1BEWC1MaWNlbnNl
LUlkZW50aWZpZXI6IEdQTC0yLjAKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOCBJbnRlbCBDb3Jw
b3JhdGlvbgorICovCisKKyNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSAic2Vs
ZnRlc3RfZW5naW5lLmgiCisKK2ludCBpbnRlbF9lbmdpbmVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGludCAoKiBjb25zdCB0ZXN0c1td
KShzdHJ1Y3QgaW50ZWxfZ3QgKikgPSB7CisJCWxpdmVfZW5naW5lX3BtX3NlbGZ0ZXN0cywKKwkJ
TlVMTCwKKwl9OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CisJdHlwZW9mKCp0
ZXN0cykgKmZuOworCisJZm9yIChmbiA9IHRlc3RzOyAqZm47IGZuKyspIHsKKwkJaW50IGVycjsK
KworCQllcnIgPSAoKmZuKShndCk7CisJCWlmIChlcnIpCisJCQlyZXR1cm4gZXJyOworCX0KKwor
CXJldHVybiAwOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfZW5naW5lLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmUuaApu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmFiMzJkMDllYzVhMQotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZS5o
CkBAIC0wLDAgKzEsMTQgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIu
MAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lm
bmRlZiBTRUxGVEVTVF9FTkdJTkVfSAorI2RlZmluZSBTRUxGVEVTVF9FTkdJTkVfSAorCitzdHJ1
Y3QgaW50ZWxfZ3Q7CisKK2ludCBsaXZlX2VuZ2luZV9wbV9zZWxmdGVzdHMoc3RydWN0IGludGVs
X2d0ICpndCk7CisKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfZW5naW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9l
bmdpbmVfcG0uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjc1YzE5
NzYxMjcwNQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2VuZ2luZV9wbS5jCkBAIC0wLDAgKzEsODMgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRl
bnRpZmllcjogR1BMLTIuMAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE4IEludGVsIENvcnBvcmF0
aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKKyNpbmNsdWRlICJzZWxmdGVz
dF9lbmdpbmUuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X2F0b21pYy5oIgorCitzdGF0aWMg
aW50IGxpdmVfZW5naW5lX3BtKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
YXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2lu
ZV9pZCBpZDsKKworCS8qCisJICogQ2hlY2sgd2UgY2FuIGNhbGwgaW50ZWxfZW5naW5lX3BtX3B1
dCBmcm9tIGFueSBjb250ZXh0LiBObworCSAqIGZhaWx1cmVzIGFyZSByZXBvcnRlZCBkaXJlY3Rs
eSwgYnV0IGlmIHdlIG1lc3MgdXAgbG9ja2RlcCBzaG91bGQKKwkgKiB0ZWxsIHVzLgorCSAqLwor
CWlmIChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KSkgeworCQlwcl9lcnIoIlVuYWJsZSB0
byBmbHVzaCBHVCBwbSBiZWZvcmUgdGVzdFxuIik7CisJCXJldHVybiAtRUJVU1k7CisJfQorCisJ
R0VNX0JVR19PTihpbnRlbF9ndF9wbV9pc19hd2FrZShndCkpOworCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LT5pOTE1LCBpZCkgeworCQljb25zdCB0eXBlb2YoKmlndF9hdG9taWNfcGhhc2Vz
KSAqcDsKKworCQlmb3IgKHAgPSBpZ3RfYXRvbWljX3BoYXNlczsgcC0+bmFtZTsgcCsrKSB7CisJ
CQkvKgorCQkJICogQWNxdWlzaXRpb24gaXMgYWx3YXlzIHN5bmNocm9ub3VzLCBleGNlcHQgaWYg
d2UKKwkJCSAqIGtub3cgdGhhdCB0aGUgZW5naW5lIGlzIGFscmVhZHkgYXdhbGUsIGluIHdoaWNo
CisJCQkgKiB3ZSBzaG91bGQgdXNlIGludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdha2UoKSB0bwor
CQkJICogYXRvbWljYWxseSBncmFiIHRoZSB3YWtlcmVmLgorCQkJICoKKwkJCSAqIEluIHByYWN0
aWNlLAorCQkJICogICAgaW50ZWxfZW5naW5lX3BtX2dldCgpOworCQkJICogICAgaW50ZWxfZW5n
aW5lX3BtX3B1dCgpOworCQkJICogb2NjdXJzIGluIG9uZSB0aHJlYWQsIHdoaWxlIHNpbXVsdGFu
ZW91c2x5CisJCQkgKiAgICBpbnRlbF9lbmdpbmVfcG1fZ2V0X2lmX2F3YWtlKCk7CisJCQkgKiAg
ICBpbnRlbF9lbmdpbmVfcG1fcHV0KCk7CisJCQkgKiBvY2N1cnMgaW4gYXRvbWljIGNvbnRleHQg
aW4gYW5vdGhlci4KKwkJCSAqLworCQkJR0VNX0JVR19PTihpbnRlbF9lbmdpbmVfcG1faXNfYXdh
a2UoZW5naW5lKSk7CisJCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CisKKwkJCXAtPmNy
aXRpY2FsX3NlY3Rpb25fYmVnaW4oKTsKKwkJCWlmICghaW50ZWxfZW5naW5lX3BtX2dldF9pZl9h
d2FrZShlbmdpbmUpKQorCQkJCXByX2VycigiaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZSgl
cykgZmFpbGVkIHVuZGVyICVzXG4iLAorCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIHAtPm5hbWUp
OworCQkJZWxzZQorCQkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJCWludGVsX2Vu
Z2luZV9wbV9wdXQoZW5naW5lKTsKKwkJCXAtPmNyaXRpY2FsX3NlY3Rpb25fZW5kKCk7CisKKwkJ
CS8qIGVuZ2luZSB3YWtlcmVmIGlzIHN5bmMgKGluc3RhbnQpICovCisJCQlpZiAoaW50ZWxfZW5n
aW5lX3BtX2lzX2F3YWtlKGVuZ2luZSkpIHsKKwkJCQlwcl9lcnIoIiVzIGlzIHN0aWxsIGF3YWtl
IGFmdGVyIGZsdXNoaW5nIHBtXG4iLAorCQkJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQkJCXJl
dHVybiAtRUlOVkFMOworCQkJfQorCisJCQkvKiBndCB3YWtlcmVmIGlzIGFzeW5jIChkZWZlcnJl
ZCB0byB3b3JrcXVldWUpICovCisJCQlpZiAoaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCkp
IHsKKwkJCQlwcl9lcnIoIkdUIGZhaWxlZCB0byBpZGxlXG4iKTsKKwkJCQlyZXR1cm4gLUVJTlZB
TDsKKwkJCX0KKwkJfQorCX0KKworCXJldHVybiAwOworfQorCitpbnQgbGl2ZV9lbmdpbmVfcG1f
c2VsZnRlc3RzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RhdGljIGNvbnN0IHN0cnVjdCBp
OTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZlX2VuZ2luZV9wbSksCisJfTsK
KworCXJldHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCBndCk7Cit9CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYwppbmRleCA0
MTI4OTIwOTZkYWEuLjQ5Nzg2ZTdhNjQ3YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCkBAIC0yOSw2ICsyOSw3IEBACiAjaW5jbHVk
ZSAiZ3QvaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgog
I2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKICNp
bmNsdWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3VjX3N1Ym1pc3Np
b24uaCIKIApAQCAtNTM3LDYgKzUzOCw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpz
Y2hlZHVsZV9pbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgaW50IGlkeCkKIAlpZiAoIXJxLT5o
d19jb250ZXh0LT5pbmZsaWdodCkKIAkJcnEtPmh3X2NvbnRleHQtPmluZmxpZ2h0ID0gcnEtPmVu
Z2luZTsKIAlpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2luYyhycS0+aHdfY29udGV4dCk7CisJaW50
ZWxfZ3RfcG1fZ2V0KHJxLT5lbmdpbmUtPmd0KTsKIAogCXJldHVybiBpOTE1X3JlcXVlc3RfZ2V0
KHJxKTsKIH0KQEAgLTU0OSw2ICs1NTEsNyBAQCBzdGF0aWMgdm9pZCBzY2hlZHVsZV9vdXQoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaWYgKCFpbnRlbF9jb250ZXh0X2luZmxpZ2h0X2NvdW50
KHJxLT5od19jb250ZXh0KSkKIAkJcnEtPmh3X2NvbnRleHQtPmluZmxpZ2h0ID0gTlVMTDsKIAor
CWludGVsX2d0X3BtX3B1dChycS0+ZW5naW5lLT5ndCk7CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7
CiB9CiAKQEAgLTEwNzYsNyArMTA3OSw2IEBAIHN0YXRpYyB2b2lkIGd1Y19pbnRlcnJ1cHRzX3Jl
bGVhc2Uoc3RydWN0IGludGVsX2d0ICpndCkKIAogc3RhdGljIHZvaWQgZ3VjX3N1Ym1pc3Npb25f
cGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0JaW50ZWxfZW5naW5lX3Bh
cmsoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfdW5waW5fYnJlYWRjcnVtYnNfaXJxKGVuZ2luZSk7
CiAJZW5naW5lLT5mbGFncyAmPSB+STkxNV9FTkdJTkVfTkVFRFNfQlJFQURDUlVNQl9UQVNLTEVU
OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCA4OTUzMzM2ZjJhZTUuLmVh
M2JhMjY2MmE5ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2Zz
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM5LDYgKzM5
LDcgQEAKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX3Bzci5oIgogCiAjaW5jbHVkZSAiZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgogI2luY2x1ZGUg
Imd0L2ludGVsX3Jlc2V0LmgiCiAjaW5jbHVkZSAiZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24u
aCIKIApAQCAtMzY2NSw2ICszNjY2LDkgQEAgaTkxNV9kcm9wX2NhY2hlc19zZXQodm9pZCAqZGF0
YSwgdTY0IHZhbCkKIAkJCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKIAkJCQkJCSAgICAgTUFY
X1NDSEVEVUxFX1RJTUVPVVQpOwogCisJCWlmIChyZXQgPT0gMCAmJiB2YWwgJiBEUk9QX0lETEUp
CisJCQlyZXQgPSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7CisKIAkJaWYg
KHZhbCAmIERST1BfUkVUSVJFKQogCQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGViMzRmM2U1YTc0ZC4uNWVhY2VjYmQ3MDAyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTg5MywxOSArODkzLDYgQEAgdm9pZCBpOTE1X2dlbV9y
dW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJfQogfQogCi1z
dGF0aWMgaW50IHdhaXRfZm9yX2VuZ2luZXMoc3RydWN0IGludGVsX2d0ICpndCkKLXsKLQlpZiAo
d2FpdF9mb3IoaW50ZWxfZW5naW5lc19hcmVfaWRsZShndCksIEk5MTVfSURMRV9FTkdJTkVTX1RJ
TUVPVVQpKSB7Ci0JCWRldl9lcnIoZ3QtPmk5MTUtPmRybS5kZXYsCi0JCQkiRmFpbGVkIHRvIGlk
bGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdlZCFcbiIpOwotCQlHRU1fVFJBQ0VfRFVNUCgpOwot
CQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKLQkJcmV0dXJuIC1FSU87Ci0JfQotCi0JcmV0dXJu
IDA7Ci19Ci0KIHN0YXRpYyBsb25nCiB3YWl0X2Zvcl90aW1lbGluZXMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCSAgIHVuc2lnbmVkIGludCBmbGFncywgbG9uZyB0aW1lb3V0KQpA
QCAtOTUzLDI3ICs5NDAsMjAgQEAgaW50IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICB1bnNpZ25lZCBpbnQgZmxhZ3MsIGxvbmcgdGlt
ZW91dCkKIHsKIAkvKiBJZiB0aGUgZGV2aWNlIGlzIGFzbGVlcCwgd2UgaGF2ZSBubyByZXF1ZXN0
cyBvdXRzdGFuZGluZyAqLwotCWlmICghUkVBRF9PTkNFKGk5MTUtPmd0LmF3YWtlKSkKKwlpZiAo
IWludGVsX2d0X3BtX2lzX2F3YWtlKCZpOTE1LT5ndCkpCiAJCXJldHVybiAwOwogCi0JR0VNX1RS
QUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVsZCVzLCBhd2FrZT89JXNcbiIsCisJR0VNX1RS
QUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVsZCVzXG4iLAogCQkgIGZsYWdzLCBmbGFncyAm
IEk5MTVfV0FJVF9MT0NLRUQgPyAibG9ja2VkIiA6ICJ1bmxvY2tlZCIsCi0JCSAgdGltZW91dCwg
dGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9VVCA/ICIgKGZvcmV2ZXIpIiA6ICIiLAotCQkg
IHllc25vKGk5MTUtPmd0LmF3YWtlKSk7CisJCSAgdGltZW91dCwgdGltZW91dCA9PSBNQVhfU0NI
RURVTEVfVElNRU9VVCA/ICIgKGZvcmV2ZXIpIiA6ICIiKTsKIAogCXRpbWVvdXQgPSB3YWl0X2Zv
cl90aW1lbGluZXMoaTkxNSwgZmxhZ3MsIHRpbWVvdXQpOwogCWlmICh0aW1lb3V0IDwgMCkKIAkJ
cmV0dXJuIHRpbWVvdXQ7CiAKIAlpZiAoZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VEKSB7Ci0JCWlu
dCBlcnI7Ci0KIAkJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKLQkJZXJyID0gd2FpdF9mb3JfZW5naW5lcygmaTkxNS0+Z3QpOwotCQlpZiAoZXJyKQotCQkJ
cmV0dXJuIGVycjsKLQogCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKIAl9CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwppbmRleCAwNmJkOGIyMTVjYzIuLmQ0NDQzZTgxYzFj
OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwpAQCAtNCwyNSArNCwyNSBAQAog
ICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KICAqLwogCisjaW5jbHVkZSA8
bGludXgvd2FpdF9iaXQuaD4KKwogI2luY2x1ZGUgImludGVsX3J1bnRpbWVfcG0uaCIKICNpbmNs
dWRlICJpbnRlbF93YWtlcmVmLmgiCiAKLXN0YXRpYyB2b2lkIHJwbV9nZXQoc3RydWN0IGludGVs
X3J1bnRpbWVfcG0gKnJwbSwgc3RydWN0IGludGVsX3dha2VyZWYgKndmKQorc3RhdGljIHZvaWQg
cnBtX2dldChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7Ci0Jd2YtPndha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldChycG0pOworCXdmLT53YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQod2YtPnJwbSk7CiB9CiAKLXN0YXRpYyB2b2lkIHJwbV9wdXQoc3RydWN0IGludGVsX3J1bnRp
bWVfcG0gKnJwbSwgc3RydWN0IGludGVsX3dha2VyZWYgKndmKQorc3RhdGljIHZvaWQgcnBtX3B1
dChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWYg
PSBmZXRjaF9hbmRfemVybygmd2YtPndha2VyZWYpOwogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQo
cnBtLCB3YWtlcmVmKTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dCh3Zi0+cnBtLCB3YWtlcmVmKTsK
IAlJTlRFTF9XQUtFUkVGX0JVR19PTighd2FrZXJlZik7CiB9CiAKLWludCBfX2ludGVsX3dha2Vy
ZWZfZ2V0X2ZpcnN0KHN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpycG0sCi0JCQkgICAgICBzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCQkgICAgICBpbnQgKCpmbikoc3RydWN0IGludGVsX3dh
a2VyZWYgKndmKSkKK2ludCBfX2ludGVsX3dha2VyZWZfZ2V0X2ZpcnN0KHN0cnVjdCBpbnRlbF93
YWtlcmVmICp3ZikKIHsKIAkvKgogCSAqIFRyZWF0IGdldC9wdXQgYXMgZGlmZmVyZW50IHN1YmNs
YXNzZXMsIGFzIHdlIG1heSBuZWVkIHRvIHJ1bgpAQCAtMzQsMTEgKzM0LDExIEBAIGludCBfX2lu
dGVsX3dha2VyZWZfZ2V0X2ZpcnN0KHN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpycG0sCiAJaWYg
KCFhdG9taWNfcmVhZCgmd2YtPmNvdW50KSkgewogCQlpbnQgZXJyOwogCi0JCXJwbV9nZXQocnBt
LCB3Zik7CisJCXJwbV9nZXQod2YpOwogCi0JCWVyciA9IGZuKHdmKTsKKwkJZXJyID0gd2YtPm9w
cy0+Z2V0KHdmKTsKIAkJaWYgKHVubGlrZWx5KGVycikpIHsKLQkJCXJwbV9wdXQocnBtLCB3Zik7
CisJCQlycG1fcHV0KHdmKTsKIAkJCW11dGV4X3VubG9jaygmd2YtPm11dGV4KTsKIAkJCXJldHVy
biBlcnI7CiAJCX0KQEAgLTUyLDI3ICs1Miw2NyBAQCBpbnQgX19pbnRlbF93YWtlcmVmX2dldF9m
aXJzdChzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAogCXJldHVybiAwOwogfQogCi1pbnQg
X19pbnRlbF93YWtlcmVmX3B1dF9sYXN0KHN0cnVjdCBpbnRlbF9ydW50aW1lX3BtICpycG0sCi0J
CQkgICAgIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKLQkJCSAgICAgaW50ICgqZm4pKHN0cnVj
dCBpbnRlbF93YWtlcmVmICp3ZikpCitzdGF0aWMgdm9pZCBfX19faW50ZWxfd2FrZXJlZl9wdXRf
bGFzdChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7Ci0JaW50IGVycjsKKwlpZiAoIWF0b21p
Y19kZWNfYW5kX3Rlc3QoJndmLT5jb3VudCkpCisJCWdvdG8gdW5sb2NrOworCisJaWYgKGxpa2Vs
eSghd2YtPm9wcy0+cHV0KHdmKSkpIHsKKwkJcnBtX3B1dCh3Zik7CisJCXdha2VfdXBfdmFyKCZ3
Zi0+d2FrZXJlZik7CisJfSBlbHNlIHsKKwkJLyogb3BzLT5wdXQoKSBtdXN0IHNjaGVkdWxlIGl0
cyBvd24gcmVsZWFzZSBvbiBkZWZlcnJhbCAqLworCQlhdG9taWNfc2V0X3JlbGVhc2UoJndmLT5j
b3VudCwgMSk7CisJfQogCi0JZXJyID0gZm4od2YpOwotCWlmIChsaWtlbHkoIWVycikpCi0JCXJw
bV9wdXQocnBtLCB3Zik7Ci0JZWxzZQotCQlhdG9taWNfaW5jKCZ3Zi0+Y291bnQpOwordW5sb2Nr
OgogCW11dGV4X3VubG9jaygmd2YtPm11dGV4KTsKK30KKwordm9pZCBfX2ludGVsX3dha2VyZWZf
cHV0X2xhc3Qoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQoreworCUlOVEVMX1dBS0VSRUZfQlVH
X09OKHdvcmtfcGVuZGluZygmd2YtPndvcmspKTsKIAotCXJldHVybiBlcnI7CisJLyogQXNzdW1l
IHdlIGFyZSBub3QgaW4gcHJvY2VzcyBjb250ZXh0IGFuZCBzbyBjYW5ub3Qgc2xlZXAuICovCisJ
aWYgKHdmLT5vcHMtPmZsYWdzICYgSU5URUxfV0FLRVJFRl9QVVRfQVNZTkMgfHwKKwkgICAgIW11
dGV4X3RyeWxvY2soJndmLT5tdXRleCkpIHsKKwkJc2NoZWR1bGVfd29yaygmd2YtPndvcmspOwor
CQlyZXR1cm47CisJfQorCisJX19fX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qod2YpOwogfQogCi12
b2lkIF9faW50ZWxfd2FrZXJlZl9pbml0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3Ziwgc3RydWN0
IGxvY2tfY2xhc3Nfa2V5ICprZXkpCitzdGF0aWMgdm9pZCBfX2ludGVsX3dha2VyZWZfcHV0X3dv
cmsoc3RydWN0IHdvcmtfc3RydWN0ICp3cmspCiB7CisJc3RydWN0IGludGVsX3dha2VyZWYgKndm
ID0gY29udGFpbmVyX29mKHdyaywgdHlwZW9mKCp3ZiksIHdvcmspOworCisJaWYgKGF0b21pY19h
ZGRfdW5sZXNzKCZ3Zi0+Y291bnQsIC0xLCAxKSkKKwkJcmV0dXJuOworCisJbXV0ZXhfbG9jaygm
d2YtPm11dGV4KTsKKwlfX19faW50ZWxfd2FrZXJlZl9wdXRfbGFzdCh3Zik7Cit9CisKK3ZvaWQg
X19pbnRlbF93YWtlcmVmX2luaXQoc3RydWN0IGludGVsX3dha2VyZWYgKndmLAorCQkJICBzdHJ1
Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBtLAorCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJl
Zl9vcHMgKm9wcywKKwkJCSAgc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCit7CisJd2YtPnJw
bSA9IHJwbTsKKwl3Zi0+b3BzID0gb3BzOworCiAJX19tdXRleF9pbml0KCZ3Zi0+bXV0ZXgsICJ3
YWtlcmVmIiwga2V5KTsKIAlhdG9taWNfc2V0KCZ3Zi0+Y291bnQsIDApOwogCXdmLT53YWtlcmVm
ID0gMDsKKworCUlOSVRfV09SSygmd2YtPndvcmssIF9faW50ZWxfd2FrZXJlZl9wdXRfd29yayk7
Cit9CisKK2ludCBpbnRlbF93YWtlcmVmX3dhaXRfZm9yX2lkbGUoc3RydWN0IGludGVsX3dha2Vy
ZWYgKndmKQoreworCXJldHVybiB3YWl0X3Zhcl9ldmVudF9raWxsYWJsZSgmd2YtPndha2VyZWYs
CisJCQkJICAgICAgICFpbnRlbF93YWtlcmVmX2lzX2FjdGl2ZSh3ZikpOwogfQogCiBzdGF0aWMg
dm9pZCB3YWtlcmVmX2F1dG9fdGltZW91dChzdHJ1Y3QgdGltZXJfbGlzdCAqdCkKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3dha2VyZWYuaAppbmRleCAxZDZmNTk4NmU0ZTUuLjUzNWEzYTEyODY0YiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaApAQCAtOCwxMCArOCwxMiBAQAogI2Rl
ZmluZSBJTlRFTF9XQUtFUkVGX0gKIAogI2luY2x1ZGUgPGxpbnV4L2F0b21pYy5oPgorI2luY2x1
ZGUgPGxpbnV4L2JpdHMuaD4KICNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgogI2luY2x1ZGUgPGxp
bnV4L3JlZmNvdW50Lmg+CiAjaW5jbHVkZSA8bGludXgvc3RhY2tkZXBvdC5oPgogI2luY2x1ZGUg
PGxpbnV4L3RpbWVyLmg+CisjaW5jbHVkZSA8bGludXgvd29ya3F1ZXVlLmg+CiAKICNpZiBJU19F
TkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVRykKICNkZWZpbmUgSU5URUxfV0FLRVJFRl9CVUdf
T04oZXhwcikgQlVHX09OKGV4cHIpCkBAIC0yMCwyOSArMjIsNDIgQEAKICNlbmRpZgogCiBzdHJ1
Y3QgaW50ZWxfcnVudGltZV9wbTsKK3N0cnVjdCBpbnRlbF93YWtlcmVmOwogCiB0eXBlZGVmIGRl
cG90X3N0YWNrX2hhbmRsZV90IGludGVsX3dha2VyZWZfdDsKIAorc3RydWN0IGludGVsX3dha2Vy
ZWZfb3BzIHsKKwlpbnQgKCpnZXQpKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3Zik7CisJaW50ICgq
cHV0KShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpOworCisJdW5zaWduZWQgbG9uZyBmbGFnczsK
KyNkZWZpbmUgSU5URUxfV0FLRVJFRl9QVVRfQVNZTkMgQklUKDApCit9OworCiBzdHJ1Y3QgaW50
ZWxfd2FrZXJlZiB7CiAJYXRvbWljX3QgY291bnQ7CiAJc3RydWN0IG11dGV4IG11dGV4OworCiAJ
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisKKwlzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBt
OworCWNvbnN0IHN0cnVjdCBpbnRlbF93YWtlcmVmX29wcyAqb3BzOworCisJc3RydWN0IHdvcmtf
c3RydWN0IHdvcms7CiB9OwogCiB2b2lkIF9faW50ZWxfd2FrZXJlZl9pbml0KHN0cnVjdCBpbnRl
bF93YWtlcmVmICp3ZiwKKwkJCSAgc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKKwkJCSAg
Y29uc3Qgc3RydWN0IGludGVsX3dha2VyZWZfb3BzICpvcHMsCiAJCQkgIHN0cnVjdCBsb2NrX2Ns
YXNzX2tleSAqa2V5KTsKLSNkZWZpbmUgaW50ZWxfd2FrZXJlZl9pbml0KHdmKSBkbyB7CQkJCQlc
CisjZGVmaW5lIGludGVsX3dha2VyZWZfaW5pdCh3ZiwgcnBtLCBvcHMpIGRvIHsJCQkJXAogCXN0
YXRpYyBzdHJ1Y3QgbG9ja19jbGFzc19rZXkgX19rZXk7CQkJCVwKIAkJCQkJCQkJCVwKLQlfX2lu
dGVsX3dha2VyZWZfaW5pdCgod2YpLCAmX19rZXkpOwkJCQlcCisJX19pbnRlbF93YWtlcmVmX2lu
aXQoKHdmKSwgKHJwbSksIChvcHMpLCAmX19rZXkpOwkJXAogfSB3aGlsZSAoMCkKIAotaW50IF9f
aW50ZWxfd2FrZXJlZl9nZXRfZmlyc3Qoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJ
CSAgICAgIHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZiwKLQkJCSAgICAgIGludCAoKmZuKShzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YpKTsKLWludCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3Ry
dWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJCSAgICAgc3RydWN0IGludGVsX3dha2VyZWYg
KndmLAotCQkJICAgICBpbnQgKCpmbikoc3RydWN0IGludGVsX3dha2VyZWYgKndmKSk7CitpbnQg
X19pbnRlbF93YWtlcmVmX2dldF9maXJzdChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpOwordm9p
ZCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3dha2VyZWYgKndmKTsKIAog
LyoqCiAgKiBpbnRlbF93YWtlcmVmX2dldDogQWNxdWlyZSB0aGUgd2FrZXJlZgpAQCAtNjEsMTIg
Kzc2LDEwIEBAIGludCBfX2ludGVsX3dha2VyZWZfcHV0X2xhc3Qoc3RydWN0IGludGVsX3J1bnRp
bWVfcG0gKnJwbSwKICAqIGNvZGUgb3RoZXJ3aXNlLgogICovCiBzdGF0aWMgaW5saW5lIGludAot
aW50ZWxfd2FrZXJlZl9nZXQoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJwbSwKLQkJICBzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCSAgaW50ICgqZm4pKHN0cnVjdCBpbnRlbF93YWtlcmVm
ICp3ZikpCitpbnRlbF93YWtlcmVmX2dldChzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CiAJ
aWYgKHVubGlrZWx5KCFhdG9taWNfaW5jX25vdF96ZXJvKCZ3Zi0+Y291bnQpKSkKLQkJcmV0dXJu
IF9faW50ZWxfd2FrZXJlZl9nZXRfZmlyc3QocnBtLCB3ZiwgZm4pOworCQlyZXR1cm4gX19pbnRl
bF93YWtlcmVmX2dldF9maXJzdCh3Zik7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTEwMiwxNiArMTE1
LDEyIEBAIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZShzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAq
d2YpCiAgKiBSZXR1cm5zOiAwIGlmIHRoZSB3YWtlcmVmIHdhcyByZWxlYXNlZCBzdWNjZXNzZnVs
bHksIG9yIGEgbmVnYXRpdmUgZXJyb3IKICAqIGNvZGUgb3RoZXJ3aXNlLgogICovCi1zdGF0aWMg
aW5saW5lIGludAotaW50ZWxfd2FrZXJlZl9wdXQoc3RydWN0IGludGVsX3J1bnRpbWVfcG0gKnJw
bSwKLQkJICBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YsCi0JCSAgaW50ICgqZm4pKHN0cnVjdCBp
bnRlbF93YWtlcmVmICp3ZikpCitzdGF0aWMgaW5saW5lIHZvaWQKK2ludGVsX3dha2VyZWZfcHV0
KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIHsKIAlJTlRFTF9XQUtFUkVGX0JVR19PTihhdG9t
aWNfcmVhZCgmd2YtPmNvdW50KSA8PSAwKTsKLQlpZiAoYXRvbWljX2RlY19hbmRfbXV0ZXhfbG9j
aygmd2YtPmNvdW50LCAmd2YtPm11dGV4KSkKLQkJcmV0dXJuIF9faW50ZWxfd2FrZXJlZl9wdXRf
bGFzdChycG0sIHdmLCBmbik7Ci0KLQlyZXR1cm4gMDsKKwlpZiAodW5saWtlbHkoIWF0b21pY19h
ZGRfdW5sZXNzKCZ3Zi0+Y291bnQsIC0xLCAxKSkpCisJCV9faW50ZWxfd2FrZXJlZl9wdXRfbGFz
dCh3Zik7CiB9CiAKIC8qKgpAQCAtMTU0LDYgKzE2MywxOSBAQCBpbnRlbF93YWtlcmVmX2lzX2Fj
dGl2ZShjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIFJFQURfT05DRSh3
Zi0+d2FrZXJlZik7CiB9CiAKKy8qKgorICogaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlOiBX
YWl0IHVudGlsIHRoZSB3YWtlcmVmIGlzIGlkbGUKKyAqIEB3ZjogdGhlIHdha2VyZWYKKyAqCisg
KiBXYWl0IGZvciB0aGUgZWFybGllciBhc3luY2hyb25vdXMgcmVsZWFzZSBvZiB0aGUgd2FrZXJl
Zi4gTm90ZQorICogdGhpcyB3aWxsIHdhaXQgZm9yIGFueSB0aGlyZCBwYXJ0eSBhcyB3ZWxsLCBz
byBtYWtlIHN1cmUgeW91IG9ubHkgd2FpdAorICogd2hlbiB5b3UgaGF2ZSBjb250cm9sIG92ZXIg
dGhlIHdha2VyZWYgYW5kIHRydXN0IG5vIG9uZSBlbHNlIGlzIGFjcXVpcmluZworICogaXQuCisg
KgorICogUmV0dXJuOiAwIG9uIHN1Y2Nlc3MsIGVycm9yIGNvZGUgaWYga2lsbGVkLgorICovCitp
bnQgaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3Zik7
CisKIHN0cnVjdCBpbnRlbF93YWtlcmVmX2F1dG8gewogCXN0cnVjdCBpbnRlbF9ydW50aW1lX3Bt
ICpycG07CiAJc3RydWN0IHRpbWVyX2xpc3QgdGltZXI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAppbmRleCBhODQxZDNmOWJl
ZGMuLjFjY2YwZjczMWFjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCkBAIC0xMiwxMCArMTIsMTEgQEAKIHNlbGZ0ZXN0
KHNhbml0eWNoZWNrLCBpOTE1X2xpdmVfc2FuaXR5Y2hlY2spIC8qIGtlZXAgZmlyc3QgKGlndCBz
ZWxmY2hlY2spICovCiBzZWxmdGVzdCh1bmNvcmUsIGludGVsX3VuY29yZV9saXZlX3NlbGZ0ZXN0
cykKIHNlbGZ0ZXN0KHdvcmthcm91bmRzLCBpbnRlbF93b3JrYXJvdW5kc19saXZlX3NlbGZ0ZXN0
cykKLXNlbGZ0ZXN0KHRpbWVsaW5lcywgaW50ZWxfdGltZWxpbmVfbGl2ZV9zZWxmdGVzdHMpCitz
ZWxmdGVzdChndF9lbmdpbmVzLCBpbnRlbF9lbmdpbmVfbGl2ZV9zZWxmdGVzdHMpCitzZWxmdGVz
dChndF90aW1lbGluZXMsIGludGVsX3RpbWVsaW5lX2xpdmVfc2VsZnRlc3RzKQorc2VsZnRlc3Qo
Z3RfY29udGV4dHMsIGludGVsX2NvbnRleHRfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChyZXF1
ZXN0cywgaTkxNV9yZXF1ZXN0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoYWN0aXZlLCBpOTE1
X2FjdGl2ZV9saXZlX3NlbGZ0ZXN0cykKLXNlbGZ0ZXN0KGd0X2NvbnRleHRzLCBpbnRlbF9jb250
ZXh0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3Qob2JqZWN0cywgaTkxNV9nZW1fb2JqZWN0X2xp
dmVfc2VsZnRlc3RzKQogc2VsZnRlc3QobW1hbiwgaTkxNV9nZW1fbW1hbl9saXZlX3NlbGZ0ZXN0
cykKIHNlbGZ0ZXN0KGRtYWJ1ZiwgaTkxNV9nZW1fZG1hYnVmX2xpdmVfc2VsZnRlc3RzKQotLSAK
Mi4yMy4wLnJjMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

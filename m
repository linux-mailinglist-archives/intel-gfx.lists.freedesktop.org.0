Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E5A78323F31
	for <lists+intel-gfx@lfdr.de>; Wed, 24 Feb 2021 15:42:32 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 319B06EACF;
	Wed, 24 Feb 2021 14:42:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 598616EAD1
 for <intel-gfx@lists.freedesktop.org>; Wed, 24 Feb 2021 14:42:29 +0000 (UTC)
IronPort-SDR: pOAN0nHpnGo8d3g02VU4QZhZmgLMdueDv47LHBF19PbxLpkirFgGEz6mqrWGanC2lQ02ao3rPm
 vLmZFOjm1f4Q==
X-IronPort-AV: E=McAfee;i="6000,8403,9904"; a="270149288"
X-IronPort-AV: E=Sophos;i="5.81,203,1610438400"; d="scan'208";a="270149288"
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga105.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 24 Feb 2021 06:42:28 -0800
IronPort-SDR: hF1h6Q9R/EGjkvwLd1mTxkaEG3GeGV79jETwVU0OBDZdHvpNJbTvnCbT04xd4dTS/Fw03C8V7v
 jv83GiII7kIA==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.81,203,1610438400"; d="scan'208";a="433541465"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.171])
 by fmsmga002.fm.intel.com with SMTP; 24 Feb 2021 06:42:26 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Wed, 24 Feb 2021 16:42:26 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 24 Feb 2021 16:42:12 +0200
Message-Id: <20210224144214.24803-5-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20210224144214.24803-1-ville.syrjala@linux.intel.com>
References: <20210224144214.24803-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/6] drm/i915: Move DDI clock readout to
 encoder->get_config()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCk1v
dmUgdGhlICpfZ2V0X2RkaV9wbGwoKSBzdHVmZiBpbnRvIHRoZSBlbmNvZGV0LT5nZXRfY29uZmln
KCkgaG9vay4KVGhlcmUgaXQgbmVhdGx5IHNpdHMgbmV4dCB0byB0aGUgbWF0Y2hpbmcgLntlbmFi
bGUsZGlzYWJsZX1fY2xvY2soKQpmdW5jdGlvbnMuCgpJbiBvcmRlciB0byBhdm9pZCBleGNlc3Np
dmUgYm9pbGVycGxhdGUgSSBjaGFuZ2VkIHRoZSBiZWhhdmlvdXIKc3VjaCB0aGF0IGFsbCBwbGF0
Zm9ybXMgbm93IGRvIHRoZSByZWFkb3V0IHZpYQpjcnRjX3N0YXRlLT5wb3J0X2RwbGxbXS4KCklD
TCsgVEMgaXMgc3RpbGwgYSBiaXQgc3BlY2lhbCBkdWUgdG8gVEJUUExMIG5vdCBoYXZpbmcgYSBm
dW5jdGlvbmFsCi5nZXRfZnJlcSgpLiBTaG91bGQgcHJvYmFibHkgY2hhbmdlIHRoYXQgYnkgYWRv
cHRpbmcgdGhlIExDUExMCmFwcHJvYWNoLCBidXQgdGhhdCB3b3VsZCByZXF1aXJlIGEgZmFpcmx5
IHN1YnN0YW50aWFsIHJld29yayBvZiB0aGUKRFBMTCBJRCBoYW5kbGluZy4gU28gbGVhdmUgaXQg
Zm9yIGxhdGVyLgoKU2lnbmVkLW9mZi1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxh
QGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9k
c2kuYyAgICAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9j
cnQuYyAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRp
LmMgICAgIHwgMzIxICsrKysrKysrKysrKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGRpLmggICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYyB8IDIxOSAtLS0tLS0tLS0tLS0tCiA1IGZpbGVzIGNoYW5nZWQs
IDMwNiBpbnNlcnRpb25zKCspLCAyNTAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ljbF9kc2kuYwppbmRleCAwNWQ1NzA5YWU1MzcuLjI5ZmU0OTE5MzkyYSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pY2xfZHNpLmMKQEAgLTE0OTAsMTQgKzE0OTAsMTAgQEAg
c3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dldF9jbWRfbW9kZV9jb25maWcoc3RydWN0IGludGVsX2Rz
aSAqaW50ZWxfZHNpLAogc3RhdGljIHZvaWQgZ2VuMTFfZHNpX2dldF9jb25maWcoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBl
X2NvbmZpZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5j
b2Rlci0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhwaXBlX2NvbmZpZy0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2kg
PSBlbmNfdG9faW50ZWxfZHNpKGVuY29kZXIpOwogCi0JLyogRklYTUU6IGFkYXB0IGljbF9kZGlf
Y2xvY2tfZ2V0KCkgZm9yIERTSSBhbmQgdXNlIHRoYXQ/ICovCi0JcGlwZV9jb25maWctPnBvcnRf
Y2xvY2sgPSBpbnRlbF9kcGxsX2dldF9mcmVxKGk5MTUsCi0JCQkJCQkgICAgICBwaXBlX2NvbmZp
Zy0+c2hhcmVkX2RwbGwsCi0JCQkJCQkgICAgICAmcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUp
OworCWludGVsX2RkaV9nZXRfY2xvY2soZW5jb2RlciwgcGlwZV9jb25maWcsIGljbF9kZGlfY29t
Ym9fZ2V0X3BsbChlbmNvZGVyKSk7CiAKIAlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX2Nsb2NrID0gaW50ZWxfZHNpLT5wY2xrOwogCWlmIChpbnRlbF9kc2ktPmR1YWxfbGluaykK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5jCmluZGV4IDkxYThhNDJiNGFh
Mi4uYjAzZjc0MDc2ZjY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2NydC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0
LmMKQEAgLTE0Miw3ICsxNDIsNyBAQCBzdGF0aWMgdm9pZCBoc3dfY3J0X2dldF9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CiAKLQlpbnRlbF9kZGlfZ2V0
X2NvbmZpZyhlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CisJaHN3X2RkaV9nZXRfY29uZmlnKGVuY29k
ZXIsIHBpcGVfY29uZmlnKTsKIAogCXBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdz
ICY9IH4oRFJNX01PREVfRkxBR19QSFNZTkMgfAogCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX05I
U1lOQyB8CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rk
aS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwppbmRleCBlZWFl
NzgwOTdhMjAuLjU2ZjVmNTVhN2M4ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kZGkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RkaS5jCkBAIC0zMDQsMjUgKzMwNCw2IEBAIHN0YXRpYyB2b2lkIGRkaV9kb3RjbG9ja19n
ZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCXBpcGVfY29uZmlnLT5o
dy5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2sgPSBkb3RjbG9jazsKIH0KIAotc3RhdGljIHZvaWQg
aW50ZWxfZGRpX2Nsb2NrX2dldChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKLQkJCQlz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCi17Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7Ci0JZW51bSBw
aHkgcGh5ID0gaW50ZWxfcG9ydF90b19waHkoZGV2X3ByaXYsIGVuY29kZXItPnBvcnQpOwotCi0J
aWYgKGludGVsX3BoeV9pc190YyhkZXZfcHJpdiwgcGh5KSAmJgotCSAgICBpbnRlbF9nZXRfc2hh
cmVkX2RwbGxfaWQoZGV2X3ByaXYsIHBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCkgPT0KLQkgICAg
RFBMTF9JRF9JQ0xfVEJUUExMKQotCQlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayA9IGljbF9jYWxj
X3RidF9wbGxfbGluayhkZXZfcHJpdiwKLQkJCQkJCQkJZW5jb2Rlci0+cG9ydCk7Ci0JZWxzZQot
CQlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayA9Ci0JCQlpbnRlbF9kcGxsX2dldF9mcmVxKGRldl9w
cml2LCBwaXBlX2NvbmZpZy0+c2hhcmVkX2RwbGwsCi0JCQkJCSAgICAmcGlwZV9jb25maWctPmRw
bGxfaHdfc3RhdGUpOwotCi0JZGRpX2RvdGNsb2NrX2dldChwaXBlX2NvbmZpZyk7Ci19Ci0KIHZv
aWQgaW50ZWxfZGRpX3NldF9kcF9tc2EoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQkgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0
YXRlKQogewpAQCAtMTYwOCw2ICsxNTg5LDE3IEBAIHN0YXRpYyB2b2lkIF9jbmxfZGRpX2Rpc2Fi
bGVfY2xvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGk5MTVfcmVnX3QgcmVnCiAJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcGxsLmxvY2spOwogfQogCitzdGF0aWMgc3RydWN0IGludGVs
X3NoYXJlZF9kcGxsICoKK19jbmxfZGRpX2dldF9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIGk5MTVfcmVnX3QgcmVnLAorCQkgdTMyIGNsa19zZWxfbWFzaywgdTMyIGNsa19zZWxf
c2hpZnQpCit7CisJZW51bSBpbnRlbF9kcGxsX2lkIGlkOworCisJaWQgPSAoaW50ZWxfZGVfcmVh
ZChpOTE1LCByZWcpICYgY2xrX3NlbF9tYXNrKSA+PiBjbGtfc2VsX3NoaWZ0OworCisJcmV0dXJu
IGludGVsX2dldF9zaGFyZWRfZHBsbF9ieV9pZChpOTE1LCBpZCk7Cit9CisKIHN0YXRpYyB2b2lk
IGFkbHNfZGRpX2VuYWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJ
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewpAQCAtMTYz
Myw2ICsxNjI1LDE2IEBAIHN0YXRpYyB2b2lkIGFkbHNfZGRpX2Rpc2FibGVfY2xvY2soc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJCQkgICAgICAgSUNMX0RQQ0xLQV9DRkdDUjBfRERJ
X0NMS19PRkYocGh5KSk7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKmFk
bHNfZGRpX2dldF9wbGwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCit7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwll
bnVtIHBoeSBwaHkgPSBpbnRlbF9wb3J0X3RvX3BoeShpOTE1LCBlbmNvZGVyLT5wb3J0KTsKKwor
CXJldHVybiBfY25sX2RkaV9nZXRfcGxsKGk5MTUsIEFETFNfRFBDTEtBX0NGR0NSKHBoeSksCisJ
CQkJQURMU19EUENMS0FfQ0ZHQ1JfRERJX0NMS19TRUxfTUFTSyhwaHkpLAorCQkJCUFETFNfRFBD
TEtBX0NGR0NSX0RESV9TSElGVChwaHkpKTsKK30KKwogc3RhdGljIHZvaWQgcmtsX2RkaV9lbmFi
bGVfY2xvY2soc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewpAQCAtMTY1OCw2ICsxNjYwLDE2IEBA
IHN0YXRpYyB2b2lkIHJrbF9kZGlfZGlzYWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlcikKIAkJCSAgICAgICBSS0xfRFBDTEtBX0NGR0NSMF9ERElfQ0xLX09GRihwaHkpKTsK
IH0KIAorc3RhdGljIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcmtsX2RkaV9nZXRfcGxsKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJZW51bSBwaHkgcGh5ID0gaW50
ZWxfcG9ydF90b19waHkoaTkxNSwgZW5jb2Rlci0+cG9ydCk7CisKKwlyZXR1cm4gX2NubF9kZGlf
Z2V0X3BsbChpOTE1LCBJQ0xfRFBDTEtBX0NGR0NSMCwKKwkJCQlSS0xfRFBDTEtBX0NGR0NSMF9E
RElfQ0xLX1NFTF9NQVNLKHBoeSksCisJCQkJUktMX0RQQ0xLQV9DRkdDUjBfRERJX0NMS19TRUxf
U0hJRlQocGh5KSk7Cit9CisKIHN0YXRpYyB2b2lkIGRnMV9kZGlfZW5hYmxlX2Nsb2NrKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKQEAgLTE2OTIsNiArMTcwNCwxNiBAQCBzdGF0aWMgdm9pZCBk
ZzFfZGRpX2Rpc2FibGVfY2xvY2soc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJCQkg
ICAgICAgREcxX0RQQ0xLQV9DRkdDUjBfRERJX0NMS19PRkYocGh5KSk7CiB9CiAKK3N0YXRpYyBz
dHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKmRnMV9kZGlfZ2V0X3BsbChzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlcikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5
MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5
KGk5MTUsIGVuY29kZXItPnBvcnQpOworCisJcmV0dXJuIF9jbmxfZGRpX2dldF9wbGwoaTkxNSwg
REcxX0RQQ0xLQV9DRkdDUjAocGh5KSwKKwkJCQlERzFfRFBDTEtBX0NGR0NSMF9ERElfQ0xLX1NF
TF9NQVNLKHBoeSksCisJCQkJREcxX0RQQ0xLQV9DRkdDUjBfRERJX0NMS19TRUxfU0hJRlQocGh5
KSk7Cit9CisKIHN0YXRpYyB2b2lkIGljbF9kZGlfY29tYm9fZW5hYmxlX2Nsb2NrKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKQEAgLTE3MTcsNiArMTczOSwxNiBAQCBzdGF0aWMgdm9p
ZCBpY2xfZGRpX2NvbWJvX2Rpc2FibGVfY2xvY2soc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIpCiAJCQkgICAgICAgSUNMX0RQQ0xLQV9DRkdDUjBfRERJX0NMS19PRkYocGh5KSk7CiB9CiAK
K3N0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqaWNsX2RkaV9jb21ib19nZXRfcGxsKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJZW51bSBwaHkgcGh5ID0gaW50ZWxfcG9y
dF90b19waHkoaTkxNSwgZW5jb2Rlci0+cG9ydCk7CisKKwlyZXR1cm4gX2NubF9kZGlfZ2V0X3Bs
bChpOTE1LCBJQ0xfRFBDTEtBX0NGR0NSMCwKKwkJCQlJQ0xfRFBDTEtBX0NGR0NSMF9ERElfQ0xL
X1NFTF9NQVNLKHBoeSksCisJCQkJSUNMX0RQQ0xLQV9DRkdDUjBfRERJX0NMS19TRUxfU0hJRlQo
cGh5KSk7Cit9CisKIHN0YXRpYyB2b2lkIGpzbF9kZGlfdGNfZW5hYmxlX2Nsb2NrKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKQEAgLTE3ODQsNiArMTgxNiwzNiBAQCBzdGF0aWMgdm9pZCBp
Y2xfZGRpX3RjX2Rpc2FibGVfY2xvY2soc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJ
aW50ZWxfZGVfd3JpdGUoaTkxNSwgRERJX0NMS19TRUwocG9ydCksIERESV9DTEtfU0VMX05PTkUp
OwogfQogCitzdGF0aWMgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICppY2xfZGRpX3RjX2dldF9w
bGwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwllbnVtIHRjX3BvcnQg
dGNfcG9ydCA9IGludGVsX3BvcnRfdG9fdGMoaTkxNSwgZW5jb2Rlci0+cG9ydCk7CisJZW51bSBw
b3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OworCWVudW0gaW50ZWxfZHBsbF9pZCBpZDsKKwl1MzIg
dG1wOworCisJdG1wID0gaW50ZWxfZGVfcmVhZChpOTE1LCBERElfQ0xLX1NFTChwb3J0KSk7CisK
Kwlzd2l0Y2ggKHRtcCAmIERESV9DTEtfU0VMX01BU0spIHsKKwljYXNlIERESV9DTEtfU0VMX1RC
VF8xNjI6CisJY2FzZSBERElfQ0xLX1NFTF9UQlRfMjcwOgorCWNhc2UgRERJX0NMS19TRUxfVEJU
XzU0MDoKKwljYXNlIERESV9DTEtfU0VMX1RCVF84MTA6CisJCWlkID0gRFBMTF9JRF9JQ0xfVEJU
UExMOworCQlicmVhazsKKwljYXNlIERESV9DTEtfU0VMX01HOgorCQlpZCA9IGljbF90Y19wb3J0
X3RvX3BsbF9pZCh0Y19wb3J0KTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNF
KHRtcCk7CisJCWZhbGx0aHJvdWdoOworCWNhc2UgRERJX0NMS19TRUxfTk9ORToKKwkJcmV0dXJu
IE5VTEw7CisJfQorCisJcmV0dXJuIGludGVsX2dldF9zaGFyZWRfZHBsbF9ieV9pZChpOTE1LCBp
ZCk7Cit9CisKIHN0YXRpYyB2b2lkIGNubF9kZGlfZW5hYmxlX2Nsb2NrKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKQEAgLTE4MDksNiArMTg3MSwzOSBAQCBzdGF0aWMgdm9pZCBjbmxfZGRpX2Rp
c2FibGVfY2xvY2soc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJCQkgICAgICAgRFBD
TEtBX0NGR0NSMF9ERElfQ0xLX09GRihwb3J0KSk7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxf
c2hhcmVkX2RwbGwgKmNubF9kZGlfZ2V0X3BsbChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
cikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rlci0+
YmFzZS5kZXYpOworCWVudW0gcG9ydCBwb3J0ID0gZW5jb2Rlci0+cG9ydDsKKworCXJldHVybiBf
Y25sX2RkaV9nZXRfcGxsKGk5MTUsIERQQ0xLQV9DRkdDUjAsCisJCQkJRFBDTEtBX0NGR0NSMF9E
RElfQ0xLX1NFTF9NQVNLKHBvcnQpLAorCQkJCURQQ0xLQV9DRkdDUjBfRERJX0NMS19TRUxfU0hJ
RlQocG9ydCkpOworfQorCitzdGF0aWMgc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpieHRfZGRp
X2dldF9wbGwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCit7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwllbnVtIGlu
dGVsX2RwbGxfaWQgaWQ7CisKKwlzd2l0Y2ggKGVuY29kZXItPnBvcnQpIHsKKwljYXNlIFBPUlRf
QToKKwkJaWQgPSBEUExMX0lEX1NLTF9EUExMMDsKKwkJYnJlYWs7CisJY2FzZSBQT1JUX0I6CisJ
CWlkID0gRFBMTF9JRF9TS0xfRFBMTDE7CisJCWJyZWFrOworCWNhc2UgUE9SVF9DOgorCQlpZCA9
IERQTExfSURfU0tMX0RQTEwyOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0Uo
ZW5jb2Rlci0+cG9ydCk7CisJCXJldHVybiBOVUxMOworCX0KKworCXJldHVybiBpbnRlbF9nZXRf
c2hhcmVkX2RwbGxfYnlfaWQoaTkxNSwgaWQpOworfQorCiBzdGF0aWMgdm9pZCBza2xfZGRpX2Vu
YWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkgY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CkBAIC0xODQzLDYgKzE5MzgsMjgg
QEAgc3RhdGljIHZvaWQgc2tsX2RkaV9kaXNhYmxlX2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyKQogCW11dGV4X3VubG9jaygmaTkxNS0+ZHBsbC5sb2NrKTsKIH0KIAorc3RhdGlj
IHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqc2tsX2RkaV9nZXRfcGxsKHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0
OworCWVudW0gaW50ZWxfZHBsbF9pZCBpZDsKKwl1MzIgdG1wOworCisJdG1wID0gaW50ZWxfZGVf
cmVhZChpOTE1LCBEUExMX0NUUkwyKTsKKworCS8qCisJICogRklYTUUgTm90IHN1cmUgaWYgdGhl
IG92ZXJyaWRlIGFmZmVjdHMgYm90aAorCSAqIHRoZSBQTEwgc2VsZWN0aW9uIGFuZCB0aGUgQ0xL
X09GRiBiaXQuCisJICovCisJaWYgKCh0bXAgJiBEUExMX0NUUkwyX0RESV9TRUxfT1ZFUlJJREUo
cG9ydCkpID09IDApCisJCXJldHVybiBOVUxMOworCisJaWQgPSAodG1wICYgRFBMTF9DVFJMMl9E
RElfQ0xLX1NFTF9NQVNLKHBvcnQpKSA+PgorCQlEUExMX0NUUkwyX0RESV9DTEtfU0VMX1NISUZU
KHBvcnQpOworCisJcmV0dXJuIGludGVsX2dldF9zaGFyZWRfZHBsbF9ieV9pZChpOTE1LCBpZCk7
Cit9CisKIHZvaWQgaHN3X2RkaV9lbmFibGVfY2xvY2soc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewpAQCAtMTg2NCw2ICsxOTgxLDQ0IEBAIHZvaWQgaHN3X2RkaV9kaXNhYmxlX2Nsb2NrKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCWludGVsX2RlX3dyaXRlKGk5MTUsIFBPUlRfQ0xL
X1NFTChwb3J0KSwgUE9SVF9DTEtfU0VMX05PTkUpOwogfQogCitzdGF0aWMgc3RydWN0IGludGVs
X3NoYXJlZF9kcGxsICpoc3dfZGRpX2dldF9wbGwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXIt
PmJhc2UuZGV2KTsKKwllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CisJZW51bSBpbnRl
bF9kcGxsX2lkIGlkOworCXUzMiB0bXA7CisKKwl0bXAgPSBpbnRlbF9kZV9yZWFkKGk5MTUsIFBP
UlRfQ0xLX1NFTChwb3J0KSk7CisKKwlzd2l0Y2ggKHRtcCAmIFBPUlRfQ0xLX1NFTF9NQVNLKSB7
CisJY2FzZSBQT1JUX0NMS19TRUxfV1JQTEwxOgorCQlpZCA9IERQTExfSURfV1JQTEwxOworCQli
cmVhazsKKwljYXNlIFBPUlRfQ0xLX1NFTF9XUlBMTDI6CisJCWlkID0gRFBMTF9JRF9XUlBMTDI7
CisJCWJyZWFrOworCWNhc2UgUE9SVF9DTEtfU0VMX1NQTEw6CisJCWlkID0gRFBMTF9JRF9TUExM
OworCQlicmVhazsKKwljYXNlIFBPUlRfQ0xLX1NFTF9MQ1BMTF84MTA6CisJCWlkID0gRFBMTF9J
RF9MQ1BMTF84MTA7CisJCWJyZWFrOworCWNhc2UgUE9SVF9DTEtfU0VMX0xDUExMXzEzNTA6CisJ
CWlkID0gRFBMTF9JRF9MQ1BMTF8xMzUwOworCQlicmVhazsKKwljYXNlIFBPUlRfQ0xLX1NFTF9M
Q1BMTF8yNzAwOgorCQlpZCA9IERQTExfSURfTENQTExfMjcwMDsKKwkJYnJlYWs7CisJZGVmYXVs
dDoKKwkJTUlTU0lOR19DQVNFKHRtcCk7CisJCWZhbGx0aHJvdWdoOworCWNhc2UgUE9SVF9DTEtf
U0VMX05PTkU6CisJCXJldHVybiBOVUxMOworCX0KKworCXJldHVybiBpbnRlbF9nZXRfc2hhcmVk
X2RwbGxfYnlfaWQoaTkxNSwgaWQpOworfQorCiB2b2lkIGludGVsX2RkaV9lbmFibGVfY2xvY2so
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CkBAIC0zMjkzLDggKzM0NDgsOCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9kZGlfcmVhZF9mdW5jX2N0bChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKIAl9CiB9CiAKLXZvaWQgaW50ZWxfZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCi0JCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykK
K3N0YXRpYyB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLAorCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNl
LmRldik7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gcGlwZV9jb25maWctPmNw
dV90cmFuc2NvZGVyOwpAQCAtMzM0MSw3ICszNDk2LDcgQEAgdm9pZCBpbnRlbF9kZGlfZ2V0X2Nv
bmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAl9CiAKIAlpZiAoIXBpcGVfY29u
ZmlnLT5iaWdqb2luZXJfc2xhdmUpCi0JCWludGVsX2RkaV9jbG9ja19nZXQoZW5jb2RlciwgcGlw
ZV9jb25maWcpOworCQlkZGlfZG90Y2xvY2tfZ2V0KHBpcGVfY29uZmlnKTsKIAogCWlmIChJU19H
RU45X0xQKGRldl9wcml2KSkKIAkJcGlwZV9jb25maWctPmxhbmVfbGF0X29wdGltX21hc2sgPQpA
QCAtMzM3MSw2ICszNTI2LDExNCBAQCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWludGVsX3JlYWRfZHBfc2RwKGVuY29kZXIsIHBpcGVf
Y29uZmlnLCBEUF9TRFBfVlNDKTsKIH0KIAordm9pZCBpbnRlbF9kZGlfZ2V0X2Nsb2NrKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAorCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAorCQkJIHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJ
ZW51bSBpY2xfcG9ydF9kcGxsX2lkIHBvcnRfZHBsbF9pZCA9IElDTF9QT1JUX0RQTExfREVGQVVM
VDsKKwlzdHJ1Y3QgaWNsX3BvcnRfZHBsbCAqcG9ydF9kcGxsID0gJmNydGNfc3RhdGUtPmljbF9w
b3J0X2RwbGxzW3BvcnRfZHBsbF9pZF07CisJYm9vbCBwbGxfYWN0aXZlOworCisJcG9ydF9kcGxs
LT5wbGwgPSBwbGw7CisJcGxsX2FjdGl2ZSA9IGludGVsX2RwbGxfZ2V0X2h3X3N0YXRlKGk5MTUs
IHBsbCwgJnBvcnRfZHBsbC0+aHdfc3RhdGUpOworCWRybV9XQVJOX09OKCZpOTE1LT5kcm0sICFw
bGxfYWN0aXZlKTsKKworCWljbF9zZXRfYWN0aXZlX3BvcnRfZHBsbChjcnRjX3N0YXRlLCBwb3J0
X2RwbGxfaWQpOworCisJY3J0Y19zdGF0ZS0+cG9ydF9jbG9jayA9IGludGVsX2RwbGxfZ2V0X2Zy
ZXEoaTkxNSwgY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwsCisJCQkJCQkgICAgICZjcnRjX3N0YXRl
LT5kcGxsX2h3X3N0YXRlKTsKK30KKworc3RhdGljIHZvaWQgYWRsc19kZGlfZ2V0X2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKK3sKKwlpbnRlbF9kZGlfZ2V0X2Nsb2NrKGVuY29kZXIsIGNydGNfc3Rh
dGUsIGFkbHNfZGRpX2dldF9wbGwoZW5jb2RlcikpOworCWludGVsX2RkaV9nZXRfY29uZmlnKGVu
Y29kZXIsIGNydGNfc3RhdGUpOworfQorCitzdGF0aWMgdm9pZCBya2xfZGRpX2dldF9jb25maWco
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkgICAgICAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaW50ZWxfZGRpX2dldF9jbG9jayhlbmNvZGVyLCBj
cnRjX3N0YXRlLCBya2xfZGRpX2dldF9wbGwoZW5jb2RlcikpOworCWludGVsX2RkaV9nZXRfY29u
ZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworfQorCitzdGF0aWMgdm9pZCBkZzFfZGRpX2dldF9j
b25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkgICAgICAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaW50ZWxfZGRpX2dldF9jbG9jayhlbmNv
ZGVyLCBjcnRjX3N0YXRlLCBkZzFfZGRpX2dldF9wbGwoZW5jb2RlcikpOworCWludGVsX2RkaV9n
ZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworfQorCitzdGF0aWMgdm9pZCBpY2xfZGRp
X2NvbWJvX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJICAg
ICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlpbnRlbF9kZGlfZ2V0
X2Nsb2NrKGVuY29kZXIsIGNydGNfc3RhdGUsIGljbF9kZGlfY29tYm9fZ2V0X3BsbChlbmNvZGVy
KSk7CisJaW50ZWxfZGRpX2dldF9jb25maWcoZW5jb2RlciwgY3J0Y19zdGF0ZSk7Cit9CisKK3N0
YXRpYyB2b2lkIGljbF9kZGlfdGNfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKKwkJCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7
CisJZW51bSBpY2xfcG9ydF9kcGxsX2lkIHBvcnRfZHBsbF9pZDsKKwlzdHJ1Y3QgaWNsX3BvcnRf
ZHBsbCAqcG9ydF9kcGxsOworCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsOworCWJvb2wg
cGxsX2FjdGl2ZTsKKworCXBsbCA9IGljbF9kZGlfdGNfZ2V0X3BsbChlbmNvZGVyKTsKKworCWlm
IChpbnRlbF9nZXRfc2hhcmVkX2RwbGxfaWQoaTkxNSwgcGxsKSA9PSBEUExMX0lEX0lDTF9UQlRQ
TEwpCisJCXBvcnRfZHBsbF9pZCA9IElDTF9QT1JUX0RQTExfREVGQVVMVDsKKwllbHNlCisJCXBv
cnRfZHBsbF9pZCA9IElDTF9QT1JUX0RQTExfTUdfUEhZOworCisJcG9ydF9kcGxsID0gJmNydGNf
c3RhdGUtPmljbF9wb3J0X2RwbGxzW3BvcnRfZHBsbF9pZF07CisKKwlwb3J0X2RwbGwtPnBsbCA9
IHBsbDsKKwlwbGxfYWN0aXZlID0gaW50ZWxfZHBsbF9nZXRfaHdfc3RhdGUoaTkxNSwgcGxsLCAm
cG9ydF9kcGxsLT5od19zdGF0ZSk7CisJZHJtX1dBUk5fT04oJmk5MTUtPmRybSwgIXBsbF9hY3Rp
dmUpOworCisJaWNsX3NldF9hY3RpdmVfcG9ydF9kcGxsKGNydGNfc3RhdGUsIHBvcnRfZHBsbF9p
ZCk7CisKKwlpZiAoaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2lkKGk5MTUsIGNydGNfc3RhdGUtPnNo
YXJlZF9kcGxsKSA9PSBEUExMX0lEX0lDTF9UQlRQTEwpCisJCWNydGNfc3RhdGUtPnBvcnRfY2xv
Y2sgPSBpY2xfY2FsY190YnRfcGxsX2xpbmsoaTkxNSwgZW5jb2Rlci0+cG9ydCk7CisJZWxzZQor
CQljcnRjX3N0YXRlLT5wb3J0X2Nsb2NrID0gaW50ZWxfZHBsbF9nZXRfZnJlcShpOTE1LCBjcnRj
X3N0YXRlLT5zaGFyZWRfZHBsbCwKKwkJCQkJCQkgICAgICZjcnRjX3N0YXRlLT5kcGxsX2h3X3N0
YXRlKTsKKworCWludGVsX2RkaV9nZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworfQor
CitzdGF0aWMgdm9pZCBjbmxfZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCisJCQkgICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7
CisJaW50ZWxfZGRpX2dldF9jbG9jayhlbmNvZGVyLCBjcnRjX3N0YXRlLCBjbmxfZGRpX2dldF9w
bGwoZW5jb2RlcikpOworCWludGVsX2RkaV9nZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUp
OworfQorCitzdGF0aWMgdm9pZCBieHRfZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCisJCQkgICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUpCit7CisJaW50ZWxfZGRpX2dldF9jbG9jayhlbmNvZGVyLCBjcnRjX3N0YXRlLCBieHRfZGRp
X2dldF9wbGwoZW5jb2RlcikpOworCWludGVsX2RkaV9nZXRfY29uZmlnKGVuY29kZXIsIGNydGNf
c3RhdGUpOworfQorCitzdGF0aWMgdm9pZCBza2xfZGRpX2dldF9jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCisJCQkgICAgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCit7CisJaW50ZWxfZGRpX2dldF9jbG9jayhlbmNvZGVyLCBjcnRjX3N0YXRlLCBz
a2xfZGRpX2dldF9wbGwoZW5jb2RlcikpOworCWludGVsX2RkaV9nZXRfY29uZmlnKGVuY29kZXIs
IGNydGNfc3RhdGUpOworfQorCit2b2lkIGhzd19kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciwKKwkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQoreworCWludGVsX2RkaV9nZXRfY2xvY2soZW5jb2RlciwgY3J0Y19zdGF0ZSwgaHN3X2RkaV9n
ZXRfcGxsKGVuY29kZXIpKTsKKwlpbnRlbF9kZGlfZ2V0X2NvbmZpZyhlbmNvZGVyLCBjcnRjX3N0
YXRlKTsKK30KKwogc3RhdGljIHZvaWQgaW50ZWxfZGRpX3N5bmNfc3RhdGUoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogewpAQCAtNDA1Nyw3ICs0MzIwLDYgQEAgdm9pZCBpbnRlbF9kZGlfaW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQogCWVuY29k
ZXItPnBvc3RfZGlzYWJsZSA9IGludGVsX2RkaV9wb3N0X2Rpc2FibGU7CiAJZW5jb2Rlci0+dXBk
YXRlX3BpcGUgPSBpbnRlbF9kZGlfdXBkYXRlX3BpcGU7CiAJZW5jb2Rlci0+Z2V0X2h3X3N0YXRl
ID0gaW50ZWxfZGRpX2dldF9od19zdGF0ZTsKLQllbmNvZGVyLT5nZXRfY29uZmlnID0gaW50ZWxf
ZGRpX2dldF9jb25maWc7CiAJZW5jb2Rlci0+c3luY19zdGF0ZSA9IGludGVsX2RkaV9zeW5jX3N0
YXRlOwogCWVuY29kZXItPmluaXRpYWxfZmFzdHNldF9jaGVjayA9IGludGVsX2RkaV9pbml0aWFs
X2Zhc3RzZXRfY2hlY2s7CiAJZW5jb2Rlci0+c3VzcGVuZCA9IGludGVsX2RwX2VuY29kZXJfc3Vz
cGVuZDsKQEAgLTQwNzMsMzcgKzQzMzUsNTAgQEAgdm9pZCBpbnRlbF9kZGlfaW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQogCWlmIChJU19BTERF
UkxBS0VfUyhkZXZfcHJpdikpIHsKIAkJZW5jb2Rlci0+ZW5hYmxlX2Nsb2NrID0gYWRsc19kZGlf
ZW5hYmxlX2Nsb2NrOwogCQllbmNvZGVyLT5kaXNhYmxlX2Nsb2NrID0gYWRsc19kZGlfZGlzYWJs
ZV9jbG9jazsKKwkJZW5jb2Rlci0+Z2V0X2NvbmZpZyA9IGFkbHNfZGRpX2dldF9jb25maWc7CiAJ
fSBlbHNlIGlmIChJU19ST0NLRVRMQUtFKGRldl9wcml2KSkgewogCQllbmNvZGVyLT5lbmFibGVf
Y2xvY2sgPSBya2xfZGRpX2VuYWJsZV9jbG9jazsKIAkJZW5jb2Rlci0+ZGlzYWJsZV9jbG9jayA9
IHJrbF9kZGlfZGlzYWJsZV9jbG9jazsKKwkJZW5jb2Rlci0+Z2V0X2NvbmZpZyA9IHJrbF9kZGlf
Z2V0X2NvbmZpZzsKIAl9IGVsc2UgaWYgKElTX0RHMShkZXZfcHJpdikpIHsKIAkJZW5jb2Rlci0+
ZW5hYmxlX2Nsb2NrID0gZGcxX2RkaV9lbmFibGVfY2xvY2s7CiAJCWVuY29kZXItPmRpc2FibGVf
Y2xvY2sgPSBkZzFfZGRpX2Rpc2FibGVfY2xvY2s7CisJCWVuY29kZXItPmdldF9jb25maWcgPSBk
ZzFfZGRpX2dldF9jb25maWc7CiAJfSBlbHNlIGlmIChJU19KU0xfRUhMKGRldl9wcml2KSkgewog
CQlpZiAoaW50ZWxfZGRpX2lzX3RjKGRldl9wcml2LCBwb3J0KSkgewogCQkJZW5jb2Rlci0+ZW5h
YmxlX2Nsb2NrID0ganNsX2RkaV90Y19lbmFibGVfY2xvY2s7CiAJCQllbmNvZGVyLT5kaXNhYmxl
X2Nsb2NrID0ganNsX2RkaV90Y19kaXNhYmxlX2Nsb2NrOworCQkJZW5jb2Rlci0+Z2V0X2NvbmZp
ZyA9IGljbF9kZGlfY29tYm9fZ2V0X2NvbmZpZzsKIAkJfSBlbHNlIHsKIAkJCWVuY29kZXItPmVu
YWJsZV9jbG9jayA9IGljbF9kZGlfY29tYm9fZW5hYmxlX2Nsb2NrOwogCQkJZW5jb2Rlci0+ZGlz
YWJsZV9jbG9jayA9IGljbF9kZGlfY29tYm9fZGlzYWJsZV9jbG9jazsKKwkJCWVuY29kZXItPmdl
dF9jb25maWcgPSBpY2xfZGRpX2NvbWJvX2dldF9jb25maWc7CiAJCX0KIAl9IGVsc2UgaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKIAkJaWYgKGludGVsX2RkaV9pc190YyhkZXZfcHJp
diwgcG9ydCkpIHsKIAkJCWVuY29kZXItPmVuYWJsZV9jbG9jayA9IGljbF9kZGlfdGNfZW5hYmxl
X2Nsb2NrOwogCQkJZW5jb2Rlci0+ZGlzYWJsZV9jbG9jayA9IGljbF9kZGlfdGNfZGlzYWJsZV9j
bG9jazsKKwkJCWVuY29kZXItPmdldF9jb25maWcgPSBpY2xfZGRpX3RjX2dldF9jb25maWc7CiAJ
CX0gZWxzZSB7CiAJCQllbmNvZGVyLT5lbmFibGVfY2xvY2sgPSBpY2xfZGRpX2NvbWJvX2VuYWJs
ZV9jbG9jazsKIAkJCWVuY29kZXItPmRpc2FibGVfY2xvY2sgPSBpY2xfZGRpX2NvbWJvX2Rpc2Fi
bGVfY2xvY2s7CisJCQllbmNvZGVyLT5nZXRfY29uZmlnID0gaWNsX2RkaV9jb21ib19nZXRfY29u
ZmlnOwogCQl9CiAJfSBlbHNlIGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSkgewogCQllbmNv
ZGVyLT5lbmFibGVfY2xvY2sgPSBjbmxfZGRpX2VuYWJsZV9jbG9jazsKIAkJZW5jb2Rlci0+ZGlz
YWJsZV9jbG9jayA9IGNubF9kZGlfZGlzYWJsZV9jbG9jazsKKwkJZW5jb2Rlci0+Z2V0X2NvbmZp
ZyA9IGNubF9kZGlfZ2V0X2NvbmZpZzsKKwl9IGVsc2UgaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYp
KSB7CisJCS8qIEJYVC9HTEsgaGF2ZSBmaXhlZCBQTEwtPnBvcnQgbWFwcGluZyAqLworCQllbmNv
ZGVyLT5nZXRfY29uZmlnID0gYnh0X2RkaV9nZXRfY29uZmlnOwogCX0gZWxzZSBpZiAoSVNfR0VO
OV9CQyhkZXZfcHJpdikpIHsKIAkJZW5jb2Rlci0+ZW5hYmxlX2Nsb2NrID0gc2tsX2RkaV9lbmFi
bGVfY2xvY2s7CiAJCWVuY29kZXItPmRpc2FibGVfY2xvY2sgPSBza2xfZGRpX2Rpc2FibGVfY2xv
Y2s7CisJCWVuY29kZXItPmdldF9jb25maWcgPSBza2xfZGRpX2dldF9jb25maWc7CiAJfSBlbHNl
IGlmIChJU19CUk9BRFdFTEwoZGV2X3ByaXYpIHx8IElTX0hBU1dFTEwoZGV2X3ByaXYpKSB7CiAJ
CWVuY29kZXItPmVuYWJsZV9jbG9jayA9IGhzd19kZGlfZW5hYmxlX2Nsb2NrOwogCQllbmNvZGVy
LT5kaXNhYmxlX2Nsb2NrID0gaHN3X2RkaV9kaXNhYmxlX2Nsb2NrOworCQllbmNvZGVyLT5nZXRf
Y29uZmlnID0gaHN3X2RkaV9nZXRfY29uZmlnOwogCX0KIAogCWlmIChJU19ERzEoZGV2X3ByaXYp
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmgKaW5kZXggNGEwYzFkNWM4
NWU3Li4wNzgwYzQ3ZWZlMGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGRpLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
ZGkuaApAQCAtMzAsOSArMzAsMTUgQEAgdm9pZCBpbnRlbF9kZGlfZmRpX3Bvc3RfZGlzYWJsZShz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQljb25zdCBzdHJ1Y3QgZHJtX2Nv
bm5lY3Rvcl9zdGF0ZSAqb2xkX2Nvbm5fc3RhdGUpOwogdm9pZCBpbnRlbF9kZGlfZW5hYmxlX2Ns
b2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKK3ZvaWQgaW50ZWxfZGRpX2dldF9jbG9jayhz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKKwkJCSBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCk7CiB2b2lk
IGhzd19kZGlfZW5hYmxlX2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJ
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiB2b2lkIGhzd19k
ZGlfZGlzYWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rlcik7Cit2b2lkIGhz
d19kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCXN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKK3N0cnVjdCBpbnRlbF9zaGFyZWRfZHBs
bCAqaWNsX2RkaV9jb21ib19nZXRfcGxsKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKTsK
IHZvaWQgaW50ZWxfcHJlcGFyZV9kcF9kZGlfYnVmZmVycyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAkJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KTsKIHZvaWQgaW50ZWxfd2FpdF9kZGlfYnVmX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LApAQCAtNDgsOCArNTQsNiBAQCB2b2lkIGludGVsX2RkaV9kaXNhYmxlX3BpcGVf
Y2xvY2soY29uc3QgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHZvaWQg
aW50ZWxfZGRpX3NldF9kcF9tc2EoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCQkgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRl
KTsKIGJvb2wgaW50ZWxfZGRpX2Nvbm5lY3Rvcl9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2Nv
bm5lY3RvciAqaW50ZWxfY29ubmVjdG9yKTsKLXZvaWQgaW50ZWxfZGRpX2dldF9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCi0JCQkgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZyk7CiB2b2lkIGludGVsX2RkaV9zZXRfdmNfcGF5bG9hZF9hbGxvYyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgYm9vbCBzdGF0
ZSk7CiB2b2lkIGludGVsX2RkaV9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMKaW5kZXggOTU4YzJhNzk2YmFlLi44YjVjYjgxNGI2NzkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC02NTIzLDIxMiAr
NjUyMyw2IEBAIHN0YXRpYyBib29sIGlsa19nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgZGcxX2dldF9kZGlfcGxs
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQsCi0JCQkg
ICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQotewotCWVudW0gaWNsX3Bv
cnRfZHBsbF9pZCBwb3J0X2RwbGxfaWQgPSBJQ0xfUE9SVF9EUExMX0RFRkFVTFQ7Ci0JZW51bSBw
aHkgcGh5ID0gaW50ZWxfcG9ydF90b19waHkoZGV2X3ByaXYsIHBvcnQpOwotCXN0cnVjdCBpY2xf
cG9ydF9kcGxsICpwb3J0X2RwbGw7Ci0Jc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGw7Ci0J
ZW51bSBpbnRlbF9kcGxsX2lkIGlkOwotCWJvb2wgcGxsX2FjdGl2ZTsKLQl1MzIgY2xrX3NlbDsK
LQotCWNsa19zZWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBERzFfRFBDTEtBX0NGR0NSMChw
aHkpKSAmIERHMV9EUENMS0FfQ0ZHQ1IwX0RESV9DTEtfU0VMX01BU0socGh5KTsKLQlpZCA9IERH
MV9EUENMS0FfQ0ZHQ1IwX0RESV9DTEtfU0VMX0RQTExfTUFQKGNsa19zZWwsIHBoeSk7Ci0KLQlp
ZiAoV0FSTl9PTihpZCA+IERQTExfSURfREcxX0RQTEwzKSkKLQkJcmV0dXJuOwotCi0JcGxsID0g
aW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lkKGRldl9wcml2LCBpZCk7Ci0JcG9ydF9kcGxsID0g
JnBpcGVfY29uZmlnLT5pY2xfcG9ydF9kcGxsc1twb3J0X2RwbGxfaWRdOwotCi0JcG9ydF9kcGxs
LT5wbGwgPSBwbGw7Ci0JcGxsX2FjdGl2ZSA9IGludGVsX2RwbGxfZ2V0X2h3X3N0YXRlKGRldl9w
cml2LCBwbGwsCi0JCQkJCSAgICAgJnBvcnRfZHBsbC0+aHdfc3RhdGUpOwotCWRybV9XQVJOX09O
KCZkZXZfcHJpdi0+ZHJtLCAhcGxsX2FjdGl2ZSk7Ci0KLQlpY2xfc2V0X2FjdGl2ZV9wb3J0X2Rw
bGwocGlwZV9jb25maWcsIHBvcnRfZHBsbF9pZCk7Ci19Ci0KLXN0YXRpYyB2b2lkIGljbF9nZXRf
ZGRpX3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0
LAotCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKLXsKLQllbnVt
IHBoeSBwaHkgPSBpbnRlbF9wb3J0X3RvX3BoeShkZXZfcHJpdiwgcG9ydCk7Ci0JZW51bSBpY2xf
cG9ydF9kcGxsX2lkIHBvcnRfZHBsbF9pZDsKLQlzdHJ1Y3QgaWNsX3BvcnRfZHBsbCAqcG9ydF9k
cGxsOwotCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsOwotCWVudW0gaW50ZWxfZHBsbF9p
ZCBpZDsKLQlib29sIHBsbF9hY3RpdmU7Ci0JaTkxNV9yZWdfdCByZWc7Ci0JdTMyIHRlbXA7Ci0K
LQlpZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKSB7Ci0JCXUzMiBtYXNrLCBz
aGlmdDsKLQotCQlpZiAoSVNfQUxERVJMQUtFX1MoZGV2X3ByaXYpKSB7Ci0JCQlyZWcgPSBBRExT
X0RQQ0xLQV9DRkdDUihwaHkpOwotCQkJbWFzayA9IEFETFNfRFBDTEtBX0NGR0NSX0RESV9DTEtf
U0VMX01BU0socGh5KTsKLQkJCXNoaWZ0ID0gQURMU19EUENMS0FfQ0ZHQ1JfRERJX1NISUZUKHBo
eSk7Ci0JCX0gZWxzZSBpZiAoSVNfUk9DS0VUTEFLRShkZXZfcHJpdikpIHsKLQkJCXJlZyA9IElD
TF9EUENMS0FfQ0ZHQ1IwOwotCQkJbWFzayA9IFJLTF9EUENMS0FfQ0ZHQ1IwX0RESV9DTEtfU0VM
X01BU0socGh5KTsKLQkJCXNoaWZ0ID0gUktMX0RQQ0xLQV9DRkdDUjBfRERJX0NMS19TRUxfU0hJ
RlQocGh5KTsKLQkJfSBlbHNlIHsKLQkJCXJlZyA9IElDTF9EUENMS0FfQ0ZHQ1IwOwotCQkJbWFz
ayA9IElDTF9EUENMS0FfQ0ZHQ1IwX0RESV9DTEtfU0VMX01BU0socGh5KTsKLQkJCXNoaWZ0ID0g
SUNMX0RQQ0xLQV9DRkdDUjBfRERJX0NMS19TRUxfU0hJRlQocGh5KTsKLQkJfQotCi0JCXRlbXAg
PSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCByZWcpICYgbWFzazsKLQkJaWQgPSB0ZW1wID4+IHNo
aWZ0OwotCQlwb3J0X2RwbGxfaWQgPSBJQ0xfUE9SVF9EUExMX0RFRkFVTFQ7Ci0JfSBlbHNlIGlm
IChpbnRlbF9waHlfaXNfdGMoZGV2X3ByaXYsIHBoeSkpIHsKLQkJdTMyIGNsa19zZWwgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBERElfQ0xLX1NFTChwb3J0KSkgJiBERElfQ0xLX1NFTF9NQVNL
OwotCi0JCWlmIChjbGtfc2VsID09IERESV9DTEtfU0VMX01HKSB7Ci0JCQlpZCA9IGljbF90Y19w
b3J0X3RvX3BsbF9pZChpbnRlbF9wb3J0X3RvX3RjKGRldl9wcml2LAotCQkJCQkJCQkgICAgcG9y
dCkpOwotCQkJcG9ydF9kcGxsX2lkID0gSUNMX1BPUlRfRFBMTF9NR19QSFk7Ci0JCX0gZWxzZSB7
Ci0JCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwKLQkJCQkgICAgY2xrX3NlbCA8IERESV9D
TEtfU0VMX1RCVF8xNjIpOwotCQkJaWQgPSBEUExMX0lEX0lDTF9UQlRQTEw7Ci0JCQlwb3J0X2Rw
bGxfaWQgPSBJQ0xfUE9SVF9EUExMX0RFRkFVTFQ7Ci0JCX0KLQl9IGVsc2UgewotCQlkcm1fV0FS
TigmZGV2X3ByaXYtPmRybSwgMSwgIkludmFsaWQgcG9ydCAleFxuIiwgcG9ydCk7Ci0JCXJldHVy
bjsKLQl9Ci0KLQlwbGwgPSBpbnRlbF9nZXRfc2hhcmVkX2RwbGxfYnlfaWQoZGV2X3ByaXYsIGlk
KTsKLQlwb3J0X2RwbGwgPSAmcGlwZV9jb25maWctPmljbF9wb3J0X2RwbGxzW3BvcnRfZHBsbF9p
ZF07Ci0KLQlwb3J0X2RwbGwtPnBsbCA9IHBsbDsKLQlwbGxfYWN0aXZlID0gaW50ZWxfZHBsbF9n
ZXRfaHdfc3RhdGUoZGV2X3ByaXYsIHBsbCwKLQkJCQkJICAgICAmcG9ydF9kcGxsLT5od19zdGF0
ZSk7Ci0JZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICFwbGxfYWN0aXZlKTsKLQotCWljbF9z
ZXRfYWN0aXZlX3BvcnRfZHBsbChwaXBlX2NvbmZpZywgcG9ydF9kcGxsX2lkKTsKLX0KLQotc3Rh
dGljIHZvaWQgY25sX2dldF9kZGlfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgZW51bSBwb3J0IHBvcnQsCi0JCQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnKQotewotCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsOwotCWVudW0gaW50ZWxf
ZHBsbF9pZCBpZDsKLQlib29sIHBsbF9hY3RpdmU7Ci0JdTMyIHRlbXA7Ci0KLQl0ZW1wID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwgRFBDTEtBX0NGR0NSMCkgJiBEUENMS0FfQ0ZHQ1IwX0RESV9D
TEtfU0VMX01BU0socG9ydCk7Ci0JaWQgPSB0ZW1wID4+IERQQ0xLQV9DRkdDUjBfRERJX0NMS19T
RUxfU0hJRlQocG9ydCk7Ci0KLQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGlkIDwg
U0tMX0RQTEwwIHx8IGlkID4gU0tMX0RQTEwyKSkKLQkJcmV0dXJuOwotCi0JcGxsID0gaW50ZWxf
Z2V0X3NoYXJlZF9kcGxsX2J5X2lkKGRldl9wcml2LCBpZCk7Ci0KLQlwaXBlX2NvbmZpZy0+c2hh
cmVkX2RwbGwgPSBwbGw7Ci0JcGxsX2FjdGl2ZSA9IGludGVsX2RwbGxfZ2V0X2h3X3N0YXRlKGRl
dl9wcml2LCBwbGwsCi0JCQkJCSAgICAgJnBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlKTsKLQlk
cm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgIXBsbF9hY3RpdmUpOwotfQotCi1zdGF0aWMgdm9p
ZCBieHRfZ2V0X2RkaV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJ
CWVudW0gcG9ydCBwb3J0LAotCQkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZykKLXsKLQlzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbDsKLQllbnVtIGludGVsX2RwbGxf
aWQgaWQ7Ci0JYm9vbCBwbGxfYWN0aXZlOwotCi0Jc3dpdGNoIChwb3J0KSB7Ci0JY2FzZSBQT1JU
X0E6Ci0JCWlkID0gRFBMTF9JRF9TS0xfRFBMTDA7Ci0JCWJyZWFrOwotCWNhc2UgUE9SVF9COgot
CQlpZCA9IERQTExfSURfU0tMX0RQTEwxOwotCQlicmVhazsKLQljYXNlIFBPUlRfQzoKLQkJaWQg
PSBEUExMX0lEX1NLTF9EUExMMjsKLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJZHJtX2VycigmZGV2
X3ByaXYtPmRybSwgIkluY29ycmVjdCBwb3J0IHR5cGVcbiIpOwotCQlyZXR1cm47Ci0JfQotCi0J
cGxsID0gaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lkKGRldl9wcml2LCBpZCk7Ci0KLQlwaXBl
X2NvbmZpZy0+c2hhcmVkX2RwbGwgPSBwbGw7Ci0JcGxsX2FjdGl2ZSA9IGludGVsX2RwbGxfZ2V0
X2h3X3N0YXRlKGRldl9wcml2LCBwbGwsCi0JCQkJCSAgICAgJnBpcGVfY29uZmlnLT5kcGxsX2h3
X3N0YXRlKTsKLQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgIXBsbF9hY3RpdmUpOwotfQot
Ci1zdGF0aWMgdm9pZCBza2xfZ2V0X2RkaV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHBvcnQgcG9ydCwKLQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcpCi17Ci0Jc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGw7Ci0JZW51bSBp
bnRlbF9kcGxsX2lkIGlkOwotCWJvb2wgcGxsX2FjdGl2ZTsKLQl1MzIgdGVtcDsKLQotCXRlbXAg
PSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBEUExMX0NUUkwyKSAmIERQTExfQ1RSTDJfRERJX0NM
S19TRUxfTUFTSyhwb3J0KTsKLQlpZCA9IHRlbXAgPj4gKHBvcnQgKiAzICsgMSk7Ci0KLQlpZiAo
ZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGlkIDwgU0tMX0RQTEwwIHx8IGlkID4gU0tMX0RQ
TEwzKSkKLQkJcmV0dXJuOwotCi0JcGxsID0gaW50ZWxfZ2V0X3NoYXJlZF9kcGxsX2J5X2lkKGRl
dl9wcml2LCBpZCk7Ci0KLQlwaXBlX2NvbmZpZy0+c2hhcmVkX2RwbGwgPSBwbGw7Ci0JcGxsX2Fj
dGl2ZSA9IGludGVsX2RwbGxfZ2V0X2h3X3N0YXRlKGRldl9wcml2LCBwbGwsCi0JCQkJCSAgICAg
JnBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlKTsKLQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRy
bSwgIXBsbF9hY3RpdmUpOwotfQotCi1zdGF0aWMgdm9pZCBoc3dfZ2V0X2RkaV9wbGwoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCwKLQkJCSAgICBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCi17Ci0Jc3RydWN0IGludGVsX3NoYXJl
ZF9kcGxsICpwbGw7Ci0JZW51bSBpbnRlbF9kcGxsX2lkIGlkOwotCXUzMiBkZGlfcGxsX3NlbCA9
IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBPUlRfQ0xLX1NFTChwb3J0KSk7Ci0JYm9vbCBwbGxf
YWN0aXZlOwotCi0Jc3dpdGNoIChkZGlfcGxsX3NlbCkgewotCWNhc2UgUE9SVF9DTEtfU0VMX1dS
UExMMToKLQkJaWQgPSBEUExMX0lEX1dSUExMMTsKLQkJYnJlYWs7Ci0JY2FzZSBQT1JUX0NMS19T
RUxfV1JQTEwyOgotCQlpZCA9IERQTExfSURfV1JQTEwyOwotCQlicmVhazsKLQljYXNlIFBPUlRf
Q0xLX1NFTF9TUExMOgotCQlpZCA9IERQTExfSURfU1BMTDsKLQkJYnJlYWs7Ci0JY2FzZSBQT1JU
X0NMS19TRUxfTENQTExfODEwOgotCQlpZCA9IERQTExfSURfTENQTExfODEwOwotCQlicmVhazsK
LQljYXNlIFBPUlRfQ0xLX1NFTF9MQ1BMTF8xMzUwOgotCQlpZCA9IERQTExfSURfTENQTExfMTM1
MDsKLQkJYnJlYWs7Ci0JY2FzZSBQT1JUX0NMS19TRUxfTENQTExfMjcwMDoKLQkJaWQgPSBEUExM
X0lEX0xDUExMXzI3MDA7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShkZGlf
cGxsX3NlbCk7Ci0JCWZhbGx0aHJvdWdoOwotCWNhc2UgUE9SVF9DTEtfU0VMX05PTkU6Ci0JCXJl
dHVybjsKLQl9Ci0KLQlwbGwgPSBpbnRlbF9nZXRfc2hhcmVkX2RwbGxfYnlfaWQoZGV2X3ByaXYs
IGlkKTsKLQotCXBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCA9IHBsbDsKLQlwbGxfYWN0aXZlID0g
aW50ZWxfZHBsbF9nZXRfaHdfc3RhdGUoZGV2X3ByaXYsIHBsbCwKLQkJCQkJICAgICAmcGlwZV9j
b25maWctPmRwbGxfaHdfc3RhdGUpOwotCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhcGxs
X2FjdGl2ZSk7Ci19Ci0KIHN0YXRpYyBib29sIGhzd19nZXRfdHJhbnNjb2Rlcl9zdGF0ZShzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpw
aXBlX2NvbmZpZywKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbl9z
ZXQgKnBvd2VyX2RvbWFpbl9zZXQpCkBAIC02ODg1LDE5ICs2Njc5LDYgQEAgc3RhdGljIHZvaWQg
aHN3X2dldF9kZGlfcG9ydF9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCXBvcnQg
PSBUUkFOU19ERElfRlVOQ19DVExfVkFMX1RPX1BPUlQodG1wKTsKIAl9CiAKLQlpZiAoSVNfREcx
KGRldl9wcml2KSkKLQkJZGcxX2dldF9kZGlfcGxsKGRldl9wcml2LCBwb3J0LCBwaXBlX2NvbmZp
Zyk7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKLQkJaWNsX2dldF9kZGlf
cGxsKGRldl9wcml2LCBwb3J0LCBwaXBlX2NvbmZpZyk7Ci0JZWxzZSBpZiAoSVNfQ0FOTk9OTEFL
RShkZXZfcHJpdikpCi0JCWNubF9nZXRfZGRpX3BsbChkZXZfcHJpdiwgcG9ydCwgcGlwZV9jb25m
aWcpOwotCWVsc2UgaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQotCQlieHRfZ2V0X2RkaV9wbGwo
ZGV2X3ByaXYsIHBvcnQsIHBpcGVfY29uZmlnKTsKLQllbHNlIGlmIChJU19HRU45X0JDKGRldl9w
cml2KSkKLQkJc2tsX2dldF9kZGlfcGxsKGRldl9wcml2LCBwb3J0LCBwaXBlX2NvbmZpZyk7Ci0J
ZWxzZQotCQloc3dfZ2V0X2RkaV9wbGwoZGV2X3ByaXYsIHBvcnQsIHBpcGVfY29uZmlnKTsKLQog
CS8qCiAJICogSGFzd2VsbCBoYXMgb25seSBGREkvUENIIHRyYW5zY29kZXIgQS4gSXQgaXMgd2hp
Y2ggaXMgY29ubmVjdGVkIHRvCiAJICogRERJIEUuIFNvIGp1c3QgY2hlY2sgd2hldGhlciB0aGlz
IHBpcGUgaXMgd2lyZWQgdG8gRERJIEUgYW5kIHdoZXRoZXIKLS0gCjIuMjYuMgoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcg
bGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

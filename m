Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5EC41FCA89
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 17:05:38 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8F97B6EC15;
	Thu, 14 Nov 2019 16:05:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2A5FC6EBCF
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Nov 2019 16:05:27 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Nov 2019 17:05:18 +0100
Message-Id: <20191114160522.9699-7-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
References: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/11] drm/i915: Make hardware readout work on
 i915.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VW5mb3J0dW5hdGVseSBJIGhhdmUgbm8gd2F5IHRvIHRlc3QgdGhpcywgYnV0IGl0IHNob3VsZCBi
ZSBjb3JyZWN0CmlmIHRoZSBiaW9zIHNldHMgdXAgYmlnam9pbmVyIGluIGEgc2FuZSB3YXkuCgpT
a2lwIGl0ZXJhdGluZyBvdmVyIGJpZ2pvaW5lciBzbGF2ZXMsIG9ubHkgdGhlIG1hc3RlciBoYXMg
dGhlIHN0YXRlIHdlCmNhcmUgYWJvdXQuCgpBZGQgdGhlIHdpZHRoIG9mIHRoZSBiaWdqb2luZXIg
c2xhdmUgdG8gdGhlIHJlY29uc3RydWN0ZWQgZmIuCgpIaWRlIHRoZSBiaWdqb2luZXIgc2xhdmUg
dG8gdXNlcnNwYWNlLCBhbmQgZG91YmxlIHRoZSBtb2RlIG9uIGJpZ2pvaW5lcgptYXN0ZXIuCgpB
bmQgbGFzdCwgZGlzYWJsZSBiaWdqb2luZXIgc2xhdmUgZnJvbSBwcmltYXJ5IGlmIHJlY29uc3Ry
dWN0aW9uIGZhaWxzLgoKU2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4u
bGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYyB8IDY1ICsrKysrKysrKysrKysrKysrKystCiAxIGZpbGUgY2hh
bmdlZCwgNjMgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDk0ZTRjYWIwMGE2Ni4uYjEwODVl
ZjNmMWQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YwpAQCAtMzIzMSw2ICszMjMxLDggQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3Bs
YW5lID0gdG9faW50ZWxfcGxhbmUocHJpbWFyeSk7CiAJc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICppbnRlbF9zdGF0ZSA9CiAJCXRvX2ludGVsX3BsYW5lX3N0YXRlKHBsYW5lX3N0YXRlKTsKKwlz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CisJCXRvX2ludGVsX2NydGNfc3Rh
dGUoaW50ZWxfY3J0Yy0+YmFzZS5zdGF0ZSk7CiAJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7
CiAKIAlpZiAoIXBsYW5lX2NvbmZpZy0+ZmIpCkBAIC0zMjUzLDcgKzMyNTUsNyBAQCBpbnRlbF9m
aW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQlp
ZiAoYyA9PSAmaW50ZWxfY3J0Yy0+YmFzZSkKIAkJCWNvbnRpbnVlOwogCi0JCWlmICghdG9faW50
ZWxfY3J0YyhjKS0+YWN0aXZlKQorCQlpZiAoIXRvX2ludGVsX2NydGNfc3RhdGUoYy0+c3RhdGUp
LT51YXBpLmFjdGl2ZSkKIAkJCWNvbnRpbnVlOwogCiAJCXN0YXRlID0gdG9faW50ZWxfcGxhbmVf
c3RhdGUoYy0+cHJpbWFyeS0+c3RhdGUpOwpAQCAtMzI3NSw2ICszMjc3LDEyIEBAIGludGVsX2Zp
bmRfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJICog
cHJldGVuZCB0aGUgQklPUyBuZXZlciBoYWQgaXQgZW5hYmxlZC4KIAkgKi8KIAlpbnRlbF9wbGFu
ZV9kaXNhYmxlX25vYXRvbWljKGludGVsX2NydGMsIGludGVsX3BsYW5lKTsKKwlpZiAoY3J0Y19z
dGF0ZS0+Ymlnam9pbmVyKSB7CisJCXN0cnVjdCBpbnRlbF9jcnRjICpzbGF2ZSA9CisJCQljcnRj
X3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisKKwkJaW50ZWxfcGxhbmVfZGlzYWJsZV9u
b2F0b21pYyhzbGF2ZSwgdG9faW50ZWxfcGxhbmUoc2xhdmUtPmJhc2UucHJpbWFyeSkpOworCX0K
IAogCXJldHVybjsKIApAQCAtMTAwNzgsNiArMTAwODYsNyBAQCBzdGF0aWMgdm9pZAogc2t5bGFr
ZV9nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJ
IHN0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyAqcGxhbmVfY29uZmlnKQogeworCXN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShj
cnRjLT5iYXNlLnN0YXRlKTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5k
ZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwog
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShjcnRjLT5iYXNlLnBy
aW1hcnkpOwpAQCAtMTAxODEsNiArMTAxOTAsMTggQEAgc2t5bGFrZV9nZXRfaW5pdGlhbF9wbGFu
ZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJZmItPmhlaWdodCA9ICgodmFsID4+
IDE2KSAmIDB4ZmZmZikgKyAxOwogCWZiLT53aWR0aCA9ICgodmFsID4+IDApICYgMHhmZmZmKSAr
IDE7CiAKKwkvKiBhZGQgYmlnam9pbmVyIHNsYXZlIGFzIHdlbGwsIGlmIHRoZSBmYiBzdHJldGNo
ZXMgYm90aCAqLworCWlmIChjcnRjX3N0YXRlLT5iaWdqb2luZXIpIHsKKwkJZW51bSBwaXBlIGJp
Z2pvaW5lcl9waXBlID0gY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjLT5waXBlOwor
CisJCWlmIChmYi0+d2lkdGggPT0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfdyAmJgorCQkgICAgKEk5
MTVfUkVBRChQTEFORV9TVVJGKGJpZ2pvaW5lcl9waXBlLCBwbGFuZV9pZCkpICYgMHhmZmZmZjAw
MCkgPT0gcGxhbmVfY29uZmlnLT5iYXNlKSB7CisJCQl2YWwgPSBJOTE1X1JFQUQoUExBTkVfU0la
RShjcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGMtPnBpcGUsIHBsYW5lX2lkKSk7CisJ
CQlmYi0+aGVpZ2h0ICs9ICgodmFsID4+IDE2KSAmIDB4ZmZmKSArIDE7CisJCQlmYi0+d2lkdGgg
Kz0gKCh2YWwgPj4gMCkgJiAweDFmZmYpICsgMTsKKwkJfQorCX0KKwogCXZhbCA9IEk5MTVfUkVB
RChQTEFORV9TVFJJREUocGlwZSwgcGxhbmVfaWQpKTsKIAlzdHJpZGVfbXVsdCA9IHNrbF9wbGFu
ZV9zdHJpZGVfbXVsdChmYiwgMCwgRFJNX01PREVfUk9UQVRFXzApOwogCWZiLT5waXRjaGVzWzBd
ID0gKHZhbCAmIDB4M2ZmKSAqIHN0cmlkZV9tdWx0OwpAQCAtMTc1MzUsNyArMTc1NTYsOCBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9zYW5pdGl6ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CiAJLyogQWRqdXN0IHRoZSBzdGF0ZSBvZiB0aGUgb3V0cHV0IHBpcGUgYWNjb3JkaW5nIHRvIHdo
ZXRoZXIgd2UKIAkgKiBoYXZlIGFjdGl2ZSBjb25uZWN0b3JzL2VuY29kZXJzLiAqLwotCWlmIChj
cnRjX3N0YXRlLT5ody5hY3RpdmUgJiYgIWludGVsX2NydGNfaGFzX2VuY29kZXJzKGNydGMpKQor
CWlmIChjcnRjX3N0YXRlLT5ody5hY3RpdmUgJiYgIWludGVsX2NydGNfaGFzX2VuY29kZXJzKGNy
dGMpICYmCisJICAgICFjcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUpCiAJCWludGVsX2NydGNf
ZGlzYWJsZV9ub2F0b21pYygmY3J0Yy0+YmFzZSwgY3R4KTsKIAogCWlmIChjcnRjX3N0YXRlLT5o
dy5hY3RpdmUgfHwgSEFTX0dNQ0goZGV2X3ByaXYpKSB7CkBAIC0xNzgyNSw2ICsxNzg0Nyw5IEBA
IHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfcmVhZG91dF9od19zdGF0ZShzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2KQogCQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCQlpbnQgbWluX2NkY2xr
ID0gMDsKIAorCQlpZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQkJY29udGludWU7
CisKIAkJaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgewogCQkJc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgbW9kZTsKIApAQCAtMTc4NDksNiArMTc4NzQsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9t
b2Rlc2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJCW1vZGUu
aGRpc3BsYXkgPSBjcnRjX3N0YXRlLT5waXBlX3NyY193OwogCQkJbW9kZS52ZGlzcGxheSA9IGNy
dGNfc3RhdGUtPnBpcGVfc3JjX2g7CiAKKwkJCWlmIChjcnRjX3N0YXRlLT5iaWdqb2luZXIpCisJ
CQkJbW9kZS5oZGlzcGxheSAqPSAyOworCiAJCQlpbnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0
ZShjcnRjX3N0YXRlKTsKIAogCQkJaW50ZWxfY3J0Y191cGRhdGVfYWN0aXZlX3RpbWluZ3MoY3J0
Y19zdGF0ZSk7CkBAIC0xNzg5OCw2ICsxNzkyNiwzOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rl
c2V0X3JlYWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJaW50ZWxfYndf
Y3J0Y191cGRhdGUoYndfc3RhdGUsIGNydGNfc3RhdGUpOwogCiAJCWludGVsX3BpcGVfY29uZmln
X3Nhbml0eV9jaGVjayhkZXZfcHJpdiwgY3J0Y19zdGF0ZSk7CisKKwkJLyogZGlzY2FyZCBvdXIg
aW5jb21wbGV0ZSBzbGF2ZSBzdGF0ZSwgY29weSBpdCBmcm9tIG1hc3RlciAqLworCQlpZiAoY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyICYmIGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkgeworCQkJc3RydWN0
IGludGVsX2NydGMgKnNsYXZlID0gY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjOwor
CQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnNsYXZlX2NydGNfc3RhdGUgPQorCQkJCXRvX2lu
dGVsX2NydGNfc3RhdGUoc2xhdmUtPmJhc2Uuc3RhdGUpOworCisJCQljb3B5X2JpZ2pvaW5lcl9j
cnRjX3N0YXRlKHNsYXZlX2NydGNfc3RhdGUsIGNydGNfc3RhdGUpOworCQkJc2xhdmUtPmJhc2Uu
bW9kZSA9IGNydGMtPmJhc2UubW9kZTsKKworCQkJZGV2X3ByaXYtPm1pbl9jZGNsa1tzbGF2ZS0+
cGlwZV0gPSBtaW5fY2RjbGs7CisJCQlkZXZfcHJpdi0+bWluX3ZvbHRhZ2VfbGV2ZWxbc2xhdmUt
PnBpcGVdID0KKwkJCQljcnRjX3N0YXRlLT5taW5fdm9sdGFnZV9sZXZlbDsKKworCQkJZm9yX2Vh
Y2hfaW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYtPmRybSwgc2xhdmUsIHBsYW5lKSB7CisJ
CQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9CisJCQkJCXRv
X2ludGVsX3BsYW5lX3N0YXRlKHBsYW5lLT5iYXNlLnN0YXRlKTsKKworCQkJCS8qCisJCQkJKiBG
SVhNRSBkb24ndCBoYXZlIHRoZSBmYiB5ZXQsIHNvIGNhbid0CisJCQkJKiB1c2UgaW50ZWxfcGxh
bmVfZGF0YV9yYXRlKCkgOigKKwkJCQkqLworCQkJCWlmIChwbGFuZV9zdGF0ZS0+dWFwaS52aXNp
YmxlKQorCQkJCQljcnRjX3N0YXRlLT5kYXRhX3JhdGVbcGxhbmUtPmlkXSA9CisJCQkJCQk0ICog
Y3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZTsKKwkJCQllbHNlCisJCQkJCWNydGNfc3RhdGUtPmRhdGFf
cmF0ZVtwbGFuZS0+aWRdID0gMDsKKwkJCX0KKworCQkJaW50ZWxfYndfY3J0Y191cGRhdGUoYndf
c3RhdGUsIHNsYXZlX2NydGNfc3RhdGUpOworCQkJZHJtX2NhbGNfdGltZXN0YW1waW5nX2NvbnN0
YW50cygmc2xhdmUtPmJhc2UsCisJCQkJCQkJJnNsYXZlX2NydGNfc3RhdGUtPmh3LmFkanVzdGVk
X21vZGUpOworCQl9CiAJfQogfQogCi0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

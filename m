Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EC0E8C21CA
	for <lists+intel-gfx@lfdr.de>; Mon, 30 Sep 2019 15:21:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DECB36E42B;
	Mon, 30 Sep 2019 13:21:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 397856E428;
 Mon, 30 Sep 2019 13:21:19 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18667487-1500050 
 for multiple; Mon, 30 Sep 2019 14:21:16 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 30 Sep 2019 14:21:10 +0100
Message-Id: <20190930132110.543-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190930103745.18674-1-chris@chris-wilson.co.uk>
References: <20190930103745.18674-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t v2] i915/gem_mmap_gtt: Reduce RSS for
 fault-concurrent
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGludGVudCBvZiBleGVyY2lzaW5nIHBhcmFsbGVsIHBhZ2UgZmF1bHQgaXMgbm90IG5lY2Vz
c2FyaWx5IHRvCmV4ZXJjaXNlIHBhcmFsbGVsIHN3YXAtaW4gKHdlIGNhbiBzYWZlbHkgcmVseSBv
biB0aGF0IGJlaW5nIHdlbGwgdGVzdGVkCmFuZCBpcyBvcnRob2dvbmFsIHRvIHBhZ2UgZmF1bHRp
bmcpLCBidXQgdG8gbWFrZSBzdXJlIHRoYXQgb3VyIG9iamVjdAphbmQgR0dUVCBsb2NraW5nIGlz
IGV4ZXJjaXNlZC4gV2UgY2FuIHNhZmVseSByZWR1Y2Ugb3VyIFJTUyB3aXRob3V0IGxvc3MKb2Yg
Y292ZXJhZ2UuIEZ1cnRoZXJtb3JlLCBieSB1c2luZyB2YXJ5aW5nIHNpemVzIHdlIGNhbiBleGVy
Y2lzZQpkaWZmZXJlbnQgY29kZSBwYXRocyB3aXRoaW4gcGFnZSBmYXVsdGluZywgcmF0aGVyIHRo
YW4gYWxsIGJlaW5nCnNlcnZpY2VkIGFzIHBhcnRpYWwgbW1hcHMuIEluc3RlYWQgb2YgYWxsb2Nh
dGluZyAzMiBzdXJmYWNlcywgZWFjaCBvZgoxNk1pQiwgd2UgYWxsb2NhdGUgMzIgc3VyZmFjZXMg
aW4gaW5jcmVtZW50YWwgNTEyS2lCIHNpemVzOyBoYWx2aW5nIHRoZQptZW1vcnkgcmVxdWlyZW1l
bnQuCgpSZWZlcmVuY2VzOiBodHRwczovL2J1Z3MuZnJlZWRlc2t0b3Aub3JnL3Nob3dfYnVnLmNn
aT9pZD0xMTE4NjQKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxz
b24uY28udWs+Ci0tLQogdGVzdHMvaTkxNS9nZW1fbW1hcF9ndHQuYyB8IDQwICsrKysrKysrKysr
KysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDI4IGluc2VydGlv
bnMoKyksIDEyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX21tYXBf
Z3R0LmMgYi90ZXN0cy9pOTE1L2dlbV9tbWFwX2d0dC5jCmluZGV4IDkxZGE1YTM3Yi4uNmViYmRk
OGM3IDEwMDY0NAotLS0gYS90ZXN0cy9pOTE1L2dlbV9tbWFwX2d0dC5jCisrKyBiL3Rlc3RzL2k5
MTUvZ2VtX21tYXBfZ3R0LmMKQEAgLTU3LDMwICs1NywzNiBAQCBzZXRfZG9tYWluX2d0dChpbnQg
ZmQsIHVpbnQzMl90IGhhbmRsZSkKIH0KIAogc3RhdGljIHZvaWQgKgotbW1hcF9ibyhpbnQgZmQs
IHVpbnQzMl90IGhhbmRsZSkKK21tYXBfYm8oaW50IGZkLCB1aW50MzJfdCBoYW5kbGUsIHVpbnQ2
NF90IHNpemUpCiB7CiAJdm9pZCAqcHRyOwogCi0JcHRyID0gZ2VtX21tYXBfX2d0dChmZCwgaGFu
ZGxlLCBPQkpFQ1RfU0laRSwgUFJPVF9SRUFEIHwgUFJPVF9XUklURSk7CisJcHRyID0gZ2VtX21t
YXBfX2d0dChmZCwgaGFuZGxlLCBzaXplLCBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFKTsKIAogCXJl
dHVybiBwdHI7CiB9CiAKIHN0YXRpYyB2b2lkICoKLWNyZWF0ZV9wb2ludGVyKGludCBmZCkKK2Ny
ZWF0ZV9wb2ludGVyX3NpemUoaW50IGZkLCB1aW50NjRfdCBzaXplKQogewogCXVpbnQzMl90IGhh
bmRsZTsKIAl2b2lkICpwdHI7CiAKLQloYW5kbGUgPSBnZW1fY3JlYXRlKGZkLCBPQkpFQ1RfU0la
RSk7CisJaGFuZGxlID0gZ2VtX2NyZWF0ZShmZCwgc2l6ZSk7CiAKLQlwdHIgPSBtbWFwX2JvKGZk
LCBoYW5kbGUpOworCXB0ciA9IG1tYXBfYm8oZmQsIGhhbmRsZSwgc2l6ZSk7CiAKIAlnZW1fY2xv
c2UoZmQsIGhhbmRsZSk7CiAKIAlyZXR1cm4gcHRyOwogfQogCitzdGF0aWMgdm9pZCAqCitjcmVh
dGVfcG9pbnRlcihpbnQgZmQpCit7CisJcmV0dXJuIGNyZWF0ZV9wb2ludGVyX3NpemUoZmQsIE9C
SkVDVF9TSVpFKTsKK30KKwogc3RhdGljIHZvaWQKIHRlc3RfYWNjZXNzKGludCBmZCkKIHsKQEAg
LTQ2OCw3ICs0NzQsNyBAQCB0ZXN0X3dyaXRlX2d0dChpbnQgZmQpCiAJZHN0ID0gZ2VtX2NyZWF0
ZShmZCwgT0JKRUNUX1NJWkUpOwogCiAJLyogcHJlZmF1bHQgb2JqZWN0IGludG8gZ3R0ICovCi0J
ZHN0X2d0dCA9IG1tYXBfYm8oZmQsIGRzdCk7CisJZHN0X2d0dCA9IG1tYXBfYm8oZmQsIGRzdCwg
T0JKRUNUX1NJWkUpOwogCXNldF9kb21haW5fZ3R0KGZkLCBkc3QpOwogCW1lbXNldChkc3RfZ3R0
LCAwLCBPQkpFQ1RfU0laRSk7CiAJbXVubWFwKGRzdF9ndHQsIE9CSkVDVF9TSVpFKTsKQEAgLTk1
OCwxMCArOTY0LDE2IEBAIHRocmVhZF9mYXVsdF9jb25jdXJyZW50KHZvaWQgKmNsb3N1cmUpCiAJ
aW50IG47CiAKIAlmb3IgKG4gPSAwOyBuIDwgMzI7IG4rKykgeworCQl1bnNpZ25lZCBpbnQgaWQg
PSAobiArIHQtPmlkKSAlIDMyOworCQl1aW50MzJfdCBzeiA9ICp0LT5wdHJbaWRdIC0gMTsKKwkJ
aW50IGlkeCA9IHJhbmQoKSAlIHN6ICsgMTsKKwogCQlpZiAobiAmIDEpCi0JCQkqdC0+cHRyWyhu
ICsgdC0+aWQpICUgMzJdID0gdmFsOworCQkJdC0+cHRyW2lkXVtpZHhdID0gdmFsOwogCQllbHNl
Ci0JCQl2YWwgPSAqdC0+cHRyWyhuICsgdC0+aWQpICUgMzJdOworCQkJdmFsID0gdC0+cHRyW2lk
XVtpZHhdOworCisJCXZhbCsrOwogCX0KIAogCXJldHVybiBOVUxMOwpAQCAtOTc1LDcgKzk4Nywx
MCBAQCB0ZXN0X2ZhdWx0X2NvbmN1cnJlbnQoaW50IGZkKQogCWludCBuOwogCiAJZm9yIChuID0g
MDsgbiA8IDMyOyBuKyspIHsKLQkJcHRyW25dID0gY3JlYXRlX3BvaW50ZXIoZmQpOworCQl1aW50
MzJfdCBzeiA9IChuICsgMSkgPDwgMTk7IC8qIDUxMktpQiBpbmNyZW1lbnRzICovCisKKwkJcHRy
W25dID0gY3JlYXRlX3BvaW50ZXJfc2l6ZShmZCwgc3opOworCQkqcHRyW25dID0gc3ogLyBzaXpl
b2YodWludDMyX3QpOyAvKiBudW1fZWxlbXMgZm9yIGNvbnZlbmllbmNlICovCiAJfQogCiAJZm9y
IChuID0gMDsgbiA8IDY0OyBuKyspIHsKQEAgLTk4NCwxMiArOTk5LDEzIEBAIHRlc3RfZmF1bHRf
Y29uY3VycmVudChpbnQgZmQpCiAJCXB0aHJlYWRfY3JlYXRlKCZ0aHJlYWRbbl0udGhyZWFkLCBO
VUxMLCB0aHJlYWRfZmF1bHRfY29uY3VycmVudCwgJnRocmVhZFtuXSk7CiAJfQogCisJc2xlZXAo
Mik7CisKIAlmb3IgKG4gPSAwOyBuIDwgNjQ7IG4rKykKIAkJcHRocmVhZF9qb2luKHRocmVhZFtu
XS50aHJlYWQsIE5VTEwpOwogCi0JZm9yIChuID0gMDsgbiA8IDMyOyBuKyspIHsKLQkJbXVubWFw
KHB0cltuXSwgT0JKRUNUX1NJWkUpOwotCX0KKwlmb3IgKG4gPSAwOyBuIDwgMzI7IG4rKykKKwkJ
bXVubWFwKHB0cltuXSwgKnB0cltuXSAqIHNpemVvZih1aW50MzJfdCkpOwogfQogCiBzdGF0aWMg
dm9pZAotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0AE1A2D969E
	for <lists+intel-gfx@lfdr.de>; Mon, 14 Dec 2020 11:51:40 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 20E4B6E1D7;
	Mon, 14 Dec 2020 10:51:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (unknown [77.68.26.236])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 38DE06E1D5;
 Mon, 14 Dec 2020 10:51:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 23318474-1500050 
 for multiple; Mon, 14 Dec 2020 10:51:23 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 14 Dec 2020 10:51:23 +0000
Message-Id: <20201214105123.542518-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.29.2
In-Reply-To: <20201214105123.542518-1-chris@chris-wilson.co.uk>
References: <20201214105123.542518-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 4/4] i915/gem_exec_schedule: Try to spot
 unfairness
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org, Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QW4gaW1wb3J0YW50IHByb3BlcnR5IGZvciBtdWx0aS1jbGllbnQgc3lzdGVtcyBpcyB0aGF0IGVh
Y2ggY2xpZW50IGdldHMKYSAnZmFpcicgYWxsb3RtZW50IG9mIHN5c3RlbSB0aW1lLiAoV2hlcmUg
ZmFpcm5lc3MgaXMgYXQgdGhlIHdoaW0gb2YgdGhlCmNvbnRleHQgcHJvcGVydGllcywgc3VjaCBh
cyBwcmlvcml0aWVzLikgVGhpcyB0ZXN0IGZvcmtzIE4gaW5kZXBlbmRlbnQKY2xpZW50cyAoYWxi
ZWl0IHRoZXkgaGFwcGVuIHRvIHNoYXJlIGEgc2luZ2xlIHZtKSwgYW5kIGRvZXMgYW4gZXF1YWwK
YW1vdW50IG9mIHdvcmsgaW4gY2xpZW50IGFuZCBhc3NlcnRzIHRoYXQgdGhleSB0YWtlIGFuIGVx
dWFsIGFtb3VudCBvZgp0aW1lLgoKVGhvdWdoIHdlIGhhdmUgbmV2ZXIgY2xhaW1lZCB0byBoYXZl
IGEgY29tcGxldGVseSBmYWlyIHNjaGVkdWxlciwgdGhhdAppcyB3aGF0IGlzIGV4cGVjdGVkLgoK
djI6IGlndF9hc3NlcnRfZiBhbmQgbW9yZSBjb21tZW50YXJ5OyBleGNsdWRlIHZpcCBmcm9tIGNs
aWVudCBzdGF0cywKaW5jbHVkZSByYW5nZSBvZiBmcmFtZSBpbnRlcnZhbHMgZnJvbSBlYWNoIGlu
ZGl2aWR1YWwgY2xpZW50CnYzOiBXcml0ZSBkb3duIHdoYXQgdGhlIHRlc3QgYWN0dWFsbHkgZG9l
cyEKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IFJhbWFs
aW5nYW0gQyA8cmFtYWxpbmdhbS5jQGludGVsLmNvbT4KLS0tCiB0ZXN0cy9pOTE1L2dlbV9leGVj
X3NjaGVkdWxlLmMgfCA5NjAgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAxIGZp
bGUgY2hhbmdlZCwgOTYwIGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dl
bV9leGVjX3NjaGVkdWxlLmMgYi90ZXN0cy9pOTE1L2dlbV9leGVjX3NjaGVkdWxlLmMKaW5kZXgg
ZjIzZDYzYWMzLi4zYzk1MGIwNmYgMTAwNjQ0Ci0tLSBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfc2No
ZWR1bGUuYworKysgYi90ZXN0cy9pOTE1L2dlbV9leGVjX3NjaGVkdWxlLmMKQEAgLTI5LDYgKzI5
LDcgQEAKICNpbmNsdWRlIDxzeXMvcG9sbC5oPgogI2luY2x1ZGUgPHN5cy9pb2N0bC5oPgogI2lu
Y2x1ZGUgPHN5cy9tbWFuLmg+CisjaW5jbHVkZSA8c3lzL3Jlc291cmNlLmg+CiAjaW5jbHVkZSA8
c3lzL3N5c2NhbGwuaD4KICNpbmNsdWRlIDxzY2hlZC5oPgogI2luY2x1ZGUgPHNpZ25hbC5oPgpA
QCAtMjUxNiw2ICsyNTE3LDkzMiBAQCBzdGF0aWMgdm9pZCBtZWFzdXJlX3NlbWFwaG9yZV9wb3dl
cihpbnQgaTkxNSkKIAlyYXBsX2Nsb3NlKCZwa2cpOwogfQogCitzdGF0aWMgaW50IHJlYWRfdGlt
ZXN0YW1wX2ZyZXF1ZW5jeShpbnQgaTkxNSkKK3sKKwlpbnQgdmFsdWUgPSAwOworCWRybV9pOTE1
X2dldHBhcmFtX3QgZ3AgPSB7CisJCS52YWx1ZSA9ICZ2YWx1ZSwKKwkJLnBhcmFtID0gSTkxNV9Q
QVJBTV9DU19USU1FU1RBTVBfRlJFUVVFTkNZLAorCX07CisJaW9jdGwoaTkxNSwgRFJNX0lPQ1RM
X0k5MTVfR0VUUEFSQU0sICZncCk7CisJcmV0dXJuIHZhbHVlOworfQorCitzdGF0aWMgdWludDY0
X3QgZGl2NjRfdTY0X3JvdW5kX3VwKHVpbnQ2NF90IHgsIHVpbnQ2NF90IHkpCit7CisJcmV0dXJu
ICh4ICsgeSAtIDEpIC8geTsKK30KKworc3RhdGljIHVpbnQ2NF90IG5zX3RvX2N0eF90aWNrcyhp
bnQgaTkxNSwgdWludDY0X3QgbnMpCit7CisJaW50IGYgPSByZWFkX3RpbWVzdGFtcF9mcmVxdWVu
Y3koaTkxNSk7CisJaWYgKGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA9PSAx
MSkKKwkJZiA9IDEyNTAwMDAwOyAvKiBpY2whISEgYXJlIHlvdSBmZWVsaW5nIGFscmlnaHQ/IENU
WCB2cyBDUyAqLworCXJldHVybiBkaXY2NF91NjRfcm91bmRfdXAobnMgKiBmLCBOU0VDX1BFUl9T
RUMpOworfQorCitzdGF0aWMgdWludDY0X3QgdGlja3NfdG9fbnMoaW50IGk5MTUsIHVpbnQ2NF90
IHRpY2tzKQoreworCXJldHVybiBkaXY2NF91NjRfcm91bmRfdXAodGlja3MgKiBOU0VDX1BFUl9T
RUMsCisJCQkJICByZWFkX3RpbWVzdGFtcF9mcmVxdWVuY3koaTkxNSkpOworfQorCisjZGVmaW5l
IE1JX0lOU1RSKG9wY29kZSwgZmxhZ3MpICgoKG9wY29kZSkgPDwgMjMpIHwgKGZsYWdzKSkKKwor
I2RlZmluZSBNSV9NQVRIKHgpICAgICAgICAgICAgICAgICAgICAgIE1JX0lOU1RSKDB4MWEsICh4
KSAtIDEpCisjZGVmaW5lIE1JX01BVEhfSU5TVFIob3Bjb2RlLCBvcDEsIG9wMikgKChvcGNvZGUp
IDw8IDIwIHwgKG9wMSkgPDwgMTAgfCAob3AyKSkKKy8qIE9wY29kZXMgZm9yIE1JX01BVEhfSU5T
VFIgKi8KKyNkZWZpbmUgICBNSV9NQVRIX05PT1AgICAgICAgICAgICAgICAgICBNSV9NQVRIX0lO
U1RSKDB4MDAwLCAweDAsIDB4MCkKKyNkZWZpbmUgICBNSV9NQVRIX0xPQUQob3AxLCBvcDIpICAg
ICAgICBNSV9NQVRIX0lOU1RSKDB4MDgwLCBvcDEsIG9wMikKKyNkZWZpbmUgICBNSV9NQVRIX0xP
QURJTlYob3AxLCBvcDIpICAgICBNSV9NQVRIX0lOU1RSKDB4NDgwLCBvcDEsIG9wMikKKyNkZWZp
bmUgICBNSV9NQVRIX0xPQUQwKG9wMSkgICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4MDgxLCBv
cDEpCisjZGVmaW5lICAgTUlfTUFUSF9MT0FEMShvcDEpICAgICAgICAgICAgTUlfTUFUSF9JTlNU
UigweDQ4MSwgb3AxKQorI2RlZmluZSAgIE1JX01BVEhfQUREICAgICAgICAgICAgICAgICAgIE1J
X01BVEhfSU5TVFIoMHgxMDAsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfU1VCICAgICAg
ICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgxMDEsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1J
X01BVEhfQU5EICAgICAgICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgxMDIsIDB4MCwgMHgw
KQorI2RlZmluZSAgIE1JX01BVEhfT1IgICAgICAgICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIo
MHgxMDMsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfWE9SICAgICAgICAgICAgICAgICAg
IE1JX01BVEhfSU5TVFIoMHgxMDQsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfU1RPUkUo
b3AxLCBvcDIpICAgICAgIE1JX01BVEhfSU5TVFIoMHgxODAsIG9wMSwgb3AyKQorI2RlZmluZSAg
IE1JX01BVEhfU1RPUkVJTlYob3AxLCBvcDIpICAgIE1JX01BVEhfSU5TVFIoMHg1ODAsIG9wMSwg
b3AyKQorLyogUmVnaXN0ZXJzIHVzZWQgYXMgb3BlcmFuZHMgaW4gTUlfTUFUSF9JTlNUUiAqLwor
I2RlZmluZSAgIE1JX01BVEhfUkVHKHgpICAgICAgICAgICAgICAgICh4KQorI2RlZmluZSAgIE1J
X01BVEhfUkVHX1NSQ0EgICAgICAgICAgICAgIDB4MjAKKyNkZWZpbmUgICBNSV9NQVRIX1JFR19T
UkNCICAgICAgICAgICAgICAweDIxCisjZGVmaW5lICAgTUlfTUFUSF9SRUdfQUNDVSAgICAgICAg
ICAgICAgMHgzMQorI2RlZmluZSAgIE1JX01BVEhfUkVHX1pGICAgICAgICAgICAgICAgIDB4MzIK
KyNkZWZpbmUgICBNSV9NQVRIX1JFR19DRiAgICAgICAgICAgICAgICAweDMzCisKKyNkZWZpbmUg
TUlfTE9BRF9SRUdJU1RFUl9SRUcgICAgTUlfSU5TVFIoMHgyQSwgMSkKKworc3RhdGljIHZvaWQg
ZGVsYXkoaW50IGk5MTUsCisJCSAgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUy
ICplLAorCQkgIHVpbnQzMl90IGhhbmRsZSwKKwkJICB1aW50NjRfdCBhZGRyLAorCQkgIHVpbnQ2
NF90IG5zKQoreworCWNvbnN0IGludCB1c2VfNjRiID0gaW50ZWxfZ2VuKGludGVsX2dldF9kcm1f
ZGV2aWQoaTkxNSkpID49IDg7CisJY29uc3QgdWludDMyX3QgYmFzZSA9IGdlbV9lbmdpbmVfbW1p
b19iYXNlKGk5MTUsIGUtPm5hbWUpOworI2RlZmluZSBDU19HUFIoeCkgKGJhc2UgKyAweDYwMCAr
IDggKiAoeCkpCisjZGVmaW5lIFJVTlRJTUUgKGJhc2UgKyAweDNhOCkKKwllbnVtIHsgU1RBUlRf
VFMsIE5PV19UUyB9OworCXVpbnQzMl90ICptYXAsICpjcywgKmptcDsKKworCWlndF9yZXF1aXJl
KGJhc2UpOworCisJLyogTG9vcCB1bnRpbCBDVFhfVElNRVNUQU1QIC0gaW5pdGlhbCA+IEBucyAq
LworCisJY3MgPSBtYXAgPSBnZW1fbW1hcF9fZGV2aWNlX2NvaGVyZW50KGk5MTUsIGhhbmRsZSwg
MCwgNDA5NiwgUFJPVF9XUklURSk7CisKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOwor
CSpjcysrID0gQ1NfR1BSKFNUQVJUX1RTKSArIDQ7CisJKmNzKysgPSAwOworCSpjcysrID0gTUlf
TE9BRF9SRUdJU1RFUl9SRUc7CisJKmNzKysgPSBSVU5USU1FOworCSpjcysrID0gQ1NfR1BSKFNU
QVJUX1RTKTsKKworCXdoaWxlIChvZmZzZXRfaW5fcGFnZShjcykgJiA2MykKKwkJKmNzKysgPSAw
OworCWptcCA9IGNzOworCisJKmNzKysgPSAweDUgPDwgMjM7IC8qIE1JX0FSQl9DSEVDSyAqLwor
CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihOT1dfVFMp
ICsgNDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRzsKKwkqY3Mr
KyA9IFJVTlRJTUU7CisJKmNzKysgPSBDU19HUFIoTk9XX1RTKTsKKworCS8qIGRlbHRhID0gbm93
IC0gc3RhcnQ7IGludmVydGVkIHRvIG1hdGNoIENPTkRfQkJFICovCisJKmNzKysgPSBNSV9NQVRI
KDQpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVH
KE5PV19UUykpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0IsIE1JX01B
VEhfUkVHKFNUQVJUX1RTKSk7CisJKmNzKysgPSBNSV9NQVRIX1NVQjsKKwkqY3MrKyA9IE1JX01B
VEhfU1RPUkVJTlYoTUlfTUFUSF9SRUcoTk9XX1RTKSwgTUlfTUFUSF9SRUdfQUNDVSk7CisKKwkv
KiBTYXZlIGRlbHRhIGZvciByZWFkaW5nIGJ5IENPTkRfQkJFICovCisJKmNzKysgPSAweDI0IDw8
IDIzIHwgKDEgKyB1c2VfNjRiKTsgLyogU1JNICovCisJKmNzKysgPSBDU19HUFIoTk9XX1RTKTsK
KwkqY3MrKyA9IGFkZHIgKyA0MDAwOworCSpjcysrID0gYWRkciA+PiAzMjsKKworCS8qIERlbGF5
IGJldHdlZW4gU1JNIGFuZCBDT05EX0JCRSB0byBwb3N0IHRoZSB3cml0ZXMgKi8KKwlmb3IgKGlu
dCBuID0gMDsgbiA8IDg7IG4rKykgeworCQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTTsKKwkJ
aWYgKHVzZV82NGIpIHsKKwkJCSpjcysrID0gYWRkciArIDQwNjQ7CisJCQkqY3MrKyA9IGFkZHIg
Pj4gMzI7CisJCX0gZWxzZSB7CisJCQkqY3MrKyA9IDA7CisJCQkqY3MrKyA9IGFkZHIgKyA0MDY0
OworCQl9CisJCSpjcysrID0gMDsKKwl9CisKKwkvKiBCcmVhayBpZiBkZWx0YSBbdGltZSBlbGFw
c2VkXSA+IG5zICovCisJKmNzKysgPSBNSV9DT05EX0JBVENIX0JVRkZFUl9FTkQgfCBNSV9ET19D
T01QQVJFIHwgKDEgKyB1c2VfNjRiKTsKKwkqY3MrKyA9IH5uc190b19jdHhfdGlja3MoaTkxNSwg
bnMpOworCSpjcysrID0gYWRkciArIDQwMDA7CisJKmNzKysgPSBhZGRyID4+IDMyOworCisJLyog
T3RoZXJ3aXNlIGJhY2sgdG8gcmVjYWxjdWxhdGluZyBkZWx0YSAqLworCSpjcysrID0gTUlfQkFU
Q0hfQlVGRkVSX1NUQVJUIHwgMSA8PCA4IHwgdXNlXzY0YjsKKwkqY3MrKyA9IGFkZHIgKyBvZmZz
ZXRfaW5fcGFnZShqbXApOworCSpjcysrID0gYWRkciA+PiAzMjsKKworCW11bm1hcChtYXAsIDQw
OTYpOworfQorCitzdGF0aWMgc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIKK2RlbGF5
X2NyZWF0ZShpbnQgaTkxNSwgdWludDMyX3QgY3R4LAorCSAgICAgY29uc3Qgc3RydWN0IGludGVs
X2V4ZWN1dGlvbl9lbmdpbmUyICplLAorCSAgICAgdWludDY0X3QgdGFyZ2V0X25zKQoreworCXN0
cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyIG9iaiA9IHsKKwkJLmhhbmRsZSA9IGJhdGNo
X2NyZWF0ZShpOTE1KSwKKwkJLmZsYWdzID0gRVhFQ19PQkpFQ1RfU1VQUE9SVFNfNDhCX0FERFJF
U1MsCisJfTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJ
CS5idWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKSwKKwkJLmJ1ZmZlcl9jb3VudCA9
IDEsCisJCS5yc3ZkMSA9IGN0eCwKKwkJLmZsYWdzID0gZS0+ZmxhZ3MsCisJfTsKKworCW9iai5v
ZmZzZXQgPSBvYmouaGFuZGxlIDw8IDEyOworCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsK
KwlnZW1fc3luYyhpOTE1LCBvYmouaGFuZGxlKTsKKworCWRlbGF5KGk5MTUsIGUsIG9iai5oYW5k
bGUsIG9iai5vZmZzZXQsIHRhcmdldF9ucyk7CisKKwlvYmouZmxhZ3MgfD0gRVhFQ19PQkpFQ1Rf
UElOTkVEOworCXJldHVybiBvYmo7Cit9CisKK3N0YXRpYyB2b2lkIHRzbG9nKGludCBpOTE1LAor
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqZSwKKwkJICB1aW50MzJf
dCBoYW5kbGUsCisJCSAgdWludDY0X3QgYWRkcikKK3sKKwljb25zdCBpbnQgdXNlXzY0YiA9IGlu
dGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA+PSA4OworCWNvbnN0IHVpbnQzMl90
IGJhc2UgPSBnZW1fZW5naW5lX21taW9fYmFzZShpOTE1LCBlLT5uYW1lKTsKKyNkZWZpbmUgQ1Nf
R1BSKHgpIChiYXNlICsgMHg2MDAgKyA4ICogKHgpKQorI2RlZmluZSBDU19USU1FU1RBTVAgKGJh
c2UgKyAweDM1OCkKKwllbnVtIHsgSU5DLCBNQVNLLCBBRERSIH07CisJdWludDMyX3QgKnRpbWVz
dGFtcF9sbywgKmFkZHJfbG87CisJdWludDMyX3QgKm1hcCwgKmNzOworCisJaWd0X3JlcXVpcmUo
YmFzZSk7CisKKwltYXAgPSBnZW1fbW1hcF9fZGV2aWNlX2NvaGVyZW50KGk5MTUsIGhhbmRsZSwg
MCwgNDA5NiwgUFJPVF9XUklURSk7CisJY3MgPSBtYXAgKyA1MTI7CisKKwkvKiBSZWNvcmQgdGhl
IGN1cnJlbnQgQ1NfVElNRVNUQU1QIGludG8gYSBqb3VybmFsIFthIDUxMiBzbG90IHJpbmddLiAq
LworCSpjcysrID0gMHgyNCA8PCAyMyB8ICgxICsgdXNlXzY0Yik7IC8qIFNSTSAqLworCSpjcysr
ID0gQ1NfVElNRVNUQU1QOworCXRpbWVzdGFtcF9sbyA9IGNzOworCSpjcysrID0gYWRkcjsKKwkq
Y3MrKyA9IGFkZHIgPj4gMzI7CisKKwkvKiBMb2FkIHRoZSBhZGRyZXNzICsgaW5jICYgbWFzayB2
YXJpYWJsZXMgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpjcysrID0gQ1Nf
R1BSKEFERFIpOworCWFkZHJfbG8gPSBjczsKKwkqY3MrKyA9IGFkZHI7CisJKmNzKysgPSBNSV9M
T0FEX1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihBRERSKSArIDQ7CisJKmNzKysgPSBh
ZGRyID4+IDMyOworCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENT
X0dQUihJTkMpOworCSpjcysrID0gNDsKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOwor
CSpjcysrID0gQ1NfR1BSKElOQykgKyA0OworCSpjcysrID0gMDsKKworCSpjcysrID0gTUlfTE9B
RF9SRUdJU1RFUl9JTU07CisJKmNzKysgPSBDU19HUFIoTUFTSyk7CisJKmNzKysgPSAweGZmZmZm
N2ZmOworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU07CisJKmNzKysgPSBDU19HUFIoTUFT
SykgKyA0OworCSpjcysrID0gMHhmZmZmZmZmZjsKKworCS8qIEluY3JlbWVudCB0aGUgW3Jpbmdd
IGFkZHJlc3MgZm9yIHNhdmluZyBDU19USU1FU1RBTVAgKi8KKwkqY3MrKyA9IE1JX01BVEgoOCk7
CisJKmNzKysgPSBNSV9NQVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQSwgTUlfTUFUSF9SRUcoSU5D
KSk7CisJKmNzKysgPSBNSV9NQVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQiwgTUlfTUFUSF9SRUco
QUREUikpOworCSpjcysrID0gTUlfTUFUSF9BREQ7CisJKmNzKysgPSBNSV9NQVRIX1NUT1JFKE1J
X01BVEhfUkVHKEFERFIpLCBNSV9NQVRIX1JFR19BQ0NVKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9B
RChNSV9NQVRIX1JFR19TUkNBLCBNSV9NQVRIX1JFRyhBRERSKSk7CisJKmNzKysgPSBNSV9NQVRI
X0xPQUQoTUlfTUFUSF9SRUdfU1JDQiwgTUlfTUFUSF9SRUcoTUFTSykpOworCSpjcysrID0gTUlf
TUFUSF9BTkQ7CisJKmNzKysgPSBNSV9NQVRIX1NUT1JFKE1JX01BVEhfUkVHKEFERFIpLCBNSV9N
QVRIX1JFR19BQ0NVKTsKKworCS8qIFJld3JpdGUgdGhlIGJhdGNoIGJ1ZmZlciBmb3IgdGhlIG5l
eHQgZXhlY3V0aW9uICovCisJKmNzKysgPSAweDI0IDw8IDIzIHwgKDEgKyB1c2VfNjRiKTsgLyog
U1JNICovCisJKmNzKysgPSBDU19HUFIoQUREUik7CisJKmNzKysgPSBhZGRyICsgb2Zmc2V0X2lu
X3BhZ2UodGltZXN0YW1wX2xvKTsKKwkqY3MrKyA9IGFkZHIgPj4gMzI7CisJKmNzKysgPSAweDI0
IDw8IDIzIHwgKDEgKyB1c2VfNjRiKTsgLyogU1JNICovCisJKmNzKysgPSBDU19HUFIoQUREUik7
CisJKmNzKysgPSBhZGRyICsgb2Zmc2V0X2luX3BhZ2UoYWRkcl9sbyk7CisJKmNzKysgPSBhZGRy
ID4+IDMyOworCisJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJbXVubWFwKG1hcCwg
NDA5Nik7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MgordHNs
b2dfY3JlYXRlKGludCBpOTE1LCB1aW50MzJfdCBjdHgsIGNvbnN0IHN0cnVjdCBpbnRlbF9leGVj
dXRpb25fZW5naW5lMiAqZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiBv
YmogPSB7CisJCS5oYW5kbGUgPSBiYXRjaF9jcmVhdGUoaTkxNSksCisJCS5mbGFncyA9IEVYRUNf
T0JKRUNUX1NVUFBPUlRTXzQ4Ql9BRERSRVNTLAorCX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9l
eGVjYnVmZmVyMiBleGVjYnVmID0geworCQkuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIo
Jm9iaiksCisJCS5idWZmZXJfY291bnQgPSAxLAorCQkucnN2ZDEgPSBjdHgsCisJCS5mbGFncyA9
IGUtPmZsYWdzLAorCX07CisKKwlvYmoub2Zmc2V0ID0gb2JqLmhhbmRsZSA8PCAxMjsKKwlnZW1f
ZXhlY2J1ZihpOTE1LCAmZXhlY2J1Zik7CisJZ2VtX3N5bmMoaTkxNSwgb2JqLmhhbmRsZSk7CisK
Kwl0c2xvZyhpOTE1LCBlLCBvYmouaGFuZGxlLCBvYmoub2Zmc2V0KTsKKworCW9iai5mbGFncyB8
PSBFWEVDX09CSkVDVF9QSU5ORUQ7CisJcmV0dXJuIG9iajsKK30KKworc3RhdGljIGludCBjbXBf
dTMyKGNvbnN0IHZvaWQgKkEsIGNvbnN0IHZvaWQgKkIpCit7CisJY29uc3QgdWludDMyX3QgKmEg
PSBBLCAqYiA9IEI7CisKKwlpZiAoKmEgPCAqYikKKwkJcmV0dXJuIC0xOworCWVsc2UgaWYgKCph
ID4gKmIpCisJCXJldHVybiAxOworCWVsc2UKKwkJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBib29s
IGhhc19jdHhfdGltZXN0YW1wKGludCBpOTE1LCBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9u
X2VuZ2luZTIgKmUpCit7CisJY29uc3QgaW50IGdlbiA9IGludGVsX2dlbihpbnRlbF9nZXRfZHJt
X2RldmlkKGk5MTUpKTsKKworCWlmIChnZW4gPT0gOCAmJiBlLT5jbGFzcyA9PSBJOTE1X0VOR0lO
RV9DTEFTU19WSURFTykKKwkJcmV0dXJuIGZhbHNlOyAvKiBsb29rcyBmdWJhciAqLworCisJcmV0
dXJuIHRydWU7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIKK3Bp
Y2tfcmFuZG9tX2VuZ2luZShpbnQgaTkxNSwgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9l
bmdpbmUyICpub3QpCit7CisJY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICpl
OworCXVuc2lnbmVkIGludCBjb3VudCA9IDA7CisKKwlfX2Zvcl9lYWNoX3BoeXNpY2FsX2VuZ2lu
ZShpOTE1LCBlKSB7CisJCWlmIChlLT5mbGFncyA9PSBub3QtPmZsYWdzKQorCQkJY29udGludWU7
CisJCWlmICghZ2VtX2NsYXNzX2hhc19tdXRhYmxlX3N1Ym1pc3Npb24oaTkxNSwgZS0+Y2xhc3Mp
KQorCQkJY29udGludWU7CisJCWNvdW50Kys7CisJfQorCWlmICghY291bnQpCisJCXJldHVybiAq
bm90OworCisJY291bnQgPSByYW5kKCkgJSBjb3VudDsKKwlfX2Zvcl9lYWNoX3BoeXNpY2FsX2Vu
Z2luZShpOTE1LCBlKSB7CisJCWlmIChlLT5mbGFncyA9PSBub3QtPmZsYWdzKQorCQkJY29udGlu
dWU7CisJCWlmICghZ2VtX2NsYXNzX2hhc19tdXRhYmxlX3N1Ym1pc3Npb24oaTkxNSwgZS0+Y2xh
c3MpKQorCQkJY29udGludWU7CisJCWlmICghY291bnQtLSkKKwkJCWJyZWFrOworCX0KKworCXJl
dHVybiAqZTsKK30KKworc3RhdGljIHZvaWQgZmFpcl9jaGlsZChpbnQgaTkxNSwgdWludDMyX3Qg
Y3R4LAorCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplLAor
CQkgICAgICAgdWludDY0X3QgZnJhbWVfbnMsCisJCSAgICAgICBpbnQgdGltZWxpbmUsCisJCSAg
ICAgICB1aW50MzJfdCBjb21tb24sCisJCSAgICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MsCisJCSAg
ICAgICB1bnNpZ25lZCBsb25nICpjdGwsCisJCSAgICAgICB1bnNpZ25lZCBsb25nICptZWRpYW4s
CisJCSAgICAgICB1bnNpZ25lZCBsb25nICppcXIpCisjZGVmaW5lIEZfU1lOQwkJKDEgPDwgMCkK
KyNkZWZpbmUgRl9QQUNFCQkoMSA8PCAxKQorI2RlZmluZSBGX0ZMT1cJCSgxIDw8IDIpCisjZGVm
aW5lIEZfSEFMRgkJKDEgPDwgMykKKyNkZWZpbmUgRl9TT0xPCQkoMSA8PCA0KQorI2RlZmluZSBG
X1NQQVJFCQkoMSA8PCA1KQorI2RlZmluZSBGX05FWFQJCSgxIDw8IDYpCisjZGVmaW5lIEZfVklQ
CQkoMSA8PCA3KQorI2RlZmluZSBGX1JSVUwJCSgxIDw8IDgpCisjZGVmaW5lIEZfU0hBUkUJCSgx
IDw8IDkpCisjZGVmaW5lIEZfUElORwkJKDEgPDwgMTApCisjZGVmaW5lIEZfVEhST1RUTEUJKDEg
PDwgMTEpCisjZGVmaW5lIEZfSVNPTEFURQkoMSA8PCAxMikKK3sKKwljb25zdCBpbnQgYmF0Y2hl
c19wZXJfZnJhbWUgPSBmbGFncyAmIEZfU09MTyA/IDEgOiAzOworCXN0cnVjdCBkcm1faTkxNV9n
ZW1fZXhlY19vYmplY3QyIG9ials0XSA9IHsKKwkJe30sCisJCXsKKwkJCS5oYW5kbGUgPSBjb21t
b24gPzogZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KSwKKwkJfSwKKwkJZGVsYXlfY3JlYXRlKGk5MTUs
IGN0eCwgZSwgZnJhbWVfbnMgLyBiYXRjaGVzX3Blcl9mcmFtZSksCisJCWRlbGF5X2NyZWF0ZShp
OTE1LCBjdHgsIGUsIGZyYW1lX25zIC8gYmF0Y2hlc19wZXJfZnJhbWUpLAorCX07CisJc3RydWN0
IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyIHBpbmcgPSAqZTsKKwlpbnQgcF9mZW5jZSA9IC0xLCBu
X2ZlbmNlID0gLTE7CisJdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7CisJaW50IG47CisKKwlzcmFu
ZG9tKGdldHBpZCgpKTsKKwlpZiAoZmxhZ3MgJiBGX1BJTkcpCisJCXBpbmcgPSBwaWNrX3JhbmRv
bV9lbmdpbmUoaTkxNSwgZSk7CisJb2JqWzBdID0gdHNsb2dfY3JlYXRlKGk5MTUsIGN0eCwgJnBp
bmcpOworCisJd2hpbGUgKCFSRUFEX09OQ0UoKmN0bCkpIHsKKwkJc3RydWN0IGRybV9pOTE1X2dl
bV9leGVjYnVmZmVyMiBleGVjYnVmID0geworCQkJLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2lu
dGVyKG9iaiksCisJCQkuYnVmZmVyX2NvdW50ID0gMywKKwkJCS5yc3ZkMSA9IGN0eCwKKwkJCS5y
c3ZkMiA9IC0xLAorCQkJLmZsYWdzID0gZS0+ZmxhZ3MsCisJCX07CisKKwkJaWYgKGZsYWdzICYg
Rl9GTE9XKSB7CisJCQl1bnNpZ25lZCBpbnQgc2VxOworCisJCQlzZXEgPSBjb3VudDsKKwkJCWlm
IChmbGFncyAmIEZfTkVYVCkKKwkJCQlzZXErKzsKKworCQkJZXhlY2J1Zi5yc3ZkMiA9CisJCQkJ
c3dfc3luY190aW1lbGluZV9jcmVhdGVfZmVuY2UodGltZWxpbmUsIHNlcSk7CisJCQlleGVjYnVm
LmZsYWdzIHw9IEk5MTVfRVhFQ19GRU5DRV9JTjsKKwkJfQorCisJCWV4ZWNidWYuZmxhZ3MgfD0g
STkxNV9FWEVDX0ZFTkNFX09VVDsKKwkJZ2VtX2V4ZWNidWZfd3IoaTkxNSwgJmV4ZWNidWYpOwor
CQluX2ZlbmNlID0gZXhlY2J1Zi5yc3ZkMiA+PiAzMjsKKwkJZXhlY2J1Zi5mbGFncyAmPSB+KEk5
MTVfRVhFQ19GRU5DRV9PVVQgfCBJOTE1X0VYRUNfRkVOQ0VfSU4pOworCQlmb3IgKG4gPSAxOyBu
IDwgYmF0Y2hlc19wZXJfZnJhbWU7IG4rKykKKwkJCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVm
KTsKKwkJY2xvc2UoZXhlY2J1Zi5yc3ZkMik7CisKKwkJZXhlY2J1Zi5idWZmZXJfY291bnQgPSAx
OworCQlleGVjYnVmLmJhdGNoX3N0YXJ0X29mZnNldCA9IDIwNDg7CisJCWV4ZWNidWYuZmxhZ3Mg
PSBwaW5nLmZsYWdzIHwgSTkxNV9FWEVDX0ZFTkNFX0lOOworCQlleGVjYnVmLnJzdmQyID0gbl9m
ZW5jZTsKKwkJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCisJCWlmIChmbGFncyAmIEZf
UEFDRSAmJiBwX2ZlbmNlICE9IC0xKSB7CisJCQlzdHJ1Y3QgcG9sbGZkIHBmZCA9IHsKKwkJCQku
ZmQgPSBwX2ZlbmNlLAorCQkJCS5ldmVudHMgPSBQT0xMSU4sCisJCQl9OworCQkJcG9sbCgmcGZk
LCAxLCAtMSk7CisJCX0KKwkJY2xvc2UocF9mZW5jZSk7CisKKwkJaWYgKGZsYWdzICYgRl9TWU5D
KSB7CisJCQlzdHJ1Y3QgcG9sbGZkIHBmZCA9IHsKKwkJCQkuZmQgPSBuX2ZlbmNlLAorCQkJCS5l
dmVudHMgPSBQT0xMSU4sCisJCQl9OworCQkJcG9sbCgmcGZkLCAxLCAtMSk7CisJCX0KKworCQlp
ZiAoZmxhZ3MgJiBGX1RIUk9UVExFKQorCQkJaWd0X2lvY3RsKGk5MTUsIERSTV9JT0NUTF9JOTE1
X0dFTV9USFJPVFRMRSwgMCk7CisKKwkJaWd0X3N3YXAob2JqWzJdLCBvYmpbM10pOworCQlpZ3Rf
c3dhcChwX2ZlbmNlLCBuX2ZlbmNlKTsKKwkJY291bnQrKzsKKwl9CisJY2xvc2UocF9mZW5jZSk7
CisKKwlnZW1fY2xvc2UoaTkxNSwgb2JqWzNdLmhhbmRsZSk7CisJZ2VtX2Nsb3NlKGk5MTUsIG9i
alsyXS5oYW5kbGUpOworCWlmIChvYmpbMV0uaGFuZGxlICE9IGNvbW1vbikKKwkJZ2VtX2Nsb3Nl
KGk5MTUsIG9ialsxXS5oYW5kbGUpOworCisJZ2VtX3N5bmMoaTkxNSwgb2JqWzBdLmhhbmRsZSk7
CisJaWYgKG1lZGlhbikgeworCQl1aW50MzJfdCAqbWFwOworCisJCS8qCisJCSAqIFdlIHJlY29y
ZGVkIHRoZSBDU19USU1FU1RBTVAgb2YgZWFjaCBmcmFtZSwgYW5kIGlmCisJCSAqIHRoZSBHUFUg
aXMgYmVpbmcgc2hhcmVkIGNvbXBsZXRlbHkgZmFpcmx5LCB3ZSBleHBlY3QKKwkJICogZWFjaCBm
cmFtZSB0byBiZSBhdCB0aGUgc2FtZSBpbnRlcnZhbCBmcm9tIHRoZSBsYXN0LgorCQkgKgorCQkg
KiBDb21wdXRlIHRoZSBpbnRlcnZhbCBiZXR3ZWVuIGZyYW1lcyBhbmQgcmVwb3J0IGJhY2sKKwkJ
ICogYm90aCB0aGUgbWVkaWFuIGludGVydmFsIGFuZCB0aGUgcmFuZ2UgZm9yIHRoaXMgY2xpZW50
LgorCQkgKi8KKworCQltYXAgPSBnZW1fbW1hcF9fZGV2aWNlX2NvaGVyZW50KGk5MTUsIG9ialsw
XS5oYW5kbGUsCisJCQkJCQkwLCA0MDk2LCBQUk9UX1dSSVRFKTsKKwkJZm9yIChuID0gMTsgbiA8
IG1pbihjb3VudCwgNTEyKTsgbisrKSB7CisJCQlpZ3RfYXNzZXJ0KG1hcFtuXSk7CisJCQltYXBb
biAtIDFdID0gbWFwW25dIC0gbWFwW24gLSAxXTsKKwkJfQorCQlxc29ydChtYXAsIC0tbiwgc2l6
ZW9mKCptYXApLCBjbXBfdTMyKTsKKwkJKmlxciA9IHRpY2tzX3RvX25zKGk5MTUsIG1hcFsoMyAq
IG4gKyAzKSAvIDRdIC0gbWFwW24gLyA0XSk7CisJCSptZWRpYW4gPSB0aWNrc190b19ucyhpOTE1
LCBtYXBbbiAvIDJdKTsKKwkJbXVubWFwKG1hcCwgNDA5Nik7CisJfQorCWdlbV9jbG9zZShpOTE1
LCBvYmpbMF0uaGFuZGxlKTsKK30KKworc3RhdGljIGludCBjbXBfdWwoY29uc3Qgdm9pZCAqQSwg
Y29uc3Qgdm9pZCAqQikKK3sKKwljb25zdCB1bnNpZ25lZCBsb25nICphID0gQSwgKmIgPSBCOwor
CisJaWYgKCphIDwgKmIpCisJCXJldHVybiAtMTsKKwllbHNlIGlmICgqYSA+ICpiKQorCQlyZXR1
cm4gMTsKKwllbHNlCisJCXJldHVybiAwOworfQorCitzdGF0aWMgdWludDY0X3QgZF9jcHVfdGlt
ZShjb25zdCBzdHJ1Y3QgcnVzYWdlICphLCBjb25zdCBzdHJ1Y3QgcnVzYWdlICpiKQoreworCXVp
bnQ2NF90IGNwdV90aW1lID0gMDsKKworCWNwdV90aW1lICs9IChhLT5ydV91dGltZS50dl9zZWMg
LSBiLT5ydV91dGltZS50dl9zZWMpICogTlNFQ19QRVJfU0VDOworCWNwdV90aW1lICs9IChhLT5y
dV91dGltZS50dl91c2VjIC0gYi0+cnVfdXRpbWUudHZfdXNlYykgKiAxMDAwOworCisJY3B1X3Rp
bWUgKz0gKGEtPnJ1X3N0aW1lLnR2X3NlYyAtIGItPnJ1X3N0aW1lLnR2X3NlYykgKiBOU0VDX1BF
Ul9TRUM7CisJY3B1X3RpbWUgKz0gKGEtPnJ1X3N0aW1lLnR2X3VzZWMgLSBiLT5ydV9zdGltZS50
dl91c2VjKSAqIDEwMDA7CisKKwlyZXR1cm4gY3B1X3RpbWU7Cit9CisKK3N0YXRpYyB2b2lkIHRp
bWVsaW5lX2FkdmFuY2UoaW50IHRpbWVsaW5lLCBpbnQgZGVsYXlfbnMpCit7CisJc3RydWN0IHRp
bWVzcGVjIHR2ID0geyAudHZfbnNlYyA9IGRlbGF5X25zIH07CisJbmFub3NsZWVwKCZ0diwgTlVM
TCk7CisJc3dfc3luY190aW1lbGluZV9pbmModGltZWxpbmUsIDEpOworfQorCitzdGF0aWMgdm9p
ZCBmYWlybmVzcyhpbnQgaTkxNSwKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9u
X2VuZ2luZTIgKmUsCisJCSAgICAgaW50IHRpbWVvdXQsIHVuc2lnbmVkIGludCBmbGFncykKK3sK
Kwljb25zdCBpbnQgZnJhbWVfbnMgPSAxNjY2NiAqIDEwMDA7CisJY29uc3QgaW50IGZlbmNlX25z
ID0gZmxhZ3MgJiBGX0hBTEYgPyAyICogZnJhbWVfbnMgOiBmcmFtZV9uczsKKwl1bnNpZ25lZCBs
b25nICpyZXN1bHQsICppcXI7CisJdWludDMyX3QgY29tbW9uID0gMDsKKworCWlndF9yZXF1aXJl
KGhhc19jdHhfdGltZXN0YW1wKGk5MTUsIGUpKTsKKwlpZ3RfcmVxdWlyZShnZW1fY2xhc3NfaGFz
X211dGFibGVfc3VibWlzc2lvbihpOTE1LCBlLT5jbGFzcykpOworCisJaWYgKGZsYWdzICYgRl9T
SEFSRSkKKwkJY29tbW9uID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk1KTsKKworCXJlc3VsdCA9IG1t
YXAoTlVMTCwgNDA5NiwgUFJPVF9XUklURSwgTUFQX1NIQVJFRCB8IE1BUF9BTk9OLCAtMSwgMCk7
CisJaWd0X2Fzc2VydChyZXN1bHQgIT0gTUFQX0ZBSUxFRCk7CisJaXFyID0gbW1hcChOVUxMLCA0
MDk2LCBQUk9UX1dSSVRFLCBNQVBfU0hBUkVEIHwgTUFQX0FOT04sIC0xLCAwKTsKKwlpZ3RfYXNz
ZXJ0KGlxciAhPSBNQVBfRkFJTEVEKTsKKworCS8qCisJICogVGhlIGNvbWJpbmVkIHdvcmtsb2Fk
IGFsd2F5cyBydW5zIGF0IGEgNjBmcHMgdGFyZ2V0ICh1bmxlc3MgRl9IQUxGISkuCisJICogVGhp
cyBnaXZlcyBhIGZyYW1lIG9mIGludGVydmFsIG9mIDE2bXMgdGhhdCBpcyBldmVubHkgc3BsaXQg
YWNyb3NzCisJICogYWxsIHRoZSBjbGllbnRzLCBzbyBzaW11bGF0aW5nIGEgc3lzdGVtIHdpdGgg
YSBidW5jaCBvZiBjbGllbnRzIHRoYXQKKwkgKiBhcmUgcGVyZmVjdGx5IGJhbGFuY2VkIGFuZCBj
YW4gc3VzdGFpbiA2MGZwcy4gT3VyIGpvYiBpcyB0byBlbnN1cmUKKwkgKiB0aGF0IGVhY2ggY2xp
ZW50IGRvZXMgcnVuIGF0IGEgc21vb3RoIDYwZnBzLgorCSAqCisJICogRWFjaCBjbGllbnQgcnVu
cyBhIGZpeGVkIGxlbmd0aCBkZWxheSBsb29wIChhcyBhIHNpbmdsZSByZXF1ZXN0LAorCSAqIG9y
IHNwbGl0IGludG8gMykgYW5kIHRoZW4gcmVjb3JkcyB0aGUgQ1NfVElNRVNUQU1QIGFmdGVyIGNv
bXBsZXRpbmcKKwkgKiBpdHMgZGVsYXkuIEdpdmVuIGEgZmFpciBhbGxvdG1lbnQgb2YgR1BVIHRp
bWUgdG8gZWFjaCBjbGllbnQsCisJICogdGhhdCB0aW1lc3RhbXAgd2lsbCBbaWRlYWxseV0gYmUg
YXQgYSBwcmVjaXNlIDE2bXMgaW50ZXJ2YWxzLgorCSAqIEluIHByYWN0aWNlLCB0aW1lIGlzIHdh
c3RlZCBvbiBjb250ZXh0IHN3aXRjaGVzLCBzbyBhcyB0aGUgbnVtYmVyCisJICogb2YgY2xpZW50
cyBpbmNyZWFzZXMsIHRoZSBwcm9wcm90aW9uIG9mIHRpbWUgc3BlbnQgb24gY29udGV4dAorCSAq
IHN3aXRjaGVzIGdyb3dzLiBBcyB3ZSBnZXQgdG8gNjQgcmVuZGVyIGNsaWVudHMsIHdlIHdpbGwg
YmUgc3BlbmRpbmcKKwkgKiBhcyBtdWNoIHRpbWUgaW4gY29udGV4dCBzd2l0Y2hlcyBhcyBleGVj
dXRpbmcgdGhlIGNsaWVudCB3b3JrbG9hZHMuCisJICoKKwkgKiBFYWNoIGNsaWVudCBmcmFtZSBt
YXkgYmUgcGFjZWQgYnkgc29tZSB0aHJvdHRsaW5nIHRlY2huaXF1ZSBmb3VuZAorCSAqIGluIHRo
ZSB3aWxkLiBpLmUuIGVhY2ggY2xpZW50IG1heSB3YWl0IHVudGlsIGEgc2ltdWxhdGVkIHZibGFu
aworCSAqIHRvIGluZGljYXRlIHRoZSBzdGFydCBvZiBhIG5ldyBmcmFtZSwgb3IgaXQgbWF5IHdh
aXQgdW50aWwgdGhlCisJICogY29tcGxldGlvbiBvZiBhIHByZXZpb3VzIGZyYW1lLiBUaGlzIGNh
dXNlcyBzdWJtaXNzaW9uIGZyb20gZWFjaAorCSAqIGNsaWVudCBhbmQgYWNyb3NzIHRoZSBzeXN0
ZW0gdG8gYmUgY2h1bmt5IGFuZCB1bmV2ZW4uCisJICoKKwkgKiBXZSBsb29rIGF0IHRoZSB2YXJp
YXRpb24gb2YgZnJhbWUgaW50ZXJ2YWxzIHdpdGhpbiBlYWNoIGNsaWVudCwgYW5kCisJICogdGhl
IHZhcmlhdGlvbiBvZiB0aGUgbWVkaWFucyBhY3Jvc3MgdGhlIGNsaWVudHMgdG8gc2VlIGlmIHRo
ZQorCSAqIGRpc3RyaWJ1dGlvbiAoYnVkZ2V0KSBvZiBHUFUgdGltZSB3YXMgZmFpciBlbm91Z2gu
CisJICoKKwkgKiBBbHRlcm5hdGl2ZSAoYW5kIGltcG9ydGFudCkgbWV0cmljcyB3aWxsIGJlIG1v
cmUgbGF0ZW5jeSBjZW50cmljOworCSAqIGxvb2tpbmcgYXQgaG93IHdlbGwgd2UgY2FuIHN1c3Rh
aW4gbWVldGluZyBkZWFkbGluZSBnaXZlbiBjb21wZXRpdGlvbgorCSAqIGJ5IGNsaWVudHMgZm9y
IHRoZSBHUFUuCisJICovCisKKwlmb3IgKGludCBuID0gMjsgbiA8PSAyNTY7IG4gPDw9IDEpIHsg
LyogMzIgPT0gNTAwdXMgcGVyIGNsaWVudCAqLworCQlpbnQgdGltZWxpbmUgPSBzd19zeW5jX3Rp
bWVsaW5lX2NyZWF0ZSgpOworCQlpbnQgbmZlbmNlcyA9IHRpbWVvdXQgKiBOU0VDX1BFUl9TRUMg
LyBmZW5jZV9ucyArIDE7CisJCWludCBuY2hpbGQgPSBuIC0gMTsgLyogb2RkIGZvciBlYXN5IG1l
ZGlhbnMgKi8KKwkJY29uc3QgaW50IGNoaWxkX25zID0gZnJhbWVfbnMgLyAobmNoaWxkICsgISEo
ZmxhZ3MgJiBGX1NQQVJFKSk7CisJCWNvbnN0IGludCBsbyA9IG5jaGlsZCAvIDQ7CisJCWNvbnN0
IGludCBoaSA9ICgzICogbmNoaWxkICsgMykgLyA0IC0gMTsKKwkJc3RydWN0IHJ1c2FnZSBvbGRf
dXNhZ2UsIHVzYWdlOworCQl1aW50NjRfdCBjcHVfdGltZSwgZF90aW1lOworCQlzdHJ1Y3QgdGlt
ZXNwZWMgdHY7CisJCXN0cnVjdCBpZ3RfbWVhbiBtOworCisJCW1lbXNldChyZXN1bHQsIDAsIChu
Y2hpbGQgKyAxKSAqIHNpemVvZihyZXN1bHRbMF0pKTsKKworCQlpZiAoZmxhZ3MgJiBGX1BJTkcp
IHsgLyogZmlsbCB0aGUgb3RoZXJzIHdpdGggbGlnaHQgYmcgbG9hZCAqLworCQkJc3RydWN0IGlu
dGVsX2V4ZWN1dGlvbl9lbmdpbmUyICpwaW5nOworCisJCQlfX2Zvcl9lYWNoX3BoeXNpY2FsX2Vu
Z2luZShpOTE1LCBwaW5nKSB7CisJCQkJaWYgKHBpbmctPmZsYWdzID09IGUtPmZsYWdzKQorCQkJ
CQljb250aW51ZTsKKworCQkJCWlndF9mb3JrKGNoaWxkLCAxKSB7CisJCQkJCXVpbnQzMl90IGN0
eCA9IGdlbV9jb250ZXh0X2Nsb25lX3dpdGhfZW5naW5lcyhpOTE1LCAwKTsKKworCQkJCQlmYWly
X2NoaWxkKGk5MTUsIGN0eCwgcGluZywKKwkJCQkJCSAgIGNoaWxkX25zIC8gOCwKKwkJCQkJCSAg
IC0xLCBjb21tb24sCisJCQkJCQkgICBGX1NPTE8gfCBGX1BBQ0UgfCBGX1NIQVJFLAorCQkJCQkJ
ICAgJnJlc3VsdFtuY2hpbGRdLAorCQkJCQkJICAgTlVMTCwgTlVMTCk7CisKKwkJCQkJZ2VtX2Nv
bnRleHRfZGVzdHJveShpOTE1LCBjdHgpOworCQkJCX0KKwkJCX0KKwkJfQorCisJCWdldHJ1c2Fn
ZShSVVNBR0VfQ0hJTERSRU4sICZvbGRfdXNhZ2UpOworCQlpZ3RfbnNlY19lbGFwc2VkKG1lbXNl
dCgmdHYsIDAsIHNpemVvZih0dikpKTsKKwkJaWd0X2ZvcmsoY2hpbGQsIG5jaGlsZCkgeworCQkJ
dWludDMyX3QgY3R4OworCisJCQlpZiAoZmxhZ3MgJiBGX0lTT0xBVEUpIHsKKwkJCQlpbnQgY2xv
bmUsIGRtYWJ1ZiA9IC0xOworCisJCQkJaWYgKGNvbW1vbikKKwkJCQkJZG1hYnVmID0gcHJpbWVf
aGFuZGxlX3RvX2ZkKGk5MTUsIGNvbW1vbik7CisKKwkJCQljbG9uZSA9IGdlbV9yZW9wZW5fZHJp
dmVyKGk5MTUpOworCQkJCWdlbV9jb250ZXh0X2NvcHlfZW5naW5lcyhpOTE1LCAwLCBjbG9uZSwg
MCk7CisJCQkJaTkxNSA9IGNsb25lOworCisJCQkJaWYgKGRtYWJ1ZiAhPSAtMSkKKwkJCQkJY29t
bW9uID0gcHJpbWVfZmRfdG9faGFuZGxlKGk5MTUsIGRtYWJ1Zik7CisJCQl9CisKKwkJCWN0eCA9
IGdlbV9jb250ZXh0X2Nsb25lX3dpdGhfZW5naW5lcyhpOTE1LCAwKTsKKworCQkJaWYgKGZsYWdz
ICYgRl9WSVAgJiYgY2hpbGQgPT0gMCkgeworCQkJCWdlbV9jb250ZXh0X3NldF9wcmlvcml0eShp
OTE1LCBjdHgsIE1BWF9QUklPKTsKKwkJCQlmbGFncyB8PSBGX0ZMT1c7CisJCQl9CisJCQlpZiAo
ZmxhZ3MgJiBGX1JSVUwgJiYgY2hpbGQgPT0gMCkKKwkJCQlmbGFncyB8PSBGX1NPTE8gfCBGX0ZM
T1cgfCBGX1NZTkM7CisKKwkJCWZhaXJfY2hpbGQoaTkxNSwgY3R4LCBlLCBjaGlsZF9ucywKKwkJ
CQkgICB0aW1lbGluZSwgY29tbW9uLCBmbGFncywKKwkJCQkgICAmcmVzdWx0W25jaGlsZF0sCisJ
CQkJICAgJnJlc3VsdFtjaGlsZF0sICZpcXJbY2hpbGRdKTsKKworCQkJZ2VtX2NvbnRleHRfZGVz
dHJveShpOTE1LCBjdHgpOworCQl9CisKKwkJd2hpbGUgKG5mZW5jZXMtLSkKKwkJCXRpbWVsaW5l
X2FkdmFuY2UodGltZWxpbmUsIGZlbmNlX25zKTsKKworCQlyZXN1bHRbbmNoaWxkXSA9IDE7CisJ
CWZvciAoaW50IGNoaWxkID0gMDsgY2hpbGQgPCBuY2hpbGQ7IGNoaWxkKyspIHsKKwkJCXdoaWxl
ICghUkVBRF9PTkNFKHJlc3VsdFtjaGlsZF0pKQorCQkJCXRpbWVsaW5lX2FkdmFuY2UodGltZWxp
bmUsIGZlbmNlX25zKTsKKwkJfQorCisJCWlndF93YWl0Y2hpbGRyZW4oKTsKKwkJY2xvc2UodGlt
ZWxpbmUpOworCisJCS8qCisJCSAqIEFyZSB3ZSBydW5uaW5nIG91dCBvZiBDUFUgdGltZSwgYW5k
IGZhaWwgdG8gc3VibWl0IGZyYW1lcz8KKwkJICoKKwkJICogV2UgdHJ5IHRvIHJ1bGUgb3V0IGFu
eSB1bmR1ZSBpbXBhY3Qgb24gdGhlIEdQVSBzY2hlZHVsaW5nCisJCSAqIGZyb20gdGhlIENQVSBz
Y2hlZHVsZXIgYnkgbG9va2luZyBmb3IgY29yZSBzYXR1cmF0aW9uLiBJZgorCQkgKiB3ZSBtYXkg
YmUgaW4gYSBzaXR1YXRpb24gd2hlcmUgdGhlIGNsaWVudHMgKyBrZXJuZWwgYXJlCisJCSAqIHRh
a2luZyBhIHdob2xlIGNvcmUgKHRoaW5rIGxvY2tkZXApLCB0aGVuIGl0IGlzIGluY3JlYXNpbmds
eQorCQkgKiBsaWtlbHkgdGhhdCBvdXIgbWVhc3VyZW1lbnRzIGluY2x1ZGUgZGVsYXlzIGZyb20g
dGhlIENQVQorCQkgKiBzY2hlZHVsZXIuIEVyciBvbiB0aGUgc2lkZSBvZiBjYXV0aW9uLgorCQkg
Ki8KKwkJZF90aW1lID0gaWd0X25zZWNfZWxhcHNlZCgmdHYpOworCQlnZXRydXNhZ2UoUlVTQUdF
X0NISUxEUkVOLCAmdXNhZ2UpOworCQljcHVfdGltZSA9IGRfY3B1X3RpbWUoJnVzYWdlLCAmb2xk
X3VzYWdlKTsKKwkJaWd0X2RlYnVnKCJDUFUgdXNhZ2U6ICUuMGYlJVxuIiwgMTAwLiAqIGNwdV90
aW1lIC8gZF90aW1lKTsKKwkJaWYgKDQgKiBjcHVfdGltZSA+IDMgKiBkX3RpbWUpIHsKKwkJCWlm
IChuY2hpbGQgPiA3KSAvKiBnb29kIGVub3VnaCB0byBqdWRnZSBwYXNzL2ZhaWwgKi8KKwkJCQli
cmVhazsKKworCQkJaWd0X3NraXBfb25fZig0ICogY3B1X3RpbWUgPiAzICogZF90aW1lLAorCQkJ
CSAgICAgICIlLjBmJSUgQ1BVIHVzYWdlLCBwcmVzdW1pbmcgY2FwYWNpdHkgZXhjZWVkZWRcbiIs
CisJCQkJICAgICAgMTAwLiAqIGNwdV90aW1lIC8gZF90aW1lKTsKKwkJfQorCisJCS8qIFdpdGgg
bm8gY29udGVudGlvbiwgd2Ugc2hvdWxkIG1hdGNoIG91ciB0YXJnZXQgZnJhbWV0aW1lICovCisJ
CWlmIChuY2hpbGQgPT0gMSkgeworCQkJaWd0X2Fzc2VydCg0ICogcmVzdWx0WzBdID4gMyAqIGZl
bmNlX25zICYmCisJCQkJICAgMyAqIHJlc3VsdFswXSA8IDQgKiBmZW5jZV9ucyk7CisJCQljb250
aW51ZTsKKwkJfQorCisJCS8qCisJCSAqIFRoZSBWSVAgc2hvdWxkIGFsd2F5cyBiZSBhYmxlIHRv
IGhpdCB0aGUgdGFyZ2V0IGZyYW1lIHJhdGU7CisJCSAqIHJlZ2FyZGxlc3Mgb2YgYnVkZ2V0IGNv
bnRlbnRpb24gZnJvbSBsZXNzb3IgY2xpZW50cy4KKwkJICovCisJCWlmIChmbGFncyAmIChGX1ZJ
UCB8IEZfUlJVTCkpIHsKKwkJCWlndF9pbmZvKCJWSVAgaW50ZXJ2YWwgJS4yZm1zLCByYW5nZSAl
LjJmbXNcbiIsCisJCQkJIDFlLTYgKiByZXN1bHRbMF0sIDFlLTYgKiBpcXJbMF0pOworCQkJaWd0
X2Fzc2VydF9mKDQgKiByZXN1bHRbMF0gPiAzICogZmVuY2VfbnMgJiYKKwkJCQkgICAgIDMgKiBy
ZXN1bHRbMF0gPCA0ICogZmVuY2VfbnMsCisJCQkJICAgICAiVklQIGV4cGVjdHMgdG8gcnVuIGV4
YWN0bHkgd2hlbiBpdCB3YW50cywgZXhwZWN0cyBhbiBpbnRlcnZhbCBvZiAlLjJmbXMsIHdhcyAl
LjJmbXNcbiIsCisJCQkJICAgICAxZS02ICogZmVuY2VfbnMsIDFlLTYgKiByZXN1bHRbMF0pOwor
CQkJaWd0X2Fzc2VydF9mKDIgKiBpcXJbMF0gPCByZXN1bHRbMF0sCisJCQkJICAgICAiVklQIGZy
YW1lIElRUiAlLjJmbXMgZXhjZWVkZWQgbWVkaWFuIHRocmVzaG9sZCAlLjJmbXNcbiIsCisJCQkJ
ICAgICAxZS02ICogaXFyWzBdLAorCQkJCSAgICAgMWUtNiAqIHJlc3VsdFswXSAvIDIpOworCQkJ
aWYgKCEtLW5jaGlsZCkKKwkJCQljb250aW51ZTsKKworCQkJLyogRXhjbHVkZSB0aGUgVklQIHJl
c3VsdCBmcm9tIHRoZSBwbGViaWFuIHN0YXRpc3RpY3MgKi8KKwkJCW1lbW1vdmUocmVzdWx0LCBy
ZXN1bHQgKyAxLCBuY2hpbGQgKiBzaXplb2YoKnJlc3VsdCkpOworCQkJbWVtbW92ZShpcXIsIGlx
ciArIDEsIG5jaGlsZCAqIHNpemVvZigqaXFyKSk7CisJCX0KKworCQlpZ3RfbWVhbl9pbml0KCZt
KTsKKwkJZm9yIChpbnQgY2hpbGQgPSAwOyBjaGlsZCA8IG5jaGlsZDsgY2hpbGQrKykKKwkJCWln
dF9tZWFuX2FkZCgmbSwgcmVzdWx0W2NoaWxkXSk7CisKKwkJcXNvcnQocmVzdWx0LCBuY2hpbGQs
IHNpemVvZigqcmVzdWx0KSwgY21wX3VsKTsKKwkJcXNvcnQoaXFyLCBuY2hpbGQsIHNpemVvZigq
aXFyKSwgY21wX3VsKTsKKworCQkvKgorCQkgKiBUaGUgdGFyZ2V0IGludGVydmFsIGZvciBtZWRp
YW4vbWVhbiBpcyAxNm1zIChmZW5jZV9ucykuCisJCSAqIEhvd2V2ZXIsIHRoaXMgd29yayBpcyBl
dmVubHkgc3BsaXQgYWNyb3NzIHRoZSBjbGllbnRzIHNvCisJCSAqIHRoZSByYW5nZSAoYW5kIG1l
ZGlhbikgb2YgY2xpZW50IG1lZGlhbnMgbWF5IGJlIG11Y2ggbGVzcworCQkgKiB0aGFuIDE2bXMg
WzE2LzNOXS4gV2UgcHJlc2VudCBtZWRpYW4gb2YgbWVkaWFucyB0byB0cnkKKwkJICogYW5kIGF2
b2lkIGFueSBpbnN0YWJpbGl0eSB3aGlsZSBydW5uaW5nIGluIENJOyBhdCB0aGUgY29zdAorCQkg
KiBvZiBpbnNlbnNpdGl2aXR5IQorCQkgKi8KKwkJaWd0X2luZm8oIiUzZCBjbGllbnRzLCByYW5n
ZTogWyUuMWYsICUuMWZdLCBpcXI6IFslLjFmLCAlLjFmXSwgbWVkaWFuOiAlLjFmIFslLjFmLCAl
LjFmXSwgbWVhbjogJS4xZiDCsSAlLjJmIG1zLCBjcHU6ICUuMGYlJVxuIiwKKwkJCSBuY2hpbGQs
CisJCQkgMWUtNiAqIHJlc3VsdFswXSwgIDFlLTYgKiByZXN1bHRbbmNoaWxkIC0gMV0sCisJCQkg
MWUtNiAqIHJlc3VsdFtsb10sIDFlLTYgKiByZXN1bHRbaGldLAorCQkJIDFlLTYgKiByZXN1bHRb
bmNoaWxkIC8gMl0sCisJCQkgMWUtNiAqIGlxcltsb10sIDFlLTYgKiBpcXJbaGldLAorCQkJIDFl
LTYgKiBpZ3RfbWVhbl9nZXQoJm0pLAorCQkJIDFlLTYgKiBzcXJ0KGlndF9tZWFuX2dldF92YXJp
YW5jZSgmbSkpLAorCQkJIDEwMC4gKiBjcHVfdGltZSAvIGRfdGltZSk7CisKKwkJaWd0X2Fzc2Vy
dF9mKGlxcltuY2hpbGQgLyAyXSA8IDIgKiByZXN1bHRbbmNoaWxkIC8gMl0sCisJCQkgICAgICJD
aGlsZCBmcmFtZSBJUVIgJS4yZm1zIGV4Y2VlZGVkIG1lZGlhbiB0aHJlc2hvbGQgJS4yZm1zXG4i
LAorCQkJICAgICAxZS02ICogaXFyW25jaGlsZCAvIDJdLAorCQkJICAgICAxZS02ICogcmVzdWx0
W25jaGlsZCAvIDJdICogMik7CisKKwkJaWd0X2Fzc2VydF9mKDQgKiBpZ3RfbWVhbl9nZXQoJm0p
ID4gMyAqIHJlc3VsdFtuY2hpbGQgLyAyXSAmJgorCQkJICAgICAzICogaWd0X21lYW5fZ2V0KCZt
KSA8IDQgKiByZXN1bHRbbmNoaWxkIC8gMl0sCisJCQkgICAgICJNZWFuIG9mIGNsaWVudCBpbnRl
cnZhbCAlLjJmbXMgZGlmZmVycyBmcm9tIG1lZGlhbiAlLjJmbXMsIGRpc3RyaWJ1dGlvbiBpcyBz
a2V3ZWRcbiIsCisKKwkJCSAgICAgMWUtNiAqIGlndF9tZWFuX2dldCgmbSksIDFlLTYgKiByZXN1
bHRbbmNoaWxkIC8gMl0pOworCisJCWlndF9hc3NlcnRfZihyZXN1bHRbbmNoaWxkIC8gMl0gPiBm
cmFtZV9ucyAvIDIsCisJCQkgICAgICJNZWRpYW4gY2xpZW50IGludGVydmFsICUuMmZtcyBkaWQg
bm90IG1hdGNoIHRhcmdldCBpbnRlcnZhbCAlLjJmbXNcbiIsCisJCQkgICAgIDFlLTYgKiByZXN1
bHRbbmNoaWxkIC8gMl0sIDFlLTYgKiBmcmFtZV9ucyk7CisKKworCQlpZ3RfYXNzZXJ0X2YocmVz
dWx0W2hpXSAtIHJlc3VsdFtsb10gPCByZXN1bHRbbmNoaWxkIC8gMl0sCisJCQkgICAgICJJbnRl
cnF1YXJ0aWxlIHJhbmdlIG9mIGNsaWVudCBpbnRlcnZhbHMgJS4yZm1zIGlzIGFzIGxhcmdlIGFz
IHRoZSBtZWRpYW4gdGhyZXNob2xkICUuMmZtcywgY2xpZW50cyBhcmUgbm90IGV2ZW5seSBkaXN0
cmlidXRlZCFcbiIsCisJCQkgICAgIDFlLTYgKiAocmVzdWx0W2hpXSAtIHJlc3VsdFtsb10pLAor
CQkJICAgICAxZS02ICogcmVzdWx0W25jaGlsZCAvIDJdKTsKKworCQkvKiBNYXkgYmUgc2xvd2Vk
IGR1ZSB0byBzaGVlciB2b2x1bWUgb2YgY29udGV4dCBzd2l0Y2hlcyAqLworCQlpZiAocmVzdWx0
WzBdID4gMiAqIGZlbmNlX25zKQorCQkJYnJlYWs7CisJfQorCisJbXVubWFwKGlxciwgNDA5Nik7
CisJbXVubWFwKHJlc3VsdCwgNDA5Nik7CisJaWYgKGNvbW1vbikKKwkJZ2VtX2Nsb3NlKGk5MTUs
IGNvbW1vbik7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfZmFpcm5lc3MoaW50IGk5MTUsIGludCB0
aW1lb3V0KQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3QgeworCQljb25zdCBjaGFyICpuYW1lOwor
CQl1bnNpZ25lZCBpbnQgZmxhZ3M7CisJfSBmYWlyW10gPSB7CisJCS8qCisJCSAqIG5vbmUgLSBt
YXhpbWFsIGdyZWVkIGluIGVhY2ggY2xpZW50CisJCSAqCisJCSAqIFB1c2ggYXMgbWFueSBmcmFt
ZXMgZnJvbSBlYWNoIGNsaWVudCBhcyBmYXN0IGFzIHBvc3NpYmxlCisJCSAqLworCQl7ICJub25l
IiwgICAgICAgMCB9LAorCQl7ICJub25lLXZpcCIsICAgRl9WSVAgfSwgLyogb25lIHZpcCBjbGll
bnQgbXVzdCBtZWV0IGRlYWRsaW5lcyAqLworCQl7ICJub25lLXNvbG8iLCAgRl9TT0xPIH0sIC8q
IDEgYmF0Y2ggcGVyIGZyYW1lIHBlciBjbGllbnQgKi8KKwkJeyAibm9uZS1zaGFyZSIsIEZfU0hB
UkUgfSwgLyogcmVhZCBmcm9tIGEgY29tbW9uIGJ1ZmZlciAqLworCQl7ICJub25lLXJydWwiLCAg
Rl9SUlVMIH0sIC8qICJyZWFsdGltZS1yZXNwb25zZSB1bmRlciBsb2FkIiAqLworCQl7ICJub25l
LXBpbmciLCAgRl9QSU5HIH0sIC8qIG1lYXN1cmUgaW50ZXItZW5naW5lIGZhaXJuZXNzICovCisK
KwkJLyoKKwkJICogdGhyb3R0bGUgLSBvcmlnaW5hbCBwZXIgY2xpZW50IHRocm90dGxpbmcKKwkJ
ICoKKwkJICogVXNlZCBmb3IgZnJvbnQgYnVmZmVyaW5nIHJlbmRlcmluZyB3aGVyZSB0aGVyZSBp
cyBubworCQkgKiBleHRlbmFsIGZyYW1lIG1hcmtlci4gRWFjaCBjbGllbnQgdHJpZXMgdG8gb25s
eSBrZWVwCisJCSAqIDIwbXMgb2Ygd29yayBzdWJtaXR0ZWQsIHRob3VnaCB0aGF0IG1lYXN1cmVt
ZW50IGlzCisJCSAqIGZsYXdlZC4uLgorCQkgKgorCQkgKiBUaGlzIGlzIHVzZWQgYnkgWG9yZyB0
byB0cnkgYW5kIG1haW50YWluIHNvbWUgcmVzZW1iYWxhbmNlCisJCSAqIG9mIGlucHV0L291dHB1
dCBjb25zaXN0ZW5jeSB3aGVuIGJlaW5nIGZlZWQgYSBjb250aW51b3VzCisJCSAqIHN0cmVhbSBv
ZiBYMTEgZHJhdyByZXF1ZXN0cyBzdHJhaWdodCBpbnRvIHNjYW5vdXQsIHdoZXJlCisJCSAqIHRo
ZSBjbGllbnRzIG1heSBzdWJtaXQgdGhlIHdvcmsgZmFzdGVyIHRoYW4gY2FuIGJlIGRyYXduLgor
CQkgKgorCQkgKiBUaHJvdHRsaW5nIHRyYWNrcyByZXF1ZXN0cyBwZXItZmlsZSAoYW5kIGFzc3Vt
ZXMgdGhhdAorCQkgKiBhbGwgcmVxdWVzdHMgYXJlIGluIHN1Ym1pc3Npb24gb3JkZXIgYWNyb3Nz
IHRoZSB3aG9sZSBmaWxlKSwKKwkJICogc28gd2Ugc3BsaXQgZWFjaCBjaGlsZCB0byBpdHMgb3du
IGZkLgorCQkgKi8KKwkJeyAidGhyb3R0bGUiLCAgICAgICBGX1RIUk9UVExFIHwgRl9JU09MQVRF
IH0sCisJCXsgInRocm90dGxlLXZpcCIsICAgRl9USFJPVFRMRSB8IEZfSVNPTEFURSB8IEZfVklQ
IH0sCisJCXsgInRocm90dGxlLXNvbG8iLCAgRl9USFJPVFRMRSB8IEZfSVNPTEFURSB8IEZfU09M
TyB9LAorCQl7ICJ0aHJvdHRsZS1zaGFyZSIsIEZfVEhST1RUTEUgfCBGX0lTT0xBVEUgfCBGX1NI
QVJFIH0sCisJCXsgInRocm90dGxlLXJydWwiLCAgRl9USFJPVFRMRSB8IEZfSVNPTEFURSB8IEZf
UlJVTCB9LAorCisJCS8qCisJCSAqIHBhY2UgLSBtZXNhICJzdWJtaXQgZG91YmxlIGJ1ZmZlcmlu
ZyIKKwkJICoKKwkJICogU3VibWl0IGEgZnJhbWUsIHdhaXQgZm9yIHByZXZpb3VzIGZyYW1lIHRv
IHN0YXJ0LiBUaGlzCisJCSAqIHByZXZlbnRzIGVhY2ggY2xpZW50IGZyb20gZ2V0dGluZyB0b28g
ZmFyIGFoZWFkIG9mIGl0cworCQkgKiByZW5kZXJpbmcsIG1haW50YWluaW5nIGEgY29uc2lzdGVu
dCBpbnB1dC9vdXRwdXQgbGF0ZW5jeS4KKwkJICovCisJCXsgInBhY2UiLCAgICAgICBGX1BBQ0Ug
fSwKKwkJeyAicGFjZS1zb2xvIiwgIEZfUEFDRSB8IEZfU09MTyB9LAorCQl7ICJwYWNlLXNoYXJl
IiwgRl9QQUNFIHwgRl9TT0xPIHwgRl9TSEFSRSB9LAorCQl7ICJwYWNlLXBpbmciLCAgRl9QQUNF
IHwgRl9TT0xPIHwgRl9TSEFSRSB8IEZfUElOR30sCisKKwkJLyogc3luYyAtIG9ubHkgc3VibWl0
IGEgZnJhbWUgYXQgYSB0aW1lICovCisJCXsgInN5bmMiLCAgICAgIEZfU1lOQyB9LAorCQl7ICJz
eW5jLXZpcCIsICBGX1NZTkMgfCBGX1ZJUCB9LAorCQl7ICJzeW5jLXNvbG8iLCBGX1NZTkMgfCBG
X1NPTE8gfSwKKworCQkvKiBmbG93IC0gc3luY2hyb25pc2UgZXhlY3V0aW9uIGFnYWluc3QgdGhl
IGNsb2NrICh2YmxhbmspICovCisJCXsgImZsb3ciLCAgICAgICBGX1BBQ0UgfCBGX0ZMT1cgfSwK
KwkJeyAiZmxvdy1zb2xvIiwgIEZfUEFDRSB8IEZfRkxPVyB8IEZfU09MTyB9LAorCQl7ICJmbG93
LXNoYXJlIiwgRl9QQUNFIHwgRl9GTE9XIHwgRl9TSEFSRSB9LAorCQl7ICJmbG93LXBpbmciLCAg
Rl9QQUNFIHwgRl9GTE9XIHwgRl9TSEFSRSB8IEZfUElORyB9LAorCisJCS8qIG5leHQgLSBzdWJt
aXQgYWhlYWQgb2YgdGhlIGNsb2NrICh2YmxhbmsgZG91YmxlIGJ1ZmZlcmluZykgKi8KKwkJeyAi
bmV4dCIsICAgICAgIEZfUEFDRSB8IEZfRkxPVyB8IEZfTkVYVCB9LAorCQl7ICJuZXh0LXNvbG8i
LCAgRl9QQUNFIHwgRl9GTE9XIHwgRl9ORVhUIHwgRl9TT0xPIH0sCisJCXsgIm5leHQtc2hhcmUi
LCBGX1BBQ0UgfCBGX0ZMT1cgfCBGX05FWFQgfCBGX1NIQVJFIH0sCisJCXsgIm5leHQtcGluZyIs
ICBGX1BBQ0UgfCBGX0ZMT1cgfCBGX05FWFQgfCBGX1NIQVJFIHwgRl9QSU5HIH0sCisKKwkJLyog
c3BhcmUgLSB1bmRlcnV0aWxpc2UgYnkgYSBzaW5nbGUgY2xpZW50IHRpbWVzbGljZSAqLworCQl7
ICJzcGFyZSIsICAgICAgRl9QQUNFIHwgRl9GTE9XIHwgRl9TUEFSRSB9LAorCQl7ICJzcGFyZS1z
b2xvIiwgRl9QQUNFIHwgRl9GTE9XIHwgRl9TUEFSRSB8IEZfU09MTyB9LAorCisJCS8qIGhhbGYg
LSBydW4gYXQgaGFsZiBwYWNlIChzdWJtaXQgMTZtcyBvZiB3b3JrIGV2ZXJ5IDMybXMpICovCisJ
CXsgImhhbGYiLCAgICAgICBGX1BBQ0UgfCBGX0ZMT1cgfCBGX0hBTEYgfSwKKwkJeyAiaGFsZi1z
b2xvIiwgIEZfUEFDRSB8IEZfRkxPVyB8IEZfSEFMRiB8IEZfU09MTyB9LAorCisJCXt9CisJfTsK
KworCWlndF9maXh0dXJlIHsKKwkJaWd0X2luZm8oIkNTIHRpbWVzdGFtcCBmcmVxdWVuY3k6ICVk
XG4iLAorCQkJIHJlYWRfdGltZXN0YW1wX2ZyZXF1ZW5jeShpOTE1KSk7CisKKwkJaWd0X3JlcXVp
cmUoaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2aWQoaTkxNSkpID49IDgpOworCX0KKworCWZv
ciAodHlwZW9mKCpmYWlyKSAqZiA9IGZhaXI7IGYtPm5hbWU7IGYrKykgeworCQlpZ3Rfc3VidGVz
dF93aXRoX2R5bmFtaWNfZigiZmFpci0lcyIsIGYtPm5hbWUpICB7CisJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmU7CisKKwkJCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5n
aW5lKGk5MTUsIGUpIHsKKwkJCQlpZiAoIWdlbV9jbGFzc19jYW5fc3RvcmVfZHdvcmQoaTkxNSwg
ZS0+Y2xhc3MpKQorCQkJCQljb250aW51ZTsKKworCQkJCWlndF9keW5hbWljX2YoIiVzIiwgZS0+
bmFtZSkKKwkJCQkJZmFpcm5lc3MoaTkxNSwgZSwgdGltZW91dCwgZi0+ZmxhZ3MpOworCQkJfQor
CQl9CisJfQorfQorCitzdGF0aWMgdWludDMyX3QgcmVhZF9jdHhfdGltZXN0YW1wKGludCBpOTE1
LAorCQkJCSAgIHVpbnQzMl90IGN0eCwKKwkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0
aW9uX2VuZ2luZTIgKmUpCit7CisJY29uc3QgaW50IHVzZV82NGIgPSBpbnRlbF9nZW4oaW50ZWxf
Z2V0X2RybV9kZXZpZChpOTE1KSkgPj0gODsKKwljb25zdCB1aW50MzJfdCBiYXNlID0gZ2VtX2Vu
Z2luZV9tbWlvX2Jhc2UoaTkxNSwgZS0+bmFtZSk7CisJc3RydWN0IGRybV9pOTE1X2dlbV9yZWxv
Y2F0aW9uX2VudHJ5IHJlbG9jOworCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyIG9i
aiA9IHsKKwkJLmhhbmRsZSA9IGdlbV9jcmVhdGUoaTkxNSwgNDA5NiksCisJCS5vZmZzZXQgPSAz
MiA8PCAyMCwKKwkJLnJlbG9jc19wdHIgPSB0b191c2VyX3BvaW50ZXIoJnJlbG9jKSwKKwkJLnJl
bG9jYXRpb25fY291bnQgPSAxLAorCX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVy
MiBleGVjYnVmID0geworCQkuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIoJm9iaiksCisJ
CS5idWZmZXJfY291bnQgPSAxLAorCQkuZmxhZ3MgPSBlLT5mbGFncywKKwkJLnJzdmQxID0gY3R4
LAorCX07CisjZGVmaW5lIFJVTlRJTUUgKGJhc2UgKyAweDNhOCkKKwl1aW50MzJfdCAqbWFwLCAq
Y3M7CisJdWludDMyX3QgdHM7CisKKwlpZ3RfcmVxdWlyZShiYXNlKTsKKworCWNzID0gbWFwID0g
Z2VtX21tYXBfX2RldmljZV9jb2hlcmVudChpOTE1LCBvYmouaGFuZGxlLAorCQkJCQkgICAgIDAs
IDQwOTYsIFBST1RfV1JJVEUpOworCisJKmNzKysgPSAweDI0IDw8IDIzIHwgKDEgKyB1c2VfNjRi
KTsgLyogU1JNICovCisJKmNzKysgPSBSVU5USU1FOworCW1lbXNldCgmcmVsb2MsIDAsIHNpemVv
ZihyZWxvYykpOworCXJlbG9jLnRhcmdldF9oYW5kbGUgPSBvYmouaGFuZGxlOworCXJlbG9jLnBy
ZXN1bWVkX29mZnNldCA9IG9iai5vZmZzZXQ7CisJcmVsb2Mub2Zmc2V0ID0gb2Zmc2V0X2luX3Bh
Z2UoY3MpOworCXJlbG9jLmRlbHRhID0gNDAwMDsKKwkqY3MrKyA9IG9iai5vZmZzZXQgKyA0MDAw
OworCSpjcysrID0gb2JqLm9mZnNldCA+PiAzMjsKKworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVS
X0VORDsKKworCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsKKwlnZW1fc3luYyhpOTE1LCBv
YmouaGFuZGxlKTsKKwlnZW1fY2xvc2UoaTkxNSwgb2JqLmhhbmRsZSk7CisKKwl0cyA9IG1hcFsx
MDAwXTsKKwltdW5tYXAobWFwLCA0MDk2KTsKKworCXJldHVybiB0czsKK30KKworc3RhdGljIHZv
aWQgZmFpcnNsaWNlKGludCBpOTE1LAorCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0
aW9uX2VuZ2luZTIgKmUsCisJCSAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCit7CisJaWd0X3Nw
aW5fdCAqc3BpbiA9IE5VTEw7CisJdWludDMyX3QgY3R4WzNdOworCXVpbnQzMl90IHRzWzNdOwor
CisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGN0eCk7IGkrKykgeworCQljdHhbaV0g
PSBnZW1fY29udGV4dF9jbG9uZV93aXRoX2VuZ2luZXMoaTkxNSwgMCk7CisJCWlmIChzcGluID09
IE5VTEwpIHsKKwkJCXNwaW4gPSBfX2lndF9zcGluX25ldyhpOTE1LAorCQkJCQkgICAgICAuY3R4
ID0gY3R4W2ldLAorCQkJCQkgICAgICAuZW5naW5lID0gZS0+ZmxhZ3MsCisJCQkJCSAgICAgIC5m
bGFncyA9IGZsYWdzKTsKKwkJfSBlbHNlIHsKKwkJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1
ZmZlcjIgZWIgPSB7CisJCQkJLmJ1ZmZlcl9jb3VudCA9IDEsCisJCQkJLmJ1ZmZlcnNfcHRyID0g
dG9fdXNlcl9wb2ludGVyKCZzcGluLT5vYmpbSUdUX1NQSU5fQkFUQ0hdKSwKKwkJCQkuZmxhZ3Mg
PSBlLT5mbGFncywKKwkJCQkucnN2ZDEgPSBjdHhbaV0sCisJCQl9OworCQkJZ2VtX2V4ZWNidWYo
aTkxNSwgJmViKTsKKwkJfQorCX0KKworCXNsZWVwKDIpOyAvKiBvdmVyIHRoZSBjb3Vyc2Ugb2Yg
bWFueSB0aW1lc2xpY2VzICovCisKKwlpZ3RfYXNzZXJ0KGdlbV9ib19idXN5KGk5MTUsIHNwaW4t
PmhhbmRsZSkpOworCWlndF9zcGluX2VuZChzcGluKTsKKwlmb3IgKGludCBpID0gMDsgaSA8IEFS
UkFZX1NJWkUoY3R4KTsgaSsrKQorCQl0c1tpXSA9IHJlYWRfY3R4X3RpbWVzdGFtcChpOTE1LCBj
dHhbaV0sIGUpOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGN0eCk7IGkrKykK
KwkJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjdHhbaV0pOworCWlndF9zcGluX2ZyZWUoaTkx
NSwgc3Bpbik7CisKKwlxc29ydCh0cywgMywgc2l6ZW9mKCp0cyksIGNtcF91MzIpOworCWlndF9p
bmZvKCIlczogWyUuMWYsICUuMWYsICUuMWZdIG1zXG4iLCBlLT5uYW1lLAorCQkgMWUtNiAqIHRp
Y2tzX3RvX25zKGk5MTUsIHRzWzBdKSwKKwkJIDFlLTYgKiB0aWNrc190b19ucyhpOTE1LCB0c1sx
XSksCisJCSAxZS02ICogdGlja3NfdG9fbnMoaTkxNSwgdHNbMl0pKTsKKworCWlndF9hc3NlcnRf
Zih0c1syXSwgIkNUWF9USU1FU1RBTVAgbm90IHJlcG9ydGVkIVxuIik7CisJaWd0X2Fzc2VydF9m
KCh0c1syXSAtIHRzWzBdKSAqIDYgPCB0c1sxXSwKKwkJICAgICAiUmFuZ2Ugb2YgdGltZXNsaWNl
cyBncmVhdGVyIHRoYW4gdG9sZXJhYmxlOiAlLjJmbXMgPiAlLjJmbXM7IHVuZmFpciFcbiIsCisJ
CSAgICAgMWUtNiAqIHRpY2tzX3RvX25zKGk5MTUsIHRzWzJdIC0gdHNbMF0pLAorCQkgICAgIDFl
LTYgKiB0aWNrc190b19ucyhpOTE1LCB0c1sxXSkgLyA2KTsKK30KKwogI2RlZmluZSB0ZXN0X2Vh
Y2hfZW5naW5lKFQsIGk5MTUsIGUpIFwKIAlpZ3Rfc3VidGVzdF93aXRoX2R5bmFtaWMoVCkgX19m
b3JfZWFjaF9waHlzaWNhbF9lbmdpbmUoaTkxNSwgZSkgXAogCQlpZ3RfZHluYW1pY19mKCIlcyIs
IGUtPm5hbWUpCkBAIC0yNTgyLDYgKzM1MDksMzUgQEAgaWd0X21haW4KIAkJdGVzdF9lYWNoX2Vu
Z2luZSgibGF0ZXNsaWNlIiwgZmQsIGUpCiAJCQlsYXRlc2xpY2UoZmQsIGUtPmZsYWdzKTsKIAor
CQlpZ3Rfc3VidGVzdF9ncm91cCB7CisJCQlpZ3RfZml4dHVyZSB7CisJCQkJaWd0X3JlcXVpcmUo
Z2VtX3NjaGVkdWxlcl9oYXNfc2VtYXBob3JlcyhmZCkpOworCQkJCWlndF9yZXF1aXJlKGdlbV9z
Y2hlZHVsZXJfaGFzX3ByZWVtcHRpb24oZmQpKTsKKwkJCQlpZ3RfcmVxdWlyZShpbnRlbF9nZW4o
aW50ZWxfZ2V0X2RybV9kZXZpZChmZCkpID49IDgpOworCQkJfQorCisJCQl0ZXN0X2VhY2hfZW5n
aW5lKCJmYWlyc2xpY2UiLCBmZCwgZSkKKwkJCQlmYWlyc2xpY2UoZmQsIGUsIDApOworCisJCQl0
ZXN0X2VhY2hfZW5naW5lKCJ1LWZhaXJzbGljZSIsIGZkLCBlKQorCQkJCWZhaXJzbGljZShmZCwg
ZSwgSUdUX1NQSU5fVVNFUlBUUik7CisKKwkJCWlndF9zdWJ0ZXN0KCJmYWlyc2xpY2UtYWxsIikg
IHsKKwkJCQlfX2Zvcl9lYWNoX3BoeXNpY2FsX2VuZ2luZShmZCwgZSkgeworCQkJCQlpZ3RfZm9y
ayhjaGlsZCwgMSkKKwkJCQkJCWZhaXJzbGljZShmZCwgZSwgMCk7CisJCQkJfQorCQkJCWlndF93
YWl0Y2hpbGRyZW4oKTsKKwkJCX0KKwkJCWlndF9zdWJ0ZXN0KCJ1LWZhaXJzbGljZS1hbGwiKSAg
eworCQkJCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5naW5lKGZkLCBlKSB7CisJCQkJCWlndF9mb3Jr
KGNoaWxkLCAxKQorCQkJCQkJZmFpcnNsaWNlKGZkLCBlLCBJR1RfU1BJTl9VU0VSUFRSKTsKKwkJ
CQl9CisJCQkJaWd0X3dhaXRjaGlsZHJlbigpOworCQkJfQorCQl9CisKIAkJdGVzdF9lYWNoX2Vu
Z2luZSgic3VibWl0LWVhcmx5LXNsaWNlIiwgZmQsIGUpCiAJCQlzdWJtaXRfc2xpY2UoZmQsIGUs
IEVBUkxZX1NVQk1JVCk7CiAJCXRlc3RfZWFjaF9lbmdpbmUoInN1Ym1pdC1nb2xkZW4tc2xpY2Ui
LCBmZCwgZSkKQEAgLTI2MTAsNiArMzU2NiwxMCBAQCBpZ3RfbWFpbgogCQl0ZXN0X2VhY2hfZW5n
aW5lX3N0b3JlKCJwcm9tb3Rpb24iLCBmZCwgZSkKIAkJCXByb21vdGlvbihmZCwgZS0+ZmxhZ3Mp
OwogCisJCWlndF9zdWJ0ZXN0X2dyb3VwIHsKKwkJCXRlc3RfZmFpcm5lc3MoZmQsIDIpOworCQl9
CisKIAkJaWd0X3N1YnRlc3RfZ3JvdXAgewogCQkJaWd0X2ZpeHR1cmUgewogCQkJCWlndF9yZXF1
aXJlKGdlbV9zY2hlZHVsZXJfaGFzX3ByZWVtcHRpb24oZmQpKTsKLS0gCjIuMjkuMgoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

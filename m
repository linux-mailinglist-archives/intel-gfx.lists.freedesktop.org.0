Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D03E2D1ABB
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 23:20:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 18B976E332;
	Wed,  9 Oct 2019 21:20:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 31C236E332
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 21:20:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18783194-1500050 
 for multiple; Wed, 09 Oct 2019 22:19:52 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  9 Oct 2019 22:19:41 +0100
Message-Id: <20191009211947.6815-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191009211947.6815-1-chris@chris-wilson.co.uk>
References: <20191009211947.6815-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/9] drm/i915/perf: allow for CS OA configs to
 be created lazily
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
SGVyZSB3ZSBpbnRyb2R1Y2UgYSBtZWNoYW5pc20gYnkgd2hpY2ggdGhlIGV4ZWNidWYgcGFydCBv
ZiB0aGUgaTkxNQpkcml2ZXIgd2lsbCBiZSBhYmxlIHRvIHJlcXVlc3QgdGhhdCBhIGJhdGNoIGJ1
ZmZlciBjb250YWluaW5nIHRoZQpwcm9ncmFtbWluZyBmb3IgYSBwYXJ0aWN1bGFyIE9BIGNvbmZp
ZyBiZSBjcmVhdGVkLgoKV2UnbGwgZXhlY3V0ZSB0aGVzZSBPQSBjb25maWd1cmF0aW9uIGJ1ZmZl
cnMgcmlnaHQgYmVmb3JlIGV4ZWN1dGluZyBhCnNldCBvZiB1c2Vyc3BhY2UgY29tbWFuZHMgc28g
dGhhdCBhIHBhcnRpY3VsYXIgdXNlciBiYXRjaGJ1ZmZlciBiZQpleGVjdXRlZCB3aXRoIGEgZ2l2
ZW4gT0EgY29uZmlndXJhdGlvbi4KClRoaXMgbWVjaGFuaXNtIGVzc2VudGlhbGx5IGFsbG93cyB0
aGUgdXNlcnNwYWNlIGRyaXZlciB0byBnbyB0aHJvdWdoCnNldmVyYWwgT0EgY29uZmlndXJhdGlv
biB3aXRob3V0IGhhdmluZyB0byBvcGVuL2Nsb3NlIHRoZSBpOTE1L3BlcmYKc3RyZWFtLgoKdjI6
IE5vIG5lZWQgZm9yIGxvY2tpbmcgb24gb2JqZWN0IE9BIGNvbmZpZyBvYmplY3QgY3JlYXRpb24g
KENocmlzKQogICAgRmx1c2ggY3B1IG1hcHBpbmcgb2YgT0EgY29uZmlnIChDaHJpcykKCnYzOiBQ
cm9wZXJseSBkZWFsIHdpdGggdGhlIHBlcmZfbWV0cmljIGxvY2sgKENocmlzL0xpb25lbCkKCnY0
OiBGaXggb2EgY29uZmlnIHVucmVmL3B1dCB3aGVuIG5vdCBmb3VuZCAoTGlvbmVsKQoKdjU6IEFs
bG9jYXRlIEJPcyBmb3IgY29uZmlndXJhdGlvbnMgb24gdGhlIHN0cmVhbSBpbnN0ZWFkIG9mIGds
b2JhbGx5CiAgICAoTGlvbmVsKQoKdjY6IEZpeCA2NGJpdCBkaXZpc2lvbiAoQ2hyaXMpCgp2Nzog
U3RvcmUgYWxsb2NhdGVkIGNvbmZpZyBCT3MgaW50byB0aGUgc3RyZWFtIChMaW9uZWwpCgpTaWdu
ZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5j
b20+ClJldmlld2VkLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4g
KHY0KQotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIHwg
ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgIHwgMTA3
ICsrKysrKysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5oICAg
ICAgICAgICAgIHwgIDI0ICsrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlw
ZXMuaCAgICAgICB8ICAyMyArKy0tCiA0IGZpbGVzIGNoYW5nZWQsIDEwMiBpbnNlcnRpb25zKCsp
LCA1MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9ncHVfY29tbWFuZHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9j
b21tYW5kcy5oCmluZGV4IGIwMjI3YWIyZmUxYi4uMDk4NzEwMGM3ODZiIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaApAQCAtMTM4LDYgKzEzOCw3IEBA
CiAvKiBHZW4xMSsuIGFkZHIgPSBiYXNlICsgKGN0eF9yZXN0b3JlID8gb2Zmc2V0ICYgR0VOTUFT
SygxMiwyKSA6IG9mZnNldCkgKi8KICNkZWZpbmUgICBNSV9MUklfQ1NfTU1JTwkJKDE8PDE5KQog
I2RlZmluZSAgIE1JX0xSSV9GT1JDRV9QT1NURUQJCSgxPDwxMikKKyNkZWZpbmUgTUlfTE9BRF9S
RUdJU1RFUl9JTU1fTUFYX1JFR1MgKDEyNikKICNkZWZpbmUgTUlfU1RPUkVfUkVHSVNURVJfTUVN
ICAgICAgICBNSV9JTlNUUigweDI0LCAxKQogI2RlZmluZSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1f
R0VOOCAgIE1JX0lOU1RSKDB4MjQsIDIpCiAjZGVmaW5lICAgTUlfU1JNX0xSTV9HTE9CQUxfR1RU
CQkoMTw8MjIpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDIxZTY2YzMwYzZjYy4uZjA4
N2E4MWE2YjMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMzY5LDUyICszNjksNTIg
QEAgc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmU7CiB9OwogCitzdHJ1Y3QgaTkxNV9vYV9jb25maWdfYm8geworCXN0cnVjdCBsbGlz
dF9ub2RlIG5vZGU7CisKKwlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZzsKKwlzdHJ1
Y3QgaTkxNV92bWEgKnZtYTsKK307CisKIHN0YXRpYyBlbnVtIGhydGltZXJfcmVzdGFydCBvYV9w
b2xsX2NoZWNrX3RpbWVyX2NiKHN0cnVjdCBocnRpbWVyICpocnRpbWVyKTsKIAotc3RhdGljIHZv
aWQgZnJlZV9vYV9jb25maWcoc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCit2b2lk
IGk5MTVfb2FfY29uZmlnX3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZikKIHsKKwlzdHJ1Y3QgaTkx
NV9vYV9jb25maWcgKm9hX2NvbmZpZyA9CisJCWNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqb2Ff
Y29uZmlnKSwgcmVmKTsKKwogCWlmICghUFRSX0VSUihvYV9jb25maWctPmZsZXhfcmVncykpCiAJ
CWtmcmVlKG9hX2NvbmZpZy0+ZmxleF9yZWdzKTsKIAlpZiAoIVBUUl9FUlIob2FfY29uZmlnLT5i
X2NvdW50ZXJfcmVncykpCiAJCWtmcmVlKG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3MpOwogCWlm
ICghUFRSX0VSUihvYV9jb25maWctPm11eF9yZWdzKSkKIAkJa2ZyZWUob2FfY29uZmlnLT5tdXhf
cmVncyk7Ci0Ja2ZyZWUob2FfY29uZmlnKTsKLX0KLQotc3RhdGljIHZvaWQgcHV0X29hX2NvbmZp
ZyhzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZykKLXsKLQlpZiAoIWF0b21pY19kZWNf
YW5kX3Rlc3QoJm9hX2NvbmZpZy0+cmVmX2NvdW50KSkKLQkJcmV0dXJuOwogCi0JZnJlZV9vYV9j
b25maWcob2FfY29uZmlnKTsKKwlrZnJlZV9yY3Uob2FfY29uZmlnLCByY3UpOwogfQogCi1zdGF0
aWMgaW50IGdldF9vYV9jb25maWcoc3RydWN0IGk5MTVfcGVyZiAqcGVyZiwKLQkJCSBpbnQgbWV0
cmljc19zZXQsCi0JCQkgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZykKK3N0cnVj
dCBpOTE1X29hX2NvbmZpZyAqCitpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZyhzdHJ1Y3QgaTkxNV9w
ZXJmICpwZXJmLCBpbnQgbWV0cmljc19zZXQpCiB7Ci0JaW50IHJldDsKLQotCWlmIChtZXRyaWNz
X3NldCA9PSAxKSB7Ci0JCSpvdXRfY29uZmlnID0gJnBlcmYtPnRlc3RfY29uZmlnOwotCQlhdG9t
aWNfaW5jKCZwZXJmLT50ZXN0X2NvbmZpZy5yZWZfY291bnQpOwotCQlyZXR1cm4gMDsKLQl9Ci0K
LQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnBlcmYtPm1ldHJpY3NfbG9jayk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZp
ZzsKIAotCSpvdXRfY29uZmlnID0gaWRyX2ZpbmQoJnBlcmYtPm1ldHJpY3NfaWRyLCBtZXRyaWNz
X3NldCk7Ci0JaWYgKCEqb3V0X2NvbmZpZykKLQkJcmV0ID0gLUVJTlZBTDsKKwlyY3VfcmVhZF9s
b2NrKCk7CisJaWYgKG1ldHJpY3Nfc2V0ID09IDEpCisJCW9hX2NvbmZpZyA9ICZwZXJmLT50ZXN0
X2NvbmZpZzsKIAllbHNlCi0JCWF0b21pY19pbmMoJigqb3V0X2NvbmZpZyktPnJlZl9jb3VudCk7
CisJCW9hX2NvbmZpZyA9IGlkcl9maW5kKCZwZXJmLT5tZXRyaWNzX2lkciwgbWV0cmljc19zZXQp
OworCWlmIChvYV9jb25maWcpCisJCW9hX2NvbmZpZyA9IGk5MTVfb2FfY29uZmlnX2dldChvYV9j
b25maWcpOworCXJjdV9yZWFkX3VubG9jaygpOwogCi0JbXV0ZXhfdW5sb2NrKCZwZXJmLT5tZXRy
aWNzX2xvY2spOworCXJldHVybiBvYV9jb25maWc7Cit9CiAKLQlyZXR1cm4gcmV0Oworc3RhdGlj
IHZvaWQgZnJlZV9vYV9jb25maWdfYm8oc3RydWN0IGk5MTVfb2FfY29uZmlnX2JvICpvYV9ibykK
K3sKKwlpOTE1X29hX2NvbmZpZ19wdXQob2FfYm8tPm9hX2NvbmZpZyk7CisJaTkxNV92bWFfcHV0
KG9hX2JvLT52bWEpOworCWtmcmVlKG9hX2JvKTsKIH0KIAogc3RhdGljIHUzMiBnZW44X29hX2h3
X3RhaWxfcmVhZChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQpAQCAtMTMzNyw2ICsx
MzM3LDE2IEBAIGZyZWVfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0p
CiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCitzdGF0aWMgdm9pZAorZnJl
ZV9vYV9jb25maWdzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCit7CisJc3RydWN0
IGk5MTVfb2FfY29uZmlnX2JvICpvYV9ibywgKnRtcDsKKworCWk5MTVfb2FfY29uZmlnX3B1dChz
dHJlYW0tPm9hX2NvbmZpZyk7CisJbGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShvYV9ibywgdG1w
LCBzdHJlYW0tPm9hX2NvbmZpZ19ib3MuZmlyc3QsIG5vZGUpCisJCWZyZWVfb2FfY29uZmlnX2Jv
KG9hX2JvKTsKK30KKwogc3RhdGljIHZvaWQgaTkxNV9vYV9zdHJlYW1fZGVzdHJveShzdHJ1Y3Qg
aTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewogCXN0cnVjdCBpOTE1X3BlcmYgKnBlcmYgPSBz
dHJlYW0tPnBlcmY7CkBAIC0xMzU4LDcgKzEzNjgsNyBAQCBzdGF0aWMgdm9pZCBpOTE1X29hX3N0
cmVhbV9kZXN0cm95KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJaWYgKHN0cmVh
bS0+Y3R4KQogCQlvYV9wdXRfcmVuZGVyX2N0eF9pZChzdHJlYW0pOwogCi0JcHV0X29hX2NvbmZp
ZyhzdHJlYW0tPm9hX2NvbmZpZyk7CisJZnJlZV9vYV9jb25maWdzKHN0cmVhbSk7CiAKIAlpZiAo
cGVyZi0+c3B1cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgewogCQlEUk1fTk9URSgiJWQgc3B1cmlv
dXMgT0EgcmVwb3J0IG5vdGljZXMgc3VwcHJlc3NlZCBkdWUgdG8gcmF0ZWxpbWl0aW5nXG4iLApA
QCAtMTUwNSwxMCArMTUxNSw2IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJCWdvdG8gZXJyX3VucGluOwogCX0KIAotCURSTV9E
RUJVR19EUklWRVIoIk9BIEJ1ZmZlciBpbml0aWFsaXplZCwgZ3R0IG9mZnNldCA9IDB4JXgsIHZh
ZGRyID0gJXBcbiIsCi0JCQkgaTkxNV9nZ3R0X29mZnNldChzdHJlYW0tPm9hX2J1ZmZlci52bWEp
LAotCQkJIHN0cmVhbS0+b2FfYnVmZmVyLnZhZGRyKTsKLQogCXJldHVybiAwOwogCiBlcnJfdW5w
aW46CkBAIC0yMTk5LDkgKzIyMDUsMTAgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCX0KIAl9CiAKLQlyZXQgPSBnZXRf
b2FfY29uZmlnKHBlcmYsIHByb3BzLT5tZXRyaWNzX3NldCwgJnN0cmVhbS0+b2FfY29uZmlnKTsK
LQlpZiAocmV0KSB7CisJc3RyZWFtLT5vYV9jb25maWcgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZp
ZyhwZXJmLCBwcm9wcy0+bWV0cmljc19zZXQpOworCWlmICghc3RyZWFtLT5vYV9jb25maWcpIHsK
IAkJRFJNX0RFQlVHKCJJbnZhbGlkIE9BIGNvbmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nf
c2V0KTsKKwkJcmV0ID0gLUVJTlZBTDsKIAkJZ290byBlcnJfY29uZmlnOwogCX0KIApAQCAtMjIz
Myw2ICsyMjQwLDkgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCWdvdG8gZXJyX2VuYWJsZTsKIAl9CiAKKwlEUk1fREVC
VUcoIm9wZW5pbmcgc3RyZWFtIG9hIGNvbmZpZyB1dWlkPSVzXG4iLAorCQkgIHN0cmVhbS0+b2Ff
Y29uZmlnLT51dWlkKTsKKwogCWhydGltZXJfaW5pdCgmc3RyZWFtLT5wb2xsX2NoZWNrX3RpbWVy
LAogCQkgICAgIENMT0NLX01PTk9UT05JQywgSFJUSU1FUl9NT0RFX1JFTCk7CiAJc3RyZWFtLT5w
b2xsX2NoZWNrX3RpbWVyLmZ1bmN0aW9uID0gb2FfcG9sbF9jaGVja190aW1lcl9jYjsKQEAgLTIy
NDgsNyArMjI1OCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCWZyZWVfb2FfYnVmZmVyKHN0cmVhbSk7CiAKIGVycl9v
YV9idWZfYWxsb2M6Ci0JcHV0X29hX2NvbmZpZyhzdHJlYW0tPm9hX2NvbmZpZyk7CisJZnJlZV9v
YV9jb25maWdzKHN0cmVhbSk7CiAKIAlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dChzdHJlYW0t
Pmd0LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KHN0cmVh
bS0+Z3QtPnVuY29yZS0+cnBtLCBzdHJlYW0tPndha2VyZWYpOwpAQCAtMzA1Nyw3ICszMDY3LDgg
QEAgdm9pZCBpOTE1X3BlcmZfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAJaWYgKHJldCkKIAkJZ290byBzeXNmc19lcnJvcjsKIAotCWF0b21pY19zZXQoJnBlcmYtPnRl
c3RfY29uZmlnLnJlZl9jb3VudCwgMSk7CisJcGVyZi0+dGVzdF9jb25maWcucGVyZiA9IHBlcmY7
CisJa3JlZl9pbml0KCZwZXJmLT50ZXN0X2NvbmZpZy5yZWYpOwogCiAJZ290byBleGl0OwogCkBA
IC0zMzE1LDcgKzMzMjYsOCBAQCBpbnQgaTkxNV9wZXJmX2FkZF9jb25maWdfaW9jdGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQogCi0J
YXRvbWljX3NldCgmb2FfY29uZmlnLT5yZWZfY291bnQsIDEpOworCW9hX2NvbmZpZy0+cGVyZiA9
IHBlcmY7CisJa3JlZl9pbml0KCZvYV9jb25maWctPnJlZik7CiAKIAlpZiAoIXV1aWRfaXNfdmFs
aWQoYXJncy0+dXVpZCkpIHsKIAkJRFJNX0RFQlVHKCJJbnZhbGlkIHV1aWQgZm9ybWF0IGZvciBP
QSBjb25maWdcbiIpOwpAQCAtMzQxNCw3ICszNDI2LDcgQEAgaW50IGk5MTVfcGVyZl9hZGRfY29u
ZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiBzeXNmc19lcnI6
CiAJbXV0ZXhfdW5sb2NrKCZwZXJmLT5tZXRyaWNzX2xvY2spOwogcmVnX2VycjoKLQlwdXRfb2Ff
Y29uZmlnKG9hX2NvbmZpZyk7CisJaTkxNV9vYV9jb25maWdfcHV0KG9hX2NvbmZpZyk7CiAJRFJN
X0RFQlVHKCJGYWlsZWQgdG8gYWRkIG5ldyBPQSBjb25maWdcbiIpOwogCXJldHVybiBlcnI7CiB9
CkBAIC0zNDUwLDEzICszNDYyLDEzIEBAIGludCBpOTE1X3BlcmZfcmVtb3ZlX2NvbmZpZ19pb2N0
bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJcmV0ID0gbXV0ZXhfbG9j
a19pbnRlcnJ1cHRpYmxlKCZwZXJmLT5tZXRyaWNzX2xvY2spOwogCWlmIChyZXQpCi0JCWdvdG8g
bG9ja19lcnI7CisJCXJldHVybiByZXQ7CiAKIAlvYV9jb25maWcgPSBpZHJfZmluZCgmcGVyZi0+
bWV0cmljc19pZHIsICphcmcpOwogCWlmICghb2FfY29uZmlnKSB7CiAJCURSTV9ERUJVRygiRmFp
bGVkIHRvIHJlbW92ZSB1bmtub3duIE9BIGNvbmZpZ1xuIik7CiAJCXJldCA9IC1FTk9FTlQ7Ci0J
CWdvdG8gY29uZmlnX2VycjsKKwkJZ290byBlcnJfdW5sb2NrOwogCX0KIAogCUdFTV9CVUdfT04o
KmFyZyAhPSBvYV9jb25maWctPmlkKTsKQEAgLTM0NjYsMTMgKzM0NzgsMTYgQEAgaW50IGk5MTVf
cGVyZl9yZW1vdmVfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRh
dGEsCiAKIAlpZHJfcmVtb3ZlKCZwZXJmLT5tZXRyaWNzX2lkciwgKmFyZyk7CiAKKwltdXRleF91
bmxvY2soJnBlcmYtPm1ldHJpY3NfbG9jayk7CisKIAlEUk1fREVCVUcoIlJlbW92ZWQgY29uZmln
ICVzIGlkPSVpXG4iLCBvYV9jb25maWctPnV1aWQsIG9hX2NvbmZpZy0+aWQpOwogCi0JcHV0X29h
X2NvbmZpZyhvYV9jb25maWcpOworCWk5MTVfb2FfY29uZmlnX3B1dChvYV9jb25maWcpOworCisJ
cmV0dXJuIDA7CiAKLWNvbmZpZ19lcnI6CitlcnJfdW5sb2NrOgogCW11dGV4X3VubG9jaygmcGVy
Zi0+bWV0cmljc19sb2NrKTsKLWxvY2tfZXJyOgogCXJldHVybiByZXQ7CiB9CiAKQEAgLTM2NDIs
NyArMzY1Nyw3IEBAIHZvaWQgaTkxNV9wZXJmX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiAKIHN0YXRpYyBpbnQgZGVzdHJveV9jb25maWcoaW50IGlkLCB2b2lkICpwLCB2b2lk
ICpkYXRhKQogewotCXB1dF9vYV9jb25maWcocCk7CisJaTkxNV9vYV9jb25maWdfcHV0KHApOwog
CXJldHVybiAwOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5oCmluZGV4IDI5NWUzM2U4ZWVm
Ny4uNGNlZWJjZTcyMDYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuaApAQCAtNiw2ICs2LDcg
QEAKICNpZm5kZWYgX19JOTE1X1BFUkZfSF9fCiAjZGVmaW5lIF9fSTkxNV9QRVJGX0hfXwogCisj
aW5jbHVkZSA8bGludXgva3JlZi5oPgogI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAKICNpbmNs
dWRlICJpOTE1X3BlcmZfdHlwZXMuaCIKQEAgLTEzLDYgKzE0LDcgQEAKIHN0cnVjdCBkcm1fZGV2
aWNlOwogc3RydWN0IGRybV9maWxlOwogc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CitzdHJ1Y3Qg
aTkxNV9vYV9jb25maWc7CiBzdHJ1Y3QgaW50ZWxfY29udGV4dDsKIHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3M7CiAKQEAgLTI4LDcgKzMwLDI5IEBAIGludCBpOTE1X3BlcmZfYWRkX2NvbmZpZ19pb2N0
bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQkJICAgICAgIHN0cnVjdCBk
cm1fZmlsZSAqZmlsZSk7CiBpbnQgaTkxNV9wZXJmX3JlbW92ZV9jb25maWdfaW9jdGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmls
ZSk7CisKIHZvaWQgaTkxNV9vYV9pbml0X3JlZ19zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsK
IAorc3RydWN0IGk5MTVfb2FfY29uZmlnICoKK2k5MTVfcGVyZl9nZXRfb2FfY29uZmlnKHN0cnVj
dCBpOTE1X3BlcmYgKnBlcmYsIGludCBtZXRyaWNzX3NldCk7CisKK3N0YXRpYyBpbmxpbmUgc3Ry
dWN0IGk5MTVfb2FfY29uZmlnICoKK2k5MTVfb2FfY29uZmlnX2dldChzdHJ1Y3QgaTkxNV9vYV9j
b25maWcgKm9hX2NvbmZpZykKK3sKKwlpZiAoa3JlZl9nZXRfdW5sZXNzX3plcm8oJm9hX2NvbmZp
Zy0+cmVmKSkKKwkJcmV0dXJuIG9hX2NvbmZpZzsKKwllbHNlCisJCXJldHVybiBOVUxMOworfQor
Cit2b2lkIGk5MTVfb2FfY29uZmlnX3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZik7CitzdGF0aWMg
aW5saW5lIHZvaWQgaTkxNV9vYV9jb25maWdfcHV0KHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2Ff
Y29uZmlnKQoreworCWlmICghb2FfY29uZmlnKQorCQlyZXR1cm47CisKKwlrcmVmX3B1dCgmb2Ff
Y29uZmlnLT5yZWYsIGk5MTVfb2FfY29uZmlnX3JlbGVhc2UpOworfQorCiAjZW5kaWYgLyogX19J
OTE1X1BFUkZfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmZfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZl90eXBlcy5oCmluZGV4
IDgyY2QzYjI5NTAzNy4uN2FmZWEyNjdmZjNmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3BlcmZfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmZfdHlwZXMuaApAQCAtOSw3ICs5LDcgQEAKICNpbmNsdWRlIDxsaW51eC9hdG9taWMuaD4KICNp
bmNsdWRlIDxsaW51eC9kZXZpY2UuaD4KICNpbmNsdWRlIDxsaW51eC9ocnRpbWVyLmg+Ci0jaW5j
bHVkZSA8bGludXgvbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L2xsaXN0Lmg+CiAjaW5jbHVkZSA8
bGludXgvcG9sbC5oPgogI2luY2x1ZGUgPGxpbnV4L3N5c2ZzLmg+CiAjaW5jbHVkZSA8bGludXgv
dHlwZXMuaD4KQEAgLTIyLDYgKzIyLDcgQEAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogc3Ry
dWN0IGZpbGU7CiBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dDsKK3N0cnVjdCBpOTE1X3BlcmY7CiBz
dHJ1Y3QgaTkxNV92bWE7CiBzdHJ1Y3QgaW50ZWxfY29udGV4dDsKIHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3M7CkBAIC0zNyw2ICszOCw4IEBAIHN0cnVjdCBpOTE1X29hX3JlZyB7CiB9OwogCiBzdHJ1
Y3QgaTkxNV9vYV9jb25maWcgeworCXN0cnVjdCBpOTE1X3BlcmYgKnBlcmY7CisKIAljaGFyIHV1
aWRbVVVJRF9TVFJJTkdfTEVOICsgMV07CiAJaW50IGlkOwogCkBAIC01MSw3ICs1NCw4IEBAIHN0
cnVjdCBpOTE1X29hX2NvbmZpZyB7CiAJc3RydWN0IGF0dHJpYnV0ZSAqYXR0cnNbMl07CiAJc3Ry
dWN0IGRldmljZV9hdHRyaWJ1dGUgc3lzZnNfbWV0cmljX2lkOwogCi0JYXRvbWljX3QgcmVmX2Nv
dW50OworCXN0cnVjdCBrcmVmIHJlZjsKKwlzdHJ1Y3QgcmN1X2hlYWQgcmN1OwogfTsKIAogc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW07CkBAIC0xODMsNiArMTg3LDEyIEBAIHN0cnVjdCBpOTE1X3Bl
cmZfc3RyZWFtIHsKIAkgKi8KIAlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZzsKIAor
CS8qKgorCSAqIEBvYV9jb25maWdfYm9zOiBBIGxpc3Qgb2Ygc3RydWN0IGk5MTVfb2FfY29uZmln
X2JvIGFsbG9jYXRlZCBsYXppbHkKKwkgKiBlYWNoIHRpbWUgQG9hX2NvbmZpZyBjaGFuZ2VzLgor
CSAqLworCXN0cnVjdCBsbGlzdF9oZWFkIG9hX2NvbmZpZ19ib3M7CisKIAkvKioKIAkgKiBAcGlu
bmVkX2N0eDogVGhlIE9BIGNvbnRleHQgc3BlY2lmaWMgaW5mb3JtYXRpb24uCiAJICovCkBAIC0z
MzcsMTMgKzM0NywxMyBAQCBzdHJ1Y3QgaTkxNV9wZXJmIHsKIAogCS8qCiAJICogTG9jayBhc3Nv
Y2lhdGVkIHdpdGggYWRkaW5nL21vZGlmeWluZy9yZW1vdmluZyBPQSBjb25maWdzCi0JICogaW4g
ZGV2X3ByaXYtPnBlcmYubWV0cmljc19pZHIuCisJICogaW4gcGVyZi0+bWV0cmljc19pZHIuCiAJ
ICovCiAJc3RydWN0IG11dGV4IG1ldHJpY3NfbG9jazsKIAogCS8qCi0JICogTGlzdCBvZiBkeW5h
bWljIGNvbmZpZ3VyYXRpb25zLCB5b3UgbmVlZCB0byBob2xkCi0JICogZGV2X3ByaXYtPnBlcmYu
bWV0cmljc19sb2NrIHRvIGFjY2VzcyBpdC4KKwkgKiBMaXN0IG9mIGR5bmFtaWMgY29uZmlndXJh
dGlvbnMgKHN0cnVjdCBpOTE1X29hX2NvbmZpZyksIHlvdQorCSAqIG5lZWQgdG8gaG9sZCBwZXJm
LT5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgogCSAqLwogCXN0cnVjdCBpZHIgbWV0cmljc19p
ZHI7CiAKQEAgLTM1Niw4ICszNjYsNyBAQCBzdHJ1Y3QgaTkxNV9wZXJmIHsKIAkvKgogCSAqIFRo
ZSBzdHJlYW0gY3VycmVudGx5IHVzaW5nIHRoZSBPQSB1bml0LiBJZiBhY2Nlc3NlZAogCSAqIG91
dHNpZGUgYSBzeXNjYWxsIGFzc29jaWF0ZWQgdG8gaXRzIGZpbGUKLQkgKiBkZXNjcmlwdG9yLCB5
b3UgbmVlZCB0byBob2xkCi0JICogZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXguCisJICogZGVz
Y3JpcHRvci4KIAkgKi8KIAlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqZXhjbHVzaXZlX3N0cmVh
bTsKIAotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZng=

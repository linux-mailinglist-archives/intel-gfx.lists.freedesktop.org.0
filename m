Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 58F8C11650B
	for <lists+intel-gfx@lfdr.de>; Mon,  9 Dec 2019 03:32:49 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5D7D46E303;
	Mon,  9 Dec 2019 02:32:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8DC1F6E303
 for <intel-gfx@lists.freedesktop.org>; Mon,  9 Dec 2019 02:32:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19507148-1500050 
 for multiple; Mon, 09 Dec 2019 02:32:15 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  9 Dec 2019 02:32:15 +0000
Message-Id: <20191209023215.3519970-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191209020145.3495050-1-chris@chris-wilson.co.uk>
References: <20191209020145.3495050-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gt: Detect if we miss WaIdleLiteRestore
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gb3JkZXIgdG8gYXZvaWQgY29uZnVzaW5nIHRoZSBIVywgd2UgbXVzdCBuZXZlciBzdWJtaXQg
YW4gZW1wdHkgcmluZwpkdXJpbmcgbGl0ZS1yZXN0b3JlLCB0aGF0IGlzIHdlIHNob3VsZCBhbHdh
eXMgYWR2YW5jZSB0aGUgUklOR19UQUlMCmJlZm9yZSBzdWJtaXR0aW5nIHRvIHN0YXkgYWhlYWQg
b2YgdGhlIFJJTkdfSEVBRC4KCk5vcm1hbGx5IHRoaXMgaXMgcHJldmVudGVkIGJ5IGtlZXBpbmcg
YSBjb3VwbGUgb2Ygc3BhcmUgTk9QcyBpbiB0aGUKcmVxdWVzdC0+d2FfdGFpbCBzbyB0aGF0IG9u
IHJlc3VibWlzc2lvbiB3ZSBjYW4gYWR2YW5jZSB0aGUgdGFpbC4gVGhpcwpyZWxpZXMgb24gdGhl
IHJlcXVlc3Qgb25seSBiZWluZyByZXN1Ym1pdHRlZCBvbmNlLCB3aGljaCBpcyB0aGUgbm9ybWFs
CmNvbmRpdGlvbiBhcyBpdCBpcyBzZWVuIG9uY2UgZm9yIEVMU1BbMV0gYW5kIHRoZW4gbGF0ZXIg
aW4gRUxTUFswXS4gT24KcHJlZW1wdGlvbiwgdGhlIHJlcXVlc3RzIGFyZSB1bndvdW5kIGFuZCB0
aGUgdGFpbCByZXNldCBiYWNrIHRvIHRoZQpub3JtYWwgZW5kIHBvaW50IChhcyB3ZSBrbm93IHRo
ZSByZXF1ZXN0IGlzIGluY29tcGxldGUgYW5kIHRoZXJlZm9yZSBpdHMKUklOR19IRUFEIGlzIGV2
ZW4gZWFybGllcikuCgpIb3dldmVyLCBpZiB0aGlzIHcvYSBzaG91bGQgZmFpbCB3ZSB3b3VsZCB0
cnkgYW5kIHJlc3VibWl0IHRoZSByZXF1ZXN0CndpdGggdGhlIFJJTkdfVEFJTCBhbHJlYWR5IHNl
dCB0byB0aGUgbG9jYXRpb24gb2YgdGhpcyByZXF1ZXN0J3Mgd2FfdGFpbApwb3RlbnRpYWxseSBj
YXVzaW5nIGEgR1BVIGhhbmcuIFdlIGNhbiBzcG90IHdoZW4gd2UgZG8gdHJ5IGFuZAppbmNvcnJl
Y3RseSByZXN1Ym1pdCB3aXRob3V0IGFkdmFuY2luZyB0aGUgUklOR19UQUlMIGFuZCBzcGFyZSBh
bnkKZW1iYXJyYXNzbWVudCBieSBmb3JjaW5nIHRoZSBjb250ZXh0IHJlc3RvcmUuCgpJbiB0aGUg
Y2FzZSBvZiBwcmVlbXB0LXRvLWJ1c3ksIHdlIGxlYXZlIHRoZSByZXF1ZXN0cyBydW5uaW5nIG9u
IHRoZSBIVwp3aGlsZSB3ZSB1bndpbmQuIEFzIHRoZSByaW5nIGlzIHN0aWxsIGxpdmUsIHdlIGNh
bm5vdCByZXdpbmQgb3VyCnJxLT50YWlsIHdpdGhvdXQgZm9yY2luZyBhIHJlbG9hZCBzbyBsZWF2
ZSBpdCBzZXQgdG8gcnEtPndhX3RhaWwgYW5kCm9ubHkgZm9yY2UgYSByZWxvYWQgaWYgd2UgcmVz
dWJtaXQgYWZ0ZXIgYSBsaXRlLXJlc3RvcmUuIChOb3JtYWxseSwgdGhlCmZvcmNlZCByZWxvYWQg
d2lsbCBiZSBhIHBhcnQgb2YgdGhlIHByZWVtcHRpb24gZXZlbnQuKQoKRml4ZXM6IDIyYjdhNDI2
YmJlMSAoImRybS9pOTE1L2V4ZWNsaXN0czogUHJlZW1wdC10by1idXN5IikKQ2xvc2VzOiBodHRw
czovL2dpdGxhYi5mcmVlZGVza3RvcC5vcmcvZHJtL2ludGVsL2lzc3Vlcy82NzMKU2lnbmVkLW9m
Zi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBNaWthIEt1
b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6IFR2cnRrbyBVcnN1bGlu
IDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMgfCA0NiArKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNo
YW5nZWQsIDIxIGluc2VydGlvbnMoKyksIDI1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfbHJjLmMKaW5kZXggYzdlYThhMDU1MDA1Li45MjlmNmJhZTRlYmEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC04NDUsMTIgKzg0NSw2IEBAIHN0YXRpYyBjb25z
dCB1OCAqcmVnX29mZnNldHMoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
CX0KIH0KIAotc3RhdGljIHZvaWQgdW53aW5kX3dhX3RhaWwoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpCi17Ci0JcnEtPnRhaWwgPSBpbnRlbF9yaW5nX3dyYXAocnEtPnJpbmcsIHJxLT53YV90YWls
IC0gV0FfVEFJTF9CWVRFUyk7Ci0JYXNzZXJ0X3JpbmdfdGFpbF92YWxpZChycS0+cmluZywgcnEt
PnRhaWwpOwotfQotCiBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqCiBfX3Vud2luZF9pbmNv
bXBsZXRlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKQEAgLTg2
MywxMiArODU3LDEwIEBAIF9fdW53aW5kX2luY29tcGxldGVfcmVxdWVzdHMoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZV9yZXZlcnNlKHJx
LCBybiwKIAkJCQkJICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cywKIAkJCQkJIHNjaGVkLmxpbmsp
IHsKLQogCQlpZiAoaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCiAJCQljb250aW51ZTsgLyog
WFhYICovCiAKIAkJX19pOTE1X3JlcXVlc3RfdW5zdWJtaXQocnEpOwotCQl1bndpbmRfd2FfdGFp
bChycSk7CiAKIAkJLyoKIAkJICogUHVzaCB0aGUgcmVxdWVzdCBiYWNrIGludG8gdGhlIHF1ZXVl
IGZvciBsYXRlciByZXN1Ym1pc3Npb24uCkBAIC0xMjE2LDEzICsxMjA4LDI5IEBAIGV4ZWNsaXN0
c19zY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaTkxNV9yZXF1ZXN0X3B1
dChycSk7CiB9CiAKLXN0YXRpYyB1NjQgZXhlY2xpc3RzX3VwZGF0ZV9jb250ZXh0KGNvbnN0IHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQorc3RhdGljIHU2NCBleGVjbGlzdHNfdXBkYXRlX2NvbnRl
eHQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNl
ID0gcnEtPmh3X2NvbnRleHQ7Ci0JdTY0IGRlc2M7CisJdTY0IGRlc2MgPSBjZS0+bHJjX2Rlc2M7
CisJdTMyIHRhaWw7CiAKLQljZS0+bHJjX3JlZ19zdGF0ZVtDVFhfUklOR19UQUlMXSA9Ci0JCWlu
dGVsX3Jpbmdfc2V0X3RhaWwocnEtPnJpbmcsIHJxLT50YWlsKTsKKwkvKgorCSAqIFdhSWRsZUxp
dGVSZXN0b3JlOmJkdyxza2wKKwkgKgorCSAqIFdlIHNob3VsZCBuZXZlciBzdWJtaXQgdGhlIGNv
bnRleHQgd2l0aCB0aGUgc2FtZSBSSU5HX1RBSUwgdHdpY2UKKwkgKiBqdXN0IGluIGNhc2Ugd2Ug
c3VibWl0IGFuIGVtcHR5IHJpbmcsIHdoaWNoIGNvbmZ1c2VzIHRoZSBIVy4KKwkgKgorCSAqIFdl
IGFwcGVuZCBhIGNvdXBsZSBvZiBOT09QcyAoZ2VuOF9lbWl0X3dhX3RhaWwpIGFmdGVyIHRoZSBl
bmQgb2YKKwkgKiB0aGUgbm9ybWFsIHJlcXVlc3QgdG8gYmUgYWJsZSB0byBhbHdheXMgYWR2YW5j
ZSB0aGUgUklOR19UQUlMIG9uCisJICogc3Vic2VxdWVudCByZXN1Ym1pc3Npb25zIChmb3IgbGl0
ZSByZXN0b3JlKS4gU2hvdWxkIHRoYXQgZmFpbCB1cywKKwkgKiBhbmQgd2UgdHJ5IGFuZCBzdWJt
aXQgdGhlIHNhbWUgdGFpbCBhZ2FpbiwgZm9yY2UgdGhlIGNvbnRleHQKKwkgKiByZWxvYWQuCisJ
ICovCisJdGFpbCA9IGludGVsX3Jpbmdfc2V0X3RhaWwocnEtPnJpbmcsIHJxLT50YWlsKTsKKwlp
ZiAodW5saWtlbHkoY2UtPmxyY19yZWdfc3RhdGVbQ1RYX1JJTkdfVEFJTF0gPT0gdGFpbCkpCisJ
CWRlc2MgfD0gQ1RYX0RFU0NfRk9SQ0VfUkVTVE9SRTsKKwljZS0+bHJjX3JlZ19zdGF0ZVtDVFhf
UklOR19UQUlMXSA9IHRhaWw7CisJcnEtPnRhaWwgPSBycS0+d2FfdGFpbDsKIAogCS8qCiAJICog
TWFrZSBzdXJlIHRoZSBjb250ZXh0IGltYWdlIGlzIGNvbXBsZXRlIGJlZm9yZSB3ZSBzdWJtaXQg
aXQgdG8gSFcuCkBAIC0xMjM2LDEzICsxMjQ0LDExIEBAIHN0YXRpYyB1NjQgZXhlY2xpc3RzX3Vw
ZGF0ZV9jb250ZXh0KGNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCSAqLwogCXdtYigp
OwogCi0JZGVzYyA9IGNlLT5scmNfZGVzYzsKLQljZS0+bHJjX2Rlc2MgJj0gfkNUWF9ERVNDX0ZP
UkNFX1JFU1RPUkU7Ci0KIAkvKiBXYV8xNjA3MTM4MzQwOnRnbCAqLwogCWlmIChJU19UR0xfUkVW
SUQocnEtPmk5MTUsIFRHTF9SRVZJRF9BMCwgVEdMX1JFVklEX0EwKSkKIAkJZGVzYyB8PSBDVFhf
REVTQ19GT1JDRV9SRVNUT1JFOwogCisJY2UtPmxyY19kZXNjICY9IH5DVFhfREVTQ19GT1JDRV9S
RVNUT1JFOwogCXJldHVybiBkZXNjOwogfQogCkBAIC0xNzc2LDE2ICsxNzgyLDYgQEAgc3RhdGlj
IHZvaWQgZXhlY2xpc3RzX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
CiAJCQkJcmV0dXJuOwogCQkJfQotCi0JCQkvKgotCQkJICogV2FJZGxlTGl0ZVJlc3RvcmU6YmR3
LHNrbAotCQkJICogQXBwbHkgdGhlIHdhIE5PT1BzIHRvIHByZXZlbnQKLQkJCSAqIHJpbmc6SEVB
RCA9PSBycTpUQUlMIGFzIHdlIHJlc3VibWl0IHRoZQotCQkJICogcmVxdWVzdC4gU2VlIGdlbjhf
ZW1pdF9maW5pX2JyZWFkY3J1bWIoKSBmb3IKLQkJCSAqIHdoZXJlIHdlIHByZXBhcmUgdGhlIHBh
ZGRpbmcgYWZ0ZXIgdGhlCi0JCQkgKiBlbmQgb2YgdGhlIHJlcXVlc3QuCi0JCQkgKi8KLQkJCWxh
c3QtPnRhaWwgPSBsYXN0LT53YV90YWlsOwogCQl9CiAJfQogCi0tIAoyLjI0LjAKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5n
IGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

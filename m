Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8D213175A1
	for <lists+intel-gfx@lfdr.de>; Wed,  8 May 2019 12:10:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E341F895EE;
	Wed,  8 May 2019 10:10:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AA901895B5;
 Wed,  8 May 2019 10:10:23 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16487695-1500050 
 for multiple; Wed, 08 May 2019 11:10:12 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  8 May 2019 11:09:50 +0100
Message-Id: <20190508100958.32637-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190508100958.32637-1-chris@chris-wilson.co.uk>
References: <20190508100958.32637-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 08/16] i915: Exercise creating context
 with shared GTT
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

djI6IFRlc3QgZWFjaCBzaGFyZWQgY29udGV4dCBpcyBpdHMgb3duIHRpbWVsaW5lIGFuZCBhbGxv
d3MgcmVxdWVzdApyZW9yZGVyaW5nIGJldHdlZW4gc2hhcmVkIGNvbnRleHRzLgoKU2lnbmVkLW9m
Zi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBKb29uYXMg
TGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBUdnJ0a28gVXJz
dWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpDYzogTWlrYSBLdW9wcGFsYSA8bWlrYS5r
dW9wcGFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBNaWNoYWwgV2FqZGVjemtvIDxtaWNoYWwud2Fq
ZGVjemtvQGludGVsLmNvbT4KLS0tCiBsaWIvaTkxNS9nZW1fY29udGV4dC5jICAgICAgICB8ICA2
OCArKysKIGxpYi9pOTE1L2dlbV9jb250ZXh0LmggICAgICAgIHwgIDEzICsKIHRlc3RzL01ha2Vm
aWxlLnNvdXJjZXMgICAgICAgIHwgICAxICsKIHRlc3RzL2k5MTUvZ2VtX2N0eF9zaGFyZWQuYyAg
IHwgODU2ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIHRlc3RzL2k5MTUvZ2Vt
X2V4ZWNfd2hpc3Blci5jIHwgIDMyICstCiB0ZXN0cy9tZXNvbi5idWlsZCAgICAgICAgICAgICB8
ICAgMSArCiA2IGZpbGVzIGNoYW5nZWQsIDk2MiBpbnNlcnRpb25zKCspLCA5IGRlbGV0aW9ucygt
KQogY3JlYXRlIG1vZGUgMTAwNjQ0IHRlc3RzL2k5MTUvZ2VtX2N0eF9zaGFyZWQuYwoKZGlmZiAt
LWdpdCBhL2xpYi9pOTE1L2dlbV9jb250ZXh0LmMgYi9saWIvaTkxNS9nZW1fY29udGV4dC5jCmlu
ZGV4IGY5NGQ4OWNiNC4uOGZiODk4NGQxIDEwMDY0NAotLS0gYS9saWIvaTkxNS9nZW1fY29udGV4
dC5jCisrKyBiL2xpYi9pOTE1L2dlbV9jb250ZXh0LmMKQEAgLTI3Miw2ICsyNzIsNzQgQEAgdm9p
ZCBnZW1fY29udGV4dF9zZXRfcHJpb3JpdHkoaW50IGZkLCB1aW50MzJfdCBjdHhfaWQsIGludCBw
cmlvKQogCWlndF9hc3NlcnRfZXEoX19nZW1fY29udGV4dF9zZXRfcHJpb3JpdHkoZmQsIGN0eF9p
ZCwgcHJpbyksIDApOwogfQogCitpbnQKK19fZ2VtX2NvbnRleHRfY2xvbmUoaW50IGk5MTUsCisJ
CSAgICB1aW50MzJfdCBzcmMsIHVuc2lnbmVkIGludCBzaGFyZSwKKwkJICAgIHVuc2lnbmVkIGlu
dCBmbGFncywKKwkJICAgIHVpbnQzMl90ICpvdXQpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9j
b250ZXh0X2NyZWF0ZV9leHRfY2xvbmUgY2xvbmUgPSB7CisJCXsgLm5hbWUgPSBJOTE1X0NPTlRF
WFRfQ1JFQVRFX0VYVF9DTE9ORSB9LAorCQkuY2xvbmVfaWQgPSBzcmMsCisJCS5mbGFncyA9IHNo
YXJlLAorCX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9leHQgYXJnID0g
eworCQkuZmxhZ3MgPSBmbGFncyB8IEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxBR1NfVVNFX0VYVEVO
U0lPTlMsCisJCS5leHRlbnNpb25zID0gdG9fdXNlcl9wb2ludGVyKCZjbG9uZSksCisJfTsKKwlp
bnQgZXJyID0gMDsKKworCWlmIChpZ3RfaW9jdGwoaTkxNSwgRFJNX0lPQ1RMX0k5MTVfR0VNX0NP
TlRFWFRfQ1JFQVRFX0VYVCwgJmFyZykpCisJCWVyciA9IC1lcnJubzsKKworCSpvdXQgPSBhcmcu
Y3R4X2lkOworCisJZXJybm8gPSAwOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBib29sIF9f
Z2VtX2NvbnRleHRfaGFzKGludCBpOTE1LCB1aW50MzJfdCBzaGFyZSwgdW5zaWduZWQgaW50IGZs
YWdzKQoreworCXVpbnQzMl90IGN0eDsKKworCV9fZ2VtX2NvbnRleHRfY2xvbmUoaTkxNSwgMCwg
c2hhcmUsIGZsYWdzLCAmY3R4KTsKKwlpZiAoY3R4KQorCQlnZW1fY29udGV4dF9kZXN0cm95KGk5
MTUsIGN0eCk7CisKKwllcnJubyA9IDA7CisJcmV0dXJuIGN0eDsKK30KKworYm9vbCBnZW1fY29u
dGV4dHNfaGFzX3NoYXJlZF9ndHQoaW50IGk5MTUpCit7CisJcmV0dXJuIF9fZ2VtX2NvbnRleHRf
aGFzKGk5MTUsIEk5MTVfQ09OVEVYVF9DTE9ORV9WTSwgMCk7Cit9CisKK2Jvb2wgZ2VtX2hhc19x
dWV1ZXMoaW50IGk5MTUpCit7CisJcmV0dXJuIF9fZ2VtX2NvbnRleHRfaGFzKGk5MTUsCisJCQkJ
IEk5MTVfQ09OVEVYVF9DTE9ORV9WTSwKKwkJCQkgSTkxNV9DT05URVhUX0NSRUFURV9GTEFHU19T
SU5HTEVfVElNRUxJTkUpOworfQorCit1aW50MzJfdCBnZW1fY29udGV4dF9jbG9uZShpbnQgaTkx
NSwKKwkJCSAgIHVpbnQzMl90IHNyYywgdW5zaWduZWQgaW50IHNoYXJlLAorCQkJICAgdW5zaWdu
ZWQgaW50IGZsYWdzKQoreworCXVpbnQzMl90IGN0eDsKKworCWlndF9hc3NlcnRfZXEoX19nZW1f
Y29udGV4dF9jbG9uZShpOTE1LCBzcmMsIHNoYXJlLCBmbGFncywgJmN0eCksIDApOworCisJcmV0
dXJuIGN0eDsKK30KKwordWludDMyX3QgZ2VtX3F1ZXVlX2NyZWF0ZShpbnQgaTkxNSkKK3sKKwly
ZXR1cm4gZ2VtX2NvbnRleHRfY2xvbmUoaTkxNSwgMCwKKwkJCQkgSTkxNV9DT05URVhUX0NMT05F
X1ZNLAorCQkJCSBJOTE1X0NPTlRFWFRfQ1JFQVRFX0ZMQUdTX1NJTkdMRV9USU1FTElORSk7Cit9
CisKIGJvb2wgZ2VtX2NvbnRleHRfaGFzX2VuZ2luZShpbnQgZmQsIHVpbnQzMl90IGN0eCwgdWlu
dDY0X3QgZW5naW5lKQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyIGV4ZWMg
PSB7fTsKZGlmZiAtLWdpdCBhL2xpYi9pOTE1L2dlbV9jb250ZXh0LmggYi9saWIvaTkxNS9nZW1f
Y29udGV4dC5oCmluZGV4IGEwNTI3MTRkNC4uODA0M2MzNDAxIDEwMDY0NAotLS0gYS9saWIvaTkx
NS9nZW1fY29udGV4dC5oCisrKyBiL2xpYi9pOTE1L2dlbV9jb250ZXh0LmgKQEAgLTI5LDYgKzI5
LDE5IEBAIGludCBfX2dlbV9jb250ZXh0X2NyZWF0ZShpbnQgZmQsIHVpbnQzMl90ICpjdHhfaWQp
Owogdm9pZCBnZW1fY29udGV4dF9kZXN0cm95KGludCBmZCwgdWludDMyX3QgY3R4X2lkKTsKIGlu
dCBfX2dlbV9jb250ZXh0X2Rlc3Ryb3koaW50IGZkLCB1aW50MzJfdCBjdHhfaWQpOwogCitpbnQg
X19nZW1fY29udGV4dF9jbG9uZShpbnQgaTkxNSwKKwkJCXVpbnQzMl90IHNyYywgdW5zaWduZWQg
aW50IHNoYXJlLAorCQkJdW5zaWduZWQgaW50IGZsYWdzLAorCQkJdWludDMyX3QgKm91dCk7Cit1
aW50MzJfdCBnZW1fY29udGV4dF9jbG9uZShpbnQgaTkxNSwKKwkJCSAgIHVpbnQzMl90IHNyYywg
dW5zaWduZWQgaW50IHNoYXJlLAorCQkJICAgdW5zaWduZWQgaW50IGZsYWdzKTsKKwordWludDMy
X3QgZ2VtX3F1ZXVlX2NyZWF0ZShpbnQgaTkxNSk7CisKK2Jvb2wgZ2VtX2NvbnRleHRzX2hhc19z
aGFyZWRfZ3R0KGludCBpOTE1KTsKK2Jvb2wgZ2VtX2hhc19xdWV1ZXMoaW50IGk5MTUpOworCiBi
b29sIGdlbV9oYXNfY29udGV4dHMoaW50IGZkKTsKIHZvaWQgZ2VtX3JlcXVpcmVfY29udGV4dHMo
aW50IGZkKTsKIHZvaWQgZ2VtX2NvbnRleHRfcmVxdWlyZV9iYW5uYWJsZShpbnQgZmQpOwpkaWZm
IC0tZ2l0IGEvdGVzdHMvTWFrZWZpbGUuc291cmNlcyBiL3Rlc3RzL01ha2VmaWxlLnNvdXJjZXMK
aW5kZXggZTFiN2ZlZWIyLi4zNTUyZTg5NWIgMTAwNjQ0Ci0tLSBhL3Rlc3RzL01ha2VmaWxlLnNv
dXJjZXMKKysrIGIvdGVzdHMvTWFrZWZpbGUuc291cmNlcwpAQCAtMjIsNiArMjIsNyBAQCBURVNU
U19wcm9ncyA9IFwKIAlkcm1fbW0gXAogCWRybV9yZWFkIFwKIAlpOTE1L2dlbV9jdHhfY2xvbmUg
XAorCWk5MTUvZ2VtX2N0eF9zaGFyZWQgXAogCWk5MTUvZ2VtX3ZtX2NyZWF0ZSBcCiAJa21zXzNk
IFwKIAlrbXNfYWRkZmJfYmFzaWMgXApkaWZmIC0tZ2l0IGEvdGVzdHMvaTkxNS9nZW1fY3R4X3No
YXJlZC5jIGIvdGVzdHMvaTkxNS9nZW1fY3R4X3NoYXJlZC5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDAwMDAwMDAwMC4uMDA3NmY1ZTlkCi0tLSAvZGV2L251bGwKKysrIGIvdGVzdHMvaTkx
NS9nZW1fY3R4X3NoYXJlZC5jCkBAIC0wLDAgKzEsODU2IEBACisvKgorICogQ29weXJpZ2h0IMKp
IDIwMTcgSW50ZWwgQ29ycG9yYXRpb24KKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFu
dGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBv
ZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAi
U29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rp
b24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8gdXNlLCBj
b3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLAorICog
YW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25z
IHRvIHdob20gdGhlCisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3Qg
dG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5cmlnaHQg
bm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcgdGhlIG5leHQKKyAq
IHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlh
bCBwb3J0aW9ucyBvZiB0aGUKKyAqIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQ
Uk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9S
CisgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVT
IE9GIE1FUkNIQU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NF
IEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIEFVVEhPUlMg
T1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1Ig
T1RIRVIKKyAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRP
UlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElP
TiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTCisgKiBJTiBU
SEUgU09GVFdBUkUuCisgKgorICovCisKKyNpbmNsdWRlICJpZ3QuaCIKKworI2luY2x1ZGUgPHVu
aXN0ZC5oPgorI2luY2x1ZGUgPHN0ZGxpYi5oPgorI2luY2x1ZGUgPHN0ZGludC5oPgorI2luY2x1
ZGUgPHN0ZGlvLmg+CisjaW5jbHVkZSA8c3RyaW5nLmg+CisjaW5jbHVkZSA8ZmNudGwuaD4KKyNp
bmNsdWRlIDxpbnR0eXBlcy5oPgorI2luY2x1ZGUgPGVycm5vLmg+CisjaW5jbHVkZSA8c3lzL3N0
YXQuaD4KKyNpbmNsdWRlIDxzeXMvaW9jdGwuaD4KKyNpbmNsdWRlIDxzeXMvdGltZS5oPgorCisj
aW5jbHVkZSA8ZHJtLmg+CisKKyNpbmNsdWRlICJpZ3RfcmFuZC5oIgorI2luY2x1ZGUgImlndF92
Z2VtLmgiCisjaW5jbHVkZSAic3luY19maWxlLmgiCisKKyNkZWZpbmUgTE8gMAorI2RlZmluZSBI
SSAxCisjZGVmaW5lIE5PSVNFIDIKKworI2RlZmluZSBNQVhfUFJJTyBMT0NBTF9JOTE1X0NPTlRF
WFRfTUFYX1VTRVJfUFJJT1JJVFkKKyNkZWZpbmUgTUlOX1BSSU8gTE9DQUxfSTkxNV9DT05URVhU
X01JTl9VU0VSX1BSSU9SSVRZCisKK3N0YXRpYyBpbnQgcHJpb3JpdGllc1tdID0geworCVtMT10g
PSBNSU5fUFJJTyAvIDIsCisJW0hJXSA9IE1BWF9QUklPIC8gMiwKK307CisKKyNkZWZpbmUgTUFY
X0VMU1BfUUxFTiAxNgorCitJR1RfVEVTVF9ERVNDUklQVElPTigiVGVzdCBzaGFyZWQgY29udGV4
dHMuIik7CisKK3N0YXRpYyB2b2lkIGNyZWF0ZV9zaGFyZWRfZ3R0KGludCBpOTE1LCB1bnNpZ25l
ZCBpbnQgZmxhZ3MpCisjZGVmaW5lIERFVEFDSEVEIDB4MQoreworCWNvbnN0IHVpbnQzMl90IGJi
ZSA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVj
dDIgb2JqID0geworCQkuaGFuZGxlID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KSwKKwl9OworCXN0
cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZXhlY2J1ZiA9IHsKKwkJLmJ1ZmZlcnNfcHRy
ID0gdG9fdXNlcl9wb2ludGVyKCZvYmopLAorCQkuYnVmZmVyX2NvdW50ID0gMSwKKwl9OworCXVp
bnQzMl90IHBhcmVudCwgY2hpbGQ7CisKKwlnZW1fd3JpdGUoaTkxNSwgb2JqLmhhbmRsZSwgMCwg
JmJiZSwgc2l6ZW9mKGJiZSkpOworCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsKKwlnZW1f
c3luYyhpOTE1LCBvYmouaGFuZGxlKTsKKworCWNoaWxkID0gZmxhZ3MgJiBERVRBQ0hFRCA/IGdl
bV9jb250ZXh0X2NyZWF0ZShpOTE1KSA6IDA7CisJaWd0X3VudGlsX3RpbWVvdXQoMikgeworCQlw
YXJlbnQgPSBmbGFncyAmIERFVEFDSEVEID8gY2hpbGQgOiAwOworCQljaGlsZCA9IGdlbV9jb250
ZXh0X2Nsb25lKGk5MTUsCisJCQkJCSAgcGFyZW50LCBJOTE1X0NPTlRFWFRfQ0xPTkVfVk0sCisJ
CQkJCSAgMCk7CisJCWV4ZWNidWYucnN2ZDEgPSBjaGlsZDsKKwkJZ2VtX2V4ZWNidWYoaTkxNSwg
JmV4ZWNidWYpOworCisJCWlmIChmbGFncyAmIERFVEFDSEVEKSB7CisJCQlnZW1fY29udGV4dF9k
ZXN0cm95KGk5MTUsIHBhcmVudCk7CisJCQlnZW1fZXhlY2J1ZihpOTE1LCAmZXhlY2J1Zik7CisJ
CX0gZWxzZSB7CisJCQlwYXJlbnQgPSBjaGlsZDsKKwkJCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkx
NSwgcGFyZW50KTsKKwkJfQorCisJCWV4ZWNidWYucnN2ZDEgPSBwYXJlbnQ7CisJCWlndF9hc3Nl
cnRfZXEoX19nZW1fZXhlY2J1ZihpOTE1LCAmZXhlY2J1ZiksIC1FTk9FTlQpOworCQlpZ3RfYXNz
ZXJ0X2VxKF9fZ2VtX2NvbnRleHRfY2xvbmUoaTkxNSwKKwkJCQkJCSAgcGFyZW50LCBJOTE1X0NP
TlRFWFRfQ0xPTkVfVk0sCisJCQkJCQkgIDAsICZwYXJlbnQpLCAtRU5PRU5UKTsKKwl9CisJaWYg
KGZsYWdzICYgREVUQUNIRUQpCisJCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY2hpbGQpOwor
CisJZ2VtX3N5bmMoaTkxNSwgb2JqLmhhbmRsZSk7CisJZ2VtX2Nsb3NlKGk5MTUsIG9iai5oYW5k
bGUpOworfQorCitzdGF0aWMgdm9pZCBkaXNqb2ludF90aW1lbGluZXMoaW50IGk5MTUpCit7CisJ
SUdUX0NPUktfSEFORExFKGNvcmspOworCWlndF9zcGluX3QgKnNwaW5bMl07CisJdWludDMyX3Qg
cGx1ZywgY2hpbGQ7CisKKwlpZ3RfcmVxdWlyZShnZW1faGFzX2V4ZWNsaXN0cyhpOTE1KSk7CisK
KwkvKgorCSAqIEVhY2ggY29udGV4dCwgYWx0aG91Z2ggdGhleSBzaGFyZSBhIHZtLCBhcmUgZXhw
ZWN0ZWQgdG8gYmUKKwkgKiBkaXN0aW5jdCB0aW1lbGluZXMuIEEgcmVxdWVzdCBxdWV1ZWQgdG8g
b25lIGNvbnRleHQgc2hvdWxkIGJlCisJICogaW5kZXBlbmRlbnQgb2YgYW55IHNoYXJlZCBjb250
ZXh0cy4KKwkgKi8KKwljaGlsZCA9IGdlbV9jb250ZXh0X2Nsb25lKGk5MTUsIDAsIEk5MTVfQ09O
VEVYVF9DTE9ORV9WTSwgMCk7CisJcGx1ZyA9IGlndF9jb3JrX3BsdWcoJmNvcmssIGk5MTUpOwor
CisJc3BpblswXSA9IF9faWd0X3NwaW5fbmV3KGk5MTUsIC5jdHggPSAwLCAuZGVwZW5kZW5jeSA9
IHBsdWcpOworCXNwaW5bMV0gPSBfX2lndF9zcGluX25ldyhpOTE1LCAuY3R4ID0gY2hpbGQpOwor
CisJLyogV2FpdCBmb3IgdGhlIHNlY29uZCBzcGlubmVyLCB3aWxsIGhhbmcgaWYgc3R1Y2sgYmVo
aW5kIHRoZSBmaXJzdCAqLworCWlndF9zcGluX2VuZChzcGluWzFdKTsKKwlnZW1fc3luYyhpOTE1
LCBzcGluWzFdLT5oYW5kbGUpOworCisJaWd0X2NvcmtfdW5wbHVnKCZjb3JrKTsKKworCWlndF9z
cGluX2ZyZWUoaTkxNSwgc3BpblsxXSk7CisJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluWzBdKTsK
K30KKworc3RhdGljIHZvaWQgZXhoYXVzdF9zaGFyZWRfZ3R0KGludCBpOTE1LCB1bnNpZ25lZCBp
bnQgZmxhZ3MpCisjZGVmaW5lIEVYSEFVU1RfTFJDIDB4MQoreworCWk5MTUgPSBnZW1fcmVvcGVu
X2RyaXZlcihpOTE1KTsKKworCWlndF9mb3JrKHBpZCwgMSkgeworCQljb25zdCB1aW50MzJfdCBi
YmUgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2Jq
ZWN0MiBvYmogPSB7CisJCQkuaGFuZGxlID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KQorCQl9Owor
CQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJCQkuYnVmZmVy
c19wdHIgPSB0b191c2VyX3BvaW50ZXIoJm9iaiksCisJCQkuYnVmZmVyX2NvdW50ID0gMSwKKwkJ
fTsKKwkJdWludDMyX3QgcGFyZW50LCBjaGlsZDsKKwkJdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7
CisJCWludCBlcnI7CisKKwkJZ2VtX3dyaXRlKGk5MTUsIG9iai5oYW5kbGUsIDAsICZiYmUsIHNp
emVvZihiYmUpKTsKKworCQljaGlsZCA9IDA7CisJCWZvciAoOzspIHsKKwkJCXBhcmVudCA9IGNo
aWxkOworCQkJZXJyID0gX19nZW1fY29udGV4dF9jbG9uZShpOTE1LAorCQkJCQkJICBwYXJlbnQs
IEk5MTVfQ09OVEVYVF9DTE9ORV9WTSwKKwkJCQkJCSAgMCwgJmNoaWxkKTsKKwkJCWlmIChlcnIp
CisJCQkJYnJlYWs7CisKKwkJCWlmIChmbGFncyAmIEVYSEFVU1RfTFJDKSB7CisJCQkJZXhlY2J1
Zi5yc3ZkMSA9IGNoaWxkOworCQkJCWVyciA9IF9fZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNidWYp
OworCQkJCWlmIChlcnIpCisJCQkJCWJyZWFrOworCQkJfQorCisJCQljb3VudCsrOworCQl9CisJ
CWdlbV9zeW5jKGk5MTUsIG9iai5oYW5kbGUpOworCisJCWlndF9pbmZvKCJDcmVhdGVkICVsdSBz
aGFyZWQgY29udGV4dHMsIGJlZm9yZSAlZCAoJXMpXG4iLAorCQkJIGNvdW50LCBlcnIsIHN0cmVy
cm9yKC1lcnIpKTsKKwl9CisJY2xvc2UoaTkxNSk7CisJaWd0X3dhaXRjaGlsZHJlbigpOworfQor
CitzdGF0aWMgdm9pZCBleGVjX3NoYXJlZF9ndHQoaW50IGk5MTUsIHVuc2lnbmVkIGludCByaW5n
KQoreworCWNvbnN0IGludCBnZW4gPSBpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChpOTE1
KSk7CisJY29uc3QgdWludDMyX3QgYmJlID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiBvYmogPSB7CisJCS5oYW5kbGUgPSBnZW1fY3JlYXRl
KGk5MTUsIDQwOTYpCisJfTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNi
dWYgPSB7CisJCS5idWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKSwKKwkJLmJ1ZmZl
cl9jb3VudCA9IDEsCisJCS5mbGFncyA9IHJpbmcsCisJfTsKKwl1aW50MzJfdCBzY3JhdGNoID0g
b2JqLmhhbmRsZTsKKwl1aW50MzJfdCBiYXRjaFsxNl07CisJaW50IGk7CisKKwlnZW1fcmVxdWly
ZV9yaW5nKGk5MTUsIHJpbmcpOworCWlndF9yZXF1aXJlKGdlbV9jYW5fc3RvcmVfZHdvcmQoaTkx
NSwgcmluZykpOworCisJLyogTG9hZCBvYmplY3QgaW50byBwbGFjZSBpbiB0aGUgR1RUICovCisJ
Z2VtX3dyaXRlKGk5MTUsIG9iai5oYW5kbGUsIDAsICZiYmUsIHNpemVvZihiYmUpKTsKKwlnZW1f
ZXhlY2J1ZihpOTE1LCAmZXhlY2J1Zik7CisKKwkvKiBQcmVzdW1lIG5vdGhpbmcgY2F1c2VzIGFu
IGV2aWN0aW9uIGluIHRoZSBtZWFudGltZSAqLworCisJb2JqLmhhbmRsZSA9IGdlbV9jcmVhdGUo
aTkxNSwgNDA5Nik7CisKKwlpID0gMDsKKwliYXRjaFtpXSA9IE1JX1NUT1JFX0RXT1JEX0lNTSB8
IChnZW4gPCA2ID8gMSA8PCAyMiA6IDApOworCWlmIChnZW4gPj0gOCkgeworCQliYXRjaFsrK2ld
ID0gb2JqLm9mZnNldDsKKwkJYmF0Y2hbKytpXSA9IDA7CisJfSBlbHNlIGlmIChnZW4gPj0gNCkg
eworCQliYXRjaFsrK2ldID0gMDsKKwkJYmF0Y2hbKytpXSA9IG9iai5vZmZzZXQ7CisJfSBlbHNl
IHsKKwkJYmF0Y2hbaV0tLTsKKwkJYmF0Y2hbKytpXSA9IG9iai5vZmZzZXQ7CisJfQorCWJhdGNo
WysraV0gPSAweGMwZmZlZTsKKwliYXRjaFsrK2ldID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwln
ZW1fd3JpdGUoaTkxNSwgb2JqLmhhbmRsZSwgMCwgYmF0Y2gsIHNpemVvZihiYXRjaCkpOworCisJ
b2JqLm9mZnNldCArPSA0MDk2OyAvKiBtYWtlIHN1cmUgd2UgZG9uJ3QgY2F1c2UgYW4gZXZpY3Rp
b24hICovCisJb2JqLmZsYWdzIHw9IEVYRUNfT0JKRUNUX1BJTk5FRDsKKwlleGVjYnVmLnJzdmQx
ID0gZ2VtX2NvbnRleHRfY2xvbmUoaTkxNSwgMCwgSTkxNV9DT05URVhUX0NMT05FX1ZNLCAwKTsK
KwlpZiAoZ2VuID4gMyAmJiBnZW4gPCA2KQorCQlleGVjYnVmLmZsYWdzIHw9IEk5MTVfRVhFQ19T
RUNVUkU7CisKKwlnZW1fZXhlY2J1ZihpOTE1LCAmZXhlY2J1Zik7CisJZ2VtX2NvbnRleHRfZGVz
dHJveShpOTE1LCBleGVjYnVmLnJzdmQxKTsKKwlnZW1fc3luYyhpOTE1LCBvYmouaGFuZGxlKTsg
Lyogd3JpdGUgaGF6YXJkIGxpZXMgKi8KKwlnZW1fY2xvc2UoaTkxNSwgb2JqLmhhbmRsZSk7CisK
KwlnZW1fcmVhZChpOTE1LCBzY3JhdGNoLCAwLCBiYXRjaCwgc2l6ZW9mKHVpbnQzMl90KSk7CisJ
Z2VtX2Nsb3NlKGk5MTUsIHNjcmF0Y2gpOworCisJaWd0X2Fzc2VydF9lcV91MzIoKmJhdGNoLCAw
eGMwZmZlZSk7Cit9CisKK3N0YXRpYyBpbnQgbm9wX3N5bmMoaW50IGk5MTUsIHVpbnQzMl90IGN0
eCwgdW5zaWduZWQgaW50IHJpbmcsIGludDY0X3QgdGltZW91dCkKK3sKKwljb25zdCB1aW50MzJf
dCBiYmUgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19v
YmplY3QyIG9iaiA9IHsKKwkJLmhhbmRsZSA9IGdlbV9jcmVhdGUoaTkxNSwgNDA5NiksCisJfTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJCS5idWZmZXJz
X3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKSwKKwkJLmJ1ZmZlcl9jb3VudCA9IDEsCisJCS5m
bGFncyA9IHJpbmcsCisJCS5yc3ZkMSA9IGN0eCwKKwl9OworCWludCBlcnI7CisKKwlnZW1fd3Jp
dGUoaTkxNSwgb2JqLmhhbmRsZSwgMCwgJmJiZSwgc2l6ZW9mKGJiZSkpOworCWdlbV9leGVjYnVm
KGk5MTUsICZleGVjYnVmKTsKKwllcnIgPSBnZW1fd2FpdChpOTE1LCBvYmouaGFuZGxlLCAmdGlt
ZW91dCk7CisJZ2VtX2Nsb3NlKGk5MTUsIG9iai5oYW5kbGUpOworCisJcmV0dXJuIGVycjsKK30K
Kworc3RhdGljIGJvb2wgaGFzX3NpbmdsZV90aW1lbGluZShpbnQgaTkxNSkKK3sKKwl1aW50MzJf
dCBjdHg7CisKKwlfX2dlbV9jb250ZXh0X2Nsb25lKGk5MTUsIDAsIDAsCisJCQkgICAgSTkxNV9D
T05URVhUX0NSRUFURV9GTEFHU19TSU5HTEVfVElNRUxJTkUsCisJCQkgICAgJmN0eCk7CisJaWYg
KGN0eCkKKwkJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjdHgpOworCisJcmV0dXJuIGN0eCAh
PSAwOworfQorCitzdGF0aWMgYm9vbCBpZ25vcmVfZW5naW5lKHVuc2lnbmVkIGVuZ2luZSkKK3sK
KwlpZiAoZW5naW5lID09IDApCisJCXJldHVybiB0cnVlOworCisJaWYgKGVuZ2luZSA9PSBJOTE1
X0VYRUNfQlNEKQorCQlyZXR1cm4gdHJ1ZTsKKworCXJldHVybiBmYWxzZTsKK30KKworc3RhdGlj
IHZvaWQgc2luZ2xlX3RpbWVsaW5lKGludCBpOTE1KQoreworCWNvbnN0IHVpbnQzMl90IGJiZSA9
IE1JX0JBVENIX0JVRkZFUl9FTkQ7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIg
b2JqID0geworCQkuaGFuZGxlID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KSwKKwl9OworCXN0cnVj
dCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZXhlY2J1ZiA9IHsKKwkJLmJ1ZmZlcnNfcHRyID0g
dG9fdXNlcl9wb2ludGVyKCZvYmopLAorCQkuYnVmZmVyX2NvdW50ID0gMSwKKwl9OworCXN0cnVj
dCBzeW5jX2ZlbmNlX2luZm8gcmluZ3NbMTZdOworCXN0cnVjdCBzeW5jX2ZpbGVfaW5mbyBzeW5j
X2ZpbGVfaW5mbyA9IHsKKwkJLm51bV9mZW5jZXMgPSAxLAorCX07CisJdW5zaWduZWQgaW50IGVu
Z2luZTsKKwlpbnQgbjsKKworCWlndF9yZXF1aXJlKGhhc19zaW5nbGVfdGltZWxpbmUoaTkxNSkp
OworCisJZ2VtX3dyaXRlKGk5MTUsIG9iai5oYW5kbGUsIDAsICZiYmUsIHNpemVvZihiYmUpKTsK
KwlnZW1fZXhlY2J1ZihpOTE1LCAmZXhlY2J1Zik7CisJZ2VtX3N5bmMoaTkxNSwgb2JqLmhhbmRs
ZSk7CisKKwkvKgorCSAqIEZvciBhICJzaW5nbGUgdGltZWxpbmUiIGNvbnRleHQsIGVhY2ggcmlu
ZyBpcyBvbiB0aGUgY29tbW9uCisJICogdGltZWxpbmUsIHVubGlrZSBhIG5vcm1hbCBjb250ZXh0
IHdoZXJlIGVhY2ggcmluZyBoYXMgYW4KKwkgKiBpbmRlcGVuZGVudCB0aW1lbGluZS4gVGhhdCBp
cyBubyBtYXR0ZXIgd2hpY2ggZW5naW5lIHdlIHN1Ym1pdAorCSAqIHRvLCBpdCByZXBvcnRzIHRo
ZSBzYW1lIHRpbWVsaW5lIG5hbWUgYW5kIGZlbmNlIGNvbnRleHQuIEhvd2V2ZXIsCisJICogdGhl
IGZlbmNlIGNvbnRleHQgaXMgbm90IHJlcG9ydGVkIHRocm91Z2ggdGhlIHN5bmNfZmVuY2VfaW5m
by4KKwkgKi8KKwlleGVjYnVmLnJzdmQxID0KKwkJZ2VtX2NvbnRleHRfY2xvbmUoaTkxNSwgMCwg
MCwKKwkJCQkgIEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FKTsKKwll
eGVjYnVmLmZsYWdzID0gSTkxNV9FWEVDX0ZFTkNFX09VVDsKKwluID0gMDsKKwlmb3JfZWFjaF9l
bmdpbmUoaTkxNSwgZW5naW5lKSB7CisJCWdlbV9leGVjYnVmX3dyKGk5MTUsICZleGVjYnVmKTsK
KwkJc3luY19maWxlX2luZm8uc3luY19mZW5jZV9pbmZvID0gdG9fdXNlcl9wb2ludGVyKCZyaW5n
c1tuXSk7CisJCWRvX2lvY3RsKGV4ZWNidWYucnN2ZDIgPj4gMzIsIFNZTkNfSU9DX0ZJTEVfSU5G
TywgJnN5bmNfZmlsZV9pbmZvKTsKKwkJY2xvc2UoZXhlY2J1Zi5yc3ZkMiA+PiAzMik7CisKKwkJ
aWd0X2luZm8oInJpbmdbJWRdIGZlbmNlOiAlcyAlc1xuIiwKKwkJCSBuLCByaW5nc1tuXS5kcml2
ZXJfbmFtZSwgcmluZ3Nbbl0ub2JqX25hbWUpOworCQluKys7CisJfQorCWdlbV9zeW5jKGk5MTUs
IG9iai5oYW5kbGUpOworCWdlbV9jbG9zZShpOTE1LCBvYmouaGFuZGxlKTsKKworCWZvciAoaW50
IGkgPSAxOyBpIDwgbjsgaSsrKSB7CisJCWlndF9hc3NlcnQoIXN0cmNtcChyaW5nc1swXS5kcml2
ZXJfbmFtZSwgcmluZ3NbaV0uZHJpdmVyX25hbWUpKTsKKwkJaWd0X2Fzc2VydCghc3RyY21wKHJp
bmdzWzBdLm9ial9uYW1lLCByaW5nc1tpXS5vYmpfbmFtZSkpOworCX0KK30KKworc3RhdGljIHZv
aWQgZXhlY19zaW5nbGVfdGltZWxpbmUoaW50IGk5MTUsIHVuc2lnbmVkIGludCByaW5nKQorewor
CXVuc2lnbmVkIGludCBvdGhlcjsKKwlpZ3Rfc3Bpbl90ICpzcGluOworCXVpbnQzMl90IGN0eDsK
KworCWdlbV9yZXF1aXJlX3JpbmcoaTkxNSwgcmluZyk7CisJaWd0X3JlcXVpcmUoaGFzX3Npbmds
ZV90aW1lbGluZShpOTE1KSk7CisKKwkvKgorCSAqIE9uIGFuIG9yZGluYXJ5IGNvbnRleHQsIGEg
YmxvY2thZ2Ugb24gb25lIHJpbmcgZG9lc24ndCBwcmV2ZW50CisJICogZXhlY3V0aW9uIG9uIGFu
IG90aGVyLgorCSAqLworCWN0eCA9IDA7CisJc3BpbiA9IE5VTEw7CisJZm9yX2VhY2hfZW5naW5l
KGk5MTUsIG90aGVyKSB7CisJCWlmIChvdGhlciA9PSByaW5nIHx8IGlnbm9yZV9lbmdpbmUob3Ro
ZXIpKQorCQkJY29udGludWU7CisKKwkJaWYgKHNwaW4gPT0gTlVMTCkgeworCQkJc3BpbiA9IF9f
aWd0X3NwaW5fbmV3KGk5MTUsIC5jdHggPSBjdHgsIC5lbmdpbmUgPSBvdGhlcik7CisJCX0gZWxz
ZSB7CisJCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJCQkJ
LmJ1ZmZlcnNfcHRyID0gc3Bpbi0+ZXhlY2J1Zi5idWZmZXJzX3B0ciwKKwkJCQkuYnVmZmVyX2Nv
dW50ID0gc3Bpbi0+ZXhlY2J1Zi5idWZmZXJfY291bnQsCisJCQkJLmZsYWdzID0gb3RoZXIsCisJ
CQkJLnJzdmQxID0gY3R4LAorCQkJfTsKKwkJCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsK
KwkJfQorCX0KKwlpZ3RfcmVxdWlyZShzcGluKTsKKwlpZ3RfYXNzZXJ0X2VxKG5vcF9zeW5jKGk5
MTUsIGN0eCwgcmluZywgTlNFQ19QRVJfU0VDKSwgMCk7CisJaWd0X3NwaW5fZnJlZShpOTE1LCBz
cGluKTsKKworCS8qCisJICogQnV0IGlmIHdlIGNyZWF0ZSBhIGNvbnRleHQgd2l0aCBqdXN0IGEg
c2luZ2xlIHNoYXJlZCB0aW1lbGluZSwKKwkgKiB0aGVuIGl0IHdpbGwgYmxvY2sgd2FpdGluZyBm
b3IgdGhlIGVhcmxpZXIgcmVxdWVzdHMgb24gdGhlCisJICogb3RoZXIgZW5naW5lcy4KKwkgKi8K
KwljdHggPSBnZW1fY29udGV4dF9jbG9uZShpOTE1LCAwLCAwLAorCQkJCUk5MTVfQ09OVEVYVF9D
UkVBVEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FKTsKKwlzcGluID0gTlVMTDsKKwlmb3JfZWFjaF9l
bmdpbmUoaTkxNSwgb3RoZXIpIHsKKwkJaWYgKG90aGVyID09IHJpbmcgfHwgaWdub3JlX2VuZ2lu
ZShvdGhlcikpCisJCQljb250aW51ZTsKKworCQlpZiAoc3BpbiA9PSBOVUxMKSB7CisJCQlzcGlu
ID0gX19pZ3Rfc3Bpbl9uZXcoaTkxNSwgLmN0eCA9IGN0eCwgLmVuZ2luZSA9IG90aGVyKTsKKwkJ
fSBlbHNlIHsKKwkJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZXhlY2J1ZiA9IHsK
KwkJCQkuYnVmZmVyc19wdHIgPSBzcGluLT5leGVjYnVmLmJ1ZmZlcnNfcHRyLAorCQkJCS5idWZm
ZXJfY291bnQgPSBzcGluLT5leGVjYnVmLmJ1ZmZlcl9jb3VudCwKKwkJCQkuZmxhZ3MgPSBvdGhl
ciwKKwkJCQkucnN2ZDEgPSBjdHgsCisJCQl9OworCQkJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNi
dWYpOworCQl9CisJfQorCWlndF9hc3NlcnQoc3Bpbik7CisJaWd0X2Fzc2VydF9lcShub3Bfc3lu
YyhpOTE1LCBjdHgsIHJpbmcsIE5TRUNfUEVSX1NFQyksIC1FVElNRSk7CisJaWd0X3NwaW5fZnJl
ZShpOTE1LCBzcGluKTsKK30KKworc3RhdGljIHZvaWQgc3RvcmVfZHdvcmQoaW50IGk5MTUsIHVp
bnQzMl90IGN0eCwgdW5zaWduZWQgcmluZywKKwkJCXVpbnQzMl90IHRhcmdldCwgdWludDMyX3Qg
b2Zmc2V0LCB1aW50MzJfdCB2YWx1ZSwKKwkJCXVpbnQzMl90IGNvcmssIHVuc2lnbmVkIHdyaXRl
X2RvbWFpbikKK3sKKwljb25zdCBpbnQgZ2VuID0gaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2
aWQoaTkxNSkpOworCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyIG9ialszXTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRpb25fZW50cnkgcmVsb2M7CisJc3RydWN0IGRybV9p
OTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVmOworCXVpbnQzMl90IGJhdGNoWzE2XTsKKwlpbnQg
aTsKKworCW1lbXNldCgmZXhlY2J1ZiwgMCwgc2l6ZW9mKGV4ZWNidWYpKTsKKwlleGVjYnVmLmJ1
ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2ludGVyKG9iaiArICFjb3JrKTsKKwlleGVjYnVmLmJ1ZmZl
cl9jb3VudCA9IDIgKyAhIWNvcms7CisJZXhlY2J1Zi5mbGFncyA9IHJpbmc7CisJaWYgKGdlbiA8
IDYpCisJCWV4ZWNidWYuZmxhZ3MgfD0gSTkxNV9FWEVDX1NFQ1VSRTsKKwlleGVjYnVmLnJzdmQx
ID0gY3R4OworCisJbWVtc2V0KG9iaiwgMCwgc2l6ZW9mKG9iaikpOworCW9ialswXS5oYW5kbGUg
PSBjb3JrOworCW9ialsxXS5oYW5kbGUgPSB0YXJnZXQ7CisJb2JqWzJdLmhhbmRsZSA9IGdlbV9j
cmVhdGUoaTkxNSwgNDA5Nik7CisKKwltZW1zZXQoJnJlbG9jLCAwLCBzaXplb2YocmVsb2MpKTsK
KwlyZWxvYy50YXJnZXRfaGFuZGxlID0gb2JqWzFdLmhhbmRsZTsKKwlyZWxvYy5wcmVzdW1lZF9v
ZmZzZXQgPSAwOworCXJlbG9jLm9mZnNldCA9IHNpemVvZih1aW50MzJfdCk7CisJcmVsb2MuZGVs
dGEgPSBvZmZzZXQ7CisJcmVsb2MucmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9NQUlOX0lOU1RS
VUNUSU9OOworCXJlbG9jLndyaXRlX2RvbWFpbiA9IHdyaXRlX2RvbWFpbjsKKwlvYmpbMl0ucmVs
b2NzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmcmVsb2MpOworCW9ialsyXS5yZWxvY2F0aW9uX2Nv
dW50ID0gMTsKKworCWkgPSAwOworCWJhdGNoW2ldID0gTUlfU1RPUkVfRFdPUkRfSU1NIHwgKGdl
biA8IDYgPyAxIDw8IDIyIDogMCk7CisJaWYgKGdlbiA+PSA4KSB7CisJCWJhdGNoWysraV0gPSBv
ZmZzZXQ7CisJCWJhdGNoWysraV0gPSAwOworCX0gZWxzZSBpZiAoZ2VuID49IDQpIHsKKwkJYmF0
Y2hbKytpXSA9IDA7CisJCWJhdGNoWysraV0gPSBvZmZzZXQ7CisJCXJlbG9jLm9mZnNldCArPSBz
aXplb2YodWludDMyX3QpOworCX0gZWxzZSB7CisJCWJhdGNoW2ldLS07CisJCWJhdGNoWysraV0g
PSBvZmZzZXQ7CisJfQorCWJhdGNoWysraV0gPSB2YWx1ZTsKKwliYXRjaFsrK2ldID0gTUlfQkFU
Q0hfQlVGRkVSX0VORDsKKwlnZW1fd3JpdGUoaTkxNSwgb2JqWzJdLmhhbmRsZSwgMCwgYmF0Y2gs
IHNpemVvZihiYXRjaCkpOworCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsKKwlnZW1fY2xv
c2UoaTkxNSwgb2JqWzJdLmhhbmRsZSk7Cit9CisKK3N0YXRpYyB1aW50MzJfdCBjcmVhdGVfaGln
aGVzdF9wcmlvcml0eShpbnQgaTkxNSkKK3sKKwl1aW50MzJfdCBjdHggPSBnZW1fY29udGV4dF9j
cmVhdGUoaTkxNSk7CisKKwkvKgorCSAqIElmIHRoZXJlIGlzIG5vIHByaW9yaXR5IHN1cHBvcnQs
IGFsbCBjb250ZXh0cyB3aWxsIGhhdmUgZXF1YWwKKwkgKiBwcmlvcml0eSAoYW5kIHRoZXJlZm9y
ZSB0aGUgbWF4IHVzZXIgcHJpb3JpdHkpLCBzbyBubyBjb250ZXh0CisJICogY2FuIG92ZXJ0YWtl
IHVzLCBhbmQgd2UgZWZmZWN0aXZlbHkgY2FuIGZvcm0gYSBwbHVnLgorCSAqLworCV9fZ2VtX2Nv
bnRleHRfc2V0X3ByaW9yaXR5KGk5MTUsIGN0eCwgTUFYX1BSSU8pOworCisJcmV0dXJuIGN0eDsK
K30KKworc3RhdGljIHZvaWQgdW5wbHVnX3Nob3dfcXVldWUoaW50IGk5MTUsIHN0cnVjdCBpZ3Rf
Y29yayAqYywgdW5zaWduZWQgaW50IGVuZ2luZSkKK3sKKwlpZ3Rfc3Bpbl90ICpzcGluW01BWF9F
TFNQX1FMRU5dOworCisJZm9yIChpbnQgbiA9IDA7IG4gPCBBUlJBWV9TSVpFKHNwaW4pOyBuKysp
IHsKKwkJY29uc3Qgc3RydWN0IGlndF9zcGluX2ZhY3Rvcnkgb3B0cyA9IHsKKwkJCS5jdHggPSBj
cmVhdGVfaGlnaGVzdF9wcmlvcml0eShpOTE1KSwKKwkJCS5lbmdpbmUgPSBlbmdpbmUsCisJCX07
CisJCXNwaW5bbl0gPSBfX2lndF9zcGluX2ZhY3RvcnkoaTkxNSwgJm9wdHMpOworCQlnZW1fY29u
dGV4dF9kZXN0cm95KGk5MTUsIG9wdHMuY3R4KTsKKwl9CisKKwlpZ3RfY29ya191bnBsdWcoYyk7
IC8qIGJhdGNoZXMgd2lsbCBub3cgYmUgcXVldWVkIG9uIHRoZSBlbmdpbmUgKi8KKwlpZ3RfZGVi
dWdmc19kdW1wKGk5MTUsICJpOTE1X2VuZ2luZV9pbmZvIik7CisKKwlmb3IgKGludCBuID0gMDsg
biA8IEFSUkFZX1NJWkUoc3Bpbik7IG4rKykKKwkJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluW25d
KTsKK30KKworc3RhdGljIHVpbnQzMl90IHN0b3JlX3RpbWVzdGFtcChpbnQgaTkxNSwKKwkJCQl1
aW50MzJfdCBjdHgsIHVuc2lnbmVkIHJpbmcsCisJCQkJdW5zaWduZWQgbW1pb19iYXNlKQorewor
CWNvbnN0IGJvb2wgcjY0YiA9IGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA+
PSA4OworCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyIG9iaiA9IHsKKwkJLmhhbmRs
ZSA9IGdlbV9jcmVhdGUoaTkxNSwgNDA5NiksCisJCS5yZWxvY2F0aW9uX2NvdW50ID0gMSwKKwl9
OworCXN0cnVjdCBkcm1faTkxNV9nZW1fcmVsb2NhdGlvbl9lbnRyeSByZWxvYyA9IHsKKwkJLnRh
cmdldF9oYW5kbGUgPSBvYmouaGFuZGxlLAorCQkub2Zmc2V0ID0gMiAqIHNpemVvZih1aW50MzJf
dCksCisJCS5kZWx0YSA9IDQwOTIsCisJCS5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5f
SU5TVFJVQ1RJT04sCisJfTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNi
dWYgPSB7CisJCS5idWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKSwKKwkJLmJ1ZmZl
cl9jb3VudCA9IDEsCisJCS5mbGFncyA9IHJpbmcsCisJCS5yc3ZkMSA9IGN0eCwKKwl9OworCXVp
bnQzMl90IGJhdGNoW10gPSB7CisJCTB4MjQgPDwgMjMgfCAoMSArIHI2NGIpLCAvKiBTUk0gKi8K
KwkJbW1pb19iYXNlICsgMHgzNTgsCisJCTQwOTIsCisJCTAsCisJCU1JX0JBVENIX0JVRkZFUl9F
TkQKKwl9OworCisJaWd0X3JlcXVpcmUoaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2aWQoaTkx
NSkpID49IDcpOworCisJZ2VtX3dyaXRlKGk5MTUsIG9iai5oYW5kbGUsIDAsIGJhdGNoLCBzaXpl
b2YoYmF0Y2gpKTsKKwlvYmoucmVsb2NzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmcmVsb2MpOwor
CisJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCisJcmV0dXJuIG9iai5oYW5kbGU7Cit9
CisKK3N0YXRpYyB2b2lkIGluZGVwZW5kZW50KGludCBpOTE1LCB1bnNpZ25lZCByaW5nLCB1bnNp
Z25lZCBmbGFncykKK3sKKwl1aW50MzJfdCBoYW5kbGVbQVJSQVlfU0laRShwcmlvcml0aWVzKV07
CisJaWd0X3NwaW5fdCAqc3BpbltNQVhfRUxTUF9RTEVOXTsKKwl1bnNpZ25lZCBpbnQgbW1pb19i
YXNlOworCisJLyogWFhYIGk5MTVfcXVlcnkoKSEgKi8KKwlzd2l0Y2ggKHJpbmcpIHsKKwljYXNl
IEk5MTVfRVhFQ19ERUZBVUxUOgorCWNhc2UgSTkxNV9FWEVDX1JFTkRFUjoKKwkJbW1pb19iYXNl
ID0gMHgyMDAwOworCQlicmVhazsKKyNpZiAwCisJY2FzZSBJOTE1X0VYRUNfQlNEOgorCQltbWlv
X2Jhc2UgPSAweDEyMDAwOworCQlicmVhazsKKyNlbmRpZgorCWNhc2UgSTkxNV9FWEVDX0JMVDoK
KwkJbW1pb19iYXNlID0gMHgyMjAwMDsKKwkJYnJlYWs7CisKKwljYXNlIEk5MTVfRVhFQ19WRUJP
WDoKKwkJaWYgKGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA+PSAxMSkKKwkJ
CW1taW9fYmFzZSA9IDB4MWQ4MDAwOworCQllbHNlCisJCQltbWlvX2Jhc2UgPSAweDFhMDAwOwor
CQlicmVhazsKKworCWRlZmF1bHQ6CisJCWlndF9za2lwKCJtbWlvIGJhc2Ugbm90IGtub3duXG4i
KTsKKwl9CisKKwlmb3IgKGludCBuID0gMDsgbiA8IEFSUkFZX1NJWkUoc3Bpbik7IG4rKykgewor
CQljb25zdCBzdHJ1Y3QgaWd0X3NwaW5fZmFjdG9yeSBvcHRzID0geworCQkJLmN0eCA9IGNyZWF0
ZV9oaWdoZXN0X3ByaW9yaXR5KGk5MTUpLAorCQkJLmVuZ2luZSA9IHJpbmcsCisJCX07CisJCXNw
aW5bbl0gPSBfX2lndF9zcGluX2ZhY3RvcnkoaTkxNSwgJm9wdHMpOworCQlnZW1fY29udGV4dF9k
ZXN0cm95KGk5MTUsIG9wdHMuY3R4KTsKKwl9CisKKwlmb3IgKGludCBpID0gMDsgaSA8IEFSUkFZ
X1NJWkUocHJpb3JpdGllcyk7IGkrKykgeworCQl1aW50MzJfdCBjdHggPSBnZW1fcXVldWVfY3Jl
YXRlKGk5MTUpOworCQlnZW1fY29udGV4dF9zZXRfcHJpb3JpdHkoaTkxNSwgY3R4LCBwcmlvcml0
aWVzW2ldKTsKKwkJaGFuZGxlW2ldID0gc3RvcmVfdGltZXN0YW1wKGk5MTUsIGN0eCwgcmluZywg
bW1pb19iYXNlKTsKKwkJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjdHgpOworCX0KKworCWZv
ciAoaW50IG4gPSAwOyBuIDwgQVJSQVlfU0laRShzcGluKTsgbisrKQorCQlpZ3Rfc3Bpbl9mcmVl
KGk5MTUsIHNwaW5bbl0pOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHByaW9y
aXRpZXMpOyBpKyspIHsKKwkJdWludDMyX3QgKnB0cjsKKworCQlwdHIgPSBnZW1fbW1hcF9fZ3R0
KGk5MTUsIGhhbmRsZVtpXSwgNDA5NiwgUFJPVF9SRUFEKTsKKwkJZ2VtX3NldF9kb21haW4oaTkx
NSwgaGFuZGxlW2ldLCAvKiBubyB3cml0ZSBoYXphcmQgbGllcyEgKi8KKwkJCSAgICAgICBJOTE1
X0dFTV9ET01BSU5fR1RULCBJOTE1X0dFTV9ET01BSU5fR1RUKTsKKwkJZ2VtX2Nsb3NlKGk5MTUs
IGhhbmRsZVtpXSk7CisKKwkJaGFuZGxlW2ldID0gcHRyWzEwMjNdOworCQltdW5tYXAocHRyLCA0
MDk2KTsKKworCQlpZ3RfZGVidWcoImN0eFslZF0gLnByaW89JWQsIHRpbWVzdGFtcD0ldVxuIiwK
KwkJCSAgaSwgcHJpb3JpdGllc1tpXSwgaGFuZGxlW2ldKTsKKwl9CisKKwlpZ3RfYXNzZXJ0KChp
bnQzMl90KShoYW5kbGVbSEldIC0gaGFuZGxlW0xPXSkgPCAwKTsKK30KKworc3RhdGljIHZvaWQg
cmVvcmRlcihpbnQgaTkxNSwgdW5zaWduZWQgcmluZywgdW5zaWduZWQgZmxhZ3MpCisjZGVmaW5l
IEVRVUFMIDEKK3sKKwlJR1RfQ09SS19IQU5ETEUoY29yayk7CisJdWludDMyX3Qgc2NyYXRjaDsK
Kwl1aW50MzJfdCAqcHRyOworCXVpbnQzMl90IGN0eFsyXTsKKwl1aW50MzJfdCBwbHVnOworCisJ
Y3R4W0xPXSA9IGdlbV9xdWV1ZV9jcmVhdGUoaTkxNSk7CisJZ2VtX2NvbnRleHRfc2V0X3ByaW9y
aXR5KGk5MTUsIGN0eFtMT10sIE1JTl9QUklPKTsKKworCWN0eFtISV0gPSBnZW1fcXVldWVfY3Jl
YXRlKGk5MTUpOworCWdlbV9jb250ZXh0X3NldF9wcmlvcml0eShpOTE1LCBjdHhbSEldLCBmbGFn
cyAmIEVRVUFMID8gTUlOX1BSSU8gOiAwKTsKKworCXNjcmF0Y2ggPSBnZW1fY3JlYXRlKGk5MTUs
IDQwOTYpOworCXBsdWcgPSBpZ3RfY29ya19wbHVnKCZjb3JrLCBpOTE1KTsKKworCS8qIFdlIGV4
cGVjdCB0aGUgaGlnaCBwcmlvcml0eSBjb250ZXh0IHRvIGJlIGV4ZWN1dGVkIGZpcnN0LCBhbmQK
KwkgKiBzbyB0aGUgZmluYWwgcmVzdWx0IHdpbGwgYmUgdmFsdWUgZnJvbSB0aGUgbG93IHByaW9y
aXR5IGNvbnRleHQuCisJICovCisJc3RvcmVfZHdvcmQoaTkxNSwgY3R4W0xPXSwgcmluZywgc2Ny
YXRjaCwgMCwgY3R4W0xPXSwgcGx1ZywgMCk7CisJc3RvcmVfZHdvcmQoaTkxNSwgY3R4W0hJXSwg
cmluZywgc2NyYXRjaCwgMCwgY3R4W0hJXSwgcGx1ZywgMCk7CisKKwl1bnBsdWdfc2hvd19xdWV1
ZShpOTE1LCAmY29yaywgcmluZyk7CisJZ2VtX2Nsb3NlKGk5MTUsIHBsdWcpOworCisJZ2VtX2Nv
bnRleHRfZGVzdHJveShpOTE1LCBjdHhbTE9dKTsKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUs
IGN0eFtISV0pOworCisJcHRyID0gZ2VtX21tYXBfX2d0dChpOTE1LCBzY3JhdGNoLCA0MDk2LCBQ
Uk9UX1JFQUQpOworCWdlbV9zZXRfZG9tYWluKGk5MTUsIHNjcmF0Y2gsIC8qIG5vIHdyaXRlIGhh
emFyZCBsaWVzISAqLworCQkgICAgICAgSTkxNV9HRU1fRE9NQUlOX0dUVCwgSTkxNV9HRU1fRE9N
QUlOX0dUVCk7CisJZ2VtX2Nsb3NlKGk5MTUsIHNjcmF0Y2gpOworCisJaWYgKGZsYWdzICYgRVFV
QUwpIC8qIGVxdWFsIHByaW9yaXR5LCByZXN1bHQgd2lsbCBiZSBmaWZvICovCisJCWlndF9hc3Nl
cnRfZXFfdTMyKHB0clswXSwgY3R4W0hJXSk7CisJZWxzZQorCQlpZ3RfYXNzZXJ0X2VxX3UzMihw
dHJbMF0sIGN0eFtMT10pOworCW11bm1hcChwdHIsIDQwOTYpOworfQorCitzdGF0aWMgdm9pZCBw
cm9tb3Rpb24oaW50IGk5MTUsIHVuc2lnbmVkIHJpbmcpCit7CisJSUdUX0NPUktfSEFORExFKGNv
cmspOworCXVpbnQzMl90IHJlc3VsdCwgZGVwOworCXVpbnQzMl90ICpwdHI7CisJdWludDMyX3Qg
Y3R4WzNdOworCXVpbnQzMl90IHBsdWc7CisKKwljdHhbTE9dID0gZ2VtX3F1ZXVlX2NyZWF0ZShp
OTE1KTsKKwlnZW1fY29udGV4dF9zZXRfcHJpb3JpdHkoaTkxNSwgY3R4W0xPXSwgTUlOX1BSSU8p
OworCisJY3R4W0hJXSA9IGdlbV9xdWV1ZV9jcmVhdGUoaTkxNSk7CisJZ2VtX2NvbnRleHRfc2V0
X3ByaW9yaXR5KGk5MTUsIGN0eFtISV0sIDApOworCisJY3R4W05PSVNFXSA9IGdlbV9xdWV1ZV9j
cmVhdGUoaTkxNSk7CisJZ2VtX2NvbnRleHRfc2V0X3ByaW9yaXR5KGk5MTUsIGN0eFtOT0lTRV0s
IE1JTl9QUklPLzIpOworCisJcmVzdWx0ID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KTsKKwlkZXAg
PSBnZW1fY3JlYXRlKGk5MTUsIDQwOTYpOworCisJcGx1ZyA9IGlndF9jb3JrX3BsdWcoJmNvcmss
IGk5MTUpOworCisJLyogRXhwZWN0IHRoYXQgSEkgcHJvbW90ZXMgTE8sIHNvIHRoZSBvcmRlciB3
aWxsIGJlIExPLCBISSwgTk9JU0UuCisJICoKKwkgKiBmaWZvIHdvdWxkIGJlIE5PSVNFLCBMTywg
SEkuCisJICogc3RyaWN0IHByaW9yaXR5IHdvdWxkIGJlICBISSwgTk9JU0UsIExPCisJICovCisJ
c3RvcmVfZHdvcmQoaTkxNSwgY3R4W05PSVNFXSwgcmluZywgcmVzdWx0LCAwLCBjdHhbTk9JU0Vd
LCBwbHVnLCAwKTsKKwlzdG9yZV9kd29yZChpOTE1LCBjdHhbTE9dLCByaW5nLCByZXN1bHQsIDAs
IGN0eFtMT10sIHBsdWcsIDApOworCisJLyogbGluayBMTyA8LT4gSEkgdmlhIGEgZGVwZW5kZW5j
eSBvbiBhbm90aGVyIGJ1ZmZlciAqLworCXN0b3JlX2R3b3JkKGk5MTUsIGN0eFtMT10sIHJpbmcs
IGRlcCwgMCwgY3R4W0xPXSwgMCwgSTkxNV9HRU1fRE9NQUlOX0lOU1RSVUNUSU9OKTsKKwlzdG9y
ZV9kd29yZChpOTE1LCBjdHhbSEldLCByaW5nLCBkZXAsIDAsIGN0eFtISV0sIDAsIDApOworCisJ
c3RvcmVfZHdvcmQoaTkxNSwgY3R4W0hJXSwgcmluZywgcmVzdWx0LCAwLCBjdHhbSEldLCAwLCAw
KTsKKworCXVucGx1Z19zaG93X3F1ZXVlKGk5MTUsICZjb3JrLCByaW5nKTsKKwlnZW1fY2xvc2Uo
aTkxNSwgcGx1Zyk7CisKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eFtOT0lTRV0pOwor
CWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4W0xPXSk7CisJZ2VtX2NvbnRleHRfZGVzdHJv
eShpOTE1LCBjdHhbSEldKTsKKworCXB0ciA9IGdlbV9tbWFwX19ndHQoaTkxNSwgZGVwLCA0MDk2
LCBQUk9UX1JFQUQpOworCWdlbV9zZXRfZG9tYWluKGk5MTUsIGRlcCwgLyogbm8gd3JpdGUgaGF6
YXJkIGxpZXMhICovCisJCQlJOTE1X0dFTV9ET01BSU5fR1RULCBJOTE1X0dFTV9ET01BSU5fR1RU
KTsKKwlnZW1fY2xvc2UoaTkxNSwgZGVwKTsKKworCWlndF9hc3NlcnRfZXFfdTMyKHB0clswXSwg
Y3R4W0hJXSk7CisJbXVubWFwKHB0ciwgNDA5Nik7CisKKwlwdHIgPSBnZW1fbW1hcF9fZ3R0KGk5
MTUsIHJlc3VsdCwgNDA5NiwgUFJPVF9SRUFEKTsKKwlnZW1fc2V0X2RvbWFpbihpOTE1LCByZXN1
bHQsIC8qIG5vIHdyaXRlIGhhemFyZCBsaWVzISAqLworCQkJSTkxNV9HRU1fRE9NQUlOX0dUVCwg
STkxNV9HRU1fRE9NQUlOX0dUVCk7CisJZ2VtX2Nsb3NlKGk5MTUsIHJlc3VsdCk7CisKKwlpZ3Rf
YXNzZXJ0X2VxX3UzMihwdHJbMF0sIGN0eFtOT0lTRV0pOworCW11bm1hcChwdHIsIDQwOTYpOwor
fQorCitzdGF0aWMgdm9pZCBzbW9rZXRlc3QoaW50IGk5MTUsIHVuc2lnbmVkIHJpbmcsIHVuc2ln
bmVkIHRpbWVvdXQpCit7CisJY29uc3QgaW50IG5jcHVzID0gc3lzY29uZihfU0NfTlBST0NFU1NP
UlNfT05MTik7CisJdW5zaWduZWQgZW5naW5lc1sxNl07CisJdW5zaWduZWQgbmVuZ2luZTsKKwl1
bnNpZ25lZCBlbmdpbmU7CisJdWludDMyX3Qgc2NyYXRjaDsKKwl1aW50MzJfdCAqcHRyOworCisJ
bmVuZ2luZSA9IDA7CisJZm9yX2VhY2hfZW5naW5lKGk5MTUsIGVuZ2luZSkgeworCQlpZiAoaWdu
b3JlX2VuZ2luZShlbmdpbmUpKQorCQkJY29udGludWU7CisKKwkJZW5naW5lc1tuZW5naW5lKytd
ID0gZW5naW5lOworCX0KKwlpZ3RfcmVxdWlyZShuZW5naW5lKTsKKworCXNjcmF0Y2ggPSBnZW1f
Y3JlYXRlKGk5MTUsIDQwOTYpOworCWlndF9mb3JrKGNoaWxkLCBuY3B1cykgeworCQl1bnNpZ25l
ZCBsb25nIGNvdW50ID0gMDsKKwkJdWludDMyX3QgY3R4OworCisJCWhhcnNfcGV0cnVza2FfZjU0
XzFfcmFuZG9tX3BlcnR1cmIoY2hpbGQpOworCisJCWN0eCA9IGdlbV9xdWV1ZV9jcmVhdGUoaTkx
NSk7CisJCWlndF91bnRpbF90aW1lb3V0KHRpbWVvdXQpIHsKKwkJCWludCBwcmlvOworCisJCQlw
cmlvID0gaGFyc19wZXRydXNrYV9mNTRfMV9yYW5kb21fdW5zYWZlX21heChNQVhfUFJJTyAtIE1J
Tl9QUklPKSArIE1JTl9QUklPOworCQkJZ2VtX2NvbnRleHRfc2V0X3ByaW9yaXR5KGk5MTUsIGN0
eCwgcHJpbyk7CisKKwkJCWVuZ2luZSA9IGVuZ2luZXNbaGFyc19wZXRydXNrYV9mNTRfMV9yYW5k
b21fdW5zYWZlX21heChuZW5naW5lKV07CisJCQlzdG9yZV9kd29yZChpOTE1LCBjdHgsIGVuZ2lu
ZSwgc2NyYXRjaCwKKwkJCQkgICAgOCpjaGlsZCArIDAsIH5jaGlsZCwKKwkJCQkgICAgMCwgMCk7
CisJCQlmb3IgKHVuc2lnbmVkIGludCBzdGVwID0gMDsgc3RlcCA8IDg7IHN0ZXArKykKKwkJCQlz
dG9yZV9kd29yZChpOTE1LCBjdHgsIGVuZ2luZSwgc2NyYXRjaCwKKwkJCQkJICAgIDgqY2hpbGQg
KyA0LCBjb3VudCsrLAorCQkJCQkgICAgMCwgMCk7CisJCX0KKwkJZ2VtX2NvbnRleHRfZGVzdHJv
eShpOTE1LCBjdHgpOworCX0KKwlpZ3Rfd2FpdGNoaWxkcmVuKCk7CisKKwlwdHIgPSBnZW1fbW1h
cF9fZ3R0KGk5MTUsIHNjcmF0Y2gsIDQwOTYsIFBST1RfUkVBRCk7CisJZ2VtX3NldF9kb21haW4o
aTkxNSwgc2NyYXRjaCwgLyogbm8gd3JpdGUgaGF6YXJkIGxpZXMhICovCisJCQlJOTE1X0dFTV9E
T01BSU5fR1RULCBJOTE1X0dFTV9ET01BSU5fR1RUKTsKKwlnZW1fY2xvc2UoaTkxNSwgc2NyYXRj
aCk7CisKKwlmb3IgKHVuc2lnbmVkIG4gPSAwOyBuIDwgbmNwdXM7IG4rKykgeworCQlpZ3RfYXNz
ZXJ0X2VxX3UzMihwdHJbMipuXSwgfm4pOworCQkvKgorCQkgKiBOb3RlIHRoaXMgY291bnQgaXMg
YXBwcm94aW1hdGUgZHVlIHRvIHVuY29uc3RyYWluZWQKKwkJICogb3JkZXJpbmcgb2YgdGhlIGR3
b3JkIHdyaXRlcyBiZXR3ZWVuIGVuZ2luZXMuCisJCSAqCisJCSAqIFRha2UgdGhlIHJlc3VsdCB3
aXRoIGEgcGluY2ggb2Ygc2FsdC4KKwkJICovCisJCWlndF9pbmZvKCJDaGlsZFslZF0gY29tcGxl
dGVkICV1IGN5Y2xlc1xuIiwgIG4sIHB0clsyKm4rMV0pOworCX0KKwltdW5tYXAocHRyLCA0MDk2
KTsKK30KKworaWd0X21haW4KK3sKKwljb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2lu
ZSAqZTsKKwlpbnQgaTkxNSA9IC0xOworCisJaWd0X2ZpeHR1cmUgeworCQlpOTE1ID0gZHJtX29w
ZW5fZHJpdmVyKERSSVZFUl9JTlRFTCk7CisJCWlndF9yZXF1aXJlX2dlbShpOTE1KTsKKwl9CisK
KwlpZ3Rfc3VidGVzdF9ncm91cCB7CisJCWlndF9maXh0dXJlIHsKKwkJCWlndF9yZXF1aXJlKGdl
bV9jb250ZXh0c19oYXNfc2hhcmVkX2d0dChpOTE1KSk7CisJCQlpZ3RfZm9ya19oYW5nX2RldGVj
dG9yKGk5MTUpOworCQl9CisKKwkJaWd0X3N1YnRlc3QoImNyZWF0ZS1zaGFyZWQtZ3R0IikKKwkJ
CWNyZWF0ZV9zaGFyZWRfZ3R0KGk5MTUsIDApOworCisJCWlndF9zdWJ0ZXN0KCJkZXRhY2hlZC1z
aGFyZWQtZ3R0IikKKwkJCWNyZWF0ZV9zaGFyZWRfZ3R0KGk5MTUsIERFVEFDSEVEKTsKKworCQlp
Z3Rfc3VidGVzdCgiZGlzam9pbnQtdGltZWxpbmVzIikKKwkJCWRpc2pvaW50X3RpbWVsaW5lcyhp
OTE1KTsKKworCQlpZ3Rfc3VidGVzdCgic2luZ2xlLXRpbWVsaW5lIikKKwkJCXNpbmdsZV90aW1l
bGluZShpOTE1KTsKKworCQlpZ3Rfc3VidGVzdCgiZXhoYXVzdC1zaGFyZWQtZ3R0IikKKwkJCWV4
aGF1c3Rfc2hhcmVkX2d0dChpOTE1LCAwKTsKKworCQlpZ3Rfc3VidGVzdCgiZXhoYXVzdC1zaGFy
ZWQtZ3R0LWxyYyIpCisJCQlleGhhdXN0X3NoYXJlZF9ndHQoaTkxNSwgRVhIQVVTVF9MUkMpOwor
CisJCWZvciAoZSA9IGludGVsX2V4ZWN1dGlvbl9lbmdpbmVzOyBlLT5uYW1lOyBlKyspIHsKKwkJ
CWlndF9zdWJ0ZXN0X2YoImV4ZWMtc2hhcmVkLWd0dC0lcyIsIGUtPm5hbWUpCisJCQkJZXhlY19z
aGFyZWRfZ3R0KGk5MTUsIGUtPmV4ZWNfaWQgfCBlLT5mbGFncyk7CisKKwkJCWlmICghaWdub3Jl
X2VuZ2luZShlLT5leGVjX2lkIHwgZS0+ZmxhZ3MpKSB7CisJCQkJaWd0X3N1YnRlc3RfZigiZXhl
Yy1zaW5nbGUtdGltZWxpbmUtJXMiLAorCQkJCQkgICAgICBlLT5uYW1lKQorCQkJCQlleGVjX3Np
bmdsZV90aW1lbGluZShpOTE1LAorCQkJCQkJCSAgICAgZS0+ZXhlY19pZCB8IGUtPmZsYWdzKTsK
KwkJCX0KKworCQkJLyoKKwkJCSAqIENoZWNrIHRoYXQgdGhlIHNoYXJlZCBjb250ZXh0cyBvcGVy
YXRlIGluZGVwZW5kZW50bHksCisJCQkgKiB0aGF0IGlzIHJlcXVlc3RzIG9uIG9uZSAoInF1ZXVl
IikgY2FuIGJlIHNjaGVkdWxlZAorCQkJICogYXJvdW5kIGFub3RoZXIgcXVldWUuIFdlIG9ubHkg
Y2hlY2sgdGhlIGJhc2ljcyBoZXJlLAorCQkJICogZW5vdWdoIHRvIHJlZHVjZSB0aGUgcXVldWUg
aW50byBqdXN0IGFub3RoZXIgY29udGV4dCwKKwkJCSAqIGFuZCBzbyByZWx5IG9uIGdlbV9leGVj
X3NjaGVkdWxlIHRvIHByb3ZlIHRoZSByZXN0LgorCQkJICovCisJCQlpZ3Rfc3VidGVzdF9ncm91
cCB7CisJCQkJaWd0X2ZpeHR1cmUgeworCQkJCQlnZW1fcmVxdWlyZV9yaW5nKGk5MTUsIGUtPmV4
ZWNfaWQgfCBlLT5mbGFncyk7CisJCQkJCWlndF9yZXF1aXJlKGdlbV9jYW5fc3RvcmVfZHdvcmQo
aTkxNSwgZS0+ZXhlY19pZCkgfCBlLT5mbGFncyk7CisJCQkJCWlndF9yZXF1aXJlKGdlbV9zY2hl
ZHVsZXJfZW5hYmxlZChpOTE1KSk7CisJCQkJCWlndF9yZXF1aXJlKGdlbV9zY2hlZHVsZXJfaGFz
X2N0eF9wcmlvcml0eShpOTE1KSk7CisJCQkJfQorCisJCQkJaWd0X3N1YnRlc3RfZigiUS1pbmRl
cGVuZGVudC0lcyIsIGUtPm5hbWUpCisJCQkJCWluZGVwZW5kZW50KGk5MTUsIGUtPmV4ZWNfaWQg
fCBlLT5mbGFncywgMCk7CisKKwkJCQlpZ3Rfc3VidGVzdF9mKCJRLWluLW9yZGVyLSVzIiwgZS0+
bmFtZSkKKwkJCQkJcmVvcmRlcihpOTE1LCBlLT5leGVjX2lkIHwgZS0+ZmxhZ3MsIEVRVUFMKTsK
KworCQkJCWlndF9zdWJ0ZXN0X2YoIlEtb3V0LW9yZGVyLSVzIiwgZS0+bmFtZSkKKwkJCQkJcmVv
cmRlcihpOTE1LCBlLT5leGVjX2lkIHwgZS0+ZmxhZ3MsIDApOworCisJCQkJaWd0X3N1YnRlc3Rf
ZigiUS1wcm9tb3Rpb24tJXMiLCBlLT5uYW1lKQorCQkJCQlwcm9tb3Rpb24oaTkxNSwgZS0+ZXhl
Y19pZCB8IGUtPmZsYWdzKTsKKworCQkJCWlndF9zdWJ0ZXN0X2YoIlEtc21va2V0ZXN0LSVzIiwg
ZS0+bmFtZSkKKwkJCQkJc21va2V0ZXN0KGk5MTUsIGUtPmV4ZWNfaWQgfCBlLT5mbGFncywgNSk7
CisJCQl9CisJCX0KKworCQlpZ3Rfc3VidGVzdCgiUS1zbW9rZXRlc3QtYWxsIikgeworCQkJaWd0
X3JlcXVpcmUoZ2VtX3NjaGVkdWxlcl9lbmFibGVkKGk5MTUpKTsKKwkJCWlndF9yZXF1aXJlKGdl
bV9zY2hlZHVsZXJfaGFzX2N0eF9wcmlvcml0eShpOTE1KSk7CisJCQlzbW9rZXRlc3QoaTkxNSwg
LTEsIDMwKTsKKwkJfQorCisJCWlndF9maXh0dXJlIHsKKwkJCWlndF9zdG9wX2hhbmdfZGV0ZWN0
b3IoKTsKKwkJfQorCX0KK30KZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfd2hpc3Bl
ci5jIGIvdGVzdHMvaTkxNS9nZW1fZXhlY193aGlzcGVyLmMKaW5kZXggNmMzYjUzNzU2Li5kM2Uw
YjBiYTIgMTAwNjQ0Ci0tLSBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfd2hpc3Blci5jCisrKyBiL3Rl
c3RzL2k5MTUvZ2VtX2V4ZWNfd2hpc3Blci5jCkBAIC04Nyw2ICs4Nyw3IEBAIHN0YXRpYyB2b2lk
IHZlcmlmeV9yZWxvYyhpbnQgZmQsIHVpbnQzMl90IGhhbmRsZSwKICNkZWZpbmUgSEFORyAweDIw
CiAjZGVmaW5lIFNZTkMgMHg0MAogI2RlZmluZSBQUklPUklUWSAweDgwCisjZGVmaW5lIFFVRVVF
UyAweDEwMAogCiBzdHJ1Y3QgaGFuZyB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVj
dDIgb2JqOwpAQCAtMTcxLDcgKzE3Miw3IEBAIHN0YXRpYyB2b2lkIGN0eF9zZXRfcmFuZG9tX3By
aW9yaXR5KGludCBmZCwgdWludDMyX3QgY3R4KQogewogCWludCBwcmlvID0gaGFyc19wZXRydXNr
YV9mNTRfMV9yYW5kb21fdW5zYWZlX21heCgxMDI0KSAtIDUxMjsKIAlnZW1fY29udGV4dF9zZXRf
cHJpb3JpdHkoZmQsIGN0eCwgcHJpbyk7Ci19OworfQogCiBzdGF0aWMgdm9pZCB3aGlzcGVyKGlu
dCBmZCwgdW5zaWduZWQgZW5naW5lLCB1bnNpZ25lZCBmbGFncykKIHsKQEAgLTIyNiw2ICsyMjcs
OSBAQCBzdGF0aWMgdm9pZCB3aGlzcGVyKGludCBmZCwgdW5zaWduZWQgZW5naW5lLCB1bnNpZ25l
ZCBmbGFncykKIAlpZiAoZmxhZ3MgJiBDT05URVhUUykKIAkJZ2VtX3JlcXVpcmVfY29udGV4dHMo
ZmQpOwogCisJaWYgKGZsYWdzICYgUVVFVUVTKQorCQlpZ3RfcmVxdWlyZShnZW1faGFzX3F1ZXVl
cyhmZCkpOworCiAJaWYgKGZsYWdzICYgSEFORykKIAkJaW5pdF9oYW5nKCZoYW5nKTsKIApAQCAt
MjkwLDYgKzI5NCwxMCBAQCBzdGF0aWMgdm9pZCB3aGlzcGVyKGludCBmZCwgdW5zaWduZWQgZW5n
aW5lLCB1bnNpZ25lZCBmbGFncykKIAkJCWZvciAobiA9IDA7IG4gPCA2NDsgbisrKQogCQkJCWNv
bnRleHRzW25dID0gZ2VtX2NvbnRleHRfY3JlYXRlKGZkKTsKIAkJfQorCQlpZiAoZmxhZ3MgJiBR
VUVVRVMpIHsKKwkJCWZvciAobiA9IDA7IG4gPCA2NDsgbisrKQorCQkJCWNvbnRleHRzW25dID0g
Z2VtX3F1ZXVlX2NyZWF0ZShmZCk7CisJCX0KIAkJaWYgKGZsYWdzICYgRkRTKSB7CiAJCQlmb3Ig
KG4gPSAwOyBuIDwgNjQ7IG4rKykKIAkJCQlmZHNbbl0gPSBkcm1fb3Blbl9kcml2ZXIoRFJJVkVS
X0lOVEVMKTsKQEAgLTQwMyw3ICs0MTEsNyBAQCBzdGF0aWMgdm9pZCB3aGlzcGVyKGludCBmZCwg
dW5zaWduZWQgZW5naW5lLCB1bnNpZ25lZCBmbGFncykKIAkJCQkJCWV4ZWNidWYuZmxhZ3MgJj0g
fkVOR0lORV9NQVNLOwogCQkJCQkJZXhlY2J1Zi5mbGFncyB8PSBlbmdpbmVzW3JhbmQoKSAlIG5l
bmdpbmVdOwogCQkJCQl9Ci0JCQkJCWlmIChmbGFncyAmIENPTlRFWFRTKSB7CisJCQkJCWlmIChm
bGFncyAmIChDT05URVhUUyB8IFFVRVVFUykpIHsKIAkJCQkJCWV4ZWNidWYucnN2ZDEgPSBjb250
ZXh0c1tyYW5kKCkgJSA2NF07CiAJCQkJCQlpZiAoZmxhZ3MgJiBQUklPUklUWSkKIAkJCQkJCQlj
dHhfc2V0X3JhbmRvbV9wcmlvcml0eSh0aGlzX2ZkLCBleGVjYnVmLnJzdmQxKTsKQEAgLTQ4Niw3
ICs0OTQsNyBAQCBzdGF0aWMgdm9pZCB3aGlzcGVyKGludCBmZCwgdW5zaWduZWQgZW5naW5lLCB1
bnNpZ25lZCBmbGFncykKIAkJCWZvciAobiA9IDA7IG4gPCA2NDsgbisrKQogCQkJCWNsb3NlKGZk
c1tuXSk7CiAJCX0KLQkJaWYgKGZsYWdzICYgQ09OVEVYVFMpIHsKKwkJaWYgKGZsYWdzICYgKENP
TlRFWFRTIHwgUVVFVUVTKSkgewogCQkJZm9yIChuID0gMDsgbiA8IDY0OyBuKyspCiAJCQkJZ2Vt
X2NvbnRleHRfZGVzdHJveShmZCwgY29udGV4dHNbbl0pOwogCQl9CkBAIC01MjIsMTggKzUzMCwy
NCBAQCBpZ3RfbWFpbgogCQl7ICJjaGFpbi1mb3JrZWQiLCBDSEFJTiB8IEZPUktFRCB9LAogCQl7
ICJjaGFpbi1pbnRlcnJ1cHRpYmxlIiwgQ0hBSU4gfCBJTlRFUlJVUFRJQkxFIH0sCiAJCXsgImNo
YWluLXN5bmMiLCBDSEFJTiB8IFNZTkMgfSwKLQkJeyAiY29udGV4dHMiLCBDT05URVhUUyB9LAot
CQl7ICJjb250ZXh0cy1pbnRlcnJ1cHRpYmxlIiwgQ09OVEVYVFMgfCBJTlRFUlJVUFRJQkxFfSwK
LQkJeyAiY29udGV4dHMtZm9ya2VkIiwgQ09OVEVYVFMgfCBGT1JLRUR9LAotCQl7ICJjb250ZXh0
cy1wcmlvcml0eSIsIENPTlRFWFRTIHwgRk9SS0VEIHwgUFJJT1JJVFkgfSwKLQkJeyAiY29udGV4
dHMtY2hhaW4iLCBDT05URVhUUyB8IENIQUlOIH0sCi0JCXsgImNvbnRleHRzLXN5bmMiLCBDT05U
RVhUUyB8IFNZTkMgfSwKIAkJeyAiZmRzIiwgRkRTIH0sCiAJCXsgImZkcy1pbnRlcnJ1cHRpYmxl
IiwgRkRTIHwgSU5URVJSVVBUSUJMRX0sCiAJCXsgImZkcy1mb3JrZWQiLCBGRFMgfCBGT1JLRUR9
LAogCQl7ICJmZHMtcHJpb3JpdHkiLCBGRFMgfCBGT1JLRUQgfCBQUklPUklUWSB9LAogCQl7ICJm
ZHMtY2hhaW4iLCBGRFMgfCBDSEFJTn0sCiAJCXsgImZkcy1zeW5jIiwgRkRTIHwgU1lOQ30sCisJ
CXsgImNvbnRleHRzIiwgQ09OVEVYVFMgfSwKKwkJeyAiY29udGV4dHMtaW50ZXJydXB0aWJsZSIs
IENPTlRFWFRTIHwgSU5URVJSVVBUSUJMRX0sCisJCXsgImNvbnRleHRzLWZvcmtlZCIsIENPTlRF
WFRTIHwgRk9SS0VEfSwKKwkJeyAiY29udGV4dHMtcHJpb3JpdHkiLCBDT05URVhUUyB8IEZPUktF
RCB8IFBSSU9SSVRZIH0sCisJCXsgImNvbnRleHRzLWNoYWluIiwgQ09OVEVYVFMgfCBDSEFJTiB9
LAorCQl7ICJjb250ZXh0cy1zeW5jIiwgQ09OVEVYVFMgfCBTWU5DIH0sCisJCXsgInF1ZXVlcyIs
IFFVRVVFUyB9LAorCQl7ICJxdWV1ZXMtaW50ZXJydXB0aWJsZSIsIFFVRVVFUyB8IElOVEVSUlVQ
VElCTEV9LAorCQl7ICJxdWV1ZXMtZm9ya2VkIiwgUVVFVUVTIHwgRk9SS0VEfSwKKwkJeyAicXVl
dWVzLXByaW9yaXR5IiwgUVVFVUVTIHwgRk9SS0VEIHwgUFJJT1JJVFkgfSwKKwkJeyAicXVldWVz
LWNoYWluIiwgUVVFVUVTIHwgQ0hBSU4gfSwKKwkJeyAicXVldWVzLXN5bmMiLCBRVUVVRVMgfCBT
WU5DIH0sCiAJCXsgTlVMTCB9CiAJfTsKIAlpbnQgZmQ7CmRpZmYgLS1naXQgYS90ZXN0cy9tZXNv
bi5idWlsZCBiL3Rlc3RzL21lc29uLmJ1aWxkCmluZGV4IDM4MTBiZDc2MC4uMzg4M2FlMTI3IDEw
MDY0NAotLS0gYS90ZXN0cy9tZXNvbi5idWlsZAorKysgYi90ZXN0cy9tZXNvbi5idWlsZApAQCAt
MTE0LDYgKzExNCw3IEBAIGk5MTVfcHJvZ3MgPSBbCiAJJ2dlbV9jdHhfZXhlYycsCiAJJ2dlbV9j
dHhfaXNvbGF0aW9uJywKIAknZ2VtX2N0eF9wYXJhbScsCisJJ2dlbV9jdHhfc2hhcmVkJywKIAkn
Z2VtX2N0eF9zd2l0Y2gnLAogCSdnZW1fY3R4X3RocmFzaCcsCiAJJ2dlbV9kb3VibGVfaXJxX2xv
b3AnLAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZng=

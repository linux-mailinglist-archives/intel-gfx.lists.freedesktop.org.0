Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7B85089203
	for <lists+intel-gfx@lfdr.de>; Sun, 11 Aug 2019 16:28:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4CA536E343;
	Sun, 11 Aug 2019 14:28:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6511C6E342
 for <intel-gfx@lists.freedesktop.org>; Sun, 11 Aug 2019 14:28:15 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17960560-1500050 
 for multiple; Sun, 11 Aug 2019 15:28:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 11 Aug 2019 15:28:00 +0100
Message-Id: <20190811142801.2460-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915: Extract GT powermanagement
 interrupt handling
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogQW5kaSBTaHl0aSA8YW5kaS5zaHl0aUBpbnRlbC5jb20+CgppOTE1X2lycS5jIGlzIGxh
cmdlLiBJdCBzZXJ2ZXMgYXMgdGhlIGNlbnRyYWwgZGlzcGF0Y2ggYW5kIGhhbmRsZXIgZm9yCmFs
bCBvZiBvdXIgZGV2aWNlIGludGVycnVwdHMuIFB1bGwgb3V0IHRoZSBHVCBwbSBpbnRlcnJ1cHQg
aGFuZGxpbmcKKGxlYXZpbmcgdGhlIGNlbnRyYWwgZGlzcGF0Y2gpIHNvIHRoYXQgd2UgY2FuIGVu
Y2Fwc3VsYXRlIHRoZSBsb2dpYyBhCmxpdHRsZSBiZXR0ZXIuCgpCYXNlZCBvbiBhIHBhdGNoIGJ5
IENocmlzIFdpbHNvbi4KClNpZ25lZC1vZmYtYnk6IEFuZGkgU2h5dGkgPGFuZGkuc2h5dGlAaW50
ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgICB8
ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jICAgICAgICAgfCAgIDQg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtX2lycS5jICB8IDEwOCArKysr
KysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbV9pcnEuaCAgfCAgMjIg
KysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oICAgfCAgIDMgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyB8ICAgNSArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyAgICAgICAgICAgIHwgMjIwICsrKysrLS0tLS0t
LS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuaCAgICAgICAgICAgIHwg
ICAyIC0KIDggZmlsZXMgY2hhbmdlZCwgMTkxIGluc2VydGlvbnMoKyksIDE3NCBkZWxldGlvbnMo
LSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9w
bV9pcnEuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3BtX2lycS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCAzOTYyZDk3MjhkZDcuLmQyMjY2
NTlmZGJiMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTgwLDYgKzgwLDcgQEAgZ3QteSArPSBc
CiAJZ3QvaW50ZWxfZW5naW5lX3VzZXIubyBcCiAJZ3QvaW50ZWxfZ3QubyBcCiAJZ3QvaW50ZWxf
Z3RfcG0ubyBcCisJZ3QvaW50ZWxfZ3RfcG1faXJxLm8gXAogCWd0L2ludGVsX2hhbmdjaGVjay5v
IFwKIAlndC9pbnRlbF9scmMubyBcCiAJZ3QvaW50ZWxfcmVuZGVyc3RhdGUubyBcCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBjNTQzNDY3YThhMWMuLjkxNGJkMmRiM2JjNyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBAIC0xMyw5ICsxMywxMSBAQCB2b2lkIGludGVs
X2d0X2luaXRfZWFybHkoc3RydWN0IGludGVsX2d0ICpndCwgc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiAJZ3QtPmk5MTUgPSBpOTE1OwogCWd0LT51bmNvcmUgPSAmaTkxNS0+dW5jb3Jl
OwogCisJc3Bpbl9sb2NrX2luaXQoJmd0LT5pcnFfbG9jayk7CisKIAlJTklUX0xJU1RfSEVBRCgm
Z3QtPmFjdGl2ZV9yaW5ncyk7Ci0JSU5JVF9MSVNUX0hFQUQoJmd0LT5jbG9zZWRfdm1hKTsKIAor
CUlOSVRfTElTVF9IRUFEKCZndC0+Y2xvc2VkX3ZtYSk7CiAJc3Bpbl9sb2NrX2luaXQoJmd0LT5j
bG9zZWRfbG9jayk7CiAKIAlpbnRlbF9ndF9pbml0X2hhbmdjaGVjayhndCk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbV9pcnEuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtX2lycS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uODNlMTFjMmNjNWFiCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG1faXJxLmMKQEAgLTAsMCArMSwxMDggQEAKKy8qCisg
KiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkg
SW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRl
ICJpOTE1X3JlZy5oIgorI2luY2x1ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3Rf
cG1faXJxLmgiCisKK3N0YXRpYyB2b2lkIHdyaXRlX3BtX2ltcihzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5MTU7CisJc3RydWN0
IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKKwl1MzIgbWFzayA9IGd0LT5wbV9p
bXI7CisJaTkxNV9yZWdfdCByZWc7CisKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKSB7CisJ
CXJlZyA9IEdFTjExX0dQTV9XR0JPWFBFUkZfSU5UUl9NQVNLOworCQltYXNrIDw8PSAxNjsgLyog
cG0gaXMgaW4gdXBwZXIgaGFsZiAqLworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDgp
IHsKKwkJcmVnID0gR0VOOF9HVF9JTVIoMik7CisJfSBlbHNlIHsKKwkJcmVnID0gR0VONl9QTUlN
UjsKKwl9CisKKwlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCByZWcsIG1hc2spOworfQorCitz
dGF0aWMgdm9pZCBnZW42X2d0X3BtX3VwZGF0ZV9pcnEoc3RydWN0IGludGVsX2d0ICpndCwKKwkJ
CQkgIHUzMiBpbnRlcnJ1cHRfbWFzaywKKwkJCQkgIHUzMiBlbmFibGVkX2lycV9tYXNrKQorewor
CXUzMiBuZXdfdmFsOworCisJV0FSTl9PTihlbmFibGVkX2lycV9tYXNrICYgfmludGVycnVwdF9t
YXNrKTsKKworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmd0LT5pcnFfbG9jayk7CisKKwluZXdfdmFs
ID0gZ3QtPnBtX2ltcjsKKwluZXdfdmFsICY9IH5pbnRlcnJ1cHRfbWFzazsKKwluZXdfdmFsIHw9
IH5lbmFibGVkX2lycV9tYXNrICYgaW50ZXJydXB0X21hc2s7CisKKwlpZiAobmV3X3ZhbCAhPSBn
dC0+cG1faW1yKSB7CisJCWd0LT5wbV9pbXIgPSBuZXdfdmFsOworCQl3cml0ZV9wbV9pbXIoZ3Qp
OworCX0KK30KKwordm9pZCBnZW42X2d0X3BtX3VubWFza19pcnEoc3RydWN0IGludGVsX2d0ICpn
dCwgdTMyIG1hc2spCit7CisJZ2VuNl9ndF9wbV91cGRhdGVfaXJxKGd0LCBtYXNrLCBtYXNrKTsK
K30KKwordm9pZCBnZW42X2d0X3BtX21hc2tfaXJxKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHUzMiBt
YXNrKQoreworCWdlbjZfZ3RfcG1fdXBkYXRlX2lycShndCwgbWFzaywgMCk7Cit9CisKK3ZvaWQg
Z2VuNl9ndF9wbV9yZXNldF9paXIoc3RydWN0IGludGVsX2d0ICpndCwgdTMyIHJlc2V0X21hc2sp
Cit7CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKKwlpOTE1X3Jl
Z190IHJlZyA9IElOVEVMX0dFTihndC0+aTkxNSkgPj0gOCA/IEdFTjhfR1RfSUlSKDIpIDogR0VO
Nl9QTUlJUjsKKworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmd0LT5pcnFfbG9jayk7CisKKwlpbnRl
bF91bmNvcmVfd3JpdGUodW5jb3JlLCByZWcsIHJlc2V0X21hc2spOworCWludGVsX3VuY29yZV93
cml0ZSh1bmNvcmUsIHJlZywgcmVzZXRfbWFzayk7CisJaW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVh
ZCh1bmNvcmUsIHJlZyk7Cit9CisKK3N0YXRpYyB2b2lkIHdyaXRlX3BtX2llcihzdHJ1Y3QgaW50
ZWxfZ3QgKmd0KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5MTU7
CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKKwl1MzIgbWFzayA9
IGd0LT5wbV9pZXI7CisJaTkxNV9yZWdfdCByZWc7CisKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49
IDExKSB7CisJCXJlZyA9IEdFTjExX0dQTV9XR0JPWFBFUkZfSU5UUl9FTkFCTEU7CisJCW1hc2sg
PDw9IDE2OyAvKiBwbSBpcyBpbiB1cHBlciBoYWxmICovCisJfSBlbHNlIGlmIChJTlRFTF9HRU4o
aTkxNSkgPj0gOCkgeworCQlyZWcgPSBHRU44X0dUX0lFUigyKTsKKwl9IGVsc2UgeworCQlyZWcg
PSBHRU42X1BNSUVSOworCX0KKworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIHJlZywgbWFz
ayk7Cit9CisKK3ZvaWQgZ2VuNl9ndF9wbV9lbmFibGVfaXJxKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
IHUzMiBlbmFibGVfbWFzaykKK3sKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZndC0+aXJxX2xvY2sp
OworCisJZ3QtPnBtX2llciB8PSBlbmFibGVfbWFzazsKKwl3cml0ZV9wbV9pZXIoZ3QpOworCWdl
bjZfZ3RfcG1fdW5tYXNrX2lycShndCwgZW5hYmxlX21hc2spOworfQorCit2b2lkIGdlbjZfZ3Rf
cG1fZGlzYWJsZV9pcnEoc3RydWN0IGludGVsX2d0ICpndCwgdTMyIGRpc2FibGVfbWFzaykKK3sK
Kwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZndC0+aXJxX2xvY2spOworCisJZ3QtPnBtX2llciAmPSB+
ZGlzYWJsZV9tYXNrOworCWdlbjZfZ3RfcG1fbWFza19pcnEoZ3QsIGRpc2FibGVfbWFzayk7CisJ
d3JpdGVfcG1faWVyKGd0KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2d0X3BtX2lycS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG1f
aXJxLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iMjk4MTZhMDQ4
MDkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9w
bV9pcnEuaApAQCAtMCwwICsxLDIyIEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6
IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKwor
I2lmbmRlZiBJTlRFTF9HVF9QTV9JUlFfSAorI2RlZmluZSBJTlRFTF9HVF9QTV9JUlFfSAorCisj
aW5jbHVkZSA8bGludXgvdHlwZXMuaD4KKworc3RydWN0IGludGVsX2d0OworCit2b2lkIGdlbjZf
Z3RfcG1fdW5tYXNrX2lycShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIgbWFzayk7Cit2b2lkIGdl
bjZfZ3RfcG1fbWFza19pcnEoc3RydWN0IGludGVsX2d0ICpndCwgdTMyIG1hc2spOworCit2b2lk
IGdlbjZfZ3RfcG1fZW5hYmxlX2lycShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIgZW5hYmxlX21h
c2spOwordm9pZCBnZW42X2d0X3BtX2Rpc2FibGVfaXJxKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHUz
MiBkaXNhYmxlX21hc2spOworCit2b2lkIGdlbjZfZ3RfcG1fcmVzZXRfaWlyKHN0cnVjdCBpbnRl
bF9ndCAqZ3QsIHUzMiByZXNldF9tYXNrKTsKKworI2VuZGlmIC8qIElOVEVMX0dUX1BNX0lSUV9I
ICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAppbmRleCA3ODkxMDJm
NGY0NmIuLmJiNzUyMzY0ZDQ0NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90
eXBlcy5oCkBAIC03Myw4ICs3Myw5IEBAIHN0cnVjdCBpbnRlbF9ndCB7CiAKIAlzdHJ1Y3QgaTkx
NV92bWEgKnNjcmF0Y2g7CiAKLQl1MzIgcG1faW1yOworCXNwaW5sb2NrX3QgaXJxX2xvY2s7CiAJ
dTMyIHBtX2llcjsKKwl1MzIgcG1faW1yOwogCiAJdTMyIHBtX2d1Y19ldmVudHM7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCBiZTE3MGIxMGQ5MmYu
LjE1YjAyNDY0MjJjNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZm
ZXIuYwpAQCAtMzcsNiArMzcsNyBAQAogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKICNpbmNsdWRl
ICJpbnRlbF9jb250ZXh0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJpbnRl
bF9ndF9wbV9pcnEuaCIKICNpbmNsdWRlICJpbnRlbF9yZXNldC5oIgogI2luY2x1ZGUgImludGVs
X3dvcmthcm91bmRzLmgiCiAKQEAgLTEwNjcsMTQgKzEwNjgsMTQgQEAgaHN3X3ZlYm94X2lycV9l
bmFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCS8qIEZsdXNoL2RlbGF5IHRv
IGVuc3VyZSB0aGUgUklOR19JTVIgaXMgYWN0aXZlIGJlZm9yZSB0aGUgR1QgSU1SICovCiAJRU5H
SU5FX1BPU1RJTkdfUkVBRChlbmdpbmUsIFJJTkdfSU1SKTsKIAotCWdlbjZfdW5tYXNrX3BtX2ly
cShlbmdpbmUtPmd0LCBlbmdpbmUtPmlycV9lbmFibGVfbWFzayk7CisJZ2VuNl9ndF9wbV91bm1h
c2tfaXJxKGVuZ2luZS0+Z3QsIGVuZ2luZS0+aXJxX2VuYWJsZV9tYXNrKTsKIH0KIAogc3RhdGlj
IHZvaWQKIGhzd192ZWJveF9pcnFfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiB7CiAJRU5HSU5FX1dSSVRFKGVuZ2luZSwgUklOR19JTVIsIH4wKTsKLQlnZW42X21hc2tf
cG1faXJxKGVuZ2luZS0+Z3QsIGVuZ2luZS0+aXJxX2VuYWJsZV9tYXNrKTsKKwlnZW42X2d0X3Bt
X21hc2tfaXJxKGVuZ2luZS0+Z3QsIGVuZ2luZS0+aXJxX2VuYWJsZV9tYXNrKTsKIH0KIAogc3Rh
dGljIGludApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5kZXggNzUzNTljMjc2Mzk1Li41Mzg5NzYx
NzRhZDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpAQCAtNDQsNiArNDQsNyBAQAogI2luY2x1
ZGUgImRpc3BsYXkvaW50ZWxfcHNyLmgiCiAKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgorI2lu
Y2x1ZGUgImd0L2ludGVsX2d0X3BtX2lycS5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNp
bmNsdWRlICJpOTE1X2lycS5oIgpAQCAtNDM0LDE0MyArNDM1LDI4IEBAIHN0YXRpYyBpOTE1X3Jl
Z190IGdlbjZfcG1faWlyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlyZXR1
cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSA4ID8gR0VOOF9HVF9JSVIoMikgOiBHRU42X1BNSUlS
OwogfQogCi1zdGF0aWMgdm9pZCB3cml0ZV9wbV9pbXIoc3RydWN0IGludGVsX2d0ICpndCkKLXsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OwotCXN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7Ci0JdTMyIG1hc2sgPSBndC0+cG1faW1yOwot
CWk5MTVfcmVnX3QgcmVnOwotCi0JaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewotCQlyZWcg
PSBHRU4xMV9HUE1fV0dCT1hQRVJGX0lOVFJfTUFTSzsKLQkJLyogcG0gaXMgaW4gdXBwZXIgaGFs
ZiAqLwotCQltYXNrID0gbWFzayA8PCAxNjsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+
PSA4KSB7Ci0JCXJlZyA9IEdFTjhfR1RfSU1SKDIpOwotCX0gZWxzZSB7Ci0JCXJlZyA9IEdFTjZf
UE1JTVI7Ci0JfQotCi0JaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgcmVnLCBtYXNrKTsKLQlp
bnRlbF91bmNvcmVfcG9zdGluZ19yZWFkKHVuY29yZSwgcmVnKTsKLX0KLQotc3RhdGljIHZvaWQg
d3JpdGVfcG1faWVyKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBndC0+aTkxNTsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBn
dC0+dW5jb3JlOwotCXUzMiBtYXNrID0gZ3QtPnBtX2llcjsKLQlpOTE1X3JlZ190IHJlZzsKLQot
CWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHsKLQkJcmVnID0gR0VOMTFfR1BNX1dHQk9YUEVS
Rl9JTlRSX0VOQUJMRTsKLQkJLyogcG0gaXMgaW4gdXBwZXIgaGFsZiAqLwotCQltYXNrID0gbWFz
ayA8PCAxNjsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KSB7Ci0JCXJlZyA9IEdF
TjhfR1RfSUVSKDIpOwotCX0gZWxzZSB7Ci0JCXJlZyA9IEdFTjZfUE1JRVI7Ci0JfQotCi0JaW50
ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgcmVnLCBtYXNrKTsKLX0KLQotLyoqCi0gKiBzbmJfdXBk
YXRlX3BtX2lycSAtIHVwZGF0ZSBHRU42X1BNSU1SCi0gKiBAZ3Q6IGd0IGZvciB0aGUgaW50ZXJy
dXB0cwotICogQGludGVycnVwdF9tYXNrOiBtYXNrIG9mIGludGVycnVwdCBiaXRzIHRvIHVwZGF0
ZQotICogQGVuYWJsZWRfaXJxX21hc2s6IG1hc2sgb2YgaW50ZXJydXB0IGJpdHMgdG8gZW5hYmxl
Ci0gKi8KLXN0YXRpYyB2b2lkIHNuYl91cGRhdGVfcG1faXJxKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
Ci0JCQkgICAgICB1MzIgaW50ZXJydXB0X21hc2ssCi0JCQkgICAgICB1MzIgZW5hYmxlZF9pcnFf
bWFzaykKLXsKLQl1MzIgbmV3X3ZhbDsKLQotCVdBUk5fT04oZW5hYmxlZF9pcnFfbWFzayAmIH5p
bnRlcnJ1cHRfbWFzayk7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZndC0+aTkxNS0+aXJxX2xv
Y2spOwotCi0JbmV3X3ZhbCA9IGd0LT5wbV9pbXI7Ci0JbmV3X3ZhbCAmPSB+aW50ZXJydXB0X21h
c2s7Ci0JbmV3X3ZhbCB8PSAofmVuYWJsZWRfaXJxX21hc2sgJiBpbnRlcnJ1cHRfbWFzayk7Ci0K
LQlpZiAobmV3X3ZhbCAhPSBndC0+cG1faW1yKSB7Ci0JCWd0LT5wbV9pbXIgPSBuZXdfdmFsOwot
CQl3cml0ZV9wbV9pbXIoZ3QpOwotCX0KLX0KLQotdm9pZCBnZW42X3VubWFza19wbV9pcnEoc3Ry
dWN0IGludGVsX2d0ICpndCwgdTMyIG1hc2spCi17Ci0JaWYgKFdBUk5fT04oIWludGVsX2lycXNf
ZW5hYmxlZChndC0+aTkxNSkpKQotCQlyZXR1cm47Ci0KLQlzbmJfdXBkYXRlX3BtX2lycShndCwg
bWFzaywgbWFzayk7Ci19Ci0KLXN0YXRpYyB2b2lkIF9fZ2VuNl9tYXNrX3BtX2lycShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCB1MzIgbWFzaykKLXsKLQlzbmJfdXBkYXRlX3BtX2lycShndCwgbWFzaywg
MCk7Ci19Ci0KLXZvaWQgZ2VuNl9tYXNrX3BtX2lycShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIg
bWFzaykKLXsKLQlpZiAoV0FSTl9PTighaW50ZWxfaXJxc19lbmFibGVkKGd0LT5pOTE1KSkpCi0J
CXJldHVybjsKLQotCV9fZ2VuNl9tYXNrX3BtX2lycShndCwgbWFzayk7Ci19Ci0KLXN0YXRpYyB2
b2lkIGdlbjZfcmVzZXRfcG1faWlyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dTMyIHJlc2V0X21hc2spCi17Ci0JaTkxNV9yZWdfdCByZWcgPSBnZW42X3BtX2lpcihkZXZfcHJp
dik7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+aXJxX2xvY2spOwotCi0JSTkx
NV9XUklURShyZWcsIHJlc2V0X21hc2spOwotCUk5MTVfV1JJVEUocmVnLCByZXNldF9tYXNrKTsK
LQlQT1NUSU5HX1JFQUQocmVnKTsKLX0KLQotc3RhdGljIHZvaWQgZ2VuNl9lbmFibGVfcG1faXJx
KHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHUzMiBlbmFibGVfbWFzaykKLXsKLQlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZndC0+aTkxNS0+aXJxX2xvY2spOwotCi0JZ3QtPnBtX2llciB8PSBlbmFibGVfbWFz
azsKLQl3cml0ZV9wbV9pZXIoZ3QpOwotCWdlbjZfdW5tYXNrX3BtX2lycShndCwgZW5hYmxlX21h
c2spOwotCS8qIHVubWFza19wbV9pcnEgcHJvdmlkZXMgYW4gaW1wbGljaXQgYmFycmllciAoUE9T
VElOR19SRUFEKSAqLwotfQotCi1zdGF0aWMgdm9pZCBnZW42X2Rpc2FibGVfcG1faXJxKHN0cnVj
dCBpbnRlbF9ndCAqZ3QsIHUzMiBkaXNhYmxlX21hc2spCi17Ci0JbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmZ3QtPmk5MTUtPmlycV9sb2NrKTsKLQotCWd0LT5wbV9pZXIgJj0gfmRpc2FibGVfbWFzazsK
LQlfX2dlbjZfbWFza19wbV9pcnEoZ3QsIGRpc2FibGVfbWFzayk7Ci0Jd3JpdGVfcG1faWVyKGd0
KTsKLQkvKiB0aG91Z2ggYSBiYXJyaWVyIGlzIG1pc3NpbmcgaGVyZSwgYnV0IGRvbid0IHJlYWxs
eSBuZWVkIGEgb25lICovCi19Ci0KIHZvaWQgZ2VuMTFfcmVzZXRfcnBzX2ludGVycnVwdHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCXNwaW5fbG9ja19pcnEoJmRldl9w
cml2LT5pcnFfbG9jayk7CisJc3RydWN0IGludGVsX2d0ICpndCA9ICZkZXZfcHJpdi0+Z3Q7CisK
KwlzcGluX2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogCi0Jd2hpbGUgKGdlbjExX3Jlc2V0X29u
ZV9paXIoJmRldl9wcml2LT5ndCwgMCwgR0VOMTFfR1RQTSkpCisJd2hpbGUgKGdlbjExX3Jlc2V0
X29uZV9paXIoZ3QsIDAsIEdFTjExX0dUUE0pKQogCQk7CiAKIAlkZXZfcHJpdi0+Z3RfcG0ucnBz
LnBtX2lpciA9IDA7CiAKLQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJ
c3Bpbl91bmxvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogfQogCiB2b2lkIGdlbjZfcmVzZXRfcnBz
X2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCXNwaW5f
bG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JZ2VuNl9yZXNldF9wbV9paXIoZGV2X3By
aXYsIEdFTjZfUE1fUlBTX0VWRU5UUyk7CisJc3RydWN0IGludGVsX2d0ICpndCA9ICZkZXZfcHJp
di0+Z3Q7CisKKwlzcGluX2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOworCWdlbjZfZ3RfcG1fcmVz
ZXRfaWlyKGd0LCBHRU42X1BNX1JQU19FVkVOVFMpOwogCWRldl9wcml2LT5ndF9wbS5ycHMucG1f
aWlyID0gMDsKLQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7CisJc3Bpbl91
bmxvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogfQogCiB2b2lkIGdlbjZfZW5hYmxlX3Jwc19pbnRl
cnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKQEAgLTU4MSw3ICs0Njcs
NyBAQCB2b2lkIGdlbjZfZW5hYmxlX3Jwc19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlpZiAoUkVBRF9PTkNFKHJwcy0+aW50ZXJydXB0c19lbmFibGVkKSkK
IAkJcmV0dXJuOwogCi0Jc3Bpbl9sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGlu
X2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogCVdBUk5fT05fT05DRShycHMtPnBtX2lpcik7CiAK
IAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKQEAgLTU5MCw5ICs0NzYsOSBAQCB2b2lk
IGdlbjZfZW5hYmxlX3Jwc19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJV0FSTl9PTl9PTkNFKEk5MTVfUkVBRChnZW42X3BtX2lpcihkZXZfcHJpdikpICYg
ZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpOwogCiAJcnBzLT5pbnRlcnJ1cHRzX2VuYWJsZWQgPSB0
cnVlOwotCWdlbjZfZW5hYmxlX3BtX2lycShndCwgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpOwor
CWdlbjZfZ3RfcG1fZW5hYmxlX2lycShndCwgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpOwogCi0J
c3Bpbl91bmxvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNwaW5fdW5sb2NrX2lycSgm
Z3QtPmlycV9sb2NrKTsKIH0KIAogdTMyIGdlbjZfc2FuaXRpemVfcnBzX3BtX21hc2soY29uc3Qg
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiBtYXNrKQpAQCAtNjAzLDE4ICs0ODks
MTkgQEAgdTMyIGdlbjZfc2FuaXRpemVfcnBzX3BtX21hc2soY29uc3Qgc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIHUzMiBtYXNrKQogdm9pZCBnZW42X2Rpc2FibGVfcnBzX2ludGVycnVw
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCXN0cnVjdCBpbnRlbF9y
cHMgKnJwcyA9ICZkZXZfcHJpdi0+Z3RfcG0ucnBzOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAm
ZGV2X3ByaXYtPmd0OwogCiAJaWYgKCFSRUFEX09OQ0UocnBzLT5pbnRlcnJ1cHRzX2VuYWJsZWQp
KQogCQlyZXR1cm47CiAKLQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNw
aW5fbG9ja19pcnEoJmd0LT5pcnFfbG9jayk7CiAJcnBzLT5pbnRlcnJ1cHRzX2VuYWJsZWQgPSBm
YWxzZTsKIAogCUk5MTVfV1JJVEUoR0VONl9QTUlOVFJNU0ssIGdlbjZfc2FuaXRpemVfcnBzX3Bt
X21hc2soZGV2X3ByaXYsIH4wdSkpOwogCi0JZ2VuNl9kaXNhYmxlX3BtX2lycSgmZGV2X3ByaXYt
Pmd0LCBHRU42X1BNX1JQU19FVkVOVFMpOworCWdlbjZfZ3RfcG1fZGlzYWJsZV9pcnEoZ3QsIEdF
TjZfUE1fUlBTX0VWRU5UUyk7CiAKLQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9j
ayk7CisJc3Bpbl91bmxvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogCWludGVsX3N5bmNocm9uaXpl
X2lycShkZXZfcHJpdik7CiAKIAkvKiBOb3cgdGhhdCB3ZSB3aWxsIG5vdCBiZSBnZW5lcmF0aW5n
IGFueSBtb3JlIHdvcmssIGZsdXNoIGFueQpAQCAtNjMyLDQ2ICs1MTksNDQgQEAgdm9pZCBnZW42
X2Rpc2FibGVfcnBzX2ludGVycnVwdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogdm9pZCBnZW45X3Jlc2V0X2d1Y19pbnRlcnJ1cHRzKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykK
IHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gZ3VjX3RvX2d0KGd1Yyk7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBndC0+aTkxNTsKIAotCWFzc2VydF9ycG1fd2FrZWxvY2tfaGVs
ZCgmaTkxNS0+cnVudGltZV9wbSk7CisJYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKCZndC0+aTkx
NS0+cnVudGltZV9wbSk7CiAKLQlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7Ci0JZ2Vu
Nl9yZXNldF9wbV9paXIoaTkxNSwgZ3QtPnBtX2d1Y19ldmVudHMpOwotCXNwaW5fdW5sb2NrX2ly
cSgmaTkxNS0+aXJxX2xvY2spOworCXNwaW5fbG9ja19pcnEoJmd0LT5pcnFfbG9jayk7CisJZ2Vu
Nl9ndF9wbV9yZXNldF9paXIoZ3QsIGd0LT5wbV9ndWNfZXZlbnRzKTsKKwlzcGluX3VubG9ja19p
cnEoJmd0LT5pcnFfbG9jayk7CiB9CiAKIHZvaWQgZ2VuOV9lbmFibGVfZ3VjX2ludGVycnVwdHMo
c3RydWN0IGludGVsX2d1YyAqZ3VjKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBndWNfdG9f
Z3QoZ3VjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OwogCi0J
YXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKCZpOTE1LT5ydW50aW1lX3BtKTsKKwlhc3NlcnRfcnBt
X3dha2Vsb2NrX2hlbGQoJmd0LT5pOTE1LT5ydW50aW1lX3BtKTsKIAotCXNwaW5fbG9ja19pcnEo
Jmk5MTUtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogCWlmICgh
Z3VjLT5pbnRlcnJ1cHRzLmVuYWJsZWQpIHsKLQkJV0FSTl9PTl9PTkNFKGludGVsX3VuY29yZV9y
ZWFkKGd0LT51bmNvcmUsIGdlbjZfcG1faWlyKGk5MTUpKSAmCisJCVdBUk5fT05fT05DRShpbnRl
bF91bmNvcmVfcmVhZChndC0+dW5jb3JlLAorCQkJCQkgICAgICAgZ2VuNl9wbV9paXIoZ3QtPmk5
MTUpKSAmCiAJCQkgICAgIGd0LT5wbV9ndWNfZXZlbnRzKTsKIAkJZ3VjLT5pbnRlcnJ1cHRzLmVu
YWJsZWQgPSB0cnVlOwotCQlnZW42X2VuYWJsZV9wbV9pcnEoZ3QsIGd0LT5wbV9ndWNfZXZlbnRz
KTsKKwkJZ2VuNl9ndF9wbV9lbmFibGVfaXJxKGd0LCBndC0+cG1fZ3VjX2V2ZW50cyk7CiAJfQot
CXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCXNwaW5fdW5sb2NrX2lycSgmZ3Qt
PmlycV9sb2NrKTsKIH0KIAogdm9pZCBnZW45X2Rpc2FibGVfZ3VjX2ludGVycnVwdHMoc3RydWN0
IGludGVsX2d1YyAqZ3VjKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBndWNfdG9fZ3QoZ3Vj
KTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OwogCi0JYXNzZXJ0
X3JwbV93YWtlbG9ja19oZWxkKCZpOTE1LT5ydW50aW1lX3BtKTsKKwlhc3NlcnRfcnBtX3dha2Vs
b2NrX2hlbGQoJmd0LT5pOTE1LT5ydW50aW1lX3BtKTsKIAotCXNwaW5fbG9ja19pcnEoJmk5MTUt
PmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogCWd1Yy0+aW50ZXJy
dXB0cy5lbmFibGVkID0gZmFsc2U7CiAKLQlnZW42X2Rpc2FibGVfcG1faXJxKGd0LCBndC0+cG1f
Z3VjX2V2ZW50cyk7CisJZ2VuNl9ndF9wbV9kaXNhYmxlX2lycShndCwgZ3QtPnBtX2d1Y19ldmVu
dHMpOwogCi0Jc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7Ci0JaW50ZWxfc3luY2hy
b25pemVfaXJxKGk5MTUpOworCXNwaW5fdW5sb2NrX2lycSgmZ3QtPmlycV9sb2NrKTsKKwlpbnRl
bF9zeW5jaHJvbml6ZV9pcnEoZ3QtPmk5MTUpOwogCiAJZ2VuOV9yZXNldF9ndWNfaW50ZXJydXB0
cyhndWMpOwogfQpAQCAtNjc5LDE4ICs1NjQsMTcgQEAgdm9pZCBnZW45X2Rpc2FibGVfZ3VjX2lu
dGVycnVwdHMoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogdm9pZCBnZW4xMV9yZXNldF9ndWNfaW50
ZXJydXB0cyhzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9
IGd1Y190b19ndChndWMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5
MTU7CiAKLQlzcGluX2xvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgm
Z3QtPmlycV9sb2NrKTsKIAlnZW4xMV9yZXNldF9vbmVfaWlyKGd0LCAwLCBHRU4xMV9HVUMpOwot
CXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworCXNwaW5fdW5sb2NrX2lycSgmZ3Qt
PmlycV9sb2NrKTsKIH0KIAogdm9pZCBnZW4xMV9lbmFibGVfZ3VjX2ludGVycnVwdHMoc3RydWN0
IGludGVsX2d1YyAqZ3VjKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBndWNfdG9fZ3QoZ3Vj
KTsKIAotCXNwaW5fbG9ja19pcnEoJmd0LT5pOTE1LT5pcnFfbG9jayk7CisJc3Bpbl9sb2NrX2ly
cSgmZ3QtPmlycV9sb2NrKTsKIAlpZiAoIWd1Yy0+aW50ZXJydXB0cy5lbmFibGVkKSB7CiAJCXUz
MiBldmVudHMgPSBSRUdfRklFTERfUFJFUChFTkdJTkUxX01BU0ssIEdVQ19JTlRSX0dVQzJIT1NU
KTsKIApAQCAtNjk5LDIyICs1ODMsMjEgQEAgdm9pZCBnZW4xMV9lbmFibGVfZ3VjX2ludGVycnVw
dHMoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCQlpbnRlbF91bmNvcmVfd3JpdGUoZ3QtPnVuY29y
ZSwgR0VOMTFfR1VDX1NHX0lOVFJfTUFTSywgfmV2ZW50cyk7CiAJCWd1Yy0+aW50ZXJydXB0cy5l
bmFibGVkID0gdHJ1ZTsKIAl9Ci0Jc3Bpbl91bmxvY2tfaXJxKCZndC0+aTkxNS0+aXJxX2xvY2sp
OworCXNwaW5fdW5sb2NrX2lycSgmZ3QtPmlycV9sb2NrKTsKIH0KIAogdm9pZCBnZW4xMV9kaXNh
YmxlX2d1Y19pbnRlcnJ1cHRzKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIHsKIAlzdHJ1Y3QgaW50
ZWxfZ3QgKmd0ID0gZ3VjX3RvX2d0KGd1Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBndC0+aTkxNTsKIAotCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKKwlzcGlu
X2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogCWd1Yy0+aW50ZXJydXB0cy5lbmFibGVkID0gZmFs
c2U7CiAKIAlpbnRlbF91bmNvcmVfd3JpdGUoZ3QtPnVuY29yZSwgR0VOMTFfR1VDX1NHX0lOVFJf
TUFTSywgfjApOwogCWludGVsX3VuY29yZV93cml0ZShndC0+dW5jb3JlLCBHRU4xMV9HVUNfU0df
SU5UUl9FTkFCTEUsIDApOwogCi0Jc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9jayk7Ci0J
aW50ZWxfc3luY2hyb25pemVfaXJxKGk5MTUpOworCXNwaW5fdW5sb2NrX2lycSgmZ3QtPmlycV9s
b2NrKTsKKwlpbnRlbF9zeW5jaHJvbml6ZV9pcnEoZ3QtPmk5MTUpOwogCiAJZ2VuMTFfcmVzZXRf
Z3VjX2ludGVycnVwdHMoZ3VjKTsKIH0KQEAgLTEzODgsMTcgKzEyNzEsMTggQEAgc3RhdGljIHZv
aWQgZ2VuNl9wbV9ycHNfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KIAkJY29udGFpbmVyX29mKHdvcmssIHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlLCBndF9wbS5ycHMud29yayk7CisJc3RydWN0IGludGVsX2d0ICpn
dCA9ICZkZXZfcHJpdi0+Z3Q7CiAJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmRldl9wcml2LT5n
dF9wbS5ycHM7CiAJYm9vbCBjbGllbnRfYm9vc3QgPSBmYWxzZTsKIAlpbnQgbmV3X2RlbGF5LCBh
ZGosIG1pbiwgbWF4OwogCXUzMiBwbV9paXIgPSAwOwogCi0Jc3Bpbl9sb2NrX2lycSgmZGV2X3By
aXYtPmlycV9sb2NrKTsKKwlzcGluX2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogCWlmIChycHMt
PmludGVycnVwdHNfZW5hYmxlZCkgewogCQlwbV9paXIgPSBmZXRjaF9hbmRfemVybygmcnBzLT5w
bV9paXIpOwogCQljbGllbnRfYm9vc3QgPSBhdG9taWNfcmVhZCgmcnBzLT5udW1fd2FpdGVycyk7
CiAJfQotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwlzcGluX3VubG9j
a19pcnEoJmd0LT5pcnFfbG9jayk7CiAKIAkvKiBNYWtlIHN1cmUgd2UgZGlkbid0IHF1ZXVlIGFu
eXRoaW5nIHdlJ3JlIG5vdCBnb2luZyB0byBwcm9jZXNzLiAqLwogCVdBUk5fT04ocG1faWlyICYg
fmRldl9wcml2LT5wbV9ycHNfZXZlbnRzKTsKQEAgLTE0NzUsMTAgKzEzNTksMTAgQEAgc3RhdGlj
IHZvaWQgZ2VuNl9wbV9ycHNfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAKIG91dDoK
IAkvKiBNYWtlIHN1cmUgbm90IHRvIGNvcnJ1cHQgUE1JTVIgc3RhdGUgdXNlZCBieSByaW5nYnVm
ZmVyIG9uIEdFTjYgKi8KLQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCXNw
aW5fbG9ja19pcnEoJmd0LT5pcnFfbG9jayk7CiAJaWYgKHJwcy0+aW50ZXJydXB0c19lbmFibGVk
KQotCQlnZW42X3VubWFza19wbV9pcnEoJmRldl9wcml2LT5ndCwgZGV2X3ByaXYtPnBtX3Jwc19l
dmVudHMpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwkJZ2VuNl9n
dF9wbV91bm1hc2tfaXJxKGd0LCBkZXZfcHJpdi0+cG1fcnBzX2V2ZW50cyk7CisJc3Bpbl91bmxv
Y2tfaXJxKCZndC0+aXJxX2xvY2spOwogfQogCiAKQEAgLTIwMDgsMTIgKzE4OTIsMTIgQEAgc3Rh
dGljIHZvaWQgZ2VuMTFfcnBzX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHUzMiBw
bV9paXIpCiAJc3RydWN0IGludGVsX3JwcyAqcnBzID0gJmk5MTUtPmd0X3BtLnJwczsKIAljb25z
dCB1MzIgZXZlbnRzID0gaTkxNS0+cG1fcnBzX2V2ZW50cyAmIHBtX2lpcjsKIAotCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJmk5MTUtPmlycV9sb2NrKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZndC0+
aXJxX2xvY2spOwogCiAJaWYgKHVubGlrZWx5KCFldmVudHMpKQogCQlyZXR1cm47CiAKLQlnZW42
X21hc2tfcG1faXJxKGd0LCBldmVudHMpOworCWdlbjZfZ3RfcG1fbWFza19pcnEoZ3QsIGV2ZW50
cyk7CiAKIAlpZiAoIXJwcy0+aW50ZXJydXB0c19lbmFibGVkKQogCQlyZXR1cm47CkBAIC0yMDI1
LDE2ICsxOTA5LDE2IEBAIHN0YXRpYyB2b2lkIGdlbjExX3Jwc19pcnFfaGFuZGxlcihzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCB1MzIgcG1faWlyKQogc3RhdGljIHZvaWQgZ2VuNl9ycHNfaXJxX2hhbmRs
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcG1faWlyKQogewogCXN0
cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZkZXZfcHJpdi0+Z3RfcG0ucnBzOworCXN0cnVjdCBpbnRl
bF9ndCAqZ3QgPSAmZGV2X3ByaXYtPmd0OwogCiAJaWYgKHBtX2lpciAmIGRldl9wcml2LT5wbV9y
cHNfZXZlbnRzKSB7Ci0JCXNwaW5fbG9jaygmZGV2X3ByaXYtPmlycV9sb2NrKTsKLQkJZ2VuNl9t
YXNrX3BtX2lycSgmZGV2X3ByaXYtPmd0LAotCQkJCSBwbV9paXIgJiBkZXZfcHJpdi0+cG1fcnBz
X2V2ZW50cyk7CisJCXNwaW5fbG9jaygmZ3QtPmlycV9sb2NrKTsKKwkJZ2VuNl9ndF9wbV9tYXNr
X2lycShndCwgcG1faWlyICYgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpOwogCQlpZiAocnBzLT5p
bnRlcnJ1cHRzX2VuYWJsZWQpIHsKIAkJCXJwcy0+cG1faWlyIHw9IHBtX2lpciAmIGRldl9wcml2
LT5wbV9ycHNfZXZlbnRzOwogCQkJc2NoZWR1bGVfd29yaygmcnBzLT53b3JrKTsKIAkJfQotCQlz
cGluX3VubG9jaygmZGV2X3ByaXYtPmlycV9sb2NrKTsKKwkJc3Bpbl91bmxvY2soJmd0LT5pcnFf
bG9jayk7CiAJfQogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2lycS5oCmluZGV4IDQzNzIwYzJkODFiOS4uNDJjODgxZDhhZDY5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfaXJxLmgKQEAgLTg0LDggKzg0LDYgQEAgaWJ4X2Rpc2FibGVfZGlzcGxheV9pbnRlcnJ1
cHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgYml0cykKIAogdm9pZCBn
ZW41X2VuYWJsZV9ndF9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIg
bWFzayk7CiB2b2lkIGdlbjVfZGlzYWJsZV9ndF9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LCB1MzIgbWFzayk7Ci12b2lkIGdlbjZfbWFza19wbV9pcnEoc3RydWN0IGludGVs
X2d0ICpndCwgdTMyIG1hc2spOwotdm9pZCBnZW42X3VubWFza19wbV9pcnEoc3RydWN0IGludGVs
X2d0ICpndCwgdTMyIG1hc2spOwogdm9pZCBnZW4xMV9yZXNldF9ycHNfaW50ZXJydXB0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBnZW42X3Jlc2V0X3Jwc19pbnRl
cnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGdlbjZfZW5h
YmxlX3Jwc19pbnRlcnJ1cHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci0t
IAoyLjIzLjAucmMxCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
Zng=

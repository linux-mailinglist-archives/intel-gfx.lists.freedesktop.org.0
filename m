Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 14470F6AFA
	for <lists+intel-gfx@lfdr.de>; Sun, 10 Nov 2019 19:58:45 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3C3EF6E7B5;
	Sun, 10 Nov 2019 18:58:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DECA56E51A
 for <intel-gfx@lists.freedesktop.org>; Sun, 10 Nov 2019 18:58:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19151902-1500050 
 for multiple; Sun, 10 Nov 2019 18:58:13 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 10 Nov 2019 18:58:03 +0000
Message-Id: <20191110185806.17413-22-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191110185806.17413-1-chris@chris-wilson.co.uk>
References: <20191110185806.17413-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 22/25] drm/i915: Remove i915->kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsb2NhdGUgb25seSBhbiBpbnRlcm5hbCBpbnRlbF9jb250ZXh0IGZvciB0aGUga2VybmVsX2Nv
bnRleHQsIGZvcmdvaW5nCmEgZ2xvYmFsIEdFTSBjb250ZXh0IGZvciBpbnRlcm5hbCB1c2UgYXMg
d2Ugb25seSByZXF1aXJlIGEgc2VwYXJhdGUKYWRkcmVzcyBzcGFjZSAoZm9yIG91ciBvd24gcHJv
dGVjdGlvbikuCgpOb3cgaGF2aW5nIHdlYW5lZCBHVCBmcm9tIHJlcXVpcmluZyBjZS0+Z2VtX2Nv
bnRleHQsIHdlIGNhbiBzdG9wCnJlZmVyZW5jaW5nIGl0IGVudGlyZWx5LiBUaGlzIGFsc28gbWVh
bnMgd2Ugbm8gbG9uZ2VyIGhhdmUgdG8gY3JlYXRlIHJhbmRvbQphbmQgdW5uZWNlc3NhcnkgR0VN
IGNvbnRleHRzIGZvciBpbnRlcm5hbCB1c2UuCgpHRU0gY29udGV4dHMgYXJlIG5vdyBlbnRpcmVs
eSBmb3IgdHJhY2tpbmcgR0VNIGNsaWVudHMsIGFuZCBpbnRlbF9jb250ZXh0CnRoZSBleGVjdXRp
b24gZW52aXJvbm1lbnQgb24gdGhlIEdQVS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgICB8ICA5NyArKysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgIDYgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgMzIgKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oICAgICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0X3R5cGVzLmggfCAgMTEgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9jcy5jICAgICB8ICAyMSArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2d0LmMgICAgICAgICAgICB8ICAyNSArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2d0X3R5cGVzLmggICAgICB8ICAgNyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9scmMuYyAgICAgICAgICAgfCAgMjEgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9scmMuaCAgICAgICAgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3Jlc2V0LmMgICAgICAgICB8ICAxNCArLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
aW5nX3N1Ym1pc3Npb24uYyAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9jb250ZXh0LmMgICAgfCAgNTcgKystLS0tLQogLi4uL2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2VuZ2luZV9oZWFydGJlYXQuYyAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9oYW5nY2hlY2suYyAgfCAxNDEgKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgMTUyICsrKysrKy0tLS0tLS0tLS0t
LQogLi4uL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDcyICsr
KystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwg
IDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAg
IDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICAz
IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8ICAxNiAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgIHwgICA4ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAgfCAgIDMgLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgICAgICAgICAgIHwgICA1ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgfCAgIDYgKy0KIC4u
Li9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jICB8ICAgOCArLQogMjkg
ZmlsZXMgY2hhbmdlZCwgMjkyIGluc2VydGlvbnMoKyksIDQ3NSBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCBlNjkxYjllZmNi
MmEuLjIxYzI2NWFmNmJkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
Y29udGV4dC5jCkBAIC0yMDgsNiArMjA4LDMyIEBAIGNvbnRleHRfZ2V0X3ZtX3JjdShzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4KQogCX0gd2hpbGUgKDEpOwogfQogCitzdGF0aWMgdm9pZCBp
bnRlbF9jb250ZXh0X3NldF9nZW0oc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJCSAgc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKK3sKKwljZS0+Z2VtX2NvbnRleHQgPSBjdHg7CisK
KwljZS0+cmluZyA9IF9faW50ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfMTZLKTsKKworCWlmIChy
Y3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpIHsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm07CisKKwkJcmN1X3JlYWRfbG9jaygpOworCQl2bSA9IGNvbnRleHRfZ2V0X3ZtX3JjdShj
dHgpOyAvKiBobW0gKi8KKwkJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwkJaTkxNV92bV9wdXQoY2Ut
PnZtKTsKKwkJY2UtPnZtID0gdm07CisJfQorCisJaWYgKGN0eC0+dGltZWxpbmUpCisJCWNlLT50
aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2dldChjdHgtPnRpbWVsaW5lKTsKKworCWlmIChjdHgt
PnNjaGVkLnByaW9yaXR5ID49IEk5MTVfUFJJT1JJVFlfTk9STUFMICYmCisJICAgIGludGVsX2Vu
Z2luZV9oYXNfc2VtYXBob3JlcyhjZS0+ZW5naW5lKSkKKwkJX19zZXRfYml0KENPTlRFWFRfVVNF
X1NFTUFQSE9SRVMsICZjZS0+ZmxhZ3MpOworfQorCiBzdGF0aWMgdm9pZCBfX2ZyZWVfZW5naW5l
cyhzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZSwgdW5zaWduZWQgaW50IGNvdW50KQogewogCXdo
aWxlIChjb3VudC0tKSB7CkBAIC0yNTAsMTIgKzI3NiwxNCBAQCBzdGF0aWMgc3RydWN0IGk5MTVf
Z2VtX2VuZ2luZXMgKmRlZmF1bHRfZW5naW5lcyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
KQogCQlHRU1fQlVHX09OKGVuZ2luZS0+bGVnYWN5X2lkeCA+PSBJOTE1X05VTV9FTkdJTkVTKTsK
IAkJR0VNX0JVR19PTihlLT5lbmdpbmVzW2VuZ2luZS0+bGVnYWN5X2lkeF0pOwogCi0JCWNlID0g
aW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUpOworCQljZSA9IGludGVsX2NvbnRleHRf
Y3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQlfX2ZyZWVfZW5naW5lcyhl
LCBlLT5udW1fZW5naW5lcyArIDEpOwogCQkJcmV0dXJuIEVSUl9DQVNUKGNlKTsKIAkJfQogCisJ
CWludGVsX2NvbnRleHRfc2V0X2dlbShjZSwgY3R4KTsKKwogCQllLT5lbmdpbmVzW2VuZ2luZS0+
bGVnYWN5X2lkeF0gPSBjZTsKIAkJZS0+bnVtX2VuZ2luZXMgPSBtYXgoZS0+bnVtX2VuZ2luZXMs
IGVuZ2luZS0+bGVnYWN5X2lkeCk7CiAJfQpAQCAtNzA1LDM3ICs3MzMsNiBAQCBpOTE1X2dlbV9j
cmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQgaW50
IGZsYWdzKQogCXJldHVybiBjdHg7CiB9CiAKLXN0YXRpYyB2b2lkCi1kZXN0cm95X2tlcm5lbF9j
b250ZXh0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoqY3R4cCkKLXsKLQlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4OwotCi0JLyogS2VlcCB0aGUgY29udGV4dCByZWYgc28gdGhhdCB3ZSBj
YW4gZnJlZSBpdCBpbW1lZGlhdGVseSBvdXJzZWx2ZXMgKi8KLQljdHggPSBpOTE1X2dlbV9jb250
ZXh0X2dldChmZXRjaF9hbmRfemVybyhjdHhwKSk7Ci0JR0VNX0JVR19PTighaTkxNV9nZW1fY29u
dGV4dF9pc19rZXJuZWwoY3R4KSk7Ci0KLQljb250ZXh0X2Nsb3NlKGN0eCk7Ci0JaTkxNV9nZW1f
Y29udGV4dF9mcmVlKGN0eCk7Ci19Ci0KLXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoKLWk5MTVf
Z2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
aW50IHByaW8pCi17Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQotCWN0eCA9IGk5
MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KGk5MTUsIDApOwotCWlmIChJU19FUlIoY3R4KSkKLQkJcmV0
dXJuIGN0eDsKLQotCWk5MTVfZ2VtX2NvbnRleHRfY2xlYXJfYmFubmFibGUoY3R4KTsKLQlpOTE1
X2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShjdHgpOwotCWN0eC0+c2NoZWQucHJpb3JpdHkg
PSBJOTE1X1VTRVJfUFJJT1JJVFkocHJpbyk7Ci0KLQlHRU1fQlVHX09OKCFpOTE1X2dlbV9jb250
ZXh0X2lzX2tlcm5lbChjdHgpKTsKLQotCXJldHVybiBjdHg7Ci19Ci0KIHN0YXRpYyB2b2lkIGlu
aXRfY29udGV4dHMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYykKIHsKIAlzcGluX2xvY2tf
aW5pdCgmZ2MtPmxvY2spOwpAQCAtNzQ1LDMyICs3NDIsMTIgQEAgc3RhdGljIHZvaWQgaW5pdF9j
b250ZXh0cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogCWluaXRfbGxpc3RfaGVhZCgm
Z2MtPmZyZWVfbGlzdCk7CiB9CiAKLWludCBpOTE1X2dlbV9pbml0X2NvbnRleHRzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQordm9pZCBpOTE1X2dlbV9pbml0X2NvbnRleHRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7Ci0KLQkvKiBSZWFzc3VyZSBvdXJzZWx2ZXMgd2UgYXJlIG9ubHkgY2FsbGVkIG9uY2UgKi8K
LQlHRU1fQlVHX09OKGk5MTUtPmtlcm5lbF9jb250ZXh0KTsKLQogCWluaXRfY29udGV4dHMoJmk5
MTUtPmdlbS5jb250ZXh0cyk7Ci0KLQkvKiBsb3dlc3QgcHJpb3JpdHk7IGlkbGUgdGFzayAqLwot
CWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1X1BSSU9SSVRZ
X01JTik7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCURSTV9FUlJPUigiRmFpbGVkIHRvIGNyZWF0
ZSBkZWZhdWx0IGdsb2JhbCBjb250ZXh0XG4iKTsKLQkJcmV0dXJuIFBUUl9FUlIoY3R4KTsKLQl9
Ci0JaTkxNS0+a2VybmVsX2NvbnRleHQgPSBjdHg7Ci0KIAlEUk1fREVCVUdfRFJJVkVSKCIlcyBj
b250ZXh0IHN1cHBvcnQgaW5pdGlhbGl6ZWRcbiIsCiAJCQkgRFJJVkVSX0NBUFMoaTkxNSktPmhh
c19sb2dpY2FsX2NvbnRleHRzID8KIAkJCSAibG9naWNhbCIgOiAiZmFrZSIpOwotCXJldHVybiAw
OwotfQotCi12b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKLXsKLQlkZXN0cm95X2tlcm5lbF9jb250ZXh0KCZpOTE1LT5r
ZXJuZWxfY29udGV4dCk7CiB9CiAKIHN0YXRpYyBpbnQgY29udGV4dF9pZHJfY2xlYW51cChpbnQg
aWQsIHZvaWQgKnAsIHZvaWQgKmRhdGEpCkBAIC0xNTIyLDEyICsxNDk5LDE0IEBAIHNldF9lbmdp
bmVzX19sb2FkX2JhbGFuY2Uoc3RydWN0IGk5MTVfdXNlcl9leHRlbnNpb24gX191c2VyICpiYXNl
LCB2b2lkICpkYXRhKQogCQl9CiAJfQogCi0JY2UgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3Zp
cnR1YWwoc2V0LT5jdHgsIHNpYmxpbmdzLCBuKTsKKwljZSA9IGludGVsX2V4ZWNsaXN0c19jcmVh
dGVfdmlydHVhbChzaWJsaW5ncywgbik7CiAJaWYgKElTX0VSUihjZSkpIHsKIAkJZXJyID0gUFRS
X0VSUihjZSk7CiAJCWdvdG8gb3V0X3NpYmxpbmdzOwogCX0KIAorCWludGVsX2NvbnRleHRfc2V0
X2dlbShjZSwgc2V0LT5jdHgpOworCiAJaWYgKGNtcHhjaGcoJnNldC0+ZW5naW5lcy0+ZW5naW5l
c1tpZHhdLCBOVUxMLCBjZSkpIHsKIAkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQllcnIgPSAt
RUVYSVNUOwpAQCAtMTY5NywxMiArMTY3NiwxNCBAQCBzZXRfZW5naW5lcyhzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4LAogCQkJcmV0dXJuIC1FTk9FTlQ7CiAJCX0KIAotCQljZSA9IGludGVs
X2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0
ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJX19mcmVlX2VuZ2luZXMoc2V0LmVu
Z2luZXMsIG4pOwogCQkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCQl9CiAKKwkJaW50ZWxfY29udGV4
dF9zZXRfZ2VtKGNlLCBjdHgpOworCiAJCXNldC5lbmdpbmVzLT5lbmdpbmVzW25dID0gY2U7CiAJ
fQogCXNldC5lbmdpbmVzLT5udW1fZW5naW5lcyA9IG51bV9lbmdpbmVzOwpAQCAtMjAwMywxMyAr
MTk4NCwxNSBAQCBzdGF0aWMgaW50IGNsb25lX2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmRzdCwKIAkJICovCiAJCWlmIChpbnRlbF9lbmdpbmVfaXNfdmlydHVhbChlbmdpbmUpKQog
CQkJY2xvbmUtPmVuZ2luZXNbbl0gPQotCQkJCWludGVsX2V4ZWNsaXN0c19jbG9uZV92aXJ0dWFs
KGRzdCwgZW5naW5lKTsKKwkJCQlpbnRlbF9leGVjbGlzdHNfY2xvbmVfdmlydHVhbChlbmdpbmUp
OwogCQllbHNlCi0JCQljbG9uZS0+ZW5naW5lc1tuXSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGRz
dCwgZW5naW5lKTsKKwkJCWNsb25lLT5lbmdpbmVzW25dID0gaW50ZWxfY29udGV4dF9jcmVhdGUo
ZW5naW5lKTsKIAkJaWYgKElTX0VSUl9PUl9OVUxMKGNsb25lLT5lbmdpbmVzW25dKSkgewogCQkJ
X19mcmVlX2VuZ2luZXMoY2xvbmUsIG4pOwogCQkJZ290byBlcnJfdW5sb2NrOwogCQl9CisKKwkJ
aW50ZWxfY29udGV4dF9zZXRfZ2VtKGNsb25lLT5lbmdpbmVzW25dLCBkc3QpOwogCX0KIAljbG9u
ZS0+bnVtX2VuZ2luZXMgPSBuOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHQuaAppbmRleCA2OTkzMjg5OTgwM2UuLmQ5OWZmZjQ4MWQ1OSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCkBAIC0xMTUsOCArMTE1LDcgQEAg
c3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgpCiB9CiAKIC8qIGk5MTVfZ2VtX2NvbnRleHQuYyAqLwotaW50IF9f
bXVzdF9jaGVjayBpOTE1X2dlbV9pbml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKLXZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKIGludCBpOTE1X2dlbV9jb250ZXh0X29wZW4o
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmls
ZSk7CkBAIC0xNDAsOSArMTM5LDYgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfc2V0cGFyYW1faW9j
dGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIGludCBpOTE1X2dlbV9jb250
ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEs
CiAJCQkJICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CiAKLXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICoKLWk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwgaW50IHByaW8pOwotCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICoKIGk5MTVfZ2VtX2NvbnRleHRfZ2V0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHgpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
dXNlcnB0ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwpp
bmRleCA1NGViYzdhYjcxYmMuLjVkY2NjOTc1Nzk0NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCkBAIC03NzgsMTUgKzc3OCwxMSBAQCBpOTE1X2dlbV91
c2VycHRyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCXJldHVybiAtRUZBVUxUOwog
CiAJaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9VU0VSUFRSX1JFQURfT05MWSkgewotCQlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKLQogCQkvKgogCQkgKiBPbiBhbG1vc3QgYWxsIG9mIHRo
ZSBvbGRlciBodywgd2UgY2Fubm90IHRlbGwgdGhlIEdQVSB0aGF0CiAJCSAqIGEgcGFnZSBpcyBy
ZWFkb25seS4KIAkJICovCi0JCXZtID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChkZXZfcHJp
di0+a2VybmVsX2NvbnRleHQtPnZtLAotCQkJCQkgICAgICAgdHJ1ZSk7IC8qIHN0YXRpYyB2bSAq
LwotCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkKKwkJaWYgKCFkZXZfcHJpdi0+Z3Qu
dm0tPmhhc19yZWFkX29ubHkpCiAJCQlyZXR1cm4gLUVOT0RFVjsKIAl9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5k
ZXggOWE1MDljMThiN2M3Li4xMDZhM2JmYTNiYjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC0zMTUsNyArMzE1
LDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAJCQlpZiAo
IWRhdGFbbV0uY2VbMF0pCiAJCQkJY29udGludWU7CiAKLQkJCWNlID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoY3R4LCBkYXRhW21dLmNlWzBdLT5lbmdpbmUpOworCQkJY2UgPSBpbnRlbF9jb250ZXh0
X2NyZWF0ZShkYXRhW21dLmNlWzBdLT5lbmdpbmUpOwogCQkJaWYgKElTX0VSUihjZSkpCiAJCQkJ
Z290byBvdXQ7CiAKQEAgLTEyMzksOCArMTIzOSw3IEBAIF9faWd0X2N0eF9zc2V1KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJaHdlaWdodDMyKGVuZ2luZS0+c3NldS5zbGljZV9t
YXNrKSwKIAkJCWh3ZWlnaHQzMihwZ19zc2V1LnNsaWNlX21hc2spKTsKIAotCQljZSA9IGludGVs
X2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPmdlbV9jb250ZXh0LAotCQkJ
CQkgIGVuZ2luZSk7CisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYg
KElTX0VSUihjZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIoY2UpOwogCQkJZ290byBvdXRfcHV0Owpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRl
eHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMK
aW5kZXggNTNlODllZmIwOWMwLi5mZGYyZjEyMDIzNGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYwpAQCAtOTYsNyArOTYsMTYgQEAg
bGl2ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZmlsZSAq
ZmlsZSkKIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoKIGtlcm5lbF9jb250ZXh0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXJldHVybiBpOTE1X2dlbV9jb250ZXh0X2NyZWF0
ZV9rZXJuZWwoaTkxNSwgSTkxNV9QUklPUklUWV9OT1JNQUwpOworCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHg7CisKKwljdHggPSBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChpOTE1LCAwKTsK
KwlpZiAoSVNfRVJSKGN0eCkpCisJCXJldHVybiBjdHg7CisKKwlHRU1fQlVHX09OKCFpOTE1X2dl
bV9jb250ZXh0X2lzX2tlcm5lbChjdHgpKTsKKwlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5h
YmxlKGN0eCk7CisKKwlyZXR1cm4gY3R4OwogfQogCiB2b2lkIGtlcm5lbF9jb250ZXh0X2Nsb3Nl
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0LmMKaW5kZXggNzA3NWQwM2Y1MDhmLi4wNGFhMDc1OWJlMzkgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTMxLDggKzMxLDcgQEAgdm9pZCBpbnRl
bF9jb250ZXh0X2ZyZWUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogfQogCiBzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqCi1pbnRlbF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAotCQkgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK2ludGVsX2Nv
bnRleHRfY3JlYXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2U7CiAKQEAgLTQwLDcgKzM5LDcgQEAgaW50ZWxfY29udGV4dF9jcmVh
dGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlpZiAoIWNlKQogCQlyZXR1cm4gRVJS
X1BUUigtRU5PTUVNKTsKIAotCWludGVsX2NvbnRleHRfaW5pdChjZSwgY3R4LCBlbmdpbmUpOwor
CWludGVsX2NvbnRleHRfaW5pdChjZSwgZW5naW5lKTsKIAlyZXR1cm4gY2U7CiB9CiAKQEAgLTcy
LDggKzcxLDYgQEAgaW50IF9faW50ZWxfY29udGV4dF9kb19waW4oc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlKQogCQkJICBjZS0+ZW5naW5lLT5uYW1lLCBjZS0+dGltZWxpbmUtPmZlbmNlX2NvbnRl
eHQsCiAJCQkgIGNlLT5yaW5nLT5oZWFkLCBjZS0+cmluZy0+dGFpbCk7CiAKLQkJaTkxNV9nZW1f
Y29udGV4dF9nZXQoY2UtPmdlbV9jb250ZXh0KTsgLyogZm9yIGN0eC0+cHBndHQgKi8KLQogCQlz
bXBfbWJfX2JlZm9yZV9hdG9taWMoKTsgLyogZmx1c2ggcGluIGJlZm9yZSBpdCBpcyB2aXNpYmxl
ICovCiAJfQogCkBAIC0xMDMsNyArMTAwLDYgQEAgdm9pZCBpbnRlbF9jb250ZXh0X3VucGluKHN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAogCQljZS0+b3BzLT51bnBpbihjZSk7CiAKLQkJaTkx
NV9nZW1fY29udGV4dF9wdXQoY2UtPmdlbV9jb250ZXh0KTsKIAkJaW50ZWxfY29udGV4dF9hY3Rp
dmVfcmVsZWFzZShjZSk7CiAJfQogCkBAIC0xOTgsNyArMTk0LDcgQEAgaW50IGludGVsX2NvbnRl
eHRfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCQlyZXR1cm4gZXJy
OwogCiAJLyogUHJlYWxsb2NhdGUgdHJhY2tpbmcgbm9kZXMgKi8KLQlpZiAoIWk5MTVfZ2VtX2Nv
bnRleHRfaXNfa2VybmVsKGNlLT5nZW1fY29udGV4dCkpIHsKKwlpZiAoIWludGVsX2NvbnRleHRf
aXNfYmFycmllcihjZSkpIHsKIAkJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZV9wcmVhbGxvY2F0
ZV9iYXJyaWVyKCZjZS0+YWN0aXZlLAogCQkJCQkJCSAgICAgIGNlLT5lbmdpbmUpOwogCQlpZiAo
ZXJyKSB7CkBAIC0yMTksMzMgKzIxNSwxOSBAQCB2b2lkIGludGVsX2NvbnRleHRfYWN0aXZlX3Jl
bGVhc2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCiB2b2lkCiBpbnRlbF9jb250ZXh0X2lu
aXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAotCQkgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAogCQkgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0Jc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07Ci0KIAlHRU1fQlVHX09OKCFlbmdpbmUtPmNvcHMpOwor
CUdFTV9CVUdfT04oIWVuZ2luZS0+Z3QtPnZtKTsKIAogCWtyZWZfaW5pdCgmY2UtPnJlZik7CiAK
LQljZS0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JcmN1X3JlYWRfbG9jaygpOwotCXZtID0gcmN1X2Rl
cmVmZXJlbmNlKGN0eC0+dm0pOwotCWlmICh2bSkKLQkJY2UtPnZtID0gaTkxNV92bV9nZXQodm0p
OwotCWVsc2UKLQkJY2UtPnZtID0gaTkxNV92bV9nZXQoJmVuZ2luZS0+Z3QtPmdndHQtPnZtKTsK
LQlyY3VfcmVhZF91bmxvY2soKTsKLQlpZiAoY3R4LT50aW1lbGluZSkKLQkJY2UtPnRpbWVsaW5l
ID0gaW50ZWxfdGltZWxpbmVfZ2V0KGN0eC0+dGltZWxpbmUpOwotCWlmIChjdHgtPnNjaGVkLnBy
aW9yaXR5ID49IEk5MTVfUFJJT1JJVFlfTk9STUFMICYmCi0JICAgIGludGVsX2VuZ2luZV9oYXNf
c2VtYXBob3JlcyhlbmdpbmUpKQotCQlfX3NldF9iaXQoQ09OVEVYVF9VU0VfU0VNQVBIT1JFUywg
JmNlLT5mbGFncyk7Ci0KIAljZS0+ZW5naW5lID0gZW5naW5lOwogCWNlLT5vcHMgPSBlbmdpbmUt
PmNvcHM7CiAJY2UtPnNzZXUgPSBlbmdpbmUtPnNzZXU7Ci0JY2UtPnJpbmcgPSBfX2ludGVsX2Nv
bnRleHRfcmluZ19zaXplKFNaXzE2Syk7CisJY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmlu
Z19zaXplKFNaXzRLKTsKKworCWNlLT52bSA9IGk5MTVfdm1fZ2V0KGVuZ2luZS0+Z3QtPnZtKTsK
IAogCUlOSVRfTElTVF9IRUFEKCZjZS0+c2lnbmFsX2xpbmspOwogCUlOSVRfTElTVF9IRUFEKCZj
ZS0+c2lnbmFscyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9j
b250ZXh0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgKaW5kZXgg
ZDdiNjY3YTI2ZTA4Li44MGQ0YzJhY2M3MjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2NvbnRleHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0LmgKQEAgLTE4LDEzICsxOCwxMSBAQAogI2luY2x1ZGUgImludGVsX3RpbWVsaW5l
X3R5cGVzLmgiCiAKIHZvaWQgaW50ZWxfY29udGV4dF9pbml0KHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSwKLQkJCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpOwogdm9pZCBpbnRlbF9jb250ZXh0X2Zpbmkoc3RydWN0IGludGVs
X2NvbnRleHQgKmNlKTsKIAogc3RydWN0IGludGVsX2NvbnRleHQgKgotaW50ZWxfY29udGV4dF9j
cmVhdGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJICAgICBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpOworaW50ZWxfY29udGV4dF9jcmVhdGUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKTsKIAogdm9pZCBpbnRlbF9jb250ZXh0X2ZyZWUoc3RydWN0IGludGVs
X2NvbnRleHQgKmNlKTsKIApAQCAtMTU1LDYgKzE1MywxMSBAQCBzdGF0aWMgaW5saW5lIHN0cnVj
dCBpbnRlbF9yaW5nICpfX2ludGVsX2NvbnRleHRfcmluZ19zaXplKHU2NCBzeikKIAlyZXR1cm4g
dTY0X3RvX3B0cihzdHJ1Y3QgaW50ZWxfcmluZywgc3opOwogfQogCitzdGF0aWMgaW5saW5lIGJv
b2wgaW50ZWxfY29udGV4dF9pc19iYXJyaWVyKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZSkKK3sKKwlyZXR1cm4gdGVzdF9iaXQoQ09OVEVYVF9CQVJSSUVSX0JJVCwgJmNlLT5mbGFncyk7
Cit9CisKIHN0YXRpYyBpbmxpbmUgYm9vbCBpbnRlbF9jb250ZXh0X3VzZV9zZW1hcGhvcmVzKGNv
bnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKIAlyZXR1cm4gdGVzdF9iaXQoQ09OVEVY
VF9VU0VfU0VNQVBIT1JFUywgJmNlLT5mbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0X3R5cGVzLmgKaW5kZXggMjY0YzFlZmRlNzcyLi5iYTQ2YzM2YTg4YTIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5cGVzLmgKQEAg
LTU0LDExICs1NCwxMiBAQCBzdHJ1Y3QgaW50ZWxfY29udGV4dCB7CiAJc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0aW1lbGluZTsKIAogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0jZGVmaW5lIENPTlRF
WFRfQUxMT0NfQklUCQkwCi0jZGVmaW5lIENPTlRFWFRfVVNFX1NFTUFQSE9SRVMJCTEKLSNkZWZp
bmUgQ09OVEVYVF9CQU5ORUQJCQkyCi0jZGVmaW5lIENPTlRFWFRfRk9SQ0VfU0lOR0xFX1NVQk1J
U1NJT04JMwotI2RlZmluZSBDT05URVhUX05PUFJFRU1QVAkJNAorI2RlZmluZSBDT05URVhUX0JB
UlJJRVJfQklUCQkwCisjZGVmaW5lIENPTlRFWFRfQUxMT0NfQklUCQkxCisjZGVmaW5lIENPTlRF
WFRfVVNFX1NFTUFQSE9SRVMJCTIKKyNkZWZpbmUgQ09OVEVYVF9CQU5ORUQJCQkzCisjZGVmaW5l
IENPTlRFWFRfRk9SQ0VfU0lOR0xFX1NVQk1JU1NJT04JNAorI2RlZmluZSBDT05URVhUX05PUFJF
RU1QVAkJNQogCiAJdTMyICpscmNfcmVnX3N0YXRlOwogCXU2NCBscmNfZGVzYzsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKaW5kZXggN2Y3OTc0MWFkNjg0Li5hMjdi
MjI5MTRmYjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCkBA
IC03NTcsMTEgKzc1NywxMSBAQCBjcmVhdGVfa2VybmVsX2NvbnRleHQoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyOwog
Ci0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmk5MTUtPmtlcm5lbF9jb250ZXh0
LCBlbmdpbmUpOworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNf
RVJSKGNlKSkKIAkJcmV0dXJuIGNlOwogCi0JY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmlu
Z19zaXplKFNaXzRLKTsKKwlfX3NldF9iaXQoQ09OVEVYVF9CQVJSSUVSX0JJVCwgJmNlLT5mbGFn
cyk7CiAKIAllcnIgPSBpbnRlbF9jb250ZXh0X3BpbihjZSk7CiAJaWYgKGVycikgewpAQCAtNzk4
LDYgKzc5OCwxMiBAQCBpbnQgaW50ZWxfZW5naW5lX2luaXRfY29tbW9uKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKIAogCWVuZ2luZS0+c2V0X2RlZmF1bHRfc3VibWlzc2lvbihlbmdp
bmUpOwogCisJcmV0ID0gbWVhc3VyZV9icmVhZGNydW1iX2R3KGVuZ2luZSk7CisJaWYgKHJldCA8
IDApCisJCXJldHVybiByZXQ7CisKKwllbmdpbmUtPmVtaXRfZmluaV9icmVhZGNydW1iX2R3ID0g
cmV0OworCiAJLyoKIAkgKiBXZSBtYXkgbmVlZCB0byBkbyB0aGluZ3Mgd2l0aCB0aGUgc2hyaW5r
ZXIgd2hpY2gKIAkgKiByZXF1aXJlIHVzIHRvIGltbWVkaWF0ZWx5IHN3aXRjaCBiYWNrIHRvIHRo
ZSBkZWZhdWx0CkBAIC04MTIsMTggKzgxOCw3IEBAIGludCBpbnRlbF9lbmdpbmVfaW5pdF9jb21t
b24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJZW5naW5lLT5rZXJuZWxfY29u
dGV4dCA9IGNlOwogCi0JcmV0ID0gbWVhc3VyZV9icmVhZGNydW1iX2R3KGVuZ2luZSk7Ci0JaWYg
KHJldCA8IDApCi0JCWdvdG8gZXJyX3VucGluOwotCi0JZW5naW5lLT5lbWl0X2ZpbmlfYnJlYWRj
cnVtYl9kdyA9IHJldDsKLQogCXJldHVybiAwOwotCi1lcnJfdW5waW46Ci0JaW50ZWxfY29udGV4
dF91bnBpbihjZSk7Ci0JaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCXJldHVybiByZXQ7CiB9CiAK
IC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXggYzM5YjIxYzhkMzI4Li40YzA3
ODI0NzgyNWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwpAQCAtNzQsNyArNzQsNiBA
QCBpbnQgaW50ZWxfZ3RfaW5pdF9odyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCXN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7CiAJaW50IHJldDsKIAotCUJVR19PTighaTkx
NS0+a2VybmVsX2NvbnRleHQpOwogCXJldCA9IGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKGd0
KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAtMzY1LDYgKzM2NCwxNCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9ndF9maW5pX3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpndCkKIAlpOTE1X3Zt
YV91bnBpbl9hbmRfcmVsZWFzZSgmZ3QtPnNjcmF0Y2gsIDApOwogfQogCitzdGF0aWMgc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqa2VybmVsX3ZtKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJ
aWYgKElOVEVMX1BQR1RUKGd0LT5pOTE1KSA+IElOVEVMX1BQR1RUX0FMSUFTSU5HKQorCQlyZXR1
cm4gJmk5MTVfcHBndHRfY3JlYXRlKGd0LT5pOTE1KS0+dm07CisJZWxzZQorCQlyZXR1cm4gaTkx
NV92bV9nZXQoJmd0LT5nZ3R0LT52bSk7Cit9CisKIGludCBpbnRlbF9ndF9pbml0KHN0cnVjdCBp
bnRlbF9ndCAqZ3QpCiB7CiAJaW50IGVycjsKQEAgLTM3NSw3ICszODIsMTcgQEAgaW50IGludGVs
X2d0X2luaXQoc3RydWN0IGludGVsX2d0ICpndCkKIAogCWludGVsX2d0X3BtX2luaXQoZ3QpOwog
CisJZ3QtPnZtID0ga2VybmVsX3ZtKGd0KTsKKwlpZiAoIWd0LT52bSkgeworCQllcnIgPSAtRU5P
TUVNOworCQlnb3RvIGVycl9zY3JhdGNoOworCX0KKwogCXJldHVybiAwOworCitlcnJfc2NyYXRj
aDoKKwlpbnRlbF9ndF9maW5pX3NjcmF0Y2goZ3QpOworCXJldHVybiBlcnI7CiB9CiAKIHZvaWQg
aW50ZWxfZ3RfZHJpdmVyX3JlbW92ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQpAQCAtMzkwLDYgKzQw
NywxMiBAQCB2b2lkIGludGVsX2d0X2RyaXZlcl91bnJlZ2lzdGVyKHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCiAKIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGludGVsX2d0ICpndCkK
IHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKworCXZtID0gZmV0Y2hfYW5kX3pl
cm8oJmd0LT52bSk7CisJaWYgKHZtKSAvKiBGSVhNRSBiZWluZyBjYWxsZWQgdHdpY2Ugb24gZXJy
b3IgcGF0aHMgOiggKi8KKwkJaTkxNV92bV9wdXQodm0pOworCiAJaW50ZWxfZ3RfcG1fZmluaShn
dCk7CiAJaW50ZWxfZ3RfZmluaV9zY3JhdGNoKGd0KTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF90eXBlcy5oCmluZGV4IGQ0ZTE0ZGJkMTcyZS4uOTY4OTBkZDEyYjVmIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKQEAgLTkwLDYgKzkwLDEzIEBA
IHN0cnVjdCBpbnRlbF9ndCB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lW0k5MTVf
TlVNX0VOR0lORVNdOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZV9jbGFzc1tNQVhf
RU5HSU5FX0NMQVNTICsgMV0KIAkJCQkJICAgIFtNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07CisK
KwkvKgorCSAqIERlZmF1bHQgYWRkcmVzcyBzcGFjZSAoZWl0aGVyIEdHVFQgb3IgcHBHVFQgZGVw
ZW5kaW5nIG9uIGFyY2gpLgorCSAqCisJICogUmVzZXJ2ZWQgZm9yIGV4Y2x1c2l2ZSB1c2UgYnkg
dGhlIGtlcm5lbC4KKwkgKi8KKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIH07CiAK
IGVudW0gaW50ZWxfZ3Rfc2NyYXRjaF9maWVsZCB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xy
Yy5jCmluZGV4IDc3ZWZkYzNhZjRhYy4uODRiNDUyZDE3ZWM5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYwpAQCAtMTMzLDEyICsxMzMsMTEgQEAKICAqLwogI2luY2x1ZGUgPGxpbnV4
L2ludGVycnVwdC5oPgogCi0jaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCIKLQogI2lu
Y2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9wZXJmLmgiCiAjaW5jbHVkZSAiaTkx
NV90cmFjZS5oIgogI2luY2x1ZGUgImk5MTVfdmdwdS5oIgorI2luY2x1ZGUgImludGVsX2NvbnRl
eHQuaCIKICNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9ndC5o
IgogI2luY2x1ZGUgImludGVsX2d0X3BtLmgiCkBAIC0xMjk2LDcgKzEyOTUsOCBAQCBhc3NlcnRf
cGVuZGluZ192YWxpZChjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZXhlY2xp
c3RzLAogCQlpZiAoaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCiAJCQljb250aW51ZTsKIAot
CQlpZiAoaTkxNV9hY3RpdmVfaXNfaWRsZSgmY2UtPmFjdGl2ZSkgJiYgY2UtPmdlbV9jb250ZXh0
KSB7CisJCWlmIChpOTE1X2FjdGl2ZV9pc19pZGxlKCZjZS0+YWN0aXZlKSAmJgorCQkgICAgIWlu
dGVsX2NvbnRleHRfaXNfYmFycmllcihjZSkpIHsKIAkJCUdFTV9UUkFDRV9FUlIoIkluYWN0aXZl
IGNvbnRleHQ6JWxseCBpbiBwZW5kaW5nWyV6ZF1cbiIsCiAJCQkJICAgICAgY2UtPnRpbWVsaW5l
LT5mZW5jZV9jb250ZXh0LAogCQkJCSAgICAgIHBvcnQgLSBleGVjbGlzdHMtPnBlbmRpbmcpOwpA
QCAtNDQyNyw4ICs0NDI3LDcgQEAgdmlydHVhbF9ib25kX2V4ZWN1dGUoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEsIHN0cnVjdCBkbWFfZmVuY2UgKnNpZ25hbCkKIH0KIAogc3RydWN0IGludGVsX2Nv
bnRleHQgKgotaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsCi0JCQkgICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdz
LAoraW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KipzaWJsaW5ncywKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgY291bnQpCiB7CiAJc3RydWN0IHZp
cnR1YWxfZW5naW5lICp2ZTsKQEAgLTQ0MzksMTMgKzQ0MzgsMTMgQEAgaW50ZWxfZXhlY2xpc3Rz
X2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCXJldHVybiBF
UlJfUFRSKC1FSU5WQUwpOwogCiAJaWYgKGNvdW50ID09IDEpCi0JCXJldHVybiBpbnRlbF9jb250
ZXh0X2NyZWF0ZShjdHgsIHNpYmxpbmdzWzBdKTsKKwkJcmV0dXJuIGludGVsX2NvbnRleHRfY3Jl
YXRlKHNpYmxpbmdzWzBdKTsKIAogCXZlID0ga3phbGxvYyhzdHJ1Y3Rfc2l6ZSh2ZSwgc2libGlu
Z3MsIGNvdW50KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCF2ZSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVO
T01FTSk7CiAKLQl2ZS0+YmFzZS5pOTE1ID0gY3R4LT5pOTE1OworCXZlLT5iYXNlLmk5MTUgPSBz
aWJsaW5nc1swXS0+aTkxNTsKIAl2ZS0+YmFzZS5ndCA9IHNpYmxpbmdzWzBdLT5ndDsKIAl2ZS0+
YmFzZS51bmNvcmUgPSBzaWJsaW5nc1swXS0+dW5jb3JlOwogCXZlLT5iYXNlLmlkID0gLTE7CkBA
IC00NDg4LDcgKzQ0ODcsNyBAQCBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJICAgICB2aXJ0dWFsX3N1Ym1pc3Npb25fdGFza2xl
dCwKIAkJICAgICAodW5zaWduZWQgbG9uZyl2ZSk7CiAKLQlpbnRlbF9jb250ZXh0X2luaXQoJnZl
LT5jb250ZXh0LCBjdHgsICZ2ZS0+YmFzZSk7CisJaW50ZWxfY29udGV4dF9pbml0KCZ2ZS0+Y29u
dGV4dCwgJnZlLT5iYXNlKTsKIAogCWZvciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CiAJCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNpYmxpbmcgPSBzaWJsaW5nc1tuXTsKQEAgLTQ1NjksMTQg
KzQ1NjgsMTIgQEAgaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgsCiB9CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2V4ZWNs
aXN0c19jbG9uZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkgICAg
ICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpCitpbnRlbF9leGVjbGlzdHNfY2xvbmVfdmly
dHVhbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpCiB7CiAJc3RydWN0IHZpcnR1YWxfZW5n
aW5lICpzZSA9IHRvX3ZpcnR1YWxfZW5naW5lKHNyYyk7CiAJc3RydWN0IGludGVsX2NvbnRleHQg
KmRzdDsKIAotCWRzdCA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHgsCi0JCQkJ
CSAgICAgc2UtPnNpYmxpbmdzLAorCWRzdCA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVh
bChzZS0+c2libGluZ3MsCiAJCQkJCSAgICAgc2UtPm51bV9zaWJsaW5ncyk7CiAJaWYgKElTX0VS
Uihkc3QpKQogCQlyZXR1cm4gZHN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfbHJjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuaAppbmRl
eCAwNDUxMWQ4ZWJkYzEuLjA4MTUyMWYxN2M3NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfbHJjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
bHJjLmgKQEAgLTExMSwxMyArMTExLDExIEBAIHZvaWQgaW50ZWxfZXhlY2xpc3RzX3Nob3dfcmVx
dWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJCSAgIHVuc2lnbmVkIGlu
dCBtYXgpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9leGVjbGlzdHNfY3JlYXRl
X3ZpcnR1YWwoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJCSAgICAgICBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCitpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1
YWwoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAogCQkJICAgICAgIHVuc2lnbmVk
IGludCBjb3VudCk7CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2V4ZWNsaXN0c19j
bG9uZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkgICAgICBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpOworaW50ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1YWwo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKTsKIAogaW50IGludGVsX3ZpcnR1YWxfZW5naW5l
X2F0dGFjaF9ib25kKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkgICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKm1hc3RlciwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yZXNldC5jCmluZGV4IDBkNGM2MTBhOTBiNy4uOWVjZjI0NDM5ZmRlIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTUyLDkgKzUyLDggQEAgc3RhdGljIHZvaWQg
ZW5naW5lX3NraXBfY29udGV4dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJCWk5MTVfcmVx
dWVzdF9za2lwKHJxLCAtRUlPKTsKIH0KIAotc3RhdGljIHZvaWQgY2xpZW50X21hcmtfZ3VpbHR5
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBib29sIGJhbm5lZCkKK3N0YXRpYyB2b2lkIGNsaWVu
dF9tYXJrX2d1aWx0eShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBib29sIGJhbm5lZCkK
IHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gcnEtPmNvbnRleHQtPmdlbV9jb250
ZXh0OwogCXN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiA9IGN0eC0+Zmls
ZV9wcml2OwogCXVuc2lnbmVkIGxvbmcgcHJldl9oYW5nOwogCXVuc2lnbmVkIGludCBzY29yZTsK
QEAgLTgxLDExICs4MCwxNSBAQCBzdGF0aWMgdm9pZCBjbGllbnRfbWFya19ndWlsdHkoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEsIGJvb2wgYmFubmVkKQogCiBzdGF0aWMgYm9vbCBtYXJrX2d1aWx0
eShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4ID0gcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0OworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHg7CiAJdW5zaWduZWQgbG9uZyBwcmV2X2hhbmc7CiAJYm9vbCBiYW5uZWQ7CiAJaW50IGk7
CiAKKwljdHggPSBycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQ7CisJaWYgKCFjdHgpCisJCXJldHVy
biBmYWxzZTsKKwogCWlmIChpOTE1X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKSB7CiAJCWlu
dGVsX2NvbnRleHRfc2V0X2Jhbm5lZChycS0+Y29udGV4dCk7CiAJCXJldHVybiB0cnVlOwpAQCAt
MTE3LDE0ICsxMjAsMTUgQEAgc3RhdGljIGJvb2wgbWFya19ndWlsdHkoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCiAJCWludGVsX2NvbnRleHRfc2V0X2Jhbm5lZChycS0+Y29udGV4dCk7CiAJfQog
Ci0JY2xpZW50X21hcmtfZ3VpbHR5KHJxLCBiYW5uZWQpOworCWNsaWVudF9tYXJrX2d1aWx0eShj
dHgsIGJhbm5lZCk7CiAKIAlyZXR1cm4gYmFubmVkOwogfQogCiBzdGF0aWMgdm9pZCBtYXJrX2lu
bm9jZW50KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCWF0b21pY19pbmMoJnJxLT5jb250
ZXh0LT5nZW1fY29udGV4dC0+YWN0aXZlX2NvdW50KTsKKwlpZiAocnEtPmNvbnRleHQtPmdlbV9j
b250ZXh0KQorCQlhdG9taWNfaW5jKCZycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQtPmFjdGl2ZV9j
b3VudCk7CiB9CiAKIHZvaWQgX19pOTE1X3JlcXVlc3RfcmVzZXQoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEsIGJvb2wgZ3VpbHR5KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfcmluZ19zdWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
aW5nX3N1Ym1pc3Npb24uYwppbmRleCAxYzJmM2MzYTg4NDAuLjZkZGZlOGE4NmRiZSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMKQEAgLTE1
NTgsNyArMTU1OCw3IEBAIHN0YXRpYyBpbnQgcmVtYXBfbDMoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpCiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJxLT5jb250ZXh0LT5nZW1fY29u
dGV4dDsKIAlpbnQgaSwgZXJyOwogCi0JaWYgKCFjdHgtPnJlbWFwX3NsaWNlKQorCWlmICghY3R4
IHx8ICFjdHgtPnJlbWFwX3NsaWNlKQogCQlyZXR1cm4gMDsKIAogCWZvciAoaSA9IDA7IGkgPCBN
QVhfTDNfU0xJQ0VTOyBpKyspIHsKQEAgLTE2MDEsNyArMTYwMSw3IEBAIHN0YXRpYyBpbnQgc3dp
dGNoX2NvbnRleHQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCSAqIGlzIHB1cmVseSB1c2Vk
IGZvciBmbHVzaGluZyB1c2VyIGNvbnRleHRzLgogCQkgKi8KIAkJaHdfZmxhZ3MgPSAwOwotCQlp
ZiAoaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwocnEtPmNvbnRleHQtPmdlbV9jb250ZXh0KSkK
KwkJaWYgKCFycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQpCiAJCQlod19mbGFncyA9IE1JX1JFU1RP
UkVfSU5ISUJJVDsKIAogCQlyZXQgPSBtaV9zZXRfY29udGV4dChycSwgaHdfZmxhZ3MpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCmluZGV4IDE0YmE2Y2ViOTE3
Ny4uYjVlZjk1YTk5MzU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29u
dGV4dC5jCkBAIC02NywxNSArNjcsMTQgQEAgc3RhdGljIGludCBjb250ZXh0X3N5bmMoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgX19saXZl
X2NvbnRleHRfc2l6ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCQkgICAgICAg
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lKQorc3RhdGljIGludCBfX2xpdmVfY29udGV4
dF9zaXplKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJdm9pZCAqdmFkZHI7CiAJ
aW50IGVycjsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJ
Y2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIoY2UpKQogCQly
ZXR1cm4gUFRSX0VSUihjZSk7CiAKQEAgLTE0Myw3ICsxNDIsNiBAQCBzdGF0aWMgaW50IGxpdmVf
Y29udGV4dF9zaXplKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwog
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqZml4bWU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9IDA7CiAKQEAg
LTE1MiwxMCArMTUwLDYgQEAgc3RhdGljIGludCBsaXZlX2NvbnRleHRfc2l6ZSh2b2lkICphcmcp
CiAJICogSFcgdHJpZXMgdG8gd3JpdGUgcGFzdCB0aGUgZW5kIG9mIG9uZS4KIAkgKi8KIAotCWZp
eG1lID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmIChJU19FUlIoZml4bWUpKQotCQly
ZXR1cm4gUFRSX0VSUihmaXhtZSk7Ci0KIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQp
IHsKIAkJc3RydWN0IHsKIAkJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpzdGF0ZTsKQEAg
LTE4MCw3ICsxNzQsNyBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykK
IAkJLyogT3ZlcmxhcHMgd2l0aCB0aGUgZXhlY2xpc3RzIHJlZHpvbmUgKi8KIAkJZW5naW5lLT5j
b250ZXh0X3NpemUgKz0gSTkxNV9HVFRfUEFHRV9TSVpFOwogCi0JCWVyciA9IF9fbGl2ZV9jb250
ZXh0X3NpemUoZW5naW5lLCBmaXhtZSk7CisJCWVyciA9IF9fbGl2ZV9jb250ZXh0X3NpemUoZW5n
aW5lKTsKIAogCQllbmdpbmUtPmNvbnRleHRfc2l6ZSAtPSBJOTE1X0dUVF9QQUdFX1NJWkU7CiAK
QEAgLTE5MywxMiArMTg3LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAq
YXJnKQogCQkJYnJlYWs7CiAJfQogCi0Ja2VybmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwogCXJl
dHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgX19saXZlX2FjdGl2ZV9jb250ZXh0KHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCQkgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZp
eG1lKQorc3RhdGljIGludCBfX2xpdmVfYWN0aXZlX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgcGFzczsK
QEAgLTIyMyw3ICsyMTUsNyBAQCBzdGF0aWMgaW50IF9fbGl2ZV9hY3RpdmVfY29udGV4dChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCWNl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250
ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gUFRSX0VSUihj
ZSk7CiAKQEAgLTI4NywyMyArMjc5LDExIEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4
dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lOwog
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCXN0cnVjdCBmaWxlICpmaWxlOwogCWludCBlcnIg
PSAwOwogCi0JZmlsZSA9IG1vY2tfZmlsZShndC0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaWxlKSkK
LQkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7Ci0KLQlmaXhtZSA9IGxpdmVfY29udGV4dChndC0+aTkx
NSwgZmlsZSk7Ci0JaWYgKElTX0VSUihmaXhtZSkpIHsKLQkJZXJyID0gUFRSX0VSUihmaXhtZSk7
Ci0JCWdvdG8gb3V0X2ZpbGU7Ci0JfQotCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlk
KSB7Ci0JCWVyciA9IF9fbGl2ZV9hY3RpdmVfY29udGV4dChlbmdpbmUsIGZpeG1lKTsKKwkJZXJy
ID0gX19saXZlX2FjdGl2ZV9jb250ZXh0KGVuZ2luZSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsK
IApAQCAtMzEyLDggKzI5Miw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lk
ICphcmcpCiAJCQlicmVhazsKIAl9CiAKLW91dF9maWxlOgotCWZwdXQoZmlsZSk7CiAJcmV0dXJu
IGVycjsKIH0KIApAQCAtMzQ1LDggKzMyMyw3IEBAIHN0YXRpYyBpbnQgX19yZW1vdGVfc3luYyhz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpyZW1vdGUpCiAJ
cmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBfX2xpdmVfcmVtb3RlX2NvbnRleHQoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJCSBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Zml4bWUpCitzdGF0aWMgaW50IF9fbGl2ZV9yZW1vdGVfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmxvY2FsLCAqcmVtb3Rl
OwogCWludCBwYXNzOwpAQCAtMzYwLDExICszMzcsMTEgQEAgc3RhdGljIGludCBfX2xpdmVfcmVt
b3RlX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCSAqIGNsb2JiZXIg
dGhlIGlkbGUtYmFycmllci4KIAkgKi8KIAotCXJlbW90ZSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGZpeG1lLCBlbmdpbmUpOworCXJlbW90ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7
CiAJaWYgKElTX0VSUihyZW1vdGUpKQogCQlyZXR1cm4gUFRSX0VSUihyZW1vdGUpOwogCi0JbG9j
YWwgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5lKTsKKwlsb2NhbCA9IGludGVs
X2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihsb2NhbCkpIHsKIAkJZXJyID0g
UFRSX0VSUihsb2NhbCk7CiAJCWdvdG8gZXJyX3JlbW90ZTsKQEAgLTM5NywyMyArMzc0LDExIEBA
IHN0YXRpYyBpbnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGlu
dGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwot
CXN0cnVjdCBmaWxlICpmaWxlOwogCWludCBlcnIgPSAwOwogCi0JZmlsZSA9IG1vY2tfZmlsZShn
dC0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaWxlKSkKLQkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7Ci0K
LQlmaXhtZSA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYgKElTX0VSUihmaXht
ZSkpIHsKLQkJZXJyID0gUFRSX0VSUihmaXhtZSk7Ci0JCWdvdG8gb3V0X2ZpbGU7Ci0JfQotCiAJ
Zm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVyciA9IF9fbGl2ZV9yZW1vdGVf
Y29udGV4dChlbmdpbmUsIGZpeG1lKTsKKwkJZXJyID0gX19saXZlX3JlbW90ZV9jb250ZXh0KGVu
Z2luZSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIApAQCAtNDIyLDggKzM4Nyw2IEBAIHN0YXRp
YyBpbnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLW91
dF9maWxlOgotCWZwdXQoZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2hlYXJ0YmVhdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2hlYXJ0YmVhdC5jCmluZGV4IGY2NjVh
MGUyM2M2MS4uMmZlZWFkOWI0NDdhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfZW5naW5lX2hlYXJ0YmVhdC5jCkBAIC0xNzMsOCArMTczLDcgQEAgc3RhdGlj
IGludCBfX2xpdmVfaGVhcnRiZWF0X2Zhc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
KQogCWludCBlcnI7CiAJaW50IGk7CiAKLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQtPmdlbV9jb250ZXh0LAotCQkJCSAgZW5naW5lKTsKKwljZSA9IGlu
dGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihjZSkpCiAJCXJldHVybiBQ
VFJfRVJSKGNlKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hl
Y2suYwppbmRleCBkMTU1YzkzNzQ0NTMuLmZmMmQ4YWYyODJhNiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTM3NywzNiArMzc3LDMwIEBAIHN0
YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJc3RydWN0IGludGVsX2d0ICpndCA9
IGFyZzsKIAlzdHJ1Y3QgaTkxNV9ncHVfZXJyb3IgKmdsb2JhbCA9ICZndC0+aTkxNS0+Z3B1X2Vy
cm9yOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4OwogCXVuc2lnbmVkIGludCByZXNldF9jb3VudCwgY291bnQ7CiAJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7CiAJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwotCXN0cnVjdCBmaWxl
ICpmaWxlOwogCWludCBlcnIgPSAwOwogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVzZXQgZHVy
aW5nIG5vbi11c2VyIHBvcnRpb25zIG9mIHJlcXVlc3RzICovCiAKLQlmaWxlID0gbW9ja19maWxl
KGd0LT5pOTE1KTsKLQlpZiAoSVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsK
LQotCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYgKElTX0VSUihjdHgp
KSB7Ci0JCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9nZW1f
Y29udGV4dF9jbGVhcl9iYW5uYWJsZShjdHgpOwogCXJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9j
b3VudChnbG9iYWwpOwogCWNvdW50ID0gMDsKIAlkbyB7CiAJCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGd0LCBpZCkgeworCQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQkJaW50IGk7CiAK
KwkJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwkJCWlmIChJU19FUlIoY2Up
KSB7CisJCQkJZXJyID0gUFRSX0VSUihjZSk7CisJCQkJYnJlYWs7CisJCQl9CisKIAkJCWZvciAo
aSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAJCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKLQkJ
CQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5lKTsKKwkJCQlycSA9IGludGVsX2Nv
bnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwogCQkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJCWVy
ciA9IFBUUl9FUlIocnEpOwogCQkJCQlicmVhazsKQEAgLTQxNCw2ICs0MDgsOCBAQCBzdGF0aWMg
aW50IGlndF9yZXNldF9ub3Aodm9pZCAqYXJnKQogCiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7
CiAJCQl9CisKKwkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJfQogCiAJCWlndF9nbG9iYWxf
cmVzZXRfbG9jayhndCk7CkBAIC00MzcsMTAgKzQzMyw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0
X25vcCh2b2lkICphcmcpCiAJfSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3RpbWUp
KTsKIAlwcl9pbmZvKCIlczogJWQgcmVzZXRzXG4iLCBfX2Z1bmNfXywgY291bnQpOwogCi0JZXJy
ID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwotb3V0OgotCWZwdXQoZmlsZSk7Ci0JaWYgKGlu
dGVsX2d0X2lzX3dlZGdlZChndCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJ
ZXJyID0gLUVJTzsKIAlyZXR1cm4gZXJyOwogfQpAQCAtNDUwLDMxICs0NDMsMjIgQEAgc3RhdGlj
IGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJc3RydWN0IGludGVsX2d0ICpn
dCA9IGFyZzsKIAlzdHJ1Y3QgaTkxNV9ncHVfZXJyb3IgKmdsb2JhbCA9ICZndC0+aTkxNS0+Z3B1
X2Vycm9yOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCXN0cnVjdCBmaWxl
ICpmaWxlOwotCWludCBlcnIgPSAwOwogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gZW5naW5lLXJl
c2V0IGR1cmluZyBub24tdXNlciBwb3J0aW9ucyAqLwogCiAJaWYgKCFpbnRlbF9oYXNfcmVzZXRf
ZW5naW5lKGd0KSkKIAkJcmV0dXJuIDA7CiAKLQlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsK
LQlpZiAoSVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKLQotCWN0eCA9IGxp
dmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCWVyciA9
IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9nZW1fY29udGV4dF9jbGVh
cl9iYW5uYWJsZShjdHgpOwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQl1
bnNpZ25lZCBpbnQgcmVzZXRfY291bnQsIHJlc2V0X2VuZ2luZV9jb3VudDsKLQkJdW5zaWduZWQg
aW50IGNvdW50OworCQl1bnNpZ25lZCBpbnQgcmVzZXRfY291bnQsIHJlc2V0X2VuZ2luZV9jb3Vu
dCwgY291bnQ7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAkJSUdUX1RJTUVPVVQoZW5k
X3RpbWUpOworCQlpbnQgZXJyOworCisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5l
KTsKKwkJaWYgKElTX0VSUihjZSkpCisJCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAKIAkJcmVzZXRf
Y291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KGdsb2JhbCk7CiAJCXJlc2V0X2VuZ2luZV9jb3VudCA9
IGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KGdsb2JhbCwgZW5naW5lKTsKQEAgLTQ5NCw3ICs0Nzgs
NyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAkJCWZvciAo
aSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAJCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKLQkJ
CQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5lKTsKKwkJCQlycSA9IGludGVsX2Nv
bnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwogCQkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJCWVy
ciA9IFBUUl9FUlIocnEpOwogCQkJCQlicmVhazsKQEAgLTUyNSwyMCArNTA5LDE0IEBAIHN0YXRp
YyBpbnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUodm9pZCAqYXJnKQogCQljbGVhcl9iaXQoSTkxNV9S
RVNFVF9FTkdJTkUgKyBpZCwgJmd0LT5yZXNldC5mbGFncyk7CiAJCXByX2luZm8oIiVzKCVzKTog
JWQgcmVzZXRzXG4iLCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lLCBjb3VudCk7CiAKKwkJaW50ZWxf
Y29udGV4dF9wdXQoY2UpOworCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQorCQkJZXJy
ID0gLUVJTzsKIAkJaWYgKGVycikKLQkJCWJyZWFrOwotCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0
KGd0LT5pOTE1KTsKLQkJaWYgKGVycikKLQkJCWJyZWFrOworCQkJcmV0dXJuIGVycjsKIAl9CiAK
LQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7Ci1vdXQ6Ci0JZnB1dChmaWxlKTsKLQlp
ZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKLQkJZXJyID0gLUVJTzsKLQlyZXR1cm4gZXJyOwor
CXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50
ZWxfZ3QgKmd0LCBib29sIGFjdGl2ZSkKQEAgLTY5OSw0MyArNjc3LDQzIEBAIHN0YXRpYyBpbnQg
YWN0aXZlX2VuZ2luZSh2b2lkICpkYXRhKQogCXN0cnVjdCBhY3RpdmVfZW5naW5lICphcmcgPSBk
YXRhOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IGFyZy0+ZW5naW5lOwogCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxWzhdID0ge307Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eFtBUlJBWV9TSVpFKHJxKV07Ci0JdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7Ci0Jc3RydWN0
IGZpbGUgKmZpbGU7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlW0FSUkFZX1NJWkUocnEpXTsK
Kwl1bnNpZ25lZCBsb25nIGNvdW50OwogCWludCBlcnIgPSAwOwogCi0JZmlsZSA9IG1vY2tfZmls
ZShlbmdpbmUtPmk5MTUpOwotCWlmIChJU19FUlIoZmlsZSkpCi0JCXJldHVybiBQVFJfRVJSKGZp
bGUpOwotCi0JZm9yIChjb3VudCA9IDA7IGNvdW50IDwgQVJSQVlfU0laRShjdHgpOyBjb3VudCsr
KSB7Ci0JCWN0eFtjb3VudF0gPSBsaXZlX2NvbnRleHQoZW5naW5lLT5pOTE1LCBmaWxlKTsKLQkJ
aWYgKElTX0VSUihjdHhbY291bnRdKSkgewotCQkJZXJyID0gUFRSX0VSUihjdHhbY291bnRdKTsK
Kwlmb3IgKGNvdW50ID0gMDsgY291bnQgPCBBUlJBWV9TSVpFKGNlKTsgY291bnQrKykgeworCQlj
ZVtjb3VudF0gPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCQlpZiAoSVNfRVJSKGNl
W2NvdW50XSkpIHsKKwkJCWVyciA9IFBUUl9FUlIoY2VbY291bnRdKTsKIAkJCXdoaWxlICgtLWNv
dW50KQotCQkJCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGN0eFtjb3VudF0pOwotCQkJZ290byBlcnJf
ZmlsZTsKKwkJCQlpbnRlbF9jb250ZXh0X3B1dChjZVtjb3VudF0pOworCQkJcmV0dXJuIGVycjsK
IAkJfQogCX0KIAorCWNvdW50ID0gMDsKIAl3aGlsZSAoIWt0aHJlYWRfc2hvdWxkX3N0b3AoKSkg
ewogCQl1bnNpZ25lZCBpbnQgaWR4ID0gY291bnQrKyAmIChBUlJBWV9TSVpFKHJxKSAtIDEpOwog
CQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpvbGQgPSBycVtpZHhdOwogCQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpuZXc7CiAKLQkJbmV3ID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4W2lkeF0sIGVuZ2luZSk7
CisJCW5ldyA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2VbaWR4XSk7CiAJCWlmIChJ
U19FUlIobmV3KSkgewogCQkJZXJyID0gUFRSX0VSUihuZXcpOwogCQkJYnJlYWs7CiAJCX0KIAot
CQlpZiAoYXJnLT5mbGFncyAmIFRFU1RfUFJJT1JJVFkpCi0JCQljdHhbaWR4XS0+c2NoZWQucHJp
b3JpdHkgPQotCQkJCWk5MTVfcHJhbmRvbV91MzJfbWF4X3N0YXRlKDUxMiwgJnBybmcpOwotCiAJ
CXJxW2lkeF0gPSBpOTE1X3JlcXVlc3RfZ2V0KG5ldyk7CiAJCWk5MTVfcmVxdWVzdF9hZGQobmV3
KTsKIAorCQlpZiAoZW5naW5lLT5zY2hlZHVsZSAmJiBhcmctPmZsYWdzICYgVEVTVF9QUklPUklU
WSkgeworCQkJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRyID0geworCQkJCS5wcmlvcml0eSA9
CisJCQkJCWk5MTVfcHJhbmRvbV91MzJfbWF4X3N0YXRlKDUxMiwgJnBybmcpLAorCQkJfTsKKwkJ
CWVuZ2luZS0+c2NoZWR1bGUocnFbaWR4XSwgJmF0dHIpOworCQl9CisKIAkJZXJyID0gYWN0aXZl
X3JlcXVlc3RfcHV0KG9sZCk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKQEAgLTc0OSwxMCArNzI3
LDEwIEBAIHN0YXRpYyBpbnQgYWN0aXZlX2VuZ2luZSh2b2lkICpkYXRhKQogCQkvKiBLZWVwIHRo
ZSBmaXJzdCBlcnJvciAqLwogCQlpZiAoIWVycikKIAkJCWVyciA9IGVycl9fOworCisJCWludGVs
X2NvbnRleHRfcHV0KGNlW2NvdW50XSk7CiAJfQogCi1lcnJfZmlsZToKLQlmcHV0KGZpbGUpOwog
CXJldHVybiBlcnI7CiB9CiAKQEAgLTEzMDAsMzIgKzEyNzgsMjEgQEAgc3RhdGljIGludCBpZ3Rf
cmVzZXRfZXZpY3RfZ2d0dCh2b2lkICphcmcpCiBzdGF0aWMgaW50IGlndF9yZXNldF9ldmljdF9w
cGd0dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKLQlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwot
CXN0cnVjdCBmaWxlICpmaWxlOworCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAlpbnQgZXJy
OwogCi0JZmlsZSA9IG1vY2tfZmlsZShndC0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaWxlKSkKLQkJ
cmV0dXJuIFBUUl9FUlIoZmlsZSk7CisJLyogYWxpYXNpbmcgPT0gZ2xvYmFsIGd0dCBsb2NraW5n
LCBjb3ZlcmVkIGFib3ZlICovCisJaWYgKElOVEVMX1BQR1RUKGd0LT5pOTE1KSA8IElOVEVMX1BQ
R1RUX0ZVTEwpCisJCXJldHVybiAwOwogCi0JY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBm
aWxlKTsKLQlpZiAoSVNfRVJSKGN0eCkpIHsKLQkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3Rv
IG91dDsKLQl9CisJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShndC0+aTkxNSk7CisJaWYgKElT
X0VSUihwcGd0dCkpCisJCXJldHVybiBQVFJfRVJSKHBwZ3R0KTsKIAotCWVyciA9IDA7Ci0Jdm0g
PSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKLQlpZiAoIWk5MTVfaXNfZ2d0dCh2
bSkpIHsKLQkJLyogYWxpYXNpbmcgPT0gZ2xvYmFsIGd0dCBsb2NraW5nLCBjb3ZlcmVkIGFib3Zl
ICovCi0JCWVyciA9IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShndCwgdm0sCi0JCQkJCSAgICBldmlj
dF92bWEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKLQl9Ci0JaTkxNV92bV9wdXQodm0pOworCWVyciA9
IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShndCwgJnBwZ3R0LT52bSwKKwkJCQkgICAgZXZpY3Rfdm1h
LCBFWEVDX09CSkVDVF9XUklURSk7CisJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7CiAKLW91dDoK
LQlmcHV0KGZpbGUpOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKaW5kZXggN2Q1NzEzZWE2YmRlLi4wYTllYTQzZWU2YjcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC01MywxMSArNTMsMTAgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpndCkKIHN0YXRp
YyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpn
dCA9IGFyZzsKLQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwotCXN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHg7Ci0Jc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlzdHJ1
Y3QgaWd0X3NwaW5uZXIgc3BpbjsKLQlpbnQgZXJyID0gLUVOT01FTTsKKwlpbnQgZXJyID0gMDsK
IAogCWlmICghSEFTX0xPR0lDQUxfUklOR19DT05URVhUUyhndC0+aTkxNSkpCiAJCXJldHVybiAw
OwpAQCAtNjUsMTcgKzY0LDIwIEBAIHN0YXRpYyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2b2lkICph
cmcpCiAJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW4sIGd0KSkKIAkJcmV0dXJuIC1FTk9NRU07
CiAKLQljdHggPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHgpCi0JCWdvdG8g
ZXJyX3NwaW47Ci0KLQlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9jb250ZXh0X2xv
Y2tfZW5naW5lcyhjdHgpLCBpdCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkg
eworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OwogCisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwkJaWYgKElTX0VSUihj
ZSkpIHsKKwkJCWVyciA9IFBUUl9FUlIoY2UpOworCQkJYnJlYWs7CisJCX0KKwogCQlycSA9IGln
dF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluLCBjZSwgTUlfTk9PUCk7CiAJCWlmIChJU19F
UlIocnEpKSB7CiAJCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCWdvdG8gZXJyX2N0eDsKKwkJCWdv
dG8gb3V0X2N0eDsKIAkJfQogCiAJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwpAQCAtODQsMjEgKzg2
LDIxIEBAIHN0YXRpYyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2b2lkICphcmcpCiAJCQlHRU1fVFJB
Q0VfRFVNUCgpOwogCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQllcnIgPSAtRUlPOwot
CQkJZ290byBlcnJfY3R4OworCQkJZ290byBvdXRfY3R4OwogCQl9CiAKIAkJaWd0X3NwaW5uZXJf
ZW5kKCZzcGluKTsKIAkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkgewogCQkJZXJyID0g
LUVJTzsKLQkJCWdvdG8gZXJyX2N0eDsKKwkJCWdvdG8gb3V0X2N0eDsKIAkJfQorCitvdXRfY3R4
OgorCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKIAl9CiAK
LQllcnIgPSAwOwotZXJyX2N0eDoKLQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0
eCk7Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKLWVycl9zcGluOgogCWlndF9zcGlubmVy
X2ZpbmkoJnNwaW4pOwogCXJldHVybiBlcnI7CiB9CkBAIC0xMDYsNyArMTA4LDYgQEAgc3RhdGlj
IGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIHN0YXRpYyBpbnQgbGl2ZV91bmxpdGVf
cmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKIHsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKIAlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3BpbjsKIAlpbnQgZXJy
ID0gLUVOT01FTTsKQEAgLTExOSwxMCArMTIwLDYgQEAgc3RhdGljIGludCBsaXZlX3VubGl0ZV9y
ZXN0b3JlKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludCBwcmlvKQogCWlmIChpZ3Rfc3Bpbm5lcl9p
bml0KCZzcGluLCBndCkpCiAJCXJldHVybiBlcnI7CiAKLQljdHggPSBrZXJuZWxfY29udGV4dChn
dC0+aTkxNSk7Ci0JaWYgKCFjdHgpCi0JCWdvdG8gZXJyX3NwaW47Ci0KIAllcnIgPSAwOwogCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewogCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2VbMl0gPSB7fTsKQEAgLTE0NCw3ICsxNDEsNyBAQCBzdGF0aWMgaW50IGxpdmVfdW5saXRlX3Jl
c3RvcmUoc3RydWN0IGludGVsX2d0ICpndCwgaW50IHByaW8pCiAJCWZvciAobiA9IDA7IG4gPCBB
UlJBWV9TSVpFKGNlKTsgbisrKSB7CiAJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdG1wOwogCi0J
CQl0bXAgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShjdHgsIGVuZ2luZSk7CisJCQl0bXAgPSBpbnRl
bF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCQkJaWYgKElTX0VSUih0bXApKSB7CiAJCQkJZXJy
ID0gUFRSX0VSUih0bXApOwogCQkJCWdvdG8gZXJyX2NlOwpAQCAtMjUzLDggKzI1MCw2IEBAIHN0
YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJp
bykKIAkJCWJyZWFrOwogCX0KIAotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci1lcnJfc3Bp
bjoKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMzA5LDE3
ICszMDQsMTcgQEAgZW1pdF9zZW1hcGhvcmVfY2hhaW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEs
IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQogc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVl
c3QgKgogc2VtYXBob3JlX3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgc3Ry
dWN0IGk5MTVfdm1hICp2bWEsIGludCBpZHgpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eDsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CiAJaW50IGVycjsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGVuZ2luZS0+aTkxNSk7Ci0J
aWYgKCFjdHgpCi0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCWNlID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZW5naW5lKTsKKwlpZiAoSVNfRVJSKGNlKSkKKwkJcmV0dXJuIEVSUl9DQVNUKGNl
KTsKIAotCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4LCBlbmdpbmUpOworCXJxID0gaW50ZWxf
Y29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CiAJaWYgKElTX0VSUihycSkpCi0JCWdvdG8gb3V0
X2N0eDsKKwkJZ290byBvdXRfY2U7CiAKIAllcnIgPSAwOwogCWlmIChycS0+ZW5naW5lLT5lbWl0
X2luaXRfYnJlYWRjcnVtYikKQEAgLTMzMiw4ICszMjcsOCBAQCBzZW1hcGhvcmVfcXVldWUoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlk
eCkKIAlpZiAoZXJyKQogCQlycSA9IEVSUl9QVFIoZXJyKTsKIAotb3V0X2N0eDoKLQlrZXJuZWxf
Y29udGV4dF9jbG9zZShjdHgpOworb3V0X2NlOgorCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAly
ZXR1cm4gcnE7CiB9CiAKQEAgLTIzOTIsMjcgKzIzODcsMTcgQEAgc3RhdGljIGludCBub3Bfdmly
dHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIHsKIAlJR1RfVElNRU9VVChlbmRfdGlt
ZSk7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdFsxNl07Ci0Jc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eFsxNl07CiAJc3RydWN0IGludGVsX2NvbnRleHQgKnZlWzE2XTsKIAl1bnNp
Z25lZCBsb25nIG4sIHByaW1lLCBuYzsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCWt0aW1l
X3QgdGltZXNbMl0gPSB7fTsKIAlpbnQgZXJyOwogCi0JR0VNX0JVR19PTighbmN0eCB8fCBuY3R4
ID4gQVJSQVlfU0laRShjdHgpKTsKKwlHRU1fQlVHX09OKCFuY3R4IHx8IG5jdHggPiBBUlJBWV9T
SVpFKHZlKSk7CiAKIAlmb3IgKG4gPSAwOyBuIDwgbmN0eDsgbisrKSB7Ci0JCWN0eFtuXSA9IGtl
cm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQkJaWYgKCFjdHhbbl0pIHsKLQkJCWVyciA9IC1FTk9N
RU07Ci0JCQluY3R4ID0gbjsKLQkJCWdvdG8gb3V0OwotCQl9Ci0KLQkJdmVbbl0gPSBpbnRlbF9l
eGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoY3R4W25dLAotCQkJCQkJICAgICAgIHNpYmxpbmdzLCBu
c2libGluZyk7CisJCXZlW25dID0gaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHNpYmxp
bmdzLCBuc2libGluZyk7CiAJCWlmIChJU19FUlIodmVbbl0pKSB7Ci0JCQlrZXJuZWxfY29udGV4
dF9jbG9zZShjdHhbbl0pOwogCQkJZXJyID0gUFRSX0VSUih2ZVtuXSk7CiAJCQluY3R4ID0gbjsK
IAkJCWdvdG8gb3V0OwpAQCAtMjQyMSw3ICsyNDA2LDYgQEAgc3RhdGljIGludCBub3BfdmlydHVh
bF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkJZXJyID0gaW50ZWxfY29udGV4dF9waW4o
dmVbbl0pOwogCQlpZiAoZXJyKSB7CiAJCQlpbnRlbF9jb250ZXh0X3B1dCh2ZVtuXSk7Ci0JCQlr
ZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbl0pOwogCQkJbmN0eCA9IG47CiAJCQlnb3RvIG91dDsK
IAkJfQpAQCAtMjUwMiw3ICsyNDg2LDYgQEAgc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUo
c3RydWN0IGludGVsX2d0ICpndCwKIAlmb3IgKG5jID0gMDsgbmMgPCBuY3R4OyBuYysrKSB7CiAJ
CWludGVsX2NvbnRleHRfdW5waW4odmVbbmNdKTsKIAkJaW50ZWxfY29udGV4dF9wdXQodmVbbmNd
KTsKLQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4W25jXSk7CiAJfQogCXJldHVybiBlcnI7CiB9
CkBAIC0yNTYxLDcgKzI1NDQsNiBAQCBzdGF0aWMgaW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3Ry
dWN0IGludGVsX2d0ICpndCwKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcpCiB7CiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdFtNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07Ci0J
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7
CiAJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAl1bnNpZ25lZCBpbnQgbjsKQEAgLTI1NzIsMTEg
KzI1NTQsNyBAQCBzdGF0aWMgaW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0
ICpndCwKIAkgKiByZXN0cmljdCBpdCB0byBvdXIgZGVzaXJlZCBlbmdpbmUgd2l0aGluIHRoZSB2
aXJ0dWFsIGVuZ2luZS4KIAkgKi8KIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsK
LQlpZiAoIWN0eCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KLQl2ZSA9IGludGVsX2V4ZWNsaXN0c19j
cmVhdGVfdmlydHVhbChjdHgsIHNpYmxpbmdzLCBuc2libGluZyk7CisJdmUgPSBpbnRlbF9leGVj
bGlzdHNfY3JlYXRlX3ZpcnR1YWwoc2libGluZ3MsIG5zaWJsaW5nKTsKIAlpZiAoSVNfRVJSKHZl
KSkgewogCQllcnIgPSBQVFJfRVJSKHZlKTsKIAkJZ290byBvdXRfY2xvc2U7CkBAIC0yNjQ0LDcg
KzI2MjIsNiBAQCBzdGF0aWMgaW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0
ICpndCwKIG91dF9wdXQ6CiAJaW50ZWxfY29udGV4dF9wdXQodmUpOwogb3V0X2Nsb3NlOgotCWtl
cm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjY4NCw3ICsy
NjYxLDYgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVs
X2d0ICpndCwKIAkJCQkgICAgdW5zaWduZWQgaW50IG5zaWJsaW5nKQogewogCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKmxhc3QgPSBOVUxMOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJ
c3RydWN0IGludGVsX2NvbnRleHQgKnZlOwogCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKIAlz
dHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwpAQCAtMjY5MiwxNyArMjY2OCwxMSBAQCBzdGF0aWMgaW50
IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWludCBlcnIg
PSAwOwogCXUzMiAqY3M7CiAKLQljdHggPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYg
KCFjdHgpCi0JCXJldHVybiAtRU5PTUVNOwotCiAJc2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNoKHNp
YmxpbmdzWzBdLT5ndCk7Ci0JaWYgKElTX0VSUihzY3JhdGNoKSkgewotCQllcnIgPSBQVFJfRVJS
KHNjcmF0Y2gpOwotCQlnb3RvIG91dF9jbG9zZTsKLQl9CisJaWYgKElTX0VSUihzY3JhdGNoKSkK
KwkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKLQl2ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVh
dGVfdmlydHVhbChjdHgsIHNpYmxpbmdzLCBuc2libGluZyk7CisJdmUgPSBpbnRlbF9leGVjbGlz
dHNfY3JlYXRlX3ZpcnR1YWwoc2libGluZ3MsIG5zaWJsaW5nKTsKIAlpZiAoSVNfRVJSKHZlKSkg
ewogCQllcnIgPSBQVFJfRVJSKHZlKTsKIAkJZ290byBvdXRfc2NyYXRjaDsKQEAgLTI3ODUsOCAr
Mjc1NSw2IEBAIHN0YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRl
bF9ndCAqZ3QsCiAJaW50ZWxfY29udGV4dF9wdXQodmUpOwogb3V0X3NjcmF0Y2g6CiAJaTkxNV92
bWFfdW5waW5fYW5kX3JlbGVhc2UoJnNjcmF0Y2gsIDApOwotb3V0X2Nsb3NlOgotCWtlcm5lbF9j
b250ZXh0X2Nsb3NlKGN0eCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjgzOCw3ICsyODA2LDYg
QEAgc3RhdGljIGludCBib25kX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAj
ZGVmaW5lIEJPTkRfU0NIRURVTEUgQklUKDApCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
bWFzdGVyOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnFbMTZdOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCXVuc2lnbmVkIGxvbmcg
bjsKQEAgLTI4NDYsMTAgKzI4MTMsNiBAQCBzdGF0aWMgaW50IGJvbmRfdmlydHVhbF9lbmdpbmUo
c3RydWN0IGludGVsX2d0ICpndCwKIAogCUdFTV9CVUdfT04obnNpYmxpbmcgPj0gQVJSQVlfU0la
RShycSkgLSAxKTsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlpZiAoIWN0
eCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KIAllcnIgPSAwOwogCXJxWzBdID0gRVJSX1BUUigtRU5P
TUVNKTsKIAlmb3JfZWFjaF9lbmdpbmUobWFzdGVyLCBndCwgaWQpIHsKQEAgLTI4NjAsNyArMjgy
Myw3IEBAIHN0YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0
LAogCiAJCW1lbXNldF9wKCh2b2lkICopcnEsIEVSUl9QVFIoLUVJTlZBTCksIEFSUkFZX1NJWkUo
cnEpKTsKIAotCQlycVswXSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgbWFzdGVyKTsKKwkJcnFb
MF0gPSBpOTE1X3JlcXVlc3RfY3JlYXRlKG1hc3Rlci0+a2VybmVsX2NvbnRleHQpOwogCQlpZiAo
SVNfRVJSKHJxWzBdKSkgewogCQkJZXJyID0gUFRSX0VSUihycVswXSk7CiAJCQlnb3RvIG91dDsK
QEAgLTI4ODAsOSArMjg0Myw3IEBAIHN0YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1
Y3QgaW50ZWxfZ3QgKmd0LAogCQlmb3IgKG4gPSAwOyBuIDwgbnNpYmxpbmc7IG4rKykgewogCQkJ
c3RydWN0IGludGVsX2NvbnRleHQgKnZlOwogCi0JCQl2ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVh
dGVfdmlydHVhbChjdHgsCi0JCQkJCQkJICAgIHNpYmxpbmdzLAotCQkJCQkJCSAgICBuc2libGlu
Zyk7CisJCQl2ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbnNp
YmxpbmcpOwogCQkJaWYgKElTX0VSUih2ZSkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHZlKTsKIAkJ
CQlvbnN0YWNrX2ZlbmNlX2ZpbmkoJmZlbmNlKTsKQEAgLTI5NjAsNyArMjkyMSw2IEBAIHN0YXRp
YyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWlmIChpZ3Rf
Zmx1c2hfdGVzdChndC0+aTkxNSkpCiAJCWVyciA9IC1FSU87CiAKLQlrZXJuZWxfY29udGV4dF9j
bG9zZShjdHgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTMyNzAsOCArMzIzMCw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9scmNfZml4ZWQodm9pZCAqYXJnKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRp
YyBpbnQgX19saXZlX2xyY19zdGF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWUsCi0J
CQkgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorc3RhdGljIGludCBfX2xpdmVf
bHJjX3N0YXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCSAgICBzdHJ1Y3Qg
aTkxNV92bWEgKnNjcmF0Y2gpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwpAQCAtMzI4
Niw3ICszMjQ1LDcgQEAgc3RhdGljIGludCBfX2xpdmVfbHJjX3N0YXRlKHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpmaXhtZSwKIAlpbnQgZXJyOwogCWludCBuOwogCi0JY2UgPSBpbnRlbF9jb250
ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5lKTsKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVu
Z2luZSk7CiAJaWYgKElTX0VSUihjZSkpCiAJCXJldHVybiBQVFJfRVJSKGNlKTsKIApAQCAtMzM2
MCw3ICszMzE5LDYgQEAgc3RhdGljIGludCBsaXZlX2xyY19zdGF0ZSh2b2lkICphcmcpCiB7CiAJ
c3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lOwogCXN0cnVjdCBpOTE1X3ZtYSAq
c2NyYXRjaDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQgZXJyID0gMDsKQEAgLTMz
NzAsMTggKzMzMjgsMTIgQEAgc3RhdGljIGludCBsaXZlX2xyY19zdGF0ZSh2b2lkICphcmcpCiAJ
ICogaW50ZWxfY29udGV4dC4KIAkgKi8KIAotCWZpeG1lID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5
MTUpOwotCWlmICghZml4bWUpCi0JCXJldHVybiAtRU5PTUVNOwotCiAJc2NyYXRjaCA9IGNyZWF0
ZV9zY3JhdGNoKGd0KTsKLQlpZiAoSVNfRVJSKHNjcmF0Y2gpKSB7Ci0JCWVyciA9IFBUUl9FUlIo
c2NyYXRjaCk7Ci0JCWdvdG8gb3V0X2Nsb3NlOwotCX0KKwlpZiAoSVNfRVJSKHNjcmF0Y2gpKQor
CQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0
LCBpZCkgewotCQllcnIgPSBfX2xpdmVfbHJjX3N0YXRlKGZpeG1lLCBlbmdpbmUsIHNjcmF0Y2gp
OworCQllcnIgPSBfX2xpdmVfbHJjX3N0YXRlKGVuZ2luZSwgc2NyYXRjaCk7CiAJCWlmIChlcnIp
CiAJCQlicmVhazsKIAl9CkBAIC0zMzkwLDggKzMzNDIsNiBAQCBzdGF0aWMgaW50IGxpdmVfbHJj
X3N0YXRlKHZvaWQgKmFyZykKIAkJZXJyID0gLUVJTzsKIAogCWk5MTVfdm1hX3VucGluX2FuZF9y
ZWxlYXNlKCZzY3JhdGNoLCAwKTsKLW91dF9jbG9zZToKLQlrZXJuZWxfY29udGV4dF9jbG9zZShm
aXhtZSk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMzQyNCw4ICszMzc0LDcgQEAgc3RhdGljIGlu
dCBncHJfbWFrZV9kaXJ0eShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyBpbnQgX19saXZlX2dwcl9jbGVhcihzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqZml4bWUsCi0JCQkgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorc3Rh
dGljIGludCBfX2xpdmVfZ3ByX2NsZWFyKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwK
IAkJCSAgICBzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2gpCiB7CiAJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlOwpAQCAtMzQ0MSw3ICszMzkwLDcgQEAgc3RhdGljIGludCBfX2xpdmVfZ3ByX2NsZWFy
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZSwKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJy
OwogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5lKTsKKwljZSA9IGlu
dGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihjZSkpCiAJCXJldHVybiBQ
VFJfRVJSKGNlKTsKIApAQCAtMzUwMyw3ICszNDUyLDYgQEAgc3RhdGljIGludCBsaXZlX2dwcl9j
bGVhcih2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1l
OwogCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsK
IAlpbnQgZXJyID0gMDsKQEAgLTM1MTMsMTggKzM0NjEsMTIgQEAgc3RhdGljIGludCBsaXZlX2dw
cl9jbGVhcih2b2lkICphcmcpCiAJICogdG8gYXZvaWQgbGVha2luZyBhbnkgaW5mb3JtYXRpb24g
ZnJvbSBwcmV2aW91cyBjb250ZXh0cy4KIAkgKi8KIAotCWZpeG1lID0ga2VybmVsX2NvbnRleHQo
Z3QtPmk5MTUpOwotCWlmICghZml4bWUpCi0JCXJldHVybiAtRU5PTUVNOwotCiAJc2NyYXRjaCA9
IGNyZWF0ZV9zY3JhdGNoKGd0KTsKLQlpZiAoSVNfRVJSKHNjcmF0Y2gpKSB7Ci0JCWVyciA9IFBU
Ul9FUlIoc2NyYXRjaCk7Ci0JCWdvdG8gb3V0X2Nsb3NlOwotCX0KKwlpZiAoSVNfRVJSKHNjcmF0
Y2gpKQorCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGd0LCBpZCkgewotCQllcnIgPSBfX2xpdmVfZ3ByX2NsZWFyKGZpeG1lLCBlbmdpbmUsIHNj
cmF0Y2gpOworCQllcnIgPSBfX2xpdmVfZ3ByX2NsZWFyKGVuZ2luZSwgc2NyYXRjaCk7CiAJCWlm
IChlcnIpCiAJCQlicmVhazsKIAl9CkBAIC0zNTMzLDggKzM0NzUsNiBAQCBzdGF0aWMgaW50IGxp
dmVfZ3ByX2NsZWFyKHZvaWQgKmFyZykKIAkJZXJyID0gLUVJTzsKIAogCWk5MTVfdm1hX3VucGlu
X2FuZF9yZWxlYXNlKCZzY3JhdGNoLCAwKTsKLW91dF9jbG9zZToKLQlrZXJuZWxfY29udGV4dF9j
bG9zZShmaXhtZSk7CiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKaW5kZXggZDVkMWUxYTMyMTg3Li5hYzE5MjE4NTRj
YmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91
bmRzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMu
YwpAQCAtMjY0LDIyICsyNjQsMTUgQEAgc3RhdGljIGludAogc3dpdGNoX3RvX3NjcmF0Y2hfY29u
dGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgIHN0cnVjdCBpZ3Rfc3Bp
bm5lciAqc3BpbikKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlpbnQgZXJyID0g
MDsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGVuZ2luZS0+aTkxNSk7Ci0JaWYgKElTX0VSUihj
dHgpKQotCQlyZXR1cm4gUFRSX0VSUihjdHgpOwotCi0JR0VNX0JVR19PTihpOTE1X2dlbV9jb250
ZXh0X2lzX2Jhbm5hYmxlKGN0eCkpOwotCi0JY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdp
bmUoY3R4LCBlbmdpbmUtPmxlZ2FjeV9pZHgpOwotCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CisJ
Y2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCWlmIChJU19FUlIoY2UpKQorCQly
ZXR1cm4gUFRSX0VSUihjZSk7CiAKIAlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KHNw
aW4sIGNlLCBNSV9OT09QKTsKLQogCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAogCWlmIChJU19F
UlIocnEpKSB7CkBAIC0yOTMsNyArMjg2LDYgQEAgc3dpdGNoX3RvX3NjcmF0Y2hfY29udGV4dChz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJaWYgKGVyciAmJiBzcGluKQogCQlpZ3Rf
c3Bpbm5lcl9lbmQoc3Bpbik7CiAKLQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCXJldHVy
biBlcnI7CiB9CiAKQEAgLTM2NywyMCArMzU5LDE3IEBAIHN0YXRpYyBpbnQgY2hlY2tfd2hpdGVs
aXN0X2Fjcm9zc19yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJcmV0dXJu
IGVycjsKIH0KIAotc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX2JhdGNoKHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHgpCitzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfYmF0
Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7CiAJc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKIAlpbnQgZXJyOwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9pbnRlcm5hbChjdHgtPmk5MTUsIDE2ICogUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9v
YmplY3RfY3JlYXRlX2ludGVybmFsKHZtLT5pOTE1LCAxNiAqIFBBR0VfU0laRSk7CiAJaWYgKElT
X0VSUihvYmopKQogCQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsKIAotCXZtID0gaTkxNV9nZW1fY29u
dGV4dF9nZXRfdm1fcmN1KGN0eCk7CiAJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwg
TlVMTCk7Ci0JaTkxNV92bV9wdXQodm0pOwogCWlmIChJU19FUlIodm1hKSkgewogCQllcnIgPSBQ
VFJfRVJSKHZtYSk7CiAJCWdvdG8gZXJyX29iajsKQEAgLTQ1Miw4ICs0NDEsNyBAQCBzdGF0aWMg
aW50IHdoaXRlbGlzdF93cml0YWJsZV9jb3VudChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiAJcmV0dXJuIGNvdW50OwogfQogCi1zdGF0aWMgaW50IGNoZWNrX2RpcnR5X3doaXRlbGlz
dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkJCSBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCitzdGF0aWMgaW50IGNoZWNrX2RpcnR5X3doaXRlbGlzdChzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UpCiB7CiAJY29uc3QgdTMyIHZhbHVlc1tdID0gewogCQkweDAwMDAwMDAw
LApAQCAtNDgxLDE5ICs0NjksMTcgQEAgc3RhdGljIGludCBjaGVja19kaXJ0eV93aGl0ZWxpc3Qo
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJMHhmZmZmMDBmZiwKIAkJMHhmZmZmZmZm
ZiwKIAl9OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSA9IGNlLT5lbmdpbmU7CiAJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNo
OwogCXN0cnVjdCBpOTE1X3ZtYSAqYmF0Y2g7CiAJaW50IGVyciA9IDAsIGksIHY7CiAJdTMyICpj
cywgKnJlc3VsdHM7CiAKLQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwot
CXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRjaCh2bSwgMiAqIEFSUkFZX1NJWkUodmFsdWVzKSArIDEp
OwotCWk5MTVfdm1fcHV0KHZtKTsKKwlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goY2UtPnZtLCAy
ICogQVJSQVlfU0laRSh2YWx1ZXMpICsgMSk7CiAJaWYgKElTX0VSUihzY3JhdGNoKSkKIAkJcmV0
dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKLQliYXRjaCA9IGNyZWF0ZV9iYXRjaChjdHgpOworCWJh
dGNoID0gY3JlYXRlX2JhdGNoKGNlLT52bSk7CiAJaWYgKElTX0VSUihiYXRjaCkpIHsKIAkJZXJy
ID0gUFRSX0VSUihiYXRjaCk7CiAJCWdvdG8gb3V0X3NjcmF0Y2g7CkBAIC01MTgsNyArNTA0LDcg
QEAgc3RhdGljIGludCBjaGVja19kaXJ0eV93aGl0ZWxpc3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCwKIAogCQlzcm0gPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU07CiAJCWxybSA9IE1JX0xP
QURfUkVHSVNURVJfTUVNOwotCQlpZiAoSU5URUxfR0VOKGN0eC0+aTkxNSkgPj0gOCkKKwkJaWYg
KElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDgpCiAJCQlscm0rKywgc3JtKys7CiAKIAkJcHJf
ZGVidWcoIiVzOiBXcml0aW5nIGdhcmJhZ2UgdG8gJXhcbiIsCkBAIC01NzcsNyArNTYzLDcgQEAg
c3RhdGljIGludCBjaGVja19kaXJ0eV93aGl0ZWxpc3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCwKIAkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChiYXRjaC0+b2JqKTsKIAkJaW50ZWxf
Z3RfY2hpcHNldF9mbHVzaChlbmdpbmUtPmd0KTsKIAotCQlycSA9IGlndF9yZXF1ZXN0X2FsbG9j
KGN0eCwgZW5naW5lKTsKKwkJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsK
IAkJaWYgKElTX0VSUihycSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwogCQkJZ290byBvdXRf
YmF0Y2g7CkBAIC02OTYsNyArNjgyLDcgQEAgc3RhdGljIGludCBjaGVja19kaXJ0eV93aGl0ZWxp
c3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCWJyZWFrOwogCX0KIAotCWlmIChp
Z3RfZmx1c2hfdGVzdChjdHgtPmk5MTUpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChlbmdpbmUtPmk5
MTUpKQogCQllcnIgPSAtRUlPOwogb3V0X2JhdGNoOgogCWk5MTVfdm1hX3VucGluX2FuZF9yZWxl
YXNlKCZiYXRjaCwgMCk7CkBAIC03MDksMzggKzY5NSwzMSBAQCBzdGF0aWMgaW50IGxpdmVfZGly
dHlfd2hpdGVsaXN0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwog
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCXN0cnVjdCBmaWxlICpmaWxlOwot
CWludCBlcnIgPSAwOwogCiAJLyogQ2FuIHRoZSB1c2VyIHdyaXRlIHRvIHRoZSB3aGl0ZWxpc3Rl
ZCByZWdpc3RlcnM/ICovCiAKIAlpZiAoSU5URUxfR0VOKGd0LT5pOTE1KSA8IDcpIC8qIG1pbmlt
dW0gcmVxdWlyZW1lbnQgZm9yIExSSSwgU1JNLCBMUk0gKi8KIAkJcmV0dXJuIDA7CiAKLQlmaWxl
ID0gbW9ja19maWxlKGd0LT5pOTE1KTsKLQlpZiAoSVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRS
X0VSUihmaWxlKTsKLQotCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYg
KElTX0VSUihjdHgpKSB7Ci0JCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXRfZmlsZTsK
LQl9Ci0KIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVs
X2NvbnRleHQgKmNlOworCQlpbnQgZXJyOworCiAJCWlmIChlbmdpbmUtPndoaXRlbGlzdC5jb3Vu
dCA9PSAwKQogCQkJY29udGludWU7CiAKLQkJZXJyID0gY2hlY2tfZGlydHlfd2hpdGVsaXN0KGN0
eCwgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCQlpZiAo
SVNfRVJSKGNlKSkKKwkJCXJldHVybiBQVFJfRVJSKGNlKTsKKworCQllcnIgPSBjaGVja19kaXJ0
eV93aGl0ZWxpc3QoY2UpOworCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJCWlmIChlcnIpCi0J
CQlnb3RvIG91dF9maWxlOworCQkJcmV0dXJuIGVycjsKIAl9CiAKLW91dF9maWxlOgotCWZwdXQo
ZmlsZSk7Ci0JcmV0dXJuIGVycjsKKwlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBsaXZlX3Jl
c2V0X3doaXRlbGlzdCh2b2lkICphcmcpCkBAIC04MzAsMTIgKzgwOSwxNSBAQCBzdGF0aWMgaW50
IHJlYWRfd2hpdGVsaXN0ZWRfcmVnaXN0ZXJzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
CiBzdGF0aWMgaW50IHNjcnViX3doaXRlbGlzdGVkX3JlZ2lzdGVycyhzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LAogCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
CiB7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnE7CiAJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAlpbnQgaSwgZXJyID0gMDsKIAl1MzIg
KmNzOwogCi0JYmF0Y2ggPSBjcmVhdGVfYmF0Y2goY3R4KTsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRl
eHRfZ2V0X3ZtX3JjdShjdHgpOworCWJhdGNoID0gY3JlYXRlX2JhdGNoKHZtKTsKKwlpOTE1X3Zt
X3B1dCh2bSk7CiAJaWYgKElTX0VSUihiYXRjaCkpCiAJCXJldHVybiBQVFJfRVJSKGJhdGNoKTsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCmluZGV4IDIyOGM2NjUzNGUyMS4uYjMy
OTlmODhlMjRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVy
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC0zNSwxMiAr
MzUsMTIgQEAKIAogI2luY2x1ZGUgPGxpbnV4L2t0aHJlYWQuaD4KIAotI2luY2x1ZGUgImdlbS9p
OTE1X2dlbV9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVk
ZSAiZ3QvaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX3JpbmcuaCIKIAogI2lu
Y2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0LmgiCiAjaW5jbHVkZSAi
Z3Z0LmgiCiAKICNkZWZpbmUgUklOR19DVFhfT0ZGKHgpIFwKQEAgLTEyMjAsMTYgKzEyMjAsMTQg
QEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdw
dSkKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7
CiAJc3RydWN0IGludGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJtaXNzaW9uOwog
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OwogCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAllbnVtIGludGVsX2VuZ2luZV9p
ZCBpOwogCWludCByZXQ7CiAKLQljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwo
aTkxNSwgSTkxNV9QUklPUklUWV9NQVgpOwotCWlmIChJU19FUlIoY3R4KSkKLQkJcmV0dXJuIFBU
Ul9FUlIoY3R4KTsKKwlwcGd0dCA9IGk5MTVfcHBndHRfY3JlYXRlKGk5MTUpOworCWlmIChJU19F
UlIocHBndHQpKQorCQlyZXR1cm4gUFRSX0VSUihwcGd0dCk7CiAKLQlwcGd0dCA9IGk5MTVfdm1f
dG9fcHBndHQoaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCkpOwogCWk5MTVfY29udGV4
dF9wcGd0dF9yb290X3NhdmUocywgcHBndHQpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwg
aTkxNSwgaSkgewpAQCAtMTIzOCwxMiArMTIzNiwxNCBAQCBpbnQgaW50ZWxfdmdwdV9zZXR1cF9z
dWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCQlJTklUX0xJU1RfSEVBRCgmcy0+
d29ya2xvYWRfcV9oZWFkW2ldKTsKIAkJcy0+c2hhZG93W2ldID0gRVJSX1BUUigtRUlOVkFMKTsK
IAotCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKKwkJY2UgPSBpbnRl
bF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJcmV0ID0g
UFRSX0VSUihjZSk7CiAJCQlnb3RvIG91dF9zaGFkb3dfY3R4OwogCQl9CiAKKwkJaTkxNV92bV9w
dXQoY2UtPnZtKTsKKwkJY2UtPnZtID0gaTkxNV92bV9nZXQoJnBwZ3R0LT52bSk7CiAJCWludGVs
X2NvbnRleHRfc2V0X3NpbmdsZV9zdWJtaXNzaW9uKGNlKTsKIAogCQlpZiAoIVVTRVNfR1VDX1NV
Qk1JU1NJT04oaTkxNSkpIHsgLyogTWF4IHJpbmcgYnVmZmVyIHNpemUgKi8KQEAgLTEyNzgsNyAr
MTI3OCw2IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3Zn
cHUgKnZncHUpCiAJYml0bWFwX3plcm8ocy0+dGxiX2hhbmRsZV9wZW5kaW5nLCBJOTE1X05VTV9F
TkdJTkVTKTsKIAogCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwotCWk5MTVfZ2VtX2NvbnRleHRf
cHV0KGN0eCk7CiAJcmV0dXJuIDA7CiAKIG91dF9zaGFkb3dfY3R4OgpAQCAtMTI5MSw3ICsxMjkw
LDYgQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAq
dmdwdSkKIAkJaW50ZWxfY29udGV4dF9wdXQocy0+c2hhZG93W2ldKTsKIAl9CiAJaTkxNV92bV9w
dXQoJnBwZ3R0LT52bSk7Ci0JaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAlyZXR1cm4gcmV0
OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwppbmRleCAyMDczODNkZGE4NGQuLjk1
MzM1OWZiODJmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC02LDYgKzYsNyBA
QAogCiAjaW5jbHVkZSA8bGludXgvZGVidWdvYmplY3RzLmg+CiAKKyNpbmNsdWRlICJndC9pbnRl
bF9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCiAjaW5jbHVkZSAi
Z3QvaW50ZWxfcmluZy5oIgogCkBAIC03MDgsNiArNzA5LDcgQEAgdm9pZCBpOTE1X3JlcXVlc3Rf
YWRkX2FjdGl2ZV9iYXJyaWVycyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlzdHJ1Y3QgbGxp
c3Rfbm9kZSAqbm9kZSwgKm5leHQ7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAorCUdFTV9CVUdf
T04oIWludGVsX2NvbnRleHRfaXNfYmFycmllcihycS0+Y29udGV4dCkpOwogCUdFTV9CVUdfT04o
aW50ZWxfZW5naW5lX2lzX3ZpcnR1YWwoZW5naW5lKSk7CiAJR0VNX0JVR19PTihpOTE1X3JlcXVl
c3RfdGltZWxpbmUocnEpICE9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnRpbWVsaW5lKTsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggN2UwZjY3YmFiZTIwLi43ZThhMDM5ZTRmMjggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtOTYwLDkgKzk2MCw2IEBAIHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlIHsKIAogCXN0cnVjdCBwY2lfZGV2ICpicmlkZ2VfZGV2OwogCi0JLyogQ29udGV4
dCB1c2VkIGludGVybmFsbHkgdG8gaWRsZSB0aGUgR1BVIGFuZCBzZXR1cCBpbml0aWFsIHN0YXRl
ICovCi0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmtlcm5lbF9jb250ZXh0OwotCiAJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lW0k5MTVfTlVNX0VOR0lORVNdOwogCXN0cnVjdCByYl9y
b290IHVhYmlfZW5naW5lczsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggZjRjYmQzNzlk
Yjk1Li5iMjQ4MjVjNjkxZjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTA2Myw4ICsx
MDYzLDcgQEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2luZXNfcmVjb3JkX2RlZmF1bHRzKHN0cnVj
dCBpbnRlbF9ndCAqZ3QpCiAJCUdFTV9CVUdfT04oIWVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwog
CQllbmdpbmUtPnNlcmlhbCsrOyAvKiBmb3JjZSB0aGUga2VybmVsIGNvbnRleHQgc3dpdGNoICov
CiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5n
ZW1fY29udGV4dCwKLQkJCQkJICBlbmdpbmUpOworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQllcnIgPSBQVFJfRVJSKGNlKTsKIAkJ
CWdvdG8gb3V0OwpAQCAtMTIxNyw2ICsxMjE2LDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIAogCWludGVsX2d0X2luaXQoJmRldl9w
cml2LT5ndCk7CisJaTkxNV9nZW1faW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CiAKIAlyZXQgPSBp
bnRlbF9lbmdpbmVzX3NldHVwKCZkZXZfcHJpdi0+Z3QpOwogCWlmIChyZXQpIHsKQEAgLTEyMjQs
MTYgKzEyMjQsMTAgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCQlnb3RvIGVycl91bmxvY2s7CiAJfQogCi0JcmV0ID0gaTkxNV9nZW1faW5p
dF9jb250ZXh0cyhkZXZfcHJpdik7Ci0JaWYgKHJldCkgewotCQlHRU1fQlVHX09OKHJldCA9PSAt
RUlPKTsKLQkJZ290byBlcnJfc2NyYXRjaDsKLQl9Ci0KIAlyZXQgPSBpbnRlbF9lbmdpbmVzX2lu
aXQoJmRldl9wcml2LT5ndCk7CiAJaWYgKHJldCkgewogCQlHRU1fQlVHX09OKHJldCA9PSAtRUlP
KTsKLQkJZ290byBlcnJfY29udGV4dDsKKwkJZ290byBlcnJfc2NyYXRjaDsKIAl9CiAKIAlpbnRl
bF91Y19pbml0KCZkZXZfcHJpdi0+Z3QudWMpOwpAQCAtMTI5Nyw5ICsxMjkxLDYgQEAgaW50IGk5
MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlpbnRlbF91
Y19maW5pKCZkZXZfcHJpdi0+Z3QudWMpOwogCQlpbnRlbF9lbmdpbmVzX2NsZWFudXAoJmRldl9w
cml2LT5ndCk7CiAJfQotZXJyX2NvbnRleHQ6Ci0JaWYgKHJldCAhPSAtRUlPKQotCQlpOTE1X2dl
bV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2X3ByaXYpOwogZXJyX3NjcmF0Y2g6CiAJaW50
ZWxfZ3RfZHJpdmVyX3JlbGVhc2UoJmRldl9wcml2LT5ndCk7CiBlcnJfdW5sb2NrOgpAQCAtMTM2
NCw3ICsxMzU1LDYgQEAgdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCWludGVsX2VuZ2luZXNfY2xlYW51cCgm
ZGV2X3ByaXYtPmd0KTsKLQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2X3By
aXYpOwogCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+Z3QpOwogCiAJaW50ZWxf
d2FfbGlzdF9mcmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlzdCk7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2d0dC5jCmluZGV4IDYyMzlhOWFkYmYxNC4uYTIyYTJmZTQwOWM0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMTM2MywxMiArMTM2Myw4IEBAIHN0YXRpYyBpbnQgZ2Vu
OF9pbml0X3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJICogSWYgZXZl
cnlib2R5IGFncmVlcyB0byBub3QgdG8gd3JpdGUgaW50byB0aGUgc2NyYXRjaCBwYWdlLAogCSAq
IHdlIGNhbiByZXVzZSBpdCBmb3IgYWxsIHZtLCBrZWVwaW5nIGNvbnRleHRzIGFuZCBwcm9jZXNz
ZXMgc2VwYXJhdGUuCiAJICovCi0JaWYgKHZtLT5oYXNfcmVhZF9vbmx5ICYmCi0JICAgIHZtLT5p
OTE1LT5rZXJuZWxfY29udGV4dCAmJgotCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZt
KSB7Ci0JCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKmNsb25lID0KLQkJCXJjdV9kZXJlZmVy
ZW5jZV9wcm90ZWN0ZWQodm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSwKLQkJCQkJCSAgdHJ1
ZSk7IC8qIHN0YXRpYyAqLworCWlmICh2bS0+aGFzX3JlYWRfb25seSAmJiB2bS0+Z3QtPnZtICYm
ICFpOTE1X2lzX2dndHQodm0tPmd0LT52bSkpIHsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqY2xvbmUgPSB2bS0+Z3QtPnZtOwogCiAJCUdFTV9CVUdfT04oIWNsb25lLT5oYXNfcmVhZF9v
bmx5KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCAxOTI0ZDQ0MDgxZTkuLjI1ZGJk
MDFiODIyZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTIzNDAsOSArMjM0MCw2IEBA
IHN0YXRpYyBpbnQgbHJjX2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSwKIAkgKi8KIAlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2Nr
KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0
cy5saXN0LCBsaW5rKSB7Ci0JCWlmIChjdHggPT0gaTkxNS0+a2VybmVsX2NvbnRleHQpCi0JCQlj
b250aW51ZTsKLQogCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCiAJCQlj
b250aW51ZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCA2NzhiMzIwODk1
MDcuLjIwZWVlZjM4NjU3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTEy
MzYsOCArMTIzNiw4IEBAIHZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEsCiAKIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSkKIHsKLQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSBycS0+Y29udGV4dC0+Z2VtX2Nv
bnRleHQtPnNjaGVkOwogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqIGNvbnN0IHRsID0gaTkxNV9y
ZXF1ZXN0X3RpbWVsaW5lKHJxKTsKKwlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7fTsK
IAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpwcmV2OwogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdGwt
Pm11dGV4KTsKQEAgLTEyNDcsNiArMTI0Nyw5IEBAIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogCXByZXYgPSBfX2k5MTVfcmVxdWVzdF9jb21taXQocnEp
OwogCisJaWYgKHJxLT5jb250ZXh0LT5nZW1fY29udGV4dCkKKwkJYXR0ciA9IHJxLT5jb250ZXh0
LT5nZW1fY29udGV4dC0+c2NoZWQ7CisKIAkvKgogCSAqIEJvb3N0IGFjdHVhbCB3b3JrbG9hZHMg
cGFzdCBzZW1hcGhvcmVzIQogCSAqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9yZXF1ZXN0LmMKaW5kZXggNTBjYzdjYTlhZmJhLi5kMjlmNDRjZjMxNjIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTc0MSwxMCAr
NzQxLDggQEAgc3RhdGljIGludCBsaXZlX2VtcHR5X3JlcXVlc3Qodm9pZCAqYXJnKQogCiBzdGF0
aWMgc3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGk5MTUtPmtlcm5l
bF9jb250ZXh0OwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJY29uc3QgaW50
IGdlbiA9IElOVEVMX0dFTihpOTE1KTsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsK
IAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1MzIgKmNtZDsKIAlpbnQgZXJyOwpAQCAtNzUzLDkg
Kzc1MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnJlY3Vyc2l2ZV9iYXRjaChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBFUlJf
Q0FTVChvYmopOwogCi0Jdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKLQl2
bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsKLQlpOTE1X3ZtX3B1dCh2bSk7
CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBpOTE1LT5ndC52bSwgTlVMTCk7CiAJaWYg
KElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKIAkJZ290byBlcnI7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5kZXgg
ZTU4YjBiYzljZGI2Li5hNTM5ZDhiMzk2ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTYzLDcgKzYzLDYgQEAgc3RhdGljIHZv
aWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgJmk5MTUtPmd0LCBpZCkKIAkJbW9ja19lbmdpbmVfZnJlZShlbmdp
bmUpOwotCWk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhpOTE1KTsKIAogCWRyYWlu
X3dvcmtxdWV1ZShpOTE1LT53cSk7CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1
KTsKQEAgLTE3OSw2ICsxNzgsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19nZW1f
ZGV2aWNlKHZvaWQpCiAJbW9ja19pbml0X2NvbnRleHRzKGk5MTUpOwogCiAJbW9ja19pbml0X2dn
dHQoaTkxNSwgJmk5MTUtPmdndHQpOworCWk5MTUtPmd0LnZtID0gaTkxNV92bV9nZXQoJmk5MTUt
PmdndHQudm0pOwogCiAJbWt3cml0ZV9kZXZpY2VfaW5mbyhpOTE1KS0+ZW5naW5lX21hc2sgPSBC
SVQoMCk7CiAKQEAgLTE4NiwxMCArMTg2LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1v
Y2tfZ2VtX2RldmljZSh2b2lkKQogCWlmICghaTkxNS0+ZW5naW5lW1JDUzBdKQogCQlnb3RvIGVy
cl91bmxvY2s7CiAKLQlpOTE1LT5rZXJuZWxfY29udGV4dCA9IG1vY2tfY29udGV4dChpOTE1LCBO
VUxMKTsKLQlpZiAoIWk5MTUtPmtlcm5lbF9jb250ZXh0KQotCQlnb3RvIGVycl9lbmdpbmU7Ci0K
IAlpZiAobW9ja19lbmdpbmVfaW5pdChpOTE1LT5lbmdpbmVbUkNTMF0pKQogCQlnb3RvIGVycl9j
b250ZXh0OwogCkBAIC0xOTgsOCArMTk0LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1v
Y2tfZ2VtX2RldmljZSh2b2lkKQogCXJldHVybiBpOTE1OwogCiBlcnJfY29udGV4dDoKLQlpOTE1
X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7Ci1lcnJfZW5naW5lOgogCW1vY2tf
ZW5naW5lX2ZyZWUoaTkxNS0+ZW5naW5lW1JDUzBdKTsKIGVycl91bmxvY2s6CiAJZGVzdHJveV93
b3JrcXVldWUoaTkxNS0+d3EpOwotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=

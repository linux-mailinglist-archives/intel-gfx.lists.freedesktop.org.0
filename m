Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 824CEBDBAE
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 12:02:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 23FA36EB70;
	Wed, 25 Sep 2019 10:02:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5220B6EB75
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 10:01:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18609368-1500050 
 for multiple; Wed, 25 Sep 2019 11:01:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 11:01:17 +0100
Message-Id: <20190925100137.17956-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190925100137.17956-1-chris@chris-wilson.co.uk>
References: <20190925100137.17956-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/27] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRi
dWZmZXIuYyAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuYyAgIHwgICA0ICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlw
ZXMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAg
ICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgICAg
ICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMg
ICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyAgICAgICAg
IHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jICAgICAg
fCAgIDcgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCAgICB8
ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jICAgIHwg
IDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyAgICAgICAgfCAg
MTAgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYyB8ICAg
MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwgICAz
IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8IDI4OSAr
KysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAg
ICAgICAgfCAzMTkgKysrKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2FjdGl2ZV90eXBlcy5oICAgICAgfCAgMjMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtLmMgICAgICAgICAgICAgICB8ICA0MiArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2d0dC5jICAgICAgICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
cHVfZXJyb3IuYyAgICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYyAgICAgICAgICAgfCAgMzggKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuaCAgICAgICAgICAgfCAgIDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEu
YyAgICAgICAgICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9hY3RpdmUuYyAgfCAgMzIgKy0KIDI0IGZpbGVzIGNoYW5nZWQsIDI2NCBpbnNlcnRpb25z
KCspLCA1NjYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9mcm9udGJ1ZmZlci5jCmluZGV4IDY0MjhiOGRkNzBkMy4uODRiMTY0ZjMxODk1IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zyb250YnVmZmVy
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5j
CkBAIC0yNTcsNyArMjU3LDcgQEAgaW50ZWxfZnJvbnRidWZmZXJfZ2V0KHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopCiAJZnJvbnQtPm9iaiA9IG9iajsKIAlrcmVmX2luaXQoJmZyb250
LT5yZWYpOwogCWF0b21pY19zZXQoJmZyb250LT5iaXRzLCAwKTsKLQlpOTE1X2FjdGl2ZV9pbml0
KGk5MTUsICZmcm9udC0+d3JpdGUsCisJaTkxNV9hY3RpdmVfaW5pdCgmZnJvbnQtPndyaXRlLAog
CQkJIGZyb250YnVmZmVyX2FjdGl2ZSwKIAkJCSBpOTE1X2FjdGl2ZV9tYXlfc2xlZXAoZnJvbnRi
dWZmZXJfcmV0aXJlKSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfb3ZlcmxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9v
dmVybGF5LmMKaW5kZXggM2Y0YWMxZWU3NjY4Li5lMTJlMWE3NTNhZjAgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCkBAIC0xMzYwLDggKzEzNjAsNyBA
QCB2b2lkIGludGVsX292ZXJsYXlfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCW92ZXJsYXktPmNvbnRyYXN0ID0gNzU7CiAJb3ZlcmxheS0+c2F0dXJhdGlvbiA9IDE0
NjsKIAotCWk5MTVfYWN0aXZlX2luaXQoZGV2X3ByaXYsCi0JCQkgJm92ZXJsYXktPmxhc3RfZmxp
cCwKKwlpOTE1X2FjdGl2ZV9pbml0KCZvdmVybGF5LT5sYXN0X2ZsaXAsCiAJCQkgTlVMTCwgaW50
ZWxfb3ZlcmxheV9sYXN0X2ZsaXBfcmV0aXJlKTsKIAogCXJldCA9IGdldF9yZWdpc3RlcnMob3Zl
cmxheSwgT1ZFUkxBWV9ORUVEU19QSFlTSUNBTChkZXZfcHJpdikpOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggNGNkN2QyZWNmMWQ1Li45ZDg1YWFi
NjhkMzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpA
QCAtODY4LDIwICs4NjgsMTggQEAgc3RhdGljIGludCBjb250ZXh0X2JhcnJpZXJfdGFzayhzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJCXZvaWQgKCp0YXNrKSh2b2lkICpkYXRhKSwK
IAkJCQl2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4
LT5pOTE1OwogCXN0cnVjdCBjb250ZXh0X2JhcnJpZXJfdGFzayAqY2I7CiAJc3RydWN0IGk5MTVf
Z2VtX2VuZ2luZXNfaXRlciBpdDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVy
ciA9IDA7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlHRU1fQlVHX09OKCF0YXNrKTsKIAogCWNiID0ga21hbGxvYyhzaXplb2YoKmNiKSwgR0ZQX0tF
Uk5FTCk7CiAJaWYgKCFjYikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpOTE1X2FjdGl2ZV9pbml0
KGk5MTUsICZjYi0+YmFzZSwgTlVMTCwgY2JfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KCZj
Yi0+YmFzZSwgTlVMTCwgY2JfcmV0aXJlKTsKIAllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZj
Yi0+YmFzZSk7CiAJaWYgKGVycikgewogCQlrZnJlZShjYik7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5kZXggZDY5NWYxODdiNzkwLi5l
MjkxZGRmZWI3ZGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0X3R5cGVzLmgKQEAgLTgsNiArOCw3IEBACiAjZGVmaW5lIF9fSTkxNV9HRU1fT0JKRUNU
X1RZUEVTX0hfXwogCiAjaW5jbHVkZSA8ZHJtL2RybV9nZW0uaD4KKyNpbmNsdWRlIDx1YXBpL2Ry
bS9pOTE1X2RybS5oPgogCiAjaW5jbHVkZSAiaTkxNV9hY3RpdmUuaCIKICNpbmNsdWRlICJpOTE1
X3NlbGZ0ZXN0LmgiCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IGEx
MWFkNGQ5MTRjYS4uM2E0N2UxMTkwY2UxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcG0uYwpAQCAtMTYsMTQgKzE2LDExIEBAIHN0YXRpYyB2b2lkIGNhbGxfaWRsZV9iYXJyaWVy
cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3RydWN0IGxsaXN0X25vZGUgKm5v
ZGUsICpuZXh0OwogCiAJbGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0LCBsbGlzdF9kZWxf
YWxsKCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKSB7Ci0JCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0ICphY3RpdmUgPQorCQlzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYiA9CiAJCQljb250YWluZXJf
b2YoKHN0cnVjdCBsaXN0X2hlYWQgKilub2RlLAotCQkJCSAgICAgdHlwZW9mKCphY3RpdmUpLCBs
aW5rKTsKKwkJCQkgICAgIHR5cGVvZigqY2IpLCBub2RlKTsKIAotCQlJTklUX0xJU1RfSEVBRCgm
YWN0aXZlLT5saW5rKTsKLQkJUkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIE5VTEwp
OwotCi0JCWFjdGl2ZS0+cmV0aXJlKGFjdGl2ZSwgTlVMTCk7CisJCWNiLT5mdW5jKE5VTEwsIGNi
KTsKIAl9CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Nv
bnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCAw
NmZhYmRmMjA1Y2YuLjM1YTQwYzI4MjBhMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2NvbnRleHQuYwpAQCAtMjQwLDcgKzI0MCw3IEBAIGludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UsCiAKIAltdXRleF9pbml0KCZjZS0+cGluX211dGV4KTsKIAotCWk5
MTVfYWN0aXZlX2luaXQoY3R4LT5pOTE1LCAmY2UtPmFjdGl2ZSwKKwlpOTE1X2FjdGl2ZV9pbml0
KCZjZS0+YWN0aXZlLAogCQkJIF9faW50ZWxfY29udGV4dF9hY3RpdmUsIF9faW50ZWxfY29udGV4
dF9yZXRpcmUpOwogfQogCkBAIC0zMDcsNyArMzA3LDcgQEAgaW50IGludGVsX2NvbnRleHRfcHJl
cGFyZV9yZW1vdGVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQlyZXR1cm4g
ZXJyOwogCiAJCS8qIFF1ZXVlIHRoaXMgc3dpdGNoIGFmdGVyIGN1cnJlbnQgYWN0aXZpdHkgYnkg
dGhpcyBjb250ZXh0LiAqLwotCQllcnIgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmdGwtPmxh
c3RfcmVxdWVzdCwgcnEpOworCQllcnIgPSBpOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnRsLT5sYXN0
X3JlcXVlc3QsIHJxKTsKIAkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwogCQlpZiAoZXJyKQog
CQkJcmV0dXJuIGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2VuZ2luZV9wb29sLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9v
bC5jCmluZGV4IDgxZmFiMTAxZmRiNC4uM2NkYmQ1ZjhiNWJlIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMKQEAgLTk1LDcgKzk1LDcgQEAgbm9kZV9jcmVh
dGUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sLCBzaXplX3Qgc3opCiAJCXJldHVybiBF
UlJfUFRSKC1FTk9NRU0pOwogCiAJbm9kZS0+cG9vbCA9IHBvb2w7Ci0JaTkxNV9hY3RpdmVfaW5p
dChlbmdpbmUtPmk5MTUsICZub2RlLT5hY3RpdmUsIHBvb2xfYWN0aXZlLCBwb29sX3JldGlyZSk7
CisJaTkxNV9hY3RpdmVfaW5pdCgmbm9kZS0+YWN0aXZlLCBwb29sX2FjdGl2ZSwgcG9vbF9yZXRp
cmUpOwogCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChlbmdpbmUtPmk5
MTUsIHN6KTsKIAlpZiAoSVNfRVJSKG9iaikpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
ZXNldC5jCmluZGV4IGFlNjhjMzc4NmY2My4uZThjOGQwMDQxZThmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTgyOCwxMCArODI4LDEwIEBAIHN0YXRpYyBib29sIF9f
aW50ZWxfZ3RfdW5zZXRfd2VkZ2VkKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJICovCiAJc3Bpbl9s
b2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwogCWxpc3RfZm9yX2VhY2hfZW50
cnkodGwsICZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCBsaW5rKSB7Ci0JCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotCQlycSA9IGk5MTVfYWN0
aXZlX3JlcXVlc3RfZ2V0X3VubG9ja2VkKCZ0bC0+bGFzdF9yZXF1ZXN0KTsKLQkJaWYgKCFycSkK
KwkJZmVuY2UgPSBpOTE1X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOworCQlp
ZiAoIWZlbmNlKQogCQkJY29udGludWU7CiAKIAkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGlt
ZWxpbmVzLT5sb2NrLCBmbGFncyk7CkBAIC04NDMsOCArODQzLDggQEAgc3RhdGljIGJvb2wgX19p
bnRlbF9ndF91bnNldF93ZWRnZWQoc3RydWN0IGludGVsX2d0ICpndCkKIAkJICogKEk5MTVfRkVO
Q0VfVElNRU9VVCkgc28gdGhpcyB3YWl0IHNob3VsZCBub3QgYmUgdW5ib3VuZGVkCiAJCSAqIGlu
IHRoZSB3b3JzdCBjYXNlLgogCQkgKi8KLQkJZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdCgmcnEtPmZl
bmNlLCBmYWxzZSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCQlpOTE1X3JlcXVlc3RfcHV0KHJx
KTsKKwkJZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdChmZW5jZSwgZmFsc2UsIE1BWF9TQ0hFRFVMRV9U
SU1FT1VUKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAKIAkJLyogUmVzdGFydCBpdGVyYXRp
b24gYWZ0ZXIgZHJvcGluZyBsb2NrICovCiAJCXNwaW5fbG9ja19pcnFzYXZlKCZ0aW1lbGluZXMt
PmxvY2ssIGZsYWdzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jCmlu
ZGV4IDY1M2Y2MGU3ODM5Mi4uMGY5NTk2OTQzMDNjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3RpbWVsaW5lLmMKQEAgLTE3OCw4ICsxNzgsNyBAQCBjYWNoZWxpbmVfYWxsb2Moc3Ry
dWN0IGludGVsX3RpbWVsaW5lX2h3c3AgKmh3c3AsIHVuc2lnbmVkIGludCBjYWNoZWxpbmUpCiAJ
Y2wtPmh3c3AgPSBod3NwOwogCWNsLT52YWRkciA9IHBhZ2VfcGFja19iaXRzKHZhZGRyLCBjYWNo
ZWxpbmUpOwogCi0JaTkxNV9hY3RpdmVfaW5pdChod3NwLT5ndC0+aTkxNSwgJmNsLT5hY3RpdmUs
Ci0JCQkgX19jYWNoZWxpbmVfYWN0aXZlLCBfX2NhY2hlbGluZV9yZXRpcmUpOworCWk5MTVfYWN0
aXZlX2luaXQoJmNsLT5hY3RpdmUsIF9fY2FjaGVsaW5lX2FjdGl2ZSwgX19jYWNoZWxpbmVfcmV0
aXJlKTsKIAogCXJldHVybiBjbDsKIH0KQEAgLTI1NSw3ICsyNTQsNyBAQCBpbnQgaW50ZWxfdGlt
ZWxpbmVfaW5pdChzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lLAogCiAJbXV0ZXhfaW5p
dCgmdGltZWxpbmUtPm11dGV4KTsKIAotCUlOSVRfQUNUSVZFX1JFUVVFU1QoJnRpbWVsaW5lLT5s
YXN0X3JlcXVlc3QsICZ0aW1lbGluZS0+bXV0ZXgpOworCUlOSVRfQUNUSVZFX0ZFTkNFKCZ0aW1l
bGluZS0+bGFzdF9yZXF1ZXN0LCAmdGltZWxpbmUtPm11dGV4KTsKIAlJTklUX0xJU1RfSEVBRCgm
dGltZWxpbmUtPnJlcXVlc3RzKTsKIAogCWk5MTVfc3luY21hcF9pbml0KCZ0aW1lbGluZS0+c3lu
Yyk7CkBAIC00NDMsNyArNDQyLDcgQEAgX19pbnRlbF90aW1lbGluZV9nZXRfc2Vxbm8oc3RydWN0
IGludGVsX3RpbWVsaW5lICp0bCwKIAkgKiBmcmVlIGl0IGFmdGVyIHRoZSBjdXJyZW50IHJlcXVl
c3QgaXMgcmV0aXJlZCwgd2hpY2ggZW5zdXJlcyB0aGF0CiAJICogYWxsIHdyaXRlcyBpbnRvIHRo
ZSBjYWNoZWxpbmUgZnJvbSBwcmV2aW91cyByZXF1ZXN0cyBhcmUgY29tcGxldGUuCiAJICovCi0J
ZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ0bC0+aHdzcF9jYWNoZWxpbmUtPmFjdGl2ZSwgdGwsIHJx
KTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnRsLT5od3NwX2NhY2hlbGluZS0+YWN0aXZlLCB0
bCwgJnJxLT5mZW5jZSk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfY2FjaGVsaW5lOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZV90eXBlcy5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaAppbmRleCBjNjY4
YzRjNTBlNzUuLjdmYWY4MWY5NDM1NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF90aW1lbGluZV90eXBlcy5oCkBAIC02Myw3ICs2Myw3IEBAIHN0cnVjdCBpbnRlbF90aW1l
bGluZSB7CiAJICogdGhlIHJlcXVlc3QgdXNpbmcgaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmVx
dWVzdF9yY3UoKSwgb3IgaG9sZCB0aGUKIAkgKiBzdHJ1Y3RfbXV0ZXguCiAJICovCi0Jc3RydWN0
IGk5MTVfYWN0aXZlX3JlcXVlc3QgbGFzdF9yZXF1ZXN0OworCXN0cnVjdCBpOTE1X2FjdGl2ZV9m
ZW5jZSBsYXN0X3JlcXVlc3Q7CiAKIAkvKioKIAkgKiBXZSB0cmFjayB0aGUgbW9zdCByZWNlbnQg
c2Vxbm8gdGhhdCB3ZSB3YWl0IG9uIGluIGV2ZXJ5IGNvbnRleHQgc28KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRleCA0Y2UxZTI1NDMzZDIuLmU2YmNiZTdh
YjVlMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAt
NDcsMjQgKzQ3LDIwIEBAIHN0YXRpYyBpbnQgY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSkKIAogCW11dGV4X2xvY2soJnRsLT5tdXRleCk7CiAJZG8gewotCQlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAJCWxvbmcgdGltZW91
dDsKIAotCQlyY3VfcmVhZF9sb2NrKCk7Ci0JCXJxID0gcmN1X2RlcmVmZXJlbmNlKHRsLT5sYXN0
X3JlcXVlc3QucmVxdWVzdCk7Ci0JCWlmIChycSkKLQkJCXJxID0gaTkxNV9yZXF1ZXN0X2dldF9y
Y3UocnEpOwotCQlyY3VfcmVhZF91bmxvY2soKTsKLQkJaWYgKCFycSkKKwkJZmVuY2UgPSBpOTE1
X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOworCQlpZiAoIWZlbmNlKQogCQkJ
YnJlYWs7CiAKLQkJdGltZW91dCA9IGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDEwKTsK
KwkJdGltZW91dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoZmVuY2UsIGZhbHNlLCBIWiAvIDEw
KTsKIAkJaWYgKHRpbWVvdXQgPCAwKQogCQkJZXJyID0gdGltZW91dDsKIAkJZWxzZQotCQkJaTkx
NV9yZXF1ZXN0X3JldGlyZV91cHRvKHJxKTsKKwkJCWk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byh0
b19yZXF1ZXN0KGZlbmNlKSk7CiAKLQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJCWRtYV9mZW5j
ZV9wdXQoZmVuY2UpOwogCX0gd2hpbGUgKCFlcnIpOwogCW11dGV4X3VubG9jaygmdGwtPm11dGV4
KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCAyMmVhMmU3NDcw
NjQuLjhlZWM0ZWFkMTJhNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMK
QEAgLTk5NCw5ICs5OTQsMTMgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15X3Jl
cXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWlmICghcnEpCiAJCXJldHVy
biBOVUxMOwogCi0JSU5JVF9MSVNUX0hFQUQoJnJxLT5hY3RpdmVfbGlzdCk7CiAJcnEtPmVuZ2lu
ZSA9IGVuZ2luZTsKIAorCXNwaW5fbG9ja19pbml0KCZycS0+bG9jayk7CisJSU5JVF9MSVNUX0hF
QUQoJnJxLT5mZW5jZS5jYl9saXN0KTsKKwlycS0+ZmVuY2UubG9jayA9ICZycS0+bG9jazsKKwly
cS0+ZmVuY2Uub3BzID0gJmk5MTVfZmVuY2Vfb3BzOworCiAJaTkxNV9zY2hlZF9ub2RlX2luaXQo
JnJxLT5zY2hlZCk7CiAKIAkvKiBtYXJrIHRoaXMgcmVxdWVzdCBhcyBwZXJtYW5lbnRseSBpbmNv
bXBsZXRlICovCkBAIC0xMDg5LDggKzEwOTMsOCBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nf
d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCQl9CiAKIAkJCQkvKiBEaXNhYmxlIE5FV0NMSUVO
VCBwcm9tb3Rpb24gKi8KLQkJCQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZpOTE1X3JlcXVl
c3RfdGltZWxpbmUocnFbaV0pLT5sYXN0X3JlcXVlc3QsCi0JCQkJCQkJICBkdW1teSk7CisJCQkJ
X19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJmk5MTVfcmVxdWVzdF90aW1lbGluZShycVtpXSktPmxh
c3RfcmVxdWVzdCwKKwkJCQkJCQkmZHVtbXktPmZlbmNlKTsKIAkJCQlpOTE1X3JlcXVlc3RfYWRk
KHJxW2ldKTsKIAkJCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RzL21vY2tfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
cy9tb2NrX3RpbWVsaW5lLmMKaW5kZXggNTk4MTcwZWZjYWY2Li4yYTc3YzA1MWYzNmEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYwpA
QCAtMTUsNyArMTUsNyBAQCB2b2lkIG1vY2tfdGltZWxpbmVfaW5pdChzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKnRpbWVsaW5lLCB1NjQgY29udGV4dCkKIAogCW11dGV4X2luaXQoJnRpbWVsaW5lLT5t
dXRleCk7CiAKLQlJTklUX0FDVElWRV9SRVFVRVNUKCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LCAm
dGltZWxpbmUtPm11dGV4KTsKKwlJTklUX0FDVElWRV9GRU5DRSgmdGltZWxpbmUtPmxhc3RfcmVx
dWVzdCwgJnRpbWVsaW5lLT5tdXRleCk7CiAJSU5JVF9MSVNUX0hFQUQoJnRpbWVsaW5lLT5yZXF1
ZXN0cyk7CiAKIAlpOTE1X3N5bmNtYXBfaW5pdCgmdGltZWxpbmUtPnN5bmMpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L3NjaGVkdWxlci5jCmluZGV4IDZjNzlkMTZiMzgxZS4uMDNmNTY3MDg0NTQ4IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC0zODUsMTEgKzM4NSw4IEBAIGlu
dGVsX2d2dF93b3JrbG9hZF9yZXFfYWxsb2Moc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndv
cmtsb2FkKQogewogCXN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1ID0gd29ya2xvYWQtPnZncHU7CiAJ
c3RydWN0IGludGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJtaXNzaW9uOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJp
di0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpZiAod29ya2xvYWQtPnJlcSkKIAkJcmV0dXJuIDA7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCmluZGV4IDdjYTA2NjY4OGI5OC4uZjIzNTkw
ZWM5ZTY4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKQEAgLTEyLDggKzEyLDYgQEAK
ICNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1ZGUgImk5MTVfZ2xvYmFscy5oIgogCi0j
ZGVmaW5lIEJLTChyZWYpICgmKHJlZiktPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpCi0KIC8qCiAg
KiBBY3RpdmUgcmVmcyBtZW1vcnkgbWFuYWdlbWVudAogICoKQEAgLTI3LDM1ICsyNSwzNSBAQCBz
dGF0aWMgc3RydWN0IGk5MTVfZ2xvYmFsX2FjdGl2ZSB7CiB9IGdsb2JhbDsKIAogc3RydWN0IGFj
dGl2ZV9ub2RlIHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCBiYXNlOworCXN0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSBiYXNlOwogCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmOwogCXN0cnVj
dCByYl9ub2RlIG5vZGU7CiAJdTY0IHRpbWVsaW5lOwogfTsKIAogc3RhdGljIGlubGluZSBzdHJ1
Y3QgYWN0aXZlX25vZGUgKgotbm9kZV9mcm9tX2FjdGl2ZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVx
dWVzdCAqYWN0aXZlKQorbm9kZV9mcm9tX2FjdGl2ZShzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2Ug
KmFjdGl2ZSkKIHsKIAlyZXR1cm4gY29udGFpbmVyX29mKGFjdGl2ZSwgc3RydWN0IGFjdGl2ZV9u
b2RlLCBiYXNlKTsKIH0KIAogI2RlZmluZSB0YWtlX3ByZWFsbG9jYXRlZF9iYXJyaWVycyh4KSBs
bGlzdF9kZWxfYWxsKCYoeCktPnByZWFsbG9jYXRlZF9iYXJyaWVycykKIAotc3RhdGljIGlubGlu
ZSBib29sIGlzX2JhcnJpZXIoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZSkKK3N0YXRpYyBpbmxpbmUgYm9vbCBpc19iYXJyaWVyKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2
ZV9mZW5jZSAqYWN0aXZlKQogewotCXJldHVybiBJU19FUlIocmN1X2FjY2Vzc19wb2ludGVyKGFj
dGl2ZS0+cmVxdWVzdCkpOworCXJldHVybiBJU19FUlIocmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2
ZS0+ZmVuY2UpKTsKIH0KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgbGxpc3Rfbm9kZSAqYmFycmll
cl90b19sbChzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUpCiB7CiAJR0VNX0JVR19PTighaXNfYmFy
cmllcigmbm9kZS0+YmFzZSkpOwotCXJldHVybiAoc3RydWN0IGxsaXN0X25vZGUgKikmbm9kZS0+
YmFzZS5saW5rOworCXJldHVybiAoc3RydWN0IGxsaXN0X25vZGUgKikmbm9kZS0+YmFzZS5jYi5u
b2RlOwogfQogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgogX19iYXJy
aWVyX3RvX2VuZ2luZShzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUpCiB7Ci0JcmV0dXJuIChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICopUkVBRF9PTkNFKG5vZGUtPmJhc2UubGluay5wcmV2KTsKKwly
ZXR1cm4gKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKilSRUFEX09OQ0Uobm9kZS0+YmFzZS5jYi5u
b2RlLnByZXYpOwogfQogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgpA
QCAtNjgsNyArNjYsNyBAQCBiYXJyaWVyX3RvX2VuZ2luZShzdHJ1Y3QgYWN0aXZlX25vZGUgKm5v
ZGUpCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBhY3RpdmVfbm9kZSAqYmFycmllcl9mcm9tX2xsKHN0
cnVjdCBsbGlzdF9ub2RlICp4KQogewogCXJldHVybiBjb250YWluZXJfb2YoKHN0cnVjdCBsaXN0
X2hlYWQgKil4LAotCQkJICAgIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFzZS5saW5rKTsKKwkJCSAg
ICBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UuY2Iubm9kZSk7CiB9CiAKICNpZiBJU19FTkFCTEVE
KENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pICYmIElTX0VOQUJMRUQoQ09ORklHX0RFQlVHX09C
SkVDVFMpCkBAIC0xNDcsMTUgKzE0NSwxOCBAQCBfX2FjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCiAJaWYgKCFyZXRpcmUpCiAJCXJldHVybjsKIAotCUdFTV9CVUdfT04ocmN1
X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpOworCUdFTV9CVUdfT04ocmN1X2FjY2Vzc19wb2lu
dGVyKHJlZi0+ZXhjbC5mZW5jZSkpOwogCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlf
c2FmZShpdCwgbiwgJnJvb3QsIG5vZGUpIHsKLQkJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9yZXF1
ZXN0X2lzc2V0KCZpdC0+YmFzZSkpOworCQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2ZlbmNlX2lz
c2V0KCZpdC0+YmFzZSkpOwogCQlrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFsLnNsYWJfY2FjaGUsIGl0
KTsKIAl9CiAKIAkvKiBBZnRlciB0aGUgZmluYWwgcmV0aXJlLCB0aGUgZW50aXJlIHN0cnVjdCBt
YXkgYmUgZnJlZWQgKi8KIAlpZiAocmVmLT5yZXRpcmUpCiAJCXJlZi0+cmV0aXJlKHJlZik7CisK
KwkvKiAuLi4gZXhjZXB0IGlmIHlvdSB3YWl0IG9uIGl0LCB5b3UgbXVzdCBtYW5hZ2UgeW91ciBv
d24gcmVmZXJlbmNlcyEgKi8KKwl3YWtlX3VwX3ZhcihyZWYpOwogfQogCiBzdGF0aWMgdm9pZApA
QCAtMTg5LDEyICsxOTAsMjAgQEAgYWN0aXZlX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZikKIH0KIAogc3RhdGljIHZvaWQKLW5vZGVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0ICpiYXNlLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK25vZGVfcmV0aXJlKHN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsKLQlhY3RpdmVfcmV0
aXJlKG5vZGVfZnJvbV9hY3RpdmUoYmFzZSktPnJlZik7CisJaTkxNV9hY3RpdmVfZmVuY2VfY2Io
ZmVuY2UsIGNiKTsKKwlhY3RpdmVfcmV0aXJlKGNvbnRhaW5lcl9vZihjYiwgc3RydWN0IGFjdGl2
ZV9ub2RlLCBiYXNlLmNiKS0+cmVmKTsKIH0KIAotc3RhdGljIHN0cnVjdCBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0ICoKK3N0YXRpYyB2b2lkCitleGNsX3JldGlyZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCit7CisJaTkxNV9hY3RpdmVfZmVuY2VfY2IoZmVu
Y2UsIGNiKTsKKwlhY3RpdmVfcmV0aXJlKGNvbnRhaW5lcl9vZihjYiwgc3RydWN0IGk5MTVfYWN0
aXZlLCBleGNsLmNiKSk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKgog
YWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKnRsKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSwgKnByZWFsbG9jOwpAQCAt
MjM4LDcgKzI0Nyw3IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwg
c3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKIAl9CiAKIAlub2RlID0gcHJlYWxsb2M7Ci0JaTkx
NV9hY3RpdmVfcmVxdWVzdF9pbml0KCZub2RlLT5iYXNlLCAmdGwtPm11dGV4LCBOVUxMLCBub2Rl
X3JldGlyZSk7CisJX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZub2RlLT5iYXNlLCAmdGwtPm11
dGV4LCBOVUxMLCBub2RlX3JldGlyZSk7CiAJbm9kZS0+cmVmID0gcmVmOwogCW5vZGUtPnRpbWVs
aW5lID0gaWR4OwogCkBAIC0yNTMsOCArMjYyLDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQogCXJldHVybiAmbm9k
ZS0+YmFzZTsKIH0KIAotdm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCi0JCQlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKK3ZvaWQgX19pOTE1X2Fj
dGl2ZV9pbml0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkJaW50ICgqYWN0aXZlKShzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiksCiAJCQl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZiksCiAJCQlzdHJ1Y3QgbG9ja19jbGFzc19rZXkgKmtleSkKQEAgLTI2MywxOSArMjcx
LDE4IEBAIHZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCiAJZGVidWdfYWN0aXZlX2luaXQocmVmKTsKIAotCXJlZi0+aTkxNSA9IGk5MTU7CiAJ
cmVmLT5mbGFncyA9IDA7CiAJcmVmLT5hY3RpdmUgPSBhY3RpdmU7CiAJcmVmLT5yZXRpcmUgPSBw
dHJfdW5wYWNrX2JpdHMocmV0aXJlLCAmYml0cywgMik7CiAJaWYgKGJpdHMgJiBJOTE1X0FDVElW
RV9NQVlfU0xFRVApCiAJCXJlZi0+ZmxhZ3MgfD0gSTkxNV9BQ1RJVkVfUkVUSVJFX1NMRUVQUzsK
IAotCXJlZi0+ZXhjbCA9IE5VTEw7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsKIAlyZWYtPmNhY2hl
ID0gTlVMTDsKIAlpbml0X2xsaXN0X2hlYWQoJnJlZi0+cHJlYWxsb2NhdGVkX2JhcnJpZXJzKTsK
IAlhdG9taWNfc2V0KCZyZWYtPmNvdW50LCAwKTsKIAlfX211dGV4X2luaXQoJnJlZi0+bXV0ZXgs
ICJpOTE1X2FjdGl2ZSIsIGtleSk7CisJX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZyZWYtPmV4
Y2wsICZyZWYtPm11dGV4LCBOVUxMLCBleGNsX3JldGlyZSk7CiAJSU5JVF9XT1JLKCZyZWYtPndv
cmssIGFjdGl2ZV93b3JrKTsKIH0KIApAQCAtMzI5LDkgKzMzNiw5IEBAIF9fYWN0aXZlX2RlbF9i
YXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUp
CiAKIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAgICBz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLAotCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCAqYWN0aXZlOworCXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlOwogCWlu
dCBlcnI7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwpAQCAtMzU0LDY2ICsz
NjEsMzkgQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJ
ICogcmVxdWVzdCB0aGF0IHdlIHdhbnQgdG8gZW1pdCBvbiB0aGUga2VybmVsX2NvbnRleHQuCiAJ
CSAqLwogCQlfX2FjdGl2ZV9kZWxfYmFycmllcihyZWYsIG5vZGVfZnJvbV9hY3RpdmUoYWN0aXZl
KSk7Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQkJSU5JVF9M
SVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7Ci0JfSBlbHNlIHsKLQkJaWYgKCFpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X2lzc2V0KGFjdGl2ZSkpCi0JCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKKwkJUkNV
X0lOSVRfUE9JTlRFUihhY3RpdmUtPmZlbmNlLCBOVUxMKTsKKwkJYXRvbWljX2RlYygmcmVmLT5j
b3VudCk7CiAJfQotCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZyZWYtPmNvdW50KSk7Ci0JX19p
OTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChhY3RpdmUsIHJxKTsKKwlpZiAoIV9faTkxNV9hY3RpdmVf
ZmVuY2Vfc2V0KGFjdGl2ZSwgZmVuY2UpKQorCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKIAog
b3V0OgogCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0
aWMgdm9pZCBleGNsX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmYsIHN0cnVjdCBkbWFfZmVuY2VfY2Ig
KmNiKQotewotCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmID0gY29udGFpbmVyX29mKGNiLCB0eXBl
b2YoKnJlZiksIGV4Y2xfY2IpOwotCi0JUkNVX0lOSVRfUE9JTlRFUihyZWYtPmV4Y2wsIE5VTEwp
OwotCWRtYV9mZW5jZV9wdXQoZik7Ci0KLQlhY3RpdmVfcmV0aXJlKHJlZik7Ci19Ci0KIHZvaWQg
aTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0
IGRtYV9mZW5jZSAqZikKIHsKIAkvKiBXZSBleHBlY3QgdGhlIGNhbGxlciB0byBtYW5hZ2UgdGhl
IGV4Y2x1c2l2ZSB0aW1lbGluZSBvcmRlcmluZyAqLwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVf
aXNfaWRsZShyZWYpKTsKIAotCWRtYV9mZW5jZV9nZXQoZik7Ci0KLQlyY3VfcmVhZF9sb2NrKCk7
Ci0JaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKSB7Ci0JCXN0cnVjdCBkbWFfZmVu
Y2UgKm9sZDsKLQotCQlvbGQgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZyZWYtPmV4Y2wpOwot
CQlpZiAob2xkKSB7Ci0JCQlpZiAoZG1hX2ZlbmNlX3JlbW92ZV9jYWxsYmFjayhvbGQsICZyZWYt
PmV4Y2xfY2IpKQotCQkJCWF0b21pY19kZWMoJnJlZi0+Y291bnQpOwotCQkJZG1hX2ZlbmNlX3B1
dChvbGQpOwotCQl9Ci0JfQotCXJjdV9yZWFkX3VubG9jaygpOwotCi0JYXRvbWljX2luYygmcmVm
LT5jb3VudCk7Ci0JcmN1X2Fzc2lnbl9wb2ludGVyKHJlZi0+ZXhjbCwgZik7CisJbXV0ZXhfYWNx
dWlyZSgmcmVmLT5tdXRleC5kZXBfbWFwLCAwLCAwLCBfVEhJU19JUF8pOworCWlmICghX19pOTE1
X2FjdGl2ZV9mZW5jZV9zZXQoJnJlZi0+ZXhjbCwgZikpCisJCWF0b21pY19pbmMoJnJlZi0+Y291
bnQpOworCW11dGV4X3JlbGVhc2UoJnJlZi0+bXV0ZXguZGVwX21hcCwgMCwgX1RISVNfSVBfKTsK
K30KIAotCWlmIChkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYsICZyZWYtPmV4Y2xfY2IsIGV4Y2xf
Y2IpKSB7Ci0JCVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKLQkJYXRvbWljX2Rl
YygmcmVmLT5jb3VudCk7Ci0JCWRtYV9mZW5jZV9wdXQoZik7Ci0JfQorYm9vbCBpOTE1X2FjdGl2
ZV9hY3F1aXJlX2lmX2J1c3koc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJZGVidWdfYWN0
aXZlX2Fzc2VydChyZWYpOworCXJldHVybiBhdG9taWNfYWRkX3VubGVzcygmcmVmLT5jb3VudCwg
MSwgMCk7CiB9CiAKIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAq
cmVmKQogewogCWludCBlcnI7CiAKLQlkZWJ1Z19hY3RpdmVfYXNzZXJ0KHJlZik7Ci0JaWYgKGF0
b21pY19hZGRfdW5sZXNzKCZyZWYtPmNvdW50LCAxLCAwKSkKKwlpZiAoaTkxNV9hY3RpdmVfYWNx
dWlyZV9pZl9idXN5KHJlZikpCiAJCXJldHVybiAwOwogCiAJZXJyID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZyZWYtPm11dGV4KTsKQEAgLTQzOCwxMjEgKzQxOCw1NyBAQCB2b2lkIGk5MTVf
YWN0aXZlX3JlbGVhc2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJYWN0aXZlX3JldGlyZShy
ZWYpOwogfQogCi1zdGF0aWMgdm9pZCBfX2FjdGl2ZV91bmdyYWIoc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYpCi17Ci0JY2xlYXJfYW5kX3dha2VfdXBfYml0KEk5MTVfQUNUSVZFX0dSQUJfQklULCAm
cmVmLT5mbGFncyk7Ci19Ci0KLWJvb2wgaTkxNV9hY3RpdmVfdHJ5Z3JhYihzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKK3N0YXRpYyB2b2lkIGVuYWJsZV9zaWduYWxpbmcoc3RydWN0IGk5MTVfYWN0
aXZlX2ZlbmNlICphY3RpdmUpCiB7Ci0JZGVidWdfYWN0aXZlX2Fzc2VydChyZWYpOwotCi0JaWYg
KHRlc3RfYW5kX3NldF9iaXQoSTkxNV9BQ1RJVkVfR1JBQl9CSVQsICZyZWYtPmZsYWdzKSkKLQkJ
cmV0dXJuIGZhbHNlOwotCi0JaWYgKCFhdG9taWNfYWRkX3VubGVzcygmcmVmLT5jb3VudCwgMSwg
MCkpIHsKLQkJX19hY3RpdmVfdW5ncmFiKHJlZik7Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci0KLQly
ZXR1cm4gdHJ1ZTsKLX0KKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotdm9pZCBpOTE1X2Fj
dGl2ZV91bmdyYWIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCi17Ci0JR0VNX0JVR19PTighdGVz
dF9iaXQoSTkxNV9BQ1RJVkVfR1JBQl9CSVQsICZyZWYtPmZsYWdzKSk7Ci0KLQlhY3RpdmVfcmV0
aXJlKHJlZik7Ci0JX19hY3RpdmVfdW5ncmFiKHJlZik7Ci19Ci0KLXN0YXRpYyBpbnQgZXhjbF93
YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCXN0cnVjdCBkbWFfZmVuY2UgKm9sZDsK
LQlpbnQgZXJyID0gMDsKLQotCWlmICghcmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpCi0J
CXJldHVybiAwOwotCi0JcmN1X3JlYWRfbG9jaygpOwotCW9sZCA9IGRtYV9mZW5jZV9nZXRfcmN1
X3NhZmUoJnJlZi0+ZXhjbCk7Ci0JcmN1X3JlYWRfdW5sb2NrKCk7Ci0JaWYgKG9sZCkgewotCQll
cnIgPSBkbWFfZmVuY2Vfd2FpdChvbGQsIHRydWUpOwotCQlkbWFfZmVuY2VfcHV0KG9sZCk7Ci0J
fQorCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KGFjdGl2ZSk7CisJaWYgKCFmZW5jZSkK
KwkJcmV0dXJuOwogCi0JcmV0dXJuIGVycjsKKwlkbWFfZmVuY2VfZW5hYmxlX3N3X3NpZ25hbGlu
ZyhmZW5jZSk7CisJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiB9CiAKIGludCBpOTE1X2FjdGl2ZV93
YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQs
ICpuOwotCWludCBlcnI7CisJaW50IGVyciA9IDA7CiAKIAltaWdodF9zbGVlcCgpOwotCW1pZ2h0
X2xvY2soJnJlZi0+bXV0ZXgpOwogCi0JaWYgKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSkKKwlp
ZiAoIWk5MTVfYWN0aXZlX2FjcXVpcmVfaWZfYnVzeShyZWYpKQogCQlyZXR1cm4gMDsKIAotCWVy
ciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmcmVmLT5tdXRleCk7Ci0JaWYgKGVycikKLQkJ
cmV0dXJuIGVycjsKLQotCWlmICghYXRvbWljX2FkZF91bmxlc3MoJnJlZi0+Y291bnQsIDEsIDAp
KSB7Ci0JCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7Ci0JCXJldHVybiAwOwotCX0KLQotCWVy
ciA9IGV4Y2xfd2FpdChyZWYpOwotCWlmIChlcnIpCi0JCWdvdG8gb3V0OwotCisJLyogRmx1c2gg
bGF6eSBzaWduYWxzICovCisJZW5hYmxlX3NpZ25hbGluZygmcmVmLT5leGNsKTsKIAlyYnRyZWVf
cG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRyZWUsIG5vZGUpIHsK
LQkJaWYgKGlzX2JhcnJpZXIoJml0LT5iYXNlKSkgeyAvKiB1bmNvbm5lY3RlZCBpZGxlLWJhcnJp
ZXIgKi8KLQkJCWVyciA9IC1FQlVTWTsKLQkJCWJyZWFrOwotCQl9CisJCWlmIChpc19iYXJyaWVy
KCZpdC0+YmFzZSkpIC8qIHVuY29ubmVjdGVkIGlkbGUgYmFycmllciAqLworCQkJY29udGludWU7
CiAKLQkJZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoJml0LT5iYXNlLCBCS0wocmVm
KSk7Ci0JCWlmIChlcnIpCi0JCQlicmVhazsKKwkJZW5hYmxlX3NpZ25hbGluZygmaXQtPmJhc2Up
OwogCX0KKwkvKiBBbnkgZmVuY2UgYWRkZWQgYWZ0ZXIgdGhlIHdhaXQgYmVnaW5zIHdpbGwgbm90
IGJlIGF1dG8tc2lnbmFsZWQgKi8KIAotb3V0OgotCV9fYWN0aXZlX3JldGlyZShyZWYpOworCWk5
MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0JaWYg
KHdhaXRfb25fYml0KCZyZWYtPmZsYWdzLCBJOTE1X0FDVElWRV9HUkFCX0JJVCwgVEFTS19LSUxM
QUJMRSkpCisJaWYgKHdhaXRfdmFyX2V2ZW50X2ludGVycnVwdGlibGUocmVmLCBpOTE1X2FjdGl2
ZV9pc19pZGxlKHJlZikpKQogCQlyZXR1cm4gLUVJTlRSOwogCi0JZmx1c2hfd29yaygmcmVmLT53
b3JrKTsKLQlpZiAoIWk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSkKLQkJcmV0dXJuIC1FQlVTWTsK
LQogCXJldHVybiAwOwogfQogCi1pbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJCSAgICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0ICphY3RpdmUpCi17Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqYmFycmllciA9Ci0JCWk5
MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGFjdGl2ZSwgJnJxLT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQotCXJldHVybiBiYXJyaWVyID8gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycSwg
JmJhcnJpZXItPmZlbmNlKSA6IDA7Ci19Ci0KIGludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZl
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlp
bnQgZXJyID0gMDsKIAotCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkgeworCWlm
IChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsLmZlbmNlKSkgewogCQlzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZTsKIAogCQlyY3VfcmVhZF9sb2NrKCk7Ci0JCWZlbmNlID0gZG1hX2ZlbmNlX2dl
dF9yY3Vfc2FmZSgmcmVmLT5leGNsKTsKKwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZl
KCZyZWYtPmV4Y2wuZmVuY2UpOwogCQlyY3VfcmVhZF91bmxvY2soKTsKIAkJaWYgKGZlbmNlKSB7
CiAJCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CkBAIC01
NzgsNyArNDk0LDcgQEAgdm9pZCBpOTE1X2FjdGl2ZV9maW5pKHN0cnVjdCBpOTE1X2FjdGl2ZSAq
cmVmKQogCiBzdGF0aWMgaW5saW5lIGJvb2wgaXNfaWRsZV9iYXJyaWVyKHN0cnVjdCBhY3RpdmVf
bm9kZSAqbm9kZSwgdTY0IGlkeCkKIHsKLQlyZXR1cm4gbm9kZS0+dGltZWxpbmUgPT0gaWR4ICYm
ICFpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZub2RlLT5iYXNlKTsKKwlyZXR1cm4gbm9kZS0+
dGltZWxpbmUgPT0gaWR4ICYmICFpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCgmbm9kZS0+YmFzZSk7
CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgYWN0aXZlX25vZGUgKnJldXNlX2lkbGVfYmFycmllcihzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKQEAgLTY5OCwxMyArNjE0LDEzIEBAIGludCBp
OTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYsCiAJCQlub2RlLT5iYXNlLmxvY2sgPQogCQkJCSZlbmdpbmUtPmtlcm5lbF9jb250ZXh0
LT50aW1lbGluZS0+bXV0ZXg7CiAjZW5kaWYKLQkJCVJDVV9JTklUX1BPSU5URVIobm9kZS0+YmFz
ZS5yZXF1ZXN0LCBOVUxMKTsKLQkJCW5vZGUtPmJhc2UucmV0aXJlID0gbm9kZV9yZXRpcmU7CisJ
CQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJhc2UuZmVuY2UsIE5VTEwpOworCQkJbm9kZS0+YmFz
ZS5jYi5mdW5jID0gbm9kZV9yZXRpcmU7CiAJCQlub2RlLT50aW1lbGluZSA9IGlkeDsKIAkJCW5v
ZGUtPnJlZiA9IHJlZjsKIAkJfQogCi0JCWlmICghaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgm
bm9kZS0+YmFzZSkpIHsKKwkJaWYgKCFpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCgmbm9kZS0+YmFz
ZSkpIHsKIAkJCS8qCiAJCQkgKiBNYXJrIHRoaXMgYXMgYmVpbmcgKm91ciogdW5jb25uZWN0ZWQg
cHJvdG8tbm9kZS4KIAkJCSAqCkBAIC03MTQsOCArNjMwLDggQEAgaW50IGk5MTVfYWN0aXZlX2Fj
cXVpcmVfcHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCSAq
IGFuZCB0aGVuIHdlIGNhbiB1c2UgdGhlIHJiX25vZGUgYW5kIGxpc3QgcG9pbnRlcnMKIAkJCSAq
IGZvciBvdXIgdHJhY2tpbmcgb2YgdGhlIHBlbmRpbmcgYmFycmllci4KIAkJCSAqLwotCQkJUkNV
X0lOSVRfUE9JTlRFUihub2RlLT5iYXNlLnJlcXVlc3QsIEVSUl9QVFIoLUVBR0FJTikpOwotCQkJ
bm9kZS0+YmFzZS5saW5rLnByZXYgPSAodm9pZCAqKWVuZ2luZTsKKwkJCVJDVV9JTklUX1BPSU5U
RVIobm9kZS0+YmFzZS5mZW5jZSwgRVJSX1BUUigtRUFHQUlOKSk7CisJCQlub2RlLT5iYXNlLmNi
Lm5vZGUucHJldiA9ICh2b2lkICopZW5naW5lOwogCQkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7
CiAJCX0KIApAQCAtNzgyLDI1ICs2OTgsNjUgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkX2FjdGl2
ZV9iYXJyaWVycyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOwogCXN0cnVjdCBsbGlzdF9ub2RlICpub2RlLCAq
bmV4dDsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOwogCiAJR0VNX0JVR19PTihpbnRlbF9lbmdpbmVf
aXNfdmlydHVhbChlbmdpbmUpKTsKIAlHRU1fQlVHX09OKGk5MTVfcmVxdWVzdF90aW1lbGluZShy
cSkgIT0gZW5naW5lLT5rZXJuZWxfY29udGV4dC0+dGltZWxpbmUpOwogCisJbm9kZSA9IGxsaXN0
X2RlbF9hbGwoJmVuZ2luZS0+YmFycmllcl90YXNrcyk7CisJaWYgKCFub2RlKQorCQlyZXR1cm47
CiAJLyoKIAkgKiBBdHRhY2ggdGhlIGxpc3Qgb2YgcHJvdG8tZmVuY2VzIHRvIHRoZSBpbi1mbGln
aHQgcmVxdWVzdCBzdWNoCiAJICogdGhhdCB0aGUgcGFyZW50IGk5MTVfYWN0aXZlIHdpbGwgYmUg
cmVsZWFzZWQgd2hlbiB0aGlzIHJlcXVlc3QKIAkgKiBpcyByZXRpcmVkLgogCSAqLwotCWxsaXN0
X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbGxpc3RfZGVsX2FsbCgmZW5naW5lLT5iYXJyaWVy
X3Rhc2tzKSkgewotCQlSQ1VfSU5JVF9QT0lOVEVSKGJhcnJpZXJfZnJvbV9sbChub2RlKS0+YmFz
ZS5yZXF1ZXN0LCBycSk7CisJc3Bpbl9sb2NrX2lycXNhdmUoJnJxLT5sb2NrLCBmbGFncyk7CisJ
bGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0LCBub2RlKSB7CisJCVJDVV9JTklUX1BPSU5U
RVIoYmFycmllcl9mcm9tX2xsKG5vZGUpLT5iYXNlLmZlbmNlLCAmcnEtPmZlbmNlKTsKIAkJc21w
X3dtYigpOyAvKiBzZXJpYWxpc2Ugd2l0aCByZXVzZV9pZGxlX2JhcnJpZXIgKi8KLQkJbGlzdF9h
ZGRfdGFpbCgoc3RydWN0IGxpc3RfaGVhZCAqKW5vZGUsICZycS0+YWN0aXZlX2xpc3QpOworCQls
aXN0X2FkZF90YWlsKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwgJnJxLT5mZW5jZS5jYl9saXN0
KTsKKwl9CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmcnEtPmxvY2ssIGZsYWdzKTsKK30KKwor
I2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKKyNkZWZpbmUgYWN0aXZl
X2lzX2hlbGQoYWN0aXZlKSBsb2NrZGVwX2lzX2hlbGQoKGFjdGl2ZSktPmxvY2spCisjZWxzZQor
I2RlZmluZSBhY3RpdmVfaXNfaGVsZChhY3RpdmUpIHRydWUKKyNlbmRpZgorCitzdHJ1Y3QgZG1h
X2ZlbmNlICoKK19faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5j
ZSAqYWN0aXZlLAorCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJc3RydWN0IGRtYV9m
ZW5jZSAqcHJldjsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJLyogTkI6IHVwZGF0ZXMgbXVz
dCBiZSBzZXJpYWxpc2VkIGJ5IGFuIG91dGVyIHRpbWVsaW5lIG11dGV4ICovCisJc3Bpbl9sb2Nr
X2lycXNhdmUoZmVuY2UtPmxvY2ssIGZsYWdzKTsKKwlHRU1fQlVHX09OKHRlc3RfYml0KERNQV9G
RU5DRV9GTEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5mbGFncykpOworCisJcHJldiA9IHJjdV9k
ZXJlZmVyZW5jZV9wcm90ZWN0ZWQoYWN0aXZlLT5mZW5jZSwgYWN0aXZlX2lzX2hlbGQoYWN0aXZl
KSk7CisJaWYgKHByZXYpIHsKKwkJc3Bpbl9sb2NrX25lc3RlZChwcmV2LT5sb2NrLCBTSU5HTEVf
REVQVEhfTkVTVElORyk7CisJCV9fbGlzdF9kZWxfZW50cnkoJmFjdGl2ZS0+Y2Iubm9kZSk7CisJ
CXNwaW5fdW5sb2NrKHByZXYtPmxvY2spOyAvKiBzZXJpYWxpc2Ugd2l0aCBwcmV2LT5jYl9saXN0
ICovCisJCXByZXYgPSByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5mZW5jZSk7CiAJfQorCisJ
cmN1X2Fzc2lnbl9wb2ludGVyKGFjdGl2ZS0+ZmVuY2UsIGZlbmNlKTsKKwlsaXN0X2FkZF90YWls
KCZhY3RpdmUtPmNiLm5vZGUsICZmZW5jZS0+Y2JfbGlzdCk7CisKKwlzcGluX3VubG9ja19pcnFy
ZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CisKKwlyZXR1cm4gcHJldjsKIH0KIAotaW50IGk5
MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUs
Ci0JCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitpbnQgaTkxNV9hY3RpdmVfZmVuY2Vf
c2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkJICBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKIHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAlpbnQgZXJyOwogCiAj
aWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQpAQCAtODA4LDE4ICs3NjQs
MjUgQEAgaW50IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0ICphY3RpdmUsCiAjZW5kaWYKIAogCS8qIE11c3QgbWFpbnRhaW4gb3JkZXJpbmcgd3J0IHBy
ZXZpb3VzIGFjdGl2ZSByZXF1ZXN0cyAqLwotCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3Rp
dmVfcmVxdWVzdChycSwgYWN0aXZlKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOworCXJjdV9y
ZWFkX2xvY2soKTsKKwlmZW5jZSA9IF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KGFjdGl2ZSwgJnJx
LT5mZW5jZSk7CisJaWYgKGZlbmNlKQorCQlmZW5jZSA9IGRtYV9mZW5jZV9nZXRfcmN1KGZlbmNl
KTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCWlmIChmZW5jZSkgeworCQllcnIgPSBpOTE1X3Jl
cXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2Up
OworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CiAKLQlfX2k5MTVfYWN0aXZlX3JlcXVl
c3Rfc2V0KGFjdGl2ZSwgcnEpOwogCXJldHVybiAwOwogfQogCi12b2lkIGk5MTVfYWN0aXZlX3Jl
dGlyZV9ub29wKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgICAgIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCit2b2lkIGk5MTVfYWN0aXZlX25vb3Aoc3RydWN0
IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQogewotCS8qIFNwYWNl
IGxlZnQgaW50ZW50aW9uYWxseSBibGFuayAqLworCWk5MTVfYWN0aXZlX2ZlbmNlX2NiKGZlbmNl
LCBjYik7CiB9CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCmluZGV4IDkwMDM0ZjYxYjdjMi4uNGY1MmZlNjE0NmQy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKQEAgLTEyLDYgKzEyLDEwIEBACiAjaW5j
bHVkZSAiaTkxNV9hY3RpdmVfdHlwZXMuaCIKICNpbmNsdWRlICJpOTE1X3JlcXVlc3QuaCIKIAor
c3RydWN0IGk5MTVfcmVxdWVzdDsKK3N0cnVjdCBpbnRlbF9lbmdpbmVfY3M7CitzdHJ1Y3QgaW50
ZWxfdGltZWxpbmU7CisKIC8qCiAgKiBXZSB0cmVhdCByZXF1ZXN0cyBhcyBmZW5jZXMuIFRoaXMg
aXMgbm90IGJlIHRvIGNvbmZ1c2VkIHdpdGggb3VyCiAgKiAiZmVuY2UgcmVnaXN0ZXJzIiBidXQg
cGlwZWxpbmUgc3luY2hyb25pc2F0aW9uIG9iamVjdHMgYWxhIEdMX0FSQl9zeW5jLgpAQCAtMjgs
MzA4ICszMiwxMDggQEAKICAqIHdyaXRlIGFjY2VzcyBzbyB0aGF0IHdlIGNhbiBwZXJmb3JtIGNv
bmN1cnJlbnQgcmVhZCBvcGVyYXRpb25zIGJldHdlZW4KICAqIHRoZSBDUFUgYW5kIEdQVSBlbmdp
bmVzLCBhcyB3ZWxsIGFzIHdhaXRpbmcgZm9yIGFsbCByZW5kZXJpbmcgdG8KICAqIGNvbXBsZXRl
LCBvciB3YWl0aW5nIGZvciB0aGUgbGFzdCBHUFUgdXNlciBvZiBhICJmZW5jZSByZWdpc3RlciIu
IFRoZQotICogb2JqZWN0IHRoZW4gZW1iZWRzIGEgI2k5MTVfYWN0aXZlX3JlcXVlc3QgdG8gdHJh
Y2sgdGhlIG1vc3QgcmVjZW50IChpbgorICogb2JqZWN0IHRoZW4gZW1iZWRzIGEgI2k5MTVfYWN0
aXZlX2ZlbmNlIHRvIHRyYWNrIHRoZSBtb3N0IHJlY2VudCAoaW4KICAqIHJldGlyZW1lbnQgb3Jk
ZXIpIHJlcXVlc3QgcmVsZXZhbnQgZm9yIHRoZSBkZXNpcmVkIG1vZGUgb2YgYWNjZXNzLgotICog
VGhlICNpOTE1X2FjdGl2ZV9yZXF1ZXN0IGlzIHVwZGF0ZWQgd2l0aCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0X3NldCgpIHRvCisgKiBUaGUgI2k5MTVfYWN0aXZlX2ZlbmNlIGlzIHVwZGF0ZWQgd2l0aCBp
OTE1X2FjdGl2ZV9mZW5jZV9zZXQoKSB0bwogICogdHJhY2sgdGhlIG1vc3QgcmVjZW50IGZlbmNl
IHJlcXVlc3QsIHR5cGljYWxseSB0aGlzIGlzIGRvbmUgYXMgcGFydCBvZgogICogaTkxNV92bWFf
bW92ZV90b19hY3RpdmUoKS4KICAqCi0gKiBXaGVuIHRoZSAjaTkxNV9hY3RpdmVfcmVxdWVzdCBj
b21wbGV0ZXMgKGlzIHJldGlyZWQpLCBpdCB3aWxsCisgKiBXaGVuIHRoZSAjaTkxNV9hY3RpdmVf
ZmVuY2UgY29tcGxldGVzIChpcyByZXRpcmVkKSwgaXQgd2lsbAogICogc2lnbmFsIGl0cyBjb21w
bGV0aW9uIHRvIHRoZSBvd25lciB0aHJvdWdoIGEgY2FsbGJhY2sgYXMgd2VsbCBhcyBtYXJrCi0g
KiBpdHNlbGYgYXMgaWRsZSAoaTkxNV9hY3RpdmVfcmVxdWVzdC5yZXF1ZXN0ID09IE5VTEwpLiBU
aGUgb3duZXIKKyAqIGl0c2VsZiBhcyBpZGxlIChpOTE1X2FjdGl2ZV9mZW5jZS5yZXF1ZXN0ID09
IE5VTEwpLiBUaGUgb3duZXIKICAqIGNhbiB0aGVuIHBlcmZvcm0gYW55IGFjdGlvbiwgc3VjaCBh
cyBkZWxheWVkIGZyZWVpbmcgb2YgYW4gYWN0aXZlCiAgKiByZXNvdXJjZSBpbmNsdWRpbmcgaXRz
ZWxmLgogICovCiAKLXZvaWQgaTkxNV9hY3RpdmVfcmV0aXJlX25vb3Aoc3RydWN0IGk5MTVfYWN0
aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVz
dCk7Cit2b2lkIGk5MTVfYWN0aXZlX25vb3Aoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVj
dCBkbWFfZmVuY2VfY2IgKmNiKTsKIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQg
LSBwcmVwYXJlcyB0aGUgYWN0aXZpdHkgdHJhY2tlciBmb3IgdXNlCisgKiBfX2k5MTVfYWN0aXZl
X2ZlbmNlX2luaXQgLSBwcmVwYXJlcyB0aGUgYWN0aXZpdHkgdHJhY2tlciBmb3IgdXNlCiAgKiBA
YWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKiBAcnEgLSBpbml0aWFsIHJlcXVlc3QgdG8g
dHJhY2ssIGNhbiBiZSBOVUxMCisgKiBAZmVuY2UgLSBpbml0aWFsIGZlbmNlIHRvIHRyYWNrLCBj
YW4gYmUgTlVMTAogICogQGZ1bmMgLSBhIGNhbGxiYWNrIHdoZW4gdGhlbiB0aGUgdHJhY2tlciBp
cyByZXRpcmVkIChiZWNvbWVzIGlkbGUpLAogICogICAgICAgICBjYW4gYmUgTlVMTAogICoKLSAq
IGk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdCgpIHByZXBhcmVzIHRoZSBlbWJlZGRlZCBAYWN0aXZl
IHN0cnVjdCBmb3IgdXNlIGFzCi0gKiBhbiBhY3Rpdml0eSB0cmFja2VyLCB0aGF0IGlzIGZvciB0
cmFja2luZyB0aGUgbGFzdCBrbm93biBhY3RpdmUgcmVxdWVzdAotICogYXNzb2NpYXRlZCB3aXRo
IGl0LiBXaGVuIHRoZSBsYXN0IHJlcXVlc3QgYmVjb21lcyBpZGxlLCB3aGVuIGl0IGlzIHJldGly
ZWQKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2luaXQoKSBwcmVwYXJlcyB0aGUgZW1iZWRkZWQgQGFj
dGl2ZSBzdHJ1Y3QgZm9yIHVzZSBhcworICogYW4gYWN0aXZpdHkgdHJhY2tlciwgdGhhdCBpcyBm
b3IgdHJhY2tpbmcgdGhlIGxhc3Qga25vd24gYWN0aXZlIGZlbmNlCisgKiBhc3NvY2lhdGVkIHdp
dGggaXQuIFdoZW4gdGhlIGxhc3QgZmVuY2UgYmVjb21lcyBpZGxlLCB3aGVuIGl0IGlzIHJldGly
ZWQKICAqIGFmdGVyIGNvbXBsZXRpb24sIHRoZSBvcHRpb25hbCBjYWxsYmFjayBAZnVuYyBpcyBp
bnZva2VkLgogICovCiBzdGF0aWMgaW5saW5lIHZvaWQKLWk5MTVfYWN0aXZlX3JlcXVlc3RfaW5p
dChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAorX19pOTE1X2FjdGl2ZV9mZW5j
ZV9pbml0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAogCQkJIHN0cnVjdCBtdXRl
eCAqbG9jaywKLQkJCSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCSBpOTE1X2FjdGl2ZV9y
ZXRpcmVfZm4gcmV0aXJlKQorCQkJIHZvaWQgKmZlbmNlLAorCQkJIGRtYV9mZW5jZV9mdW5jX3Qg
Zm4pCiB7Ci0JUkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIHJxKTsKLQlJTklUX0xJ
U1RfSEVBRCgmYWN0aXZlLT5saW5rKTsKLQlhY3RpdmUtPnJldGlyZSA9IHJldGlyZSA/OiBpOTE1
X2FjdGl2ZV9yZXRpcmVfbm9vcDsKKwlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIGZl
bmNlKTsKKwlhY3RpdmUtPmNiLmZ1bmMgPSBmbiA/OiBpOTE1X2FjdGl2ZV9ub29wOwogI2lmIElT
X0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKIAlhY3RpdmUtPmxvY2sgPSBsb2Nr
OwogI2VuZGlmCiB9CiAKLSNkZWZpbmUgSU5JVF9BQ1RJVkVfUkVRVUVTVChuYW1lLCBsb2NrKSBc
Ci0JaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KChuYW1lKSwgKGxvY2spLCBOVUxMLCBOVUxMKQot
Ci0vKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0IC0gdXBkYXRlcyB0aGUgdHJhY2tlciB0
byB3YXRjaCB0aGUgY3VycmVudCByZXF1ZXN0Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFj
a2VyCi0gKiBAcmVxdWVzdCAtIHRoZSByZXF1ZXN0IHRvIHdhdGNoCi0gKgotICogX19pOTE1X2Fj
dGl2ZV9yZXF1ZXN0X3NldCgpIHdhdGNoZXMgdGhlIGdpdmVuIEByZXF1ZXN0IGZvciBjb21wbGV0
aW9uLiBXaGlsc3QKLSAqIHRoYXQgQHJlcXVlc3QgaXMgYnVzeSwgdGhlIEBhY3RpdmUgcmVwb3J0
cyBidXN5LiBXaGVuIHRoYXQgQHJlcXVlc3QgaXMKLSAqIHJldGlyZWQsIHRoZSBAYWN0aXZlIHRy
YWNrZXIgaXMgdXBkYXRlZCB0byByZXBvcnQgaWRsZS4KLSAqLwotc3RhdGljIGlubGluZSB2b2lk
Ci1fX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICph
Y3RpdmUsCi0JCQkgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCi17Ci0jaWYgSVNfRU5B
QkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoYWN0
aXZlLT5sb2NrKTsKLSNlbmRpZgotCWxpc3RfbW92ZSgmYWN0aXZlLT5saW5rLCAmcmVxdWVzdC0+
YWN0aXZlX2xpc3QpOwotCXJjdV9hc3NpZ25fcG9pbnRlcihhY3RpdmUtPnJlcXVlc3QsIHJlcXVl
c3QpOwotfQorI2RlZmluZSBJTklUX0FDVElWRV9GRU5DRShBLCBMT0NLKSBcCisJX19pOTE1X2Fj
dGl2ZV9mZW5jZV9pbml0KChBKSwgKExPQ0spLCBOVUxMLCBOVUxMKQogCi1pbnQgX19tdXN0X2No
ZWNrCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAq
YWN0aXZlLAotCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOworc3RydWN0IGRtYV9mZW5jZSAq
CitfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2
ZSwKKwkJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X3JhdyAtIHJldHVybiB0aGUgYWN0aXZlIHJlcXVlc3QKKyAqIGk5MTVfYWN0aXZlX2Zl
bmNlX3NldCAtIHVwZGF0ZXMgdGhlIHRyYWNrZXIgdG8gd2F0Y2ggdGhlIGN1cnJlbnQgZmVuY2UK
ICAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKKyAqIEBycSAtIHRoZSByZXF1ZXN0IHRv
IHdhdGNoCiAgKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoKSByZXR1cm5zIHRoZSBjdXJy
ZW50IHJlcXVlc3QgYmVpbmcgdHJhY2tlZCwgb3IgTlVMTC4KLSAqIEl0IGRvZXMgbm90IG9idGFp
biBhIHJlZmVyZW5jZSBvbiB0aGUgcmVxdWVzdCBmb3IgdGhlIGNhbGxlciwgc28gdGhlIGNhbGxl
cgotICogbXVzdCBob2xkIHN0cnVjdF9tdXRleC4KKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX3NldCgp
IHdhdGNoZXMgdGhlIGdpdmVuIEBycSBmb3IgY29tcGxldGlvbi4gV2hpbGUKKyAqIHRoYXQgQHJx
IGlzIGJ1c3ksIHRoZSBAYWN0aXZlIHJlcG9ydHMgYnVzeS4gV2hlbiB0aGF0IEBycSBpcyBzaWdu
YWxlZAorICogKG9yIGVsc2UgcmV0aXJlZCkgdGhlIEBhY3RpdmUgdHJhY2tlciBpcyB1cGRhdGVk
IHRvIHJlcG9ydCBpZGxlLgogICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KgotaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVl
c3QgKmFjdGl2ZSwKLQkJCXN0cnVjdCBtdXRleCAqbXV0ZXgpCi17Ci0JcmV0dXJuIHJjdV9kZXJl
ZmVyZW5jZV9wcm90ZWN0ZWQoYWN0aXZlLT5yZXF1ZXN0LAotCQkJCQkgbG9ja2RlcF9pc19oZWxk
KG11dGV4KSk7Ci19Ci0KLS8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrIC0gcmVwb3J0
IHRoZSBhY3RpdmUgcmVxdWVzdCBiZWluZyBtb25pdG9yZWQKLSAqIEBhY3RpdmUgLSB0aGUgYWN0
aXZlIHRyYWNrZXIKLSAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoKSByZXR1cm5zIHRo
ZSBjdXJyZW50IHJlcXVlc3QgYmVpbmcgdHJhY2tlZCBpZgotICogc3RpbGwgYWN0aXZlLCBvciBO
VUxMLiBJdCBkb2VzIG5vdCBvYnRhaW4gYSByZWZlcmVuY2Ugb24gdGhlIHJlcXVlc3QKLSAqIGZv
ciB0aGUgY2FsbGVyLCBzbyB0aGUgY2FsbGVyIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCi0gKi8K
LXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0
X3BlZWsoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSBzdHJ1
Y3QgbXV0ZXggKm11dGV4KQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7Ci0KLQly
ZXF1ZXN0ID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoYWN0aXZlLCBtdXRleCk7Ci0JaWYgKCFy
ZXF1ZXN0IHx8IGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocmVxdWVzdCkpCi0JCXJldHVybiBOVUxM
OwotCi0JcmV0dXJuIHJlcXVlc3Q7Ci19Ci0KLS8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9n
ZXQgLSByZXR1cm4gYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0Ci0gKiBAYWN0aXZl
IC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoKSBy
ZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwgb3IgTlVMTAotICogaWYg
dGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUuIFRoZSBjYWxsZXIgbXVzdCBob2xkIHN0cnVjdF9t
dXRleC4KLSAqLwotc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0
aXZlX3JlcXVlc3RfZ2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUs
Ci0JCQlzdHJ1Y3QgbXV0ZXggKm11dGV4KQotewotCXJldHVybiBpOTE1X3JlcXVlc3RfZ2V0KGk5
MTVfYWN0aXZlX3JlcXVlc3RfcGVlayhhY3RpdmUsIG11dGV4KSk7Ci19Ci0KLS8qKgotICogX19p
OTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF9yY3UgLSByZXR1cm4gYSByZWZlcmVuY2UgdG8gdGhlIGFj
dGl2ZSByZXF1ZXN0Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKgotICogX19p
OTE1X2FjdGl2ZV9yZXF1ZXN0X2dldCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2
ZSByZXF1ZXN0LAotICogb3IgTlVMTCBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgaWRsZS4gVGhl
IGNhbGxlciBtdXN0IGhvbGQgdGhlIFJDVSByZWFkCi0gKiBsb2NrLCBidXQgdGhlIHJldHVybmVk
IHBvaW50ZXIgaXMgc2FmZSB0byB1c2Ugb3V0c2lkZSBvZiBSQ1UuCi0gKi8KLXN0YXRpYyBpbmxp
bmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1fX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3JjdShj
b25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQotewotCS8qCi0JICogUGVy
Zm9ybWluZyBhIGxvY2tsZXNzIHJldHJpZXZhbCBvZiB0aGUgYWN0aXZlIHJlcXVlc3QgaXMgc3Vw
ZXIKLQkgKiB0cmlja3kuIFNMQUJfVFlQRVNBRkVfQllfUkNVIG1lcmVseSBndWFyYW50ZWVzIHRo
YXQgdGhlIGJhY2tpbmcKLQkgKiBzbGFiIG9mIHJlcXVlc3Qgb2JqZWN0cyB3aWxsIG5vdCBiZSBm
cmVlZCB3aGlsc3Qgd2UgaG9sZCB0aGUKLQkgKiBSQ1UgcmVhZCBsb2NrLiBJdCBkb2VzIG5vdCBn
dWFyYW50ZWUgdGhhdCB0aGUgcmVxdWVzdCBpdHNlbGYKLQkgKiB3aWxsIG5vdCBiZSBmcmVlZCBh
bmQgdGhlbiAqcmV1c2VkKi4gVml6LAotCSAqCi0JICogVGhyZWFkIEEJCQlUaHJlYWQgQgotCSAq
Ci0JICogcnEgPSBhY3RpdmUucmVxdWVzdAotCSAqCQkJCXJldGlyZShycSkgLT4gZnJlZShycSk7
Ci0JICoJCQkJKHJxIGlzIG5vdyBmaXJzdCBvbiB0aGUgc2xhYiBmcmVlbGlzdCkKLQkgKgkJCQlh
Y3RpdmUucmVxdWVzdCA9IE5VTEwKLQkgKgotCSAqCQkJCXJxID0gbmV3IHN1Ym1pc3Npb24gb24g
YSBuZXcgb2JqZWN0Ci0JICogcmVmKHJxKQotCSAqCi0JICogVG8gcHJldmVudCB0aGUgcmVxdWVz
dCBmcm9tIGJlaW5nIHJldXNlZCB3aGlsc3QgdGhlIGNhbGxlcgotCSAqIHVzZXMgaXQsIHdlIHRh
a2UgYSByZWZlcmVuY2UgbGlrZSBub3JtYWwuIFdoaWxzdCBhY3F1aXJpbmcKLQkgKiB0aGUgcmVm
ZXJlbmNlIHdlIGNoZWNrIHRoYXQgaXQgaXMgbm90IGluIGEgZGVzdHJveWVkIHN0YXRlCi0JICog
KHJlZmNudCA9PSAwKS4gVGhhdCBwcmV2ZW50cyB0aGUgcmVxdWVzdCBiZWluZyByZWFsbG9jYXRl
ZAotCSAqIHdoaWxzdCB0aGUgY2FsbGVyIGhvbGRzIG9uIHRvIGl0LiBUbyBjaGVjayB0aGF0IHRo
ZSByZXF1ZXN0Ci0JICogd2FzIG5vdCByZWFsbG9jYXRlZCBhcyB3ZSBhY3F1aXJlZCB0aGUgcmVm
ZXJlbmNlIHdlIGhhdmUgdG8KLQkgKiBjaGVjayB0aGF0IG91ciByZXF1ZXN0IHJlbWFpbnMgdGhl
IGFjdGl2ZSByZXF1ZXN0IGFjcm9zcwotCSAqIHRoZSBsb29rdXAsIGluIHRoZSBzYW1lIG1hbm5l
ciBhcyBhIHNlcWxvY2suIFRoZSB2aXNpYmlsaXR5Ci0JICogb2YgdGhlIHBvaW50ZXIgdmVyc3Vz
IHRoZSByZWZlcmVuY2UgY291bnRpbmcgaXMgY29udHJvbGxlZAotCSAqIGJ5IHVzaW5nIFJDVSBi
YXJyaWVycyAocmN1X2RlcmVmZXJlbmNlIGFuZCByY3VfYXNzaWduX3BvaW50ZXIpLgotCSAqCi0J
ICogSW4gdGhlIG1pZGRsZSBvZiBhbGwgdGhhdCwgd2UgaW5zcGVjdCB3aGV0aGVyIHRoZSByZXF1
ZXN0IGlzCi0JICogY29tcGxldGUuIFJldGlyaW5nIGlzIGxhenkgc28gdGhlIHJlcXVlc3QgbWF5
IGJlIGNvbXBsZXRlZCBsb25nCi0JICogYmVmb3JlIHRoZSBhY3RpdmUgdHJhY2tlciBpcyB1cGRh
dGVkLiBRdWVyeWluZyB3aGV0aGVyIHRoZQotCSAqIHJlcXVlc3QgaXMgY29tcGxldGUgaXMgZmFy
IGNoZWFwZXIgKGFzIGl0IGludm9sdmVzIG5vIGxvY2tlZAotCSAqIGluc3RydWN0aW9ucyBzZXR0
aW5nIGNhY2hlbGluZXMgdG8gZXhjbHVzaXZlKSB0aGFuIGFjcXVpcmluZwotCSAqIHRoZSByZWZl
cmVuY2UsIHNvIHdlIGRvIGl0IGZpcnN0LiBUaGUgUkNVIHJlYWQgbG9jayBlbnN1cmVzIHRoZQot
CSAqIHBvaW50ZXIgZGVyZWZlcmVuY2UgaXMgdmFsaWQsIGJ1dCBkb2VzIG5vdCBlbnN1cmUgdGhh
dCB0aGUKLQkgKiBzZXFubyBub3IgSFdTIGlzIHRoZSByaWdodCBvbmUhIEhvd2V2ZXIsIGlmIHRo
ZSByZXF1ZXN0IHdhcwotCSAqIHJlYWxsb2NhdGVkLCB0aGF0IG1lYW5zIHRoZSBhY3RpdmUgdHJh
Y2tlcidzIHJlcXVlc3Qgd2FzIGNvbXBsZXRlLgotCSAqIElmIHRoZSBuZXcgcmVxdWVzdCBpcyBh
bHNvIGNvbXBsZXRlLCB0aGVuIGJvdGggYXJlIGFuZCB3ZSBjYW4KLQkgKiBqdXN0IHJlcG9ydCB0
aGUgYWN0aXZlIHRyYWNrZXIgaXMgaWRsZS4gSWYgdGhlIG5ldyByZXF1ZXN0IGlzCi0JICogaW5j
b21wbGV0ZSwgdGhlbiB3ZSBhY3F1aXJlIGEgcmVmZXJlbmNlIG9uIGl0IGFuZCBjaGVjayB0aGF0
Ci0JICogaXQgcmVtYWluZWQgdGhlIGFjdGl2ZSByZXF1ZXN0LgotCSAqCi0JICogSXQgaXMgdGhl
biBpbXBlcmF0aXZlIHRoYXQgd2UgZG8gbm90IHplcm8gdGhlIHJlcXVlc3Qgb24KLQkgKiByZWFs
bG9jYXRpb24sIHNvIHRoYXQgd2UgY2FuIGNoYXNlIHRoZSBkYW5nbGluZyBwb2ludGVycyEKLQkg
KiBTZWUgaTkxNV9yZXF1ZXN0X2FsbG9jKCkuCi0JICovCi0JZG8gewotCQlzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0OwotCi0JCXJlcXVlc3QgPSByY3VfZGVyZWZlcmVuY2UoYWN0aXZlLT5y
ZXF1ZXN0KTsKLQkJaWYgKCFyZXF1ZXN0IHx8IGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocmVxdWVz
dCkpCi0JCQlyZXR1cm4gTlVMTDsKLQotCQkvKgotCQkgKiBBbiBlc3BlY2lhbGx5IHNpbGx5IGNv
bXBpbGVyIGNvdWxkIGRlY2lkZSB0byByZWNvbXB1dGUgdGhlCi0JCSAqIHJlc3VsdCBvZiBpOTE1
X3JlcXVlc3RfY29tcGxldGVkLCBtb3JlIHNwZWNpZmljYWxseQotCQkgKiByZS1lbWl0IHRoZSBs
b2FkIGZvciByZXF1ZXN0LT5mZW5jZS5zZXFuby4gQSByYWNlIHdvdWxkIGNhdGNoCi0JCSAqIGEg
bGF0ZXIgc2Vxbm8gdmFsdWUsIHdoaWNoIGNvdWxkIGZsaXAgdGhlIHJlc3VsdCBmcm9tIHRydWUg
dG8KLQkJICogZmFsc2UuIFdoaWNoIG1lYW5zIHBhcnQgb2YgdGhlIGluc3RydWN0aW9ucyBiZWxv
dyBtaWdodCBub3QKLQkJICogYmUgZXhlY3V0ZWQsIHdoaWxlIGxhdGVyIG9uIGluc3RydWN0aW9u
cyBhcmUgZXhlY3V0ZWQuIER1ZSB0bwotCQkgKiBiYXJyaWVycyB3aXRoaW4gdGhlIHJlZmNvdW50
aW5nIHRoZSBpbmNvbnNpc3RlbmN5IGNhbid0IHJlYWNoCi0JCSAqIHBhc3QgdGhlIGNhbGwgdG8g
aTkxNV9yZXF1ZXN0X2dldF9yY3UsIGJ1dCBub3QgZXhlY3V0aW5nCi0JCSAqIHRoYXQgd2hpbGUg
c3RpbGwgZXhlY3V0aW5nIGk5MTVfcmVxdWVzdF9wdXQoKSBjcmVhdGVzCi0JCSAqIGhhdm9jIGVu
b3VnaC4gIFByZXZlbnQgdGhpcyB3aXRoIGEgY29tcGlsZXIgYmFycmllci4KLQkJICovCi0JCWJh
cnJpZXIoKTsKLQotCQlyZXF1ZXN0ID0gaTkxNV9yZXF1ZXN0X2dldF9yY3UocmVxdWVzdCk7Ci0K
LQkJLyoKLQkJICogV2hhdCBzdG9wcyB0aGUgZm9sbG93aW5nIHJjdV9hY2Nlc3NfcG9pbnRlcigp
IGZyb20gb2NjdXJyaW5nCi0JCSAqIGJlZm9yZSB0aGUgYWJvdmUgaTkxNV9yZXF1ZXN0X2dldF9y
Y3UoKT8gSWYgd2Ugd2VyZQotCQkgKiB0byByZWFkIHRoZSB2YWx1ZSBiZWZvcmUgcGF1c2luZyB0
byBnZXQgdGhlIHJlZmVyZW5jZSB0bwotCQkgKiB0aGUgcmVxdWVzdCwgd2UgbWF5IG5vdCBub3Rp
Y2UgYSBjaGFuZ2UgaW4gdGhlIGFjdGl2ZQotCQkgKiB0cmFja2VyLgotCQkgKgotCQkgKiBUaGUg
cmN1X2FjY2Vzc19wb2ludGVyKCkgaXMgYSBtZXJlIGNvbXBpbGVyIGJhcnJpZXIsIHdoaWNoCi0J
CSAqIG1lYW5zIGJvdGggdGhlIENQVSBhbmQgY29tcGlsZXIgYXJlIGZyZWUgdG8gcGVyZm9ybSB0
aGUKLQkJICogbWVtb3J5IHJlYWQgd2l0aG91dCBjb25zdHJhaW50LiBUaGUgY29tcGlsZXIgb25s
eSBoYXMgdG8KLQkJICogZW5zdXJlIHRoYXQgYW55IG9wZXJhdGlvbnMgYWZ0ZXIgdGhlIHJjdV9h
Y2Nlc3NfcG9pbnRlcigpCi0JCSAqIG9jY3VyIGFmdGVyd2FyZHMgaW4gcHJvZ3JhbSBvcmRlci4g
VGhpcyBtZWFucyB0aGUgcmVhZCBtYXkKLQkJICogYmUgcGVyZm9ybWVkIGVhcmxpZXIgYnkgYW4g
b3V0LW9mLW9yZGVyIENQVSwgb3IgYWR2ZW50dXJvdXMKLQkJICogY29tcGlsZXIuCi0JCSAqCi0J
CSAqIFRoZSBhdG9taWMgb3BlcmF0aW9uIGF0IHRoZSBoZWFydCBvZgotCQkgKiBpOTE1X3JlcXVl
c3RfZ2V0X3JjdSgpLCBzZWUgZG1hX2ZlbmNlX2dldF9yY3UoKSwgaXMKLQkJICogYXRvbWljX2lu
Y19ub3RfemVybygpIHdoaWNoIGlzIG9ubHkgYSBmdWxsIG1lbW9yeSBiYXJyaWVyCi0JCSAqIHdo
ZW4gc3VjY2Vzc2Z1bC4gVGhhdCBpcywgaWYgaTkxNV9yZXF1ZXN0X2dldF9yY3UoKQotCQkgKiBy
ZXR1cm5zIHRoZSByZXF1ZXN0IChhbmQgc28gd2l0aCB0aGUgcmVmZXJlbmNlIGNvdW50ZWQKLQkJ
ICogaW5jcmVtZW50ZWQpIHRoZW4gdGhlIGZvbGxvd2luZyByZWFkIGZvciByY3VfYWNjZXNzX3Bv
aW50ZXIoKQotCQkgKiBtdXN0IG9jY3VyIGFmdGVyIHRoZSBhdG9taWMgb3BlcmF0aW9uIGFuZCBz
byBjb25maXJtCi0JCSAqIHRoYXQgdGhpcyByZXF1ZXN0IGlzIHRoZSBvbmUgY3VycmVudGx5IGJl
aW5nIHRyYWNrZWQuCi0JCSAqCi0JCSAqIFRoZSBjb3JyZXNwb25kaW5nIHdyaXRlIGJhcnJpZXIg
aXMgcGFydCBvZgotCQkgKiByY3VfYXNzaWduX3BvaW50ZXIoKS4KLQkJICovCi0JCWlmICghcmVx
dWVzdCB8fCByZXF1ZXN0ID09IHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPnJlcXVlc3QpKQot
CQkJcmV0dXJuIHJjdV9wb2ludGVyX2hhbmRvZmYocmVxdWVzdCk7Ci0KLQkJaTkxNV9yZXF1ZXN0
X3B1dChyZXF1ZXN0KTsKLQl9IHdoaWxlICgxKTsKLX0KLQoraW50IF9fbXVzdF9jaGVjaworaTkx
NV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkg
ICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CiAvKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVl
c3RfZ2V0X3VubG9ja2VkIC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVz
dAorICogaTkxNV9hY3RpdmVfZmVuY2VfZ2V0IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBh
Y3RpdmUgZmVuY2UKICAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKICAqCi0gKiBpOTE1
X2FjdGl2ZV9yZXF1ZXN0X2dldF91bmxvY2tlZCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhl
IGFjdGl2ZSByZXF1ZXN0LAorICogaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCkgcmV0dXJucyBhIHJl
ZmVyZW5jZSB0byB0aGUgYWN0aXZlIGZlbmNlLAogICogb3IgTlVMTCBpZiB0aGUgYWN0aXZlIHRy
YWNrZXIgaXMgaWRsZS4gVGhlIHJlZmVyZW5jZSBpcyBvYnRhaW5lZCB1bmRlciBSQ1UsCiAgKiBz
byBubyBsb2NraW5nIGlzIHJlcXVpcmVkIGJ5IHRoZSBjYWxsZXIuCiAgKgotICogVGhlIHJlZmVy
ZW5jZSBzaG91bGQgYmUgZnJlZWQgd2l0aCBpOTE1X3JlcXVlc3RfcHV0KCkuCisgKiBUaGUgcmVm
ZXJlbmNlIHNob3VsZCBiZSBmcmVlZCB3aXRoIGRtYV9mZW5jZV9wdXQoKS4KICAqLwotc3RhdGlj
IGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3Vu
bG9ja2VkKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitzdGF0aWMg
aW5saW5lIHN0cnVjdCBkbWFfZmVuY2UgKgoraTkxNV9hY3RpdmVfZmVuY2VfZ2V0KHN0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKQogewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVl
c3Q7CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKIAlyY3VfcmVhZF9sb2NrKCk7Ci0JcmVx
dWVzdCA9IF9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmN1KGFjdGl2ZSk7CisJZmVuY2UgPSBk
bWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZhY3RpdmUtPmZlbmNlKTsKIAlyY3VfcmVhZF91bmxvY2so
KTsKIAotCXJldHVybiByZXF1ZXN0OworCXJldHVybiBmZW5jZTsKIH0KIAogLyoqCi0gKiBpOTE1
X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0IC0gcmVwb3J0IHdoZXRoZXIgdGhlIGFjdGl2ZSB0cmFja2Vy
IGlzIGFzc2lnbmVkCisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCAtIHJlcG9ydCB3aGV0aGVy
IHRoZSBhY3RpdmUgdHJhY2tlciBpcyBhc3NpZ25lZAogICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUg
dHJhY2tlcgogICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoKSByZXR1cm5zIHRydWUg
aWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGN1cnJlbnRseQotICogYXNzaWduZWQgdG8gYSByZXF1
ZXN0LiBEdWUgdG8gdGhlIGxhenkgcmV0aXJpbmcsIHRoYXQgcmVxdWVzdCBtYXkgYmUgaWRsZQor
ICogaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQoKSByZXR1cm5zIHRydWUgaWYgdGhlIGFjdGl2ZSB0
cmFja2VyIGlzIGN1cnJlbnRseQorICogYXNzaWduZWQgdG8gYSBmZW5jZS4gRHVlIHRvIHRoZSBs
YXp5IHJldGlyaW5nLCB0aGF0IGZlbmNlIG1heSBiZSBpZGxlCiAgKiBhbmQgdGhpcyBtYXkgcmVw
b3J0IHN0YWxlIGluZm9ybWF0aW9uLgogICovCiBzdGF0aWMgaW5saW5lIGJvb2wKLWk5MTVfYWN0
aXZlX3JlcXVlc3RfaXNzZXQoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZSkKK2k5MTVfYWN0aXZlX2ZlbmNlX2lzc2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5j
ZSAqYWN0aXZlKQogewotCXJldHVybiByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0
KTsKKwlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2ZS0+ZmVuY2UpOwogfQogCi0vKioK
LSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlIC0gd2FpdHMgdW50aWwgdGhlIHJlcXVlc3Qg
aXMgcmV0aXJlZAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgcmVxdWVzdCBvbiB3aGljaCB0byB3
YWl0Ci0gKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoKSB3YWl0cyB1bnRpbCB0aGUg
cmVxdWVzdCBpcyBjb21wbGV0ZWQsCi0gKiBhbmQgdGhlbiBlbnN1cmVzIHRoYXQgYXQgbGVhc3Qg
dGhlIHJldGlyZW1lbnQgaGFuZGxlciBmb3IgdGhpcwotICogQGFjdGl2ZSB0cmFja2VyIGlzIGNh
bGxlZCBiZWZvcmUgcmV0dXJuaW5nLiBJZiB0aGUgQGFjdGl2ZQotICogdHJhY2tlciBpcyBpZGxl
LCB0aGUgZnVuY3Rpb24gcmV0dXJucyBpbW1lZGlhdGVseS4KLSAqLwotc3RhdGljIGlubGluZSBp
bnQgX19tdXN0X2NoZWNrCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9h
Y3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJICAgc3RydWN0IG11dGV4ICptdXRleCkKK3N0YXRp
YyBpbmxpbmUgdm9pZAoraTkxNV9hY3RpdmVfZmVuY2VfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2UsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQogewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJl
cXVlc3Q7Ci0JbG9uZyByZXQ7Ci0KLQlyZXF1ZXN0ID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXco
YWN0aXZlLCBtdXRleCk7Ci0JaWYgKCFyZXF1ZXN0KQotCQlyZXR1cm4gMDsKLQotCXJldCA9IGk5
MTVfcmVxdWVzdF93YWl0KHJlcXVlc3QsCi0JCQkJSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCi0J
CQkJTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCWlmIChyZXQgPCAwKQotCQlyZXR1cm4gcmV0Owor
CXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlID0KKwkJY29udGFpbmVyX29mKGNiLCB0
eXBlb2YoKmFjdGl2ZSksIGNiKTsKIAotCWxpc3RfZGVsX2luaXQoJmFjdGl2ZS0+bGluayk7Ci0J
UkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIE5VTEwpOwotCi0JYWN0aXZlLT5yZXRp
cmUoYWN0aXZlLCByZXF1ZXN0KTsKLQotCXJldHVybiAwOworCVJDVV9JTklUX1BPSU5URVIoYWN0
aXZlLT5mZW5jZSwgTlVMTCk7CiB9CiAKIC8qCkBAIC0zNTgsNDcgKzE2Miw0MCBAQCBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAog
ICogc3luY2hyb25pc2F0aW9uLgogICovCiAKLXZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCit2
b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWludCAo
KmFjdGl2ZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpLAogCQkJdm9pZCAoKnJldGlyZSkoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYpLAogCQkJc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpOwot
I2RlZmluZSBpOTE1X2FjdGl2ZV9pbml0KGk5MTUsIHJlZiwgYWN0aXZlLCByZXRpcmUpIGRvIHsJ
CVwKKyNkZWZpbmUgaTkxNV9hY3RpdmVfaW5pdChyZWYsIGFjdGl2ZSwgcmV0aXJlKSBkbyB7CQlc
CiAJc3RhdGljIHN0cnVjdCBsb2NrX2NsYXNzX2tleSBfX2tleTsJCQkJXAogCQkJCQkJCQkJXAot
CV9faTkxNV9hY3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwgcmV0aXJlLCAmX19rZXkpOwkJ
XAorCV9faTkxNV9hY3RpdmVfaW5pdChyZWYsIGFjdGl2ZSwgcmV0aXJlLCAmX19rZXkpOwkJXAog
fSB3aGlsZSAoMCkKIAogaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZiwKIAkJICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCi0JCSAgICBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSk7CisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CiAKIHN0YXRpYyBp
bmxpbmUgaW50CiBpOTE1X2FjdGl2ZV9hZGRfcmVxdWVzdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
Ziwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfYWN0aXZlX3JlZihy
ZWYsIGk5MTVfcmVxdWVzdF90aW1lbGluZShycSksIHJxKTsKKwlyZXR1cm4gaTkxNV9hY3RpdmVf
cmVmKHJlZiwgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwgJnJxLT5mZW5jZSk7CiB9CiAKIHZv
aWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3Ry
dWN0IGRtYV9mZW5jZSAqZik7CiAKIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2FjdGl2ZV9oYXNf
ZXhjbHVzaXZlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewotCXJldHVybiByY3VfYWNjZXNz
X3BvaW50ZXIocmVmLT5leGNsKTsKKwlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhj
bC5mZW5jZSk7CiB9CiAKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAq
cmVmKTsKIAotaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEsCi0JCQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Ci1pbnQgaTkxNV9yZXF1
ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJCSAg
ICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpOworaW50IGk5MTVfcmVxdWVz
dF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKTsKIAogaW50IGk5MTVfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpy
ZWYpOworYm9vbCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2lmX2J1c3koc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYpOwogdm9pZCBpOTE1X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KTsKLXZvaWQgX19pOTE1X2FjdGl2ZV9yZWxlYXNlX25lc3RlZChzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZiwgaW50IHN1YmNsYXNzKTsKLQotYm9vbCBpOTE1X2FjdGl2ZV90cnlncmFiKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmKTsKLXZvaWQgaTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKTsKIAogc3RhdGljIGlubGluZSBib29sCiBpOTE1X2FjdGl2ZV9pc19pZGxlKGNv
bnN0IHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlX3R5cGVzLmgKaW5kZXggMDIxMTY3ZjAwMDRkLi5kODlhNzRjMTQyYzYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApAQCAtMTcsMTcgKzE3LDkgQEAKIAogI2lu
Y2x1ZGUgImk5MTVfdXRpbHMuaCIKIAotc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7Ci1zdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdDsKLXN0cnVjdCBpOTE1X3JlcXVlc3Q7Ci0KLXR5cGVkZWYgdm9p
ZCAoKmk5MTVfYWN0aXZlX3JldGlyZV9mbikoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKiwK
LQkJCQkgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICopOwotCi1zdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCB7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCBfX3JjdSAqcmVxdWVzdDsKLQlzdHJ1Y3Qg
bGlzdF9oZWFkIGxpbms7Ci0JaTkxNV9hY3RpdmVfcmV0aXJlX2ZuIHJldGlyZTsKK3N0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSB7CisJc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqZmVuY2U7CisJc3Ry
dWN0IGRtYV9mZW5jZV9jYiBjYjsKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJV
R19HRU0pCiAJLyoKIAkgKiBJbmNvcnBvcmVhbCEKQEAgLTUzLDIwICs0NSwxNyBAQCBzdHJ1Y3Qg
YWN0aXZlX25vZGU7CiAjZGVmaW5lIGk5MTVfYWN0aXZlX21heV9zbGVlcChmbikgcHRyX3BhY2tf
Yml0cygmKGZuKSwgSTkxNV9BQ1RJVkVfTUFZX1NMRUVQLCAyKQogCiBzdHJ1Y3QgaTkxNV9hY3Rp
dmUgewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1OworCWF0b21pY190IGNvdW50Owor
CXN0cnVjdCBtdXRleCBtdXRleDsKIAogCXN0cnVjdCBhY3RpdmVfbm9kZSAqY2FjaGU7CiAJc3Ry
dWN0IHJiX3Jvb3QgdHJlZTsKLQlzdHJ1Y3QgbXV0ZXggbXV0ZXg7Ci0JYXRvbWljX3QgY291bnQ7
CiAKIAkvKiBQcmVhbGxvY2F0ZWQgImV4Y2x1c2l2ZSIgbm9kZSAqLwotCXN0cnVjdCBkbWFfZmVu
Y2UgX19yY3UgKmV4Y2w7Ci0Jc3RydWN0IGRtYV9mZW5jZV9jYiBleGNsX2NiOworCXN0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSBleGNsOwogCiAJdW5zaWduZWQgbG9uZyBmbGFnczsKICNkZWZpbmUg
STkxNV9BQ1RJVkVfUkVUSVJFX1NMRUVQUyBCSVQoMCkKLSNkZWZpbmUgSTkxNV9BQ1RJVkVfR1JB
Ql9CSVQgMQogCiAJaW50ICgqYWN0aXZlKShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAJdm9p
ZCAoKnJldGlyZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
LmMKaW5kZXggOTM0ZWE3NzZhNDZhLi5hODg4NDk1NDRjOGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW0uYwpAQCAtODkyLDI4ICs4OTIsMzggQEAgd2FpdF9mb3JfdGltZWxpbmVzKHN0cnVjdCBpbnRl
bF9ndCAqZ3QsIHVuc2lnbmVkIGludCB3YWl0LCBsb25nIHRpbWVvdXQpCiAKIAlzcGluX2xvY2tf
aXJxc2F2ZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh0
bCwgJnRpbWVsaW5lcy0+YWN0aXZlX2xpc3QsIGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnE7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3RpdmVf
cmVxdWVzdF9nZXRfdW5sb2NrZWQoJnRsLT5sYXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQorCQlm
ZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICgh
ZmVuY2UpCiAJCQljb250aW51ZTsKIAogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGlu
ZXMtPmxvY2ssIGZsYWdzKTsKIAotCQkvKgotCQkgKiAiUmFjZS10by1pZGxlIi4KLQkJICoKLQkJ
ICogU3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGEgc3luY2hy
b25vdXMKLQkJICogc3RlcCBwcmlvciB0byBpZGxpbmcsIGUuZy4gaW4gc3VzcGVuZCBmb3IgZmx1
c2hpbmcgYWxsCi0JCSAqIGN1cnJlbnQgb3BlcmF0aW9ucyB0byBtZW1vcnkgYmVmb3JlIHNsZWVw
aW5nLiBUaGVzZSB3ZQotCQkgKiB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNrbHkgYXMgcG9zc2li
bGUgdG8gYXZvaWQgcHJvbG9uZ2VkCi0JCSAqIHN0YWxscywgc28gYWxsb3cgdGhlIGdwdSB0byBi
b29zdCB0byBtYXhpbXVtIGNsb2Nrcy4KLQkJICovCi0JCWlmICh3YWl0ICYgSTkxNV9XQUlUX0ZP
Ul9JRExFX0JPT1NUKQotCQkJZ2VuNl9ycHNfYm9vc3QocnEpOworCQlpZiAoIWRtYV9mZW5jZV9p
c19pOTE1KGZlbmNlKSkgeworCQkJdGltZW91dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoZmVu
Y2UsCisJCQkJCQkJIGZsYWdzICYgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCisJCQkJCQkJIHRp
bWVvdXQpOworCQl9IGVsc2UgeworCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEgPSB0b19yZXF1
ZXN0KGZlbmNlKTsKKworCQkJLyoKKwkJCSAqICJSYWNlLXRvLWlkbGUiLgorCQkJICoKKwkJCSAq
IFN3aXRjaGluZyB0byB0aGUga2VybmVsIGNvbnRleHQgaXMgb2Z0ZW4gdXNlZCBhcworCQkJICog
YSBzeW5jaHJvbm91cyBzdGVwIHByaW9yIHRvIGlkbGluZywgZS5nLiBpbiBzdXNwZW5kCisJCQkg
KiBmb3IgZmx1c2hpbmcgYWxsIGN1cnJlbnQgb3BlcmF0aW9ucyB0byBtZW1vcnkgYmVmb3JlCisJ
CQkgKiBzbGVlcGluZy4gVGhlc2Ugd2Ugd2FudCB0byBjb21wbGV0ZSBhcyBxdWlja2x5IGFzCisJ
CQkgKiBwb3NzaWJsZSB0byBhdm9pZCBwcm9sb25nZWQgc3RhbGxzLCBzbyBhbGxvdyB0aGUgZ3B1
CisJCQkgKiB0byBib29zdCB0byBtYXhpbXVtIGNsb2Nrcy4KKwkJCSAqLworCQkJaWYgKGZsYWdz
ICYgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NUKQorCQkJCWdlbjZfcnBzX2Jvb3N0KHJxKTsKKwor
CQkJdGltZW91dCA9IGk5MTVfcmVxdWVzdF93YWl0KHJxLCBmbGFncywgdGltZW91dCk7CisJCX0K
IAotCQl0aW1lb3V0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocnEsIHdhaXQsIHRpbWVvdXQpOwotCQlp
OTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJCWlmICh0aW1l
b3V0IDwgMCkKIAkJCXJldHVybiB0aW1lb3V0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCmluZGV4IGEzNTFiOThhZmUwMy4uYmY1N2M0MWZhMWZiIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYwpAQCAtMTg2MSw3ICsxODYxLDYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBp
OTE1X3ZtYV9vcHMgcGRfdm1hX29wcyA9IHsKIAogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcGRf
dm1hX2NyZWF0ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQsIGludCBzaXplKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gcHBndHQtPmJhc2Uudm0uaTkxNTsKIAlzdHJ1Y3Qg
aTkxNV9nZ3R0ICpnZ3R0ID0gcHBndHQtPmJhc2Uudm0uZ3QtPmdndHQ7CiAJc3RydWN0IGk5MTVf
dm1hICp2bWE7CiAKQEAgLTE4NzIsNyArMTg3MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEg
KnBkX3ZtYV9jcmVhdGUoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0LCBpbnQgc2l6ZSkKIAlpZiAo
IXZtYSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGk5
MTUsICZ2bWEtPmFjdGl2ZSwgTlVMTCwgTlVMTCk7CisJaTkxNV9hY3RpdmVfaW5pdCgmdm1hLT5h
Y3RpdmUsIE5VTEwsIE5VTEwpOwogCiAJbXV0ZXhfaW5pdCgmdm1hLT5wYWdlc19tdXRleCk7CiAJ
dm1hLT52bSA9IGk5MTVfdm1fZ2V0KCZnZ3R0LT52bSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
cHVfZXJyb3IuYwppbmRleCA2Mzg0YTA2YWE1YmYuLmEyOGVlNzU0YjdiNCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCkBAIC0xMjk5LDcgKzEyOTksNyBAQCBjYXB0dXJlX3Zt
YShzdHJ1Y3QgY2FwdHVyZV92bWEgKm5leHQsCiAJaWYgKCFjKQogCQlyZXR1cm4gbmV4dDsKIAot
CWlmICghaTkxNV9hY3RpdmVfdHJ5Z3JhYigmdm1hLT5hY3RpdmUpKSB7CisJaWYgKCFpOTE1X2Fj
dGl2ZV9hY3F1aXJlX2lmX2J1c3koJnZtYS0+YWN0aXZlKSkgewogCQlrZnJlZShjKTsKIAkJcmV0
dXJuIG5leHQ7CiAJfQpAQCAtMTQzOSw3ICsxNDM5LDcgQEAgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1
Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29tcHJlc3MgKmNvbXByZXNzKQogCQkJ
KnRoaXMtPnNsb3QgPQogCQkJCWk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LCB2bWEsIGNv
bXByZXNzKTsKIAotCQkJaTkxNV9hY3RpdmVfdW5ncmFiKCZ2bWEtPmFjdGl2ZSk7CisJCQlpOTE1
X2FjdGl2ZV9yZWxlYXNlKCZ2bWEtPmFjdGl2ZSk7CiAJCQlpOTE1X3ZtYV9wdXQodm1hKTsKIAog
CQkJY2FwdHVyZSA9IHRoaXMtPm5leHQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmlu
ZGV4IGE4OTE2NDEyNzU5Yi4uNGZmZTYyYTQyMTg2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYwpAQCAtMjE4LDggKzIxOCw2IEBAIHN0YXRpYyB2b2lkIHJlbW92ZV9mcm9tX2VuZ2lu
ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogc3RhdGljIGJvb2wgaTkxNV9yZXF1ZXN0X3Jl
dGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVx
dWVzdCAqYWN0aXZlLCAqbmV4dDsKLQogCWlmICghaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkp
CiAJCXJldHVybiBmYWxzZTsKIApAQCAtMjQ0LDM1ICsyNDIsNiBAQCBzdGF0aWMgYm9vbCBpOTE1
X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQkJCSAgJmk5MTVfcmVx
dWVzdF90aW1lbGluZShycSktPnJlcXVlc3RzKSk7CiAJcnEtPnJpbmctPmhlYWQgPSBycS0+cG9z
dGZpeDsKIAotCS8qCi0JICogV2FsayB0aHJvdWdoIHRoZSBhY3RpdmUgbGlzdCwgY2FsbGluZyBy
ZXRpcmUgb24gZWFjaC4gVGhpcyBhbGxvd3MKLQkgKiBvYmplY3RzIHRvIHRyYWNrIHRoZWlyIEdQ
VSBhY3Rpdml0eSBhbmQgbWFyayB0aGVtc2VsdmVzIGFzIGlkbGUKLQkgKiB3aGVuIHRoZWlyICps
YXN0KiBhY3RpdmUgcmVxdWVzdCBpcyBjb21wbGV0ZWQgKHVwZGF0aW5nIHN0YXRlCi0JICogdHJh
Y2tpbmcgbGlzdHMgZm9yIGV2aWN0aW9uLCBhY3RpdmUgcmVmZXJlbmNlcyBmb3IgR0VNLCBldGMp
LgotCSAqCi0JICogQXMgdGhlIC0+cmV0aXJlKCkgbWF5IGZyZWUgdGhlIG5vZGUsIHdlIGRlY291
cGxlIGl0IGZpcnN0IGFuZAotCSAqIHBhc3MgYWxvbmcgdGhlIGF1eGlsaWFyeSBpbmZvcm1hdGlv
biAodG8gYXZvaWQgZGVyZWZlcmVuY2luZwotCSAqIHRoZSBub2RlIGFmdGVyIHRoZSBjYWxsYmFj
aykuCi0JICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGFjdGl2ZSwgbmV4dCwgJnJxLT5h
Y3RpdmVfbGlzdCwgbGluaykgewotCQkvKgotCQkgKiBJbiBtaWNyb2JlbmNobWFya3Mgb3IgZm9j
dXNpbmcgdXBvbiB0aW1lIGluc2lkZSB0aGUga2VybmVsLAotCQkgKiB3ZSBtYXkgc3BlbmQgYW4g
aW5vcmRpbmF0ZSBhbW91bnQgb2YgdGltZSBzaW1wbHkgaGFuZGxpbmcKLQkJICogdGhlIHJldGly
ZW1lbnQgb2YgcmVxdWVzdHMgYW5kIHByb2Nlc3NpbmcgdGhlaXIgY2FsbGJhY2tzLgotCQkgKiBP
ZiB3aGljaCwgdGhpcyBsb29wIGl0c2VsZiBpcyBwYXJ0aWN1bGFybHkgaG90IGR1ZSB0byB0aGUK
LQkJICogY2FjaGUgbWlzc2VzIHdoZW4ganVtcGluZyBhcm91bmQgdGhlIGxpc3Qgb2YKLQkJICog
aTkxNV9hY3RpdmVfcmVxdWVzdC4gIFNvIHdlIHRyeSB0byBrZWVwIHRoaXMgbG9vcCBhcwotCQkg
KiBzdHJlYW1saW5lZCBhcyBwb3NzaWJsZSBhbmQgYWxzbyBwcmVmZXRjaCB0aGUgbmV4dAotCQkg
KiBpOTE1X2FjdGl2ZV9yZXF1ZXN0IHRvIHRyeSBhbmQgaGlkZSB0aGUgbGlrZWx5IGNhY2hlIG1p
c3MuCi0JCSAqLwotCQlwcmVmZXRjaHcobmV4dCk7Ci0KLQkJSU5JVF9MSVNUX0hFQUQoJmFjdGl2
ZS0+bGluayk7Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQot
CQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIHJxKTsKLQl9Ci0KIAlsb2NhbF9pcnFfZGlzYWJsZSgp
OwogCiAJLyoKQEAgLTcwNCw3ICs2NzMsNiBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLCBnZnBfdCBnZnApCiAJcnEtPmZsYWdzID0gMDsKIAlycS0+ZXhl
Y3V0aW9uX21hc2sgPSBBTExfRU5HSU5FUzsKIAotCUlOSVRfTElTVF9IRUFEKCZycS0+YWN0aXZl
X2xpc3QpOwogCUlOSVRfTElTVF9IRUFEKCZycS0+ZXhlY3V0ZV9jYik7CiAKIAkvKgpAQCAtNzQz
LDcgKzcxMSw2IEBAIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UsIGdmcF90IGdmcCkKIAljZS0+cmluZy0+ZW1pdCA9IHJxLT5oZWFkOwogCiAJLyogTWFrZSBz
dXJlIHdlIGRpZG4ndCBhZGQgb3Vyc2VsdmVzIHRvIGV4dGVybmFsIHN0YXRlIGJlZm9yZSBmcmVl
aW5nICovCi0JR0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEtPmFjdGl2ZV9saXN0KSk7CiAJR0VN
X0JVR19PTighbGlzdF9lbXB0eSgmcnEtPnNjaGVkLnNpZ25hbGVyc19saXN0KSk7CiAJR0VNX0JV
R19PTighbGlzdF9lbXB0eSgmcnEtPnNjaGVkLndhaXRlcnNfbGlzdCkpOwogCkBAIC0xMTc0LDgg
KzExNDEsOCBAQCBfX2k5MTVfcmVxdWVzdF9hZGRfdG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCiAJICogcHJlY2x1ZGVzIG9wdGltaXNpbmcgdG8gdXNlIHNlbWFwaG9yZXMgc2Vy
aWFsaXNhdGlvbiBvZiBhIHNpbmdsZQogCSAqIHRpbWVsaW5lIGFjcm9zcyBlbmdpbmVzLgogCSAq
LwotCXByZXYgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHRpbWVsaW5lLT5sYXN0X3JlcXVl
c3QucmVxdWVzdCwKLQkJCQkJIGxvY2tkZXBfaXNfaGVsZCgmdGltZWxpbmUtPm11dGV4KSk7CisJ
cHJldiA9IHRvX3JlcXVlc3QoX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnRpbWVsaW5lLT5sYXN0
X3JlcXVlc3QsCisJCQkJCQkgICZycS0+ZmVuY2UpKTsKIAlpZiAocHJldiAmJiAhaTkxNV9yZXF1
ZXN0X2NvbXBsZXRlZChwcmV2KSkgewogCQlpZiAoaXNfcG93ZXJfb2ZfMihwcmV2LT5lbmdpbmUt
Pm1hc2sgfCBycS0+ZW5naW5lLT5tYXNrKSkKIAkJCWk5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVu
Y2UoJnJxLT5zdWJtaXQsCkBAIC0xMjAwLDcgKzExNjcsNiBAQCBfX2k5MTVfcmVxdWVzdF9hZGRf
dG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICogdXMsIHRoZSB0aW1lbGlu
ZSB3aWxsIGhvbGQgaXRzIHNlcW5vIHdoaWNoIGlzIGxhdGVyIHRoYW4gb3Vycy4KIAkgKi8KIAlH
RU1fQlVHX09OKHRpbWVsaW5lLT5zZXFubyAhPSBycS0+ZmVuY2Uuc2Vxbm8pOwotCV9faTkxNV9h
Y3RpdmVfcmVxdWVzdF9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsIHJxKTsKIAogCXJldHVy
biBwcmV2OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCBlYzViYjRjMmU1
YWUuLjkxYTg4NWMzNmM2YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTIx
MSw3ICsyMTEsNiBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0IHsKIAkgKiBvbiB0aGUgYWN0aXZlX2xp
c3QgKG9mIHRoZWlyIGZpbmFsIHJlcXVlc3QpLgogCSAqLwogCXN0cnVjdCBpOTE1X2NhcHR1cmVf
bGlzdCAqY2FwdHVyZV9saXN0OwotCXN0cnVjdCBsaXN0X2hlYWQgYWN0aXZlX2xpc3Q7CiAKIAkv
KiogVGltZSBhdCB3aGljaCB0aGlzIHJlcXVlc3Qgd2FzIGVtaXR0ZWQsIGluIGppZmZpZXMuICov
CiAJdW5zaWduZWQgbG9uZyBlbWl0dGVkX2ppZmZpZXM7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpp
bmRleCAyNzE3NDQxYTlmM2EuLjY0N2JiOTZhNjIyMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5j
CkBAIC0xMjAsOCArMTIwLDcgQEAgdm1hX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAogCXZtYS0+c2l6ZSA9IG9iai0+YmFzZS5zaXplOwogCXZtYS0+ZGlzcGxheV9hbGln
bm1lbnQgPSBJOTE1X0dUVF9NSU5fQUxJR05NRU5UOwogCi0JaTkxNV9hY3RpdmVfaW5pdCh2bS0+
aTkxNSwgJnZtYS0+YWN0aXZlLAotCQkJIF9faTkxNV92bWFfYWN0aXZlLCBfX2k5MTVfdm1hX3Jl
dGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgmdm1hLT5hY3RpdmUsIF9faTkxNV92bWFfYWN0aXZl
LCBfX2k5MTVfdm1hX3JldGlyZSk7CiAKIAkvKiBEZWNsYXJlIG91cnNlbHZlcyBzYWZlIGZvciB1
c2UgaW5zaWRlIHNocmlua2VycyAqLwogCWlmIChJU19FTkFCTEVEKENPTkZJR19MT0NLREVQKSkg
ewpAQCAtMTE0OCw2ICsxMTQ3LDcgQEAgaW50IF9faTkxNV92bWFfdW5iaW5kKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwlHRU1fQlVHX09OKGk5MTVf
dm1hX2lzX2FjdGl2ZSh2bWEpKTsKIAlpZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpIHsKIAkJ
dm1hX3ByaW50X2FsbG9jYXRvcih2bWEsICJpcyBwaW5uZWQiKTsKIAkJcmV0dXJuIC1FQlVTWTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKaW5kZXggYTQx
Nzg1ODIyZWQ5Li4yY2M3MWJjZjg4NGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2FjdGl2ZS5jCkBAIC02OCw3ICs2OCw3IEBAIHN0YXRpYyBzdHJ1Y3QgbGl2ZV9h
Y3RpdmUgKl9fbGl2ZV9hbGxvYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJcmV0
dXJuIE5VTEw7CiAKIAlrcmVmX2luaXQoJmFjdGl2ZS0+cmVmKTsKLQlpOTE1X2FjdGl2ZV9pbml0
KGk5MTUsICZhY3RpdmUtPmJhc2UsIF9fbGl2ZV9hY3RpdmUsIF9fbGl2ZV9yZXRpcmUpOworCWk5
MTVfYWN0aXZlX2luaXQoJmFjdGl2ZS0+YmFzZSwgX19saXZlX2FjdGl2ZSwgX19saXZlX3JldGly
ZSk7CiAKIAlyZXR1cm4gYWN0aXZlOwogfQpAQCAtMTQ2LDE5ICsxNDYsMTMgQEAgc3RhdGljIGlu
dCBsaXZlX2FjdGl2ZV93YWl0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgbGl2ZV9hY3RpdmUgKmFjdGl2ZTsKLQlpbnRlbF93YWtl
cmVmX3Qgd2FrZXJlZjsKIAlpbnQgZXJyID0gMDsKIAogCS8qIENoZWNrIHRoYXQgd2UgZ2V0IGEg
Y2FsbGJhY2sgd2hlbiByZXF1ZXN0cyByZXRpcmUgdXBvbiB3YWl0aW5nICovCiAKLQltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9w
bV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJYWN0aXZlID0gX19saXZlX2FjdGl2ZV9zZXR1
cChpOTE1KTsKLQlpZiAoSVNfRVJSKGFjdGl2ZSkpIHsKLQkJZXJyID0gUFRSX0VSUihhY3RpdmUp
OwotCQlnb3RvIGVycjsKLQl9CisJaWYgKElTX0VSUihhY3RpdmUpKQorCQlyZXR1cm4gUFRSX0VS
UihhY3RpdmUpOwogCiAJaTkxNV9hY3RpdmVfd2FpdCgmYWN0aXZlLT5iYXNlKTsKIAlpZiAoIVJF
QURfT05DRShhY3RpdmUtPnJldGlyZWQpKSB7CkBAIC0xNjgsMTEgKzE2Miw5IEBAIHN0YXRpYyBp
bnQgbGl2ZV9hY3RpdmVfd2FpdCh2b2lkICphcmcpCiAKIAlfX2xpdmVfcHV0KGFjdGl2ZSk7CiAK
KwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoaWd0X2ZsdXNoX3Rl
c3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCiAJCWVyciA9IC1FSU87Ci0KLWVycjoKLQlpbnRl
bF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAJbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7CkBAIC0xODIsMjMg
KzE3NCwxOSBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICphcmcpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGxpdmVfYWN0aXZl
ICphY3RpdmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IDA7CiAKIAkv
KiBDaGVjayB0aGF0IHdlIGdldCBhIGNhbGxiYWNrIHdoZW4gcmVxdWVzdHMgYXJlIGluZGlyZWN0
bHkgcmV0aXJlZCAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWFj
dGl2ZSA9IF9fbGl2ZV9hY3RpdmVfc2V0dXAoaTkxNSk7Ci0JaWYgKElTX0VSUihhY3RpdmUpKSB7
Ci0JCWVyciA9IFBUUl9FUlIoYWN0aXZlKTsKLQkJZ290byBlcnI7Ci0JfQorCWlmIChJU19FUlIo
YWN0aXZlKSkKKwkJcmV0dXJuIFBUUl9FUlIoYWN0aXZlKTsKIAogCS8qIHdhaXRzIGZvciAmIHJl
dGlyZXMgYWxsIHJlcXVlc3RzICovCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIg
PSAtRUlPOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAo
IVJFQURfT05DRShhY3RpdmUtPnJldGlyZWQpKSB7CiAJCXByX2VycigiaTkxNV9hY3RpdmUgbm90
IHJldGlyZWQgYWZ0ZXIgZmx1c2hpbmchXG4iKTsKQEAgLTIwNywxMCArMTk1LDYgQEAgc3RhdGlj
IGludCBsaXZlX2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogCiAJX19saXZlX3B1dChhY3RpdmUp
OwogCi1lcnI6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2Vy
ZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlyZXR1cm4g
ZXJyOwogfQogCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4F18D92212
	for <lists+intel-gfx@lfdr.de>; Mon, 19 Aug 2019 13:20:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8B6736E101;
	Mon, 19 Aug 2019 11:20:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 21F406E101
 for <intel-gfx@lists.freedesktop.org>; Mon, 19 Aug 2019 11:20:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18187881-1500050 
 for multiple; Mon, 19 Aug 2019 12:20:34 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 19 Aug 2019 12:20:33 +0100
Message-Id: <20190819112033.30638-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190819110753.22201-1-chris@chris-wilson.co.uk>
References: <20190819110753.22201-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Serialize against vma moves
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSBzdXJlIHRoYXQgd2hlbiBzdWJtaXR0aW5nIHJlcXVlc3RzLCB3ZSBhbHdheXMgc2VyaWFs
aXplIGFnYWluc3QKcG90ZW50aWFsIHZtYSBtb3ZlcyBhbmQgY2xmbHVzaGVzLgoKVGltZSBmb3Ig
YSBpOTE1X3JlcXVlc3RfYXdhaXRfdm1hKCkgaW50ZXJmYWNlIQoKU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBNYXR0aGV3IEF1bGQgPG1h
dHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2V4ZWNidWZmZXIuYyAgIHwgIDUgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3RfYmx0LmMgICB8ICA4ICsrKysrKy0tCiAuLi4vZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYyAgfCAgNCArKystCiAuLi4vZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgICAgfCAxNiArKysrKysrKysrKystLS0tCiAu
Li4vZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgfCAgNSArKysr
LQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYyAgIHwgIDgg
KysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmMgICAg
ICB8ICA0ICsrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5j
ICAgICB8IDEwICsrKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xy
Yy5jICAgICAgICAgICB8ICA5ICsrKysrKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3Rfd29ya2Fyb3VuZHMuYyAgIHwgIDQgKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfcmVxdWVzdC5jICAgIHwgIDQgKysrLQogMTEgZmlsZXMgY2hhbmdlZCwgNTcg
aW5zZXJ0aW9ucygrKSwgMjAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggMTI2M2IwMjAxMWY0Li41Mzc1MjAwNmQz
MDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVm
ZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YwpAQCAtMTE5Miw4ICsxMTkyLDkgQEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1
Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJZ290byBza2lwX3JlcXVlc3Q7CiAKIAlpOTE1X3Zt
YV9sb2NrKGJhdGNoKTsKLQlHRU1fQlVHX09OKCFkbWFfcmVzdl90ZXN0X3NpZ25hbGVkX3JjdShi
YXRjaC0+cmVzdiwgdHJ1ZSkpOwotCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKGJhdGNo
LCBycSwgMCk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgYmF0Y2gtPm9i
aiwgZmFsc2UpOworCWlmIChlcnIgPT0gMCkKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3Rp
dmUoYmF0Y2gsIHJxLCAwKTsKIAlpOTE1X3ZtYV91bmxvY2soYmF0Y2gpOwogCWlmIChlcnIpCiAJ
CWdvdG8gc2tpcF9yZXF1ZXN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX29iamVjdF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3RfYmx0LmMKaW5kZXggNzg0NTg1YWZhYzI1Li42NDE1ZjlhMTdlMmQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfYmx0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF9ibHQuYwpAQCAtMTA2LDcg
KzEwNiw5IEBAIGludCBpbnRlbF9lbWl0X3ZtYV9tYXJrX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaW50IGVycjsKIAogCWk5MTVfdm1hX2xv
Y2sodm1hKTsKLQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCAwKTsKKwll
cnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCB2bWEtPm9iaiwgZmFsc2UpOworCWlm
IChlcnIgPT0gMCkKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgMCk7
CiAJaTkxNV92bWFfdW5sb2NrKHZtYSk7CiAJaWYgKHVubGlrZWx5KGVycikpCiAJCXJldHVybiBl
cnI7CkBAIC0xNzEsNyArMTczLDkgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9maWxsX2JsdChzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0KIAogCWk5MTVfdm1hX2xvY2sodm1hKTsK
LQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBFWEVDX09CSkVDVF9XUklU
RSk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmosIHRydWUp
OworCWlmIChlcnIgPT0gMCkKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBy
cSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwogCWk5MTVfdm1hX3VubG9jayh2bWEpOwogCWlmICh1bmxp
a2VseShlcnIpKQogCQlnb3RvIG91dF9yZXF1ZXN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKaW5kZXggYTFhNGI1
M2NkYzRhLi4wZmY3YTg5YWFkY2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYwpAQCAtMjI4LDcgKzIyOCw5IEBA
IHN0YXRpYyBpbnQgZ3B1X3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWlu
dGVsX3JpbmdfYWR2YW5jZShycSwgY3MpOwogCiAJaTkxNV92bWFfbG9jayh2bWEpOwotCWVyciA9
IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwll
cnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCB2bWEtPm9iaiwgdHJ1ZSk7CisJaWYg
KGVyciA9PSAwKQorCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBFWEVD
X09CSkVDVF9XUklURSk7CiAJaTkxNV92bWFfdW5sb2NrKHZtYSk7CiAJaTkxNV92bWFfdW5waW4o
dm1hKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5
MTVfZ2VtX2NvbnRleHQuYwppbmRleCBkZDg3ZTZjZDYxMmUuLjNlNmY0YTY1ZDM1NiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250
ZXh0LmMKQEAgLTY2NiwxMyArNjY2LDE3IEBAIGVtaXRfcnBjc19xdWVyeShzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCQlnb3RvIGVycl9yZXF1ZXN0OwogCiAJaTkxNV92bWFfbG9j
ayhiYXRjaCk7Ci0JZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUoYmF0Y2gsIHJxLCAwKTsK
KwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCBiYXRjaC0+b2JqLCBmYWxzZSk7
CisJaWYgKGVyciA9PSAwKQorCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShiYXRjaCwg
cnEsIDApOwogCWk5MTVfdm1hX3VubG9jayhiYXRjaCk7CiAJaWYgKGVycikKIAkJZ290byBza2lw
X3JlcXVlc3Q7CiAKIAlpOTE1X3ZtYV9sb2NrKHZtYSk7Ci0JZXJyID0gaTkxNV92bWFfbW92ZV90
b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCWVyciA9IGk5MTVfcmVxdWVz
dF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCB0cnVlKTsKKwlpZiAoZXJyID09IDApCisJCWVy
ciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsK
IAlpOTE1X3ZtYV91bmxvY2sodm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIHNraXBfcmVxdWVzdDsK
QEAgLTEyMTgsNyArMTIyMiw5IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQlnb3RvIGVycl9yZXF1ZXN0OwogCiAJaTkxNV92bWFf
bG9jayh2bWEpOwotCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIDApOwor
CWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCBmYWxzZSk7CisJ
aWYgKGVyciA9PSAwKQorCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCAw
KTsKIAlpOTE1X3ZtYV91bmxvY2sodm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIHNraXBfcmVxdWVz
dDsKQEAgLTEzMTUsNyArMTMyMSw5IEBAIHN0YXRpYyBpbnQgcmVhZF9mcm9tX3NjcmF0Y2goc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJZ290byBlcnJfcmVxdWVzdDsKIAogCWk5MTVf
dm1hX2xvY2sodm1hKTsKLQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBF
WEVDX09CSkVDVF9XUklURSk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwg
dm1hLT5vYmosIHRydWUpOworCWlmIChlcnIgPT0gMCkKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90
b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwogCWk5MTVfdm1hX3VubG9jayh2
bWEpOwogCWlmIChlcnIpCiAJCWdvdG8gc2tpcF9yZXF1ZXN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwppbmRleCA1MGFhN2U5NTEy
NGQuLjFkMjdiYWJmZjBjZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTM1MSw3ICszNTEsMTAgQEAgc3RhdGljIGludCBt
YWtlX29ial9idXN5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJCX0KIAogCQlp
OTE1X3ZtYV9sb2NrKHZtYSk7Ci0JCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwg
cnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVj
dChycSwgdm1hLT5vYmosIHRydWUpOworCQlpZiAoZXJyID09IDApCisJCQllcnIgPSBpOTE1X3Zt
YV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLAorCQkJCQkJICAgICAgRVhFQ19PQkpFQ1RfV1JJVEUp
OwogCQlpOTE1X3ZtYV91bmxvY2sodm1hKTsKIAogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGls
cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMK
aW5kZXggNDJlMWU5YzU4ZjYzLi41N2VjZTUzYzEwNzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCkBAIC0xMzksMTMgKzEzOSwx
NyBAQCBpbnQgaWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQlnb3RvIGVy
cl9yZXF1ZXN0OwogCiAJaTkxNV92bWFfbG9jayhiYXRjaCk7Ci0JZXJyID0gaTkxNV92bWFfbW92
ZV90b19hY3RpdmUoYmF0Y2gsIHJxLCAwKTsKKwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2Jq
ZWN0KHJxLCBiYXRjaC0+b2JqLCBmYWxzZSk7CisJaWYgKGVyciA9PSAwKQorCQllcnIgPSBpOTE1
X3ZtYV9tb3ZlX3RvX2FjdGl2ZShiYXRjaCwgcnEsIDApOwogCWk5MTVfdm1hX3VubG9jayhiYXRj
aCk7CiAJaWYgKGVycikKIAkJZ290byBza2lwX3JlcXVlc3Q7CiAKIAlpOTE1X3ZtYV9sb2NrKHZt
YSk7Ci0JZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1Rf
V1JJVEUpOworCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCB0
cnVlKTsKKwlpZiAoZXJyID09IDApCisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZt
YSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKIAlpOTE1X3ZtYV91bmxvY2sodm1hKTsKIAlpZiAo
ZXJyKQogCQlnb3RvIHNraXBfcmVxdWVzdDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yZW5kZXJzdGF0ZS5jCmluZGV4IGJlMzdkNDUwMWM2Ny4uNmQwNWY5YzY0MTc4IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZW5kZXJzdGF0ZS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmMKQEAgLTIyMiw3ICsyMjIs
OSBAQCBpbnQgaW50ZWxfcmVuZGVyc3RhdGVfZW1pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
IAl9CiAKIAlpOTE1X3ZtYV9sb2NrKHNvLnZtYSk7Ci0JZXJyID0gaTkxNV92bWFfbW92ZV90b19h
Y3RpdmUoc28udm1hLCBycSwgMCk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChy
cSwgc28udm1hLT5vYmosIGZhbHNlKTsKKwlpZiAoZXJyID09IDApCisJCWVyciA9IGk5MTVfdm1h
X21vdmVfdG9fYWN0aXZlKHNvLnZtYSwgcnEsIDApOwogCWk5MTVfdm1hX3VubG9jayhzby52bWEp
OwogZXJyX3VucGluOgogCWk5MTVfdm1hX3VucGluKHNvLnZtYSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IDQ0ODRiNDQ0N2RiMS4uMjk4YzRk
MTkxNDM5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5n
Y2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2su
YwpAQCAtMTE4LDcgKzExOCwxMCBAQCBzdGF0aWMgaW50IG1vdmVfdG9fYWN0aXZlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hLAogCWludCBlcnI7CiAKIAlpOTE1X3ZtYV9sb2NrKHZtYSk7Ci0JZXJyID0g
aTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgZmxhZ3MpOworCWVyciA9IGk5MTVfcmVx
dWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLAorCQkJCQlmbGFncyAmIEVYRUNfT0JKRUNU
X1dSSVRFKTsKKwlpZiAoZXJyID09IDApCisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZl
KHZtYSwgcnEsIGZsYWdzKTsKIAlpOTE1X3ZtYV91bmxvY2sodm1hKTsKIAogCXJldHVybiBlcnI7
CkBAIC0xMjM3LDcgKzEyNDAsMTAgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9ldmljdF92bWEo
c3RydWN0IGludGVsX2d0ICpndCwKIAl9CiAKIAlpOTE1X3ZtYV9sb2NrKGFyZy52bWEpOwotCWVy
ciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKGFyZy52bWEsIHJxLCBmbGFncyk7CisJZXJyID0g
aTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgYXJnLnZtYS0+b2JqLAorCQkJCQlmbGFncyAm
IEVYRUNfT0JKRUNUX1dSSVRFKTsKKwlpZiAoZXJyID09IDApCisJCWVyciA9IGk5MTVfdm1hX21v
dmVfdG9fYWN0aXZlKGFyZy52bWEsIHJxLCBmbGFncyk7CiAJaTkxNV92bWFfdW5sb2NrKGFyZy52
bWEpOwogCiAJaWYgKGZsYWdzICYgRVhFQ19PQkpFQ1RfTkVFRFNfRkVOQ0UpCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IGI3OTdiZTE2MjdlOS4uZDYwYjg4ZWZlNjhi
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtMTQ1OSwxMiArMTQ1
OSwxNSBAQCBzdGF0aWMgaW50IHNtb2tlX3N1Ym1pdChzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21v
a2UsCiAKIAlpZiAodm1hKSB7CiAJCWk5MTVfdm1hX2xvY2sodm1hKTsKLQkJZXJyID0gcnEtPmVu
Z2luZS0+ZW1pdF9iYl9zdGFydChycSwKLQkJCQkJCXZtYS0+bm9kZS5zdGFydCwKLQkJCQkJCVBB
R0VfU0laRSwgMCk7CisJCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+
b2JqLCBmYWxzZSk7CiAJCWlmICghZXJyKQogCQkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3Rp
dmUodm1hLCBycSwgMCk7CisJCWlmICghZXJyKQorCQkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9i
Yl9zdGFydChycSwKKwkJCQkJCQl2bWEtPm5vZGUuc3RhcnQsCisJCQkJCQkJUEFHRV9TSVpFLCAw
KTsKIAkJaTkxNV92bWFfdW5sb2NrKHZtYSk7CisKIAl9CiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJx
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91
bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCmlu
ZGV4IGViNWRhMDFkMGEwOC4uZDA2ZDY4YWMyYTNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAgLTExMyw3ICsxMTMsOSBAQCByZWFkX25v
bnByaXZzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKIAl9CiAKIAlpOTE1X3ZtYV9sb2NrKHZtYSk7Ci0JZXJyID0gaTkxNV92bWFf
bW92ZV90b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCWVyciA9IGk5MTVf
cmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCB0cnVlKTsKKwlpZiAoZXJyID09IDAp
CisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIEVYRUNfT0JKRUNUX1dS
SVRFKTsKIAlpOTE1X3ZtYV91bmxvY2sodm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9yZXE7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXgg
MzkzN2Q0M2MyOTYxLi4xNzBlNGFmYTljY2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTg3Niw3ICs4NzYsOSBAQCBzdGF0aWMgaW50IGxp
dmVfYWxsX2VuZ2luZXModm9pZCAqYXJnKQogCQlyZXF1ZXN0W2lkXS0+YmF0Y2ggPSBiYXRjaDsK
IAogCQlpOTE1X3ZtYV9sb2NrKGJhdGNoKTsKLQkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3Rp
dmUoYmF0Y2gsIHJlcXVlc3RbaWRdLCAwKTsKKwkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29i
amVjdChyZXF1ZXN0W2lkXSwgYmF0Y2gtPm9iaiwgMCk7CisJCWlmIChlcnIgPT0gMCkKKwkJCWVy
ciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKGJhdGNoLCByZXF1ZXN0W2lkXSwgMCk7CiAJCWk5
MTVfdm1hX3VubG9jayhiYXRjaCk7CiAJCUdFTV9CVUdfT04oZXJyKTsKIAotLSAKMi4yMy4wLnJj
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwt
Z2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

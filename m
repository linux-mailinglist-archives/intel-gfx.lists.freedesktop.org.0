Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 94D9950B78
	for <lists+intel-gfx@lfdr.de>; Mon, 24 Jun 2019 15:07:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CD07B89A92;
	Mon, 24 Jun 2019 13:07:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B577C89B11
 for <intel-gfx@lists.freedesktop.org>; Mon, 24 Jun 2019 13:07:40 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17005454-1500050 
 for multiple; Mon, 24 Jun 2019 14:07:11 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 24 Jun 2019 14:07:07 +0100
Message-Id: <20190624130707.13292-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190624130707.13292-1-chris@chris-wilson.co.uk>
References: <20190624130707.13292-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/3] drm/i915/execlists: Convert recursive
 defer_request() into iterative
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgdGhpcyBlbmdpbmUgb3ducyB0aGUgbG9jayBhcm91bmQgcnEtPnNjaGVkLmxpbmsgKGZvciB0
aG9zZSB3YWl0ZXJzCnN1Ym1pdHRlZCB0byB0aGlzIGVuZ2luZSksIHdlIGNhbiB1c2UgdGhhdCBs
aW5rIGFzIGFuIGVsZW1lbnQgaW4gYSBsb2NhbApsaXN0LiBXZSBjYW4gdGh1cyByZXBsYWNlIHRo
ZSByZWN1cnNpdmUgYWxnb3JpdGhtIHdpdGggYW4gaXRlcmF0aXZlIHdhbGsKb3ZlciB0aGUgb3Jk
ZXJlZCBsaXN0IG9mIHdhaXRlcnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYyB8IDUyICsrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
MjcgaW5zZXJ0aW9ucygrKSwgMjUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9scmMuYwppbmRleCBjMmFhYWI0Yjc0M2UuLjE3YjE3OGRiYTdjMCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTgyNywxMCArODI3LDkgQEAgbGFzdF9hY3RpdmUoY29uc3Qg
c3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKmV4ZWNsaXN0cykKIAlyZXR1cm4gKmxhc3Q7
CiB9CiAKLXN0YXRpYyB2b2lkCi1kZWZlcl9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKiBj
b25zdCBycSwgc3RydWN0IGxpc3RfaGVhZCAqIGNvbnN0IHBsKQorc3RhdGljIHZvaWQgZGVmZXJf
cmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGxpc3RfaGVhZCAqIGNvbnN0
IHBsKQogewotCXN0cnVjdCBpOTE1X2RlcGVuZGVuY3kgKnA7CisJTElTVF9IRUFEKGxpc3QpOwog
CiAJLyoKIAkgKiBXZSB3YW50IHRvIG1vdmUgdGhlIGludGVycnVwdGVkIHJlcXVlc3QgdG8gdGhl
IGJhY2sgb2YKQEAgLTgzOSwzNCArODM4LDM3IEBAIGRlZmVyX3JlcXVlc3Qoc3RydWN0IGk5MTVf
cmVxdWVzdCAqIGNvbnN0IHJxLCBzdHJ1Y3QgbGlzdF9oZWFkICogY29uc3QgcGwpCiAJICogZmxp
Z2h0IGFuZCB3ZXJlIHdhaXRpbmcgZm9yIHRoZSBpbnRlcnJ1cHRlZCByZXF1ZXN0IHRvCiAJICog
YmUgcnVuIGFmdGVyIGl0IGFnYWluLgogCSAqLwotCWxpc3RfbW92ZV90YWlsKCZycS0+c2NoZWQu
bGluaywgcGwpOworCWRvIHsKKwkJc3RydWN0IGk5MTVfZGVwZW5kZW5jeSAqcDsKIAotCWxpc3Rf
Zm9yX2VhY2hfZW50cnkocCwgJnJxLT5zY2hlZC53YWl0ZXJzX2xpc3QsIHdhaXRfbGluaykgewot
CQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICp3ID0KLQkJCWNvbnRhaW5lcl9vZihwLT53YWl0ZXIsIHR5
cGVvZigqdyksIHNjaGVkKTsKKwkJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfaXNfYWN0aXZlKHJx
KSk7CisJCWxpc3RfbW92ZV90YWlsKCZycS0+c2NoZWQubGluaywgcGwpOwogCi0JCS8qIExlYXZl
IHNlbWFwaG9yZXMgc3Bpbm5pbmcgb24gdGhlIG90aGVyIGVuZ2luZXMgKi8KLQkJaWYgKHctPmVu
Z2luZSAhPSBycS0+ZW5naW5lKQotCQkJY29udGludWU7CisJCWxpc3RfZm9yX2VhY2hfZW50cnko
cCwgJnJxLT5zY2hlZC53YWl0ZXJzX2xpc3QsIHdhaXRfbGluaykgeworCQkJc3RydWN0IGk5MTVf
cmVxdWVzdCAqdyA9CisJCQkJY29udGFpbmVyX29mKHAtPndhaXRlciwgdHlwZW9mKCp3KSwgc2No
ZWQpOwogCi0JCS8qIE5vIHdhaXRlciBzaG91bGQgc3RhcnQgYmVmb3JlIHRoZSBhY3RpdmUgcmVx
dWVzdCBjb21wbGV0ZWQgKi8KLQkJR0VNX0JVR19PTihpOTE1X3JlcXVlc3Rfc3RhcnRlZCh3KSk7
CisJCQkvKiBMZWF2ZSBzZW1hcGhvcmVzIHNwaW5uaW5nIG9uIHRoZSBvdGhlciBlbmdpbmVzICov
CisJCQlpZiAody0+ZW5naW5lICE9IHJxLT5lbmdpbmUpCisJCQkJY29udGludWU7CiAKLQkJR0VN
X0JVR19PTihycV9wcmlvKHcpID4gcnFfcHJpbyhycSkpOwotCQlpZiAocnFfcHJpbyh3KSA8IHJx
X3ByaW8ocnEpKQotCQkJY29udGludWU7CisJCQkvKiBObyB3YWl0ZXIgc2hvdWxkIHN0YXJ0IGJl
Zm9yZSBpdHMgc2lnbmFsZXIgKi8KKwkJCUdFTV9CVUdfT04oaTkxNV9yZXF1ZXN0X3N0YXJ0ZWQo
dykgJiYKKwkJCQkgICAhaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpOwogCi0JCWlmIChsaXN0
X2VtcHR5KCZ3LT5zY2hlZC5saW5rKSkKLQkJCWNvbnRpbnVlOyAvKiBOb3QgeWV0IHN1Ym1pdHRl
ZDsgdW5yZWFkeSAqLworCQkJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfaXNfYWN0aXZlKHcpKTsK
KwkJCWlmIChsaXN0X2VtcHR5KCZ3LT5zY2hlZC5saW5rKSkKKwkJCQljb250aW51ZTsgLyogTm90
IHlldCBzdWJtaXR0ZWQ7IHVucmVhZHkgKi8KIAotCQkvKgotCQkgKiBUaGlzIHNob3VsZCBiZSB2
ZXJ5IHNoYWxsb3cgYXMgaXQgaXMgbGltaXRlZCBieSB0aGUKLQkJICogbnVtYmVyIG9mIHJlcXVl
c3RzIHRoYXQgY2FuIGZpdCBpbiBhIHJpbmcgKDw2NCkgYW5kCi0JCSAqIHRoZSBudW1iZXIgb2Yg
Y29udGV4dHMgdGhhdCBjYW4gYmUgaW4gZmxpZ2h0IG9uIHRoaXMKLQkJICogZW5naW5lLgotCQkg
Ki8KLQkJZGVmZXJfcmVxdWVzdCh3LCBwbCk7Ci0JfQorCQkJaWYgKHJxX3ByaW8odykgPCBycV9w
cmlvKHJxKSkKKwkJCQljb250aW51ZTsKKworCQkJR0VNX0JVR19PTihycV9wcmlvKHcpID4gcnFf
cHJpbyhycSkpOworCQkJbGlzdF9tb3ZlX3RhaWwoJnctPnNjaGVkLmxpbmssICZsaXN0KTsKKwkJ
fQorCisJCXJxID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZsaXN0LCB0eXBlb2YoKnJxKSwg
c2NoZWQubGluayk7CisJfSB3aGlsZSAocnEpOwogfQogCiBzdGF0aWMgdm9pZCBkZWZlcl9hY3Rp
dmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

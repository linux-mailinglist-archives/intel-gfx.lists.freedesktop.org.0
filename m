Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CA8DC25F55
	for <lists+intel-gfx@lfdr.de>; Wed, 22 May 2019 10:21:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A4C82897E3;
	Wed, 22 May 2019 08:21:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4A1C189789
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 May 2019 08:21:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16636787-1500050 
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 May 2019 09:21:06 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 May 2019 09:20:58 +0100
Message-Id: <20190522082104.5117-7-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190522082104.5117-1-chris@chris-wilson.co.uk>
References: <20190522082104.5117-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 07/13] drm/i915: Move GEM domain management to its
 own file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29udGludWluZyB0aGUgZGVjbHV0dGVyaW5nIG9mIGk5MTVfZ2VtLmMsIHRoYXQgb2YgdGhlIHJl
YWQvd3JpdGUKZG9tYWlucywgcGVyaGFwcyB0aGUgYmlnZ2VzdCBvZiBHRU0ncyBmb2xsaWVzPwoK
U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJl
dmlld2VkLWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyAgICB8IDc4MiArKysrKysrKysr
KysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCAgICB8
ICAyOSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jICAgICAgICAgfCAg
IDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyAgICAgICAgICB8ICAg
NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9jbWRfcGFyc2VyLmMgICAgICAgIHwgICA4
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgMjYg
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgNzc3ICst
LS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9leGVjYnVmZmVy
LmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3JlbmRlcl9zdGF0
ZS5jICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2h1Z2VfcGFnZXMu
YyAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5j
ICAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQu
YyB8ICAgOCArLQogMTMgZmlsZXMgY2hhbmdlZCwgODM5IGluc2VydGlvbnMoKyksIDgyMiBkZWxl
dGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZG9tYWluLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmls
ZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGQwNTc1N2M1MjQ5Mi4uMjlm
YzkyNGJhODE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtODcsNiArODcsNyBAQCBpOTE1LXkg
Kz0gJChndC15KQogIyBHRU0gKEdyYXBoaWNzIEV4ZWN1dGlvbiBNYW5hZ2VtZW50KSBjb2RlCiBv
YmoteSArPSBnZW0vCiBnZW0teSArPSBcCisJZ2VtL2k5MTVfZ2VtX2RvbWFpbi5vIFwKIAlnZW0v
aTkxNV9nZW1fb2JqZWN0Lm8gXAogCWdlbS9pOTE1X2dlbV9tbWFuLm8gXAogCWdlbS9pOTE1X2dl
bV9wYWdlcy5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmJiYzdmYjc1ODE4NgotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4u
YwpAQCAtMCwwICsxLDc4MiBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQK
KyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxNC0yMDE2IEludGVsIENvcnBvcmF0aW9uCisgKi8KKwor
I2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fY2xmbHVzaC5oIgorI2lu
Y2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX2lvY3Rscy5oIgorI2lu
Y2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgorI2luY2x1ZGUgImk5MTVfdm1hLmgiCisjaW5jbHVk
ZSAiaW50ZWxfZnJvbnRidWZmZXIuaCIKKworc3RhdGljIHZvaWQgX19pOTE1X2dlbV9vYmplY3Rf
Zmx1c2hfZm9yX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwkv
KgorCSAqIFdlIG1hbnVhbGx5IGZsdXNoIHRoZSBDUFUgZG9tYWluIHNvIHRoYXQgd2UgY2FuIG92
ZXJyaWRlIGFuZAorCSAqIGZvcmNlIHRoZSBmbHVzaCBmb3IgdGhlIGRpc3BsYXksIGFuZCBwZXJm
b3JtIGl0IGFzeW5jcmhvbm91c2x5LgorCSAqLworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0
ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7CisJaWYgKG9iai0+Y2FjaGVfZGly
dHkpCisJCWk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0KG9iaiwgSTkxNV9DTEZMVVNIX0ZPUkNFKTsK
KwlvYmotPndyaXRlX2RvbWFpbiA9IDA7Cit9CisKK3ZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X2lmX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlpZiAoIVJF
QURfT05DRShvYmotPnBpbl9nbG9iYWwpKQorCQlyZXR1cm47CisKKwltdXRleF9sb2NrKCZvYmot
PmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCV9faTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2Zvcl9k
aXNwbGF5KG9iaik7CisJbXV0ZXhfdW5sb2NrKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgp
OworfQorCisvKioKKyAqIE1vdmVzIGEgc2luZ2xlIG9iamVjdCB0byB0aGUgV0MgcmVhZCwgYW5k
IHBvc3NpYmx5IHdyaXRlIGRvbWFpbi4KKyAqIEBvYmo6IG9iamVjdCB0byBhY3Qgb24KKyAqIEB3
cml0ZTogYXNrIGZvciB3cml0ZSBhY2Nlc3Mgb3IgcmVhZCBvbmx5CisgKgorICogVGhpcyBmdW5j
dGlvbiByZXR1cm5zIHdoZW4gdGhlIG1vdmUgaXMgY29tcGxldGUsIGluY2x1ZGluZyB3YWl0aW5n
IG9uCisgKiBmbHVzaGVzIHRvIG9jY3VyLgorICovCitpbnQKK2k5MTVfZ2VtX29iamVjdF9zZXRf
dG9fd2NfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGJvb2wgd3JpdGUp
Cit7CisJaW50IHJldDsKKworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0
cnVjdF9tdXRleCk7CisKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAg
STkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAorCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQgfAorCQkJ
CSAgICh3cml0ZSA/IEk5MTVfV0FJVF9BTEwgOiAwKSwKKwkJCQkgICBNQVhfU0NIRURVTEVfVElN
RU9VVCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmIChvYmotPndyaXRlX2RvbWFp
biA9PSBJOTE1X0dFTV9ET01BSU5fV0MpCisJCXJldHVybiAwOworCisJLyogRmx1c2ggYW5kIGFj
cXVpcmUgb2JqLT5wYWdlcyBzbyB0aGF0IHdlIGFyZSBjb2hlcmVudCB0aHJvdWdoCisJICogZGly
ZWN0IGFjY2VzcyBpbiBtZW1vcnkgd2l0aCBwcmV2aW91cyBjYWNoZWQgd3JpdGVzIHRocm91Z2gK
KwkgKiBzaG1lbWZzIGFuZCB0aGF0IG91ciBjYWNoZSBkb21haW4gdHJhY2tpbmcgcmVtYWlucyB2
YWxpZC4KKwkgKiBGb3IgZXhhbXBsZSwgaWYgdGhlIG9iai0+ZmlscCB3YXMgbW92ZWQgdG8gc3dh
cCB3aXRob3V0IHVzCisJICogYmVpbmcgbm90aWZpZWQgYW5kIHJlbGVhc2luZyB0aGUgcGFnZXMs
IHdlIHdvdWxkIG1pc3Rha2VubHkKKwkgKiBjb250aW51ZSB0byBhc3N1bWUgdGhhdCB0aGUgb2Jq
IHJlbWFpbmVkIG91dCBvZiB0aGUgQ1BVIGNhY2hlZAorCSAqIGRvbWFpbi4KKwkgKi8KKwlyZXQg
PSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1f
RE9NQUlOX1dDKTsKKworCS8qIFNlcmlhbGlzZSBkaXJlY3QgYWNjZXNzIHRvIHRoaXMgb2JqZWN0
IHdpdGggdGhlIGJhcnJpZXJzIGZvcgorCSAqIGNvaGVyZW50IHdyaXRlcyBmcm9tIHRoZSBHUFUs
IGJ5IGVmZmVjdGl2ZWx5IGludmFsaWRhdGluZyB0aGUKKwkgKiBXQyBkb21haW4gdXBvbiBmaXJz
dCBhY2Nlc3MuCisJICovCisJaWYgKChvYmotPnJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJ
Tl9XQykgPT0gMCkKKwkJbWIoKTsKKworCS8qIEl0IHNob3VsZCBub3cgYmUgb3V0IG9mIGFueSBv
dGhlciB3cml0ZSBkb21haW5zLCBhbmQgd2UgY2FuIHVwZGF0ZQorCSAqIHRoZSBkb21haW4gdmFs
dWVzIGZvciBvdXIgY2hhbmdlcy4KKwkgKi8KKwlHRU1fQlVHX09OKChvYmotPndyaXRlX2RvbWFp
biAmIH5JOTE1X0dFTV9ET01BSU5fV0MpICE9IDApOworCW9iai0+cmVhZF9kb21haW5zIHw9IEk5
MTVfR0VNX0RPTUFJTl9XQzsKKwlpZiAod3JpdGUpIHsKKwkJb2JqLT5yZWFkX2RvbWFpbnMgPSBJ
OTE1X0dFTV9ET01BSU5fV0M7CisJCW9iai0+d3JpdGVfZG9tYWluID0gSTkxNV9HRU1fRE9NQUlO
X1dDOworCQlvYmotPm1tLmRpcnR5ID0gdHJ1ZTsKKwl9CisKKwlpOTE1X2dlbV9vYmplY3RfdW5w
aW5fcGFnZXMob2JqKTsKKwlyZXR1cm4gMDsKK30KKworLyoqCisgKiBNb3ZlcyBhIHNpbmdsZSBv
YmplY3QgdG8gdGhlIEdUVCByZWFkLCBhbmQgcG9zc2libHkgd3JpdGUgZG9tYWluLgorICogQG9i
ajogb2JqZWN0IHRvIGFjdCBvbgorICogQHdyaXRlOiBhc2sgZm9yIHdyaXRlIGFjY2VzcyBvciBy
ZWFkIG9ubHkKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIHJldHVybnMgd2hlbiB0aGUgbW92ZSBpcyBj
b21wbGV0ZSwgaW5jbHVkaW5nIHdhaXRpbmcgb24KKyAqIGZsdXNoZXMgdG8gb2NjdXIuCisgKi8K
K2ludAoraTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosIGJvb2wgd3JpdGUpCit7CisJaW50IHJldDsKKworCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7CisKKwlyZXQgPSBpOTE1X2dl
bV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAorCQkJ
CSAgIEk5MTVfV0FJVF9MT0NLRUQgfAorCQkJCSAgICh3cml0ZSA/IEk5MTVfV0FJVF9BTEwgOiAw
KSwKKwkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKKworCWlmIChvYmotPndyaXRlX2RvbWFpbiA9PSBJOTE1X0dFTV9ET01BSU5fR1RUKQorCQly
ZXR1cm4gMDsKKworCS8qIEZsdXNoIGFuZCBhY3F1aXJlIG9iai0+cGFnZXMgc28gdGhhdCB3ZSBh
cmUgY29oZXJlbnQgdGhyb3VnaAorCSAqIGRpcmVjdCBhY2Nlc3MgaW4gbWVtb3J5IHdpdGggcHJl
dmlvdXMgY2FjaGVkIHdyaXRlcyB0aHJvdWdoCisJICogc2htZW1mcyBhbmQgdGhhdCBvdXIgY2Fj
aGUgZG9tYWluIHRyYWNraW5nIHJlbWFpbnMgdmFsaWQuCisJICogRm9yIGV4YW1wbGUsIGlmIHRo
ZSBvYmotPmZpbHAgd2FzIG1vdmVkIHRvIHN3YXAgd2l0aG91dCB1cworCSAqIGJlaW5nIG5vdGlm
aWVkIGFuZCByZWxlYXNpbmcgdGhlIHBhZ2VzLCB3ZSB3b3VsZCBtaXN0YWtlbmx5CisJICogY29u
dGludWUgdG8gYXNzdW1lIHRoYXQgdGhlIG9iaiByZW1haW5lZCBvdXQgb2YgdGhlIENQVSBjYWNo
ZWQKKwkgKiBkb21haW4uCisJICovCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhv
YmopOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpOTE1X2dlbV9vYmplY3RfZmx1c2hf
d3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9HVFQpOworCisJLyogU2VyaWFsaXNl
IGRpcmVjdCBhY2Nlc3MgdG8gdGhpcyBvYmplY3Qgd2l0aCB0aGUgYmFycmllcnMgZm9yCisJICog
Y29oZXJlbnQgd3JpdGVzIGZyb20gdGhlIEdQVSwgYnkgZWZmZWN0aXZlbHkgaW52YWxpZGF0aW5n
IHRoZQorCSAqIEdUVCBkb21haW4gdXBvbiBmaXJzdCBhY2Nlc3MuCisJICovCisJaWYgKChvYmot
PnJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJTl9HVFQpID09IDApCisJCW1iKCk7CisKKwkv
KiBJdCBzaG91bGQgbm93IGJlIG91dCBvZiBhbnkgb3RoZXIgd3JpdGUgZG9tYWlucywgYW5kIHdl
IGNhbiB1cGRhdGUKKwkgKiB0aGUgZG9tYWluIHZhbHVlcyBmb3Igb3VyIGNoYW5nZXMuCisJICov
CisJR0VNX0JVR19PTigob2JqLT53cml0ZV9kb21haW4gJiB+STkxNV9HRU1fRE9NQUlOX0dUVCkg
IT0gMCk7CisJb2JqLT5yZWFkX2RvbWFpbnMgfD0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKKwlpZiAo
d3JpdGUpIHsKKwkJb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fR1RUOworCQlv
YmotPndyaXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9HVFQ7CisJCW9iai0+bW0uZGlydHkg
PSB0cnVlOworCX0KKworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOworCXJldHVy
biAwOworfQorCisvKioKKyAqIENoYW5nZXMgdGhlIGNhY2hlLWxldmVsIG9mIGFuIG9iamVjdCBh
Y3Jvc3MgYWxsIFZNQS4KKyAqIEBvYmo6IG9iamVjdCB0byBhY3Qgb24KKyAqIEBjYWNoZV9sZXZl
bDogbmV3IGNhY2hlIGxldmVsIHRvIHNldCBmb3IgdGhlIG9iamVjdAorICoKKyAqIEFmdGVyIHRo
aXMgZnVuY3Rpb24gcmV0dXJucywgdGhlIG9iamVjdCB3aWxsIGJlIGluIHRoZSBuZXcgY2FjaGUt
bGV2ZWwKKyAqIGFjcm9zcyBhbGwgR1RUIGFuZCB0aGUgY29udGVudHMgb2YgdGhlIGJhY2tpbmcg
c3RvcmFnZSB3aWxsIGJlIGNvaGVyZW50LAorICogd2l0aCByZXNwZWN0IHRvIHRoZSBuZXcgY2Fj
aGUtbGV2ZWwuIEluIG9yZGVyIHRvIGtlZXAgdGhlIGJhY2tpbmcgc3RvcmFnZQorICogY29oZXJl
bnQgZm9yIGFsbCB1c2Vycywgd2Ugb25seSBhbGxvdyBhIHNpbmdsZSBjYWNoZSBsZXZlbCB0byBi
ZSBzZXQKKyAqIGdsb2JhbGx5IG9uIHRoZSBvYmplY3QgYW5kIHByZXZlbnQgaXQgZnJvbSBiZWlu
ZyBjaGFuZ2VkIHdoaWxzdCB0aGUKKyAqIGhhcmR3YXJlIGlzIHJlYWRpbmcgZnJvbSB0aGUgb2Jq
ZWN0LiBUaGF0IGlzIGlmIHRoZSBvYmplY3QgaXMgY3VycmVudGx5CisgKiBvbiB0aGUgc2Nhbm91
dCBpdCB3aWxsIGJlIHNldCB0byB1bmNhY2hlZCAob3IgZXF1aXZhbGVudCBkaXNwbGF5CisgKiBj
YWNoZSBjb2hlcmVuY3kpIGFuZCBhbGwgbm9uLU1PQ1MgR1BVIGFjY2VzcyB3aWxsIGFsc28gYmUg
dW5jYWNoZWQgc28KKyAqIHRoYXQgYWxsIGRpcmVjdCBhY2Nlc3MgdG8gdGhlIHNjYW5vdXQgcmVt
YWlucyBjb2hlcmVudC4KKyAqLworaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgICAgZW51bSBpOTE1X2NhY2hl
X2xldmVsIGNhY2hlX2xldmVsKQoreworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWludCByZXQ7
CisKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwor
CisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgPT0gY2FjaGVfbGV2ZWwpCisJCXJldHVybiAwOworCisJ
LyogSW5zcGVjdCB0aGUgbGlzdCBvZiBjdXJyZW50bHkgYm91bmQgVk1BIGFuZCB1bmJpbmQgYW55
IHRoYXQgd291bGQKKwkgKiBiZSBpbnZhbGlkIGdpdmVuIHRoZSBuZXcgY2FjaGUtbGV2ZWwuIFRo
aXMgaXMgcHJpbmNpcGFsbHkgdG8KKwkgKiBjYXRjaCB0aGUgaXNzdWUgb2YgdGhlIENTIHByZWZl
dGNoIGNyb3NzaW5nIHBhZ2UgYm91bmRhcmllcyBhbmQKKwkgKiByZWFkaW5nIGFuIGludmFsaWQg
UFRFIG9uIG9sZGVyIGFyY2hpdGVjdHVyZXMuCisJICovCityZXN0YXJ0OgorCWxpc3RfZm9yX2Vh
Y2hfZW50cnkodm1hLCAmb2JqLT52bWEubGlzdCwgb2JqX2xpbmspIHsKKwkJaWYgKCFkcm1fbW1f
bm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCisJCQljb250aW51ZTsKKworCQlpZiAoaTkxNV92
bWFfaXNfcGlubmVkKHZtYSkpIHsKKwkJCURSTV9ERUJVRygiY2FuIG5vdCBjaGFuZ2UgdGhlIGNh
Y2hlIGxldmVsIG9mIHBpbm5lZCBvYmplY3RzXG4iKTsKKwkJCXJldHVybiAtRUJVU1k7CisJCX0K
KworCQlpZiAoIWk5MTVfdm1hX2lzX2Nsb3NlZCh2bWEpICYmCisJCSAgICBpOTE1X2dlbV92YWxp
ZF9ndHRfc3BhY2Uodm1hLCBjYWNoZV9sZXZlbCkpCisJCQljb250aW51ZTsKKworCQlyZXQgPSBp
OTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJLyog
QXMgdW5iaW5kaW5nIG1heSBhZmZlY3Qgb3RoZXIgZWxlbWVudHMgaW4gdGhlCisJCSAqIG9iai0+
dm1hX2xpc3QgKGR1ZSB0byBzaWRlLWVmZmVjdHMgZnJvbSByZXRpcmluZworCQkgKiBhbiBhY3Rp
dmUgdm1hKSwgcGxheSBzYWZlIGFuZCByZXN0YXJ0IHRoZSBpdGVyYXRvci4KKwkJICovCisJCWdv
dG8gcmVzdGFydDsKKwl9CisKKwkvKiBXZSBjYW4gcmV1c2UgdGhlIGV4aXN0aW5nIGRybV9tbSBu
b2RlcyBidXQgbmVlZCB0byBjaGFuZ2UgdGhlCisJICogY2FjaGUtbGV2ZWwgb24gdGhlIFBURS4g
V2UgY291bGQgc2ltcGx5IHVuYmluZCB0aGVtIGFsbCBhbmQKKwkgKiByZWJpbmQgd2l0aCB0aGUg
Y29ycmVjdCBjYWNoZS1sZXZlbCBvbiBuZXh0IHVzZS4gSG93ZXZlciBzaW5jZQorCSAqIHdlIGFs
cmVhZHkgaGF2ZSBhIHZhbGlkIHNsb3QsIGRtYSBtYXBwaW5nLCBwYWdlcyBldGMsIHdlIG1heSBh
cworCSAqIHJld3JpdGUgdGhlIFBURSBpbiB0aGUgYmVsaWVmIHRoYXQgZG9pbmcgc28gdHJhbXBs
ZXMgdXBvbiBsZXNzCisJICogc3RhdGUgYW5kIHNvIGludm9sdmVzIGxlc3Mgd29yay4KKwkgKi8K
KwlpZiAob2JqLT5iaW5kX2NvdW50KSB7CisJCS8qIEJlZm9yZSB3ZSBjaGFuZ2UgdGhlIFBURSwg
dGhlIEdQVSBtdXN0IG5vdCBiZSBhY2Nlc3NpbmcgaXQuCisJCSAqIElmIHdlIHdhaXQgdXBvbiB0
aGUgb2JqZWN0LCB3ZSBrbm93IHRoYXQgYWxsIHRoZSBib3VuZAorCQkgKiBWTUEgYXJlIG5vIGxv
bmdlciBhY3RpdmUuCisJCSAqLworCQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJ
CQkJCSAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKKwkJCQkJICAgSTkxNV9XQUlUX0xPQ0tF
RCB8CisJCQkJCSAgIEk5MTVfV0FJVF9BTEwsCisJCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1FT1VU
KTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJaWYgKCFIQVNfTExDKHRvX2k5MTUo
b2JqLT5iYXNlLmRldikpICYmCisJCSAgICBjYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUp
IHsKKwkJCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlzCisJ
CQkgKiBpbmNvaGVyZW50IGFuZCBvbiBzb21lIG1hY2hpbmVzIGNhdXNlcyBhIGhhcmQKKwkJCSAq
IGxvY2t1cC4gUmVsaW5xdWlzaCB0aGUgQ1BVIG1tYXBpbmcgdG8gZm9yY2UKKwkJCSAqIHVzZXJz
cGFjZSB0byByZWZhdWx0IGluIHRoZSBwYWdlcyBhbmQgd2UgY2FuCisJCQkgKiB0aGVuIGRvdWJs
ZSBjaGVjayBpZiB0aGUgR1RUIG1hcHBpbmcgaXMgc3RpbGwKKwkJCSAqIHZhbGlkIGZvciB0aGF0
IHBvaW50ZXIgYWNjZXNzLgorCQkJICovCisJCQlpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFw
KG9iaik7CisKKwkJCS8qIEFzIHdlIG5vIGxvbmdlciBuZWVkIGEgZmVuY2UgZm9yIEdUVCBhY2Nl
c3MsCisJCQkgKiB3ZSBjYW4gcmVsaW5xdWlzaCBpdCBub3cgKGFuZCBzbyBwcmV2ZW50IGhhdmlu
ZworCQkJICogdG8gc3RlYWwgYSBmZW5jZSBmcm9tIHNvbWVvbmUgZWxzZSBvbiB0aGUgbmV4dAor
CQkJICogZmVuY2UgcmVxdWVzdCkuIE5vdGUgR1BVIGFjdGl2aXR5IHdvdWxkIGhhdmUKKwkJCSAq
IGRyb3BwZWQgdGhlIGZlbmNlIGFzIGFsbCBzbm9vcGFibGUgYWNjZXNzIGlzCisJCQkgKiBzdXBw
b3NlZCB0byBiZSBsaW5lYXIuCisJCQkgKi8KKwkJCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2Jq
KSB7CisJCQkJcmV0ID0gaTkxNV92bWFfcHV0X2ZlbmNlKHZtYSk7CisJCQkJaWYgKHJldCkKKwkJ
CQkJcmV0dXJuIHJldDsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJCS8qIFdlIGVpdGhlciBoYXZlIGlu
Y29oZXJlbnQgYmFja2luZyBzdG9yZSBhbmQKKwkJCSAqIHNvIG5vIEdUVCBhY2Nlc3Mgb3IgdGhl
IGFyY2hpdGVjdHVyZSBpcyBmdWxseQorCQkJICogY29oZXJlbnQuIEluIHN1Y2ggY2FzZXMsIGV4
aXN0aW5nIEdUVCBtbWFwcworCQkJICogaWdub3JlIHRoZSBjYWNoZSBiaXQgaW4gdGhlIFBURSBh
bmQgd2UgY2FuCisJCQkgKiByZXdyaXRlIGl0IHdpdGhvdXQgY29uZnVzaW5nIHRoZSBHUFUgb3Ig
aGF2aW5nCisJCQkgKiB0byBmb3JjZSB1c2Vyc3BhY2UgdG8gZmF1bHQgYmFjayBpbiBpdHMgbW1h
cHMuCisJCQkgKi8KKwkJfQorCisJCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmb2JqLT52bWEu
bGlzdCwgb2JqX2xpbmspIHsKKwkJCWlmICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKQorCQkJCWNvbnRpbnVlOworCisJCQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgY2FjaGVf
bGV2ZWwsIFBJTl9VUERBVEUpOworCQkJaWYgKHJldCkKKwkJCQlyZXR1cm4gcmV0OworCQl9CisJ
fQorCisJbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykK
KwkJdm1hLT5ub2RlLmNvbG9yID0gY2FjaGVfbGV2ZWw7CisJaTkxNV9nZW1fb2JqZWN0X3NldF9j
YWNoZV9jb2hlcmVuY3kob2JqLCBjYWNoZV9sZXZlbCk7CisJb2JqLT5jYWNoZV9kaXJ0eSA9IHRy
dWU7IC8qIEFsd2F5cyBpbnZhbGlkYXRlIHN0YWxlIGNhY2hlbGluZXMgKi8KKworCXJldHVybiAw
OworfQorCitpbnQgaTkxNV9nZW1fZ2V0X2NhY2hpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdm9pZCAqZGF0YSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCit7CisJ
c3RydWN0IGRybV9pOTE1X2dlbV9jYWNoaW5nICphcmdzID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOworCWludCBlcnIgPSAwOworCisJcmN1X3JlYWRfbG9jaygpOwor
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXBfcmN1KGZpbGUsIGFyZ3MtPmhhbmRsZSk7CisJ
aWYgKCFvYmopIHsKKwkJZXJyID0gLUVOT0VOVDsKKwkJZ290byBvdXQ7CisJfQorCisJc3dpdGNo
IChvYmotPmNhY2hlX2xldmVsKSB7CisJY2FzZSBJOTE1X0NBQ0hFX0xMQzoKKwljYXNlIEk5MTVf
Q0FDSEVfTDNfTExDOgorCQlhcmdzLT5jYWNoaW5nID0gSTkxNV9DQUNISU5HX0NBQ0hFRDsKKwkJ
YnJlYWs7CisKKwljYXNlIEk5MTVfQ0FDSEVfV1Q6CisJCWFyZ3MtPmNhY2hpbmcgPSBJOTE1X0NB
Q0hJTkdfRElTUExBWTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQlhcmdzLT5jYWNoaW5nID0g
STkxNV9DQUNISU5HX05PTkU7CisJCWJyZWFrOworCX0KK291dDoKKwlyY3VfcmVhZF91bmxvY2so
KTsKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaTkxNV9nZW1fc2V0X2NhY2hpbmdfaW9jdGwoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IGRybV9pOTE1X2dlbV9jYWNoaW5nICphcmdzID0gZGF0YTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCWVudW0gaTkxNV9jYWNoZV9sZXZlbCBsZXZlbDsK
KwlpbnQgcmV0ID0gMDsKKworCXN3aXRjaCAoYXJncy0+Y2FjaGluZykgeworCWNhc2UgSTkxNV9D
QUNISU5HX05PTkU6CisJCWxldmVsID0gSTkxNV9DQUNIRV9OT05FOworCQlicmVhazsKKwljYXNl
IEk5MTVfQ0FDSElOR19DQUNIRUQ6CisJCS8qCisJCSAqIER1ZSB0byBhIEhXIGlzc3VlIG9uIEJY
VCBBIHN0ZXBwaW5nLCBHUFUgc3RvcmVzIHZpYSBhCisJCSAqIHNub29wZWQgbWFwcGluZyBtYXkg
bGVhdmUgc3RhbGUgZGF0YSBpbiBhIGNvcnJlc3BvbmRpbmcgQ1BVCisJCSAqIGNhY2hlbGluZSwg
d2hlcmVhcyBub3JtYWxseSBzdWNoIGNhY2hlbGluZXMgd291bGQgZ2V0CisJCSAqIGludmFsaWRh
dGVkLgorCQkgKi8KKwkJaWYgKCFIQVNfTExDKGk5MTUpICYmICFIQVNfU05PT1AoaTkxNSkpCisJ
CQlyZXR1cm4gLUVOT0RFVjsKKworCQlsZXZlbCA9IEk5MTVfQ0FDSEVfTExDOworCQlicmVhazsK
KwljYXNlIEk5MTVfQ0FDSElOR19ESVNQTEFZOgorCQlsZXZlbCA9IEhBU19XVChpOTE1KSA/IEk5
MTVfQ0FDSEVfV1QgOiBJOTE1X0NBQ0hFX05PTkU7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJl
dHVybiAtRUlOVkFMOworCX0KKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXAoZmlsZSwg
YXJncy0+aGFuZGxlKTsKKwlpZiAoIW9iaikKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwkvKgorCSAq
IFRoZSBjYWNoaW5nIG1vZGUgb2YgcHJveHkgb2JqZWN0IGlzIGhhbmRsZWQgYnkgaXRzIGdlbmVy
YXRvciwgYW5kCisJICogbm90IGFsbG93ZWQgdG8gYmUgY2hhbmdlZCBieSB1c2Vyc3BhY2UuCisJ
ICovCisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19wcm94eShvYmopKSB7CisJCXJldCA9IC1FTlhJ
TzsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgPT0gbGV2ZWwpCisJ
CWdvdG8gb3V0OworCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLAorCQkJCSAgIEk5
MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAorCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKKwlp
ZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKGRldik7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBpOTE1X2dlbV9vYmpl
Y3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwgbGV2ZWwpOworCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1
Y3RfbXV0ZXgpOworCitvdXQ6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXJldHVybiBy
ZXQ7Cit9CisKKy8qCisgKiBQcmVwYXJlIGJ1ZmZlciBmb3IgZGlzcGxheSBwbGFuZSAoc2Nhbm91
dCwgY3Vyc29ycywgZXRjKS4gQ2FuIGJlIGNhbGxlZCBmcm9tCisgKiBhbiB1bmludGVycnVwdGli
bGUgcGhhc2UgKG1vZGVzZXR0aW5nKSBhbmQgYWxsb3dzIGFueSBmbHVzaGVzIHRvIGJlIHBpcGVs
aW5lZAorICogKGZvciBwYWdlZmxpcHMpLiBXZSBvbmx5IGZsdXNoIHRoZSBjYWNoZXMgd2hpbGUg
cHJlcGFyaW5nIHRoZSBidWZmZXIgZm9yCisgKiBkaXNwbGF5LCB0aGUgY2FsbGVycyBhcmUgcmVz
cG9uc2libGUgZm9yIGZyb250YnVmZmVyIGZsdXNoLgorICovCitzdHJ1Y3QgaTkxNV92bWEgKgor
aTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCisJCQkJICAgICB1MzIgYWxpZ25tZW50LAorCQkJCSAgICAgY29uc3Qgc3Ry
dWN0IGk5MTVfZ2d0dF92aWV3ICp2aWV3LAorCQkJCSAgICAgdW5zaWduZWQgaW50IGZsYWdzKQor
eworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWludCByZXQ7CisKKwlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCisJLyogTWFyayB0aGUgZ2xvYmFs
IHBpbiBlYXJseSBzbyB0aGF0IHdlIGFjY291bnQgZm9yIHRoZQorCSAqIGRpc3BsYXkgY29oZXJl
bmN5IHdoaWxzdCBzZXR0aW5nIHVwIHRoZSBjYWNoZSBkb21haW5zLgorCSAqLworCW9iai0+cGlu
X2dsb2JhbCsrOworCisJLyogVGhlIGRpc3BsYXkgZW5naW5lIGlzIG5vdCBjb2hlcmVudCB3aXRo
IHRoZSBMTEMgY2FjaGUgb24gZ2VuNi4gIEFzCisJICogYSByZXN1bHQsIHdlIG1ha2Ugc3VyZSB0
aGF0IHRoZSBwaW5uaW5nIHRoYXQgaXMgYWJvdXQgdG8gb2NjdXIgaXMKKwkgKiBkb25lIHdpdGgg
dW5jYWNoZWQgUFRFcy4gVGhpcyBpcyBsb3dlc3QgY29tbW9uIGRlbm9taW5hdG9yIGZvciBhbGwK
KwkgKiBjaGlwc2V0cy4KKwkgKgorCSAqIEhvd2V2ZXIgZm9yIGdlbjYrLCB3ZSBjb3VsZCBkbyBi
ZXR0ZXIgYnkgdXNpbmcgdGhlIEdGRFQgYml0IGluc3RlYWQKKwkgKiBvZiB1bmNhY2hpbmcsIHdo
aWNoIHdvdWxkIGFsbG93IHVzIHRvIGZsdXNoIGFsbCB0aGUgTExDLWNhY2hlZCBkYXRhCisJICog
d2l0aCB0aGF0IGJpdCBpbiB0aGUgUFRFIHRvIG1haW4gbWVtb3J5IHdpdGgganVzdCBvbmUgUElQ
RV9DT05UUk9MLgorCSAqLworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwo
b2JqLAorCQkJCQkgICAgICBIQVNfV1QodG9faTkxNShvYmotPmJhc2UuZGV2KSkgPworCQkJCQkg
ICAgICBJOTE1X0NBQ0hFX1dUIDogSTkxNV9DQUNIRV9OT05FKTsKKwlpZiAocmV0KSB7CisJCXZt
YSA9IEVSUl9QVFIocmV0KTsKKwkJZ290byBlcnJfdW5waW5fZ2xvYmFsOworCX0KKworCS8qIEFz
IHRoZSB1c2VyIG1heSBtYXAgdGhlIGJ1ZmZlciBvbmNlIHBpbm5lZCBpbiB0aGUgZGlzcGxheSBw
bGFuZQorCSAqIChlLmcuIGxpYmttcyBmb3IgdGhlIGJvb3R1cCBzcGxhc2gpLCB3ZSBoYXZlIHRv
IGVuc3VyZSB0aGF0IHdlCisJICogYWx3YXlzIHVzZSBtYXBfYW5kX2ZlbmNlYWJsZSBmb3IgYWxs
IHNjYW5vdXQgYnVmZmVycy4gSG93ZXZlciwKKwkgKiBpdCBtYXkgc2ltcGx5IGJlIHRvbyBiaWcg
dG8gZml0IGludG8gbWFwcGFibGUsIGluIHdoaWNoIGNhc2UKKwkgKiBwdXQgaXQgYW55d2F5IGFu
ZCBob3BlIHRoYXQgdXNlcnNwYWNlIGNhbiBjb3BlIChidXQgYWx3YXlzIGZpcnN0CisJICogdHJ5
IHRvIHByZXNlcnZlIHRoZSBleGlzdGluZyBBQkkpLgorCSAqLworCXZtYSA9IEVSUl9QVFIoLUVO
T1NQQyk7CisJaWYgKChmbGFncyAmIFBJTl9NQVBQQUJMRSkgPT0gMCAmJgorCSAgICAoIXZpZXcg
fHwgdmlldy0+dHlwZSA9PSBJOTE1X0dHVFRfVklFV19OT1JNQUwpKQorCQl2bWEgPSBpOTE1X2dl
bV9vYmplY3RfZ2d0dF9waW4ob2JqLCB2aWV3LCAwLCBhbGlnbm1lbnQsCisJCQkJCSAgICAgICBm
bGFncyB8CisJCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfAorCQkJCQkgICAgICAgUElOX05PTkJM
T0NLKTsKKwlpZiAoSVNfRVJSKHZtYSkpCisJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bp
bihvYmosIHZpZXcsIDAsIGFsaWdubWVudCwgZmxhZ3MpOworCWlmIChJU19FUlIodm1hKSkKKwkJ
Z290byBlcnJfdW5waW5fZ2xvYmFsOworCisJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IG1heF90
KHU2NCwgdm1hLT5kaXNwbGF5X2FsaWdubWVudCwgYWxpZ25tZW50KTsKKworCV9faTkxNV9nZW1f
b2JqZWN0X2ZsdXNoX2Zvcl9kaXNwbGF5KG9iaik7CisKKwkvKiBJdCBzaG91bGQgbm93IGJlIG91
dCBvZiBhbnkgb3RoZXIgd3JpdGUgZG9tYWlucywgYW5kIHdlIGNhbiB1cGRhdGUKKwkgKiB0aGUg
ZG9tYWluIHZhbHVlcyBmb3Igb3VyIGNoYW5nZXMuCisJICovCisJb2JqLT5yZWFkX2RvbWFpbnMg
fD0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKKworCXJldHVybiB2bWE7CisKK2Vycl91bnBpbl9nbG9i
YWw6CisJb2JqLT5waW5fZ2xvYmFsLS07CisJcmV0dXJuIHZtYTsKK30KKworc3RhdGljIHZvaWQg
aTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShv
YmotPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0OworCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOworCisJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFnZXMo
b2JqKSk7CisKKwltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKKwlmb3JfZWFjaF9n
Z3R0X3ZtYSh2bWEsIG9iaikgeworCQlpZiAoIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5u
b2RlKSkKKwkJCWNvbnRpbnVlOworCisJCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2
bWEtPnZtLT5ib3VuZF9saXN0KTsKKwl9CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11
dGV4KTsKKworCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCWxpc3QgPSBvYmotPmJp
bmRfY291bnQgPyAmaTkxNS0+bW0uYm91bmRfbGlzdCA6ICZpOTE1LT5tbS51bmJvdW5kX2xpc3Q7
CisJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgbGlzdCk7CisJc3Bpbl91bmxvY2soJmk5
MTUtPm1tLm9ial9sb2NrKTsKK30KKwordm9pZAoraTkxNV9nZW1fb2JqZWN0X3VucGluX2Zyb21f
ZGlzcGxheV9wbGFuZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKworCWlmIChXQVJOX09OKHZt
YS0+b2JqLT5waW5fZ2xvYmFsID09IDApKQorCQlyZXR1cm47CisKKwlpZiAoLS12bWEtPm9iai0+
cGluX2dsb2JhbCA9PSAwKQorCQl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gSTkxNV9HVFRfTUlO
X0FMSUdOTUVOVDsKKworCS8qIEJ1bXAgdGhlIExSVSB0byB0cnkgYW5kIGF2b2lkIHByZW1hdHVy
ZSBldmljdGlvbiB3aGlsc3QgZmxpcHBpbmcgICovCisJaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5h
Y3RpdmVfZ2d0dCh2bWEtPm9iaik7CisKKwlpOTE1X3ZtYV91bnBpbih2bWEpOworfQorCisvKioK
KyAqIE1vdmVzIGEgc2luZ2xlIG9iamVjdCB0byB0aGUgQ1BVIHJlYWQsIGFuZCBwb3NzaWJseSB3
cml0ZSBkb21haW4uCisgKiBAb2JqOiBvYmplY3QgdG8gYWN0IG9uCisgKiBAd3JpdGU6IHJlcXVl
c3Rpbmcgd3JpdGUgb3IgcmVhZC1vbmx5IGFjY2VzcworICoKKyAqIFRoaXMgZnVuY3Rpb24gcmV0
dXJucyB3aGVuIHRoZSBtb3ZlIGlzIGNvbXBsZXRlLCBpbmNsdWRpbmcgd2FpdGluZyBvbgorICog
Zmx1c2hlcyB0byBvY2N1ci4KKyAqLworaW50CitpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9k
b21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSkKK3sKKwlp
bnQgcmV0OworCisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211
dGV4KTsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKKwkJCQkgICBJOTE1X1dB
SVRfSU5URVJSVVBUSUJMRSB8CisJCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8CisJCQkJICAgKHdy
aXRlID8gSTkxNV9XQUlUX0FMTCA6IDApLAorCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRl
X2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKKworCS8qIEZsdXNoIHRoZSBDUFUg
Y2FjaGUgaWYgaXQncyBzdGlsbCBpbnZhbGlkLiAqLworCWlmICgob2JqLT5yZWFkX2RvbWFpbnMg
JiBJOTE1X0dFTV9ET01BSU5fQ1BVKSA9PSAwKSB7CisJCWk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0
KG9iaiwgSTkxNV9DTEZMVVNIX1NZTkMpOworCQlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dF
TV9ET01BSU5fQ1BVOworCX0KKworCS8qIEl0IHNob3VsZCBub3cgYmUgb3V0IG9mIGFueSBvdGhl
ciB3cml0ZSBkb21haW5zLCBhbmQgd2UgY2FuIHVwZGF0ZQorCSAqIHRoZSBkb21haW4gdmFsdWVz
IGZvciBvdXIgY2hhbmdlcy4KKwkgKi8KKwlHRU1fQlVHX09OKG9iai0+d3JpdGVfZG9tYWluICYg
fkk5MTVfR0VNX0RPTUFJTl9DUFUpOworCisJLyogSWYgd2UncmUgd3JpdGluZyB0aHJvdWdoIHRo
ZSBDUFUsIHRoZW4gdGhlIEdQVSByZWFkIGRvbWFpbnMgd2lsbAorCSAqIG5lZWQgdG8gYmUgaW52
YWxpZGF0ZWQgYXQgbmV4dCB1c2UuCisJICovCisJaWYgKHdyaXRlKQorCQlfX3N0YXJ0X2NwdV93
cml0ZShvYmopOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbmxpbmUgZW51bSBmYl9vcF9v
cmlnaW4KK2ZiX3dyaXRlX29yaWdpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1
bnNpZ25lZCBpbnQgZG9tYWluKQoreworCXJldHVybiAoZG9tYWluID09IEk5MTVfR0VNX0RPTUFJ
Tl9HVFQgPworCQlvYmotPmZyb250YnVmZmVyX2dndHRfb3JpZ2luIDogT1JJR0lOX0NQVSk7Cit9
CisKKy8qKgorICogQ2FsbGVkIHdoZW4gdXNlciBzcGFjZSBwcmVwYXJlcyB0byB1c2UgYW4gb2Jq
ZWN0IHdpdGggdGhlIENQVSwgZWl0aGVyCisgKiB0aHJvdWdoIHRoZSBtbWFwIGlvY3RsJ3MgbWFw
cGluZyBvciBhIEdUVCBtYXBwaW5nLgorICogQGRldjogZHJtIGRldmljZQorICogQGRhdGE6IGlv
Y3RsIGRhdGEgYmxvYgorICogQGZpbGU6IGRybSBmaWxlCisgKi8KK2ludAoraTkxNV9nZW1fc2V0
X2RvbWFpbl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAorCQkJICBz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9zZXRfZG9tYWlu
ICphcmdzID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXUzMiBy
ZWFkX2RvbWFpbnMgPSBhcmdzLT5yZWFkX2RvbWFpbnM7CisJdTMyIHdyaXRlX2RvbWFpbiA9IGFy
Z3MtPndyaXRlX2RvbWFpbjsKKwlpbnQgZXJyOworCisJLyogT25seSBoYW5kbGUgc2V0dGluZyBk
b21haW5zIHRvIHR5cGVzIHVzZWQgYnkgdGhlIENQVS4gKi8KKwlpZiAoKHdyaXRlX2RvbWFpbiB8
IHJlYWRfZG9tYWlucykgJiBJOTE1X0dFTV9HUFVfRE9NQUlOUykKKwkJcmV0dXJuIC1FSU5WQUw7
CisKKwkvKgorCSAqIEhhdmluZyBzb21ldGhpbmcgaW4gdGhlIHdyaXRlIGRvbWFpbiBpbXBsaWVz
IGl0J3MgaW4gdGhlIHJlYWQKKwkgKiBkb21haW4sIGFuZCBvbmx5IHRoYXQgcmVhZCBkb21haW4u
ICBFbmZvcmNlIHRoYXQgaW4gdGhlIHJlcXVlc3QuCisJICovCisJaWYgKHdyaXRlX2RvbWFpbiAm
JiByZWFkX2RvbWFpbnMgIT0gd3JpdGVfZG9tYWluKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlm
ICghcmVhZF9kb21haW5zKQorCQlyZXR1cm4gMDsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9s
b29rdXAoZmlsZSwgYXJncy0+aGFuZGxlKTsKKwlpZiAoIW9iaikKKwkJcmV0dXJuIC1FTk9FTlQ7
CisKKwkvKgorCSAqIEFscmVhZHkgaW4gdGhlIGRlc2lyZWQgd3JpdGUgZG9tYWluPyBOb3RoaW5n
IGZvciB1cyB0byBkbyEKKwkgKgorCSAqIFdlIGFwcGx5IGEgbGl0dGxlIGJpdCBvZiBjdW5uaW5n
IGhlcmUgdG8gY2F0Y2ggYSBicm9hZGVyIHNldCBvZgorCSAqIG5vLW9wcy4gSWYgb2JqLT53cml0
ZV9kb21haW4gaXMgc2V0LCB3ZSBtdXN0IGJlIGluIHRoZSBzYW1lCisJICogb2JqLT5yZWFkX2Rv
bWFpbnMsIGFuZCBvbmx5IHRoYXQgZG9tYWluLiBUaGVyZWZvcmUsIGlmIHRoYXQKKwkgKiBvYmot
PndyaXRlX2RvbWFpbiBtYXRjaGVzIHRoZSByZXF1ZXN0IHJlYWRfZG9tYWlucywgd2UgYXJlCisJ
ICogYWxyZWFkeSBpbiB0aGUgc2FtZSByZWFkL3dyaXRlIGRvbWFpbiBhbmQgY2FuIHNraXAgdGhl
IG9wZXJhdGlvbiwKKwkgKiB3aXRob3V0IGhhdmluZyB0byBmdXJ0aGVyIGNoZWNrIHRoZSByZXF1
ZXN0ZWQgd3JpdGVfZG9tYWluLgorCSAqLworCWlmIChSRUFEX09OQ0Uob2JqLT53cml0ZV9kb21h
aW4pID09IHJlYWRfZG9tYWlucykgeworCQllcnIgPSAwOworCQlnb3RvIG91dDsKKwl9CisKKwkv
KgorCSAqIFRyeSB0byBmbHVzaCB0aGUgb2JqZWN0IG9mZiB0aGUgR1BVIHdpdGhvdXQgaG9sZGlu
ZyB0aGUgbG9jay4KKwkgKiBXZSB3aWxsIHJlcGVhdCB0aGUgZmx1c2ggaG9sZGluZyB0aGUgbG9j
ayBpbiB0aGUgbm9ybWFsIG1hbm5lcgorCSAqIHRvIGNhdGNoIGNhc2VzIHdoZXJlIHdlIGFyZSBn
YXp1bXBlZC4KKwkgKi8KKwllcnIgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAg
STkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAorCQkJCSAgIEk5MTVfV0FJVF9QUklPUklUWSB8CisJ
CQkJICAgKHdyaXRlX2RvbWFpbiA/IEk5MTVfV0FJVF9BTEwgOiAwKSwKKwkJCQkgICBNQVhfU0NI
RURVTEVfVElNRU9VVCk7CisJaWYgKGVycikKKwkJZ290byBvdXQ7CisKKwkvKgorCSAqIFByb3h5
IG9iamVjdHMgZG8gbm90IGNvbnRyb2wgYWNjZXNzIHRvIHRoZSBiYWNraW5nIHN0b3JhZ2UsIGVy
Z28KKwkgKiB0aGV5IGNhbm5vdCBiZSB1c2VkIGFzIGEgbWVhbnMgdG8gbWFuaXB1bGF0ZSB0aGUg
Y2FjaGUgZG9tYWluCisJICogdHJhY2tpbmcgZm9yIHRoYXQgYmFja2luZyBzdG9yYWdlLiBUaGUg
cHJveHkgb2JqZWN0IGlzIGFsd2F5cworCSAqIGNvbnNpZGVyZWQgdG8gYmUgb3V0c2lkZSBvZiBh
bnkgY2FjaGUgZG9tYWluLgorCSAqLworCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfcHJveHkob2Jq
KSkgeworCQllcnIgPSAtRU5YSU87CisJCWdvdG8gb3V0OworCX0KKworCS8qCisJICogRmx1c2gg
YW5kIGFjcXVpcmUgb2JqLT5wYWdlcyBzbyB0aGF0IHdlIGFyZSBjb2hlcmVudCB0aHJvdWdoCisJ
ICogZGlyZWN0IGFjY2VzcyBpbiBtZW1vcnkgd2l0aCBwcmV2aW91cyBjYWNoZWQgd3JpdGVzIHRo
cm91Z2gKKwkgKiBzaG1lbWZzIGFuZCB0aGF0IG91ciBjYWNoZSBkb21haW4gdHJhY2tpbmcgcmVt
YWlucyB2YWxpZC4KKwkgKiBGb3IgZXhhbXBsZSwgaWYgdGhlIG9iai0+ZmlscCB3YXMgbW92ZWQg
dG8gc3dhcCB3aXRob3V0IHVzCisJICogYmVpbmcgbm90aWZpZWQgYW5kIHJlbGVhc2luZyB0aGUg
cGFnZXMsIHdlIHdvdWxkIG1pc3Rha2VubHkKKwkgKiBjb250aW51ZSB0byBhc3N1bWUgdGhhdCB0
aGUgb2JqIHJlbWFpbmVkIG91dCBvZiB0aGUgQ1BVIGNhY2hlZAorCSAqIGRvbWFpbi4KKwkgKi8K
KwllcnIgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKGVycikKKwkJZ290
byBvdXQ7CisKKwllcnIgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOworCWlm
IChlcnIpCisJCWdvdG8gb3V0X3VucGluOworCisJaWYgKHJlYWRfZG9tYWlucyAmIEk5MTVfR0VN
X0RPTUFJTl9XQykKKwkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4ob2Jq
LCB3cml0ZV9kb21haW4pOworCWVsc2UgaWYgKHJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJ
Tl9HVFQpCisJCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHdy
aXRlX2RvbWFpbik7CisJZWxzZQorCQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9k
b21haW4ob2JqLCB3cml0ZV9kb21haW4pOworCisJLyogQW5kIGJ1bXAgdGhlIExSVSBmb3IgdGhp
cyBhY2Nlc3MgKi8KKwlpOTE1X2dlbV9vYmplY3RfYnVtcF9pbmFjdGl2ZV9nZ3R0KG9iaik7CisK
KwltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKworCWlmICh3cml0ZV9kb21haW4g
IT0gMCkKKwkJaW50ZWxfZmJfb2JqX2ludmFsaWRhdGUob2JqLAorCQkJCQlmYl93cml0ZV9vcmln
aW4ob2JqLCB3cml0ZV9kb21haW4pKTsKKworb3V0X3VucGluOgorCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyhvYmopOworb3V0OgorCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1
cm4gZXJyOworfQorCisvKgorICogUGlucyB0aGUgc3BlY2lmaWVkIG9iamVjdCdzIHBhZ2VzIGFu
ZCBzeW5jaHJvbml6ZXMgdGhlIG9iamVjdCB3aXRoCisgKiBHUFUgYWNjZXNzZXMuIFNldHMgbmVl
ZHNfY2xmbHVzaCB0byBub24temVybyBpZiB0aGUgY2FsbGVyIHNob3VsZAorICogZmx1c2ggdGhl
IG9iamVjdCBmcm9tIHRoZSBDUFUgY2FjaGUuCisgKi8KK2ludCBpOTE1X2dlbV9vYmplY3RfcHJl
cGFyZV9yZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkJIHVuc2lnbmVk
IGludCAqbmVlZHNfY2xmbHVzaCkKK3sKKwlpbnQgcmV0OworCisJbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKKworCSpuZWVkc19jbGZsdXNoID0gMDsK
KwlpZiAoIWk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSkKKwkJcmV0dXJuIC1F
Tk9ERVY7CisKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAgSTkxNV9X
QUlUX0lOVEVSUlVQVElCTEUgfAorCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQsCisJCQkJICAgTUFY
X1NDSEVEVUxFX1RJTUVPVVQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBp
OTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsK
KworCWlmIChvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1Jf
UkVBRCB8fAorCSAgICAhc3RhdGljX2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKKwkJ
cmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19jcHVfZG9tYWluKG9iaiwgZmFsc2UpOworCQlp
ZiAocmV0KQorCQkJZ290byBlcnJfdW5waW47CisJCWVsc2UKKwkJCWdvdG8gb3V0OworCX0KKwor
CWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlO
X0NQVSk7CisKKwkvKiBJZiB3ZSdyZSBub3QgaW4gdGhlIGNwdSByZWFkIGRvbWFpbiwgc2V0IG91
cnNlbGYgaW50byB0aGUgZ3R0CisJICogcmVhZCBkb21haW4gYW5kIG1hbnVhbGx5IGZsdXNoIGNh
Y2hlbGluZXMgKGlmIHJlcXVpcmVkKS4gVGhpcworCSAqIG9wdGltaXplcyBmb3IgdGhlIGNhc2Ug
d2hlbiB0aGUgZ3B1IHdpbGwgZGlydHkgdGhlIGRhdGEKKwkgKiBhbnl3YXkgYWdhaW4gYmVmb3Jl
IHRoZSBuZXh0IHByZWFkIGhhcHBlbnMuCisJICovCisJaWYgKCFvYmotPmNhY2hlX2RpcnR5ICYm
CisJICAgICEob2JqLT5yZWFkX2RvbWFpbnMgJiBJOTE1X0dFTV9ET01BSU5fQ1BVKSkKKwkJKm5l
ZWRzX2NsZmx1c2ggPSBDTEZMVVNIX0JFRk9SRTsKKworb3V0OgorCS8qIHJldHVybiB3aXRoIHRo
ZSBwYWdlcyBwaW5uZWQgKi8KKwlyZXR1cm4gMDsKKworZXJyX3VucGluOgorCWk5MTVfZ2VtX29i
amVjdF91bnBpbl9wYWdlcyhvYmopOworCXJldHVybiByZXQ7Cit9CisKK2ludCBpOTE1X2dlbV9v
YmplY3RfcHJlcGFyZV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJ
CSAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKQoreworCWludCByZXQ7CisKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCisJKm5lZWRzX2Ns
Zmx1c2ggPSAwOworCWlmICghaTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFnZShvYmopKQor
CQlyZXR1cm4gLUVOT0RFVjsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKKwkJ
CQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8CisJCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8
CisJCQkJICAgSTkxNV9XQUlUX0FMTCwKKwkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFn
ZXMob2JqKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJaWYgKG9iai0+Y2FjaGVfY29o
ZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSB8fAorCSAgICAhc3RhdGlj
X2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKKwkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b19jcHVfZG9tYWluKG9iaiwgdHJ1ZSk7CisJCWlmIChyZXQpCisJCQlnb3RvIGVycl91
bnBpbjsKKwkJZWxzZQorCQkJZ290byBvdXQ7CisJfQorCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKKworCS8qIElmIHdlJ3Jl
IG5vdCBpbiB0aGUgY3B1IHdyaXRlIGRvbWFpbiwgc2V0IG91cnNlbGYgaW50byB0aGUKKwkgKiBn
dHQgd3JpdGUgZG9tYWluIGFuZCBtYW51YWxseSBmbHVzaCBjYWNoZWxpbmVzIChhcyByZXF1aXJl
ZCkuCisJICogVGhpcyBvcHRpbWl6ZXMgZm9yIHRoZSBjYXNlIHdoZW4gdGhlIGdwdSB3aWxsIHVz
ZSB0aGUgZGF0YQorCSAqIHJpZ2h0IGF3YXkgYW5kIHdlIHRoZXJlZm9yZSBoYXZlIHRvIGNsZmx1
c2ggYW55d2F5LgorCSAqLworCWlmICghb2JqLT5jYWNoZV9kaXJ0eSkgeworCQkqbmVlZHNfY2xm
bHVzaCB8PSBDTEZMVVNIX0FGVEVSOworCisJCS8qCisJCSAqIFNhbWUgdHJpY2sgYXBwbGllcyB0
byBpbnZhbGlkYXRlIHBhcnRpYWxseSB3cml0dGVuCisJCSAqIGNhY2hlbGluZXMgcmVhZCBiZWZv
cmUgd3JpdGluZy4KKwkJICovCisJCWlmICghKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1f
RE9NQUlOX0NQVSkpCisJCQkqbmVlZHNfY2xmbHVzaCB8PSBDTEZMVVNIX0JFRk9SRTsKKwl9CisK
K291dDoKKwlpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9DUFUpOworCW9iai0+
bW0uZGlydHkgPSB0cnVlOworCS8qIHJldHVybiB3aXRoIHRoZSBwYWdlcyBwaW5uZWQgKi8KKwly
ZXR1cm4gMDsKKworZXJyX3VucGluOgorCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
OworCXJldHVybiByZXQ7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0LmgKaW5kZXggMDdmNDg3Y2JmZjc5Li44Y2YwODJhYmIwYWIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTE1LDYgKzE1LDggQEAKIAogI2luY2x1
ZGUgImk5MTVfZ2VtX29iamVjdF90eXBlcy5oIgogCisjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0Lmgi
CisKIHZvaWQgaTkxNV9nZW1faW5pdF9fb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSk7CiAKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICppOTE1X2dlbV9vYmplY3RfYWxs
b2Modm9pZCk7CkBAIC0zNTgsNiArMzYwLDIwIEBAIHZvaWQKIGk5MTVfZ2VtX29iamVjdF9mbHVz
aF93cml0ZV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCQkgICB1
bnNpZ25lZCBpbnQgZmx1c2hfZG9tYWlucyk7CiAKK2ludCBpOTE1X2dlbV9vYmplY3RfcHJlcGFy
ZV9yZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkJIHVuc2lnbmVkIGlu
dCAqbmVlZHNfY2xmbHVzaCk7CitpbnQgaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgIHVuc2lnbmVkIGludCAqbmVlZHNf
Y2xmbHVzaCk7CisjZGVmaW5lIENMRkxVU0hfQkVGT1JFCUJJVCgwKQorI2RlZmluZSBDTEZMVVNI
X0FGVEVSCUJJVCgxKQorI2RlZmluZSBDTEZMVVNIX0ZMQUdTCShDTEZMVVNIX0JFRk9SRSB8IENM
RkxVU0hfQUZURVIpCisKK3N0YXRpYyBpbmxpbmUgdm9pZAoraTkxNV9nZW1fb2JqZWN0X2Zpbmlz
aF9hY2Nlc3Moc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlpOTE1X2dlbV9v
YmplY3RfdW5waW5fcGFnZXMob2JqKTsKK30KKwogc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICoKIGk5MTVfZ2VtX29iamVjdF9sYXN0X3dyaXRlX2VuZ2luZShzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewpAQCAtMzc5LDYgKzM5NSwxOSBAQCB2b2lkIGk5MTVf
Z2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCQkJCSB1bnNpZ25lZCBpbnQgY2FjaGVfbGV2ZWwpOwogdm9pZCBpOTE1X2dlbV9v
YmplY3RfZmx1c2hfaWZfZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsK
IAoraW50IF9fbXVzdF9jaGVjaworaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4oc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7CitpbnQgX19tdXN0X2No
ZWNrCitpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4oc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7CitpbnQgX19tdXN0X2NoZWNrCitpOTE1X2dlbV9v
YmplY3Rfc2V0X3RvX2NwdV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwg
Ym9vbCB3cml0ZSk7CitzdHJ1Y3QgaTkxNV92bWEgKiBfX211c3RfY2hlY2sKK2k5MTVfZ2VtX29i
amVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAorCQkJCSAgICAgdTMyIGFsaWdubWVudCwKKwkJCQkgICAgIGNvbnN0IHN0cnVjdCBpOTE1X2dn
dHRfdmlldyAqdmlldywKKwkJCQkgICAgIHVuc2lnbmVkIGludCBmbGFncyk7Cit2b2lkIGk5MTVf
Z2VtX29iamVjdF91bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGk5MTVfdm1hICp2bWEp
OworCiBzdGF0aWMgaW5saW5lIGJvb2wgY3B1X3dyaXRlX25lZWRzX2NsZmx1c2goc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlpZiAob2JqLT5jYWNoZV9kaXJ0eSkKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCmluZGV4IDc1ODRiZjBhZWFhNC4uZTM2MDhiMTcw
MTA1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMKQEAgLTE3NjQsNyArMTc2
NCw3IEBAIHN0YXRpYyBpbnQgcGVyZm9ybV9iYl9zaGFkb3coc3RydWN0IHBhcnNlcl9leGVjX3N0
YXRlICpzKQogCQlnb3RvIGVycl9mcmVlX2JiOwogCX0KIAotCXJldCA9IGk5MTVfZ2VtX29ial9w
cmVwYXJlX3NobWVtX3dyaXRlKGJiLT5vYmosICZiYi0+Y2xmbHVzaCk7CisJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoYmItPm9iaiwgJmJiLT5jbGZsdXNoKTsKIAlpZiAocmV0
KQogCQlnb3RvIGVycl9mcmVlX29iajsKIApAQCAtMTgxMyw3ICsxODEzLDcgQEAgc3RhdGljIGlu
dCBwZXJmb3JtX2JiX3NoYWRvdyhzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpCiBlcnJfdW5t
YXA6CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChiYi0+b2JqKTsKIGVycl9maW5pc2hfc2ht
ZW1fYWNjZXNzOgotCWk5MTVfZ2VtX29ial9maW5pc2hfc2htZW1fYWNjZXNzKGJiLT5vYmopOwor
CWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKGJiLT5vYmopOwogZXJyX2ZyZWVfb2JqOgog
CWk5MTVfZ2VtX29iamVjdF9wdXQoYmItPm9iaik7CiBlcnJfZnJlZV9iYjoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9zY2hlZHVsZXIuYwppbmRleCAzODg5N2QyNDFmNWYuLjNhNjkxNDQ3Zjc2YyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAtNDgyLDcgKzQ4Miw3IEBAIHN0YXRp
YyBpbnQgcHJlcGFyZV9zaGFkb3dfYmF0Y2hfYnVmZmVyKHN0cnVjdCBpbnRlbF92Z3B1X3dvcmts
b2FkICp3b3JrbG9hZCkKIAkJCQkJCWJiLT5vYmotPmJhc2Uuc2l6ZSk7CiAJCQkJYmItPmNsZmx1
c2ggJj0gfkNMRkxVU0hfQUZURVI7CiAJCQl9Ci0JCQlpOTE1X2dlbV9vYmpfZmluaXNoX3NobWVt
X2FjY2VzcyhiYi0+b2JqKTsKKwkJCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKGJiLT5v
YmopOwogCQkJYmItPmFjY2Vzc2luZyA9IGZhbHNlOwogCiAJCX0gZWxzZSB7CkBAIC01MTAsNyAr
NTEwLDcgQEAgc3RhdGljIGludCBwcmVwYXJlX3NoYWRvd19iYXRjaF9idWZmZXIoc3RydWN0IGlu
dGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogCQkJaWYgKHJldCkKIAkJCQlnb3RvIGVycjsK
IAotCQkJaTkxNV9nZW1fb2JqX2ZpbmlzaF9zaG1lbV9hY2Nlc3MoYmItPm9iaik7CisJCQlpOTE1
X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhiYi0+b2JqKTsKIAkJCWJiLT5hY2Nlc3NpbmcgPSBm
YWxzZTsKIAogCQkJcmV0ID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUoYmItPnZtYSwKQEAgLTU4
OCw3ICs1ODgsNyBAQCBzdGF0aWMgdm9pZCByZWxlYXNlX3NoYWRvd19iYXRjaF9idWZmZXIoc3Ry
dWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogCWxpc3RfZm9yX2VhY2hfZW50cnlf
c2FmZShiYiwgcG9zLCAmd29ya2xvYWQtPnNoYWRvd19iYiwgbGlzdCkgewogCQlpZiAoYmItPm9i
aikgewogCQkJaWYgKGJiLT5hY2Nlc3NpbmcpCi0JCQkJaTkxNV9nZW1fb2JqX2ZpbmlzaF9zaG1l
bV9hY2Nlc3MoYmItPm9iaik7CisJCQkJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3MoYmIt
Pm9iaik7CiAKIAkJCWlmIChiYi0+dmEgJiYgIUlTX0VSUihiYi0+dmEpKQogCQkJCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9tYXAoYmItPm9iaik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2NtZF9wYXJzZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfY21kX3Bh
cnNlci5jCmluZGV4IGU5ZmFkY2I0ZDU5Mi4uYzg5M2JkNGViMmM4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2NtZF9wYXJzZXIuYwpAQCAtMTA1OCwxMSArMTA1OCwxMSBAQCBzdGF0aWMgdTMy
ICpjb3B5X2JhdGNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpkc3Rfb2JqLAogCXZvaWQg
KmRzdCwgKnNyYzsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2ht
ZW1fcmVhZChzcmNfb2JqLCAmc3JjX25lZWRzX2NsZmx1c2gpOworCXJldCA9IGk5MTVfZ2VtX29i
amVjdF9wcmVwYXJlX3JlYWQoc3JjX29iaiwgJnNyY19uZWVkc19jbGZsdXNoKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVf
c2htZW1fd3JpdGUoZHN0X29iaiwgJmRzdF9uZWVkc19jbGZsdXNoKTsKKwlyZXQgPSBpOTE1X2dl
bV9vYmplY3RfcHJlcGFyZV93cml0ZShkc3Rfb2JqLCAmZHN0X25lZWRzX2NsZmx1c2gpOwogCWlm
IChyZXQpIHsKIAkJZHN0ID0gRVJSX1BUUihyZXQpOwogCQlnb3RvIHVucGluX3NyYzsKQEAgLTEx
MjAsOSArMTEyMCw5IEBAIHN0YXRpYyB1MzIgKmNvcHlfYmF0Y2goc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKmRzdF9vYmosCiAJKm5lZWRzX2NsZmx1c2hfYWZ0ZXIgPSBkc3RfbmVlZHNfY2xm
bHVzaCAmIENMRkxVU0hfQUZURVI7CiAKIHVucGluX2RzdDoKLQlpOTE1X2dlbV9vYmpfZmluaXNo
X3NobWVtX2FjY2Vzcyhkc3Rfb2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2Vzcyhk
c3Rfb2JqKTsKIHVucGluX3NyYzoKLQlpOTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2Vzcyhz
cmNfb2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhzcmNfb2JqKTsKIAlyZXR1
cm4gZHN0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCBjNWIyZTM5YTg4YTQuLjkx
Njg5YTIzZDllNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0yODAzLDIwICsyODAzLDYg
QEAgc3RhdGljIGlubGluZSBpbnQgX19zZ19wYWdlX2NvdW50KGNvbnN0IHN0cnVjdCBzY2F0dGVy
bGlzdCAqc2cpCiAJcmV0dXJuIHNnLT5sZW5ndGggPj4gUEFHRV9TSElGVDsKIH0KIAotaW50IGk5
MTVfZ2VtX29ial9wcmVwYXJlX3NobWVtX3JlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKLQkJCQkgICAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKTsKLWludCBpOTE1X2dl
bV9vYmpfcHJlcGFyZV9zaG1lbV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAotCQkJCSAgICAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKTsKLSNkZWZpbmUgQ0xGTFVT
SF9CRUZPUkUJQklUKDApCi0jZGVmaW5lIENMRkxVU0hfQUZURVIJQklUKDEpCi0jZGVmaW5lIENM
RkxVU0hfRkxBR1MJKENMRkxVU0hfQkVGT1JFIHwgQ0xGTFVTSF9BRlRFUikKLQotc3RhdGljIGlu
bGluZSB2b2lkCi1pOTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2VzcyhzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqKQotewotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
OwotfQotCiBzdGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKIGk5MTVfbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7CkBAIC0yODc5LDE4ICsyODY1
LDYgQEAgaW50IGk5MTVfZ2VtX29iamVjdF93YWl0X3ByaW9yaXR5KHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCQkJICBjb25zdCBzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyICphdHRy
KTsKICNkZWZpbmUgSTkxNV9QUklPUklUWV9ESVNQTEFZIEk5MTVfVVNFUl9QUklPUklUWShJOTE1
X1BSSU9SSVRZX01BWCkKIAotaW50IF9fbXVzdF9jaGVjawotaTkxNV9nZW1fb2JqZWN0X3NldF90
b193Y19kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7
Ci1pbnQgX19tdXN0X2NoZWNrCi1pOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4oc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7Ci1pbnQgX19tdXN0X2No
ZWNrCi1pOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7Ci1zdHJ1Y3QgaTkxNV92bWEgKiBfX211c3RfY2hl
Y2sKLWk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAotCQkJCSAgICAgdTMyIGFsaWdubWVudCwKLQkJCQkgICAgIGNvbnN0
IHN0cnVjdCBpOTE1X2dndHRfdmlldyAqdmlldywKLQkJCQkgICAgIHVuc2lnbmVkIGludCBmbGFn
cyk7Ci12b2lkIGk5MTVfZ2VtX29iamVjdF91bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0
IGk5MTVfdm1hICp2bWEpOwogaW50IGk5MTVfZ2VtX29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CiB2b2lkIGk5MTVfZ2VtX3JlbGVhc2Uo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9maWxlICpmaWxlKTsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMKaW5kZXggMmVkM2RhZGZjYzE2Li45MmU1NTVlMWMxYmEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwpAQCAtNDYyLDEyMyArNDYyLDYgQEAgdm9pZCBpOTE1X2dlbV9mbHVz
aF9nZ3R0X3dyaXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQog
Ci0vKgotICogUGlucyB0aGUgc3BlY2lmaWVkIG9iamVjdCdzIHBhZ2VzIGFuZCBzeW5jaHJvbml6
ZXMgdGhlIG9iamVjdCB3aXRoCi0gKiBHUFUgYWNjZXNzZXMuIFNldHMgbmVlZHNfY2xmbHVzaCB0
byBub24temVybyBpZiB0aGUgY2FsbGVyIHNob3VsZAotICogZmx1c2ggdGhlIG9iamVjdCBmcm9t
IHRoZSBDUFUgY2FjaGUuCi0gKi8KLWludCBpOTE1X2dlbV9vYmpfcHJlcGFyZV9zaG1lbV9yZWFk
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJICAgIHVuc2lnbmVkIGludCAq
bmVlZHNfY2xmbHVzaCkKLXsKLQlpbnQgcmV0OwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2Jq
LT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQotCSpuZWVkc19jbGZsdXNoID0gMDsKLQlpZiAo
IWk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSkKLQkJcmV0dXJuIC1FTk9ERVY7
Ci0KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCi0JCQkJICAgSTkxNV9XQUlUX0lO
VEVSUlVQVElCTEUgfAotCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJICAgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBpOTE1X2dl
bV9vYmplY3RfcGluX3BhZ2VzKG9iaik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWlm
IChvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfUkVBRCB8
fAotCSAgICAhc3RhdGljX2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKLQkJcmV0ID0g
aTkxNV9nZW1fb2JqZWN0X3NldF90b19jcHVfZG9tYWluKG9iaiwgZmFsc2UpOwotCQlpZiAocmV0
KQotCQkJZ290byBlcnJfdW5waW47Ci0JCWVsc2UKLQkJCWdvdG8gb3V0OwotCX0KLQotCWk5MTVf
Z2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7
Ci0KLQkvKiBJZiB3ZSdyZSBub3QgaW4gdGhlIGNwdSByZWFkIGRvbWFpbiwgc2V0IG91cnNlbGYg
aW50byB0aGUgZ3R0Ci0JICogcmVhZCBkb21haW4gYW5kIG1hbnVhbGx5IGZsdXNoIGNhY2hlbGlu
ZXMgKGlmIHJlcXVpcmVkKS4gVGhpcwotCSAqIG9wdGltaXplcyBmb3IgdGhlIGNhc2Ugd2hlbiB0
aGUgZ3B1IHdpbGwgZGlydHkgdGhlIGRhdGEKLQkgKiBhbnl3YXkgYWdhaW4gYmVmb3JlIHRoZSBu
ZXh0IHByZWFkIGhhcHBlbnMuCi0JICovCi0JaWYgKCFvYmotPmNhY2hlX2RpcnR5ICYmCi0JICAg
ICEob2JqLT5yZWFkX2RvbWFpbnMgJiBJOTE1X0dFTV9ET01BSU5fQ1BVKSkKLQkJKm5lZWRzX2Ns
Zmx1c2ggPSBDTEZMVVNIX0JFRk9SRTsKLQotb3V0OgotCS8qIHJldHVybiB3aXRoIHRoZSBwYWdl
cyBwaW5uZWQgKi8KLQlyZXR1cm4gMDsKLQotZXJyX3VucGluOgotCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyhvYmopOwotCXJldHVybiByZXQ7Ci19Ci0KLWludCBpOTE1X2dlbV9vYmpfcHJl
cGFyZV9zaG1lbV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCSAg
ICAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKQotewotCWludCByZXQ7Ci0KLQlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCi0JKm5lZWRzX2Ns
Zmx1c2ggPSAwOwotCWlmICghaTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFnZShvYmopKQot
CQlyZXR1cm4gLUVOT0RFVjsKLQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKLQkJ
CQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8
Ci0JCQkJICAgSTkxNV9XQUlUX0FMTCwKLQkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFn
ZXMob2JqKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKG9iai0+Y2FjaGVfY29o
ZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSB8fAotCSAgICAhc3RhdGlj
X2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKLQkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b19jcHVfZG9tYWluKG9iaiwgdHJ1ZSk7Ci0JCWlmIChyZXQpCi0JCQlnb3RvIGVycl91
bnBpbjsKLQkJZWxzZQotCQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKLQotCS8qIElmIHdlJ3Jl
IG5vdCBpbiB0aGUgY3B1IHdyaXRlIGRvbWFpbiwgc2V0IG91cnNlbGYgaW50byB0aGUKLQkgKiBn
dHQgd3JpdGUgZG9tYWluIGFuZCBtYW51YWxseSBmbHVzaCBjYWNoZWxpbmVzIChhcyByZXF1aXJl
ZCkuCi0JICogVGhpcyBvcHRpbWl6ZXMgZm9yIHRoZSBjYXNlIHdoZW4gdGhlIGdwdSB3aWxsIHVz
ZSB0aGUgZGF0YQotCSAqIHJpZ2h0IGF3YXkgYW5kIHdlIHRoZXJlZm9yZSBoYXZlIHRvIGNsZmx1
c2ggYW55d2F5LgotCSAqLwotCWlmICghb2JqLT5jYWNoZV9kaXJ0eSkgewotCQkqbmVlZHNfY2xm
bHVzaCB8PSBDTEZMVVNIX0FGVEVSOwotCi0JCS8qCi0JCSAqIFNhbWUgdHJpY2sgYXBwbGllcyB0
byBpbnZhbGlkYXRlIHBhcnRpYWxseSB3cml0dGVuCi0JCSAqIGNhY2hlbGluZXMgcmVhZCBiZWZv
cmUgd3JpdGluZy4KLQkJICovCi0JCWlmICghKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1f
RE9NQUlOX0NQVSkpCi0JCQkqbmVlZHNfY2xmbHVzaCB8PSBDTEZMVVNIX0JFRk9SRTsKLQl9Ci0K
LW91dDoKLQlpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9DUFUpOwotCW9iai0+
bW0uZGlydHkgPSB0cnVlOwotCS8qIHJldHVybiB3aXRoIHRoZSBwYWdlcyBwaW5uZWQgKi8KLQly
ZXR1cm4gMDsKLQotZXJyX3VucGluOgotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
OwotCXJldHVybiByZXQ7Ci19Ci0KIHN0YXRpYyBpbnQKIHNobWVtX3ByZWFkKHN0cnVjdCBwYWdl
ICpwYWdlLCBpbnQgb2Zmc2V0LCBpbnQgbGVuLCBjaGFyIF9fdXNlciAqdXNlcl9kYXRhLAogCSAg
ICBib29sIG5lZWRzX2NsZmx1c2gpCkBAIC02MTIsNyArNDk1LDcgQEAgaTkxNV9nZW1fc2htZW1f
cHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2htZW1fcmVhZChvYmosICZu
ZWVkc19jbGZsdXNoKTsKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV9yZWFkKG9iaiwg
Jm5lZWRzX2NsZmx1c2gpOwogCW11dGV4X3VubG9jaygmb2JqLT5iYXNlLmRldi0+c3RydWN0X211
dGV4KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAtNjM0LDcgKzUxNyw3IEBAIGk5MTVf
Z2VtX3NobWVtX3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCW9mZnNl
dCA9IDA7CiAJfQogCi0JaTkxNV9nZW1fb2JqX2ZpbmlzaF9zaG1lbV9hY2Nlc3Mob2JqKTsKKwlp
OTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhvYmopOwogCXJldHVybiByZXQ7CiB9CiAKQEAg
LTEwMDksNyArODkyLDcgQEAgaTkxNV9nZW1fc2htZW1fcHdyaXRlKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9IGk5MTVf
Z2VtX29ial9wcmVwYXJlX3NobWVtX3dyaXRlKG9iaiwgJm5lZWRzX2NsZmx1c2gpOworCXJldCA9
IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dyaXRlKG9iaiwgJm5lZWRzX2NsZmx1c2gpOwogCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKHJldCkKIAkJcmV0dXJu
IHJldDsKQEAgLTEwNDEsNyArOTI0LDcgQEAgaTkxNV9nZW1fc2htZW1fcHdyaXRlKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfQogCiAJaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwg
T1JJR0lOX0NQVSk7Ci0JaTkxNV9nZW1fb2JqX2ZpbmlzaF9zaG1lbV9hY2Nlc3Mob2JqKTsKKwlp
OTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhvYmopOwogCXJldHVybiByZXQ7CiB9CiAKQEAg
LTExMzAsMTUwICsxMDEzLDYgQEAgaTkxNV9nZW1fcHdyaXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgaTkx
NV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmot
PmJhc2UuZGV2KTsKLQlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0OwotCXN0cnVjdCBpOTE1X3ZtYSAq
dm1hOwotCi0JR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFnZXMob2Jq
KSk7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKLQlmb3JfZWFjaF9nZ3R0
X3ZtYSh2bWEsIG9iaikgewotCQlpZiAoIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2Rl
KSkKLQkJCWNvbnRpbnVlOwotCi0JCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEt
PnZtLT5ib3VuZF9saXN0KTsKLQl9Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4
KTsKLQotCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwotCWxpc3QgPSBvYmotPmJpbmRf
Y291bnQgPyAmaTkxNS0+bW0uYm91bmRfbGlzdCA6ICZpOTE1LT5tbS51bmJvdW5kX2xpc3Q7Ci0J
bGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgbGlzdCk7Ci0Jc3Bpbl91bmxvY2soJmk5MTUt
Pm1tLm9ial9sb2NrKTsKLX0KLQotc3RhdGljIGlubGluZSBlbnVtIGZiX29wX29yaWdpbgotZmJf
d3JpdGVfb3JpZ2luKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHVuc2lnbmVkIGlu
dCBkb21haW4pCi17Ci0JcmV0dXJuIChkb21haW4gPT0gSTkxNV9HRU1fRE9NQUlOX0dUVCA/Ci0J
CW9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4gOiBPUklHSU5fQ1BVKTsKLX0KLQotLyoqCi0g
KiBDYWxsZWQgd2hlbiB1c2VyIHNwYWNlIHByZXBhcmVzIHRvIHVzZSBhbiBvYmplY3Qgd2l0aCB0
aGUgQ1BVLCBlaXRoZXIKLSAqIHRocm91Z2ggdGhlIG1tYXAgaW9jdGwncyBtYXBwaW5nIG9yIGEg
R1RUIG1hcHBpbmcuCi0gKiBAZGV2OiBkcm0gZGV2aWNlCi0gKiBAZGF0YTogaW9jdGwgZGF0YSBi
bG9iCi0gKiBAZmlsZTogZHJtIGZpbGUKLSAqLwotaW50Ci1pOTE1X2dlbV9zZXRfZG9tYWluX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCi0JCQkgIHN0cnVjdCBkcm1f
ZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3NldF9kb21haW4gKmFyZ3MgPSBk
YXRhOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0JdTMyIHJlYWRfZG9tYWlu
cyA9IGFyZ3MtPnJlYWRfZG9tYWluczsKLQl1MzIgd3JpdGVfZG9tYWluID0gYXJncy0+d3JpdGVf
ZG9tYWluOwotCWludCBlcnI7Ci0KLQkvKiBPbmx5IGhhbmRsZSBzZXR0aW5nIGRvbWFpbnMgdG8g
dHlwZXMgdXNlZCBieSB0aGUgQ1BVLiAqLwotCWlmICgod3JpdGVfZG9tYWluIHwgcmVhZF9kb21h
aW5zKSAmIEk5MTVfR0VNX0dQVV9ET01BSU5TKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCS8qCi0J
ICogSGF2aW5nIHNvbWV0aGluZyBpbiB0aGUgd3JpdGUgZG9tYWluIGltcGxpZXMgaXQncyBpbiB0
aGUgcmVhZAotCSAqIGRvbWFpbiwgYW5kIG9ubHkgdGhhdCByZWFkIGRvbWFpbi4gIEVuZm9yY2Ug
dGhhdCBpbiB0aGUgcmVxdWVzdC4KLQkgKi8KLQlpZiAod3JpdGVfZG9tYWluICYmIHJlYWRfZG9t
YWlucyAhPSB3cml0ZV9kb21haW4pCi0JCXJldHVybiAtRUlOVkFMOwotCi0JaWYgKCFyZWFkX2Rv
bWFpbnMpCi0JCXJldHVybiAwOwotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2xvb2t1cChmaWxl
LCBhcmdzLT5oYW5kbGUpOwotCWlmICghb2JqKQotCQlyZXR1cm4gLUVOT0VOVDsKLQotCS8qCi0J
ICogQWxyZWFkeSBpbiB0aGUgZGVzaXJlZCB3cml0ZSBkb21haW4/IE5vdGhpbmcgZm9yIHVzIHRv
IGRvIQotCSAqCi0JICogV2UgYXBwbHkgYSBsaXR0bGUgYml0IG9mIGN1bm5pbmcgaGVyZSB0byBj
YXRjaCBhIGJyb2FkZXIgc2V0IG9mCi0JICogbm8tb3BzLiBJZiBvYmotPndyaXRlX2RvbWFpbiBp
cyBzZXQsIHdlIG11c3QgYmUgaW4gdGhlIHNhbWUKLQkgKiBvYmotPnJlYWRfZG9tYWlucywgYW5k
IG9ubHkgdGhhdCBkb21haW4uIFRoZXJlZm9yZSwgaWYgdGhhdAotCSAqIG9iai0+d3JpdGVfZG9t
YWluIG1hdGNoZXMgdGhlIHJlcXVlc3QgcmVhZF9kb21haW5zLCB3ZSBhcmUKLQkgKiBhbHJlYWR5
IGluIHRoZSBzYW1lIHJlYWQvd3JpdGUgZG9tYWluIGFuZCBjYW4gc2tpcCB0aGUgb3BlcmF0aW9u
LAotCSAqIHdpdGhvdXQgaGF2aW5nIHRvIGZ1cnRoZXIgY2hlY2sgdGhlIHJlcXVlc3RlZCB3cml0
ZV9kb21haW4uCi0JICovCi0JaWYgKFJFQURfT05DRShvYmotPndyaXRlX2RvbWFpbikgPT0gcmVh
ZF9kb21haW5zKSB7Ci0JCWVyciA9IDA7Ci0JCWdvdG8gb3V0OwotCX0KLQotCS8qCi0JICogVHJ5
IHRvIGZsdXNoIHRoZSBvYmplY3Qgb2ZmIHRoZSBHUFUgd2l0aG91dCBob2xkaW5nIHRoZSBsb2Nr
LgotCSAqIFdlIHdpbGwgcmVwZWF0IHRoZSBmbHVzaCBob2xkaW5nIHRoZSBsb2NrIGluIHRoZSBu
b3JtYWwgbWFubmVyCi0JICogdG8gY2F0Y2ggY2FzZXMgd2hlcmUgd2UgYXJlIGdhenVtcGVkLgot
CSAqLwotCWVyciA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKLQkJCQkgICBJOTE1X1dBSVRf
SU5URVJSVVBUSUJMRSB8Ci0JCQkJICAgSTkxNV9XQUlUX1BSSU9SSVRZIHwKLQkJCQkgICAod3Jp
dGVfZG9tYWluID8gSTkxNV9XQUlUX0FMTCA6IDApLAotCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1F
T1VUKTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKLQotCS8qCi0JICogUHJveHkgb2JqZWN0cyBk
byBub3QgY29udHJvbCBhY2Nlc3MgdG8gdGhlIGJhY2tpbmcgc3RvcmFnZSwgZXJnbwotCSAqIHRo
ZXkgY2Fubm90IGJlIHVzZWQgYXMgYSBtZWFucyB0byBtYW5pcHVsYXRlIHRoZSBjYWNoZSBkb21h
aW4KLQkgKiB0cmFja2luZyBmb3IgdGhhdCBiYWNraW5nIHN0b3JhZ2UuIFRoZSBwcm94eSBvYmpl
Y3QgaXMgYWx3YXlzCi0JICogY29uc2lkZXJlZCB0byBiZSBvdXRzaWRlIG9mIGFueSBjYWNoZSBk
b21haW4uCi0JICovCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9pc19wcm94eShvYmopKSB7Ci0JCWVy
ciA9IC1FTlhJTzsKLQkJZ290byBvdXQ7Ci0JfQotCi0JLyoKLQkgKiBGbHVzaCBhbmQgYWNxdWly
ZSBvYmotPnBhZ2VzIHNvIHRoYXQgd2UgYXJlIGNvaGVyZW50IHRocm91Z2gKLQkgKiBkaXJlY3Qg
YWNjZXNzIGluIG1lbW9yeSB3aXRoIHByZXZpb3VzIGNhY2hlZCB3cml0ZXMgdGhyb3VnaAotCSAq
IHNobWVtZnMgYW5kIHRoYXQgb3VyIGNhY2hlIGRvbWFpbiB0cmFja2luZyByZW1haW5zIHZhbGlk
LgotCSAqIEZvciBleGFtcGxlLCBpZiB0aGUgb2JqLT5maWxwIHdhcyBtb3ZlZCB0byBzd2FwIHdp
dGhvdXQgdXMKLQkgKiBiZWluZyBub3RpZmllZCBhbmQgcmVsZWFzaW5nIHRoZSBwYWdlcywgd2Ug
d291bGQgbWlzdGFrZW5seQotCSAqIGNvbnRpbnVlIHRvIGFzc3VtZSB0aGF0IHRoZSBvYmogcmVt
YWluZWQgb3V0IG9mIHRoZSBDUFUgY2FjaGVkCi0JICogZG9tYWluLgotCSAqLwotCWVyciA9IGk5
MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKLQot
CWVyciA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKGRldik7Ci0JaWYgKGVycikKLQkJ
Z290byBvdXRfdW5waW47Ci0KLQlpZiAocmVhZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlOX1dD
KQotCQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX3djX2RvbWFpbihvYmosIHdyaXRlX2Rv
bWFpbik7Ci0JZWxzZSBpZiAocmVhZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlOX0dUVCkKLQkJ
ZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgd3JpdGVfZG9tYWlu
KTsKLQllbHNlCi0JCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fY3B1X2RvbWFpbihvYmos
IHdyaXRlX2RvbWFpbik7Ci0KLQkvKiBBbmQgYnVtcCB0aGUgTFJVIGZvciB0aGlzIGFjY2VzcyAq
LwotCWk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dndHQob2JqKTsKLQotCW11dGV4X3Vu
bG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCi0JaWYgKHdyaXRlX2RvbWFpbiAhPSAwKQotCQlp
bnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosCi0JCQkJCWZiX3dyaXRlX29yaWdpbihvYmosIHdy
aXRlX2RvbWFpbikpOwotCi1vdXRfdW5waW46Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2Vz
KG9iaik7Ci1vdXQ6Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCXJldHVybiBlcnI7Ci19
Ci0KIC8qKgogICogQ2FsbGVkIHdoZW4gdXNlciBzcGFjZSBoYXMgZG9uZSB3cml0ZXMgdG8gdGhp
cyBidWZmZXIKICAqIEBkZXY6IGRybSBkZXZpY2UKQEAgLTE1NDIsNTE0ICsxMjgxLDYgQEAgaW50
IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
cmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2Zvcl9k
aXNwbGF5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JLyoKLQkgKiBXZSBt
YW51YWxseSBmbHVzaCB0aGUgQ1BVIGRvbWFpbiBzbyB0aGF0IHdlIGNhbiBvdmVycmlkZSBhbmQK
LQkgKiBmb3JjZSB0aGUgZmx1c2ggZm9yIHRoZSBkaXNwbGF5LCBhbmQgcGVyZm9ybSBpdCBhc3lu
Y3Job25vdXNseS4KLQkgKi8KLQlpOTE1X2dlbV9vYmplY3RfZmx1c2hfd3JpdGVfZG9tYWluKG9i
aiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOwotCWlmIChvYmotPmNhY2hlX2RpcnR5KQotCQlpOTE1
X2dlbV9jbGZsdXNoX29iamVjdChvYmosIEk5MTVfQ0xGTFVTSF9GT1JDRSk7Ci0Jb2JqLT53cml0
ZV9kb21haW4gPSAwOwotfQotCi12b2lkIGk5MTVfZ2VtX29iamVjdF9mbHVzaF9pZl9kaXNwbGF5
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JaWYgKCFSRUFEX09OQ0Uob2Jq
LT5waW5fZ2xvYmFsKSkKLQkJcmV0dXJuOwotCi0JbXV0ZXhfbG9jaygmb2JqLT5iYXNlLmRldi0+
c3RydWN0X211dGV4KTsKLQlfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9mb3JfZGlzcGxheShvYmop
OwotCW11dGV4X3VubG9jaygmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLX0KLQotLyoq
Ci0gKiBNb3ZlcyBhIHNpbmdsZSBvYmplY3QgdG8gdGhlIFdDIHJlYWQsIGFuZCBwb3NzaWJseSB3
cml0ZSBkb21haW4uCi0gKiBAb2JqOiBvYmplY3QgdG8gYWN0IG9uCi0gKiBAd3JpdGU6IGFzayBm
b3Igd3JpdGUgYWNjZXNzIG9yIHJlYWQgb25seQotICoKLSAqIFRoaXMgZnVuY3Rpb24gcmV0dXJu
cyB3aGVuIHRoZSBtb3ZlIGlzIGNvbXBsZXRlLCBpbmNsdWRpbmcgd2FpdGluZyBvbgotICogZmx1
c2hlcyB0byBvY2N1ci4KLSAqLwotaW50Ci1pOTE1X2dlbV9vYmplY3Rfc2V0X3RvX3djX2RvbWFp
bihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBib29sIHdyaXRlKQotewotCWludCBy
ZXQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgp
OwotCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLAotCQkJCSAgIEk5MTVfV0FJVF9J
TlRFUlJVUFRJQkxFIHwKLQkJCQkgICBJOTE1X1dBSVRfTE9DS0VEIHwKLQkJCQkgICAod3JpdGUg
PyBJOTE1X1dBSVRfQUxMIDogMCksCi0JCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCWlm
IChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlpZiAob2JqLT53cml0ZV9kb21haW4gPT0gSTkxNV9H
RU1fRE9NQUlOX1dDKQotCQlyZXR1cm4gMDsKLQotCS8qIEZsdXNoIGFuZCBhY3F1aXJlIG9iai0+
cGFnZXMgc28gdGhhdCB3ZSBhcmUgY29oZXJlbnQgdGhyb3VnaAotCSAqIGRpcmVjdCBhY2Nlc3Mg
aW4gbWVtb3J5IHdpdGggcHJldmlvdXMgY2FjaGVkIHdyaXRlcyB0aHJvdWdoCi0JICogc2htZW1m
cyBhbmQgdGhhdCBvdXIgY2FjaGUgZG9tYWluIHRyYWNraW5nIHJlbWFpbnMgdmFsaWQuCi0JICog
Rm9yIGV4YW1wbGUsIGlmIHRoZSBvYmotPmZpbHAgd2FzIG1vdmVkIHRvIHN3YXAgd2l0aG91dCB1
cwotCSAqIGJlaW5nIG5vdGlmaWVkIGFuZCByZWxlYXNpbmcgdGhlIHBhZ2VzLCB3ZSB3b3VsZCBt
aXN0YWtlbmx5Ci0JICogY29udGludWUgdG8gYXNzdW1lIHRoYXQgdGhlIG9iaiByZW1haW5lZCBv
dXQgb2YgdGhlIENQVSBjYWNoZWQKLQkgKiBkb21haW4uCi0JICovCi0JcmV0ID0gaTkxNV9nZW1f
b2JqZWN0X3Bpbl9wYWdlcyhvYmopOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlpOTE1
X2dlbV9vYmplY3RfZmx1c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9XQyk7
Ci0KLQkvKiBTZXJpYWxpc2UgZGlyZWN0IGFjY2VzcyB0byB0aGlzIG9iamVjdCB3aXRoIHRoZSBi
YXJyaWVycyBmb3IKLQkgKiBjb2hlcmVudCB3cml0ZXMgZnJvbSB0aGUgR1BVLCBieSBlZmZlY3Rp
dmVseSBpbnZhbGlkYXRpbmcgdGhlCi0JICogV0MgZG9tYWluIHVwb24gZmlyc3QgYWNjZXNzLgot
CSAqLwotCWlmICgob2JqLT5yZWFkX2RvbWFpbnMgJiBJOTE1X0dFTV9ET01BSU5fV0MpID09IDAp
Ci0JCW1iKCk7Ci0KLQkvKiBJdCBzaG91bGQgbm93IGJlIG91dCBvZiBhbnkgb3RoZXIgd3JpdGUg
ZG9tYWlucywgYW5kIHdlIGNhbiB1cGRhdGUKLQkgKiB0aGUgZG9tYWluIHZhbHVlcyBmb3Igb3Vy
IGNoYW5nZXMuCi0JICovCi0JR0VNX0JVR19PTigob2JqLT53cml0ZV9kb21haW4gJiB+STkxNV9H
RU1fRE9NQUlOX1dDKSAhPSAwKTsKLQlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9ET01B
SU5fV0M7Ci0JaWYgKHdyaXRlKSB7Ci0JCW9iai0+cmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9N
QUlOX1dDOwotCQlvYmotPndyaXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9XQzsKLQkJb2Jq
LT5tbS5kaXJ0eSA9IHRydWU7Ci0JfQotCi0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9i
aik7Ci0JcmV0dXJuIDA7Ci19Ci0KLS8qKgotICogTW92ZXMgYSBzaW5nbGUgb2JqZWN0IHRvIHRo
ZSBHVFQgcmVhZCwgYW5kIHBvc3NpYmx5IHdyaXRlIGRvbWFpbi4KLSAqIEBvYmo6IG9iamVjdCB0
byBhY3Qgb24KLSAqIEB3cml0ZTogYXNrIGZvciB3cml0ZSBhY2Nlc3Mgb3IgcmVhZCBvbmx5Ci0g
KgotICogVGhpcyBmdW5jdGlvbiByZXR1cm5zIHdoZW4gdGhlIG1vdmUgaXMgY29tcGxldGUsIGlu
Y2x1ZGluZyB3YWl0aW5nIG9uCi0gKiBmbHVzaGVzIHRvIG9jY3VyLgotICovCi1pbnQKLWk5MTVf
Z2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLCBib29sIHdyaXRlKQotewotCWludCByZXQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZv
YmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dh
aXQob2JqLAotCQkJCSAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICBJOTE1X1dB
SVRfTE9DS0VEIHwKLQkJCQkgICAod3JpdGUgPyBJOTE1X1dBSVRfQUxMIDogMCksCi0JCQkJICAg
TUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlpZiAo
b2JqLT53cml0ZV9kb21haW4gPT0gSTkxNV9HRU1fRE9NQUlOX0dUVCkKLQkJcmV0dXJuIDA7Ci0K
LQkvKiBGbHVzaCBhbmQgYWNxdWlyZSBvYmotPnBhZ2VzIHNvIHRoYXQgd2UgYXJlIGNvaGVyZW50
IHRocm91Z2gKLQkgKiBkaXJlY3QgYWNjZXNzIGluIG1lbW9yeSB3aXRoIHByZXZpb3VzIGNhY2hl
ZCB3cml0ZXMgdGhyb3VnaAotCSAqIHNobWVtZnMgYW5kIHRoYXQgb3VyIGNhY2hlIGRvbWFpbiB0
cmFja2luZyByZW1haW5zIHZhbGlkLgotCSAqIEZvciBleGFtcGxlLCBpZiB0aGUgb2JqLT5maWxw
IHdhcyBtb3ZlZCB0byBzd2FwIHdpdGhvdXQgdXMKLQkgKiBiZWluZyBub3RpZmllZCBhbmQgcmVs
ZWFzaW5nIHRoZSBwYWdlcywgd2Ugd291bGQgbWlzdGFrZW5seQotCSAqIGNvbnRpbnVlIHRvIGFz
c3VtZSB0aGF0IHRoZSBvYmogcmVtYWluZWQgb3V0IG9mIHRoZSBDUFUgY2FjaGVkCi0JICogZG9t
YWluLgotCSAqLwotCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKLQlpZiAo
cmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRlX2RvbWFp
bihvYmosIH5JOTE1X0dFTV9ET01BSU5fR1RUKTsKLQotCS8qIFNlcmlhbGlzZSBkaXJlY3QgYWNj
ZXNzIHRvIHRoaXMgb2JqZWN0IHdpdGggdGhlIGJhcnJpZXJzIGZvcgotCSAqIGNvaGVyZW50IHdy
aXRlcyBmcm9tIHRoZSBHUFUsIGJ5IGVmZmVjdGl2ZWx5IGludmFsaWRhdGluZyB0aGUKLQkgKiBH
VFQgZG9tYWluIHVwb24gZmlyc3QgYWNjZXNzLgotCSAqLwotCWlmICgob2JqLT5yZWFkX2RvbWFp
bnMgJiBJOTE1X0dFTV9ET01BSU5fR1RUKSA9PSAwKQotCQltYigpOwotCi0JLyogSXQgc2hvdWxk
IG5vdyBiZSBvdXQgb2YgYW55IG90aGVyIHdyaXRlIGRvbWFpbnMsIGFuZCB3ZSBjYW4gdXBkYXRl
Ci0JICogdGhlIGRvbWFpbiB2YWx1ZXMgZm9yIG91ciBjaGFuZ2VzLgotCSAqLwotCUdFTV9CVUdf
T04oKG9iai0+d3JpdGVfZG9tYWluICYgfkk5MTVfR0VNX0RPTUFJTl9HVFQpICE9IDApOwotCW9i
ai0+cmVhZF9kb21haW5zIHw9IEk5MTVfR0VNX0RPTUFJTl9HVFQ7Ci0JaWYgKHdyaXRlKSB7Ci0J
CW9iai0+cmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKLQkJb2JqLT53cml0ZV9k
b21haW4gPSBJOTE1X0dFTV9ET01BSU5fR1RUOwotCQlvYmotPm1tLmRpcnR5ID0gdHJ1ZTsKLQl9
Ci0KLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKLQlyZXR1cm4gMDsKLX0KLQot
LyoqCi0gKiBDaGFuZ2VzIHRoZSBjYWNoZS1sZXZlbCBvZiBhbiBvYmplY3QgYWNyb3NzIGFsbCBW
TUEuCi0gKiBAb2JqOiBvYmplY3QgdG8gYWN0IG9uCi0gKiBAY2FjaGVfbGV2ZWw6IG5ldyBjYWNo
ZSBsZXZlbCB0byBzZXQgZm9yIHRoZSBvYmplY3QKLSAqCi0gKiBBZnRlciB0aGlzIGZ1bmN0aW9u
IHJldHVybnMsIHRoZSBvYmplY3Qgd2lsbCBiZSBpbiB0aGUgbmV3IGNhY2hlLWxldmVsCi0gKiBh
Y3Jvc3MgYWxsIEdUVCBhbmQgdGhlIGNvbnRlbnRzIG9mIHRoZSBiYWNraW5nIHN0b3JhZ2Ugd2ls
bCBiZSBjb2hlcmVudCwKLSAqIHdpdGggcmVzcGVjdCB0byB0aGUgbmV3IGNhY2hlLWxldmVsLiBJ
biBvcmRlciB0byBrZWVwIHRoZSBiYWNraW5nIHN0b3JhZ2UKLSAqIGNvaGVyZW50IGZvciBhbGwg
dXNlcnMsIHdlIG9ubHkgYWxsb3cgYSBzaW5nbGUgY2FjaGUgbGV2ZWwgdG8gYmUgc2V0Ci0gKiBn
bG9iYWxseSBvbiB0aGUgb2JqZWN0IGFuZCBwcmV2ZW50IGl0IGZyb20gYmVpbmcgY2hhbmdlZCB3
aGlsc3QgdGhlCi0gKiBoYXJkd2FyZSBpcyByZWFkaW5nIGZyb20gdGhlIG9iamVjdC4gVGhhdCBp
cyBpZiB0aGUgb2JqZWN0IGlzIGN1cnJlbnRseQotICogb24gdGhlIHNjYW5vdXQgaXQgd2lsbCBi
ZSBzZXQgdG8gdW5jYWNoZWQgKG9yIGVxdWl2YWxlbnQgZGlzcGxheQotICogY2FjaGUgY29oZXJl
bmN5KSBhbmQgYWxsIG5vbi1NT0NTIEdQVSBhY2Nlc3Mgd2lsbCBhbHNvIGJlIHVuY2FjaGVkIHNv
Ci0gKiB0aGF0IGFsbCBkaXJlY3QgYWNjZXNzIHRvIHRoZSBzY2Fub3V0IHJlbWFpbnMgY29oZXJl
bnQuCi0gKi8KLWludCBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJICAgIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNo
ZV9sZXZlbCkKLXsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlpbnQgcmV0OwotCi0JbG9ja2Rl
cF9hc3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQotCWlmIChvYmot
PmNhY2hlX2xldmVsID09IGNhY2hlX2xldmVsKQotCQlyZXR1cm4gMDsKLQotCS8qIEluc3BlY3Qg
dGhlIGxpc3Qgb2YgY3VycmVudGx5IGJvdW5kIFZNQSBhbmQgdW5iaW5kIGFueSB0aGF0IHdvdWxk
Ci0JICogYmUgaW52YWxpZCBnaXZlbiB0aGUgbmV3IGNhY2hlLWxldmVsLiBUaGlzIGlzIHByaW5j
aXBhbGx5IHRvCi0JICogY2F0Y2ggdGhlIGlzc3VlIG9mIHRoZSBDUyBwcmVmZXRjaCBjcm9zc2lu
ZyBwYWdlIGJvdW5kYXJpZXMgYW5kCi0JICogcmVhZGluZyBhbiBpbnZhbGlkIFBURSBvbiBvbGRl
ciBhcmNoaXRlY3R1cmVzLgotCSAqLwotcmVzdGFydDoKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZt
YSwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5rKSB7Ci0JCWlmICghZHJtX21tX25vZGVfYWxsb2Nh
dGVkKCZ2bWEtPm5vZGUpKQotCQkJY29udGludWU7Ci0KLQkJaWYgKGk5MTVfdm1hX2lzX3Bpbm5l
ZCh2bWEpKSB7Ci0JCQlEUk1fREVCVUcoImNhbiBub3QgY2hhbmdlIHRoZSBjYWNoZSBsZXZlbCBv
ZiBwaW5uZWQgb2JqZWN0c1xuIik7Ci0JCQlyZXR1cm4gLUVCVVNZOwotCQl9Ci0KLQkJaWYgKCFp
OTE1X3ZtYV9pc19jbG9zZWQodm1hKSAmJgotCQkgICAgaTkxNV9nZW1fdmFsaWRfZ3R0X3NwYWNl
KHZtYSwgY2FjaGVfbGV2ZWwpKQotCQkJY29udGludWU7Ci0KLQkJcmV0ID0gaTkxNV92bWFfdW5i
aW5kKHZtYSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCS8qIEFzIHVuYmluZGlu
ZyBtYXkgYWZmZWN0IG90aGVyIGVsZW1lbnRzIGluIHRoZQotCQkgKiBvYmotPnZtYV9saXN0IChk
dWUgdG8gc2lkZS1lZmZlY3RzIGZyb20gcmV0aXJpbmcKLQkJICogYW4gYWN0aXZlIHZtYSksIHBs
YXkgc2FmZSBhbmQgcmVzdGFydCB0aGUgaXRlcmF0b3IuCi0JCSAqLwotCQlnb3RvIHJlc3RhcnQ7
Ci0JfQotCi0JLyogV2UgY2FuIHJldXNlIHRoZSBleGlzdGluZyBkcm1fbW0gbm9kZXMgYnV0IG5l
ZWQgdG8gY2hhbmdlIHRoZQotCSAqIGNhY2hlLWxldmVsIG9uIHRoZSBQVEUuIFdlIGNvdWxkIHNp
bXBseSB1bmJpbmQgdGhlbSBhbGwgYW5kCi0JICogcmViaW5kIHdpdGggdGhlIGNvcnJlY3QgY2Fj
aGUtbGV2ZWwgb24gbmV4dCB1c2UuIEhvd2V2ZXIgc2luY2UKLQkgKiB3ZSBhbHJlYWR5IGhhdmUg
YSB2YWxpZCBzbG90LCBkbWEgbWFwcGluZywgcGFnZXMgZXRjLCB3ZSBtYXkgYXMKLQkgKiByZXdy
aXRlIHRoZSBQVEUgaW4gdGhlIGJlbGllZiB0aGF0IGRvaW5nIHNvIHRyYW1wbGVzIHVwb24gbGVz
cwotCSAqIHN0YXRlIGFuZCBzbyBpbnZvbHZlcyBsZXNzIHdvcmsuCi0JICovCi0JaWYgKG9iai0+
YmluZF9jb3VudCkgewotCQkvKiBCZWZvcmUgd2UgY2hhbmdlIHRoZSBQVEUsIHRoZSBHUFUgbXVz
dCBub3QgYmUgYWNjZXNzaW5nIGl0LgotCQkgKiBJZiB3ZSB3YWl0IHVwb24gdGhlIG9iamVjdCwg
d2Uga25vdyB0aGF0IGFsbCB0aGUgYm91bmQKLQkJICogVk1BIGFyZSBubyBsb25nZXIgYWN0aXZl
LgotCQkgKi8KLQkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLAotCQkJCQkgICBJOTE1
X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQgfAotCQkJCQkg
ICBJOTE1X1dBSVRfQUxMLAotCQkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0JCWlmIChy
ZXQpCi0JCQlyZXR1cm4gcmV0OwotCi0JCWlmICghSEFTX0xMQyh0b19pOTE1KG9iai0+YmFzZS5k
ZXYpKSAmJgotCQkgICAgY2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9OT05FKSB7Ci0JCQkvKiBB
Y2Nlc3MgdG8gc25vb3BhYmxlIHBhZ2VzIHRocm91Z2ggdGhlIEdUVCBpcwotCQkJICogaW5jb2hl
cmVudCBhbmQgb24gc29tZSBtYWNoaW5lcyBjYXVzZXMgYSBoYXJkCi0JCQkgKiBsb2NrdXAuIFJl
bGlucXVpc2ggdGhlIENQVSBtbWFwaW5nIHRvIGZvcmNlCi0JCQkgKiB1c2Vyc3BhY2UgdG8gcmVm
YXVsdCBpbiB0aGUgcGFnZXMgYW5kIHdlIGNhbgotCQkJICogdGhlbiBkb3VibGUgY2hlY2sgaWYg
dGhlIEdUVCBtYXBwaW5nIGlzIHN0aWxsCi0JCQkgKiB2YWxpZCBmb3IgdGhhdCBwb2ludGVyIGFj
Y2Vzcy4KLQkJCSAqLwotCQkJaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChvYmopOwotCi0J
CQkvKiBBcyB3ZSBubyBsb25nZXIgbmVlZCBhIGZlbmNlIGZvciBHVFQgYWNjZXNzLAotCQkJICog
d2UgY2FuIHJlbGlucXVpc2ggaXQgbm93IChhbmQgc28gcHJldmVudCBoYXZpbmcKLQkJCSAqIHRv
IHN0ZWFsIGEgZmVuY2UgZnJvbSBzb21lb25lIGVsc2Ugb24gdGhlIG5leHQKLQkJCSAqIGZlbmNl
IHJlcXVlc3QpLiBOb3RlIEdQVSBhY3Rpdml0eSB3b3VsZCBoYXZlCi0JCQkgKiBkcm9wcGVkIHRo
ZSBmZW5jZSBhcyBhbGwgc25vb3BhYmxlIGFjY2VzcyBpcwotCQkJICogc3VwcG9zZWQgdG8gYmUg
bGluZWFyLgotCQkJICovCi0JCQlmb3JfZWFjaF9nZ3R0X3ZtYSh2bWEsIG9iaikgewotCQkJCXJl
dCA9IGk5MTVfdm1hX3B1dF9mZW5jZSh2bWEpOwotCQkJCWlmIChyZXQpCi0JCQkJCXJldHVybiBy
ZXQ7Ci0JCQl9Ci0JCX0gZWxzZSB7Ci0JCQkvKiBXZSBlaXRoZXIgaGF2ZSBpbmNvaGVyZW50IGJh
Y2tpbmcgc3RvcmUgYW5kCi0JCQkgKiBzbyBubyBHVFQgYWNjZXNzIG9yIHRoZSBhcmNoaXRlY3R1
cmUgaXMgZnVsbHkKLQkJCSAqIGNvaGVyZW50LiBJbiBzdWNoIGNhc2VzLCBleGlzdGluZyBHVFQg
bW1hcHMKLQkJCSAqIGlnbm9yZSB0aGUgY2FjaGUgYml0IGluIHRoZSBQVEUgYW5kIHdlIGNhbgot
CQkJICogcmV3cml0ZSBpdCB3aXRob3V0IGNvbmZ1c2luZyB0aGUgR1BVIG9yIGhhdmluZwotCQkJ
ICogdG8gZm9yY2UgdXNlcnNwYWNlIHRvIGZhdWx0IGJhY2sgaW4gaXRzIG1tYXBzLgotCQkJICov
Ci0JCX0KLQotCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJm9iai0+dm1hLmxpc3QsIG9ial9s
aW5rKSB7Ci0JCQlpZiAoIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSkKLQkJCQlj
b250aW51ZTsKLQotCQkJcmV0ID0gaTkxNV92bWFfYmluZCh2bWEsIGNhY2hlX2xldmVsLCBQSU5f
VVBEQVRFKTsKLQkJCWlmIChyZXQpCi0JCQkJcmV0dXJuIHJldDsKLQkJfQotCX0KLQotCWxpc3Rf
Zm9yX2VhY2hfZW50cnkodm1hLCAmb2JqLT52bWEubGlzdCwgb2JqX2xpbmspCi0JCXZtYS0+bm9k
ZS5jb2xvciA9IGNhY2hlX2xldmVsOwotCWk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJl
bmN5KG9iaiwgY2FjaGVfbGV2ZWwpOwotCW9iai0+Y2FjaGVfZGlydHkgPSB0cnVlOyAvKiBBbHdh
eXMgaW52YWxpZGF0ZSBzdGFsZSBjYWNoZWxpbmVzICovCi0KLQlyZXR1cm4gMDsKLX0KLQotaW50
IGk5MTVfZ2VtX2dldF9jYWNoaW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQg
KmRhdGEsCi0JCQkgICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlKQotewotCXN0cnVjdCBkcm1f
aTkxNV9nZW1fY2FjaGluZyAqYXJncyA9IGRhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKLQlpbnQgZXJyID0gMDsKLQotCXJjdV9yZWFkX2xvY2soKTsKLQlvYmogPSBpOTE1
X2dlbV9vYmplY3RfbG9va3VwX3JjdShmaWxlLCBhcmdzLT5oYW5kbGUpOwotCWlmICghb2JqKSB7
Ci0JCWVyciA9IC1FTk9FTlQ7Ci0JCWdvdG8gb3V0OwotCX0KLQotCXN3aXRjaCAob2JqLT5jYWNo
ZV9sZXZlbCkgewotCWNhc2UgSTkxNV9DQUNIRV9MTEM6Ci0JY2FzZSBJOTE1X0NBQ0hFX0wzX0xM
QzoKLQkJYXJncy0+Y2FjaGluZyA9IEk5MTVfQ0FDSElOR19DQUNIRUQ7Ci0JCWJyZWFrOwotCi0J
Y2FzZSBJOTE1X0NBQ0hFX1dUOgotCQlhcmdzLT5jYWNoaW5nID0gSTkxNV9DQUNISU5HX0RJU1BM
QVk7Ci0JCWJyZWFrOwotCi0JZGVmYXVsdDoKLQkJYXJncy0+Y2FjaGluZyA9IEk5MTVfQ0FDSElO
R19OT05FOwotCQlicmVhazsKLQl9Ci1vdXQ6Ci0JcmN1X3JlYWRfdW5sb2NrKCk7Ci0JcmV0dXJu
IGVycjsKLX0KLQotaW50IGk5MTVfZ2VtX3NldF9jYWNoaW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCi0JCQkgICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlKQot
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwotCXN0cnVj
dCBkcm1faTkxNV9nZW1fY2FjaGluZyAqYXJncyA9IGRhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iajsKLQllbnVtIGk5MTVfY2FjaGVfbGV2ZWwgbGV2ZWw7Ci0JaW50IHJldCA9
IDA7Ci0KLQlzd2l0Y2ggKGFyZ3MtPmNhY2hpbmcpIHsKLQljYXNlIEk5MTVfQ0FDSElOR19OT05F
OgotCQlsZXZlbCA9IEk5MTVfQ0FDSEVfTk9ORTsKLQkJYnJlYWs7Ci0JY2FzZSBJOTE1X0NBQ0hJ
TkdfQ0FDSEVEOgotCQkvKgotCQkgKiBEdWUgdG8gYSBIVyBpc3N1ZSBvbiBCWFQgQSBzdGVwcGlu
ZywgR1BVIHN0b3JlcyB2aWEgYQotCQkgKiBzbm9vcGVkIG1hcHBpbmcgbWF5IGxlYXZlIHN0YWxl
IGRhdGEgaW4gYSBjb3JyZXNwb25kaW5nIENQVQotCQkgKiBjYWNoZWxpbmUsIHdoZXJlYXMgbm9y
bWFsbHkgc3VjaCBjYWNoZWxpbmVzIHdvdWxkIGdldAotCQkgKiBpbnZhbGlkYXRlZC4KLQkJICov
Ci0JCWlmICghSEFTX0xMQyhpOTE1KSAmJiAhSEFTX1NOT09QKGk5MTUpKQotCQkJcmV0dXJuIC1F
Tk9ERVY7Ci0KLQkJbGV2ZWwgPSBJOTE1X0NBQ0hFX0xMQzsKLQkJYnJlYWs7Ci0JY2FzZSBJOTE1
X0NBQ0hJTkdfRElTUExBWToKLQkJbGV2ZWwgPSBIQVNfV1QoaTkxNSkgPyBJOTE1X0NBQ0hFX1dU
IDogSTkxNV9DQUNIRV9OT05FOwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlyZXR1cm4gLUVJTlZB
TDsKLQl9Ci0KLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfbG9va3VwKGZpbGUsIGFyZ3MtPmhhbmRs
ZSk7Ci0JaWYgKCFvYmopCi0JCXJldHVybiAtRU5PRU5UOwotCi0JLyoKLQkgKiBUaGUgY2FjaGlu
ZyBtb2RlIG9mIHByb3h5IG9iamVjdCBpcyBoYW5kbGVkIGJ5IGl0cyBnZW5lcmF0b3IsIGFuZAot
CSAqIG5vdCBhbGxvd2VkIHRvIGJlIGNoYW5nZWQgYnkgdXNlcnNwYWNlLgotCSAqLwotCWlmIChp
OTE1X2dlbV9vYmplY3RfaXNfcHJveHkob2JqKSkgewotCQlyZXQgPSAtRU5YSU87Ci0JCWdvdG8g
b3V0OwotCX0KLQotCWlmIChvYmotPmNhY2hlX2xldmVsID09IGxldmVsKQotCQlnb3RvIG91dDsK
LQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKLQkJCQkgICBJOTE1X1dBSVRfSU5U
RVJSVVBUSUJMRSwKLQkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0JaWYgKHJldCkKLQkJ
Z290byBvdXQ7Ci0KLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwot
CWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNo
ZV9sZXZlbChvYmosIGxldmVsKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsK
LQotb3V0OgotCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQlyZXR1cm4gcmV0OwotfQotCi0v
KgotICogUHJlcGFyZSBidWZmZXIgZm9yIGRpc3BsYXkgcGxhbmUgKHNjYW5vdXQsIGN1cnNvcnMs
IGV0YykuIENhbiBiZSBjYWxsZWQgZnJvbQotICogYW4gdW5pbnRlcnJ1cHRpYmxlIHBoYXNlICht
b2Rlc2V0dGluZykgYW5kIGFsbG93cyBhbnkgZmx1c2hlcyB0byBiZSBwaXBlbGluZWQKLSAqIChm
b3IgcGFnZWZsaXBzKS4gV2Ugb25seSBmbHVzaCB0aGUgY2FjaGVzIHdoaWxlIHByZXBhcmluZyB0
aGUgYnVmZmVyIGZvcgotICogZGlzcGxheSwgdGhlIGNhbGxlcnMgYXJlIHJlc3BvbnNpYmxlIGZv
ciBmcm9udGJ1ZmZlciBmbHVzaC4KLSAqLwotc3RydWN0IGk5MTVfdm1hICoKLWk5MTVfZ2VtX29i
amVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAotCQkJCSAgICAgdTMyIGFsaWdubWVudCwKLQkJCQkgICAgIGNvbnN0IHN0cnVjdCBpOTE1X2dn
dHRfdmlldyAqdmlldywKLQkJCQkgICAgIHVuc2lnbmVkIGludCBmbGFncykKLXsKLQlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKLQlpbnQgcmV0OwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5i
YXNlLmRldi0+c3RydWN0X211dGV4KTsKLQotCS8qIE1hcmsgdGhlIGdsb2JhbCBwaW4gZWFybHkg
c28gdGhhdCB3ZSBhY2NvdW50IGZvciB0aGUKLQkgKiBkaXNwbGF5IGNvaGVyZW5jeSB3aGlsc3Qg
c2V0dGluZyB1cCB0aGUgY2FjaGUgZG9tYWlucy4KLQkgKi8KLQlvYmotPnBpbl9nbG9iYWwrKzsK
LQotCS8qIFRoZSBkaXNwbGF5IGVuZ2luZSBpcyBub3QgY29oZXJlbnQgd2l0aCB0aGUgTExDIGNh
Y2hlIG9uIGdlbjYuICBBcwotCSAqIGEgcmVzdWx0LCB3ZSBtYWtlIHN1cmUgdGhhdCB0aGUgcGlu
bmluZyB0aGF0IGlzIGFib3V0IHRvIG9jY3VyIGlzCi0JICogZG9uZSB3aXRoIHVuY2FjaGVkIFBU
RXMuIFRoaXMgaXMgbG93ZXN0IGNvbW1vbiBkZW5vbWluYXRvciBmb3IgYWxsCi0JICogY2hpcHNl
dHMuCi0JICoKLQkgKiBIb3dldmVyIGZvciBnZW42Kywgd2UgY291bGQgZG8gYmV0dGVyIGJ5IHVz
aW5nIHRoZSBHRkRUIGJpdCBpbnN0ZWFkCi0JICogb2YgdW5jYWNoaW5nLCB3aGljaCB3b3VsZCBh
bGxvdyB1cyB0byBmbHVzaCBhbGwgdGhlIExMQy1jYWNoZWQgZGF0YQotCSAqIHdpdGggdGhhdCBi
aXQgaW4gdGhlIFBURSB0byBtYWluIG1lbW9yeSB3aXRoIGp1c3Qgb25lIFBJUEVfQ09OVFJPTC4K
LQkgKi8KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwKLQkJCQkJ
ICAgICAgSEFTX1dUKHRvX2k5MTUob2JqLT5iYXNlLmRldikpID8KLQkJCQkJICAgICAgSTkxNV9D
QUNIRV9XVCA6IEk5MTVfQ0FDSEVfTk9ORSk7Ci0JaWYgKHJldCkgewotCQl2bWEgPSBFUlJfUFRS
KHJldCk7Ci0JCWdvdG8gZXJyX3VucGluX2dsb2JhbDsKLQl9Ci0KLQkvKiBBcyB0aGUgdXNlciBt
YXkgbWFwIHRoZSBidWZmZXIgb25jZSBwaW5uZWQgaW4gdGhlIGRpc3BsYXkgcGxhbmUKLQkgKiAo
ZS5nLiBsaWJrbXMgZm9yIHRoZSBib290dXAgc3BsYXNoKSwgd2UgaGF2ZSB0byBlbnN1cmUgdGhh
dCB3ZQotCSAqIGFsd2F5cyB1c2UgbWFwX2FuZF9mZW5jZWFibGUgZm9yIGFsbCBzY2Fub3V0IGJ1
ZmZlcnMuIEhvd2V2ZXIsCi0JICogaXQgbWF5IHNpbXBseSBiZSB0b28gYmlnIHRvIGZpdCBpbnRv
IG1hcHBhYmxlLCBpbiB3aGljaCBjYXNlCi0JICogcHV0IGl0IGFueXdheSBhbmQgaG9wZSB0aGF0
IHVzZXJzcGFjZSBjYW4gY29wZSAoYnV0IGFsd2F5cyBmaXJzdAotCSAqIHRyeSB0byBwcmVzZXJ2
ZSB0aGUgZXhpc3RpbmcgQUJJKS4KLQkgKi8KLQl2bWEgPSBFUlJfUFRSKC1FTk9TUEMpOwotCWlm
ICgoZmxhZ3MgJiBQSU5fTUFQUEFCTEUpID09IDAgJiYKLQkgICAgKCF2aWV3IHx8IHZpZXctPnR5
cGUgPT0gSTkxNV9HR1RUX1ZJRVdfTk9STUFMKSkKLQkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dn
dHRfcGluKG9iaiwgdmlldywgMCwgYWxpZ25tZW50LAotCQkJCQkgICAgICAgZmxhZ3MgfAotCQkJ
CQkgICAgICAgUElOX01BUFBBQkxFIHwKLQkJCQkJICAgICAgIFBJTl9OT05CTE9DSyk7Ci0JaWYg
KElTX0VSUih2bWEpKQotCQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCB2aWV3
LCAwLCBhbGlnbm1lbnQsIGZsYWdzKTsKLQlpZiAoSVNfRVJSKHZtYSkpCi0JCWdvdG8gZXJyX3Vu
cGluX2dsb2JhbDsKLQotCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBtYXhfdCh1NjQsIHZtYS0+
ZGlzcGxheV9hbGlnbm1lbnQsIGFsaWdubWVudCk7Ci0KLQlfX2k5MTVfZ2VtX29iamVjdF9mbHVz
aF9mb3JfZGlzcGxheShvYmopOwotCi0JLyogSXQgc2hvdWxkIG5vdyBiZSBvdXQgb2YgYW55IG90
aGVyIHdyaXRlIGRvbWFpbnMsIGFuZCB3ZSBjYW4gdXBkYXRlCi0JICogdGhlIGRvbWFpbiB2YWx1
ZXMgZm9yIG91ciBjaGFuZ2VzLgotCSAqLwotCW9iai0+cmVhZF9kb21haW5zIHw9IEk5MTVfR0VN
X0RPTUFJTl9HVFQ7Ci0KLQlyZXR1cm4gdm1hOwotCi1lcnJfdW5waW5fZ2xvYmFsOgotCW9iai0+
cGluX2dsb2JhbC0tOwotCXJldHVybiB2bWE7Ci19Ci0KLXZvaWQKLWk5MTVfZ2VtX29iamVjdF91
bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGk5MTVfdm1hICp2bWEpCi17Ci0JbG9ja2Rl
cF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlpZiAo
V0FSTl9PTih2bWEtPm9iai0+cGluX2dsb2JhbCA9PSAwKSkKLQkJcmV0dXJuOwotCi0JaWYgKC0t
dm1hLT5vYmotPnBpbl9nbG9iYWwgPT0gMCkKLQkJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5
MTVfR1RUX01JTl9BTElHTk1FTlQ7Ci0KLQkvKiBCdW1wIHRoZSBMUlUgdG8gdHJ5IGFuZCBhdm9p
ZCBwcmVtYXR1cmUgZXZpY3Rpb24gd2hpbHN0IGZsaXBwaW5nICAqLwotCWk5MTVfZ2VtX29iamVj
dF9idW1wX2luYWN0aXZlX2dndHQodm1hLT5vYmopOwotCi0JaTkxNV92bWFfdW5waW4odm1hKTsK
LX0KLQotLyoqCi0gKiBNb3ZlcyBhIHNpbmdsZSBvYmplY3QgdG8gdGhlIENQVSByZWFkLCBhbmQg
cG9zc2libHkgd3JpdGUgZG9tYWluLgotICogQG9iajogb2JqZWN0IHRvIGFjdCBvbgotICogQHdy
aXRlOiByZXF1ZXN0aW5nIHdyaXRlIG9yIHJlYWQtb25seSBhY2Nlc3MKLSAqCi0gKiBUaGlzIGZ1
bmN0aW9uIHJldHVybnMgd2hlbiB0aGUgbW92ZSBpcyBjb21wbGV0ZSwgaW5jbHVkaW5nIHdhaXRp
bmcgb24KLSAqIGZsdXNoZXMgdG8gb2NjdXIuCi0gKi8KLWludAotaTkxNV9nZW1fb2JqZWN0X3Nl
dF90b19jcHVfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGJvb2wgd3Jp
dGUpCi17Ci0JaW50IHJldDsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYt
PnN0cnVjdF9tdXRleCk7Ci0KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCi0JCQkJ
ICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAotCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQgfAot
CQkJCSAgICh3cml0ZSA/IEk5MTVfV0FJVF9BTEwgOiAwKSwKLQkJCQkgICBNQVhfU0NIRURVTEVf
VElNRU9VVCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWk5MTVfZ2VtX29iamVjdF9m
bHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7Ci0KLQkvKiBGbHVz
aCB0aGUgQ1BVIGNhY2hlIGlmIGl0J3Mgc3RpbGwgaW52YWxpZC4gKi8KLQlpZiAoKG9iai0+cmVh
ZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlOX0NQVSkgPT0gMCkgewotCQlpOTE1X2dlbV9jbGZs
dXNoX29iamVjdChvYmosIEk5MTVfQ0xGTFVTSF9TWU5DKTsKLQkJb2JqLT5yZWFkX2RvbWFpbnMg
fD0gSTkxNV9HRU1fRE9NQUlOX0NQVTsKLQl9Ci0KLQkvKiBJdCBzaG91bGQgbm93IGJlIG91dCBv
ZiBhbnkgb3RoZXIgd3JpdGUgZG9tYWlucywgYW5kIHdlIGNhbiB1cGRhdGUKLQkgKiB0aGUgZG9t
YWluIHZhbHVlcyBmb3Igb3VyIGNoYW5nZXMuCi0JICovCi0JR0VNX0JVR19PTihvYmotPndyaXRl
X2RvbWFpbiAmIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKLQotCS8qIElmIHdlJ3JlIHdyaXRpbmcg
dGhyb3VnaCB0aGUgQ1BVLCB0aGVuIHRoZSBHUFUgcmVhZCBkb21haW5zIHdpbGwKLQkgKiBuZWVk
IHRvIGJlIGludmFsaWRhdGVkIGF0IG5leHQgdXNlLgotCSAqLwotCWlmICh3cml0ZSkKLQkJX19z
dGFydF9jcHVfd3JpdGUob2JqKTsKLQotCXJldHVybiAwOwotfQotCiAvKiBUaHJvdHRsZSBvdXIg
cmVuZGVyaW5nIGJ5IHdhaXRpbmcgdW50aWwgdGhlIHJpbmcgaGFzIGNvbXBsZXRlZCBvdXIgcmVx
dWVzdHMKICAqIGVtaXR0ZWQgb3ZlciAyMCBtc2VjIGFnby4KICAqCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggOTA4ZmRkY2M1N2MzLi42OTlmM2YxODBk
OGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTEw
MjYsNyArMTAyNiw3IEBAIHN0YXRpYyB2b2lkIHJlbG9jX2NhY2hlX3Jlc2V0KHN0cnVjdCByZWxv
Y19jYWNoZSAqY2FjaGUpCiAJCQltYigpOwogCiAJCWt1bm1hcF9hdG9taWModmFkZHIpOwotCQlp
OTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2Vzcygoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKiljYWNoZS0+bm9kZS5tbSk7CisJCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKChz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqKWNhY2hlLT5ub2RlLm1tKTsKIAl9IGVsc2Ugewog
CQl3bWIoKTsKIAkJaW9fbWFwcGluZ191bm1hcF9hdG9taWMoKHZvaWQgX19pb21lbSAqKXZhZGRy
KTsKQEAgLTEwNTgsNyArMTA1OCw3IEBAIHN0YXRpYyB2b2lkICpyZWxvY19rbWFwKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCXVuc2lnbmVkIGludCBmbHVzaGVzOwogCQlpbnQg
ZXJyOwogCi0JCWVyciA9IGk5MTVfZ2VtX29ial9wcmVwYXJlX3NobWVtX3dyaXRlKG9iaiwgJmZs
dXNoZXMpOworCQllcnIgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV93cml0ZShvYmosICZmbHVz
aGVzKTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBFUlJfUFRSKGVycik7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3JlbmRlcl9zdGF0ZS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fcmVuZGVyX3N0YXRlLmMKaW5kZXggOTQ0MDAyNGM3NjNmLi5m
M2I0MmIwMjZmZmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3Jl
bmRlcl9zdGF0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3JlbmRlcl9z
dGF0ZS5jCkBAIC04NCw3ICs4NCw3IEBAIHN0YXRpYyBpbnQgcmVuZGVyX3N0YXRlX3NldHVwKHN0
cnVjdCBpbnRlbF9yZW5kZXJfc3RhdGUgKnNvLAogCXUzMiAqZDsKIAlpbnQgcmV0OwogCi0JcmV0
ID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2htZW1fd3JpdGUoc28tPm9iaiwgJm5lZWRzX2NsZmx1
c2gpOworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dyaXRlKHNvLT5vYmosICZuZWVk
c19jbGZsdXNoKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCkBAIC0xNjYsNyArMTY2LDcg
QEAgc3RhdGljIGludCByZW5kZXJfc3RhdGVfc2V0dXAoc3RydWN0IGludGVsX3JlbmRlcl9zdGF0
ZSAqc28sCiAKIAlyZXQgPSAwOwogb3V0OgotCWk5MTVfZ2VtX29ial9maW5pc2hfc2htZW1fYWNj
ZXNzKHNvLT5vYmopOworCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKHNvLT5vYmopOwog
CXJldHVybiByZXQ7CiAKIGVycjoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9odWdlX3BhZ2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaHVn
ZV9wYWdlcy5jCmluZGV4IGNlNGVjODc2OThmNi4uYjIyYjgyNDlkZmJkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKQEAgLTEwMTcsNyArMTAxNyw3IEBA
IHN0YXRpYyBpbnQgY3B1X2NoZWNrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHUz
MiBkd29yZCwgdTMyIHZhbCkKIAl1bnNpZ25lZCBsb25nIG47CiAJaW50IGVycjsKIAotCWVyciA9
IGk5MTVfZ2VtX29ial9wcmVwYXJlX3NobWVtX3JlYWQob2JqLCAmbmVlZHNfZmx1c2gpOworCWVy
ciA9IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3JlYWQob2JqLCAmbmVlZHNfZmx1c2gpOwogCWlm
IChlcnIpCiAJCXJldHVybiBlcnI7CiAKQEAgLTEwMzgsNyArMTAzOCw3IEBAIHN0YXRpYyBpbnQg
Y3B1X2NoZWNrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHUzMiBkd29yZCwgdTMy
IHZhbCkKIAkJa3VubWFwX2F0b21pYyhwdHIpOwogCX0KIAotCWk5MTVfZ2VtX29ial9maW5pc2hf
c2htZW1fYWNjZXNzKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3Mob2JqKTsK
IAogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKaW5kZXggMDQ2YTM4NzQzMTUyLi5jYjI1YjVmYzgwMjcg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hl
cmVuY3kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fY29o
ZXJlbmN5LmMKQEAgLTM3LDcgKzM3LDcgQEAgc3RhdGljIGludCBjcHVfc2V0KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdTMyICpjcHU7CiAJaW50IGVycjsKIAotCWVyciA9IGk5
MTVfZ2VtX29ial9wcmVwYXJlX3NobWVtX3dyaXRlKG9iaiwgJm5lZWRzX2NsZmx1c2gpOworCWVy
ciA9IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dyaXRlKG9iaiwgJm5lZWRzX2NsZmx1c2gpOwog
CWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKQEAgLTU0LDcgKzU0LDcgQEAgc3RhdGljIGludCBj
cHVfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCWRybV9jbGZsdXNoX3Zp
cnRfcmFuZ2UoY3B1LCBzaXplb2YoKmNwdSkpOwogCiAJa3VubWFwX2F0b21pYyhtYXApOwotCWk5
MTVfZ2VtX29ial9maW5pc2hfc2htZW1fYWNjZXNzKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X2Zp
bmlzaF9hY2Nlc3Mob2JqKTsKIAogCXJldHVybiAwOwogfQpAQCAtNjksNyArNjksNyBAQCBzdGF0
aWMgaW50IGNwdV9nZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl1MzIgKmNw
dTsKIAlpbnQgZXJyOwogCi0JZXJyID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2htZW1fcmVhZChv
YmosICZuZWVkc19jbGZsdXNoKTsKKwllcnIgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV9yZWFk
KG9iaiwgJm5lZWRzX2NsZmx1c2gpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKQEAgLTgz
LDcgKzgzLDcgQEAgc3RhdGljIGludCBjcHVfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJKnYgPSAqY3B1OwogCiAJa3VubWFwX2F0b21pYyhtYXApOwotCWk5MTVfZ2VtX29i
al9maW5pc2hfc2htZW1fYWNjZXNzKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nl
c3Mob2JqKTsKIAogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggMzRhYzVjYzZkNTlmLi5jNjljNmQ5YTk5
OGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9j
b250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYwpAQCAtMzU0LDcgKzM1NCw3IEBAIHN0YXRpYyBpbnQgY3B1X2ZpbGwoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdTMyIHZhbHVlKQogCXVuc2lnbmVkIGludCBuLCBtLCBu
ZWVkX2ZsdXNoOwogCWludCBlcnI7CiAKLQllcnIgPSBpOTE1X2dlbV9vYmpfcHJlcGFyZV9zaG1l
bV93cml0ZShvYmosICZuZWVkX2ZsdXNoKTsKKwllcnIgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFy
ZV93cml0ZShvYmosICZuZWVkX2ZsdXNoKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCkBA
IC0zNjksNyArMzY5LDcgQEAgc3RhdGljIGludCBjcHVfZmlsbChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLCB1MzIgdmFsdWUpCiAJCWt1bm1hcF9hdG9taWMobWFwKTsKIAl9CiAKLQlp
OTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2VzcyhvYmopOworCWk5MTVfZ2VtX29iamVjdF9m
aW5pc2hfYWNjZXNzKG9iaik7CiAJb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5f
R1RUIHwgSTkxNV9HRU1fRE9NQUlOX0NQVTsKIAlvYmotPndyaXRlX2RvbWFpbiA9IDA7CiAJcmV0
dXJuIDA7CkBAIC0zODEsNyArMzgxLDcgQEAgc3RhdGljIG5vaW5saW5lIGludCBjcHVfY2hlY2so
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl1bnNpZ25lZCBpbnQgbiwgbSwgbmVl
ZHNfZmx1c2g7CiAJaW50IGVycjsKIAotCWVyciA9IGk5MTVfZ2VtX29ial9wcmVwYXJlX3NobWVt
X3JlYWQob2JqLCAmbmVlZHNfZmx1c2gpOworCWVyciA9IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJl
X3JlYWQob2JqLCAmbmVlZHNfZmx1c2gpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKQEAg
LTQxOSw3ICs0MTksNyBAQCBzdGF0aWMgbm9pbmxpbmUgaW50IGNwdV9jaGVjayhzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJYnJlYWs7CiAJfQogCi0JaTkxNV9nZW1fb2JqX2Zp
bmlzaF9zaG1lbV9hY2Nlc3Mob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2Vzcyhv
YmopOwogCXJldHVybiBlcnI7CiB9CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

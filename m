Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0B174B95B6
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 18:33:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6F1DD6FD5B;
	Fri, 20 Sep 2019 16:33:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 55AB06FD5B
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 16:33:02 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 18562355-1500050 for multiple; Fri, 20 Sep 2019 17:32:58 +0100
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20190902040303.14195-1-chris@chris-wilson.co.uk>
 <20190902040303.14195-15-chris@chris-wilson.co.uk>
 <7c57c74a-f6d6-168a-b53b-f15323b4ca55@linux.intel.com>
In-Reply-To: <7c57c74a-f6d6-168a-b53b-f15323b4ca55@linux.intel.com>
Message-ID: <156899717704.1196.3045131477697249532@skylake-alporthouse-com>
Date: Fri, 20 Sep 2019 17:32:57 +0100
Subject: Re: [Intel-gfx] [PATCH 15/21] drm/i915: Coordinate i915_active with
 its own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBUdnJ0a28gVXJzdWxpbiAoMjAxOS0wOS0yMCAxNzoxNDo0MykKPiAKPiBPbiAwMi8w
OS8yMDE5IDA1OjAyLCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKPiA+IGluZGV4IDJiMWJhZjJmY2M4ZS4u
NmQ3YWMxMjljZThhIDEwMDY0NAo+ID4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfdGltZWxpbmVfdHlwZXMuaAo+ID4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfdGltZWxpbmVfdHlwZXMuaAo+ID4gQEAgLTYzLDcgKzYzLDcgQEAgc3RydWN0IGludGVsX3Rp
bWVsaW5lIHsKPiA+ICAgICAgICAqIHRoZSByZXF1ZXN0IHVzaW5nIGk5MTVfYWN0aXZlX3JlcXVl
c3RfZ2V0X3JlcXVlc3RfcmN1KCksIG9yIGhvbGQgdGhlCj4gCj4gTG9va3MgbGlrZSBhIHN0YWxl
IGNvbW1lbnQuCj4gCj4gPiAgICAgICAgKiBzdHJ1Y3RfbXV0ZXguCj4gPiAgICAgICAgKi8KPiA+
IC0gICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGxhc3RfcmVxdWVzdDsKPiA+ICsgICAg
IHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSBsYXN0X3JlcXVlc3Q7Cj4gCj4gV29ydGggcmVuYW1p
bmcgdG8gbGFzdF9mZW5jZSBub3cgdGhhdCByZXF1ZXN0IG5hbWluZyBpcyBvdGhlcndpc2UgZ29u
ZSAKPiBmcm9tIGk5MTVfYWN0aXZlPwoKSG1tLCBhbHRob3VnaCBpOTE1X2FjdGl2ZSBpcyB0YWtp
bmcgb24gbW9yZSBnZW5lcmljIGRtYS1mZW5jZXMsIHRoaXMgaXMKc3RpbGwgYXNzdW1lZCB0byBi
ZSBhIGk5MTVfcmVxdWVzdCBpbiBhIGNvdXBsZSBvZiBwbGFjZXMuCgpUaGVyZSdzIGdvb2QgYXJn
dW1lbnRzIGZvciBlaXRoZXIgbGFzdF9yZXF1ZXN0IG9yIGxhc3RfZmVuY2UuIElmIEkgdGhyb3cK
YSBHRU1fQlVHX09OKCFpc19yZXF1ZXN0KCkpIGFyb3VuZCwgdGhhdCBwcm9iYWJseSBzd2luZ3Mg
dGhlIGRlYmF0ZSBpbgpmYXZvdXIgb2YgbGFzdF9yZXF1ZXN0LiBBdCBsZWFzdCB0cmllcyB0byBj
YXB0dXJlIHRoYXQgd2UgZG8gYXNzdW1lIGluCnNvbWUgcGxhY2VzIHRoaXMgaXMgaTkxNV9yZXF1
ZXN0LgoKPiA+ICAgdm9pZCBpOTE1X2FjdGl2ZV9zZXRfZXhjbHVzaXZlKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmLCBzdHJ1Y3QgZG1hX2ZlbmNlICpmKQo+ID4gICB7Cj4gPiAgICAgICBHRU1fQlVH
X09OKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSk7Cj4gPiAgIAo+ID4gLSAgICAgZG1hX2ZlbmNl
X2dldChmKTsKPiA+IC0KPiA+IC0gICAgIHJjdV9yZWFkX2xvY2soKTsKPiA+IC0gICAgIGlmIChy
Y3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkgewo+ID4gLSAgICAgICAgICAgICBzdHJ1Y3Qg
ZG1hX2ZlbmNlICpvbGQ7Cj4gPiAtCj4gPiAtICAgICAgICAgICAgIG9sZCA9IGRtYV9mZW5jZV9n
ZXRfcmN1X3NhZmUoJnJlZi0+ZXhjbCk7Cj4gPiAtICAgICAgICAgICAgIGlmIChvbGQpIHsKPiA+
IC0gICAgICAgICAgICAgICAgICAgICBpZiAoZG1hX2ZlbmNlX3JlbW92ZV9jYWxsYmFjayhvbGQs
ICZyZWYtPmV4Y2xfY2IpKQo+ID4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXRvbWlj
X2RlYygmcmVmLT5jb3VudCk7Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgZG1hX2ZlbmNlX3B1
dChvbGQpOwo+ID4gLSAgICAgICAgICAgICB9Cj4gPiAtICAgICB9Cj4gPiAtICAgICByY3VfcmVh
ZF91bmxvY2soKTsKPiA+IC0KPiA+IC0gICAgIGF0b21pY19pbmMoJnJlZi0+Y291bnQpOwo+ID4g
LSAgICAgcmN1X2Fzc2lnbl9wb2ludGVyKHJlZi0+ZXhjbCwgZik7Cj4gPiArICAgICBtdXRleF9h
Y3F1aXJlKCZyZWYtPm11dGV4LmRlcF9tYXAsIDAsIDAsIF9USElTX0lQXyk7Cj4gCj4gVGhpcyBq
dXN0IGxvY2tkZXAgYW5ub3RhdGlvbj8gUHJvYmFibHkgZGVzZXJ2ZXMgYSBjb21tZW50LgoKWXVw
LgoKPiAKPiA+ICsgICAgIGlmICghX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnJlZi0+ZXhjbCwg
ZikpCj4gPiArICAgICAgICAgICAgIGF0b21pY19pbmMoJnJlZi0+Y291bnQpOwo+IAo+IFJlZmNv
dW50IG1hbmFnZW1lbnQgaXMgbm90IGJldHRlciBkb25lIGZyb20gaW5zaWRlIF9faTkxNV9hY3Rp
dmVfZmVuY2Vfc2V0PwoKTm8sIFRoZSBhY3RpdmUgY291bnRpbmcgaXMgb24gaTkxNV9hY3RpdmU7
IGk5MTVfYWN0aXZlX2ZlbmNlIGlzIGp1c3QgYQpjb21wb25lbnQuCgpFLmcuIG90aGVyIHVzZXJz
IHdhbnQgdG8ga25vdyB0aGUgZmVuY2UgdGhhdCB1c2VkIHRvIGJlIGluIHRoZQppOTE1X2FjdGl2
ZV9mZW5jZToKCmludCBpOTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX2Zl
bmNlICphY3RpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpCnsKICAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKICAgICAgICBpbnQgZXJy
OwoKI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKICAgICAgICBsb2Nr
ZGVwX2Fzc2VydF9oZWxkKGFjdGl2ZS0+bG9jayk7CiNlbmRpZgoKICAgICAgICAvKiBNdXN0IG1h
aW50YWluIG9yZGVyaW5nIHdydCBwcmV2aW91cyBhY3RpdmUgcmVxdWVzdHMgKi8KICAgICAgICBy
Y3VfcmVhZF9sb2NrKCk7CiAgICAgICAgZmVuY2UgPSBfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldChh
Y3RpdmUsICZycS0+ZmVuY2UpOwogICAgICAgIGlmIChmZW5jZSkKICAgICAgICAgICAgICAgIGZl
bmNlID0gZG1hX2ZlbmNlX2dldF9yY3UoZmVuY2UpOwogICAgICAgIHJjdV9yZWFkX3VubG9jaygp
OwoKICAgICAgICBpZiAoZmVuY2UpIHsKICAgICAgICAgICAgICAgIGVyciA9IGk5MTVfcmVxdWVz
dF9hd2FpdF9kbWFfZmVuY2UocnEsIGZlbmNlKTsKICAgICAgICAgICAgICAgIGRtYV9mZW5jZV9w
dXQoZmVuY2UpOwogICAgICAgICAgICAgICAgaWYgKGVycikKICAgICAgICAgICAgICAgICAgICAg
ICAgcmV0dXJuIGVycjsKICAgICAgICB9CgogICAgICAgIHJldHVybiAwOwp9CgphbmQgc2ltaWxh
cmx5IGluIF9faTkxNV9yZXF1ZXN0X2FkZF90b190aW1lbGluZSgpCgo+ID4gK3N0cnVjdCBkbWFf
ZmVuY2UgKgo+ID4gK19faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9m
ZW5jZSAqYWN0aXZlLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlKQo+ID4gK3sKPiA+ICsgICAgIHN0cnVjdCBkbWFfZmVuY2UgKnByZXY7Cj4gPiArICAg
ICB1bnNpZ25lZCBsb25nIGZsYWdzOwo+ID4gKwo+ID4gKyAgICAgLyogTkI6IHVwZGF0ZXMgbXVz
dCBiZSBzZXJpYWxpc2VkIGJ5IGFuIG91dGVyIHRpbWVsaW5lIG11dGV4ICovCj4gPiArICAgICBz
cGluX2xvY2tfaXJxc2F2ZShmZW5jZS0+bG9jaywgZmxhZ3MpOwo+ID4gKyAgICAgR0VNX0JVR19P
Tih0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19TSUdOQUxFRF9CSVQsICZmZW5jZS0+ZmxhZ3MpKTsK
PiA+ICsKPiA+ICsgICAgIHByZXYgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGFjdGl2ZS0+
ZmVuY2UsIGFjdGl2ZV9pc19oZWxkKGFjdGl2ZSkpOwo+ID4gKyAgICAgaWYgKHByZXYpIHsKPiA+
ICsgICAgICAgICAgICAgc3Bpbl9sb2NrX25lc3RlZChwcmV2LT5sb2NrLCBTSU5HTEVfREVQVEhf
TkVTVElORyk7Cj4gPiArICAgICAgICAgICAgIF9fbGlzdF9kZWxfZW50cnkoJmFjdGl2ZS0+Y2Iu
bm9kZSk7Cj4gPiArICAgICAgICAgICAgIHNwaW5fdW5sb2NrKHByZXYtPmxvY2spOyAvKiBzZXJp
YWxpc2Ugd2l0aCBwcmV2LT5jYl9saXN0ICovCj4gPiArICAgICAgICAgICAgIHByZXYgPSByY3Vf
YWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5mZW5jZSk7Cj4gCj4gV2h5IGl0IGlzIGltcG9ydGFudCB0
byByZS1yZWFkIGFjdGl2ZS0+ZmVuY2UgYW5kIGRvZXMgaXQgdGhlbiBuZWVkIGEgCj4gY29tbWVu
dD8KCkJlY2F1c2Ugd2UgaGF2ZSB0byBzZXJpYWxpc2Ugd2l0aCB0aGUgcHJldi0+Y2JfbGlzdC4g
OykKClRoZSB3cml0ZSB0byBhY3RpdmUtPmZlbmNlIGlzIG1hZGUgb24gc2lnbmFsaW5nLCBhbmQg
dGhhdCBpcyBwZXJmb3JtZWQKdW5kZXIgdGhlIHByZXYtPmxvY2suIFNvIHdlIGhhdmUgdG8gdGFr
ZSB0aGUgcHJldi0+bG9jayBvdXJzZWx2ZXMgdG8KZmx1c2ggYW55IGNvbmN1cnJlbnQgY2FsbGJh
Y2tzIGJlZm9yZSB3ZSBrbm93IHdoZXRoZXIgdGhleSByYW4gKGhhdmluZwp0YWtlbiB0aGUgbG9j
aywgd2UgcmVtb3ZlIHRoZSBjYiBmcm9tIHRoZSBsaXN0IGFuZCBzbyBub3cgdGhhdCBpZiBpdApo
YXMgbm90IHJ1biwgaXQgY2FuIG5vdCBydW4pLgoKPiBIb3cgZG9lcyBpdCB0aWUgd2l0aCBpOTE1
X2FjdGl2ZS0+Y291bnQgcmVmY291bnRpbmcgd2hpY2ggaXMgZG9uZSBvbiB0aGUgCj4gYmFzaXMg
b2YgcmV0dXJuIHZhbHVlIGZyb20gdGhpcyBmdW5jdGlvbj8KClNhbWUgYXMgYWJvdmUsIHdlIGhh
dmUgdG8gZmx1c2ggdGhlIHNpZ25hbCBjYWxsYmFjayB0byBkZXRlcm1pbmUgd2hldGhlcgpvciBu
b3Qgd2UgbmVlZCB0byBpbmNyZW1lbnQgdGhlIGFjdGl2ZSBjb3VudC4KCj4gPiBkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKPiA+IGluZGV4IDNlZWQyZWZhOGQxMy4uMWFhZGFiMWNkZDI0IDEwMDY0NAo+
ID4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwo+ID4gKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwo+ID4gQEAgLTkwMCwyOCArOTAwLDM4IEBAIHdhaXRf
Zm9yX3RpbWVsaW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKPiA+ICAgCj4gPiAg
ICAgICBzcGluX2xvY2tfaXJxc2F2ZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7Cj4gPiAgICAg
ICBsaXN0X2Zvcl9lYWNoX2VudHJ5KHRsLCAmdGltZWxpbmVzLT5hY3RpdmVfbGlzdCwgbGluaykg
ewo+ID4gLSAgICAgICAgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKPiA+ICsgICAgICAg
ICAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7Cj4gPiAgIAo+ID4gLSAgICAgICAgICAgICBy
cSA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3VubG9ja2VkKCZ0bC0+bGFzdF9yZXF1ZXN0KTsK
PiA+IC0gICAgICAgICAgICAgaWYgKCFycSkKPiA+ICsgICAgICAgICAgICAgZmVuY2UgPSBpOTE1
X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOwo+ID4gKyAgICAgICAgICAgICBp
ZiAoIWZlbmNlKQo+ID4gICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwo+ID4gICAKPiA+
ICAgICAgICAgICAgICAgc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGltZWxpbmVzLT5sb2NrLCBm
bGFncyk7Cj4gPiAgIAo+ID4gLSAgICAgICAgICAgICAvKgo+ID4gLSAgICAgICAgICAgICAgKiAi
UmFjZS10by1pZGxlIi4KPiA+IC0gICAgICAgICAgICAgICoKPiA+IC0gICAgICAgICAgICAgICog
U3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGEgc3luY2hyb25v
dXMKPiA+IC0gICAgICAgICAgICAgICogc3RlcCBwcmlvciB0byBpZGxpbmcsIGUuZy4gaW4gc3Vz
cGVuZCBmb3IgZmx1c2hpbmcgYWxsCj4gPiAtICAgICAgICAgICAgICAqIGN1cnJlbnQgb3BlcmF0
aW9ucyB0byBtZW1vcnkgYmVmb3JlIHNsZWVwaW5nLiBUaGVzZSB3ZQo+ID4gLSAgICAgICAgICAg
ICAgKiB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNrbHkgYXMgcG9zc2libGUgdG8gYXZvaWQgcHJv
bG9uZ2VkCj4gPiAtICAgICAgICAgICAgICAqIHN0YWxscywgc28gYWxsb3cgdGhlIGdwdSB0byBi
b29zdCB0byBtYXhpbXVtIGNsb2Nrcy4KPiA+IC0gICAgICAgICAgICAgICovCj4gPiAtICAgICAg
ICAgICAgIGlmICh3YWl0ICYgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NUKQo+ID4gLSAgICAgICAg
ICAgICAgICAgICAgIGdlbjZfcnBzX2Jvb3N0KHJxKTsKPiA+ICsgICAgICAgICAgICAgaWYgKCFk
bWFfZmVuY2VfaXNfaTkxNShmZW5jZSkpIHsKPiA+ICsgICAgICAgICAgICAgICAgICAgICB0aW1l
b3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmZW5jZSwKPiA+ICsgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFncyAmIEk5MTVfV0FJVF9J
TlRFUlJVUFRJQkxFLAo+ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIHRpbWVvdXQpOwo+IAo+IFdlIGRpZCBub3QgaGF2ZSBzdXBwb3J0IGZv
ciBub24taTkxNSBmZW5jZXMgYmVmb3JlIHRoaXMgcGF0Y2ggcmlnaHQ/IAo+IFdvdWxkIGl0IGJl
IGJldHRlciB0byBzcGxpdCB0aGlzIG91dCBpbiB0aGlzIGNhc2U/CgpQYXJ0IG9mIHJhaXNvbiBk
J2V0cmUgZm9yIHRoZSBwYXRjaCB3YXMgdG8gYWxsb3cgZm9yIGk5MTVfYWN0aXZlIHRvIGhhdmUK
ZG1hLWZlbmNlcywgYW5kIHRvIGJlY29tZSBsZXNzIGk5MTUtc3BlY2lmaWMuCgpJdCdzIHRyaXZp
YWwgZW5vdWdoIHRoYXQgaW4gYSBjb3VwbGUgb2YgcGF0Y2hlcyB0aW1lIHlvdSB3aWxsIGZvcmdl
dAp0aGF0IHdlIGV2ZW4gdGhvdWdodCBhYm91dCBpOTE1X3JlcXVlc3RzIGhlcmUgOykKLUNocmlz
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

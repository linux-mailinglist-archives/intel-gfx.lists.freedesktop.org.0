Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 54EF0A398A
	for <lists+intel-gfx@lfdr.de>; Fri, 30 Aug 2019 16:48:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C1E936E365;
	Fri, 30 Aug 2019 14:47:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B45AA6E354
 for <intel-gfx@lists.freedesktop.org>; Fri, 30 Aug 2019 14:47:43 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 30 Aug 2019 07:47:43 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,447,1559545200"; d="scan'208";a="188894227"
Received: from unknown (HELO delly.ger.corp.intel.com) ([10.252.38.85])
 by FMSMGA003.fm.intel.com with ESMTP; 30 Aug 2019 07:47:42 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 30 Aug 2019 17:47:23 +0300
Message-Id: <20190830144726.18291-9-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190830144726.18291-1-lionel.g.landwerlin@intel.com>
References: <20190830144726.18291-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v12 08/11] drm/i915/perf: execute OA
 configuration from command stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgaGF2ZW4ndCBydW4gaW50byBpc3N1ZXMgd2l0aCBwcm9ncmFtbWluZyB0aGUgZ2xvYmFsIE9B
L05PQQpyZWdpc3RlcnMgY29uZmlndXJhdGlvbiBmcm9tIENQVSBzbyBmYXIsIGJ1dCBIVyBlbmdp
bmVlcnMgYWN0dWFsbHkKcmVjb21tZW5kIGRvaW5nIHRoaXMgZnJvbSB0aGUgY29tbWFuZCBzdHJl
YW1lci4gT24gVEdMIGluIHBhcnRpY3VsYXIKb25lIG9mIHRoZSBjbG9jayBkb21haW4gaW4gd2hp
Y2ggc29tZSBvZiB0aGF0IHByb2dyYW1taW5nIGdvZXMgbWlnaHQKbm90IGJlIHBvd2VyZWQgd2hl
biB3ZSBwb2tlIHRoaW5ncyBmcm9tIHRoZSBDUFUuCgpTaW5jZSB3ZSBoYXZlIGEgY29tbWFuZCBi
dWZmZXIgcHJlcGFyZWQgZm9yIHRoZSBleGVjYnVmZmVyIHNpZGUgb2YKdGhpbmdzLCB3ZSBjYW4g
cmV1c2UgdGhhdCBhcHByb2FjaCBoZXJlIHRvby4KClRoaXMgYWxzbyBhbGxvd3MgdXMgdG8gc2ln
bmlmaWNhbnRseSByZWR1Y2UgdGhlIGFtb3VudCBvZiB0aW1lIHdlIGhvbGQKdGhlIG1haW4gbG9j
ay4KCnYyOiBEcm9wIHRoZSBnbG9iYWwgbG9jayBhcyBtdWNoIGFzIHBvc3NpYmxlCgp2MzogVGFr
ZSBnbG9iYWwgbG9jayB0byBwaW4gZ2xvYmFsCgp2NDogQ3JlYXRlIGk5MTUgcmVxdWVzdCBpbiBl
bWl0X29hX2NvbmZpZygpIHRvIGF2b2lkIGRlYWRsb2NrcyAoTGlvbmVsKQoKdjU6IE1vdmUgbG9j
a2luZyB0byB0aGUgc3RyZWFtIChMaW9uZWwpCgp2NjogTW92ZSBhY3RpdmUgcmVjb25maWd1cmF0
aW9uIHJlcXVlc3QgaW50byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwpCgpTaWduZWQtb2ZmLWJ5
OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgfCAgMTMgKystCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmYuYyB8IDE2NiArKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0t
CiAyIGZpbGVzIGNoYW5nZWQsIDExOCBpbnNlcnRpb25zKCspLCA2MSBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCAyMGI2YTcwMjMwOTcuLjA4NGNkZDExNWQ1YSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xMTI5LDcgKzExMjksOCBAQCBzdHJ1Y3QgaTkxNV9w
ZXJmX3N0cmVhbSB7CiAJY29uc3Qgc3RydWN0IGk5MTVfcGVyZl9zdHJlYW1fb3BzICpvcHM7CiAK
IAkvKioKLQkgKiBAYWN0aXZlX2NvbmZpZ19tdXRleDogUHJvdGVjdHMgYWNjZXNzIHRvIEBvYV9j
b25maWcgJiBAb2FfY29uZmlnX2Jvcy4KKwkgKiBAYWN0aXZlX2NvbmZpZ19tdXRleDogUHJvdGVj
dHMgYWNjZXNzIHRvIEBhY3RpdmVfY29uZmlnX3JxLAorCSAqIEBvYV9jb25maWcgJiBAb2FfY29u
ZmlnX2Jvcy4KIAkgKi8KIAlzdHJ1Y3QgbXV0ZXggY29uZmlnX211dGV4OwogCkBAIC0xMTQ0LDYg
KzExNDUsMTYgQEAgc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gewogCSAqLwogCXN0cnVjdCBsaXN0
X2hlYWQgb2FfY29uZmlnX2JvczsKIAorCS8qKgorCSAqIEBhY3RpdmVfY29uZmlnX3JxOiBMYXN0
IHJlcXVlc3QgcmVjb25maWd1cmluZyB0aGUgSFcuCisJICovCisJc3RydWN0IGk5MTVfYWN0aXZl
X3JlcXVlc3QgYWN0aXZlX2NvbmZpZ19ycTsKKworCS8qKgorCSAqIEBpbml0aWFsX29hX2NvbmZp
Z19ibzogRmlyc3QgT0EgY29uZmlndXJhdGlvbiBCTyB0byBiZSBydW4uCisJICovCisJc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKmluaXRpYWxfb2FfY29uZmlnX2JvOworCiAJLyoqCiAJICog
VGhlIE9BIGNvbnRleHQgc3BlY2lmaWMgaW5mb3JtYXRpb24uCiAJICovCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcGVyZi5jCmluZGV4IGQwNzY0ODUyYjM0Ny4uMmJjMjRhODJmODk3IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BlcmYuYwpAQCAtMTU1OCwxOCArMTU1OCwyMyBAQCBmcmVlX29hX2NvbmZpZ3Moc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3RyZWFt
X2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OworCWludCBlcnI7CiAK
IAlCVUdfT04oc3RyZWFtICE9IGRldl9wcml2LT5wZXJmLmV4Y2x1c2l2ZV9zdHJlYW0pOwogCi0J
LyoKLQkgKiBVbnNldCBleGNsdXNpdmVfc3RyZWFtIGZpcnN0LCBpdCB3aWxsIGJlIGNoZWNrZWQg
d2hpbGUgZGlzYWJsaW5nCi0JICogdGhlIG1ldHJpYyBzZXQgb24gZ2VuOCsuCi0JICovCiAJbXV0
ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWRldl9wcml2LT5wZXJmLmV4
Y2x1c2l2ZV9zdHJlYW0gPSBOVUxMOworCW11dGV4X2xvY2soJnN0cmVhbS0+Y29uZmlnX211dGV4
KTsKIAlkZXZfcHJpdi0+cGVyZi5vcHMuZGlzYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CisJZXJy
ID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoJnN0cmVhbS0+YWN0aXZlX2NvbmZpZ19ycSwK
KwkJCQkJICZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZzdHJlYW0tPmNv
bmZpZ19tdXRleCk7CisJZGV2X3ByaXYtPnBlcmYuZXhjbHVzaXZlX3N0cmVhbSA9IE5VTEw7CiAJ
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKKwlpZiAoZXJyKQor
CQlEUk1fRVJST1IoIkZhaWxlZCB0byBkaXNhYmxlIHBlcmYgc3RyZWFtXG4iKTsKKworCiAJZnJl
ZV9vYV9idWZmZXIoc3RyZWFtKTsKIAlmcmVlX25vYV93YWl0KHN0cmVhbSk7CiAKQEAgLTE3OTUs
NiArMTgwMCwxMCBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZf
c3RyZWFtICpzdHJlYW0pCiAJCXJldHVybiBQVFJfRVJSKGJvKTsKIAl9CiAKKwlyZXQgPSBpOTE1
X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtKTsKKwlpZiAocmV0KQorCQlnb3Rv
IGVycl91bnJlZjsKKwogCS8qCiAJICogV2UgcGluIGluIEdHVFQgYmVjYXVzZSB3ZSBqdW1wIGlu
dG8gdGhpcyBidWZmZXIgbm93IGJlY2F1c2UKIAkgKiBtdWx0aXBsZSBPQSBjb25maWcgQk9zIHdp
bGwgaGF2ZSBhIGp1bXAgdG8gdGhpcyBhZGRyZXNzIGFuZCBpdApAQCAtMTgwMiwxMCArMTgxMSwx
MyBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0pCiAJICovCiAJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKGJvLCBOVUxMLCAw
LCA0MDk2LCAwKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAkJcmV0ID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycl91bnJl
ZjsKIAl9CiAKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCiAJYmF0
Y2ggPSBjcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJvLCBJOTE1X01BUF9XQik7CiAJaWYg
KElTX0VSUihiYXRjaCkpIHsKIAkJcmV0ID0gUFRSX0VSUihiYXRjaCk7CkBAIC0xOTM5LDcgKzE5
NTEsOSBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0pCiAJcmV0dXJuIDA7CiAKIGVycl91bnBpbjoKLQlfX2k5MTVfdm1hX3VucGluKHZt
YSk7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaTkxNV92bWFfdW5w
aW5fYW5kX3JlbGVhc2UoJnZtYSwgMCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAogZXJyX3VucmVmOgogCWk5MTVfZ2VtX29iamVjdF9wdXQoYm8pOwpAQCAtMTk0
Nyw1MCArMTk2MSw2OSBAQCBzdGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3Bl
cmZfc3RyZWFtICpzdHJlYW0pCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgY29uZmln
X29hX3JlZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJICAgY29uc3Qg
c3RydWN0IGk5MTVfb2FfcmVnICpyZWdzLAotCQkJICAgdTMyIG5fcmVncykKK3N0YXRpYyBpbnQg
ZW1pdF9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgIHN0cnVj
dCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7Ci0JdTMyIGk7CisJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdTMyICpjczsKKwlpbnQgZXJyOwog
Ci0JZm9yIChpID0gMDsgaSA8IG5fcmVnczsgaSsrKSB7Ci0JCWNvbnN0IHN0cnVjdCBpOTE1X29h
X3JlZyAqcmVnID0gcmVncyArIGk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmc3RyZWFtLT5jb25m
aWdfbXV0ZXgpOwogCi0JCUk5MTVfV1JJVEUocmVnLT5hZGRyLCByZWctPnZhbHVlKTsKKwlycSA9
IGk5MTVfcmVxdWVzdF9jcmVhdGUoc3RyZWFtLT5lbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwlp
ZiAoSVNfRVJSKHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJZXJyID0gaTkxNV9hY3Rp
dmVfcmVxdWVzdF9zZXQoJnN0cmVhbS0+YWN0aXZlX2NvbmZpZ19ycSwKKwkJCQkgICAgICBycSk7
CisJaWYgKGVycikKKwkJZ290byBlcnJfYWRkX3JlcXVlc3Q7CisKKwl2bWEgPSBpOTE1X3ZtYV9p
bnN0YW5jZShzdHJlYW0tPmluaXRpYWxfb2FfY29uZmlnX2JvLAorCQkJCSZpOTE1LT5nZ3R0LnZt
LCBOVUxMKTsKKwlpZiAodW5saWtlbHkoSVNfRVJSKHZtYSkpKSB7CisJCWVyciA9IFBUUl9FUlIo
dm1hKTsKKwkJZ290byBlcnJfYWRkX3JlcXVlc3Q7CiAJfQotfQogCi1zdGF0aWMgdm9pZCBkZWxh
eV9hZnRlcl9tdXgodm9pZCkKLXsKLQkvKgotCSAqIEl0IGFwcGFyZW50bHkgdGFrZXMgYSBmYWly
bHkgbG9uZyB0aW1lIGZvciBhIG5ldyBNVVgKLQkgKiBjb25maWd1cmF0aW9uIHRvIGJlIGJlIGFw
cGxpZWQgYWZ0ZXIgdGhlc2UgcmVnaXN0ZXIgd3JpdGVzLgotCSAqIFRoaXMgZGVsYXkgZHVyYXRp
b24gd2FzIGRlcml2ZWQgZW1waXJpY2FsbHkgYmFzZWQgb24gdGhlCi0JICogcmVuZGVyX2Jhc2lj
IGNvbmZpZyBidXQgaG9wZWZ1bGx5IGl0IGNvdmVycyB0aGUgbWF4aW11bQotCSAqIGNvbmZpZ3Vy
YXRpb24gbGF0ZW5jeS4KLQkgKgotCSAqIEFzIGEgZmFsbGJhY2ssIHRoZSBjaGVja3MgaW4gX2Fw
cGVuZF9vYV9yZXBvcnRzKCkgdG8gc2tpcAotCSAqIGludmFsaWQgT0EgcmVwb3J0cyBkbyBhbHNv
IHNlZW0gdG8gd29yayB0byBkaXNjYXJkIHJlcG9ydHMKLQkgKiBnZW5lcmF0ZWQgYmVmb3JlIHRo
aXMgY29uZmlnIGhhcyBjb21wbGV0ZWQgLSBhbGJlaXQgbm90Ci0JICogc2lsZW50bHkuCi0JICoK
LQkgKiBVbmZvcnR1bmF0ZWx5IHRoaXMgaXMgZXNzZW50aWFsbHkgYSBtYWdpYyBudW1iZXIsIHNp
bmNlIHdlCi0JICogZG9uJ3QgY3VycmVudGx5IGtub3cgb2YgYSByZWxpYWJsZSBtZWNoYW5pc20g
Zm9yIHByZWRpY3RpbmcKLQkgKiBob3cgbG9uZyB0aGUgTVVYIGNvbmZpZyB3aWxsIHRha2UgdG8g
YXBwbHkgYW5kIGJlc2lkZXMKLQkgKiBzZWVpbmcgaW52YWxpZCByZXBvcnRzIHdlIGRvbid0IGtu
b3cgb2YgYSByZWxpYWJsZSB3YXkgdG8KLQkgKiBleHBsaWNpdGx5IGNoZWNrIHRoYXQgdGhlIE1V
WCBjb25maWcgaGFzIGxhbmRlZC4KLQkgKgotCSAqIEl0J3MgZXZlbiBwb3NzaWJsZSB3ZSd2ZSBt
aXNzIGNoYXJhY3Rlcml6ZWQgdGhlIHVuZGVybHlpbmcKLQkgKiBwcm9ibGVtIC0gaXQganVzdCBz
ZWVtcyBsaWtlIHRoZSBzaW1wbGVzdCBleHBsYW5hdGlvbiB3aHkKLQkgKiBhIGRlbGF5IGF0IHRo
aXMgbG9jYXRpb24gd291bGQgbWl0aWdhdGUgYW55IGludmFsaWQgcmVwb3J0cy4KLQkgKi8KLQl1
c2xlZXBfcmFuZ2UoMTUwMDAsIDIwMDAwKTsKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAw
LCBQSU5fR0xPQkFMKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9hZGRfcmVxdWVzdDsKKworCWVy
ciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIDApOworCWlmIChlcnIpCisJCWdv
dG8gZXJyX3ZtYV91bnBpbjsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgSU5URUxfR0VO
KGk5MTUpID49IDggPyA0IDogMik7CisJaWYgKElTX0VSUihjcykpIHsKKwkJZXJyID0gUFRSX0VS
Uihjcyk7CisJCWdvdG8gZXJyX3ZtYV91bnBpbjsKKwl9CisKKwlpZiAoSU5URUxfR0VOKGk5MTUp
ID4gOCkgeworCQkqY3MrKyA9IE1JX0JBVENIX0JVRkZFUl9TVEFSVF9HRU44OworCQkqY3MrKyA9
IGxvd2VyXzMyX2JpdHModm1hLT5ub2RlLnN0YXJ0KTsKKwkJKmNzKysgPSB1cHBlcl8zMl9iaXRz
KHZtYS0+bm9kZS5zdGFydCk7CisJCSpjcysrID0gTUlfTk9PUDsKKwl9IGVsc2UgeworCQkqY3Mr
KyA9IE1JX0JBVENIX0JVRkZFUl9TVEFSVDsKKwkJKmNzKysgPSB2bWEtPm5vZGUuc3RhcnQ7CisJ
fQorCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisKK2Vycl92bWFfdW5waW46CisJaTkx
NV92bWFfdW5waW4odm1hKTsKK2Vycl9hZGRfcmVxdWVzdDoKKwlpOTE1X3JlcXVlc3RfYWRkKHJx
KTsKKworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyBpbnQgaHN3X2VuYWJsZV9tZXRyaWNfc2V0
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gc3RyZWFtLT5kZXZfcHJpdjsKLQljb25zdCBzdHJ1Y3QgaTkxNV9v
YV9jb25maWcgKm9hX2NvbmZpZyA9IHN0cmVhbS0+b2FfY29uZmlnOwogCiAJLyoKIAkgKiBQUk06
CkBAIC0yMDA3LDEzICsyMDQwLDcgQEAgc3RhdGljIGludCBoc3dfZW5hYmxlX21ldHJpY19zZXQo
c3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlJOTE1X1dSSVRFKEdFTjZfVUNHQ1RM
MSwgKEk5MTVfUkVBRChHRU42X1VDR0NUTDEpIHwKIAkJCQkgIEdFTjZfQ1NVTklUX0NMT0NLX0dB
VEVfRElTQUJMRSkpOwogCi0JY29uZmlnX29hX3JlZ3MoZGV2X3ByaXYsIG9hX2NvbmZpZy0+bXV4
X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKLQlkZWxheV9hZnRlcl9tdXgoKTsKLQot
CWNvbmZpZ19vYV9yZWdzKGRldl9wcml2LCBvYV9jb25maWctPmJfY291bnRlcl9yZWdzLAotCQkg
ICAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOwotCi0JcmV0dXJuIDA7CisJcmV0
dXJuIGVtaXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0pOwogfQogCiBzdGF0aWMgdm9pZCBo
c3dfZGlzYWJsZV9tZXRyaWNfc2V0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCkBA
IC0yMzcyLDEzICsyMzk5LDcgQEAgc3RhdGljIGludCBnZW44X2VuYWJsZV9tZXRyaWNfc2V0KHN0
cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IAotCWNvbmZpZ19vYV9yZWdzKGRldl9wcml2LCBvYV9jb25maWctPm11eF9yZWdzLCBvYV9jb25m
aWctPm11eF9yZWdzX2xlbik7Ci0JZGVsYXlfYWZ0ZXJfbXV4KCk7Ci0KLQljb25maWdfb2FfcmVn
cyhkZXZfcHJpdiwgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKLQkJICAgICAgIG9hX2NvbmZp
Zy0+Yl9jb3VudGVyX3JlZ3NfbGVuKTsKLQotCXJldHVybiAwOworCXJldHVybiBlbWl0X29hX2Nv
bmZpZyhkZXZfcHJpdiwgc3RyZWFtKTsKIH0KIAogc3RhdGljIHZvaWQgZ2VuOF9kaXNhYmxlX21l
dHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKQEAgLTI1OTcsNiArMjYx
OCwxMCBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSwKIAogCXN0cmVhbS0+ZW5naW5lID0gcHJvcHMtPmVuZ2luZTsKIAorCW11
dGV4X2luaXQoJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKKwlJTklUX0FDVElWRV9SRVFVRVNUKCZz
dHJlYW0tPmFjdGl2ZV9jb25maWdfcnEsCisJCQkgICAgJnN0cmVhbS0+Y29uZmlnX211dGV4KTsK
KwogCXN0cmVhbS0+c2FtcGxlX2ZsYWdzIHw9IFNBTVBMRV9PQV9SRVBPUlQ7CiAJc3RyZWFtLT5z
YW1wbGVfc2l6ZSArPSBmb3JtYXRfc2l6ZTsKIApAQCAtMjYyNSw4ICsyNjUwLDkgQEAgc3RhdGlj
IGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0s
CiAJCWdvdG8gZXJyX25vYV93YWl0X2FsbG9jOwogCX0KIAotCXJldCA9IGk5MTVfcGVyZl9nZXRf
b2FfY29uZmlnKGRldl9wcml2LCBwcm9wcy0+bWV0cmljc19zZXQsCi0JCQkJICAgICAgJnN0cmVh
bS0+b2FfY29uZmlnKTsKKwlyZXQgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZ19hbmRfYm8oc3Ry
ZWFtLCBwcm9wcy0+bWV0cmljc19zZXQsCisJCQkJCSAgICAgJnN0cmVhbS0+b2FfY29uZmlnLAor
CQkJCQkgICAgICZzdHJlYW0tPmluaXRpYWxfb2FfY29uZmlnX2JvKTsKIAlpZiAocmV0KSB7CiAJ
CURSTV9ERUJVRygiSW52YWxpZCBPQSBjb25maWcgaWQ9JWlcbiIsIHByb3BzLT5tZXRyaWNzX3Nl
dCk7CiAJCWdvdG8gZXJyX2NvbmZpZzsKQEAgLTI2NTgsMTYgKzI2ODQsMzEgQEAgc3RhdGljIGlu
dCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJ
c3RyZWFtLT5vcHMgPSAmaTkxNV9vYV9zdHJlYW1fb3BzOwogCWRldl9wcml2LT5wZXJmLmV4Y2x1
c2l2ZV9zdHJlYW0gPSBzdHJlYW07CiAKKwltdXRleF9sb2NrKCZzdHJlYW0tPmNvbmZpZ19tdXRl
eCk7CiAJcmV0ID0gZGV2X3ByaXYtPnBlcmYub3BzLmVuYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7
CiAJaWYgKHJldCkgewogCQlEUk1fREVCVUcoIlVuYWJsZSB0byBlbmFibGUgbWV0cmljIHNldFxu
Iik7Ci0JCWdvdG8gZXJyX2VuYWJsZTsKKwkJLyoKKwkJICogSWdub3JlIHRoZSByZXR1cm4gdmFs
dWUgc2luY2Ugd2UgYWxyZWFkeSBoYXZlIGFuIGVycm9yIGZyb20KKwkJICogdGhlIGVuYWJsZSB2
ZnVuYy4KKwkJICovCisJCWk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZzdHJlYW0tPmFjdGl2
ZV9jb25maWdfcnEsCisJCQkJCSAgICZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CisJfSBlbHNlIHsK
KwkJcmV0ID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoJnN0cmVhbS0+YWN0aXZlX2NvbmZp
Z19ycSwKKwkJCQkJCSAmc3RyZWFtLT5jb25maWdfbXV0ZXgpOwogCX0KIAotCURSTV9ERUJVRygi
b3BlbmluZyBzdHJlYW0gb2EgY29uZmlnIHV1aWQ9JXNcbiIsIHN0cmVhbS0+b2FfY29uZmlnLT51
dWlkKTsKLQorCW11dGV4X3VubG9jaygmc3RyZWFtLT5jb25maWdfbXV0ZXgpOwogCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCisJaTkxNV9nZW1fb2JqZWN0X3B1
dChzdHJlYW0tPmluaXRpYWxfb2FfY29uZmlnX2JvKTsKKwlzdHJlYW0tPmluaXRpYWxfb2FfY29u
ZmlnX2JvID0gTlVMTDsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9lbmFibGU7CisKKwlEUk1fREVC
VUcoIm9wZW5pbmcgc3RyZWFtIG9hIGNvbmZpZyB1dWlkPSVzXG4iLCBzdHJlYW0tPm9hX2NvbmZp
Zy0+dXVpZCk7CisKIAlocnRpbWVyX2luaXQoJnN0cmVhbS0+cG9sbF9jaGVja190aW1lciwKIAkJ
ICAgICBDTE9DS19NT05PVE9OSUMsIEhSVElNRVJfTU9ERV9SRUwpOwogCXN0cmVhbS0+cG9sbF9j
aGVja190aW1lci5mdW5jdGlvbiA9IG9hX3BvbGxfY2hlY2tfdGltZXJfY2I7CkBAIC0yNjc3LDgg
KzI3MTgsMTEgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3Bl
cmZfc3RyZWFtICpzdHJlYW0sCiAJcmV0dXJuIDA7CiAKIGVycl9lbmFibGU6Ci0JZGV2X3ByaXYt
PnBlcmYuZXhjbHVzaXZlX3N0cmVhbSA9IE5VTEw7CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKIAlk
ZXZfcHJpdi0+cGVyZi5vcHMuZGlzYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CisJbXV0ZXhfdW5s
b2NrKCZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CisJZGV2X3ByaXYtPnBlcmYuZXhjbHVzaXZlX3N0
cmVhbSA9IE5VTEw7CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIGVycl9sb2NrOgpAQCAtMjY5Miw2ICsyNzM2LDggQEAgc3RhdGljIGludCBpOTE1X29hX3N0
cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAKIAlmcmVlX29hX2Nv
bmZpZ3Moc3RyZWFtKTsKIAorCWk5MTVfZ2VtX29iamVjdF9wdXQoc3RyZWFtLT5pbml0aWFsX29h
X2NvbmZpZ19ibyk7CisKIGVycl9jb25maWc6CiAJZnJlZV9ub2Ffd2FpdChzdHJlYW0pOwogCi0t
IAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C012EC871C
	for <lists+intel-gfx@lfdr.de>; Wed,  2 Oct 2019 13:20:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 620686E933;
	Wed,  2 Oct 2019 11:20:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 14AE16E933
 for <intel-gfx@lists.freedesktop.org>; Wed,  2 Oct 2019 11:20:30 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18692034-1500050 
 for multiple; Wed, 02 Oct 2019 12:20:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  2 Oct 2019 12:19:49 +0100
Message-Id: <20191002112000.12280-19-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191002112000.12280-1-chris@chris-wilson.co.uk>
References: <20191002112000.12280-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 19/30] drm/i915/execlists: Cancel banned
 contexts on schedule-out
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gY29tcGxldGlvbiBvZiBhIGJhbm5lZCBjb250ZXh0LCBzY3J1YiB0aGUgY29udGV4dCBpbWFn
ZSBzbyB0aGF0IHdlIGRvCm5vdCByZXBsYXkgdGhlIGFjdGl2ZSBwYXlsb2FkLiBUaGUgaW50ZW50
IGlzIHRoYXQgd2Ugc2tpcCBiYW5uZWQKcGF5bG9hZHMgb24gcmVxdWVzdCBzdWJtaXNzaW9uIHNv
IHRoYXQgdGhlIHRpbWVsaW5lIGFkdmFuY2VtZW50CmNvbnRpbnVlcyBvbiBpbiB0aGUgYmFja2dy
b3VuZC4gSG93ZXZlciwgaWYgd2UgYXJlIHJldHVybmluZyB0byBhCnByZWVtcHRlZCByZXF1ZXN0
LCBpOTE1X3JlcXVlc3Rfc2tpcCgpIGlzIGluZWZmZWN0aXZlIGFuZCBpbnN0ZWFkIHdlCm5lZWQg
dG8gcGF0Y2ggdXAgdGhlIGNvbnRleHQgaW1hZ2Ugc28gdGhhdCBpdCBjb250aW51ZXMgZnJvbSB0
aGUgc3RhcnQKb2YgdGhlIG5leHQgcmVxdWVzdC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNv
biA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jIHwgNTggKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDEgZmlsZSBj
aGFuZ2VkLCA1OCBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpp
bmRleCA1MmU1ZTRkZTFmYzYuLjZkY2NlYWYwMmUwMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbHJjLmMKQEAgLTIzNCw2ICsyMzQsOSBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNfaW5pdF9y
ZWdfc3RhdGUodTMyICpyZWdfc3RhdGUsCiAJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUsCiAJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZywK
IAkJCQkgICAgIGJvb2wgY2xvc2UpOworc3RhdGljIHZvaWQKK19fZXhlY2xpc3RzX3VwZGF0ZV9y
ZWdfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJICAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCiBzdGF0aWMgdm9pZCBfX2NvbnRleHRf
cGluX2FjcXVpcmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogewpAQCAtMTAyMiw2ICsxMDI1
LDU4IEBAIHN0YXRpYyB2b2lkIGtpY2tfc2libGluZ3Moc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEs
IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAkJdGFza2xldF9zY2hlZHVsZSgmdmUtPmJhc2Uu
ZXhlY2xpc3RzLnRhc2tsZXQpOwogfQogCitzdGF0aWMgdm9pZAorbWFya19jb21wbGV0ZShzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQorewor
CWNvbnN0IHN0cnVjdCBpbnRlbF90aW1lbGluZSAqIGNvbnN0IHRsID0gcmN1X2RlcmVmZXJlbmNl
KHJxLT50aW1lbGluZSk7CisKKwkqKHUzMiAqKXRsLT5od3NwX3NlcW5vID0gcnEtPmZlbmNlLnNl
cW5vOworCUdFTV9CVUdfT04oIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKTsKKworCWxpc3Rf
Zm9yX2VhY2hfZW50cnlfZnJvbV9yZXZlcnNlKHJxLCAmdGwtPnJlcXVlc3RzLCBsaW5rKSB7CisJ
CWlmIChpOTE1X3JlcXVlc3Rfc2lnbmFsZWQocnEpKQorCQkJYnJlYWs7CisKKwkJbWFya19laW8o
cnEpOworCX0KKworCWludGVsX2VuZ2luZV9xdWV1ZV9icmVhZGNydW1icyhlbmdpbmUpOworfQor
CitzdGF0aWMgdm9pZCBjYW5jZWxfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJ
ICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJc3RydWN0IGludGVsX2NvbnRl
eHQgKiBjb25zdCBjZSA9IHJxLT5od19jb250ZXh0OworCXUzMiAqcmVncyA9IGNlLT5scmNfcmVn
X3N0YXRlOworCisJaWYgKGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKQorCQlyZXR1cm47CisK
KwlHRU1fVFJBQ0UoIiVzKCVzKTogeyBycT0lbGx4OiVsbGQgfVxuIiwKKwkJICBfX2Z1bmNfXywg
ZW5naW5lLT5uYW1lLCBycS0+ZmVuY2UuY29udGV4dCwgcnEtPmZlbmNlLnNlcW5vKTsKKwlfX2Nv
bnRleHRfcGluX2FjcXVpcmUoY2UpOworCisJLyogU2NydWIgdGhlIGNvbnRleHQgaW1hZ2UgdG8g
cHJldmVudCByZXBsYXlpbmcgdGhlIHByZXZpb3VzIGJhdGNoICovCisJbWVtY3B5KHJlZ3MsIC8q
IHNraXAgcmVzdG9yaW5nIHRoZSB2YW5pbGxhIFBQSFdTUCAqLworCSAgICAgICBlbmdpbmUtPnBp
bm5lZF9kZWZhdWx0X3N0YXRlICsgTFJDX1NUQVRFX1BOICogUEFHRV9TSVpFLAorCSAgICAgICBl
bmdpbmUtPmNvbnRleHRfc2l6ZSAtIFBBR0VfU0laRSk7CisJZXhlY2xpc3RzX2luaXRfcmVnX3N0
YXRlKHJlZ3MsIGNlLCBlbmdpbmUsIGNlLT5yaW5nLCBmYWxzZSk7CisKKwkvKiBSaW5nIHdpbGwg
YmUgYWR2YW5jZWQgb24gcmV0aXJlOyBoZXJlIHdlIG5lZWQgdG8gcmVzZXQgdGhlIGNvbnRleHQg
Ki8KKwljZS0+cmluZy0+aGVhZCA9IGludGVsX3Jpbmdfd3JhcChjZS0+cmluZywgcnEtPndhX3Rh
aWwpOworCV9fZXhlY2xpc3RzX3VwZGF0ZV9yZWdfc3RhdGUoY2UsIGVuZ2luZSk7CisKKwkvKiBX
ZSd2ZSBzd2l0Y2hlZCBhd2F5LCBzbyB0aGlzIHNob3VsZCBiZSBhIG5vLW9wLCBidXQgaW50ZW50
IG1hdHRlcnMgKi8KKwljZS0+bHJjX2Rlc2MgfD0gQ1RYX0RFU0NfRk9SQ0VfUkVTVE9SRTsKKwor
CS8qIExldCBldmVyeW9uZSBrbm93IHRoYXQgdGhlIHJlcXVlc3QgbWF5IG5vdyBiZSByZXRpcmVk
ICovCisJcmN1X3JlYWRfbG9jaygpOworCW1hcmtfY29tcGxldGUocnEsIGVuZ2luZSk7CisJcmN1
X3JlYWRfdW5sb2NrKCk7CisKKwlfX2NvbnRleHRfcGluX3JlbGVhc2UoY2UpOworfQorCiBzdGF0
aWMgaW5saW5lIHZvaWQKIF9fZXhlY2xpc3RzX3NjaGVkdWxlX291dChzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSwKIAkJCSBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICogY29uc3QgZW5naW5lKQpAQCAt
MTAzMiw2ICsxMDg3LDkgQEAgX19leGVjbGlzdHNfc2NoZWR1bGVfb3V0KHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxLAogCWV4ZWNsaXN0c19jb250ZXh0X3N0YXR1c19jaGFuZ2UocnEsIElOVEVMX0NP
TlRFWFRfU0NIRURVTEVfT1VUKTsKIAlpbnRlbF9ndF9wbV9wdXQoZW5naW5lLT5ndCk7CiAKKwlp
ZiAodW5saWtlbHkoaTkxNV9nZW1fY29udGV4dF9pc19iYW5uZWQoY2UtPmdlbV9jb250ZXh0KSkp
CisJCWNhbmNlbF9hY3RpdmUocnEsIGVuZ2luZSk7CisKIAkvKgogCSAqIElmIHRoaXMgaXMgcGFy
dCBvZiBhIHZpcnR1YWwgZW5naW5lLCBpdHMgbmV4dCByZXF1ZXN0IG1heQogCSAqIGhhdmUgYmVl
biBibG9ja2VkIHdhaXRpbmcgZm9yIGFjY2VzcyB0byB0aGUgYWN0aXZlIGNvbnRleHQuCi0tIAoy
LjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 870C5CB8D1
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 13:00:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 665746EB20;
	Fri,  4 Oct 2019 11:00:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6BEC36E13B
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 11:00:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18721364-1500050 
 for multiple; Fri, 04 Oct 2019 11:59:59 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 11:59:58 +0100
Message-Id: <20191004105958.1741-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Restrict L3 remapping sysfs interface
 to dwords
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIEwzIGNhY2hlIHJlbWFwcGluZyBpcyBzdG9yZWQgYXMgdTMyIGVsZW1lbnRzLCBhbmQgd2Ug
c2hvdWxkIGVuc3VyZQp0aGF0IHRoZSB1c2VyIG9ubHkgc3VwcGxpZXMgY29tcGxldGUgc2xpY2Ug
aW5mb3JtYXRpb24odTMyKS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVs
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5c2ZzLmMgfCA1NyArKysrKysr
KysrKysrKysrLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMjkgaW5zZXJ0aW9ucygr
KSwgMjggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9zeXNmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCmluZGV4IDAzNGI4
YWJjNTA2Mi4uMWUwOGM1OTYxNTM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3N5c2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCkBAIC0x
NDQsMTIgKzE0NCwxMiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGF0dHJpYnV0ZV9ncm91cCBtZWRp
YV9yYzZfYXR0cl9ncm91cCA9IHsKIH07CiAjZW5kaWYKIAotc3RhdGljIGludCBsM19hY2Nlc3Nf
dmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBsb2ZmX3Qgb2Zmc2V0KQor
c3RhdGljIGludCBsM19hY2Nlc3NfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IGxvZmZfdCBvZmZzZXQpCiB7Ci0JaWYgKCFIQVNfTDNfRFBGKGRldl9wcml2KSkKKwlpZiAoIUhB
U19MM19EUEYoaTkxNSkpCiAJCXJldHVybiAtRVBFUk07CiAKLQlpZiAob2Zmc2V0ICUgNCAhPSAw
KQorCWlmICghSVNfQUxJR05FRChvZmZzZXQsIHNpemVvZih1MzIpKSkKIAkJcmV0dXJuIC1FSU5W
QUw7CiAKIAlpZiAob2Zmc2V0ID49IEdFTjdfTDNMT0dfU0laRSkKQEAgLTE2NCwzMSArMTY0LDI4
IEBAIGk5MTVfbDNfcmVhZChzdHJ1Y3QgZmlsZSAqZmlscCwgc3RydWN0IGtvYmplY3QgKmtvYmos
CiAJICAgICBsb2ZmX3Qgb2Zmc2V0LCBzaXplX3QgY291bnQpCiB7CiAJc3RydWN0IGRldmljZSAq
a2RldiA9IGtvYmpfdG9fZGV2KGtvYmopOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBrZGV2
X21pbm9yX3RvX2k5MTUoa2Rldik7CiAJaW50IHNsaWNlID0gKGludCkodWludHB0cl90KWF0dHIt
PnByaXZhdGU7CiAJaW50IHJldDsKIAotCWNvdW50ID0gcm91bmRfZG93bihjb3VudCwgNCk7Ci0K
LQlyZXQgPSBsM19hY2Nlc3NfdmFsaWQoZGV2X3ByaXYsIG9mZnNldCk7CisJcmV0ID0gbDNfYWNj
ZXNzX3ZhbGlkKGk5MTUsIG9mZnNldCk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAorCWNv
dW50ID0gcm91bmRfZG93bihjb3VudCwgc2l6ZW9mKHUzMikpOwogCWNvdW50ID0gbWluX3Qoc2l6
ZV90LCBHRU43X0wzTE9HX1NJWkUgLSBvZmZzZXQsIGNvdW50KTsKKwltZW1zZXQoYnVmLCAwLCBj
b3VudCk7CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOworCXJl
dCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0pOwogCWlmIChyZXQp
CiAJCXJldHVybiByZXQ7CiAKLQlpZiAoZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3Ns
aWNlXSkKKwlpZiAoaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdKQogCQltZW1jcHko
YnVmLAotCQkgICAgICAgZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSArIChv
ZmZzZXQvNCksCisJCSAgICAgICBpOTE1LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0gKyBv
ZmZzZXQgLyBzaXplb2YodTMyKSwKIAkJICAgICAgIGNvdW50KTsKLQllbHNlCi0JCW1lbXNldChi
dWYsIDAsIGNvdW50KTsKIAotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gY291bnQ7CiB9
CkBAIC0xOTksMjIgKzE5NiwyNCBAQCBpOTE1X2wzX3dyaXRlKHN0cnVjdCBmaWxlICpmaWxwLCBz
dHJ1Y3Qga29iamVjdCAqa29iaiwKIAkgICAgICBsb2ZmX3Qgb2Zmc2V0LCBzaXplX3QgY291bnQp
CiB7CiAJc3RydWN0IGRldmljZSAqa2RldiA9IGtvYmpfdG9fZGV2KGtvYmopOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKLQlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlu
b3JfdG9faTkxNShrZGV2KTsKIAlpbnQgc2xpY2UgPSAoaW50KSh1aW50cHRyX3QpYXR0ci0+cHJp
dmF0ZTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCXUzMiAqKnJlbWFwX2luZm87
CiAJaW50IHJldDsKIAotCXJldCA9IGwzX2FjY2Vzc192YWxpZChkZXZfcHJpdiwgb2Zmc2V0KTsK
KwlyZXQgPSBsM19hY2Nlc3NfdmFsaWQoaTkxNSwgb2Zmc2V0KTsKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKKwlp
ZiAoY291bnQgPCBzaXplb2YodTMyKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlyZXQgPSBpOTE1
X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtKTsKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCi0JcmVtYXBfaW5mbyA9ICZkZXZfcHJpdi0+bDNfcGFyaXR5LnJlbWFwX2luZm9b
c2xpY2VdOworCXJlbWFwX2luZm8gPSAmaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2Vd
OwogCWlmICghKnJlbWFwX2luZm8pIHsKIAkJKnJlbWFwX2luZm8gPSBremFsbG9jKEdFTjdfTDNM
T0dfU0laRSwgR0ZQX0tFUk5FTCk7CiAJCWlmICghKnJlbWFwX2luZm8pIHsKQEAgLTIyMywyMCAr
MjIyLDIyIEBAIGk5MTVfbDNfd3JpdGUoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0
ICprb2JqLAogCQl9CiAJfQogCi0JLyogVE9ETzogSWRlYWxseSB3ZSByZWFsbHkgd2FudCBhIEdQ
VSByZXNldCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJvcnMKKwljb3VudCA9IHJvdW5kX2Rvd24oY291
bnQsIHNpemVvZih1MzIpKTsKKwltZW1jcHkoKnJlbWFwX2luZm8gKyBvZmZzZXQgLyBzaXplb2Yo
dTMyKSwgYnVmLCBjb3VudCk7CisKKwkvKiBOQjogV2UgZGVmZXIgdGhlIHJlbWFwcGluZyB1bnRp
bCB3ZSBzd2l0Y2ggdG8gdGhlIGNvbnRleHQgKi8KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwg
Jmk5MTUtPmNvbnRleHRzLmxpc3QsIGxpbmspCisJCWN0eC0+cmVtYXBfc2xpY2UgfD0gQklUKHNs
aWNlKTsKKworCS8qCisJICogVE9ETzogSWRlYWxseSB3ZSByZWFsbHkgd2FudCBhIEdQVSByZXNl
dCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJvcnMKIAkgKiBhcmVuJ3QgcHJvcGFnYXRlZC4gU2luY2Ug
SSBjYW5ub3QgZmluZCBhIHN0YWJsZSB3YXkgdG8gcmVzZXQgdGhlIEdQVQogCSAqIGF0IHRoaXMg
cG9pbnQgaXQgaXMgbGVmdCBhcyBhIFRPRE8uCiAJKi8KLQltZW1jcHkoKnJlbWFwX2luZm8gKyAo
b2Zmc2V0LzQpLCBidWYsIGNvdW50KTsKLQotCS8qIE5COiBXZSBkZWZlciB0aGUgcmVtYXBwaW5n
IHVudGlsIHdlIHN3aXRjaCB0byB0aGUgY29udGV4dCAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnko
Y3R4LCAmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QsIGxpbmspCi0JCWN0eC0+cmVtYXBfc2xpY2Ug
fD0gKDE8PHNsaWNlKTsKIAogCXJldCA9IGNvdW50OwotCiBvdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZk
ZXYtPnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAogCXJldHVybiByZXQ7CiB9Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

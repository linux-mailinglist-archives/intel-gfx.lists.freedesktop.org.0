Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C198FA2F91
	for <lists+intel-gfx@lfdr.de>; Fri, 30 Aug 2019 08:14:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 196346E278;
	Fri, 30 Aug 2019 06:14:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B24CF6E266
 for <intel-gfx@lists.freedesktop.org>; Fri, 30 Aug 2019 06:13:54 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18312344-1500050 
 for multiple; Fri, 30 Aug 2019 07:12:08 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 30 Aug 2019 07:12:00 +0100
Message-Id: <20190830061204.21206-17-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190830061204.21206-1-chris@chris-wilson.co.uk>
References: <20190830061204.21206-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 17/21] drm/i915: Drop struct_mutex from around
 i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZG9uJ3QgbmVlZCB0byBob2xkIHN0cnVjdF9tdXRleCBub3cgZm9yIHJldGlyaW5nIHJlcXVl
c3RzLCBzbyBkcm9wIGl0CmZyb20gaTkxNV9yZXRpcmVfcmVxdWVzdHMoKSBhbmQgaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZSgpLCBmaW5hbGx5CnJlbW92aW5nIEk5MTVfV0FJVF9MT0NLRUQgZm9yIGdv
b2QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgICAgfCAg
IDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8ICAy
MCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8ICA0
NSArKystLS0tCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jICAg
fCAgNDAgKysrLS0tCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0
LmMgfCAgIDQgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyAg
ICB8ICAgNiArLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMg
IHwgICA0IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyAgICB8
ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwg
IDg5ICsrKy0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5j
ICAgICAgICB8ICAyMSArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVs
aW5lLmMgICB8ICA5MSArKysrKystLS0tLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X3dvcmthcm91bmRzLmMgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jICAgICAgICAgICB8ICA0MiArKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtLmMgICAgICAgICAgICAgICB8ICAxOSArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cmVxdWVzdC5oICAgICAgICAgICB8ICAgNyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfYWN0aXZlLmMgIHwgICA4ICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2dlbV9ldmljdC5jICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2dlbV9ndHQuYyB8ICAgNCAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9yZXF1ZXN0LmMgfCAxMjUgKysrKystLS0tLS0tLS0tLS0tCiAuLi4vZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jICAgICB8ICAgNCAtCiAuLi4vZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jICAgfCAgMzAgKystLS0KIC4uLi9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmggICB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jICAgIHwgICA5ICstCiAuLi4vZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAgIDQgLQogMjUgZmlsZXMgY2hhbmdlZCwgMTkx
IGluc2VydGlvbnMoKyksIDQxMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwppbmRleCBhY2U1MGJiOWVlMWYuLmNmMjA1N2U1
MTVhZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVu
dF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jCkBAIC0xNjYsNyArMTY2LDYgQEAgc3RhdGljIGludCBtb3ZlX3RvX2FjdGl2ZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiBzdGF0aWMgdm9pZCBjbGVh
cl9wYWdlc193b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewogCXN0cnVjdCBjbGVh
cl9wYWdlc193b3JrICp3ID0gY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqdyksIHdvcmspOwot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdy0+Y2UtPmVuZ2luZS0+aTkxNTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdy0+c2xlZXZlLT52bWEtPm9iajsKIAlz
dHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHctPnNsZWV2ZS0+dm1hOwogCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxOwpAQCAtMTg0LDExICsxODMsOSBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3Jr
ZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCW9iai0+cmVhZF9kb21haW5zID0gSTkxNV9H
RU1fR1BVX0RPTUFJTlM7CiAJb2JqLT53cml0ZV9kb21haW4gPSAwOwogCi0JLyogWFhYOiB3ZSBu
ZWVkIHRvIGtpbGwgdGhpcyAqLwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKIAlpZiAodW5saWtl
bHkoZXJyKSkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9zaWduYWw7CiAKIAliYXRj
aCA9IGludGVsX2VtaXRfdm1hX2ZpbGxfYmx0KHctPmNlLCB2bWEsIHctPnZhbHVlKTsKIAlpZiAo
SVNfRVJSKGJhdGNoKSkgewpAQCAtMjQwLDggKzIzNyw2IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3Bh
Z2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJaW50ZWxfZW1pdF92bWFfcmVs
ZWFzZSh3LT5jZSwgYmF0Y2gpOwogb3V0X3VucGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7Ci1v
dXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRf
c2lnbmFsOgogCWlmICh1bmxpa2VseShlcnIpKSB7CiAJCWRtYV9mZW5jZV9zZXRfZXJyb3IoJnct
PmRtYSwgZXJyKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
CmluZGV4IGQzY2U4YjViY2NjNS4uYmRiZWQwNzVjMjFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTExNjEsOCArMTE2MSw3IEBAIGdlbjhfbW9k
aWZ5X3JwY3Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1
KQogfQogCiBzdGF0aWMgaW50Ci1fX2ludGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UsCi0JCQkJIHN0cnVjdCBpbnRlbF9zc2V1IHNzZXUpCitpbnRl
bF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1
Y3QgaW50ZWxfc3NldSBzc2V1KQogewogCWludCByZXQ7CiAKQEAgLTExODUsMjMgKzExODQsNiBA
QCBfX2ludGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIGludAotaW50ZWxfY29udGV4dF9yZWNvbmZp
Z3VyZV9zc2V1KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3Nl
dSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGNlLT5lbmdpbmUtPmk5MTU7
Ci0JaW50IHJldDsKLQotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IF9faW50
ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KGNlLCBzc2V1KTsKLQotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCiBzdGF0aWMgaW50
CiB1c2VyX3RvX2NvbnRleHRfc3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
ICAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW1fc3NldSAqdXNlciwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggNmU0Y2MxNzdjYzdhLi5m
ZWMwYjQxMGQxZDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC00
OCwxMSArNDgsNyBAQCBzdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd29yaykKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNvbnRh
aW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBnZW0ucmV0aXJlX3dvcmsud29yayk7CiAKLQkv
KiBDb21lIGJhY2sgbGF0ZXIgaWYgdGhlIGRldmljZSBpcyBidXN5Li4uICovCi0JaWYgKG11dGV4
X3RyeWxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpKSB7Ci0JCWk5MTVfcmV0aXJlX3JlcXVl
c3RzKGk5MTUpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCX0K
KwlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKIAogCXF1ZXVlX2RlbGF5ZWRfd29yayhpOTE1
LT53cSwKIAkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCkBAIC04NiwyNiArODIsMjMgQEAg
c3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoc3RydWN0IGludGVsX2d0
ICpndCkKIHsKIAlib29sIHJlc3VsdCA9ICFpbnRlbF9ndF9pc193ZWRnZWQoZ3QpOwogCi0JZG8g
ewotCQlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShndC0+aTkxNSwKLQkJCQkJICAgSTkxNV9X
QUlUX0xPQ0tFRCB8Ci0JCQkJCSAgIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCwKLQkJCQkJICAg
STkxNV9HRU1fSURMRV9USU1FT1VUKSA9PSAtRVRJTUUpIHsKLQkJCS8qIFhYWCBoaWRlIHdhcm5p
bmcgZnJvbSBnZW1fZWlvICovCi0JCQlpZiAoaTkxNV9tb2RwYXJhbXMucmVzZXQpIHsKLQkJCQlk
ZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LAotCQkJCQkiRmFpbGVkIHRvIGlkbGUgZW5naW5lcywg
ZGVjbGFyaW5nIHdlZGdlZCFcbiIpOwotCQkJCUdFTV9UUkFDRV9EVU1QKCk7Ci0JCQl9Ci0KLQkJ
CS8qCi0JCQkgKiBGb3JjaWJseSBjYW5jZWwgb3V0c3RhbmRpbmcgd29yayBhbmQgbGVhdmUKLQkJ
CSAqIHRoZSBncHUgcXVpZXQuCi0JCQkgKi8KLQkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwot
CQkJcmVzdWx0ID0gZmFsc2U7CisJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUs
CisJCQkJICAgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NULAorCQkJCSAgIEk5MTVfR0VNX0lETEVf
VElNRU9VVCkgPT0gLUVUSU1FKSB7CisJCS8qIFhYWCBoaWRlIHdhcm5pbmcgZnJvbSBnZW1fZWlv
ICovCisJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCkgeworCQkJZGV2X2VycihndC0+aTkxNS0+
ZHJtLmRldiwKKwkJCQkiRmFpbGVkIHRvIGlkbGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdlZCFc
biIpOworCQkJR0VNX1RSQUNFX0RVTVAoKTsKIAkJfQotCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3Jl
cXVlc3RzKGd0LT5pOTE1KSAmJiByZXN1bHQpOworCisJCS8qCisJCSAqIEZvcmNpYmx5IGNhbmNl
bCBvdXRzdGFuZGluZyB3b3JrIGFuZCBsZWF2ZQorCQkgKiB0aGUgZ3B1IHF1aWV0LgorCQkgKi8K
KwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJCXJlc3VsdCA9IGZhbHNlOworCX0KIAogCWlm
IChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KSkKIAkJcmVzdWx0ID0gZmFsc2U7CkBAIC0x
MjUsOCArMTE4LDYgQEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogCWludGVsX3dha2VyZWZfYXV0bygmaTkxNS0+Z2d0dC51c2VyZmF1bHRfd2Fr
ZXJlZiwgMCk7CiAJZmx1c2hfd29ya3F1ZXVlKGk5MTUtPndxKTsKIAotCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJLyoKIAkgKiBXZSBoYXZlIHRvIGZsdXNoIGFsbCB0
aGUgZXhlY3V0aW5nIGNvbnRleHRzIHRvIG1haW4gbWVtb3J5IHNvCiAJICogdGhhdCB0aGV5IGNh
biBzYXZlZCBpbiB0aGUgaGliZXJuYXRpb24gaW1hZ2UuIFRvIGVuc3VyZSB0aGUgbGFzdApAQCAt
MTM4LDggKzEyOSw2IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAkgKi8KIAlzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYygmaTkxNS0+
Z3QpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWNhbmNl
bF9kZWxheWVkX3dvcmtfc3luYygmaTkxNS0+Z3QuaGFuZ2NoZWNrLndvcmspOwogCiAJaTkxNV9n
ZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jCmluZGV4IDBmZjdhODlh
YWRjYS4uNTQ5ODEwZjcwYWViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKQEAgLTcsNiArNyw3IEBACiAjaW5j
bHVkZSA8bGludXgvcHJpbWVfbnVtYmVycy5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIK
KyNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgogCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5o
IgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgpAQCAtNzgsNyArNzksNyBAQCBz
dGF0aWMgaW50IGd0dF9zZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIHsKIAlz
dHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1MzIgX19pb21lbSAqbWFwOwotCWludCBlcnI7CisJaW50
IGVyciA9IDA7CiAKIAlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwogCWVyciA9IGk5MTVfZ2Vt
X29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOwpAQCAtOTAsMTUgKzkxLDIxIEBA
IHN0YXRpYyBpbnQgZ3R0X3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWlm
IChJU19FUlIodm1hKSkKIAkJcmV0dXJuIFBUUl9FUlIodm1hKTsKIAorCWludGVsX2d0X3BtX2dl
dCh2bWEtPnZtLT5ndCk7CisKIAltYXAgPSBpOTE1X3ZtYV9waW5faW9tYXAodm1hKTsKIAlpOTE1
X3ZtYV91bnBpbih2bWEpOwotCWlmIChJU19FUlIobWFwKSkKLQkJcmV0dXJuIFBUUl9FUlIobWFw
KTsKKwlpZiAoSVNfRVJSKG1hcCkpIHsKKwkJZXJyID0gUFRSX0VSUihtYXApOworCQlnb3RvIG91
dF9ycG07CisJfQogCiAJaW93cml0ZTMyKHYsICZtYXBbb2Zmc2V0IC8gc2l6ZW9mKCptYXApXSk7
CiAJaTkxNV92bWFfdW5waW5faW9tYXAodm1hKTsKIAotCXJldHVybiAwOworb3V0X3JwbToKKwlp
bnRlbF9ndF9wbV9wdXQodm1hLT52bS0+Z3QpOworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyBp
bnQgZ3R0X2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLApAQCAtMTA3LDcgKzEx
NCw3IEBAIHN0YXRpYyBpbnQgZ3R0X2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUzMiBfX2lvbWVtICptYXA7Ci0JaW50IGVy
cjsKKwlpbnQgZXJyID0gMDsKIAogCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJZXJyID0g
aTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgZmFsc2UpOwpAQCAtMTE5LDE1
ICsxMjYsMjEgQEAgc3RhdGljIGludCBndHRfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCisJaW50
ZWxfZ3RfcG1fZ2V0KHZtYS0+dm0tPmd0KTsKKwogCW1hcCA9IGk5MTVfdm1hX3Bpbl9pb21hcCh2
bWEpOwogCWk5MTVfdm1hX3VucGluKHZtYSk7Ci0JaWYgKElTX0VSUihtYXApKQotCQlyZXR1cm4g
UFRSX0VSUihtYXApOworCWlmIChJU19FUlIobWFwKSkgeworCQllcnIgPSBQVFJfRVJSKG1hcCk7
CisJCWdvdG8gb3V0X3JwbTsKKwl9CiAKIAkqdiA9IGlvcmVhZDMyKCZtYXBbb2Zmc2V0IC8gc2l6
ZW9mKCptYXApXSk7CiAJaTkxNV92bWFfdW5waW5faW9tYXAodm1hKTsKIAotCXJldHVybiAwOwor
b3V0X3JwbToKKwlpbnRlbF9ndF9wbV9wdXQodm1hLT52bS0+Z3QpOworCXJldHVybiBlcnI7CiB9
CiAKIHN0YXRpYyBpbnQgd2Nfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCkBA
IC0yODAsNyArMjkzLDYgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2NvaGVyZW5jeSh2b2lkICphcmcp
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJY29uc3Qgc3RydWN0IGln
dF9jb2hlcmVuY3lfbW9kZSAqcmVhZCwgKndyaXRlLCAqb3ZlcjsKIAlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXVuc2lnbmVkIGxv
bmcgY291bnQsIG47CiAJdTMyICpvZmZzZXRzLCAqdmFsdWVzOwogCWludCBlcnIgPSAwOwpAQCAt
Mjk5LDggKzMxMSw2IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9jb2hlcmVuY3kodm9pZCAqYXJnKQog
CiAJdmFsdWVzID0gb2Zmc2V0cyArIG5jYWNoZWxpbmVzOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1
LT5ydW50aW1lX3BtKTsKIAlmb3IgKG92ZXIgPSBpZ3RfY29oZXJlbmN5X21vZGU7IG92ZXItPm5h
bWU7IG92ZXIrKykgewogCQlpZiAoIW92ZXItPnNldCkKIAkJCWNvbnRpbnVlOwpAQCAtMzI2LDcg
KzMzNiw3IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9jb2hlcmVuY3kodm9pZCAqYXJnKQogCQkJCQlv
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7CiAJ
CQkJCWlmIChJU19FUlIob2JqKSkgewogCQkJCQkJZXJyID0gUFRSX0VSUihvYmopOwotCQkJCQkJ
Z290byB1bmxvY2s7CisJCQkJCQlnb3RvIGZyZWU7CiAJCQkJCX0KIAogCQkJCQlpOTE1X3JhbmRv
bV9yZW9yZGVyKG9mZnNldHMsIG5jYWNoZWxpbmVzLCAmcHJuZyk7CkBAIC0zNzcsMTUgKzM4Nywx
MyBAQCBzdGF0aWMgaW50IGlndF9nZW1fY29oZXJlbmN5KHZvaWQgKmFyZykKIAkJCX0KIAkJfQog
CX0KLXVubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2Fr
ZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKK2ZyZWU6CiAJ
a2ZyZWUob2Zmc2V0cyk7CiAJcmV0dXJuIGVycjsKIAogcHV0X29iamVjdDoKIAlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7Ci0JZ290byB1bmxvY2s7CisJZ290byBmcmVlOwogfQogCiBpbnQgaTkx
NV9nZW1fY29oZXJlbmN5X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX2NvbnRleHQuYwppbmRleCBhYTY3YzAyYmE5OGMuLmI4N2UzNWE3MTNiOCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0
LmMKQEAgLTk0OSw3ICs5NDksNyBAQCBfX3NzZXVfdGVzdChjb25zdCBjaGFyICpuYW1lLAogCWlm
IChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBfX2ludGVsX2NvbnRleHRfcmVjb25maWd1
cmVfc3NldShjZSwgc3NldSk7CisJcmV0ID0gaW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1
KGNlLCBzc2V1KTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF9zcGluOwogCkBAIC0xMDUzLDcgKzEw
NTMsNyBAQCBfX2lndF9jdHhfc3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
Z290byBvdXRfZmFpbDsKIAogb3V0X2ZhaWw6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5
MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJcmV0ID0gLUVJ
TzsKIAogCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwppbmRleCA5YzIxN2RmZTk2YTkuLjM5
YzAxYmM0ZWI1MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTM5MywxMiArMzkzLDggQEAgc3RhdGljIHZvaWQgZGlzYWJs
ZV9yZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBzdGF0aWMg
dm9pZCByZXN0b3JlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiB7CisJaWd0X2ZsdXNoX3Rlc3QoaTkxNSk7CiAJaW50ZWxfZ3RfcG1fcHV0KCZpOTE1LT5ndCk7
Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZ3RfZmx1c2hfdGVz
dChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJpdmVyX3JlZ2lzdGVyX19zaHJpbmtlcihpOTE1KTsK
IH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9vYmplY3RfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5
MTVfZ2VtX29iamVjdF9ibHQuYwppbmRleCBjMjFkNzQ3ZTdkMDUuLjllYzU1YjNhMzgxNSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmpl
Y3RfYmx0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9vYmplY3RfYmx0LmMKQEAgLTY1LDkgKzY1LDcgQEAgc3RhdGljIGludCBpZ3RfZmlsbF9ibHQo
dm9pZCAqYXJnKQogCQlpZiAoIShvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9D
T0hFUkVOVF9GT1JfV1JJVEUpKQogCQkJb2JqLT5jYWNoZV9kaXJ0eSA9IHRydWU7CiAKLQkJbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX29iamVj
dF9maWxsX2JsdChvYmosIGNlLCB2YWwpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCQlpZiAoZXJyKQogCQkJZ290byBlcnJfdW5waW47CiAKQEAgLTE2Niw5ICsx
NjQsNyBAQCBzdGF0aWMgaW50IGlndF9jb3B5X2JsdCh2b2lkICphcmcpCiAJCWlmICghKGRzdC0+
Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkpCiAJCQlk
c3QtPmNhY2hlX2RpcnR5ID0gdHJ1ZTsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2NvcHlfYmx0KHNyYywgZHN0LCBjZSk7
Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmIChlcnIpCiAJ
CQlnb3RvIGVycl91bnBpbjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29u
dGV4dC5jCmluZGV4IDE0MjA1MzNlOGZkNS4uODgzNzM5MzU0YjA3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCkBAIC0zMTIsNyArMzEyLDcgQEAgc3RhdGlj
IGludCBsaXZlX2FjdGl2ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJCWJyZWFr
OwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsK
KwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7
CiAJfQpAQCAtNDI1LDcgKzQyNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2
b2lkICphcmcpCiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVz
dChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0
LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggZTUzZWVhMTA1MGY4Li5mYzRkMDI0MDY1
MzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVj
ay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCkBA
IC01OCw3ICs1OCw5IEBAIHN0YXRpYyBpbnQgaGFuZ19pbml0KHN0cnVjdCBoYW5nICpoLCBzdHJ1
Y3QgaW50ZWxfZ3QgKmd0KQogCW1lbXNldChoLCAwLCBzaXplb2YoKmgpKTsKIAloLT5ndCA9IGd0
OwogCisJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWgtPmN0eCA9
IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAlpZiAoSVNfRVJSKGgtPmN0eCkpCiAJCXJldHVybiBQVFJfRVJSKGgt
PmN0eCk7CiAKQEAgLTI4NSw3ICsyODcsNyBAQCBzdGF0aWMgdm9pZCBoYW5nX2Zpbmkoc3RydWN0
IGhhbmcgKmgpCiAKIAlrZXJuZWxfY29udGV4dF9jbG9zZShoLT5jdHgpOwogCi0JaWd0X2ZsdXNo
X3Rlc3QoaC0+Z3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCWlndF9mbHVzaF90ZXN0KGgt
Pmd0LT5pOTE1KTsKIH0KIAogc3RhdGljIGJvb2wgd2FpdF91bnRpbF9ydW5uaW5nKHN0cnVjdCBo
YW5nICpoLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKQEAgLTMwOSwxMCArMzExLDkgQEAgc3Rh
dGljIGludCBpZ3RfaGFuZ19zYW5pdHljaGVjayh2b2lkICphcmcpCiAKIAkvKiBCYXNpYyBjaGVj
ayB0aGF0IHdlIGNhbiBleGVjdXRlIG91ciBoYW5naW5nIGJhdGNoICovCiAKLQltdXRleF9sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaGFuZ19pbml0KCZoLCBndCk7
CiAJaWYgKGVycikKLQkJZ290byB1bmxvY2s7CisJCXJldHVybiBlcnI7CiAKIAlmb3JfZWFjaF9l
bmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJc3RydWN0IGludGVsX3dlZGdlX21lIHc7
CkBAIC0zNTUsOCArMzU2LDYgQEAgc3RhdGljIGludCBpZ3RfaGFuZ19zYW5pdHljaGVjayh2b2lk
ICphcmcpCiAKIGZpbmk6CiAJaGFuZ19maW5pKCZoKTsKLXVubG9jazoKLQltdXRleF91bmxvY2so
Jmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zOTUs
OCArMzk0LDYgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAlyZXNldF9j
b3VudCA9IGk5MTVfcmVzZXRfY291bnQoZ2xvYmFsKTsKIAljb3VudCA9IDA7CiAJZG8gewotCQlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAkJZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCQlpbnQgaTsKIApAQCAtNDE3LDcgKzQxNCw2
IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJCWludGVsX2d0X3Jlc2V0
KGd0LCBBTExfRU5HSU5FUywgTlVMTCk7CiAJCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsK
IAotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGlu
dGVsX2d0X2lzX3dlZGdlZChndCkpIHsKIAkJCWVyciA9IC1FSU87CiAJCQlicmVhazsKQEAgLTQy
OSwxNiArNDI1LDEzIEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJCQli
cmVhazsKIAkJfQogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKKwkJZXJy
ID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfSB3
aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3RpbWUpKTsKIAlwcl9pbmZvKCIlczogJWQg
cmVzZXRzXG4iLCBfX2Z1bmNfXywgY291bnQpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dB
SVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQorCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJl
ZShndC0+aTkxNSwgZmlsZSk7CiAJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCkBAIC00OTQs
NyArNDg3LDYgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJ
CQkJYnJlYWs7CiAJCQl9CiAKLQkJCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAkJCWZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAJCQkJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CiAKQEAgLTUwNyw3ICs0OTksNiBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3Bf
ZW5naW5lKHZvaWQgKmFyZykKIAkJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJCX0KIAkJCWVy
ciA9IGludGVsX2VuZ2luZV9yZXNldChlbmdpbmUsIE5VTEwpOwotCQkJbXV0ZXhfdW5sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCJp
OTE1X3Jlc2V0X2VuZ2luZSBmYWlsZWRcbiIpOwogCQkJCWJyZWFrOwpAQCAtNTMzLDE1ICs1MjQs
MTIgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJCWlmIChl
cnIpCiAJCQlicmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgMCk7CisJ
CWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwog
CX0KIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQllcnIgPSBp
Z3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KKwllcnIgPSBpZ3RfZmx1c2hfdGVzdChn
dC0+aTkxNSk7CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwogCWlmIChp
bnRlbF9ndF9pc193ZWRnZWQoZ3QpKQpAQCAtNTYzLDkgKzU1MSw3IEBAIHN0YXRpYyBpbnQgX19p
Z3RfcmVzZXRfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgYWN0aXZlKQogCQlyZXR1
cm4gMDsKIAogCWlmIChhY3RpdmUpIHsKLQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCQllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKLQkJbXV0ZXhfdW5sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOwog
CX0KQEAgLTU5MywxNyArNTc5LDE0IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lKHN0
cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgYWN0aXZlKQogCQkJaWYgKGFjdGl2ZSkgewogCQkJCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCi0JCQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCQkJCXJxID0gaGFuZ19jcmVhdGVfcmVxdWVzdCgmaCwgZW5naW5lKTsK
IAkJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCQkJbXV0
ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQkJCWJyZWFrOwogCQkJ
CX0KIAogCQkJCWk5MTVfcmVxdWVzdF9nZXQocnEpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQocnEp
OwotCQkJCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJCQkJ
aWYgKCF3YWl0X3VudGlsX3J1bm5pbmcoJmgsIHJxKSkgewogCQkJCQlzdHJ1Y3QgZHJtX3ByaW50
ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOwpAQCAtNjQ3LDcgKzYz
MCw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
IGJvb2wgYWN0aXZlKQogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKLQkJZXJyID0gaWd0X2ZsdXNo
X3Rlc3QoZ3QtPmk5MTUsIDApOworCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7CiAJ
CWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBAIC02NTUsMTEgKzYzOCw4IEBAIHN0YXRpYyBpbnQg
X19pZ3RfcmVzZXRfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgYWN0aXZlKQogCWlm
IChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQogCQllcnIgPSAtRUlPOwogCi0JaWYgKGFjdGl2ZSkg
ewotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaWYgKGFjdGl2
ZSkKIAkJaGFuZ19maW5pKCZoKTsKLQkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0JfQogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTc0MSwxMCArNzIxLDggQEAgc3Rh
dGljIGludCBhY3RpdmVfZW5naW5lKHZvaWQgKmRhdGEpCiAJCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
Km9sZCA9IHJxW2lkeF07CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKm5ldzsKIAotCQltdXRleF9s
b2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQluZXcgPSBpZ3RfcmVxdWVz
dF9hbGxvYyhjdHhbaWR4XSwgZW5naW5lKTsKIAkJaWYgKElTX0VSUihuZXcpKSB7Ci0JCQltdXRl
eF91bmxvY2soJmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQllcnIgPSBQVFJf
RVJSKG5ldyk7CiAJCQlicmVhazsKIAkJfQpAQCAtNzU1LDcgKzczMyw2IEBAIHN0YXRpYyBpbnQg
YWN0aXZlX2VuZ2luZSh2b2lkICpkYXRhKQogCiAJCXJxW2lkeF0gPSBpOTE1X3JlcXVlc3RfZ2V0
KG5ldyk7CiAJCWk5MTVfcmVxdWVzdF9hZGQobmV3KTsKLQkJbXV0ZXhfdW5sb2NrKCZlbmdpbmUt
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJCWVyciA9IGFjdGl2ZV9yZXF1ZXN0X3B1dChv
bGQpOwogCQlpZiAoZXJyKQpAQCAtNzk1LDkgKzc3Miw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVz
ZXRfZW5naW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQlyZXR1cm4gMDsKIAogCWlmIChmbGFn
cyAmIFRFU1RfQUNUSVZFKSB7Ci0JCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAkJZXJyID0gaGFuZ19pbml0KCZoLCBndCk7Ci0JCW11dGV4X3VubG9jaygmZ3QtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVycjsKIApAQCAt
ODU1LDE3ICs4MzAsMTQgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsCiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IE5VTEw7CiAKIAkJCWlm
IChmbGFncyAmIFRFU1RfQUNUSVZFKSB7Ci0JCQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCQkJCXJxID0gaGFuZ19jcmVhdGVfcmVxdWVzdCgmaCwgZW5naW5lKTsK
IAkJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCQkJbXV0
ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQkJCWJyZWFrOwogCQkJ
CX0KIAogCQkJCWk5MTVfcmVxdWVzdF9nZXQocnEpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQocnEp
OwotCQkJCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJCQkJ
aWYgKCF3YWl0X3VudGlsX3J1bm5pbmcoJmgsIHJxKSkgewogCQkJCQlzdHJ1Y3QgZHJtX3ByaW50
ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOwpAQCAtOTc3LDkgKzk0
OSw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0
LAogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKLQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCk7Ci0JCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsK
IAl9CkBAIC05ODcsMTEgKzk1Nyw4IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQogCQllcnIg
PSAtRUlPOwogCi0JaWYgKGZsYWdzICYgVEVTVF9BQ1RJVkUpIHsKLQkJbXV0ZXhfbG9jaygmZ3Qt
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlmIChmbGFncyAmIFRFU1RfQUNUSVZFKQogCQlo
YW5nX2ZpbmkoJmgpOwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQl9CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTA2MSw3ICsxMDI4LDYgQEAgc3RhdGljIGlu
dCBpZ3RfcmVzZXRfd2FpdCh2b2lkICphcmcpCiAKIAlpZ3RfZ2xvYmFsX3Jlc2V0X2xvY2soZ3Qp
OwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IGhh
bmdfaW5pdCgmaCwgZ3QpOwogCWlmIChlcnIpCiAJCWdvdG8gdW5sb2NrOwpAQCAtMTEwOSw3ICsx
MDc1LDYgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfd2FpdCh2b2lkICphcmcpCiBmaW5pOgogCWhh
bmdfZmluaSgmaCk7CiB1bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOwogCiAJaWYgKGludGVsX2d0
X2lzX3dlZGdlZChndCkpCkBAIC0xMTg5LDEwICsxMTU0LDkgQEAgc3RhdGljIGludCBfX2lndF9y
ZXNldF9ldmljdF92bWEoc3RydWN0IGludGVsX2d0ICpndCwKIAogCS8qIENoZWNrIHRoYXQgd2Ug
Y2FuIHJlY292ZXIgYW4gdW5iaW5kIHN0dWNrIG9uIGEgaGFuZ2luZyByZXF1ZXN0ICovCiAKLQlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaGFuZ19pbml0
KCZoLCBndCk7CiAJaWYgKGVycikKLQkJZ290byB1bmxvY2s7CisJCXJldHVybiBlcnI7CiAKIAlv
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGd0LT5pOTE1LCBTWl8xTSk7CiAJ
aWYgKElTX0VSUihvYmopKSB7CkBAIC0xMjU1LDggKzEyMTksNiBAQCBzdGF0aWMgaW50IF9faWd0
X3Jlc2V0X2V2aWN0X3ZtYShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWlmIChlcnIpCiAJCWdvdG8g
b3V0X3JxOwogCi0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlpZiAoIXdhaXRfdW50aWxfcnVubmluZygmaCwgcnEpKSB7CiAJCXN0cnVjdCBkcm1fcHJpbnRl
ciBwID0gZHJtX2luZm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CiAKQEAgLTEzMDUsMTYg
KzEyNjcsMTIgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9ldmljdF92bWEoc3RydWN0IGludGVs
X2d0ICpndCwKIAkJcHV0X3Rhc2tfc3RydWN0KHRzayk7CiAJfQogCi0JbXV0ZXhfbG9jaygmZ3Qt
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0X3JxOgogCWk5MTVfcmVxdWVzdF9wdXQocnEp
Owogb3V0X29iajoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiBmaW5pOgogCWhhbmdfZmlu
aSgmaCk7Ci11bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKIAkJcmV0dXJuIC1FSU87CiAKQEAg
LTEzOTYsNyArMTM1NCw2IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X3F1ZXVlKHZvaWQgKmFyZykK
IAogCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaGFuZ19pbml0KCZoLCBndCk7CiAJaWYgKGVycikK
IAkJZ290byB1bmxvY2s7CkBAIC0xNTExLDcgKzE0NjgsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNl
dF9xdWV1ZSh2b2lkICphcmcpCiAKIAkJaTkxNV9yZXF1ZXN0X3B1dChwcmV2KTsKIAotCQllcnIg
PSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJCWVyciA9IGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTE1
MTksNyArMTQ3Niw2IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X3F1ZXVlKHZvaWQgKmFyZykKIGZp
bmk6CiAJaGFuZ19maW5pKCZoKTsKIHVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhndCk7CiAKIAlpZiAo
aW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKQEAgLTE1NDYsMTEgKzE1MDIsOSBAQCBzdGF0aWMgaW50
IGlndF9oYW5kbGVfZXJyb3Iodm9pZCAqYXJnKQogCWlmICghZW5naW5lIHx8ICFpbnRlbF9lbmdp
bmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygm
Z3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZXJyID0gaGFuZ19pbml0KCZoLCBndCk7
CiAJaWYgKGVycikKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gZXJyOwogCiAJcnEgPSBo
YW5nX2NyZWF0ZV9yZXF1ZXN0KCZoLCBlbmdpbmUpOwogCWlmIChJU19FUlIocnEpKSB7CkBAIC0x
NTc0LDggKzE1MjgsNiBAQCBzdGF0aWMgaW50IGlndF9oYW5kbGVfZXJyb3Iodm9pZCAqYXJnKQog
CQlnb3RvIGVycl9yZXF1ZXN0OwogCX0KIAotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCiAJLyogVGVtcG9yYXJpbHkgZGlzYWJsZSBlcnJvciBjYXB0dXJlICov
CiAJZXJyb3IgPSB4Y2hnKCZnbG9iYWwtPmZpcnN0X2Vycm9yLCAodm9pZCAqKS0xKTsKIApAQCAt
MTU4Myw4ICsxNTM1LDYgQEAgc3RhdGljIGludCBpZ3RfaGFuZGxlX2Vycm9yKHZvaWQgKmFyZykK
IAogCXhjaGcoJmdsb2JhbC0+Zmlyc3RfZXJyb3IsIGVycm9yKTsKIAotCW11dGV4X2xvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmIChycS0+ZmVuY2UuZXJyb3IgIT0gLUVJ
TykgewogCQlwcl9lcnIoIkd1aWx0eSByZXF1ZXN0IG5vdCBpZGVudGlmaWVkIVxuIik7CiAJCWVy
ciA9IC1FSU5WQUw7CkBAIC0xNTk1LDggKzE1NDUsNiBAQCBzdGF0aWMgaW50IGlndF9oYW5kbGVf
ZXJyb3Iodm9pZCAqYXJnKQogCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogZXJyX2Zpbmk6CiAJaGFu
Z19maW5pKCZoKTsKLWVycl91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTY4OSw3ICsxNjM3LDYgQEAgc3Rh
dGljIGludCBpZ3RfcmVzZXRfZW5naW5lc19hdG9taWModm9pZCAqYXJnKQogCQlyZXR1cm4gMDsK
IAogCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7Ci0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCiAJLyogRmx1c2ggYW55IHJlcXVlc3RzIGJlZm9yZSB3ZSBnZXQg
c3RhcnRlZCBhbmQgY2hlY2sgYmFzaWNzICovCiAJaWYgKCFpZ3RfZm9yY2VfcmVzZXQoZ3QpKQpA
QCAtMTcwOSw5ICsxNjU2LDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfZW5naW5lc19hdG9taWMo
dm9pZCAqYXJnKQogb3V0OgogCS8qIEFzIHdlIHBva2UgYXJvdW5kIHRoZSBndXRzLCBkbyBhIGZ1
bGwgcmVzZXQgYmVmb3JlIGNvbnRpbnVpbmcuICovCiAJaWd0X2ZvcmNlX3Jlc2V0KGd0KTsKLQog
dW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWln
dF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKIAogCXJldHVybiBlcnI7CkBAIC0xNzUxLDEwICsx
Njk2LDYgQEAgaW50IGludGVsX2hhbmdjaGVja19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAogCWVyciA9IGludGVsX2d0X2xpdmVfc3VidGVzdHModGVzdHMs
IGd0KTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZ3Rf
Zmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X21vZHBhcmFtcy5lbmFibGVfaGFu
Z2NoZWNrID0gc2F2ZWRfaGFuZ2NoZWNrOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZndC0+aTkx
NS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMKaW5kZXggYWNhMWIzYTljNWRlLi4yMjJhNzM3NWM3ODcgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC02MSw3ICs2MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9z
YW5pdHljaGVjayh2b2lkICphcmcpCiAJCX0KIAogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwot
CQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpIHsKKwkJaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4Owog
CQl9CkBAIC0yMDYsOCArMjA2LDcgQEAgc2xpY2Vfc2VtYXBob3JlX3F1ZXVlKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKm91dGVyLAogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCi0JaWYgKGk5MTVf
cmVxdWVzdF93YWl0KGhlYWQsCi0JCQkgICAgICBJOTE1X1dBSVRfTE9DS0VELAorCWlmIChpOTE1
X3JlcXVlc3Rfd2FpdChoZWFkLCAwLAogCQkJICAgICAgMiAqIFJVTlRJTUVfSU5GTyhvdXRlci0+
aTkxNSktPm51bV9lbmdpbmVzICogKGNvdW50ICsgMikgKiAoY291bnQgKyAzKSkgPCAwKSB7CiAJ
CXByX2VycigiRmFpbGVkIHRvIHNsaWNlIGFsb25nIHNlbWFwaG9yZSBjaGFpbiBvZiBsZW5ndGgg
KCVkLCAlZCkhXG4iLAogCQkgICAgICAgY291bnQsIG4pOwpAQCAtMjc5LDcgKzI3OCw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAJCQlpZiAoZXJyKQog
CQkJCWdvdG8gZXJyX3BpbjsKIAotCQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJ
VF9MT0NLRUQpKSB7CisJCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpIHsKIAkJCQllcnIgPSAt
RUlPOwogCQkJCWdvdG8gZXJyX3BpbjsKIAkJCX0KQEAgLTgzMiw3ICs4MzEsNyBAQCBzdGF0aWMg
aW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAkJfQog
Ci0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwkJaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUpKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCX0KIApAQCAtOTQ4LDcg
Kzk0Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJn
KQogCQkJZ290byBlcnJfY2xpZW50X2I7CiAJCX0KIAotCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkx
NSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJCWdv
dG8gZXJyX3dlZGdlZDsKIAl9CiAKQEAgLTExMDksNyArMTEwOCw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9zdXBwcmVzc193YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQkJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUoY2xpZW50KTsgaSsrKQogCQkJCWlndF9zcGlubmVyX2VuZCgmY2xpZW50W2ldLnNw
aW4pOwogCi0JCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJ
CQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCQkJZ290byBlcnJfd2VkZ2VkOwogCiAJCQlp
ZiAoZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50KSB7CkBAIC0xMzg4LDcgKzEz
ODcsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAogCQlpZ3Rf
c3Bpbm5lcl9lbmQoJnNwaW5faGkpOwogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5fbG8pOwotCQlp
ZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpIHsKKwkJaWYgKGlndF9m
bHVzaF90ZXN0KGk5MTUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4X2xvOwog
CQl9CkBAIC0xNzg1LDcgKzE3ODQsNyBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJcHJpbWUsIGRpdjY0X3U2NChrdGltZV90
b19ucyh0aW1lc1sxXSksIHByaW1lKSk7CiAKIG91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkx
NSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIg
PSAtRUlPOwogCiAJZm9yIChuYyA9IDA7IG5jIDwgbmN0eDsgbmMrKykgewpAQCAtMTkzMCw3ICsx
OTI5LDcgQEAgc3RhdGljIGludCBtYXNrX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQlnb3RvIG91dDsKIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChp
OTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVy
ciA9IC1FSU87CiAKIAlmb3IgKG4gPSAwOyBuIDwgbnNpYmxpbmc7IG4rKykKQEAgLTIxMDgsNyAr
MjEwNyw3IEBAIHN0YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIG91dDoKIAlmb3IgKG4gPSAwOyAhSVNfRVJSKHJxW25dKTsgbisrKQog
CQlpOTE1X3JlcXVlc3RfcHV0KHJxW25dKTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkx
NV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlP
OwogCiAJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF90aW1lbGluZS5jCmluZGV4IDMyMTQ4MTQwMzE2NS4uMTZhYmZhYmYwOGM3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKQEAgLTYsNyAr
Niw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9wcmltZV9udW1iZXJzLmg+CiAKLSNpbmNsdWRlICJn
ZW0vaTkxNV9nZW1fcG0uaCIKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRl
ICJpbnRlbF9ndC5oIgogCiAjaW5jbHVkZSAiLi4vc2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgiCkBA
IC0xMzYsNyArMTM2LDYgQEAgc3RhdGljIGludCBtb2NrX2h3c3BfZnJlZWxpc3Qodm9pZCAqYXJn
KQogCQlnb3RvIGVycl9wdXQ7CiAJfQogCi0JbXV0ZXhfbG9jaygmc3RhdGUuaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJZm9yIChwID0gcGhhc2VzOyBwLT5uYW1lOyBwKyspIHsKIAkJcHJfZGVi
dWcoIiVzKCVzKVxuIiwgX19mdW5jX18sIHAtPm5hbWUpOwogCQlmb3JfZWFjaF9wcmltZV9udW1i
ZXJfZnJvbShuYSwgMSwgMiAqIENBQ0hFTElORVNfUEVSX1BBR0UpIHsKQEAgLTE0OSw3ICsxNDgs
NiBAQCBzdGF0aWMgaW50IG1vY2tfaHdzcF9mcmVlbGlzdCh2b2lkICphcmcpCiBvdXQ6CiAJZm9y
IChuYSA9IDA7IG5hIDwgc3RhdGUubWF4OyBuYSsrKQogCQlfX21vY2tfaHdzcF9yZWNvcmQoJnN0
YXRlLCBuYSwgTlVMTCk7Ci0JbXV0ZXhfdW5sb2NrKCZzdGF0ZS5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAlrZnJlZShzdGF0ZS5oaXN0b3J5KTsKIGVycl9wdXQ6CiAJZHJtX2Rldl9wdXQoJnN0
YXRlLmk5MTUtPmRybSk7CkBAIC00NDksOCArNDQ3LDYgQEAgdGxfd3JpdGUoc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1MzIgdmFsdWUp
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJaW50IGVycjsKIAotCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJnRsLT5ndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7IC8qIGxhenkgcnEgcmVmcyAq
LwotCiAJZXJyID0gaW50ZWxfdGltZWxpbmVfcGluKHRsKTsKIAlpZiAoZXJyKSB7CiAJCXJxID0g
RVJSX1BUUihlcnIpOwpAQCAtNDYxLDEwICs0NTcsMTQgQEAgdGxfd3JpdGUoc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1MzIgdmFsdWUp
CiAJaWYgKElTX0VSUihycSkpCiAJCWdvdG8gb3V0X3VucGluOwogCisJaTkxNV9yZXF1ZXN0X2dl
dChycSk7CisKIAllcnIgPSBlbWl0X2dndHRfc3RvcmVfZHcocnEsIHRsLT5od3NwX29mZnNldCwg
dmFsdWUpOwogCWk5MTVfcmVxdWVzdF9hZGQocnEpOwotCWlmIChlcnIpCisJaWYgKGVycikgewor
CQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIAkJcnEgPSBFUlJfUFRSKGVycik7CisJfQogCiBvdXRf
dW5waW46CiAJaW50ZWxfdGltZWxpbmVfdW5waW4odGwpOwpAQCAtNTAwLDcgKzUwMCw2IEBAIHN0
YXRpYyBpbnQgbGl2ZV9od3NwX2VuZ2luZSh2b2lkICphcmcpCiAJc3RydWN0IGludGVsX3RpbWVs
aW5lICoqdGltZWxpbmVzOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1bnNpZ25l
ZCBsb25nIGNvdW50LCBuOwogCWludCBlcnIgPSAwOwogCkBAIC01MTUsMTQgKzUxNCwxMyBAQCBz
dGF0aWMgaW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJnKQogCWlmICghdGltZWxpbmVzKQog
CQlyZXR1cm4gLUVOT01FTTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0K
IAljb3VudCA9IDA7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJaWYg
KCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAor
CQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CisKIAkJZm9yIChuID0gMDsgbiA8IE5VTV9U
SU1FTElORVM7IG4rKykgewogCQkJc3RydWN0IGludGVsX3RpbWVsaW5lICp0bDsKIAkJCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtNTMwLDIyICs1MjgsMjYgQEAgc3RhdGljIGludCBsaXZl
X2h3c3BfZW5naW5lKHZvaWQgKmFyZykKIAkJCXRsID0gY2hlY2tlZF9pbnRlbF90aW1lbGluZV9j
cmVhdGUoaTkxNSk7CiAJCQlpZiAoSVNfRVJSKHRsKSkgewogCQkJCWVyciA9IFBUUl9FUlIodGwp
OwotCQkJCWdvdG8gb3V0OworCQkJCWJyZWFrOwogCQkJfQogCiAJCQlycSA9IHRsX3dyaXRlKHRs
LCBlbmdpbmUsIGNvdW50KTsKIAkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJaW50ZWxfdGltZWxp
bmVfcHV0KHRsKTsKIAkJCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCQlnb3RvIG91dDsKKwkJCQli
cmVhazsKIAkJCX0KIAogCQkJdGltZWxpbmVzW2NvdW50KytdID0gdGw7CisJCQlpOTE1X3JlcXVl
c3RfcHV0KHJxKTsKIAkJfQorCisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJaWYg
KGVycikKKwkJCWJyZWFrOwogCX0KIAotb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJ
OTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1F
SU87CiAKIAlmb3IgKG4gPSAwOyBuIDwgY291bnQ7IG4rKykgewpAQCAtNTU5LDExICs1NjEsNyBA
QCBzdGF0aWMgaW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJnKQogCQlpbnRlbF90aW1lbGlu
ZV9wdXQodGwpOwogCX0KIAotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJ
a3ZmcmVlKHRpbWVsaW5lcyk7Ci0KIAlyZXR1cm4gZXJyOwogI3VuZGVmIE5VTV9USU1FTElORVMK
IH0KQEAgLTU3NSw3ICs1NzMsNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5hdGUodm9p
ZCAqYXJnKQogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqKnRpbWVsaW5lczsKIAlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50ZWxf
d2FrZXJlZl90IHdha2VyZWY7CiAJdW5zaWduZWQgbG9uZyBjb3VudCwgbjsKIAlpbnQgZXJyID0g
MDsKIApAQCAtNTkxLDkgKzU4OCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2FsdGVybmF0ZSh2
b2lkICphcmcpCiAJaWYgKCF0aW1lbGluZXMpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWNvdW50ID0gMDsKIAlmb3IgKG4gPSAwOyBu
IDwgTlVNX1RJTUVMSU5FUzsgbisrKSB7CiAJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUs
IGlkKSB7CkBAIC02MDUsMTEgKzU5OSwxNCBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5h
dGUodm9pZCAqYXJnKQogCiAJCQl0bCA9IGNoZWNrZWRfaW50ZWxfdGltZWxpbmVfY3JlYXRlKGk5
MTUpOwogCQkJaWYgKElTX0VSUih0bCkpIHsKKwkJCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2lu
ZSk7CiAJCQkJZXJyID0gUFRSX0VSUih0bCk7CiAJCQkJZ290byBvdXQ7CiAJCQl9CiAKKwkJCWlu
dGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKIAkJCXJxID0gdGxfd3JpdGUodGwsIGVuZ2luZSwg
Y291bnQpOworCQkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQkJaWYgKElTX0VSUihy
cSkpIHsKIAkJCQlpbnRlbF90aW1lbGluZV9wdXQodGwpOwogCQkJCWVyciA9IFBUUl9FUlIocnEp
OwpAQCAtNjE3LDExICs2MTQsMTIgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfYWx0ZXJuYXRlKHZv
aWQgKmFyZykKIAkJCX0KIAogCQkJdGltZWxpbmVzW2NvdW50KytdID0gdGw7CisJCQlpOTE1X3Jl
cXVlc3RfcHV0KHJxKTsKIAkJfQogCX0KIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1
LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9
IC1FSU87CiAKIAlmb3IgKG4gPSAwOyBuIDwgY291bnQ7IG4rKykgewpAQCAtNjM1LDExICs2MzMs
NyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5hdGUodm9pZCAqYXJnKQogCQlpbnRlbF90
aW1lbGluZV9wdXQodGwpOwogCX0KIAotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50
aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJa3ZmcmVlKHRpbWVsaW5lcyk7Ci0KIAlyZXR1cm4gZXJyOwogI3VuZGVmIE5VTV9USU1F
TElORVMKIH0KQEAgLTY1MCw3ICs2NDQsNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZv
aWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVm
X3Qgd2FrZXJlZjsKIAlpbnQgZXJyID0gMDsKIAogCS8qCkBAIC02NTgsMTQgKzY1MSwxMCBAQCBz
dGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykKIAkgKiBmb3JlaWduIEdQVSByZWZl
cmVuY2VzLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCXRs
ID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKCZpOTE1LT5ndCwgTlVMTCk7Ci0JaWYgKElTX0VSUih0
bCkpIHsKLQkJZXJyID0gUFRSX0VSUih0bCk7Ci0JCWdvdG8gb3V0X3JwbTsKLQl9CisJaWYgKElT
X0VSUih0bCkpCisJCXJldHVybiBQVFJfRVJSKHRsKTsKKwogCWlmICghdGwtPmhhc19pbml0aWFs
X2JyZWFkY3J1bWIgfHwgIXRsLT5od3NwX2NhY2hlbGluZSkKIAkJZ290byBvdXRfZnJlZTsKIApA
QCAtNjgxLDcgKzY3MCw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQog
CQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVl
OwogCisJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKIAkJcnEgPSBpOTE1X3JlcXVlc3Rf
Y3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVu
Z2luZSk7CiAJCWlmIChJU19FUlIocnEpKSB7CiAJCQllcnIgPSBQVFJfRVJSKHJxKTsKIAkJCWdv
dG8gb3V0OwpAQCAtNzQ3LDE2ICs3MzgsMTIgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2
b2lkICphcmcpCiAJfQogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJ
VF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAog
CWludGVsX3RpbWVsaW5lX3VucGluKHRsKTsKIG91dF9mcmVlOgogCWludGVsX3RpbWVsaW5lX3B1
dCh0bCk7Ci1vdXRfcnBtOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJ
cmV0dXJuIGVycjsKIH0KIApAQCAtNzY1LDcgKzc1Miw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3Nw
X3JlY3ljbGUodm9pZCAqYXJnKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJn
OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9p
ZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1bnNpZ25lZCBsb25nIGNvdW50Owog
CWludCBlcnIgPSAwOwogCkBAIC03NzUsOSArNzYxLDYgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bf
cmVjeWNsZSh2b2lkICphcmcpCiAJICogd2FudCB0byBjb25mdXNlIG91cnNlbHZlcyBvciB0aGUg
R1BVLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2Fr
ZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWNvdW50
ID0gMDsKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQlJR1RfVElNRU9V
VChlbmRfdGltZSk7CkBAIC03ODUsNiArNzY4LDggQEAgc3RhdGljIGludCBsaXZlX2h3c3BfcmVj
eWNsZSh2b2lkICphcmcpCiAJCWlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdp
bmUpKQogCQkJY29udGludWU7CiAKKwkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOworCiAJ
CWRvIHsKIAkJCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGw7CiAJCQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKQEAgLTc5MiwyMSArNzc3LDIyIEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3JlY3lj
bGUodm9pZCAqYXJnKQogCQkJdGwgPSBjaGVja2VkX2ludGVsX3RpbWVsaW5lX2NyZWF0ZShpOTE1
KTsKIAkJCWlmIChJU19FUlIodGwpKSB7CiAJCQkJZXJyID0gUFRSX0VSUih0bCk7Ci0JCQkJZ290
byBvdXQ7CisJCQkJYnJlYWs7CiAJCQl9CiAKIAkJCXJxID0gdGxfd3JpdGUodGwsIGVuZ2luZSwg
Y291bnQpOwogCQkJaWYgKElTX0VSUihycSkpIHsKIAkJCQlpbnRlbF90aW1lbGluZV9wdXQodGwp
OwogCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCWdvdG8gb3V0OworCQkJCWJyZWFrOwogCQkJ
fQogCiAJCQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7CiAJCQkJ
cHJfZXJyKCJXYWl0IGZvciB0aW1lbGluZSB3cml0ZXMgdGltZWQgb3V0IVxuIik7CisJCQkJaTkx
NV9yZXF1ZXN0X3B1dChycSk7CiAJCQkJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKIAkJCQllcnIg
PSAtRUlPOwotCQkJCWdvdG8gb3V0OworCQkJCWJyZWFrOwogCQkJfQogCiAJCQlpZiAoKnRsLT5o
d3NwX3NlcW5vICE9IGNvdW50KSB7CkBAIC04MTUsMTcgKzgwMSwxOCBAQCBzdGF0aWMgaW50IGxp
dmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAkJCQllcnIgPSAtRUlOVkFMOwogCQkJfQogCisJ
CQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIAkJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJCQlj
b3VudCsrOwogCiAJCQlpZiAoZXJyKQotCQkJCWdvdG8gb3V0OworCQkJCWJyZWFrOwogCQl9IHdo
aWxlICghX19pZ3RfdGltZW91dChlbmRfdGltZSwgTlVMTCkpOwotCX0KIAotb3V0OgotCWludGVs
X3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2lu
ZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKwl9CiAKIAlyZXR1cm4gZXJyOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKaW5kZXggOTk5YTk4
ZjAwNDk0Li4wNjM1MWZlZmJiZjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3Rfd29ya2Fyb3VuZHMuYwpAQCAtNjc2LDcgKzY3Niw3IEBAIHN0YXRpYyBpbnQgY2hlY2tf
ZGlydHlfd2hpdGVsaXN0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQlicmVhazsK
IAl9CiAKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoY3R4LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkK
KwlpZiAoaWd0X2ZsdXNoX3Rlc3QoY3R4LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKIG91dF9iYXRj
aDoKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmYmF0Y2gsIDApOwpAQCAtMTA5MCw3ICsx
MDkwLDcgQEAgc3RhdGljIGludCBsaXZlX2lzb2xhdGVkX3doaXRlbGlzdCh2b2lkICphcmcpCiAJ
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGNsaWVudFtpXS5jdHgpOwogCX0KIAotCWlmIChpZ3RfZmx1
c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkx
NSkpCiAJCWVyciA9IC1FSU87CiAKIAlyZXR1cm4gZXJyOwpAQCAtMTI0OCw3ICsxMjQ4LDcgQEAg
bGl2ZV9lbmdpbmVfcmVzZXRfd29ya2Fyb3VuZHModm9pZCAqYXJnKQogCWlndF9nbG9iYWxfcmVz
ZXRfdW5sb2NrKCZpOTE1LT5ndCk7CiAJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAotCWln
dF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCWlndF9mbHVzaF90ZXN0KGk5
MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5k
ZXggMzBiMGI1OTJlMjBkLi41NWYwZmMwM2FhM2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCkBAIC0zNjAxLDYgKzM2MDEsNyBAQCBzdGF0aWMgaW50CiBpOTE1X2Ryb3BfY2FjaGVz
X3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gZGF0YTsKKwlpbnQgcmV0OwogCiAJRFJNX0RFQlVHKCJEcm9wcGluZyBjYWNoZXM6IDB4
JTA4bGx4IFsweCUwOGxseF1cbiIsCiAJCSAgdmFsLCB2YWwgJiBEUk9QX0FMTCk7CkBAIC0zNjEw
LDQwICszNjExLDIxIEBAIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwp
CiAJCSAgICAgSTkxNV9JRExFX0VOR0lORVNfVElNRU9VVCkpCiAJCWludGVsX2d0X3NldF93ZWRn
ZWQoJmk5MTUtPmd0KTsKIAotCS8qIE5vIG5lZWQgdG8gY2hlY2sgYW5kIHdhaXQgZm9yIGdwdSBy
ZXNldHMsIG9ubHkgbGliZHJtIGF1dG8tcmVzdGFydHMKLQkgKiBvbiBpb2N0bHMgb24gLUVBR0FJ
Ti4gKi8KLQlpZiAodmFsICYgKERST1BfQUNUSVZFIHwgRFJPUF9JRExFIHwgRFJPUF9SRVRJUkUg
fCBEUk9QX1JFU0VUX1NFUU5PKSkgewotCQlpbnQgcmV0OworCWlmICh2YWwgJiBEUk9QX1JFVElS
RSkKKwkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAKLQkJcmV0ID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpZiAodmFsICYgKERST1Bf
SURMRSB8IERST1BfQUNUSVZFKSkgeworCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5
MTUsCisJCQkJCSAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCisJCQkJCSAgICAgTUFYX1ND
SEVEVUxFX1RJTUVPVVQpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKKwl9CiAKLQkJLyoK
LQkJICogVG8gZmluaXNoIHRoZSBmbHVzaCBvZiB0aGUgaWRsZV93b3JrZXIsIHdlIG11c3QgY29t
cGxldGUKLQkJICogdGhlIHN3aXRjaC10by1rZXJuZWwtY29udGV4dCwgd2hpY2ggcmVxdWlyZXMg
YSBkb3VibGUKLQkJICogcGFzcyB0aHJvdWdoIHdhaXRfZm9yX2lkbGU6IGZpcnN0IHF1ZXVlcyB0
aGUgc3dpdGNoLAotCQkgKiBzZWNvbmQgd2FpdHMgZm9yIHRoZSBzd2l0Y2guCi0JCSAqLwotCQlp
ZiAocmV0ID09IDAgJiYgdmFsICYgKERST1BfSURMRSB8IERST1BfQUNUSVZFKSkKLQkJCXJldCA9
IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkJCSAgICAgSTkxNV9XQUlUX0lOVEVS
UlVQVElCTEUgfAotCQkJCQkJICAgICBJOTE1X1dBSVRfTE9DS0VELAotCQkJCQkJICAgICBNQVhf
U0NIRURVTEVfVElNRU9VVCk7Ci0KLQkJaWYgKHJldCA9PSAwICYmIHZhbCAmIERST1BfSURMRSkK
LQkJCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkJCSAgICAgSTkxNV9X
QUlUX0lOVEVSUlVQVElCTEUgfAotCQkJCQkJICAgICBJOTE1X1dBSVRfTE9DS0VELAotCQkJCQkJ
ICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0KLQkJaWYgKHZhbCAmIERST1BfUkVUSVJFKQot
CQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7Ci0KLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQotCQlpZiAocmV0ID09IDAgJiYgdmFsICYgRFJPUF9JRExFKQot
CQkJcmV0ID0gaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZSgmaTkxNS0+Z3QpOworCWlmICh2YWwg
JiBEUk9QX0lETEUpIHsKKwkJcmV0ID0gaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZSgmaTkxNS0+
Z3QpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKIAl9CiAKIAlpZiAodmFsICYgRFJPUF9S
RVNFVF9BQ1RJVkUgJiYgaW50ZWxfZ3RfdGVybWluYWxseV93ZWRnZWQoJmk5MTUtPmd0KSkKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGQyMTZkYmM0MDZmZC4uYWE2Y2Y1M2M0NDIxIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTk1MSwxOSArOTUxLDE2IEBAIGludCBpOTE1X2dlbV93
YWl0X2Zvcl9pZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlmICghaW50ZWxf
Z3RfcG1faXNfYXdha2UoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKLQlHRU1fVFJBQ0UoImZs
YWdzPSV4ICglcyksIHRpbWVvdXQ9JWxkJXNcbiIsCi0JCSAgZmxhZ3MsIGZsYWdzICYgSTkxNV9X
QUlUX0xPQ0tFRCA/ICJsb2NrZWQiIDogInVubG9ja2VkIiwKLQkJICB0aW1lb3V0LCB0aW1lb3V0
ID09IE1BWF9TQ0hFRFVMRV9USU1FT1VUID8gIiAoZm9yZXZlcikiIDogIiIpOwotCi0JdGltZW91
dCA9IHdhaXRfZm9yX3RpbWVsaW5lcyhpOTE1LCBmbGFncywgdGltZW91dCk7Ci0JaWYgKHRpbWVv
dXQgPCAwKQotCQlyZXR1cm4gdGltZW91dDsKKwlkbyB7CisJCXRpbWVvdXQgPSB3YWl0X2Zvcl90
aW1lbGluZXMoaTkxNSwgZmxhZ3MsIHRpbWVvdXQpOworCQlpZiAodGltZW91dCA8IDApCisJCQly
ZXR1cm4gdGltZW91dDsKIAotCWlmIChmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQpIHsKLQkJbG9j
a2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWNvbmRfcmVzY2hl
ZCgpOworCQlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVudCkpCisJCQlyZXR1cm4gLUVJTlRSOwog
Ci0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwotCX0KKwl9IHdoaWxlIChpOTE1X3JldGly
ZV9yZXF1ZXN0cyhpOTE1KSk7CiAKIAlyZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmgKaW5kZXggMzI1MWQyYmRiZWVhLi41N2EyMTkzYzY0ZDEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcmVxdWVzdC5oCkBAIC0zMDgsMTAgKzMwOCw5IEBAIGxvbmcgaTkxNV9yZXF1ZXN0
X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJCSAgICAgICBsb25nIHRpbWVvdXQpCiAJ
X19hdHRyaWJ1dGVfXygobm9ubnVsbCgxKSkpOwogI2RlZmluZSBJOTE1X1dBSVRfSU5URVJSVVBU
SUJMRQlCSVQoMCkKLSNkZWZpbmUgSTkxNV9XQUlUX0xPQ0tFRAlCSVQoMSkgLyogc3RydWN0X211
dGV4IGhlbGQsIGhhbmRsZSBHUFUgcmVzZXQgKi8KLSNkZWZpbmUgSTkxNV9XQUlUX1BSSU9SSVRZ
CUJJVCgyKSAvKiBzbWFsbCBwcmlvcml0eSBidW1wIGZvciB0aGUgcmVxdWVzdCAqLwotI2RlZmlu
ZSBJOTE1X1dBSVRfQUxMCQlCSVQoMykgLyogdXNlZCBieSBpOTE1X2dlbV9vYmplY3Rfd2FpdCgp
ICovCi0jZGVmaW5lIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCBCSVQoNCkKKyNkZWZpbmUgSTkx
NV9XQUlUX1BSSU9SSVRZCUJJVCgxKSAvKiBzbWFsbCBwcmlvcml0eSBidW1wIGZvciB0aGUgcmVx
dWVzdCAqLworI2RlZmluZSBJOTE1X1dBSVRfQUxMCQlCSVQoMikgLyogdXNlZCBieSBpOTE1X2dl
bV9vYmplY3Rfd2FpdCgpICovCisjZGVmaW5lIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCBCSVQo
MykKIAogc3RhdGljIGlubGluZSBib29sIGk5MTVfcmVxdWVzdF9zaWduYWxlZChjb25zdCBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfYWN0aXZlLmMKaW5kZXggYWY1ODI3YWFjN2IyLi5mZjEzMzdlMzQ1MjIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCkBAIC0xNjQsMTAgKzE2
NCw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfd2FpdCh2b2lkICphcmcpCiAKIAlfX2xpdmVf
cHV0KGFjdGl2ZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlp
ZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTg1LDEwICsxODMsOCBAQCBzdGF0
aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICphcmcpCiAJCXJldHVybiBQVFJfRVJSKGFj
dGl2ZSk7CiAKIAkvKiB3YWl0cyBmb3IgJiByZXRpcmVzIGFsbCByZXF1ZXN0cyAqLwotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1
LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9
IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWlmICgh
UkVBRF9PTkNFKGFjdGl2ZS0+cmV0aXJlZCkpIHsKIAkJcHJfZXJyKCJpOTE1X2FjdGl2ZSBub3Qg
cmV0aXJlZCBhZnRlciBmbHVzaGluZyFcbiIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwppbmRleCBiYTYwNjQxNDcxNzMuLjQyMTM5ZGIwZDY5
YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2
aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0
LmMKQEAgLTUyMSw3ICs1MjEsNyBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lk
ICphcmcpCiAKIAltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6
Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3Rf
Zmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAl3aGlsZSAocmVzZXJ2ZWQpIHsKIAkJ
c3RydWN0IHJlc2VydmVkICpuZXh0ID0gcmVzZXJ2ZWQtPm5leHQ7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggNDIzNWZhNDAxOTU2Li43Mjlh
NTNlYjYyNDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1f
Z3R0LmMKQEAgLTE3MDksMTIgKzE3MDksOCBAQCBpbnQgaTkxNV9nZW1fZ3R0X21vY2tfc2VsZnRl
c3RzKHZvaWQpCiAKIAllcnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBnZ3R0KTsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCW1vY2tfZGV2aWNlX2ZsdXNoKGk5MTUp
OwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9k
cmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCiAJbW9ja19maW5pX2dndHQoZ2d0dCk7CiAJa2Zy
ZWUoZ2d0dCk7CiBvdXRfcHV0OgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcmVxdWVzdC5jCmluZGV4IGIzNjg4NTQzZWQ3ZC4uZDA0NjM5NTg0NWRhIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCkBAIC00MSwyMSArNDEs
MTYgQEAgc3RhdGljIGludCBpZ3RfYWRkX3JlcXVlc3Qodm9pZCAqYXJnKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVl
c3Q7Ci0JaW50IGVyciA9IC1FTk9NRU07CiAKIAkvKiBCYXNpYyBwcmVsaW1pbmFyeSB0ZXN0IHRv
IGNyZWF0ZSBhIHJlcXVlc3QgYW5kIGxldCBpdCBsb29zZSEgKi8KIAotCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJlcXVlc3QgPSBtb2NrX3JlcXVlc3QoaTkxNS0+ZW5n
aW5lW1JDUzBdLT5rZXJuZWxfY29udGV4dCwgSFogLyAxMCk7CiAJaWYgKCFyZXF1ZXN0KQotCQln
b3RvIG91dF91bmxvY2s7CisJCXJldHVybiAtRU5PTUVNOwogCiAJaTkxNV9yZXF1ZXN0X2FkZChy
ZXF1ZXN0KTsKIAotCWVyciA9IDA7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0JcmV0dXJuIGVycjsKKwlyZXR1cm4gMDsKIH0KIAogc3RhdGlj
IGludCBpZ3Rfd2FpdF9yZXF1ZXN0KHZvaWQgKmFyZykKQEAgLTY3LDEyICs2MiwxMCBAQCBzdGF0
aWMgaW50IGlndF93YWl0X3JlcXVlc3Qodm9pZCAqYXJnKQogCiAJLyogU3VibWl0IGEgcmVxdWVz
dCwgdGhlbiB3YWl0IHVwb24gaXQgKi8KIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCXJlcXVlc3QgPSBtb2NrX3JlcXVlc3QoaTkxNS0+ZW5naW5lW1JDUzBdLT5rZXJu
ZWxfY29udGV4dCwgVCk7Ci0JaWYgKCFyZXF1ZXN0KSB7Ci0JCWVyciA9IC1FTk9NRU07Ci0JCWdv
dG8gb3V0X3VubG9jazsKLQl9CisJaWYgKCFyZXF1ZXN0KQorCQlyZXR1cm4gLUVOT01FTTsKKwog
CWk5MTVfcmVxdWVzdF9nZXQocmVxdWVzdCk7CiAKIAlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocmVx
dWVzdCwgMCwgMCkgIT0gLUVUSU1FKSB7CkBAIC0xMjUsOSArMTE4LDcgQEAgc3RhdGljIGludCBp
Z3Rfd2FpdF9yZXF1ZXN0KHZvaWQgKmFyZykKIAllcnIgPSAwOwogb3V0X3JlcXVlc3Q6CiAJaTkx
NV9yZXF1ZXN0X3B1dChyZXF1ZXN0KTsKLW91dF91bmxvY2s6CiAJbW9ja19kZXZpY2VfZmx1c2go
aTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4g
ZXJyOwogfQogCkBAIC0xNDAsNTIgKzEzMSw0NSBAQCBzdGF0aWMgaW50IGlndF9mZW5jZV93YWl0
KHZvaWQgKmFyZykKIAogCS8qIFN1Ym1pdCBhIHJlcXVlc3QsIHRyZWF0IGl0IGFzIGEgZmVuY2Ug
YW5kIHdhaXQgdXBvbiBpdCAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJcmVxdWVzdCA9IG1vY2tfcmVxdWVzdChpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9j
b250ZXh0LCBUKTsKLQlpZiAoIXJlcXVlc3QpIHsKLQkJZXJyID0gLUVOT01FTTsKLQkJZ290byBv
dXRfbG9ja2VkOwotCX0KKwlpZiAoIXJlcXVlc3QpCisJCXJldHVybiAtRU5PTUVNOwogCiAJaWYg
KGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoJnJlcXVlc3QtPmZlbmNlLCBmYWxzZSwgVCkgIT0gLUVU
SU1FKSB7CiAJCXByX2VycigiZmVuY2Ugd2FpdCBzdWNjZXNzIGJlZm9yZSBzdWJtaXQgKGV4cGVj
dGVkIHRpbWVvdXQpIVxuIik7Ci0JCWdvdG8gb3V0X2xvY2tlZDsKKwkJZ290byBvdXQ7CiAJfQog
CiAJaTkxNV9yZXF1ZXN0X2FkZChyZXF1ZXN0KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKGRtYV9mZW5jZV9pc19zaWduYWxlZCgmcmVxdWVzdC0+ZmVu
Y2UpKSB7CiAJCXByX2VycigiZmVuY2Ugc2lnbmFsZWQgaW1tZWRpYXRlbHkhXG4iKTsKLQkJZ290
byBvdXRfZGV2aWNlOworCQlnb3RvIG91dDsKIAl9CiAKIAlpZiAoZG1hX2ZlbmNlX3dhaXRfdGlt
ZW91dCgmcmVxdWVzdC0+ZmVuY2UsIGZhbHNlLCBUIC8gMikgIT0gLUVUSU1FKSB7CiAJCXByX2Vy
cigiZmVuY2Ugd2FpdCBzdWNjZXNzIGFmdGVyIHN1Ym1pdCAoZXhwZWN0ZWQgdGltZW91dCkhXG4i
KTsKLQkJZ290byBvdXRfZGV2aWNlOworCQlnb3RvIG91dDsKIAl9CiAKIAlpZiAoZG1hX2ZlbmNl
X3dhaXRfdGltZW91dCgmcmVxdWVzdC0+ZmVuY2UsIGZhbHNlLCBUKSA8PSAwKSB7CiAJCXByX2Vy
cigiZmVuY2Ugd2FpdCB0aW1lZCBvdXQgKGV4cGVjdGVkIHN1Y2Nlc3MpIVxuIik7Ci0JCWdvdG8g
b3V0X2RldmljZTsKKwkJZ290byBvdXQ7CiAJfQogCiAJaWYgKCFkbWFfZmVuY2VfaXNfc2lnbmFs
ZWQoJnJlcXVlc3QtPmZlbmNlKSkgewogCQlwcl9lcnIoImZlbmNlIHVuc2lnbmFsZWQgYWZ0ZXIg
d2FpdGluZyFcbiIpOwotCQlnb3RvIG91dF9kZXZpY2U7CisJCWdvdG8gb3V0OwogCX0KIAogCWlm
IChkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KCZyZXF1ZXN0LT5mZW5jZSwgZmFsc2UsIFQpIDw9IDAp
IHsKIAkJcHJfZXJyKCJmZW5jZSB3YWl0IHRpbWVkIG91dCB3aGVuIGNvbXBsZXRlIChleHBlY3Rl
ZCBzdWNjZXNzKSFcbiIpOwotCQlnb3RvIG91dF9kZXZpY2U7CisJCWdvdG8gb3V0OwogCX0KIAog
CWVyciA9IDA7Ci1vdXRfZGV2aWNlOgotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotb3V0X2xvY2tlZDoKK291dDoKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAg
LTE5OSw2ICsxODMsOCBAQCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcp
CiAKIAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHhbMF0gPSBtb2Nr
X2NvbnRleHQoaTkxNSwgIkEiKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCiAJY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4WzBdLCBSQ1MwKTsK
IAlHRU1fQlVHX09OKElTX0VSUihjZSkpOwogCXJlcXVlc3QgPSBtb2NrX3JlcXVlc3QoY2UsIDIg
KiBIWik7CkBAIC0yMTEsNyArMTk3LDEwIEBAIHN0YXRpYyBpbnQgaWd0X3JlcXVlc3RfcmV3aW5k
KHZvaWQgKmFyZykKIAlpOTE1X3JlcXVlc3RfZ2V0KHJlcXVlc3QpOwogCWk5MTVfcmVxdWVzdF9h
ZGQocmVxdWVzdCk7CiAKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlj
dHhbMV0gPSBtb2NrX2NvbnRleHQoaTkxNSwgIkIiKTsKKwltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCiAJY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4
WzFdLCBSQ1MwKTsKIAlHRU1fQlVHX09OKElTX0VSUihjZSkpOwogCXZpcCA9IG1vY2tfcmVxdWVz
dChjZSwgMCk7CkBAIC0yMzMsNyArMjIyLDYgQEAgc3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdp
bmQodm9pZCAqYXJnKQogCXJlcXVlc3QtPmVuZ2luZS0+c3VibWl0X3JlcXVlc3QocmVxdWVzdCk7
CiAJcmN1X3JlYWRfdW5sb2NrKCk7CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCiAJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHZpcCwgMCwgSFopID09IC1FVElNRSkg
ewogCQlwcl9lcnIoInRpbWVkIG91dCB3YWl0aW5nIGZvciBoaWdoIHByaW9yaXR5IHJlcXVlc3Rc
biIpOwpAQCAtMjQ4LDE0ICsyMzYsMTIgQEAgc3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQo
dm9pZCAqYXJnKQogCWVyciA9IDA7CiBlcnI6CiAJaTkxNV9yZXF1ZXN0X3B1dCh2aXApOwotCW11
dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogZXJyX2NvbnRleHRfMToKIAltb2Nr
X2NvbnRleHRfY2xvc2UoY3R4WzFdKTsKIAlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOwogZXJy
X2NvbnRleHRfMDoKIAltb2NrX2NvbnRleHRfY2xvc2UoY3R4WzBdKTsKIAltb2NrX2RldmljZV9m
bHVzaChpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJl
dHVybiBlcnI7CiB9CiAKQEAgLTI4Miw3ICsyNjgsNiBAQCBfX2xpdmVfcmVxdWVzdF9hbGxvYyhz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiBzdGF0aWMgaW50IF9faWd0X2JyZWFkY3J1bWJzX3Nt
b2tldGVzdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IHNtb2tldGVzdCAqdCA9IGFyZzsKLQlzdHJ1
Y3QgbXV0ZXggKiBjb25zdCBCS0wgPSAmdC0+ZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4
OwogCWNvbnN0IHVuc2lnbmVkIGludCBtYXhfYmF0Y2ggPSBtaW4odC0+bmNvbnRleHRzLCB0LT5t
YXhfYmF0Y2gpIC0gMTsKIAljb25zdCB1bnNpZ25lZCBpbnQgdG90YWwgPSA0ICogdC0+bmNvbnRl
eHRzICsgMTsKIAl1bnNpZ25lZCBpbnQgbnVtX3dhaXRzID0gMCwgbnVtX2ZlbmNlcyA9IDA7CkBA
IC0zMzcsMTQgKzMyMiwxMSBAQCBzdGF0aWMgaW50IF9faWd0X2JyZWFkY3J1bWJzX3Ntb2tldGVz
dCh2b2lkICphcmcpCiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAkJCXN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZTsKIAotCQkJbXV0ZXhfbG9jayhCS0wpOwotCiAJCQljZSA9IGk5MTVfZ2Vt
X2NvbnRleHRfZ2V0X2VuZ2luZShjdHgsIHQtPmVuZ2luZS0+bGVnYWN5X2lkeCk7CiAJCQlHRU1f
QlVHX09OKElTX0VSUihjZSkpOwogCQkJcnEgPSB0LT5yZXF1ZXN0X2FsbG9jKGNlKTsKIAkJCWlu
dGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJCWlmIChJU19FUlIocnEpKSB7Ci0JCQkJbXV0ZXhfdW5s
b2NrKEJLTCk7CiAJCQkJZXJyID0gUFRSX0VSUihycSk7CiAJCQkJY291bnQgPSBuOwogCQkJCWJy
ZWFrOwpAQCAtMzU3LDggKzMzOSw2IEBAIHN0YXRpYyBpbnQgX19pZ3RfYnJlYWRjcnVtYnNfc21v
a2V0ZXN0KHZvaWQgKmFyZykKIAkJCXJlcXVlc3RzW25dID0gaTkxNV9yZXF1ZXN0X2dldChycSk7
CiAJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAotCQkJbXV0ZXhfdW5sb2NrKEJLTCk7Ci0KIAkJ
CWlmIChlcnIgPj0gMCkKIAkJCQllcnIgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X2RtYV9mZW5jZSh3
YWl0LAogCQkJCQkJCQkgICAgJnJxLT5mZW5jZSwKQEAgLTQ1NywxNSArNDM3LDE1IEBAIHN0YXRp
YyBpbnQgbW9ja19icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCQlnb3RvIG91dF90
aHJlYWRzOwogCX0KIAotCW11dGV4X2xvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAlmb3IgKG4gPSAwOyBuIDwgdC5uY29udGV4dHM7IG4rKykgeworCQltdXRleF9sb2Nr
KCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXQuY29udGV4dHNbbl0gPSBt
b2NrX2NvbnRleHQodC5lbmdpbmUtPmk5MTUsICJtb2NrIik7CisJCW11dGV4X3VubG9jaygmdC5l
bmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoIXQuY29udGV4dHNbbl0pIHsK
IAkJCXJldCA9IC1FTk9NRU07CiAJCQlnb3RvIG91dF9jb250ZXh0czsKIAkJfQogCX0KLQltdXRl
eF91bmxvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWZvciAobiA9
IDA7IG4gPCBuY3B1czsgbisrKSB7CiAJCXRocmVhZHNbbl0gPSBrdGhyZWFkX3J1bihfX2lndF9i
cmVhZGNydW1ic19zbW9rZXRlc3QsCkBAIC00OTUsMTggKzQ3NSwxNSBAQCBzdGF0aWMgaW50IG1v
Y2tfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIAkJYXRvbWljX2xvbmdfcmVhZCgm
dC5udW1fZmVuY2VzKSwKIAkJbmNwdXMpOwogCi0JbXV0ZXhfbG9jaygmdC5lbmdpbmUtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0X2NvbnRleHRzOgogCWZvciAobiA9IDA7IG4gPCB0Lm5j
b250ZXh0czsgbisrKSB7CiAJCWlmICghdC5jb250ZXh0c1tuXSkKIAkJCWJyZWFrOwogCQltb2Nr
X2NvbnRleHRfY2xvc2UodC5jb250ZXh0c1tuXSk7CiAJfQotCW11dGV4X3VubG9jaygmdC5lbmdp
bmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWtmcmVlKHQuY29udGV4dHMpOwogb3V0X3Ro
cmVhZHM6CiAJa2ZyZWUodGhyZWFkcyk7Ci0KIAlyZXR1cm4gcmV0OwogfQogCkBAIC01MzksNyAr
NTE2LDYgQEAgc3RhdGljIGludCBsaXZlX25vcF9yZXF1ZXN0KHZvaWQgKmFyZykKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGlndF9saXZlX3Rl
c3QgdDsKIAl1bnNpZ25lZCBpbnQgaWQ7CiAJaW50IGVyciA9IC1FTk9ERVY7CkBAIC01NDksOSAr
NTI1LDYgQEAgc3RhdGljIGludCBsaXZlX25vcF9yZXF1ZXN0KHZvaWQgKmFyZykKIAkgKiB0aGUg
b3ZlcmhlYWQgb2Ygc3VibWl0dGluZyByZXF1ZXN0cyB0byB0aGUgaGFyZHdhcmUuCiAJICovCiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgaTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCA9IE5VTEw7
CiAJCXVuc2lnbmVkIGxvbmcgbiwgcHJpbWU7CkBAIC01NjAsMTcgKzUzMywxNSBAQCBzdGF0aWMg
aW50IGxpdmVfbm9wX3JlcXVlc3Qodm9pZCAqYXJnKQogCiAJCWVyciA9IGlndF9saXZlX3Rlc3Rf
YmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpOwogCQlpZiAoZXJyKQotCQkJ
Z290byBvdXRfdW5sb2NrOworCQkJcmV0dXJuIGVycjsKIAogCQlmb3JfZWFjaF9wcmltZV9udW1i
ZXJfZnJvbShwcmltZSwgMSwgODE5MikgewogCQkJdGltZXNbMV0gPSBrdGltZV9nZXRfcmF3KCk7
CiAKIAkJCWZvciAobiA9IDA7IG4gPCBwcmltZTsgbisrKSB7CiAJCQkJcmVxdWVzdCA9IGk5MTVf
cmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7Ci0JCQkJaWYgKElTX0VSUihy
ZXF1ZXN0KSkgewotCQkJCQllcnIgPSBQVFJfRVJSKHJlcXVlc3QpOwotCQkJCQlnb3RvIG91dF91
bmxvY2s7Ci0JCQkJfQorCQkJCWlmIChJU19FUlIocmVxdWVzdCkpCisJCQkJCXJldHVybiBQVFJf
RVJSKHJlcXVlc3QpOwogCiAJCQkJLyogVGhpcyBzcGFjZSBpcyBsZWZ0IGludGVudGlvbmFsbHkg
YmxhbmsuCiAJCQkJICoKQEAgLTU5OSw3ICs1NzAsNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wX3Jl
cXVlc3Qodm9pZCAqYXJnKQogCiAJCWVyciA9IGlndF9saXZlX3Rlc3RfZW5kKCZ0KTsKIAkJaWYg
KGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCXJldHVybiBlcnI7CiAKIAkJcHJfaW5mbygi
UmVxdWVzdCBsYXRlbmNpZXMgb24gJXM6IDEgPSAlbGx1bnMsICVsdSA9ICVsbHVuc1xuIiwKIAkJ
CWVuZ2luZS0+bmFtZSwKQEAgLTYwNyw5ICs1NzgsNiBAQCBzdGF0aWMgaW50IGxpdmVfbm9wX3Jl
cXVlc3Qodm9pZCAqYXJnKQogCQkJcHJpbWUsIGRpdjY0X3U2NChrdGltZV90b19ucyh0aW1lc1sx
XSksIHByaW1lKSk7CiAJfQogCi1vdXRfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZp
OTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTY4MSw3ICs2NDksNiBAQCBzdGF0aWMg
aW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJc3RydWN0
IGk5MTVfdm1hICpiYXRjaDsKIAl1bnNpZ25lZCBpbnQgaWQ7CkBAIC02OTIsMTQgKzY1OSw5IEBA
IHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykKIAkgKiB0aGUgb3Zlcmhl
YWQgb2Ygc3VibWl0dGluZyByZXF1ZXN0cyB0byB0aGUgaGFyZHdhcmUuCiAJICovCiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJYmF0Y2ggPSBlbXB0eV9iYXRjaChpOTE1
KTsKLQlpZiAoSVNfRVJSKGJhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKLQkJZ290
byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGJhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIo
YmF0Y2gpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJSUdUX1RJ
TUVPVVQoZW5kX3RpbWUpOwpAQCAtNzUyLDkgKzcxNCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0
eV9yZXF1ZXN0KHZvaWQgKmFyZykKIG91dF9iYXRjaDoKIAlpOTE1X3ZtYV91bnBpbihiYXRjaCk7
CiAJaTkxNV92bWFfcHV0KGJhdGNoKTsKLW91dF91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9w
dXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtODM0LDcgKzc5Myw2IEBAIHN0
YXRpYyBpbnQgbGl2ZV9hbGxfZW5naW5lcyh2b2lkICphcmcpCiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3RbSTkxNV9OVU1fRU5HSU5FU107Ci0JaW50ZWxfd2Fr
ZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAlzdHJ1Y3QgaTkxNV92
bWEgKmJhdGNoOwogCXVuc2lnbmVkIGludCBpZDsKQEAgLTg0NSwxOCArODAzLDE1IEBAIHN0YXRp
YyBpbnQgbGl2ZV9hbGxfZW5naW5lcyh2b2lkICphcmcpCiAJICogYmxvY2sgZG9pbmcgc28sIGFu
ZCB0aGF0IHRoZXkgZG9uJ3QgY29tcGxldGUgdG9vIHNvb24uCiAJICovCiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwg
aTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQotCQlnb3RvIG91dF91bmxvY2s7CisJCXJl
dHVybiBlcnI7CiAKIAliYXRjaCA9IHJlY3Vyc2l2ZV9iYXRjaChpOTE1KTsKIAlpZiAoSVNfRVJS
KGJhdGNoKSkgewogCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKIAkJcHJfZXJyKCIlczogVW5hYmxl
IHRvIGNyZWF0ZSBiYXRjaCwgZXJyPSVkXG4iLCBfX2Z1bmNfXywgZXJyKTsKLQkJZ290byBvdXRf
dW5sb2NrOworCQlyZXR1cm4gZXJyOwogCX0KIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5
MTUsIGlkKSB7CkBAIC05MjYsOSArODgxLDYgQEAgc3RhdGljIGludCBsaXZlX2FsbF9lbmdpbmVz
KHZvaWQgKmFyZykKIAkJCWk5MTVfcmVxdWVzdF9wdXQocmVxdWVzdFtpZF0pOwogCWk5MTVfdm1h
X3VucGluKGJhdGNoKTsKIAlpOTE1X3ZtYV9wdXQoYmF0Y2gpOwotb3V0X3VubG9jazoKLQlpbnRl
bF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC05Mzgs
NyArODkwLDYgQEAgc3RhdGljIGludCBsaXZlX3NlcXVlbnRpYWxfZW5naW5lcyh2b2lkICphcmcp
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdFtJOTE1X05VTV9FTkdJTkVTXSA9IHt9Owog
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnByZXYgPSBOVUxMOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1Y3QgaWd0X2xpdmVf
dGVzdCB0OwogCXVuc2lnbmVkIGludCBpZDsKIAlpbnQgZXJyOwpAQCAtOTQ5LDEyICs5MDAsOSBA
QCBzdGF0aWMgaW50IGxpdmVfc2VxdWVudGlhbF9lbmdpbmVzKHZvaWQgKmFyZykKIAkgKiB0aGV5
IGFyZSBydW5uaW5nIG9uIGluZGVwZW5kZW50IGVuZ2luZXMuCiAJICovCiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwg
aTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQotCQlnb3RvIG91dF91bmxvY2s7CisJCXJl
dHVybiBlcnI7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQlzdHJ1
Y3QgaTkxNV92bWEgKmJhdGNoOwpAQCAtOTY0LDcgKzkxMiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9z
ZXF1ZW50aWFsX2VuZ2luZXModm9pZCAqYXJnKQogCQkJZXJyID0gUFRSX0VSUihiYXRjaCk7CiAJ
CQlwcl9lcnIoIiVzOiBVbmFibGUgdG8gY3JlYXRlIGJhdGNoIGZvciAlcywgZXJyPSVkXG4iLAog
CQkJICAgICAgIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUsIGVycik7Ci0JCQlnb3RvIG91dF91bmxv
Y2s7CisJCQlyZXR1cm4gZXJyOwogCQl9CiAKIAkJcmVxdWVzdFtpZF0gPSBpOTE1X3JlcXVlc3Rf
Y3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwpAQCAtMTA1Niw5ICsxMDA0LDYgQEAgc3Rh
dGljIGludCBsaXZlX3NlcXVlbnRpYWxfZW5naW5lcyh2b2lkICphcmcpCiAJCWk5MTVfdm1hX3B1
dChyZXF1ZXN0W2lkXS0+YmF0Y2gpOwogCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3RbaWRdKTsK
IAl9Ci1vdXRfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJl
dHVybiBlcnI7CiB9CiAKQEAgLTExNDksOSArMTA5NCwxMCBAQCBzdGF0aWMgaW50IGxpdmVfYnJl
YWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIAkJZ290byBvdXRfdGhyZWFkczsKIAl9CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmb3IgKG4gPSAwOyBuIDwg
dFswXS5uY29udGV4dHM7IG4rKykgeworCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAkJdFswXS5jb250ZXh0c1tuXSA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKKwkJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKCF0WzBdLmNvbnRl
eHRzW25dKSB7CiAJCQlyZXQgPSAtRU5PTUVNOwogCQkJZ290byBvdXRfY29udGV4dHM7CkBAIC0x
MTY4LDcgKzExMTQsNiBAQCBzdGF0aWMgaW50IGxpdmVfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZv
aWQgKmFyZykKIAkJdFtpZF0ubWF4X2JhdGNoID0gbWF4X2JhdGNoZXModFswXS5jb250ZXh0c1sw
XSwgZW5naW5lKTsKIAkJaWYgKHRbaWRdLm1heF9iYXRjaCA8IDApIHsKIAkJCXJldCA9IHRbaWRd
Lm1heF9iYXRjaDsKLQkJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
CQlnb3RvIG91dF9mbHVzaDsKIAkJfQogCQkvKiBPbmUgcmluZyBpbnRlcmxlYXZlZCBiZXR3ZWVu
IHJlcXVlc3RzIGZyb20gYWxsIGNwdXMgKi8KQEAgLTExODMsNyArMTEyOCw2IEBAIHN0YXRpYyBp
bnQgbGl2ZV9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCQkJCQkgICZ0W2lkXSwg
ImlndC8lZC4lZCIsIGlkLCBuKTsKIAkJCWlmIChJU19FUlIodHNrKSkgewogCQkJCXJldCA9IFBU
Ul9FUlIodHNrKTsKLQkJCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CQkJCWdvdG8gb3V0X2ZsdXNoOwogCQkJfQogCkBAIC0xMTkxLDcgKzExMzUsNiBAQCBzdGF0aWMg
aW50IGxpdmVfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIAkJCXRocmVhZHNbaWQg
KiBuY3B1cyArIG5dID0gdHNrOwogCQl9CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAKIAltc2xlZXAoamlmZmllc190b19tc2VjcyhpOTE1X3NlbGZ0ZXN0LnRp
bWVvdXRfamlmZmllcykpOwogCkBAIC0xMjE5LDEwICsxMTYyLDggQEAgc3RhdGljIGludCBsaXZl
X2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJcHJfaW5mbygiQ29tcGxldGVkICVs
dSB3YWl0cyBmb3IgJWx1IGZlbmNlcyBhY3Jvc3MgJWQgZW5naW5lcyBhbmQgJWQgY3B1c1xuIiwK
IAkJbnVtX3dhaXRzLCBudW1fZmVuY2VzLCBSVU5USU1FX0lORk8oaTkxNSktPm51bV9lbmdpbmVz
LCBuY3B1cyk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXQg
PSBpZ3RfbGl2ZV90ZXN0X2VuZCgmbGl2ZSkgPzogcmV0Owogb3V0X2NvbnRleHRzOgotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJa2ZyZWUodFswXS5jb250ZXh0cyk7
CiBvdXRfdGhyZWFkczoKIAlrZnJlZSh0aHJlYWRzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jCmluZGV4IDQzOGVhMGVhYTQxNi4uODI1YTgyODZj
YmU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxm
dGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0
LmMKQEAgLTI2MywxMCArMjYzLDggQEAgaW50IF9faTkxNV9saXZlX3RlYXJkb3duKGludCBlcnIs
IHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOwog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGlndF9mbHVzaF90
ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkK
IAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKIApAQCAtMjg0LDEwICsyODIs
OCBAQCBpbnQgX19pbnRlbF9ndF9saXZlX3RlYXJkb3duKGludCBlcnIsIHZvaWQgKmRhdGEpCiB7
CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGRhdGE7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dB
SVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQllcnIgPSAtRUlP
OwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaTkxNV9n
ZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhndC0+aTkxNSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfdm1hLmMKaW5kZXggZTBjYTEyYzE3YTdmLi42YzE3MDUwNThiOTMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCkBAIC04MzUsMTIgKzgz
NSw4IEBAIGludCBpOTE1X3ZtYV9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCiAJZXJyID0gaTkxNV9z
dWJ0ZXN0cyh0ZXN0cywgZ2d0dCk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsK
LQogCW1vY2tfZmluaV9nZ3R0KGdndHQpOwogCWtmcmVlKGdndHQpOwogb3V0X3B1dDoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKaW5kZXggZDNi
NWViNDAyZDMzLi4yYTVmYmU0NmVhOWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCkBAIC0xMiwzMSArMTIsMjUgQEAKIAogI2luY2x1ZGUg
ImlndF9mbHVzaF90ZXN0LmgiCiAKLWludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQgaW50IGZsYWdzKQoraW50IGlndF9mbHVzaF90ZXN0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWludCByZXQgPSBpbnRlbF9ndF9pc193
ZWRnZWQoJmk5MTUtPmd0KSA/IC1FSU8gOiAwOwotCWludCByZXBlYXQgPSAhIShmbGFncyAmIEk5
MTVfV0FJVF9MT0NLRUQpOwogCiAJY29uZF9yZXNjaGVkKCk7CiAKLQlkbyB7Ci0JCWlmIChpOTE1
X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIGZsYWdzLCBIWiAvIDUpID09IC1FVElNRSkgewotCQkJ
cHJfZXJyKCIlcFMgdGltZWQgb3V0LCBjYW5jZWxsaW5nIGFsbCBmdXJ0aGVyIHRlc3RpbmcuXG4i
LAotCQkJICAgICAgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7CisJaTkxNV9yZXRpcmVf
cmVxdWVzdHMoaTkxNSk7CisJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgMCwgSFog
LyA1KSA9PSAtRVRJTUUpIHsKKwkJcHJfZXJyKCIlcFMgdGltZWQgb3V0LCBjYW5jZWxsaW5nIGFs
bCBmdXJ0aGVyIHRlc3RpbmcuXG4iLAorCQkgICAgICAgX19idWlsdGluX3JldHVybl9hZGRyZXNz
KDApKTsKIAotCQkJR0VNX1RSQUNFKCIlcFMgdGltZWQgb3V0LlxuIiwKLQkJCQkgIF9fYnVpbHRp
bl9yZXR1cm5fYWRkcmVzcygwKSk7Ci0JCQlHRU1fVFJBQ0VfRFVNUCgpOworCQlHRU1fVFJBQ0Uo
IiVwUyB0aW1lZCBvdXQuXG4iLAorCQkJICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwor
CQlHRU1fVFJBQ0VfRFVNUCgpOwogCi0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7
Ci0JCQlyZXBlYXQgPSAwOwotCQkJcmV0ID0gLUVJTzsKLQkJfQotCi0JCS8qIEVuc3VyZSB3ZSBh
bHNvIGZsdXNoIGFmdGVyIHdlZGdpbmcuICovCi0JCWlmIChmbGFncyAmIEk5MTVfV0FJVF9MT0NL
RUQpCi0JCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKLQl9IHdoaWxlIChyZXBlYXQtLSk7
CisJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJcmV0ID0gLUVJTzsKKwl9CisJ
aTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAKIAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaAppbmRleCA2M2UwMDk5
MjdjNDMuLjc1NDFmYTc0ZTY0MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2lndF9mbHVzaF90ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9mbHVzaF90ZXN0LmgKQEAgLTksNiArOSw2IEBACiAKIHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlOwogCi1pbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsIHVuc2lnbmVkIGludCBmbGFncyk7CitpbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpOwogCiAjZW5kaWYgLyogSUdUX0ZMVVNIX1RFU1RfSCAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKaW5kZXggM2U5
MDI3NjFjZDE2Li4wNGE2Zjg4ZmRmNjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2lndF9saXZlX3Rlc3QuYwpAQCAtMTksMTUgKzE5LDEyIEBAIGludCBpZ3RfbGl2ZV90
ZXN0X2JlZ2luKHN0cnVjdCBpZ3RfbGl2ZV90ZXN0ICp0LAogCWVudW0gaW50ZWxfZW5naW5lX2lk
IGlkOwogCWludCBlcnI7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCXQtPmk5MTUgPSBpOTE1OwogCXQtPmZ1bmMgPSBmdW5jOwogCXQtPm5hbWUg
PSBuYW1lOwogCiAJZXJyID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJCSAgICAg
STkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAotCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKKwkJ
CQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAogCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJ
TUVPVVQpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCIlcyglcyk6IGZhaWxlZCB0byBpZGxlIGJl
Zm9yZSwgd2l0aCBlcnI9JWQhIiwKQEAgLTUwLDkgKzQ3LDcgQEAgaW50IGlndF9saXZlX3Rlc3Rf
ZW5kKHN0cnVjdCBpZ3RfbGl2ZV90ZXN0ICp0KQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5
MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJcmV0dXJuIC1F
SU87CiAKIAlpZiAodC0+cmVzZXRfZ2xvYmFsICE9IGk5MTVfcmVzZXRfY291bnQoJmk5MTUtPmdw
dV9lcnJvcikpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9t
b2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dl
bV9kZXZpY2UuYwppbmRleCAwMWE4OWMwNzFiZjUuLjE5NTYwMDZhMGQ1YiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtNDEsOCAr
NDEsNiBAQCB2b2lkIG1vY2tfZGV2aWNlX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2lu
ZV9pZCBpZDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJZG8gewogCQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJCW1vY2tf
ZW5naW5lX2ZsdXNoKGVuZ2luZSk7CkBAIC01NSw5ICs1Myw3IEBAIHN0YXRpYyB2b2lkIG1vY2tf
ZGV2aWNlX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZmx1c2hfd29yaygmaTkx
NS0+Z2VtLmlkbGVfd29yayk7CiAJaTkxNV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwotLSAK
Mi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

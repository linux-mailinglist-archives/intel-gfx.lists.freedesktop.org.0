Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C004A3B2D5
	for <lists+intel-gfx@lfdr.de>; Mon, 10 Jun 2019 12:17:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3F8E1890BB;
	Mon, 10 Jun 2019 10:17:45 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 60BE6890BB
 for <intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 10:17:44 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16850694-1500050 
 for <intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 11:17:40 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 10 Jun 2019 11:17:39 +0100
Message-Id: <20190610101739.16058-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915: Promote i915->mm.obj_lock to be irqsafe
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGludGVudCBpcyB0byBiZSBhYmxlIHRvIHVwZGF0ZSB0aGUgbW0ubGlzdHMgZnJvbSBpbnNp
ZGUgYW4gaXJxc29mZgpzZWN0aW9uIChlLmcuIGZyb20gYSBzb2Z0aXJxIHJjdSB3b3JrcXVldWUp
LCBlcmdvIHdlIG5lZWQgdG8gbWFrZSB0aGUKaTkxNS0+bW0ub2JqX2xvY2sgaXJxc2FmZS4KCkZp
eGVzOiAzYjRmYTk2NDBjY2QgKCJkcm0vaTkxNTogVHJhY2sgdGhlIHB1cmdlYWJsZSBvYmplY3Rz
IG9uIGEgc2VwYXJhdGUgZXZpY3Rpb24gbGlzdCIpCkJ1Z3ppbGxhOiBodHRwczovL2J1Z3MuZnJl
ZWRlc2t0b3Aub3JnL3Nob3dfYnVnLmNnaT9pZD0xMTA4NjkKU2lnbmVkLW9mZi1ieTogQ2hyaXMg
V2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBKb29uYXMgTGFodGluZW4gPGpv
b25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcu
d2lsbGlhbS5hdWxkQGdtYWlsLmNvbT4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhl
dy53aWxsaWFtLmF1bGRAZ21haWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9kb21haW4uYyAgIHwgMjMgKysrKysrKysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyAgIHwgMTUgKysrKysrKystLS0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMgICAgfCAxNiArKysrKysrKysr
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgfCAxNCAr
KysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyAg
IHwgIDUgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAg
IHwgMTAgKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAg
ICAgICB8ICA4ICsrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAgICAg
ICAgICAgIHwgMTcgKysrKysrKysrKy0tLS0tCiA4IGZpbGVzIGNoYW5nZWQsIDcwIGluc2VydGlv
bnMoKyksIDM4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9kb21haW4uYwppbmRleCBlNWRlYWU2MjY4MWYuLjMxOTI5MjIwYjkwZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpAQCAtNDc1LDE1ICs0NzUsMjAgQEAg
c3RhdGljIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCX0KIAltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0u
bXV0ZXgpOwogCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikgJiYKLQkg
ICAgb2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9XSUxMTkVFRCkgewotCQlzdHJ1Y3QgbGlzdF9o
ZWFkICpsaXN0OwotCi0JCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwotCQlsaXN0ID0g
b2JqLT5iaW5kX2NvdW50ID8KLQkJCSZpOTE1LT5tbS5ib3VuZF9saXN0IDogJmk5MTUtPm1tLnVu
Ym91bmRfbGlzdDsKLQkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgbGlzdCk7Ci0JCXNw
aW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19z
aHJpbmthYmxlKG9iaikpIHsKKwkJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCQlzcGluX2xvY2tf
aXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKKworCQlpZiAob2JqLT5tbS5tYWR2
ID09IEk5MTVfTUFEVl9XSUxMTkVFRCkgeworCQkJc3RydWN0IGxpc3RfaGVhZCAqbGlzdDsKKwor
CQkJbGlzdCA9IG9iai0+YmluZF9jb3VudCA/CisJCQkJJmk5MTUtPm1tLmJvdW5kX2xpc3QgOiAm
aTkxNS0+bW0udW5ib3VuZF9saXN0OworCQkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywg
bGlzdCk7CisJCX0KKworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5vYmpfbG9j
aywgZmxhZ3MpOwogCX0KIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5jCmluZGV4IGEwYmM4ZjdhYjc4MC4uYzEyMWU4Y2MyMWRkIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC0yMDcsOSArMjA3LDExIEBAIHN0YXRp
YyB2b2lkIF9faTkxNV9nZW1fZnJlZV9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQkgKi8KIAkJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSAmJgogCQkg
ICAgaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSkgewotCQkJc3Bpbl9sb2NrKCZp
OTE1LT5tbS5vYmpfbG9jayk7CisJCQl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJCQlzcGluX2xv
Y2tfaXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAkJCWxpc3RfZGVsX2luaXQo
Jm9iai0+bW0ubGluayk7Ci0JCQlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCQkJ
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAkJfQog
CiAJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CkBAIC0zMjksMTAgKzMz
MSwxMyBAQCB2b2lkIGk5MTVfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAq
Z2VtX29iaikKIAogCQlvYmotPm1tLm1hZHYgPSBJOTE1X01BRFZfRE9OVE5FRUQ7CiAKLQkJaWYg
KGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkgewotCQkJc3Bpbl9sb2NrKCZpOTE1LT5t
bS5vYmpfbG9jayk7CisJCWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikgJiYKKwkJ
ICAgIGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpIHsKKwkJCXVuc2lnbmVkIGxv
bmcgZmxhZ3M7CisKKwkJCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxh
Z3MpOwogCQkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgJmk5MTUtPm1tLnB1cmdlX2xp
c3QpOwotCQkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7CiAJCX0KIAl9CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMKaW5kZXggN2U2NGZkNmJjMTliLi43
ZmY5MDdkNmQwYzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wYWdlcy5j
CkBAIC01NywxMSArNTcsMTUgQEAgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlHRU1fQlVHX09OKCFIQVNfUEFHRV9TSVpF
UyhpOTE1LCBvYmotPm1tLnBhZ2Vfc2l6ZXMuc2cpKTsKIAogCWlmIChpOTE1X2dlbV9vYmplY3Rf
aXNfc2hyaW5rYWJsZShvYmopKSB7Ci0JCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwor
CQl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5v
YmpfbG9jaywgZmxhZ3MpOworCiAJCWk5MTUtPm1tLnNocmlua19jb3VudCsrOwogCQlpOTE1LT5t
bS5zaHJpbmtfbWVtb3J5ICs9IG9iai0+YmFzZS5zaXplOwogCQlsaXN0X2FkZCgmb2JqLT5tbS5s
aW5rLCAmaTkxNS0+bW0udW5ib3VuZF9saXN0KTsKLQkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9i
al9sb2NrKTsKKworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5vYmpfbG9jaywg
ZmxhZ3MpOwogCX0KIH0KIApAQCAtMTUxLDExICsxNTUsMTUgQEAgX19pOTE1X2dlbV9vYmplY3Rf
dW5zZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJcmV0dXJuIHBh
Z2VzOwogCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpIHsKLQkJc3Bp
bl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwkJ
c3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7CisKIAkJbGlzdF9k
ZWwoJm9iai0+bW0ubGluayk7CiAJCWk5MTUtPm1tLnNocmlua19jb3VudC0tOwogCQlpOTE1LT5t
bS5zaHJpbmtfbWVtb3J5IC09IG9iai0+YmFzZS5zaXplOwotCQlzcGluX3VubG9jaygmaTkxNS0+
bW0ub2JqX2xvY2spOworCisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPm1tLm9ial9s
b2NrLCBmbGFncyk7CiAJfQogCiAJaWYgKG9iai0+bW0ubWFwcGluZykgewpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCBkNzFlNjMwYzZmYjguLjc4
ODIxODBjMjQ3NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlu
a2VyLmMKQEAgLTIwNyw2ICsyMDcsNyBAQCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJZm9yIChwaGFzZSA9IHBoYXNlczsgcGhhc2UtPmxpc3Q7IHBoYXNl
KyspIHsKIAkJc3RydWN0IGxpc3RfaGVhZCBzdGlsbF9pbl9saXN0OwogCQlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOworCQl1bnNpZ25lZCBsb25nIGZsYWdzOwogCiAJCWlmICgoZmxh
Z3MgJiBwaGFzZS0+Yml0KSA9PSAwKQogCQkJY29udGludWU7CkBAIC0yMjAsNyArMjIxLDcgQEAg
aTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgKiB0byBi
ZSBhYmxlIHRvIHNocmluayB0aGVpciBwYWdlcywgc28gdGhleSByZW1haW4gb24KIAkJICogdGhl
IHVuYm91bmQvYm91bmQgbGlzdCB1bnRpbCBhY3R1YWxseSBmcmVlZC4KIAkJICovCi0JCXNwaW5f
bG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+bW0u
b2JqX2xvY2ssIGZsYWdzKTsKIAkJd2hpbGUgKGNvdW50IDwgdGFyZ2V0ICYmCiAJCSAgICAgICAo
b2JqID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKHBoYXNlLT5saXN0LAogCQkJCQkJICAgICAg
IHR5cGVvZigqb2JqKSwKQEAgLTI0Myw3ICsyNDQsNyBAQCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQlpZiAoIWNhbl9yZWxlYXNlX3BhZ2VzKG9iaikp
CiAJCQkJY29udGludWU7CiAKLQkJCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJ
CQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwogCiAJ
CQlpZiAodW5zYWZlX2Ryb3BfcGFnZXMob2JqKSkgewogCQkJCS8qIE1heSBhcnJpdmUgZnJvbSBn
ZXRfcGFnZXMgb24gYW5vdGhlciBibyAqLwpAQCAtMjU3LDEwICsyNTgsMTAgQEAgaTkxNV9nZW1f
c2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJfQogCQkJc2Nhbm5lZCAr
PSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOwogCi0JCQlzcGluX2xvY2soJmk5MTUtPm1t
Lm9ial9sb2NrKTsKKwkJCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxh
Z3MpOwogCQl9CiAJCWxpc3Rfc3BsaWNlX3RhaWwoJnN0aWxsX2luX2xpc3QsIHBoYXNlLT5saXN0
KTsKLQkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAl9CiAKIAlpZiAoZmxhZ3MgJiBJ
OTE1X1NIUklOS19CT1VORCkKQEAgLTM3OSw2ICszODAsNyBAQCBpOTE1X2dlbV9zaHJpbmtlcl9v
b20oc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwgdW5zaWduZWQgbG9uZyBldmVudCwgdm9pZCAq
cHRyKQogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJdW5zaWduZWQgbG9uZyB1
bmV2aWN0YWJsZSwgYm91bmQsIHVuYm91bmQsIGZyZWVkX3BhZ2VzOwogCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKIAlmcmVlZF9wYWdlcyA9IDA7CiAJ
d2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5MTUsIHdha2VyZWYpCkBAIC0zOTIsNyArMzk0LDcgQEAg
aTkxNV9nZW1fc2hyaW5rZXJfb29tKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVuc2lnbmVk
IGxvbmcgZXZlbnQsIHZvaWQgKnB0cikKIAkgKiBiZWluZyBwb2ludGVkIHRvIGJ5IGhhcmR3YXJl
LgogCSAqLwogCXVuYm91bmQgPSBib3VuZCA9IHVuZXZpY3RhYmxlID0gMDsKLQlzcGluX2xvY2so
Jmk5MTUtPm1tLm9ial9sb2NrKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xv
Y2ssIGZsYWdzKTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwgJmk5MTUtPm1tLnVuYm91bmRf
bGlzdCwgbW0ubGluaykgewogCQlpZiAoIWNhbl9yZWxlYXNlX3BhZ2VzKG9iaikpCiAJCQl1bmV2
aWN0YWJsZSArPSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOwpAQCAtNDA1LDcgKzQwNyw3
IEBAIGk5MTVfZ2VtX3Nocmlua2VyX29vbShzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLCB1bnNp
Z25lZCBsb25nIGV2ZW50LCB2b2lkICpwdHIpCiAJCWVsc2UKIAkJCWJvdW5kICs9IG9iai0+YmFz
ZS5zaXplID4+IFBBR0VfU0hJRlQ7CiAJfQotCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9j
ayk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsK
IAogCWlmIChmcmVlZF9wYWdlcyB8fCB1bmJvdW5kIHx8IGJvdW5kKQogCQlwcl9pbmZvKCJQdXJn
aW5nIEdQVSBtZW1vcnksICVsdSBwYWdlcyBmcmVlZCwgIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3N0b2xlbi5jCmluZGV4IDg0ZDRmNTQ5ZWIyMS4uZjE5MGVjMjM2YThlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jCkBAIC02MTMsNiAr
NjEzLDcgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqOwogCXN0cnVjdCBkcm1fbW1fbm9kZSAqc3RvbGVuOwogCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAJaW50IHJldDsKIAogCWlmICghZHJtX21t
X2luaXRpYWxpemVkKCZkZXZfcHJpdi0+bW0uc3RvbGVuKSkKQEAgLTY4OSwxMCArNjkwLDEwIEBA
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2CiAJbGlzdF9tb3ZlX3RhaWwoJnZtYS0+dm1fbGluaywg
JmdndHQtPnZtLmJvdW5kX2xpc3QpOwogCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
Ci0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOworCXNwaW5fbG9ja19pcnFzYXZl
KCZkZXZfcHJpdi0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAlHRU1fQlVHX09OKGk5MTVfZ2VtX29i
amVjdF9pc19zaHJpbmthYmxlKG9iaikpOwogCW9iai0+YmluZF9jb3VudCsrOwotCXNwaW5fdW5s
b2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRl
dl9wcml2LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwogCiAJcmV0dXJuIG9iajsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCBmMjEyMjQxYTI3NTguLjJlNzlmMGU0YzVhZiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTI2OSw2ICsyNjksNyBAQCBzdGF0aWMg
aW50IGk5MTVfZ2VtX3N0b2xlbl9saXN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpk
YXRhKQogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJdTY0IHRvdGFsX29ial9z
aXplLCB0b3RhbF9ndHRfc2l6ZTsKIAl1bnNpZ25lZCBsb25nIHRvdGFsLCBjb3VudCwgbjsKKwl1
bnNpZ25lZCBsb25nIGZsYWdzOwogCWludCByZXQ7CiAKIAl0b3RhbCA9IFJFQURfT05DRShkZXZf
cHJpdi0+bW0uc2hyaW5rX2NvdW50KTsKQEAgLTI4Miw3ICsyODMsNyBAQCBzdGF0aWMgaW50IGk5
MTVfZ2VtX3N0b2xlbl9saXN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQog
CiAJdG90YWxfb2JqX3NpemUgPSB0b3RhbF9ndHRfc2l6ZSA9IGNvdW50ID0gMDsKIAotCXNwaW5f
bG9jaygmZGV2X3ByaXYtPm1tLm9ial9sb2NrKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3By
aXYtPm1tLm9ial9sb2NrLCBmbGFncyk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosICZkZXZf
cHJpdi0+bW0uYm91bmRfbGlzdCwgbW0ubGluaykgewogCQlpZiAoY291bnQgPT0gdG90YWwpCiAJ
CQlicmVhazsKQEAgLTMwNSw3ICszMDYsNyBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX3N0b2xlbl9s
aXN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQlvYmplY3RzW2NvdW50
KytdID0gb2JqOwogCQl0b3RhbF9vYmpfc2l6ZSArPSBvYmotPmJhc2Uuc2l6ZTsKIAl9Ci0Jc3Bp
bl91bmxvY2soJmRldl9wcml2LT5tbS5vYmpfbG9jayk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9y
ZSgmZGV2X3ByaXYtPm1tLm9ial9sb2NrLCBmbGFncyk7CiAKIAlzb3J0KG9iamVjdHMsIGNvdW50
LCBzaXplb2YoKm9iamVjdHMpLCBvYmpfcmFua19ieV9zdG9sZW4sIE5VTEwpOwogCkBAIC00NTcs
NiArNDU4LDcgQEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKmRhdGEpCiAJdTY0IHNpemUsIG1hcHBlZF9zaXplLCBwdXJnZWFibGVfc2l6
ZSwgZHB5X3NpemUsIGh1Z2Vfc2l6ZTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
OwogCXVuc2lnbmVkIGludCBwYWdlX3NpemVzID0gMDsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOwog
CWNoYXIgYnVmWzgwXTsKIAlpbnQgcmV0OwogCkBAIC00NjksNyArNDcxLDcgQEAgc3RhdGljIGlu
dCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJ
cHVyZ2VhYmxlX3NpemUgPSBwdXJnZWFibGVfY291bnQgPSAwOwogCWh1Z2Vfc2l6ZSA9IGh1Z2Vf
Y291bnQgPSAwOwogCi0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOworCXNwaW5f
bG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAlsaXN0X2Zvcl9l
YWNoX2VudHJ5KG9iaiwgJmRldl9wcml2LT5tbS51bmJvdW5kX2xpc3QsIG1tLmxpbmspIHsKIAkJ
c2l6ZSArPSBvYmotPmJhc2Uuc2l6ZTsKIAkJKytjb3VudDsKQEAgLTUxOCw3ICs1MjAsNyBAQCBz
dGF0aWMgaW50IGk5MTVfZ2VtX29iamVjdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAq
ZGF0YSkKIAkJCXBhZ2Vfc2l6ZXMgfD0gb2JqLT5tbS5wYWdlX3NpemVzLnNnOwogCQl9CiAJfQot
CXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOworCXNwaW5fdW5sb2NrX2lycXJl
c3RvcmUoJmRldl9wcml2LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwogCiAJc2VxX3ByaW50ZihtLCAi
JXUgYm91bmQgb2JqZWN0cywgJWxsdSBieXRlc1xuIiwKIAkJICAgY291bnQsIHNpemUpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggOWYyZTIxM2M2MDQ2Li5lOTgwYzFlZTNkY2YgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTEzOCw3ICsxMTM4LDEwIEBAIGk5MTVfZ2VtX21hZHZp
c2VfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJc3RydWN0IGxp
c3RfaGVhZCAqbGlzdDsKIAogCQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2Jq
KSkgewotCQkJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJCQl1bnNpZ25lZCBsb25n
IGZsYWdzOworCisJCQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdz
KTsKKwogCQkJaWYgKG9iai0+bW0ubWFkdiAhPSBJOTE1X01BRFZfV0lMTE5FRUQpCiAJCQkJbGlz
dCA9ICZpOTE1LT5tbS5wdXJnZV9saXN0OwogCQkJZWxzZSBpZiAob2JqLT5iaW5kX2NvdW50KQpA
QCAtMTE0Niw3ICsxMTQ5LDggQEAgaTkxNV9nZW1fbWFkdmlzZV9pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQkJZWxzZQogCQkJCWxpc3QgPSAmaTkxNS0+bW0udW5i
b3VuZF9saXN0OwogCQkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgbGlzdCk7Ci0JCQlz
cGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCisJCQlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwogCQl9CiAJfQogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuYwppbmRleCBmNmFjODM5NGRhNzcuLjgwMDUwZjZhMDg5MyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5jCkBAIC04MCwxMSArODAsMTQgQEAgc3RhdGljIHZvaWQgdm1hX3ByaW50X2FsbG9j
YXRvcihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgY29uc3QgY2hhciAqcmVhc29uKQogc3RhdGljIHZv
aWQgb2JqX2J1bXBfbXJ1KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xv
Y2ssIGZsYWdzKTsKIAotCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwogCWlmIChvYmot
PmJpbmRfY291bnQpCiAJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssICZpOTE1LT5tbS5i
b3VuZF9saXN0KTsKLQlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCisJc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAogCW9iai0+bW0u
ZGlydHkgPSB0cnVlOyAvKiBiZSBwYXJhbm9pZCAgKi8KIH0KQEAgLTY3OCw4ICs2ODEsOSBAQCBp
OTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25t
ZW50LCB1NjQgZmxhZ3MpCiAKIAlpZiAodm1hLT5vYmopIHsKIAkJc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiA9IHZtYS0+b2JqOworCQl1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0JCXNw
aW5fbG9jaygmZGV2X3ByaXYtPm1tLm9ial9sb2NrKTsKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmRl
dl9wcml2LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwogCiAJCWlmIChpOTE1X2dlbV9vYmplY3RfaXNf
c2hyaW5rYWJsZShvYmopKQogCQkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgJmRldl9w
cml2LT5tbS5ib3VuZF9saXN0KTsKQEAgLTY4Nyw3ICs2OTEsNyBAQCBpOTE1X3ZtYV9pbnNlcnQo
c3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3Mp
CiAJCW9iai0+YmluZF9jb3VudCsrOwogCQlhc3NlcnRfYmluZF9jb3VudChvYmopOwogCi0JCXNw
aW5fdW5sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOworCQlzcGluX3VubG9ja19pcnFyZXN0
b3JlKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAl9CiAKIAlyZXR1cm4gMDsKQEAg
LTcyMSw4ICs3MjUsOSBAQCBpOTE1X3ZtYV9yZW1vdmUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJ
ICovCiAJaWYgKHZtYS0+b2JqKSB7CiAJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmog
PSB2bWEtPm9iajsKKwkJdW5zaWduZWQgbG9uZyBmbGFnczsKIAotCQlzcGluX2xvY2soJmk5MTUt
Pm1tLm9ial9sb2NrKTsKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPm1tLm9ial9sb2NrLCBm
bGFncyk7CiAKIAkJR0VNX0JVR19PTihvYmotPmJpbmRfY291bnQgPT0gMCk7CiAJCWlmICgtLW9i
ai0+YmluZF9jb3VudCA9PSAwICYmCkBAIC03MzAsNyArNzM1LDcgQEAgaTkxNV92bWFfcmVtb3Zl
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQkgICAgb2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9X
SUxMTkVFRCkKIAkJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssICZpOTE1LT5tbS51bmJv
dW5kX2xpc3QpOwogCi0JCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7CiAKIAkJLyoKIAkJ
ICogQW5kIGZpbmFsbHkgbm93IHRoZSBvYmplY3QgaXMgY29tcGxldGVseSBkZWNvdXBsZWQgZnJv
bSB0aGlzCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3133428631
	for <lists+intel-gfx@lfdr.de>; Thu, 23 May 2019 20:58:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9A03A89F75;
	Thu, 23 May 2019 18:58:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D9E4789E0D
 for <intel-gfx@lists.freedesktop.org>; Thu, 23 May 2019 18:58:20 +0000 (UTC)
X-Amp-Result: UNKNOWN
X-Amp-Original-Verdict: FILE UNKNOWN
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 23 May 2019 11:58:20 -0700
X-ExtLoop1: 1
Received: from rdvivi-losangeles.jf.intel.com (HELO intel.com) ([10.7.196.65])
 by orsmga007.jf.intel.com with ESMTP; 23 May 2019 11:58:19 -0700
Date: Thu, 23 May 2019 11:58:46 -0700
From: Rodrigo Vivi <rodrigo.vivi@intel.com>
To: Lucas De Marchi <lucas.demarchi@intel.com>
Message-ID: <20190523185846.GU4441@intel.com>
References: <20190523082420.10352-1-lucas.demarchi@intel.com>
 <20190523082420.10352-9-lucas.demarchi@intel.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190523082420.10352-9-lucas.demarchi@intel.com>
User-Agent: Mutt/1.11.3 (2019-02-01)
Subject: Re: [Intel-gfx] [PATCH 09/10] drm/i915/dmc: protect against reading
 random memory
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gVGh1LCBNYXkgMjMsIDIwMTkgYXQgMDE6MjQ6MTlBTSAtMDcwMCwgTHVjYXMgRGUgTWFyY2hp
IHdyb3RlOgo+IFdoaWxlIGxvYWRpbmcgdGhlIERNQyBmaXJtd2FyZSB3ZSB3ZXJlIGRvdWJsZSBj
aGVja2luZyB0aGUgaGVhZGVycyBtYWRlCj4gc2Vuc2UsIGJ1dCBpbiBubyBwbGFjZSB3ZSBjaGVj
a2VkIHRoYXQgd2Ugd2VyZSBhY3R1YWxseSByZWFkaW5nIG1lbW9yeQo+IHdlIHdlcmUgc3VwcG9z
ZWQgdG8uIFRoaXMgY291bGQgYmUgd3JvbmcgaW4gY2FzZSB0aGUgZmlybXdhcmUgZmlsZSBpcwo+
IHRydW5jYXRlZC4KPiAKPiBCZWZvcmUgcGFyc2luZyBhbnkgcGFydCBvZiB0aGUgZmlybXdhcmUs
IHZhbGlkYXRlIHRoZSBpbnB1dCBmaXJzdC4KPiAKPiBTaWduZWQtb2ZmLWJ5OiBMdWNhcyBEZSBN
YXJjaGkgPGx1Y2FzLmRlbWFyY2hpQGludGVsLmNvbT4KCkkgd29uZGVyIGlmIHRoaXMgcGF0Y2gg
c2hvdWxkIGJlIHRoZSBmaXJzdCBvbmUgb24gdGhlIHNlcmllcwpmb3IgZWFzeSBiYWNrcG9ydCBp
ZiBuZWVkZWQuCk1heWJlIGNjOiBTdGFibGU/CgpSZXZpZXdlZC1ieTogUm9kcmlnbyBWaXZpIDxy
b2RyaWdvLnZpdmlAaW50ZWwuY29tPgoKPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfY3NyLmMgfCA3MSArKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLQo+ICAxIGZpbGUg
Y2hhbmdlZCwgNTMgaW5zZXJ0aW9ucygrKSwgMTggZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Nzci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfY3NyLmMKPiBpbmRleCA3ZmYwOGRlODNjYzYuLmI3MTgxY2E2YzhmNSAxMDA2NDQK
PiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jc3IuYwo+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2Nzci5jCj4gQEAgLTM2MCw3ICszNjAsOCBAQCBzdGF0aWMgdTMy
IGZpbmRfZG1jX2Z3X29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfZndfaW5mbyAqZndfaW5mbywK
PiAgfQo+ICAKPiAgc3RhdGljIHUzMiBwYXJzZV9jc3JfZndfZG1jKHN0cnVjdCBpbnRlbF9jc3Ig
KmNzciwKPiAtCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyX2Jhc2UgKmRtY19o
ZWFkZXIpCj4gKwkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlcl9iYXNlICpkbWNf
aGVhZGVyLAo+ICsJCQkgICAgc2l6ZV90IHJlbV9zaXplKQo+ICB7Cj4gIAl1bnNpZ25lZCBpbnQg
aGVhZGVyX2xlbl9ieXRlcywgZG1jX2hlYWRlcl9zaXplLCBwYXlsb2FkX3NpemUsIGk7Cj4gIAlj
b25zdCB1MzIgKm1taW9hZGRyLCAqbW1pb2RhdGE7Cj4gQEAgLTM3NSw2ICszNzYsOSBAQCBzdGF0
aWMgdTMyIHBhcnNlX2Nzcl9md19kbWMoc3RydWN0IGludGVsX2NzciAqY3NyLAo+ICAJCWNvbnN0
IHN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyX3YzICp2MyA9Cj4gIAkJCShjb25zdCBzdHJ1Y3QgaW50
ZWxfZG1jX2hlYWRlcl92MyAqKWRtY19oZWFkZXI7Cj4gIAo+ICsJCWlmIChyZW1fc2l6ZSA8IHNp
emVvZihzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlcl92MykpCj4gKwkJCWdvdG8gZXJyb3JfdHJ1bmNh
dGVkOwo+ICsKPiAgCQltbWlvYWRkciA9IHYzLT5tbWlvYWRkcjsKPiAgCQltbWlvZGF0YSA9IHYz
LT5tbWlvZGF0YTsKPiAgCQltbWlvX2NvdW50ID0gdjMtPm1taW9fY291bnQ7Cj4gQEAgLTM4Niw2
ICszOTAsOSBAQCBzdGF0aWMgdTMyIHBhcnNlX2Nzcl9md19kbWMoc3RydWN0IGludGVsX2NzciAq
Y3NyLAo+ICAJCWNvbnN0IHN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyX3YxICp2MSA9Cj4gIAkJCShj
b25zdCBzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlcl92MSAqKWRtY19oZWFkZXI7Cj4gIAo+ICsJCWlm
IChyZW1fc2l6ZSA8IHNpemVvZihzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlcl92MSkpCj4gKwkJCWdv
dG8gZXJyb3JfdHJ1bmNhdGVkOwo+ICsKPiAgCQltbWlvYWRkciA9IHYxLT5tbWlvYWRkcjsKPiAg
CQltbWlvZGF0YSA9IHYxLT5tbWlvZGF0YTsKPiAgCQltbWlvX2NvdW50ID0gdjEtPm1taW9fY291
bnQ7Cj4gQEAgLTQwNCw2ICs0MTEsOCBAQCBzdGF0aWMgdTMyIHBhcnNlX2Nzcl9md19kbWMoc3Ry
dWN0IGludGVsX2NzciAqY3NyLAo+ICAJCXJldHVybiAwOwo+ICAJfQo+ICAKPiArCXJlbV9zaXpl
IC09IGhlYWRlcl9sZW5fYnl0ZXM7Cj4gKwo+ICAJLyogQ2FjaGUgdGhlIGRtYyBoZWFkZXIgaW5m
by4gKi8KPiAgCWlmIChtbWlvX2NvdW50ID4gbW1pb19jb3VudF9tYXgpIHsKPiAgCQlEUk1fRVJS
T1IoIkRNQyBmaXJtd2FyZSBoYXMgd3JvbmcgbW1pbyBjb3VudCAldVxuIiwgbW1pb19jb3VudCk7
Cj4gQEAgLTQyNCw2ICs0MzMsOSBAQCBzdGF0aWMgdTMyIHBhcnNlX2Nzcl9md19kbWMoc3RydWN0
IGludGVsX2NzciAqY3NyLAo+ICAKPiAgCS8qIGZ3X3NpemUgaXMgaW4gZHdvcmRzLCBzbyBtdWx0
aXBsaWVkIGJ5IDQgdG8gY29udmVydCBpbnRvIGJ5dGVzLiAqLwo+ICAJcGF5bG9hZF9zaXplID0g
ZG1jX2hlYWRlci0+Zndfc2l6ZSAqIDQ7Cj4gKwlpZiAocmVtX3NpemUgPCBwYXlsb2FkX3NpemUp
Cj4gKwkJZ290byBlcnJvcl90cnVuY2F0ZWQ7Cj4gKwo+ICAJaWYgKHBheWxvYWRfc2l6ZSA+IGNz
ci0+bWF4X2Z3X3NpemUpIHsKPiAgCQlEUk1fRVJST1IoIkRNQyBGVyB0b28gYmlnICgldSBieXRl
cylcbiIsIHBheWxvYWRfc2l6ZSk7Cj4gIAkJcmV0dXJuIDA7Cj4gQEAgLTQ0MCwxNiArNDUyLDI1
IEBAIHN0YXRpYyB1MzIgcGFyc2VfY3NyX2Z3X2RtYyhzdHJ1Y3QgaW50ZWxfY3NyICpjc3IsCj4g
IAltZW1jcHkoY3NyLT5kbWNfcGF5bG9hZCwgcGF5bG9hZCwgcGF5bG9hZF9zaXplKTsKPiAgCj4g
IAlyZXR1cm4gaGVhZGVyX2xlbl9ieXRlcyArIHBheWxvYWRfc2l6ZTsKPiArCj4gK2Vycm9yX3Ry
dW5jYXRlZDoKPiArCURSTV9FUlJPUigiVHJ1bmNhdGVkIERNQyBmaXJtd2FyZSwgcmVmdXNpbmcu
XG4iKTsKPiArCXJldHVybiAwOwo+ICB9Cj4gIAo+ICBzdGF0aWMgdTMyCj4gIHBhcnNlX2Nzcl9m
d19wYWNrYWdlKHN0cnVjdCBpbnRlbF9jc3IgKmNzciwKPiAgCQkgICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9wYWNrYWdlX2hlYWRlciAqcGFja2FnZV9oZWFkZXIsCj4gLQkJICAgICBjb25zdCBzdHJ1
Y3Qgc3RlcHBpbmdfaW5mbyAqc2kpCj4gKwkJICAgICBjb25zdCBzdHJ1Y3Qgc3RlcHBpbmdfaW5m
byAqc2ksCj4gKwkJICAgICBzaXplX3QgcmVtX3NpemUpCj4gIHsKPiAtCXUzMiBudW1fZW50cmll
cywgbWF4X2VudHJpZXMsIGRtY19vZmZzZXQsIHI7Cj4gKwl1MzIgcGFja2FnZV9zaXplID0gc2l6
ZW9mKHN0cnVjdCBpbnRlbF9wYWNrYWdlX2hlYWRlcik7Cj4gKwl1MzIgbnVtX2VudHJpZXMsIG1h
eF9lbnRyaWVzLCBkbWNfb2Zmc2V0Owo+ICAJY29uc3Qgc3RydWN0IGludGVsX2Z3X2luZm8gKmZ3
X2luZm87Cj4gIAo+ICsJaWYgKHJlbV9zaXplIDwgcGFja2FnZV9zaXplKQo+ICsJCWdvdG8gZXJy
b3JfdHJ1bmNhdGVkOwo+ICsKPiAgCWlmIChwYWNrYWdlX2hlYWRlci0+aGVhZGVyX3ZlciA9PSAx
KSB7Cj4gIAkJbWF4X2VudHJpZXMgPSBQQUNLQUdFX01BWF9GV19JTkZPX0VOVFJJRVM7Cj4gIAl9
IGVsc2UgaWYgKHBhY2thZ2VfaGVhZGVyLT5oZWFkZXJfdmVyID09IDIpIHsKPiBAQCAtNDYwLDEx
ICs0ODEsMTcgQEAgcGFyc2VfY3NyX2Z3X3BhY2thZ2Uoc3RydWN0IGludGVsX2NzciAqY3NyLAo+
ICAJCXJldHVybiAwOwo+ICAJfQo+ICAKPiAtCWlmIChwYWNrYWdlX2hlYWRlci0+aGVhZGVyX2xl
biAqIDQgIT0KPiAtCSAgICBzaXplb2Yoc3RydWN0IGludGVsX3BhY2thZ2VfaGVhZGVyKSArCj4g
LQkgICAgbWF4X2VudHJpZXMgKiBzaXplb2Yoc3RydWN0IGludGVsX2Z3X2luZm8pKSB7Cj4gKwkv
Kgo+ICsJICogV2Ugc2hvdWxkIGFsd2F5cyBoYXZlIHNwYWNlIGZvciBtYXhfZW50cmllcywKPiAr
CSAqIGV2ZW4gaWYgbm90IGFsbCBhcmUgdXNlZAo+ICsJICovCj4gKwlwYWNrYWdlX3NpemUgKz0g
bWF4X2VudHJpZXMgKiBzaXplb2Yoc3RydWN0IGludGVsX2Z3X2luZm8pOwo+ICsJaWYgKHJlbV9z
aXplIDwgcGFja2FnZV9zaXplKQo+ICsJCWdvdG8gZXJyb3JfdHJ1bmNhdGVkOwo+ICsKPiArCWlm
IChwYWNrYWdlX2hlYWRlci0+aGVhZGVyX2xlbiAqIDQgIT0gcGFja2FnZV9zaXplKSB7Cj4gIAkJ
RFJNX0VSUk9SKCJETUMgZmlybXdhcmUgaGFzIHdyb25nIHBhY2thZ2UgaGVhZGVyIGxlbmd0aCAi
Cj4gLQkJCSAgIigldSBieXRlcylcbiIsIHBhY2thZ2VfaGVhZGVyLT5oZWFkZXJfbGVuICogNCk7
Cj4gKwkJCSAgIigldSBieXRlcylcbiIsIHBhY2thZ2Vfc2l6ZSk7Cj4gIAkJcmV0dXJuIDA7Cj4g
IAl9Cj4gIAo+IEBAIC00ODEsMjEgKzUwOCwyNCBAQCBwYXJzZV9jc3JfZndfcGFja2FnZShzdHJ1
Y3QgaW50ZWxfY3NyICpjc3IsCj4gIAkJcmV0dXJuIDA7Cj4gIAl9Cj4gIAo+IC0JciA9IHNpemVv
ZihzdHJ1Y3QgaW50ZWxfcGFja2FnZV9oZWFkZXIpOwo+IC0KPiAtCS8qIHdlIGFsd2F5cyBoYXZl
IHNwYWNlIGZvciBtYXhfZW50cmllcywgZXZlbiBpZiBub3QgYWxsIGFyZSB1c2VkICovCj4gLQly
ICs9IG1heF9lbnRyaWVzICogc2l6ZW9mKHN0cnVjdCBpbnRlbF9md19pbmZvKTsKPiAtCj4gIAkv
KiBkbWNfb2Zmc2V0IGlzIGluIGR3b3JkcyAqLwo+IC0JciArPSBkbWNfb2Zmc2V0ICogNDsKPiAr
CXJldHVybiBwYWNrYWdlX3NpemUgKyBkbWNfb2Zmc2V0ICogNDsKPiAgCj4gLQlyZXR1cm4gcjsK
PiArZXJyb3JfdHJ1bmNhdGVkOgo+ICsJRFJNX0VSUk9SKCJUcnVuY2F0ZWQgRE1DIGZpcm13YXJl
LCByZWZ1c2luZy5cbiIpOwo+ICsJcmV0dXJuIDA7Cj4gIH0KPiAgCj4gIC8qIFJldHVybiBudW1i
ZXIgb2YgYnl0ZXMgcGFyc2VkIG9yIDAgb24gZXJyb3IgKi8KPiAgc3RhdGljIHUzMiBwYXJzZV9j
c3JfZndfY3NzKHN0cnVjdCBpbnRlbF9jc3IgKmNzciwKPiAtCQkJICAgIHN0cnVjdCBpbnRlbF9j
c3NfaGVhZGVyICpjc3NfaGVhZGVyKQo+ICsJCQkgICAgc3RydWN0IGludGVsX2Nzc19oZWFkZXIg
KmNzc19oZWFkZXIsCj4gKwkJCSAgICBzaXplX3QgcmVtX3NpemUpCj4gIHsKPiArCWlmIChyZW1f
c2l6ZSA8IHNpemVvZihzdHJ1Y3QgaW50ZWxfY3NzX2hlYWRlcikpIHsKPiArCQlEUk1fRVJST1Io
IlRydW5jYXRlZCBETUMgZmlybXdhcmUsIHJlZnVzaW5nLlxuIik7Cj4gKwkJcmV0dXJuIDA7Cj4g
Kwl9Cj4gKwo+ICAJaWYgKHNpemVvZihzdHJ1Y3QgaW50ZWxfY3NzX2hlYWRlcikgIT0KPiAgCSAg
ICAoY3NzX2hlYWRlci0+aGVhZGVyX2xlbiAqIDQpKSB7Cj4gIAkJRFJNX0VSUk9SKCJETUMgZmly
bXdhcmUgaGFzIHdyb25nIENTUyBoZWFkZXIgbGVuZ3RoICIKPiBAQCAtNTMwLDI5ICs1NjAsMzQg
QEAgc3RhdGljIHZvaWQgcGFyc2VfY3NyX2Z3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKPiAgCWNvbnN0IHN0cnVjdCBzdGVwcGluZ19pbmZvICpzaSA9IGludGVsX2dldF9zdGVw
cGluZ19pbmZvKGRldl9wcml2KTsKPiAgCXUzMiByZWFkY291bnQgPSAwOwo+ICAJdTMyIHI7Cj4g
KwlzaXplX3QgcmVtX3NpemU7Cj4gIAo+ICAJaWYgKCFmdykKPiAgCQlyZXR1cm47Cj4gIAo+ICsJ
cmVtX3NpemUgPSBmdy0+c2l6ZTsKPiArCj4gIAkvKiBFeHRyYWN0IENTUyBIZWFkZXIgaW5mb3Jt
YXRpb24qLwo+ICAJY3NzX2hlYWRlciA9IChzdHJ1Y3QgaW50ZWxfY3NzX2hlYWRlciAqKWZ3LT5k
YXRhOwo+IC0JciA9IHBhcnNlX2Nzcl9md19jc3MoY3NyLCBjc3NfaGVhZGVyKTsKPiArCXIgPSBw
YXJzZV9jc3JfZndfY3NzKGNzciwgY3NzX2hlYWRlciwgcmVtX3NpemUpOwo+ICAJaWYgKCFyKQo+
ICAJCXJldHVybjsKPiAgCj4gKwlyZW1fc2l6ZSAtPSByOwo+ICAJcmVhZGNvdW50ICs9IHI7Cj4g
IAo+ICAJLyogRXh0cmFjdCBQYWNrYWdlIEhlYWRlciBpbmZvcm1hdGlvbiovCj4gIAlwYWNrYWdl
X2hlYWRlciA9IChzdHJ1Y3QgaW50ZWxfcGFja2FnZV9oZWFkZXIgKikmZnctPmRhdGFbcmVhZGNv
dW50XTsKPiAtCXIgPSBwYXJzZV9jc3JfZndfcGFja2FnZShjc3IsIHBhY2thZ2VfaGVhZGVyLCBz
aSk7Cj4gKwlyID0gcGFyc2VfY3NyX2Z3X3BhY2thZ2UoY3NyLCBwYWNrYWdlX2hlYWRlciwgc2ks
IHJlbV9zaXplKTsKPiAgCWlmICghcikKPiAgCQlyZXR1cm47Cj4gIAo+ICsJcmVtX3NpemUgLT0g
cjsKPiAgCXJlYWRjb3VudCArPSByOwo+ICAKPiAgCS8qIEV4dHJhY3QgZG1jX2hlYWRlciBpbmZv
cm1hdGlvbi4gKi8KPiAgCWRtY19oZWFkZXIgPSAoc3RydWN0IGludGVsX2RtY19oZWFkZXJfYmFz
ZSAqKSZmdy0+ZGF0YVtyZWFkY291bnRdOwo+IC0JcGFyc2VfY3NyX2Z3X2RtYyhjc3IsIGRtY19o
ZWFkZXIpOwo+ICsJcGFyc2VfY3NyX2Z3X2RtYyhjc3IsIGRtY19oZWFkZXIsIHJlbV9zaXplKTsK
PiAgfQo+ICAKPiAgc3RhdGljIHZvaWQgaW50ZWxfY3NyX3J1bnRpbWVfcG1fZ2V0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKPiAtLSAKPiAyLjIxLjAKPiAKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

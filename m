Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8165ACC143
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 19:05:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0BF256EBE8;
	Fri,  4 Oct 2019 17:05:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 557846EBE2
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 17:05:00 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 04 Oct 2019 10:04:59 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,256,1566889200"; d="scan'208";a="222215997"
Received: from bkokkula-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.7.77])
 by fmsmga002.fm.intel.com with ESMTP; 04 Oct 2019 10:04:57 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 18:04:34 +0100
Message-Id: <20191004170452.15410-4-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191004170452.15410-1-matthew.auld@intel.com>
References: <20191004170452.15410-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 03/21] drm/i915/region: support contiguous
 allocations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U29tZSBrZXJuZWwgaW50ZXJuYWwgb2JqZWN0cyBtYXkgbmVlZCB0byBiZSBhbGxvY2F0ZWQgYXMg
YSBjb250aWd1b3VzCmJsb2NrLCBhbHNvIHRoaW5raW5nIGFoZWFkIHRoZSB2YXJpb3VzIGtlcm5l
bCBpb19tYXBwaW5nIGludGVyZmFjZXMgc2VlbQp0byBleHBlY3QgaXQsIGFsdGhvdWdoIHRoaXMg
aXMgcHVyZWx5IGEgbGltaXRhdGlvbiBpbiB0aGUga2VybmVsCkFQSS4uLnNvIHBlcmhhcHMgc29t
ZXRoaW5nIHRvIGJlIGltcHJvdmVkLgoKU2lnbmVkLW9mZi1ieTogTWF0dGhldyBBdWxkIDxtYXR0
aGV3LmF1bGRAaW50ZWwuY29tPgpDYzogSm9vbmFzIExhaHRpbmVuIDxqb29uYXMubGFodGluZW5A
bGludXguaW50ZWwuY29tPgpDYzogQWJkaWVsIEphbnVsZ3VlIDxhYmRpZWwuamFudWxndWVAbGlu
dXguaW50ZWwuY29tPgpDYzogTWljaGFlbCBKIFJ1aGwgPG1pY2hhZWwuai5ydWhsQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAg
IDYgKwogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggIHwgICA0
ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9yZWdpb24uYyAgICB8ICAxNSAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3JlZ2lvbi5oICAgIHwgICAzICst
CiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jICAgfCAgNzEgKysr
Ky0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uYyAgICB8ICAg
OSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfbWVtb3J5X3JlZ2lvbi5oICAgIHwgICAz
ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVsX21lbW9yeV9yZWdpb24uYyAgfCAxNjUg
KysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19y
ZWdpb24uYyAgfCAgIDIgKy0KIDkgZmlsZXMgY2hhbmdlZCwgMjM5IGluc2VydGlvbnMoKyksIDM5
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3Qu
aAppbmRleCAwODZhOWJmNWFkY2MuLmRmZDE2ZDY1NjMwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtMTM5LDYgKzEzOSwxMiBAQCBpOTE1X2dlbV9v
YmplY3RfaXNfcmVhZG9ubHkoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
IAlyZXR1cm4gb2JqLT5iYXNlLnZtYV9ub2RlLnJlYWRvbmx5OwogfQogCitzdGF0aWMgaW5saW5l
IGJvb2wKK2k5MTVfZ2VtX29iamVjdF9pc19jb250aWd1b3VzKGNvbnN0IHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopCit7CisJcmV0dXJuIG9iai0+ZmxhZ3MgJiBJOTE1X0JPX0FMTE9D
X0NPTlRJR1VPVVM7Cit9CisKIHN0YXRpYyBpbmxpbmUgYm9vbAogaTkxNV9nZW1fb2JqZWN0X3R5
cGVfaGFzKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgdW5zaWdu
ZWQgbG9uZyBmbGFncykKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9v
YmplY3RfdHlwZXMuaAppbmRleCAxMTM5MDU4NmNmZTEuLmM2YTcxMmNmN2Q3YSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtMTE5
LDYgKzExOSwxMCBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAKIAlJOTE1X1NFTEZU
RVNUX0RFQ0xBUkUoc3RydWN0IGxpc3RfaGVhZCBzdF9saW5rKTsKIAorCXVuc2lnbmVkIGxvbmcg
ZmxhZ3M7CisjZGVmaW5lIEk5MTVfQk9fQUxMT0NfQ09OVElHVU9VUyBCSVQoMCkKKyNkZWZpbmUg
STkxNV9CT19BTExPQ19GTEFHUyAoSTkxNV9CT19BTExPQ19DT05USUdVT1VTKQorCiAJLyoKIAkg
KiBJcyB0aGUgb2JqZWN0IHRvIGJlIG1hcHBlZCBhcyByZWFkLW9ubHkgdG8gdGhlIEdQVQogCSAq
IE9ubHkgaG9ub3VyZWQgaWYgaGFyZHdhcmUgaGFzIHJlbGV2YW50IHB0ZSBiaXQKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9yZWdpb24uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9yZWdpb24uYwppbmRleCA1ZmM2ZTQ1NDBmODIuLjA0
Y2I5ZjcyOTQ1ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3JlZ2lvbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9yZWdpb24u
YwpAQCAtMjMsMTAgKzIzLDEwIEBAIGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfYnVkZHkoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3Jl
Z2lvbiAqbWVtID0gb2JqLT5tbS5yZWdpb247CiAJc3RydWN0IGxpc3RfaGVhZCAqYmxvY2tzID0g
Jm9iai0+bW0uYmxvY2tzOwotCXVuc2lnbmVkIGludCBmbGFncyA9IEk5MTVfQUxMT0NfTUlOX1BB
R0VfU0laRTsKIAlyZXNvdXJjZV9zaXplX3Qgc2l6ZSA9IG9iai0+YmFzZS5zaXplOwogCXJlc291
cmNlX3NpemVfdCBwcmV2X2VuZDsKIAlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2s7CisJ
dW5zaWduZWQgaW50IGZsYWdzOwogCXN0cnVjdCBzZ190YWJsZSAqc3Q7CiAJc3RydWN0IHNjYXR0
ZXJsaXN0ICpzZzsKIAl1bnNpZ25lZCBpbnQgc2dfcGFnZV9zaXplczsKQEAgLTQyLDYgKzQyLDEw
IEBAIGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfYnVkZHkoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaikKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQogCisJZmxhZ3MgPSBJOTE1X0FMTE9D
X01JTl9QQUdFX1NJWkU7CisJaWYgKG9iai0+ZmxhZ3MgJiBJOTE1X0JPX0FMTE9DX0NPTlRJR1VP
VVMpCisJCWZsYWdzIHw9IEk5MTVfQUxMT0NfQ09OVElHVU9VUzsKKwogCXJldCA9IF9faW50ZWxf
bWVtb3J5X3JlZ2lvbl9nZXRfcGFnZXNfYnVkZHkobWVtLCBzaXplLCBmbGFncywgYmxvY2tzKTsK
IAlpZiAocmV0KQogCQlnb3RvIGVycl9mcmVlX3NnOwpAQCAtNTYsNyArNjAsOCBAQCBpOTE1X2dl
bV9vYmplY3RfZ2V0X3BhZ2VzX2J1ZGR5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiAJbGlzdF9mb3JfZWFjaF9lbnRyeShibG9jaywgYmxvY2tzLCBsaW5rKSB7CiAJCXU2NCBibG9j
a19zaXplLCBvZmZzZXQ7CiAKLQkJYmxvY2tfc2l6ZSA9IGk5MTVfYnVkZHlfYmxvY2tfc2l6ZSgm
bWVtLT5tbSwgYmxvY2spOworCQlibG9ja19zaXplID0gbWluX3QodTY0LCBzaXplLAorCQkJCSAg
IGk5MTVfYnVkZHlfYmxvY2tfc2l6ZSgmbWVtLT5tbSwgYmxvY2spKTsKIAkJb2Zmc2V0ID0gaTkx
NV9idWRkeV9ibG9ja19vZmZzZXQoYmxvY2spOwogCiAJCUdFTV9CVUdfT04ob3ZlcmZsb3dzX3R5
cGUoYmxvY2tfc2l6ZSwgc2ctPmxlbmd0aCkpOwpAQCAtOTgsMTAgKzEwMywxMiBAQCBpOTE1X2dl
bV9vYmplY3RfZ2V0X3BhZ2VzX2J1ZGR5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiB9CiAKIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2luaXRfbWVtb3J5X3JlZ2lvbihzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCQlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAq
bWVtKQorCQkJCQlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtLAorCQkJCQl1bnNpZ25l
ZCBsb25nIGZsYWdzKQogewogCUlOSVRfTElTVF9IRUFEKCZvYmotPm1tLmJsb2Nrcyk7CiAJb2Jq
LT5tbS5yZWdpb24gPSBpbnRlbF9tZW1vcnlfcmVnaW9uX2dldChtZW0pOworCW9iai0+ZmxhZ3Mg
PSBmbGFnczsKIH0KIAogdm9pZCBpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tZW1vcnlfcmVnaW9u
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCkBAIC0xMTYsNiArMTIzLDggQEAgaTkx
NV9nZW1fb2JqZWN0X2NyZWF0ZV9yZWdpb24oc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1l
bSwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCisJR0VNX0JVR19PTihm
bGFncyAmIH5JOTE1X0JPX0FMTE9DX0ZMQUdTKTsKKwogCWlmICghbWVtKQogCQlyZXR1cm4gRVJS
X1BUUigtRU5PREVWKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3JlZ2lvbi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3JlZ2lv
bi5oCmluZGV4IGViZGRjODZkNzhmNy4uZjJmZjZmOGJmZjc0IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcmVnaW9uLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3JlZ2lvbi5oCkBAIC0xNyw3ICsxNyw4IEBAIHZvaWQgaTkxNV9n
ZW1fb2JqZWN0X3B1dF9wYWdlc19idWRkeShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCQkJCSAgICAgc3RydWN0IHNnX3RhYmxlICpwYWdlcyk7CiAKIHZvaWQgaTkxNV9nZW1fb2Jq
ZWN0X2luaXRfbWVtb3J5X3JlZ2lvbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAot
CQkJCQlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtKTsKKwkJCQkJc3RydWN0IGludGVs
X21lbW9yeV9yZWdpb24gKm1lbSwKKwkJCQkJdW5zaWduZWQgbG9uZyBmbGFncyk7CiB2b2lkIGk5
MTVfZ2VtX29iamVjdF9yZWxlYXNlX21lbW9yeV9yZWdpb24oc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaik7CiAKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggYjRjMzkwZTlm
YTUwLi42M2E0NzQzZTVmNTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaHVnZV9wYWdlcy5jCkBAIC00NTYsNiArNDU2LDcgQEAgc3RhdGljIGludCBpZ3RfbW9j
a19leGhhdXN0X2RldmljZV9zdXBwb3J0ZWRfcGFnZXModm9pZCAqYXJnKQogCiBzdGF0aWMgaW50
IGlndF9tb2NrX21lbW9yeV9yZWdpb25faHVnZV9wYWdlcyh2b2lkICphcmcpCiB7CisJY29uc3Qg
dW5zaWduZWQgaW50IGZsYWdzW10gPSB7IDAsIEk5MTVfQk9fQUxMT0NfQ09OVElHVU9VUyB9Owog
CXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCA9IGFyZzsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHBwZ3R0LT52bS5pOTE1OwogCXVuc2lnbmVkIGxvbmcgc3VwcG9ydGVkID0gSU5U
RUxfSU5GTyhpOTE1KS0+cGFnZV9zaXplczsKQEAgLTQ3NCw0NiArNDc1LDUyIEBAIHN0YXRpYyBp
bnQgaWd0X21vY2tfbWVtb3J5X3JlZ2lvbl9odWdlX3BhZ2VzKHZvaWQgKmFyZykKIAlmb3JfZWFj
aF9zZXRfYml0KGJpdCwgJnN1cHBvcnRlZCwgaWxvZzIoSTkxNV9HVFRfTUFYX1BBR0VfU0laRSkg
KyAxKSB7CiAJCXVuc2lnbmVkIGludCBwYWdlX3NpemUgPSBCSVQoYml0KTsKIAkJcmVzb3VyY2Vf
c2l6ZV90IHBoeXM7CisJCWludCBpOwogCi0JCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
cmVnaW9uKG1lbSwgcGFnZV9zaXplLCAwKTsKLQkJaWYgKElTX0VSUihvYmopKSB7Ci0JCQllcnIg
PSBQVFJfRVJSKG9iaik7Ci0JCQlnb3RvIG91dF9yZWdpb247Ci0JCX0KKwkJZm9yIChpID0gMDsg
aSA8IEFSUkFZX1NJWkUoZmxhZ3MpOyArK2kpIHsKKwkJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfcmVnaW9uKG1lbSwgcGFnZV9zaXplLAorCQkJCQkJCSAgICBmbGFnc1tpXSk7CisJCQlp
ZiAoSVNfRVJSKG9iaikpIHsKKwkJCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCQkJZ290byBvdXRf
cmVnaW9uOworCQkJfQogCi0JCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJnBwZ3R0LT52
bSwgTlVMTCk7Ci0JCWlmIChJU19FUlIodm1hKSkgewotCQkJZXJyID0gUFRSX0VSUih2bWEpOwot
CQkJZ290byBvdXRfcHV0OwotCQl9CisJCQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosICZw
cGd0dC0+dm0sIE5VTEwpOworCQkJaWYgKElTX0VSUih2bWEpKSB7CisJCQkJZXJyID0gUFRSX0VS
Uih2bWEpOworCQkJCWdvdG8gb3V0X3B1dDsKKwkJCX0KIAotCQllcnIgPSBpOTE1X3ZtYV9waW4o
dm1hLCAwLCAwLCBQSU5fVVNFUik7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIG91dF9jbG9zZTsKKwkJ
CWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKKwkJCWlmIChlcnIpCisJ
CQkJZ290byBvdXRfY2xvc2U7CiAKLQkJZXJyID0gaWd0X2NoZWNrX3BhZ2Vfc2l6ZXModm1hKTsK
LQkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VucGluOworCQkJZXJyID0gaWd0X2NoZWNrX3BhZ2Vf
c2l6ZXModm1hKTsKKwkJCWlmIChlcnIpCisJCQkJZ290byBvdXRfdW5waW47CiAKLQkJcGh5cyA9
IGk5MTVfZ2VtX29iamVjdF9nZXRfZG1hX2FkZHJlc3Mob2JqLCAwKTsKLQkJaWYgKCFJU19BTElH
TkVEKHBoeXMsIHBhZ2Vfc2l6ZSkpIHsKLQkJCXByX2VycigiJXMgYWRkciBtaXNhbGlnbmVkKCVw
YSkgcGFnZV9zaXplPSV1XG4iLAotCQkJICAgICAgIF9fZnVuY19fLCAmcGh5cywgcGFnZV9zaXpl
KTsKLQkJCWVyciA9IC1FSU5WQUw7Ci0JCQlnb3RvIG91dF91bnBpbjsKLQkJfQorCQkJcGh5cyA9
IGk5MTVfZ2VtX29iamVjdF9nZXRfZG1hX2FkZHJlc3Mob2JqLCAwKTsKKwkJCWlmICghSVNfQUxJ
R05FRChwaHlzLCBwYWdlX3NpemUpKSB7CisJCQkJcHJfZXJyKCIlcyBhZGRyIG1pc2FsaWduZWQo
JXBhKSBwYWdlX3NpemU9JXVcbiIsCisJCQkJICAgICAgIF9fZnVuY19fLCAmcGh5cywgcGFnZV9z
aXplKTsKKwkJCQllcnIgPSAtRUlOVkFMOworCQkJCWdvdG8gb3V0X3VucGluOworCQkJfQogCi0J
CWlmICh2bWEtPnBhZ2Vfc2l6ZXMuZ3R0ICE9IHBhZ2Vfc2l6ZSkgewotCQkJcHJfZXJyKCIlcyBw
YWdlX3NpemVzLmd0dD0ldSwgZXhwZWN0ZWQ9JXVcbiIsCi0JCQkgICAgICAgX19mdW5jX18sIHZt
YS0+cGFnZV9zaXplcy5ndHQsIHBhZ2Vfc2l6ZSk7Ci0JCQllcnIgPSAtRUlOVkFMOwotCQkJZ290
byBvdXRfdW5waW47Ci0JCX0KKwkJCWlmICh2bWEtPnBhZ2Vfc2l6ZXMuZ3R0ICE9IHBhZ2Vfc2l6
ZSkgeworCQkJCXByX2VycigiJXMgcGFnZV9zaXplcy5ndHQ9JXUsIGV4cGVjdGVkPSV1XG4iLAor
CQkJCSAgICAgICBfX2Z1bmNfXywgdm1hLT5wYWdlX3NpemVzLmd0dCwKKwkJCQkgICAgICAgcGFn
ZV9zaXplKTsKKwkJCQllcnIgPSAtRUlOVkFMOworCQkJCWdvdG8gb3V0X3VucGluOworCQkJfQog
Ci0JCWk5MTVfdm1hX3VucGluKHZtYSk7Ci0JCWk5MTVfdm1hX2Nsb3NlKHZtYSk7CisJCQlpOTE1
X3ZtYV91bnBpbih2bWEpOworCQkJaTkxNV92bWFfY2xvc2Uodm1hKTsKIAotCQlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7CisJCQlfX2k5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXMob2JqLCBJOTE1
X01NX05PUk1BTCk7CisJCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCX0KIAl9CiAKIAln
b3RvIG91dF9yZWdpb247CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9t
ZW1vcnlfcmVnaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9u
LmMKaW5kZXggMmVmNjdjMzk3ZmNhLi45ODAwNjYxOGU4NzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX21lbW9yeV9yZWdpb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmMKQEAgLTQ3LDggKzQ3LDggQEAgX19pbnRlbF9tZW1v
cnlfcmVnaW9uX2dldF9wYWdlc19idWRkeShzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVt
LAogCQkJCSAgICAgIHVuc2lnbmVkIGludCBmbGFncywKIAkJCQkgICAgICBzdHJ1Y3QgbGlzdF9o
ZWFkICpibG9ja3MpCiB7Ci0JdW5zaWduZWQgbG9uZyBuX3BhZ2VzID0gc2l6ZSA+PiBpbG9nMiht
ZW0tPm1tLmNodW5rX3NpemUpOwogCXVuc2lnbmVkIGludCBtaW5fb3JkZXIgPSAwOworCXVuc2ln
bmVkIGxvbmcgbl9wYWdlczsKIAogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoc2l6ZSwgbWVtLT5t
bS5jaHVua19zaXplKSk7CiAJR0VNX0JVR19PTighbGlzdF9lbXB0eShibG9ja3MpKTsKQEAgLTU4
LDYgKzU4LDEzIEBAIF9faW50ZWxfbWVtb3J5X3JlZ2lvbl9nZXRfcGFnZXNfYnVkZHkoc3RydWN0
IGludGVsX21lbW9yeV9yZWdpb24gKm1lbSwKIAkJCSAgICBpbG9nMihtZW0tPm1tLmNodW5rX3Np
emUpOwogCX0KIAorCWlmIChmbGFncyAmIEk5MTVfQUxMT0NfQ09OVElHVU9VUykgeworCQlzaXpl
ID0gcm91bmR1cF9wb3dfb2ZfdHdvKHNpemUpOworCQltaW5fb3JkZXIgPSBpbG9nMihzaXplKSAt
IGlsb2cyKG1lbS0+bW0uY2h1bmtfc2l6ZSk7CisJfQorCisJbl9wYWdlcyA9IHNpemUgPj4gaWxv
ZzIobWVtLT5tbS5jaHVua19zaXplKTsKKwogCW11dGV4X2xvY2soJm1lbS0+bW1fbG9jayk7CiAK
IAlkbyB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVn
aW9uLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9tZW1vcnlfcmVnaW9uLmgKaW5kZXgg
MmVhMTdkNmMzMWVkLi4yOWI4NmNhMTdkZDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX21lbW9yeV9yZWdpb24uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9tZW1vcnlfcmVnaW9uLmgKQEAgLTE4LDcgKzE4LDggQEAgc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3Q7CiBzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbjsKIHN0cnVjdCBzZ190YWJsZTsKIAot
I2RlZmluZSBJOTE1X0FMTE9DX01JTl9QQUdFX1NJWkUgICBCSVQoMCkKKyNkZWZpbmUgSTkxNV9B
TExPQ19NSU5fUEFHRV9TSVpFICBCSVQoMCkKKyNkZWZpbmUgSTkxNV9BTExPQ19DT05USUdVT1VT
ICAgICBCSVQoMSkKIAogc3RydWN0IGludGVsX21lbW9yeV9yZWdpb25fb3BzIHsKIAl1bnNpZ25l
ZCBpbnQgZmxhZ3M7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aW50ZWxfbWVtb3J5X3JlZ2lvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lu
dGVsX21lbW9yeV9yZWdpb24uYwppbmRleCA1M2Y0ZjJkOWY2NTUuLjkxM2ZiOWQ2YjA1YiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVsX21lbW9yeV9yZWdp
b24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfbWVtb3J5X3Jl
Z2lvbi5jCkBAIC0xMyw2ICsxMyw3IEBACiAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcmVnaW9u
LmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuaCIKKyNpbmNsdWRlICJz
ZWxmdGVzdHMvaTkxNV9yYW5kb20uaCIKIAogc3RhdGljIHZvaWQgY2xvc2Vfb2JqZWN0cyhzdHJ1
Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtLAogCQkJICBzdHJ1Y3QgbGlzdF9oZWFkICpvYmpl
Y3RzKQpAQCAtODYsMTAgKzg3LDE3NCBAQCBzdGF0aWMgaW50IGlndF9tb2NrX2ZpbGwodm9pZCAq
YXJnKQogCXJldHVybiBlcnI7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqCitpZ3Rfb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtLAor
CQkgIHN0cnVjdCBsaXN0X2hlYWQgKm9iamVjdHMsCisJCSAgdTY0IHNpemUsCisJCSAgdW5zaWdu
ZWQgaW50IGZsYWdzKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJaW50
IGVycjsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfcmVnaW9uKG1lbSwgc2l6ZSwg
ZmxhZ3MpOworCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIG9iajsKKworCWVyciA9IGk5MTVf
Z2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKKwlpZiAoZXJyKQorCQlnb3RvIHB1dDsKKworCWxp
c3RfYWRkKCZvYmotPnN0X2xpbmssIG9iamVjdHMpOworCXJldHVybiBvYmo7CisKK3B1dDoKKwlp
OTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcmV0dXJuIEVSUl9QVFIoZXJyKTsKK30KKworc3Rh
dGljIHZvaWQgaWd0X29iamVjdF9yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopCit7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CisJX19pOTE1X2dlbV9v
YmplY3RfcHV0X3BhZ2VzKG9iaiwgSTkxNV9NTV9OT1JNQUwpOworCWk5MTVfZ2VtX29iamVjdF9w
dXQob2JqKTsKKwlsaXN0X2RlbCgmb2JqLT5zdF9saW5rKTsKK30KKworc3RhdGljIGludCBpZ3Rf
bW9ja19jb250aWd1b3VzKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lv
biAqbWVtID0gYXJnOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJdW5zaWdu
ZWQgbG9uZyBuX29iamVjdHM7CisJTElTVF9IRUFEKG9iamVjdHMpOworCUxJU1RfSEVBRChob2xl
cyk7CisJSTkxNV9STkRfU1RBVEUocHJuZyk7CisJcmVzb3VyY2Vfc2l6ZV90IHRhcmdldDsKKwly
ZXNvdXJjZV9zaXplX3QgdG90YWw7CisJcmVzb3VyY2Vfc2l6ZV90IG1pbjsKKwlpbnQgZXJyID0g
MDsKKworCXRvdGFsID0gcmVzb3VyY2Vfc2l6ZSgmbWVtLT5yZWdpb24pOworCisJLyogTWluIHNp
emUgKi8KKwlvYmogPSBpZ3Rfb2JqZWN0X2NyZWF0ZShtZW0sICZvYmplY3RzLCBtZW0tPm1tLmNo
dW5rX3NpemUsCisJCQkJSTkxNV9CT19BTExPQ19DT05USUdVT1VTKTsKKwlpZiAoSVNfRVJSKG9i
aikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CisKKwlpZiAob2JqLT5tbS5wYWdlcy0+bmVudHMg
IT0gMSkgeworCQlwcl9lcnIoIiVzIG1pbiBvYmplY3Qgc3BhbnMgbXVsdGlwbGUgc2cgZW50cmll
c1xuIiwgX19mdW5jX18pOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIGVycl9jbG9zZV9vYmpl
Y3RzOworCX0KKworCWlndF9vYmplY3RfcmVsZWFzZShvYmopOworCisJLyogTWF4IHNpemUgKi8K
KwlvYmogPSBpZ3Rfb2JqZWN0X2NyZWF0ZShtZW0sICZvYmplY3RzLCB0b3RhbCwgSTkxNV9CT19B
TExPQ19DT05USUdVT1VTKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9i
aik7CisKKwlpZiAob2JqLT5tbS5wYWdlcy0+bmVudHMgIT0gMSkgeworCQlwcl9lcnIoIiVzIG1h
eCBvYmplY3Qgc3BhbnMgbXVsdGlwbGUgc2cgZW50cmllc1xuIiwgX19mdW5jX18pOworCQllcnIg
PSAtRUlOVkFMOworCQlnb3RvIGVycl9jbG9zZV9vYmplY3RzOworCX0KKworCWlndF9vYmplY3Rf
cmVsZWFzZShvYmopOworCisJLyogSW50ZXJuYWwgZnJhZ21lbnRhdGlvbiBzaG91bGQgbm90IGJs
ZWVkIGludG8gdGhlIG9iamVjdCBzaXplICovCisJdGFyZ2V0ID0gcm91bmRfdXAocHJhbmRvbV91
MzJfc3RhdGUoJnBybmcpICUgdG90YWwsIFBBR0VfU0laRSk7CisJdGFyZ2V0ID0gbWF4X3QodTY0
LCBQQUdFX1NJWkUsIHRhcmdldCk7CisKKwlvYmogPSBpZ3Rfb2JqZWN0X2NyZWF0ZShtZW0sICZv
YmplY3RzLCB0YXJnZXQsCisJCQkJSTkxNV9CT19BTExPQ19DT05USUdVT1VTKTsKKwlpZiAoSVNf
RVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CisKKwlpZiAob2JqLT5iYXNlLnNpemUg
IT0gdGFyZ2V0KSB7CisJCXByX2VycigiJXMgb2JqLT5iYXNlLnNpemUoJWxseCkgIT0gdGFyZ2V0
KCVsbHgpXG4iLCBfX2Z1bmNfXywKKwkJICAgICAgICh1NjQpb2JqLT5iYXNlLnNpemUsICh1NjQp
dGFyZ2V0KTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBlcnJfY2xvc2Vfb2JqZWN0czsKKwl9
CisKKwlpZiAob2JqLT5tbS5wYWdlcy0+bmVudHMgIT0gMSkgeworCQlwcl9lcnIoIiVzIG9iamVj
dCBzcGFucyBtdWx0aXBsZSBzZyBlbnRyaWVzXG4iLCBfX2Z1bmNfXyk7CisJCWVyciA9IC1FSU5W
QUw7CisJCWdvdG8gZXJyX2Nsb3NlX29iamVjdHM7CisJfQorCisJaWd0X29iamVjdF9yZWxlYXNl
KG9iaik7CisKKwkvKgorCSAqIFRyeSB0byBmcmFnbWVudCB0aGUgYWRkcmVzcyBzcGFjZSwgc3Vj
aCB0aGF0IGhhbGYgb2YgaXQgaXMgZnJlZSwgYnV0CisJICogdGhlIG1heCBjb250aWd1b3VzIGJs
b2NrIHNpemUgaXMgU1pfNjRLLgorCSAqLworCisJdGFyZ2V0ID0gU1pfNjRLOworCW5fb2JqZWN0
cyA9IGRpdjY0X3U2NCh0b3RhbCwgdGFyZ2V0KTsKKworCXdoaWxlIChuX29iamVjdHMtLSkgewor
CQlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0OworCisJCWlmIChuX29iamVjdHMgJSAyKQorCQkJbGlz
dCA9ICZob2xlczsKKwkJZWxzZQorCQkJbGlzdCA9ICZvYmplY3RzOworCisJCW9iaiA9IGlndF9v
YmplY3RfY3JlYXRlKG1lbSwgbGlzdCwgdGFyZ2V0LAorCQkJCQlJOTE1X0JPX0FMTE9DX0NPTlRJ
R1VPVVMpOworCQlpZiAoSVNfRVJSKG9iaikpIHsKKwkJCWVyciA9IFBUUl9FUlIob2JqKTsKKwkJ
CWdvdG8gZXJyX2Nsb3NlX29iamVjdHM7CisJCX0KKwl9CisKKwljbG9zZV9vYmplY3RzKG1lbSwg
JmhvbGVzKTsKKworCW1pbiA9IHRhcmdldDsKKwl0YXJnZXQgPSB0b3RhbCA+PiAxOworCisJLyog
TWFrZSBzdXJlIHdlIGNhbiBzdGlsbCBhbGxvY2F0ZSBhbGwgdGhlIGZyYWdtZW50ZWQgc3BhY2Ug
Ki8KKwlvYmogPSBpZ3Rfb2JqZWN0X2NyZWF0ZShtZW0sICZvYmplY3RzLCB0YXJnZXQsIDApOwor
CWlmIChJU19FUlIob2JqKSkgeworCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCWdvdG8gZXJyX2Ns
b3NlX29iamVjdHM7CisJfQorCisJaWd0X29iamVjdF9yZWxlYXNlKG9iaik7CisKKwkvKgorCSAq
IEV2ZW4gdGhvdWdoIHdlIGhhdmUgZW5vdWdoIGZyZWUgc3BhY2UsIHdlIGRvbid0IGhhdmUgYSBi
aWcgZW5vdWdoCisJICogY29udGlndW91cyBibG9jay4gTWFrZSBzdXJlIHRoYXQgaG9sZHMgdHJ1
ZS4KKwkgKi8KKworCWRvIHsKKwkJYm9vbCBzaG91bGRfZmFpbCA9IHRhcmdldCA+IG1pbjsKKwor
CQlvYmogPSBpZ3Rfb2JqZWN0X2NyZWF0ZShtZW0sICZvYmplY3RzLCB0YXJnZXQsCisJCQkJCUk5
MTVfQk9fQUxMT0NfQ09OVElHVU9VUyk7CisJCWlmIChzaG91bGRfZmFpbCAhPSBJU19FUlIob2Jq
KSkgeworCQkJcHJfZXJyKCIlcyB0YXJnZXQgYWxsb2NhdGlvbiglbGx4KSBtaXNtYXRjaFxuIiwK
KwkJCSAgICAgICBfX2Z1bmNfXywgKHU2NCl0YXJnZXQpOworCQkJZXJyID0gLUVJTlZBTDsKKwkJ
CWdvdG8gZXJyX2Nsb3NlX29iamVjdHM7CisJCX0KKworCQl0YXJnZXQgPj49IDE7CisJfSB3aGls
ZSAodGFyZ2V0ID49IG1lbS0+bW0uY2h1bmtfc2l6ZSk7CisKK2Vycl9jbG9zZV9vYmplY3RzOgor
CWxpc3Rfc3BsaWNlX3RhaWwoJmhvbGVzLCAmb2JqZWN0cyk7CisJY2xvc2Vfb2JqZWN0cyhtZW0s
ICZvYmplY3RzKTsKKwlyZXR1cm4gZXJyOworfQorCiBpbnQgaW50ZWxfbWVtb3J5X3JlZ2lvbl9t
b2NrX3NlbGZ0ZXN0cyh2b2lkKQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0
IHRlc3RzW10gPSB7CiAJCVNVQlRFU1QoaWd0X21vY2tfZmlsbCksCisJCVNVQlRFU1QoaWd0X21v
Y2tfY29udGlndW91cyksCiAJfTsKIAlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtOwog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfcmVnaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvbW9ja19yZWdpb24uYwppbmRleCAwZTlhNTc1ZWRlM2IuLjdiMGM5OWRkYzJkNSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfcmVnaW9uLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfcmVnaW9uLmMKQEAgLTM2
LDcgKzM2LDcgQEAgbW9ja19vYmplY3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9u
ICptZW0sCiAKIAlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShvYmosIEk5MTVf
Q0FDSEVfTk9ORSk7CiAKLQlpOTE1X2dlbV9vYmplY3RfaW5pdF9tZW1vcnlfcmVnaW9uKG9iaiwg
bWVtKTsKKwlpOTE1X2dlbV9vYmplY3RfaW5pdF9tZW1vcnlfcmVnaW9uKG9iaiwgbWVtLCBmbGFn
cyk7CiAKIAlyZXR1cm4gb2JqOwogfQotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

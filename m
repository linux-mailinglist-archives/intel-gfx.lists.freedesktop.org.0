Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 543134DCF8
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 23:46:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DC3046E7F1;
	Thu, 20 Jun 2019 21:46:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6307E6E7F1
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 21:46:18 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 20 Jun 2019 23:46:09 +0200
Message-Id: <20190620214613.14481-6-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
References: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/9] drm/i915: Pass intel state to plane
 functions as well
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4
LmludGVsLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3Bs
YW5lLmMgfCAzOSArKysrKysrLS0tLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
YXRvbWljX3BsYW5lLmggfCAgNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMgIHwgNTggKysrKysrKysrLS0tLS0tLS0tLQogMyBmaWxlcyBjaGFuZ2VkLCA0
OSBpbnNlcnRpb25zKCspLCA1MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuYwppbmRleCAzMGJkNGU3NmZmZjkuLjAy
NWMwOTQ2MWM5YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9hdG9taWNfcGxhbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2F0b21pY19wbGFuZS5jCkBAIC0xNzYsMzMgKzE3NiwzNiBAQCBpbnQgaW50ZWxfcGxhbmVfYXRv
bWljX2NoZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjXwogCW5ld19jcnRjX3N0YXRlLT5kYXRhX3JhdGVbcGxhbmUtPmlkXSA9CiAJCWludGVsX3Bs
YW5lX2RhdGFfcmF0ZShuZXdfY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKTsKIAotCXJldHVy
biBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKG9sZF9jcnRjX3N0YXRlLAotCQkJCQkg
ICAgICAgJm5ld19jcnRjX3N0YXRlLT5iYXNlLAotCQkJCQkgICAgICAgb2xkX3BsYW5lX3N0YXRl
LAotCQkJCQkgICAgICAgJm5ld19wbGFuZV9zdGF0ZS0+YmFzZSk7CisJcmV0dXJuIGludGVsX3Bs
YW5lX2F0b21pY19jYWxjX2NoYW5nZXMob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLAor
CQkJCQkgICAgICAgb2xkX3BsYW5lX3N0YXRlLCBuZXdfcGxhbmVfc3RhdGUpOwogfQogCiBzdGF0
aWMgaW50IGludGVsX3BsYW5lX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwK
IAkJCQkgICAgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlKQogewotCXN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSA9IG5ld19wbGFuZV9zdGF0ZS0+c3RhdGU7Ci0J
Y29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRlID0KLQkJZHJtX2F0
b21pY19nZXRfb2xkX3BsYW5lX3N0YXRlKHN0YXRlLCBwbGFuZSk7Ci0Jc3RydWN0IGRybV9jcnRj
ICpjcnRjID0gbmV3X3BsYW5lX3N0YXRlLT5jcnRjID86IG9sZF9wbGFuZV9zdGF0ZS0+Y3J0YzsK
LQljb25zdCBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlOwotCXN0cnVjdCBk
cm1fY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7Ci0KLQluZXdfcGxhbmVfc3RhdGUtPnZpc2li
bGUgPSBmYWxzZTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9CisJCXRvX2lu
dGVsX2F0b21pY19zdGF0ZShuZXdfcGxhbmVfc3RhdGUtPnN0YXRlKTsKKwljb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKm9sZF9pbnRlbF9wbGFuZV9zdGF0ZSA9CisJCWludGVsX2F0b21p
Y19nZXRfb2xkX3BsYW5lX3N0YXRlKHN0YXRlLCB0b19pbnRlbF9wbGFuZShwbGFuZSkpOworCXN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X2ludGVsX3BsYW5lX3N0YXRlID0KKwkJdG9faW50
ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5lX3N0YXRlKTsKKwlzdHJ1Y3QgZHJtX2NydGMgKmNydGMg
PQorCQluZXdfaW50ZWxfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YyA/OiBvbGRfaW50ZWxfcGxhbmVf
c3RhdGUtPmJhc2UuY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IGNydGMg
PyB0b19pbnRlbF9jcnRjKGNydGMpIDogTlVMTDsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqb2xkX2NydGNfc3RhdGU7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRj
X3N0YXRlOworCisJbmV3X2ludGVsX3BsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUgPSBmYWxzZTsK
IAlpZiAoIWNydGMpCiAJCXJldHVybiAwOwogCi0Jb2xkX2NydGNfc3RhdGUgPSBkcm1fYXRvbWlj
X2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7Ci0JbmV3X2NydGNfc3RhdGUgPSBkcm1f
YXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CisJb2xkX2NydGNfc3RhdGUg
PSBpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0YXRlLCBpbnRlbF9jcnRjKTsKKwlu
ZXdfY3J0Y19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIGlu
dGVsX2NydGMpOwogCi0JcmV0dXJuIGludGVsX3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRl
KHRvX2ludGVsX2NydGNfc3RhdGUob2xkX2NydGNfc3RhdGUpLAotCQkJCQkJICAgdG9faW50ZWxf
Y3J0Y19zdGF0ZShuZXdfY3J0Y19zdGF0ZSksCi0JCQkJCQkgICB0b19pbnRlbF9wbGFuZV9zdGF0
ZShvbGRfcGxhbmVfc3RhdGUpLAotCQkJCQkJICAgdG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3Bs
YW5lX3N0YXRlKSk7CisJcmV0dXJuIGludGVsX3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRl
KG9sZF9jcnRjX3N0YXRlLAorCQkJCQkJICAgbmV3X2NydGNfc3RhdGUsCisJCQkJCQkgICBvbGRf
aW50ZWxfcGxhbmVfc3RhdGUsCisJCQkJCQkgICBuZXdfaW50ZWxfcGxhbmVfc3RhdGUpOwogfQog
CiBzdGF0aWMgc3RydWN0IGludGVsX3BsYW5lICoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5oCmluZGV4IDE0MzdhODc5N2UxMC4uY2I3ZWY0
ZjllYWZkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0
b21pY19wbGFuZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRv
bWljX3BsYW5lLmgKQEAgLTgsNyArOCw2IEBACiAKICNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgog
Ci1zdHJ1Y3QgZHJtX2NydGNfc3RhdGU7CiBzdHJ1Y3QgZHJtX3BsYW5lOwogc3RydWN0IGRybV9w
cm9wZXJ0eTsKIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGU7CkBAIC00Myw4ICs0Miw4IEBAIGlu
dCBpbnRlbF9wbGFuZV9hdG9taWNfY2hlY2tfd2l0aF9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqb2xkX2NydGNfCiAJCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqb2xkX3BsYW5lX3N0YXRlLAogCQkJCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKmludGVs
X3N0YXRlKTsKIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKLQkJCQkgICAgc3RydWN0IGRybV9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAkJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRf
cGxhbmVfc3RhdGUsCi0JCQkJICAgIHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KTsKKwkJCQkgICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiAKICNl
bmRpZiAvKiBfX0lOVEVMX0FUT01JQ19QTEFORV9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggYmFhMGUxOTU3ZmZlLi41YzFkYjFkM2Qx
MmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBA
IC0xMTI4Niw3ICsxMTI4Niw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfZGVzdHJveShzdHJ1
Y3QgZHJtX2NydGMgKmNydGMpCiAgKgogICogUmV0dXJucyB0cnVlIG9yIGZhbHNlLgogICovCi1z
dGF0aWMgYm9vbCBpbnRlbF93bV9uZWVkX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KmN1ciwKK3N0YXRpYyBib29sIGludGVsX3dtX25lZWRfdXBkYXRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqY3VyLAogCQkJCSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ldykK
IHsKIAkvKiBVcGRhdGUgd2F0ZXJtYXJrcyBvbiB0aWxpbmcgb3Igc2l6ZSBjaGFuZ2VzLiAqLwpA
QCAtMTEzMTgsMzMgKzExMzE4LDI4IEBAIHN0YXRpYyBib29sIG5lZWRzX3NjYWxpbmcoY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzdGF0ZSkKIH0KIAogaW50IGludGVsX3BsYW5lX2F0
b21pY19jYWxjX2NoYW5nZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRj
X3N0YXRlLAotCQkJCSAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJ
ICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSwKLQkJCQkgICAgc3RydWN0
IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCisJCQkJICAgIHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVf
Y29uZmlnID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjX3N0YXRlKTsKLQlzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMgPSBjcnRjX3N0YXRlLT5jcnRjOwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjID0gdG9faW50ZWxfY3J0YyhjcnRjKTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0g
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gY3J0Yy0+ZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKLQlib29sIG1vZGVfY2hhbmdlZCA9IG5lZWRzX21vZGVzZXQocGlwZV9jb25m
aWcpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRl
LT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJYm9vbCBtb2RlX2NoYW5nZWQgPSBu
ZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpOwogCWJvb2wgd2FzX2NydGNfZW5hYmxlZCA9IG9sZF9j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZTsKLQlib29sIGlzX2NydGNfZW5hYmxlZCA9IGNydGNfc3Rh
dGUtPmFjdGl2ZTsKKwlib29sIGlzX2NydGNfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmJhc2UuYWN0
aXZlOwogCWJvb2wgdHVybl9vZmYsIHR1cm5fb24sIHZpc2libGUsIHdhc192aXNpYmxlOwotCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmZiOworCXN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CiAJaW50IHJldDsKIAogCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkgJiYgcGxhbmUtPmlkICE9IFBMQU5FX0NVUlNPUikg
ewotCQlyZXQgPSBza2xfdXBkYXRlX3NjYWxlcl9wbGFuZSgKLQkJCXRvX2ludGVsX2NydGNfc3Rh
dGUoY3J0Y19zdGF0ZSksCi0JCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShwbGFuZV9zdGF0ZSkpOwor
CQlyZXQgPSBza2xfdXBkYXRlX3NjYWxlcl9wbGFuZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7
CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCX0KIAogCXdhc192aXNpYmxlID0gb2xkX3Bs
YW5lX3N0YXRlLT5iYXNlLnZpc2libGU7Ci0JdmlzaWJsZSA9IHBsYW5lX3N0YXRlLT52aXNpYmxl
OworCXZpc2libGUgPSBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlOwogCiAJaWYgKCF3YXNfY3J0
Y19lbmFibGVkICYmIFdBUk5fT04od2FzX3Zpc2libGUpKQogCQl3YXNfdmlzaWJsZSA9IGZhbHNl
OwpAQCAtMTEzNjAsMjIgKzExMzU1LDIyIEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19j
aGFuZ2VzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0CiAJICog
b25seSBjb21iaW5lIHRoZSByZXN1bHRzIGZyb20gYWxsIHBsYW5lcyBpbiB0aGUgY3VycmVudCBw
bGFjZT8KIAkgKi8KIAlpZiAoIWlzX2NydGNfZW5hYmxlZCkgewotCQlwbGFuZV9zdGF0ZS0+dmlz
aWJsZSA9IHZpc2libGUgPSBmYWxzZTsKLQkJdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjX3N0YXRl
KS0+YWN0aXZlX3BsYW5lcyAmPSB+QklUKHBsYW5lLT5pZCk7Ci0JCXRvX2ludGVsX2NydGNfc3Rh
dGUoY3J0Y19zdGF0ZSktPmRhdGFfcmF0ZVtwbGFuZS0+aWRdID0gMDsKKwkJcGxhbmVfc3RhdGUt
PmJhc2UudmlzaWJsZSA9IHZpc2libGUgPSBmYWxzZTsKKwkJY3J0Y19zdGF0ZS0+YWN0aXZlX3Bs
YW5lcyAmPSB+QklUKHBsYW5lLT5pZCk7CisJCWNydGNfc3RhdGUtPmRhdGFfcmF0ZVtwbGFuZS0+
aWRdID0gMDsKIAl9CiAKIAlpZiAoIXdhc192aXNpYmxlICYmICF2aXNpYmxlKQogCQlyZXR1cm4g
MDsKIAogCWlmIChmYiAhPSBvbGRfcGxhbmVfc3RhdGUtPmJhc2UuZmIpCi0JCXBpcGVfY29uZmln
LT5mYl9jaGFuZ2VkID0gdHJ1ZTsKKwkJY3J0Y19zdGF0ZS0+ZmJfY2hhbmdlZCA9IHRydWU7CiAK
IAl0dXJuX29mZiA9IHdhc192aXNpYmxlICYmICghdmlzaWJsZSB8fCBtb2RlX2NoYW5nZWQpOwog
CXR1cm5fb24gPSB2aXNpYmxlICYmICghd2FzX3Zpc2libGUgfHwgbW9kZV9jaGFuZ2VkKTsKIAog
CURSTV9ERUJVR19BVE9NSUMoIltDUlRDOiVkOiVzXSBoYXMgW1BMQU5FOiVkOiVzXSB3aXRoIGZi
ICVpXG4iLAotCQkJIGludGVsX2NydGMtPmJhc2UuYmFzZS5pZCwgaW50ZWxfY3J0Yy0+YmFzZS5u
YW1lLAorCQkJIGNydGMtPmJhc2UuYmFzZS5pZCwgY3J0Yy0+YmFzZS5uYW1lLAogCQkJIHBsYW5l
LT5iYXNlLmJhc2UuaWQsIHBsYW5lLT5iYXNlLm5hbWUsCiAJCQkgZmIgPyBmYi0+YmFzZS5pZCA6
IC0xKTsKIApAQCAtMTEzODYsMjkgKzExMzgxLDI4IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNf
Y2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0
CiAKIAlpZiAodHVybl9vbikgewogCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDUgJiYgIUlT
X0c0WChkZXZfcHJpdikpCi0JCQlwaXBlX2NvbmZpZy0+dXBkYXRlX3dtX3ByZSA9IHRydWU7CisJ
CQljcnRjX3N0YXRlLT51cGRhdGVfd21fcHJlID0gdHJ1ZTsKIAogCQkvKiBtdXN0IGRpc2FibGUg
Y3hzciBhcm91bmQgcGxhbmUgZW5hYmxlL2Rpc2FibGUgKi8KIAkJaWYgKHBsYW5lLT5pZCAhPSBQ
TEFORV9DVVJTT1IpCi0JCQlwaXBlX2NvbmZpZy0+ZGlzYWJsZV9jeHNyID0gdHJ1ZTsKKwkJCWNy
dGNfc3RhdGUtPmRpc2FibGVfY3hzciA9IHRydWU7CiAJfSBlbHNlIGlmICh0dXJuX29mZikgewog
CQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDUgJiYgIUlTX0c0WChkZXZfcHJpdikpCi0JCQlw
aXBlX2NvbmZpZy0+dXBkYXRlX3dtX3Bvc3QgPSB0cnVlOworCQkJY3J0Y19zdGF0ZS0+dXBkYXRl
X3dtX3Bvc3QgPSB0cnVlOwogCiAJCS8qIG11c3QgZGlzYWJsZSBjeHNyIGFyb3VuZCBwbGFuZSBl
bmFibGUvZGlzYWJsZSAqLwogCQlpZiAocGxhbmUtPmlkICE9IFBMQU5FX0NVUlNPUikKLQkJCXBp
cGVfY29uZmlnLT5kaXNhYmxlX2N4c3IgPSB0cnVlOwotCX0gZWxzZSBpZiAoaW50ZWxfd21fbmVl
ZF91cGRhdGUodG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmUtPmJhc2Uuc3RhdGUpLAotCQkJCQl0
b19pbnRlbF9wbGFuZV9zdGF0ZShwbGFuZV9zdGF0ZSkpKSB7CisJCQljcnRjX3N0YXRlLT5kaXNh
YmxlX2N4c3IgPSB0cnVlOworCX0gZWxzZSBpZiAoaW50ZWxfd21fbmVlZF91cGRhdGUob2xkX3Bs
YW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSkpIHsKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA1
ICYmICFJU19HNFgoZGV2X3ByaXYpKSB7CiAJCQkvKiBGSVhNRSBib2xsb2NrcyAqLwotCQkJcGlw
ZV9jb25maWctPnVwZGF0ZV93bV9wcmUgPSB0cnVlOwotCQkJcGlwZV9jb25maWctPnVwZGF0ZV93
bV9wb3N0ID0gdHJ1ZTsKKwkJCWNydGNfc3RhdGUtPnVwZGF0ZV93bV9wcmUgPSB0cnVlOworCQkJ
Y3J0Y19zdGF0ZS0+dXBkYXRlX3dtX3Bvc3QgPSB0cnVlOwogCQl9CiAJfQogCiAJaWYgKHZpc2li
bGUgfHwgd2FzX3Zpc2libGUpCi0JCXBpcGVfY29uZmlnLT5mYl9iaXRzIHw9IHBsYW5lLT5mcm9u
dGJ1ZmZlcl9iaXQ7CisJCWNydGNfc3RhdGUtPmZiX2JpdHMgfD0gcGxhbmUtPmZyb250YnVmZmVy
X2JpdDsKIAogCS8qCiAJICogSUxLL1NOQiBEVlNBQ05UUi9TcHJpdGUgRW5hYmxlCkBAIC0xMTQ0
Nyw4ICsxMTQ0MSw4IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0CiAJICAgIChJU19HRU5fUkFO
R0UoZGV2X3ByaXYsIDUsIDYpIHx8CiAJICAgICBJU19JVllCUklER0UoZGV2X3ByaXYpKSAmJgog
CSAgICAodHVybl9vbiB8fCAoIW5lZWRzX3NjYWxpbmcob2xkX3BsYW5lX3N0YXRlKSAmJgotCQkJ
IG5lZWRzX3NjYWxpbmcodG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmVfc3RhdGUpKSkpKQotCQlw
aXBlX2NvbmZpZy0+ZGlzYWJsZV9scF93bSA9IHRydWU7CisJCQkgbmVlZHNfc2NhbGluZyhwbGFu
ZV9zdGF0ZSkpKSkKKwkJY3J0Y19zdGF0ZS0+ZGlzYWJsZV9scF93bSA9IHRydWU7CiAKIAlyZXR1
cm4gMDsKIH0KLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A84DBEAEDE
	for <lists+intel-gfx@lfdr.de>; Thu, 31 Oct 2019 12:26:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E73146EE37;
	Thu, 31 Oct 2019 11:26:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C91396EE40
 for <intel-gfx@lists.freedesktop.org>; Thu, 31 Oct 2019 11:26:17 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 31 Oct 2019 12:26:07 +0100
Message-Id: <20191031112610.27608-9-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
References: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 09/12] drm/i915: Perform automated conversions
 for plane uapi/hw split, base -> hw.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgcGxhbmVfc3RhdGUtPmJhc2UgdG8gaHcuIFRoaXMgaXMgZG9uZSB1c2luZyB0aGUg
Zm9sbG93aW5nIHBhdGNoOgoKQEAKc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpUOwppZGVudGlm
aWVyIHggPX4gIl4oY3J0Y3xmYnxhbHBoYXxwaXhlbF9ibGVuZF9tb2RlfHJvdGF0aW9ufGNvbG9y
X2VuY29kaW5nfGNvbG9yX3JhbmdlKSQiOwpAQAotVC0+YmFzZS54CitULT5ody54CgpTaWduZWQt
b2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4Lmlu
dGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5j
ICAgfCAgIDYgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUu
YyB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMg
IHwgMTI2ICsrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9mYmMuYyAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX292ZXJsYXkuYyAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfc3ByaXRlLmMgICB8ICA5MCArKysrKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jICAgICAgICAgICAgICAgfCAgMzIgKystLS0KIDcgZmlsZXMgY2hhbmdlZCwgMTM2
IGluc2VydGlvbnMoKyksIDEzNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9hdG9taWMuYwppbmRleCAzMzAxYzE3OGRhMDMuLjBhNWVlZTRjMzUwZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0yODMs
OSArMjgzLDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcihzdHJ1Y3Qg
aW50ZWxfY3J0Y19zY2FsZXJfc3RhdGUgKnNjYWxlcl9zdGEKIAkJcmV0dXJuOwogCiAJLyogc2V0
IHNjYWxlciBtb2RlICovCi0JaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT5iYXNlLmZi
ICYmCi0JICAgIHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmlzX3l1diAmJgotCSAgICBw
bGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5udW1fcGxhbmVzID4gMSkgeworCWlmIChwbGFu
ZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+aHcuZmIgJiYKKwkgICAgcGxhbmVfc3RhdGUtPmh3LmZi
LT5mb3JtYXQtPmlzX3l1diAmJgorCSAgICBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+bnVt
X3BsYW5lcyA+IDEpIHsKIAkJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAkJaWYgKElTX0dFTihkZXZfcHJpdiwgOSkg
JiYKIAkJICAgICFJU19HRU1JTklMQUtFKGRldl9wcml2KSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMKaW5kZXggNDE2Y2ZhNDM5ZjMz
Li42MzM1MzU1NTU1YjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfYXRvbWljX3BsYW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9hdG9taWNfcGxhbmUuYwpAQCAtMTE4LDcgKzExOCw3IEBAIGludGVsX3BsYW5lX2Rlc3Ry
b3lfc3RhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiB1bnNpZ25lZCBpbnQgaW50ZWxfcGxh
bmVfZGF0YV9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0J
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsK
Kwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
IAl1bnNpZ25lZCBpbnQgY3BwOwogCiAJaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQpA
QCAtMTQ0LDcgKzE0NCw3IEBAIGJvb2wgaW50ZWxfcGxhbmVfY2FsY19taW5fY2RjbGsoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X25ld19wbGFuZV9z
dGF0ZShzdGF0ZSwgcGxhbmUpOwotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9
IHRvX2ludGVsX2NydGMocGxhbmVfc3RhdGUtPmh3LmNydGMpOwogCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlOwogCiAJaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlIHx8
ICFwbGFuZS0+bWluX2NkY2xrKQpAQCAtMTgyLDcgKzE4Miw3IEBAIGludCBpbnRlbF9wbGFuZV9h
dG9taWNfY2hlY2tfd2l0aF9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xk
X2NydGNfCiAJCQkJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlKQog
ewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShuZXdfcGxhbmVf
c3RhdGUtPmJhc2UucGxhbmUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
bmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gbmV3X3BsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgcmV0OwogCiAJbmV3X2NydGNfc3Rh
dGUtPmFjdGl2ZV9wbGFuZXMgJj0gfkJJVChwbGFuZS0+aWQpOwpAQCAtMTkyLDcgKzE5Miw3IEBA
IGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2hlY2tfd2l0aF9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfCiAJbmV3X2NydGNfc3RhdGUtPm1pbl9jZGNsa1twbGFu
ZS0+aWRdID0gMDsKIAluZXdfcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IGZhbHNlOwogCi0J
aWYgKCFuZXdfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YyAmJiAhb2xkX3BsYW5lX3N0YXRlLT5iYXNl
LmNydGMpCisJaWYgKCFuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMgJiYgIW9sZF9wbGFuZV9zdGF0
ZS0+aHcuY3J0YykKIAkJcmV0dXJuIDA7CiAKIAlyZXQgPSBwbGFuZS0+Y2hlY2tfcGxhbmUobmV3
X2NydGNfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGYyNDRjNmEwMTBiYy4uOWM2NjAxMDhkOTcyIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMjIx
NSw3ICsyMjE1LDcgQEAgdTMyIGludGVsX2ZiX3h5X3RvX2xpbmVhcihpbnQgeCwgaW50IHksCiAJ
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsCiAJCQkgIGludCBjb2xv
cl9wbGFuZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHN0YXRlLT5i
YXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUtPmh3LmZi
OwogCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbY29sb3JfcGxhbmVdOwogCXVu
c2lnbmVkIGludCBwaXRjaCA9IHN0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0uc3RyaWRl
OwogCkBAIC0yMzE2LDggKzIzMTYsOCBAQCBzdGF0aWMgdTMyIGludGVsX3BsYW5lX2FkanVzdF9h
bGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKIAkJCQkJICAgICBpbnQgY29sb3JfcGxhbmUs
CiAJCQkJCSAgICAgdTMyIG9sZF9vZmZzZXQsIHUzMiBuZXdfb2Zmc2V0KQogewotCXJldHVybiBp
bnRlbF9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoeCwgeSwgc3RhdGUtPmJhc2UuZmIsIGNvbG9yX3Bs
YW5lLAotCQkJCQkgICBzdGF0ZS0+YmFzZS5yb3RhdGlvbiwKKwlyZXR1cm4gaW50ZWxfYWRqdXN0
X2FsaWduZWRfb2Zmc2V0KHgsIHksIHN0YXRlLT5ody5mYiwgY29sb3JfcGxhbmUsCisJCQkJCSAg
IHN0YXRlLT5ody5yb3RhdGlvbiwKIAkJCQkJICAgc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3Bs
YW5lXS5zdHJpZGUsCiAJCQkJCSAgIG9sZF9vZmZzZXQsIG5ld19vZmZzZXQpOwogfQpAQCAtMjM5
Myw4ICsyMzkzLDggQEAgc3RhdGljIHUzMiBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zm
c2V0KGludCAqeCwgaW50ICp5LAogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUg
PSB0b19pbnRlbF9wbGFuZShzdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQg
aW50IHJvdGF0aW9uID0gc3RhdGUtPmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBzdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0g
c3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBwaXRjaCA9IHN0YXRlLT5jb2xvcl9wbGFuZVtjb2xv
cl9wbGFuZV0uc3RyaWRlOwogCXUzMiBhbGlnbm1lbnQ7CiAKQEAgLTI1ODEsNyArMjU4MSw3IEBA
IGJvb2wgaW50ZWxfcGxhbmVfY2FuX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVs
X3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgaTsKIAogCS8q
IFdlIGRvbid0IHdhbnQgdG8gZGVhbCB3aXRoIHJlbWFwcGluZyB3aXRoIGN1cnNvcnMgKi8KQEAg
LTI2MjAsOCArMjYyMCw4IEBAIGJvb2wgaW50ZWxfcGxhbmVfY2FuX3JlbWFwKGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0aWMgYm9vbCBpbnRlbF9wbGFu
ZV9uZWVkc19yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9z
dGF0ZS0+YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBw
bGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0
ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+
aHcucm90YXRpb247CiAJdTMyIHN0cmlkZSwgbWF4X3N0cmlkZTsKIAogCS8qCkBAIC0yODEyLDEw
ICsyODEyLDEwIEBAIGludGVsX3BsYW5lX3JlbWFwX2d0dChzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0Jc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwlzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlzdHJ1Y3QgaW50ZWxfZnJhbWVidWZm
ZXIgKmludGVsX2ZiID0gdG9faW50ZWxfZnJhbWVidWZmZXIoZmIpOwogCXN0cnVjdCBpbnRlbF9y
b3RhdGlvbl9pbmZvICppbmZvID0gJnBsYW5lX3N0YXRlLT52aWV3LnJvdGF0ZWQ7Ci0JdW5zaWdu
ZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJdW5zaWduZWQg
aW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBpLCBudW1fcGxh
bmVzID0gZmItPmZvcm1hdC0+bnVtX3BsYW5lczsKIAl1bnNpZ25lZCBpbnQgdGlsZV9zaXplID0g
aW50ZWxfdGlsZV9zaXplKGRldl9wcml2KTsKIAl1bnNpZ25lZCBpbnQgc3JjX3gsIHNyY195OwpA
QCAtMjkyMSw4ICsyOTIxLDggQEAgc3RhdGljIGludAogaW50ZWxfcGxhbmVfY29tcHV0ZV9ndHQo
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3Qg
aW50ZWxfZnJhbWVidWZmZXIgKmZiID0KLQkJdG9faW50ZWxfZnJhbWVidWZmZXIocGxhbmVfc3Rh
dGUtPmJhc2UuZmIpOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNl
LnJvdGF0aW9uOworCQl0b19pbnRlbF9mcmFtZWJ1ZmZlcihwbGFuZV9zdGF0ZS0+aHcuZmIpOwor
CXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAlpbnQg
aSwgbnVtX3BsYW5lczsKIAogCWlmICghZmIpCkBAIC0zMjI1LDcgKzMyMjUsNyBAQCBpbnRlbF9m
aW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkJ
Y29udGludWU7CiAKIAkJaWYgKGludGVsX3BsYW5lX2dndHRfb2Zmc2V0KHN0YXRlKSA9PSBwbGFu
ZV9jb25maWctPmJhc2UpIHsKLQkJCWZiID0gc3RhdGUtPmJhc2UuZmI7CisJCQlmYiA9IHN0YXRl
LT5ody5mYjsKIAkJCWRybV9mcmFtZWJ1ZmZlcl9nZXQoZmIpOwogCQkJZ290byB2YWxpZF9mYjsK
IAkJfQpAQCAtMzI0MywxMSArMzI0MywxMSBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2Jq
KHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCXJldHVybjsKIAogdmFsaWRfZmI6Ci0J
aW50ZWxfc3RhdGUtPmJhc2Uucm90YXRpb24gPSBwbGFuZV9jb25maWctPnJvdGF0aW9uOworCWlu
dGVsX3N0YXRlLT5ody5yb3RhdGlvbiA9IHBsYW5lX2NvbmZpZy0+cm90YXRpb247CiAJaW50ZWxf
ZmlsbF9mYl9nZ3R0X3ZpZXcoJmludGVsX3N0YXRlLT52aWV3LCBmYiwKLQkJCQlpbnRlbF9zdGF0
ZS0+YmFzZS5yb3RhdGlvbik7CisJCQkJaW50ZWxfc3RhdGUtPmh3LnJvdGF0aW9uKTsKIAlpbnRl
bF9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlID0KLQkJaW50ZWxfZmJfcGl0Y2goZmIsIDAs
IGludGVsX3N0YXRlLT5iYXNlLnJvdGF0aW9uKTsKKwkJaW50ZWxfZmJfcGl0Y2goZmIsIDAsIGlu
dGVsX3N0YXRlLT5ody5yb3RhdGlvbik7CiAKIAlpbnRlbF9zdGF0ZS0+dm1hID0KIAkJaW50ZWxf
cGluX2FuZF9mZW5jZV9mYl9vYmooZmIsCkBAIC0zMzc0LDcgKzMzNzQsNyBAQCBzdGF0aWMgaW50
IGljbF9tYXhfcGxhbmVfaGVpZ2h0KHZvaWQpCiBzdGF0aWMgYm9vbCBza2xfY2hlY2tfbWFpbl9j
Y3NfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJ
CQkJICAgaW50IG1haW5feCwgaW50IG1haW5feSwgdTMyIG1haW5fb2Zmc2V0KQogewotCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50
IGhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOwogCWludCB2c3ViID0gZmItPmZvcm1hdC0+dnN1YjsK
IAlpbnQgYXV4X3ggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ueDsKQEAgLTM0MTIsOCAr
MzQxMiw4IEBAIHN0YXRpYyBib29sIHNrbF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlCiBzdGF0aWMgaW50IHNrbF9jaGVja19t
YWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT5i
YXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUt
PmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3
LnJvdGF0aW9uOwogCWludCB4ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLngxID4+IDE2OwogCWlu
dCB5ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLnkxID4+IDE2OwogCWludCB3ID0gZHJtX3JlY3Rf
d2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CkBAIC0zNTA4LDggKzM1MDgsOCBA
QCBzdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKIAogc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFj
ZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQg
aW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50
IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBtYXhfd2lkdGggPSBz
a2xfbWF4X3BsYW5lX3dpZHRoKGZiLCAxLCByb3RhdGlvbik7CiAJaW50IG1heF9oZWlnaHQgPSA0
MDk2OwogCWludCB4ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLngxID4+IDE3OwpAQCAtMzUzNyw3
ICszNTM3LDcgQEAgc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiBzdGF0aWMgaW50IHNrbF9jaGVja19j
Y3NfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsK
LQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZi
OworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OwogCWludCBzcmNfeCA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKIAlpbnQgc3Jj
X3kgPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueTEgPj4gMTY7CiAJaW50IGhzdWIgPSBmYi0+Zm9y
bWF0LT5oc3ViOwpAQCAtMzU1OCw3ICszNTU4LDcgQEAgc3RhdGljIGludCBza2xfY2hlY2tfY2Nz
X2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIGlu
dCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7CiAJaW50IHJldDsKIAogCXJldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0
KHBsYW5lX3N0YXRlKTsKQEAgLTM1OTcsNyArMzU5Nyw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfcGxh
bmVfcmF0aW8oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkg
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJCQkgICAg
IHVuc2lnbmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKIHsKLQljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGlu
dCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAkvKgpAQCAtMzY5MCw4ICszNjkwLDggQEAg
c3RhdGljIHUzMiBpOXh4X3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0
b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJv
dGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0
aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCXUzMiBkc3BjbnRyOwogCiAJZHNwY250
ciA9IERJU1BMQVlfUExBTkVfRU5BQkxFOwpAQCAtMzc0Nyw3ICszNzQ3LDcgQEAgaW50IGk5eHhf
Y2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxh
bmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgc3JjX3gsIHNyY195LCBzcmNfdzsK
IAl1MzIgb2Zmc2V0OwogCWludCByZXQ7CkBAIC0zNzg0LDcgKzM3ODQsNyBAQCBpbnQgaTl4eF9j
aGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
CiAKIAkvKiBIU1cvQkRXIGRvIHRoaXMgYXV0b21hZ2ljYWxseSBpbiBoYXJkd2FyZSAqLwogCWlm
ICghSVNfSEFTV0VMTChkZXZfcHJpdikgJiYgIUlTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKLQkJ
dW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJCXVu
c2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAkJaW50IHNy
Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CiAJCWlu
dCBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsK
IApAQCAtNDAzNyw4ICs0MDM3LDggQEAgc3RhdGljIHVuc2lnbmVkIGludCBza2xfcGxhbmVfc3Ry
aWRlX211bHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiB1MzIgc2tsX3BsYW5l
X3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCQkg
ICAgIGludCBjb2xvcl9wbGFuZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5l
X3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0
YXRlLT5ody5yb3RhdGlvbjsKIAl1MzIgc3RyaWRlID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
W2NvbG9yX3BsYW5lXS5zdHJpZGU7CiAKIAlpZiAoY29sb3JfcGxhbmUgPj0gZmItPmZvcm1hdC0+
bnVtX3BsYW5lcykKQEAgLTQxMDcsMTAgKzQxMDcsMTAgQEAgc3RhdGljIHUzMiBza2xfcGxhbmVf
Y3RsX2Zvcm1hdCh1MzIgcGl4ZWxfZm9ybWF0KQogCiBzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxf
YWxwaGEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlp
ZiAoIXBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmhhc19hbHBoYSkKKwlpZiAoIXBsYW5l
X3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5oYXNfYWxwaGEpCiAJCXJldHVybiBQTEFORV9DVExfQUxQ
SEFfRElTQUJMRTsKIAotCXN3aXRjaCAocGxhbmVfc3RhdGUtPmJhc2UucGl4ZWxfYmxlbmRfbW9k
ZSkgeworCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsKIAljYXNl
IERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkU6CiAJCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElT
QUJMRTsKIAljYXNlIERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJOgpAQCAtNDExOCwxNyArNDExOCwx
NyBAQCBzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfYWxwaGEoY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAljYXNlIERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFOgog
CQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX0hXX1BSRU1VTFRJUExZOwogCWRlZmF1bHQ6Ci0JCU1J
U1NJTkdfQ0FTRShwbGFuZV9zdGF0ZS0+YmFzZS5waXhlbF9ibGVuZF9tb2RlKTsKKwkJTUlTU0lO
R19DQVNFKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKTsKIAkJcmV0dXJuIFBMQU5F
X0NUTF9BTFBIQV9ESVNBQkxFOwogCX0KIH0KIAogc3RhdGljIHUzMiBnbGtfcGxhbmVfY29sb3Jf
Y3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7
Ci0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5oYXNfYWxwaGEpCisJaWYgKCFw
bGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aGFzX2FscGhhKQogCQlyZXR1cm4gUExBTkVfQ09M
T1JfQUxQSEFfRElTQUJMRTsKIAotCXN3aXRjaCAocGxhbmVfc3RhdGUtPmJhc2UucGl4ZWxfYmxl
bmRfbW9kZSkgeworCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsK
IAljYXNlIERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkU6CiAJCXJldHVybiBQTEFORV9DT0xPUl9B
TFBIQV9ESVNBQkxFOwogCWNhc2UgRFJNX01PREVfQkxFTkRfUFJFTVVMVEk6CkBAIC00MTM2LDcg
KzQxMzYsNyBAQCBzdGF0aWMgdTMyIGdsa19wbGFuZV9jb2xvcl9jdGxfYWxwaGEoY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZQogCWNhc2UgRFJNX01PREVfQkxFTkRf
Q09WRVJBR0U6CiAJCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9IV19QUkVNVUxUSVBMWTsKIAlk
ZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UocGxhbmVfc3RhdGUtPmJhc2UucGl4ZWxfYmxlbmRfbW9k
ZSk7CisJCU1JU1NJTkdfQ0FTRShwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9kZSk7CiAJ
CXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9ESVNBQkxFOwogCX0KIH0KQEAgLTQyMjIsOCArNDIy
Miw4IEBAIHUzMiBza2xfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRv
X2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90
YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRp
b24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9z
cHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAl1MzIgcGxhbmVfY3Rs
OwogCkBAIC00MjMzLDEwICs0MjMzLDEwIEBAIHUzMiBza2xfcGxhbmVfY3RsKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQlwbGFuZV9jdGwgfD0gc2tsX3BsYW5l
X2N0bF9hbHBoYShwbGFuZV9zdGF0ZSk7CiAJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUExBTkVf
R0FNTUFfRElTQUJMRTsKIAotCQlpZiAocGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfZW5jb2Rpbmcg
PT0gRFJNX0NPTE9SX1lDQkNSX0JUNzA5KQorCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2Vu
Y29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKIAkJCXBsYW5lX2N0bCB8PSBQTEFORV9D
VExfWVVWX1RPX1JHQl9DU0NfRk9STUFUX0JUNzA5OwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+YmFz
ZS5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKKwkJaWYgKHBsYW5l
X3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKIAkJ
CXBsYW5lX2N0bCB8PSBQTEFORV9DVExfWVVWX1JBTkdFX0NPUlJFQ1RJT05fRElTQUJMRTsKIAl9
CiAKQEAgLTQyNzgsNyArNDI3OCw3IEBAIHUzMiBnbGtfcGxhbmVfY29sb3JfY3RsKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogewogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRl
dik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFz
ZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVf
c3RhdGUtPmJhc2UucGxhbmUpOwogCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOwogCkBAIC00Mjg2
LDEyICs0Mjg2LDEyIEBAIHUzMiBnbGtfcGxhbmVfY29sb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXBsYW5lX2NvbG9yX2N0bCB8PSBnbGtfcGxhbmVf
Y29sb3JfY3RsX2FscGhhKHBsYW5lX3N0YXRlKTsKIAogCWlmIChmYi0+Zm9ybWF0LT5pc195dXYg
JiYgIWljbF9pc19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5lLT5pZCkpIHsKLQkJaWYgKHBsYW5l
X3N0YXRlLT5iYXNlLmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwkJ
aWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZyA9PSBEUk1fQ09MT1JfWUNCQ1JfQlQ3
MDkpCiAJCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfQ1NDX01PREVfWVVWNzA5X1RP
X1JHQjcwOTsKIAkJZWxzZQogCQkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX0NTQ19N
T0RFX1lVVjYwMV9UT19SR0I3MDk7CiAKLQkJaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX3Jh
bmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQorCQlpZiAocGxhbmVfc3RhdGUtPmh3
LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQogCQkJcGxhbmVfY29s
b3JfY3RsIHw9IFBMQU5FX0NPTE9SX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CiAJfSBl
bHNlIGlmIChmYi0+Zm9ybWF0LT5pc195dXYpIHsKIAkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5F
X0NPTE9SX0lOUFVUX0NTQ19FTkFCTEU7CkBAIC01NjI1LDcgKzU2MjUsNyBAQCBzdGF0aWMgaW50
IHNrbF91cGRhdGVfc2NhbGVyX3BsYW5lKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPQogCQl0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50IHJldDsKIAlib29sIGZvcmNlX2Rl
dGFjaCA9ICFmYiB8fCAhcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZTsKIAlib29sIG5lZWRfc2Nh
bGVyID0gZmFsc2U7CkBAIC0xMDcyOSw3ICsxMDcyOSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfY3Vy
c29yX2Jhc2UoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBsYW5lX3N0
YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiA9IGludGVsX2ZiX29iaihmYik7CiAJdTMyIGJhc2U7CiAKQEAgLTEwNzc3LDcgKzEw
Nzc3LDcgQEAgc3RhdGljIGludCBpbnRlbF9jdXJzb3JfY2hlY2tfc3VyZmFjZShzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0J
dW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJdW5z
aWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBzcmNf
eCwgc3JjX3k7CiAJdTMyIG9mZnNldDsKIAlpbnQgcmV0OwpAQCAtMTA4MTAsNyArMTA4MTAsNyBA
QCBzdGF0aWMgaW50IGludGVsX2N1cnNvcl9jaGVja19zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIAkvKiBJTEsrIGRvIHRoaXMgYXV0b21hZ2ljYWxseSBp
biBoYXJkd2FyZSAqLwogCWlmIChIQVNfR01DSChkZXZfcHJpdikgJiYgcm90YXRpb24gJiBEUk1f
TU9ERV9ST1RBVEVfMTgwKSB7Ci0JCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
cGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCQlpbnQgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxh
bmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKIAkJaW50IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwogCkBAIC0xMDgyNyw3ICsxMDgyNyw3IEBA
IHN0YXRpYyBpbnQgaW50ZWxfY3Vyc29yX2NoZWNrX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIHN0YXRpYyBpbnQgaW50ZWxfY2hlY2tfY3Vyc29yKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCByZXQ7CiAKIAlpZiAoZmIgJiYgZmIt
Pm1vZGlmaWVyICE9IERSTV9GT1JNQVRfTU9EX0xJTkVBUikgewpAQCAtMTA5MDEsNyArMTA5MDEs
NyBAQCBzdGF0aWMgYm9vbCBpODQ1X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0aWMgaW50IGk4NDVfY2hlY2tfY3Vyc29yKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50IHJldDsKIAogCXJldCA9IGludGVs
X2NoZWNrX2N1cnNvcihjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CkBAIC0xMTA2Nyw3ICsxMTA2
Nyw3IEBAIHN0YXRpYyB1MzIgaTl4eF9jdXJzb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAocGxhbmVfc3RhdGUt
PmJhc2Uucm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfMTgwKQorCWlmIChwbGFuZV9zdGF0ZS0+
aHcucm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfMTgwKQogCQljbnRsIHw9IE1DVVJTT1JfUk9U
QVRFXzE4MDsKIAogCXJldHVybiBjbnRsOwpAQCAtMTExMDAsNyArMTExMDAsNyBAQCBzdGF0aWMg
Ym9vbCBpOXh4X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiAJICogY3Vyc29ycy4KIAkgKi8KIAlpZiAoSEFTX0NVUl9GQkMoZGV2X3By
aXYpICYmCi0JICAgIHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRF
XzApIHsKKwkgICAgcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzAp
IHsKIAkJaWYgKGhlaWdodCA8IDggfHwgaGVpZ2h0ID4gd2lkdGgpCiAJCQlyZXR1cm4gZmFsc2U7
CiAJfSBlbHNlIHsKQEAgLTExMTE2LDcgKzExMTE2LDcgQEAgc3RhdGljIGludCBpOXh4X2NoZWNr
X2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxh
bmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUt
PmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmh3LmZiOwogCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CiAJaW50IHJldDsK
IApAQCAtMTE3MTcsMTEgKzExNzE3LDExIEBAIHN0YXRpYyBib29sIGludGVsX3dtX25lZWRfdXBk
YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqY3VyLAogCWlmIChuZXctPmJhc2Uu
dmlzaWJsZSAhPSBjdXItPmJhc2UudmlzaWJsZSkKIAkJcmV0dXJuIHRydWU7CiAKLQlpZiAoIWN1
ci0+YmFzZS5mYiB8fCAhbmV3LT5iYXNlLmZiKQorCWlmICghY3VyLT5ody5mYiB8fCAhbmV3LT5o
dy5mYikKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKGN1ci0+YmFzZS5mYi0+bW9kaWZpZXIgIT0g
bmV3LT5iYXNlLmZiLT5tb2RpZmllciB8fAotCSAgICBjdXItPmJhc2Uucm90YXRpb24gIT0gbmV3
LT5iYXNlLnJvdGF0aW9uIHx8CisJaWYgKGN1ci0+aHcuZmItPm1vZGlmaWVyICE9IG5ldy0+aHcu
ZmItPm1vZGlmaWVyIHx8CisJICAgIGN1ci0+aHcucm90YXRpb24gIT0gbmV3LT5ody5yb3RhdGlv
biB8fAogCSAgICBkcm1fcmVjdF93aWR0aCgmbmV3LT5iYXNlLnNyYykgIT0gZHJtX3JlY3Rfd2lk
dGgoJmN1ci0+YmFzZS5zcmMpIHx8CiAJICAgIGRybV9yZWN0X2hlaWdodCgmbmV3LT5iYXNlLnNy
YykgIT0gZHJtX3JlY3RfaGVpZ2h0KCZjdXItPmJhc2Uuc3JjKSB8fAogCSAgICBkcm1fcmVjdF93
aWR0aCgmbmV3LT5iYXNlLmRzdCkgIT0gZHJtX3JlY3Rfd2lkdGgoJmN1ci0+YmFzZS5kc3QpIHx8
CkBAIC0xMjM1Myw3ICsxMjM1Myw3IEBAIHN0YXRpYyBjb25zdCBjaGFyICpvdXRwdXRfZm9ybWF0
cyhlbnVtIGludGVsX291dHB1dF9mb3JtYXQgZm9ybWF0KQogc3RhdGljIHZvaWQgaW50ZWxfZHVt
cF9wbGFuZV9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9z
dGF0ZS0+YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBw
bGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBmb3JtYXRf
bmFtZTsKIAogCWlmICghZmIpIHsKQEAgLTEyMzY5LDcgKzEyMzY5LDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfZHVtcF9wbGFuZV9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogCQkgICAgICBkcm1fZ2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1h
dCwgJmZvcm1hdF9uYW1lKSwKIAkJICAgICAgeWVzbm8ocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJs
ZSkpOwogCURSTV9ERUJVR19LTVMoIlx0cm90YXRpb246IDB4JXgsIHNjYWxlcjogJWRcbiIsCi0J
CSAgICAgIHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uLCBwbGFuZV9zdGF0ZS0+c2NhbGVyX2lk
KTsKKwkJICAgICAgcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uLCBwbGFuZV9zdGF0ZS0+c2NhbGVy
X2lkKTsKIAlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKIAkJRFJNX0RFQlVHX0tNUygi
XHRzcmM6ICIgRFJNX1JFQ1RfRlBfRk1UICIgZHN0OiAiIERSTV9SRUNUX0ZNVCAiXG4iLAogCQkJ
ICAgICAgRFJNX1JFQ1RfRlBfQVJHKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpLApAQCAtMTQ4Njks
OCArMTQ4NjksOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfdHJhY2tfZmJzKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX3BsYW5l
X2luX3N0YXRlKHN0YXRlLCBwbGFuZSwgb2xkX3BsYW5lX3N0YXRlLAogCQkJCQkgICAgIG5ld19w
bGFuZV9zdGF0ZSwgaSkKLQkJaW50ZWxfZnJvbnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRi
dWZmZXIob2xkX3BsYW5lX3N0YXRlLT5iYXNlLmZiKSwKLQkJCQkJdG9faW50ZWxfZnJvbnRidWZm
ZXIobmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZiKSwKKwkJaW50ZWxfZnJvbnRidWZmZXJfdHJhY2so
dG9faW50ZWxfZnJvbnRidWZmZXIob2xkX3BsYW5lX3N0YXRlLT5ody5mYiksCisJCQkJCXRvX2lu
dGVsX2Zyb250YnVmZmVyKG5ld19wbGFuZV9zdGF0ZS0+aHcuZmIpLAogCQkJCQlwbGFuZS0+ZnJv
bnRidWZmZXJfYml0KTsKIH0KIApAQCAtMTUwMzksNyArMTUwMzksNyBAQCBzdGF0aWMgaW50IGlu
dGVsX3BsYW5lX3Bpbl9mYihzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
ewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmJhc2UuZmI7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAKIAlpZiAocGxhbmUtPmlkID09
IFBMQU5FX0NVUlNPUiAmJgpAQCAtMTUxMDQsNyArMTUxMDQsNyBAQCBpbnRlbF9wcmVwYXJlX3Bs
YW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKmludGVsX3N0YXRlID0KIAkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19wbGFuZV9zdGF0
ZS0+YmFzZS5zdGF0ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShwbGFuZS0+ZGV2KTsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFu
ZV9zdGF0ZS0+YmFzZS5mYjsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFu
ZV9zdGF0ZS0+aHcuZmI7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGludGVs
X2ZiX29iaihmYik7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9sZF9vYmogPSBpbnRl
bF9mYl9vYmoocGxhbmUtPnN0YXRlLT5mYik7CiAJaW50IHJldDsKQEAgLTE1MTcyLDEyICsxNTE3
MiwxMiBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAog
CiAJCWZlbmNlID0gZG1hX3Jlc3ZfZ2V0X2V4Y2xfcmN1KG9iai0+YmFzZS5yZXN2KTsKIAkJaWYg
KGZlbmNlKSB7Ci0JCQlhZGRfcnBzX2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUt
PmJhc2UuY3J0YywKKwkJCWFkZF9ycHNfYm9vc3RfYWZ0ZXJfdmJsYW5rKG5ld19wbGFuZV9zdGF0
ZS0+aHcuY3J0YywKIAkJCQkJCSAgIGZlbmNlKTsKIAkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwog
CQl9CiAJfSBlbHNlIHsKLQkJYWRkX3Jwc19ib29zdF9hZnRlcl92YmxhbmsobmV3X3BsYW5lX3N0
YXRlLT5iYXNlLmNydGMsCisJCWFkZF9ycHNfYm9vc3RfYWZ0ZXJfdmJsYW5rKG5ld19wbGFuZV9z
dGF0ZS0+aHcuY3J0YywKIAkJCQkJICAgbmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZlbmNlKTsKIAl9
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jCmluZGV4IGM2Y2MzNzc1
ZjNiOC4uM2VhOGQwMTBkYjZjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2ZiYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZmJjLmMKQEAgLTY2Miw3ICs2NjIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmNfdXBkYXRlX3N0
YXRlX2NhY2hlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9m
YmMgKmZiYyA9ICZkZXZfcHJpdi0+ZmJjOwogCXN0cnVjdCBpbnRlbF9mYmNfc3RhdGVfY2FjaGUg
KmNhY2hlID0gJmZiYy0+c3RhdGVfY2FjaGU7Ci0Jc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKIAogCWNhY2hlLT52bWEgPSBOVUxMOwogCWNhY2hlLT5mbGFncyA9
IDA7CkBAIC02NzEsNyArNjcxLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJjX3VwZGF0ZV9zdGF0
ZV9jYWNoZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJp
dikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKIAkJY2FjaGUtPmNydGMuaHN3X2Jkd19waXhl
bF9yYXRlID0gY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZTsKIAotCWNhY2hlLT5wbGFuZS5yb3RhdGlv
biA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNhY2hlLT5wbGFuZS5yb3RhdGlvbiA9
IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAkvKgogCSAqIFNyYyBjb29yZGluYXRlcyBhcmUg
YWxyZWFkeSByb3RhdGVkIGJ5IDI3MCBkZWdyZWVzIGZvcgogCSAqIHRoZSA5MC8yNzAgZGVncmVl
IHBsYW5lIHJvdGF0aW9uIGNhc2VzICh0byBtYXRjaCB0aGUKQEAgLTY4NCw3ICs2ODQsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9mYmNfdXBkYXRlX3N0YXRlX2NhY2hlKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCWNhY2hlLT5wbGFuZS5hZGp1c3RlZF95ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lWzBdLnk7CiAJY2FjaGUtPnBsYW5lLnkgPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueTEgPj4g
MTY7CiAKLQljYWNoZS0+cGxhbmUucGl4ZWxfYmxlbmRfbW9kZSA9IHBsYW5lX3N0YXRlLT5iYXNl
LnBpeGVsX2JsZW5kX21vZGU7CisJY2FjaGUtPnBsYW5lLnBpeGVsX2JsZW5kX21vZGUgPSBwbGFu
ZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9kZTsKIAogCWlmICghY2FjaGUtPnBsYW5lLnZpc2li
bGUpCiAJCXJldHVybjsKQEAgLTEwNDcsNyArMTA0Nyw3IEBAIHZvaWQgaW50ZWxfZmJjX2Nob29z
ZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiB0byBwaXBlIG9y
IHBsYW5lIEEuICovCiAJZm9yX2VhY2hfbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0YXRlLCBw
bGFuZSwgcGxhbmVfc3RhdGUsIGkpIHsKIAkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGU7Ci0JCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwbGFuZV9z
dGF0ZS0+YmFzZS5jcnRjKTsKKwkJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKHBsYW5lX3N0YXRlLT5ody5jcnRjKTsKIAogCQlpZiAoIXBsYW5lLT5oYXNfZmJjKQogCQkJ
Y29udGludWU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5j
CmluZGV4IDg0OGNlMDdhOGVjMi4uNDZlM2Q2Y2Y1OTc2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpAQCAtNjY5LDcgKzY2OSw3IEBAIHN0YXRpYyB2
b2lkIHVwZGF0ZV9jb2xvcmtleShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAkJZmxh
Z3MgfD0gRFNUX0tFWV9FTkFCTEU7CiAKIAlpZiAoc3RhdGUtPmJhc2UudmlzaWJsZSkKLQkJZm9y
bWF0ID0gc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+Zm9ybWF0OworCQlmb3JtYXQgPSBzdGF0ZS0+
aHcuZmItPmZvcm1hdC0+Zm9ybWF0OwogCiAJc3dpdGNoIChmb3JtYXQpIHsKIAljYXNlIERSTV9G
T1JNQVRfQzg6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwpp
bmRleCA1YmE4ZmFmMGNjZmUuLmIyMTE2ZDEyMzU0OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC0yNDEsOCArMjQxLDggQEAgdm9pZCBpbnRlbF9w
aXBlX3VwZGF0ZV9lbmQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQog
aW50IGludGVsX3BsYW5lX2NoZWNrX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRp
b24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24g
PSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJdTMyIHN0cmlkZSwgbWF4X3N0cmlkZTsKIAog
CS8qCkBAIC0yNzIsMTAgKzI3MiwxMCBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIGludCBpbnRlbF9w
bGFuZV9jaGVja19zcmNfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmh3LmZiOwogCXN0cnVjdCBkcm1fcmVjdCAqc3JjID0gJnBsYW5lX3N0YXRlLT5iYXNl
LnNyYzsKIAl1MzIgc3JjX3gsIHNyY195LCBzcmNfdywgc3JjX2gsIGhzdWIsIHZzdWI7Ci0JYm9v
bCByb3RhdGVkID0gZHJtX3JvdGF0aW9uXzkwX29yXzI3MChwbGFuZV9zdGF0ZS0+YmFzZS5yb3Rh
dGlvbik7CisJYm9vbCByb3RhdGVkID0gZHJtX3JvdGF0aW9uXzkwX29yXzI3MChwbGFuZV9zdGF0
ZS0+aHcucm90YXRpb24pOwogCiAJLyoKIAkgKiBIYXJkd2FyZSBkb2Vzbid0IGhhbmRsZSBzdWJw
aXhlbCBjb29yZGluYXRlcy4KQEAgLTMyOSw3ICszMjksNyBAQCBza2xfcGxhbmVfcmF0aW8oY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXVuc2lnbmVkIGludCAq
bnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAKIAlpZiAo
ZmItPmZvcm1hdC0+Y3BwWzBdID09IDgpIHsKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKQEAgLTM5Niw3ICszOTYsNyBAQCBza2xf
cHJvZ3JhbV9zY2FsZXIoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJICAgY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBp
cGUgcGlwZSA9IHBsYW5lLT5waXBlOwogCWludCBzY2FsZXJfaWQgPSBwbGFuZV9zdGF0ZS0+c2Nh
bGVyX2lkOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9zY2FsZXIgKnNjYWxlciA9CkBAIC01NDIsMTAg
KzU0MiwxMCBAQCBpY2xfcHJvZ3JhbV9pbnB1dF9jc2Moc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSwKIAl9OwogCWNvbnN0IHUxNiAqY3NjOwogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9y
X3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQotCQljc2MgPSBpbnB1dF9jc2Nf
bWF0cml4W3BsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX2VuY29kaW5nXTsKKwlpZiAocGxhbmVfc3Rh
dGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQorCQljc2Mg
PSBpbnB1dF9jc2NfbWF0cml4W3BsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZ107CiAJZWxz
ZQotCQljc2MgPSBpbnB1dF9jc2NfbWF0cml4X2xyW3BsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX2Vu
Y29kaW5nXTsKKwkJY3NjID0gaW5wdXRfY3NjX21hdHJpeF9scltwbGFuZV9zdGF0ZS0+aHcuY29s
b3JfZW5jb2RpbmddOwogCiAJSTkxNV9XUklURV9GVyhQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlw
ZSwgcGxhbmVfaWQsIDApLCBST0ZGKGNzY1swXSkgfAogCQkgICAgICBHT0ZGKGNzY1sxXSkpOwpA
QCAtNTU5LDcgKzU1OSw3IEBAIGljbF9wcm9ncmFtX2lucHV0X2NzYyhzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lLAogCiAJSTkxNV9XUklURV9GVyhQTEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUs
IHBsYW5lX2lkLCAwKSwKIAkJICAgICAgUFJFT0ZGX1lVVl9UT19SR0JfSEkpOwotCWlmIChwbGFu
ZV9zdGF0ZS0+YmFzZS5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkK
KwlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxM
X1JBTkdFKQogCQlJOTE1X1dSSVRFX0ZXKFBMQU5FX0lOUFVUX0NTQ19QUkVPRkYocGlwZSwgcGxh
bmVfaWQsIDEpLCAwKTsKIAllbHNlCiAJCUk5MTVfV1JJVEVfRlcoUExBTkVfSU5QVVRfQ1NDX1BS
RU9GRihwaXBlLCBwbGFuZV9pZCwgMSksCkBAIC01OTEsOCArNTkxLDggQEAgc2tsX3Byb2dyYW1f
cGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAl1MzIgc3JjX3cgPSBkcm1fcmVjdF93
aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKIAl1MzIgc3JjX2ggPSBkcm1fcmVj
dF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CiAJc3RydWN0IGludGVsX3Bs
YW5lICpsaW5rZWQgPSBwbGFuZV9zdGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZTsKLQljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXU4IGFs
cGhhID0gcGxhbmVfc3RhdGUtPmJhc2UuYWxwaGEgPj4gODsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1OCBhbHBoYSA9IHBsYW5lX3N0
YXRlLT5ody5hbHBoYSA+PiA4OwogCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOwogCXVuc2lnbmVk
IGxvbmcgaXJxZmxhZ3M7CiAJdTMyIGtleW1zaywga2V5bWF4OwpAQCAtNzY4LDcgKzc2OCw3IEBA
IGNodl91cGRhdGVfY3NjKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5l
X3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0g
cGxhbmUtPmlkOwogCS8qCiAJICogfHJ8ICAgfCBjMCBjMSBjMiB8ICAgfGNyfApAQCAtNzk0LDcg
Kzc5NCw3IEBAIGNodl91cGRhdGVfY3NjKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiAJCQkgICAgMCwgNDA5NiwgIDc2MDEsCiAJCX0sCiAJfTsKLQljb25zdCBz
MTYgKmNzYyA9IGNzY19tYXRyaXhbcGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfZW5jb2RpbmddOwor
CWNvbnN0IHMxNiAqY3NjID0gY3NjX21hdHJpeFtwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2Rp
bmddOwogCiAJLyogU2VlbXMgUkdCIGRhdGEgYnlwYXNzZXMgdGhlIENTQyBhbHdheXMgKi8KIAlp
ZiAoIWZiLT5mb3JtYXQtPmlzX3l1dikKQEAgLTgyNywxMyArODI3LDEzIEBAIHZsdl91cGRhdGVf
Y2xyYyhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFz
ZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShw
bGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBw
bGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAllbnVt
IHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCWludCBjb250cmFzdCwgYnJpZ2h0bmVz
cywgc2hfc2NhbGUsIHNoX3Npbiwgc2hfY29zOwogCiAJaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAm
JgotCSAgICBwbGFuZV9zdGF0ZS0+YmFzZS5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1Jf
TElNSVRFRF9SQU5HRSkgeworCSAgICBwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJN
X0NPTE9SX1lDQkNSX0xJTUlURURfUkFOR0UpIHsKIAkJLyoKIAkJICogRXhwYW5kIGxpbWl0ZWQg
cmFuZ2UgdG8gZnVsbCByYW5nZToKIAkJICogQ29udHJhc3QgaXMgYXBwbGllZCBmaXJzdCBhbmQg
aXMgdXNlZCB0byBleHBhbmQgWSByYW5nZS4KQEAgLTg2Nyw3ICs4NjcsNyBAQCB2bHZfcGxhbmVf
cmF0aW8oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXVuc2ln
bmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKIHsKIAl1OCBhY3RpdmVfcGxhbmVzID0g
Y3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lcyAmIH5CSVQoUExBTkVfQ1VSU09SKTsKLQljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2ln
bmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CiAKIAkvKgpAQCAtOTUzLDggKzk1Myw4
IEBAIHN0YXRpYyB1MzIgdmx2X3Nwcml0ZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHN0YXRpYyB1MzIgdmx2X3Nwcml0ZV9jdGwoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24g
PSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBw
bGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVf
Y29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAl1MzIgc3ByY3RsOwogCkBAIC05
OTksNyArOTk5LDcgQEAgc3RhdGljIHUzMiB2bHZfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIDA7CiAJfQogCi0JaWYgKHBsYW5l
X3N0YXRlLT5iYXNlLmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwlp
ZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcw
OSkKIAkJc3ByY3RsIHw9IFNQX1lVVl9GT1JNQVRfQlQ3MDk7CiAKIAlpZiAoZmItPm1vZGlmaWVy
ID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEKQpAQCAtMTAyMSw3ICsxMDIxLDcgQEAgc3RhdGlj
IHZvaWQgdmx2X3VwZGF0ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBw
bGFuZS0+cGlwZTsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCXUxNiBn
YW1tYVs4XTsKQEAgLTExNTEsNyArMTE1MSw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9wbGFuZV9yYXRp
byhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICB1bnNp
Z25lZCBpbnQgKm51bSwgdW5zaWduZWQgaW50ICpkZW4pCiB7CiAJdTggYWN0aXZlX3BsYW5lcyA9
IGNydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgJiB+QklUKFBMQU5FX0NVUlNPUik7Ci0JY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNp
Z25lZCBpbnQgY3BwID0gZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJaWYgKGh3ZWlnaHQ4KGFjdGl2
ZV9wbGFuZXMpID09IDIpIHsKQEAgLTExODcsNyArMTE4Nyw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9w
bGFuZV9yYXRpb19zY2FsaW5nKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgKm51bSwgdW5zaWduZWQgaW50ICpkZW4pCiB7Ci0JY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1
bnNpZ25lZCBpbnQgY3BwID0gZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJc3dpdGNoIChjcHApIHsK
QEAgLTEyNjUsNyArMTI2NSw3IEBAIHN0YXRpYyB2b2lkIGhzd19wbGFuZV9yYXRpbyhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICB1bnNpZ25lZCBpbnQg
Km51bSwgdW5zaWduZWQgaW50ICpkZW4pCiB7CiAJdTggYWN0aXZlX3BsYW5lcyA9IGNydGNfc3Rh
dGUtPmFjdGl2ZV9wbGFuZXMgJiB+QklUKFBMQU5FX0NVUlNPUik7Ci0JY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQg
Y3BwID0gZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJaWYgKGh3ZWlnaHQ4KGFjdGl2ZV9wbGFuZXMp
ID09IDIpIHsKQEAgLTEzMjEsNyArMTMyMSw3IEBAIHN0YXRpYyBib29sIGl2Yl9uZWVkX3Nwcml0
ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAogCXJldHVybiBmYi0+Zm9ybWF0LT5jcHBbMF0gPT0g
OCAmJgogCQkoSVNfSVZZQlJJREdFKGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSk7
CkBAIC0xMzMyLDggKzEzMzIsOCBAQCBzdGF0aWMgdTMyIGl2Yl9zcHJpdGVfY3RsKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogewogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRl
dik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFz
ZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlv
bjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5m
YjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJ
Y29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0
ZS0+Y2tleTsKIAl1MzIgc3ByY3RsOwogCkBAIC0xMzc1LDEwICsxMzc1LDEwIEBAIHN0YXRpYyB1
MzIgaXZiX3Nwcml0ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJaWYgKCFpdmJfbmVlZF9zcHJpdGVfZ2FtbWEocGxhbmVfc3RhdGUpKQogCQlzcHJjdGwg
fD0gU1BSSVRFX0lOVF9HQU1NQV9ESVNBQkxFOwogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNv
bG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwlpZiAocGxhbmVfc3RhdGUt
Pmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKIAkJc3ByY3RsIHw9
IFNQUklURV9ZVVZfVE9fUkdCX0NTQ19GT1JNQVRfQlQ3MDk7CiAKLQlpZiAocGxhbmVfc3RhdGUt
PmJhc2UuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJaWYgKHBs
YW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkK
IAkJc3ByY3RsIHw9IFNQUklURV9ZVVZfUkFOR0VfQ09SUkVDVElPTl9ESVNBQkxFOwogCiAJaWYg
KGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCkKQEAgLTE1NjcsNyArMTU2
Nyw3IEBAIGl2Yl9wbGFuZV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwK
IHN0YXRpYyBpbnQgZzR4X3Nwcml0ZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCBoc2NhbGUsIHBpeGVsX3JhdGU7CiAJdW5z
aWduZWQgaW50IGxpbWl0LCBkZWNpbWF0ZTsKIApAQCAtMTYzNyw4ICsxNjM3LDggQEAgc3RhdGlj
IHUzMiBnNHhfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1
KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9u
ID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0g
cGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRl
X2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CiAJdTMyIGR2c2NudHI7CiAKQEAg
LTE2NzcsMTAgKzE2NzcsMTAgQEAgc3RhdGljIHUzMiBnNHhfc3ByaXRlX2N0bChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIDA7CiAJfQogCi0JaWYg
KHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcw
OSkKKwlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JD
Ul9CVDcwOSkKIAkJZHZzY250ciB8PSBEVlNfWVVWX0ZPUk1BVF9CVDcwOTsKIAotCWlmIChwbGFu
ZV9zdGF0ZS0+YmFzZS5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkK
KwlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxM
X1JBTkdFKQogCQlkdnNjbnRyIHw9IERWU19ZVVZfUkFOR0VfQ09SUkVDVElPTl9ESVNBQkxFOwog
CiAJaWYgKGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCkKQEAgLTE3MDEs
NyArMTcwMSw3IEBAIHN0YXRpYyB2b2lkIGc0eF91cGRhdGVfZ2FtbWEoY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwor
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwog
CWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CiAJdTE2IGdhbW1hWzhdOwogCWludCBpOwpA
QCAtMTczMyw3ICsxNzMzLDcgQEAgc3RhdGljIHZvaWQgaWxrX3VwZGF0ZV9nYW1tYShjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5k
ZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJh
c2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAl1MTYgZ2FtbWFbMTddOwog
CWludCBpOwpAQCAtMTg4Nyw3ICsxODg3LDcgQEAgc3RhdGljIGludAogZzR4X3Nwcml0ZV9jaGVj
a19zY2FsaW5nKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJIHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAljb25zdCBzdHJ1Y3QgZHJt
X3JlY3QgKnNyYyA9ICZwbGFuZV9zdGF0ZS0+YmFzZS5zcmM7CiAJY29uc3Qgc3RydWN0IGRybV9y
ZWN0ICpkc3QgPSAmcGxhbmVfc3RhdGUtPmJhc2UuZHN0OwogCWludCBzcmNfeCwgc3JjX3csIHNy
Y19oLCBjcnRjX3csIGNydGNfaDsKQEAgLTE5NTQsNyArMTk1NCw3IEBAIGc0eF9zcHJpdGVfY2hl
Y2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaW50IG1heF9zY2FsZSA9
IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKIAlpbnQgcmV0OwogCi0JaWYgKGludGVsX2Zi
X3NjYWxhYmxlKHBsYW5lX3N0YXRlLT5iYXNlLmZiKSkgeworCWlmIChpbnRlbF9mYl9zY2FsYWJs
ZShwbGFuZV9zdGF0ZS0+aHcuZmIpKSB7CiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNykg
ewogCQkJbWluX3NjYWxlID0gMTsKIAkJCW1heF9zY2FsZSA9IDE2IDw8IDE2OwpAQCAtMTk5OCw3
ICsxOTk4LDcgQEAgaW50IGNodl9wbGFuZV9jaGVja19yb3RhdGlvbihjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCXVu
c2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCXVuc2ln
bmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAogCS8qIENIViBp
Z25vcmVzIHRoZSBtaXJyb3IgYml0IHdoZW4gdGhlIHJvdGF0ZSBiaXQgaXMgc2V0IDooICovCiAJ
aWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpICYmCkBAIC0yMDUwLDggKzIwNTAsOCBAQCBzdGF0
aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxh
bmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3Rh
dGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlv
biA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1
ZiBmb3JtYXRfbmFtZTsKIAogCWlmICghZmIpCkBAIC0yMTUxLDggKzIxNTEsOCBAQCBzdGF0aWMg
aW50IHNrbF9wbGFuZV9jaGVja19kc3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfcwogCiBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19udjEyX3JvdGF0
aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1
bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNp
Z25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJaW50IHNyY193
ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CiAKIAkvKiBE
aXNwbGF5IFdBICMxMTA2ICovCkBAIC0yMTg3LDcgKzIxODcsNyBAQCBzdGF0aWMgaW50IHNrbF9w
bGFuZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2Uu
cGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxh
bmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCWludCBtaW5fc2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05PX1ND
QUxJTkc7CiAJaW50IG1heF9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKIAlp
bnQgcmV0OwpAQCAtMjIyOSw3ICsyMjI5LDcgQEAgc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2so
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXJldHVybiByZXQ7CiAKIAkv
KiBIVyBvbmx5IGhhcyA4IGJpdHMgcGl4ZWwgcHJlY2lzaW9uLCBkaXNhYmxlIHBsYW5lIGlmIGlu
dmlzaWJsZSAqLwotCWlmICghKHBsYW5lX3N0YXRlLT5iYXNlLmFscGhhID4+IDgpKQorCWlmICgh
KHBsYW5lX3N0YXRlLT5ody5hbHBoYSA+PiA4KSkKIAkJcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJs
ZSA9IGZhbHNlOwogCiAJcGxhbmVfc3RhdGUtPmN0bCA9IHNrbF9wbGFuZV9jdGwoY3J0Y19zdGF0
ZSwgcGxhbmVfc3RhdGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
cG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggYjAzNzk1ZjkyYzg0
Li4wYTAxMDNlY2Y3YmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Bt
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtODAxLDcgKzgwMSw3
IEBAIHN0YXRpYyBib29sIGludGVsX3dtX3BsYW5lX3Zpc2libGUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICogYXJvdW5kIHRoaXMgcHJvYmxlbSB3aXRoIHRo
ZSB3YXRlcm1hcmsgY29kZS4KIAkgKi8KIAlpZiAocGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUikK
LQkJcmV0dXJuIHBsYW5lX3N0YXRlLT5iYXNlLmZiICE9IE5VTEw7CisJCXJldHVybiBwbGFuZV9z
dGF0ZS0+aHcuZmIgIT0gTlVMTDsKIAllbHNlCiAJCXJldHVybiBwbGFuZV9zdGF0ZS0+YmFzZS52
aXNpYmxlOwogfQpAQCAtMTA4OCw3ICsxMDg4LDcgQEAgc3RhdGljIHUxNiBnNHhfY29tcHV0ZV93
bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWludGVs
X3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4gMDsK
IAotCWNwcCA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAgPSBw
bGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJLyoKIAkgKiBOb3QgMTAwJSBz
dXJlIHdoaWNoIHdheSBFTEsgc2hvdWxkIGdvIGhlcmUgYXMgdGhlCkBAIC0xMzA4LDggKzEzMDgs
OCBAQCBzdGF0aWMgaW50IGc0eF9jb21wdXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0
YXRlLCBwbGFuZSwKIAkJCQkJICAgICBvbGRfcGxhbmVfc3RhdGUsCiAJCQkJCSAgICAgbmV3X3Bs
YW5lX3N0YXRlLCBpKSB7Ci0JCWlmIChuZXdfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YyAhPSAmY3J0
Yy0+YmFzZSAmJgotCQkgICAgb2xkX3BsYW5lX3N0YXRlLT5iYXNlLmNydGMgIT0gJmNydGMtPmJh
c2UpCisJCWlmIChuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMgIT0gJmNydGMtPmJhc2UgJiYKKwkJ
ICAgIG9sZF9wbGFuZV9zdGF0ZS0+aHcuY3J0YyAhPSAmY3J0Yy0+YmFzZSkKIAkJCWNvbnRpbnVl
OwogCiAJCWlmIChnNHhfcmF3X3BsYW5lX3dtX2NvbXB1dGUoY3J0Y19zdGF0ZSwgbmV3X3BsYW5l
X3N0YXRlKSkKQEAgLTE1OTMsNyArMTU5Myw3IEBAIHN0YXRpYyB1MTYgdmx2X2NvbXB1dGVfd21f
bGV2ZWwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKCFp
bnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKIAkJcmV0dXJu
IDA7CiAKLQljcHAgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5jcHBbMF07CisJY3Bw
ID0gcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPmNwcFswXTsKIAljbG9jayA9IGFkanVzdGVk
X21vZGUtPmNydGNfY2xvY2s7CiAJaHRvdGFsID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19odG90YWw7
CiAJd2lkdGggPSBjcnRjX3N0YXRlLT5waXBlX3NyY193OwpAQCAtMTgyOSw4ICsxODI5LDggQEAg
c3RhdGljIGludCB2bHZfY29tcHV0ZV9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwg
cGxhbmUsCiAJCQkJCSAgICAgb2xkX3BsYW5lX3N0YXRlLAogCQkJCQkgICAgIG5ld19wbGFuZV9z
dGF0ZSwgaSkgewotCQlpZiAobmV3X3BsYW5lX3N0YXRlLT5iYXNlLmNydGMgIT0gJmNydGMtPmJh
c2UgJiYKLQkJICAgIG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjICE9ICZjcnRjLT5iYXNlKQor
CQlpZiAobmV3X3BsYW5lX3N0YXRlLT5ody5jcnRjICE9ICZjcnRjLT5iYXNlICYmCisJCSAgICBv
bGRfcGxhbmVfc3RhdGUtPmh3LmNydGMgIT0gJmNydGMtPmJhc2UpCiAJCQljb250aW51ZTsKIAog
CQlpZiAodmx2X3Jhd19wbGFuZV93bV9jb21wdXRlKGNydGNfc3RhdGUsIG5ld19wbGFuZV9zdGF0
ZSkpCkBAIC0yNDc1LDcgKzI0NzUsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX3ByaV93bShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWludGVsX3dt
X3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4gMDsKIAot
CWNwcCA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJbWV0aG9kMSA9IGlsa193bV9tZXRo
b2QxKGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsIGNwcCwgbWVtX3ZhbHVlKTsKIApAQCAtMjUwNyw3
ICsyNTA3LDcgQEAgc3RhdGljIHUzMiBpbGtfY29tcHV0ZV9zcHJfd20oY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxl
KGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKIAkJcmV0dXJuIDA7CiAKLQljcHAgPSBwbGFuZV9z
dGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5jcHBbMF07CisJY3BwID0gcGxhbmVfc3RhdGUtPmh3LmZi
LT5mb3JtYXQtPmNwcFswXTsKIAogCW1ldGhvZDEgPSBpbGtfd21fbWV0aG9kMShjcnRjX3N0YXRl
LT5waXhlbF9yYXRlLCBjcHAsIG1lbV92YWx1ZSk7CiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2Qy
KGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCkBAIC0yNTMzLDcgKzI1MzMsNyBAQCBzdGF0aWMgdTMy
IGlsa19jb21wdXRlX2N1cl93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3Rh
dGUpKQogCQlyZXR1cm4gMDsKIAotCWNwcCA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQt
PmNwcFswXTsKKwljcHAgPSBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJ
cmV0dXJuIGlsa193bV9tZXRob2QyKGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCiAJCQkgICAgICBj
cnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsLApAQCAtMjU1MSw3ICsyNTUx
LDcgQEAgc3RhdGljIHUzMiBpbGtfY29tcHV0ZV9mYmNfd20oY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNf
c3RhdGUsIHBsYW5lX3N0YXRlKSkKIAkJcmV0dXJuIDA7CiAKLQljcHAgPSBwbGFuZV9zdGF0ZS0+
YmFzZS5mYi0+Zm9ybWF0LT5jcHBbMF07CisJY3BwID0gcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3Jt
YXQtPmNwcFswXTsKIAogCXJldHVybiBpbGtfd21fZmJjKHByaV92YWwsIGRybV9yZWN0X3dpZHRo
KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLCBjcHApOwogfQpAQCAtNDA5MSw3ICs0MDkxLDcgQEAg
c2tsX3BsYW5lX3JlbGF0aXZlX2RhdGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgaW50IGNvbG9yX3BsYW5lKQogewogCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7
Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5m
YjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5m
YjsKIAl1MzIgZGF0YV9yYXRlOwogCXUzMiB3aWR0aCA9IDAsIGhlaWdodCA9IDA7CiAJdWludF9m
aXhlZF8xNl8xNl90IGRvd25fc2NhbGVfYW1vdW50OwpAQCAtNDYxMiw3ICs0NjEyLDcgQEAgc2ts
X2NvbXB1dGVfcGxhbmVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUsCiAJCQkgICAgc3RydWN0IHNrbF93bV9wYXJhbXMgKndwLCBpbnQgY29sb3JfcGxhbmUp
CiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFz
ZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKIAlpbnQgd2lkdGg7CiAKIAkvKgpAQCAtNDYyNCw3ICs0NjI0LDcgQEAgc2tsX2NvbXB1
dGVfcGxhbmVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCiAJcmV0dXJuIHNrbF9jb21wdXRlX3dtX3BhcmFtcyhjcnRjX3N0YXRlLCB3aWR0aCwK
IAkJCQkgICAgIGZiLT5mb3JtYXQsIGZiLT5tb2RpZmllciwKLQkJCQkgICAgIHBsYW5lX3N0YXRl
LT5iYXNlLnJvdGF0aW9uLAorCQkJCSAgICAgcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uLAogCQkJ
CSAgICAgc2tsX2FkanVzdGVkX3BsYW5lX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3Rh
dGUpLAogCQkJCSAgICAgd3AsIGNvbG9yX3BsYW5lKTsKIH0KQEAgLTQ5MDMsNyArNDkwMyw3IEBA
IHN0YXRpYyBpbnQgc2tsX2J1aWxkX3BsYW5lX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUo
cGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBs
YW5lLT5pZDsKIAlpbnQgcmV0OwogCkBAIC00OTM2LDcgKzQ5MzYsNyBAQCBzdGF0aWMgaW50IGlj
bF9idWlsZF9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
cmV0dXJuIDA7CiAKIAlpZiAocGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmUpIHsKLQkJ
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsK
KwkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7
CiAJCWVudW0gcGxhbmVfaWQgeV9wbGFuZV9pZCA9IHBsYW5lX3N0YXRlLT5wbGFuYXJfbGlua2Vk
X3BsYW5lLT5pZDsKIAogCQlXQVJOX09OKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3Rh
dGUsIHBsYW5lX3N0YXRlKSk7Ci0tIAoyLjI0LjAucmMxCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

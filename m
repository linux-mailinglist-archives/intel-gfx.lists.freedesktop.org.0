Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8A369C061B
	for <lists+intel-gfx@lfdr.de>; Fri, 27 Sep 2019 15:15:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EC1F66E079;
	Fri, 27 Sep 2019 13:15:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8BF306E063
 for <intel-gfx@lists.freedesktop.org>; Fri, 27 Sep 2019 13:14:59 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 Sep 2019 06:14:49 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,555,1559545200"; d="scan'208";a="183973121"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga008.jf.intel.com with SMTP; 27 Sep 2019 06:14:45 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Fri, 27 Sep 2019 16:14:44 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 27 Sep 2019 16:14:31 +0300
Message-Id: <20190927131432.15978-5-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190927131432.15978-1-ville.syrjala@linux.intel.com>
References: <20190927131432.15978-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/5] drm/i915: Add
 intel_atomic_crtc_state_for_each_plane_state()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCmRy
bV9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZSgpIGNhbid0IGJlIHVzZWQg
YWZ0ZXIKd2UgaGF2ZSB0aGUgdWFwaSB2cy4gaHcgc3BsaXQuIFJvbGwgb3VyIG93biA6KAoKVHJ1
dGhmdWxseSBJJ2QgbGlrZSB0byBudWtlIHRoaXMgdGhpbmcgZW50aXJlbHksIGJ1dCB0aGF0CnJl
cXVpcmVzIHNvbWUgbW9yZSB3b3JrIHNvIGxldCdzIGxpdmUgd2l0aCBpdCBmb3Igbm93LgoKU2ln
bmVkLW9mZi1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jICB8IDEw
ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5oICB8ICA2ICsr
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaCB8ICA5ICsrCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jICAgICAgICAgICAgICB8IDk5ICsrKysrKysr
KystLS0tLS0tLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDczIGluc2VydGlvbnMoKyksIDUxIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
YXRvbWljLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCmlu
ZGV4IGM1YTU1MmE2OTc1Mi4uZWY3MTRiMjU4NzA3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKQEAgLTQ0MiwzICs0NDIsMTMgQEAgaW50ZWxfYXRvbWlj
X2dldF9jcnRjX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKIAogCXJldHVy
biB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGNfc3RhdGUpOwogfQorCitjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKgorX19pbnRlbF9hdG9taWNfZ2V0X2N1cnJlbnRfcGxhbmVfc3RhdGUo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJICAgICAgIHN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUpCit7CisJaWYgKHN0YXRlLT5iYXNlLnBsYW5lc1tkcm1fcGxhbmVfaW5k
ZXgoJnBsYW5lLT5iYXNlKV0uc3RhdGUpCisJCXJldHVybiB0b19pbnRlbF9wbGFuZV9zdGF0ZShz
dGF0ZS0+YmFzZS5wbGFuZXNbZHJtX3BsYW5lX2luZGV4KCZwbGFuZS0+YmFzZSldLnN0YXRlKTsK
KworCXJldHVybiB0b19pbnRlbF9wbGFuZV9zdGF0ZShwbGFuZS0+YmFzZS5zdGF0ZSk7Cit9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAppbmRleCA1ODA2NWQz
MTYxYTMuLjAyZDYyNmU2ZWJmMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9hdG9taWMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2F0b21pYy5oCkBAIC0xNiw4ICsxNiwxMCBAQCBzdHJ1Y3QgZHJtX2NydGNfc3RhdGU7CiBz
dHJ1Y3QgZHJtX2RldmljZTsKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogc3RydWN0IGRybV9w
cm9wZXJ0eTsKK3N0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfY3J0YzsK
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOworc3RydWN0IGludGVsX3BsYW5lOwogCiBpbnQgaW50
ZWxfZGlnaXRhbF9jb25uZWN0b3JfYXRvbWljX2dldF9wcm9wZXJ0eShzdHJ1Y3QgZHJtX2Nvbm5l
Y3RvciAqY29ubmVjdG9yLAogCQkJCQkJY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUg
KnN0YXRlLApAQCAtNDYsNCArNDgsOCBAQCBpbnQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcnMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICAgICAgIHN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjLAogCQkJICAgICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKTsKIAorY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICoKK19faW50ZWxf
YXRvbWljX2dldF9jdXJyZW50X3BsYW5lX3N0YXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlLAorCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lKTsKKwogI2VuZGlm
IC8qIF9fSU5URUxfQVRPTUlDX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuaAppbmRleCA0YjllMThlNWEyNjMuLmFjMzc0MzQ1NzI2ZSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTQ0MCw2ICs0
NDAsMTUgQEAgZW51bSBwaHlfZmlhIHsKIAkgICAgIChfX2kpLS0pIFwKIAkJZm9yX2VhY2hfaWYo
Y3J0YykKIAorI2RlZmluZSBpbnRlbF9mb3JfZWFjaF9wbGFuZV9tYXNrKHBsYW5lLCBkZXYsIHBs
YW5lX21hc2spIFwKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KChwbGFuZSksICYoZGV2KS0+bW9kZV9j
b25maWcucGxhbmVfbGlzdCwgYmFzZS5oZWFkKSBcCisJCWZvcl9lYWNoX2lmICgocGxhbmVfbWFz
aykgJiBkcm1fcGxhbmVfbWFzaygmKHBsYW5lKS0+YmFzZSkpCisKKyNkZWZpbmUgaW50ZWxfYXRv
bWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLCBj
cnRjX3N0YXRlLCBzdGF0ZSkgXAorCWludGVsX2Zvcl9lYWNoX3BsYW5lX21hc2soKHBsYW5lKSwg
KHN0YXRlKS0+YmFzZS5kZXYsIChjcnRjX3N0YXRlKS0+YmFzZS5wbGFuZV9tYXNrKSBcCisJCWZv
cl9lYWNoX2lmICgoKHBsYW5lX3N0YXRlKSA9CQkJCVwKKwkJCSAgICAgIF9faW50ZWxfYXRvbWlj
X2dldF9jdXJyZW50X3BsYW5lX3N0YXRlKChzdGF0ZSksIChwbGFuZSkpKSkKKwogdm9pZCBpbnRl
bF9saW5rX2NvbXB1dGVfbV9uKHUxNiBicHAsIGludCBubGFuZXMsCiAJCQkgICAgaW50IHBpeGVs
X2Nsb2NrLCBpbnQgbGlua19jbG9jaywKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm1f
biwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IGJmY2YwM2FiNTI0NS4uYzI4NjEyNjNhZDQy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTMwODQsMTMgKzMwODQsMTMgQEAgc3RhdGlj
IGJvb2wgaWxrX3ZhbGlkYXRlX3BpcGVfd20oY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogLyogQ29tcHV0ZSBuZXcgd2F0ZXJtYXJrcyBmb3IgdGhlIHBpcGUgKi8KIHN0
YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRl
LT5iYXNlLnN0YXRlOwotCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOworCWNvbnN0IHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0KKwkJdG9faW50ZWxfYXRvbWljX3N0YXRlKGNy
dGNfc3RhdGUtPmJhc2Uuc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9waXBlX3dtICpwaXBlX3dtOwot
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+ZGV2OwotCWNvbnN0IHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgZHJtX3BsYW5l
ICpwbGFuZTsKLQljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKKwlz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGU7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwcmlzdGF0
ZSA9IE5VTEw7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzcHJzdGF0ZSA9IE5V
TEw7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpjdXJzdGF0ZSA9IE5VTEw7CkBA
IC0zMDk5LDE1ICszMDk5LDE0IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogCXBpcGVfd20gPSAmY3J0Y19zdGF0
ZS0+d20uaWxrLm9wdGltYWw7CiAKLQlkcm1fYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxh
bmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLCAmY3J0Y19zdGF0ZS0+YmFzZSkgewotCQljb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBzID0gdG9faW50ZWxfcGxhbmVfc3RhdGUocGxh
bmVfc3RhdGUpOwotCi0JCWlmIChwbGFuZS0+dHlwZSA9PSBEUk1fUExBTkVfVFlQRV9QUklNQVJZ
KQotCQkJcHJpc3RhdGUgPSBwczsKLQkJZWxzZSBpZiAocGxhbmUtPnR5cGUgPT0gRFJNX1BMQU5F
X1RZUEVfT1ZFUkxBWSkKLQkJCXNwcnN0YXRlID0gcHM7Ci0JCWVsc2UgaWYgKHBsYW5lLT50eXBl
ID09IERSTV9QTEFORV9UWVBFX0NVUlNPUikKLQkJCWN1cnN0YXRlID0gcHM7CisJaW50ZWxfYXRv
bWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLAor
CQkJCQkJICAgICBjcnRjX3N0YXRlLCBzdGF0ZSkgeworCQlpZiAocGxhbmUtPmlkID09IFBMQU5F
X1BSSU1BUlkpCisJCQlwcmlzdGF0ZSA9IHBsYW5lX3N0YXRlOworCQllbHNlIGlmIChwbGFuZS0+
aWQgPT0gUExBTkVfU1BSSVRFMCkKKwkJCXNwcnN0YXRlID0gcGxhbmVfc3RhdGU7CisJCWVsc2Ug
aWYgKHBsYW5lLT5pZCA9PSBQTEFORV9DVVJTT1IpCisJCQljdXJzdGF0ZSA9IHBsYW5lX3N0YXRl
OwogCX0KIAogCXBpcGVfd20tPnBpcGVfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmJhc2UuYWN0aXZl
OwpAQCAtMzEyOSw3ICszMTI4LDcgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9waXBlX3dtKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQl1c2FibGVfbGV2ZWwgPSAwOwog
CiAJbWVtc2V0KCZwaXBlX3dtLT53bSwgMCwgc2l6ZW9mKHBpcGVfd20tPndtKSk7Ci0JaWxrX2Nv
bXB1dGVfd21fbGV2ZWwoZGV2X3ByaXYsIGludGVsX2NydGMsIDAsIGNydGNfc3RhdGUsCisJaWxr
X2NvbXB1dGVfd21fbGV2ZWwoZGV2X3ByaXYsIGNydGMsIDAsIGNydGNfc3RhdGUsCiAJCQkgICAg
IHByaXN0YXRlLCBzcHJzdGF0ZSwgY3Vyc3RhdGUsICZwaXBlX3dtLT53bVswXSk7CiAKIAlpZiAo
SVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKQEAgLTMxNDMs
NyArMzE0Miw3IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlmb3IgKGxldmVsID0gMTsgbGV2ZWwgPD0gdXNhYmxl
X2xldmVsOyBsZXZlbCsrKSB7CiAJCXN0cnVjdCBpbnRlbF93bV9sZXZlbCAqd20gPSAmcGlwZV93
bS0+d21bbGV2ZWxdOwogCi0JCWlsa19jb21wdXRlX3dtX2xldmVsKGRldl9wcml2LCBpbnRlbF9j
cnRjLCBsZXZlbCwgY3J0Y19zdGF0ZSwKKwkJaWxrX2NvbXB1dGVfd21fbGV2ZWwoZGV2X3ByaXYs
IGNydGMsIGxldmVsLCBjcnRjX3N0YXRlLAogCQkJCSAgICAgcHJpc3RhdGUsIHNwcnN0YXRlLCBj
dXJzdGF0ZSwgd20pOwogCiAJCS8qCkBAIC00MTE5LDEzICs0MTE4LDE0IEBAIHNrbF9waXBlX2Rv
d25zY2FsZV9hbW91bnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiAJcmV0dXJuIHBpcGVfZG93bnNjYWxlOwogfQogCi1pbnQgc2tsX2NoZWNrX3BpcGVfbWF4X3Bp
eGVsX3JhdGUoc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCitpbnQgc2tsX2NoZWNrX3Bp
cGVfbWF4X3BpeGVsX3JhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2NydGMtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZHJt
X2F0b21pY19zdGF0ZSAqc3RhdGUgPSBjcnRjX3N0YXRlLT5iYXNlLnN0YXRlOwotCXN0cnVjdCBk
cm1fcGxhbmUgKnBsYW5lOwotCWNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKmRybV9wbGFu
ZV9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNy
dGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9CisJCXRv
X2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsKKwlzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lOworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGU7CiAJaW50IGNydGNfY2xvY2ssIGRvdGNsazsKIAl1MzIgcGlwZV9tYXhfcGl4ZWxfcmF0
ZTsKIAl1aW50X2ZpeGVkXzE2XzE2X3QgcGlwZV9kb3duc2NhbGU7CkBAIC00MTM0LDEyICs0MTM0
LDExIEBAIGludCBza2xfY2hlY2tfcGlwZV9tYXhfcGl4ZWxfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0
YyAqaW50ZWxfY3J0YywKIAlpZiAoIWNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQogCQlyZXR1cm4g
MDsKIAotCWRybV9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZShwbGFuZSwg
ZHJtX3BsYW5lX3N0YXRlLCAmY3J0Y19zdGF0ZS0+YmFzZSkgeworCWludGVsX2F0b21pY19jcnRj
X3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBwbGFuZV9zdGF0ZSwKKwkJCQkJCSAg
ICAgY3J0Y19zdGF0ZSwgc3RhdGUpIHsKIAkJdWludF9maXhlZF8xNl8xNl90IHBsYW5lX2Rvd25z
Y2FsZTsKIAkJdWludF9maXhlZF8xNl8xNl90IGZwXzlfZGl2XzggPSBkaXZfZml4ZWQxNig5LCA4
KTsKIAkJaW50IGJwcDsKLQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSA9Ci0JCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShkcm1fcGxhbmVfc3RhdGUpOwogCiAJCWlm
ICghaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSkpCiAJCQlj
b250aW51ZTsKQEAgLTQxNjAsNyArNDE1OSw3IEBAIGludCBza2xfY2hlY2tfcGlwZV9tYXhfcGl4
ZWxfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlwaXBlX2Rvd25zY2FsZSA9
IG11bF9maXhlZDE2KHBpcGVfZG93bnNjYWxlLCBtYXhfZG93bnNjYWxlKTsKIAogCWNydGNfY2xv
Y2sgPSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKLQlkb3RjbGsg
PSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpLT5jZGNsay5sb2dpY2FsLmNkY2xrOworCWRv
dGNsayA9IHN0YXRlLT5jZGNsay5sb2dpY2FsLmNkY2xrOwogCiAJaWYgKElTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpIHx8IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCiAJCWRvdGNsayAqPSAyOwpA
QCAtNDIyNiwyOSArNDIyNSwyOCBAQCBza2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgdTY0ICpwbGFuZV9kYXRh
X3JhdGUsCiAJCQkJIHU2NCAqdXZfcGxhbmVfZGF0YV9yYXRlKQogewotCXN0cnVjdCBkcm1fYXRv
bWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPmJhc2Uuc3RhdGU7Ci0Jc3RydWN0IGRybV9w
bGFuZSAqcGxhbmU7Ci0JY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqZHJtX3BsYW5lX3N0
YXRlOworCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0KKwkJdG9faW50ZWxfYXRv
bWljX3N0YXRlKGNydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmU7CisJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKIAl1
NjQgdG90YWxfZGF0YV9yYXRlID0gMDsKIAogCWlmIChXQVJOX09OKCFzdGF0ZSkpCiAJCXJldHVy
biAwOwogCiAJLyogQ2FsY3VsYXRlIGFuZCBjYWNoZSBkYXRhIHJhdGUgZm9yIGVhY2ggcGxhbmUg
Ki8KLQlkcm1fYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIGRy
bV9wbGFuZV9zdGF0ZSwgJmNydGNfc3RhdGUtPmJhc2UpIHsKLQkJZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZCA9IHRvX2ludGVsX3BsYW5lKHBsYW5lKS0+aWQ7Ci0JCWNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQotCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUoZHJtX3Bs
YW5lX3N0YXRlKTsKKwlpbnRlbF9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0
ZShwbGFuZSwgcGxhbmVfc3RhdGUsCisJCQkJCQkgICAgIGNydGNfc3RhdGUsIHN0YXRlKSB7CiAJ
CXU2NCByYXRlOwogCiAJCS8qIHBhY2tlZC95ICovCiAJCXJhdGUgPSBza2xfcGxhbmVfcmVsYXRp
dmVfZGF0YV9yYXRlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCAwKTsKLQkJcGxhbmVfZGF0YV9y
YXRlW3BsYW5lX2lkXSA9IHJhdGU7CisJCXBsYW5lX2RhdGFfcmF0ZVtwbGFuZS0+aWRdID0gcmF0
ZTsKIAkJdG90YWxfZGF0YV9yYXRlICs9IHJhdGU7CiAKIAkJLyogdXYtcGxhbmUgKi8KIAkJcmF0
ZSA9IHNrbF9wbGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUs
IDEpOwotCQl1dl9wbGFuZV9kYXRhX3JhdGVbcGxhbmVfaWRdID0gcmF0ZTsKKwkJdXZfcGxhbmVf
ZGF0YV9yYXRlW3BsYW5lLT5pZF0gPSByYXRlOwogCQl0b3RhbF9kYXRhX3JhdGUgKz0gcmF0ZTsK
IAl9CiAKQEAgLTQyNTksMzAgKzQyNTcsMzAgQEAgc3RhdGljIHU2NAogaWNsX2dldF90b3RhbF9y
ZWxhdGl2ZV9kYXRhX3JhdGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CQkJIHU2NCAqcGxhbmVfZGF0YV9yYXRlKQogewotCXN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lOwot
CWNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKmRybV9wbGFuZV9zdGF0ZTsKKwlzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRj
X3N0YXRlLT5iYXNlLnN0YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOworCWNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CiAJdTY0IHRvdGFsX2RhdGFf
cmF0ZSA9IDA7CiAKIAlpZiAoV0FSTl9PTighY3J0Y19zdGF0ZS0+YmFzZS5zdGF0ZSkpCiAJCXJl
dHVybiAwOwogCiAJLyogQ2FsY3VsYXRlIGFuZCBjYWNoZSBkYXRhIHJhdGUgZm9yIGVhY2ggcGxh
bmUgKi8KLQlkcm1fYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUs
IGRybV9wbGFuZV9zdGF0ZSwgJmNydGNfc3RhdGUtPmJhc2UpIHsKLQkJY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9Ci0JCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShk
cm1fcGxhbmVfc3RhdGUpOwotCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gdG9faW50ZWxfcGxh
bmUocGxhbmUpLT5pZDsKKwlpbnRlbF9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9z
dGF0ZShwbGFuZSwgcGxhbmVfc3RhdGUsCisJCQkJCQkgICAgIGNydGNfc3RhdGUsIHN0YXRlKSB7
CiAJCXU2NCByYXRlOwogCiAJCWlmICghcGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmUp
IHsKIAkJCXJhdGUgPSBza2xfcGxhbmVfcmVsYXRpdmVfZGF0YV9yYXRlKGNydGNfc3RhdGUsIHBs
YW5lX3N0YXRlLCAwKTsKLQkJCXBsYW5lX2RhdGFfcmF0ZVtwbGFuZV9pZF0gPSByYXRlOworCQkJ
cGxhbmVfZGF0YV9yYXRlW3BsYW5lLT5pZF0gPSByYXRlOwogCQkJdG90YWxfZGF0YV9yYXRlICs9
IHJhdGU7CiAJCX0gZWxzZSB7CiAJCQllbnVtIHBsYW5lX2lkIHlfcGxhbmVfaWQ7CiAKIAkJCS8q
CiAJCQkgKiBUaGUgc2xhdmUgcGxhbmUgbWlnaHQgbm90IGl0ZXJhdGUgaW4KLQkJCSAqIGRybV9h
dG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZSgpLAorCQkJICogaW50ZWxfYXRv
bWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUoKSwKIAkJCSAqIGFuZCBuZWVkcyB0
aGUgbWFzdGVyIHBsYW5lIHN0YXRlIHdoaWNoIG1heSBiZQogCQkJICogTlVMTCBpZiB3ZSB0cnkg
Z2V0X25ld19wbGFuZV9zdGF0ZSgpLCBzbyB3ZQogCQkJICogYWx3YXlzIGNhbGN1bGF0ZSBmcm9t
IHRoZSBtYXN0ZXIuCkBAIC00Mjk3LDcgKzQyOTUsNyBAQCBpY2xfZ2V0X3RvdGFsX3JlbGF0aXZl
X2RhdGFfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCXRvdGFs
X2RhdGFfcmF0ZSArPSByYXRlOwogCiAJCQlyYXRlID0gc2tsX3BsYW5lX3JlbGF0aXZlX2RhdGFf
cmF0ZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSwgMSk7Ci0JCQlwbGFuZV9kYXRhX3JhdGVbcGxh
bmVfaWRdID0gcmF0ZTsKKwkJCXBsYW5lX2RhdGFfcmF0ZVtwbGFuZS0+aWRdID0gcmF0ZTsKIAkJ
CXRvdGFsX2RhdGFfcmF0ZSArPSByYXRlOwogCQl9CiAJfQpAQCAtNTA2MywxMCArNTA2MSwxMiBA
QCBzdGF0aWMgaW50IGljbF9idWlsZF9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAogc3RhdGljIGludCBza2xfYnVpbGRfcGlwZV93bShzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSA9CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT5iYXNlLnN0YXRlKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUt
PmJhc2UuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3Qgc2tsX3BpcGVfd20gKnBpcGVfd20gPSAmY3J0Y19z
dGF0ZS0+d20uc2tsLm9wdGltYWw7Ci0Jc3RydWN0IGRybV9wbGFuZSAqcGxhbmU7Ci0JY29uc3Qg
c3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqZHJtX3BsYW5lX3N0YXRlOworCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmU7CisJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZTsKIAlpbnQgcmV0OwogCiAJLyoKQEAgLTUwNzUsMTEgKzUwNzUsOCBAQCBzdGF0aWMgaW50IHNr
bF9idWlsZF9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAq
LwogCW1lbXNldChwaXBlX3dtLT5wbGFuZXMsIDAsIHNpemVvZihwaXBlX3dtLT5wbGFuZXMpKTsK
IAotCWRybV9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZShwbGFuZSwgZHJt
X3BsYW5lX3N0YXRlLAotCQkJCQkJICAgJmNydGNfc3RhdGUtPmJhc2UpIHsKLQkJY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9Ci0JCQl0b19pbnRlbF9wbGFuZV9z
dGF0ZShkcm1fcGxhbmVfc3RhdGUpOwotCisJaW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2Vh
Y2hfcGxhbmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLAorCQkJCQkJICAgICBjcnRjX3N0YXRl
LCBzdGF0ZSkgewogCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKIAkJCXJldCA9IGlj
bF9idWlsZF9wbGFuZV93bShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAJCWVsc2UKLS0gCjIu
MjEuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

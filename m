Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F253CE998A
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 10:53:49 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 691A56E90D;
	Wed, 30 Oct 2019 09:53:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F2EB86E90A
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 09:53:39 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19016533-1500050 
 for multiple; Wed, 30 Oct 2019 09:53:29 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Oct 2019 09:53:27 +0000
Message-Id: <20191030095327.23359-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191030095327.23359-1-chris@chris-wilson.co.uk>
References: <20191030095327.23359-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/3] drm/i915: Remove i915->kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsb2NhdGUgb25seSBhbiBpbnRlcm5hbCBpbnRlbF9jb250ZXh0IGZvciB0aGUga2VybmVsX2Nv
bnRleHQsIGZvcmdvaW5nCmEgZ2xvYmFsIEdFTSBjb250ZXh0IGZvciBpbnRlcm5hbCB1c2UgYXMg
d2Ugb25seSByZXF1aXJlIGEgc2VwYXJhdGUKYWRkcmVzcyBzcGFjZSAoZm9yIG91ciBvd24gcHJv
dGVjdGlvbikuCgpOb3cgaGF2aW5nIHdlYW5lZCBHVCBmcm9tIHJlcXVpcmluZyBjZS0+Z2VtX2Nv
bnRleHQsIHdlIGNhbiBzdG9wCnJlZmVyZW5jaW5nIGl0IGVudGlyZWx5LiBUaGlzIGFsc28gbWVh
bnMgd2Ugbm8gbG9uZ2VyIGhhdmUgdG8gY3JlYXRlIHJhbmRvbQphbmQgdW5uZWNlc3NhcnkgR0VN
IGNvbnRleHRzIGZvciBpbnRlcm5hbCB1c2UuCgpHRU0gY29udGV4dHMgYXJlIG5vdyBlbnRpcmVs
eSBmb3IgdHJhY2tpbmcgR0VNIGNsaWVudHMsIGFuZCBpbnRlbF9jb250ZXh0CnRoZSBleGVjdXRp
b24gZW52aXJvbm1lbnQgb24gdGhlIEdQVS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgICB8ICA5MSArKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgIDYgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgMzIgKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfY3MuYyAgICAgfCAgMjEgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndC5jICAgICAgICAgICAgfCAgMjEgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF90eXBlcy5oICAgICAgfCAgIDcgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMgICAgICAgICAgIHwgIDE4ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmggICAgICAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yZXNldC5jICAgICAgICAgfCAgIDYgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmluZ19zdWJtaXNzaW9uLmMgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfY29udGV4dC5jICAgIHwgIDUxICsrLS0tLS0KIC4uLi9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9lbmdpbmVfaGVhcnRiZWF0LmMgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDI5ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8IDEzNyArKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyAgICAgICAgICB8ICAxNiArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICAzIC0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8ICAxNiArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jICAgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAgMyAtCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICAgICAgfCAgNTAgKysrKy0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIHwgICA2ICstCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAgIDggKy0KIDI4IGZpbGVzIGNoYW5n
ZWQsIDIyNiBpbnNlcnRpb25zKCspLCAzNTMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggNDU1NjkwYzgwZDQyLi5mZjllNjRj
NTEzZTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpA
QCAtMTcwLDYgKzE3MCwyNiBAQCBsb29rdXBfdXNlcl9lbmdpbmUoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwKIAlyZXR1cm4gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgaWR4
KTsKIH0KIAorc3RhdGljIHZvaWQgaW50ZWxfY29udGV4dF9zZXRfZ2VtKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSwKKwkJCQkgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCit7CisJY2Ut
PmdlbV9jb250ZXh0ID0gY3R4OworCisJY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmluZ19z
aXplKFNaXzE2Syk7CisKKwlpZiAoY3R4LT52bSkgeworCQlpOTE1X3ZtX3B1dChjZS0+dm0pOwor
CQljZS0+dm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtKTsKKwl9CisKKwlpZiAoY3R4LT50aW1lbGlu
ZSkKKwkJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfZ2V0KGN0eC0+dGltZWxpbmUpOwor
CisJaWYgKGN0eC0+c2NoZWQucHJpb3JpdHkgPj0gSTkxNV9QUklPUklUWV9OT1JNQUwgJiYKKwkg
ICAgaW50ZWxfZW5naW5lX2hhc19zZW1hcGhvcmVzKGNlLT5lbmdpbmUpKQorCQlfX3NldF9iaXQo
Q09OVEVYVF9VU0VfU0VNQVBIT1JFUywgJmNlLT5mbGFncyk7Cit9CisKIHN0YXRpYyB2b2lkIF9f
ZnJlZV9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzICplLCB1bnNpZ25lZCBpbnQgY291
bnQpCiB7CiAJd2hpbGUgKGNvdW50LS0pIHsKQEAgLTIxMiwxMiArMjMyLDE0IEBAIHN0YXRpYyBz
dHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZGVmYXVsdF9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgpCiAJCUdFTV9CVUdfT04oZW5naW5lLT5sZWdhY3lfaWR4ID49IEk5MTVfTlVN
X0VOR0lORVMpOwogCQlHRU1fQlVHX09OKGUtPmVuZ2luZXNbZW5naW5lLT5sZWdhY3lfaWR4XSk7
CiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShjdHgsIGVuZ2luZSk7CisJCWNlID0gaW50
ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihjZSkpIHsKIAkJCV9fZnJl
ZV9lbmdpbmVzKGUsIGUtPm51bV9lbmdpbmVzICsgMSk7CiAJCQlyZXR1cm4gRVJSX0NBU1QoY2Up
OwogCQl9CiAKKwkJaW50ZWxfY29udGV4dF9zZXRfZ2VtKGNlLCBjdHgpOworCiAJCWUtPmVuZ2lu
ZXNbZW5naW5lLT5sZWdhY3lfaWR4XSA9IGNlOwogCQllLT5udW1fZW5naW5lcyA9IG1heChlLT5u
dW1fZW5naW5lcywgZW5naW5lLT5sZWdhY3lfaWR4KTsKIAl9CkBAIC02MzQsMzcgKzY1Niw2IEBA
IGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1
bnNpZ25lZCBpbnQgZmxhZ3MpCiAJcmV0dXJuIGN0eDsKIH0KIAotc3RhdGljIHZvaWQKLWRlc3Ry
b3lfa2VybmVsX2NvbnRleHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKipjdHhwKQotewotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0KLQkvKiBLZWVwIHRoZSBjb250ZXh0IHJlZiBz
byB0aGF0IHdlIGNhbiBmcmVlIGl0IGltbWVkaWF0ZWx5IG91cnNlbHZlcyAqLwotCWN0eCA9IGk5
MTVfZ2VtX2NvbnRleHRfZ2V0KGZldGNoX2FuZF96ZXJvKGN0eHApKTsKLQlHRU1fQlVHX09OKCFp
OTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjdHgpKTsKLQotCWNvbnRleHRfY2xvc2UoY3R4KTsK
LQlpOTE1X2dlbV9jb250ZXh0X2ZyZWUoY3R4KTsKLX0KLQotc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKgotaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCBpbnQgcHJpbykKLXsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4Owot
Ci0JY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkxNSwgMCk7Ci0JaWYgKElTX0VSUihj
dHgpKQotCQlyZXR1cm4gY3R4OwotCi0JaTkxNV9nZW1fY29udGV4dF9jbGVhcl9iYW5uYWJsZShj
dHgpOwotCWk5MTVfZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlKGN0eCk7Ci0JY3R4LT5zY2hl
ZC5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWShwcmlvKTsKLQotCUdFTV9CVUdfT04oIWk5
MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKGN0eCkpOwotCi0JcmV0dXJuIGN0eDsKLX0KLQogc3Rh
dGljIHZvaWQgaW5pdF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogewog
CXNwaW5fbG9ja19pbml0KCZnYy0+bG9jayk7CkBAIC02NzQsMzIgKzY2NSwxMiBAQCBzdGF0aWMg
dm9pZCBpbml0X2NvbnRleHRzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiAJaW5pdF9s
bGlzdF9oZWFkKCZnYy0+ZnJlZV9saXN0KTsKIH0KIAotaW50IGk5MTVfZ2VtX2luaXRfY29udGV4
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit2b2lkIGk5MTVfZ2VtX2luaXRfY29u
dGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eDsKLQotCS8qIFJlYXNzdXJlIG91cnNlbHZlcyB3ZSBhcmUgb25seSBjYWxs
ZWQgb25jZSAqLwotCUdFTV9CVUdfT04oaTkxNS0+a2VybmVsX2NvbnRleHQpOwotCiAJaW5pdF9j
b250ZXh0cygmaTkxNS0+Z2VtLmNvbnRleHRzKTsKLQotCS8qIGxvd2VzdCBwcmlvcml0eTsgaWRs
ZSB0YXNrICovCi0JY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5
MTVfUFJJT1JJVFlfTUlOKTsKLQlpZiAoSVNfRVJSKGN0eCkpIHsKLQkJRFJNX0VSUk9SKCJGYWls
ZWQgdG8gY3JlYXRlIGRlZmF1bHQgZ2xvYmFsIGNvbnRleHRcbiIpOwotCQlyZXR1cm4gUFRSX0VS
UihjdHgpOwotCX0KLQlpOTE1LT5rZXJuZWxfY29udGV4dCA9IGN0eDsKLQogCURSTV9ERUJVR19E
UklWRVIoIiVzIGNvbnRleHQgc3VwcG9ydCBpbml0aWFsaXplZFxuIiwKIAkJCSBEUklWRVJfQ0FQ
UyhpOTE1KS0+aGFzX2xvZ2ljYWxfY29udGV4dHMgPwogCQkJICJsb2dpY2FsIiA6ICJmYWtlIik7
Ci0JcmV0dXJuIDA7Ci19Ci0KLXZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQotewotCWRlc3Ryb3lfa2VybmVsX2NvbnRl
eHQoJmk5MTUtPmtlcm5lbF9jb250ZXh0KTsKIH0KIAogc3RhdGljIGludCBjb250ZXh0X2lkcl9j
bGVhbnVwKGludCBpZCwgdm9pZCAqcCwgdm9pZCAqZGF0YSkKQEAgLTE0NTcsMTIgKzE0MjgsMTQg
QEAgc2V0X2VuZ2luZXNfX2xvYWRfYmFsYW5jZShzdHJ1Y3QgaTkxNV91c2VyX2V4dGVuc2lvbiBf
X3VzZXIgKmJhc2UsIHZvaWQgKmRhdGEpCiAJCX0KIAl9CiAKLQljZSA9IGludGVsX2V4ZWNsaXN0
c19jcmVhdGVfdmlydHVhbChzZXQtPmN0eCwgc2libGluZ3MsIG4pOworCWNlID0gaW50ZWxfZXhl
Y2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHNpYmxpbmdzLCBuKTsKIAlpZiAoSVNfRVJSKGNlKSkgewog
CQllcnIgPSBQVFJfRVJSKGNlKTsKIAkJZ290byBvdXRfc2libGluZ3M7CiAJfQogCisJaW50ZWxf
Y29udGV4dF9zZXRfZ2VtKGNlLCBzZXQtPmN0eCk7CisKIAlpZiAoY21weGNoZygmc2V0LT5lbmdp
bmVzLT5lbmdpbmVzW2lkeF0sIE5VTEwsIGNlKSkgewogCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7
CiAJCWVyciA9IC1FRVhJU1Q7CkBAIC0xNjMyLDEyICsxNjA1LDE0IEBAIHNldF9lbmdpbmVzKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQlyZXR1cm4gLUVOT0VOVDsKIAkJfQogCi0J
CWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUpOworCQljZSA9IGludGVsX2Nv
bnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQlfX2ZyZWVfZW5n
aW5lcyhzZXQuZW5naW5lcywgbik7CiAJCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAJCX0KIAorCQlp
bnRlbF9jb250ZXh0X3NldF9nZW0oY2UsIGN0eCk7CisKIAkJc2V0LmVuZ2luZXMtPmVuZ2luZXNb
bl0gPSBjZTsKIAl9CiAJc2V0LmVuZ2luZXMtPm51bV9lbmdpbmVzID0gbnVtX2VuZ2luZXM7CkBA
IC0xOTM4LDEzICsxOTEzLDE1IEBAIHN0YXRpYyBpbnQgY2xvbmVfZW5naW5lcyhzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqZHN0LAogCQkgKi8KIAkJaWYgKGludGVsX2VuZ2luZV9pc192aXJ0dWFs
KGVuZ2luZSkpCiAJCQljbG9uZS0+ZW5naW5lc1tuXSA9Ci0JCQkJaW50ZWxfZXhlY2xpc3RzX2Ns
b25lX3ZpcnR1YWwoZHN0LCBlbmdpbmUpOworCQkJCWludGVsX2V4ZWNsaXN0c19jbG9uZV92aXJ0
dWFsKGVuZ2luZSk7CiAJCWVsc2UKLQkJCWNsb25lLT5lbmdpbmVzW25dID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZHN0LCBlbmdpbmUpOworCQkJY2xvbmUtPmVuZ2luZXNbbl0gPSBpbnRlbF9jb250
ZXh0X2NyZWF0ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSX09SX05VTEwoY2xvbmUtPmVuZ2luZXNb
bl0pKSB7CiAJCQlfX2ZyZWVfZW5naW5lcyhjbG9uZSwgbik7CiAJCQlnb3RvIGVycl91bmxvY2s7
CiAJCX0KKworCQlpbnRlbF9jb250ZXh0X3NldF9nZW0oY2xvbmUtPmVuZ2luZXNbbl0sIGRzdCk7
CiAJfQogCWNsb25lLT5udW1fZW5naW5lcyA9IG47CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY29udGV4dC5oCmluZGV4IDY5OTMyODk5ODAzZS4uZDk5ZmZmNDgxZDU5IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKQEAgLTExNSw4
ICsxMTUsNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwo
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIH0KIAogLyogaTkxNV9nZW1fY29udGV4dC5j
ICovCi1pbnQgX19tdXN0X2NoZWNrIGk5MTVfZ2VtX2luaXRfY29udGV4dHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpOwotdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpOTE1X2dlbV9pbml0X2Nv
bnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogaW50IGk5MTVfZ2VtX2Nv
bnRleHRfb3BlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgc3RydWN0IGRy
bV9maWxlICpmaWxlKTsKQEAgLTE0MCw5ICsxMzksNiBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9z
ZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogaW50IGk5
MTVfZ2VtX2NvbnRleHRfcmVzZXRfc3RhdHNfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
dm9pZCAqZGF0YSwKIAkJCQkgICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlKTsKIAotc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKgotaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgcHJpbyk7Ci0KIHN0YXRpYyBpbmxpbmUgc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKgogaTkxNV9nZW1fY29udGV4dF9nZXQoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZXhlY2J1ZmZlci5jCmluZGV4IDZkYzg2YzEyOWVlZS4uNGY2Yjg0N2VhMDExIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTEyNjEs
OCArMTI2MSw3IEBAIHN0YXRpYyB1MzIgKnJlbG9jX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVy
ICplYiwKIAkJCSAqIG1lbW9yeSBsb2NhdGlvbi4KIAkJCSAqLwogCQkJaWYgKGNhY2hlLT5nZW4g
Pj0gMTIpCi0JCQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlYi0+Y29udGV4dC0+Z2VtX2Nv
bnRleHQsCi0JCQkJCQkJICBlYi0+ZW5naW5lKTsKKwkJCQljZSA9IGludGVsX2NvbnRleHRfY3Jl
YXRlKGViLT5lbmdpbmUpOwogCQkJZWxzZQogCQkJCWNlID0gaW50ZWxfY29udGV4dF9nZXQoZWIt
PmNvbnRleHQpOwogCQkJaWYgKElTX0VSUihjZSkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3VzZXJwdHIuYwppbmRleCAxZTA0NWMzMzcwNDQuLjQzMmYyODI4YjA5MyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCkBAIC03NTMsMTUg
Kzc1MywxMSBAQCBpOTE1X2dlbV91c2VycHRyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiAJCXJldHVybiAtRUZBVUxUOwogCiAJaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9VU0VSUFRSX1JF
QURfT05MWSkgewotCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKLQogCQkvKgogCQkg
KiBPbiBhbG1vc3QgYWxsIG9mIHRoZSBvbGRlciBodywgd2UgY2Fubm90IHRlbGwgdGhlIEdQVSB0
aGF0CiAJCSAqIGEgcGFnZSBpcyByZWFkb25seS4KIAkJICovCi0JCXZtID0gcmN1X2RlcmVmZXJl
bmNlX3Byb3RlY3RlZChkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQtPnZtLAotCQkJCQkgICAgICAg
dHJ1ZSk7IC8qIHN0YXRpYyB2bSAqLwotCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkK
KwkJaWYgKCFkZXZfcHJpdi0+Z3Qudm0tPmhhc19yZWFkX29ubHkpCiAJCQlyZXR1cm4gLUVOT0RF
VjsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9jb250ZXh0LmMKaW5kZXggYzZlNjE1NjRiYjVlLi42ZDE3NGNhYThmOGIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jCkBAIC0zMDksNyArMzA5LDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRj
aCh2b2lkICphcmcpCiAJCQlpZiAoIWRhdGFbbV0uY2VbMF0pCiAJCQkJY29udGludWU7CiAKLQkJ
CWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBkYXRhW21dLmNlWzBdLT5lbmdpbmUpOwor
CQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShkYXRhW21dLmNlWzBdLT5lbmdpbmUpOwogCQkJ
aWYgKElTX0VSUihjZSkpCiAJCQkJZ290byBvdXQ7CiAKQEAgLTEyMzAsOCArMTIzMCw3IEBAIF9f
aWd0X2N0eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJaHdlaWdodDMy
KGVuZ2luZS0+c3NldS5zbGljZV9tYXNrKSwKIAkJCWh3ZWlnaHQzMihwZ19zc2V1LnNsaWNlX21h
c2spKTsKIAotCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRl
eHQtPmdlbV9jb250ZXh0LAotCQkJCQkgIGVuZ2luZSk7CisJCWNlID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihjZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIoY2Up
OwogCQkJZ290byBvdXRfcHV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvbW9ja19jb250ZXh0LmMKaW5kZXggMjliODk4NGYwZTQ3Li5mNDcyZmM5MjQwZDUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQu
YwpAQCAtOTcsNyArOTcsMTYgQEAgbGl2ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
CiBrZXJuZWxfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlyZXR1
cm4gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlfTk9S
TUFMKTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCisJY3R4ID0gaTkxNV9nZW1f
Y3JlYXRlX2NvbnRleHQoaTkxNSwgMCk7CisJaWYgKElTX0VSUihjdHgpKQorCQlyZXR1cm4gY3R4
OworCisJR0VNX0JVR19PTighaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwoY3R4KSk7CisJaTkx
NV9nZW1fY29udGV4dF9jbGVhcl9iYW5uYWJsZShjdHgpOworCisJcmV0dXJuIGN0eDsKIH0KIAog
dm9pZCBrZXJuZWxfY29udGV4dF9jbG9zZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IDcwNzVkMDNmNTA4Zi4u
OGI3MWIyY2NiZjI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9j
b250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBA
IC0zMSw4ICszMSw3IEBAIHZvaWQgaW50ZWxfY29udGV4dF9mcmVlKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSkKIH0KIAogc3RydWN0IGludGVsX2NvbnRleHQgKgotaW50ZWxfY29udGV4dF9jcmVh
dGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJICAgICBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCitpbnRlbF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCkBAIC00MCw3ICsz
OSw3IEBAIGludGVsX2NvbnRleHRfY3JlYXRlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
CiAJaWYgKCFjZSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKLQlpbnRlbF9jb250ZXh0
X2luaXQoY2UsIGN0eCwgZW5naW5lKTsKKwlpbnRlbF9jb250ZXh0X2luaXQoY2UsIGVuZ2luZSk7
CiAJcmV0dXJuIGNlOwogfQogCkBAIC03Miw4ICs3MSw2IEBAIGludCBfX2ludGVsX2NvbnRleHRf
ZG9fcGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAkJCSAgY2UtPmVuZ2luZS0+bmFtZSwg
Y2UtPnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0LAogCQkJICBjZS0+cmluZy0+aGVhZCwgY2UtPnJp
bmctPnRhaWwpOwogCi0JCWk5MTVfZ2VtX2NvbnRleHRfZ2V0KGNlLT5nZW1fY29udGV4dCk7IC8q
IGZvciBjdHgtPnBwZ3R0ICovCi0KIAkJc21wX21iX19iZWZvcmVfYXRvbWljKCk7IC8qIGZsdXNo
IHBpbiBiZWZvcmUgaXQgaXMgdmlzaWJsZSAqLwogCX0KIApAQCAtMTAzLDcgKzEwMCw2IEBAIHZv
aWQgaW50ZWxfY29udGV4dF91bnBpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIAkJY2Ut
Pm9wcy0+dW5waW4oY2UpOwogCi0JCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGNlLT5nZW1fY29udGV4
dCk7CiAJCWludGVsX2NvbnRleHRfYWN0aXZlX3JlbGVhc2UoY2UpOwogCX0KIApAQCAtMTk4LDcg
KzE5NCw3IEBAIGludCBpbnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSkKIAkJcmV0dXJuIGVycjsKIAogCS8qIFByZWFsbG9jYXRlIHRyYWNraW5nIG5v
ZGVzICovCi0JaWYgKCFpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjZS0+Z2VtX2NvbnRleHQp
KSB7CisJaWYgKGNlLT5nZW1fY29udGV4dCkgewogCQllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJl
X3ByZWFsbG9jYXRlX2JhcnJpZXIoJmNlLT5hY3RpdmUsCiAJCQkJCQkJICAgICAgY2UtPmVuZ2lu
ZSk7CiAJCWlmIChlcnIpIHsKQEAgLTIxOSwzMyArMjE1LDE5IEBAIHZvaWQgaW50ZWxfY29udGV4
dF9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIHZvaWQKIGludGVs
X2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCi0JCSAgIHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCiAJCSAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IHsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKLQogCUdFTV9CVUdfT04oIWVuZ2lu
ZS0+Y29wcyk7CisJR0VNX0JVR19PTighZW5naW5lLT5ndC0+dm0pOwogCiAJa3JlZl9pbml0KCZj
ZS0+cmVmKTsKIAotCWNlLT5nZW1fY29udGV4dCA9IGN0eDsKLQlyY3VfcmVhZF9sb2NrKCk7Ci0J
dm0gPSByY3VfZGVyZWZlcmVuY2UoY3R4LT52bSk7Ci0JaWYgKHZtKQotCQljZS0+dm0gPSBpOTE1
X3ZtX2dldCh2bSk7Ci0JZWxzZQotCQljZS0+dm0gPSBpOTE1X3ZtX2dldCgmZW5naW5lLT5ndC0+
Z2d0dC0+dm0pOwotCXJjdV9yZWFkX3VubG9jaygpOwotCWlmIChjdHgtPnRpbWVsaW5lKQotCQlj
ZS0+dGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7Ci0JaWYgKGN0
eC0+c2NoZWQucHJpb3JpdHkgPj0gSTkxNV9QUklPUklUWV9OT1JNQUwgJiYKLQkgICAgaW50ZWxf
ZW5naW5lX2hhc19zZW1hcGhvcmVzKGVuZ2luZSkpCi0JCV9fc2V0X2JpdChDT05URVhUX1VTRV9T
RU1BUEhPUkVTLCAmY2UtPmZsYWdzKTsKLQogCWNlLT5lbmdpbmUgPSBlbmdpbmU7CiAJY2UtPm9w
cyA9IGVuZ2luZS0+Y29wczsKIAljZS0+c3NldSA9IGVuZ2luZS0+c3NldTsKLQljZS0+cmluZyA9
IF9faW50ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfMTZLKTsKKwljZS0+cmluZyA9IF9faW50ZWxf
Y29udGV4dF9yaW5nX3NpemUoU1pfNEspOworCisJY2UtPnZtID0gaTkxNV92bV9nZXQoZW5naW5l
LT5ndC0+dm0pOwogCiAJSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGluayk7CiAJSU5JVF9M
SVNUX0hFQUQoJmNlLT5zaWduYWxzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRl
eHQuaAppbmRleCBkN2I2NjdhMjZlMDguLjE1YmM0NmUxYjMwOCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2NvbnRleHQuaApAQCAtMTgsMTMgKzE4LDExIEBACiAjaW5jbHVkZSAiaW50
ZWxfdGltZWxpbmVfdHlwZXMuaCIKIAogdm9pZCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlLAotCQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CiB2b2lkIGludGVsX2NvbnRleHRfZmluaShz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRl
bF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkgICAgIHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CitpbnRlbF9jb250ZXh0X2NyZWF0ZShzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCiB2b2lkIGludGVsX2NvbnRleHRfZnJlZShz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2VuZ2luZV9jcy5jCmluZGV4IGVmZGUzZjhlMDU1OS4uYjM4ZWE0NGFiNzYxIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtNzU2LDEyICs3NTYsMTAgQEAg
Y3JlYXRlX2tlcm5lbF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVycjsKIAotCWNlID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZW5naW5lLT5pOTE1LT5rZXJuZWxfY29udGV4dCwgZW5naW5lKTsKKwljZSA9IGlu
dGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihjZSkpCiAJCXJldHVybiBj
ZTsKIAotCWNlLT5yaW5nID0gX19pbnRlbF9jb250ZXh0X3Jpbmdfc2l6ZShTWl80Syk7Ci0KIAll
cnIgPSBpbnRlbF9jb250ZXh0X3BpbihjZSk7CiAJaWYgKGVycikgewogCQlpbnRlbF9jb250ZXh0
X3B1dChjZSk7CkBAIC03OTcsNiArNzk1LDEyIEBAIGludCBpbnRlbF9lbmdpbmVfaW5pdF9jb21t
b24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJZW5naW5lLT5zZXRfZGVmYXVs
dF9zdWJtaXNzaW9uKGVuZ2luZSk7CiAKKwlyZXQgPSBtZWFzdXJlX2JyZWFkY3J1bWJfZHcoZW5n
aW5lKTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCWVuZ2luZS0+ZW1pdF9maW5p
X2JyZWFkY3J1bWJfZHcgPSByZXQ7CisKIAkvKgogCSAqIFdlIG1heSBuZWVkIHRvIGRvIHRoaW5n
cyB3aXRoIHRoZSBzaHJpbmtlciB3aGljaAogCSAqIHJlcXVpcmUgdXMgdG8gaW1tZWRpYXRlbHkg
c3dpdGNoIGJhY2sgdG8gdGhlIGRlZmF1bHQKQEAgLTgxMSwxOCArODE1LDcgQEAgaW50IGludGVs
X2VuZ2luZV9pbml0X2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAll
bmdpbmUtPmtlcm5lbF9jb250ZXh0ID0gY2U7CiAKLQlyZXQgPSBtZWFzdXJlX2JyZWFkY3J1bWJf
ZHcoZW5naW5lKTsKLQlpZiAocmV0IDwgMCkKLQkJZ290byBlcnJfdW5waW47Ci0KLQllbmdpbmUt
PmVtaXRfZmluaV9icmVhZGNydW1iX2R3ID0gcmV0OwotCiAJcmV0dXJuIDA7Ci0KLWVycl91bnBp
bjoKLQlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKLQlpbnRlbF9jb250ZXh0X3B1dChjZSk7Ci0J
cmV0dXJuIHJldDsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBm
MjQ0MDExM2ZkZjguLjg5YjYyOTU2MWQ1MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5j
CkBAIC02OSw3ICs2OSw2IEBAIGludCBpbnRlbF9ndF9pbml0X2h3KHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKIAlpbnQgcmV0
OwogCi0JQlVHX09OKCFpOTE1LT5rZXJuZWxfY29udGV4dCk7CiAJcmV0ID0gaW50ZWxfZ3RfdGVy
bWluYWxseV93ZWRnZWQoZ3QpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC0zNzAsNyAr
MzY5LDIwIEBAIGludCBpbnRlbF9ndF9pbml0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIAlpbnRl
bF9ndF9wbV9pbml0KGd0KTsKIAorCWlmIChJTlRFTF9QUEdUVChndC0+aTkxNSkgPiBJTlRFTF9Q
UEdUVF9BTElBU0lORykKKwkJZ3QtPnZtID0gJmk5MTVfcHBndHRfY3JlYXRlKGd0LT5pOTE1KS0+
dm07CisJZWxzZQorCQlndC0+dm0gPSBpOTE1X3ZtX2dldCgmZ3QtPmdndHQtPnZtKTsKKwlpZiAo
IWd0LT52bSkgeworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl9zY3JhdGNoOworCX0KKwog
CXJldHVybiAwOworCitlcnJfc2NyYXRjaDoKKwlpbnRlbF9ndF9maW5pX3NjcmF0Y2goZ3QpOwor
CXJldHVybiBlcnI7CiB9CiAKIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3JlbW92ZShzdHJ1Y3QgaW50
ZWxfZ3QgKmd0KQpAQCAtMzg1LDYgKzM5NywxMyBAQCB2b2lkIGludGVsX2d0X2RyaXZlcl91bnJl
Z2lzdGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3JlbGVh
c2Uoc3RydWN0IGludGVsX2d0ICpndCkKIHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bTsKKworCXZtID0gZmV0Y2hfYW5kX3plcm8oJmd0LT52bSk7CisJaWYgKCF2bSkgLyogRklYTUUg
YmVpbmcgY2FsbGVkIHR3aWNlIG9uIGVycm9yIHBhdGhzIDooICovCisJCXJldHVybjsKKworCWk5
MTVfdm1fcHV0KHZtKTsKIAlpbnRlbF9ndF9wbV9maW5pKGd0KTsKIAlpbnRlbF9ndF9maW5pX3Nj
cmF0Y2goZ3QpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Z3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKaW5k
ZXggZDRlMTRkYmQxNzJlLi45Njg5MGRkMTJiNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3RfdHlwZXMuaApAQCAtOTAsNiArOTAsMTMgQEAgc3RydWN0IGludGVsX2d0IHsKIAlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmVbSTkxNV9OVU1fRU5HSU5FU107CiAJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lX2NsYXNzW01BWF9FTkdJTkVfQ0xBU1MgKyAxXQogCQkJ
CQkgICAgW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKKworCS8qCisJICogRGVmYXVsdCBhZGRy
ZXNzIHNwYWNlIChlaXRoZXIgR0dUVCBvciBwcEdUVCBkZXBlbmRpbmcgb24gYXJjaCkuCisJICoK
KwkgKiBSZXNlcnZlZCBmb3IgZXhjbHVzaXZlIHVzZSBieSB0aGUga2VybmVsLgorCSAqLworCXN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogfTsKIAogZW51bSBpbnRlbF9ndF9zY3JhdGNo
X2ZpZWxkIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggNWIyM2FlYjUwMzg1
Li4yNDJlNjkyNzY3NWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0xMzMs
MTIgKzEzMywxMSBAQAogICovCiAjaW5jbHVkZSA8bGludXgvaW50ZXJydXB0Lmg+CiAKLSNpbmNs
dWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgotCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNp
bmNsdWRlICJpOTE1X3BlcmYuaCIKICNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCiAjaW5jbHVkZSAi
aTkxNV92Z3B1LmgiCisjaW5jbHVkZSAiaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUgImludGVs
X2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3Rf
cG0uaCIKQEAgLTQzOTMsOCArNDM5Miw3IEBAIHZpcnR1YWxfYm9uZF9leGVjdXRlKHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgZG1hX2ZlbmNlICpzaWduYWwpCiB9CiAKIHN0cnVjdCBp
bnRlbF9jb250ZXh0ICoKLWludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LAotCQkJICAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipz
aWJsaW5ncywKK2ludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICoqc2libGluZ3MsCiAJCQkgICAgICAgdW5zaWduZWQgaW50IGNvdW50KQogewogCXN0
cnVjdCB2aXJ0dWFsX2VuZ2luZSAqdmU7CkBAIC00NDA1LDEzICs0NDAzLDEzIEBAIGludGVsX2V4
ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQly
ZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIAogCWlmIChjb3VudCA9PSAxKQotCQlyZXR1cm4gaW50
ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBzaWJsaW5nc1swXSk7CisJCXJldHVybiBpbnRlbF9jb250
ZXh0X2NyZWF0ZShzaWJsaW5nc1swXSk7CiAKIAl2ZSA9IGt6YWxsb2Moc3RydWN0X3NpemUodmUs
IHNpYmxpbmdzLCBjb3VudCksIEdGUF9LRVJORUwpOwogCWlmICghdmUpCiAJCXJldHVybiBFUlJf
UFRSKC1FTk9NRU0pOwogCi0JdmUtPmJhc2UuaTkxNSA9IGN0eC0+aTkxNTsKKwl2ZS0+YmFzZS5p
OTE1ID0gc2libGluZ3NbMF0tPmk5MTU7CiAJdmUtPmJhc2UuZ3QgPSBzaWJsaW5nc1swXS0+Z3Q7
CiAJdmUtPmJhc2UudW5jb3JlID0gc2libGluZ3NbMF0tPnVuY29yZTsKIAl2ZS0+YmFzZS5pZCA9
IC0xOwpAQCAtNDQ1NCw3ICs0NDUyLDcgQEAgaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFs
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCSAgICAgdmlydHVhbF9zdWJtaXNzaW9u
X3Rhc2tsZXQsCiAJCSAgICAgKHVuc2lnbmVkIGxvbmcpdmUpOwogCi0JaW50ZWxfY29udGV4dF9p
bml0KCZ2ZS0+Y29udGV4dCwgY3R4LCAmdmUtPmJhc2UpOworCWludGVsX2NvbnRleHRfaW5pdCgm
dmUtPmNvbnRleHQsICZ2ZS0+YmFzZSk7CiAKIAlmb3IgKG4gPSAwOyBuIDwgY291bnQ7IG4rKykg
ewogCQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzaWJsaW5nID0gc2libGluZ3Nbbl07CkBAIC00
NTM1LDE0ICs0NTMzLDEyIEBAIGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LAogfQogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRl
bF9leGVjbGlzdHNfY2xvbmVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAot
CQkJICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKQoraW50ZWxfZXhlY2xpc3RzX2Ns
b25lX3ZpcnR1YWwoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKQogewogCXN0cnVjdCB2aXJ0
dWFsX2VuZ2luZSAqc2UgPSB0b192aXJ0dWFsX2VuZ2luZShzcmMpOwogCXN0cnVjdCBpbnRlbF9j
b250ZXh0ICpkc3Q7CiAKLQlkc3QgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoY3R4
LAotCQkJCQkgICAgIHNlLT5zaWJsaW5ncywKKwlkc3QgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRl
X3ZpcnR1YWwoc2UtPnNpYmxpbmdzLAogCQkJCQkgICAgIHNlLT5udW1fc2libGluZ3MpOwogCWlm
IChJU19FUlIoZHN0KSkKIAkJcmV0dXJuIGRzdDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2xyYy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJj
LmgKaW5kZXggZmFhMmQ1NmMyNzliLi5mYWE0OTZlZTcxYmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5oCkBAIC0xMzAsMTMgKzEzMCwxMSBAQCB2b2lkIGludGVsX2V4ZWNsaXN0c19z
aG93X3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkgICB1bnNp
Z25lZCBpbnQgbWF4KTsKIAogc3RydWN0IGludGVsX2NvbnRleHQgKgotaW50ZWxfZXhlY2xpc3Rz
X2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkgICAgICAg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAoraW50ZWxfZXhlY2xpc3RzX2NyZWF0
ZV92aXJ0dWFsKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipzaWJsaW5ncywKIAkJCSAgICAgICB1
bnNpZ25lZCBpbnQgY291bnQpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9leGVj
bGlzdHNfY2xvbmVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkJICAg
ICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKTsKK2ludGVsX2V4ZWNsaXN0c19jbG9uZV92
aXJ0dWFsKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNyYyk7CiAKIGludCBpbnRlbF92aXJ0dWFs
X2VuZ2luZV9hdHRhY2hfYm9uZChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkJ
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICptYXN0ZXIsCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmVzZXQuYwppbmRleCBiNGMwYWQ0YTYwODEuLjk4ZTdiYmE1OTc5ZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCkBAIC04Niw2ICs4Niw5IEBAIHN0YXRp
YyBib29sIG1hcmtfZ3VpbHR5KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCWJvb2wgYmFubmVk
OwogCWludCBpOwogCisJaWYgKCFjdHgpCisJCXJldHVybiBmYWxzZTsKKwogCWF0b21pY19pbmMo
JmN0eC0+Z3VpbHR5X2NvdW50KTsKIAogCS8qIENvb2wgY29udGV4dHMgYXJlIHRvbyBjb29sIHRv
IGJlIGJhbm5lZCEgKFVzZWQgZm9yIHJlc2V0IHRlc3RpbmcuKSAqLwpAQCAtMTE1LDcgKzExOCw4
IEBAIHN0YXRpYyBib29sIG1hcmtfZ3VpbHR5KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCiBz
dGF0aWMgdm9pZCBtYXJrX2lubm9jZW50KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCWF0
b21pY19pbmMoJnJxLT5jb250ZXh0LT5nZW1fY29udGV4dC0+YWN0aXZlX2NvdW50KTsKKwlpZiAo
cnEtPmNvbnRleHQtPmdlbV9jb250ZXh0KQorCQlhdG9taWNfaW5jKCZycS0+Y29udGV4dC0+Z2Vt
X2NvbnRleHQtPmFjdGl2ZV9jb3VudCk7CiB9CiAKIHZvaWQgX19pOTE1X3JlcXVlc3RfcmVzZXQo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGJvb2wgZ3VpbHR5KQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYwppbmRleCAxYzJmM2MzYTg4NDAuLjZk
ZGZlOGE4NmRiZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z19zdWJtaXNzaW9uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19z
dWJtaXNzaW9uLmMKQEAgLTE1NTgsNyArMTU1OCw3IEBAIHN0YXRpYyBpbnQgcmVtYXBfbDMoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJx
LT5jb250ZXh0LT5nZW1fY29udGV4dDsKIAlpbnQgaSwgZXJyOwogCi0JaWYgKCFjdHgtPnJlbWFw
X3NsaWNlKQorCWlmICghY3R4IHx8ICFjdHgtPnJlbWFwX3NsaWNlKQogCQlyZXR1cm4gMDsKIAog
CWZvciAoaSA9IDA7IGkgPCBNQVhfTDNfU0xJQ0VTOyBpKyspIHsKQEAgLTE2MDEsNyArMTYwMSw3
IEBAIHN0YXRpYyBpbnQgc3dpdGNoX2NvbnRleHQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJ
CSAqIGlzIHB1cmVseSB1c2VkIGZvciBmbHVzaGluZyB1c2VyIGNvbnRleHRzLgogCQkgKi8KIAkJ
aHdfZmxhZ3MgPSAwOwotCQlpZiAoaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwocnEtPmNvbnRl
eHQtPmdlbV9jb250ZXh0KSkKKwkJaWYgKCFycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQpCiAJCQlo
d19mbGFncyA9IE1JX1JFU1RPUkVfSU5ISUJJVDsKIAogCQlyZXQgPSBtaV9zZXRfY29udGV4dChy
cSwgaHdfZmxhZ3MpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5j
CmluZGV4IGY2M2EyNmEzZTYyMC4uNzY2NjM1ZmMzNzE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCkBAIC02NywxNSArNjcsMTQgQEAgc3RhdGljIGludCBj
b250ZXh0X3N5bmMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCXJldHVybiBlcnI7CiB9CiAK
LXN0YXRpYyBpbnQgX19saXZlX2NvbnRleHRfc2l6ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUsCi0JCQkgICAgICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lKQorc3RhdGlj
IGludCBfX2xpdmVfY29udGV4dF9zaXplKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IHsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7
CiAJdm9pZCAqdmFkZHI7CiAJaW50IGVycjsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUo
Zml4bWUsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlm
IChJU19FUlIoY2UpKQogCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAKQEAgLTE0Niw3ICsxNDUsNiBA
QCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50
ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJ
aW50IGVyciA9IDA7CiAKQEAgLTE1NSwxMCArMTUzLDYgQEAgc3RhdGljIGludCBsaXZlX2NvbnRl
eHRfc2l6ZSh2b2lkICphcmcpCiAJICogSFcgdHJpZXMgdG8gd3JpdGUgcGFzdCB0aGUgZW5kIG9m
IG9uZS4KIAkgKi8KIAotCWZpeG1lID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmIChJ
U19FUlIoZml4bWUpKQotCQlyZXR1cm4gUFRSX0VSUihmaXhtZSk7Ci0KIAlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBndCwgaWQpIHsKIAkJc3RydWN0IHsKIAkJCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpzdGF0ZTsKQEAgLTE4Myw3ICsxNzcsNyBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4
dF9zaXplKHZvaWQgKmFyZykKIAkJLyogT3ZlcmxhcHMgd2l0aCB0aGUgZXhlY2xpc3RzIHJlZHpv
bmUgKi8KIAkJZW5naW5lLT5jb250ZXh0X3NpemUgKz0gSTkxNV9HVFRfUEFHRV9TSVpFOwogCi0J
CWVyciA9IF9fbGl2ZV9jb250ZXh0X3NpemUoZW5naW5lLCBmaXhtZSk7CisJCWVyciA9IF9fbGl2
ZV9jb250ZXh0X3NpemUoZW5naW5lKTsKIAogCQllbmdpbmUtPmNvbnRleHRfc2l6ZSAtPSBJOTE1
X0dUVF9QQUdFX1NJWkU7CiAKQEAgLTE5NiwxMiArMTkwLDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9j
b250ZXh0X3NpemUodm9pZCAqYXJnKQogCQkJYnJlYWs7CiAJfQogCi0Ja2VybmVsX2NvbnRleHRf
Y2xvc2UoZml4bWUpOwogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgX19saXZlX2FjdGl2
ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCQkgc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmZpeG1lKQorc3RhdGljIGludCBfX2xpdmVfYWN0aXZlX2NvbnRleHQo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZTsKIAlpbnQgcGFzczsKQEAgLTIyNiwxMCArMjE4LDEzIEBAIHN0YXRpYyBpbnQgX19saXZl
X2FjdGl2ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJcmV0dXJu
IC1FSU5WQUw7CiAJfQogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5l
KTsKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihjZSkp
CiAJCXJldHVybiBQVFJfRVJSKGNlKTsKIAorCS8qIFByZXRlbmQgdG8gYmUgYSB1c2VyIGNvbnRl
eHQgdG8gcGFydGFrZSBpbiBpZGxlIGJhcnJpZXJzICovCisJY2UtPmdlbV9jb250ZXh0ID0gRVJS
X1BUUigtRU5PREVWKTsKKwogCWZvciAocGFzcyA9IDA7IHBhc3MgPD0gMjsgcGFzcysrKSB7CiAJ
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCkBAIC0yOTAsNyArMjg1LDYgQEAgc3RhdGljIGlu
dCBsaXZlX2FjdGl2ZV9jb250ZXh0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0
ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqZml4bWU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJc3RydWN0IGRy
bV9maWxlICpmaWxlOwogCWludCBlcnIgPSAwOwpAQCAtMjk5LDE0ICsyOTMsOCBAQCBzdGF0aWMg
aW50IGxpdmVfYWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJ
CXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JZml4bWUgPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUs
IGZpbGUpOwotCWlmIChJU19FUlIoZml4bWUpKSB7Ci0JCWVyciA9IFBUUl9FUlIoZml4bWUpOwot
CQlnb3RvIG91dF9maWxlOwotCX0KLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkg
ewotCQllcnIgPSBfX2xpdmVfYWN0aXZlX2NvbnRleHQoZW5naW5lLCBmaXhtZSk7CisJCWVyciA9
IF9fbGl2ZV9hY3RpdmVfY29udGV4dChlbmdpbmUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAK
QEAgLTMxNSw3ICszMDMsNiBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX2NvbnRleHQodm9pZCAq
YXJnKQogCQkJYnJlYWs7CiAJfQogCi1vdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkx
NSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTM0OCw4ICszMzUsNyBAQCBzdGF0aWMgaW50
IF9fcmVtb3RlX3N5bmMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqcmVtb3RlKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgX19saXZlX3JlbW90
ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCQkgc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmZpeG1lKQorc3RhdGljIGludCBfX2xpdmVfcmVtb3RlX2NvbnRleHQo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0
ICpsb2NhbCwgKnJlbW90ZTsKIAlpbnQgcGFzczsKQEAgLTM2MywxMSArMzQ5LDE0IEBAIHN0YXRp
YyBpbnQgX19saXZlX3JlbW90ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSwKIAkgKiBjbG9iYmVyIHRoZSBpZGxlLWJhcnJpZXIuCiAJICovCiAKLQlyZW1vdGUgPSBpbnRl
bF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5lKTsKKwlyZW1vdGUgPSBpbnRlbF9jb250ZXh0
X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIocmVtb3RlKSkKIAkJcmV0dXJuIFBUUl9FUlIo
cmVtb3RlKTsKIAotCWxvY2FsID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7
CisJLyogUHJldGVuZCB0byBiZSBhIHVzZXIgY29udGV4dCB0byBwYXJ0YWtlIGluIGlkbGUgYmFy
cmllcnMgKi8KKwlyZW1vdGUtPmdlbV9jb250ZXh0ID0gRVJSX1BUUigtRU5PREVWKTsKKworCWxv
Y2FsID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGxvY2FsKSkg
ewogCQllcnIgPSBQVFJfRVJSKGxvY2FsKTsKIAkJZ290byBlcnJfcmVtb3RlOwpAQCAtNDAwLDcg
KzM4OSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiB7CiAJ
c3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lOwogCWVudW0gaW50ZWxfZW5naW5l
X2lkIGlkOwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlpbnQgZXJyID0gMDsKQEAgLTQwOSwx
NCArMzk3LDggQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlp
ZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCWZpeG1lID0gbGl2
ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQlpZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIg
PSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byBvdXRfZmlsZTsKLQl9Ci0KIAlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBndCwgaWQpIHsKLQkJZXJyID0gX19saXZlX3JlbW90ZV9jb250ZXh0KGVuZ2lu
ZSwgZml4bWUpOworCQllcnIgPSBfX2xpdmVfcmVtb3RlX2NvbnRleHQoZW5naW5lKTsKIAkJaWYg
KGVycikKIAkJCWJyZWFrOwogCkBAIC00MjUsNyArNDA3LDYgQEAgc3RhdGljIGludCBsaXZlX3Jl
bW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCX0KIAotb3V0X2ZpbGU6CiAJbW9j
a19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMKaW5kZXgg
MTU1YzUwODAyNGRmLi45ZTczNzZiNTkyZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMKQEAgLTE2OSw4ICsxNjksNyBAQCBz
dGF0aWMgaW50IF9fbGl2ZV9oZWFydGJlYXRfZmFzdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiAJaW50IGVycjsKIAlpbnQgaTsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUo
ZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2VtX2NvbnRleHQsCi0JCQkJICBlbmdpbmUpOworCWNl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0
dXJuIFBUUl9FUlIoY2UpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hh
bmdjaGVjay5jCmluZGV4IDhhYmMwYTFkNjkyYi4uNGY4Y2QzY2JiOGJkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMzc3LDM2ICszNzcsMzAg
QEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZ2xvYmFsID0gJmd0LT5pOTE1LT5n
cHVfZXJyb3I7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHg7CiAJdW5zaWduZWQgaW50IHJlc2V0X2NvdW50LCBjb3VudDsKIAll
bnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7CiAJSUdUX1RJ
TUVPVVQoZW5kX3RpbWUpOwogCWludCBlcnIgPSAwOwogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4g
cmVzZXQgZHVyaW5nIG5vbi11c2VyIHBvcnRpb25zIG9mIHJlcXVlc3RzICovCiAKLQlmaWxlID0g
bW9ja19maWxlKGd0LT5pOTE1KTsKLQlpZiAoSVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRSX0VS
UihmaWxlKTsKLQotCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYgKElT
X0VSUihjdHgpKSB7Ci0JCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXQ7Ci0JfQotCi0J
aTkxNV9nZW1fY29udGV4dF9jbGVhcl9iYW5uYWJsZShjdHgpOwogCXJlc2V0X2NvdW50ID0gaTkx
NV9yZXNldF9jb3VudChnbG9iYWwpOwogCWNvdW50ID0gMDsKIAlkbyB7CiAJCWZvcl9lYWNoX2Vu
Z2luZShlbmdpbmUsIGd0LCBpZCkgeworCQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQkJ
aW50IGk7CiAKKwkJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwkJCWlmIChJ
U19FUlIoY2UpKSB7CisJCQkJZXJyID0gUFRSX0VSUihjZSk7CisJCQkJYnJlYWs7CisJCQl9CisK
IAkJCWZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAJCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CiAKLQkJCQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5lKTsKKwkJCQlycSA9
IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwogCQkJCWlmIChJU19FUlIocnEpKSB7
CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwogCQkJCQlicmVhazsKQEAgLTQxNCw2ICs0MDgsOCBA
QCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3Aodm9pZCAqYXJnKQogCiAJCQkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CiAJCQl9CisKKwkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJfQogCiAJCWln
dF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CkBAIC00MzcsMTAgKzQzMyw3IEBAIHN0YXRpYyBpbnQg
aWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJfSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywg
ZW5kX3RpbWUpKTsKIAlwcl9pbmZvKCIlczogJWQgcmVzZXRzXG4iLCBfX2Z1bmNfXywgY291bnQp
OwogCi0JZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwotb3V0OgotCW1vY2tfZmlsZV9m
cmVlKGd0LT5pOTE1LCBmaWxlKTsKLQlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKKwlpZiAo
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQllcnIgPSAtRUlPOwogCXJldHVybiBlcnI7CiB9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IDk1NTA0YzQ4Y2Q5OS4u
MDRkMGRkNmE5MzhhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAt
NTMsMTEgKzUzLDEwIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9zY3JhdGNoKHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCiBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJn
KQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGk5MTVfZ2VtX2VuZ2lu
ZXNfaXRlciBpdDsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCXN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZTsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7CiAJc3RydWN0IGlndF9zcGlubmVyIHNwaW47Ci0JaW50IGVyciA9
IC1FTk9NRU07CisJaW50IGVyciA9IDA7CiAKIAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfQ09OVEVY
VFMoZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKQEAgLTY1LDE3ICs2NCwyMCBAQCBzdGF0aWMgaW50
IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGlu
LCBndCkpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5
MTUpOwotCWlmICghY3R4KQotCQlnb3RvIGVycl9zcGluOwotCi0JZm9yX2VhY2hfZ2VtX2VuZ2lu
ZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKKwlmb3JfZWFj
aF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwog
CQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAorCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGVuZ2luZSk7CisJCWlmIChJU19FUlIoY2UpKSB7CisJCQllcnIgPSBQVFJfRVJSKGNlKTsKKwkJ
CWJyZWFrOworCQl9CisKIAkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3Bpbiwg
Y2UsIE1JX05PT1ApOwogCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJZXJyID0gUFRSX0VSUihycSk7
Ci0JCQlnb3RvIGVycl9jdHg7CisJCQlnb3RvIG91dF9jdHg7CiAJCX0KIAogCQlpOTE1X3JlcXVl
c3RfYWRkKHJxKTsKQEAgLTg0LDIxICs4NiwyMSBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hl
Y2sodm9pZCAqYXJnKQogCQkJR0VNX1RSQUNFX0RVTVAoKTsKIAkJCWludGVsX2d0X3NldF93ZWRn
ZWQoZ3QpOwogCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8gZXJyX2N0eDsKKwkJCWdvdG8gb3V0X2N0
eDsKIAkJfQogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7CiAJCWlmIChpZ3RfZmx1c2hfdGVz
dChndC0+aTkxNSkpIHsKIAkJCWVyciA9IC1FSU87Ci0JCQlnb3RvIGVycl9jdHg7CisJCQlnb3Rv
IG91dF9jdHg7CiAJCX0KKworb3V0X2N0eDoKKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlp
ZiAoZXJyKQorCQkJYnJlYWs7CiAJfQogCi0JZXJyID0gMDsKLWVycl9jdHg6Ci0JaTkxNV9nZW1f
Y29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7
Ci1lcnJfc3BpbjoKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKIAlyZXR1cm4gZXJyOwogfQpA
QCAtMTQ0LDcgKzE0Niw3IEBAIHN0YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKIAkJZm9yIChuID0gMDsgbiA8IEFSUkFZX1NJWkUoY2Up
OyBuKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICp0bXA7CiAKLQkJCXRtcCA9IGludGVs
X2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKKwkJCXRtcCA9IGludGVsX2NvbnRleHRfY3Jl
YXRlKGVuZ2luZSk7CiAJCQlpZiAoSVNfRVJSKHRtcCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHRt
cCk7CiAJCQkJZ290byBlcnJfY2U7CkBAIC0zMDksMTcgKzMxMSwxNyBAQCBlbWl0X3NlbWFwaG9y
ZV9jaGFpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVfdm1hICp2bWEsIGlu
dCBpZHgpCiBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqCiBzZW1hcGhvcmVfcXVldWUoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlk
eCkKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlpbnQgZXJyOwogCi0JY3R4ID0g
a2VybmVsX2NvbnRleHQoZW5naW5lLT5pOTE1KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIEVSUl9Q
VFIoLUVOT01FTSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCWlmIChJ
U19FUlIoY2UpKQorCQlyZXR1cm4gRVJSX0NBU1QoY2UpOwogCi0JcnEgPSBpZ3RfcmVxdWVzdF9h
bGxvYyhjdHgsIGVuZ2luZSk7CisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNl
KTsKIAlpZiAoSVNfRVJSKHJxKSkKLQkJZ290byBvdXRfY3R4OworCQlnb3RvIG91dF9jZTsKIAog
CWVyciA9IDA7CiAJaWYgKHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQpAQCAtMzMy
LDggKzMzNCw4IEBAIHNlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUsIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQogCWlmIChlcnIpCiAJCXJxID0gRVJS
X1BUUihlcnIpOwogCi1vdXRfY3R4OgotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CitvdXRf
Y2U6CisJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCXJldHVybiBycTsKIH0KIApAQCAtMjM5MCwy
NyArMjM5MiwxNyBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxf
Z3QgKmd0LAogewogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpyZXF1ZXN0WzE2XTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4WzE2XTsKIAlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqdmVbMTZdOwogCXVuc2lnbmVkIGxvbmcgbiwgcHJpbWUsIG5jOwog
CXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJa3RpbWVfdCB0aW1lc1syXSA9IHt9OwogCWludCBl
cnI7CiAKLQlHRU1fQlVHX09OKCFuY3R4IHx8IG5jdHggPiBBUlJBWV9TSVpFKGN0eCkpOworCUdF
TV9CVUdfT04oIW5jdHggfHwgbmN0eCA+IEFSUkFZX1NJWkUodmUpKTsKIAogCWZvciAobiA9IDA7
IG4gPCBuY3R4OyBuKyspIHsKLQkJY3R4W25dID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwot
CQlpZiAoIWN0eFtuXSkgewotCQkJZXJyID0gLUVOT01FTTsKLQkJCW5jdHggPSBuOwotCQkJZ290
byBvdXQ7Ci0JCX0KLQotCQl2ZVtuXSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChj
dHhbbl0sCi0JCQkJCQkgICAgICAgc2libGluZ3MsIG5zaWJsaW5nKTsKKwkJdmVbbl0gPSBpbnRl
bF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc2libGluZ3MsIG5zaWJsaW5nKTsKIAkJaWYgKElT
X0VSUih2ZVtuXSkpIHsKLQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtuXSk7CiAJCQllcnIg
PSBQVFJfRVJSKHZlW25dKTsKIAkJCW5jdHggPSBuOwogCQkJZ290byBvdXQ7CkBAIC0yNDE5LDcg
KzI0MTEsNiBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0LAogCQllcnIgPSBpbnRlbF9jb250ZXh0X3Bpbih2ZVtuXSk7CiAJCWlmIChlcnIpIHsKIAkJ
CWludGVsX2NvbnRleHRfcHV0KHZlW25dKTsKLQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtu
XSk7CiAJCQluY3R4ID0gbjsKIAkJCWdvdG8gb3V0OwogCQl9CkBAIC0yNTAwLDcgKzI0OTEsNiBA
QCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWZv
ciAobmMgPSAwOyBuYyA8IG5jdHg7IG5jKyspIHsKIAkJaW50ZWxfY29udGV4dF91bnBpbih2ZVtu
Y10pOwogCQlpbnRlbF9jb250ZXh0X3B1dCh2ZVtuY10pOwotCQlrZXJuZWxfY29udGV4dF9jbG9z
ZShjdHhbbmNdKTsKIAl9CiAJcmV0dXJuIGVycjsKIH0KQEAgLTI1NTksNyArMjU0OSw2IEBAIHN0
YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAg
ICAgIHVuc2lnbmVkIGludCBuc2libGluZykKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1
ZXN0W01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4OwogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICp2ZTsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0
OwogCXVuc2lnbmVkIGludCBuOwpAQCAtMjU3MCwxMSArMjU1OSw3IEBAIHN0YXRpYyBpbnQgbWFz
a192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCSAqIHJlc3RyaWN0IGl0IHRv
IG91ciBkZXNpcmVkIGVuZ2luZSB3aXRoaW4gdGhlIHZpcnR1YWwgZW5naW5lLgogCSAqLwogCi0J
Y3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmICghY3R4KQotCQlyZXR1cm4gLUVO
T01FTTsKLQotCXZlID0gaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGlu
Z3MsIG5zaWJsaW5nKTsKKwl2ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJs
aW5ncywgbnNpYmxpbmcpOwogCWlmIChJU19FUlIodmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUp
OwogCQlnb3RvIG91dF9jbG9zZTsKQEAgLTI2NDIsNyArMjYyNyw2IEBAIHN0YXRpYyBpbnQgbWFz
a192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogb3V0X3B1dDoKIAlpbnRlbF9j
b250ZXh0X3B1dCh2ZSk7CiBvdXRfY2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsK
IAlyZXR1cm4gZXJyOwogfQogCkBAIC0yNjgyLDcgKzI2NjYsNiBAQCBzdGF0aWMgaW50IHByZXNl
cnZlZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJCSAgICB1bnNpZ25l
ZCBpbnQgbnNpYmxpbmcpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqbGFzdCA9IE5VTEw7Ci0J
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7
CiAJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CkBA
IC0yNjkwLDE3ICsyNjczLDExIEBAIHN0YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5l
KHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJaW50IGVyciA9IDA7CiAJdTMyICpjczsKIAotCWN0eCA9
IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIC1FTk9NRU07
Ci0KIAlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goc2libGluZ3NbMF0tPmd0KTsKLQlpZiAoSVNf
RVJSKHNjcmF0Y2gpKSB7Ci0JCWVyciA9IFBUUl9FUlIoc2NyYXRjaCk7Ci0JCWdvdG8gb3V0X2Ns
b3NlOwotCX0KKwlpZiAoSVNfRVJSKHNjcmF0Y2gpKQorCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNo
KTsKIAotCXZlID0gaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGluZ3Ms
IG5zaWJsaW5nKTsKKwl2ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5n
cywgbnNpYmxpbmcpOwogCWlmIChJU19FUlIodmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUpOwog
CQlnb3RvIG91dF9zY3JhdGNoOwpAQCAtMjc4Myw4ICsyNzYwLDYgQEAgc3RhdGljIGludCBwcmVz
ZXJ2ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAlpbnRlbF9jb250ZXh0
X3B1dCh2ZSk7CiBvdXRfc2NyYXRjaDoKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2Ny
YXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1
cm4gZXJyOwogfQogCkBAIC0yODc4LDkgKzI4NTMsNyBAQCBzdGF0aWMgaW50IGJvbmRfdmlydHVh
bF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkJZm9yIChuID0gMDsgbiA8IG5zaWJsaW5n
OyBuKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICp2ZTsKIAotCQkJdmUgPSBpbnRlbF9l
eGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoY3R4LAotCQkJCQkJCSAgICBzaWJsaW5ncywKLQkJCQkJ
CQkgICAgbnNpYmxpbmcpOworCQkJdmUgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwo
c2libGluZ3MsIG5zaWJsaW5nKTsKIAkJCWlmIChJU19FUlIodmUpKSB7CiAJCQkJZXJyID0gUFRS
X0VSUih2ZSk7CiAJCQkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7CkBAIC0zMjY4LDggKzMy
NDEsNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX2ZpeGVkKHZvaWQgKmFyZykKIAlyZXR1cm4gZXJy
OwogfQogCi1zdGF0aWMgaW50IF9fbGl2ZV9scmNfc3RhdGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmZpeG1lLAotCQkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKK3N0YXRp
YyBpbnQgX19saXZlX2xyY19zdGF0ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJ
CQkgICAgc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZTsKQEAgLTMyODQsNyArMzI1Niw3IEBAIHN0YXRpYyBpbnQgX19saXZlX2xyY19zdGF0ZShz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWUsCiAJaW50IGVycjsKIAlpbnQgbjsKIAotCWNl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250
ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gUFRSX0VSUihj
ZSk7CiAKQEAgLTMzNTgsNyArMzMzMCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9scmNfc3RhdGUodm9p
ZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAlzdHJ1
Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVy
ciA9IDA7CkBAIC0zMzY4LDE4ICszMzM5LDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV9scmNfc3RhdGUo
dm9pZCAqYXJnKQogCSAqIGludGVsX2NvbnRleHQuCiAJICovCiAKLQlmaXhtZSA9IGtlcm5lbF9j
b250ZXh0KGd0LT5pOTE1KTsKLQlpZiAoIWZpeG1lKQotCQlyZXR1cm4gLUVOT01FTTsKLQogCXNj
cmF0Y2ggPSBjcmVhdGVfc2NyYXRjaChndCk7Ci0JaWYgKElTX0VSUihzY3JhdGNoKSkgewotCQll
cnIgPSBQVFJfRVJSKHNjcmF0Y2gpOwotCQlnb3RvIG91dF9jbG9zZTsKLQl9CisJaWYgKElTX0VS
UihzY3JhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKIAlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBndCwgaWQpIHsKLQkJZXJyID0gX19saXZlX2xyY19zdGF0ZShmaXhtZSwgZW5n
aW5lLCBzY3JhdGNoKTsKKwkJZXJyID0gX19saXZlX2xyY19zdGF0ZShlbmdpbmUsIHNjcmF0Y2gp
OwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAtMzM4OCw4ICszMzUzLDYgQEAgc3RhdGlj
IGludCBsaXZlX2xyY19zdGF0ZSh2b2lkICphcmcpCiAJCWVyciA9IC1FSU87CiAKIAlpOTE1X3Zt
YV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVsX2Nv
bnRleHRfY2xvc2UoZml4bWUpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTM0MjIsOCArMzM4NSw3
IEBAIHN0YXRpYyBpbnQgZ3ByX21ha2VfZGlydHkoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IF9fbGl2ZV9ncHJfY2xlYXIoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAotCQkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKK3N0YXRpYyBpbnQgX19saXZlX2dwcl9jbGVhcihzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUsCiAJCQkgICAgc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoKQogewogCXN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZTsKQEAgLTM0MzksNyArMzQwMSw3IEBAIHN0YXRpYyBpbnQgX19s
aXZlX2dwcl9jbGVhcihzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWUsCiAJaWYgKGVycikK
IAkJcmV0dXJuIGVycjsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2lu
ZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIoY2Up
KQogCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAKQEAgLTM1MDEsNyArMzQ2Myw2IEBAIHN0YXRpYyBp
bnQgbGl2ZV9ncHJfY2xlYXIodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBh
cmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpmaXhtZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CiAJZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9IDA7CkBAIC0zNTExLDE4ICszNDcyLDEyIEBAIHN0YXRp
YyBpbnQgbGl2ZV9ncHJfY2xlYXIodm9pZCAqYXJnKQogCSAqIHRvIGF2b2lkIGxlYWtpbmcgYW55
IGluZm9ybWF0aW9uIGZyb20gcHJldmlvdXMgY29udGV4dHMuCiAJICovCiAKLQlmaXhtZSA9IGtl
cm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlpZiAoIWZpeG1lKQotCQlyZXR1cm4gLUVOT01FTTsK
LQogCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRjaChndCk7Ci0JaWYgKElTX0VSUihzY3JhdGNoKSkg
ewotCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gpOwotCQlnb3RvIG91dF9jbG9zZTsKLQl9CisJaWYg
KElTX0VSUihzY3JhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKIAlmb3JfZWFj
aF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKLQkJZXJyID0gX19saXZlX2dwcl9jbGVhcihmaXht
ZSwgZW5naW5lLCBzY3JhdGNoKTsKKwkJZXJyID0gX19saXZlX2dwcl9jbGVhcihlbmdpbmUsIHNj
cmF0Y2gpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAtMzUzMSw4ICszNDg2LDYgQEAg
c3RhdGljIGludCBsaXZlX2dwcl9jbGVhcih2b2lkICphcmcpCiAJCWVyciA9IC1FSU87CiAKIAlp
OTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2Vy
bmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9zY2hlZHVsZXIuYwppbmRleCA5NzZkNjk1MDIxOGUuLmYwNzg1YjlmZTAyYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAtMzUsMTIgKzM1LDEyIEBACiAKICNp
bmNsdWRlIDxsaW51eC9rdGhyZWFkLmg+CiAKLSNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4
dC5oIgogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgogI2luY2x1ZGUgImd0L2ludGVsX2Nv
bnRleHQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9yaW5nLmgiCiAKICNpbmNsdWRlICJpOTE1X2Ry
di5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgogI2luY2x1ZGUgImd2dC5oIgogCiAjZGVm
aW5lIFJJTkdfQ1RYX09GRih4KSBcCkBAIC0xMjIwLDE2ICsxMjIwLDE0IEBAIGludCBpbnRlbF92
Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2Z3B1LT5ndnQtPmRldl9wcml2OwogCXN0cnVjdCBpbnRl
bF92Z3B1X3N1Ym1pc3Npb24gKnMgPSAmdmdwdS0+c3VibWlzc2lvbjsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlzdHJ1
Y3QgaTkxNV9wcGd0dCAqcHBndHQ7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaTsKIAlpbnQgcmV0
OwogCi0JY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJ
T1JJVFlfTUFYKTsKLQlpZiAoSVNfRVJSKGN0eCkpCi0JCXJldHVybiBQVFJfRVJSKGN0eCk7CisJ
cHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShpOTE1KTsKKwlpZiAoSVNfRVJSKHBwZ3R0KSkKKwkJ
cmV0dXJuIFBUUl9FUlIocHBndHQpOwogCi0JcHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KGk5MTVf
Z2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpKTsKIAlpOTE1X2NvbnRleHRfcHBndHRfcm9vdF9z
YXZlKHMsIHBwZ3R0KTsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGkpIHsKQEAg
LTEyMzgsMTIgKzEyMzYsMTQgQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1
Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAkJSU5JVF9MSVNUX0hFQUQoJnMtPndvcmtsb2FkX3FfaGVh
ZFtpXSk7CiAJCXMtPnNoYWRvd1tpXSA9IEVSUl9QVFIoLUVJTlZBTCk7CiAKLQkJY2UgPSBpbnRl
bF9jb250ZXh0X2NyZWF0ZShjdHgsIGVuZ2luZSk7CisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVh
dGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihjZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIoY2UpOwog
CQkJZ290byBvdXRfc2hhZG93X2N0eDsKIAkJfQogCisJCWk5MTVfdm1fcHV0KGNlLT52bSk7CisJ
CWNlLT52bSA9IGk5MTVfdm1fZ2V0KCZwcGd0dC0+dm0pOwogCQlpbnRlbF9jb250ZXh0X3NldF9z
aW5nbGVfc3VibWlzc2lvbihjZSk7CiAKIAkJaWYgKCFVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUp
KSB7IC8qIE1heCByaW5nIGJ1ZmZlciBzaXplICovCkBAIC0xMjc4LDcgKzEyNzgsNiBAQCBpbnQg
aW50ZWxfdmdwdV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCWJp
dG1hcF96ZXJvKHMtPnRsYl9oYW5kbGVfcGVuZGluZywgSTkxNV9OVU1fRU5HSU5FUyk7CiAKIAlp
OTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKLQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwogCXJl
dHVybiAwOwogCiBvdXRfc2hhZG93X2N0eDoKQEAgLTEyOTEsNyArMTI5MCw2IEBAIGludCBpbnRl
bF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWludGVs
X2NvbnRleHRfcHV0KHMtPnNoYWRvd1tpXSk7CiAJfQogCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0p
OwotCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGN0eCk7CiAJcmV0dXJuIHJldDsKIH0KIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKaW5kZXggYTIyZDk2OWNiMzUyLi5lNWM3MTkwMDc5ZTggMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaApAQCAtOTU2LDkgKzk1Niw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlIHsKIAogCXN0cnVjdCBwY2lfZGV2ICpicmlkZ2VfZGV2OwogCi0JLyogQ29udGV4dCB1c2Vk
IGludGVybmFsbHkgdG8gaWRsZSB0aGUgR1BVIGFuZCBzZXR1cCBpbml0aWFsIHN0YXRlICovCi0J
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmtlcm5lbF9jb250ZXh0OwotCiAJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lW0k5MTVfTlVNX0VOR0lORVNdOwogCXN0cnVjdCByYl9yb290IHVh
YmlfZW5naW5lczsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0u
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggY2UzMjc5NGVmNjgxLi45
NjNkM2NlZTM0M2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTA5NSw4ICsxMDk1LDcg
QEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2luZXNfcmVjb3JkX2RlZmF1bHRzKHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCiAJCUdFTV9CVUdfT04oIWVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwogCQllbmdp
bmUtPnNlcmlhbCsrOyAvKiBmb3JjZSB0aGUga2VybmVsIGNvbnRleHQgc3dpdGNoICovCiAKLQkJ
Y2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5nZW1fY29u
dGV4dCwKLQkJCQkJICBlbmdpbmUpOworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2lu
ZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQllcnIgPSBQVFJfRVJSKGNlKTsKIAkJCWdvdG8g
b3V0OwpAQCAtMTI1MSw2ICsxMjUwLDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIAogCWludGVsX2d0X2luaXQoJmRldl9wcml2LT5n
dCk7CisJaTkxNV9nZW1faW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CiAKIAlyZXQgPSBpbnRlbF9l
bmdpbmVzX3NldHVwKCZkZXZfcHJpdi0+Z3QpOwogCWlmIChyZXQpIHsKQEAgLTEyNTgsMTYgKzEy
NTgsMTAgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCQlnb3RvIGVycl91bmxvY2s7CiAJfQogCi0JcmV0ID0gaTkxNV9nZW1faW5pdF9jb250
ZXh0cyhkZXZfcHJpdik7Ci0JaWYgKHJldCkgewotCQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsK
LQkJZ290byBlcnJfc2NyYXRjaDsKLQl9Ci0KIAlyZXQgPSBpbnRlbF9lbmdpbmVzX2luaXQoJmRl
dl9wcml2LT5ndCk7CiAJaWYgKHJldCkgewogCQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsKLQkJ
Z290byBlcnJfY29udGV4dDsKKwkJZ290byBlcnJfc2NyYXRjaDsKIAl9CiAKIAlpbnRlbF91Y19p
bml0KCZkZXZfcHJpdi0+Z3QudWMpOwpAQCAtMTMzMSw5ICsxMzI1LDYgQEAgaW50IGk5MTVfZ2Vt
X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlpbnRlbF91Y19maW5p
KCZkZXZfcHJpdi0+Z3QudWMpOwogCQlpbnRlbF9lbmdpbmVzX2NsZWFudXAoJmRldl9wcml2LT5n
dCk7CiAJfQotZXJyX2NvbnRleHQ6Ci0JaWYgKHJldCAhPSAtRUlPKQotCQlpOTE1X2dlbV9kcml2
ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2X3ByaXYpOwogZXJyX3NjcmF0Y2g6CiAJaW50ZWxfZ3Rf
ZHJpdmVyX3JlbGVhc2UoJmRldl9wcml2LT5ndCk7CiBlcnJfdW5sb2NrOgpAQCAtMTM5OSw3ICsx
MzkwLDYgQEAgdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCWludGVsX2VuZ2luZXNfY2xlYW51cCgmZGV2X3By
aXYtPmd0KTsKLQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2X3ByaXYpOwog
CWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+Z3QpOwogCiAJaW50ZWxfd2FfbGlz
dF9mcmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlzdCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCmluZGV4IDg4MTc5MjAyYzU1Ni4uNWUyMDc0MTJhNDU5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYwpAQCAtMTM2MywxMiArMTM2Myw4IEBAIHN0YXRpYyBpbnQgZ2VuOF9pbml0
X3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJICogSWYgZXZlcnlib2R5
IGFncmVlcyB0byBub3QgdG8gd3JpdGUgaW50byB0aGUgc2NyYXRjaCBwYWdlLAogCSAqIHdlIGNh
biByZXVzZSBpdCBmb3IgYWxsIHZtLCBrZWVwaW5nIGNvbnRleHRzIGFuZCBwcm9jZXNzZXMgc2Vw
YXJhdGUuCiAJICovCi0JaWYgKHZtLT5oYXNfcmVhZF9vbmx5ICYmCi0JICAgIHZtLT5pOTE1LT5r
ZXJuZWxfY29udGV4dCAmJgotCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtKSB7Ci0J
CXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKmNsb25lID0KLQkJCXJjdV9kZXJlZmVyZW5jZV9w
cm90ZWN0ZWQodm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSwKLQkJCQkJCSAgdHJ1ZSk7IC8q
IHN0YXRpYyAqLworCWlmICh2bS0+aGFzX3JlYWRfb25seSAmJiB2bS0+Z3QtPnZtICYmICFpOTE1
X2lzX2dndHQodm0tPmd0LT52bSkpIHsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xv
bmUgPSB2bS0+Z3QtPnZtOwogCiAJCUdFTV9CVUdfT04oIWNsb25lLT5oYXNfcmVhZF9vbmx5KTsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKaW5kZXggYjQwMTU3Y2ZhZTE0Li41
OTg0MjVhMmJlNjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vy
cm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYwpAQCAtMTIz
MSw5ICsxMjMxLDExIEBAIHN0YXRpYyB2b2lkIHJlY29yZF9yZXF1ZXN0KGNvbnN0IHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJlcXVlc3QsCiAJZXJxLT5oZWFkID0gcmVxdWVzdC0+aGVhZDsKIAllcnEt
PnRhaWwgPSByZXF1ZXN0LT50YWlsOwogCi0JcmN1X3JlYWRfbG9jaygpOwotCWVycS0+cGlkID0g
Y3R4ICYmIGN0eC0+cGlkID8gcGlkX25yKGN0eC0+cGlkKSA6IDA7Ci0JcmN1X3JlYWRfdW5sb2Nr
KCk7CisJaWYgKGN0eCkgeworCQlyY3VfcmVhZF9sb2NrKCk7CisJCWVycS0+cGlkID0gY3R4ICYm
IGN0eC0+cGlkID8gcGlkX25yKGN0eC0+cGlkKSA6IDA7CisJCXJjdV9yZWFkX3VubG9jaygpOwor
CX0KIH0KIAogc3RhdGljIHZvaWQgZW5naW5lX3JlY29yZF9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDZlMzViOTI1
NTg4Mi4uZjExNDdmYmIxZGMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMjM0MCw5
ICsyMzQwLDYgQEAgc3RhdGljIGludCBscmNfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3Qg
aTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCSAqLwogCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNv
bnRleHRzLmxvY2spOwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShjdHgsIGNuLCAmaTkxNS0+
Z2VtLmNvbnRleHRzLmxpc3QsIGxpbmspIHsKLQkJaWYgKGN0eCA9PSBpOTE1LT5rZXJuZWxfY29u
dGV4dCkKLQkJCWNvbnRpbnVlOwotCiAJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJmN0eC0+
cmVmKSkKIAkJCWNvbnRpbnVlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4
IGI5YmNjZGI5ZWU2Yy4uYjEwZWEyMmJkNjk4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuYwpAQCAtMTIyNyw4ICsxMjI3LDggQEAgdm9pZCBfX2k5MTVfcmVxdWVzdF9xdWV1ZShzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAogdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxKQogewotCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHJxLT5jb250
ZXh0LT5nZW1fY29udGV4dC0+c2NoZWQ7CiAJc3RydWN0IGludGVsX3RpbWVsaW5lICogY29uc3Qg
dGwgPSBpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpOworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIg
YXR0ciA9IHt9OwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnByZXY7CiAKIAlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZ0bC0+bXV0ZXgpOwpAQCAtMTIzOCwyOSArMTIzOCwzMyBAQCB2b2lkIGk5MTVfcmVx
dWVzdF9hZGQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAKIAlwcmV2ID0gX19pOTE1X3JlcXVl
c3RfY29tbWl0KHJxKTsKIAotCS8qCi0JICogQm9vc3QgYWN0dWFsIHdvcmtsb2FkcyBwYXN0IHNl
bWFwaG9yZXMhCi0JICoKLQkgKiBXaXRoIHNlbWFwaG9yZXMgd2Ugc3BpbiBvbiBvbmUgZW5naW5l
IHdhaXRpbmcgZm9yIGFub3RoZXIsCi0JICogc2ltcGx5IHRvIHJlZHVjZSB0aGUgbGF0ZW5jeSBv
ZiBzdGFydGluZyBvdXIgd29yayB3aGVuCi0JICogdGhlIHNpZ25hbGVyIGNvbXBsZXRlcy4gSG93
ZXZlciwgaWYgdGhlcmUgaXMgYW55IG90aGVyCi0JICogd29yayB0aGF0IHdlIGNvdWxkIGJlIGRv
aW5nIG9uIHRoaXMgZW5naW5lIGluc3RlYWQsIHRoYXQKLQkgKiBpcyBiZXR0ZXIgdXRpbGlzYXRp
b24gYW5kIHdpbGwgcmVkdWNlIHRoZSBvdmVyYWxsIGR1cmF0aW9uCi0JICogb2YgdGhlIGN1cnJl
bnQgd29yay4gVG8gYXZvaWQgUEkgYm9vc3RpbmcgYSBzZW1hcGhvcmUKLQkgKiBmYXIgaW4gdGhl
IGRpc3RhbmNlIHBhc3Qgb3ZlciB1c2VmdWwgd29yaywgd2Uga2VlcCBhIGhpc3RvcnkKLQkgKiBv
ZiBhbnkgc2VtYXBob3JlIHVzZSBhbG9uZyBvdXIgZGVwZW5kZW5jeSBjaGFpbi4KLQkgKi8KLQlp
ZiAoIShycS0+c2NoZWQuZmxhZ3MgJiBJOTE1X1NDSEVEX0hBU19TRU1BUEhPUkVfQ0hBSU4pKQot
CQlhdHRyLnByaW9yaXR5IHw9IEk5MTVfUFJJT1JJVFlfTk9TRU1BUEhPUkU7CisJaWYgKHJxLT5j
b250ZXh0LT5nZW1fY29udGV4dCkgeworCQlhdHRyID0gcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0
LT5zY2hlZDsKIAotCS8qCi0JICogQm9vc3QgcHJpb3JpdGllcyB0byBuZXcgY2xpZW50cyAobmV3
IHJlcXVlc3QgZmxvd3MpLgotCSAqCi0JICogQWxsb3cgaW50ZXJhY3RpdmUvc3luY2hyb25vdXMg
Y2xpZW50cyB0byBqdW1wIGFoZWFkIG9mCi0JICogdGhlIGJ1bGsgY2xpZW50cy4gKEZRX0NPREVM
KQotCSAqLwotCWlmIChsaXN0X2VtcHR5KCZycS0+c2NoZWQuc2lnbmFsZXJzX2xpc3QpKQotCQlh
dHRyLnByaW9yaXR5IHw9IEk5MTVfUFJJT1JJVFlfV0FJVDsKKwkJLyoKKwkJICogQm9vc3QgYWN0
dWFsIHdvcmtsb2FkcyBwYXN0IHNlbWFwaG9yZXMhCisJCSAqCisJCSAqIFdpdGggc2VtYXBob3Jl
cyB3ZSBzcGluIG9uIG9uZSBlbmdpbmUgd2FpdGluZyBmb3IgYW5vdGhlciwKKwkJICogc2ltcGx5
IHRvIHJlZHVjZSB0aGUgbGF0ZW5jeSBvZiBzdGFydGluZyBvdXIgd29yayB3aGVuCisJCSAqIHRo
ZSBzaWduYWxlciBjb21wbGV0ZXMuIEhvd2V2ZXIsIGlmIHRoZXJlIGlzIGFueSBvdGhlcgorCQkg
KiB3b3JrIHRoYXQgd2UgY291bGQgYmUgZG9pbmcgb24gdGhpcyBlbmdpbmUgaW5zdGVhZCwgdGhh
dAorCQkgKiBpcyBiZXR0ZXIgdXRpbGlzYXRpb24gYW5kIHdpbGwgcmVkdWNlIHRoZSBvdmVyYWxs
IGR1cmF0aW9uCisJCSAqIG9mIHRoZSBjdXJyZW50IHdvcmsuIFRvIGF2b2lkIFBJIGJvb3N0aW5n
IGEgc2VtYXBob3JlCisJCSAqIGZhciBpbiB0aGUgZGlzdGFuY2UgcGFzdCBvdmVyIHVzZWZ1bCB3
b3JrLCB3ZSBrZWVwIGEgaGlzdG9yeQorCQkgKiBvZiBhbnkgc2VtYXBob3JlIHVzZSBhbG9uZyBv
dXIgZGVwZW5kZW5jeSBjaGFpbi4KKwkJICovCisJCWlmICghKHJxLT5zY2hlZC5mbGFncyAmIEk5
MTVfU0NIRURfSEFTX1NFTUFQSE9SRV9DSEFJTikpCisJCQlhdHRyLnByaW9yaXR5IHw9IEk5MTVf
UFJJT1JJVFlfTk9TRU1BUEhPUkU7CisKKwkJLyoKKwkJICogQm9vc3QgcHJpb3JpdGllcyB0byBu
ZXcgY2xpZW50cyAobmV3IHJlcXVlc3QgZmxvd3MpLgorCQkgKgorCQkgKiBBbGxvdyBpbnRlcmFj
dGl2ZS9zeW5jaHJvbm91cyBjbGllbnRzIHRvIGp1bXAgYWhlYWQgb2YKKwkJICogdGhlIGJ1bGsg
Y2xpZW50cy4gKEZRX0NPREVMKQorCQkgKi8KKwkJaWYgKGxpc3RfZW1wdHkoJnJxLT5zY2hlZC5z
aWduYWxlcnNfbGlzdCkpCisJCQlhdHRyLnByaW9yaXR5IHw9IEk5MTVfUFJJT1JJVFlfV0FJVDsK
Kwl9CiAKIAlsb2NhbF9iaF9kaXNhYmxlKCk7CiAJX19pOTE1X3JlcXVlc3RfcXVldWUocnEsICZh
dHRyKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3Jl
cXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwpp
bmRleCAzMGFlMzRmNjIxNzYuLjlkZGFkZTRlYWNmOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwpAQCAtNzM5LDEwICs3MzksOCBAQCBzdGF0aWMg
aW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92
bWEgKnJlY3Vyc2l2ZV9iYXRjaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gaTkxNS0+a2VybmVsX2NvbnRleHQ7CiAJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25zdCBpbnQgZ2VuID0gSU5URUxfR0VO
KGk5MTUpOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwogCXUzMiAqY21kOwogCWludCBlcnI7CkBAIC03NTEsOSArNzQ5LDcgQEAgc3RhdGlj
IHN0cnVjdCBpOTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKLQl2
bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwotCXZtYSA9IGk5MTVfdm1hX2lu
c3RhbmNlKG9iaiwgdm0sIE5VTEwpOwotCWk5MTVfdm1fcHV0KHZtKTsKKwl2bWEgPSBpOTE1X3Zt
YV9pbnN0YW5jZShvYmosIGk5MTUtPmd0LnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsK
IAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRleCBhMGRhNTk0NGRkMzMuLjg2
YWVjYjllMjk0NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21v
Y2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2Nr
X2dlbV9kZXZpY2UuYwpAQCAtNjMsNyArNjMsNiBAQCBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9y
ZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCAmaTkxNS0+Z3QsIGlkKQogCQltb2NrX2VuZ2luZV9mcmVlKGVuZ2luZSk7Ci0JaTkxNV9nZW1f
ZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwogCiAJaW50ZWxfdGltZWxpbmVzX2Zpbmko
aTkxNSk7CiAKQEAgLTE4NCw2ICsxODMsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9j
a19nZW1fZGV2aWNlKHZvaWQpCiAKIAltb2NrX2luaXRfZ2d0dChpOTE1LCAmaTkxNS0+Z2d0dCk7
CiAJaTkxNS0+Z3QuZ2d0dCA9ICZpOTE1LT5nZ3R0OworCWk5MTUtPmd0LnZtID0gaTkxNV92bV9n
ZXQoJmk5MTUtPmdndHQudm0pOwogCiAJbWt3cml0ZV9kZXZpY2VfaW5mbyhpOTE1KS0+ZW5naW5l
X21hc2sgPSBCSVQoMCk7CiAKQEAgLTE5MSwxMCArMTkxLDYgQEAgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2b2lkKQogCWlmICghaTkxNS0+ZW5naW5lW1JDUzBdKQog
CQlnb3RvIGVycl91bmxvY2s7CiAKLQlpOTE1LT5rZXJuZWxfY29udGV4dCA9IG1vY2tfY29udGV4
dChpOTE1LCBOVUxMKTsKLQlpZiAoIWk5MTUtPmtlcm5lbF9jb250ZXh0KQotCQlnb3RvIGVycl9l
bmdpbmU7Ci0KIAlpZiAobW9ja19lbmdpbmVfaW5pdChpOTE1LT5lbmdpbmVbUkNTMF0pKQogCQln
b3RvIGVycl9jb250ZXh0OwogCkBAIC0yMDMsOCArMTk5LDYgQEAgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2b2lkKQogCXJldHVybiBpOTE1OwogCiBlcnJfY29udGV4
dDoKLQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7Ci1lcnJfZW5naW5l
OgogCW1vY2tfZW5naW5lX2ZyZWUoaTkxNS0+ZW5naW5lW1JDUzBdKTsKIGVycl91bmxvY2s6CiAJ
aW50ZWxfdGltZWxpbmVzX2ZpbmkoaTkxNSk7Ci0tIAoyLjI0LjAucmMxCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D2AF4D1ABD
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 23:20:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 587626E918;
	Wed,  9 Oct 2019 21:20:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 134626E332
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 21:20:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18783195-1500050 
 for multiple; Wed, 09 Oct 2019 22:19:52 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  9 Oct 2019 22:19:42 +0100
Message-Id: <20191009211947.6815-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191009211947.6815-1-chris@chris-wilson.co.uk>
References: <20191009211947.6815-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/9] drm/i915: add support for perf
 configuration queries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
TGlzdGluZyBjb25maWd1cmF0aW9ucyBhdCB0aGUgbW9tZW50IGlzIHN1cHBvcnRlZCBvbmx5IHRo
cm91Z2ggc3lzZnMuClRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIGZvciBhcHBsaWNhdGlvbnMgd2Fu
dGluZyB0byBsaXN0CmNvbmZpZ3VyYXRpb25zIGZyb20gYSBjb250YWluZXIgd2hlcmUgc3lzZnMg
aXNuJ3QgYXZhaWxhYmxlLgoKVGhpcyBjaGFuZ2UgYWRkcyBhIHdheSB0byBxdWVyeSB0aGUgbnVt
YmVyIG9mIGNvbmZpZ3VyYXRpb25zIGFuZCB0aGVpcgpjb250ZW50IHRocm91Z2ggdGhlIGk5MTUg
cXVlcnkgdUFQSS4KCnYyOiBGaXggc3BhcnNlIHdhcm5pbmdzIChMaW9uZWwpCiAgICBBZGQgc3Vw
cG9ydCB0byBxdWVyeSBjb25maWd1cmF0aW9uIHVzaW5nIHV1aWQgKExpb25lbCkKCnYzOiBGaXgg
c29tZSBpbmNvbnNpc3RlbmN5IGluIHVhcGkgaGVhZGVyIChMaW9uZWwpCiAgICBGaXggdW5sb2Nr
aW5nIHdoZW4gbm90IGxvY2tlZCBpc3N1ZSAoTGlvbmVsKQogICAgQWRkIGRlYnVnIG1lc3NhZ2Vz
IChMaW9uZWwpCgp2NDogRml4IG1pc3NpbmcgdW5sb2NrIChEYW4pCgp2NTogRHJvcCBsb2NrIHdo
ZW4gY29weWluZyBjb25maWcgY29udGVudCB0byB1c2Vyc3BhY2UgKENocmlzKQoKdjY6IERyb3Ag
bG9jayB3aGVuIGNvcHlpbmcgY29uZmlnIGxpc3QgdG8gdXNlcnNwYWNlIChDaHJpcykKICAgIEZp
eCBkZWFkbG9jayB3aGVuIGNhbGxpbmcgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoKSB1bmRlcgog
ICAgcGVyZi5tZXRyaWNzX2xvY2sgKExpb25lbCkKICAgIEFkZCBpOTE1X29hX2NvbmZpZ19nZXQo
KSAoQ2hyaXMpCgpTaWduZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFu
ZHdlcmxpbkBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgfCAg
IDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcXVlcnkuYyB8IDI5NSArKysrKysrKysr
KysrKysrKysrKysrKysrKysrKysKIGluY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCAgICAgICB8
ICA2MiArKysrKystCiAzIGZpbGVzIGNoYW5nZWQsIDM1NyBpbnNlcnRpb25zKCspLCAzIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggZjA4N2E4MWE2YjMwLi5kNzlk
YTE2N2I2ZjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0zNDczLDggKzM0NzMsNyBA
QCBpbnQgaTkxNV9wZXJmX3JlbW92ZV9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwKIAogCUdFTV9CVUdfT04oKmFyZyAhPSBvYV9jb25maWctPmlkKTsKIAot
CXN5c2ZzX3JlbW92ZV9ncm91cChwZXJmLT5tZXRyaWNzX2tvYmosCi0JCQkgICAmb2FfY29uZmln
LT5zeXNmc19tZXRyaWMpOworCXN5c2ZzX3JlbW92ZV9ncm91cChwZXJmLT5tZXRyaWNzX2tvYmos
ICZvYV9jb25maWctPnN5c2ZzX21ldHJpYyk7CiAKIAlpZHJfcmVtb3ZlKCZwZXJmLT5tZXRyaWNz
X2lkciwgKmFyZyk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcXVl
cnkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcXVlcnkuYwppbmRleCBhYmFjNTA0MmRh
MmIuLjZhNjhlY2M3YmI1ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9x
dWVyeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcXVlcnkuYwpAQCAtNyw2ICs3
LDcgQEAKICNpbmNsdWRlIDxsaW51eC9ub3NwZWMuaD4KIAogI2luY2x1ZGUgImk5MTVfZHJ2Lmgi
CisjaW5jbHVkZSAiaTkxNV9wZXJmLmgiCiAjaW5jbHVkZSAiaTkxNV9xdWVyeS5oIgogI2luY2x1
ZGUgPHVhcGkvZHJtL2k5MTVfZHJtLmg+CiAKQEAgLTE0MCwxMCArMTQxLDMwNCBAQCBxdWVyeV9l
bmdpbmVfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZXR1cm4gbGVuOwog
fQogCitzdGF0aWMgaW50IGNhbl9jb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIo
dTMyIHVzZXJfbl9yZWdzLAorCQkJCQkJICAgIHU2NCB1c2VyX3JlZ3NfcHRyLAorCQkJCQkJICAg
IHUzMiBrZXJuZWxfbl9yZWdzKQoreworCS8qCisJICogV2UnbGwganVzdCBwdXQgdGhlIG51bWJl
ciBvZiByZWdpc3RlcnMsIGFuZCB3b24ndCBjb3B5IHRoZQorCSAqIHJlZ2lzdGVyLgorCSAqLwor
CWlmICh1c2VyX25fcmVncyA9PSAwKQorCQlyZXR1cm4gMDsKKworCWlmICh1c2VyX25fcmVncyA8
IGtlcm5lbF9uX3JlZ3MpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKCFhY2Nlc3Nfb2sodTY0
X3RvX3VzZXJfcHRyKHVzZXJfcmVnc19wdHIpLAorCQkgICAgICAgMiAqIHNpemVvZih1MzIpICog
a2VybmVsX25fcmVncykpCisJCXJldHVybiAtRUZBVUxUOworCisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQgY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKGNvbnN0IHN0cnVj
dCBpOTE1X29hX3JlZyAqa2VybmVsX3JlZ3MsCisJCQkJCQl1MzIga2VybmVsX25fcmVncywKKwkJ
CQkJCXU2NCB1c2VyX3JlZ3NfcHRyLAorCQkJCQkJdTMyICp1c2VyX25fcmVncykKK3sKKwl1MzIg
cjsKKworCWlmICgqdXNlcl9uX3JlZ3MgPT0gMCkgeworCQkqdXNlcl9uX3JlZ3MgPSBrZXJuZWxf
bl9yZWdzOworCQlyZXR1cm4gMDsKKwl9CisKKwkqdXNlcl9uX3JlZ3MgPSBrZXJuZWxfbl9yZWdz
OworCisJZm9yIChyID0gMDsgciA8IGtlcm5lbF9uX3JlZ3M7IHIrKykgeworCQl1MzIgX191c2Vy
ICp1c2VyX3JlZ19wdHIgPQorCQkJdTY0X3RvX3VzZXJfcHRyKHVzZXJfcmVnc19wdHIgKyBzaXpl
b2YodTMyKSAqIHIgKiAyKTsKKwkJdTMyIF9fdXNlciAqdXNlcl92YWxfcHRyID0KKwkJCXU2NF90
b191c2VyX3B0cih1c2VyX3JlZ3NfcHRyICsgc2l6ZW9mKHUzMikgKiByICogMiArCisJCQkJCXNp
emVvZih1MzIpKTsKKwkJaW50IHJldDsKKworCQlyZXQgPSBfX3B1dF91c2VyKGk5MTVfbW1pb19y
ZWdfb2Zmc2V0KGtlcm5lbF9yZWdzW3JdLmFkZHIpLAorCQkJCSB1c2VyX3JlZ19wdHIpOworCQlp
ZiAocmV0KQorCQkJcmV0dXJuIC1FRkFVTFQ7CisKKwkJcmV0ID0gX19wdXRfdXNlcihrZXJuZWxf
cmVnc1tyXS52YWx1ZSwgdXNlcl92YWxfcHRyKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiAtRUZB
VUxUOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHF1ZXJ5X3BlcmZfY29uZmln
X2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJICBzdHJ1Y3QgZHJtX2k5
MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRlbSwKKwkJCQkgIGJvb2wgdXNlX3V1aWQpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnIF9fdXNlciAqdXNlcl9xdWVyeV9jb25maWdf
cHRyID0KKwkJdTY0X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyKTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcGVyZl9vYV9jb25maWcgX191c2VyICp1c2VyX2NvbmZpZ19wdHIgPQorCQl1NjRf
dG9fdXNlcl9wdHIocXVlcnlfaXRlbS0+ZGF0YV9wdHIgKworCQkJCXNpemVvZihzdHJ1Y3QgZHJt
X2k5MTVfcXVlcnlfcGVyZl9jb25maWcpKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9vYV9jb25m
aWcgdXNlcl9jb25maWc7CisJc3RydWN0IGk5MTVfcGVyZiAqcGVyZiA9ICZpOTE1LT5wZXJmOwor
CXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnOworCWNoYXIgdXVpZFtVVUlEX1NUUklO
R19MRU4gKyAxXTsKKwl1NjQgY29uZmlnX2lkOworCXUzMiBmbGFncywgdG90YWxfc2l6ZTsKKwlp
bnQgcmV0OworCisJaWYgKCFwZXJmLT5pOTE1KQorCQlyZXR1cm4gLUVOT0RFVjsKKworCXRvdGFs
X3NpemUgPQorCQlzaXplb2Yoc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnKSArCisJ
CXNpemVvZihzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9vYV9jb25maWcpOworCisJaWYgKHF1ZXJ5X2l0
ZW0tPmxlbmd0aCA9PSAwKQorCQlyZXR1cm4gdG90YWxfc2l6ZTsKKworCWlmIChxdWVyeV9pdGVt
LT5sZW5ndGggPCB0b3RhbF9zaXplKSB7CisJCURSTV9ERUJVRygiSW52YWxpZCBxdWVyeSBjb25m
aWcgZGF0YSBpdGVtIHNpemU9JXUgZXhwZWN0ZWQ9JXVcbiIsCisJCQkgIHF1ZXJ5X2l0ZW0tPmxl
bmd0aCwgdG90YWxfc2l6ZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWlmICghYWNjZXNz
X29rKHVzZXJfcXVlcnlfY29uZmlnX3B0ciwgdG90YWxfc2l6ZSkpCisJCXJldHVybiAtRUZBVUxU
OworCisJaWYgKF9fZ2V0X3VzZXIoZmxhZ3MsICZ1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmZsYWdz
KSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoZmxhZ3MgIT0gMCkKKwkJcmV0dXJuIC1FSU5W
QUw7CisKKwlpZiAodXNlX3V1aWQpIHsKKwkJc3RydWN0IGk5MTVfb2FfY29uZmlnICp0bXA7CisJ
CWludCBpZDsKKworCQlCVUlMRF9CVUdfT04oc2l6ZW9mKHVzZXJfcXVlcnlfY29uZmlnX3B0ci0+
dXVpZCkgPj0gc2l6ZW9mKHV1aWQpKTsKKworCQltZW1zZXQoJnV1aWQsIDAsIHNpemVvZih1dWlk
KSk7CisJCWlmIChfX2NvcHlfZnJvbV91c2VyKHV1aWQsIHVzZXJfcXVlcnlfY29uZmlnX3B0ci0+
dXVpZCwKKwkJCQkgICAgIHNpemVvZih1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPnV1aWQpKSkKKwkJ
CXJldHVybiAtRUZBVUxUOworCisJCW9hX2NvbmZpZyA9IE5VTEw7CisJCXJjdV9yZWFkX2xvY2so
KTsKKwkJaWRyX2Zvcl9lYWNoX2VudHJ5KCZwZXJmLT5tZXRyaWNzX2lkciwgdG1wLCBpZCkgewor
CQkJaWYgKCFzdHJjbXAodG1wLT51dWlkLCB1dWlkKSkgeworCQkJCW9hX2NvbmZpZyA9IGk5MTVf
b2FfY29uZmlnX2dldCh0bXApOworCQkJCWJyZWFrOworCQkJfQorCQl9CisJCXJjdV9yZWFkX3Vu
bG9jaygpOworCX0gZWxzZSB7CisJCWlmIChfX2dldF91c2VyKGNvbmZpZ19pZCwgJnVzZXJfcXVl
cnlfY29uZmlnX3B0ci0+Y29uZmlnKSkKKwkJCXJldHVybiAtRUZBVUxUOworCisJCW9hX2NvbmZp
ZyA9IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKHBlcmYsIGNvbmZpZ19pZCk7CisJfQorCWlmICgh
b2FfY29uZmlnKQorCQlyZXR1cm4gLUVOT0VOVDsKKworCWlmIChfX2NvcHlfZnJvbV91c2VyKCZ1
c2VyX2NvbmZpZywgdXNlcl9jb25maWdfcHRyLAorCQkJICAgICBzaXplb2YodXNlcl9jb25maWcp
KSkgeworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsKKwl9CisKKwlyZXQgPSBjYW5fY29w
eV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKHVzZXJfY29uZmlnLm5fYm9vbGVhbl9y
ZWdzLAorCQkJCQkJICAgICAgIHVzZXJfY29uZmlnLmJvb2xlYW5fcmVnc19wdHIsCisJCQkJCQkg
ICAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOworCWlmIChyZXQpCisJCWdvdG8g
b3V0OworCisJcmV0ID0gY2FuX2NvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcih1
c2VyX2NvbmZpZy5uX2ZsZXhfcmVncywKKwkJCQkJCSAgICAgICB1c2VyX2NvbmZpZy5mbGV4X3Jl
Z3NfcHRyLAorCQkJCQkJICAgICAgIG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbik7CisJaWYgKHJl
dCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBjYW5fY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNf
b3JfbnVtYmVyKHVzZXJfY29uZmlnLm5fbXV4X3JlZ3MsCisJCQkJCQkgICAgICAgdXNlcl9jb25m
aWcubXV4X3JlZ3NfcHRyLAorCQkJCQkJICAgICAgIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsK
KwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0
ZXJzX29yX251bWJlcihvYV9jb25maWctPmJfY291bnRlcl9yZWdzLAorCQkJCQkJICAgb2FfY29u
ZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4sCisJCQkJCQkgICB1c2VyX2NvbmZpZy5ib29sZWFuX3Jl
Z3NfcHRyLAorCQkJCQkJICAgJnVzZXJfY29uZmlnLm5fYm9vbGVhbl9yZWdzKTsKKwlpZiAocmV0
KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251
bWJlcihvYV9jb25maWctPmZsZXhfcmVncywKKwkJCQkJCSAgIG9hX2NvbmZpZy0+ZmxleF9yZWdz
X2xlbiwKKwkJCQkJCSAgIHVzZXJfY29uZmlnLmZsZXhfcmVnc19wdHIsCisJCQkJCQkgICAmdXNl
cl9jb25maWcubl9mbGV4X3JlZ3MpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0ID0g
Y29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKG9hX2NvbmZpZy0+bXV4X3JlZ3Ms
CisJCQkJCQkgICBvYV9jb25maWctPm11eF9yZWdzX2xlbiwKKwkJCQkJCSAgIHVzZXJfY29uZmln
Lm11eF9yZWdzX3B0ciwKKwkJCQkJCSAgICZ1c2VyX2NvbmZpZy5uX211eF9yZWdzKTsKKwlpZiAo
cmV0KQorCQlnb3RvIG91dDsKKworCW1lbWNweSh1c2VyX2NvbmZpZy51dWlkLCBvYV9jb25maWct
PnV1aWQsIHNpemVvZih1c2VyX2NvbmZpZy51dWlkKSk7CisKKwlpZiAoX19jb3B5X3RvX3VzZXIo
dXNlcl9jb25maWdfcHRyLCAmdXNlcl9jb25maWcsCisJCQkgICBzaXplb2YodXNlcl9jb25maWcp
KSkgeworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsKKwl9CisKKwlyZXQgPSB0b3RhbF9z
aXplOworCitvdXQ6CisJaTkxNV9vYV9jb25maWdfcHV0KG9hX2NvbmZpZyk7CisJcmV0dXJuIHJl
dDsKK30KKworc3RhdGljIHNpemVfdCBzaXplb2ZfcGVyZl9jb25maWdfbGlzdChzaXplX3QgY291
bnQpCit7CisJcmV0dXJuIHNpemVvZihzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfcGVyZl9jb25maWcp
ICsgc2l6ZW9mKHU2NCkgKiBjb3VudDsKK30KKworc3RhdGljIHNpemVfdCBzaXplb2ZfcGVyZl9t
ZXRyaWNzKHN0cnVjdCBpOTE1X3BlcmYgKnBlcmYpCit7CisJc3RydWN0IGk5MTVfb2FfY29uZmln
ICp0bXA7CisJc2l6ZV90IGk7CisJaW50IGlkOworCisJaSA9IDE7CisJcmN1X3JlYWRfbG9jaygp
OworCWlkcl9mb3JfZWFjaF9lbnRyeSgmcGVyZi0+bWV0cmljc19pZHIsIHRtcCwgaWQpCisJCWkr
KzsKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCXJldHVybiBzaXplb2ZfcGVyZl9jb25maWdfbGlz
dChpKTsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJmX2NvbmZpZ19saXN0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1
ZXJ5X2l0ZW0pCit7CisJc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnIF9fdXNlciAq
dXNlcl9xdWVyeV9jb25maWdfcHRyID0KKwkJdTY0X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRh
dGFfcHRyKTsKKwlzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmID0gJmk5MTUtPnBlcmY7CisJdTY0ICpv
YV9jb25maWdfaWRzID0gTlVMTDsKKwlpbnQgaSwgbl9jb25maWdzOworCXUzMiBmbGFnczsKKwlp
bnQgcmV0OworCisJaWYgKCFwZXJmLT5pOTE1KQorCQlyZXR1cm4gLUVOT0RFVjsKKworCWlmIChx
dWVyeV9pdGVtLT5sZW5ndGggPT0gMCkKKwkJcmV0dXJuIHNpemVvZl9wZXJmX21ldHJpY3MocGVy
Zik7CisKKwlpZiAoZ2V0X3VzZXIoZmxhZ3MsICZ1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmZsYWdz
KSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoZmxhZ3MgIT0gMCkKKwkJcmV0dXJuIC1FSU5W
QUw7CisKKwluX2NvbmZpZ3MgPSAxOworCWRvIHsKKwkJc3RydWN0IGk5MTVfb2FfY29uZmlnICp0
bXA7CisJCXU2NCAqaWRzOworCQlpbnQgaWQ7CisKKwkJaWRzID0ga3JlYWxsb2Mob2FfY29uZmln
X2lkcywKKwkJCSAgICAgICBuX2NvbmZpZ3MgKiBzaXplb2YoKm9hX2NvbmZpZ19pZHMpLAorCQkJ
ICAgICAgIEdGUF9LRVJORUwpOworCQlpZiAoIWlkcykKKwkJCXJldHVybiAtRU5PTUVNOworCisJ
CWkgPSAwOworCQlpZHNbaSsrXSA9IDF1bGw7CisJCXJjdV9yZWFkX2xvY2soKTsKKwkJaWRyX2Zv
cl9lYWNoX2VudHJ5KCZwZXJmLT5tZXRyaWNzX2lkciwgdG1wLCBpZCkgeworCQkJaWYgKGkgPCBu
X2NvbmZpZ3MpCisJCQkJaWRzW2ldID0gaWQ7CisJCQlpKys7CisJCX0KKwkJcmN1X3JlYWRfdW5s
b2NrKCk7CisKKwkJb2FfY29uZmlnX2lkcyA9IGlkczsKKwl9IHdoaWxlIChpID4gbl9jb25maWdz
KTsKKworCWlmIChxdWVyeV9pdGVtLT5sZW5ndGggPCBzaXplb2ZfcGVyZl9jb25maWdfbGlzdChu
X2NvbmZpZ3MpKSB7CisJCURSTV9ERUJVRygiSW52YWxpZCBxdWVyeSBjb25maWcgbGlzdCBpdGVt
IHNpemU9JXUgZXhwZWN0ZWQ9JXp1XG4iLAorCQkJICBxdWVyeV9pdGVtLT5sZW5ndGgsCisJCQkg
IHNpemVvZl9wZXJmX2NvbmZpZ19saXN0KG5fY29uZmlncykpOworCQlrZnJlZShvYV9jb25maWdf
aWRzKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKHB1dF91c2VyKG5fY29uZmlncywg
JnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+Y29uZmlnKSkgeworCQlrZnJlZShvYV9jb25maWdfaWRz
KTsKKwkJcmV0dXJuIC1FRkFVTFQ7CisJfQorCisJcmV0ID0gY29weV90b191c2VyKHVzZXJfcXVl
cnlfY29uZmlnX3B0ciArIDEsCisJCQkgICBvYV9jb25maWdfaWRzLAorCQkJICAgbl9jb25maWdz
ICogc2l6ZW9mKCpvYV9jb25maWdfaWRzKSk7CisJa2ZyZWUob2FfY29uZmlnX2lkcyk7CisJaWYg
KHJldCkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlyZXR1cm4gc2l6ZW9mX3BlcmZfY29uZmlnX2xp
c3Qobl9jb25maWdzKTsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJmX2NvbmZpZyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCSAgICAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0
ZW0gKnF1ZXJ5X2l0ZW0pCit7CisJc3dpdGNoIChxdWVyeV9pdGVtLT5mbGFncykgeworCWNhc2Ug
RFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29u
ZmlnX2xpc3QoaTkxNSwgcXVlcnlfaXRlbSk7CisJY2FzZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NP
TkZJR19EQVRBX0ZPUl9VVUlEOgorCQlyZXR1cm4gcXVlcnlfcGVyZl9jb25maWdfZGF0YShpOTE1
LCBxdWVyeV9pdGVtLCB0cnVlKTsKKwljYXNlIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RB
VEFfRk9SX0lEOgorCQlyZXR1cm4gcXVlcnlfcGVyZl9jb25maWdfZGF0YShpOTE1LCBxdWVyeV9p
dGVtLCBmYWxzZSk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorfQorCiBzdGF0
aWMgaW50ICgqIGNvbnN0IGk5MTVfcXVlcnlfZnVuY3NbXSkoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQkJCQlzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRl
bSkgPSB7CiAJcXVlcnlfdG9wb2xvZ3lfaW5mbywKIAlxdWVyeV9lbmdpbmVfaW5mbywKKwlxdWVy
eV9wZXJmX2NvbmZpZywKIH07CiAKIGludCBpOTE1X3F1ZXJ5X2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKZGlmZiAtLWdpdCBh
L2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0u
aAppbmRleCBjNTBjNzEyYjM3NzEuLjBjN2IyODE1ZmJmMSAxMDA2NDQKLS0tIGEvaW5jbHVkZS91
YXBpL2RybS9pOTE1X2RybS5oCisrKyBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaApAQCAt
MjAwNSw2ICsyMDA1LDcgQEAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gewogCV9fdTY0IHF1
ZXJ5X2lkOwogI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9UT1BPTE9HWV9JTkZPICAgIDEKICNkZWZp
bmUgRFJNX0k5MTVfUVVFUllfRU5HSU5FX0lORk8JMgorI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9Q
RVJGX0NPTkZJRyAgICAgIDMKIC8qIE11c3QgYmUga2VwdCBjb21wYWN0IC0tIG5vIGhvbGVzIGFu
ZCB3ZWxsIGRvY3VtZW50ZWQgKi8KIAogCS8qCkBAIC0yMDE2LDkgKzIwMTcsMTggQEAgc3RydWN0
IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gewogCV9fczMyIGxlbmd0aDsKIAogCS8qCi0JICogVW51c2Vk
IGZvciBub3cuIE11c3QgYmUgY2xlYXJlZCB0byB6ZXJvLgorCSAqIFdoZW4gcXVlcnlfaWQgPT0g
RFJNX0k5MTVfUVVFUllfVE9QT0xPR1lfSU5GTywgbXVzdCBiZSAwLgorCSAqCisJICogV2hlbiBx
dWVyeV9pZCA9PSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJRywgbXVzdCBiZSBvbmUgb2YgdGhl
CisJICogZm9sbG93aW5nIDoKKwkgKiAgICAgICAgIC0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05G
SUdfTElTVAorCSAqICAgICAgICAgLSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZP
Ul9VVUlECisJICogICAgICAgICAtIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0ZPUl9VVUlE
CiAJICovCiAJX191MzIgZmxhZ3M7CisjZGVmaW5lIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklH
X0xJU1QgICAgICAgICAgMQorI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRB
X0ZPUl9VVUlEIDIKKyNkZWZpbmUgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1Jf
SUQgICAzCiAKIAkvKgogCSAqIERhdGEgd2lsbCBiZSB3cml0dGVuIGF0IHRoZSBsb2NhdGlvbiBw
b2ludGVkIGJ5IGRhdGFfcHRyIHdoZW4gdGhlCkBAIC0yMTQ2LDYgKzIxNTYsNTYgQEAgc3RydWN0
IGRybV9pOTE1X3F1ZXJ5X2VuZ2luZV9pbmZvIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZW5naW5lX2lu
Zm8gZW5naW5lc1tdOwogfTsKIAorLyoKKyAqIERhdGEgd3JpdHRlbiBieSB0aGUga2VybmVsIHdp
dGggcXVlcnkgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUcuCisgKi8KK3N0cnVjdCBkcm1faTkx
NV9xdWVyeV9wZXJmX2NvbmZpZyB7CisJdW5pb24geworCQkvKgorCQkgKiBXaGVuIHF1ZXJ5X2l0
ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVCwgaTkxNSBzZXRzCisJ
CSAqIHRoaXMgZmllbGRzIHRvIHRoZSBudW1iZXIgb2YgY29uZmlndXJhdGlvbnMgYXZhaWxhYmxl
LgorCQkgKi8KKwkJX191NjQgbl9jb25maWdzOworCisJCS8qCisJCSAqIFdoZW4gcXVlcnlfaWQg
PT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQsCisJCSAqIGk5MTUgd2ls
bCB1c2UgdGhlIHZhbHVlIGluIHRoaXMgZmllbGQgYXMgY29uZmlndXJhdGlvbgorCQkgKiBpZGVu
dGlmaWVyIHRvIGRlY2lkZSB3aGF0IGRhdGEgdG8gd3JpdGUgaW50byBjb25maWdfcHRyLgorCQkg
Ki8KKwkJX191NjQgY29uZmlnOworCisJCS8qCisJCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5
MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfVVVJRCwKKwkJICogaTkxNSB3aWxsIHVzZSB0
aGUgdmFsdWUgaW4gdGhpcyBmaWVsZCBhcyBjb25maWd1cmF0aW9uCisJCSAqIGlkZW50aWZpZXIg
dG8gZGVjaWRlIHdoYXQgZGF0YSB0byB3cml0ZSBpbnRvIGNvbmZpZ19wdHIuCisJCSAqCisJCSAq
IFN0cmluZyBmb3JtYXR0ZWQgbGlrZSAiJTA4eC0lMDR4LSUwNHgtJTA0eC0lMDEyeCIKKwkJICov
CisJCWNoYXIgdXVpZFszNl07CisJfTsKKworCS8qCisJICogVW51c2VkIGZvciBub3cuIE11c3Qg
YmUgY2xlYXJlZCB0byB6ZXJvLgorCSAqLworCV9fdTMyIGZsYWdzOworCisJLyoKKwkgKiBXaGVu
IHF1ZXJ5X2l0ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVCwgaTkx
NSB3aWxsCisJICogd3JpdGUgYW4gYXJyYXkgb2YgX191NjQgb2YgY29uZmlndXJhdGlvbiBpZGVu
dGlmaWVycy4KKwkgKgorCSAqIFdoZW4gcXVlcnlfaXRlbS5mbGFncyA9PSBEUk1fSTkxNV9RVUVS
WV9QRVJGX0NPTkZJR19EQVRBLCBpOTE1IHdpbGwKKwkgKiB3cml0ZSBhIHN0cnVjdCBkcm1faTkx
NV9wZXJmX29hX2NvbmZpZy4gSWYgdGhlIGZvbGxvd2luZyBmaWVsZHMgb2YKKwkgKiBkcm1faTkx
NV9wZXJmX29hX2NvbmZpZyBhcmUgc2V0IG5vdCBzZXQgdG8gMCwgaTkxNSB3aWxsIHdyaXRlIGlu
dG8KKwkgKiB0aGUgYXNzb2NpYXRlZCBwb2ludGVycyB0aGUgdmFsdWVzIG9mIHN1Ym1pdHRlZCB3
aGVuIHRoZQorCSAqIGNvbmZpZ3VyYXRpb24gd2FzIGNyZWF0ZWQgOgorCSAqCisJICogICAgICAg
ICAtIG5fbXV4X3JlZ3MKKwkgKiAgICAgICAgIC0gbl9ib29sZWFuX3JlZ3MKKwkgKiAgICAgICAg
IC0gbl9mbGV4X3JlZ3MKKwkgKi8KKwlfX3U4IGRhdGFbXTsKK307CisKICNpZiBkZWZpbmVkKF9f
Y3BsdXNwbHVzKQogfQogI2VuZGlmCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

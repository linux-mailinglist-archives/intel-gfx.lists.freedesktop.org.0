Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 259D02F5F9C
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Jan 2021 12:15:27 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 82AB86E226;
	Thu, 14 Jan 2021 11:15:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2B17A6E1F2
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Jan 2021 11:15:25 +0000 (UTC)
IronPort-SDR: dyjA+zeY2wse/7hXJwHyvb3UV4q7PRVmEN8U6+luSWQjsqaUSVrHO9ALHSC1fxFTYU3Stffu+v
 gGDVOnp0nYCQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9863"; a="177569278"
X-IronPort-AV: E=Sophos;i="5.79,347,1602572400"; d="scan'208";a="177569278"
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 Jan 2021 03:15:24 -0800
IronPort-SDR: sBoXflFo9pJdNSa0o5BzqfS/Z+3Ry6O+o/lz3YEKl290sptzSldgAog6gxkQAnReYXtux9Q9jm
 Nf2qoi5EQjUA==
X-IronPort-AV: E=Sophos;i="5.79,347,1602572400"; d="scan'208";a="568142235"
Received: from dforourk-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.213.254.146])
 by orsmga005-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 Jan 2021 03:15:03 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Jan 2021 13:13:54 +0200
Message-Id: <42acfc7660491e9cf50879c3b3c20d69e0397cb2.1610622609.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1610622609.git.jani.nikula@intel.com>
References: <cover.1610622609.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 10/11] drm/i915: migrate pll enable/disable code
 to intel_dpll.[ch]
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Dave Airlie <airlied@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClRoaXMgbW92ZXMgdGhlIG9s
ZGVyIGk5eHgvdmx2L2NodiBlbmFibGUvZGlzYWJsZSB0byBkcGxsIGZpbGUuCgohISEgRklYTUU6
IERhdmUncyBzLW8tYiAhISEKClNpZ25lZC1vZmYtYnk6IEphbmkgTmlrdWxhIDxqYW5pLm5pa3Vs
YUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgfCA1MTIgLS0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmggfCAgIDMgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kcC5jICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcGxsLmMgICAgfCA1MDkgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwbGwuaCAgICB8ICAxOCArCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Bwcy5jICAgICB8ICAgMSArCiA2IGZpbGVzIGNoYW5nZWQsIDUyOSBp
bnNlcnRpb25zKCspLCA1MTUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA3Mzk4OTI3ZTE2MjcuLjhhYmQ0OWNmOWMyYiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTEw
OSwxMCArMTA5LDYgQEAgc3RhdGljIHZvaWQgaTl4eF9zZXRfcGlwZWNvbmYoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogc3RhdGljIHZvaWQgaWxrX3NldF9waXBl
Y29uZihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiBzdGF0aWMg
dm9pZCBoc3dfc2V0X3BpcGVjb25mKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKTsKIHN0YXRpYyB2b2lkIGJkd19zZXRfcGlwZW1pc2MoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwotc3RhdGljIHZvaWQgdmx2X3ByZXBhcmVfcGxsKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpwaXBlX2NvbmZpZyk7Ci1zdGF0aWMgdm9pZCBjaHZfcHJlcGFyZV9wbGwoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCi0JCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBp
cGVfY29uZmlnKTsKIHN0YXRpYyB2b2lkIGlsa19wZml0X2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3Nl
dHVwX2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSBzdHJ1Y3QgZHJtX21v
ZGVzZXRfYWNxdWlyZV9jdHggKmN0eCk7CkBAIC01NjUsMjI0ICs1NjEsNiBAQCBzdGF0aWMgdm9p
ZCBhc3NlcnRfcGNoX3BvcnRzX2Rpc2FibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAlhc3NlcnRfcGNoX2hkbWlfZGlzYWJsZWQoZGV2X3ByaXYsIHBpcGUsIFBPUlRfRCwg
UENIX0hETUlEKTsKIH0KIAotc3RhdGljIHZvaWQgX3Zsdl9lbmFibGVfcGxsKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAotCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBl
X2NvbmZpZykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7Ci0KLQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgRFBMTChwaXBlKSwgcGlwZV9jb25maWctPmRwbGxfaHdfc3Rh
dGUuZHBsbCk7Ci0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEUExMKHBpcGUpKTsK
LQl1ZGVsYXkoMTUwKTsKLQotCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIERQ
TEwocGlwZSksIERQTExfTE9DS19WTFYsIDEpKQotCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAi
RFBMTCAlZCBmYWlsZWQgdG8gbG9ja1xuIiwgcGlwZSk7Ci19Ci0KLXN0YXRpYyB2b2lkIHZsdl9l
bmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJICAgY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0g
Y3J0Yy0+cGlwZTsKLQotCWFzc2VydF9waXBlX2Rpc2FibGVkKGRldl9wcml2LCBwaXBlX2NvbmZp
Zy0+Y3B1X3RyYW5zY29kZXIpOwotCi0JLyogUExMIGlzIHByb3RlY3RlZCBieSBwYW5lbCwgbWFr
ZSBzdXJlIHdlIGNhbiB3cml0ZSBpdCAqLwotCWFzc2VydF9wYW5lbF91bmxvY2tlZChkZXZfcHJp
diwgcGlwZSk7Ci0KLQlpZiAocGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCAmIERQTExf
VkNPX0VOQUJMRSkKLQkJX3Zsdl9lbmFibGVfcGxsKGNydGMsIHBpcGVfY29uZmlnKTsKLQotCWlu
dGVsX2RlX3dyaXRlKGRldl9wcml2LCBEUExMX01EKHBpcGUpLAotCQkgICAgICAgcGlwZV9jb25m
aWctPmRwbGxfaHdfc3RhdGUuZHBsbF9tZCk7Ci0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9w
cml2LCBEUExMX01EKHBpcGUpKTsKLX0KLQotCi1zdGF0aWMgdm9pZCBfY2h2X2VuYWJsZV9wbGwo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKnBpcGVfY29uZmlnKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlw
ZTsKLQllbnVtIGRwaW9fY2hhbm5lbCBwb3J0ID0gdmx2X3BpcGVfdG9fY2hhbm5lbChwaXBlKTsK
LQl1MzIgdG1wOwotCi0Jdmx2X2RwaW9fZ2V0KGRldl9wcml2KTsKLQotCS8qIEVuYWJsZSBiYWNr
IHRoZSAxMGJpdCBjbG9jayB0byBkaXNwbGF5IGNvbnRyb2xsZXIgKi8KLQl0bXAgPSB2bHZfZHBp
b19yZWFkKGRldl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCkpOwotCXRtcCB8PSBEUElP
X0RDTEtQX0VOOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTQo
cG9ydCksIHRtcCk7Ci0KLQl2bHZfZHBpb19wdXQoZGV2X3ByaXYpOwotCi0JLyoKLQkgKiBOZWVk
IHRvIHdhaXQgPiAxMDBucyBiZXR3ZWVuIGRjbGtwIGNsb2NrIGVuYWJsZSBiaXQgYW5kIFBMTCBl
bmFibGUuCi0JICovCi0JdWRlbGF5KDEpOwotCi0JLyogRW5hYmxlIFBMTCAqLwotCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LCBEUExMKHBpcGUpLCBwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5k
cGxsKTsKLQotCS8qIENoZWNrIFBMTCBpcyBsb2NrZWQgKi8KLQlpZiAoaW50ZWxfZGVfd2FpdF9m
b3Jfc2V0KGRldl9wcml2LCBEUExMKHBpcGUpLCBEUExMX0xPQ0tfVkxWLCAxKSkKLQkJZHJtX2Vy
cigmZGV2X3ByaXYtPmRybSwgIlBMTCAlZCBmYWlsZWQgdG8gbG9ja1xuIiwgcGlwZSk7Ci19Ci0K
LXN0YXRpYyB2b2lkIGNodl9lbmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJ
ICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQotewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwot
CWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKLQotCWFzc2VydF9waXBlX2Rpc2FibGVkKGRl
dl9wcml2LCBwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpOwotCi0JLyogUExMIGlzIHByb3Rl
Y3RlZCBieSBwYW5lbCwgbWFrZSBzdXJlIHdlIGNhbiB3cml0ZSBpdCAqLwotCWFzc2VydF9wYW5l
bF91bmxvY2tlZChkZXZfcHJpdiwgcGlwZSk7Ci0KLQlpZiAocGlwZV9jb25maWctPmRwbGxfaHdf
c3RhdGUuZHBsbCAmIERQTExfVkNPX0VOQUJMRSkKLQkJX2Nodl9lbmFibGVfcGxsKGNydGMsIHBp
cGVfY29uZmlnKTsKLQotCWlmIChwaXBlICE9IFBJUEVfQSkgewotCQkvKgotCQkgKiBXYVBpeGVs
UmVwZWF0TW9kZUZpeEZvckMwOmNodgotCQkgKgotCQkgKiBEUExMQ01EIGlzIEFXT0wuIFVzZSBj
aGlja2VuIGJpdHMgdG8gcHJvcGFnYXRlCi0JCSAqIHRoZSB2YWx1ZSBmcm9tIERQTExCTUQgdG8g
ZWl0aGVyIHBpcGUgQiBvciBDLgotCQkgKi8KLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENC
UjRfVkxWLCBDQlJfRFBMTEJNRF9QSVBFKHBpcGUpKTsKLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIERQTExfTUQoUElQRV9CKSwKLQkJCSAgICAgICBwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0
ZS5kcGxsX21kKTsKLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENCUjRfVkxWLCAwKTsKLQkJ
ZGV2X3ByaXYtPmNodl9kcGxsX21kW3BpcGVdID0gcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUu
ZHBsbF9tZDsKLQotCQkvKgotCQkgKiBEUExMQiBWR0EgbW9kZSBhbHNvIHNlZW1zIHRvIGNhdXNl
IHByb2JsZW1zLgotCQkgKiBXZSBzaG91bGQgYWx3YXlzIGhhdmUgaXQgZGlzYWJsZWQuCi0JCSAq
LwotCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAoaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwgRFBMTChQSVBFX0IpKSAmCi0JCQkgICAgIERQTExfVkdBX01PREVfRElTKSA9PSAw
KTsKLQl9IGVsc2UgewotCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRFBMTF9NRChwaXBlKSwK
LQkJCSAgICAgICBwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsX21kKTsKLQkJaW50ZWxf
ZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEUExMX01EKHBpcGUpKTsKLQl9Ci19Ci0KLXN0YXRp
YyBib29sIGk5eHhfaGFzX3BwcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCi17
Ci0JaWYgKElTX0k4MzAoZGV2X3ByaXYpKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlyZXR1cm4gSVNf
UElORVZJRVcoZGV2X3ByaXYpIHx8IElTX01PQklMRShkZXZfcHJpdik7Ci19Ci0KLXN0YXRpYyB2
b2lkIGk5eHhfZW5hYmxlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJCSAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQlpOTE1X3Jl
Z190IHJlZyA9IERQTEwoY3J0Yy0+cGlwZSk7Ci0JdTMyIGRwbGwgPSBjcnRjX3N0YXRlLT5kcGxs
X2h3X3N0YXRlLmRwbGw7Ci0JaW50IGk7Ci0KLQlhc3NlcnRfcGlwZV9kaXNhYmxlZChkZXZfcHJp
diwgY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIpOwotCi0JLyogUExMIGlzIHByb3RlY3RlZCBi
eSBwYW5lbCwgbWFrZSBzdXJlIHdlIGNhbiB3cml0ZSBpdCAqLwotCWlmIChpOXh4X2hhc19wcHMo
ZGV2X3ByaXYpKQotCQlhc3NlcnRfcGFuZWxfdW5sb2NrZWQoZGV2X3ByaXYsIGNydGMtPnBpcGUp
OwotCi0JLyoKLQkgKiBBcHBhcmVudGx5IHdlIG5lZWQgdG8gaGF2ZSBWR0EgbW9kZSBlbmFibGVk
IHByaW9yIHRvIGNoYW5naW5nCi0JICogdGhlIFAxL1AyIGRpdmlkZXJzLiBPdGhlcndpc2UgdGhl
IERQTEwgd2lsbCBrZWVwIHVzaW5nIHRoZSBvbGQKLQkgKiBkaXZpZGVycywgZXZlbiB0aG91Z2gg
dGhlIHJlZ2lzdGVyIHZhbHVlIGRvZXMgY2hhbmdlLgotCSAqLwotCWludGVsX2RlX3dyaXRlKGRl
dl9wcml2LCByZWcsIGRwbGwgJiB+RFBMTF9WR0FfTU9ERV9ESVMpOwotCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCByZWcsIGRwbGwpOwotCi0JLyogV2FpdCBmb3IgdGhlIGNsb2NrcyB0byBzdGFi
aWxpemUuICovCi0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCByZWcpOwotCXVkZWxh
eSgxNTApOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkgewotCQlpbnRlbF9kZV93
cml0ZShkZXZfcHJpdiwgRFBMTF9NRChjcnRjLT5waXBlKSwKLQkJCSAgICAgICBjcnRjX3N0YXRl
LT5kcGxsX2h3X3N0YXRlLmRwbGxfbWQpOwotCX0gZWxzZSB7Ci0JCS8qIFRoZSBwaXhlbCBtdWx0
aXBsaWVyIGNhbiBvbmx5IGJlIHVwZGF0ZWQgb25jZSB0aGUKLQkJICogRFBMTCBpcyBlbmFibGVk
IGFuZCB0aGUgY2xvY2tzIGFyZSBzdGFibGUuCi0JCSAqCi0JCSAqIFNvIHdyaXRlIGl0IGFnYWlu
LgotCQkgKi8KLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIHJlZywgZHBsbCk7Ci0JfQotCi0J
LyogV2UgZG8gdGhpcyB0aHJlZSB0aW1lcyBmb3IgbHVjayAqLwotCWZvciAoaSA9IDA7IGkgPCAz
OyBpKyspIHsKLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIHJlZywgZHBsbCk7Ci0JCWludGVs
X2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgcmVnKTsKLQkJdWRlbGF5KDE1MCk7IC8qIHdhaXQg
Zm9yIHdhcm11cCAqLwotCX0KLX0KLQotc3RhdGljIHZvaWQgaTl4eF9kaXNhYmxlX3BsbChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
LQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7Ci0KLQkvKiBEb24ndCBkaXNhYmxlIHBpcGUg
b3IgcGlwZSBQTExzIGlmIG5lZWRlZCAqLwotCWlmIChJU19JODMwKGRldl9wcml2KSkKLQkJcmV0
dXJuOwotCi0JLyogTWFrZSBzdXJlIHRoZSBwaXBlIGlzbid0IHN0aWxsIHJlbHlpbmcgb24gdXMg
Ki8KLQlhc3NlcnRfcGlwZV9kaXNhYmxlZChkZXZfcHJpdiwgY3J0Y19zdGF0ZS0+Y3B1X3RyYW5z
Y29kZXIpOwotCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERQTEwocGlwZSksIERQTExfVkdB
X01PREVfRElTKTsKLQlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIERQTEwocGlwZSkp
OwotfQotCi1zdGF0aWMgdm9pZCB2bHZfZGlzYWJsZV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKLXsKLQl1MzIgdmFsOwotCi0JLyogTWFrZSBz
dXJlIHRoZSBwaXBlIGlzbid0IHN0aWxsIHJlbHlpbmcgb24gdXMgKi8KLQlhc3NlcnRfcGlwZV9k
aXNhYmxlZChkZXZfcHJpdiwgKGVudW0gdHJhbnNjb2RlcilwaXBlKTsKLQotCXZhbCA9IERQTExf
SU5URUdSQVRFRF9SRUZfQ0xLX1ZMViB8Ci0JCURQTExfUkVGX0NMS19FTkFCTEVfVkxWIHwgRFBM
TF9WR0FfTU9ERV9ESVM7Ci0JaWYgKHBpcGUgIT0gUElQRV9BKQotCQl2YWwgfD0gRFBMTF9JTlRF
R1JBVEVEX0NSSV9DTEtfVkxWOwotCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERQTEwocGlw
ZSksIHZhbCk7Ci0JaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEUExMKHBpcGUpKTsK
LX0KLQotc3RhdGljIHZvaWQgY2h2X2Rpc2FibGVfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCi17Ci0JZW51bSBkcGlvX2NoYW5uZWwgcG9ydCA9
IHZsdl9waXBlX3RvX2NoYW5uZWwocGlwZSk7Ci0JdTMyIHZhbDsKLQotCS8qIE1ha2Ugc3VyZSB0
aGUgcGlwZSBpc24ndCBzdGlsbCByZWx5aW5nIG9uIHVzICovCi0JYXNzZXJ0X3BpcGVfZGlzYWJs
ZWQoZGV2X3ByaXYsIChlbnVtIHRyYW5zY29kZXIpcGlwZSk7Ci0KLQl2YWwgPSBEUExMX1NTQ19S
RUZfQ0xLX0NIViB8Ci0JCURQTExfUkVGX0NMS19FTkFCTEVfVkxWIHwgRFBMTF9WR0FfTU9ERV9E
SVM7Ci0JaWYgKHBpcGUgIT0gUElQRV9BKQotCQl2YWwgfD0gRFBMTF9JTlRFR1JBVEVEX0NSSV9D
TEtfVkxWOwotCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERQTEwocGlwZSksIHZhbCk7Ci0J
aW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEUExMKHBpcGUpKTsKLQotCXZsdl9kcGlv
X2dldChkZXZfcHJpdik7Ci0KLQkvKiBEaXNhYmxlIDEwYml0IGNsb2NrIHRvIGRpc3BsYXkgY29u
dHJvbGxlciAqLwotCXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIENIVl9DTU5f
RFcxNChwb3J0KSk7Ci0JdmFsICY9IH5EUElPX0RDTEtQX0VOOwotCXZsdl9kcGlvX3dyaXRlKGRl
dl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCksIHZhbCk7Ci0KLQl2bHZfZHBpb19wdXQo
ZGV2X3ByaXYpOwotfQotCiB2b2lkIHZsdl93YWl0X3BvcnRfcmVhZHkoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCQkJIHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19w
b3J0LAogCQkJIHVuc2lnbmVkIGludCBleHBlY3RlZF9tYXNrKQpAQCAtNTcwOSwzNSArNTQ4Nyw2
IEBAIHN0YXRpYyB2b2lkIGludGVsX3BhbmVsX3Nhbml0aXplX3NzYyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMgdm9pZCB2bHZfcGxsYl9yZWNhbF9v
cGFtcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZQotCQlwaXBl
KQotewotCXUzMiByZWdfdmFsOwotCi0JLyoKLQkgKiBQTExCIG9wYW1wIGFsd2F5cyBjYWxpYnJh
dGVzIHRvIG1heCB2YWx1ZSBvZiAweDNmLCBmb3JjZSBlbmFibGUgaXQKLQkgKiBhbmQgc2V0IGl0
IHRvIGEgcmVhc29uYWJsZSB2YWx1ZSBpbnN0ZWFkLgotCSAqLwotCXJlZ192YWwgPSB2bHZfZHBp
b19yZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXOSgxKSk7Ci0JcmVnX3ZhbCAmPSAweGZm
ZmZmZjAwOwotCXJlZ192YWwgfD0gMHgwMDAwMDAzMDsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJp
diwgcGlwZSwgVkxWX1BMTF9EVzkoMSksIHJlZ192YWwpOwotCi0JcmVnX3ZhbCA9IHZsdl9kcGlv
X3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9SRUZfRFcxMyk7Ci0JcmVnX3ZhbCAmPSAweDAwZmZm
ZmZmOwotCXJlZ192YWwgfD0gMHg4YzAwMDAwMDsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwg
cGlwZSwgVkxWX1JFRl9EVzEzLCByZWdfdmFsKTsKLQotCXJlZ192YWwgPSB2bHZfZHBpb19yZWFk
KGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXOSgxKSk7Ci0JcmVnX3ZhbCAmPSAweGZmZmZmZjAw
OwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXOSgxKSwgcmVnX3Zh
bCk7Ci0KLQlyZWdfdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgVkxWX1JFRl9E
VzEzKTsKLQlyZWdfdmFsICY9IDB4MDBmZmZmZmY7Ci0JcmVnX3ZhbCB8PSAweGIwMDAwMDAwOwot
CXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUkVGX0RXMTMsIHJlZ192YWwpOwot
fQotCiBzdGF0aWMgdm9pZCBpbnRlbF9wY2hfdHJhbnNjb2Rlcl9zZXRfbV9uKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCQkgY29uc3Qgc3RydWN0IGludGVs
X2xpbmtfbV9uICptX24pCiB7CkBAIC01ODMzLDI2NyArNTU4Miw2IEBAIHZvaWQgaW50ZWxfZHBf
c2V0X21fbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwgZW51bSBs
aW5rX21fbl9zCiAJCWludGVsX2NwdV90cmFuc2NvZGVyX3NldF9tX24oY3J0Y19zdGF0ZSwgZHBf
bV9uLCBkcF9tMl9uMik7CiB9CiAKLXN0YXRpYyB2b2lkIHZsdl9wcmVwYXJlX3BsbChzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKLQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcpCi17Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQll
bnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7Ci0JdTMyIG1kaXY7Ci0JdTMyIGJlc3RuLCBiZXN0
bTEsIGJlc3RtMiwgYmVzdHAxLCBiZXN0cDI7Ci0JdTMyIGNvcmVjbGssIHJlZ192YWw7Ci0KLQkv
KiBFbmFibGUgUmVmY2xrICovCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERQTEwocGlwZSks
Ci0JCSAgICAgICBwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsICYgfihEUExMX1ZDT19F
TkFCTEUgfCBEUExMX0VYVF9CVUZGRVJfRU5BQkxFX1ZMVikpOwotCi0JLyogTm8gbmVlZCB0byBh
Y3R1YWxseSBzZXQgdXAgdGhlIERQTEwgd2l0aCBEU0kgKi8KLQlpZiAoKHBpcGVfY29uZmlnLT5k
cGxsX2h3X3N0YXRlLmRwbGwgJiBEUExMX1ZDT19FTkFCTEUpID09IDApCi0JCXJldHVybjsKLQot
CXZsdl9kcGlvX2dldChkZXZfcHJpdik7Ci0KLQliZXN0biA9IHBpcGVfY29uZmlnLT5kcGxsLm47
Ci0JYmVzdG0xID0gcGlwZV9jb25maWctPmRwbGwubTE7Ci0JYmVzdG0yID0gcGlwZV9jb25maWct
PmRwbGwubTI7Ci0JYmVzdHAxID0gcGlwZV9jb25maWctPmRwbGwucDE7Ci0JYmVzdHAyID0gcGlw
ZV9jb25maWctPmRwbGwucDI7Ci0KLQkvKiBTZWUgZURQIEhETUkgRFBJTyBkcml2ZXIgdmJpb3Mg
bm90ZXMgZG9jICovCi0KLQkvKiBQTEwgQiBuZWVkcyBzcGVjaWFsIGhhbmRsaW5nICovCi0JaWYg
KHBpcGUgPT0gUElQRV9CKQotCQl2bHZfcGxsYl9yZWNhbF9vcGFtcChkZXZfcHJpdiwgcGlwZSk7
Ci0KLQkvKiBTZXQgdXAgVHggdGFyZ2V0IGZvciBwZXJpb2RpYyBSY29tcCB1cGRhdGUgKi8KLQl2
bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzlfQkNBU1QsIDB4MDEwMDAw
MGYpOwotCi0JLyogRGlzYWJsZSB0YXJnZXQgSVJlZiBvbiBQTEwgKi8KLQlyZWdfdmFsID0gdmx2
X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzgocGlwZSkpOwotCXJlZ192YWwg
Jj0gMHgwMGZmZmZmZjsKLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9E
VzgocGlwZSksIHJlZ192YWwpOwotCi0JLyogRGlzYWJsZSBmYXN0IGxvY2sgKi8KLQl2bHZfZHBp
b193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX0NNTl9EVzAsIDB4NjEwKTsKLQotCS8qIFNldCBp
ZHRhZmNyZWNhbCBiZWZvcmUgUExMIGlzIGVuYWJsZWQgKi8KLQltZGl2ID0gKChiZXN0bTEgPDwg
RFBJT19NMURJVl9TSElGVCkgfCAoYmVzdG0yICYgRFBJT19NMkRJVl9NQVNLKSk7Ci0JbWRpdiB8
PSAoKGJlc3RwMSA8PCBEUElPX1AxX1NISUZUKSB8IChiZXN0cDIgPDwgRFBJT19QMl9TSElGVCkp
OwotCW1kaXYgfD0gKChiZXN0biA8PCBEUElPX05fU0hJRlQpKTsKLQltZGl2IHw9ICgxIDw8IERQ
SU9fS19TSElGVCk7Ci0KLQkvKgotCSAqIFBvc3QgZGl2aWRlciBkZXBlbmRzIG9uIHBpeGVsIGNs
b2NrIHJhdGUsIERBQyB2cyBkaWdpdGFsIChhbmQgTFZEUywKLQkgKiBidXQgd2UgZG9uJ3Qgc3Vw
cG9ydCB0aGF0KS4KLQkgKiBOb3RlOiBkb24ndCB1c2UgdGhlIERBQyBwb3N0IGRpdmlkZXIgYXMg
aXQgc2VlbXMgdW5zdGFibGUuCi0JICovCi0JbWRpdiB8PSAoRFBJT19QT1NUX0RJVl9IRE1JRFAg
PDwgRFBJT19QT1NUX0RJVl9TSElGVCk7Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUs
IFZMVl9QTExfRFczKHBpcGUpLCBtZGl2KTsKLQotCW1kaXYgfD0gRFBJT19FTkFCTEVfQ0FMSUJS
QVRJT047Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFczKHBpcGUp
LCBtZGl2KTsKLQotCS8qIFNldCBIQlIgYW5kIFJCUiBMUEYgY29lZmZpY2llbnRzICovCi0JaWYg
KHBpcGVfY29uZmlnLT5wb3J0X2Nsb2NrID09IDE2MjAwMCB8fAotCSAgICBpbnRlbF9jcnRjX2hh
c190eXBlKHBpcGVfY29uZmlnLCBJTlRFTF9PVVRQVVRfQU5BTE9HKSB8fAotCSAgICBpbnRlbF9j
cnRjX2hhc190eXBlKHBpcGVfY29uZmlnLCBJTlRFTF9PVVRQVVRfSERNSSkpCi0JCXZsdl9kcGlv
X3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXMTAocGlwZSksCi0JCQkJIDB4MDA5ZjAw
MDMpOwotCWVsc2UKLQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFcx
MChwaXBlKSwKLQkJCQkgMHgwMGQwMDAwZik7Ci0KLQlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5j
b2RlcihwaXBlX2NvbmZpZykpIHsKLQkJLyogVXNlIFNTQyBzb3VyY2UgKi8KLQkJaWYgKHBpcGUg
PT0gUElQRV9BKQotCQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc1
KHBpcGUpLAotCQkJCQkgMHgwZGY0MDAwMCk7Ci0JCWVsc2UKLQkJCXZsdl9kcGlvX3dyaXRlKGRl
dl9wcml2LCBwaXBlLCBWTFZfUExMX0RXNShwaXBlKSwKLQkJCQkJIDB4MGRmNzAwMDApOwotCX0g
ZWxzZSB7IC8qIEhETUkgb3IgVkdBICovCi0JCS8qIFVzZSBiZW5kIHNvdXJjZSAqLwotCQlpZiAo
cGlwZSA9PSBQSVBFX0EpCi0JCQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BM
TF9EVzUocGlwZSksCi0JCQkJCSAweDBkZjcwMDAwKTsKLQkJZWxzZQotCQkJdmx2X2RwaW9fd3Jp
dGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc1KHBpcGUpLAotCQkJCQkgMHgwZGY0MDAwMCk7
Ci0JfQotCi0JY29yZWNsayA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExf
RFc3KHBpcGUpKTsKLQljb3JlY2xrID0gKGNvcmVjbGsgJiAweDAwMDBmZjAwKSB8IDB4MDFjMDAw
MDA7Ci0JaWYgKGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIocGlwZV9jb25maWcpKQotCQljb3Jl
Y2xrIHw9IDB4MDEwMDAwMDA7Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9Q
TExfRFc3KHBpcGUpLCBjb3JlY2xrKTsKLQotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBl
LCBWTFZfUExMX0RXMTEocGlwZSksIDB4ODc4NzEwMDApOwotCi0Jdmx2X2RwaW9fcHV0KGRldl9w
cml2KTsKLX0KLQotc3RhdGljIHZvaWQgY2h2X3ByZXBhcmVfcGxsKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAotCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZykKLXsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCWVudW0gcGlwZSBw
aXBlID0gY3J0Yy0+cGlwZTsKLQllbnVtIGRwaW9fY2hhbm5lbCBwb3J0ID0gdmx2X3BpcGVfdG9f
Y2hhbm5lbChwaXBlKTsKLQl1MzIgbG9vcGZpbHRlciwgdHJpYnVmX2NhbGNudHI7Ci0JdTMyIGJl
c3RuLCBiZXN0bTEsIGJlc3RtMiwgYmVzdHAxLCBiZXN0cDIsIGJlc3RtMl9mcmFjOwotCXUzMiBk
cGlvX3ZhbDsKLQlpbnQgdmNvOwotCi0JLyogRW5hYmxlIFJlZmNsayBhbmQgU1NDICovCi0JaW50
ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERQTEwocGlwZSksCi0JCSAgICAgICBwaXBlX2NvbmZpZy0+
ZHBsbF9od19zdGF0ZS5kcGxsICYgfkRQTExfVkNPX0VOQUJMRSk7Ci0KLQkvKiBObyBuZWVkIHRv
IGFjdHVhbGx5IHNldCB1cCB0aGUgRFBMTCB3aXRoIERTSSAqLwotCWlmICgocGlwZV9jb25maWct
PmRwbGxfaHdfc3RhdGUuZHBsbCAmIERQTExfVkNPX0VOQUJMRSkgPT0gMCkKLQkJcmV0dXJuOwot
Ci0JYmVzdG4gPSBwaXBlX2NvbmZpZy0+ZHBsbC5uOwotCWJlc3RtMl9mcmFjID0gcGlwZV9jb25m
aWctPmRwbGwubTIgJiAweDNmZmZmZjsKLQliZXN0bTEgPSBwaXBlX2NvbmZpZy0+ZHBsbC5tMTsK
LQliZXN0bTIgPSBwaXBlX2NvbmZpZy0+ZHBsbC5tMiA+PiAyMjsKLQliZXN0cDEgPSBwaXBlX2Nv
bmZpZy0+ZHBsbC5wMTsKLQliZXN0cDIgPSBwaXBlX2NvbmZpZy0+ZHBsbC5wMjsKLQl2Y28gPSBw
aXBlX2NvbmZpZy0+ZHBsbC52Y287Ci0JZHBpb192YWwgPSAwOwotCWxvb3BmaWx0ZXIgPSAwOwot
Ci0Jdmx2X2RwaW9fZ2V0KGRldl9wcml2KTsKLQotCS8qIHAxIGFuZCBwMiBkaXZpZGVyICovCi0J
dmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9DTU5fRFcxMyhwb3J0KSwKLQkJCTUg
PDwgRFBJT19DSFZfUzFfRElWX1NISUZUIHwKLQkJCWJlc3RwMSA8PCBEUElPX0NIVl9QMV9ESVZf
U0hJRlQgfAotCQkJYmVzdHAyIDw8IERQSU9fQ0hWX1AyX0RJVl9TSElGVCB8Ci0JCQkxIDw8IERQ
SU9fQ0hWX0tfRElWX1NISUZUKTsKLQotCS8qIEZlZWRiYWNrIHBvc3QtZGl2aWRlciAtIG0yICov
Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9QTExfRFcwKHBvcnQpLCBiZXN0
bTIpOwotCi0JLyogRmVlZGJhY2sgcmVmY2xrIGRpdmlkZXIgLSBuIGFuZCBtMSAqLwotCXZsdl9k
cGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXMShwb3J0KSwKLQkJCURQSU9fQ0hW
X00xX0RJVl9CWV8yIHwKLQkJCTEgPDwgRFBJT19DSFZfTl9ESVZfU0hJRlQpOwotCi0JLyogTTIg
ZnJhY3Rpb24gZGl2aXNpb24gKi8KLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgQ0hW
X1BMTF9EVzIocG9ydCksIGJlc3RtMl9mcmFjKTsKLQotCS8qIE0yIGZyYWN0aW9uIGRpdmlzaW9u
IGVuYWJsZSAqLwotCWRwaW9fdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hW
X1BMTF9EVzMocG9ydCkpOwotCWRwaW9fdmFsICY9IH4oRFBJT19DSFZfRkVFREZXRF9HQUlOX01B
U0sgfCBEUElPX0NIVl9GUkFDX0RJVl9FTik7Ci0JZHBpb192YWwgfD0gKDIgPDwgRFBJT19DSFZf
RkVFREZXRF9HQUlOX1NISUZUKTsKLQlpZiAoYmVzdG0yX2ZyYWMpCi0JCWRwaW9fdmFsIHw9IERQ
SU9fQ0hWX0ZSQUNfRElWX0VOOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZf
UExMX0RXMyhwb3J0KSwgZHBpb192YWwpOwotCi0JLyogUHJvZ3JhbSBkaWdpdGFsIGxvY2sgZGV0
ZWN0IHRocmVzaG9sZCAqLwotCWRwaW9fdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlw
ZSwgQ0hWX1BMTF9EVzkocG9ydCkpOwotCWRwaW9fdmFsICY9IH4oRFBJT19DSFZfSU5UX0xPQ0tf
VEhSRVNIT0xEX01BU0sgfAotCQkJCQlEUElPX0NIVl9JTlRfTE9DS19USFJFU0hPTERfU0VMX0NP
QVJTRSk7Ci0JZHBpb192YWwgfD0gKDB4NSA8PCBEUElPX0NIVl9JTlRfTE9DS19USFJFU0hPTERf
U0hJRlQpOwotCWlmICghYmVzdG0yX2ZyYWMpCi0JCWRwaW9fdmFsIHw9IERQSU9fQ0hWX0lOVF9M
T0NLX1RIUkVTSE9MRF9TRUxfQ09BUlNFOwotCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBl
LCBDSFZfUExMX0RXOShwb3J0KSwgZHBpb192YWwpOwotCi0JLyogTG9vcCBmaWx0ZXIgKi8KLQlp
ZiAodmNvID09IDU0MDAwMDApIHsKLQkJbG9vcGZpbHRlciB8PSAoMHgzIDw8IERQSU9fQ0hWX1BS
T1BfQ09FRkZfU0hJRlQpOwotCQlsb29wZmlsdGVyIHw9ICgweDggPDwgRFBJT19DSFZfSU5UX0NP
RUZGX1NISUZUKTsKLQkJbG9vcGZpbHRlciB8PSAoMHgxIDw8IERQSU9fQ0hWX0dBSU5fQ1RSTF9T
SElGVCk7Ci0JCXRyaWJ1Zl9jYWxjbnRyID0gMHg5OwotCX0gZWxzZSBpZiAodmNvIDw9IDYyMDAw
MDApIHsKLQkJbG9vcGZpbHRlciB8PSAoMHg1IDw8IERQSU9fQ0hWX1BST1BfQ09FRkZfU0hJRlQp
OwotCQlsb29wZmlsdGVyIHw9ICgweEIgPDwgRFBJT19DSFZfSU5UX0NPRUZGX1NISUZUKTsKLQkJ
bG9vcGZpbHRlciB8PSAoMHgzIDw8IERQSU9fQ0hWX0dBSU5fQ1RSTF9TSElGVCk7Ci0JCXRyaWJ1
Zl9jYWxjbnRyID0gMHg5OwotCX0gZWxzZSBpZiAodmNvIDw9IDY0ODAwMDApIHsKLQkJbG9vcGZp
bHRlciB8PSAoMHg0IDw8IERQSU9fQ0hWX1BST1BfQ09FRkZfU0hJRlQpOwotCQlsb29wZmlsdGVy
IHw9ICgweDkgPDwgRFBJT19DSFZfSU5UX0NPRUZGX1NISUZUKTsKLQkJbG9vcGZpbHRlciB8PSAo
MHgzIDw8IERQSU9fQ0hWX0dBSU5fQ1RSTF9TSElGVCk7Ci0JCXRyaWJ1Zl9jYWxjbnRyID0gMHg4
OwotCX0gZWxzZSB7Ci0JCS8qIE5vdCBzdXBwb3J0ZWQuIEFwcGx5IHRoZSBzYW1lIGxpbWl0cyBh
cyBpbiB0aGUgbWF4IGNhc2UgKi8KLQkJbG9vcGZpbHRlciB8PSAoMHg0IDw8IERQSU9fQ0hWX1BS
T1BfQ09FRkZfU0hJRlQpOwotCQlsb29wZmlsdGVyIHw9ICgweDkgPDwgRFBJT19DSFZfSU5UX0NP
RUZGX1NISUZUKTsKLQkJbG9vcGZpbHRlciB8PSAoMHgzIDw8IERQSU9fQ0hWX0dBSU5fQ1RSTF9T
SElGVCk7Ci0JCXRyaWJ1Zl9jYWxjbnRyID0gMDsKLQl9Ci0Jdmx2X2RwaW9fd3JpdGUoZGV2X3By
aXYsIHBpcGUsIENIVl9QTExfRFc2KHBvcnQpLCBsb29wZmlsdGVyKTsKLQotCWRwaW9fdmFsID0g
dmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX1BMTF9EVzgocG9ydCkpOwotCWRwaW9f
dmFsICY9IH5EUElPX0NIVl9URENfVEFSR0VUX0NOVF9NQVNLOwotCWRwaW9fdmFsIHw9ICh0cmli
dWZfY2FsY250ciA8PCBEUElPX0NIVl9URENfVEFSR0VUX0NOVF9TSElGVCk7Ci0Jdmx2X2RwaW9f
d3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9QTExfRFc4KHBvcnQpLCBkcGlvX3ZhbCk7Ci0KLQkv
KiBBRkMgUmVjYWwgKi8KLQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgQ0hWX0NNTl9E
VzE0KHBvcnQpLAotCQkJdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX0NNTl9EVzE0
KHBvcnQpKSB8Ci0JCQlEUElPX0FGQ19SRUNBTCk7Ci0KLQl2bHZfZHBpb19wdXQoZGV2X3ByaXYp
OwotfQotCi0vKioKLSAqIHZsdl9mb3JjZV9wbGxfb24gLSBmb3JjaWJseSBlbmFibGUganVzdCB0
aGUgUExMCi0gKiBAZGV2X3ByaXY6IGk5MTUgcHJpdmF0ZSBzdHJ1Y3R1cmUKLSAqIEBwaXBlOiBw
aXBlIFBMTCB0byBlbmFibGUKLSAqIEBkcGxsOiBQTEwgY29uZmlndXJhdGlvbgotICoKLSAqIEVu
YWJsZSB0aGUgUExMIGZvciBAcGlwZSB1c2luZyB0aGUgc3VwcGxpZWQgQGRwbGwgY29uZmlnLiBU
byBiZSB1c2VkCi0gKiBpbiBjYXNlcyB3aGVyZSB3ZSBuZWVkIHRoZSBQTEwgZW5hYmxlZCBldmVu
IHdoZW4gQHBpcGUgaXMgbm90IGdvaW5nIHRvCi0gKiBiZSBlbmFibGVkLgotICovCi1pbnQgdmx2
X2ZvcmNlX3BsbF9vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlw
ZSBwaXBlLAotCQkgICAgIGNvbnN0IHN0cnVjdCBkcGxsICpkcGxsKQotewotCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOwot
CXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZzsKLQotCXBpcGVfY29uZmlnID0g
aW50ZWxfY3J0Y19zdGF0ZV9hbGxvYyhjcnRjKTsKLQlpZiAoIXBpcGVfY29uZmlnKQotCQlyZXR1
cm4gLUVOT01FTTsKLQotCXBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciA9IChlbnVtIHRyYW5z
Y29kZXIpcGlwZTsKLQlwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllciA9IDE7Ci0JcGlwZV9j
b25maWctPmRwbGwgPSAqZHBsbDsKLQotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgewot
CQljaHZfY29tcHV0ZV9kcGxsKGNydGMsIHBpcGVfY29uZmlnKTsKLQkJY2h2X3ByZXBhcmVfcGxs
KGNydGMsIHBpcGVfY29uZmlnKTsKLQkJY2h2X2VuYWJsZV9wbGwoY3J0YywgcGlwZV9jb25maWcp
OwotCX0gZWxzZSB7Ci0JCXZsdl9jb21wdXRlX2RwbGwoY3J0YywgcGlwZV9jb25maWcpOwotCQl2
bHZfcHJlcGFyZV9wbGwoY3J0YywgcGlwZV9jb25maWcpOwotCQl2bHZfZW5hYmxlX3BsbChjcnRj
LCBwaXBlX2NvbmZpZyk7Ci0JfQotCi0Ja2ZyZWUocGlwZV9jb25maWcpOwotCi0JcmV0dXJuIDA7
Ci19Ci0KLS8qKgotICogdmx2X2ZvcmNlX3BsbF9vZmYgLSBmb3JjaWJseSBkaXNhYmxlIGp1c3Qg
dGhlIFBMTAotICogQGRldl9wcml2OiBpOTE1IHByaXZhdGUgc3RydWN0dXJlCi0gKiBAcGlwZTog
cGlwZSBQTEwgdG8gZGlzYWJsZQotICoKLSAqIERpc2FibGUgdGhlIFBMTCBmb3IgQHBpcGUuIFRv
IGJlIHVzZWQgaW4gY2FzZXMgd2hlcmUgd2UgbmVlZAotICogdGhlIFBMTCBlbmFibGVkIGV2ZW4g
d2hlbiBAcGlwZSBpcyBub3QgZ29pbmcgdG8gYmUgZW5hYmxlZC4KLSAqLwotdm9pZCB2bHZfZm9y
Y2VfcGxsX29mZihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBw
aXBlKQotewotCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKLQkJY2h2X2Rpc2FibGVfcGxs
KGRldl9wcml2LCBwaXBlKTsKLQllbHNlCi0JCXZsdl9kaXNhYmxlX3BsbChkZXZfcHJpdiwgcGlw
ZSk7Ci19Ci0KLQotCiBzdGF0aWMgdm9pZCBpbnRlbF9zZXRfdHJhbnNjb2Rlcl90aW1pbmdzKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaAppbmRleCBmNDIxNGUx
NjFhOWQuLjFjYzEwNzNhOGY2NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmgKQEAgLTU4Niw5ICs1ODYsNiBAQCB2b2lkIGludGVsX2NsZWFudXBfcGxh
bmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiB2b2lkIGFzc2VydF9wY2hfdHJhbnNjb2Rl
cl9kaXNhYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICAgIGVu
dW0gcGlwZSBwaXBlKTsKIAotaW50IHZsdl9mb3JjZV9wbGxfb24oc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSwKLQkJICAgICBjb25zdCBzdHJ1Y3QgZHBs
bCAqZHBsbCk7Ci12b2lkIHZsdl9mb3JjZV9wbGxfb2ZmKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpOwogaW50IGxwdF9nZXRfaWNsa2lwKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBib29sIGludGVsX2Z1enp5X2Nsb2NrX2NoZWNr
KGludCBjbG9jazEsIGludCBjbG9jazIpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RwLmMKaW5kZXggZWM5NGViZGFmN2I4Li5lZGIwMzhjYzdjZDEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKQEAgLTUwLDYgKzUwLDcgQEAKICNpbmNsdWRlICJp
bnRlbF9kcC5oIgogI2luY2x1ZGUgImludGVsX2RwX2xpbmtfdHJhaW5pbmcuaCIKICNpbmNsdWRl
ICJpbnRlbF9kcF9tc3QuaCIKKyNpbmNsdWRlICJpbnRlbF9kcGxsLmgiCiAjaW5jbHVkZSAiaW50
ZWxfZHBpb19waHkuaCIKICNpbmNsdWRlICJpbnRlbF9maWZvX3VuZGVycnVuLmgiCiAjaW5jbHVk
ZSAiaW50ZWxfaGRjcC5oIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kcGxsLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwbGwu
YwppbmRleCA3YmE3ZjMxNWFhZWUuLjE2NmU5YTNhOGMwOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcGxsLmMKQEAgLTMsMTEgKzMsMTMgQEAKICAqIENvcHlyaWdodCDC
qSAyMDIwIEludGVsIENvcnBvcmF0aW9uCiAgKi8KICNpbmNsdWRlIDxsaW51eC9rZXJuZWwuaD4K
KyNpbmNsdWRlICJpbnRlbF9jcnRjLmgiCiAjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV90eXBlcy5o
IgogI2luY2x1ZGUgImludGVsX2Rpc3BsYXkuaCIKICNpbmNsdWRlICJpbnRlbF9kcGxsLmgiCiAj
aW5jbHVkZSAiaW50ZWxfbHZkcy5oIgogI2luY2x1ZGUgImludGVsX3BhbmVsLmgiCisjaW5jbHVk
ZSAiaW50ZWxfc2lkZWJhbmQuaCIKIAogc3RydWN0IGludGVsX2xpbWl0IHsKIAlzdHJ1Y3QgewpA
QCAtMTM2MSwzICsxMzYzLDUxMCBAQCBpbnRlbF9kcGxsX2luaXRfY2xvY2tfaG9vayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJZWxzZQogCQlkZXZfcHJpdi0+ZGlzcGxheS5j
cnRjX2NvbXB1dGVfY2xvY2sgPSBpOHh4X2NydGNfY29tcHV0ZV9jbG9jazsKIH0KKworc3RhdGlj
IGJvb2wgaTl4eF9oYXNfcHBzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3sK
KwlpZiAoSVNfSTgzMChkZXZfcHJpdikpCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiBJU19Q
SU5FVklFVyhkZXZfcHJpdikgfHwgSVNfTU9CSUxFKGRldl9wcml2KTsKK30KKwordm9pZCBpOXh4
X2VuYWJsZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCSAgICAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJaTkxNV9yZWdfdCByZWcg
PSBEUExMKGNydGMtPnBpcGUpOworCXUzMiBkcGxsID0gY3J0Y19zdGF0ZS0+ZHBsbF9od19zdGF0
ZS5kcGxsOworCWludCBpOworCisJYXNzZXJ0X3BpcGVfZGlzYWJsZWQoZGV2X3ByaXYsIGNydGNf
c3RhdGUtPmNwdV90cmFuc2NvZGVyKTsKKworCS8qIFBMTCBpcyBwcm90ZWN0ZWQgYnkgcGFuZWws
IG1ha2Ugc3VyZSB3ZSBjYW4gd3JpdGUgaXQgKi8KKwlpZiAoaTl4eF9oYXNfcHBzKGRldl9wcml2
KSkKKwkJYXNzZXJ0X3BhbmVsX3VubG9ja2VkKGRldl9wcml2LCBjcnRjLT5waXBlKTsKKworCS8q
CisJICogQXBwYXJlbnRseSB3ZSBuZWVkIHRvIGhhdmUgVkdBIG1vZGUgZW5hYmxlZCBwcmlvciB0
byBjaGFuZ2luZworCSAqIHRoZSBQMS9QMiBkaXZpZGVycy4gT3RoZXJ3aXNlIHRoZSBEUExMIHdp
bGwga2VlcCB1c2luZyB0aGUgb2xkCisJICogZGl2aWRlcnMsIGV2ZW4gdGhvdWdoIHRoZSByZWdp
c3RlciB2YWx1ZSBkb2VzIGNoYW5nZS4KKwkgKi8KKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwg
cmVnLCBkcGxsICYgfkRQTExfVkdBX01PREVfRElTKTsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgcmVnLCBkcGxsKTsKKworCS8qIFdhaXQgZm9yIHRoZSBjbG9ja3MgdG8gc3RhYmlsaXplLiAq
LworCWludGVsX2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgcmVnKTsKKwl1ZGVsYXkoMTUwKTsK
KworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDQpIHsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2
X3ByaXYsIERQTExfTUQoY3J0Yy0+cGlwZSksCisJCQkgICAgICAgY3J0Y19zdGF0ZS0+ZHBsbF9o
d19zdGF0ZS5kcGxsX21kKTsKKwl9IGVsc2UgeworCQkvKiBUaGUgcGl4ZWwgbXVsdGlwbGllciBj
YW4gb25seSBiZSB1cGRhdGVkIG9uY2UgdGhlCisJCSAqIERQTEwgaXMgZW5hYmxlZCBhbmQgdGhl
IGNsb2NrcyBhcmUgc3RhYmxlLgorCQkgKgorCQkgKiBTbyB3cml0ZSBpdCBhZ2Fpbi4KKwkJICov
CisJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCByZWcsIGRwbGwpOworCX0KKworCS8qIFdlIGRv
IHRoaXMgdGhyZWUgdGltZXMgZm9yIGx1Y2sgKi8KKwlmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7
CisJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCByZWcsIGRwbGwpOworCQlpbnRlbF9kZV9wb3N0
aW5nX3JlYWQoZGV2X3ByaXYsIHJlZyk7CisJCXVkZWxheSgxNTApOyAvKiB3YWl0IGZvciB3YXJt
dXAgKi8KKwl9Cit9CisKK3N0YXRpYyB2b2lkIHZsdl9wbGxiX3JlY2FsX29wYW1wKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkgZW51bSBwaXBlIHBpcGUpCit7CisJdTMy
IHJlZ192YWw7CisKKwkvKgorCSAqIFBMTEIgb3BhbXAgYWx3YXlzIGNhbGlicmF0ZXMgdG8gbWF4
IHZhbHVlIG9mIDB4M2YsIGZvcmNlIGVuYWJsZSBpdAorCSAqIGFuZCBzZXQgaXQgdG8gYSByZWFz
b25hYmxlIHZhbHVlIGluc3RlYWQuCisJICovCisJcmVnX3ZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2
X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc5KDEpKTsKKwlyZWdfdmFsICY9IDB4ZmZmZmZmMDA7CisJ
cmVnX3ZhbCB8PSAweDAwMDAwMDMwOworCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBW
TFZfUExMX0RXOSgxKSwgcmVnX3ZhbCk7CisKKwlyZWdfdmFsID0gdmx2X2RwaW9fcmVhZChkZXZf
cHJpdiwgcGlwZSwgVkxWX1JFRl9EVzEzKTsKKwlyZWdfdmFsICY9IDB4MDBmZmZmZmY7CisJcmVn
X3ZhbCB8PSAweDhjMDAwMDAwOworCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZf
UkVGX0RXMTMsIHJlZ192YWwpOworCisJcmVnX3ZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2X3ByaXYs
IHBpcGUsIFZMVl9QTExfRFc5KDEpKTsKKwlyZWdfdmFsICY9IDB4ZmZmZmZmMDA7CisJdmx2X2Rw
aW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc5KDEpLCByZWdfdmFsKTsKKworCXJl
Z192YWwgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUkVGX0RXMTMpOworCXJl
Z192YWwgJj0gMHgwMGZmZmZmZjsKKwlyZWdfdmFsIHw9IDB4YjAwMDAwMDA7CisJdmx2X2RwaW9f
d3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9SRUZfRFcxMywgcmVnX3ZhbCk7Cit9CisKK3N0YXRp
YyB2b2lkIF92bHZfZW5hYmxlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCSAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJZW51
bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOworCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERQ
TEwocGlwZSksIHBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlLmRwbGwpOworCWludGVsX2RlX3Bv
c3RpbmdfcmVhZChkZXZfcHJpdiwgRFBMTChwaXBlKSk7CisJdWRlbGF5KDE1MCk7CisKKwlpZiAo
aW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2LCBEUExMKHBpcGUpLCBEUExMX0xPQ0tfVkxW
LCAxKSkKKwkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwgIkRQTEwgJWQgZmFpbGVkIHRvIGxvY2tc
biIsIHBpcGUpOworfQorCit2b2lkIHZsdl9lbmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLAorCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQor
eworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOworCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKKworCWFzc2VydF9waXBlX2Rp
c2FibGVkKGRldl9wcml2LCBwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpOworCisJLyogUExM
IGlzIHByb3RlY3RlZCBieSBwYW5lbCwgbWFrZSBzdXJlIHdlIGNhbiB3cml0ZSBpdCAqLworCWFz
c2VydF9wYW5lbF91bmxvY2tlZChkZXZfcHJpdiwgcGlwZSk7CisKKwlpZiAocGlwZV9jb25maWct
PmRwbGxfaHdfc3RhdGUuZHBsbCAmIERQTExfVkNPX0VOQUJMRSkKKwkJX3Zsdl9lbmFibGVfcGxs
KGNydGMsIHBpcGVfY29uZmlnKTsKKworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBEUExMX01E
KHBpcGUpLAorCQkgICAgICAgcGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbF9tZCk7CisJ
aW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEUExMX01EKHBpcGUpKTsKK30KKworCitz
dGF0aWMgdm9pZCBfY2h2X2VuYWJsZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkg
ICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwor
CWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKKwllbnVtIGRwaW9fY2hhbm5lbCBwb3J0ID0g
dmx2X3BpcGVfdG9fY2hhbm5lbChwaXBlKTsKKwl1MzIgdG1wOworCisJdmx2X2RwaW9fZ2V0KGRl
dl9wcml2KTsKKworCS8qIEVuYWJsZSBiYWNrIHRoZSAxMGJpdCBjbG9jayB0byBkaXNwbGF5IGNv
bnRyb2xsZXIgKi8KKwl0bXAgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBDSFZfQ01O
X0RXMTQocG9ydCkpOworCXRtcCB8PSBEUElPX0RDTEtQX0VOOworCXZsdl9kcGlvX3dyaXRlKGRl
dl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCksIHRtcCk7CisKKwl2bHZfZHBpb19wdXQo
ZGV2X3ByaXYpOworCisJLyoKKwkgKiBOZWVkIHRvIHdhaXQgPiAxMDBucyBiZXR3ZWVuIGRjbGtw
IGNsb2NrIGVuYWJsZSBiaXQgYW5kIFBMTCBlbmFibGUuCisJICovCisJdWRlbGF5KDEpOworCisJ
LyogRW5hYmxlIFBMTCAqLworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBEUExMKHBpcGUpLCBw
aXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsKTsKKworCS8qIENoZWNrIFBMTCBpcyBsb2Nr
ZWQgKi8KKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2LCBEUExMKHBpcGUpLCBE
UExMX0xPQ0tfVkxWLCAxKSkKKwkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwgIlBMTCAlZCBmYWls
ZWQgdG8gbG9ja1xuIiwgcGlwZSk7Cit9CisKK3ZvaWQgY2h2X2VuYWJsZV9wbGwoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCisJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CisJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOworCisJYXNz
ZXJ0X3BpcGVfZGlzYWJsZWQoZGV2X3ByaXYsIHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2Rlcik7
CisKKwkvKiBQTEwgaXMgcHJvdGVjdGVkIGJ5IHBhbmVsLCBtYWtlIHN1cmUgd2UgY2FuIHdyaXRl
IGl0ICovCisJYXNzZXJ0X3BhbmVsX3VubG9ja2VkKGRldl9wcml2LCBwaXBlKTsKKworCWlmIChw
aXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsICYgRFBMTF9WQ09fRU5BQkxFKQorCQlfY2h2
X2VuYWJsZV9wbGwoY3J0YywgcGlwZV9jb25maWcpOworCisJaWYgKHBpcGUgIT0gUElQRV9BKSB7
CisJCS8qCisJCSAqIFdhUGl4ZWxSZXBlYXRNb2RlRml4Rm9yQzA6Y2h2CisJCSAqCisJCSAqIERQ
TExDTUQgaXMgQVdPTC4gVXNlIGNoaWNrZW4gYml0cyB0byBwcm9wYWdhdGUKKwkJICogdGhlIHZh
bHVlIGZyb20gRFBMTEJNRCB0byBlaXRoZXIgcGlwZSBCIG9yIEMuCisJCSAqLworCQlpbnRlbF9k
ZV93cml0ZShkZXZfcHJpdiwgQ0JSNF9WTFYsIENCUl9EUExMQk1EX1BJUEUocGlwZSkpOworCQlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRFBMTF9NRChQSVBFX0IpLAorCQkJICAgICAgIHBpcGVf
Y29uZmlnLT5kcGxsX2h3X3N0YXRlLmRwbGxfbWQpOworCQlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgQ0JSNF9WTFYsIDApOworCQlkZXZfcHJpdi0+Y2h2X2RwbGxfbWRbcGlwZV0gPSBwaXBlX2Nv
bmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsX21kOworCisJCS8qCisJCSAqIERQTExCIFZHQSBtb2Rl
IGFsc28gc2VlbXMgdG8gY2F1c2UgcHJvYmxlbXMuCisJCSAqIFdlIHNob3VsZCBhbHdheXMgaGF2
ZSBpdCBkaXNhYmxlZC4KKwkJICovCisJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAorCQkJ
ICAgIChpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBEUExMKFBJUEVfQikpICYKKwkJCSAgICAgRFBM
TF9WR0FfTU9ERV9ESVMpID09IDApOworCX0gZWxzZSB7CisJCWludGVsX2RlX3dyaXRlKGRldl9w
cml2LCBEUExMX01EKHBpcGUpLAorCQkJICAgICAgIHBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRl
LmRwbGxfbWQpOworCQlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIERQTExfTUQocGlw
ZSkpOworCX0KK30KKwordm9pZCB2bHZfcHJlcGFyZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNy
dGMsCisJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQor
eworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJZW51bSBwaXBlIHBpcGUg
PSBjcnRjLT5waXBlOworCXUzMiBtZGl2OworCXUzMiBiZXN0biwgYmVzdG0xLCBiZXN0bTIsIGJl
c3RwMSwgYmVzdHAyOworCXUzMiBjb3JlY2xrLCByZWdfdmFsOworCisJLyogRW5hYmxlIFJlZmNs
ayAqLworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBEUExMKHBpcGUpLAorCQkgICAgICAgcGlw
ZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCAmIH4oRFBMTF9WQ09fRU5BQkxFIHwgRFBMTF9F
WFRfQlVGRkVSX0VOQUJMRV9WTFYpKTsKKworCS8qIE5vIG5lZWQgdG8gYWN0dWFsbHkgc2V0IHVw
IHRoZSBEUExMIHdpdGggRFNJICovCisJaWYgKChwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5k
cGxsICYgRFBMTF9WQ09fRU5BQkxFKSA9PSAwKQorCQlyZXR1cm47CisKKwl2bHZfZHBpb19nZXQo
ZGV2X3ByaXYpOworCisJYmVzdG4gPSBwaXBlX2NvbmZpZy0+ZHBsbC5uOworCWJlc3RtMSA9IHBp
cGVfY29uZmlnLT5kcGxsLm0xOworCWJlc3RtMiA9IHBpcGVfY29uZmlnLT5kcGxsLm0yOworCWJl
c3RwMSA9IHBpcGVfY29uZmlnLT5kcGxsLnAxOworCWJlc3RwMiA9IHBpcGVfY29uZmlnLT5kcGxs
LnAyOworCisJLyogU2VlIGVEUCBIRE1JIERQSU8gZHJpdmVyIHZiaW9zIG5vdGVzIGRvYyAqLwor
CisJLyogUExMIEIgbmVlZHMgc3BlY2lhbCBoYW5kbGluZyAqLworCWlmIChwaXBlID09IFBJUEVf
QikKKwkJdmx2X3BsbGJfcmVjYWxfb3BhbXAoZGV2X3ByaXYsIHBpcGUpOworCisJLyogU2V0IHVw
IFR4IHRhcmdldCBmb3IgcGVyaW9kaWMgUmNvbXAgdXBkYXRlICovCisJdmx2X2RwaW9fd3JpdGUo
ZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc5X0JDQVNULCAweDAxMDAwMDBmKTsKKworCS8qIERp
c2FibGUgdGFyZ2V0IElSZWYgb24gUExMICovCisJcmVnX3ZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2
X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc4KHBpcGUpKTsKKwlyZWdfdmFsICY9IDB4MDBmZmZmZmY7
CisJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc4KHBpcGUpLCByZWdf
dmFsKTsKKworCS8qIERpc2FibGUgZmFzdCBsb2NrICovCisJdmx2X2RwaW9fd3JpdGUoZGV2X3By
aXYsIHBpcGUsIFZMVl9DTU5fRFcwLCAweDYxMCk7CisKKwkvKiBTZXQgaWR0YWZjcmVjYWwgYmVm
b3JlIFBMTCBpcyBlbmFibGVkICovCisJbWRpdiA9ICgoYmVzdG0xIDw8IERQSU9fTTFESVZfU0hJ
RlQpIHwgKGJlc3RtMiAmIERQSU9fTTJESVZfTUFTSykpOworCW1kaXYgfD0gKChiZXN0cDEgPDwg
RFBJT19QMV9TSElGVCkgfCAoYmVzdHAyIDw8IERQSU9fUDJfU0hJRlQpKTsKKwltZGl2IHw9ICgo
YmVzdG4gPDwgRFBJT19OX1NISUZUKSk7CisJbWRpdiB8PSAoMSA8PCBEUElPX0tfU0hJRlQpOwor
CisJLyoKKwkgKiBQb3N0IGRpdmlkZXIgZGVwZW5kcyBvbiBwaXhlbCBjbG9jayByYXRlLCBEQUMg
dnMgZGlnaXRhbCAoYW5kIExWRFMsCisJICogYnV0IHdlIGRvbid0IHN1cHBvcnQgdGhhdCkuCisJ
ICogTm90ZTogZG9uJ3QgdXNlIHRoZSBEQUMgcG9zdCBkaXZpZGVyIGFzIGl0IHNlZW1zIHVuc3Rh
YmxlLgorCSAqLworCW1kaXYgfD0gKERQSU9fUE9TVF9ESVZfSERNSURQIDw8IERQSU9fUE9TVF9E
SVZfU0hJRlQpOworCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXMyhw
aXBlKSwgbWRpdik7CisKKwltZGl2IHw9IERQSU9fRU5BQkxFX0NBTElCUkFUSU9OOworCXZsdl9k
cGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXMyhwaXBlKSwgbWRpdik7CisKKwkv
KiBTZXQgSEJSIGFuZCBSQlIgTFBGIGNvZWZmaWNpZW50cyAqLworCWlmIChwaXBlX2NvbmZpZy0+
cG9ydF9jbG9jayA9PSAxNjIwMDAgfHwKKwkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShwaXBlX2Nv
bmZpZywgSU5URUxfT1VUUFVUX0FOQUxPRykgfHwKKwkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShw
aXBlX2NvbmZpZywgSU5URUxfT1VUUFVUX0hETUkpKQorCQl2bHZfZHBpb193cml0ZShkZXZfcHJp
diwgcGlwZSwgVkxWX1BMTF9EVzEwKHBpcGUpLAorCQkJCSAweDAwOWYwMDAzKTsKKwllbHNlCisJ
CXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXMTAocGlwZSksCisJCQkJ
IDB4MDBkMDAwMGYpOworCisJaWYgKGludGVsX2NydGNfaGFzX2RwX2VuY29kZXIocGlwZV9jb25m
aWcpKSB7CisJCS8qIFVzZSBTU0Mgc291cmNlICovCisJCWlmIChwaXBlID09IFBJUEVfQSkKKwkJ
CXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXNShwaXBlKSwKKwkJCQkJ
IDB4MGRmNDAwMDApOworCQllbHNlCisJCQl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwg
VkxWX1BMTF9EVzUocGlwZSksCisJCQkJCSAweDBkZjcwMDAwKTsKKwl9IGVsc2UgeyAvKiBIRE1J
IG9yIFZHQSAqLworCQkvKiBVc2UgYmVuZCBzb3VyY2UgKi8KKwkJaWYgKHBpcGUgPT0gUElQRV9B
KQorCQkJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIFZMVl9QTExfRFc1KHBpcGUpLAor
CQkJCQkgMHgwZGY3MDAwMCk7CisJCWVsc2UKKwkJCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBw
aXBlLCBWTFZfUExMX0RXNShwaXBlKSwKKwkJCQkJIDB4MGRmNDAwMDApOworCX0KKworCWNvcmVj
bGsgPSB2bHZfZHBpb19yZWFkKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXNyhwaXBlKSk7CisJ
Y29yZWNsayA9IChjb3JlY2xrICYgMHgwMDAwZmYwMCkgfCAweDAxYzAwMDAwOworCWlmIChpbnRl
bF9jcnRjX2hhc19kcF9lbmNvZGVyKHBpcGVfY29uZmlnKSkKKwkJY29yZWNsayB8PSAweDAxMDAw
MDAwOworCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBWTFZfUExMX0RXNyhwaXBlKSwg
Y29yZWNsayk7CisKKwl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgVkxWX1BMTF9EVzEx
KHBpcGUpLCAweDg3ODcxMDAwKTsKKworCXZsdl9kcGlvX3B1dChkZXZfcHJpdik7Cit9CisKK3Zv
aWQgY2h2X3ByZXBhcmVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKK3sKKwlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkZXYpOworCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKKwll
bnVtIGRwaW9fY2hhbm5lbCBwb3J0ID0gdmx2X3BpcGVfdG9fY2hhbm5lbChwaXBlKTsKKwl1MzIg
bG9vcGZpbHRlciwgdHJpYnVmX2NhbGNudHI7CisJdTMyIGJlc3RuLCBiZXN0bTEsIGJlc3RtMiwg
YmVzdHAxLCBiZXN0cDIsIGJlc3RtMl9mcmFjOworCXUzMiBkcGlvX3ZhbDsKKwlpbnQgdmNvOwor
CisJLyogRW5hYmxlIFJlZmNsayBhbmQgU1NDICovCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYs
IERQTEwocGlwZSksCisJCSAgICAgICBwaXBlX2NvbmZpZy0+ZHBsbF9od19zdGF0ZS5kcGxsICYg
fkRQTExfVkNPX0VOQUJMRSk7CisKKwkvKiBObyBuZWVkIHRvIGFjdHVhbGx5IHNldCB1cCB0aGUg
RFBMTCB3aXRoIERTSSAqLworCWlmICgocGlwZV9jb25maWctPmRwbGxfaHdfc3RhdGUuZHBsbCAm
IERQTExfVkNPX0VOQUJMRSkgPT0gMCkKKwkJcmV0dXJuOworCisJYmVzdG4gPSBwaXBlX2NvbmZp
Zy0+ZHBsbC5uOworCWJlc3RtMl9mcmFjID0gcGlwZV9jb25maWctPmRwbGwubTIgJiAweDNmZmZm
ZjsKKwliZXN0bTEgPSBwaXBlX2NvbmZpZy0+ZHBsbC5tMTsKKwliZXN0bTIgPSBwaXBlX2NvbmZp
Zy0+ZHBsbC5tMiA+PiAyMjsKKwliZXN0cDEgPSBwaXBlX2NvbmZpZy0+ZHBsbC5wMTsKKwliZXN0
cDIgPSBwaXBlX2NvbmZpZy0+ZHBsbC5wMjsKKwl2Y28gPSBwaXBlX2NvbmZpZy0+ZHBsbC52Y287
CisJZHBpb192YWwgPSAwOworCWxvb3BmaWx0ZXIgPSAwOworCisJdmx2X2RwaW9fZ2V0KGRldl9w
cml2KTsKKworCS8qIHAxIGFuZCBwMiBkaXZpZGVyICovCisJdmx2X2RwaW9fd3JpdGUoZGV2X3By
aXYsIHBpcGUsIENIVl9DTU5fRFcxMyhwb3J0KSwKKwkJCTUgPDwgRFBJT19DSFZfUzFfRElWX1NI
SUZUIHwKKwkJCWJlc3RwMSA8PCBEUElPX0NIVl9QMV9ESVZfU0hJRlQgfAorCQkJYmVzdHAyIDw8
IERQSU9fQ0hWX1AyX0RJVl9TSElGVCB8CisJCQkxIDw8IERQSU9fQ0hWX0tfRElWX1NISUZUKTsK
KworCS8qIEZlZWRiYWNrIHBvc3QtZGl2aWRlciAtIG0yICovCisJdmx2X2RwaW9fd3JpdGUoZGV2
X3ByaXYsIHBpcGUsIENIVl9QTExfRFcwKHBvcnQpLCBiZXN0bTIpOworCisJLyogRmVlZGJhY2sg
cmVmY2xrIGRpdmlkZXIgLSBuIGFuZCBtMSAqLworCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBw
aXBlLCBDSFZfUExMX0RXMShwb3J0KSwKKwkJCURQSU9fQ0hWX00xX0RJVl9CWV8yIHwKKwkJCTEg
PDwgRFBJT19DSFZfTl9ESVZfU0hJRlQpOworCisJLyogTTIgZnJhY3Rpb24gZGl2aXNpb24gKi8K
Kwl2bHZfZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgQ0hWX1BMTF9EVzIocG9ydCksIGJlc3Rt
Ml9mcmFjKTsKKworCS8qIE0yIGZyYWN0aW9uIGRpdmlzaW9uIGVuYWJsZSAqLworCWRwaW9fdmFs
ID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX1BMTF9EVzMocG9ydCkpOworCWRw
aW9fdmFsICY9IH4oRFBJT19DSFZfRkVFREZXRF9HQUlOX01BU0sgfCBEUElPX0NIVl9GUkFDX0RJ
Vl9FTik7CisJZHBpb192YWwgfD0gKDIgPDwgRFBJT19DSFZfRkVFREZXRF9HQUlOX1NISUZUKTsK
KwlpZiAoYmVzdG0yX2ZyYWMpCisJCWRwaW9fdmFsIHw9IERQSU9fQ0hWX0ZSQUNfRElWX0VOOwor
CXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXMyhwb3J0KSwgZHBpb192
YWwpOworCisJLyogUHJvZ3JhbSBkaWdpdGFsIGxvY2sgZGV0ZWN0IHRocmVzaG9sZCAqLworCWRw
aW9fdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX1BMTF9EVzkocG9ydCkp
OworCWRwaW9fdmFsICY9IH4oRFBJT19DSFZfSU5UX0xPQ0tfVEhSRVNIT0xEX01BU0sgfAorCQkJ
CQlEUElPX0NIVl9JTlRfTE9DS19USFJFU0hPTERfU0VMX0NPQVJTRSk7CisJZHBpb192YWwgfD0g
KDB4NSA8PCBEUElPX0NIVl9JTlRfTE9DS19USFJFU0hPTERfU0hJRlQpOworCWlmICghYmVzdG0y
X2ZyYWMpCisJCWRwaW9fdmFsIHw9IERQSU9fQ0hWX0lOVF9MT0NLX1RIUkVTSE9MRF9TRUxfQ09B
UlNFOworCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfUExMX0RXOShwb3J0KSwg
ZHBpb192YWwpOworCisJLyogTG9vcCBmaWx0ZXIgKi8KKwlpZiAodmNvID09IDU0MDAwMDApIHsK
KwkJbG9vcGZpbHRlciB8PSAoMHgzIDw8IERQSU9fQ0hWX1BST1BfQ09FRkZfU0hJRlQpOworCQls
b29wZmlsdGVyIHw9ICgweDggPDwgRFBJT19DSFZfSU5UX0NPRUZGX1NISUZUKTsKKwkJbG9vcGZp
bHRlciB8PSAoMHgxIDw8IERQSU9fQ0hWX0dBSU5fQ1RSTF9TSElGVCk7CisJCXRyaWJ1Zl9jYWxj
bnRyID0gMHg5OworCX0gZWxzZSBpZiAodmNvIDw9IDYyMDAwMDApIHsKKwkJbG9vcGZpbHRlciB8
PSAoMHg1IDw8IERQSU9fQ0hWX1BST1BfQ09FRkZfU0hJRlQpOworCQlsb29wZmlsdGVyIHw9ICgw
eEIgPDwgRFBJT19DSFZfSU5UX0NPRUZGX1NISUZUKTsKKwkJbG9vcGZpbHRlciB8PSAoMHgzIDw8
IERQSU9fQ0hWX0dBSU5fQ1RSTF9TSElGVCk7CisJCXRyaWJ1Zl9jYWxjbnRyID0gMHg5OworCX0g
ZWxzZSBpZiAodmNvIDw9IDY0ODAwMDApIHsKKwkJbG9vcGZpbHRlciB8PSAoMHg0IDw8IERQSU9f
Q0hWX1BST1BfQ09FRkZfU0hJRlQpOworCQlsb29wZmlsdGVyIHw9ICgweDkgPDwgRFBJT19DSFZf
SU5UX0NPRUZGX1NISUZUKTsKKwkJbG9vcGZpbHRlciB8PSAoMHgzIDw8IERQSU9fQ0hWX0dBSU5f
Q1RSTF9TSElGVCk7CisJCXRyaWJ1Zl9jYWxjbnRyID0gMHg4OworCX0gZWxzZSB7CisJCS8qIE5v
dCBzdXBwb3J0ZWQuIEFwcGx5IHRoZSBzYW1lIGxpbWl0cyBhcyBpbiB0aGUgbWF4IGNhc2UgKi8K
KwkJbG9vcGZpbHRlciB8PSAoMHg0IDw8IERQSU9fQ0hWX1BST1BfQ09FRkZfU0hJRlQpOworCQls
b29wZmlsdGVyIHw9ICgweDkgPDwgRFBJT19DSFZfSU5UX0NPRUZGX1NISUZUKTsKKwkJbG9vcGZp
bHRlciB8PSAoMHgzIDw8IERQSU9fQ0hWX0dBSU5fQ1RSTF9TSElGVCk7CisJCXRyaWJ1Zl9jYWxj
bnRyID0gMDsKKwl9CisJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUsIENIVl9QTExfRFc2
KHBvcnQpLCBsb29wZmlsdGVyKTsKKworCWRwaW9fdmFsID0gdmx2X2RwaW9fcmVhZChkZXZfcHJp
diwgcGlwZSwgQ0hWX1BMTF9EVzgocG9ydCkpOworCWRwaW9fdmFsICY9IH5EUElPX0NIVl9URENf
VEFSR0VUX0NOVF9NQVNLOworCWRwaW9fdmFsIHw9ICh0cmlidWZfY2FsY250ciA8PCBEUElPX0NI
Vl9URENfVEFSR0VUX0NOVF9TSElGVCk7CisJdmx2X2RwaW9fd3JpdGUoZGV2X3ByaXYsIHBpcGUs
IENIVl9QTExfRFc4KHBvcnQpLCBkcGlvX3ZhbCk7CisKKwkvKiBBRkMgUmVjYWwgKi8KKwl2bHZf
ZHBpb193cml0ZShkZXZfcHJpdiwgcGlwZSwgQ0hWX0NNTl9EVzE0KHBvcnQpLAorCQkJdmx2X2Rw
aW9fcmVhZChkZXZfcHJpdiwgcGlwZSwgQ0hWX0NNTl9EVzE0KHBvcnQpKSB8CisJCQlEUElPX0FG
Q19SRUNBTCk7CisKKwl2bHZfZHBpb19wdXQoZGV2X3ByaXYpOworfQorCisvKioKKyAqIHZsdl9m
b3JjZV9wbGxfb24gLSBmb3JjaWJseSBlbmFibGUganVzdCB0aGUgUExMCisgKiBAZGV2X3ByaXY6
IGk5MTUgcHJpdmF0ZSBzdHJ1Y3R1cmUKKyAqIEBwaXBlOiBwaXBlIFBMTCB0byBlbmFibGUKKyAq
IEBkcGxsOiBQTEwgY29uZmlndXJhdGlvbgorICoKKyAqIEVuYWJsZSB0aGUgUExMIGZvciBAcGlw
ZSB1c2luZyB0aGUgc3VwcGxpZWQgQGRwbGwgY29uZmlnLiBUbyBiZSB1c2VkCisgKiBpbiBjYXNl
cyB3aGVyZSB3ZSBuZWVkIHRoZSBQTEwgZW5hYmxlZCBldmVuIHdoZW4gQHBpcGUgaXMgbm90IGdv
aW5nIHRvCisgKiBiZSBlbmFibGVkLgorICovCitpbnQgdmx2X2ZvcmNlX3BsbF9vbihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlLAorCQkgICAgIGNvbnN0
IHN0cnVjdCBkcGxsICpkcGxsKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gaW50ZWxf
Z2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIHBpcGUpOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpwaXBlX2NvbmZpZzsKKworCXBpcGVfY29uZmlnID0gaW50ZWxfY3J0Y19zdGF0ZV9hbGxv
YyhjcnRjKTsKKwlpZiAoIXBpcGVfY29uZmlnKQorCQlyZXR1cm4gLUVOT01FTTsKKworCXBpcGVf
Y29uZmlnLT5jcHVfdHJhbnNjb2RlciA9IChlbnVtIHRyYW5zY29kZXIpcGlwZTsKKwlwaXBlX2Nv
bmZpZy0+cGl4ZWxfbXVsdGlwbGllciA9IDE7CisJcGlwZV9jb25maWctPmRwbGwgPSAqZHBsbDsK
KworCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgeworCQljaHZfY29tcHV0ZV9kcGxsKGNy
dGMsIHBpcGVfY29uZmlnKTsKKwkJY2h2X3ByZXBhcmVfcGxsKGNydGMsIHBpcGVfY29uZmlnKTsK
KwkJY2h2X2VuYWJsZV9wbGwoY3J0YywgcGlwZV9jb25maWcpOworCX0gZWxzZSB7CisJCXZsdl9j
b21wdXRlX2RwbGwoY3J0YywgcGlwZV9jb25maWcpOworCQl2bHZfcHJlcGFyZV9wbGwoY3J0Yywg
cGlwZV9jb25maWcpOworCQl2bHZfZW5hYmxlX3BsbChjcnRjLCBwaXBlX2NvbmZpZyk7CisJfQor
CisJa2ZyZWUocGlwZV9jb25maWcpOworCisJcmV0dXJuIDA7Cit9CisKK3ZvaWQgdmx2X2Rpc2Fi
bGVfcGxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUp
Cit7CisJdTMyIHZhbDsKKworCS8qIE1ha2Ugc3VyZSB0aGUgcGlwZSBpc24ndCBzdGlsbCByZWx5
aW5nIG9uIHVzICovCisJYXNzZXJ0X3BpcGVfZGlzYWJsZWQoZGV2X3ByaXYsIChlbnVtIHRyYW5z
Y29kZXIpcGlwZSk7CisKKwl2YWwgPSBEUExMX0lOVEVHUkFURURfUkVGX0NMS19WTFYgfAorCQlE
UExMX1JFRl9DTEtfRU5BQkxFX1ZMViB8IERQTExfVkdBX01PREVfRElTOworCWlmIChwaXBlICE9
IFBJUEVfQSkKKwkJdmFsIHw9IERQTExfSU5URUdSQVRFRF9DUklfQ0xLX1ZMVjsKKworCWludGVs
X2RlX3dyaXRlKGRldl9wcml2LCBEUExMKHBpcGUpLCB2YWwpOworCWludGVsX2RlX3Bvc3Rpbmdf
cmVhZChkZXZfcHJpdiwgRFBMTChwaXBlKSk7Cit9CisKK3ZvaWQgY2h2X2Rpc2FibGVfcGxsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCit7CisJZW51
bSBkcGlvX2NoYW5uZWwgcG9ydCA9IHZsdl9waXBlX3RvX2NoYW5uZWwocGlwZSk7CisJdTMyIHZh
bDsKKworCS8qIE1ha2Ugc3VyZSB0aGUgcGlwZSBpc24ndCBzdGlsbCByZWx5aW5nIG9uIHVzICov
CisJYXNzZXJ0X3BpcGVfZGlzYWJsZWQoZGV2X3ByaXYsIChlbnVtIHRyYW5zY29kZXIpcGlwZSk7
CisKKwl2YWwgPSBEUExMX1NTQ19SRUZfQ0xLX0NIViB8CisJCURQTExfUkVGX0NMS19FTkFCTEVf
VkxWIHwgRFBMTF9WR0FfTU9ERV9ESVM7CisJaWYgKHBpcGUgIT0gUElQRV9BKQorCQl2YWwgfD0g
RFBMTF9JTlRFR1JBVEVEX0NSSV9DTEtfVkxWOworCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYs
IERQTEwocGlwZSksIHZhbCk7CisJaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEUExM
KHBpcGUpKTsKKworCXZsdl9kcGlvX2dldChkZXZfcHJpdik7CisKKwkvKiBEaXNhYmxlIDEwYml0
IGNsb2NrIHRvIGRpc3BsYXkgY29udHJvbGxlciAqLworCXZhbCA9IHZsdl9kcGlvX3JlYWQoZGV2
X3ByaXYsIHBpcGUsIENIVl9DTU5fRFcxNChwb3J0KSk7CisJdmFsICY9IH5EUElPX0RDTEtQX0VO
OworCXZsdl9kcGlvX3dyaXRlKGRldl9wcml2LCBwaXBlLCBDSFZfQ01OX0RXMTQocG9ydCksIHZh
bCk7CisKKwl2bHZfZHBpb19wdXQoZGV2X3ByaXYpOworfQorCit2b2lkIGk5eHhfZGlzYWJsZV9w
bGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CisJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOworCisJLyogRG9uJ3QgZGlzYWJs
ZSBwaXBlIG9yIHBpcGUgUExMcyBpZiBuZWVkZWQgKi8KKwlpZiAoSVNfSTgzMChkZXZfcHJpdikp
CisJCXJldHVybjsKKworCS8qIE1ha2Ugc3VyZSB0aGUgcGlwZSBpc24ndCBzdGlsbCByZWx5aW5n
IG9uIHVzICovCisJYXNzZXJ0X3BpcGVfZGlzYWJsZWQoZGV2X3ByaXYsIGNydGNfc3RhdGUtPmNw
dV90cmFuc2NvZGVyKTsKKworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBEUExMKHBpcGUpLCBE
UExMX1ZHQV9NT0RFX0RJUyk7CisJaW50ZWxfZGVfcG9zdGluZ19yZWFkKGRldl9wcml2LCBEUExM
KHBpcGUpKTsKK30KKworCisvKioKKyAqIHZsdl9mb3JjZV9wbGxfb2ZmIC0gZm9yY2libHkgZGlz
YWJsZSBqdXN0IHRoZSBQTEwKKyAqIEBkZXZfcHJpdjogaTkxNSBwcml2YXRlIHN0cnVjdHVyZQor
ICogQHBpcGU6IHBpcGUgUExMIHRvIGRpc2FibGUKKyAqCisgKiBEaXNhYmxlIHRoZSBQTEwgZm9y
IEBwaXBlLiBUbyBiZSB1c2VkIGluIGNhc2VzIHdoZXJlIHdlIG5lZWQKKyAqIHRoZSBQTEwgZW5h
YmxlZCBldmVuIHdoZW4gQHBpcGUgaXMgbm90IGdvaW5nIHRvIGJlIGVuYWJsZWQuCisgKi8KK3Zv
aWQgdmx2X2ZvcmNlX3BsbF9vZmYoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIHBpcGUgcGlwZSkKK3sKKwlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCisJCWNodl9k
aXNhYmxlX3BsbChkZXZfcHJpdiwgcGlwZSk7CisJZWxzZQorCQl2bHZfZGlzYWJsZV9wbGwoZGV2
X3ByaXYsIHBpcGUpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kcGxsLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwbGwu
aAppbmRleCBjYWY0NjE1MDkyZTEuLjdmZjRiMGQyOWVkMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcGxsLmgKQEAgLTEwLDYgKzEwLDcgQEAgc3RydWN0IGRwbGw7CiBz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBpbnRlbF9jcnRjOwogc3RydWN0IGludGVs
X2NydGNfc3RhdGU7CitlbnVtIHBpcGU7CiAKIHZvaWQgaW50ZWxfZHBsbF9pbml0X2Nsb2NrX2hv
b2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIGludCB2bHZfY2FsY19kcGxs
X3BhcmFtcyhpbnQgcmVmY2xrLCBzdHJ1Y3QgZHBsbCAqY2xvY2spOwpAQCAtMjAsNCArMjEsMjEg
QEAgdm9pZCB2bHZfY29tcHV0ZV9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogdm9pZCBj
aHZfY29tcHV0ZV9kcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkgICAgICBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpOwogCitpbnQgdmx2X2ZvcmNlX3BsbF9vbihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlLAorCQkgICAg
IGNvbnN0IHN0cnVjdCBkcGxsICpkcGxsKTsKK3ZvaWQgdmx2X2ZvcmNlX3BsbF9vZmYoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSk7Cit2b2lkIGk5eHhf
ZW5hYmxlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJICAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Cit2b2lkIHZsdl9lbmFibGVfcGxsKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAorCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnKTsKK3ZvaWQgY2h2X2VuYWJsZV9wbGwoc3RydWN0IGludGVsX2NydGMgKmNy
dGMsCisJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpOwor
dm9pZCB2bHZfZGlzYWJsZV9wbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBl
bnVtIHBpcGUgcGlwZSk7Cit2b2lkIGNodl9kaXNhYmxlX3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKTsKK3ZvaWQgaTl4eF9kaXNhYmxlX3BsbChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Cit2b2lkIHZsdl9wcmVw
YXJlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpOwordm9pZCBjaHZfcHJlcGFyZV9wbGwoc3RydWN0
IGludGVsX2NydGMgKmNydGMsCisJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnKTsKKwogI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Bwcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9wcHMuYwppbmRleCA1OGVmZjYyODlkMTIuLjBhOWIyYWJmMjkwZSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wcHMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bwcy5jCkBAIC02LDYgKzYsNyBAQAogI2luY2x1ZGUgImk5
MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV90eXBlcy5oIgogI2luY2x1ZGUgImlu
dGVsX2RwLmgiCisjaW5jbHVkZSAiaW50ZWxfZHBsbC5oIgogI2luY2x1ZGUgImludGVsX3Bwcy5o
IgogCiBzdGF0aWMgdm9pZCB2bHZfc3RlYWxfcG93ZXJfc2VxdWVuY2VyKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

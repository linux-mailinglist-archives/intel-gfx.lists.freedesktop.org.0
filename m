Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 686D8A1350
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5ACA36E029;
	Thu, 29 Aug 2019 08:12:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6D36E89FA0
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:12:02 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299896-1500050 
 for multiple; Thu, 29 Aug 2019 09:12:00 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:50 +0100
Message-Id: <20190829081150.10271-37-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 36/36] drm/i915: Drop struct_mutex from around
 GEM initialisation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugbm8gbG9uZ2VyIG5lZWQgdG8gcGxhY2F0ZSBsb2NrZGVwIGJ5IGhvbGRpbmcgc3RydWN0X211
dGV4IGZvciBvdXIKaW5pdGlhbGlzYXRpb24sIHNvIGRvbid0LgoKU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAgICAgICAgIHwgIDIgLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICAgICB8IDEzIC0tLS0tLS0tLS0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyB8ICA3IC0tLS0t
LS0KIDMgZmlsZXMgY2hhbmdlZCwgMjIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fcG0uYwppbmRleCA5NTZiNDRlNWZjNjAuLjcyNDViYmMzZjA3NyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTE3MCw3ICsxNzAsNiBAQCB2b2lk
IGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlHRU1f
VFJBQ0UoIlxuIik7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlp
bnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsK
IAogCWk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBpbmdzKGk5MTUpOwpAQCAtMTk3LDcgKzE5Niw2
IEBAIHZvaWQgaTkxNV9nZW1fcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CiBvdXRfdW5sb2NrOgogCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUs
IEZPUkNFV0FLRV9BTEwpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJcmV0dXJuOwogCiBlcnJfd2VkZ2VkOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggMjI5
MTlhODk3NTI0Li5iYjM5YzY0YTBhMTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTM2
NCw3ICsxMzY0LDYgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCSAqIHdlIGhvbGQgdGhlIGZvcmNld2FrZSBkdXJpbmcgaW5pdGlhbGlzYXRp
b24gdGhlc2UgcHJvYmxlbXMKIAkgKiBqdXN0IG1hZ2ljYWxseSBnbyBhd2F5LgogCSAqLwotCW11
dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlpbnRlbF91bmNvcmVfZm9y
Y2V3YWtlX2dldCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKIAlyZXQgPSBp
OTE1X2luaXRfZ2d0dChkZXZfcHJpdik7CkBAIC0xNDM5LDcgKzE0MzgsNiBAQCBpbnQgaTkxNV9n
ZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gZXJyX2d0
OwogCiAJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNF
V0FLRV9BTEwpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJcmV0dXJuIDA7CiAKQEAgLTE0NTAsMTUgKzE0NDgsMTEgQEAgaW50IGk5MTVfZ2VtX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIGRyaXZlciBkb2Vzbid0IGV4
cGxvZGUgZHVyaW5nIHJ1bnRpbWUuCiAJICovCiBlcnJfZ3Q6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZkZXZfcHJp
di0+Z3QpOwogCWk5MTVfZ2VtX3N1c3BlbmQoZGV2X3ByaXYpOwogCWk5MTVfZ2VtX3N1c3BlbmRf
bGF0ZShkZXZfcHJpdik7CiAKIAlpOTE1X2dlbV9kcmFpbl93b3JrcXVldWUoZGV2X3ByaXYpOwot
Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogZXJyX2luaXRfaHc6
CiAJaW50ZWxfdWNfZmluaV9odygmZGV2X3ByaXYtPmd0LnVjKTsKIGVycl91Y19pbml0OgpAQCAt
MTQ3NSw3ICsxNDY5LDYgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogZXJyX2dndHQ6CiBlcnJfdW5sb2NrOgogCWludGVsX3VuY29yZV9mb3Jj
ZXdha2VfcHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWlmIChyZXQgIT0gLUVJTykgewog
CQlpbnRlbF91Y19jbGVhbnVwX2Zpcm13YXJlcygmZGV2X3ByaXYtPmd0LnVjKTsKQEAgLTE0ODQs
OCArMTQ3Nyw2IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAl9CiAKIAlpZiAocmV0ID09IC1FSU8pIHsKLQkJbXV0ZXhfbG9jaygmZGV2X3By
aXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJCS8qCiAJCSAqIEFsbG93IGVuZ2luZXMgb3IgdUMg
aW5pdGlhbGlzYXRpb24gdG8gZmFpbCBieSBtYXJraW5nIHRoZSBHUFUKIAkJICogYXMgd2VkZ2Vk
LiBCdXQgd2Ugb25seSB3YW50IHRvIGRvIHRoaXMgd2hlbiB0aGUgR1BVIGlzIGFuZ3J5LApAQCAt
MTUwMiw4ICsxNDkzLDYgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCQlpOTE1X2dlbV9yZXN0b3JlX2d0dF9tYXBwaW5ncyhkZXZfcHJpdik7
CiAJCWk5MTVfZ2VtX3Jlc3RvcmVfZmVuY2VzKGRldl9wcml2KTsKIAkJaW50ZWxfaW5pdF9jbG9j
a19nYXRpbmcoZGV2X3ByaXYpOwotCi0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCX0KIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoZGV2X3ByaXYp
OwpAQCAtMTUzNCwxMCArMTUyMyw4IEBAIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbW92ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJLyogRmx1c2ggYW55IG91dHN0YW5kaW5n
IHVucGluX3dvcmsuICovCiAJaTkxNV9nZW1fZHJhaW5fd29ya3F1ZXVlKGRldl9wcml2KTsKIAot
CW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlpbnRlbF91Y19maW5p
X2h3KCZkZXZfcHJpdi0+Z3QudWMpOwogCWludGVsX3VjX2ZpbmkoJmRldl9wcml2LT5ndC51Yyk7
Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpOTE1X2dl
bV9kcmFpbl9mcmVlZF9vYmplY3RzKGRldl9wcml2KTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRleCA5NzIyZGJjYWY4NjguLjZj
YTgxODljY2EwMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21v
Y2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2Nr
X2dlbV9kZXZpY2UuYwpAQCAtNjcsMTAgKzY3LDcgQEAgc3RhdGljIHZvaWQgbW9ja19kZXZpY2Vf
cmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWRyYWluX3dvcmtxdWV1ZShpOTE1LT53
cSk7CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKIAotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCW1vY2tfZmluaV9nZ3R0KCZpOTE1LT5nZ3R0KTsK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZGVzdHJveV93b3Jr
cXVldWUoaTkxNS0+d3EpOwogCiAJaTkxNV9nZW1mc19maW5pKGk5MTUpOwpAQCAtMTc5LDggKzE3
Niw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9kZXZpY2Uodm9pZCkKIAog
CWludGVsX3RpbWVsaW5lc19pbml0KGk5MTUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KIAltb2NrX2luaXRfZ2d0dChpOTE1LCAmaTkxNS0+Z2d0dCk7CiAKIAlt
a3dyaXRlX2RldmljZV9pbmZvKGk5MTUpLT5lbmdpbmVfbWFzayA9IEJJVCgwKTsKQEAgLTE5Nyw3
ICsxOTIsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19nZW1fZGV2aWNlKHZvaWQp
CiAJCWdvdG8gZXJyX2NvbnRleHQ7CiAKIAlpbnRlbF9lbmdpbmVzX2RyaXZlcl9yZWdpc3Rlcihp
OTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJV0FSTl9P
TihpOTE1X2dlbWZzX2luaXQoaTkxNSkpOwogCkBAIC0yMDgsNyArMjAyLDYgQEAgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2b2lkKQogZXJyX2VuZ2luZToKIAltb2Nr
X2VuZ2luZV9mcmVlKGk5MTUtPmVuZ2luZVtSQ1MwXSk7CiBlcnJfdW5sb2NrOgotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaW50ZWxfdGltZWxpbmVzX2ZpbmkoaTkx
NSk7CiAJZGVzdHJveV93b3JrcXVldWUoaTkxNS0+d3EpOwogZXJyX2RydjoKLS0gCjIuMjMuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

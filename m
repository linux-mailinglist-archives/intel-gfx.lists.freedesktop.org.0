Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1D4679081D
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 21:17:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BDD576E98E;
	Fri, 16 Aug 2019 19:17:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 734D06E98E
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 19:17:20 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18167217-1500050 
 for multiple; Fri, 16 Aug 2019 20:17:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 16 Aug 2019 20:17:03 +0100
Message-Id: <20190816191703.31519-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190816175801.8215-1-chris@chris-wilson.co.uk>
References: <20190816175801.8215-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3] drm/i915/selftests: Check the context size
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkIGEgcmVkem9uZSB0byBvdXIgY29udGV4dCBpbWFnZSBhbmQgY2hlY2sgdGhlIEhXIGRvZXMg
bm90IHdyaXRlIGludG8KYWZ0ZXIgYSBjb250ZXh0IHNhdmUsIHRvIHZlcmlmeSB0aGF0IHdlIGhh
dmUgdGhlIGNvcnJlY3QgY29udGV4dCBzaXplLgooVGhpcyBkb2VzIHZhcnkgd2l0aCBmZWF0dXJl
IGJpdHMsIHNvIHRlc3Qgd2l0aCBhIGxpdmUgc2V0dXAgdGhhdCBzaG91bGQKbWF0Y2ggaG93IHdl
IHJ1biB1c2Vyc3BhY2UuKQoKdjI6IENoZWNrIHRoZSByZWR6b25lIG9uIGV2ZXJ5IGNvbnRleHQg
dW5waW4KdjM6IFVzZSBhIGtlcm5lbCBjb250ZXh0IHRvIHByZXZlbnQgbG9hZGluZyBnYXJiYWdl
IGZvciByaW5nYnVmZmVyCnN1Ym1pc3Npb24KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFu
aWVsZS5jZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYyAgICAgICAgfCAgMzMgKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9jb250ZXh0LmMgfCAxMjggKysrKysrKysrKysrKysrKysrKysrCiAyIGZpbGVz
IGNoYW5nZWQsIDE2MSBpbnNlcnRpb25zKCspCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMu
YwppbmRleCBlOTg2M2Y0ZDgyNmIuLmFkZTIxMjY4NmJmNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMKQEAgLTE1NzgsOSArMTU3OCwzOCBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNf
Y29udGV4dF9kZXN0cm95KHN0cnVjdCBrcmVmICprcmVmKQogCWludGVsX2NvbnRleHRfZmluaShj
ZSk7CiAJaW50ZWxfY29udGV4dF9mcmVlKGNlKTsKIH0KK3N0YXRpYyB2b2lkCitzZXRfcmVkem9u
ZSh2b2lkICp2YWRkciwgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQorewor
CWlmICghSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKSkKKwkJcmV0dXJuOwor
CisJdmFkZHIgKz0gTFJDX0hFQURFUl9QQUdFUyAqIFBBR0VfU0laRTsKKwl2YWRkciArPSBlbmdp
bmUtPmNvbnRleHRfc2l6ZTsKKworCW1lbXNldCh2YWRkciwgUE9JU09OX0lOVVNFLCBJOTE1X0dU
VF9QQUdFX1NJWkUpOworfQorCitzdGF0aWMgdm9pZAorY2hlY2tfcmVkem9uZShjb25zdCB2b2lk
ICp2YWRkciwgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWlmICgh
SVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKSkKKwkJcmV0dXJuOworCisJdmFk
ZHIgKz0gTFJDX0hFQURFUl9QQUdFUyAqIFBBR0VfU0laRTsKKwl2YWRkciArPSBlbmdpbmUtPmNv
bnRleHRfc2l6ZTsKKworCWlmIChtZW1jaHJfaW52KHZhZGRyLCBQT0lTT05fSU5VU0UsIEk5MTVf
R1RUX1BBR0VfU0laRSkpCisJCWRldl9lcnJfb25jZShlbmdpbmUtPmk5MTUtPmRybS5kZXYsCisJ
CQkgICAgICIlcyBjb250ZXh0IHJlZHpvbmUgb3ZlcndyaXR0ZW4hXG4iLAorCQkJICAgICBlbmdp
bmUtPm5hbWUpOworfQogCiBzdGF0aWMgdm9pZCBleGVjbGlzdHNfY29udGV4dF91bnBpbihzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7CisJY2hlY2tfcmVkem9uZSgodm9pZCAqKWNlLT5scmNf
cmVnX3N0YXRlIC0gTFJDX1NUQVRFX1BOICogUEFHRV9TSVpFLAorCQkgICAgICBjZS0+ZW5naW5l
KTsKKwogCWk5MTVfZ2VtX2NvbnRleHRfdW5waW5faHdfaWQoY2UtPmdlbV9jb250ZXh0KTsKIAlp
OTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGNlLT5zdGF0ZS0+b2JqKTsKIAlpbnRlbF9yaW5nX3Jl
c2V0KGNlLT5yaW5nLCBjZS0+cmluZy0+dGFpbCk7CkBAIC0zMTE5LDYgKzMxNDgsOCBAQCBwb3B1
bGF0ZV9scl9jb250ZXh0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJcmV0dXJuIHJldDsK
IAl9CiAKKwlzZXRfcmVkem9uZSh2YWRkciwgZW5naW5lKTsKKwogCWlmIChlbmdpbmUtPmRlZmF1
bHRfc3RhdGUpIHsKIAkJLyoKIAkJICogV2Ugb25seSB3YW50IHRvIGNvcHkgb3ZlciB0aGUgdGVt
cGxhdGUgY29udGV4dCBzdGF0ZTsKQEAgLTMxNzMsNiArMzIwNCw4IEBAIHN0YXRpYyBpbnQgX19l
eGVjbGlzdHNfY29udGV4dF9hbGxvYyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJICogZm9y
IG91ciBvd24gdXNlIGFuZCBmb3Igc2hhcmluZyB3aXRoIHRoZSBHdUMuCiAJICovCiAJY29udGV4
dF9zaXplICs9IExSQ19IRUFERVJfUEFHRVMgKiBQQUdFX1NJWkU7CisJaWYgKElTX0VOQUJMRUQo
Q09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkpCisJCWNvbnRleHRfc2l6ZSArPSBJOTE1X0dUVF9Q
QUdFX1NJWkU7IC8qIGZvciByZWR6b25lICovCiAKIAljdHhfb2JqID0gaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9zaG1lbShlbmdpbmUtPmk5MTUsIGNvbnRleHRfc2l6ZSk7CiAJaWYgKElTX0VSUihj
dHhfb2JqKSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2Nv
bnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRl
eCA2ZmJjNzJiYzI5MGUuLmNlZmQyZGYwODZmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAtNSw2ICs1LDcgQEAKICAqLwogCiAjaW5jbHVkZSAiaTkx
NV9zZWxmdGVzdC5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImlu
dGVsX2d0LmgiCiAKICNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5oIgpAQCAt
NjQsNiArNjUsMTMyIEBAIHN0YXRpYyBpbnQgY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSkKIAlyZXR1cm4gZXJyOwogfQogCitzdGF0aWMgaW50IF9fbGl2ZV9jb250ZXh0X3Np
emUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICAgICAgIHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpmaXhtZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJdm9pZCAqdmFkZHI7CisJaW50IGVycjsKKworCWNlID0g
aW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJaWYgKElTX0VSUihjZSkpCisJ
CXJldHVybiBQVFJfRVJSKGNlKTsKKworCWVyciA9IGludGVsX2NvbnRleHRfcGluKGNlKTsKKwlp
ZiAoZXJyKQorCQlnb3RvIGVycjsKKworCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAo
Y2UtPnN0YXRlLT5vYmosCisJCQkJCWk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZW5naW5lLT5pOTE1
KSk7CisJaWYgKElTX0VSUih2YWRkcikpIHsKKwkJZXJyID0gUFRSX0VSUih2YWRkcik7CisJCWlu
dGVsX2NvbnRleHRfdW5waW4oY2UpOworCQlnb3RvIGVycjsKKwl9CisKKwlpZiAoSEFTX0VYRUNM
SVNUUyhlbmdpbmUtPmk5MTUpKQorCQl2YWRkciArPSBMUkNfSEVBREVSX1BBR0VTICogUEFHRV9T
SVpFOworCisJdmFkZHIgKz0gZW5naW5lLT5jb250ZXh0X3NpemUgLSBJOTE1X0dUVF9QQUdFX1NJ
WkU7CisJbWVtc2V0KHZhZGRyLCBQT0lTT05fSU5VU0UsIEk5MTVfR1RUX1BBR0VfU0laRSk7CisK
KwlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWludGVsX2NvbnRleHRf
dW5waW4oY2UpOworCWlmIChJU19FUlIocnEpKSB7CisJCWVyciA9IFBUUl9FUlIocnEpOworCQln
b3RvIGVycl91bnBpbjsKKwl9CisKKwllcnIgPSByZXF1ZXN0X3N5bmMocnEpOworCWlmIChlcnIp
CisJCWdvdG8gZXJyX3VucGluOworCisJLyogRm9yY2UgdGhlIGNvbnRleHQgc3dpdGNoICovCisJ
cnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCWlmIChJ
U19FUlIocnEpKSB7CisJCWVyciA9IFBUUl9FUlIocnEpOworCQlnb3RvIGVycl91bnBpbjsKKwl9
CisJZXJyID0gcmVxdWVzdF9zeW5jKHJxKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl91bnBpbjsK
KworCWlmIChtZW1jaHJfaW52KHZhZGRyLCBQT0lTT05fSU5VU0UsIEk5MTVfR1RUX1BBR0VfU0la
RSkpIHsKKwkJcHJfZXJyKCIlcyBjb250ZXh0IG92ZXJ3cm90ZSB0cmFpbGluZyByZWQtem9uZSEi
LCBlbmdpbmUtPm5hbWUpOworCQllcnIgPSAtRUlOVkFMOworCX0KKworZXJyX3VucGluOgorCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoY2UtPnN0YXRlLT5vYmopOworZXJyOgorCWludGVsX2Nv
bnRleHRfcHV0KGNlKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGxpdmVfY29udGV4
dF9zaXplKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4
bWU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9IDA7CisKKwkvKgorCSAq
IENoZWNrIHRoYXQgb3VyIGNvbnRleHQgc2l6ZXMgYXJlIGNvcnJlY3QgYnkgc2VlaW5nIGlmIHRo
ZQorCSAqIEhXIHRyaWVzIHRvIHdyaXRlIHBhc3QgdGhlIGVuZCBvZiBvbmUuCisJICovCisKKwlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKKwlmaXhtZSA9IGtlcm5l
bF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoSVNfRVJSKGZpeG1lKSkgeworCQllcnIgPSBQVFJf
RVJSKGZpeG1lKTsKKwkJZ290byB1bmxvY2s7CisJfQorCisJZm9yX2VhY2hfZW5naW5lKGVuZ2lu
ZSwgZ3QtPmk5MTUsIGlkKSB7CisJCXN0cnVjdCB7CisJCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqc3RhdGU7CisJCQl2b2lkICpwaW5uZWQ7CisJCX0gc2F2ZWQ7CisKKwkJaWYgKCFlbmdp
bmUtPmNvbnRleHRfc2l6ZSkKKwkJCWNvbnRpbnVlOworCisJCWludGVsX2VuZ2luZV9wbV9nZXQo
ZW5naW5lKTsKKworCQkvKgorCQkgKiBIaWRlIHRoZSBvbGQgZGVmYXVsdCBzdGF0ZSAtLSB3ZSBs
aWUgYWJvdXQgdGhlIGNvbnRleHQgc2l6ZQorCQkgKiBhbmQgZ2V0IGNvbmZ1c2VkIHdoZW4gdGhl
IGRlZmF1bHQgc3RhdGUgaXMgc21hbGxlciB0aGFuCisJCSAqIGV4cGVjdGVkLiBGb3Igb3VyIGRv
IG5vdGhpbmcgcmVxdWVzdCwgaW5oZXJpdGluZyB0aGUKKwkJICogYWN0aXZlIHN0YXRlIGlzIHN1
ZmZpY2llbnQsIHdlIGFyZSBvbmx5IGNoZWNraW5nIHRoYXQgd2UKKwkJICogZG9uJ3QgdXNlIG1v
cmUgdGhhbiB3ZSBwbGFubmVkLgorCQkgKi8KKwkJc2F2ZWQuc3RhdGUgPSBmZXRjaF9hbmRfemVy
bygmZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKKwkJc2F2ZWQucGlubmVkID0gZmV0Y2hfYW5kX3pl
cm8oJmVuZ2luZS0+cGlubmVkX2RlZmF1bHRfc3RhdGUpOworCisJCWVuZ2luZS0+Y29udGV4dF9z
aXplICs9IEk5MTVfR1RUX1BBR0VfU0laRTsKKworCQllcnIgPSBfX2xpdmVfY29udGV4dF9zaXpl
KGVuZ2luZSwgZml4bWUpOworCisJCWVuZ2luZS0+Y29udGV4dF9zaXplIC09IEk5MTVfR1RUX1BB
R0VfU0laRTsKKworCQllbmdpbmUtPnBpbm5lZF9kZWZhdWx0X3N0YXRlID0gc2F2ZWQucGlubmVk
OworCQllbmdpbmUtPmRlZmF1bHRfc3RhdGUgPSBzYXZlZC5zdGF0ZTsKKworCQlpbnRlbF9lbmdp
bmVfcG1fcHV0KGVuZ2luZSk7CisKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCX0KKworCWtlcm5l
bF9jb250ZXh0X2Nsb3NlKGZpeG1lKTsKK3VubG9jazoKKwltdXRleF91bmxvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKKwlyZXR1cm4gZXJyOworfQorCiBzdGF0aWMgaW50IF9fbGl2
ZV9hY3RpdmVfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkJIHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZSkKIHsKQEAgLTMwMyw2ICs0MzAsNyBAQCBzdGF0
aWMgaW50IGxpdmVfcmVtb3RlX2NvbnRleHQodm9pZCAqYXJnKQogaW50IGludGVsX2NvbnRleHRf
bGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RhdGlj
IGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZlX2Nv
bnRleHRfc2l6ZSksCiAJCVNVQlRFU1QobGl2ZV9hY3RpdmVfY29udGV4dCksCiAJCVNVQlRFU1Qo
bGl2ZV9yZW1vdGVfY29udGV4dCksCiAJfTsKLS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 69F51140FB9
	for <lists+intel-gfx@lfdr.de>; Fri, 17 Jan 2020 18:16:16 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A6BA16F875;
	Fri, 17 Jan 2020 17:16:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5C9126F64C;
 Fri, 17 Jan 2020 17:16:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19919960-1500050 
 for multiple; Fri, 17 Jan 2020 17:15:47 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 17 Jan 2020 17:15:41 +0000
Message-Id: <20200117171545.3212625-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 1/5] lib/intel_bufops: Introduce buffer
 operations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogWmJpZ25pZXcgS2VtcGN6ecWEc2tpIDx6Ymlnbmlldy5rZW1wY3p5bnNraUBpbnRlbC5j
b20+CgpEaWZmZXJlbnQgR0VOcyBzdXBwb3J0cyBkaWZmZXJlbnQgdGlsZSBzdXJmYWNlcy4gT2xk
ZXIgR0VOcwpoYXZlIEhXIGZlbmNlcyB0byBhbGxvdyBYIC8gWSBzdXJmYWNlIHRpbGluZyAvIGRl
dGlsaW5nLgpOZXdlciBHRU5zIGhhdmUgdG8gdGlsZSAvIGRldGlsZSBzdWNoIHN1cmZhY2UgaW4g
c29mdHdhcmUuCgpUbyBtYWtlIHRlc3QgZGV2ZWxvcGVyIGxpZmUgZWFzaWVyIHRoaXMgY29kZSBh
ZGRzIGJ1ZmZlcgpvcGVyYXRpb25zIChzaG9ydCBidWZfb3BzKSB0byB1c2UgYXBwcm9wcmlhdGUg
ZnVuY3Rpb25zIGFsbG93aW5nCmNvcHlpbmcgbGluZWFyIGJ1ZmZlciB0byBCTyBhbmQgZnJvbSBC
TyB0byBsaW5lYXIgYnVmZmVyCnJlZ2FyZGxlc3MgR1BVIGdlbmVyYXRpb24gYW5kIHRpbGluZy9z
d2l6emxpbmcgd2l0aGluIEJPLiBGb3IgR0VOcwpoYXZpbmcgZmVuY2VzIHN1cHBvcnQgcHJlZmVy
ZW5jZSBpcyB0byB1c2UgdGhlbSBpZiB0aGV5IGFyZSBhdmFpbGFibGUKKFggLyBZIHRpbGluZyBp
cyBwcm9iZWQgb24gYnVmX29wcyBpbml0aWFsaXphdGlvbikuCgpOb3RlOiBvbiBHZW4yIGNvZGUg
c3VwcG9ydHMgb25seSBIVyB0aWxpbmcgYXQgdGhlIG1vbWVudC4KClNpZ25lZC1vZmYtYnk6IFpi
aWduaWV3IEtlbXBjennFhHNraSA8emJpZ25pZXcua2VtcGN6eW5za2lAaW50ZWwuY29tPgpDYzog
Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBLYXRhcnp5bmEgRGVj
IDxrYXRhcnp5bmEuZGVjQGludGVsLmNvbT4KLS0tCiAuLi4vaWd0LWdwdS10b29scy9pZ3QtZ3B1
LXRvb2xzLWRvY3MueG1sICAgICAgfCAgICAxICsKIGxpYi9NYWtlZmlsZS5zb3VyY2VzICAgICAg
ICAgICAgICAgICAgICAgICAgICB8ICAgIDIgKwogbGliL2ludGVsX2J1Zm9wcy5jICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHwgMTE1MCArKysrKysrKysrKysrKysrKwogbGliL2ludGVsX2J1
Zm9wcy5oICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICA4NiArKwogbGliL21lc29uLmJ1
aWxkICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgMSArCiA1IGZpbGVzIGNoYW5n
ZWQsIDEyNDAgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGxpYi9pbnRlbF9idWZv
cHMuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGxpYi9pbnRlbF9idWZvcHMuaAoKZGlmZiAtLWdpdCBh
L2RvY3MvcmVmZXJlbmNlL2lndC1ncHUtdG9vbHMvaWd0LWdwdS10b29scy1kb2NzLnhtbCBiL2Rv
Y3MvcmVmZXJlbmNlL2lndC1ncHUtdG9vbHMvaWd0LWdwdS10b29scy1kb2NzLnhtbAppbmRleCA0
NTRkNjRlNTMuLmFhOWZlZjIwNSAxMDA2NDQKLS0tIGEvZG9jcy9yZWZlcmVuY2UvaWd0LWdwdS10
b29scy9pZ3QtZ3B1LXRvb2xzLWRvY3MueG1sCisrKyBiL2RvY3MvcmVmZXJlbmNlL2lndC1ncHUt
dG9vbHMvaWd0LWdwdS10b29scy1kb2NzLnhtbApAQCAtNDIsNiArNDIsNyBAQAogICAgIDx4aTpp
bmNsdWRlIGhyZWY9InhtbC9pZ3RfdmdlbS54bWwiLz4KICAgICA8eGk6aW5jbHVkZSBocmVmPSJ4
bWwvaWd0X3g4Ni54bWwiLz4KICAgICA8eGk6aW5jbHVkZSBocmVmPSJ4bWwvaW50ZWxfYmF0Y2hi
dWZmZXIueG1sIi8+CisgICAgPHhpOmluY2x1ZGUgaHJlZj0ieG1sL2ludGVsX2J1Zm9wcy54bWwi
Lz4KICAgICA8eGk6aW5jbHVkZSBocmVmPSJ4bWwvaW50ZWxfY2hpcHNldC54bWwiLz4KICAgICA8
eGk6aW5jbHVkZSBocmVmPSJ4bWwvaW50ZWxfaW8ueG1sIi8+CiAgICAgPHhpOmluY2x1ZGUgaHJl
Zj0ieG1sL2lvY3RsX3dyYXBwZXJzLnhtbCIvPgpkaWZmIC0tZ2l0IGEvbGliL01ha2VmaWxlLnNv
dXJjZXMgYi9saWIvTWFrZWZpbGUuc291cmNlcwppbmRleCA1ZGQzOTYyZWUuLmRhMzRlYWU3MyAx
MDA2NDQKLS0tIGEvbGliL01ha2VmaWxlLnNvdXJjZXMKKysrIGIvbGliL01ha2VmaWxlLnNvdXJj
ZXMKQEAgLTY3LDYgKzY3LDggQEAgbGliX3NvdXJjZV9saXN0ID0JIAlcCiAJaW50ZWxfYXViLmgJ
CVwKIAlpbnRlbF9iYXRjaGJ1ZmZlci5jCVwKIAlpbnRlbF9iYXRjaGJ1ZmZlci5oCVwKKwlpbnRl
bF9idWZvcHMuYwkJXAorCWludGVsX2J1Zm9wcy5oCQlcCiAJaW50ZWxfY2hpcHNldC5jCQlcCiAJ
aW50ZWxfY2hpcHNldC5oCQlcCiAJaW50ZWxfZGV2aWNlX2luZm8uYwlcCmRpZmYgLS1naXQgYS9s
aWIvaW50ZWxfYnVmb3BzLmMgYi9saWIvaW50ZWxfYnVmb3BzLmMKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwLi44ZWE0MjU3ZjUKLS0tIC9kZXYvbnVsbAorKysgYi9saWIvaW50
ZWxfYnVmb3BzLmMKQEAgLTAsMCArMSwxMTUwIEBACisvKgorICogQ29weXJpZ2h0IMKpIDIwMjAg
SW50ZWwgQ29ycG9yYXRpb24KKyAqCisgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBm
cmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQorICogY29weSBvZiB0aGlz
IHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdh
cmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGlu
Y2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBt
b2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLAorICogYW5kL29y
IHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdo
b20gdGhlCisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhl
IGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNl
IGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcgdGhlIG5leHQKKyAqIHBhcmFn
cmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0
aW9ucyBvZiB0aGUKKyAqIFNvZnR3YXJlLgorICoKKyAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURF
RCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCisgKiBJ
TVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1F
UkNIQU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBO
T05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAorICogVEhFIEFVVEhPUlMgT1IgQ09Q
WVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIK
KyAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1Ig
T1RIRVJXSVNFLCBBUklTSU5HCisgKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRI
IFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTCisgKiBJTiBUSEUgU09G
VFdBUkUuCisgKgorICovCisKKyNpbmNsdWRlIDxzeXMvaW9jdGwuaD4KKyNpbmNsdWRlICJpZ3Qu
aCIKKyNpbmNsdWRlICJpZ3RfeDg2LmgiCisjaW5jbHVkZSAiaW50ZWxfYnVmb3BzLmgiCisKKy8q
KgorICogU0VDVElPTjppbnRlbF9idWZvcHMKKyAqIEBzaG9ydF9kZXNjcmlwdGlvbjogQnVmZmVy
IG9wZXJhdGlvbiBvbiB0aWxlZCBzdXJmYWNlcworICogQHRpdGxlOiBCdWZmZXIgb3BlcmF0aW9u
cworICogQGluY2x1ZGU6IGlndC5oCisgKgorICogIyBCdWZmZXIgb3BlcmF0aW9ucworICoKKyAq
IEludGVsIEdQVSBkZXZpY2VzIHN1cHBvcnRzIGRpZmZlcmVudCBzZXQgb2YgdGlsZWQgc3VyZmFj
ZXMuCisgKiBDaGVja2luZyBlYWNoIHRpbWUgd2hhdCB0aWxlIGZvcm1hdHMgYXJlIHN1cHBvcnRz
IGlzIGN1bWJlcnNvbWUgYW5kCisgKiBlcnJvciBwcm9uZS4KKyAqCisgKiBCdWZmZXIgb3BlcmF0
aW9uIChidWZfb3BzKSBwcm92aWRlIGEgd3JhcHBlciB0byBjb25kaXRpb25hbCBjb2RlIHdoaWNo
CisgKiBjYW4gYmUgdXNlZCB3aXRob3V0IHdvcnJ5aW5nIG9mIGltcGxlbWVudGF0aW9uIGRldGFp
bHMgZ2l2aW5nOgorICogLSBjb3B5IGxpbmVhciB0byB0aWxlZCBidWZmZXIKKyAqIC0gY29weSB0
aWxlZCBidWZmZXIgdG8gbGluZWFyCisgKgorICogRm9sbG93aW5nIGNvZGUgb3JkZXIgc2hvdWxk
IGJlIHVzZWQgKGxpbmVhciBpcyBwbGFpbiBtZW1vcnkgd2l0aCBzb21lCisgKiBpbWFnZSBkYXRh
KToKKyAqCisgKiB8WzwhLS0gbGFuZ3VhZ2U9ImMiIC0tPgorICogc3RydWN0IGJ1Zl9vcHMgKmJv
cHM7CisgKiBzdHJ1Y3QgaW50ZWxfYnVmIGlidWY7CisgKiAuLi4KKyAqIGJvcHMgPSBidWZfb3Bz
X2NyZWF0ZShmZCk7CisgKiBpbnRlbF9idWZfaW5pdChib3BzLCAmaWJ1ZiwgNTEyLCA1MTIsIDMy
LCBJOTE1X1RJTElOR19YLCBmYWxzZSk7CisgKiAuLi4KKyAqIGxpbmVhcl90b19pbnRlbF9idWYo
Ym9wcywgJmlidWYsIGxpbmVhcik7CisgKiAuLi4KKyAqIGludGVsX2J1Zl90b19saW5lYXIoYm9w
cywgJmlidWYsIGxpbmVhcik7CisgKiAuLi4KKyAqIGludGVsX2J1Zl9jbG9zZShib3BzLCAmaWJ1
Zik7CisgKiAuLi4KKyAqIGJ1Zl9vcHNfZGVzdHJveShib3BzKTsKKyAqIF18CisgKgorICogQ2Fs
bGluZyBidWZfb3BzX2NyZWF0ZShmZCkgcHJvYmVzIGhhcmR3YXJlIGNhcGFiaWxpdGllcyAoc3Vw
cG9ydGVkIGZlbmNlcywKKyAqIHN3aXp6bGluZykgYW5kIHJldHVybnMgb3BhcXVlIHBvaW50ZXIg
dG8gYnVmX29wcy4gRnJvbSBub3cgb24KKyAqIGludGVsX2J1Zl90b19saW5lYXIoKSBhbmQgbGlu
ZWFyX3RvX2ludGVsX2J1ZigpIHdpbGwgY2hvb3NlIGFwcHJvcHJpYXRlCisgKiBmdW5jdGlvbiB0
byBkbyB0aGUgam9iLgorICoKKyAqIE5vdGU6IGJ1Zm9wcyBkb2Vzbid0IHN1cHBvcnQgU1cgdGls
aW5nIGNvZGUgeWV0LgorICovCisKKy8vI2RlZmluZSBCVUZPUFNfREVCVUdHSU5HCisjaWZkZWYg
QlVGT1BTX0RFQlVHR0lORworI2RlZmluZSBERUJVRyguLi4pIHByaW50ZihfX1ZBX0FSR1NfXykK
KyNkZWZpbmUgREVCVUdGTigpIERFQlVHKCJcdCAtPiAlcygpXG4iLCBfX0ZVTkNUSU9OX18pCisj
ZWxzZQorI2RlZmluZSBERUJVRyguLi4pCisjZGVmaW5lIERFQlVHRk4oKQorI2VuZGlmCisKKyNk
ZWZpbmUgVElMRV9ERUYoeCkgKDEgPDwgKHgpKQorI2RlZmluZSBUSUxFX05PTkUgICBUSUxFX0RF
RihJOTE1X1RJTElOR19OT05FKQorI2RlZmluZSBUSUxFX1ggICAgICBUSUxFX0RFRihJOTE1X1RJ
TElOR19YKQorI2RlZmluZSBUSUxFX1kgICAgICBUSUxFX0RFRihJOTE1X1RJTElOR19ZKQorI2Rl
ZmluZSBUSUxFX1lmICAgICBUSUxFX0RFRihJOTE1X1RJTElOR19ZZikKKyNkZWZpbmUgVElMRV9Z
cyAgICAgVElMRV9ERUYoSTkxNV9USUxJTkdfWXMpCisKKyNkZWZpbmUgQ0NTX09GRlNFVChidWYp
IChidWYtPmF1eC5vZmZzZXQpCisjZGVmaW5lIENDU19TSVpFKGdlbiwgYnVmKSBcCisJKGludGVs
X2J1Zl9hdXhfd2lkdGgoZ2VuLCBidWYpICogaW50ZWxfYnVmX2F1eF9oZWlnaHQoZ2VuLCBidWYp
KQorCit0eXBlZGVmIHZvaWQgKCpib19jb3B5KShzdHJ1Y3QgYnVmX29wcyAqLCBzdHJ1Y3QgaW50
ZWxfYnVmICosIHVpbnQzMl90ICopOworCitzdHJ1Y3QgYnVmX29wcyB7CisJaW50IGZkOworCWlu
dCBnZW5fc3RhcnQ7CisJaW50IGdlbl9lbmQ7CisJaW50IGludGVsX2dlbjsKKwl1aW50MzJfdCBz
dXBwb3J0ZWRfdGlsZXM7CisJdWludDMyX3Qgc3VwcG9ydGVkX2h3X3RpbGVzOworCXVpbnQzMl90
IHN3aXp6bGVfeDsKKwl1aW50MzJfdCBzd2l6emxlX3k7CisJYm9fY29weSBsaW5lYXJfdG87CisJ
Ym9fY29weSBsaW5lYXJfdG9feDsKKwlib19jb3B5IGxpbmVhcl90b195OworCWJvX2NvcHkgbGlu
ZWFyX3RvX3lmOworCWJvX2NvcHkgbGluZWFyX3RvX3lzOworCWJvX2NvcHkgdG9fbGluZWFyOwor
CWJvX2NvcHkgeF90b19saW5lYXI7CisJYm9fY29weSB5X3RvX2xpbmVhcjsKKwlib19jb3B5IHlm
X3RvX2xpbmVhcjsKKwlib19jb3B5IHlzX3RvX2xpbmVhcjsKK307CisKK3N0YXRpYyBjb25zdCBj
aGFyICp0aWxpbmdfc3RyKHVpbnQzMl90IHRpbGluZykKK3sKKwlzd2l0Y2ggKHRpbGluZykgewor
CWNhc2UgSTkxNV9USUxJTkdfTk9ORTogcmV0dXJuICJOT05FIjsKKwljYXNlIEk5MTVfVElMSU5H
X1g6ICAgIHJldHVybiAiWCI7CisJY2FzZSBJOTE1X1RJTElOR19ZOiAgICByZXR1cm4gIlkiOwor
CWNhc2UgSTkxNV9USUxJTkdfWWY6ICAgcmV0dXJuICJZZiI7CisJY2FzZSBJOTE1X1RJTElOR19Z
czogICByZXR1cm4gIllzIjsKKwlkZWZhdWx0OiAgICAgICAgICAgICAgIHJldHVybiAiVU5LTk9X
TiI7CisJfQorfQorCitzdGF0aWMgY29uc3QgY2hhciAqYm9vbF9zdHIoYm9vbCB2KQoreworCXJl
dHVybiB2ID8gInllcyIgOiAibm8iOworfQorCitzdGF0aWMgaW5saW5lIGJvb2wgaXNfaHdfdGls
aW5nX3N1cHBvcnRlZChzdHJ1Y3QgYnVmX29wcyAqYm9wcywgdWludDMyX3QgdGlsaW5nKQorewor
CXJldHVybiBib3BzLT5zdXBwb3J0ZWRfaHdfdGlsZXMgJiBUSUxFX0RFRih0aWxpbmcpOworfQor
CitzdGF0aWMgaW5saW5lIGJvb2wgaXNfdGlsaW5nX3N1cHBvcnRlZChzdHJ1Y3QgYnVmX29wcyAq
Ym9wcywgdWludDMyX3QgdGlsaW5nKQoreworCXJldHVybiBib3BzLT5zdXBwb3J0ZWRfdGlsZXMg
JiBUSUxFX0RFRih0aWxpbmcpOworfQorCitzdGF0aWMgaW50IF9fZ2VtX2dldF90aWxpbmcoaW50
IGZkLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2dldF90aWxpbmcgKmFyZykKK3sKKwlpbnQgZXJyOwor
CisJZXJyID0gMDsKKwlpZiAoaWd0X2lvY3RsKGZkLCBEUk1fSU9DVExfSTkxNV9HRU1fR0VUX1RJ
TElORywgYXJnKSkgeworCQllcnIgPSAtZXJybm87CisJCWlndF9hc3N1bWUoZXJyKTsKKwl9CisJ
ZXJybm8gPSAwOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGJvb2wgX19nZXRfdGlsaW5n
KGludCBmZCwgdWludDMyX3QgaGFuZGxlLCB1aW50MzJfdCAqdGlsaW5nLAorCQkJIHVpbnQzMl90
ICpzd2l6emxlKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fZ2V0X3RpbGluZyBnZXRfdGlsaW5n
ID0geyAuaGFuZGxlID0gaGFuZGxlIH07CisKKwlpZiAoX19nZW1fZ2V0X3RpbGluZyhmZCwgJmdl
dF90aWxpbmcpICE9IDApCisJCXJldHVybiBmYWxzZTsKKworCSp0aWxpbmcgPSBnZXRfdGlsaW5n
LnRpbGluZ19tb2RlOworCSpzd2l6emxlID0gZ2V0X3RpbGluZy5zd2l6emxlX21vZGU7CisJaWd0
X2RlYnVnKCJidWYgdGlsaW5nOiAlcywgc3dpenpsZTogJXgsIHBoeXNfc3dpenpsZTogJXhcbiIs
CisJCSAgdGlsaW5nX3N0cihnZXRfdGlsaW5nLnRpbGluZ19tb2RlKSwKKwkJICBnZXRfdGlsaW5n
LnN3aXp6bGVfbW9kZSwKKwkJICBnZXRfdGlsaW5nLnBoeXNfc3dpenpsZV9tb2RlKTsKKworCXJl
dHVybiBnZXRfdGlsaW5nLnBoeXNfc3dpenpsZV9tb2RlID09IGdldF90aWxpbmcuc3dpenpsZV9t
b2RlOworfQorCitzdGF0aWMgaW50IF9fc2V0X3RpbGluZyhpbnQgZmQsIHVpbnQzMl90IGhhbmRs
ZSwgdWludDMyX3QgdGlsaW5nLAorCQkJdWludDMyX3Qgc3RyaWRlKQoreworCWRvIHsKKwkJc3Ry
dWN0IGRybV9pOTE1X2dlbV9zZXRfdGlsaW5nIHN0OworCQlpbnQgZXJyOworCisJCXN0LmhhbmRs
ZSA9IGhhbmRsZTsKKwkJc3QudGlsaW5nX21vZGUgPSB0aWxpbmc7CisJCXN0LnN0cmlkZSA9IHRp
bGluZyA/IHN0cmlkZSA6IDA7CisKKwkJZXJyID0gMDsKKwkJaWYgKGlvY3RsKGZkLCBEUk1fSU9D
VExfSTkxNV9HRU1fU0VUX1RJTElORywgJnN0KSkKKwkJCWVyciA9IC1lcnJubzsKKwkJZXJybm8g
PSAwOworCQlpZiAoZXJyICE9IC1FSU5UUikKKwkJCXJldHVybiBlcnI7CisJfSB3aGlsZSAoMSk7
Cit9CisKK3N0YXRpYyB2b2lkIHNldF9od190aWxlZChzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3Ry
dWN0IGludGVsX2J1ZiAqYnVmKQoreworCWlmIChidWYtPnRpbGluZyAhPSBJOTE1X1RJTElOR19Y
ICYmIGJ1Zi0+dGlsaW5nICE9IEk5MTVfVElMSU5HX1kpCisJCXJldHVybjsKKworCWlmICghYnVm
X29wc19oYXNfaHdfZmVuY2UoYm9wcywgYnVmLT50aWxpbmcpKQorCQlyZXR1cm47CisKKwlpZ3Rf
YXNzZXJ0X2VxKF9fc2V0X3RpbGluZyhib3BzLT5mZCwKKwkJCQkgICBidWYtPmhhbmRsZSwgYnVm
LT50aWxpbmcsIGJ1Zi0+c3RyaWRlKSwKKwkJICAgICAgMCk7Cit9CisKK3N0YXRpYyB1bnNpZ25l
ZCBsb25nIHN3aXp6bGVfYml0KHVuc2lnbmVkIGludCBiaXQsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0
KQoreworCXJldHVybiAob2Zmc2V0ICYgKDF1bCA8PCBiaXQpKSA+PiAoYml0IC0gNik7Cit9CisK
K3N0YXRpYyB1bnNpZ25lZCBsb25nIHN3aXp6bGVfYWRkcih2b2lkICpwdHIsIHVpbnQzMl90IHN3
aXp6bGUpCit7CisJdW5zaWduZWQgbG9uZyBhZGRyID0gdG9fdXNlcl9wb2ludGVyKHB0cik7CisK
Kwlzd2l0Y2ggKHN3aXp6bGUpIHsKKwljYXNlIEk5MTVfQklUXzZfU1dJWlpMRV9OT05FOgorCQly
ZXR1cm4gYWRkcjsKKwljYXNlIEk5MTVfQklUXzZfU1dJWlpMRV85OgorCQlyZXR1cm4gYWRkciBe
IHN3aXp6bGVfYml0KDksIGFkZHIpOworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFXzlfMTA6CisJ
CXJldHVybiBhZGRyIF4gc3dpenpsZV9iaXQoOSwgYWRkcikgXiBzd2l6emxlX2JpdCgxMCwgYWRk
cik7CisJY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMToKKwkJcmV0dXJuIGFkZHIgXiBzd2l6
emxlX2JpdCg5LCBhZGRyKSBeIHN3aXp6bGVfYml0KDExLCBhZGRyKTsKKwljYXNlIEk5MTVfQklU
XzZfU1dJWlpMRV85XzEwXzExOgorCQlyZXR1cm4gKGFkZHIgXgorCQkJc3dpenpsZV9iaXQoOSwg
YWRkcikgXgorCQkJc3dpenpsZV9iaXQoMTAsIGFkZHIpIF4KKwkJCXN3aXp6bGVfYml0KDExLCBh
ZGRyKSk7CisKKwljYXNlIEk5MTVfQklUXzZfU1dJWlpMRV9VTktOT1dOOgorCWNhc2UgSTkxNV9C
SVRfNl9TV0laWkxFXzlfMTc6CisJY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMF8xNzoKKwlk
ZWZhdWx0OgorCQlpZ3Rfc2tpcCgicGh5c2ljYWwgc3dpenpsaW5nIG1vZGUgaW1wb3NzaWJsZSB0
byBoYW5kbGUgaW4gdXNlcnNwYWNlXG4iKTsKKwkJcmV0dXJuIGFkZHI7CisJfQorfQorCitzdGF0
aWMgdm9pZCAqeF9wdHIodm9pZCAqcHRyLAorCQkgICB1bnNpZ25lZCBpbnQgeCwgdW5zaWduZWQg
aW50IHksCisJCSAgIHVuc2lnbmVkIGludCBzdHJpZGUsIHVuc2lnbmVkIGludCBjcHApCit7CisJ
Y29uc3QgaW50IHRpbGVfd2lkdGggPSA1MTI7CisJY29uc3QgaW50IHRpbGVfaGVpZ2h0ID0gODsK
Kwljb25zdCBpbnQgdGlsZV9zaXplID0gdGlsZV93aWR0aCAqIHRpbGVfaGVpZ2h0OworCWludCB0
aWxlX3gsIHRpbGVfeTsKKwlpbnQgb2Zmc2V0X3gsIG9mZnNldF95LCBwb3M7CisKKwl4ICo9IGNw
cDsKKwl0aWxlX3ggPSB4IC8gdGlsZV93aWR0aDsKKwl0aWxlX3kgPSB5IC8gdGlsZV9oZWlnaHQ7
CisJb2Zmc2V0X3ggPSAodGlsZV94ICogdGlsZV9zaXplKTsKKwlvZmZzZXRfeSA9ICh0aWxlX3kg
KiBzdHJpZGUgKiB0aWxlX2hlaWdodCk7CisKKwlwb3MgPSAob2Zmc2V0X3kgKyAoeSAlIHRpbGVf
aGVpZ2h0ICogdGlsZV93aWR0aCkgKworCSAgICAgICBvZmZzZXRfeCArICh4ICUgdGlsZV93aWR0
aCkpOworCisJcmV0dXJuIHB0ciArIHBvczsKK30KKworc3RhdGljIHZvaWQgKnlfcHRyKHZvaWQg
KnB0ciwKKwkJICAgdW5zaWduZWQgaW50IHgsIHVuc2lnbmVkIGludCB5LAorCQkgICB1bnNpZ25l
ZCBpbnQgc3RyaWRlLCB1bnNpZ25lZCBpbnQgY3BwKQoreworCWNvbnN0IGludCB0aWxlX3dpZHRo
ID0gMTI4OworCWNvbnN0IGludCB0aWxlX2hlaWdodCA9IDMyOworCWNvbnN0IGludCBvd29yZHMg
PSAxNjsKKwljb25zdCBpbnQgdGlsZV9zaXplID0gdGlsZV93aWR0aCAqIHRpbGVfaGVpZ2h0Owor
CWludCB0aWxlX3gsIHRpbGVfeTsKKwlpbnQgb2Zmc2V0X3gsIG9mZnNldF95LCBwb3M7CisJaW50
IHNoaWZ0X3gsIHNoaWZ0X3k7CisKKwl4ICo9IGNwcDsKKwl0aWxlX3ggPSB4IC8gdGlsZV93aWR0
aDsKKwl0aWxlX3kgPSB5IC8gdGlsZV9oZWlnaHQ7CisJb2Zmc2V0X3ggPSB0aWxlX3ggKiB0aWxl
X3NpemU7CisJb2Zmc2V0X3kgPSB0aWxlX3kgKiBzdHJpZGUgKiB0aWxlX2hlaWdodDsKKwlzaGlm
dF94ID0geCAlIG93b3JkcyArICh4ICUgdGlsZV93aWR0aCkgLyBvd29yZHMgKiB0aWxlX3dpZHRo
ICogY3BwOworCXNoaWZ0X3kgPSB5ICUgdGlsZV9oZWlnaHQgKiBvd29yZHM7CisKKwlwb3MgPSBv
ZmZzZXRfeSArIG9mZnNldF94ICsgc2hpZnRfeCArIHNoaWZ0X3k7CisKKwlyZXR1cm4gcHRyICsg
cG9zOworfQorCitzdGF0aWMgdm9pZCAqeWZfcHRyKHZvaWQgKnB0ciwKKwkJICAgIHVuc2lnbmVk
IGludCB4LCB1bnNpZ25lZCBpbnQgeSwKKwkJICAgIHVuc2lnbmVkIGludCBzdHJpZGUsIHVuc2ln
bmVkIGludCBjcHApCit7CisJY29uc3QgaW50IHRpbGVfc2l6ZSA9IDQgKiAxMDI0OworCWNvbnN0
IGludCB0aWxlX3dpZHRoID0gMTI4OworCWludCByb3dfc2l6ZSA9IChzdHJpZGUgLyB0aWxlX3dp
ZHRoKSAqIHRpbGVfc2l6ZTsKKworCXggKj0gY3BwOyAvKiBjb252ZXJ0IHRvIEJ5dGUgb2Zmc2V0
ICovCisKKwkvKgorCSAqIFdpdGhpbiBhIDRrIFlmIHRpbGUsIHRoZSBieXRlIHN3aXp6bGluZyBw
YXR0ZXJuIGlzCisJICogbXNiLi4uLi4ubHNiCisJICogeHl4eXh5eXl4eHh4CisJICogVGhlIHRp
bGVzIHRoZW1zZWx2ZXMgYXJlIGxhaWQgb3V0IGluIHJvdyBtYWpvciBvcmRlci4KKwkgKi8KKwly
ZXR1cm4gcHRyICsKKwkJKCh4ICYgMHhmKSAqIDEpICsgLyogNHgxIHBpeGVscygzMmJwcCkgPSAx
NkIgKi8KKwkJKCh5ICYgMHgzKSAqIDE2KSArIC8qIDR4NCBwaXhlbHMgPSA2NEIgKi8KKwkJKCgo
eSAmIDB4NCkgPj4gMikgKiA2NCkgKyAvKiAxeDIgNjRCIGJsb2NrcyAqLworCQkoKCh4ICYgMHgx
MCkgPj4gNCkgKiAxMjgpICsgLyogMngyIDY0QiBibG9ja3MgPSAyNTZCIGJsb2NrICovCisJCSgo
KHkgJiAweDgpID4+IDMpICogMjU2KSArIC8qIDJ4MSAyNTZCIGJsb2NrcyAqLworCQkoKCh4ICYg
MHgyMCkgPj4gNSkgKiA1MTIpICsgLyogMngyIDI1NkIgYmxvY2tzICovCisJCSgoKHkgJiAweDEw
KSA+PiA0KSAqIDEwMjQpICsgLyogNHgyIDI1NiBibG9ja3MgKi8KKwkJKCgoeCAmIDB4NDApID4+
IDYpICogMjA0OCkgKyAvKiA0eDQgMjU2QiBibG9ja3MgPSA0ayB0aWxlICovCisJCSgoKHggJiB+
MHg3ZikgPj4gNykgKiB0aWxlX3NpemUpICsgLyogcm93IG9mIHRpbGVzICovCisJCSgoKHkgJiB+
MHgxZikgPj4gNSkgKiByb3dfc2l6ZSk7Cit9CisKK3R5cGVkZWYgdm9pZCAqKCp0aWxlX2ZuKSh2
b2lkICosIHVuc2lnbmVkIGludCwgdW5zaWduZWQgaW50LAorCQkJdW5zaWduZWQgaW50LCB1bnNp
Z25lZCBpbnQpOworc3RhdGljIHRpbGVfZm4gX19nZXRfdGlsZV9mbl9wdHIoaW50IHRpbGluZykK
K3sKKwl0aWxlX2ZuIGZuID0gTlVMTDsKKworCXN3aXRjaCAodGlsaW5nKSB7CisJY2FzZSBJOTE1
X1RJTElOR19YOgorCQlmbiA9IHhfcHRyOworCQlicmVhazsKKwljYXNlIEk5MTVfVElMSU5HX1k6
CisJCWZuID0geV9wdHI7CisJCWJyZWFrOworCWNhc2UgSTkxNV9USUxJTkdfWWY6CisJCWZuID0g
eWZfcHRyOworCQlicmVhazsKKwljYXNlIEk5MTVfVElMSU5HX1lzOgorCQkvKiBUbyBiZSBpbXBs
ZW1lbnRlZCAqLworCQlicmVhazsKKwl9CisKKwlpZ3RfcmVxdWlyZV9mKGZuLCAiQ2FuJ3QgZmlu
ZCB0aWxlIGZ1bmN0aW9uIGZvciB0aWxpbmc6ICVkXG4iLCB0aWxpbmcpOworCXJldHVybiBmbjsK
K30KKworc3RhdGljIGJvb2wgaXNfY2FjaGVfY29oZXJlbnQoaW50IGZkLCB1aW50MzJfdCBoYW5k
bGUpCit7CisJcmV0dXJuIGdlbV9nZXRfY2FjaGluZyhmZCwgaGFuZGxlKSAhPSBJOTE1X0NBQ0hJ
TkdfTk9ORTsKK30KKworZW51bSBjY3NfY29weV9kaXJlY3Rpb24geworCUNDU19MSU5FQVJfVE9f
QlVGLAorCUNDU19CVUZfVE9fTElORUFSLAorfTsKKworc3RhdGljIHZvaWQgX19jb3B5X2Njcyhz
dHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkgICAgICAgdWlu
dDMyX3QgKmxpbmVhciwgZW51bSBjY3NfY29weV9kaXJlY3Rpb24gZGlyKQoreworCXVpbnQ2NF90
IHNpemUsIG9mZnNldCwgY2NzX3NpemU7CisJaW50IGdlbjsKKwl2b2lkICptYXA7CisKKwlpZiAo
IWJ1Zi0+Y29tcHJlc3Npb24pCisJCXJldHVybjsKKworCWdlbiA9IGJvcHMtPmludGVsX2dlbjsK
KwlvZmZzZXQgPSBDQ1NfT0ZGU0VUKGJ1Zik7CisJY2NzX3NpemUgPSBDQ1NfU0laRShnZW4sIGJ1
Zik7CisJc2l6ZSA9IG9mZnNldCArIGNjc19zaXplOworCisJbWFwID0gX19nZW1fbW1hcF9vZmZz
ZXRfX3djKGJvcHMtPmZkLCBidWYtPmhhbmRsZSwgMCwgc2l6ZSwKKwkJCQkgICAgUFJPVF9SRUFE
IHwgUFJPVF9XUklURSk7CisJaWYgKCFtYXApCisJCW1hcCA9IGdlbV9tbWFwX193Yyhib3BzLT5m
ZCwgYnVmLT5oYW5kbGUsIDAsIHNpemUsCisJCQkJICAgUFJPVF9SRUFEIHwgUFJPVF9XUklURSk7
CisKKwlzd2l0Y2ggKGRpcikgeworCWNhc2UgQ0NTX0xJTkVBUl9UT19CVUY6CisJCWdlbV9zZXRf
ZG9tYWluKGJvcHMtPmZkLCBidWYtPmhhbmRsZSwKKwkJCSAgICAgICBJOTE1X0dFTV9ET01BSU5f
V0MsIEk5MTVfR0VNX0RPTUFJTl9XQyk7CisJCWlndF9tZW1jcHlfZnJvbV93YyhtYXAgKyBvZmZz
ZXQsICh1aW50OF90ICopIGxpbmVhciArIG9mZnNldCwKKwkJCQkgICBjY3Nfc2l6ZSk7CisJY2Fz
ZSBDQ1NfQlVGX1RPX0xJTkVBUjoKKwkJZ2VtX3NldF9kb21haW4oYm9wcy0+ZmQsIGJ1Zi0+aGFu
ZGxlLCBJOTE1X0dFTV9ET01BSU5fV0MsIDApOworCQlpZ3RfbWVtY3B5X2Zyb21fd2MoKHVpbnQ4
X3QgKikgbGluZWFyICsgb2Zmc2V0LCBtYXAgKyBvZmZzZXQsCisJCQkJICAgY2NzX3NpemUpOwor
CX0KKworCW11bm1hcChtYXAsIHNpemUpOworfQorCitzdGF0aWMgdm9pZCAqbW1hcF93cml0ZShp
bnQgZmQsIHN0cnVjdCBpbnRlbF9idWYgKmJ1ZikKK3sKKwl2b2lkICptYXA7CisKKwlpZiAoaXNf
Y2FjaGVfY29oZXJlbnQoZmQsIGJ1Zi0+aGFuZGxlKSkgeworCQltYXAgPSBfX2dlbV9tbWFwX29m
ZnNldF9fY3B1KGZkLCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICAgIFBST1Rf
UkVBRCB8IFBST1RfV1JJVEUpOworCQlpZiAoIW1hcCkKKwkJCW1hcCA9IGdlbV9tbWFwX19jcHUo
ZmQsIGJ1Zi0+aGFuZGxlLCAwLCBidWYtPnNpemUsCisJCQkJCSAgICBQUk9UX1JFQUQgfCBQUk9U
X1dSSVRFKTsKKworCQlnZW1fc2V0X2RvbWFpbihmZCwgYnVmLT5oYW5kbGUsCisJCQkgICAgICAg
STkxNV9HRU1fRE9NQUlOX0NQVSwgSTkxNV9HRU1fRE9NQUlOX0NQVSk7CisJfSBlbHNlIHsKKwkJ
bWFwID0gX19nZW1fbW1hcF9vZmZzZXRfX3djKGZkLCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXpl
LAorCQkJCQkgICAgUFJPVF9SRUFEIHwgUFJPVF9XUklURSk7CisJCWlmICghbWFwKQorCQkJbWFw
ID0gZ2VtX21tYXBfX3djKGZkLCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICBQ
Uk9UX1JFQUQgfCBQUk9UX1dSSVRFKTsKKworCQlnZW1fc2V0X2RvbWFpbihmZCwgYnVmLT5oYW5k
bGUsCisJCQkgICAgICAgSTkxNV9HRU1fRE9NQUlOX1dDLCBJOTE1X0dFTV9ET01BSU5fV0MpOwor
CX0KKworCXJldHVybiBtYXA7Cit9CisKK3N0YXRpYyB2b2lkICptbWFwX3JlYWQoaW50IGZkLCBz
dHJ1Y3QgaW50ZWxfYnVmICpidWYpCit7CisJdm9pZCAqbWFwOworCisJaWYgKGdlbV9oYXNfbGxj
KGZkKSB8fCBpc19jYWNoZV9jb2hlcmVudChmZCwgYnVmLT5oYW5kbGUpKSB7CisJCW1hcCA9IF9f
Z2VtX21tYXBfb2Zmc2V0X19jcHUoZmQsIGJ1Zi0+aGFuZGxlLCAwLAorCQkJCQkgICAgIGJ1Zi0+
c2l6ZSwgUFJPVF9SRUFEKTsKKwkJaWYgKCFtYXApCisJCQltYXAgPSBnZW1fbW1hcF9fY3B1KGZk
LCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICAgUFJPVF9SRUFEKTsKKworCQln
ZW1fc2V0X2RvbWFpbihmZCwgYnVmLT5oYW5kbGUsIEk5MTVfR0VNX0RPTUFJTl9DUFUsIDApOwor
CX0gZWxzZSB7CisJCW1hcCA9IF9fZ2VtX21tYXBfb2Zmc2V0X193YyhmZCwgYnVmLT5oYW5kbGUs
IDAsIGJ1Zi0+c2l6ZSwKKwkJCQkJICAgIFBST1RfUkVBRCk7CisJCWlmICghbWFwKQorCQkJbWFw
ID0gZ2VtX21tYXBfX3djKGZkLCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICBQ
Uk9UX1JFQUQpOworCisJCWdlbV9zZXRfZG9tYWluKGZkLCBidWYtPmhhbmRsZSwgSTkxNV9HRU1f
RE9NQUlOX1dDLCAwKTsKKwl9CisKKwlyZXR1cm4gbWFwOworfQorCitzdGF0aWMgdm9pZCBfX2Nv
cHlfbGluZWFyX3RvKGludCBmZCwgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJICAgICBjb25z
dCB1aW50MzJfdCAqbGluZWFyLAorCQkJICAgICBpbnQgdGlsaW5nLCB1aW50MzJfdCBzd2l6emxl
KQoreworCWludCBoZWlnaHQgPSBpbnRlbF9idWZfaGVpZ2h0KGJ1Zik7CisJaW50IHdpZHRoID0g
aW50ZWxfYnVmX3dpZHRoKGJ1Zik7CisJdGlsZV9mbiBmbiA9IF9fZ2V0X3RpbGVfZm5fcHRyKHRp
bGluZyk7CisJdm9pZCAqbWFwID0gbW1hcF93cml0ZShmZCwgYnVmKTsKKworCWZvciAoaW50IHkg
PSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKKwkJZm9yIChpbnQgeCA9IDA7IHggPCB3aWR0aDsgeCsr
KSB7CisJCQl1aW50MzJfdCAqcHRyID0gZm4obWFwLCB4LCB5LCBidWYtPnN0cmlkZSwgYnVmLT5i
cHAvOCk7CisKKwkJCWlmIChzd2l6emxlKQorCQkJCXB0ciA9IGZyb21fdXNlcl9wb2ludGVyKHN3
aXp6bGVfYWRkcihwdHIsCisJCQkJCQkJCSAgICAgc3dpenpsZSkpOworCQkJKnB0ciA9IGxpbmVh
clt5ICogd2lkdGggKyB4XTsKKwkJfQorCX0KKworCW11bm1hcChtYXAsIGJ1Zi0+c2l6ZSk7Cit9
CisKK3N0YXRpYyB2b2lkIGNvcHlfbGluZWFyX3RvX3goc3RydWN0IGJ1Zl9vcHMgKmJvcHMsIHN0
cnVjdCBpbnRlbF9idWYgKmJ1ZiwKKwkJCSAgICAgdWludDMyX3QgKmxpbmVhcikKK3sKKwlERUJV
R0ZOKCk7CisJX19jb3B5X2xpbmVhcl90byhib3BzLT5mZCwgYnVmLCBsaW5lYXIsIEk5MTVfVElM
SU5HX1gsIGJvcHMtPnN3aXp6bGVfeCk7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfbGluZWFyX3Rv
X3koc3RydWN0IGJ1Zl9vcHMgKmJvcHMsIHN0cnVjdCBpbnRlbF9idWYgKmJ1ZiwKKwkJCSAgICAg
dWludDMyX3QgKmxpbmVhcikKK3sKKwlERUJVR0ZOKCk7CisJX19jb3B5X2xpbmVhcl90byhib3Bz
LT5mZCwgYnVmLCBsaW5lYXIsIEk5MTVfVElMSU5HX1ksIGJvcHMtPnN3aXp6bGVfeSk7Cit9CisK
K3N0YXRpYyB2b2lkIGNvcHlfbGluZWFyX3RvX3lmKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1
Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgICB1aW50MzJfdCAqbGluZWFyKQoreworCURFQlVH
Rk4oKTsKKwlfX2NvcHlfbGluZWFyX3RvKGJvcHMtPmZkLCBidWYsIGxpbmVhciwgSTkxNV9USUxJ
TkdfWWYsIDApOworfQorCitzdGF0aWMgdm9pZCBjb3B5X2xpbmVhcl90b195cyhzdHJ1Y3QgYnVm
X29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJICAgICAgdWludDMyX3QgKmxp
bmVhcikKK3sKKwlERUJVR0ZOKCk7CisJX19jb3B5X2xpbmVhcl90byhib3BzLT5mZCwgYnVmLCBs
aW5lYXIsIEk5MTVfVElMSU5HX1lzLCAwKTsKK30KKworc3RhdGljIHZvaWQgX19jb3B5X3RvX2xp
bmVhcihpbnQgZmQsIHN0cnVjdCBpbnRlbF9idWYgKmJ1ZiwKKwkJCSAgICAgdWludDMyX3QgKmxp
bmVhciwgaW50IHRpbGluZywgdWludDMyX3Qgc3dpenpsZSkKK3sKKwlpbnQgaGVpZ2h0ID0gaW50
ZWxfYnVmX2hlaWdodChidWYpOworCWludCB3aWR0aCA9IGludGVsX2J1Zl93aWR0aChidWYpOwor
CXRpbGVfZm4gZm4gPSBfX2dldF90aWxlX2ZuX3B0cih0aWxpbmcpOworCXZvaWQgKm1hcCA9IG1t
YXBfd3JpdGUoZmQsIGJ1Zik7CisKKwlmb3IgKGludCB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7
CisJCWZvciAoaW50IHggPSAwOyB4IDwgd2lkdGg7IHgrKykgeworCQkJdWludDMyX3QgKnB0ciA9
IGZuKG1hcCwgeCwgeSwgYnVmLT5zdHJpZGUsIGJ1Zi0+YnBwLzgpOworCisJCQlpZiAoc3dpenps
ZSkKKwkJCQlwdHIgPSBmcm9tX3VzZXJfcG9pbnRlcihzd2l6emxlX2FkZHIocHRyLAorCQkJCQkJ
CQkgICAgIHN3aXp6bGUpKTsKKwkJCWxpbmVhclt5ICogd2lkdGggKyB4XSA9ICpwdHI7CisJCX0K
Kwl9CisKKwltdW5tYXAobWFwLCBidWYtPnNpemUpOworfQorCitzdGF0aWMgdm9pZCBjb3B5X3hf
dG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJ
CQkgICAgIHVpbnQzMl90ICpsaW5lYXIpCit7CisJREVCVUdGTigpOworCV9fY29weV90b19saW5l
YXIoYm9wcy0+ZmQsIGJ1ZiwgbGluZWFyLCBJOTE1X1RJTElOR19YLCBib3BzLT5zd2l6emxlX3gp
OworfQorCitzdGF0aWMgdm9pZCBjb3B5X3lfdG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpib3Bz
LCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgIHVpbnQzMl90ICpsaW5lYXIpCit7CisJ
REVCVUdGTigpOworCV9fY29weV90b19saW5lYXIoYm9wcy0+ZmQsIGJ1ZiwgbGluZWFyLCBJOTE1
X1RJTElOR19ZLCBib3BzLT5zd2l6emxlX3kpOworfQorCitzdGF0aWMgdm9pZCBjb3B5X3lmX3Rv
X2xpbmVhcihzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJ
ICAgICAgdWludDMyX3QgKmxpbmVhcikKK3sKKwlERUJVR0ZOKCk7CisJX19jb3B5X3RvX2xpbmVh
cihib3BzLT5mZCwgYnVmLCBsaW5lYXIsIEk5MTVfVElMSU5HX1lmLCAwKTsKK30KKworc3RhdGlj
IHZvaWQgY29weV95c190b19saW5lYXIoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsIHN0cnVjdCBpbnRl
bF9idWYgKmJ1ZiwKKwkJCSAgICAgIHVpbnQzMl90ICpsaW5lYXIpCit7CisJREVCVUdGTigpOwor
CV9fY29weV90b19saW5lYXIoYm9wcy0+ZmQsIGJ1ZiwgbGluZWFyLCBJOTE1X1RJTElOR19Zcywg
MCk7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfbGluZWFyX3RvX2d0dChzdHJ1Y3QgYnVmX29wcyAq
Ym9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJICAgICAgIHVpbnQzMl90ICpsaW5lYXIp
Cit7CisJdm9pZCAqbWFwOworCisJREVCVUdGTigpOworCisJbWFwID0gZ2VtX21tYXBfX2d0dChi
b3BzLT5mZCwgYnVmLT5oYW5kbGUsCisJCQkgICAgYnVmLT5zaXplLCBQUk9UX1JFQUQgfCBQUk9U
X1dSSVRFKTsKKworCWdlbV9zZXRfZG9tYWluKGJvcHMtPmZkLCBidWYtPmhhbmRsZSwKKwkJICAg
ICAgIEk5MTVfR0VNX0RPTUFJTl9HVFQsIEk5MTVfR0VNX0RPTUFJTl9HVFQpOworCisJbWVtY3B5
KG1hcCwgbGluZWFyLCBidWYtPnNpemUpOworCisJbXVubWFwKG1hcCwgYnVmLT5zaXplKTsKK30K
Kworc3RhdGljIHZvaWQgY29weV9ndHRfdG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpib3BzLCBz
dHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgICAgdWludDMyX3QgKmxpbmVhcikKK3sKKwl2
b2lkICptYXA7CisKKwlERUJVR0ZOKCk7CisKKwltYXAgPSBnZW1fbW1hcF9fZ3R0KGJvcHMtPmZk
LCBidWYtPmhhbmRsZSwKKwkJCSAgICBidWYtPnNpemUsIFBST1RfUkVBRCk7CisKKwlnZW1fc2V0
X2RvbWFpbihib3BzLT5mZCwgYnVmLT5oYW5kbGUsCisJCSAgICAgICBJOTE1X0dFTV9ET01BSU5f
R1RULCAwKTsKKworCWlndF9tZW1jcHlfZnJvbV93YyhsaW5lYXIsIG1hcCwgYnVmLT5zaXplKTsK
KworCW11bm1hcChtYXAsIGJ1Zi0+c2l6ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfbGluZWFy
X3RvX3djKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkg
ICAgICB1aW50MzJfdCAqbGluZWFyKQoreworCXZvaWQgKm1hcDsKKworCURFQlVHRk4oKTsKKwor
CW1hcCA9IG1tYXBfd3JpdGUoYm9wcy0+ZmQsIGJ1Zik7CisJbWVtY3B5KG1hcCwgbGluZWFyLCBi
dWYtPnNpemUpOworCW11bm1hcChtYXAsIGJ1Zi0+c2l6ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNv
cHlfd2NfdG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpi
dWYsCisJCQkgICAgICB1aW50MzJfdCAqbGluZWFyKQoreworCXZvaWQgKm1hcDsKKworCURFQlVH
Rk4oKTsKKworCW1hcCA9IG1tYXBfcmVhZChib3BzLT5mZCwgYnVmKTsKKwlpZ3RfbWVtY3B5X2Zy
b21fd2MobGluZWFyLCBtYXAsIGJ1Zi0+c2l6ZSk7CisJbXVubWFwKG1hcCwgYnVmLT5zaXplKTsK
K30KKwordm9pZCBpbnRlbF9idWZfdG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1
Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgdWludDMyX3QgKmxpbmVhcikKK3sKKwlpZ3RfYXNzZXJ0
KGJvcHMpOworCisJc3dpdGNoIChidWYtPnRpbGluZykgeworCWNhc2UgSTkxNV9USUxJTkdfTk9O
RToKKwkJaWd0X2Fzc2VydChib3BzLT50b19saW5lYXIpOworCQlib3BzLT50b19saW5lYXIoYm9w
cywgYnVmLCBsaW5lYXIpOworCQlicmVhazsKKwljYXNlIEk5MTVfVElMSU5HX1g6CisJCWlndF9h
c3NlcnQoYm9wcy0+eF90b19saW5lYXIpOworCQlib3BzLT54X3RvX2xpbmVhcihib3BzLCBidWYs
IGxpbmVhcik7CisJCWJyZWFrOworCWNhc2UgSTkxNV9USUxJTkdfWToKKwkJaWd0X2Fzc2VydChi
b3BzLT55X3RvX2xpbmVhcik7CisJCWJvcHMtPnlfdG9fbGluZWFyKGJvcHMsIGJ1ZiwgbGluZWFy
KTsKKwkJYnJlYWs7CisJY2FzZSBJOTE1X1RJTElOR19ZZjoKKwkJaWd0X2Fzc2VydChib3BzLT55
Zl90b19saW5lYXIpOworCQlib3BzLT55Zl90b19saW5lYXIoYm9wcywgYnVmLCBsaW5lYXIpOwor
CQlicmVhazsKKwljYXNlIEk5MTVfVElMSU5HX1lzOgorCQlpZ3RfYXNzZXJ0KGJvcHMtPnlzX3Rv
X2xpbmVhcik7CisJCWJvcHMtPnlzX3RvX2xpbmVhcihib3BzLCBidWYsIGxpbmVhcik7CisJCWJy
ZWFrOworCX0KKworCWlmIChidWYtPmNvbXByZXNzaW9uKQorCQlfX2NvcHlfY2NzKGJvcHMsIGJ1
ZiwgbGluZWFyLCBDQ1NfQlVGX1RPX0xJTkVBUik7Cit9CisKK3ZvaWQgbGluZWFyX3RvX2ludGVs
X2J1ZihzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJIHVp
bnQzMl90ICpsaW5lYXIpCit7CisJaWd0X2Fzc2VydChib3BzKTsKKworCXN3aXRjaCAoYnVmLT50
aWxpbmcpIHsKKwljYXNlIEk5MTVfVElMSU5HX05PTkU6CisJCWlndF9hc3NlcnQoYm9wcy0+bGlu
ZWFyX3RvKTsKKwkJYm9wcy0+bGluZWFyX3RvKGJvcHMsIGJ1ZiwgbGluZWFyKTsKKwkJYnJlYWs7
CisJY2FzZSBJOTE1X1RJTElOR19YOgorCQlpZ3RfYXNzZXJ0KGJvcHMtPmxpbmVhcl90b194KTsK
KwkJYm9wcy0+bGluZWFyX3RvX3goYm9wcywgYnVmLCBsaW5lYXIpOworCQlicmVhazsKKwljYXNl
IEk5MTVfVElMSU5HX1k6CisJCWlndF9hc3NlcnQoYm9wcy0+bGluZWFyX3RvX3kpOworCQlib3Bz
LT5saW5lYXJfdG9feShib3BzLCBidWYsIGxpbmVhcik7CisJCWJyZWFrOworCWNhc2UgSTkxNV9U
SUxJTkdfWWY6CisJCWlndF9hc3NlcnQoYm9wcy0+bGluZWFyX3RvX3lmKTsKKwkJYm9wcy0+bGlu
ZWFyX3RvX3lmKGJvcHMsIGJ1ZiwgbGluZWFyKTsKKwkJYnJlYWs7CisJY2FzZSBJOTE1X1RJTElO
R19ZczoKKwkJaWd0X2Fzc2VydChib3BzLT5saW5lYXJfdG9feXMpOworCQlib3BzLT5saW5lYXJf
dG9feXMoYm9wcywgYnVmLCBsaW5lYXIpOworCQlicmVhazsKKwl9CisKKwlpZiAoYnVmLT5jb21w
cmVzc2lvbikKKwkJX19jb3B5X2Njcyhib3BzLCBidWYsIGxpbmVhciwgQ0NTX0xJTkVBUl9UT19C
VUYpOworfQorCitzdGF0aWMgdm9pZCBfX2ludGVsX2J1Zl9pbml0KHN0cnVjdCBidWZfb3BzICpi
b3BzLAorCQkJICAgICB1aW50MzJfdCBoYW5kbGUsCisJCQkgICAgIHN0cnVjdCBpbnRlbF9idWYg
KmJ1ZiwKKwkJCSAgICAgaW50IHdpZHRoLCBpbnQgaGVpZ2h0LCBpbnQgYnBwLAorCQkJICAgICB1
aW50MzJfdCByZXFfdGlsaW5nLCB1aW50MzJfdCBjb21wcmVzc2lvbikKK3sKKwl1aW50MzJfdCB0
aWxpbmcgPSByZXFfdGlsaW5nOworCXVpbnQzMl90IHNpemU7CisKKwlpZ3RfYXNzZXJ0KGJvcHMp
OworCWlndF9hc3NlcnQoYnVmKTsKKwlpZ3RfYXNzZXJ0KHdpZHRoID4gMCAmJiBoZWlnaHQgPiAw
KTsKKwlpZ3RfYXNzZXJ0KGJwcCA9PSA4IHx8IGJwcCA9PSAxNiB8fCBicHAgPT0gMzIpOworCisJ
bWVtc2V0KGJ1ZiwgMCwgc2l6ZW9mKCpidWYpKTsKKworCWlmIChjb21wcmVzc2lvbikgeworCQlp
bnQgYXV4X3dpZHRoLCBhdXhfaGVpZ2h0OworCisJCWlndF9yZXF1aXJlKGJvcHMtPmludGVsX2dl
biA+PSA5KTsKKwkJaWd0X2Fzc2VydChyZXFfdGlsaW5nID09IEk5MTVfVElMSU5HX1kgfHwKKwkJ
CSAgIHJlcV90aWxpbmcgPT0gSTkxNV9USUxJTkdfWWYpOworCisJCS8qCisJCSAqIE9uIEdFTjEy
KyB3ZSBhbGlnbiB0aGUgbWFpbiBzdXJmYWNlIHRvIDQgKiA0IG1haW4gc3VyZmFjZQorCQkgKiB0
aWxlcywgd2hpY2ggaXMgNjRrQi4gVGhlc2UgMTYgdGlsZXMgYXJlIG1hcHBlZCBieSA0IEFVWAor
CQkgKiBDQ1MgdW5pdHMsIHRoYXQgaXMgNCAqIDY0IGJ5dGVzLiBUaGVzZSA0IENDUyB1bml0cyBh
cmUgaW4KKwkJICogdHVybiBtYXBwZWQgYnkgb25lIEwxIEFVWCBwYWdlIHRhYmxlIGVudHJ5Lgor
CQkgKi8KKwkJaWYgKGJvcHMtPmludGVsX2dlbiA+PSAxMikKKwkJCWJ1Zi0+c3RyaWRlID0gQUxJ
R04od2lkdGggKiAoYnBwIC8gOCksIDEyOCAqIDQpOworCQllbHNlCisJCQlidWYtPnN0cmlkZSA9
IEFMSUdOKHdpZHRoICogKGJwcCAvIDgpLCAxMjgpOworCisJCWlmIChib3BzLT5pbnRlbF9nZW4g
Pj0gMTIpCisJCQloZWlnaHQgPSBBTElHTihoZWlnaHQsIDQgKiAzMik7CisKKwkJYnVmLT5zaXpl
ID0gYnVmLT5zdHJpZGUgKiBoZWlnaHQ7CisJCWJ1Zi0+dGlsaW5nID0gdGlsaW5nOworCQlidWYt
PmJwcCA9IGJwcDsKKwkJYnVmLT5jb21wcmVzc2lvbiA9IGNvbXByZXNzaW9uOworCisJCWF1eF93
aWR0aCA9IGludGVsX2J1Zl9hdXhfd2lkdGgoYm9wcy0+aW50ZWxfZ2VuLCBidWYpOworCQlhdXhf
aGVpZ2h0ID0gaW50ZWxfYnVmX2F1eF9oZWlnaHQoYm9wcy0+aW50ZWxfZ2VuLCBidWYpOworCisJ
CWJ1Zi0+YXV4Lm9mZnNldCA9IGJ1Zi0+c3RyaWRlICogQUxJR04oaGVpZ2h0LCAzMik7CisJCWJ1
Zi0+YXV4LnN0cmlkZSA9IGF1eF93aWR0aDsKKworCQlzaXplID0gYnVmLT5hdXgub2Zmc2V0ICsg
YXV4X3dpZHRoICogYXV4X2hlaWdodDsKKworCX0gZWxzZSB7CisJCWJ1Zi0+c3RyaWRlID0gQUxJ
R04od2lkdGggKiAoYnBwIC8gOCksIDEyOCk7CisJCWJ1Zi0+c2l6ZSA9IGJ1Zi0+c3RyaWRlICog
aGVpZ2h0OworCQlidWYtPnRpbGluZyA9IHRpbGluZzsKKwkJYnVmLT5icHAgPSBicHA7CisKKwkJ
c2l6ZSA9IGJ1Zi0+c3RyaWRlICogQUxJR04oaGVpZ2h0LCAzMik7CisJfQorCisJaWYgKGhhbmRs
ZSkKKwkJYnVmLT5oYW5kbGUgPSBoYW5kbGU7CisJZWxzZQorCQlidWYtPmhhbmRsZSA9IGdlbV9j
cmVhdGUoYm9wcy0+ZmQsIHNpemUpOworCisJc2V0X2h3X3RpbGVkKGJvcHMsIGJ1Zik7Cit9CisK
Ky8qKgorICogaW50ZWxfYnVmX2luaXQKKyAqIEBib3BzOiBwb2ludGVyIHRvIGJ1Zl9vcHMKKyAq
IEBidWY6IHBvaW50ZXIgdG8gaW50ZWxfYnVmIHN0cnVjdHVyZSB0byBiZSBmaWxsZWQKKyAqIEB3
aWR0aDogc3VyZmFjZSB3aWR0aAorICogQGhlaWdodDogc3VyZmFjZSBoZWlnaHQKKyAqIEBicHA6
IGJpdHMtcGVyLXBpeGVsICg4IC8gMTYgLyAzMikKKyAqIEB0aWxpbmc6IHN1cmZhY2UgdGlsaW5n
CisgKiBAY29tcHJlc3Npb246IHN1cmZhY2UgY29tcHJlc3Npb24gdHlwZQorICoKKyAqIEZ1bmN0
aW9uIGNyZWF0ZXMgbmV3IEJPIHdpdGhpbiBpbnRlbF9idWYgc3RydWN0dXJlIGFuZCBmaWxscyBh
bGwKKyAqIHN0cnVjdHVyZSBmaWVsZHMuCisgKgorICogTm90ZS4gRm9yIFggLyBZIGlmIEdQVSBz
dXBwb3J0cyBmZW5jZXMgSFcgdGlsaW5nIGlzIGNvbmZpZ3VyZWQuCisgKi8KK3ZvaWQgaW50ZWxf
YnVmX2luaXQoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsCisJCSAgICBzdHJ1Y3QgaW50ZWxfYnVmICpi
dWYsCisJCSAgICBpbnQgd2lkdGgsIGludCBoZWlnaHQsIGludCBicHAsCisJCSAgICB1aW50MzJf
dCB0aWxpbmcsIHVpbnQzMl90IGNvbXByZXNzaW9uKQoreworCV9faW50ZWxfYnVmX2luaXQoYm9w
cywgMCwgYnVmLCB3aWR0aCwgaGVpZ2h0LCBicHAsIHRpbGluZywKKwkJCSBjb21wcmVzc2lvbik7
Cit9CisKKy8qKgorICogaW50ZWxfYnVmX2Nsb3NlCisgKiBAYm9wczogcG9pbnRlciB0byBidWZf
b3BzCisgKiBAYnVmOiBwb2ludGVyIHRvIGludGVsX2J1ZiBzdHJ1Y3R1cmUKKyAqCisgKiBGdW5j
dGlvbiBjbG9zZXMgZ2VtIEJPIGluc2lkZSBpbnRlbF9idWYuCisgKi8KK3ZvaWQgaW50ZWxfYnVm
X2Nsb3NlKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYpCit7CisJ
aWd0X2Fzc2VydChib3BzKTsKKwlpZ3RfYXNzZXJ0KGJ1Zik7CisKKwlnZW1fY2xvc2UoYm9wcy0+
ZmQsIGJ1Zi0+aGFuZGxlKTsKK30KKworLyoqCisgKiBpbnRlbF9idWZfaW5pdF91c2luZ19oYW5k
bGUKKyAqIEBib3BzOiBwb2ludGVyIHRvIGJ1Zl9vcHMKKyAqIEBoYW5kbGU6IEJPIGhhbmRsZSBj
cmVhdGVkIGJ5IHRoZSBjYWxsZXIKKyAqIEBidWY6IHBvaW50ZXIgdG8gaW50ZWxfYnVmIHN0cnVj
dHVyZSB0byBiZSBmaWxsZWQKKyAqIEB3aWR0aDogc3VyZmFjZSB3aWR0aAorICogQGhlaWdodDog
c3VyZmFjZSBoZWlnaHQKKyAqIEBicHA6IGJpdHMtcGVyLXBpeGVsICg4IC8gMTYgLyAzMikKKyAq
IEB0aWxpbmc6IHN1cmZhY2UgdGlsaW5nCisgKiBAY29tcHJlc3Npb246IHN1cmZhY2UgY29tcHJl
c3Npb24gdHlwZQorICoKKyAqIEZ1bmN0aW9uIGNvbmZpZ3VyZXMgQk8gaGFuZGxlIHdpdGhpbiBp
bnRlbF9idWYgc3RydWN0dXJlIHBhc3NlZCBieSB0aGUgY2FsbGVyCisgKiAod2l0aCBhbGwgaXRz
IG1ldGFkYXRhIC0gd2lkdGgsIGhlaWdodCwgLi4uKS4gVXNlZnVsIGlmIEJPIHdhcyBjcmVhdGVk
CisgKiBvdXRzaWRlLgorICoKKyAqIE5vdGU6IGludGVsX2J1Zl9jbG9zZSgpIGNhbiBiZSB1c2Vk
IHRvIGNsb3NlIHRoZSBCTyBoYW5kbGUsIGJ1dCBjYWxsZXIKKyAqIG11c3QgYmUgYXdhcmUgdG8g
bm90IGNsb3NlIHRoZSBCTyB0d2ljZS4KKyAqLwordm9pZCBpbnRlbF9idWZfaW5pdF91c2luZ19o
YW5kbGUoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsCisJCQkJIHVpbnQzMl90IGhhbmRsZSwKKwkJCQkg
c3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJCSBpbnQgd2lkdGgsIGludCBoZWlnaHQsIGludCBi
cHAsCisJCQkJIHVpbnQzMl90IHJlcV90aWxpbmcsIHVpbnQzMl90IGNvbXByZXNzaW9uKQorewor
CV9faW50ZWxfYnVmX2luaXQoYm9wcywgaGFuZGxlLCBidWYsIHdpZHRoLCBoZWlnaHQsIGJwcCwg
cmVxX3RpbGluZywKKwkJCSBjb21wcmVzc2lvbik7Cit9CisKKyNkZWZpbmUgREVGQVVMVF9CVUZP
UFMoX19nZW5fc3RhcnQsIF9fZ2VuX2VuZCkgXAorCS5nZW5fc3RhcnQgICAgICAgICAgPSBfX2dl
bl9zdGFydCwgXAorCS5nZW5fZW5kICAgICAgICAgICAgPSBfX2dlbl9lbmQsIFwKKwkuc3VwcG9y
dGVkX2h3X3RpbGVzID0gVElMRV9YIHwgVElMRV9ZLCBcCisJLmxpbmVhcl90byAgICAgICAgICA9
IGNvcHlfbGluZWFyX3RvX3djLCBcCisJLmxpbmVhcl90b194ICAgICAgICA9IGNvcHlfbGluZWFy
X3RvX2d0dCwgXAorCS5saW5lYXJfdG9feSAgICAgICAgPSBjb3B5X2xpbmVhcl90b19ndHQsIFwK
KwkubGluZWFyX3RvX3lmICAgICAgID0gY29weV9saW5lYXJfdG9feWYsIFwKKwkubGluZWFyX3Rv
X3lzICAgICAgID0gY29weV9saW5lYXJfdG9feXMsIFwKKwkudG9fbGluZWFyICAgICAgICAgID0g
Y29weV93Y190b19saW5lYXIsIFwKKwkueF90b19saW5lYXIgICAgICAgID0gY29weV9ndHRfdG9f
bGluZWFyLCBcCisJLnlfdG9fbGluZWFyICAgICAgICA9IGNvcHlfZ3R0X3RvX2xpbmVhciwgXAor
CS55Zl90b19saW5lYXIgICAgICAgPSBjb3B5X3lmX3RvX2xpbmVhciwgXAorCS55c190b19saW5l
YXIgICAgICAgPSBjb3B5X3lzX3RvX2xpbmVhcgorCitzdHJ1Y3QgYnVmX29wcyBidWZfb3BzX2Fy
cltdID0geworCXsKKwkJREVGQVVMVF9CVUZPUFMoMiwgOCksCisJCS5zdXBwb3J0ZWRfdGlsZXMg
ICAgPSBUSUxFX05PTkUgfCBUSUxFX1ggfCBUSUxFX1ksCisJfSwKKworCXsKKwkJREVGQVVMVF9C
VUZPUFMoOSwgMTEpLAorCQkuc3VwcG9ydGVkX3RpbGVzICAgID0gVElMRV9OT05FIHwgVElMRV9Y
IHwgVElMRV9ZIHwgVElMRV9ZZiwKKwl9LAorCisJeworCQlERUZBVUxUX0JVRk9QUygxMiwgMTIp
LAorCQkuc3VwcG9ydGVkX3RpbGVzICAgPSBUSUxFX05PTkUgfCBUSUxFX1ggfCBUSUxFX1kgfCBU
SUxFX1lmIHwgVElMRV9ZcywKKwl9LAorfTsKKworc3RhdGljIGJvb2wgcHJvYmVfaHdfdGlsaW5n
KHN0cnVjdCBidWZfb3BzICpib3BzLCB1aW50MzJfdCB0aWxpbmcpCit7CisJdWludDY0X3Qgc2l6
ZSA9IDI1NiAqIDI1NjsKKwl1aW50MzJfdCBoYW5kbGUsIGJ1Zl90aWxpbmcsIGJ1Zl9zd2l6emxl
OworCXVpbnQzMl90IHN0cmlkZTsKKwlpbnQgcmV0OworCWJvb2wgaXNfc2V0ID0gZmFsc2U7CisK
KwlpZiAodGlsaW5nID09IEk5MTVfVElMSU5HX1gpCisJCXN0cmlkZSA9IDUxMjsKKwllbHNlIGlm
ICh0aWxpbmcgPT0gSTkxNV9USUxJTkdfWSkKKwkJc3RyaWRlID0gMTI4OworCWVsc2UKKwkJcmV0
dXJuIGZhbHNlOworCisJaGFuZGxlID0gZ2VtX2NyZWF0ZShib3BzLT5mZCwgc2l6ZSk7CisKKwkv
KiBTaW5nbGUgc2hvdCwgaWYgbm8gZmVuY2VzIGFyZSBhdmFpbGFibGUgd2UgZmFpbCBpbW1lZGlh
dGVseSAqLworCXJldCA9IF9fc2V0X3RpbGluZyhib3BzLT5mZCwgaGFuZGxlLCB0aWxpbmcsIHN0
cmlkZSk7CisJaWYgKHJldCkKKwkJZ290byBlbmQ7CisKKwlpc19zZXQgPSBfX2dldF90aWxpbmco
Ym9wcy0+ZmQsIGhhbmRsZSwgJmJ1Zl90aWxpbmcsICZidWZfc3dpenpsZSk7CisJaWYgKGlzX3Nl
dCkgeworCQlpZiAodGlsaW5nID09IEk5MTVfVElMSU5HX1gpCisJCQlib3BzLT5zd2l6emxlX3gg
PSBidWZfc3dpenpsZTsKKwkJZWxzZSBpZiAodGlsaW5nID09IEk5MTVfVElMSU5HX1kpCisJCQli
b3BzLT5zd2l6emxlX3kgPSBidWZfc3dpenpsZTsKKwl9CitlbmQ6CisJZ2VtX2Nsb3NlKGJvcHMt
PmZkLCBoYW5kbGUpOworCisJcmV0dXJuIGlzX3NldDsKK30KKworc3RhdGljIHZvaWQgKmFsbG9j
X2FsaWduZWQodWludDY0X3Qgc2l6ZSkKK3sKKwl2b2lkICpwOworCisJaWd0X2Fzc2VydF9lcShw
b3NpeF9tZW1hbGlnbigmcCwgMTYsIHNpemUpLCAwKTsKKworCXJldHVybiBwOworfQorCisvKgor
ICogU2ltcGxlIGlkZW1wb3RlbmN5IHRlc3QgYmV0d2VlbiBIVyAtPiBTVyBhbmQgU1cgLT4gSFcg
Qk8uCisgKi8KK3N0YXRpYyB2b2lkIGlkZW1wb3RlbmN5X3NlbGZ0ZXN0KHN0cnVjdCBidWZfb3Bz
ICpib3BzLCB1aW50MzJfdCB0aWxpbmcpCit7CisJc3RydWN0IGludGVsX2J1ZiBidWY7CisJdWlu
dDhfdCAqbGluZWFyX2luLCAqbGluZWFyX291dCwgKm1hcDsKKwlpbnQgaTsKKwljb25zdCBpbnQg
d2lkdGggPSA1MTI7CisJY29uc3QgaW50IGhlaWdodCA9IDUxMjsKKwljb25zdCBpbnQgYnBwID0g
MzI7CisJY29uc3QgaW50IHNpemUgPSB3aWR0aCAqIGhlaWdodCAqIGJwcCAvIDg7CisJYm9vbCBz
b2Z0d2FyZV90aWxpbmcgPSBmYWxzZTsKKworCWlmICghaXNfaHdfdGlsaW5nX3N1cHBvcnRlZChi
b3BzLCB0aWxpbmcpKQorCQlyZXR1cm47CisKKwlsaW5lYXJfaW4gPSBhbGxvY19hbGlnbmVkKHNp
emUpOworCWxpbmVhcl9vdXQgPSBhbGxvY19hbGlnbmVkKHNpemUpOworCisJZm9yIChpID0gMDsg
aSA8IHNpemU7IGkrKykKKwkJbGluZWFyX2luW2ldID0gaSAlIDI1MzsgLyogcHJpbWUgY2hvc2Vu
IGludGVudGlvbmFsbHkgKi8KKworCWRvIHsKKwkJaWd0X2RlYnVnKCJDaGVja2luZyBpZGVtcG90
ZW5jeSwgU1c6ICVzLCBIVzogJXMsIHRpbGluZzogJXNcbiIsCisJCQkgIGJvb2xfc3RyKHNvZnR3
YXJlX3RpbGluZyksCisJCQkgIGJvb2xfc3RyKCFzb2Z0d2FyZV90aWxpbmcpLAorCQkJICB0aWxp
bmdfc3RyKHRpbGluZykpOworCQlpbnRlbF9idWZfaW5pdChib3BzLCAmYnVmLCB3aWR0aCwgaGVp
Z2h0LCBicHAsIHRpbGluZywgZmFsc2UpOworCQlidWZfb3BzX3NldF9zb2Z0d2FyZV90aWxpbmco
Ym9wcywgdGlsaW5nLCBzb2Z0d2FyZV90aWxpbmcpOworCisJCWxpbmVhcl90b19pbnRlbF9idWYo
Ym9wcywgJmJ1ZiwgKHVpbnQzMl90ICopIGxpbmVhcl9pbik7CisJCW1hcCA9IF9fZ2VtX21tYXBf
b2Zmc2V0X19jcHUoYm9wcy0+ZmQsIGJ1Zi5oYW5kbGUsIDAsCisJCQkJCSAgIGJ1Zi5zaXplLCBQ
Uk9UX1JFQUQpOworCQlpZiAoIW1hcCkKKwkJCW1hcCA9IGdlbV9tbWFwX19jcHUoYm9wcy0+ZmQs
IGJ1Zi5oYW5kbGUsIDAsCisJCQkJCSAgICBidWYuc2l6ZSwgUFJPVF9SRUFEKTsKKwkJZ2VtX3Nl
dF9kb21haW4oYm9wcy0+ZmQsIGJ1Zi5oYW5kbGUsIEk5MTVfR0VNX0RPTUFJTl9DUFUsIDApOwor
CQlpZ3RfYXNzZXJ0KG1lbWNtcChsaW5lYXJfaW4sIG1hcCwgc2l6ZSkpOworCQltdW5tYXAobWFw
LCBzaXplKTsKKworCQlidWZfb3BzX3NldF9zb2Z0d2FyZV90aWxpbmcoYm9wcywgdGlsaW5nLCAh
c29mdHdhcmVfdGlsaW5nKTsKKwkJaW50ZWxfYnVmX3RvX2xpbmVhcihib3BzLCAmYnVmLCAodWlu
dDMyX3QgKikgbGluZWFyX291dCk7CisJCWlndF9hc3NlcnQoIW1lbWNtcChsaW5lYXJfaW4sIGxp
bmVhcl9vdXQsIHNpemUpKTsKKworCQlpbnRlbF9idWZfY2xvc2UoYm9wcywgJmJ1Zik7CisKKwkJ
c29mdHdhcmVfdGlsaW5nID0gIXNvZnR3YXJlX3RpbGluZzsKKwl9IHdoaWxlIChzb2Z0d2FyZV90
aWxpbmcpOworCisJaWd0X2RlYnVnKCJJZGVtcG90ZW5jeSBmb3IgJXMgdGlsaW5nIE9LXG4iLCB0
aWxpbmdfc3RyKHRpbGluZykpOworCWJ1Zl9vcHNfc2V0X3NvZnR3YXJlX3RpbGluZyhib3BzLCB0
aWxpbmcsIGZhbHNlKTsKK30KKworLyoqCisgKiBidWZfb3BzX2NyZWF0ZQorICogQGZkOiBkZXZp
Y2UgZmlsZWRlc2NyaXB0b3IKKyAqCisgKiBDcmVhdGUgYnVmX29wcyBzdHJ1Y3R1cmUgZGVwZW5k
aW5nIG9uIGZkLWRldmljZSBjYXBhYmlsaXRpZXMuCisgKgorICogUmV0dXJuczogb3BhcXVlIHBv
aW50ZXIgdG8gYnVmX29wcy4KKyAqCisgKi8KK3N0cnVjdCBidWZfb3BzICpidWZfb3BzX2NyZWF0
ZShpbnQgZmQpCit7CisJc3RydWN0IGJ1Zl9vcHMgKmJvcHMgPSBjYWxsb2MoMSwgc2l6ZW9mKCpi
b3BzKSk7CisJdWludDMyX3QgZGV2aWQ7CisJaW50IGdlbmVyYXRpb247CisKKwlpZ3RfYXNzZXJ0
KGJvcHMpOworCisJZGV2aWQgPSBpbnRlbF9nZXRfZHJtX2RldmlkKGZkKTsKKwlnZW5lcmF0aW9u
ID0gaW50ZWxfZ2VuKGRldmlkKTsKKworCS8qIFByZWRlZmluZWQgc2V0dGluZ3MgKi8KKwlmb3Ig
KGludCBpID0gMDsgaSA8IEFSUkFZX1NJWkUoYnVmX29wc19hcnIpOyBpKyspIHsKKwkJaWYgKGdl
bmVyYXRpb24gPj0gYnVmX29wc19hcnJbaV0uZ2VuX3N0YXJ0ICYmCisJCSAgICBnZW5lcmF0aW9u
IDw9IGJ1Zl9vcHNfYXJyW2ldLmdlbl9lbmQpIHsKKwkJCW1lbWNweShib3BzLCAmYnVmX29wc19h
cnJbaV0sIHNpemVvZigqYm9wcykpOworCQkJYm9wcy0+ZmQgPSBmZDsKKwkJCWJvcHMtPmludGVs
X2dlbiA9IGdlbmVyYXRpb247CisJCQlpZ3RfZGVidWcoImdlbmVyYXRpb246ICVkLCBzdXBwb3J0
ZWQgdGlsZXM6IDB4JTAyeFxuIiwKKwkJCQkgIGdlbmVyYXRpb24sIGJvcHMtPnN1cHBvcnRlZF90
aWxlcyk7CisJCQlicmVhazsKKwkJfQorCX0KKworCWlndF9hc3NlcnQoYm9wcy0+aW50ZWxfZ2Vu
KTsKKworCS8qCisJICogV2FybmluZyEKKwkgKgorCSAqIEdlbjIgc29mdHdhcmUgdGlsaW5nL2Rl
dGlsaW5nIGlzIG5vdCBzdXBwb3J0ZWQhICh5ZXQpLgorCSAqCisJICogSWYgeW91IGFyZSBicmF2
ZSBoZXJvIHdpdGggYW4gYWNjZXNzIHRvIEdlbjIgeW91IGNhbiBzYXZlIHRoZSB3b3JsZC4KKwkg
KiBVbnRpbCB0aGVuIHdlJ3JlIGRvb21lZCB0byB1c2Ugb25seSBoYXJkd2FyZSAoZGUpdGlsaW5n
LgorCSAqCisJICogT2ssIHlvdSBoYXZlIGJlZW4gd2FybmVkLgorCSAqLworCWlmIChib3BzLT5p
bnRlbF9nZW4gPT0gMikgeworCQlpZ3Rfd2FybigiR2VuMiBkZXRlY3RlZC4gSFcgKGRlKXRpbGlu
ZyBzdXBwb3J0IG9ubHkuIik7CisJCXJldHVybiBib3BzOworCX0KKworCS8qIExldCdzIHByb2Jl
IFggYW5kIFkgaHcgdGlsaW5nIHN1cHBvcnQgKi8KKwlpZiAoaXNfaHdfdGlsaW5nX3N1cHBvcnRl
ZChib3BzLCBJOTE1X1RJTElOR19YKSkgeworCQlib29sIHN1cHBvcnRlZCA9IHByb2JlX2h3X3Rp
bGluZyhib3BzLCBJOTE1X1RJTElOR19YKTsKKworCQlpZ3RfZGVidWcoIlggZmVuY2Ugc3VwcG9y
dDogJXNcbiIsIGJvb2xfc3RyKHN1cHBvcnRlZCkpOworCQlpZiAoIXN1cHBvcnRlZCkgeworCQkJ
Ym9wcy0+c3VwcG9ydGVkX2h3X3RpbGVzICY9IH5USUxFX1g7CisJCQlib3BzLT5saW5lYXJfdG9f
eCA9IGNvcHlfbGluZWFyX3RvX3g7CisJCQlib3BzLT54X3RvX2xpbmVhciA9IGNvcHlfeF90b19s
aW5lYXI7CisJCX0KKwl9CisKKwlpZiAoaXNfaHdfdGlsaW5nX3N1cHBvcnRlZChib3BzLCBJOTE1
X1RJTElOR19ZKSkgeworCQlib29sIHN1cHBvcnRlZCA9IHByb2JlX2h3X3RpbGluZyhib3BzLCBJ
OTE1X1RJTElOR19ZKTsKKworCQlpZ3RfZGVidWcoIlkgZmVuY2Ugc3VwcG9ydDogJXNcbiIsIGJv
b2xfc3RyKHN1cHBvcnRlZCkpOworCQlpZiAoIXN1cHBvcnRlZCkgeworCQkJYm9wcy0+c3VwcG9y
dGVkX2h3X3RpbGVzICY9IH5USUxFX1k7CisJCQlib3BzLT5saW5lYXJfdG9feSA9IGNvcHlfbGlu
ZWFyX3RvX3k7CisJCQlib3BzLT55X3RvX2xpbmVhciA9IGNvcHlfeV90b19saW5lYXI7CisJCX0K
Kwl9CisKKwkvKiBEaXNhYmxlIG90aGVyIHRpbGluZyBmb3JtYXQgZnVuY3Rpb25zIGlmIG5vdCBz
dXBwb3J0ZWQgKi8KKwlpZiAoIWlzX3RpbGluZ19zdXBwb3J0ZWQoYm9wcywgSTkxNV9USUxJTkdf
WWYpKSB7CisJCWlndF9kZWJ1ZygiWWYgZm9ybWF0IG5vdCBzdXBwb3J0ZWRcbiIpOworCQlib3Bz
LT5saW5lYXJfdG9feWYgPSBOVUxMOworCQlib3BzLT55Zl90b19saW5lYXIgPSBOVUxMOworCX0K
KworCWlmICghaXNfdGlsaW5nX3N1cHBvcnRlZChib3BzLCBJOTE1X1RJTElOR19ZcykpIHsKKwkJ
aWd0X2RlYnVnKCJZcyBmb3JtYXQgbm90IHN1cHBvcnRlZFxuIik7CisJCWJvcHMtPmxpbmVhcl90
b195cyA9IE5VTEw7CisJCWJvcHMtPnlzX3RvX2xpbmVhciA9IE5VTEw7CisJfQorCisJaWRlbXBv
dGVuY3lfc2VsZnRlc3QoYm9wcywgSTkxNV9USUxJTkdfWCk7CisJaWRlbXBvdGVuY3lfc2VsZnRl
c3QoYm9wcywgSTkxNV9USUxJTkdfWSk7CisKKwlyZXR1cm4gYm9wczsKK30KKworLyoqCisgKiBi
dWZfb3BzX2Rlc3Ryb3kKKyAqIEBib3BzOiBwb2ludGVyIHRvIGJ1Zl9vcHMKKyAqCisgKiBGdW5j
dGlvbiBmcmVlcyBidWZfb3BzIHN0cnVjdHVyZS4KKyAqLwordm9pZCBidWZfb3BzX2Rlc3Ryb3ko
c3RydWN0IGJ1Zl9vcHMgKmJvcHMpCit7CisJaWd0X2Fzc2VydChib3BzKTsKKwlmcmVlKGJvcHMp
OworfQorCisvKioKKyAqIGJ1Zl9vcHNfc2V0X3NvZnR3YXJlX3RpbGluZworICogQGJvcHM6IHBv
aW50ZXIgdG8gYnVmX29wcworICogQHRpbGluZzogc3VyZmFjZSB0aWxpbmcKKyAqIEB1c2Vfc29m
dHdhcmVfdGlsaW5nOiBpZiB0cnVlIHVzZSBzb2Z0d2FyZSBjb3B5aW5nIG1ldGhvZHMsIG90aGVy
d2lzZQorICogdXNlIGhhcmR3YXJlICh2aWEgZ3R0KQorICoKKyAqIEZ1bmN0aW9uIGFsbG93cyBz
d2l0Y2ggWCAvIFkgc3VyZmFjZXMgdG8gc29mdHdhcmUgLyBoYXJkd2FyZSBjb3B5aW5nIG1ldGhv
ZHMKKyAqIHdoaWNoIGhvbm9ycyB0aWxpbmcgYW5kIHN3aXp6bGluZy4KKyAqCisgKiBSZXR1cm5z
OgorICogZmFsc2UgLSBzd2l0Y2ggd2Fzbid0IHBvc3NpYmxlLgorICogdHJ1ZSAtIHN3aXRjaCB0
byBzb2Z0d2FyZSAvIGhhcmR3YXJlIG1ldGhvZCBzdWNjZWVkLgorICovCitib29sIGJ1Zl9vcHNf
c2V0X3NvZnR3YXJlX3RpbGluZyhzdHJ1Y3QgYnVmX29wcyAqYm9wcywKKwkJCQkgdWludDMyX3Qg
dGlsaW5nLAorCQkJCSBib29sIHVzZV9zb2Z0d2FyZV90aWxpbmcpCit7CisJYm9vbCB3YXNfY2hh
bmdlZCA9IHRydWU7CisKKwlpZ3RfYXNzZXJ0KGJvcHMpOworCisJLyogVW50aWwgYXBwcm9wcmlh
dGUgY29kZSBpcyBhZGRlZCB3ZSBkb24ndCBzdXBwb3J0IFNXIHRpbGluZyBvbiBHZW4yICovCisJ
aWYgKGJvcHMtPmludGVsX2dlbiA9PSAyKSB7CisJCWlndF93YXJuKCJDaGFuZ2UgdG8gc29mdHdh
cmUgdGlsaW5nIG9uIEdlbjIgaXMgbm90IHN1cHBvcnRlZCEiKTsKKwkJcmV0dXJuIGZhbHNlOwor
CX0KKworCXN3aXRjaCAodGlsaW5nKSB7CisJY2FzZSBJOTE1X1RJTElOR19YOgorCQlpZiAodXNl
X3NvZnR3YXJlX3RpbGluZykgeworCQkJaWd0X2RlYnVnKCItPiBjaGFuZ2UgWCB0byBTV1xuIik7
CisJCQlib3BzLT5saW5lYXJfdG9feCA9IGNvcHlfbGluZWFyX3RvX3g7CisJCQlib3BzLT54X3Rv
X2xpbmVhciA9IGNvcHlfeF90b19saW5lYXI7CisJCX0gZWxzZSB7CisJCQlpZiAoaXNfaHdfdGls
aW5nX3N1cHBvcnRlZChib3BzLCBJOTE1X1RJTElOR19YKSkgeworCQkJCWlndF9kZWJ1ZygiLT4g
Y2hhbmdlIFggdG8gSFdcbiIpOworCQkJCWJvcHMtPmxpbmVhcl90b194ID0gY29weV9saW5lYXJf
dG9fZ3R0OworCQkJCWJvcHMtPnhfdG9fbGluZWFyID0gY29weV9ndHRfdG9fbGluZWFyOworCQkJ
fSBlbHNlIHsKKwkJCQlpZ3RfZGVidWcoIi0+IFggY2Fubm90IGJlIGNoYW5nZWQgdG8gSFdcbiIp
OworCQkJCXdhc19jaGFuZ2VkID0gZmFsc2U7CisJCQl9CisJCX0KKwkJYnJlYWs7CisKKwljYXNl
IEk5MTVfVElMSU5HX1k6CisJCWlmICh1c2Vfc29mdHdhcmVfdGlsaW5nKSB7CisJCQlpZ3RfZGVi
dWcoIi0+IGNoYW5nZSBZIHRvIFNXXG4iKTsKKwkJCWJvcHMtPmxpbmVhcl90b195ID0gY29weV9s
aW5lYXJfdG9feTsKKwkJCWJvcHMtPnlfdG9fbGluZWFyID0gY29weV95X3RvX2xpbmVhcjsKKwkJ
fSBlbHNlIHsKKwkJCWlmIChpc19od190aWxpbmdfc3VwcG9ydGVkKGJvcHMsIEk5MTVfVElMSU5H
X1kpKSB7CisJCQkJaWd0X2RlYnVnKCItPiBjaGFuZ2UgWSB0byBIV1xuIik7CisJCQkJYm9wcy0+
bGluZWFyX3RvX3kgPSBjb3B5X2xpbmVhcl90b19ndHQ7CisJCQkJYm9wcy0+eV90b19saW5lYXIg
PSBjb3B5X2d0dF90b19saW5lYXI7CisJCQl9IGVsc2UgeworCQkJCWlndF9kZWJ1ZygiLT4gWSBj
YW5ub3QgYmUgY2hhbmdlZCB0byBIV1xuIik7CisJCQkJd2FzX2NoYW5nZWQgPSBmYWxzZTsKKwkJ
CX0KKwkJfQorCQlicmVhazsKKworCWRlZmF1bHQ6CisJCWlndF93YXJuKCJJbnZhbGlkIHRpbGlu
ZzogJWRcbiIsIHRpbGluZyk7CisJCXdhc19jaGFuZ2VkID0gZmFsc2U7CisJfQorCisJcmV0dXJu
IHdhc19jaGFuZ2VkOworfQorCisvKioKKyAqIGJ1Zl9vcHNfaGFzX2h3X2ZlbmNlCisgKiBAYm9w
czogcG9pbnRlciB0byBidWZfb3BzCisgKiBAdGlsaW5nOiBzdXJmYWNlIHRpbGluZworICoKKyAq
IEZ1bmN0aW9uIGNoZWNrcyBpZiBzdXJmYWNlIHdpdGggdGlsaW5nIGhhcyBIVyBmZW5jZXMgd2hp
Y2ggY2FuIGJlIHVzZWQKKyAqIHRvIGNvcHkgaXQgdmlhIGd0dC4KKyAqCisgKiBSZXR1cm5zOgor
ICogZmFsc2UgLSBmZW5jZSBmb3IgdGlsaW5nIGlzIG5vdCBzdXBwb3J0ZWQuCisgKiB0cnVlIC0g
ZmVuY2UgZm9yIHRpbGluZyBpcyBzdXBwb3J0ZWQuCisgKi8KK2Jvb2wgYnVmX29wc19oYXNfaHdf
ZmVuY2Uoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsIHVpbnQzMl90IHRpbGluZykKK3sKKwl1aW50MzJf
dCB0aWxlX21hc2sgPSBUSUxFX0RFRih0aWxpbmcpOworCisJaWd0X2Fzc2VydChib3BzKTsKKwor
CWlmICh0aWxlX21hc2sgJiBib3BzLT5zdXBwb3J0ZWRfaHdfdGlsZXMpCisJCXJldHVybiB0cnVl
OworCisJcmV0dXJuIGZhbHNlOworfQorCisvKioKKyAqIGJ1Zl9vcHNfaGFzX3RpbGluZ19zdXBw
b3J0CisgKiBAYm9wczogcG9pbnRlciB0byBidWZfb3BzCisgKiBAdGlsaW5nOiBzdXJmYWNlIHRp
bGluZworICoKKyAqIEZ1bmN0aW9uIGNoZWNrcyBjYXBhYmlsaXRpZXMgdG8gaGFuZGxlIHN1cmZh
Y2VzIHdpdGggdGlsaW5nIGluIEdQVS4KKyAqCisgKiBSZXR1cm5zOgorICogZmFsc2UgLSBHUFUg
ZG9lcyBub3Qgc3VwcG9ydCB0aWxpbmcuCisgKiB0cnVlIC0gR1BVIHN1cHBvcnRzIHRpbGluZy4K
KyAqLworYm9vbCBidWZfb3BzX2hhc190aWxpbmdfc3VwcG9ydChzdHJ1Y3QgYnVmX29wcyAqYm9w
cywgdWludDMyX3QgdGlsaW5nKQoreworCXVpbnQzMl90IHRpbGVfbWFzayA9IFRJTEVfREVGKHRp
bGluZyk7CisKKwlpZ3RfYXNzZXJ0KGJvcHMpOworCisJaWYgKHRpbGVfbWFzayAmIGJvcHMtPnN1
cHBvcnRlZF90aWxlcykKKwkJcmV0dXJuIHRydWU7CisKKwlyZXR1cm4gZmFsc2U7Cit9CmRpZmYg
LS1naXQgYS9saWIvaW50ZWxfYnVmb3BzLmggYi9saWIvaW50ZWxfYnVmb3BzLmgKbmV3IGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwLi5mM2Q2YWVkOGEKLS0tIC9kZXYvbnVsbAorKysg
Yi9saWIvaW50ZWxfYnVmb3BzLmgKQEAgLTAsMCArMSw4NiBAQAorI2lmbmRlZiBfX0lOVEVMX0JV
Rk9QU19IX18KKyNkZWZpbmUgX19JTlRFTF9CVUZPUFNfSF9fCisKKyNpbmNsdWRlIDxzdGRpbnQu
aD4KKworc3RydWN0IGJ1Zl9vcHM7CisKK3N0cnVjdCBpbnRlbF9idWYgeworCXVpbnQzMl90IGhh
bmRsZTsKKwl1aW50MzJfdCBzdHJpZGU7CisJdWludDMyX3QgdGlsaW5nOworCXVpbnQzMl90IGJw
cDsKKwl1aW50MzJfdCBzaXplOworCXVpbnQzMl90IGNvbXByZXNzaW9uOworCXN0cnVjdCB7CisJ
CXVpbnQzMl90IG9mZnNldDsKKwkJdWludDMyX3Qgc3RyaWRlOworCX0gYXV4OworfTsKKworc3Rh
dGljIGlubGluZSB1bnNpZ25lZCBpbnQgaW50ZWxfYnVmX3dpZHRoKGNvbnN0IHN0cnVjdCBpbnRl
bF9idWYgKmJ1ZikKK3sKKwlyZXR1cm4gYnVmLT5zdHJpZGUgLyAoYnVmLT5icHAgLyA4KTsKK30K
Kworc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQgaW50ZWxfYnVmX2hlaWdodChjb25zdCBzdHJ1
Y3QgaW50ZWxfYnVmICpidWYpCit7CisJcmV0dXJuIGJ1Zi0+c2l6ZSAvIGJ1Zi0+c3RyaWRlOwor
fQorCitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludAoraW50ZWxfYnVmX2F1eF93aWR0aChpbnQg
Z2VuLCBjb25zdCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYpCit7CisJLyoKKwkgKiBHRU4xMis6IFRo
ZSBBVVggQ0NTIHVuaXQgc2l6ZSBpcyA2NCBieXRlcyBtYXBwaW5nIDQgbWFpbiBzdXJmYWNlCisJ
ICogdGlsZXMuIFRodXMgdGhlIHdpZHRoIG9mIHRoZSBDQ1MgdW5pdCBpcyA0KjMyPTEyOCBwaXhl
bHMgb24gdGhlCisJICogbWFpbiBzdXJmYWNlLgorCSAqLworCWlmIChnZW4gPj0gMTIpCisJCXJl
dHVybiBESVZfUk9VTkRfVVAoaW50ZWxfYnVmX3dpZHRoKGJ1ZiksIDEyOCkgKiA2NDsKKworCXJl
dHVybiBESVZfUk9VTkRfVVAoaW50ZWxfYnVmX3dpZHRoKGJ1ZiksIDEwMjQpICogMTI4OworfQor
CitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludAoraW50ZWxfYnVmX2F1eF9oZWlnaHQoaW50IGdl
biwgY29uc3Qgc3RydWN0IGludGVsX2J1ZiAqYnVmKQoreworCS8qCisJICogR0VOMTIrOiBUaGUg
QVVYIENDUyB1bml0IHNpemUgaXMgNjQgYnl0ZXMgbWFwcGluZyA0IG1haW4gc3VyZmFjZQorCSAq
IHRpbGVzLiBUaHVzIHRoZSBoZWlnaHQgb2YgdGhlIENDUyB1bml0IGlzIDMyIHBpeGVsIHJvd3Mg
b24gdGhlIG1haW4KKwkgKiBzdXJmYWNlLgorCSAqLworCWlmIChnZW4gPj0gMTIpCisJCXJldHVy
biBESVZfUk9VTkRfVVAoaW50ZWxfYnVmX2hlaWdodChidWYpLCAzMik7CisKKwlyZXR1cm4gRElW
X1JPVU5EX1VQKGludGVsX2J1Zl9oZWlnaHQoYnVmKSwgNTEyKSAqIDMyOworfQorCitzdHJ1Y3Qg
YnVmX29wcyAqYnVmX29wc19jcmVhdGUoaW50IGZkKTsKK3ZvaWQgYnVmX29wc19kZXN0cm95KHN0
cnVjdCBidWZfb3BzICpib3BzKTsKKworYm9vbCBidWZfb3BzX3NldF9zb2Z0d2FyZV90aWxpbmco
c3RydWN0IGJ1Zl9vcHMgKmJvcHMsCisJCQkJIHVpbnQzMl90IHRpbGluZywKKwkJCQkgYm9vbCB1
c2Vfc29mdHdhcmVfdGlsaW5nKTsKKwordm9pZCBpbnRlbF9idWZfdG9fbGluZWFyKHN0cnVjdCBi
dWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgdWludDMyX3QgKmxpbmVh
cik7CisKK3ZvaWQgbGluZWFyX3RvX2ludGVsX2J1ZihzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3Ry
dWN0IGludGVsX2J1ZiAqYnVmLAorCQkJIHVpbnQzMl90ICpsaW5lYXIpOworCitib29sIGJ1Zl9v
cHNfaGFzX2h3X2ZlbmNlKHN0cnVjdCBidWZfb3BzICpib3BzLCB1aW50MzJfdCB0aWxpbmcpOwor
Ym9vbCBidWZfb3BzX2hhc190aWxpbmdfc3VwcG9ydChzdHJ1Y3QgYnVmX29wcyAqYm9wcywgdWlu
dDMyX3QgdGlsaW5nKTsKKwordm9pZCBpbnRlbF9idWZfaW5pdChzdHJ1Y3QgYnVmX29wcyAqYm9w
cywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkgICAgaW50IHdpZHRoLCBpbnQgaGVpZ2h0LCBp
bnQgYnBwLAorCQkgICAgdWludDMyX3QgdGlsaW5nLCB1aW50MzJfdCBjb21wcmVzc2lvbik7Cit2
b2lkIGludGVsX2J1Zl9jbG9zZShzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1
ZiAqYnVmKTsKKwordm9pZCBpbnRlbF9idWZfaW5pdF91c2luZ19oYW5kbGUoc3RydWN0IGJ1Zl9v
cHMgKmJvcHMsCisJCQkJIHVpbnQzMl90IGhhbmRsZSwKKwkJCQkgc3RydWN0IGludGVsX2J1ZiAq
YnVmLAorCQkJCSBpbnQgd2lkdGgsIGludCBoZWlnaHQsIGludCBicHAsCisJCQkJIHVpbnQzMl90
IHJlcV90aWxpbmcsIHVpbnQzMl90IGNvbXByZXNzaW9uKTsKKworI2VuZGlmCmRpZmYgLS1naXQg
YS9saWIvbWVzb24uYnVpbGQgYi9saWIvbWVzb24uYnVpbGQKaW5kZXggNTdlYjdkOTM4Li5jZjNl
MzVkYWQgMTAwNjQ0Ci0tLSBhL2xpYi9tZXNvbi5idWlsZAorKysgYi9saWIvbWVzb24uYnVpbGQK
QEAgLTI3LDYgKzI3LDcgQEAgbGliX3NvdXJjZXMgPSBbCiAJJ2lndF94ODYuYycsCiAJJ2luc3Rk
b25lLmMnLAogCSdpbnRlbF9iYXRjaGJ1ZmZlci5jJywKKwknaW50ZWxfYnVmb3BzLmMnLAogCSdp
bnRlbF9jaGlwc2V0LmMnLAogCSdpbnRlbF9kZXZpY2VfaW5mby5jJywKIAknaW50ZWxfb3MuYycs
Ci0tIAoyLjI1LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eAo=

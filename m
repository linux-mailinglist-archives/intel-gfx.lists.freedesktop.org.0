Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 948D3FBC8D
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 00:26:36 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CE2B66E0FE;
	Wed, 13 Nov 2019 23:26:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A4A756E0FE
 for <intel-gfx@lists.freedesktop.org>; Wed, 13 Nov 2019 23:26:33 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 13 Nov 2019 15:26:32 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,302,1569308400"; d="scan'208";a="406140102"
Received: from bruce-dg1.jf.intel.com ([10.165.21.136])
 by fmsmga006.fm.intel.com with ESMTP; 13 Nov 2019 15:26:32 -0800
From: Bruce Chang <yu.bruce.chang@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 13 Nov 2019 15:25:18 -0800
Message-Id: <20191113232518.25945-1-yu.bruce.chang@intel.com>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Fix a bug calling sleep function in
 atomic context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

YmVsb3cgaXMgdGhlIGNhbGwgdHJhY2Ugd2hlbiB0aGlzIGlzc3VlIGlzIGhpdAoKPDM+IFsxMTMu
MzE2MjQ3XSBCVUc6IHNsZWVwaW5nIGZ1bmN0aW9uIGNhbGxlZCBmcm9tIGludmFsaWQgY29udGV4
dCBhdCBtbS9wYWdlX2FsbG9jLmM6NDY1Mwo8Mz4gWzExMy4zMTgxOTBdIGluX2F0b21pYygpOiAx
LCBpcnFzX2Rpc2FibGVkKCk6IDAsIHBpZDogNjc4LCBuYW1lOiBkZWJ1Z2ZzX3Rlc3QKPDQ+IFsx
MTMuMzE5OTAwXSBubyBsb2NrcyBoZWxkIGJ5IGRlYnVnZnNfdGVzdC82NzguCjwzPiBbMTEzLjMy
MTAwMl0gUHJlZW1wdGlvbiBkaXNhYmxlZCBhdDoKPDQ+IFsxMTMuMzIxMTMwXSBbPGZmZmZmZmZm
YTAyNTA2ZDQ+XSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUrMHg0OTQvMHg2MTAgW2k5MTVdCjw0
PiBbMTEzLjMyNzI1OV0gQ2FsbCBUcmFjZToKPDQ+IFsxMTMuMzI3ODcxXSBkdW1wX3N0YWNrKzB4
NjcvMHg5Ygo8ND4gWzExMy4zMjg2ODNdIF9fX21pZ2h0X3NsZWVwKzB4MTY3LzB4MjUwCjw0PiBb
MTEzLjMyOTYxOF0gX19hbGxvY19wYWdlc19ub2RlbWFzaysweDI2Yi8weDExMTAKPDQ+IFsxMTMu
MzMwNzMxXSA/IF9fX3NsYWJfYWxsb2MuY29uc3Rwcm9wLjM0KzB4MjFjLzB4MzgwCjw0PiBbMTEz
LjMzMTk0M10gPyBfX19zbGFiX2FsbG9jLmNvbnN0cHJvcC4zNCsweDIxYy8weDM4MAo8ND4gWzEx
My4zMzMxNjldID8gX19zbGFiX2FsbG9jLmlzcmEuMjguY29uc3Rwcm9wLjMzKzB4NGQvMHg3MAo8
ND4gWzExMy4zMzQ2MTRdIHBvb2xfYWxsb2MuY29uc3Rwcm9wLjE5KzB4MTQvMHg2MCBbaTkxNV0K
PDQ+IFsxMTMuMzM1OTUxXSBjb21wcmVzc19wYWdlKzB4N2MvMHgxMDAgW2k5MTVdCjw0PiBbMTEz
LjMzNzExMF0gaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKzB4NGJkLzB4NjEwIFtpOTE1XQo8ND4g
WzExMy4zMzg1MTVdIGk5MTVfY2FwdHVyZV9ncHVfc3RhdGUrMHgzODQvMHgxNjgwIFtpOTE1XQo8
ND4gWzExMy4zMzk3NzFdID8gX19sb2NrX2FjcXVpcmUrMHg0YWMvMHgxZTkwCjw0PiBbMTEzLjM0
MDc4NV0gPyBfcmF3X3NwaW5fbG9ja19pcnFzYXZlX25lc3RlZCsweDEvMHg1MAo8ND4gWzExMy4z
NDIxMjddIGk5MTVfZ3B1X2luZm9fb3BlbisweDQ0LzB4NzAgW2k5MTVdCjw0PiBbMTEzLjM0MzI0
M10gZnVsbF9wcm94eV9vcGVuKzB4MTM5LzB4MWIwCjw0PiBbMTEzLjM0NDE5Nl0gPyBvcGVuX3By
b3h5X29wZW4rMHhjMC8weGMwCjw0PiBbMTEzLjM0NTE0OV0gZG9fZGVudHJ5X29wZW4rMHgxY2Uv
MHgzYTAKPDQ+IFsxMTMuMzQ2MDg0XSBwYXRoX29wZW5hdCsweDRjOS8weGFjMAo8ND4gWzExMy4z
NDY5NjddIGRvX2ZpbHBfb3BlbisweDk2LzB4MTEwCjw0PiBbMTEzLjM0Nzg0OF0gPyBfX2FsbG9j
X2ZkKzB4ZTAvMHgxZjAKPDQ+IFsxMTMuMzQ4NzM2XSA/IGRvX3N5c19vcGVuKzB4MWI4LzB4MjUw
Cjw0PiBbMTEzLjM0OTY0N10gZG9fc3lzX29wZW4rMHgxYjgvMHgyNTAKPDQ+IFsxMTMuMzUwNTI2
XSBkb19zeXNjYWxsXzY0KzB4NTUvMHgxYzAKPDQ+IFsxMTMuMzUxNDE4XSBlbnRyeV9TWVNDQUxM
XzY0X2FmdGVyX2h3ZnJhbWUrMHg0OS8weGJlCgpBZnRlciB0aGUgaW9fbWFwcGluZ19tYXBfYXRv
bWljX3djL2ttYXBfYXRvbWljLCB0aGUga2VybmVsIGVudGVycyBhdG9taWMgY29udGV4dApidXQg
YWZ0ZXIgdGhhdCwgY29tcHJlc3NfcGFnZSBjYWxscyBwb29sX2FsbG9jIHdpdGggR0ZQX0tFUk5F
TCBmbGFnIHdoaWNoIGNhbgpwb3RlbnRpYWxseSBnbyB0byBzbGVlcC4KCkluIG9yZGVyIHRvIGZp
eCB0aGlzIGlzc3VlLCB3ZSBlaXRoZXIKCTEpIG5vdCBlbnRlciBpbnRvIGF0b21pYyBjb250ZXh0
LCBpLmUuLCB0byB1c2Ugbm9uIGF0b21pYyB2ZXJzaW9uIG9mCgkJZnVuY3Rpb25zIGxpa2UgaW9f
bWFwcGluZ19tYXBfd2Mva21hcCwKb3IKCTIpIG1ha2UgY29tcHJlc3NfcGFnZSBydW4gaW4gYXRv
bWljIGNvbnRleHQuCgpUbyBmb2xsb3cgY3VycmVudCBkZXNpZ24gbm90IHRvIHJ1biBjb21wcmVz
c2lvbiBpbiBhdG9taWMgY29udGV4dCwgc28sCnVzZSAxKSBhYm92ZSBpbiB0aGlzIHBhdGNoLgoK
U2lnbmVkLW9mZi1ieTogQnJ1Y2UgQ2hhbmcgPHl1LmJydWNlLmNoYW5nQGludGVsLmNvbT4KUmV2
aWV3ZWQtYnk6IEJyaWFuIFdlbHR5IDxicmlhbi53ZWx0eUBpbnRlbC5jb20+CkZpeGVzOiA4OTVk
OGViZWFhOTI0ICgiZHJtL2k5MTU6IGVycm9yIGNhcHR1cmUgd2l0aCBubyBnZ3R0IHNsb3QiKQot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgfCA4ICsrKystLS0tCiAx
IGZpbGUgY2hhbmdlZCwgNCBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCmluZGV4IDFmMmYyNjZmMjZhZi4uNzExOGVjYjdmMTQ0
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKQEAgLTEwMDcsNjcgKzEwMDcs
NjcgQEAgaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCWNvbXByZXNzLT53YyA9IGk5MTVfZ2VtX29iamVjdF9pc19sbWVtKHZtYS0+b2JqKSB8
fAogCQkgICAgICAgZHJtX21tX25vZGVfYWxsb2NhdGVkKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKTsK
IAogCXJldCA9IC1FSU5WQUw7CiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmZ2d0dC0+ZXJy
b3JfY2FwdHVyZSkpIHsKIAkJdm9pZCBfX2lvbWVtICpzOwogCQlkbWFfYWRkcl90IGRtYTsKIAog
CQlmb3JfZWFjaF9zZ3RfZGFkZHIoZG1hLCBpdGVyLCB2bWEtPnBhZ2VzKSB7CiAJCQlnZ3R0LT52
bS5pbnNlcnRfcGFnZSgmZ2d0dC0+dm0sIGRtYSwgc2xvdCwKIAkJCQkJICAgICBJOTE1X0NBQ0hF
X05PTkUsIDApOwogCiAJCQlzID0gaW9fbWFwcGluZ19tYXBfd2MoJmdndHQtPmlvbWFwLCBzbG90
LCBQQUdFX1NJWkUpOwogCQkJcmV0ID0gY29tcHJlc3NfcGFnZShjb21wcmVzcywgKHZvaWQgIF9f
Zm9yY2UgKilzLCBkc3QpOwogCQkJaW9fbWFwcGluZ191bm1hcChzKTsKIAkJCWlmIChyZXQpCiAJ
CQkJYnJlYWs7CiAJCX0KIAl9IGVsc2UgaWYgKGk5MTVfZ2VtX29iamVjdF9pc19sbWVtKHZtYS0+
b2JqKSkgewogCQlzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbiAqbWVtID0gdm1hLT5vYmotPm1t
LnJlZ2lvbjsKIAkJZG1hX2FkZHJfdCBkbWE7CiAKIAkJZm9yX2VhY2hfc2d0X2RhZGRyKGRtYSwg
aXRlciwgdm1hLT5wYWdlcykgewogCQkJdm9pZCBfX2lvbWVtICpzOwogCi0JCQlzID0gaW9fbWFw
cGluZ19tYXBfYXRvbWljX3djKCZtZW0tPmlvbWFwLCBkbWEpOworCQkJcyA9IGlvX21hcHBpbmdf
bWFwX3djKCZtZW0tPmlvbWFwLCBkbWEsIFBBR0VfU0laRSk7CiAJCQlyZXQgPSBjb21wcmVzc19w
YWdlKGNvbXByZXNzLCAodm9pZCBfX2ZvcmNlICopcywgZHN0KTsKLQkJCWlvX21hcHBpbmdfdW5t
YXBfYXRvbWljKHMpOworCQkJaW9fbWFwcGluZ191bm1hcChzKTsKIAkJCWlmIChyZXQpCiAJCQkJ
YnJlYWs7CiAJCX0KIAl9IGVsc2UgewogCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKIAogCQlmb3JfZWFj
aF9zZ3RfcGFnZShwYWdlLCBpdGVyLCB2bWEtPnBhZ2VzKSB7CiAJCQl2b2lkICpzOwogCiAJCQlk
cm1fY2xmbHVzaF9wYWdlcygmcGFnZSwgMSk7CiAKLQkJCXMgPSBrbWFwX2F0b21pYyhwYWdlKTsK
KwkJCXMgPSBrbWFwKHBhZ2UpOwogCQkJcmV0ID0gY29tcHJlc3NfcGFnZShjb21wcmVzcywgcywg
ZHN0KTsKLQkJCWt1bm1hcF9hdG9taWMocyk7CisJCQlrdW5tYXAocyk7CiAKIAkJCWRybV9jbGZs
dXNoX3BhZ2VzKCZwYWdlLCAxKTsKIAogCQkJaWYgKHJldCkKIAkJCQlicmVhazsKIAkJfQogCX0K
IAogCWlmIChyZXQgfHwgY29tcHJlc3NfZmx1c2goY29tcHJlc3MsIGRzdCkpIHsKIAkJd2hpbGUg
KGRzdC0+cGFnZV9jb3VudC0tKQogCQkJcG9vbF9mcmVlKCZjb21wcmVzcy0+cG9vbCwgZHN0LT5w
YWdlc1tkc3QtPnBhZ2VfY291bnRdKTsKIAkJa2ZyZWUoZHN0KTsKIAkJZHN0ID0gTlVMTDsKIAl9
CiAJY29tcHJlc3NfZmluaXNoKGNvbXByZXNzKTsKIAogCXJldHVybiBkc3Q7CiB9CiAKIC8qCiAg
KiBHZW5lcmF0ZSBhIHNlbWktdW5pcXVlIGVycm9yIGNvZGUuIFRoZSBjb2RlIGlzIG5vdCBtZWFu
dCB0byBoYXZlIG1lYW5pbmcsIFRoZQogICogY29kZSdzIG9ubHkgcHVycG9zZSBpcyB0byB0cnkg
dG8gcHJldmVudCBmYWxzZSBkdXBsaWNhdGVkIGJ1ZyByZXBvcnRzIGJ5CiAgKiBncm9zc2x5IGVz
dGltYXRpbmcgYSBHUFUgZXJyb3Igc3RhdGUuCiAgKgogICogVE9ETyBJZGVhbGx5LCBoYXNoaW5n
IHRoZSBiYXRjaGJ1ZmZlciB3b3VsZCBiZSBhIHZlcnkgbmljZSB3YXkgdG8gZGV0ZXJtaW5lCi0t
IAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

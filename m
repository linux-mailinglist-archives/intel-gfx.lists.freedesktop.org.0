Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 01B7BFDCD9
	for <lists+intel-gfx@lfdr.de>; Fri, 15 Nov 2019 13:00:39 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5D1CD6E511;
	Fri, 15 Nov 2019 12:00:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AA1976E511
 for <intel-gfx@lists.freedesktop.org>; Fri, 15 Nov 2019 12:00:35 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19211495-1500050 
 for multiple; Fri, 15 Nov 2019 12:00:25 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 15 Nov 2019 12:00:23 +0000
Message-Id: <20191115120023.770000-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gem: Purge the sudden reappearance of
 i915_gem_object_pin()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhpcyBkaWVkIG1hbnkgeWVhcnMgYWdvIGFzIHdlIG5vdyB1c2UgaTkxNV92bWEgZmlyc3QgYW5k
IGZvcmVtb3N0LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxz
b24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpD
YzogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8IDEzICsrKy0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgICB8ICA4IC0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAzNiArKysrKysrLS0tLS0t
LS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDE5IGluc2VydGlvbnMoKyksIDM4IGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVm
ZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmlu
ZGV4IGYwOTk4ZjEyMjVhZi4uZjA5MDQzYTNlYTlkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTE5OTUsMjggKzE5OTUsMjkgQEAgc3Rh
dGljIGludCBpOTE1X3Jlc2V0X2dlbjdfc29sX29mZnNldHMoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKIHNoYWRvd19iYXRjaF9waW4oc3RydWN0IGk5
MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZWItPmk5MTU7CiAJc3RydWN0IGk5
MTVfdm1hICogY29uc3Qgdm1hID0gKmViLT52bWE7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm07CiAJdTY0IGZsYWdzOworCWludCBlcnI7CiAKIAkvKgogCSAqIFBQR1RUIGJhY2tlZCBz
aGFkb3cgYnVmZmVycyBtdXN0IGJlIG1hcHBlZCBSTywgdG8gcHJldmVudAogCSAqIHBvc3Qtc2Nh
biB0YW1wZXJpbmcKIAkgKi8KLQlpZiAoQ01EUEFSU0VSX1VTRVNfR0dUVChkZXZfcHJpdikpIHsK
KwlpZiAoQ01EUEFSU0VSX1VTRVNfR0dUVChlYi0+aTkxNSkpIHsKIAkJZmxhZ3MgPSBQSU5fR0xP
QkFMOwotCQl2bSA9ICZkZXZfcHJpdi0+Z2d0dC52bTsKIAl9IGVsc2UgaWYgKHZtYS0+dm0tPmhh
c19yZWFkX29ubHkpIHsKIAkJZmxhZ3MgPSBQSU5fVVNFUjsKLQkJdm0gPSB2bWEtPnZtOwogCQlp
OTE1X2dlbV9vYmplY3Rfc2V0X3JlYWRvbmx5KG9iaik7CiAJfSBlbHNlIHsKIAkJRFJNX0RFQlVH
KCJDYW5ub3QgcHJldmVudCBwb3N0LXNjYW4gdGFtcGVyaW5nIHdpdGhvdXQgUk8gY2FwYWJsZSB2
bVxuIik7CiAJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwogCX0KIAotCXJldHVybiBpOTE1X2dl
bV9vYmplY3RfcGluKG9iaiwgdm0sIE5VTEwsIDAsIDAsIGZsYWdzKTsKKwllcnIgPSBpOTE1X3Zt
YV9waW4odm1hLCAwLCAwLCBmbGFncyk7CisJaWYgKGVycikKKwkJcmV0dXJuIEVSUl9QVFIoZXJy
KTsKKworCXJldHVybiB2bWE7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmViX3BhcnNl
KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXgg
MTc3OWY2MDBmY2ZiLi5hNzA1NTVlNmJlZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAt
MTg0MiwxNCArMTg0Miw2IEBAIGludCBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgICB1bnNpZ25lZCBsb25nIGZsYWdzKTsKICNkZWZp
bmUgSTkxNV9HRU1fT0JKRUNUX1VOQklORF9BQ1RJVkUgQklUKDApCiAKLXN0cnVjdCBpOTE1X3Zt
YSAqIF9fbXVzdF9jaGVjawotaTkxNV9nZW1fb2JqZWN0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAotCQkgICAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCi0JCSAg
ICBjb25zdCBzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcgKnZpZXcsCi0JCSAgICB1NjQgc2l6ZSwKLQkJ
ICAgIHU2NCBhbGlnbm1lbnQsCi0JCSAgICB1NjQgZmxhZ3MpOwotCiB2b2lkIGk5MTVfZ2VtX3J1
bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogCiBzdGF0
aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDQz
YzUzMjc1NmM3Yy4uODk2OTZmMWE0ZTc3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTg5
MSwyMiArODkxLDggQEAgaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCQkgdTY0IGFsaWdubWVudCwKIAkJCSB1NjQgZmxhZ3MpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2
KTsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9ICZkZXZfcHJpdi0+Z2d0dC52bTsK
LQotCXJldHVybiBpOTE1X2dlbV9vYmplY3RfcGluKG9iaiwgdm0sIHZpZXcsIHNpemUsIGFsaWdu
bWVudCwKLQkJCQkgICBmbGFncyB8IFBJTl9HTE9CQUwpOwotfQotCi1zdHJ1Y3QgaTkxNV92bWEg
KgotaTkxNV9nZW1fb2JqZWN0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAot
CQkgICAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCi0JCSAgICBjb25zdCBzdHJ1Y3Qg
aTkxNV9nZ3R0X3ZpZXcgKnZpZXcsCi0JCSAgICB1NjQgc2l6ZSwKLQkJICAgIHU2NCBhbGlnbm1l
bnQsCi0JCSAgICB1NjQgZmxhZ3MpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9
ICZpOTE1LT5nZ3R0OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCByZXQ7CiAKQEAgLTkx
NSwxNyArOTAxLDE5IEBAIGk5MTVfZ2VtX29iamVjdF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKIAogCWlmIChmbGFncyAmIFBJTl9NQVBQQUJMRSAmJgogCSAgICAoIXZpZXcg
fHwgdmlldy0+dHlwZSA9PSBJOTE1X0dHVFRfVklFV19OT1JNQUwpKSB7Ci0JCS8qIElmIHRoZSBy
ZXF1aXJlZCBzcGFjZSBpcyBsYXJnZXIgdGhhbiB0aGUgYXZhaWxhYmxlCisJCS8qCisJCSAqIElm
IHRoZSByZXF1aXJlZCBzcGFjZSBpcyBsYXJnZXIgdGhhbiB0aGUgYXZhaWxhYmxlCiAJCSAqIGFw
ZXJ0dXJlLCB3ZSB3aWxsIG5vdCBhYmxlIHRvIGZpbmQgYSBzbG90IGZvciB0aGUKIAkJICogb2Jq
ZWN0IGFuZCB1bmJpbmRpbmcgdGhlIG9iamVjdCBub3cgd2lsbCBiZSBpbgogCQkgKiB2YWluLiBX
b3JzZSwgZG9pbmcgc28gbWF5IGNhdXNlIHVzIHRvIHBpbmctcG9uZwogCQkgKiB0aGUgb2JqZWN0
IGluIGFuZCBvdXQgb2YgdGhlIEdsb2JhbCBHVFQgYW5kCiAJCSAqIHdhc3RlIGEgbG90IG9mIGN5
Y2xlcyB1bmRlciB0aGUgbXV0ZXguCiAJCSAqLwotCQlpZiAob2JqLT5iYXNlLnNpemUgPiBkZXZf
cHJpdi0+Z2d0dC5tYXBwYWJsZV9lbmQpCisJCWlmIChvYmotPmJhc2Uuc2l6ZSA+IGdndHQtPm1h
cHBhYmxlX2VuZCkKIAkJCXJldHVybiBFUlJfUFRSKC1FMkJJRyk7CiAKLQkJLyogSWYgTk9OQkxP
Q0sgaXMgc2V0IHRoZSBjYWxsZXIgaXMgb3B0aW1pc3RpY2FsbHkKKwkJLyoKKwkJICogSWYgTk9O
QkxPQ0sgaXMgc2V0IHRoZSBjYWxsZXIgaXMgb3B0aW1pc3RpY2FsbHkKIAkJICogdHJ5aW5nIHRv
IGNhY2hlIHRoZSBmdWxsIG9iamVjdCB3aXRoaW4gdGhlIG1hcHBhYmxlCiAJCSAqIGFwZXJ0dXJl
LCBhbmQgKm11c3QqIGhhdmUgYSBmYWxsYmFjayBpbiBwbGFjZSBmb3IKIAkJICogc2l0dWF0aW9u
cyB3aGVyZSB3ZSBjYW5ub3QgYmluZCB0aGUgb2JqZWN0LiBXZQpAQCAtOTQxLDExICs5MjksMTEg
QEAgaTkxNV9nZW1fb2JqZWN0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CQkgKiB3ZSBjb3VsZCB0cnkgdG8gbWluaW1pc2UgaGFybSB0byBvdGhlcnMuCiAJCSAqLwogCQlp
ZiAoZmxhZ3MgJiBQSU5fTk9OQkxPQ0sgJiYKLQkJICAgIG9iai0+YmFzZS5zaXplID4gZGV2X3By
aXYtPmdndHQubWFwcGFibGVfZW5kIC8gMikKKwkJICAgIG9iai0+YmFzZS5zaXplID4gZ2d0dC0+
bWFwcGFibGVfZW5kIC8gMikKIAkJCXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOwogCX0KIAotCXZt
YSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0sIHZpZXcpOworCXZtYSA9IGk5MTVfdm1hX2lu
c3RhbmNlKG9iaiwgJmdndHQtPnZtLCB2aWV3KTsKIAlpZiAoSVNfRVJSKHZtYSkpCiAJCXJldHVy
biB2bWE7CiAKQEAgLTk1NSw3ICs5NDMsNyBAQCBpOTE1X2dlbV9vYmplY3RfcGluKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJcmV0dXJuIEVSUl9QVFIoLUVOT1NQQyk7CiAK
IAkJCWlmIChmbGFncyAmIFBJTl9NQVBQQUJMRSAmJgotCQkJICAgIHZtYS0+ZmVuY2Vfc2l6ZSA+
IGRldl9wcml2LT5nZ3R0Lm1hcHBhYmxlX2VuZCAvIDIpCisJCQkgICAgdm1hLT5mZW5jZV9zaXpl
ID4gZ2d0dC0+bWFwcGFibGVfZW5kIC8gMikKIAkJCQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsK
IAkJfQogCkBAIC05NjUsOSArOTUzLDkgQEAgaTkxNV9nZW1fb2JqZWN0X3BpbihzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0KIAogCWlmICh2bWEtPmZlbmNlICYmICFpOTE1X2dl
bV9vYmplY3RfaXNfdGlsZWQob2JqKSkgewotCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7
CisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJcmV0ID0gaTkxNV92bWFfcmV2b2tl
X2ZlbmNlKHZtYSk7Ci0JCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQltdXRleF91
bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBFUlJfUFRSKHJl
dCk7CiAJfQotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

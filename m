Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6FC28E9A1
	for <lists+intel-gfx@lfdr.de>; Mon, 29 Apr 2019 20:00:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3A7398930B;
	Mon, 29 Apr 2019 18:00:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B991F8930B
 for <intel-gfx@lists.freedesktop.org>; Mon, 29 Apr 2019 18:00:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16399165-1500050 
 for multiple; Mon, 29 Apr 2019 19:00:25 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 29 Apr 2019 19:00:17 +0100
Message-Id: <20190429180020.27274-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190429180020.27274-1-chris@chris-wilson.co.uk>
References: <20190429180020.27274-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/5] drm/i915: Only reschedule the submission
 tasklet if preemption is possible
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgY291cGxlIHRoZSBzY2hlZHVsZXIgbW9yZSB0aWdodGx5IHdpdGggdGhlIGV4ZWNsaXN0
cyBwb2xpY3ksIHdlCmNhbiBhcHBseSB0aGUgcHJlZW1wdGlvbiBwb2xpY3kgdG8gdGhlIHF1ZXN0
aW9uIG9mIHdoZXRoZXIgd2UgbmVlZCB0bwpraWNrIHRoZSB0YXNrbGV0IGF0IGFsbCBmb3IgdGhp
cyBwcmlvcml0eSBidW1wLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJp
cy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIHwgIDcgKysr
KysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgICAgfCAgMiAtLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYyAgfCAxOCArKysrKysrKysrKy0tLS0t
LS0KIDMgZmlsZXMgY2hhbmdlZCwgMTcgaW5zZXJ0aW9ucygrKSwgMTAgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCA4NDUzOGY2OTE4NWIuLjRi
MDQyODkzZGMwZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTYz
OCwxNCArNjM4LDE5IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpkdW1teV9yZXF1ZXN0
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlHRU1fQlVHX09OKGk5MTVfcmVxdWVz
dF9jb21wbGV0ZWQocnEpKTsKIAogCWk5MTVfc3dfZmVuY2VfaW5pdCgmcnEtPnN1Ym1pdCwgZHVt
bXlfbm90aWZ5KTsKLQlpOTE1X3N3X2ZlbmNlX2NvbW1pdCgmcnEtPnN1Ym1pdCk7CisJc2V0X2Jp
dChJOTE1X0ZFTkNFX0ZMQUdfQUNUSVZFLCAmcnEtPmZlbmNlLmZsYWdzKTsKIAogCXJldHVybiBy
cTsKIH0KIAogc3RhdGljIHZvaWQgZHVtbXlfcmVxdWVzdF9mcmVlKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKmR1bW15KQogeworCS8qIFdlIGhhdmUgdG8gZmFrZSB0aGUgQ1MgaW50ZXJydXB0IHRvIGtp
Y2sgdGhlIG5leHQgcmVxdWVzdCAqLworCWk5MTVfc3dfZmVuY2VfY29tbWl0KCZkdW1teS0+c3Vi
bWl0KTsKKwogCWk5MTVfcmVxdWVzdF9tYXJrX2NvbXBsZXRlKGR1bW15KTsKKwlkbWFfZmVuY2Vf
c2lnbmFsKCZkdW1teS0+ZmVuY2UpOworCiAJaTkxNV9zY2hlZF9ub2RlX2ZpbmkoJmR1bW15LT5z
Y2hlZCk7CiAJaTkxNV9zd19mZW5jZV9maW5pKCZkdW1teS0+c3VibWl0KTsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCBhZjhjOWZhNWUwNjYuLjJlMjJkYTY2YTU2YyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTEzNTgsOSArMTM1OCw3IEBAIGxvbmcg
aTkxNV9yZXF1ZXN0X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJaWYgKGZsYWdzICYg
STkxNV9XQUlUX1BSSU9SSVRZKSB7CiAJCWlmICghaTkxNV9yZXF1ZXN0X3N0YXJ0ZWQocnEpICYm
IElOVEVMX0dFTihycS0+aTkxNSkgPj0gNikKIAkJCWdlbjZfcnBzX2Jvb3N0KHJxKTsKLQkJbG9j
YWxfYmhfZGlzYWJsZSgpOyAvKiBzdXNwZW5kIHRhc2tsZXRzIGZvciByZXByaW9yaXRpc2F0aW9u
ICovCiAJCWk5MTVfc2NoZWR1bGVfYnVtcF9wcmlvcml0eShycSwgSTkxNV9QUklPUklUWV9XQUlU
KTsKLQkJbG9jYWxfYmhfZW5hYmxlKCk7IC8qIGtpY2sgdGFza2xldHMgZW4gbWFzc2UgKi8KIAl9
CiAKIAl3YWl0LnRzayA9IGN1cnJlbnQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIu
YwppbmRleCAzOWJjNGY1NGUyNzIuLjQ5MTM0MTgzODdiZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3NjaGVkdWxlci5jCkBAIC0yNjEsMTYgKzI2MSwyMCBAQCBzY2hlZF9sb2NrX2VuZ2luZShj
b25zdCBzdHJ1Y3QgaTkxNV9zY2hlZF9ub2RlICpub2RlLAogCXJldHVybiBlbmdpbmU7CiB9CiAK
LXN0YXRpYyBib29sIGluZmxpZ2h0KGNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkg
ICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3N0YXRpYyBpbmxpbmUg
aW50IHJxX3ByaW8oY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JY29uc3Qgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqYWN0aXZlOworCXJldHVybiBycS0+c2NoZWQuYXR0ci5wcmlvcml0
eSB8IF9fTk9fUFJFRU1QVElPTjsKK30KKworc3RhdGljIGJvb2wga2lja190YXNrbGV0KGNvbnN0
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IHByaW8pCit7CisJY29uc3Qgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqaW5mbGlnaHQgPQorCQlwb3J0X3JlcXVlc3QoZW5naW5lLT5leGVj
bGlzdHMucG9ydCk7CiAKLQlpZiAoIWk5MTVfcmVxdWVzdF9pc19hY3RpdmUocnEpKQorCWlmICgh
aW5mbGlnaHQpCiAJCXJldHVybiBmYWxzZTsKIAotCWFjdGl2ZSA9IHBvcnRfcmVxdWVzdChlbmdp
bmUtPmV4ZWNsaXN0cy5wb3J0KTsKLQlyZXR1cm4gYWN0aXZlLT5od19jb250ZXh0ID09IHJxLT5o
d19jb250ZXh0OworCXJldHVybiBfX2V4ZWNsaXN0c19uZWVkX3ByZWVtcHQocHJpbywgcnFfcHJp
byhpbmZsaWdodCkpOwogfQogCiBzdGF0aWMgdm9pZCBfX2k5MTVfc2NoZWR1bGUoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsCkBAIC00MDAsNyArNDA0LDcgQEAgc3RhdGljIHZvaWQgX19pOTE1X3Nj
aGVkdWxlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCQkgKiBJZiB3ZSBhcmUgYWxyZWFkeSB0
aGUgY3VycmVudGx5IGV4ZWN1dGluZyBjb250ZXh0LCBkb24ndAogCQkgKiBib3RoZXIgZXZhbHVh
dGluZyBpZiB3ZSBzaG91bGQgcHJlZW1wdCBvdXJzZWx2ZXMuCiAJCSAqLwotCQlpZiAoaW5mbGln
aHQobm9kZV90b19yZXF1ZXN0KG5vZGUpLCBlbmdpbmUpKQorCQlpZiAoIWtpY2tfdGFza2xldChl
bmdpbmUsIHByaW8pKQogCQkJY29udGludWU7CiAKIAkJLyogRGVmZXIgKHRhc2tsZXQpIHN1Ym1p
c3Npb24gdW50aWwgYWZ0ZXIgYWxsIG9mIG91ciB1cGRhdGVzLiAqLwotLSAKMi4yMC4xCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E09622644C
	for <lists+intel-gfx@lfdr.de>; Wed, 22 May 2019 15:08:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 501BE89A6D;
	Wed, 22 May 2019 13:08:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 77ED789A6D
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 May 2019 13:08:25 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 May 2019 06:08:25 -0700
X-ExtLoop1: 1
Received: from delly.ld.intel.com ([10.103.238.204])
 by fmsmga006.fm.intel.com with ESMTP; 22 May 2019 06:08:24 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 May 2019 14:05:21 +0100
Message-Id: <20190522130524.10223-3-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190522130524.10223-1-lionel.g.landwerlin@intel.com>
References: <20190522130524.10223-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 2/5] drm/i915/perf: allow holding preemption
 on filtered ctx
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugd291bGQgbGlrZSB0byBtYWtlIHVzZSBvZiBwZXJmIGluIFZ1bGthbi4gVGhlIFZ1bGthbiBB
UEkgaXMgbXVjaApsb3dlciBsZXZlbCB0aGFuIE9wZW5HTCwgd2l0aCBhcHBsaWNhdGlvbnMgZGly
ZWN0bHkgZXhwb3NlZCB0byB0aGUKY29uY2VwdCBvZiBjb21tYW5kIGJ1ZmZlcnMgKHByZXR0eSBt
dWNoIGVxdWl2YWxlbnQgdG8gb3VyIGJhdGNoCmJ1ZmZlcnMpLiBJbiBWdWxrYW4sIHF1ZXJpZXMg
YXJlIGFsd2F5cyBsaW1pdGVkIGluIHNjb3BlIHRvIGEgY29tbWFuZApidWZmZXIuIEluIE9wZW5H
TCwgdGhlIGxhY2sgb2YgY29tbWFuZCBidWZmZXIgY29uY2VwdCBtZWFudCB0aGF0CnF1ZXJpZXMn
IGR1cmF0aW9uIGNvdWxkIHNwYW4gbXVsdGlwbGUgY29tbWFuZCBidWZmZXJzLgoKV2l0aCB0aGF0
IHJlc3RyaWN0aW9uIGdvbmUgaW4gVnVsa2FuLCB3ZSB3b3VsZCBsaWtlIHRvIHNpbXBsaWZ5Cm1l
YXN1cmluZyBwZXJmb3JtYW5jZSBqdXN0IGJ5IG1lYXN1cmluZyB0aGUgZGVsdGFzIGJldHdlZW4g
dGhlIGNvdW50ZXIKc25hcHNob3RzIHdyaXR0ZW4gYnkgMiBNSV9SRUNPUkRfUEVSRl9DT1VOVCBj
b21tYW5kcywgcmF0aGVyIHRoYW4gdGhlCm1vcmUgY29tcGxleCBzY2hlbWUgd2UgY3VycmVudGx5
IGhhdmUgaW4gdGhlIEdMIGRyaXZlciwgdXNpbmcgMgpNSV9SRUNPUkRfUEVSRl9DT1VOVCBjb21t
YW5kcyBhbmQgZG9pbmcgc29tZSBwb3N0IHByb2Nlc3Npbmcgb24gdGhlCnN0cmVhbSBvZiBPQSBy
ZXBvcnRzLCBjb21pbmcgZnJvbSB0aGUgZ2xvYmFsIE9BIGJ1ZmZlciwgdG8gcmVtb3ZlIGFueQp1
bnJlbGF0ZWQgZGVsdGFzIGluIGJldHdlZW4gdGhlIDIgTUlfUkVDT1JEX1BFUkZfQ09VTlQuCgpE
aXNhYmxpbmcgcHJlZW1wdGlvbiBvbmx5IGFwcGx5IHRvIGEgc2luZ2xlIGNvbnRleHQgd2l0aCB3
aGljaCB3YW50IHRvCnF1ZXJ5IHBlcmZvcm1hbmNlIGNvdW50ZXJzIGZvciBhbmQgaXMgY29uc2lk
ZXJlZCBhIHByaXZpbGVnZWQKb3BlcmF0aW9uLCBieSBkZWZhdWx0IHByb3RlY3RlZCBieSBDQVBf
U1lTX0FETUlOLiBJdCBpcyBwb3NzaWJsZSB0bwplbmFibGUgaXQgZm9yIGEgbm9ybWFsIHVzZXIg
YnkgZGlzYWJsaW5nIHRoZSBwYXJhbm9pZCBzdHJlYW0gc2V0dGluZy4KCnYyOiBTdG9yZSBwcmVl
bXB0aW9uIHNldHRpbmcgaW4gaW50ZWxfY29udGV4dCAoQ2hyaXMpCgpTaWduZWQtb2ZmLWJ5OiBM
aW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAgIHwgIDEgKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oIHwgIDMgKysKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAgICAgIHwgMzcgKysrKysrKysrKysrKysrLS0t
LQogaW5jbHVkZS91YXBpL2RybS9pOTE1X2RybS5oICAgICAgICAgICAgICAgICAgIHwgMTAgKysr
KysKIDYgZmlsZXMgY2hhbmdlZCwgNDYgaW5zZXJ0aW9ucygrKSwgOSBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggNWIzMWUxZTA1ZGRkLi42
OGE0Yjg4OGZiMWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Nv
bnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAg
LTExNyw2ICsxMTcsNyBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlLAogCWNlLT5vcHMgPSBlbmdpbmUtPmNvcHM7CiAJY2UtPnNzZXUgPSBlbmdpbmUtPnNzZXU7
CiAJY2UtPnNhdHVyYXRlZCA9IDA7CisJY2UtPmFyYl9lbmFibGUgPSBNSV9BUkJfRU5BQkxFOwog
CiAJSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGluayk7CiAJSU5JVF9MSVNUX0hFQUQoJmNl
LT5zaWduYWxzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Nv
bnRleHRfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlw
ZXMuaAppbmRleCA5NjNhMzEyNDMwZTYuLjA3ZjU4NmUzNjA4ZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaApAQCAtNjUsNiArNjUsOSBAQCBzdHJ1
Y3QgaW50ZWxfY29udGV4dCB7CiAKIAkvKiogc3NldTogQ29udHJvbCBldS9zbGljZSBwYXJ0aXRp
b25pbmcgKi8KIAlzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1OworCisJLyoqIGFyYl9lbmFibGU6IENv
bnRyb2wgcHJlZW1wdGlvbiAqLworCXUzMiBhcmJfZW5hYmxlOwogfTsKIAogI2VuZGlmIC8qIF9f
SU5URUxfQ09OVEVYVF9UWVBFU19fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmlu
ZGV4IDEzYTkwNDA0ZTBmNi4uNDEzNzczOWRhZjJkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9scmMuYwpAQCAtMjQyMiw3ICsyNDIyLDcgQEAgc3RhdGljIGludCBnZW45X2VtaXRfYmJfc3Rh
cnQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJaWYgKElTX0VSUihjcykpCiAJCXJldHVybiBQ
VFJfRVJSKGNzKTsKIAotCSpjcysrID0gTUlfQVJCX09OX09GRiB8IE1JX0FSQl9FTkFCTEU7CisJ
KmNzKysgPSBNSV9BUkJfT05fT0ZGIHwgcnEtPmh3X2NvbnRleHQtPmFyYl9lbmFibGU7CiAKIAkq
Y3MrKyA9IE1JX0JBVENIX0JVRkZFUl9TVEFSVF9HRU44IHwKIAkJKGZsYWdzICYgSTkxNV9ESVNQ
QVRDSF9TRUNVUkUgPyAwIDogQklUKDgpKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCmluZGV4IDc0
ZTg5Zjg4MGVhMC4uNzIyNzRjYmU3ZDExIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTQ3
MSw3ICs0NzEsNyBAQCBzdGF0aWMgaW50IGk5MTVfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJdmFsdWUgPSBJTlRFTF9JTkZPKGRldl9wcml2KS0+
aGFzX2NvaGVyZW50X2dndHQ7CiAJCWJyZWFrOwogCWNhc2UgSTkxNV9QQVJBTV9QRVJGX1JFVklT
SU9OOgotCQl2YWx1ZSA9IDE7CisJCXZhbHVlID0gMjsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJ
RFJNX0RFQlVHKCJVbmtub3duIHBhcmFtZXRlciAlZFxuIiwgcGFyYW0tPnBhcmFtKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggYzQ5OTVkNWExNmQyLi4zMjEwMTRjYTE1OTIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0zNDEsNiArMzQxLDggQEAgc3RhdGljIGNvbnN0IHN0
cnVjdCBpOTE1X29hX2Zvcm1hdCBnZW44X3BsdXNfb2FfZm9ybWF0c1tJOTE1X09BX0ZPUk1BVF9N
QVhdID0gewogICogc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIC0gZm9yIHZhbGlkYXRlZCBw
cm9wZXJ0aWVzIGdpdmVuIHRvIG9wZW4gYSBzdHJlYW0KICAqIEBzYW1wbGVfZmxhZ3M6IGBEUk1f
STkxNV9QRVJGX1BST1BfU0FNUExFXypgIHByb3BlcnRpZXMgYXJlIHRyYWNrZWQgYXMgZmxhZ3MK
ICAqIEBzaW5nbGVfY29udGV4dDogV2hldGhlciBhIHNpbmdsZSBvciBhbGwgZ3B1IGNvbnRleHRz
IHNob3VsZCBiZSBtb25pdG9yZWQKKyAqIEBjb250ZXh0X2Rpc2FibGVfcHJlZW1wdGlvbjogV2hl
dGhlciB0aGUgcHJlZW1wdGlvbiBpcyBkaXNhYmxlZCBmb3IgdGhlCisgKiAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgIGZpbHRlcmVkIGNvbnRleHQKICAqIEBjdHhfaGFuZGxlOiBBIGdlbSBj
dHggaGFuZGxlIGZvciB1c2Ugd2l0aCBAc2luZ2xlX2NvbnRleHQKICAqIEBtZXRyaWNzX3NldDog
QW4gSUQgZm9yIGFuIE9BIHVuaXQgbWV0cmljIHNldCBhZHZlcnRpc2VkIHZpYSBzeXNmcwogICog
QG9hX2Zvcm1hdDogQW4gT0EgdW5pdCBIVyByZXBvcnQgZm9ybWF0CkBAIC0zNTUsNiArMzU3LDcg
QEAgc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIHsKIAl1MzIgc2FtcGxlX2ZsYWdzOwogCiAJ
dTY0IHNpbmdsZV9jb250ZXh0OjE7CisJdTY0IGNvbnRleHRfZGlzYWJsZV9wcmVlbXB0aW9uOjE7
CiAJdTY0IGN0eF9oYW5kbGU7CiAKIAkvKiBPQSBzYW1wbGluZyBzdGF0ZSAqLwpAQCAtMTIwMSw3
ICsxMjA0LDggQEAgc3RhdGljIGludCBpOTE1X29hX3JlYWQoc3RydWN0IGk5MTVfcGVyZl9zdHJl
YW0gKnN0cmVhbSwKIH0KIAogc3RhdGljIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpvYV9waW5fY29u
dGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCQkJICAgIHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgpCisJCQkJCSAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
LAorCQkJCQkgICAgYm9vbCBkaXNhYmxlX3ByZWVtcHRpb24pCiB7CiAJc3RydWN0IGk5MTVfZ2Vt
X2VuZ2luZXNfaXRlciBpdDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CkBAIC0xMjIyLDYg
KzEyMjYsNyBAQCBzdGF0aWMgc3RydWN0IGludGVsX2NvbnRleHQgKm9hX3Bpbl9jb250ZXh0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQllcnIgPSBpbnRlbF9jb250ZXh0X3Bpbihj
ZSk7CiAJCWlmIChlcnIgPT0gMCkgewogCQkJaTkxNS0+cGVyZi5vYS5waW5uZWRfY3R4ID0gY2U7
CisJCQljZS0+YXJiX2VuYWJsZSA9IE1JX0FSQl9ESVNBQkxFOwogCQkJYnJlYWs7CiAJCX0KIAl9
CkBAIC0xMjM3LDE5ICsxMjQyLDIyIEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqb2Ff
cGluX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAvKioKICAqIG9hX2dl
dF9yZW5kZXJfY3R4X2lkIC0gZGV0ZXJtaW5lIGFuZCBob2xkIGN0eCBodyBpZAogICogQHN0cmVh
bTogQW4gaTkxNS1wZXJmIHN0cmVhbSBvcGVuZWQgZm9yIE9BIG1ldHJpY3MKKyAqIEBkaXNhYmxl
X3ByZWVtcHRpb246IFdoZXRoZXIgdG8gZGlzYWJsZSBwcmVlbXB0aW9uIG9uIHRoZSBjb250ZXh0
CiAgKgogICogRGV0ZXJtaW5lIHRoZSByZW5kZXIgY29udGV4dCBodyBpZCwgYW5kIGVuc3VyZSBp
dCByZW1haW5zIGZpeGVkIGZvciB0aGUKICAqIGxpZmV0aW1lIG9mIHRoZSBzdHJlYW0uIFRoaXMg
ZW5zdXJlcyB0aGF0IHdlIGRvbid0IGhhdmUgdG8gd29ycnkgYWJvdXQKLSAqIHVwZGF0aW5nIHRo
ZSBjb250ZXh0IElEIGluIE9BQ09OVFJPTCBvbiB0aGUgZmx5LgorICogdXBkYXRpbmcgdGhlIGNv
bnRleHQgSUQgaW4gT0FDT05UUk9MIG9uIHRoZSBmbHkuIEFsc28gZGlzYWJsZSBwcmVlbXB0aW9u
IG9uCisgKiB0aGUgY29udGV4dCBpZiBuZWVkZWQuCiAgKgogICogUmV0dXJuczogemVybyBvbiBz
dWNjZXNzIG9yIGEgbmVnYXRpdmUgZXJyb3IgY29kZQogICovCi1zdGF0aWMgaW50IG9hX2dldF9y
ZW5kZXJfY3R4X2lkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCitzdGF0aWMgaW50
IG9hX2dldF9yZW5kZXJfY3R4X2lkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCisJ
CQkJYm9vbCBkaXNhYmxlX3ByZWVtcHRpb24pCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSBzdHJlYW0tPmRldl9wcml2OwogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAot
CWNlID0gb2FfcGluX2NvbnRleHQoaTkxNSwgc3RyZWFtLT5jdHgpOworCWNlID0gb2FfcGluX2Nv
bnRleHQoaTkxNSwgc3RyZWFtLT5jdHgsIGRpc2FibGVfcHJlZW1wdGlvbik7CiAJaWYgKElTX0VS
UihjZSkpCiAJCXJldHVybiBQVFJfRVJSKGNlKTsKIApAQCAtMTMzNyw2ICsxMzQ1LDcgQEAgc3Rh
dGljIHZvaWQgb2FfcHV0X3JlbmRlcl9jdHhfaWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0
cmVhbSkKIAljZSA9IGZldGNoX2FuZF96ZXJvKCZkZXZfcHJpdi0+cGVyZi5vYS5waW5uZWRfY3R4
KTsKIAlpZiAoY2UpIHsKIAkJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgp
OworCQljZS0+YXJiX2VuYWJsZSA9IE1JX0FSQl9FTkFCTEU7CiAJCWludGVsX2NvbnRleHRfdW5w
aW4oY2UpOwogCQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAl9
CkBAIC0yMDg1LDcgKzIwOTQsNyBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJZGV2X3ByaXYtPnBlcmYub2EucGVyaW9k
X2V4cG9uZW50ID0gcHJvcHMtPm9hX3BlcmlvZF9leHBvbmVudDsKIAogCWlmIChzdHJlYW0tPmN0
eCkgewotCQlyZXQgPSBvYV9nZXRfcmVuZGVyX2N0eF9pZChzdHJlYW0pOworCQlyZXQgPSBvYV9n
ZXRfcmVuZGVyX2N0eF9pZChzdHJlYW0sIHByb3BzLT5jb250ZXh0X2Rpc2FibGVfcHJlZW1wdGlv
bik7CiAJCWlmIChyZXQpIHsKIAkJCURSTV9ERUJVRygiSW52YWxpZCBjb250ZXh0IGlkIHRvIGZp
bHRlciB3aXRoXG4iKTsKIAkJCXJldHVybiByZXQ7CkBAIC0yNTgzLDYgKzI1OTIsMTUgQEAgaTkx
NV9wZXJmX29wZW5faW9jdGxfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJfQogCX0KIAorCWlmIChwcm9wcy0+Y29udGV4dF9kaXNhYmxlX3ByZWVtcHRpb24pIHsK
KwkJaWYgKCFwcm9wcy0+c2luZ2xlX2NvbnRleHQpIHsKKwkJCURSTV9ERUJVRygicHJlZW1wdGlv
biBkaXNhYmxlIHdpdGggbm8gY29udGV4dFxuIik7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290
byBlcnI7CisJCX0KKwkJcHJpdmlsZWdlZF9vcCA9IHRydWU7CisJfQorCiAJLyoKIAkgKiBPbiBI
YXN3ZWxsIHRoZSBPQSB1bml0IHN1cHBvcnRzIGNsb2NrIGdhdGluZyBvZmYgZm9yIGEgc3BlY2lm
aWMKIAkgKiBjb250ZXh0IGFuZCBpbiB0aGlzIG1vZGUgdGhlcmUncyBubyB2aXNpYmlsaXR5IG9m
IG1ldHJpY3MgZm9yIHRoZQpAQCAtMjU5Nyw4ICsyNjE1LDEwIEBAIGk5MTVfcGVyZl9vcGVuX2lv
Y3RsX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogTUlfUkVQ
T1JUX1BFUkZfQ09VTlQgY29tbWFuZHMgYW5kIHNvIGNvbnNpZGVyIGl0IGEgcHJpdmlsZWdlZCBv
cCB0bwogCSAqIGVuYWJsZSB0aGUgT0EgdW5pdCBieSBkZWZhdWx0LgogCSAqLwotCWlmIChJU19I
QVNXRUxMKGRldl9wcml2KSAmJiBzcGVjaWZpY19jdHgpCisJaWYgKElTX0hBU1dFTEwoZGV2X3By
aXYpICYmIHNwZWNpZmljX2N0eCAmJgorCSAgICAhcHJvcHMtPmNvbnRleHRfZGlzYWJsZV9wcmVl
bXB0aW9uKSB7CiAJCXByaXZpbGVnZWRfb3AgPSBmYWxzZTsKKwl9CiAKIAkvKiBTaW1pbGFyIHRv
IHBlcmYncyBrZXJuZWwucGVyZl9wYXJhbm9pZF9jcHUgc3lzY3RsIG9wdGlvbgogCSAqIHdlIGNo
ZWNrIGEgZGV2Lmk5MTUucGVyZl9zdHJlYW1fcGFyYW5vaWQgc3lzY3RsIG9wdGlvbgpAQCAtMjYw
Nyw3ICsyNjI3LDcgQEAgaTkxNV9wZXJmX29wZW5faW9jdGxfbG9ja2VkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKi8KIAlpZiAocHJpdmlsZWdlZF9vcCAmJgogCSAgICBp
OTE1X3BlcmZfc3RyZWFtX3BhcmFub2lkICYmICFjYXBhYmxlKENBUF9TWVNfQURNSU4pKSB7Ci0J
CURSTV9ERUJVRygiSW5zdWZmaWNpZW50IHByaXZpbGVnZXMgdG8gb3BlbiBzeXN0ZW0td2lkZSBp
OTE1IHBlcmYgc3RyZWFtXG4iKTsKKwkJRFJNX0RFQlVHKCJJbnN1ZmZpY2llbnQgcHJpdmlsZWdl
cyB0byBvcGVuIGk5MTUgcGVyZiBzdHJlYW1cbiIpOwogCQlyZXQgPSAtRUFDQ0VTOwogCQlnb3Rv
IGVycl9jdHg7CiAJfQpAQCAtMjc5OSw2ICsyODE5LDkgQEAgc3RhdGljIGludCByZWFkX3Byb3Bl
cnRpZXNfdW5sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJcHJv
cHMtPm9hX3BlcmlvZGljID0gdHJ1ZTsKIAkJCXByb3BzLT5vYV9wZXJpb2RfZXhwb25lbnQgPSB2
YWx1ZTsKIAkJCWJyZWFrOworCQljYXNlIERSTV9JOTE1X1BFUkZfUFJPUF9IT0xEX1BSRUVNUFRJ
T046CisJCQlwcm9wcy0+Y29udGV4dF9kaXNhYmxlX3ByZWVtcHRpb24gPSB2YWx1ZSAhPSAwID8g
MSA6IDA7CisJCQlicmVhazsKIAkJY2FzZSBEUk1fSTkxNV9QRVJGX1BST1BfTUFYOgogCQkJTUlT
U0lOR19DQVNFKGlkKTsKIAkJCXJldHVybiAtRUlOVkFMOwpkaWZmIC0tZ2l0IGEvaW5jbHVkZS91
YXBpL2RybS9pOTE1X2RybS5oIGIvaW5jbHVkZS91YXBpL2RybS9pOTE1X2RybS5oCmluZGV4IDk3
MDg5NjlmMmZjYi4uOWFjYjQ1NWZhZDM5IDEwMDY0NAotLS0gYS9pbmNsdWRlL3VhcGkvZHJtL2k5
MTVfZHJtLmgKKysrIGIvaW5jbHVkZS91YXBpL2RybS9pOTE1X2RybS5oCkBAIC0xODg5LDYgKzE4
ODksMTYgQEAgZW51bSBkcm1faTkxNV9wZXJmX3Byb3BlcnR5X2lkIHsKIAkgKi8KIAlEUk1fSTkx
NV9QRVJGX1BST1BfT0FfRVhQT05FTlQsCiAKKwkvKioKKwkgKiBTcGVjaWZ5aW5nIHRoaXMgcHJv
cGVydHkgaXMgb25seSB2YWxpZCB3aGVuIHNwZWNpZnkgYSBjb250ZXh0IHRvCisJICogZmlsdGVy
IHdpdGggRFJNX0k5MTVfUEVSRl9QUk9QX0NUWF9IQU5ETEUuIFNwZWNpZnlpbmcgdGhpcyBwcm9w
ZXJ0eQorCSAqIHdpbGwgaG9sZCBwcmVlbXB0aW9uIG9mIHRoZSBwYXJ0aWN1bGFyIGNvbnRleHQg
d2Ugd2FudCB0byBnYXRoZXIKKwkgKiBwZXJmb3JtYW5jZSBkYXRhIGFib3V0LgorCSAqCisJICog
VGhpcyBwcm9wZXJ0eSBpcyBhdmFpbGFibGUgaW4gcGVyZiByZXZpc2lvbiAyLgorCSAqLworCURS
TV9JOTE1X1BFUkZfUFJPUF9IT0xEX1BSRUVNUFRJT04sCisKIAlEUk1fSTkxNV9QRVJGX1BST1Bf
TUFYIC8qIG5vbi1BQkkgKi8KIH07CiAKLS0gCjIuMjEuMC4zOTIuZ2Y4ZjY3ODcxNTllCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

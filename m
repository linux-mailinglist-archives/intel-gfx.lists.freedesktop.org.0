Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 191BF49AF0
	for <lists+intel-gfx@lfdr.de>; Tue, 18 Jun 2019 09:43:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2EC4E6E11B;
	Tue, 18 Jun 2019 07:43:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3A54B6E10D
 for <intel-gfx@lists.freedesktop.org>; Tue, 18 Jun 2019 07:43:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16935660-1500050 
 for multiple; Tue, 18 Jun 2019 08:42:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 18 Jun 2019 08:41:46 +0100
Message-Id: <20190618074153.16055-19-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190618074153.16055-1-chris@chris-wilson.co.uk>
References: <20190618074153.16055-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 19/26] drm/i915/overlay: Switch to using
 i915_active tracking
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVtb3ZlIHRoZSByYXcgaTkxNV9hY3RpdmVfcmVxdWVzdCB0cmFja2luZyBpbiBmYXZvdXIgb2Yg
dGhlIGhpZ2hlcgpsZXZlbCBpOTE1X2FjdGl2ZSB0cmFja2luZyBmb3IgdGhlIHNvbGUgcHVycG9z
ZSBvZiBtYWtpbmcgdGhlIGxvY2tsZXNzCnRyYW5zaXRpb24gZWFzaWVyIGluIGxhdGVyIHBhdGNo
ZXMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyB8IDEz
MCArKysrKysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5o
ICAgICAgICAgICB8ICAxOSAtLS0KIDIgZmlsZXMgY2hhbmdlZCwgNjQgaW5zZXJ0aW9ucygrKSwg
ODUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292
ZXJsYXkuYwppbmRleCAyMTMzOWI3ZjZhM2UuLmM3ZDJkOTgwZGY4YyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTE5MCw3ICsxOTAsOCBAQCBz
dHJ1Y3QgaW50ZWxfb3ZlcmxheSB7CiAJc3RydWN0IG92ZXJsYXlfcmVnaXN0ZXJzIF9faW9tZW0g
KnJlZ3M7CiAJdTMyIGZsaXBfYWRkcjsKIAkvKiBmbGlwIGhhbmRsaW5nICovCi0Jc3RydWN0IGk5
MTVfYWN0aXZlX3JlcXVlc3QgbGFzdF9mbGlwOworCXN0cnVjdCBpOTE1X2FjdGl2ZSBsYXN0X2Zs
aXA7CisJdm9pZCAoKmZsaXBfY29tcGxldGUpKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmwpOwog
fTsKIAogc3RhdGljIHZvaWQgaTgzMF9vdmVybGF5X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0yMTYsMzIgKzIxNywyNiBAQCBzdGF0aWMgdm9pZCBp
ODMwX292ZXJsYXlfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJCQkgIFBDSV9ERVZGTigwLCAwKSwgSTgzMF9DTE9DS19HQVRFLCB2YWwpOwogfQogCi1z
dGF0aWMgdm9pZCBpbnRlbF9vdmVybGF5X3N1Ym1pdF9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9vdmVy
bGF5ICpvdmVybGF5LAotCQkJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0JCQkJCSBpOTE1
X2FjdGl2ZV9yZXRpcmVfZm4gcmV0aXJlKQorc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgor
YWxsb2NfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwgdm9pZCAoKmZuKShz
dHJ1Y3QgaW50ZWxfb3ZlcmxheSAqKSkKIHsKLQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX3JlcXVl
c3RfcGVlaygmb3ZlcmxheS0+bGFzdF9mbGlwLAotCQkJCQkgICAgJm92ZXJsYXktPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpKTsKLQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldF9yZXRpcmVfZm4oJm92
ZXJsYXktPmxhc3RfZmxpcCwgcmV0aXJlLAotCQkJCQkgICZvdmVybGF5LT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZvdmVybGF5LT5sYXN0X2Zs
aXAsIHJxKTsKLQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLX0KKwlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUgPSBvdmVybGF5LT5pOTE1LT5lbmdpbmVbUkNTMF07CisJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7CisJaW50IGVycjsKIAotc3RhdGljIGludCBpbnRlbF9vdmVybGF5X2RvX3dh
aXRfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKLQkJCQkJIHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLAotCQkJCQkgaTkxNV9hY3RpdmVfcmV0aXJlX2ZuIHJldGlyZSkKLXsK
LQlpbnRlbF9vdmVybGF5X3N1Ym1pdF9yZXF1ZXN0KG92ZXJsYXksIHJxLCByZXRpcmUpOwotCXJl
dHVybiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSgmb3ZlcmxheS0+bGFzdF9mbGlwLAotCQkJ
CQkgICZvdmVybGF5LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLX0KKwlvdmVybGF5LT5mbGlw
X2NvbXBsZXRlID0gZm47CiAKLXN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICphbGxvY19yZXF1
ZXN0KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQotewotCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSA9IG92ZXJsYXktPmk5MTUtPmVuZ2luZVtSQ1MwXTsKKwlycSA9IGk5MTVf
cmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJaWYgKElTX0VSUihycSkp
CisJCXJldHVybiBycTsKKworCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmb3ZlcmxheS0+bGFzdF9m
bGlwLCBycS0+ZmVuY2UuY29udGV4dCwgcnEpOworCWlmIChlcnIpIHsKKwkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CisJCXJldHVybiBFUlJfUFRSKGVycik7CisJfQogCi0JcmV0dXJuIGk5MTVfcmVx
dWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJcmV0dXJuIHJxOwogfQogCiAv
KiBvdmVybGF5IG5lZWRzIHRvIGJlIGRpc2FibGUgaW4gT0NNRCByZWcgKi8KQEAgLTI1Myw3ICsy
NDgsNyBAQCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfb24oc3RydWN0IGludGVsX292ZXJsYXkg
Km92ZXJsYXkpCiAKIAlXQVJOX09OKG92ZXJsYXktPmFjdGl2ZSk7CiAKLQlycSA9IGFsbG9jX3Jl
cXVlc3Qob3ZlcmxheSk7CisJcnEgPSBhbGxvY19yZXF1ZXN0KG92ZXJsYXksIE5VTEwpOwogCWlm
IChJU19FUlIocnEpKQogCQlyZXR1cm4gUFRSX0VSUihycSk7CiAKQEAgLTI3NCw3ICsyNjksOSBA
QCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfb24oc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJs
YXkpCiAJKmNzKysgPSBNSV9OT09QOwogCWludGVsX3JpbmdfYWR2YW5jZShycSwgY3MpOwogCi0J
cmV0dXJuIGludGVsX292ZXJsYXlfZG9fd2FpdF9yZXF1ZXN0KG92ZXJsYXksIHJxLCBOVUxMKTsK
KwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCXJldHVybiBpOTE1X2FjdGl2ZV93YWl0KCZvdmVy
bGF5LT5sYXN0X2ZsaXApOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9vdmVybGF5X2ZsaXBfcHJl
cGFyZShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKQEAgLTMxOCw3ICszMTUsNyBAQCBz
dGF0aWMgaW50IGludGVsX292ZXJsYXlfY29udGludWUoc3RydWN0IGludGVsX292ZXJsYXkgKm92
ZXJsYXksCiAJaWYgKHRtcCAmICgxIDw8IDE3KSkKIAkJRFJNX0RFQlVHKCJvdmVybGF5IHVuZGVy
cnVuLCBET1ZTVEE6ICV4XG4iLCB0bXApOwogCi0JcnEgPSBhbGxvY19yZXF1ZXN0KG92ZXJsYXkp
OworCXJxID0gYWxsb2NfcmVxdWVzdChvdmVybGF5LCBOVUxMKTsKIAlpZiAoSVNfRVJSKHJxKSkK
IAkJcmV0dXJuIFBUUl9FUlIocnEpOwogCkBAIC0zMzMsOCArMzMwLDcgQEAgc3RhdGljIGludCBp
bnRlbF9vdmVybGF5X2NvbnRpbnVlKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCWlu
dGVsX3JpbmdfYWR2YW5jZShycSwgY3MpOwogCiAJaW50ZWxfb3ZlcmxheV9mbGlwX3ByZXBhcmUo
b3ZlcmxheSwgdm1hKTsKLQotCWludGVsX292ZXJsYXlfc3VibWl0X3JlcXVlc3Qob3ZlcmxheSwg
cnEsIE5VTEwpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0z
NTUsMjAgKzM1MSwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9vdmVybGF5X3JlbGVhc2Vfb2xkX3Zt
YShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSkKIH0KIAogc3RhdGljIHZvaWQKLWludGVs
X292ZXJsYXlfcmVsZWFzZV9vbGRfdmlkX3RhaWwoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3Qg
KmFjdGl2ZSwKLQkJCQkgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK2ludGVsX292ZXJsYXlf
cmVsZWFzZV9vbGRfdmlkX3RhaWwoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkpCiB7Ci0J
c3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkgPQotCQljb250YWluZXJfb2YoYWN0aXZlLCB0
eXBlb2YoKm92ZXJsYXkpLCBsYXN0X2ZsaXApOwotCiAJaW50ZWxfb3ZlcmxheV9yZWxlYXNlX29s
ZF92bWEob3ZlcmxheSk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX292ZXJsYXlfb2ZmX3RhaWwo
c3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCQkgICBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKK3N0YXRpYyB2b2lkIGludGVsX292ZXJsYXlfb2ZmX3RhaWwoc3RydWN0IGlu
dGVsX292ZXJsYXkgKm92ZXJsYXkpCiB7Ci0Jc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkg
PQotCQljb250YWluZXJfb2YoYWN0aXZlLCB0eXBlb2YoKm92ZXJsYXkpLCBsYXN0X2ZsaXApOwog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG92ZXJsYXktPmk5MTU7CiAKIAlp
bnRlbF9vdmVybGF5X3JlbGVhc2Vfb2xkX3ZtYShvdmVybGF5KTsKQEAgLTM4MSw2ICszNzAsMTYg
QEAgc3RhdGljIHZvaWQgaW50ZWxfb3ZlcmxheV9vZmZfdGFpbChzdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCAqYWN0aXZlLAogCQlpODMwX292ZXJsYXlfY2xvY2tfZ2F0aW5nKGRldl9wcml2LCB0
cnVlKTsKIH0KIAorc3RhdGljIHZvaWQKK2ludGVsX292ZXJsYXlfbGFzdF9mbGlwX3JldGlyZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKmFjdGl2ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3Zl
cmxheSA9CisJCWNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigqb3ZlcmxheSksIGxhc3RfZmxp
cCk7CisKKwlpZiAob3ZlcmxheS0+ZmxpcF9jb21wbGV0ZSkKKwkJb3ZlcmxheS0+ZmxpcF9jb21w
bGV0ZShvdmVybGF5KTsKK30KKwogLyogb3ZlcmxheSBuZWVkcyB0byBiZSBkaXNhYmxlZCBpbiBP
Q01EIHJlZyAqLwogc3RhdGljIGludCBpbnRlbF9vdmVybGF5X29mZihzdHJ1Y3QgaW50ZWxfb3Zl
cmxheSAqb3ZlcmxheSkKIHsKQEAgLTM5NSw3ICszOTQsNyBAQCBzdGF0aWMgaW50IGludGVsX292
ZXJsYXlfb2ZmKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQogCSAqIG9mIHRoZSBody4g
RG8gaXQgaW4gYm90aCBjYXNlcyAqLwogCWZsaXBfYWRkciB8PSBPRkNfVVBEQVRFOwogCi0JcnEg
PSBhbGxvY19yZXF1ZXN0KG92ZXJsYXkpOworCXJxID0gYWxsb2NfcmVxdWVzdChvdmVybGF5LCBp
bnRlbF9vdmVybGF5X29mZl90YWlsKTsKIAlpZiAoSVNfRVJSKHJxKSkKIAkJcmV0dXJuIFBUUl9F
UlIocnEpOwogCkBAIC00MTgsMTcgKzQxNywxNiBAQCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlf
b2ZmKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQogCWludGVsX3JpbmdfYWR2YW5jZShy
cSwgY3MpOwogCiAJaW50ZWxfb3ZlcmxheV9mbGlwX3ByZXBhcmUob3ZlcmxheSwgTlVMTCk7CisJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7CiAKLQlyZXR1cm4gaW50ZWxfb3ZlcmxheV9kb193YWl0X3Jl
cXVlc3Qob3ZlcmxheSwgcnEsCi0JCQkJCSAgICAgaW50ZWxfb3ZlcmxheV9vZmZfdGFpbCk7CisJ
cmV0dXJuIGk5MTVfYWN0aXZlX3dhaXQoJm92ZXJsYXktPmxhc3RfZmxpcCk7CiB9CiAKIC8qIHJl
Y292ZXIgZnJvbSBhbiBpbnRlcnJ1cHRpb24gZHVlIHRvIGEgc2lnbmFsCiAgKiBXZSBoYXZlIHRv
IGJlIGNhcmVmdWwgbm90IHRvIHJlcGVhdCB3b3JrIGZvcmV2ZXIgYW4gbWFrZSBmb3J3YXJkIHBy
b2dlc3MuICovCiBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfcmVjb3Zlcl9mcm9tX2ludGVycnVw
dChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSkKIHsKLQlyZXR1cm4gaTkxNV9hY3RpdmVf
cmVxdWVzdF9yZXRpcmUoJm92ZXJsYXktPmxhc3RfZmxpcCwKLQkJCQkJICAmb3ZlcmxheS0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJcmV0dXJuIGk5MTVfYWN0aXZlX3dhaXQoJm92ZXJsYXkt
Pmxhc3RfZmxpcCk7CiB9CiAKIC8qIFdhaXQgZm9yIHBlbmRpbmcgb3ZlcmxheSBmbGlwIGFuZCBy
ZWxlYXNlIG9sZCBmcmFtZS4KQEAgLTQzOCw0MyArNDM2LDQwIEBAIHN0YXRpYyBpbnQgaW50ZWxf
b3ZlcmxheV9yZWNvdmVyX2Zyb21faW50ZXJydXB0KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVy
bGF5KQogc3RhdGljIGludCBpbnRlbF9vdmVybGF5X3JlbGVhc2Vfb2xkX3ZpZChzdHJ1Y3QgaW50
ZWxfb3ZlcmxheSAqb3ZlcmxheSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBvdmVybGF5LT5pOTE1OworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCXUzMiAqY3M7
Ci0JaW50IHJldDsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0
X211dGV4KTsKIAotCS8qIE9ubHkgd2FpdCBpZiB0aGVyZSBpcyBhY3R1YWxseSBhbiBvbGQgZnJh
bWUgdG8gcmVsZWFzZSB0bworCS8qCisJICogT25seSB3YWl0IGlmIHRoZXJlIGlzIGFjdHVhbGx5
IGFuIG9sZCBmcmFtZSB0byByZWxlYXNlIHRvCiAJICogZ3VhcmFudGVlIGZvcndhcmQgcHJvZ3Jl
c3MuCiAJICovCiAJaWYgKCFvdmVybGF5LT5vbGRfdm1hKQogCQlyZXR1cm4gMDsKIAotCWlmIChJ
OTE1X1JFQUQoR0VOMl9JU1IpICYgSTkxNV9PVkVSTEFZX1BMQU5FX0ZMSVBfUEVORElOR19JTlRF
UlJVUFQpIHsKLQkJLyogc3luY2hyb25vdXMgc2xvd3BhdGggKi8KLQkJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CisJaWYgKCEoSTkxNV9SRUFEKEdFTjJfSVNSKSAmIEk5MTVfT1ZFUkxBWV9QTEFO
RV9GTElQX1BFTkRJTkdfSU5URVJSVVBUKSkgeworCQlpbnRlbF9vdmVybGF5X3JlbGVhc2Vfb2xk
X3ZpZF90YWlsKG92ZXJsYXkpOworCQlyZXR1cm4gMDsKKwl9CiAKLQkJcnEgPSBhbGxvY19yZXF1
ZXN0KG92ZXJsYXkpOwotCQlpZiAoSVNfRVJSKHJxKSkKLQkJCXJldHVybiBQVFJfRVJSKHJxKTsK
KwlycSA9IGFsbG9jX3JlcXVlc3Qob3ZlcmxheSwgaW50ZWxfb3ZlcmxheV9yZWxlYXNlX29sZF92
aWRfdGFpbCk7CisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBQVFJfRVJSKHJxKTsKIAotCQlj
cyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDIpOwotCQlpZiAoSVNfRVJSKGNzKSkgewotCQkJaTkx
NV9yZXF1ZXN0X2FkZChycSk7Ci0JCQlyZXR1cm4gUFRSX0VSUihjcyk7Ci0JCX0KKwljcyA9IGlu
dGVsX3JpbmdfYmVnaW4ocnEsIDIpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5MTVfcmVxdWVz
dF9hZGQocnEpOworCQlyZXR1cm4gUFRSX0VSUihjcyk7CisJfQogCi0JCSpjcysrID0gTUlfV0FJ
VF9GT1JfRVZFTlQgfCBNSV9XQUlUX0ZPUl9PVkVSTEFZX0ZMSVA7Ci0JCSpjcysrID0gTUlfTk9P
UDsKLQkJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisJKmNzKysgPSBNSV9XQUlUX0ZPUl9F
VkVOVCB8IE1JX1dBSVRfRk9SX09WRVJMQVlfRkxJUDsKKwkqY3MrKyA9IE1JX05PT1A7CisJaW50
ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CiAKLQkJcmV0ID0gaW50ZWxfb3ZlcmxheV9kb193YWl0
X3JlcXVlc3Qob3ZlcmxheSwgcnEsCi0JCQkJCQkgICAgaW50ZWxfb3ZlcmxheV9yZWxlYXNlX29s
ZF92aWRfdGFpbCk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0gZWxzZQotCQlpbnRl
bF9vdmVybGF5X3JlbGVhc2Vfb2xkX3ZpZF90YWlsKCZvdmVybGF5LT5sYXN0X2ZsaXAsIE5VTEwp
OworCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCi0JcmV0dXJuIDA7CisJcmV0dXJuIGk5MTVfYWN0
aXZlX3dhaXQoJm92ZXJsYXktPmxhc3RfZmxpcCk7CiB9CiAKIHZvaWQgaW50ZWxfb3ZlcmxheV9y
ZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xMzcxLDcgKzEzNjYs
OSBAQCB2b2lkIGludGVsX292ZXJsYXlfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCW92ZXJsYXktPmNvbnRyYXN0ID0gNzU7CiAJb3ZlcmxheS0+c2F0dXJhdGlvbiA9
IDE0NjsKIAotCUlOSVRfQUNUSVZFX1JFUVVFU1QoJm92ZXJsYXktPmxhc3RfZmxpcCk7CisJaTkx
NV9hY3RpdmVfaW5pdChkZXZfcHJpdiwKKwkJCSAmb3ZlcmxheS0+bGFzdF9mbGlwLAorCQkJIE5V
TEwsIGludGVsX292ZXJsYXlfbGFzdF9mbGlwX3JldGlyZSk7CiAKIAlyZXQgPSBnZXRfcmVnaXN0
ZXJzKG92ZXJsYXksIE9WRVJMQVlfTkVFRFNfUEhZU0lDQUwoZGV2X3ByaXYpKTsKIAlpZiAocmV0
KQpAQCAtMTQwNSw2ICsxNDAyLDcgQEAgdm9pZCBpbnRlbF9vdmVybGF5X2NsZWFudXAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCVdBUk5fT04ob3ZlcmxheS0+YWN0aXZlKTsK
IAogCWk5MTVfZ2VtX29iamVjdF9wdXQob3ZlcmxheS0+cmVnX2JvKTsKKwlpOTE1X2FjdGl2ZV9m
aW5pKCZvdmVybGF5LT5sYXN0X2ZsaXApOwogCiAJa2ZyZWUob3ZlcmxheSk7CiB9CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuaAppbmRleCAxMzQxNjZkMzEyNTEuLjkxMWE4MzM4MDA3YSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCkBAIC04OSwyNSArODksNiBAQCBpbnQgX19tdXN0
X2NoZWNrCiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVz
dCAqYWN0aXZlLAogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwogCi0vKioKLSAqIGk5MTVf
YWN0aXZlX3JlcXVlc3Rfc2V0X3JldGlyZV9mbiAtIHVwZGF0ZXMgdGhlIHJldGlyZW1lbnQgY2Fs
bGJhY2sKLSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKLSAqIEBmbiAtIHRoZSByb3V0
aW5lIGNhbGxlZCB3aGVuIHRoZSByZXF1ZXN0IGlzIHJldGlyZWQKLSAqIEBtdXRleCAtIHN0cnVj
dF9tdXRleCB1c2VkIHRvIGd1YXJkIHJldGlyZW1lbnRzCi0gKgotICogaTkxNV9hY3RpdmVfcmVx
dWVzdF9zZXRfcmV0aXJlX2ZuKCkgdXBkYXRlcyB0aGUgZnVuY3Rpb24gcG9pbnRlciB0aGF0Ci0g
KiBpcyBjYWxsZWQgd2hlbiB0aGUgZmluYWwgcmVxdWVzdCBhc3NvY2lhdGVkIHdpdGggdGhlIEBh
Y3RpdmUgdHJhY2tlcgotICogaXMgcmV0aXJlZC4KLSAqLwotc3RhdGljIGlubGluZSB2b2lkCi1p
OTE1X2FjdGl2ZV9yZXF1ZXN0X3NldF9yZXRpcmVfZm4oc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVl
c3QgKmFjdGl2ZSwKLQkJCQkgIGk5MTVfYWN0aXZlX3JldGlyZV9mbiBmbiwKLQkJCQkgIHN0cnVj
dCBtdXRleCAqbXV0ZXgpCi17Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZChtdXRleCk7Ci0JYWN0aXZl
LT5yZXRpcmUgPSBmbiA/OiBpOTE1X2FjdGl2ZV9yZXRpcmVfbm9vcDsKLX0KLQogLyoqCiAgKiBp
OTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdyAtIHJldHVybiB0aGUgYWN0aXZlIHJlcXVlc3QKICAqIEBh
Y3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

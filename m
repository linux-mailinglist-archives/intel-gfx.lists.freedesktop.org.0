Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9FC69D566C
	for <lists+intel-gfx@lfdr.de>; Sun, 13 Oct 2019 15:50:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6A3AE6E11A;
	Sun, 13 Oct 2019 13:50:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 256F26E115;
 Sun, 13 Oct 2019 13:50:35 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18822240-1500050 
 for multiple; Sun, 13 Oct 2019 14:50:22 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 13 Oct 2019 14:50:20 +0100
Message-Id: <20191013135021.31957-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 1/2] lib: Generalise rapl interface
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY2FuIHVzZSBvdXIgZXhpc3RpbmcgcmFwbCBpbnRlcmZhY2UgdGhhdCBtb25pdG9ycyBncHUg
cG93ZXIsIHRvIGFsc28Kc2FtcGxlIHRoZSBvdGhlciByYXBsIGRvbWFpbnMgc3VjaCBhcyBwYWNr
YWdlLCBjb3JlcyBhbmQgcmFtLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+CkNjOiBBbmRpIFNoeXRpIDxhbmRpLnNoeXRpQGludGVsLmNvbT4K
LS0tCiBsaWIvTWFrZWZpbGUuc291cmNlcyAgICAgICAgICAgICAgICB8ICA0ICstCiBsaWIvaWd0
X2dwdV9wb3dlci5jICAgICAgICAgICAgICAgICB8IDg3IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tCiBsaWIvaWd0X3JhcGwuYyAgICAgICAgICAgICAgICAgICAgICB8IDY5ICsrKysrKysr
KysrKysrKysrKysrKysrCiBsaWIve2lndF9ncHVfcG93ZXIuaCA9PiBpZ3RfcmFwbC5ofSB8IDY5
ICsrKysrKysrKysrKysrKystLS0tLS0tCiBsaWIvbWVzb24uYnVpbGQgICAgICAgICAgICAgICAg
ICAgICB8ICAyICstCiB0ZXN0cy9pOTE1L2dlbV9leGVjX3NjaGVkdWxlLmMgICAgICB8IDM5ICsr
KysrKysrLS0tLS0KIHRlc3RzL2k5MTUvZ2VtX2V4ZWNfd2hpc3Blci5jICAgICAgIHwgMTUgKyst
LS0KIDcgZmlsZXMgY2hhbmdlZCwgMTU1IGluc2VydGlvbnMoKyksIDEzMCBkZWxldGlvbnMoLSkK
IGRlbGV0ZSBtb2RlIDEwMDY0NCBsaWIvaWd0X2dwdV9wb3dlci5jCiBjcmVhdGUgbW9kZSAxMDA2
NDQgbGliL2lndF9yYXBsLmMKIHJlbmFtZSBsaWIve2lndF9ncHVfcG93ZXIuaCA9PiBpZ3RfcmFw
bC5ofSAoNTIlKQoKZGlmZiAtLWdpdCBhL2xpYi9NYWtlZmlsZS5zb3VyY2VzIGIvbGliL01ha2Vm
aWxlLnNvdXJjZXMKaW5kZXggY2YwOTRhYjg5Li4zNGUwYzAxMmQgMTAwNjQ0Ci0tLSBhL2xpYi9N
YWtlZmlsZS5zb3VyY2VzCisrKyBiL2xpYi9NYWtlZmlsZS5zb3VyY2VzCkBAIC0zMyw4ICszMyw2
IEBAIGxpYl9zb3VyY2VfbGlzdCA9CSAJXAogCWlndF9lZGlkLmgJCVwKIAlpZ3RfZWxkLmMJCVwK
IAlpZ3RfZWxkLmgJCVwKLQlpZ3RfZ3B1X3Bvd2VyLmMJCVwKLQlpZ3RfZ3B1X3Bvd2VyLmgJCVwK
IAlpZ3RfZ3QuYwkJXAogCWlndF9ndC5oCQlcCiAJaWd0X2d2dC5jCQlcCkBAIC00OSw2ICs0Nyw4
IEBAIGxpYl9zb3VyY2VfbGlzdCA9CSAJXAogCWlndF9wcmltZXMuaAkJXAogCWlndF9yYW5kLmMJ
CVwKIAlpZ3RfcmFuZC5oCQlcCisJaWd0X3JhcGwuYwkJXAorCWlndF9yYXBsLmgJCVwKIAlpZ3Rf
cmMuaAkJXAogCWlndF9zdGF0cy5jCQlcCiAJaWd0X3N0YXRzLmgJCVwKZGlmZiAtLWdpdCBhL2xp
Yi9pZ3RfZ3B1X3Bvd2VyLmMgYi9saWIvaWd0X2dwdV9wb3dlci5jCmRlbGV0ZWQgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCA3MDkyYjc1YjMuLjAwMDAwMDAwMAotLS0gYS9saWIvaWd0X2dwdV9wb3dl
ci5jCisrKyAvZGV2L251bGwKQEAgLTEsODcgKzAsMCBAQAotI2luY2x1ZGUgPGN0eXBlLmg+Ci0j
aW5jbHVkZSA8ZXJybm8uaD4KLSNpbmNsdWRlIDxmY250bC5oPgotI2luY2x1ZGUgPGxvY2FsZS5o
PgotI2luY2x1ZGUgPG1hdGguaD4KLSNpbmNsdWRlIDx1bmlzdGQuaD4KLSNpbmNsdWRlIDxpbnR0
eXBlcy5oPgotCi0jaW5jbHVkZSAiaWd0X2dwdV9wb3dlci5oIgotI2luY2x1ZGUgImlndF9wZXJm
LmgiCi0jaW5jbHVkZSAiaWd0X3N5c2ZzLmgiCi0KLXN0cnVjdCByYXBsIHsKLQl1aW50NjRfdCBw
b3dlciwgdHlwZTsKLQlkb3VibGUgc2NhbGU7Ci19OwotCi1zdGF0aWMgaW50IHJhcGxfcGFyc2Uo
c3RydWN0IHJhcGwgKnIpCi17Ci0JbG9jYWxlX3QgbG9jYWxlLCBvbGRsb2NhbGU7Ci0JYm9vbCBy
ZXN1bHQ7Ci0JaW50IGRpcjsKLQotCW1lbXNldChyLCAwLCBzaXplb2YoKnIpKTsKLQotCWRpciA9
IG9wZW4oIi9zeXMvZGV2aWNlcy9wb3dlciIsIE9fUkRPTkxZKTsKLQlpZiAoZGlyIDwgMCkKLQkJ
cmV0dXJuIC1lcnJubzsKLQotCS8qIFJlcGxhY2UgdXNlciBlbnZpcm9ubWVudCB3aXRoIHBsYWlu
IEMgdG8gbWF0Y2gga2VybmVsIGZvcm1hdCAqLwotCWxvY2FsZSA9IG5ld2xvY2FsZShMQ19BTEws
ICJDIiwgMCk7Ci0Jb2xkbG9jYWxlID0gdXNlbG9jYWxlKGxvY2FsZSk7Ci0KLQlyZXN1bHQgPSB0
cnVlOwotCXJlc3VsdCAmPSBpZ3Rfc3lzZnNfc2NhbmYoZGlyLCAidHlwZSIsCi0JCQkJICAiJSJQ
Ukl1NjQsICZyLT50eXBlKSA9PSAxOwotCXJlc3VsdCAmPSBpZ3Rfc3lzZnNfc2NhbmYoZGlyLCAi
ZXZlbnRzL2VuZXJneS1ncHUiLAotCQkJCSAgImV2ZW50PSUiUFJJeDY0LCAmci0+cG93ZXIpID09
IDE7Ci0JcmVzdWx0ICY9IGlndF9zeXNmc19zY2FuZihkaXIsICJldmVudHMvZW5lcmd5LWdwdS5z
Y2FsZSIsCi0JCQkJICAiJWxmIiwgJnItPnNjYWxlKSA9PSAxOwotCi0JdXNlbG9jYWxlKG9sZGxv
Y2FsZSk7Ci0JZnJlZWxvY2FsZShsb2NhbGUpOwotCi0JY2xvc2UoZGlyKTsKLQotCWlmICghcmVz
dWx0KQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWlmIChpc25hbihyLT5zY2FsZSkgfHwgIXItPnNj
YWxlKQotCQlyZXR1cm4gLUVSQU5HRTsKLQotCXJldHVybiAwOwotfQotCi1pbnQgZ3B1X3Bvd2Vy
X29wZW4oc3RydWN0IGdwdV9wb3dlciAqcG93ZXIpCi17Ci0Jc3RydWN0IHJhcGwgcjsKLQotCXBv
d2VyLT5mZCA9IHJhcGxfcGFyc2UoJnIpOwotCWlmIChwb3dlci0+ZmQgPCAwKQotCQlnb3RvIGVy
cjsKLQotCXBvd2VyLT5mZCA9IGlndF9wZXJmX29wZW4oci50eXBlLCByLnBvd2VyKTsKLQlpZiAo
cG93ZXItPmZkIDwgMCkgewotCQlwb3dlci0+ZmQgPSAtZXJybm87Ci0JCWdvdG8gZXJyOwotCX0K
LQotCXBvd2VyLT5zY2FsZSA9IHIuc2NhbGU7Ci0KLQlyZXR1cm4gMDsKLQotZXJyOgotCWVycm5v
ID0gMDsKLQlyZXR1cm4gcG93ZXItPmZkOwotfQotCi1ib29sIGdwdV9wb3dlcl9yZWFkKHN0cnVj
dCBncHVfcG93ZXIgKnBvd2VyLCBzdHJ1Y3QgZ3B1X3Bvd2VyX3NhbXBsZSAqcykKLXsKLQlyZXR1
cm4gcmVhZChwb3dlci0+ZmQsIHMsIHNpemVvZigqcykpID09IHNpemVvZigqcyk7Ci19Ci0KLXZv
aWQgZ3B1X3Bvd2VyX2Nsb3NlKHN0cnVjdCBncHVfcG93ZXIgKnBvd2VyKQotewotCWNsb3NlKHBv
d2VyLT5mZCk7Ci19CmRpZmYgLS1naXQgYS9saWIvaWd0X3JhcGwuYyBiL2xpYi9pZ3RfcmFwbC5j
Cm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMC4uMDNlNDkyMjYwCi0tLSAvZGV2
L251bGwKKysrIGIvbGliL2lndF9yYXBsLmMKQEAgLTAsMCArMSw2OSBAQAorI2luY2x1ZGUgPGN0
eXBlLmg+CisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxmY250bC5oPgorI2luY2x1ZGUg
PGxvY2FsZS5oPgorI2luY2x1ZGUgPG1hdGguaD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KKyNpbmNs
dWRlIDxpbnR0eXBlcy5oPgorCisjaW5jbHVkZSAiaWd0X3BlcmYuaCIKKyNpbmNsdWRlICJpZ3Rf
cmFwbC5oIgorI2luY2x1ZGUgImlndF9zeXNmcy5oIgorCitzdGF0aWMgaW50IHJhcGxfcGFyc2Uo
c3RydWN0IHJhcGwgKnIsIGNvbnN0IGNoYXIgKnN0cikKK3sKKwlsb2NhbGVfdCBsb2NhbGUsIG9s
ZGxvY2FsZTsKKwlib29sIHJlc3VsdCA9IHRydWU7CisJY2hhciBidWZbMTI4XTsKKwlpbnQgZGly
OworCisJbWVtc2V0KHIsIDAsIHNpemVvZigqcikpOworCisJZGlyID0gb3BlbigiL3N5cy9kZXZp
Y2VzL3Bvd2VyIiwgT19SRE9OTFkpOworCWlmIChkaXIgPCAwKQorCQlyZXR1cm4gLWVycm5vOwor
CisJLyogUmVwbGFjZSB1c2VyIGVudmlyb25tZW50IHdpdGggcGxhaW4gQyB0byBtYXRjaCBrZXJu
ZWwgZm9ybWF0ICovCisJbG9jYWxlID0gbmV3bG9jYWxlKExDX0FMTCwgIkMiLCAwKTsKKwlvbGRs
b2NhbGUgPSB1c2Vsb2NhbGUobG9jYWxlKTsKKworCXJlc3VsdCAmPSBpZ3Rfc3lzZnNfc2NhbmYo
ZGlyLCAidHlwZSIsICIlIlBSSXU2NCwgJnItPnR5cGUpID09IDE7CisKKwlzbnByaW50ZihidWYs
IHNpemVvZihidWYpLCAiZXZlbnRzL2VuZXJneS0lcyIsIHN0cik7CisJcmVzdWx0ICY9IGlndF9z
eXNmc19zY2FuZihkaXIsIGJ1ZiwgImV2ZW50PSUiUFJJeDY0LCAmci0+cG93ZXIpID09IDE7CisK
KwlzbnByaW50ZihidWYsIHNpemVvZihidWYpLCAiZXZlbnRzL2VuZXJneS0lcy5zY2FsZSIsIHN0
cik7CisJcmVzdWx0ICY9IGlndF9zeXNmc19zY2FuZihkaXIsIGJ1ZiwgIiVsZiIsICZyLT5zY2Fs
ZSkgPT0gMTsKKworCXVzZWxvY2FsZShvbGRsb2NhbGUpOworCWZyZWVsb2NhbGUobG9jYWxlKTsK
KworCWNsb3NlKGRpcik7CisKKwlpZiAoIXJlc3VsdCkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlp
ZiAoaXNuYW4oci0+c2NhbGUpIHx8ICFyLT5zY2FsZSkKKwkJcmV0dXJuIC1FUkFOR0U7CisKKwly
ZXR1cm4gMDsKK30KKworaW50IHJhcGxfb3BlbihzdHJ1Y3QgcmFwbCAqciwgY29uc3QgY2hhciAq
ZG9tYWluKQoreworCXItPmZkID0gcmFwbF9wYXJzZShyLCBkb21haW4pOworCWlmIChyLT5mZCA8
IDApCisJCWdvdG8gZXJyOworCisJci0+ZmQgPSBpZ3RfcGVyZl9vcGVuKHItPnR5cGUsIHItPnBv
d2VyKTsKKwlpZiAoci0+ZmQgPCAwKSB7CisJCXItPmZkID0gLWVycm5vOworCQlnb3RvIGVycjsK
Kwl9CisKKwlyZXR1cm4gMDsKKworZXJyOgorCWVycm5vID0gMDsKKwlyZXR1cm4gci0+ZmQ7Cit9
CmRpZmYgLS1naXQgYS9saWIvaWd0X2dwdV9wb3dlci5oIGIvbGliL2lndF9yYXBsLmgKc2ltaWxh
cml0eSBpbmRleCA1MiUKcmVuYW1lIGZyb20gbGliL2lndF9ncHVfcG93ZXIuaApyZW5hbWUgdG8g
bGliL2lndF9yYXBsLmgKaW5kZXggYTU3OGEwMmEwLi41NWM0NjE5OGUgMTAwNjQ0Ci0tLSBhL2xp
Yi9pZ3RfZ3B1X3Bvd2VyLmgKKysrIGIvbGliL2lndF9yYXBsLmgKQEAgLTIyLDQ1ICsyMiw3NCBA
QAogICoKICAqLwogCi0jaWZuZGVmIElHVF9HUFVfUE9XRVJfSAotI2RlZmluZSBJR1RfR1BVX1BP
V0VSX0gKKyNpZm5kZWYgSUdUX1JBUExfSAorI2RlZmluZSBJR1RfUkFQTF9ICiAKICNpbmNsdWRl
IDxzdGRib29sLmg+CiAjaW5jbHVkZSA8c3RkaW50Lmg+CiAKLXN0cnVjdCBncHVfcG93ZXIgewot
CWludCBmZDsKK3N0cnVjdCByYXBsIHsKKwl1aW50NjRfdCBwb3dlciwgdHlwZTsKIAlkb3VibGUg
c2NhbGU7CisJaW50IGZkOwogfTsKIAotc3RydWN0IGdwdV9wb3dlcl9zYW1wbGUgeworc3RydWN0
IHBvd2VyX3NhbXBsZSB7CiAJdWludDY0X3QgZW5lcmd5OwogCXVpbnQ2NF90IHRpbWU7CiB9Owog
Ci1pbnQgZ3B1X3Bvd2VyX29wZW4oc3RydWN0IGdwdV9wb3dlciAqcG93ZXIpOwotYm9vbCBncHVf
cG93ZXJfcmVhZChzdHJ1Y3QgZ3B1X3Bvd2VyICpwb3dlciwgc3RydWN0IGdwdV9wb3dlcl9zYW1w
bGUgKnMpOwotdm9pZCBncHVfcG93ZXJfY2xvc2Uoc3RydWN0IGdwdV9wb3dlciAqcG93ZXIpOwor
aW50IHJhcGxfb3BlbihzdHJ1Y3QgcmFwbCAqciwgY29uc3QgY2hhciAqZG9tYWluKTsKKworc3Rh
dGljIGlubGluZSBpbnQgY3B1X3Bvd2VyX29wZW4oc3RydWN0IHJhcGwgKnIpCit7CisJcmV0dXJu
IHJhcGxfb3BlbihyLCAiY3B1Iik7Cit9CisKK3N0YXRpYyBpbmxpbmUgaW50IGdwdV9wb3dlcl9v
cGVuKHN0cnVjdCByYXBsICpyKQoreworCXJldHVybiByYXBsX29wZW4ociwgImdwdSIpOworfQor
CitzdGF0aWMgaW5saW5lIGludCBwa2dfcG93ZXJfb3BlbihzdHJ1Y3QgcmFwbCAqcikKK3sKKwly
ZXR1cm4gcmFwbF9vcGVuKHIsICJwa2ciKTsKK30KKworc3RhdGljIGlubGluZSBpbnQgcmFtX3Bv
d2VyX29wZW4oc3RydWN0IHJhcGwgKnIpCit7CisJcmV0dXJuIHJhcGxfb3BlbihyLCAicmFtIik7
Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCByYXBsX3JlYWQoc3RydWN0IHJhcGwgKnIsIHN0cnVj
dCBwb3dlcl9zYW1wbGUgKnMpCit7CisJcmV0dXJuIHJlYWQoci0+ZmQsIHMsIHNpemVvZigqcykp
ID09IHNpemVvZigqcyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCByYXBsX2Nsb3NlKHN0cnVj
dCByYXBsICpyKQoreworCWNsb3NlKHItPmZkKTsKK30KIAotc3RhdGljIGlubGluZSBkb3VibGUg
Z3B1X3Bvd2VyX0ooY29uc3Qgc3RydWN0IGdwdV9wb3dlciAqcCwKLQkJCQkgY29uc3Qgc3RydWN0
IGdwdV9wb3dlcl9zYW1wbGUgKnAwLAotCQkJCSBjb25zdCBzdHJ1Y3QgZ3B1X3Bvd2VyX3NhbXBs
ZSAqcDEpCitzdGF0aWMgaW5saW5lIGRvdWJsZSBwb3dlcl9KKGNvbnN0IHN0cnVjdCByYXBsICpy
LAorCQkJICAgICBjb25zdCBzdHJ1Y3QgcG93ZXJfc2FtcGxlICpwMCwKKwkJCSAgICAgY29uc3Qg
c3RydWN0IHBvd2VyX3NhbXBsZSAqcDEpCiB7Ci0JcmV0dXJuIChwMS0+ZW5lcmd5IC0gcDAtPmVu
ZXJneSkgKiBwLT5zY2FsZTsKKwlyZXR1cm4gKHAxLT5lbmVyZ3kgLSBwMC0+ZW5lcmd5KSAqIHIt
PnNjYWxlOwogfQogCi1zdGF0aWMgaW5saW5lIGRvdWJsZSBncHVfcG93ZXJfcyhjb25zdCBzdHJ1
Y3QgZ3B1X3Bvd2VyICpwLAotCQkJCSBjb25zdCBzdHJ1Y3QgZ3B1X3Bvd2VyX3NhbXBsZSAqcDAs
Ci0JCQkJIGNvbnN0IHN0cnVjdCBncHVfcG93ZXJfc2FtcGxlICpwMSkKK3N0YXRpYyBpbmxpbmUg
ZG91YmxlIHBvd2VyX3MoY29uc3Qgc3RydWN0IHJhcGwgKnIsCisJCQkgICAgIGNvbnN0IHN0cnVj
dCBwb3dlcl9zYW1wbGUgKnAwLAorCQkJICAgICBjb25zdCBzdHJ1Y3QgcG93ZXJfc2FtcGxlICpw
MSkKIHsKIAlyZXR1cm4gKHAxLT50aW1lIC0gcDAtPnRpbWUpICogMWUtOTsKIH0KIAotc3RhdGlj
IGlubGluZSBkb3VibGUgZ3B1X3Bvd2VyX1coY29uc3Qgc3RydWN0IGdwdV9wb3dlciAqcCwKLQkJ
CQkgY29uc3Qgc3RydWN0IGdwdV9wb3dlcl9zYW1wbGUgKnAwLAotCQkJCSBjb25zdCBzdHJ1Y3Qg
Z3B1X3Bvd2VyX3NhbXBsZSAqcDEpCitzdGF0aWMgaW5saW5lIGRvdWJsZSBwb3dlcl9XKGNvbnN0
IHN0cnVjdCByYXBsICpyLAorCQkJICAgICBjb25zdCBzdHJ1Y3QgcG93ZXJfc2FtcGxlICpwMCwK
KwkJCSAgICAgY29uc3Qgc3RydWN0IHBvd2VyX3NhbXBsZSAqcDEpCiB7Ci0JcmV0dXJuIGdwdV9w
b3dlcl9KKHAsIHAwLCBwMSkgLyBncHVfcG93ZXJfcyhwLCBwMCwgcDEpOworCXJldHVybiBwb3dl
cl9KKHIsIHAwLCBwMSkgLyBwb3dlcl9zKHIsIHAwLCBwMSk7CiB9CiAKLSNlbmRpZiAvKiBJR1Rf
R1BVX1BPV0VSX0ggKi8KKyNlbmRpZiAvKiBJR1RfUkFQTF9IICovCmRpZmYgLS1naXQgYS9saWIv
bWVzb24uYnVpbGQgYi9saWIvbWVzb24uYnVpbGQKaW5kZXggMjIxYWUyOGMwLi5mYmMwYzhkMTQg
MTAwNjQ0Ci0tLSBhL2xpYi9tZXNvbi5idWlsZAorKysgYi9saWIvbWVzb24uYnVpbGQKQEAgLTEx
LDcgKzExLDYgQEAgbGliX3NvdXJjZXMgPSBbCiAJJ2lndF9kZWJ1Z2ZzLmMnLAogCSdpZ3RfZGV2
aWNlLmMnLAogCSdpZ3RfYXV4LmMnLAotCSdpZ3RfZ3B1X3Bvd2VyLmMnLAogCSdpZ3RfZ3QuYycs
CiAJJ2lndF9ndnQuYycsCiAJJ2lndF9oYWxmZmxvYXQuYycsCkBAIC0xOSw2ICsxOCw3IEBAIGxp
Yl9zb3VyY2VzID0gWwogCSdpZ3RfcGVyZi5jJywKIAknaWd0X3ByaW1lcy5jJywKIAknaWd0X3Jh
bmQuYycsCisJJ2lndF9yYXBsLmMnLAogCSdpZ3Rfc3RhdHMuYycsCiAJJ2lndF9zeW5jb2JqLmMn
LAogCSdpZ3Rfc3lzZnMuYycsCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dlbV9leGVjX3NjaGVk
dWxlLmMgYi90ZXN0cy9pOTE1L2dlbV9leGVjX3NjaGVkdWxlLmMKaW5kZXggZGRjYjFmMjFhLi45
YTJmMjM1MmIgMTAwNjQ0Ci0tLSBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfc2NoZWR1bGUuYworKysg
Yi90ZXN0cy9pOTE1L2dlbV9leGVjX3NjaGVkdWxlLmMKQEAgLTI5LDggKzI5LDggQEAKICNpbmNs
dWRlIDxzaWduYWwuaD4KIAogI2luY2x1ZGUgImlndC5oIgotI2luY2x1ZGUgImlndF9ncHVfcG93
ZXIuaCIKICNpbmNsdWRlICJpZ3RfcmFuZC5oIgorI2luY2x1ZGUgImlndF9yYXBsLmgiCiAjaW5j
bHVkZSAiaWd0X3N5c2ZzLmgiCiAjaW5jbHVkZSAiaWd0X3ZnZW0uaCIKICNpbmNsdWRlICJpOTE1
L2dlbV9yaW5nLmgiCkBAIC0xNjA4LDE0ICsxNjA4LDE2IEBAIHN0YXRpYyB2b2lkIHRlc3RfcGlf
cmluZ2Z1bGwoaW50IGZkLCB1bnNpZ25lZCBpbnQgZW5naW5lKQogCiBzdGF0aWMgdm9pZCBtZWFz
dXJlX3NlbWFwaG9yZV9wb3dlcihpbnQgaTkxNSkKIHsKLQlzdHJ1Y3QgZ3B1X3Bvd2VyIHBvd2Vy
OwogCXVuc2lnbmVkIGludCBlbmdpbmUsIHNpZ25hbGVyOworCXN0cnVjdCByYXBsIGdwdSwgcGtn
OwogCi0JaWd0X3JlcXVpcmUoZ3B1X3Bvd2VyX29wZW4oJnBvd2VyKSA9PSAwKTsKKwlpZ3RfcmVx
dWlyZShwa2dfcG93ZXJfb3BlbigmcGtnKSA9PSAwKTsKKwlpZ3RfcmVxdWlyZShncHVfcG93ZXJf
b3BlbigmZ3B1KSA9PSAwKTsKIAogCWZvcl9lYWNoX3BoeXNpY2FsX2VuZ2luZShpOTE1LCBzaWdu
YWxlcikgewotCQlzdHJ1Y3QgZ3B1X3Bvd2VyX3NhbXBsZSBzX3NwaW5bMl07Ci0JCXN0cnVjdCBn
cHVfcG93ZXJfc2FtcGxlIHNfc2VtYVsyXTsKKwkJc3RydWN0IHsKKwkJCXN0cnVjdCBwb3dlcl9z
YW1wbGUgcGtnLCBncHU7CisJCX0gc19zcGluWzJdLCBzX3NlbWFbMl07CiAJCWRvdWJsZSBiYXNl
bGluZSwgdG90YWw7CiAJCWludDY0X3QgamlmZmllID0gMTsKIAkJaWd0X3NwaW5fdCAqc3BpbjsK
QEAgLTE2MjYsOSArMTYyOCwxMSBAQCBzdGF0aWMgdm9pZCBtZWFzdXJlX3NlbWFwaG9yZV9wb3dl
cihpbnQgaTkxNSkKIAkJZ2VtX3dhaXQoaTkxNSwgc3Bpbi0+aGFuZGxlLCAmamlmZmllKTsgLyog
d2FpdGJvb3N0ICovCiAJCWlndF9zcGluX2J1c3l3YWl0X3VudGlsX3N0YXJ0ZWQoc3Bpbik7CiAK
LQkJZ3B1X3Bvd2VyX3JlYWQoJnBvd2VyLCAmc19zcGluWzBdKTsKKwkJcmFwbF9yZWFkKCZwa2cs
ICZzX3NwaW5bMF0ucGtnKTsKKwkJcmFwbF9yZWFkKCZncHUsICZzX3NwaW5bMF0uZ3B1KTsKIAkJ
dXNsZWVwKDEwMCoxMDAwKTsKLQkJZ3B1X3Bvd2VyX3JlYWQoJnBvd2VyLCAmc19zcGluWzFdKTsK
KwkJcmFwbF9yZWFkKCZncHUsICZzX3NwaW5bMV0uZ3B1KTsKKwkJcmFwbF9yZWFkKCZwa2csICZz
X3NwaW5bMV0ucGtnKTsKIAogCQkvKiBBZGQgYSB3YWl0ZXIgdG8gZWFjaCBlbmdpbmUgKi8KIAkJ
Zm9yX2VhY2hfcGh5c2ljYWxfZW5naW5lKGk5MTUsIGVuZ2luZSkgewpAQCAtMTY0NSwyMyArMTY0
OSwzMiBAQCBzdGF0aWMgdm9pZCBtZWFzdXJlX3NlbWFwaG9yZV9wb3dlcihpbnQgaTkxNSkKIAkJ
fQogCQl1c2xlZXAoMTApOyAvKiBqdXN0IGdpdmUgdGhlIHRhc2tsZXRzIGEgY2hhbmNlIHRvIHJ1
biAqLwogCi0JCWdwdV9wb3dlcl9yZWFkKCZwb3dlciwgJnNfc2VtYVswXSk7CisJCXJhcGxfcmVh
ZCgmcGtnLCAmc19zZW1hWzBdLnBrZyk7CisJCXJhcGxfcmVhZCgmZ3B1LCAmc19zZW1hWzBdLmdw
dSk7CiAJCXVzbGVlcCgxMDAqMTAwMCk7Ci0JCWdwdV9wb3dlcl9yZWFkKCZwb3dlciwgJnNfc2Vt
YVsxXSk7CisJCXJhcGxfcmVhZCgmZ3B1LCAmc19zZW1hWzFdLmdwdSk7CisJCXJhcGxfcmVhZCgm
cGtnLCAmc19zZW1hWzFdLnBrZyk7CiAKIAkJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluKTsKIAot
CQliYXNlbGluZSA9IGdwdV9wb3dlcl9XKCZwb3dlciwgJnNfc3BpblswXSwgJnNfc3BpblsxXSk7
Ci0JCXRvdGFsID0gZ3B1X3Bvd2VyX1coJnBvd2VyLCAmc19zZW1hWzBdLCAmc19zZW1hWzFdKTsK
LQorCQliYXNlbGluZSA9IHBvd2VyX1coJmdwdSwgJnNfc3BpblswXS5ncHUsICZzX3NwaW5bMV0u
Z3B1KTsKKwkJdG90YWwgPSBwb3dlcl9XKCZncHUsICZzX3NlbWFbMF0uZ3B1LCAmc19zZW1hWzFd
LmdwdSk7CiAJCWlndF9pbmZvKCIlczogJS4xZm1XICsgJS4xZm1XICh0b3RhbCAlMS5mbVcpXG4i
LAogCQkJIGVfXy0+bmFtZSwKIAkJCSAxZTMgKiBiYXNlbGluZSwKIAkJCSAxZTMgKiAodG90YWwg
LSBiYXNlbGluZSksCiAJCQkgMWUzICogdG90YWwpOworCisJCWJhc2VsaW5lID0gcG93ZXJfVygm
cGtnLCAmc19zcGluWzBdLnBrZywgJnNfc3BpblsxXS5wa2cpOworCQl0b3RhbCA9IHBvd2VyX1co
JnBrZywgJnNfc2VtYVswXS5wa2csICZzX3NlbWFbMV0ucGtnKTsKKwkJaWd0X2luZm8oInBrZzog
JS4xZm1XICsgJS4xZm1XICh0b3RhbCAlMS5mbVcpXG4iLAorCQkJIDFlMyAqIGJhc2VsaW5lLAor
CQkJIDFlMyAqICh0b3RhbCAtIGJhc2VsaW5lKSwKKwkJCSAxZTMgKiB0b3RhbCk7CiAJfQogCi0J
Z3B1X3Bvd2VyX2Nsb3NlKCZwb3dlcik7CisJcmFwbF9jbG9zZSgmZ3B1KTsKKwlyYXBsX2Nsb3Nl
KCZwa2cpOwogfQogCiBpZ3RfbWFpbgpkaWZmIC0tZ2l0IGEvdGVzdHMvaTkxNS9nZW1fZXhlY193
aGlzcGVyLmMgYi90ZXN0cy9pOTE1L2dlbV9leGVjX3doaXNwZXIuYwppbmRleCBkZTdhMTRkYWQu
LjExMzVjNjQ5NyAxMDA2NDQKLS0tIGEvdGVzdHMvaTkxNS9nZW1fZXhlY193aGlzcGVyLmMKKysr
IGIvdGVzdHMvaTkxNS9nZW1fZXhlY193aGlzcGVyLmMKQEAgLTI5LDcgKzI5LDcgQEAKIAogI2lu
Y2x1ZGUgImlndC5oIgogI2luY2x1ZGUgImlndF9kZWJ1Z2ZzLmgiCi0jaW5jbHVkZSAiaWd0X2dw
dV9wb3dlci5oIgorI2luY2x1ZGUgImlndF9yYXBsLmgiCiAjaW5jbHVkZSAiaWd0X2d0LmgiCiAj
aW5jbHVkZSAiaWd0X3JhbmQuaCIKICNpbmNsdWRlICJpZ3Rfc3lzZnMuaCIKQEAgLTE4Niw4ICsx
ODYsOCBAQCBzdGF0aWMgdm9pZCB3aGlzcGVyKGludCBmZCwgdW5zaWduZWQgZW5naW5lLCB1bnNp
Z25lZCBmbGFncykKIAl1bnNpZ25lZCBpbnQgcmVsb2NfbWlncmF0aW9ucyA9IDA7CiAJdW5zaWdu
ZWQgaW50IHJlbG9jX2ludGVycnVwdGlvbnMgPSAwOwogCXVuc2lnbmVkIGludCBlYl9taWdyYXRp
b25zID0gMDsKLQlzdHJ1Y3QgZ3B1X3Bvd2VyX3NhbXBsZSBzYW1wbGVbMl07Ci0Jc3RydWN0IGdw
dV9wb3dlciBwb3dlcjsKKwlzdHJ1Y3QgcG93ZXJfc2FtcGxlIHNhbXBsZVsyXTsKKwlzdHJ1Y3Qg
cmFwbCByYXBsOwogCXVpbnQ2NF90IG9sZF9vZmZzZXQ7CiAJaW50IGksIG4sIGxvYzsKIAlpbnQg
ZGVidWdmczsKQEAgLTE5OSw3ICsxOTksNyBAQCBzdGF0aWMgdm9pZCB3aGlzcGVyKGludCBmZCwg
dW5zaWduZWQgZW5naW5lLCB1bnNpZ25lZCBmbGFncykKIAl9CiAKIAlkZWJ1Z2ZzID0gaWd0X2Rl
YnVnZnNfZGlyKGZkKTsKLQlncHVfcG93ZXJfb3BlbigmcG93ZXIpOworCWdwdV9wb3dlcl9vcGVu
KCZyYXBsKTsKIAogCW5lbmdpbmUgPSAwOwogCWlmIChlbmdpbmUgPT0gQUxMX0VOR0lORVMpIHsK
QEAgLTIzNCw3ICsyMzQsNyBAQCBzdGF0aWMgdm9pZCB3aGlzcGVyKGludCBmZCwgdW5zaWduZWQg
ZW5naW5lLCB1bnNpZ25lZCBmbGFncykKIAkJbmNoaWxkICo9IG5lbmdpbmU7CiAKIAlpbnRlbF9k
ZXRlY3RfYW5kX2NsZWFyX21pc3NlZF9pbnRlcnJ1cHRzKGZkKTsKLQlncHVfcG93ZXJfcmVhZCgm
cG93ZXIsICZzYW1wbGVbMF0pOworCXJhcGxfcmVhZCgmcmFwbCwgJnNhbXBsZVswXSk7CiAJaWd0
X2ZvcmsoY2hpbGQsIG5jaGlsZCkgewogCQl1bnNpZ25lZCBpbnQgcGFzczsKIApAQCAtNTEwLDEx
ICs1MTAsMTIgQEAgc3RhdGljIHZvaWQgd2hpc3BlcihpbnQgZmQsIHVuc2lnbmVkIGVuZ2luZSwg
dW5zaWduZWQgZmxhZ3MpCiAJCWZpbmlfaGFuZygmaGFuZyk7CiAJZWxzZQogCQlpZ3RfYXNzZXJ0
X2VxKGludGVsX2RldGVjdF9hbmRfY2xlYXJfbWlzc2VkX2ludGVycnVwdHMoZmQpLCAwKTsKLQlp
ZiAoZ3B1X3Bvd2VyX3JlYWQoJnBvd2VyLCAmc2FtcGxlWzFdKSkgIHsKKwlpZiAocmFwbF9yZWFk
KCZyYXBsLCAmc2FtcGxlWzFdKSkgIHsKIAkJaWd0X2luZm8oIlRvdGFsIGVuZXJneSB1c2VkOiAl
LjFmbUpcbiIsCi0JCQkgZ3B1X3Bvd2VyX0ooJnBvd2VyLCAmc2FtcGxlWzBdLCAmc2FtcGxlWzFd
KSAqIDFlMyk7CisJCQkgcG93ZXJfSigmcmFwbCwgJnNhbXBsZVswXSwgJnNhbXBsZVsxXSkgKiAx
ZTMpOwogCX0KIAorCXJhcGxfY2xvc2UoJnJhcGwpOwogCWNsb3NlKGRlYnVnZnMpOwogfQogCi0t
IAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D1FFD8825F
	for <lists+intel-gfx@lfdr.de>; Fri,  9 Aug 2019 20:25:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A756F6EE72;
	Fri,  9 Aug 2019 18:25:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D734B6EE72
 for <intel-gfx@lists.freedesktop.org>; Fri,  9 Aug 2019 18:25:23 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17947103-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 09 Aug 2019 19:25:20 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  9 Aug 2019 19:25:18 +0100
Message-Id: <20190809182518.20486-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190809182518.20486-1-chris@chris-wilson.co.uk>
References: <20190809182518.20486-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 4/4] drm/i915: Lift timeline into intel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW92ZSB0aGUgdGltZWxpbmUgZnJvbSBiZWluZyBpbnNpZGUgdGhlIGludGVsX3JpbmcgdG8gaW50
ZWxfY29udGV4dAppdHNlbGYuIFRoaXMgc2F2ZXMgbXVjaCBwb2ludGVyIGRhbmNpbmcgYW5kIG1h
a2VzIHRoZSByZWxhdGlvbnMgb2YgdGhlCmNvbnRleHQgdG8gaXRzIHRpbWVsaW5lIG11Y2ggY2xl
YXJlci4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgpSZXZpZXdlZC1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8IDM1ICsr
KysrKysrLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAg
fCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAgIHwg
MjEgKysrKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oICAgICAg
IHwgIDggKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5cGVzLmgg
fCAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaCAgICAgICAgfCAg
NCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgIDEg
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggIHwgIDggKyst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAzMyArKysr
LS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCA2
MyArKysrKysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2lu
ZS5jICAgICAgICAgfCA2MiArKysrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZXF1ZXN0LmMgICAgICAgICAgIHwgMTAgKy0tCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2dlbV9ldmljdC5jICAgfCAxOSArKystLS0KIDE1IGZpbGVzIGNoYW5nZWQsIDE0MCBp
bnNlcnRpb25zKCspLCAxMzUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggNjI4ZDY5YTRkMzY4Li41ZGJkODk4OWE0MjQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtNDg5LDYg
KzQ4OSwyOSBAQCBzdGF0aWMgdm9pZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4LAogCQlpOTE1X3ZtX3B1dCh2bSk7CiB9CiAKK3N0YXRpYyB2b2lkIF9fc2V0X3Rp
bWVsaW5lKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqKmRzdCwKKwkJCSAgIHN0cnVjdCBpbnRlbF90
aW1lbGluZSAqc3JjKQoreworCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqb2xkID0gKmRzdDsKKwor
CSpkc3QgPSBzcmMgPyBpbnRlbF90aW1lbGluZV9nZXQoc3JjKSA6IE5VTEw7CisKKwlpZiAob2xk
KQorCQlpbnRlbF90aW1lbGluZV9wdXQob2xkKTsKK30KKworc3RhdGljIHZvaWQgX19hcHBseV90
aW1lbGluZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHZvaWQgKnRpbWVsaW5lKQoreworCV9f
c2V0X3RpbWVsaW5lKCZjZS0+dGltZWxpbmUsIHRpbWVsaW5lKTsKK30KKworc3RhdGljIHZvaWQg
X19hc3NpZ25fdGltZWxpbmUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKKwkJCSAgICAg
IHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUpCit7CisJX19zZXRfdGltZWxpbmUoJmN0
eC0+dGltZWxpbmUsIHRpbWVsaW5lKTsKKwljb250ZXh0X2FwcGx5X2FsbChjdHgsIF9fYXBwbHlf
dGltZWxpbmUsIHRpbWVsaW5lKTsKK30KKwogc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICoKIGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgdW5zaWduZWQgaW50IGZsYWdzKQogewpAQCAtNTMxLDcgKzU1NCw4IEBAIGk5MTVfZ2Vt
X2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdW5zaWdu
ZWQgaW50IGZsYWdzKQogCQkJcmV0dXJuIEVSUl9DQVNUKHRpbWVsaW5lKTsKIAkJfQogCi0JCWN0
eC0+dGltZWxpbmUgPSB0aW1lbGluZTsKKwkJX19hc3NpZ25fdGltZWxpbmUoY3R4LCB0aW1lbGlu
ZSk7CisJCWludGVsX3RpbWVsaW5lX3B1dCh0aW1lbGluZSk7CiAJfQogCiAJdHJhY2VfaTkxNV9j
b250ZXh0X2NyZWF0ZShjdHgpOwpAQCAtMTkzMSwxMyArMTk1NSw4IEBAIHN0YXRpYyBpbnQgY2xv
bmVfc3NldShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogc3RhdGljIGludCBjbG9uZV90
aW1lbGluZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCQkJICBzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqc3JjKQogewotCWlmIChzcmMtPnRpbWVsaW5lKSB7Ci0JCUdFTV9CVUdfT04o
c3JjLT50aW1lbGluZSA9PSBkc3QtPnRpbWVsaW5lKTsKLQotCQlpZiAoZHN0LT50aW1lbGluZSkK
LQkJCWludGVsX3RpbWVsaW5lX3B1dChkc3QtPnRpbWVsaW5lKTsKLQkJZHN0LT50aW1lbGluZSA9
IGludGVsX3RpbWVsaW5lX2dldChzcmMtPnRpbWVsaW5lKTsKLQl9CisJaWYgKHNyYy0+dGltZWxp
bmUpCisJCV9fYXNzaWduX3RpbWVsaW5lKGRzdCwgc3JjLT50aW1lbGluZSk7CiAKIAlyZXR1cm4g
MDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVj
YnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5j
CmluZGV4IDJmYTA4MzU3OTQ0ZS4uMWJkMjE4N2FjOGQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTIxODIsNyArMjE4Miw3IEBAIHN0
YXRpYyBpbnQgZWJfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSkKIHN0YXRpYyB2b2lkIGViX3VucGluX2NvbnRleHQoc3RydWN0
IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gZWIt
PmNvbnRleHQ7Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNlLT5yaW5nLT50aW1lbGlu
ZTsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsID0gY2UtPnRpbWVsaW5lOwogCiAJbXV0ZXhf
bG9jaygmdGwtPm11dGV4KTsKIAlpbnRlbF9jb250ZXh0X2V4aXQoY2UpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IDZkMWQ0ZThkYmZjOS4uNzc4MzNmMTU1OGE5
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC02OCw3ICs2OCw3
IEBAIGludCBfX2ludGVsX2NvbnRleHRfZG9fcGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
IAkJCWdvdG8gZXJyOwogCiAJCUdFTV9UUkFDRSgiJXMgY29udGV4dDolbGx4IHBpbiByaW5nOnto
ZWFkOiUwNHgsIHRhaWw6JTA0eH1cbiIsCi0JCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT5yaW5n
LT50aW1lbGluZS0+ZmVuY2VfY29udGV4dCwKKwkJCSAgY2UtPmVuZ2luZS0+bmFtZSwgY2UtPnRp
bWVsaW5lLT5mZW5jZV9jb250ZXh0LAogCQkJICBjZS0+cmluZy0+aGVhZCwgY2UtPnJpbmctPnRh
aWwpOwogCiAJCWk5MTVfZ2VtX2NvbnRleHRfZ2V0KGNlLT5nZW1fY29udGV4dCk7IC8qIGZvciBj
dHgtPnBwZ3R0ICovCkBAIC05OCw3ICs5OCw3IEBAIHZvaWQgaW50ZWxfY29udGV4dF91bnBpbihz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIAlpZiAobGlrZWx5KGF0b21pY19kZWNfYW5kX3Rl
c3QoJmNlLT5waW5fY291bnQpKSkgewogCQlHRU1fVFJBQ0UoIiVzIGNvbnRleHQ6JWxseCByZXRp
cmVcbiIsCi0JCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT5yaW5nLT50aW1lbGluZS0+ZmVuY2Vf
Y29udGV4dCk7CisJCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT50aW1lbGluZS0+ZmVuY2VfY29u
dGV4dCk7CiAKIAkJY2UtPm9wcy0+dW5waW4oY2UpOwogCkBAIC0xNDMsMTEgKzE0MywxMiBAQCBz
dGF0aWMgdm9pZCBfX2ludGVsX2NvbnRleHRfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqYWN0
aXZlKQogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGNvbnRhaW5lcl9vZihhY3RpdmUsIHR5
cGVvZigqY2UpLCBhY3RpdmUpOwogCiAJR0VNX1RSQUNFKCIlcyBjb250ZXh0OiVsbHggcmV0aXJl
XG4iLAotCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29u
dGV4dCk7CisJCSAgY2UtPmVuZ2luZS0+bmFtZSwgY2UtPnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0
KTsKIAogCWlmIChjZS0+c3RhdGUpCiAJCV9fY29udGV4dF91bnBpbl9zdGF0ZShjZS0+c3RhdGUp
OwogCisJaW50ZWxfdGltZWxpbmVfdW5waW4oY2UtPnRpbWVsaW5lKTsKIAlpbnRlbF9yaW5nX3Vu
cGluKGNlLT5yaW5nKTsKIAlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiB9CkBAIC0xNjMsMTUgKzE2
NCwyMSBAQCBzdGF0aWMgaW50IF9faW50ZWxfY29udGV4dF9hY3RpdmUoc3RydWN0IGk5MTVfYWN0
aXZlICphY3RpdmUpCiAJaWYgKGVycikKIAkJZ290byBlcnJfcHV0OwogCisJZXJyID0gaW50ZWxf
dGltZWxpbmVfcGluKGNlLT50aW1lbGluZSk7CisJaWYgKGVycikKKwkJZ290byBlcnJfcmluZzsK
KwogCWlmICghY2UtPnN0YXRlKQogCQlyZXR1cm4gMDsKIAogCWVyciA9IF9fY29udGV4dF9waW5f
c3RhdGUoY2UtPnN0YXRlKTsKIAlpZiAoZXJyKQotCQlnb3RvIGVycl9yaW5nOworCQlnb3RvIGVy
cl90aW1lbGluZTsKIAogCXJldHVybiAwOwogCitlcnJfdGltZWxpbmU6CisJaW50ZWxfdGltZWxp
bmVfdW5waW4oY2UtPnRpbWVsaW5lKTsKIGVycl9yaW5nOgogCWludGVsX3JpbmdfdW5waW4oY2Ut
PnJpbmcpOwogZXJyX3B1dDoKQEAgLTIxOCw2ICsyMjUsOCBAQCBpbnRlbF9jb250ZXh0X2luaXQo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAJY2UtPmdlbV9jb250ZXh0ID0gY3R4OwogCWNl
LT52bSA9IGk5MTVfdm1fZ2V0KGN0eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZtKTsKKwlp
ZiAoY3R4LT50aW1lbGluZSkKKwkJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfZ2V0KGN0
eC0+dGltZWxpbmUpOwogCiAJY2UtPmVuZ2luZSA9IGVuZ2luZTsKIAljZS0+b3BzID0gZW5naW5l
LT5jb3BzOwpAQCAtMjM1LDYgKzI0NCw4IEBAIGludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UsCiAKIHZvaWQgaW50ZWxfY29udGV4dF9maW5pKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSkKIHsKKwlpZiAoY2UtPnRpbWVsaW5lKQorCQlpbnRlbF90aW1lbGluZV9wdXQo
Y2UtPnRpbWVsaW5lKTsKIAlpOTE1X3ZtX3B1dChjZS0+dm0pOwogCiAJbXV0ZXhfZGVzdHJveSgm
Y2UtPnBpbl9tdXRleCk7CkBAIC0yNzksNyArMjkwLDcgQEAgdm9pZCBpbnRlbF9jb250ZXh0X2V4
aXRfZW5naW5lKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIGludCBpbnRlbF9jb250ZXh0X3By
ZXBhcmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJCQkgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNl
LT5yaW5nLT50aW1lbGluZTsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsID0gY2UtPnRpbWVs
aW5lOwogCWludCBlcnI7CiAKIAkvKiBPbmx5IHN1aXRhYmxlIGZvciB1c2UgaW4gcmVtb3RlbHkg
bW9kaWZ5aW5nIHRoaXMgY29udGV4dCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29u
dGV4dC5oCmluZGV4IDEzZjI4ZGQzMTZiYy4uOWZhOGI1ODhmMThlIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCkBAIC0xMjAsMTUgKzEyMCwxNSBAQCBzdGF0aWMgaW5s
aW5lIHZvaWQgaW50ZWxfY29udGV4dF9wdXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCiBz
dGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKIGludGVsX2NvbnRleHRfdGltZWxpbmVfbG9j
ayhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCi0JX19hY3F1aXJlcygmY2UtPnJpbmctPnRpbWVs
aW5lLT5tdXRleCkKKwlfX2FjcXVpcmVzKCZjZS0+dGltZWxpbmUtPm11dGV4KQogewotCXJldHVy
biBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmNlLT5yaW5nLT50aW1lbGluZS0+bXV0ZXgpOwor
CXJldHVybiBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmNlLT50aW1lbGluZS0+bXV0ZXgpOwog
fQogCiBzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfY29udGV4dF90aW1lbGluZV91bmxvY2soc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlKQotCV9fcmVsZWFzZXMoJmNlLT5yaW5nLT50aW1lbGluZS0+
bXV0ZXgpCisJX19yZWxlYXNlcygmY2UtPnRpbWVsaW5lLT5tdXRleCkKIHsKLQltdXRleF91bmxv
Y2soJmNlLT5yaW5nLT50aW1lbGluZS0+bXV0ZXgpOworCW11dGV4X3VubG9jaygmY2UtPnRpbWVs
aW5lLT5tdXRleCk7CiB9CiAKIGludCBpbnRlbF9jb250ZXh0X3ByZXBhcmVfcmVtb3RlX3JlcXVl
c3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfY29udGV4dF90eXBlcy5oCmluZGV4IGNmZjYyMzhjMjEzYS4uYTYzMmIyMGVjNGQ4IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5cGVzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oCkBAIC01
Myw2ICs1Myw3IEBAIHN0cnVjdCBpbnRlbF9jb250ZXh0IHsKIAogCXN0cnVjdCBpOTE1X3ZtYSAq
c3RhdGU7CiAJc3RydWN0IGludGVsX3JpbmcgKnJpbmc7CisJc3RydWN0IGludGVsX3RpbWVsaW5l
ICp0aW1lbGluZTsKIAogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAjZGVmaW5lIENPTlRFWFRfQUxM
T0NfQklUIDAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKaW5kZXggMzdjMzkx
Y2VlNDQxLi5lMTIyOGIwZTU3N2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZS5oCkBAIC0xOTYsOSArMTk2LDcgQEAgaW50ZWxfd3JpdGVfc3RhdHVzX3BhZ2Uoc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQgcmVnLCB1MzIgdmFsdWUpCiAjZGVmaW5lIENOTF9I
V1NfQ1NCX1dSSVRFX0lOREVYCQkweDJmCiAKIHN0cnVjdCBpbnRlbF9yaW5nICoKLWludGVsX2Vu
Z2luZV9jcmVhdGVfcmluZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCQkgc3Ry
dWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSwKLQkJCSBpbnQgc2l6ZSk7CitpbnRlbF9lbmdp
bmVfY3JlYXRlX3Jpbmcoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQgc2l6ZSk7
CiBpbnQgaW50ZWxfcmluZ19waW4oc3RydWN0IGludGVsX3JpbmcgKnJpbmcpOwogdm9pZCBpbnRl
bF9yaW5nX3Jlc2V0KHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nLCB1MzIgdGFpbCk7CiB1bnNpZ25l
ZCBpbnQgaW50ZWxfcmluZ191cGRhdGVfc3BhY2Uoc3RydWN0IGludGVsX3JpbmcgKnJpbmcpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCBlY2U3MzFhYjdi
M2EuLjdkMTc0YWYzMGY4YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X2NzLmMKQEAgLTY4MCw3ICs2ODAsNiBAQCBzdGF0aWMgaW50IG1lYXN1cmVfYnJlYWRjcnVtYl9k
dyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCWdvdG8gb3V0X2ZyYW1lOwogCiAJ
SU5JVF9MSVNUX0hFQUQoJmZyYW1lLT5yaW5nLnJlcXVlc3RfbGlzdCk7Ci0JZnJhbWUtPnJpbmcu
dGltZWxpbmUgPSAmZnJhbWUtPnRpbWVsaW5lOwogCWZyYW1lLT5yaW5nLnZhZGRyID0gZnJhbWUt
PmNzOwogCWZyYW1lLT5yaW5nLnNpemUgPSBzaXplb2YoZnJhbWUtPmNzKTsKIAlmcmFtZS0+cmlu
Zy5lZmZlY3RpdmVfc2l6ZSA9IGZyYW1lLT5yaW5nLnNpemU7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCmluZGV4IGM3OWZkMWRhZmE4OC4uYTBmMzcyODA3
ZGQ0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlw
ZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaApA
QCAtNjksNyArNjksNiBAQCBzdHJ1Y3QgaW50ZWxfcmluZyB7CiAJc3RydWN0IGk5MTVfdm1hICp2
bWE7CiAJdm9pZCAqdmFkZHI7CiAKLQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lOwog
CXN0cnVjdCBsaXN0X2hlYWQgcmVxdWVzdF9saXN0OwogCXN0cnVjdCBsaXN0X2hlYWQgYWN0aXZl
X2xpbms7CiAKQEAgLTI4Niw4ICsyODUsNiBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAog
CXN0cnVjdCBpbnRlbF9zc2V1IHNzZXU7CiAKLQlzdHJ1Y3QgaW50ZWxfcmluZyAqYnVmZmVyOwot
CiAJc3RydWN0IHsKIAkJc3BpbmxvY2tfdCBsb2NrOwogCQlzdHJ1Y3QgbGlzdF9oZWFkIHJlcXVl
c3RzOwpAQCAtMzA2LDYgKzMwMywxMSBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqZGVmYXVsdF9zdGF0ZTsKIAl2b2lkICpwaW5uZWRfZGVm
YXVsdF9zdGF0ZTsKIAorCXN0cnVjdCB7CisJCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nOworCQlz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lOworCX0gbGVnYWN5OworCiAJLyogUmF0aGVy
IHRoYW4gaGF2ZSBldmVyeSBjbGllbnQgd2FpdCB1cG9uIGFsbCB1c2VyIGludGVycnVwdHMsCiAJ
ICogd2l0aCB0aGUgaGVyZCB3YWtpbmcgYWZ0ZXIgZXZlcnkgaW50ZXJydXB0IGFuZCBlYWNoIGRv
aW5nIHRoZQogCSAqIGhlYXZ5d2VpZ2h0IHNlcW5vIGRhbmNlLCB3ZSBkZWxlZ2F0ZSB0aGUgdGFz
ayAob2YgYmVpbmcgdGhlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGZjNWZj
YzJkMDNhYy4uYmI3NDk1NDg4OWRkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpA
QCAtMjgyMSw5ICsyODIxLDYgQEAgbG9naWNhbF9yaW5nX2RlZmF1bHRfaXJxcyhzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIGludCBpbnRlbF9leGVjbGlzdHNfc3VibWlzc2lvbl9z
ZXR1cChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0JLyogSW50ZW50aW9uYWxs
eSBsZWZ0IGJsYW5rLiAqLwotCWVuZ2luZS0+YnVmZmVyID0gTlVMTDsKLQogCXRhc2tsZXRfaW5p
dCgmZW5naW5lLT5leGVjbGlzdHMudGFza2xldCwKIAkJICAgICBleGVjbGlzdHNfc3VibWlzc2lv
bl90YXNrbGV0LCAodW5zaWduZWQgbG9uZyllbmdpbmUpOwogCXRpbWVyX3NldHVwKCZlbmdpbmUt
PmV4ZWNsaXN0cy50aW1lciwgZXhlY2xpc3RzX3N1Ym1pc3Npb25fdGltZXIsIDApOwpAQCAtMzA3
MSwyMyArMzA2OCwxMyBAQCBwb3B1bGF0ZV9scl9jb250ZXh0KHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSwKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgc3RydWN0IGludGVsX3RpbWVsaW5lICoK
LWdldF90aW1lbGluZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQotewotCWlmIChjdHgtPnRpbWVsaW5lKQotCQlyZXR1cm4gaW50ZWxfdGltZWxpbmVf
Z2V0KGN0eC0+dGltZWxpbmUpOwotCWVsc2UKLQkJcmV0dXJuIGludGVsX3RpbWVsaW5lX2NyZWF0
ZShndCwgTlVMTCk7Ci19Ci0KIHN0YXRpYyBpbnQgX19leGVjbGlzdHNfY29udGV4dF9hbGxvYyhz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkJICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmN0eF9vYmo7CisJc3Ry
dWN0IGludGVsX3JpbmcgKnJpbmc7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMyIGNvbnRl
eHRfc2l6ZTsKLQlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZzsKLQlzdHJ1Y3QgaW50ZWxfdGltZWxp
bmUgKnRpbWVsaW5lOwogCWludCByZXQ7CiAKIAlHRU1fQlVHX09OKGNlLT5zdGF0ZSk7CkBAIC0z
MTA5LDE1ICszMDk2LDE5IEBAIHN0YXRpYyBpbnQgX19leGVjbGlzdHNfY29udGV4dF9hbGxvYyhz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCWdvdG8gZXJyb3JfZGVyZWZfb2JqOwogCX0KIAot
CXRpbWVsaW5lID0gZ2V0X3RpbWVsaW5lKGNlLT5nZW1fY29udGV4dCwgZW5naW5lLT5ndCk7Ci0J
aWYgKElTX0VSUih0aW1lbGluZSkpIHsKLQkJcmV0ID0gUFRSX0VSUih0aW1lbGluZSk7Ci0JCWdv
dG8gZXJyb3JfZGVyZWZfb2JqOworCWlmICghY2UtPnRpbWVsaW5lKSB7CisJCXN0cnVjdCBpbnRl
bF90aW1lbGluZSAqdGw7CisKKwkJdGwgPSBpbnRlbF90aW1lbGluZV9jcmVhdGUoZW5naW5lLT5n
dCwgTlVMTCk7CisJCWlmIChJU19FUlIodGwpKSB7CisJCQlyZXQgPSBQVFJfRVJSKHRsKTsKKwkJ
CWdvdG8gZXJyb3JfZGVyZWZfb2JqOworCQl9CisKKwkJY2UtPnRpbWVsaW5lID0gdGw7CiAJfQog
Ci0JcmluZyA9IGludGVsX2VuZ2luZV9jcmVhdGVfcmluZyhlbmdpbmUsIHRpbWVsaW5lLAotCQkJ
CQkodW5zaWduZWQgbG9uZyljZS0+cmluZyk7Ci0JaW50ZWxfdGltZWxpbmVfcHV0KHRpbWVsaW5l
KTsKKwlyaW5nID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKGVuZ2luZSwgKHVuc2lnbmVkIGxv
bmcpY2UtPnJpbmcpOwogCWlmIChJU19FUlIocmluZykpIHsKIAkJcmV0ID0gUFRSX0VSUihyaW5n
KTsKIAkJZ290byBlcnJvcl9kZXJlZl9vYmo7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yaW5nYnVmZmVyLmMKaW5kZXggZDViN2U0ZGRlNzYyLi5kZmFjYjI2NWE5OTUgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKQEAgLTYzNiw3ICs2MzYsNyBA
QCBzdGF0aWMgYm9vbCBzdG9wX3Jpbmcoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
c3RhdGljIGludCB4Y3NfcmVzdW1lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBlbmdpbmUtPmk5MTU7Ci0Jc3Ry
dWN0IGludGVsX3JpbmcgKnJpbmcgPSBlbmdpbmUtPmJ1ZmZlcjsKKwlzdHJ1Y3QgaW50ZWxfcmlu
ZyAqcmluZyA9IGVuZ2luZS0+bGVnYWN5LnJpbmc7CiAJaW50IHJldCA9IDA7CiAKIAlHRU1fVFJB
Q0UoIiVzOiByaW5nOntIRUFEOiUwNHgsIFRBSUw6JTA0eH1cbiIsCkBAIC04MzIsMTIgKzgzMiwx
MiBAQCBzdGF0aWMgdm9pZCByZXNldF9yaW5nKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSwgYm9vbCBzdGFsbGVkKQogCQkgKi8KIAkJX19pOTE1X3JlcXVlc3RfcmVzZXQocnEsIHN0YWxs
ZWQpOwogCi0JCUdFTV9CVUdfT04ocnEtPnJpbmcgIT0gZW5naW5lLT5idWZmZXIpOworCQlHRU1f
QlVHX09OKHJxLT5yaW5nICE9IGVuZ2luZS0+bGVnYWN5LnJpbmcpOwogCQloZWFkID0gcnEtPmhl
YWQ7CiAJfSBlbHNlIHsKLQkJaGVhZCA9IGVuZ2luZS0+YnVmZmVyLT50YWlsOworCQloZWFkID0g
ZW5naW5lLT5sZWdhY3kucmluZy0+dGFpbDsKIAl9Ci0JZW5naW5lLT5idWZmZXItPmhlYWQgPSBp
bnRlbF9yaW5nX3dyYXAoZW5naW5lLT5idWZmZXIsIGhlYWQpOworCWVuZ2luZS0+bGVnYWN5LnJp
bmctPmhlYWQgPSBpbnRlbF9yaW5nX3dyYXAoZW5naW5lLT5sZWdhY3kucmluZywgaGVhZCk7CiAK
IAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CiB9
CkBAIC0xMTkyLDEwICsxMTkyLDYgQEAgaW50IGludGVsX3JpbmdfcGluKHN0cnVjdCBpbnRlbF9y
aW5nICpyaW5nKQogCWlmIChhdG9taWNfZmV0Y2hfaW5jKCZyaW5nLT5waW5fY291bnQpKQogCQly
ZXR1cm4gMDsKIAotCXJldCA9IGludGVsX3RpbWVsaW5lX3BpbihyaW5nLT50aW1lbGluZSk7Ci0J
aWYgKHJldCkKLQkJZ290byBlcnJfdW5waW47Ci0KIAlmbGFncyA9IFBJTl9HTE9CQUw7CiAKIAkv
KiBSaW5nIHdyYXBhcm91bmQgYXQgb2Zmc2V0IDAgc29tZXRpbWVzIGhhbmdzLiBObyBpZGVhIHdo
eS4gKi8KQEAgLTEyMDgsNyArMTIwNCw3IEBAIGludCBpbnRlbF9yaW5nX3BpbihzdHJ1Y3QgaW50
ZWxfcmluZyAqcmluZykKIAogCXJldCA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIGZsYWdzKTsK
IAlpZiAodW5saWtlbHkocmV0KSkKLQkJZ290byBlcnJfdGltZWxpbmU7CisJCWdvdG8gZXJyX3Vu
cGluOwogCiAJaWYgKGk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpCiAJCWFkZHIg
PSAodm9pZCBfX2ZvcmNlICopaTkxNV92bWFfcGluX2lvbWFwKHZtYSk7CkBAIC0xMjI1LDEzICsx
MjIxLDEwIEBAIGludCBpbnRlbF9yaW5nX3BpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAlH
RU1fQlVHX09OKHJpbmctPnZhZGRyKTsKIAlyaW5nLT52YWRkciA9IGFkZHI7CiAKLQlHRU1fVFJB
Q0UoInJpbmc6JWxseCBwaW5cbiIsIHJpbmctPnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0KTsKIAly
ZXR1cm4gMDsKIAogZXJyX3Jpbmc6CiAJaTkxNV92bWFfdW5waW4odm1hKTsKLWVycl90aW1lbGlu
ZToKLQlpbnRlbF90aW1lbGluZV91bnBpbihyaW5nLT50aW1lbGluZSk7CiBlcnJfdW5waW46CiAJ
YXRvbWljX2RlYygmcmluZy0+cGluX2NvdW50KTsKIAlyZXR1cm4gcmV0OwpAQCAtMTI1NCw4ICsx
MjQ3LDYgQEAgdm9pZCBpbnRlbF9yaW5nX3VucGluKHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKQog
CWlmICghYXRvbWljX2RlY19hbmRfdGVzdCgmcmluZy0+cGluX2NvdW50KSkKIAkJcmV0dXJuOwog
Ci0JR0VNX1RSQUNFKCJyaW5nOiVsbHggdW5waW5cbiIsIHJpbmctPnRpbWVsaW5lLT5mZW5jZV9j
b250ZXh0KTsKLQogCS8qIERpc2NhcmQgYW55IHVudXNlZCBieXRlcyBiZXlvbmQgdGhhdCBzdWJt
aXR0ZWQgdG8gaHcuICovCiAJaW50ZWxfcmluZ19yZXNldChyaW5nLCByaW5nLT50YWlsKTsKIApA
QCAtMTI3MCw4ICsxMjYxLDYgQEAgdm9pZCBpbnRlbF9yaW5nX3VucGluKHN0cnVjdCBpbnRlbF9y
aW5nICpyaW5nKQogCiAJaTkxNV92bWFfdW5waW4odm1hKTsKIAlpOTE1X3ZtYV9tYWtlX3B1cmdl
YWJsZSh2bWEpOwotCi0JaW50ZWxfdGltZWxpbmVfdW5waW4ocmluZy0+dGltZWxpbmUpOwogfQog
CiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfcmluZ192bWEoc3RydWN0IGk5MTVfZ2d0
dCAqZ2d0dCwgaW50IHNpemUpCkBAIC0xMzA2LDkgKzEyOTUsNyBAQCBzdGF0aWMgc3RydWN0IGk5
MTVfdm1hICpjcmVhdGVfcmluZ192bWEoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwgaW50IHNpemUp
CiB9CiAKIHN0cnVjdCBpbnRlbF9yaW5nICoKLWludGVsX2VuZ2luZV9jcmVhdGVfcmluZyhzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCQkgc3RydWN0IGludGVsX3RpbWVsaW5lICp0
aW1lbGluZSwKLQkJCSBpbnQgc2l6ZSkKK2ludGVsX2VuZ2luZV9jcmVhdGVfcmluZyhzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGludCBzaXplKQogewogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gZW5naW5lLT5pOTE1OwogCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nOwpA
QCAtMTMyMyw3ICsxMzEwLDYgQEAgaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSwKIAogCWtyZWZfaW5pdCgmcmluZy0+cmVmKTsKIAlJTklUX0xJ
U1RfSEVBRCgmcmluZy0+cmVxdWVzdF9saXN0KTsKLQlyaW5nLT50aW1lbGluZSA9IGludGVsX3Rp
bWVsaW5lX2dldCh0aW1lbGluZSk7CiAKIAlyaW5nLT5zaXplID0gc2l6ZTsKIAkvKiBXb3JrYXJv
dW5kIGFuIGVycmF0dW0gb24gdGhlIGk4MzAgd2hpY2ggY2F1c2VzIGEgaGFuZyBpZgpAQCAtMTM1
Myw3ICsxMzM5LDYgQEAgdm9pZCBpbnRlbF9yaW5nX2ZyZWUoc3RydWN0IGtyZWYgKnJlZikKIAlp
OTE1X3ZtYV9jbG9zZShyaW5nLT52bWEpOwogCWk5MTVfdm1hX3B1dChyaW5nLT52bWEpOwogCi0J
aW50ZWxfdGltZWxpbmVfcHV0KHJpbmctPnRpbWVsaW5lKTsKIAlrZnJlZShyaW5nKTsKIH0KIApA
QCAtMTQ4NSw4ICsxNDcwLDkgQEAgc3RhdGljIGludCByaW5nX2NvbnRleHRfYWxsb2Moc3RydWN0
IGludGVsX2NvbnRleHQgKmNlKQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IGNl
LT5lbmdpbmU7CiAKIAkvKiBPbmUgcmluZ2J1ZmZlciB0byBydWxlIHRoZW0gYWxsICovCi0JR0VN
X0JVR19PTighZW5naW5lLT5idWZmZXIpOwotCWNlLT5yaW5nID0gZW5naW5lLT5idWZmZXI7CisJ
R0VNX0JVR19PTighZW5naW5lLT5sZWdhY3kucmluZyk7CisJY2UtPnJpbmcgPSBlbmdpbmUtPmxl
Z2FjeS5yaW5nOworCWNlLT50aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2dldChlbmdpbmUtPmxl
Z2FjeS50aW1lbGluZSk7CiAKIAlHRU1fQlVHX09OKGNlLT5zdGF0ZSk7CiAJaWYgKGVuZ2luZS0+
Y29udGV4dF9zaXplKSB7CkBAIC0yMTY1LDggKzIxNTEsMTEgQEAgc3RhdGljIHZvaWQgcmluZ19k
ZXN0cm95KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCWludGVsX2VuZ2luZV9j
bGVhbnVwX2NvbW1vbihlbmdpbmUpOwogCi0JaW50ZWxfcmluZ191bnBpbihlbmdpbmUtPmJ1ZmZl
cik7Ci0JaW50ZWxfcmluZ19wdXQoZW5naW5lLT5idWZmZXIpOworCWludGVsX3JpbmdfdW5waW4o
ZW5naW5lLT5sZWdhY3kucmluZyk7CisJaW50ZWxfcmluZ19wdXQoZW5naW5lLT5sZWdhY3kucmlu
Zyk7CisKKwlpbnRlbF90aW1lbGluZV91bnBpbihlbmdpbmUtPmxlZ2FjeS50aW1lbGluZSk7CisJ
aW50ZWxfdGltZWxpbmVfcHV0KGVuZ2luZS0+bGVnYWN5LnRpbWVsaW5lKTsKIAogCWtmcmVlKGVu
Z2luZSk7CiB9CkBAIC0yMzUwLDMyICsyMzM5LDQwIEBAIGludCBpbnRlbF9yaW5nX3N1Ym1pc3Np
b25faW5pdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJfQogCUdFTV9CVUdfT04o
dGltZWxpbmUtPmhhc19pbml0aWFsX2JyZWFkY3J1bWIpOwogCi0JcmluZyA9IGludGVsX2VuZ2lu
ZV9jcmVhdGVfcmluZyhlbmdpbmUsIHRpbWVsaW5lLCBTWl8xNkspOwotCWludGVsX3RpbWVsaW5l
X3B1dCh0aW1lbGluZSk7CisJZXJyID0gaW50ZWxfdGltZWxpbmVfcGluKHRpbWVsaW5lKTsKKwlp
ZiAoZXJyKQorCQlnb3RvIGVycl90aW1lbGluZTsKKworCXJpbmcgPSBpbnRlbF9lbmdpbmVfY3Jl
YXRlX3JpbmcoZW5naW5lLCBTWl8xNkspOwogCWlmIChJU19FUlIocmluZykpIHsKIAkJZXJyID0g
UFRSX0VSUihyaW5nKTsKLQkJZ290byBlcnI7CisJCWdvdG8gZXJyX3RpbWVsaW5lX3VucGluOwog
CX0KIAogCWVyciA9IGludGVsX3JpbmdfcGluKHJpbmcpOwogCWlmIChlcnIpCiAJCWdvdG8gZXJy
X3Jpbmc7CiAKLQlHRU1fQlVHX09OKGVuZ2luZS0+YnVmZmVyKTsKLQllbmdpbmUtPmJ1ZmZlciA9
IHJpbmc7CisJR0VNX0JVR19PTihlbmdpbmUtPmxlZ2FjeS5yaW5nKTsKKwllbmdpbmUtPmxlZ2Fj
eS5yaW5nID0gcmluZzsKKwllbmdpbmUtPmxlZ2FjeS50aW1lbGluZSA9IHRpbWVsaW5lOwogCiAJ
ZXJyID0gaW50ZWxfZW5naW5lX2luaXRfY29tbW9uKGVuZ2luZSk7CiAJaWYgKGVycikKLQkJZ290
byBlcnJfdW5waW47CisJCWdvdG8gZXJyX3JpbmdfdW5waW47CiAKLQlHRU1fQlVHX09OKHJpbmct
PnRpbWVsaW5lLT5od3NwX2dndHQgIT0gZW5naW5lLT5zdGF0dXNfcGFnZS52bWEpOworCUdFTV9C
VUdfT04odGltZWxpbmUtPmh3c3BfZ2d0dCAhPSBlbmdpbmUtPnN0YXR1c19wYWdlLnZtYSk7CiAK
IAlyZXR1cm4gMDsKIAotZXJyX3VucGluOgorZXJyX3JpbmdfdW5waW46CiAJaW50ZWxfcmluZ191
bnBpbihyaW5nKTsKIGVycl9yaW5nOgogCWludGVsX3JpbmdfcHV0KHJpbmcpOworZXJyX3RpbWVs
aW5lX3VucGluOgorCWludGVsX3RpbWVsaW5lX3VucGluKHRpbWVsaW5lKTsKK2Vycl90aW1lbGlu
ZToKKwlpbnRlbF90aW1lbGluZV9wdXQodGltZWxpbmUpOwogZXJyOgogCWludGVsX2VuZ2luZV9j
bGVhbnVwX2NvbW1vbihlbmdpbmUpOwogCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
bW9ja19lbmdpbmUuYwppbmRleCA3OWJhZWQxYWFmMzguLmE2M2RkOGE0MmNkNCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCkBAIC0zMiwxMSArMzIsNiBAQAogI2luY2x1ZGUg
Im1vY2tfZW5naW5lLmgiCiAjaW5jbHVkZSAic2VsZnRlc3RzL21vY2tfcmVxdWVzdC5oIgogCi1z
dHJ1Y3QgbW9ja19yaW5nIHsKLQlzdHJ1Y3QgaW50ZWxfcmluZyBiYXNlOwotCXN0cnVjdCBpbnRl
bF90aW1lbGluZSB0aW1lbGluZTsKLX07Ci0KIHN0YXRpYyB2b2lkIG1vY2tfdGltZWxpbmVfcGlu
KHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCiB7CiAJdGwtPnBpbl9jb3VudCsrOwpAQCAtNTEs
MzYgKzQ2LDIyIEBAIHN0YXRpYyB2b2lkIG1vY2tfdGltZWxpbmVfdW5waW4oc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bCkKIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfcmluZyAqbW9ja19yaW5nKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAljb25zdCB1bnNpZ25lZCBsb25nIHN6ID0g
UEFHRV9TSVpFIC8gMjsKLQlzdHJ1Y3QgbW9ja19yaW5nICpyaW5nOworCXN0cnVjdCBpbnRlbF9y
aW5nICpyaW5nOwogCiAJcmluZyA9IGt6YWxsb2Moc2l6ZW9mKCpyaW5nKSArIHN6LCBHRlBfS0VS
TkVMKTsKIAlpZiAoIXJpbmcpCiAJCXJldHVybiBOVUxMOwogCi0JaWYgKGludGVsX3RpbWVsaW5l
X2luaXQoJnJpbmctPnRpbWVsaW5lLCBlbmdpbmUtPmd0LCBOVUxMKSkgewotCQlrZnJlZShyaW5n
KTsKLQkJcmV0dXJuIE5VTEw7Ci0JfQotCi0Ja3JlZl9pbml0KCZyaW5nLT5iYXNlLnJlZik7Ci0J
cmluZy0+YmFzZS5zaXplID0gc3o7Ci0JcmluZy0+YmFzZS5lZmZlY3RpdmVfc2l6ZSA9IHN6Owot
CXJpbmctPmJhc2UudmFkZHIgPSAodm9pZCAqKShyaW5nICsgMSk7Ci0JcmluZy0+YmFzZS50aW1l
bGluZSA9ICZyaW5nLT50aW1lbGluZTsKLQlhdG9taWNfc2V0KCZyaW5nLT5iYXNlLnBpbl9jb3Vu
dCwgMSk7Ci0KLQlJTklUX0xJU1RfSEVBRCgmcmluZy0+YmFzZS5yZXF1ZXN0X2xpc3QpOwotCWlu
dGVsX3JpbmdfdXBkYXRlX3NwYWNlKCZyaW5nLT5iYXNlKTsKLQotCXJldHVybiAmcmluZy0+YmFz
ZTsKLX0KKwlrcmVmX2luaXQoJnJpbmctPnJlZik7CisJcmluZy0+c2l6ZSA9IHN6OworCXJpbmct
PmVmZmVjdGl2ZV9zaXplID0gc3o7CisJcmluZy0+dmFkZHIgPSAodm9pZCAqKShyaW5nICsgMSk7
CisJYXRvbWljX3NldCgmcmluZy0+cGluX2NvdW50LCAxKTsKIAotc3RhdGljIHZvaWQgbW9ja19y
aW5nX2ZyZWUoc3RydWN0IGludGVsX3JpbmcgKmJhc2UpCi17Ci0Jc3RydWN0IG1vY2tfcmluZyAq
cmluZyA9IGNvbnRhaW5lcl9vZihiYXNlLCB0eXBlb2YoKnJpbmcpLCBiYXNlKTsKKwlJTklUX0xJ
U1RfSEVBRCgmcmluZy0+cmVxdWVzdF9saXN0KTsKKwlpbnRlbF9yaW5nX3VwZGF0ZV9zcGFjZShy
aW5nKTsKIAotCWludGVsX3RpbWVsaW5lX2ZpbmkoJnJpbmctPnRpbWVsaW5lKTsKLQlrZnJlZShy
aW5nKTsKKwlyZXR1cm4gcmluZzsKIH0KIAogc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmZp
cnN0X3JlcXVlc3Qoc3RydWN0IG1vY2tfZW5naW5lICplbmdpbmUpCkBAIC0xMzEsNyArMTEyLDYg
QEAgc3RhdGljIHZvaWQgaHdfZGVsYXlfY29tcGxldGUoc3RydWN0IHRpbWVyX2xpc3QgKnQpCiAK
IHN0YXRpYyB2b2lkIG1vY2tfY29udGV4dF91bnBpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Up
CiB7Ci0JbW9ja190aW1lbGluZV91bnBpbihjZS0+cmluZy0+dGltZWxpbmUpOwogfQogCiBzdGF0
aWMgdm9pZCBtb2NrX2NvbnRleHRfZGVzdHJveShzdHJ1Y3Qga3JlZiAqcmVmKQpAQCAtMTQwLDgg
KzEyMCwxMCBAQCBzdGF0aWMgdm9pZCBtb2NrX2NvbnRleHRfZGVzdHJveShzdHJ1Y3Qga3JlZiAq
cmVmKQogCiAJR0VNX0JVR19PTihpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChjZSkpOwogCi0JaWYg
KHRlc3RfYml0KENPTlRFWFRfQUxMT0NfQklULCAmY2UtPmZsYWdzKSkKLQkJbW9ja19yaW5nX2Zy
ZWUoY2UtPnJpbmcpOworCWlmICh0ZXN0X2JpdChDT05URVhUX0FMTE9DX0JJVCwgJmNlLT5mbGFn
cykpIHsKKwkJa2ZyZWUoY2UtPnJpbmcpOworCQltb2NrX3RpbWVsaW5lX3VucGluKGNlLT50aW1l
bGluZSk7CisJfQogCiAJaW50ZWxfY29udGV4dF9maW5pKGNlKTsKIAlpbnRlbF9jb250ZXh0X2Zy
ZWUoY2UpOwpAQCAtMTUzLDE5ICsxMzUsMjEgQEAgc3RhdGljIGludCBtb2NrX2NvbnRleHRfYWxs
b2Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCWlmICghY2UtPnJpbmcpCiAJCXJldHVybiAt
RU5PTUVNOwogCisJR0VNX0JVR19PTihjZS0+dGltZWxpbmUpOworCWNlLT50aW1lbGluZSA9IGlu
dGVsX3RpbWVsaW5lX2NyZWF0ZShjZS0+ZW5naW5lLT5ndCwgTlVMTCk7CisJaWYgKElTX0VSUihj
ZS0+dGltZWxpbmUpKSB7CisJCWtmcmVlKGNlLT5lbmdpbmUpOworCQlyZXR1cm4gUFRSX0VSUihj
ZS0+dGltZWxpbmUpOworCX0KKworCW1vY2tfdGltZWxpbmVfcGluKGNlLT50aW1lbGluZSk7CisK
IAlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBtb2NrX2NvbnRleHRfcGluKHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSkKIHsKLQlpbnQgcmV0OwotCi0JcmV0ID0gaW50ZWxfY29udGV4dF9hY3Rp
dmVfYWNxdWlyZShjZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCW1vY2tfdGltZWxp
bmVfcGluKGNlLT5yaW5nLT50aW1lbGluZSk7Ci0JcmV0dXJuIDA7CisJcmV0dXJuIGludGVsX2Nv
bnRleHRfYWN0aXZlX2FjcXVpcmUoY2UpOwogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGludGVs
X2NvbnRleHRfb3BzIG1vY2tfY29udGV4dF9vcHMgPSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggNmU3ZTlhNmZkMjM1Li5kYTljNDllMmFkYWYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKQEAgLTMyLDcgKzMy
LDcgQEAgc3RhdGljIGludCByZXF1ZXN0X3N5bmMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAK
IHN0YXRpYyBpbnQgY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKLQlz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsID0gY2UtPnJpbmctPnRpbWVsaW5lOworCXN0cnVjdCBp
bnRlbF90aW1lbGluZSAqdGwgPSBjZS0+dGltZWxpbmU7CiAJaW50IGVyciA9IDA7CiAKIAlkbyB7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwppbmRleCAxZTA5NzIyYjUzMTcuLjc2OThmY2Fh
NjQ4YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0yNDYsNyArMjQ2LDcgQEAg
c3RhdGljIGJvb2wgX19hY3RpdmVfZGVsX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYs
CiAJc3RydWN0IGxsaXN0X25vZGUgKmhlYWQgPSBOVUxMLCAqdGFpbCA9IE5VTEw7CiAJc3RydWN0
IGxsaXN0X25vZGUgKnBvcywgKm5leHQ7CiAKLQlHRU1fQlVHX09OKG5vZGUtPnRpbWVsaW5lICE9
IGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnJpbmctPnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0KTsK
KwlHRU1fQlVHX09OKG5vZGUtPnRpbWVsaW5lICE9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnRp
bWVsaW5lLT5mZW5jZV9jb250ZXh0KTsKIAogCS8qCiAJICogUmVidWlsZCB0aGUgbGxpc3QgZXhj
bHVkaW5nIG91ciBub2RlLiBXZSBtYXkgcGVyZm9ybSB0aGlzCkBAIC01NjgsNyArNTY4LDcgQEAg
aW50IGk5MTVfYWN0aXZlX2FjcXVpcmVfcHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZiwKIAkgKiBpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIoKQogCSAqLwogCWZv
cl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBpOTE1LCBtYXNrLCB0bXApIHsKLQkJdTY0IGlk
eCA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnJpbmctPnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0
OworCQl1NjQgaWR4ID0gZW5naW5lLT5rZXJuZWxfY29udGV4dC0+dGltZWxpbmUtPmZlbmNlX2Nv
bnRleHQ7CiAJCXN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZTsKIAogCQlub2RlID0gcmV1c2VfaWRs
ZV9iYXJyaWVyKHJlZiwgaWR4KTsKQEAgLTY2NSw3ICs2NjUsNyBAQCB2b2lkIGk5MTVfcmVxdWVz
dF9hZGRfYWN0aXZlX2JhcnJpZXJzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCXN0cnVjdCBs
bGlzdF9ub2RlICpub2RlLCAqbmV4dDsKIAogCUdFTV9CVUdfT04oaW50ZWxfZW5naW5lX2lzX3Zp
cnR1YWwoZW5naW5lKSk7Ci0JR0VNX0JVR19PTihycS0+dGltZWxpbmUgIT0gZW5naW5lLT5rZXJu
ZWxfY29udGV4dC0+cmluZy0+dGltZWxpbmUpOworCUdFTV9CVUdfT04ocnEtPnRpbWVsaW5lICE9
IGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnRpbWVsaW5lKTsKIAogCS8qCiAJICogQXR0YWNoIHRo
ZSBsaXN0IG9mIHByb3RvLWZlbmNlcyB0byB0aGUgaW4tZmxpZ2h0IHJlcXVlc3Qgc3VjaApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCA5YjJiMThmMDE5NmIuLjQzMTc1YmFkYTA5
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTMwNiwxMiArMzA2LDEyIEBA
IHN0YXRpYyBib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CiAKIAlsb2NhbF9pcnFfZW5hYmxlKCk7CiAKLQlpbnRlbF9jb250ZXh0X2V4aXQocnEtPmh3X2Nv
bnRleHQpOwotCWludGVsX2NvbnRleHRfdW5waW4ocnEtPmh3X2NvbnRleHQpOwotCiAJaTkxNV9y
ZXF1ZXN0X3JlbW92ZV9mcm9tX2NsaWVudChycSk7CiAJbGlzdF9kZWwoJnJxLT5saW5rKTsKIAor
CWludGVsX2NvbnRleHRfZXhpdChycS0+aHdfY29udGV4dCk7CisJaW50ZWxfY29udGV4dF91bnBp
bihycS0+aHdfY29udGV4dCk7CisKIAlmcmVlX2NhcHR1cmVfbGlzdChycSk7CiAJaTkxNV9zY2hl
ZF9ub2RlX2ZpbmkoJnJxLT5zY2hlZCk7CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CkBAIC02MDgs
NyArNjA4LDcgQEAgcmVxdWVzdF9hbGxvY19zbG93KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwg
Z2ZwX3QgZ2ZwKQogc3RydWN0IGk5MTVfcmVxdWVzdCAqCiBfX2k5MTVfcmVxdWVzdF9jcmVhdGUo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBnZnBfdCBnZnApCiB7Ci0Jc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0bCA9IGNlLT5yaW5nLT50aW1lbGluZTsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUg
KnRsID0gY2UtPnRpbWVsaW5lOwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCXUzMiBzZXFu
bzsKIAlpbnQgcmV0OwpAQCAtNzYwLDcgKzc2MCw3IEBAIGk5MTVfcmVxdWVzdF9jcmVhdGUoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlKQogCQlnb3RvIGVycl91bmxvY2s7CiAKIAkvKiBDaGVjayB0
aGF0IHdlIGRvIG5vdCBpbnRlcnJ1cHQgb3Vyc2VsdmVzIHdpdGggYSBuZXcgcmVxdWVzdCAqLwot
CXJxLT5jb29raWUgPSBsb2NrZGVwX3Bpbl9sb2NrKCZjZS0+cmluZy0+dGltZWxpbmUtPm11dGV4
KTsKKwlycS0+Y29va2llID0gbG9ja2RlcF9waW5fbG9jaygmY2UtPnRpbWVsaW5lLT5tdXRleCk7
CiAKIAlyZXR1cm4gcnE7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfZ2VtX2V2aWN0LmMKaW5kZXggYjY0NDlkMGE4YzE3Li5jYjMwYzY2OWIxYjcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCkBAIC00OCwy
NiArNDgsMjkgQEAgc3RhdGljIGludCBwb3B1bGF0ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogewogCXVuc2lnbmVkIGxvbmcgdW5ib3VuZCwgYm91bmQsIGNvdW50OwogCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0JdTY0IHNpemU7CiAKIAljb3VudCA9IDA7
Ci0JZm9yIChzaXplID0gMDsKLQkgICAgIHNpemUgKyBJOTE1X0dUVF9QQUdFX1NJWkUgPD0gaTkx
NS0+Z2d0dC52bS50b3RhbDsKLQkgICAgIHNpemUgKz0gSTkxNV9HVFRfUEFHRV9TSVpFKSB7CisJ
ZG8gewogCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAogCQlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX2ludGVybmFsKGk5MTUsIEk5MTVfR1RUX1BBR0VfU0laRSk7CiAJCWlmIChJU19FUlIo
b2JqKSkKIAkJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKLQkJcXVpcmtfYWRkKG9iaiwgb2JqZWN0
cyk7Ci0KIAkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwgMCwg
MCk7Ci0JCWlmIChJU19FUlIodm1hKSkKKwkJaWYgKElTX0VSUih2bWEpKSB7CisJCQlpOTE1X2dl
bV9vYmplY3RfcHV0KG9iaik7CisJCQlpZiAodm1hID09IEVSUl9QVFIoLUVOT1NQQykpCisJCQkJ
YnJlYWs7CisKIAkJCXJldHVybiBQVFJfRVJSKHZtYSk7CisJCX0KIAorCQlxdWlya19hZGQob2Jq
LCBvYmplY3RzKTsKIAkJY291bnQrKzsKLQl9CisJfSB3aGlsZSAoMSk7CisJcHJfZGVidWcoIkZp
bGxlZCBHR1RUIHdpdGggJWx1IHBhZ2VzIFslbGx1IHRvdGFsXVxuIiwKKwkJIGNvdW50LCBpOTE1
LT5nZ3R0LnZtLnRvdGFsIC8gUEFHRV9TSVpFKTsKIAogCWJvdW5kID0gMDsKIAl1bmJvdW5kID0g
MDsKLS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

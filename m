Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CB53210EE01
	for <lists+intel-gfx@lfdr.de>; Mon,  2 Dec 2019 18:16:41 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2AC396E0EA;
	Mon,  2 Dec 2019 17:16:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BD1D86E0EA
 for <intel-gfx@lists.freedesktop.org>; Mon,  2 Dec 2019 17:16:38 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 02 Dec 2019 09:16:38 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,268,1571727600"; d="scan'208";a="384962424"
Received: from mdroper-desk1.fm.intel.com ([10.1.27.64])
 by orsmga005.jf.intel.com with ESMTP; 02 Dec 2019 09:16:37 -0800
From: Matt Roper <matthew.d.roper@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  2 Dec 2019 09:16:08 -0800
Message-Id: <20191202171608.3361125-1-matthew.d.roper@intel.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/irq: Refactor gen11 display interrupt
 handling
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGV0J3MgbW92ZSBoYW5kbGluZyBhbmQgcmVzZXQgZm9yIGdlbjExIGRpc3BsYXkgSVJRcyB0byB0
aGVpciBvd24KZnVuY3Rpb25zLCBzaW1pbGFyIHRvIGhvdyB3ZSBkZWFsIHdpdGggR1QgaW50ZXJy
dXB0cy4gIFRoaXMgd2lsbCBtYWtlCnRoZSB0b3AtbGV2ZWwgZnVuY3Rpb25zIGEgYml0IGVhc2ll
ciB0byByZWFkIGFuZCBwb3RlbnRpYWxseSBtYWtlIHRoaW5ncwplYXNpZXIgdG8gZGVhbCB3aXRo
IGluIHRoZSBmdXR1cmUgaWYgbmV3IHBsYXRmb3JtcyB3aW5kIHVwIG5lZWRpbmcKZGlmZmVyZW50
IGRpc3BsYXkgaGFuZGxpbmcgbG9naWMuCgpDYzogTHVjYXMgRGUgTWFyY2hpIDxsdWNhcy5kZW1h
cmNoaUBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IE1hdHQgUm9wZXIgPG1hdHRoZXcuZC5yb3Bl
ckBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyB8IDU3ICsr
KysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDM1IGluc2Vy
dGlvbnMoKyksIDIyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfaXJxLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jCmluZGV4IDQ2
YTlmN2RhZmJmMy4uYTUzNDhmNzkxMTRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2lycS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKQEAgLTI0
NTMsNiArMjQ1MywyNSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgZ2VuMTFfbWFzdGVyX2ludHJfZW5h
YmxlKHZvaWQgX19pb21lbSAqIGNvbnN0IHJlZ3MpCiAJcmF3X3JlZ193cml0ZShyZWdzLCBHRU4x
MV9HRlhfTVNUUl9JUlEsIEdFTjExX01BU1RFUl9JUlEpOwogfQogCitzdGF0aWMgdm9pZAorZ2Vu
MTFfZGlzcGxheV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sK
Kwl2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzID0gaTkxNS0+dW5jb3JlLnJlZ3M7CisJY29uc3Qg
dTMyIGRpc3BfY3RsID0gcmF3X3JlZ19yZWFkKHJlZ3MsIEdFTjExX0RJU1BMQVlfSU5UX0NUTCk7
CisKKwlkaXNhYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoJmk5MTUtPnJ1bnRpbWVfcG0pOworCS8q
CisJICogR0VOMTFfRElTUExBWV9JTlRfQ1RMIGhhcyBzYW1lIGZvcm1hdCBhcyBHRU44X01BU1RF
Ul9JUlEKKwkgKiBmb3IgdGhlIGRpc3BsYXkgcmVsYXRlZCBiaXRzLgorCSAqLworCXJhd19yZWdf
d3JpdGUocmVncywgR0VOMTFfRElTUExBWV9JTlRfQ1RMLCAweDApOworCWdlbjhfZGVfaXJxX2hh
bmRsZXIoaTkxNSwgZGlzcF9jdGwpOworCXJhd19yZWdfd3JpdGUocmVncywgR0VOMTFfRElTUExB
WV9JTlRfQ1RMLAorCQkgICAgICBHRU4xMV9ESVNQTEFZX0lSUV9FTkFCTEUpOworCisJZW5hYmxl
X3JwbV93YWtlcmVmX2Fzc2VydHMoJmk5MTUtPnJ1bnRpbWVfcG0pOworfQorCiBzdGF0aWMgX19h
bHdheXNfaW5saW5lIGlycXJldHVybl90CiBfX2dlbjExX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICogY29uc3QgaTkxNSwKIAkJICAgIHUzMiAoKmludHJfZGlzYWJsZSkodm9p
ZCBfX2lvbWVtICogY29uc3QgcmVncyksCkBAIC0yNDc2LDIxICsyNDk1LDggQEAgX19nZW4xMV9p
cnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqIGNvbnN0IGk5MTUsCiAJZ2VuMTFf
Z3RfaXJxX2hhbmRsZXIoZ3QsIG1hc3Rlcl9jdGwpOwogCiAJLyogSVJRcyBhcmUgc3luY2VkIGR1
cmluZyBydW50aW1lX3N1c3BlbmQsIHdlIGRvbid0IHJlcXVpcmUgYSB3YWtlcmVmICovCi0JaWYg
KG1hc3Rlcl9jdGwgJiBHRU4xMV9ESVNQTEFZX0lSUSkgewotCQljb25zdCB1MzIgZGlzcF9jdGwg
PSByYXdfcmVnX3JlYWQocmVncywgR0VOMTFfRElTUExBWV9JTlRfQ1RMKTsKLQotCQlkaXNhYmxl
X3JwbV93YWtlcmVmX2Fzc2VydHMoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCQkvKgotCQkgKiBHRU4x
MV9ESVNQTEFZX0lOVF9DVEwgaGFzIHNhbWUgZm9ybWF0IGFzIEdFTjhfTUFTVEVSX0lSUQotCQkg
KiBmb3IgdGhlIGRpc3BsYXkgcmVsYXRlZCBiaXRzLgotCQkgKi8KLQkJcmF3X3JlZ193cml0ZShy
ZWdzLCBHRU4xMV9ESVNQTEFZX0lOVF9DVEwsIDB4MCk7Ci0JCWdlbjhfZGVfaXJxX2hhbmRsZXIo
aTkxNSwgZGlzcF9jdGwpOwotCQlyYXdfcmVnX3dyaXRlKHJlZ3MsIEdFTjExX0RJU1BMQVlfSU5U
X0NUTCwKLQkJCSAgICAgIEdFTjExX0RJU1BMQVlfSVJRX0VOQUJMRSk7Ci0KLQkJZW5hYmxlX3Jw
bV93YWtlcmVmX2Fzc2VydHMoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCX0KKwlpZiAobWFzdGVyX2N0
bCAmIEdFTjExX0RJU1BMQVlfSVJRKQorCQlnZW4xMV9kaXNwbGF5X2lycV9oYW5kbGVyKGk5MTUp
OwogCiAJZ3VfbWlzY19paXIgPSBnZW4xMV9ndV9taXNjX2lycV9hY2soZ3QsIG1hc3Rlcl9jdGwp
OwogCkBAIC0yNzkyLDE1ICsyNzk4LDExIEBAIHN0YXRpYyB2b2lkIGdlbjhfaXJxX3Jlc2V0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJaWJ4X2lycV9yZXNldChkZXZfcHJp
dik7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjExX2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW4xMV9kaXNwbGF5X2lycV9yZXNldChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJc3RydWN0IGludGVsX3VuY29yZSAq
dW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CiAJZW51bSBwaXBlIHBpcGU7CiAKLQlnZW4xMV9t
YXN0ZXJfaW50cl9kaXNhYmxlKGRldl9wcml2LT51bmNvcmUucmVncyk7Ci0KLQlnZW4xMV9ndF9p
cnFfcmVzZXQoJmRldl9wcml2LT5ndCk7Ci0KIAlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBH
RU4xMV9ESVNQTEFZX0lOVF9DVEwsIDApOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTIpIHsKQEAgLTI4MjksMTMgKzI4MzEsMjQgQEAgc3RhdGljIHZvaWQgZ2VuMTFfaXJxX3Jlc2V0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlHRU4zX0lSUV9SRVNFVCh1bmNv
cmUsIEdFTjhfREVfUE9SVF8pOwogCUdFTjNfSVJRX1JFU0VUKHVuY29yZSwgR0VOOF9ERV9NSVND
Xyk7CiAJR0VOM19JUlFfUkVTRVQodW5jb3JlLCBHRU4xMV9ERV9IUERfKTsKLQlHRU4zX0lSUV9S
RVNFVCh1bmNvcmUsIEdFTjExX0dVX01JU0NfKTsKLQlHRU4zX0lSUV9SRVNFVCh1bmNvcmUsIEdF
TjhfUENVXyk7CiAKIAlpZiAoSU5URUxfUENIX1RZUEUoZGV2X3ByaXYpID49IFBDSF9JQ1ApCiAJ
CUdFTjNfSVJRX1JFU0VUKHVuY29yZSwgU0RFKTsKIH0KIAorc3RhdGljIHZvaWQgZ2VuMTFfaXJx
X3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3sKKwlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKKworCWdlbjExX21hc3Rlcl9p
bnRyX2Rpc2FibGUoZGV2X3ByaXYtPnVuY29yZS5yZWdzKTsKKworCWdlbjExX2d0X2lycV9yZXNl
dCgmZGV2X3ByaXYtPmd0KTsKKwlnZW4xMV9kaXNwbGF5X2lycV9yZXNldChkZXZfcHJpdik7CisK
KwlHRU4zX0lSUV9SRVNFVCh1bmNvcmUsIEdFTjExX0dVX01JU0NfKTsKKwlHRU4zX0lSUV9SRVNF
VCh1bmNvcmUsIEdFTjhfUENVXyk7Cit9CisKIHZvaWQgZ2VuOF9pcnFfcG93ZXJfd2VsbF9wb3N0
X2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJICAgICB1OCBw
aXBlX21hc2spCiB7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeA==

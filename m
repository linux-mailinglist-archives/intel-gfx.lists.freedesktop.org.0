Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 765A925F5F
	for <lists+intel-gfx@lfdr.de>; Wed, 22 May 2019 10:21:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C8B1189817;
	Wed, 22 May 2019 08:21:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D6937897D0
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 May 2019 08:21:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16636784-1500050 
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 May 2019 09:21:05 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 May 2019 09:20:55 +0100
Message-Id: <20190522082104.5117-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190522082104.5117-1-chris@chris-wilson.co.uk>
References: <20190522082104.5117-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 04/13] drm/i915: Move shmem object setup to its own
 file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdGhlIHBsYWluIG9sZCBzaG1lbSBvYmplY3QgaW50byBpdHMgb3duIGZpbGUgdG8gc3Rh
cnQgZGVjbHV0dGVyaW5nCmk5MTVfZ2VtLmMKCnYyOiBMb3NlIHRoZSBjb25mdXNpbmcsIGh5c3Rl
cmljYWwgcmFpc2lucywgc3VmZml4IG9mIF9ndHQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8
bWF0dGhldy5hdWxkQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmls
ZSAgICAgICAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuYyAgICB8IDI5OCArKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmggICAgfCAgNDEgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9zaG1lbS5jICAgICB8IDUxMSArKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9jbWRfcGFyc2VyLmMgICAgICAgICB8ICAyMSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgIDEwIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDgyNiArLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAgMiArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYyAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9ndWMuYyAgICAgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3VjX2Z3LmMgICAgICAgICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYyAgIHwgICA2ICstCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9kbWFidWYuYyAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jICB8ICAgNCArLQogMTYgZmlsZXMgY2hhbmdl
ZCwgODgyIGluc2VydGlvbnMoKyksIDg2MSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYwoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFr
ZWZpbGUKaW5kZXggMWM4YmQwYTUyMTJkLi42MjVmOTc0OTM1NWIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2Vm
aWxlCkBAIC04Nyw3ICs4Nyw4IEBAIGk5MTUteSArPSAkKGd0LXkpCiAjIEdFTSAoR3JhcGhpY3Mg
RXhlY3V0aW9uIE1hbmFnZW1lbnQpIGNvZGUKIG9iai15ICs9IGdlbS8KIGdlbS15ICs9IFwKLQln
ZW0vaTkxNV9nZW1fb2JqZWN0Lm8KKwlnZW0vaTkxNV9nZW1fb2JqZWN0Lm8gXAorCWdlbS9pOTE1
X2dlbV9zaG1lbS5vCiBpOTE1LXkgKz0gXAogCSAgJChnZW0teSkgXAogCSAgaTkxNV9hY3RpdmUu
byBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggYWM2
YTVhYjg0NTg2Li4zMDAwYjI2YjRiYmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0LmMKQEAgLTI1LDYgKzI1LDcgQEAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgog
I2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgogI2luY2x1ZGUgImk5MTVfZ2xvYmFscy5oIgor
I2luY2x1ZGUgImludGVsX2Zyb250YnVmZmVyLmgiCiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9nbG9i
YWxfb2JqZWN0IHsKIAlzdHJ1Y3QgaTkxNV9nbG9iYWwgYmFzZTsKQEAgLTQxLDYgKzQyLDY0IEBA
IHZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZyZWUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aikKIAlyZXR1cm4ga21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX29iamVjdHMsIG9iaik7CiB9
CiAKKy8qIHNvbWUgYm9va2tlZXBpbmcgKi8KK3N0YXRpYyB2b2lkIGk5MTVfZ2VtX2luZm9fYWRk
X29iaihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCQkgIHU2NCBzaXplKQorewor
CXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqZWN0X3N0YXRfbG9jayk7CisJaTkxNS0+bW0ub2JqZWN0
X2NvdW50Kys7CisJaTkxNS0+bW0ub2JqZWN0X21lbW9yeSArPSBzaXplOworCXNwaW5fdW5sb2Nr
KCZpOTE1LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKK30KKworc3RhdGljIHZvaWQgaTkxNV9nZW1f
aW5mb19yZW1vdmVfb2JqKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgICAg
dTY0IHNpemUpCit7CisJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKKwlp
OTE1LT5tbS5vYmplY3RfY291bnQtLTsKKwlpOTE1LT5tbS5vYmplY3RfbWVtb3J5IC09IHNpemU7
CisJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9iamVjdF9zdGF0X2xvY2spOworfQorCitzdGF0aWMg
dm9pZAorZnJvbnRidWZmZXJfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3Rp
dmUsCisJCSAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCit7CisJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiA9CisJCWNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigqb2Jq
KSwgZnJvbnRidWZmZXJfd3JpdGUpOworCisJaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwgT1JJR0lO
X0NTKTsKK30KKwordm9pZCBpOTE1X2dlbV9vYmplY3RfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAorCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMg
Km9wcykKK3sKKwltdXRleF9pbml0KCZvYmotPm1tLmxvY2spOworCisJc3Bpbl9sb2NrX2luaXQo
Jm9iai0+dm1hLmxvY2spOworCUlOSVRfTElTVF9IRUFEKCZvYmotPnZtYS5saXN0KTsKKworCUlO
SVRfTElTVF9IRUFEKCZvYmotPmx1dF9saXN0KTsKKwlJTklUX0xJU1RfSEVBRCgmb2JqLT5iYXRj
aF9wb29sX2xpbmspOworCisJaW5pdF9yY3VfaGVhZCgmb2JqLT5yY3UpOworCisJb2JqLT5vcHMg
PSBvcHM7CisKKwlyZXNlcnZhdGlvbl9vYmplY3RfaW5pdCgmb2JqLT5fX2J1aWx0aW5fcmVzdik7
CisJb2JqLT5yZXN2ID0gJm9iai0+X19idWlsdGluX3Jlc3Y7CisKKwlvYmotPmZyb250YnVmZmVy
X2dndHRfb3JpZ2luID0gT1JJR0lOX0dUVDsKKwlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJm9i
ai0+ZnJvbnRidWZmZXJfd3JpdGUsCisJCQkJIE5VTEwsIGZyb250YnVmZmVyX3JldGlyZSk7CisK
KwlvYmotPm1tLm1hZHYgPSBJOTE1X01BRFZfV0lMTE5FRUQ7CisJSU5JVF9SQURJWF9UUkVFKCZv
YmotPm1tLmdldF9wYWdlLnJhZGl4LCBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOKTsKKwltdXRl
eF9pbml0KCZvYmotPm1tLmdldF9wYWdlLmxvY2spOworCisJaTkxNV9nZW1faW5mb19hZGRfb2Jq
KHRvX2k5MTUob2JqLT5iYXNlLmRldiksIG9iai0+YmFzZS5zaXplKTsKK30KKwogLyoqCiAgKiBN
YXJrIHVwIHRoZSBvYmplY3QncyBjb2hlcmVuY3kgbGV2ZWxzIGZvciBhIGdpdmVuIGNhY2hlX2xl
dmVsCiAgKiBAb2JqOiAjZHJtX2k5MTVfZ2VtX29iamVjdApAQCAtNjMsNiArMTIyLDI0NSBAQCB2
b2lkIGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCSEob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVf
Q09IRVJFTlRfRk9SX1dSSVRFKTsKIH0KIAordm9pZCBpOTE1X2dlbV9jbG9zZV9vYmplY3Qoc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpnZW0sIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZ2VtLT5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB0b19pbnRlbF9ibyhnZW0pOworCXN0cnVjdCBkcm1f
aTkxNV9maWxlX3ByaXZhdGUgKmZwcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7CisJc3RydWN0IGk5
MTVfbHV0X2hhbmRsZSAqbHV0LCAqbG47CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShsdXQsIGxuLCAmb2JqLT5sdXRf
bGlzdCwgb2JqX2xpbmspIHsKKwkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGx1dC0+
Y3R4OworCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKworCQlHRU1fQlVHX09OKGN0eC0+ZmlsZV9w
cml2ID09IEVSUl9QVFIoLUVCQURGKSk7CisJCWlmIChjdHgtPmZpbGVfcHJpdiAhPSBmcHJpdikK
KwkJCWNvbnRpbnVlOworCisJCXZtYSA9IHJhZGl4X3RyZWVfZGVsZXRlKCZjdHgtPmhhbmRsZXNf
dm1hLCBsdXQtPmhhbmRsZSk7CisJCUdFTV9CVUdfT04odm1hLT5vYmogIT0gb2JqKTsKKworCQkv
KiBXZSBhbGxvdyB0aGUgcHJvY2VzcyB0byBoYXZlIG11bHRpcGxlIGhhbmRsZXMgdG8gdGhlIHNh
bWUKKwkJICogdm1hLCBpbiB0aGUgc2FtZSBmZCBuYW1lc3BhY2UsIGJ5IHZpcnR1ZSBvZiBmbGlu
ay9vcGVuLgorCQkgKi8KKwkJR0VNX0JVR19PTighdm1hLT5vcGVuX2NvdW50KTsKKwkJaWYgKCEt
LXZtYS0+b3Blbl9jb3VudCAmJiAhaTkxNV92bWFfaXNfZ2d0dCh2bWEpKQorCQkJaTkxNV92bWFf
Y2xvc2Uodm1hKTsKKworCQlsaXN0X2RlbCgmbHV0LT5vYmpfbGluayk7CisJCWxpc3RfZGVsKCZs
dXQtPmN0eF9saW5rKTsKKworCQlpOTE1X2x1dF9oYW5kbGVfZnJlZShsdXQpOworCQlfX2k5MTVf
Z2VtX29iamVjdF9yZWxlYXNlX3VubGVzc19hY3RpdmUob2JqKTsKKwl9CisKKwltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworfQorCitzdGF0aWMgYm9vbCBkaXNjYXJkX2Jh
Y2tpbmdfc3RvcmFnZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCS8qIElm
IHdlIGFyZSB0aGUgbGFzdCB1c2VyIG9mIHRoZSBiYWNraW5nIHN0b3JhZ2UgKGJlIGl0IHNobWVt
ZnMKKwkgKiBwYWdlcyBvciBzdG9sZW4gZXRjKSwgd2Uga25vdyB0aGF0IHRoZSBwYWdlcyBhcmUg
Z29pbmcgdG8gYmUKKwkgKiBpbW1lZGlhdGVseSByZWxlYXNlZC4gSW4gdGhpcyBjYXNlLCB3ZSBj
YW4gdGhlbiBza2lwIGNvcHlpbmcKKwkgKiBiYWNrIHRoZSBjb250ZW50cyBmcm9tIHRoZSBHUFUu
CisJICovCisKKwlpZiAob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVFRCkKKwkJcmV0
dXJuIGZhbHNlOworCisJaWYgKCFvYmotPmJhc2UuZmlscCkKKwkJcmV0dXJuIHRydWU7CisKKwkv
KiBBdCBmaXJzdCBnbGFuY2UsIHRoaXMgbG9va3MgcmFjeSwgYnV0IHRoZW4gYWdhaW4gc28gd291
bGQgYmUKKwkgKiB1c2Vyc3BhY2UgcmFjaW5nIG1tYXAgYWdhaW5zdCBjbG9zZS4gSG93ZXZlciwg
dGhlIGZpcnN0IGV4dGVybmFsCisJICogcmVmZXJlbmNlIHRvIHRoZSBmaWxwIGNhbiBvbmx5IGJl
IG9idGFpbmVkIHRocm91Z2ggdGhlCisJICogaTkxNV9nZW1fbW1hcF9pb2N0bCgpIHdoaWNoIHNh
ZmVndWFyZHMgdXMgYWdhaW5zdCB0aGUgdXNlcgorCSAqIGFjcXVpcmluZyBzdWNoIGEgcmVmZXJl
bmNlIHdoaWxzdCB3ZSBhcmUgaW4gdGhlIG1pZGRsZSBvZgorCSAqIGZyZWVpbmcgdGhlIG9iamVj
dC4KKwkgKi8KKwlyZXR1cm4gZmlsZV9jb3VudChvYmotPmJhc2UuZmlscCkgPT0gMTsKK30KKwor
c3RhdGljIHZvaWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCisJCQkJICAgIHN0cnVjdCBsbGlzdF9ub2RlICpmcmVlZCkKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCAqb247CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7
CisKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CisJbGxpc3RfZm9yX2Vh
Y2hfZW50cnlfc2FmZShvYmosIG9uLCBmcmVlZCwgZnJlZWQpIHsKKwkJc3RydWN0IGk5MTVfdm1h
ICp2bWEsICp2bjsKKworCQl0cmFjZV9pOTE1X2dlbV9vYmplY3RfZGVzdHJveShvYmopOworCisJ
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCisJCUdFTV9CVUdfT04oaTkx
NV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopKTsKKwkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KHZtYSwgdm4sICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykgeworCQkJR0VNX0JVR19PTihpOTE1
X3ZtYV9pc19hY3RpdmUodm1hKSk7CisJCQl2bWEtPmZsYWdzICY9IH5JOTE1X1ZNQV9QSU5fTUFT
SzsKKwkJCWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwkJfQorCQlHRU1fQlVHX09OKCFsaXN0X2Vt
cHR5KCZvYmotPnZtYS5saXN0KSk7CisJCUdFTV9CVUdfT04oIVJCX0VNUFRZX1JPT1QoJm9iai0+
dm1hLnRyZWUpKTsKKworCQkvKiBUaGlzIHNlcmlhbGl6ZXMgZnJlZWluZyB3aXRoIHRoZSBzaHJp
bmtlci4gU2luY2UgdGhlIGZyZWUKKwkJICogaXMgZGVsYXllZCwgZmlyc3QgYnkgUkNVIHRoZW4g
YnkgdGhlIHdvcmtxdWV1ZSwgd2Ugd2FudCB0aGUKKwkJICogc2hyaW5rZXIgdG8gYmUgYWJsZSB0
byBmcmVlIHBhZ2VzIG9mIHVucmVmZXJlbmNlZCBvYmplY3RzLAorCQkgKiBvciBlbHNlIHdlIG1h
eSBvb20gd2hpbHN0IHRoZXJlIGFyZSBwbGVudHkgb2YgZGVmZXJyZWQKKwkJICogZnJlZWQgb2Jq
ZWN0cy4KKwkJICovCisJCWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpIHsKKwkJ
CXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCQkJbGlzdF9kZWxfaW5pdCgmb2JqLT5t
bS5saW5rKTsKKwkJCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJCX0KKworCQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCisJCUdFTV9CVUdfT04ob2Jq
LT5iaW5kX2NvdW50KTsKKwkJR0VNX0JVR19PTihvYmotPnVzZXJmYXVsdF9jb3VudCk7CisJCUdF
TV9CVUdfT04oYXRvbWljX3JlYWQoJm9iai0+ZnJvbnRidWZmZXJfYml0cykpOworCQlHRU1fQlVH
X09OKCFsaXN0X2VtcHR5KCZvYmotPmx1dF9saXN0KSk7CisKKwkJaWYgKG9iai0+b3BzLT5yZWxl
YXNlKQorCQkJb2JqLT5vcHMtPnJlbGVhc2Uob2JqKTsKKworCQlpZiAoV0FSTl9PTihpOTE1X2dl
bV9vYmplY3RfaGFzX3Bpbm5lZF9wYWdlcyhvYmopKSkKKwkJCWF0b21pY19zZXQoJm9iai0+bW0u
cGFnZXNfcGluX2NvdW50LCAwKTsKKwkJX19pOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzKG9iaiwg
STkxNV9NTV9OT1JNQUwpOworCQlHRU1fQlVHX09OKGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMo
b2JqKSk7CisKKwkJaWYgKG9iai0+YmFzZS5pbXBvcnRfYXR0YWNoKQorCQkJZHJtX3ByaW1lX2dl
bV9kZXN0cm95KCZvYmotPmJhc2UsIE5VTEwpOworCisJCXJlc2VydmF0aW9uX29iamVjdF9maW5p
KCZvYmotPl9fYnVpbHRpbl9yZXN2KTsKKwkJZHJtX2dlbV9vYmplY3RfcmVsZWFzZSgmb2JqLT5i
YXNlKTsKKwkJaTkxNV9nZW1faW5mb19yZW1vdmVfb2JqKGk5MTUsIG9iai0+YmFzZS5zaXplKTsK
KworCQliaXRtYXBfZnJlZShvYmotPmJpdF8xNyk7CisJCWk5MTVfZ2VtX29iamVjdF9mcmVlKG9i
aik7CisKKwkJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJmk5MTUtPm1tLmZyZWVfY291bnQpKTsK
KwkJYXRvbWljX2RlYygmaTkxNS0+bW0uZnJlZV9jb3VudCk7CisKKwkJaWYgKG9uKQorCQkJY29u
ZF9yZXNjaGVkKCk7CisJfQorCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwor
fQorCit2b2lkIGk5MTVfZ2VtX2ZsdXNoX2ZyZWVfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKK3sKKwlzdHJ1Y3QgbGxpc3Rfbm9kZSAqZnJlZWQ7CisKKwkvKiBGcmVlIHRo
ZSBvbGRlc3QsIG1vc3Qgc3RhbGUgb2JqZWN0IHRvIGtlZXAgdGhlIGZyZWVfbGlzdCBzaG9ydCAq
LworCWZyZWVkID0gTlVMTDsKKwlpZiAoIWxsaXN0X2VtcHR5KCZpOTE1LT5tbS5mcmVlX2xpc3Qp
KSB7IC8qIHF1aWNrIHRlc3QgZm9yIGhvdHBhdGggKi8KKwkJLyogT25seSBvbmUgY29uc3VtZXIg
b2YgbGxpc3RfZGVsX2ZpcnN0KCkgYWxsb3dlZCAqLworCQlzcGluX2xvY2soJmk5MTUtPm1tLmZy
ZWVfbG9jayk7CisJCWZyZWVkID0gbGxpc3RfZGVsX2ZpcnN0KCZpOTE1LT5tbS5mcmVlX2xpc3Qp
OworCQlzcGluX3VubG9jaygmaTkxNS0+bW0uZnJlZV9sb2NrKTsKKwl9CisJaWYgKHVubGlrZWx5
KGZyZWVkKSkgeworCQlmcmVlZC0+bmV4dCA9IE5VTEw7CisJCV9faTkxNV9nZW1fZnJlZV9vYmpl
Y3RzKGk5MTUsIGZyZWVkKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIF9faTkxNV9nZW1fZnJlZV93
b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9CisJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSwg
bW0uZnJlZV93b3JrKTsKKwlzdHJ1Y3QgbGxpc3Rfbm9kZSAqZnJlZWQ7CisKKwkvKgorCSAqIEFs
bCBmaWxlLW93bmVkIFZNQSBzaG91bGQgaGF2ZSBiZWVuIHJlbGVhc2VkIGJ5IHRoaXMgcG9pbnQg
dGhyb3VnaAorCSAqIGk5MTVfZ2VtX2Nsb3NlX29iamVjdCgpLCBvciBlYXJsaWVyIGJ5IGk5MTVf
Z2VtX2NvbnRleHRfY2xvc2UoKS4KKwkgKiBIb3dldmVyLCB0aGUgb2JqZWN0IG1heSBhbHNvIGJl
IGJvdW5kIGludG8gdGhlIGdsb2JhbCBHVFQgKGUuZy4KKwkgKiBvbGRlciBHUFVzIHdpdGhvdXQg
cGVyLXByb2Nlc3Mgc3VwcG9ydCwgb3IgZm9yIGRpcmVjdCBhY2Nlc3MgdGhyb3VnaAorCSAqIHRo
ZSBHVFQgZWl0aGVyIGZvciB0aGUgdXNlciBvciBmb3Igc2Nhbm91dCkuIFRob3NlIFZNQSBzdGls
bCBuZWVkIHRvCisJICogdW5ib3VuZCBub3cuCisJICovCisKKwlzcGluX2xvY2soJmk5MTUtPm1t
LmZyZWVfbG9jayk7CisJd2hpbGUgKChmcmVlZCA9IGxsaXN0X2RlbF9hbGwoJmk5MTUtPm1tLmZy
ZWVfbGlzdCkpKSB7CisJCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5mcmVlX2xvY2spOworCisJCV9f
aTkxNV9nZW1fZnJlZV9vYmplY3RzKGk5MTUsIGZyZWVkKTsKKwkJaWYgKG5lZWRfcmVzY2hlZCgp
KQorCQkJcmV0dXJuOworCisJCXNwaW5fbG9jaygmaTkxNS0+bW0uZnJlZV9sb2NrKTsKKwl9CisJ
c3Bpbl91bmxvY2soJmk5MTUtPm1tLmZyZWVfbG9jayk7Cit9CisKK3N0YXRpYyB2b2lkIF9faTkx
NV9nZW1fZnJlZV9vYmplY3RfcmN1KHN0cnVjdCByY3VfaGVhZCAqaGVhZCkKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0KKwkJY29udGFpbmVyX29mKGhlYWQsIHR5cGVvZigq
b2JqKSwgcmN1KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2Jq
LT5iYXNlLmRldik7CisKKwkvKgorCSAqIFdlIHJldXNlIG9iai0+cmN1IGZvciB0aGUgZnJlZWQg
bGlzdCwgc28gd2UgaGFkIGJldHRlciBub3QgdHJlYXQKKwkgKiBpdCBsaWtlIGEgcmN1X2hlYWQg
ZnJvbSB0aGlzIHBvaW50IGZvcndhcmRzLiBBbmQgd2UgZXhwZWN0IGFsbAorCSAqIG9iamVjdHMg
dG8gYmUgZnJlZWQgdmlhIHRoaXMgcGF0aC4KKwkgKi8KKwlkZXN0cm95X3JjdV9oZWFkKCZvYmot
PnJjdSk7CisKKwkvKgorCSAqIFNpbmNlIHdlIHJlcXVpcmUgYmxvY2tpbmcgb24gc3RydWN0X211
dGV4IHRvIHVuYmluZCB0aGUgZnJlZWQKKwkgKiBvYmplY3QgZnJvbSB0aGUgR1BVIGJlZm9yZSBy
ZWxlYXNpbmcgcmVzb3VyY2VzIGJhY2sgdG8gdGhlCisJICogc3lzdGVtLCB3ZSBjYW4gbm90IGRv
IHRoYXQgZGlyZWN0bHkgZnJvbSB0aGUgUkNVIGNhbGxiYWNrICh3aGljaCBtYXkKKwkgKiBiZSBh
IHNvZnRpcnEgY29udGV4dCksIGJ1dCBtdXN0IGluc3RlYWQgdGhlbiBkZWZlciB0aGF0IHdvcmsg
b250byBhCisJICoga3RocmVhZC4gV2UgdXNlIHRoZSBSQ1UgY2FsbGJhY2sgcmF0aGVyIHRoYW4g
bW92ZSB0aGUgZnJlZWQgb2JqZWN0CisJICogZGlyZWN0bHkgb250byB0aGUgd29yayBxdWV1ZSBz
byB0aGF0IHdlIGNhbiBtaXggYmV0d2VlbiB1c2luZyB0aGUKKwkgKiB3b3JrZXIgYW5kIHBlcmZv
cm1pbmcgZnJlZXMgZGlyZWN0bHkgZnJvbSBzdWJzZXF1ZW50IGFsbG9jYXRpb25zIGZvcgorCSAq
IGNydWRlIGJ1dCBlZmZlY3RpdmUgbWVtb3J5IHRocm90dGxpbmcuCisJICovCisJaWYgKGxsaXN0
X2FkZCgmb2JqLT5mcmVlZCwgJmk5MTUtPm1tLmZyZWVfbGlzdCkpCisJCXF1ZXVlX3dvcmsoaTkx
NS0+d3EsICZpOTE1LT5tbS5mcmVlX3dvcmspOworfQorCit2b2lkIGk5MTVfZ2VtX2ZyZWVfb2Jq
ZWN0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtX29iaikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqID0gdG9faW50ZWxfYm8oZ2VtX29iaik7CisKKwlpZiAob2JqLT5tbS5x
dWlya2VkKQorCQlfX2k5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOworCisJaWYgKGRp
c2NhcmRfYmFja2luZ19zdG9yYWdlKG9iaikpCisJCW9iai0+bW0ubWFkdiA9IEk5MTVfTUFEVl9E
T05UTkVFRDsKKworCS8qCisJICogQmVmb3JlIHdlIGZyZWUgdGhlIG9iamVjdCwgbWFrZSBzdXJl
IGFueSBwdXJlIFJDVS1vbmx5CisJICogcmVhZC1zaWRlIGNyaXRpY2FsIHNlY3Rpb25zIGFyZSBj
b21wbGV0ZSwgZS5nLgorCSAqIGk5MTVfZ2VtX2J1c3lfaW9jdGwoKS4gRm9yIHRoZSBjb3JyZXNw
b25kaW5nIHN5bmNocm9uaXplZAorCSAqIGxvb2t1cCBzZWUgaTkxNV9nZW1fb2JqZWN0X2xvb2t1
cF9yY3UoKS4KKwkgKi8KKwlhdG9taWNfaW5jKCZ0b19pOTE1KG9iai0+YmFzZS5kZXYpLT5tbS5m
cmVlX2NvdW50KTsKKwljYWxsX3JjdSgmb2JqLT5yY3UsIF9faTkxNV9nZW1fZnJlZV9vYmplY3Rf
cmN1KTsKK30KKwordm9pZCBfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3VubGVzc19hY3RpdmUo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCisJaWYgKCFpOTE1X2dlbV9vYmplY3Rf
aGFzX2FjdGl2ZV9yZWZlcmVuY2Uob2JqKSAmJgorCSAgICBpOTE1X2dlbV9vYmplY3RfaXNfYWN0
aXZlKG9iaikpCisJCWk5MTVfZ2VtX29iamVjdF9zZXRfYWN0aXZlX3JlZmVyZW5jZShvYmopOwor
CWVsc2UKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworfQorCit2b2lkIGk5MTVfZ2VtX2lu
aXRfX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJSU5JVF9XT1JL
KCZpOTE1LT5tbS5mcmVlX3dvcmssIF9faTkxNV9nZW1fZnJlZV93b3JrKTsKK30KKwogc3RhdGlj
IHZvaWQgaTkxNV9nbG9iYWxfb2JqZWN0c19zaHJpbmsodm9pZCkKIHsKIAlrbWVtX2NhY2hlX3No
cmluayhnbG9iYWwuc2xhYl9vYmplY3RzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuaAppbmRleCA5ZGZkOGIwZGI3MjUuLjA1ZWY2YjAwNzZhZSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtMTUsOSArMTUsMjkgQEAK
IAogI2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdF90eXBlcy5oIgogCit2b2lkIGk5MTVfZ2VtX2lu
aXRfX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworCiBzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqaTkxNV9nZW1fb2JqZWN0X2FsbG9jKHZvaWQpOwogdm9pZCBpOTE1
X2dlbV9vYmplY3RfZnJlZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKIAordm9p
ZCBpOTE1X2dlbV9vYmplY3RfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAor
CQkJICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgKm9wcyk7CitzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqCitpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1NjQgc2l6ZSk7CitzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqCitpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtX2Zyb21fZGF0YShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCQkgICAgICAgY29uc3Qgdm9pZCAqZGF0YSwgc2l6
ZV90IHNpemUpOworCitleHRlcm4gY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3Bz
IGk5MTVfZ2VtX3NobWVtX29wczsKK3ZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9zaG1l
bShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJCSAgICAgc3RydWN0IHNnX3Rh
YmxlICpwYWdlcywKKwkJCQkgICAgIGJvb2wgbmVlZHNfY2xmbHVzaCk7CisKK3ZvaWQgaTkxNV9n
ZW1fY2xvc2Vfb2JqZWN0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtLCBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUpOwordm9pZCBpOTE1X2dlbV9mcmVlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmpl
Y3QgKm9iaik7CisKK3ZvaWQgaTkxNV9nZW1fZmx1c2hfZnJlZV9vYmplY3RzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KTsKKwogLyoqCiAgKiBpOTE1X2dlbV9vYmplY3RfbG9va3VwX3Jj
dSAtIGxvb2sgdXAgYSB0ZW1wb3JhcnkgR0VNIG9iamVjdCBmcm9tIGl0cyBoYW5kbGUKICAqIEBm
aWxwOiBEUk0gZmlsZSBwcml2YXRlIGRhdGUKQEAgLTM0Myw4ICszNjMsMjMgQEAgdm9pZCBpOTE1
X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAogCQkJCQkgdW5zaWduZWQgaW50IGNhY2hlX2xldmVsKTsKIHZvaWQgaTkxNV9nZW1f
b2JqZWN0X2ZsdXNoX2lmX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7
CiAKLXZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9zaG1lbShzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAotCQkJCSAgICAgc3RydWN0IHNnX3RhYmxlICpwYWdlcywKLQkJCQkg
ICAgIGJvb2wgbmVlZHNfY2xmbHVzaCk7CitzdGF0aWMgaW5saW5lIGJvb2wgY3B1X3dyaXRlX25l
ZWRzX2NsZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlpZiAob2Jq
LT5jYWNoZV9kaXJ0eSkKKwkJcmV0dXJuIGZhbHNlOworCisJaWYgKCEob2JqLT5jYWNoZV9jb2hl
cmVudCAmIEk5MTVfQk9fQ0FDSEVfQ09IRVJFTlRfRk9SX1dSSVRFKSkKKwkJcmV0dXJuIHRydWU7
CisKKwlyZXR1cm4gb2JqLT5waW5fZ2xvYmFsOyAvKiBjdXJyZW50bHkgaW4gdXNlIGJ5IEhXLCBr
ZWVwIGZsdXNoZWQgKi8KK30KKworc3RhdGljIGlubGluZSB2b2lkIF9fc3RhcnRfY3B1X3dyaXRl
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJb2JqLT5yZWFkX2RvbWFpbnMg
PSBJOTE1X0dFTV9ET01BSU5fQ1BVOworCW9iai0+d3JpdGVfZG9tYWluID0gSTkxNV9HRU1fRE9N
QUlOX0NQVTsKKwlpZiAoY3B1X3dyaXRlX25lZWRzX2NsZmx1c2gob2JqKSkKKwkJb2JqLT5jYWNo
ZV9kaXJ0eSA9IHRydWU7Cit9CiAKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fc2htZW0uYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmUy
NzIxYmQ5YWI0NAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9zaG1lbS5jCkBAIC0wLDAgKzEsNTExIEBACisvKgorICogU1BEWC1MaWNlbnNlLUlk
ZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE0LTIwMTYgSW50ZWwgQ29ycG9y
YXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgvcGFnZXZlYy5oPgorI2luY2x1ZGUgPGxpbnV4
L3N3YXAuaD4KKworI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fb2Jq
ZWN0LmgiCisKKy8qCisgKiBNb3ZlIHBhZ2VzIHRvIGFwcHJvcHJpYXRlIGxydSBhbmQgcmVsZWFz
ZSB0aGUgcGFnZXZlYywgZGVjcmVtZW50aW5nIHRoZQorICogcmVmIGNvdW50IG9mIHRob3NlIHBh
Z2VzLgorICovCitzdGF0aWMgdm9pZCBjaGVja19yZWxlYXNlX3BhZ2V2ZWMoc3RydWN0IHBhZ2V2
ZWMgKnB2ZWMpCit7CisJY2hlY2tfbW92ZV91bmV2aWN0YWJsZV9wYWdlcyhwdmVjKTsKKwlfX3Bh
Z2V2ZWNfcmVsZWFzZShwdmVjKTsKKwljb25kX3Jlc2NoZWQoKTsKK30KKworc3RhdGljIGludCBz
aG1lbV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJY29u
c3QgdW5zaWduZWQgbG9uZyBwYWdlX2NvdW50ID0gb2JqLT5iYXNlLnNpemUgLyBQQUdFX1NJWkU7
CisJdW5zaWduZWQgbG9uZyBpOworCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nOworCXN0
cnVjdCBzZ190YWJsZSAqc3Q7CisJc3RydWN0IHNjYXR0ZXJsaXN0ICpzZzsKKwlzdHJ1Y3Qgc2d0
X2l0ZXIgc2d0X2l0ZXI7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisJdW5zaWduZWQgbG9uZyBsYXN0
X3BmbiA9IDA7CS8qIHN1cHByZXNzIGdjYyB3YXJuaW5nICovCisJdW5zaWduZWQgaW50IG1heF9z
ZWdtZW50ID0gaTkxNV9zZ19zZWdtZW50X3NpemUoKTsKKwl1bnNpZ25lZCBpbnQgc2dfcGFnZV9z
aXplczsKKwlzdHJ1Y3QgcGFnZXZlYyBwdmVjOworCWdmcF90IG5vcmVjbGFpbTsKKwlpbnQgcmV0
OworCisJLyoKKwkgKiBBc3NlcnQgdGhhdCB0aGUgb2JqZWN0IGlzIG5vdCBjdXJyZW50bHkgaW4g
YW55IEdQVSBkb21haW4uIEFzIGl0CisJICogd2Fzbid0IGluIHRoZSBHVFQsIHRoZXJlIHNob3Vs
ZG4ndCBiZSBhbnkgd2F5IGl0IGNvdWxkIGhhdmUgYmVlbiBpbgorCSAqIGEgR1BVIGNhY2hlCisJ
ICovCisJR0VNX0JVR19PTihvYmotPnJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0dQVV9ET01BSU5T
KTsKKwlHRU1fQlVHX09OKG9iai0+d3JpdGVfZG9tYWluICYgSTkxNV9HRU1fR1BVX0RPTUFJTlMp
OworCisJLyoKKwkgKiBJZiB0aGVyZSdzIG5vIGNoYW5jZSBvZiBhbGxvY2F0aW5nIGVub3VnaCBw
YWdlcyBmb3IgdGhlIHdob2xlCisJICogb2JqZWN0LCBiYWlsIGVhcmx5LgorCSAqLworCWlmIChw
YWdlX2NvdW50ID4gdG90YWxyYW1fcGFnZXMoKSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlzdCA9
IGttYWxsb2Moc2l6ZW9mKCpzdCksIEdGUF9LRVJORUwpOworCWlmICghc3QpCisJCXJldHVybiAt
RU5PTUVNOworCityZWJ1aWxkX3N0OgorCWlmIChzZ19hbGxvY190YWJsZShzdCwgcGFnZV9jb3Vu
dCwgR0ZQX0tFUk5FTCkpIHsKKwkJa2ZyZWUoc3QpOworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisK
KwkvKgorCSAqIEdldCB0aGUgbGlzdCBvZiBwYWdlcyBvdXQgb2Ygb3VyIHN0cnVjdCBmaWxlLiAg
VGhleSdsbCBiZSBwaW5uZWQKKwkgKiBhdCB0aGlzIHBvaW50IHVudGlsIHdlIHJlbGVhc2UgdGhl
bS4KKwkgKgorCSAqIEZhaWwgc2lsZW50bHkgd2l0aG91dCBzdGFydGluZyB0aGUgc2hyaW5rZXIK
KwkgKi8KKwltYXBwaW5nID0gb2JqLT5iYXNlLmZpbHAtPmZfbWFwcGluZzsKKwltYXBwaW5nX3Nl
dF91bmV2aWN0YWJsZShtYXBwaW5nKTsKKwlub3JlY2xhaW0gPSBtYXBwaW5nX2dmcF9jb25zdHJh
aW50KG1hcHBpbmcsIH5fX0dGUF9SRUNMQUlNKTsKKwlub3JlY2xhaW0gfD0gX19HRlBfTk9SRVRS
WSB8IF9fR0ZQX05PV0FSTjsKKworCXNnID0gc3QtPnNnbDsKKwlzdC0+bmVudHMgPSAwOworCXNn
X3BhZ2Vfc2l6ZXMgPSAwOworCWZvciAoaSA9IDA7IGkgPCBwYWdlX2NvdW50OyBpKyspIHsKKwkJ
Y29uc3QgdW5zaWduZWQgaW50IHNocmlua1tdID0geworCQkJKEk5MTVfU0hSSU5LX0JPVU5EIHwK
KwkJCSBJOTE1X1NIUklOS19VTkJPVU5EIHwKKwkJCSBJOTE1X1NIUklOS19QVVJHRUFCTEUpLAor
CQkJMCwKKwkJfSwgKnMgPSBzaHJpbms7CisJCWdmcF90IGdmcCA9IG5vcmVjbGFpbTsKKworCQlk
byB7CisJCQljb25kX3Jlc2NoZWQoKTsKKwkJCXBhZ2UgPSBzaG1lbV9yZWFkX21hcHBpbmdfcGFn
ZV9nZnAobWFwcGluZywgaSwgZ2ZwKTsKKwkJCWlmICghSVNfRVJSKHBhZ2UpKQorCQkJCWJyZWFr
OworCisJCQlpZiAoISpzKSB7CisJCQkJcmV0ID0gUFRSX0VSUihwYWdlKTsKKwkJCQlnb3RvIGVy
cl9zZzsKKwkJCX0KKworCQkJaTkxNV9nZW1fc2hyaW5rKGk5MTUsIDIgKiBwYWdlX2NvdW50LCBO
VUxMLCAqcysrKTsKKworCQkJLyoKKwkJCSAqIFdlJ3ZlIHRyaWVkIGhhcmQgdG8gYWxsb2NhdGUg
dGhlIG1lbW9yeSBieSByZWFwaW5nCisJCQkgKiBvdXIgb3duIGJ1ZmZlciwgbm93IGxldCB0aGUg
cmVhbCBWTSBkbyBpdHMgam9iIGFuZAorCQkJICogZ28gZG93biBpbiBmbGFtZXMgaWYgdHJ1bHkg
T09NLgorCQkJICoKKwkJCSAqIEhvd2V2ZXIsIHNpbmNlIGdyYXBoaWNzIHRlbmQgdG8gYmUgZGlz
cG9zYWJsZSwKKwkJCSAqIGRlZmVyIHRoZSBvb20gaGVyZSBieSByZXBvcnRpbmcgdGhlIEVOT01F
TSBiYWNrCisJCQkgKiB0byB1c2Vyc3BhY2UuCisJCQkgKi8KKwkJCWlmICghKnMpIHsKKwkJCQkv
KiByZWNsYWltIGFuZCB3YXJuLCBidXQgbm8gb29tICovCisJCQkJZ2ZwID0gbWFwcGluZ19nZnBf
bWFzayhtYXBwaW5nKTsKKworCQkJCS8qCisJCQkJICogT3VyIGJvIGFyZSBhbHdheXMgZGlydHkg
YW5kIHNvIHdlIHJlcXVpcmUKKwkJCQkgKiBrc3dhcGQgdG8gcmVjbGFpbSBvdXIgcGFnZXMgKGRp
cmVjdCByZWNsYWltCisJCQkJICogZG9lcyBub3QgZWZmZWN0aXZlbHkgYmVnaW4gcGFnZW91dCBv
ZiBvdXIKKwkJCQkgKiBidWZmZXJzIG9uIGl0cyBvd24pLiBIb3dldmVyLCBkaXJlY3QgcmVjbGFp
bQorCQkJCSAqIG9ubHkgd2FpdHMgZm9yIGtzd2FwZCB3aGVuIHVuZGVyIGFsbG9jYXRpb24KKwkJ
CQkgKiBjb25nZXN0aW9uLiBTbyBhcyBhIHJlc3VsdCBfX0dGUF9SRUNMQUlNIGlzCisJCQkJICog
dW5yZWxpYWJsZSBhbmQgZmFpbHMgdG8gYWN0dWFsbHkgcmVjbGFpbSBvdXIKKwkJCQkgKiBkaXJ0
eSBwYWdlcyAtLSB1bmxlc3MgeW91IHRyeSBvdmVyIGFuZCBvdmVyCisJCQkJICogYWdhaW4gd2l0
aCAhX19HRlBfTk9SRVRSWS4gSG93ZXZlciwgd2Ugc3RpbGwKKwkJCQkgKiB3YW50IHRvIGZhaWwg
dGhpcyBhbGxvY2F0aW9uIHJhdGhlciB0aGFuCisJCQkJICogdHJpZ2dlciB0aGUgb3V0LW9mLW1l
bW9yeSBraWxsZXIgYW5kIGZvcgorCQkJCSAqIHRoaXMgd2Ugd2FudCBfX0dGUF9SRVRSWV9NQVlG
QUlMLgorCQkJCSAqLworCQkJCWdmcCB8PSBfX0dGUF9SRVRSWV9NQVlGQUlMOworCQkJfQorCQl9
IHdoaWxlICgxKTsKKworCQlpZiAoIWkgfHwKKwkJICAgIHNnLT5sZW5ndGggPj0gbWF4X3NlZ21l
bnQgfHwKKwkJICAgIHBhZ2VfdG9fcGZuKHBhZ2UpICE9IGxhc3RfcGZuICsgMSkgeworCQkJaWYg
KGkpIHsKKwkJCQlzZ19wYWdlX3NpemVzIHw9IHNnLT5sZW5ndGg7CisJCQkJc2cgPSBzZ19uZXh0
KHNnKTsKKwkJCX0KKwkJCXN0LT5uZW50cysrOworCQkJc2dfc2V0X3BhZ2Uoc2csIHBhZ2UsIFBB
R0VfU0laRSwgMCk7CisJCX0gZWxzZSB7CisJCQlzZy0+bGVuZ3RoICs9IFBBR0VfU0laRTsKKwkJ
fQorCQlsYXN0X3BmbiA9IHBhZ2VfdG9fcGZuKHBhZ2UpOworCisJCS8qIENoZWNrIHRoYXQgdGhl
IGk5NjVnL2dtIHdvcmthcm91bmQgd29ya3MuICovCisJCVdBUk5fT04oKGdmcCAmIF9fR0ZQX0RN
QTMyKSAmJiAobGFzdF9wZm4gPj0gMHgwMDEwMDAwMFVMKSk7CisJfQorCWlmIChzZykgeyAvKiBs
b29wIHRlcm1pbmF0ZWQgZWFybHk7IHNob3J0IHNnIHRhYmxlICovCisJCXNnX3BhZ2Vfc2l6ZXMg
fD0gc2ctPmxlbmd0aDsKKwkJc2dfbWFya19lbmQoc2cpOworCX0KKworCS8qIFRyaW0gdW51c2Vk
IHNnIGVudHJpZXMgdG8gYXZvaWQgd2FzdGluZyBtZW1vcnkuICovCisJaTkxNV9zZ190cmltKHN0
KTsKKworCXJldCA9IGk5MTVfZ2VtX2d0dF9wcmVwYXJlX3BhZ2VzKG9iaiwgc3QpOworCWlmIChy
ZXQpIHsKKwkJLyoKKwkJICogRE1BIHJlbWFwcGluZyBmYWlsZWQ/IE9uZSBwb3NzaWJsZSBjYXVz
ZSBpcyB0aGF0CisJCSAqIGl0IGNvdWxkIG5vdCByZXNlcnZlIGVub3VnaCBsYXJnZSBlbnRyaWVz
LCBhc2tpbmcKKwkJICogZm9yIFBBR0VfU0laRSBjaHVua3MgaW5zdGVhZCBtYXkgYmUgaGVscGZ1
bC4KKwkJICovCisJCWlmIChtYXhfc2VnbWVudCA+IFBBR0VfU0laRSkgeworCQkJZm9yX2VhY2hf
c2d0X3BhZ2UocGFnZSwgc2d0X2l0ZXIsIHN0KQorCQkJCXB1dF9wYWdlKHBhZ2UpOworCQkJc2df
ZnJlZV90YWJsZShzdCk7CisKKwkJCW1heF9zZWdtZW50ID0gUEFHRV9TSVpFOworCQkJZ290byBy
ZWJ1aWxkX3N0OworCQl9IGVsc2UgeworCQkJZGV2X3dhcm4oJmk5MTUtPmRybS5wZGV2LT5kZXYs
CisJCQkJICJGYWlsZWQgdG8gRE1BIHJlbWFwICVsdSBwYWdlc1xuIiwKKwkJCQkgcGFnZV9jb3Vu
dCk7CisJCQlnb3RvIGVycl9wYWdlczsKKwkJfQorCX0KKworCWlmIChpOTE1X2dlbV9vYmplY3Rf
bmVlZHNfYml0MTdfc3dpenpsZShvYmopKQorCQlpOTE1X2dlbV9vYmplY3RfZG9fYml0XzE3X3N3
aXp6bGUob2JqLCBzdCk7CisKKwlfX2k5MTVfZ2VtX29iamVjdF9zZXRfcGFnZXMob2JqLCBzdCwg
c2dfcGFnZV9zaXplcyk7CisKKwlyZXR1cm4gMDsKKworZXJyX3NnOgorCXNnX21hcmtfZW5kKHNn
KTsKK2Vycl9wYWdlczoKKwltYXBwaW5nX2NsZWFyX3VuZXZpY3RhYmxlKG1hcHBpbmcpOworCXBh
Z2V2ZWNfaW5pdCgmcHZlYyk7CisJZm9yX2VhY2hfc2d0X3BhZ2UocGFnZSwgc2d0X2l0ZXIsIHN0
KSB7CisJCWlmICghcGFnZXZlY19hZGQoJnB2ZWMsIHBhZ2UpKQorCQkJY2hlY2tfcmVsZWFzZV9w
YWdldmVjKCZwdmVjKTsKKwl9CisJaWYgKHBhZ2V2ZWNfY291bnQoJnB2ZWMpKQorCQljaGVja19y
ZWxlYXNlX3BhZ2V2ZWMoJnB2ZWMpOworCXNnX2ZyZWVfdGFibGUoc3QpOworCWtmcmVlKHN0KTsK
KworCS8qCisJICogc2htZW1mcyBmaXJzdCBjaGVja3MgaWYgdGhlcmUgaXMgZW5vdWdoIG1lbW9y
eSB0byBhbGxvY2F0ZSB0aGUgcGFnZQorCSAqIGFuZCByZXBvcnRzIEVOT1NQQyBzaG91bGQgdGhl
cmUgYmUgaW5zdWZmaWNpZW50LCBhbG9uZyB3aXRoIHRoZSB1c3VhbAorCSAqIEVOT01FTSBmb3Ig
YSBnZW51aW5lIGFsbG9jYXRpb24gZmFpbHVyZS4KKwkgKgorCSAqIFdlIHVzZSBFTk9TUEMgaW4g
b3VyIGRyaXZlciB0byBtZWFuIHRoYXQgd2UgaGF2ZSBydW4gb3V0IG9mIGFwZXJ0dXJlCisJICog
c3BhY2UgYW5kIHNvIHdhbnQgdG8gdHJhbnNsYXRlIHRoZSBlcnJvciBmcm9tIHNobWVtZnMgYmFj
ayB0byBvdXIKKwkgKiB1c3VhbCB1bmRlcnN0YW5kaW5nIG9mIEVOT01FTS4KKwkgKi8KKwlpZiAo
cmV0ID09IC1FTk9TUEMpCisJCXJldCA9IC1FTk9NRU07CisKKwlyZXR1cm4gcmV0OworfQorCit2
b2lkCitfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3NobWVtKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCisJCQkJc3RydWN0IHNnX3RhYmxlICpwYWdlcywKKwkJCQlib29sIG5lZWRz
X2NsZmx1c2gpCit7CisJR0VNX0JVR19PTihvYmotPm1tLm1hZHYgPT0gX19JOTE1X01BRFZfUFVS
R0VEKTsKKworCWlmIChvYmotPm1tLm1hZHYgPT0gSTkxNV9NQURWX0RPTlRORUVEKQorCQlvYmot
Pm1tLmRpcnR5ID0gZmFsc2U7CisKKwlpZiAobmVlZHNfY2xmbHVzaCAmJgorCSAgICAob2JqLT5y
ZWFkX2RvbWFpbnMgJiBJOTE1X0dFTV9ET01BSU5fQ1BVKSA9PSAwICYmCisJICAgICEob2JqLT5j
YWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVfQ09IRVJFTlRfRk9SX1JFQUQpKQorCQlkcm1f
Y2xmbHVzaF9zZyhwYWdlcyk7CisKKwlfX3N0YXJ0X2NwdV93cml0ZShvYmopOworfQorCitzdGF0
aWMgdm9pZAorc2htZW1fcHV0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
IHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpCit7CisJc3RydWN0IHNndF9pdGVyIHNndF9pdGVyOwor
CXN0cnVjdCBwYWdldmVjIHB2ZWM7CisJc3RydWN0IHBhZ2UgKnBhZ2U7CisKKwlfX2k5MTVfZ2Vt
X29iamVjdF9yZWxlYXNlX3NobWVtKG9iaiwgcGFnZXMsIHRydWUpOworCisJaTkxNV9nZW1fZ3R0
X2ZpbmlzaF9wYWdlcyhvYmosIHBhZ2VzKTsKKworCWlmIChpOTE1X2dlbV9vYmplY3RfbmVlZHNf
Yml0MTdfc3dpenpsZShvYmopKQorCQlpOTE1X2dlbV9vYmplY3Rfc2F2ZV9iaXRfMTdfc3dpenps
ZShvYmosIHBhZ2VzKTsKKworCW1hcHBpbmdfY2xlYXJfdW5ldmljdGFibGUoZmlsZV9pbm9kZShv
YmotPmJhc2UuZmlscCktPmlfbWFwcGluZyk7CisKKwlwYWdldmVjX2luaXQoJnB2ZWMpOworCWZv
cl9lYWNoX3NndF9wYWdlKHBhZ2UsIHNndF9pdGVyLCBwYWdlcykgeworCQlpZiAob2JqLT5tbS5k
aXJ0eSkKKwkJCXNldF9wYWdlX2RpcnR5KHBhZ2UpOworCisJCWlmIChvYmotPm1tLm1hZHYgPT0g
STkxNV9NQURWX1dJTExORUVEKQorCQkJbWFya19wYWdlX2FjY2Vzc2VkKHBhZ2UpOworCisJCWlm
ICghcGFnZXZlY19hZGQoJnB2ZWMsIHBhZ2UpKQorCQkJY2hlY2tfcmVsZWFzZV9wYWdldmVjKCZw
dmVjKTsKKwl9CisJaWYgKHBhZ2V2ZWNfY291bnQoJnB2ZWMpKQorCQljaGVja19yZWxlYXNlX3Bh
Z2V2ZWMoJnB2ZWMpOworCW9iai0+bW0uZGlydHkgPSBmYWxzZTsKKworCXNnX2ZyZWVfdGFibGUo
cGFnZXMpOworCWtmcmVlKHBhZ2VzKTsKK30KKworc3RhdGljIGludAorc2htZW1fcHdyaXRlKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJICAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX3B3cml0ZSAqYXJnKQoreworCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5nID0g
b2JqLT5iYXNlLmZpbHAtPmZfbWFwcGluZzsKKwljaGFyIF9fdXNlciAqdXNlcl9kYXRhID0gdTY0
X3RvX3VzZXJfcHRyKGFyZy0+ZGF0YV9wdHIpOworCXU2NCByZW1haW4sIG9mZnNldDsKKwl1bnNp
Z25lZCBpbnQgcGc7CisKKwkvKiBDYWxsZXIgYWxyZWFkeSB2YWxpZGF0ZWQgdXNlciBhcmdzICov
CisJR0VNX0JVR19PTighYWNjZXNzX29rKHVzZXJfZGF0YSwgYXJnLT5zaXplKSk7CisKKwkvKgor
CSAqIEJlZm9yZSB3ZSBpbnN0YW50aWF0ZS9waW4gdGhlIGJhY2tpbmcgc3RvcmUgZm9yIG91ciB1
c2UsIHdlCisJICogY2FuIHByZXBvcHVsYXRlIHRoZSBzaG1lbWZzIGZpbHAgZWZmaWNpZW50bHkg
dXNpbmcgYSB3cml0ZSBpbnRvCisJICogdGhlIHBhZ2VjYWNoZS4gV2UgYXZvaWQgdGhlIHBlbmFs
dHkgb2YgaW5zdGFudGlhdGluZyBhbGwgdGhlCisJICogcGFnZXMsIGltcG9ydGFudCBpZiB0aGUg
dXNlciBpcyBqdXN0IHdyaXRpbmcgdG8gYSBmZXcgYW5kIG5ldmVyCisJICogdXNlcyB0aGUgb2Jq
ZWN0IG9uIHRoZSBHUFUsIGFuZCB1c2luZyBhIGRpcmVjdCB3cml0ZSBpbnRvIHNobWVtZnMKKwkg
KiBhbGxvd3MgaXQgdG8gYXZvaWQgdGhlIGNvc3Qgb2YgcmV0cmlldmluZyBhIHBhZ2UgKGVpdGhl
ciBzd2FwaW4KKwkgKiBvciBjbGVhcmluZy1iZWZvcmUtdXNlKSBiZWZvcmUgaXQgaXMgb3Zlcndy
aXR0ZW4uCisJICovCisJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkKKwkJcmV0
dXJuIC1FTk9ERVY7CisKKwlpZiAob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVFRCkK
KwkJcmV0dXJuIC1FRkFVTFQ7CisKKwkvKgorCSAqIEJlZm9yZSB0aGUgcGFnZXMgYXJlIGluc3Rh
bnRpYXRlZCB0aGUgb2JqZWN0IGlzIHRyZWF0ZWQgYXMgYmVpbmcKKwkgKiBpbiB0aGUgQ1BVIGRv
bWFpbi4gVGhlIHBhZ2VzIHdpbGwgYmUgY2xmbHVzaGVkIGFzIHJlcXVpcmVkIGJlZm9yZQorCSAq
IHVzZSwgYW5kIHdlIGNhbiBmcmVlbHkgd3JpdGUgaW50byB0aGUgcGFnZXMgZGlyZWN0bHkuIElm
IHVzZXJzcGFjZQorCSAqIHJhY2VzIHB3cml0ZSB3aXRoIGFueSBvdGhlciBvcGVyYXRpb247IGNv
cnJ1cHRpb24gd2lsbCBlbnN1ZSAtCisJICogdGhhdCBpcyB1c2Vyc3BhY2UncyBwcmVyb2dhdGl2
ZSEKKwkgKi8KKworCXJlbWFpbiA9IGFyZy0+c2l6ZTsKKwlvZmZzZXQgPSBhcmctPm9mZnNldDsK
KwlwZyA9IG9mZnNldF9pbl9wYWdlKG9mZnNldCk7CisKKwlkbyB7CisJCXVuc2lnbmVkIGludCBs
ZW4sIHVud3JpdHRlbjsKKwkJc3RydWN0IHBhZ2UgKnBhZ2U7CisJCXZvaWQgKmRhdGEsICp2YWRk
cjsKKwkJaW50IGVycjsKKwkJY2hhciBjOworCisJCWxlbiA9IFBBR0VfU0laRSAtIHBnOworCQlp
ZiAobGVuID4gcmVtYWluKQorCQkJbGVuID0gcmVtYWluOworCisJCS8qIFByZWZhdWx0IHRoZSB1
c2VyIHBhZ2UgdG8gcmVkdWNlIHBvdGVudGlhbCByZWN1cnNpb24gKi8KKwkJZXJyID0gX19nZXRf
dXNlcihjLCB1c2VyX2RhdGEpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKworCQllcnIg
PSBfX2dldF91c2VyKGMsIHVzZXJfZGF0YSArIGxlbiAtIDEpOworCQlpZiAoZXJyKQorCQkJcmV0
dXJuIGVycjsKKworCQllcnIgPSBwYWdlY2FjaGVfd3JpdGVfYmVnaW4ob2JqLT5iYXNlLmZpbHAs
IG1hcHBpbmcsCisJCQkJCSAgICBvZmZzZXQsIGxlbiwgMCwKKwkJCQkJICAgICZwYWdlLCAmZGF0
YSk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsKKworCQl2YWRkciA9IGttYXBfYXRv
bWljKHBhZ2UpOworCQl1bndyaXR0ZW4gPSBfX2NvcHlfZnJvbV91c2VyX2luYXRvbWljKHZhZGRy
ICsgcGcsCisJCQkJCQkgICAgICB1c2VyX2RhdGEsCisJCQkJCQkgICAgICBsZW4pOworCQlrdW5t
YXBfYXRvbWljKHZhZGRyKTsKKworCQllcnIgPSBwYWdlY2FjaGVfd3JpdGVfZW5kKG9iai0+YmFz
ZS5maWxwLCBtYXBwaW5nLAorCQkJCQkgIG9mZnNldCwgbGVuLCBsZW4gLSB1bndyaXR0ZW4sCisJ
CQkJCSAgcGFnZSwgZGF0YSk7CisJCWlmIChlcnIgPCAwKQorCQkJcmV0dXJuIGVycjsKKworCQkv
KiBXZSBkb24ndCBoYW5kbGUgLUVGQVVMVCwgbGVhdmUgaXQgdG8gdGhlIGNhbGxlciB0byBjaGVj
ayAqLworCQlpZiAodW53cml0dGVuKQorCQkJcmV0dXJuIC1FTk9ERVY7CisKKwkJcmVtYWluIC09
IGxlbjsKKwkJdXNlcl9kYXRhICs9IGxlbjsKKwkJb2Zmc2V0ICs9IGxlbjsKKwkJcGcgPSAwOwor
CX0gd2hpbGUgKHJlbWFpbik7CisKKwlyZXR1cm4gMDsKK30KKworY29uc3Qgc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3Rfb3BzIGk5MTVfZ2VtX3NobWVtX29wcyA9IHsKKwkuZmxhZ3MgPSBJOTE1
X0dFTV9PQkpFQ1RfSEFTX1NUUlVDVF9QQUdFIHwKKwkJIEk5MTVfR0VNX09CSkVDVF9JU19TSFJJ
TktBQkxFLAorCisJLmdldF9wYWdlcyA9IHNobWVtX2dldF9wYWdlcywKKwkucHV0X3BhZ2VzID0g
c2htZW1fcHV0X3BhZ2VzLAorCisJLnB3cml0ZSA9IHNobWVtX3B3cml0ZSwKK307CisKK3N0YXRp
YyBpbnQgY3JlYXRlX3NobWVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpvYmosCisJCQlzaXplX3Qgc2l6ZSkKK3sKKwl1bnNpZ25lZCBs
b25nIGZsYWdzID0gVk1fTk9SRVNFUlZFOworCXN0cnVjdCBmaWxlICpmaWxwOworCisJZHJtX2dl
bV9wcml2YXRlX29iamVjdF9pbml0KCZpOTE1LT5kcm0sIG9iaiwgc2l6ZSk7CisKKwlpZiAoaTkx
NS0+bW0uZ2VtZnMpCisJCWZpbHAgPSBzaG1lbV9maWxlX3NldHVwX3dpdGhfbW50KGk5MTUtPm1t
LmdlbWZzLCAiaTkxNSIsIHNpemUsCisJCQkJCQkgZmxhZ3MpOworCWVsc2UKKwkJZmlscCA9IHNo
bWVtX2ZpbGVfc2V0dXAoImk5MTUiLCBzaXplLCBmbGFncyk7CisJaWYgKElTX0VSUihmaWxwKSkK
KwkJcmV0dXJuIFBUUl9FUlIoZmlscCk7CisKKwlvYmotPmZpbHAgPSBmaWxwOworCXJldHVybiAw
OworfQorCitzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqCitpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX3NobWVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1NjQgc2l6ZSkKK3sKKwlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBhZGRyZXNzX3NwYWNlICpt
YXBwaW5nOworCXVuc2lnbmVkIGludCBjYWNoZV9sZXZlbDsKKwlnZnBfdCBtYXNrOworCWludCBy
ZXQ7CisKKwkvKiBUaGVyZSBpcyBhIHByZXZhbGVuY2Ugb2YgdGhlIGFzc3VtcHRpb24gdGhhdCB3
ZSBmaXQgdGhlIG9iamVjdCdzCisJICogcGFnZSBjb3VudCBpbnNpZGUgYSAzMmJpdCBfc2lnbmVk
XyB2YXJpYWJsZS4gTGV0J3MgZG9jdW1lbnQgdGhpcyBhbmQKKwkgKiBjYXRjaCBpZiB3ZSBldmVy
IG5lZWQgdG8gZml4IGl0LiBJbiB0aGUgbWVhbnRpbWUsIGlmIHlvdSBkbyBzcG90CisJICogc3Vj
aCBhIGxvY2FsIHZhcmlhYmxlLCBwbGVhc2UgY29uc2lkZXIgZml4aW5nIQorCSAqLworCWlmIChz
aXplID4+IFBBR0VfU0hJRlQgPiBJTlRfTUFYKQorCQlyZXR1cm4gRVJSX1BUUigtRTJCSUcpOwor
CisJaWYgKG92ZXJmbG93c190eXBlKHNpemUsIG9iai0+YmFzZS5zaXplKSkKKwkJcmV0dXJuIEVS
Ul9QVFIoLUUyQklHKTsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9hbGxvYygpOworCWlmICgh
b2JqKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKworCXJldCA9IGNyZWF0ZV9zaG1lbShp
OTE1LCAmb2JqLT5iYXNlLCBzaXplKTsKKwlpZiAocmV0KQorCQlnb3RvIGZhaWw7CisKKwltYXNr
ID0gR0ZQX0hJR0hVU0VSIHwgX19HRlBfUkVDTEFJTUFCTEU7CisJaWYgKElTX0k5NjVHTShpOTE1
KSB8fCBJU19JOTY1RyhpOTE1KSkgeworCQkvKiA5NjVnbSBjYW5ub3QgcmVsb2NhdGUgb2JqZWN0
cyBhYm92ZSA0R2lCLiAqLworCQltYXNrICY9IH5fX0dGUF9ISUdITUVNOworCQltYXNrIHw9IF9f
R0ZQX0RNQTMyOworCX0KKworCW1hcHBpbmcgPSBvYmotPmJhc2UuZmlscC0+Zl9tYXBwaW5nOwor
CW1hcHBpbmdfc2V0X2dmcF9tYXNrKG1hcHBpbmcsIG1hc2spOworCUdFTV9CVUdfT04oIShtYXBw
aW5nX2dmcF9tYXNrKG1hcHBpbmcpICYgX19HRlBfUkVDTEFJTSkpOworCisJaTkxNV9nZW1fb2Jq
ZWN0X2luaXQob2JqLCAmaTkxNV9nZW1fc2htZW1fb3BzKTsKKworCW9iai0+d3JpdGVfZG9tYWlu
ID0gSTkxNV9HRU1fRE9NQUlOX0NQVTsKKwlvYmotPnJlYWRfZG9tYWlucyA9IEk5MTVfR0VNX0RP
TUFJTl9DUFU7CisKKwlpZiAoSEFTX0xMQyhpOTE1KSkKKwkJLyogT24gc29tZSBkZXZpY2VzLCB3
ZSBjYW4gaGF2ZSB0aGUgR1BVIHVzZSB0aGUgTExDICh0aGUgQ1BVCisJCSAqIGNhY2hlKSBmb3Ig
YWJvdXQgYSAxMCUgcGVyZm9ybWFuY2UgaW1wcm92ZW1lbnQKKwkJICogY29tcGFyZWQgdG8gdW5j
YWNoZWQuICBHcmFwaGljcyByZXF1ZXN0cyBvdGhlciB0aGFuCisJCSAqIGRpc3BsYXkgc2Nhbm91
dCBhcmUgY29oZXJlbnQgd2l0aCB0aGUgQ1BVIGluCisJCSAqIGFjY2Vzc2luZyB0aGlzIGNhY2hl
LiAgVGhpcyBtZWFucyBpbiB0aGlzIG1vZGUgd2UKKwkJICogZG9uJ3QgbmVlZCB0byBjbGZsdXNo
IG9uIHRoZSBDUFUgc2lkZSwgYW5kIG9uIHRoZQorCQkgKiBHUFUgc2lkZSB3ZSBvbmx5IG5lZWQg
dG8gZmx1c2ggaW50ZXJuYWwgY2FjaGVzIHRvCisJCSAqIGdldCBkYXRhIHZpc2libGUgdG8gdGhl
IENQVS4KKwkJICoKKwkJICogSG93ZXZlciwgd2UgbWFpbnRhaW4gdGhlIGRpc3BsYXkgcGxhbmVz
IGFzIFVDLCBhbmQgc28KKwkJICogbmVlZCB0byByZWJpbmQgd2hlbiBmaXJzdCB1c2VkIGFzIHN1
Y2guCisJCSAqLworCQljYWNoZV9sZXZlbCA9IEk5MTVfQ0FDSEVfTExDOworCWVsc2UKKwkJY2Fj
aGVfbGV2ZWwgPSBJOTE1X0NBQ0hFX05PTkU7CisKKwlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hl
X2NvaGVyZW5jeShvYmosIGNhY2hlX2xldmVsKTsKKworCXRyYWNlX2k5MTVfZ2VtX29iamVjdF9j
cmVhdGUob2JqKTsKKworCXJldHVybiBvYmo7CisKK2ZhaWw6CisJaTkxNV9nZW1fb2JqZWN0X2Zy
ZWUob2JqKTsKKwlyZXR1cm4gRVJSX1BUUihyZXQpOworfQorCisvKiBBbGxvY2F0ZSBhIG5ldyBH
RU0gb2JqZWN0IGFuZCBmaWxsIGl0IHdpdGggdGhlIHN1cHBsaWVkIGRhdGEgKi8KK3N0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICoKK2k5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW1fZnJvbV9k
YXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkgICAgICAgY29uc3Qg
dm9pZCAqZGF0YSwgc2l6ZV90IHNpemUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKKwlzdHJ1Y3QgZmlsZSAqZmlsZTsKKwlzaXplX3Qgb2Zmc2V0OworCWludCBlcnI7CisK
KwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCByb3VuZF91cChz
aXplLCBQQUdFX1NJWkUpKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBvYmo7CisKKwlH
RU1fQlVHX09OKG9iai0+d3JpdGVfZG9tYWluICE9IEk5MTVfR0VNX0RPTUFJTl9DUFUpOworCisJ
ZmlsZSA9IG9iai0+YmFzZS5maWxwOworCW9mZnNldCA9IDA7CisJZG8geworCQl1bnNpZ25lZCBp
bnQgbGVuID0gbWluX3QodHlwZW9mKHNpemUpLCBzaXplLCBQQUdFX1NJWkUpOworCQlzdHJ1Y3Qg
cGFnZSAqcGFnZTsKKwkJdm9pZCAqcGdkYXRhLCAqdmFkZHI7CisKKwkJZXJyID0gcGFnZWNhY2hl
X3dyaXRlX2JlZ2luKGZpbGUsIGZpbGUtPmZfbWFwcGluZywKKwkJCQkJICAgIG9mZnNldCwgbGVu
LCAwLAorCQkJCQkgICAgJnBhZ2UsICZwZ2RhdGEpOworCQlpZiAoZXJyIDwgMCkKKwkJCWdvdG8g
ZmFpbDsKKworCQl2YWRkciA9IGttYXAocGFnZSk7CisJCW1lbWNweSh2YWRkciwgZGF0YSwgbGVu
KTsKKwkJa3VubWFwKHBhZ2UpOworCisJCWVyciA9IHBhZ2VjYWNoZV93cml0ZV9lbmQoZmlsZSwg
ZmlsZS0+Zl9tYXBwaW5nLAorCQkJCQkgIG9mZnNldCwgbGVuLCBsZW4sCisJCQkJCSAgcGFnZSwg
cGdkYXRhKTsKKwkJaWYgKGVyciA8IDApCisJCQlnb3RvIGZhaWw7CisKKwkJc2l6ZSAtPSBsZW47
CisJCWRhdGEgKz0gbGVuOworCQlvZmZzZXQgKz0gbGVuOworCX0gd2hpbGUgKHNpemUpOworCisJ
cmV0dXJuIG9iajsKKworZmFpbDoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcmV0dXJu
IEVSUl9QVFIoZXJyKTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggMTNh
OTA0MDRlMGY2Li5kYjBiOTY4N2I5MDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5j
CkBAIC0xOTIxLDcgKzE5MjEsNyBAQCBzdGF0aWMgaW50IGxyY19zZXR1cF93YV9jdHgoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBl
cnI7CiAKLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlKGVuZ2luZS0+aTkxNSwgQ1RYX1dB
X0JCX09CSl9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGVuZ2lu
ZS0+aTkxNSwgQ1RYX1dBX0JCX09CSl9TSVpFKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVy
biBQVFJfRVJSKG9iaik7CiAKQEAgLTMwMTIsNyArMzAxMiw3IEBAIHN0YXRpYyBpbnQgZXhlY2xp
c3RzX2NvbnRleHRfZGVmZXJyZWRfYWxsb2Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCSAq
LwogCWNvbnRleHRfc2l6ZSArPSBMUkNfSEVBREVSX1BBR0VTICogUEFHRV9TSVpFOwogCi0JY3R4
X29iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUoZW5naW5lLT5pOTE1LCBjb250ZXh0X3NpemUp
OworCWN0eF9vYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGVuZ2luZS0+aTkxNSwg
Y29udGV4dF9zaXplKTsKIAlpZiAoSVNfRVJSKGN0eF9vYmopKQogCQlyZXR1cm4gUFRSX0VSUihj
dHhfb2JqKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCmlu
ZGV4IGYwZDYwYWZmZGJhMy4uYWM5MzA4MGJkODYzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfcmluZ2J1ZmZlci5jCkBAIC0xMzk2LDcgKzEzOTYsNyBAQCBhbGxvY19jb250ZXh0
X3ZtYShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3RydWN0IGk5MTVfdm1hICp2
bWE7CiAJaW50IGVycjsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUoaTkxNSwgZW5n
aW5lLT5jb250ZXh0X3NpemUpOworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0o
aTkxNSwgZW5naW5lLT5jb250ZXh0X3NpemUpOwogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJu
IEVSUl9DQVNUKG9iaik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9j
bWRfcGFyc2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCmluZGV4
IDVjYjU5YzBiNGJiZS4uNzU4NGJmMGFlYWE0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvY21kX3BhcnNlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRf
cGFyc2VyLmMKQEAgLTE3MjUsNyArMTcyNSw3IEBAIHN0YXRpYyBpbnQgcGVyZm9ybV9iYl9zaGFk
b3coc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKQogCWludCByZXQgPSAwOwogCXN0cnVjdCBp
bnRlbF92Z3B1X21tICptbSA9IChzLT5idWZfYWRkcl90eXBlID09IEdUVF9CVUZGRVIpID8KIAkJ
cy0+dmdwdS0+Z3R0LmdndHRfbW0gOiBzLT53b3JrbG9hZC0+c2hhZG93X21tOwotCXVuc2lnbmVk
IGxvbmcgZ21hX3N0YXJ0X29mZnNldCA9IDA7CisJdW5zaWduZWQgbG9uZyBzdGFydF9vZmZzZXQg
PSAwOwogCiAJLyogZ2V0IHRoZSBzdGFydCBnbSBhZGRyZXNzIG9mIHRoZSBiYXRjaCBidWZmZXIg
Ki8KIAlnbWEgPSBnZXRfZ21hX2JiX2Zyb21fY21kKHMsIDEpOwpAQCAtMTc0Miw3ICsxNzQyLDcg
QEAgc3RhdGljIGludCBwZXJmb3JtX2JiX3NoYWRvdyhzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUg
KnMpCiAKIAliYi0+cHBndHQgPSAocy0+YnVmX2FkZHJfdHlwZSA9PSBHVFRfQlVGRkVSKSA/IGZh
bHNlIDogdHJ1ZTsKIAotCS8qIHRoZSBnbWFfc3RhcnRfb2Zmc2V0IHN0b3JlcyB0aGUgYmF0Y2gg
YnVmZmVyJ3Mgc3RhcnQgZ21hJ3MKKwkvKiB0aGUgc3RhcnRfb2Zmc2V0IHN0b3JlcyB0aGUgYmF0
Y2ggYnVmZmVyJ3Mgc3RhcnQgZ21hJ3MKIAkgKiBvZmZzZXQgcmVsYXRpdmUgdG8gcGFnZSBib3Vu
ZGFyeS4gc28gZm9yIG5vbi1wcml2aWxlZ2VkIGJhdGNoCiAJICogYnVmZmVyLCB0aGUgc2hhZG93
ZWQgZ2VtIG9iamVjdCBob2xkcyBleGFjdGx5IHRoZSBzYW1lIHBhZ2UKIAkgKiBsYXlvdXQgYXMg
b3JpZ2luYWwgZ2VtIG9iamVjdC4gVGhpcyBpcyBmb3IgdGhlIGNvbnZpZW5jZSBvZgpAQCAtMTc1
NCwxMCArMTc1NCwxMSBAQCBzdGF0aWMgaW50IHBlcmZvcm1fYmJfc2hhZG93KHN0cnVjdCBwYXJz
ZXJfZXhlY19zdGF0ZSAqcykKIAkgKiB0aGF0IG9mIHNoYWRvd2VkIHBhZ2UuCiAJICovCiAJaWYg
KGJiLT5wcGd0dCkKLQkJZ21hX3N0YXJ0X29mZnNldCA9IGdtYSAmIH5JOTE1X0dUVF9QQUdFX01B
U0s7CisJCXN0YXJ0X29mZnNldCA9IGdtYSAmIH5JOTE1X0dUVF9QQUdFX01BU0s7CiAKLQliYi0+
b2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShzLT52Z3B1LT5ndnQtPmRldl9wcml2LAotCQkJ
IHJvdW5kdXAoYmJfc2l6ZSArIGdtYV9zdGFydF9vZmZzZXQsIFBBR0VfU0laRSkpOworCWJiLT5v
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKHMtPnZncHUtPmd2dC0+ZGV2X3ByaXYs
CisJCQkJCSAgICAgICByb3VuZF91cChiYl9zaXplICsgc3RhcnRfb2Zmc2V0LAorCQkJCQkJCVBB
R0VfU0laRSkpOwogCWlmIChJU19FUlIoYmItPm9iaikpIHsKIAkJcmV0ID0gUFRSX0VSUihiYi0+
b2JqKTsKIAkJZ290byBlcnJfZnJlZV9iYjsKQEAgLTE3ODAsNyArMTc4MSw3IEBAIHN0YXRpYyBp
bnQgcGVyZm9ybV9iYl9zaGFkb3coc3RydWN0IHBhcnNlcl9leGVjX3N0YXRlICpzKQogCiAJcmV0
ID0gY29weV9nbWFfdG9faHZhKHMtPnZncHUsIG1tLAogCQkJICAgICAgZ21hLCBnbWEgKyBiYl9z
aXplLAotCQkJICAgICAgYmItPnZhICsgZ21hX3N0YXJ0X29mZnNldCk7CisJCQkgICAgICBiYi0+
dmEgKyBzdGFydF9vZmZzZXQpOwogCWlmIChyZXQgPCAwKSB7CiAJCWd2dF92Z3B1X2VycigiZmFp
bCB0byBjb3B5IGd1ZXN0IHJpbmcgYnVmZmVyXG4iKTsKIAkJcmV0ID0gLUVGQVVMVDsKQEAgLTE4
MDYsNyArMTgwNyw3IEBAIHN0YXRpYyBpbnQgcGVyZm9ybV9iYl9zaGFkb3coc3RydWN0IHBhcnNl
cl9leGVjX3N0YXRlICpzKQogCSAqIGJ1ZmZlcidzIGdtYSBpbiBwYWlyLiBBZnRlciBhbGwsIHdl
IGRvbid0IHdhbnQgdG8gcGluIHRoZSBzaGFkb3cKIAkgKiBidWZmZXIgaGVyZSAodG9vIGVhcmx5
KS4KIAkgKi8KLQlzLT5pcF92YSA9IGJiLT52YSArIGdtYV9zdGFydF9vZmZzZXQ7CisJcy0+aXBf
dmEgPSBiYi0+dmEgKyBzdGFydF9vZmZzZXQ7CiAJcy0+aXBfZ21hID0gZ21hOwogCXJldHVybiAw
OwogZXJyX3VubWFwOgpAQCAtMjgyOSw5ICsyODMwLDkgQEAgc3RhdGljIGludCBzaGFkb3dfaW5k
aXJlY3RfY3R4KHN0cnVjdCBpbnRlbF9zaGFkb3dfd2FfY3R4ICp3YV9jdHgpCiAJaW50IHJldCA9
IDA7CiAJdm9pZCAqbWFwOwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZSh3b3JrbG9h
ZC0+dmdwdS0+Z3Z0LT5kZXZfcHJpdiwKLQkJCQkgICAgIHJvdW5kdXAoY3R4X3NpemUgKyBDQUNI
RUxJTkVfQllURVMsCi0JCQkJCSAgICAgUEFHRV9TSVpFKSk7CisJb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zaG1lbSh3b3JrbG9hZC0+dmdwdS0+Z3Z0LT5kZXZfcHJpdiwKKwkJCQkJICAg
cm91bmR1cChjdHhfc2l6ZSArIENBQ0hFTElORV9CWVRFUywKKwkJCQkJCSAgIFBBR0VfU0laRSkp
OwogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmgKaW5kZXggYjU2YzU1ODNmOTMzLi5hNTQxYTUyNDM5NmYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuaApAQCAtMjc1MCwxNiArMjc1MCw2IEBAIHZvaWQgaTkxNV9nZW1fbG9hZF9p
bml0X2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IGk5MTVf
Z2VtX2ZyZWV6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IGk5MTVf
Z2VtX2ZyZWV6ZV9sYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiAKLXZv
aWQgaTkxNV9nZW1fb2JqZWN0X2luaXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
LQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgKm9wcyk7Ci1zdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqCi1pOTE1X2dlbV9vYmplY3RfY3JlYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHNpemUpOwotc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKgotaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9mcm9tX2RhdGEoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAotCQkJCSBjb25zdCB2b2lkICpkYXRhLCBzaXplX3Qgc2l6ZSk7
Ci12b2lkIGk5MTVfZ2VtX2Nsb3NlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbSwg
c3RydWN0IGRybV9maWxlICpmaWxlKTsKLXZvaWQgaTkxNV9nZW1fZnJlZV9vYmplY3Qoc3RydWN0
IGRybV9nZW1fb2JqZWN0ICpvYmopOwotCiBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9nZW1fZHJh
aW5fZnJlZWRfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpZiAo
IWF0b21pY19yZWFkKCZpOTE1LT5tbS5mcmVlX2NvdW50KSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
CmluZGV4IGQ3NWIwNWYxNDk5NC4uZjAyYTUwOTk5YTdkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
LmMKQEAgLTU4LDE5ICs1OCw2IEBACiAjaW5jbHVkZSAiaW50ZWxfZnJvbnRidWZmZXIuaCIKICNp
bmNsdWRlICJpbnRlbF9wbS5oIgogCi1zdGF0aWMgdm9pZCBpOTE1X2dlbV9mbHVzaF9mcmVlX29i
amVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwotCi1zdGF0aWMgYm9vbCBjcHVf
d3JpdGVfbmVlZHNfY2xmbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewot
CWlmIChvYmotPmNhY2hlX2RpcnR5KQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlpZiAoIShvYmotPmNh
Y2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfV1JJVEUpKQotCQlyZXR1
cm4gdHJ1ZTsKLQotCXJldHVybiBvYmotPnBpbl9nbG9iYWw7IC8qIGN1cnJlbnRseSBpbiB1c2Ug
YnkgSFcsIGtlZXAgZmx1c2hlZCAqLwotfQotCiBzdGF0aWMgaW50CiBpbnNlcnRfbWFwcGFibGVf
bm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LAogICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGRybV9tbV9ub2RlICpub2RlLCB1MzIgc2l6ZSkKQEAgLTg4LDI1ICs3NSw2IEBAIHJlbW92ZV9t
YXBwYWJsZV9ub2RlKHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKIAlkcm1fbW1fcmVtb3ZlX25v
ZGUobm9kZSk7CiB9CiAKLS8qIHNvbWUgYm9va2tlZXBpbmcgKi8KLXN0YXRpYyB2b2lkIGk5MTVf
Z2VtX2luZm9fYWRkX29iaihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJ
ICB1NjQgc2l6ZSkKLXsKLQlzcGluX2xvY2soJmRldl9wcml2LT5tbS5vYmplY3Rfc3RhdF9sb2Nr
KTsKLQlkZXZfcHJpdi0+bW0ub2JqZWN0X2NvdW50Kys7Ci0JZGV2X3ByaXYtPm1tLm9iamVjdF9t
ZW1vcnkgKz0gc2l6ZTsKLQlzcGluX3VubG9jaygmZGV2X3ByaXYtPm1tLm9iamVjdF9zdGF0X2xv
Y2spOwotfQotCi1zdGF0aWMgdm9pZCBpOTE1X2dlbV9pbmZvX3JlbW92ZV9vYmooc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJCSAgICAgdTY0IHNpemUpCi17Ci0Jc3Bpbl9s
b2NrKCZkZXZfcHJpdi0+bW0ub2JqZWN0X3N0YXRfbG9jayk7Ci0JZGV2X3ByaXYtPm1tLm9iamVj
dF9jb3VudC0tOwotCWRldl9wcml2LT5tbS5vYmplY3RfbWVtb3J5IC09IHNpemU7Ci0Jc3Bpbl91
bmxvY2soJmRldl9wcml2LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKLX0KLQogaW50CiBpOTE1X2dl
bV9nZXRfYXBlcnR1cmVfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
IAkJCSAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCkBAIC0yMDcsMzIgKzE3NSw2IEBAIHN0YXRp
YyBpbnQgaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlc19waHlzKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIHZvaWQgX19zdGFydF9jcHVf
d3JpdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlvYmotPnJlYWRfZG9t
YWlucyA9IEk5MTVfR0VNX0RPTUFJTl9DUFU7Ci0Jb2JqLT53cml0ZV9kb21haW4gPSBJOTE1X0dF
TV9ET01BSU5fQ1BVOwotCWlmIChjcHVfd3JpdGVfbmVlZHNfY2xmbHVzaChvYmopKQotCQlvYmot
PmNhY2hlX2RpcnR5ID0gdHJ1ZTsKLX0KLQotdm9pZAotX19pOTE1X2dlbV9vYmplY3RfcmVsZWFz
ZV9zaG1lbShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCXN0cnVjdCBzZ190
YWJsZSAqcGFnZXMsCi0JCQkJYm9vbCBuZWVkc19jbGZsdXNoKQotewotCUdFTV9CVUdfT04ob2Jq
LT5tbS5tYWR2ID09IF9fSTkxNV9NQURWX1BVUkdFRCk7Ci0KLQlpZiAob2JqLT5tbS5tYWR2ID09
IEk5MTVfTUFEVl9ET05UTkVFRCkKLQkJb2JqLT5tbS5kaXJ0eSA9IGZhbHNlOwotCi0JaWYgKG5l
ZWRzX2NsZmx1c2ggJiYKLQkgICAgKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlO
X0NQVSkgPT0gMCAmJgotCSAgICAhKG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hF
X0NPSEVSRU5UX0ZPUl9SRUFEKSkKLQkJZHJtX2NsZmx1c2hfc2cocGFnZXMpOwotCi0JX19zdGFy
dF9jcHVfd3JpdGUob2JqKTsKLX0KLQogc3RhdGljIHZvaWQKIGk5MTVfZ2VtX29iamVjdF9wdXRf
cGFnZXNfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJICAgICAgIHN0
cnVjdCBzZ190YWJsZSAqcGFnZXMpCkBAIC0yODQsOCArMjI2LDYgQEAgc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0X29wcyBpOTE1X2dlbV9waHlzX29wcyA9IHsKIAkucmVs
ZWFzZSA9IGk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3BoeXMsCiB9OwogCi1zdGF0aWMgY29uc3Qg
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3BzIGk5MTVfZ2VtX29iamVjdF9vcHM7Ci0KIGlu
dCBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiB7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CkBAIC01NDIsNyArNDgyLDcgQEAgaTkxNV9nZW1f
Y3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJcmV0dXJuIC1FSU5WQUw7CiAKIAkvKiBB
bGxvY2F0ZSB0aGUgbmV3IG9iamVjdCAqLwotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUo
ZGV2X3ByaXYsIHNpemUpOworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oZGV2
X3ByaXYsIHNpemUpOwogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsK
IApAQCAtMjA4OSw1MiArMjAyOSw2IEBAIHZvaWQgX19pOTE1X2dlbV9vYmplY3RfdHJ1bmNhdGUo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlvYmotPm1tLnBhZ2VzID0gRVJSX1BU
UigtRUZBVUxUKTsKIH0KIAotLyoKLSAqIE1vdmUgcGFnZXMgdG8gYXBwcm9wcmlhdGUgbHJ1IGFu
ZCByZWxlYXNlIHRoZSBwYWdldmVjLCBkZWNyZW1lbnRpbmcgdGhlCi0gKiByZWYgY291bnQgb2Yg
dGhvc2UgcGFnZXMuCi0gKi8KLXN0YXRpYyB2b2lkIGNoZWNrX3JlbGVhc2VfcGFnZXZlYyhzdHJ1
Y3QgcGFnZXZlYyAqcHZlYykKLXsKLQljaGVja19tb3ZlX3VuZXZpY3RhYmxlX3BhZ2VzKHB2ZWMp
OwotCV9fcGFnZXZlY19yZWxlYXNlKHB2ZWMpOwotCWNvbmRfcmVzY2hlZCgpOwotfQotCi1zdGF0
aWMgdm9pZAotaTkxNV9nZW1fb2JqZWN0X3B1dF9wYWdlc19ndHQoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKLQkJCSAgICAgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMpCi17Ci0Jc3Ry
dWN0IHNndF9pdGVyIHNndF9pdGVyOwotCXN0cnVjdCBwYWdldmVjIHB2ZWM7Ci0Jc3RydWN0IHBh
Z2UgKnBhZ2U7Ci0KLQlfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3NobWVtKG9iaiwgcGFnZXMs
IHRydWUpOwotCWk5MTVfZ2VtX2d0dF9maW5pc2hfcGFnZXMob2JqLCBwYWdlcyk7Ci0KLQlpZiAo
aTkxNV9nZW1fb2JqZWN0X25lZWRzX2JpdDE3X3N3aXp6bGUob2JqKSkKLQkJaTkxNV9nZW1fb2Jq
ZWN0X3NhdmVfYml0XzE3X3N3aXp6bGUob2JqLCBwYWdlcyk7Ci0KLQltYXBwaW5nX2NsZWFyX3Vu
ZXZpY3RhYmxlKGZpbGVfaW5vZGUob2JqLT5iYXNlLmZpbHApLT5pX21hcHBpbmcpOwotCi0JcGFn
ZXZlY19pbml0KCZwdmVjKTsKLQlmb3JfZWFjaF9zZ3RfcGFnZShwYWdlLCBzZ3RfaXRlciwgcGFn
ZXMpIHsKLQkJaWYgKG9iai0+bW0uZGlydHkpCi0JCQlzZXRfcGFnZV9kaXJ0eShwYWdlKTsKLQot
CQlpZiAob2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9XSUxMTkVFRCkKLQkJCW1hcmtfcGFnZV9h
Y2Nlc3NlZChwYWdlKTsKLQotCQlpZiAoIXBhZ2V2ZWNfYWRkKCZwdmVjLCBwYWdlKSkKLQkJCWNo
ZWNrX3JlbGVhc2VfcGFnZXZlYygmcHZlYyk7Ci0JfQotCWlmIChwYWdldmVjX2NvdW50KCZwdmVj
KSkKLQkJY2hlY2tfcmVsZWFzZV9wYWdldmVjKCZwdmVjKTsKLQlvYmotPm1tLmRpcnR5ID0gZmFs
c2U7Ci0KLQlzZ19mcmVlX3RhYmxlKHBhZ2VzKTsKLQlrZnJlZShwYWdlcyk7Ci19Ci0KIHN0YXRp
YyB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X3Jlc2V0X3BhZ2VfaXRlcihzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCByYWRpeF90cmVlX2l0ZXIgaXRlcjsKQEAgLTIy
NTAsMTk2ICsyMTQ0LDYgQEAgYm9vbCBpOTE1X3NnX3RyaW0oc3RydWN0IHNnX3RhYmxlICpvcmln
X3N0KQogCXJldHVybiB0cnVlOwogfQogCi1zdGF0aWMgaW50IGk5MTVfZ2VtX29iamVjdF9nZXRf
cGFnZXNfZ3R0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKLQljb25z
dCB1bnNpZ25lZCBsb25nIHBhZ2VfY291bnQgPSBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRTsK
LQl1bnNpZ25lZCBsb25nIGk7Ci0Jc3RydWN0IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmc7Ci0Jc3Ry
dWN0IHNnX3RhYmxlICpzdDsKLQlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnOwotCXN0cnVjdCBzZ3Rf
aXRlciBzZ3RfaXRlcjsKLQlzdHJ1Y3QgcGFnZSAqcGFnZTsKLQl1bnNpZ25lZCBsb25nIGxhc3Rf
cGZuID0gMDsJLyogc3VwcHJlc3MgZ2NjIHdhcm5pbmcgKi8KLQl1bnNpZ25lZCBpbnQgbWF4X3Nl
Z21lbnQgPSBpOTE1X3NnX3NlZ21lbnRfc2l6ZSgpOwotCXVuc2lnbmVkIGludCBzZ19wYWdlX3Np
emVzOwotCXN0cnVjdCBwYWdldmVjIHB2ZWM7Ci0JZ2ZwX3Qgbm9yZWNsYWltOwotCWludCByZXQ7
Ci0KLQkvKgotCSAqIEFzc2VydCB0aGF0IHRoZSBvYmplY3QgaXMgbm90IGN1cnJlbnRseSBpbiBh
bnkgR1BVIGRvbWFpbi4gQXMgaXQKLQkgKiB3YXNuJ3QgaW4gdGhlIEdUVCwgdGhlcmUgc2hvdWxk
bid0IGJlIGFueSB3YXkgaXQgY291bGQgaGF2ZSBiZWVuIGluCi0JICogYSBHUFUgY2FjaGUKLQkg
Ki8KLQlHRU1fQlVHX09OKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1fR1BVX0RPTUFJTlMp
OwotCUdFTV9CVUdfT04ob2JqLT53cml0ZV9kb21haW4gJiBJOTE1X0dFTV9HUFVfRE9NQUlOUyk7
Ci0KLQkvKgotCSAqIElmIHRoZXJlJ3Mgbm8gY2hhbmNlIG9mIGFsbG9jYXRpbmcgZW5vdWdoIHBh
Z2VzIGZvciB0aGUgd2hvbGUKLQkgKiBvYmplY3QsIGJhaWwgZWFybHkuCi0JICovCi0JaWYgKHBh
Z2VfY291bnQgPiB0b3RhbHJhbV9wYWdlcygpKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXN0ID0g
a21hbGxvYyhzaXplb2YoKnN0KSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKHN0ID09IE5VTEwpCi0JCXJl
dHVybiAtRU5PTUVNOwotCi1yZWJ1aWxkX3N0OgotCWlmIChzZ19hbGxvY190YWJsZShzdCwgcGFn
ZV9jb3VudCwgR0ZQX0tFUk5FTCkpIHsKLQkJa2ZyZWUoc3QpOwotCQlyZXR1cm4gLUVOT01FTTsK
LQl9Ci0KLQkvKgotCSAqIEdldCB0aGUgbGlzdCBvZiBwYWdlcyBvdXQgb2Ygb3VyIHN0cnVjdCBm
aWxlLiAgVGhleSdsbCBiZSBwaW5uZWQKLQkgKiBhdCB0aGlzIHBvaW50IHVudGlsIHdlIHJlbGVh
c2UgdGhlbS4KLQkgKgotCSAqIEZhaWwgc2lsZW50bHkgd2l0aG91dCBzdGFydGluZyB0aGUgc2hy
aW5rZXIKLQkgKi8KLQltYXBwaW5nID0gb2JqLT5iYXNlLmZpbHAtPmZfbWFwcGluZzsKLQltYXBw
aW5nX3NldF91bmV2aWN0YWJsZShtYXBwaW5nKTsKLQlub3JlY2xhaW0gPSBtYXBwaW5nX2dmcF9j
b25zdHJhaW50KG1hcHBpbmcsIH5fX0dGUF9SRUNMQUlNKTsKLQlub3JlY2xhaW0gfD0gX19HRlBf
Tk9SRVRSWSB8IF9fR0ZQX05PV0FSTjsKLQotCXNnID0gc3QtPnNnbDsKLQlzdC0+bmVudHMgPSAw
OwotCXNnX3BhZ2Vfc2l6ZXMgPSAwOwotCWZvciAoaSA9IDA7IGkgPCBwYWdlX2NvdW50OyBpKysp
IHsKLQkJY29uc3QgdW5zaWduZWQgaW50IHNocmlua1tdID0gewotCQkJSTkxNV9TSFJJTktfQk9V
TkQgfCBJOTE1X1NIUklOS19VTkJPVU5EIHwgSTkxNV9TSFJJTktfUFVSR0VBQkxFLAotCQkJMCwK
LQkJfSwgKnMgPSBzaHJpbms7Ci0JCWdmcF90IGdmcCA9IG5vcmVjbGFpbTsKLQotCQlkbyB7Ci0J
CQljb25kX3Jlc2NoZWQoKTsKLQkJCXBhZ2UgPSBzaG1lbV9yZWFkX21hcHBpbmdfcGFnZV9nZnAo
bWFwcGluZywgaSwgZ2ZwKTsKLQkJCWlmICghSVNfRVJSKHBhZ2UpKQotCQkJCWJyZWFrOwotCi0J
CQlpZiAoISpzKSB7Ci0JCQkJcmV0ID0gUFRSX0VSUihwYWdlKTsKLQkJCQlnb3RvIGVycl9zZzsK
LQkJCX0KLQotCQkJaTkxNV9nZW1fc2hyaW5rKGRldl9wcml2LCAyICogcGFnZV9jb3VudCwgTlVM
TCwgKnMrKyk7Ci0KLQkJCS8qCi0JCQkgKiBXZSd2ZSB0cmllZCBoYXJkIHRvIGFsbG9jYXRlIHRo
ZSBtZW1vcnkgYnkgcmVhcGluZwotCQkJICogb3VyIG93biBidWZmZXIsIG5vdyBsZXQgdGhlIHJl
YWwgVk0gZG8gaXRzIGpvYiBhbmQKLQkJCSAqIGdvIGRvd24gaW4gZmxhbWVzIGlmIHRydWx5IE9P
TS4KLQkJCSAqCi0JCQkgKiBIb3dldmVyLCBzaW5jZSBncmFwaGljcyB0ZW5kIHRvIGJlIGRpc3Bv
c2FibGUsCi0JCQkgKiBkZWZlciB0aGUgb29tIGhlcmUgYnkgcmVwb3J0aW5nIHRoZSBFTk9NRU0g
YmFjawotCQkJICogdG8gdXNlcnNwYWNlLgotCQkJICovCi0JCQlpZiAoISpzKSB7Ci0JCQkJLyog
cmVjbGFpbSBhbmQgd2FybiwgYnV0IG5vIG9vbSAqLwotCQkJCWdmcCA9IG1hcHBpbmdfZ2ZwX21h
c2sobWFwcGluZyk7Ci0KLQkJCQkvKgotCQkJCSAqIE91ciBibyBhcmUgYWx3YXlzIGRpcnR5IGFu
ZCBzbyB3ZSByZXF1aXJlCi0JCQkJICoga3N3YXBkIHRvIHJlY2xhaW0gb3VyIHBhZ2VzIChkaXJl
Y3QgcmVjbGFpbQotCQkJCSAqIGRvZXMgbm90IGVmZmVjdGl2ZWx5IGJlZ2luIHBhZ2VvdXQgb2Yg
b3VyCi0JCQkJICogYnVmZmVycyBvbiBpdHMgb3duKS4gSG93ZXZlciwgZGlyZWN0IHJlY2xhaW0K
LQkJCQkgKiBvbmx5IHdhaXRzIGZvciBrc3dhcGQgd2hlbiB1bmRlciBhbGxvY2F0aW9uCi0JCQkJ
ICogY29uZ2VzdGlvbi4gU28gYXMgYSByZXN1bHQgX19HRlBfUkVDTEFJTSBpcwotCQkJCSAqIHVu
cmVsaWFibGUgYW5kIGZhaWxzIHRvIGFjdHVhbGx5IHJlY2xhaW0gb3VyCi0JCQkJICogZGlydHkg
cGFnZXMgLS0gdW5sZXNzIHlvdSB0cnkgb3ZlciBhbmQgb3ZlcgotCQkJCSAqIGFnYWluIHdpdGgg
IV9fR0ZQX05PUkVUUlkuIEhvd2V2ZXIsIHdlIHN0aWxsCi0JCQkJICogd2FudCB0byBmYWlsIHRo
aXMgYWxsb2NhdGlvbiByYXRoZXIgdGhhbgotCQkJCSAqIHRyaWdnZXIgdGhlIG91dC1vZi1tZW1v
cnkga2lsbGVyIGFuZCBmb3IKLQkJCQkgKiB0aGlzIHdlIHdhbnQgX19HRlBfUkVUUllfTUFZRkFJ
TC4KLQkJCQkgKi8KLQkJCQlnZnAgfD0gX19HRlBfUkVUUllfTUFZRkFJTDsKLQkJCX0KLQkJfSB3
aGlsZSAoMSk7Ci0KLQkJaWYgKCFpIHx8Ci0JCSAgICBzZy0+bGVuZ3RoID49IG1heF9zZWdtZW50
IHx8Ci0JCSAgICBwYWdlX3RvX3BmbihwYWdlKSAhPSBsYXN0X3BmbiArIDEpIHsKLQkJCWlmIChp
KSB7Ci0JCQkJc2dfcGFnZV9zaXplcyB8PSBzZy0+bGVuZ3RoOwotCQkJCXNnID0gc2dfbmV4dChz
Zyk7Ci0JCQl9Ci0JCQlzdC0+bmVudHMrKzsKLQkJCXNnX3NldF9wYWdlKHNnLCBwYWdlLCBQQUdF
X1NJWkUsIDApOwotCQl9IGVsc2UgewotCQkJc2ctPmxlbmd0aCArPSBQQUdFX1NJWkU7Ci0JCX0K
LQkJbGFzdF9wZm4gPSBwYWdlX3RvX3BmbihwYWdlKTsKLQotCQkvKiBDaGVjayB0aGF0IHRoZSBp
OTY1Zy9nbSB3b3JrYXJvdW5kIHdvcmtzLiAqLwotCQlXQVJOX09OKChnZnAgJiBfX0dGUF9ETUEz
MikgJiYgKGxhc3RfcGZuID49IDB4MDAxMDAwMDBVTCkpOwotCX0KLQlpZiAoc2cpIHsgLyogbG9v
cCB0ZXJtaW5hdGVkIGVhcmx5OyBzaG9ydCBzZyB0YWJsZSAqLwotCQlzZ19wYWdlX3NpemVzIHw9
IHNnLT5sZW5ndGg7Ci0JCXNnX21hcmtfZW5kKHNnKTsKLQl9Ci0KLQkvKiBUcmltIHVudXNlZCBz
ZyBlbnRyaWVzIHRvIGF2b2lkIHdhc3RpbmcgbWVtb3J5LiAqLwotCWk5MTVfc2dfdHJpbShzdCk7
Ci0KLQlyZXQgPSBpOTE1X2dlbV9ndHRfcHJlcGFyZV9wYWdlcyhvYmosIHN0KTsKLQlpZiAocmV0
KSB7Ci0JCS8qCi0JCSAqIERNQSByZW1hcHBpbmcgZmFpbGVkPyBPbmUgcG9zc2libGUgY2F1c2Ug
aXMgdGhhdAotCQkgKiBpdCBjb3VsZCBub3QgcmVzZXJ2ZSBlbm91Z2ggbGFyZ2UgZW50cmllcywg
YXNraW5nCi0JCSAqIGZvciBQQUdFX1NJWkUgY2h1bmtzIGluc3RlYWQgbWF5IGJlIGhlbHBmdWwu
Ci0JCSAqLwotCQlpZiAobWF4X3NlZ21lbnQgPiBQQUdFX1NJWkUpIHsKLQkJCWZvcl9lYWNoX3Nn
dF9wYWdlKHBhZ2UsIHNndF9pdGVyLCBzdCkKLQkJCQlwdXRfcGFnZShwYWdlKTsKLQkJCXNnX2Zy
ZWVfdGFibGUoc3QpOwotCi0JCQltYXhfc2VnbWVudCA9IFBBR0VfU0laRTsKLQkJCWdvdG8gcmVi
dWlsZF9zdDsKLQkJfSBlbHNlIHsKLQkJCWRldl93YXJuKCZkZXZfcHJpdi0+ZHJtLnBkZXYtPmRl
diwKLQkJCQkgIkZhaWxlZCB0byBETUEgcmVtYXAgJWx1IHBhZ2VzXG4iLAotCQkJCSBwYWdlX2Nv
dW50KTsKLQkJCWdvdG8gZXJyX3BhZ2VzOwotCQl9Ci0JfQotCi0JaWYgKGk5MTVfZ2VtX29iamVj
dF9uZWVkc19iaXQxN19zd2l6emxlKG9iaikpCi0JCWk5MTVfZ2VtX29iamVjdF9kb19iaXRfMTdf
c3dpenpsZShvYmosIHN0KTsKLQotCV9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhvYmosIHN0
LCBzZ19wYWdlX3NpemVzKTsKLQotCXJldHVybiAwOwotCi1lcnJfc2c6Ci0Jc2dfbWFya19lbmQo
c2cpOwotZXJyX3BhZ2VzOgotCW1hcHBpbmdfY2xlYXJfdW5ldmljdGFibGUobWFwcGluZyk7Ci0J
cGFnZXZlY19pbml0KCZwdmVjKTsKLQlmb3JfZWFjaF9zZ3RfcGFnZShwYWdlLCBzZ3RfaXRlciwg
c3QpIHsKLQkJaWYgKCFwYWdldmVjX2FkZCgmcHZlYywgcGFnZSkpCi0JCQljaGVja19yZWxlYXNl
X3BhZ2V2ZWMoJnB2ZWMpOwotCX0KLQlpZiAocGFnZXZlY19jb3VudCgmcHZlYykpCi0JCWNoZWNr
X3JlbGVhc2VfcGFnZXZlYygmcHZlYyk7Ci0Jc2dfZnJlZV90YWJsZShzdCk7Ci0Ja2ZyZWUoc3Qp
OwotCi0JLyoKLQkgKiBzaG1lbWZzIGZpcnN0IGNoZWNrcyBpZiB0aGVyZSBpcyBlbm91Z2ggbWVt
b3J5IHRvIGFsbG9jYXRlIHRoZSBwYWdlCi0JICogYW5kIHJlcG9ydHMgRU5PU1BDIHNob3VsZCB0
aGVyZSBiZSBpbnN1ZmZpY2llbnQsIGFsb25nIHdpdGggdGhlIHVzdWFsCi0JICogRU5PTUVNIGZv
ciBhIGdlbnVpbmUgYWxsb2NhdGlvbiBmYWlsdXJlLgotCSAqCi0JICogV2UgdXNlIEVOT1NQQyBp
biBvdXIgZHJpdmVyIHRvIG1lYW4gdGhhdCB3ZSBoYXZlIHJ1biBvdXQgb2YgYXBlcnR1cmUKLQkg
KiBzcGFjZSBhbmQgc28gd2FudCB0byB0cmFuc2xhdGUgdGhlIGVycm9yIGZyb20gc2htZW1mcyBi
YWNrIHRvIG91cgotCSAqIHVzdWFsIHVuZGVyc3RhbmRpbmcgb2YgRU5PTUVNLgotCSAqLwotCWlm
IChyZXQgPT0gLUVOT1NQQykKLQkJcmV0ID0gLUVOT01FTTsKLQotCXJldHVybiByZXQ7Ci19Ci0K
IHZvaWQgX19pOTE1X2dlbV9vYmplY3Rfc2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCiAJCQkJIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMsCiAJCQkJIHVuc2lnbmVkIGlu
dCBzZ19wYWdlX3NpemVzKQpAQCAtMjY4NiwxMzMgKzIzOTAsNiBAQCB2b2lkIF9faTkxNV9nZW1f
b2JqZWN0X2ZsdXNoX21hcChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0KIH0K
IAotc3RhdGljIGludAotaTkxNV9nZW1fb2JqZWN0X3B3cml0ZV9ndHQoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiwKLQkJCSAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fcHdyaXRl
ICphcmcpCi17Ci0Jc3RydWN0IGFkZHJlc3Nfc3BhY2UgKm1hcHBpbmcgPSBvYmotPmJhc2UuZmls
cC0+Zl9tYXBwaW5nOwotCWNoYXIgX191c2VyICp1c2VyX2RhdGEgPSB1NjRfdG9fdXNlcl9wdHIo
YXJnLT5kYXRhX3B0cik7Ci0JdTY0IHJlbWFpbiwgb2Zmc2V0OwotCXVuc2lnbmVkIGludCBwZzsK
LQotCS8qIENhbGxlciBhbHJlYWR5IHZhbGlkYXRlZCB1c2VyIGFyZ3MgKi8KLQlHRU1fQlVHX09O
KCFhY2Nlc3Nfb2sodXNlcl9kYXRhLCBhcmctPnNpemUpKTsKLQotCS8qCi0JICogQmVmb3JlIHdl
IGluc3RhbnRpYXRlL3BpbiB0aGUgYmFja2luZyBzdG9yZSBmb3Igb3VyIHVzZSwgd2UKLQkgKiBj
YW4gcHJlcG9wdWxhdGUgdGhlIHNobWVtZnMgZmlscCBlZmZpY2llbnRseSB1c2luZyBhIHdyaXRl
IGludG8KLQkgKiB0aGUgcGFnZWNhY2hlLiBXZSBhdm9pZCB0aGUgcGVuYWx0eSBvZiBpbnN0YW50
aWF0aW5nIGFsbCB0aGUKLQkgKiBwYWdlcywgaW1wb3J0YW50IGlmIHRoZSB1c2VyIGlzIGp1c3Qg
d3JpdGluZyB0byBhIGZldyBhbmQgbmV2ZXIKLQkgKiB1c2VzIHRoZSBvYmplY3Qgb24gdGhlIEdQ
VSwgYW5kIHVzaW5nIGEgZGlyZWN0IHdyaXRlIGludG8gc2htZW1mcwotCSAqIGFsbG93cyBpdCB0
byBhdm9pZCB0aGUgY29zdCBvZiByZXRyaWV2aW5nIGEgcGFnZSAoZWl0aGVyIHN3YXBpbgotCSAq
IG9yIGNsZWFyaW5nLWJlZm9yZS11c2UpIGJlZm9yZSBpdCBpcyBvdmVyd3JpdHRlbi4KLQkgKi8K
LQlpZiAoaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKQotCQlyZXR1cm4gLUVOT0RFVjsK
LQotCWlmIChvYmotPm1tLm1hZHYgIT0gSTkxNV9NQURWX1dJTExORUVEKQotCQlyZXR1cm4gLUVG
QVVMVDsKLQotCS8qCi0JICogQmVmb3JlIHRoZSBwYWdlcyBhcmUgaW5zdGFudGlhdGVkIHRoZSBv
YmplY3QgaXMgdHJlYXRlZCBhcyBiZWluZwotCSAqIGluIHRoZSBDUFUgZG9tYWluLiBUaGUgcGFn
ZXMgd2lsbCBiZSBjbGZsdXNoZWQgYXMgcmVxdWlyZWQgYmVmb3JlCi0JICogdXNlLCBhbmQgd2Ug
Y2FuIGZyZWVseSB3cml0ZSBpbnRvIHRoZSBwYWdlcyBkaXJlY3RseS4gSWYgdXNlcnNwYWNlCi0J
ICogcmFjZXMgcHdyaXRlIHdpdGggYW55IG90aGVyIG9wZXJhdGlvbjsgY29ycnVwdGlvbiB3aWxs
IGVuc3VlIC0KLQkgKiB0aGF0IGlzIHVzZXJzcGFjZSdzIHByZXJvZ2F0aXZlIQotCSAqLwotCi0J
cmVtYWluID0gYXJnLT5zaXplOwotCW9mZnNldCA9IGFyZy0+b2Zmc2V0OwotCXBnID0gb2Zmc2V0
X2luX3BhZ2Uob2Zmc2V0KTsKLQotCWRvIHsKLQkJdW5zaWduZWQgaW50IGxlbiwgdW53cml0dGVu
OwotCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKLQkJdm9pZCAqZGF0YSwgKnZhZGRyOwotCQlpbnQgZXJy
OwotCQljaGFyIGM7Ci0KLQkJbGVuID0gUEFHRV9TSVpFIC0gcGc7Ci0JCWlmIChsZW4gPiByZW1h
aW4pCi0JCQlsZW4gPSByZW1haW47Ci0KLQkJLyogUHJlZmF1bHQgdGhlIHVzZXIgcGFnZSB0byBy
ZWR1Y2UgcG90ZW50aWFsIHJlY3Vyc2lvbiAqLwotCQllcnIgPSBfX2dldF91c2VyKGMsIHVzZXJf
ZGF0YSk7Ci0JCWlmIChlcnIpCi0JCQlyZXR1cm4gZXJyOwotCi0JCWVyciA9IF9fZ2V0X3VzZXIo
YywgdXNlcl9kYXRhICsgbGVuIC0gMSk7Ci0JCWlmIChlcnIpCi0JCQlyZXR1cm4gZXJyOwotCi0J
CWVyciA9IHBhZ2VjYWNoZV93cml0ZV9iZWdpbihvYmotPmJhc2UuZmlscCwgbWFwcGluZywKLQkJ
CQkJICAgIG9mZnNldCwgbGVuLCAwLAotCQkJCQkgICAgJnBhZ2UsICZkYXRhKTsKLQkJaWYgKGVy
ciA8IDApCi0JCQlyZXR1cm4gZXJyOwotCi0JCXZhZGRyID0ga21hcF9hdG9taWMocGFnZSk7Ci0J
CXVud3JpdHRlbiA9IF9fY29weV9mcm9tX3VzZXJfaW5hdG9taWModmFkZHIgKyBwZywKLQkJCQkJ
CSAgICAgIHVzZXJfZGF0YSwKLQkJCQkJCSAgICAgIGxlbik7Ci0JCWt1bm1hcF9hdG9taWModmFk
ZHIpOwotCi0JCWVyciA9IHBhZ2VjYWNoZV93cml0ZV9lbmQob2JqLT5iYXNlLmZpbHAsIG1hcHBp
bmcsCi0JCQkJCSAgb2Zmc2V0LCBsZW4sIGxlbiAtIHVud3JpdHRlbiwKLQkJCQkJICBwYWdlLCBk
YXRhKTsKLQkJaWYgKGVyciA8IDApCi0JCQlyZXR1cm4gZXJyOwotCi0JCS8qIFdlIGRvbid0IGhh
bmRsZSAtRUZBVUxULCBsZWF2ZSBpdCB0byB0aGUgY2FsbGVyIHRvIGNoZWNrICovCi0JCWlmICh1
bndyaXR0ZW4pCi0JCQlyZXR1cm4gLUVOT0RFVjsKLQotCQlyZW1haW4gLT0gbGVuOwotCQl1c2Vy
X2RhdGEgKz0gbGVuOwotCQlvZmZzZXQgKz0gbGVuOwotCQlwZyA9IDA7Ci0JfSB3aGlsZSAocmVt
YWluKTsKLQotCXJldHVybiAwOwotfQotCi12b2lkIGk5MTVfZ2VtX2Nsb3NlX29iamVjdChzdHJ1
Y3QgZHJtX2dlbV9vYmplY3QgKmdlbSwgc3RydWN0IGRybV9maWxlICpmaWxlKQotewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShnZW0tPmRldik7Ci0Jc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHRvX2ludGVsX2JvKGdlbSk7Ci0Jc3RydWN0IGRybV9p
OTE1X2ZpbGVfcHJpdmF0ZSAqZnByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsKLQlzdHJ1Y3QgaTkx
NV9sdXRfaGFuZGxlICpsdXQsICpsbjsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCi0JbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGx1dCwgbG4sICZvYmotPmx1dF9s
aXN0LCBvYmpfbGluaykgewotCQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gbHV0LT5j
dHg7Ci0JCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCi0JCUdFTV9CVUdfT04oY3R4LT5maWxlX3By
aXYgPT0gRVJSX1BUUigtRUJBREYpKTsKLQkJaWYgKGN0eC0+ZmlsZV9wcml2ICE9IGZwcml2KQot
CQkJY29udGludWU7Ci0KLQkJdm1hID0gcmFkaXhfdHJlZV9kZWxldGUoJmN0eC0+aGFuZGxlc192
bWEsIGx1dC0+aGFuZGxlKTsKLQkJR0VNX0JVR19PTih2bWEtPm9iaiAhPSBvYmopOwotCi0JCS8q
IFdlIGFsbG93IHRoZSBwcm9jZXNzIHRvIGhhdmUgbXVsdGlwbGUgaGFuZGxlcyB0byB0aGUgc2Ft
ZQotCQkgKiB2bWEsIGluIHRoZSBzYW1lIGZkIG5hbWVzcGFjZSwgYnkgdmlydHVlIG9mIGZsaW5r
L29wZW4uCi0JCSAqLwotCQlHRU1fQlVHX09OKCF2bWEtPm9wZW5fY291bnQpOwotCQlpZiAoIS0t
dm1hLT5vcGVuX2NvdW50ICYmICFpOTE1X3ZtYV9pc19nZ3R0KHZtYSkpCi0JCQlpOTE1X3ZtYV9j
bG9zZSh2bWEpOwotCi0JCWxpc3RfZGVsKCZsdXQtPm9ial9saW5rKTsKLQkJbGlzdF9kZWwoJmx1
dC0+Y3R4X2xpbmspOwotCi0JCWk5MTVfbHV0X2hhbmRsZV9mcmVlKGx1dCk7Ci0JCV9faTkxNV9n
ZW1fb2JqZWN0X3JlbGVhc2VfdW5sZXNzX2FjdGl2ZShvYmopOwotCX0KLQotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci19Ci0KIHN0YXRpYyB1bnNpZ25lZCBsb25nIHRv
X3dhaXRfdGltZW91dChzNjQgdGltZW91dF9ucykKIHsKIAlpZiAodGltZW91dF9ucyA8IDApCkBA
IC0zODExLDM0OCArMzM4OCw2IEBAIGk5MTVfZ2VtX21hZHZpc2VfaW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgdm9pZAot
ZnJvbnRidWZmZXJfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0J
CSAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCi17Ci0Jc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiA9Ci0JCWNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigqb2JqKSwgZnJv
bnRidWZmZXJfd3JpdGUpOwotCi0JaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwgT1JJR0lOX0NTKTsK
LX0KLQotdm9pZCBpOTE1X2dlbV9vYmplY3RfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAotCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgKm9wcykK
LXsKLQltdXRleF9pbml0KCZvYmotPm1tLmxvY2spOwotCi0Jc3Bpbl9sb2NrX2luaXQoJm9iai0+
dm1hLmxvY2spOwotCUlOSVRfTElTVF9IRUFEKCZvYmotPnZtYS5saXN0KTsKLQotCUlOSVRfTElT
VF9IRUFEKCZvYmotPmx1dF9saXN0KTsKLQlJTklUX0xJU1RfSEVBRCgmb2JqLT5iYXRjaF9wb29s
X2xpbmspOwotCi0JaW5pdF9yY3VfaGVhZCgmb2JqLT5yY3UpOwotCi0Jb2JqLT5vcHMgPSBvcHM7
Ci0KLQlyZXNlcnZhdGlvbl9vYmplY3RfaW5pdCgmb2JqLT5fX2J1aWx0aW5fcmVzdik7Ci0Jb2Jq
LT5yZXN2ID0gJm9iai0+X19idWlsdGluX3Jlc3Y7Ci0KLQlvYmotPmZyb250YnVmZmVyX2dndHRf
b3JpZ2luID0gT1JJR0lOX0dUVDsKLQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJm9iai0+ZnJv
bnRidWZmZXJfd3JpdGUsCi0JCQkJIE5VTEwsIGZyb250YnVmZmVyX3JldGlyZSk7Ci0KLQlvYmot
Pm1tLm1hZHYgPSBJOTE1X01BRFZfV0lMTE5FRUQ7Ci0JSU5JVF9SQURJWF9UUkVFKCZvYmotPm1t
LmdldF9wYWdlLnJhZGl4LCBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOKTsKLQltdXRleF9pbml0
KCZvYmotPm1tLmdldF9wYWdlLmxvY2spOwotCi0JaTkxNV9nZW1faW5mb19hZGRfb2JqKHRvX2k5
MTUob2JqLT5iYXNlLmRldiksIG9iai0+YmFzZS5zaXplKTsKLX0KLQotc3RhdGljIGNvbnN0IHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0X29wcyBpOTE1X2dlbV9vYmplY3Rfb3BzID0gewotCS5m
bGFncyA9IEk5MTVfR0VNX09CSkVDVF9IQVNfU1RSVUNUX1BBR0UgfAotCQkgSTkxNV9HRU1fT0JK
RUNUX0lTX1NIUklOS0FCTEUsCi0KLQkuZ2V0X3BhZ2VzID0gaTkxNV9nZW1fb2JqZWN0X2dldF9w
YWdlc19ndHQsCi0JLnB1dF9wYWdlcyA9IGk5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXNfZ3R0LAot
Ci0JLnB3cml0ZSA9IGk5MTVfZ2VtX29iamVjdF9wd3JpdGVfZ3R0LAotfTsKLQotc3RhdGljIGlu
dCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCi0J
CQkJCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLAotCQkJCQlzaXplX3Qgc2l6ZSkKLXsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKLQl1bnNpZ25lZCBs
b25nIGZsYWdzID0gVk1fTk9SRVNFUlZFOwotCXN0cnVjdCBmaWxlICpmaWxwOwotCi0JZHJtX2dl
bV9wcml2YXRlX29iamVjdF9pbml0KGRldiwgb2JqLCBzaXplKTsKLQotCWlmIChpOTE1LT5tbS5n
ZW1mcykKLQkJZmlscCA9IHNobWVtX2ZpbGVfc2V0dXBfd2l0aF9tbnQoaTkxNS0+bW0uZ2VtZnMs
ICJpOTE1Iiwgc2l6ZSwKLQkJCQkJCSBmbGFncyk7Ci0JZWxzZQotCQlmaWxwID0gc2htZW1fZmls
ZV9zZXR1cCgiaTkxNSIsIHNpemUsIGZsYWdzKTsKLQotCWlmIChJU19FUlIoZmlscCkpCi0JCXJl
dHVybiBQVFJfRVJSKGZpbHApOwotCi0Jb2JqLT5maWxwID0gZmlscDsKLQotCXJldHVybiAwOwot
fQotCi1zdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqCi1pOTE1X2dlbV9vYmplY3RfY3JlYXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHNpemUpCi17Ci0Jc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGlu
ZzsKLQl1bnNpZ25lZCBpbnQgY2FjaGVfbGV2ZWw7Ci0JZ2ZwX3QgbWFzazsKLQlpbnQgcmV0Owot
Ci0JLyogVGhlcmUgaXMgYSBwcmV2YWxlbmNlIG9mIHRoZSBhc3N1bXB0aW9uIHRoYXQgd2UgZml0
IHRoZSBvYmplY3QncwotCSAqIHBhZ2UgY291bnQgaW5zaWRlIGEgMzJiaXQgX3NpZ25lZF8gdmFy
aWFibGUuIExldCdzIGRvY3VtZW50IHRoaXMgYW5kCi0JICogY2F0Y2ggaWYgd2UgZXZlciBuZWVk
IHRvIGZpeCBpdC4gSW4gdGhlIG1lYW50aW1lLCBpZiB5b3UgZG8gc3BvdAotCSAqIHN1Y2ggYSBs
b2NhbCB2YXJpYWJsZSwgcGxlYXNlIGNvbnNpZGVyIGZpeGluZyEKLQkgKi8KLQlpZiAoc2l6ZSA+
PiBQQUdFX1NISUZUID4gSU5UX01BWCkKLQkJcmV0dXJuIEVSUl9QVFIoLUUyQklHKTsKLQotCWlm
IChvdmVyZmxvd3NfdHlwZShzaXplLCBvYmotPmJhc2Uuc2l6ZSkpCi0JCXJldHVybiBFUlJfUFRS
KC1FMkJJRyk7Ci0KLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfYWxsb2MoKTsKLQlpZiAob2JqID09
IE5VTEwpCi0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwotCi0JcmV0ID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zaG1lbSgmZGV2X3ByaXYtPmRybSwgJm9iai0+YmFzZSwgc2l6ZSk7Ci0JaWYg
KHJldCkKLQkJZ290byBmYWlsOwotCi0JbWFzayA9IEdGUF9ISUdIVVNFUiB8IF9fR0ZQX1JFQ0xB
SU1BQkxFOwotCWlmIChJU19JOTY1R00oZGV2X3ByaXYpIHx8IElTX0k5NjVHKGRldl9wcml2KSkg
ewotCQkvKiA5NjVnbSBjYW5ub3QgcmVsb2NhdGUgb2JqZWN0cyBhYm92ZSA0R2lCLiAqLwotCQlt
YXNrICY9IH5fX0dGUF9ISUdITUVNOwotCQltYXNrIHw9IF9fR0ZQX0RNQTMyOwotCX0KLQotCW1h
cHBpbmcgPSBvYmotPmJhc2UuZmlscC0+Zl9tYXBwaW5nOwotCW1hcHBpbmdfc2V0X2dmcF9tYXNr
KG1hcHBpbmcsIG1hc2spOwotCUdFTV9CVUdfT04oIShtYXBwaW5nX2dmcF9tYXNrKG1hcHBpbmcp
ICYgX19HRlBfUkVDTEFJTSkpOwotCi0JaTkxNV9nZW1fb2JqZWN0X2luaXQob2JqLCAmaTkxNV9n
ZW1fb2JqZWN0X29wcyk7Ci0KLQlvYmotPndyaXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9D
UFU7Ci0Jb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fQ1BVOwotCi0JaWYgKEhB
U19MTEMoZGV2X3ByaXYpKQotCQkvKiBPbiBzb21lIGRldmljZXMsIHdlIGNhbiBoYXZlIHRoZSBH
UFUgdXNlIHRoZSBMTEMgKHRoZSBDUFUKLQkJICogY2FjaGUpIGZvciBhYm91dCBhIDEwJSBwZXJm
b3JtYW5jZSBpbXByb3ZlbWVudAotCQkgKiBjb21wYXJlZCB0byB1bmNhY2hlZC4gIEdyYXBoaWNz
IHJlcXVlc3RzIG90aGVyIHRoYW4KLQkJICogZGlzcGxheSBzY2Fub3V0IGFyZSBjb2hlcmVudCB3
aXRoIHRoZSBDUFUgaW4KLQkJICogYWNjZXNzaW5nIHRoaXMgY2FjaGUuICBUaGlzIG1lYW5zIGlu
IHRoaXMgbW9kZSB3ZQotCQkgKiBkb24ndCBuZWVkIHRvIGNsZmx1c2ggb24gdGhlIENQVSBzaWRl
LCBhbmQgb24gdGhlCi0JCSAqIEdQVSBzaWRlIHdlIG9ubHkgbmVlZCB0byBmbHVzaCBpbnRlcm5h
bCBjYWNoZXMgdG8KLQkJICogZ2V0IGRhdGEgdmlzaWJsZSB0byB0aGUgQ1BVLgotCQkgKgotCQkg
KiBIb3dldmVyLCB3ZSBtYWludGFpbiB0aGUgZGlzcGxheSBwbGFuZXMgYXMgVUMsIGFuZCBzbwot
CQkgKiBuZWVkIHRvIHJlYmluZCB3aGVuIGZpcnN0IHVzZWQgYXMgc3VjaC4KLQkJICovCi0JCWNh
Y2hlX2xldmVsID0gSTkxNV9DQUNIRV9MTEM7Ci0JZWxzZQotCQljYWNoZV9sZXZlbCA9IEk5MTVf
Q0FDSEVfTk9ORTsKLQotCWk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KG9iaiwg
Y2FjaGVfbGV2ZWwpOwotCi0JdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShvYmopOwotCi0J
cmV0dXJuIG9iajsKLQotZmFpbDoKLQlpOTE1X2dlbV9vYmplY3RfZnJlZShvYmopOwotCXJldHVy
biBFUlJfUFRSKHJldCk7Ci19Ci0KLXN0YXRpYyBib29sIGRpc2NhcmRfYmFja2luZ19zdG9yYWdl
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JLyogSWYgd2UgYXJlIHRoZSBs
YXN0IHVzZXIgb2YgdGhlIGJhY2tpbmcgc3RvcmFnZSAoYmUgaXQgc2htZW1mcwotCSAqIHBhZ2Vz
IG9yIHN0b2xlbiBldGMpLCB3ZSBrbm93IHRoYXQgdGhlIHBhZ2VzIGFyZSBnb2luZyB0byBiZQot
CSAqIGltbWVkaWF0ZWx5IHJlbGVhc2VkLiBJbiB0aGlzIGNhc2UsIHdlIGNhbiB0aGVuIHNraXAg
Y29weWluZwotCSAqIGJhY2sgdGhlIGNvbnRlbnRzIGZyb20gdGhlIEdQVS4KLQkgKi8KLQotCWlm
IChvYmotPm1tLm1hZHYgIT0gSTkxNV9NQURWX1dJTExORUVEKQotCQlyZXR1cm4gZmFsc2U7Ci0K
LQlpZiAob2JqLT5iYXNlLmZpbHAgPT0gTlVMTCkKLQkJcmV0dXJuIHRydWU7Ci0KLQkvKiBBdCBm
aXJzdCBnbGFuY2UsIHRoaXMgbG9va3MgcmFjeSwgYnV0IHRoZW4gYWdhaW4gc28gd291bGQgYmUK
LQkgKiB1c2Vyc3BhY2UgcmFjaW5nIG1tYXAgYWdhaW5zdCBjbG9zZS4gSG93ZXZlciwgdGhlIGZp
cnN0IGV4dGVybmFsCi0JICogcmVmZXJlbmNlIHRvIHRoZSBmaWxwIGNhbiBvbmx5IGJlIG9idGFp
bmVkIHRocm91Z2ggdGhlCi0JICogaTkxNV9nZW1fbW1hcF9pb2N0bCgpIHdoaWNoIHNhZmVndWFy
ZHMgdXMgYWdhaW5zdCB0aGUgdXNlcgotCSAqIGFjcXVpcmluZyBzdWNoIGEgcmVmZXJlbmNlIHdo
aWxzdCB3ZSBhcmUgaW4gdGhlIG1pZGRsZSBvZgotCSAqIGZyZWVpbmcgdGhlIG9iamVjdC4KLQkg
Ki8KLQlyZXR1cm4gZmlsZV9jb3VudChvYmotPmJhc2UuZmlscCkgPT0gMTsKLX0KLQotc3RhdGlj
IHZvaWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCi0JCQkJICAgIHN0cnVjdCBsbGlzdF9ub2RlICpmcmVlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLCAqb247Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0KLQl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7Ci0JbGxpc3RfZm9yX2VhY2hfZW50
cnlfc2FmZShvYmosIG9uLCBmcmVlZCwgZnJlZWQpIHsKLQkJc3RydWN0IGk5MTVfdm1hICp2bWEs
ICp2bjsKLQotCQl0cmFjZV9pOTE1X2dlbV9vYmplY3RfZGVzdHJveShvYmopOwotCi0JCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JCUdFTV9CVUdfT04oaTkxNV9nZW1f
b2JqZWN0X2lzX2FjdGl2ZShvYmopKTsKLQkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwg
dm4sICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykgewotCQkJR0VNX0JVR19PTihpOTE1X3ZtYV9p
c19hY3RpdmUodm1hKSk7Ci0JCQl2bWEtPmZsYWdzICY9IH5JOTE1X1ZNQV9QSU5fTUFTSzsKLQkJ
CWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKLQkJfQotCQlHRU1fQlVHX09OKCFsaXN0X2VtcHR5KCZv
YmotPnZtYS5saXN0KSk7Ci0JCUdFTV9CVUdfT04oIVJCX0VNUFRZX1JPT1QoJm9iai0+dm1hLnRy
ZWUpKTsKLQotCQkvKiBUaGlzIHNlcmlhbGl6ZXMgZnJlZWluZyB3aXRoIHRoZSBzaHJpbmtlci4g
U2luY2UgdGhlIGZyZWUKLQkJICogaXMgZGVsYXllZCwgZmlyc3QgYnkgUkNVIHRoZW4gYnkgdGhl
IHdvcmtxdWV1ZSwgd2Ugd2FudCB0aGUKLQkJICogc2hyaW5rZXIgdG8gYmUgYWJsZSB0byBmcmVl
IHBhZ2VzIG9mIHVucmVmZXJlbmNlZCBvYmplY3RzLAotCQkgKiBvciBlbHNlIHdlIG1heSBvb20g
d2hpbHN0IHRoZXJlIGFyZSBwbGVudHkgb2YgZGVmZXJyZWQKLQkJICogZnJlZWQgb2JqZWN0cy4K
LQkJICovCi0JCWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpIHsKLQkJCXNwaW5f
bG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwotCQkJbGlzdF9kZWxfaW5pdCgmb2JqLT5tbS5saW5r
KTsKLQkJCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7Ci0JCX0KLQotCQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JCUdFTV9CVUdfT04ob2JqLT5iaW5k
X2NvdW50KTsKLQkJR0VNX0JVR19PTihvYmotPnVzZXJmYXVsdF9jb3VudCk7Ci0JCUdFTV9CVUdf
T04oYXRvbWljX3JlYWQoJm9iai0+ZnJvbnRidWZmZXJfYml0cykpOwotCQlHRU1fQlVHX09OKCFs
aXN0X2VtcHR5KCZvYmotPmx1dF9saXN0KSk7Ci0KLQkJaWYgKG9iai0+b3BzLT5yZWxlYXNlKQot
CQkJb2JqLT5vcHMtPnJlbGVhc2Uob2JqKTsKLQotCQlpZiAoV0FSTl9PTihpOTE1X2dlbV9vYmpl
Y3RfaGFzX3Bpbm5lZF9wYWdlcyhvYmopKSkKLQkJCWF0b21pY19zZXQoJm9iai0+bW0ucGFnZXNf
cGluX2NvdW50LCAwKTsKLQkJX19pOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzKG9iaiwgSTkxNV9N
TV9OT1JNQUwpOwotCQlHRU1fQlVHX09OKGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSk7
Ci0KLQkJaWYgKG9iai0+YmFzZS5pbXBvcnRfYXR0YWNoKQotCQkJZHJtX3ByaW1lX2dlbV9kZXN0
cm95KCZvYmotPmJhc2UsIE5VTEwpOwotCi0JCXJlc2VydmF0aW9uX29iamVjdF9maW5pKCZvYmot
Pl9fYnVpbHRpbl9yZXN2KTsKLQkJZHJtX2dlbV9vYmplY3RfcmVsZWFzZSgmb2JqLT5iYXNlKTsK
LQkJaTkxNV9nZW1faW5mb19yZW1vdmVfb2JqKGk5MTUsIG9iai0+YmFzZS5zaXplKTsKLQotCQli
aXRtYXBfZnJlZShvYmotPmJpdF8xNyk7Ci0JCWk5MTVfZ2VtX29iamVjdF9mcmVlKG9iaik7Ci0K
LQkJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJmk5MTUtPm1tLmZyZWVfY291bnQpKTsKLQkJYXRv
bWljX2RlYygmaTkxNS0+bW0uZnJlZV9jb3VudCk7Ci0KLQkJaWYgKG9uKQotCQkJY29uZF9yZXNj
aGVkKCk7Ci0JfQotCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwotfQotCi1z
dGF0aWMgdm9pZCBpOTE1X2dlbV9mbHVzaF9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCi17Ci0Jc3RydWN0IGxsaXN0X25vZGUgKmZyZWVkOwotCi0JLyogRnJlZSB0
aGUgb2xkZXN0LCBtb3N0IHN0YWxlIG9iamVjdCB0byBrZWVwIHRoZSBmcmVlX2xpc3Qgc2hvcnQg
Ki8KLQlmcmVlZCA9IE5VTEw7Ci0JaWYgKCFsbGlzdF9lbXB0eSgmaTkxNS0+bW0uZnJlZV9saXN0
KSkgeyAvKiBxdWljayB0ZXN0IGZvciBob3RwYXRoICovCi0JCS8qIE9ubHkgb25lIGNvbnN1bWVy
IG9mIGxsaXN0X2RlbF9maXJzdCgpIGFsbG93ZWQgKi8KLQkJc3Bpbl9sb2NrKCZpOTE1LT5tbS5m
cmVlX2xvY2spOwotCQlmcmVlZCA9IGxsaXN0X2RlbF9maXJzdCgmaTkxNS0+bW0uZnJlZV9saXN0
KTsKLQkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLmZyZWVfbG9jayk7Ci0JfQotCWlmICh1bmxpa2Vs
eShmcmVlZCkpIHsKLQkJZnJlZWQtPm5leHQgPSBOVUxMOwotCQlfX2k5MTVfZ2VtX2ZyZWVfb2Jq
ZWN0cyhpOTE1LCBmcmVlZCk7Ci0JfQotfQotCi1zdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVf
d29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPQotCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUs
IG1tLmZyZWVfd29yayk7Ci0Jc3RydWN0IGxsaXN0X25vZGUgKmZyZWVkOwotCi0JLyoKLQkgKiBB
bGwgZmlsZS1vd25lZCBWTUEgc2hvdWxkIGhhdmUgYmVlbiByZWxlYXNlZCBieSB0aGlzIHBvaW50
IHRocm91Z2gKLQkgKiBpOTE1X2dlbV9jbG9zZV9vYmplY3QoKSwgb3IgZWFybGllciBieSBpOTE1
X2dlbV9jb250ZXh0X2Nsb3NlKCkuCi0JICogSG93ZXZlciwgdGhlIG9iamVjdCBtYXkgYWxzbyBi
ZSBib3VuZCBpbnRvIHRoZSBnbG9iYWwgR1RUIChlLmcuCi0JICogb2xkZXIgR1BVcyB3aXRob3V0
IHBlci1wcm9jZXNzIHN1cHBvcnQsIG9yIGZvciBkaXJlY3QgYWNjZXNzIHRocm91Z2gKLQkgKiB0
aGUgR1RUIGVpdGhlciBmb3IgdGhlIHVzZXIgb3IgZm9yIHNjYW5vdXQpLiBUaG9zZSBWTUEgc3Rp
bGwgbmVlZCB0bwotCSAqIHVuYm91bmQgbm93LgotCSAqLwotCi0Jc3Bpbl9sb2NrKCZpOTE1LT5t
bS5mcmVlX2xvY2spOwotCXdoaWxlICgoZnJlZWQgPSBsbGlzdF9kZWxfYWxsKCZpOTE1LT5tbS5m
cmVlX2xpc3QpKSkgewotCQlzcGluX3VubG9jaygmaTkxNS0+bW0uZnJlZV9sb2NrKTsKLQotCQlf
X2k5MTVfZ2VtX2ZyZWVfb2JqZWN0cyhpOTE1LCBmcmVlZCk7Ci0JCWlmIChuZWVkX3Jlc2NoZWQo
KSkKLQkJCXJldHVybjsKLQotCQlzcGluX2xvY2soJmk5MTUtPm1tLmZyZWVfbG9jayk7Ci0JfQot
CXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5mcmVlX2xvY2spOwotfQotCi1zdGF0aWMgdm9pZCBfX2k5
MTVfZ2VtX2ZyZWVfb2JqZWN0X3JjdShzdHJ1Y3QgcmN1X2hlYWQgKmhlYWQpCi17Ci0Jc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9Ci0JCWNvbnRhaW5lcl9vZihoZWFkLCB0eXBlb2Yo
Km9iaiksIHJjdSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9i
ai0+YmFzZS5kZXYpOwotCi0JLyoKLQkgKiBXZSByZXVzZSBvYmotPnJjdSBmb3IgdGhlIGZyZWVk
IGxpc3QsIHNvIHdlIGhhZCBiZXR0ZXIgbm90IHRyZWF0Ci0JICogaXQgbGlrZSBhIHJjdV9oZWFk
IGZyb20gdGhpcyBwb2ludCBmb3J3YXJkcy4gQW5kIHdlIGV4cGVjdCBhbGwKLQkgKiBvYmplY3Rz
IHRvIGJlIGZyZWVkIHZpYSB0aGlzIHBhdGguCi0JICovCi0JZGVzdHJveV9yY3VfaGVhZCgmb2Jq
LT5yY3UpOwotCi0JLyoKLQkgKiBTaW5jZSB3ZSByZXF1aXJlIGJsb2NraW5nIG9uIHN0cnVjdF9t
dXRleCB0byB1bmJpbmQgdGhlIGZyZWVkCi0JICogb2JqZWN0IGZyb20gdGhlIEdQVSBiZWZvcmUg
cmVsZWFzaW5nIHJlc291cmNlcyBiYWNrIHRvIHRoZQotCSAqIHN5c3RlbSwgd2UgY2FuIG5vdCBk
byB0aGF0IGRpcmVjdGx5IGZyb20gdGhlIFJDVSBjYWxsYmFjayAod2hpY2ggbWF5Ci0JICogYmUg
YSBzb2Z0aXJxIGNvbnRleHQpLCBidXQgbXVzdCBpbnN0ZWFkIHRoZW4gZGVmZXIgdGhhdCB3b3Jr
IG9udG8gYQotCSAqIGt0aHJlYWQuIFdlIHVzZSB0aGUgUkNVIGNhbGxiYWNrIHJhdGhlciB0aGFu
IG1vdmUgdGhlIGZyZWVkIG9iamVjdAotCSAqIGRpcmVjdGx5IG9udG8gdGhlIHdvcmsgcXVldWUg
c28gdGhhdCB3ZSBjYW4gbWl4IGJldHdlZW4gdXNpbmcgdGhlCi0JICogd29ya2VyIGFuZCBwZXJm
b3JtaW5nIGZyZWVzIGRpcmVjdGx5IGZyb20gc3Vic2VxdWVudCBhbGxvY2F0aW9ucyBmb3IKLQkg
KiBjcnVkZSBidXQgZWZmZWN0aXZlIG1lbW9yeSB0aHJvdHRsaW5nLgotCSAqLwotCWlmIChsbGlz
dF9hZGQoJm9iai0+ZnJlZWQsICZpOTE1LT5tbS5mcmVlX2xpc3QpKQotCQlxdWV1ZV93b3JrKGk5
MTUtPndxLCAmaTkxNS0+bW0uZnJlZV93b3JrKTsKLX0KLQotdm9pZCBpOTE1X2dlbV9mcmVlX29i
amVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbV9vYmopCi17Ci0Jc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiA9IHRvX2ludGVsX2JvKGdlbV9vYmopOwotCi0JaWYgKG9iai0+bW0u
cXVpcmtlZCkKLQkJX19pOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKLQotCWlmIChk
aXNjYXJkX2JhY2tpbmdfc3RvcmFnZShvYmopKQotCQlvYmotPm1tLm1hZHYgPSBJOTE1X01BRFZf
RE9OVE5FRUQ7Ci0KLQkvKgotCSAqIEJlZm9yZSB3ZSBmcmVlIHRoZSBvYmplY3QsIG1ha2Ugc3Vy
ZSBhbnkgcHVyZSBSQ1Utb25seQotCSAqIHJlYWQtc2lkZSBjcml0aWNhbCBzZWN0aW9ucyBhcmUg
Y29tcGxldGUsIGUuZy4KLQkgKiBpOTE1X2dlbV9idXN5X2lvY3RsKCkuIEZvciB0aGUgY29ycmVz
cG9uZGluZyBzeW5jaHJvbml6ZWQKLQkgKiBsb29rdXAgc2VlIGk5MTVfZ2VtX29iamVjdF9sb29r
dXBfcmN1KCkuCi0JICovCi0JYXRvbWljX2luYygmdG9faTkxNShvYmotPmJhc2UuZGV2KS0+bW0u
ZnJlZV9jb3VudCk7Ci0JY2FsbF9yY3UoJm9iai0+cmN1LCBfX2k5MTVfZ2VtX2ZyZWVfb2JqZWN0
X3JjdSk7Ci19Ci0KLXZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV91bmxlc3NfYWN0aXZl
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQotCWlmICghaTkxNV9nZW1fb2JqZWN0
X2hhc19hY3RpdmVfcmVmZXJlbmNlKG9iaikgJiYKLQkgICAgaTkxNV9nZW1fb2JqZWN0X2lzX2Fj
dGl2ZShvYmopKQotCQlpOTE1X2dlbV9vYmplY3Rfc2V0X2FjdGl2ZV9yZWZlcmVuY2Uob2JqKTsK
LQllbHNlCi0JCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLX0KLQogdm9pZCBpOTE1X2dlbV9z
YW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnRlbF93YWtlcmVm
X3Qgd2FrZXJlZjsKQEAgLTQ3NDksNyArMzk4NCw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2lu
aXRfX21tKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCUlOSVRfTElTVF9IRUFEKCZp
OTE1LT5tbS5mZW5jZV9saXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmaTkxNS0+bW0udXNlcmZhdWx0
X2xpc3QpOwogCi0JSU5JVF9XT1JLKCZpOTE1LT5tbS5mcmVlX3dvcmssIF9faTkxNV9nZW1fZnJl
ZV93b3JrKTsKKwlpOTE1X2dlbV9pbml0X19vYmplY3RzKGk5MTUpOwogfQogCiBpbnQgaTkxNV9n
ZW1faW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC00OTE1
LDU3ICs0MTUwLDYgQEAgdm9pZCBpOTE1X2dlbV90cmFja19mYihzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2xkLAogCX0KIH0KIAotLyogQWxsb2NhdGUgYSBuZXcgR0VNIG9iamVjdCBhbmQg
ZmlsbCBpdCB3aXRoIHRoZSBzdXBwbGllZCBkYXRhICovCi1zdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqCi1pOTE1X2dlbV9vYmplY3RfY3JlYXRlX2Zyb21fZGF0YShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkgICAgICAgICBjb25zdCB2b2lkICpkYXRhLCBzaXplX3Qg
c2l6ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBmaWxl
ICpmaWxlOwotCXNpemVfdCBvZmZzZXQ7Ci0JaW50IGVycjsKLQotCW9iaiA9IGk5MTVfZ2VtX29i
amVjdF9jcmVhdGUoZGV2X3ByaXYsIHJvdW5kX3VwKHNpemUsIFBBR0VfU0laRSkpOwotCWlmIChJ
U19FUlIob2JqKSkKLQkJcmV0dXJuIG9iajsKLQotCUdFTV9CVUdfT04ob2JqLT53cml0ZV9kb21h
aW4gIT0gSTkxNV9HRU1fRE9NQUlOX0NQVSk7Ci0KLQlmaWxlID0gb2JqLT5iYXNlLmZpbHA7Ci0J
b2Zmc2V0ID0gMDsKLQlkbyB7Ci0JCXVuc2lnbmVkIGludCBsZW4gPSBtaW5fdCh0eXBlb2Yoc2l6
ZSksIHNpemUsIFBBR0VfU0laRSk7Ci0JCXN0cnVjdCBwYWdlICpwYWdlOwotCQl2b2lkICpwZ2Rh
dGEsICp2YWRkcjsKLQotCQllcnIgPSBwYWdlY2FjaGVfd3JpdGVfYmVnaW4oZmlsZSwgZmlsZS0+
Zl9tYXBwaW5nLAotCQkJCQkgICAgb2Zmc2V0LCBsZW4sIDAsCi0JCQkJCSAgICAmcGFnZSwgJnBn
ZGF0YSk7Ci0JCWlmIChlcnIgPCAwKQotCQkJZ290byBmYWlsOwotCi0JCXZhZGRyID0ga21hcChw
YWdlKTsKLQkJbWVtY3B5KHZhZGRyLCBkYXRhLCBsZW4pOwotCQlrdW5tYXAocGFnZSk7Ci0KLQkJ
ZXJyID0gcGFnZWNhY2hlX3dyaXRlX2VuZChmaWxlLCBmaWxlLT5mX21hcHBpbmcsCi0JCQkJCSAg
b2Zmc2V0LCBsZW4sIGxlbiwKLQkJCQkJICBwYWdlLCBwZ2RhdGEpOwotCQlpZiAoZXJyIDwgMCkK
LQkJCWdvdG8gZmFpbDsKLQotCQlzaXplIC09IGxlbjsKLQkJZGF0YSArPSBsZW47Ci0JCW9mZnNl
dCArPSBsZW47Ci0JfSB3aGlsZSAoc2l6ZSk7Ci0KLQlyZXR1cm4gb2JqOwotCi1mYWlsOgotCWk5
MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQlyZXR1cm4gRVJSX1BUUihlcnIpOwotfQotCiBzdHJ1
Y3Qgc2NhdHRlcmxpc3QgKgogaTkxNV9nZW1fb2JqZWN0X2dldF9zZyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCQkgICAgICAgdW5zaWduZWQgaW50IG4sCkBAIC01MTQwLDcgKzQz
MjQsNyBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosIGludCBhbGlnbikKIAlpZiAob2JqLT5vcHMgPT0gJmk5MTVfZ2VtX3Bo
eXNfb3BzKQogCQlyZXR1cm4gMDsKIAotCWlmIChvYmotPm9wcyAhPSAmaTkxNV9nZW1fb2JqZWN0
X29wcykKKwlpZiAob2JqLT5vcHMgIT0gJmk5MTVfZ2VtX3NobWVtX29wcykKIAkJcmV0dXJuIC1F
SU5WQUw7CiAKIAllcnIgPSBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKG9iaik7CkBAIC01MTc2LDEy
ICs0MzYwLDEyIEBAIGludCBpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwgaW50IGFsaWduKQogCV9faTkxNV9nZW1fb2JqZWN0X3Bpbl9w
YWdlcyhvYmopOwogCiAJaWYgKCFJU19FUlJfT1JfTlVMTChwYWdlcykpCi0JCWk5MTVfZ2VtX29i
amVjdF9vcHMucHV0X3BhZ2VzKG9iaiwgcGFnZXMpOworCQlpOTE1X2dlbV9zaG1lbV9vcHMucHV0
X3BhZ2VzKG9iaiwgcGFnZXMpOwogCW11dGV4X3VubG9jaygmb2JqLT5tbS5sb2NrKTsKIAlyZXR1
cm4gMDsKIAogZXJyX3hmZXI6Ci0Jb2JqLT5vcHMgPSAmaTkxNV9nZW1fb2JqZWN0X29wczsKKwlv
YmotPm9wcyA9ICZpOTE1X2dlbV9zaG1lbV9vcHM7CiAJaWYgKCFJU19FUlJfT1JfTlVMTChwYWdl
cykpIHsKIAkJdW5zaWduZWQgaW50IHNnX3BhZ2Vfc2l6ZXMgPSBpOTE1X3NnX3BhZ2Vfc2l6ZXMo
cGFnZXMtPnNnbCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggYzQ5OTVkNWExNmQy
Li4zNzlmZDg5YTE4MGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xNTEwLDcgKzE1
MTAsNyBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJQlVJTERfQlVHX09OX05PVF9QT1dFUl9PRl8yKE9BX0JVRkZFUl9TSVpF
KTsKIAlCVUlMRF9CVUdfT04oT0FfQlVGRkVSX1NJWkUgPCBTWl8xMjhLIHx8IE9BX0JVRkZFUl9T
SVpFID4gU1pfMTZNKTsKIAotCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShkZXZfcHJpdiwg
T0FfQlVGRkVSX1NJWkUpOworCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZf
cHJpdiwgT0FfQlVGRkVSX1NJWkUpOwogCWlmIChJU19FUlIoYm8pKSB7CiAJCURSTV9FUlJPUigi
RmFpbGVkIHRvIGFsbG9jYXRlIE9BIGJ1ZmZlclxuIik7CiAJCXJldCA9IFBUUl9FUlIoYm8pOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMKaW5kZXggODlkYjcxOTk2MTQ4Li4wZDNhNmZhNjc0
ZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYwpAQCAtMTQ0LDcgKzE0NCw3IEBAIHN0
YXRpYyBpbnQgaW50ZWxmYl9hbGxvYyhzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCWlm
IChzaXplICogMiA8IGRldl9wcml2LT5zdG9sZW5fdXNhYmxlX3NpemUpCiAJCW9iaiA9IGk5MTVf
Z2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGRldl9wcml2LCBzaXplKTsKIAlpZiAob2JqID09IE5V
TEwpCi0JCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUoZGV2X3ByaXYsIHNpemUpOworCQlv
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBzaXplKTsKIAlpZiAo
SVNfRVJSKG9iaikpIHsKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2NhdGUgZnJhbWVidWZm
ZXJcbiIpOwogCQlyZXQgPSBQVFJfRVJSKG9iaik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9ndWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCmlu
ZGV4IGM0YWMyOTMwOWZjYy4uOThlNDVhNTAwYTE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9ndWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMu
YwpAQCAtNjkwLDcgKzY5MCw3IEBAIHN0cnVjdCBpOTE1X3ZtYSAqaW50ZWxfZ3VjX2FsbG9jYXRl
X3ZtYShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMsIHUzMiBzaXplKQogCXU2NCBmbGFnczsKIAlpbnQg
cmV0OwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShkZXZfcHJpdiwgc2l6ZSk7CisJ
b2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZfcHJpdiwgc2l6ZSk7CiAJaWYg
KElTX0VSUihvYmopKQogCQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3VjX2Z3LmMKaW5kZXggYjljYjZmZWE5MzMyLi4zMjU3YTA1NGNiMGIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjX2Z3LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfdWNfZncuYwpAQCAtMTU5LDcgKzE1OSw4IEBAIHZvaWQgaW50ZWxfdWNfZndf
ZmV0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlnb3RvIGZhaWw7CiAJ
fQogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9mcm9tX2RhdGEoZGV2X3ByaXYsIGZ3
LT5kYXRhLCBmdy0+c2l6ZSk7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbV9m
cm9tX2RhdGEoZGV2X3ByaXYsCisJCQkJCQkgICAgIGZ3LT5kYXRhLCBmdy0+c2l6ZSk7CiAJaWYg
KElTX0VSUihvYmopKSB7CiAJCWVyciA9IFBUUl9FUlIob2JqKTsKIAkJRFJNX0RFQlVHX0RSSVZF
UigiJXMgZncgb2JqZWN0X2NyZWF0ZSBlcnI9JWRcbiIsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwppbmRleCAxZTFmODMzMjZhOTYuLmNlNGVjODc2OThmNiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0xMzkw
LDcgKzEzOTAsNyBAQCBzdGF0aWMgaW50IGlndF9wcGd0dF9nZW1mc19odWdlKHZvaWQgKmFyZykK
IAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShzaXplcyk7ICsraSkgewogCQl1bnNpZ25lZCBp
bnQgc2l6ZSA9IHNpemVzW2ldOwogCi0JCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUoaTkx
NSwgc2l6ZSk7CisJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oaTkxNSwgc2l6
ZSk7CiAJCWlmIChJU19FUlIob2JqKSkKIAkJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKQEAgLTE1
NjgsNyArMTU2OCw3IEBAIHN0YXRpYyBpbnQgaWd0X3RtcGZzX2ZhbGxiYWNrKHZvaWQgKmFyZykK
IAogCWk5MTUtPm1tLmdlbWZzID0gTlVMTDsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVh
dGUoaTkxNSwgUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVt
KGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihvYmopKSB7CiAJCWVyciA9IFBUUl9FUlIo
b2JqKTsKIAkJZ290byBvdXRfcmVzdG9yZTsKQEAgLTE2MjgsNyArMTYyOCw3IEBAIHN0YXRpYyBp
bnQgaWd0X3Nocmlua190aHAodm9pZCAqYXJnKQogCQlyZXR1cm4gMDsKIAl9CiAKLQlvYmogPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlKGk5MTUsIFNaXzJNKTsKKwlvYmogPSBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX3NobWVtKGk5MTUsIFNaXzJNKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVy
biBQVFJfRVJSKG9iaik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2dlbV9kbWFidWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2dlbV9kbWFidWYuYwppbmRleCAyYjk0M2VlMjQ2YzkuLmNjNjVhNTAzZTJmMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2RtYWJ1Zi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9kbWFidWYuYwpAQCAt
MzMsNyArMzMsNyBAQCBzdGF0aWMgaW50IGlndF9kbWFidWZfZXhwb3J0KHZvaWQgKmFyZykKIAlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBkbWFfYnVmICpkbWFidWY7
CiAKLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlKGk5MTUsIFBBR0VfU0laRSk7CisJb2Jq
ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBQQUdFX1NJWkUpOwogCWlmIChJ
U19FUlIob2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIApAQCAtNTcsNyArNTcsNyBAQCBz
dGF0aWMgaW50IGlndF9kbWFidWZfaW1wb3J0X3NlbGYodm9pZCAqYXJnKQogCXN0cnVjdCBkbWFf
YnVmICpkbWFidWY7CiAJaW50IGVycjsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUo
aTkxNSwgUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGk5
MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4gUFRSX0VSUihvYmop
OwogCkBAIC0yMzIsNyArMjMyLDcgQEAgc3RhdGljIGludCBpZ3RfZG1hYnVmX2V4cG9ydF92bWFw
KHZvaWQgKmFyZykKIAl2b2lkICpwdHI7CiAJaW50IGVycjsKIAotCW9iaiA9IGk5MTVfZ2VtX29i
amVjdF9jcmVhdGUoaTkxNSwgUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX3NobWVtKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4g
UFRSX0VSUihvYmopOwogCkBAIC0yNzksNyArMjc5LDcgQEAgc3RhdGljIGludCBpZ3RfZG1hYnVm
X2V4cG9ydF9rbWFwKHZvaWQgKmFyZykKIAl2b2lkICpwdHI7CiAJaW50IGVycjsKIAotCW9iaiA9
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUoaTkxNSwgMipQQUdFX1NJWkUpOworCW9iaiA9IGk5MTVf
Z2VtX29iamVjdF9jcmVhdGVfc2htZW0oaTkxNSwgMiAqIFBBR0VfU0laRSk7CiAJaWYgKElTX0VS
UihvYmopKQogCQlyZXR1cm4gUFRSX0VSUihvYmopOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggYjkyNmQxY2QxNjVkLi5hMGY1
OWZiMGQ3MDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2dlbV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9n
ZW1fb2JqZWN0LmMKQEAgLTM2LDcgKzM2LDcgQEAgc3RhdGljIGludCBpZ3RfZ2VtX29iamVjdCh2
b2lkICphcmcpCiAKIAkvKiBCYXNpYyB0ZXN0IHRvIGVuc3VyZSB3ZSBjYW4gY3JlYXRlIGFuIG9i
amVjdCAqLwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShpOTE1LCBQQUdFX1NJWkUp
OworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oaTkxNSwgUEFHRV9TSVpFKTsK
IAlpZiAoSVNfRVJSKG9iaikpIHsKIAkJZXJyID0gUFRSX0VSUihvYmopOwogCQlwcl9lcnIoImk5
MTVfZ2VtX29iamVjdF9jcmVhdGUgZmFpbGVkLCBlcnI9JWRcbiIsIGVycik7CkBAIC01OSw3ICs1
OSw3IEBAIHN0YXRpYyBpbnQgaWd0X3BoeXNfb2JqZWN0KHZvaWQgKmFyZykKIAkgKiBpLmUuIGV4
ZXJjaXNlIHRoZSBpOTE1X2dlbV9vYmplY3RfcGh5cyBBUEkuCiAJICovCiAKLQlvYmogPSBpOTE1
X2dlbV9vYmplY3RfY3JlYXRlKGk5MTUsIFBBR0VfU0laRSk7CisJb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIob2JqKSkgewog
CQllcnIgPSBQVFJfRVJSKG9iaik7CiAJCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZSBm
YWlsZWQsIGVycj0lZFxuIiwgZXJyKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

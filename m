Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A3C70A4E1C
	for <lists+intel-gfx@lfdr.de>; Mon,  2 Sep 2019 06:03:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C02BA89ADC;
	Mon,  2 Sep 2019 04:03:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 62B4E89AA7
 for <intel-gfx@lists.freedesktop.org>; Mon,  2 Sep 2019 04:03:24 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18339008-1500050 
 for multiple; Mon, 02 Sep 2019 05:03:06 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  2 Sep 2019 05:02:45 +0100
Message-Id: <20190902040303.14195-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190902040303.14195-1-chris@chris-wilson.co.uk>
References: <20190902040303.14195-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 03/21] drm/i915/execlists: Ignore lost
 completion events
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWNlbGFrZSBoaXQgYW4gaXNzdWUgd2hlcmUgaXQgbWlzc2VkIHJlcG9ydGluZyBhIGNvbXBsZXRp
b24gZXZlbnQgYW5kCmluc3RlYWQganVtcGVkIHN0cmFpZ2h0IHRvIGEgaWRsZS0+YWN0aXZlIGV2
ZW50IChza2lwcGluZyBvdmVyIHRoZQphY3RpdmUtPmlkbGUgYW5kIG5vdCBldmVuIGhpdHRpbmcg
dGhlIGxpdGUtcmVzdG9yZSBwcmVlbXB0aW9uKS4KCjY2MTQ5NzUxMXVzIDogcHJvY2Vzc19jc2I6
IHJjczAgY3MtaXJxIGhlYWQ9MTEsIHRhaWw9MAo2NjE0OTc1MTJ1cyA6IHByb2Nlc3NfY3NiOiBy
Y3MwIGNzYlswXTogc3RhdHVzPTB4MTAwMDgwMDI6MHgwMDAwMDAyMCBbbGl0ZS1yZXN0b3JlXQo2
NjE0OTc1MTJ1cyA6IHRyYWNlX3BvcnRzOiByY3MwOiBwcmVlbXB0ZWQgeyAyOGNjODoxMTA1Miwg
MDowIH0KNjYxNDk3NTEzdXMgOiB0cmFjZV9wb3J0czogcmNzMDogcHJvbW90ZSB7IDI4Y2M4OjEx
MDU0LCAwOjAgfQo2NjE0OTc1MTR1cyA6IF9faTkxNV9yZXF1ZXN0X3N1Ym1pdDogcmNzMCBmZW5j
ZSAyOGNjODoxMTA1NiwgY3VycmVudCAxMTA1Mgo2NjE0OTc1MTR1cyA6IF9fZXhlY2xpc3RzX3N1
Ym1pc3Npb25fdGFza2xldDogcmNzMDogcXVldWVfcHJpb3JpdHlfaGludDotMjE0NzQ4MzY0OCwg
c3VibWl0Onllcwo2NjE0OTc1MTV1cyA6IHRyYWNlX3BvcnRzOiByY3MwOiBzdWJtaXQgeyAyOGNj
ODoxMTA1NiwgMDowIH0KNjYxNDk3NTMwdXMgOiBwcm9jZXNzX2NzYjogcmNzMCBjcy1pcnEgaGVh
ZD0wLCB0YWlsPTEKNjYxNDk3NTMwdXMgOiBwcm9jZXNzX2NzYjogcmNzMCBjc2JbMV06IHN0YXR1
cz0weDEwMDA4MDAyOjB4MDAwMDAwMjAgW2xpdGUtcmVzdG9yZV0KNjYxNDk3NTMxdXMgOiB0cmFj
ZV9wb3J0czogcmNzMDogcHJlZW1wdGVkIHsgMjhjYzg6MTEwNTQhLCAwOjAgfQo2NjE0OTc1MzV1
cyA6IHRyYWNlX3BvcnRzOiByY3MwOiBwcm9tb3RlIHsgMjhjYzg6MTEwNTYsIDA6MCB9CjY2MTQ5
NzU0MHVzIDogX19pOTE1X3JlcXVlc3Rfc3VibWl0OiByY3MwIGZlbmNlIDI4Y2M4OjExMDU4LCBj
dXJyZW50IDExMDU0CjY2MTQ5NzU0NHVzIDogX19leGVjbGlzdHNfc3VibWlzc2lvbl90YXNrbGV0
OiByY3MwOiBxdWV1ZV9wcmlvcml0eV9oaW50Oi0yMTQ3NDgzNjQ4LCBzdWJtaXQ6eWVzCjY2MTQ5
NzU0NXVzIDogdHJhY2VfcG9ydHM6IHJjczA6IHN1Ym1pdCB7IDI4Y2M4OjExMDU4LCAwOjAgfQo2
NjE0OTc1NTN1cyA6IHByb2Nlc3NfY3NiOiByY3MwIGNzLWlycSBoZWFkPTEsIHRhaWw9Mgo2NjE0
OTc1NTN1cyA6IHByb2Nlc3NfY3NiOiByY3MwIGNzYlsyXTogc3RhdHVzPTB4MTAwMDAwMDE6MHgw
MDAwMDAwMCBbaWRsZS0+YWN0aXZlXQo2NjE0OTc1NzR1cyA6IHByb2Nlc3NfY3NiOiBwcm9jZXNz
X2NzYjoxNTM4IEdFTV9CVUdfT04oKmV4ZWNsaXN0cy0+YWN0aXZlKQoKU2lnbmVkLW9mZi1ieTog
Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBNaWthIEt1b3BwYWxh
IDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYyB8IDYzICsrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0tCiAxIGZp
bGUgY2hhbmdlZCwgMTggaW5zZXJ0aW9ucygrKSwgNDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCA4N2I3NDczYTZkZmIuLjE0YTRkZjQ1ZTExNiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTY5Myw2ICs2OTMsOSBAQCB0cmFjZV9w
b3J0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZXhlY2xpc3RzLAogCWNv
bnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9CiAJCWNvbnRhaW5lcl9vZihleGVj
bGlzdHMsIHR5cGVvZigqZW5naW5lKSwgZXhlY2xpc3RzKTsKIAorCWlmICghcG9ydHNbMF0pCisJ
CXJldHVybjsKKwogCUdFTV9UUkFDRSgiJXM6ICVzIHsgJWxseDolbGxkJXMsICVsbHg6JWxsZCB9
XG4iLAogCQkgIGVuZ2luZS0+bmFtZSwgbXNnLAogCQkgIHBvcnRzWzBdLT5mZW5jZS5jb250ZXh0
LApAQCAtMTM3MSwxMyArMTM3NCw2IEBAIHJlc2V0X2luX3Byb2dyZXNzKGNvbnN0IHN0cnVjdCBp
bnRlbF9lbmdpbmVfZXhlY2xpc3RzICpleGVjbGlzdHMpCiAJcmV0dXJuIHVubGlrZWx5KCFfX3Rh
c2tsZXRfaXNfZW5hYmxlZCgmZXhlY2xpc3RzLT50YXNrbGV0KSk7CiB9CiAKLWVudW0gY3NiX3N0
ZXAgewotCUNTQl9OT1AsCi0JQ1NCX1BST01PVEUsCi0JQ1NCX1BSRUVNUFQsCi0JQ1NCX0NPTVBM
RVRFLAotfTsKLQogLyoKICAqIFN0YXJ0aW5nIHdpdGggR2VuMTIsIHRoZSBzdGF0dXMgaGFzIGEg
bmV3IGZvcm1hdDoKICAqCkBAIC0xNDA0LDcgKzE0MDAsNyBAQCBlbnVtIGNzYl9zdGVwIHsKICAq
ICAgICBiaXRzIDQ3LTU3OiBzdyBjb250ZXh0IGlkIG9mIHRoZSBscmMgdGhlIEdUIHN3aXRjaGVk
IGF3YXkgZnJvbQogICogICAgIGJpdHMgNTgtNjM6IHN3IGNvdW50ZXIgb2YgdGhlIGxyYyB0aGUg
R1Qgc3dpdGNoZWQgYXdheSBmcm9tCiAgKi8KLXN0YXRpYyBpbmxpbmUgZW51bSBjc2Jfc3RlcAor
c3RhdGljIGlubGluZSBib29sCiBnZW4xMl9jc2JfcGFyc2UoY29uc3Qgc3RydWN0IGludGVsX2Vu
Z2luZV9leGVjbGlzdHMgKmV4ZWNsaXN0cywgY29uc3QgdTMyICpjc2IpCiB7CiAJdTMyIGxvd2Vy
X2R3ID0gY3NiWzBdOwpAQCAtMTQxNCw3ICsxNDEwLDcgQEAgZ2VuMTJfY3NiX3BhcnNlKGNvbnN0
IHN0cnVjdCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzICpleGVjbGlzdHMsIGNvbnN0IHUzMiAqY3Ni
KQogCWJvb2wgbmV3X3F1ZXVlID0gbG93ZXJfZHcgJiBHRU4xMl9DVFhfU1RBVFVTX1NXSVRDSEVE
X1RPX05FV19RVUVVRTsKIAogCWlmICghY3R4X2F3YXlfdmFsaWQgJiYgY3R4X3RvX3ZhbGlkKQot
CQlyZXR1cm4gQ1NCX1BST01PVEU7CisJCXJldHVybiB0cnVlOwogCiAJLyoKIAkgKiBUaGUgY29u
dGV4dCBzd2l0Y2ggZGV0YWlsIGlzIG5vdCBndWFyYW50ZWVkIHRvIGJlIDUgd2hlbiBhIHByZWVt
cHRpb24KQEAgLTE0MjQsNyArMTQyMCw3IEBAIGdlbjEyX2NzYl9wYXJzZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZXhlY2xpc3RzLCBjb25zdCB1MzIgKmNzYikKIAkgKiB3
b3VsZCByZXF1aXJlIHNvbWUgZXh0cmEgaGFuZGxpbmcsIGJ1dCB3ZSBkb24ndCBzdXBwb3J0IHRo
YXQuCiAJICovCiAJaWYgKG5ld19xdWV1ZSAmJiBjdHhfYXdheV92YWxpZCkKLQkJcmV0dXJuIENT
Ql9QUkVFTVBUOworCQlyZXR1cm4gdHJ1ZTsKIAogCS8qCiAJICogc3dpdGNoIGRldGFpbCA9IDUg
aXMgY292ZXJlZCBieSB0aGUgY2FzZSBhYm92ZSBhbmQgd2UgZG8gbm90IGV4cGVjdCBhCkBAIC0x
NDMzLDI5ICsxNDI5LDEzIEBAIGdlbjEyX2NzYl9wYXJzZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2V4ZWNsaXN0cyAqZXhlY2xpc3RzLCBjb25zdCB1MzIgKmNzYikKIAkgKi8KIAlHRU1fQlVH
X09OKEdFTjEyX0NUWF9TV0lUQ0hfREVUQUlMKHVwcGVyX2R3KSk7CiAKLQlpZiAoKmV4ZWNsaXN0
cy0+YWN0aXZlKSB7Ci0JCUdFTV9CVUdfT04oIWN0eF9hd2F5X3ZhbGlkKTsKLQkJcmV0dXJuIENT
Ql9DT01QTEVURTsKLQl9Ci0KLQlyZXR1cm4gQ1NCX05PUDsKKwlyZXR1cm4gZmFsc2U7CiB9CiAK
LXN0YXRpYyBpbmxpbmUgZW51bSBjc2Jfc3RlcAorc3RhdGljIGlubGluZSBib29sCiBnZW44X2Nz
Yl9wYXJzZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZXhlY2xpc3RzLCBj
b25zdCB1MzIgKmNzYikKIHsKLQl1bnNpZ25lZCBpbnQgc3RhdHVzID0gKmNzYjsKLQotCWlmIChz
dGF0dXMgJiBHRU44X0NUWF9TVEFUVVNfSURMRV9BQ1RJVkUpCi0JCXJldHVybiBDU0JfUFJPTU9U
RTsKLQotCWlmIChzdGF0dXMgJiBHRU44X0NUWF9TVEFUVVNfUFJFRU1QVEVEKQotCQlyZXR1cm4g
Q1NCX1BSRUVNUFQ7Ci0KLQlpZiAoKmV4ZWNsaXN0cy0+YWN0aXZlKQotCQlyZXR1cm4gQ1NCX0NP
TVBMRVRFOwotCi0JcmV0dXJuIENTQl9OT1A7CisJcmV0dXJuICpjc2IgJiAoR0VOOF9DVFhfU1RB
VFVTX0lETEVfQUNUSVZFIHwgR0VOOF9DVFhfU1RBVFVTX1BSRUVNUFRFRCk7CiB9CiAKIHN0YXRp
YyB2b2lkIHByb2Nlc3NfY3NiKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKQEAgLTE0
OTQsNyArMTQ3NCw3IEBAIHN0YXRpYyB2b2lkIHByb2Nlc3NfY3NiKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIAlybWIoKTsKIAogCWRvIHsKLQkJZW51bSBjc2Jfc3RlcCBjc2Jfc3Rl
cDsKKwkJYm9vbCBwcm9tb3RlOwogCiAJCWlmICgrK2hlYWQgPT0gbnVtX2VudHJpZXMpCiAJCQlo
ZWFkID0gMDsKQEAgLTE1MjIsMjAgKzE1MDIsMTYgQEAgc3RhdGljIHZvaWQgcHJvY2Vzc19jc2Io
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQkJICBidWZbMiAqIGhlYWQgKyAwXSwg
YnVmWzIgKiBoZWFkICsgMV0pOwogCiAJCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSAx
MikKLQkJCWNzYl9zdGVwID0gZ2VuMTJfY3NiX3BhcnNlKGV4ZWNsaXN0cywgYnVmICsgMiAqIGhl
YWQpOworCQkJcHJvbW90ZSA9IGdlbjEyX2NzYl9wYXJzZShleGVjbGlzdHMsIGJ1ZiArIDIgKiBo
ZWFkKTsKIAkJZWxzZQotCQkJY3NiX3N0ZXAgPSBnZW44X2NzYl9wYXJzZShleGVjbGlzdHMsIGJ1
ZiArIDIgKiBoZWFkKTsKLQotCQlzd2l0Y2ggKGNzYl9zdGVwKSB7Ci0JCWNhc2UgQ1NCX1BSRUVN
UFQ6IC8qIGNhbmNlbCBvbGQgaW5mbGlnaHQsIHByZXBhcmUgZm9yIHN3aXRjaCAqLworCQkJcHJv
bW90ZSA9IGdlbjhfY3NiX3BhcnNlKGV4ZWNsaXN0cywgYnVmICsgMiAqIGhlYWQpOworCQlpZiAo
cHJvbW90ZSkgeworCQkJLyogY2FuY2VsIG9sZCBpbmZsaWdodCwgcHJlcGFyZSBmb3Igc3dpdGNo
ICovCiAJCQl0cmFjZV9wb3J0cyhleGVjbGlzdHMsICJwcmVlbXB0ZWQiLCBleGVjbGlzdHMtPmFj
dGl2ZSk7Ci0KIAkJCXdoaWxlICgqZXhlY2xpc3RzLT5hY3RpdmUpCiAJCQkJZXhlY2xpc3RzX3Nj
aGVkdWxlX291dCgqZXhlY2xpc3RzLT5hY3RpdmUrKyk7CiAKLQkJCS8qIGZhbGx0aHJvdWdoICov
Ci0JCWNhc2UgQ1NCX1BST01PVEU6IC8qIHN3aXRjaCBwZW5kaW5nIHRvIGluZmxpZ2h0ICovCi0J
CQlHRU1fQlVHX09OKCpleGVjbGlzdHMtPmFjdGl2ZSk7CisJCQkvKiBzd2l0Y2ggcGVuZGluZyB0
byBpbmZsaWdodCAqLwogCQkJR0VNX0JVR19PTighYXNzZXJ0X3BlbmRpbmdfdmFsaWQoZXhlY2xp
c3RzLCAicHJvbW90ZSIpKTsKIAkJCWV4ZWNsaXN0cy0+YWN0aXZlID0KIAkJCQltZW1jcHkoZXhl
Y2xpc3RzLT5pbmZsaWdodCwKQEAgLTE1NTAsOSArMTUyNiwxMCBAQCBzdGF0aWMgdm9pZCBwcm9j
ZXNzX2NzYihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCQkJcmluZ19zZXRfcGF1
c2VkKGVuZ2luZSwgMCk7CiAKIAkJCVdSSVRFX09OQ0UoZXhlY2xpc3RzLT5wZW5kaW5nWzBdLCBO
VUxMKTsKLQkJCWJyZWFrOworCQl9IGVsc2UgeworCQkJR0VNX0JVR19PTighKmV4ZWNsaXN0cy0+
YWN0aXZlKTsKIAotCQljYXNlIENTQl9DT01QTEVURTogLyogcG9ydDAgY29tcGxldGVkLCBhZHZh
bmNlZCB0byBwb3J0MSAqLworCQkJLyogcG9ydDAgY29tcGxldGVkLCBhZHZhbmNlZCB0byBwb3J0
MSAqLwogCQkJdHJhY2VfcG9ydHMoZXhlY2xpc3RzLCAiY29tcGxldGVkIiwgZXhlY2xpc3RzLT5h
Y3RpdmUpOwogCiAJCQkvKgpAQCAtMTU2NywxMCArMTU0NCw2IEBAIHN0YXRpYyB2b2lkIHByb2Nl
c3NfY3NiKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCQkJR0VNX0JVR19PTihl
eGVjbGlzdHMtPmFjdGl2ZSAtIGV4ZWNsaXN0cy0+aW5mbGlnaHQgPgogCQkJCSAgIGV4ZWNsaXN0
c19udW1fcG9ydHMoZXhlY2xpc3RzKSk7Ci0JCQlicmVhazsKLQotCQljYXNlIENTQl9OT1A6Ci0J
CQlicmVhazsKIAkJfQogCX0gd2hpbGUgKGhlYWQgIT0gdGFpbCk7CiAKLS0gCjIuMjMuMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

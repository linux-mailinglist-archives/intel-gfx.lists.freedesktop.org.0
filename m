Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 997F52F1B20
	for <lists+intel-gfx@lfdr.de>; Mon, 11 Jan 2021 17:37:56 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0C71B89E15;
	Mon, 11 Jan 2021 16:37:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0F17689E15
 for <intel-gfx@lists.freedesktop.org>; Mon, 11 Jan 2021 16:37:54 +0000 (UTC)
IronPort-SDR: 6VEvbli4E1kedLeWy4bK0XF9nxhiC8/zPgu/Wnxw9wwQy1vOyO1eyq+GS+dMc3Vv7ktTHC0f/x
 D+gbXFbrZllg==
X-IronPort-AV: E=McAfee;i="6000,8403,9861"; a="175315889"
X-IronPort-AV: E=Sophos;i="5.79,338,1602572400"; d="scan'208";a="175315889"
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 11 Jan 2021 08:37:53 -0800
IronPort-SDR: yJUQ6EqcHidxIXjzu7Yshj94oGO/MHHjZzIud7YJsyOlhF/P1yS8/8e77qHZ/CURz1keAL6Efp
 HzQPBVhluyyg==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.79,338,1602572400"; d="scan'208";a="352662042"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga008.fm.intel.com with SMTP; 11 Jan 2021 08:37:49 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Mon, 11 Jan 2021 18:37:48 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 11 Jan 2021 18:37:11 +0200
Message-Id: <20210111163711.12913-12-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20210111163711.12913-1-ville.syrjala@linux.intel.com>
References: <20210111163711.12913-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 11/11] drm/i915: Implement async flips for
 vlv/chv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkFk
ZCBzdXBwb3J0IGZvciBhc3luYyBmbGlwcyBvbiB2bHYvY2h2LiBVbmxpa2UgYWxsIHRoZSBvdGhl
cgpwbGF0Zm9ybXMgdmx2L2NodiBkbyBub3QgdXNlIHRoZSBhc3luYyBmbGlwIGJpdCBpbiBEU1BD
TlRSIGFuZAppbnN0ZWFkIHdlIHNlbGVjdCBiZXR3ZWVuIGFzeW5jIHZzLiBzeW5jIGZsaXBzIGJh
c2VkIG9uIHRoZQpzdXJmYWNlIGFkZHJlc3MgcmVnaXN0ZXIuIFRoZSBub3JtYWwgRFNQU1VSRiBn
ZW5lcmF0ZXMgc3luYwpmbGlwcyBEU1BBRERSX1ZMViBnZW5lcmF0ZXMgYXN5bmMgZmxpcHMuIEFu
ZCBhcyB1c3VhbCB0aGUKaW50ZXJydXB0IGJpdHMgYXJlIGRpZmZlcmVudCBmcm9tIHRoZSBvdGhl
ciBwbGF0Zm9ybXMuCgpDYzogS2FydGhpayBCIFMgPGthcnRoaWsuYi5zQGludGVsLmNvbT4KQ2M6
IFZhbmRpdGEgS3Vsa2FybmkgPHZhbmRpdGEua3Vsa2FybmlAaW50ZWwuY29tPgpTaWduZWQtb2Zm
LWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9wbGFuZS5jICAgIHwgNDkgKysrKysr
KysrKysrKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMgICAgICAgICAgICAg
IHwgIDMgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAgICAgIHwg
IDIgKwogNCBmaWxlcyBjaGFuZ2VkLCA1MiBpbnNlcnRpb25zKCspLCA2IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9wbGFuZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pOXh4X3BsYW5lLmMKaW5kZXggNDg4ZWQwMWJi
MzQyLi5kMzAzNzRkZjY3ZjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaTl4eF9wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9w
bGFuZS5jCkBAIC01MTcsNiArNTE3LDIzIEBAIGc0eF9wcmltYXJ5X2FzeW5jX2ZsaXAoc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwKIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+
dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKIH0KIAorc3RhdGljIHZvaWQKK3Zsdl9wcmltYXJ5X2Fz
eW5jX2ZsaXAoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJICAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgICAgICAgY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJICAgICAgIGJvb2wgYXN5bmNfZmxpcCkK
K3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5i
YXNlLmRldik7CisJdTMyIGRzcGFkZHJfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
WzBdLm9mZnNldDsKKwllbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHBsYW5lLT5pOXh4
X3BsYW5lOworCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgm
ZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIERTUEFERFJfVkxWKGk5eHhfcGxhbmUpLAorCQkJICBpbnRlbF9wbGFuZV9nZ3R0X29m
ZnNldChwbGFuZV9zdGF0ZSkgKyBkc3BhZGRyX29mZnNldCk7CisJc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Cit9CisKIHN0YXRpYyB2b2lk
CiBiZHdfcHJpbWFyeV9lbmFibGVfZmxpcF9kb25lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUp
CiB7CkBAIC01NzksNiArNTk2LDI4IEBAIGlsa19wcmltYXJ5X2Rpc2FibGVfZmxpcF9kb25lKHN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUpCiAJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5pcnFfbG9j
ayk7CiB9CiAKK3N0YXRpYyB2b2lkCit2bHZfcHJpbWFyeV9lbmFibGVfZmxpcF9kb25lKHN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlw
ZTsKKworCXNwaW5fbG9ja19pcnEoJmk5MTUtPmlycV9sb2NrKTsKKwlpOTE1X2VuYWJsZV9waXBl
c3RhdChpOTE1LCBwaXBlLCBQTEFORV9GTElQX0RPTkVfSU5UX1NUQVRVU19WTFYpOworCXNwaW5f
dW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOworfQorCitzdGF0aWMgdm9pZAordmx2X3ByaW1h
cnlfZGlzYWJsZV9mbGlwX2RvbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwll
bnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOworCisJc3Bpbl9sb2NrX2lycSgmaTkxNS0+aXJx
X2xvY2spOworCWk5MTVfZGlzYWJsZV9waXBlc3RhdChpOTE1LCBwaXBlLCBQTEFORV9GTElQX0RP
TkVfSU5UX1NUQVRVU19WTFYpOworCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+aXJxX2xvY2spOwor
fQorCiBzdGF0aWMgYm9vbCBpOXh4X3BsYW5lX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lLAogCQkJCSAgICBlbnVtIHBpcGUgKnBpcGUpCiB7CkBAIC03OTIsMTYgKzgzMSwy
MCBAQCBpbnRlbF9wcmltYXJ5X3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIGVudW0gcGlwZSBwaXBlKQogCXBsYW5lLT5nZXRfaHdfc3RhdGUgPSBpOXh4X3Bs
YW5lX2dldF9od19zdGF0ZTsKIAlwbGFuZS0+Y2hlY2tfcGxhbmUgPSBpOXh4X3BsYW5lX2NoZWNr
OwogCi0JaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKKwlpZiAoSVNfVkFMTEVZVklFVyhk
ZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpIHsKKwkJcGxhbmUtPmFzeW5jX2Zs
aXAgPSB2bHZfcHJpbWFyeV9hc3luY19mbGlwOworCQlwbGFuZS0+ZW5hYmxlX2ZsaXBfZG9uZSA9
IHZsdl9wcmltYXJ5X2VuYWJsZV9mbGlwX2RvbmU7CisJCXBsYW5lLT5kaXNhYmxlX2ZsaXBfZG9u
ZSA9IHZsdl9wcmltYXJ5X2Rpc2FibGVfZmxpcF9kb25lOworCX0gZWxzZSBpZiAoSVNfQlJPQURX
RUxMKGRldl9wcml2KSkgewogCQlwbGFuZS0+bmVlZF9hc3luY19mbGlwX2Rpc2FibGVfd2EgPSB0
cnVlOwogCQlwbGFuZS0+YXN5bmNfZmxpcCA9IGc0eF9wcmltYXJ5X2FzeW5jX2ZsaXA7CiAJCXBs
YW5lLT5lbmFibGVfZmxpcF9kb25lID0gYmR3X3ByaW1hcnlfZW5hYmxlX2ZsaXBfZG9uZTsKIAkJ
cGxhbmUtPmRpc2FibGVfZmxpcF9kb25lID0gYmR3X3ByaW1hcnlfZGlzYWJsZV9mbGlwX2RvbmU7
Ci0JfSBlbHNlIGlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19JVllCUklER0UoZGV2X3By
aXYpKSB7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDcpIHsKIAkJcGxhbmUt
PmFzeW5jX2ZsaXAgPSBnNHhfcHJpbWFyeV9hc3luY19mbGlwOwogCQlwbGFuZS0+ZW5hYmxlX2Zs
aXBfZG9uZSA9IGl2Yl9wcmltYXJ5X2VuYWJsZV9mbGlwX2RvbmU7CiAJCXBsYW5lLT5kaXNhYmxl
X2ZsaXBfZG9uZSA9IGl2Yl9wcmltYXJ5X2Rpc2FibGVfZmxpcF9kb25lOwotCX0gZWxzZSBpZiAo
SVNfR0VOX1JBTkdFKGRldl9wcml2LCA1LCA2KSkgeworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSA1KSB7CiAJCXBsYW5lLT5hc3luY19mbGlwID0gZzR4X3ByaW1hcnlfYXN5bmNf
ZmxpcDsKIAkJcGxhbmUtPmVuYWJsZV9mbGlwX2RvbmUgPSBpbGtfcHJpbWFyeV9lbmFibGVfZmxp
cF9kb25lOwogCQlwbGFuZS0+ZGlzYWJsZV9mbGlwX2RvbmUgPSBpbGtfcHJpbWFyeV9kaXNhYmxl
X2ZsaXBfZG9uZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMKaW5kZXggNjdhZGQxMTY2ZDVhLi44Y2YwNzc3NTM1Y2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0yMTIyLDkgKzIxMjIsNyBAQCBzdGF0
aWMgdW5zaWduZWQgaW50IGludGVsX2xpbmVhcl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcgogCiBzdGF0aWMgYm9vbCBoYXNfYXN5bmNfZmxpcHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JcmV0dXJuIElOVEVMX0dFTihpOTE1KSA+PSA5
IHx8IElTX0JST0FEV0VMTChpOTE1KSB8fAotCQlJU19IQVNXRUxMKGk5MTUpIHx8IElTX0lWWUJS
SURHRShpOTE1KSB8fAotCQlJU19HRU5fUkFOR0UoaTkxNSwgNSwgNik7CisJcmV0dXJuIElOVEVM
X0dFTihpOTE1KSA+PSA1OwogfQogCiBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX3N1cmZfYWxp
Z25tZW50KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
aXJxLmMKaW5kZXggOWUwNGM2YjI4YzEyLi4xOWUzNjdmNmEzYjIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9pcnEuYwpAQCAtMTUxNyw2ICsxNTE3LDkgQEAgc3RhdGljIHZvaWQgdmFsbGV5dmlld19waXBl
c3RhdF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWlm
IChwaXBlX3N0YXRzW3BpcGVdICYgUElQRV9TVEFSVF9WQkxBTktfSU5URVJSVVBUX1NUQVRVUykK
IAkJCWludGVsX2hhbmRsZV92YmxhbmsoZGV2X3ByaXYsIHBpcGUpOwogCisJCWlmIChwaXBlX3N0
YXRzW3BpcGVdICYgUExBTkVfRkxJUF9ET05FX0lOVF9TVEFUVVNfVkxWKQorCQkJZmxpcF9kb25l
X2hhbmRsZXIoZGV2X3ByaXYsIHBpcGUpOworCiAJCWlmIChwaXBlX3N0YXRzW3BpcGVdICYgUElQ
RV9DUkNfRE9ORV9JTlRFUlJVUFRfU1RBVFVTKQogCQkJaTl4eF9waXBlX2NyY19pcnFfaGFuZGxl
cihkZXZfcHJpdiwgcGlwZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IDI2NDY0Nzg5
NjNhNS4uMjE1ODk1MThkZTczIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlZy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAgLTY1NzgsNiAr
NjU3OCw3IEBAIGVudW0gewogI2RlZmluZSBUR0xfQ1VSU09SX0RfT0ZGU0VUIDB4NzMwODAKIAog
LyogRGlzcGxheSBBIGNvbnRyb2wgKi8KKyNkZWZpbmUgX0RTUEFBRERSX1ZMVgkJCQkweDcwMTdD
IC8qIHZsdi9jaHYgKi8KICNkZWZpbmUgX0RTUEFDTlRSCQkJCTB4NzAxODAKICNkZWZpbmUgICBE
SVNQTEFZX1BMQU5FX0VOQUJMRQkJCSgxIDw8IDMxKQogI2RlZmluZSAgIERJU1BMQVlfUExBTkVf
RElTQUJMRQkJCTAKQEAgLTY2MjYsNiArNjYyNyw3IEBAIGVudW0gewogI2RlZmluZSBfRFNQQVNV
UkZMSVZFCQkJCTB4NzAxQUMKICNkZWZpbmUgX0RTUEFHQU1DCQkJCTB4NzAxRTAKIAorI2RlZmlu
ZSBEU1BBRERSX1ZMVihwbGFuZSkJX01NSU9fUElQRTIocGxhbmUsIF9EU1BBQUREUl9WTFYpCiAj
ZGVmaW5lIERTUENOVFIocGxhbmUpCQlfTU1JT19QSVBFMihwbGFuZSwgX0RTUEFDTlRSKQogI2Rl
ZmluZSBEU1BBRERSKHBsYW5lKQkJX01NSU9fUElQRTIocGxhbmUsIF9EU1BBQUREUikKICNkZWZp
bmUgRFNQU1RSSURFKHBsYW5lKQlfTU1JT19QSVBFMihwbGFuZSwgX0RTUEFTVFJJREUpCi0tIAoy
LjI2LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

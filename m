Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6F8EF88C80
	for <lists+intel-gfx@lfdr.de>; Sat, 10 Aug 2019 19:43:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 755E06E44C;
	Sat, 10 Aug 2019 17:43:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 870DF6E44C
 for <intel-gfx@lists.freedesktop.org>; Sat, 10 Aug 2019 17:43:53 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17954769-1500050 
 for multiple; Sat, 10 Aug 2019 18:43:39 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 10 Aug 2019 18:43:38 +0100
Message-Id: <20190810174338.19810-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/blt: support copying objects
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgoKV2UgY2FuIGFscmVh
ZHkgY2xlYXIgYW4gb2JqZWN0IHdpdGggdGhlIGJsdCwgc28gdHJ5IHRvIGRvIHRoZSBzYW1lIHRv
CnN1cHBvcnQgY29weWluZyBmcm9tIG9uZSBvYmplY3QgYmFja2luZyBzdG9yZSB0byBhbm90aGVy
LiBSZWFsbHkgdGhpcyBpcwpqdXN0IG9iamVjdCAtPiBvYmplY3QsIHdoaWNoIGlzIG5vdCB0aGF0
IHVzZWZ1bCB5ZXQsIHdoYXQgd2UgcmVhbGx5IHdhbnQKaXMgdHdvIGJhY2tpbmcgc3RvcmVzLCBi
dXQgdGhhdCB3aWxsIHJlcXVpcmUgc29tZSB2bWEgcmV3b3JrIGZpcnN0LApvdGhlcndpc2Ugd2Ug
YXJlIHN0dWNrIHdpdGggInRtcCIgb2JqZWN0cy4KClNpZ25lZC1vZmYtYnk6IE1hdHRoZXcgQXVs
ZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4KQ2M6IEpvb25hcyBMYWh0aW5lbiA8am9vbmFzLmxh
aHRpbmVuQGxpbnV4LmludGVsLmNvbT4KQ2M6IEFiZGllbCBKYW51bGd1ZSA8YWJkaWVsLmphbnVs
Z3VlQGxpbnV4LmludGVsLmNvbQotLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdF9ibHQuYyAgICB8IDIwNSArKysrKysrKysrKysrKysrKy0KIC4uLi9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdF9ibHQuaCAgICB8ICAgOCArCiAuLi4vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYyAgfCAxMDYgKysrKysrKysrCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyAgICB8ICAgMiArLQogNSBmaWxlcyBjaGFuZ2Vk
LCAzMjIgaW5zZXJ0aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X2JsdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF9ibHQuYwppbmRleCBkM2MyNjM5NTU4ZDEuLjc4NDU4
NWFmYWMyNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
X2JsdC5jCkBAIC0zMyw4ICszMywxMCBAQCBzdHJ1Y3QgaTkxNV92bWEgKmludGVsX2VtaXRfdm1h
X2ZpbGxfYmx0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAlzaXplID0gKDEgKyA4ICogY291
bnQpICogc2l6ZW9mKHUzMik7CiAJc2l6ZSA9IHJvdW5kX3VwKHNpemUsIFBBR0VfU0laRSk7CiAJ
cG9vbCA9IGludGVsX2VuZ2luZV9wb29sX2dldCgmY2UtPmVuZ2luZS0+cG9vbCwgc2l6ZSk7Ci0J
aWYgKElTX0VSUihwb29sKSkKKwlpZiAoSVNfRVJSKHBvb2wpKSB7CisJCWVyciA9IFBUUl9FUlIo
cG9vbCk7CiAJCWdvdG8gb3V0X3BtOworCX0KIAogCWNtZCA9IGk5MTVfZ2VtX29iamVjdF9waW5f
bWFwKHBvb2wtPm9iaiwgSTkxNV9NQVBfV0MpOwogCWlmIChJU19FUlIoY21kKSkgewpAQCAtMTg5
LDYgKzE5MSwyMDcgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9maWxsX2JsdChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCXJldHVybiBlcnI7CiB9CiAKK3N0cnVjdCBpOTE1X3ZtYSAq
aW50ZWxfZW1pdF92bWFfY29weV9ibHQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJCQkg
c3RydWN0IGk5MTVfdm1hICpzcmMsCisJCQkJCSBzdHJ1Y3QgaTkxNV92bWEgKmRzdCkKK3sKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGNlLT52bS0+aTkxNTsKKwljb25zdCB1MzIg
YmxvY2tfc2l6ZSA9IFMxNl9NQVggKiBQQUdFX1NJWkU7CisJc3RydWN0IGludGVsX2VuZ2luZV9w
b29sX25vZGUgKnBvb2w7CisJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKKwl1NjQgc3JjX29mZnNl
dCwgZHN0X29mZnNldDsKKwl1NjQgY291bnQsIHJlbTsKKwl1MzIgc2l6ZSwgKmNtZDsKKwlpbnQg
ZXJyOworCisJR0VNX0JVR19PTihzcmMtPnNpemUgIT0gZHN0LT5zaXplKTsKKworCUdFTV9CVUdf
T04oaW50ZWxfZW5naW5lX2lzX3ZpcnR1YWwoY2UtPmVuZ2luZSkpOworCWludGVsX2VuZ2luZV9w
bV9nZXQoY2UtPmVuZ2luZSk7CisKKwljb3VudCA9IGRpdl91NjQoZHN0LT5zaXplLCBibG9ja19z
aXplKTsKKwlzaXplID0gKDEgKyAxMSAqIGNvdW50KSAqIHNpemVvZih1MzIpOworCXNpemUgPSBy
b3VuZF91cChzaXplLCBQQUdFX1NJWkUpOworCXBvb2wgPSBpbnRlbF9lbmdpbmVfcG9vbF9nZXQo
JmNlLT5lbmdpbmUtPnBvb2wsIHNpemUpOworCWlmIChJU19FUlIocG9vbCkpIHsKKwkJZXJyID0g
UFRSX0VSUihwb29sKTsKKwkJZ290byBvdXRfcG07CisJfQorCisJY21kID0gaTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9tYXAocG9vbC0+b2JqLCBJOTE1X01BUF9XQyk7CisJaWYgKElTX0VSUihjbWQpKSB7
CisJCWVyciA9IFBUUl9FUlIoY21kKTsKKwkJZ290byBvdXRfcHV0OworCX0KKworCXJlbSA9IHNy
Yy0+c2l6ZTsKKwlzcmNfb2Zmc2V0ID0gc3JjLT5ub2RlLnN0YXJ0OworCWRzdF9vZmZzZXQgPSBk
c3QtPm5vZGUuc3RhcnQ7CisKKwlkbyB7CisJCXNpemUgPSBtaW5fdCh1NjQsIHJlbSwgYmxvY2tf
c2l6ZSk7CisJCUdFTV9CVUdfT04oc2l6ZSA+PiBQQUdFX1NISUZUID4gUzE2X01BWCk7CisKKwkJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA5KSB7CisJCQkqY21kKysgPSBHRU45X1hZX0ZBU1RfQ09Q
WV9CTFRfQ01EIHwgKDEwIC0gMik7CisJCQkqY21kKysgPSBCTFRfREVQVEhfMzIgfCBQQUdFX1NJ
WkU7CisJCQkqY21kKysgPSAwOworCQkJKmNtZCsrID0gc2l6ZSA+PiBQQUdFX1NISUZUIDw8IDE2
IHwgUEFHRV9TSVpFIC8gNDsKKwkJCSpjbWQrKyA9IGxvd2VyXzMyX2JpdHMoZHN0X29mZnNldCk7
CisJCQkqY21kKysgPSB1cHBlcl8zMl9iaXRzKGRzdF9vZmZzZXQpOworCQkJKmNtZCsrID0gMDsK
KwkJCSpjbWQrKyA9IFBBR0VfU0laRTsKKwkJCSpjbWQrKyA9IGxvd2VyXzMyX2JpdHMoc3JjX29m
ZnNldCk7CisJCQkqY21kKysgPSB1cHBlcl8zMl9iaXRzKHNyY19vZmZzZXQpOworCQl9IGVsc2Ug
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KSB7CisJCQkqY21kKysgPSBYWV9TUkNfQ09QWV9CTFRf
Q01EIHwgQkxUX1dSSVRFX1JHQkEgfCAoMTAgLSAyKTsKKwkJCSpjbWQrKyA9IEJMVF9ERVBUSF8z
MiB8IEJMVF9ST1BfU1JDX0NPUFkgfCBQQUdFX1NJWkU7CisJCQkqY21kKysgPSAwOworCQkJKmNt
ZCsrID0gc2l6ZSA+PiBQQUdFX1NISUZUIDw8IDE2IHwgUEFHRV9TSVpFIC8gNDsKKwkJCSpjbWQr
KyA9IGxvd2VyXzMyX2JpdHMoZHN0X29mZnNldCk7CisJCQkqY21kKysgPSB1cHBlcl8zMl9iaXRz
KGRzdF9vZmZzZXQpOworCQkJKmNtZCsrID0gMDsKKwkJCSpjbWQrKyA9IFBBR0VfU0laRTsKKwkJ
CSpjbWQrKyA9IGxvd2VyXzMyX2JpdHMoc3JjX29mZnNldCk7CisJCQkqY21kKysgPSB1cHBlcl8z
Ml9iaXRzKHNyY19vZmZzZXQpOworCQl9IGVsc2UgeworCQkJKmNtZCsrID0gU1JDX0NPUFlfQkxU
X0NNRCB8IEJMVF9XUklURV9SR0JBIHwgKDYgLSAyKTsKKwkJCSpjbWQrKyA9IEJMVF9ERVBUSF8z
MiB8IEJMVF9ST1BfU1JDX0NPUFkgfCBQQUdFX1NJWkU7CisJCQkqY21kKysgPSBzaXplID4+IFBB
R0VfU0hJRlQgPDwgMTYgfCBQQUdFX1NJWkU7CisJCQkqY21kKysgPSBkc3Rfb2Zmc2V0OworCQkJ
KmNtZCsrID0gUEFHRV9TSVpFOworCQkJKmNtZCsrID0gc3JjX29mZnNldDsKKwkJfQorCisJCS8q
IEFsbG93IG91cnNlbHZlcyB0byBiZSBwcmVlbXB0ZWQgaW4gYmV0d2VlbiBibG9ja3MuICovCisJ
CSpjbWQrKyA9IE1JX0FSQl9DSEVDSzsKKworCQlzcmNfb2Zmc2V0ICs9IHNpemU7CisJCWRzdF9v
ZmZzZXQgKz0gc2l6ZTsKKwkJcmVtIC09IHNpemU7CisJfSB3aGlsZSAocmVtKTsKKworCSpjbWQg
PSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCWludGVsX2d0X2NoaXBzZXRfZmx1c2goY2UtPnZtLT5n
dCk7CisKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHBvb2wtPm9iaik7CisKKwliYXRjaCA9
IGk5MTVfdm1hX2luc3RhbmNlKHBvb2wtPm9iaiwgY2UtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJS
KGJhdGNoKSkgeworCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKKwkJZ290byBvdXRfcHV0OworCX0K
KworCWVyciA9IGk5MTVfdm1hX3BpbihiYXRjaCwgMCwgMCwgUElOX1VTRVIpOworCWlmICh1bmxp
a2VseShlcnIpKQorCQlnb3RvIG91dF9wdXQ7CisKKwliYXRjaC0+cHJpdmF0ZSA9IHBvb2w7CisJ
cmV0dXJuIGJhdGNoOworCitvdXRfcHV0OgorCWludGVsX2VuZ2luZV9wb29sX3B1dChwb29sKTsK
K291dF9wbToKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGNlLT5lbmdpbmUpOworCXJldHVybiBFUlJf
UFRSKGVycik7Cit9CisKK3N0YXRpYyBpbnQgbW92ZV90b19ncHUoc3RydWN0IGk5MTVfdm1hICp2
bWEsIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBib29sIHdyaXRlKQoreworCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKKworCWlmIChvYmotPmNhY2hlX2RpcnR5
ICYgfm9iai0+Y2FjaGVfY29oZXJlbnQpCisJCWk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0KG9iaiwg
MCk7CisKKwlyZXR1cm4gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgb2JqLCB3cml0ZSk7
Cit9CisKK2ludCBpOTE1X2dlbV9vYmplY3RfY29weV9ibHQoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKnNyYywKKwkJCSAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmRzdCwKKwkJ
CSAgICAgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXN0cnVjdCBkcm1fZ2VtX29iamVj
dCAqb2Jqc1tdID0geyAmc3JjLT5iYXNlLCAmZHN0LT5iYXNlIH07CisJc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0gPSBjZS0+dm07CisJc3RydWN0IGk5MTVfdm1hICp2bWFbMl0sICpiYXRj
aDsKKwlzdHJ1Y3Qgd3dfYWNxdWlyZV9jdHggYWNxdWlyZTsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKKwlpbnQgZXJyLCBpOworCisJdm1hWzBdID0gaTkxNV92bWFfaW5zdGFuY2Uoc3JjLCB2
bSwgTlVMTCk7CisJaWYgKElTX0VSUih2bWFbMF0pKQorCQlyZXR1cm4gUFRSX0VSUih2bWFbMF0p
OworCisJZXJyID0gaTkxNV92bWFfcGluKHZtYVswXSwgMCwgMCwgUElOX1VTRVIpOworCWlmICh1
bmxpa2VseShlcnIpKQorCQlyZXR1cm4gZXJyOworCisJdm1hWzFdID0gaTkxNV92bWFfaW5zdGFu
Y2UoZHN0LCB2bSwgTlVMTCk7CisJaWYgKElTX0VSUih2bWFbMV0pKQorCQlnb3RvIG91dF91bnBp
bl9zcmM7CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hWzFdLCAwLCAwLCBQSU5fVVNFUik7CisJ
aWYgKHVubGlrZWx5KGVycikpCisJCWdvdG8gb3V0X3VucGluX3NyYzsKKworCWJhdGNoID0gaW50
ZWxfZW1pdF92bWFfY29weV9ibHQoY2UsIHZtYVswXSwgdm1hWzFdKTsKKwlpZiAoSVNfRVJSKGJh
dGNoKSkgeworCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKKwkJZ290byBvdXRfdW5waW5fZHN0Owor
CX0KKworCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CisJaWYgKElTX0VS
UihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gb3V0X2JhdGNoOworCX0KKwor
CWVyciA9IGludGVsX2VtaXRfdm1hX21hcmtfYWN0aXZlKGJhdGNoLCBycSk7CisJaWYgKHVubGlr
ZWx5KGVycikpCisJCWdvdG8gb3V0X3JlcXVlc3Q7CisKKwllcnIgPSBkcm1fZ2VtX2xvY2tfcmVz
ZXJ2YXRpb25zKG9ianMsIEFSUkFZX1NJWkUob2JqcyksICZhY3F1aXJlKTsKKwlpZiAodW5saWtl
bHkoZXJyKSkKKwkJZ290byBvdXRfcmVxdWVzdDsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKHZtYSk7IGkrKykgeworCQllcnIgPSBtb3ZlX3RvX2dwdSh2bWFbaV0sIHJxLCBpKTsKKwkJ
aWYgKHVubGlrZWx5KGVycikpCisJCQlnb3RvIG91dF91bmxvY2s7CisJfQorCisJZm9yIChpID0g
MDsgaSA8IEFSUkFZX1NJWkUodm1hKTsgaSsrKSB7CisJCXVuc2lnbmVkIGludCBmbGFncyA9IGkg
PyBFWEVDX09CSkVDVF9XUklURSA6IDA7CisKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3Rp
dmUodm1hW2ldLCBycSwgZmxhZ3MpOworCQlpZiAodW5saWtlbHkoZXJyKSkKKwkJCWdvdG8gb3V0
X3VubG9jazsKKwl9CisKKwlpZiAocnEtPmVuZ2luZS0+ZW1pdF9pbml0X2JyZWFkY3J1bWIpIHsK
KwkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9pbml0X2JyZWFkY3J1bWIocnEpOworCQlpZiAodW5s
aWtlbHkoZXJyKSkKKwkJCWdvdG8gb3V0X3VubG9jazsKKwl9CisKKwllcnIgPSBycS0+ZW5naW5l
LT5lbWl0X2JiX3N0YXJ0KHJxLAorCQkJCQliYXRjaC0+bm9kZS5zdGFydCwgYmF0Y2gtPm5vZGUu
c2l6ZSwKKwkJCQkJMCk7CitvdXRfdW5sb2NrOgorCWRybV9nZW1fdW5sb2NrX3Jlc2VydmF0aW9u
cyhvYmpzLCBBUlJBWV9TSVpFKG9ianMpLCAmYWNxdWlyZSk7CitvdXRfcmVxdWVzdDoKKwlpZiAo
dW5saWtlbHkoZXJyKSkKKwkJaTkxNV9yZXF1ZXN0X3NraXAocnEsIGVycik7CisKKwlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKK291dF9iYXRjaDoKKwlpbnRlbF9lbWl0X3ZtYV9yZWxlYXNlKGNlLCBi
YXRjaCk7CitvdXRfdW5waW5fZHN0OgorCWk5MTVfdm1hX3VucGluKHZtYVsxXSk7CitvdXRfdW5w
aW5fc3JjOgorCWk5MTVfdm1hX3VucGluKHZtYVswXSk7CisJcmV0dXJuIGVycjsKK30KKwogI2lm
IElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQogI2luY2x1ZGUgInNlbGZ0ZXN0
cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMiCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfYmx0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fb2JqZWN0X2JsdC5oCmluZGV4IDk0NDhiOTE5MjEzNy4uMjQzYTQzYTg3
ODI0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
X2JsdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfYmx0
LmgKQEAgLTE5LDYgKzE5LDEwIEBAIHN0cnVjdCBpOTE1X3ZtYSAqaW50ZWxfZW1pdF92bWFfZmls
bF9ibHQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJCQkgc3RydWN0IGk5MTVfdm1hICp2
bWEsCiAJCQkJCSB1MzIgdmFsdWUpOwogCitzdHJ1Y3QgaTkxNV92bWEgKmludGVsX2VtaXRfdm1h
X2NvcHlfYmx0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCQkJIHN0cnVjdCBpOTE1X3Zt
YSAqc3JjLAorCQkJCQkgc3RydWN0IGk5MTVfdm1hICpkc3QpOworCiBpbnQgaW50ZWxfZW1pdF92
bWFfbWFya19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKTsKIHZvaWQgaW50ZWxfZW1pdF92bWFfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UsIHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIApAQCAtMjYsNCArMzAsOCBAQCBpbnQgaTkxNV9n
ZW1fb2JqZWN0X2ZpbGxfYmx0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkg
ICAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCSAgICAgdTMyIHZhbHVlKTsKIAoraW50
IGk5MTVfZ2VtX29iamVjdF9jb3B5X2JsdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqc3Jj
LAorCQkJICAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqZHN0LAorCQkJICAgICBzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpOworCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKaW5kZXggYzZl
MWVlYmU1M2Y1Li5jMjFkNzQ3ZTdkMDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCkBAIC0xMDMsMTAgKzEw
MywxMTYgQEAgc3RhdGljIGludCBpZ3RfZmlsbF9ibHQodm9pZCAqYXJnKQogCXJldHVybiBlcnI7
CiB9CiAKK3N0YXRpYyBpbnQgaWd0X2NvcHlfYmx0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBp
OTE1LT5lbmdpbmVbQkNTMF0tPmtlcm5lbF9jb250ZXh0OworCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpzcmMsICpkc3Q7CisJc3RydWN0IHJuZF9zdGF0ZSBwcm5nOworCUlHVF9USU1FT1VU
KGVuZCk7CisJdTMyICp2YWRkcjsKKwlpbnQgZXJyID0gMDsKKworCXByYW5kb21fc2VlZF9zdGF0
ZSgmcHJuZywgaTkxNV9zZWxmdGVzdC5yYW5kb21fc2VlZCk7CisKKwlkbyB7CisJCWNvbnN0IHUz
MiBtYXhfYmxvY2tfc2l6ZSA9IFMxNl9NQVggKiBQQUdFX1NJWkU7CisJCXUzMiBzeiA9IG1pbl90
KHU2NCwgY2UtPnZtLT50b3RhbCA+PiA0LCBwcmFuZG9tX3UzMl9zdGF0ZSgmcHJuZykpOworCQl1
MzIgcGh5c19zeiA9IHN6ICUgKG1heF9ibG9ja19zaXplICsgMSk7CisJCXUzMiB2YWwgPSBwcmFu
ZG9tX3UzMl9zdGF0ZSgmcHJuZyk7CisJCXUzMiBpOworCisJCXN6ID0gcm91bmRfdXAoc3osIFBB
R0VfU0laRSk7CisJCXBoeXNfc3ogPSByb3VuZF91cChwaHlzX3N6LCBQQUdFX1NJWkUpOworCisJ
CXByX2RlYnVnKCIlcyB3aXRoIHBoeXNfc3o9ICV4LCBzej0leCwgdmFsPSV4XG4iLCBfX2Z1bmNf
XywKKwkJCSBwaHlzX3N6LCBzeiwgdmFsKTsKKworCQlzcmMgPSBodWdlX2dlbV9vYmplY3QoaTkx
NSwgcGh5c19zeiwgc3opOworCQlpZiAoSVNfRVJSKHNyYykpIHsKKwkJCWVyciA9IFBUUl9FUlIo
c3JjKTsKKwkJCWdvdG8gZXJyX2ZsdXNoOworCQl9CisKKwkJdmFkZHIgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChzcmMsIEk5MTVfTUFQX1dCKTsKKwkJaWYgKElTX0VSUih2YWRkcikpIHsKKwkJ
CWVyciA9IFBUUl9FUlIodmFkZHIpOworCQkJZ290byBlcnJfcHV0X3NyYzsKKwkJfQorCisJCW1l
bXNldDMyKHZhZGRyLCB2YWwsCisJCQkgaHVnZV9nZW1fb2JqZWN0X3BoeXNfc2l6ZShzcmMpIC8g
c2l6ZW9mKHUzMikpOworCisJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoc3JjKTsKKworCQlp
ZiAoIShzcmMtPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfUkVB
RCkpCisJCQlzcmMtPmNhY2hlX2RpcnR5ID0gdHJ1ZTsKKworCQlkc3QgPSBodWdlX2dlbV9vYmpl
Y3QoaTkxNSwgcGh5c19zeiwgc3opOworCQlpZiAoSVNfRVJSKGRzdCkpIHsKKwkJCWVyciA9IFBU
Ul9FUlIoZHN0KTsKKwkJCWdvdG8gZXJyX3B1dF9zcmM7CisJCX0KKworCQl2YWRkciA9IGk5MTVf
Z2VtX29iamVjdF9waW5fbWFwKGRzdCwgSTkxNV9NQVBfV0IpOworCQlpZiAoSVNfRVJSKHZhZGRy
KSkgeworCQkJZXJyID0gUFRSX0VSUih2YWRkcik7CisJCQlnb3RvIGVycl9wdXRfZHN0OworCQl9
CisKKwkJbWVtc2V0MzIodmFkZHIsIHZhbCBeIDB4ZGVhZGJlYWYsCisJCQkgaHVnZV9nZW1fb2Jq
ZWN0X3BoeXNfc2l6ZShkc3QpIC8gc2l6ZW9mKHUzMikpOworCisJCWlmICghKGRzdC0+Y2FjaGVf
Y29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkpCisJCQlkc3QtPmNh
Y2hlX2RpcnR5ID0gdHJ1ZTsKKworCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKKwkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2NvcHlfYmx0KHNyYywgZHN0LCBjZSk7CisJCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWlmIChlcnIpCisJCQlnb3Rv
IGVycl91bnBpbjsKKworCQlpOTE1X2dlbV9vYmplY3RfbG9jayhkc3QpOworCQllcnIgPSBpOTE1
X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4oZHN0LCBmYWxzZSk7CisJCWk5MTVfZ2VtX29i
amVjdF91bmxvY2soZHN0KTsKKwkJaWYgKGVycikKKwkJCWdvdG8gZXJyX3VucGluOworCisJCWZv
ciAoaSA9IDA7IGkgPCBodWdlX2dlbV9vYmplY3RfcGh5c19zaXplKGRzdCkgLyBzaXplb2YodTMy
KTsgKytpKSB7CisJCQlpZiAodmFkZHJbaV0gIT0gdmFsKSB7CisJCQkJcHJfZXJyKCJ2YWRkclsl
dV09JXgsIGV4cGVjdGVkPSV4XG4iLCBpLAorCQkJCSAgICAgICB2YWRkcltpXSwgdmFsKTsKKwkJ
CQllcnIgPSAtRUlOVkFMOworCQkJCWdvdG8gZXJyX3VucGluOworCQkJfQorCQl9CisKKwkJaTkx
NV9nZW1fb2JqZWN0X3VucGluX21hcChkc3QpOworCisJCWk5MTVfZ2VtX29iamVjdF9wdXQoc3Jj
KTsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChkc3QpOworCX0gd2hpbGUgKCF0aW1lX2FmdGVyKGpp
ZmZpZXMsIGVuZCkpOworCisJZ290byBlcnJfZmx1c2g7CisKK2Vycl91bnBpbjoKKwlpOTE1X2dl
bV9vYmplY3RfdW5waW5fbWFwKGRzdCk7CitlcnJfcHV0X2RzdDoKKwlpOTE1X2dlbV9vYmplY3Rf
cHV0KGRzdCk7CitlcnJfcHV0X3NyYzoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KHNyYyk7CitlcnJf
Zmx1c2g6CisJaWYgKGVyciA9PSAtRU5PTUVNKQorCQllcnIgPSAwOworCisJcmV0dXJuIGVycjsK
K30KKwogaW50IGk5MTVfZ2VtX29iamVjdF9ibHRfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3Qg
dGVzdHNbXSA9IHsKIAkJU1VCVEVTVChpZ3RfZmlsbF9ibHQpLAorCQlTVUJURVNUKGlndF9jb3B5
X2JsdCksCiAJfTsKIAogCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKaW5kZXggNjlmMzQ3Mzcz
MjVmLi5hZjdiOWQyNzIxNDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2dwdV9jb21tYW5kcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dw
dV9jb21tYW5kcy5oCkBAIC0xODgsOCArMTg4LDkgQEAKIAogI2RlZmluZSBDT0xPUl9CTFRfQ01E
CQkJKDI8PDI5IHwgMHg0MDw8MjIgfCAoNS0yKSkKICNkZWZpbmUgWFlfQ09MT1JfQkxUX0NNRAkJ
KDIgPDwgMjkgfCAweDUwIDw8IDIyKQotI2RlZmluZSBTUkNfQ09QWV9CTFRfQ01ECQkoKDI8PDI5
KXwoMHg0Mzw8MjIpfDQpCi0jZGVmaW5lIFhZX1NSQ19DT1BZX0JMVF9DTUQJCSgoMjw8MjkpfCgw
eDUzPDwyMil8NikKKyNkZWZpbmUgU1JDX0NPUFlfQkxUX0NNRAkJKCgyPDwyOSl8KDB4NDM8PDIy
KSkKKyNkZWZpbmUgR0VOOV9YWV9GQVNUX0NPUFlfQkxUX0NNRAkoKDI8PDI5KXwoMHg0Mjw8MjIp
KQorI2RlZmluZSBYWV9TUkNfQ09QWV9CTFRfQ01ECQkoKDI8PDI5KXwoMHg1Mzw8MjIpKQogI2Rl
ZmluZSBYWV9NT05PX1NSQ19DT1BZX0lNTV9CTFQJKCgyPDwyOSl8KDB4NzE8PDIyKXw1KQogI2Rl
ZmluZSAgIEJMVF9XUklURV9BCQkJKDI8PDIwKQogI2RlZmluZSAgIEJMVF9XUklURV9SR0IJCQko
MTw8MjApCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVm
ZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKaW5kZXgg
ZGZhY2IyNjVhOTk1Li5iZTE3MGIxMGQ5MmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yaW5nYnVmZmVyLmMKQEAgLTExMzYsNyArMTEzNiw3IEBAIGk4MzBfZW1pdF9iYl9zdGFy
dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAkJICogc3RhYmxlIGJhdGNoIHNjcmF0Y2ggYm8g
YXJlYSAoc28gdGhhdCB0aGUgQ1MgbmV2ZXIKIAkJICogc3R1bWJsZXMgb3ZlciBpdHMgdGxiIGlu
dmFsaWRhdGlvbiBidWcpIC4uLgogCQkgKi8KLQkJKmNzKysgPSBTUkNfQ09QWV9CTFRfQ01EIHwg
QkxUX1dSSVRFX1JHQkE7CisJCSpjcysrID0gU1JDX0NPUFlfQkxUX0NNRCB8IEJMVF9XUklURV9S
R0JBIHwgKDYgLSAyKTsKIAkJKmNzKysgPSBCTFRfREVQVEhfMzIgfCBCTFRfUk9QX1NSQ19DT1BZ
IHwgNDA5NjsKIAkJKmNzKysgPSBESVZfUk9VTkRfVVAobGVuLCA0MDk2KSA8PCAxNiB8IDQwOTY7
CiAJCSpjcysrID0gY3Nfb2Zmc2V0OwotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B41DE10C970
	for <lists+intel-gfx@lfdr.de>; Thu, 28 Nov 2019 14:28:04 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A16F06E083;
	Thu, 28 Nov 2019 13:28:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6F96E6E05A
 for <intel-gfx@lists.freedesktop.org>; Thu, 28 Nov 2019 13:28:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19376514-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 28 Nov 2019 13:27:56 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 28 Nov 2019 13:27:55 +0000
Message-Id: <20191128132755.3919528-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191128132755.3919528-1-chris@chris-wilson.co.uk>
References: <20191128132755.3919528-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 3/3] drm/i915: Add cpu fault handler for mmap_offset
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogQWJkaWVsIEphbnVsZ3VlIDxhYmRpZWwuamFudWxndWVAbGludXguaW50ZWwuY29tPgoK
RmF1bHQgaGFuZGxlciB0byBoYW5kbGUgbWlzc2luZyBwYWdlcyBmb3Igc2htZW0tYmFja2VkIG9i
amVjdHMuCgp2MjogYmFpbCBvdXQgb2YgaW5zZXJ0aW5nIFBURXMgd2hlbiBmYWlsaW5nIHRvIGlu
c2VydCB0aGUKICAgIGZhdWx0IGFkZHJlc3MKdjM6IGhhcyBzdHJ1Y3QgcGFnZSBjaGVjawp2NDog
QWRkIHNlbGYtdGVzdCBmb3IgdmFsaWRhdGluZyBDUFUgZmF1bHQgaGFuZGxlciB0byBlbnN1cmUg
UFRFcwogICAgYXJlIHJldm9rZWQgd2hlbiBhbiBvYmplY3QgaXMgdW5ib3VuZC4KdjU6IEFkZCBj
b21tZW50IHdoZXJlIFBURXMgYXJlIHJldm9rZWQgKENocmlzKQoKTGluazogaHR0cHM6Ly9naXRs
YWIuZnJlZWRlc2t0b3Aub3JnL21lc2EvbWVzYS9tZXJnZV9yZXF1ZXN0cy8xNjc1ClRlc3RjYXNl
OiBpZ3QvZ2VtX21tYXBfb2Zmc2V0ClNpZ25lZC1vZmYtYnk6IEFiZGllbCBKYW51bGd1ZSA8YWJk
aWVsLmphbnVsZ3VlQGxpbnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTWF0dGhldyBBdWxk
IDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgpDYzogSm9vbmFzIExhaHRpbmVuIDxqb29uYXMubGFo
dGluZW5AbGludXguaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X21tYW4uYyAgICAgIHwgMTI5ICsrKysrKysrKysrKysrLS0tLQogLi4uL2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgIHwgIDQ4ICsrKysrKy0KIDIgZmlsZXMgY2hhbmdl
ZCwgMTQ1IGluc2VydGlvbnMoKyksIDMyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fbW1hbi5jCmluZGV4IGJiMDVjNTNjMDNjOC4uZTY1MGM3ZWViNjBmIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKQEAgLTUsNiArNSw3IEBA
CiAgKi8KIAogI2luY2x1ZGUgPGxpbnV4L21tYW4uaD4KKyNpbmNsdWRlIDxsaW51eC9wZm5fdC5o
PgogI2luY2x1ZGUgPGxpbnV4L3NpemVzLmg+CiAKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgpA
QCAtMjAxLDYgKzIwMiw3MSBAQCBjb21wdXRlX3BhcnRpYWxfdmlldyhjb25zdCBzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXJldHVybiB2aWV3OwogfQogCitzdGF0aWMgdm1fZmF1
bHRfdCBpOTE1X2Vycm9yX3RvX3ZtZl9mYXVsdChpbnQgZXJyKQoreworCXN3aXRjaCAoZXJyKSB7
CisJZGVmYXVsdDoKKwkJV0FSTl9PTkNFKGVyciwgInVuaGFuZGxlZCBlcnJvciBpbiAlczogJWlc
biIsIF9fZnVuY19fLCBlcnIpOworCQkvKiBmYWxsdGhyb3VnaCAqLworCWNhc2UgLUVJTzogLyog
c2htZW1mcyBmYWlsdXJlIGZyb20gc3dhcCBkZXZpY2UgKi8KKwljYXNlIC1FRkFVTFQ6IC8qIHB1
cmdlZCBvYmplY3QgKi8KKwljYXNlIC1FTk9ERVY6IC8qIGJhZCBvYmplY3QsIGhvdyBkaWQgeW91
IGdldCBoZXJlISAqLworCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOworCisJY2FzZSAtRU5PU1BD
OiAvKiBzaG1lbWZzIGFsbG9jYXRpb24gZmFpbHVyZSAqLworCWNhc2UgLUVOT01FTTogLyogb3Vy
IGFsbG9jYXRpb24gZmFpbHVyZSAqLworCQlyZXR1cm4gVk1fRkFVTFRfT09NOworCisJY2FzZSAw
OgorCWNhc2UgLUVBR0FJTjoKKwljYXNlIC1FUkVTVEFSVFNZUzoKKwljYXNlIC1FSU5UUjoKKwlj
YXNlIC1FQlVTWToKKwkJLyoKKwkJICogRUJVU1kgaXMgb2s6IHRoaXMganVzdCBtZWFucyB0aGF0
IGFub3RoZXIgdGhyZWFkCisJCSAqIGFscmVhZHkgZGlkIHRoZSBqb2IuCisJCSAqLworCQlyZXR1
cm4gVk1fRkFVTFRfTk9QQUdFOworCX0KK30KKworc3RhdGljIHZtX2ZhdWx0X3QgaTkxNV9nZW1f
ZmF1bHRfY3B1KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQoreworCXN0cnVjdCB2bV9hcmVhX3N0cnVj
dCAqYXJlYSA9IHZtZi0+dm1hOworCXN0cnVjdCBpOTE1X21tYXBfb2Zmc2V0ICpwcml2ID0gYXJl
YS0+dm1fcHJpdmF0ZV9kYXRhOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBw
cml2LT5vYmo7CisJdm1fZmF1bHRfdCB2bWZfcmV0OworCXVuc2lnbmVkIGxvbmcgaSwgc2l6ZSA9
IGFyZWEtPnZtX2VuZCAtIGFyZWEtPnZtX3N0YXJ0OworCWJvb2wgd3JpdGUgPSBhcmVhLT52bV9m
bGFncyAmIFZNX1dSSVRFOworCWludCByZXQ7CisKKwlpZiAoIWk5MTVfZ2VtX29iamVjdF9oYXNf
c3RydWN0X3BhZ2Uob2JqKSkKKwkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKKworCS8qIFNhbml0
eSBjaGVjayB0aGF0IHdlIGFsbG93IHdyaXRpbmcgaW50byB0aGlzIG9iamVjdCAqLworCWlmIChp
OTE1X2dlbV9vYmplY3RfaXNfcmVhZG9ubHkob2JqKSAmJiB3cml0ZSkKKwkJcmV0dXJuIFZNX0ZB
VUxUX1NJR0JVUzsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKKwlp
ZiAocmV0KQorCQlyZXR1cm4gaTkxNV9lcnJvcl90b192bWZfZmF1bHQocmV0KTsKKworCS8qIFBU
RXMgYXJlIHJldm9rZWQgaW4gb2JqLT5vcHMtPnB1dF9wYWdlcygpICovCisJZm9yIChpID0gMDsg
aSA8IHNpemUgPj4gUEFHRV9TSElGVDsgaSsrKSB7CisJCXN0cnVjdCBwYWdlICpwYWdlID0gaTkx
NV9nZW1fb2JqZWN0X2dldF9wYWdlKG9iaiwgaSk7CisKKwkJdm1mX3JldCA9IHZtZl9pbnNlcnRf
cGZuKGFyZWEsCisJCQkJCSAodW5zaWduZWQgbG9uZylhcmVhLT52bV9zdGFydCArIGkgKiBQQUdF
X1NJWkUsCisJCQkJCSBwYWdlX3RvX3BmbihwYWdlKSk7CisJCWlmICh2bWZfcmV0ICE9IFZNX0ZB
VUxUX05PUEFHRSkKKwkJCWJyZWFrOworCX0KKworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdl
cyhvYmopOworCisJcmV0dXJuIHZtZl9yZXQ7Cit9CisKIC8qKgogICogaTkxNV9nZW1fZmF1bHQg
LSBmYXVsdCBhIHBhZ2UgaW50byB0aGUgR1RUCiAgKiBAdm1mOiBmYXVsdCBpbmZvCkBAIC0zNDAs
MzAgKzQwNiw3IEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2
bWYpCiAJaW50ZWxfcnVudGltZV9wbV9wdXQocnBtLCB3YWtlcmVmKTsKIAlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fcGFnZXMob2JqKTsKIGVycjoKLQlzd2l0Y2ggKHJldCkgewotCWRlZmF1bHQ6Ci0J
CVdBUk5fT05DRShyZXQsICJ1bmhhbmRsZWQgZXJyb3IgaW4gJXM6ICVpXG4iLCBfX2Z1bmNfXywg
cmV0KTsKLQkJLyogZmFsbHRocm91Z2ggKi8KLQljYXNlIC1FSU86IC8qIHNobWVtZnMgZmFpbHVy
ZSBmcm9tIHN3YXAgZGV2aWNlICovCi0JY2FzZSAtRUZBVUxUOiAvKiBwdXJnZWQgb2JqZWN0ICov
Ci0JY2FzZSAtRU5PREVWOiAvKiBiYWQgb2JqZWN0LCBob3cgZGlkIHlvdSBnZXQgaGVyZSEgKi8K
LQkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKLQotCWNhc2UgLUVOT1NQQzogLyogc2htZW1mcyBh
bGxvY2F0aW9uIGZhaWx1cmUgKi8KLQljYXNlIC1FTk9NRU06IC8qIG91ciBhbGxvY2F0aW9uIGZh
aWx1cmUgKi8KLQkJcmV0dXJuIFZNX0ZBVUxUX09PTTsKLQotCWNhc2UgMDoKLQljYXNlIC1FQUdB
SU46Ci0JY2FzZSAtRVJFU1RBUlRTWVM6Ci0JY2FzZSAtRUlOVFI6Ci0JY2FzZSAtRUJVU1k6Ci0J
CS8qCi0JCSAqIEVCVVNZIGlzIG9rOiB0aGlzIGp1c3QgbWVhbnMgdGhhdCBhbm90aGVyIHRocmVh
ZAotCQkgKiBhbHJlYWR5IGRpZCB0aGUgam9iLgotCQkgKi8KLQkJcmV0dXJuIFZNX0ZBVUxUX05P
UEFHRTsKLQl9CisJcmV0dXJuIGk5MTVfZXJyb3JfdG9fdm1mX2ZhdWx0KHJldCk7CiB9CiAKIHZv
aWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwX2d0dChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQpAQCAtNjI5LDYgKzY3MiwzMyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHZt
X29wZXJhdGlvbnNfc3RydWN0IGk5MTVfZ2VtX2d0dF92bV9vcHMgPSB7CiAJLmNsb3NlID0gaTkx
NV9nZW1fdm1fY2xvc2UsCiB9OwogCitzdGF0aWMgY29uc3Qgc3RydWN0IHZtX29wZXJhdGlvbnNf
c3RydWN0IGk5MTVfZ2VtX2NwdV92bV9vcHMgPSB7CisJLmZhdWx0ID0gaTkxNV9nZW1fZmF1bHRf
Y3B1LAorCS5vcGVuID0gaTkxNV9nZW1fdm1fb3BlbiwKKwkuY2xvc2UgPSBpOTE1X2dlbV92bV9j
bG9zZSwKK307CisKK3N0YXRpYyB2b2lkIHNldF92bWRhdGFfbW1hcF9vZmZzZXQoc3RydWN0IGk5
MTVfbW1hcF9vZmZzZXQgKm1tbywgc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEpCit7CisJc3dp
dGNoIChtbW8tPm1tYXBfdHlwZSkgeworCWNhc2UgSTkxNV9NTUFQX1RZUEVfV0M6CisJCXZtYS0+
dm1fcGFnZV9wcm90ID0KKwkJCXBncHJvdF93cml0ZWNvbWJpbmUodm1fZ2V0X3BhZ2VfcHJvdCh2
bWEtPnZtX2ZsYWdzKSk7CisJCWJyZWFrOworCWNhc2UgSTkxNV9NTUFQX1RZUEVfV0I6CisJCXZt
YS0+dm1fcGFnZV9wcm90ID0gdm1fZ2V0X3BhZ2VfcHJvdCh2bWEtPnZtX2ZsYWdzKTsKKwkJYnJl
YWs7CisJY2FzZSBJOTE1X01NQVBfVFlQRV9VQzoKKwkJdm1hLT52bV9wYWdlX3Byb3QgPQorCQkJ
cGdwcm90X25vbmNhY2hlZCh2bV9nZXRfcGFnZV9wcm90KHZtYS0+dm1fZmxhZ3MpKTsKKwkJYnJl
YWs7CisJZGVmYXVsdDoKKwkJYnJlYWs7CisJfQorCisJdm1hLT52bV9vcHMgPSAmaTkxNV9nZW1f
Y3B1X3ZtX29wczsKK30KKwogLyogVGhpcyBvdmVyY29tZXMgdGhlIGxpbWl0YXRpb24gaW4gZHJt
X2dlbV9tbWFwJ3MgYXNzaWdubWVudCBvZiBhCiAgKiBkcm1fZ2VtX29iamVjdCBhcyB0aGUgdm1h
LT52bV9wcml2YXRlX2RhdGEuIFNpbmNlIHdlIG5lZWQgdG8KICAqIGJlIGFibGUgdG8gcmVzb2x2
ZSBtdWx0aXBsZSBtbWFwIG9mZnNldHMgd2hpY2ggY291bGQgYmUgdGllZApAQCAtNjk2LDcgKzc2
NiwxNiBAQCBpbnQgaTkxNV9nZW1fbW1hcChzdHJ1Y3QgZmlsZSAqZmlscCwgc3RydWN0IHZtX2Fy
ZWFfc3RydWN0ICp2bWEpCiAJdm1hLT52bV9wYWdlX3Byb3QgPSBwZ3Byb3RfZGVjcnlwdGVkKHZt
YS0+dm1fcGFnZV9wcm90KTsKIAl2bWEtPnZtX3ByaXZhdGVfZGF0YSA9IG1tbzsKIAotCXZtYS0+
dm1fb3BzID0gJmk5MTVfZ2VtX2d0dF92bV9vcHM7CisJc3dpdGNoIChtbW8tPm1tYXBfdHlwZSkg
eworCWNhc2UgSTkxNV9NTUFQX1RZUEVfV0M6CisJY2FzZSBJOTE1X01NQVBfVFlQRV9XQjoKKwlj
YXNlIEk5MTVfTU1BUF9UWVBFX1VDOgorCQlzZXRfdm1kYXRhX21tYXBfb2Zmc2V0KG1tbywgdm1h
KTsKKwkJYnJlYWs7CisJY2FzZSBJOTE1X01NQVBfVFlQRV9HVFQ6CisJCXZtYS0+dm1fb3BzID0g
Jmk5MTVfZ2VtX2d0dF92bV9vcHM7CisJCWJyZWFrOworCX0KIAogCXJldHVybiAwOwogfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFu
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpp
bmRleCBkMjE2MThhNjlmMzYuLmU1NDZhMTZiZDg4ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTczMiw3ICs3MzIsNyBA
QCBzdGF0aWMgaW50IGlndF9tbWFwX29mZnNldF9leGhhdXN0aW9uKHZvaWQgKmFyZykKIH0KIAog
I2RlZmluZSBleHBhbmQzMih4KSAoKCh4KSA8PCAwKSB8ICgoeCkgPDwgOCkgfCAoKHgpIDw8IDE2
KSB8ICgoeCkgPDwgMjQpKQotc3RhdGljIGludCBpZ3RfbW1hcF9ndHQodm9pZCAqYXJnKQorc3Rh
dGljIGludCBpZ3RfbW1hcCh2b2lkICphcmcsIGVudW0gaTkxNV9tbWFwX3R5cGUgdHlwZSkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqOwpAQCAtNzYzLDcgKzc2Myw4IEBAIHN0YXRpYyBpbnQgaWd0X21tYXBf
Z3R0KHZvaWQgKmFyZykKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIAotCWFkZHIgPSBpZ3RfbW1h
cF9ub2RlKGk5MTUsICZvYmotPmJhc2Uudm1hX25vZGUsCisJbW1vLT5tbWFwX3R5cGUgPSB0eXBl
OworCWFkZHIgPSBpZ3RfbW1hcF9ub2RlKGk5MTUsICZtbW8tPnZtYV9ub2RlLAogCQkJICAgICAw
LCBQUk9UX1dSSVRFLCBNQVBfU0hBUkVEKTsKIAlpZiAoSVNfRVJSX1ZBTFVFKGFkZHIpKSB7CiAJ
CWVyciA9IGFkZHI7CkBAIC03NzksOCArNzgwLDggQEAgc3RhdGljIGludCBpZ3RfbW1hcF9ndHQo
dm9pZCAqYXJnKQogCQlnb3RvIG91dF91bm1hcDsKIAl9CiAKLQlpZiAoYXJlYS0+dm1fcHJpdmF0
ZV9kYXRhICE9IG9iaikgewotCQlwcl9lcnIoInZtX2FyZWFfc3RydWN0IGRpZCBub3QgcG9pbnQg
YmFjayB0byBvdXIgb2JqZWN0IVxuIik7CisJaWYgKGFyZWEtPnZtX3ByaXZhdGVfZGF0YSAhPSBt
bW8pIHsKKwkJcHJfZXJyKCJ2bV9hcmVhX3N0cnVjdCBkaWQgbm90IHBvaW50IGJhY2sgdG8gb3Vy
IG1tYXBfb2Zmc2V0IG9iamVjdCFcbiIpOwogCQllcnIgPSAtRUlOVkFMOwogCQlnb3RvIG91dF91
bm1hcDsKIAl9CkBAIC04MzEsNiArODMyLDE2IEBAIHN0YXRpYyBpbnQgaWd0X21tYXBfZ3R0KHZv
aWQgKmFyZykKIAlyZXR1cm4gZXJyOwogfQogCitzdGF0aWMgaW50IGlndF9tbWFwX2d0dCh2b2lk
ICphcmcpCit7CisJcmV0dXJuIGlndF9tbWFwKGFyZywgSTkxNV9NTUFQX1RZUEVfR1RUKTsKK30K
Kworc3RhdGljIGludCBpZ3RfbW1hcF9jcHUodm9pZCAqYXJnKQoreworCXJldHVybiBpZ3RfbW1h
cChhcmcsIEk5MTVfTU1BUF9UWVBFX1dDKTsKK30KKwogc3RhdGljIGludCBjaGVja19wcmVzZW50
X3B0ZShwdGVfdCAqcHRlLCB1bnNpZ25lZCBsb25nIGFkZHIsIHZvaWQgKmRhdGEpCiB7CiAJaWYg
KCFwdGVfcHJlc2VudCgqcHRlKSB8fCBwdGVfbm9uZSgqcHRlKSkgewpAQCAtODgzLDcgKzg5NCw3
IEBAIHN0YXRpYyBpbnQgcHJlZmF1bHRfcmFuZ2UodTY0IHN0YXJ0LCB1NjQgbGVuKQogCXJldHVy
biBfX2dldF91c2VyKGMsIGVuZCAtIDEpOwogfQogCi1zdGF0aWMgaW50IGlndF9tbWFwX2d0dF9y
ZXZva2Uodm9pZCAqYXJnKQorc3RhdGljIGludCBpZ3RfbW1hcF9yZXZva2Uodm9pZCAqYXJnLCBl
bnVtIGk5MTVfbW1hcF90eXBlIHR5cGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKQEAgLTkwMyw3ICs5
MTQsOCBAQCBzdGF0aWMgaW50IGlndF9tbWFwX2d0dF9yZXZva2Uodm9pZCAqYXJnKQogCWlmIChl
cnIpCiAJCWdvdG8gb3V0OwogCi0JYWRkciA9IGlndF9tbWFwX25vZGUoaTkxNSwgJm9iai0+YmFz
ZS52bWFfbm9kZSwKKwltbW8tPm1tYXBfdHlwZSA9IHR5cGU7CisJYWRkciA9IGlndF9tbWFwX25v
ZGUoaTkxNSwgJm1tby0+dm1hX25vZGUsCiAJCQkgICAgIDAsIFBST1RfV1JJVEUsIE1BUF9TSEFS
RUQpOwogCWlmIChJU19FUlJfVkFMVUUoYWRkcikpIHsKIAkJZXJyID0gYWRkcjsKQEAgLTkxNCw3
ICs5MjYsOCBAQCBzdGF0aWMgaW50IGlndF9tbWFwX2d0dF9yZXZva2Uodm9pZCAqYXJnKQogCWlm
IChlcnIpCiAJCWdvdG8gb3V0X3VubWFwOwogCi0JR0VNX0JVR19PTighYXRvbWljX3JlYWQoJm9i
ai0+YmluZF9jb3VudCkpOworCUdFTV9CVUdfT04obW1vLT5tbWFwX3R5cGUgPT0gSTkxNV9NTUFQ
X1RZUEVfR1RUICYmCisJCSAgICFhdG9taWNfcmVhZCgmb2JqLT5iaW5kX2NvdW50KSk7CiAKIAll
cnIgPSBjaGVja19wcmVzZW50KGFkZHIsIG9iai0+YmFzZS5zaXplKTsKIAlpZiAoZXJyKQpAQCAt
OTMyLDYgKzk0NSwxNSBAQCBzdGF0aWMgaW50IGlndF9tbWFwX2d0dF9yZXZva2Uodm9pZCAqYXJn
KQogCX0KIAlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZvYmotPmJpbmRfY291bnQpKTsKIAorCWlm
ICh0eXBlICE9IEk5MTVfTU1BUF9UWVBFX0dUVCkgeworCQlfX2k5MTVfZ2VtX29iamVjdF9wdXRf
cGFnZXMob2JqKTsKKwkJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkgeworCQkJ
cHJfZXJyKCJGYWlsZWQgdG8gcHV0LXBhZ2VzIG9iamVjdCFcbiIpOworCQkJZXJyID0gLUVJTlZB
TDsKKwkJCWdvdG8gb3V0X3VubWFwOworCQl9CisJfQorCiAJZXJyID0gY2hlY2tfYWJzZW50KGFk
ZHIsIG9iai0+YmFzZS5zaXplKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dF91bm1hcDsKQEAgLTk0
Myw2ICs5NjUsMTYgQEAgc3RhdGljIGludCBpZ3RfbW1hcF9ndHRfcmV2b2tlKHZvaWQgKmFyZykK
IAlyZXR1cm4gZXJyOwogfQogCitzdGF0aWMgaW50IGlndF9tbWFwX2d0dF9yZXZva2Uodm9pZCAq
YXJnKQoreworCXJldHVybiBpZ3RfbW1hcF9yZXZva2UoYXJnLCBJOTE1X01NQVBfVFlQRV9HVFQp
OworfQorCitzdGF0aWMgaW50IGlndF9tbWFwX2NwdV9yZXZva2Uodm9pZCAqYXJnKQoreworCXJl
dHVybiBpZ3RfbW1hcF9yZXZva2UoYXJnLCBJOTE1X01NQVBfVFlQRV9XQyk7Cit9CisKIGludCBp
OTE1X2dlbV9tbWFuX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CkBAIC05
NTAsNyArOTgyLDkgQEAgaW50IGk5MTVfZ2VtX21tYW5fbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCVNVQlRFU1QoaWd0X3Ntb2tlX3RpbGluZyksCiAJCVNV
QlRFU1QoaWd0X21tYXBfb2Zmc2V0X2V4aGF1c3Rpb24pLAogCQlTVUJURVNUKGlndF9tbWFwX2d0
dCksCisJCVNVQlRFU1QoaWd0X21tYXBfY3B1KSwKIAkJU1VCVEVTVChpZ3RfbW1hcF9ndHRfcmV2
b2tlKSwKKwkJU1VCVEVTVChpZ3RfbW1hcF9jcHVfcmV2b2tlKSwKIAl9OwogCiAJcmV0dXJuIGk5
MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

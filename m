Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 085B790054
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 12:55:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 528926E2EF;
	Fri, 16 Aug 2019 10:55:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0B8696E2EF
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 10:55:10 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Aug 2019 03:55:09 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,393,1559545200"; d="scan'208";a="188780689"
Received: from irvmail001.ir.intel.com ([163.33.26.43])
 by orsmga002.jf.intel.com with ESMTP; 16 Aug 2019 03:55:08 -0700
Received: from mwajdecz-MOBL1.ger.corp.intel.com
 (mwajdecz-mobl1.ger.corp.intel.com [10.249.129.244])
 by irvmail001.ir.intel.com (8.14.3/8.13.6/MailSET/Hub) with ESMTP id
 x7GAt5dw010923; Fri, 16 Aug 2019 11:55:07 +0100
From: Michal Wajdeczko <michal.wajdeczko@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 16 Aug 2019 10:54:58 +0000
Message-Id: <20190816105501.31020-3-michal.wajdeczko@intel.com>
X-Mailer: git-send-email 2.21.0.windows.1
In-Reply-To: <20190816105501.31020-1-michal.wajdeczko@intel.com>
References: <20190816105501.31020-1-michal.wajdeczko@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 2/5] drm/i915/wopcm: Check WOPCM layout
 separately from calculations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY2FuIGRvIFdPUENNIHBhcnRpdGlvbmluZyB1c2luZyByb3VnaCBlc3RpbWF0ZXMgYW5kIGxp
bWl0cwphbmQgcGVyZm9ybSBkZXRhaWxlZCBjaGVjayBhcyBzZXBhcmF0ZSBzdGVwLgoKdjI6IG9v
cHMhIHMvbWF4L21pbgp2MzogY29uc29saWRhdGUgb3ZlcmZsb3cgY2hlY2tzIChEYW5pZWxlKQoK
U2lnbmVkLW9mZi1ieTogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndhamRlY3prb0BpbnRlbC5j
b20+CkNjOiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50
ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYyB8IDk3ICsrKysrKysrKysrKysrKysr
KysrLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDY0IGluc2VydGlvbnMoKyksIDMzIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jCmluZGV4IDI5NzVlMDBmNTdmNS4u
ZjVjZjExZTJlZmJkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3Bj
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMKQEAgLTg3LDcgKzg3
LDcgQEAgdm9pZCBpbnRlbF93b3BjbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF93b3BjbSAqd29w
Y20pCiAJZWxzZQogCQl3b3BjbS0+c2l6ZSA9IEdFTjlfV09QQ01fU0laRTsKIAotCURSTV9ERUJV
R19EUklWRVIoIldPUENNIHNpemU6ICV1S2lCXG4iLCB3b3BjbS0+c2l6ZSAvIDEwMjQpOworCURS
TV9ERVZfREVCVUdfRFJJVkVSKGk5MTUtPmRybS5kZXYsICJXT1BDTTogJXVLXG4iLCB3b3BjbS0+
c2l6ZSAvIDEwMjQpOwogfQogCiBzdGF0aWMgaW5saW5lIHUzMiBjb250ZXh0X3Jlc2VydmVkX3Np
emUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCkBAIC0xMzgsOSArMTM4LDkgQEAgc3Rh
dGljIGlubGluZSBpbnQgZ2VuOV9jaGVja19odWNfZndfZml0cyh1MzIgZ3VjX3dvcGNtX3NpemUs
IHUzMiBodWNfZndfc2l6ZSkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGlubGluZSBpbnQgY2hl
Y2tfaHdfcmVzdHJpY3Rpb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCQkJICAg
ICAgIHUzMiBndWNfd29wY21fYmFzZSwgdTMyIGd1Y193b3BjbV9zaXplLAotCQkJCSAgICAgICB1
MzIgaHVjX2Z3X3NpemUpCitzdGF0aWMgaW5saW5lIGJvb2wgY2hlY2tfaHdfcmVzdHJpY3Rpb25z
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCQkgdTMyIGd1Y193b3BjbV9iYXNl
LCB1MzIgZ3VjX3dvcGNtX3NpemUsCisJCQkJCSB1MzIgaHVjX2Z3X3NpemUpCiB7CiAJaW50IGVy
ciA9IDA7CiAKQEAgLTE1MSw3ICsxNTEsNDMgQEAgc3RhdGljIGlubGluZSBpbnQgY2hlY2tfaHdf
cmVzdHJpY3Rpb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJICAgIChJU19HRU4o
aTkxNSwgOSkgfHwgSVNfQ05MX1JFVklEKGk5MTUsIENOTF9SRVZJRF9BMCwgQ05MX1JFVklEX0Ew
KSkpCiAJCWVyciA9IGdlbjlfY2hlY2tfaHVjX2Z3X2ZpdHMoZ3VjX3dvcGNtX3NpemUsIGh1Y19m
d19zaXplKTsKIAotCXJldHVybiBlcnI7CisJcmV0dXJuICFlcnI7Cit9CisKK3N0YXRpYyBpbmxp
bmUgYm9vbCBfX2NoZWNrX2xheW91dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMy
IHdvcGNtX3NpemUsCisJCQkJICB1MzIgZ3VjX3dvcGNtX2Jhc2UsIHUzMiBndWNfd29wY21fc2l6
ZSwKKwkJCQkgIHUzMiBndWNfZndfc2l6ZSwgdTMyIGh1Y19md19zaXplKQoreworCWNvbnN0IHUz
MiBjdHhfcnN2ZCA9IGNvbnRleHRfcmVzZXJ2ZWRfc2l6ZShpOTE1KTsKKwl1MzIgc2l6ZTsKKwor
CXNpemUgPSB3b3BjbV9zaXplIC0gY3R4X3JzdmQ7CisJaWYgKHVubGlrZWx5KHJhbmdlX292ZXJm
bG93cyhndWNfd29wY21fYmFzZSwgZ3VjX3dvcGNtX3NpemUsIHNpemUpKSkgeworCQlkZXZfZXJy
KGk5MTUtPmRybS5kZXYsCisJCQkiV09QQ006IGludmFsaWQgR3VDIHJlZ2lvbiBsYXlvdXQ6ICV1
SyArICV1SyA+ICV1S1xuIiwKKwkJCWd1Y193b3BjbV9iYXNlIC8gU1pfMUssIGd1Y193b3BjbV9z
aXplIC8gU1pfMUssCisJCQlzaXplIC8gU1pfMUspOworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJ
c2l6ZSA9IGd1Y19md19zaXplICsgR1VDX1dPUENNX1JFU0VSVkVEICsgR1VDX1dPUENNX1NUQUNL
X1JFU0VSVkVEOworCWlmICh1bmxpa2VseShndWNfd29wY21fc2l6ZSA8IHNpemUpKSB7CisJCWRl
dl9lcnIoaTkxNS0+ZHJtLmRldiwgIldPUENNOiBubyBzcGFjZSBmb3IgJXM6ICV1SyA8ICV1S1xu
IiwKKwkJCWludGVsX3VjX2Z3X3R5cGVfcmVwcihJTlRFTF9VQ19GV19UWVBFX0dVQyksCisJCQln
dWNfd29wY21fc2l6ZSAvIFNaXzFLLCBzaXplIC8gU1pfMUspOworCQlyZXR1cm4gZmFsc2U7CisJ
fQorCisJc2l6ZSA9IGh1Y19md19zaXplICsgV09QQ01fUkVTRVJWRURfU0laRTsKKwlpZiAodW5s
aWtlbHkoZ3VjX3dvcGNtX2Jhc2UgPCBzaXplKSkgeworCQlkZXZfZXJyKGk5MTUtPmRybS5kZXYs
ICJXT1BDTTogbm8gc3BhY2UgZm9yICVzOiAldUsgPCAldUtcbiIsCisJCQlpbnRlbF91Y19md190
eXBlX3JlcHIoSU5URUxfVUNfRldfVFlQRV9IVUMpLAorCQkJZ3VjX3dvcGNtX2Jhc2UgLyBTWl8x
Sywgc2l6ZSAvIFNaXzFLKTsKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXJldHVybiBjaGVja19o
d19yZXN0cmljdGlvbnMoaTkxNSwgZ3VjX3dvcGNtX2Jhc2UsIGd1Y193b3BjbV9zaXplLAorCQkJ
CSAgICAgaHVjX2Z3X3NpemUpOwogfQogCiAvKioKQEAgLTE3Miw4ICsyMDgsNiBAQCB2b2lkIGlu
dGVsX3dvcGNtX2luaXQoc3RydWN0IGludGVsX3dvcGNtICp3b3BjbSkKIAl1MzIgY3R4X3JzdmQg
PSBjb250ZXh0X3Jlc2VydmVkX3NpemUoaTkxNSk7CiAJdTMyIGd1Y193b3BjbV9iYXNlOwogCXUz
MiBndWNfd29wY21fc2l6ZTsKLQl1MzIgZ3VjX3dvcGNtX3JzdmQ7Ci0JaW50IGVycjsKIAogCWlm
ICghZ3VjX2Z3X3NpemUpCiAJCXJldHVybjsKQEAgLTE4MywzOSArMjE3LDM2IEBAIHZvaWQgaW50
ZWxfd29wY21faW5pdChzdHJ1Y3QgaW50ZWxfd29wY20gKndvcGNtKQogCUdFTV9CVUdfT04od29w
Y20tPmd1Yy5zaXplKTsKIAlHRU1fQlVHX09OKGd1Y19md19zaXplID49IHdvcGNtLT5zaXplKTsK
IAlHRU1fQlVHX09OKGh1Y19md19zaXplID49IHdvcGNtLT5zaXplKTsKKwlHRU1fQlVHX09OKGN0
eF9yc3ZkICsgV09QQ01fUkVTRVJWRURfU0laRSA+PSB3b3BjbS0+c2l6ZSk7CiAKIAlpZiAoaTkx
NV9pbmplY3RfcHJvYmVfZmFpbHVyZShpOTE1KSkKIAkJcmV0dXJuOwogCi0JZ3VjX3dvcGNtX2Jh
c2UgPSBBTElHTihodWNfZndfc2l6ZSArIFdPUENNX1JFU0VSVkVEX1NJWkUsCi0JCQkgICAgICAg
R1VDX1dPUENNX09GRlNFVF9BTElHTk1FTlQpOwotCWlmICgoZ3VjX3dvcGNtX2Jhc2UgKyBjdHhf
cnN2ZCkgPj0gd29wY20tPnNpemUpIHsKLQkJRFJNX0VSUk9SKCJHdUMgV09QQ00gYmFzZSAoJXVL
aUIpIGlzIHRvbyBiaWcuXG4iLAotCQkJICBndWNfd29wY21fYmFzZSAvIDEwMjQpOwotCQlyZXR1
cm47Ci0JfQorCS8qCisJICogQWxpZ25lZCB2YWx1ZSBvZiBndWNfd29wY21fYmFzZSB3aWxsIGRl
dGVybWluZSBhdmFpbGFibGUgV09QQ00gc3BhY2UKKwkgKiBmb3IgSHVDIGZpcm13YXJlIGFuZCBt
YW5kYXRvcnkgcmVzZXJ2ZWQgYXJlYS4KKwkgKi8KKwlndWNfd29wY21fYmFzZSA9IGh1Y19md19z
aXplICsgV09QQ01fUkVTRVJWRURfU0laRTsKKwlndWNfd29wY21fYmFzZSA9IEFMSUdOKGd1Y193
b3BjbV9iYXNlLCBHVUNfV09QQ01fT0ZGU0VUX0FMSUdOTUVOVCk7CisKKwkvKgorCSAqIE5lZWQg
dG8gY2xhbXAgZ3VjX3dvcGNtX2Jhc2Ugbm93IHRvIG1ha2Ugc3VyZSB0aGUgZm9sbG93aW5nIG1h
dGggaXMKKwkgKiBjb3JyZWN0LiBGb3JtYWwgY2hlY2sgb2Ygd2hvbGUgV09QQ00gbGF5b3V0IHdp
bGwgYmUgZG9uZSBiZWxvdy4KKwkgKi8KKwlndWNfd29wY21fYmFzZSA9IG1pbihndWNfd29wY21f
YmFzZSwgd29wY20tPnNpemUgLSBjdHhfcnN2ZCk7CiAKLQlndWNfd29wY21fc2l6ZSA9IHdvcGNt
LT5zaXplIC0gZ3VjX3dvcGNtX2Jhc2UgLSBjdHhfcnN2ZDsKKwkvKiBBbGlnbmVkIHJlbWFpbmlu
Z3Mgb2YgdXNhYmxlIFdPUENNIHNwYWNlIGNhbiBiZSBhc3NpZ25lZCB0byBHdUMuICovCisJZ3Vj
X3dvcGNtX3NpemUgPSB3b3BjbS0+c2l6ZSAtIGN0eF9yc3ZkIC0gZ3VjX3dvcGNtX2Jhc2U7CiAJ
Z3VjX3dvcGNtX3NpemUgJj0gR1VDX1dPUENNX1NJWkVfTUFTSzsKIAotCURSTV9ERUJVR19EUklW
RVIoIkNhbGN1bGF0ZWQgR3VDIFdPUENNIFJlZ2lvbjogWyV1S2lCLCAldUtpQilcbiIsCi0JCQkg
Z3VjX3dvcGNtX2Jhc2UgLyAxMDI0LCBndWNfd29wY21fc2l6ZSAvIDEwMjQpOworCURSTV9ERVZf
REVCVUdfRFJJVkVSKGk5MTUtPmRybS5kZXYsICJDYWxjdWxhdGVkIEd1QyBXT1BDTSBbJXVLLCAl
dUspXG4iLAorCQkJICAgICBndWNfd29wY21fYmFzZSAvIFNaXzFLLCBndWNfd29wY21fc2l6ZSAv
IFNaXzFLKTsKIAotCWd1Y193b3BjbV9yc3ZkID0gR1VDX1dPUENNX1JFU0VSVkVEICsgR1VDX1dP
UENNX1NUQUNLX1JFU0VSVkVEOwotCWlmICgoZ3VjX2Z3X3NpemUgKyBndWNfd29wY21fcnN2ZCkg
PiBndWNfd29wY21fc2l6ZSkgewotCQlEUk1fRVJST1IoIk5lZWQgJXVLaUIgV09QQ00gZm9yIEd1
QywgJXVLaUIgYXZhaWxhYmxlLlxuIiwKLQkJCSAgKGd1Y19md19zaXplICsgZ3VjX3dvcGNtX3Jz
dmQpIC8gMTAyNCwKLQkJCSAgZ3VjX3dvcGNtX3NpemUgLyAxMDI0KTsKLQkJcmV0dXJuOworCWlm
IChfX2NoZWNrX2xheW91dChpOTE1LCB3b3BjbS0+c2l6ZSwgZ3VjX3dvcGNtX2Jhc2UsIGd1Y193
b3BjbV9zaXplLAorCQkJICAgZ3VjX2Z3X3NpemUsIGh1Y19md19zaXplKSkgeworCQl3b3BjbS0+
Z3VjLmJhc2UgPSBndWNfd29wY21fYmFzZTsKKwkJd29wY20tPmd1Yy5zaXplID0gZ3VjX3dvcGNt
X3NpemU7CisJCUdFTV9CVUdfT04oIXdvcGNtLT5ndWMuYmFzZSk7CisJCUdFTV9CVUdfT04oIXdv
cGNtLT5ndWMuc2l6ZSk7CiAJfQotCi0JZXJyID0gY2hlY2tfaHdfcmVzdHJpY3Rpb24oaTkxNSwg
Z3VjX3dvcGNtX2Jhc2UsIGd1Y193b3BjbV9zaXplLAotCQkJCSAgIGh1Y19md19zaXplKTsKLQlp
ZiAoZXJyKQotCQlyZXR1cm47Ci0KLQl3b3BjbS0+Z3VjLmJhc2UgPSBndWNfd29wY21fYmFzZTsK
LQl3b3BjbS0+Z3VjLnNpemUgPSBndWNfd29wY21fc2l6ZTsKLQlHRU1fQlVHX09OKCF3b3BjbS0+
Z3VjLmJhc2UpOwotCUdFTV9CVUdfT04oIXdvcGNtLT5ndWMuc2l6ZSk7CiB9Ci0tIAoyLjE5LjIK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 54999A6CB5
	for <lists+intel-gfx@lfdr.de>; Tue,  3 Sep 2019 17:16:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 10F3489590;
	Tue,  3 Sep 2019 15:16:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mail-ed1-x541.google.com (mail-ed1-x541.google.com
 [IPv6:2a00:1450:4864:20::541])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 28C268957D
 for <intel-gfx@lists.freedesktop.org>; Tue,  3 Sep 2019 15:16:23 +0000 (UTC)
Received: by mail-ed1-x541.google.com with SMTP id g24so18911410edu.3
 for <intel-gfx@lists.freedesktop.org>; Tue, 03 Sep 2019 08:16:23 -0700 (PDT)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:sender:date:from:to:cc:subject:message-id
 :references:mime-version:content-disposition:in-reply-to:user-agent;
 bh=0b2nsgLoeJz3AnrEZb/eqPPVRg87CIKwTy6gFWtwqgs=;
 b=bwKZBx6eLugu4zi1/RG1MgD8Kw/Ch7/Jd9J6GPnXucy9PqCA5T75uNuLl3R0HoK6z1
 u+Vh2Wp/Gs/IH6DzoGDBSLMvIquvcj08N01T1E7i1GDkf8qJ13Ves8cfQWyMbeMsVYAY
 B6CqF5Pc/nSwTgkzaooPfhJoiT45LhCnC9CjO/40ArlJdxeeuS2dYoL5LWKxue0QhkG5
 kTCkjjpGNjC48z+81wLJxJUgcghiSRSrEyetEunCbx+P4Vm5bKde6GmLfFpYm37pvkNr
 5sYD9n4boBk7ZUe3tXnOOiASZFPfk+8KPKU4/MiiM25rFYOcaYycAO3fpuzw94I9ukPP
 M2kA==
X-Gm-Message-State: APjAAAW98SNpSs4GCL9M1zhj5c9GvCfKNTs4IkfyG9GfJe+xSpNrEKrs
 dSsbZMZPqdbXVwyNfF2UPI0isg==
X-Google-Smtp-Source: APXvYqz60GX0Mrd7OmVlK1Q2fnFyjkwNuYFDiumlWDam/p8HPqUBwi+4jwshN4oMUTQ1oMZcp08NZQ==
X-Received: by 2002:a17:906:2f0d:: with SMTP id
 v13mr28229196eji.99.1567523781697; 
 Tue, 03 Sep 2019 08:16:21 -0700 (PDT)
Received: from phenom.ffwll.local (212-51-149-96.fiber7.init7.net.
 [212.51.149.96])
 by smtp.gmail.com with ESMTPSA id t22sm862661edd.79.2019.09.03.08.16.20
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Tue, 03 Sep 2019 08:16:20 -0700 (PDT)
Date: Tue, 3 Sep 2019 17:16:18 +0200
From: Daniel Vetter <daniel@ffwll.ch>
To: Rodrigo Siqueira <rodrigosiqueiramelo@gmail.com>
Message-ID: <20190903151618.GA2112@phenom.ffwll.local>
References: <20190719152314.7706-1-daniel.vetter@ffwll.ch>
 <20190719152314.7706-3-daniel.vetter@ffwll.ch>
 <20190903125029.6jctvqvwoq2yzyka@smtp.gmail.com>
MIME-Version: 1.0
Content-Disposition: inline
In-Reply-To: <20190903125029.6jctvqvwoq2yzyka@smtp.gmail.com>
X-Operating-System: Linux phenom 5.2.0-2-amd64 
User-Agent: Mutt/1.10.1 (2018-07-13)
X-Mailman-Original-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=ffwll.ch; s=google;
 h=sender:date:from:to:cc:subject:message-id:references:mime-version
 :content-disposition:in-reply-to:user-agent;
 bh=0b2nsgLoeJz3AnrEZb/eqPPVRg87CIKwTy6gFWtwqgs=;
 b=CX82NgItaIqcC01vjzQxupcwEgyi4xARr1nt2er9SIxuCUq0mf8xhh6qrFdibvtNe7
 7ffWHHZEicLO2NnhaIp11Yb0/Ah8BJYT9JzZU+PDVBNgxqHihQIGZqv6KvUSjDmgzCG4
 wI8++p/Asvsttbeoz60LYMcsEJD7TTb+5i6XM=
Subject: Re: [Intel-gfx] [PATCH 3/3] drm/vkms: Reduce critical section in
 vblank_simulate
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Haneen Mohammed <hamohammed.sa@gmail.com>,
 Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 DRI Development <dri-devel@lists.freedesktop.org>,
 Daniel Vetter <daniel.vetter@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gVHVlLCBTZXAgMDMsIDIwMTkgYXQgMDg6NTA6MjlBTSAtMDQwMCwgUm9kcmlnbyBTaXF1ZWly
YSB3cm90ZToKPiBUaGFua3MgZm9yIHRoaXMgcGF0Y2ghIEl0IGxvb2tzIGdvb2QgZm9yIG1lLgo+
IAo+IFJldmlld2VkLWJ5OiBSb2RyaWdvIFNpcXVlaXJhIDxyb2RyaWdvc2lxdWVpcmFtZWxvQGdt
YWlsLmNvbT4KClRoYW5rcyBmb3IgdGFraW5nIGEgbG9vayBhdCBhbGwgdGhpcywgZW50aXJlIHNl
cmllcyBtZXJnZWQuIFdpdGggdGhlIHItYgpmcm9tIFZpbGxlIG9uIHBhdGNoIDEsIGJ1dCBJJ20g
aGFwcHkgdG8gZnVydGhlciBkaXNjdXNzIHlvdXIgcXVlc3Rpb25zLgpQbHVzIEkgYXVnbWVudGVk
IHRoZSBjb21taXQgbWVzc2FnZSBhIGJpdCBmb3IgcGF0Y2ggMSB0byBleHBsYWluIHRoZQptaXNz
ZWQgdmJsYW5rIHN0b3J5IGJldHRlci4KLURhbmllbAoKPiAKPiBPbiAwNy8xOSwgRGFuaWVsIFZl
dHRlciB3cm90ZToKPiA+IFdlIGNhbiByZWR1Y2UgdGhlIGNyaXRpY2FsIHNlY3Rpb24gaW4gdmtt
c192Ymxhbmtfc2ltdWxhdGUgdW5kZXIKPiA+IG91dHB1dC0+bG9jayBxdWl0ZSBhIGxvdDoKPiA+
IAo+ID4gLSBocnRpbWVyX2ZvcndhcmRfbm93IGp1c3QgbmVlZHMgdG8gYmUgb3JkZXJlZCBjb3Jy
ZWN0bHkgd3J0Cj4gPiAgIGRybV9jcnRjX2hhbmRsZV92YmxhbmsuIFdlIGFscmVhZHkgYWNjZXNz
IHRoZSBocnRpbWVyIHRpbWVzdGFtcAo+ID4gICB3aXRob3V0IGxvY2tzLiBXaGlsZSBhdWRpdGlu
ZyB0aGF0IEkgbm90aWNlZCB0aGF0IHdlIGRvbid0IGNvcnJlY3RseQo+ID4gICBhbm5vdGF0ZSB0
aGUgcmVhZCB0aGVyZSwgc28gc3ByaW5rbGUgYSBSRUFEX09OQ0UgdG8gbWFrZSBzdXJlIHRoZQo+
ID4gICBjb21waWxlciBkb2Vzbid0IGRvIGFueXRoaW5nIGZvb2xpc2guCj4gPiAKPiA+IC0gZHJt
X2NydGNfaGFuZGxlX3ZibGFuayBtdXN0IHN0YXkgdW5kZXIgdGhlIGxvY2sgdG8gYXZvaWQgcmFj
ZXMgd2l0aAo+ID4gICBkcm1fY3J0Y19hcm1fdmJsYW5rX2V2ZW50Lgo+ID4gCj4gPiAtIFRoZSBh
Y2Nlc3MgdG8gdmttc19vdXB0dXQtPmNyY19zdGF0ZSBhbHNvIG11c3Qgc3RheSB1bmRlciB0aGUg
bG9jay4KPiA+IAo+ID4gLSBuZXh0IHByb2JsZW0gaXMgbWFraW5nIHN1cmUgdGhlIG91dHB1dC0+
c3RhdGUgc3RydWN0dXJlIGRvZXNuJ3QgZ2V0Cj4gPiAgIGZyZWVkIHRvbyBlYXJseS4gRmlyc3Qg
d2UgcmVseSBvbiBhIGdpdmVuIGhydGltZXIgYmVpbmcgc2VyaWFsaXplZDoKPiA+ICAgSWYgd2Ug
Y2FsbCBkcm1fY3J0Y19oYW5kbGVfdmJsYW5rLCB0aGVuIHdlIGFyZSBndWFyYW50ZWVkIHRoYXQg
dGhlCj4gPiAgIHByZXZpb3VzIGNhbGwgdG8gdmttc192Ymxhbmtfc2ltdWxhdGUgaGFzIGNvbXBs
ZXRlZC4gVGhlIG90aGVyIHNpZGUKPiA+ICAgb2YgdGhlIGNvaW4gaXMgdGhhdCB0aGUgYXRvbWlj
IHVwZGF0ZXMgd2FpdHMgZm9yIHRoZSB2YmxhbmsgdG8KPiA+ICAgaGFwcGVuIGJlZm9yZSBpdCBy
ZWxlYXNlcyB0aGUgb2xkIHN0YXRlLiBCb3RoIHRha2VuIHRvZ2V0aGVyIG1lYW5zCj4gPiAgIHRo
YXQgYnkgdGhlIHRpbWUgdGhlIGF0b21pYyB1cGRhdGUgcmVsZWFzZXMgdGhlIG9sZCBzdGF0ZSwg
dGhlCj4gPiAgIGhydGltZXIgd29uJ3QgYWNjZXNzIGl0IGFueW1vcmUgKGl0IG1pZ2h0IGJlIGFj
Y2Vzc2luZyB0aGUgbmV3IHN0YXRlCj4gPiAgIGF0IHRoZSBzYW1lIHRpbWUsIGJ1dCB0aGF0J3Mg
b2spLgo+ID4gCj4gPiAtIHN0YXRlIGlzIGludmFyaWFudCwgZXhjZXB0IHRoZSBmZXcgZmllbGRz
IHNlcGFyYXRlIHByb3RlY3RlZCBieQo+ID4gICBzdGF0ZS0+Y3JjX2xvY2suIFNvIG5vIG5lZWQg
dG8gaG9sZCB0aGUgbG9jayBmb3IgdGhhdC4KPiA+IAo+ID4gLSBmaW5hbGx5IHRoZSBxdWV1ZV93
b3JrLiBXZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGVyZSdzIG5vIHJhY2VzIHdpdGgKPiA+ICAgdGhl
IGZsdXNoX3dvcmssIGkuZS4gd2hlbiB3ZSBjYWxsIGZsdXNoX3dvcmsgd2UgbmVlZCB0byBndWFy
YW50ZWUKPiA+ICAgdGhhdCB0aGUgaHJ0aW1lciBjYW4ndCByZXF1ZXVlIHRoZSB3b3JrIGFnYWlu
LiBUaGlzIGlzIGd1YXJhbnRlZWQgYnkKPiA+ICAgdGhlIHNhbWUgdmJsYW5rL2hydGltZXIgb3Jk
ZXJpbmcgZ3VhcmFudGVlcyBsaWtlIHRoZSByZWFzb25pbmcgYWJvdmUKPiA+ICAgd2h5IHN0YXRl
IHdvbid0IGJlIGZyZWVkIHRvbyBlYXJseTogZmx1c2hfd29yayBvbiB0aGUgb2xkIHN0YXRlIGlz
Cj4gPiAgIGNhbGxlZCBhZnRlciB3YWl0X2Zvcl9mbGlwX2RvbmUgaW4gdGhlIGF0b21pYyBjb21t
aXQgY29kZS4KPiA+IAo+ID4gVGhlcmVmb3JlIHdlIGNhbiBhbHNvIG1vdmUgZXZlcnl0aGluZyBh
ZnRlciB0aGUgb3V0cHV0LT5jcmNfc3RhdGUgb3V0Cj4gPiBvZiB0aGUgY3JpdGljYWwgc2VjdGlv
bi4KPiA+IAo+ID4gTW90aXZhdGVkIGJ5IHN1Z2dlc3Rpb25zIGZyb20gUm9kcmlnby4KPiA+IAo+
ID4gU2lnbmVkLW9mZi1ieTogRGFuaWVsIFZldHRlciA8ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+
Cj4gPiBDYzogUm9kcmlnbyBTaXF1ZWlyYSA8cm9kcmlnb3NpcXVlaXJhbWVsb0BnbWFpbC5jb20+
Cj4gPiBDYzogSGFuZWVuIE1vaGFtbWVkIDxoYW1vaGFtbWVkLnNhQGdtYWlsLmNvbT4KPiA+IENj
OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWxAZmZ3bGwuY2g+Cj4gPiAtLS0KPiA+ICBkcml2ZXJzL2dw
dS9kcm0vdmttcy92a21zX2NydGMuYyB8IDkgKysrKy0tLS0tCj4gPiAgMSBmaWxlIGNoYW5nZWQs
IDQgaW5zZXJ0aW9ucygrKSwgNSBkZWxldGlvbnMoLSkKPiA+IAo+ID4gZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS92a21zL3ZrbXNfY3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmtt
c19jcnRjLmMKPiA+IGluZGV4IDkyN2RhZmFlYmM3Ni4uNzRmNzAzYjhkMjJhIDEwMDY0NAo+ID4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL3ZrbXMvdmttc19jcnRjLmMKPiA+ICsrKyBiL2RyaXZlcnMv
Z3B1L2RybS92a21zL3ZrbXNfY3J0Yy5jCj4gPiBAQCAtMTYsMTcgKzE2LDE4IEBAIHN0YXRpYyBl
bnVtIGhydGltZXJfcmVzdGFydCB2a21zX3ZibGFua19zaW11bGF0ZShzdHJ1Y3QgaHJ0aW1lciAq
dGltZXIpCj4gPiAgCXU2NCByZXRfb3ZlcnJ1bjsKPiA+ICAJYm9vbCByZXQ7Cj4gPiAgCj4gPiAt
CXNwaW5fbG9jaygmb3V0cHV0LT5sb2NrKTsKPiA+IC0KPiA+ICAJcmV0X292ZXJydW4gPSBocnRp
bWVyX2ZvcndhcmRfbm93KCZvdXRwdXQtPnZibGFua19ocnRpbWVyLAo+ID4gIAkJCQkJICBvdXRw
dXQtPnBlcmlvZF9ucyk7Cj4gPiAgCVdBUk5fT04ocmV0X292ZXJydW4gIT0gMSk7Cj4gPiAgCj4g
PiArCXNwaW5fbG9jaygmb3V0cHV0LT5sb2NrKTsKPiA+ICAJcmV0ID0gZHJtX2NydGNfaGFuZGxl
X3ZibGFuayhjcnRjKTsKPiA+ICAJaWYgKCFyZXQpCj4gPiAgCQlEUk1fRVJST1IoInZrbXMgZmFp
bHVyZSBvbiBoYW5kbGluZyB2YmxhbmsiKTsKPiA+ICAKPiA+ICAJc3RhdGUgPSBvdXRwdXQtPmNv
bXBvc2VyX3N0YXRlOwo+ID4gKwlzcGluX3VubG9jaygmb3V0cHV0LT5sb2NrKTsKPiA+ICsKPiA+
ICAJaWYgKHN0YXRlICYmIG91dHB1dC0+Y29tcG9zZXJfZW5hYmxlZCkgewo+ID4gIAkJdTY0IGZy
YW1lID0gZHJtX2NydGNfYWNjdXJhdGVfdmJsYW5rX2NvdW50KGNydGMpOwo+ID4gIAo+ID4gQEAg
LTQ4LDggKzQ5LDYgQEAgc3RhdGljIGVudW0gaHJ0aW1lcl9yZXN0YXJ0IHZrbXNfdmJsYW5rX3Np
bXVsYXRlKHN0cnVjdCBocnRpbWVyICp0aW1lcikKPiA+ICAJCQlEUk1fREVCVUdfRFJJVkVSKCJD
b21wb3NlciB3b3JrZXIgYWxyZWFkeSBxdWV1ZWRcbiIpOwo+ID4gIAl9Cj4gPiAgCj4gPiAtCXNw
aW5fdW5sb2NrKCZvdXRwdXQtPmxvY2spOwo+ID4gLQo+ID4gIAlyZXR1cm4gSFJUSU1FUl9SRVNU
QVJUOwo+ID4gIH0KPiA+ICAKPiA+IEBAIC04NSw3ICs4NCw3IEBAIGJvb2wgdmttc19nZXRfdmJs
YW5rX3RpbWVzdGFtcChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB1bnNpZ25lZCBpbnQgcGlwZSwK
PiA+ICAJc3RydWN0IHZrbXNfb3V0cHV0ICpvdXRwdXQgPSAmdmttc2Rldi0+b3V0cHV0Owo+ID4g
IAlzdHJ1Y3QgZHJtX3ZibGFua19jcnRjICp2YmxhbmsgPSAmZGV2LT52YmxhbmtbcGlwZV07Cj4g
PiAgCj4gPiAtCSp2YmxhbmtfdGltZSA9IG91dHB1dC0+dmJsYW5rX2hydGltZXIubm9kZS5leHBp
cmVzOwo+ID4gKwkqdmJsYW5rX3RpbWUgPSBSRUFEX09OQ0Uob3V0cHV0LT52YmxhbmtfaHJ0aW1l
ci5ub2RlLmV4cGlyZXMpOwo+ID4gIAo+ID4gIAlpZiAoV0FSTl9PTigqdmJsYW5rX3RpbWUgPT0g
dmJsYW5rLT50aW1lKSkKPiA+ICAJCXJldHVybiB0cnVlOwo+ID4gLS0gCj4gPiAyLjIyLjAKPiA+
IAo+IAo+IC0tIAo+IFJvZHJpZ28gU2lxdWVpcmEKPiBTb2Z0d2FyZSBFbmdpbmVlciwgQWR2YW5j
ZWQgTWljcm8gRGV2aWNlcyAoQU1EKQo+IGh0dHBzOi8vc2lxdWVpcmEudGVjaAoKCgotLSAKRGFu
aWVsIFZldHRlcgpTb2Z0d2FyZSBFbmdpbmVlciwgSW50ZWwgQ29ycG9yYXRpb24KaHR0cDovL2Js
b2cuZmZ3bGwuY2gKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

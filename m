Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 65972C8720
	for <lists+intel-gfx@lfdr.de>; Wed,  2 Oct 2019 13:20:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 689386E947;
	Wed,  2 Oct 2019 11:20:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ABB6B6E942
 for <intel-gfx@lists.freedesktop.org>; Wed,  2 Oct 2019 11:20:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18692026-1500050 
 for multiple; Wed, 02 Oct 2019 12:20:07 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  2 Oct 2019 12:19:41 +0100
Message-Id: <20191002112000.12280-11-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191002112000.12280-1-chris@chris-wilson.co.uk>
References: <20191002112000.12280-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 11/30] drm/i915: Remove the GEM idle worker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm90aGluZyBpbnNpZGUgdGhlIGlkbGUgd29ya2VyIG5vdyByZXF1aXJlcyBzdHJ1Y3RfbXV0ZXgs
IHNvIHdlIGNhbgpyZW1vdmUgdGhlIGluZGlyZWN0aW9uIG9mIHVzaW5nIG91ciBvd24gd29ya2Vy
LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
ClJldmlld2VkLWJ5OiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8IDI4ICsr
LS0tLS0tLS0tLS0tLS0tLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYyAgICB8ICAzIC0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAg
ICAgICAgfCAgNSAtLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAg
ICAgICAgfCAgOSAtLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2Rl
dmljZS5jICB8ICA2IC0tLS0KIDUgZmlsZXMgY2hhbmdlZCwgMiBpbnNlcnRpb25zKCspLCA0OSBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDJk
ZGMzYWVhYWM5ZC4uMjZmMzI1YmJmZTRkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcG0uYwpAQCAtMTMsMzYgKzEzLDEzIEBACiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX3Bhcmso
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJY2FuY2VsX2RlbGF5ZWRfd29yaygmaTkxNS0+Z2Vt
LnJldGlyZV93b3JrKTsKIAogCWk5MTVfdm1hX3BhcmtlZChpOTE1KTsKIAogCWk5MTVfZ2xvYmFs
c19wYXJrKCk7CiB9CiAKLXN0YXRpYyB2b2lkIGlkbGVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd29yaykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0JCWNv
bnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBnZW0uaWRsZV93b3JrKTsKLQlib29sIHBh
cms7Ci0KLQljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmk5MTUtPmdlbS5yZXRpcmVfd29yayk7
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlpbnRlbF93YWtlcmVm
X2xvY2soJmk5MTUtPmd0Lndha2VyZWYpOwotCXBhcmsgPSAoIWludGVsX3dha2VyZWZfaXNfYWN0
aXZlKCZpOTE1LT5ndC53YWtlcmVmKSAmJgotCQkhd29ya19wZW5kaW5nKHdvcmspKTsKLQlpbnRl
bF93YWtlcmVmX3VubG9jaygmaTkxNS0+Z3Qud2FrZXJlZik7Ci0JaWYgKHBhcmspCi0JCWk5MTVf
Z2VtX3BhcmsoaTkxNSk7Ci0JZWxzZQotCQlxdWV1ZV9kZWxheWVkX3dvcmsoaTkxNS0+d3EsCi0J
CQkJICAgJmk5MTUtPmdlbS5yZXRpcmVfd29yaywKLQkJCQkgICByb3VuZF9qaWZmaWVzX3VwX3Jl
bGF0aXZlKEhaKSk7Ci0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
fQotCiBzdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0cnVjdCAq
d29yaykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CkBAIC03MSw3ICs0OCw3
IEBAIHN0YXRpYyBpbnQgcG1fbm90aWZpZXIoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwKIAkJ
YnJlYWs7CiAKIAljYXNlIElOVEVMX0dUX1BBUks6Ci0JCXF1ZXVlX3dvcmsoaTkxNS0+d3EsICZp
OTE1LT5nZW0uaWRsZV93b3JrKTsKKwkJaTkxNV9nZW1fcGFyayhpOTE1KTsKIAkJYnJlYWs7CiAJ
fQogCkBAIC0yNjQsNyArMjQxLDYgQEAgdm9pZCBpOTE1X2dlbV9yZXN1bWUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiAKIHZvaWQgaTkxNV9nZW1faW5pdF9fcG0oc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JSU5JVF9XT1JLKCZpOTE1LT5nZW0uaWRsZV93b3JrLCBp
ZGxlX3dvcmtfaGFuZGxlcik7CiAJSU5JVF9ERUxBWUVEX1dPUksoJmk5MTUtPmdlbS5yZXRpcmVf
d29yaywgcmV0aXJlX3dvcmtfaGFuZGxlcik7CiAKIAlpOTE1LT5nZW0ucG1fbm90aWZpZXIubm90
aWZpZXJfY2FsbCA9IHBtX25vdGlmaWVyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwppbmRleCA4NTZiOGU0NjdlZTguLjRiYTZlZDVj
ODMxMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9tbWFuLmMKQEAgLTU3MiwxMSArNTcyLDggQEAgc3RhdGljIGJvb2wgYXNzZXJ0X21tYXBf
b2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogc3RhdGljIHZvaWQgZGlzYWJs
ZV9yZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWk5MTVf
Z2VtX2RyaXZlcl91bnJlZ2lzdGVyX19zaHJpbmtlcihpOTE1KTsKLQogCWludGVsX2d0X3BtX2dl
dCgmaTkxNS0+Z3QpOwotCiAJY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZpOTE1LT5nZW0ucmV0
aXJlX3dvcmspOwotCWZsdXNoX3dvcmsoJmk5MTUtPmdlbS5pZGxlX3dvcmspOwogfQogCiBzdGF0
aWMgdm9pZCByZXN0b3JlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDM4NTI4OTg5NTEwNy4uN2M0
YmJhMjFhZGNkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzY2MiwxMSAr
MzY2Miw2IEBAIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCiAJCWk5
MTVfZ2VtX3Nocmlua19hbGwoaTkxNSk7CiAJZnNfcmVjbGFpbV9yZWxlYXNlKEdGUF9LRVJORUwp
OwogCi0JaWYgKHZhbCAmIERST1BfSURMRSkgewotCQlmbHVzaF9kZWxheWVkX3dvcmsoJmk5MTUt
PmdlbS5yZXRpcmVfd29yayk7Ci0JCWZsdXNoX3dvcmsoJmk5MTUtPmdlbS5pZGxlX3dvcmspOwot
CX0KLQogCWlmICh2YWwgJiBEUk9QX0ZSRUVEKQogCQlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmpl
Y3RzKGk5MTUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCAzMzdkODMwNjQxNmEuLmFk
MzE4NTJlNDMwOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xNzE5LDE1ICsxNzE5LDYg
QEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCQkgKiBmaXJlcywgZ28gcmV0aXJlIHJlcXVl
c3RzLgogCQkgKi8KIAkJc3RydWN0IGRlbGF5ZWRfd29yayByZXRpcmVfd29yazsKLQotCQkvKioK
LQkJICogV2hlbiB3ZSBkZXRlY3QgYW4gaWRsZSBHUFUsIHdlIHdhbnQgdG8gdHVybiBvbgotCQkg
KiBwb3dlcnNhdmluZyBmZWF0dXJlcy4gU28gb25jZSB3ZSBzZWUgdGhhdCB0aGVyZQotCQkgKiBh
cmUgbm8gbW9yZSByZXF1ZXN0cyBvdXRzdGFuZGluZyBhbmQgbm8gbW9yZQotCQkgKiBhcnJpdmUg
d2l0aGluIGEgc21hbGwgcGVyaW9kIG9mIHRpbWUsIHdlIGZpcmUKLQkJICogb2ZmIHRoZSBpZGxl
X3dvcmsuCi0JCSAqLwotCQlzdHJ1Y3Qgd29ya19zdHJ1Y3QgaWRsZV93b3JrOwogCX0gZ2VtOwog
CiAJLyogRm9yIGk5NDVnbSB2YmxhbmsgaXJxIHZzLiBDMyB3b3JrYXJvdW5kICovCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5kZXggNjIy
YmIyMTI3NDUzLi5hOGJlNWRhMmIzY2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTU1LDcgKzU1LDYgQEAgc3RhdGljIHZvaWQg
bW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJbW9ja19kZXZp
Y2VfZmx1c2goaTkxNSk7CiAKLQlmbHVzaF93b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsKIAlp
OTE1X2dlbV9kcmFpbl93b3JrcXVldWUoaTkxNSk7CiAKIAltdXRleF9sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKQEAgLTEwMywxMCArMTAyLDYgQEAgc3RhdGljIHZvaWQgbW9ja19yZXRp
cmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKIH0KIAotc3RhdGlj
IHZvaWQgbW9ja19pZGxlX3dvcmtfaGFuZGxlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCi17
Ci19Ci0KIHN0YXRpYyBpbnQgcG1fZG9tYWluX3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7
CiAJcmV0dXJuIHBtX2dlbmVyaWNfcnVudGltZV9yZXN1bWUoZGV2KTsKQEAgLTE4Nyw3ICsxODIs
NiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19nZW1fZGV2aWNlKHZvaWQpCiAJbW9j
a19pbml0X2NvbnRleHRzKGk5MTUpOwogCiAJSU5JVF9ERUxBWUVEX1dPUksoJmk5MTUtPmdlbS5y
ZXRpcmVfd29yaywgbW9ja19yZXRpcmVfd29ya19oYW5kbGVyKTsKLQlJTklUX1dPUksoJmk5MTUt
PmdlbS5pZGxlX3dvcmssIG1vY2tfaWRsZV93b3JrX2hhbmRsZXIpOwogCiAJaW50ZWxfdGltZWxp
bmVzX2luaXQoaTkxNSk7CiAKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8B7D6DA848
	for <lists+intel-gfx@lfdr.de>; Thu, 17 Oct 2019 11:28:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9F0D66E43D;
	Thu, 17 Oct 2019 09:28:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C5E236E43D
 for <intel-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 09:28:11 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18866669-1500050 
 for multiple; Thu, 17 Oct 2019 10:27:58 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 17 Oct 2019 10:27:57 +0100
Message-Id: <20191017092757.1630-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191017080144.16899-1-chris@chris-wilson.co.uk>
References: <20191017080144.16899-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Add coverage of mocs
 registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvYmUgdGhlIG1vY3MgcmVnaXN0ZXJzIGZvciBuZXcgY29udGV4dHMgYW5kIGFjcm9zcyBHUFUg
cmVzZXRzLiBTaW1pbGFyCnRvIGludGVsX3dvcmthcm91bmRzLCB3ZSBoYXZlIHRhYmxlcyBvZiB3
aGF0IHJlZ2lzdGVyIHZhbHVlcyB3ZSBleHBlY3QKdG8gc2VlLCBzbyB2ZXJpZnkgdGhhdCB1c2Vy
IGNvbnRleHRzIGFyZSBhZmZlY3RlZCBieSB0aGVtLiBJbiB0aGUKZnV0dXJlLCB3ZSBzaG91bGQg
YWRkIHRlc3RzIHNpbWlsYXIgdG8gaW50ZWxfc3NldSB0byBjb3ZlciBkeW5hbWljCnJlY29uZmln
dXJhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNhbkBp
bnRlbC5jb20+Ci0tLQpIZWxwcyB0byBsb2NrIHRoZSBlbmdpbmVzLgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX21vY3MuYyAgICAgICAgICB8ICAgNCArCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMgICAgICAgfCAzMDkgKysrKysrKysrKysrKysrKysr
CiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCAgfCAgIDEgKwog
MyBmaWxlcyBjaGFuZ2VkLCAzMTQgaW5zZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYwoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX21vY3MuYwppbmRleCA1YmFjMzk2NjkwNmIuLmY1YTIzOTY0MDU1MyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX21vY3MuYwpAQCAtNDkwLDMgKzQ5MCw3IEBAIHZvaWQgaW50ZWxf
bW9jc19pbml0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJaWYgKEhBU19HTE9CQUxfTU9DU19SRUdJ
U1RFUlMoZ3QtPmk5MTUpKQogCQlpbnRlbF9tb2NzX2luaXRfZ2xvYmFsKGd0KTsKIH0KKworI2lm
IElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2luY2x1ZGUgInNlbGZ0ZXN0
X21vY3MuYyIKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbW9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNDZhZTk5NzY1NzBmCi0tLSAv
ZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5jCkBA
IC0wLDAgKzEsMzA5IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoK
KyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUg
Imk5MTVfc2VsZnRlc3QuaCIKKworI2luY2x1ZGUgImdlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0
LmgiCisjaW5jbHVkZSAic2VsZnRlc3RzL2lndF9yZXNldC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0
cy9pZ3Rfc3Bpbm5lci5oIgorCitzdHJ1Y3QgbGl2ZV9tb2NzIHsKKwlzdHJ1Y3QgZHJtX2k5MTVf
bW9jc190YWJsZSB0YWJsZTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVj
dCBpOTE1X3ZtYSAqc2NyYXRjaDsKKwl2b2lkICp2YWRkcjsKK307CisKK3N0YXRpYyBpbnQgcmVx
dWVzdF9hZGRfc3luYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgaW50IGVycikKK3sKKwlpOTE1
X3JlcXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlpZiAoaTkxNV9yZXF1
ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKQorCQllcnIgPSAtRVRJTUU7CisJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IHJlcXVlc3RfYWRk
X3NwaW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpZ3Rfc3Bpbm5lciAqc3BpbikK
K3sKKwlpbnQgZXJyID0gMDsKKworCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVz
dF9hZGQocnEpOworCWlmIChzcGluICYmICFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcihzcGluLCBycSkp
CisJCWVyciA9IC1FVElNRTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKworCXJldHVybiBlcnI7
Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9zY3JhdGNoKHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKKwlpbnQgZXJyOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJl
dHVybiBFUlJfQ0FTVChvYmopOworCisJaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVu
Y3kob2JqLCBJOTE1X0NBQ0hJTkdfQ0FDSEVEKTsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNl
KG9iaiwgJmd0LT5nZ3R0LT52bSwgTlVMTCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWk5MTVf
Z2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIHZtYTsKKwl9CisKKwllcnIgPSBpOTE1X3Zt
YV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9QVFIoZXJyKTsKKwl9CisKKwlyZXR1cm4gdm1h
OworfQorCitzdGF0aWMgaW50IGxpdmVfbW9jc19pbml0KHN0cnVjdCBsaXZlX21vY3MgKmFyZywg
c3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlpbnQgZXJyOworCisJaWYgKCFnZXRfbW9jc19zZXR0
aW5ncyhndC0+aTkxNSwgJmFyZy0+dGFibGUpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWFyZy0+
Y3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOworCWlmICghYXJnLT5jdHgpCisJCXJldHVy
biAtRU5PTUVNOworCisJYXJnLT5zY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOworCWlmIChJ
U19FUlIoYXJnLT5zY3JhdGNoKSkgeworCQllcnIgPSBQVFJfRVJSKGFyZy0+c2NyYXRjaCk7CisJ
CWdvdG8gZXJyX2N0eDsKKwl9CisKKwlhcmctPnZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9t
YXAoYXJnLT5zY3JhdGNoLT5vYmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGFyZy0+dmFk
ZHIpKSB7CisJCWVyciA9IFBUUl9FUlIoYXJnLT52YWRkcik7CisJCWdvdG8gZXJyX3NjcmF0Y2g7
CisJfQorCisJcmV0dXJuIDA7CisKK2Vycl9zY3JhdGNoOgorCWk5MTVfdm1hX3VucGluX2FuZF9y
ZWxlYXNlKCZhcmctPnNjcmF0Y2gsIDApOworZXJyX2N0eDoKKwlrZXJuZWxfY29udGV4dF9jbG9z
ZShhcmctPmN0eCk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIHZvaWQgbGl2ZV9tb2NzX2Zp
bmkoc3RydWN0IGxpdmVfbW9jcyAqYXJnKQoreworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNl
KCZhcmctPnNjcmF0Y2gsIEk5MTVfVk1BX1JFTEVBU0VfTUFQKTsKKwlrZXJuZWxfY29udGV4dF9j
bG9zZShhcmctPmN0eCk7Cit9CisKK3N0YXRpYyBpbnQgcmVhZF9tb2NzX3RhYmxlKHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLAorCQkJICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUg
KnRhYmxlLAorCQkJICAgc3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJdW5zaWduZWQgaW50IGk7
CisJaW50IGVycjsKKwl1MzIgKmNzOworCisJaTkxNV92bWFfbG9jayh2bWEpOworCWVyciA9IGk5
MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCB0cnVlKTsKKwlpZiAoIWVycikK
KwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJ
VEUpOworCWk5MTVfdm1hX3VubG9jayh2bWEpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisK
KwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDQgKiB0YWJsZS0+bl9lbnRyaWVzKTsKKwlpZiAo
SVNfRVJSKGNzKSkKKwkJcmV0dXJuIFBUUl9FUlIoY3MpOworCisJZm9yIChpID0gMDsgaSA8IHRh
YmxlLT5uX2VudHJpZXM7IGkrKykgeworCQkqY3MrKyA9IE1JX1NUT1JFX1JFR0lTVEVSX01FTV9H
RU44IHwgTUlfVVNFX0dHVFQ7CisJCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoSEFTX0dM
T0JBTF9NT0NTX1JFR0lTVEVSUyhycS0+aTkxNSkgPworCQkJCQkgICAgIEdFTjEyX0dMT0JBTF9N
T0NTKGkpIDoKKwkJCQkJICAgICBtb2NzX3JlZ2lzdGVyKHJxLT5lbmdpbmUsIGkpKTsKKwkJKmNz
KysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSkgKyBpICogc2l6ZW9mKHUzMik7CisJCSpjcysrID0g
MDsKKwl9CisKKwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IGNoZWNrX21vY3NfdGFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAorCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwKKwkJ
CSAgICBjb25zdCB1MzIgKnZhZGRyKQoreworCXVuc2lnbmVkIGludCBpOworCXUzMiBleHBlY3Q7
CisKKwlmb3IgKGkgPSAwOyBpIDwgdGFibGUtPnNpemU7IGkrKykgeworCQlpZiAoSEFTX0dMT0JB
TF9NT0NTX1JFR0lTVEVSUyhlbmdpbmUtPmk5MTUpKQorCQkJZXhwZWN0ID0gdGFibGUtPnRhYmxl
W2ldLmNvbnRyb2xfdmFsdWU7CisJCWVsc2UKKwkJCWV4cGVjdCA9IGdldF9lbnRyeV9jb250cm9s
KHRhYmxlLCBpKTsKKworCQlpZiAodmFkZHJbaV0gIT0gZXhwZWN0KSB7CisJCQlwcl9lcnIoIiVz
OiBJbnZhbGlkIE1PQ1NbJWRdIGVudHJ5LCBmb3VuZCAlMDh4LCBleHBlY3RlZCAlMDh4XG4iLAor
CQkJICAgICAgIGVuZ2luZS0+bmFtZSwgaSwgdmFkZHJbaV0sIGV4cGVjdCk7CisJCQlyZXR1cm4g
LUVJTlZBTDsKKwkJfQorCX0KKworCS8qIEFsbCByZW1haW5pbmcgZW50cmllcyBhcmUgZGVmYXVs
dCAqLworCWlmIChIQVNfR0xPQkFMX01PQ1NfUkVHSVNURVJTKGVuZ2luZS0+aTkxNSkpCisJCWV4
cGVjdCA9IHRhYmxlLT50YWJsZVswXS5jb250cm9sX3ZhbHVlOworCWVsc2UKKwkJZXhwZWN0ID0g
dGFibGUtPnRhYmxlW0k5MTVfTU9DU19QVEVdLmNvbnRyb2xfdmFsdWU7CisJZm9yICg7IGkgPCB0
YWJsZS0+bl9lbnRyaWVzOyBpKyspIHsKKwkJaWYgKHZhZGRyW2ldICE9IGV4cGVjdCkgeworCQkJ
cHJfZXJyKCIlczogSW52YWxpZCBNT0NTWyVkKl0gZW50cnksIGZvdW5kICUwOHgsIGV4cGVjdGVk
ICUwOHhcbiIsCisJCQkgICAgICAgZW5naW5lLT5uYW1lLCBpLCB2YWRkcltpXSwgZXhwZWN0KTsK
KwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgY2hlY2tfbW9jc19lbmdpbmUoc3RydWN0IGxpdmVfbW9jcyAqYXJnLAorCQkJICAgICBzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50
IGVycjsKKworCW1lbXNldDMyKGFyZy0+dmFkZHIsIFNUQUNLX01BR0lDLCBQQUdFX1NJWkUvc2l6
ZW9mKHUzMikpOworCisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKKwlp
ZiAoSVNfRVJSKHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJZXJyID0gcmVhZF9tb2Nz
X3RhYmxlKHJxLCAmYXJnLT50YWJsZSwgYXJnLT5zY3JhdGNoKTsKKworCWVyciA9IHJlcXVlc3Rf
YWRkX3N5bmMocnEsIGVycik7CisJaWYoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIGNo
ZWNrX21vY3NfdGFibGUoY2UtPmVuZ2luZSwgJmFyZy0+dGFibGUsIGFyZy0+dmFkZHIpOworfQor
CitzdGF0aWMgaW50IGxpdmVfbW9jc19jbGVhbih2b2lkICphcmcpCit7CisJc3RydWN0IGludGVs
X2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OworCXN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZTsKKwlzdHJ1Y3QgbGl2ZV9tb2NzIG1vY3M7CisJaW50IGVycjsK
KworCWVyciA9IGxpdmVfbW9jc19pbml0KCZtb2NzLCBndCk7CisJaWYgKGVycikKKwkJcmV0dXJu
IGVycjsKKworCS8qIFhYWCBmb3JfZWFjaF9lbmdpbmUoZ3QpIG9uY2Ugd2UgY2FuIGNyZWF0ZSBy
YXcgaW50ZWxfY29udGV4dCAqLworCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2Nv
bnRleHRfbG9ja19lbmdpbmVzKG1vY3MuY3R4KSwgaXQpIHsKKwkJZXJyID0gY2hlY2tfbW9jc19l
bmdpbmUoJm1vY3MsIGNlKTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCX0KKwlpOTE1X2dlbV9j
b250ZXh0X3VubG9ja19lbmdpbmVzKG1vY3MuY3R4KTsKKworCWxpdmVfbW9jc19maW5pKCZtb2Nz
KTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgYWN0aXZlX2VuZ2luZV9yZXNldChz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJCQkgICAgICAgY29uc3QgY2hhciAqcmVhc29uKQor
eworCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwor
CWludCBlcnI7CisKKwllcnIgPSBpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluLCBjZS0+ZW5naW5lLT5n
dCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRl
X3JlcXVlc3QoJnNwaW4sIGNlLCBNSV9OT09QKTsKKwlpZiAoSVNfRVJSKHJxKSkgeworCQlpZ3Rf
c3Bpbm5lcl9maW5pKCZzcGluKTsKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCX0KKworCWVyciA9
IHJlcXVlc3RfYWRkX3NwaW4ocnEsICZzcGluKTsKKwlpZiAoZXJyID09IDApCisJCWVyciA9IGlu
dGVsX2VuZ2luZV9yZXNldChjZS0+ZW5naW5lLCByZWFzb24pOworCisJaWd0X3NwaW5uZXJfZW5k
KCZzcGluKTsKKwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKKworCXJldHVybiBlcnI7CisKK30K
K3N0YXRpYyBpbnQgbGl2ZV9tb2NzX3Jlc2V0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxf
Z3QgKmd0ID0gYXJnOworCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CisJc3RydWN0
IGludGVsX2NvbnRleHQgKmNlOworCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworCXN0cnVjdCBs
aXZlX21vY3MgbW9jczsKKwlpbnQgZXJyID0gMDsKKworCWlmICghaW50ZWxfaGFzX3Jlc2V0X2Vu
Z2luZShndCkpCisJCXJldHVybiAwOworCisJZXJyID0gbGl2ZV9tb2NzX2luaXQoJm1vY3MsIGd0
KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0
KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZ3QtPnVuY29yZS0+cnBtKTsKKwor
CWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKG1v
Y3MuY3R4KSwgaXQpIHsKKwkJZXJyID0gaW50ZWxfZW5naW5lX3Jlc2V0KGNlLT5lbmdpbmUsICJt
b2NzIik7CisJCWlmIChlcnIpCisJCQlicmVhazsKKworCQllcnIgPSBjaGVja19tb2NzX2VuZ2lu
ZSgmbW9jcywgY2UpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisKKwkJZXJyID0gYWN0aXZlX2Vu
Z2luZV9yZXNldChjZSwgIm1vY3MiKTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCisJCWVyciA9
IGNoZWNrX21vY3NfZW5naW5lKCZtb2NzLCBjZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKwl9
CisJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhtb2NzLmN0eCk7CisKKwlpbnRlbF9y
dW50aW1lX3BtX3B1dChndC0+dW5jb3JlLT5ycG0sIHdha2VyZWYpOworCWlndF9nbG9iYWxfcmVz
ZXRfdW5sb2NrKGd0KTsKKworCWxpdmVfbW9jc19maW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJyOwor
fQorCitpbnQgaW50ZWxfbW9jc19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0g
eworCQlTVUJURVNUKGxpdmVfbW9jc19jbGVhbiksCisJCVNVQlRFU1QobGl2ZV9tb2NzX3Jlc2V0
KSwKKwl9OworCXN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlIHRhYmxlOworCisJaWYgKCFnZXRf
bW9jc19zZXR0aW5ncyhpOTE1LCAmdGFibGUpKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBpbnRl
bF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCAmaTkxNS0+Z3QpOworfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKaW5kZXggNmRh
ZjY1OTllYzc5Li4xYTZhYmNmZmNlODEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaApAQCAtMTYsNiArMTYsNyBAQCBzZWxm
dGVzdChndF9lbmdpbmVzLCBpbnRlbF9lbmdpbmVfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChn
dF90aW1lbGluZXMsIGludGVsX3RpbWVsaW5lX2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZ3Rf
Y29udGV4dHMsIGludGVsX2NvbnRleHRfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF9scmMs
IGludGVsX2xyY19saXZlX3NlbGZ0ZXN0cykKK3NlbGZ0ZXN0KGd0X21vY3MsIGludGVsX21vY3Nf
bGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF9wbSwgaW50ZWxfZ3RfcG1fbGl2ZV9zZWxmdGVz
dHMpCiBzZWxmdGVzdChyZXF1ZXN0cywgaTkxNV9yZXF1ZXN0X2xpdmVfc2VsZnRlc3RzKQogc2Vs
ZnRlc3QoYWN0aXZlLCBpOTE1X2FjdGl2ZV9saXZlX3NlbGZ0ZXN0cykKLS0gCjIuMjMuMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BE726684F3
	for <lists+intel-gfx@lfdr.de>; Mon, 15 Jul 2019 10:11:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 60EBA89826;
	Mon, 15 Jul 2019 08:11:46 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 289E38984F
 for <intel-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 08:11:44 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17303237-1500050 
 for multiple; Mon, 15 Jul 2019 09:09:50 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 15 Jul 2019 09:09:23 +0100
Message-Id: <20190715080946.15593-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 01/24] drm/i915: Hide unshrinkable context
 objects from the shrinker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHNocmlua2VyIGNhbm5vdCB0b3VjaCBvYmplY3RzIHVzZWQgYnkgdGhlIGNvbnRleHRzIChs
b2dpY2FsIHN0YXRlCmFuZCByaW5nKS4gQ3VycmVudGx5IHdlIG1hcmsgdGhvc2UgYXMgInBpbl9n
bG9iYWwiIHRvIGxldCB0aGUgc2hyaW5rZXIKc2tpcCBvdmVyIHRoZW0sIGhvd2V2ZXIsIGlmIHdl
IHJlbW92ZSB0aGVtIGZyb20gdGhlIHNocmlua2VyIGxpc3RzCmVudGlyZWx5LCB3ZSBkb24ndCBl
dmVudCBoYXZlIHRvIGluY2x1ZGUgdGhlbSBpbiBvdXIgc2hyaW5rIGFjY291bnRpbmcuCgpCeSBr
ZWVwaW5nIHRoZSB1bnNocmlua2FibGUgb2JqZWN0cyBpbiBvdXIgc2hyaW5rZXIgdHJhY2tpbmcs
IHdlIHJlcG9ydAphIGxhcmdlIG51bWJlciBvZiBvYmplY3RzIGF2YWlsYWJsZSB0byBiZSBzaHJ1
bmssIGFuZCBsZWF2ZSB0aGUgc2hyaW5rZXIKZGVlcGx5IHVuc2F0aXNmaWVkIHdoZW4gd2UgZmFp
bCB0byByZWNsYWltIHRob3NlLiBUaGUgc2hyaW5rZXIgd2lsbApwZXJzaXN0IGluIHRyeWluZyB0
byByZWNsYWltIHRoZSB1bmF2YWlsYWJsZSBvYmplY3RzLCBmb3JjaW5nIHRoZSBzeXN0ZW0KaW50
byBhIGxpdmVsb2NrIChub3QgZXZlbiBoaXR0aW5nIHRoZSBkcmVhZCBvb21raWxsZXIpLgoKU2ln
bmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jICAgfCAxMSArKy0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oICAgfCAgNCArKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMgICAgfCAxMyArLS0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jIHwgNDIgKysrKysrKysr
KysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyAgICAg
IHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyAgIHwg
MTcgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAg
IHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAgICAgICAgICAgIHwg
MTUgKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAgICAgICAgICAg
fCAgNCArKwogOSBmaWxlcyBjaGFuZ2VkLCA4MiBpbnNlcnRpb25zKCspLCAzMSBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggZDUx
OTdhMmExMDZmLi40ZWE5N2ZjYTljMzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0LmMKQEAgLTYzLDYgKzYzLDggQEAgdm9pZCBpOTE1X2dlbV9vYmplY3RfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXNwaW5fbG9ja19pbml0KCZvYmot
PnZtYS5sb2NrKTsKIAlJTklUX0xJU1RfSEVBRCgmb2JqLT52bWEubGlzdCk7CiAKKwlJTklUX0xJ
U1RfSEVBRCgmb2JqLT5tbS5saW5rKTsKKwogCUlOSVRfTElTVF9IRUFEKCZvYmotPmx1dF9saXN0
KTsKIAlJTklUX0xJU1RfSEVBRCgmb2JqLT5iYXRjaF9wb29sX2xpbmspOwogCkBAIC0yNzMsMTQg
KzI3NSw3IEBAIHZvaWQgaTkxNV9nZW1fZnJlZV9vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0
ICpnZW1fb2JqKQogCSAqIG9yIGVsc2Ugd2UgbWF5IG9vbSB3aGlsc3QgdGhlcmUgYXJlIHBsZW50
eSBvZiBkZWZlcnJlZAogCSAqIGZyZWVkIG9iamVjdHMuCiAJICovCi0JaWYgKGk5MTVfZ2VtX29i
amVjdF9oYXNfcGFnZXMob2JqKSAmJgotCSAgICBpOTE1X2dlbV9vYmplY3RfaXNfc2hyaW5rYWJs
ZShvYmopKSB7Ci0JCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0KLQkJc3Bpbl9sb2NrX2lycXNhdmUo
Jmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7Ci0JCWxpc3RfZGVsX2luaXQoJm9iai0+bW0ubGlu
ayk7Ci0JCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7
Ci0JfQorCWk5MTVfZ2VtX29iamVjdF9tYWtlX3Vuc2hyaW5rYWJsZShvYmopOwogCiAJLyoKIAkg
KiBTaW5jZSB3ZSByZXF1aXJlIGJsb2NraW5nIG9uIHN0cnVjdF9tdXRleCB0byB1bmJpbmQgdGhl
IGZyZWVkCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5kZXgg
NjdhZWEwN2VhMDE5Li4zNzE0Y2YyMzRkNjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmgKQEAgLTM5NCw2ICszOTQsMTAgQEAgaTkxNV9nZW1fb2JqZWN0X3Bp
bl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJ
ICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpOwogdm9pZCBpOTE1X2dlbV9vYmplY3RfdW5waW5fZnJv
bV9kaXNwbGF5X3BsYW5lKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIAordm9pZCBpOTE1X2dlbV9v
YmplY3RfbWFrZV91bnNocmlua2FibGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7
Cit2b2lkIGk5MTVfZ2VtX29iamVjdF9tYWtlX3Nocmlua2FibGUoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaik7Cit2b2lkIGk5MTVfZ2VtX29iamVjdF9tYWtlX3B1cmdlYWJsZShzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsKKwogc3RhdGljIGlubGluZSBib29sIGNwdV93
cml0ZV9uZWVkc19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJ
aWYgKG9iai0+Y2FjaGVfZGlydHkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fcGFnZXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9w
YWdlcy5jCmluZGV4IGIzNmFkMjY5ZjRlYS4uOTJhZDNjYzIyMGUzIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGFnZXMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fcGFnZXMuYwpAQCAtMTUzLDI0ICsxNTMsMTMgQEAgc3RhdGlj
IHZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVzZXRfcGFnZV9pdGVyKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCiBzdHJ1Y3Qgc2dfdGFibGUgKgogX19pOTE1X2dlbV9vYmplY3RfdW5z
ZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CiAJc3RydWN0IHNn
X3RhYmxlICpwYWdlczsKIAogCXBhZ2VzID0gZmV0Y2hfYW5kX3plcm8oJm9iai0+bW0ucGFnZXMp
OwogCWlmIChJU19FUlJfT1JfTlVMTChwYWdlcykpCiAJCXJldHVybiBwYWdlczsKIAotCWlmIChp
OTE1X2dlbV9vYmplY3RfaXNfc2hyaW5rYWJsZShvYmopKSB7Ci0JCXVuc2lnbmVkIGxvbmcgZmxh
Z3M7Ci0KLQkJc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7Ci0K
LQkJbGlzdF9kZWwoJm9iai0+bW0ubGluayk7Ci0JCWk5MTUtPm1tLnNocmlua19jb3VudC0tOwot
CQlpOTE1LT5tbS5zaHJpbmtfbWVtb3J5IC09IG9iai0+YmFzZS5zaXplOwotCi0JCXNwaW5fdW5s
b2NrX2lycXJlc3RvcmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7Ci0JfQorCWk5MTVfZ2Vt
X29iamVjdF9tYWtlX3Vuc2hyaW5rYWJsZShvYmopOwogCiAJaWYgKG9iai0+bW0ubWFwcGluZykg
ewogCQl2b2lkICpwdHI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fc2hyaW5rZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJp
bmtlci5jCmluZGV4IDNmNGM2YmRjYzNjMy4uZWI5ZjU2ZjhlOWI1IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwpAQCAtNTMwLDMgKzUzMCw0NSBAQCB2
b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3RhaW50c19tdXRleChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAlpZiAodW5sb2NrKQogCQltdXRleF9yZWxlYXNlKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4LmRlcF9tYXAsIDAsIF9SRVRfSVBfKTsKIH0KKwordm9pZCBpOTE1X2dlbV9vYmplY3Rf
bWFrZV91bnNocmlua2FibGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlp
ZiAoIWxpc3RfZW1wdHkoJm9iai0+bW0ubGluaykpIHsKKwkJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCQl1bnNpZ25lZCBsb25nIGZsYWdz
OworCisJCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3MpOworCQls
aXN0X2RlbF9pbml0KCZvYmotPm1tLmxpbmspOworCQlpOTE1LT5tbS5zaHJpbmtfY291bnQtLTsK
KwkJaTkxNS0+bW0uc2hyaW5rX21lbW9yeSAtPSBvYmotPmJhc2Uuc2l6ZTsKKwkJc3Bpbl91bmxv
Y2tfaXJxcmVzdG9yZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKKwl9Cit9CisKK3ZvaWQg
aTkxNV9nZW1fb2JqZWN0X21ha2Vfc2hyaW5rYWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQoreworCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfc2hyaW5rYWJsZShvYmopKSB7CisJ
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsK
KwkJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+bW0u
b2JqX2xvY2ssIGZsYWdzKTsKKwkJbGlzdF9hZGRfdGFpbCgmb2JqLT5tbS5saW5rLCAmaTkxNS0+
bW0uc2hyaW5rX2xpc3QpOworCQlpOTE1LT5tbS5zaHJpbmtfY291bnQrKzsKKwkJaTkxNS0+bW0u
c2hyaW5rX21lbW9yeSArPSBvYmotPmJhc2Uuc2l6ZTsKKwkJc3Bpbl91bmxvY2tfaXJxcmVzdG9y
ZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKKwl9Cit9CisKK3ZvaWQgaTkxNV9nZW1fb2Jq
ZWN0X21ha2VfcHVyZ2VhYmxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJ
aWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpIHsKKwkJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCQl1bnNpZ25lZCBs
b25nIGZsYWdzOworCisJCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxh
Z3MpOworCQlsaXN0X2FkZF90YWlsKCZvYmotPm1tLmxpbmssICZpOTE1LT5tbS5wdXJnZV9saXN0
KTsKKwkJaTkxNS0+bW0uc2hyaW5rX2NvdW50Kys7CisJCWk5MTUtPm1tLnNocmlua19tZW1vcnkg
Kz0gb2JqLT5iYXNlLnNpemU7CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmk5MTUtPm1tLm9i
al9sb2NrLCBmbGFncyk7CisJfQorfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4
dC5jCmluZGV4IDExMTBmYzhmNjU3YS4uZjAxMmVjODk4YWJhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC0xMTgsNyArMTE4LDcgQEAgc3RhdGljIGludCBfX2Nv
bnRleHRfcGluX3N0YXRlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCSAqIEFuZCBtYXJrIGl0IGFz
IGEgZ2xvYmFsbHkgcGlubmVkIG9iamVjdCB0byBsZXQgdGhlIHNocmlua2VyIGtub3cKIAkgKiBp
dCBjYW5ub3QgcmVjbGFpbSB0aGUgb2JqZWN0IHVudGlsIHdlIHJlbGVhc2UgaXQuCiAJICovCi0J
dm1hLT5vYmotPnBpbl9nbG9iYWwrKzsKKwlpOTE1X3ZtYV9tYWtlX3Vuc2hyaW5rYWJsZSh2bWEp
OwogCXZtYS0+b2JqLT5tbS5kaXJ0eSA9IHRydWU7CiAKIAlyZXR1cm4gMDsKQEAgLTEyNiw4ICsx
MjYsOCBAQCBzdGF0aWMgaW50IF9fY29udGV4dF9waW5fc3RhdGUoc3RydWN0IGk5MTVfdm1hICp2
bWEpCiAKIHN0YXRpYyB2b2lkIF9fY29udGV4dF91bnBpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIHsKLQl2bWEtPm9iai0+cGluX2dsb2JhbC0tOwogCV9faTkxNV92bWFfdW5waW4odm1h
KTsKKwlpOTE1X3ZtYV9tYWtlX3Nocmlua2FibGUodm1hKTsKIH0KIAogc3RhdGljIHZvaWQgX19p
bnRlbF9jb250ZXh0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKmFjdGl2ZSkKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCBmMWU1NzFmYTJlNmQuLmYz
OWM3NDc0MGQ4ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIu
YwpAQCAtMTIwMCw3ICsxMjAwLDcgQEAgaW50IGludGVsX3JpbmdfcGluKHN0cnVjdCBpbnRlbF9y
aW5nICpyaW5nKQogCQlnb3RvIGVycl9yaW5nOwogCX0KIAotCXZtYS0+b2JqLT5waW5fZ2xvYmFs
Kys7CisJaTkxNV92bWFfbWFrZV91bnNocmlua2FibGUodm1hKTsKIAogCUdFTV9CVUdfT04ocmlu
Zy0+dmFkZHIpOwogCXJpbmctPnZhZGRyID0gYWRkcjsKQEAgLTEyMjksNiArMTIyOSw4IEBAIHZv
aWQgaW50ZWxfcmluZ19yZXNldChzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZywgdTMyIHRhaWwpCiAK
IHZvaWQgaW50ZWxfcmluZ191bnBpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIHsKKwlzdHJ1
Y3QgaTkxNV92bWEgKnZtYSA9IHJpbmctPnZtYTsKKwogCWlmICghYXRvbWljX2RlY19hbmRfdGVz
dCgmcmluZy0+cGluX2NvdW50KSkKIAkJcmV0dXJuOwogCkBAIC0xMjM3LDE4ICsxMjM5LDE3IEBA
IHZvaWQgaW50ZWxfcmluZ191bnBpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAkvKiBEaXNj
YXJkIGFueSB1bnVzZWQgYnl0ZXMgYmV5b25kIHRoYXQgc3VibWl0dGVkIHRvIGh3LiAqLwogCWlu
dGVsX3JpbmdfcmVzZXQocmluZywgcmluZy0+dGFpbCk7CiAKLQlHRU1fQlVHX09OKCFyaW5nLT52
bWEpOwotCWk5MTVfdm1hX3Vuc2V0X2dndHRfd3JpdGUocmluZy0+dm1hKTsKLQlpZiAoaTkxNV92
bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUocmluZy0+dm1hKSkKLQkJaTkxNV92bWFfdW5waW5faW9t
YXAocmluZy0+dm1hKTsKKwlpOTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSk7CisJaWYgKGk5
MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpCisJCWk5MTVfdm1hX3VucGluX2lvbWFw
KHZtYSk7CiAJZWxzZQotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHJpbmctPnZtYS0+b2Jq
KTsKKwkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcCh2bWEtPm9iaik7CiAKIAlHRU1fQlVHX09O
KCFyaW5nLT52YWRkcik7CiAJcmluZy0+dmFkZHIgPSBOVUxMOwogCi0JcmluZy0+dm1hLT5vYmot
PnBpbl9nbG9iYWwtLTsKLQlpOTE1X3ZtYV91bnBpbihyaW5nLT52bWEpOworCWk5MTVfdm1hX3Vu
cGluKHZtYSk7CisJaTkxNV92bWFfbWFrZV9wdXJnZWFibGUodm1hKTsKIAogCWludGVsX3RpbWVs
aW5lX3VucGluKHJpbmctPnRpbWVsaW5lKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2Zz
LmMKaW5kZXggMGFjOWI4ZDVlOGI5Li44YmRmMWQxMDA2MjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZGVidWdmcy5jCkBAIC0zNjMsOCArMzYzLDkgQEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmpl
Y3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CiAJaW50IHJldDsKIAot
CXNlcV9wcmludGYobSwgIiV1IHNocmlua2FibGUgb2JqZWN0cywgJWxsdSBieXRlc1xuIiwKKwlz
ZXFfcHJpbnRmKG0sICIldSBzaHJpbmthYmxlIFsldSBmcmVlXSBvYmplY3RzLCAlbGx1IGJ5dGVz
XG4iLAogCQkgICBpOTE1LT5tbS5zaHJpbmtfY291bnQsCisJCSAgIGF0b21pY19yZWFkKCZpOTE1
LT5tbS5mcmVlX2NvdW50KSwKIAkJICAgaTkxNS0+bW0uc2hyaW5rX21lbW9yeSk7CiAKIAlzZXFf
cHV0YyhtLCAnXG4nKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IGVlNzNiYWYyOTQxNS4u
MWQwMDNlYzlkYTE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTEwMzAsNiArMTAzMCwy
MSBAQCBpbnQgaTkxNV92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCXJldHVybiAw
OwogfQogCit2b2lkIGk5MTVfdm1hX21ha2VfdW5zaHJpbmthYmxlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQoreworCWk5MTVfZ2VtX29iamVjdF9tYWtlX3Vuc2hyaW5rYWJsZSh2bWEtPm9iaik7Cit9
CisKK3ZvaWQgaTkxNV92bWFfbWFrZV9zaHJpbmthYmxlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQor
eworCWk5MTVfZ2VtX29iamVjdF9tYWtlX3Nocmlua2FibGUodm1hLT5vYmopOworfQorCit2b2lk
IGk5MTVfdm1hX21ha2VfcHVyZ2VhYmxlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCWk5MTVf
Z2VtX29iamVjdF9tYWtlX3B1cmdlYWJsZSh2bWEtPm9iaik7Cit9CisKICNpZiBJU19FTkFCTEVE
KENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKICNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV92bWEu
YyIKICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKaW5kZXggNGI3NjlkYjY0OWJmLi5hMjRi
ZDY3ODdlZjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaApAQCAtNDU5LDQgKzQ1OSw4IEBAIHZv
aWQgaTkxNV92bWFfcGFya2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHN0cnVj
dCBpOTE1X3ZtYSAqaTkxNV92bWFfYWxsb2Modm9pZCk7CiB2b2lkIGk5MTVfdm1hX2ZyZWUoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpOwogCit2b2lkIGk5MTVfdm1hX21ha2VfdW5zaHJpbmthYmxlKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKTsKK3ZvaWQgaTkxNV92bWFfbWFrZV9zaHJpbmthYmxlKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKTsKK3ZvaWQgaTkxNV92bWFfbWFrZV9wdXJnZWFibGUoc3RydWN0IGk5
MTVfdm1hICp2bWEpOworCiAjZW5kaWYKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5E07BBDBB3
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 12:02:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 482976EB7C;
	Wed, 25 Sep 2019 10:02:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 61DBC6EB75
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 10:01:58 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18609372-1500050 
 for multiple; Wed, 25 Sep 2019 11:01:45 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 11:01:21 +0100
Message-Id: <20190925100137.17956-12-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190925100137.17956-1-chris@chris-wilson.co.uk>
References: <20190925100137.17956-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 11/27] drm/i915: Merge wait_for_timelines with
 retire_request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

d2FpdF9mb3JfdGltZWxpbmVzIGlzIGVzc2VudGlhbGx5IHRoZSBzYW1lIGxvb3AgYXMgcmV0aXJp
bmcgcmVxdWVzdHMKKHdpdGggYW4gZXh0cmEgdGltZW91dCksIHNvIG1lcmdlIHRoZSB0d28gaW50
byBvbmUgcm91dGluZS4KCnYyOiBpOTE1X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0IGFuZCBrZWVw
IFZUJ2Qgdy9hIGFzICFpbnRlcnJ1cHRpYmxlCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fbW1hbi5jICAgICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3BtLmMgICAgICAgIHwgIDQgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5
MTVfZ2VtX2NvbnRleHQuYyB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAg
ICAgICAgICAgICAgIHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAg
ICAgICAgICAgICB8IDY3ICsrLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2V2aWN0LmMgICAgICAgICB8IDEyICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2d0dC5jICAgICAgICAgICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuYyAgICAgICAgICAgfCAyNiArKysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuaCAgICAgICAgICAgfCAgNyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYyAgIHwgIDQgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9saXZlX3Rlc3QuYyAgICB8ICA0ICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAgMiArLQogMTMgZmlsZXMgY2hhbmdlZCwgNDkgaW5zZXJ0
aW9ucygrKSwgOTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9tbWFuLmMKaW5kZXggYzQ0NjE0ODk1NDg3Li45Y2I1OWZlMWE3MzYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAtNDMxLDkgKzQzMSw3IEBAIHN0YXRpYyBp
bnQgY3JlYXRlX21tYXBfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAK
IAkvKiBBdHRlbXB0IHRvIHJlYXAgc29tZSBtbWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3RzICov
CiAJZG8gewotCQllcnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJCSAgICAg
STkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCi0JCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQp
OworCQllcnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hFRFVMRV9USU1F
T1VUKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9wbS5jCmluZGV4IGM5YzllNDkzOTFmYS4uMDRhOWEyN2Q2NTlkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtNTksOSArNTksNyBAQCBzdGF0aWMgYm9vbCBz
d2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCWJv
b2wgcmVzdWx0ID0gIWludGVsX2d0X2lzX3dlZGdlZChndCk7CiAKLQlpZiAoaTkxNV9nZW1fd2Fp
dF9mb3JfaWRsZShndC0+aTkxNSwKLQkJCQkgICBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QsCi0J
CQkJICAgSTkxNV9HRU1fSURMRV9USU1FT1VUKSA9PSAtRVRJTUUpIHsKKwlpZiAoaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZShndC0+aTkxNSwgSTkxNV9HRU1fSURMRV9USU1FT1VUKSA9PSAtRVRJTUUp
IHsKIAkJLyogWFhYIGhpZGUgd2FybmluZyBmcm9tIGdlbV9laW8gKi8KIAkJaWYgKGk5MTVfbW9k
cGFyYW1zLnJlc2V0KSB7CiAJCQlkZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpp
bmRleCA4MmY1NGU4MTllYjAuLmIyNmY1NTBmODQzMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTkyMyw3ICs5
MjMsNyBAQCBfX3NzZXVfZmluaXNoKGNvbnN0IGNoYXIgKm5hbWUsCiAKIAlpZiAoKGZsYWdzICYg
VEVTVF9JRExFKSAmJiByZXQgPT0gMCkgewogCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxl
KGNlLT5lbmdpbmUtPmk5MTUsCi0JCQkJCSAgICAgMCwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwor
CQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBy
ZXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggN2JiYzllZGE4ZWJlLi4w
MzM3NjQzMjY2MDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0zNjMyLDkg
KzM2MzIsNyBAQCBpOTE1X2Ryb3BfY2FjaGVzX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogCQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKIAogCWlmICh2YWwgJiAoRFJPUF9JRExFIHwgRFJP
UF9BQ1RJVkUpKSB7Ci0JCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkJ
ICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKLQkJCQkJICAgICBNQVhfU0NIRURVTEVfVElN
RU9VVCk7CisJCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgTUFYX1NDSEVEVUxF
X1RJTUVPVVQpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAl9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaAppbmRleCAzNjExZmQ1NDQ2ZjMuLjZlNWQ1ZTRjYTkxZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oCkBAIC0yMzI4LDggKzIzMjgsNyBAQCB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWdp
c3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiB2b2lkIGk5MTVfZ2VtX2RyaXZl
cl91bnJlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHZvaWQgaTkxNV9n
ZW1fZHJpdmVyX3JlbW92ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9p
ZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpOwotaW50IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAotCQkJICAgdW5zaWduZWQgaW50IGZsYWdzLCBsb25nIHRpbWVvdXQpOworaW50
IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBsb25nIHRpbWVvdXQpOwogdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGk5MTVfZ2VtX3N1c3BlbmRfbGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpOTE1X2dlbV9yZXN1bWUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDQ3
YzUzYmI5ZWI4OS4uYWIyMzk0NDU3MWZhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTg4
Myw2MSArODgzLDcgQEAgdm9pZCBpOTE1X2dlbV9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiAJfQogfQogCi1zdGF0aWMgbG9uZwotd2FpdF9mb3JfdGltZWxp
bmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHVuc2lnbmVkIGludCB3YWl0LCBsb25nIHRpbWVvdXQp
Ci17Ci0Jc3RydWN0IGludGVsX2d0X3RpbWVsaW5lcyAqdGltZWxpbmVzID0gJmd0LT50aW1lbGlu
ZXM7Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0bDsKLQl1bnNpZ25lZCBsb25nIGZsYWdzOwot
Ci0Jc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCWxpc3RfZm9y
X2VhY2hfZW50cnkodGwsICZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCBsaW5rKSB7Ci0JCXN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlOwotCi0JCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0
bC0+bGFzdF9yZXF1ZXN0KTsKLQkJaWYgKCFmZW5jZSkKLQkJCWNvbnRpbnVlOwotCi0JCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCi0JCWlmICghZG1h
X2ZlbmNlX2lzX2k5MTUoZmVuY2UpKSB7Ci0JCQl0aW1lb3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGlt
ZW91dChmZW5jZSwKLQkJCQkJCQkgZmxhZ3MgJiBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKLQkJ
CQkJCQkgdGltZW91dCk7Ci0JCX0gZWxzZSB7Ci0JCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9
IHRvX3JlcXVlc3QoZmVuY2UpOwotCi0JCQkvKgotCQkJICogIlJhY2UtdG8taWRsZSIuCi0JCQkg
KgotCQkJICogU3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGFz
Ci0JCQkgKiBhIHN5bmNocm9ub3VzIHN0ZXAgcHJpb3IgdG8gaWRsaW5nLCBlLmcuIGluIHN1c3Bl
bmQKLQkJCSAqIGZvciBmbHVzaGluZyBhbGwgY3VycmVudCBvcGVyYXRpb25zIHRvIG1lbW9yeSBi
ZWZvcmUKLQkJCSAqIHNsZWVwaW5nLiBUaGVzZSB3ZSB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNr
bHkgYXMKLQkJCSAqIHBvc3NpYmxlIHRvIGF2b2lkIHByb2xvbmdlZCBzdGFsbHMsIHNvIGFsbG93
IHRoZSBncHUKLQkJCSAqIHRvIGJvb3N0IHRvIG1heGltdW0gY2xvY2tzLgotCQkJICovCi0JCQlp
ZiAoZmxhZ3MgJiBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QpCi0JCQkJZ2VuNl9ycHNfYm9vc3Qo
cnEpOwotCi0JCQl0aW1lb3V0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocnEsIGZsYWdzLCB0aW1lb3V0
KTsKLQkJfQotCi0JCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCQlpZiAodGltZW91dCA8IDApCi0J
CQlyZXR1cm4gdGltZW91dDsKLQotCQkvKiByZXN0YXJ0IGFmdGVyIHJlYWNxdWlyaW5nIHRoZSBs
b2NrICovCi0JCXNwaW5fbG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQkJ
dGwgPSBsaXN0X2VudHJ5KCZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCB0eXBlb2YoKnRsKSwgbGlu
ayk7Ci0JfQotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3Mp
OwotCi0JcmV0dXJuIHRpbWVvdXQ7Ci19Ci0KLWludCBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJICAgdW5zaWduZWQgaW50IGZsYWdzLCBs
b25nIHRpbWVvdXQpCitpbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwgbG9uZyB0aW1lb3V0KQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAm
aTkxNS0+Z3Q7CiAKQEAgLTk0NSwxOCArODkxLDEzIEBAIGludCBpOTE1X2dlbV93YWl0X2Zvcl9p
ZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlmICghaW50ZWxfZ3RfcG1faXNf
YXdha2UoZ3QpKQogCQlyZXR1cm4gMDsKIAotCWRvIHsKLQkJdGltZW91dCA9IHdhaXRfZm9yX3Rp
bWVsaW5lcyhndCwgZmxhZ3MsIHRpbWVvdXQpOwotCQlpZiAodGltZW91dCA8IDApCi0JCQlyZXR1
cm4gdGltZW91dDsKLQorCXdoaWxlICgodGltZW91dCA9IGk5MTVfcmV0aXJlX3JlcXVlc3RzX3Rp
bWVvdXQoaTkxNSwgdGltZW91dCkpID4gMCkgewogCQljb25kX3Jlc2NoZWQoKTsKIAkJaWYgKHNp
Z25hbF9wZW5kaW5nKGN1cnJlbnQpKQogCQkJcmV0dXJuIC1FSU5UUjsKKwl9CiAKLQl9IHdoaWxl
IChpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KSk7Ci0KLQlyZXR1cm4gMDsKKwlyZXR1cm4gdGlt
ZW91dDsKIH0KIAogc3RydWN0IGk5MTVfdm1hICoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9l
dmljdC5jCmluZGV4IDA1NTJiZjkzZWVhMy4uMGE0MTJmNmQwMWQ3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ2LDkgKzQ2LDcgQEAgc3RhdGljIGludCBnZ3R0X2Zs
dXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCSAqIHRoZSBob3BlcyB0aGF0IHdl
IGNhbiB0aGVuIHJlbW92ZSBjb250ZXh0cyBhbmQgdGhlIGxpa2Ugb25seQogCSAqIGJvdW5kIGJ5
IHRoZWlyIGFjdGl2ZSByZWZlcmVuY2UuCiAJICovCi0JcmV0dXJuIGk5MTVfZ2VtX3dhaXRfZm9y
X2lkbGUoaTkxNSwKLQkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKLQkJCQkgICAg
ICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJcmV0dXJuIGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUo
aTkxNSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogfQogCiBzdGF0aWMgYm9vbApAQCAtMTI2LDYg
KzEyNCw4IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdubWVudCwgY29sb3IsCiAJCQkJICAgIHN0
YXJ0LCBlbmQsIG1vZGUpOwogCisJaTkxNV9yZXRpcmVfcmVxdWVzdHModm0tPmk5MTUpOworCiBz
ZWFyY2hfYWdhaW46CiAJYWN0aXZlID0gTlVMTDsKIAlJTklUX0xJU1RfSEVBRCgmZXZpY3Rpb25f
bGlzdCk7CkBAIC0yNjQsMTMgKzI2NCwxMyBAQCBpbnQgaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUo
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAKIAl0cmFjZV9pOTE1X2dlbV9ldmljdF9u
b2RlKHZtLCB0YXJnZXQsIGZsYWdzKTsKIAotCS8qIFJldGlyZSBiZWZvcmUgd2Ugc2VhcmNoIHRo
ZSBhY3RpdmUgbGlzdC4gQWx0aG91Z2ggd2UgaGF2ZQorCS8qCisJICogUmV0aXJlIGJlZm9yZSB3
ZSBzZWFyY2ggdGhlIGFjdGl2ZSBsaXN0LiBBbHRob3VnaCB3ZSBoYXZlCiAJICogcmVhc29uYWJs
ZSBhY2N1cmFjeSBpbiBvdXIgcmV0aXJlbWVudCBsaXN0cywgd2UgbWF5IGhhdmUKIAkgKiBhIHN0
cmF5IHBpbiAocHJldmVudGluZyBldmljdGlvbikgdGhhdCBjYW4gb25seSBiZSByZXNvbHZlZCBi
eQogCSAqIHJldGlyaW5nLgogCSAqLwotCWlmICghKGZsYWdzICYgUElOX05PTkJMT0NLKSkKLQkJ
aTkxNV9yZXRpcmVfcmVxdWVzdHModm0tPmk5MTUpOworCWk5MTVfcmV0aXJlX3JlcXVlc3RzKHZt
LT5pOTE1KTsKIAogCWlmIChpOTE1X3ZtX2hhc19jYWNoZV9jb2xvcmluZyh2bSkpIHsKIAkJLyog
RXhwYW5kIHNlYXJjaCB0byBjb3ZlciBuZWlnaGJvdXJpbmcgZ3VhcmQgcGFnZXMgKG9yIGxhY2sh
KSAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCBiZjU3YzQxZmExZmIuLjMw
ZWUwMTZhYzJiYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTI1MjgsNyAr
MjUyOCw5IEBAIHZvaWQgaTkxNV9nZW1fZ3R0X2ZpbmlzaF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmZGV2X3ByaXYtPmdn
dHQ7CiAKIAlpZiAodW5saWtlbHkoZ2d0dC0+ZG9faWRsZV9tYXBzKSkgewotCQlpZiAoaTkxNV9n
ZW1fd2FpdF9mb3JfaWRsZShkZXZfcHJpdiwgMCwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpKSB7CisJ
CS8qIFhYWCBUaGlzIGRvZXMgbm90IHByZXZlbnQgbW9yZSByZXF1ZXN0cyBiZWluZyBzdWJtaXR0
ZWQhICovCisJCWlmIChpOTE1X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0KGRldl9wcml2LAorCQkJ
CQkJIC1NQVhfU0NIRURVTEVfVElNRU9VVCkpIHsKIAkJCURSTV9FUlJPUigiRmFpbGVkIHRvIHdh
aXQgZm9yIGlkbGU7IFZUJ2QgbWF5IGhhbmcuXG4iKTsKIAkJCS8qIFdhaXQgYSBiaXQsIGluIGhv
cGVzIGl0IGF2b2lkcyB0aGUgaGFuZyAqLwogCQkJdWRlbGF5KDEwKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZXF1ZXN0LmMKaW5kZXggNGZmZTYyYTQyMTg2Li41MmY3YzRlNWI2NDQgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0xNTA4LDEzICsxNTA4LDE5IEBAIGxvbmcgaTkx
NV9yZXF1ZXN0X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJcmV0dXJuIHRpbWVvdXQ7
CiB9CiAKLWJvb2wgaTkxNV9yZXRpcmVfcmVxdWVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCitsb25nIGk5MTVfcmV0aXJlX3JlcXVlc3RzX3RpbWVvdXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIGxvbmcgdGltZW91dCkKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3RfdGltZWxp
bmVzICp0aW1lbGluZXMgPSAmaTkxNS0+Z3QudGltZWxpbmVzOwogCXN0cnVjdCBpbnRlbF90aW1l
bGluZSAqdGwsICp0bjsKKwl1bnNpZ25lZCBsb25nIGFjdGl2ZV9jb3VudCA9IDA7CiAJdW5zaWdu
ZWQgbG9uZyBmbGFnczsKKwlib29sIGludGVycnVwdGlibGU7CiAJTElTVF9IRUFEKGZyZWUpOwog
CisJaW50ZXJydXB0aWJsZSA9IHRydWU7CisJaWYgKHRpbWVvdXQgPCAwKQorCQl0aW1lb3V0ID0g
LXRpbWVvdXQsIGludGVycnVwdGlibGUgPSBmYWxzZTsKKwogCXNwaW5fbG9ja19pcnFzYXZlKCZ0
aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodGwsIHRu
LCAmdGltZWxpbmVzLT5hY3RpdmVfbGlzdCwgbGluaykgewogCQlpZiAoIW11dGV4X3RyeWxvY2so
JnRsLT5tdXRleCkpCkBAIC0xNTI1LDEzICsxNTMxLDI3IEBAIGJvb2wgaTkxNV9yZXRpcmVfcmVx
dWVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCXRsLT5hY3RpdmVfY291bnQr
KzsgLyogcGluIHRoZSBsaXN0IGVsZW1lbnQgKi8KIAkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
dGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CiAKKwkJaWYgKHRpbWVvdXQgPiAwKSB7CisJCQlzdHJ1
Y3QgZG1hX2ZlbmNlICpmZW5jZTsKKworCQkJZmVuY2UgPSBpOTE1X2FjdGl2ZV9mZW5jZV9nZXQo
JnRsLT5sYXN0X3JlcXVlc3QpOworCQkJaWYgKGZlbmNlKSB7CisJCQkJdGltZW91dCA9IGRtYV9m
ZW5jZV93YWl0X3RpbWVvdXQoZmVuY2UsCisJCQkJCQkJCSBpbnRlcnJ1cHRpYmxlLAorCQkJCQkJ
CQkgdGltZW91dCk7CisJCQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCQl9CisJCX0KKwogCQly
ZXRpcmVfcmVxdWVzdHModGwpOwogCiAJCXNwaW5fbG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxv
Y2ssIGZsYWdzKTsKIAogCQkvKiBSZXN1bWUgaXRlcmF0aW9uIGFmdGVyIGRyb3BwaW5nIGxvY2sg
Ki8KIAkJbGlzdF9zYWZlX3Jlc2V0X25leHQodGwsIHRuLCBsaW5rKTsKLQkJaWYgKCEtLXRsLT5h
Y3RpdmVfY291bnQpCisJCWlmICgtLXRsLT5hY3RpdmVfY291bnQpCisJCQlhY3RpdmVfY291bnQg
Kz0gISFyY3VfYWNjZXNzX3BvaW50ZXIodGwtPmxhc3RfcmVxdWVzdC5mZW5jZSk7CisJCWVsc2UK
IAkJCWxpc3RfZGVsKCZ0bC0+bGluayk7CiAKIAkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwpA
QCAtMTU0Nyw3ICsxNTY3LDcgQEAgYm9vbCBpOTE1X3JldGlyZV9yZXF1ZXN0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodGwsIHRuLCAm
ZnJlZSwgbGluaykKIAkJX19pbnRlbF90aW1lbGluZV9mcmVlKCZ0bC0+a3JlZik7CiAKLQlyZXR1
cm4gIWxpc3RfZW1wdHkoJnRpbWVsaW5lcy0+YWN0aXZlX2xpc3QpOworCXJldHVybiBhY3RpdmVf
Y291bnQgPyB0aW1lb3V0IDogMDsKIH0KIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1
X1NFTEZURVNUKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCA2MjFmYjMzY2Rh
MzAuLjI1NmIwNzE1MTgwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTMx
MCw3ICszMTAsNiBAQCBsb25nIGk5MTVfcmVxdWVzdF93YWl0KHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxLAogI2RlZmluZSBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRQlCSVQoMCkKICNkZWZpbmUgSTkx
NV9XQUlUX1BSSU9SSVRZCUJJVCgxKSAvKiBzbWFsbCBwcmlvcml0eSBidW1wIGZvciB0aGUgcmVx
dWVzdCAqLwogI2RlZmluZSBJOTE1X1dBSVRfQUxMCQlCSVQoMikgLyogdXNlZCBieSBpOTE1X2dl
bV9vYmplY3Rfd2FpdCgpICovCi0jZGVmaW5lIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCBCSVQo
MykKIAogc3RhdGljIGlubGluZSBib29sIGk5MTVfcmVxdWVzdF9zaWduYWxlZChjb25zdCBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKQEAgLTQ2MCw2ICs0NTksMTAgQEAgaTkxNV9yZXF1ZXN0
X2FjdGl2ZV90aW1lbGluZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJCQkJIGxvY2tkZXBf
aXNfaGVsZCgmcnEtPmVuZ2luZS0+YWN0aXZlLmxvY2spKTsKIH0KIAotYm9vbCBpOTE1X3JldGly
ZV9yZXF1ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Citsb25nIGk5MTVfcmV0
aXJlX3JlcXVlc3RzX3RpbWVvdXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGxvbmcg
dGltZW91dCk7CitzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9yZXRpcmVfcmVxdWVzdHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJaTkxNV9yZXRpcmVfcmVxdWVzdHNfdGltZW91
dChpOTE1LCAwKTsKK30KIAogI2VuZGlmIC8qIEk5MTVfUkVRVUVTVF9IICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCmluZGV4IDJhNWZiZTQ2
ZWE5Zi4uZWQ0OTZiZDZkODRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaWd0X2ZsdXNoX3Rlc3QuYwpAQCAtMTgsOCArMTgsNyBAQCBpbnQgaWd0X2ZsdXNoX3Rlc3Qo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAljb25kX3Jlc2NoZWQoKTsKIAotCWk5
MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwotCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5
MTUsIDAsIEhaIC8gNSkgPT0gLUVUSU1FKSB7CisJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUo
aTkxNSwgSFogLyA1KSA9PSAtRVRJTUUpIHsKIAkJcHJfZXJyKCIlcFMgdGltZWQgb3V0LCBjYW5j
ZWxsaW5nIGFsbCBmdXJ0aGVyIHRlc3RpbmcuXG4iLAogCQkgICAgICAgX19idWlsdGluX3JldHVy
bl9hZGRyZXNzKDApKTsKIApAQCAtMzAsNyArMjksNiBAQCBpbnQgaWd0X2ZsdXNoX3Rlc3Qoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUt
Pmd0KTsKIAkJcmV0ID0gLUVJTzsKIAl9Ci0JaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAK
IAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9saXZlX3Rlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rf
bGl2ZV90ZXN0LmMKaW5kZXggMDRhNmY4OGZkZjY0Li5lYWU5MGY5N2RmNmMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYwpAQCAtMjMsOSArMjMs
NyBAQCBpbnQgaWd0X2xpdmVfdGVzdF9iZWdpbihzdHJ1Y3QgaWd0X2xpdmVfdGVzdCAqdCwKIAl0
LT5mdW5jID0gZnVuYzsKIAl0LT5uYW1lID0gbmFtZTsKIAotCWVyciA9IGk5MTVfZ2VtX3dhaXRf
Zm9yX2lkbGUoaTkxNSwKLQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAotCQkJCSAg
ICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOworCWVyciA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUo
aTkxNSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCIlcygl
cyk6IGZhaWxlZCB0byBpZGxlIGJlZm9yZSwgd2l0aCBlcnI9JWQhIiwKIAkJICAgICAgIGZ1bmMs
IG5hbWUsIGVycik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
bW9ja19nZW1fZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19n
ZW1fZGV2aWNlLmMKaW5kZXggOTFmNjI1MzkzOWFkLi44N2QzNDE2N2JmODkgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTQ0LDcg
KzQ0LDcgQEAgdm9pZCBtb2NrX2RldmljZV9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIAlkbyB7CiAJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQkJbW9j
a19lbmdpbmVfZmx1c2goZW5naW5lKTsKLQl9IHdoaWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhp
OTE1KSk7CisJfSB3aGlsZSAoaTkxNV9yZXRpcmVfcmVxdWVzdHNfdGltZW91dChpOTE1LCBNQVhf
U0NIRURVTEVfVElNRU9VVCkpOwogfQogCiBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9yZWxlYXNl
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

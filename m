Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C72EDFD7F8
	for <lists+intel-gfx@lfdr.de>; Fri, 15 Nov 2019 09:31:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B739E6E14C;
	Fri, 15 Nov 2019 08:31:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 481986E14C
 for <intel-gfx@lists.freedesktop.org>; Fri, 15 Nov 2019 08:31:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19207955-1500050 
 for multiple; Fri, 15 Nov 2019 08:31:05 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 15 Nov 2019 08:31:03 +0000
Message-Id: <20191115083103.699756-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191115081857.683827-1-chris@chris-wilson.co.uk>
References: <20191115081857.683827-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gt: Track engine round-trip times
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S25vd2luZyB0aGUgcm91bmQgdHJpcCB0aW1lIG9mIGFuIGVuZ2luZSBpcyB1c2VmdWwgZm9yIHRy
YWNraW5nIHRoZQpoZWFsdGggb2YgdGhlIHN5c3RlbSBhcyB3ZWxsIGFzIHByb3ZpZGluZyBhIG1l
dHJpYyBmb3IgdGhlIGJhc2VsaW5lCnJlc3BvbnNpdmVuZXNzIG9mIHRoZSBlbmdpbmUuIFdlIGNh
biB1c2UgdGhlIGxhdHRlciBtZXRyaWMgZm9yCmF1dG9tYXRpY2FsbHkgdHVuaW5nIG91ciB3YWl0
cyBpbiBzZWxmdGVzdHMgYW5kIHdoZW4gaWRsaW5nIHNvIHdlIGRvbid0CmNvbmZ1c2UgYSBzbG93
ZXIgc3lzdGVtIHdpdGggYSBkZWFkIG9uZS4KClVwb24gaWRsaW5nIHRoZSBlbmdpbmUsIHdlIHNl
bmQgb25lIGxhc3QgcHVsc2UgdG8gc3dpdGNoIHRoZSBjb250ZXh0CmF3YXkgZnJvbSBwcmVjaW91
cyB1c2VyIHN0YXRlIHRvIHRoZSB2b2xhdGlsZSBrZXJuZWwgY29udGV4dC4gV2Uga25vdwp0aGUg
ZW5naW5lIGlzIGlkbGUgYXQgdGhpcyBwb2ludCwgYW5kIHRoZSBwdWxzZSBpcyBub24tcHJlZW1w
dGFibGUsIHNvCnRoaXMgcHJvdmlkZXMgdXMgd2l0aCBhIGdvb2QgbWVhc3VyZW1lbnQgb2YgdGhl
IHJvdW5kIHRyaXAgdGltZS4gQQpzZWNvbmRhcnkgZWZmZWN0IGlzIHRoYXQgYnkgaW5zdGFsbGlu
ZyBhbiBpbnRlcnJ1cHQgb250byB0aGUgcHVsc2UsIHdlCmNhbiBmbHVzaCB0aGUgZW5naW5lIGlt
bWVkaWF0ZWx5IHVwb24gY29tcGxldGlvbiwgY3VydGFpbGluZyB0aGUKYmFja2dyb3VuZCBmbHVz
aCBhbmQgZW50ZXJpbmcgcG93ZXJzYXZpbmcgaW1tZWRpYXRlbHkuCgpSZWZlcmVuY2VzOiA3ZTM0
ZjRlNGFhZDMgKCJkcm0vaTkxNS9nZW44KzogQWRkIFJDNiBDVFggY29ycnVwdGlvbiBXQSIpClNp
Z25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzog
VHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IFN0dWFydCBTdW1t
ZXJzIDxzdHVhcnQuc3VtbWVyc0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMgICAgfCAgMiArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3BtLmMgICAgfCAzNCArKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggfCAgNiArKysrCiAzIGZpbGVzIGNo
YW5nZWQsIDQxIGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IGI5NjEzZDA0NDM5My4uMmQxMWRiMTNkYzg5
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtMzM0LDYg
KzMzNCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfZW5naW5lX3NldHVwKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsIGVudW0gaW50ZWxfZW5naW5lX2lkIGlkKQogCS8qIE5vdGhpbmcgdG8gZG8gaGVyZSwgZXhl
Y3V0ZSBpbiBvcmRlciBvZiBkZXBlbmRlbmNpZXMgKi8KIAllbmdpbmUtPnNjaGVkdWxlID0gTlVM
TDsKIAorCWV3bWFfZGVsYXlfaW5pdCgmZW5naW5lLT5kZWxheSk7CiAJc2VxbG9ja19pbml0KCZl
bmdpbmUtPnN0YXRzLmxvY2spOwogCiAJQVRPTUlDX0lOSVRfTk9USUZJRVJfSEVBRCgmZW5naW5l
LT5jb250ZXh0X3N0YXR1c19ub3RpZmllcik7CkBAIC0xNDc3LDYgKzE0NzgsNyBAQCB2b2lkIGlu
dGVsX2VuZ2luZV9kdW1wKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJZHJtX3By
aW50ZihtLCAiKioqIFdFREdFRCAqKipcbiIpOwogCiAJZHJtX3ByaW50ZihtLCAiXHRBd2FrZT8g
JWRcbiIsIGF0b21pY19yZWFkKCZlbmdpbmUtPndha2VyZWYuY291bnQpKTsKKwlkcm1fcHJpbnRm
KG0sICJcdERlbGF5OiAlbHV1c1xuIiwgZXdtYV9kZWxheV9yZWFkKCZlbmdpbmUtPmRlbGF5KSk7
CiAKIAlyY3VfcmVhZF9sb2NrKCk7CiAJcnEgPSBSRUFEX09OQ0UoZW5naW5lLT5oZWFydGJlYXQu
c3lzdG9sZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4
IDNjMGY0OTBmZjJjNy4uMTE3NWY5YTYzODgyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfcG0uYwpAQCAtNzMsNiArNzMsMjMgQEAgc3RhdGljIGlubGluZSB2b2lkIF9f
dGltZWxpbmVfbWFya191bmxvY2soc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAjZW5kaWYg
LyogIUlTX0VOQUJMRUQoQ09ORklHX0xPQ0tERVApICovCiAKK3N0cnVjdCBkdXJhdGlvbl9jYiB7
CisJc3RydWN0IGRtYV9mZW5jZV9jYiBjYjsKKwlrdGltZV90IGVtaXR0ZWQ7Cit9OworCitzdGF0
aWMgdm9pZCBkdXJhdGlvbl9jYihzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9m
ZW5jZV9jYiAqY2IpCit7CisJc3RydWN0IGR1cmF0aW9uX2NiICpkY2IgPSBjb250YWluZXJfb2Yo
Y2IsIHR5cGVvZigqZGNiKSwgY2IpOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9
IHRvX3JlcXVlc3QoZmVuY2UpLT5lbmdpbmU7CisKKwlld21hX2RlbGF5X2FkZCgmZW5naW5lLT5k
ZWxheSwKKwkJICAgICAgIGt0aW1lX3VzX2RlbHRhKGt0aW1lX2dldCgpLCBkY2ItPmVtaXR0ZWQp
KTsKKworCS8qIEtpY2sgcmV0aXJlIGZvciBxdWlja2VyIHBvd2Vyc2F2aW5nIChzb2Z0LXJjNiku
ICovCisJbW9kX2RlbGF5ZWRfd29yayhzeXN0ZW1fd3EsICZlbmdpbmUtPmd0LT5yZXF1ZXN0cy5y
ZXRpcmVfd29yaywgMCk7Cit9CisKIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4
dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnE7CkBAIC0xMTQsNyArMTMxLDIyIEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxf
Y29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAkvKiBJbnN0YWxsIG91
cnNlbHZlcyBhcyBhIHByZWVtcHRpb24gYmFycmllciAqLwogCXJxLT5zY2hlZC5hdHRyLnByaW9y
aXR5ID0gSTkxNV9QUklPUklUWV9CQVJSSUVSOwotCV9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7
CisJaWYgKGxpa2VseSghX19pOTE1X3JlcXVlc3RfY29tbWl0KHJxKSkpIHsgLyogZW5naW5lIHNo
b3VsZCBiZSBpZGxlISAqLworCQlzdHJ1Y3QgZHVyYXRpb25fY2IgKmRjYjsKKworCQlCVUlMRF9C
VUdfT04oc2l6ZW9mKCpkY2IpID4gc2l6ZW9mKHJxLT5zdWJtaXRxKSk7CisJCWRjYiA9IChzdHJ1
Y3QgZHVyYXRpb25fY2IgKikmcnEtPnN1Ym1pdHE7CisKKwkJLyoKKwkJICogVXNlIGFuIGludGVy
cnVwdCBmb3IgcHJlY2lzZSBtZWFzdXJlbWVudCBvZiBkdXJhdGlvbiwKKwkJICogb3RoZXJ3aXNl
IHdlIHJlbHkgb24gc29tZW9uZSBlbHNlIHJldGlyaW5nIGFsbCB0aGUgcmVxdWVzdHMKKwkJICog
d2hpY2ggbWF5IGRlbGF5IHRoZSBzaWduYWxpbmcgKGkuZS4gd2Ugd2lsbCBsaWtlbHkgd2FpdAor
CQkgKiB1bnRpbCB0aGUgYmFja2dyb3VuZCByZXF1ZXN0IHJldGlyZW1lbnQgcnVubmluZyBldmVy
eQorCQkgKiBzZWNvbmQgb3IgdHdvKS4KKwkJICovCisJCWRtYV9mZW5jZV9hZGRfY2FsbGJhY2so
JnJxLT5mZW5jZSwgJmRjYi0+Y2IsIGR1cmF0aW9uX2NiKTsKKwkJZGNiLT5lbWl0dGVkID0ga3Rp
bWVfZ2V0KCk7CisJfQogCiAJLyogUmVsZWFzZSBvdXIgZXhjbHVzaXZlIGhvbGQgb24gdGhlIGVu
Z2luZSAqLwogCV9faW50ZWxfd2FrZXJlZl9kZWZlcl9wYXJrKCZlbmdpbmUtPndha2VyZWYpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRleCA3NThm
MGU4ZWM2NzIuLmM2YTYwN2Q5Y2Y2YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX3R5cGVzLmgKQEAgLTcsNiArNyw3IEBACiAjaWZuZGVmIF9fSU5URUxfRU5HSU5F
X1RZUEVTX18KICNkZWZpbmUgX19JTlRFTF9FTkdJTkVfVFlQRVNfXwogCisjaW5jbHVkZSA8bGlu
dXgvYXZlcmFnZS5oPgogI2luY2x1ZGUgPGxpbnV4L2hhc2h0YWJsZS5oPgogI2luY2x1ZGUgPGxp
bnV4L2lycV93b3JrLmg+CiAjaW5jbHVkZSA8bGludXgva3JlZi5oPgpAQCAtMTE5LDYgKzEyMCw5
IEBAIGVudW0gaW50ZWxfZW5naW5lX2lkIHsKICNkZWZpbmUgSU5WQUxJRF9FTkdJTkUgKChlbnVt
IGludGVsX2VuZ2luZV9pZCktMSkKIH07CiAKKy8qIEEgc2ltcGxlIGVzdGltYXRvciBmb3IgdGhl
IHJvdW5kLXRyaXAgcmVzcG9uc2l2ZSB0aW1lIG9mIGFuIGVuZ2luZSAqLworREVDTEFSRV9FV01B
KGRlbGF5LCA2LCA0KQorCiBzdHJ1Y3Qgc3RfcHJlZW1wdF9oYW5nIHsKIAlzdHJ1Y3QgY29tcGxl
dGlvbiBjb21wbGV0aW9uOwogCXVuc2lnbmVkIGludCBjb3VudDsKQEAgLTMxNiw2ICszMjAsOCBA
QCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAkJc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1l
bGluZTsKIAl9IGxlZ2FjeTsKIAorCXN0cnVjdCBld21hX2RlbGF5IGRlbGF5OworCiAJLyogUmF0
aGVyIHRoYW4gaGF2ZSBldmVyeSBjbGllbnQgd2FpdCB1cG9uIGFsbCB1c2VyIGludGVycnVwdHMs
CiAJICogd2l0aCB0aGUgaGVyZCB3YWtpbmcgYWZ0ZXIgZXZlcnkgaW50ZXJydXB0IGFuZCBlYWNo
IGRvaW5nIHRoZQogCSAqIGhlYXZ5d2VpZ2h0IHNlcW5vIGRhbmNlLCB3ZSBkZWxlZ2F0ZSB0aGUg
dGFzayAob2YgYmVpbmcgdGhlCi0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeA==

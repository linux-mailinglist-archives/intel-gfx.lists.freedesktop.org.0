Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 99CB010AE93
	for <lists+intel-gfx@lfdr.de>; Wed, 27 Nov 2019 12:18:01 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A02E96E50D;
	Wed, 27 Nov 2019 11:17:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 37C616E50D
 for <intel-gfx@lists.freedesktop.org>; Wed, 27 Nov 2019 11:17:58 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19356573-1500050 
 for multiple; Wed, 27 Nov 2019 11:17:48 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 27 Nov 2019 11:17:42 +0000
Message-Id: <20191127111742.3271036-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Copy across scheduler behaviour flags
 across submit fences
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugd2FudCB0aGUgYm9uZGVkIHJlcXVlc3QgdG8gaGF2ZSB0aGUgc2FtZSBzY2hlZHVsZXIgcHJv
cGVydGllcyBhcyBpdHMKbWFzdGVyIHNvIHRoYXQgaXQgaXMgcGxhY2VkIGF0IHRoZSBzYW1lIGRl
cHRoIGluIHRoZSBxdWV1ZS4gRm9yIGV4YW1wbGUsCmNvbnNpZGVyIHdlIGhhdmUgcmVxdWVzdHMg
QSwgQiBhbmQgQicsIHdoZXJlIEIgJiBCJyBhcmUgYSBib25kZWQgcGFpciB0bwpydW4gaW4gcGFy
YWxsZWwgb24gdHdvIGVuZ2luZXMuCgoJQSAtPiBCCiAgICAgCSAgICAgXC0gQicKCkIgd2lsbCBy
dW4gYWZ0ZXIgQSBhbmQgc28gbWF5IGJlIHNjaGVkdWxlZCBvbiBhbiBpZGxlIGVuZ2luZSBhbmQg
d2FpdCBvbgpBIHVzaW5nIGEgc2VtYXBob3JlLiBCJyBzZWVzIEIgYmVpbmcgZXhlY3V0ZWQgYW5k
IHNvIGVudGVycyB0aGUgcXVldWUgb24KdGhlIHNhbWUgZW5naW5lIGFzIEEuIEFzIEInIGRpZCBu
b3QgaW5oZXJpdCB0aGUgc2VtYXBob3JlLWNoYWluIGZyb20gQiwKaXQgbWF5IGhhdmUgaGlnaGVy
IHByZWNlZGVuY2UgdGhhbiBBIGFuZCBzbyBwcmVlbXB0cyBleGVjdXRpb24uIEhvd2V2ZXIsCkIn
IHRoZW4gc2l0cyBvbiBhIHNlbWFwaG9yZSB3YWl0aW5nIGZvciBCLCB3aG8gaXMgd2FpdGluZyBm
b3IgQSwgd2hvIGlzCmJsb2NrZWQgYnkgQi4KCkVyZ28gQicgbmVlZHMgdG8gaW5oZXJpdCB0aGUg
c2NoZWR1bGVyIHByb3BlcnRpZXMgZnJvbSBCIChpLmUuIHRoZQpzZW1hcGhvcmUgY2hhaW4pIHNv
IHRoYXQgaXQgaXMgc2NoZWR1bGVkIHdpdGggdGhlIHNhbWUgcHJpb3JpdHkgYXMgQiBhbmQKd2ls
bCBub3QgYmUgZXhlY3V0ZWQgYWhlYWQgb2YgQnMgZGVwZW5kZW5jaWVzLgoKRnVydGhlcm1vcmUs
IHRvIHByZXZlbnQgdGhlIHByaW9yaXRpZXMgY2hhbmdpbmcgdmlhIHRoZSBleHBvc2UgZmVuY2Ug
b24KQicsIHdlIG5lZWQgdG8gY291cGxlIGluIHRoZSBkZXBlbmRlbmNpZXMgZm9yIFBJLiBUaGlz
IHJlcXVpcmVzIHVzIHRvCnJlbGF4IG91ciBzYW5pdHktY2hlY2tzIHRoYXQgZGVwZW5kZW5jaWVz
IGFyZSBzdHJpY3RseSBpbiBvcmRlci4KCkZpeGVzOiBlZTExMzY5MDhlOWIgKCJkcm0vaTkxNS9l
eGVjbGlzdHM6IFZpcnR1YWwgZW5naW5lIGJvbmRpbmciKQpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBX
aWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0
a28udXJzdWxpbkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmMgICB8IDQ2ICsrKysrKysrKysrKysrKysrKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9zY2hlZHVsZXIuYyB8ICAxIC0KIDIgZmlsZXMgY2hhbmdlZCwgMzggaW5zZXJ0
aW9ucygrKSwgOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmlu
ZGV4IGE1NThmNjQxODZmYS4uOTNiZWE2OTg3ZTU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYwpAQCAtMzAwLDExICszMDAsMTEgQEAgdm9pZCBpOTE1X3JlcXVlc3RfcmV0aXJlX3Vw
dG8oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB9CiAKIHN0YXRpYyBpbnQKLV9faTkxNV9yZXF1
ZXN0X2F3YWl0X2V4ZWN1dGlvbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCSAgICAgICBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpzaWduYWwsCi0JCQkgICAgICAgdm9pZCAoKmhvb2spKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJCQkgICAgc3RydWN0IGRtYV9mZW5jZSAqc2lnbmFsKSwK
LQkJCSAgICAgICBnZnBfdCBnZnApCitfX2F3YWl0X2V4ZWN1dGlvbihzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSwKKwkJICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpzaWduYWwsCisJCSAgdm9pZCAoKmhv
b2spKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJICAgICAgIHN0cnVjdCBkbWFfZmVuY2Ug
KnNpZ25hbCksCisJCSAgZ2ZwX3QgZ2ZwKQogewogCXN0cnVjdCBleGVjdXRlX2NiICpjYjsKIApA
QCAtMzQxLDYgKzM0MSw4IEBAIF9faTkxNV9yZXF1ZXN0X2F3YWl0X2V4ZWN1dGlvbihzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSwKIAl9CiAJc3Bpbl91bmxvY2tfaXJxKCZzaWduYWwtPmxvY2spOwog
CisJLyogQ29weSBhY3Jvc3Mgc2VtYXBob3JlIHN0YXR1cyBhcyB3ZSBuZWVkIHRoZSBzYW1lIGJl
aGF2aW91ciAqLworCXJxLT5zY2hlZC5mbGFncyB8PSBzaWduYWwtPnNjaGVkLmZsYWdzOwogCXJl
dHVybiAwOwogfQogCkBAIC04NDMsNyArODQ1LDcgQEAgZW1pdF9zZW1hcGhvcmVfd2FpdChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICp0bywKIAkJZ290byBhd2FpdF9mZW5jZTsKIAogCS8qIE9ubHkgc3Vi
bWl0IG91ciBzcGlubmVyIGFmdGVyIHRoZSBzaWduYWxlciBpcyBydW5uaW5nISAqLwotCWlmIChf
X2k5MTVfcmVxdWVzdF9hd2FpdF9leGVjdXRpb24odG8sIGZyb20sIE5VTEwsIGdmcCkpCisJaWYg
KF9fYXdhaXRfZXhlY3V0aW9uKHRvLCBmcm9tLCBOVUxMLCBnZnApKQogCQlnb3RvIGF3YWl0X2Zl
bmNlOwogCiAJLyogV2UgbmVlZCB0byBwaW4gdGhlIHNpZ25hbGVyJ3MgSFdTUCB1bnRpbCB3ZSBh
cmUgZmluaXNoZWQgcmVhZGluZy4gKi8KQEAgLTk5Myw2ICs5OTUsMzUgQEAgaTkxNV9yZXF1ZXN0
X2F3YWl0X2RtYV9mZW5jZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UpCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQKK19faTkxNV9yZXF1ZXN0X2F3
YWl0X2V4ZWN1dGlvbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJCSAgICAgICBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpzaWduYWwsCisJCQkgICAgICAgdm9pZCAoKmhvb2spKHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxLAorCQkJCQkgICAgc3RydWN0IGRtYV9mZW5jZSAqc2lnbmFsKSkKK3sKKwlp
bnQgZXJyOworCisJZXJyID0gX19hd2FpdF9leGVjdXRpb24ocnEsIHNpZ25hbCwgaG9vaywgSTkx
NV9GRU5DRV9HRlApOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlpZiAoIXJxLT5lbmdp
bmUtPnNjaGVkdWxlKQorCQlyZXR1cm4gMDsKKworCS8qIFNxdWFzaCByZXBlYXRlZCBkZXBlbmVu
ZGljZXMgdG8gdGhlIHNhbWUgdGltZWxpbmVzICovCisJaWYgKHNpZ25hbC0+ZmVuY2UuY29udGV4
dCAmJgorCSAgICBpbnRlbF90aW1lbGluZV9zeW5jX2lzX2xhdGVyKGk5MTVfcmVxdWVzdF90aW1l
bGluZShycSksCisJCQkJCSAmc2lnbmFsLT5mZW5jZSkpCisJCXJldHVybiAwOworCisJLyogQ291
cGxlIHRoZSBkZXBlbmRlbmN5IHRyZWUgZm9yIFBJIG9uIHRoaXMgZXhwb3NlZCBycS0+ZmVuY2Ug
Ki8KKwllcnIgPSBpOTE1X3NjaGVkX25vZGVfYWRkX2RlcGVuZGVuY3koJnJxLT5zY2hlZCwgJnNp
Z25hbC0+c2NoZWQpOworCWlmIChlcnIgPCAwKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIDA7
Cit9CisKIGludAogaTkxNV9yZXF1ZXN0X2F3YWl0X2V4ZWN1dGlvbihzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSwKIAkJCSAgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsCkBAIC0xMDI2LDggKzEw
NTcsNyBAQCBpOTE1X3JlcXVlc3RfYXdhaXRfZXhlY3V0aW9uKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxLAogCQlpZiAoZG1hX2ZlbmNlX2lzX2k5MTUoZmVuY2UpKQogCQkJcmV0ID0gX19pOTE1X3Jl
cXVlc3RfYXdhaXRfZXhlY3V0aW9uKHJxLAogCQkJCQkJCSAgICAgdG9fcmVxdWVzdChmZW5jZSks
Ci0JCQkJCQkJICAgICBob29rLAotCQkJCQkJCSAgICAgSTkxNV9GRU5DRV9HRlApOworCQkJCQkJ
CSAgICAgaG9vayk7CiAJCWVsc2UKIAkJCXJldCA9IGk5MTVfc3dfZmVuY2VfYXdhaXRfZG1hX2Zl
bmNlKCZycS0+c3VibWl0LCBmZW5jZSwKIAkJCQkJCQkgICAgSTkxNV9GRU5DRV9USU1FT1VULApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMKaW5kZXggMTkzN2EyNmQ0MTJmLi4yYmMy
YWE0NmExYjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVy
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYwpAQCAtNDg0LDcg
KzQ4NCw2IEBAIHZvaWQgaTkxNV9zY2hlZF9ub2RlX2Zpbmkoc3RydWN0IGk5MTVfc2NoZWRfbm9k
ZSAqbm9kZSkKIAkgKiBzbyB3ZSBtYXkgYmUgY2FsbGVkIG91dC1vZi1vcmRlci4KIAkgKi8KIAls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoZGVwLCB0bXAsICZub2RlLT5zaWduYWxlcnNfbGlzdCwg
c2lnbmFsX2xpbmspIHsKLQkJR0VNX0JVR19PTighbm9kZV9zaWduYWxlZChkZXAtPnNpZ25hbGVy
KSk7CiAJCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJmRlcC0+ZGZzX2xpbmspKTsKIAogCQlsaXN0
X2RlbCgmZGVwLT53YWl0X2xpbmspOwotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0E9F122D85
	for <lists+intel-gfx@lfdr.de>; Mon, 20 May 2019 10:02:12 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E618489203;
	Mon, 20 May 2019 08:02:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 45AF1891F4
 for <intel-gfx@lists.freedesktop.org>; Mon, 20 May 2019 08:02:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16610871-1500050 
 for multiple; Mon, 20 May 2019 09:01:34 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 20 May 2019 09:01:11 +0100
Message-Id: <20190520080127.18255-17-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190520080127.18255-1-chris@chris-wilson.co.uk>
References: <20190520080127.18255-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 17/33] drm/i915: Move GEM domain management to
 its own file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29udGludWluZyB0aGUgZGVjbHV0dGVyaW5nIG9mIGk5MTVfZ2VtLmMsIHRoYXQgb2YgdGhlIHJl
YWQvd3JpdGUKZG9tYWlucywgcGVyaGFwcyB0aGUgYmlnZ2VzdCBvZiBHRU0ncyBmb2xsaWVzPwoK
U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJl
dmlld2VkLWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyAgICB8IDc4MiArKysrKysrKysr
KysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCAgICB8
ICAyOSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jICAgICAgICAgfCAg
IDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyAgICAgICAgICB8ICAg
NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9jbWRfcGFyc2VyLmMgICAgICAgIHwgICA4
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgMjYg
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgNzc3ICst
LS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9leGVjYnVmZmVy
LmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3JlbmRlcl9zdGF0
ZS5jICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2h1Z2VfcGFnZXMu
YyAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5j
ICAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQu
YyB8ICAgOCArLQogMTMgZmlsZXMgY2hhbmdlZCwgODM5IGluc2VydGlvbnMoKyksIDgyMiBkZWxl
dGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZG9tYWluLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmls
ZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGQwNTc1N2M1MjQ5Mi4uMjlm
YzkyNGJhODE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtODcsNiArODcsNyBAQCBpOTE1LXkg
Kz0gJChndC15KQogIyBHRU0gKEdyYXBoaWNzIEV4ZWN1dGlvbiBNYW5hZ2VtZW50KSBjb2RlCiBv
YmoteSArPSBnZW0vCiBnZW0teSArPSBcCisJZ2VtL2k5MTVfZ2VtX2RvbWFpbi5vIFwKIAlnZW0v
aTkxNV9nZW1fb2JqZWN0Lm8gXAogCWdlbS9pOTE1X2dlbV9tbWFuLm8gXAogCWdlbS9pOTE1X2dl
bV9wYWdlcy5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmJiYzdmYjc1ODE4NgotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4u
YwpAQCAtMCwwICsxLDc4MiBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQK
KyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxNC0yMDE2IEludGVsIENvcnBvcmF0aW9uCisgKi8KKwor
I2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fY2xmbHVzaC5oIgorI2lu
Y2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX2lvY3Rscy5oIgorI2lu
Y2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgorI2luY2x1ZGUgImk5MTVfdm1hLmgiCisjaW5jbHVk
ZSAiaW50ZWxfZnJvbnRidWZmZXIuaCIKKworc3RhdGljIHZvaWQgX19pOTE1X2dlbV9vYmplY3Rf
Zmx1c2hfZm9yX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwkv
KgorCSAqIFdlIG1hbnVhbGx5IGZsdXNoIHRoZSBDUFUgZG9tYWluIHNvIHRoYXQgd2UgY2FuIG92
ZXJyaWRlIGFuZAorCSAqIGZvcmNlIHRoZSBmbHVzaCBmb3IgdGhlIGRpc3BsYXksIGFuZCBwZXJm
b3JtIGl0IGFzeW5jcmhvbm91c2x5LgorCSAqLworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0
ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7CisJaWYgKG9iai0+Y2FjaGVfZGly
dHkpCisJCWk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0KG9iaiwgSTkxNV9DTEZMVVNIX0ZPUkNFKTsK
KwlvYmotPndyaXRlX2RvbWFpbiA9IDA7Cit9CisKK3ZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X2lmX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlpZiAoIVJF
QURfT05DRShvYmotPnBpbl9nbG9iYWwpKQorCQlyZXR1cm47CisKKwltdXRleF9sb2NrKCZvYmot
PmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCV9faTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2Zvcl9k
aXNwbGF5KG9iaik7CisJbXV0ZXhfdW5sb2NrKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgp
OworfQorCisvKioKKyAqIE1vdmVzIGEgc2luZ2xlIG9iamVjdCB0byB0aGUgV0MgcmVhZCwgYW5k
IHBvc3NpYmx5IHdyaXRlIGRvbWFpbi4KKyAqIEBvYmo6IG9iamVjdCB0byBhY3Qgb24KKyAqIEB3
cml0ZTogYXNrIGZvciB3cml0ZSBhY2Nlc3Mgb3IgcmVhZCBvbmx5CisgKgorICogVGhpcyBmdW5j
dGlvbiByZXR1cm5zIHdoZW4gdGhlIG1vdmUgaXMgY29tcGxldGUsIGluY2x1ZGluZyB3YWl0aW5n
IG9uCisgKiBmbHVzaGVzIHRvIG9jY3VyLgorICovCitpbnQKK2k5MTVfZ2VtX29iamVjdF9zZXRf
dG9fd2NfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGJvb2wgd3JpdGUp
Cit7CisJaW50IHJldDsKKworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0
cnVjdF9tdXRleCk7CisKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAg
STkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAorCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQgfAorCQkJ
CSAgICh3cml0ZSA/IEk5MTVfV0FJVF9BTEwgOiAwKSwKKwkJCQkgICBNQVhfU0NIRURVTEVfVElN
RU9VVCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmIChvYmotPndyaXRlX2RvbWFp
biA9PSBJOTE1X0dFTV9ET01BSU5fV0MpCisJCXJldHVybiAwOworCisJLyogRmx1c2ggYW5kIGFj
cXVpcmUgb2JqLT5wYWdlcyBzbyB0aGF0IHdlIGFyZSBjb2hlcmVudCB0aHJvdWdoCisJICogZGly
ZWN0IGFjY2VzcyBpbiBtZW1vcnkgd2l0aCBwcmV2aW91cyBjYWNoZWQgd3JpdGVzIHRocm91Z2gK
KwkgKiBzaG1lbWZzIGFuZCB0aGF0IG91ciBjYWNoZSBkb21haW4gdHJhY2tpbmcgcmVtYWlucyB2
YWxpZC4KKwkgKiBGb3IgZXhhbXBsZSwgaWYgdGhlIG9iai0+ZmlscCB3YXMgbW92ZWQgdG8gc3dh
cCB3aXRob3V0IHVzCisJICogYmVpbmcgbm90aWZpZWQgYW5kIHJlbGVhc2luZyB0aGUgcGFnZXMs
IHdlIHdvdWxkIG1pc3Rha2VubHkKKwkgKiBjb250aW51ZSB0byBhc3N1bWUgdGhhdCB0aGUgb2Jq
IHJlbWFpbmVkIG91dCBvZiB0aGUgQ1BVIGNhY2hlZAorCSAqIGRvbWFpbi4KKwkgKi8KKwlyZXQg
PSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1f
RE9NQUlOX1dDKTsKKworCS8qIFNlcmlhbGlzZSBkaXJlY3QgYWNjZXNzIHRvIHRoaXMgb2JqZWN0
IHdpdGggdGhlIGJhcnJpZXJzIGZvcgorCSAqIGNvaGVyZW50IHdyaXRlcyBmcm9tIHRoZSBHUFUs
IGJ5IGVmZmVjdGl2ZWx5IGludmFsaWRhdGluZyB0aGUKKwkgKiBXQyBkb21haW4gdXBvbiBmaXJz
dCBhY2Nlc3MuCisJICovCisJaWYgKChvYmotPnJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJ
Tl9XQykgPT0gMCkKKwkJbWIoKTsKKworCS8qIEl0IHNob3VsZCBub3cgYmUgb3V0IG9mIGFueSBv
dGhlciB3cml0ZSBkb21haW5zLCBhbmQgd2UgY2FuIHVwZGF0ZQorCSAqIHRoZSBkb21haW4gdmFs
dWVzIGZvciBvdXIgY2hhbmdlcy4KKwkgKi8KKwlHRU1fQlVHX09OKChvYmotPndyaXRlX2RvbWFp
biAmIH5JOTE1X0dFTV9ET01BSU5fV0MpICE9IDApOworCW9iai0+cmVhZF9kb21haW5zIHw9IEk5
MTVfR0VNX0RPTUFJTl9XQzsKKwlpZiAod3JpdGUpIHsKKwkJb2JqLT5yZWFkX2RvbWFpbnMgPSBJ
OTE1X0dFTV9ET01BSU5fV0M7CisJCW9iai0+d3JpdGVfZG9tYWluID0gSTkxNV9HRU1fRE9NQUlO
X1dDOworCQlvYmotPm1tLmRpcnR5ID0gdHJ1ZTsKKwl9CisKKwlpOTE1X2dlbV9vYmplY3RfdW5w
aW5fcGFnZXMob2JqKTsKKwlyZXR1cm4gMDsKK30KKworLyoqCisgKiBNb3ZlcyBhIHNpbmdsZSBv
YmplY3QgdG8gdGhlIEdUVCByZWFkLCBhbmQgcG9zc2libHkgd3JpdGUgZG9tYWluLgorICogQG9i
ajogb2JqZWN0IHRvIGFjdCBvbgorICogQHdyaXRlOiBhc2sgZm9yIHdyaXRlIGFjY2VzcyBvciBy
ZWFkIG9ubHkKKyAqCisgKiBUaGlzIGZ1bmN0aW9uIHJldHVybnMgd2hlbiB0aGUgbW92ZSBpcyBj
b21wbGV0ZSwgaW5jbHVkaW5nIHdhaXRpbmcgb24KKyAqIGZsdXNoZXMgdG8gb2NjdXIuCisgKi8K
K2ludAoraTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosIGJvb2wgd3JpdGUpCit7CisJaW50IHJldDsKKworCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7CisKKwlyZXQgPSBpOTE1X2dl
bV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAorCQkJ
CSAgIEk5MTVfV0FJVF9MT0NLRUQgfAorCQkJCSAgICh3cml0ZSA/IEk5MTVfV0FJVF9BTEwgOiAw
KSwKKwkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJl
dDsKKworCWlmIChvYmotPndyaXRlX2RvbWFpbiA9PSBJOTE1X0dFTV9ET01BSU5fR1RUKQorCQly
ZXR1cm4gMDsKKworCS8qIEZsdXNoIGFuZCBhY3F1aXJlIG9iai0+cGFnZXMgc28gdGhhdCB3ZSBh
cmUgY29oZXJlbnQgdGhyb3VnaAorCSAqIGRpcmVjdCBhY2Nlc3MgaW4gbWVtb3J5IHdpdGggcHJl
dmlvdXMgY2FjaGVkIHdyaXRlcyB0aHJvdWdoCisJICogc2htZW1mcyBhbmQgdGhhdCBvdXIgY2Fj
aGUgZG9tYWluIHRyYWNraW5nIHJlbWFpbnMgdmFsaWQuCisJICogRm9yIGV4YW1wbGUsIGlmIHRo
ZSBvYmotPmZpbHAgd2FzIG1vdmVkIHRvIHN3YXAgd2l0aG91dCB1cworCSAqIGJlaW5nIG5vdGlm
aWVkIGFuZCByZWxlYXNpbmcgdGhlIHBhZ2VzLCB3ZSB3b3VsZCBtaXN0YWtlbmx5CisJICogY29u
dGludWUgdG8gYXNzdW1lIHRoYXQgdGhlIG9iaiByZW1haW5lZCBvdXQgb2YgdGhlIENQVSBjYWNo
ZWQKKwkgKiBkb21haW4uCisJICovCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhv
YmopOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpOTE1X2dlbV9vYmplY3RfZmx1c2hf
d3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9HVFQpOworCisJLyogU2VyaWFsaXNl
IGRpcmVjdCBhY2Nlc3MgdG8gdGhpcyBvYmplY3Qgd2l0aCB0aGUgYmFycmllcnMgZm9yCisJICog
Y29oZXJlbnQgd3JpdGVzIGZyb20gdGhlIEdQVSwgYnkgZWZmZWN0aXZlbHkgaW52YWxpZGF0aW5n
IHRoZQorCSAqIEdUVCBkb21haW4gdXBvbiBmaXJzdCBhY2Nlc3MuCisJICovCisJaWYgKChvYmot
PnJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJTl9HVFQpID09IDApCisJCW1iKCk7CisKKwkv
KiBJdCBzaG91bGQgbm93IGJlIG91dCBvZiBhbnkgb3RoZXIgd3JpdGUgZG9tYWlucywgYW5kIHdl
IGNhbiB1cGRhdGUKKwkgKiB0aGUgZG9tYWluIHZhbHVlcyBmb3Igb3VyIGNoYW5nZXMuCisJICov
CisJR0VNX0JVR19PTigob2JqLT53cml0ZV9kb21haW4gJiB+STkxNV9HRU1fRE9NQUlOX0dUVCkg
IT0gMCk7CisJb2JqLT5yZWFkX2RvbWFpbnMgfD0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKKwlpZiAo
d3JpdGUpIHsKKwkJb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fR1RUOworCQlv
YmotPndyaXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9HVFQ7CisJCW9iai0+bW0uZGlydHkg
PSB0cnVlOworCX0KKworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOworCXJldHVy
biAwOworfQorCisvKioKKyAqIENoYW5nZXMgdGhlIGNhY2hlLWxldmVsIG9mIGFuIG9iamVjdCBh
Y3Jvc3MgYWxsIFZNQS4KKyAqIEBvYmo6IG9iamVjdCB0byBhY3Qgb24KKyAqIEBjYWNoZV9sZXZl
bDogbmV3IGNhY2hlIGxldmVsIHRvIHNldCBmb3IgdGhlIG9iamVjdAorICoKKyAqIEFmdGVyIHRo
aXMgZnVuY3Rpb24gcmV0dXJucywgdGhlIG9iamVjdCB3aWxsIGJlIGluIHRoZSBuZXcgY2FjaGUt
bGV2ZWwKKyAqIGFjcm9zcyBhbGwgR1RUIGFuZCB0aGUgY29udGVudHMgb2YgdGhlIGJhY2tpbmcg
c3RvcmFnZSB3aWxsIGJlIGNvaGVyZW50LAorICogd2l0aCByZXNwZWN0IHRvIHRoZSBuZXcgY2Fj
aGUtbGV2ZWwuIEluIG9yZGVyIHRvIGtlZXAgdGhlIGJhY2tpbmcgc3RvcmFnZQorICogY29oZXJl
bnQgZm9yIGFsbCB1c2Vycywgd2Ugb25seSBhbGxvdyBhIHNpbmdsZSBjYWNoZSBsZXZlbCB0byBi
ZSBzZXQKKyAqIGdsb2JhbGx5IG9uIHRoZSBvYmplY3QgYW5kIHByZXZlbnQgaXQgZnJvbSBiZWlu
ZyBjaGFuZ2VkIHdoaWxzdCB0aGUKKyAqIGhhcmR3YXJlIGlzIHJlYWRpbmcgZnJvbSB0aGUgb2Jq
ZWN0LiBUaGF0IGlzIGlmIHRoZSBvYmplY3QgaXMgY3VycmVudGx5CisgKiBvbiB0aGUgc2Nhbm91
dCBpdCB3aWxsIGJlIHNldCB0byB1bmNhY2hlZCAob3IgZXF1aXZhbGVudCBkaXNwbGF5CisgKiBj
YWNoZSBjb2hlcmVuY3kpIGFuZCBhbGwgbm9uLU1PQ1MgR1BVIGFjY2VzcyB3aWxsIGFsc28gYmUg
dW5jYWNoZWQgc28KKyAqIHRoYXQgYWxsIGRpcmVjdCBhY2Nlc3MgdG8gdGhlIHNjYW5vdXQgcmVt
YWlucyBjb2hlcmVudC4KKyAqLworaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgICAgZW51bSBpOTE1X2NhY2hl
X2xldmVsIGNhY2hlX2xldmVsKQoreworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWludCByZXQ7
CisKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwor
CisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgPT0gY2FjaGVfbGV2ZWwpCisJCXJldHVybiAwOworCisJ
LyogSW5zcGVjdCB0aGUgbGlzdCBvZiBjdXJyZW50bHkgYm91bmQgVk1BIGFuZCB1bmJpbmQgYW55
IHRoYXQgd291bGQKKwkgKiBiZSBpbnZhbGlkIGdpdmVuIHRoZSBuZXcgY2FjaGUtbGV2ZWwuIFRo
aXMgaXMgcHJpbmNpcGFsbHkgdG8KKwkgKiBjYXRjaCB0aGUgaXNzdWUgb2YgdGhlIENTIHByZWZl
dGNoIGNyb3NzaW5nIHBhZ2UgYm91bmRhcmllcyBhbmQKKwkgKiByZWFkaW5nIGFuIGludmFsaWQg
UFRFIG9uIG9sZGVyIGFyY2hpdGVjdHVyZXMuCisJICovCityZXN0YXJ0OgorCWxpc3RfZm9yX2Vh
Y2hfZW50cnkodm1hLCAmb2JqLT52bWEubGlzdCwgb2JqX2xpbmspIHsKKwkJaWYgKCFkcm1fbW1f
bm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCisJCQljb250aW51ZTsKKworCQlpZiAoaTkxNV92
bWFfaXNfcGlubmVkKHZtYSkpIHsKKwkJCURSTV9ERUJVRygiY2FuIG5vdCBjaGFuZ2UgdGhlIGNh
Y2hlIGxldmVsIG9mIHBpbm5lZCBvYmplY3RzXG4iKTsKKwkJCXJldHVybiAtRUJVU1k7CisJCX0K
KworCQlpZiAoIWk5MTVfdm1hX2lzX2Nsb3NlZCh2bWEpICYmCisJCSAgICBpOTE1X2dlbV92YWxp
ZF9ndHRfc3BhY2Uodm1hLCBjYWNoZV9sZXZlbCkpCisJCQljb250aW51ZTsKKworCQlyZXQgPSBp
OTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJLyog
QXMgdW5iaW5kaW5nIG1heSBhZmZlY3Qgb3RoZXIgZWxlbWVudHMgaW4gdGhlCisJCSAqIG9iai0+
dm1hX2xpc3QgKGR1ZSB0byBzaWRlLWVmZmVjdHMgZnJvbSByZXRpcmluZworCQkgKiBhbiBhY3Rp
dmUgdm1hKSwgcGxheSBzYWZlIGFuZCByZXN0YXJ0IHRoZSBpdGVyYXRvci4KKwkJICovCisJCWdv
dG8gcmVzdGFydDsKKwl9CisKKwkvKiBXZSBjYW4gcmV1c2UgdGhlIGV4aXN0aW5nIGRybV9tbSBu
b2RlcyBidXQgbmVlZCB0byBjaGFuZ2UgdGhlCisJICogY2FjaGUtbGV2ZWwgb24gdGhlIFBURS4g
V2UgY291bGQgc2ltcGx5IHVuYmluZCB0aGVtIGFsbCBhbmQKKwkgKiByZWJpbmQgd2l0aCB0aGUg
Y29ycmVjdCBjYWNoZS1sZXZlbCBvbiBuZXh0IHVzZS4gSG93ZXZlciBzaW5jZQorCSAqIHdlIGFs
cmVhZHkgaGF2ZSBhIHZhbGlkIHNsb3QsIGRtYSBtYXBwaW5nLCBwYWdlcyBldGMsIHdlIG1heSBh
cworCSAqIHJld3JpdGUgdGhlIFBURSBpbiB0aGUgYmVsaWVmIHRoYXQgZG9pbmcgc28gdHJhbXBs
ZXMgdXBvbiBsZXNzCisJICogc3RhdGUgYW5kIHNvIGludm9sdmVzIGxlc3Mgd29yay4KKwkgKi8K
KwlpZiAob2JqLT5iaW5kX2NvdW50KSB7CisJCS8qIEJlZm9yZSB3ZSBjaGFuZ2UgdGhlIFBURSwg
dGhlIEdQVSBtdXN0IG5vdCBiZSBhY2Nlc3NpbmcgaXQuCisJCSAqIElmIHdlIHdhaXQgdXBvbiB0
aGUgb2JqZWN0LCB3ZSBrbm93IHRoYXQgYWxsIHRoZSBib3VuZAorCQkgKiBWTUEgYXJlIG5vIGxv
bmdlciBhY3RpdmUuCisJCSAqLworCQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJ
CQkJCSAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKKwkJCQkJICAgSTkxNV9XQUlUX0xPQ0tF
RCB8CisJCQkJCSAgIEk5MTVfV0FJVF9BTEwsCisJCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1FT1VU
KTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisKKwkJaWYgKCFIQVNfTExDKHRvX2k5MTUo
b2JqLT5iYXNlLmRldikpICYmCisJCSAgICBjYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUp
IHsKKwkJCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlzCisJ
CQkgKiBpbmNvaGVyZW50IGFuZCBvbiBzb21lIG1hY2hpbmVzIGNhdXNlcyBhIGhhcmQKKwkJCSAq
IGxvY2t1cC4gUmVsaW5xdWlzaCB0aGUgQ1BVIG1tYXBpbmcgdG8gZm9yY2UKKwkJCSAqIHVzZXJz
cGFjZSB0byByZWZhdWx0IGluIHRoZSBwYWdlcyBhbmQgd2UgY2FuCisJCQkgKiB0aGVuIGRvdWJs
ZSBjaGVjayBpZiB0aGUgR1RUIG1hcHBpbmcgaXMgc3RpbGwKKwkJCSAqIHZhbGlkIGZvciB0aGF0
IHBvaW50ZXIgYWNjZXNzLgorCQkJICovCisJCQlpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFw
KG9iaik7CisKKwkJCS8qIEFzIHdlIG5vIGxvbmdlciBuZWVkIGEgZmVuY2UgZm9yIEdUVCBhY2Nl
c3MsCisJCQkgKiB3ZSBjYW4gcmVsaW5xdWlzaCBpdCBub3cgKGFuZCBzbyBwcmV2ZW50IGhhdmlu
ZworCQkJICogdG8gc3RlYWwgYSBmZW5jZSBmcm9tIHNvbWVvbmUgZWxzZSBvbiB0aGUgbmV4dAor
CQkJICogZmVuY2UgcmVxdWVzdCkuIE5vdGUgR1BVIGFjdGl2aXR5IHdvdWxkIGhhdmUKKwkJCSAq
IGRyb3BwZWQgdGhlIGZlbmNlIGFzIGFsbCBzbm9vcGFibGUgYWNjZXNzIGlzCisJCQkgKiBzdXBw
b3NlZCB0byBiZSBsaW5lYXIuCisJCQkgKi8KKwkJCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2Jq
KSB7CisJCQkJcmV0ID0gaTkxNV92bWFfcHV0X2ZlbmNlKHZtYSk7CisJCQkJaWYgKHJldCkKKwkJ
CQkJcmV0dXJuIHJldDsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJCS8qIFdlIGVpdGhlciBoYXZlIGlu
Y29oZXJlbnQgYmFja2luZyBzdG9yZSBhbmQKKwkJCSAqIHNvIG5vIEdUVCBhY2Nlc3Mgb3IgdGhl
IGFyY2hpdGVjdHVyZSBpcyBmdWxseQorCQkJICogY29oZXJlbnQuIEluIHN1Y2ggY2FzZXMsIGV4
aXN0aW5nIEdUVCBtbWFwcworCQkJICogaWdub3JlIHRoZSBjYWNoZSBiaXQgaW4gdGhlIFBURSBh
bmQgd2UgY2FuCisJCQkgKiByZXdyaXRlIGl0IHdpdGhvdXQgY29uZnVzaW5nIHRoZSBHUFUgb3Ig
aGF2aW5nCisJCQkgKiB0byBmb3JjZSB1c2Vyc3BhY2UgdG8gZmF1bHQgYmFjayBpbiBpdHMgbW1h
cHMuCisJCQkgKi8KKwkJfQorCisJCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmb2JqLT52bWEu
bGlzdCwgb2JqX2xpbmspIHsKKwkJCWlmICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKQorCQkJCWNvbnRpbnVlOworCisJCQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgY2FjaGVf
bGV2ZWwsIFBJTl9VUERBVEUpOworCQkJaWYgKHJldCkKKwkJCQlyZXR1cm4gcmV0OworCQl9CisJ
fQorCisJbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykK
KwkJdm1hLT5ub2RlLmNvbG9yID0gY2FjaGVfbGV2ZWw7CisJaTkxNV9nZW1fb2JqZWN0X3NldF9j
YWNoZV9jb2hlcmVuY3kob2JqLCBjYWNoZV9sZXZlbCk7CisJb2JqLT5jYWNoZV9kaXJ0eSA9IHRy
dWU7IC8qIEFsd2F5cyBpbnZhbGlkYXRlIHN0YWxlIGNhY2hlbGluZXMgKi8KKworCXJldHVybiAw
OworfQorCitpbnQgaTkxNV9nZW1fZ2V0X2NhY2hpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdm9pZCAqZGF0YSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCit7CisJ
c3RydWN0IGRybV9pOTE1X2dlbV9jYWNoaW5nICphcmdzID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOworCWludCBlcnIgPSAwOworCisJcmN1X3JlYWRfbG9jaygpOwor
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXBfcmN1KGZpbGUsIGFyZ3MtPmhhbmRsZSk7CisJ
aWYgKCFvYmopIHsKKwkJZXJyID0gLUVOT0VOVDsKKwkJZ290byBvdXQ7CisJfQorCisJc3dpdGNo
IChvYmotPmNhY2hlX2xldmVsKSB7CisJY2FzZSBJOTE1X0NBQ0hFX0xMQzoKKwljYXNlIEk5MTVf
Q0FDSEVfTDNfTExDOgorCQlhcmdzLT5jYWNoaW5nID0gSTkxNV9DQUNISU5HX0NBQ0hFRDsKKwkJ
YnJlYWs7CisKKwljYXNlIEk5MTVfQ0FDSEVfV1Q6CisJCWFyZ3MtPmNhY2hpbmcgPSBJOTE1X0NB
Q0hJTkdfRElTUExBWTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQlhcmdzLT5jYWNoaW5nID0g
STkxNV9DQUNISU5HX05PTkU7CisJCWJyZWFrOworCX0KK291dDoKKwlyY3VfcmVhZF91bmxvY2so
KTsKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaTkxNV9nZW1fc2V0X2NhY2hpbmdfaW9jdGwoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKKwkJCSAgICAgICBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IGRybV9pOTE1X2dlbV9jYWNoaW5nICphcmdzID0gZGF0YTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCWVudW0gaTkxNV9jYWNoZV9sZXZlbCBsZXZlbDsK
KwlpbnQgcmV0ID0gMDsKKworCXN3aXRjaCAoYXJncy0+Y2FjaGluZykgeworCWNhc2UgSTkxNV9D
QUNISU5HX05PTkU6CisJCWxldmVsID0gSTkxNV9DQUNIRV9OT05FOworCQlicmVhazsKKwljYXNl
IEk5MTVfQ0FDSElOR19DQUNIRUQ6CisJCS8qCisJCSAqIER1ZSB0byBhIEhXIGlzc3VlIG9uIEJY
VCBBIHN0ZXBwaW5nLCBHUFUgc3RvcmVzIHZpYSBhCisJCSAqIHNub29wZWQgbWFwcGluZyBtYXkg
bGVhdmUgc3RhbGUgZGF0YSBpbiBhIGNvcnJlc3BvbmRpbmcgQ1BVCisJCSAqIGNhY2hlbGluZSwg
d2hlcmVhcyBub3JtYWxseSBzdWNoIGNhY2hlbGluZXMgd291bGQgZ2V0CisJCSAqIGludmFsaWRh
dGVkLgorCQkgKi8KKwkJaWYgKCFIQVNfTExDKGk5MTUpICYmICFIQVNfU05PT1AoaTkxNSkpCisJ
CQlyZXR1cm4gLUVOT0RFVjsKKworCQlsZXZlbCA9IEk5MTVfQ0FDSEVfTExDOworCQlicmVhazsK
KwljYXNlIEk5MTVfQ0FDSElOR19ESVNQTEFZOgorCQlsZXZlbCA9IEhBU19XVChpOTE1KSA/IEk5
MTVfQ0FDSEVfV1QgOiBJOTE1X0NBQ0hFX05PTkU7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJl
dHVybiAtRUlOVkFMOworCX0KKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXAoZmlsZSwg
YXJncy0+aGFuZGxlKTsKKwlpZiAoIW9iaikKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwkvKgorCSAq
IFRoZSBjYWNoaW5nIG1vZGUgb2YgcHJveHkgb2JqZWN0IGlzIGhhbmRsZWQgYnkgaXRzIGdlbmVy
YXRvciwgYW5kCisJICogbm90IGFsbG93ZWQgdG8gYmUgY2hhbmdlZCBieSB1c2Vyc3BhY2UuCisJ
ICovCisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19wcm94eShvYmopKSB7CisJCXJldCA9IC1FTlhJ
TzsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKG9iai0+Y2FjaGVfbGV2ZWwgPT0gbGV2ZWwpCisJ
CWdvdG8gb3V0OworCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLAorCQkJCSAgIEk5
MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAorCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKKwlp
ZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKGRldik7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBpOTE1X2dlbV9vYmpl
Y3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwgbGV2ZWwpOworCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1
Y3RfbXV0ZXgpOworCitvdXQ6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXJldHVybiBy
ZXQ7Cit9CisKKy8qCisgKiBQcmVwYXJlIGJ1ZmZlciBmb3IgZGlzcGxheSBwbGFuZSAoc2Nhbm91
dCwgY3Vyc29ycywgZXRjKS4gQ2FuIGJlIGNhbGxlZCBmcm9tCisgKiBhbiB1bmludGVycnVwdGli
bGUgcGhhc2UgKG1vZGVzZXR0aW5nKSBhbmQgYWxsb3dzIGFueSBmbHVzaGVzIHRvIGJlIHBpcGVs
aW5lZAorICogKGZvciBwYWdlZmxpcHMpLiBXZSBvbmx5IGZsdXNoIHRoZSBjYWNoZXMgd2hpbGUg
cHJlcGFyaW5nIHRoZSBidWZmZXIgZm9yCisgKiBkaXNwbGF5LCB0aGUgY2FsbGVycyBhcmUgcmVz
cG9uc2libGUgZm9yIGZyb250YnVmZmVyIGZsdXNoLgorICovCitzdHJ1Y3QgaTkxNV92bWEgKgor
aTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCisJCQkJICAgICB1MzIgYWxpZ25tZW50LAorCQkJCSAgICAgY29uc3Qgc3Ry
dWN0IGk5MTVfZ2d0dF92aWV3ICp2aWV3LAorCQkJCSAgICAgdW5zaWduZWQgaW50IGZsYWdzKQor
eworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWludCByZXQ7CisKKwlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCisJLyogTWFyayB0aGUgZ2xvYmFs
IHBpbiBlYXJseSBzbyB0aGF0IHdlIGFjY291bnQgZm9yIHRoZQorCSAqIGRpc3BsYXkgY29oZXJl
bmN5IHdoaWxzdCBzZXR0aW5nIHVwIHRoZSBjYWNoZSBkb21haW5zLgorCSAqLworCW9iai0+cGlu
X2dsb2JhbCsrOworCisJLyogVGhlIGRpc3BsYXkgZW5naW5lIGlzIG5vdCBjb2hlcmVudCB3aXRo
IHRoZSBMTEMgY2FjaGUgb24gZ2VuNi4gIEFzCisJICogYSByZXN1bHQsIHdlIG1ha2Ugc3VyZSB0
aGF0IHRoZSBwaW5uaW5nIHRoYXQgaXMgYWJvdXQgdG8gb2NjdXIgaXMKKwkgKiBkb25lIHdpdGgg
dW5jYWNoZWQgUFRFcy4gVGhpcyBpcyBsb3dlc3QgY29tbW9uIGRlbm9taW5hdG9yIGZvciBhbGwK
KwkgKiBjaGlwc2V0cy4KKwkgKgorCSAqIEhvd2V2ZXIgZm9yIGdlbjYrLCB3ZSBjb3VsZCBkbyBi
ZXR0ZXIgYnkgdXNpbmcgdGhlIEdGRFQgYml0IGluc3RlYWQKKwkgKiBvZiB1bmNhY2hpbmcsIHdo
aWNoIHdvdWxkIGFsbG93IHVzIHRvIGZsdXNoIGFsbCB0aGUgTExDLWNhY2hlZCBkYXRhCisJICog
d2l0aCB0aGF0IGJpdCBpbiB0aGUgUFRFIHRvIG1haW4gbWVtb3J5IHdpdGgganVzdCBvbmUgUElQ
RV9DT05UUk9MLgorCSAqLworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwo
b2JqLAorCQkJCQkgICAgICBIQVNfV1QodG9faTkxNShvYmotPmJhc2UuZGV2KSkgPworCQkJCQkg
ICAgICBJOTE1X0NBQ0hFX1dUIDogSTkxNV9DQUNIRV9OT05FKTsKKwlpZiAocmV0KSB7CisJCXZt
YSA9IEVSUl9QVFIocmV0KTsKKwkJZ290byBlcnJfdW5waW5fZ2xvYmFsOworCX0KKworCS8qIEFz
IHRoZSB1c2VyIG1heSBtYXAgdGhlIGJ1ZmZlciBvbmNlIHBpbm5lZCBpbiB0aGUgZGlzcGxheSBw
bGFuZQorCSAqIChlLmcuIGxpYmttcyBmb3IgdGhlIGJvb3R1cCBzcGxhc2gpLCB3ZSBoYXZlIHRv
IGVuc3VyZSB0aGF0IHdlCisJICogYWx3YXlzIHVzZSBtYXBfYW5kX2ZlbmNlYWJsZSBmb3IgYWxs
IHNjYW5vdXQgYnVmZmVycy4gSG93ZXZlciwKKwkgKiBpdCBtYXkgc2ltcGx5IGJlIHRvbyBiaWcg
dG8gZml0IGludG8gbWFwcGFibGUsIGluIHdoaWNoIGNhc2UKKwkgKiBwdXQgaXQgYW55d2F5IGFu
ZCBob3BlIHRoYXQgdXNlcnNwYWNlIGNhbiBjb3BlIChidXQgYWx3YXlzIGZpcnN0CisJICogdHJ5
IHRvIHByZXNlcnZlIHRoZSBleGlzdGluZyBBQkkpLgorCSAqLworCXZtYSA9IEVSUl9QVFIoLUVO
T1NQQyk7CisJaWYgKChmbGFncyAmIFBJTl9NQVBQQUJMRSkgPT0gMCAmJgorCSAgICAoIXZpZXcg
fHwgdmlldy0+dHlwZSA9PSBJOTE1X0dHVFRfVklFV19OT1JNQUwpKQorCQl2bWEgPSBpOTE1X2dl
bV9vYmplY3RfZ2d0dF9waW4ob2JqLCB2aWV3LCAwLCBhbGlnbm1lbnQsCisJCQkJCSAgICAgICBm
bGFncyB8CisJCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfAorCQkJCQkgICAgICAgUElOX05PTkJM
T0NLKTsKKwlpZiAoSVNfRVJSKHZtYSkpCisJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bp
bihvYmosIHZpZXcsIDAsIGFsaWdubWVudCwgZmxhZ3MpOworCWlmIChJU19FUlIodm1hKSkKKwkJ
Z290byBlcnJfdW5waW5fZ2xvYmFsOworCisJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IG1heF90
KHU2NCwgdm1hLT5kaXNwbGF5X2FsaWdubWVudCwgYWxpZ25tZW50KTsKKworCV9faTkxNV9nZW1f
b2JqZWN0X2ZsdXNoX2Zvcl9kaXNwbGF5KG9iaik7CisKKwkvKiBJdCBzaG91bGQgbm93IGJlIG91
dCBvZiBhbnkgb3RoZXIgd3JpdGUgZG9tYWlucywgYW5kIHdlIGNhbiB1cGRhdGUKKwkgKiB0aGUg
ZG9tYWluIHZhbHVlcyBmb3Igb3VyIGNoYW5nZXMuCisJICovCisJb2JqLT5yZWFkX2RvbWFpbnMg
fD0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKKworCXJldHVybiB2bWE7CisKK2Vycl91bnBpbl9nbG9i
YWw6CisJb2JqLT5waW5fZ2xvYmFsLS07CisJcmV0dXJuIHZtYTsKK30KKworc3RhdGljIHZvaWQg
aTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShv
YmotPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0OworCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOworCisJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFnZXMo
b2JqKSk7CisKKwltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKKwlmb3JfZWFjaF9n
Z3R0X3ZtYSh2bWEsIG9iaikgeworCQlpZiAoIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5u
b2RlKSkKKwkJCWNvbnRpbnVlOworCisJCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2
bWEtPnZtLT5ib3VuZF9saXN0KTsKKwl9CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11
dGV4KTsKKworCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCWxpc3QgPSBvYmotPmJp
bmRfY291bnQgPyAmaTkxNS0+bW0uYm91bmRfbGlzdCA6ICZpOTE1LT5tbS51bmJvdW5kX2xpc3Q7
CisJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgbGlzdCk7CisJc3Bpbl91bmxvY2soJmk5
MTUtPm1tLm9ial9sb2NrKTsKK30KKwordm9pZAoraTkxNV9nZW1fb2JqZWN0X3VucGluX2Zyb21f
ZGlzcGxheV9wbGFuZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKworCWlmIChXQVJOX09OKHZt
YS0+b2JqLT5waW5fZ2xvYmFsID09IDApKQorCQlyZXR1cm47CisKKwlpZiAoLS12bWEtPm9iai0+
cGluX2dsb2JhbCA9PSAwKQorCQl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gSTkxNV9HVFRfTUlO
X0FMSUdOTUVOVDsKKworCS8qIEJ1bXAgdGhlIExSVSB0byB0cnkgYW5kIGF2b2lkIHByZW1hdHVy
ZSBldmljdGlvbiB3aGlsc3QgZmxpcHBpbmcgICovCisJaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5h
Y3RpdmVfZ2d0dCh2bWEtPm9iaik7CisKKwlpOTE1X3ZtYV91bnBpbih2bWEpOworfQorCisvKioK
KyAqIE1vdmVzIGEgc2luZ2xlIG9iamVjdCB0byB0aGUgQ1BVIHJlYWQsIGFuZCBwb3NzaWJseSB3
cml0ZSBkb21haW4uCisgKiBAb2JqOiBvYmplY3QgdG8gYWN0IG9uCisgKiBAd3JpdGU6IHJlcXVl
c3Rpbmcgd3JpdGUgb3IgcmVhZC1vbmx5IGFjY2VzcworICoKKyAqIFRoaXMgZnVuY3Rpb24gcmV0
dXJucyB3aGVuIHRoZSBtb3ZlIGlzIGNvbXBsZXRlLCBpbmNsdWRpbmcgd2FpdGluZyBvbgorICog
Zmx1c2hlcyB0byBvY2N1ci4KKyAqLworaW50CitpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9k
b21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSkKK3sKKwlp
bnQgcmV0OworCisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211
dGV4KTsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKKwkJCQkgICBJOTE1X1dB
SVRfSU5URVJSVVBUSUJMRSB8CisJCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8CisJCQkJICAgKHdy
aXRlID8gSTkxNV9XQUlUX0FMTCA6IDApLAorCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsK
KwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRl
X2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKKworCS8qIEZsdXNoIHRoZSBDUFUg
Y2FjaGUgaWYgaXQncyBzdGlsbCBpbnZhbGlkLiAqLworCWlmICgob2JqLT5yZWFkX2RvbWFpbnMg
JiBJOTE1X0dFTV9ET01BSU5fQ1BVKSA9PSAwKSB7CisJCWk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0
KG9iaiwgSTkxNV9DTEZMVVNIX1NZTkMpOworCQlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dF
TV9ET01BSU5fQ1BVOworCX0KKworCS8qIEl0IHNob3VsZCBub3cgYmUgb3V0IG9mIGFueSBvdGhl
ciB3cml0ZSBkb21haW5zLCBhbmQgd2UgY2FuIHVwZGF0ZQorCSAqIHRoZSBkb21haW4gdmFsdWVz
IGZvciBvdXIgY2hhbmdlcy4KKwkgKi8KKwlHRU1fQlVHX09OKG9iai0+d3JpdGVfZG9tYWluICYg
fkk5MTVfR0VNX0RPTUFJTl9DUFUpOworCisJLyogSWYgd2UncmUgd3JpdGluZyB0aHJvdWdoIHRo
ZSBDUFUsIHRoZW4gdGhlIEdQVSByZWFkIGRvbWFpbnMgd2lsbAorCSAqIG5lZWQgdG8gYmUgaW52
YWxpZGF0ZWQgYXQgbmV4dCB1c2UuCisJICovCisJaWYgKHdyaXRlKQorCQlfX3N0YXJ0X2NwdV93
cml0ZShvYmopOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbmxpbmUgZW51bSBmYl9vcF9v
cmlnaW4KK2ZiX3dyaXRlX29yaWdpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1
bnNpZ25lZCBpbnQgZG9tYWluKQoreworCXJldHVybiAoZG9tYWluID09IEk5MTVfR0VNX0RPTUFJ
Tl9HVFQgPworCQlvYmotPmZyb250YnVmZmVyX2dndHRfb3JpZ2luIDogT1JJR0lOX0NQVSk7Cit9
CisKKy8qKgorICogQ2FsbGVkIHdoZW4gdXNlciBzcGFjZSBwcmVwYXJlcyB0byB1c2UgYW4gb2Jq
ZWN0IHdpdGggdGhlIENQVSwgZWl0aGVyCisgKiB0aHJvdWdoIHRoZSBtbWFwIGlvY3RsJ3MgbWFw
cGluZyBvciBhIEdUVCBtYXBwaW5nLgorICogQGRldjogZHJtIGRldmljZQorICogQGRhdGE6IGlv
Y3RsIGRhdGEgYmxvYgorICogQGZpbGU6IGRybSBmaWxlCisgKi8KK2ludAoraTkxNV9nZW1fc2V0
X2RvbWFpbl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAorCQkJICBz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9zZXRfZG9tYWlu
ICphcmdzID0gZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXUzMiBy
ZWFkX2RvbWFpbnMgPSBhcmdzLT5yZWFkX2RvbWFpbnM7CisJdTMyIHdyaXRlX2RvbWFpbiA9IGFy
Z3MtPndyaXRlX2RvbWFpbjsKKwlpbnQgZXJyOworCisJLyogT25seSBoYW5kbGUgc2V0dGluZyBk
b21haW5zIHRvIHR5cGVzIHVzZWQgYnkgdGhlIENQVS4gKi8KKwlpZiAoKHdyaXRlX2RvbWFpbiB8
IHJlYWRfZG9tYWlucykgJiBJOTE1X0dFTV9HUFVfRE9NQUlOUykKKwkJcmV0dXJuIC1FSU5WQUw7
CisKKwkvKgorCSAqIEhhdmluZyBzb21ldGhpbmcgaW4gdGhlIHdyaXRlIGRvbWFpbiBpbXBsaWVz
IGl0J3MgaW4gdGhlIHJlYWQKKwkgKiBkb21haW4sIGFuZCBvbmx5IHRoYXQgcmVhZCBkb21haW4u
ICBFbmZvcmNlIHRoYXQgaW4gdGhlIHJlcXVlc3QuCisJICovCisJaWYgKHdyaXRlX2RvbWFpbiAm
JiByZWFkX2RvbWFpbnMgIT0gd3JpdGVfZG9tYWluKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlm
ICghcmVhZF9kb21haW5zKQorCQlyZXR1cm4gMDsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9s
b29rdXAoZmlsZSwgYXJncy0+aGFuZGxlKTsKKwlpZiAoIW9iaikKKwkJcmV0dXJuIC1FTk9FTlQ7
CisKKwkvKgorCSAqIEFscmVhZHkgaW4gdGhlIGRlc2lyZWQgd3JpdGUgZG9tYWluPyBOb3RoaW5n
IGZvciB1cyB0byBkbyEKKwkgKgorCSAqIFdlIGFwcGx5IGEgbGl0dGxlIGJpdCBvZiBjdW5uaW5n
IGhlcmUgdG8gY2F0Y2ggYSBicm9hZGVyIHNldCBvZgorCSAqIG5vLW9wcy4gSWYgb2JqLT53cml0
ZV9kb21haW4gaXMgc2V0LCB3ZSBtdXN0IGJlIGluIHRoZSBzYW1lCisJICogb2JqLT5yZWFkX2Rv
bWFpbnMsIGFuZCBvbmx5IHRoYXQgZG9tYWluLiBUaGVyZWZvcmUsIGlmIHRoYXQKKwkgKiBvYmot
PndyaXRlX2RvbWFpbiBtYXRjaGVzIHRoZSByZXF1ZXN0IHJlYWRfZG9tYWlucywgd2UgYXJlCisJ
ICogYWxyZWFkeSBpbiB0aGUgc2FtZSByZWFkL3dyaXRlIGRvbWFpbiBhbmQgY2FuIHNraXAgdGhl
IG9wZXJhdGlvbiwKKwkgKiB3aXRob3V0IGhhdmluZyB0byBmdXJ0aGVyIGNoZWNrIHRoZSByZXF1
ZXN0ZWQgd3JpdGVfZG9tYWluLgorCSAqLworCWlmIChSRUFEX09OQ0Uob2JqLT53cml0ZV9kb21h
aW4pID09IHJlYWRfZG9tYWlucykgeworCQllcnIgPSAwOworCQlnb3RvIG91dDsKKwl9CisKKwkv
KgorCSAqIFRyeSB0byBmbHVzaCB0aGUgb2JqZWN0IG9mZiB0aGUgR1BVIHdpdGhvdXQgaG9sZGlu
ZyB0aGUgbG9jay4KKwkgKiBXZSB3aWxsIHJlcGVhdCB0aGUgZmx1c2ggaG9sZGluZyB0aGUgbG9j
ayBpbiB0aGUgbm9ybWFsIG1hbm5lcgorCSAqIHRvIGNhdGNoIGNhc2VzIHdoZXJlIHdlIGFyZSBn
YXp1bXBlZC4KKwkgKi8KKwllcnIgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAg
STkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAorCQkJCSAgIEk5MTVfV0FJVF9QUklPUklUWSB8CisJ
CQkJICAgKHdyaXRlX2RvbWFpbiA/IEk5MTVfV0FJVF9BTEwgOiAwKSwKKwkJCQkgICBNQVhfU0NI
RURVTEVfVElNRU9VVCk7CisJaWYgKGVycikKKwkJZ290byBvdXQ7CisKKwkvKgorCSAqIFByb3h5
IG9iamVjdHMgZG8gbm90IGNvbnRyb2wgYWNjZXNzIHRvIHRoZSBiYWNraW5nIHN0b3JhZ2UsIGVy
Z28KKwkgKiB0aGV5IGNhbm5vdCBiZSB1c2VkIGFzIGEgbWVhbnMgdG8gbWFuaXB1bGF0ZSB0aGUg
Y2FjaGUgZG9tYWluCisJICogdHJhY2tpbmcgZm9yIHRoYXQgYmFja2luZyBzdG9yYWdlLiBUaGUg
cHJveHkgb2JqZWN0IGlzIGFsd2F5cworCSAqIGNvbnNpZGVyZWQgdG8gYmUgb3V0c2lkZSBvZiBh
bnkgY2FjaGUgZG9tYWluLgorCSAqLworCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfcHJveHkob2Jq
KSkgeworCQllcnIgPSAtRU5YSU87CisJCWdvdG8gb3V0OworCX0KKworCS8qCisJICogRmx1c2gg
YW5kIGFjcXVpcmUgb2JqLT5wYWdlcyBzbyB0aGF0IHdlIGFyZSBjb2hlcmVudCB0aHJvdWdoCisJ
ICogZGlyZWN0IGFjY2VzcyBpbiBtZW1vcnkgd2l0aCBwcmV2aW91cyBjYWNoZWQgd3JpdGVzIHRo
cm91Z2gKKwkgKiBzaG1lbWZzIGFuZCB0aGF0IG91ciBjYWNoZSBkb21haW4gdHJhY2tpbmcgcmVt
YWlucyB2YWxpZC4KKwkgKiBGb3IgZXhhbXBsZSwgaWYgdGhlIG9iai0+ZmlscCB3YXMgbW92ZWQg
dG8gc3dhcCB3aXRob3V0IHVzCisJICogYmVpbmcgbm90aWZpZWQgYW5kIHJlbGVhc2luZyB0aGUg
cGFnZXMsIHdlIHdvdWxkIG1pc3Rha2VubHkKKwkgKiBjb250aW51ZSB0byBhc3N1bWUgdGhhdCB0
aGUgb2JqIHJlbWFpbmVkIG91dCBvZiB0aGUgQ1BVIGNhY2hlZAorCSAqIGRvbWFpbi4KKwkgKi8K
KwllcnIgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKGVycikKKwkJZ290
byBvdXQ7CisKKwllcnIgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOworCWlm
IChlcnIpCisJCWdvdG8gb3V0X3VucGluOworCisJaWYgKHJlYWRfZG9tYWlucyAmIEk5MTVfR0VN
X0RPTUFJTl9XQykKKwkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4ob2Jq
LCB3cml0ZV9kb21haW4pOworCWVsc2UgaWYgKHJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJ
Tl9HVFQpCisJCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHdy
aXRlX2RvbWFpbik7CisJZWxzZQorCQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9k
b21haW4ob2JqLCB3cml0ZV9kb21haW4pOworCisJLyogQW5kIGJ1bXAgdGhlIExSVSBmb3IgdGhp
cyBhY2Nlc3MgKi8KKwlpOTE1X2dlbV9vYmplY3RfYnVtcF9pbmFjdGl2ZV9nZ3R0KG9iaik7CisK
KwltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKworCWlmICh3cml0ZV9kb21haW4g
IT0gMCkKKwkJaW50ZWxfZmJfb2JqX2ludmFsaWRhdGUob2JqLAorCQkJCQlmYl93cml0ZV9vcmln
aW4ob2JqLCB3cml0ZV9kb21haW4pKTsKKworb3V0X3VucGluOgorCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyhvYmopOworb3V0OgorCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1
cm4gZXJyOworfQorCisvKgorICogUGlucyB0aGUgc3BlY2lmaWVkIG9iamVjdCdzIHBhZ2VzIGFu
ZCBzeW5jaHJvbml6ZXMgdGhlIG9iamVjdCB3aXRoCisgKiBHUFUgYWNjZXNzZXMuIFNldHMgbmVl
ZHNfY2xmbHVzaCB0byBub24temVybyBpZiB0aGUgY2FsbGVyIHNob3VsZAorICogZmx1c2ggdGhl
IG9iamVjdCBmcm9tIHRoZSBDUFUgY2FjaGUuCisgKi8KK2ludCBpOTE1X2dlbV9vYmplY3RfcHJl
cGFyZV9yZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkJIHVuc2lnbmVk
IGludCAqbmVlZHNfY2xmbHVzaCkKK3sKKwlpbnQgcmV0OworCisJbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKKworCSpuZWVkc19jbGZsdXNoID0gMDsK
KwlpZiAoIWk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSkKKwkJcmV0dXJuIC1F
Tk9ERVY7CisKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCisJCQkJICAgSTkxNV9X
QUlUX0lOVEVSUlVQVElCTEUgfAorCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQsCisJCQkJICAgTUFY
X1NDSEVEVUxFX1RJTUVPVVQpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBp
OTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsK
KworCWlmIChvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1Jf
UkVBRCB8fAorCSAgICAhc3RhdGljX2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKKwkJ
cmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19jcHVfZG9tYWluKG9iaiwgZmFsc2UpOworCQlp
ZiAocmV0KQorCQkJZ290byBlcnJfdW5waW47CisJCWVsc2UKKwkJCWdvdG8gb3V0OworCX0KKwor
CWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlO
X0NQVSk7CisKKwkvKiBJZiB3ZSdyZSBub3QgaW4gdGhlIGNwdSByZWFkIGRvbWFpbiwgc2V0IG91
cnNlbGYgaW50byB0aGUgZ3R0CisJICogcmVhZCBkb21haW4gYW5kIG1hbnVhbGx5IGZsdXNoIGNh
Y2hlbGluZXMgKGlmIHJlcXVpcmVkKS4gVGhpcworCSAqIG9wdGltaXplcyBmb3IgdGhlIGNhc2Ug
d2hlbiB0aGUgZ3B1IHdpbGwgZGlydHkgdGhlIGRhdGEKKwkgKiBhbnl3YXkgYWdhaW4gYmVmb3Jl
IHRoZSBuZXh0IHByZWFkIGhhcHBlbnMuCisJICovCisJaWYgKCFvYmotPmNhY2hlX2RpcnR5ICYm
CisJICAgICEob2JqLT5yZWFkX2RvbWFpbnMgJiBJOTE1X0dFTV9ET01BSU5fQ1BVKSkKKwkJKm5l
ZWRzX2NsZmx1c2ggPSBDTEZMVVNIX0JFRk9SRTsKKworb3V0OgorCS8qIHJldHVybiB3aXRoIHRo
ZSBwYWdlcyBwaW5uZWQgKi8KKwlyZXR1cm4gMDsKKworZXJyX3VucGluOgorCWk5MTVfZ2VtX29i
amVjdF91bnBpbl9wYWdlcyhvYmopOworCXJldHVybiByZXQ7Cit9CisKK2ludCBpOTE1X2dlbV9v
YmplY3RfcHJlcGFyZV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJ
CSAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKQoreworCWludCByZXQ7CisKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCisJKm5lZWRzX2Ns
Zmx1c2ggPSAwOworCWlmICghaTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFnZShvYmopKQor
CQlyZXR1cm4gLUVOT0RFVjsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKKwkJ
CQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8CisJCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8
CisJCQkJICAgSTkxNV9XQUlUX0FMTCwKKwkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFn
ZXMob2JqKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJaWYgKG9iai0+Y2FjaGVfY29o
ZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSB8fAorCSAgICAhc3RhdGlj
X2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKKwkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b19jcHVfZG9tYWluKG9iaiwgdHJ1ZSk7CisJCWlmIChyZXQpCisJCQlnb3RvIGVycl91
bnBpbjsKKwkJZWxzZQorCQkJZ290byBvdXQ7CisJfQorCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKKworCS8qIElmIHdlJ3Jl
IG5vdCBpbiB0aGUgY3B1IHdyaXRlIGRvbWFpbiwgc2V0IG91cnNlbGYgaW50byB0aGUKKwkgKiBn
dHQgd3JpdGUgZG9tYWluIGFuZCBtYW51YWxseSBmbHVzaCBjYWNoZWxpbmVzIChhcyByZXF1aXJl
ZCkuCisJICogVGhpcyBvcHRpbWl6ZXMgZm9yIHRoZSBjYXNlIHdoZW4gdGhlIGdwdSB3aWxsIHVz
ZSB0aGUgZGF0YQorCSAqIHJpZ2h0IGF3YXkgYW5kIHdlIHRoZXJlZm9yZSBoYXZlIHRvIGNsZmx1
c2ggYW55d2F5LgorCSAqLworCWlmICghb2JqLT5jYWNoZV9kaXJ0eSkgeworCQkqbmVlZHNfY2xm
bHVzaCB8PSBDTEZMVVNIX0FGVEVSOworCisJCS8qCisJCSAqIFNhbWUgdHJpY2sgYXBwbGllcyB0
byBpbnZhbGlkYXRlIHBhcnRpYWxseSB3cml0dGVuCisJCSAqIGNhY2hlbGluZXMgcmVhZCBiZWZv
cmUgd3JpdGluZy4KKwkJICovCisJCWlmICghKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1f
RE9NQUlOX0NQVSkpCisJCQkqbmVlZHNfY2xmbHVzaCB8PSBDTEZMVVNIX0JFRk9SRTsKKwl9CisK
K291dDoKKwlpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9DUFUpOworCW9iai0+
bW0uZGlydHkgPSB0cnVlOworCS8qIHJldHVybiB3aXRoIHRoZSBwYWdlcyBwaW5uZWQgKi8KKwly
ZXR1cm4gMDsKKworZXJyX3VucGluOgorCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
OworCXJldHVybiByZXQ7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0LmgKaW5kZXggOWJmODE1NWQyN2RlLi4yMDlmODk4ZDI5YWMgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTE1LDYgKzE1LDggQEAKIAogI2luY2x1
ZGUgImk5MTVfZ2VtX29iamVjdF90eXBlcy5oIgogCisjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0Lmgi
CisKIHZvaWQgaTkxNV9nZW1faW5pdF9fb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSk7CiAKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICppOTE1X2dlbV9vYmplY3RfYWxs
b2Modm9pZCk7CkBAIC0zNTMsNiArMzU1LDIwIEBAIHZvaWQKIGk5MTVfZ2VtX29iamVjdF9mbHVz
aF93cml0ZV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCQkgICB1
bnNpZ25lZCBpbnQgZmx1c2hfZG9tYWlucyk7CiAKK2ludCBpOTE1X2dlbV9vYmplY3RfcHJlcGFy
ZV9yZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkJIHVuc2lnbmVkIGlu
dCAqbmVlZHNfY2xmbHVzaCk7CitpbnQgaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgIHVuc2lnbmVkIGludCAqbmVlZHNf
Y2xmbHVzaCk7CisjZGVmaW5lIENMRkxVU0hfQkVGT1JFCUJJVCgwKQorI2RlZmluZSBDTEZMVVNI
X0FGVEVSCUJJVCgxKQorI2RlZmluZSBDTEZMVVNIX0ZMQUdTCShDTEZMVVNIX0JFRk9SRSB8IENM
RkxVU0hfQUZURVIpCisKK3N0YXRpYyBpbmxpbmUgdm9pZAoraTkxNV9nZW1fb2JqZWN0X2Zpbmlz
aF9hY2Nlc3Moc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlpOTE1X2dlbV9v
YmplY3RfdW5waW5fcGFnZXMob2JqKTsKK30KKwogc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICoKIGk5MTVfZ2VtX29iamVjdF9sYXN0X3dyaXRlX2VuZ2luZShzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewpAQCAtMzc0LDYgKzM5MCwxOSBAQCB2b2lkIGk5MTVf
Z2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCQkJCSB1bnNpZ25lZCBpbnQgY2FjaGVfbGV2ZWwpOwogdm9pZCBpOTE1X2dlbV9v
YmplY3RfZmx1c2hfaWZfZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKTsK
IAoraW50IF9fbXVzdF9jaGVjaworaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4oc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7CitpbnQgX19tdXN0X2No
ZWNrCitpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4oc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7CitpbnQgX19tdXN0X2NoZWNrCitpOTE1X2dlbV9v
YmplY3Rfc2V0X3RvX2NwdV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwg
Ym9vbCB3cml0ZSk7CitzdHJ1Y3QgaTkxNV92bWEgKiBfX211c3RfY2hlY2sKK2k5MTVfZ2VtX29i
amVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAorCQkJCSAgICAgdTMyIGFsaWdubWVudCwKKwkJCQkgICAgIGNvbnN0IHN0cnVjdCBpOTE1X2dn
dHRfdmlldyAqdmlldywKKwkJCQkgICAgIHVuc2lnbmVkIGludCBmbGFncyk7Cit2b2lkIGk5MTVf
Z2VtX29iamVjdF91bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGk5MTVfdm1hICp2bWEp
OworCiBzdGF0aWMgaW5saW5lIGJvb2wgY3B1X3dyaXRlX25lZWRzX2NsZmx1c2goc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlpZiAob2JqLT5jYWNoZV9kaXJ0eSkKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCmluZGV4IGZlNjYyODVmMDIzNi4uMWVlODgxODI1
ZTM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMKQEAgLTE3NjAsNyArMTc2
MCw3IEBAIHN0YXRpYyBpbnQgcGVyZm9ybV9iYl9zaGFkb3coc3RydWN0IHBhcnNlcl9leGVjX3N0
YXRlICpzKQogCQlnb3RvIGVycl9mcmVlX2JiOwogCX0KIAotCXJldCA9IGk5MTVfZ2VtX29ial9w
cmVwYXJlX3NobWVtX3dyaXRlKGJiLT5vYmosICZiYi0+Y2xmbHVzaCk7CisJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoYmItPm9iaiwgJmJiLT5jbGZsdXNoKTsKIAlpZiAocmV0
KQogCQlnb3RvIGVycl9mcmVlX29iajsKIApAQCAtMTgwOSw3ICsxODA5LDcgQEAgc3RhdGljIGlu
dCBwZXJmb3JtX2JiX3NoYWRvdyhzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpCiBlcnJfdW5t
YXA6CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChiYi0+b2JqKTsKIGVycl9maW5pc2hfc2ht
ZW1fYWNjZXNzOgotCWk5MTVfZ2VtX29ial9maW5pc2hfc2htZW1fYWNjZXNzKGJiLT5vYmopOwor
CWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKGJiLT5vYmopOwogZXJyX2ZyZWVfb2JqOgog
CWk5MTVfZ2VtX29iamVjdF9wdXQoYmItPm9iaik7CiBlcnJfZnJlZV9iYjoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9zY2hlZHVsZXIuYwppbmRleCBkOTdkOTM1NWJmMTUuLmYwNTA3NjU4YzE1NCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAtNDY1LDcgKzQ2NSw3IEBAIHN0YXRp
YyBpbnQgcHJlcGFyZV9zaGFkb3dfYmF0Y2hfYnVmZmVyKHN0cnVjdCBpbnRlbF92Z3B1X3dvcmts
b2FkICp3b3JrbG9hZCkKIAkJCQkJCWJiLT5vYmotPmJhc2Uuc2l6ZSk7CiAJCQkJYmItPmNsZmx1
c2ggJj0gfkNMRkxVU0hfQUZURVI7CiAJCQl9Ci0JCQlpOTE1X2dlbV9vYmpfZmluaXNoX3NobWVt
X2FjY2VzcyhiYi0+b2JqKTsKKwkJCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKGJiLT5v
YmopOwogCQkJYmItPmFjY2Vzc2luZyA9IGZhbHNlOwogCiAJCX0gZWxzZSB7CkBAIC00OTMsNyAr
NDkzLDcgQEAgc3RhdGljIGludCBwcmVwYXJlX3NoYWRvd19iYXRjaF9idWZmZXIoc3RydWN0IGlu
dGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogCQkJaWYgKHJldCkKIAkJCQlnb3RvIGVycjsK
IAotCQkJaTkxNV9nZW1fb2JqX2ZpbmlzaF9zaG1lbV9hY2Nlc3MoYmItPm9iaik7CisJCQlpOTE1
X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhiYi0+b2JqKTsKIAkJCWJiLT5hY2Nlc3NpbmcgPSBm
YWxzZTsKIAogCQkJcmV0ID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUoYmItPnZtYSwKQEAgLTU3
MSw3ICs1NzEsNyBAQCBzdGF0aWMgdm9pZCByZWxlYXNlX3NoYWRvd19iYXRjaF9idWZmZXIoc3Ry
dWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQogCWxpc3RfZm9yX2VhY2hfZW50cnlf
c2FmZShiYiwgcG9zLCAmd29ya2xvYWQtPnNoYWRvd19iYiwgbGlzdCkgewogCQlpZiAoYmItPm9i
aikgewogCQkJaWYgKGJiLT5hY2Nlc3NpbmcpCi0JCQkJaTkxNV9nZW1fb2JqX2ZpbmlzaF9zaG1l
bV9hY2Nlc3MoYmItPm9iaik7CisJCQkJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3MoYmIt
Pm9iaik7CiAKIAkJCWlmIChiYi0+dmEgJiYgIUlTX0VSUihiYi0+dmEpKQogCQkJCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9tYXAoYmItPm9iaik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2NtZF9wYXJzZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfY21kX3Bh
cnNlci5jCmluZGV4IGU5ZmFkY2I0ZDU5Mi4uYzg5M2JkNGViMmM4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2NtZF9wYXJzZXIuYwpAQCAtMTA1OCwxMSArMTA1OCwxMSBAQCBzdGF0aWMgdTMy
ICpjb3B5X2JhdGNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpkc3Rfb2JqLAogCXZvaWQg
KmRzdCwgKnNyYzsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2ht
ZW1fcmVhZChzcmNfb2JqLCAmc3JjX25lZWRzX2NsZmx1c2gpOworCXJldCA9IGk5MTVfZ2VtX29i
amVjdF9wcmVwYXJlX3JlYWQoc3JjX29iaiwgJnNyY19uZWVkc19jbGZsdXNoKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVf
c2htZW1fd3JpdGUoZHN0X29iaiwgJmRzdF9uZWVkc19jbGZsdXNoKTsKKwlyZXQgPSBpOTE1X2dl
bV9vYmplY3RfcHJlcGFyZV93cml0ZShkc3Rfb2JqLCAmZHN0X25lZWRzX2NsZmx1c2gpOwogCWlm
IChyZXQpIHsKIAkJZHN0ID0gRVJSX1BUUihyZXQpOwogCQlnb3RvIHVucGluX3NyYzsKQEAgLTEx
MjAsOSArMTEyMCw5IEBAIHN0YXRpYyB1MzIgKmNvcHlfYmF0Y2goc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKmRzdF9vYmosCiAJKm5lZWRzX2NsZmx1c2hfYWZ0ZXIgPSBkc3RfbmVlZHNfY2xm
bHVzaCAmIENMRkxVU0hfQUZURVI7CiAKIHVucGluX2RzdDoKLQlpOTE1X2dlbV9vYmpfZmluaXNo
X3NobWVtX2FjY2Vzcyhkc3Rfb2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2Vzcyhk
c3Rfb2JqKTsKIHVucGluX3NyYzoKLQlpOTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2Vzcyhz
cmNfb2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhzcmNfb2JqKTsKIAlyZXR1
cm4gZHN0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCBjNWIyZTM5YTg4YTQuLjkx
Njg5YTIzZDllNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0yODAzLDIwICsyODAzLDYg
QEAgc3RhdGljIGlubGluZSBpbnQgX19zZ19wYWdlX2NvdW50KGNvbnN0IHN0cnVjdCBzY2F0dGVy
bGlzdCAqc2cpCiAJcmV0dXJuIHNnLT5sZW5ndGggPj4gUEFHRV9TSElGVDsKIH0KIAotaW50IGk5
MTVfZ2VtX29ial9wcmVwYXJlX3NobWVtX3JlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKLQkJCQkgICAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKTsKLWludCBpOTE1X2dl
bV9vYmpfcHJlcGFyZV9zaG1lbV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAotCQkJCSAgICAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKTsKLSNkZWZpbmUgQ0xGTFVT
SF9CRUZPUkUJQklUKDApCi0jZGVmaW5lIENMRkxVU0hfQUZURVIJQklUKDEpCi0jZGVmaW5lIENM
RkxVU0hfRkxBR1MJKENMRkxVU0hfQkVGT1JFIHwgQ0xGTFVTSF9BRlRFUikKLQotc3RhdGljIGlu
bGluZSB2b2lkCi1pOTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2VzcyhzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqKQotewotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
OwotfQotCiBzdGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKIGk5MTVfbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7CkBAIC0yODc5LDE4ICsyODY1
LDYgQEAgaW50IGk5MTVfZ2VtX29iamVjdF93YWl0X3ByaW9yaXR5KHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCQkJICBjb25zdCBzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyICphdHRy
KTsKICNkZWZpbmUgSTkxNV9QUklPUklUWV9ESVNQTEFZIEk5MTVfVVNFUl9QUklPUklUWShJOTE1
X1BSSU9SSVRZX01BWCkKIAotaW50IF9fbXVzdF9jaGVjawotaTkxNV9nZW1fb2JqZWN0X3NldF90
b193Y19kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7
Ci1pbnQgX19tdXN0X2NoZWNrCi1pOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4oc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7Ci1pbnQgX19tdXN0X2No
ZWNrCi1pOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSk7Ci1zdHJ1Y3QgaTkxNV92bWEgKiBfX211c3RfY2hl
Y2sKLWk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAotCQkJCSAgICAgdTMyIGFsaWdubWVudCwKLQkJCQkgICAgIGNvbnN0
IHN0cnVjdCBpOTE1X2dndHRfdmlldyAqdmlldywKLQkJCQkgICAgIHVuc2lnbmVkIGludCBmbGFn
cyk7Ci12b2lkIGk5MTVfZ2VtX29iamVjdF91bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0
IGk5MTVfdm1hICp2bWEpOwogaW50IGk5MTVfZ2VtX29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CiB2b2lkIGk5MTVfZ2VtX3JlbGVhc2Uo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9maWxlICpmaWxlKTsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMKaW5kZXggNzhkOTk4NDFjZjc2Li5mYzljOTc3Njk5OWEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwpAQCAtNDM4LDEyMyArNDM4LDYgQEAgdm9pZCBpOTE1X2dlbV9mbHVz
aF9nZ3R0X3dyaXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQog
Ci0vKgotICogUGlucyB0aGUgc3BlY2lmaWVkIG9iamVjdCdzIHBhZ2VzIGFuZCBzeW5jaHJvbml6
ZXMgdGhlIG9iamVjdCB3aXRoCi0gKiBHUFUgYWNjZXNzZXMuIFNldHMgbmVlZHNfY2xmbHVzaCB0
byBub24temVybyBpZiB0aGUgY2FsbGVyIHNob3VsZAotICogZmx1c2ggdGhlIG9iamVjdCBmcm9t
IHRoZSBDUFUgY2FjaGUuCi0gKi8KLWludCBpOTE1X2dlbV9vYmpfcHJlcGFyZV9zaG1lbV9yZWFk
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJICAgIHVuc2lnbmVkIGludCAq
bmVlZHNfY2xmbHVzaCkKLXsKLQlpbnQgcmV0OwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2Jq
LT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQotCSpuZWVkc19jbGZsdXNoID0gMDsKLQlpZiAo
IWk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSkKLQkJcmV0dXJuIC1FTk9ERVY7
Ci0KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCi0JCQkJICAgSTkxNV9XQUlUX0lO
VEVSUlVQVElCTEUgfAotCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJICAgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBpOTE1X2dl
bV9vYmplY3RfcGluX3BhZ2VzKG9iaik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWlm
IChvYmotPmNhY2hlX2NvaGVyZW50ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfUkVBRCB8
fAotCSAgICAhc3RhdGljX2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKLQkJcmV0ID0g
aTkxNV9nZW1fb2JqZWN0X3NldF90b19jcHVfZG9tYWluKG9iaiwgZmFsc2UpOwotCQlpZiAocmV0
KQotCQkJZ290byBlcnJfdW5waW47Ci0JCWVsc2UKLQkJCWdvdG8gb3V0OwotCX0KLQotCWk5MTVf
Z2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7
Ci0KLQkvKiBJZiB3ZSdyZSBub3QgaW4gdGhlIGNwdSByZWFkIGRvbWFpbiwgc2V0IG91cnNlbGYg
aW50byB0aGUgZ3R0Ci0JICogcmVhZCBkb21haW4gYW5kIG1hbnVhbGx5IGZsdXNoIGNhY2hlbGlu
ZXMgKGlmIHJlcXVpcmVkKS4gVGhpcwotCSAqIG9wdGltaXplcyBmb3IgdGhlIGNhc2Ugd2hlbiB0
aGUgZ3B1IHdpbGwgZGlydHkgdGhlIGRhdGEKLQkgKiBhbnl3YXkgYWdhaW4gYmVmb3JlIHRoZSBu
ZXh0IHByZWFkIGhhcHBlbnMuCi0JICovCi0JaWYgKCFvYmotPmNhY2hlX2RpcnR5ICYmCi0JICAg
ICEob2JqLT5yZWFkX2RvbWFpbnMgJiBJOTE1X0dFTV9ET01BSU5fQ1BVKSkKLQkJKm5lZWRzX2Ns
Zmx1c2ggPSBDTEZMVVNIX0JFRk9SRTsKLQotb3V0OgotCS8qIHJldHVybiB3aXRoIHRoZSBwYWdl
cyBwaW5uZWQgKi8KLQlyZXR1cm4gMDsKLQotZXJyX3VucGluOgotCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyhvYmopOwotCXJldHVybiByZXQ7Ci19Ci0KLWludCBpOTE1X2dlbV9vYmpfcHJl
cGFyZV9zaG1lbV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCSAg
ICAgdW5zaWduZWQgaW50ICpuZWVkc19jbGZsdXNoKQotewotCWludCByZXQ7Ci0KLQlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCi0JKm5lZWRzX2Ns
Zmx1c2ggPSAwOwotCWlmICghaTkxNV9nZW1fb2JqZWN0X2hhc19zdHJ1Y3RfcGFnZShvYmopKQot
CQlyZXR1cm4gLUVOT0RFVjsKLQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKLQkJ
CQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8
Ci0JCQkJICAgSTkxNV9XQUlUX0FMTCwKLQkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFn
ZXMob2JqKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKG9iai0+Y2FjaGVfY29o
ZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSB8fAotCSAgICAhc3RhdGlj
X2NwdV9oYXMoWDg2X0ZFQVRVUkVfQ0xGTFVTSCkpIHsKLQkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b19jcHVfZG9tYWluKG9iaiwgdHJ1ZSk7Ci0JCWlmIChyZXQpCi0JCQlnb3RvIGVycl91
bnBpbjsKLQkJZWxzZQotCQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKLQotCS8qIElmIHdlJ3Jl
IG5vdCBpbiB0aGUgY3B1IHdyaXRlIGRvbWFpbiwgc2V0IG91cnNlbGYgaW50byB0aGUKLQkgKiBn
dHQgd3JpdGUgZG9tYWluIGFuZCBtYW51YWxseSBmbHVzaCBjYWNoZWxpbmVzIChhcyByZXF1aXJl
ZCkuCi0JICogVGhpcyBvcHRpbWl6ZXMgZm9yIHRoZSBjYXNlIHdoZW4gdGhlIGdwdSB3aWxsIHVz
ZSB0aGUgZGF0YQotCSAqIHJpZ2h0IGF3YXkgYW5kIHdlIHRoZXJlZm9yZSBoYXZlIHRvIGNsZmx1
c2ggYW55d2F5LgotCSAqLwotCWlmICghb2JqLT5jYWNoZV9kaXJ0eSkgewotCQkqbmVlZHNfY2xm
bHVzaCB8PSBDTEZMVVNIX0FGVEVSOwotCi0JCS8qCi0JCSAqIFNhbWUgdHJpY2sgYXBwbGllcyB0
byBpbnZhbGlkYXRlIHBhcnRpYWxseSB3cml0dGVuCi0JCSAqIGNhY2hlbGluZXMgcmVhZCBiZWZv
cmUgd3JpdGluZy4KLQkJICovCi0JCWlmICghKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1f
RE9NQUlOX0NQVSkpCi0JCQkqbmVlZHNfY2xmbHVzaCB8PSBDTEZMVVNIX0JFRk9SRTsKLQl9Ci0K
LW91dDoKLQlpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9DUFUpOwotCW9iai0+
bW0uZGlydHkgPSB0cnVlOwotCS8qIHJldHVybiB3aXRoIHRoZSBwYWdlcyBwaW5uZWQgKi8KLQly
ZXR1cm4gMDsKLQotZXJyX3VucGluOgotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
OwotCXJldHVybiByZXQ7Ci19Ci0KIHN0YXRpYyBpbnQKIHNobWVtX3ByZWFkKHN0cnVjdCBwYWdl
ICpwYWdlLCBpbnQgb2Zmc2V0LCBpbnQgbGVuLCBjaGFyIF9fdXNlciAqdXNlcl9kYXRhLAogCSAg
ICBib29sIG5lZWRzX2NsZmx1c2gpCkBAIC01ODgsNyArNDcxLDcgQEAgaTkxNV9nZW1fc2htZW1f
cHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2htZW1fcmVhZChvYmosICZu
ZWVkc19jbGZsdXNoKTsKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV9yZWFkKG9iaiwg
Jm5lZWRzX2NsZmx1c2gpOwogCW11dGV4X3VubG9jaygmb2JqLT5iYXNlLmRldi0+c3RydWN0X211
dGV4KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAtNjEwLDcgKzQ5Myw3IEBAIGk5MTVf
Z2VtX3NobWVtX3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCW9mZnNl
dCA9IDA7CiAJfQogCi0JaTkxNV9nZW1fb2JqX2ZpbmlzaF9zaG1lbV9hY2Nlc3Mob2JqKTsKKwlp
OTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhvYmopOwogCXJldHVybiByZXQ7CiB9CiAKQEAg
LTk4NSw3ICs4NjgsNyBAQCBpOTE1X2dlbV9zaG1lbV9wd3JpdGUoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gaTkxNV9n
ZW1fb2JqX3ByZXBhcmVfc2htZW1fd3JpdGUob2JqLCAmbmVlZHNfY2xmbHVzaCk7CisJcmV0ID0g
aTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUob2JqLCAmbmVlZHNfY2xmbHVzaCk7CiAJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwpAQCAtMTAxNyw3ICs5MDAsNyBAQCBpOTE1X2dlbV9zaG1lbV9wd3JpdGUoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl9CiAKIAlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLCBP
UklHSU5fQ1BVKTsKLQlpOTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2VzcyhvYmopOworCWk5
MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKG9iaik7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAt
MTEwNiwxNTAgKzk4OSw2IEBAIGk5MTVfZ2VtX3B3cml0ZV9pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lkIGk5MTVf
Z2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5i
YXNlLmRldik7Ci0Jc3RydWN0IGxpc3RfaGVhZCAqbGlzdDsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKLQotCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikp
OwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7Ci0JZm9yX2VhY2hfZ2d0dF92
bWEodm1hLCBvYmopIHsKLQkJaWYgKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkp
Ci0JCQljb250aW51ZTsKLQotCQlsaXN0X21vdmVfdGFpbCgmdm1hLT52bV9saW5rLCAmdm1hLT52
bS0+Ym91bmRfbGlzdCk7Ci0JfQotCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7
Ci0KLQlzcGluX2xvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKLQlsaXN0ID0gb2JqLT5iaW5kX2Nv
dW50ID8gJmk5MTUtPm1tLmJvdW5kX2xpc3QgOiAmaTkxNS0+bW0udW5ib3VuZF9saXN0OwotCWxp
c3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssIGxpc3QpOwotCXNwaW5fdW5sb2NrKCZpOTE1LT5t
bS5vYmpfbG9jayk7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgZW51bSBmYl9vcF9vcmlnaW4KLWZiX3dy
aXRlX29yaWdpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1bnNpZ25lZCBpbnQg
ZG9tYWluKQotewotCXJldHVybiAoZG9tYWluID09IEk5MTVfR0VNX0RPTUFJTl9HVFQgPwotCQlv
YmotPmZyb250YnVmZmVyX2dndHRfb3JpZ2luIDogT1JJR0lOX0NQVSk7Ci19Ci0KLS8qKgotICog
Q2FsbGVkIHdoZW4gdXNlciBzcGFjZSBwcmVwYXJlcyB0byB1c2UgYW4gb2JqZWN0IHdpdGggdGhl
IENQVSwgZWl0aGVyCi0gKiB0aHJvdWdoIHRoZSBtbWFwIGlvY3RsJ3MgbWFwcGluZyBvciBhIEdU
VCBtYXBwaW5nLgotICogQGRldjogZHJtIGRldmljZQotICogQGRhdGE6IGlvY3RsIGRhdGEgYmxv
YgotICogQGZpbGU6IGRybSBmaWxlCi0gKi8KLWludAotaTkxNV9nZW1fc2V0X2RvbWFpbl9pb2N0
bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAotCQkJICBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9zZXRfZG9tYWluICphcmdzID0gZGF0
YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXUzMiByZWFkX2RvbWFpbnMg
PSBhcmdzLT5yZWFkX2RvbWFpbnM7Ci0JdTMyIHdyaXRlX2RvbWFpbiA9IGFyZ3MtPndyaXRlX2Rv
bWFpbjsKLQlpbnQgZXJyOwotCi0JLyogT25seSBoYW5kbGUgc2V0dGluZyBkb21haW5zIHRvIHR5
cGVzIHVzZWQgYnkgdGhlIENQVS4gKi8KLQlpZiAoKHdyaXRlX2RvbWFpbiB8IHJlYWRfZG9tYWlu
cykgJiBJOTE1X0dFTV9HUFVfRE9NQUlOUykKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQkvKgotCSAq
IEhhdmluZyBzb21ldGhpbmcgaW4gdGhlIHdyaXRlIGRvbWFpbiBpbXBsaWVzIGl0J3MgaW4gdGhl
IHJlYWQKLQkgKiBkb21haW4sIGFuZCBvbmx5IHRoYXQgcmVhZCBkb21haW4uICBFbmZvcmNlIHRo
YXQgaW4gdGhlIHJlcXVlc3QuCi0JICovCi0JaWYgKHdyaXRlX2RvbWFpbiAmJiByZWFkX2RvbWFp
bnMgIT0gd3JpdGVfZG9tYWluKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWlmICghcmVhZF9kb21h
aW5zKQotCQlyZXR1cm4gMDsKLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXAoZmlsZSwg
YXJncy0+aGFuZGxlKTsKLQlpZiAoIW9iaikKLQkJcmV0dXJuIC1FTk9FTlQ7Ci0KLQkvKgotCSAq
IEFscmVhZHkgaW4gdGhlIGRlc2lyZWQgd3JpdGUgZG9tYWluPyBOb3RoaW5nIGZvciB1cyB0byBk
byEKLQkgKgotCSAqIFdlIGFwcGx5IGEgbGl0dGxlIGJpdCBvZiBjdW5uaW5nIGhlcmUgdG8gY2F0
Y2ggYSBicm9hZGVyIHNldCBvZgotCSAqIG5vLW9wcy4gSWYgb2JqLT53cml0ZV9kb21haW4gaXMg
c2V0LCB3ZSBtdXN0IGJlIGluIHRoZSBzYW1lCi0JICogb2JqLT5yZWFkX2RvbWFpbnMsIGFuZCBv
bmx5IHRoYXQgZG9tYWluLiBUaGVyZWZvcmUsIGlmIHRoYXQKLQkgKiBvYmotPndyaXRlX2RvbWFp
biBtYXRjaGVzIHRoZSByZXF1ZXN0IHJlYWRfZG9tYWlucywgd2UgYXJlCi0JICogYWxyZWFkeSBp
biB0aGUgc2FtZSByZWFkL3dyaXRlIGRvbWFpbiBhbmQgY2FuIHNraXAgdGhlIG9wZXJhdGlvbiwK
LQkgKiB3aXRob3V0IGhhdmluZyB0byBmdXJ0aGVyIGNoZWNrIHRoZSByZXF1ZXN0ZWQgd3JpdGVf
ZG9tYWluLgotCSAqLwotCWlmIChSRUFEX09OQ0Uob2JqLT53cml0ZV9kb21haW4pID09IHJlYWRf
ZG9tYWlucykgewotCQllcnIgPSAwOwotCQlnb3RvIG91dDsKLQl9Ci0KLQkvKgotCSAqIFRyeSB0
byBmbHVzaCB0aGUgb2JqZWN0IG9mZiB0aGUgR1BVIHdpdGhvdXQgaG9sZGluZyB0aGUgbG9jay4K
LQkgKiBXZSB3aWxsIHJlcGVhdCB0aGUgZmx1c2ggaG9sZGluZyB0aGUgbG9jayBpbiB0aGUgbm9y
bWFsIG1hbm5lcgotCSAqIHRvIGNhdGNoIGNhc2VzIHdoZXJlIHdlIGFyZSBnYXp1bXBlZC4KLQkg
Ki8KLQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCi0JCQkJICAgSTkxNV9XQUlUX0lO
VEVSUlVQVElCTEUgfAotCQkJCSAgIEk5MTVfV0FJVF9QUklPUklUWSB8Ci0JCQkJICAgKHdyaXRl
X2RvbWFpbiA/IEk5MTVfV0FJVF9BTEwgOiAwKSwKLQkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9V
VCk7Ci0JaWYgKGVycikKLQkJZ290byBvdXQ7Ci0KLQkvKgotCSAqIFByb3h5IG9iamVjdHMgZG8g
bm90IGNvbnRyb2wgYWNjZXNzIHRvIHRoZSBiYWNraW5nIHN0b3JhZ2UsIGVyZ28KLQkgKiB0aGV5
IGNhbm5vdCBiZSB1c2VkIGFzIGEgbWVhbnMgdG8gbWFuaXB1bGF0ZSB0aGUgY2FjaGUgZG9tYWlu
Ci0JICogdHJhY2tpbmcgZm9yIHRoYXQgYmFja2luZyBzdG9yYWdlLiBUaGUgcHJveHkgb2JqZWN0
IGlzIGFsd2F5cwotCSAqIGNvbnNpZGVyZWQgdG8gYmUgb3V0c2lkZSBvZiBhbnkgY2FjaGUgZG9t
YWluLgotCSAqLwotCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfcHJveHkob2JqKSkgewotCQllcnIg
PSAtRU5YSU87Ci0JCWdvdG8gb3V0OwotCX0KLQotCS8qCi0JICogRmx1c2ggYW5kIGFjcXVpcmUg
b2JqLT5wYWdlcyBzbyB0aGF0IHdlIGFyZSBjb2hlcmVudCB0aHJvdWdoCi0JICogZGlyZWN0IGFj
Y2VzcyBpbiBtZW1vcnkgd2l0aCBwcmV2aW91cyBjYWNoZWQgd3JpdGVzIHRocm91Z2gKLQkgKiBz
aG1lbWZzIGFuZCB0aGF0IG91ciBjYWNoZSBkb21haW4gdHJhY2tpbmcgcmVtYWlucyB2YWxpZC4K
LQkgKiBGb3IgZXhhbXBsZSwgaWYgdGhlIG9iai0+ZmlscCB3YXMgbW92ZWQgdG8gc3dhcCB3aXRo
b3V0IHVzCi0JICogYmVpbmcgbm90aWZpZWQgYW5kIHJlbGVhc2luZyB0aGUgcGFnZXMsIHdlIHdv
dWxkIG1pc3Rha2VubHkKLQkgKiBjb250aW51ZSB0byBhc3N1bWUgdGhhdCB0aGUgb2JqIHJlbWFp
bmVkIG91dCBvZiB0aGUgQ1BVIGNhY2hlZAotCSAqIGRvbWFpbi4KLQkgKi8KLQllcnIgPSBpOTE1
X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7Ci0JaWYgKGVycikKLQkJZ290byBvdXQ7Ci0KLQll
cnIgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwotCWlmIChlcnIpCi0JCWdv
dG8gb3V0X3VucGluOwotCi0JaWYgKHJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJTl9XQykK
LQkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4ob2JqLCB3cml0ZV9kb21h
aW4pOwotCWVsc2UgaWYgKHJlYWRfZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJTl9HVFQpCi0JCWVy
ciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHdyaXRlX2RvbWFpbik7
Ci0JZWxzZQotCQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4ob2JqLCB3
cml0ZV9kb21haW4pOwotCi0JLyogQW5kIGJ1bXAgdGhlIExSVSBmb3IgdGhpcyBhY2Nlc3MgKi8K
LQlpOTE1X2dlbV9vYmplY3RfYnVtcF9pbmFjdGl2ZV9nZ3R0KG9iaik7Ci0KLQltdXRleF91bmxv
Y2soJmRldi0+c3RydWN0X211dGV4KTsKLQotCWlmICh3cml0ZV9kb21haW4gIT0gMCkKLQkJaW50
ZWxfZmJfb2JqX2ludmFsaWRhdGUob2JqLAotCQkJCQlmYl93cml0ZV9vcmlnaW4ob2JqLCB3cml0
ZV9kb21haW4pKTsKLQotb3V0X3VucGluOgotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhv
YmopOwotb3V0OgotCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQlyZXR1cm4gZXJyOwotfQot
CiAvKioKICAqIENhbGxlZCB3aGVuIHVzZXIgc3BhY2UgaGFzIGRvbmUgd3JpdGVzIHRvIHRoaXMg
YnVmZmVyCiAgKiBAZGV2OiBkcm0gZGV2aWNlCkBAIC0xNTE4LDUxNCArMTI1Nyw2IEBAIGludCBp
OTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXJl
dHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9mb3JfZGlz
cGxheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCS8qCi0JICogV2UgbWFu
dWFsbHkgZmx1c2ggdGhlIENQVSBkb21haW4gc28gdGhhdCB3ZSBjYW4gb3ZlcnJpZGUgYW5kCi0J
ICogZm9yY2UgdGhlIGZsdXNoIGZvciB0aGUgZGlzcGxheSwgYW5kIHBlcmZvcm0gaXQgYXN5bmNy
aG9ub3VzbHkuCi0JICovCi0JaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRlX2RvbWFpbihvYmos
IH5JOTE1X0dFTV9ET01BSU5fQ1BVKTsKLQlpZiAob2JqLT5jYWNoZV9kaXJ0eSkKLQkJaTkxNV9n
ZW1fY2xmbHVzaF9vYmplY3Qob2JqLCBJOTE1X0NMRkxVU0hfRk9SQ0UpOwotCW9iai0+d3JpdGVf
ZG9tYWluID0gMDsKLX0KLQotdm9pZCBpOTE1X2dlbV9vYmplY3RfZmx1c2hfaWZfZGlzcGxheShz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCWlmICghUkVBRF9PTkNFKG9iai0+
cGluX2dsb2JhbCkpCi0JCXJldHVybjsKLQotCW11dGV4X2xvY2soJm9iai0+YmFzZS5kZXYtPnN0
cnVjdF9tdXRleCk7Ci0JX19pOTE1X2dlbV9vYmplY3RfZmx1c2hfZm9yX2Rpc3BsYXkob2JqKTsK
LQltdXRleF91bmxvY2soJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci19Ci0KLS8qKgot
ICogTW92ZXMgYSBzaW5nbGUgb2JqZWN0IHRvIHRoZSBXQyByZWFkLCBhbmQgcG9zc2libHkgd3Jp
dGUgZG9tYWluLgotICogQG9iajogb2JqZWN0IHRvIGFjdCBvbgotICogQHdyaXRlOiBhc2sgZm9y
IHdyaXRlIGFjY2VzcyBvciByZWFkIG9ubHkKLSAqCi0gKiBUaGlzIGZ1bmN0aW9uIHJldHVybnMg
d2hlbiB0aGUgbW92ZSBpcyBjb21wbGV0ZSwgaW5jbHVkaW5nIHdhaXRpbmcgb24KLSAqIGZsdXNo
ZXMgdG8gb2NjdXIuCi0gKi8KLWludAotaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4o
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgYm9vbCB3cml0ZSkKLXsKLQlpbnQgcmV0
OwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsK
LQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKLQkJCQkgICBJOTE1X1dBSVRfSU5U
RVJSVVBUSUJMRSB8Ci0JCQkJICAgSTkxNV9XQUlUX0xPQ0tFRCB8Ci0JCQkJICAgKHdyaXRlID8g
STkxNV9XQUlUX0FMTCA6IDApLAotCQkJCSAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQlpZiAo
cmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKG9iai0+d3JpdGVfZG9tYWluID09IEk5MTVfR0VN
X0RPTUFJTl9XQykKLQkJcmV0dXJuIDA7Ci0KLQkvKiBGbHVzaCBhbmQgYWNxdWlyZSBvYmotPnBh
Z2VzIHNvIHRoYXQgd2UgYXJlIGNvaGVyZW50IHRocm91Z2gKLQkgKiBkaXJlY3QgYWNjZXNzIGlu
IG1lbW9yeSB3aXRoIHByZXZpb3VzIGNhY2hlZCB3cml0ZXMgdGhyb3VnaAotCSAqIHNobWVtZnMg
YW5kIHRoYXQgb3VyIGNhY2hlIGRvbWFpbiB0cmFja2luZyByZW1haW5zIHZhbGlkLgotCSAqIEZv
ciBleGFtcGxlLCBpZiB0aGUgb2JqLT5maWxwIHdhcyBtb3ZlZCB0byBzd2FwIHdpdGhvdXQgdXMK
LQkgKiBiZWluZyBub3RpZmllZCBhbmQgcmVsZWFzaW5nIHRoZSBwYWdlcywgd2Ugd291bGQgbWlz
dGFrZW5seQotCSAqIGNvbnRpbnVlIHRvIGFzc3VtZSB0aGF0IHRoZSBvYmogcmVtYWluZWQgb3V0
IG9mIHRoZSBDUFUgY2FjaGVkCi0JICogZG9tYWluLgotCSAqLwotCXJldCA9IGk5MTVfZ2VtX29i
amVjdF9waW5fcGFnZXMob2JqKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaTkxNV9n
ZW1fb2JqZWN0X2ZsdXNoX3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fV0MpOwot
Ci0JLyogU2VyaWFsaXNlIGRpcmVjdCBhY2Nlc3MgdG8gdGhpcyBvYmplY3Qgd2l0aCB0aGUgYmFy
cmllcnMgZm9yCi0JICogY29oZXJlbnQgd3JpdGVzIGZyb20gdGhlIEdQVSwgYnkgZWZmZWN0aXZl
bHkgaW52YWxpZGF0aW5nIHRoZQotCSAqIFdDIGRvbWFpbiB1cG9uIGZpcnN0IGFjY2Vzcy4KLQkg
Ki8KLQlpZiAoKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlOX1dDKSA9PSAwKQot
CQltYigpOwotCi0JLyogSXQgc2hvdWxkIG5vdyBiZSBvdXQgb2YgYW55IG90aGVyIHdyaXRlIGRv
bWFpbnMsIGFuZCB3ZSBjYW4gdXBkYXRlCi0JICogdGhlIGRvbWFpbiB2YWx1ZXMgZm9yIG91ciBj
aGFuZ2VzLgotCSAqLwotCUdFTV9CVUdfT04oKG9iai0+d3JpdGVfZG9tYWluICYgfkk5MTVfR0VN
X0RPTUFJTl9XQykgIT0gMCk7Ci0Jb2JqLT5yZWFkX2RvbWFpbnMgfD0gSTkxNV9HRU1fRE9NQUlO
X1dDOwotCWlmICh3cml0ZSkgewotCQlvYmotPnJlYWRfZG9tYWlucyA9IEk5MTVfR0VNX0RPTUFJ
Tl9XQzsKLQkJb2JqLT53cml0ZV9kb21haW4gPSBJOTE1X0dFTV9ET01BSU5fV0M7Ci0JCW9iai0+
bW0uZGlydHkgPSB0cnVlOwotCX0KLQotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmop
OwotCXJldHVybiAwOwotfQotCi0vKioKLSAqIE1vdmVzIGEgc2luZ2xlIG9iamVjdCB0byB0aGUg
R1RUIHJlYWQsIGFuZCBwb3NzaWJseSB3cml0ZSBkb21haW4uCi0gKiBAb2JqOiBvYmplY3QgdG8g
YWN0IG9uCi0gKiBAd3JpdGU6IGFzayBmb3Igd3JpdGUgYWNjZXNzIG9yIHJlYWQgb25seQotICoK
LSAqIFRoaXMgZnVuY3Rpb24gcmV0dXJucyB3aGVuIHRoZSBtb3ZlIGlzIGNvbXBsZXRlLCBpbmNs
dWRpbmcgd2FpdGluZyBvbgotICogZmx1c2hlcyB0byBvY2N1ci4KLSAqLwotaW50Ci1pOTE1X2dl
bV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwgYm9vbCB3cml0ZSkKLXsKLQlpbnQgcmV0OwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2Jq
LT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0
KG9iaiwKLQkJCQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJICAgSTkxNV9XQUlU
X0xPQ0tFRCB8Ci0JCQkJICAgKHdyaXRlID8gSTkxNV9XQUlUX0FMTCA6IDApLAotCQkJCSAgIE1B
WF9TQ0hFRFVMRV9USU1FT1VUKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKG9i
ai0+d3JpdGVfZG9tYWluID09IEk5MTVfR0VNX0RPTUFJTl9HVFQpCi0JCXJldHVybiAwOwotCi0J
LyogRmx1c2ggYW5kIGFjcXVpcmUgb2JqLT5wYWdlcyBzbyB0aGF0IHdlIGFyZSBjb2hlcmVudCB0
aHJvdWdoCi0JICogZGlyZWN0IGFjY2VzcyBpbiBtZW1vcnkgd2l0aCBwcmV2aW91cyBjYWNoZWQg
d3JpdGVzIHRocm91Z2gKLQkgKiBzaG1lbWZzIGFuZCB0aGF0IG91ciBjYWNoZSBkb21haW4gdHJh
Y2tpbmcgcmVtYWlucyB2YWxpZC4KLQkgKiBGb3IgZXhhbXBsZSwgaWYgdGhlIG9iai0+ZmlscCB3
YXMgbW92ZWQgdG8gc3dhcCB3aXRob3V0IHVzCi0JICogYmVpbmcgbm90aWZpZWQgYW5kIHJlbGVh
c2luZyB0aGUgcGFnZXMsIHdlIHdvdWxkIG1pc3Rha2VubHkKLQkgKiBjb250aW51ZSB0byBhc3N1
bWUgdGhhdCB0aGUgb2JqIHJlbWFpbmVkIG91dCBvZiB0aGUgQ1BVIGNhY2hlZAotCSAqIGRvbWFp
bi4KLQkgKi8KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7Ci0JaWYgKHJl
dCkKLQkJcmV0dXJuIHJldDsKLQotCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4o
b2JqLCB+STkxNV9HRU1fRE9NQUlOX0dUVCk7Ci0KLQkvKiBTZXJpYWxpc2UgZGlyZWN0IGFjY2Vz
cyB0byB0aGlzIG9iamVjdCB3aXRoIHRoZSBiYXJyaWVycyBmb3IKLQkgKiBjb2hlcmVudCB3cml0
ZXMgZnJvbSB0aGUgR1BVLCBieSBlZmZlY3RpdmVseSBpbnZhbGlkYXRpbmcgdGhlCi0JICogR1RU
IGRvbWFpbiB1cG9uIGZpcnN0IGFjY2Vzcy4KLQkgKi8KLQlpZiAoKG9iai0+cmVhZF9kb21haW5z
ICYgSTkxNV9HRU1fRE9NQUlOX0dUVCkgPT0gMCkKLQkJbWIoKTsKLQotCS8qIEl0IHNob3VsZCBu
b3cgYmUgb3V0IG9mIGFueSBvdGhlciB3cml0ZSBkb21haW5zLCBhbmQgd2UgY2FuIHVwZGF0ZQot
CSAqIHRoZSBkb21haW4gdmFsdWVzIGZvciBvdXIgY2hhbmdlcy4KLQkgKi8KLQlHRU1fQlVHX09O
KChvYmotPndyaXRlX2RvbWFpbiAmIH5JOTE1X0dFTV9ET01BSU5fR1RUKSAhPSAwKTsKLQlvYmot
PnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9ET01BSU5fR1RUOwotCWlmICh3cml0ZSkgewotCQlv
YmotPnJlYWRfZG9tYWlucyA9IEk5MTVfR0VNX0RPTUFJTl9HVFQ7Ci0JCW9iai0+d3JpdGVfZG9t
YWluID0gSTkxNV9HRU1fRE9NQUlOX0dUVDsKLQkJb2JqLT5tbS5kaXJ0eSA9IHRydWU7Ci0JfQot
Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7Ci0JcmV0dXJuIDA7Ci19Ci0KLS8q
KgotICogQ2hhbmdlcyB0aGUgY2FjaGUtbGV2ZWwgb2YgYW4gb2JqZWN0IGFjcm9zcyBhbGwgVk1B
LgotICogQG9iajogb2JqZWN0IHRvIGFjdCBvbgotICogQGNhY2hlX2xldmVsOiBuZXcgY2FjaGUg
bGV2ZWwgdG8gc2V0IGZvciB0aGUgb2JqZWN0Ci0gKgotICogQWZ0ZXIgdGhpcyBmdW5jdGlvbiBy
ZXR1cm5zLCB0aGUgb2JqZWN0IHdpbGwgYmUgaW4gdGhlIG5ldyBjYWNoZS1sZXZlbAotICogYWNy
b3NzIGFsbCBHVFQgYW5kIHRoZSBjb250ZW50cyBvZiB0aGUgYmFja2luZyBzdG9yYWdlIHdpbGwg
YmUgY29oZXJlbnQsCi0gKiB3aXRoIHJlc3BlY3QgdG8gdGhlIG5ldyBjYWNoZS1sZXZlbC4gSW4g
b3JkZXIgdG8ga2VlcCB0aGUgYmFja2luZyBzdG9yYWdlCi0gKiBjb2hlcmVudCBmb3IgYWxsIHVz
ZXJzLCB3ZSBvbmx5IGFsbG93IGEgc2luZ2xlIGNhY2hlIGxldmVsIHRvIGJlIHNldAotICogZ2xv
YmFsbHkgb24gdGhlIG9iamVjdCBhbmQgcHJldmVudCBpdCBmcm9tIGJlaW5nIGNoYW5nZWQgd2hp
bHN0IHRoZQotICogaGFyZHdhcmUgaXMgcmVhZGluZyBmcm9tIHRoZSBvYmplY3QuIFRoYXQgaXMg
aWYgdGhlIG9iamVjdCBpcyBjdXJyZW50bHkKLSAqIG9uIHRoZSBzY2Fub3V0IGl0IHdpbGwgYmUg
c2V0IHRvIHVuY2FjaGVkIChvciBlcXVpdmFsZW50IGRpc3BsYXkKLSAqIGNhY2hlIGNvaGVyZW5j
eSkgYW5kIGFsbCBub24tTU9DUyBHUFUgYWNjZXNzIHdpbGwgYWxzbyBiZSB1bmNhY2hlZCBzbwot
ICogdGhhdCBhbGwgZGlyZWN0IGFjY2VzcyB0byB0aGUgc2Nhbm91dCByZW1haW5zIGNvaGVyZW50
LgotICovCi1pbnQgaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCSAgICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVf
bGV2ZWwpCi17Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0JaW50IHJldDsKLQotCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci0KLQlpZiAob2JqLT5j
YWNoZV9sZXZlbCA9PSBjYWNoZV9sZXZlbCkKLQkJcmV0dXJuIDA7Ci0KLQkvKiBJbnNwZWN0IHRo
ZSBsaXN0IG9mIGN1cnJlbnRseSBib3VuZCBWTUEgYW5kIHVuYmluZCBhbnkgdGhhdCB3b3VsZAot
CSAqIGJlIGludmFsaWQgZ2l2ZW4gdGhlIG5ldyBjYWNoZS1sZXZlbC4gVGhpcyBpcyBwcmluY2lw
YWxseSB0bwotCSAqIGNhdGNoIHRoZSBpc3N1ZSBvZiB0aGUgQ1MgcHJlZmV0Y2ggY3Jvc3Npbmcg
cGFnZSBib3VuZGFyaWVzIGFuZAotCSAqIHJlYWRpbmcgYW4gaW52YWxpZCBQVEUgb24gb2xkZXIg
YXJjaGl0ZWN0dXJlcy4KLQkgKi8KLXJlc3RhcnQ6Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEs
ICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykgewotCQlpZiAoIWRybV9tbV9ub2RlX2FsbG9jYXRl
ZCgmdm1hLT5ub2RlKSkKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChpOTE1X3ZtYV9pc19waW5uZWQo
dm1hKSkgewotCQkJRFJNX0RFQlVHKCJjYW4gbm90IGNoYW5nZSB0aGUgY2FjaGUgbGV2ZWwgb2Yg
cGlubmVkIG9iamVjdHNcbiIpOwotCQkJcmV0dXJuIC1FQlVTWTsKLQkJfQotCi0JCWlmICghaTkx
NV92bWFfaXNfY2xvc2VkKHZtYSkgJiYKLQkJICAgIGk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZSh2
bWEsIGNhY2hlX2xldmVsKSkKLQkJCWNvbnRpbnVlOwotCi0JCXJldCA9IGk5MTVfdm1hX3VuYmlu
ZCh2bWEpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQkvKiBBcyB1bmJpbmRpbmcg
bWF5IGFmZmVjdCBvdGhlciBlbGVtZW50cyBpbiB0aGUKLQkJICogb2JqLT52bWFfbGlzdCAoZHVl
IHRvIHNpZGUtZWZmZWN0cyBmcm9tIHJldGlyaW5nCi0JCSAqIGFuIGFjdGl2ZSB2bWEpLCBwbGF5
IHNhZmUgYW5kIHJlc3RhcnQgdGhlIGl0ZXJhdG9yLgotCQkgKi8KLQkJZ290byByZXN0YXJ0Owot
CX0KLQotCS8qIFdlIGNhbiByZXVzZSB0aGUgZXhpc3RpbmcgZHJtX21tIG5vZGVzIGJ1dCBuZWVk
IHRvIGNoYW5nZSB0aGUKLQkgKiBjYWNoZS1sZXZlbCBvbiB0aGUgUFRFLiBXZSBjb3VsZCBzaW1w
bHkgdW5iaW5kIHRoZW0gYWxsIGFuZAotCSAqIHJlYmluZCB3aXRoIHRoZSBjb3JyZWN0IGNhY2hl
LWxldmVsIG9uIG5leHQgdXNlLiBIb3dldmVyIHNpbmNlCi0JICogd2UgYWxyZWFkeSBoYXZlIGEg
dmFsaWQgc2xvdCwgZG1hIG1hcHBpbmcsIHBhZ2VzIGV0Yywgd2UgbWF5IGFzCi0JICogcmV3cml0
ZSB0aGUgUFRFIGluIHRoZSBiZWxpZWYgdGhhdCBkb2luZyBzbyB0cmFtcGxlcyB1cG9uIGxlc3MK
LQkgKiBzdGF0ZSBhbmQgc28gaW52b2x2ZXMgbGVzcyB3b3JrLgotCSAqLwotCWlmIChvYmotPmJp
bmRfY291bnQpIHsKLQkJLyogQmVmb3JlIHdlIGNoYW5nZSB0aGUgUFRFLCB0aGUgR1BVIG11c3Qg
bm90IGJlIGFjY2Vzc2luZyBpdC4KLQkJICogSWYgd2Ugd2FpdCB1cG9uIHRoZSBvYmplY3QsIHdl
IGtub3cgdGhhdCBhbGwgdGhlIGJvdW5kCi0JCSAqIFZNQSBhcmUgbm8gbG9uZ2VyIGFjdGl2ZS4K
LQkJICovCi0JCXJldCA9IGk5MTVfZ2VtX29iamVjdF93YWl0KG9iaiwKLQkJCQkJICAgSTkxNV9X
QUlUX0lOVEVSUlVQVElCTEUgfAotCQkJCQkgICBJOTE1X1dBSVRfTE9DS0VEIHwKLQkJCQkJICAg
STkxNV9XQUlUX0FMTCwKLQkJCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCQlpZiAocmV0
KQotCQkJcmV0dXJuIHJldDsKLQotCQlpZiAoIUhBU19MTEModG9faTkxNShvYmotPmJhc2UuZGV2
KSkgJiYKLQkJICAgIGNhY2hlX2xldmVsICE9IEk5MTVfQ0FDSEVfTk9ORSkgewotCQkJLyogQWNj
ZXNzIHRvIHNub29wYWJsZSBwYWdlcyB0aHJvdWdoIHRoZSBHVFQgaXMKLQkJCSAqIGluY29oZXJl
bnQgYW5kIG9uIHNvbWUgbWFjaGluZXMgY2F1c2VzIGEgaGFyZAotCQkJICogbG9ja3VwLiBSZWxp
bnF1aXNoIHRoZSBDUFUgbW1hcGluZyB0byBmb3JjZQotCQkJICogdXNlcnNwYWNlIHRvIHJlZmF1
bHQgaW4gdGhlIHBhZ2VzIGFuZCB3ZSBjYW4KLQkJCSAqIHRoZW4gZG91YmxlIGNoZWNrIGlmIHRo
ZSBHVFQgbWFwcGluZyBpcyBzdGlsbAotCQkJICogdmFsaWQgZm9yIHRoYXQgcG9pbnRlciBhY2Nl
c3MuCi0JCQkgKi8KLQkJCWk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX21tYXAob2JqKTsKLQotCQkJ
LyogQXMgd2Ugbm8gbG9uZ2VyIG5lZWQgYSBmZW5jZSBmb3IgR1RUIGFjY2VzcywKLQkJCSAqIHdl
IGNhbiByZWxpbnF1aXNoIGl0IG5vdyAoYW5kIHNvIHByZXZlbnQgaGF2aW5nCi0JCQkgKiB0byBz
dGVhbCBhIGZlbmNlIGZyb20gc29tZW9uZSBlbHNlIG9uIHRoZSBuZXh0Ci0JCQkgKiBmZW5jZSBy
ZXF1ZXN0KS4gTm90ZSBHUFUgYWN0aXZpdHkgd291bGQgaGF2ZQotCQkJICogZHJvcHBlZCB0aGUg
ZmVuY2UgYXMgYWxsIHNub29wYWJsZSBhY2Nlc3MgaXMKLQkJCSAqIHN1cHBvc2VkIHRvIGJlIGxp
bmVhci4KLQkJCSAqLwotCQkJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopIHsKLQkJCQlyZXQg
PSBpOTE1X3ZtYV9wdXRfZmVuY2Uodm1hKTsKLQkJCQlpZiAocmV0KQotCQkJCQlyZXR1cm4gcmV0
OwotCQkJfQotCQl9IGVsc2UgewotCQkJLyogV2UgZWl0aGVyIGhhdmUgaW5jb2hlcmVudCBiYWNr
aW5nIHN0b3JlIGFuZAotCQkJICogc28gbm8gR1RUIGFjY2VzcyBvciB0aGUgYXJjaGl0ZWN0dXJl
IGlzIGZ1bGx5Ci0JCQkgKiBjb2hlcmVudC4gSW4gc3VjaCBjYXNlcywgZXhpc3RpbmcgR1RUIG1t
YXBzCi0JCQkgKiBpZ25vcmUgdGhlIGNhY2hlIGJpdCBpbiB0aGUgUFRFIGFuZCB3ZSBjYW4KLQkJ
CSAqIHJld3JpdGUgaXQgd2l0aG91dCBjb25mdXNpbmcgdGhlIEdQVSBvciBoYXZpbmcKLQkJCSAq
IHRvIGZvcmNlIHVzZXJzcGFjZSB0byBmYXVsdCBiYWNrIGluIGl0cyBtbWFwcy4KLQkJCSAqLwot
CQl9Ci0KLQkJbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZvYmotPnZtYS5saXN0LCBvYmpfbGlu
aykgewotCQkJaWYgKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCi0JCQkJY29u
dGludWU7Ci0KLQkJCXJldCA9IGk5MTVfdm1hX2JpbmQodm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQ
REFURSk7Ci0JCQlpZiAocmV0KQotCQkJCXJldHVybiByZXQ7Ci0JCX0KLQl9Ci0KLQlsaXN0X2Zv
cl9lYWNoX2VudHJ5KHZtYSwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5rKQotCQl2bWEtPm5vZGUu
Y29sb3IgPSBjYWNoZV9sZXZlbDsKLQlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5j
eShvYmosIGNhY2hlX2xldmVsKTsKLQlvYmotPmNhY2hlX2RpcnR5ID0gdHJ1ZTsgLyogQWx3YXlz
IGludmFsaWRhdGUgc3RhbGUgY2FjaGVsaW5lcyAqLwotCi0JcmV0dXJuIDA7Ci19Ci0KLWludCBp
OTE1X2dlbV9nZXRfY2FjaGluZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLAotCQkJICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX2NhY2hpbmcgKmFyZ3MgPSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmo7Ci0JaW50IGVyciA9IDA7Ci0KLQlyY3VfcmVhZF9sb2NrKCk7Ci0Jb2JqID0gaTkxNV9n
ZW1fb2JqZWN0X2xvb2t1cF9yY3UoZmlsZSwgYXJncy0+aGFuZGxlKTsKLQlpZiAoIW9iaikgewot
CQllcnIgPSAtRU5PRU5UOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlzd2l0Y2ggKG9iai0+Y2FjaGVf
bGV2ZWwpIHsKLQljYXNlIEk5MTVfQ0FDSEVfTExDOgotCWNhc2UgSTkxNV9DQUNIRV9MM19MTEM6
Ci0JCWFyZ3MtPmNhY2hpbmcgPSBJOTE1X0NBQ0hJTkdfQ0FDSEVEOwotCQlicmVhazsKLQotCWNh
c2UgSTkxNV9DQUNIRV9XVDoKLQkJYXJncy0+Y2FjaGluZyA9IEk5MTVfQ0FDSElOR19ESVNQTEFZ
OwotCQlicmVhazsKLQotCWRlZmF1bHQ6Ci0JCWFyZ3MtPmNhY2hpbmcgPSBJOTE1X0NBQ0hJTkdf
Tk9ORTsKLQkJYnJlYWs7Ci0JfQotb3V0OgotCXJjdV9yZWFkX3VubG9jaygpOwotCXJldHVybiBl
cnI7Ci19Ci0KLWludCBpOTE1X2dlbV9zZXRfY2FjaGluZ19pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAotCQkJICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKLXsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX2NhY2hpbmcgKmFyZ3MgPSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmo7Ci0JZW51bSBpOTE1X2NhY2hlX2xldmVsIGxldmVsOwotCWludCByZXQgPSAw
OwotCi0Jc3dpdGNoIChhcmdzLT5jYWNoaW5nKSB7Ci0JY2FzZSBJOTE1X0NBQ0hJTkdfTk9ORToK
LQkJbGV2ZWwgPSBJOTE1X0NBQ0hFX05PTkU7Ci0JCWJyZWFrOwotCWNhc2UgSTkxNV9DQUNISU5H
X0NBQ0hFRDoKLQkJLyoKLQkJICogRHVlIHRvIGEgSFcgaXNzdWUgb24gQlhUIEEgc3RlcHBpbmcs
IEdQVSBzdG9yZXMgdmlhIGEKLQkJICogc25vb3BlZCBtYXBwaW5nIG1heSBsZWF2ZSBzdGFsZSBk
YXRhIGluIGEgY29ycmVzcG9uZGluZyBDUFUKLQkJICogY2FjaGVsaW5lLCB3aGVyZWFzIG5vcm1h
bGx5IHN1Y2ggY2FjaGVsaW5lcyB3b3VsZCBnZXQKLQkJICogaW52YWxpZGF0ZWQuCi0JCSAqLwot
CQlpZiAoIUhBU19MTEMoaTkxNSkgJiYgIUhBU19TTk9PUChpOTE1KSkKLQkJCXJldHVybiAtRU5P
REVWOwotCi0JCWxldmVsID0gSTkxNV9DQUNIRV9MTEM7Ci0JCWJyZWFrOwotCWNhc2UgSTkxNV9D
QUNISU5HX0RJU1BMQVk6Ci0JCWxldmVsID0gSEFTX1dUKGk5MTUpID8gSTkxNV9DQUNIRV9XVCA6
IEk5MTVfQ0FDSEVfTk9ORTsKLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIC1FSU5WQUw7
Ci0JfQotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2xvb2t1cChmaWxlLCBhcmdzLT5oYW5kbGUp
OwotCWlmICghb2JqKQotCQlyZXR1cm4gLUVOT0VOVDsKLQotCS8qCi0JICogVGhlIGNhY2hpbmcg
bW9kZSBvZiBwcm94eSBvYmplY3QgaXMgaGFuZGxlZCBieSBpdHMgZ2VuZXJhdG9yLCBhbmQKLQkg
KiBub3QgYWxsb3dlZCB0byBiZSBjaGFuZ2VkIGJ5IHVzZXJzcGFjZS4KLQkgKi8KLQlpZiAoaTkx
NV9nZW1fb2JqZWN0X2lzX3Byb3h5KG9iaikpIHsKLQkJcmV0ID0gLUVOWElPOwotCQlnb3RvIG91
dDsKLQl9Ci0KLQlpZiAob2JqLT5jYWNoZV9sZXZlbCA9PSBsZXZlbCkKLQkJZ290byBvdXQ7Ci0K
LQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCi0JCQkJICAgSTkxNV9XQUlUX0lOVEVS
UlVQVElCTEUsCi0JCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCWlmIChyZXQpCi0JCWdv
dG8gb3V0OwotCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlp
ZiAocmV0KQotCQlnb3RvIG91dDsKLQotCXJldCA9IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVf
bGV2ZWwob2JqLCBsZXZlbCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0K
LW91dDoKLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JcmV0dXJuIHJldDsKLX0KLQotLyoK
LSAqIFByZXBhcmUgYnVmZmVyIGZvciBkaXNwbGF5IHBsYW5lIChzY2Fub3V0LCBjdXJzb3JzLCBl
dGMpLiBDYW4gYmUgY2FsbGVkIGZyb20KLSAqIGFuIHVuaW50ZXJydXB0aWJsZSBwaGFzZSAobW9k
ZXNldHRpbmcpIGFuZCBhbGxvd3MgYW55IGZsdXNoZXMgdG8gYmUgcGlwZWxpbmVkCi0gKiAoZm9y
IHBhZ2VmbGlwcykuIFdlIG9ubHkgZmx1c2ggdGhlIGNhY2hlcyB3aGlsZSBwcmVwYXJpbmcgdGhl
IGJ1ZmZlciBmb3IKLSAqIGRpc3BsYXksIHRoZSBjYWxsZXJzIGFyZSByZXNwb25zaWJsZSBmb3Ig
ZnJvbnRidWZmZXIgZmx1c2guCi0gKi8KLXN0cnVjdCBpOTE1X3ZtYSAqCi1pOTE1X2dlbV9vYmpl
Y3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
LQkJCQkgICAgIHUzMiBhbGlnbm1lbnQsCi0JCQkJICAgICBjb25zdCBzdHJ1Y3QgaTkxNV9nZ3R0
X3ZpZXcgKnZpZXcsCi0JCQkJICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpCi17Ci0Jc3RydWN0IGk5
MTVfdm1hICp2bWE7Ci0JaW50IHJldDsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFz
ZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci0KLQkvKiBNYXJrIHRoZSBnbG9iYWwgcGluIGVhcmx5IHNv
IHRoYXQgd2UgYWNjb3VudCBmb3IgdGhlCi0JICogZGlzcGxheSBjb2hlcmVuY3kgd2hpbHN0IHNl
dHRpbmcgdXAgdGhlIGNhY2hlIGRvbWFpbnMuCi0JICovCi0Jb2JqLT5waW5fZ2xvYmFsKys7Ci0K
LQkvKiBUaGUgZGlzcGxheSBlbmdpbmUgaXMgbm90IGNvaGVyZW50IHdpdGggdGhlIExMQyBjYWNo
ZSBvbiBnZW42LiAgQXMKLQkgKiBhIHJlc3VsdCwgd2UgbWFrZSBzdXJlIHRoYXQgdGhlIHBpbm5p
bmcgdGhhdCBpcyBhYm91dCB0byBvY2N1ciBpcwotCSAqIGRvbmUgd2l0aCB1bmNhY2hlZCBQVEVz
LiBUaGlzIGlzIGxvd2VzdCBjb21tb24gZGVub21pbmF0b3IgZm9yIGFsbAotCSAqIGNoaXBzZXRz
LgotCSAqCi0JICogSG93ZXZlciBmb3IgZ2VuNissIHdlIGNvdWxkIGRvIGJldHRlciBieSB1c2lu
ZyB0aGUgR0ZEVCBiaXQgaW5zdGVhZAotCSAqIG9mIHVuY2FjaGluZywgd2hpY2ggd291bGQgYWxs
b3cgdXMgdG8gZmx1c2ggYWxsIHRoZSBMTEMtY2FjaGVkIGRhdGEKLQkgKiB3aXRoIHRoYXQgYml0
IGluIHRoZSBQVEUgdG8gbWFpbiBtZW1vcnkgd2l0aCBqdXN0IG9uZSBQSVBFX0NPTlRST0wuCi0J
ICovCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChvYmosCi0JCQkJCSAg
ICAgIEhBU19XVCh0b19pOTE1KG9iai0+YmFzZS5kZXYpKSA/Ci0JCQkJCSAgICAgIEk5MTVfQ0FD
SEVfV1QgOiBJOTE1X0NBQ0hFX05PTkUpOwotCWlmIChyZXQpIHsKLQkJdm1hID0gRVJSX1BUUihy
ZXQpOwotCQlnb3RvIGVycl91bnBpbl9nbG9iYWw7Ci0JfQotCi0JLyogQXMgdGhlIHVzZXIgbWF5
IG1hcCB0aGUgYnVmZmVyIG9uY2UgcGlubmVkIGluIHRoZSBkaXNwbGF5IHBsYW5lCi0JICogKGUu
Zy4gbGlia21zIGZvciB0aGUgYm9vdHVwIHNwbGFzaCksIHdlIGhhdmUgdG8gZW5zdXJlIHRoYXQg
d2UKLQkgKiBhbHdheXMgdXNlIG1hcF9hbmRfZmVuY2VhYmxlIGZvciBhbGwgc2Nhbm91dCBidWZm
ZXJzLiBIb3dldmVyLAotCSAqIGl0IG1heSBzaW1wbHkgYmUgdG9vIGJpZyB0byBmaXQgaW50byBt
YXBwYWJsZSwgaW4gd2hpY2ggY2FzZQotCSAqIHB1dCBpdCBhbnl3YXkgYW5kIGhvcGUgdGhhdCB1
c2Vyc3BhY2UgY2FuIGNvcGUgKGJ1dCBhbHdheXMgZmlyc3QKLQkgKiB0cnkgdG8gcHJlc2VydmUg
dGhlIGV4aXN0aW5nIEFCSSkuCi0JICovCi0Jdm1hID0gRVJSX1BUUigtRU5PU1BDKTsKLQlpZiAo
KGZsYWdzICYgUElOX01BUFBBQkxFKSA9PSAwICYmCi0JICAgICghdmlldyB8fCB2aWV3LT50eXBl
ID09IEk5MTVfR0dUVF9WSUVXX05PUk1BTCkpCi0JCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0
X3BpbihvYmosIHZpZXcsIDAsIGFsaWdubWVudCwKLQkJCQkJICAgICAgIGZsYWdzIHwKLQkJCQkJ
ICAgICAgIFBJTl9NQVBQQUJMRSB8Ci0JCQkJCSAgICAgICBQSU5fTk9OQkxPQ0spOwotCWlmIChJ
U19FUlIodm1hKSkKLQkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgdmlldywg
MCwgYWxpZ25tZW50LCBmbGFncyk7Ci0JaWYgKElTX0VSUih2bWEpKQotCQlnb3RvIGVycl91bnBp
bl9nbG9iYWw7Ci0KLQl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gbWF4X3QodTY0LCB2bWEtPmRp
c3BsYXlfYWxpZ25tZW50LCBhbGlnbm1lbnQpOwotCi0JX19pOTE1X2dlbV9vYmplY3RfZmx1c2hf
Zm9yX2Rpc3BsYXkob2JqKTsKLQotCS8qIEl0IHNob3VsZCBub3cgYmUgb3V0IG9mIGFueSBvdGhl
ciB3cml0ZSBkb21haW5zLCBhbmQgd2UgY2FuIHVwZGF0ZQotCSAqIHRoZSBkb21haW4gdmFsdWVz
IGZvciBvdXIgY2hhbmdlcy4KLQkgKi8KLQlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9E
T01BSU5fR1RUOwotCi0JcmV0dXJuIHZtYTsKLQotZXJyX3VucGluX2dsb2JhbDoKLQlvYmotPnBp
bl9nbG9iYWwtLTsKLQlyZXR1cm4gdm1hOwotfQotCi12b2lkCi1pOTE1X2dlbV9vYmplY3RfdW5w
aW5fZnJvbV9kaXNwbGF5X3BsYW5lKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQotewotCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JaWYgKFdB
Uk5fT04odm1hLT5vYmotPnBpbl9nbG9iYWwgPT0gMCkpCi0JCXJldHVybjsKLQotCWlmICgtLXZt
YS0+b2JqLT5waW5fZ2xvYmFsID09IDApCi0JCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBJOTE1
X0dUVF9NSU5fQUxJR05NRU5UOwotCi0JLyogQnVtcCB0aGUgTFJVIHRvIHRyeSBhbmQgYXZvaWQg
cHJlbWF0dXJlIGV2aWN0aW9uIHdoaWxzdCBmbGlwcGluZyAgKi8KLQlpOTE1X2dlbV9vYmplY3Rf
YnVtcF9pbmFjdGl2ZV9nZ3R0KHZtYS0+b2JqKTsKLQotCWk5MTVfdm1hX3VucGluKHZtYSk7Ci19
Ci0KLS8qKgotICogTW92ZXMgYSBzaW5nbGUgb2JqZWN0IHRvIHRoZSBDUFUgcmVhZCwgYW5kIHBv
c3NpYmx5IHdyaXRlIGRvbWFpbi4KLSAqIEBvYmo6IG9iamVjdCB0byBhY3Qgb24KLSAqIEB3cml0
ZTogcmVxdWVzdGluZyB3cml0ZSBvciByZWFkLW9ubHkgYWNjZXNzCi0gKgotICogVGhpcyBmdW5j
dGlvbiByZXR1cm5zIHdoZW4gdGhlIG1vdmUgaXMgY29tcGxldGUsIGluY2x1ZGluZyB3YWl0aW5n
IG9uCi0gKiBmbHVzaGVzIHRvIG9jY3VyLgotICovCi1pbnQKLWk5MTVfZ2VtX29iamVjdF9zZXRf
dG9fY3B1X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBib29sIHdyaXRl
KQotewotCWludCByZXQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5z
dHJ1Y3RfbXV0ZXgpOwotCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLAotCQkJCSAg
IEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICBJOTE1X1dBSVRfTE9DS0VEIHwKLQkJ
CQkgICAod3JpdGUgPyBJOTE1X1dBSVRfQUxMIDogMCksCi0JCQkJICAgTUFYX1NDSEVEVUxFX1RJ
TUVPVVQpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlpOTE1X2dlbV9vYmplY3RfZmx1
c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOwotCi0JLyogRmx1c2gg
dGhlIENQVSBjYWNoZSBpZiBpdCdzIHN0aWxsIGludmFsaWQuICovCi0JaWYgKChvYmotPnJlYWRf
ZG9tYWlucyAmIEk5MTVfR0VNX0RPTUFJTl9DUFUpID09IDApIHsKLQkJaTkxNV9nZW1fY2xmbHVz
aF9vYmplY3Qob2JqLCBJOTE1X0NMRkxVU0hfU1lOQyk7Ci0JCW9iai0+cmVhZF9kb21haW5zIHw9
IEk5MTVfR0VNX0RPTUFJTl9DUFU7Ci0JfQotCi0JLyogSXQgc2hvdWxkIG5vdyBiZSBvdXQgb2Yg
YW55IG90aGVyIHdyaXRlIGRvbWFpbnMsIGFuZCB3ZSBjYW4gdXBkYXRlCi0JICogdGhlIGRvbWFp
biB2YWx1ZXMgZm9yIG91ciBjaGFuZ2VzLgotCSAqLwotCUdFTV9CVUdfT04ob2JqLT53cml0ZV9k
b21haW4gJiB+STkxNV9HRU1fRE9NQUlOX0NQVSk7Ci0KLQkvKiBJZiB3ZSdyZSB3cml0aW5nIHRo
cm91Z2ggdGhlIENQVSwgdGhlbiB0aGUgR1BVIHJlYWQgZG9tYWlucyB3aWxsCi0JICogbmVlZCB0
byBiZSBpbnZhbGlkYXRlZCBhdCBuZXh0IHVzZS4KLQkgKi8KLQlpZiAod3JpdGUpCi0JCV9fc3Rh
cnRfY3B1X3dyaXRlKG9iaik7Ci0KLQlyZXR1cm4gMDsKLX0KLQogLyogVGhyb3R0bGUgb3VyIHJl
bmRlcmluZyBieSB3YWl0aW5nIHVudGlsIHRoZSByaW5nIGhhcyBjb21wbGV0ZWQgb3VyIHJlcXVl
c3RzCiAgKiBlbWl0dGVkIG92ZXIgMjAgbXNlYyBhZ28uCiAgKgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IDI3MzkxMzAwNTA3ZS4uZmM2OGM5MDk2ZTk0
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9leGVjYnVmZmVyLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC0xMDI2
LDcgKzEwMjYsNyBAQCBzdGF0aWMgdm9pZCByZWxvY19jYWNoZV9yZXNldChzdHJ1Y3QgcmVsb2Nf
Y2FjaGUgKmNhY2hlKQogCQkJbWIoKTsKIAogCQlrdW5tYXBfYXRvbWljKHZhZGRyKTsKLQkJaTkx
NV9nZW1fb2JqX2ZpbmlzaF9zaG1lbV9hY2Nlc3MoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICopY2FjaGUtPm5vZGUubW0pOworCQlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2Vzcygoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKiljYWNoZS0+bm9kZS5tbSk7CiAJfSBlbHNlIHsKIAkJ
d21iKCk7CiAJCWlvX21hcHBpbmdfdW5tYXBfYXRvbWljKCh2b2lkIF9faW9tZW0gKil2YWRkcik7
CkBAIC0xMDU4LDcgKzEwNTgsNyBAQCBzdGF0aWMgdm9pZCAqcmVsb2Nfa21hcChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQl1bnNpZ25lZCBpbnQgZmx1c2hlczsKIAkJaW50IGVy
cjsKIAotCQllcnIgPSBpOTE1X2dlbV9vYmpfcHJlcGFyZV9zaG1lbV93cml0ZShvYmosICZmbHVz
aGVzKTsKKwkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUob2JqLCAmZmx1c2hl
cyk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gRVJSX1BUUihlcnIpOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9yZW5kZXJfc3RhdGUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX3JlbmRlcl9zdGF0ZS5jCmluZGV4IDk0NDAwMjRjNzYzZi4uZjNi
NDJiMDI2ZmZmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9yZW5k
ZXJfc3RhdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9yZW5kZXJfc3Rh
dGUuYwpAQCAtODQsNyArODQsNyBAQCBzdGF0aWMgaW50IHJlbmRlcl9zdGF0ZV9zZXR1cChzdHJ1
Y3QgaW50ZWxfcmVuZGVyX3N0YXRlICpzbywKIAl1MzIgKmQ7CiAJaW50IHJldDsKIAotCXJldCA9
IGk5MTVfZ2VtX29ial9wcmVwYXJlX3NobWVtX3dyaXRlKHNvLT5vYmosICZuZWVkc19jbGZsdXNo
KTsKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV93cml0ZShzby0+b2JqLCAmbmVlZHNf
Y2xmbHVzaCk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMTY2LDcgKzE2Niw3IEBA
IHN0YXRpYyBpbnQgcmVuZGVyX3N0YXRlX3NldHVwKHN0cnVjdCBpbnRlbF9yZW5kZXJfc3RhdGUg
KnNvLAogCiAJcmV0ID0gMDsKIG91dDoKLQlpOTE1X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2Vz
cyhzby0+b2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2Vzcyhzby0+b2JqKTsKIAly
ZXR1cm4gcmV0OwogCiBlcnI6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2h1Z2Vf
cGFnZXMuYwppbmRleCBjZTRlYzg3Njk4ZjYuLmIyMmI4MjQ5ZGZiZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0xMDE3LDcgKzEwMTcsNyBAQCBz
dGF0aWMgaW50IGNwdV9jaGVjayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1MzIg
ZHdvcmQsIHUzMiB2YWwpCiAJdW5zaWduZWQgbG9uZyBuOwogCWludCBlcnI7CiAKLQllcnIgPSBp
OTE1X2dlbV9vYmpfcHJlcGFyZV9zaG1lbV9yZWFkKG9iaiwgJm5lZWRzX2ZsdXNoKTsKKwllcnIg
PSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV9yZWFkKG9iaiwgJm5lZWRzX2ZsdXNoKTsKIAlpZiAo
ZXJyKQogCQlyZXR1cm4gZXJyOwogCkBAIC0xMDM4LDcgKzEwMzgsNyBAQCBzdGF0aWMgaW50IGNw
dV9jaGVjayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1MzIgZHdvcmQsIHUzMiB2
YWwpCiAJCWt1bm1hcF9hdG9taWMocHRyKTsKIAl9CiAKLQlpOTE1X2dlbV9vYmpfZmluaXNoX3No
bWVtX2FjY2VzcyhvYmopOworCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKG9iaik7CiAK
IAlyZXR1cm4gZXJyOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfZ2VtX2NvaGVyZW5jeS5jCmluZGV4IDA0NmEzODc0MzE1Mi4uY2IyNWI1ZmM4MDI3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJl
bmN5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVy
ZW5jeS5jCkBAIC0zNyw3ICszNyw3IEBAIHN0YXRpYyBpbnQgY3B1X3NldChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCXUzMiAqY3B1OwogCWludCBlcnI7CiAKLQllcnIgPSBpOTE1
X2dlbV9vYmpfcHJlcGFyZV9zaG1lbV93cml0ZShvYmosICZuZWVkc19jbGZsdXNoKTsKKwllcnIg
PSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV93cml0ZShvYmosICZuZWVkc19jbGZsdXNoKTsKIAlp
ZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCkBAIC01NCw3ICs1NCw3IEBAIHN0YXRpYyBpbnQgY3B1
X3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlkcm1fY2xmbHVzaF92aXJ0
X3JhbmdlKGNwdSwgc2l6ZW9mKCpjcHUpKTsKIAogCWt1bm1hcF9hdG9taWMobWFwKTsKLQlpOTE1
X2dlbV9vYmpfZmluaXNoX3NobWVtX2FjY2VzcyhvYmopOworCWk5MTVfZ2VtX29iamVjdF9maW5p
c2hfYWNjZXNzKG9iaik7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTY5LDcgKzY5LDcgQEAgc3RhdGlj
IGludCBjcHVfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdTMyICpjcHU7
CiAJaW50IGVycjsKIAotCWVyciA9IGk5MTVfZ2VtX29ial9wcmVwYXJlX3NobWVtX3JlYWQob2Jq
LCAmbmVlZHNfY2xmbHVzaCk7CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfcmVhZChv
YmosICZuZWVkc19jbGZsdXNoKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCkBAIC04Myw3
ICs4Myw3IEBAIHN0YXRpYyBpbnQgY3B1X2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCSp2ID0gKmNwdTsKIAogCWt1bm1hcF9hdG9taWMobWFwKTsKLQlpOTE1X2dlbV9vYmpf
ZmluaXNoX3NobWVtX2FjY2VzcyhvYmopOworCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNz
KG9iaik7CiAKIAlyZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDM0YWM1Y2M2ZDU5Zi4uYzY5YzZkOWE5OThi
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250
ZXh0LmMKQEAgLTM1NCw3ICszNTQsNyBAQCBzdGF0aWMgaW50IGNwdV9maWxsKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosIHUzMiB2YWx1ZSkKIAl1bnNpZ25lZCBpbnQgbiwgbSwgbmVl
ZF9mbHVzaDsKIAlpbnQgZXJyOwogCi0JZXJyID0gaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2htZW1f
d3JpdGUob2JqLCAmbmVlZF9mbHVzaCk7CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVf
d3JpdGUob2JqLCAmbmVlZF9mbHVzaCk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAt
MzY5LDcgKzM2OSw3IEBAIHN0YXRpYyBpbnQgY3B1X2ZpbGwoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwgdTMyIHZhbHVlKQogCQlrdW5tYXBfYXRvbWljKG1hcCk7CiAJfQogCi0JaTkx
NV9nZW1fb2JqX2ZpbmlzaF9zaG1lbV9hY2Nlc3Mob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmlu
aXNoX2FjY2VzcyhvYmopOwogCW9iai0+cmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9NQUlOX0dU
VCB8IEk5MTVfR0VNX0RPTUFJTl9DUFU7CiAJb2JqLT53cml0ZV9kb21haW4gPSAwOwogCXJldHVy
biAwOwpAQCAtMzgxLDcgKzM4MSw3IEBAIHN0YXRpYyBub2lubGluZSBpbnQgY3B1X2NoZWNrKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdW5zaWduZWQgaW50IG4sIG0sIG5lZWRz
X2ZsdXNoOwogCWludCBlcnI7CiAKLQllcnIgPSBpOTE1X2dlbV9vYmpfcHJlcGFyZV9zaG1lbV9y
ZWFkKG9iaiwgJm5lZWRzX2ZsdXNoKTsKKwllcnIgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV9y
ZWFkKG9iaiwgJm5lZWRzX2ZsdXNoKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCkBAIC00
MTksNyArNDE5LDcgQEAgc3RhdGljIG5vaW5saW5lIGludCBjcHVfY2hlY2soc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWJyZWFrOwogCX0KIAotCWk5MTVfZ2VtX29ial9maW5p
c2hfc2htZW1fYWNjZXNzKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3Mob2Jq
KTsKIAlyZXR1cm4gZXJyOwogfQogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

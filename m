Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8121E59DE6
	for <lists+intel-gfx@lfdr.de>; Fri, 28 Jun 2019 16:37:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id ABB8C6E93C;
	Fri, 28 Jun 2019 14:37:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 98B976E93C
 for <intel-gfx@lists.freedesktop.org>; Fri, 28 Jun 2019 14:37:04 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Jun 2019 07:37:04 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,428,1557212400"; d="scan'208";a="165079461"
Received: from ideak-desk.fi.intel.com ([10.237.68.142])
 by orsmga003.jf.intel.com with ESMTP; 28 Jun 2019 07:37:02 -0700
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 28 Jun 2019 17:36:23 +0300
Message-Id: <20190628143635.22066-12-imre.deak@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190628143635.22066-1-imre.deak@intel.com>
References: <20190628143635.22066-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 11/23] drm/i915: Handle the TCCOLD power-down
 event
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QmFzZWQgb24gYSByZWNlbnQgQlNwZWMgdXBkYXRlIChJbmRleC8yMTc1MCkgd2UgbXVzdCBoYW5k
bGUgdGhlIFRDQ09MRApldmVudCBhc3NvY2lhdGVkIHdpdGggdGhlIERQLWFsdCBtb2RlLiBXZSBj
YW4gZGV0ZWN0IHRoaXMgZXZlbnQgYnkKcmVhZGluZyBhbiBpbnZhbGlkIGFsbC0xcyB2YWx1ZSBm
cm9tIEZJQSByZWdpc3RlcnMuCgpBZnRlciBkZXRlY3RpbmcgVENDT0xEIHdlIHdpbGw6Ci0gZmFs
bCBiYWNrIHRvIFRCVC1hbHQgbW9kZSB3aGVuIGF0dGVtcHRpbmcgdG8gc3dpdGNoIHRvIERQLWFs
dCBtb2RlCi0gY29uY2x1ZGUgdGhhdCBub3RoaW5nIGlzIGNvbm5lY3RlZCBkdXJpbmcgbGl2ZSBz
dGF0dXMgZGV0ZWN0aW9uCi0gV0FSTiB3aGVuIGFscmVhZHkgaW4gdW5zYWZlIG1vZGUsIHNpbmNl
IHRoZW4gVENDT0xEIGlzIHVuZXhwZWN0ZWQKCnYyOgotIFVzZSBEUk1fREVCVUdfS01TIGluc3Rl
YWQgb2YgRFJNX0RFQlVHX0RSSVZFUi4gKEpvc8OpKQp2MzoKLSBVc2UgMHhmZmZmZmZmZiBpbnN0
ZWFkIG9mIC0xIGFzIGludmFsaWQgRklBIHJlZyB2YWx1ZS4KICAoSm9zw6ksIFZpbGxlKQotIENo
ZWNrIGZvciBUQ0NPTEQgaW4gaWNsX3RjX3BoeV9zdGF0dXNfY29tcGxldGUoKSB0b28uIChWaWxs
ZSkKCkNjOiBKb3PDqSBSb2JlcnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KQ2M6
IFJvZHJpZ28gVml2aSA8cm9kcmlnby52aXZpQGludGVsLmNvbT4KQ2M6IFZpbGxlIFN5cmrDpGzD
pCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEltcmUgRGVh
ayA8aW1yZS5kZWFrQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291
emEgPGpvc2Uuc291emFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfdGMuYyB8IDMzICsrKysrKysrKysrKysrKysrKysrKystLS0KIDEgZmlsZSBjaGFu
Z2VkLCAyOSBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdGMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfdGMuYwppbmRleCA0MjQzZGI2ZDI1YTcuLjk2ODU1MjUwYTViZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF90Yy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdGMuYwpAQCAtMjksNiArMjksOCBAQCB1
MzIgaW50ZWxfdGNfcG9ydF9nZXRfbGFuZV9tYXNrKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQg
KmRpZ19wb3J0KQogCiAJbGFuZV9tYXNrID0gSTkxNV9SRUFEKFBPUlRfVFhfREZMRVhEUFNQKTsK
IAorCVdBUk5fT04obGFuZV9tYXNrID09IDB4ZmZmZmZmZmYpOworCiAJcmV0dXJuIChsYW5lX21h
c2sgJiBEUF9MQU5FX0FTU0lHTk1FTlRfTUFTSyh0Y19wb3J0KSkgPj4KIAkgICAgICAgRFBfTEFO
RV9BU1NJR05NRU5UX1NISUZUKHRjX3BvcnQpOwogfQpAQCAtOTIsNiArOTQsMTIgQEAgc3RhdGlj
IHUzMiB0Y19wb3J0X2xpdmVfc3RhdHVzX21hc2soc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAq
ZGlnX3BvcnQpCiAKIAl2YWwgPSBJOTE1X1JFQUQoUE9SVF9UWF9ERkxFWERQU1ApOwogCisJaWYg
KHZhbCA9PSAweGZmZmZmZmZmKSB7CisJCURSTV9ERUJVR19LTVMoIlBvcnQgJXM6IFBIWSBpbiBU
Q0NPTEQsIG5vdGhpbmcgY29ubmVjdGVkXG4iLAorCQkJICAgICAgZGlnX3BvcnQtPnRjX3BvcnRf
bmFtZSk7CisJCXJldHVybiBtYXNrOworCX0KKwogCWlmICh2YWwgJiBUQ19MSVZFX1NUQVRFX1RC
VCh0Y19wb3J0KSkKIAkJbWFzayB8PSBCSVQoVENfUE9SVF9UQlRfQUxUKTsKIAlpZiAodmFsICYg
VENfTElWRV9TVEFURV9UQyh0Y19wb3J0KSkKQEAgLTExMSwxMiArMTE5LDE5IEBAIHN0YXRpYyBi
b29sIGljbF90Y19waHlfc3RhdHVzX2NvbXBsZXRlKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQg
KmRpZ19wb3J0KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwogCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50
ZWxfcG9ydF90b190YyhkZXZfcHJpdiwgZGlnX3BvcnQtPmJhc2UucG9ydCk7CisJdTMyIHZhbDsK
IAotCXJldHVybiBJOTE1X1JFQUQoUE9SVF9UWF9ERkxFWERQUE1TKSAmCi0JICAgICAgIERQX1BI
WV9NT0RFX1NUQVRVU19DT01QTEVURUQodGNfcG9ydCk7CisJdmFsID0gSTkxNV9SRUFEKFBPUlRf
VFhfREZMRVhEUFBNUyk7CisJaWYgKHZhbCA9PSAweGZmZmZmZmZmKSB7CisJCURSTV9ERUJVR19L
TVMoIlBvcnQgJXM6IFBIWSBpbiBUQ0NPTEQsIGFzc3VtaW5nIG5vdCBjb21wbGV0ZVxuIiwKKwkJ
CSAgICAgIGRpZ19wb3J0LT50Y19wb3J0X25hbWUpOworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJ
cmV0dXJuIHZhbCAmIERQX1BIWV9NT0RFX1NUQVRVU19DT01QTEVURUQodGNfcG9ydCk7CiB9CiAK
LXN0YXRpYyB2b2lkIGljbF90Y19waHlfc2V0X3NhZmVfbW9kZShzdHJ1Y3QgaW50ZWxfZGlnaXRh
bF9wb3J0ICpkaWdfcG9ydCwKK3N0YXRpYyBib29sIGljbF90Y19waHlfc2V0X3NhZmVfbW9kZShz
dHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCwKIAkJCQkgICAgIGJvb2wgZW5hYmxl
KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGlnX3Bv
cnQtPmJhc2UuYmFzZS5kZXYpOwpAQCAtMTI0LDYgKzEzOSwxMyBAQCBzdGF0aWMgdm9pZCBpY2xf
dGNfcGh5X3NldF9zYWZlX21vZGUoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQs
CiAJdTMyIHZhbDsKIAogCXZhbCA9IEk5MTVfUkVBRChQT1JUX1RYX0RGTEVYRFBDU1NTKTsKKwlp
ZiAodmFsID09IDB4ZmZmZmZmZmYpIHsKKwkJRFJNX0RFQlVHX0tNUygiUG9ydCAlczogUEhZIGlu
IFRDQ09MRCwgY2FuJ3Qgc2V0IHNhZmUtbW9kZSB0byAlc1xuIiwKKwkJCSAgICAgIGRpZ19wb3J0
LT50Y19wb3J0X25hbWUsCisJCQkgICAgICBlbmFibGVkZGlzYWJsZWQoZW5hYmxlKSk7CisKKwkJ
cmV0dXJuIGZhbHNlOworCX0KIAogCXZhbCAmPSB+RFBfUEhZX01PREVfU1RBVFVTX05PVF9TQUZF
KHRjX3BvcnQpOwogCWlmICghZW5hYmxlKQpAQCAtMTM0LDYgKzE1Niw4IEBAIHN0YXRpYyB2b2lk
IGljbF90Y19waHlfc2V0X3NhZmVfbW9kZShzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdf
cG9ydCwKIAlpZiAoZW5hYmxlICYmIHdhaXRfZm9yKCFpY2xfdGNfcGh5X3N0YXR1c19jb21wbGV0
ZShkaWdfcG9ydCksIDEwKSkKIAkJRFJNX0RFQlVHX0tNUygiUG9ydCAlczogUEhZIGNvbXBsZXRl
IGNsZWFyIHRpbWVkIG91dFxuIiwKIAkJCSAgICAgIGRpZ19wb3J0LT50Y19wb3J0X25hbWUpOwor
CisJcmV0dXJuIHRydWU7CiB9CiAKIC8qCkBAIC0xNzIsNyArMTk2LDggQEAgc3RhdGljIGJvb2wg
aWNsX3RjX3BoeV9jb25uZWN0KHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0KQog
CQlyZXR1cm4gZmFsc2U7CiAJfQogCi0JaWNsX3RjX3BoeV9zZXRfc2FmZV9tb2RlKGRpZ19wb3J0
LCBmYWxzZSk7CisJaWYgKCFpY2xfdGNfcGh5X3NldF9zYWZlX21vZGUoZGlnX3BvcnQsIGZhbHNl
KSkKKwkJcmV0dXJuIGZhbHNlOwogCiAJaWYgKGRpZ19wb3J0LT50Y19tb2RlID09IFRDX1BPUlRf
TEVHQUNZKQogCQlyZXR1cm4gdHJ1ZTsKLS0gCjIuMTcuMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EB6A43C998
	for <lists+intel-gfx@lfdr.de>; Tue, 11 Jun 2019 13:01:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BFEF6890E5;
	Tue, 11 Jun 2019 11:00:59 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A0F5B890E5
 for <Intel-gfx@lists.freedesktop.org>; Tue, 11 Jun 2019 11:00:58 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 11 Jun 2019 04:00:49 -0700
X-ExtLoop1: 1
Received: from nmanovic-mobl.ccr.corp.intel.com (HELO localhost.localdomain)
 ([10.252.13.223])
 by fmsmga007.fm.intel.com with ESMTP; 11 Jun 2019 04:00:48 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Tue, 11 Jun 2019 12:00:44 +0100
Message-Id: <20190611110044.7742-2-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190611110044.7742-1-tvrtko.ursulin@linux.intel.com>
References: <20190611110044.7742-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/2] drm/i915: Make GuC GGTT reservation work on
 ggtt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KClRoZXNlIGZ1
bmN0aW9ucyBvcGVyYXRlIG9uIGdndHQgc28gbWFrZSB0aGVtIHRha2UgdGhhdCBkaXJlY3RseSBh
cwpwYXJhbWV0ZXIuCgpBdCB0aGUgc2FtZSB0aW1lIG1vdmUgdGhlIFVTRVNfR1VDIGNvbmRpdGlv
bmFsIGRvd24gdG8KaW50ZWxfZ3VjX3Jlc2VydmVfZ2d0dF90b3AgZm9yIHN5bW1ldHJ5IHdpdGgK
aW50ZWxfZ3VjX3Jlc2VydmVkX2d0dF9zaXplLgoKdjI6CiAqIFJlbmFtZSBhbmQgbW92ZSBmdW5j
dGlvbnMgdG8gYmUgc3RhdGljIGluIGk5MTVfZ2VtX2d0dC5jIChNaWNoYWwpCgp2MzoKICogQWRk
IGNvbW1lbnQgZXhwbGFpbmluZyByZWFzb24gZm9yIHJlc2VydmF0aW9uLCBhZGQgYXNzZXJ0IGFu
ZCBmaXgKICAgZXJyb3IgbWVzc2FnZS4gKE1pY2hhbCkKClNpZ25lZC1vZmYtYnk6IFR2cnRrbyBV
cnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+CkNjOiBNaWNoYWwgV2FqZGVjemtvIDxt
aWNoYWwud2FqZGVjemtvQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1pY2hhbCBXYWpkZWN6a28g
PG1pY2hhbC53YWpkZWN6a29AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jIHwgNDMgKysrKysrKysrKysrKysrKysrKysrKysrLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jICAgIHwgMjcgLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMuaCAgICB8ICAyIC0tCiAzIGZpbGVzIGNoYW5nZWQs
IDM2IGluc2VydGlvbnMoKyksIDM2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmMKaW5kZXggNWI1MTI1ZWU0OWYzLi5jYTNkNzk2NjJjYzEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0yODA3LDYgKzI4MDcsMzIgQEAgc3RhdGljIHZvaWQgZmlu
aV9hbGlhc2luZ19wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlnZ3R0LT52
bS52bWFfb3BzLnVuYmluZF92bWEgPSBnZ3R0X3VuYmluZF92bWE7CiB9CiAKK3N0YXRpYyBpbnQg
Z2d0dF9yZXNlcnZlX2d1Y190b3Aoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKK3sKKwl1NjQgc2l6
ZTsKKwlpbnQgcmV0OworCisJaWYgKCFVU0VTX0dVQyhnZ3R0LT52bS5pOTE1KSkKKwkJcmV0dXJu
IDA7CisKKwlHRU1fQlVHX09OKEdVQ19HR1RUX1RPUCA+IGdndHQtPnZtLnRvdGFsKTsKKwlzaXpl
ID0gZ2d0dC0+dm0udG90YWwgLSBHVUNfR0dUVF9UT1A7CisKKwlyZXQgPSBpOTE1X2dlbV9ndHRf
cmVzZXJ2ZSgmZ2d0dC0+dm0sICZnZ3R0LT51Y19mdywgc2l6ZSwKKwkJCQkgICBHVUNfR0dUVF9U
T1AsIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCisJCQkJICAgUElOX05PRVZJQ1QpOworCWlmIChy
ZXQpCisJCURSTV9ERUJVR19EUklWRVIoIkZhaWxlZCB0byByZXNlcnZlIHRvcCBvZiBHR1RUIGZv
ciBHdUNcbiIpOworCisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIHZvaWQgZ2d0dF9yZWxlYXNl
X2d1Y190b3Aoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKK3sKKwlpZiAoZHJtX21tX25vZGVfYWxs
b2NhdGVkKCZnZ3R0LT51Y19mdykpCisJCWRybV9tbV9yZW1vdmVfbm9kZSgmZ2d0dC0+dWNfZncp
OworfQorCiBpbnQgaTkxNV9nZW1faW5pdF9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIHsKIAkvKiBMZXQgR0VNIE1hbmFnZSBhbGwgb2YgdGhlIGFwZXJ0dXJlLgpAQCAt
Mjg0NCwxMSArMjg3MCwxNCBAQCBpbnQgaTkxNV9nZW1faW5pdF9nZ3R0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JaWYgKFVT
RVNfR1VDKGRldl9wcml2KSkgewotCQlyZXQgPSBpbnRlbF9ndWNfcmVzZXJ2ZV9nZ3R0X3RvcCgm
ZGV2X3ByaXYtPmd1Yyk7Ci0JCWlmIChyZXQpCi0JCQlnb3RvIGVycl9yZXNlcnZlOwotCX0KKwkv
KgorCSAqIFRoZSB1cHBlciBwb3J0aW9uIG9mIHRoZSBHdUMgYWRkcmVzcyBzcGFjZSBoYXMgYSBz
aXplYWJsZSBob2xlCisJICogKHNldmVyYWwgTUIpIHRoYXQgaXMgaW5hY2Nlc3NpYmxlIGJ5IEd1
Qy4gUmVzZXJ2ZSB0aGlzIHJhbmdlIHdpdGhpbgorCSAqIEdHVFQgYXMgaXQgY2FuIGNvbWZvcnRh
Ymx5IGhvbGQgR3VDL0h1QyBmaXJtd2FyZSBpbWFnZXMuCisJICovCisJcmV0ID0gZ2d0dF9yZXNl
cnZlX2d1Y190b3AoZ2d0dCk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfcmVzZXJ2ZTsKIAogCS8q
IENsZWFyIGFueSBub24tcHJlYWxsb2NhdGVkIGJsb2NrcyAqLwogCWRybV9tbV9mb3JfZWFjaF9o
b2xlKGVudHJ5LCAmZ2d0dC0+dm0ubW0sIGhvbGVfc3RhcnQsIGhvbGVfZW5kKSB7CkBAIC0yODcw
LDcgKzI4OTksNyBAQCBpbnQgaTkxNV9nZW1faW5pdF9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gMDsKIAogZXJyX2FwcGd0dDoKLQlpbnRlbF9ndWNfcmVs
ZWFzZV9nZ3R0X3RvcCgmZGV2X3ByaXYtPmd1Yyk7CisJZ2d0dF9yZWxlYXNlX2d1Y190b3AoZ2d0
dCk7CiBlcnJfcmVzZXJ2ZToKIAlkcm1fbW1fcmVtb3ZlX25vZGUoJmdndHQtPmVycm9yX2NhcHR1
cmUpOwogCXJldHVybiByZXQ7CkBAIC0yODk3LDcgKzI5MjYsNyBAQCB2b2lkIGk5MTVfZ2d0dF9j
bGVhbnVwX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpZiAoZHJtX21t
X25vZGVfYWxsb2NhdGVkKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKSkKIAkJZHJtX21tX3JlbW92ZV9u
b2RlKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKTsKIAotCWludGVsX2d1Y19yZWxlYXNlX2dndHRfdG9w
KCZkZXZfcHJpdi0+Z3VjKTsKKwlnZ3R0X3JlbGVhc2VfZ3VjX3RvcChnZ3R0KTsKIAogCWlmIChk
cm1fbW1faW5pdGlhbGl6ZWQoJmdndHQtPnZtLm1tKSkgewogCQlpbnRlbF92Z3RfZGViYWxsb29u
KGRldl9wcml2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmMKaW5kZXggZDQ1ZDk3NjI0NDAyLi5j
NDBhNmVmZGQzM2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCkBAIC02ODUsMzAgKzY4NSwz
IEBAIHN0cnVjdCBpOTE1X3ZtYSAqaW50ZWxfZ3VjX2FsbG9jYXRlX3ZtYShzdHJ1Y3QgaW50ZWxf
Z3VjICpndWMsIHUzMiBzaXplKQogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAlyZXR1cm4g
dm1hOwogfQotCi1pbnQgaW50ZWxfZ3VjX3Jlc2VydmVfZ2d0dF90b3Aoc3RydWN0IGludGVsX2d1
YyAqZ3VjKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUo
Z3VjKTsKLQlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmk5MTUtPmdndHQ7Ci0JdTY0IHNpemU7
Ci0JaW50IHJldDsKLQotCXNpemUgPSBnZ3R0LT52bS50b3RhbCAtIEdVQ19HR1RUX1RPUDsKLQot
CXJldCA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJmdndHQtPnVjX2Z3LCBzaXpl
LAotCQkJCSAgIEdVQ19HR1RUX1RPUCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKLQkJCQkgICBQ
SU5fTk9FVklDVCk7Ci0JaWYgKHJldCkKLQkJRFJNX0RFQlVHX0RSSVZFUigiR3VDOiBmYWlsZWQg
dG8gcmVzZXJ2ZSB0b3Agb2YgZ2d0dFxuIik7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi12b2lkIGlu
dGVsX2d1Y19yZWxlYXNlX2dndHRfdG9wKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKLXsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7Ci0Jc3RydWN0IGk5
MTVfZ2d0dCAqZ2d0dCA9ICZpOTE1LT5nZ3R0OwotCi0JaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRl
ZCgmZ2d0dC0+dWNfZncpKQotCQlkcm1fbW1fcmVtb3ZlX25vZGUoJmdndHQtPnVjX2Z3KTsKLX0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmgKaW5kZXggODVjM2IwMmEwYzA4Li4wOGM5MDZhYmRmYTIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5oCkBAIC0xNzIsOCArMTcyLDYgQEAgaW50IGludGVs
X2d1Y19hdXRoX2h1YyhzdHJ1Y3QgaW50ZWxfZ3VjICpndWMsIHUzMiByc2Ffb2Zmc2V0KTsKIGlu
dCBpbnRlbF9ndWNfc3VzcGVuZChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpOwogaW50IGludGVsX2d1
Y19yZXN1bWUoc3RydWN0IGludGVsX2d1YyAqZ3VjKTsKIHN0cnVjdCBpOTE1X3ZtYSAqaW50ZWxf
Z3VjX2FsbG9jYXRlX3ZtYShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMsIHUzMiBzaXplKTsKLWludCBp
bnRlbF9ndWNfcmVzZXJ2ZV9nZ3R0X3RvcChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpOwotdm9pZCBp
bnRlbF9ndWNfcmVsZWFzZV9nZ3R0X3RvcChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpOwogCiBzdGF0
aWMgaW5saW5lIGJvb2wgaW50ZWxfZ3VjX2lzX2xvYWRlZChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMp
CiB7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

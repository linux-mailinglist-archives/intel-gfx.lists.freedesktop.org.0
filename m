Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 622563B8A9
	for <lists+intel-gfx@lfdr.de>; Mon, 10 Jun 2019 17:54:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6D4D38918E;
	Mon, 10 Jun 2019 15:54:43 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E5D9E89190
 for <Intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 15:54:40 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 10 Jun 2019 08:54:40 -0700
X-ExtLoop1: 1
Received: from jwwillia-mobl1.amr.corp.intel.com (HELO localhost.localdomain)
 ([10.252.8.43])
 by fmsmga001.fm.intel.com with ESMTP; 10 Jun 2019 08:54:39 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Mon, 10 Jun 2019 16:54:17 +0100
Message-Id: <20190610155419.23723-13-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190610155419.23723-1-tvrtko.ursulin@linux.intel.com>
References: <20190610155419.23723-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 12/14] drm/i915: Convert i915_gem_init_hw to
 intel_gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KCk1vcmUgcmVt
b3ZhbCBvZiBpbXBsaWNpdCBkZXZfcHJpdiBmcm9tIHVzaW5nIG9sZCBtbWlvIGFjY2Vzc29ycy4K
CkFjdHVhbGx5IHRoZSB0b3AgbGV2ZWwgZnVuY3Rpb24gcmVtYWlucyBidXQgaXMgc3BsaXQgaW50
byBhIHBhcnQgd2hpY2gKd3JpdGVzIHRvIGk5MTUgYW5kIHBhcnQgd2hpY2ggb3BlcmF0ZXMgb24g
dW5jb3JlIHRvIGluaXRpYWxpemUgdGhlCmhhcmR3YXJlLgoKR3VDIGFuZCBlbmdpbmVzIGFyZSB0
aGUgb25seSBvZGQgb25lcyBvdXQgcmVtYWluaW5nLgoKU2lnbmVkLW9mZi1ieTogVHZydGtvIFVy
c3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jIHwgNjggKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tCiAxIGZp
bGUgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygrKSwgMjcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKaW5kZXggNzJlNTg0MTM2OTA5Li5jYWNjNGZmMWExNjAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwpAQCAtMTIzMCwyOCArMTIzMCwzMCBAQCBzdGF0aWMgdm9pZCBpbml0X3Vu
dXNlZF9yaW5ncyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCX0KIH0KIAotaW50IGk5MTVfZ2VtX2lu
aXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGludCBpbml0
X2h3KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBndF90b19pOTE1KGd0KTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndF90
b191bmNvcmUoZ3QpOwogCWludCByZXQ7CiAKLQlkZXZfcHJpdi0+Z3QubGFzdF9pbml0X3RpbWUg
PSBrdGltZV9nZXQoKTsKLQogCS8qIERvdWJsZSBsYXllciBzZWN1cml0eSBibGFua2V0LCBzZWUg
aTkxNV9nZW1faW5pdCgpICovCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQoJmRldl9wcml2
LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KHVu
Y29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKLQlpZiAoSEFTX0VEUkFNKGRldl9wcml2KSAmJiBJTlRF
TF9HRU4oZGV2X3ByaXYpIDwgOSkKLQkJSTkxNV9XUklURShIU1dfSURJQ1IsIEk5MTVfUkVBRChI
U1dfSURJQ1IpIHwgSURJSEFTSE1TSygweGYpKTsKKwlpZiAoSEFTX0VEUkFNKGk5MTUpICYmIElO
VEVMX0dFTihpOTE1KSA8IDkpCisJCWludGVsX3VuY29yZV9ybXcodW5jb3JlLCBIU1dfSURJQ1Is
IDAsIElESUhBU0hNU0soMHhmKSk7CiAKLQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikpCi0JCUk5
MTVfV1JJVEUoTUlfUFJFRElDQVRFX1JFU1VMVF8yLCBJU19IU1dfR1QzKGRldl9wcml2KSA/Ci0J
CQkgICBMT1dFUl9TTElDRV9FTkFCTEVEIDogTE9XRVJfU0xJQ0VfRElTQUJMRUQpOworCWlmIChJ
U19IQVNXRUxMKGk5MTUpKQorCQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLAorCQkJCSAgIE1J
X1BSRURJQ0FURV9SRVNVTFRfMiwKKwkJCQkgICBJU19IU1dfR1QzKGk5MTUpID8KKwkJCQkgICBM
T1dFUl9TTElDRV9FTkFCTEVEIDogTE9XRVJfU0xJQ0VfRElTQUJMRUQpOwogCiAJLyogQXBwbHkg
dGhlIEdUIHdvcmthcm91bmRzLi4uICovCi0JaW50ZWxfZ3RfYXBwbHlfd29ya2Fyb3VuZHMoJmRl
dl9wcml2LT5ndCk7CisJaW50ZWxfZ3RfYXBwbHlfd29ya2Fyb3VuZHMoZ3QpOwogCS8qIC4uLmFu
ZCBkZXRlcm1pbmUgd2hldGhlciB0aGV5IGFyZSBzdGlja2luZy4gKi8KLQlpbnRlbF9ndF92ZXJp
Znlfd29ya2Fyb3VuZHMoJmRldl9wcml2LT5ndCwgImluaXQiKTsKKwlpbnRlbF9ndF92ZXJpZnlf
d29ya2Fyb3VuZHMoZ3QsICJpbml0Iik7CiAKLQlpbnRlbF9ndF9pbml0X3N3aXp6bGluZygmZGV2
X3ByaXYtPmd0KTsKKwlpbnRlbF9ndF9pbml0X3N3aXp6bGluZyhndCk7CiAKIAkvKgogCSAqIEF0
IGxlYXN0IDgzMCBjYW4gbGVhdmUgc29tZSBvZiB0aGUgdW51c2VkIHJpbmdzCkBAIC0xMjU5LDQ4
ICsxMjYxLDYwIEBAIGludCBpOTE1X2dlbV9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAkgKiB3aWxsIHByZXZlbnQgYzMgZW50cnkuIE1ha2VzIHN1cmUgYWxsIHVu
dXNlZCByaW5ncwogCSAqIGFyZSB0b3RhbGx5IGlkbGUuCiAJICovCi0JaW5pdF91bnVzZWRfcmlu
Z3MoJmRldl9wcml2LT5ndCk7CisJaW5pdF91bnVzZWRfcmluZ3MoZ3QpOwogCi0JQlVHX09OKCFk
ZXZfcHJpdi0+a2VybmVsX2NvbnRleHQpOwotCXJldCA9IGk5MTVfdGVybWluYWxseV93ZWRnZWQo
ZGV2X3ByaXYpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCi0JcmV0ID0gaTkxNV9wcGd0dF9p
bml0X2h3KCZkZXZfcHJpdi0+Z3QpOworCXJldCA9IGk5MTVfcHBndHRfaW5pdF9odyhndCk7CiAJ
aWYgKHJldCkgewogCQlEUk1fRVJST1IoIkVuYWJsaW5nIFBQR1RUIGZhaWxlZCAoJWQpXG4iLCBy
ZXQpOwogCQlnb3RvIG91dDsKIAl9CiAKLQlyZXQgPSBpbnRlbF93b3BjbV9pbml0X2h3KCZkZXZf
cHJpdi0+d29wY20pOworCXJldCA9IGludGVsX3dvcGNtX2luaXRfaHcoJmk5MTUtPndvcGNtKTsK
IAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiRW5hYmxpbmcgV09QQ00gZmFpbGVkICglZClcbiIs
IHJldCk7CiAJCWdvdG8gb3V0OwogCX0KIAogCS8qIFdlIGNhbid0IGVuYWJsZSBjb250ZXh0cyB1
bnRpbCBhbGwgZmlybXdhcmUgaXMgbG9hZGVkICovCi0JcmV0ID0gaW50ZWxfdWNfaW5pdF9odyhk
ZXZfcHJpdik7CisJcmV0ID0gaW50ZWxfdWNfaW5pdF9odyhpOTE1KTsKIAlpZiAocmV0KSB7CiAJ
CURSTV9FUlJPUigiRW5hYmxpbmcgdWMgZmFpbGVkICglZClcbiIsIHJldCk7CiAJCWdvdG8gb3V0
OwogCX0KIAotCWludGVsX21vY3NfaW5pdF9sM2NjX3RhYmxlKCZkZXZfcHJpdi0+Z3QpOworCWlu
dGVsX21vY3NfaW5pdF9sM2NjX3RhYmxlKGd0KTsKIAogCS8qIE9ubHkgd2hlbiB0aGUgSFcgaXMg
cmUtaW5pdGlhbGlzZWQsIGNhbiB3ZSByZXBsYXkgdGhlIHJlcXVlc3RzICovCi0JcmV0ID0gaW50
ZWxfZW5naW5lc19yZXN1bWUoZGV2X3ByaXYpOworCXJldCA9IGludGVsX2VuZ2luZXNfcmVzdW1l
KGk5MTUpOwogCWlmIChyZXQpCiAJCWdvdG8gY2xlYW51cF91YzsKIAotCWludGVsX3VuY29yZV9m
b3JjZXdha2VfcHV0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKwlpbnRlbF91
bmNvcmVfZm9yY2V3YWtlX3B1dCh1bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCi0JaW50ZWxfZW5n
aW5lc19zZXRfc2NoZWR1bGVyX2NhcHMoZGV2X3ByaXYpOwogCXJldHVybiAwOwogCiBjbGVhbnVw
X3VjOgotCWludGVsX3VjX2ZpbmlfaHcoZGV2X3ByaXYpOworCWludGVsX3VjX2ZpbmlfaHcoaTkx
NSk7CiBvdXQ6Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUs
IEZPUkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHVuY29yZSwgRk9S
Q0VXQUtFX0FMTCk7CisKKwlyZXR1cm4gcmV0OworfQorCitpbnQgaTkxNV9nZW1faW5pdF9odyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlpbnQgcmV0OworCisJaTkxNS0+Z3Qu
bGFzdF9pbml0X3RpbWUgPSBrdGltZV9nZXQoKTsKKworCUJVR19PTighaTkxNS0+a2VybmVsX2Nv
bnRleHQpOworCXJldCA9IGk5MTVfdGVybWluYWxseV93ZWRnZWQoaTkxNSk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCXJldCA9IGluaXRfaHcoJmk5MTUtPmd0KTsKKworCWludGVsX2Vu
Z2luZXNfc2V0X3NjaGVkdWxlcl9jYXBzKGk5MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KLS0gCjIu
MjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

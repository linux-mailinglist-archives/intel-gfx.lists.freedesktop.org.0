Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EE141FCA83
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 17:05:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7CE3F6EBD0;
	Thu, 14 Nov 2019 16:05:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2AF156EBD0
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Nov 2019 16:05:27 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Nov 2019 17:05:19 +0100
Message-Id: <20191114160522.9699-8-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
References: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/11] drm/i915: Link planes in a bigjoiner
 configuration, v3.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSBzdXJlIHRoYXQgd2hlbiBhIHBsYW5lIGlzIHNldCBpbiBhIGJpZ2pvaW5lciBtb2RlLCB3
ZSB3aWxsIGFkZAp0aGVpciBjb3VudGVycGFydCB0byB0aGUgYXRvbWljIHN0YXRlIGFzIHdlbGwu
IFRoaXMgd2lsbCBhbGxvdyB1cyB0bwptYWtlIHN1cmUgYWxsIHN0YXRlIGlzIGF2YWlsYWJsZSB3
aGVuIHBsYW5lcyBhcmUgY2hlY2tlZC4KCkJlY2F1c2Ugb2YgdGhlIGZ1bm55IGludGVyYWN0aW9u
cyB3aXRoIGJpZ2pvaW5lciBhbmQgcGxhbmFyIFlVVgpmb3JtYXRzLCB3ZSBtYXkgZW5kIHVwIGFk
ZGluZyBhIGxvdCBvZiBwbGFuZXMsIHNvIHdlIGhhdmUgdG8ga2VlcAppdGVyYXRpbmcgdW50aWwg
d2Ugbm8gbG9uZ2VyIGFkZCBhbnkgcGxhbmVzLgoKQWxzbyBmaXggdGhlIGF0b21pYyBpbnRlbCBw
bGFuZSBpdGVyYXRvciwgc28gdGhpbmdzIHdhdGVybWFya3Mgc3RhcnQKd29ya2luZyBhdXRvbWFn
aWNhbGx5LgoKQ2hhbmdlcyBzaW5jZSB2MToKLSBSZWJhc2Ugb24gdG9wIG9mIHBsYW5lX3N0YXRl
IHNwbGl0LCBjbGVhbmluZyB1cCB0aGUgY29kZSBhIGxvdC4KLSBNYWtlIGludGVsX2F0b21pY19j
cnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKCkgYmlnam9pbmVyIGNhcGFibGUuCi0gQWRk
IGl0ZXIgbWFjcm8gdG8gaW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3Rh
dGUoKSB0bwogIGtlZXAgaXRlcmF0aW9uIHdvcmtpbmcuCkNoYW5nZXMgc2luY2UgdjI6Ci0gQWRk
IGljbF8odW4pc2V0X2JpZ2pvaW5lcl9wbGFuZV9saW5rcywgdG8gbWFrZSBpdCBtb3JlIGNsZWFy
IHdoZXJlCiAgbGlua3MgYXJlIG1hZGUgYW5kIGJyb2tlbi4KClNpZ25lZC1vZmYtYnk6IE1hYXJ0
ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQogLi4u
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jIHwgIDQ3ICsrKy0KIC4u
Li9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuaCB8ICAgMyArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgMjA3ICsrKysrKysr
KysrKysrKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5Lmgg
IHwgIDE4ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAg
fCAgMTEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyAgICAgICAgICAgICAgIHwg
IDE2ICstCiA2IGZpbGVzIGNoYW5nZWQsIDI2OCBpbnNlcnRpb25zKCspLCAzNCBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Y19wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxh
bmUuYwppbmRleCA0MmIzYjM0NDlkMmUuLmIyNmUxMDUxOWNhNCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCkBAIC0xOTAsMTIgKzE5
MCwxNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9jbGVhcl9od19zdGF0ZShzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCW1lbXNldCgmcGxhbmVfc3RhdGUtPmh3LCAw
LCBzaXplb2YocGxhbmVfc3RhdGUtPmh3KSk7CiB9CiAKLXZvaWQgaW50ZWxfcGxhbmVfY29weV91
YXBpX3RvX2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCit2
b2lkIGludGVsX3BsYW5lX2NvcHlfdWFwaV90b19od19zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgICAgICAgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSwKIAkJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpmcm9tX3BsYW5lX3N0YXRlKQogewogCWludGVsX3BsYW5lX2NsZWFyX2h3X3N0YXRlKHBs
YW5lX3N0YXRlKTsKIAotCXBsYW5lX3N0YXRlLT5ody5jcnRjID0gZnJvbV9wbGFuZV9zdGF0ZS0+
dWFwaS5jcnRjOworCWlmIChmcm9tX3BsYW5lX3N0YXRlLT51YXBpLmNydGMpCisJCXBsYW5lX3N0
YXRlLT5ody5jcnRjID0gY3J0Y19zdGF0ZS0+dWFwaS5jcnRjOworCWVsc2UKKwkJcGxhbmVfc3Rh
dGUtPmh3LmNydGMgPSBOVUxMOworCiAJcGxhbmVfc3RhdGUtPmh3LmZiID0gZnJvbV9wbGFuZV9z
dGF0ZS0+dWFwaS5mYjsKIAlpZiAocGxhbmVfc3RhdGUtPmh3LmZiKQogCQlkcm1fZnJhbWVidWZm
ZXJfZ2V0KHBsYW5lX3N0YXRlLT5ody5mYik7CkBAIC0yMTQsMTAgKzIxOSwyMCBAQCBpbnQgaW50
ZWxfcGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm9sZF9jcnRjXwogCQkJCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wbGFu
ZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUo
bmV3X3BsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
Km5ld19tYXN0ZXJfcGxhbmVfc3RhdGUgPSBuZXdfcGxhbmVfc3RhdGU7CisJc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUgPQorCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X3BsYW5l
X3N0YXRlLT51YXBpLnN0YXRlKTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsK
IAlpbnQgcmV0OwogCi0JaW50ZWxfcGxhbmVfY29weV91YXBpX3RvX2h3X3N0YXRlKG5ld19wbGFu
ZV9zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKTsKKwlpZiAobmV3X3BsYW5lX3N0YXRlLT5iaWdqb2lu
ZXJfc2xhdmUpCisJCW5ld19tYXN0ZXJfcGxhbmVfc3RhdGUgPQorCQkJaW50ZWxfYXRvbWljX2dl
dF9uZXdfcGxhbmVfc3RhdGUoc3RhdGUsCisJCQkJbmV3X3BsYW5lX3N0YXRlLT5iaWdqb2luZXJf
cGxhbmUpOworCisJaW50ZWxfcGxhbmVfY29weV91YXBpX3RvX2h3X3N0YXRlKG5ld19jcnRjX3N0
YXRlLAorCQkJCQkgIG5ld19wbGFuZV9zdGF0ZSwKKwkJCQkJICBuZXdfbWFzdGVyX3BsYW5lX3N0
YXRlKTsKIAlmYiA9IG5ld19wbGFuZV9zdGF0ZS0+aHcuZmI7CiAKIAluZXdfY3J0Y19zdGF0ZS0+
YWN0aXZlX3BsYW5lcyAmPSB+QklUKHBsYW5lLT5pZCk7CkBAIC0yNTcsMTUgKzI3MiwzNiBAQCBp
bnQgaW50ZWxfcGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm9sZF9jcnRjXwogfQogCiBzdGF0aWMgc3RydWN0IGludGVsX2NydGMgKgot
Z2V0X2NydGNfZnJvbV9zdGF0ZXMoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRf
cGxhbmVfc3RhdGUsCitnZXRfY3J0Y19mcm9tX3N0YXRlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSwKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm9sZF9w
bGFuZV9zdGF0ZSwKIAkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19w
bGFuZV9zdGF0ZSkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKG5ld19wbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CisKIAlpZiAobmV3X3BsYW5l
X3N0YXRlLT51YXBpLmNydGMpCiAJCXJldHVybiB0b19pbnRlbF9jcnRjKG5ld19wbGFuZV9zdGF0
ZS0+dWFwaS5jcnRjKTsKIAogCWlmIChvbGRfcGxhbmVfc3RhdGUtPnVhcGkuY3J0YykKIAkJcmV0
dXJuIHRvX2ludGVsX2NydGMob2xkX3BsYW5lX3N0YXRlLT51YXBpLmNydGMpOwogCisJaWYgKG5l
d19wbGFuZV9zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKSB7CisJCWNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqbmV3X21hc3Rlcl9wbGFuZV9zdGF0ZSA9CisJCQlpbnRlbF9hdG9taWNfZ2V0
X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwgbmV3X3BsYW5lX3N0YXRlLT5iaWdqb2luZXJfcGxhbmUp
OworCisJCS8qIG5lZWQgdG8gdXNlIHVhcGkgaGVyZSwgbmV3X21hc3Rlcl9wbGFuZV9zdGF0ZSBt
aWdodCBub3QgYmUgY29waWVkIHRvIGh3IHlldCAqLworCQlpZiAobmV3X21hc3Rlcl9wbGFuZV9z
dGF0ZS0+dWFwaS5jcnRjKQorCQkJcmV0dXJuIGludGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9w
cml2LCBwbGFuZS0+cGlwZSk7CisJfQorCisJaWYgKG9sZF9wbGFuZV9zdGF0ZS0+Ymlnam9pbmVy
X3NsYXZlKSB7CisJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqb2xkX21hc3Rlcl9w
bGFuZV9zdGF0ZSA9CisJCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9wbGFuZV9zdGF0ZShzdGF0ZSwg
b2xkX3BsYW5lX3N0YXRlLT5iaWdqb2luZXJfcGxhbmUpOworCisJCWlmIChvbGRfbWFzdGVyX3Bs
YW5lX3N0YXRlLT51YXBpLmNydGMpCisJCQlyZXR1cm4gaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUo
ZGV2X3ByaXYsIHBsYW5lLT5waXBlKTsKKwl9CisKIAlyZXR1cm4gTlVMTDsKIH0KIApAQCAtMjc3
LDcgKzMxMyw4IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2hlY2soc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUsCiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRf
cGxhbmVfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9wbGFuZV9zdGF0ZShzdGF0ZSwg
cGxhbmUpOwogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0KLQkJZ2V0X2NydGNfZnJvbV9zdGF0
ZXMob2xkX3BsYW5lX3N0YXRlLCBuZXdfcGxhbmVfc3RhdGUpOworCQlnZXRfY3J0Y19mcm9tX3N0
YXRlcyhzdGF0ZSwgb2xkX3BsYW5lX3N0YXRlLAorCQkJCSAgICAgbmV3X3BsYW5lX3N0YXRlKTsK
IAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGU7CiAJc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuaAppbmRleCA1Y2VkYWZkZGRiNTUu
LjMxMjlmYWEzMGViNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9hdG9taWNfcGxhbmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2F0b21pY19wbGFuZS5oCkBAIC0yMCw3ICsyMCw4IEBAIGV4dGVybiBjb25zdCBzdHJ1Y3Qg
ZHJtX3BsYW5lX2hlbHBlcl9mdW5jcyBpbnRlbF9wbGFuZV9oZWxwZXJfZnVuY3M7CiAKIHVuc2ln
bmVkIGludCBpbnRlbF9wbGFuZV9kYXRhX3JhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSk7Ci12b2lkIGludGVsX3BsYW5lX2NvcHlfdWFwaV90b19od19zdGF0ZShzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAordm9pZCBpbnRlbF9wbGFuZV9jb3B5
X3VhcGlfdG9faHdfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCisJCQkJICAgICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJ
CQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqZnJvbV9wbGFuZV9zdGF0
ZSk7CiB2b2lkIGludGVsX3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAog
CQkJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGIxMDg1ZWYzZjFkMC4u
NTljNjA0MzY0MTBjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXkuYwpAQCAtMzMyNyw3ICszMzI3LDcgQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29i
aihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAogCXBsYW5lX3N0YXRlLT5mYiA9IGZi
OwogCXBsYW5lX3N0YXRlLT5jcnRjID0gJmludGVsX2NydGMtPmJhc2U7Ci0JaW50ZWxfcGxhbmVf
Y29weV91YXBpX3RvX2h3X3N0YXRlKGludGVsX3N0YXRlLCBpbnRlbF9zdGF0ZSk7CisJaW50ZWxf
cGxhbmVfY29weV91YXBpX3RvX2h3X3N0YXRlKGNydGNfc3RhdGUsIGludGVsX3N0YXRlLCBpbnRl
bF9zdGF0ZSk7CiAKIAlhdG9taWNfb3IodG9faW50ZWxfcGxhbmUocHJpbWFyeSktPmZyb250YnVm
ZmVyX2JpdCwKIAkJICAmdG9faW50ZWxfZnJvbnRidWZmZXIoZmIpLT5iaXRzKTsKQEAgLTEyMDgy
LDI0ICsxMjA4MiwxODAgQEAgc3RhdGljIGJvb2wgY2hlY2tfc2luZ2xlX2VuY29kZXJfY2xvbmlu
ZyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlyZXR1cm4gdHJ1ZTsKIH0KIAor
c3RhdGljIGludCBpY2xfdW5zZXRfYmlnam9pbmVyX3BsYW5lX2xpbmtzKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2NydGNfc3RhdGUpCit7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7
CisKKwkvKgorCSAqIFRlYXJkb3duIHRoZSBvbGQgYmlnam9pbmVyIHBsYW5lIG1hcHBpbmdzLgor
CSAqLworCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoY3J0Yy0+YmFzZS5kZXYsIGNydGMs
IHBsYW5lKSB7CisJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsICpvdGhl
cl9wbGFuZV9zdGF0ZTsKKwkJc3RydWN0IGludGVsX3BsYW5lICpvdGhlcl9wbGFuZTsKKworCQlw
bGFuZV9zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfcGxhbmVfc3RhdGUoc3RhdGUsIHBsYW5lKTsK
KwkJaWYgKElTX0VSUihwbGFuZV9zdGF0ZSkpCisJCQlyZXR1cm4gUFRSX0VSUihwbGFuZV9zdGF0
ZSk7CisKKwkJb3RoZXJfcGxhbmUgPSBwbGFuZV9zdGF0ZS0+Ymlnam9pbmVyX3BsYW5lOworCQlp
ZiAoIW90aGVyX3BsYW5lKQorCQkJY29udGludWU7CisKKwkJcGxhbmVfc3RhdGUtPmJpZ2pvaW5l
cl9wbGFuZSA9IE5VTEw7CisJCXBsYW5lX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUgPSBmYWxzZTsK
KworCQlvdGhlcl9wbGFuZV9zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfcGxhbmVfc3RhdGUoc3Rh
dGUsIG90aGVyX3BsYW5lKTsKKwkJaWYgKElTX0VSUihvdGhlcl9wbGFuZV9zdGF0ZSkpCisJCQly
ZXR1cm4gUFRSX0VSUihvdGhlcl9wbGFuZV9zdGF0ZSk7CisJCW90aGVyX3BsYW5lX3N0YXRlLT5i
aWdqb2luZXJfcGxhbmUgPSBOVUxMOworCQlvdGhlcl9wbGFuZV9zdGF0ZS0+Ymlnam9pbmVyX3Ns
YXZlID0gZmFsc2U7CisJfQorCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGljbF9zZXRfYmln
am9pbmVyX3BsYW5lX2xpbmtzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJ
CQkgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQoreworCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBpbnRlbF9jcnRjICpvdGhl
cl9jcnRjID0gbmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YzsKKworCS8qCisJ
ICogU2V0dXAgYW5kIHRlYXJkb3duIHRoZSBuZXcgYmlnam9pbmVyIHBsYW5lIG1hcHBpbmdzLgor
CSAqLworCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoY3J0Yy0+YmFzZS5kZXYsIGNydGMs
IHBsYW5lKSB7CisJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CisJCXN0
cnVjdCBpbnRlbF9wbGFuZSAqb3RoZXJfcGxhbmUgPSBOVUxMOworCQlib29sIGZvdW5kX3BsYW5l
ID0gZmFsc2U7CisKKwkJcGxhbmVfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X3BsYW5lX3N0YXRl
KHN0YXRlLCBwbGFuZSk7CisJCWlmIChJU19FUlIocGxhbmVfc3RhdGUpKQorCQkJcmV0dXJuIFBU
Ul9FUlIocGxhbmVfc3RhdGUpOworCisJCWZvcl9lYWNoX2ludGVsX3BsYW5lX29uX2NydGMoY3J0
Yy0+YmFzZS5kZXYsIG90aGVyX2NydGMsIG90aGVyX3BsYW5lKSB7CisJCQlpZiAob3RoZXJfcGxh
bmUtPmlkICE9IHBsYW5lLT5pZCkKKwkJCQljb250aW51ZTsKKworCQkJcGxhbmVfc3RhdGUtPmJp
Z2pvaW5lcl9wbGFuZSA9IG90aGVyX3BsYW5lOworCQkJcGxhbmVfc3RhdGUtPmJpZ2pvaW5lcl9z
bGF2ZSA9IG5ld19jcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmU7CisKKwkJCXBsYW5lX3N0YXRl
ID0gaW50ZWxfYXRvbWljX2dldF9wbGFuZV9zdGF0ZShzdGF0ZSwgb3RoZXJfcGxhbmUpOworCQkJ
aWYgKElTX0VSUihwbGFuZV9zdGF0ZSkpCisJCQkJcmV0dXJuIFBUUl9FUlIocGxhbmVfc3RhdGUp
OworCisJCQlwbGFuZV9zdGF0ZS0+Ymlnam9pbmVyX3BsYW5lID0gcGxhbmU7CisJCQlwbGFuZV9z
dGF0ZS0+Ymlnam9pbmVyX3NsYXZlID0gIW5ld19jcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmU7
CisKKwkJCWZvdW5kX3BsYW5lID0gdHJ1ZTsKKwkJCWJyZWFrOworCQl9CisKKwkJaWYgKCFmb3Vu
ZF9wbGFuZSkgeworCQkJLyogQWxsIHBpcGVzIHNob3VsZCBoYXZlIGlkZW50aWNhbCBwbGFuZXMu
ICovCisJCQlXQVJOX09OKCFmb3VuZF9wbGFuZSk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQor
CX0KKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBpY2xfYWRkX2RlcGVuZGVudF9wbGFuZXMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJICAgIHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpu
ZXdfcGxhbmVfc3RhdGU7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKKwlpbnQgcmV0ID0g
MDsKKworCXBsYW5lID0gcGxhbmVfc3RhdGUtPmJpZ2pvaW5lcl9wbGFuZTsKKwlpZiAocGxhbmUg
JiYgIWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBwbGFuZSkpIHsKKwkJ
bmV3X3BsYW5lX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9wbGFuZV9zdGF0ZShzdGF0ZSwgcGxh
bmUpOworCQlpZiAoSVNfRVJSKG5ld19wbGFuZV9zdGF0ZSkpCisJCQlyZXR1cm4gUFRSX0VSUihu
ZXdfcGxhbmVfc3RhdGUpOworCisJCXJldCA9IDE7CisJfQorCisJcGxhbmUgPSBwbGFuZV9zdGF0
ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZTsKKwlpZiAocGxhbmUgJiYgIWludGVsX2F0b21pY19nZXRf
bmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBwbGFuZSkpIHsKKwkJbmV3X3BsYW5lX3N0YXRlID0gaW50
ZWxfYXRvbWljX2dldF9wbGFuZV9zdGF0ZShzdGF0ZSwgcGxhbmUpOworCQlpZiAoSVNfRVJSKG5l
d19wbGFuZV9zdGF0ZSkpCisJCQlyZXR1cm4gUFRSX0VSUihuZXdfcGxhbmVfc3RhdGUpOworCisJ
CXJldCA9IDE7CisJfQorCisJcmV0dXJuIHJldDsKK30KKwogc3RhdGljIGludCBpY2xfYWRkX2xp
bmtlZF9wbGFuZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwgKmxpbmtlZDsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlLCAqbGlua2VkX3BsYW5lX3N0YXRlOworCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmU7CisJc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsICpuZXdf
cGxhbmVfc3RhdGU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMsICpsaW5rZWRfY3J0YzsKKwlz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZSwg
KmxpbmtlZF9jcnRjX3N0YXRlOworCWJvb2wgYWRkZWQ7CiAJaW50IGk7CiAKLQlmb3JfZWFjaF9u
ZXdfaW50ZWxfcGxhbmVfaW5fc3RhdGUoc3RhdGUsIHBsYW5lLCBwbGFuZV9zdGF0ZSwgaSkgewot
CQlsaW5rZWQgPSBwbGFuZV9zdGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZTsKKwkvKgorCSAqIEl0
ZXJhdGl2ZWx5IGFkZCBwbGFuZV9zdGF0ZS0+bGlua2VkX3BsYW5lIGFuZCBwbGFuZV9zdGF0ZS0+
Ymlnam9pbmVyX3BsYW5lCisJICoKKwkgKiBUaGlzIG5lZWRzIHRvIGJlIGRvbmUgcmVwZWF0ZWRs
eSwgYmVjYXVzZSBvZiBpcyBhIGZ1bm55IGludGVyYWN0aW9uOworCSAqIHRoZSBZLXBsYW5lIG1h
eSBiZSBhc3NpZ25lZCBkaWZmZXJlbnRseSBvbiB0aGUgb3RoZXIgYmlnam9pbmVyIGNydGMsCisJ
ICogYW5kIHdlIGNvdWxkIGVuZCB1cCB3aXRoIHRoZSBmb2xsb3dpbmcgZXZpbCByZWN1cnNpb24s
IHdoZW4gb25seSBhZGRpbmcgYQorCSAqIHNpbmdsZSBwbGFuZSB0byBzdGF0ZToKKwkgKgorCSAq
IFhSR0I4ODg4IG1hc3RlciBwbGFuZSA2IGFkZHMgTlYxMiBzbGF2ZSBZLXBsYW5lIDYsIHdoaWNo
IGFkZHMgc2xhdmUgVVYgcGxhbmUgMCwKKwkgKiB3aGljaCBhZGRzIG1hc3RlciBVViBwbGFuZSAw
LCB3aGljaCBhZGRzIG1hc3RlciBZLXBsYW5lIDcsIHdoaWNoIGFkZHMgWFJHQjg4ODgKKwkgKiBz
bGF2ZSBwbGFuZSA3LgorCSAqCisJICogV2UgY291bGQgcHVsbCBpbiBldmVuIG1vcmUgYmVjYXVz
ZSBvZiBvbGRfcGxhbmVfc3RhdGUgdnMgbmV3X3BsYW5lX3N0YXRlLgorCSAqCisJICogTWF4IGRl
cHRoID0gNSAob3IgNyBmb3IgZXZpbCBjYXNlKSBpbiB0aGlzIGNhc2UuCisJICogTnVtYmVyIG9m
IHBhc3NlcyB3aWxsIGJlIGxlc3MsIGJlY2F1c2UgbmV3bHkgYWRkZWQgcGxhbmVzIHNob3cgdXAg
aW4gdGhlCisJICogc2FtZSBpdGVyYXRpb24gcm91bmQgd2hlbiBhZGRlZF9wbGFuZS0+aW5kZXgg
PiBwbGFuZS0+aW5kZXguCisJICovCisJZG8geworCQlhZGRlZCA9IGZhbHNlOwogCi0JCWlmICgh
bGlua2VkKQotCQkJY29udGludWU7CisJCWZvcl9lYWNoX29sZG5ld19pbnRlbF9wbGFuZV9pbl9z
dGF0ZShzdGF0ZSwgcGxhbmUsIG9sZF9wbGFuZV9zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlLCBpKSB7
CisJCQlpbnQgcmV0LCByZXQyOworCisJCQlyZXQgPSBpY2xfYWRkX2RlcGVuZGVudF9wbGFuZXMo
c3RhdGUsIG9sZF9wbGFuZV9zdGF0ZSk7CisJCQlpZiAocmV0IDwgMCkKKwkJCQlyZXR1cm4gcmV0
OworCisJCQlyZXQyID0gaWNsX2FkZF9kZXBlbmRlbnRfcGxhbmVzKHN0YXRlLCBuZXdfcGxhbmVf
c3RhdGUpOworCQkJaWYgKHJldDIgPCAwKQorCQkJCXJldHVybiByZXQyOworCisJCQlhZGRlZCB8
PSByZXQgfHwgcmV0MjsKKwkJfQorCX0gd2hpbGUgKGFkZGVkKTsKKworCS8qCisJICogTWFrZSBz
dXJlIGJpZ2pvaW5lciBzbGF2ZSBjcnRjJ3MgYXJlIGFsc28gcHVsbGVkIGluLiBUaGlzIGlzIG5v
dCBkb25lIGF1dG9tYXRpY2FsbHkKKwkgKiB3aGVuIGFkZGluZyBzbGF2ZSBwbGFuZXMsIGJlY2F1
c2UgcGxhbmVfc3RhdGUtPmNydGMgaXMgbnVsbC4KKwkgKi8KKwlmb3JfZWFjaF9vbGRuZXdfaW50
ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0
YXRlLCBpKSB7CisJCWxpbmtlZF9jcnRjID0gb2xkX2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5r
ZWRfY3J0YzsKKwkJaWYgKGxpbmtlZF9jcnRjKSB7CisJCQlsaW5rZWRfY3J0Y19zdGF0ZSA9CisJ
CQkJaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgbGlua2VkX2NydGMp
OworCisJCQlpZiAoSVNfRVJSKGxpbmtlZF9jcnRjX3N0YXRlKSkKKwkJCQlyZXR1cm4gUFRSX0VS
UihsaW5rZWRfY3J0Y19zdGF0ZSk7CisJCX0KIAotCQlsaW5rZWRfcGxhbmVfc3RhdGUgPSBpbnRl
bF9hdG9taWNfZ2V0X3BsYW5lX3N0YXRlKHN0YXRlLCBsaW5rZWQpOwotCQlpZiAoSVNfRVJSKGxp
bmtlZF9wbGFuZV9zdGF0ZSkpCi0JCQlyZXR1cm4gUFRSX0VSUihsaW5rZWRfcGxhbmVfc3RhdGUp
OworCQlsaW5rZWRfY3J0YyA9IG5ld19jcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7
CisJCWlmIChsaW5rZWRfY3J0YyAmJiBsaW5rZWRfY3J0YyAhPSBvbGRfY3J0Y19zdGF0ZS0+Ymln
am9pbmVyX2xpbmtlZF9jcnRjKSB7CisJCQlsaW5rZWRfY3J0Y19zdGF0ZSA9CisJCQkJaW50ZWxf
YXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgbGlua2VkX2NydGMpOwogCi0JCVdB
Uk5fT04obGlua2VkX3BsYW5lX3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lICE9IHBsYW5lKTsK
LQkJV0FSTl9PTihsaW5rZWRfcGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSA9PSBwbGFuZV9zdGF0
ZS0+cGxhbmFyX3NsYXZlKTsKKwkJCWlmIChJU19FUlIobGlua2VkX2NydGNfc3RhdGUpKQorCQkJ
CXJldHVybiBQVFJfRVJSKGxpbmtlZF9jcnRjX3N0YXRlKTsKKwkJfQogCX0KIAogCXJldHVybiAw
OwpAQCAtMTIxMzksNiArMTIyOTUsNyBAQCBzdGF0aWMgaW50IGljbF9jaGVja19udjEyX3BsYW5l
cyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogCWZvcl9lYWNoX25ld19p
bnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwgcGxhbmUsIHBsYW5lX3N0YXRlLCBpKSB7CiAJCXN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbGlua2VkX3N0YXRlID0gTlVMTDsKKwkJc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGU7CiAKIAkJaWYgKHBsYW5lLT5waXBl
ICE9IGNydGMtPnBpcGUgfHwKIAkJICAgICEoY3J0Y19zdGF0ZS0+bnYxMl9wbGFuZXMgJiBCSVQo
cGxhbmUtPmlkKSkpCkBAIC0xMjE3OCw3ICsxMjMzNSwxNCBAQCBzdGF0aWMgaW50IGljbF9jaGVj
a19udjEyX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJbGlu
a2VkX3N0YXRlLT5jb2xvcl9jdGwgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfY3RsOwogCQlsaW5rZWRf
c3RhdGUtPmNvbG9yX3BsYW5lWzBdID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdOwogCi0J
CWludGVsX3BsYW5lX2NvcHlfdWFwaV90b19od19zdGF0ZShsaW5rZWRfc3RhdGUsIHBsYW5lX3N0
YXRlKTsKKwkJbWFzdGVyX3BsYW5lX3N0YXRlID0gcGxhbmVfc3RhdGU7CisJCWlmIChwbGFuZV9z
dGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQkJbWFzdGVyX3BsYW5lX3N0YXRlID0KKwkJCQlpbnRl
bF9hdG9taWNfZ2V0X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwKKwkJCQkJcGxhbmVfc3RhdGUtPmJp
Z2pvaW5lcl9wbGFuZSk7CisKKwkJaW50ZWxfcGxhbmVfY29weV91YXBpX3RvX2h3X3N0YXRlKGNy
dGNfc3RhdGUsIGxpbmtlZF9zdGF0ZSwKKwkJCQkJCSAgbWFzdGVyX3BsYW5lX3N0YXRlKTsKIAkJ
bGlua2VkX3N0YXRlLT51YXBpLnNyYyA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYzsKIAkJbGlua2Vk
X3N0YXRlLT51YXBpLmRzdCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdDsKIApAQCAtMTQzMTUsNiAr
MTQ0NzksNyBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jaGVja19iaWdqb2luZXIoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpzbGF2ZV9jcnRjX3N0YXRlLCAqbWFzdGVyX2NydGNfc3RhdGU7CiAJc3RydWN0IGludGVs
X2NydGMgKnNsYXZlLCAqbWFzdGVyOworCWludCByZXQ7CiAKIAkvKiBzbGF2ZSBiZWluZyBlbmFi
bGVkLCBpcyBtYXN0ZXIgaXMgc3RpbGwgY2xhaW1pbmcgdGhpcyBjcnRjPyAqLwogCWlmIChvbGRf
Y3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKSB7CkBAIC0xNDMyNSw2ICsxNDQ5MCwxMiBAQCBz
dGF0aWMgaW50IGludGVsX2F0b21pY19jaGVja19iaWdqb2luZXIoc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUsCiAJCQlnb3RvIGNsYWltZWQ7CiAJfQogCisJaWYgKG9sZF9jcnRjX3N0
YXRlLT5iaWdqb2luZXIpIHsKKwkJcmV0ID0gaWNsX3Vuc2V0X2JpZ2pvaW5lcl9wbGFuZV9saW5r
cyhzdGF0ZSwgbmV3X2NydGNfc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9
CisKIAlpZiAoIW5ld19jcnRjX3N0YXRlLT5iaWdqb2luZXIpCiAJCXJldHVybiAwOwogCkBAIC0x
NDM0OCw3ICsxNDUxOSwxMiBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jaGVja19iaWdqb2lu
ZXIoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAKIAlEUk1fREVCVUdfS01TKCJb
Q1JUQzolZDolc10gVXNlZCBhcyBzbGF2ZSBmb3IgYmlnIGpvaW5lclxuIiwKIAkJICAgICAgc2xh
dmUtPmJhc2UuYmFzZS5pZCwgc2xhdmUtPmJhc2UubmFtZSk7Ci0JcmV0dXJuIGNvcHlfYmlnam9p
bmVyX2NydGNfc3RhdGUoc2xhdmVfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOworCisJcmV0
ID0gY29weV9iaWdqb2luZXJfY3J0Y19zdGF0ZShzbGF2ZV9jcnRjX3N0YXRlLCBuZXdfY3J0Y19z
dGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiBpY2xfc2V0X2JpZ2pv
aW5lcl9wbGFuZV9saW5rcyhzdGF0ZSwgbmV3X2NydGNfc3RhdGUpOwogCiBjbGFpbWVkOgogCURS
TV9ERUJVR19LTVMoIltDUlRDOiVkOiVzXSBTbGF2ZSBpcyBlbmFibGVkIGFzIG5vcm1hbCBDUlRD
LCBidXQgIgpAQCAtMTQzNzIsNyArMTQ1NDgsOCBAQCBzdGF0aWMgaW50IGtpbGxfYmlnam9pbmVy
X3NsYXZlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCXNsYXZlX2NydGNfc3Rh
dGUtPmJpZ2pvaW5lcl9zbGF2ZSA9IG1hc3Rlcl9jcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUg
PSBmYWxzZTsKIAlzbGF2ZV9jcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGMgPSBtYXN0
ZXJfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjID0gTlVMTDsKIAlpbnRlbF9jcnRj
X2NvcHlfdWFwaV90b19od19zdGF0ZShzdGF0ZSwgc2xhdmVfY3J0Y19zdGF0ZSk7Ci0JcmV0dXJu
IDA7CisKKwlyZXR1cm4gaWNsX3Vuc2V0X2JpZ2pvaW5lcl9wbGFuZV9saW5rcyhzdGF0ZSwgc2xh
dmVfY3J0Y19zdGF0ZSk7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuaAppbmRleCBhNWVjNWVlZmYwNTYuLjNhYWUxNzE3NTkxMyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTQ0NywxMiAr
NDQ3LDIwIEBAIGVudW0gcGh5X2ZpYSB7CiAJCWZvcl9lYWNoX2lmKGNydGMpCiAKICNkZWZpbmUg
aW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUoIFwKLQkJICBwbGFu
ZSwgcGxhbmVfc3RhdGUsIFwKKwkJICBwbGFuZSwgaXRlciwgcGxhbmVfc3RhdGUsIFwKIAkJICBj
cnRjX3N0YXRlKSBcCi0JZm9yX2VhY2hfaW50ZWxfcGxhbmVfbWFzaygoKGNydGNfc3RhdGUpLT51
YXBpLnN0YXRlLT5kZXYpLCAocGxhbmUpLCBcCi0JCQkJKChjcnRjX3N0YXRlKS0+dWFwaS5wbGFu
ZV9tYXNrKSkgXAotCQlmb3JfZWFjaF9pZiAoKHBsYW5lX3N0YXRlID0gXAotCQkJICAgICAgdG9f
aW50ZWxfcGxhbmVfc3RhdGUoX19kcm1fYXRvbWljX2dldF9jdXJyZW50X3BsYW5lX3N0YXRlKChj
cnRjX3N0YXRlKS0+dWFwaS5zdGF0ZSwgJnBsYW5lLT5iYXNlKSkpKQorCWZvcl9lYWNoX2ludGVs
X3BsYW5lX21hc2soKChjcnRjX3N0YXRlKS0+dWFwaS5zdGF0ZS0+ZGV2KSwgKGl0ZXIpLCBcCisJ
CSAgKCgoY3J0Y19zdGF0ZSktPmJpZ2pvaW5lcl9zbGF2ZSA/IFwKKwkJCWludGVsX2F0b21pY19n
ZXRfbmV3X2NydGNfc3RhdGUoIFwKKwkJCQl0b19pbnRlbF9hdG9taWNfc3RhdGUoKGNydGNfc3Rh
dGUpLT51YXBpLnN0YXRlKSwgXAorCQkJCShjcnRjX3N0YXRlKS0+Ymlnam9pbmVyX2xpbmtlZF9j
cnRjKSA6IFwKKwkJCQkoY3J0Y19zdGF0ZSkpLT51YXBpLnBsYW5lX21hc2spKSBcCisJCWZvcl9l
YWNoX2lmICgoKChwbGFuZV9zdGF0ZSkgPSBcCisJCQkgICAgICB0b19pbnRlbF9wbGFuZV9zdGF0
ZShfX2RybV9hdG9taWNfZ2V0X2N1cnJlbnRfcGxhbmVfc3RhdGUoKGNydGNfc3RhdGUpLT51YXBp
LnN0YXRlLCAmaXRlci0+YmFzZSkpKSwgXAorCQkJICAgICAgKChwbGFuZSkgPSAocGxhbmVfc3Rh
dGUpLT5iaWdqb2luZXJfc2xhdmUgPyAocGxhbmVfc3RhdGUpLT5iaWdqb2luZXJfcGxhbmUgOiAo
aXRlcikpLCBcCisJCQkgICAgICAoKHBsYW5lX3N0YXRlKSA9IChwbGFuZV9zdGF0ZSktPmJpZ2pv
aW5lcl9zbGF2ZSA/IFwKKwkJCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShfX2RybV9hdG9taWNfZ2V0
X2N1cnJlbnRfcGxhbmVfc3RhdGUoKGNydGNfc3RhdGUpLT51YXBpLnN0YXRlLCAmcGxhbmUtPmJh
c2UpKSA6IFwKKwkJCQkgIChwbGFuZV9zdGF0ZSkpKSkKIAogI2RlZmluZSBmb3JfZWFjaF9uZXdf
aW50ZWxfY29ubmVjdG9yX2luX3N0YXRlKF9fc3RhdGUsIGNvbm5lY3RvciwgbmV3X2Nvbm5lY3Rv
cl9zdGF0ZSwgX19pKSBcCiAJZm9yICgoX19pKSA9IDA7IFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggODZhMDUyNGIzY2Q4
Li4yYmI3MTQ1MWU3ZGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC01OTYsNiArNTk2LDE3IEBAIHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSB7CiAJICovCiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuYXJfbGlua2VkX3Bs
YW5lOwogCisJLyoKKwkgKiBiaWdqb2luZXJfcGxhbmU6CisJICoKKwkgKiBXaGVuIDIgcGlwZXMg
YXJlIGpvaW5lZCBpbiBhIGJpZ2pvaW5lciBjb25maWd1cmF0aW9uLAorCSAqIHBvaW50cyB0byB0
aGUgc2FtZSBwbGFuZSBvbiB0aGUgb3RoZXIgcGlwZS4KKwkgKgorCSAqIGJpZ2pvaW5lcl9zbGF2
ZSBpcyBzZXQgb24gdGhlIHNsYXZlIHBpcGUuCisJICovCisJc3RydWN0IGludGVsX3BsYW5lICpi
aWdqb2luZXJfcGxhbmU7CisJdTMyIGJpZ2pvaW5lcl9zbGF2ZTsKKwogCS8qCiAJICogcGxhbmFy
X3NsYXZlOgogCSAqIElmIHNldCBkb24ndCB1cGRhdGUgdXNlIHRoZSBsaW5rZWQgcGxhbmUncyBz
dGF0ZSBmb3IgdXBkYXRpbmcKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IDc4MGZmMzhiNmFh
MS4uMWJmMzA0ZTNlYmJkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9w
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTMwODUsNyArMzA4
NSw3IEBAIHN0YXRpYyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
aW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1
Y3QgaW50ZWxfcGlwZV93bSAqcGlwZV93bTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwor
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsICppdGVyOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwcmlzdGF0ZSA9IE5VTEw7CiAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzcHJz
dGF0ZSA9IE5VTEw7CkBAIC0zMDk1LDcgKzMwOTUsNyBAQCBzdGF0aWMgaW50IGlsa19jb21wdXRl
X3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIAlwaXBlX3dt
ID0gJmNydGNfc3RhdGUtPndtLmlsay5vcHRpbWFsOwogCi0JaW50ZWxfYXRvbWljX2NydGNfc3Rh
dGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlKSB7
CisJaW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIGl0
ZXIsIHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlKSB7CiAJCWlmIChwbGFuZS0+YmFzZS50eXBlID09
IERSTV9QTEFORV9UWVBFX1BSSU1BUlkpCiAJCQlwcmlzdGF0ZSA9IHBsYW5lX3N0YXRlOwogCQll
bHNlIGlmIChwbGFuZS0+YmFzZS50eXBlID09IERSTV9QTEFORV9UWVBFX09WRVJMQVkpCkBAIC00
MTQ2LDcgKzQxNDYsNyBAQCBza2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgdTY0ICp1dl9wbGFuZV9kYXRhX3Jh
dGUpCiB7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3J0Y19zdGF0ZS0+dWFw
aS5zdGF0ZTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOworCXN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUsICppdGVyOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGU7CiAJdTY0IHRvdGFsX2RhdGFfcmF0ZSA9IDA7CiAKQEAgLTQxNTQsNyArNDE1NCw3IEBA
IHNrbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQlyZXR1cm4gMDsKIAogCS8qIENhbGN1bGF0ZSBhbmQgY2FjaGUgZGF0
YSByYXRlIGZvciBlYWNoIHBsYW5lICovCi0JaW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2Vh
Y2hfcGxhbmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlKSB7CisJaW50ZWxf
YXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIGl0ZXIsIHBsYW5l
X3N0YXRlLCBjcnRjX3N0YXRlKSB7CiAJCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+
aWQ7CiAJCXU2NCByYXRlOwogCkBAIC00MTc2LDcgKzQxNzYsNyBAQCBzdGF0aWMgdTY0CiBpY2xf
Z2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIAkJCQkgdTY0ICpwbGFuZV9kYXRhX3JhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLCAqaXRlcjsKIAljb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOwogCXU2NCB0b3RhbF9kYXRhX3Jh
dGUgPSAwOwogCkBAIC00MTg0LDcgKzQxODQsNyBAQCBpY2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2Rh
dGFfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIDA7
CiAKIAkvKiBDYWxjdWxhdGUgYW5kIGNhY2hlIGRhdGEgcmF0ZSBmb3IgZWFjaCBwbGFuZSAqLwot
CWludGVsX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBwbGFu
ZV9zdGF0ZSwgY3J0Y19zdGF0ZSkgeworCWludGVsX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNo
X3BsYW5lX3N0YXRlKHBsYW5lLCBpdGVyLCBwbGFuZV9zdGF0ZSwgY3J0Y19zdGF0ZSkgewogCQll
bnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCQl1NjQgcmF0ZTsKIApAQCAtNDk3
NSw3ICs0OTc1LDcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGlwZV93bShzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3Qgc2ts
X3BpcGVfd20gKnBpcGVfd20gPSAmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWw7Ci0Jc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLCAqaXRlcjsK
IAljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOwogCWludCByZXQ7
CiAKQEAgLTQ5ODUsNyArNDk4NSw3IEBAIHN0YXRpYyBpbnQgc2tsX2J1aWxkX3BpcGVfd20oc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICovCiAJbWVtc2V0KHBpcGVfd20t
PnBsYW5lcywgMCwgc2l6ZW9mKHBpcGVfd20tPnBsYW5lcykpOwogCi0JaW50ZWxfYXRvbWljX2Ny
dGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLAorCWludGVs
X2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBpdGVyLCBwbGFu
ZV9zdGF0ZSwKIAkJCQkJCSAgICAgY3J0Y19zdGF0ZSkgewogCiAJCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDExKQotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9pbnRlbC1nZng=

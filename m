Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CBE3F106FD
	for <lists+intel-gfx@lfdr.de>; Wed,  1 May 2019 12:32:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3350E8935B;
	Wed,  1 May 2019 10:32:10 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4AA158935B
 for <intel-gfx@lists.freedesktop.org>; Wed,  1 May 2019 10:32:08 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16414780-1500050 
 for <intel-gfx@lists.freedesktop.org>; Wed, 01 May 2019 11:32:04 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  1 May 2019 11:32:04 +0100
Message-Id: <20190501103204.18632-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915: Move the engine->destroy() vfunc onto
 the engine
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSB0aGUgZW5naW5lIHJlc3BvbnNpYmxlIGZvciBjbGVhbmluZyBpdHNlbGYgdXAhCgpUaGlz
IHJlbW92ZXMgdGhlIGk5MTUtPmd0LmNsZWFudXAgdmZ1bmMgdGhhdCBoYXMgYmVlbiBhbm5veWlu
ZyB0aGUKY2FzdWFsIHJlYWRlciBhbmQgbXlzZWxmIGZvciB0aGUgbGFzdCBzZXZlcmFsIHllYXJz
LCBhbmQgaGVscHMga2VlcCBhCmZ1dHVyZSBwYXRjaCB0byBhZGQgbW9yZSBjbGVhbnVwIHRpZHku
Cgp2MjogQXNzZXJ0IHRoYXQgZW5naW5lLT5kZXN0cm95IGlzIHNldCBhZnRlciB0aGUgYmFja2Vu
ZCBzdGFydHMKYWxsb2NhdGluZyBpdHMgb3duIHN0YXRlLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMg
V2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZy
dGtvLnVyc3VsaW5AaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogVHZydGtvIFVyc3VsaW4gPHR2cnRr
by51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmUuaCAgICAgICB8ICA0ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfY3MuYyAgICB8IDY4ICsrKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYyAgICAgICAgICB8IDUxICsrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jICAgfCAzNSArKysrKy0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICB8ICA2IC0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICB8IDE5ICstLS0tLQogNyBmaWxlcyBj
aGFuZ2VkLCA3NyBpbnNlcnRpb25zKCspLCAxMDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmUuaAppbmRleCAzZTUzZjUzYmM1MmIuLmY1YjBmMjdjZWNiNiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKQEAgLTM2Miw3ICszNjIsMTEg
QEAgX19pbnRlbF9yaW5nX3NwYWNlKHVuc2lnbmVkIGludCBoZWFkLCB1bnNpZ25lZCBpbnQgdGFp
bCwgdW5zaWduZWQgaW50IHNpemUpCiAJcmV0dXJuIChoZWFkIC0gdGFpbCAtIENBQ0hFTElORV9C
WVRFUykgJiAoc2l6ZSAtIDEpOwogfQogCitpbnQgaW50ZWxfZW5naW5lc19pbml0X21taW8oc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogaW50IGludGVsX2VuZ2luZXNfc2V0dXAoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworaW50IGludGVsX2VuZ2luZXNfaW5pdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2VuZ2luZXNfY2xlYW51cChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CisKIGludCBpbnRlbF9lbmdpbmVfaW5pdF9j
b21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIHZvaWQgaW50ZWxfZW5naW5l
X2NsZWFudXBfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKaW5kZXggZjczMDg0NzlkNTExLi42
ZTQwZjhlYTlhNmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5j
CkBAIC0zMTksNiArMzE5LDEyIEBAIGludGVsX2VuZ2luZV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJZW5naW5lLT5jbGFzcyA9IGluZm8tPmNsYXNzOwogCWVuZ2lu
ZS0+aW5zdGFuY2UgPSBpbmZvLT5pbnN0YW5jZTsKIAorCS8qCisJICogVG8gYmUgb3ZlcnJpZGRl
biBieSB0aGUgYmFja2VuZCBvbiBzZXR1cC4gSG93ZXZlciB0byBmYWNpbGl0YXRlCisJICogY2xl
YW51cCBvbiBlcnJvciBkdXJpbmcgc2V0dXAsIHdlIGFsd2F5cyBwcm92aWRlIHRoZSBkZXN0cm95
IHZmdW5jLgorCSAqLworCWVuZ2luZS0+ZGVzdHJveSA9ICh0eXBlb2YoZW5naW5lLT5kZXN0cm95
KSlrZnJlZTsKKwogCWVuZ2luZS0+dWFiaV9jbGFzcyA9IGludGVsX2VuZ2luZV9jbGFzc2VzW2lu
Zm8tPmNsYXNzXS51YWJpX2NsYXNzOwogCiAJZW5naW5lLT5jb250ZXh0X3NpemUgPSBfX2ludGVs
X2VuZ2luZV9jb250ZXh0X3NpemUoZGV2X3ByaXYsCkBAIC0zNDMsMTggKzM0OSwzMSBAQCBpbnRl
bF9lbmdpbmVfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVy
biAwOwogfQogCisvKioKKyAqIGludGVsX2VuZ2luZXNfY2xlYW51cCgpIC0gZnJlZSB0aGUgcmVz
b3VyY2VzIGFsbG9jYXRlZCBmb3IgQ29tbWFuZCBTdHJlYW1lcnMKKyAqIEBpOTE1OiB0aGUgaTkx
NSBkZXZpYworICovCit2b2lkIGludGVsX2VuZ2luZXNfY2xlYW51cChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51
bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBp
ZCkgeworCQllbmdpbmUtPmRlc3Ryb3koZW5naW5lKTsKKwkJaTkxNS0+ZW5naW5lW2lkXSA9IE5V
TEw7CisJfQorfQorCiAvKioKICAqIGludGVsX2VuZ2luZXNfaW5pdF9tbWlvKCkgLSBhbGxvY2F0
ZSBhbmQgcHJlcGFyZSB0aGUgRW5naW5lIENvbW1hbmQgU3RyZWFtZXJzCi0gKiBAZGV2X3ByaXY6
IGk5MTUgZGV2aWNlIHByaXZhdGUKKyAqIEBpOTE1OiB0aGUgaTkxNSBkZXZpY2UKICAqCiAgKiBS
ZXR1cm46IG5vbi16ZXJvIGlmIHRoZSBpbml0aWFsaXphdGlvbiBmYWlsZWQuCiAgKi8KLWludCBp
bnRlbF9lbmdpbmVzX2luaXRfbW1pbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitpbnQgaW50ZWxfZW5naW5lc19pbml0X21taW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7Ci0Jc3RydWN0IGludGVsX2RldmljZV9pbmZvICpkZXZpY2VfaW5mbyA9IG1rd3JpdGVf
ZGV2aWNlX2luZm8oZGV2X3ByaXYpOwotCWNvbnN0IHVuc2lnbmVkIGludCBlbmdpbmVfbWFzayA9
IElOVEVMX0lORk8oZGV2X3ByaXYpLT5lbmdpbmVfbWFzazsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmU7Ci0JZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGludGVsX2Rl
dmljZV9pbmZvICpkZXZpY2VfaW5mbyA9IG1rd3JpdGVfZGV2aWNlX2luZm8oaTkxNSk7CisJY29u
c3QgdW5zaWduZWQgaW50IGVuZ2luZV9tYXNrID0gSU5URUxfSU5GTyhpOTE1KS0+ZW5naW5lX21h
c2s7CiAJdW5zaWduZWQgaW50IG1hc2sgPSAwOwogCXVuc2lnbmVkIGludCBpOwogCWludCBlcnI7
CkBAIC0zNjcsMTAgKzM4NiwxMCBAQCBpbnQgaW50ZWxfZW5naW5lc19pbml0X21taW8oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlyZXR1cm4gLUVOT0RFVjsKIAogCWZvciAo
aSA9IDA7IGkgPCBBUlJBWV9TSVpFKGludGVsX2VuZ2luZXMpOyBpKyspIHsKLQkJaWYgKCFIQVNf
RU5HSU5FKGRldl9wcml2LCBpKSkKKwkJaWYgKCFIQVNfRU5HSU5FKGk5MTUsIGkpKQogCQkJY29u
dGludWU7CiAKLQkJZXJyID0gaW50ZWxfZW5naW5lX3NldHVwKGRldl9wcml2LCBpKTsKKwkJZXJy
ID0gaW50ZWxfZW5naW5lX3NldHVwKGk5MTUsIGkpOwogCQlpZiAoZXJyKQogCQkJZ290byBjbGVh
bnVwOwogCkBAIC0zODYsMjAgKzQwNSwxOSBAQCBpbnQgaW50ZWxfZW5naW5lc19pbml0X21taW8o
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlkZXZpY2VfaW5mby0+ZW5naW5l
X21hc2sgPSBtYXNrOwogCiAJLyogV2UgYWx3YXlzIHByZXN1bWUgd2UgaGF2ZSBhdCBsZWFzdCBS
Q1MgYXZhaWxhYmxlIGZvciBsYXRlciBwcm9iaW5nICovCi0JaWYgKFdBUk5fT04oIUhBU19FTkdJ
TkUoZGV2X3ByaXYsIFJDUzApKSkgeworCWlmIChXQVJOX09OKCFIQVNfRU5HSU5FKGk5MTUsIFJD
UzApKSkgewogCQllcnIgPSAtRU5PREVWOwogCQlnb3RvIGNsZWFudXA7CiAJfQogCi0JUlVOVElN
RV9JTkZPKGRldl9wcml2KS0+bnVtX2VuZ2luZXMgPSBod2VpZ2h0MzIobWFzayk7CisJUlVOVElN
RV9JTkZPKGk5MTUpLT5udW1fZW5naW5lcyA9IGh3ZWlnaHQzMihtYXNrKTsKIAotCWk5MTVfY2hl
Y2tfYW5kX2NsZWFyX2ZhdWx0cyhkZXZfcHJpdik7CisJaTkxNV9jaGVja19hbmRfY2xlYXJfZmF1
bHRzKGk5MTUpOwogCiAJcmV0dXJuIDA7CiAKIGNsZWFudXA6Ci0JZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgZGV2X3ByaXYsIGlkKQotCQlrZnJlZShlbmdpbmUpOworCWludGVsX2VuZ2luZXNfY2xl
YW51cChpOTE1KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC00MTMsNyArNDMxLDcgQEAgaW50IGlu
dGVsX2VuZ2luZXNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQg
KCppbml0KShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZCwgZXJyX2lkOworCWVu
dW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCWludCBlcnI7CiAKIAlpZiAoSEFTX0VYRUNMSVNUUyhp
OTE1KSkKQEAgLTQyMiw4ICs0NDAsNiBAQCBpbnQgaW50ZWxfZW5naW5lc19pbml0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCQlpbml0ID0gaW50ZWxfcmluZ19zdWJtaXNzaW9uX2lu
aXQ7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewotCQllcnJfaWQgPSBp
ZDsKLQogCQllcnIgPSBpbml0KGVuZ2luZSk7CiAJCWlmIChlcnIpCiAJCQlnb3RvIGNsZWFudXA7
CkBAIC00MzIsMTQgKzQ0OCw3IEBAIGludCBpbnRlbF9lbmdpbmVzX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiAJcmV0dXJuIDA7CiAKIGNsZWFudXA6Ci0JZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKLQkJaWYgKGlkID49IGVycl9pZCkgewotCQkJa2ZyZWUo
ZW5naW5lKTsKLQkJCWk5MTUtPmVuZ2luZVtpZF0gPSBOVUxMOwotCQl9IGVsc2UgewotCQkJaTkx
NS0+Z3QuY2xlYW51cF9lbmdpbmUoZW5naW5lKTsKLQkJfQotCX0KKwlpbnRlbF9lbmdpbmVzX2Ns
ZWFudXAoaTkxNSk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtNjE5LDE5ICs2MjgsMTYgQEAgaW50
IGludGVsX2VuZ2luZXNfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCWlm
IChlcnIpCiAJCQlnb3RvIGNsZWFudXA7CiAKKwkJLyogV2UgZXhwZWN0IHRoZSBiYWNrZW5kIHRv
IHRha2UgY29udHJvbCBvdmVyIGl0cyBzdGF0ZSAqLworCQlHRU1fQlVHX09OKGVuZ2luZS0+ZGVz
dHJveSA9PSAodHlwZW9mKGVuZ2luZS0+ZGVzdHJveSkpa2ZyZWUpOworCiAJCUdFTV9CVUdfT04o
IWVuZ2luZS0+Y29wcyk7CiAJfQogCiAJcmV0dXJuIDA7CiAKIGNsZWFudXA6Ci0JZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKLQkJaWYgKGVuZ2luZS0+Y29wcykKLQkJCWk5MTUt
Pmd0LmNsZWFudXBfZW5naW5lKGVuZ2luZSk7Ci0JCWVsc2UKLQkJCWtmcmVlKGVuZ2luZSk7Ci0J
CWk5MTUtPmVuZ2luZVtpZF0gPSBOVUxMOwotCX0KKwlpbnRlbF9lbmdpbmVzX2NsZWFudXAoaTkx
NSk7CiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfdHlwZXMuaAppbmRleCBkOTcyYzMzOTMwOWMuLjlkNjRlMzNmODQyNyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKQEAgLTQyMCw3ICs0MjAs
NyBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAkgKi8KIAl2b2lkCQkoKmNhbmNlbF9yZXF1
ZXN0cykoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAotCXZvaWQJCSgqY2xlYW51
cCkoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKKwl2b2lkCQkoKmRlc3Ryb3kpKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CiAKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4
ZWNsaXN0cyBleGVjbGlzdHM7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXgg
MDFmNThhMTUyYTllLi44NTFlNjJkZGNiODcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xy
Yy5jCkBAIC0yMzMxLDQwICsyMzMxLDYgQEAgc3RhdGljIGludCBnZW44X2luaXRfcmNzX2NvbnRl
eHQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJcmV0dXJuIGk5MTVfZ2VtX3JlbmRlcl9zdGF0
ZV9lbWl0KHJxKTsKIH0KIAotLyoqCi0gKiBpbnRlbF9sb2dpY2FsX3JpbmdfY2xlYW51cCgpIC0g
ZGVhbGxvY2F0ZSB0aGUgRW5naW5lIENvbW1hbmQgU3RyZWFtZXIKLSAqIEBlbmdpbmU6IEVuZ2lu
ZSBDb21tYW5kIFN0cmVhbWVyLgotICovCi12b2lkIGludGVsX2xvZ2ljYWxfcmluZ19jbGVhbnVw
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXY7Ci0KLQkvKgotCSAqIFRhc2tsZXQgY2Fubm90IGJlIGFjdGl2ZSBhdCB0
aGlzIHBvaW50IGR1ZSBpbnRlbF9tYXJrX2FjdGl2ZS9pZGxlCi0JICogc28gdGhpcyBpcyBqdXN0
IGZvciBkb2N1bWVudGF0aW9uLgotCSAqLwotCWlmIChXQVJOX09OKHRlc3RfYml0KFRBU0tMRVRf
U1RBVEVfU0NIRUQsCi0JCQkgICAgICZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0LnN0YXRlKSkp
Ci0JCXRhc2tsZXRfa2lsbCgmZW5naW5lLT5leGVjbGlzdHMudGFza2xldCk7Ci0KLQlkZXZfcHJp
diA9IGVuZ2luZS0+aTkxNTsKLQotCWlmIChlbmdpbmUtPmJ1ZmZlcikgewotCQlXQVJOX09OKChF
TkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfTUlfTU9ERSkgJiBNT0RFX0lETEUpID09IDApOwotCX0K
LQotCWlmIChlbmdpbmUtPmNsZWFudXApCi0JCWVuZ2luZS0+Y2xlYW51cChlbmdpbmUpOwotCi0J
aW50ZWxfZW5naW5lX2NsZWFudXBfY29tbW9uKGVuZ2luZSk7Ci0KLQlscmNfZGVzdHJveV93YV9j
dHgoZW5naW5lKTsKLQotCWVuZ2luZS0+aTkxNSA9IE5VTEw7Ci0JZGV2X3ByaXYtPmVuZ2luZVtl
bmdpbmUtPmlkXSA9IE5VTEw7Ci0Ja2ZyZWUoZW5naW5lKTsKLX0KLQogdm9pZCBpbnRlbF9leGVj
bGlzdHNfc2V0X2RlZmF1bHRfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiB7CiAJZW5naW5lLT5zdWJtaXRfcmVxdWVzdCA9IGV4ZWNsaXN0c19zdWJtaXRfcmVxdWVz
dDsKQEAgLTIzODcsMTAgKzIzNTMsMjcgQEAgdm9pZCBpbnRlbF9leGVjbGlzdHNfc2V0X2RlZmF1
bHRfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCWVuZ2luZS0+
ZmxhZ3MgfD0gSTkxNV9FTkdJTkVfSEFTX1BSRUVNUFRJT047CiB9CiAKK3N0YXRpYyB2b2lkIGV4
ZWNsaXN0c19kZXN0cm95KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwkvKgor
CSAqIFRhc2tsZXQgY2Fubm90IGJlIGFjdGl2ZSBhdCB0aGlzIHBvaW50IGR1ZSBpbnRlbF9tYXJr
X2FjdGl2ZS9pZGxlCisJICogc28gdGhpcyBpcyBqdXN0IGZvciBkb2N1bWVudGF0aW9uLgorCSAq
LworCWlmIChHRU1fREVCVUdfV0FSTl9PTih0ZXN0X2JpdChUQVNLTEVUX1NUQVRFX1NDSEVELAor
CQkJCSAgICAgICAmZW5naW5lLT5leGVjbGlzdHMudGFza2xldC5zdGF0ZSkpKQorCQl0YXNrbGV0
X2tpbGwoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOworCisJaW50ZWxfZW5naW5lX2NsZWFu
dXBfY29tbW9uKGVuZ2luZSk7CisJbHJjX2Rlc3Ryb3lfd2FfY3R4KGVuZ2luZSk7CisJa2ZyZWUo
ZW5naW5lKTsKK30KKwogc3RhdGljIHZvaWQKIGxvZ2ljYWxfcmluZ19kZWZhdWx0X3ZmdW5jcyhz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJLyogRGVmYXVsdCB2ZnVuY3Mgd2hp
Y2ggY2FuIGJlIG92ZXJyaWRlbiBieSBlYWNoIGVuZ2luZS4gKi8KKworCWVuZ2luZS0+ZGVzdHJv
eSA9IGV4ZWNsaXN0c19kZXN0cm95OwogCWVuZ2luZS0+cmVzdW1lID0gZXhlY2xpc3RzX3Jlc3Vt
ZTsKIAogCWVuZ2luZS0+cmVzZXQucHJlcGFyZSA9IGV4ZWNsaXN0c19yZXNldF9wcmVwYXJlOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCmluZGV4IDVlMzQyNzI3
ZWFiMy4uNmZiYzVkZGJjODk2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z2J1ZmZlci5jCkBAIC0xNTM0LDI1ICsxNTM0LDYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRl
bF9jb250ZXh0X29wcyByaW5nX2NvbnRleHRfb3BzID0gewogCS5kZXN0cm95ID0gcmluZ19jb250
ZXh0X2Rlc3Ryb3ksCiB9OwogCi12b2lkIGludGVsX2VuZ2luZV9jbGVhbnVwKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBlbmdpbmUtPmk5MTU7Ci0KLQlXQVJOX09OKElOVEVMX0dFTihkZXZfcHJpdikgPiAyICYm
Ci0JCShFTkdJTkVfUkVBRChlbmdpbmUsIFJJTkdfTUlfTU9ERSkgJiBNT0RFX0lETEUpID09IDAp
OwotCi0JaW50ZWxfcmluZ191bnBpbihlbmdpbmUtPmJ1ZmZlcik7Ci0JaW50ZWxfcmluZ19wdXQo
ZW5naW5lLT5idWZmZXIpOwotCi0JaWYgKGVuZ2luZS0+Y2xlYW51cCkKLQkJZW5naW5lLT5jbGVh
bnVwKGVuZ2luZSk7Ci0KLQlpbnRlbF9lbmdpbmVfY2xlYW51cF9jb21tb24oZW5naW5lKTsKLQot
CWRldl9wcml2LT5lbmdpbmVbZW5naW5lLT5pZF0gPSBOVUxMOwotCWtmcmVlKGVuZ2luZSk7Ci19
Ci0KIHN0YXRpYyBpbnQgbG9hZF9wZF9kaXIoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJCSAg
ICAgICBjb25zdCBzdHJ1Y3QgaTkxNV9od19wcGd0dCAqcHBndHQpCiB7CkBAIC0yMTU3LDYgKzIx
MzgsMjAgQEAgc3RhdGljIHZvaWQgZ2VuNl9ic2Rfc2V0X2RlZmF1bHRfc3VibWlzc2lvbihzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJZW5naW5lLT5zdWJtaXRfcmVxdWVzdCA9IGdl
bjZfYnNkX3N1Ym1pdF9yZXF1ZXN0OwogfQogCitzdGF0aWMgdm9pZCByaW5nX2Rlc3Ryb3koc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGVuZ2luZS0+aTkxNTsKKworCVdBUk5fT04oSU5URUxfR0VOKGRldl9wcml2
KSA+IDIgJiYKKwkJKEVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19NSV9NT0RFKSAmIE1PREVfSURM
RSkgPT0gMCk7CisKKwlpbnRlbF9yaW5nX3VucGluKGVuZ2luZS0+YnVmZmVyKTsKKwlpbnRlbF9y
aW5nX3B1dChlbmdpbmUtPmJ1ZmZlcik7CisKKwlpbnRlbF9lbmdpbmVfY2xlYW51cF9jb21tb24o
ZW5naW5lKTsKKwlrZnJlZShlbmdpbmUpOworfQorCiBzdGF0aWMgdm9pZCBzZXR1cF9pcnEoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gZW5naW5lLT5pOTE1OwpAQCAtMjE4NSw2ICsyMTgwLDggQEAgc3RhdGljIHZvaWQg
c2V0dXBfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCXNldHVwX2ly
cShlbmdpbmUpOwogCisJZW5naW5lLT5kZXN0cm95ID0gcmluZ19kZXN0cm95OworCiAJZW5naW5l
LT5yZXN1bWUgPSB4Y3NfcmVzdW1lOwogCWVuZ2luZS0+cmVzZXQucHJlcGFyZSA9IHJlc2V0X3By
ZXBhcmU7CiAJZW5naW5lLT5yZXNldC5yZXNldCA9IHJlc2V0X3Jpbmc7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaAppbmRleCA4ODZhMzAyNDNmZTMuLjEzMjcwZTE5ZWI4NyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oCkBAIC0xOTg2LDggKzE5ODYsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7
CiAKIAkvKiBBYnN0cmFjdCB0aGUgc3VibWlzc2lvbiBtZWNoYW5pc20gKGxlZ2FjeSByaW5nYnVm
ZmVyIG9yIGV4ZWNsaXN0cykgYXdheSAqLwogCXN0cnVjdCB7Ci0JCXZvaWQgKCpjbGVhbnVwX2Vu
Z2luZSkoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKLQogCQlzdHJ1Y3QgaTkxNV9n
dF90aW1lbGluZXMgewogCQkJc3RydWN0IG11dGV4IG11dGV4OyAvKiBwcm90ZWN0cyBsaXN0LCB0
YWludGVkIGJ5IEdQVSAqLwogCQkJc3RydWN0IGxpc3RfaGVhZCBhY3RpdmVfbGlzdDsKQEAgLTI3
MTMsOSArMjcxMSw2IEBAIGV4dGVybiB1bnNpZ25lZCBsb25nIGk5MTVfZ2Z4X3ZhbChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogZXh0ZXJuIHZvaWQgaTkxNV91cGRhdGVfZ2Z4
X3ZhbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IHZsdl9mb3JjZV9n
ZnhfY2xvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIG9uKTsKIAot
aW50IGludGVsX2VuZ2luZXNfaW5pdF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdik7Ci1pbnQgaW50ZWxfZW5naW5lc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7Ci0KIHUzMiBpbnRlbF9jYWxjdWxhdGVfbWNyX3Nfc3Nfc2VsZWN0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3F1
ZXVlX2hhbmdjaGVjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0zMDUw
LDcgKzMwNDUsNiBAQCBpbnQgX19tdXN0X2NoZWNrIGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIGludCBfX211c3RfY2hlY2sgaTkxNV9nZW1faW5pdF9o
dyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpOTE1X2dlbV9pbml0
X3N3aXp6bGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpOTE1
X2dlbV9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGk5MTVf
Z2VtX2NsZWFudXBfZW5naW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwog
aW50IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQkJICAgdW5zaWduZWQgaW50IGZsYWdzLCBsb25nIHRpbWVvdXQpOwogdm9pZCBpOTE1
X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwppbmRleCA0YzE3OTNiMTAxMmUuLjJmY2VjMWJmYjAzOCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jCkBAIC00NDc2LDExICs0NDc2LDYgQEAgaW50IGk5MTVfZ2VtX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJZGV2X3ByaXYtPm1tLnVub3Jk
ZXJlZF90aW1lbGluZSA9IGRtYV9mZW5jZV9jb250ZXh0X2FsbG9jKDEpOwogCi0JaWYgKEhBU19M
T0dJQ0FMX1JJTkdfQ09OVEVYVFMoZGV2X3ByaXYpKQotCQlkZXZfcHJpdi0+Z3QuY2xlYW51cF9l
bmdpbmUgPSBpbnRlbF9sb2dpY2FsX3JpbmdfY2xlYW51cDsKLQllbHNlCi0JCWRldl9wcml2LT5n
dC5jbGVhbnVwX2VuZ2luZSA9IGludGVsX2VuZ2luZV9jbGVhbnVwOwotCiAJaTkxNV90aW1lbGlu
ZXNfaW5pdChkZXZfcHJpdik7CiAKIAlyZXQgPSBpOTE1X2dlbV9pbml0X3VzZXJwdHIoZGV2X3By
aXYpOwpAQCAtNDYwMSw3ICs0NTk2LDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogZXJyX3BtOgogCWlmIChyZXQgIT0gLUVJTykgewogCQlp
bnRlbF9jbGVhbnVwX2d0X3Bvd2Vyc2F2ZShkZXZfcHJpdik7Ci0JCWk5MTVfZ2VtX2NsZWFudXBf
ZW5naW5lcyhkZXZfcHJpdik7CisJCWludGVsX2VuZ2luZXNfY2xlYW51cChkZXZfcHJpdik7CiAJ
fQogZXJyX2NvbnRleHQ6CiAJaWYgKHJldCAhPSAtRUlPKQpAQCAtNDY2MSw3ICs0NjU2LDcgQEAg
dm9pZCBpOTE1X2dlbV9maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaW50ZWxfdWNfZmluaV9o
dyhkZXZfcHJpdik7CiAJaW50ZWxfdWNfZmluaShkZXZfcHJpdik7Ci0JaTkxNV9nZW1fY2xlYW51
cF9lbmdpbmVzKGRldl9wcml2KTsKKwlpbnRlbF9lbmdpbmVzX2NsZWFudXAoZGV2X3ByaXYpOwog
CWk5MTVfZ2VtX2NvbnRleHRzX2ZpbmkoZGV2X3ByaXYpOwogCWk5MTVfZ2VtX2Zpbmlfc2NyYXRj
aChkZXZfcHJpdik7CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
CkBAIC00Njg0LDE2ICs0Njc5LDYgQEAgdm9pZCBpOTE1X2dlbV9pbml0X21taW8oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaTkxNV9nZW1fc2FuaXRpemUoaTkxNSk7CiB9CiAKLXZv
aWQKLWk5MTVfZ2VtX2NsZWFudXBfZW5naW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCi17Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWVudW0gaW50ZWxf
ZW5naW5lX2lkIGlkOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZGV2X3ByaXYsIGlkKQot
CQlkZXZfcHJpdi0+Z3QuY2xlYW51cF9lbmdpbmUoZW5naW5lKTsKLX0KLQogdm9pZAogaTkxNV9n
ZW1fbG9hZF9pbml0X2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7
Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

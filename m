Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6779A4B706
	for <lists+intel-gfx@lfdr.de>; Wed, 19 Jun 2019 13:25:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 77D6B6E373;
	Wed, 19 Jun 2019 11:25:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 771E36E373
 for <intel-gfx@lists.freedesktop.org>; Wed, 19 Jun 2019 11:25:25 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16951952-1500050 
 for multiple; Wed, 19 Jun 2019 12:23:41 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 19 Jun 2019 12:23:40 +0100
Message-Id: <20190619112341.9082-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190619112341.9082-1-chris@chris-wilson.co.uk>
References: <20190619112341.9082-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 6/7] drm/i915: Provide an i915_active.acquire
 callback
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgaW50cm9kdWNlIGEgY2FsbGJhY2sgZm9yIGk5MTVfYWN0aXZlIHRoYXQgaXMgb25seSBj
YWxsZWQgdGhlIGZpcnN0CnRpbWUgd2UgdXNlIHRoZSBpOTE1X2FjdGl2ZSBhbmQgaXMgc3ltbWV0
cmljYWxseSBwYWlyZWQgd2l0aCB0aGUKaTkxNV9hY3RpdmUucmV0aXJlIGNhbGxiYWNrLCB3ZSBj
YW4gcmVwbGFjZSB0aGUgb3Blbi1jb2RlZCBhbmQKbm9uLWF0b21pYyBpbXBsZW1lbnRhdGlvbnMg
LS0gd2hpY2ggd2lsbCBiZSB2ZXJ5IGZyYWdpbGUgKGkuZS4gYnJva2VuKQp1cG9uIHJlbW92aW5n
IHRoZSBzdHJ1Y3RfbXV0ZXggc2VyaWFsaXNhdGlvbi4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdp
bHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpSZXZpZXdlZC1ieTogTWF0dGhldyBBdWxk
IDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0LmMgICAgICB8ICA4MyArKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9jb250ZXh0LmggICAgICB8ICAxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbHJjLmMgICAgICAgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3JpbmdidWZmZXIuYyAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2Vu
Z2luZS5jICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUu
YyAgICAgICAgICAgfCAyMjYgKysrKysrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgICAgfCAgMjUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlX3R5cGVzLmggICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYyAgICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV90aW1lbGluZS5jICAgICAgICAgfCAgMTYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
dm1hLmMgICAgICAgICAgICAgIHwgIDIyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9hY3RpdmUuYyB8ICA1MyArKysrLQogMTMgZmlsZXMgY2hhbmdlZCwgMjY1IGluc2Vy
dGlvbnMoKyksIDIwNCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuYwppbmRleCAwZjJjMjJhM2JjYjYuLjlhNjg4ZTBiZjNiMiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC05MjMsOCArOTIz
LDEyIEBAIHN0YXRpYyBpbnQgY29udGV4dF9iYXJyaWVyX3Rhc2soc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwKIAlpZiAoIWNiKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWk5MTVfYWN0aXZl
X2luaXQoaTkxNSwgJmNiLT5iYXNlLCBjYl9yZXRpcmUpOwotCWk5MTVfYWN0aXZlX2FjcXVpcmUo
JmNiLT5iYXNlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZjYi0+YmFzZSwgTlVMTCwgY2Jf
cmV0aXJlKTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZjYi0+YmFzZSk7CisJaWYgKGVy
cikgeworCQlrZnJlZShjYik7CisJCXJldHVybiBlcnI7CisJfQogCiAJZm9yX2VhY2hfZ2VtX2Vu
Z2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKIAkJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmMKaW5kZXggMmM0NTRmMjI3YzJlLi4yMGM3MDhhZTZkYzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTk1LDExICs5NSwxNSBAQCB2b2lkIGludGVsX2NvbnRl
eHRfdW5waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCWludGVsX2NvbnRleHRfcHV0KGNl
KTsKIH0KIAotc3RhdGljIGludCBfX2NvbnRleHRfcGluX3N0YXRlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hLCB1bnNpZ25lZCBsb25nIGZsYWdzKQorc3RhdGljIGludCBfX2NvbnRleHRfcGluX3N0YXRl
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogeworCXU2NCBmbGFnczsKIAlpbnQgZXJyOwogCi0JZXJy
ID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgZmxhZ3MgfCBQSU5fR0xPQkFMKTsKKwlmbGFncyA9
IGk5MTVfZ2d0dF9waW5fYmlhcyh2bWEpIHwgUElOX09GRlNFVF9CSUFTOworCWZsYWdzIHw9IFBJ
Tl9ISUdIIHwgUElOX0dMT0JBTDsKKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIGZs
YWdzKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCkBAIC0xMTksNyArMTIzLDcgQEAgc3Rh
dGljIHZvaWQgX19jb250ZXh0X3VucGluX3N0YXRlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCV9f
aTkxNV92bWFfdW5waW4odm1hKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfY29udGV4dF9yZXRp
cmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCitzdGF0aWMgdm9pZCBfX2ludGVsX2NvbnRl
eHRfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqYWN0aXZlKQogewogCXN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSA9IGNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigqY2UpLCBhY3RpdmUpOwog
CkBAIC0xMjksNjUgKzEzMyw1OCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jb250ZXh0X3JldGlyZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKmFjdGl2ZSkKIAlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiB9CiAK
LXZvaWQKLWludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCi0JCSAg
IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCSAgIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKLXsKLQlHRU1fQlVHX09OKCFlbmdpbmUtPmNvcHMpOwotCi0Ja3JlZl9pbml0
KCZjZS0+cmVmKTsKLQotCWNlLT5nZW1fY29udGV4dCA9IGN0eDsKLQljZS0+ZW5naW5lID0gZW5n
aW5lOwotCWNlLT5vcHMgPSBlbmdpbmUtPmNvcHM7Ci0JY2UtPnNzZXUgPSBlbmdpbmUtPnNzZXU7
Ci0KLQlJTklUX0xJU1RfSEVBRCgmY2UtPnNpZ25hbF9saW5rKTsKLQlJTklUX0xJU1RfSEVBRCgm
Y2UtPnNpZ25hbHMpOwotCi0JbXV0ZXhfaW5pdCgmY2UtPnBpbl9tdXRleCk7Ci0KLQlpOTE1X2Fj
dGl2ZV9pbml0KGN0eC0+aTkxNSwgJmNlLT5hY3RpdmUsIGludGVsX2NvbnRleHRfcmV0aXJlKTsK
LX0KLQotaW50IGludGVsX2NvbnRleHRfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLCB1bnNpZ25lZCBsb25nIGZsYWdzKQorc3RhdGljIGludCBfX2ludGVsX2NvbnRleHRf
YWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqYWN0aXZlKQogeworCXN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSA9IGNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigqY2UpLCBhY3RpdmUpOwogCWlu
dCBlcnI7CiAKLQlpZiAoIWk5MTVfYWN0aXZlX2FjcXVpcmUoJmNlLT5hY3RpdmUpKQotCQlyZXR1
cm4gMDsKLQogCWludGVsX2NvbnRleHRfZ2V0KGNlKTsKIAogCWlmICghY2UtPnN0YXRlKQogCQly
ZXR1cm4gMDsKIAotCWVyciA9IF9fY29udGV4dF9waW5fc3RhdGUoY2UtPnN0YXRlLCBmbGFncyk7
Ci0JaWYgKGVycikgewotCQlpOTE1X2FjdGl2ZV9jYW5jZWwoJmNlLT5hY3RpdmUpOwotCQlpbnRl
bF9jb250ZXh0X3B1dChjZSk7Ci0JCXJldHVybiBlcnI7Ci0JfQorCWVyciA9IF9fY29udGV4dF9w
aW5fc3RhdGUoY2UtPnN0YXRlKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9wdXQ7CiAKIAkvKiBQ
cmVhbGxvY2F0ZSB0cmFja2luZyBub2RlcyAqLwogCWlmICghaTkxNV9nZW1fY29udGV4dF9pc19r
ZXJuZWwoY2UtPmdlbV9jb250ZXh0KSkgewogCQllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlX3By
ZWFsbG9jYXRlX2JhcnJpZXIoJmNlLT5hY3RpdmUsCiAJCQkJCQkJICAgICAgY2UtPmVuZ2luZSk7
Ci0JCWlmIChlcnIpIHsKLQkJCWk5MTVfYWN0aXZlX3JlbGVhc2UoJmNlLT5hY3RpdmUpOwotCQkJ
cmV0dXJuIGVycjsKLQkJfQorCQlpZiAoZXJyKQorCQkJZ290byBlcnJfdW5waW47CiAJfQogCiAJ
cmV0dXJuIDA7CisKK2Vycl91bnBpbjoKKwlfX2NvbnRleHRfdW5waW5fc3RhdGUoY2UtPnN0YXRl
KTsKK2Vycl9wdXQ6CisJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCXJldHVybiBlcnI7CiB9CiAK
LXZvaWQgaW50ZWxfY29udGV4dF9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2UpCit2b2lkCitpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAor
CQkgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAorCQkgICBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiB7Ci0JLyogTm9kZXMgcHJlYWxsb2NhdGVkIGluIGludGVsX2NvbnRl
eHRfYWN0aXZlKCkgKi8KLQlpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIoJmNlLT5hY3RpdmUp
OwotCWk5MTVfYWN0aXZlX3JlbGVhc2UoJmNlLT5hY3RpdmUpOworCUdFTV9CVUdfT04oIWVuZ2lu
ZS0+Y29wcyk7CisKKwlrcmVmX2luaXQoJmNlLT5yZWYpOworCisJY2UtPmdlbV9jb250ZXh0ID0g
Y3R4OworCWNlLT5lbmdpbmUgPSBlbmdpbmU7CisJY2UtPm9wcyA9IGVuZ2luZS0+Y29wczsKKwlj
ZS0+c3NldSA9IGVuZ2luZS0+c3NldTsKKworCUlOSVRfTElTVF9IRUFEKCZjZS0+c2lnbmFsX2xp
bmspOworCUlOSVRfTElTVF9IRUFEKCZjZS0+c2lnbmFscyk7CisKKwltdXRleF9pbml0KCZjZS0+
cGluX211dGV4KTsKKworCWk5MTVfYWN0aXZlX2luaXQoY3R4LT5pOTE1LCAmY2UtPmFjdGl2ZSwK
KwkJCSBfX2ludGVsX2NvbnRleHRfYWN0aXZlLCBfX2ludGVsX2NvbnRleHRfcmV0aXJlKTsKIH0K
IAogc3RhdGljIHZvaWQgaTkxNV9nbG9iYWxfY29udGV4dF9zaHJpbmsodm9pZCkKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaAppbmRleCBhNDcyNzViYzRmMDEuLjQwY2Q4MzIw
ZmNjMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaApAQCAtOSw2ICs5
LDcgQEAKIAogI2luY2x1ZGUgPGxpbnV4L2xvY2tkZXAuaD4KIAorI2luY2x1ZGUgImk5MTVfYWN0
aXZlLmgiCiAjaW5jbHVkZSAiaW50ZWxfY29udGV4dF90eXBlcy5oIgogI2luY2x1ZGUgImludGVs
X2VuZ2luZV90eXBlcy5oIgogCkBAIC0xMDIsOCArMTAzLDE3IEBAIHN0YXRpYyBpbmxpbmUgdm9p
ZCBpbnRlbF9jb250ZXh0X2V4aXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCQljZS0+b3Bz
LT5leGl0KGNlKTsKIH0KIAotaW50IGludGVsX2NvbnRleHRfYWN0aXZlX2FjcXVpcmUoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLCB1bnNpZ25lZCBsb25nIGZsYWdzKTsKLXZvaWQgaW50ZWxfY29u
dGV4dF9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpOworc3RhdGljIGlu
bGluZSBpbnQgaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UpCit7CisJcmV0dXJuIGk5MTVfYWN0aXZlX2FjcXVpcmUoJmNlLT5hY3RpdmUpOworfQor
CitzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfY29udGV4dF9hY3RpdmVfcmVsZWFzZShzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UpCit7CisJLyogTm9kZXMgcHJlYWxsb2NhdGVkIGluIGludGVsX2Nv
bnRleHRfYWN0aXZlKCkgKi8KKwlpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIoJmNlLT5hY3Rp
dmUpOworCWk5MTVfYWN0aXZlX3JlbGVhc2UoJmNlLT5hY3RpdmUpOworfQogCiBzdGF0aWMgaW5s
aW5lIHN0cnVjdCBpbnRlbF9jb250ZXh0ICppbnRlbF9jb250ZXh0X2dldChzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGUyZjk3
OGNiY2EwYy4uZmE4NGFkMTIxYTA4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpA
QCAtMTQ2MCwxMiArMTQ2MCwxMCBAQCBfX2V4ZWNsaXN0c19jb250ZXh0X3BpbihzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UsCiAJCWdvdG8gZXJyOwogCUdFTV9CVUdfT04oIWNlLT5zdGF0ZSk7CiAK
LQlyZXQgPSBpbnRlbF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKGNlLAotCQkJCQkgICBlbmdpbmUt
Pmk5MTUtPmdndHQucGluX2JpYXMgfAotCQkJCQkgICBQSU5fT0ZGU0VUX0JJQVMgfAotCQkJCQkg
ICBQSU5fSElHSCk7CisJcmV0ID0gaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShjZSk7CiAJ
aWYgKHJldCkKIAkJZ290byBlcnI7CisJR0VNX0JVR19PTighaTkxNV92bWFfaXNfcGlubmVkKGNl
LT5zdGF0ZSkpOwogCiAJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChjZS0+c3RhdGUt
Pm9iaiwKIAkJCQkJaTkxNV9jb2hlcmVudF9tYXBfdHlwZShlbmdpbmUtPmk5MTUpIHwKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCAxZGVlNTY3ZjMwZWMu
LjljYmFiNTZmZmQ3ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZm
ZXIuYwpAQCAtMTQzNyw3ICsxNDM3LDcgQEAgc3RhdGljIGludCByaW5nX2NvbnRleHRfcGluKHN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAkJY2UtPnN0YXRlID0gdm1hOwogCX0KIAotCWVyciA9
IGludGVsX2NvbnRleHRfYWN0aXZlX2FjcXVpcmUoY2UsIFBJTl9ISUdIKTsKKwllcnIgPSBpbnRl
bF9jb250ZXh0X2FjdGl2ZV9hY3F1aXJlKGNlKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYwppbmRleCAwODY4MDFiNTE0NDEuLmI5
YzI3NjRiZWNhMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdp
bmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCkBAIC0xNTQs
NyArMTU0LDcgQEAgc3RhdGljIGludCBtb2NrX2NvbnRleHRfcGluKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSkKIAkJCXJldHVybiAtRU5PTUVNOwogCX0KIAotCXJldCA9IGludGVsX2NvbnRleHRf
YWN0aXZlX2FjcXVpcmUoY2UsIFBJTl9ISUdIKTsKKwlyZXQgPSBpbnRlbF9jb250ZXh0X2FjdGl2
ZV9hY3F1aXJlKGNlKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9hY3RpdmUuYwppbmRleCA4MDdlYTE0NmUxZTYuLjZlZWM5MTEwZDc0OSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0zOSw3ICszOSw3IEBAIHN0YXRpYyB2b2lkICphY3Rp
dmVfZGVidWdfaGludCh2b2lkICphZGRyKQogewogCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmID0g
YWRkcjsKIAotCXJldHVybiAodm9pZCAqKXJlZi0+cmV0aXJlID86ICh2b2lkICopcmVmOworCXJl
dHVybiAodm9pZCAqKXJlZi0+YWN0aXZlID86ICh2b2lkICopcmVmLT5yZXRpcmUgPzogKHZvaWQg
KilyZWY7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZGVidWdfb2JqX2Rlc2NyIGFjdGl2ZV9kZWJ1Z19k
ZXNjID0gewpAQCAtOTcsNTAgKzk3LDUxIEBAIHN0YXRpYyB2b2lkIGRlYnVnX2FjdGl2ZV9hc3Nl
cnQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAjZW5kaWYKIAogc3RhdGljIHZvaWQKLV9fYWN0
aXZlX3Bhcmsoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCithY3RpdmVfcmV0aXJlKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOworCXN0cnVj
dCByYl9yb290IHJvb3Q7CisJYm9vbCByZXRpcmUgPSBmYWxzZTsKIAotCXJidHJlZV9wb3N0b3Jk
ZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJlZi0+dHJlZSwgbm9kZSkgewotCQlHRU1f
QlVHX09OKGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoJml0LT5iYXNlKSk7Ci0JCWttZW1fY2Fj
aGVfZnJlZShnbG9iYWwuc2xhYl9jYWNoZSwgaXQpOwotCX0KLQlyZWYtPnRyZWUgPSBSQl9ST09U
OwotfQotCi1zdGF0aWMgdm9pZAotX19hY3RpdmVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAq
cmVmKQotewotCUdFTV9CVUdfT04oIXJlZi0+Y291bnQpOwotCWlmICgtLXJlZi0+Y291bnQpCisJ
R0VNX0JVR19PTighYXRvbWljX3JlYWQoJnJlZi0+Y291bnQpKTsKKwlpZiAoYXRvbWljX2FkZF91
bmxlc3MoJnJlZi0+Y291bnQsIC0xLCAxKSkKIAkJcmV0dXJuOwogCi0JZGVidWdfYWN0aXZlX2Rl
YWN0aXZhdGUocmVmKTsKKwkvKiBPbmUgYWN0aXZlIG1heSBiZSBmbHVzaGVkIGZyb20gaW5zaWRl
IHRoZSBhY3F1aXJlIG9mIGFub3RoZXIgKi8KKwltdXRleF9sb2NrX25lc3RlZCgmcmVmLT5tdXRl
eCwgU0lOR0xFX0RFUFRIX05FU1RJTkcpOworCisJLyogcmV0dXJuIHRoZSB1bnVzZWQgbm9kZXMg
dG8gb3VyIHNsYWJjYWNoZSAtLSBmbHVzaGluZyB0aGUgYWxsb2NhdG9yICovCisJaWYgKGF0b21p
Y19kZWNfYW5kX3Rlc3QoJnJlZi0+Y291bnQpKSB7CisJCWRlYnVnX2FjdGl2ZV9kZWFjdGl2YXRl
KHJlZik7CisJCXJvb3QgPSByZWYtPnRyZWU7CisJCXJlZi0+dHJlZSA9IFJCX1JPT1Q7CisJCXJl
Zi0+Y2FjaGUgPSBOVUxMOworCQlyZXRpcmUgPSB0cnVlOworCX0KIAotCS8qIHJldHVybiB0aGUg
dW51c2VkIG5vZGVzIHRvIG91ciBzbGFiY2FjaGUgKi8KLQlfX2FjdGl2ZV9wYXJrKHJlZik7CisJ
bXV0ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsKKwlpZiAoIXJldGlyZSkKKwkJcmV0dXJuOwogCiAJ
cmVmLT5yZXRpcmUocmVmKTsKLX0KIAotc3RhdGljIHZvaWQKLW5vZGVfcmV0aXJlKHN0cnVjdCBp
OTE1X2FjdGl2ZV9yZXF1ZXN0ICpiYXNlLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKLXsKLQlf
X2FjdGl2ZV9yZXRpcmUoY29udGFpbmVyX29mKGJhc2UsIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFz
ZSktPnJlZik7CisJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAm
cm9vdCwgbm9kZSkgeworCQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoJml0
LT5iYXNlKSk7CisJCWttZW1fY2FjaGVfZnJlZShnbG9iYWwuc2xhYl9jYWNoZSwgaXQpOworCX0K
IH0KIAogc3RhdGljIHZvaWQKLWxhc3RfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0
ICpiYXNlLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK25vZGVfcmV0aXJlKHN0cnVjdCBpOTE1
X2FjdGl2ZV9yZXF1ZXN0ICpiYXNlLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlfX2Fj
dGl2ZV9yZXRpcmUoY29udGFpbmVyX29mKGJhc2UsIHN0cnVjdCBpOTE1X2FjdGl2ZSwgbGFzdCkp
OworCWFjdGl2ZV9yZXRpcmUoY29udGFpbmVyX29mKGJhc2UsIHN0cnVjdCBhY3RpdmVfbm9kZSwg
YmFzZSktPnJlZik7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqCiBh
Y3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCiB7Ci0Jc3Ry
dWN0IGFjdGl2ZV9ub2RlICpub2RlOworCXN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSwgKnByZWFs
bG9jOwogCXN0cnVjdCByYl9ub2RlICoqcCwgKnBhcmVudDsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpvbGQ7CiAKIAkvKgogCSAqIFdlIHRyYWNrIHRoZSBtb3N0IHJlY2VudGx5IHVzZWQgdGltZWxp
bmUgdG8gc2tpcCBhIHJidHJlZSBzZWFyY2gKQEAgLTE0OCwyMCArMTQ5LDE4IEBAIGFjdGl2ZV9p
bnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIAkgKiBhdCBhbGwuIFdl
IGNhbiByZXVzZSB0aGUgbGFzdCBzbG90IGlmIGl0IGlzIGVtcHR5LCB0aGF0IGlzCiAJICogYWZ0
ZXIgdGhlIHByZXZpb3VzIGFjdGl2aXR5IGhhcyBiZWVuIHJldGlyZWQsIG9yIGlmIGl0IG1hdGNo
ZXMgdGhlCiAJICogY3VycmVudCB0aW1lbGluZS4KLQkgKgotCSAqIE5vdGUgdGhhdCB3ZSBhbGxv
dyB0aGUgdGltZWxpbmUgdG8gYmUgYWN0aXZlIHNpbXVsdGFuZW91c2x5IGluCi0JICogdGhlIHJi
dHJlZSBhbmQgdGhlIGxhc3QgY2FjaGUuIFdlIGRvIHRoaXMgdG8gYXZvaWQgaGF2aW5nCi0JICog
dG8gc2VhcmNoIGFuZCByZXBsYWNlIHRoZSByYnRyZWUgZWxlbWVudCBmb3IgYSBuZXcgdGltZWxp
bmUsIHdpdGgKLQkgKiB0aGUgY29zdCBiZWluZyB0aGF0IHdlIG11c3QgYmUgYXdhcmUgdGhhdCB0
aGUgcmVmIG1heSBiZSByZXRpcmVkCi0JICogdHdpY2UgZm9yIHRoZSBzYW1lIHRpbWVsaW5lIChh
cyB0aGUgb2xkZXIgcmJ0cmVlIGVsZW1lbnQgd2lsbCBiZQotCSAqIHJldGlyZWQgYmVmb3JlIHRo
ZSBuZXcgcmVxdWVzdCBhZGRlZCB0byBsYXN0KS4KIAkgKi8KLQlvbGQgPSBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X3JhdygmcmVmLT5sYXN0LCBCS0wocmVmKSk7Ci0JaWYgKCFvbGQgfHwgb2xkLT5mZW5j
ZS5jb250ZXh0ID09IGlkeCkKLQkJZ290byBvdXQ7CisJbm9kZSA9IFJFQURfT05DRShyZWYtPmNh
Y2hlKTsKKwlpZiAobm9kZSAmJiBub2RlLT50aW1lbGluZSA9PSBpZHgpCisJCXJldHVybiAmbm9k
ZS0+YmFzZTsKKworCS8qIFByZWFsbG9jYXRlIGEgcmVwbGFjZW1lbnQsIGp1c3QgaW4gY2FzZSAq
LworCXByZWFsbG9jID0ga21lbV9jYWNoZV9hbGxvYyhnbG9iYWwuc2xhYl9jYWNoZSwgR0ZQX0tF
Uk5FTCk7CisJaWYgKCFwcmVhbGxvYykKKwkJcmV0dXJuIE5VTEw7CiAKLQkvKiBNb3ZlIHRoZSBj
dXJyZW50bHkgYWN0aXZlIGZlbmNlIGludG8gdGhlIHJidHJlZSAqLwotCWlkeCA9IG9sZC0+ZmVu
Y2UuY29udGV4dDsKKwltdXRleF9sb2NrKCZyZWYtPm11dGV4KTsKKwlHRU1fQlVHX09OKGk5MTVf
YWN0aXZlX2lzX2lkbGUocmVmKSk7CiAKIAlwYXJlbnQgPSBOVUxMOwogCXAgPSAmcmVmLT50cmVl
LnJiX25vZGU7CkBAIC0xNjksOCArMTY4LDEwIEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIAkJcGFyZW50ID0gKnA7CiAKIAkJbm9kZSA9IHJiX2Vu
dHJ5KHBhcmVudCwgc3RydWN0IGFjdGl2ZV9ub2RlLCBub2RlKTsKLQkJaWYgKG5vZGUtPnRpbWVs
aW5lID09IGlkeCkKLQkJCWdvdG8gcmVwbGFjZTsKKwkJaWYgKG5vZGUtPnRpbWVsaW5lID09IGlk
eCkgeworCQkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBwcmVhbGxvYyk7CisJ
CQlnb3RvIG91dDsKKwkJfQogCiAJCWlmIChub2RlLT50aW1lbGluZSA8IGlkeCkKIAkJCXAgPSAm
cGFyZW50LT5yYl9yaWdodDsKQEAgLTE3OCwxNyArMTc5LDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1NjQgaWR4KQogCQkJcCA9ICZwYXJlbnQtPnJiX2xlZnQ7
CiAJfQogCi0Jbm9kZSA9IGttZW1fY2FjaGVfYWxsb2MoZ2xvYmFsLnNsYWJfY2FjaGUsIEdGUF9L
RVJORUwpOwotCi0JLyoga21hbGxvYyBtYXkgcmV0aXJlIHRoZSByZWYtPmxhc3QgKHRoYW5rcyBz
aHJpbmtlcikhICovCi0JaWYgKHVubGlrZWx5KCFpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdygmcmVm
LT5sYXN0LCBCS0wocmVmKSkpKSB7Ci0JCWttZW1fY2FjaGVfZnJlZShnbG9iYWwuc2xhYl9jYWNo
ZSwgbm9kZSk7Ci0JCWdvdG8gb3V0OwotCX0KLQotCWlmICh1bmxpa2VseSghbm9kZSkpCi0JCXJl
dHVybiBFUlJfUFRSKC1FTk9NRU0pOwotCisJbm9kZSA9IHByZWFsbG9jOwogCWk5MTVfYWN0aXZl
X3JlcXVlc3RfaW5pdCgmbm9kZS0+YmFzZSwgTlVMTCwgbm9kZV9yZXRpcmUpOwogCW5vZGUtPnJl
ZiA9IHJlZjsKIAlub2RlLT50aW1lbGluZSA9IGlkeDsKQEAgLTE5Niw0MCArMTg3LDI5IEBAIGFj
dGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIAlyYl9saW5r
X25vZGUoJm5vZGUtPm5vZGUsIHBhcmVudCwgcCk7CiAJcmJfaW5zZXJ0X2NvbG9yKCZub2RlLT5u
b2RlLCAmcmVmLT50cmVlKTsKIAotcmVwbGFjZToKLQkvKgotCSAqIE92ZXJ3cml0ZSB0aGUgcHJl
dmlvdXMgYWN0aXZlIHNsb3QgaW4gdGhlIHJidHJlZSB3aXRoIGxhc3QsCi0JICogbGVhdmluZyBs
YXN0IHplcm9lZC4gSWYgdGhlIHByZXZpb3VzIHNsb3QgaXMgc3RpbGwgYWN0aXZlLAotCSAqIHdl
IG11c3QgYmUgY2FyZWZ1bCBhcyB3ZSBub3cgb25seSBleHBlY3QgdG8gcmVjZWl2ZSBvbmUgcmV0
aXJlCi0JICogY2FsbGJhY2sgbm90IHR3bywgYW5kIHNvIG11Y2ggdW5kbyB0aGUgYWN0aXZlIGNv
dW50aW5nIGZvciB0aGUKLQkgKiBvdmVyd3JpdHRlbiBzbG90LgotCSAqLwotCWlmIChpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X2lzc2V0KCZub2RlLT5iYXNlKSkgewotCQkvKiBSZXRpcmUgb3Vyc2VsdmVz
IGZyb20gdGhlIG9sZCBycS0+YWN0aXZlX2xpc3QgKi8KLQkJX19saXN0X2RlbF9lbnRyeSgmbm9k
ZS0+YmFzZS5saW5rKTsKLQkJcmVmLT5jb3VudC0tOwotCQlHRU1fQlVHX09OKCFyZWYtPmNvdW50
KTsKLQl9Ci0JR0VNX0JVR19PTihsaXN0X2VtcHR5KCZyZWYtPmxhc3QubGluaykpOwotCWxpc3Rf
cmVwbGFjZV9pbml0KCZyZWYtPmxhc3QubGluaywgJm5vZGUtPmJhc2UubGluayk7Ci0Jbm9kZS0+
YmFzZS5yZXF1ZXN0ID0gZmV0Y2hfYW5kX3plcm8oJnJlZi0+bGFzdC5yZXF1ZXN0KTsKLQogb3V0
OgotCXJldHVybiAmcmVmLT5sYXN0OworCXJlZi0+Y2FjaGUgPSBub2RlOworCW11dGV4X3VubG9j
aygmcmVmLT5tdXRleCk7CisKKwlyZXR1cm4gJm5vZGUtPmJhc2U7CiB9CiAKLXZvaWQgaTkxNV9h
Y3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJICAgICAgc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYsCi0JCSAgICAgIHZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKSkKK3ZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAorCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCisJCQlpbnQgKCphY3RpdmUp
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKKwkJCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKSwKKwkJCXN0cnVjdCBsb2NrX2NsYXNzX2tleSAqa2V5KQogewogCWRlYnVn
X2FjdGl2ZV9pbml0KHJlZik7CiAKIAlyZWYtPmk5MTUgPSBpOTE1OworCXJlZi0+YWN0aXZlID0g
YWN0aXZlOwogCXJlZi0+cmV0aXJlID0gcmV0aXJlOwogCXJlZi0+dHJlZSA9IFJCX1JPT1Q7Ci0J
aTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KCZyZWYtPmxhc3QsIE5VTEwsIGxhc3RfcmV0aXJlKTsK
KwlyZWYtPmNhY2hlID0gTlVMTDsKIAlpbml0X2xsaXN0X2hlYWQoJnJlZi0+YmFycmllcnMpOwot
CXJlZi0+Y291bnQgPSAwOworCWF0b21pY19zZXQoJnJlZi0+Y291bnQsIDApOworCV9fbXV0ZXhf
aW5pdCgmcmVmLT5tdXRleCwgImk5MTVfYWN0aXZlIiwga2V5KTsKIH0KIAogaW50IGk5MTVfYWN0
aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKQEAgLTIzNyw2OCArMjE3LDg0IEBAIGlu
dCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAgICBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIHsKIAlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZl
OwotCWludCBlcnIgPSAwOworCWludCBlcnI7CiAKIAkvKiBQcmV2ZW50IHJlYXBpbmcgaW4gY2Fz
ZSB3ZSBtYWxsb2Mvd2FpdCB3aGlsZSBidWlsZGluZyB0aGUgdHJlZSAqLwotCWk5MTVfYWN0aXZl
X2FjcXVpcmUocmVmKTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7CisJaWYgKGVy
cikKKwkJcmV0dXJuIGVycjsKIAogCWFjdGl2ZSA9IGFjdGl2ZV9pbnN0YW5jZShyZWYsIHRpbWVs
aW5lKTsKLQlpZiAoSVNfRVJSKGFjdGl2ZSkpIHsKLQkJZXJyID0gUFRSX0VSUihhY3RpdmUpOwor
CWlmICghYWN0aXZlKSB7CisJCWVyciA9IC1FTk9NRU07CiAJCWdvdG8gb3V0OwogCX0KIAogCWlm
ICghaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldChhY3RpdmUpKQotCQlyZWYtPmNvdW50Kys7CisJ
CWF0b21pY19pbmMoJnJlZi0+Y291bnQpOwogCV9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoYWN0
aXZlLCBycSk7CiAKLQlHRU1fQlVHX09OKCFyZWYtPmNvdW50KTsKIG91dDoKIAlpOTE1X2FjdGl2
ZV9yZWxlYXNlKHJlZik7CiAJcmV0dXJuIGVycjsKIH0KIAotYm9vbCBpOTE1X2FjdGl2ZV9hY3F1
aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQoraW50IGk5MTVfYWN0aXZlX2FjcXVpcmUoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7CisJaW50IGVycjsKKwogCWRlYnVnX2FjdGl2ZV9hc3Nl
cnQocmVmKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKEJLTChyZWYpKTsKKwlpZiAoYXRvbWljX2Fk
ZF91bmxlc3MoJnJlZi0+Y291bnQsIDEsIDApKQorCQlyZXR1cm4gMDsKIAotCWlmIChyZWYtPmNv
dW50KyspCi0JCXJldHVybiBmYWxzZTsKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUo
JnJlZi0+bXV0ZXgpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlpZiAoIWF0b21pY19y
ZWFkKCZyZWYtPmNvdW50KSAmJiByZWYtPmFjdGl2ZSkKKwkJZXJyID0gcmVmLT5hY3RpdmUocmVm
KTsKKwlpZiAoIWVycikgeworCQlkZWJ1Z19hY3RpdmVfYWN0aXZhdGUocmVmKTsKKwkJYXRvbWlj
X2luYygmcmVmLT5jb3VudCk7CisJfQogCi0JZGVidWdfYWN0aXZlX2FjdGl2YXRlKHJlZik7Ci0J
cmV0dXJuIHRydWU7CisJbXV0ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsKKworCXJldHVybiBlcnI7
CiB9CiAKIHZvaWQgaTkxNV9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikK
IHsKIAlkZWJ1Z19hY3RpdmVfYXNzZXJ0KHJlZik7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZChCS0wo
cmVmKSk7Ci0KLQlfX2FjdGl2ZV9yZXRpcmUocmVmKTsKKwlhY3RpdmVfcmV0aXJlKHJlZik7CiB9
CiAKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewogCXN0
cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwotCWludCByZXQgPSAwOworCWludCBlcnI7CiAKLQlp
ZiAoaTkxNV9hY3RpdmVfYWNxdWlyZShyZWYpKQotCQlnb3RvIG91dF9yZWxlYXNlOworCW1pZ2h0
X3NsZWVwKCk7CisJaWYgKFJCX0VNUFRZX1JPT1QoJnJlZi0+dHJlZSkpCisJCXJldHVybiAwOwog
Ci0JcmV0ID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoJnJlZi0+bGFzdCwgQktMKHJlZikp
OwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X3JlbGVhc2U7CisJZXJyID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZyZWYtPm11dGV4KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJaWYg
KCFhdG9taWNfYWRkX3VubGVzcygmcmVmLT5jb3VudCwgMSwgMCkpCisJCWdvdG8gdW5sb2NrOwog
CiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVl
LCBub2RlKSB7Ci0JCXJldCA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZpdC0+YmFzZSwg
QktMKHJlZikpOwotCQlpZiAocmV0KQorCQllcnIgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGly
ZSgmaXQtPmJhc2UsIEJLTChyZWYpKTsKKwkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KIAotb3V0
X3JlbGVhc2U6Ci0JaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYpOwotCXJldHVybiByZXQ7CisJYWN0
aXZlX3JldGlyZShyZWYpOwordW5sb2NrOgorCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7CisJ
cmV0dXJuIGVycjsKIH0KIAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKQEAgLTMxMywyMyArMzA5LDI0IEBAIGludCBpOTE1X3Jl
cXVlc3RfYXdhaXRfYWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiBpbnQg
aTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47Ci0JaW50
IGVyciA9IDA7CisJaW50IGVycjsKIAotCS8qIGF3YWl0IGFsbG9jYXRlcyBhbmQgc28gd2UgbmVl
ZCB0byBhdm9pZCBoaXR0aW5nIHRoZSBzaHJpbmtlciAqLwotCWlmIChpOTE1X2FjdGl2ZV9hY3F1
aXJlKHJlZikpCi0JCWdvdG8gb3V0OyAvKiB3YXMgaWRsZSAqLworCWlmIChSQl9FTVBUWV9ST09U
KCZyZWYtPnRyZWUpKQorCQlyZXR1cm4gMDsKIAotCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9h
Y3RpdmVfcmVxdWVzdChycSwgJnJlZi0+bGFzdCk7CisJLyogYXdhaXQgYWxsb2NhdGVzIGFuZCBz
byB3ZSBuZWVkIHRvIGF2b2lkIGhpdHRpbmcgdGhlIHNocmlua2VyICovCisJZXJyID0gaTkxNV9h
Y3RpdmVfYWNxdWlyZShyZWYpOwogCWlmIChlcnIpCi0JCWdvdG8gb3V0OworCQlyZXR1cm4gZXJy
OwogCisJbXV0ZXhfbG9jaygmcmVmLT5tdXRleCk7CiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFj
aF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVlLCBub2RlKSB7CiAJCWVyciA9IGk5MTVfcmVx
dWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChycSwgJml0LT5iYXNlKTsKIAkJaWYgKGVycikKLQkJ
CWdvdG8gb3V0OworCQkJYnJlYWs7CiAJfQorCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7CiAK
LW91dDoKIAlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTMz
OCw5ICszMzUsOSBAQCBpbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB2b2lkIGk5MTVfYWN0aXZlX2Zp
bmkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7CiAJZGVidWdfYWN0aXZlX2ZpbmkocmVmKTsK
LQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoJnJlZi0+bGFzdCkpOwogCUdF
TV9CVUdfT04oIVJCX0VNUFRZX1JPT1QoJnJlZi0+dHJlZSkpOwotCUdFTV9CVUdfT04ocmVmLT5j
b3VudCk7CisJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmcmVmLT5jb3VudCkpOworCW11dGV4X2Rl
c3Ryb3koJnJlZi0+bXV0ZXgpOwogfQogI2VuZGlmCiAKQEAgLTM2Nyw3ICszNjQsNyBAQCBpbnQg
aTkxNV9hY3RpdmVfYWNxdWlyZV9wcmVhbGxvY2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmLAogCQkJCQkgKHZvaWQgKillbmdpbmUsIG5vZGVfcmV0aXJlKTsKIAkJbm9kZS0+dGlt
ZWxpbmUgPSBrY3R4LT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dDsKIAkJbm9kZS0+cmVm
ID0gcmVmOwotCQlyZWYtPmNvdW50Kys7CisJCWF0b21pY19pbmMoJnJlZi0+Y291bnQpOwogCiAJ
CWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKIAkJbGxpc3RfYWRkKChzdHJ1Y3QgbGxpc3Rf
bm9kZSAqKSZub2RlLT5iYXNlLmxpbmssCkBAIC0zOTQsOCArMzkxLDkgQEAgdm9pZCBpOTE1X2Fj
dGl2ZV9hY3F1aXJlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7CiAJc3RydWN0
IGxsaXN0X25vZGUgKnBvcywgKm5leHQ7CiAKLQlpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZik7CisJ
R0VNX0JVR19PTihpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpOwogCisJbXV0ZXhfbG9ja19uZXN0
ZWQoJnJlZi0+bXV0ZXgsIFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKIAlsbGlzdF9mb3JfZWFjaF9z
YWZlKHBvcywgbmV4dCwgbGxpc3RfZGVsX2FsbCgmcmVmLT5iYXJyaWVycykpIHsKIAkJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCQlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGU7CkBA
IC00MjUsNyArNDIzLDcgQEAgdm9pZCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpCiAJCQkgICZlbmdpbmUtPmJhcnJpZXJfdGFza3MpOwogCQlpbnRl
bF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAJfQotCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsK
KwltdXRleF91bmxvY2soJnJlZi0+bXV0ZXgpOwogfQogCiB2b2lkIGk5MTVfcmVxdWVzdF9hZGRf
YmFycmllcnMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3Rp
dmUuaAppbmRleCBkNTVkMzc2NzM5NDQuLjZmYTkyNjNjYTQwNyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZS5oCkBAIC0zNjksOSArMzY5LDE2IEBAIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0
aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAgKiBzeW5jaHJvbmlzYXRp
b24uCiAgKi8KIAotdm9pZCBpOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAotCQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKLQkJICAgICAgdm9pZCAo
KnJldGlyZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpKTsKK3ZvaWQgX19pOTE1X2FjdGl2ZV9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYsCisJCQlpbnQgKCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKKwkJCXZv
aWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKKwkJCXN0cnVjdCBsb2NrX2Ns
YXNzX2tleSAqa2V5KTsKKyNkZWZpbmUgaTkxNV9hY3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2
ZSwgcmV0aXJlKSBkbyB7CQlcCisJc3RhdGljIHN0cnVjdCBsb2NrX2NsYXNzX2tleSBfX2tleTsJ
CQkJXAorCQkJCQkJCQkJXAorCV9faTkxNV9hY3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwg
cmV0aXJlLCAmX19rZXkpOwkJXAorfSB3aGlsZSAoMCkKIAogaW50IGk5MTVfYWN0aXZlX3JlZihz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJICAgIHU2NCB0aW1lbGluZSwKQEAgLTM4NCwyMCAr
MzkxLDE0IEBAIGludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxLAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwKIAkJCQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0
aXZlKTsKIAotYm9vbCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KTsKLQotc3RhdGljIGlubGluZSB2b2lkIGk5MTVfYWN0aXZlX2NhbmNlbChzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKLXsKLQlHRU1fQlVHX09OKHJlZi0+Y291bnQgIT0gMSk7Ci0JcmVmLT5jb3Vu
dCA9IDA7Ci19Ci0KK2ludCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAq
cmVmKTsKIHZvaWQgaTkxNV9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7
Cit2b2lkIF9faTkxNV9hY3RpdmVfcmVsZWFzZV9uZXN0ZWQoc3RydWN0IGk5MTVfYWN0aXZlICpy
ZWYsIGludCBzdWJjbGFzcyk7CiAKIHN0YXRpYyBpbmxpbmUgYm9vbAogaTkxNV9hY3RpdmVfaXNf
aWRsZShjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKLQlyZXR1cm4gIXJlZi0+Y291
bnQ7CisJcmV0dXJuICFhdG9taWNfcmVhZCgmcmVmLT5jb3VudCk7CiB9CiAKICNpZiBJU19FTkFC
TEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmVfdHlwZXMuaAppbmRleCBjMDI1OTkxYjkyMzMuLjViMGEzMDI0Y2UyNCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCkBAIC03LDcgKzcsOSBAQAogI2lmbmRl
ZiBfSTkxNV9BQ1RJVkVfVFlQRVNfSF8KICNkZWZpbmUgX0k5MTVfQUNUSVZFX1RZUEVTX0hfCiAK
KyNpbmNsdWRlIDxsaW51eC9hdG9taWMuaD4KICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgorI2lu
Y2x1ZGUgPGxpbnV4L211dGV4Lmg+CiAjaW5jbHVkZSA8bGludXgvcmJ0cmVlLmg+CiAjaW5jbHVk
ZSA8bGludXgvcmN1cGRhdGUuaD4KIApAQCAtMjQsMTMgKzI2LDE3IEBAIHN0cnVjdCBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0IHsKIAlpOTE1X2FjdGl2ZV9yZXRpcmVfZm4gcmV0aXJlOwogfTsKIAorc3Ry
dWN0IGFjdGl2ZV9ub2RlOworCiBzdHJ1Y3QgaTkxNV9hY3RpdmUgewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1OwogCisJc3RydWN0IGFjdGl2ZV9ub2RlICpjYWNoZTsKIAlzdHJ1Y3Qg
cmJfcm9vdCB0cmVlOwotCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGxhc3Q7Ci0JdW5zaWdu
ZWQgaW50IGNvdW50OworCXN0cnVjdCBtdXRleCBtdXRleDsKKwlhdG9taWNfdCBjb3VudDsKIAor
CWludCAoKmFjdGl2ZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwogCXZvaWQgKCpyZXRpcmUp
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAogCXN0cnVjdCBsbGlzdF9oZWFkIGJhcnJpZXJz
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCBkOWVkZGJkNzk2NzAuLmRiOTA2
OGM1MjlmYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTIwOTYsNyArMjA5
Niw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnBkX3ZtYV9jcmVhdGUoc3RydWN0IGdlbjZf
cHBndHQgKnBwZ3R0LCBpbnQgc2l6ZSkKIAlpZiAoIXZtYSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVO
T01FTSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZ2bWEtPmFjdGl2ZSwgTlVMTCk7CisJ
aTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmdm1hLT5hY3RpdmUsIE5VTEwsIE5VTEwpOwogCUlOSVRf
QUNUSVZFX1JFUVVFU1QoJnZtYS0+bGFzdF9mZW5jZSk7CiAKIAl2bWEtPnZtID0gJmdndHQtPnZt
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jCmluZGV4IGYzZWUyNjRkN2RkNS4uM2Vh
MWI4ODFhNGFlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5l
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jCkBAIC0xNDgsNiAr
MTQ4LDE1IEBAIHN0YXRpYyB2b2lkIF9fY2FjaGVsaW5lX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKmFjdGl2ZSkKIAkJX19pZGxlX2NhY2hlbGluZV9mcmVlKGNsKTsKIH0KIAorc3RhdGljIGlu
dCBfX2NhY2hlbGluZV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCit7CisJc3Ry
dWN0IGk5MTVfdGltZWxpbmVfY2FjaGVsaW5lICpjbCA9CisJCWNvbnRhaW5lcl9vZihhY3RpdmUs
IHR5cGVvZigqY2wpLCBhY3RpdmUpOworCisJX19pOTE1X3ZtYV9waW4oY2wtPmh3c3AtPnZtYSk7
CisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBzdHJ1Y3QgaTkxNV90aW1lbGluZV9jYWNoZWxpbmUg
KgogY2FjaGVsaW5lX2FsbG9jKHN0cnVjdCBpOTE1X3RpbWVsaW5lX2h3c3AgKmh3c3AsIHVuc2ln
bmVkIGludCBjYWNoZWxpbmUpCiB7CkBAIC0xNzAsMTUgKzE3OSwxNiBAQCBjYWNoZWxpbmVfYWxs
b2Moc3RydWN0IGk5MTVfdGltZWxpbmVfaHdzcCAqaHdzcCwgdW5zaWduZWQgaW50IGNhY2hlbGlu
ZSkKIAljbC0+aHdzcCA9IGh3c3A7CiAJY2wtPnZhZGRyID0gcGFnZV9wYWNrX2JpdHModmFkZHIs
IGNhY2hlbGluZSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGh3c3BfdG9faTkxNShod3NwKSwgJmNs
LT5hY3RpdmUsIF9fY2FjaGVsaW5lX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdChod3NwX3Rv
X2k5MTUoaHdzcCksICZjbC0+YWN0aXZlLAorCQkJIF9fY2FjaGVsaW5lX2FjdGl2ZSwgX19jYWNo
ZWxpbmVfcmV0aXJlKTsKIAogCXJldHVybiBjbDsKIH0KIAogc3RhdGljIHZvaWQgY2FjaGVsaW5l
X2FjcXVpcmUoc3RydWN0IGk5MTVfdGltZWxpbmVfY2FjaGVsaW5lICpjbCkKIHsKLQlpZiAoY2wg
JiYgaTkxNV9hY3RpdmVfYWNxdWlyZSgmY2wtPmFjdGl2ZSkpCi0JCV9faTkxNV92bWFfcGluKGNs
LT5od3NwLT52bWEpOworCWlmIChjbCkKKwkJaTkxNV9hY3RpdmVfYWNxdWlyZSgmY2wtPmFjdGl2
ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGNhY2hlbGluZV9yZWxlYXNlKHN0cnVjdCBpOTE1X3RpbWVs
aW5lX2NhY2hlbGluZSAqY2wpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCBiNjBhNjkyMzVi
YWQuLjg4NjNiNTA0ZDk5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC03NywxMSArNzcs
MjAgQEAgc3RhdGljIHZvaWQgdm1hX3ByaW50X2FsbG9jYXRvcihzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgY29uc3QgY2hhciAqcmVhc29uKQogCiAjZW5kaWYKIAotc3RhdGljIHZvaWQgX19pOTE1X3Zt
YV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCitzdGF0aWMgaW5saW5lIHN0cnVjdCBp
OTE1X3ZtYSAqYWN0aXZlX3RvX3ZtYShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKLQlzdHJ1
Y3QgaTkxNV92bWEgKnZtYSA9IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqdm1hKSwgYWN0aXZl
KTsKKwlyZXR1cm4gY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKHN0cnVjdCBpOTE1X3ZtYSksIGFj
dGl2ZSk7Cit9CiAKLQlpOTE1X3ZtYV9wdXQodm1hKTsKK3N0YXRpYyBpbnQgX19pOTE1X3ZtYV9h
Y3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJaTkxNV92bWFfZ2V0KGFjdGl2ZV90
b192bWEocmVmKSk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIF9faTkxNV92bWFfcmV0
aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQoreworCWk5MTVfdm1hX3B1dChhY3RpdmVfdG9f
dm1hKHJlZikpOwogfQogCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKQEAgLTEwNiw3ICsxMTUs
OCBAQCB2bWFfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm1hLT5z
aXplID0gb2JqLT5iYXNlLnNpemU7CiAJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5MTVfR1RU
X01JTl9BTElHTk1FTlQ7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KHZtLT5pOTE1LCAmdm1hLT5hY3Rp
dmUsIF9faTkxNV92bWFfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KHZtLT5pOTE1LCAmdm1h
LT5hY3RpdmUsCisJCQkgX19pOTE1X3ZtYV9hY3RpdmUsIF9faTkxNV92bWFfcmV0aXJlKTsKIAlJ
TklUX0FDVElWRV9SRVFVRVNUKCZ2bWEtPmxhc3RfZmVuY2UpOwogCiAJSU5JVF9MSVNUX0hFQUQo
JnZtYS0+Y2xvc2VkX2xpbmspOwpAQCAtOTAzLDExICs5MTMsNyBAQCBpbnQgaTkxNV92bWFfbW92
ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJICogYWRkIHRoZSBhY3RpdmUgcmVm
ZXJlbmNlIGZpcnN0IGFuZCBxdWV1ZSBmb3IgaXQgdG8gYmUgZHJvcHBlZAogCSAqICpsYXN0Ki4K
IAkgKi8KLQlpZiAoaTkxNV9hY3RpdmVfYWNxdWlyZSgmdm1hLT5hY3RpdmUpKQotCQlpOTE1X3Zt
YV9nZXQodm1hKTsKLQogCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUsIHJxLT5m
ZW5jZS5jb250ZXh0LCBycSk7Ci0JaTkxNV9hY3RpdmVfcmVsZWFzZSgmdm1hLT5hY3RpdmUpOwog
CWlmICh1bmxpa2VseShlcnIpKQogCQlyZXR1cm4gZXJyOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCmluZGV4IDk4NDkzYmNjOTFmMi4uODRmY2UzNzlj
MGRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3Rp
dmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwpA
QCAtNCw2ICs0LDggQEAKICAqIENvcHlyaWdodCDCqSAyMDE4IEludGVsIENvcnBvcmF0aW9uCiAg
Ki8KIAorI2luY2x1ZGUgPGxpbnV4L2tyZWYuaD4KKwogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9w
bS5oIgogCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgpAQCAtMTMsMjAgKzE1LDQ3IEBACiAK
IHN0cnVjdCBsaXZlX2FjdGl2ZSB7CiAJc3RydWN0IGk5MTVfYWN0aXZlIGJhc2U7CisJc3RydWN0
IGtyZWYgcmVmOwogCWJvb2wgcmV0aXJlZDsKIH07CiAKK3N0YXRpYyB2b2lkIF9fbGl2ZV9nZXQo
c3RydWN0IGxpdmVfYWN0aXZlICphY3RpdmUpCit7CisJa3JlZl9nZXQoJmFjdGl2ZS0+cmVmKTsK
K30KKwogc3RhdGljIHZvaWQgX19saXZlX2ZyZWUoc3RydWN0IGxpdmVfYWN0aXZlICphY3RpdmUp
CiB7CiAJaTkxNV9hY3RpdmVfZmluaSgmYWN0aXZlLT5iYXNlKTsKIAlrZnJlZShhY3RpdmUpOwog
fQogCitzdGF0aWMgdm9pZCBfX2xpdmVfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqcmVmKQoreworCXN0
cnVjdCBsaXZlX2FjdGl2ZSAqYWN0aXZlID0gY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCphY3Rp
dmUpLCByZWYpOworCisJX19saXZlX2ZyZWUoYWN0aXZlKTsKK30KKworc3RhdGljIHZvaWQgX19s
aXZlX3B1dChzdHJ1Y3QgbGl2ZV9hY3RpdmUgKmFjdGl2ZSkKK3sKKwlrcmVmX3B1dCgmYWN0aXZl
LT5yZWYsIF9fbGl2ZV9yZWxlYXNlKTsKK30KKworc3RhdGljIGludCBfX2xpdmVfYWN0aXZlKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqYmFzZSkKK3sKKwlzdHJ1Y3QgbGl2ZV9hY3RpdmUgKmFjdGl2ZSA9
IGNvbnRhaW5lcl9vZihiYXNlLCB0eXBlb2YoKmFjdGl2ZSksIGJhc2UpOworCisJX19saXZlX2dl
dChhY3RpdmUpOworCXJldHVybiAwOworfQorCiBzdGF0aWMgdm9pZCBfX2xpdmVfcmV0aXJlKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqYmFzZSkKIHsKIAlzdHJ1Y3QgbGl2ZV9hY3RpdmUgKmFjdGl2ZSA9
IGNvbnRhaW5lcl9vZihiYXNlLCB0eXBlb2YoKmFjdGl2ZSksIGJhc2UpOwogCiAJYWN0aXZlLT5y
ZXRpcmVkID0gdHJ1ZTsKKwlfX2xpdmVfcHV0KGFjdGl2ZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3Qg
bGl2ZV9hY3RpdmUgKl9fbGl2ZV9hbGxvYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
QEAgLTM3LDcgKzY2LDggQEAgc3RhdGljIHN0cnVjdCBsaXZlX2FjdGl2ZSAqX19saXZlX2FsbG9j
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmICghYWN0aXZlKQogCQlyZXR1cm4g
TlVMTDsKIAotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmFjdGl2ZS0+YmFzZSwgX19saXZlX3Jl
dGlyZSk7CisJa3JlZl9pbml0KCZhY3RpdmUtPnJlZik7CisJaTkxNV9hY3RpdmVfaW5pdChpOTE1
LCAmYWN0aXZlLT5iYXNlLCBfX2xpdmVfYWN0aXZlLCBfX2xpdmVfcmV0aXJlKTsKIAogCXJldHVy
biBhY3RpdmU7CiB9CkBAIC02MiwxMSArOTIsOSBAQCBfX2xpdmVfYWN0aXZlX3NldHVwKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAl9
CiAKLQlpZiAoIWk5MTVfYWN0aXZlX2FjcXVpcmUoJmFjdGl2ZS0+YmFzZSkpIHsKLQkJcHJfZXJy
KCJGaXJzdCBpOTE1X2FjdGl2ZV9hY3F1aXJlIHNob3VsZCByZXBvcnQgYmVpbmcgaWRsZVxuIik7
Ci0JCWVyciA9IC1FSU5WQUw7CisJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZSgmYWN0aXZlLT5i
YXNlKTsKKwlpZiAoZXJyKQogCQlnb3RvIG91dDsKLQl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBpOTE1LCBpZCkgewogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKQEAgLTk3LDE4ICsx
MjUsMjEgQEAgX19saXZlX2FjdGl2ZV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAkJcHJfZXJyKCJpOTE1X2FjdGl2ZSByZXRpcmVkIGJlZm9yZSBzdWJtaXNzaW9uIVxuIik7
CiAJCWVyciA9IC1FSU5WQUw7CiAJfQotCWlmIChhY3RpdmUtPmJhc2UuY291bnQgIT0gY291bnQp
IHsKKwlpZiAoYXRvbWljX3JlYWQoJmFjdGl2ZS0+YmFzZS5jb3VudCkgIT0gY291bnQpIHsKIAkJ
cHJfZXJyKCJpOTE1X2FjdGl2ZSBub3QgdHJhY2tpbmcgYWxsIHJlcXVlc3RzLCBmb3VuZCAlZCwg
ZXhwZWN0ZWQgJWRcbiIsCi0JCSAgICAgICBhY3RpdmUtPmJhc2UuY291bnQsIGNvdW50KTsKKwkJ
ICAgICAgIGF0b21pY19yZWFkKCZhY3RpdmUtPmJhc2UuY291bnQpLCBjb3VudCk7CiAJCWVyciA9
IC1FSU5WQUw7CiAJfQogCiBvdXQ6CiAJaTkxNV9zd19mZW5jZV9jb21taXQoc3VibWl0KTsKIAlo
ZWFwX2ZlbmNlX3B1dChzdWJtaXQpOworCWlmIChlcnIpIHsKKwkJX19saXZlX3B1dChhY3RpdmUp
OworCQlhY3RpdmUgPSBFUlJfUFRSKGVycik7CisJfQogCi0JLyogWFhYIGxlYWtzIGxpdmVfYWN0
aXZlIG9uIGVycm9yICovCi0JcmV0dXJuIGVyciA/IEVSUl9QVFIoZXJyKSA6IGFjdGl2ZTsKKwly
ZXR1cm4gYWN0aXZlOwogfQogCiBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3dhaXQodm9pZCAqYXJn
KQpAQCAtMTM1LDcgKzE2Niw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfd2FpdCh2b2lkICph
cmcpCiAJCWVyciA9IC1FSU5WQUw7CiAJfQogCi0JX19saXZlX2ZyZWUoYWN0aXZlKTsKKwlfX2xp
dmVfcHV0KGFjdGl2ZSk7CiAKIAlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xP
Q0tFRCkpCiAJCWVyciA9IC1FSU87CkBAIC0xNzQsNyArMjA1LDcgQEAgc3RhdGljIGludCBsaXZl
X2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogCQllcnIgPSAtRUlOVkFMOwogCX0KIAotCV9fbGl2
ZV9mcmVlKGFjdGl2ZSk7CisJX19saXZlX3B1dChhY3RpdmUpOwogCiBlcnI6CiAJaW50ZWxfcnVu
dGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotLSAKMi4yMC4xCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

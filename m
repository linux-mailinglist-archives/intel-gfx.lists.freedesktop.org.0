Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B3BE13D0F8F
	for <lists+intel-gfx@lfdr.de>; Wed, 21 Jul 2021 15:30:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5036E6EB18;
	Wed, 21 Jul 2021 13:30:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mail-wr1-x431.google.com (mail-wr1-x431.google.com
 [IPv6:2a00:1450:4864:20::431])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 172C76E96B
 for <intel-gfx@lists.freedesktop.org>; Wed, 21 Jul 2021 13:30:23 +0000 (UTC)
Received: by mail-wr1-x431.google.com with SMTP id f17so2207501wrt.6
 for <intel-gfx@lists.freedesktop.org>; Wed, 21 Jul 2021 06:30:23 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=ffwll.ch; s=google;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=ORhPItfkMHUiju+HLIzApTY9RhBe7pUyzlHN/iorEkY=;
 b=HsGpjM/KTxfUKKVUCpywVTiXGD1uyNH6hQu01j26tWbEllvcwN+dVQYJW1F2T+ciRs
 U8nwwfPdfn4jgx8bfsi62k+pPyjqgl3Uu7NQvpdTQzWPFzSBEpFtDVX1lgkHU5r7PGZF
 QW57tDSxPaBaWsIgjPSHJ/155Ss0H6xeK5vIQ=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=ORhPItfkMHUiju+HLIzApTY9RhBe7pUyzlHN/iorEkY=;
 b=qyosqjhhAtANSmPsIMtPotmYwnp7YFy1Pg48aVdcT9vrTQT34b4ivxj33ZMSCZ2HZY
 X1w+3gYhDTQq0Ep95x89qzsNZVQ7fbw298Iw3DOK11yokkYptWucoNPyP0Kvf3NbPgMK
 v5fFERaDRArrQuZ9KHhHXLryWv2lMoSipRUk06D1Oa3WYJeFNTNjRJE6O85Q+S5dSgq2
 uhaslSLddJgVbmVkI1cxQNrIUBf/MI2G8hSQi8GzIdn+bstFq6aYUFpWHqOJc6Q+L+dw
 bPNwnaAOb4DEFOjxKbaRxCMnovOiFGEFVQyQbS2lPrhv8TEJVK34njgqCEkQehch51tR
 31bw==
X-Gm-Message-State: AOAM53374sKsJDNQKIyq9uezxzcEyppIPcqQf1q5Y33OCOfL7H4dAFFW
 J9ZB2bMhLN+kChsF0TC4yweMWw==
X-Google-Smtp-Source: ABdhPJxJJpAACdYy+t1JTf1gQNQ+DM1VmV+HM9GzTis6ajlcYCCaeNM5qGdtyJ4W6E7QEddJCVqeHA==
X-Received: by 2002:a5d:4e0d:: with SMTP id p13mr42754262wrt.372.1626874221789; 
 Wed, 21 Jul 2021 06:30:21 -0700 (PDT)
Received: from phenom.ffwll.local ([2a02:168:57f4:0:efd0:b9e5:5ae6:c2fa])
 by smtp.gmail.com with ESMTPSA id l22sm4962624wmp.41.2021.07.21.06.30.20
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 21 Jul 2021 06:30:21 -0700 (PDT)
From: Daniel Vetter <daniel.vetter@ffwll.ch>
To: DRI Development <dri-devel@lists.freedesktop.org>
Date: Wed, 21 Jul 2021 15:30:13 +0200
Message-Id: <20210721133014.3880922-2-daniel.vetter@ffwll.ch>
X-Mailer: git-send-email 2.32.0
In-Reply-To: <20210721133014.3880922-1-daniel.vetter@ffwll.ch>
References: <20210721133014.3880922-1-daniel.vetter@ffwll.ch>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/3] drm/plane: check that fb_damage is set up
 when used
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: David Airlie <airlied@linux.ie>, Daniel Vetter <daniel.vetter@ffwll.ch>,
 Intel Graphics Development <intel-gfx@lists.freedesktop.org>,
 Maxime Ripard <mripard@kernel.org>, Thomas Zimmermann <tzimmermann@suse.de>,
 Daniel Vetter <daniel.vetter@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlcmUncyB0d28gc3RhZ2VzIG9mIG1hbnVhbCB1cGxvYWQvaW52YWxpZGF0ZSBkaXNwbGF5czoK
LSBqdXN0IGhhbmRsaW5nIGRpcnR5ZmIgYW5kIHVwbG9hZGluZyB0aGUgZW50aXJlIGZiIGFsbCB0
aGUgdGltZQotIGxvb2tpbmcgYXQgZGFtYWdlIGNsaXBzCgpJbiB0aGUgbGF0dGVyIGNhc2Ugd2Ug
c3VwcG9ydCBpdCB0aHJvdWdoIGZiZGV2IGVtdWxhdGlvbiAod2l0aApmYl9kZWZpbyksIGF0b21p
YyBwcm9wZXJ0eSwgYW5kIHdpdGggdGhlIGRpcnRmeSBjbGlwIHJlY3RzLgoKTWFrZSBzdXJlIGF0
IGxlYXN0IHRoZSBhdG9taWMgcHJvcGVydHkgaXMgc2V0IHVwIGFzIHRoZSBtYWluIG9mZmljaWFs
CmludGVyZmFjZSBmb3IgdGhpcy4gSWRlYWxseSB3ZSdkIGFsc28gY2hlY2sgdGhhdApkcm1fYXRv
bWljX2hlbHBlcl9kaXJ0eWZiKCkgaXMgdXNlZCBhbmQgdGhhdCBmYmRldiBkZWZpbyBpcyBzZXQg
dXAsCmJ1dCB0aGF0J3MgcXVpdGUgYSBiaXQgaGFyZGVyIHRvIGRvLiBJZGVhcyB2ZXJ5IG11Y2gg
d2VsY29tZS4KCkZyb20gYSBjdXJzb3IgYXVkaXQgZHJpdmVycyBzZWVtIHRvIGJlIGdldHRpbmcg
dGhpcyByaWdodCBtb3N0bHksIGJ1dApiZXR0ZXIgdG8gbWFrZSBzdXJlLiBBdCBsZWFzdCBubyBv
bmUgaXMgYnlwYXNzaW5nIHRoZSBhY2Nlc3NvcgpmdW5jdGlvbi4KCkNjOiBWaWxsZSBTeXJqw6Rs
w6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpDYzogR3dhbi1neWVvbmcgTXVuIDxn
d2FuLWd5ZW9uZy5tdW5AaW50ZWwuY29tPgpDYzogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8am9z
ZS5zb3V6YUBpbnRlbC5jb20+CkNjOiBIYW5zIGRlIEdvZWRlIDxoZGVnb2VkZUByZWRoYXQuY29t
PgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWwgVmV0dGVyIDxkYW5pZWwudmV0dGVyQGludGVsLmNvbT4K
Q2M6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+
CkNjOiBNYXhpbWUgUmlwYXJkIDxtcmlwYXJkQGtlcm5lbC5vcmc+CkNjOiBUaG9tYXMgWmltbWVy
bWFubiA8dHppbW1lcm1hbm5Ac3VzZS5kZT4KQ2M6IERhdmlkIEFpcmxpZSA8YWlybGllZEBsaW51
eC5pZT4KQ2M6IERhbmllbCBWZXR0ZXIgPGRhbmllbEBmZndsbC5jaD4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vZHJtX3BsYW5lLmMgfCA0MiArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrCiBpbmNsdWRlL2RybS9kcm1fcGxhbmUuaCAgICAgfCAzNiArKysrLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDQ2IGluc2VydGlvbnMoKyksIDMyIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9kcm1fcGxhbmUuYyBiL2RyaXZl
cnMvZ3B1L2RybS9kcm1fcGxhbmUuYwppbmRleCBiMzczOTU4ZWNiMzAuLjQwZjA5OWM2N2E4ZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2RybV9wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9kcm1fcGxhbmUuYwpAQCAtMTM5Nyw2ICsxMzk3LDQ4IEBAIGludCBkcm1fbW9kZV9wYWdl
X2ZsaXBfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlyZXR1cm4gcmV0OwogfQogCisv
KioKKyAqIGRybV9wbGFuZV9nZXRfZGFtYWdlX2NsaXBzX2NvdW50IC0gUmV0dXJucyBkYW1hZ2Ug
Y2xpcHMgY291bnQuCisgKiBAc3RhdGU6IFBsYW5lIHN0YXRlLgorICoKKyAqIFNpbXBsZSBoZWxw
ZXIgdG8gZ2V0IHRoZSBudW1iZXIgb2YgJmRybV9tb2RlX3JlY3QgY2xpcHMgc2V0IGJ5IHVzZXIt
c3BhY2UKKyAqIGR1cmluZyBwbGFuZSB1cGRhdGUuCisgKgorICogUmV0dXJuOiBOdW1iZXIgb2Yg
Y2xpcHMgaW4gcGxhbmUgZmJfZGFtYWdlX2NsaXBzIGJsb2IgcHJvcGVydHkuCisgKi8KK3Vuc2ln
bmVkIGludAorZHJtX3BsYW5lX2dldF9kYW1hZ2VfY2xpcHNfY291bnQoY29uc3Qgc3RydWN0IGRy
bV9wbGFuZV9zdGF0ZSAqc3RhdGUpCit7CisJcmV0dXJuIChzdGF0ZSAmJiBzdGF0ZS0+ZmJfZGFt
YWdlX2NsaXBzKSA/CisJCXN0YXRlLT5mYl9kYW1hZ2VfY2xpcHMtPmxlbmd0aC9zaXplb2Yoc3Ry
dWN0IGRybV9tb2RlX3JlY3QpIDogMDsKK30KK0VYUE9SVF9TWU1CT0woZHJtX3BsYW5lX2dldF9k
YW1hZ2VfY2xpcHNfY291bnQpOworCisvKioKKyAqIGRybV9wbGFuZV9nZXRfZGFtYWdlX2NsaXBz
IC0gUmV0dXJucyBkYW1hZ2UgY2xpcHMuCisgKiBAc3RhdGU6IFBsYW5lIHN0YXRlLgorICoKKyAq
IE5vdGUgdGhhdCB0aGlzIGZ1bmN0aW9uIHJldHVybnMgdWFwaSB0eXBlICZkcm1fbW9kZV9yZWN0
LiBEcml2ZXJzIG1pZ2h0IHdhbnQKKyAqIHRvIHVzZSB0aGUgaGVscGVyIGZ1bmN0aW9ucyBkcm1f
YXRvbWljX2hlbHBlcl9kYW1hZ2VfaXRlcl9pbml0KCkgYW5kCisgKiBkcm1fYXRvbWljX2hlbHBl
cl9kYW1hZ2VfaXRlcl9uZXh0KCkgb3IgZHJtX2F0b21pY19oZWxwZXJfZGFtYWdlX21lcmdlZCgp
IGlmCisgKiB0aGUgZHJpdmVyIGNhbiBvbmx5IGhhbmRsZSBhIHNpbmdsZSBkYW1hZ2UgcmVnaW9u
IGF0IG1vc3QuCisgKgorICogUmV0dXJuOiBEYW1hZ2UgY2xpcHMgaW4gcGxhbmUgZmJfZGFtYWdl
X2NsaXBzIGJsb2IgcHJvcGVydHkuCisgKi8KK3N0cnVjdCBkcm1fbW9kZV9yZWN0ICoKK2RybV9w
bGFuZV9nZXRfZGFtYWdlX2NsaXBzKGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRl
KQoreworCXN0cnVjdCBkcm1fbW9kZV9jb25maWcgKmNvbmZpZyA9ICZzdGF0ZS0+cGxhbmUtPmRl
di0+bW9kZV9jb25maWc7CisKKwkvKiBjaGVjayB0aGF0IGRybV9wbGFuZV9lbmFibGVfZmJfZGFt
YWdlX2NsaXBzKCkgd2FzIGNhbGxlZCAqLworCVdBUk5fT05fT05DRSghZHJtX21vZGVfb2JqX2Zp
bmRfcHJvcF9pZCgmc3RhdGUtPnBsYW5lLT5iYXNlLAorCQkJCQkJY29uZmlnLT5wcm9wX2ZiX2Rh
bWFnZV9jbGlwcy0+YmFzZS5pZCkpOworCisJcmV0dXJuIChzdHJ1Y3QgZHJtX21vZGVfcmVjdCAq
KSgoc3RhdGUgJiYgc3RhdGUtPmZiX2RhbWFnZV9jbGlwcykgPworCQkJCQlzdGF0ZS0+ZmJfZGFt
YWdlX2NsaXBzLT5kYXRhIDogTlVMTCk7Cit9CitFWFBPUlRfU1lNQk9MKGRybV9wbGFuZV9nZXRf
ZGFtYWdlX2NsaXBzKTsKKwogc3RydWN0IGRybV9wcm9wZXJ0eSAqCiBkcm1fY3JlYXRlX3NjYWxp
bmdfZmlsdGVyX3Byb3Aoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCSAgICAgICB1bnNpZ25l
ZCBpbnQgc3VwcG9ydGVkX2ZpbHRlcnMpCmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fcGxh
bmUuaCBiL2luY2x1ZGUvZHJtL2RybV9wbGFuZS5oCmluZGV4IDdmN2Q1MTQ4MzEwYy4uYTI2ODRh
YWI4MzcyIDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fcGxhbmUuaAorKysgYi9pbmNsdWRl
L2RybS9kcm1fcGxhbmUuaApAQCAtODk3LDM5ICs4OTcsMTEgQEAgc3RhdGljIGlubGluZSBzdHJ1
Y3QgZHJtX3BsYW5lICpkcm1fcGxhbmVfZmluZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiBi
b29sIGRybV9hbnlfcGxhbmVfaGFzX2Zvcm1hdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJ
ICAgICAgdTMyIGZvcm1hdCwgdTY0IG1vZGlmaWVyKTsKLS8qKgotICogZHJtX3BsYW5lX2dldF9k
YW1hZ2VfY2xpcHNfY291bnQgLSBSZXR1cm5zIGRhbWFnZSBjbGlwcyBjb3VudC4KLSAqIEBzdGF0
ZTogUGxhbmUgc3RhdGUuCi0gKgotICogU2ltcGxlIGhlbHBlciB0byBnZXQgdGhlIG51bWJlciBv
ZiAmZHJtX21vZGVfcmVjdCBjbGlwcyBzZXQgYnkgdXNlci1zcGFjZQotICogZHVyaW5nIHBsYW5l
IHVwZGF0ZS4KLSAqCi0gKiBSZXR1cm46IE51bWJlciBvZiBjbGlwcyBpbiBwbGFuZSBmYl9kYW1h
Z2VfY2xpcHMgYmxvYiBwcm9wZXJ0eS4KLSAqLwotc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQK
LWRybV9wbGFuZV9nZXRfZGFtYWdlX2NsaXBzX2NvdW50KGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVf
c3RhdGUgKnN0YXRlKQotewotCXJldHVybiAoc3RhdGUgJiYgc3RhdGUtPmZiX2RhbWFnZV9jbGlw
cykgPwotCQlzdGF0ZS0+ZmJfZGFtYWdlX2NsaXBzLT5sZW5ndGgvc2l6ZW9mKHN0cnVjdCBkcm1f
bW9kZV9yZWN0KSA6IDA7Ci19Cit1bnNpZ25lZCBpbnQKK2RybV9wbGFuZV9nZXRfZGFtYWdlX2Ns
aXBzX2NvdW50KGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKTsKIAotLyoqCi0g
KiBkcm1fcGxhbmVfZ2V0X2RhbWFnZV9jbGlwcyAtIFJldHVybnMgZGFtYWdlIGNsaXBzLgotICog
QHN0YXRlOiBQbGFuZSBzdGF0ZS4KLSAqCi0gKiBOb3RlIHRoYXQgdGhpcyBmdW5jdGlvbiByZXR1
cm5zIHVhcGkgdHlwZSAmZHJtX21vZGVfcmVjdC4gRHJpdmVycyBtaWdodCB3YW50Ci0gKiB0byB1
c2UgdGhlIGhlbHBlciBmdW5jdGlvbnMgZHJtX2F0b21pY19oZWxwZXJfZGFtYWdlX2l0ZXJfaW5p
dCgpIGFuZAotICogZHJtX2F0b21pY19oZWxwZXJfZGFtYWdlX2l0ZXJfbmV4dCgpIG9yIGRybV9h
dG9taWNfaGVscGVyX2RhbWFnZV9tZXJnZWQoKSBpZgotICogdGhlIGRyaXZlciBjYW4gb25seSBo
YW5kbGUgYSBzaW5nbGUgZGFtYWdlIHJlZ2lvbiBhdCBtb3N0LgotICoKLSAqIFJldHVybjogRGFt
YWdlIGNsaXBzIGluIHBsYW5lIGZiX2RhbWFnZV9jbGlwcyBibG9iIHByb3BlcnR5LgotICovCi1z
dGF0aWMgaW5saW5lIHN0cnVjdCBkcm1fbW9kZV9yZWN0ICoKLWRybV9wbGFuZV9nZXRfZGFtYWdl
X2NsaXBzKGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnN0YXRlKQotewotCXJldHVybiAo
c3RydWN0IGRybV9tb2RlX3JlY3QgKikoKHN0YXRlICYmIHN0YXRlLT5mYl9kYW1hZ2VfY2xpcHMp
ID8KLQkJCQkJc3RhdGUtPmZiX2RhbWFnZV9jbGlwcy0+ZGF0YSA6IE5VTEwpOwotfQorc3RydWN0
IGRybV9tb2RlX3JlY3QgKgorZHJtX3BsYW5lX2dldF9kYW1hZ2VfY2xpcHMoY29uc3Qgc3RydWN0
IGRybV9wbGFuZV9zdGF0ZSAqc3RhdGUpOwogCiBpbnQgZHJtX3BsYW5lX2NyZWF0ZV9zY2FsaW5n
X2ZpbHRlcl9wcm9wZXJ0eShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkJCQkJICAgICB1bnNp
Z25lZCBpbnQgc3VwcG9ydGVkX2ZpbHRlcnMpOwotLSAKMi4zMi4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

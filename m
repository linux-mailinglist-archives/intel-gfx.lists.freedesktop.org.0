Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3CD24CB937
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 13:35:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 958256EB43;
	Fri,  4 Oct 2019 11:35:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AA2816EB35
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 11:35:23 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 13:35:06 +0200
Message-Id: <20191004113514.17064-17-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
References: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 16/24] drm/i915: Enable big joiner support in
 enable and disable sequences.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSB2ZHNjIHdvcmsgd2hlbiBubyBvdXRwdXQgaXMgZW5hYmxlZC4gVGhlIGJpZyBqb2luZXIg
bmVlZHMgVkRTQwpvbiB0aGUgc2xhdmUsIHNvIGVuYWJsZSBpdCBhbmQgc2V0IHRoZSBhcHByb3By
aWF0ZSBiaXRzLgpBbHNvIHVwZGF0ZSB0aW1lc3RhbXBpbmcgY29uc3RhbnRzLCBiZWNhdXNlIHNs
YXZlIGNydGMncyBhcmUgbm90CnVwZGF0ZWQgaW4gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX2xl
Z2FjeV9tb2Rlc2V0X3N0YXRlKCkuCgpUaGlzIHNob3VsZCBiZSBlbm91Z2ggdG8gYnJpbmcgdXAg
Q1JUQydzIGluIGEgYmlnIGpvaW5lciBjb25maWd1cmF0aW9uLAp3aXRob3V0IGFueSBwbGFuZSBj
b25maWd1cmF0aW9uIG9uIHRoZSBzZWNvbmQgcGlwZSB5ZXQuCgpIT1dFVkVSLCB3ZSBicmluZyB1
cCB0aGUgY3J0YydzIGluIHRoZSB3cm9uZyBvcmRlci4gV2UgbmVlZCB0byBtYWtlCnN1cmUgdGhh
dCB0aGUgbWFzdGVyIGNydGMgaXMgYnJvdWdodCB1cCBhZnRlciB0aGUgc2xhdmUgY3J0Yywgd2UK
ZG9uJ3QgZG8gdGhhdCB5ZXQuIFRoaXMgaXMgZG9uZSBjb3JyZWN0bHkgbGF0ZXIgaW4gdGhpcyBz
ZXJpZXMuCgpUaGUgbmV4dCBzdGVwcyBhcmUgdG8gYWRkIGF0b21pYyBjb21taXQsIGFuZCBtYWtl
IHN1cmUgd2UgZW5hYmxlIGFuZAp1cGRhdGUgYm90aCBtYXN0ZXIgYW5kIHNsYXZlIGluIHRoZSBj
b3JyZWN0IG9yZGVyLgoKU2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4u
bGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RkaS5jICAgICAgfCAgNTUgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYyAgfCA0MDIgKysrKysrKysrKysrLS0tLS0tCiAuLi4vZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMTcgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgIHwgIDE4ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYyAgICAgfCAxMjIgKysrKy0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuaCAgICAgfCAgIDIgKwogNiBmaWxlcyBjaGFu
Z2VkLCA0MTggaW5zZXJ0aW9ucygrKSwgMTk4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDA1MmNhZjIzNzJkMC4uNWNlMTFlYmQ4OGRh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTE3MzgsNiAr
MTczOCwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfY2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCQlza2xfZGRpX2Nsb2NrX2dldChlbmNvZGVyLCBwaXBlX2NvbmZp
Zyk7CiAJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8PSA4KQogCQloc3dfZGRpX2Nsb2Nr
X2dldChlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CisKKwlpZiAocGlwZV9jb25maWctPmJpZ2pvaW5l
cikgeworCQlwaXBlX2NvbmZpZy0+aHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfY2xvY2sgPQorCQkJ
cGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKworCQlwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrIC89IDI7CisJfQogfQogCiB2b2lkIGludGVs
X2RkaV9zZXRfcGlwZV9zZXR0aW5ncyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKQEAgLTIyMjYsMTMgKzIyMzMsNiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfZ2V0
X3Bvd2VyX2RvbWFpbnMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICAgIGludGVs
X3BoeV9pc190YyhkZXZfcHJpdiwgcGh5KSkKIAkJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2
X3ByaXYsCiAJCQkJCWludGVsX2RkaV9tYWluX2xpbmtfYXV4X2RvbWFpbihkaWdfcG9ydCkpOwot
Ci0JLyoKLQkgKiBWRFNDIHBvd2VyIGlzIG5lZWRlZCB3aGVuIERTQyBpcyBlbmFibGVkCi0JICov
Ci0JaWYgKGNydGNfc3RhdGUtPmRzY19wYXJhbXMuY29tcHJlc3Npb25fZW5hYmxlKQotCQlpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwKLQkJCQkJaW50ZWxfZHNjX3Bvd2VyX2RvbWFp
bihjcnRjX3N0YXRlKSk7CiB9CiAKIHZvaWQgaW50ZWxfZGRpX2VuYWJsZV9waXBlX2Nsb2NrKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQpAQCAtMzQyOCw3ICszNDI4
LDggQEAgc3RhdGljIHZvaWQgdGdsX2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCiAJLyogNy5sICovCiAJaW50ZWxfZGRpX2VuYWJsZV9mZWMoZW5jb2Rl
ciwgY3J0Y19zdGF0ZSk7Ci0JaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVyLCBjcnRjX3N0YXRlKTsK
KwlpZiAoIWNydGNfc3RhdGUtPmJpZ2pvaW5lcikKKwkJaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVy
LCBjcnRjX3N0YXRlKTsKIH0KIAogc3RhdGljIHZvaWQgaHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMzQ5OSw3ICszNTAwLDggQEAgc3RhdGlj
IHZvaWQgaHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCWlmICghaXNfbXN0KQogCQlpbnRlbF9kZGlfZW5hYmxlX3BpcGVfY2xvY2soY3J0Y19zdGF0
ZSk7CiAKLQlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3RhdGUpOworCWlmICghY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyKQorCQlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3Rh
dGUpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKQEAgLTQxMTMsMTkgKzQxMTUsMTggQEAgdm9pZCBpbnRlbF9k
ZGlfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJCWNydGNfc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsID0gMjsKIH0KIAotdm9pZCBp
bnRlbF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKLQkJCSAg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQorc3RhdGljIHZvaWQgaW50ZWxf
ZGRpX3JlYWRfZnVuY19jdGwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJICAg
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVh
cGkuY3J0Yyk7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gcGlwZV9jb25maWct
PmNwdV90cmFuc2NvZGVyOwogCXUzMiB0ZW1wLCBmbGFncyA9IDA7CiAKLQkvKiBYWFg6IERTSSB0
cmFuc2NvZGVyIHBhcmFub2lhICovCi0JaWYgKFdBUk5fT04odHJhbnNjb2Rlcl9pc19kc2koY3B1
X3RyYW5zY29kZXIpKSkKKwl0ZW1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NUTChjcHVf
dHJhbnNjb2RlcikpOworCWlmICghKHRlbXAgJiBUUkFOU19ERElfRlVOQ19FTkFCTEUpKQogCQly
ZXR1cm47CiAKLQl0ZW1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NUTChjcHVfdHJhbnNj
b2RlcikpOwogCWlmICh0ZW1wICYgVFJBTlNfRERJX1BIU1lOQykKIAkJZmxhZ3MgfD0gRFJNX01P
REVfRkxBR19QSFNZTkM7CiAJZWxzZQpAQCAtNDIxMSw2ICs0MjEyLDI5IEBAIHZvaWQgaW50ZWxf
ZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZGVmYXVsdDoK
IAkJYnJlYWs7CiAJfQorfQorCit2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAorCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gcGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyOworCisJLyogWFhYOiBEU0kgdHJhbnNjb2RlciBwYXJh
bm9pYSAqLworCWlmIChXQVJOX09OKHRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkp
CisJCXJldHVybjsKKworCWludGVsX2RkaV9yZWFkX2Z1bmNfY3RsKGVuY29kZXIsIHBpcGVfY29u
ZmlnKTsKKwlpZiAocGlwZV9jb25maWctPmJpZ2pvaW5lcl9zbGF2ZSkgeworCQkvKiByZWFkIG91
dCBwaXBlIHNldHRpbmdzIGZyb20gbWFzdGVyICovCisJCWVudW0gdHJhbnNjb2RlciBzYXZlID0g
cGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyOworCisJCSAvKiBPdXIgb3duIHRyYW5zY29kZXIg
bmVlZHMgdG8gYmUgZGlzYWJsZWQgd2hlbiByZWFkaW5nIGl0IGluIGludGVsX2RkaV9yZWFkX2Z1
bmNfY3RsKCkgKi8KKwkJV0FSTl9PTihwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzKTsKKwkJcGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyID0gKGVudW0gdHJhbnNjb2RlcilwaXBlX2NvbmZpZy0+
Ymlnam9pbmVyX2xpbmtlZF9jcnRjLT5waXBlOworCQlpbnRlbF9kZGlfcmVhZF9mdW5jX2N0bChl
bmNvZGVyLCBwaXBlX2NvbmZpZyk7CisJCXBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciA9IHNh
dmU7CisJfQogCiAJcGlwZV9jb25maWctPmhhc19hdWRpbyA9CiAJCWludGVsX2RkaV9pc19hdWRp
b19lbmFibGVkKGRldl9wcml2LCBjcHVfdHJhbnNjb2Rlcik7CkBAIC00MjM1LDcgKzQyNTksOCBA
QCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQlkZXZfcHJpdi0+dmJ0LmVkcC5icHAgPSBwaXBlX2NvbmZpZy0+cGlwZV9icHA7CiAJfQog
Ci0JaW50ZWxfZGRpX2Nsb2NrX2dldChlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CisJaWYgKCFwaXBl
X2NvbmZpZy0+Ymlnam9pbmVyX3NsYXZlKQorCQlpbnRlbF9kZGlfY2xvY2tfZ2V0KGVuY29kZXIs
IHBpcGVfY29uZmlnKTsKIAogCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKIAkJcGlwZV9jb25m
aWctPmxhbmVfbGF0X29wdGltX21hc2sgPQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwppbmRleCBjMmIzYzdiNmYzOWIuLmZjNmViNzkwYzY2YiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTY0MTEsNiAr
NjQxMSw0NSBAQCBzdGF0aWMgdm9pZCBpY2xfcGlwZV9tYnVzX2VuYWJsZShzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YykKIAlJOTE1X1dSSVRFKFBJUEVfTUJVU19EQk9YX0NUTChwaXBlKSwgdmFsKTsK
IH0KIAorc3RhdGljIHZvaWQgaWNsX2RkaV9iaWdqb2luZXJfcHJlX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICptYXN0ZXIgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm1hc3Rl
cl9jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlOwor
CXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyID0gTlVMTDsKKwlpbnQgaTsKKworCWlmIChjcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUp
CisJCW1hc3RlciA9IGNydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YzsKKworCW1hc3Rl
cl9jcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgbWFz
dGVyKTsKKworCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoJnN0YXRlLT5iYXNlLCBj
b25uLCBjb25uX3N0YXRlLCBpKSB7CisJCWlmIChjb25uX3N0YXRlLT5jcnRjICE9ICZtYXN0ZXIt
PmJhc2UpCisJCQljb250aW51ZTsKKworCQllbmNvZGVyID0gdG9faW50ZWxfZW5jb2Rlcihjb25u
X3N0YXRlLT5iZXN0X2VuY29kZXIpOworCQlicmVhazsKKwl9CisKKwlpZiAoIWNydGNfc3RhdGUt
PmJpZ2pvaW5lcl9zbGF2ZSkgeworCQkvKiBuZWVkIHRvIGVuYWJsZSBWRFNDLCB3aGljaCB3ZSBz
a2lwcGVkIGluIHByZS1lbmFibGUgKi8KKwkJaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVyLCBjcnRj
X3N0YXRlKTsKKwl9IGVsc2UgeworCQkvKgorCQkgKiBFbmFibGUgc2VxdWVuY2Ugc3RlcHMgMS03
IG9uIGJpZ2pvaW5lciBtYXN0ZXIKKwkJICovCisJCWludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5h
YmxlKG1hc3RlciwgbWFzdGVyX2NydGNfc3RhdGUsIHN0YXRlKTsKKwkJaW50ZWxfZW5hYmxlX3No
YXJlZF9kcGxsKG1hc3Rlcl9jcnRjX3N0YXRlKTsKKwkJaW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJs
ZShtYXN0ZXIsIG1hc3Rlcl9jcnRjX3N0YXRlLCBzdGF0ZSk7CisKKwkJLyogYW5kIERTQyBvbiBz
bGF2ZSAqLworCQlpbnRlbF9kc2NfZW5hYmxlKE5VTEwsIGNydGNfc3RhdGUpOworCX0KK30KKwog
c3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcsCiAJCQkJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CkBA
IC02NDI0LDM3ICs2NDYzLDM4IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCWlmIChXQVJOX09OKGludGVsX2Ny
dGMtPmFjdGl2ZSkpCiAJCXJldHVybjsKIAotCWludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5hYmxl
KGludGVsX2NydGMsIHBpcGVfY29uZmlnLCBzdGF0ZSk7CisJaWYgKCFwaXBlX2NvbmZpZy0+Ymln
am9pbmVyKSB7CisJCWludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5hYmxlKGludGVsX2NydGMsIHBp
cGVfY29uZmlnLCBzdGF0ZSk7CiAKLQlpZiAocGlwZV9jb25maWctPnNoYXJlZF9kcGxsKQotCQlp
bnRlbF9lbmFibGVfc2hhcmVkX2RwbGwocGlwZV9jb25maWcpOworCQlpZiAocGlwZV9jb25maWct
PnNoYXJlZF9kcGxsKQorCQkJaW50ZWxfZW5hYmxlX3NoYXJlZF9kcGxsKHBpcGVfY29uZmlnKTsK
IAotCWludGVsX2VuY29kZXJzX3ByZV9lbmFibGUoaW50ZWxfY3J0YywgcGlwZV9jb25maWcsIHN0
YXRlKTsKKwkJaW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJsZShpbnRlbF9jcnRjLCBwaXBlX2NvbmZp
Zywgc3RhdGUpOworCX0gZWxzZSB7CisJCWljbF9kZGlfYmlnam9pbmVyX3ByZV9lbmFibGUoc3Rh
dGUsIHBpcGVfY29uZmlnKTsKKwl9CiAKLQlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2Rlcihw
aXBlX2NvbmZpZykpCi0JCWludGVsX2RwX3NldF9tX24ocGlwZV9jb25maWcsIE0xX04xKTsKKwlp
bnRlbF9zZXRfcGlwZV9zcmNfc2l6ZShwaXBlX2NvbmZpZyk7CisJaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gOSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCQliZHdfc2V0X3BpcGVtaXNj
KHBpcGVfY29uZmlnKTsKIAotCWlmICghdHJhbnNjb2Rlcl9pc19kc2koY3B1X3RyYW5zY29kZXIp
KQotCQlpbnRlbF9zZXRfdHJhbnNjb2Rlcl90aW1pbmdzKHBpcGVfY29uZmlnKTsKKwlpZiAoIXBp
cGVfY29uZmlnLT5iaWdqb2luZXJfc2xhdmUgJiYgIXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFu
c2NvZGVyKSkgeworCQlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2RlcihwaXBlX2NvbmZpZykp
CisJCQlpbnRlbF9kcF9zZXRfbV9uKHBpcGVfY29uZmlnLCBNMV9OMSk7CiAKLQlpbnRlbF9zZXRf
cGlwZV9zcmNfc2l6ZShwaXBlX2NvbmZpZyk7CisJCWludGVsX3NldF90cmFuc2NvZGVyX3RpbWlu
Z3MocGlwZV9jb25maWcpOwogCi0JaWYgKGNwdV90cmFuc2NvZGVyICE9IFRSQU5TQ09ERVJfRURQ
ICYmCi0JICAgICF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpIHsKLQkJSTkxNV9X
UklURShQSVBFX01VTFQoY3B1X3RyYW5zY29kZXIpLAotCQkJICAgcGlwZV9jb25maWctPnBpeGVs
X211bHRpcGxpZXIgLSAxKTsKLQl9CisJCWlmIChjcHVfdHJhbnNjb2RlciAhPSBUUkFOU0NPREVS
X0VEUCkKKwkJCUk5MTVfV1JJVEUoUElQRV9NVUxUKGNwdV90cmFuc2NvZGVyKSwKKwkJCQkgIHBp
cGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyIC0gMSk7CiAKLQlpZiAocGlwZV9jb25maWctPmhh
c19wY2hfZW5jb2RlcikgewotCQlpbnRlbF9jcHVfdHJhbnNjb2Rlcl9zZXRfbV9uKHBpcGVfY29u
ZmlnLAotCQkJCQkgICAgICZwaXBlX2NvbmZpZy0+ZmRpX21fbiwgTlVMTCk7Ci0JfQorCQlpZiAo
cGlwZV9jb25maWctPmhhc19wY2hfZW5jb2RlcikgeworCQkJaW50ZWxfY3B1X3RyYW5zY29kZXJf
c2V0X21fbihwaXBlX2NvbmZpZywKKwkJCQkJCSAgICAmcGlwZV9jb25maWctPmZkaV9tX24sIE5V
TEwpOworCQl9CiAKLQlpZiAoIXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkKIAkJ
aGFzd2VsbF9zZXRfcGlwZWNvbmYocGlwZV9jb25maWcpOwotCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gOSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQotCQliZHdfc2V0X3BpcGVtaXNj
KHBpcGVfY29uZmlnKTsKKwl9CiAKIAlpbnRlbF9jcnRjLT5hY3RpdmUgPSB0cnVlOwogCkBAIC02
NDgyLDkgKzY1MjIsMTEgQEAgc3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2VuYWJsZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTEpCiAJCWljbF9zZXRfcGlwZV9jaGlja2VuKGludGVsX2NydGMpOwogCi0JaW50ZWxfZGRp
X3NldF9waXBlX3NldHRpbmdzKHBpcGVfY29uZmlnKTsKLQlpZiAoIXRyYW5zY29kZXJfaXNfZHNp
KGNwdV90cmFuc2NvZGVyKSkKKwlpZiAoIXBpcGVfY29uZmlnLT5iaWdqb2luZXJfc2xhdmUgJiYg
IXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkgeworCQlpbnRlbF9kZGlfc2V0X3Bp
cGVfc2V0dGluZ3MocGlwZV9jb25maWcpOworCiAJCWludGVsX2RkaV9lbmFibGVfdHJhbnNjb2Rl
cl9mdW5jKHBpcGVfY29uZmlnKTsKKwl9CiAKIAlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlh
bF93YXRlcm1hcmtzICE9IE5VTEwpCiAJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJt
YXJrcyhzdGF0ZSwgcGlwZV9jb25maWcpOwpAQCAtNjQ5Myw4ICs2NTM1LDEwIEBAIHN0YXRpYyB2
b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29u
ZmlnLAogCQlpY2xfcGlwZV9tYnVzX2VuYWJsZShpbnRlbF9jcnRjKTsKIAogCS8qIFhYWDogRG8g
dGhlIHBpcGUgYXNzZXJ0aW9ucyBhdCB0aGUgcmlnaHQgcGxhY2UgZm9yIEJYVCBEU0kuICovCi0J
aWYgKCF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpCisJaWYgKCFwaXBlX2NvbmZp
Zy0+Ymlnam9pbmVyX3NsYXZlICYmICF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2Rlcikp
CiAJCWludGVsX2VuYWJsZV9waXBlKHBpcGVfY29uZmlnKTsKKwllbHNlCisJCXRyYWNlX2ludGVs
X3BpcGVfZW5hYmxlKGludGVsX2NydGMpOwogCiAJaWYgKHBpcGVfY29uZmlnLT5oYXNfcGNoX2Vu
Y29kZXIpCiAJCWxwdF9wY2hfZW5hYmxlKHN0YXRlLCBwaXBlX2NvbmZpZyk7CkBAIC02NjI1LDkg
KzY2NjksMjcgQEAgc3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2Rpc2FibGUoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAogCWVsc2UKIAkJaXJvbmxha2VfcGZpdF9kaXNh
YmxlKG9sZF9jcnRjX3N0YXRlKTsKIAotCWludGVsX2VuY29kZXJzX3Bvc3RfZGlzYWJsZShpbnRl
bF9jcnRjLCBvbGRfY3J0Y19zdGF0ZSwgc3RhdGUpOworCWlmIChvbGRfY3J0Y19zdGF0ZS0+Ymln
am9pbmVyKSB7CisJCXN0cnVjdCBpbnRlbF9jcnRjICptYXN0ZXI7CisJCXN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICptYXN0ZXJfY3J0Y19zdGF0ZTsKIAotCWludGVsX2VuY29kZXJzX3Bvc3RfcGxs
X2Rpc2FibGUoaW50ZWxfY3J0Yywgb2xkX2NydGNfc3RhdGUsIHN0YXRlKTsKKwkJLyogcG9ydHMg
YXJlIGRpc2FibGVkIGZyb20gdGhlIHNsYXZlLCBhZnRlciBpdCBkZWNvbmZpZ3VyZXMgKi8KKwkJ
aWYgKCFvbGRfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQkJcmV0dXJuOworCisJCW1h
c3RlciA9IG9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisJCW1hc3Rlcl9j
cnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgbWFzdGVy
KTsKKworCQlpbnRlbF9kZGlfZGlzYWJsZV9waXBlX2Nsb2NrKG9sZF9jcnRjX3N0YXRlKTsKKwor
CQkvKiBkaXNhYmxlIHBvcnRzIG9uIHRoZSBtYXN0ZXIgY3J0YyAqLworCQlpbnRlbF9lbmNvZGVy
c19wb3N0X2Rpc2FibGUobWFzdGVyLCBtYXN0ZXJfY3J0Y19zdGF0ZSwgc3RhdGUpOworCQlpbnRl
bF9lbmNvZGVyc19wb3N0X3BsbF9kaXNhYmxlKG1hc3RlciwgbWFzdGVyX2NydGNfc3RhdGUsIHN0
YXRlKTsKKwl9IGVsc2UgeworCQlpbnRlbF9lbmNvZGVyc19wb3N0X2Rpc2FibGUoaW50ZWxfY3J0
Yywgb2xkX2NydGNfc3RhdGUsIHN0YXRlKTsKKworCQlpbnRlbF9lbmNvZGVyc19wb3N0X3BsbF9k
aXNhYmxlKGludGVsX2NydGMsIG9sZF9jcnRjX3N0YXRlLCBzdGF0ZSk7CisJfQogfQogCiBzdGF0
aWMgdm9pZCBpOXh4X3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQpAQCAtNjc5MSw2ICs2ODUzLDkgQEAgc3RhdGljIHU2NCBnZXRfY3J0Y19wb3dl
cl9kb21haW5zKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChjcnRj
X3N0YXRlLT5zaGFyZWRfZHBsbCkKIAkJbWFzayB8PSBCSVRfVUxMKFBPV0VSX0RPTUFJTl9ESVNQ
TEFZX0NPUkUpOwogCisJaWYgKGNydGNfc3RhdGUtPmRzY19wYXJhbXMuY29tcHJlc3Npb25fZW5h
YmxlKQorCQltYXNrIHw9IEJJVF9VTEwoaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihjcnRjX3N0YXRl
KSk7CisKIAlyZXR1cm4gbWFzazsKIH0KIApAQCAtNzM3OSw2ICs3NDQ0LDE5IEBAIHN0YXRpYyB1
MzIgaWxrX3BpcGVfcGl4ZWxfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpCiAJcmV0dXJuIHBpeGVsX3JhdGU7CiB9CiAKK3N0YXRpYyB2b2lkIGludGVsX2Vu
Y29kZXJfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgICAg
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWVuY29kZXItPmdldF9j
b25maWcoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CisKKwljcnRjX3N0YXRlLT5ody50cmFuc2NvZGVy
X21vZGUuZmxhZ3MgPSBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzOworCisJLyog
aWYgdHJhbnNjb2RlciBjbG9jayBpcyBub3Qgc2V0LCBhc3N1bWUgc2FtZSBhcyBhZGp1c3RlZF9t
b2RlIGNsb2NrICovCisJaWYgKCFjcnRjX3N0YXRlLT5ody50cmFuc2NvZGVyX21vZGUuY3J0Y19j
bG9jaykKKwkJY3J0Y19zdGF0ZS0+aHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfY2xvY2sgPQorCQkJ
Y3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworfQorCiBzdGF0aWMgdm9p
ZCBpbnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKQEAgLTgyNjcsNiArODM0NSwyNCBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9nZXRfdHJhbnNjb2Rlcl90aW1pbmdzKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCArPSAx
OwogCQlwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZibGFua19lbmQgKz0gMTsK
IAl9CisKKwlwaXBlX2NvbmZpZy0+aHcudHJhbnNjb2Rlcl9tb2RlID0gcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGU7CisJaWYgKHBpcGVfY29uZmlnLT5iaWdqb2luZXIpIHsKKwkJc3RydWN0
IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQorCQkJJnBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlOworCisJCS8qCisJCSAgKiB0cmFuc2NvZGVyIGlzIHByb2dyYW1tZWQgdG8g
dGhlIGZ1bGwgbW9kZSwKKwkJICAqIGJ1dCBwaXBqZSB0aW1pbmdzIGFyZSBoYWxmIG9mIHRoZSB0
cmFuc2NvZGVyIG1vZGUKKwkJICAqLworCQlhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5IC89
IDI7CisJCWFkanVzdGVkX21vZGUtPmNydGNfaGJsYW5rX3N0YXJ0IC89IDI7CisJCWFkanVzdGVk
X21vZGUtPmNydGNfaGJsYW5rX2VuZCAvPSAyOworCQlhZGp1c3RlZF9tb2RlLT5jcnRjX2hzeW5j
X3N0YXJ0IC89IDI7CisJCWFkanVzdGVkX21vZGUtPmNydGNfaHN5bmNfZW5kIC89IDI7CisJCWFk
anVzdGVkX21vZGUtPmNydGNfaHRvdGFsIC89IDI7CisJCWFkanVzdGVkX21vZGUtPmNydGNfaHNr
ZXcgLz0gMjsKKwl9CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2dldF9waXBlX3NyY19zaXplKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLApAQCAtODI4NywyMCArODM4MywyMiBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9nZXRfcGlwZV9zcmNfc2l6ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHZvaWQg
aW50ZWxfbW9kZV9mcm9tX3BpcGVfY29uZmlnKHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2Rl
LAogCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0JbW9kZS0+
aGRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5Owot
CW1vZGUtPmh0b3RhbCA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFs
OwotCW1vZGUtPmhzeW5jX3N0YXJ0ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0
Y19oc3luY19zdGFydDsKLQltb2RlLT5oc3luY19lbmQgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0
ZWRfbW9kZS5jcnRjX2hzeW5jX2VuZDsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqaHdfbW9k
ZSA9ICZwaXBlX2NvbmZpZy0+aHcudHJhbnNjb2Rlcl9tb2RlOwogCi0JbW9kZS0+dmRpc3BsYXkg
PSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwotCW1vZGUtPnZ0
b3RhbCA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsOwotCW1vZGUt
PnZzeW5jX3N0YXJ0ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192c3luY19z
dGFydDsKLQltb2RlLT52c3luY19lbmQgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX3ZzeW5jX2VuZDsKKwltb2RlLT5oZGlzcGxheSA9IGh3X21vZGUtPmNydGNfaGRpc3BsYXk7
CisJbW9kZS0+aHRvdGFsID0gaHdfbW9kZS0+Y3J0Y19odG90YWw7CisJbW9kZS0+aHN5bmNfc3Rh
cnQgPSBod19tb2RlLT5jcnRjX2hzeW5jX3N0YXJ0OworCW1vZGUtPmhzeW5jX2VuZCA9IGh3X21v
ZGUtPmNydGNfaHN5bmNfZW5kOwogCi0JbW9kZS0+ZmxhZ3MgPSBwaXBlX2NvbmZpZy0+aHcuYWRq
dXN0ZWRfbW9kZS5mbGFnczsKKwltb2RlLT52ZGlzcGxheSA9IGh3X21vZGUtPmNydGNfdmRpc3Bs
YXk7CisJbW9kZS0+dnRvdGFsID0gaHdfbW9kZS0+Y3J0Y192dG90YWw7CisJbW9kZS0+dnN5bmNf
c3RhcnQgPSBod19tb2RlLT5jcnRjX3ZzeW5jX3N0YXJ0OworCW1vZGUtPnZzeW5jX2VuZCA9IGh3
X21vZGUtPmNydGNfdnN5bmNfZW5kOworCisJbW9kZS0+ZmxhZ3MgPSBod19tb2RlLT5mbGFnczsK
IAltb2RlLT50eXBlID0gRFJNX01PREVfVFlQRV9EUklWRVI7CiAKLQltb2RlLT5jbG9jayA9IHBp
cGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJbW9kZS0+Y2xvY2sgPSBo
d19tb2RlLT5jcnRjX2Nsb2NrOwogCiAJbW9kZS0+aHN5bmMgPSBkcm1fbW9kZV9oc3luYyhtb2Rl
KTsKIAltb2RlLT52cmVmcmVzaCA9IGRybV9tb2RlX3ZyZWZyZXNoKG1vZGUpOwpAQCAtMTAzODcs
NiArMTA0ODUsOCBAQCBzdGF0aWMgdm9pZCBoYXN3ZWxsX2dldF9kZGlfcG9ydF9zdGF0ZShzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAl1MzIgdG1wOwogCiAJdG1wID0gSTkxNV9SRUFEKFRSQU5T
X0RESV9GVU5DX0NUTChwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpKTsKKwlpZiAoISh0bXAg
JiBUUkFOU19ERElfRlVOQ19FTkFCTEUpKQorCQlyZXR1cm47CiAKIAlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMikKIAkJcG9ydCA9IFRHTF9UUkFOU19ERElfRlVOQ19DVExfVkFMX1RPX1BP
UlQodG1wKTsKQEAgLTEwNDU3LDExICsxMDU1NywxOSBAQCBzdGF0aWMgYm9vbCBoYXN3ZWxsX2dl
dF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJV0FSTl9PTihhY3RpdmUp
OwogCQlhY3RpdmUgPSB0cnVlOwogCX0KKwlpbnRlbF9kc2NfZ2V0X2NvbmZpZyhwaXBlX2NvbmZp
Zyk7CiAKLQlpZiAoIWFjdGl2ZSkKLQkJZ290byBvdXQ7CisJaWYgKCFhY3RpdmUpIHsKKwkJLyog
Ymlnam9pbmVyIHNsYXZlIGRvZXNuJ3QgZW5hYmxlIHRyYW5zY29kZXIgKi8KKwkJaWYgKCFwaXBl
X2NvbmZpZy0+Ymlnam9pbmVyX3NsYXZlKQorCQkJZ290byBvdXQ7CisKKwkJYWN0aXZlID0gdHJ1
ZTsKKwkJcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIgPSAxOwogCi0JaWYgKCF0cmFuc2Nv
ZGVyX2lzX2RzaShwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpIHx8CisJCS8qIHdlIGNhbm5v
dCByZWFkIG91dCBtb3N0IHN0YXRlLCBzbyBkb24ndCBib3RoZXIuLiAqLworCQlwaXBlX2NvbmZp
Zy0+cXVpcmtzIHw9IFBJUEVfQ09ORklHX1FVSVJLX0JJR0pPSU5FUl9TTEFWRTsKKwl9IGVsc2Ug
aWYgKCF0cmFuc2NvZGVyX2lzX2RzaShwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpIHx8CiAJ
ICAgIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKIAkJaGFzd2VsbF9nZXRfZGRpX3BvcnRf
c3RhdGUoY3J0YywgcGlwZV9jb25maWcpOwogCQlpbnRlbF9nZXRfdHJhbnNjb2Rlcl90aW1pbmdz
KGNydGMsIHBpcGVfY29uZmlnKTsKQEAgLTEwNTM4LDcgKzEwNjQ2LDEwIEBAIHN0YXRpYyBib29s
IGhhc3dlbGxfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQl9CiAJ
fQogCi0JaWYgKHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciAhPSBUUkFOU0NPREVSX0VEUCAm
JgorCWlmIChwaXBlX2NvbmZpZy0+Ymlnam9pbmVyX3NsYXZlKSB7CisJCS8qIENhbm5vdCBiZSBy
ZWFkIG91dCBhcyBhIHNsYXZlLCBzZXQgdG8gMC4gKi8KKwkJcGlwZV9jb25maWctPnBpeGVsX211
bHRpcGxpZXIgPSAwOworCX0gZWxzZSBpZiAocGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyICE9
IFRSQU5TQ09ERVJfRURQICYmCiAJICAgICF0cmFuc2NvZGVyX2lzX2RzaShwaXBlX2NvbmZpZy0+
Y3B1X3RyYW5zY29kZXIpKSB7CiAJCXBpcGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyID0KIAkJ
CUk5MTVfUkVBRChQSVBFX01VTFQocGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyKSkgKyAxOwpA
QCAtMTE1MDIsNyArMTE2MTMsNyBAQCBpbnRlbF9lbmNvZGVyX2N1cnJlbnRfbW9kZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAkJcmV0dXJuIE5VTEw7CiAJfQogCi0JZW5jb2Rlci0+
Z2V0X2NvbmZpZyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKKwlpbnRlbF9lbmNvZGVyX2dldF9jb25m
aWcoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAKIAlpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25maWco
bW9kZSwgY3J0Y19zdGF0ZSk7CiAKQEAgLTEyMzAzLDkgKzEyNDE0LDExIEBAIHN0YXRpYyB2b2lk
IGNvcHlfdWFwaV90b19od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIAogc3RhdGljIHZvaWQgY29weV9od190b191YXBpX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewotCWNydGNfc3RhdGUtPnVhcGkuZW5hYmxlID0gY3J0Y19z
dGF0ZS0+aHcuZW5hYmxlOwotCWNydGNfc3RhdGUtPnVhcGkuYWN0aXZlID0gY3J0Y19zdGF0ZS0+
aHcuYWN0aXZlOwotCWNydGNfc3RhdGUtPnVhcGkubW9kZSA9IGNydGNfc3RhdGUtPmh3Lm1vZGU7
CisJaWYgKCFjcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUpIHsKKwkJY3J0Y19zdGF0ZS0+dWFw
aS5lbmFibGUgPSBjcnRjX3N0YXRlLT5ody5lbmFibGU7CisJCWNydGNfc3RhdGUtPnVhcGkuYWN0
aXZlID0gY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOworCQljcnRjX3N0YXRlLT51YXBpLm1vZGUgPSBj
cnRjX3N0YXRlLT5ody5tb2RlOworCX0KIAljcnRjX3N0YXRlLT51YXBpLmFkanVzdGVkX21vZGUg
PSBjcnRjX3N0YXRlLT5ody50cmFuc2NvZGVyX21vZGU7CiB9CiAKQEAgLTEyMzM2LDYgKzEyNDQ5
LDcgQEAgY29weV9iaWdqb2luZXJfY3J0Y19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAljcnRjX3N0YXRlLT5ody5hY3RpdmUgPSBmcm9tX2NydGNfc3RhdGUtPmh3
LmFjdGl2ZTsKIAljcnRjX3N0YXRlLT5ody5tb2RlID0gZnJvbV9jcnRjX3N0YXRlLT5ody5tb2Rl
OwogCWNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUgPSBmcm9tX2NydGNfc3RhdGUtPmh3LmFk
anVzdGVkX21vZGU7CisJY3J0Y19zdGF0ZS0+aHcudHJhbnNjb2Rlcl9tb2RlID0gZnJvbV9jcnRj
X3N0YXRlLT5ody50cmFuc2NvZGVyX21vZGU7CiAKIAkvKiBTb21lIGZpeHVwcyAqLwogCWNydGNf
c3RhdGUtPnVhcGkubW9kZV9jaGFuZ2VkID0gZnJvbV9jcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hh
bmdlZDsKQEAgLTEyODUxLDE5ICsxMjk2NSw0MSBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAogCVBJUEVf
Q09ORl9DSEVDS19YKG91dHB1dF90eXBlcyk7CiAKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1
c3RlZF9tb2RlLmNydGNfaGRpc3BsYXkpOwotCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVk
X21vZGUuY3J0Y19odG90YWwpOwotCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUu
Y3J0Y19oYmxhbmtfc3RhcnQpOwotCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUu
Y3J0Y19oYmxhbmtfZW5kKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNy
dGNfaHN5bmNfc3RhcnQpOwotCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0
Y19oc3luY19lbmQpOwotCi0JUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0ZWRfbW9kZS5jcnRj
X3ZkaXNwbGF5KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfdnRv
dGFsKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5rX3N0
YXJ0KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5rX2Vu
ZCk7Ci0JUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0
KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfZW5kKTsK
KwlpZiAoIVBJUEVfQ09ORl9RVUlSSyhQSVBFX0NPTkZJR19RVUlSS19CSUdKT0lORVJfU0xBVkUp
KSB7CisJCS8qIGJpZ2pvaW5lciBtb2RlID0gdHJhbnNjb2RlciBtb2RlIC8gMiwgZm9yIGNhbGN1
bGF0aW9ucyAqLworCQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaGRp
c3BsYXkpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFs
KTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5KTsK
KwkJUElQRV9DT05GX0NIRUNLX0koaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCk7CisKKwkJ
UElQRV9DT05GX0NIRUNLX0koaHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfaGRpc3BsYXkpOworCQlQ
SVBFX0NPTkZfQ0hFQ0tfSShody50cmFuc2NvZGVyX21vZGUuY3J0Y19odG90YWwpOworCQlQSVBF
X0NPTkZfQ0hFQ0tfSShody50cmFuc2NvZGVyX21vZGUuY3J0Y19oYmxhbmtfc3RhcnQpOworCQlQ
SVBFX0NPTkZfQ0hFQ0tfSShody50cmFuc2NvZGVyX21vZGUuY3J0Y19oYmxhbmtfZW5kKTsKKwkJ
UElQRV9DT05GX0NIRUNLX0koaHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfaHN5bmNfc3RhcnQpOwor
CQlQSVBFX0NPTkZfQ0hFQ0tfSShody50cmFuc2NvZGVyX21vZGUuY3J0Y19oc3luY19lbmQpOwor
CisJCVBJUEVfQ09ORl9DSEVDS19JKGh3LnRyYW5zY29kZXJfbW9kZS5jcnRjX3ZkaXNwbGF5KTsK
KwkJUElQRV9DT05GX0NIRUNLX0koaHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfdnRvdGFsKTsKKwkJ
UElQRV9DT05GX0NIRUNLX0koaHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0KTsK
KwkJUElQRV9DT05GX0NIRUNLX0koaHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfdmJsYW5rX2VuZCk7
CisJCVBJUEVfQ09ORl9DSEVDS19JKGh3LnRyYW5zY29kZXJfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0
KTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfdnN5bmNfZW5k
KTsKKworCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rlcl9tb2RlLmZsYWdzLAor
CQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKTsKKworCQlpZiAoIVBJUEVfQ09ORl9R
VUlSSyhQSVBFX0NPTkZJR19RVUlSS19NT0RFX1NZTkNfRkxBR1MpKSB7CisJCQlQSVBFX0NPTkZf
Q0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rlcl9tb2RlLmZsYWdzLAorCQkJCQkgICAgICBEUk1fTU9E
RV9GTEFHX1BIU1lOQyk7CisJCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rlcl9t
b2RlLmZsYWdzLAorCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX05IU1lOQyk7CisJCQlQSVBFX0NP
TkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rlcl9tb2RlLmZsYWdzLAorCQkJCQkgICAgICBEUk1f
TU9ERV9GTEFHX1BWU1lOQyk7CisJCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rl
cl9tb2RlLmZsYWdzLAorCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX05WU1lOQyk7CisJCX0KKwl9
CiAKIAlQSVBFX0NPTkZfQ0hFQ0tfSShwaXhlbF9tdWx0aXBsaWVyKTsKIAlQSVBFX0NPTkZfQ0hF
Q0tfSShvdXRwdXRfZm9ybWF0KTsKQEAgLTEyODc1LDI0ICsxMzAxMSwxMSBAQCBpbnRlbF9waXBl
X2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2Nv
bmZpZywKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChoZG1pX3NjcmFtYmxpbmcpOwogCVBJUEVfQ09O
Rl9DSEVDS19CT09MKGhkbWlfaGlnaF90bWRzX2Nsb2NrX3JhdGlvKTsKIAlQSVBFX0NPTkZfQ0hF
Q0tfQk9PTChoYXNfaW5mb2ZyYW1lKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChmZWNfZW5hYmxl
KTsKKwlpZiAoIVBJUEVfQ09ORl9RVUlSSyhQSVBFX0NPTkZJR19RVUlSS19CSUdKT0lORVJfU0xB
VkUpKQorCQlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChmZWNfZW5hYmxlKTsKIAogCVBJUEVfQ09ORl9D
SEVDS19CT09MX0lOQ09NUExFVEUoaGFzX2F1ZGlvKTsKIAotCVBJUEVfQ09ORl9DSEVDS19GTEFH
Uyhody5hZGp1c3RlZF9tb2RlLmZsYWdzLAotCQkJICAgICAgRFJNX01PREVfRkxBR19JTlRFUkxB
Q0UpOwotCi0JaWYgKCFQSVBFX0NPTkZfUVVJUksoUElQRV9DT05GSUdfUVVJUktfTU9ERV9TWU5D
X0ZMQUdTKSkgewotCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFn
cywKLQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX1BIU1lOQyk7Ci0JCVBJUEVfQ09ORl9DSEVDS19G
TEFHUyhody5hZGp1c3RlZF9tb2RlLmZsYWdzLAotCQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfTkhT
WU5DKTsKLQkJUElQRV9DT05GX0NIRUNLX0ZMQUdTKGh3LmFkanVzdGVkX21vZGUuZmxhZ3MsCi0J
CQkJICAgICAgRFJNX01PREVfRkxBR19QVlNZTkMpOwotCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1Mo
aHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKLQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX05WU1lOQyk7
Ci0JfQotCiAJUElQRV9DT05GX0NIRUNLX1goZ21jaF9wZml0LmNvbnRyb2wpOwogCS8qIHBmaXQg
cmF0aW9zIGFyZSBhdXRvY29tcHV0ZWQgYnkgdGhlIGh3IG9uIGdlbjQrICovCiAJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPCA0KQpAQCAtMTI5MTYsNyArMTMwMzksOCBAQCBpbnRlbF9waXBlX2Nv
bmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZp
ZywKIAkJfQogCiAJCVBJUEVfQ09ORl9DSEVDS19JKHNjYWxlcl9zdGF0ZS5zY2FsZXJfaWQpOwot
CQlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkocGl4ZWxfcmF0ZSk7CisJCWlmICghUElQRV9D
T05GX1FVSVJLKFBJUEVfQ09ORklHX1FVSVJLX0JJR0pPSU5FUl9TTEFWRSkpCisJCQlQSVBFX0NP
TkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkocGl4ZWxfcmF0ZSk7CiAKIAkJUElQRV9DT05GX0NIRUNLX1go
Z2FtbWFfbW9kZSk7CiAJCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkKQEAgLTEyOTM1LDQ4
ICsxMzA1OSw1MCBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChkb3Vi
bGVfd2lkZSk7CiAKIAlQSVBFX0NPTkZfQ0hFQ0tfUChzaGFyZWRfZHBsbCk7CisJaWYgKCFQSVBF
X0NPTkZfUVVJUksoUElQRV9DT05GSUdfUVVJUktfQklHSk9JTkVSX1NMQVZFKSkgewogCVBJUEVf
Q09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuZHBsbCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBs
bF9od19zdGF0ZS5kcGxsX21kKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLmZw
MCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5mcDEpOwotCVBJUEVfQ09ORl9D
SEVDS19YKGRwbGxfaHdfc3RhdGUud3JwbGwpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdf
c3RhdGUuc3BsbCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5jdHJsMSk7Ci0J
UElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5jZmdjcjEpOwotCVBJUEVfQ09ORl9DSEVD
S19YKGRwbGxfaHdfc3RhdGUuY2ZnY3IyKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0
YXRlLmNmZ2NyMCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5lYmIwKTsKLQlQ
SVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLmViYjQpOwotCVBJUEVfQ09ORl9DSEVDS19Y
KGRwbGxfaHdfc3RhdGUucGxsMCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5w
bGwxKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBsbDIpOwotCVBJUEVfQ09O
Rl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsMyk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9o
d19zdGF0ZS5wbGw2KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBsbDgpOwot
CVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsOSk7Ci0JUElQRV9DT05GX0NIRUNL
X1goZHBsbF9od19zdGF0ZS5wbGwxMCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0
ZS5wY3NkdzEyKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3JlZmNsa2lu
X2N0bCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19jbGt0b3AyX2NvcmVj
bGtjdGwxKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX2Nsa3RvcDJfaHNj
bGtjdGwpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX2RpdjApOwot
CVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX2RpdjEpOwotCVBJUEVfQ09O
Rl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX2xmKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChk
cGxsX2h3X3N0YXRlLm1nX3BsbF9mcmFjX2xvY2spOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxf
aHdfc3RhdGUubWdfcGxsX3NzYyk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5t
Z19wbGxfYmlhcyk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxfdGRj
X2NvbGRzdF9iaWFzKTsKLQotCVBJUEVfQ09ORl9DSEVDS19YKGRzaV9wbGwuY3RybCk7Ci0JUElQ
RV9DT05GX0NIRUNLX1goZHNpX3BsbC5kaXYpOwotCi0JaWYgKElTX0c0WChkZXZfcHJpdikgfHwg
SU5URUxfR0VOKGRldl9wcml2KSA+PSA1KQotCQlQSVBFX0NPTkZfQ0hFQ0tfSShwaXBlX2JwcCk7
Ci0KLQlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkoaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Ns
b2NrKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkocG9ydF9jbG9jayk7Ci0KLQlQSVBF
X0NPTkZfQ0hFQ0tfSShtaW5fdm9sdGFnZV9sZXZlbCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRw
bGxfaHdfc3RhdGUuZHBsbF9tZCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUu
ZnAwKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5mcDEpOworCQlQSVBFX0NP
TkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLndycGxsKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBs
bF9od19zdGF0ZS5zcGxsKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5jdHJs
MSk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuY2ZnY3IxKTsKKwkJUElQRV9D
T05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5jZmdjcjIpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChk
cGxsX2h3X3N0YXRlLmNmZ2NyMCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUu
ZWJiMCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuZWJiNCk7CisJCVBJUEVf
Q09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsMCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRw
bGxfaHdfc3RhdGUucGxsMSk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxs
Mik7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsMyk7CisJCVBJUEVfQ09O
Rl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsNik7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxf
aHdfc3RhdGUucGxsOCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsOSk7
CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsMTApOworCQlQSVBFX0NPTkZf
Q0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBjc2R3MTIpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxs
X2h3X3N0YXRlLm1nX3JlZmNsa2luX2N0bCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdf
c3RhdGUubWdfY2xrdG9wMl9jb3JlY2xrY3RsMSk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxf
aHdfc3RhdGUubWdfY2xrdG9wMl9oc2Nsa2N0bCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxf
aHdfc3RhdGUubWdfcGxsX2RpdjApOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRl
Lm1nX3BsbF9kaXYxKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxf
bGYpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF9mcmFjX2xvY2sp
OworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF9zc2MpOworCQlQSVBF
X0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF9iaWFzKTsKKwkJUElQRV9DT05GX0NI
RUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxfdGRjX2NvbGRzdF9iaWFzKTsKKworCQlQSVBFX0NP
TkZfQ0hFQ0tfWChkc2lfcGxsLmN0cmwpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkc2lfcGxsLmRp
dik7CisKKwkJaWYgKElTX0c0WChkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSA1
KQorCQkJUElQRV9DT05GX0NIRUNLX0kocGlwZV9icHApOworCisJCVBJUEVfQ09ORl9DSEVDS19D
TE9DS19GVVpaWShody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2spOworCQlQSVBFX0NPTkZfQ0hF
Q0tfQ0xPQ0tfRlVaWlkocG9ydF9jbG9jayk7CisKKwkJUElQRV9DT05GX0NIRUNLX0kobWluX3Zv
bHRhZ2VfbGV2ZWwpOworCX0KIAogCVBJUEVfQ09ORl9DSEVDS19YKGluZm9mcmFtZXMuZW5hYmxl
KTsKIAlQSVBFX0NPTkZfQ0hFQ0tfWChpbmZvZnJhbWVzLmdjcCk7CkBAIC0xMjk4NSw2ICsxMzEx
MSwxMiBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAlQSVBFX0NPTkZfQ0hFQ0tfSU5GT0ZSQU1FKGhkbWkp
OwogCVBJUEVfQ09ORl9DSEVDS19JTkZPRlJBTUUoZHJtKTsKIAorCVBJUEVfQ09ORl9DSEVDS19C
T09MKGJpZ2pvaW5lcik7CisJUElQRV9DT05GX0NIRUNLX0JPT0woYmlnam9pbmVyX3NsYXZlKTsK
KwlQSVBFX0NPTkZfQ0hFQ0tfUChiaWdqb2luZXJfbGlua2VkX2NydGMpOworCVBJUEVfQ09ORl9D
SEVDS19CT09MKGRzY19wYXJhbXMuY29tcHJlc3Npb25fZW5hYmxlKTsKKwlQSVBFX0NPTkZfQ0hF
Q0tfQk9PTChkc2NfcGFyYW1zLmRzY19zcGxpdCk7CisKICN1bmRlZiBQSVBFX0NPTkZfQ0hFQ0tf
WAogI3VuZGVmIFBJUEVfQ09ORl9DSEVDS19JCiAjdW5kZWYgUElQRV9DT05GX0NIRUNLX0JPT0wK
QEAgLTEzMjM5LDYgKzEzMzcxLDcgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAJc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKnBpcGVfY29uZmlnOwogCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0
ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqbWFzdGVyID0gY3J0YzsKIAlib29sIGFjdGl2ZTsKIAog
CXN0YXRlID0gb2xkX2NydGNfc3RhdGUtPnVhcGkuc3RhdGU7CkBAIC0xMzI2OCw3ICsxMzQwMSwx
MCBAQCB2ZXJpZnlfY3J0Y19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSIoZXhw
ZWN0ZWQgJWksIGZvdW5kICVpKVxuIiwKIAkJCW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUsIGNy
dGMtPmFjdGl2ZSk7CiAKLQlmb3JfZWFjaF9lbmNvZGVyX29uX2NydGMoZGV2LCAmY3J0Yy0+YmFz
ZSwgZW5jb2RlcikgeworCWlmIChuZXdfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQlt
YXN0ZXIgPSBuZXdfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjOworCisJZm9yX2Vh
Y2hfZW5jb2Rlcl9vbl9jcnRjKGRldiwgJm1hc3Rlci0+YmFzZSwgZW5jb2RlcikgewogCQllbnVt
IHBpcGUgcGlwZTsKIAogCQlhY3RpdmUgPSBlbmNvZGVyLT5nZXRfaHdfc3RhdGUoZW5jb2Rlciwg
JnBpcGUpOwpAQCAtMTMyNzcsMTIgKzEzNDEzLDEyIEBAIHZlcmlmeV9jcnRjX3N0YXRlKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCWVuY29kZXItPmJhc2UuYmFzZS5pZCwgYWN0aXZlLAog
CQkJCW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpOwogCi0JCUk5MTVfU1RBVEVfV0FSTihhY3Rp
dmUgJiYgY3J0Yy0+cGlwZSAhPSBwaXBlLAorCQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICYmIG1h
c3Rlci0+cGlwZSAhPSBwaXBlLAogCQkJCSJFbmNvZGVyIGNvbm5lY3RlZCB0byB3cm9uZyBwaXBl
ICVjXG4iLAogCQkJCXBpcGVfbmFtZShwaXBlKSk7CiAKIAkJaWYgKGFjdGl2ZSkKLQkJCWVuY29k
ZXItPmdldF9jb25maWcoZW5jb2RlciwgcGlwZV9jb25maWcpOworCQkJaW50ZWxfZW5jb2Rlcl9n
ZXRfY29uZmlnKGVuY29kZXIsIHBpcGVfY29uZmlnKTsKIAl9CiAKIAlpbnRlbF9jcnRjX2NvbXB1
dGVfcGl4ZWxfcmF0ZShwaXBlX2NvbmZpZyk7CkBAIC0xNDAxMCw2ICsxNDE0Niw3IEBAIHN0YXRp
YyB2b2lkIGludGVsX3VwZGF0ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJaWYg
KG1vZGVzZXQpIHsKIAkJdXBkYXRlX3NjYW5saW5lX29mZnNldChuZXdfY3J0Y19zdGF0ZSk7CisJ
CWRybV9jYWxjX3RpbWVzdGFtcGluZ19jb25zdGFudHMoJmNydGMtPmJhc2UsICZuZXdfY3J0Y19z
dGF0ZS0+aHcudHJhbnNjb2Rlcl9tb2RlKTsKIAkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFi
bGUobmV3X2NydGNfc3RhdGUsIHN0YXRlKTsKIAogCQkvKiB2YmxhbmtzIHdvcmsgYWdhaW4sIHJl
LWVuYWJsZSBwaXBlIENSQy4gKi8KQEAgLTE0MTAwLDcgKzE0MjM3LDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCiAJICovCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGVfcmV2ZXJz
ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsCiAJCQkJCQkgICAgbmV3X2NydGNfc3RhdGUs
IGkpIHsKLQkJaWYgKCFuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSkKKwkJaWYgKCFuZWVk
c19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSB8fCBvbGRfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3Ns
YXZlKQogCQkJY29udGludWU7CiAKIAkJaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShvbGRfY3J0Y19z
dGF0ZSwgbmV3X2NydGNfc3RhdGUpOwpAQCAtMTQxMTAsNiArMTQyNDcsMTkgQEAgc3RhdGljIHZv
aWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiAJCQkJCQkgICAgICBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJCSAgICAgIG5ld19j
cnRjX3N0YXRlLAogCQkJCQkJICAgICAgY3J0Yyk7CisKKwkJaWYgKG9sZF9jcnRjX3N0YXRlLT5i
aWdqb2luZXIpIHsKKwkJCXN0cnVjdCBpbnRlbF9jcnRjICpzbGF2ZSA9IG9sZF9jcnRjX3N0YXRl
LT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xk
X3NsYXZlX2NydGNfc3RhdGUgPQorCQkJCWludGVsX2F0b21pY19nZXRfY3J0Y19zdGF0ZSgmc3Rh
dGUtPmJhc2UsIHNsYXZlKTsKKwkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfc2xhdmVf
Y3J0Y19zdGF0ZSA9CisJCQkJaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFz
ZSwgc2xhdmUpOworCisJCQlpbnRlbF9vbGRfY3J0Y19zdGF0ZV9kaXNhYmxlcyhzdGF0ZSwKKwkJ
CQkJCSAgICAgIG9sZF9zbGF2ZV9jcnRjX3N0YXRlLAorCQkJCQkJICAgICAgbmV3X3NsYXZlX2Ny
dGNfc3RhdGUsCisJCQkJCQkgICAgICBzbGF2ZSk7CisJCX0KIAl9CiB9CiAKQEAgLTE2NTI3LDcg
KzE2Njc3LDcgQEAgaW50IGludGVsX21vZGVzZXRfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAlmb3JfZWFjaF9pbnRlbF9jcnRjKGRldiwgY3J0YykgewogCQlzdHJ1Y3QgaW50
ZWxfaW5pdGlhbF9wbGFuZV9jb25maWcgcGxhbmVfY29uZmlnID0ge307CiAKLQkJaWYgKCFjcnRj
LT5hY3RpdmUpCisJCWlmICghdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKS0+
dWFwaS5hY3RpdmUpCiAJCQljb250aW51ZTsKIAogCQkvKgpAQCAtMTY5ODMsNyArMTcxMzMsMTcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYpCiAJCQljcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5i
YXNlLnN0YXRlKTsKIAogCQkJZW5jb2Rlci0+YmFzZS5jcnRjID0gJmNydGMtPmJhc2U7Ci0JCQll
bmNvZGVyLT5nZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworCQkJaW50ZWxfZW5jb2Rl
cl9nZXRfY29uZmlnKGVuY29kZXIsIGNydGNfc3RhdGUpOworCisJCQkvKiByZWFkIG91dCB0byBz
bGF2ZSBjcnRjIGFzIHdlbGwgZm9yIGJpZ2pvaW5lciAqLworCQkJaWYgKGNydGNfc3RhdGUtPmJp
Z2pvaW5lcikgeworCQkJCS8qIGVuY29kZXIgc2hvdWxkIHJlYWQgYmUgbGlua2VkIHRvIGJpZ2pv
aW5lciBtYXN0ZXIgKi8KKwkJCQlXQVJOX09OKGNydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSk7
CisKKwkJCQljcnRjID0gY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjOworCQkJCWNy
dGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOworCQkJCWlu
dGVsX2VuY29kZXJfZ2V0X2NvbmZpZyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKKwkJCX0KIAkJfSBl
bHNlIHsKIAkJCWVuY29kZXItPmJhc2UuY3J0YyA9IE5VTEw7CiAJCX0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggNmNlODIz
OTQzYTY5Li5hNjU5ZGFiODEzN2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC04MDMsNiArODAzLDcgQEAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgewogCSAqIGFjY29yZGluZ2x5LgogCSAqLwogI2RlZmluZSBQSVBFX0NP
TkZJR19RVUlSS19NT0RFX1NZTkNfRkxBR1MJKDE8PDApIC8qIHVucmVsaWFibGUgc3luYyBtb2Rl
LmZsYWdzICovCisjZGVmaW5lIFBJUEVfQ09ORklHX1FVSVJLX0JJR0pPSU5FUl9TTEFWRQkoMTw8
MSkgLyogYmlnam9pbmVyIHNsYXZlLCBwYXJ0aWFsIHJlYWRvdXQgKi8KIAl1bnNpZ25lZCBsb25n
IHF1aXJrczsKIAogCXVuc2lnbmVkIGZiX2JpdHM7IC8qIGZyYW1lYnVmZmVycyB0byBmbGlwICov
CkBAIC0xNTkzLDYgKzE1OTQsMjIgQEAgc3RhdGljIGlubGluZSB1MzIgaW50ZWxfcGxhbmVfZ2d0
dF9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzdGF0ZSkKIAlyZXR1cm4g
aTkxNV9nZ3R0X29mZnNldChzdGF0ZS0+dm1hKTsKIH0KIAorc3RhdGljIGlubGluZSBib29sCitp
bnRlbF9jcnRjX3N1cHBvcnRzX2RzYyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShwaXBlX2NvbmZpZy0+dWFwaS5jcnRjLT5kZXYpOworCisJLyogT24gVEdMLCBEU0MgaXMgc3Vw
cG9ydGVkIG9uIGFsbCBQaXBlcyAqLworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQor
CQlyZXR1cm4gdHJ1ZTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwICYmCisJICAg
IHBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciAhPSBUUkFOU0NPREVSX0EpCisJCXJldHVybiB0
cnVlOworCisJcmV0dXJuIGZhbHNlOworfQorCiAvKiBpbnRlbF9hdG9taWNfcGxhbmUuYyAqLwog
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICoKIGludGVsX2F0b21pY19nZXRfcGxhbmVfc3RhdGVf
YWZ0ZXJfY2hlY2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKaW5kZXggNjM3ZWU3ZDA2NTZhLi4wZTRiMTJlYmMz
NWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKQEAgLTE5MTAsMjkg
KzE5MTAsMTMgQEAgc3RhdGljIGJvb2wgaW50ZWxfZHBfc3VwcG9ydHNfZmVjKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsCiAJCWRybV9kcF9zaW5rX3N1cHBvcnRzX2ZlYyhpbnRlbF9kcC0+ZmVj
X2NhcGFibGUpOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9kcF9zb3VyY2Vfc3VwcG9ydHNfZHNj
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCi0JCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqcGlwZV9jb25maWcpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0KLQkvKiBPbiBUR0wsIERTQyBpcyBzdXBwb3J0
ZWQgb24gYWxsIFBpcGVzICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCXJl
dHVybiB0cnVlOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgJiYKLQkgICAgcGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyICE9IFRSQU5TQ09ERVJfQSkKLQkJcmV0dXJuIHRydWU7
Ci0KLQlyZXR1cm4gZmFsc2U7Ci19Ci0KIHN0YXRpYyBib29sIGludGVsX2RwX3N1cHBvcnRzX2Rz
YyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewogCWlmICghaW50ZWxfZHBfaXNfZWRwKGludGVsX2Rw
KSAmJiAhcGlwZV9jb25maWctPmZlY19lbmFibGUpCiAJCXJldHVybiBmYWxzZTsKIAotCXJldHVy
biBpbnRlbF9kcF9zb3VyY2Vfc3VwcG9ydHNfZHNjKGludGVsX2RwLCBwaXBlX2NvbmZpZykgJiYK
KwlyZXR1cm4gaW50ZWxfY3J0Y19zdXBwb3J0c19kc2MocGlwZV9jb25maWcpICYmCiAJCWRybV9k
cF9zaW5rX3N1cHBvcnRzX2RzYyhpbnRlbF9kcC0+ZHNjX2RwY2QpOwogfQogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmRzYy5jCmluZGV4IDM4YzE4MTQ5OTUwNS4uMTFkNGRh
OTczNGEwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zk
c2MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYwpAQCAt
NDgwLDExICs0ODAsMTAgQEAgaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJcmV0dXJuIFBPV0VSX0RPTUFJTl9UUkFOU0NP
REVSKGNwdV90cmFuc2NvZGVyKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfY29uZmlndXJlX3Bw
c19mb3JfZHNjX2VuY29kZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCi0JCQkJCQlj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3N0YXRpYyB2b2lkIGlu
dGVsX2NvbmZpZ3VyZV9wcHNfZm9yX2RzY19lbmNvZGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWNvbnN0IHN0
cnVjdCBkcm1fZHNjX2NvbmZpZyAqdmRzY19jZmcgPSAmY3J0Y19zdGF0ZS0+ZHBfZHNjX2NmZzsK
IAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFu
c2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CkBAIC00OTQsNiArNDkzLDkgQEAg
c3RhdGljIHZvaWQgaW50ZWxfY29uZmlndXJlX3Bwc19mb3JfZHNjX2VuY29kZXIoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJdTggbnVtX3Zkc2NfaW5zdGFuY2VzID0gKGNydGNfc3Rh
dGUtPmRzY19wYXJhbXMuZHNjX3NwbGl0KSA/IDIgOiAxOwogCWludCBpID0gMDsKIAorCWlmIChj
cnRjX3N0YXRlLT5iaWdqb2luZXIpCisJCW51bV92ZHNjX2luc3RhbmNlcyAqPSAyOworCiAJLyog
UG9wdWxhdGUgUElDVFVSRV9QQVJBTUVURVJfU0VUXzAgcmVnaXN0ZXJzICovCiAJcHBzX3ZhbCA9
IERTQ19WRVJfTUFKIHwgdmRzY19jZmctPmRzY192ZXJzaW9uX21pbm9yIDw8CiAJCURTQ19WRVJf
TUlOX1NISUZUIHwKQEAgLTg5OSw3NCArOTAxLDEwNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF93
cml0ZV9kc2NfcHBzX3NkcChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJc2l6
ZW9mKGRwX2RzY19wcHNfc2RwKSk7CiB9CiAKK3N0YXRpYyBpOTE1X3JlZ190IGRzc19jdGwxX3Jl
Zyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwllbnVtIHBp
cGUgcGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKKwor
CWlmIChjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlciA9PSBUUkFOU0NPREVSX0VEUCkKKwkJcmV0
dXJuIERTU19DVEwxOworCisJcmV0dXJuIElDTF9QSVBFX0RTU19DVEwxKHBpcGUpOworfQorCitz
dGF0aWMgaTkxNV9yZWdfdCBkc3NfY3RsMl9yZWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCit7CisJZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRjKGNydGNf
c3RhdGUtPnVhcGkuY3J0YyktPnBpcGU7CisKKwlpZiAoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29k
ZXIgPT0gVFJBTlNDT0RFUl9FRFApCisJCXJldHVybiBEU1NfQ1RMMjsKKworCXJldHVybiBJQ0xf
UElQRV9EU1NfQ1RMMihwaXBlKTsKK30KKwogdm9pZCBpbnRlbF9kc2NfZW5hYmxlKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9
IGNydGMtPnBpcGU7Ci0JaTkxNV9yZWdfdCBkc3NfY3RsMV9yZWcsIGRzc19jdGwyX3JlZzsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2
KTsKIAl1MzIgZHNzX2N0bDFfdmFsID0gMDsKIAl1MzIgZHNzX2N0bDJfdmFsID0gMDsKIAogCWlm
ICghY3J0Y19zdGF0ZS0+ZHNjX3BhcmFtcy5jb21wcmVzc2lvbl9lbmFibGUpCiAJCXJldHVybjsK
IAotCS8qIEVuYWJsZSBQb3dlciB3ZWxscyBmb3IgVkRTQy9qb2luaW5nICovCi0JaW50ZWxfZGlz
cGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsCi0JCQkJaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihjcnRj
X3N0YXRlKSk7CisJaW50ZWxfY29uZmlndXJlX3Bwc19mb3JfZHNjX2VuY29kZXIoY3J0Y19zdGF0
ZSk7CiAKLQlpbnRlbF9jb25maWd1cmVfcHBzX2Zvcl9kc2NfZW5jb2RlcihlbmNvZGVyLCBjcnRj
X3N0YXRlKTsKKwlpZiAoIWNydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSkKKwkJaW50ZWxfZHBf
d3JpdGVfZHNjX3Bwc19zZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAKLQlpbnRlbF9kcF93cml0
ZV9kc2NfcHBzX3NkcChlbmNvZGVyLCBjcnRjX3N0YXRlKTsKLQotCWlmIChjcnRjX3N0YXRlLT5j
cHVfdHJhbnNjb2RlciA9PSBUUkFOU0NPREVSX0VEUCkgewotCQlkc3NfY3RsMV9yZWcgPSBEU1Nf
Q1RMMTsKLQkJZHNzX2N0bDJfcmVnID0gRFNTX0NUTDI7Ci0JfSBlbHNlIHsKLQkJZHNzX2N0bDFf
cmVnID0gSUNMX1BJUEVfRFNTX0NUTDEocGlwZSk7Ci0JCWRzc19jdGwyX3JlZyA9IElDTF9QSVBF
X0RTU19DVEwyKHBpcGUpOwotCX0KIAlkc3NfY3RsMl92YWwgfD0gTEVGVF9CUkFOQ0hfVkRTQ19F
TkFCTEU7CiAJaWYgKGNydGNfc3RhdGUtPmRzY19wYXJhbXMuZHNjX3NwbGl0KSB7CiAJCWRzc19j
dGwyX3ZhbCB8PSBSSUdIVF9CUkFOQ0hfVkRTQ19FTkFCTEU7CiAJCWRzc19jdGwxX3ZhbCB8PSBK
T0lORVJfRU5BQkxFOwogCX0KLQlJOTE1X1dSSVRFKGRzc19jdGwxX3JlZywgZHNzX2N0bDFfdmFs
KTsKLQlJOTE1X1dSSVRFKGRzc19jdGwyX3JlZywgZHNzX2N0bDJfdmFsKTsKKwlpZiAoY3J0Y19z
dGF0ZS0+Ymlnam9pbmVyKSB7CisJCWRzc19jdGwxX3ZhbCB8PSBCSUdfSk9JTkVSX0VOQUJMRTsK
KwkJaWYgKCFjcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUpCisJCQlkc3NfY3RsMV92YWwgfD0g
TUFTVEVSX0JJR19KT0lORVJfRU5BQkxFOworCX0KKwlJOTE1X1dSSVRFKGRzc19jdGwxX3JlZyhj
cnRjX3N0YXRlKSwgZHNzX2N0bDFfdmFsKTsKKwlJOTE1X1dSSVRFKGRzc19jdGwyX3JlZyhjcnRj
X3N0YXRlKSwgZHNzX2N0bDJfdmFsKTsKIH0KIAogdm9pZCBpbnRlbF9kc2NfZGlzYWJsZShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUpCiB7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG9sZF9jcnRjX3N0YXRlLT51YXBpLmNydGMp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKLQlpOTE1X3JlZ190IGRzc19j
dGwxX3JlZywgZHNzX2N0bDJfcmVnOwotCXUzMiBkc3NfY3RsMV92YWwgPSAwLCBkc3NfY3RsMl92
YWwgPSAwOwogCiAJaWYgKCFvbGRfY3J0Y19zdGF0ZS0+ZHNjX3BhcmFtcy5jb21wcmVzc2lvbl9l
bmFibGUpCiAJCXJldHVybjsKIAotCWlmIChvbGRfY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIg
PT0gVFJBTlNDT0RFUl9FRFApIHsKLQkJZHNzX2N0bDFfcmVnID0gRFNTX0NUTDE7Ci0JCWRzc19j
dGwyX3JlZyA9IERTU19DVEwyOwotCX0gZWxzZSB7Ci0JCWRzc19jdGwxX3JlZyA9IElDTF9QSVBF
X0RTU19DVEwxKHBpcGUpOwotCQlkc3NfY3RsMl9yZWcgPSBJQ0xfUElQRV9EU1NfQ1RMMihwaXBl
KTsKKwlJOTE1X1dSSVRFKGRzc19jdGwxX3JlZyhvbGRfY3J0Y19zdGF0ZSksIDApOworCUk5MTVf
V1JJVEUoZHNzX2N0bDJfcmVnKG9sZF9jcnRjX3N0YXRlKSwgMCk7Cit9CisKK3ZvaWQgaW50ZWxf
ZHNjX2dldF9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7CisJdTMyIGRzc19jdGwxX3ZhbCwgZHNzX2N0bDJfdmFsOworCWludGVsX3dh
a2VyZWZfdCB3YWtlcmVmOworCisJaWYgKCFpbnRlbF9jcnRjX3N1cHBvcnRzX2RzYyhjcnRjX3N0
YXRlKSkKKwkJcmV0dXJuOworCisJd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lm
X2VuYWJsZWQoZGV2X3ByaXYsIGludGVsX2RzY19wb3dlcl9kb21haW4oY3J0Y19zdGF0ZSkpOwor
CWlmICghd2FrZXJlZikKKwkJcmV0dXJuOworCisJZHNzX2N0bDFfdmFsID0gSTkxNV9SRUFEKGRz
c19jdGwxX3JlZyhjcnRjX3N0YXRlKSk7CisJZHNzX2N0bDJfdmFsID0gSTkxNV9SRUFEKGRzc19j
dGwyX3JlZyhjcnRjX3N0YXRlKSk7CisJaWYgKGRzc19jdGwyX3ZhbCAmIExFRlRfQlJBTkNIX1ZE
U0NfRU5BQkxFKQorCQljcnRjX3N0YXRlLT5kc2NfcGFyYW1zLmNvbXByZXNzaW9uX2VuYWJsZSA9
IHRydWU7CisKKwlpZiAoKGRzc19jdGwxX3ZhbCAmIEpPSU5FUl9FTkFCTEUpICYmIChkc3NfY3Rs
Ml92YWwgJiBSSUdIVF9CUkFOQ0hfVkRTQ19FTkFCTEUpKQorCQljcnRjX3N0YXRlLT5kc2NfcGFy
YW1zLmRzY19zcGxpdCA9IHRydWU7CisKKwlpZiAoZHNzX2N0bDFfdmFsICYgQklHX0pPSU5FUl9F
TkFCTEUpIHsKKwkJY3J0Y19zdGF0ZS0+Ymlnam9pbmVyID0gdHJ1ZTsKKworCQlpZiAoIShkc3Nf
Y3RsMV92YWwgJiBNQVNURVJfQklHX0pPSU5FUl9FTkFCTEUpKSB7CisJCQljcnRjX3N0YXRlLT5i
aWdqb2luZXJfc2xhdmUgPSB0cnVlOworCQkJaWYgKCFXQVJOX09OKGNydGMtPnBpcGUgPT0gUElQ
RV9BKSkKKwkJCQljcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGMgPQorCQkJCQlpbnRl
bF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgY3J0Yy0+cGlwZSAtIDEpOworCQl9IGVsc2Ug
eworCQkJaWYgKCFXQVJOX09OKElOVEVMX05VTV9QSVBFUyhkZXZfcHJpdikgPT0gY3J0Yy0+cGlw
ZSArIDEpKQorCQkJCWNydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YyA9CisJCQkJCWlu
dGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBjcnRjLT5waXBlICsgMSk7CisJCX0KIAl9
Ci0JZHNzX2N0bDFfdmFsID0gSTkxNV9SRUFEKGRzc19jdGwxX3JlZyk7Ci0JaWYgKGRzc19jdGwx
X3ZhbCAmIEpPSU5FUl9FTkFCTEUpCi0JCWRzc19jdGwxX3ZhbCAmPSB+Sk9JTkVSX0VOQUJMRTsK
LQlJOTE1X1dSSVRFKGRzc19jdGwxX3JlZywgZHNzX2N0bDFfdmFsKTsKLQotCWRzc19jdGwyX3Zh
bCA9IEk5MTVfUkVBRChkc3NfY3RsMl9yZWcpOwotCWlmIChkc3NfY3RsMl92YWwgJiBMRUZUX0JS
QU5DSF9WRFNDX0VOQUJMRSB8fAotCSAgICBkc3NfY3RsMl92YWwgJiBSSUdIVF9CUkFOQ0hfVkRT
Q19FTkFCTEUpCi0JCWRzc19jdGwyX3ZhbCAmPSB+KExFRlRfQlJBTkNIX1ZEU0NfRU5BQkxFIHwK
LQkJCQkgIFJJR0hUX0JSQU5DSF9WRFNDX0VOQUJMRSk7Ci0JSTkxNV9XUklURShkc3NfY3RsMl9y
ZWcsIGRzc19jdGwyX3ZhbCk7Ci0KLQkvKiBEaXNhYmxlIFBvd2VyIHdlbGxzIGZvciBWRFNDL2pv
aW5pbmcgKi8KLQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF91bmNoZWNrZWQoZGV2X3ByaXYsCi0J
CQkJCSAgaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihvbGRfY3J0Y19zdGF0ZSkpOworCisJaW50ZWxf
ZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIGludGVsX2RzY19wb3dlcl9kb21haW4oY3J0Y19z
dGF0ZSksIHdha2VyZWYpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF92ZHNjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zk
c2MuaAppbmRleCA5MGQzZjYwMTdmY2IuLjU2OWNmMTc0MDJiYSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmgKQEAgLTE1LDYgKzE1LDggQEAgdm9pZCBpbnRlbF9k
c2NfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogdm9pZCBpbnRlbF9kc2Nf
ZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiBpbnQg
aW50ZWxfZHBfY29tcHV0ZV9kc2NfcGFyYW1zKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJ
CQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKTsKK3ZvaWQgaW50ZWxfZHNj
X2dldF9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOworCiBlbnVt
IGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluCiBpbnRlbF9kc2NfcG93ZXJfZG9tYWluKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIAotLSAKMi4yMy4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

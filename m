Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AE4547C459
	for <lists+intel-gfx@lfdr.de>; Wed, 31 Jul 2019 16:07:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1C1C889812;
	Wed, 31 Jul 2019 14:07:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 042E589812
 for <intel-gfx@lists.freedesktop.org>; Wed, 31 Jul 2019 14:07:40 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 31 Jul 2019 07:07:40 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,330,1559545200"; d="scan'208";a="174173823"
Received: from yingraow-mobl.ger.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.249.33.190])
 by fmsmga007.fm.intel.com with ESMTP; 31 Jul 2019 07:07:39 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 31 Jul 2019 17:07:33 +0300
Message-Id: <20190731140733.23373-3-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190731140733.23373-1-lionel.g.landwerlin@intel.com>
References: <20190731140733.23373-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 2/2] drm/i915: add syncobj timeline support
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW50cm9kdWNlcyBhIG5ldyBwYXJhbWV0ZXJzIHRvIGV4ZWNidWYgc28gdGhhdCB3ZSBjYW4gc3Bl
Y2lmeSBzeW5jb2JqCmhhbmRsZXMgYXMgd2VsbCBhcyB0aW1lbGluZSBwb2ludHMuCgp2MjogUmV1
c2UgaTkxNV91c2VyX2V4dGVuc2lvbl9mbgoKdjM6IENoZWNrIHRoYXQgdGhlIGNoYWluZWQgZXh0
ZW5zaW9uIGlzIG9ubHkgcHJlc2VudCBvbmNlIChDaHJpcykKCnY0OiBDaGVjayB0aGF0IGRtYV9m
ZW5jZV9jaGFpbl9maW5kX3NlcW5vIHJldHVybnMgYSBub24gTlVMTCBmZW5jZSAoTGlvbmVsKQoK
djU6IFVzZSBCSVRfVUxMIChDaHJpcykKCnY2OiBGaXggaXNzdWUgd2l0aCBhbHJlYWR5IHNpZ25h
bGVkIHRpbWVsaW5lIHBvaW50cywKICAgIGRtYV9mZW5jZV9jaGFpbl9maW5kX3NlcW5vKCkgc2V0
dGluZyBmZW5jZSB0byBOVUxMIChDaHJpcykKCnY3OiBSZXBvcnQgRU5PRU5UIHdpdGggaW52YWxp
ZCBzeW5jb2JqIGhhbmRsZSAoTGlvbmVsKQoKU2lnbmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJs
aW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8IDI5NyArKysrKysrKysrKysrKy0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAgICAgICAgICB8ICAgNCArLQogaW5j
bHVkZS91YXBpL2RybS9pOTE1X2RybS5oICAgICAgICAgICAgICAgICAgIHwgIDM5ICsrKwogMyBm
aWxlcyBjaGFuZ2VkLCAyODMgaW5zZXJ0aW9ucygrKSwgNTcgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggNThlYjNi
ZDU3NjU2Li5kMGUzOTk4NmYwZjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2V4ZWNidWZmZXIuYwpAQCAtMjEzLDYgKzIxMywxMyBAQCBlbnVtIHsKICAqIHRoZSBi
YXRjaGJ1ZmZlciBpbiB0cnVzdGVkIG1vZGUsIG90aGVyd2lzZSB0aGUgaW9jdGwgaXMgcmVqZWN0
ZWQuCiAgKi8KIAorc3RydWN0IGk5MTVfZWJfZmVuY2VzIHsKKwlzdHJ1Y3QgZHJtX3N5bmNvYmog
KnN5bmNvYmo7IC8qIFVzZSB3aXRoIHB0cl9tYXNrX2JpdHMoKSAqLworCXN0cnVjdCBkbWFfZmVu
Y2UgKmRtYV9mZW5jZTsKKwl1NjQgdmFsdWU7CisJc3RydWN0IGRtYV9mZW5jZV9jaGFpbiAqY2hh
aW5fZmVuY2U7Cit9OworCiBzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNTsgLyoqIGk5MTUgYmFja3BvaW50ZXIgKi8KIAlzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGU7IC8qKiBwZXItZmlsZSBsb29rdXAgdGFibGVzIGFuZCBsaW1pdHMgKi8KQEAgLTI3
NCw2ICsyODEsNyBAQCBzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyIHsKIAogCXN0cnVjdCB7CiAJCXU2
NCBmbGFnczsgLyoqIEF2YWlsYWJsZSBleHRlbnNpb25zIHBhcmFtZXRlcnMgKi8KKwkJc3RydWN0
IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyX2V4dF90aW1lbGluZV9mZW5jZXMgdGltZWxpbmVfZmVu
Y2VzOwogCX0gZXh0ZW5zaW9uczsKIH07CiAKQEAgLTIyMTksNjcgKzIyMjcsMjA3IEBAIGViX3Nl
bGVjdF9lbmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiB9CiAKIHN0YXRpYyB2b2lk
Ci1fX2ZyZWVfZmVuY2VfYXJyYXkoc3RydWN0IGRybV9zeW5jb2JqICoqZmVuY2VzLCB1bnNpZ25l
ZCBpbnQgbikKK19fZnJlZV9mZW5jZV9hcnJheShzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNl
cywgdW5zaWduZWQgaW50IG4pCiB7Ci0Jd2hpbGUgKG4tLSkKLQkJZHJtX3N5bmNvYmpfcHV0KHB0
cl9tYXNrX2JpdHMoZmVuY2VzW25dLCAyKSk7CisJd2hpbGUgKG4tLSkgeworCQlkcm1fc3luY29i
al9wdXQocHRyX21hc2tfYml0cyhmZW5jZXNbbl0uc3luY29iaiwgMikpOworCQlkbWFfZmVuY2Vf
cHV0KGZlbmNlc1tuXS5kbWFfZmVuY2UpOworCQlrZnJlZShmZW5jZXNbbl0uY2hhaW5fZmVuY2Up
OworCX0KIAlrdmZyZWUoZmVuY2VzKTsKIH0KIAotc3RhdGljIHN0cnVjdCBkcm1fc3luY29iaiAq
KgotZ2V0X2ZlbmNlX2FycmF5KHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgKmFyZ3Ms
Ci0JCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMg
KgorZ2V0X3RpbWVsaW5lX2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLCBp
bnQgKm91dF9uX2ZlbmNlcykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXJfZXh0
X3RpbWVsaW5lX2ZlbmNlcyAqdGltZWxpbmVfZmVuY2VzID0KKwkJJmViLT5leHRlbnNpb25zLnRp
bWVsaW5lX2ZlbmNlczsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVuY2UgX191c2VyICp1
c2VyX2ZlbmNlczsKKwlzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNlczsKKwl1NjQgX191c2Vy
ICp1c2VyX3ZhbHVlczsKKwl1NjQgbnVtX2ZlbmNlcywgbnVtX3VzZXJfZmVuY2VzID0gdGltZWxp
bmVfZmVuY2VzLT5mZW5jZV9jb3VudDsKKwl1bnNpZ25lZCBsb25nIG47CisJaW50IGVycjsKKwor
CS8qIENoZWNrIG11bHRpcGxpY2F0aW9uIG92ZXJmbG93IGZvciBhY2Nlc3Nfb2soKSBhbmQga3Zt
YWxsb2NfYXJyYXkoKSAqLworCUJVSUxEX0JVR19PTihzaXplb2Yoc2l6ZV90KSA+IHNpemVvZih1
bnNpZ25lZCBsb25nKSk7CisJaWYgKG51bV91c2VyX2ZlbmNlcyA+IG1pbl90KHVuc2lnbmVkIGxv
bmcsCisJCQkJICAgIFVMT05HX01BWCAvIHNpemVvZigqdXNlcl9mZW5jZXMpLAorCQkJCSAgICBT
SVpFX01BWCAvIHNpemVvZigqZmVuY2VzKSkpCisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwor
CisJdXNlcl9mZW5jZXMgPSB1NjRfdG9fdXNlcl9wdHIodGltZWxpbmVfZmVuY2VzLT5oYW5kbGVz
X3B0cik7CisJaWYgKCFhY2Nlc3Nfb2sodXNlcl9mZW5jZXMsIG51bV91c2VyX2ZlbmNlcyAqIHNp
emVvZigqdXNlcl9mZW5jZXMpKSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVGQVVMVCk7CisKKwl1c2Vy
X3ZhbHVlcyA9IHU2NF90b191c2VyX3B0cih0aW1lbGluZV9mZW5jZXMtPnZhbHVlc19wdHIpOwor
CWlmICghYWNjZXNzX29rKHVzZXJfdmFsdWVzLCBudW1fdXNlcl9mZW5jZXMgKiBzaXplb2YoKnVz
ZXJfdmFsdWVzKSkpCisJCXJldHVybiBFUlJfUFRSKC1FRkFVTFQpOworCisJZmVuY2VzID0ga3Zt
YWxsb2NfYXJyYXkobnVtX3VzZXJfZmVuY2VzLCBzaXplb2YoKmZlbmNlcyksCisJCQkJX19HRlBf
Tk9XQVJOIHwgR0ZQX0tFUk5FTCk7CisJaWYgKCFmZW5jZXMpCisJCXJldHVybiBFUlJfUFRSKC1F
Tk9NRU0pOworCisJQlVJTERfQlVHX09OKH4oQVJDSF9LTUFMTE9DX01JTkFMSUdOIC0gMSkgJgor
CQkgICAgIH5fX0k5MTVfRVhFQ19GRU5DRV9VTktOT1dOX0ZMQUdTKTsKKworCWZvciAobiA9IDAs
IG51bV9mZW5jZXMgPSAwOyBuIDwgdGltZWxpbmVfZmVuY2VzLT5mZW5jZV9jb3VudDsgbisrKSB7
CisJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19mZW5jZSB1c2VyX2ZlbmNlOworCQlzdHJ1Y3Qg
ZHJtX3N5bmNvYmogKnN5bmNvYmo7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gTlVMTDsK
KwkJdTY0IHBvaW50OworCisJCWlmIChfX2NvcHlfZnJvbV91c2VyKCZ1c2VyX2ZlbmNlLCB1c2Vy
X2ZlbmNlcysrLCBzaXplb2YodXNlcl9mZW5jZSkpKSB7CisJCQllcnIgPSAtRUZBVUxUOworCQkJ
Z290byBlcnI7CisJCX0KKworCQlpZiAodXNlcl9mZW5jZS5mbGFncyAmIF9fSTkxNV9FWEVDX0ZF
TkNFX1VOS05PV05fRkxBR1MpIHsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJ
fQorCisJCWlmIChfX2dldF91c2VyKHBvaW50LCB1c2VyX3ZhbHVlcysrKSkgeworCQkJZXJyID0g
LUVGQVVMVDsKKwkJCWdvdG8gZXJyOworCQl9CisKKwkJc3luY29iaiA9IGRybV9zeW5jb2JqX2Zp
bmQoZWItPmZpbGUsIHVzZXJfZmVuY2UuaGFuZGxlKTsKKwkJaWYgKCFzeW5jb2JqKSB7CisJCQlE
Uk1fREVCVUcoIkludmFsaWQgc3luY29iaiBoYW5kbGUgcHJvdmlkZWRcbiIpOworCQkJZXJyID0g
LUVOT0VOVDsKKwkJCWdvdG8gZXJyOworCQl9CisKKwkJaWYgKHVzZXJfZmVuY2UuZmxhZ3MgJiBJ
OTE1X0VYRUNfRkVOQ0VfV0FJVCkgeworCQkJZmVuY2UgPSBkcm1fc3luY29ial9mZW5jZV9nZXQo
c3luY29iaik7CisJCQlpZiAoIWZlbmNlKSB7CisJCQkJRFJNX0RFQlVHKCJTeW5jb2JqIGhhbmRs
ZSBoYXMgbm8gZmVuY2VcbiIpOworCQkJCWRybV9zeW5jb2JqX3B1dChzeW5jb2JqKTsKKwkJCQll
cnIgPSAtRUlOVkFMOworCQkJCWdvdG8gZXJyOworCQkJfQorCisJCQllcnIgPSBkbWFfZmVuY2Vf
Y2hhaW5fZmluZF9zZXFubygmZmVuY2UsIHBvaW50KTsKKwkJCWlmIChlcnIpIHsKKwkJCQlEUk1f
REVCVUcoIlN5bmNvYmogaGFuZGxlIG1pc3NpbmcgcmVxdWVzdGVkIHBvaW50ICVsbHVcbiIsIHBv
aW50KTsKKwkJCQlkcm1fc3luY29ial9wdXQoc3luY29iaik7CisJCQkJZ290byBlcnI7CisJCQl9
CisKKwkJCS8qIEEgcG9pbnQgbWlnaHQgaGF2ZSBiZWVuIHNpZ25hbGVkIGFscmVhZHkgYW5kCisJ
CQkgKiBnYXJiYWdlIGNvbGxlY3RlZCBmcm9tIHRoZSB0aW1lbGluZS4gSW4gdGhpcyBjYXNlCisJ
CQkgKiBqdXN0IGlnbm9yZSB0aGUgcG9pbnQgYW5kIGNhcnJ5IG9uLgorCQkJICovCisJCQlpZiAo
IWZlbmNlKSB7CisJCQkJZHJtX3N5bmNvYmpfcHV0KHN5bmNvYmopOworCQkJCWNvbnRpbnVlOwor
CQkJfQorCQl9CisKKwkJLyoKKwkJICogRm9yIHRpbWVsaW5lIHN5bmNvYmpzIHdlIG5lZWQgdG8g
cHJlYWxsb2NhdGUgY2hhaW5zIGZvcgorCQkgKiBsYXRlciBzaWduYWxpbmcuCisJCSAqLworCQlp
ZiAocG9pbnQgIT0gMCAmJiB1c2VyX2ZlbmNlLmZsYWdzICYgSTkxNV9FWEVDX0ZFTkNFX1NJR05B
TCkgeworCQkJZmVuY2VzW251bV9mZW5jZXNdLmNoYWluX2ZlbmNlID0KKwkJCQlrbWFsbG9jKHNp
emVvZigqZmVuY2VzW251bV9mZW5jZXNdLmNoYWluX2ZlbmNlKSwKKwkJCQkJR0ZQX0tFUk5FTCk7
CisJCQlpZiAoIWZlbmNlc1tudW1fZmVuY2VzXS5jaGFpbl9mZW5jZSkgeworCQkJCWRtYV9mZW5j
ZV9wdXQoZmVuY2UpOworCQkJCWRybV9zeW5jb2JqX3B1dChzeW5jb2JqKTsKKwkJCQllcnIgPSAt
RU5PTUVNOworCQkJCURSTV9ERUJVRygiVW5hYmxlIHRvIGFsbG9jIGNoYWluX2ZlbmNlXG4iKTsK
KwkJCQlnb3RvIGVycjsKKwkJCX0KKwkJfSBlbHNlIHsKKwkJCWZlbmNlc1tudW1fZmVuY2VzXS5j
aGFpbl9mZW5jZSA9IE5VTEw7CisJCX0KKworCQlmZW5jZXNbbnVtX2ZlbmNlc10uc3luY29iaiA9
IHB0cl9wYWNrX2JpdHMoc3luY29iaiwgdXNlcl9mZW5jZS5mbGFncywgMik7CisJCWZlbmNlc1tu
dW1fZmVuY2VzXS5kbWFfZmVuY2UgPSBmZW5jZTsKKwkJZmVuY2VzW251bV9mZW5jZXNdLnZhbHVl
ID0gcG9pbnQ7CisJCW51bV9mZW5jZXMrKzsKKwl9CisKKwkqb3V0X25fZmVuY2VzID0gbnVtX2Zl
bmNlczsKKworCXJldHVybiBmZW5jZXM7CisKK2VycjoKKwlfX2ZyZWVfZmVuY2VfYXJyYXkoZmVu
Y2VzLCBudW1fZmVuY2VzKTsKKwlyZXR1cm4gRVJSX1BUUihlcnIpOworfQorCitzdGF0aWMgc3Ry
dWN0IGk5MTVfZWJfZmVuY2VzICoKK2dldF9sZWdhY3lfZmVuY2VfYXJyYXkoc3RydWN0IGk5MTVf
ZXhlY2J1ZmZlciAqZWIsCisJCSAgICAgICBpbnQgKm91dF9uX2ZlbmNlcykKIHsKLQljb25zdCB1
bnNpZ25lZCBsb25nIG5mZW5jZXMgPSBhcmdzLT5udW1fY2xpcHJlY3RzOworCXN0cnVjdCBkcm1f
aTkxNV9nZW1fZXhlY2J1ZmZlcjIgKmFyZ3MgPSBlYi0+YXJnczsKIAlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX2V4ZWNfZmVuY2UgX191c2VyICp1c2VyOwotCXN0cnVjdCBkcm1fc3luY29iaiAqKmZlbmNl
czsKKwlzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNlczsKKwljb25zdCB1MzIgbnVtX2ZlbmNl
cyA9IGFyZ3MtPm51bV9jbGlwcmVjdHM7CiAJdW5zaWduZWQgbG9uZyBuOwogCWludCBlcnI7CiAK
LQlpZiAoIShhcmdzLT5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9BUlJBWSkpCi0JCXJldHVybiBO
VUxMOworCSpvdXRfbl9mZW5jZXMgPSBudW1fZmVuY2VzOwogCiAJLyogQ2hlY2sgbXVsdGlwbGlj
YXRpb24gb3ZlcmZsb3cgZm9yIGFjY2Vzc19vaygpIGFuZCBrdm1hbGxvY19hcnJheSgpICovCiAJ
QlVJTERfQlVHX09OKHNpemVvZihzaXplX3QpID4gc2l6ZW9mKHVuc2lnbmVkIGxvbmcpKTsKLQlp
ZiAobmZlbmNlcyA+IG1pbl90KHVuc2lnbmVkIGxvbmcsCi0JCQkgICAgVUxPTkdfTUFYIC8gc2l6
ZW9mKCp1c2VyKSwKLQkJCSAgICBTSVpFX01BWCAvIHNpemVvZigqZmVuY2VzKSkpCisJaWYgKCpv
dXRfbl9mZW5jZXMgPiBtaW5fdCh1bnNpZ25lZCBsb25nLAorCQkJCSAgVUxPTkdfTUFYIC8gc2l6
ZW9mKCp1c2VyKSwKKwkJCQkgIFNJWkVfTUFYIC8gc2l6ZW9mKCpmZW5jZXMpKSkKIAkJcmV0dXJu
IEVSUl9QVFIoLUVJTlZBTCk7CiAKIAl1c2VyID0gdTY0X3RvX3VzZXJfcHRyKGFyZ3MtPmNsaXBy
ZWN0c19wdHIpOwotCWlmICghYWNjZXNzX29rKHVzZXIsIG5mZW5jZXMgKiBzaXplb2YoKnVzZXIp
KSkKKwlpZiAoIWFjY2Vzc19vayh1c2VyLCAqb3V0X25fZmVuY2VzICogc2l6ZW9mKCp1c2VyKSkp
CiAJCXJldHVybiBFUlJfUFRSKC1FRkFVTFQpOwogCi0JZmVuY2VzID0ga3ZtYWxsb2NfYXJyYXko
bmZlbmNlcywgc2l6ZW9mKCpmZW5jZXMpLAorCWZlbmNlcyA9IGt2bWFsbG9jX2FycmF5KCpvdXRf
bl9mZW5jZXMsIHNpemVvZigqZmVuY2VzKSwKIAkJCQlfX0dGUF9OT1dBUk4gfCBHRlBfS0VSTkVM
KTsKIAlpZiAoIWZlbmNlcykKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKLQlmb3IgKG4g
PSAwOyBuIDwgbmZlbmNlczsgbisrKSB7Ci0JCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19mZW5j
ZSBmZW5jZTsKKwlmb3IgKG4gPSAwOyBuIDwgKm91dF9uX2ZlbmNlczsgbisrKSB7CisJCXN0cnVj
dCBkcm1faTkxNV9nZW1fZXhlY19mZW5jZSB1c2VyX2ZlbmNlOwogCQlzdHJ1Y3QgZHJtX3N5bmNv
YmogKnN5bmNvYmo7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gTlVMTDsKIAotCQlpZiAo
X19jb3B5X2Zyb21fdXNlcigmZmVuY2UsIHVzZXIrKywgc2l6ZW9mKGZlbmNlKSkpIHsKKwkJaWYg
KF9fY29weV9mcm9tX3VzZXIoJnVzZXJfZmVuY2UsIHVzZXIrKywgc2l6ZW9mKHVzZXJfZmVuY2Up
KSkgewogCQkJZXJyID0gLUVGQVVMVDsKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJaWYgKGZlbmNl
LmZsYWdzICYgX19JOTE1X0VYRUNfRkVOQ0VfVU5LTk9XTl9GTEFHUykgeworCQlpZiAodXNlcl9m
ZW5jZS5mbGFncyAmIF9fSTkxNV9FWEVDX0ZFTkNFX1VOS05PV05fRkxBR1MpIHsKIAkJCWVyciA9
IC1FSU5WQUw7CiAJCQlnb3RvIGVycjsKIAkJfQogCi0JCXN5bmNvYmogPSBkcm1fc3luY29ial9m
aW5kKGZpbGUsIGZlbmNlLmhhbmRsZSk7CisJCXN5bmNvYmogPSBkcm1fc3luY29ial9maW5kKGVi
LT5maWxlLCB1c2VyX2ZlbmNlLmhhbmRsZSk7CiAJCWlmICghc3luY29iaikgewogCQkJRFJNX0RF
QlVHKCJJbnZhbGlkIHN5bmNvYmogaGFuZGxlIHByb3ZpZGVkXG4iKTsKIAkJCWVyciA9IC1FTk9F
TlQ7CiAJCQlnb3RvIGVycjsKIAkJfQogCisJCWlmICh1c2VyX2ZlbmNlLmZsYWdzICYgSTkxNV9F
WEVDX0ZFTkNFX1dBSVQpIHsKKwkJCWZlbmNlID0gZHJtX3N5bmNvYmpfZmVuY2VfZ2V0KHN5bmNv
YmopOworCQkJaWYgKCFmZW5jZSkgeworCQkJCURSTV9ERUJVRygiU3luY29iaiBoYW5kbGUgaGFz
IG5vIGZlbmNlXG4iKTsKKwkJCQlkcm1fc3luY29ial9wdXQoc3luY29iaik7CisJCQkJZXJyID0g
LUVJTlZBTDsKKwkJCQlnb3RvIGVycjsKKwkJCX0KKwkJfQorCiAJCUJVSUxEX0JVR19PTih+KEFS
Q0hfS01BTExPQ19NSU5BTElHTiAtIDEpICYKIAkJCSAgICAgfl9fSTkxNV9FWEVDX0ZFTkNFX1VO
S05PV05fRkxBR1MpOwogCi0JCWZlbmNlc1tuXSA9IHB0cl9wYWNrX2JpdHMoc3luY29iaiwgZmVu
Y2UuZmxhZ3MsIDIpOworCQlmZW5jZXNbbl0uc3luY29iaiA9IHB0cl9wYWNrX2JpdHMoc3luY29i
aiwgdXNlcl9mZW5jZS5mbGFncywgMik7CisJCWZlbmNlc1tuXS5kbWFfZmVuY2UgPSBmZW5jZTsK
KwkJZmVuY2VzW25dLnZhbHVlID0gMDsKKwkJZmVuY2VzW25dLmNoYWluX2ZlbmNlID0gTlVMTDsK
IAl9CiAKIAlyZXR1cm4gZmVuY2VzOwpAQCAtMjI4OSwzNyArMjQzNyw0NCBAQCBnZXRfZmVuY2Vf
YXJyYXkoc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiAqYXJncywKIAlyZXR1cm4gRVJS
X1BUUihlcnIpOwogfQogCitzdGF0aWMgc3RydWN0IGk5MTVfZWJfZmVuY2VzICoKK2dldF9mZW5j
ZV9hcnJheShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwgaW50ICpvdXRfbl9mZW5jZXMpCit7
CisJaWYgKGViLT5hcmdzLT5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9BUlJBWSkKKwkJcmV0dXJu
IGdldF9sZWdhY3lfZmVuY2VfYXJyYXkoZWIsIG91dF9uX2ZlbmNlcyk7CisKKwlpZiAoZWItPmV4
dGVuc2lvbnMuZmxhZ3MgJiBCSVRfVUxMKERSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9USU1F
TElORV9GRU5DRVMpKQorCQlyZXR1cm4gZ2V0X3RpbWVsaW5lX2ZlbmNlX2FycmF5KGViLCBvdXRf
bl9mZW5jZXMpOworCisJKm91dF9uX2ZlbmNlcyA9IDA7CisJcmV0dXJuIE5VTEw7Cit9CisKIHN0
YXRpYyB2b2lkCi1wdXRfZmVuY2VfYXJyYXkoc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVy
MiAqYXJncywKLQkJc3RydWN0IGRybV9zeW5jb2JqICoqZmVuY2VzKQorcHV0X2ZlbmNlX2FycmF5
KHN0cnVjdCBpOTE1X2ViX2ZlbmNlcyAqZmVuY2VzLCBpbnQgbmZlbmNlcykKIHsKIAlpZiAoZmVu
Y2VzKQotCQlfX2ZyZWVfZmVuY2VfYXJyYXkoZmVuY2VzLCBhcmdzLT5udW1fY2xpcHJlY3RzKTsK
KwkJX19mcmVlX2ZlbmNlX2FycmF5KGZlbmNlcywgbmZlbmNlcyk7CiB9CiAKIHN0YXRpYyBpbnQK
IGF3YWl0X2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAotCQkgIHN0cnVj
dCBkcm1fc3luY29iaiAqKmZlbmNlcykKKwkJICBzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNl
cywKKwkJICBpbnQgbmZlbmNlcykKIHsKLQljb25zdCB1bnNpZ25lZCBpbnQgbmZlbmNlcyA9IGVi
LT5hcmdzLT5udW1fY2xpcHJlY3RzOwogCXVuc2lnbmVkIGludCBuOwogCWludCBlcnI7CiAKIAlm
b3IgKG4gPSAwOyBuIDwgbmZlbmNlczsgbisrKSB7CiAJCXN0cnVjdCBkcm1fc3luY29iaiAqc3lu
Y29iajsKLQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAJCXVuc2lnbmVkIGludCBmbGFnczsK
IAotCQlzeW5jb2JqID0gcHRyX3VucGFja19iaXRzKGZlbmNlc1tuXSwgJmZsYWdzLCAyKTsKKwkJ
c3luY29iaiA9IHB0cl91bnBhY2tfYml0cyhmZW5jZXNbbl0uc3luY29iaiwgJmZsYWdzLCAyKTsK
IAkJaWYgKCEoZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfV0FJVCkpCiAJCQljb250aW51ZTsKIAot
CQlmZW5jZSA9IGRybV9zeW5jb2JqX2ZlbmNlX2dldChzeW5jb2JqKTsKLQkJaWYgKCFmZW5jZSkK
LQkJCXJldHVybiAtRUlOVkFMOwotCi0JCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVu
Y2UoZWItPnJlcXVlc3QsIGZlbmNlKTsKLQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCWVyciA9
IGk5MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UoZWItPnJlcXVlc3QsCisJCQkJCQkgICBmZW5j
ZXNbbl0uZG1hX2ZlbmNlKTsKIAkJaWYgKGVyciA8IDApCiAJCQlyZXR1cm4gZXJyOwogCX0KQEAg
LTIzMjksOSArMjQ4NCw5IEBAIGF3YWl0X2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZm
ZXIgKmViLAogCiBzdGF0aWMgdm9pZAogc2lnbmFsX2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4
ZWNidWZmZXIgKmViLAotCQkgICBzdHJ1Y3QgZHJtX3N5bmNvYmogKipmZW5jZXMpCisJCSAgIHN0
cnVjdCBpOTE1X2ViX2ZlbmNlcyAqZmVuY2VzLAorCQkgICBpbnQgbmZlbmNlcykKIHsKLQljb25z
dCB1bnNpZ25lZCBpbnQgbmZlbmNlcyA9IGViLT5hcmdzLT5udW1fY2xpcHJlY3RzOwogCXN0cnVj
dCBkbWFfZmVuY2UgKiBjb25zdCBmZW5jZSA9ICZlYi0+cmVxdWVzdC0+ZmVuY2U7CiAJdW5zaWdu
ZWQgaW50IG47CiAKQEAgLTIzMzksMTUgKzI0OTQsNDYgQEAgc2lnbmFsX2ZlbmNlX2FycmF5KHN0
cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCQlzdHJ1Y3QgZHJtX3N5bmNvYmogKnN5bmNvYmo7
CiAJCXVuc2lnbmVkIGludCBmbGFnczsKIAotCQlzeW5jb2JqID0gcHRyX3VucGFja19iaXRzKGZl
bmNlc1tuXSwgJmZsYWdzLCAyKTsKKwkJc3luY29iaiA9IHB0cl91bnBhY2tfYml0cyhmZW5jZXNb
bl0uc3luY29iaiwgJmZsYWdzLCAyKTsKIAkJaWYgKCEoZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0Vf
U0lHTkFMKSkKIAkJCWNvbnRpbnVlOwogCi0JCWRybV9zeW5jb2JqX3JlcGxhY2VfZmVuY2Uoc3lu
Y29iaiwgZmVuY2UpOworCQlpZiAoZmVuY2VzW25dLmNoYWluX2ZlbmNlKSB7CisJCQlkcm1fc3lu
Y29ial9hZGRfcG9pbnQoc3luY29iaiwgZmVuY2VzW25dLmNoYWluX2ZlbmNlLAorCQkJCQkgICAg
ICBmZW5jZSwgZmVuY2VzW25dLnZhbHVlKTsKKwkJCS8qCisJCQkgKiBUaGUgY2hhaW4ncyBvd25l
cnNoaXAgaXMgdHJhbnNmZXJlZCB0byB0aGUKKwkJCSAqIHRpbWVsaW5lLgorCQkJICovCisJCQlm
ZW5jZXNbbl0uY2hhaW5fZmVuY2UgPSBOVUxMOworCQl9IGVsc2UgeworCQkJZHJtX3N5bmNvYmpf
cmVwbGFjZV9mZW5jZShzeW5jb2JqLCBmZW5jZSk7CisJCX0KIAl9CiB9CiAKK3N0YXRpYyBpbnQg
cGFyc2VfdGltZWxpbmVfZmVuY2VzKHN0cnVjdCBpOTE1X3VzZXJfZXh0ZW5zaW9uIF9fdXNlciAq
ZXh0LCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViID0gZGF0YTsK
KworCS8qIFRpbWVsaW5lIGZlbmNlcyBhcmUgaW5jb21wYXRpYmxlIHdpdGggdGhlIGZlbmNlIGFy
cmF5IGZsYWcuICovCisJaWYgKGViLT5hcmdzLT5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9BUlJB
WSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoZWItPmV4dGVuc2lvbnMuZmxhZ3MgJiBCSVRf
VUxMKERSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9USU1FTElORV9GRU5DRVMpKQorCQlyZXR1
cm4gLUVJTlZBTDsKKworCWlmIChjb3B5X2Zyb21fdXNlcigmZWItPmV4dGVuc2lvbnMudGltZWxp
bmVfZmVuY2VzLCBleHQsCisJCQkgICBzaXplb2YoZWItPmV4dGVuc2lvbnMudGltZWxpbmVfZmVu
Y2VzKSkpCisJCXJldHVybiAtRUZBVUxUOworCisJZWItPmV4dGVuc2lvbnMuZmxhZ3MgfD0gQklU
X1VMTChEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRfVElNRUxJTkVfRkVOQ0VTKTsKKworCXJl
dHVybiAwOworfQorCiBzdGF0aWMgY29uc3QgaTkxNV91c2VyX2V4dGVuc2lvbl9mbiBleGVjYnVm
X2V4dGVuc2lvbnNbXSA9IHsKKyAgICAgICAgW0RSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9U
SU1FTElORV9GRU5DRVNdID0gcGFyc2VfdGltZWxpbmVfZmVuY2VzLAogfTsKIAogc3RhdGljIGlu
dApAQCAtMjM3OCwxNCArMjU2NCwxNSBAQCBzdGF0aWMgaW50CiBpOTE1X2dlbV9kb19leGVjYnVm
ZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bGUsCiAJCSAgICAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdzLAotCQkg
ICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgKmV4ZWMsCi0JCSAgICAgICBz
dHJ1Y3QgZHJtX3N5bmNvYmogKipmZW5jZXMpCisJCSAgICAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X2V4ZWNfb2JqZWN0MiAqZXhlYykKIHsKIAlzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyIGViOwogCXN0
cnVjdCBkbWFfZmVuY2UgKmluX2ZlbmNlID0gTlVMTDsKIAlzdHJ1Y3QgZG1hX2ZlbmNlICpleGVj
X2ZlbmNlID0gTlVMTDsKIAlzdHJ1Y3Qgc3luY19maWxlICpvdXRfZmVuY2UgPSBOVUxMOworCXN0
cnVjdCBpOTE1X2ViX2ZlbmNlcyAqZmVuY2VzID0gTlVMTDsKIAlpbnQgb3V0X2ZlbmNlX2ZkID0g
LTE7CisJaW50IG5mZW5jZXMgPSAwOwogCWludCBlcnI7CiAKIAlCVUlMRF9CVUdfT04oX19FWEVD
X0lOVEVSTkFMX0ZMQUdTICYgfl9fSTkxNV9FWEVDX0lMTEVHQUxfRkxBR1MpOwpAQCAtMjQyNCwx
MCArMjYxMSwxNiBAQCBpOTE1X2dlbV9kb19leGVjYnVmZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsCiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAorCWZlbmNlcyA9IGdldF9mZW5jZV9hcnJh
eSgmZWIsICZuZmVuY2VzKTsKKwlpZiAoSVNfRVJSKGZlbmNlcykpCisJCXJldHVybiBQVFJfRVJS
KGZlbmNlcyk7CisKIAlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfSU4pIHsKIAkJ
aW5fZmVuY2UgPSBzeW5jX2ZpbGVfZ2V0X2ZlbmNlKGxvd2VyXzMyX2JpdHMoYXJncy0+cnN2ZDIp
KTsKLQkJaWYgKCFpbl9mZW5jZSkKLQkJCXJldHVybiAtRUlOVkFMOworCQlpZiAoIWluX2ZlbmNl
KSB7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnJfZmVuY2VzOworCQl9CiAJfQogCiAJ
aWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9FWEVDX0ZFTkNFX1NVQk1JVCkgewpAQCAtMjU4NSw3ICsy
Nzc4LDcgQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAog
CX0KIAogCWlmIChmZW5jZXMpIHsKLQkJZXJyID0gYXdhaXRfZmVuY2VfYXJyYXkoJmViLCBmZW5j
ZXMpOworCQllcnIgPSBhd2FpdF9mZW5jZV9hcnJheSgmZWIsIGZlbmNlcywgbmZlbmNlcyk7CiAJ
CWlmIChlcnIpCiAJCQlnb3RvIGVycl9yZXF1ZXN0OwogCX0KQEAgLTI2MTQsNyArMjgwNyw3IEBA
IGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlpOTE1X3Jl
cXVlc3RfYWRkKGViLnJlcXVlc3QpOwogCiAJaWYgKGZlbmNlcykKLQkJc2lnbmFsX2ZlbmNlX2Fy
cmF5KCZlYiwgZmVuY2VzKTsKKwkJc2lnbmFsX2ZlbmNlX2FycmF5KCZlYiwgZmVuY2VzLCBuZmVu
Y2VzKTsKIAogCWlmIChvdXRfZmVuY2UpIHsKIAkJaWYgKGVyciA9PSAwKSB7CkBAIC0yNjQ5LDYg
KzI4NDIsOCBAQCBpOTE1X2dlbV9kb19leGVjYnVmZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
CiAJZG1hX2ZlbmNlX3B1dChleGVjX2ZlbmNlKTsKIGVycl9pbl9mZW5jZToKIAlkbWFfZmVuY2Vf
cHV0KGluX2ZlbmNlKTsKK2Vycl9mZW5jZXM6CisJcHV0X2ZlbmNlX2FycmF5KGZlbmNlcywgbmZl
bmNlcyk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjc0Miw3ICsyOTM3LDcgQEAgaTkxNV9nZW1f
ZXhlY2J1ZmZlcl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQkJ
ZXhlYzJfbGlzdFtpXS5mbGFncyA9IDA7CiAJfQogCi0JZXJyID0gaTkxNV9nZW1fZG9fZXhlY2J1
ZmZlcihkZXYsIGZpbGUsICZleGVjMiwgZXhlYzJfbGlzdCwgTlVMTCk7CisJZXJyID0gaTkxNV9n
ZW1fZG9fZXhlY2J1ZmZlcihkZXYsIGZpbGUsICZleGVjMiwgZXhlYzJfbGlzdCk7CiAJaWYgKGV4
ZWMyLmZsYWdzICYgX19FWEVDX0hBU19SRUxPQykgewogCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4
ZWNfb2JqZWN0IF9fdXNlciAqdXNlcl9leGVjX2xpc3QgPQogCQkJdTY0X3RvX3VzZXJfcHRyKGFy
Z3MtPmJ1ZmZlcnNfcHRyKTsKQEAgLTI3NzMsNyArMjk2OCw2IEBAIGk5MTVfZ2VtX2V4ZWNidWZm
ZXIyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiB7CiAJc3RydWN0
IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiAqYXJncyA9IGRhdGE7CiAJc3RydWN0IGRybV9pOTE1
X2dlbV9leGVjX29iamVjdDIgKmV4ZWMyX2xpc3Q7Ci0Jc3RydWN0IGRybV9zeW5jb2JqICoqZmVu
Y2VzID0gTlVMTDsKIAljb25zdCBzaXplX3QgY291bnQgPSBhcmdzLT5idWZmZXJfY291bnQ7CiAJ
aW50IGVycjsKIApAQCAtMjgwMSwxNSArMjk5NSw3IEBAIGk5MTVfZ2VtX2V4ZWNidWZmZXIyX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXJldHVybiAtRUZBVUxU
OwogCX0KIAotCWlmIChhcmdzLT5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9BUlJBWSkgewotCQlm
ZW5jZXMgPSBnZXRfZmVuY2VfYXJyYXkoYXJncywgZmlsZSk7Ci0JCWlmIChJU19FUlIoZmVuY2Vz
KSkgewotCQkJa3ZmcmVlKGV4ZWMyX2xpc3QpOwotCQkJcmV0dXJuIFBUUl9FUlIoZmVuY2VzKTsK
LQkJfQotCX0KLQotCWVyciA9IGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoZGV2LCBmaWxlLCBhcmdz
LCBleGVjMl9saXN0LCBmZW5jZXMpOworCWVyciA9IGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoZGV2
LCBmaWxlLCBhcmdzLCBleGVjMl9saXN0KTsKIAogCS8qCiAJICogTm93IHRoYXQgd2UgaGF2ZSBi
ZWd1biBleGVjdXRpb24gb2YgdGhlIGJhdGNoYnVmZmVyLCB3ZSBpZ25vcmUKQEAgLTI4NDksNyAr
MzAzNSw2IEBAIGVuZDo7CiAJfQogCiAJYXJncy0+ZmxhZ3MgJj0gfl9fSTkxNV9FWEVDX1VOS05P
V05fRkxBR1M7Ci0JcHV0X2ZlbmNlX2FycmF5KGFyZ3MsIGZlbmNlcyk7CiAJa3ZmcmVlKGV4ZWMy
X2xpc3QpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCA3NjE3
MjY4MThhMjIuLmE2YWNlY2U5OWFiZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC00NjMs
NiArNDYzLDcgQEAgc3RhdGljIGludCBpOTE1X2dldHBhcmFtX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJY2FzZSBJOTE1X1BBUkFNX0hBU19FWEVDX0JBVENIX0ZJ
UlNUOgogCWNhc2UgSTkxNV9QQVJBTV9IQVNfRVhFQ19GRU5DRV9BUlJBWToKIAljYXNlIEk5MTVf
UEFSQU1fSEFTX0VYRUNfU1VCTUlUX0ZFTkNFOgorCWNhc2UgSTkxNV9QQVJBTV9IQVNfRVhFQ19U
SU1FTElORV9GRU5DRVM6CiAJCS8qIEZvciB0aGUgdGltZSBiZWluZyBhbGwgb2YgdGhlc2UgYXJl
IGFsd2F5cyB0cnVlOwogCQkgKiBpZiBzb21lIHN1cHBvcnRlZCBoYXJkd2FyZSBkb2VzIG5vdCBo
YXZlIG9uZSBvZiB0aGVzZQogCQkgKiBmZWF0dXJlcyB0aGlzIHZhbHVlIG5lZWRzIHRvIGJlIHBy
b3ZpZGVkIGZyb20KQEAgLTMyMDgsNyArMzIwOSw4IEBAIHN0YXRpYyBzdHJ1Y3QgZHJtX2RyaXZl
ciBkcml2ZXIgPSB7CiAJICovCiAJLmRyaXZlcl9mZWF0dXJlcyA9CiAJICAgIERSSVZFUl9HRU0g
fAotCSAgICBEUklWRVJfUkVOREVSIHwgRFJJVkVSX01PREVTRVQgfCBEUklWRVJfQVRPTUlDIHwg
RFJJVkVSX1NZTkNPQkosCisJICAgIERSSVZFUl9SRU5ERVIgfCBEUklWRVJfTU9ERVNFVCB8IERS
SVZFUl9BVE9NSUMgfCBEUklWRVJfU1lOQ09CSiB8CisJICAgIERSSVZFUl9TWU5DT0JKX1RJTUVM
SU5FLAogCS5yZWxlYXNlID0gaTkxNV9kcml2ZXJfcmVsZWFzZSwKIAkub3BlbiA9IGk5MTVfZHJp
dmVyX29wZW4sCiAJLmxhc3RjbG9zZSA9IGk5MTVfZHJpdmVyX2xhc3RjbG9zZSwKZGlmZiAtLWdp
dCBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9k
cm0uaAppbmRleCA3ZWEzNWIwNDhhODIuLjkyYzMzMjNmMzE2NyAxMDA2NDQKLS0tIGEvaW5jbHVk
ZS91YXBpL2RybS9pOTE1X2RybS5oCisrKyBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaApA
QCAtNjExLDYgKzYxMSwxMyBAQCB0eXBlZGVmIHN0cnVjdCBkcm1faTkxNV9pcnFfd2FpdCB7CiAg
KiBTZWUgSTkxNV9FWEVDX0ZFTkNFX09VVCBhbmQgSTkxNV9FWEVDX0ZFTkNFX1NVQk1JVC4KICAq
LwogI2RlZmluZSBJOTE1X1BBUkFNX0hBU19FWEVDX1NVQk1JVF9GRU5DRSA1MworCisvKiBRdWVy
eSB3aGV0aGVyIERSTV9JOTE1X0dFTV9FWEVDQlVGRkVSMiBzdXBwb3J0cyBzdXBwbHlpbmcgYW4g
YXJyYXkgb2YKKyAqIHRpbWVsaW5lIHN5bmNvYmogdGhyb3VnaCBkcm1faTkxNV9nZW1fZXhlY2J1
Zl9leHRfdGltZWxpbmVfZmVuY2VzLiBTZWUKKyAqIEk5MTVfRVhFQ19FWFQuCisgKi8KKyNkZWZp
bmUgSTkxNV9QQVJBTV9IQVNfRVhFQ19USU1FTElORV9GRU5DRVMgNTQKKwogLyogTXVzdCBiZSBr
ZXB0IGNvbXBhY3QgLS0gbm8gaG9sZXMgYW5kIHdlbGwgZG9jdW1lbnRlZCAqLwogCiB0eXBlZGVm
IHN0cnVjdCBkcm1faTkxNV9nZXRwYXJhbSB7CkBAIC0xMDA4LDkgKzEwMTUsNDEgQEAgc3RydWN0
IGRybV9pOTE1X2dlbV9leGVjX2ZlbmNlIHsKIH07CiAKIGVudW0gZHJtX2k5MTVfZ2VtX2V4ZWNi
dWZmZXJfZXh0IHsKKwkvKioKKwkgKiBTZWUgZHJtX2k5MTVfZ2VtX2V4ZWNidWZfZXh0X3RpbWVs
aW5lX2ZlbmNlcy4KKwkgKi8KKwlEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRfVElNRUxJTkVf
RkVOQ0VTID0gMCwKKwogCURSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9NQVggLyogbm9uLUFC
SSAqLwogfTsKIAorLyoqCisgKiBUaGlzIHN0cnVjdHVyZSBkZXNjcmliZXMgYW4gYXJyYXkgb2Yg
ZHJtX3N5bmNvYmogYW5kIGFzc29jaWF0ZWQgcG9pbnRzIGZvcgorICogdGltZWxpbmUgdmFyaWFu
dHMgb2YgZHJtX3N5bmNvYmouIEl0IGlzIGludmFsaWQgdG8gYXBwZW5kIHRoaXMgc3RydWN0dXJl
IHRvCisgKiB0aGUgZXhlY2J1ZiBpZiBJOTE1X0VYRUNfRkVOQ0VfQVJSQVkgaXMgc2V0LgorICov
CitzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXJfZXh0X3RpbWVsaW5lX2ZlbmNlcyB7CisJ
c3RydWN0IGk5MTVfdXNlcl9leHRlbnNpb24gYmFzZTsKKworCS8qKgorCSAqIE51bWJlciBvZiBl
bGVtZW50IGluIHRoZSBoYW5kbGVzX3B0ciAmIHZhbHVlX3B0ciBhcnJheXMuCisJICovCisJX191
NjQgZmVuY2VfY291bnQ7CisKKwkvKioKKwkgKiBQb2ludGVyIHRvIGFuIGFycmF5IG9mIHN0cnVj
dCBkcm1faTkxNV9nZW1fZXhlY19mZW5jZSBvZiBsZW5ndGgKKwkgKiBmZW5jZV9jb3VudC4KKwkg
Ki8KKwlfX3U2NCBoYW5kbGVzX3B0cjsKKworCS8qKgorCSAqIFBvaW50ZXIgdG8gYW4gYXJyYXkg
b2YgdTY0IHZhbHVlcyBvZiBsZW5ndGggZmVuY2VfY291bnQuIFZhbHVlcworCSAqIG11c3QgYmUg
MCBmb3IgYSBiaW5hcnkgZHJtX3N5bmNvYmouIEEgVmFsdWUgb2YgMCBmb3IgYSB0aW1lbGluZQor
CSAqIGRybV9zeW5jb2JqIGlzIGludmFsaWQgYXMgaXQgdHVybnMgYSBkcm1fc3luY29iaiBpbnRv
IGEgYmluYXJ5IG9uZS4KKwkgKi8KKwlfX3U2NCB2YWx1ZXNfcHRyOworfTsKKwogc3RydWN0IGRy
bV9pOTE1X2dlbV9leGVjYnVmZmVyMiB7CiAJLyoqCiAJICogTGlzdCBvZiBnZW1fZXhlY19vYmpl
Y3QyIHN0cnVjdHMKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

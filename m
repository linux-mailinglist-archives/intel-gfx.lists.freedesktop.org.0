Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C7C77AC3AB
	for <lists+intel-gfx@lfdr.de>; Sat,  7 Sep 2019 02:22:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 27C3B6E077;
	Sat,  7 Sep 2019 00:22:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CD25D6E077
 for <intel-gfx@lists.freedesktop.org>; Sat,  7 Sep 2019 00:22:02 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Sep 2019 17:22:02 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,474,1559545200"; d="scan'208";a="177796039"
Received: from mdroper-desk.fm.intel.com ([10.105.128.12])
 by orsmga008.jf.intel.com with ESMTP; 06 Sep 2019 17:22:02 -0700
From: Matt Roper <matthew.d.roper@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  6 Sep 2019 17:21:38 -0700
Message-Id: <20190907002143.22591-4-matthew.d.roper@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190907002143.22591-1-matthew.d.roper@intel.com>
References: <20190907002143.22591-1-matthew.d.roper@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/8] drm/i915: Combine bxt_set_cdclk and
 cnl_set_cdclk
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UnZCBwcmV2aW91c2x5IGNvbWJpbmVkIElDTC9UR0wgbG9naWMgaW50byB0aGUgY25sX3NldF9j
ZGNsayBmdW5jdGlvbiwKYnV0IEJYVCBpcyBwcmV0dHkgc2ltaWxhciBhcyB3ZWxsLiAgUm9sbCB0
aGUgY25sL2ljbC90Z2wgbG9naWMgYmFjayBpbnRvCnRoZSBieHQgZnVuY3Rpb247IHRoZSBvbmx5
IHRoaW5ncyB3ZSByZWFsbHkgbmVlZCB0byBoYW5kbGUgc2VwYXJhdGVseQphcmUgcHVuaXQgbm90
aWZpY2F0aW9uIGFuZCBjYWxsaW5nIGRpZmZlcmVudCBmdW5jdGlvbnMgdG8gZW5hYmxlL2Rpc2Fi
bGUKdGhlIGNkY2xrIFBMTC4KCkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGlu
dXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBNYXR0IFJvcGVyIDxtYXR0aGV3LmQucm9wZXJA
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsu
YyB8IDI2NyArKysrKysrKystLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMTkgaW5zZXJ0
aW9ucygrKSwgMTQ4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfY2RjbGsuYwppbmRleCA4YWMzMWY4Nzc1ZjAuLjZiNWIxMzI4YTNmYSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYwpAQCAtMTQ0OSw2ICsxNDQ5LDM5
IEBAIHN0YXRpYyB2b2lkIGJ4dF9kZV9wbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgaW50IHZjbykKIAlkZXZfcHJpdi0+Y2RjbGsuaHcudmNvID0gdmNvOwogfQog
CitzdGF0aWMgdm9pZCBjbmxfY2RjbGtfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQoreworCXUzMiB2YWw7CisKKwl2YWwgPSBJOTE1X1JFQUQoQlhUX0RFX1BM
TF9FTkFCTEUpOworCXZhbCAmPSB+QlhUX0RFX1BMTF9QTExfRU5BQkxFOworCUk5MTVfV1JJVEUo
QlhUX0RFX1BMTF9FTkFCTEUsIHZhbCk7CisKKwkvKiBUaW1lb3V0IDIwMHVzICovCisJaWYgKHdh
aXRfZm9yKChJOTE1X1JFQUQoQlhUX0RFX1BMTF9FTkFCTEUpICYgQlhUX0RFX1BMTF9MT0NLKSA9
PSAwLCAxKSkKKwkJRFJNX0VSUk9SKCJ0aW1lb3V0IHdhaXRpbmcgZm9yIENEQ0xLIFBMTCB1bmxv
Y2tcbiIpOworCisJZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyA9IDA7Cit9CisKK3N0YXRpYyB2b2lk
IGNubF9jZGNsa19wbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
aW50IHZjbykKK3sKKwlpbnQgcmF0aW8gPSBESVZfUk9VTkRfQ0xPU0VTVCh2Y28sIGRldl9wcml2
LT5jZGNsay5ody5yZWYpOworCXUzMiB2YWw7CisKKwl2YWwgPSBDTkxfQ0RDTEtfUExMX1JBVElP
KHJhdGlvKTsKKwlJOTE1X1dSSVRFKEJYVF9ERV9QTExfRU5BQkxFLCB2YWwpOworCisJdmFsIHw9
IEJYVF9ERV9QTExfUExMX0VOQUJMRTsKKwlJOTE1X1dSSVRFKEJYVF9ERV9QTExfRU5BQkxFLCB2
YWwpOworCisJLyogVGltZW91dCAyMDB1cyAqLworCWlmICh3YWl0X2ZvcigoSTkxNV9SRUFEKEJY
VF9ERV9QTExfRU5BQkxFKSAmIEJYVF9ERV9QTExfTE9DSykgIT0gMCwgMSkpCisJCURSTV9FUlJP
UigidGltZW91dCB3YWl0aW5nIGZvciBDRENMSyBQTEwgbG9ja1xuIik7CisKKwlkZXZfcHJpdi0+
Y2RjbGsuaHcudmNvID0gdmNvOworfQorCiBzdGF0aWMgdm9pZCBieHRfc2V0X2NkY2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVsX2Nk
Y2xrX3N0YXRlICpjZGNsa19zdGF0ZSwKIAkJCSAgZW51bSBwaXBlIHBpcGUpCkBAIC0xNDU4LDYg
KzE0OTEsMjcgQEAgc3RhdGljIHZvaWQgYnh0X3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJdTMyIHZhbCwgZGl2aWRlcjsKIAlpbnQgcmV0OwogCisJLyogSW5m
b3JtIHBvd2VyIGNvbnRyb2xsZXIgb2YgdXBjb21pbmcgZnJlcXVlbmN5IGNoYW5nZS4gKi8KKwlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKKwkJcmV0ID0gc2tsX3Bjb2RlX3JlcXVlc3Qo
ZGV2X3ByaXYsIFNLTF9QQ09ERV9DRENMS19DT05UUk9MLAorCQkJCQlTS0xfQ0RDTEtfUFJFUEFS
RV9GT1JfQ0hBTkdFLAorCQkJCQlTS0xfQ0RDTEtfUkVBRFlfRk9SX0NIQU5HRSwKKwkJCQkJU0tM
X0NEQ0xLX1JFQURZX0ZPUl9DSEFOR0UsIDMpOworCWVsc2UKKwkJLyoKKwkJICogQlNwZWMgcmVx
dWlyZXMgdXMgdG8gd2FpdCB1cCB0byAxNTB1c2VjLCBidXQgdGhhdCBsZWFkcyB0bworCQkgKiB0
aW1lb3V0czsgdGhlIDJtcyB1c2VkIGhlcmUgaXMgYmFzZWQgb24gZXhwZXJpbWVudC4KKwkJICov
CisJCXJldCA9IHNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlX3RpbWVvdXQoZGV2X3ByaXYsCisJCQkJ
CQkgICAgICBIU1dfUENPREVfREVfV1JJVEVfRlJFUV9SRVEsCisJCQkJCQkgICAgICAweDgwMDAw
MDAwLCAxNTAsIDIpOworCisJaWYgKHJldCkgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBpbmZv
cm0gUENVIGFib3V0IGNkY2xrIGNoYW5nZSAoZXJyICVkLCBmcmVxICVkKVxuIiwKKwkJCSAgcmV0
LCBjZGNsayk7CisJCXJldHVybjsKKwl9CisKIAkvKiBjZGNsayA9IHZjbyAvIDIgLyBkaXZ7MSwx
LjUsMiw0fSAqLwogCXN3aXRjaCAoRElWX1JPVU5EX0NMT1NFU1QodmNvLCBjZGNsaykpIHsKIAlk
ZWZhdWx0OgpAQCAtMTQ2OCw2MyArMTUyMiw4MiBAQCBzdGF0aWMgdm9pZCBieHRfc2V0X2NkY2xr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJZGl2aWRlciA9IEJYVF9DRENM
S19DRDJYX0RJVl9TRUxfMTsKIAkJYnJlYWs7CiAJY2FzZSAzOgotCQlXQVJOKElTX0dFTUlOSUxB
S0UoZGV2X3ByaXYpLCAiVW5zdXBwb3J0ZWQgZGl2aWRlclxuIik7CisJCVdBUk4oSVNfR0VNSU5J
TEFLRShkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCwKKwkJICAgICAiVW5z
dXBwb3J0ZWQgZGl2aWRlclxuIik7CiAJCWRpdmlkZXIgPSBCWFRfQ0RDTEtfQ0QyWF9ESVZfU0VM
XzFfNTsKIAkJYnJlYWs7CiAJY2FzZSA0OgogCQlkaXZpZGVyID0gQlhUX0NEQ0xLX0NEMlhfRElW
X1NFTF8yOwogCQlicmVhazsKIAljYXNlIDg6CisJCVdBUk4oSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCwgIlVuc3VwcG9ydGVkIGRpdmlkZXJcbiIpOwogCQlkaXZpZGVyID0gQlhUX0NEQ0xLX0NE
MlhfRElWX1NFTF80OwogCQlicmVhazsKIAl9CiAKLQkvKgotCSAqIEluZm9ybSBwb3dlciBjb250
cm9sbGVyIG9mIHVwY29taW5nIGZyZXF1ZW5jeSBjaGFuZ2UuIEJTcGVjCi0JICogcmVxdWlyZXMg
dXMgdG8gd2FpdCB1cCB0byAxNTB1c2VjLCBidXQgdGhhdCBsZWFkcyB0byB0aW1lb3V0czsKLQkg
KiB0aGUgMm1zIHVzZWQgaGVyZSBpcyBiYXNlZCBvbiBleHBlcmltZW50LgotCSAqLwotCXJldCA9
IHNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlX3RpbWVvdXQoZGV2X3ByaXYsCi0JCQkJCSAgICAgIEhT
V19QQ09ERV9ERV9XUklURV9GUkVRX1JFUSwKLQkJCQkJICAgICAgMHg4MDAwMDAwMCwgMTUwLCAy
KTsKLQlpZiAocmV0KSB7Ci0JCURSTV9FUlJPUigiUENvZGUgQ0RDTEsgZnJlcSBjaGFuZ2Ugbm90
aWZ5IGZhaWxlZCAoZXJyICVkLCBmcmVxICVkKVxuIiwKLQkJCSAgcmV0LCBjZGNsayk7Ci0JCXJl
dHVybjsKLQl9CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApIHsKKwkJaWYgKGRldl9w
cml2LT5jZGNsay5ody52Y28gIT0gMCAmJgorCQkgICAgZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyAh
PSB2Y28pCisJCQljbmxfY2RjbGtfcGxsX2Rpc2FibGUoZGV2X3ByaXYpOwogCi0JaWYgKGRldl9w
cml2LT5jZGNsay5ody52Y28gIT0gMCAmJgotCSAgICBkZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9
IHZjbykKLQkJYnh0X2RlX3BsbF9kaXNhYmxlKGRldl9wcml2KTsKKwkJaWYgKGRldl9wcml2LT5j
ZGNsay5ody52Y28gIT0gdmNvKQorCQkJY25sX2NkY2xrX3BsbF9lbmFibGUoZGV2X3ByaXYsIHZj
byk7CiAKLQlpZiAoZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyAhPSB2Y28pCi0JCWJ4dF9kZV9wbGxf
ZW5hYmxlKGRldl9wcml2LCB2Y28pOworCX0gZWxzZSB7CisJCWlmIChkZXZfcHJpdi0+Y2RjbGsu
aHcudmNvICE9IDAgJiYKKwkJICAgIGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gdmNvKQorCQkJ
Ynh0X2RlX3BsbF9kaXNhYmxlKGRldl9wcml2KTsKKworCQlpZiAoZGV2X3ByaXYtPmNkY2xrLmh3
LnZjbyAhPSB2Y28pCisJCQlieHRfZGVfcGxsX2VuYWJsZShkZXZfcHJpdiwgdmNvKTsKKwl9CiAK
IAl2YWwgPSBkaXZpZGVyIHwgc2tsX2NkY2xrX2RlY2ltYWwoY2RjbGspOwotCWlmIChwaXBlID09
IElOVkFMSURfUElQRSkKLQkJdmFsIHw9IEJYVF9DRENMS19DRDJYX1BJUEVfTk9ORTsKLQllbHNl
Ci0JCXZhbCB8PSBCWFRfQ0RDTEtfQ0QyWF9QSVBFKHBpcGUpOworCisJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTIpIHsKKwkJaWYgKHBpcGUgPT0gSU5WQUxJRF9QSVBFKQorCQkJdmFsIHw9
IFRHTF9DRENMS19DRDJYX1BJUEVfTk9ORTsKKwkJZWxzZQorCQkJdmFsIHw9IFRHTF9DRENMS19D
RDJYX1BJUEUocGlwZSk7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7
CisJCWlmIChwaXBlID09IElOVkFMSURfUElQRSkKKwkJCXZhbCB8PSBJQ0xfQ0RDTEtfQ0QyWF9Q
SVBFX05PTkU7CisJCWVsc2UKKwkJCXZhbCB8PSBJQ0xfQ0RDTEtfQ0QyWF9QSVBFKHBpcGUpOwor
CX0gZWxzZSB7CisJCWlmIChwaXBlID09IElOVkFMSURfUElQRSkKKwkJCXZhbCB8PSBCWFRfQ0RD
TEtfQ0QyWF9QSVBFX05PTkU7CisJCWVsc2UKKwkJCXZhbCB8PSBCWFRfQ0RDTEtfQ0QyWF9QSVBF
KHBpcGUpOworCX0KKwogCS8qCiAJICogRGlzYWJsZSBTU0EgUHJlY2hhcmdlIHdoZW4gQ0QgY2xv
Y2sgZnJlcXVlbmN5IDwgNTAwIE1IeiwKIAkgKiBlbmFibGUgb3RoZXJ3aXNlLgogCSAqLwotCWlm
IChjZGNsayA+PSA1MDAwMDApCisJaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpICYmIGNkY2xrID49
IDUwMDAwMCkKIAkJdmFsIHw9IEJYVF9DRENMS19TU0FfUFJFQ0hBUkdFX0VOQUJMRTsKIAlJOTE1
X1dSSVRFKENEQ0xLX0NUTCwgdmFsKTsKIAogCWlmIChwaXBlICE9IElOVkFMSURfUElQRSkKIAkJ
aW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LCBwaXBlKTsKIAotCS8qCi0JICogVGhlIHRp
bWVvdXQgaXNuJ3Qgc3BlY2lmaWVkLCB0aGUgMm1zIHVzZWQgaGVyZSBpcyBiYXNlZCBvbgotCSAq
IGV4cGVyaW1lbnQuCi0JICogRklYTUU6IFdhaXRpbmcgZm9yIHRoZSByZXF1ZXN0IGNvbXBsZXRp
b24gY291bGQgYmUgZGVsYXllZCB1bnRpbAotCSAqIHRoZSBuZXh0IFBDT0RFIHJlcXVlc3QgYmFz
ZWQgb24gQlNwZWMuCi0JICovCi0JcmV0ID0gc2FuZHlicmlkZ2VfcGNvZGVfd3JpdGVfdGltZW91
dChkZXZfcHJpdiwKLQkJCQkJICAgICAgSFNXX1BDT0RFX0RFX1dSSVRFX0ZSRVFfUkVRLAotCQkJ
CQkgICAgICBjZGNsa19zdGF0ZS0+dm9sdGFnZV9sZXZlbCwgMTUwLCAyKTsKKwlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCkgeworCQlyZXQgPSBzYW5keWJyaWRnZV9wY29kZV93cml0ZShk
ZXZfcHJpdiwgU0tMX1BDT0RFX0NEQ0xLX0NPTlRST0wsCisJCQkJCSAgICAgIGNkY2xrX3N0YXRl
LT52b2x0YWdlX2xldmVsKTsKKwl9IGVsc2UgeworCQkvKgorCQkgKiBUaGUgdGltZW91dCBpc24n
dCBzcGVjaWZpZWQsIHRoZSAybXMgdXNlZCBoZXJlIGlzIGJhc2VkIG9uCisJCSAqIGV4cGVyaW1l
bnQuCisJCSAqIEZJWE1FOiBXYWl0aW5nIGZvciB0aGUgcmVxdWVzdCBjb21wbGV0aW9uIGNvdWxk
IGJlIGRlbGF5ZWQKKwkJICogdW50aWwgdGhlIG5leHQgUENPREUgcmVxdWVzdCBiYXNlZCBvbiBC
U3BlYy4KKwkJICovCisJCXJldCA9IHNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlX3RpbWVvdXQoZGV2
X3ByaXYsCisJCQkJCQkgICAgICBIU1dfUENPREVfREVfV1JJVEVfRlJFUV9SRVEsCisJCQkJCQkg
ICAgICBjZGNsa19zdGF0ZS0+dm9sdGFnZV9sZXZlbCwKKwkJCQkJCSAgICAgIDE1MCwgMik7CisJ
fQorCiAJaWYgKHJldCkgewogCQlEUk1fRVJST1IoIlBDb2RlIENEQ0xLIGZyZXEgc2V0IGZhaWxl
ZCwgKGVyciAlZCwgZnJlcSAlZClcbiIsCiAJCQkgIHJldCwgY2RjbGspOwpAQCAtMTUzMiw2ICsx
NjA1LDEzIEBAIHN0YXRpYyB2b2lkIGJ4dF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCX0KIAogCWludGVsX3VwZGF0ZV9jZGNsayhkZXZfcHJpdik7CisKKwlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKKwkJLyoKKwkJICogQ2FuJ3QgcmVhZCBvdXQg
dGhlIHZvbHRhZ2UgbGV2ZWwgOigKKwkJICogTGV0J3MganVzdCBhc3N1bWUgZXZlcnl0aGluZyBp
cyBhcyBleHBlY3RlZC4KKwkJICovCisJCWRldl9wcml2LT5jZGNsay5ody52b2x0YWdlX2xldmVs
ID0gY2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWw7CiB9CiAKIHN0YXRpYyB2b2lkIGJ4dF9zYW5p
dGl6ZV9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xNjE3LDEx
NSArMTY5Nyw2IEBAIHN0YXRpYyB2b2lkIGJ4dF91bmluaXRfY2RjbGsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCWJ4dF9zZXRfY2RjbGsoZGV2X3ByaXYsICZjZGNsa19zdGF0
ZSwgSU5WQUxJRF9QSVBFKTsKIH0KIAotc3RhdGljIHZvaWQgY25sX2NkY2xrX3BsbF9kaXNhYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKLXsKLQl1MzIgdmFsOwotCi0JdmFs
ID0gSTkxNV9SRUFEKEJYVF9ERV9QTExfRU5BQkxFKTsKLQl2YWwgJj0gfkJYVF9ERV9QTExfUExM
X0VOQUJMRTsKLQlJOTE1X1dSSVRFKEJYVF9ERV9QTExfRU5BQkxFLCB2YWwpOwotCi0JLyogVGlt
ZW91dCAyMDB1cyAqLwotCWlmICh3YWl0X2ZvcigoSTkxNV9SRUFEKEJYVF9ERV9QTExfRU5BQkxF
KSAmIEJYVF9ERV9QTExfTE9DSykgPT0gMCwgMSkpCi0JCURSTV9FUlJPUigidGltZW91dCB3YWl0
aW5nIGZvciBDRENMSyBQTEwgdW5sb2NrXG4iKTsKLQotCWRldl9wcml2LT5jZGNsay5ody52Y28g
PSAwOwotfQotCi1zdGF0aWMgdm9pZCBjbmxfY2RjbGtfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCB2Y28pCi17Ci0JaW50IHJhdGlvID0gRElWX1JPVU5E
X0NMT1NFU1QodmNvLCBkZXZfcHJpdi0+Y2RjbGsuaHcucmVmKTsKLQl1MzIgdmFsOwotCi0JdmFs
ID0gQ05MX0NEQ0xLX1BMTF9SQVRJTyhyYXRpbyk7Ci0JSTkxNV9XUklURShCWFRfREVfUExMX0VO
QUJMRSwgdmFsKTsKLQotCXZhbCB8PSBCWFRfREVfUExMX1BMTF9FTkFCTEU7Ci0JSTkxNV9XUklU
RShCWFRfREVfUExMX0VOQUJMRSwgdmFsKTsKLQotCS8qIFRpbWVvdXQgMjAwdXMgKi8KLQlpZiAo
d2FpdF9mb3IoKEk5MTVfUkVBRChCWFRfREVfUExMX0VOQUJMRSkgJiBCWFRfREVfUExMX0xPQ0sp
ICE9IDAsIDEpKQotCQlEUk1fRVJST1IoInRpbWVvdXQgd2FpdGluZyBmb3IgQ0RDTEsgUExMIGxv
Y2tcbiIpOwotCi0JZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyA9IHZjbzsKLX0KLQotc3RhdGljIHZv
aWQgY25sX3NldF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUsCi0JCQkgIGVudW0g
cGlwZSBwaXBlKQotewotCWludCBjZGNsayA9IGNkY2xrX3N0YXRlLT5jZGNsazsKLQlpbnQgdmNv
ID0gY2RjbGtfc3RhdGUtPnZjbzsKLQl1MzIgdmFsLCBkaXZpZGVyOwotCWludCByZXQ7Ci0KLQly
ZXQgPSBza2xfcGNvZGVfcmVxdWVzdChkZXZfcHJpdiwgU0tMX1BDT0RFX0NEQ0xLX0NPTlRST0ws
Ci0JCQkJU0tMX0NEQ0xLX1BSRVBBUkVfRk9SX0NIQU5HRSwKLQkJCQlTS0xfQ0RDTEtfUkVBRFlf
Rk9SX0NIQU5HRSwKLQkJCQlTS0xfQ0RDTEtfUkVBRFlfRk9SX0NIQU5HRSwgMyk7Ci0JaWYgKHJl
dCkgewotCQlEUk1fRVJST1IoIkZhaWxlZCB0byBpbmZvcm0gUENVIGFib3V0IGNkY2xrIGNoYW5n
ZSAoJWQpXG4iLAotCQkJICByZXQpOwotCQlyZXR1cm47Ci0JfQotCi0JLyogY2RjbGsgPSB2Y28g
LyAyIC8gZGl2ezEsMn0gKi8KLQlzd2l0Y2ggKERJVl9ST1VORF9DTE9TRVNUKHZjbywgY2RjbGsp
KSB7Ci0JZGVmYXVsdDoKLQkJV0FSTl9PTihjZGNsayAhPSBkZXZfcHJpdi0+Y2RjbGsuaHcuYnlw
YXNzKTsKLQkJV0FSTl9PTih2Y28gIT0gMCk7Ci0JCS8qIGZhbGwgdGhyb3VnaCAqLwotCWNhc2Ug
MjoKLQkJZGl2aWRlciA9IEJYVF9DRENMS19DRDJYX0RJVl9TRUxfMTsKLQkJYnJlYWs7Ci0JY2Fz
ZSA0OgotCQlkaXZpZGVyID0gQlhUX0NEQ0xLX0NEMlhfRElWX1NFTF8yOwotCQlicmVhazsKLQl9
Ci0KLQlpZiAoZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyAhPSAwICYmCi0JICAgIGRldl9wcml2LT5j
ZGNsay5ody52Y28gIT0gdmNvKQotCQljbmxfY2RjbGtfcGxsX2Rpc2FibGUoZGV2X3ByaXYpOwot
Ci0JaWYgKGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gdmNvKQotCQljbmxfY2RjbGtfcGxsX2Vu
YWJsZShkZXZfcHJpdiwgdmNvKTsKLQotCXZhbCA9IGRpdmlkZXIgfCBza2xfY2RjbGtfZGVjaW1h
bChjZGNsayk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewotCQlpZiAocGlw
ZSA9PSBJTlZBTElEX1BJUEUpCi0JCQl2YWwgfD0gVEdMX0NEQ0xLX0NEMlhfUElQRV9OT05FOwot
CQllbHNlCi0JCQl2YWwgfD0gVEdMX0NEQ0xLX0NEMlhfUElQRShwaXBlKTsKLQl9IGVsc2UgaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKLQkJaWYgKHBpcGUgPT0gSU5WQUxJRF9QSVBF
KQotCQkJdmFsIHw9IElDTF9DRENMS19DRDJYX1BJUEVfTk9ORTsKLQkJZWxzZQotCQkJdmFsIHw9
IElDTF9DRENMS19DRDJYX1BJUEUocGlwZSk7Ci0JfSBlbHNlIHsKLQkJaWYgKHBpcGUgPT0gSU5W
QUxJRF9QSVBFKQotCQkJdmFsIHw9IEJYVF9DRENMS19DRDJYX1BJUEVfTk9ORTsKLQkJZWxzZQot
CQkJdmFsIHw9IEJYVF9DRENMS19DRDJYX1BJUEUocGlwZSk7Ci0JfQotCUk5MTVfV1JJVEUoQ0RD
TEtfQ1RMLCB2YWwpOwotCi0JaWYgKHBpcGUgIT0gSU5WQUxJRF9QSVBFKQotCQlpbnRlbF93YWl0
X2Zvcl92YmxhbmsoZGV2X3ByaXYsIHBpcGUpOwotCi0JLyogaW5mb3JtIFBDVSBvZiB0aGUgY2hh
bmdlICovCi0Jc2FuZHlicmlkZ2VfcGNvZGVfd3JpdGUoZGV2X3ByaXYsIFNLTF9QQ09ERV9DRENM
S19DT05UUk9MLAotCQkJCWNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsKTsKLQotCWludGVsX3Vw
ZGF0ZV9jZGNsayhkZXZfcHJpdik7Ci0KLQkvKgotCSAqIENhbid0IHJlYWQgb3V0IHRoZSB2b2x0
YWdlIGxldmVsIDooCi0JICogTGV0J3MganVzdCBhc3N1bWUgZXZlcnl0aGluZyBpcyBhcyBleHBl
Y3RlZC4KLQkgKi8KLQlkZXZfcHJpdi0+Y2RjbGsuaHcudm9sdGFnZV9sZXZlbCA9IGNkY2xrX3N0
YXRlLT52b2x0YWdlX2xldmVsOwotfQotCiBzdGF0aWMgdm9pZCBjbmxfc2FuaXRpemVfY2RjbGso
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCXUzMiBjZGN0bCwgZXhwZWN0
ZWQ7CkBAIC0xODA2LDcgKzE3NzcsNyBAQCBzdGF0aWMgdm9pZCBpY2xfaW5pdF9jZGNsayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCXNhbml0aXplZF9zdGF0ZS52b2x0YWdl
X2xldmVsID0KIAkJCWljbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoc2FuaXRpemVkX3N0YXRlLmNkY2xr
KTsKIAotCWNubF9zZXRfY2RjbGsoZGV2X3ByaXYsICZzYW5pdGl6ZWRfc3RhdGUsIElOVkFMSURf
UElQRSk7CisJYnh0X3NldF9jZGNsayhkZXZfcHJpdiwgJnNhbml0aXplZF9zdGF0ZSwgSU5WQUxJ
RF9QSVBFKTsKIH0KIAogc3RhdGljIHZvaWQgaWNsX3VuaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xODIyLDcgKzE3OTMsNyBAQCBzdGF0aWMgdm9pZCBp
Y2xfdW5pbml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJY2Rj
bGtfc3RhdGUudm9sdGFnZV9sZXZlbCA9CiAJCQlpY2xfY2FsY192b2x0YWdlX2xldmVsKGNkY2xr
X3N0YXRlLmNkY2xrKTsKIAotCWNubF9zZXRfY2RjbGsoZGV2X3ByaXYsICZjZGNsa19zdGF0ZSwg
SU5WQUxJRF9QSVBFKTsKKwlieHRfc2V0X2NkY2xrKGRldl9wcml2LCAmY2RjbGtfc3RhdGUsIElO
VkFMSURfUElQRSk7CiB9CiAKIHN0YXRpYyB2b2lkIGNubF9pbml0X2NkY2xrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKQEAgLTE4NDEsNyArMTgxMiw3IEBAIHN0YXRpYyB2b2lk
IGNubF9pbml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAljZGNs
a19zdGF0ZS52Y28gPSBjYWxjX2NkY2xrX3BsbF92Y28oZGV2X3ByaXYsIGNkY2xrX3N0YXRlLmNk
Y2xrKTsKIAljZGNsa19zdGF0ZS52b2x0YWdlX2xldmVsID0gY25sX2NhbGNfdm9sdGFnZV9sZXZl
bChjZGNsa19zdGF0ZS5jZGNsayk7CiAKLQljbmxfc2V0X2NkY2xrKGRldl9wcml2LCAmY2RjbGtf
c3RhdGUsIElOVkFMSURfUElQRSk7CisJYnh0X3NldF9jZGNsayhkZXZfcHJpdiwgJmNkY2xrX3N0
YXRlLCBJTlZBTElEX1BJUEUpOwogfQogCiBzdGF0aWMgdm9pZCBjbmxfdW5pbml0X2NkY2xrKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKQEAgLTE4NTIsNyArMTgyMyw3IEBAIHN0
YXRpYyB2b2lkIGNubF91bmluaXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCWNkY2xrX3N0YXRlLnZjbyA9IDA7CiAJY2RjbGtfc3RhdGUudm9sdGFnZV9sZXZlbCA9
IGNubF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoY2RjbGtfc3RhdGUuY2RjbGspOwogCi0JY25sX3NldF9j
ZGNsayhkZXZfcHJpdiwgJmNkY2xrX3N0YXRlLCBJTlZBTElEX1BJUEUpOworCWJ4dF9zZXRfY2Rj
bGsoZGV2X3ByaXYsICZjZGNsa19zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKIH0KIAogLyoqCkBAIC0y
NjU1LDEyICsyNjI2LDEyIEBAIHZvaWQgaW50ZWxfdXBkYXRlX3Jhd2NsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB2b2lkIGludGVsX2luaXRfY2RjbGtfaG9va3Moc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDExKSB7Ci0JCWRldl9wcml2LT5kaXNwbGF5LnNldF9jZGNsayA9IGNubF9zZXRfY2RjbGs7
CisJCWRldl9wcml2LT5kaXNwbGF5LnNldF9jZGNsayA9IGJ4dF9zZXRfY2RjbGs7CiAJCWRldl9w
cml2LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsayA9IGljbF9tb2Rlc2V0X2NhbGNfY2RjbGs7
CiAJCWRldl9wcml2LT5jZGNsay50YWJsZSA9IGljbF9jZGNsa190YWJsZTsKIAkJZGV2X3ByaXYt
PmNkY2xrLnRhYmxlX3NpemUgPSBBUlJBWV9TSVpFKGljbF9jZGNsa190YWJsZSk7CiAJfSBlbHNl
IGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSkgewotCQlkZXZfcHJpdi0+ZGlzcGxheS5zZXRf
Y2RjbGsgPSBjbmxfc2V0X2NkY2xrOworCQlkZXZfcHJpdi0+ZGlzcGxheS5zZXRfY2RjbGsgPSBi
eHRfc2V0X2NkY2xrOwogCQlkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGsgPSBj
bmxfbW9kZXNldF9jYWxjX2NkY2xrOwogCQlkZXZfcHJpdi0+Y2RjbGsudGFibGUgPSBjbmxfY2Rj
bGtfdGFibGU7CiAJCWRldl9wcml2LT5jZGNsay50YWJsZV9zaXplID0gQVJSQVlfU0laRShjbmxf
Y2RjbGtfdGFibGUpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9pbnRlbC1nZng=

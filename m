Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C4048EAEE0
	for <lists+intel-gfx@lfdr.de>; Thu, 31 Oct 2019 12:26:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 97B7E6EE3D;
	Thu, 31 Oct 2019 11:26:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 070446EE38
 for <intel-gfx@lists.freedesktop.org>; Thu, 31 Oct 2019 11:26:17 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 31 Oct 2019 12:26:08 +0100
Message-Id: <20191031112610.27608-10-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
References: <20191031112610.27608-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 10/12] drm/i915: Perform automated conversions
 for plane uapi/hw split, base -> uapi.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgcGxhbmVfc3RhdGUtPmJhc2UgdG8gdWFwaS4gVGhpcyBpcyBkb25lIHVzaW5nIHRo
ZSBmb2xsb3dpbmcgcGF0Y2gsCnJhbiBhZnRlciB0aGUgcHJldmlvdXMgY29tbWl0IHRoYXQgc3Bs
aXRzIG91dCBhbnkgaHcgcmVmZXJlbmNlczoKCkBACnN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
VDsKaWRlbnRpZmllciB4OwpAQAotVC0+YmFzZS54CitULT51YXBpLngKCkBACnN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqVDsKQEAKLVQtPmJhc2UKK1QtPnVhcGkKClNpZ25lZC1vZmYtYnk6IE1h
YXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+ClJldmll
d2VkLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMgICB8ICAgMiAr
LQogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jIHwgIDMwICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAyNjIgKysr
KysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5j
ICAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zlcmxh
eS5jICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUu
YyAgIHwgMTM2ICsrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyAgICAg
ICAgICAgICAgIHwgIDU3ICsrLS0KIDcgZmlsZXMgY2hhbmdlZCwgMjUxIGluc2VydGlvbnMoKyks
IDI1MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9h
dG9taWMuYwppbmRleCAwYTVlZWU0YzM1MGYuLmVhMjRhNDVkYWI4NiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0yODYsNyArMjg2LDcgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zY2Fs
ZXJfc3RhdGUgKnNjYWxlcl9zdGEKIAlpZiAocGxhbmVfc3RhdGUgJiYgcGxhbmVfc3RhdGUtPmh3
LmZiICYmCiAJICAgIHBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5pc195dXYgJiYKIAkgICAg
cGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPm51bV9wbGFuZXMgPiAxKSB7Ci0JCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CisJCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9z
dGF0ZS0+dWFwaS5wbGFuZSk7CiAJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCiAJCSAgICAh
SVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKIAkJCW1vZGUgPSBTS0xfUFNfU0NBTEVSX01PREVf
TlYxMjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRv
bWljX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19w
bGFuZS5jCmluZGV4IDYzMzUzNTU1NTViMy4uZDQ1NmIzZGMyMDBjIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMKQEAgLTU2LDcgKzU2
LDcgQEAgc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFuZV9hbGxvYyh2b2lkKQogCQlyZXR1
cm4gRVJSX1BUUigtRU5PTUVNKTsKIAl9CiAKLQlfX2RybV9hdG9taWNfaGVscGVyX3BsYW5lX3Jl
c2V0KCZwbGFuZS0+YmFzZSwgJnBsYW5lX3N0YXRlLT5iYXNlKTsKKwlfX2RybV9hdG9taWNfaGVs
cGVyX3BsYW5lX3Jlc2V0KCZwbGFuZS0+YmFzZSwgJnBsYW5lX3N0YXRlLT51YXBpKTsKIAlwbGFu
ZV9zdGF0ZS0+c2NhbGVyX2lkID0gLTE7CiAKIAlyZXR1cm4gcGxhbmU7CkBAIC04OCwxMiArODgs
MTIgQEAgaW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5l
KQogCWlmICghaW50ZWxfc3RhdGUpCiAJCXJldHVybiBOVUxMOwogCi0JX19kcm1fYXRvbWljX2hl
bHBlcl9wbGFuZV9kdXBsaWNhdGVfc3RhdGUocGxhbmUsICZpbnRlbF9zdGF0ZS0+YmFzZSk7CisJ
X19kcm1fYXRvbWljX2hlbHBlcl9wbGFuZV9kdXBsaWNhdGVfc3RhdGUocGxhbmUsICZpbnRlbF9z
dGF0ZS0+dWFwaSk7CiAKIAlpbnRlbF9zdGF0ZS0+dm1hID0gTlVMTDsKIAlpbnRlbF9zdGF0ZS0+
ZmxhZ3MgPSAwOwogCi0JcmV0dXJuICZpbnRlbF9zdGF0ZS0+YmFzZTsKKwlyZXR1cm4gJmludGVs
X3N0YXRlLT51YXBpOwogfQogCiAvKioKQEAgLTExMSw3ICsxMTEsNyBAQCBpbnRlbF9wbGFuZV9k
ZXN0cm95X3N0YXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCXN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPSB0b19pbnRlbF9wbGFuZV9zdGF0ZShzdGF0ZSk7CiAJV0FS
Tl9PTihwbGFuZV9zdGF0ZS0+dm1hKTsKIAotCV9fZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfZGVz
dHJveV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UpOworCV9fZHJtX2F0b21pY19oZWxwZXJfcGxh
bmVfZGVzdHJveV9zdGF0ZSgmcGxhbmVfc3RhdGUtPnVhcGkpOwogCWtmcmVlKHBsYW5lX3N0YXRl
KTsKIH0KIApAQCAtMTIxLDcgKzEyMSw3IEBAIHVuc2lnbmVkIGludCBpbnRlbF9wbGFuZV9kYXRh
X3JhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdW5zaWdu
ZWQgaW50IGNwcDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAoIXBs
YW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJY3BwID0gZmItPmZvcm1h
dC0+Y3BwWzBdOwpAQCAtMTQ3LDcgKzE0Nyw3IEBAIGJvb2wgaW50ZWxfcGxhbmVfY2FsY19taW5f
Y2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBsYW5lX3N0YXRlLT5ody5jcnRjKTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2Uu
dmlzaWJsZSB8fCAhcGxhbmUtPm1pbl9jZGNsaykKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZp
c2libGUgfHwgIXBsYW5lLT5taW5fY2RjbGspCiAJCXJldHVybiBmYWxzZTsKIAogCWNydGNfc3Rh
dGUgPSBpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKQEAgLTE4
MSw3ICsxODEsNyBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjXwogCQkJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSwKIAkJCQkJc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpuZXdfcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKG5ld19wbGFuZV9zdGF0ZS0+dWFw
aS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxhbmVf
c3RhdGUtPmh3LmZiOwogCWludCByZXQ7CiAKQEAgLTE5MCw3ICsxOTAsNyBAQCBpbnQgaW50ZWxf
cGxhbmVfYXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm9sZF9jcnRjXwogCW5ld19jcnRjX3N0YXRlLT5jOF9wbGFuZXMgJj0gfkJJVChwbGFuZS0+
aWQpOwogCW5ld19jcnRjX3N0YXRlLT5kYXRhX3JhdGVbcGxhbmUtPmlkXSA9IDA7CiAJbmV3X2Ny
dGNfc3RhdGUtPm1pbl9jZGNsa1twbGFuZS0+aWRdID0gMDsKLQluZXdfcGxhbmVfc3RhdGUtPmJh
c2UudmlzaWJsZSA9IGZhbHNlOworCW5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlID0gZmFs
c2U7CiAKIAlpZiAoIW5ld19wbGFuZV9zdGF0ZS0+aHcuY3J0YyAmJiAhb2xkX3BsYW5lX3N0YXRl
LT5ody5jcnRjKQogCQlyZXR1cm4gMDsKQEAgLTIwMCwxOCArMjAwLDE4IEBAIGludCBpbnRlbF9w
bGFuZV9hdG9taWNfY2hlY2tfd2l0aF9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqb2xkX2NydGNfCiAJCXJldHVybiByZXQ7CiAKIAkvKiBGSVhNRSBwcmUtZzR4IGRvbid0IHdv
cmsgbGlrZSB0aGlzICovCi0JaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlm
IChuZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJbmV3X2NydGNfc3RhdGUtPmFjdGl2
ZV9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKLQlpZiAobmV3X3BsYW5lX3N0YXRlLT5iYXNl
LnZpc2libGUgJiYKKwlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUgJiYKIAkgICAg
ZHJtX2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQpKQogCQluZXdfY3J0
Y19zdGF0ZS0+bnYxMl9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKLQlpZiAobmV3X3BsYW5l
X3N0YXRlLT5iYXNlLnZpc2libGUgJiYKKwlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2li
bGUgJiYKIAkgICAgZmItPmZvcm1hdC0+Zm9ybWF0ID09IERSTV9GT1JNQVRfQzgpCiAJCW5ld19j
cnRjX3N0YXRlLT5jOF9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKLQlpZiAobmV3X3BsYW5l
X3N0YXRlLT5iYXNlLnZpc2libGUgfHwgb2xkX3BsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJ
aWYgKG5ld19wbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlIHx8IG9sZF9wbGFuZV9zdGF0ZS0+dWFw
aS52aXNpYmxlKQogCQluZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BsYW5lcyB8PSBCSVQocGxhbmUt
PmlkKTsKIAogCW5ld19jcnRjX3N0YXRlLT5kYXRhX3JhdGVbcGxhbmUtPmlkXSA9CkBAIC0yNDYs
NyArMjQ2LDcgQEAgaW50IGludGVsX3BsYW5lX2F0b21pY19jaGVjayhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfc3RhdGU7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOwogCi0J
bmV3X3BsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUgPSBmYWxzZTsKKwluZXdfcGxhbmVfc3RhdGUt
PnVhcGkudmlzaWJsZSA9IGZhbHNlOwogCWlmICghY3J0YykKIAkJcmV0dXJuIDA7CiAKQEAgLTM1
NSw3ICszNTUsNyBAQCB2b2lkIHNrbF91cGRhdGVfcGxhbmVzX29uX2NydGMoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3Bs
YW5lX3N0YXRlID0KIAkJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBw
bGFuZSk7CiAKLQkJaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKSB7CisJCWlmIChu
ZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkgewogCQkJaW50ZWxfdXBkYXRlX3BsYW5lKHBs
YW5lLCBuZXdfY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKTsKIAkJfSBlbHNlIGlmIChuZXdf
cGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSkgewogCQkJc3RydWN0IGludGVsX3BsYW5lICptYXN0
ZXIgPQpAQCAtMzk1LDcgKzM5NSw3IEBAIHZvaWQgaTl4eF91cGRhdGVfcGxhbmVzX29uX2NydGMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCSAgICAhKHVwZGF0ZV9tYXNrICYg
QklUKHBsYW5lLT5pZCkpKQogCQkJY29udGludWU7CiAKLQkJaWYgKG5ld19wbGFuZV9zdGF0ZS0+
YmFzZS52aXNpYmxlKQorCQlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCQlp
bnRlbF91cGRhdGVfcGxhbmUocGxhbmUsIG5ld19jcnRjX3N0YXRlLCBuZXdfcGxhbmVfc3RhdGUp
OwogCQllbHNlCiAJCQlpbnRlbF9kaXNhYmxlX3BsYW5lKHBsYW5lLCBuZXdfY3J0Y19zdGF0ZSk7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDlj
NjYwMTA4ZDk3Mi4uODI2ZDFjOTk1NDk2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMjA4Miw3ICsyMDgyLDcgQEAgc3RhdGljIHVuc2lnbmVk
IGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiwKIAogc3RhdGljIGJvb2wgaW50ZWxfcGxhbmVfdXNlc19mZW5jZShjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5l
KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5i
YXNlLmRldik7CiAKIAlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA8IDQgfHwKQEAgLTIzOTEs
NyArMjM5MSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNl
dChpbnQgKngsIGludCAqeSwKIAkJCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpzdGF0ZSwKIAkJCQkJICAgICAgaW50IGNvbG9yX3BsYW5lKQogewotCXN0cnVjdCBpbnRl
bF9wbGFuZSAqaW50ZWxfcGxhbmUgPSB0b19pbnRlbF9wbGFuZShzdGF0ZS0+YmFzZS5wbGFuZSk7
CisJc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFuZSA9IHRvX2ludGVsX3BsYW5lKHN0YXRl
LT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGludGVsX3BsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBzdGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gc3RhdGUtPmh3
LnJvdGF0aW9uOwpAQCAtMjU3OSw3ICsyNTc5LDcgQEAgaW50ZWxfZmJfc3RyaWRlX2FsaWdubWVu
dChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogCiBi
b29sIGludGVsX3BsYW5lX2Nhbl9yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9w
bGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50
IGk7CkBAIC0yNjE5LDcgKzI2MTksNyBAQCBib29sIGludGVsX3BsYW5lX2Nhbl9yZW1hcChjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiBzdGF0aWMgYm9vbCBp
bnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9
IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQg
cm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJdTMyIHN0cmlkZSwgbWF4X3N0
cmlkZTsKQEAgLTI2MjgsNyArMjYyOCw3IEBAIHN0YXRpYyBib29sIGludGVsX3BsYW5lX25lZWRz
X3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICog
Tm8gcmVtYXBwaW5nIGZvciBpbnZpc2libGUgcGxhbmVzIHNpbmNlIHdlIGRvbid0IGhhdmUKIAkg
KiBhbiBhY3R1YWwgc291cmNlIHZpZXdwb3J0IHRvIHJlbWFwLgogCSAqLwotCWlmICghcGxhbmVf
c3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJ
CXJldHVybiBmYWxzZTsKIAogCWlmICghaW50ZWxfcGxhbmVfY2FuX3JlbWFwKHBsYW5lX3N0YXRl
KSkKQEAgLTI4MTEsNyArMjgxMSw3IEBAIHN0YXRpYyB2b2lkCiBpbnRlbF9wbGFuZV9yZW1hcF9n
dHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBs
YW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwogCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXN0cnVjdCBp
bnRlbF9mcmFtZWJ1ZmZlciAqaW50ZWxfZmIgPSB0b19pbnRlbF9mcmFtZWJ1ZmZlcihmYik7CiAJ
c3RydWN0IGludGVsX3JvdGF0aW9uX2luZm8gKmluZm8gPSAmcGxhbmVfc3RhdGUtPnZpZXcucm90
YXRlZDsKQEAgLTI4MjYsMjAgKzI4MjYsMjAgQEAgaW50ZWxfcGxhbmVfcmVtYXBfZ3R0KHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJcGxhbmVfc3RhdGUtPnZpZXcudHlw
ZSA9IGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pID8KIAkJSTkxNV9HR1RUX1ZJRVdf
Uk9UQVRFRCA6IEk5MTVfR0dUVF9WSUVXX1JFTUFQUEVEOwogCi0Jc3JjX3ggPSBwbGFuZV9zdGF0
ZS0+YmFzZS5zcmMueDEgPj4gMTY7Ci0Jc3JjX3kgPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueTEg
Pj4gMTY7Ci0Jc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+
PiAxNjsKLQlzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+
PiAxNjsKKwlzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKKwlzcmNfeSA9
IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKKwlzcmNfdyA9IGRybV9yZWN0X3dpZHRo
KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCXNyY19oID0gZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCiAJV0FSTl9PTihpc19jY3NfbW9kaWZp
ZXIoZmItPm1vZGlmaWVyKSk7CiAKIAkvKiBNYWtlIHNyYyBjb29yZGluYXRlcyByZWxhdGl2ZSB0
byB0aGUgdmlld3BvcnQgKi8KLQlkcm1fcmVjdF90cmFuc2xhdGUoJnBsYW5lX3N0YXRlLT5iYXNl
LnNyYywKKwlkcm1fcmVjdF90cmFuc2xhdGUoJnBsYW5lX3N0YXRlLT51YXBpLnNyYywKIAkJCSAg
IC0oc3JjX3ggPDwgMTYpLCAtKHNyY195IDw8IDE2KSk7CiAKIAkvKiBSb3RhdGUgc3JjIGNvb3Jk
aW5hdGVzIHRvIG1hdGNoIHJvdGF0ZWQgR1RUIHZpZXcgKi8KIAlpZiAoZHJtX3JvdGF0aW9uXzkw
X29yXzI3MChyb3RhdGlvbikpCi0JCWRybV9yZWN0X3JvdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2Uu
c3JjLAorCQlkcm1fcmVjdF9yb3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpLnNyYywKIAkJCQlzcmNf
dyA8PCAxNiwgc3JjX2ggPDwgMTYsCiAJCQkJRFJNX01PREVfUk9UQVRFXzI3MCk7CiAKQEAgLTI5
NTksNyArMjk1OSw3IEBAIGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIAkvKiBSb3RhdGUgc3JjIGNvb3JkaW5hdGVzIHRvIG1h
dGNoIHJvdGF0ZWQgR1RUIHZpZXcgKi8KIAlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3Rh
dGlvbikpCi0JCWRybV9yZWN0X3JvdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLAorCQlkcm1f
cmVjdF9yb3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpLnNyYywKIAkJCQlmYi0+YmFzZS53aWR0aCA8
PCAxNiwgZmItPmJhc2UuaGVpZ2h0IDw8IDE2LAogCQkJCURSTV9NT0RFX1JPVEFURV8yNzApOwog
CkBAIC0zMTI3LDkgKzMxMjcsOSBAQCBpbnRlbF9zZXRfcGxhbmVfdmlzaWJsZShzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUsCiAJCQlib29sIHZpc2libGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxh
bmUpOwogCi0JcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IHZpc2libGU7CisJcGxhbmVfc3Rh
dGUtPnVhcGkudmlzaWJsZSA9IHZpc2libGU7CiAKIAlpZiAodmlzaWJsZSkKIAkJY3J0Y19zdGF0
ZS0+dWFwaS5wbGFuZV9tYXNrIHw9IGRybV9wbGFuZV9tYXNrKCZwbGFuZS0+YmFzZSk7CkBAIC0z
Mjc1LDggKzMyNzUsOCBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjLAogCXBsYW5lX3N0YXRlLT5jcnRjX3cgPSBmYi0+d2lkdGg7CiAJ
cGxhbmVfc3RhdGUtPmNydGNfaCA9IGZiLT5oZWlnaHQ7CiAKLQlpbnRlbF9zdGF0ZS0+YmFzZS5z
cmMgPSBkcm1fcGxhbmVfc3RhdGVfc3JjKHBsYW5lX3N0YXRlKTsKLQlpbnRlbF9zdGF0ZS0+YmFz
ZS5kc3QgPSBkcm1fcGxhbmVfc3RhdGVfZGVzdChwbGFuZV9zdGF0ZSk7CisJaW50ZWxfc3RhdGUt
PnVhcGkuc3JjID0gZHJtX3BsYW5lX3N0YXRlX3NyYyhwbGFuZV9zdGF0ZSk7CisJaW50ZWxfc3Rh
dGUtPnVhcGkuZHN0ID0gZHJtX3BsYW5lX3N0YXRlX2Rlc3QocGxhbmVfc3RhdGUpOwogCiAJaWYg
KHBsYW5lX2NvbmZpZy0+dGlsaW5nKQogCQlkZXZfcHJpdi0+cHJlc2VydmVfYmlvc19zd2l6emxl
ID0gdHJ1ZTsKQEAgLTM0MTEsMTMgKzM0MTEsMTMgQEAgc3RhdGljIGJvb2wgc2tsX2NoZWNrX21h
aW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUK
IAogc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5k
ZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3
LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsK
LQlpbnQgeCA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKLQlpbnQgeSA9IHBsYW5l
X3N0YXRlLT5iYXNlLnNyYy55MSA+PiAxNjsKLQlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFu
ZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OworCWludCB4ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3Jj
LngxID4+IDE2OworCWludCB5ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OworCWlu
dCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJaW50
IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAJaW50
IG1heF93aWR0aDsKIAlpbnQgbWF4X2hlaWdodDsKIAl1MzIgYWxpZ25tZW50LCBvZmZzZXQsIGF1
eF9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ub2Zmc2V0OwpAQCAtMzUwMCw3
ICszNTAwLDcgQEAgc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRl
cyBiYWNrIHNvIHRoYXQgdGhlIHNyYwogCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRo
ZSByaWdodCB2YWx1ZXMuCiAJICovCi0JZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0
ZS0+YmFzZS5zcmMsCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMsCiAJCQkgICAgICB4IDw8IDE2LCB5IDw8IDE2KTsKIAogCXJldHVybiAwOwpAQCAtMzUxMiwx
MCArMzUxMiwxMCBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJdW5zaWduZWQgaW50IHJvdGF0aW9u
ID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBtYXhfd2lkdGggPSBza2xfbWF4X3Bs
YW5lX3dpZHRoKGZiLCAxLCByb3RhdGlvbik7CiAJaW50IG1heF9oZWlnaHQgPSA0MDk2OwotCWlu
dCB4ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLngxID4+IDE3OwotCWludCB5ID0gcGxhbmVfc3Rh
dGUtPmJhc2Uuc3JjLnkxID4+IDE3OwotCWludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0
YXRlLT5iYXNlLnNyYykgPj4gMTc7Ci0JaW50IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT5iYXNlLnNyYykgPj4gMTc7CisJaW50IHggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEg
Pj4gMTc7CisJaW50IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTc7CisJaW50IHcg
PSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNzsKKwlpbnQgaCA9
IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNzsKIAl1MzIgb2Zm
c2V0OwogCiAJaW50ZWxfYWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMSk7CkBA
IC0zNTM4LDggKzM1MzgsOCBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNl
KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0aWMgaW50IHNrbF9j
aGVja19jY3NfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKLQlpbnQgc3JjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueDEgPj4gMTY7Ci0JaW50
IHNyY195ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLnkxID4+IDE2OworCWludCBzcmNfeCA9IHBs
YW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKKwlpbnQgc3JjX3kgPSBwbGFuZV9zdGF0ZS0+
dWFwaS5zcmMueTEgPj4gMTY7CiAJaW50IGhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOwogCWludCB2
c3ViID0gZmItPmZvcm1hdC0+dnN1YjsKIAlpbnQgeCA9IHNyY194IC8gaHN1YjsKQEAgLTM1NjUs
NyArMzU2NSw3IEBAIGludCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlpZiAo
IXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9zdGF0ZS0+dWFwaS52aXNp
YmxlKQogCQlyZXR1cm4gMDsKIAogCS8qCkBAIC0zNjg5LDcgKzM2ODksNyBAQCBzdGF0aWMgdTMy
IGk5eHhfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUtPmRldik7CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUt
PmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9u
OwogCXUzMiBkc3BjbnRyOwpAQCAtMzc0Niw3ICszNzQ2LDcgQEAgc3RhdGljIHUzMiBpOXh4X3Bs
YW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIGludCBp
OXh4X2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1
KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51
YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCWludCBzcmNfeCwgc3JjX3ksIHNyY193OwogCXUzMiBvZmZzZXQ7
CkBAIC0zNzU2LDEyICszNzU2LDEyIEBAIGludCBpOXh4X2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCi0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxhbmVfc3Rh
dGUtPnVhcGkudmlzaWJsZSkKIAkJcmV0dXJuIDA7CiAKLQlzcmNfdyA9IGRybV9yZWN0X3dpZHRo
KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCXNyY194ID0gcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjLngxID4+IDE2OwotCXNyY195ID0gcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLnkxID4+IDE2
OworCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7
CisJc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CisJc3JjX3kgPSBwbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CiAKIAkvKiBVbmRvY3VtZW50ZWQgaGFyZHdhcmUg
bGltaXQgb24gaTk2NS9nNHgvdmx2L2NodiAqLwogCWlmIChIQVNfR01DSChkZXZfcHJpdikgJiYg
ZmItPmZvcm1hdC0+Y3BwWzBdID09IDggJiYgc3JjX3cgPiAyMDQ4KQpAQCAtMzc3OSwxNCArMzc3
OSwxNCBAQCBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRlcyBiYWNrIHNv
IHRoYXQgdGhlIHNyYwogCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRoZSByaWdodCB2
YWx1ZXMuCiAJICovCi0JZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+YmFzZS5z
cmMsCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCiAJCQkg
ICAgICBzcmNfeCA8PCAxNiwgc3JjX3kgPDwgMTYpOwogCiAJLyogSFNXL0JEVyBkbyB0aGlzIGF1
dG9tYWdpY2FsbHkgaW4gaGFyZHdhcmUgKi8KIAlpZiAoIUlTX0hBU1dFTEwoZGV2X3ByaXYpICYm
ICFJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7CiAJCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBs
YW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKLQkJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBs
YW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JCWludCBzcmNfaCA9IGRybV9yZWN0X2hlaWdo
dCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKKwkJaW50IHNyY193ID0gZHJtX3JlY3Rf
d2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJCWludCBzcmNfaCA9IGRybV9y
ZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKIAogCQlpZiAocm90YXRp
b24gJiBEUk1fTU9ERV9ST1RBVEVfMTgwKSB7CiAJCQlzcmNfeCArPSBzcmNfdyAtIDE7CkBAIC0z
ODIzLDE0ICszODIzLDE0IEBAIHN0YXRpYyBpbnQKIGk5eHhfcGxhbmVfY2hlY2soc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9w
bGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlpbnQgcmV0Owog
CiAJcmV0ID0gY2h2X3BsYW5lX2NoZWNrX3JvdGF0aW9uKHBsYW5lX3N0YXRlKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVf
c3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLAorCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNr
X3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgJmNydGNfc3RhdGUtPnVh
cGksCiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKIAkJCQkJCSAgRFJNX1BM
QU5FX0hFTFBFUl9OT19TQ0FMSU5HLApAQCAtMzg0Myw3ICszODQzLDcgQEAgaTl4eF9wbGFuZV9j
aGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQly
ZXR1cm4gcmV0OwogCi0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxh
bmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJcmV0dXJuIDA7CiAKIAlyZXQgPSBpbnRlbF9wbGFu
ZV9jaGVja19zcmNfY29vcmRpbmF0ZXMocGxhbmVfc3RhdGUpOwpAQCAtMzg2NCwxMCArMzg2NCwx
MCBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAogCXUzMiBsaW5lYXJfb2Zmc2V0OwogCWludCB4ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lWzBdLng7CiAJaW50IHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueTsKLQlpbnQg
Y3J0Y194ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QueTE7Ci0JaW50IGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QpOwotCWludCBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT5iYXNlLmRzdCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsK
KwlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCWludCBjcnRjX3cgPSBk
cm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwlpbnQgY3J0Y19oID0gZHJt
X3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXVuc2lnbmVkIGxvbmcgaXJx
ZmxhZ3M7CiAJdTMyIGRzcGFkZHJfb2Zmc2V0OwogCXUzMiBkc3BjbnRyOwpAQCAtNDIyMSw3ICs0
MjIxLDcgQEAgdTMyIHNrbF9wbGFuZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQl0b19pOTE1
KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51
YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5o
dy5yb3RhdGlvbjsKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5
ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwpAQCAtNDI3Nyw5ICs0Mjc3LDkgQEAgdTMyIGdsa19wbGFu
ZV9jb2xvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJh
c2UucGxhbmUtPmRldik7CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7
CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7
Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRl
LT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxh
bmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOwog
CiAJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5FX0dBTU1BX0RJU0FCTEU7CkBA
IC01NjIzLDExICs1NjIzLDExIEBAIHN0YXRpYyBpbnQgc2tsX3VwZGF0ZV9zY2FsZXJfcGxhbmUo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVs
X3BsYW5lID0KLQkJdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCQl0
b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwogCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCByZXQ7
Ci0JYm9vbCBmb3JjZV9kZXRhY2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGU7
CisJYm9vbCBmb3JjZV9kZXRhY2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGU7
CiAJYm9vbCBuZWVkX3NjYWxlciA9IGZhbHNlOwogCiAJLyogUHJlLWdlbjExIGFuZCBTRFIgcGxh
bmVzIGFsd2F5cyBuZWVkIGEgc2NhbGVyIGZvciBwbGFuYXIgZm9ybWF0cy4gKi8KQEAgLTU2Mzgs
MTAgKzU2MzgsMTAgQEAgc3RhdGljIGludCBza2xfdXBkYXRlX3NjYWxlcl9wbGFuZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlyZXQgPSBza2xfdXBkYXRlX3NjYWxlcihj
cnRjX3N0YXRlLCBmb3JjZV9kZXRhY2gsCiAJCQkJZHJtX3BsYW5lX2luZGV4KCZpbnRlbF9wbGFu
ZS0+YmFzZSksCiAJCQkJJnBsYW5lX3N0YXRlLT5zY2FsZXJfaWQsCi0JCQkJZHJtX3JlY3Rfd2lk
dGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTYsCi0JCQkJZHJtX3JlY3RfaGVpZ2h0KCZw
bGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2LAotCQkJCWRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QpLAotCQkJCWRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uu
ZHN0KSwKKwkJCQlkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNiwK
KwkJCQlkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTYsCisJCQkJ
ZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCksCisJCQkJZHJtX3JlY3RfaGVp
Z2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpLAogCQkJCWZiID8gZmItPmZvcm1hdCA6IE5VTEws
IG5lZWRfc2NhbGVyKTsKIAogCWlmIChyZXQgfHwgcGxhbmVfc3RhdGUtPnNjYWxlcl9pZCA8IDAp
CkBAIC02MDU3LDcgKzYwNTcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRl
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJICogU28gZGlzYWJs
ZSB1bmRlcnJ1biByZXBvcnRpbmcgYmVmb3JlIGFsbCB0aGUgcGxhbmVzIGdldCBkaXNhYmxlZC4K
IAkJICovCiAJCWlmIChJU19HRU4oZGV2X3ByaXYsIDIpICYmIG9sZF9wcmltYXJ5X3N0YXRlLT52
aXNpYmxlICYmCi0JCSAgICAobW9kZXNldCB8fCAhbmV3X3ByaW1hcnlfc3RhdGUtPmJhc2Uudmlz
aWJsZSkpCisJCSAgICAobW9kZXNldCB8fCAhbmV3X3ByaW1hcnlfc3RhdGUtPnVhcGkudmlzaWJs
ZSkpCiAJCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LCBj
cnRjLT5waXBlLCBmYWxzZSk7CiAJfQogCkBAIC02MTQ0LDcgKzYxNDQsNyBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9jcnRjX2Rpc2FibGVfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlLAogCiAJCWludGVsX2Rpc2FibGVfcGxhbmUocGxhbmUsIG5ld19jcnRjX3N0YXRlKTsKIAot
CQlpZiAob2xkX3BsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJCWlmIChvbGRfcGxhbmVfc3Rh
dGUtPnVhcGkudmlzaWJsZSkKIAkJCWZiX2JpdHMgfD0gcGxhbmUtPmZyb250YnVmZmVyX2JpdDsK
IAl9CiAKQEAgLTcxNTMsNyArNzE1Myw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NydGNfZGlzYWJs
ZV9ub2F0b21pYyhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJCWNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQogCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmUt
PmJhc2Uuc3RhdGUpOwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCQlpZiAo
cGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJCWludGVsX3BsYW5lX2Rpc2FibGVfbm9hdG9t
aWMoaW50ZWxfY3J0YywgcGxhbmUpOwogCX0KIApAQCAtMTA3MjgsNyArMTA3MjgsNyBAQCBzdGF0
aWMgYm9vbCBoYXN3ZWxsX2dldF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywK
IHN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX2Jhc2UoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0b19pOTE1KHBs
YW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCXUzMiBiYXNlOwpAQCAtMTA3NDMsOCAr
MTA3NDMsOCBAQCBzdGF0aWMgdTMyIGludGVsX2N1cnNvcl9iYXNlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIHN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX3Bv
c2l0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0J
aW50IHggPSBwbGFuZV9zdGF0ZS0+YmFzZS5kc3QueDE7Ci0JaW50IHkgPSBwbGFuZV9zdGF0ZS0+
YmFzZS5kc3QueTE7CisJaW50IHggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CisJaW50IHkg
PSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CiAJdTMyIHBvcyA9IDA7CiAKIAlpZiAoeCA8IDAp
IHsKQEAgLTEwNzY1LDkgKzEwNzY1LDkgQEAgc3RhdGljIHUzMiBpbnRlbF9jdXJzb3JfcG9zaXRp
b24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHN0YXRpYyBi
b29sIGludGVsX2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9tb2RlX2NvbmZpZyAqY29uZmlnID0K
LQkJJnBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYtPm1vZGVfY29uZmlnOwotCWludCB3aWR0
aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOwotCWludCBoZWlnaHQg
PSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7CisJCSZwbGFuZV9zdGF0
ZS0+dWFwaS5wbGFuZS0+ZGV2LT5tb2RlX2NvbmZpZzsKKwlpbnQgd2lkdGggPSBkcm1fcmVjdF93
aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwlpbnQgaGVpZ2h0ID0gZHJtX3JlY3RfaGVp
Z2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCiAJcmV0dXJuIHdpZHRoID4gMCAmJiB3aWR0
aCA8PSBjb25maWctPmN1cnNvcl93aWR0aCAmJgogCQloZWlnaHQgPiAwICYmIGhlaWdodCA8PSBj
b25maWctPmN1cnNvcl9oZWlnaHQ7CkBAIC0xMDc3Niw3ICsxMDc3Niw3IEBAIHN0YXRpYyBib29s
IGludGVsX2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiBzdGF0aWMgaW50IGludGVsX2N1cnNvcl9jaGVja19zdXJmYWNlKHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsK
KwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKIAl1bnNpZ25lZCBpbnQg
cm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJaW50IHNyY194LCBzcmNfeTsK
IAl1MzIgb2Zmc2V0OwpAQCAtMTA3ODYsMTEgKzEwNzg2LDExIEBAIHN0YXRpYyBpbnQgaW50ZWxf
Y3Vyc29yX2NoZWNrX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52
aXNpYmxlKQorCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJcmV0dXJuIDA7CiAK
LQlzcmNfeCA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKLQlzcmNfeSA9IHBsYW5l
X3N0YXRlLT5iYXNlLnNyYy55MSA+PiAxNjsKKwlzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNy
Yy54MSA+PiAxNjsKKwlzcmNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKIAog
CWludGVsX2FkZF9mYl9vZmZzZXRzKCZzcmNfeCwgJnNyY195LCBwbGFuZV9zdGF0ZSwgMCk7CiAJ
b2Zmc2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmc3JjX3gsICZzcmNf
eSwKQEAgLTEwODA1LDE0ICsxMDgwNSwxNCBAQCBzdGF0aWMgaW50IGludGVsX2N1cnNvcl9jaGVj
a19zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogUHV0
IHRoZSBmaW5hbCBjb29yZGluYXRlcyBiYWNrIHNvIHRoYXQgdGhlIHNyYwogCSAqIGNvb3JkaW5h
dGUgY2hlY2tzIHdpbGwgc2VlIHRoZSByaWdodCB2YWx1ZXMuCiAJICovCi0JZHJtX3JlY3RfdHJh
bnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMsCisJZHJtX3JlY3RfdHJhbnNsYXRlX3Rv
KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCiAJCQkgICAgICBzcmNfeCA8PCAxNiwgc3JjX3kgPDwg
MTYpOwogCiAJLyogSUxLKyBkbyB0aGlzIGF1dG9tYWdpY2FsbHkgaW4gaGFyZHdhcmUgKi8KIAlp
ZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmIHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkg
ewogCQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5m
YjsKLQkJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykg
Pj4gMTY7Ci0JCWludCBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uu
c3JjKSA+PiAxNjsKKwkJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51
YXBpLnNyYykgPj4gMTY7CisJCWludCBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3Rh
dGUtPnVhcGkuc3JjKSA+PiAxNjsKIAogCQlvZmZzZXQgKz0gKHNyY19oICogc3JjX3cgLSAxKSAq
IGZiLT5mb3JtYXQtPmNwcFswXTsKIAl9CkBAIC0xMDgzNSw3ICsxMDgzNSw3IEBAIHN0YXRpYyBp
bnQgaW50ZWxfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAKLQlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVj
a19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UsCisJcmV0ID0gZHJtX2F0b21pY19oZWxw
ZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT51YXBpLAogCQkJCQkJICAmY3J0Y19z
dGF0ZS0+dWFwaSwKIAkJCQkJCSAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLAogCQkJCQkJ
ICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCkBAIC0xMDg0NCwxNCArMTA4NDQsMTQgQEAg
c3RhdGljIGludCBpbnRlbF9jaGVja19jdXJzb3Ioc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCXJldHVybiByZXQ7CiAKIAkvKiBVc2UgdGhlIHVuY2xpcHBlZCBzcmMvZHN0
IHJlY3RhbmdsZXMsIHdoaWNoIHdlIHByb2dyYW0gdG8gaHcgKi8KLQlwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMgPSBkcm1fcGxhbmVfc3RhdGVfc3JjKCZwbGFuZV9zdGF0ZS0+YmFzZSk7Ci0JcGxhbmVf
c3RhdGUtPmJhc2UuZHN0ID0gZHJtX3BsYW5lX3N0YXRlX2Rlc3QoJnBsYW5lX3N0YXRlLT5iYXNl
KTsKKwlwbGFuZV9zdGF0ZS0+dWFwaS5zcmMgPSBkcm1fcGxhbmVfc3RhdGVfc3JjKCZwbGFuZV9z
dGF0ZS0+dWFwaSk7CisJcGxhbmVfc3RhdGUtPnVhcGkuZHN0ID0gZHJtX3BsYW5lX3N0YXRlX2Rl
c3QoJnBsYW5lX3N0YXRlLT51YXBpKTsKIAogCXJldCA9IGludGVsX2N1cnNvcl9jaGVja19zdXJm
YWNlKHBsYW5lX3N0YXRlKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JaWYgKCFwbGFu
ZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmICghcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkK
IAkJcmV0dXJuIDA7CiAKIAlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRpbmF0ZXMo
cGxhbmVfc3RhdGUpOwpAQCAtMTA4ODksNyArMTA4ODksNyBAQCBzdGF0aWMgdTMyIGk4NDVfY3Vy
c29yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3Rh
dGljIGJvb2wgaTg0NV9jdXJzb3Jfc2l6ZV9vayhjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewotCWludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QpOworCWludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0
ZS0+dWFwaS5kc3QpOwogCiAJLyoKIAkgKiA4NDVnLzg2NWcgYXJlIG9ubHkgbGltaXRlZCBieSB0
aGUgd2lkdGggb2YgdGhlaXIgY3Vyc29ycywKQEAgLTEwOTE1LDEyICsxMDkxNSwxMiBAQCBzdGF0
aWMgaW50IGk4NDVfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCS8qIENoZWNrIGZvciB3aGljaCBjdXJzb3IgdHlwZXMgd2Ugc3VwcG9ydCAqLwogCWlm
ICghaTg0NV9jdXJzb3Jfc2l6ZV9vayhwbGFuZV9zdGF0ZSkpIHsKIAkJRFJNX0RFQlVHKCJDdXJz
b3IgZGltZW5zaW9uICVkeCVkIG5vdCBzdXBwb3J0ZWRcbiIsCi0JCQkgIGRybV9yZWN0X3dpZHRo
KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLAotCQkJICBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT5iYXNlLmRzdCkpOworCQkJICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGku
ZHN0KSwKKwkJCSAgZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpKTsKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JV0FSTl9PTihwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxl
ICYmCisJV0FSTl9PTihwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlICYmCiAJCXBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVswXS5zdHJpZGUgIT0gZmItPnBpdGNoZXNbMF0pOwogCiAJc3dpdGNoIChm
Yi0+cGl0Y2hlc1swXSkgewpAQCAtMTA5NDgsOSArMTA5NDgsOSBAQCBzdGF0aWMgdm9pZCBpODQ1
X3VwZGF0ZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAl1MzIgY250bCA9IDAs
IGJhc2UgPSAwLCBwb3MgPSAwLCBzaXplID0gMDsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwog
Ci0JaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpIHsKLQkJdW5z
aWduZWQgaW50IHdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7
Ci0JCXVuc2lnbmVkIGludCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5i
YXNlLmRzdCk7CisJaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUp
IHsKKwkJdW5zaWduZWQgaW50IHdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51
YXBpLmRzdCk7CisJCXVuc2lnbmVkIGludCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5l
X3N0YXRlLT51YXBpLmRzdCk7CiAKIAkJY250bCA9IHBsYW5lX3N0YXRlLT5jdGwgfAogCQkJaTg0
NV9jdXJzb3JfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CkBAIC0xMTA0NiwxMyArMTEwNDYsMTMgQEAg
c3RhdGljIHUzMiBpOXh4X2N1cnNvcl9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5
MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7CisJCXRvX2k5MTUocGxhbmVfc3RhdGUt
PnVhcGkucGxhbmUtPmRldik7CiAJdTMyIGNudGwgPSAwOwogCiAJaWYgKElTX0dFTihkZXZfcHJp
diwgNikgfHwgSVNfSVZZQlJJREdFKGRldl9wcml2KSkKIAkJY250bCB8PSBNQ1VSU09SX1RSSUNL
TEVfRkVFRF9ESVNBQkxFOwogCi0Jc3dpdGNoIChkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUt
PmJhc2UuZHN0KSkgeworCXN3aXRjaCAoZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBp
LmRzdCkpIHsKIAljYXNlIDY0OgogCQljbnRsIHw9IE1DVVJTT1JfTU9ERV82NF9BUkdCX0FYOwog
CQlicmVhazsKQEAgLTExMDYzLDcgKzExMDYzLDcgQEAgc3RhdGljIHUzMiBpOXh4X2N1cnNvcl9j
dGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCWNudGwgfD0g
TUNVUlNPUl9NT0RFXzI1Nl9BUkdCX0FYOwogCQlicmVhazsKIAlkZWZhdWx0OgotCQlNSVNTSU5H
X0NBU0UoZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCkpOworCQlNSVNTSU5H
X0NBU0UoZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCkpOwogCQlyZXR1cm4g
MDsKIAl9CiAKQEAgLTExMDc2LDkgKzExMDc2LDkgQEAgc3RhdGljIHUzMiBpOXh4X2N1cnNvcl9j
dGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgYm9v
bCBpOXh4X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9f
aTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQlpbnQgd2lkdGggPSBkcm1fcmVj
dF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKLQlpbnQgaGVpZ2h0ID0gZHJtX3JlY3Rf
aGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOworCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51
YXBpLnBsYW5lLT5kZXYpOworCWludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0
ZS0+dWFwaS5kc3QpOworCWludCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRl
LT51YXBpLmRzdCk7CiAKIAlpZiAoIWludGVsX2N1cnNvcl9zaXplX29rKHBsYW5lX3N0YXRlKSkK
IAkJcmV0dXJuIGZhbHNlOwpAQCAtMTExMTQsNyArMTExMTQsNyBAQCBzdGF0aWMgYm9vbCBpOXh4
X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiBzdGF0aWMgaW50IGk5eHhfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFu
ZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBp
cGUgPSBwbGFuZS0+cGlwZTsKQEAgLTExMTMxLDE5ICsxMTEzMSwxOSBAQCBzdGF0aWMgaW50IGk5
eHhfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCS8q
IENoZWNrIGZvciB3aGljaCBjdXJzb3IgdHlwZXMgd2Ugc3VwcG9ydCAqLwogCWlmICghaTl4eF9j
dXJzb3Jfc2l6ZV9vayhwbGFuZV9zdGF0ZSkpIHsKIAkJRFJNX0RFQlVHKCJDdXJzb3IgZGltZW5z
aW9uICVkeCVkIG5vdCBzdXBwb3J0ZWRcbiIsCi0JCQkgIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3QpLAotCQkJICBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNl
LmRzdCkpOworCQkJICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwKKwkJ
CSAgZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpKTsKIAkJcmV0dXJuIC1F
SU5WQUw7CiAJfQogCi0JV0FSTl9PTihwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlICYmCisJV0FS
Tl9PTihwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlICYmCiAJCXBsYW5lX3N0YXRlLT5jb2xvcl9w
bGFuZVswXS5zdHJpZGUgIT0gZmItPnBpdGNoZXNbMF0pOwogCiAJaWYgKGZiLT5waXRjaGVzWzBd
ICE9Ci0JICAgIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpICogZmItPmZv
cm1hdC0+Y3BwWzBdKSB7CisJICAgIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5k
c3QpICogZmItPmZvcm1hdC0+Y3BwWzBdKSB7CiAJCURSTV9ERUJVR19LTVMoIkludmFsaWQgY3Vy
c29yIHN0cmlkZSAoJXUpIChjdXJzb3Igd2lkdGggJWQpXG4iLAogCQkJICAgICAgZmItPnBpdGNo
ZXNbMF0sCi0JCQkgICAgICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KSk7
CisJCQkgICAgICBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSk7CiAJCXJl
dHVybiAtRUlOVkFMOwogCX0KIApAQCAtMTExNTgsNyArMTExNTgsNyBAQCBzdGF0aWMgaW50IGk5
eHhfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAq
IFJlZnVzZSB0aGUgcHV0IHRoZSBjdXJzb3IgaW50byB0aGF0IGNvbXByb21pc2VkIHBvc2l0aW9u
LgogCSAqLwogCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSAmJiBwaXBlID09IFBJUEVfQyAm
JgotCSAgICBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlICYmIHBsYW5lX3N0YXRlLT5iYXNlLmRz
dC54MSA8IDApIHsKKwkgICAgcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSAmJiBwbGFuZV9zdGF0
ZS0+dWFwaS5kc3QueDEgPCAwKSB7CiAJCURSTV9ERUJVR19LTVMoIkNIViBjdXJzb3IgQyBub3Qg
YWxsb3dlZCB0byBzdHJhZGRsZSB0aGUgbGVmdCBzY3JlZW4gZWRnZVxuIik7CiAJCXJldHVybiAt
RUlOVkFMOwogCX0KQEAgLTExMTc3LDkgKzExMTc3LDkgQEAgc3RhdGljIHZvaWQgaTl4eF91cGRh
dGVfY3Vyc29yKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJdTMyIGNudGwgPSAwLCBiYXNl
ID0gMCwgcG9zID0gMCwgZmJjX2N0bCA9IDA7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsKIAot
CWlmIChwbGFuZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKSB7Ci0JCXVuc2ln
bmVkIHdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0JCXVu
c2lnbmVkIGhlaWdodCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsK
KwlpZiAocGxhbmVfc3RhdGUgJiYgcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkgeworCQl1bnNp
Z25lZCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOworCQl1
bnNpZ25lZCBoZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7
CiAKIAkJY250bCA9IHBsYW5lX3N0YXRlLT5jdGwgfAogCQkJaTl4eF9jdXJzb3JfY3RsX2NydGMo
Y3J0Y19zdGF0ZSk7CkBAIC0xMTcxNCw3ICsxMTcxNCw3IEBAIHN0YXRpYyBib29sIGludGVsX3dt
X25lZWRfdXBkYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqY3VyLAogCQkJCSBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ldykKIHsKIAkvKiBVcGRhdGUgd2F0ZXJtYXJrcyBv
biB0aWxpbmcgb3Igc2l6ZSBjaGFuZ2VzLiAqLwotCWlmIChuZXctPmJhc2UudmlzaWJsZSAhPSBj
dXItPmJhc2UudmlzaWJsZSkKKwlpZiAobmV3LT51YXBpLnZpc2libGUgIT0gY3VyLT51YXBpLnZp
c2libGUpCiAJCXJldHVybiB0cnVlOwogCiAJaWYgKCFjdXItPmh3LmZiIHx8ICFuZXctPmh3LmZi
KQpAQCAtMTE3MjIsMTAgKzExNzIyLDEwIEBAIHN0YXRpYyBib29sIGludGVsX3dtX25lZWRfdXBk
YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqY3VyLAogCiAJaWYgKGN1ci0+aHcu
ZmItPm1vZGlmaWVyICE9IG5ldy0+aHcuZmItPm1vZGlmaWVyIHx8CiAJICAgIGN1ci0+aHcucm90
YXRpb24gIT0gbmV3LT5ody5yb3RhdGlvbiB8fAotCSAgICBkcm1fcmVjdF93aWR0aCgmbmV3LT5i
YXNlLnNyYykgIT0gZHJtX3JlY3Rfd2lkdGgoJmN1ci0+YmFzZS5zcmMpIHx8Ci0JICAgIGRybV9y
ZWN0X2hlaWdodCgmbmV3LT5iYXNlLnNyYykgIT0gZHJtX3JlY3RfaGVpZ2h0KCZjdXItPmJhc2Uu
c3JjKSB8fAotCSAgICBkcm1fcmVjdF93aWR0aCgmbmV3LT5iYXNlLmRzdCkgIT0gZHJtX3JlY3Rf
d2lkdGgoJmN1ci0+YmFzZS5kc3QpIHx8Ci0JICAgIGRybV9yZWN0X2hlaWdodCgmbmV3LT5iYXNl
LmRzdCkgIT0gZHJtX3JlY3RfaGVpZ2h0KCZjdXItPmJhc2UuZHN0KSkKKwkgICAgZHJtX3JlY3Rf
d2lkdGgoJm5ldy0+dWFwaS5zcmMpICE9IGRybV9yZWN0X3dpZHRoKCZjdXItPnVhcGkuc3JjKSB8
fAorCSAgICBkcm1fcmVjdF9oZWlnaHQoJm5ldy0+dWFwaS5zcmMpICE9IGRybV9yZWN0X2hlaWdo
dCgmY3VyLT51YXBpLnNyYykgfHwKKwkgICAgZHJtX3JlY3Rfd2lkdGgoJm5ldy0+dWFwaS5kc3Qp
ICE9IGRybV9yZWN0X3dpZHRoKCZjdXItPnVhcGkuZHN0KSB8fAorCSAgICBkcm1fcmVjdF9oZWln
aHQoJm5ldy0+dWFwaS5kc3QpICE9IGRybV9yZWN0X2hlaWdodCgmY3VyLT51YXBpLmRzdCkpCiAJ
CXJldHVybiB0cnVlOwogCiAJcmV0dXJuIGZhbHNlOwpAQCAtMTE3MzMsMTAgKzExNzMzLDEwIEBA
IHN0YXRpYyBib29sIGludGVsX3dtX25lZWRfdXBkYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqY3VyLAogCiBzdGF0aWMgYm9vbCBuZWVkc19zY2FsaW5nKGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUpCiB7Ci0JaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgo
JnN0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JaW50IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZz
dGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCWludCBkc3RfdyA9IGRybV9yZWN0X3dpZHRoKCZzdGF0
ZS0+YmFzZS5kc3QpOwotCWludCBkc3RfaCA9IGRybV9yZWN0X2hlaWdodCgmc3RhdGUtPmJhc2Uu
ZHN0KTsKKwlpbnQgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmc3RhdGUtPnVhcGkuc3JjKSA+PiAx
NjsKKwlpbnQgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnN0YXRlLT51YXBpLnNyYykgPj4gMTY7
CisJaW50IGRzdF93ID0gZHJtX3JlY3Rfd2lkdGgoJnN0YXRlLT51YXBpLmRzdCk7CisJaW50IGRz
dF9oID0gZHJtX3JlY3RfaGVpZ2h0KCZzdGF0ZS0+dWFwaS5kc3QpOwogCiAJcmV0dXJuIChzcmNf
dyAhPSBkc3RfdyB8fCBzcmNfaCAhPSBkc3RfaCk7CiB9CkBAIC0xMTc0Nyw3ICsxMTc0Nyw3IEBA
IGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0CiAJCQkJICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9
IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5k
ZXYpOwogCWJvb2wgbW9kZV9jaGFuZ2VkID0gbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKTsKIAli
b29sIHdhc19jcnRjX2VuYWJsZWQgPSBvbGRfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwpAQCAtMTE3
NjEsOCArMTE3NjEsOCBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdlcyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdAogCQkJcmV0dXJuIHJldDsK
IAl9CiAKLQl3YXNfdmlzaWJsZSA9IG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlOwotCXZp
c2libGUgPSBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlOworCXdhc192aXNpYmxlID0gb2xkX3Bs
YW5lX3N0YXRlLT51YXBpLnZpc2libGU7CisJdmlzaWJsZSA9IHBsYW5lX3N0YXRlLT51YXBpLnZp
c2libGU7CiAKIAlpZiAoIXdhc19jcnRjX2VuYWJsZWQgJiYgV0FSTl9PTih3YXNfdmlzaWJsZSkp
CiAJCXdhc192aXNpYmxlID0gZmFsc2U7CkBAIC0xMTc3OCw3ICsxMTc3OCw3IEBAIGludCBpbnRl
bF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpvbGRfY3J0Y19zdGF0CiAJICogb25seSBjb21iaW5lIHRoZSByZXN1bHRzIGZyb20gYWxsIHBs
YW5lcyBpbiB0aGUgY3VycmVudCBwbGFjZT8KIAkgKi8KIAlpZiAoIWlzX2NydGNfZW5hYmxlZCkg
ewotCQlwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlID0gdmlzaWJsZSA9IGZhbHNlOworCQlwbGFu
ZV9zdGF0ZS0+dWFwaS52aXNpYmxlID0gdmlzaWJsZSA9IGZhbHNlOwogCQljcnRjX3N0YXRlLT5h
Y3RpdmVfcGxhbmVzICY9IH5CSVQocGxhbmUtPmlkKTsKIAkJY3J0Y19zdGF0ZS0+ZGF0YV9yYXRl
W3BsYW5lLT5pZF0gPSAwOwogCQljcnRjX3N0YXRlLT5taW5fY2RjbGtbcGxhbmUtPmlkXSA9IDA7
CkBAIC0xMTkzOCw3ICsxMTkzOCw3IEBAIHN0YXRpYyBpbnQgaWNsX2NoZWNrX252MTJfcGxhbmVz
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQkJY29udGludWU7CiAKIAkJ
cGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmUgPSBOVUxMOwotCQlpZiAocGxhbmVfc3Rh
dGUtPnBsYW5hcl9zbGF2ZSAmJiAhcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkgeworCQlpZiAo
cGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSAmJiAhcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkg
ewogCQkJY3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lcyAmPSB+QklUKHBsYW5lLT5pZCk7CiAJCQlj
cnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzIHw9IEJJVChwbGFuZS0+aWQpOwogCQl9CkBAIC0xMjM1
MiwxNCArMTIzNTIsMTQgQEAgc3RhdGljIGNvbnN0IGNoYXIgKm91dHB1dF9mb3JtYXRzKGVudW0g
aW50ZWxfb3V0cHV0X2Zvcm1hdCBmb3JtYXQpCiAKIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGxh
bmVfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsK
LQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUt
PmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJc3RydWN0IGRybV9mb3JtYXRfbmFtZV9idWYg
Zm9ybWF0X25hbWU7CiAKIAlpZiAoIWZiKSB7CiAJCURSTV9ERUJVR19LTVMoIltQTEFORTolZDol
c10gZmI6IFtOT0ZCXSwgdmlzaWJsZTogJXNcbiIsCiAJCQkgICAgICBwbGFuZS0+YmFzZS5iYXNl
LmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJICAgICAgeWVzbm8ocGxhbmVfc3RhdGUtPmJhc2Uu
dmlzaWJsZSkpOworCQkJICAgICAgeWVzbm8ocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkpOwog
CQlyZXR1cm47CiAJfQogCkBAIC0xMjM2NywxMyArMTIzNjcsMTMgQEAgc3RhdGljIHZvaWQgaW50
ZWxfZHVtcF9wbGFuZV9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogCQkgICAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAog
CQkgICAgICBmYi0+YmFzZS5pZCwgZmItPndpZHRoLCBmYi0+aGVpZ2h0LAogCQkgICAgICBkcm1f
Z2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKSwKLQkJICAg
ICAgeWVzbm8ocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkpOworCQkgICAgICB5ZXNubyhwbGFu
ZV9zdGF0ZS0+dWFwaS52aXNpYmxlKSk7CiAJRFJNX0RFQlVHX0tNUygiXHRyb3RhdGlvbjogMHgl
eCwgc2NhbGVyOiAlZFxuIiwKIAkJICAgICAgcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uLCBwbGFu
ZV9zdGF0ZS0+c2NhbGVyX2lkKTsKLQlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlp
ZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJRFJNX0RFQlVHX0tNUygiXHRzcmM6ICIg
RFJNX1JFQ1RfRlBfRk1UICIgZHN0OiAiIERSTV9SRUNUX0ZNVCAiXG4iLAotCQkJICAgICAgRFJN
X1JFQ1RfRlBfQVJHKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpLAotCQkJICAgICAgRFJNX1JFQ1Rf
QVJHKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpKTsKKwkJCSAgICAgIERSTV9SRUNUX0ZQX0FSRygm
cGxhbmVfc3RhdGUtPnVhcGkuc3JjKSwKKwkJCSAgICAgIERSTV9SRUNUX0FSRygmcGxhbmVfc3Rh
dGUtPnVhcGkuZHN0KSk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2R1bXBfcGlwZV9jb25maWco
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLApAQCAtMTM1NzgsNyAr
MTM1NzgsNyBAQCBpbnRlbF92ZXJpZnlfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogCWZvcl9lYWNoX25ld19pbnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwgcGxhbmUs
CiAJCQkJCSAgcGxhbmVfc3RhdGUsIGkpCiAJCWFzc2VydF9wbGFuZShwbGFuZSwgcGxhbmVfc3Rh
dGUtPnBsYW5hcl9zbGF2ZSB8fAotCQkJICAgICBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKTsK
KwkJCSAgICAgcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSk7CiB9CiAKIHN0YXRpYyB2b2lkCkBA
IC0xNTAzNyw3ICsxNTAzNyw3IEBAIHN0YXRpYyB2b2lkIGFkZF9ycHNfYm9vc3RfYWZ0ZXJfdmJs
YW5rKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAogc3RhdGljIGludCBpbnRlbF9wbGFuZV9waW5f
ZmIoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUp
OworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtMTUxMDIsNyArMTUx
MDIsNyBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAog
CXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlID0KIAkJdG9faW50ZWxf
cGxhbmVfc3RhdGUoX25ld19wbGFuZV9zdGF0ZSk7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqaW50ZWxfc3RhdGUgPQotCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3X3BsYW5lX3N0YXRl
LT5iYXNlLnN0YXRlKTsKKwkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19wbGFuZV9zdGF0ZS0+
dWFwaS5zdGF0ZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShwbGFuZS0+ZGV2KTsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFuZV9z
dGF0ZS0+aHcuZmI7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGludGVsX2Zi
X29iaihmYik7CkBAIC0xNTEzNSw5ICsxNTEzNSw5IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIo
c3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCX0KIAl9CiAKLQlpZiAobmV3X3BsYW5lX3N0YXRl
LT5iYXNlLmZlbmNlKSB7IC8qIGV4cGxpY2l0IGZlbmNpbmcgKi8KKwlpZiAobmV3X3BsYW5lX3N0
YXRlLT51YXBpLmZlbmNlKSB7IC8qIGV4cGxpY2l0IGZlbmNpbmcgKi8KIAkJcmV0ID0gaTkxNV9z
d19mZW5jZV9hd2FpdF9kbWFfZmVuY2UoJmludGVsX3N0YXRlLT5jb21taXRfcmVhZHksCi0JCQkJ
CQkgICAgbmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZlbmNlLAorCQkJCQkJICAgIG5ld19wbGFuZV9z
dGF0ZS0+dWFwaS5mZW5jZSwKIAkJCQkJCSAgICBJOTE1X0ZFTkNFX1RJTUVPVVQsCiAJCQkJCQkg
ICAgR0ZQX0tFUk5FTCk7CiAJCWlmIChyZXQgPCAwKQpAQCAtMTUxNjAsNyArMTUxNjAsNyBAQCBp
bnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWZiX29ial9i
dW1wX3JlbmRlcl9wcmlvcml0eShvYmopOwogCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG9iai0+
ZnJvbnRidWZmZXIsIE9SSUdJTl9ESVJUWUZCKTsKIAotCWlmICghbmV3X3BsYW5lX3N0YXRlLT5i
YXNlLmZlbmNlKSB7IC8qIGltcGxpY2l0IGZlbmNpbmcgKi8KKwlpZiAoIW5ld19wbGFuZV9zdGF0
ZS0+dWFwaS5mZW5jZSkgeyAvKiBpbXBsaWNpdCBmZW5jaW5nICovCiAJCXN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlOwogCiAJCXJldCA9IGk5MTVfc3dfZmVuY2VfYXdhaXRfcmVzZXJ2YXRpb24oJmlu
dGVsX3N0YXRlLT5jb21taXRfcmVhZHksCkBAIC0xNTE3OCw3ICsxNTE3OCw3IEBAIGludGVsX3By
ZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCX0KIAl9IGVsc2Ugewog
CQlhZGRfcnBzX2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUtPmh3LmNydGMsCi0J
CQkJCSAgIG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mZW5jZSk7CisJCQkJCSAgIG5ld19wbGFuZV9z
dGF0ZS0+dWFwaS5mZW5jZSk7CiAJfQogCiAJLyoKQEAgLTE1MjExLDcgKzE1MjExLDcgQEAgaW50
ZWxfY2xlYW51cF9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSA9CiAJCXRvX2ludGVsX3BsYW5lX3N0YXRl
KF9vbGRfcGxhbmVfc3RhdGUpOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0
YXRlID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5zdGF0
ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShvbGRfcGxhbmVfc3RhdGUtPnVhcGkuc3RhdGUp
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmRl
dik7CiAKIAlpZiAoaW50ZWxfc3RhdGUtPnJwc19pbnRlcmFjdGl2ZSkgewpAQCAtMTUzNDMsOCAr
MTUzNDMsOCBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpf
cGxhbmUsCiAJICogdGhlIHBsYW5lLiAgVGhpcyBwcmV2ZW50cyBvdXIgYXN5bmMgdXBkYXRlJ3Mg
Y2hhbmdlcyBmcm9tIGdldHRpbmcKIAkgKiBvdmVycmlkZGVuIGJ5IGEgcHJldmlvdXMgc3luY2hy
b25vdXMgdXBkYXRlJ3Mgc3RhdGUuCiAJICovCi0JaWYgKG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5j
b21taXQgJiYKLQkgICAgIXRyeV93YWl0X2Zvcl9jb21wbGV0aW9uKCZvbGRfcGxhbmVfc3RhdGUt
PmJhc2UuY29tbWl0LT5od19kb25lKSkKKwlpZiAob2xkX3BsYW5lX3N0YXRlLT51YXBpLmNvbW1p
dCAmJgorCSAgICAhdHJ5X3dhaXRfZm9yX2NvbXBsZXRpb24oJm9sZF9wbGFuZV9zdGF0ZS0+dWFw
aS5jb21taXQtPmh3X2RvbmUpKQogCQlnb3RvIHNsb3c7CiAKIAkvKgpAQCAtMTcxNTAsNyArMTcx
NTAsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zYW5pdGl6ZV9jcnRjKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9
CiAJCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmUtPmJhc2Uuc3RhdGUpOwogCi0JCQlpZiAo
cGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSAmJgorCQkJaWYgKHBsYW5lX3N0YXRlLT51YXBpLnZp
c2libGUgJiYKIAkJCSAgICBwbGFuZS0+YmFzZS50eXBlICE9IERSTV9QTEFORV9UWVBFX1BSSU1B
UlkpCiAJCQkJaW50ZWxfcGxhbmVfZGlzYWJsZV9ub2F0b21pYyhjcnRjLCBwbGFuZSk7CiAJCX0K
QEAgLTE3NDgzLDE0ICsxNzQ4MywxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3JlYWRv
dXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJCSAqIEZJWE1FIGRvbid0IGhh
dmUgdGhlIGZiIHlldCwgc28gY2FuJ3QKIAkJCSAqIHVzZSBpbnRlbF9wbGFuZV9kYXRhX3JhdGUo
KSA6KAogCQkJICovCi0JCQlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwkJCWlmIChw
bGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQogCQkJCWNydGNfc3RhdGUtPmRhdGFfcmF0ZVtwbGFu
ZS0+aWRdID0KIAkJCQkJNCAqIGNydGNfc3RhdGUtPnBpeGVsX3JhdGU7CiAJCQkvKgogCQkJICog
RklYTUUgZG9uJ3QgaGF2ZSB0aGUgZmIgeWV0LCBzbyBjYW4ndAogCQkJICogdXNlIHBsYW5lLT5t
aW5fY2RjbGsoKSA6KAogCQkJICovCi0JCQlpZiAocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSAm
JiBwbGFuZS0+bWluX2NkY2xrKSB7CisJCQlpZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSAm
JiBwbGFuZS0+bWluX2NkY2xrKSB7CiAJCQkJaWYgKGNydGNfc3RhdGUtPmRvdWJsZV93aWRlIHx8
CiAJCQkJICAgIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZf
cHJpdikpCiAJCQkJCWNydGNfc3RhdGUtPm1pbl9jZGNsa1twbGFuZS0+aWRdID0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jCmluZGV4IDNlYThkMDEwZGI2Yy4uOTJjN2Vi
MjQzNTU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zi
Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKQEAgLTQz
MCw3ICs0MzAsNyBAQCBzdGF0aWMgYm9vbCBtdWx0aXBsZV9waXBlc19vayhzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIAlpZiAoIW5vX2ZiY19vbl9tdWx0aXBsZV9waXBlcyhkZXZfcHJpdikpCiAJ
CXJldHVybiB0cnVlOwogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKHBs
YW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCWZiYy0+dmlzaWJsZV9waXBlc19tYXNrIHw9ICgx
IDw8IHBpcGUpOwogCWVsc2UKIAkJZmJjLT52aXNpYmxlX3BpcGVzX21hc2sgJj0gfigxIDw8IHBp
cGUpOwpAQCAtNjc3LDEyICs2NzcsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJjX3VwZGF0ZV9z
dGF0ZV9jYWNoZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkgKiB0aGUgOTAvMjcwIGRlZ3Jl
ZSBwbGFuZSByb3RhdGlvbiBjYXNlcyAodG8gbWF0Y2ggdGhlCiAJICogR1RUIG1hcHBpbmcpLCBo
ZW5jZSBubyBuZWVkIHRvIGFjY291bnQgZm9yIHJvdGF0aW9uIGhlcmUuCiAJICovCi0JY2FjaGUt
PnBsYW5lLnNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4g
MTY7Ci0JY2FjaGUtPnBsYW5lLnNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+
YmFzZS5zcmMpID4+IDE2OwotCWNhY2hlLT5wbGFuZS52aXNpYmxlID0gcGxhbmVfc3RhdGUtPmJh
c2UudmlzaWJsZTsKKwljYWNoZS0+cGxhbmUuc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwljYWNoZS0+cGxhbmUuc3JjX2ggPSBkcm1fcmVjdF9o
ZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJY2FjaGUtPnBsYW5lLnZpc2li
bGUgPSBwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlOwogCWNhY2hlLT5wbGFuZS5hZGp1c3RlZF94
ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLng7CiAJY2FjaGUtPnBsYW5lLmFkanVzdGVk
X3kgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueTsKLQljYWNoZS0+cGxhbmUueSA9IHBs
YW5lX3N0YXRlLT5iYXNlLnNyYy55MSA+PiAxNjsKKwljYWNoZS0+cGxhbmUueSA9IHBsYW5lX3N0
YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKIAogCWNhY2hlLT5wbGFuZS5waXhlbF9ibGVuZF9tb2Rl
ID0gcGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGU7CiAKQEAgLTEwNTIsNyArMTA1Miw3
IEBAIHZvaWQgaW50ZWxfZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJaWYgKCFwbGFuZS0+aGFzX2ZiYykKIAkJCWNvbnRpbnVlOwogCi0JCWlmICgh
cGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwkJaWYgKCFwbGFuZV9zdGF0ZS0+dWFwaS52aXNp
YmxlKQogCQkJY29udGludWU7CiAKIAkJY3J0Y19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfbmV3
X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX292ZXJsYXkuYwppbmRleCA0NmUzZDZjZjU5NzYuLjhjZmI3ODVlNzYxYyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTY2OCw3ICs2
NjgsNyBAQCBzdGF0aWMgdm9pZCB1cGRhdGVfY29sb3JrZXkoc3RydWN0IGludGVsX292ZXJsYXkg
Km92ZXJsYXksCiAJaWYgKG92ZXJsYXktPmNvbG9yX2tleV9lbmFibGVkKQogCQlmbGFncyB8PSBE
U1RfS0VZX0VOQUJMRTsKIAotCWlmIChzdGF0ZS0+YmFzZS52aXNpYmxlKQorCWlmIChzdGF0ZS0+
dWFwaS52aXNpYmxlKQogCQlmb3JtYXQgPSBzdGF0ZS0+aHcuZmItPmZvcm1hdC0+Zm9ybWF0Owog
CiAJc3dpdGNoIChmb3JtYXQpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfc3ByaXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nwcml0ZS5jCmluZGV4IGIyMTE2ZDEyMzU0OC4uZWY3NDA5ZjY5NWY5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTI0MCw3ICsyNDAsNyBAQCB2
b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGUpCiAKIGludCBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUoY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFu
ZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwog
CXUzMiBzdHJpZGUsIG1heF9zdHJpZGU7CkBAIC0yNTIsNyArMjUyLDcgQEAgaW50IGludGVsX3Bs
YW5lX2NoZWNrX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogCSAqIGtpY2sgaW4gZHVlIHRoZSBwbGFuZSBiZWluZyBpbnZpc2libGUuCiAJICovCiAJ
aWYgKGludGVsX3BsYW5lX2Nhbl9yZW1hcChwbGFuZV9zdGF0ZSkgJiYKLQkgICAgIXBsYW5lX3N0
YXRlLT5iYXNlLnZpc2libGUpCisJICAgICFwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQogCQly
ZXR1cm4gMDsKIAogCS8qIEZJWE1FIG90aGVyIGNvbG9yIHBsYW5lcz8gKi8KQEAgLTI3Myw3ICsy
NzMsNyBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3Jk
aW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0Jc3RydWN0
IGRybV9yZWN0ICpzcmMgPSAmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjOworCXN0cnVjdCBkcm1fcmVj
dCAqc3JjID0gJnBsYW5lX3N0YXRlLT51YXBpLnNyYzsKIAl1MzIgc3JjX3gsIHNyY195LCBzcmNf
dywgc3JjX2gsIGhzdWIsIHZzdWI7CiAJYm9vbCByb3RhdGVkID0gZHJtX3JvdGF0aW9uXzkwX29y
XzI3MChwbGFuZV9zdGF0ZS0+aHcucm90YXRpb24pOwogCkBAIC0zMjgsNyArMzI4LDcgQEAgc2ts
X3BsYW5lX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCQl1bnNpZ25l
ZCBpbnQgKm51bSwgdW5zaWduZWQgaW50ICpkZW4pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT51
YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmh3LmZiOwogCiAJaWYgKGZiLT5mb3JtYXQtPmNwcFswXSA9PSA4KSB7CkBAIC0z
NDgsNyArMzQ4LDcgQEAgc2tsX3BsYW5lX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIGludCBza2xfcGxhbmVfbWluX2NkY2xrKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lLT5kZXYpOwogCXVuc2lnbmVkIGludCBwaXhlbF9yYXRlID0gY3J0Y19zdGF0
ZS0+cGl4ZWxfcmF0ZTsKIAl1bnNpZ25lZCBpbnQgc3JjX3csIHNyY19oLCBkc3RfdywgZHN0X2g7
CiAJdW5zaWduZWQgaW50IG51bSwgZGVuOwpAQCAtMzU5LDEwICszNTksMTAgQEAgc3RhdGljIGlu
dCBza2xfcGxhbmVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpKQogCQlkZW4gKj0gMjsKIAotCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5l
X3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0Jc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5l
X3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPmJhc2UuZHN0KTsKLQlkc3RfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUt
PmJhc2UuZHN0KTsKKwlzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMpID4+IDE2OworCXNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMpID4+IDE2OworCWRzdF93ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRz
dCk7CisJZHN0X2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAK
IAkvKiBEb3duc2NhbGluZyBsaW1pdHMgdGhlIG1heGltdW0gcGl4ZWwgcmF0ZSAqLwogCWRzdF93
ID0gbWluKHNyY193LCBkc3Rfdyk7CkBAIC00MDEsMTkgKzQwMSwxOSBAQCBza2xfcHJvZ3JhbV9z
Y2FsZXIoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlpbnQgc2NhbGVyX2lkID0gcGxhbmVf
c3RhdGUtPnNjYWxlcl9pZDsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfc2NhbGVyICpzY2FsZXIgPQog
CQkmY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlLnNjYWxlcnNbc2NhbGVyX2lkXTsKLQlpbnQgY3J0
Y194ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0
ZS0+YmFzZS5kc3QueTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0
ZS0+YmFzZS5kc3QpOwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRl
LT5iYXNlLmRzdCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKKwlp
bnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCXUzMiBjcnRjX3cgPSBkcm1f
cmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1MzIgY3J0Y19oID0gZHJtX3Jl
Y3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUxNiB5X2hwaGFzZSwgdXZfcmdi
X2hwaGFzZTsKIAl1MTYgeV92cGhhc2UsIHV2X3JnYl92cGhhc2U7CiAJaW50IGhzY2FsZSwgdnNj
YWxlOwogCi0JaHNjYWxlID0gZHJtX3JlY3RfY2FsY19oc2NhbGUoJnBsYW5lX3N0YXRlLT5iYXNl
LnNyYywKLQkJCQkgICAgICAmcGxhbmVfc3RhdGUtPmJhc2UuZHN0LAorCWhzY2FsZSA9IGRybV9y
ZWN0X2NhbGNfaHNjYWxlKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMsCisJCQkJICAgICAgJnBsYW5l
X3N0YXRlLT51YXBpLmRzdCwKIAkJCQkgICAgICAwLCBJTlRfTUFYKTsKLQl2c2NhbGUgPSBkcm1f
cmVjdF9jYWxjX3ZzY2FsZSgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjLAotCQkJCSAgICAgICZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QsCisJdnNjYWxlID0gZHJtX3JlY3RfY2FsY192c2NhbGUoJnBsYW5l
X3N0YXRlLT51YXBpLnNyYywKKwkJCQkgICAgICAmcGxhbmVfc3RhdGUtPnVhcGkuZHN0LAogCQkJ
CSAgICAgIDAsIElOVF9NQVgpOwogCiAJLyogVE9ETzogaGFuZGxlIHN1Yi1waXhlbCBjb29yZGlu
YXRlcyAqLwpAQCAtNTg0LDEyICs1ODQsMTIgQEAgc2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSwKIAl1MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW2NvbG9yX3BsYW5lXS5vZmZzZXQ7CiAJdTMyIHN0cmlkZSA9IHNrbF9wbGFuZV9zdHJpZGUo
cGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKIAl1MzIgYXV4X3N0cmlkZSA9IHNrbF9wbGFuZV9z
dHJpZGUocGxhbmVfc3RhdGUsIDEpOwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5k
c3QueDE7Ci0JaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC55MTsKKwlpbnQgY3J0
Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0
ZS0+dWFwaS5kc3QueTE7CiAJdTMyIHggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3Jf
cGxhbmVdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVd
Lnk7Ci0JdTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykg
Pj4gMTY7Ci0JdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5z
cmMpID4+IDE2OworCXUzMiBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMpID4+IDE2OworCXUzMiBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjKSA+PiAxNjsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmxpbmtlZCA9IHBsYW5lX3N0
YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXU4IGFscGhhID0gcGxhbmVfc3RhdGUtPmh3LmFs
cGhhID4+IDg7CkBAIC03NjYsNyArNzY2LDcgQEAgc3RhdGljIHZvaWQgaTl4eF9wbGFuZV9saW5l
YXJfZ2FtbWEodTE2IGdhbW1hWzhdKQogc3RhdGljIHZvaWQKIGNodl91cGRhdGVfY3NjKGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsK
KwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUt
PnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlk
OwpAQCAtODI1LDcgKzgyNSw3IEBAIGNodl91cGRhdGVfY3NjKGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiBzdGF0aWMgdm9pZAogdmx2X3VwZGF0ZV9jbHJjKGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5l
KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwpA
QCAtMTAxOSw3ICsxMDE5LDcgQEAgc3RhdGljIHUzMiB2bHZfc3ByaXRlX2N0bChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIHZvaWQgdmx2X3VwZGF0
ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewot
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5l
KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFu
ZS0+cGlwZTsKQEAgLTEwNTMsMTAgKzEwNTMsMTAgQEAgdmx2X3VwZGF0ZV9wbGFuZShzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lLAogCXUzMiBzcHJzdXJmX29mZnNldCA9IHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVswXS5vZmZzZXQ7CiAJdTMyIGxpbmVhcl9vZmZzZXQ7CiAJY29uc3Qgc3RydWN0
IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKLQlp
bnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QueTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QpOwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5l
X3N0YXRlLT5iYXNlLmRzdCk7CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54
MTsKKwlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCXUzMiBjcnRjX3cg
PSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1MzIgY3J0Y19oID0g
ZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUzMiB4ID0gcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lWzBdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxh
bmVbMF0ueTsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwpAQCAtMTI0NSw4ICsxMjQ1LDggQEAg
c3RhdGljIGludCBpdmJfc3ByaXRlX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAkgKi8KIAlwaXhlbF9yYXRlID0gY3J0Y19zdGF0ZS0+cGl4ZWxf
cmF0ZTsKIAotCXNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykg
Pj4gMTY7Ci0JZHN0X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsK
KwlzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2Owor
CWRzdF93ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAKIAlpZiAo
c3JjX3cgIT0gZHN0X3cpCiAJCWl2Yl9wbGFuZV9yYXRpb19zY2FsaW5nKGNydGNfc3RhdGUsIHBs
YW5lX3N0YXRlLCAmbnVtLCAmZGVuKTsKQEAgLTEzMjAsNyArMTMyMCw3IEBAIHN0YXRpYyB1MzIg
aXZiX3Nwcml0ZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIHN0YXRpYyBib29sIGl2Yl9uZWVkX3Nwcml0ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7CisJ
CXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CiAJY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAKIAlyZXR1cm4gZmItPmZv
cm1hdC0+Y3BwWzBdID09IDggJiYKQEAgLTEzMzEsNyArMTMzMSw3IEBAIHN0YXRpYyB1MzIgaXZi
X3Nwcml0ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+
YmFzZS5wbGFuZS0+ZGV2KTsKKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2
KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5m
YjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJ
Y29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0
ZS0+Y2tleTsKQEAgLTE0MjIsNyArMTQyMiw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9zcHJpdGVfbGlu
ZWFyX2dhbW1hKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAK
IHN0YXRpYyB2b2lkIGl2Yl91cGRhdGVfZ2FtbWEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50
ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwog
CWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CiAJdTE2IGdhbW1hWzE4XTsKQEAgLTE0NjEs
MTQgKzE0NjEsMTQgQEAgaXZiX3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
LAogCXUzMiBzcHJzdXJmX29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZz
ZXQ7CiAJdTMyIGxpbmVhcl9vZmZzZXQ7CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVf
Y29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKLQlpbnQgY3J0Y194ID0gcGxhbmVf
c3RhdGUtPmJhc2UuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+YmFzZS5kc3Qu
eTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3Qp
OwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7
CisJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKKwlpbnQgY3J0Y195ID0g
cGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCXUzMiBjcnRjX3cgPSBkcm1fcmVjdF93aWR0aCgm
cGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwl1MzIgY3J0Y19oID0gZHJtX3JlY3RfaGVpZ2h0KCZw
bGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUzMiB4ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
WzBdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueTsKLQl1MzIgc3Jj
X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKLQl1MzIg
c3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CisJ
dTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7
CisJdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+
IDE2OwogCXUzMiBzcHJjdGwsIHNwcnNjYWxlID0gMDsKIAl1bnNpZ25lZCBsb25nIGlycWZsYWdz
OwogCkBAIC0xNTgxLDggKzE1ODEsOCBAQCBzdGF0aWMgaW50IGc0eF9zcHJpdGVfbWluX2NkY2xr
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXBpeGVsX3JhdGUg
PSBjcnRjX3N0YXRlLT5waXhlbF9yYXRlOwogCiAJLyogSG9yaXpvbnRhbCBkb3duc2NhbGluZyBs
aW1pdHMgdGhlIG1heGltdW0gcGl4ZWwgcmF0ZSAqLwotCWhzY2FsZSA9IGRybV9yZWN0X2NhbGNf
aHNjYWxlKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMsCi0JCQkJICAgICAgJnBsYW5lX3N0YXRlLT5i
YXNlLmRzdCwKKwloc2NhbGUgPSBkcm1fcmVjdF9jYWxjX2hzY2FsZSgmcGxhbmVfc3RhdGUtPnVh
cGkuc3JjLAorCQkJCSAgICAgICZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QsCiAJCQkJICAgICAgMCwg
SU5UX01BWCk7CiAJaWYgKGhzY2FsZSA8IDB4MTAwMDApCiAJCXJldHVybiBwaXhlbF9yYXRlOwpA
QCAtMTYzNiw3ICsxNjM2LDcgQEAgc3RhdGljIHUzMiBnNHhfc3ByaXRlX2N0bChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPQotCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOworCQl0
b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCByb3Rh
dGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVs
X3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwpAQCAtMTY5OSw3ICsx
Njk5LDcgQEAgc3RhdGljIHUzMiBnNHhfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIHZvaWQgZzR4X3VwZGF0ZV9nYW1tYShjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7
CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKQEAg
LTE3MzEsNyArMTczMSw3IEBAIHN0YXRpYyB2b2lkIGlsa19zcHJpdGVfbGluZWFyX2dhbW1hKHUx
NiBnYW1tYVsxN10pCiAKIHN0YXRpYyB2b2lkIGlsa191cGRhdGVfZ2FtbWEoY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5w
bGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFu
ZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmh3LmZiOwogCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CkBAIC0xNzY3LDE0
ICsxNzY3LDE0IEBAIGc0eF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwK
IAl1MzIgZHZzc3VyZl9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0
OwogCXUzMiBsaW5lYXJfb2Zmc2V0OwogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2Nv
bG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7Ci0JaW50IGNydGNfeCA9IHBsYW5lX3N0
YXRlLT5iYXNlLmRzdC54MTsKLQlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPmJhc2UuZHN0Lnkx
OwotCXUzMiBjcnRjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsK
LQl1MzIgY3J0Y19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpOwor
CWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CisJaW50IGNydGNfeSA9IHBs
YW5lX3N0YXRlLT51YXBpLmRzdC55MTsKKwl1MzIgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBs
YW5lX3N0YXRlLT51YXBpLmRzdCk7CisJdTMyIGNydGNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxh
bmVfc3RhdGUtPnVhcGkuZHN0KTsKIAl1MzIgeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsw
XS54OwogCXUzMiB5ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnk7Ci0JdTMyIHNyY193
ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7Ci0JdTMyIHNy
Y19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OworCXUz
MiBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2Owor
CXUzMiBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAx
NjsKIAl1MzIgZHZzY250ciwgZHZzc2NhbGUgPSAwOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7
CiAKQEAgLTE4ODgsOCArMTg4OCw4IEBAIGc0eF9zcHJpdGVfY2hlY2tfc2NhbGluZyhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
cGxhbmVfc3RhdGUtPmh3LmZiOwotCWNvbnN0IHN0cnVjdCBkcm1fcmVjdCAqc3JjID0gJnBsYW5l
X3N0YXRlLT5iYXNlLnNyYzsKLQljb25zdCBzdHJ1Y3QgZHJtX3JlY3QgKmRzdCA9ICZwbGFuZV9z
dGF0ZS0+YmFzZS5kc3Q7CisJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpzcmMgPSAmcGxhbmVfc3Rh
dGUtPnVhcGkuc3JjOworCWNvbnN0IHN0cnVjdCBkcm1fcmVjdCAqZHN0ID0gJnBsYW5lX3N0YXRl
LT51YXBpLmRzdDsKIAlpbnQgc3JjX3gsIHNyY193LCBzcmNfaCwgY3J0Y193LCBjcnRjX2g7CiAJ
Y29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQogCQkmY3J0Y19z
dGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKQEAgLTE5NDgsNyArMTk0OCw3IEBAIHN0YXRpYyBpbnQK
IGc0eF9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CSBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7
CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHBsYW5lLT5iYXNlLmRldik7CiAJaW50IG1pbl9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJf
Tk9fU0NBTElORzsKIAlpbnQgbWF4X3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5H
OwpAQCAtMTk2NCw3ICsxOTY0LDcgQEAgZzR4X3Nwcml0ZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJfQogCX0KIAotCXJldCA9IGRybV9hdG9taWNfaGVscGVy
X2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+YmFzZSwKKwlyZXQgPSBkcm1fYXRvbWlj
X2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPnVhcGksCiAJCQkJCQkgICZj
cnRjX3N0YXRlLT51YXBpLAogCQkJCQkJICBtaW5fc2NhbGUsIG1heF9zY2FsZSwKIAkJCQkJCSAg
dHJ1ZSwgdHJ1ZSk7CkBAIC0xOTc1LDcgKzE5NzUsNyBAQCBnNHhfc3ByaXRlX2NoZWNrKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQlpZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9zdGF0ZS0+
dWFwaS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIAogCXJldCA9IGludGVsX3BsYW5lX2NoZWNrX3Ny
Y19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSk7CkBAIC0xOTk2LDcgKzE5OTYsNyBAQCBnNHhfc3By
aXRlX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiBpbnQgY2h2
X3BsYW5lX2NoZWNrX3JvdGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5l
KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0g
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAl1bnNpZ25l
ZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAKQEAgLTIwMjEsNyAr
MjAyMSw3IEBAIHZsdl9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9IGRybV9hdG9taWNfaGVs
cGVyX2NoZWNrX3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+YmFzZSwKKwlyZXQgPSBkcm1fYXRv
bWljX2hlbHBlcl9jaGVja19wbGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPnVhcGksCiAJCQkJCQkg
ICZjcnRjX3N0YXRlLT51YXBpLAogCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcs
CiAJCQkJCQkgIERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORywKQEAgLTIwMzMsNyArMjAzMyw3
IEBAIHZsdl9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2Uudmlz
aWJsZSkKKwlpZiAoIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJ
cmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKQEAg
LTIwNDgsNyArMjA0OCw3IEBAIHZsdl9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxh
bmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUt
PmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90
YXRpb247CkBAIC0yMTIzLDkgKzIxMjMsOSBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19k
c3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfcwogCQkJ
CQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUt
PmJhc2UucGxhbmUtPmRldik7Ci0JaW50IGNydGNfeCA9IHBsYW5lX3N0YXRlLT5iYXNlLmRzdC54
MTsKLQlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7
CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CisJaW50IGNydGNfeCA9
IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKKwlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAJaW50IHBpcGVfc3JjX3cgPSBjcnRjX3N0YXRlLT5w
aXBlX3NyY193OwogCiAJLyoKQEAgLTIxNTMsNyArMjE1Myw3IEBAIHN0YXRpYyBpbnQgc2tsX3Bs
YW5lX2NoZWNrX252MTJfcm90YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zCiB7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0
aW9uOwotCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMp
ID4+IDE2OworCWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMpID4+IDE2OwogCiAJLyogRGlzcGxheSBXQSAjMTEwNiAqLwogCWlmIChkcm1fZm9ybWF0X2lu
Zm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCkgJiYgc3JjX3cgJiAzICYmCkBAIC0yMTg1
LDcgKzIxODUsNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9tYXhfc2NhbGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7
CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7
CiAJaW50IG1pbl9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKQEAgLTIyMDIs
NyArMjIwMiw3IEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCQltYXhfc2NhbGUgPSBza2xfcGxhbmVfbWF4X3NjYWxlKGRl
dl9wcml2LCBmYik7CiAJfQogCi0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVf
c3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNlLAorCXJldCA9IGRybV9hdG9taWNfaGVscGVyX2NoZWNr
X3BsYW5lX3N0YXRlKCZwbGFuZV9zdGF0ZS0+dWFwaSwKIAkJCQkJCSAgJmNydGNfc3RhdGUtPnVh
cGksCiAJCQkJCQkgIG1pbl9zY2FsZSwgbWF4X3NjYWxlLAogCQkJCQkJICB0cnVlLCB0cnVlKTsK
QEAgLTIyMTMsNyArMjIxMyw3IEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAK
LQlpZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCisJaWYgKCFwbGFuZV9zdGF0ZS0+dWFw
aS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIAogCXJldCA9IHNrbF9wbGFuZV9jaGVja19kc3RfY29v
cmRpbmF0ZXMoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwpAQCAtMjIzMCw3ICsyMjMwLDcgQEAg
c3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAKIAkvKiBIVyBvbmx5IGhhcyA4IGJpdHMgcGl4ZWwgcHJlY2lzaW9uLCBkaXNhYmxl
IHBsYW5lIGlmIGludmlzaWJsZSAqLwogCWlmICghKHBsYW5lX3N0YXRlLT5ody5hbHBoYSA+PiA4
KSkKLQkJcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IGZhbHNlOworCQlwbGFuZV9zdGF0ZS0+
dWFwaS52aXNpYmxlID0gZmFsc2U7CiAKIAlwbGFuZV9zdGF0ZS0+Y3RsID0gc2tsX3BsYW5lX2N0
bChjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAKQEAgLTIyNDksNyArMjI0OSw3IEBAIHN0YXRp
YyBib29sIGhhc19kc3Rfa2V5X2luX3ByaW1hcnlfcGxhbmUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogc3RhdGljIHZvaWQgaW50ZWxfcGxhbmVfc2V0X2NrZXkoc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCQkgY29uc3Qgc3RydWN0IGRybV9pbnRl
bF9zcHJpdGVfY29sb3JrZXkgKnNldCkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0g
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5k
ZXYpOwogCXN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3Rh
dGUtPmNrZXk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IDBhMDEwM2VjZjdiYy4uMmQz
ODllNDM3ZTg3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTc4Niw3ICs3ODYsNyBAQCBz
dGF0aWMgaW50IGludGVsX3dtX251bV9sZXZlbHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogc3RhdGljIGJvb2wgaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUg
PSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsK
IAogCS8qIEZJWE1FIGNoZWNrIHRoZSAnZW5hYmxlJyBpbnN0ZWFkICovCiAJaWYgKCFjcnRjX3N0
YXRlLT5ody5hY3RpdmUpCkBAIC04MDMsNyArODAzLDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfd21f
cGxhbmVfdmlzaWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAlpZiAocGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUikKIAkJcmV0dXJuIHBsYW5lX3N0YXRlLT5o
dy5mYiAhPSBOVUxMOwogCWVsc2UKLQkJcmV0dXJuIHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGU7
CisJCXJldHVybiBwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlOwogfQogCiBzdGF0aWMgc3RydWN0
IGludGVsX2NydGMgKnNpbmdsZV9lbmFibGVkX2NydGMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQpAQCAtMTA3NSw3ICsxMDc1LDcgQEAgc3RhdGljIHUxNiBnNHhfY29tcHV0ZV93
bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCSAgaW50IGxldmVsKQog
ewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJY29uc3Qgc3RydWN0IGRybV9k
aXNwbGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQogCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKQEAgLTExMDgsNyArMTEwOCw3IEBAIHN0YXRpYyB1MTYgZzR4X2NvbXB1dGVfd20oY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY2xvY2sgPSBhZGp1c3Rl
ZF9tb2RlLT5jcnRjX2Nsb2NrOwogCWh0b3RhbCA9IGFkanVzdGVkX21vZGUtPmNydGNfaHRvdGFs
OwogCi0Jd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2UuZHN0KTsKKwl3
aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCiAJaWYgKHBs
YW5lLT5pZCA9PSBQTEFORV9DVVJTT1IpIHsKIAkJd20gPSBpbnRlbF93bV9tZXRob2QyKGNsb2Nr
LCBodG90YWwsIHdpZHRoLCBjcHAsIGxhdGVuY3kpOwpAQCAtMTE3NCw3ICsxMTc0LDcgQEAgc3Rh
dGljIHUzMiBpbGtfY29tcHV0ZV9mYmNfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiBzdGF0aWMgYm9vbCBnNHhfcmF3X3BsYW5lX3dtX2NvbXB1dGUoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5l
KTsKIAlpbnQgbnVtX2xldmVscyA9IGludGVsX3dtX251bV9sZXZlbHModG9faTkxNShwbGFuZS0+
YmFzZS5kZXYpKTsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCWJvb2wg
ZGlydHkgPSBmYWxzZTsKQEAgLTE1ODEsNyArMTU4MSw3IEBAIHN0YXRpYyB1MTYgdmx2X2NvbXB1
dGVfd21fbGV2ZWwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCQlpbnQg
bGV2ZWwpCiB7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBs
YW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1
Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CiAJCSZjcnRjX3N0YXRlLT5ody5h
ZGp1c3RlZF9tb2RlOwpAQCAtMTc1MSw3ICsxNzUxLDcgQEAgc3RhdGljIGJvb2wgdmx2X3Jhd19w
bGFuZV93bV9zZXQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMg
Ym9vbCB2bHZfcmF3X3BsYW5lX3dtX2NvbXB1dGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCiAJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRv
X2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKIAllbnVtIHBsYW5lX2lkIHBs
YW5lX2lkID0gcGxhbmUtPmlkOwogCWludCBudW1fbGV2ZWxzID0gaW50ZWxfd21fbnVtX2xldmVs
cyh0b19pOTE1KHBsYW5lLT5iYXNlLmRldikpOwogCWludCBsZXZlbDsKQEAgLTI0ODQsNyArMjQ4
NCw3IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfcHJpX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2QyKGNydGNf
c3RhdGUtPnBpeGVsX3JhdGUsCiAJCQkJIGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0
Y19odG90YWwsCi0JCQkJIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLAor
CQkJCSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwKIAkJCQkgY3BwLCBt
ZW1fdmFsdWUpOwogCiAJcmV0dXJuIG1pbihtZXRob2QxLCBtZXRob2QyKTsKQEAgLTI1MTIsNyAr
MjUxMiw3IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfc3ByX3dtKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCW1ldGhvZDEgPSBpbGtfd21fbWV0aG9kMShjcnRj
X3N0YXRlLT5waXhlbF9yYXRlLCBjcHAsIG1lbV92YWx1ZSk7CiAJbWV0aG9kMiA9IGlsa193bV9t
ZXRob2QyKGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCiAJCQkJIGNydGNfc3RhdGUtPmh3LmFkanVz
dGVkX21vZGUuY3J0Y19odG90YWwsCi0JCQkJIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+
YmFzZS5kc3QpLAorCQkJCSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwK
IAkJCQkgY3BwLCBtZW1fdmFsdWUpOwogCXJldHVybiBtaW4obWV0aG9kMSwgbWV0aG9kMik7CiB9
CkBAIC0yNTM3LDcgKzI1MzcsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX2N1cl93bShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogCXJldHVybiBpbGtfd21f
bWV0aG9kMihjcnRjX3N0YXRlLT5waXhlbF9yYXRlLAogCQkJICAgICAgY3J0Y19zdGF0ZS0+aHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX2h0b3RhbCwKLQkJCSAgICAgIGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+YmFzZS5kc3QpLAorCQkJICAgICAgZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT51YXBpLmRzdCksCiAJCQkgICAgICBjcHAsIG1lbV92YWx1ZSk7CiB9CiAKQEAgLTI1NTMsNyAr
MjU1Myw4IEBAIHN0YXRpYyB1MzIgaWxrX2NvbXB1dGVfZmJjX3dtKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJY3BwID0gcGxhbmVfc3RhdGUtPmh3LmZiLT5m
b3JtYXQtPmNwcFswXTsKIAotCXJldHVybiBpbGtfd21fZmJjKHByaV92YWwsIGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5kc3QpLCBjcHApOworCXJldHVybiBpbGtfd21fZmJjKHBy
aV92YWwsIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpLAorCQkJICBjcHAp
OwogfQogCiBzdGF0aWMgdW5zaWduZWQgaW50CkBAIC0zMDk3LDEwICszMDk4LDEwIEBAIHN0YXRp
YyBpbnQgaWxrX2NvbXB1dGVfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIAogCXBpcGVfd20tPnBpcGVfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmh3LmFjdGl2ZTsK
IAlpZiAoc3Byc3RhdGUpIHsKLQkJcGlwZV93bS0+c3ByaXRlc19lbmFibGVkID0gc3Byc3RhdGUt
PmJhc2UudmlzaWJsZTsKLQkJcGlwZV93bS0+c3ByaXRlc19zY2FsZWQgPSBzcHJzdGF0ZS0+YmFz
ZS52aXNpYmxlICYmCi0JCQkoZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT5iYXNlLmRzdCkgIT0g
ZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT5iYXNlLnNyYykgPj4gMTYgfHwKLQkJCSBkcm1fcmVj
dF9oZWlnaHQoJnNwcnN0YXRlLT5iYXNlLmRzdCkgIT0gZHJtX3JlY3RfaGVpZ2h0KCZzcHJzdGF0
ZS0+YmFzZS5zcmMpID4+IDE2KTsKKwkJcGlwZV93bS0+c3ByaXRlc19lbmFibGVkID0gc3Byc3Rh
dGUtPnVhcGkudmlzaWJsZTsKKwkJcGlwZV93bS0+c3ByaXRlc19zY2FsZWQgPSBzcHJzdGF0ZS0+
dWFwaS52aXNpYmxlICYmCisJCQkoZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT51YXBpLmRzdCkg
IT0gZHJtX3JlY3Rfd2lkdGgoJnNwcnN0YXRlLT51YXBpLnNyYykgPj4gMTYgfHwKKwkJCSBkcm1f
cmVjdF9oZWlnaHQoJnNwcnN0YXRlLT51YXBpLmRzdCkgIT0gZHJtX3JlY3RfaGVpZ2h0KCZzcHJz
dGF0ZS0+dWFwaS5zcmMpID4+IDE2KTsKIAl9CiAKIAl1c2FibGVfbGV2ZWwgPSBtYXhfbGV2ZWw7
CkBAIC00MDcyLDEwICs0MDczLDEwIEBAIHNrbF9wbGFuZV9kb3duc2NhbGVfYW1vdW50KGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAqCiAJICogbi5iLiwgc3Jj
IGlzIDE2LjE2IGZpeGVkIHBvaW50LCBkc3QgaXMgd2hvbGUgaW50ZWdlci4KIAkgKi8KLQlzcmNf
dyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCXNyY19o
ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpID4+IDE2OwotCWRzdF93
ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7Ci0JZHN0X2ggPSBkcm1f
cmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT5iYXNlLmRzdCk7CisJc3JjX3cgPSBkcm1fcmVjdF93
aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwlzcmNfaCA9IGRybV9yZWN0X2hl
aWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwlkc3RfdyA9IGRybV9yZWN0X3dp
ZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOworCWRzdF9oID0gZHJtX3JlY3RfaGVpZ2h0KCZw
bGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCiAJZnBfd19yYXRpbyA9IGRpdl9maXhlZDE2KHNyY193
LCBkc3Rfdyk7CiAJZnBfaF9yYXRpbyA9IGRpdl9maXhlZDE2KHNyY19oLCBkc3RfaCk7CkBAIC00
MDkwLDE0ICs0MDkxLDE0IEBAIHNrbF9wbGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJCQkgICAgIGludCBjb2xvcl9wbGFuZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9w
bGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdTMyIGRhdGFfcmF0ZTsKIAl1MzIgd2lk
dGggPSAwLCBoZWlnaHQgPSAwOwogCXVpbnRfZml4ZWRfMTZfMTZfdCBkb3duX3NjYWxlX2Ftb3Vu
dDsKIAl1NjQgcmF0ZTsKIAotCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKKwlpZiAo
IXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUpCiAJCXJldHVybiAwOwogCiAJaWYgKHBsYW5lLT5p
ZCA9PSBQTEFORV9DVVJTT1IpCkBAIC00MTEyLDggKzQxMTMsOCBAQCBza2xfcGxhbmVfcmVsYXRp
dmVfZGF0YV9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CSAqIHRoZSA5MC8yNzAgZGVncmVlIHBsYW5lIHJvdGF0aW9uIGNhc2VzICh0byBtYXRjaCB0aGUK
IAkgKiBHVFQgbWFwcGluZyksIGhlbmNlIG5vIG5lZWQgdG8gYWNjb3VudCBmb3Igcm90YXRpb24g
aGVyZS4KIAkgKi8KLQl3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5z
cmMpID4+IDE2OwotCWhlaWdodCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uu
c3JjKSA+PiAxNjsKKwl3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMpID4+IDE2OworCWhlaWdodCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGku
c3JjKSA+PiAxNjsKIAogCS8qIFVWIHBsYW5lIGRvZXMgMS8yIHBpeGVsIHN1Yi1zYW1wbGluZyAq
LwogCWlmIChjb2xvcl9wbGFuZSA9PSAxKSB7CkBAIC00NjIwLDcgKzQ2MjEsNyBAQCBza2xfY29t
cHV0ZV9wbGFuZV93bV9wYXJhbXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJICogdGhlIDkwLzI3MCBkZWdyZWUgcGxhbmUgcm90YXRpb24gY2FzZXMgKHRvIG1h
dGNoIHRoZQogCSAqIEdUVCBtYXBwaW5nKSwgaGVuY2Ugbm8gbmVlZCB0byBhY2NvdW50IGZvciBy
b3RhdGlvbiBoZXJlLgogCSAqLwotCXdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRl
LT5iYXNlLnNyYykgPj4gMTY7CisJd2lkdGggPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjKSA+PiAxNjsKIAogCXJldHVybiBza2xfY29tcHV0ZV93bV9wYXJhbXMoY3J0Y19z
dGF0ZSwgd2lkdGgsCiAJCQkJICAgICBmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIsCkBAIC00OTAy
LDcgKzQ5MDMsNyBAQCBzdGF0aWMgaW50IHNrbF9idWlsZF9wbGFuZV93bV91dihzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0YXRpYyBpbnQgc2tsX2J1aWxkX3BsYW5lX3dt
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAgY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOworCXN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFw
aS5wbGFuZSk7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAlpbnQgcmV0
OwpAQCAtNDkyOCw3ICs0OTI5LDcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd20oc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiBzdGF0aWMgaW50IGljbF9idWlsZF9w
bGFuZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JZW51bSBwbGFu
ZV9pZCBwbGFuZV9pZCA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKS0+
aWQ7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRl
LT51YXBpLnBsYW5lKS0+aWQ7CiAJaW50IHJldDsKIAogCS8qIFdhdGVybWFya3MgY2FsY3VsYXRl
ZCBpbiBtYXN0ZXIgKi8KQEAgLTU5MjgsNyArNTkyOSw3IEBAIHZvaWQgZzR4X3dtX3Nhbml0aXpl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZCA9IHBsYW5lLT5pZDsKIAkJaW50IGxldmVsOwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+YmFz
ZS52aXNpYmxlKQorCQlpZiAocGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSkKIAkJCWNvbnRpbnVl
OwogCiAJCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8IDM7IGxldmVsKyspIHsKQEAgLTYwODMsNyAr
NjA4NCw3IEBAIHZvaWQgdmx2X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAkJaW50IGxl
dmVsOwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQorCQlpZiAocGxhbmVfc3Rh
dGUtPnVhcGkudmlzaWJsZSkKIAkJCWNvbnRpbnVlOwogCiAJCWZvciAobGV2ZWwgPSAwOyBsZXZl
bCA8IHdtX3N0YXRlLT5udW1fbGV2ZWxzOyBsZXZlbCsrKSB7Ci0tIAoyLjI0LjAucmMxCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5EC2A3AF7A
	for <lists+intel-gfx@lfdr.de>; Mon, 10 Jun 2019 09:21:43 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 554AF8910D;
	Mon, 10 Jun 2019 07:21:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D513988FA4
 for <intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 07:21:35 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16848378-1500050 
 for multiple; Mon, 10 Jun 2019 08:21:31 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 10 Jun 2019 08:21:23 +0100
Message-Id: <20190610072126.6355-26-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190610072126.6355-1-chris@chris-wilson.co.uk>
References: <20190610072126.6355-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 25/28] drm/i915: Pull kref into
 i915_address_space
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSB0aGUga3JlZiBjb21tb24gdG8gYm90aCBkZXJpdmVkIHN0cnVjdHMgKGk5MTVfZ2d0dCBh
bmQgaTkxNV9wcGd0dCkKc28gdGhhdCB3ZSBjYW4gc2FmZWx5IHJlZmVyZW5jZSBjb3VudCBhbiBh
YnN0cmFjdCBjdHgtPnZtIGFkZHJlc3Mgc3BhY2UuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8
bWF0dGhldy5hdWxkQGludGVsLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jbGllbnRfYmx0LmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jb250ZXh0LmMgICB8IDEzMiArKysrKysrKystLS0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaCB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgICA0ICstCiAuLi4vZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3RfYmx0LmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMgICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYyAgIHwgIDI2ICsrLS0KIC4uLi9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAzNiArKystLQogLi4uL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAgIDkgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyAgICB8ICAyNiArKy0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyAgfCAgIDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndnQvc2NoZWR1bGVyLmMgICAgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jICAgICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICA2IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jICAgICAgICAgICB8ICAzMyArKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZ3R0LmggICAgICAgICAgIHwgIDI3ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ3B1X2Vycm9yLmMgICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV90cmFjZS5oICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfdm1hLmMgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaWd0X3NwaW5uZXIuYyAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9tb2NrX2d0dC5jICAgICB8ICAgMSAtCiAyNiBmaWxlcyBjaGFuZ2VkLCAxODcgaW5zZXJ0
aW9ucygrKSwgMTkxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IDQ4OTljYTFkZDc2Yy4uZjI1M2VjNTc2NWFkIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKQEAg
LTI1MCwxMyArMjUwLDExIEBAIGludCBpOTE1X2dlbV9zY2hlZHVsZV9maWxsX3BhZ2VzX2JsdChz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4ID0gY2UtPmdlbV9jb250ZXh0OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+
Z2d0dC52bTsKIAlzdHJ1Y3QgY2xlYXJfcGFnZXNfd29yayAqd29yazsKIAlzdHJ1Y3QgaTkxNV9z
bGVldmUgKnNsZWV2ZTsKIAlpbnQgZXJyOwogCi0Jdm0gPSBjdHgtPnBwZ3R0ID8gJmN0eC0+cHBn
dHQtPnZtIDogJmk5MTUtPmdndHQudm07Ci0KIAlzbGVldmUgPSBjcmVhdGVfc2xlZXZlKHZtLCBv
YmosIHBhZ2VzLCBwYWdlX3NpemVzKTsKIAlpZiAoSVNfRVJSKHNsZWV2ZSkpCiAJCXJldHVybiBQ
VFJfRVJSKHNsZWV2ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuYwppbmRleCAyZTY4NGY4MTUxZDkuLjM0MjQwN2VjMDExOSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC0zMDksNyArMzA5LDggQEAgc3RhdGlj
IHZvaWQgaTkxNV9nZW1fY29udGV4dF9mcmVlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgp
CiAJR0VNX0JVR19PTighaTkxNV9nZW1fY29udGV4dF9pc19jbG9zZWQoY3R4KSk7CiAKIAlyZWxl
YXNlX2h3X2lkKGN0eCk7Ci0JaTkxNV9wcGd0dF9wdXQoY3R4LT5wcGd0dCk7CisJaWYgKGN0eC0+
dm0pCisJCWk5MTVfdm1fcHV0KGN0eC0+dm0pOwogCiAJZnJlZV9lbmdpbmVzKHJjdV9hY2Nlc3Nf
cG9pbnRlcihjdHgtPmVuZ2luZXMpKTsKIAltdXRleF9kZXN0cm95KCZjdHgtPmVuZ2luZXNfbXV0
ZXgpOwpAQCAtMzk3LDcgKzM5OCw3IEBAIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIH0KIAogc3RhdGljIHUzMiBkZWZhdWx0X2Rlc2NfdGVt
cGxhdGUoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCQkJIGNvbnN0IHN0
cnVjdCBpOTE1X2h3X3BwZ3R0ICpwcGd0dCkKKwkJCQkgY29uc3Qgc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0pCiB7CiAJdTMyIGFkZHJlc3NfbW9kZTsKIAl1MzIgZGVzYzsKQEAgLTQwNSw3
ICs0MDYsNyBAQCBzdGF0aWMgdTMyIGRlZmF1bHRfZGVzY190ZW1wbGF0ZShjb25zdCBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlkZXNjID0gR0VOOF9DVFhfVkFMSUQgfCBHRU44X0NU
WF9QUklWSUxFR0U7CiAKIAlhZGRyZXNzX21vZGUgPSBJTlRFTF9MRUdBQ1lfMzJCX0NPTlRFWFQ7
Ci0JaWYgKHBwZ3R0ICYmIGk5MTVfdm1faXNfNGx2bCgmcHBndHQtPnZtKSkKKwlpZiAodm0gJiYg
aTkxNV92bV9pc180bHZsKHZtKSkKIAkJYWRkcmVzc19tb2RlID0gSU5URUxfTEVHQUNZXzY0Ql9D
T05URVhUOwogCWRlc2MgfD0gYWRkcmVzc19tb2RlIDw8IEdFTjhfQ1RYX0FERFJFU1NJTkdfTU9E
RV9TSElGVDsKIApAQCAtNDIxLDcgKzQyMiw3IEBAIHN0YXRpYyB1MzIgZGVmYXVsdF9kZXNjX3Rl
bXBsYXRlKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogfQogCiBzdGF0aWMg
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgotX19jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitfX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0
IGk5MTVfZ2VtX2VuZ2luZXMgKmU7CkBAIC00MzMsOCArNDM0LDggQEAgX19jcmVhdGVfY29udGV4
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCXJldHVybiBFUlJfUFRSKC1F
Tk9NRU0pOwogCiAJa3JlZl9pbml0KCZjdHgtPnJlZik7Ci0JbGlzdF9hZGRfdGFpbCgmY3R4LT5s
aW5rLCAmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QpOwotCWN0eC0+aTkxNSA9IGRldl9wcml2Owor
CWxpc3RfYWRkX3RhaWwoJmN0eC0+bGluaywgJmk5MTUtPmNvbnRleHRzLmxpc3QpOworCWN0eC0+
aTkxNSA9IGk5MTU7CiAJY3R4LT5zY2hlZC5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWShJ
OTE1X1BSSU9SSVRZX05PUk1BTCk7CiAJbXV0ZXhfaW5pdCgmY3R4LT5tdXRleCk7CiAKQEAgLTQ1
MiwxNCArNDUzLDE0IEBAIF9fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCS8qIE5COiBNYXJrIGFsbCBzbGljZXMgYXMgbmVlZGluZyBhIHJlbWFwIHNv
IHRoYXQgd2hlbiB0aGUgY29udGV4dCBmaXJzdAogCSAqIGxvYWRzIGl0IHdpbGwgcmVzdG9yZSB3
aGF0ZXZlciByZW1hcCBzdGF0ZSBhbHJlYWR5IGV4aXN0cy4gSWYgdGhlcmUKIAkgKiBpcyBubyBy
ZW1hcCBpbmZvLCBpdCB3aWxsIGJlIGEgTk9QLiAqLwotCWN0eC0+cmVtYXBfc2xpY2UgPSBBTExf
TDNfU0xJQ0VTKGRldl9wcml2KTsKKwljdHgtPnJlbWFwX3NsaWNlID0gQUxMX0wzX1NMSUNFUyhp
OTE1KTsKIAogCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Jhbm5hYmxlKGN0eCk7CiAJaTkxNV9nZW1f
Y29udGV4dF9zZXRfcmVjb3ZlcmFibGUoY3R4KTsKIAogCWN0eC0+cmluZ19zaXplID0gNCAqIFBB
R0VfU0laRTsKIAljdHgtPmRlc2NfdGVtcGxhdGUgPQotCQlkZWZhdWx0X2Rlc2NfdGVtcGxhdGUo
ZGV2X3ByaXYsIGRldl9wcml2LT5tbS5hbGlhc2luZ19wcGd0dCk7CisJCWRlZmF1bHRfZGVzY190
ZW1wbGF0ZShpOTE1LCAmaTkxNS0+bW0uYWxpYXNpbmdfcHBndHQtPnZtKTsKIAogCWZvciAoaSA9
IDA7IGkgPCBBUlJBWV9TSVpFKGN0eC0+aGFuZ190aW1lc3RhbXApOyBpKyspCiAJCWN0eC0+aGFu
Z190aW1lc3RhbXBbaV0gPSBqaWZmaWVzIC0gQ09OVEVYVF9GQVNUX0hBTkdfSklGRklFUzsKQEAg
LTQ3MSwyNiArNDcyLDI2IEBAIF9fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCXJldHVybiBFUlJfUFRSKGVycik7CiB9CiAKLXN0YXRpYyBzdHJ1Y3Qg
aTkxNV9od19wcGd0dCAqCi1fX3NldF9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
LCBzdHJ1Y3QgaTkxNV9od19wcGd0dCAqcHBndHQpCitzdGF0aWMgc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqCitfX3NldF9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHsKLQlzdHJ1Y3QgaTkxNV9od19wcGd0dCAqb2xk
ID0gY3R4LT5wcGd0dDsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICpvbGQgPSBjdHgtPnZt
OwogCi0JY3R4LT5wcGd0dCA9IGk5MTVfcHBndHRfZ2V0KHBwZ3R0KTsKLQljdHgtPmRlc2NfdGVt
cGxhdGUgPSBkZWZhdWx0X2Rlc2NfdGVtcGxhdGUoY3R4LT5pOTE1LCBwcGd0dCk7CisJY3R4LT52
bSA9IGk5MTVfdm1fZ2V0KHZtKTsKKwljdHgtPmRlc2NfdGVtcGxhdGUgPSBkZWZhdWx0X2Rlc2Nf
dGVtcGxhdGUoY3R4LT5pOTE1LCB2bSk7CiAKIAlyZXR1cm4gb2xkOwogfQogCiBzdGF0aWMgdm9p
ZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkJICAgc3Ry
dWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0KQorCQkJICAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0pCiB7Ci0JaWYgKHBwZ3R0ID09IGN0eC0+cHBndHQpCisJaWYgKHZtID09IGN0eC0+dm0p
CiAJCXJldHVybjsKIAotCXBwZ3R0ID0gX19zZXRfcHBndHQoY3R4LCBwcGd0dCk7Ci0JaWYgKHBw
Z3R0KQotCQlpOTE1X3BwZ3R0X3B1dChwcGd0dCk7CisJdm0gPSBfX3NldF9wcGd0dChjdHgsIHZt
KTsKKwlpZiAodm0pCisJCWk5MTVfdm1fcHV0KHZtKTsKIH0KIAogc3RhdGljIHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICoKQEAgLTUyMiw4ICs1MjMsOCBAQCBpOTE1X2dlbV9jcmVhdGVfY29udGV4
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHVuc2lnbmVkIGludCBmbGFncykK
IAkJCXJldHVybiBFUlJfQ0FTVChwcGd0dCk7CiAJCX0KIAotCQlfX2Fzc2lnbl9wcGd0dChjdHgs
IHBwZ3R0KTsKLQkJaTkxNV9wcGd0dF9wdXQocHBndHQpOworCQlfX2Fzc2lnbl9wcGd0dChjdHgs
ICZwcGd0dC0+dm0pOworCQlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIAl9CiAKIAlpZiAoZmxh
Z3MgJiBJOTE1X0NPTlRFWFRfQ1JFQVRFX0ZMQUdTX1NJTkdMRV9USU1FTElORSkgewpAQCAtNzEy
LDcgKzcxMyw3IEBAIHN0YXRpYyBpbnQgY29udGV4dF9pZHJfY2xlYW51cChpbnQgaWQsIHZvaWQg
KnAsIHZvaWQgKmRhdGEpCiAKIHN0YXRpYyBpbnQgdm1faWRyX2NsZWFudXAoaW50IGlkLCB2b2lk
ICpwLCB2b2lkICpkYXRhKQogewotCWk5MTVfcHBndHRfcHV0KHApOworCWk5MTVfdm1fcHV0KHAp
OwogCXJldHVybiAwOwogfQogCkBAIC03MjIsOCArNzIzLDggQEAgc3RhdGljIGludCBnZW1fY29u
dGV4dF9yZWdpc3RlcihzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCWludCByZXQ7CiAK
IAljdHgtPmZpbGVfcHJpdiA9IGZwcml2OwotCWlmIChjdHgtPnBwZ3R0KQotCQljdHgtPnBwZ3R0
LT52bS5maWxlID0gZnByaXY7CisJaWYgKGN0eC0+dm0pCisJCWN0eC0+dm0tPmZpbGUgPSBmcHJp
djsKIAogCWN0eC0+cGlkID0gZ2V0X3Rhc2tfcGlkKGN1cnJlbnQsIFBJRFRZUEVfUElEKTsKIAlj
dHgtPm5hbWUgPSBrYXNwcmludGYoR0ZQX0tFUk5FTCwgIiVzWyVkXSIsCkBAIC04MzMsNyArODM0
LDcgQEAgaW50IGk5MTVfZ2VtX3ZtX2NyZWF0ZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogCWlmIChlcnIpCiAJCWdvdG8gZXJyX3B1dDsKIAotCWVyciA9IGlkcl9h
bGxvYygmZmlsZV9wcml2LT52bV9pZHIsIHBwZ3R0LCAwLCAwLCBHRlBfS0VSTkVMKTsKKwllcnIg
PSBpZHJfYWxsb2MoJmZpbGVfcHJpdi0+dm1faWRyLCAmcHBndHQtPnZtLCAwLCAwLCBHRlBfS0VS
TkVMKTsKIAlpZiAoZXJyIDwgMCkKIAkJZ290byBlcnJfdW5sb2NrOwogCkBAIC04NDcsNyArODQ4
LDcgQEAgaW50IGk5MTVfZ2VtX3ZtX2NyZWF0ZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogZXJyX3VubG9jazoKIAltdXRleF91bmxvY2soJmZpbGVfcHJpdi0+dm1f
aWRyX2xvY2spOwogZXJyX3B1dDoKLQlpOTE1X3BwZ3R0X3B1dChwcGd0dCk7CisJaTkxNV92bV9w
dXQoJnBwZ3R0LT52bSk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtODU2LDcgKzg1Nyw3IEBAIGlu
dCBpOTE1X2dlbV92bV9kZXN0cm95X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQg
KmRhdGEsCiB7CiAJc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0gZmls
ZS0+ZHJpdmVyX3ByaXY7CiAJc3RydWN0IGRybV9pOTE1X2dlbV92bV9jb250cm9sICphcmdzID0g
ZGF0YTsKLQlzdHJ1Y3QgaTkxNV9od19wcGd0dCAqcHBndHQ7CisJc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm07CiAJaW50IGVycjsKIAl1MzIgaWQ7CiAKQEAgLTg3NCwxMyArODc1LDEzIEBA
IGludCBpOTE1X2dlbV92bV9kZXN0cm95X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsCiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCXBwZ3R0ID0gaWRyX3JlbW92
ZSgmZmlsZV9wcml2LT52bV9pZHIsIGlkKTsKKwl2bSA9IGlkcl9yZW1vdmUoJmZpbGVfcHJpdi0+
dm1faWRyLCBpZCk7CiAKIAltdXRleF91bmxvY2soJmZpbGVfcHJpdi0+dm1faWRyX2xvY2spOwot
CWlmICghcHBndHQpCisJaWYgKCF2bSkKIAkJcmV0dXJuIC1FTk9FTlQ7CiAKLQlpOTE1X3BwZ3R0
X3B1dChwcGd0dCk7CisJaTkxNV92bV9wdXQodm0pOwogCXJldHVybiAwOwogfQogCkBAIC05NzQs
MTAgKzk3NSwxMCBAQCBzdGF0aWMgaW50IGdldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9w
cml2YXRlICpmaWxlX3ByaXYsCiAJCSAgICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwK
IAkJICAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gKmFyZ3MpCiB7Ci0Jc3Ry
dWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0OworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
OwogCWludCByZXQ7CiAKLQlpZiAoIWN0eC0+cHBndHQpCisJaWYgKCFjdHgtPnZtKQogCQlyZXR1
cm4gLUVOT0RFVjsKIAogCS8qIFhYWCByY3UgYWNxdWlyZT8gKi8KQEAgLTk4NSwxOSArOTg2LDE5
IEBAIHN0YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZp
bGVfcHJpdiwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcHBndHQgPSBpOTE1X3BwZ3R0
X2dldChjdHgtPnBwZ3R0KTsKKwl2bSA9IGk5MTVfdm1fZ2V0KGN0eC0+dm0pOwogCW11dGV4X3Vu
bG9jaygmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldCA9IG11dGV4X2xvY2tf
aW50ZXJydXB0aWJsZSgmZmlsZV9wcml2LT52bV9pZHJfbG9jayk7CiAJaWYgKHJldCkKIAkJZ290
byBlcnJfcHV0OwogCi0JcmV0ID0gaWRyX2FsbG9jKCZmaWxlX3ByaXYtPnZtX2lkciwgcHBndHQs
IDAsIDAsIEdGUF9LRVJORUwpOworCXJldCA9IGlkcl9hbGxvYygmZmlsZV9wcml2LT52bV9pZHIs
IHZtLCAwLCAwLCBHRlBfS0VSTkVMKTsKIAlHRU1fQlVHX09OKCFyZXQpOwogCWlmIChyZXQgPCAw
KQogCQlnb3RvIGVycl91bmxvY2s7CiAKLQlpOTE1X3BwZ3R0X2dldChwcGd0dCk7CisJaTkxNV92
bV9nZXQodm0pOwogCiAJYXJncy0+c2l6ZSA9IDA7CiAJYXJncy0+dmFsdWUgPSByZXQ7CkBAIC0x
MDA2LDI5ICsxMDA3LDMwIEBAIHN0YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9m
aWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIGVycl91bmxvY2s6CiAJbXV0ZXhfdW5sb2NrKCZmaWxl
X3ByaXYtPnZtX2lkcl9sb2NrKTsKIGVycl9wdXQ6Ci0JaTkxNV9wcGd0dF9wdXQocHBndHQpOwor
CWk5MTVfdm1fcHV0KHZtKTsKIAlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZCBzZXRfcHBn
dHRfYmFycmllcih2b2lkICpkYXRhKQogewotCXN0cnVjdCBpOTE1X2h3X3BwZ3R0ICpvbGQgPSBk
YXRhOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKm9sZCA9IGRhdGE7CiAKLQlpZiAoSU5U
RUxfR0VOKG9sZC0+dm0uaTkxNSkgPCA4KQotCQlnZW42X3BwZ3R0X3VucGluX2FsbChvbGQpOwor
CWlmIChJTlRFTF9HRU4ob2xkLT5pOTE1KSA8IDgpCisJCWdlbjZfcHBndHRfdW5waW5fYWxsKGk5
MTVfdm1fdG9fcHBndHQob2xkKSk7CiAKLQlpOTE1X3BwZ3R0X3B1dChvbGQpOworCWk5MTVfdm1f
cHV0KG9sZCk7CiB9CiAKIHN0YXRpYyBpbnQgZW1pdF9wcGd0dF91cGRhdGUoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEsIHZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0
ID0gcnEtPmdlbV9jb250ZXh0LT5wcGd0dDsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bSA9IHJxLT5nZW1fY29udGV4dC0+dm07CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
ID0gcnEtPmVuZ2luZTsKIAl1MzIgYmFzZSA9IGVuZ2luZS0+bW1pb19iYXNlOwogCXUzMiAqY3M7
CiAJaW50IGk7CiAKLQlpZiAoaTkxNV92bV9pc180bHZsKCZwcGd0dC0+dm0pKSB7CisJaWYgKGk5
MTVfdm1faXNfNGx2bCh2bSkpIHsKKwkJc3RydWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0ID0gaTkx
NV92bV90b19wcGd0dCh2bSk7CiAJCWNvbnN0IGRtYV9hZGRyX3QgcGRfZGFkZHIgPSBweF9kbWEo
JnBwZ3R0LT5wbWw0KTsKIAogCQljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDYpOwpAQCAtMTA0
NSw2ICsxMDQ3LDggQEAgc3RhdGljIGludCBlbWl0X3BwZ3R0X3VwZGF0ZShzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkKIAkJKmNzKysgPSBNSV9OT09QOwogCQlpbnRlbF9yaW5n
X2FkdmFuY2UocnEsIGNzKTsKIAl9IGVsc2UgaWYgKEhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMo
ZW5naW5lLT5pOTE1KSkgeworCQlzdHJ1Y3QgaTkxNV9od19wcGd0dCAqcHBndHQgPSBpOTE1X3Zt
X3RvX3BwZ3R0KHZtKTsKKwogCQljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDQgKiBHRU44XzNM
VkxfUERQRVMgKyAyKTsKIAkJaWYgKElTX0VSUihjcykpCiAJCQlyZXR1cm4gUFRSX0VSUihjcyk7
CkBAIC0xMDYyLDcgKzEwNjYsNyBAQCBzdGF0aWMgaW50IGVtaXRfcHBndHRfdXBkYXRlKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLCB2b2lkICpkYXRhKQogCQlpbnRlbF9yaW5nX2FkdmFuY2UocnEs
IGNzKTsKIAl9IGVsc2UgewogCQkvKiBwcEdUVCBpcyBub3QgcGFydCBvZiB0aGUgbGVnYWN5IGNv
bnRleHQgaW1hZ2UgKi8KLQkJZ2VuNl9wcGd0dF9waW4ocHBndHQpOworCQlnZW42X3BwZ3R0X3Bp
bihpOTE1X3ZtX3RvX3BwZ3R0KHZtKSk7CiAJfQogCiAJcmV0dXJuIDA7CkBAIC0xMDgwLDEzICsx
MDg0LDEzIEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZh
dGUgKmZpbGVfcHJpdiwKIAkJICAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkg
ICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSAqYXJncykKIHsKLQlzdHJ1Y3Qg
aTkxNV9od19wcGd0dCAqcHBndHQsICpvbGQ7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0sICpvbGQ7CiAJaW50IGVycjsKIAogCWlmIChhcmdzLT5zaXplKQogCQlyZXR1cm4gLUVJTlZB
TDsKIAotCWlmICghY3R4LT5wcGd0dCkKKwlpZiAoIWN0eC0+dm0pCiAJCXJldHVybiAtRU5PREVW
OwogCiAJaWYgKHVwcGVyXzMyX2JpdHMoYXJncy0+dmFsdWUpKQpAQCAtMTA5NiwxOCArMTEwMCwx
OCBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpm
aWxlX3ByaXYsCiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCXBwZ3R0ID0gaWRyX2ZpbmQo
JmZpbGVfcHJpdi0+dm1faWRyLCBhcmdzLT52YWx1ZSk7Ci0JaWYgKHBwZ3R0KQotCQlpOTE1X3Bw
Z3R0X2dldChwcGd0dCk7CisJdm0gPSBpZHJfZmluZCgmZmlsZV9wcml2LT52bV9pZHIsIGFyZ3Mt
PnZhbHVlKTsKKwlpZiAodm0pCisJCWk5MTVfdm1fZ2V0KHZtKTsKIAltdXRleF91bmxvY2soJmZp
bGVfcHJpdi0+dm1faWRyX2xvY2spOwotCWlmICghcHBndHQpCisJaWYgKCF2bSkKIAkJcmV0dXJu
IC1FTk9FTlQ7CiAKIAllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmN0eC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVycikKIAkJZ290byBvdXQ7CiAKLQlpZiAocHBndHQg
PT0gY3R4LT5wcGd0dCkKKwlpZiAodm0gPT0gY3R4LT52bSkKIAkJZ290byB1bmxvY2s7CiAKIAkv
KiBUZWFyZG93biB0aGUgZXhpc3Rpbmcgb2JqOnZtYSBjYWNoZSwgaXQgd2lsbCBoYXZlIHRvIGJl
IHJlYnVpbHQuICovCkBAIC0xMTE1LDcgKzExMTksNyBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChz
dHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJbHV0X2Nsb3NlKGN0eCk7
CiAJbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsKIAotCW9sZCA9IF9fc2V0X3BwZ3R0KGN0eCwg
cHBndHQpOworCW9sZCA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwogCiAJLyoKIAkgKiBXZSBuZWVk
IHRvIGZsdXNoIGFueSByZXF1ZXN0cyB1c2luZyB0aGUgY3VycmVudCBwcGd0dCBiZWZvcmUKQEAg
LTExMjgsMTYgKzExMzIsMTYgQEAgc3RhdGljIGludCBzZXRfcHBndHQoc3RydWN0IGRybV9pOTE1
X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2LAogCQkJCSAgIHNldF9wcGd0dF9iYXJyaWVyLAogCQkJ
CSAgIG9sZCk7CiAJaWYgKGVycikgewotCQljdHgtPnBwZ3R0ID0gb2xkOworCQljdHgtPnZtID0g
b2xkOwogCQljdHgtPmRlc2NfdGVtcGxhdGUgPSBkZWZhdWx0X2Rlc2NfdGVtcGxhdGUoY3R4LT5p
OTE1LCBvbGQpOwotCQlpOTE1X3BwZ3R0X3B1dChwcGd0dCk7CisJCWk5MTVfdm1fcHV0KHZtKTsK
IAl9CiAKIHVubG9jazoKIAltdXRleF91bmxvY2soJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIG91dDoKLQlpOTE1X3BwZ3R0X3B1dChwcGd0dCk7CisJaTkxNV92bV9wdXQodm0pOwog
CXJldHVybiBlcnI7CiB9CiAKQEAgLTIwMjUsMTUgKzIwMjksMTUgQEAgc3RhdGljIGludCBjbG9u
ZV90aW1lbGluZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogc3RhdGljIGludCBjbG9u
ZV92bShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCQkgICAgc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKnNyYykKIHsKLQlzdHJ1Y3QgaTkxNV9od19wcGd0dCAqcHBndHQ7CisJc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAKIAlyY3VfcmVhZF9sb2NrKCk7CiAJZG8gewotCQlw
cGd0dCA9IFJFQURfT05DRShzcmMtPnBwZ3R0KTsKLQkJaWYgKCFwcGd0dCkKKwkJdm0gPSBSRUFE
X09OQ0Uoc3JjLT52bSk7CisJCWlmICghdm0pCiAJCQlicmVhazsKIAotCQlpZiAoIWtyZWZfZ2V0
X3VubGVzc196ZXJvKCZwcGd0dC0+cmVmKSkKKwkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygm
dm0tPnJlZikpCiAJCQljb250aW51ZTsKIAogCQkvKgpAQCAtMjA1MSwxNiArMjA1NSwxNiBAQCBz
dGF0aWMgaW50IGNsb25lX3ZtKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpkc3QsCiAJCSAqIGl0
IGNhbm5vdCBiZSByZWFsbG9jYXRlZCBlbHNld2hlcmUuCiAJCSAqLwogCi0JCWlmIChwcGd0dCA9
PSBSRUFEX09OQ0Uoc3JjLT5wcGd0dCkpCisJCWlmICh2bSA9PSBSRUFEX09OQ0Uoc3JjLT52bSkp
CiAJCQlicmVhazsKIAotCQlpOTE1X3BwZ3R0X3B1dChwcGd0dCk7CisJCWk5MTVfdm1fcHV0KHZt
KTsKIAl9IHdoaWxlICgxKTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAotCWlmIChwcGd0dCkgewot
CQlfX2Fzc2lnbl9wcGd0dChkc3QsIHBwZ3R0KTsKLQkJaTkxNV9wcGd0dF9wdXQocHBndHQpOwor
CWlmICh2bSkgeworCQlfX2Fzc2lnbl9wcGd0dChkc3QsIHZtKTsKKwkJaTkxNV92bV9wdXQodm0p
OwogCX0KIAogCXJldHVybiAwOwpAQCAtMjI4NSw4ICsyMjg5LDggQEAgaW50IGk5MTVfZ2VtX2Nv
bnRleHRfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
IAogCWNhc2UgSTkxNV9DT05URVhUX1BBUkFNX0dUVF9TSVpFOgogCQlhcmdzLT5zaXplID0gMDsK
LQkJaWYgKGN0eC0+cHBndHQpCi0JCQlhcmdzLT52YWx1ZSA9IGN0eC0+cHBndHQtPnZtLnRvdGFs
OworCQlpZiAoY3R4LT52bSkKKwkJCWFyZ3MtPnZhbHVlID0gY3R4LT52bS0+dG90YWw7CiAJCWVs
c2UgaWYgKHRvX2k5MTUoZGV2KS0+bW0uYWxpYXNpbmdfcHBndHQpCiAJCQlhcmdzLT52YWx1ZSA9
IHRvX2k5MTUoZGV2KS0+bW0uYWxpYXNpbmdfcHBndHQtPnZtLnRvdGFsOwogCQllbHNlCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaAppbmRl
eCAzZGI3NDQ4Yjk3MzIuLmNjNTEzNDEwZWVlZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCkBAIC0yNSw3ICsyNSw3IEBAIHN0cnVj
dCBwaWQ7CiAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogc3RydWN0IGRybV9pOTE1X2ZpbGVf
cHJpdmF0ZTsKLXN0cnVjdCBpOTE1X2h3X3BwZ3R0Oworc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZTsKIHN0cnVjdCBpOTE1X3RpbWVsaW5lOwogc3RydWN0IGludGVsX3Jpbmc7CiAKQEAgLTgwLDcg
KzgwLDcgQEAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgewogCXN0cnVjdCBpOTE1X3RpbWVsaW5l
ICp0aW1lbGluZTsKIAogCS8qKgotCSAqIEBwcGd0dDogdW5pcXVlIGFkZHJlc3Mgc3BhY2UgKEdU
VCkKKwkgKiBAdm06IHVuaXF1ZSBhZGRyZXNzIHNwYWNlIChHVFQpCiAJICoKIAkgKiBJbiBmdWxs
LXBwZ3R0IG1vZGUsIGVhY2ggY29udGV4dCBoYXMgaXRzIG93biBhZGRyZXNzIHNwYWNlIGVuc3Vy
aW5nCiAJICogY29tcGxldGUgc2VwZXJhdGlvbiBvZiBvbmUgY2xpZW50IGZyb20gYWxsIG90aGVy
cy4KQEAgLTg4LDcgKzg4LDcgQEAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgewogCSAqIEluIG90
aGVyIG1vZGVzLCB0aGlzIGlzIGEgTlVMTCBwb2ludGVyIHdpdGggdGhlIGV4cGVjdGF0aW9uIHRo
YXQKIAkgKiB0aGUgY2FsbGVyIHVzZXMgdGhlIHNoYXJlZCBnbG9iYWwgR1RULgogCSAqLwotCXN0
cnVjdCBpOTE1X2h3X3BwZ3R0ICpwcGd0dDsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bTsKIAogCS8qKgogCSAqIEBwaWQ6IHByb2Nlc3MgaWQgb2YgY3JlYXRvcgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggNjE5M2M4MWViYmVk
Li5lZWI0YzZjZGIwMWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2V4ZWNidWZmZXIuYwpAQCAtNzIzLDggKzcyMyw4IEBAIHN0YXRpYyBpbnQgZWJfc2VsZWN0X2Nv
bnRleHQoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJCXJldHVybiAtRU5PRU5UOwogCiAJ
ZWItPmdlbV9jb250ZXh0ID0gY3R4OwotCWlmIChjdHgtPnBwZ3R0KSB7Ci0JCWViLT52bSA9ICZj
dHgtPnBwZ3R0LT52bTsKKwlpZiAoY3R4LT52bSkgeworCQllYi0+dm0gPSBjdHgtPnZtOwogCQll
Yi0+aW52YWxpZF9mbGFncyB8PSBFWEVDX09CSkVDVF9ORUVEU19HVFQ7CiAJfSBlbHNlIHsKIAkJ
ZWItPnZtID0gJmViLT5pOTE1LT5nZ3R0LnZtOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3RfYmx0LmMKaW5kZXggZmM4ZWU3ZWYzZDY5Li5jYjQyZTNhMzEyZTIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfYmx0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF9ibHQuYwpA
QCAtNDksMTQgKzQ5LDEyIEBAIGludCBpOTE1X2dlbV9vYmplY3RfZmlsbF9ibHQoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eCA9IGNlLT5nZW1fY29udGV4dDsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKwlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50
IGVycjsKIAogCS8qIFhYWDogY2UtPnZtIHBsZWFzZSAqLwotCXZtID0gY3R4LT5wcGd0dCA/ICZj
dHgtPnBwZ3R0LT52bSA6ICZpOTE1LT5nZ3R0LnZtOwotCiAJdm1hID0gaTkxNV92bWFfaW5zdGFu
Y2Uob2JqLCB2bSwgTlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2
bWEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJw
dHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXgg
Y2ZhOTkwZWRiMzUxLi41MjhiNjE2NzgzMzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtNzY4LDE0ICs3NjgsMTQgQEAgaTkxNV9nZW1fdXNlcnB0
cl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQlyZXR1cm4gLUVGQVVMVDsKIAogCWlm
IChhcmdzLT5mbGFncyAmIEk5MTVfVVNFUlBUUl9SRUFEX09OTFkpIHsKLQkJc3RydWN0IGk5MTVf
aHdfcHBndHQgKnBwZ3R0OworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAogCQkv
KgogCQkgKiBPbiBhbG1vc3QgYWxsIG9mIHRoZSBvbGRlciBodywgd2UgY2Fubm90IHRlbGwgdGhl
IEdQVSB0aGF0CiAJCSAqIGEgcGFnZSBpcyByZWFkb25seS4KIAkJICovCi0JCXBwZ3R0ID0gZGV2
X3ByaXYtPmtlcm5lbF9jb250ZXh0LT5wcGd0dDsKLQkJaWYgKCFwcGd0dCB8fCAhcHBndHQtPnZt
Lmhhc19yZWFkX29ubHkpCisJCXZtID0gZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0LT52bTsKKwkJ
aWYgKCF2bSB8fCAhdm0tPmhhc19yZWFkX29ubHkpCiAJCQlyZXR1cm4gLUVOT0RFVjsKIAl9CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdl
cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5k
ZXggZWMyOTg1YzBhOTJlLi4yMzJkNWNmNDM5NmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0xMDM4LDggKzEwMzgsNyBAQCBzdGF0
aWMgaW50IF9faWd0X3dyaXRlX2h1Z2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJ
CSAgICB1MzIgZHdvcmQsIHUzMiB2YWwpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0KLQkJY3R4LT5wcGd0dCA/ICZjdHgtPnBwZ3R0LT52bSA6ICZpOTE1LT5nZ3R0LnZtOwor
CXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52
bTsKIAl1bnNpZ25lZCBpbnQgZmxhZ3MgPSBQSU5fVVNFUiB8IFBJTl9PRkZTRVRfRklYRUQ7CiAJ
c3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50IGVycjsKQEAgLTEwOTIsOCArMTA5MSw3IEBAIHN0
YXRpYyBpbnQgaWd0X3dyaXRlX2h1Z2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJ
CSAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0gPQotCQljdHgtPnBwZ3R0ID8gJmN0eC0+cHBndHQtPnZtIDogJmk5MTUt
PmdndHQudm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtID86ICZp
OTE1LT5nZ3R0LnZtOwogCXN0YXRpYyBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmVzW0k5
MTVfTlVNX0VOR0lORVNdOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlJOTE1
X1JORF9TVEFURShwcm5nKTsKQEAgLTE0MTksNyArMTQxNyw3IEBAIHN0YXRpYyBpbnQgaWd0X3Bw
Z3R0X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgg
PSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY3R4LT5pOTE1Owog
CXVuc2lnbmVkIGxvbmcgc3VwcG9ydGVkID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPnBhZ2Vfc2l6
ZXM7Ci0Jc3RydWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0ID0gY3R4LT5wcGd0dDsKKwlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm07CiAJc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1bnNpZ25lZCBpbnQgZmxhZ3Mg
PSBQSU5fVVNFUiB8IFBJTl9PRkZTRVRfRklYRUQ7CkBAIC0xNDM0LDcgKzE0MzIsNyBAQCBzdGF0
aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAkgKiBodWdlLWd0dC1wYWdl
cy4KIAkgKi8KIAotCWlmICghcHBndHQgfHwgIWk5MTVfdm1faXNfNGx2bCgmcHBndHQtPnZtKSkg
eworCWlmICghdm0gfHwgIWk5MTVfdm1faXNfNGx2bCh2bSkpIHsKIAkJcHJfaW5mbygiNDhiIFBQ
R1RUIG5vdCBzdXBwb3J0ZWQsIHNraXBwaW5nXG4iKTsKIAkJcmV0dXJuIDA7CiAJfQpAQCAtMTQ0
OSw3ICsxNDQ3LDcgQEAgc3RhdGljIGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2b2lkICphcmcp
CiAJCWlmIChJU19FUlIob2JqKSkKIAkJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKLQkJdm1hID0g
aTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmcHBndHQtPnZtLCBOVUxMKTsKKwkJdm1hID0gaTkxNV92
bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CiAJCWlmIChJU19FUlIodm1hKSkgewogCQkJZXJy
ID0gUFRSX0VSUih2bWEpOwogCQkJZ290byBvdXRfcHV0OwpAQCAtMTUwMyw3ICsxNTAxLDcgQEAg
c3RhdGljIGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2b2lkICphcmcpCiAJaWYgKElTX0VSUihv
YmopKQogCQlyZXR1cm4gUFRSX0VSUihvYmopOwogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uo
b2JqLCAmcHBndHQtPnZtLCBOVUxMKTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZt
LCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQln
b3RvIG91dF9wdXQ7CkBAIC0xNTQxLDggKzE1MzksNyBAQCBzdGF0aWMgaW50IGlndF90bXBmc19m
YWxsYmFjayh2b2lkICphcmcpCiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGFyZzsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0eC0+aTkxNTsKIAlzdHJ1Y3QgdmZz
bW91bnQgKmdlbWZzID0gaTkxNS0+bW0uZ2VtZnM7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0gPQotCQljdHgtPnBwZ3R0ID8gJmN0eC0+cHBndHQtPnZtIDogJmk5MTUtPmdndHQudm07
CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtID86ICZpOTE1LT5nZ3R0
LnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfdm1h
ICp2bWE7CiAJdTMyICp2YWRkcjsKQEAgLTE1OTksOCArMTU5Niw3IEBAIHN0YXRpYyBpbnQgaWd0
X3Nocmlua190aHAodm9pZCAqYXJnKQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgg
PSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7Ci0Jc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPQotCQljdHgtPnBwZ3R0ID8gJmN0eC0+cHBndHQt
PnZtIDogJmk5MTUtPmdndHQudm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBj
dHgtPnZtID86ICZpOTE1LT5nZ3R0LnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdW5zaWduZWQgaW50IGZsYWdzID0gUElOX1VT
RVI7CkBAIC0xNzIxLDcgKzE3MTcsNyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX21vY2tfc2Vs
ZnRlc3RzKHZvaWQpCiAJZXJyID0gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgcHBndHQpOwogCiBvdXRf
Y2xvc2U6Ci0JaTkxNV9wcGd0dF9wdXQocHBndHQpOworCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0p
OwogCiBvdXRfdW5sb2NrOgogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwpAQCAtMTc2Niw4ICsxNzYyLDggQEAgaW50IGk5MTVfZ2VtX2h1Z2VfcGFnZV9saXZlX3Nl
bGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gb3V0X3Vu
bG9jazsKIAl9CiAKLQlpZiAoY3R4LT5wcGd0dCkKLQkJY3R4LT5wcGd0dC0+dm0uc2NydWJfNjRL
ID0gdHJ1ZTsKKwlpZiAoY3R4LT52bSkKKwkJY3R4LT52bS0+c2NydWJfNjRLID0gdHJ1ZTsKIAog
CWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGN0eCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggNDExMDVm
NmVkMjA2Li43NGIwZTU4NzFjNGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC0yNDgsOCArMjQ4LDcgQEAgc3Rh
dGljIGludCBncHVfZmlsbChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgICAg
dW5zaWduZWQgaW50IGR3KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9f
aTkxNShvYmotPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9Ci0J
CWN0eC0+cHBndHQgPyAmY3R4LT5wcGd0dC0+dm0gOiAmaTkxNS0+Z2d0dC52bTsKKwlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07CiAJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJc3RydWN0IGk5
MTVfdm1hICpiYXRjaDsKQEAgLTQzOCw4ICs0MzcsNyBAQCBjcmVhdGVfdGVzdF9vYmplY3Qoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJICAgc3RydWN0IGxpc3RfaGVhZCAqb2JqZWN0
cykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtID0KLQkJY3R4LT5wcGd0dCA/ICZjdHgtPnBwZ3R0LT52bSA6ICZjdHgt
Pmk5MTUtPmdndHQudm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZt
ID86ICZjdHgtPmk5MTUtPmdndHQudm07CiAJdTY0IHNpemU7CiAJaW50IGVycjsKIApAQCAtNTQx
LDcgKzUzOSw3IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9leGVjKHZvaWQgKmFyZykKIAkJCQlwcl9l
cnIoIkZhaWxlZCB0byBmaWxsIGR3b3JkICVsdSBbJWx1LyVsdV0gd2l0aCBncHUgKCVzKSBpbiBj
dHggJXUgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJCSAgICAgICBuZHdvcmRzLCBk
dywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGN0eC0+aHdfaWQs
Ci0JCQkJICAgICAgIHllc25vKCEhY3R4LT5wcGd0dCksIGVycik7CisJCQkJICAgICAgIHllc25v
KCEhY3R4LT52bSksIGVycik7CiAJCQkJZ290byBvdXRfdW5sb2NrOwogCQkJfQogCkBAIC02MTIs
NyArNjEwLDcgQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVkX2N0eF9leGVjKHZvaWQgKmFyZykKIAkJ
Z290byBvdXRfdW5sb2NrOwogCX0KIAotCWlmICghcGFyZW50LT5wcGd0dCkgeyAvKiBub3QgZnVs
bC1wcGd0dDsgbm90aGluZyB0byBzaGFyZSAqLworCWlmICghcGFyZW50LT52bSkgeyAvKiBub3Qg
ZnVsbC1wcGd0dDsgbm90aGluZyB0byBzaGFyZSAqLwogCQllcnIgPSAwOwogCQlnb3RvIG91dF91
bmxvY2s7CiAJfQpAQCAtNjQzLDcgKzY0MSw3IEBAIHN0YXRpYyBpbnQgaWd0X3NoYXJlZF9jdHhf
ZXhlYyh2b2lkICphcmcpCiAJCQkJZ290byBvdXRfdGVzdDsKIAkJCX0KIAotCQkJX19hc3NpZ25f
cHBndHQoY3R4LCBwYXJlbnQtPnBwZ3R0KTsKKwkJCV9fYXNzaWduX3BwZ3R0KGN0eCwgcGFyZW50
LT52bSk7CiAKIAkJCWlmICghb2JqKSB7CiAJCQkJb2JqID0gY3JlYXRlX3Rlc3Rfb2JqZWN0KHBh
cmVudCwgZmlsZSwgJm9iamVjdHMpOwpAQCAtNjYxLDcgKzY1OSw3IEBAIHN0YXRpYyBpbnQgaWd0
X3NoYXJlZF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBk
d29yZCAlbHUgWyVsdS8lbHVdIHdpdGggZ3B1ICglcykgaW4gY3R4ICV1IFtmdWxsLXBwZ3R0PyAl
c10sIGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9kd29yZHMob2JqKSwK
IAkJCQkgICAgICAgZW5naW5lLT5uYW1lLCBjdHgtPmh3X2lkLAotCQkJCSAgICAgICB5ZXNubygh
IWN0eC0+cHBndHQpLCBlcnIpOworCQkJCSAgICAgICB5ZXNubyghIWN0eC0+dm0pLCBlcnIpOwog
CQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAJCQkJZ290byBvdXRfdGVzdDsKIAkJCX0K
QEAgLTc1OCw3ICs3NTYsNyBAQCBlbWl0X3JwY3NfcXVlcnkoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKIAogCUdFTV9CVUdfT04oIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQo
Y2UtPmVuZ2luZSkpOwogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmY2UtPmdlbV9j
b250ZXh0LT5wcGd0dC0+dm0sIE5VTEwpOworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwg
Y2UtPmdlbV9jb250ZXh0LT52bSwgTlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4g
UFRSX0VSUih2bWEpOwogCkBAIC0xMTc2LDggKzExNzQsOCBAQCBzdGF0aWMgaW50IGlndF9jdHhf
cmVhZG9ubHkodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
YXJnOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBOVUxMOworCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0J
c3RydWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0OwogCXVuc2lnbmVkIGxvbmcgaWR4LCBuZHdvcmRz
LCBkdzsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsK
QEAgLTEyMDgsOCArMTIwNiw4IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICph
cmcpCiAJCWdvdG8gb3V0X3VubG9jazsKIAl9CiAKLQlwcGd0dCA9IGN0eC0+cHBndHQgPzogaTkx
NS0+bW0uYWxpYXNpbmdfcHBndHQ7Ci0JaWYgKCFwcGd0dCB8fCAhcHBndHQtPnZtLmhhc19yZWFk
X29ubHkpIHsKKwl2bSA9IGN0eC0+dm0gPzogJmk5MTUtPm1tLmFsaWFzaW5nX3BwZ3R0LT52bTsK
KwlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkgewogCQllcnIgPSAwOwogCQlnb3RvIG91
dF91bmxvY2s7CiAJfQpAQCAtMTI0NCw3ICsxMjQyLDcgQEAgc3RhdGljIGludCBpZ3RfY3R4X3Jl
YWRvbmx5KHZvaWQgKmFyZykKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxsIGR3b3JkICVsdSBb
JWx1LyVsdV0gd2l0aCBncHUgKCVzKSBpbiBjdHggJXUgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVk
XG4iLAogCQkJCSAgICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAg
ICBlbmdpbmUtPm5hbWUsIGN0eC0+aHdfaWQsCi0JCQkJICAgICAgIHllc25vKCEhY3R4LT5wcGd0
dCksIGVycik7CisJCQkJICAgICAgIHllc25vKCEhY3R4LT52bSksIGVycik7CiAJCQkJZ290byBv
dXRfdW5sb2NrOwogCQkJfQogCkBAIC0xMjg4LDcgKzEyODYsNyBAQCBzdGF0aWMgaW50IGlndF9j
dHhfcmVhZG9ubHkodm9pZCAqYXJnKQogc3RhdGljIGludCBjaGVja19zY3JhdGNoKHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHgsIHU2NCBvZmZzZXQpCiB7CiAJc3RydWN0IGRybV9tbV9ub2Rl
ICpub2RlID0KLQkJX19kcm1fbW1faW50ZXJ2YWxfZmlyc3QoJmN0eC0+cHBndHQtPnZtLm1tLAor
CQlfX2RybV9tbV9pbnRlcnZhbF9maXJzdCgmY3R4LT52bS0+bW0sCiAJCQkJCW9mZnNldCwgb2Zm
c2V0ICsgc2l6ZW9mKHUzMikgLSAxKTsKIAlpZiAoIW5vZGUgfHwgbm9kZS0+c3RhcnQgPiBvZmZz
ZXQpCiAJCXJldHVybiAwOwpAQCAtMTMzNiw3ICsxMzM0LDcgQEAgc3RhdGljIGludCB3cml0ZV90
b19zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJX19pOTE1X2dlbV9vYmpl
Y3RfZmx1c2hfbWFwKG9iaiwgMCwgNjQpOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2Jq
KTsKIAotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmN0eC0+cHBndHQtPnZtLCBOVUxM
KTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGN0eC0+dm0sIE5VTEwpOwogCWlmIChJ
U19FUlIodm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJCWdvdG8gZXJyOwpAQCAtMTQz
Myw3ICsxNDMxLDcgQEAgc3RhdGljIGludCByZWFkX2Zyb21fc2NyYXRjaChzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4LAogCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAob2JqKTsKIAlpOTE1
X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7CiAKLQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShv
YmosICZjdHgtPnBwZ3R0LT52bSwgTlVMTCk7CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2Jq
LCBjdHgtPnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VSUih2
bWEpOwogCQlnb3RvIGVycjsKQEAgLTE1NDIsMTEgKzE1NDAsMTEgQEAgc3RhdGljIGludCBpZ3Rf
dm1faXNvbGF0aW9uKHZvaWQgKmFyZykKIAl9CiAKIAkvKiBXZSBjYW4gb25seSB0ZXN0IHZtIGlz
b2xhdGlvbiwgaWYgdGhlIHZtIGFyZSBkaXN0aW5jdCAqLwotCWlmIChjdHhfYS0+cHBndHQgPT0g
Y3R4X2ItPnBwZ3R0KQorCWlmIChjdHhfYS0+dm0gPT0gY3R4X2ItPnZtKQogCQlnb3RvIG91dF91
bmxvY2s7CiAKLQl2bV90b3RhbCA9IGN0eF9hLT5wcGd0dC0+dm0udG90YWw7Ci0JR0VNX0JVR19P
TihjdHhfYi0+cHBndHQtPnZtLnRvdGFsICE9IHZtX3RvdGFsKTsKKwl2bV90b3RhbCA9IGN0eF9h
LT52bS0+dG90YWw7CisJR0VNX0JVR19PTihjdHhfYi0+dm0tPnRvdGFsICE9IHZtX3RvdGFsKTsK
IAl2bV90b3RhbCAtPSBJOTE1X0dUVF9QQUdFX1NJWkU7CiAKIAl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL21vY2tfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9tb2NrX2NvbnRleHQuYwppbmRleCA2NTc4ZjJmNmMzZjguLjgyMzcxYzYwZDRhYSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5j
CkBAIC00OCw3ICs0OCw4IEBAIG1vY2tfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJaWYgKCFwcGd0dCkKIAkJCWdvdG8gZXJyX3B1dDsKIAotCQlfX3NldF9wcGd0dChj
dHgsIHBwZ3R0KTsKKwkJX19zZXRfcHBndHQoY3R4LCAmcHBndHQtPnZtKTsKKwkJaTkxNV92bV9w
dXQoJnBwZ3R0LT52bSk7CiAJfQogCiAJcmV0dXJuIGN0eDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbHJjLmMKaW5kZXggODI2ZmU3NzE1OGE5Li41OWRkZDAyZDExNDkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jCkBAIC0xNTUxLDcgKzE1NTEsNyBAQCBfX2V4ZWNsaXN0c19jb250
ZXh0X3BpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJdm9pZCAqdmFkZHI7CiAJaW50IHJl
dDsKIAotCUdFTV9CVUdfT04oIWNlLT5nZW1fY29udGV4dC0+cHBndHQpOworCUdFTV9CVUdfT04o
IWNlLT5nZW1fY29udGV4dC0+dm0pOwogCiAJcmV0ID0gZXhlY2xpc3RzX2NvbnRleHRfZGVmZXJy
ZWRfYWxsb2MoY2UsIGVuZ2luZSk7CiAJaWYgKHJldCkKQEAgLTE2NjgsNyArMTY2OCw4IEBAIHN0
YXRpYyBpbnQgZ2VuOF9lbWl0X2luaXRfYnJlYWRjcnVtYihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSkKIHN0YXRpYyBpbnQgZW1pdF9wZHBzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewogCWNv
bnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKiBjb25zdCBlbmdpbmUgPSBycS0+ZW5naW5lOwot
CXN0cnVjdCBpOTE1X2h3X3BwZ3R0ICogY29uc3QgcHBndHQgPSBycS0+Z2VtX2NvbnRleHQtPnBw
Z3R0OworCXN0cnVjdCBpOTE1X2h3X3BwZ3R0ICogY29uc3QgcHBndHQgPQorCQlpOTE1X3ZtX3Rv
X3BwZ3R0KHJxLT5nZW1fY29udGV4dC0+dm0pOwogCWludCBlcnIsIGk7CiAJdTMyICpjczsKIApA
QCAtMTc0MSw3ICsxNzQyLDcgQEAgc3RhdGljIGludCBleGVjbGlzdHNfcmVxdWVzdF9hbGxvYyhz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCSAqLwogCiAJLyogVW5jb25kaXRpb25hbGx5
IGludmFsaWRhdGUgR1BVIGNhY2hlcyBhbmQgVExCcy4gKi8KLQlpZiAoaTkxNV92bV9pc180bHZs
KCZyZXF1ZXN0LT5nZW1fY29udGV4dC0+cHBndHQtPnZtKSkKKwlpZiAoaTkxNV92bV9pc180bHZs
KHJlcXVlc3QtPmdlbV9jb250ZXh0LT52bSkpCiAJCXJldCA9IHJlcXVlc3QtPmVuZ2luZS0+ZW1p
dF9mbHVzaChyZXF1ZXN0LCBFTUlUX0lOVkFMSURBVEUpOwogCWVsc2UKIAkJcmV0ID0gZW1pdF9w
ZHBzKHJlcXVlc3QpOwpAQCAtMjg2Nyw3ICsyODY4LDcgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3Rz
X2luaXRfcmVnX3N0YXRlKHUzMiAqcmVncywKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSwKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKQogewotCXN0cnVj
dCBpOTE1X2h3X3BwZ3R0ICpwcGd0dCA9IGNlLT5nZW1fY29udGV4dC0+cHBndHQ7CisJc3RydWN0
IGk5MTVfaHdfcHBndHQgKnBwZ3R0ID0gaTkxNV92bV90b19wcGd0dChjZS0+Z2VtX2NvbnRleHQt
PnZtKTsKIAlib29sIHJjcyA9IGVuZ2luZS0+Y2xhc3MgPT0gUkVOREVSX0NMQVNTOwogCXUzMiBi
YXNlID0gZW5naW5lLT5tbWlvX2Jhc2U7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3JpbmdidWZmZXIuYwppbmRleCA2OTcxODk2MWFhZTguLmQ5NmJiNjc5YzJiMCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMTMyNiwyMyArMTMyNiwy
MyBAQCBzdGF0aWMgdm9pZCByaW5nX2NvbnRleHRfZGVzdHJveShzdHJ1Y3Qga3JlZiAqcmVmKQog
CiBzdGF0aWMgaW50IF9fY29udGV4dF9waW5fcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCkKIHsKLQlzdHJ1Y3QgaTkxNV9od19wcGd0dCAqcHBndHQ7CisJc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm07CiAJaW50IGVyciA9IDA7CiAKLQlwcGd0dCA9IGN0eC0+cHBndHQgPzog
Y3R4LT5pOTE1LT5tbS5hbGlhc2luZ19wcGd0dDsKLQlpZiAocHBndHQpCi0JCWVyciA9IGdlbjZf
cHBndHRfcGluKHBwZ3R0KTsKKwl2bSA9IGN0eC0+dm0gPzogJmN0eC0+aTkxNS0+bW0uYWxpYXNp
bmdfcHBndHQtPnZtOworCWlmICh2bSkKKwkJZXJyID0gZ2VuNl9wcGd0dF9waW4oaTkxNV92bV90
b19wcGd0dCgodm0pKSk7CiAKIAlyZXR1cm4gZXJyOwogfQogCiBzdGF0aWMgdm9pZCBfX2NvbnRl
eHRfdW5waW5fcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKLQlzdHJ1Y3Qg
aTkxNV9od19wcGd0dCAqcHBndHQ7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAK
LQlwcGd0dCA9IGN0eC0+cHBndHQgPzogY3R4LT5pOTE1LT5tbS5hbGlhc2luZ19wcGd0dDsKLQlp
ZiAocHBndHQpCi0JCWdlbjZfcHBndHRfdW5waW4ocHBndHQpOworCXZtID0gY3R4LT52bSA/OiAm
Y3R4LT5pOTE1LT5tbS5hbGlhc2luZ19wcGd0dC0+dm07CisJaWYgKHZtKQorCQlnZW42X3BwZ3R0
X3VucGluKGk5MTVfdm1fdG9fcHBndHQodm0pKTsKIH0KIAogc3RhdGljIHZvaWQgcmluZ19jb250
ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKQEAgLTE2NjQsMTQgKzE2NjQsMTYg
QEAgc3RhdGljIGludCBzd2l0Y2hfY29udGV4dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsK
IAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOwogCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHggPSBycS0+Z2VtX2NvbnRleHQ7Ci0Jc3RydWN0IGk5MTVfaHdf
cHBndHQgKnBwZ3R0ID0gY3R4LT5wcGd0dCA/OiBycS0+aTkxNS0+bW0uYWxpYXNpbmdfcHBndHQ7
CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPQorCQljdHgtPnZtID86ICZycS0+aTkx
NS0+bW0uYWxpYXNpbmdfcHBndHQtPnZtOwogCXVuc2lnbmVkIGludCB1bndpbmRfbW0gPSAwOwog
CXUzMiBod19mbGFncyA9IDA7CiAJaW50IHJldCwgaTsKIAogCUdFTV9CVUdfT04oSEFTX0VYRUNM
SVNUUyhycS0+aTkxNSkpOwogCi0JaWYgKHBwZ3R0KSB7CisJaWYgKHZtKSB7CisJCXN0cnVjdCBp
OTE1X2h3X3BwZ3R0ICpwcGd0dCA9IGk5MTVfdm1fdG9fcHBndHQodm0pOwogCQlpbnQgbG9vcHM7
CiAKIAkJLyoKQEAgLTE3MTgsNyArMTcyMCw3IEBAIHN0YXRpYyBpbnQgc3dpdGNoX2NvbnRleHQo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCQlnb3RvIGVycl9tbTsKIAl9CiAKLQlpZiAocHBn
dHQpIHsKKwlpZiAodm0pIHsKIAkJcmV0ID0gZW5naW5lLT5lbWl0X2ZsdXNoKHJxLCBFTUlUX0lO
VkFMSURBVEUpOwogCQlpZiAocmV0KQogCQkJZ290byBlcnJfbW07CkBAIC0xNzYxLDcgKzE3NjMs
NyBAQCBzdGF0aWMgaW50IHN3aXRjaF9jb250ZXh0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQog
CiBlcnJfbW06CiAJaWYgKHVud2luZF9tbSkKLQkJcHBndHQtPnBkX2RpcnR5X2VuZ2luZXMgfD0g
dW53aW5kX21tOworCQlpOTE1X3ZtX3RvX3BwZ3R0KHZtKS0+cGRfZGlydHlfZW5naW5lcyB8PSB1
bndpbmRfbW07CiBlcnI6CiAJcmV0dXJuIHJldDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggYzYwMTYzOThjN2U5Li40NThjNjU1OTMxMmQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCkBAIC0x
MjgsOCArMTI4LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogaGFuZ19jcmVhdGVf
cmVxdWVzdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gaC0+aTkxNTsKLQlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSA9Ci0JCWgtPmN0eC0+cHBndHQgPyAmaC0+Y3R4LT5wcGd0dC0+
dm0gOiAmaTkxNS0+Z2d0dC52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGgt
PmN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IE5VTEw7CiAJc3RydWN0IGk5MTVfdm1h
ICpod3MsICp2bWE7CkBAIC0xMzU3LDggKzEzNTYsOCBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9l
dmljdF9wcGd0dCh2b2lkICphcmcpCiAJfQogCiAJZXJyID0gMDsKLQlpZiAoY3R4LT5wcGd0dCkg
LyogYWxpYXNpbmcgPT0gZ2xvYmFsIGd0dCBsb2NraW5nLCBjb3ZlcmVkIGFib3ZlICovCi0JCWVy
ciA9IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShpOTE1LCAmY3R4LT5wcGd0dC0+dm0sCisJaWYgKGN0
eC0+dm0pIC8qIGFsaWFzaW5nID09IGdsb2JhbCBndHQgbG9ja2luZywgY292ZXJlZCBhYm92ZSAq
LworCQllcnIgPSBfX2lndF9yZXNldF9ldmljdF92bWEoaTkxNSwgY3R4LT52bSwKIAkJCQkJICAg
IGV2aWN0X3ZtYSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwogCiBvdXQ6CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IDlmYzAzYTQwMDY4NS4uNzdmYzk4OGYxODg2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtMTMxMSw3ICsxMzExLDcgQEAg
c3RhdGljIGludCBzbW9rZV9zdWJtaXQoc3RydWN0IHByZWVtcHRfc21va2UgKnNtb2tlLAogCWlu
dCBlcnIgPSAwOwogCiAJaWYgKGJhdGNoKSB7Ci0JCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKGJh
dGNoLCAmY3R4LT5wcGd0dC0+dm0sIE5VTEwpOworCQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShi
YXRjaCwgY3R4LT52bSwgTlVMTCk7CiAJCWlmIChJU19FUlIodm1hKSkKIAkJCXJldHVybiBQVFJf
RVJSKHZtYSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X3dvcmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJv
dW5kcy5jCmluZGV4IDJjYjE1MTlmZGU0Mi4uYzhkMzM1ZDYzZjljIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAgLTM1OCw3ICszNTgsNyBA
QCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfYmF0Y2goc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCkKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBFUlJfQ0FTVChvYmopOwog
Ci0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmY3R4LT5wcGd0dC0+dm0sIE5VTEwpOwor
CXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52bSwgTlVMTCk7CiAJaWYgKElTX0VS
Uih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKIAkJZ290byBlcnJfb2JqOwpAQCAtNDQy
LDcgKzQ0Miw3IEBAIHN0YXRpYyBpbnQgY2hlY2tfZGlydHlfd2hpdGVsaXN0KHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCiAJaW50IGVyciA9IDAsIGksIHY7CiAJdTMyICpjcywgKnJlc3Vs
dHM7CiAKLQlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goJmN0eC0+cHBndHQtPnZtLCAyICogQVJS
QVlfU0laRSh2YWx1ZXMpICsgMSk7CisJc2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNoKGN0eC0+dm0s
IDIgKiBBUlJBWV9TSVpFKHZhbHVlcykgKyAxKTsKIAlpZiAoSVNfRVJSKHNjcmF0Y2gpKQogCQly
ZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIApAQCAtOTI1LDcgKzkyNSw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9pc29sYXRlZF93aGl0ZWxpc3Qodm9pZCAqYXJnKQogCWlmICghaW50ZWxfZW5naW5lc19o
YXNfY29udGV4dF9pc29sYXRpb24oaTkxNSkpCiAJCXJldHVybiAwOwogCi0JaWYgKCFpOTE1LT5r
ZXJuZWxfY29udGV4dC0+cHBndHQpCisJaWYgKCFpOTE1LT5rZXJuZWxfY29udGV4dC0+dm0pCiAJ
CXJldHVybiAwOwogCiAJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xpZW50KTsgaSsrKSB7
CkBAIC05MzcsMTQgKzkzNywxNCBAQCBzdGF0aWMgaW50IGxpdmVfaXNvbGF0ZWRfd2hpdGVsaXN0
KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJY2xpZW50W2ldLnNjcmF0Y2hbMF0g
PSBjcmVhdGVfc2NyYXRjaCgmYy0+cHBndHQtPnZtLCAxMDI0KTsKKwkJY2xpZW50W2ldLnNjcmF0
Y2hbMF0gPSBjcmVhdGVfc2NyYXRjaChjLT52bSwgMTAyNCk7CiAJCWlmIChJU19FUlIoY2xpZW50
W2ldLnNjcmF0Y2hbMF0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzBd
KTsKIAkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGMpOwogCQkJZ290byBlcnI7CiAJCX0KIAotCQlj
bGllbnRbaV0uc2NyYXRjaFsxXSA9IGNyZWF0ZV9zY3JhdGNoKCZjLT5wcGd0dC0+dm0sIDEwMjQp
OworCQljbGllbnRbaV0uc2NyYXRjaFsxXSA9IGNyZWF0ZV9zY3JhdGNoKGMtPnZtLCAxMDI0KTsK
IAkJaWYgKElTX0VSUihjbGllbnRbaV0uc2NyYXRjaFsxXSkpIHsKIAkJCWVyciA9IFBUUl9FUlIo
Y2xpZW50W2ldLnNjcmF0Y2hbMV0pOwogCQkJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmNs
aWVudFtpXS5zY3JhdGNoWzBdLCAwKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpp
bmRleCAzMTc1MmI3ZWJmZjUuLmUxZWZmZjVlNjQyNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9z
Y2hlZHVsZXIuYwpAQCAtMzY4LDcgKzM2OCw3IEBAIHN0YXRpYyBpbnQgc2V0X2NvbnRleHRfcHBn
dHRfZnJvbV9zaGFkb3coc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkLAogCQkJ
CQkgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9t
bSAqbW0gPSB3b3JrbG9hZC0+c2hhZG93X21tOwotCXN0cnVjdCBpOTE1X2h3X3BwZ3R0ICpwcGd0
dCA9IGN0eC0+cHBndHQ7CisJc3RydWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0ID0gaTkxNV92bV90
b19wcGd0dChjdHgtPnZtKTsKIAlpbnQgaSA9IDA7CiAKIAlpZiAobW0tPnR5cGUgIT0gSU5URUxf
R1ZUX01NX1BQR1RUIHx8ICFtbS0+cHBndHRfbW0uc2hhZG93ZWQpCkBAIC0xMTQ4LDcgKzExNDgs
NyBAQCB2b2lkIGludGVsX3ZncHVfY2xlYW5fc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAq
dmdwdSkKIAogCWludGVsX3ZncHVfc2VsZWN0X3N1Ym1pc3Npb25fb3BzKHZncHUsIEFMTF9FTkdJ
TkVTLCAwKTsKIAotCWk5MTVfY29udGV4dF9wcGd0dF9yb290X3Jlc3RvcmUocywgcy0+c2hhZG93
WzBdLT5nZW1fY29udGV4dC0+cHBndHQpOworCWk5MTVfY29udGV4dF9wcGd0dF9yb290X3Jlc3Rv
cmUocywgaTkxNV92bV90b19wcGd0dChzLT5zaGFkb3dbMF0tPmdlbV9jb250ZXh0LT52bSkpOwog
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIHZncHUtPmd2dC0+ZGV2X3ByaXYsIGlkKQogCQlpbnRl
bF9jb250ZXh0X3VucGluKHMtPnNoYWRvd1tpZF0pOwogCkBAIC0xMjEzLDcgKzEyMTMsNyBAQCBp
bnQgaW50ZWxfdmdwdV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQog
CWlmIChJU19FUlIoY3R4KSkKIAkJcmV0dXJuIFBUUl9FUlIoY3R4KTsKIAotCWk5MTVfY29udGV4
dF9wcGd0dF9yb290X3NhdmUocywgY3R4LT5wcGd0dCk7CisJaTkxNV9jb250ZXh0X3BwZ3R0X3Jv
b3Rfc2F2ZShzLCBpOTE1X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pKTsKIAogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIHZncHUtPmd2dC0+ZGV2X3ByaXYsIGkpIHsKIAkJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlOwpAQCAtMTI1Niw3ICsxMjU2LDcgQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlz
c2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAlyZXR1cm4gMDsKIAogb3V0X3NoYWRvd19j
dHg6Ci0JaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3RfcmVzdG9yZShzLCBjdHgtPnBwZ3R0KTsKKwlp
OTE1X2NvbnRleHRfcHBndHRfcm9vdF9yZXN0b3JlKHMsIGk5MTVfdm1fdG9fcHBndHQoY3R4LT52
bSkpOwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIHZncHUtPmd2dC0+ZGV2X3ByaXYsIGkpIHsK
IAkJaWYgKElTX0VSUihzLT5zaGFkb3dbaV0pKQogCQkJYnJlYWs7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZGVidWdmcy5jCmluZGV4IGEyNDYyZDZlZjU2NS4uZTJkNmI4ZGZmNGFiIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzI4LDcgKzMyOCw3IEBAIHN0YXRpYyB2b2lkIHBy
aW50X2NvbnRleHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAogCQlpOTE1X2dlbV9jb250ZXh0
X3VubG9ja19lbmdpbmVzKGN0eCk7CiAKIAkJaWYgKCFJU19FUlJfT1JfTlVMTChjdHgtPmZpbGVf
cHJpdikpIHsKLQkJCXN0cnVjdCBmaWxlX3N0YXRzIHN0YXRzID0geyAudm0gPSAmY3R4LT5wcGd0
dC0+dm0sIH07CisJCQlzdHJ1Y3QgZmlsZV9zdGF0cyBzdGF0cyA9IHsgLnZtID0gY3R4LT52bSwg
fTsKIAkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSA9IGN0eC0+ZmlsZV9wcml2LT5maWxlOwogCQkJ
c3RydWN0IHRhc2tfc3RydWN0ICp0YXNrOwogCQkJY2hhciBuYW1lWzgwXTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oCmluZGV4IDg5NDRiNjVhZjEzOC4uYTA0M2Y5MjA2OTRlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmgKQEAgLTI2MzksMTIgKzI2MzksNiBAQCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3Qg
Kmk5MTVfZ2VtX3ByaW1lX2ltcG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogc3RydWN0IGRt
YV9idWYgKmk5MTVfZ2VtX3ByaW1lX2V4cG9ydChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkJ
CXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtX29iaiwgaW50IGZsYWdzKTsKIAotc3RhdGljIGlu
bGluZSBzdHJ1Y3QgaTkxNV9od19wcGd0dCAqCi1pOTE1X3ZtX3RvX3BwZ3R0KHN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtKQotewotCXJldHVybiBjb250YWluZXJfb2Yodm0sIHN0cnVjdCBp
OTE1X2h3X3BwZ3R0LCB2bSk7Ci19Ci0KIHN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKgogX19pOTE1X2dlbV9jb250ZXh0X2xvb2t1cF9yY3Uoc3RydWN0IGRybV9pOTE1X2Zp
bGVfcHJpdmF0ZSAqZmlsZV9wcml2LCB1MzIgaWQpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jCmluZGV4IDQyOTgxN2MxZDJiOC4uZmQ4ZTY4YzU1NTg1IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYwpAQCAtNDgzLDYgKzQ4Myw4IEBAIHN0YXRpYyB2b2lkIHZtX2ZyZWVf
cGFnZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwgc3RydWN0IHBhZ2UgKnBhZ2UpCiAK
IHN0YXRpYyB2b2lkIGk5MTVfYWRkcmVzc19zcGFjZV9pbml0KHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLCBpbnQgc3ViY2xhc3MpCiB7CisJa3JlZl9pbml0KCZ2bS0+cmVmKTsKKwogCS8q
CiAJICogVGhlIHZtLT5tdXRleCBtdXN0IGJlIHJlY2xhaW0gc2FmZSAoZm9yIHVzZSBpbiB0aGUg
c2hyaW5rZXIpLgogCSAqIERvIGEgZHVtbXkgYWNxdWlyZSBub3cgdW5kZXIgZnNfcmVjbGFpbSBz
byB0aGF0IGFueSBhbGxvY2F0aW9uCkBAIC0xMjI5LDkgKzEyMzEsOCBAQCBzdGF0aWMgaW50IGdl
bjhfaW5pdF9zY3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCSAqLwogCWlm
ICh2bS0+aGFzX3JlYWRfb25seSAmJgogCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQgJiYK
LQkgICAgdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT5wcGd0dCkgewotCQlzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICpjbG9uZSA9Ci0JCQkmdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT5wcGd0
dC0+dm07CisJICAgIHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dC0+dm0pIHsKKwkJc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqY2xvbmUgPSB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtOwog
CiAJCUdFTV9CVUdfT04oIWNsb25lLT5oYXNfcmVhZF9vbmx5KTsKIApAQCAtMTU5MCw4ICsxNTkx
LDYgQEAgc3RhdGljIGludCBnZW44X3ByZWFsbG9jYXRlX3RvcF9sZXZlbF9wZHAoc3RydWN0IGk5
MTVfaHdfcHBndHQgKnBwZ3R0KQogc3RhdGljIHZvaWQgcHBndHRfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJICAgICAgIHN0cnVjdCBpOTE1X2h3X3BwZ3R0ICpwcGd0dCkK
IHsKLQlrcmVmX2luaXQoJnBwZ3R0LT5yZWYpOwotCiAJcHBndHQtPnZtLmk5MTUgPSBpOTE1Owog
CXBwZ3R0LT52bS5kbWEgPSAmaTkxNS0+ZHJtLnBkZXYtPmRldjsKIAlwcGd0dC0+dm0udG90YWwg
PSBCSVRfVUxMKElOVEVMX0lORk8oaTkxNSktPnBwZ3R0X3NpemUpOwpAQCAtMjI1OCwyMCArMjI1
NywyMiBAQCBzdGF0aWMgdm9pZCBwcGd0dF9kZXN0cm95X3ZtYShzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSkKIAkJaTkxNV92bWFfZGVzdHJveSh2bWEpOwogfQogCi12b2lkIGk5MTVfcHBn
dHRfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqa3JlZikKK3ZvaWQgaTkxNV92bV9yZWxlYXNlKHN0cnVj
dCBrcmVmICprcmVmKQogewotCXN0cnVjdCBpOTE1X2h3X3BwZ3R0ICpwcGd0dCA9Ci0JCWNvbnRh
aW5lcl9vZihrcmVmLCBzdHJ1Y3QgaTkxNV9od19wcGd0dCwgcmVmKTsKKwlzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSA9CisJCWNvbnRhaW5lcl9vZihrcmVmLCBzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlLCByZWYpOwogCi0JdHJhY2VfaTkxNV9wcGd0dF9yZWxlYXNlKCZwcGd0dC0+dm0p
OworCUdFTV9CVUdfT04oaTkxNV9pc19nZ3R0KHZtKSk7CisJdHJhY2VfaTkxNV9wcGd0dF9yZWxl
YXNlKHZtKTsKIAotCXBwZ3R0X2Rlc3Ryb3lfdm1hKCZwcGd0dC0+dm0pOworCXBwZ3R0X2Rlc3Ry
b3lfdm1hKHZtKTsKIAotCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnBwZ3R0LT52bS5ib3VuZF9s
aXN0KSk7CisJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmdm0tPmJvdW5kX2xpc3QpKTsKIAotCXBw
Z3R0LT52bS5jbGVhbnVwKCZwcGd0dC0+dm0pOwotCWk5MTVfYWRkcmVzc19zcGFjZV9maW5pKCZw
cGd0dC0+dm0pOwotCWtmcmVlKHBwZ3R0KTsKKwl2bS0+Y2xlYW51cCh2bSk7CisJaTkxNV9hZGRy
ZXNzX3NwYWNlX2Zpbmkodm0pOworCisJa2ZyZWUodm0pOwogfQogCiAvKiBDZXJ0YWluIEdlbjUg
Y2hpcHNldHMgcmVxdWlyZSByZXF1aXJlIGlkbGluZyB0aGUgR1BVIGJlZm9yZQpAQCAtMjgzNiw3
ICsyODM3LDcgQEAgc3RhdGljIGludCBpbml0X2FsaWFzaW5nX3BwZ3R0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogCXJldHVybiAwOwogCiBlcnJfcHBndHQ6Ci0JaTkxNV9wcGd0dF9w
dXQocHBndHQpOworCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCXJldHVybiBlcnI7CiB9CiAK
QEAgLTI4NDksNyArMjg1MCw3IEBAIHN0YXRpYyB2b2lkIGZpbmlfYWxpYXNpbmdfcHBndHQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaWYgKCFwcGd0dCkKIAkJcmV0dXJuOwogCi0J
aTkxNV9wcGd0dF9wdXQocHBndHQpOworCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCiAJZ2d0
dC0+dm0udm1hX29wcy5iaW5kX3ZtYSAgID0gZ2d0dF9iaW5kX3ZtYTsKIAlnZ3R0LT52bS52bWFf
b3BzLnVuYmluZF92bWEgPSBnZ3R0X3VuYmluZF92bWE7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5oCmluZGV4IDkzOWYyZjEzZWY3ZC4uZjU2YjE5ZWI3OWM0IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuaApAQCAtMjk0LDYgKzI5NCw4IEBAIHN0cnVjdCBwYWdlc3Rhc2ggewog
fTsKIAogc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSB7CisJc3RydWN0IGtyZWYgcmVmOworCiAJ
c3RydWN0IGRybV9tbSBtbTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKIAlzdHJ1
Y3QgZGV2aWNlICpkbWE7CkBAIC00MjAsNyArNDIyLDYgQEAgc3RydWN0IGk5MTVfZ2d0dCB7CiAK
IHN0cnVjdCBpOTE1X2h3X3BwZ3R0IHsKIAlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlIHZtOwot
CXN0cnVjdCBrcmVmIHJlZjsKIAogCWludGVsX2VuZ2luZV9tYXNrX3QgcGRfZGlydHlfZW5naW5l
czsKIAl1bmlvbiB7CkBAIC01OTAsMTAgKzU5MSwxOSBAQCBpOTE1X3BhZ2VfZGlyX2RtYV9hZGRy
KGNvbnN0IHN0cnVjdCBpOTE1X2h3X3BwZ3R0ICpwcGd0dCwgY29uc3QgdW5zaWduZWQgbikKIHN0
YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfZ2d0dCAqCiBpOTE1X3ZtX3RvX2dndHQoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7CisJQlVJTERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBp
OTE1X2dndHQsIHZtKSk7CiAJR0VNX0JVR19PTighaTkxNV9pc19nZ3R0KHZtKSk7CiAJcmV0dXJu
IGNvbnRhaW5lcl9vZih2bSwgc3RydWN0IGk5MTVfZ2d0dCwgdm0pOwogfQogCitzdGF0aWMgaW5s
aW5lIHN0cnVjdCBpOTE1X2h3X3BwZ3R0ICoKK2k5MTVfdm1fdG9fcHBndHQoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCit7CisJQlVJTERfQlVHX09OKG9mZnNldG9mKHN0cnVjdCBpOTE1
X2h3X3BwZ3R0LCB2bSkpOworCUdFTV9CVUdfT04oaTkxNV9pc19nZ3R0KHZtKSk7CisJcmV0dXJu
IGNvbnRhaW5lcl9vZih2bSwgc3RydWN0IGk5MTVfaHdfcHBndHQsIHZtKTsKK30KKwogI2RlZmlu
ZSBJTlRFTF9NQVhfUFBBVF9FTlRSSUVTIDgKICNkZWZpbmUgSU5URUxfUFBBVF9QRVJGRUNUX01B
VENIICh+MFUpCiAKQEAgLTYzNiwxOCArNjQ2LDE5IEBAIHZvaWQgaTkxNV9nZ3R0X2NsZWFudXBf
aHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIGludCBpOTE1X3BwZ3R0X2lu
aXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIAogc3RydWN0IGk5MTVf
aHdfcHBndHQgKmk5MTVfcHBndHRfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdik7Ci12b2lkIGk5MTVfcHBndHRfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqa3JlZik7CiAKLXN0
YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfaHdfcHBndHQgKmk5MTVfcHBndHRfZ2V0KHN0cnVjdCBp
OTE1X2h3X3BwZ3R0ICpwcGd0dCkKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqCitpOTE1X3ZtX2dldChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHsKLQlr
cmVmX2dldCgmcHBndHQtPnJlZik7Ci0JcmV0dXJuIHBwZ3R0OworCWtyZWZfZ2V0KCZ2bS0+cmVm
KTsKKwlyZXR1cm4gdm07CiB9CiAKLXN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3BwZ3R0X3B1dChz
dHJ1Y3QgaTkxNV9od19wcGd0dCAqcHBndHQpCit2b2lkIGk5MTVfdm1fcmVsZWFzZShzdHJ1Y3Qg
a3JlZiAqa3JlZik7CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ZtX3B1dChzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSkKIHsKLQlpZiAocHBndHQpCi0JCWtyZWZfcHV0KCZwcGd0dC0+
cmVmLCBpOTE1X3BwZ3R0X3JlbGVhc2UpOworCWtyZWZfcHV0KCZ2bS0+cmVmLCBpOTE1X3ZtX3Jl
bGVhc2UpOwogfQogCiBpbnQgZ2VuNl9wcGd0dF9waW4oc3RydWN0IGk5MTVfaHdfcHBndHQgKmJh
c2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKaW5kZXggNDEzOWI5NzYyYjQ0
Li5mYmE5NWJiMGJjNmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1
X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYwpAQCAt
MTQyMSw3ICsxNDIxLDcgQEAgc3RhdGljIHZvaWQgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkx
NV9ncHVfc3RhdGUgKmVycm9yKQogCQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJl
cXVlc3QtPmdlbV9jb250ZXh0OwogCQkJc3RydWN0IGludGVsX3JpbmcgKnJpbmc7CiAKLQkJCWVl
LT52bSA9IGN0eC0+cHBndHQgPyAmY3R4LT5wcGd0dC0+dm0gOiAmZ2d0dC0+dm07CisJCQllZS0+
dm0gPSBjdHgtPnZtID86ICZnZ3R0LT52bTsKIAogCQkJcmVjb3JkX2NvbnRleHQoJmVlLT5jb250
ZXh0LCBjdHgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNl
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmgKaW5kZXggODNiMzg5ZTM0YjUw
Li41YzhjZmFhNzBkNzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJh
Y2UuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmgKQEAgLTk3Nyw3ICs5
NzcsNyBAQCBERUNMQVJFX0VWRU5UX0NMQVNTKGk5MTVfY29udGV4dCwKIAkJCV9fZW50cnktPmRl
diA9IGN0eC0+aTkxNS0+ZHJtLnByaW1hcnktPmluZGV4OwogCQkJX19lbnRyeS0+Y3R4ID0gY3R4
OwogCQkJX19lbnRyeS0+aHdfaWQgPSBjdHgtPmh3X2lkOwotCQkJX19lbnRyeS0+dm0gPSBjdHgt
PnBwZ3R0ID8gJmN0eC0+cHBndHQtPnZtIDogTlVMTDsKKwkJCV9fZW50cnktPnZtID0gY3R4LT52
bTsKIAkpLAogCiAJVFBfcHJpbnRrKCJkZXY9JXUsIGN0eD0lcCwgY3R4X3ZtPSVwLCBod19pZD0l
dSIsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1f
Z3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5k
ZXggY2I3MTkzYzliYzc3Li5lOTBlNWUyY2EwNDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTIwOSw3ICsyMDksNyBAQCBzdGF0aWMgaW50
IGlndF9wcGd0dF9hbGxvYyh2b2lkICphcmcpCiAKIGVycl9wcGd0dF9jbGVhbnVwOgogCW11dGV4
X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlpOTE1X3BwZ3R0X3B1dChwcGd0
dCk7CisJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTEwMjEsNyArMTAyMSw3IEBA
IHN0YXRpYyBpbnQgZXhlcmNpc2VfcHBndHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCiAJZXJyID0gZnVuYyhkZXZfcHJpdiwgJnBwZ3R0LT52bSwgMCwgcHBndHQtPnZtLnRv
dGFsLCBlbmRfdGltZSk7CiAKLQlpOTE1X3BwZ3R0X3B1dChwcGd0dCk7CisJaTkxNV92bV9wdXQo
JnBwZ3R0LT52bSk7CiBvdXRfdW5sb2NrOgogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCkBAIC0xMjUxLDcgKzEyNTEsNiBAQCBzdGF0aWMgaW50IGV4ZXJjaXNl
X21vY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiB7CiAJY29uc3QgdTY0IGxpbWl0
ID0gdG90YWxyYW1fcGFnZXMoKSA8PCBQQUdFX1NISUZUOwogCXN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHg7Ci0Jc3RydWN0IGk5MTVfaHdfcHBndHQgKnBwZ3R0OwogCUlHVF9USU1FT1VUKGVu
ZF90aW1lKTsKIAlpbnQgZXJyOwogCkBAIC0xMjU5LDEwICsxMjU4LDcgQEAgc3RhdGljIGludCBl
eGVyY2lzZV9tb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlmICghY3R4KQog
CQlyZXR1cm4gLUVOT01FTTsKIAotCXBwZ3R0ID0gY3R4LT5wcGd0dDsKLQlHRU1fQlVHX09OKCFw
cGd0dCk7Ci0KLQllcnIgPSBmdW5jKGk5MTUsICZwcGd0dC0+dm0sIDAsIG1pbihwcGd0dC0+dm0u
dG90YWwsIGxpbWl0KSwgZW5kX3RpbWUpOworCWVyciA9IGZ1bmMoaTkxNSwgY3R4LT52bSwgMCwg
bWluKGN0eC0+dm0tPnRvdGFsLCBsaW1pdCksIGVuZF90aW1lKTsKIAogCW1vY2tfY29udGV4dF9j
bG9zZShjdHgpOwogCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggMzZmZjg0MjFjMWEwLi4xYmQxZWU5NWNmOGMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTc1Niw4
ICs3NTYsNyBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiBzdGF0
aWMgc3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGk5MTUtPmtlcm5l
bF9jb250ZXh0OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0KLQkJY3R4LT5wcGd0
dCA/ICZjdHgtPnBwZ3R0LT52bSA6ICZpOTE1LT5nZ3R0LnZtOworCXN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKIAlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOwogCWNvbnN0IGludCBnZW4gPSBJTlRFTF9HRU4oaTkxNSk7CiAJ
c3RydWN0IGk5MTVfdm1hICp2bWE7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3ZtYS5jCmluZGV4IDZmM2U0MWMwY2IzZi4uYTE2NmQ5NDA1YTk0IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtMzgsNyArMzgsNyBAQCBzdGF0aWMgYm9v
bCBhc3NlcnRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogewogCWJvb2wgb2sgPSB0cnVlOwog
Ci0JaWYgKHZtYS0+dm0gIT0gJmN0eC0+cHBndHQtPnZtKSB7CisJaWYgKHZtYS0+dm0gIT0gY3R4
LT52bSkgewogCQlwcl9lcnIoIlZNQSBjcmVhdGVkIHdpdGggd3JvbmcgVk1cbiIpOwogCQlvayA9
IGZhbHNlOwogCX0KQEAgLTExMyw3ICsxMTMsNyBAQCBzdGF0aWMgaW50IGNyZWF0ZV92bWFzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLCBv
YmplY3RzLCBzdF9saW5rKSB7CiAJCWZvciAocGlubmVkID0gMDsgcGlubmVkIDw9IDE7IHBpbm5l
ZCsrKSB7CiAJCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgY29udGV4dHMsIGxpbmspIHsKLQkJ
CQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9ICZjdHgtPnBwZ3R0LT52bTsKKwkJCQlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm07CiAJCQkJc3RydWN0IGk5MTVf
dm1hICp2bWE7CiAJCQkJaW50IGVycjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaWd0X3NwaW5uZXIuYwppbmRleCAzZWE3N2MwY2E2NzguLjFlNTliNTQzY2YyNyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmMKQEAgLTg5LDE3ICs4
OSwxNiBAQCBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaWd0X3NwaW5uZXIgKnNw
aW4sCiAJCQkgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgICB1MzIgYXJi
aXRyYXRpb25fY29tbWFuZCkKIHsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9ICZj
dHgtPnBwZ3R0LT52bTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IE5VTEw7CiAJc3RydWN0
IGk5MTVfdm1hICpod3MsICp2bWE7CiAJdTMyICpiYXRjaDsKIAlpbnQgZXJyOwogCi0Jdm1hID0g
aTkxNV92bWFfaW5zdGFuY2Uoc3Bpbi0+b2JqLCB2bSwgTlVMTCk7CisJdm1hID0gaTkxNV92bWFf
aW5zdGFuY2Uoc3Bpbi0+b2JqLCBjdHgtPnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpCiAJ
CXJldHVybiBFUlJfQ0FTVCh2bWEpOwogCi0JaHdzID0gaTkxNV92bWFfaW5zdGFuY2Uoc3Bpbi0+
aHdzLCB2bSwgTlVMTCk7CisJaHdzID0gaTkxNV92bWFfaW5zdGFuY2Uoc3Bpbi0+aHdzLCBjdHgt
PnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKGh3cykpCiAJCXJldHVybiBFUlJfQ0FTVChod3MpOwog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19ndHQuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2d0dC5jCmluZGV4IGNkODM5Mjlm
ZGU4ZS4uOWU2MWMyZjA2Y2M5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvbW9ja19ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9j
a19ndHQuYwpAQCAtNjUsNyArNjUsNiBAQCBtb2NrX3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCWlmICghcHBndHQpCiAJCXJldHVybiBOVUxMOwogCi0Ja3JlZl9pbml0KCZw
cGd0dC0+cmVmKTsKIAlwcGd0dC0+dm0uaTkxNSA9IGk5MTU7CiAJcHBndHQtPnZtLnRvdGFsID0g
cm91bmRfZG93bihVNjRfTUFYLCBQQUdFX1NJWkUpOwogCXBwZ3R0LT52bS5maWxlID0gRVJSX1BU
UigtRU5PREVWKTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

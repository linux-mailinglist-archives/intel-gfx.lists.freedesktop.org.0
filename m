Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E1B4097A71
	for <lists+intel-gfx@lfdr.de>; Wed, 21 Aug 2019 15:12:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4A9FD6E32A;
	Wed, 21 Aug 2019 13:12:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 677436E32A
 for <intel-gfx@lists.freedesktop.org>; Wed, 21 Aug 2019 13:12:49 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 Aug 2019 06:12:49 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,412,1559545200"; d="scan'208";a="190196561"
Received: from zbarukh-mobl1.ger.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.249.35.52])
 by orsmga002.jf.intel.com with ESMTP; 21 Aug 2019 06:12:47 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 21 Aug 2019 15:12:33 +0200
Message-Id: <20190821131233.16885-3-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190821131233.16885-1-lionel.g.landwerlin@intel.com>
References: <20190821131233.16885-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 2/2] drm/i915: add syncobj timeline support
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW50cm9kdWNlcyBhIG5ldyBwYXJhbWV0ZXJzIHRvIGV4ZWNidWYgc28gdGhhdCB3ZSBjYW4gc3Bl
Y2lmeSBzeW5jb2JqCmhhbmRsZXMgYXMgd2VsbCBhcyB0aW1lbGluZSBwb2ludHMuCgp2MjogUmV1
c2UgaTkxNV91c2VyX2V4dGVuc2lvbl9mbgoKdjM6IENoZWNrIHRoYXQgdGhlIGNoYWluZWQgZXh0
ZW5zaW9uIGlzIG9ubHkgcHJlc2VudCBvbmNlIChDaHJpcykKCnY0OiBDaGVjayB0aGF0IGRtYV9m
ZW5jZV9jaGFpbl9maW5kX3NlcW5vIHJldHVybnMgYSBub24gTlVMTCBmZW5jZSAoTGlvbmVsKQoK
djU6IFVzZSBCSVRfVUxMIChDaHJpcykKCnY2OiBGaXggaXNzdWUgd2l0aCBhbHJlYWR5IHNpZ25h
bGVkIHRpbWVsaW5lIHBvaW50cywKICAgIGRtYV9mZW5jZV9jaGFpbl9maW5kX3NlcW5vKCkgc2V0
dGluZyBmZW5jZSB0byBOVUxMIChDaHJpcykKCnY3OiBSZXBvcnQgRU5PRU5UIHdpdGggaW52YWxp
ZCBzeW5jb2JqIGhhbmRsZSAoTGlvbmVsKQoKdjg6IENoZWNrIGZvciBvdXQgb2Ygb3JkZXIgdGlt
ZWxpbmUgcG9pbnQgaW5zZXJ0aW9uIChDaHJpcykKCnY5OiBBZnRlciBleHBsYW5hdGlvbnMgb24K
ICAgIGh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL2FyY2hpdmVzL2RyaS1kZXZlbC8yMDE5
LUF1Z3VzdC8yMjkyODcuaHRtbAogICAgZHJvcCB0aGUgb3JkZXJpbmcgY2hlY2sgZnJvbSB2OCAo
TGlvbmVsKQoKU2lnbmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3
ZXJsaW5AaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNi
dWZmZXIuYyAgICB8IDMwNyArKysrKysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmMgICAgICAgICAgICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZXRwYXJhbS5jICAgICAgICAgIHwgICAxICsKIGluY2x1ZGUvdWFwaS9kcm0vaTkxNV9k
cm0uaCAgICAgICAgICAgICAgICAgICB8ICAzOSArKysKIDQgZmlsZXMgY2hhbmdlZCwgMjkzIGlu
c2VydGlvbnMoKyksIDU3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IDhkMTk0NjU1NmJjMC4uNmQ1YTIzNGY5Zjli
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZl
ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMK
QEAgLTIxNCw2ICsyMTQsMTMgQEAgZW51bSB7CiAgKiB0aGUgYmF0Y2hidWZmZXIgaW4gdHJ1c3Rl
ZCBtb2RlLCBvdGhlcndpc2UgdGhlIGlvY3RsIGlzIHJlamVjdGVkLgogICovCiAKK3N0cnVjdCBp
OTE1X2ViX2ZlbmNlcyB7CisJc3RydWN0IGRybV9zeW5jb2JqICpzeW5jb2JqOyAvKiBVc2Ugd2l0
aCBwdHJfbWFza19iaXRzKCkgKi8KKwlzdHJ1Y3QgZG1hX2ZlbmNlICpkbWFfZmVuY2U7CisJdTY0
IHZhbHVlOworCXN0cnVjdCBkbWFfZmVuY2VfY2hhaW4gKmNoYWluX2ZlbmNlOworfTsKKwogc3Ry
dWN0IGk5MTVfZXhlY2J1ZmZlciB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTU7IC8q
KiBpOTE1IGJhY2twb2ludGVyICovCiAJc3RydWN0IGRybV9maWxlICpmaWxlOyAvKiogcGVyLWZp
bGUgbG9va3VwIHRhYmxlcyBhbmQgbGltaXRzICovCkBAIC0yNzUsNiArMjgyLDcgQEAgc3RydWN0
IGk5MTVfZXhlY2J1ZmZlciB7CiAKIAlzdHJ1Y3QgewogCQl1NjQgZmxhZ3M7IC8qKiBBdmFpbGFi
bGUgZXh0ZW5zaW9ucyBwYXJhbWV0ZXJzICovCisJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1
ZmZlcl9leHRfdGltZWxpbmVfZmVuY2VzIHRpbWVsaW5lX2ZlbmNlczsKIAl9IGV4dGVuc2lvbnM7
CiB9OwogCkBAIC0yMjk1LDY3ICsyMzAzLDIxNyBAQCBlYl9waW5fZW5naW5lKHN0cnVjdCBpOTE1
X2V4ZWNidWZmZXIgKmViLAogfQogCiBzdGF0aWMgdm9pZAotX19mcmVlX2ZlbmNlX2FycmF5KHN0
cnVjdCBkcm1fc3luY29iaiAqKmZlbmNlcywgdW5zaWduZWQgaW50IG4pCitfX2ZyZWVfZmVuY2Vf
YXJyYXkoc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5jZXMsIHVuc2lnbmVkIGludCBuKQogewot
CXdoaWxlIChuLS0pCi0JCWRybV9zeW5jb2JqX3B1dChwdHJfbWFza19iaXRzKGZlbmNlc1tuXSwg
MikpOworCXdoaWxlIChuLS0pIHsKKwkJZHJtX3N5bmNvYmpfcHV0KHB0cl9tYXNrX2JpdHMoZmVu
Y2VzW25dLnN5bmNvYmosIDIpKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZXNbbl0uZG1hX2ZlbmNl
KTsKKwkJa2ZyZWUoZmVuY2VzW25dLmNoYWluX2ZlbmNlKTsKKwl9CiAJa3ZmcmVlKGZlbmNlcyk7
CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgZHJtX3N5bmNvYmogKioKLWdldF9mZW5jZV9hcnJheShzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdzLAotCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZp
bGUpCitzdGF0aWMgc3RydWN0IGk5MTVfZWJfZmVuY2VzICoKK2dldF90aW1lbGluZV9mZW5jZV9h
cnJheShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwgaW50ICpvdXRfbl9mZW5jZXMpCiB7Ci0J
Y29uc3QgdW5zaWduZWQgbG9uZyBuZmVuY2VzID0gYXJncy0+bnVtX2NsaXByZWN0czsKKwlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXJfZXh0X3RpbWVsaW5lX2ZlbmNlcyAqdGltZWxpbmVf
ZmVuY2VzID0KKwkJJmViLT5leHRlbnNpb25zLnRpbWVsaW5lX2ZlbmNlczsKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX2V4ZWNfZmVuY2UgX191c2VyICp1c2VyX2ZlbmNlczsKKwlzdHJ1Y3QgaTkxNV9l
Yl9mZW5jZXMgKmZlbmNlczsKKwl1NjQgX191c2VyICp1c2VyX3ZhbHVlczsKKwl1NjQgbnVtX2Zl
bmNlcywgbnVtX3VzZXJfZmVuY2VzID0gdGltZWxpbmVfZmVuY2VzLT5mZW5jZV9jb3VudDsKKwl1
bnNpZ25lZCBsb25nIG47CisJaW50IGVycjsKKworCS8qIENoZWNrIG11bHRpcGxpY2F0aW9uIG92
ZXJmbG93IGZvciBhY2Nlc3Nfb2soKSBhbmQga3ZtYWxsb2NfYXJyYXkoKSAqLworCUJVSUxEX0JV
R19PTihzaXplb2Yoc2l6ZV90KSA+IHNpemVvZih1bnNpZ25lZCBsb25nKSk7CisJaWYgKG51bV91
c2VyX2ZlbmNlcyA+IG1pbl90KHVuc2lnbmVkIGxvbmcsCisJCQkJICAgIFVMT05HX01BWCAvIHNp
emVvZigqdXNlcl9mZW5jZXMpLAorCQkJCSAgICBTSVpFX01BWCAvIHNpemVvZigqZmVuY2VzKSkp
CisJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOworCisJdXNlcl9mZW5jZXMgPSB1NjRfdG9fdXNl
cl9wdHIodGltZWxpbmVfZmVuY2VzLT5oYW5kbGVzX3B0cik7CisJaWYgKCFhY2Nlc3Nfb2sodXNl
cl9mZW5jZXMsIG51bV91c2VyX2ZlbmNlcyAqIHNpemVvZigqdXNlcl9mZW5jZXMpKSkKKwkJcmV0
dXJuIEVSUl9QVFIoLUVGQVVMVCk7CisKKwl1c2VyX3ZhbHVlcyA9IHU2NF90b191c2VyX3B0cih0
aW1lbGluZV9mZW5jZXMtPnZhbHVlc19wdHIpOworCWlmICghYWNjZXNzX29rKHVzZXJfdmFsdWVz
LCBudW1fdXNlcl9mZW5jZXMgKiBzaXplb2YoKnVzZXJfdmFsdWVzKSkpCisJCXJldHVybiBFUlJf
UFRSKC1FRkFVTFQpOworCisJZmVuY2VzID0ga3ZtYWxsb2NfYXJyYXkobnVtX3VzZXJfZmVuY2Vz
LCBzaXplb2YoKmZlbmNlcyksCisJCQkJX19HRlBfTk9XQVJOIHwgR0ZQX0tFUk5FTCk7CisJaWYg
KCFmZW5jZXMpCisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCisJQlVJTERfQlVHX09OKH4o
QVJDSF9LTUFMTE9DX01JTkFMSUdOIC0gMSkgJgorCQkgICAgIH5fX0k5MTVfRVhFQ19GRU5DRV9V
TktOT1dOX0ZMQUdTKTsKKworCWZvciAobiA9IDAsIG51bV9mZW5jZXMgPSAwOyBuIDwgdGltZWxp
bmVfZmVuY2VzLT5mZW5jZV9jb3VudDsgbisrKSB7CisJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhl
Y19mZW5jZSB1c2VyX2ZlbmNlOworCQlzdHJ1Y3QgZHJtX3N5bmNvYmogKnN5bmNvYmo7CisJCXN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlID0gTlVMTDsKKwkJdTY0IHBvaW50OworCisJCWlmIChfX2Nv
cHlfZnJvbV91c2VyKCZ1c2VyX2ZlbmNlLCB1c2VyX2ZlbmNlcysrLCBzaXplb2YodXNlcl9mZW5j
ZSkpKSB7CisJCQllcnIgPSAtRUZBVUxUOworCQkJZ290byBlcnI7CisJCX0KKworCQlpZiAodXNl
cl9mZW5jZS5mbGFncyAmIF9fSTkxNV9FWEVDX0ZFTkNFX1VOS05PV05fRkxBR1MpIHsKKwkJCWVy
ciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCWlmIChfX2dldF91c2VyKHBvaW50
LCB1c2VyX3ZhbHVlcysrKSkgeworCQkJZXJyID0gLUVGQVVMVDsKKwkJCWdvdG8gZXJyOworCQl9
CisKKwkJc3luY29iaiA9IGRybV9zeW5jb2JqX2ZpbmQoZWItPmZpbGUsIHVzZXJfZmVuY2UuaGFu
ZGxlKTsKKwkJaWYgKCFzeW5jb2JqKSB7CisJCQlEUk1fREVCVUcoIkludmFsaWQgc3luY29iaiBo
YW5kbGUgcHJvdmlkZWRcbiIpOworCQkJZXJyID0gLUVOT0VOVDsKKwkJCWdvdG8gZXJyOworCQl9
CisKKwkJaWYgKHVzZXJfZmVuY2UuZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfV0FJVCkgeworCQkJ
ZmVuY2UgPSBkcm1fc3luY29ial9mZW5jZV9nZXQoc3luY29iaik7CisJCQlpZiAoIWZlbmNlKSB7
CisJCQkJRFJNX0RFQlVHKCJTeW5jb2JqIGhhbmRsZSBoYXMgbm8gZmVuY2VcbiIpOworCQkJCWRy
bV9zeW5jb2JqX3B1dChzeW5jb2JqKTsKKwkJCQllcnIgPSAtRUlOVkFMOworCQkJCWdvdG8gZXJy
OworCQkJfQorCisJCQllcnIgPSBkbWFfZmVuY2VfY2hhaW5fZmluZF9zZXFubygmZmVuY2UsIHBv
aW50KTsKKwkJCWlmIChlcnIpIHsKKwkJCQlEUk1fREVCVUcoIlN5bmNvYmogaGFuZGxlIG1pc3Np
bmcgcmVxdWVzdGVkIHBvaW50ICVsbHVcbiIsIHBvaW50KTsKKwkJCQlkcm1fc3luY29ial9wdXQo
c3luY29iaik7CisJCQkJZ290byBlcnI7CisJCQl9CisKKwkJCS8qIEEgcG9pbnQgbWlnaHQgaGF2
ZSBiZWVuIHNpZ25hbGVkIGFscmVhZHkgYW5kCisJCQkgKiBnYXJiYWdlIGNvbGxlY3RlZCBmcm9t
IHRoZSB0aW1lbGluZS4gSW4gdGhpcyBjYXNlCisJCQkgKiBqdXN0IGlnbm9yZSB0aGUgcG9pbnQg
YW5kIGNhcnJ5IG9uLgorCQkJICovCisJCQlpZiAoIWZlbmNlKSB7CisJCQkJZHJtX3N5bmNvYmpf
cHV0KHN5bmNvYmopOworCQkJCWNvbnRpbnVlOworCQkJfQorCQl9CisKKwkJLyoKKwkJICogRm9y
IHRpbWVsaW5lIHN5bmNvYmpzIHdlIG5lZWQgdG8gcHJlYWxsb2NhdGUgY2hhaW5zIGZvcgorCQkg
KiBsYXRlciBzaWduYWxpbmcuCisJCSAqLworCQlpZiAocG9pbnQgIT0gMCAmJiB1c2VyX2ZlbmNl
LmZsYWdzICYgSTkxNV9FWEVDX0ZFTkNFX1NJR05BTCkgeworCQkJLyoKKwkJCSAqIFdhaXRpbmcg
YW5kIHNpZ25hbGluZyB0aGUgc2FtZSBwb2ludCAod2hlbiBwb2ludCAhPQorCQkJICogMCkgd291
bGQgYnJlYWsgdGhlIHRpbWVsaW5lLgorCQkJICovCisJCQlpZiAodXNlcl9mZW5jZS5mbGFncyAm
IEk5MTVfRVhFQ19GRU5DRV9XQUlUKSB7CisJCQkJRFJNX0RFQlVHKCJUcmluZyB0byB3YWl0ICYg
c2lnbmFsIHRoZSBzYW1lIHRpbWVsaW5lIHBvaW50LlxuIik7CisJCQkJZXJyID0gLUVJTlZBTDsK
KwkJCQlkcm1fc3luY29ial9wdXQoc3luY29iaik7CisJCQkJZ290byBlcnI7CisJCQl9CisKKwkJ
CWZlbmNlc1tudW1fZmVuY2VzXS5jaGFpbl9mZW5jZSA9CisJCQkJa21hbGxvYyhzaXplb2YoKmZl
bmNlc1tudW1fZmVuY2VzXS5jaGFpbl9mZW5jZSksCisJCQkJCUdGUF9LRVJORUwpOworCQkJaWYg
KCFmZW5jZXNbbnVtX2ZlbmNlc10uY2hhaW5fZmVuY2UpIHsKKwkJCQlkcm1fc3luY29ial9wdXQo
c3luY29iaik7CisJCQkJZXJyID0gLUVOT01FTTsKKwkJCQlEUk1fREVCVUcoIlVuYWJsZSB0byBh
bGxvYyBjaGFpbl9mZW5jZVxuIik7CisJCQkJZ290byBlcnI7CisJCQl9CisJCX0gZWxzZSB7CisJ
CQlmZW5jZXNbbnVtX2ZlbmNlc10uY2hhaW5fZmVuY2UgPSBOVUxMOworCQl9CisKKwkJZmVuY2Vz
W251bV9mZW5jZXNdLnN5bmNvYmogPSBwdHJfcGFja19iaXRzKHN5bmNvYmosIHVzZXJfZmVuY2Uu
ZmxhZ3MsIDIpOworCQlmZW5jZXNbbnVtX2ZlbmNlc10uZG1hX2ZlbmNlID0gZmVuY2U7CisJCWZl
bmNlc1tudW1fZmVuY2VzXS52YWx1ZSA9IHBvaW50OworCQludW1fZmVuY2VzKys7CisJfQorCisJ
Km91dF9uX2ZlbmNlcyA9IG51bV9mZW5jZXM7CisKKwlyZXR1cm4gZmVuY2VzOworCitlcnI6CisJ
X19mcmVlX2ZlbmNlX2FycmF5KGZlbmNlcywgbnVtX2ZlbmNlcyk7CisJcmV0dXJuIEVSUl9QVFIo
ZXJyKTsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X2ViX2ZlbmNlcyAqCitnZXRfbGVnYWN5X2Zl
bmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAorCQkgICAgICAgaW50ICpvdXRf
bl9mZW5jZXMpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiAqYXJncyA9IGVi
LT5hcmdzOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19mZW5jZSBfX3VzZXIgKnVzZXI7Ci0J
c3RydWN0IGRybV9zeW5jb2JqICoqZmVuY2VzOworCXN0cnVjdCBpOTE1X2ViX2ZlbmNlcyAqZmVu
Y2VzOworCWNvbnN0IHUzMiBudW1fZmVuY2VzID0gYXJncy0+bnVtX2NsaXByZWN0czsKIAl1bnNp
Z25lZCBsb25nIG47CiAJaW50IGVycjsKIAotCWlmICghKGFyZ3MtPmZsYWdzICYgSTkxNV9FWEVD
X0ZFTkNFX0FSUkFZKSkKLQkJcmV0dXJuIE5VTEw7CisJKm91dF9uX2ZlbmNlcyA9IG51bV9mZW5j
ZXM7CiAKIAkvKiBDaGVjayBtdWx0aXBsaWNhdGlvbiBvdmVyZmxvdyBmb3IgYWNjZXNzX29rKCkg
YW5kIGt2bWFsbG9jX2FycmF5KCkgKi8KIAlCVUlMRF9CVUdfT04oc2l6ZW9mKHNpemVfdCkgPiBz
aXplb2YodW5zaWduZWQgbG9uZykpOwotCWlmIChuZmVuY2VzID4gbWluX3QodW5zaWduZWQgbG9u
ZywKLQkJCSAgICBVTE9OR19NQVggLyBzaXplb2YoKnVzZXIpLAotCQkJICAgIFNJWkVfTUFYIC8g
c2l6ZW9mKCpmZW5jZXMpKSkKKwlpZiAoKm91dF9uX2ZlbmNlcyA+IG1pbl90KHVuc2lnbmVkIGxv
bmcsCisJCQkJICBVTE9OR19NQVggLyBzaXplb2YoKnVzZXIpLAorCQkJCSAgU0laRV9NQVggLyBz
aXplb2YoKmZlbmNlcykpKQogCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIAogCXVzZXIgPSB1
NjRfdG9fdXNlcl9wdHIoYXJncy0+Y2xpcHJlY3RzX3B0cik7Ci0JaWYgKCFhY2Nlc3Nfb2sodXNl
ciwgbmZlbmNlcyAqIHNpemVvZigqdXNlcikpKQorCWlmICghYWNjZXNzX29rKHVzZXIsICpvdXRf
bl9mZW5jZXMgKiBzaXplb2YoKnVzZXIpKSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVGQVVMVCk7CiAK
LQlmZW5jZXMgPSBrdm1hbGxvY19hcnJheShuZmVuY2VzLCBzaXplb2YoKmZlbmNlcyksCisJZmVu
Y2VzID0ga3ZtYWxsb2NfYXJyYXkoKm91dF9uX2ZlbmNlcywgc2l6ZW9mKCpmZW5jZXMpLAogCQkJ
CV9fR0ZQX05PV0FSTiB8IEdGUF9LRVJORUwpOwogCWlmICghZmVuY2VzKQogCQlyZXR1cm4gRVJS
X1BUUigtRU5PTUVNKTsKIAotCWZvciAobiA9IDA7IG4gPCBuZmVuY2VzOyBuKyspIHsKLQkJc3Ry
dWN0IGRybV9pOTE1X2dlbV9leGVjX2ZlbmNlIGZlbmNlOworCWZvciAobiA9IDA7IG4gPCAqb3V0
X25fZmVuY2VzOyBuKyspIHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX2ZlbmNlIHVzZXJf
ZmVuY2U7CiAJCXN0cnVjdCBkcm1fc3luY29iaiAqc3luY29iajsKKwkJc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UgPSBOVUxMOwogCi0JCWlmIChfX2NvcHlfZnJvbV91c2VyKCZmZW5jZSwgdXNlcisr
LCBzaXplb2YoZmVuY2UpKSkgeworCQlpZiAoX19jb3B5X2Zyb21fdXNlcigmdXNlcl9mZW5jZSwg
dXNlcisrLCBzaXplb2YodXNlcl9mZW5jZSkpKSB7CiAJCQllcnIgPSAtRUZBVUxUOwogCQkJZ290
byBlcnI7CiAJCX0KIAotCQlpZiAoZmVuY2UuZmxhZ3MgJiBfX0k5MTVfRVhFQ19GRU5DRV9VTktO
T1dOX0ZMQUdTKSB7CisJCWlmICh1c2VyX2ZlbmNlLmZsYWdzICYgX19JOTE1X0VYRUNfRkVOQ0Vf
VU5LTk9XTl9GTEFHUykgewogCQkJZXJyID0gLUVJTlZBTDsKIAkJCWdvdG8gZXJyOwogCQl9CiAK
LQkJc3luY29iaiA9IGRybV9zeW5jb2JqX2ZpbmQoZmlsZSwgZmVuY2UuaGFuZGxlKTsKKwkJc3lu
Y29iaiA9IGRybV9zeW5jb2JqX2ZpbmQoZWItPmZpbGUsIHVzZXJfZmVuY2UuaGFuZGxlKTsKIAkJ
aWYgKCFzeW5jb2JqKSB7CiAJCQlEUk1fREVCVUcoIkludmFsaWQgc3luY29iaiBoYW5kbGUgcHJv
dmlkZWRcbiIpOwogCQkJZXJyID0gLUVOT0VOVDsKIAkJCWdvdG8gZXJyOwogCQl9CiAKKwkJaWYg
KHVzZXJfZmVuY2UuZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfV0FJVCkgeworCQkJZmVuY2UgPSBk
cm1fc3luY29ial9mZW5jZV9nZXQoc3luY29iaik7CisJCQlpZiAoIWZlbmNlKSB7CisJCQkJRFJN
X0RFQlVHKCJTeW5jb2JqIGhhbmRsZSBoYXMgbm8gZmVuY2VcbiIpOworCQkJCWRybV9zeW5jb2Jq
X3B1dChzeW5jb2JqKTsKKwkJCQllcnIgPSAtRUlOVkFMOworCQkJCWdvdG8gZXJyOworCQkJfQor
CQl9CisKIAkJQlVJTERfQlVHX09OKH4oQVJDSF9LTUFMTE9DX01JTkFMSUdOIC0gMSkgJgogCQkJ
ICAgICB+X19JOTE1X0VYRUNfRkVOQ0VfVU5LTk9XTl9GTEFHUyk7CiAKLQkJZmVuY2VzW25dID0g
cHRyX3BhY2tfYml0cyhzeW5jb2JqLCBmZW5jZS5mbGFncywgMik7CisJCWZlbmNlc1tuXS5zeW5j
b2JqID0gcHRyX3BhY2tfYml0cyhzeW5jb2JqLCB1c2VyX2ZlbmNlLmZsYWdzLCAyKTsKKwkJZmVu
Y2VzW25dLmRtYV9mZW5jZSA9IGZlbmNlOworCQlmZW5jZXNbbl0udmFsdWUgPSAwOworCQlmZW5j
ZXNbbl0uY2hhaW5fZmVuY2UgPSBOVUxMOwogCX0KIAogCXJldHVybiBmZW5jZXM7CkBAIC0yMzY1
LDM3ICsyNTIzLDQ0IEBAIGdldF9mZW5jZV9hcnJheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNi
dWZmZXIyICphcmdzLAogCXJldHVybiBFUlJfUFRSKGVycik7CiB9CiAKK3N0YXRpYyBzdHJ1Y3Qg
aTkxNV9lYl9mZW5jZXMgKgorZ2V0X2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIg
KmViLCBpbnQgKm91dF9uX2ZlbmNlcykKK3sKKwlpZiAoZWItPmFyZ3MtPmZsYWdzICYgSTkxNV9F
WEVDX0ZFTkNFX0FSUkFZKQorCQlyZXR1cm4gZ2V0X2xlZ2FjeV9mZW5jZV9hcnJheShlYiwgb3V0
X25fZmVuY2VzKTsKKworCWlmIChlYi0+ZXh0ZW5zaW9ucy5mbGFncyAmIEJJVF9VTEwoRFJNX0k5
MTVfR0VNX0VYRUNCVUZGRVJfRVhUX1RJTUVMSU5FX0ZFTkNFUykpCisJCXJldHVybiBnZXRfdGlt
ZWxpbmVfZmVuY2VfYXJyYXkoZWIsIG91dF9uX2ZlbmNlcyk7CisKKwkqb3V0X25fZmVuY2VzID0g
MDsKKwlyZXR1cm4gTlVMTDsKK30KKwogc3RhdGljIHZvaWQKLXB1dF9mZW5jZV9hcnJheShzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdzLAotCQlzdHJ1Y3QgZHJtX3N5bmNvYmog
KipmZW5jZXMpCitwdXRfZmVuY2VfYXJyYXkoc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5jZXMs
IGludCBuZmVuY2VzKQogewogCWlmIChmZW5jZXMpCi0JCV9fZnJlZV9mZW5jZV9hcnJheShmZW5j
ZXMsIGFyZ3MtPm51bV9jbGlwcmVjdHMpOworCQlfX2ZyZWVfZmVuY2VfYXJyYXkoZmVuY2VzLCBu
ZmVuY2VzKTsKIH0KIAogc3RhdGljIGludAogYXdhaXRfZmVuY2VfYXJyYXkoc3RydWN0IGk5MTVf
ZXhlY2J1ZmZlciAqZWIsCi0JCSAgc3RydWN0IGRybV9zeW5jb2JqICoqZmVuY2VzKQorCQkgIHN0
cnVjdCBpOTE1X2ViX2ZlbmNlcyAqZmVuY2VzLAorCQkgIGludCBuZmVuY2VzKQogewotCWNvbnN0
IHVuc2lnbmVkIGludCBuZmVuY2VzID0gZWItPmFyZ3MtPm51bV9jbGlwcmVjdHM7CiAJdW5zaWdu
ZWQgaW50IG47CiAJaW50IGVycjsKIAogCWZvciAobiA9IDA7IG4gPCBuZmVuY2VzOyBuKyspIHsK
IAkJc3RydWN0IGRybV9zeW5jb2JqICpzeW5jb2JqOwotCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZTsKIAkJdW5zaWduZWQgaW50IGZsYWdzOwogCi0JCXN5bmNvYmogPSBwdHJfdW5wYWNrX2JpdHMo
ZmVuY2VzW25dLCAmZmxhZ3MsIDIpOworCQlzeW5jb2JqID0gcHRyX3VucGFja19iaXRzKGZlbmNl
c1tuXS5zeW5jb2JqLCAmZmxhZ3MsIDIpOwogCQlpZiAoIShmbGFncyAmIEk5MTVfRVhFQ19GRU5D
RV9XQUlUKSkKIAkJCWNvbnRpbnVlOwogCi0JCWZlbmNlID0gZHJtX3N5bmNvYmpfZmVuY2VfZ2V0
KHN5bmNvYmopOwotCQlpZiAoIWZlbmNlKQotCQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQkJZXJyID0g
aTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShlYi0+cmVxdWVzdCwgZmVuY2UpOwotCQlkbWFf
ZmVuY2VfcHV0KGZlbmNlKTsKKwkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShl
Yi0+cmVxdWVzdCwKKwkJCQkJCSAgIGZlbmNlc1tuXS5kbWFfZmVuY2UpOwogCQlpZiAoZXJyIDwg
MCkKIAkJCXJldHVybiBlcnI7CiAJfQpAQCAtMjQwNSw5ICsyNTcwLDkgQEAgYXdhaXRfZmVuY2Vf
YXJyYXkoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAKIHN0YXRpYyB2b2lkCiBzaWduYWxf
ZmVuY2VfYXJyYXkoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCi0JCSAgIHN0cnVjdCBkcm1f
c3luY29iaiAqKmZlbmNlcykKKwkJICAgc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5jZXMsCisJ
CSAgIGludCBuZmVuY2VzKQogewotCWNvbnN0IHVuc2lnbmVkIGludCBuZmVuY2VzID0gZWItPmFy
Z3MtPm51bV9jbGlwcmVjdHM7CiAJc3RydWN0IGRtYV9mZW5jZSAqIGNvbnN0IGZlbmNlID0gJmVi
LT5yZXF1ZXN0LT5mZW5jZTsKIAl1bnNpZ25lZCBpbnQgbjsKIApAQCAtMjQxNSwxNSArMjU4MCw0
NiBAQCBzaWduYWxfZmVuY2VfYXJyYXkoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJCXN0
cnVjdCBkcm1fc3luY29iaiAqc3luY29iajsKIAkJdW5zaWduZWQgaW50IGZsYWdzOwogCi0JCXN5
bmNvYmogPSBwdHJfdW5wYWNrX2JpdHMoZmVuY2VzW25dLCAmZmxhZ3MsIDIpOworCQlzeW5jb2Jq
ID0gcHRyX3VucGFja19iaXRzKGZlbmNlc1tuXS5zeW5jb2JqLCAmZmxhZ3MsIDIpOwogCQlpZiAo
IShmbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9TSUdOQUwpKQogCQkJY29udGludWU7CiAKLQkJZHJt
X3N5bmNvYmpfcmVwbGFjZV9mZW5jZShzeW5jb2JqLCBmZW5jZSk7CisJCWlmIChmZW5jZXNbbl0u
Y2hhaW5fZmVuY2UpIHsKKwkJCWRybV9zeW5jb2JqX2FkZF9wb2ludChzeW5jb2JqLCBmZW5jZXNb
bl0uY2hhaW5fZmVuY2UsCisJCQkJCSAgICAgIGZlbmNlLCBmZW5jZXNbbl0udmFsdWUpOworCQkJ
LyoKKwkJCSAqIFRoZSBjaGFpbidzIG93bmVyc2hpcCBpcyB0cmFuc2ZlcmVkIHRvIHRoZQorCQkJ
ICogdGltZWxpbmUuCisJCQkgKi8KKwkJCWZlbmNlc1tuXS5jaGFpbl9mZW5jZSA9IE5VTEw7CisJ
CX0gZWxzZSB7CisJCQlkcm1fc3luY29ial9yZXBsYWNlX2ZlbmNlKHN5bmNvYmosIGZlbmNlKTsK
KwkJfQogCX0KIH0KIAorc3RhdGljIGludCBwYXJzZV90aW1lbGluZV9mZW5jZXMoc3RydWN0IGk5
MTVfdXNlcl9leHRlbnNpb24gX191c2VyICpleHQsIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGk5
MTVfZXhlY2J1ZmZlciAqZWIgPSBkYXRhOworCisJLyogVGltZWxpbmUgZmVuY2VzIGFyZSBpbmNv
bXBhdGlibGUgd2l0aCB0aGUgZmVuY2UgYXJyYXkgZmxhZy4gKi8KKwlpZiAoZWItPmFyZ3MtPmZs
YWdzICYgSTkxNV9FWEVDX0ZFTkNFX0FSUkFZKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChl
Yi0+ZXh0ZW5zaW9ucy5mbGFncyAmIEJJVF9VTEwoRFJNX0k5MTVfR0VNX0VYRUNCVUZGRVJfRVhU
X1RJTUVMSU5FX0ZFTkNFUykpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKGNvcHlfZnJvbV91
c2VyKCZlYi0+ZXh0ZW5zaW9ucy50aW1lbGluZV9mZW5jZXMsIGV4dCwKKwkJCSAgIHNpemVvZihl
Yi0+ZXh0ZW5zaW9ucy50aW1lbGluZV9mZW5jZXMpKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwll
Yi0+ZXh0ZW5zaW9ucy5mbGFncyB8PSBCSVRfVUxMKERSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VY
VF9USU1FTElORV9GRU5DRVMpOworCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBjb25zdCBpOTE1
X3VzZXJfZXh0ZW5zaW9uX2ZuIGV4ZWNidWZfZXh0ZW5zaW9uc1tdID0geworICAgICAgICBbRFJN
X0k5MTVfR0VNX0VYRUNCVUZGRVJfRVhUX1RJTUVMSU5FX0ZFTkNFU10gPSBwYXJzZV90aW1lbGlu
ZV9mZW5jZXMsCiB9OwogCiBzdGF0aWMgaW50CkBAIC0yNDU0LDE0ICsyNjUwLDE1IEBAIHN0YXRp
YyBpbnQKIGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJ
ICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSwKIAkJICAgICAgIHN0cnVjdCBkcm1faTkxNV9n
ZW1fZXhlY2J1ZmZlcjIgKmFyZ3MsCi0JCSAgICAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNf
b2JqZWN0MiAqZXhlYywKLQkJICAgICAgIHN0cnVjdCBkcm1fc3luY29iaiAqKmZlbmNlcykKKwkJ
ICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyICpleGVjKQogewogCXN0cnVj
dCBpOTE1X2V4ZWNidWZmZXIgZWI7CiAJc3RydWN0IGRtYV9mZW5jZSAqaW5fZmVuY2UgPSBOVUxM
OwogCXN0cnVjdCBkbWFfZmVuY2UgKmV4ZWNfZmVuY2UgPSBOVUxMOwogCXN0cnVjdCBzeW5jX2Zp
bGUgKm91dF9mZW5jZSA9IE5VTEw7CisJc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5jZXMgPSBO
VUxMOwogCWludCBvdXRfZmVuY2VfZmQgPSAtMTsKKwlpbnQgbmZlbmNlcyA9IDA7CiAJaW50IGVy
cjsKIAogCUJVSUxEX0JVR19PTihfX0VYRUNfSU5URVJOQUxfRkxBR1MgJiB+X19JOTE1X0VYRUNf
SUxMRUdBTF9GTEFHUyk7CkBAIC0yNTAwLDEwICsyNjk3LDE2IEBAIGk5MTVfZ2VtX2RvX2V4ZWNi
dWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwog
CisJZmVuY2VzID0gZ2V0X2ZlbmNlX2FycmF5KCZlYiwgJm5mZW5jZXMpOworCWlmIChJU19FUlIo
ZmVuY2VzKSkKKwkJcmV0dXJuIFBUUl9FUlIoZmVuY2VzKTsKKwogCWlmIChhcmdzLT5mbGFncyAm
IEk5MTVfRVhFQ19GRU5DRV9JTikgewogCQlpbl9mZW5jZSA9IHN5bmNfZmlsZV9nZXRfZmVuY2Uo
bG93ZXJfMzJfYml0cyhhcmdzLT5yc3ZkMikpOwotCQlpZiAoIWluX2ZlbmNlKQotCQkJcmV0dXJu
IC1FSU5WQUw7CisJCWlmICghaW5fZmVuY2UpIHsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3Rv
IGVycl9mZW5jZXM7CisJCX0KIAl9CiAKIAlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNfRkVO
Q0VfU1VCTUlUKSB7CkBAIC0yNjQ4LDcgKzI4NTEsNyBAQCBpOTE1X2dlbV9kb19leGVjYnVmZmVy
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJfQogCiAJaWYgKGZlbmNlcykgewotCQllcnIgPSBh
d2FpdF9mZW5jZV9hcnJheSgmZWIsIGZlbmNlcyk7CisJCWVyciA9IGF3YWl0X2ZlbmNlX2FycmF5
KCZlYiwgZmVuY2VzLCBuZmVuY2VzKTsKIAkJaWYgKGVycikKIAkJCWdvdG8gZXJyX3JlcXVlc3Q7
CiAJfQpAQCAtMjY3OSw3ICsyODgyLDcgQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogCWk5MTVfcmVxdWVzdF9hZGQoZWIucmVxdWVzdCk7CiAKIAlpZiAo
ZmVuY2VzKQotCQlzaWduYWxfZmVuY2VfYXJyYXkoJmViLCBmZW5jZXMpOworCQlzaWduYWxfZmVu
Y2VfYXJyYXkoJmViLCBmZW5jZXMsIG5mZW5jZXMpOwogCiAJaWYgKG91dF9mZW5jZSkgewogCQlp
ZiAoZXJyID09IDApIHsKQEAgLTI3MTQsNiArMjkxNyw4IEBAIGk5MTVfZ2VtX2RvX2V4ZWNidWZm
ZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlkbWFfZmVuY2VfcHV0KGV4ZWNfZmVuY2UpOwog
ZXJyX2luX2ZlbmNlOgogCWRtYV9mZW5jZV9wdXQoaW5fZmVuY2UpOworZXJyX2ZlbmNlczoKKwlw
dXRfZmVuY2VfYXJyYXkoZmVuY2VzLCBuZmVuY2VzKTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0y
ODA3LDcgKzMwMTIsNyBAQCBpOTE1X2dlbV9leGVjYnVmZmVyX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQlleGVjMl9saXN0W2ldLmZsYWdzID0gMDsKIAl9CiAK
LQllcnIgPSBpOTE1X2dlbV9kb19leGVjYnVmZmVyKGRldiwgZmlsZSwgJmV4ZWMyLCBleGVjMl9s
aXN0LCBOVUxMKTsKKwllcnIgPSBpOTE1X2dlbV9kb19leGVjYnVmZmVyKGRldiwgZmlsZSwgJmV4
ZWMyLCBleGVjMl9saXN0KTsKIAlpZiAoZXhlYzIuZmxhZ3MgJiBfX0VYRUNfSEFTX1JFTE9DKSB7
CiAJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QgX191c2VyICp1c2VyX2V4ZWNfbGlz
dCA9CiAJCQl1NjRfdG9fdXNlcl9wdHIoYXJncy0+YnVmZmVyc19wdHIpOwpAQCAtMjgzOCw3ICsz
MDQzLDYgQEAgaTkxNV9nZW1fZXhlY2J1ZmZlcjJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdz
ID0gZGF0YTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiAqZXhlYzJfbGlzdDsK
LQlzdHJ1Y3QgZHJtX3N5bmNvYmogKipmZW5jZXMgPSBOVUxMOwogCWNvbnN0IHNpemVfdCBjb3Vu
dCA9IGFyZ3MtPmJ1ZmZlcl9jb3VudDsKIAlpbnQgZXJyOwogCkBAIC0yODY2LDE1ICszMDcwLDcg
QEAgaTkxNV9nZW1fZXhlY2J1ZmZlcjJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJcmV0dXJuIC1FRkFVTFQ7CiAJfQogCi0JaWYgKGFyZ3MtPmZsYWdzICYgSTkx
NV9FWEVDX0ZFTkNFX0FSUkFZKSB7Ci0JCWZlbmNlcyA9IGdldF9mZW5jZV9hcnJheShhcmdzLCBm
aWxlKTsKLQkJaWYgKElTX0VSUihmZW5jZXMpKSB7Ci0JCQlrdmZyZWUoZXhlYzJfbGlzdCk7Ci0J
CQlyZXR1cm4gUFRSX0VSUihmZW5jZXMpOwotCQl9Ci0JfQotCi0JZXJyID0gaTkxNV9nZW1fZG9f
ZXhlY2J1ZmZlcihkZXYsIGZpbGUsIGFyZ3MsIGV4ZWMyX2xpc3QsIGZlbmNlcyk7CisJZXJyID0g
aTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihkZXYsIGZpbGUsIGFyZ3MsIGV4ZWMyX2xpc3QpOwogCiAJ
LyoKIAkgKiBOb3cgdGhhdCB3ZSBoYXZlIGJlZ3VuIGV4ZWN1dGlvbiBvZiB0aGUgYmF0Y2hidWZm
ZXIsIHdlIGlnbm9yZQpAQCAtMjkxNCw3ICszMTEwLDYgQEAgZW5kOjsKIAl9CiAKIAlhcmdzLT5m
bGFncyAmPSB+X19JOTE1X0VYRUNfVU5LTk9XTl9GTEFHUzsKLQlwdXRfZmVuY2VfYXJyYXkoYXJn
cywgZmVuY2VzKTsKIAlrdmZyZWUoZXhlYzJfbGlzdCk7CiAJcmV0dXJuIGVycjsKIH0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5jCmluZGV4IGI1YjJhNjQ3NTNlNi4uNGRiMjRmMDZmMzIzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTI4NTEsNyArMjg1MSw4IEBAIHN0YXRpYyBzdHJ1Y3QgZHJt
X2RyaXZlciBkcml2ZXIgPSB7CiAJICovCiAJLmRyaXZlcl9mZWF0dXJlcyA9CiAJICAgIERSSVZF
Ul9HRU0gfAotCSAgICBEUklWRVJfUkVOREVSIHwgRFJJVkVSX01PREVTRVQgfCBEUklWRVJfQVRP
TUlDIHwgRFJJVkVSX1NZTkNPQkosCisJICAgIERSSVZFUl9SRU5ERVIgfCBEUklWRVJfTU9ERVNF
VCB8IERSSVZFUl9BVE9NSUMgfCBEUklWRVJfU1lOQ09CSiB8CisJICAgIERSSVZFUl9TWU5DT0JK
X1RJTUVMSU5FLAogCS5yZWxlYXNlID0gaTkxNV9kcml2ZXJfcmVsZWFzZSwKIAkub3BlbiA9IGk5
MTVfZHJpdmVyX29wZW4sCiAJLmxhc3RjbG9zZSA9IGk5MTVfZHJpdmVyX2xhc3RjbG9zZSwKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2V0cGFyYW0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2V0cGFyYW0uYwppbmRleCA1ZDkxMDEzNzZhM2QuLmRhNmZhYTg0
ZTViOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZXRwYXJhbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2V0cGFyYW0uYwpAQCAtMTMwLDYgKzEzMCw3
IEBAIGludCBpOTE1X2dldHBhcmFtX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQg
KmRhdGEsCiAJY2FzZSBJOTE1X1BBUkFNX0hBU19FWEVDX0JBVENIX0ZJUlNUOgogCWNhc2UgSTkx
NV9QQVJBTV9IQVNfRVhFQ19GRU5DRV9BUlJBWToKIAljYXNlIEk5MTVfUEFSQU1fSEFTX0VYRUNf
U1VCTUlUX0ZFTkNFOgorCWNhc2UgSTkxNV9QQVJBTV9IQVNfRVhFQ19USU1FTElORV9GRU5DRVM6
CiAJCS8qIEZvciB0aGUgdGltZSBiZWluZyBhbGwgb2YgdGhlc2UgYXJlIGFsd2F5cyB0cnVlOwog
CQkgKiBpZiBzb21lIHN1cHBvcnRlZCBoYXJkd2FyZSBkb2VzIG5vdCBoYXZlIG9uZSBvZiB0aGVz
ZQogCQkgKiBmZWF0dXJlcyB0aGlzIHZhbHVlIG5lZWRzIHRvIGJlIHByb3ZpZGVkIGZyb20KZGlm
ZiAtLWdpdCBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaCBiL2luY2x1ZGUvdWFwaS9kcm0v
aTkxNV9kcm0uaAppbmRleCAwYTk5YzI2NzMwZTEuLmU4NjY5MWMxOGE1NiAxMDA2NDQKLS0tIGEv
aW5jbHVkZS91YXBpL2RybS9pOTE1X2RybS5oCisrKyBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9k
cm0uaApAQCAtNjExLDYgKzYxMSwxMyBAQCB0eXBlZGVmIHN0cnVjdCBkcm1faTkxNV9pcnFfd2Fp
dCB7CiAgKiBTZWUgSTkxNV9FWEVDX0ZFTkNFX09VVCBhbmQgSTkxNV9FWEVDX0ZFTkNFX1NVQk1J
VC4KICAqLwogI2RlZmluZSBJOTE1X1BBUkFNX0hBU19FWEVDX1NVQk1JVF9GRU5DRSA1MworCisv
KiBRdWVyeSB3aGV0aGVyIERSTV9JOTE1X0dFTV9FWEVDQlVGRkVSMiBzdXBwb3J0cyBzdXBwbHlp
bmcgYW4gYXJyYXkgb2YKKyAqIHRpbWVsaW5lIHN5bmNvYmogdGhyb3VnaCBkcm1faTkxNV9nZW1f
ZXhlY2J1Zl9leHRfdGltZWxpbmVfZmVuY2VzLiBTZWUKKyAqIEk5MTVfRVhFQ19VU0VfRVhURU5T
SU9OUy4KKyAqLworI2RlZmluZSBJOTE1X1BBUkFNX0hBU19FWEVDX1RJTUVMSU5FX0ZFTkNFUyA1
NAorCiAvKiBNdXN0IGJlIGtlcHQgY29tcGFjdCAtLSBubyBob2xlcyBhbmQgd2VsbCBkb2N1bWVu
dGVkICovCiAKIHR5cGVkZWYgc3RydWN0IGRybV9pOTE1X2dldHBhcmFtIHsKQEAgLTEwMDgsOSAr
MTAxNSw0MSBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVuY2UgewogfTsKIAogZW51bSBk
cm1faTkxNV9nZW1fZXhlY2J1ZmZlcl9leHQgeworCS8qKgorCSAqIFNlZSBkcm1faTkxNV9nZW1f
ZXhlY2J1Zl9leHRfdGltZWxpbmVfZmVuY2VzLgorCSAqLworCURSTV9JOTE1X0dFTV9FWEVDQlVG
RkVSX0VYVF9USU1FTElORV9GRU5DRVMgPSAwLAorCiAJRFJNX0k5MTVfR0VNX0VYRUNCVUZGRVJf
RVhUX01BWCAvKiBub24tQUJJICovCiB9OwogCisvKioKKyAqIFRoaXMgc3RydWN0dXJlIGRlc2Ny
aWJlcyBhbiBhcnJheSBvZiBkcm1fc3luY29iaiBhbmQgYXNzb2NpYXRlZCBwb2ludHMgZm9yCisg
KiB0aW1lbGluZSB2YXJpYW50cyBvZiBkcm1fc3luY29iai4gSXQgaXMgaW52YWxpZCB0byBhcHBl
bmQgdGhpcyBzdHJ1Y3R1cmUgdG8KKyAqIHRoZSBleGVjYnVmIGlmIEk5MTVfRVhFQ19GRU5DRV9B
UlJBWSBpcyBzZXQuCisgKi8KK3N0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcl9leHRfdGlt
ZWxpbmVfZmVuY2VzIHsKKwlzdHJ1Y3QgaTkxNV91c2VyX2V4dGVuc2lvbiBiYXNlOworCisJLyoq
CisJICogTnVtYmVyIG9mIGVsZW1lbnQgaW4gdGhlIGhhbmRsZXNfcHRyICYgdmFsdWVfcHRyIGFy
cmF5cy4KKwkgKi8KKwlfX3U2NCBmZW5jZV9jb3VudDsKKworCS8qKgorCSAqIFBvaW50ZXIgdG8g
YW4gYXJyYXkgb2Ygc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX2ZlbmNlIG9mIGxlbmd0aAorCSAq
IGZlbmNlX2NvdW50LgorCSAqLworCV9fdTY0IGhhbmRsZXNfcHRyOworCisJLyoqCisJICogUG9p
bnRlciB0byBhbiBhcnJheSBvZiB1NjQgdmFsdWVzIG9mIGxlbmd0aCBmZW5jZV9jb3VudC4gVmFs
dWVzCisJICogbXVzdCBiZSAwIGZvciBhIGJpbmFyeSBkcm1fc3luY29iai4gQSBWYWx1ZSBvZiAw
IGZvciBhIHRpbWVsaW5lCisJICogZHJtX3N5bmNvYmogaXMgaW52YWxpZCBhcyBpdCB0dXJucyBh
IGRybV9zeW5jb2JqIGludG8gYSBiaW5hcnkgb25lLgorCSAqLworCV9fdTY0IHZhbHVlc19wdHI7
Cit9OworCiBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIHsKIAkvKioKIAkgKiBMaXN0
IG9mIGdlbV9leGVjX29iamVjdDIgc3RydWN0cwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

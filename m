Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 48114D31AC
	for <lists+intel-gfx@lfdr.de>; Thu, 10 Oct 2019 21:49:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 656536EB7A;
	Thu, 10 Oct 2019 19:49:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E2FA26EA61
 for <intel-gfx@lists.freedesktop.org>; Thu, 10 Oct 2019 19:48:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18796082-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 10 Oct 2019 20:48:53 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 10 Oct 2019 20:48:46 +0100
Message-Id: <20191010194851.26592-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191010194851.26592-1-chris@chris-wilson.co.uk>
References: <20191010194851.26592-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 4/9] drm/i915: add support for perf configuration
 queries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
TGlzdGluZyBjb25maWd1cmF0aW9ucyBhdCB0aGUgbW9tZW50IGlzIHN1cHBvcnRlZCBvbmx5IHRo
cm91Z2ggc3lzZnMuClRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIGZvciBhcHBsaWNhdGlvbnMgd2Fu
dGluZyB0byBsaXN0CmNvbmZpZ3VyYXRpb25zIGZyb20gYSBjb250YWluZXIgd2hlcmUgc3lzZnMg
aXNuJ3QgYXZhaWxhYmxlLgoKVGhpcyBjaGFuZ2UgYWRkcyBhIHdheSB0byBxdWVyeSB0aGUgbnVt
YmVyIG9mIGNvbmZpZ3VyYXRpb25zIGFuZCB0aGVpcgpjb250ZW50IHRocm91Z2ggdGhlIGk5MTUg
cXVlcnkgdUFQSS4KCnYyOiBGaXggc3BhcnNlIHdhcm5pbmdzIChMaW9uZWwpCiAgICBBZGQgc3Vw
cG9ydCB0byBxdWVyeSBjb25maWd1cmF0aW9uIHVzaW5nIHV1aWQgKExpb25lbCkKCnYzOiBGaXgg
c29tZSBpbmNvbnNpc3RlbmN5IGluIHVhcGkgaGVhZGVyIChMaW9uZWwpCiAgICBGaXggdW5sb2Nr
aW5nIHdoZW4gbm90IGxvY2tlZCBpc3N1ZSAoTGlvbmVsKQogICAgQWRkIGRlYnVnIG1lc3NhZ2Vz
IChMaW9uZWwpCgp2NDogRml4IG1pc3NpbmcgdW5sb2NrIChEYW4pCgp2NTogRHJvcCBsb2NrIHdo
ZW4gY29weWluZyBjb25maWcgY29udGVudCB0byB1c2Vyc3BhY2UgKENocmlzKQoKdjY6IERyb3Ag
bG9jayB3aGVuIGNvcHlpbmcgY29uZmlnIGxpc3QgdG8gdXNlcnNwYWNlIChDaHJpcykKICAgIEZp
eCBkZWFkbG9jayB3aGVuIGNhbGxpbmcgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoKSB1bmRlcgog
ICAgcGVyZi5tZXRyaWNzX2xvY2sgKExpb25lbCkKICAgIEFkZCBpOTE1X29hX2NvbmZpZ19nZXQo
KSAoQ2hyaXMpCgpTaWduZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFu
ZHdlcmxpbkBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13
aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgIHwgICAz
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMgfCAyOTUgKysrKysrKysrKysr
KysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggICAgICAgfCAg
NjIgKysrKysrLQogMyBmaWxlcyBjaGFuZ2VkLCAzNTcgaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDVmYTBkZjQ2ZmNjMy4uN2Q3YmFl
ZTdmZWJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMzQ3Myw4ICszNDczLDcgQEAg
aW50IGk5MTVfcGVyZl9yZW1vdmVfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHZvaWQgKmRhdGEsCiAKIAlHRU1fQlVHX09OKCphcmcgIT0gb2FfY29uZmlnLT5pZCk7CiAKLQlz
eXNmc19yZW1vdmVfZ3JvdXAocGVyZi0+bWV0cmljc19rb2JqLAotCQkJICAgJm9hX2NvbmZpZy0+
c3lzZnNfbWV0cmljKTsKKwlzeXNmc19yZW1vdmVfZ3JvdXAocGVyZi0+bWV0cmljc19rb2JqLCAm
b2FfY29uZmlnLT5zeXNmc19tZXRyaWMpOwogCiAJaWRyX3JlbW92ZSgmcGVyZi0+bWV0cmljc19p
ZHIsICphcmcpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKaW5kZXggYWJhYzUwNDJkYTJi
Li42YTY4ZWNjN2JiNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcXVl
cnkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKQEAgLTcsNiArNyw3
IEBACiAjaW5jbHVkZSA8bGludXgvbm9zcGVjLmg+CiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgor
I2luY2x1ZGUgImk5MTVfcGVyZi5oIgogI2luY2x1ZGUgImk5MTVfcXVlcnkuaCIKICNpbmNsdWRl
IDx1YXBpL2RybS9pOTE1X2RybS5oPgogCkBAIC0xNDAsMTAgKzE0MSwzMDQgQEAgcXVlcnlfZW5n
aW5lX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIGxlbjsKIH0K
IAorc3RhdGljIGludCBjYW5fY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKHUz
MiB1c2VyX25fcmVncywKKwkJCQkJCSAgICB1NjQgdXNlcl9yZWdzX3B0ciwKKwkJCQkJCSAgICB1
MzIga2VybmVsX25fcmVncykKK3sKKwkvKgorCSAqIFdlJ2xsIGp1c3QgcHV0IHRoZSBudW1iZXIg
b2YgcmVnaXN0ZXJzLCBhbmQgd29uJ3QgY29weSB0aGUKKwkgKiByZWdpc3Rlci4KKwkgKi8KKwlp
ZiAodXNlcl9uX3JlZ3MgPT0gMCkKKwkJcmV0dXJuIDA7CisKKwlpZiAodXNlcl9uX3JlZ3MgPCBr
ZXJuZWxfbl9yZWdzKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmICghYWNjZXNzX29rKHU2NF90
b191c2VyX3B0cih1c2VyX3JlZ3NfcHRyKSwKKwkJICAgICAgIDIgKiBzaXplb2YodTMyKSAqIGtl
cm5lbF9uX3JlZ3MpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcihjb25zdCBzdHJ1Y3Qg
aTkxNV9vYV9yZWcgKmtlcm5lbF9yZWdzLAorCQkJCQkJdTMyIGtlcm5lbF9uX3JlZ3MsCisJCQkJ
CQl1NjQgdXNlcl9yZWdzX3B0ciwKKwkJCQkJCXUzMiAqdXNlcl9uX3JlZ3MpCit7CisJdTMyIHI7
CisKKwlpZiAoKnVzZXJfbl9yZWdzID09IDApIHsKKwkJKnVzZXJfbl9yZWdzID0ga2VybmVsX25f
cmVnczsKKwkJcmV0dXJuIDA7CisJfQorCisJKnVzZXJfbl9yZWdzID0ga2VybmVsX25fcmVnczsK
KworCWZvciAociA9IDA7IHIgPCBrZXJuZWxfbl9yZWdzOyByKyspIHsKKwkJdTMyIF9fdXNlciAq
dXNlcl9yZWdfcHRyID0KKwkJCXU2NF90b191c2VyX3B0cih1c2VyX3JlZ3NfcHRyICsgc2l6ZW9m
KHUzMikgKiByICogMik7CisJCXUzMiBfX3VzZXIgKnVzZXJfdmFsX3B0ciA9CisJCQl1NjRfdG9f
dXNlcl9wdHIodXNlcl9yZWdzX3B0ciArIHNpemVvZih1MzIpICogciAqIDIgKworCQkJCQlzaXpl
b2YodTMyKSk7CisJCWludCByZXQ7CisKKwkJcmV0ID0gX19wdXRfdXNlcihpOTE1X21taW9fcmVn
X29mZnNldChrZXJuZWxfcmVnc1tyXS5hZGRyKSwKKwkJCQkgdXNlcl9yZWdfcHRyKTsKKwkJaWYg
KHJldCkKKwkJCXJldHVybiAtRUZBVUxUOworCisJCXJldCA9IF9fcHV0X3VzZXIoa2VybmVsX3Jl
Z3Nbcl0udmFsdWUsIHVzZXJfdmFsX3B0cik7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gLUVGQVVM
VDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJmX2NvbmZpZ19k
YXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgc3RydWN0IGRybV9pOTE1
X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0sCisJCQkJICBib29sIHVzZV91dWlkKQoreworCXN0cnVj
dCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZyBfX3VzZXIgKnVzZXJfcXVlcnlfY29uZmlnX3B0
ciA9CisJCXU2NF90b191c2VyX3B0cihxdWVyeV9pdGVtLT5kYXRhX3B0cik7CisJc3RydWN0IGRy
bV9pOTE1X3BlcmZfb2FfY29uZmlnIF9fdXNlciAqdXNlcl9jb25maWdfcHRyID0KKwkJdTY0X3Rv
X3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyICsKKwkJCQlzaXplb2Yoc3RydWN0IGRybV9p
OTE1X3F1ZXJ5X3BlcmZfY29uZmlnKSk7CisJc3RydWN0IGRybV9pOTE1X3BlcmZfb2FfY29uZmln
IHVzZXJfY29uZmlnOworCXN0cnVjdCBpOTE1X3BlcmYgKnBlcmYgPSAmaTkxNS0+cGVyZjsKKwlz
dHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZzsKKwljaGFyIHV1aWRbVVVJRF9TVFJJTkdf
TEVOICsgMV07CisJdTY0IGNvbmZpZ19pZDsKKwl1MzIgZmxhZ3MsIHRvdGFsX3NpemU7CisJaW50
IHJldDsKKworCWlmICghcGVyZi0+aTkxNSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwl0b3RhbF9z
aXplID0KKwkJc2l6ZW9mKHN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZykgKworCQlz
aXplb2Yoc3RydWN0IGRybV9pOTE1X3BlcmZfb2FfY29uZmlnKTsKKworCWlmIChxdWVyeV9pdGVt
LT5sZW5ndGggPT0gMCkKKwkJcmV0dXJuIHRvdGFsX3NpemU7CisKKwlpZiAocXVlcnlfaXRlbS0+
bGVuZ3RoIDwgdG90YWxfc2l6ZSkgeworCQlEUk1fREVCVUcoIkludmFsaWQgcXVlcnkgY29uZmln
IGRhdGEgaXRlbSBzaXplPSV1IGV4cGVjdGVkPSV1XG4iLAorCQkJICBxdWVyeV9pdGVtLT5sZW5n
dGgsIHRvdGFsX3NpemUpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoIWFjY2Vzc19v
ayh1c2VyX3F1ZXJ5X2NvbmZpZ19wdHIsIHRvdGFsX3NpemUpKQorCQlyZXR1cm4gLUVGQVVMVDsK
KworCWlmIChfX2dldF91c2VyKGZsYWdzLCAmdXNlcl9xdWVyeV9jb25maWdfcHRyLT5mbGFncykp
CisJCXJldHVybiAtRUZBVUxUOworCisJaWYgKGZsYWdzICE9IDApCisJCXJldHVybiAtRUlOVkFM
OworCisJaWYgKHVzZV91dWlkKSB7CisJCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqdG1wOworCQlp
bnQgaWQ7CisKKwkJQlVJTERfQlVHX09OKHNpemVvZih1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPnV1
aWQpID49IHNpemVvZih1dWlkKSk7CisKKwkJbWVtc2V0KCZ1dWlkLCAwLCBzaXplb2YodXVpZCkp
OworCQlpZiAoX19jb3B5X2Zyb21fdXNlcih1dWlkLCB1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPnV1
aWQsCisJCQkJICAgICBzaXplb2YodXNlcl9xdWVyeV9jb25maWdfcHRyLT51dWlkKSkpCisJCQly
ZXR1cm4gLUVGQVVMVDsKKworCQlvYV9jb25maWcgPSBOVUxMOworCQlyY3VfcmVhZF9sb2NrKCk7
CisJCWlkcl9mb3JfZWFjaF9lbnRyeSgmcGVyZi0+bWV0cmljc19pZHIsIHRtcCwgaWQpIHsKKwkJ
CWlmICghc3RyY21wKHRtcC0+dXVpZCwgdXVpZCkpIHsKKwkJCQlvYV9jb25maWcgPSBpOTE1X29h
X2NvbmZpZ19nZXQodG1wKTsKKwkJCQlicmVhazsKKwkJCX0KKwkJfQorCQlyY3VfcmVhZF91bmxv
Y2soKTsKKwl9IGVsc2UgeworCQlpZiAoX19nZXRfdXNlcihjb25maWdfaWQsICZ1c2VyX3F1ZXJ5
X2NvbmZpZ19wdHItPmNvbmZpZykpCisJCQlyZXR1cm4gLUVGQVVMVDsKKworCQlvYV9jb25maWcg
PSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZyhwZXJmLCBjb25maWdfaWQpOworCX0KKwlpZiAoIW9h
X2NvbmZpZykKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwlpZiAoX19jb3B5X2Zyb21fdXNlcigmdXNl
cl9jb25maWcsIHVzZXJfY29uZmlnX3B0ciwKKwkJCSAgICAgc2l6ZW9mKHVzZXJfY29uZmlnKSkp
IHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byBvdXQ7CisJfQorCisJcmV0ID0gY2FuX2NvcHlf
cGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcih1c2VyX2NvbmZpZy5uX2Jvb2xlYW5fcmVn
cywKKwkJCQkJCSAgICAgICB1c2VyX2NvbmZpZy5ib29sZWFuX3JlZ3NfcHRyLAorCQkJCQkJICAg
ICAgIG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuKTsKKwlpZiAocmV0KQorCQlnb3RvIG91
dDsKKworCXJldCA9IGNhbl9jb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIodXNl
cl9jb25maWcubl9mbGV4X3JlZ3MsCisJCQkJCQkgICAgICAgdXNlcl9jb25maWcuZmxleF9yZWdz
X3B0ciwKKwkJCQkJCSAgICAgICBvYV9jb25maWctPmZsZXhfcmVnc19sZW4pOworCWlmIChyZXQp
CisJCWdvdG8gb3V0OworCisJcmV0ID0gY2FuX2NvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29y
X251bWJlcih1c2VyX2NvbmZpZy5uX211eF9yZWdzLAorCQkJCQkJICAgICAgIHVzZXJfY29uZmln
Lm11eF9yZWdzX3B0ciwKKwkJCQkJCSAgICAgICBvYV9jb25maWctPm11eF9yZWdzX2xlbik7CisJ
aWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBjb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVy
c19vcl9udW1iZXIob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKKwkJCQkJCSAgIG9hX2NvbmZp
Zy0+Yl9jb3VudGVyX3JlZ3NfbGVuLAorCQkJCQkJICAgdXNlcl9jb25maWcuYm9vbGVhbl9yZWdz
X3B0ciwKKwkJCQkJCSAgICZ1c2VyX2NvbmZpZy5uX2Jvb2xlYW5fcmVncyk7CisJaWYgKHJldCkK
KwkJZ290byBvdXQ7CisKKwlyZXQgPSBjb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1i
ZXIob2FfY29uZmlnLT5mbGV4X3JlZ3MsCisJCQkJCQkgICBvYV9jb25maWctPmZsZXhfcmVnc19s
ZW4sCisJCQkJCQkgICB1c2VyX2NvbmZpZy5mbGV4X3JlZ3NfcHRyLAorCQkJCQkJICAgJnVzZXJf
Y29uZmlnLm5fZmxleF9yZWdzKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNv
cHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcihvYV9jb25maWctPm11eF9yZWdzLAor
CQkJCQkJICAgb2FfY29uZmlnLT5tdXhfcmVnc19sZW4sCisJCQkJCQkgICB1c2VyX2NvbmZpZy5t
dXhfcmVnc19wdHIsCisJCQkJCQkgICAmdXNlcl9jb25maWcubl9tdXhfcmVncyk7CisJaWYgKHJl
dCkKKwkJZ290byBvdXQ7CisKKwltZW1jcHkodXNlcl9jb25maWcudXVpZCwgb2FfY29uZmlnLT51
dWlkLCBzaXplb2YodXNlcl9jb25maWcudXVpZCkpOworCisJaWYgKF9fY29weV90b191c2VyKHVz
ZXJfY29uZmlnX3B0ciwgJnVzZXJfY29uZmlnLAorCQkJICAgc2l6ZW9mKHVzZXJfY29uZmlnKSkp
IHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byBvdXQ7CisJfQorCisJcmV0ID0gdG90YWxfc2l6
ZTsKKworb3V0OgorCWk5MTVfb2FfY29uZmlnX3B1dChvYV9jb25maWcpOworCXJldHVybiByZXQ7
Cit9CisKK3N0YXRpYyBzaXplX3Qgc2l6ZW9mX3BlcmZfY29uZmlnX2xpc3Qoc2l6ZV90IGNvdW50
KQoreworCXJldHVybiBzaXplb2Yoc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnKSAr
IHNpemVvZih1NjQpICogY291bnQ7Cit9CisKK3N0YXRpYyBzaXplX3Qgc2l6ZW9mX3BlcmZfbWV0
cmljcyhzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmKQoreworCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAq
dG1wOworCXNpemVfdCBpOworCWludCBpZDsKKworCWkgPSAxOworCXJjdV9yZWFkX2xvY2soKTsK
KwlpZHJfZm9yX2VhY2hfZW50cnkoJnBlcmYtPm1ldHJpY3NfaWRyLCB0bXAsIGlkKQorCQlpKys7
CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwlyZXR1cm4gc2l6ZW9mX3BlcmZfY29uZmlnX2xpc3Qo
aSk7Cit9CisKK3N0YXRpYyBpbnQgcXVlcnlfcGVyZl9jb25maWdfbGlzdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCQkgIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVtICpxdWVy
eV9pdGVtKQoreworCXN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZyBfX3VzZXIgKnVz
ZXJfcXVlcnlfY29uZmlnX3B0ciA9CisJCXU2NF90b191c2VyX3B0cihxdWVyeV9pdGVtLT5kYXRh
X3B0cik7CisJc3RydWN0IGk5MTVfcGVyZiAqcGVyZiA9ICZpOTE1LT5wZXJmOworCXU2NCAqb2Ff
Y29uZmlnX2lkcyA9IE5VTEw7CisJaW50IGksIG5fY29uZmlnczsKKwl1MzIgZmxhZ3M7CisJaW50
IHJldDsKKworCWlmICghcGVyZi0+aTkxNSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlpZiAocXVl
cnlfaXRlbS0+bGVuZ3RoID09IDApCisJCXJldHVybiBzaXplb2ZfcGVyZl9tZXRyaWNzKHBlcmYp
OworCisJaWYgKGdldF91c2VyKGZsYWdzLCAmdXNlcl9xdWVyeV9jb25maWdfcHRyLT5mbGFncykp
CisJCXJldHVybiAtRUZBVUxUOworCisJaWYgKGZsYWdzICE9IDApCisJCXJldHVybiAtRUlOVkFM
OworCisJbl9jb25maWdzID0gMTsKKwlkbyB7CisJCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqdG1w
OworCQl1NjQgKmlkczsKKwkJaW50IGlkOworCisJCWlkcyA9IGtyZWFsbG9jKG9hX2NvbmZpZ19p
ZHMsCisJCQkgICAgICAgbl9jb25maWdzICogc2l6ZW9mKCpvYV9jb25maWdfaWRzKSwKKwkJCSAg
ICAgICBHRlBfS0VSTkVMKTsKKwkJaWYgKCFpZHMpCisJCQlyZXR1cm4gLUVOT01FTTsKKworCQlp
ID0gMDsKKwkJaWRzW2krK10gPSAxdWxsOworCQlyY3VfcmVhZF9sb2NrKCk7CisJCWlkcl9mb3Jf
ZWFjaF9lbnRyeSgmcGVyZi0+bWV0cmljc19pZHIsIHRtcCwgaWQpIHsKKwkJCWlmIChpIDwgbl9j
b25maWdzKQorCQkJCWlkc1tpXSA9IGlkOworCQkJaSsrOworCQl9CisJCXJjdV9yZWFkX3VubG9j
aygpOworCisJCW9hX2NvbmZpZ19pZHMgPSBpZHM7CisJfSB3aGlsZSAoaSA+IG5fY29uZmlncyk7
CisKKwlpZiAocXVlcnlfaXRlbS0+bGVuZ3RoIDwgc2l6ZW9mX3BlcmZfY29uZmlnX2xpc3Qobl9j
b25maWdzKSkgeworCQlEUk1fREVCVUcoIkludmFsaWQgcXVlcnkgY29uZmlnIGxpc3QgaXRlbSBz
aXplPSV1IGV4cGVjdGVkPSV6dVxuIiwKKwkJCSAgcXVlcnlfaXRlbS0+bGVuZ3RoLAorCQkJICBz
aXplb2ZfcGVyZl9jb25maWdfbGlzdChuX2NvbmZpZ3MpKTsKKwkJa2ZyZWUob2FfY29uZmlnX2lk
cyk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWlmIChwdXRfdXNlcihuX2NvbmZpZ3MsICZ1
c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmNvbmZpZykpIHsKKwkJa2ZyZWUob2FfY29uZmlnX2lkcyk7
CisJCXJldHVybiAtRUZBVUxUOworCX0KKworCXJldCA9IGNvcHlfdG9fdXNlcih1c2VyX3F1ZXJ5
X2NvbmZpZ19wdHIgKyAxLAorCQkJICAgb2FfY29uZmlnX2lkcywKKwkJCSAgIG5fY29uZmlncyAq
IHNpemVvZigqb2FfY29uZmlnX2lkcykpOworCWtmcmVlKG9hX2NvbmZpZ19pZHMpOworCWlmIChy
ZXQpCisJCXJldHVybiAtRUZBVUxUOworCisJcmV0dXJuIHNpemVvZl9wZXJmX2NvbmZpZ19saXN0
KG5fY29uZmlncyk7Cit9CisKK3N0YXRpYyBpbnQgcXVlcnlfcGVyZl9jb25maWcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVt
ICpxdWVyeV9pdGVtKQoreworCXN3aXRjaCAocXVlcnlfaXRlbS0+ZmxhZ3MpIHsKKwljYXNlIERS
TV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1Q6CisJCXJldHVybiBxdWVyeV9wZXJmX2NvbmZp
Z19saXN0KGk5MTUsIHF1ZXJ5X2l0ZW0pOworCWNhc2UgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05G
SUdfREFUQV9GT1JfVVVJRDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29uZmlnX2RhdGEoaTkxNSwg
cXVlcnlfaXRlbSwgdHJ1ZSk7CisJY2FzZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRB
X0ZPUl9JRDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29uZmlnX2RhdGEoaTkxNSwgcXVlcnlfaXRl
bSwgZmFsc2UpOworCWRlZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KK30KKwogc3RhdGlj
IGludCAoKiBjb25zdCBpOTE1X3F1ZXJ5X2Z1bmNzW10pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkJCQkJc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0p
ID0gewogCXF1ZXJ5X3RvcG9sb2d5X2luZm8sCiAJcXVlcnlfZW5naW5lX2luZm8sCisJcXVlcnlf
cGVyZl9jb25maWcsCiB9OwogCiBpbnQgaTkxNV9xdWVyeV9pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCmRpZmYgLS1naXQgYS9p
bmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgK
aW5kZXggYzUwYzcxMmIzNzcxLi4wYzdiMjgxNWZiZjEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFw
aS9kcm0vaTkxNV9kcm0uaAorKysgYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKQEAgLTIw
MDUsNiArMjAwNSw3IEBAIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVtIHsKIAlfX3U2NCBxdWVy
eV9pZDsKICNkZWZpbmUgRFJNX0k5MTVfUVVFUllfVE9QT0xPR1lfSU5GTyAgICAxCiAjZGVmaW5l
IERSTV9JOTE1X1FVRVJZX0VOR0lORV9JTkZPCTIKKyNkZWZpbmUgRFJNX0k5MTVfUVVFUllfUEVS
Rl9DT05GSUcgICAgICAzCiAvKiBNdXN0IGJlIGtlcHQgY29tcGFjdCAtLSBubyBob2xlcyBhbmQg
d2VsbCBkb2N1bWVudGVkICovCiAKIAkvKgpAQCAtMjAxNiw5ICsyMDE3LDE4IEBAIHN0cnVjdCBk
cm1faTkxNV9xdWVyeV9pdGVtIHsKIAlfX3MzMiBsZW5ndGg7CiAKIAkvKgotCSAqIFVudXNlZCBm
b3Igbm93LiBNdXN0IGJlIGNsZWFyZWQgdG8gemVyby4KKwkgKiBXaGVuIHF1ZXJ5X2lkID09IERS
TV9JOTE1X1FVRVJZX1RPUE9MT0dZX0lORk8sIG11c3QgYmUgMC4KKwkgKgorCSAqIFdoZW4gcXVl
cnlfaWQgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUcsIG11c3QgYmUgb25lIG9mIHRoZQor
CSAqIGZvbGxvd2luZyA6CisJICogICAgICAgICAtIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklH
X0xJU1QKKwkgKiAgICAgICAgIC0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1Jf
VVVJRAorCSAqICAgICAgICAgLSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19GT1JfVVVJRAog
CSAqLwogCV9fdTMyIGZsYWdzOworI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19M
SVNUICAgICAgICAgIDEKKyNkZWZpbmUgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9G
T1JfVVVJRCAyCisjZGVmaW5lIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RBVEFfRk9SX0lE
ICAgMwogCiAJLyoKIAkgKiBEYXRhIHdpbGwgYmUgd3JpdHRlbiBhdCB0aGUgbG9jYXRpb24gcG9p
bnRlZCBieSBkYXRhX3B0ciB3aGVuIHRoZQpAQCAtMjE0Niw2ICsyMTU2LDU2IEBAIHN0cnVjdCBk
cm1faTkxNV9xdWVyeV9lbmdpbmVfaW5mbyB7CiAJc3RydWN0IGRybV9pOTE1X2VuZ2luZV9pbmZv
IGVuZ2luZXNbXTsKIH07CiAKKy8qCisgKiBEYXRhIHdyaXR0ZW4gYnkgdGhlIGtlcm5lbCB3aXRo
IHF1ZXJ5IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHLgorICovCitzdHJ1Y3QgZHJtX2k5MTVf
cXVlcnlfcGVyZl9jb25maWcgeworCXVuaW9uIHsKKwkJLyoKKwkJICogV2hlbiBxdWVyeV9pdGVt
LmZsYWdzID09IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1QsIGk5MTUgc2V0cworCQkg
KiB0aGlzIGZpZWxkcyB0byB0aGUgbnVtYmVyIG9mIGNvbmZpZ3VyYXRpb25zIGF2YWlsYWJsZS4K
KwkJICovCisJCV9fdTY0IG5fY29uZmlnczsKKworCQkvKgorCQkgKiBXaGVuIHF1ZXJ5X2lkID09
IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RBVEFfRk9SX0lELAorCQkgKiBpOTE1IHdpbGwg
dXNlIHRoZSB2YWx1ZSBpbiB0aGlzIGZpZWxkIGFzIGNvbmZpZ3VyYXRpb24KKwkJICogaWRlbnRp
ZmllciB0byBkZWNpZGUgd2hhdCBkYXRhIHRvIHdyaXRlIGludG8gY29uZmlnX3B0ci4KKwkJICov
CisJCV9fdTY0IGNvbmZpZzsKKworCQkvKgorCQkgKiBXaGVuIHF1ZXJ5X2lkID09IERSTV9JOTE1
X1FVRVJZX1BFUkZfQ09ORklHX0RBVEFfRk9SX1VVSUQsCisJCSAqIGk5MTUgd2lsbCB1c2UgdGhl
IHZhbHVlIGluIHRoaXMgZmllbGQgYXMgY29uZmlndXJhdGlvbgorCQkgKiBpZGVudGlmaWVyIHRv
IGRlY2lkZSB3aGF0IGRhdGEgdG8gd3JpdGUgaW50byBjb25maWdfcHRyLgorCQkgKgorCQkgKiBT
dHJpbmcgZm9ybWF0dGVkIGxpa2UgIiUwOHgtJTA0eC0lMDR4LSUwNHgtJTAxMngiCisJCSAqLwor
CQljaGFyIHV1aWRbMzZdOworCX07CisKKwkvKgorCSAqIFVudXNlZCBmb3Igbm93LiBNdXN0IGJl
IGNsZWFyZWQgdG8gemVyby4KKwkgKi8KKwlfX3UzMiBmbGFnczsKKworCS8qCisJICogV2hlbiBx
dWVyeV9pdGVtLmZsYWdzID09IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1QsIGk5MTUg
d2lsbAorCSAqIHdyaXRlIGFuIGFycmF5IG9mIF9fdTY0IG9mIGNvbmZpZ3VyYXRpb24gaWRlbnRp
ZmllcnMuCisJICoKKwkgKiBXaGVuIHF1ZXJ5X2l0ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllf
UEVSRl9DT05GSUdfREFUQSwgaTkxNSB3aWxsCisJICogd3JpdGUgYSBzdHJ1Y3QgZHJtX2k5MTVf
cGVyZl9vYV9jb25maWcuIElmIHRoZSBmb2xsb3dpbmcgZmllbGRzIG9mCisJICogZHJtX2k5MTVf
cGVyZl9vYV9jb25maWcgYXJlIHNldCBub3Qgc2V0IHRvIDAsIGk5MTUgd2lsbCB3cml0ZSBpbnRv
CisJICogdGhlIGFzc29jaWF0ZWQgcG9pbnRlcnMgdGhlIHZhbHVlcyBvZiBzdWJtaXR0ZWQgd2hl
biB0aGUKKwkgKiBjb25maWd1cmF0aW9uIHdhcyBjcmVhdGVkIDoKKwkgKgorCSAqICAgICAgICAg
LSBuX211eF9yZWdzCisJICogICAgICAgICAtIG5fYm9vbGVhbl9yZWdzCisJICogICAgICAgICAt
IG5fZmxleF9yZWdzCisJICovCisJX191OCBkYXRhW107Cit9OworCiAjaWYgZGVmaW5lZChfX2Nw
bHVzcGx1cykKIH0KICNlbmRpZgotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=
